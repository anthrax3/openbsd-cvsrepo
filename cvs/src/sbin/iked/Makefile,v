head	1.17;
access;
symbols
	OPENBSD_6_1:1.15.0.8
	OPENBSD_6_1_BASE:1.15
	OPENBSD_6_0:1.15.0.4
	OPENBSD_6_0_BASE:1.15
	OPENBSD_5_9:1.15.0.2
	OPENBSD_5_9_BASE:1.15
	OPENBSD_5_8:1.12.0.6
	OPENBSD_5_8_BASE:1.12
	OPENBSD_5_7:1.12.0.2
	OPENBSD_5_7_BASE:1.12
	OPENBSD_5_6:1.11.0.6
	OPENBSD_5_6_BASE:1.11
	OPENBSD_5_5:1.11.0.4
	OPENBSD_5_5_BASE:1.11
	OPENBSD_5_4:1.8.0.4
	OPENBSD_5_4_BASE:1.8
	OPENBSD_5_3:1.8.0.2
	OPENBSD_5_3_BASE:1.8
	OPENBSD_5_2:1.6.0.8
	OPENBSD_5_2_BASE:1.6
	OPENBSD_5_1_BASE:1.6
	OPENBSD_5_1:1.6.0.6
	OPENBSD_5_0:1.6.0.4
	OPENBSD_5_0_BASE:1.6
	OPENBSD_4_9:1.6.0.2
	OPENBSD_4_9_BASE:1.6
	OPENBSD_4_8:1.5.0.2
	OPENBSD_4_8_BASE:1.5;
locks; strict;
comment	@# @;


1.17
date	2017.07.19.12.50.32;	author espie;	state Exp;
branches;
next	1.16;
commitid	JSAFUy3u4ukEoD6z;

1.16
date	2017.07.03.22.21.47;	author espie;	state Exp;
branches;
next	1.15;
commitid	SoYT2zMcub5xTPqC;

1.15
date	2015.10.23.09.13.00;	author tedu;	state Exp;
branches;
next	1.14;
commitid	7QzJy7WXyviHhczs;

1.14
date	2015.10.22.15.14.27;	author reyk;	state Exp;
branches;
next	1.13;
commitid	H3YSN6oyqntUT6Jo;

1.13
date	2015.10.19.11.25.35;	author reyk;	state Exp;
branches;
next	1.12;
commitid	HzcDW70HFbhaqvT8;

1.12
date	2014.08.27.10.28.57;	author reyk;	state Exp;
branches;
next	1.11;
commitid	kDDmioKYpauZKbXI;

1.11
date	2014.02.17.15.07.23;	author markus;	state Exp;
branches;
next	1.10;

1.10
date	2014.01.18.05.54.51;	author martynas;	state Exp;
branches;
next	1.9;

1.9
date	2013.11.14.12.26.38;	author markus;	state Exp;
branches;
next	1.8;

1.8
date	2013.01.08.10.38.19;	author reyk;	state Exp;
branches;
next	1.7;

1.7
date	2012.09.25.21.50.41;	author brad;	state Exp;
branches;
next	1.6;

1.6
date	2010.12.22.17.43.10;	author reyk;	state Exp;
branches;
next	1.5;

1.5
date	2010.06.11.12.47.18;	author reyk;	state Exp;
branches;
next	1.4;

1.4
date	2010.06.11.10.15.31;	author jsg;	state Exp;
branches;
next	1.3;

1.3
date	2010.06.10.08.29.47;	author reyk;	state Exp;
branches;
next	1.2;

1.2
date	2010.06.03.17.05.01;	author reyk;	state Exp;
branches;
next	1.1;

1.1
date	2010.06.03.16.41.12;	author reyk;	state Exp;
branches;
next	;


desc
@@


1.17
log
@more depends gc / yacc rules overhaul

okay millert@@
@
text
@# $OpenBSD: Makefile,v 1.16 2017/07/03 22:21:47 espie Exp $

PROG=		iked
SRCS=		ca.c chap_ms.c config.c control.c crypto.c dh.c \
		eap.c iked.c ikev2.c ikev2_msg.c ikev2_pld.c \
		log.c ocsp.c pfkey.c policy.c proc.c timer.c util.c \
		imsg_util.c smult_curve25519_ref.c
SRCS+=		eap_map.c ikev2_map.c
SRCS+=		parse.y
MAN=		iked.conf.5 iked.8
#NOMAN=		yes

LDADD=		-lutil -levent -lcrypto
DPADD=		${LIBUTIL} ${LIBEVENT} ${LIBCRYPTO}
CFLAGS+=	-Wall -I${.CURDIR}
CFLAGS+=	-Wstrict-prototypes -Wmissing-prototypes
CFLAGS+=	-Wmissing-declarations
CFLAGS+=	-Wshadow -Wpointer-arith -Wcast-qual
CFLAGS+=	-Wsign-compare
CLEANFILES+=	ikev2_map.c eap_map.c
GENERATED=	ikev2_map.c eap_map.c

YFLAGS=

ikev2_map.c: genmap.sh ikev2.h
	/bin/sh ${.CURDIR}/genmap.sh ${.CURDIR}/ikev2.h ikev2 > $@@
	@@touch $@@

eap_map.c: genmap.sh eap.h
	/bin/sh ${.CURDIR}/genmap.sh ${.CURDIR}/eap.h eap > $@@
	@@touch $@@

.include <bsd.prog.mk>

# Don't compile iked as static binary by default
LDSTATIC=
@


1.16
log
@no need to generate y.tab.h if nothing uses it, set YFLAGS to nothing
instead of CLEANFILES += y.tab.h

okay millert@@
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.15 2015/10/23 09:13:00 tedu Exp $
a31 2

${PROG} beforedepend: ${GENERATED}
@


1.15
log
@push LDSTATIC line down so it's not overridden by makefile.inc. ok reyk
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.14 2015/10/22 15:14:27 reyk Exp $
d20 1
a20 1
CLEANFILES+=	y.tab.h ikev2_map.c eap_map.c
d22 2
@


1.14
log
@Stop linking iked -static: It was inherited from isakmpd that is
-static for NFS-over-IPsec that might mount the libraries after /usr.
The benefit of linking iked dynamic outweighs the historic reason, eg.
to get full address space randomization and to benefit from libcrypto
updates, so we turn it into a dynamic binary.

OK deraadt@@ naddy@@
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.13 2015/10/19 11:25:35 reyk Exp $
a12 3
# Don't compile iked as static binary by default
LDSTATIC=

d34 3
@


1.13
log
@Remove the ikev1 stub - Since I started iked, it has an empty privsep
process for ISAKMP+IKEv1.  I kept it to let somebody either contribute
the old protocol one day, I never intended to implement IKEv1 myself,
or to add a new kind of pipe to isakmpd to hand off IKEv1 messages.
As IKEv2 is widely supported by all major OS and networking vendors
now, I'm happy to scrap the idea of supporting ISAKMP+IKEv1.  It is
still possible to use isakmpd for legacy VPNs.

OK mikeb@@
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.12 2014/08/27 10:28:57 reyk Exp $
d12 3
@


1.12
log
@Add support for Curve25519 using the public domain code that is found
in OpenSSH.  The "private use" DH group 1034 is based on the value
that was picked by strongswan recently.

OK mikeb@@ markus@@
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.11 2014/02/17 15:07:23 markus Exp $
d5 1
a5 1
		eap.c iked.c ikev1.c ikev2.c ikev2_msg.c ikev2_pld.c \
@


1.11
log
@basic OCSP support. enable with 'set ocsp "http://10.0.0.10:8888/"'
ok mikeb@@
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.10 2014/01/18 05:54:51 martynas Exp $
d6 2
a7 1
		log.c ocsp.c pfkey.c policy.c proc.c timer.c util.c imsg_util.c
@


1.10
log
@Remove -Wbounded:  it is now the compiler default.
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.9 2013/11/14 12:26:38 markus Exp $
d6 1
a6 1
		log.c pfkey.c policy.c proc.c timer.c util.c imsg_util.c
@


1.9
log
@not need to specify OBJDIR; ok mikeb
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.8 2013/01/08 10:38:19 reyk Exp $
d18 1
a18 1
CFLAGS+=	-Wsign-compare -Wbounded
@


1.8
log
@Remove private CVS tag from an obsolete repository and bump copyright
to 2013 while I'm here... this is my way of saying "happy new year!".
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.7 2012/09/25 21:50:41 brad Exp $
d7 1
a7 1
SRCS+=		${.OBJDIR}/eap_map.c ${.OBJDIR}/ikev2_map.c
@


1.7
log
@Correct DPADD to not list libssl which is not used by iked.

ok sthen@@ mikeb@@
@
text
@d1 1
a1 2
# $OpenBSD: Makefile,v 1.6 2010/12/22 17:43:10 reyk Exp $
# $vantronix: Makefile,v 1.22 2010/06/02 12:22:58 reyk Exp $
@


1.6
log
@split util.c into two files: imsg_util.c for ibuf/imsg stuff and util for
everything else.  we might need to include util.c in ikectl later.

sure mikeb@@
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.5 2010/06/11 12:47:18 reyk Exp $
d14 1
a14 1
DPADD=		${LIBUTIL} ${LIBEVENT} ${LIBSSL} ${LIBCRYPTO}
@


1.5
log
@add some infrastructure to support timers and initiator mode later.
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.4 2010/06/11 10:15:31 jsg Exp $
d7 1
a7 1
		log.c pfkey.c policy.c proc.c timer.c util.c
@


1.4
log
@tweak the code slightly so we can remove -lssl

ok reyk@@
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.3 2010/06/10 08:29:47 reyk Exp $
d7 1
a7 1
		log.c pfkey.c policy.c proc.c util.c
@


1.3
log
@i don't like splitting source code in too many source files but ikev2.c
has grown too large, so split it in 3 files and rename a few functions
to organize the code a bit better.
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.2 2010/06/03 17:05:01 reyk Exp $
d13 1
a13 1
LDADD=		-lutil -levent -lssl -lcrypto
@


1.2
log
@remove my BINDIR override, pointed out by deraadt@@
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.1 2010/06/03 16:41:12 reyk Exp $
d5 4
a8 3
SRCS=		dh.c iked.c ikev1.c ikev2.c log.c \
		proc.c util.c config.c policy.c crypto.c ca.c pfkey.c \
		control.c chap_ms.c eap.c
a9 1
SRCS+=		${.OBJDIR}/ikev2_map.c ${.OBJDIR}/eap_map.c
@


1.1
log
@Import iked, a new implementation of the IKEv2 protocol.

iked(8) is an automatic keying daemon for IPsec, like isakmpd(8), that
IPsec creates flows and SAs automatically.  Unlike isakmpd, iked(8)
implements the newer IKEv2 protocol instead of IKEv1/ISAKMP.  The
daemon is still work-in-progress and not enabled in the builds, but is
already able to establish IKEv2 sessions with some other IKEv2
implementations as a responder.

with lots of help and debugging by jsg@@
ok deraadt@@
@
text
@d1 1
a1 1
# $OpenBSD$
a11 2

BINDIR=		/sbin
@

