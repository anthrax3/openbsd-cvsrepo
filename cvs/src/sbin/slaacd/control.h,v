head	1.2;
access;
symbols;
locks; strict;
comment	@ * @;


1.2
date	2017.07.06.15.02.53;	author florian;	state Exp;
branches;
next	1.1;
commitid	4J2Yoz33lyhwu9Xf;

1.1
date	2017.06.03.10.00.29;	author florian;	state Exp;
branches;
next	;
commitid	LiVl5Mw0RdD7hl8R;


desc
@@


1.2
log
@Sprinkel in some #ifndef SMALL to make slaacd smaller for the
installer.

This removes the control socket handling which is useless because we
won't have slaacctl in the installer.

Also deraadt@@ pointed out that this would be the first use of log.c in
the installer where we don't have syslogd running so it's rather
pointless. So this completely neuters logging.

The log.h change doesn't interfere with benno@@'s efforts of unifying
log.c

The installer version of slaacd won't even compile control.c and log.c
@
text
@/*	$OpenBSD: control.h,v 1.1 2017/06/03 10:00:29 florian Exp $	*/

/*
 * Copyright (c) 2003, 2004 Henning Brauer <henning@@openbsd.org>
 *
 * Permission to use, copy, modify, and distribute this software for any
 * purpose with or without fee is hereby granted, provided that the above
 * copyright notice and this permission notice appear in all copies.
 *
 * THE SOFTWARE IS PROVIDED "AS IS" AND THE AUTHOR DISCLAIMS ALL WARRANTIES
 * WITH REGARD TO THIS SOFTWARE INCLUDING ALL IMPLIED WARRANTIES OF
 * MERCHANTABILITY AND FITNESS. IN NO EVENT SHALL THE AUTHOR BE LIABLE FOR
 * ANY SPECIAL, DIRECT, INDIRECT, OR CONSEQUENTIAL DAMAGES OR ANY DAMAGES
 * WHATSOEVER RESULTING FROM LOSS OF USE, DATA OR PROFITS, WHETHER IN AN
 * ACTION OF CONTRACT, NEGLIGENCE OR OTHER TORTIOUS ACTION, ARISING OUT OF
 * OR IN CONNECTION WITH THE USE OR PERFORMANCE OF THIS SOFTWARE.
 */

#ifndef	SMALL
struct {
	struct event	ev;
	struct event	evt;
	int		fd;
} control_state;

struct ctl_conn {
	TAILQ_ENTRY(ctl_conn)	entry;
	struct imsgev		iev;
};

int	control_init(char *);
int	control_listen(void);
void	control_accept(int, short, void *);
void	control_dispatch_imsg(int, short, void *);
int	control_imsg_relay(struct imsg *);
void	control_cleanup(char *);
#endif	/* SMALL */
@


1.1
log
@Move slaacd to /sbin
jca points out that all the other interface configuration tools live
there (like ifconfig or dhclient). Furthermore it starts so early in
the boot process that /usr might not be mounted yet if it's a nfs
filesystem.
sthen and deraadt agree
@
text
@d1 1
a1 1
/*	$OpenBSD: control.h,v 1.1 2017/03/18 17:33:13 florian Exp $	*/
d19 1
d37 1
@

