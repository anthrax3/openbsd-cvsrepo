head	1.34;
access;
symbols
	OPENBSD_6_1_BASE:1.34
	OPENBSD_6_0:1.34.0.10
	OPENBSD_6_0_BASE:1.34
	OPENBSD_5_9:1.34.0.6
	OPENBSD_5_9_BASE:1.34
	OPENBSD_5_8:1.34.0.8
	OPENBSD_5_8_BASE:1.34
	OPENBSD_5_7:1.34.0.2
	OPENBSD_5_7_BASE:1.34
	OPENBSD_5_6:1.34.0.4
	OPENBSD_5_6_BASE:1.34
	OPENBSD_5_5:1.32.0.8
	OPENBSD_5_5_BASE:1.32
	OPENBSD_5_4:1.32.0.4
	OPENBSD_5_4_BASE:1.32
	OPENBSD_5_3:1.32.0.2
	OPENBSD_5_3_BASE:1.32
	OPENBSD_5_2:1.31.0.22
	OPENBSD_5_2_BASE:1.31
	OPENBSD_5_1_BASE:1.31
	OPENBSD_5_1:1.31.0.20
	OPENBSD_5_0:1.31.0.18
	OPENBSD_5_0_BASE:1.31
	OPENBSD_4_9:1.31.0.16
	OPENBSD_4_9_BASE:1.31
	OPENBSD_4_8:1.31.0.14
	OPENBSD_4_8_BASE:1.31
	OPENBSD_4_7:1.31.0.10
	OPENBSD_4_7_BASE:1.31
	OPENBSD_4_6:1.31.0.12
	OPENBSD_4_6_BASE:1.31
	OPENBSD_4_5:1.31.0.8
	OPENBSD_4_5_BASE:1.31
	OPENBSD_4_4:1.31.0.6
	OPENBSD_4_4_BASE:1.31
	OPENBSD_4_3:1.31.0.4
	OPENBSD_4_3_BASE:1.31
	OPENBSD_4_2:1.31.0.2
	OPENBSD_4_2_BASE:1.31
	OPENBSD_4_1:1.28.0.4
	OPENBSD_4_1_BASE:1.28
	OPENBSD_4_0:1.28.0.2
	OPENBSD_4_0_BASE:1.28
	OPENBSD_3_9:1.27.0.2
	OPENBSD_3_9_BASE:1.27
	OPENBSD_3_8:1.26.0.4
	OPENBSD_3_8_BASE:1.26
	OPENBSD_3_7:1.26.0.2
	OPENBSD_3_7_BASE:1.26
	OPENBSD_3_6:1.23.0.2
	OPENBSD_3_6_BASE:1.23
	OPENBSD_3_5:1.21.0.6
	OPENBSD_3_5_BASE:1.21
	OPENBSD_3_4:1.21.0.4
	OPENBSD_3_4_BASE:1.21
	OPENBSD_3_3:1.21.0.2
	OPENBSD_3_3_BASE:1.21
	OPENBSD_3_2:1.18.0.8
	OPENBSD_3_2_BASE:1.18
	OPENBSD_3_1:1.18.0.6
	OPENBSD_3_1_BASE:1.18
	OPENBSD_3_0:1.18.0.4
	OPENBSD_3_0_BASE:1.18
	OPENBSD_2_9:1.18.0.2
	OPENBSD_2_9_BASE:1.18
	OPENBSD_2_8:1.16.0.4
	OPENBSD_2_8_BASE:1.16
	OPENBSD_2_7:1.16.0.2
	OPENBSD_2_7_BASE:1.16
	OPENBSD_2_6:1.15.0.2
	OPENBSD_2_6_BASE:1.15
	OPENBSD_2_5:1.13.0.2
	OPENBSD_2_5_BASE:1.13
	OPENBSD_2_4:1.10.0.2
	OPENBSD_2_4_BASE:1.10
	OPENBSD_2_3:1.6.0.6
	OPENBSD_2_3_BASE:1.6
	OPENBSD_2_2:1.6.0.4
	OPENBSD_2_2_BASE:1.6
	OPENBSD_2_1:1.6.0.2
	OPENBSD_2_1_BASE:1.6
	netbsd_1_1:1.1.1.1;
locks; strict;
comment	@.\" @;


1.34
date	2014.07.13.17.28.13;	author jmc;	state Exp;
branches;
next	1.33;
commitid	xqL8idhRkNlfc0xg;

1.33
date	2014.07.13.12.03.48;	author claudio;	state Exp;
branches;
next	1.32;
commitid	45ZRaAXs9PH26rxu;

1.32
date	2013.02.11.17.35.46;	author jmc;	state Exp;
branches;
next	1.31;

1.31
date	2007.05.31.19.19.44;	author jmc;	state Exp;
branches;
next	1.30;

1.30
date	2007.05.12.17.37.48;	author fkr;	state Exp;
branches;
next	1.29;

1.29
date	2007.04.14.13.15.25;	author jmc;	state Exp;
branches;
next	1.28;

1.28
date	2006.03.30.01.27.03;	author pedro;	state Exp;
branches;
next	1.27;

1.27
date	2005.11.21.14.27.55;	author millert;	state Exp;
branches;
next	1.26;

1.26
date	2005.02.03.05.00.07;	author jaredy;	state Exp;
branches;
next	1.25;

1.25
date	2005.01.27.19.20.18;	author jmc;	state Exp;
branches;
next	1.24;

1.24
date	2005.01.27.19.06.24;	author jmc;	state Exp;
branches;
next	1.23;

1.23
date	2004.07.28.21.27.52;	author jmc;	state Exp;
branches;
next	1.22;

1.22
date	2004.07.28.21.17.22;	author jmc;	state Exp;
branches;
next	1.21;

1.21
date	2003.03.06.09.47.18;	author hugh;	state Exp;
branches;
next	1.20;

1.20
date	2003.01.31.21.54.40;	author jmc;	state Exp;
branches;
next	1.19;

1.19
date	2002.10.17.13.15.21;	author brad;	state Exp;
branches;
next	1.18;

1.18
date	2001.04.23.15.30.26;	author aaron;	state Exp;
branches;
next	1.17;

1.17
date	2000.11.09.17.52.56;	author aaron;	state Exp;
branches;
next	1.16;

1.16
date	2000.03.18.22.55.56;	author aaron;	state Exp;
branches;
next	1.15;

1.15
date	99.06.04.02.45.15;	author aaron;	state Exp;
branches;
next	1.14;

1.14
date	99.05.28.22.59.58;	author aaron;	state Exp;
branches;
next	1.13;

1.13
date	98.12.15.01.20.30;	author aaron;	state Exp;
branches;
next	1.12;

1.12
date	98.11.28.19.56.19;	author aaron;	state Exp;
branches;
next	1.11;

1.11
date	98.11.11.22.19.56;	author aaron;	state Exp;
branches;
next	1.10;

1.10
date	98.10.07.02.57.17;	author deraadt;	state Exp;
branches;
next	1.9;

1.9
date	98.09.23.01.20.23;	author aaron;	state Exp;
branches;
next	1.8;

1.8
date	98.09.17.04.14.52;	author aaron;	state Exp;
branches;
next	1.7;

1.7
date	98.08.30.05.41.24;	author deraadt;	state Exp;
branches;
next	1.6;

1.6
date	97.05.19.18.18.23;	author downsj;	state Exp;
branches;
next	1.5;

1.5
date	96.12.10.09.06.16;	author deraadt;	state Exp;
branches;
next	1.4;

1.4
date	96.12.04.08.49.05;	author deraadt;	state Exp;
branches;
next	1.3;

1.3
date	96.10.20.08.36.23;	author tholo;	state Exp;
branches;
next	1.2;

1.2
date	96.04.21.23.45.51;	author deraadt;	state dead;
branches;
next	1.1;

1.1
date	95.10.18.08.43.31;	author deraadt;	state Exp;
branches
	1.1.1.1;
next	;

1.1.1.1
date	95.10.18.08.43.31;	author deraadt;	state Exp;
branches;
next	;


desc
@@


1.34
log
@-N for SYNOPSIS and usage(), and some small changes to previous;
@
text
@.\"	$OpenBSD: fsck.8,v 1.33 2014/07/13 12:03:48 claudio Exp $
.\"	$NetBSD: fsck.8,v 1.14 1996/10/03 20:08:29 christos Exp $
.\"
.\" Copyright (c) 1996 Christos Zoulas.  All rights reserved.
.\"
.\" Redistribution and use in source and binary forms, with or without
.\" modification, are permitted provided that the following conditions
.\" are met:
.\" 1. Redistributions of source code must retain the above copyright
.\"    notice, this list of conditions and the following disclaimer.
.\" 2. Redistributions in binary form must reproduce the above copyright
.\"    notice, this list of conditions and the following disclaimer in the
.\"    documentation and/or other materials provided with the distribution.
.\" 3. All advertising materials mentioning features or use of this software
.\"    must display the following acknowledgement:
.\"	This product includes software developed by Christos Zoulas.
.\" 4. The name of the author may not be used to endorse or promote products
.\"    derived from this software without specific prior written permission.
.\"
.\" THIS SOFTWARE IS PROVIDED BY THE AUTHOR ``AS IS'' AND ANY EXPRESS OR
.\" IMPLIED WARRANTIES, INCLUDING, BUT NOT LIMITED TO, THE IMPLIED WARRANTIES
.\" OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE ARE DISCLAIMED.
.\" IN NO EVENT SHALL THE AUTHOR BE LIABLE FOR ANY DIRECT, INDIRECT,
.\" INCIDENTAL, SPECIAL, EXEMPLARY, OR CONSEQUENTIAL DAMAGES (INCLUDING, BUT
.\" NOT LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES; LOSS OF USE,
.\" DATA, OR PROFITS; OR BUSINESS INTERRUPTION) HOWEVER CAUSED AND ON ANY
.\" THEORY OF LIABILITY, WHETHER IN CONTRACT, STRICT LIABILITY, OR TORT
.\" (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE USE OF
.\" THIS SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.
.\"
.Dd $Mdocdate: July 13 2014 $
.Dt FSCK 8
.Os
.Sh NAME
.Nm fsck
.Nd file system consistency check and interactive repair
.Sh SYNOPSIS
.Nm fsck
.Bk -words
.Op Fl dfNnpvy
.Op Fl b Ar block#
.Op Fl l Ar maxparallel
.Op Fl T Ar fstype : Ns Ar fsoptions
.Op Fl t Ar fstype
.Op Ar special | node ...
.Ek
.Sh DESCRIPTION
The
.Nm
command invokes file-system-specific programs to check the
special devices listed in the
.Xr fstab 5
file or on the command line for consistency.
.Pp
It is normally used in the script
.Xr rc 8
during automatic reboot.
If no file systems are specified,
.Nm
reads the file
.Xr fstab 5
to determine which file systems to check and in what order.
Only partitions in fstab that are mounted
.Dq rw
or
.Dq ro
and that have non-zero pass numbers are checked.
File systems with pass number 1 (normally just the root file system) are
checked one at a time.
When pass 1 completes, all remaining file systems are checked, with one
process spawned per disk drive.
The disk drive containing each file system is inferred from the longest
prefix of the device name that ends in a digit; the remaining characters
are assumed to be the partition designator.
By default, file systems which are already mounted read/write are not
checked.
.Pp
The options are as follows:
.Bl -tag -width Ds
.It Fl b Ar block#
Causes
.Nm
to use the specified block as the location of the superblock.
Block 32 is usually an alternate super block.
This option is only valid for filesystems that support backup superblocks
(ffs and ext2fs).
.It Fl d
Debugging mode.
Just print the commands without executing them.
Available only if
.Nm
is compiled to support it.
.It Fl f
Force checking of file systems, even when they are marked clean (for file systems
that support this).
.It Fl l Ar maxparallel
Limit the number of parallel checks to
.Ar maxparallel .
By default, the limit is the number of
disks, running one process per disk.
If a smaller limit is given,
the disks are checked round-robin, one file system at a time.
.It Fl N
When using
.Xr fstab 5 ,
only check filesystems that have the
.Dq net
mount option set.
By default file systems with this option are ignored.
.It Fl n
Assume a
.Dq no
response to all questions asked by
.Nm
except for
.Dq CONTINUE? ,
which is assumed to be affirmative.
File systems will not be opened for writing.
This is the default for file systems to be checked that are
concurrently mounted writable.
.It Fl p
Enter preen mode:
.Nm
will check all file systems listed in
.Xr fstab 5
according to their pass number,
or any special devices listed on the command line,
and will make minor repairs without
human intervention.
Any major problems will cause
.Nm
to exit with a non-zero exit code,
so as to alert any invoking program or script
that human intervention is required.
.It Fl T Ar fstype : Ns Ar fsoptions
List of comma separated file system specific options for the specified
file system type, in the same format as
.Xr mount 8 .
.It Fl t Ar fstype
Invoke
.Nm
only for the comma separated list of file system types.
If the list starts with
.Dq no ,
invoke
.Nm
only in the file system types that are
.Em not
specified in
the list.
.It Fl v
Print the commands before executing them.
.It Fl y
Cause
.Nm
to assume
.Dq yes
as the answer to all operator questions.
.El
.Pp
If neither of the
.Fl y
or
.Fl n
options are specified, the user may force
.Nm
to assume an answer of
.Dq yes
to all the remaining questions by replying to a question with a value of
.Dq F .
.Sh FILES
.Bl -tag -width /etc/fstab -compact
.It Pa /etc/fstab
file system table
.El
.Sh SEE ALSO
.Xr fs 5 ,
.Xr fstab 5 ,
.Xr fsck_ext2fs 8 ,
.Xr fsck_ffs 8 ,
.Xr fsck_msdos 8 ,
.Xr fsdb 8 ,
.Xr growfs 8 ,
.Xr mount 8 ,
.Xr newfs 8 ,
.Xr rc 8 ,
.Xr scan_ffs 8
@


1.33
log
@Intorduce the same -N flag that mount(8) just got to do the same
selection of file systems with option 'net'. Again this will be used
by the rc script to fsck iscsi file systems before mounting them.
Again by default file systems with the net option are ignored when
scanning fstab.
"Get it in" deraadt@@
@
text
@d1 1
a1 1
.\"	$OpenBSD: fsck.8,v 1.32 2013/02/11 17:35:46 jmc Exp $
d31 1
a31 1
.Dd $Mdocdate: February 11 2013 $
d40 1
a40 1
.Op Fl dfnpvy
d107 1
a107 1
.Ar net
d109 1
a109 3
By default file systems with the
.Dq net
option are ignored.
@


1.32
log
@Xr scan_ffs 8; requested by Scott McEachern
@
text
@d1 1
a1 1
.\"	$OpenBSD: fsck.8,v 1.31 2007/05/31 19:19:44 jmc Exp $
d31 1
a31 1
.Dd $Mdocdate: May 31 2007 $
d103 9
@


1.31
log
@convert to new .Dd format;
@
text
@d1 1
a1 1
.\"	$OpenBSD: fsck.8,v 1.30 2007/05/12 17:37:48 fkr Exp $
d31 1
a31 1
.Dd $Mdocdate$
d179 2
a180 1
.Xr rc 8
@


1.30
log
@remove references to mount_vnd.8 and fsck_vnd.8 as these are not hooked
into the build yet.
ok jmc@@
@
text
@d1 1
a1 1
.\"	$OpenBSD: fsck.8,v 1.29 2007/04/14 13:15:25 jmc Exp $
d31 1
a31 1
.Dd September 23, 1996
@


1.29
log
@+.Xr fsck_vnd 8 ,
@
text
@d1 1
a1 1
.\"	$OpenBSD: fsck.8,v 1.28 2006/03/30 01:27:03 pedro Exp $
a174 1
.Xr fsck_vnd 8 ,
@


1.28
log
@Document 'F' as an answer to fsck, okay deraadt@@ jolan@@
@
text
@d1 1
a1 1
.\"	$OpenBSD: fsck.8,v 1.27 2005/11/21 14:27:55 millert Exp $
d175 1
@


1.27
log
@Accept and pass through -b option for fsck_ffs and fsck_ext2fs
OK mickey@@
@
text
@d1 1
a1 1
.\"	$OpenBSD: fsck.8,v 1.26 2005/02/03 05:00:07 jaredy Exp $
d153 11
@


1.26
log
@- simplify, normalize, and sync usage/synopsis forms
- filesystem -> file system, for consistency
- indent sections where applicable
- mdoc, punctuation, grammar, etc. fixes
- document SIGINFO to fsck_ffs
- unify description of -n among documents
- sprinkle xrefs all around
- move parts relevant to fsck.8 from fsck_ffs.8

parts from NetBSD

ok jmc
@
text
@d1 1
a1 1
.\"	$OpenBSD: fsck.8,v 1.25 2005/01/27 19:20:18 jmc Exp $
d41 1
d80 7
@


1.25
log
@remove some overly complex macros;
@
text
@d1 1
a1 1
.\"	$OpenBSD: fsck.8,v 1.24 2005/01/27 19:06:24 jmc Exp $
d36 1
a36 1
.Nd filesystem consistency check and interactive repair
d42 1
a42 5
.Oo Xo
.Fl T
.Ar fstype : Ns Ar fsoptions
.Oc
.Xc
d44 1
a44 1
.Ar special | node ...
d49 1
a49 1
command invokes filesystem-specific programs to check the
d53 24
d86 1
a86 1
Force checking of filesystems, even when they are marked clean (for filesystems
d94 1
a94 1
the disks are checked round-robin, one filesystem at a time.
d96 3
a98 1
Cause
d100 6
a105 6
to assume
.Dq no
as the answer to all operator questions, except
.Dq CONTINUE? .
This is assumed to be the default when dealing with filesystems currently
mounted writeable.
d121 2
a122 2
List of comma separated filesystem specific options for the specified
filesystem type, in the same format as
d127 1
a127 1
only in the comma separated list of filesystem types.
d132 1
a132 1
only in the filesystem types that are
d148 1
a148 1
filesystem table
d151 1
d158 3
a160 1
.Xr mount 8
@


1.24
log
@document what preen mode does;

text from netbsd -r1.20 (tidied up by myself);
pointed out by alexander farber (pr #4076);

ok krw@@ jaredy@@
@
text
@d1 1
a1 1
.\"	$OpenBSD: fsck.8,v 1.23 2004/07/28 21:27:52 jmc Exp $
d44 1
a44 1
.Ar fstype Ns : Ns Ar fsoptions
d98 1
a98 4
.It Xo
.Fl T
.Ar fstype Ns : Ns Ar fsoptions
.Xc
@


1.23
log
@.Xr growfs 8
@
text
@d1 1
a1 1
.\"	$OpenBSD: fsck.8,v 1.22 2004/07/28 21:17:22 jmc Exp $
d85 13
a97 1
Enter preen mode.
@


1.22
log
@- sort options
- sync usage()
- use -keeps for SYNOPSIS
@
text
@d1 1
a1 1
.\"	$OpenBSD: fsck.8,v 1.21 2003/03/06 09:47:18 hugh Exp $
d125 1
@


1.21
log
@Make fsdb(8) a little easier to find with some cross references.
@
text
@d1 1
a1 1
.\"	$OpenBSD: fsck.8,v 1.20 2003/01/31 21:54:40 jmc Exp $
d39 2
a40 1
.Op Fl dvpfny
d42 5
a47 1
.Op Fl T Ar fstype:fsoptions
d49 1
d86 7
d94 3
a96 1
Invoke fsck only in the comma separated list of filesystem types.
d99 3
a101 1
invoke fsck only in the filesystem types that are
a112 4
.It Fl T Ar fstype:fsoptions
List of comma separated filesystem specific options for the specified
filesystem type, in the same format as
.Xr mount 8 .
@


1.20
log
@typos;
eeprom(8): added .Ar to fields, removed references to sun3
sshd(8): help and ok markus@@

help and ok millert@@
@
text
@d1 1
a1 1
.\"	$OpenBSD: fsck.8,v 1.19 2002/10/17 13:15:21 brad Exp $
d111 1
@


1.19
log
@sync usage().
--
Ok'd by: deraadt@@
@
text
@d1 1
a1 1
.\"	$OpenBSD: fsck.8,v 1.18 2001/04/23 15:30:26 aaron Exp $
d50 1
a50 1
file or in the command line for consistency.
d108 1
a109 1
.Xr fsck_ext2fs 8 ,
@


1.18
log
@Various man page fixes and improvements from gluk@@
@
text
@d1 1
a1 1
.\"	$OpenBSD: fsck.8,v 1.17 2000/11/09 17:52:56 aaron Exp $
d39 1
a39 1
.Op Fl dvplfyn
@


1.17
log
@Change all option list specifications to ".Bl -tag -width Ds". Most man
pages just needed their -width parameter tweaked to "Ds", which provides
a nice width of 6 constant characters. For consistency more than anything.
@
text
@d1 1
a1 1
.\"	$OpenBSD: fsck.8,v 1.16 2000/03/18 22:55:56 aaron Exp $
d109 1
@


1.16
log
@Remove hard sentence breaks, and some other cleanup along the way.
@
text
@d1 1
a1 1
.\"	$OpenBSD: fsck.8,v 1.15 1999/06/04 02:45:15 aaron Exp $
d52 1
a52 1
.Bl -tag -width indent
@


1.15
log
@start to remove non-escaped trailing whitespace, it can confuse troff; pjanzen@@
@
text
@d1 1
a1 1
.\"	$OpenBSD: fsck.8,v 1.14 1999/05/28 22:59:58 aaron Exp $
d54 3
a56 2
Debugging mode. Just print the commands without executing them. Available
only if
d66 2
a67 1
disks, running one process per disk. If a smaller limit is given,
d81 2
a82 2
Invoke fsck only in the comma separated list of filesystem types. If the
list starts with
@


1.14
log
@more .El madness
@
text
@d1 1
a1 1
.\"	$OpenBSD: fsck.8,v 1.13 1998/12/15 01:20:30 aaron Exp $
d41 2
a42 2
.Op Fl t Ar fstype 
.Op Fl T Ar fstype:fsoptions 
d47 2
a48 2
command invokes filesystem-specific programs to check the 
special devices listed in the 
d80 1
a80 1
list starts with 
@


1.13
log
@always give .Nm macros an argument in SYNOPSIS sections; krw@@tcn.net
@
text
@d1 1
a1 1
.\"	$OpenBSD: fsck.8,v 1.12 1998/11/28 19:56:19 aaron Exp $
d98 1
@


1.12
log
@kill redundant .Nm macro arguments; other misc fixes
@
text
@d1 1
a1 1
.\"	$OpenBSD: fsck.8,v 1.11 1998/11/11 22:19:56 aaron Exp $
d38 1
a38 1
.Nm
@


1.11
log
@more `` '' -> .Dq sillyness; remove redundant .Pp macros; other misc fixes
@
text
@d1 1
a1 1
.\"	$OpenBSD: fsck.8,v 1.10 1998/10/07 02:57:17 deraadt Exp $
d38 1
a38 1
.Nm fsck
d46 1
a46 1
.Nm fsck
@


1.10
log
@clarify -n; noted by markc@@
@
text
@d1 1
a1 1
.\"	$OpenBSD: fsck.8,v 1.9 1998/09/23 01:20:23 aaron Exp $
d72 2
a73 1
as the answer to all operator questions, except "CONTINUE?".
@


1.9
log
@alphabetize SEE ALSO entries and order them numerically according to section
@
text
@d1 1
a1 1
.\"	$OpenBSD: fsck.8,v 1.8 1998/09/17 04:14:52 aaron Exp $
d73 2
@


1.8
log
@sbin/ man page fixes
@
text
@d1 1
a1 1
.\"	$OpenBSD: fsck.8,v 1.7 1998/08/30 05:41:24 deraadt Exp $
a100 1
.Xr mount 8 ,
d102 1
d104 1
a104 1
.Xr fsck_ffs 8
@


1.7
log
@man page repairs; aaron@@ug.cs.dal.ca
@
text
@d1 1
a1 1
.\"	$OpenBSD: fsck.8,v 1.6 1997/05/19 18:18:23 downsj Exp $
d62 5
a66 4
Limit the number of parallel checks to the number specified in
the following argument. By default, the limit is the number of
disks, running one process per disk. If a smaller limit is giv-
en, the disks are checked round-robin, one filesystem at a time.
d68 1
a68 1
Causes
d70 3
a72 1
to assume no as the answer to all operator questions, except "CONTINUE?".
d78 4
a81 2
.Dq no 
then invoke fsck only in the filesystem types that are not specified in
d86 1
a86 1
Causes
d88 2
a89 1
to assume yes
d94 1
a94 1
.Xr mount 8
@


1.6
log
@s/NetBSD//
@
text
@d1 1
a1 1
.\"	$OpenBSD: fsck.8,v 1.5 1996/12/10 09:06:16 deraadt Exp $
d36 1
a36 1
.Nd file system consistency check and interactive repair
d74 4
a77 2
list starts with no
then invoke fsck the filesystem types that are not specified in the list.
d86 2
a87 2
List of comma separated file system specific options for the specified
file system type, in the same format as
d92 1
a92 1
file system table
@


1.5
log
@"the the" purge
@
text
@d1 1
a1 1
.\"	$OpenBSD: fsck.8,v 1.4 1996/12/04 08:49:05 deraadt Exp $
d33 1
a33 1
.Os NetBSD 1
@


1.4
log
@fix a typo
@
text
@d1 1
a1 1
.\"	$OpenBSD$
d48 1
a48 1
the special devices listed in the 
@


1.3
log
@Sync with NetBSD 961019
@
text
@d75 1
a75 1
then invoke fsck the the filesystem types that are not specified in the list.
@


1.2
log
@sync to netbsd 960418
@
text
@d1 2
a2 1
.\"	$NetBSD: fsck.8,v 1.10 1995/07/12 01:49:16 cgd Exp $
d4 1
a4 2
.\" Copyright (c) 1980, 1989, 1991, 1993
.\"	The Regents of the University of California.  All rights reserved.
d16 3
a18 5
.\"	This product includes software developed by the University of
.\"	California, Berkeley and its contributors.
.\" 4. Neither the name of the University nor the names of its contributors
.\"    may be used to endorse or promote products derived from this software
.\"    without specific prior written permission.
d20 10
a29 11
.\" THIS SOFTWARE IS PROVIDED BY THE REGENTS AND CONTRIBUTORS ``AS IS'' AND
.\" ANY EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT LIMITED TO, THE
.\" IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE
.\" ARE DISCLAIMED.  IN NO EVENT SHALL THE REGENTS OR CONTRIBUTORS BE LIABLE
.\" FOR ANY DIRECT, INDIRECT, INCIDENTAL, SPECIAL, EXEMPLARY, OR CONSEQUENTIAL
.\" DAMAGES (INCLUDING, BUT NOT LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS
.\" OR SERVICES; LOSS OF USE, DATA, OR PROFITS; OR BUSINESS INTERRUPTION)
.\" HOWEVER CAUSED AND ON ANY THEORY OF LIABILITY, WHETHER IN CONTRACT, STRICT
.\" LIABILITY, OR TORT (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY
.\" OUT OF THE USE OF THIS SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF
.\" SUCH DAMAGE.
d31 1
a31 3
.\"	@@(#)fsck.8	8.3 (Berkeley) 11/29/94
.\"
.Dd November 29, 1994
d33 1
a33 1
.Os BSD 4
d36 1
a36 1
.Nd filesystem consistency check and interactive repair
d39 1
a39 7
.Fl p
.Op Fl f
.Op Fl m Ar mode
.Nm fsck
.Op Fl f
.Op Fl b Ar block#
.Op Fl c Ar level
d41 3
a43 5
.Op Fl y
.Op Fl n
.Op Fl m Ar mode
.Op Ar filesystem
.Ar ...
d45 1
a45 54
The first form of
.Nm fsck
preens a standard set of filesystems or the specified filesystems.
It is normally used in the script
.Pa /etc/rc
during automatic reboot.
Here
.Nm fsck
reads the table
.Pa /etc/fstab
to determine which filesystems to check.
Only partitions in fstab that are mounted ``rw,'' ``rq'' or ``ro''
and that have non-zero pass number are checked.
Filesystems with pass number 1 (normally just the root filesystem)
are checked one at a time.
When pass 1 completes, all remaining filesystems are checked,
running one process per disk drive.
The disk drive containing each filesystem is inferred from the longest prefix
of the device name that ends in a digit; the remaining characters are assumed
to be the partition designator.
.Pp
The kernel takes care that only a restricted class of innocuous filesystem
inconsistencies can happen unless hardware or software failures intervene.
These are limited to the following:
.Bl -item -compact
.It
Unreferenced inodes
.It
Link counts in inodes too large
.It
Missing blocks in the free map
.It
Blocks in the free map also in files
.It
Counts in the super-block wrong
.El
.Pp
These are the only inconsistencies that
.Nm fsck
with the
.Fl p
option will correct; if it encounters other inconsistencies, it exits
with an abnormal return status and an automatic reboot will then fail.
For each corrected inconsistency one or more lines will be printed
identifying the filesystem on which the correction will take place,
and the nature of the correction.  After successfully correcting a filesystem,
.Nm fsck
will print the number of files on that filesystem,
the number of used and free blocks,
and the percentage of fragmentation.
.Pp
If sent a
.Dv QUIT
signal,
d47 5
a51 40
will finish the filesystem checks, then exit with an abnormal
return status that causes an automatic reboot to fail.
This is useful when you want to finish the filesystem checks during an
automatic reboot,
but do not want the machine to come up multiuser after the checks complete.
.Pp
Without the
.Fl p
option,
.Nm fsck
audits and interactively repairs inconsistent conditions for filesystems. 
If the filesystem is inconsistent the operator is prompted for concurrence
before each correction is attempted.
It should be noted that some of the corrective actions which are not
correctable under the
.Fl p
option will result in some loss of data.
The amount and severity of data lost may be determined from the diagnostic
output.
The default action for each consistency correction
is to wait for the operator to respond
.Li yes
or
.Li no .
If the operator does not have write permission on the filesystem
.Nm fsck
will default to a 
.Fl n
action.
.Pp
.Nm Fsck
has more consistency checks than
its predecessors
.Em check , dcheck , fcheck ,
and
.Em icheck
combined.
.Pp
The following flags are interpreted by
.Nm fsck .
d53 5
d59 9
a67 4
Force checking of file systems.  Normally, if a file system is cleanly
unmounted, the kernel will set a
.Dq clean flag
in the file system superblock, and
d69 11
a79 1
will not check the file system.  This option forces
d81 6
a86 128
to check the file system, regardless of the state of the clean flag.
.It Fl b
Use the block specified immediately after the flag as
the super block for the filesystem.  Block 32 is usually
an alternate super block.
.It Fl l
Limit the number of parallel checks to the number specified in the following
argument.
By default, the limit is the number of disks, running one process per disk.
If a smaller limit is given, the disks are checked round-robin, one filesystem
at a time.
.It Fl m
Use the mode specified in octal immediately after the flag as the
permission bits to use when creating the
.Pa lost+found
directory rather than the default 1777.
In particular, systems that do not wish to have lost files accessible
by all users on the system should use a more restrictive
set of permissions such as 700.
.It Fl y
Assume a yes response to all questions asked by 
.Nm fsck ;
this should be used with great caution as this is a free license
to continue after essentially unlimited trouble has been encountered.
.It Fl n
Assume a no response to all questions asked by 
.Nm fsck
except for
.Ql CONTINUE? ,
which is assumed to be affirmative;
do not open the filesystem for writing.
.It Fl c
Convert the filesystem to the specified level.
Note that the level of a filesystem can only be raised.
.Bl -tag -width indent
There are currently four levels defined:
.It 0
The filesystem is in the old (static table) format.
.It 1
The filesystem is in the new (dynamic table) format.
.It 2
The filesystem supports 32-bit uid's and gid's,
short symbolic links are stored in the inode, 
and directories have an added field showing the file type.
.It 3
If maxcontig is greater than one,
build the free segment maps to aid in finding contiguous sets of blocks.
If maxcontig is equal to one, delete any existing segment maps.
.El
.Pp
In interactive mode,
.Nm fsck
will list the conversion to be made
and ask whether the conversion should be done.
If a negative answer is given,
no further operations are done on the filesystem.
In preen mode,
the conversion is listed and done if
possible without user interaction.
Conversion in preen mode is best used when all the filesystems
are being converted at once.
The format of a filesystem can be determined from the
first line of output from 
.Xr dumpfs 8 .
.El
.Pp
If no filesystems are given to 
.Nm fsck
then a default list of filesystems is read from
the file
.Pa /etc/fstab .
.Pp
.Bl -enum -indent indent -compact
Inconsistencies checked are as follows:
.It
Blocks claimed by more than one inode or the free map.
.It
Blocks claimed by an inode outside the range of the filesystem.
.It
Incorrect link counts.
.It
Size checks:
.Bl -item -indent indent -compact
.It 
Directory size not a multiple of DIRBLKSIZ.
.It
Partially truncated file.
.El
.It
Bad inode format.
.It
Blocks not accounted for anywhere.
.It
Directory checks:
.Bl -item -indent indent -compact
.It 
File pointing to unallocated inode.
.It
Inode number out of range.
.It
Dot or dot-dot not the first two entries of a directory
or having the wrong inode number.
.El
.It
Super Block checks:
.Bl -item -indent indent -compact
.It 
More blocks for inodes than there are in the filesystem.
.It
Bad free block map format.
.It
Total free block and/or free inode count incorrect.
.El
.El
.Pp
Orphaned files and directories (allocated but unreferenced) are,
with the operator's concurrence, reconnected by
placing them in the 
.Pa lost+found
directory.
The name assigned is the inode number.
If the
.Pa lost+found
directory does not exist, it is created.
If there is insufficient space its size is increased.
.Pp
Because of inconsistencies between the block device and the buffer cache,
the raw device should always be used.
d90 1
a90 1
contains default list of filesystems to check.
a91 7
.Sh DIAGNOSTICS
The diagnostics produced by 
.Nm fsck
are fully enumerated and explained in Appendix A of
.Rs
.%T "Fsck \- The UNIX File System Check Program"
.Re
d93 1
d95 2
a96 5
.Xr fs 5 ,
.Xr fsdb 8 ,
.Xr newfs 8 ,
.Xr mkfs 8 ,
.Xr reboot 8
@


1.1
log
@Initial revision
@
text
@@


1.1.1.1
log
@initial import of NetBSD tree
@
text
@@
