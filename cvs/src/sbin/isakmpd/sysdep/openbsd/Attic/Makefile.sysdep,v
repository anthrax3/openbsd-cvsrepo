head	1.33;
access;
symbols
	OPENBSD_3_7:1.25.0.2
	OPENBSD_3_7_BASE:1.25
	OPENBSD_3_6:1.24.0.2
	OPENBSD_3_6_BASE:1.24
	OPENBSD_3_5:1.22.0.4
	OPENBSD_3_5_BASE:1.22
	OPENBSD_3_4:1.22.0.2
	OPENBSD_3_4_BASE:1.22
	OPENBSD_3_3:1.21.0.4
	OPENBSD_3_3_BASE:1.21
	OPENBSD_3_2:1.21.0.2
	OPENBSD_3_2_BASE:1.21
	OPENBSD_3_1:1.20.0.2
	OPENBSD_3_1_BASE:1.20
	OPENBSD_3_0:1.19.0.2
	OPENBSD_3_0_BASE:1.19
	OPENBSD_2_9:1.17.0.2
	OPENBSD_2_9_BASE:1.17
	OPENBSD_2_8:1.10.0.2
	OPENBSD_2_8_BASE:1.10
	OPENBSD_2_7:1.8.0.2
	OPENBSD_2_7_BASE:1.8
	OPENBSD_2_6:1.7.0.2
	OPENBSD_2_6_BASE:1.7
	OPENBSD_2_5:1.2.0.2
	OPENBSD_2_5_BASE:1.2;
locks; strict;
comment	@# @;


1.33
date	2005.04.08.19.05.15;	author deraadt;	state dead;
branches;
next	1.32;

1.32
date	2005.04.08.18.57.28;	author hshoexer;	state Exp;
branches;
next	1.31;

1.31
date	2005.04.08.17.24.27;	author deraadt;	state Exp;
branches;
next	1.30;

1.30
date	2005.04.08.16.16.43;	author deraadt;	state Exp;
branches;
next	1.29;

1.29
date	2005.04.08.16.14.05;	author deraadt;	state Exp;
branches;
next	1.28;

1.28
date	2005.04.08.16.11.58;	author deraadt;	state Exp;
branches;
next	1.27;

1.27
date	2005.04.08.16.11.11;	author deraadt;	state Exp;
branches;
next	1.26;

1.26
date	2005.04.08.16.09.25;	author deraadt;	state Exp;
branches;
next	1.25;

1.25
date	2004.12.14.10.17.28;	author mcbride;	state Exp;
branches;
next	1.24;

1.24
date	2004.06.26.03.40.57;	author mcbride;	state Exp;
branches;
next	1.23;

1.23
date	2004.03.31.10.47.16;	author ho;	state Exp;
branches;
next	1.22;

1.22
date	2003.06.03.14.53.11;	author ho;	state Exp;
branches;
next	1.21;

1.21
date	2002.06.10.18.08.59;	author ho;	state Exp;
branches;
next	1.20;

1.20
date	2002.03.05.00.11.23;	author deraadt;	state Exp;
branches;
next	1.19;

1.19
date	2001.08.13.14.33.35;	author itojun;	state Exp;
branches;
next	1.18;

1.18
date	2001.06.29.19.40.36;	author ho;	state Exp;
branches;
next	1.17;

1.17
date	2001.04.09.21.21.58;	author ho;	state Exp;
branches;
next	1.16;

1.16
date	2001.02.12.21.37.21;	author ho;	state Exp;
branches;
next	1.15;

1.15
date	2001.01.27.12.03.39;	author niklas;	state Exp;
branches;
next	1.14;

1.14
date	2001.01.27.11.24.45;	author niklas;	state Exp;
branches;
next	1.13;

1.13
date	2001.01.26.11.09.22;	author niklas;	state Exp;
branches;
next	1.12;

1.12
date	2000.12.29.03.13.07;	author smurph;	state Exp;
branches;
next	1.11;

1.11
date	2000.12.12.01.45.08;	author niklas;	state Exp;
branches;
next	1.10;

1.10
date	2000.10.16.23.26.44;	author niklas;	state Exp;
branches
	1.10.2.1;
next	1.9;

1.9
date	2000.10.07.06.59.32;	author niklas;	state Exp;
branches;
next	1.8;

1.8
date	2000.04.07.22.10.40;	author niklas;	state Exp;
branches;
next	1.7;

1.7
date	99.08.26.22.32.03;	author niklas;	state Exp;
branches;
next	1.6;

1.6
date	99.07.17.22.07.31;	author niklas;	state Exp;
branches;
next	1.5;

1.5
date	99.07.17.21.54.39;	author niklas;	state Exp;
branches;
next	1.4;

1.4
date	99.07.07.22.05.48;	author niklas;	state Exp;
branches;
next	1.3;

1.3
date	99.04.19.21.03.02;	author niklas;	state Exp;
branches;
next	1.2;

1.2
date	99.03.31.00.50.05;	author niklas;	state Exp;
branches;
next	1.1;

1.1
date	99.03.02.15.06.13;	author niklas;	state Exp;
branches;
next	;

1.10.2.1
date	2001.05.08.12.45.29;	author ho;	state Exp;
branches;
next	;


desc
@@


1.33
log
@remove more conditional crud
@
text
@#	$OpenBSD: Makefile.sysdep,v 1.32 2005/04/08 18:57:28 hshoexer Exp $
#	$EOM: Makefile.sysdep,v 1.18 2001/01/26 10:55:22 niklas Exp $

#
# Copyright (c) 1999, 2000, 2001 Niklas Hallqvist.  All rights reserved.
#
# Redistribution and use in source and binary forms, with or without
# modification, are permitted provided that the following conditions
# are met:
# 1. Redistributions of source code must retain the above copyright
#    notice, this list of conditions and the following disclaimer.
# 2. Redistributions in binary form must reproduce the above copyright
#    notice, this list of conditions and the following disclaimer in the
#    documentation and/or other materials provided with the distribution.
#
# THIS SOFTWARE IS PROVIDED BY THE AUTHOR ``AS IS'' AND ANY EXPRESS OR
# IMPLIED WARRANTIES, INCLUDING, BUT NOT LIMITED TO, THE IMPLIED WARRANTIES
# OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE ARE DISCLAIMED.
# IN NO EVENT SHALL THE AUTHOR BE LIABLE FOR ANY DIRECT, INDIRECT,
# INCIDENTAL, SPECIAL, EXEMPLARY, OR CONSEQUENTIAL DAMAGES (INCLUDING, BUT
# NOT LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES; LOSS OF USE,
# DATA, OR PROFITS; OR BUSINESS INTERRUPTION) HOWEVER CAUSED AND ON ANY
# THEORY OF LIABILITY, WHETHER INN CONTRACT, STRICT LIABILITY, OR TORT
# (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE USE OF
# THIS SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.
#

#
# This code was written under funding by Ericsson Radio Systems.
#

IPSEC_SRCS=	pf_key_v2.c
IPSEC_CFLAGS=	-DUSE_PF_KEY_V2
@


1.32
log
@zap USE_DEFAULT_ROUTE
@
text
@d1 1
a1 1
#	$OpenBSD: Makefile.sysdep,v 1.31 2005/04/08 17:24:27 deraadt Exp $
@


1.31
log
@old static lib stuff is not even needed...
@
text
@d1 1
a1 1
#	$OpenBSD: Makefile.sysdep,v 1.30 2005/04/08 16:16:43 deraadt Exp $
d33 1
a33 1
IPSEC_CFLAGS=	-DUSE_PF_KEY_V2 -DUSE_DEFAULT_ROUTE
@


1.30
log
@the lovely thing about layers and layers of compatible stuff, is that
deep down in the guts of it assumptions such as "this particular processors
has no shared libraries yet" get hidden, only to be found about 2 years
later.  i hate code that hides stuff like that from me.
@
text
@d1 1
a1 1
#	$OpenBSD: Makefile.sysdep,v 1.29 2005/04/08 16:14:05 deraadt Exp $
a33 9

.ifdef FEATURES
.if ${FEATURES:Mpolicy} == "policy"
.if ${MACHINE_ARCH} != "vax" && ${MACHINE_ARCH} != "m88k"
POLICY+=	keynote_compat.c
.endif
USE_KEYNOTE=	defined
.endif
.endif
@


1.29
log
@kill HAVE_PCAP
@
text
@d1 1
a1 1
#	$OpenBSD: Makefile.sysdep,v 1.28 2005/04/08 16:11:58 deraadt Exp $
d37 1
a37 1
.if ${MACHINE_ARCH} != "alpha" && ${MACHINE_ARCH} != "vax" && ${MACHINE_ARCH} != "m88k"
@


1.28
log
@kill HAVE_CLOSEFROM
@
text
@d1 1
a1 1
#	$OpenBSD: Makefile.sysdep,v 1.27 2005/04/08 16:11:11 deraadt Exp $
a33 2

CFLAGS+=	-DHAVE_PCAP
@


1.27
log
@kill HAVE_GETIFADDRS
@
text
@d1 1
a1 1
#	$OpenBSD: Makefile.sysdep,v 1.26 2005/04/08 16:09:25 deraadt Exp $
a35 1
CFLAGS+=	-DHAVE_CLOSEFROM
@


1.26
log
@kill USE_OLD_SOCKADDR
@
text
@d1 1
a1 1
#	$OpenBSD: Makefile.sysdep,v 1.25 2004/12/14 10:17:28 mcbride Exp $
d35 1
a35 1
CFLAGS+=	-DHAVE_GETIFADDRS -DHAVE_PCAP
@


1.25
log
@Allow the Address, Network, or Netmask values of the <IPsec-ID> to be
specified with an interface name (in which case the first address is used)
or the keyword 'default' (in which case the address is selected based on the
default route). eg:

[roadwarrior-ip]
ID-type=                IPV4_ADDR
Address=                default

ok ho@@ hshoexer@@
@
text
@d1 1
a1 1
#	$OpenBSD: Makefile.sysdep,v 1.24 2004/06/26 03:40:57 mcbride Exp $
a37 2
USE_LIBCRYPTO=	defined

a44 5
.endif

.ifndef USE_LIBCRYPTO
DESLIB=		-ldes
DESLIBDEP=	${LIBDES}
@


1.24
log
@Remove -DHAVE_GETNAMEINFO frome makefiles.

Pointed out by ho@@
@
text
@d1 1
a1 1
#	$OpenBSD: Makefile.sysdep,v 1.23 2004/03/31 10:47:16 ho Exp $
d33 1
a33 1
IPSEC_CFLAGS=	-DUSE_PF_KEY_V2
@


1.23
log
@Don't assume closefrom(2) exists everywhere. hshoexer@@, markus@@ ok.
@
text
@d1 1
a1 1
#	$OpenBSD: Makefile.sysdep,v 1.22 2003/06/03 14:53:11 ho Exp $
d35 1
a35 1
CFLAGS+=	-DHAVE_GETNAMEINFO -DHAVE_GETIFADDRS -DHAVE_PCAP
@


1.22
log
@Remove clauses 3 and 4. Approved by markus@@ and niklas@@.
@
text
@d1 1
a1 1
#	$OpenBSD: Makefile.sysdep,v 1.21 2002/06/10 18:08:59 ho Exp $
d36 1
@


1.21
log
@The dlopen() stuff goes away.
@
text
@d1 1
a1 1
#	$OpenBSD: Makefile.sysdep,v 1.20 2002/03/05 00:11:23 deraadt Exp $
a14 5
# 3. All advertising materials mentioning features or use of this software
#    must display the following acknowledgement:
#	This product includes software developed by Ericsson Radio Systems.
# 4. The name of the author may not be used to endorse or promote products
#    derived from this software without specific prior written permission.
@


1.20
log
@-Werror not possible, because of openssl constification.  thanks guys
@
text
@d1 1
a1 1
#	$OpenBSD: Makefile.sysdep,v 1.19 2001/08/13 14:33:35 itojun Exp $
a40 6

# Some OpenBSD systems do not provide dlopen(3).
#.if ${MACHINE_ARCH} != "alpha" && ${MACHINE_ARCH} != "mips" && ${MACHINE_ARCH} != "powerpc" && ${MACHINE_ARCH} != "vax" && ${MACHINE_ARCH} != "m88k"
#HAVE_DLOPEN=	defined
#CFLAGS+=	-DSYMBOL_PREFIX='"_"'
#.endif
@


1.19
log
@use getifaddrs(3) rather than SIOCGIFCONF.  in fact, if_map() does not do
the right thing on certain set of interface addresses.  SIOCGIFCONF is
the worst possible ioctl API...
@
text
@d1 1
a1 1
#	$OpenBSD: Makefile.sysdep,v 1.18 2001/06/29 19:40:36 ho Exp $
d40 1
a40 1
CFLAGS+=	-Werror -DHAVE_GETNAMEINFO -DHAVE_GETIFADDRS -DHAVE_PCAP
@


1.18
log
@On OpenBSD, we want -Werror.
@
text
@d1 1
a1 1
#	$OpenBSD: Makefile.sysdep,v 1.17 2001/04/09 21:21:58 ho Exp $
d40 1
a40 1
CFLAGS+=	-Werror -DHAVE_GETNAMEINFO -DHAVE_PCAP
@


1.17
log
@isakmpd can now capture un-encrypted IKE negotiation packets to a
file. In pcap(3) format, so tcpdump(8) can read it.
Idea by Tim Newsham <newsham@@lava.net>, work by him and me.
Ok angelos@@, niklas@@
@
text
@d1 1
a1 1
#	$OpenBSD: Makefile.sysdep,v 1.16 2001/02/12 21:37:21 ho Exp $
d40 1
a40 1
CFLAGS+=	-DHAVE_GETNAMEINFO -DHAVE_PCAP
@


1.16
log
@Temporarily disable dlopen() support, some issues with latest OpenSSL update.
@
text
@d1 1
a1 1
#	$OpenBSD: Makefile.sysdep,v 1.15 2001/01/27 12:03:39 niklas Exp $
d40 1
a40 1
CFLAGS+=	-DHAVE_GETNAMEINFO
@


1.15
log
@(c) 2001
@
text
@d1 1
a1 1
#	$OpenBSD: Makefile.sysdep,v 1.14 2001/01/27 11:24:45 niklas Exp $
d43 4
a46 4
.if ${MACHINE_ARCH} != "alpha" && ${MACHINE_ARCH} != "mips" && ${MACHINE_ARCH} != "powerpc" && ${MACHINE_ARCH} != "vax" && ${MACHINE_ARCH} != "m88k"
HAVE_DLOPEN=	defined
CFLAGS+=	-DSYMBOL_PREFIX='"_"'
.endif
@


1.14
log
@Cleanup the MP_FLAVOUR situation.  Still needs work.
@
text
@d1 1
a1 1
#	$OpenBSD: Makefile.sysdep,v 1.13 2001/01/26 11:09:22 niklas Exp $
d5 1
a5 1
# Copyright (c) 1999, 2000 Niklas Hallqvist.  All rights reserved.
@


1.13
log
@Merge with EOM 1.18

author: niklas
Sync with OpenBSD changes by smurph
@
text
@d1 1
a1 1
#	$OpenBSD: Makefile.sysdep,v 1.12 2000/12/29 03:13:07 smurph Exp $
d53 1
a53 1
SRCS+=		keynote_compat.c
@


1.12
log
@correct m88k definitions.
@
text
@d1 2
a2 2
#	$OpenBSD: Makefile.sysdep,v 1.11 2000/12/12 01:45:08 niklas Exp $
#	$EOM: Makefile.sysdep,v 1.17 2000/12/12 01:18:11 niklas Exp $
@


1.11
log
@Merge with EOM 1.17

author: niklas
Do not try to deal with weak syms on archs that do not have shlibs
@
text
@d1 1
a1 1
#	$OpenBSD: Makefile.sysdep,v 1.10 2000/10/16 23:26:44 niklas Exp $
d43 1
a43 1
.if ${MACHINE_ARCH} != "alpha" && ${MACHINE_ARCH} != "mips" && ${MACHINE_ARCH} != "powerpc" && ${MACHINE_ARCH} != "vax"
d52 1
a52 1
.if ${MACHINE_ARCH} != "alpha" && ${MACHINE_ARCH} != "vax" && ${MACHINE_ARCH} != "mvme88k"
@


1.10
log
@Merge with EOM 1.16

author: niklas
conditionalize getnaminfo and add weak keynote syms

author: niklas
Add weak aliases for keynote symbols that have not always been there
@
text
@d1 2
a2 2
#	$OpenBSD: Makefile.sysdep,v 1.9 2000/10/07 06:59:32 niklas Exp $
#	$EOM: Makefile.sysdep,v 1.16 2000/10/15 19:58:40 niklas Exp $
d52 1
d54 1
@


1.10.2.1
log
@Pull in isakmpd from 2.9 to 2.8 branch.
@
text
@d1 2
a2 2
#	$OpenBSD: Makefile.sysdep,v 1.17 2001/04/09 21:21:58 ho Exp $
#	$EOM: Makefile.sysdep,v 1.18 2001/01/26 10:55:22 niklas Exp $
d5 1
a5 1
# Copyright (c) 1999, 2000, 2001 Niklas Hallqvist.  All rights reserved.
d40 1
a40 1
CFLAGS+=	-DHAVE_GETNAMEINFO -DHAVE_PCAP
d43 4
a46 4
#.if ${MACHINE_ARCH} != "alpha" && ${MACHINE_ARCH} != "mips" && ${MACHINE_ARCH} != "powerpc" && ${MACHINE_ARCH} != "vax" && ${MACHINE_ARCH} != "m88k"
#HAVE_DLOPEN=	defined
#CFLAGS+=	-DSYMBOL_PREFIX='"_"'
#.endif
d52 1
a52 3
.if ${MACHINE_ARCH} != "alpha" && ${MACHINE_ARCH} != "vax" && ${MACHINE_ARCH} != "m88k"
POLICY+=	keynote_compat.c
.endif
@


1.9
log
@Merge with EOM 1.14

author: ho
Add USE_KEYNOTE if policy feature is active
@
text
@d1 2
a2 2
#	$OpenBSD: Makefile.sysdep,v 1.8 2000/04/07 22:10:40 niklas Exp $
#	$EOM: Makefile.sysdep,v 1.14 2000/09/12 16:31:22 ho Exp $
d40 2
d52 1
@


1.8
log
@Merge with EOM 1.13

author: niklas
(c) 2000

author: niklas
FEATURES does not belong here, and let GMP go

author: ho
Add FEATURES definition, fix comment.
@
text
@d1 2
a2 2
#	$OpenBSD: Makefile.sysdep,v 1.7 1999/08/26 22:32:03 niklas Exp $
#	$EOM: Makefile.sysdep,v 1.13 2000/04/07 22:05:57 niklas Exp $
d47 3
d51 2
@


1.7
log
@Merge with EOM 1.10

author: niklas
Recognize systems without dlopen(3).  Enable keynote.

author: angelos
I shouldn't turn KeyNote on by default for everyone -- that's someone
else's decision (although we should, as soon as I've tested the X509
case).

author: angelos
Complete policy work; tested for the shared-key case. Documentation needed.

author: niklas
Add support for dynamic loading of optional facilities, libcrypto first.
@
text
@d1 2
a2 2
#	$OpenBSD: Makefile.sysdep,v 1.6 1999/07/17 22:07:31 niklas Exp $
#	$EOM: Makefile.sysdep,v 1.10 1999/08/26 11:40:48 niklas Exp $
d5 1
a5 1
# Copyright (c) 1999 Niklas Hallqvist.  All rights reserved.
a35 3

LDADD+=		-lgmp
DPADD+=		${LIBGMP}
@


1.6
log
@Merge with EOM 1.6

author: niklas
libdes not needed anymore
@
text
@d1 2
a2 2
#	$OpenBSD: Makefile.sysdep,v 1.5 1999/07/17 21:54:39 niklas Exp $
#	$EOM: Makefile.sysdep,v 1.6 1999/07/17 22:10:49 niklas Exp $
d37 2
a38 2
LDADD+=		-lgmp -lcrypto
DPADD+=		${LIBGMP} ${LIBCRYPTO}
d40 2
a41 2
SRCS+=		pf_key_v2.c
CFLAGS+=	-DUSE_PF_KEY_V2
d43 5
a47 1
USE_KEYNOTE=	yes
d49 2
a50 3
.ifdef USE_KEYNOTE
LDADD+=		-lkeynote -lcrypto -lm
#DPADD+=	
d52 3
a54 2
SRCS+=		policy.c
CFLAGS+=	-DUSE_KEYNOTE
a55 1

@


1.5
log
@regress/rsakeygen/Makefile: Merge with EOM 1.4
regress/rsakeygen/rsakeygen.c: Merge with EOM 1.8
regress/x509/Makefile: Merge with EOM 1.6
regress/x509/x509test.c: Merge with EOM 1.6
regress/Makefile: Merge with EOM 1.8
samples/VPN-east.conf: Merge with EOM 1.6
samples/VPN-west.conf: Merge with EOM 1.6
samples/singlehost-east.conf: Merge with EOM 1.3
samples/singlehost-west.conf: Merge with EOM 1.3
sysdep/openbsd/Makefile.sysdep: Merge with EOM 1.5
x509.h: Merge with EOM 1.6
x509.c: Merge with EOM 1.17
DESIGN-NOTES: Merge with EOM 1.46
Makefile: Merge with EOM 1.55
cert.c: Merge with EOM 1.11
cert.h: Merge with EOM 1.6
exchange.c: Merge with EOM 1.109
exchange.h: Merge with EOM 1.26
ike_auth.c: Merge with EOM 1.32
ike_phase_1.c: Merge with EOM 1.7
init.c: Merge with EOM 1.16
isakmpd.conf.5: Merge with EOM 1.27
README.PKI: Merge with EOM 1.1

author: niklas
From Niels Provos, edited by me: certificate support using SSLeay
@
text
@d1 2
a2 2
#	$OpenBSD: Makefile.sysdep,v 1.4 1999/07/07 22:05:48 niklas Exp $
#	$EOM: Makefile.sysdep,v 1.5 1999/07/17 20:44:16 niklas Exp $
d37 2
a38 2
LDADD+=		-lgmp -ldes -lcrypto
DPADD+=		${LIBGMP} ${LIBDES} ${LIBCRYPTO}
@


1.4
log
@Merge with EOM 1.4

author: ho
branches:  1.4.2;
Add USE_KEYNOTE
@
text
@d1 2
a2 2
#	$OpenBSD: Makefile.sysdep,v 1.3 1999/04/19 21:03:02 niklas Exp $
#	$EOM: Makefile.sysdep,v 1.4 1999/06/07 00:02:49 ho Exp $
d28 1
a28 1
# THEORY OF LIABILITY, WHETHER IN CONTRACT, STRICT LIABILITY, OR TORT
d37 2
a38 2
LDADD+=		-lgmp -ldes
DPADD+=		${LIBGMP} ${LIBDES}
@


1.3
log
@./sysdep/openbsd/Makefile.sysdep: Merge with EOM 1.3

Make PF_ENCAP and PF_KEY versions of OpenBSD support separated through the OS
make variable of the top Makefile.
@
text
@d1 2
a2 2
#	$OpenBSD: Makefile.sysdep,v 1.2 1999/03/31 00:50:05 niklas Exp $
#	$EOM: Makefile.sysdep,v 1.3 1999/04/13 09:03:39 niklas Exp $
d42 11
@


1.2
log
@Merge with EOM 1.2
Append to LDADD and DPADD, not replace
@
text
@d1 2
a2 2
#	$OpenBSD: Makefile.sysdep,v 1.1 1999/03/02 15:06:13 niklas Exp $
#	$EOM: Makefile.sysdep,v 1.2 1999/03/30 21:47:23 niklas Exp $
d39 3
@


1.1
log
@Makefile: Merge with EOM 1.43
Makefile.inc -> Makefile.sysdep

Make SUBDIR changeable by the OS support

sysdep/openbsd/Makefile.sysdep: Merge with EOM 1.1
Makefile.inc -> Makefile.sysdep
@
text
@d1 2
a2 2
#	$OpenBSD: Makefile.sysdep,v 1.1 1999/03/02 14:27:10 niklas Exp $
#	$EOM: Makefile.sysdep,v 1.1 1999/03/02 14:27:10 niklas Exp $
d37 2
a38 2
LDADD=		-lgmp -ldes
DPADD=		${LIBGMP} ${LIBDES}
@

