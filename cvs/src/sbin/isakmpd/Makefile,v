head	1.85;
access;
symbols
	OPENBSD_6_1:1.85.0.2
	OPENBSD_6_1_BASE:1.85
	OPENBSD_6_0:1.84.0.12
	OPENBSD_6_0_BASE:1.84
	OPENBSD_5_9:1.84.0.8
	OPENBSD_5_9_BASE:1.84
	OPENBSD_5_8:1.84.0.10
	OPENBSD_5_8_BASE:1.84
	OPENBSD_5_7:1.84.0.2
	OPENBSD_5_7_BASE:1.84
	OPENBSD_5_6:1.84.0.6
	OPENBSD_5_6_BASE:1.84
	OPENBSD_5_5:1.84.0.4
	OPENBSD_5_5_BASE:1.84
	OPENBSD_5_4:1.83.0.4
	OPENBSD_5_4_BASE:1.83
	OPENBSD_5_3:1.83.0.2
	OPENBSD_5_3_BASE:1.83
	OPENBSD_5_2:1.82.0.8
	OPENBSD_5_2_BASE:1.82
	OPENBSD_5_1_BASE:1.82
	OPENBSD_5_1:1.82.0.6
	OPENBSD_5_0:1.82.0.4
	OPENBSD_5_0_BASE:1.82
	OPENBSD_4_9:1.82.0.2
	OPENBSD_4_9_BASE:1.82
	OPENBSD_4_8:1.81.0.2
	OPENBSD_4_8_BASE:1.81
	OPENBSD_4_7:1.80.0.8
	OPENBSD_4_7_BASE:1.80
	OPENBSD_4_6:1.80.0.10
	OPENBSD_4_6_BASE:1.80
	OPENBSD_4_5:1.80.0.6
	OPENBSD_4_5_BASE:1.80
	OPENBSD_4_4:1.80.0.4
	OPENBSD_4_4_BASE:1.80
	OPENBSD_4_3:1.80.0.2
	OPENBSD_4_3_BASE:1.80
	OPENBSD_4_2:1.79.0.2
	OPENBSD_4_2_BASE:1.79
	OPENBSD_4_1:1.78.0.4
	OPENBSD_4_1_BASE:1.78
	OPENBSD_4_0:1.78.0.2
	OPENBSD_4_0_BASE:1.78
	OPENBSD_3_9:1.77.0.4
	OPENBSD_3_9_BASE:1.77
	OPENBSD_3_8:1.77.0.2
	OPENBSD_3_8_BASE:1.77
	OPENBSD_3_7:1.58.0.2
	OPENBSD_3_7_BASE:1.58
	OPENBSD_3_6:1.57.0.2
	OPENBSD_3_6_BASE:1.57
	OPENBSD_3_5:1.51.0.2
	OPENBSD_3_5_BASE:1.51
	OPENBSD_3_4:1.50.0.2
	OPENBSD_3_4_BASE:1.50
	OPENBSD_3_3:1.46.0.4
	OPENBSD_3_3_BASE:1.46
	OPENBSD_3_2:1.46.0.2
	OPENBSD_3_2_BASE:1.46
	OPENBSD_3_1:1.45.0.2
	OPENBSD_3_1_BASE:1.45
	OPENBSD_3_0:1.44.0.2
	OPENBSD_3_0_BASE:1.44
	OPENBSD_2_9:1.34.0.2
	OPENBSD_2_9_BASE:1.34
	OPENBSD_2_8:1.29.0.2
	OPENBSD_2_8_BASE:1.29
	OPENBSD_2_7:1.27.0.2
	OPENBSD_2_7_BASE:1.27
	OPENBSD_2_6:1.22.0.2
	OPENBSD_2_6_BASE:1.22
	OPENBSD_2_5:1.12.0.2
	OPENBSD_2_5_BASE:1.12
	NIKLAS_981114:1.1.1.1
	NIKLAS:1.1.1;
locks; strict;
comment	@# @;


1.85
date	2016.09.03.23.14.56;	author deraadt;	state Exp;
branches;
next	1.84;
commitid	IUZmvkoiFygDkb4W;

1.84
date	2014.01.22.03.09.31;	author deraadt;	state Exp;
branches;
next	1.83;

1.83
date	2012.12.21.08.50.27;	author espie;	state Exp;
branches;
next	1.82;

1.82
date	2010.10.15.10.18.42;	author jsg;	state Exp;
branches;
next	1.81;

1.81
date	2010.06.29.19.50.16;	author reyk;	state Exp;
branches;
next	1.80;

1.80
date	2008.01.29.00.47.08;	author espie;	state Exp;
branches;
next	1.79;

1.79
date	2007.05.23.07.28.15;	author hshoexer;	state Exp;
branches;
next	1.78;

1.78
date	2006.07.02.13.19.00;	author hshoexer;	state Exp;
branches;
next	1.77;

1.77
date	2005.05.18.20.15.22;	author hshoexer;	state Exp;
branches;
next	1.76;

1.76
date	2005.04.08.21.09.36;	author deraadt;	state Exp;
branches;
next	1.75;

1.75
date	2005.04.08.20.04.57;	author hshoexer;	state Exp;
branches;
next	1.74;

1.74
date	2005.04.08.19.40.02;	author deraadt;	state Exp;
branches;
next	1.73;

1.73
date	2005.04.08.19.19.39;	author hshoexer;	state Exp;
branches;
next	1.72;

1.72
date	2005.04.08.19.08.23;	author deraadt;	state Exp;
branches;
next	1.71;

1.71
date	2005.04.08.19.05.15;	author deraadt;	state Exp;
branches;
next	1.70;

1.70
date	2005.04.08.18.27.09;	author hshoexer;	state Exp;
branches;
next	1.69;

1.69
date	2005.04.08.17.20.44;	author hshoexer;	state Exp;
branches;
next	1.68;

1.68
date	2005.04.08.17.15.01;	author deraadt;	state Exp;
branches;
next	1.67;

1.67
date	2005.04.08.17.03.04;	author deraadt;	state Exp;
branches;
next	1.66;

1.66
date	2005.04.08.16.52.41;	author deraadt;	state Exp;
branches;
next	1.65;

1.65
date	2005.04.08.16.41.54;	author deraadt;	state Exp;
branches;
next	1.64;

1.64
date	2005.04.08.16.37.14;	author deraadt;	state Exp;
branches;
next	1.63;

1.63
date	2005.04.08.16.30.03;	author hshoexer;	state Exp;
branches;
next	1.62;

1.62
date	2005.04.08.16.06.25;	author deraadt;	state Exp;
branches;
next	1.61;

1.61
date	2005.04.08.15.49.10;	author deraadt;	state Exp;
branches;
next	1.60;

1.60
date	2005.04.05.21.07.35;	author hshoexer;	state Exp;
branches;
next	1.59;

1.59
date	2005.04.05.20.46.20;	author cloder;	state Exp;
branches;
next	1.58;

1.58
date	2004.11.10.22.07.46;	author drahn;	state Exp;
branches;
next	1.57;

1.57
date	2004.08.23.11.16.49;	author ho;	state Exp;
branches;
next	1.56;

1.56
date	2004.07.30.10.45.27;	author ho;	state Exp;
branches;
next	1.55;

1.55
date	2004.06.23.01.17.29;	author ho;	state Exp;
branches;
next	1.54;

1.54
date	2004.06.21.23.28.18;	author ho;	state Exp;
branches;
next	1.53;

1.53
date	2004.06.20.15.24.05;	author ho;	state Exp;
branches;
next	1.52;

1.52
date	2004.04.07.22.43.14;	author ho;	state Exp;
branches;
next	1.51;

1.51
date	2004.03.19.14.04.43;	author hshoexer;	state Exp;
branches;
next	1.50;

1.50
date	2003.08.28.14.43.35;	author markus;	state Exp;
branches;
next	1.49;

1.49
date	2003.06.03.14.28.16;	author ho;	state Exp;
branches;
next	1.48;

1.48
date	2003.05.15.00.28.53;	author ho;	state Exp;
branches;
next	1.47;

1.47
date	2003.05.14.20.49.36;	author ho;	state Exp;
branches;
next	1.46;

1.46
date	2002.06.10.18.08.58;	author ho;	state Exp;
branches;
next	1.45;

1.45
date	2002.03.05.00.10.56;	author deraadt;	state Exp;
branches;
next	1.44;

1.44
date	2001.08.25.22.22.26;	author niklas;	state Exp;
branches;
next	1.43;

1.43
date	2001.08.16.18.55.33;	author jakob;	state Exp;
branches;
next	1.42;

1.42
date	2001.08.15.09.16.29;	author ho;	state Exp;
branches;
next	1.41;

1.41
date	2001.07.06.09.35.57;	author ho;	state Exp;
branches;
next	1.40;

1.40
date	2001.07.05.12.38.04;	author ho;	state Exp;
branches;
next	1.39;

1.39
date	2001.07.01.20.43.39;	author niklas;	state Exp;
branches;
next	1.38;

1.38
date	2001.05.31.20.21.37;	author angelos;	state Exp;
branches;
next	1.37;

1.37
date	2001.05.21.11.19.22;	author ho;	state Exp;
branches;
next	1.36;

1.36
date	2001.05.07.22.55.37;	author espie;	state Exp;
branches;
next	1.35;

1.35
date	2001.05.07.22.14.31;	author espie;	state Exp;
branches;
next	1.34;

1.34
date	2001.03.23.16.14.34;	author markus;	state Exp;
branches;
next	1.33;

1.33
date	2001.03.22.15.16.44;	author markus;	state Exp;
branches;
next	1.32;

1.32
date	2001.02.24.04.42.47;	author angelos;	state Exp;
branches;
next	1.31;

1.31
date	2001.01.27.12.03.31;	author niklas;	state Exp;
branches;
next	1.30;

1.30
date	2001.01.26.21.49.36;	author ho;	state Exp;
branches;
next	1.29;

1.29
date	2000.10.16.23.28.32;	author niklas;	state Exp;
branches
	1.29.2.1;
next	1.28;

1.28
date	2000.10.07.06.57.16;	author niklas;	state Exp;
branches;
next	1.27;

1.27
date	2000.05.02.14.36.37;	author niklas;	state Exp;
branches;
next	1.26;

1.26
date	2000.04.07.22.06.28;	author niklas;	state Exp;
branches;
next	1.25;

1.25
date	2000.02.25.17.23.38;	author niklas;	state Exp;
branches;
next	1.24;

1.24
date	2000.02.19.19.31.32;	author niklas;	state Exp;
branches;
next	1.23;

1.23
date	2000.01.26.15.21.49;	author niklas;	state Exp;
branches;
next	1.22;

1.22
date	99.10.16.20.09.22;	author angelos;	state Exp;
branches;
next	1.21;

1.21
date	99.10.16.20.07.18;	author angelos;	state Exp;
branches;
next	1.20;

1.20
date	99.08.26.22.29.19;	author niklas;	state Exp;
branches;
next	1.19;

1.19
date	99.07.17.21.54.39;	author niklas;	state Exp;
branches;
next	1.18;

1.18
date	99.07.07.22.07.33;	author niklas;	state Exp;
branches;
next	1.17;

1.17
date	99.05.01.22.56.54;	author niklas;	state Exp;
branches;
next	1.16;

1.16
date	99.05.01.20.43.41;	author niklas;	state Exp;
branches;
next	1.15;

1.15
date	99.04.20.12.22.18;	author niklas;	state Exp;
branches;
next	1.14;

1.14
date	99.04.20.11.33.15;	author niklas;	state Exp;
branches;
next	1.13;

1.13
date	99.04.19.21.00.19;	author niklas;	state Exp;
branches;
next	1.12;

1.12
date	99.03.24.16.01.24;	author niklas;	state Exp;
branches;
next	1.11;

1.11
date	99.03.02.15.06.12;	author niklas;	state Exp;
branches;
next	1.10;

1.10
date	99.02.26.03.30.00;	author niklas;	state Exp;
branches;
next	1.9;

1.9
date	98.12.22.02.09.46;	author niklas;	state Exp;
branches;
next	1.8;

1.8
date	98.12.22.02.03.32;	author niklas;	state Exp;
branches;
next	1.7;

1.7
date	98.12.21.01.02.22;	author niklas;	state Exp;
branches;
next	1.6;

1.6
date	98.11.17.11.10.06;	author niklas;	state Exp;
branches;
next	1.5;

1.5
date	98.11.16.21.07.13;	author niklas;	state Exp;
branches;
next	1.4;

1.4
date	98.11.16.12.30.59;	author niklas;	state Exp;
branches;
next	1.3;

1.3
date	98.11.15.01.01.29;	author niklas;	state Exp;
branches;
next	1.2;

1.2
date	98.11.15.00.43.47;	author niklas;	state Exp;
branches;
next	1.1;

1.1
date	98.11.15.00.03.48;	author niklas;	state Exp;
branches
	1.1.1.1;
next	;

1.1.1.1
date	98.11.15.00.03.48;	author niklas;	state Exp;
branches;
next	;

1.29.2.1
date	2001.05.08.12.45.21;	author ho;	state Exp;
branches;
next	;


desc
@@


1.85
log
@A commented block starts with
    # If you have ElectricFence available, you can spot abuses of the heap."
Or, uhm you can simply use our malloc.
@
text
@#	$OpenBSD: Makefile,v 1.84 2014/01/22 03:09:31 deraadt Exp $
#	$EOM: Makefile,v 1.78 2000/10/15 21:33:42 niklas Exp $

#
# Copyright (c) 1998, 1999, 2000, 2001 Niklas Hallqvist.  All rights reserved.
# Copyright (c) 2000, 2001 Håkan Olsson.  All rights reserved.
#
# Redistribution and use in source and binary forms, with or without
# modification, are permitted provided that the following conditions
# are met:
# 1. Redistributions of source code must retain the above copyright
#    notice, this list of conditions and the following disclaimer.
# 2. Redistributions in binary form must reproduce the above copyright
#    notice, this list of conditions and the following disclaimer in the
#    documentation and/or other materials provided with the distribution.
#
# THIS SOFTWARE IS PROVIDED BY THE AUTHOR ``AS IS'' AND ANY EXPRESS OR
# IMPLIED WARRANTIES, INCLUDING, BUT NOT LIMITED TO, THE IMPLIED WARRANTIES
# OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE ARE DISCLAIMED.
# IN NO EVENT SHALL THE AUTHOR BE LIABLE FOR ANY DIRECT, INDIRECT,
# INCIDENTAL, SPECIAL, EXEMPLARY, OR CONSEQUENTIAL DAMAGES (INCLUDING, BUT
# NOT LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES; LOSS OF USE,
# DATA, OR PROFITS; OR BUSINESS INTERRUPTION) HOWEVER CAUSED AND ON ANY
# THEORY OF LIABILITY, WHETHER IN CONTRACT, STRICT LIABILITY, OR TORT
# (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE USE OF
# THIS SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.
#

#
# This code was written under funding by Ericsson Radio Systems.
#

.PATH:		${.CURDIR}/sysdep/openbsd

PROG=		isakmpd
SRCS=		app.c attribute.c cert.c connection.c constants.c conf.c \
		cookie.c crypto.c dh.c doi.c exchange.c exchange_num.c \
		field.c hash.c if.c ike_auth.c ike_main_mode.c \
		ike_phase_1.c ike_quick_mode.c init.c ipsec.c ipsec_fld.c \
		ipsec_num.c isakmpd.c isakmp_doi.c isakmp_fld.c isakmp_num.c \
		key.c libcrypto.c log.c message.c \
		prf.c sa.c sysdep.c timer.c transport.c virtual.c udp.c \
		ui.c util.c x509.c \
		pf_key_v2.c policy.c ike_aggressive.c isakmp_cfg.c \
		dpd.c monitor.c monitor_fdpass.c nat_traversal.c udp_encap.c \
		vendor.c

GENERATED=	exchange_num.h ipsec_fld.h ipsec_num.h isakmp_fld.h \
		isakmp_num.h
CLEANFILES=	exchange_num.c exchange_num.h ipsec_num.c ipsec_num.h \
		isakmp_num.c isakmp_num.h ipsec_fld.c ipsec_fld.h \
		isakmp_fld.c isakmp_fld.h
MAN=		isakmpd.8 isakmpd.conf.5 isakmpd.policy.5
CFLAGS+=	-Wall -Wstrict-prototypes -Wmissing-prototypes \
		-Wmissing-declarations -I${.CURDIR} -I.

# Include symbolic debugging info
#DEBUG=		-g

# Enable for DNSSEC use
#CFLAGS+=	USE_DNSSEC
#SRCS+=		dnssec.c
#LWRESLIB=      /usr/local/lib/liblwres.a
#DNSSEC_CFLAGS= -I/usr/local/include -DLWRES

LDADD+=		${LWRESLIB} -lkeynote -lcrypto -lm
DPADD+=		${LWRESLIB} ${LIBKEYNOTE} ${LIBCRYPTO} ${LIBM}

exchange_num.c exchange_num.h: genconstants.sh exchange_num.cst
	/bin/sh ${.CURDIR}/genconstants.sh ${.CURDIR}/exchange_num

ipsec_fld.c ipsec_fld.h: genfields.sh ipsec_fld.fld
	/bin/sh ${.CURDIR}/genfields.sh ${.CURDIR}/ipsec_fld

ipsec_num.c ipsec_num.h: genconstants.sh ipsec_num.cst
	/bin/sh ${.CURDIR}/genconstants.sh ${.CURDIR}/ipsec_num

isakmp_fld.c isakmp_fld.h: genfields.sh isakmp_fld.fld
	/bin/sh ${.CURDIR}/genfields.sh ${.CURDIR}/isakmp_fld

isakmp_num.c isakmp_num.h: genconstants.sh isakmp_num.cst
	/bin/sh ${.CURDIR}/genconstants.sh ${.CURDIR}/isakmp_num

${PROG} beforedepend: ${GENERATED}

.include <bsd.prog.mk>
.include <bsd.subdir.mk>
@


1.84
log
@improve randomization.  remove some junk debugging features that are
fundamentally broken.
ok jsing mikeb
@
text
@d1 1
a1 1
#	$OpenBSD: Makefile,v 1.83 2012/12/21 08:50:27 espie Exp $
a58 5

# If you have ElectricFence available, you can spot abuses of the heap.
# (/usr/ports/devel/ElectricFence)
#LDADD+=		-L/usr/local/lib -lefence
#DPADD+=		/usr/local/lib/libefence.a
@


1.83
log
@remove makefile hacks that are no longer needed with t1 t2: working properly
okay krw@@
@
text
@d1 1
a1 1
#	$OpenBSD: Makefile,v 1.82 2010/10/15 10:18:42 jsg Exp $
a63 7

# If you like to use Boehm's garbage collector (/usr/ports/devel/boehm-gc).
#LDADD+=		-L/usr/local/lib -lgc
#DPADD+=		/usr/local/lib/libgc.a
#CFLAGS+=		-DUSE_BOEHM_GC -DGC_DEBUG
# You can also use Boehm's garbage collector as a means to find leaks.
#  # setenv GC_FIND_LEAK
@


1.82
log
@Switch the remaining users of libdes in src to libcrypto,
telnet portion partially from the latest heimdal.

ok mikeb@@
@
text
@d1 1
a1 1
#	$OpenBSD: Makefile,v 1.81 2010/06/29 19:50:16 reyk Exp $
d81 1
a81 3
exchange_num.c exchange_num.h: stamp_exchange_num

stamp_exchange_num: genconstants.sh exchange_num.cst
a82 3
	@@touch $@@

ipsec_fld.c ipsec_fld.h: stamp_ipsec_fld
d84 1
a84 1
stamp_ipsec_fld: genfields.sh ipsec_fld.fld
a85 3
	@@touch $@@

ipsec_num.c ipsec_num.h: stamp_ipsec_num
d87 1
a87 1
stamp_ipsec_num: genconstants.sh ipsec_num.cst
a88 1
	@@touch $@@
d90 1
a90 3
isakmp_fld.c isakmp_fld.h: stamp_isakmp_fld

stamp_isakmp_fld: genfields.sh isakmp_fld.fld
a91 3
	@@touch $@@

isakmp_num.c isakmp_num.h: stamp_isakmp_num
d93 1
a93 1
stamp_isakmp_num: genconstants.sh isakmp_num.cst
a94 1
	@@touch $@@
a96 3

CLEANFILES += stamp_exchange_num stamp_ipsec_fld \
	stamp_ipsec_num stamp_isakmp_fld stamp_isakmp_num
@


1.81
log
@Replace the hand-crafted Diffie-Hellman implementation in isakmpd with
the smaller implementation from iked that is using libcrypto instead.
This allows to remove a lot of code (which is always good), get rid of
some custom crypto code by using libcrypto, theoretically adds
support for many new MODP and EC2N/ECP modes (but it is not configurable
yet), and allows to share the dh.c/dh.h code in different codebases
(it is identical in isakmpd and iked, but could also be used elsewhere).

ok deraadt@@
@
text
@d1 1
a1 1
#	$OpenBSD: Makefile,v 1.80 2008/01/29 00:47:08 espie Exp $
d78 2
a79 2
LDADD+=		${LWRESLIB} -lkeynote -lcrypto -ldes -lm
DPADD+=		${LWRESLIB} ${LIBKEYNOTE} ${LIBCRYPTO} ${LIBDES} ${LIBM}
@


1.80
log
@fix race in makefile
@
text
@d1 1
a1 1
#	$OpenBSD: Makefile,v 1.79 2007/05/23 07:28:15 hshoexer Exp $
d41 1
a41 1
		key.c libcrypto.c log.c message.c math_2n.c math_group.c \
d44 1
a44 1
		pf_key_v2.c policy.c math_ec2n.c ike_aggressive.c isakmp_cfg.c \
@


1.79
log
@Get rid of some obsolete exampels.

ok and prodding @@jmc
@
text
@d1 1
a1 1
#	$OpenBSD: Makefile,v 1.78 2006/07/02 13:19:00 hshoexer Exp $
d81 3
a83 1
exchange_num.c exchange_num.h: genconstants.sh exchange_num.cst
d85 3
d89 1
a89 1
ipsec_fld.c ipsec_fld.h: genfields.sh ipsec_fld.fld
d91 3
d95 1
a95 1
ipsec_num.c ipsec_num.h: genconstants.sh ipsec_num.cst
d97 1
d99 3
a101 1
isakmp_fld.c isakmp_fld.h: genfields.sh isakmp_fld.fld
d103 3
d107 1
a107 1
isakmp_num.c isakmp_num.h: genconstants.sh isakmp_num.cst
d109 1
d112 3
@


1.78
log
@Let isakmpd send out a vendor ID announcing isamkpds release version.
Will be handy for release specific bug fixes, etc.  Suggested by
markus@@ quite some time ago.

ok markus@@
@
text
@d1 1
a1 1
#	$OpenBSD: Makefile,v 1.77 2005/05/18 20:15:22 hshoexer Exp $
a70 4

.if make(install)
SUBDIR+=	samples
.endif
@


1.77
log
@there's no need for certpatch anymore, so remove it

ok markus some time ago
@
text
@d1 1
a1 1
#	$OpenBSD: Makefile,v 1.76 2005/04/08 21:09:36 deraadt Exp $
d45 2
a46 1
		dpd.c monitor.c monitor_fdpass.c nat_traversal.c udp_encap.c
@


1.76
log
@whack last feature, put in main Makefile
@
text
@d1 1
a1 1
#	$OpenBSD: Makefile,v 1.75 2005/04/08 20:04:57 hshoexer Exp $
a69 2

SUBDIR=		apps
@


1.75
log
@kill gmp
@
text
@d1 1
a1 1
#	$OpenBSD: Makefile,v 1.74 2005/04/08 19:40:02 deraadt Exp $
d33 1
a33 13
#
# This makefile is a "pmake" one, i.e. the make variant commonly found in
# BSD derived systems, where it is indeed named "make".  Other systems
# may provide this make variant as "pmake" or maybe "bsdmake".
#

OS=		openbsd

# Compile-time configuration of otherwise optional features
#FEATURES+=	dnssec
FEATURES+=	

.PATH:		${.CURDIR}/sysdep/${OS}
d43 3
a45 1
		ui.c util.c x509.c
a58 3
# Do execution time profiles
#CFLAGS+=	-pg

a72 5
.if ${FEATURES} != ""
FEATURES_UC!=	echo ${FEATURES} | tr '[:lower:]' '[:upper:]'
CFLAGS+=	${FEATURES_UC:S/^/-DUSE_/g}
.endif

d77 5
a81 10
.for FEATURE in ${FEATURES}
.if exists(features/${FEATURE})
.include "features/${FEATURE}"
.endif
.endfor

SRCS+=		${DNSSEC} \
		pf_key_v2.c policy.c math_ec2n.c ike_aggressive.c isakmp_cfg.c \
		dpd.c monitor.c monitor_fdpass.c nat_traversal.c udp_encap.c
CFLAGS+=	${DNSSEC_CFLAGS}
a104 3

debug:
	(cd ${.CURDIR}; ${MAKE} DEBUG="-g -Werror")
@


1.74
log
@USE_DEBUG is bye bye
@
text
@d1 1
a1 1
#	$OpenBSD: Makefile,v 1.73 2005/04/08 19:19:39 hshoexer Exp $
d50 1
a50 1
		field.c gmp_util.c hash.c if.c ike_auth.c ike_main_mode.c \
@


1.73
log
@remove gmp, no binary change
@
text
@d1 1
a1 1
#	$OpenBSD: Makefile,v 1.72 2005/04/08 19:08:23 deraadt Exp $
d43 1
a43 1
FEATURES+=	debug
@


1.72
log
@forget about sysdep/openbsd/sysdep-os.h
@
text
@d1 1
a1 1
#	$OpenBSD: Makefile,v 1.71 2005/04/08 19:05:15 deraadt Exp $
a99 2

CFLAGS+=	-DMP_FLAVOUR=MP_FLAVOUR_OPENSSL
@


1.71
log
@remove more conditional crud
@
text
@d1 1
a1 1
#	$OpenBSD: Makefile,v 1.70 2005/04/08 18:27:09 hshoexer Exp $
d64 1
a64 1
		-Wmissing-declarations -I${.CURDIR} -I${.CURDIR}/sysdep/${OS} -I.
@


1.70
log
@de-feature raw rsa keys, cleanup leftovers
@
text
@d1 1
a1 1
#	$OpenBSD: Makefile,v 1.69 2005/04/08 17:20:44 hshoexer Exp $
d42 1
a42 1
#FEATURES+=	gmp dnssec
d64 1
a64 2
		-Wmissing-declarations -DNEED_SYSDEP_APP \
		-I${.CURDIR} -I${.CURDIR}/sysdep/${OS} -I.
a85 2
.include "sysdep/${OS}/Makefile.sysdep"

a100 5
.if ${FEATURES:Mgmp} == "gmp"
CFLAGS+=	-DMP_FLAVOUR=MP_FLAVOUR_GMP
LDADD+=		-lgmp
DPADD+=		${LIBGMP}
.else
a101 1
.endif
d103 4
a106 4
SRCS+=		${IPSEC_SRCS} ${DNSSEC} policy.c math_ec2n.c \
		ike_aggressive.c isakmp_cfg.c dpd.c monitor.c monitor_fdpass.c \
		nat_traversal.c udp_encap.c
CFLAGS+=	${IPSEC_CFLAGS} ${DNSSEC_CFLAGS}
@


1.69
log
@regression tests have moved
@
text
@d1 1
a1 1
#	$OpenBSD: Makefile,v 1.68 2005/04/08 17:15:01 deraadt Exp $
d43 1
a43 1
FEATURES+=	policy debug rawkey 
a109 4
.endif

.ifdef USE_RAWKEY
CFLAGS+=	-DUSE_RAWKEY
@


1.68
log
@keynote and policy always compiled in
@
text
@d1 1
a1 1
#	$OpenBSD: Makefile,v 1.67 2005/04/08 17:03:04 deraadt Exp $
a95 4
.endif

.if !make(install) && !defined(NO_REGRESS)
#SUBDIR+=	regress
@


1.67
log
@remove crud
@
text
@d1 1
a1 1
#	$OpenBSD: Makefile,v 1.66 2005/04/08 16:52:41 deraadt Exp $
a115 8
.ifdef USE_KEYNOTE
USE_LIBCRYPTO=	yes
USE_LIBDES=	yes
LDADD+=		-lkeynote -lm
DPADD+=		${LIBKEYNOTE} ${LIBM}
CFLAGS+=	-DUSE_KEYNOTE
.endif

a116 1
USE_LIBCRYPTO=	yes
d120 1
a120 13
.ifdef USE_LIBCRYPTO
CFLAGS+=	-DUSE_LIBCRYPTO
LDADD+=		-lcrypto
DPADD+=		${LIBCRYPTO}
.endif

.ifdef USE_LIBDES
CFLAGS+=	-DUSE_LIBDES
LDADD+=		-ldes
DPADD+=		${LIBDES}
.endif

SRCS+=		${IPSEC_SRCS} ${POLICY} math_ec2n.c ${DNSSEC} \
d125 2
a126 2
LDADD+=		${DESLIB} ${LWRESLIB}
DPADD+=		${DESLIBDEP} ${LWRESLIB}
@


1.66
log
@always enable aggressive, dpd, and isakmp_cfg
@
text
@d1 1
a1 1
#	$OpenBSD: Makefile,v 1.65 2005/04/08 16:41:54 deraadt Exp $
a38 2
# openbsd means OpenBSD 2.5 or newer.
# freebsd/netbsd means FreeBSD/NetBSD with KAME IPsec.
a39 3
#OS=		netbsd
#OS=		freebsd
#OS=		bsdi
d42 2
a43 4
#FEATURES+=	policy debug gmp
#FEATURES+=	rawkey dnssec
FEATURES+=	policy debug
FEATURES+=	rawkey 
a47 2
BINDIR?=	/sbin
LDSTATIC?=	${STATIC}
a65 3
#CFLAGS+=	-Wsign-compare -Werror

# Different debugging & profiling suggestions
@


1.65
log
@ec and privsep always on
@
text
@d1 1
a1 1
#	$OpenBSD: Makefile,v 1.64 2005/04/08 16:37:14 deraadt Exp $
d47 4
a50 4
#FEATURES+=	policy aggressive debug gmp
#FEATURES+=	rawkey isakmp_cfg dnssec dpd
FEATURES+=	policy aggressive debug
FEATURES+=	rawkey isakmp_cfg dpd
d153 2
a154 2
SRCS+=		${IPSEC_SRCS} ${POLICY} math_ec2n.c ${AGGRESSIVE} ${DNSSEC} \
		${ISAKMP_CFG} ${DPD} monitor.c monitor_fdpass.c \
@


1.64
log
@nat-traversal always
@
text
@d1 1
a1 1
#	$OpenBSD: Makefile,v 1.63 2005/04/08 16:30:03 hshoexer Exp $
d47 4
a50 4
#FEATURES+=	policy ec aggressive debug gmp
#FEATURES+=	rawkey isakmp_cfg dnssec privsep dpd
FEATURES+=	policy ec aggressive debug
FEATURES+=	rawkey isakmp_cfg privsep dpd
d153 3
a155 2
SRCS+=		${IPSEC_SRCS} ${POLICY} ${EC} ${AGGRESSIVE} ${DNSSEC} \
		${ISAKMP_CFG} ${PRIVSEP} ${DPD} nat_traversal.c udp_encap.c
@


1.63
log
@remove cipher features
@
text
@d1 1
a1 1
#	$OpenBSD: Makefile,v 1.62 2005/04/08 16:06:25 deraadt Exp $
d48 1
a48 1
#FEATURES+=	rawkey isakmp_cfg dnssec privsep nat_traversal dpd
d50 1
a50 1
FEATURES+=	rawkey isakmp_cfg privsep nat_traversal dpd
d154 1
a154 1
		${ISAKMP_CFG} ${PRIVSEP} ${DPD} ${NAT_TRAVERSAL}
@


1.62
log
@app.c
@
text
@d1 1
a1 1
#	$OpenBSD: Makefile,v 1.61 2005/04/08 15:49:10 deraadt Exp $
a46 1
#FEATURES=	tripledes des blowfish cast aes
a48 1
FEATURES=	tripledes des blowfish cast aes
@


1.61
log
@remove some portable junk
@
text
@d1 1
a1 1
#	$OpenBSD: Makefile,v 1.60 2005/04/05 21:07:35 hshoexer Exp $
d113 1
a113 1
SUBDIR+=	regress
@


1.60
log
@disable freeswan support

ok ho@@ some time ago
@
text
@d1 1
a1 1
#	$OpenBSD: Makefile,v 1.59 2005/04/05 20:46:20 cloder Exp $
d82 1
a82 4
#DEBUG=		-g	# OpenBSD
#DEBUG_FLAGS=	-g	# FreeBSD
#CFLAGS+=	-g	# NetBSD and others
#STRIPFLAG=		# NETBSD
@


1.59
log
@Always compile X509 support. Almost everyone uses it.  Makes the code
much easier to read and to maintain.
OK and testing by hshoexer@@, more testing by me
@
text
@d1 1
a1 1
#	$OpenBSD: Makefile,v 1.58 2004/11/10 22:07:46 drahn Exp $
d39 2
a40 2
# openbsd means OpenBSD 2.5 or newer. freeswan is the name for Linux with
# FreeS/WAN integrated, freebsd/netbsd means FreeBSD/NetBSD with KAME IPsec.
a43 1
#OS=		freeswan
@


1.58
log
@Use ${STATIC} rather than -static (dont hardcode). ok miod@@
@
text
@d1 1
a1 1
#	$OpenBSD: Makefile,v 1.57 2004/08/23 11:16:49 ho Exp $
d49 1
a49 1
#FEATURES+=	policy x509 ec aggressive debug gmp
d52 1
a52 1
FEATURES+=	policy x509 ec aggressive debug
d67 1
a67 1
		ui.c util.c
d159 1
a159 1
SRCS+=		${IPSEC_SRCS} ${X509} ${POLICY} ${EC} ${AGGRESSIVE} ${DNSSEC} \
@


1.57
log
@Default enable DPD (Dead Peer Detection) support. hshoexer@@ ok
@
text
@d1 1
a1 1
#	$OpenBSD: Makefile,v 1.56 2004/07/30 10:45:27 ho Exp $
d59 1
a59 1
LDSTATIC?=	-static
@


1.56
log
@Style.
@
text
@d1 1
a1 1
#	$OpenBSD: Makefile,v 1.55 2004/06/23 01:17:29 ho Exp $
d50 1
a50 1
#FEATURES+=	rawkey isakmp_cfg dnssec privsep dpd nat_traversal
d53 1
a53 1
FEATURES+=	rawkey isakmp_cfg privsep nat_traversal
@


1.55
log
@Make compiling with Boehm's gc possible again.
@
text
@d1 1
a1 1
#	$OpenBSD: Makefile,v 1.54 2004/06/21 23:28:18 ho Exp $
d99 1
a99 1
#CFLAGS+=		-DUSE_BOEHM_GC
@


1.54
log
@Enable NAT-T support.
@
text
@d1 1
a1 1
#	$OpenBSD: Makefile,v 1.53 2004/06/20 15:24:05 ho Exp $
d99 1
a99 1

d101 1
a101 23
# XXX The defines below are GCC-specific.  I think it is OK to require
# XXX GCC if you are debugging isakmpd in this way.
#LDADD+=		-L/usr/local/lib -lleak
#DPADD+=		/usr/local/lib/libleak.a
#CFLAGS+=	-D'malloc(x)=({ \
#		  void *GC_debug_malloc (size_t, char *, int); \
#		  GC_debug_malloc ((x), __FILE__, __LINE__); \
#		})' \
#		-D'realloc(x,y)=({ \
#		  void *GC_debug_realloc (void *, size_t, char *, int); \
#		  GC_debug_realloc ((x), (y), __FILE__, __LINE__); \
#		})' \
#		-D'free(x)=({ \
#		  void GC_debug_free (void *); \
#		  GC_debug_free (x); \
#		})' \
#		-D'calloc(x,y)=malloc((x) * (y))' \
#		-D'strdup(x)=({ \
#		  char *strcpy (char *, const char *); \
#		  const char *_x_ = (x); \
#		  char *_y_ = malloc (strlen (_x_) + 1); \
#		  strcpy (_y_, _x_); \
#		})'
@


1.53
log
@NAT-Traversal for isakmpd. Work in progress...
hshoexer@@ ok.
@
text
@d1 1
a1 1
#	$OpenBSD: Makefile,v 1.52 2004/04/07 22:43:14 ho Exp $
d53 1
a53 1
FEATURES+=	rawkey isakmp_cfg privsep 
@


1.52
log
@-Wmissing-declarations
@
text
@d1 1
a1 1
#	$OpenBSD: Makefile,v 1.51 2004/03/19 14:04:43 hshoexer Exp $
d50 1
a50 1
#FEATURES+=	rawkey isakmp_cfg dnssec privsep
d53 1
a53 1
FEATURES+=	rawkey isakmp_cfg privsep
d66 2
a67 1
		prf.c sa.c sysdep.c timer.c transport.c udp.c ui.c util.c
d182 1
a182 1
		${ISAKMP_CFG} ${PRIVSEP}
d207 3
@


1.51
log
@Add missing bits to make already present privsep code work.  Enable privsep.

ok ho@@ deraadt@@ markus@@
@
text
@d1 1
a1 1
#	$OpenBSD: Makefile,v 1.50 2003/08/28 14:43:35 markus Exp $
d75 1
a75 1
		-DNEED_SYSDEP_APP \
@


1.50
log
@support AES in phase 1, too. switch to OpenSSL EVP interface;
with Hans-Joerg.Hoexer at yerbouti.franken.de; ok ho@@
@
text
@d1 1
a1 1
#	$OpenBSD: Makefile,v 1.49 2003/06/03 14:28:16 ho Exp $
d53 1
a53 1
FEATURES+=	rawkey isakmp_cfg
@


1.49
log
@Remove clauses 3 and 4. With approval from Niklas Hallqvist and
Niels Provos.
@
text
@d1 1
a1 1
#	$OpenBSD: Makefile,v 1.48 2003/05/15 00:28:53 ho Exp $
d48 2
a49 1
#FEATURES=	tripledes des blowfish cast policy x509 ec aggressive debug gmp
d51 2
a52 1
FEATURES=	tripledes des blowfish cast policy x509 ec aggressive debug
@


1.48
log
@Start of privilege separation for isakmpd.
There are some kinks left, so keep it default disabled for now.
markus@@ says ok to commit.
@
text
@d1 1
a1 1
#	$OpenBSD: Makefile,v 1.47 2003/05/14 20:49:36 ho Exp $
a15 5
# 3. All advertising materials mentioning features or use of this software
#    must display the following acknowledgement:
#	This product includes software developed by Ericsson Radio Systems.
# 4. The name of the author may not be used to endorse or promote products
#    derived from this software without specific prior written permission.
d75 1
@


1.47
log
@Call the FreeS/WAN sysdep 'freeswan'. The 'linux' sysdep will be native Linux IPSec.
@
text
@d1 1
a1 1
#	$OpenBSD: Makefile,v 1.46 2002/06/10 18:08:58 ho Exp $
d54 1
a54 1
#FEATURES+=	rawkey isakmp_cfg dnssec
d183 1
a183 1
		${ISAKMP_CFG}
@


1.46
log
@The dlopen() stuff goes away.
@
text
@d1 1
a1 1
#	$OpenBSD: Makefile,v 1.45 2002/03/05 00:10:56 deraadt Exp $
d44 1
a44 1
# openbsd means OpenBSD 2.5 or newer. linux is the name for Linux with
d49 1
a49 1
#OS=		linux
@


1.45
log
@must pull -ldes too
@
text
@d1 1
a1 1
#	$OpenBSD: Makefile,v 1.44 2001/08/25 22:22:26 niklas Exp $
a154 5
.endif

.ifdef HAVE_DLOPEN
CFLAGS+=	-DHAVE_DLOPEN
SRCS+=		dyn.c
@


1.44
log
@Enable IKE mode config, as it works ok with PGPnet and at least has a usable
configuration method.  Documentation will follow.
@
text
@d1 1
a1 1
#	$OpenBSD: Makefile,v 1.43 2001/08/16 18:55:33 jakob Exp $
d164 1
d179 6
@


1.43
log
@remove unneeded LWRESLIB definition. ok ho@@
@
text
@d1 1
a1 1
#	$OpenBSD: Makefile,v 1.42 2001/08/15 09:16:29 ho Exp $
d56 1
a56 1
FEATURES+=	rawkey
@


1.42
log
@Support trusted public (RSA) keys as files too. niklas@@ ok.
@
text
@d1 1
a1 1
#	$OpenBSD: Makefile,v 1.41 2001/07/06 09:35:57 ho Exp $
a124 3

# Enable this if you have a DNSSEC enabled OpenSSL
#LWRESLIB=	/usr/local/lib/liblwres.a
@


1.41
log
@Remove support for PF_ENCAP (deprecated since OpenBSD2.5).
@
text
@d1 1
a1 1
#	$OpenBSD: Makefile,v 1.40 2001/07/05 12:38:04 ho Exp $
d54 1
a54 1
#FEATURES+=	isakmp_cfg dnssec
d56 1
a56 1
#FEATURES=
d170 5
@


1.40
log
@Use -W{missing,strict}-prototypes.
@
text
@d1 1
a1 1
#	$OpenBSD: Makefile,v 1.39 2001/07/01 20:43:39 niklas Exp $
d44 2
a45 3
# openbsd means 2.5 or newer, openbsd-encap is for older kernels with PF_ENCAP
# linux is the name for Linux with FreeS/WAN integrated, freebsd/netbsd means
# FreeBSD/NetBSD with KAME IPsec.
a46 1
#OS=		openbsd-encap
@


1.39
log
@ISAKMP configuration, a.k.a IKECFG or "mode-config", protocol implementation.
Disabled, has no configuration mechanism yet.  This will be used for roaming
users, who are going to get parameters like IP-address and nameserver from its
peer, very much like DHCP, but securily inside an ISAKMP connection and still
in time before negotiation of IPsec connections.  You may see stylistic fixes
in this commit too.  Add some not yet used Makefile magic to deal with DNSSEC-
enabled OpenSSL too.  The IKECFG code work was sponsered by Gatespace Inc.
Thank you!  Configuration will come very soon, btw.
@
text
@d1 1
a1 1
#	$OpenBSD: Makefile,v 1.38 2001/05/31 20:21:37 angelos Exp $
d79 2
a80 1
CFLAGS+=	-Wall -DNEED_SYSDEP_APP \
@


1.38
log
@Compile key.c
@
text
@d1 1
a1 1
#	$OpenBSD: Makefile,v 1.37 2001/05/21 11:19:22 ho Exp $
d5 1
a5 1
# Copyright (c) 1998, 1999, 2000 Niklas Hallqvist.  All rights reserved.
d56 1
a56 1
#FEATURES+=	dnssec
d58 1
a58 1
#FEATURES+=
d127 3
d179 2
a180 1
SRCS+=		${IPSEC_SRCS} ${X509} ${POLICY} ${EC} ${AGGRESSIVE} ${DNSSEC}
@


1.37
log
@Better FEATURE handling for dnssec
@
text
@d1 1
a1 1
#	$OpenBSD: Makefile,v 1.36 2001/05/07 22:55:37 espie Exp $
d70 2
a71 2
		libcrypto.c log.c message.c math_2n.c math_group.c prf.c sa.c \
		sysdep.c timer.c transport.c udp.c ui.c util.c
@


1.36
log
@make bug fixed, remove work-around
@
text
@d1 1
a1 1
#	$OpenBSD: Makefile,v 1.35 2001/05/07 22:14:31 espie Exp $
d58 1
a58 1
#FEATURES=
a157 8
.if ${FEATURES:Mdnssec} == "dnssec"
LIBLWRES=	/usr/local/lib/liblwres.a
CFLAGS+=	-I/usr/local/include
LDADD+=		${LIBLWRES}
DPADD+=		${LIBLWRES}
SRCS+=		dnssec.c
.endif

d176 2
a177 2
SRCS+=		${IPSEC_SRCS} ${X509} ${POLICY} ${EC} ${AGGRESSIVE}
CFLAGS+=	${IPSEC_CFLAGS}
d179 2
a180 2
LDADD+=		${DESLIB}
DPADD+=		${DESLIBDEP}
@


1.35
log
@temp work-around. Okay deraadt@@
@
text
@d1 1
a1 1
#	$OpenBSD: Makefile,v 1.34 2001/03/23 16:14:34 markus Exp $
d145 1
a145 1
.if exists(${.CURDIR}/features/${FEATURE})
@


1.34
log
@bsdi support, ok niklas@@
@
text
@d1 1
a1 1
#	$OpenBSD: Makefile,v 1.33 2001/03/22 15:16:44 markus Exp $
d145 1
a145 1
.if exists(features/${FEATURE})
@


1.33
log
@BSD/OS make treats ${A:S/a/x/} like ${A:S/a/x/1}, so we use ${A:S/a/x/g}.
this works on both systems (for this special case).
@
text
@d1 1
a1 1
#	$OpenBSD: Makefile,v 1.32 2001/02/24 04:42:47 angelos Exp $
d52 1
@


1.32
log
@Make DES a feature, so isakmpd can compile on Linux (most of the fixed
by newsham@@lava.net)
@
text
@d1 1
a1 1
#	$OpenBSD: Makefile,v 1.31 2001/01/27 12:03:31 niklas Exp $
d132 1
a132 1
CFLAGS+=	${FEATURES_UC:S/^/-DUSE_/}
@


1.31
log
@(c) 2001
@
text
@d1 1
a1 1
#	$OpenBSD: Makefile,v 1.30 2001/01/26 21:49:36 ho Exp $
d54 1
a54 1
#FEATURES=	tripledes blowfish cast policy x509 ec aggressive debug gmp
d56 1
a56 1
FEATURES=	tripledes blowfish cast policy x509 ec aggressive debug
@


1.30
log
@Preliminary but working code to permit IKE authentication using DNSSEC
validated KEY records. Uses lwresd from the bind-9.1.0 port.
Enable by adding 'dnssec' to FEATURES.
@
text
@d1 1
a1 1
#	$OpenBSD: Makefile,v 1.29 2000/10/16 23:28:32 niklas Exp $
d6 1
a6 1
# Copyright (c) 2000 Håkan Olsson.  All rights reserved.
@


1.29
log
@Merge with EOM 1.78

author: niklas
correct test for GMP feature
@
text
@d1 1
a1 1
#	$OpenBSD: Makefile,v 1.28 2000/10/07 06:57:16 niklas Exp $
d55 1
d155 8
@


1.29.2.1
log
@Pull in isakmpd from 2.9 to 2.8 branch.
@
text
@d1 1
a1 1
#	$OpenBSD: Makefile,v 1.34 2001/03/23 16:14:34 markus Exp $
d6 1
a6 1
# Copyright (c) 2000, 2001 Håkan Olsson.  All rights reserved.
a51 1
#OS=		bsdi
d54 2
a55 3
#FEATURES=	tripledes des blowfish cast policy x509 ec aggressive debug gmp
#FEATURES+=	
FEATURES=	tripledes des blowfish cast policy x509 ec aggressive debug
d131 1
a131 1
CFLAGS+=	${FEATURES_UC:S/^/-DUSE_/g}
@


1.28
log
@Merge with EOM 1.77

author: niklas
Add back an example of empty FEATURES

author: niklas
Well, show how to add -g in different OSes

author: itojun
make -g really work

author: ho
Revert. Features should not depend on other stuff,
it should be the other way around.

author: ho
Ok, make it work this time.

author: ho
Only add 'policy' feature if USE_KEYNOTE is active.
@
text
@d1 2
a2 2
#	$OpenBSD: Makefile,v 1.27 2000/05/02 14:36:37 niklas Exp $
#	$EOM: Makefile,v 1.77 2000/10/06 22:37:58 niklas Exp $
d148 1
a148 1
.ifdef USE_GMP
@


1.27
log
@Merge with EOM 1.71

author: niklas
Argh I always manage to commit my local DEBUG=-g change by mistake

author: niklas
oops in last commit

author: niklas
Install sample files
@
text
@d1 2
a2 2
#	$OpenBSD: Makefile,v 1.26 2000/04/07 22:06:28 niklas Exp $
#	$EOM: Makefile,v 1.71 2000/05/02 10:31:01 niklas Exp $
d83 4
a86 1
#DEBUG=		-g
@


1.26
log
@Merge with EOM 1.68

author: niklas
Make gmp a feature, which we do not use normally

author: niklas
I am probably breaking the other OSes now, but FEATURES really
belong here.  Also add MP_FLAVOUR setting.

author: ho
Revert to manual OS selection. Remove FEATURES definition.

author: ho
Removed unused stuff.

author: ho
Another way to do multiple OSes

author: ho
Work around missing :U for features, get OS from uname.
@
text
@d1 2
a2 2
#	$OpenBSD: Makefile,v 1.25 2000/02/25 17:23:38 niklas Exp $
#	$EOM: Makefile,v 1.68 2000/04/07 20:02:41 niklas Exp $
d129 4
@


1.25
log
@regress/crypto/Makefile: Merge with EOM 1.5
regress/dh/Makefile: Merge with EOM 1.7
regress/group/Makefile: Merge with EOM 1.9
regress/prf/Makefile: Merge with EOM 1.4
regress/rsakeygen/Makefile: Merge with EOM 1.8
regress/x509/Makefile: Merge with EOM 1.10
Makefile: Merge with EOM 1.62
attribute.c: Merge with EOM 1.10
sa.c: Merge with EOM 1.99
conf.c: Merge with EOM 1.20
crypto.c: Merge with EOM 1.28
isakmpd.c: Merge with EOM 1.45
connection.c: Merge with EOM 1.19
doi.h: Merge with EOM 1.28
field.c: Merge with EOM 1.11
exchange.c: Merge with EOM 1.116
ike_auth.c: Merge with EOM 1.44
pf_key_v2.c: Merge with EOM 1.37
ike_phase_1.c: Merge with EOM 1.22
ipsec.c: Merge with EOM 1.118
isakmp_doi.c: Merge with EOM 1.40
log.c: Merge with EOM 1.26
log.h: Merge with EOM 1.18
math_group.c: Merge with EOM 1.23
message.c: Merge with EOM 1.144
pf_encap.c: Merge with EOM 1.70
policy.c: Merge with EOM 1.18
timer.c: Merge with EOM 1.13
transport.c: Merge with EOM 1.41
udp.c: Merge with EOM 1.47
ui.c: Merge with EOM 1.37
x509.c: Merge with EOM 1.36

author: niklas
Made debug logging a compile time selectable feature
@
text
@d1 2
a2 2
#	$OpenBSD: Makefile,v 1.24 2000/02/19 19:31:32 niklas Exp $
#	$EOM: Makefile,v 1.62 2000/02/20 19:58:36 niklas Exp $
d6 1
d45 2
a46 2
# linux is the name for Linux with FreeS/WAN integrated, freebsd means FreeBSD
# with KAME IPsec.
d49 1
d54 1
d56 1
d83 1
a83 1
DEBUG=		-g
d124 2
d127 2
a128 1
CFLAGS+=	${FEATURES:U:S/^/-DUSE_/}
a130 2
.include "sysdep/${OS}/Makefile.sysdep"

d140 8
@


1.24
log
@Makefile: Merge with EOM 1.61
crypto.c: Merge with EOM 1.27
exchange.c: Merge with EOM 1.115
ike_quick_mode.c: Merge with EOM 1.115
x509.c: Merge with EOM 1.35
features/ec: Merge with EOM 1.1
features/aggressive: Merge with EOM 1.1
features/policy: Merge with EOM 1.1
features/x509: Merge with EOM 1.1

author: niklas
Allow isakmpd builders to remove optional parts and save bytes.
@
text
@d1 2
a2 2
#	$OpenBSD: Makefile,v 1.23 2000/01/26 15:21:49 niklas Exp $
#	$EOM: Makefile,v 1.61 2000/02/19 07:46:30 niklas Exp $
d52 1
a52 1
FEATURES=	tripledes blowfish cast policy x509 ec aggressive
@


1.23
log
@Merge with EOM 1.60

author: niklas
Add FreeBSD support

author: angelos
Manpage support in the Makefiles, mention in README.
@
text
@d1 2
a2 2
#	$OpenBSD: Makefile,v 1.22 1999/10/16 20:09:22 angelos Exp $
#	$EOM: Makefile,v 1.60 1999/12/08 20:39:34 niklas Exp $
d5 1
a5 1
# Copyright (c) 1998, 1999 Niklas Hallqvist.  All rights reserved.
d51 3
d59 7
a65 9
SRCS=		app.c attribute.c cert.c connection.c \
		constants.c conf.c cookie.c crypto.c dh.c doi.c exchange.c \
		exchange_num.c field.c gmp_util.c hash.c if.c ike_auth.c \
		ike_aggressive.c ike_main_mode.c ike_phase_1.c \
		ike_quick_mode.c init.c ipsec.c ipsec_fld.c ipsec_num.c \
		isakmpd.c isakmp_doi.c isakmp_fld.c isakmp_num.c libcrypto.c \
		log.c message.c math_2n.c math_ec2n.c math_group.c \
		prf.c sa.c sysdep.c timer.c transport.c udp.c ui.c \
		util.c
d120 4
d130 6
a136 2
X509=		x509.c
POLICY=		policy.c
a142 1
POLICY=		policy.c
a148 1
X509=		x509.c
d154 1
a154 1
SRCS+=		${IPSEC_SRCS} ${X509} ${POLICY}
@


1.22
log
@Typo typo typo...
@
text
@d1 2
a2 2
#	$OpenBSD: Makefile,v 1.21 1999/10/16 20:07:18 angelos Exp $
#	$EOM: Makefile,v 1.58 1999/08/26 11:21:48 niklas Exp $
d44 2
a45 1
# linux is the name for Linux with FreeS/WAN integrated
d48 1
d118 4
a121 1
.if !make(install)
a123 2

.include "sysdep/${OS}/Makefile.sysdep"
@


1.21
log
@Manpage describing policy.
@
text
@d1 1
a1 1
#	$OpenBSD: Makefile,v 1.20 1999/08/26 22:29:19 niklas Exp $
d69 1
a69 1
MAN=		isakmpd.8 isakmpd.conf.5 isakmp.policy.5
@


1.20
log
@Merge with EOM 1.58

author: niklas
Support dynamic loading of libkeynote too.  Build isakmpd static by default.
Stylistic cleanup of keynote policy code.  Correct some libcrypto calls.

author: angelos
Complete policy work; tested for the shared-key case. Documentation needed.

author: niklas
Add support for dynamic loading of optional facilities, libcrypto first.
@
text
@d1 1
a1 1
#	$OpenBSD: Makefile,v 1.19 1999/07/17 21:54:39 niklas Exp $
d69 1
a69 1
MAN=		isakmpd.8 isakmpd.conf.5
@


1.19
log
@regress/rsakeygen/Makefile: Merge with EOM 1.4
regress/rsakeygen/rsakeygen.c: Merge with EOM 1.8
regress/x509/Makefile: Merge with EOM 1.6
regress/x509/x509test.c: Merge with EOM 1.6
regress/Makefile: Merge with EOM 1.8
samples/VPN-east.conf: Merge with EOM 1.6
samples/VPN-west.conf: Merge with EOM 1.6
samples/singlehost-east.conf: Merge with EOM 1.3
samples/singlehost-west.conf: Merge with EOM 1.3
sysdep/openbsd/Makefile.sysdep: Merge with EOM 1.5
x509.h: Merge with EOM 1.6
x509.c: Merge with EOM 1.17
DESIGN-NOTES: Merge with EOM 1.46
Makefile: Merge with EOM 1.55
cert.c: Merge with EOM 1.11
cert.h: Merge with EOM 1.6
exchange.c: Merge with EOM 1.109
exchange.h: Merge with EOM 1.26
ike_auth.c: Merge with EOM 1.32
ike_phase_1.c: Merge with EOM 1.7
init.c: Merge with EOM 1.16
isakmpd.conf.5: Merge with EOM 1.27
README.PKI: Merge with EOM 1.1

author: niklas
From Niels Provos, edited by me: certificate support using SSLeay
@
text
@d1 2
a2 2
#	$OpenBSD: Makefile,v 1.18 1999/07/07 22:07:33 niklas Exp $
#	$EOM: Makefile,v 1.55 1999/07/17 20:44:07 niklas Exp $
d53 1
d59 2
a60 2
		isakmpd.c isakmp_doi.c isakmp_fld.c isakmp_num.c log.c \
		message.c math_2n.c math_ec2n.c math_group.c \
d62 1
a62 1
		util.c x509.c
d121 28
@


1.18
log
@Merge with EOM 1.54

author: ho
Remove a trailing backslash.

author: niklas
OpenBSD with PF_KEY is now the default

author: niklas
Oops, we have not gone to 2.5 as a base for EOM yet.
@
text
@d1 2
a2 2
#	$OpenBSD: Makefile,v 1.17 1999/05/01 22:56:54 niklas Exp $
#	$EOM: Makefile,v 1.54 1999/06/07 00:00:49 ho Exp $
d53 1
a53 1
SRCS=		app.c asn.c asn_useful.c attribute.c cert.c connection.c \
d60 1
a60 1
		pkcs.c prf.c sa.c sysdep.c timer.c transport.c udp.c ui.c \
d114 1
d116 1
a116 1
SUBDIR=		regress
@


1.17
log
@Lost connection commit snippet
@
text
@d1 2
a2 2
#	$OpenBSD: Makefile,v 1.16 1999/05/01 20:43:41 niklas Exp $
#	$EOM: Makefile,v 1.51 1999/05/01 20:21:05 niklas Exp $
d70 1
a70 1
		-I${.CURDIR} -I${.CURDIR}/sysdep/${OS} -I. \
@


1.16
log
@sysdep/openbsd/sysdep.c: Merge with EOM 1.7
DESIGN-NOTES: Merge with EOM 1.42
Makefile: Merge with EOM 1.51
app.c: Merge with EOM 1.6
conf.c: Merge with EOM 1.18
init.c: Merge with EOM 1.14
isakmpd.conf.5: Merge with EOM 1.19
pf_encap.c: Merge with EOM 1.64
pf_encap.h: Merge with EOM 1.12
pf_key_v2.h: Merge with EOM 1.3
sysdep.h: Merge with EOM 1.16
transport.c: Merge with EOM 1.40
ui.c: Merge with EOM 1.32

author: niklas
A new connection abstraction
@
text
@d1 1
a1 1
#	$OpenBSD: Makefile,v 1.15 1999/04/20 12:22:18 niklas Exp $
d53 4
a56 4
SRCS=		app.c asn.c asn_useful.c attribute.c cert.c constants.c \
		conf.c cookie.c crypto.c dh.c doi.c exchange.c exchange_num.c \
		field.c gmp_util.c hash.c if.c ike_auth.c ike_aggressive.c \
		ike_main_mode.c ike_phase_1.c \
@


1.15
log
@Merge with EOM 1.50

author: niklas
Heh forgot to comment out the boehm-gc defines
@
text
@d1 2
a2 2
#	$OpenBSD: Makefile,v 1.14 1999/04/20 11:33:15 niklas Exp $
#	$EOM: Makefile,v 1.50 1999/04/20 12:22:46 niklas Exp $
@


1.14
log
@Merge with EOM 1.49

author: niklas
Remove warnings when finding leaks with Boehm GC
@
text
@d1 2
a2 2
#	$OpenBSD: Makefile,v 1.13 1999/04/19 21:00:19 niklas Exp $
#	$EOM: Makefile,v 1.49 1999/04/20 09:24:28 niklas Exp $
d92 21
a112 21
LDADD+=		-L/usr/local/lib -lleak
DPADD+=		/usr/local/lib/libleak.a
CFLAGS+=	-D'malloc(x)=({ \
		  void *GC_debug_malloc (size_t, char *, int); \
		  GC_debug_malloc ((x), __FILE__, __LINE__); \
		})' \
		-D'realloc(x,y)=({ \
		  void *GC_debug_realloc (void *, size_t, char *, int); \
		  GC_debug_realloc ((x), (y), __FILE__, __LINE__); \
		})' \
		-D'free(x)=({ \
		  void GC_debug_free (void *); \
		  GC_debug_free (x); \
		})' \
		-D'calloc(x,y)=malloc((x) * (y))' \
		-D'strdup(x)=({ \
		  char *strcpy (char *, const char *); \
		  const char *_x_ = (x); \
		  char *_y_ = malloc (strlen (_x_) + 1); \
		  strcpy (_y_, _x_); \
		})'
@


1.13
log
@./Makefile: Merge with EOM 1.48

Let's get aggressive!

Comments are not good at the end of an assignment line

Make PF_ENCAP and PF_KEY versions of OpenBSD support separated through the OS
make variable of the top Makefile.

Add commented out usages of Boehm's GC library

LDADD and DPADD should be appended to. 1999 (c). Style.
@
text
@d1 2
a2 2
#	$OpenBSD: Makefile,v 1.12 1999/03/24 16:01:24 niklas Exp $
#	$EOM: Makefile,v 1.48 1999/04/16 21:24:46 niklas Exp $
d90 23
a112 6
# XXX Expect warnings due to missing prototypes if using this though.
#LDADD+=		-L/usr/local/lib -lleak
#DPADD+=		/usr/local/lib/libleak.a
#CFLAGS+=	-D'malloc(x)=GC_debug_malloc((x),__FILE__,__LINE__)' \
#		-D'realloc(x,y)=GC_debug_realloc((x),(y),__FILE__,__LINE__)' \
#		-D'free(x)=GC_debug_free(x)' -D'calloc(x,y)=malloc((x)*(y))'
@


1.12
log
@Do PF_KEY per default
@
text
@d1 2
a2 2
#	$OpenBSD: Makefile,v 1.11 1999/03/02 15:06:12 niklas Exp $
#	$EOM: Makefile,v 1.43 1999/03/02 14:27:47 niklas Exp $
d5 1
a5 1
# Copyright (c) 1998 Niklas Hallqvist.  All rights reserved.
d43 2
d46 1
d55 2
a56 1
		field.c gmp_util.c hash.c if.c ike_auth.c ike_main_mode.c \
a62 5
# Chose one of the IPSec SADB interfacing choices
#SRCS+=		pf_encap.c
SRCS+=		pf_key_v2.c
#SRCS+=		klips.c

d72 1
a72 2
#If you use PF_KEYv2 do this:
CFLAGS+=	-DUSE_PF_KEY_V2
a73 2
# Different debugging & profiling suggestions
#
d76 1
a76 1
#
d79 1
a79 1
#
d81 1
d83 13
a95 1
#
@


1.11
log
@Makefile: Merge with EOM 1.43
Makefile.inc -> Makefile.sysdep

Make SUBDIR changeable by the OS support

sysdep/openbsd/Makefile.sysdep: Merge with EOM 1.1
Makefile.inc -> Makefile.sysdep
@
text
@d1 1
a1 1
#	$OpenBSD: Makefile,v 1.10 1999/02/26 03:30:00 niklas Exp $
d60 2
a61 2
SRCS+=		pf_encap.c
#SRCS+=		pf_key_v2.c
d74 1
a74 1
#CFLAGS+=	-DUSE_PF_KEY_V2
@


1.10
log
@Merge from the Ericsson repository
| revision 1.41
| date: 1999/02/25 15:53:37;  author: niklas;  state: Exp;  lines: +5 -3
| sysdep Makefile fragments
| ----------------------------
| revision 1.40
| date: 1999/02/25 15:07:27;  author: niklas;  state: Exp;  lines: +3 -4
| Mesing with the new sysdep paths
| ----------------------------
| revision 1.39
| date: 1999/02/25 14:17:43;  author: niklas;  state: Exp;  lines: +11 -4
| Prepare for PF_KEY
| ----------------------------
| revision 1.38
| date: 1999/02/25 14:01:35;  author: niklas;  state: Exp;  lines: +17 -4
| Better OS-dependency layout
| ----------------------------
@
text
@d1 2
a2 2
#	$OpenBSD: Makefile,v 1.9 1998/12/22 02:09:46 niklas Exp $
#	$EOM: Makefile,v 1.41 1999/02/25 15:53:37 niklas Exp $
a87 2
.include "sysdep/${OS}/Makefile.inc"

d91 2
@


1.9
log
@My former hack lost, better solution
@
text
@d1 2
a2 2
#	$OpenBSD: Makefile,v 1.8 1998/12/22 02:03:32 niklas Exp $
#	$EOM: Makefile,v 1.37 1998/12/22 02:09:14 niklas Exp $
d37 11
d55 1
a55 1
		message.c math_2n.c math_ec2n.c math_group.c pf_encap.c \
d58 6
d70 5
a74 3
LDADD=		-lgmp -ldes
DPADD=		${LIBGMP} ${LIBDES}
CFLAGS+=	-Wall -I. -I${.CURDIR} -DNEED_SYSDEP_APP
d87 2
@


1.8
log
@Build generated .c & .h files before .o generation always
@
text
@d1 2
a2 2
#	$OpenBSD: Makefile,v 1.7 1998/12/21 01:02:22 niklas Exp $
#	$EOM: Makefile,v 1.35 1998/12/22 02:02:19 niklas Exp $
d47 2
a48 1
OBJS=		ipsec_fld.h ipsec_num.h isakmp_fld.h isakmp_num.h
d88 1
a88 1
beforedepend: ipsec_fld.h ipsec_num.h isakmp_fld.h isakmp_num.h
@


1.7
log
@Last months worth of work on isakmpd, lots done
@
text
@d1 2
a2 2
#	$OpenBSD: Makefile,v 1.6 1998/11/17 11:10:06 niklas Exp $
#	$EOM: Makefile,v 1.34 1998/12/18 12:57:27 niklas Exp $
d47 1
d87 1
a87 1
beforedepend:	ipsec_fld.h ipsec_num.h isakmp_fld.h isakmp_num.h
@


1.6
log
@Add RCS Ids from the EOM repository
@
text
@d1 2
a2 2
#	$OpenBSD: Makefile,v 1.5 1998/11/16 21:07:13 niklas Exp $
#	$EOM: Makefile,v 1.32 1998/10/10 16:58:15 niklas Exp $
d38 1
d54 4
d59 7
d67 1
d69 1
@


1.5
log
@Reinstate X509 signature code except for RSA code
@
text
@d1 2
a2 1
#	$OpenBSD: Makefile,v 1.4 1998/11/16 12:30:59 niklas Exp $
@


1.4
log
@Compile with cert.c
@
text
@d1 1
a1 1
#	$OpenBSD: Makefile,v 1.3 1998/11/15 01:01:29 niklas Exp $
d37 1
a37 1
SRCS=		app.c attribute.c cert.c constants.c \
d43 2
a44 2
		prf.c sa.c sysdep.c timer.c transport.c udp.c ui.c \
		util.c
@


1.3
log
@update src list
@
text
@d1 1
a1 1
#	$OpenBSD: Makefile,v 1.2 1998/11/15 00:43:47 niklas Exp $
d37 1
a37 1
SRCS=		app.c attribute.c constants.c \
@


1.2
log
@openBSD RCS IDs
@
text
@d1 1
a1 1
#	$OpenBSD: Makefile,v 1.1.1.1 1998/11/15 00:03:48 niklas Exp $
d37 1
a37 1
SRCS=		app.c asn.c asn_useful.c attribute.c cert.c constants.c \
d43 2
a44 2
		pkcs.c prf.c sa.c sysdep.c timer.c transport.c udp.c ui.c \
		util.c x509.c
@


1.1
log
@Initial revision
@
text
@d1 1
a1 1
#	$Id: Makefile,v 1.32 1998/10/10 16:58:15 niklas Exp $
@


1.1.1.1
log
@Initial import of isakmpd, an IKE (ISAKMP/Oakley) implementation for the
OpenBSD IPSEC stack by me, Niklas Hallqvist and Niels Provos, funded by
Ericsson Radio Systems.  It is not yet complete or usable in a real scenario
but the missing pieces will soon be there.  The early commit is for people
who wants early access and who are not afraid of looking at source.
isakmpd interops with Cisco, Timestep, SSH & Pluto (Linux FreeS/WAN) so
far, so it is not that incomplete.  It is really mostly configuration that
is lacking.
@
text
@@
