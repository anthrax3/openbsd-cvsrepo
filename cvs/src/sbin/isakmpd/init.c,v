head	1.41;
access;
symbols
	OPENBSD_6_1_BASE:1.41
	OPENBSD_6_0:1.41.0.14
	OPENBSD_6_0_BASE:1.41
	OPENBSD_5_9:1.41.0.10
	OPENBSD_5_9_BASE:1.41
	OPENBSD_5_8:1.41.0.12
	OPENBSD_5_8_BASE:1.41
	OPENBSD_5_7:1.41.0.4
	OPENBSD_5_7_BASE:1.41
	OPENBSD_5_6:1.41.0.8
	OPENBSD_5_6_BASE:1.41
	OPENBSD_5_5:1.41.0.6
	OPENBSD_5_5_BASE:1.41
	OPENBSD_5_4:1.41.0.2
	OPENBSD_5_4_BASE:1.41
	OPENBSD_5_3:1.40.0.12
	OPENBSD_5_3_BASE:1.40
	OPENBSD_5_2:1.40.0.10
	OPENBSD_5_2_BASE:1.40
	OPENBSD_5_1_BASE:1.40
	OPENBSD_5_1:1.40.0.8
	OPENBSD_5_0:1.40.0.6
	OPENBSD_5_0_BASE:1.40
	OPENBSD_4_9:1.40.0.4
	OPENBSD_4_9_BASE:1.40
	OPENBSD_4_8:1.40.0.2
	OPENBSD_4_8_BASE:1.40
	OPENBSD_4_7:1.39.0.14
	OPENBSD_4_7_BASE:1.39
	OPENBSD_4_6:1.39.0.16
	OPENBSD_4_6_BASE:1.39
	OPENBSD_4_5:1.39.0.12
	OPENBSD_4_5_BASE:1.39
	OPENBSD_4_4:1.39.0.10
	OPENBSD_4_4_BASE:1.39
	OPENBSD_4_3:1.39.0.8
	OPENBSD_4_3_BASE:1.39
	OPENBSD_4_2:1.39.0.6
	OPENBSD_4_2_BASE:1.39
	OPENBSD_4_1:1.39.0.4
	OPENBSD_4_1_BASE:1.39
	OPENBSD_4_0:1.39.0.2
	OPENBSD_4_0_BASE:1.39
	OPENBSD_3_9:1.37.0.4
	OPENBSD_3_9_BASE:1.37
	OPENBSD_3_8:1.37.0.2
	OPENBSD_3_8_BASE:1.37
	OPENBSD_3_7:1.33.0.2
	OPENBSD_3_7_BASE:1.33
	OPENBSD_3_6:1.32.0.2
	OPENBSD_3_6_BASE:1.32
	OPENBSD_3_5:1.27.0.2
	OPENBSD_3_5_BASE:1.27
	OPENBSD_3_4:1.25.0.2
	OPENBSD_3_4_BASE:1.25
	OPENBSD_3_3:1.20.0.4
	OPENBSD_3_3_BASE:1.20
	OPENBSD_3_2:1.20.0.2
	OPENBSD_3_2_BASE:1.20
	OPENBSD_3_1:1.18.0.2
	OPENBSD_3_1_BASE:1.18
	OPENBSD_3_0:1.17.0.2
	OPENBSD_3_0_BASE:1.17
	OPENBSD_2_9:1.15.0.6
	OPENBSD_2_9_BASE:1.15
	OPENBSD_2_8:1.15.0.4
	OPENBSD_2_8_BASE:1.15
	OPENBSD_2_7:1.15.0.2
	OPENBSD_2_7_BASE:1.15
	OPENBSD_2_6:1.10.0.2
	OPENBSD_2_6_BASE:1.10
	OPENBSD_2_5:1.5.0.2
	OPENBSD_2_5_BASE:1.5
	NIKLAS_981114:1.1.1.1
	NIKLAS:1.1.1;
locks; strict;
comment	@ * @;


1.41
date	2013.04.24.13.46.09;	author deraadt;	state Exp;
branches;
next	1.40;

1.40
date	2010.06.29.19.50.16;	author reyk;	state Exp;
branches;
next	1.39;

1.39
date	2006.07.02.13.19.00;	author hshoexer;	state Exp;
branches;
next	1.38;

1.38
date	2006.03.20.16.43.22;	author hshoexer;	state Exp;
branches;
next	1.37;

1.37
date	2005.05.26.05.14.17;	author hshoexer;	state Exp;
branches;
next	1.36;

1.36
date	2005.04.08.22.32.10;	author cloder;	state Exp;
branches;
next	1.35;

1.35
date	2005.04.08.17.15.01;	author deraadt;	state Exp;
branches;
next	1.34;

1.34
date	2005.04.08.16.37.14;	author deraadt;	state Exp;
branches;
next	1.33;

1.33
date	2004.09.17.13.46.34;	author ho;	state Exp;
branches;
next	1.32;

1.32
date	2004.06.25.00.58.39;	author hshoexer;	state Exp;
branches;
next	1.31;

1.31
date	2004.06.20.17.17.35;	author ho;	state Exp;
branches;
next	1.30;

1.30
date	2004.06.20.15.24.05;	author ho;	state Exp;
branches;
next	1.29;

1.29
date	2004.04.15.18.39.25;	author deraadt;	state Exp;
branches;
next	1.28;

1.28
date	2004.04.08.10.05.54;	author hshoexer;	state Exp;
branches;
next	1.27;

1.27
date	2004.02.25.16.01.28;	author hshoexer;	state Exp;
branches;
next	1.26;

1.26
date	2003.11.08.19.17.28;	author jmc;	state Exp;
branches;
next	1.25;

1.25
date	2003.06.04.07.31.16;	author ho;	state Exp;
branches;
next	1.24;

1.24
date	2003.06.03.14.28.16;	author ho;	state Exp;
branches;
next	1.23;

1.23
date	2003.05.18.20.46.29;	author ho;	state Exp;
branches;
next	1.22;

1.22
date	2003.05.16.20.31.15;	author ho;	state Exp;
branches;
next	1.21;

1.21
date	2003.05.15.00.28.53;	author ho;	state Exp;
branches;
next	1.20;

1.20
date	2002.08.07.13.19.20;	author ho;	state Exp;
branches;
next	1.19;

1.19
date	2002.06.10.18.08.58;	author ho;	state Exp;
branches;
next	1.18;

1.18
date	2001.12.10.03.34.51;	author ho;	state Exp;
branches;
next	1.17;

1.17
date	2001.07.06.14.37.11;	author ho;	state Exp;
branches;
next	1.16;

1.16
date	2001.06.25.00.00.44;	author ho;	state Exp;
branches;
next	1.15;

1.15
date	2000.04.07.22.05.08;	author niklas;	state Exp;
branches;
next	1.14;

1.14
date	2000.02.19.19.32.53;	author niklas;	state Exp;
branches;
next	1.13;

1.13
date	2000.02.01.02.46.18;	author niklas;	state Exp;
branches;
next	1.12;

1.12
date	2000.01.31.08.19.05;	author niklas;	state Exp;
branches;
next	1.11;

1.11
date	2000.01.26.15.21.08;	author niklas;	state Exp;
branches;
next	1.10;

1.10
date	99.08.26.22.30.58;	author niklas;	state Exp;
branches;
next	1.9;

1.9
date	99.07.17.21.54.39;	author niklas;	state Exp;
branches;
next	1.8;

1.8
date	99.07.07.22.09.54;	author niklas;	state Exp;
branches;
next	1.7;

1.7
date	99.05.01.20.43.43;	author niklas;	state Exp;
branches;
next	1.6;

1.6
date	99.04.19.19.54.53;	author niklas;	state Exp;
branches;
next	1.5;

1.5
date	99.03.31.20.30.11;	author niklas;	state Exp;
branches;
next	1.4;

1.4
date	99.02.26.03.43.00;	author niklas;	state Exp;
branches;
next	1.3;

1.3
date	98.11.17.11.10.13;	author niklas;	state Exp;
branches;
next	1.2;

1.2
date	98.11.15.00.43.55;	author niklas;	state Exp;
branches;
next	1.1;

1.1
date	98.11.15.00.03.48;	author niklas;	state Exp;
branches
	1.1.1.1;
next	;

1.1.1.1
date	98.11.15.00.03.48;	author niklas;	state Exp;
branches;
next	;


desc
@@


1.41
log
@remove old backwards random junk
ok mikeb
@
text
@/* $OpenBSD: init.c,v 1.40 2010/06/29 19:50:16 reyk Exp $	 */
/* $EOM: init.c,v 1.25 2000/03/30 14:27:24 ho Exp $	 */

/*
 * Copyright (c) 1998, 1999, 2000 Niklas Hallqvist.  All rights reserved.
 * Copyright (c) 2000 Angelos D. Keromytis.  All rights reserved.
 * Copyright (c) 2003, 2004 Håkan Olsson.  All rights reserved.
 *
 * Redistribution and use in source and binary forms, with or without
 * modification, are permitted provided that the following conditions
 * are met:
 * 1. Redistributions of source code must retain the above copyright
 *    notice, this list of conditions and the following disclaimer.
 * 2. Redistributions in binary form must reproduce the above copyright
 *    notice, this list of conditions and the following disclaimer in the
 *    documentation and/or other materials provided with the distribution.
 *
 * THIS SOFTWARE IS PROVIDED BY THE AUTHOR ``AS IS'' AND ANY EXPRESS OR
 * IMPLIED WARRANTIES, INCLUDING, BUT NOT LIMITED TO, THE IMPLIED WARRANTIES
 * OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE ARE DISCLAIMED.
 * IN NO EVENT SHALL THE AUTHOR BE LIABLE FOR ANY DIRECT, INDIRECT,
 * INCIDENTAL, SPECIAL, EXEMPLARY, OR CONSEQUENTIAL DAMAGES (INCLUDING, BUT
 * NOT LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES; LOSS OF USE,
 * DATA, OR PROFITS; OR BUSINESS INTERRUPTION) HOWEVER CAUSED AND ON ANY
 * THEORY OF LIABILITY, WHETHER IN CONTRACT, STRICT LIABILITY, OR TORT
 * (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE USE OF
 * THIS SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.
 */

/*
 * This code was written under funding by Ericsson Radio Systems.
 */

/* XXX This file could easily be built dynamically instead.  */

#include <stdlib.h>

#include "app.h"
#include "cert.h"
#include "conf.h"
#include "connection.h"
#include "doi.h"
#include "exchange.h"
#include "init.h"
#include "ipsec.h"
#include "isakmp_doi.h"
#include "libcrypto.h"
#include "log.h"
#include "dh.h"
#include "monitor.h"
#include "sa.h"
#include "timer.h"
#include "transport.h"
#include "virtual.h"
#include "udp.h"
#include "ui.h"
#include "util.h"
#include "vendor.h"

#include "policy.h"

#include "nat_traversal.h"
#include "udp_encap.h"

void
init(void)
{
	app_init();
	doi_init();
	exchange_init();
	group_init();
	ipsec_init();
	isakmp_doi_init();
	libcrypto_init();

	timer_init();

	/* The following group are depending on timer_init having run.  */
	conf_init();
	connection_init();

	/* This depends on conf_init, thus check as soon as possible. */
	log_reinit();

	/* policy_init depends on conf_init having run.  */
	policy_init();

	/* Depends on conf_init and policy_init having run */
	cert_init();
	crl_init();

	sa_init();
	transport_init();
	virtual_init();
	udp_init();
	nat_t_init();
	udp_encap_init();
	vendor_init();
}

/* Reinitialize, either after a SIGHUP reception or by FIFO UI cmd.  */
void
reinit(void)
{
	log_print("isakmpd: reinitializing daemon");

	/*
	 * XXX Remove all(/some?) pending exchange timers? - they may not be
	 *     possible to complete after we've re-read the config file.
	 *     User-initiated SIGHUP's maybe "authorizes" a wait until
	 *     next connection-check.
	 * XXX This means we discard exchange->last_msg, is this really ok?
         */

	/* Reread config file.  */
	conf_reinit();

	log_reinit();

	/* Reread the policies.  */
	policy_init();

	/* Reinitialize certificates */
	cert_init();
	crl_init();

	/* Reinitialize our connection list.  */
	connection_reinit();

	/*
	 * Rescan interfaces (call reinit() in all transports).
         */
	transport_reinit();

	/*
	 * XXX "These" (non-existent) reinitializations should not be done.
	 * cookie_reinit ();
	 * ui_reinit ();
         */

	sa_reinit();
}
@


1.40
log
@Replace the hand-crafted Diffie-Hellman implementation in isakmpd with
the smaller implementation from iked that is using libcrypto instead.
This allows to remove a lot of code (which is always good), get rid of
some custom crypto code by using libcrypto, theoretically adds
support for many new MODP and EC2N/ECP modes (but it is not configurable
yet), and allows to share the dh.c/dh.h code in different codebases
(it is identical in isakmpd and iked, but could also be used elsewhere).

ok deraadt@@
@
text
@d1 1
a1 1
/* $OpenBSD: init.c,v 1.39 2006/07/02 13:19:00 hshoexer Exp $	 */
a113 6

#if defined(INSECURE_RAND)
	/* Reinitialize PRNG if we are in deterministic mode.  */
	if (regrand)
		srandom(seed);
#endif
@


1.39
log
@Let isakmpd send out a vendor ID announcing isamkpds release version.
Will be handy for release specific bug fixes, etc.  Suggested by
markus@@ quite some time ago.

ok markus@@
@
text
@d1 1
a1 1
/* $OpenBSD: init.c,v 1.38 2006/03/20 16:43:22 hshoexer Exp $	 */
d49 1
a49 1
#include "math_group.h"
@


1.38
log
@make sure the command fifo is ready before isakmpd returns.  This
resolves a startup race when interacting with ipsecctl.  Suggested
by and discussed with moritz@@

ok moritz@@
@
text
@d1 1
a1 1
/* $OpenBSD: init.c,v 1.37 2005/05/26 05:14:17 hshoexer Exp $	 */
d58 1
d98 1
@


1.37
log
@get rid of payload mapping

ok markus ho cloder
@
text
@d1 1
a1 1
/* $OpenBSD: init.c,v 1.36 2005/04/08 22:32:10 cloder Exp $	 */
a96 1
	monitor_ui_init();
@


1.36
log
@Make deterministic randomness (only ever used for testing) a compile-time
option.  Reduces chances of somehow setting regrand when it's not supposed
to be set.  Remove "-r" option from man page.  Also xref certpatch(8) while
we are in there.  And remove some include sysdep.h where it is no longer
needed.
OK hshoexer
@
text
@d1 1
a1 1
/* $OpenBSD: init.c,v 1.35 2005/04/08 17:15:01 deraadt Exp $	 */
a72 1
	message_init();
@


1.35
log
@keynote and policy always compiled in
@
text
@d1 1
a1 1
/* $OpenBSD: init.c,v 1.34 2005/04/08 16:37:14 deraadt Exp $	 */
a37 2
#include "sysdep.h"

d115 1
d119 1
@


1.34
log
@nat-traversal always
@
text
@d1 1
a1 1
/* $OpenBSD: init.c,v 1.33 2004/09/17 13:46:34 ho Exp $	 */
a60 1
#if defined (USE_POLICY)
a61 1
#endif
a86 1
#if defined (USE_POLICY)
a88 1
#endif
a125 1
#if defined (USE_POLICY)
a127 1
#endif
@


1.33
log
@#include <stdlib.h> for srandom().
@
text
@d1 1
a1 1
/* $OpenBSD: init.c,v 1.32 2004/06/25 00:58:39 hshoexer Exp $	 */
a64 1
#if defined (USE_NAT_TRAVERSAL)
a66 1
#endif
a101 1
#if defined (USE_NAT_TRAVERSAL)
a103 1
#endif
@


1.32
log
@Narrow down privsep interface.  Remove ui_init to monitor. So we can get rid of
monitor_mkfifo.

Work in progress.

ok ho@@
@
text
@d1 1
a1 1
/* $OpenBSD: init.c,v 1.31 2004/06/20 17:17:35 ho Exp $	 */
d35 2
@


1.31
log
@Make the payload array in struct message dynamic, since we need to handle
payloads in the private range, such as the pre-RFC NAT-D/NAT-OA.
Replace TAILQ_FIRST(&msg->payload[i]) instances with function calls.
@
text
@d1 1
a1 1
/* $OpenBSD: init.c,v 1.30 2004/06/20 15:24:05 ho Exp $	 */
d50 1
d106 1
a106 1
	ui_init();
@


1.30
log
@NAT-Traversal for isakmpd. Work in progress...
hshoexer@@ ok.
@
text
@d1 1
a1 1
/* $OpenBSD: init.c,v 1.29 2004/04/15 18:39:25 deraadt Exp $	 */
d76 1
@


1.29
log
@partial move to KNF.  More to come.  This has happened because there
are a raft of source code auditors who are willing to help improve this
code only if this is done, and hey, isakmpd does need our standard
auditing process.  ok ho hshoexer
@
text
@d1 1
a1 1
/* $OpenBSD: init.c,v 1.28 2004/04/08 10:05:54 hshoexer Exp $	 */
d7 1
a7 1
 * Copyright (c) 2003 Håkan Olsson.  All rights reserved.
d53 1
d58 1
a58 1
#ifdef USE_POLICY
d62 5
d87 1
a87 1
#ifdef USE_POLICY
d98 1
d100 4
d130 1
a130 1
#ifdef USE_POLICY
d143 1
a143 1
	 * Rescan interfaces.
@


1.28
log
@Set timezone before privsep, child uses now correct timezone.
Noticed by david@@

ok ho@@ david@@
@
text
@d1 2
a2 2
/*	$OpenBSD: init.c,v 1.27 2004/02/25 16:01:28 hshoexer Exp $	*/
/*	$EOM: init.c,v 1.25 2000/03/30 14:27:24 ho Exp $	*/
d62 1
a62 1
init (void)
d64 13
a76 13
  app_init ();
  doi_init ();
  exchange_init ();
  group_init ();
  ipsec_init ();
  isakmp_doi_init ();
  libcrypto_init ();

  timer_init ();

  /* The following group are depending on timer_init having run.  */
  conf_init ();
  connection_init ();
d78 2
a79 2
   /* This depends on conf_init, thus check as soon as possible. */
  log_reinit ();
d82 2
a83 2
  /* policy_init depends on conf_init having run.  */
  policy_init ();
d86 8
a93 8
  /* Depends on conf_init and policy_init having run */
  cert_init ();
  crl_init ();

  sa_init ();
  transport_init ();
  udp_init ();
  ui_init ();
d98 1
a98 1
reinit (void)
d100 1
a100 1
  log_print ("isakmpd: reinitializing daemon");
d102 11
a112 11
  /*
   * XXX Remove all(/some?) pending exchange timers? - they may not be
   *     possible to complete after we've re-read the config file.
   *     User-initiated SIGHUP's maybe "authorizes" a wait until
   *     next connection-check.
   * XXX This means we discard exchange->last_msg, is this really ok?
   */

  /* Reinitialize PRNG if we are in deterministic mode.  */
  if (regrand)
    srandom (seed);
d114 2
a115 2
  /* Reread config file.  */
  conf_reinit ();
d117 1
a117 1
  log_reinit ();
d120 2
a121 2
  /* Reread the policies.  */
  policy_init ();
d124 17
a140 17
  /* Reinitialize certificates */
  cert_init ();
  crl_init ();

  /* Reinitialize our connection list.  */
  connection_reinit ();

  /*
   * Rescan interfaces.
   */
  transport_reinit ();

  /*
   * XXX "These" (non-existent) reinitializations should not be done.
   *   cookie_reinit ();
   *   ui_reinit ();
   */
d142 1
a142 1
  sa_reinit ();
@


1.27
log
@Add and document configuration options Logverbose and Loglevel.  As log.c now
depends on conf.c and some regression tests use log.c, add conf.c to
Makefiles where necessary.

ok ho@@
@
text
@d1 1
a1 1
/*	$OpenBSD: init.c,v 1.26 2003/11/08 19:17:28 jmc Exp $	*/
a71 2
  tzset ();

a117 3

  /* Set timezone */
  tzset ();
@


1.26
log
@typos from Jonathon Gray;
@
text
@d1 1
a1 1
/*	$OpenBSD: init.c,v 1.25 2003/06/04 07:31:16 ho Exp $	*/
d80 3
d118 2
@


1.25
log
@Remove the rest of clauses 3 and 4. Approved by Niklas Hallqvist, Angelos
D. Keromytis and Niels Provos.
@
text
@d1 1
a1 1
/*	$OpenBSD: init.c,v 1.24 2003/06/03 14:28:16 ho Exp $	*/
d137 1
a137 1
   * XXX "These" (non-existant) reinitializations should not be done.
@


1.24
log
@Remove clauses 3 and 4. With approval from Niklas Hallqvist and
Niels Provos.
@
text
@d1 1
a1 1
/*	$OpenBSD: init.c,v 1.23 2003/05/18 20:46:29 ho Exp $	*/
a16 5
 * 3. All advertising materials mentioning features or use of this software
 *    must display the following acknowledgement:
 *	This product includes software developed by Ericsson Radio Systems.
 * 4. The name of the author may not be used to endorse or promote products
 *    derived from this software without specific prior written permission.
@


1.23
log
@Style tweak.
@
text
@d1 1
a1 1
/*	$OpenBSD: init.c,v 1.22 2003/05/16 20:31:15 ho Exp $	*/
d7 1
@


1.22
log
@If the "Renegotiate-on-HUP" tag is defined in the [General] section, a
HUP signal (or "R" to the FIFO) will also renegotiate all Phase 2 SAs,
i.e all connections.
ok niklas@@, tested and ok kjell@@.
@
text
@d1 1
a1 1
/*	$OpenBSD: init.c,v 1.21 2003/05/15 00:28:53 ho Exp $	*/
d103 1
a103 1
  log_print ("reinitializing daemon");
@


1.21
log
@Start of privilege separation for isakmpd.
There are some kinks left, so keep it default disabled for now.
markus@@ says ok to commit.
@
text
@d1 1
a1 1
/*	$OpenBSD: init.c,v 1.20 2002/08/07 13:19:20 ho Exp $	*/
a143 1
   *   sa_reinit ();
d145 2
@


1.20
log
@A rewrite of the CRL support code, also from <Thomas.Walpuski@@gmx.net>.
Some style mods, and checks added for OpenSSL version 0.9.7 or later.
Currently CRLs are not supported for earlier versions.
Manual pages updated.
@
text
@d1 1
a1 1
/*	$OpenBSD: init.c,v 1.19 2002/06/10 18:08:58 ho Exp $	*/
a67 1
  log_init ();
@


1.19
log
@The dlopen() stuff goes away.
@
text
@d1 1
a1 1
/*	$OpenBSD: init.c,v 1.18 2001/12/10 03:34:51 ho Exp $	*/
d92 1
d131 1
@


1.18
log
@Add UI option 'R' to trigger isakmpd reinit (same as SIGHUP).
@
text
@d1 1
a1 1
/*	$OpenBSD: init.c,v 1.17 2001/07/06 14:37:11 ho Exp $	*/
a118 3

  /* Try again to link in libcrypto (good if we started without /usr).  */
  libcrypto_init ();
@


1.17
log
@Style.
@
text
@d1 1
a1 1
/*	$OpenBSD: init.c,v 1.16 2001/06/25 00:00:44 ho Exp $	*/
d59 1
d97 51
@


1.16
log
@Handle responder cookies same as initiator cookies.
@
text
@d1 1
a1 1
/*	$OpenBSD: init.c,v 1.15 2000/04/07 22:05:08 niklas Exp $	*/
d65 1
a65 1
init ()
@


1.15
log
@init.c: Merge with EOM 1.25
log.h: Merge with EOM 1.19

author: ho
Add log_init().
@
text
@d1 1
a1 1
/*	$OpenBSD: init.c,v 1.14 2000/02/19 19:32:53 niklas Exp $	*/
a45 1
#include "cookie.h"
a82 1
  cookie_init ();
@


1.14
log
@cert.c: Merge with EOM 1.14
ike_auth.c: Merge with EOM 1.43
ike_phase_1.c: Merge with EOM 1.21
init.c: Merge with EOM 1.24
ipsec.c: Merge with EOM 1.117
isakmpd.c: Merge with EOM 1.44
math_group.c: Merge with EOM 1.22

author: niklas
Copyright 2000

author: niklas
Allow isakmpd builders to remove optional parts and save bytes.
@
text
@d1 2
a2 2
/*	$OpenBSD: init.c,v 1.13 2000/02/01 02:46:18 niklas Exp $	*/
/*	$EOM: init.c,v 1.24 2000/02/19 07:58:55 niklas Exp $	*/
d53 1
d68 1
@


1.13
log
@apps/certpatch/certpatch.8: Merge with EOM 1.4
apps/certpatch/certpatch.c: Merge with EOM 1.6
exchange.c: Merge with EOM 1.114
ike_quick_mode.c: Merge with EOM 1.110
ike_phase_1.c: Merge with EOM 1.16
ike_auth.c: Merge with EOM 1.41
ike_aggressive.c: Merge with EOM 1.4
libcrypto.c: Merge with EOM 1.10
libcrypto.h: Merge with EOM 1.10
isakmpd.8: Merge with EOM 1.19
isakmpd.c: Merge with EOM 1.42
ipsec.h: Merge with EOM 1.40
init.c: Merge with EOM 1.22
message.c: Merge with EOM 1.143
message.h: Merge with EOM 1.49
sa.c: Merge with EOM 1.98
sa.h: Merge with EOM 1.54
policy.c: Merge with EOM 1.14
pf_key_v2.c: Merge with EOM 1.36
x509.c: Merge with EOM 1.32
x509.h: Merge with EOM 1.9
udp.c: Merge with EOM 1.46

author: niklas
Angelos copyrights
@
text
@d1 2
a2 2
/*	$OpenBSD: init.c,v 1.12 2000/01/31 08:19:05 niklas Exp $	*/
/*	$EOM: init.c,v 1.22 2000/01/31 22:33:46 niklas Exp $	*/
d5 1
a5 1
 * Copyright (c) 1998, 1999 Niklas Hallqvist.  All rights reserved.
d60 1
a60 1
#if defined (USE_KEYNOTE) || defined (HAVE_DLOPEN)
d84 1
a84 1
#if defined (USE_KEYNOTE) || defined (HAVE_DLOPEN)
@


1.12
log
@Merge with EOM 1.21

author: angelos
Remove empty line.

author: angelos
Change the order of initializing x509 and policy (x509 depends on policy).
@
text
@d1 2
a2 2
/*	$OpenBSD: init.c,v 1.11 2000/01/26 15:21:08 niklas Exp $	*/
/*	$EOM: init.c,v 1.21 2000/01/31 05:28:50 angelos Exp $	*/
d6 1
@


1.11
log
@isakmpd.c: Merge with EOM 1.39
init.c: Merge with EOM 1.19

author: angelos
GMTTimeOfDay and LocalTimeOfDay attributes, comment in x509.c.
@
text
@d1 2
a2 2
/*	$OpenBSD: init.c,v 1.10 1999/08/26 22:30:58 niklas Exp $	*/
/*	$EOM: init.c,v 1.19 1999/10/10 22:48:36 angelos Exp $	*/
d83 6
a88 1
  /* Depends on conf_init having run */
a94 5

#if defined (USE_KEYNOTE) || defined (HAVE_DLOPEN)
  /* policy_init depends on conf_init having run.  */
  policy_init ();
#endif
@


1.10
log
@Merge with EOM 1.18

author: niklas
Support dynamic loading of libkeynote too.  Build isakmpd static by default.
Stylistic cleanup of keynote policy code.  Correct some libcrypto calls.

author: niklas
Add support for dynamic loading of optional facilities, libcrypto first.
@
text
@d1 2
a2 2
/*	$OpenBSD: init.c,v 1.9 1999/07/17 21:54:39 niklas Exp $	*/
/*	$EOM: init.c,v 1.18 1999/08/26 11:21:49 niklas Exp $	*/
d73 3
@


1.9
log
@regress/rsakeygen/Makefile: Merge with EOM 1.4
regress/rsakeygen/rsakeygen.c: Merge with EOM 1.8
regress/x509/Makefile: Merge with EOM 1.6
regress/x509/x509test.c: Merge with EOM 1.6
regress/Makefile: Merge with EOM 1.8
samples/VPN-east.conf: Merge with EOM 1.6
samples/VPN-west.conf: Merge with EOM 1.6
samples/singlehost-east.conf: Merge with EOM 1.3
samples/singlehost-west.conf: Merge with EOM 1.3
sysdep/openbsd/Makefile.sysdep: Merge with EOM 1.5
x509.h: Merge with EOM 1.6
x509.c: Merge with EOM 1.17
DESIGN-NOTES: Merge with EOM 1.46
Makefile: Merge with EOM 1.55
cert.c: Merge with EOM 1.11
cert.h: Merge with EOM 1.6
exchange.c: Merge with EOM 1.109
exchange.h: Merge with EOM 1.26
ike_auth.c: Merge with EOM 1.32
ike_phase_1.c: Merge with EOM 1.7
init.c: Merge with EOM 1.16
isakmpd.conf.5: Merge with EOM 1.27
README.PKI: Merge with EOM 1.1

author: niklas
From Niels Provos, edited by me: certificate support using SSLeay
@
text
@d1 2
a2 2
/*	$OpenBSD: init.c,v 1.8 1999/07/07 22:09:54 niklas Exp $	*/
/*	$EOM: init.c,v 1.16 1999/07/17 20:44:10 niklas Exp $	*/
d51 1
d59 1
a59 1
#ifdef USE_KEYNOTE
d72 1
d88 2
a89 2
#ifdef USE_KEYNOTE
  /* policy_init depends on conf_init having run. */
@


1.8
log
@exchange.h: Merge with EOM 1.25
ike_quick_mode.c: Merge with EOM 1.90
init.c: Merge with EOM 1.15

author: ho
Add keynote policy support (with USE_KEYNOTE). angelos@@openbsd.org
@
text
@d1 2
a2 2
/*	$OpenBSD: init.c,v 1.7 1999/05/01 20:43:43 niklas Exp $	*/
/*	$EOM: init.c,v 1.15 1999/06/07 00:02:14 ho Exp $	*/
d42 1
d77 3
@


1.7
log
@sysdep/openbsd/sysdep.c: Merge with EOM 1.7
DESIGN-NOTES: Merge with EOM 1.42
Makefile: Merge with EOM 1.51
app.c: Merge with EOM 1.6
conf.c: Merge with EOM 1.18
init.c: Merge with EOM 1.14
isakmpd.conf.5: Merge with EOM 1.19
pf_encap.c: Merge with EOM 1.64
pf_encap.h: Merge with EOM 1.12
pf_key_v2.h: Merge with EOM 1.3
sysdep.h: Merge with EOM 1.16
transport.c: Merge with EOM 1.40
ui.c: Merge with EOM 1.32

author: niklas
A new connection abstraction
@
text
@d1 2
a2 2
/*	$OpenBSD: init.c,v 1.6 1999/04/19 19:54:53 niklas Exp $	*/
/*	$EOM: init.c,v 1.14 1999/05/01 20:21:09 niklas Exp $	*/
d57 4
d81 5
@


1.6
log
@./app.c: Merge with EOM 1.5
./gmp_util.c: Merge with EOM 1.3
./asn_useful.c: Merge with EOM 1.11
./attribute.c: Merge with EOM 1.9
./constants.c: Merge with EOM 1.7
./doi.h: Merge with EOM 1.25
./doi.c: Merge with EOM 1.4
./field.c: Merge with EOM 1.9
./init.c: Merge with EOM 1.13
./isakmp_doi.c: Merge with EOM 1.35
./prf.c: Merge with EOM 1.6
./util.c: Merge with EOM 1.14
./app.h: Merge with EOM 1.4
./conf.h: Merge with EOM 1.8
./ipsec.h: Merge with EOM 1.34
./ipsec_doi.h: Merge with EOM 1.10
./pkcs.h: Merge with EOM 1.8
./sysdep.h: Merge with EOM 1.15

1999 copyrights
@
text
@d1 2
a2 2
/*	$OpenBSD: init.c,v 1.5 1999/03/31 20:30:11 niklas Exp $	*/
/*	$EOM: init.c,v 1.13 1999/04/02 00:57:47 niklas Exp $	*/
d43 1
d70 1
@


1.5
log
@Merge with EOM 1.12
do conf.c init after timer.c
@
text
@d1 2
a2 2
/*	$OpenBSD: init.c,v 1.4 1999/02/26 03:43:00 niklas Exp $	*/
/*	$EOM: init.c,v 1.12 1999/03/31 20:25:25 niklas Exp $	*/
d5 1
a5 1
 * Copyright (c) 1998 Niklas Hallqvist.  All rights reserved.
@


1.4
log
@Merge from the Ericsson repository
| revision 1.11
| date: 1999/02/25 11:39:06;  author: niklas;  state: Exp;  lines: +3 -1
| include sysdep.h everywhere
| ----------------------------
@
text
@d1 2
a2 2
/*	$OpenBSD: init.c,v 1.3 1998/11/17 11:10:13 niklas Exp $	*/
/*	$EOM: init.c,v 1.11 1999/02/25 11:39:06 niklas Exp $	*/
a59 1
  conf_init ();
d66 5
a70 1
  cookie_init ();	/* Depends on properly setup timer queue */
@


1.3
log
@Add RCS Ids from the EOM repository
@
text
@d1 2
a2 2
/*	$OpenBSD: init.c,v 1.2 1998/11/15 00:43:55 niklas Exp $	*/
/*	$EOM: init.c,v 1.10 1998/09/12 19:34:36 niklas Exp $	*/
d38 2
@


1.2
log
@openBSD RCS IDs
@
text
@d1 2
a2 1
/*	$OpenBSD: init.c,v 1.1.1.1 1998/11/15 00:03:48 niklas Exp $	*/
@


1.1
log
@Initial revision
@
text
@d1 1
a1 1
/*	$Id: init.c,v 1.10 1998/09/12 19:34:36 niklas Exp $	*/
@


1.1.1.1
log
@Initial import of isakmpd, an IKE (ISAKMP/Oakley) implementation for the
OpenBSD IPSEC stack by me, Niklas Hallqvist and Niels Provos, funded by
Ericsson Radio Systems.  It is not yet complete or usable in a real scenario
but the missing pieces will soon be there.  The early commit is for people
who wants early access and who are not afraid of looking at source.
isakmpd interops with Cisco, Timestep, SSH & Pluto (Linux FreeS/WAN) so
far, so it is not that incomplete.  It is really mostly configuration that
is lacking.
@
text
@@
