head	1.51;
access;
symbols
	OPENBSD_6_2:1.51.0.2
	OPENBSD_6_2_BASE:1.51
	OPENBSD_6_1:1.51.0.4
	OPENBSD_6_1_BASE:1.51
	OPENBSD_6_0:1.50.0.4
	OPENBSD_6_0_BASE:1.50
	OPENBSD_5_9:1.50.0.2
	OPENBSD_5_9_BASE:1.50
	OPENBSD_5_8:1.49.0.4
	OPENBSD_5_8_BASE:1.49
	OPENBSD_5_7:1.48.0.2
	OPENBSD_5_7_BASE:1.48
	OPENBSD_5_6:1.48.0.4
	OPENBSD_5_6_BASE:1.48
	OPENBSD_5_5:1.45.0.6
	OPENBSD_5_5_BASE:1.45
	OPENBSD_5_4:1.45.0.2
	OPENBSD_5_4_BASE:1.45
	OPENBSD_5_3:1.44.0.22
	OPENBSD_5_3_BASE:1.44
	OPENBSD_5_2:1.44.0.20
	OPENBSD_5_2_BASE:1.44
	OPENBSD_5_1_BASE:1.44
	OPENBSD_5_1:1.44.0.18
	OPENBSD_5_0:1.44.0.16
	OPENBSD_5_0_BASE:1.44
	OPENBSD_4_9:1.44.0.14
	OPENBSD_4_9_BASE:1.44
	OPENBSD_4_8:1.44.0.12
	OPENBSD_4_8_BASE:1.44
	OPENBSD_4_7:1.44.0.8
	OPENBSD_4_7_BASE:1.44
	OPENBSD_4_6:1.44.0.10
	OPENBSD_4_6_BASE:1.44
	OPENBSD_4_5:1.44.0.6
	OPENBSD_4_5_BASE:1.44
	OPENBSD_4_4:1.44.0.4
	OPENBSD_4_4_BASE:1.44
	OPENBSD_4_3:1.44.0.2
	OPENBSD_4_3_BASE:1.44
	OPENBSD_4_2:1.41.0.2
	OPENBSD_4_2_BASE:1.41
	OPENBSD_4_1:1.40.0.2
	OPENBSD_4_1_BASE:1.40
	OPENBSD_4_0:1.35.0.6
	OPENBSD_4_0_BASE:1.35
	OPENBSD_3_9:1.35.0.4
	OPENBSD_3_9_BASE:1.35
	OPENBSD_3_8:1.35.0.2
	OPENBSD_3_8_BASE:1.35
	OPENBSD_3_7:1.34.0.8
	OPENBSD_3_7_BASE:1.34
	OPENBSD_3_6:1.34.0.6
	OPENBSD_3_6_BASE:1.34
	OPENBSD_3_5:1.34.0.4
	OPENBSD_3_5_BASE:1.34
	OPENBSD_3_4:1.34.0.2
	OPENBSD_3_4_BASE:1.34
	OPENBSD_3_3:1.29.0.2
	OPENBSD_3_3_BASE:1.29
	OPENBSD_3_2:1.28.0.4
	OPENBSD_3_2_BASE:1.28
	OPENBSD_3_1:1.28.0.2
	OPENBSD_3_1_BASE:1.28
	OPENBSD_3_0:1.25.0.2
	OPENBSD_3_0_BASE:1.25
	OPENBSD_2_9:1.24.0.6
	OPENBSD_2_9_BASE:1.24
	OPENBSD_2_8:1.24.0.4
	OPENBSD_2_8_BASE:1.24
	OPENBSD_2_7:1.24.0.2
	OPENBSD_2_7_BASE:1.24
	OPENBSD_2_6:1.21.0.2
	OPENBSD_2_6_BASE:1.21
	OPENBSD_2_5:1.16.0.2
	OPENBSD_2_5_BASE:1.16
	OPENBSD_2_4:1.14.0.2
	OPENBSD_2_4_BASE:1.14
	OPENBSD_2_3:1.11.0.2
	OPENBSD_2_3_BASE:1.11
	OPENBSD_2_2:1.10.0.2
	OPENBSD_2_2_BASE:1.10
	OPENBSD_2_1:1.7.0.2
	OPENBSD_2_1_BASE:1.7
	OPENBSD_2_0:1.3.0.2
	OPENBSD_2_0_BASE:1.3
	netbsd_1_1:1.1.1.1;
locks; strict;
comment	@.\" @;


1.51
date	2016.10.06.11.43.30;	author schwarze;	state Exp;
branches;
next	1.50;
commitid	tIWZ1YQuK8L4Fdpk;

1.50
date	2015.11.21.19.43.50;	author jmc;	state Exp;
branches;
next	1.49;
commitid	BLIpVU02Vbh7iC7F;

1.49
date	2015.05.03.01.44.34;	author guenther;	state Exp;
branches;
next	1.48;
commitid	VGweZq0m0ga9jNw5;

1.48
date	2014.07.17.19.58.05;	author jmc;	state Exp;
branches;
next	1.47;
commitid	4jByPVCtnVQqsI25;

1.47
date	2014.07.11.16.01.41;	author halex;	state Exp;
branches;
next	1.46;
commitid	gCk3OFggNKp4mxan;

1.46
date	2014.05.30.20.48.21;	author stephan;	state Exp;
branches;
next	1.45;

1.45
date	2013.04.04.10.47.21;	author zhuk;	state Exp;
branches;
next	1.44;

1.44
date	2008.01.26.23.07.55;	author jmc;	state Exp;
branches;
next	1.43;

1.43
date	2007.11.19.09.23.11;	author jmc;	state Exp;
branches;
next	1.42;

1.42
date	2007.11.18.18.56.25;	author otto;	state Exp;
branches;
next	1.41;

1.41
date	2007.05.31.19.19.44;	author jmc;	state Exp;
branches;
next	1.40;

1.40
date	2007.02.25.16.56.32;	author jmc;	state Exp;
branches;
next	1.39;

1.39
date	2007.02.25.16.48.46;	author jmc;	state Exp;
branches;
next	1.38;

1.38
date	2007.02.25.16.29.49;	author jmc;	state Exp;
branches;
next	1.37;

1.37
date	2007.02.25.09.39.48;	author jmc;	state Exp;
branches;
next	1.36;

1.36
date	2007.02.22.09.40.11;	author jmc;	state Exp;
branches;
next	1.35;

1.35
date	2005.08.02.10.49.49;	author jmc;	state Exp;
branches;
next	1.34;

1.34
date	2003.07.15.10.28.29;	author jmc;	state Exp;
branches;
next	1.33;

1.33
date	2003.06.04.16.08.07;	author deraadt;	state Exp;
branches;
next	1.32;

1.32
date	2003.06.03.13.16.08;	author jmc;	state Exp;
branches;
next	1.31;

1.31
date	2003.04.09.04.17.21;	author jmc;	state Exp;
branches;
next	1.30;

1.30
date	2003.04.08.11.06.01;	author jmc;	state Exp;
branches;
next	1.29;

1.29
date	2003.02.01.16.29.53;	author jmc;	state Exp;
branches;
next	1.28;

1.28
date	2002.02.22.21.01.47;	author deraadt;	state Exp;
branches;
next	1.27;

1.27
date	2002.02.11.18.43.51;	author mpech;	state Exp;
branches;
next	1.26;

1.26
date	2001.12.13.20.16.48;	author mpech;	state Exp;
branches;
next	1.25;

1.25
date	2001.10.04.22.28.03;	author ho;	state Exp;
branches;
next	1.24;

1.24
date	2000.03.24.21.41.08;	author aaron;	state Exp;
branches;
next	1.23;

1.23
date	2000.03.18.22.55.55;	author aaron;	state Exp;
branches;
next	1.22;

1.22
date	2000.03.05.00.28.49;	author aaron;	state Exp;
branches;
next	1.21;

1.21
date	99.10.17.19.59.45;	author aaron;	state Exp;
branches;
next	1.20;

1.20
date	99.07.04.18.59.38;	author aaron;	state Exp;
branches;
next	1.19;

1.19
date	99.06.04.02.45.15;	author aaron;	state Exp;
branches;
next	1.18;

1.18
date	99.05.26.03.21.03;	author aaron;	state Exp;
branches;
next	1.17;

1.17
date	99.05.23.14.11.14;	author aaron;	state Exp;
branches;
next	1.16;

1.16
date	98.12.15.01.20.29;	author aaron;	state Exp;
branches;
next	1.15;

1.15
date	98.11.28.19.56.18;	author aaron;	state Exp;
branches;
next	1.14;

1.14
date	98.09.23.01.20.22;	author aaron;	state Exp;
branches;
next	1.13;

1.13
date	98.09.17.04.14.52;	author aaron;	state Exp;
branches;
next	1.12;

1.12
date	98.05.06.14.35.09;	author deraadt;	state Exp;
branches;
next	1.11;

1.11
date	98.01.03.08.19.45;	author deraadt;	state Exp;
branches;
next	1.10;

1.10
date	97.07.27.06.28.21;	author deraadt;	state Exp;
branches;
next	1.9;

1.9
date	97.07.05.05.35.53;	author millert;	state Exp;
branches;
next	1.8;

1.8
date	97.06.02.08.48.32;	author deraadt;	state Exp;
branches;
next	1.7;

1.7
date	97.04.27.10.55.31;	author downsj;	state Exp;
branches;
next	1.6;

1.6
date	97.04.16.04.09.20;	author millert;	state Exp;
branches;
next	1.5;

1.5
date	97.02.10.04.19.55;	author millert;	state Exp;
branches;
next	1.4;

1.4
date	97.02.03.11.53.24;	author deraadt;	state Exp;
branches;
next	1.3;

1.3
date	96.06.23.14.30.09;	author deraadt;	state Exp;
branches;
next	1.2;

1.2
date	96.02.22.11.26.21;	author niklas;	state Exp;
branches;
next	1.1;

1.1
date	95.10.18.08.43.28;	author deraadt;	state Exp;
branches
	1.1.1.1;
next	;

1.1.1.1
date	95.10.18.08.43.28;	author deraadt;	state Exp;
branches;
next	;


desc
@@


1.51
log
@fix HISTORY;
patches from Sevan Janiyan <venture37 at geeklan dot co dot uk>;
verified using minnie.tuhs.org/cgi-bin/utree.pl
@
text
@.\"	$OpenBSD: dump.8,v 1.50 2015/11/21 19:43:50 jmc Exp $
.\"	$NetBSD: dump.8,v 1.17 1997/06/05 11:15:06 lukem Exp $
.\"
.\" Copyright (c) 1980, 1991, 1993
.\"	 Regents of the University of California.
.\" All rights reserved.
.\"
.\" Redistribution and use in source and binary forms, with or without
.\" modification, are permitted provided that the following conditions
.\" are met:
.\" 1. Redistributions of source code must retain the above copyright
.\"    notice, this list of conditions and the following disclaimer.
.\" 2. Redistributions in binary form must reproduce the above copyright
.\"    notice, this list of conditions and the following disclaimer in the
.\"    documentation and/or other materials provided with the distribution.
.\" 3. Neither the name of the University nor the names of its contributors
.\"    may be used to endorse or promote products derived from this software
.\"    without specific prior written permission.
.\"
.\" THIS SOFTWARE IS PROVIDED BY THE REGENTS AND CONTRIBUTORS ``AS IS'' AND
.\" ANY EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT LIMITED TO, THE
.\" IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE
.\" ARE DISCLAIMED.  IN NO EVENT SHALL THE REGENTS OR CONTRIBUTORS BE LIABLE
.\" FOR ANY DIRECT, INDIRECT, INCIDENTAL, SPECIAL, EXEMPLARY, OR CONSEQUENTIAL
.\" DAMAGES (INCLUDING, BUT NOT LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS
.\" OR SERVICES; LOSS OF USE, DATA, OR PROFITS; OR BUSINESS INTERRUPTION)
.\" HOWEVER CAUSED AND ON ANY THEORY OF LIABILITY, WHETHER IN CONTRACT, STRICT
.\" LIABILITY, OR TORT (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY
.\" OUT OF THE USE OF THIS SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF
.\" SUCH DAMAGE.
.\"
.\"     @@(#)dump.8	8.1 (Berkeley) 6/16/93
.\"
.Dd $Mdocdate: November 21 2015 $
.Dt DUMP 8
.Os
.Sh NAME
.Nm dump ,
.Nm rdump
.Nd filesystem backup
.Sh SYNOPSIS
.Nm dump
.Bk -words
.Op Fl 0123456789acnSuWw
.Op Fl B Ar records
.Op Fl b Ar blocksize
.Op Fl d Ar density
.Op Fl f Ar file
.Op Fl h Ar level
.Op Fl s Ar feet
.Op Fl T Ar date
.Ar files-to-dump
.Ek
.Sh DESCRIPTION
.Nm
examines files
on a filesystem
and determines which files
need to be backed up.
These files are copied to the given disk, tape or other
storage medium for safe keeping.
A dump that is larger than the output medium is broken into
multiple volumes.
On most media the size is determined by writing until an
end-of-media indication is returned.
This can be enforced by using the
.Fl a
option.
.Pp
.Nm
works across networks,
replacing the functionality of the old
.Nm rdump
program
(though
.Nm
may still be invoked as
.Nm rdump ) .
See the
.Fl f
option for more on writing backups to remote hosts.
.Pp
Files can be marked with the
.Dq nodump
flag using
.Xr chflags 1 ,
settable only by the file's owner or the superuser.
Files with this flag set will only be dumped during full backups.
When set on a directory,
.Dq nodump
effectively deselects the whole subtree from being dumped,
though it will still be scanned.
See also the
.Fl h
option, below.
.Pp
On media that cannot reliably return an end-of-media indication
(such as some cartridge tape drives),
each volume is of a fixed size;
the actual size is determined by the tape size, density and/or
block count options below.
By default, the same output file name is used for each volume
after prompting the operator to change media.
.Pp
Rewinding or ejecting tape features after a close operation on
a tape device depend on the name of the tape unit device used.
See the
.Fl f
option and
.Xr st 4
for more information.
.Pp
The options are as follows:
.Bl -tag -width Ds
.It Fl 0\-9
Dump levels.
A level 0, full backup,
guarantees the entire file system is copied
(but see also the
.Fl h
option below).
A level number above 0,
incremental backup,
tells
.Nm
to
copy all files new or modified since the
last dump of a lower level.
The default level is 0.
.It Fl a
.Dq auto-size .
Bypass all tape length considerations, and enforce writing until
an end-of-media indication is returned.
This option is recommended for most modern tape drives.
Use of this option is particularly
recommended when appending to an existing tape, or using a tape
drive with hardware compression (where you can never be sure about
the compression ratio).
.It Fl B Ar records
The number of kilobytes per volume, rounded
down to a multiple of the blocksize.
This option overrides the calculation of tape size
based on length and density.
.It Fl b Ar blocksize
The number of kilobytes per dump record.
Since the I/O system slices all requests into chunks of MAXBSIZE
(typically 64KB), it is not possible to use a larger blocksize
without having problems later with
.Xr restore 8 .
Therefore
.Nm
will constrain writes to MAXBSIZE.
.It Fl c
Change the defaults for use with a cartridge tape drive, with a density
of 8000 bpi, and a length of 1700 feet.
.It Fl d Ar density
Set tape density to
.Ar density .
The default is 1600BPI.
.It Fl f Ar file
Write the backup to
.Ar file ;
.Ar file
may be a special device file
like
.Pa /dev/rst0
(a tape drive),
.Pa /dev/rsd1c
(a disk drive),
an ordinary file,
or
.Sq -
(the standard output).
See also the
.Ev TAPE
environment variable, below.
.Pp
Multiple file names may be given as a single argument separated by commas.
Each file will be used for one dump volume in the order listed;
if the dump requires more volumes than the number of names given,
the last file name will be used for all remaining volumes after prompting
for media changes.
If the name of the file is of the form
.Dq host:file
or
.Dq user@@host:file ,
.Nm
writes to the named file on the remote host using
.Xr rmt 8 .
.It Fl h Ar level
Honor the user
.Dq nodump
flag (see above),
only for dumps at or above the given
.Ar level .
The default honor level is 1,
so that incremental backups omit such files
but full backups retain them.
.It Fl n
Whenever
.Nm
requires operator attention,
notify all operators in the group
.Dq operator
by means similar to a
.Xr wall 1 .
.It Fl S
Display an estimate of the backup size and the number of tapes
required, and exit without actually performing the dump.
.It Fl s Ar feet
Attempt to calculate the amount of tape needed
at a particular density.
If this amount is exceeded,
.Nm
prompts for a new tape.
It is recommended to be a bit conservative on this option.
The default tape length is 2300 feet.
.It Fl T Ar date
Use the specified date as the starting time for the dump
instead of the time determined from looking in
.Pa /etc/dumpdates .
The format of
.Ar date
is the same as that of
.Xr ctime 3 .
This option is useful for automated dump scripts that wish to
dump over a specific period of time.
The
.Fl T
flag is mutually exclusive from the
.Fl u
flag.
.It Fl u
Update the file
.Pa /etc/dumpdates
after a successful dump.
The format of
.Pa /etc/dumpdates
is human readable, consisting of one
free format record per line:
filesystem name (defaults to
.Xr disklabel 8
UID when possible),
increment level
and
.Xr ctime 3
format dump date.
There may be only one entry per filesystem at each level.
The file
.Pa /etc/dumpdates
may be edited to change any of the fields,
if necessary.
If a list of files or subdirectories is being dumped
(as opposed to an entire filesystem), then
.Fl u
is ignored.
.It Fl W
.Nm
tells the operator what file systems need to be dumped.
This information is gleaned from the files
.Pa /etc/dumpdates
and
.Pa /etc/fstab .
The
.Fl W
flag causes
.Nm
to print out, for each file system in
.Pa /etc/dumpdates ,
the most recent dump date and level,
and highlights those file systems that should be dumped.
If the
.Fl W
flag is set, all other options are ignored, and
.Nm
exits immediately.
.It Fl w
Same as
.Fl W ,
but prints only those filesystems which need to be dumped.
.El
.Pp
.Ar files-to-dump
is either a mountpoint of a filesystem
or a list of files and directories on a single filesystem to be backed
up as a subset of the filesystem.
In the former case, either the path to a mounted filesystem,
the device of an unmounted filesystem or the
.Xr disklabel 8
UID can be used.
In the latter case, certain restrictions are placed on the backup:
.Fl u
is ignored, the only dump level that is supported is
.Fl 0 ,
and all of the files must reside on the same filesystem.
.Pp
.Nm
requires operator intervention on these conditions:
end of tape,
end of dump,
tape write error,
tape open error or
disk read error (if there is more than a threshold of 32).
In addition to alerting all operators implied by the
.Fl n
flag,
.Nm
interacts with the operator on
.Nm dump Ns 's
control terminal at times when
.Nm
can no longer proceed,
or if something is grossly wrong.
All questions
.Nm
poses
.Em must
be answered by typing
.Dq yes
or
.Dq no ,
appropriately.
.Pp
Since making a dump involves a lot of time and effort for full dumps,
.Nm
checkpoints itself at the start of each tape volume.
If writing that volume fails for some reason,
.Nm
will,
with operator permission,
restart itself from the checkpoint
after the old tape has been rewound and removed,
and a new tape has been mounted.
.Pp
.Nm
tells the operator what is going on at periodic intervals,
including usually low estimates of the number of blocks to write,
the number of tapes it will take, the time to completion, and
the time to the tape change.
The output is verbose,
so that others know that the terminal
controlling
.Nm
is busy,
and will be for some time.
.Pp
If
.Nm
receives a
.Dv SIGINFO
signal
(see the
.Dq status
argument of
.Xr stty 1 )
whilst a backup is in progress, statistics on the amount completed,
current transfer rate, and estimated finished time, will be written
to the standard error output.
.Pp
In the event of a catastrophic disk event, the time required
to restore all the necessary backup tapes or files to disk
is dependent on the levels of the dumps taken.
A few methods of staggering incremental dumps to either minimize
backup effort or restore effort follow:
.Bl -bullet -offset indent
.It
Always start with a level 0 backup, for example:
.Bd -literal -offset indent
# /sbin/dump -0u -f /dev/nrst1 /usr/src
.Ed
.Pp
This should be done at set intervals, say once a month or once every two months,
and on a set of fresh tapes that is saved forever.
.It
After the level 0 dump,
backups of active file systems are taken on each day in a cycle of a week.
Once a week, a level 1 dump is taken.
The other days of the week a higher level dump is done.
.Pp
The following cycle needs at most three tapes to restore to a given point
in time,
but the dumps at the end of the weekly cycle will require more
time and space:
.Bd -literal -offset indent
1 2 2 2 2 2 2
.Ed
.Pp
This sequence requires at most eight tapes to restore,
but the size of the individual dumps will be smaller:
.Bd -literal -offset indent
1 2 3 4 5 6 7
.Ed
.Pp
This sequence seeks a compromise between backup and restore effort:
.Bd -literal -offset indent
1 2 2 3 3 4 4
.Ed
.Pp
The weekly level 1 dumps should be done on a set of tapes that
is used cyclically.
For the daily dumps a tape per day of the week can be used.
.It
After several months or so, the daily and weekly tapes should get
rotated out of the dump cycle and fresh tapes brought in.
.El
.Sh ENVIRONMENT
.Bl -tag -width /etc/dumpdates
.It Ev TAPE
The default file to use instead of
.Pa /dev/rst0 .
See also
.Fl f ,
above.
.El
.Sh FILES
.Bl -tag -width /etc/dumpdates -compact
.It Pa /dev/rst0
default tape unit to dump to
.It Pa /dev/rst*
raw SCSI tape interface
.It Pa /etc/dumpdates
dump date records
.It Pa /etc/fstab
dump table: file systems and frequency
.It Pa /etc/group
to find group
.Em operator
.El
.Sh DIAGNOSTICS
Many, and verbose.
.Pp
.Nm
exits with zero status on success.
Startup errors are indicated with an exit code of 1;
abnormal termination is indicated with an exit code of 3.
.Sh SEE ALSO
.Xr chflags 1 ,
.Xr stty 1 ,
.Xr fts 3 ,
.Xr rcmd 3 ,
.Xr st 4 ,
.Xr fstab 5 ,
.Xr restore 8 ,
.Xr rmt 8
.Sh HISTORY
A
.Nm
command appeared in
.At v4 .
.Pp
The
.Bx 4.3
option syntax is implemented for backward compatibility but
is not documented here.
.Sh BUGS
Fewer than 32 read errors on the filesystem are ignored.
.Pp
Each reel requires a new process, so parent processes for
reels already written just hang around until the entire tape
is written.
.Pp
.Nm
with the
.Fl W
or
.Fl w
flag does not report filesystems that have never been recorded
in
.Pa /etc/dumpdates ,
even if listed in
.Pa /etc/fstab .
.Pp
When dumping a list of files or subdirectories, access privileges are
required to scan the directory (as this is done via the
.Xr fts 3
routines rather than directly accessing the filesystem).
.Pp
It would be nice if
.Nm
knew about the dump sequence,
kept track of the tapes scribbled on,
told the operator which tape to mount when,
and provided more assistance
for the operator running
.Xr restore 8 .
@


1.50
log
@add missing NAME entries; ok schwarze
@
text
@d1 1
a1 1
.\"	$OpenBSD: dump.8,v 1.49 2015/05/03 01:44:34 guenther Exp $
d34 1
a34 1
.Dd $Mdocdate: May 3 2015 $
d449 1
a449 1
.At v5 .
@


1.49
log
@Eliminate the -U flag and make usage of DUID in /etc/dumpdates the default.
Correct old style entries so nothing has to be done for the admin.

diff from Manuel Giraud (manuel (at) ledu-giraud.fr)  Thanks!
@
text
@d1 1
a1 1
.\"	$OpenBSD: dump.8,v 1.48 2014/07/17 19:58:05 jmc Exp $
d34 1
a34 1
.Dd $Mdocdate: July 17 2014 $
d38 2
a39 1
.Nm dump
@


1.48
log
@files-to-dump can be a duid;
From: Maximilian Fillinger
@
text
@d1 1
a1 1
.\"	$OpenBSD: dump.8,v 1.47 2014/07/11 16:01:41 halex Exp $
d34 1
a34 1
.Dd $Mdocdate: July 11 2014 $
d43 1
a43 1
.Op Fl 0123456789acnSUuWw
a231 7
.It Fl U
Use the
.Xr disklabel 8
UID instead of the device name when updating
.Pa /etc/dumpdates
and when searching for the date of the latest
lower-level dump.
d240 3
a242 1
filesystem name,
@


1.47
log
@make dump support DUIDs for command line arguments and /etc/dumpdates (using
the new shiny -U switch)

dumpdates part originating from, and discussed with, Maximilian Fillinger

seems reasonable to krw@@, "get it in" deraadt@@
@
text
@d1 1
a1 1
.\"	$OpenBSD: dump.8,v 1.46 2014/05/30 20:48:21 stephan Exp $
d34 1
a34 1
.Dd $Mdocdate: May 30 2014 $
d291 4
a294 2
In the former case, either the path to a mounted filesystem
or the device of an unmounted filesystem can be used.
@


1.46
log
@Add option -S to have dump(8) only estimate backup size and number of tapes
required (from NetBSD).

ok beck@@, krw@@ and sthen@@
@
text
@d1 1
a1 1
.\"	$OpenBSD: dump.8,v 1.45 2013/04/04 10:47:21 zhuk Exp $
d34 1
a34 1
.Dd $Mdocdate: April 4 2013 $
d43 1
a43 1
.Op Fl 0123456789acnSuWw
d232 7
@


1.45
log
@Make our dump(8) honour the "nodump" flag for directories, effectively
disabling dumping their contents.

input and ok otto@@ millert@@
man page bits input and ok jmc@@
@
text
@d1 1
a1 1
.\"	$OpenBSD: dump.8,v 1.44 2008/01/26 23:07:55 jmc Exp $
d34 1
a34 1
.Dd $Mdocdate: January 26 2008 $
d43 1
a43 1
.Op Fl 0123456789acnuWw
d206 3
@


1.44
log
@the kids want I/O;
@
text
@d1 1
a1 1
.\"	$OpenBSD: dump.8,v 1.43 2007/11/19 09:23:11 jmc Exp $
d34 1
a34 1
.Dd $Mdocdate: November 19 2007 $
d88 4
@


1.43
log
@put the SIGINFO blurb in a saner place;
@
text
@d1 1
a1 1
.\"	$OpenBSD: dump.8,v 1.42 2007/11/18 18:56:25 otto Exp $
d34 1
a34 1
.Dd $Mdocdate: November 18 2007 $
d141 1
a141 1
Since the IO system slices all requests into chunks of MAXBSIZE
@


1.42
log
@do not confuse the reader telling he should use a towers of hanoi
based scheme when it makes no sense: a weekly schedule does not
benefit from it. ok mbalmer@@ jmc@@ ray@@
@
text
@d1 1
a1 1
.\"	$OpenBSD: dump.8,v 1.41 2007/05/31 19:19:44 jmc Exp $
d34 1
a34 1
.Dd $Mdocdate$
d335 13
a393 13
.Pp
If
.Nm
receives a
.Dv SIGINFO
signal
(see the
.Dq status
argument of
.Xr stty 1 )
whilst a backup is in progress, statistics on the amount completed,
current transfer rate, and estimated finished time, will be written
to the standard error output.
@


1.41
log
@convert to new .Dd format;
@
text
@d1 1
a1 1
.\"	$OpenBSD: dump.8,v 1.40 2007/02/25 16:56:32 jmc Exp $
d337 3
a339 3
can be kept to a minimum by staggering the incremental dumps.
An efficient method of staggering incremental dumps
to minimize the number of tapes follows:
d350 9
a358 4
After a level 0, dumps of active file
systems are taken on a daily basis,
using a modified Tower of Hanoi algorithm,
with this sequence of dump levels:
d360 1
a360 1
3 2 5 4 7 6 9 8 9 9 ...
d363 10
a372 7
For the daily dumps, it should be possible to use a fixed number of tapes
for each day, used on a weekly basis.
Each week, a level 1 dump is taken, and
the daily Hanoi sequence repeats beginning with 3.
For weekly dumps, another fixed set of tapes per dumped file system is
used, also on a cyclical basis.
.El
d374 4
d380 1
@


1.40
log
@shuffle the text slightly into a more logical order;
@
text
@d1 1
a1 1
.\"	$OpenBSD: dump.8,v 1.39 2007/02/25 16:48:46 jmc Exp $
d34 1
a34 1
.Dd June 4, 1997
@


1.39
log
@the -W and -w flags do not need a separate synopsis;
@
text
@d1 1
a1 1
.\"	$OpenBSD: dump.8,v 1.38 2007/02/25 16:29:49 jmc Exp $
a68 10
Files can be marked with the
.Dq nodump
flag using
.Xr chflags 1 ,
settable only by the file's owner or the superuser.
Files with this flag set will only be dumped during full backups.
See also the
.Fl h
option, below.
.Pp
d82 10
a99 12
.Ar files-to-dump
is either a mountpoint of a filesystem
or a list of files and directories on a single filesystem to be backed
up as a subset of the filesystem.
In the former case, either the path to a mounted filesystem
or the device of an unmounted filesystem can be used.
In the latter case, certain restrictions are placed on the backup:
.Fl u
is ignored, the only dump level that is supported is
.Fl 0 ,
and all of the files must reside on the same filesystem.
.Pp
d272 12
@


1.38
log
@move the text describing 4.3 syntax compatibility to HISTORY, rather
than slap bang in SYNOPSIS;
@
text
@d1 1
a1 1
.\"	$OpenBSD: dump.8,v 1.37 2007/02/25 09:39:48 jmc Exp $
d42 2
a43 1
.Op Fl 0123456789acnu
d52 1
a52 2
.Nm dump
.Op Fl W Li \&| Fl w
@


1.37
log
@document the "opaque", "arch", and "nodump" flags more fully;
closes documentation/5384 from Andrew Hamilton-Wright

help from henning, otto, and weingart
@
text
@d1 1
a1 1
.\"	$OpenBSD: dump.8,v 1.36 2007/02/22 09:40:11 jmc Exp $
a52 5
.Pp
(The
.Bx 4.3
option syntax is implemented for backward compatibility but
is not documented here.)
d425 5
@


1.36
log
@igor sobrado spotted that although we have mlinks for rdump and
rrestore, the pages they point to don;t actually mention them.
so make it clear that their functionality is now integral in dump and
restore, and sync the text a little between the two pages;

help/ok otto
@
text
@d1 1
a1 1
.\"	$OpenBSD: dump.8,v 1.35 2005/08/02 10:49:49 jmc Exp $
d74 10
d205 1
a205 2
flag
.Dp Dv UF_NODUMP
d417 1
@


1.35
log
@$TAPE Ev may refer to a number of things, not just a physical tape device:
- for -f description, point people to TAPE
- for TAPE description, point people to -f
- use `file' to describe these differing forms, as that is consistent with
the rest of the page

this is based on -r1.71 from freebsd, from ceri davies,
which was in turn based on pr #84200 from gary w. swearingen;

ok otto@@
@
text
@d1 1
a1 1
.\"	$OpenBSD: dump.8,v 1.34 2003/07/15 10:28:29 jmc Exp $
d65 1
a65 3
storage medium for safe keeping (see the
.Fl f
option below for doing remote backups).
d73 13
@


1.34
log
@.Ql Fl -> .Sq Fl  where literal makes no sense;
@
text
@d1 1
a1 1
.\"	$OpenBSD: dump.8,v 1.33 2003/06/04 16:08:07 deraadt Exp $
d163 1
a163 1
.Sq Fl
d165 4
d369 5
a373 2
default tape device to use instead of
.Pa /dev/rst0
@


1.33
log
@fix some more UCB term 3
@
text
@d1 1
a1 1
.\"	$OpenBSD: dump.8,v 1.32 2003/06/03 13:16:08 jmc Exp $
d163 1
a163 1
.Ql Fl
@


1.32
log
@- section reorder
- some mdoc fixes
@
text
@d1 1
a1 1
.\"	$OpenBSD: dump.8,v 1.31 2003/04/09 04:17:21 jmc Exp $
d16 1
a16 5
.\" 3. All advertising materials mentioning features or use of this software
.\"    must display the following acknowledgement:
.\"	This product includes software developed by the University of
.\"	California, Berkeley and its contributors.
.\" 4. Neither the name of the University nor the names of its contributors
@


1.31
log
@document that rewind/eject features of tape devices depend on name of
tape device; reference st(4) for an explanation.

diff from Olivier Cherrier;
ok millert@@
@
text
@d1 1
a1 1
.\"	$OpenBSD: dump.8,v 1.30 2003/04/08 11:06:01 jmc Exp $
d366 6
a371 7
.Sh DIAGNOSTICS
Many, and verbose.
.Pp
.Nm
exits with zero status on success.
Startup errors are indicated with an exit code of 1;
abnormal termination is indicated with an exit code of 3.
d386 7
a392 6
.Sh ENVIRONMENT
.Bl -tag -width /etc/dumpdates
.It Ev TAPE
default tape device to use instead of
.Pa /dev/rst0
.El
@


1.30
log
@missing .Fl macro for -a option;
@
text
@d1 1
a1 1
.\"	$OpenBSD: dump.8,v 1.29 2003/02/01 16:29:53 jmc Exp $
d99 8
@


1.29
log
@typos;
chat(8): removed reference to uucico(8)

ok deraadt@@
@
text
@d1 1
a1 1
.\"	$OpenBSD: dump.8,v 1.28 2002/02/22 21:01:47 deraadt Exp $
d77 1
a77 1
.Cm a
@


1.28
log
@typo; jslag@@prop.walkerart.org
@
text
@d1 1
a1 1
.\"	$OpenBSD: dump.8,v 1.27 2002/02/11 18:43:51 mpech Exp $
d164 1
a164 1
the last file name will used for all remaining volumes after prompting
d220 1
a220 1
is readable by people, consisting of one
@


1.27
log
@Initial patch.
When you give command examples in a manual page prefix them with
	$ command
or
	# command

deraadt@@ ok
@
text
@d1 1
a1 1
.\"	$OpenBSD: dump.8,v 1.26 2001/12/13 20:16:48 mpech Exp $
d233 1
a233 1
(as opposed to and entire filesystem), then
@


1.26
log
@o) start new sentence on a new line;
o) wrap long lines;
o) fix bogus .Xr usage;
o) we don't like blank lines;
o) always close .Bl tags;
o) OpenBSD -> .Ox;
o) don't like .Pp before .Ss;

millert@@ ok;
@
text
@d1 1
a1 1
.\"	$OpenBSD: dump.8,v 1.25 2001/10/04 22:28:03 ho Exp $
d321 1
a321 1
/sbin/dump -0u -f /dev/nrst1 /usr/src
@


1.25
log
@Mention that dump uses the TAPE variable.
@
text
@d1 1
a1 1
.\"	$OpenBSD: dump.8,v 1.24 2000/03/24 21:41:08 aaron Exp $
d428 1
a428 1
.Xr restore .
@


1.24
log
@Correct the HISTORY section to note that this command appeared in Version 5
of AT&T UNIX, not Version 6. Verified by strings(1)'ing a .dsk file (PDP-11
executable) containing the v5 sources, obtainable at gatekeeper.dec.com in the
directory /pub/DEC/sim/software. Idea from NetBSD PR/4790.
@
text
@d1 1
a1 1
.\"	$OpenBSD: dump.8,v 1.23 2000/03/18 22:55:55 aaron Exp $
d378 6
@


1.23
log
@Remove hard sentence breaks, and some other cleanup along the way.
@
text
@d1 1
a1 1
.\"	$OpenBSD: dump.8,v 1.22 2000/03/05 00:28:49 aaron Exp $
d391 1
a391 1
.At v6 .
@


1.22
log
@Finish standardizing options list introduction.
@
text
@d1 1
a1 1
.\"	$OpenBSD: dump.8,v 1.21 1999/10/17 19:59:45 aaron Exp $
d67 2
a68 2
need to be backed up. These files
are copied to the given disk, tape or other
d75 2
a76 2
end-of-media indication is returned.  This can be enforced
by using the
d120 3
a122 2
an end-of-media indication is returned.  This option is recommended
for most modern tape drives.  Use of this option is particularly
d358 7
d387 2
a388 3
.Sh DIAGNOSTICS
Many, and verbose.
.Pp
d390 2
a391 3
exits with zero status on success.
Startup errors are indicated with an exit code of 1;
abnormal termination is indicated with an exit code of 3.
a422 5
.Sh HISTORY
A
.Nm
command appeared in
.At v6 .
@


1.21
log
@Use the AT&T UNIX macros.
@
text
@d1 1
a1 1
.\"	$OpenBSD: dump.8,v 1.20 1999/07/04 18:59:38 aaron Exp $
d100 1
a100 2
The following options are supported by
.Nm dump :
@


1.20
log
@trash some old leftover macros and replace them with -mdoc macros
@
text
@d1 1
a1 1
.\"	$OpenBSD: dump.8,v 1.19 1999/06/04 02:45:15 aaron Exp $
d421 2
a422 1
command appeared in Version 6 AT&T UNIX.
@


1.19
log
@start to remove non-escaped trailing whitespace, it can confuse troff; pjanzen@@
@
text
@d1 1
a1 1
.\"	$OpenBSD: dump.8,v 1.18 1999/05/26 03:21:03 aaron Exp $
a57 1
.in -\\n(iSu
@


1.18
log
@Xr st(4); from NetBSD
@
text
@d1 1
a1 1
.\"	$OpenBSD: dump.8,v 1.17 1999/05/23 14:11:14 aaron Exp $
d227 1
a227 1
format dump date. 
@


1.17
log
@remove argument from .Os macros so value in /usr/share/tmac/mdoc/doc-common
is used instead; kwesterback@@home.com
@
text
@d1 1
a1 1
.\"	$OpenBSD: dump.8,v 1.16 1998/12/15 01:20:29 aaron Exp $
d377 1
@


1.16
log
@always give .Nm macros an argument in SYNOPSIS sections; krw@@tcn.net
@
text
@d1 1
a1 1
.\"	$OpenBSD: dump.8,v 1.15 1998/11/28 19:56:18 aaron Exp $
d40 1
a40 1
.Os BSD 4
@


1.15
log
@kill redundant .Nm macro arguments; other misc fixes
@
text
@d1 1
a1 1
.\"	$OpenBSD: dump.8,v 1.14 1998/09/23 01:20:22 aaron Exp $
d45 1
a45 1
.Nm
d55 1
a55 1
.Nm
@


1.14
log
@alphabetize SEE ALSO entries and order them numerically according to section
@
text
@d1 1
a1 1
.\"	$OpenBSD: dump.8,v 1.13 1998/09/17 04:14:52 aaron Exp $
d55 1
a55 1
.Nm dump
d114 1
a114 1
.Nm dump
@


1.13
log
@sbin/ man page fixes
@
text
@d1 1
a1 1
.\"	$OpenBSD: dump.8,v 1.12 1998/05/06 14:35:09 deraadt Exp $
d376 1
a377 1
.Xr rcmd 3 ,
@


1.12
log
@correct operational description; ksulliva@@psc.edu
@
text
@d1 1
a1 1
.\"	$OpenBSD: dump.8,v 1.11 1998/01/03 08:19:45 deraadt Exp $
d61 1
a61 1
option syntax is implemented for backward compatibility, but
d82 1
a82 1
(such as some cartridge tape drives)
d84 1
a84 1
the actual size is determined by the tape size and density and/or
d90 1
a90 1
is either a mountpoint of a filesystem,
d93 1
a93 1
In the former case, either the path to a mounted filesystem,
d113 3
a115 1
tells dump to
d168 1
a168 1
.Dq host:file ,
d204 3
a206 1
The format of date is the same as that of
d249 1
a249 1
.Pa /etc/dumpdates
d258 3
a260 1
Is like W, but prints only those filesystems which need to be dumped.
d269 1
a269 1
disk read error (if there are more than a threshold of 32).
d364 1
a364 1
Raw SCSI tape interface
d399 1
a399 1
flags does not report filesystems that have never been recorded
@


1.11
log
@default level is 0, not 9; hnokubi@@yyy.or.jp
@
text
@d1 1
a1 1
.\"	$OpenBSD: dump.8,v 1.10 1997/07/27 06:28:21 deraadt Exp $
d115 1
a115 1
last dump of the same or lower level.
@


1.10
log
@Xr rcmd 3
@
text
@d1 1
a1 1
.\"	$OpenBSD: dump.8,v 1.9 1997/07/05 05:35:53 millert Exp $
d116 1
a116 1
The default level is 9.
@


1.9
log
@Fix some incorrect strncpy usage.

From NetBSD (luke@@netbsd.org)
* verbosity additions displaying total & per-volume transfer times and rates
* Add the ability to dump specific files & directories of a single
  filesystem. This uses fts(3) to access the directory structure (and
  not the raw device), so the standard access permissions are adhered
  to (unlike dumping an entire filesystem, which just requires read
  access to the raw disk device).
* Support SIGINFO status reporting.
* Remove now unused variables that previously stored the (e)uid.
* Be more informative in a couple of error messages.

From NetBSD (mrg)
* fix NetBSD PR#3710, reported by Tatoku Ogaito <tacha@@trap.fukui-med.ac.jp>.
  don't pass pw->pw_name into functions; make a copy.
@
text
@d1 1
a1 1
.\"	$OpenBSD: dump.8,v 1.8 1997/06/02 08:48:32 deraadt Exp $
d371 1
@


1.8
log
@dump(5) does not exist, markd@@Grizzly.COM
@
text
@d1 2
a2 2
.\"	$OpenBSD: dump.8,v 1.7 1997/04/27 10:55:31 downsj Exp $
.\"	$NetBSD: dump.8,v 1.14 1996/02/05 23:59:37 mrg Exp $
d38 1
a38 1
.Dd June 16, 1993
d45 2
a46 2
.Nm dump
.Op Fl 0123456789cnua
d54 1
a54 1
.Ar filesystem
d64 1
a64 1
.Nm Dump
d89 12
d119 2
a120 2
Bypass all tape length considerations, and enforce writing
until an end-of-media indication is returned.  This fits best
d128 2
a129 2
This option overrides the calculation of tape size based on length and
density.
d169 1
a169 1
.Nm dump
d184 1
a184 1
.Nm dump
d194 1
a194 1
.Nm dump
d229 4
d234 1
a234 1
.Nm Dump
d243 1
a243 1
.Nm dump
d251 1
a251 1
.Nm dump
d257 1
a257 1
.Nm Dump
d267 1
a267 1
.Nm dump
d271 1
a271 1
.Nm dump
d275 1
a275 1
.Nm dump
d285 1
a285 1
.Nm dump
d288 1
a288 1
.Nm dump
d295 1
a295 1
.Nm Dump
d303 1
a303 1
.Nm dump
d340 13
d368 3
d372 1
a372 2
.Xr rmt 8 ,
.Xr fstab 5
d376 2
a377 1
Dump exits with zero status on success.
d387 1
a387 1
.Nm Dump
d398 5
d404 1
a404 1
.Nm dump
d413 1
a413 1
.Nm dump
@


1.7
log
@Correct assumed editing mistakes.
@
text
@d1 1
a1 1
.\"	$OpenBSD: dump.8,v 1.6 1997/04/16 04:09:20 millert Exp $
a340 1
.Xr dump 5 ,
@


1.6
log
@_PATH_DEFTAPE is now defined in <paths.h>
Change man page to reflect new default tape drive (/dev/rst0)
@
text
@d1 1
a1 1
.\"	$OpenBSD: dump.8,v 1.5 1997/02/10 04:19:55 millert Exp $
a112 1
based on length and density.
d116 2
a117 1
This option overrides the calculation of tape size
@


1.5
log
@Make dump(8) really honor -a.  Fix up formatting in man page and remove
duplicate entry.
@
text
@d1 1
a1 1
.\"	$OpenBSD: dump.8,v 1.4 1997/02/03 11:53:24 deraadt Exp $
d140 1
a140 1
.Pa /dev/rmt12
d326 1
a326 1
.It Pa /dev/rmt8
@


1.4
log
@new -a option autosizes, meaning it runs till it hits EOM (no need for
pesky sizing options) -- from FreeBSD.
also make -b option aware of MAXPHYS issues (via a little hack)
@
text
@d1 1
a1 1
.\"	$OpenBSD: dump.8,v 1.3 1996/06/23 14:30:09 deraadt Exp $
d105 1
a105 5
.It Fl B Ar records
The number of kilobytes per volume, rounded
down to a multiple of the blocksize.
This option overrides the calculation of tape size
.It Cm a
d114 4
d119 1
d127 1
a127 1
.It Cm c
a129 4
The number of kilobytes per dump record.
.It Fl c
Modify the calculation of the default density and tape size to be more
appropriate for cartridge tapes.
@


1.3
log
@update rcsid
@
text
@d1 1
a1 1
.\"	$OpenBSD: dump.8,v 1.14 1996/02/05 23:59:37 mrg Exp $
d46 1
a46 1
.Op Fl 0123456789cnu
d76 5
a80 1
end-of-media indication is returned.
d109 8
d119 10
@


1.2
log
@From NetBSD:
support $TAPE.  update manual to reflect reality (#1937 from Matthew Green).
@
text
@d1 1
@


1.1
log
@Initial revision
@
text
@d1 1
a1 1
.\"	$NetBSD: dump.8,v 1.12 1995/03/18 14:54:55 cgd Exp $
d101 2
a102 1
The number of dump records per volume.
d308 2
@


1.1.1.1
log
@initial import of NetBSD tree
@
text
@@
