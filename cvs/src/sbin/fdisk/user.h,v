head	1.17;
access;
symbols
	OPENBSD_6_2:1.17.0.10
	OPENBSD_6_2_BASE:1.17
	OPENBSD_6_1:1.17.0.8
	OPENBSD_6_1_BASE:1.17
	OPENBSD_6_0:1.17.0.4
	OPENBSD_6_0_BASE:1.17
	OPENBSD_5_9:1.17.0.2
	OPENBSD_5_9_BASE:1.17
	OPENBSD_5_8:1.16.0.4
	OPENBSD_5_8_BASE:1.16
	OPENBSD_5_7:1.11.0.2
	OPENBSD_5_7_BASE:1.11
	OPENBSD_5_6:1.10.0.4
	OPENBSD_5_6_BASE:1.10
	OPENBSD_5_5:1.7.0.44
	OPENBSD_5_5_BASE:1.7
	OPENBSD_5_4:1.7.0.42
	OPENBSD_5_4_BASE:1.7
	OPENBSD_5_3:1.7.0.38
	OPENBSD_5_3_BASE:1.7
	OPENBSD_5_2:1.7.0.40
	OPENBSD_5_2_BASE:1.7
	OPENBSD_5_1_BASE:1.7
	OPENBSD_5_1:1.7.0.36
	OPENBSD_5_0:1.7.0.34
	OPENBSD_5_0_BASE:1.7
	OPENBSD_4_9:1.7.0.32
	OPENBSD_4_9_BASE:1.7
	OPENBSD_4_8:1.7.0.30
	OPENBSD_4_8_BASE:1.7
	OPENBSD_4_7:1.7.0.26
	OPENBSD_4_7_BASE:1.7
	OPENBSD_4_6:1.7.0.28
	OPENBSD_4_6_BASE:1.7
	OPENBSD_4_5:1.7.0.24
	OPENBSD_4_5_BASE:1.7
	OPENBSD_4_4:1.7.0.22
	OPENBSD_4_4_BASE:1.7
	OPENBSD_4_3:1.7.0.20
	OPENBSD_4_3_BASE:1.7
	OPENBSD_4_2:1.7.0.18
	OPENBSD_4_2_BASE:1.7
	OPENBSD_4_1:1.7.0.16
	OPENBSD_4_1_BASE:1.7
	OPENBSD_4_0:1.7.0.14
	OPENBSD_4_0_BASE:1.7
	OPENBSD_3_9:1.7.0.12
	OPENBSD_3_9_BASE:1.7
	OPENBSD_3_8:1.7.0.10
	OPENBSD_3_8_BASE:1.7
	OPENBSD_3_7:1.7.0.8
	OPENBSD_3_7_BASE:1.7
	OPENBSD_3_6:1.7.0.6
	OPENBSD_3_6_BASE:1.7
	OPENBSD_3_5:1.7.0.4
	OPENBSD_3_5_BASE:1.7
	OPENBSD_3_4:1.7.0.2
	OPENBSD_3_4_BASE:1.7
	OPENBSD_3_3:1.6.0.6
	OPENBSD_3_3_BASE:1.6
	OPENBSD_3_2:1.6.0.4
	OPENBSD_3_2_BASE:1.6
	OPENBSD_3_1:1.6.0.2
	OPENBSD_3_1_BASE:1.6
	OPENBSD_3_0:1.4.0.2
	OPENBSD_3_0_BASE:1.4
	OPENBSD_2_9:1.3.0.16
	OPENBSD_2_9_BASE:1.3
	OPENBSD_2_8:1.3.0.14
	OPENBSD_2_8_BASE:1.3
	OPENBSD_2_7:1.3.0.12
	OPENBSD_2_7_BASE:1.3
	OPENBSD_2_6:1.3.0.10
	OPENBSD_2_6_BASE:1.3
	OPENBSD_2_5:1.3.0.8
	OPENBSD_2_5_BASE:1.3
	OPENBSD_2_4:1.3.0.6
	OPENBSD_2_4_BASE:1.3
	OPENBSD_2_3:1.3.0.4
	OPENBSD_2_3_BASE:1.3
	OPENBSD_2_2:1.3.0.2
	OPENBSD_2_2_BASE:1.3;
locks; strict;
comment	@ * @;


1.17
date	2015.12.11.21.57.31;	author krw;	state Exp;
branches;
next	1.16;
commitid	96L1vk3QTF4FoRGz;

1.16
date	2015.03.18.14.46.59;	author krw;	state Exp;
branches;
next	1.15;
commitid	9oRFFmwrkHklH7n4;

1.15
date	2015.03.16.23.51.50;	author krw;	state Exp;
branches;
next	1.14;
commitid	JG85Pc2Xt4lLAJpr;

1.14
date	2015.03.16.18.45.51;	author krw;	state Exp;
branches;
next	1.13;
commitid	mp8WjRkElVZwIbfW;

1.13
date	2015.03.14.18.32.29;	author krw;	state Exp;
branches;
next	1.12;
commitid	VCsOzs6eGW0SpJ6c;

1.12
date	2015.03.14.15.21.53;	author krw;	state Exp;
branches;
next	1.11;
commitid	aPXwn1AfAIMw4FVu;

1.11
date	2015.02.09.04.27.15;	author krw;	state Exp;
branches;
next	1.10;
commitid	hdzyTUV8r2DhhgJ1;

1.10
date	2014.03.31.22.03.29;	author krw;	state Exp;
branches;
next	1.9;

1.9
date	2014.03.17.16.40.00;	author krw;	state Exp;
branches;
next	1.8;

1.8
date	2014.03.07.21.56.13;	author krw;	state Exp;
branches;
next	1.7;

1.7
date	2003.06.03.01.13.19;	author weingart;	state Exp;
branches;
next	1.6;

1.6
date	2002.02.16.21.27.34;	author millert;	state Exp;
branches;
next	1.5;

1.5
date	2001.12.15.02.12.26;	author kjell;	state Exp;
branches;
next	1.4;

1.4
date	2001.08.12.12.03.01;	author heko;	state Exp;
branches;
next	1.3;

1.3
date	97.10.21.22.49.36;	author provos;	state Exp;
branches;
next	1.2;

1.2
date	97.09.29.23.33.41;	author mickey;	state Exp;
branches;
next	1.1;

1.1
date	97.09.29.22.58.20;	author weingart;	state Exp;
branches;
next	;


desc
@@


1.17
log
@Add '-v' flag that forces the display of both GPT's and the MBR.
Useful for seeing exactly what is currently on the disk. Suggested
by a request from kettenis@@.

Man page & usage ok jmc@@
@
text
@/*	$OpenBSD: user.h,v 1.16 2015/03/18 14:46:59 krw Exp $	*/

/*
 * Copyright (c) 1997 Tobias Weingartner
 *
 * Permission to use, copy, modify, and distribute this software for any
 * purpose with or without fee is hereby granted, provided that the above
 * copyright notice and this permission notice appear in all copies.
 *
 * THE SOFTWARE IS PROVIDED "AS IS" AND THE AUTHOR DISCLAIMS ALL WARRANTIES
 * WITH REGARD TO THIS SOFTWARE INCLUDING ALL IMPLIED WARRANTIES OF
 * MERCHANTABILITY AND FITNESS. IN NO EVENT SHALL THE AUTHOR BE LIABLE FOR
 * ANY SPECIAL, DIRECT, INDIRECT, OR CONSEQUENTIAL DAMAGES OR ANY DAMAGES
 * WHATSOEVER RESULTING FROM LOSS OF USE, DATA OR PROFITS, WHETHER IN AN
 * ACTION OF CONTRACT, NEGLIGENCE OR OTHER TORTIOUS ACTION, ARISING OUT OF
 * OR IN CONNECTION WITH THE USE OR PERFORMANCE OF THIS SOFTWARE.
 */

#ifndef _USER_H
#define _USER_H

/* Prototypes */
void USER_edit(off_t, off_t);
void USER_print_disk(int);

#endif /* _USER_H */
@


1.16
log
@Stop passing around little used 'struct mbr tt' parameter.  Just
make the initial mbr that tt pointed at a global that can be directly
accessed in the couple of places it is needed.

Fewer parameters, less confusion, no functional change.
@
text
@d1 1
a1 1
/*	$OpenBSD: user.h,v 1.15 2015/03/16 23:51:50 krw Exp $	*/
d24 1
a24 1
void USER_print_disk(void);
@


1.15
log
@Stop passing around a pointer to the stack variable 'disk' in main().
There is only one disk being worked on, so just make it a global.

Fewer parameters, less confusion, no functional change.
@
text
@d1 1
a1 1
/*	$OpenBSD: user.h,v 1.14 2015/03/16 18:45:51 krw Exp $	*/
d23 1
a23 1
void USER_edit(struct mbr *, off_t, off_t);
@


1.14
log
@Document that -i/-u are mutually exclusive and clean up the related
code a bit.

ok deraadt@@ igor@@ (with suggested tweak that is coming)
@
text
@d1 1
a1 1
/*	$OpenBSD: user.h,v 1.13 2015/03/14 18:32:29 krw Exp $	*/
d23 2
a24 2
void USER_edit(struct disk *, struct mbr *, off_t, off_t);
void USER_print_disk(struct disk *);
@


1.13
log
@Whitespace & KNF tweaks. Change functions whose return values are
not checked to void. Use continue inside a do loop instead of a
goto to the top. Move a #define/#undef more local to use. Eliminate
some lint.

General cleanup of things noticed preparing the big churn.

No intentional functional change.
@
text
@d1 1
a1 1
/*	$OpenBSD: user.h,v 1.12 2015/03/14 15:21:53 krw Exp $	*/
a22 1
void USER_init(struct disk *, struct mbr *, int);
@


1.12
log
@Switch all the license blocks to the standard OpenBSD/ISC license.

With the permission of Toby.

ok deraadt@@
@
text
@d1 1
a1 1
/*	$OpenBSD: user.h,v 1.11 2015/02/09 04:27:15 krw Exp $	*/
d23 3
a25 3
int USER_init(struct disk *, struct mbr *, int);
int USER_edit(struct disk *, struct mbr *, off_t, off_t);
int USER_print_disk(struct disk *);
@


1.11
log
@Rename 'm_flag' to 'e_flag' since it's '-e' that sets it. Rename
'User_modify' to 'USER_edit' for the same reason.
@
text
@d1 1
a1 1
/*	$OpenBSD: user.h,v 1.10 2014/03/31 22:03:29 krw Exp $	*/
a4 1
 * All rights reserved.
d6 3
a8 8
 * Redistribution and use in source and binary forms, with or without
 * modification, are permitted provided that the following conditions
 * are met:
 * 1. Redistributions of source code must retain the above copyright
 *    notice, this list of conditions and the following disclaimer.
 * 2. Redistributions in binary form must reproduce the above copyright
 *    notice, this list of conditions and the following disclaimer in the
 *    documentation and/or other materials provided with the distribution.
d10 7
a16 10
 * THIS SOFTWARE IS PROVIDED BY THE AUTHOR ``AS IS'' AND ANY EXPRESS OR
 * IMPLIED WARRANTIES, INCLUDING, BUT NOT LIMITED TO, THE IMPLIED WARRANTIES
 * OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE ARE DISCLAIMED.
 * IN NO EVENT SHALL THE AUTHOR BE LIABLE FOR ANY DIRECT, INDIRECT,
 * INCIDENTAL, SPECIAL, EXEMPLARY, OR CONSEQUENTIAL DAMAGES (INCLUDING, BUT
 * NOT LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES; LOSS OF USE,
 * DATA, OR PROFITS; OR BUSINESS INTERRUPTION) HOWEVER CAUSED AND ON ANY
 * THEORY OF LIABILITY, WHETHER IN CONTRACT, STRICT LIABILITY, OR TORT
 * (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE USE OF
 * THIS SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.
@


1.10
log
@Whitespace rectification.
@
text
@d1 1
a1 1
/*	$OpenBSD: user.h,v 1.9 2014/03/17 16:40:00 krw Exp $	*/
d33 1
a33 1
int USER_modify(struct disk *, struct mbr *, off_t, off_t);
@


1.9
log
@Nuke pointless blank lines, defines, comments and casts. Eliminate
#include in *.h files in favour of listing them as required in the *.c
files. Fix error message to correctly state that 64 is the minimum
value for -l. Use errx() where errno is not relevant. Use 'continue'
rather than a label to go back to start of a loop.

No intentional functional change.
@
text
@d1 1
a1 1
/*	$OpenBSD: user.h,v 1.8 2014/03/07 21:56:13 krw Exp $	*/
a36 1

@


1.8
log
@Relieve the code of an overburden of unnecessary typedef
abstraction. Call a 'struct' a 'struct' and not a pony.

No functional change.

idea ok deraadt@@
@
text
@d1 1
a1 1
/*	$OpenBSD: user.h,v 1.7 2003/06/03 01:13:19 weingart Exp $	*/
a29 3

#include "disk.h"
#include "mbr.h"
@


1.7
log
@Nuke terms 3 & 4.
@
text
@d1 1
a1 1
/*	$OpenBSD: user.h,v 1.6 2002/02/16 21:27:34 millert Exp $	*/
d35 3
a37 3
int USER_init(disk_t *, mbr_t *, int);
int USER_modify(disk_t *, mbr_t *, off_t, off_t);
int USER_print_disk(disk_t *);
@


1.6
log
@Part one of userland __P removal.  Done with a simple regexp with some minor hand editing to make comments line up correctly.  Another pass is forthcoming that handles the cases that could not be done automatically.
@
text
@d1 1
a1 1
/*	$OpenBSD: user.h,v 1.5 2001/12/15 02:12:26 kjell Exp $	*/
a14 5
 * 3. All advertising materials mentioning features or use of this software
 *    must display the following acknowledgement:
 *    This product includes software developed by Tobias Weingartner.
 * 4. The name of the author may not be used to endorse or promote products
 *    derived from this software without specific prior written permission.
@


1.5
log
@Get this damn diff out of my tree. ok from weingart@@, deraadt@@ and others.
Add a -u flag to fdisk which updates MBR code, but leaves the partition
table intact. There are still issues with 'update' having different behavior,
but I'll resolve those shortly
@
text
@d1 1
a1 1
/*	$OpenBSD: user.h,v 1.4 2001/08/12 12:03:01 heko Exp $	*/
d40 3
a42 3
int USER_init __P((disk_t *, mbr_t *, int));
int USER_modify __P((disk_t *, mbr_t *, off_t, off_t));
int USER_print_disk __P((disk_t *));
@


1.4
log
@#(endif|else) foo is incorrect, make it #endif /* foo */
deraadt@@ ok
@
text
@d1 1
a1 1
/*	$OpenBSD: user.h,v 1.3 1997/10/21 22:49:36 provos Exp $	*/
d40 1
a40 1
int USER_init __P((disk_t *, mbr_t *));
@


1.3
log
@make fdisk grok extended partitions again. we have to keep track of the
absolute offset of the current mbr and its relative position. because:
the starting sector of the first mbr entry in an extended partition is relative
to the starting offset of the whole mbr itself. the starting offset of a new
extended partition is relative to the offset of the very first extended
partition.
@
text
@d1 1
a1 1
/*	$OpenBSD: user.h,v 1.2 1997/09/29 23:33:41 mickey Exp $	*/
d44 1
a44 1
#endif _USER_H
@


1.2
log
@ID in the first line w/ tabs
@
text
@d1 1
a1 1
/*	$OpenBSD: user.h,v 1.1 1997/09/29 22:58:20 weingart Exp $	*/
d41 1
a41 1
int USER_modify __P((disk_t *, mbr_t *, int));
@


1.1
log
@New fdisk code with interactive (command line type)
editing code.  Rewrite from the ground up, save about
20 lines of code.  Seems to create valid partition
tables on i386 and alphas.
@
text
@d1 1
a1 2

/* $OpenBSD$ */
@
