head	1.21;
access;
symbols
	OPENBSD_6_0:1.21.0.4
	OPENBSD_6_0_BASE:1.21
	OPENBSD_5_9:1.21.0.2
	OPENBSD_5_9_BASE:1.21
	OPENBSD_5_8:1.19.0.4
	OPENBSD_5_8_BASE:1.19
	OPENBSD_5_7:1.16.0.2
	OPENBSD_5_7_BASE:1.16
	OPENBSD_5_6:1.16.0.4
	OPENBSD_5_6_BASE:1.16
	OPENBSD_5_5:1.13.0.40
	OPENBSD_5_5_BASE:1.13
	OPENBSD_5_4:1.13.0.38
	OPENBSD_5_4_BASE:1.13
	OPENBSD_5_3:1.13.0.34
	OPENBSD_5_3_BASE:1.13
	OPENBSD_5_2:1.13.0.36
	OPENBSD_5_2_BASE:1.13
	OPENBSD_5_1_BASE:1.13
	OPENBSD_5_1:1.13.0.32
	OPENBSD_5_0:1.13.0.30
	OPENBSD_5_0_BASE:1.13
	OPENBSD_4_9:1.13.0.28
	OPENBSD_4_9_BASE:1.13
	OPENBSD_4_8:1.13.0.26
	OPENBSD_4_8_BASE:1.13
	OPENBSD_4_7:1.13.0.22
	OPENBSD_4_7_BASE:1.13
	OPENBSD_4_6:1.13.0.24
	OPENBSD_4_6_BASE:1.13
	OPENBSD_4_5:1.13.0.20
	OPENBSD_4_5_BASE:1.13
	OPENBSD_4_4:1.13.0.18
	OPENBSD_4_4_BASE:1.13
	OPENBSD_4_3:1.13.0.16
	OPENBSD_4_3_BASE:1.13
	OPENBSD_4_2:1.13.0.14
	OPENBSD_4_2_BASE:1.13
	OPENBSD_4_1:1.13.0.12
	OPENBSD_4_1_BASE:1.13
	OPENBSD_4_0:1.13.0.10
	OPENBSD_4_0_BASE:1.13
	OPENBSD_3_9:1.13.0.8
	OPENBSD_3_9_BASE:1.13
	OPENBSD_3_8:1.13.0.6
	OPENBSD_3_8_BASE:1.13
	OPENBSD_3_7:1.13.0.4
	OPENBSD_3_7_BASE:1.13
	OPENBSD_3_6:1.13.0.2
	OPENBSD_3_6_BASE:1.13
	OPENBSD_3_5:1.11.0.4
	OPENBSD_3_5_BASE:1.11
	OPENBSD_3_4:1.11.0.2
	OPENBSD_3_4_BASE:1.11
	OPENBSD_3_3:1.10.0.6
	OPENBSD_3_3_BASE:1.10
	OPENBSD_3_2:1.10.0.4
	OPENBSD_3_2_BASE:1.10
	OPENBSD_3_1:1.10.0.2
	OPENBSD_3_1_BASE:1.10
	OPENBSD_3_0:1.8.0.2
	OPENBSD_3_0_BASE:1.8
	OPENBSD_2_9:1.6.0.4
	OPENBSD_2_9_BASE:1.6
	OPENBSD_2_8:1.6.0.2
	OPENBSD_2_8_BASE:1.6
	OPENBSD_2_7:1.5.0.8
	OPENBSD_2_7_BASE:1.5
	OPENBSD_2_6:1.5.0.6
	OPENBSD_2_6_BASE:1.5
	OPENBSD_2_5:1.5.0.4
	OPENBSD_2_5_BASE:1.5
	OPENBSD_2_4:1.5.0.2
	OPENBSD_2_4_BASE:1.5
	OPENBSD_2_3:1.4.0.4
	OPENBSD_2_3_BASE:1.4
	OPENBSD_2_2:1.4.0.2
	OPENBSD_2_2_BASE:1.4;
locks; strict;
comment	@ * @;


1.21
date	2015.11.26.08.15.07;	author tim;	state Exp;
branches;
next	1.20;
commitid	K0ReHvH17yLhzwH2;

1.20
date	2015.10.26.15.08.26;	author krw;	state Exp;
branches;
next	1.19;
commitid	fOI5D0M32zdW7eoe;

1.19
date	2015.03.26.14.08.12;	author krw;	state Exp;
branches;
next	1.18;
commitid	2pp42lVbpnraZMs8;

1.18
date	2015.03.16.23.51.50;	author krw;	state Exp;
branches;
next	1.17;
commitid	JG85Pc2Xt4lLAJpr;

1.17
date	2015.03.14.15.21.53;	author krw;	state Exp;
branches;
next	1.16;
commitid	aPXwn1AfAIMw4FVu;

1.16
date	2014.03.25.12.59.03;	author krw;	state Exp;
branches;
next	1.15;

1.15
date	2014.03.17.16.40.00;	author krw;	state Exp;
branches;
next	1.14;

1.14
date	2014.03.07.21.56.13;	author krw;	state Exp;
branches;
next	1.13;

1.13
date	2004.08.03.09.22.03;	author otto;	state Exp;
branches;
next	1.12;

1.12
date	2004.07.13.06.00.33;	author tom;	state Exp;
branches;
next	1.11;

1.11
date	2003.06.03.01.13.19;	author weingart;	state Exp;
branches;
next	1.10;

1.10
date	2002.02.16.21.27.34;	author millert;	state Exp;
branches;
next	1.9;

1.9
date	2002.01.18.08.38.26;	author kjell;	state Exp;
branches;
next	1.8;

1.8
date	2001.08.12.12.03.01;	author heko;	state Exp;
branches;
next	1.7;

1.7
date	2001.05.18.07.15.18;	author mickey;	state Exp;
branches;
next	1.6;

1.6
date	2000.07.01.21.49.12;	author mickey;	state Exp;
branches;
next	1.5;

1.5
date	98.09.14.03.54.35;	author rahnds;	state Exp;
branches;
next	1.4;

1.4
date	97.10.21.22.49.35;	author provos;	state Exp;
branches;
next	1.3;

1.3
date	97.10.16.01.47.12;	author deraadt;	state Exp;
branches;
next	1.2;

1.2
date	97.09.29.23.33.40;	author mickey;	state Exp;
branches;
next	1.1;

1.1
date	97.09.29.22.58.19;	author weingart;	state Exp;
branches;
next	;


desc
@@


1.21
log
@When prompting for a GPT partition type, use the partition's current type as
default; OK krw@@
@
text
@/*	$OpenBSD: part.h,v 1.20 2015/10/26 15:08:26 krw Exp $	*/

/*
 * Copyright (c) 1997 Tobias Weingartner
 *
 * Permission to use, copy, modify, and distribute this software for any
 * purpose with or without fee is hereby granted, provided that the above
 * copyright notice and this permission notice appear in all copies.
 *
 * THE SOFTWARE IS PROVIDED "AS IS" AND THE AUTHOR DISCLAIMS ALL WARRANTIES
 * WITH REGARD TO THIS SOFTWARE INCLUDING ALL IMPLIED WARRANTIES OF
 * MERCHANTABILITY AND FITNESS. IN NO EVENT SHALL THE AUTHOR BE LIABLE FOR
 * ANY SPECIAL, DIRECT, INDIRECT, OR CONSEQUENTIAL DAMAGES OR ANY DAMAGES
 * WHATSOEVER RESULTING FROM LOSS OF USE, DATA OR PROFITS, WHETHER IN AN
 * ACTION OF CONTRACT, NEGLIGENCE OR OTHER TORTIOUS ACTION, ARISING OUT OF
 * OR IN CONNECTION WITH THE USE OR PERFORMANCE OF THIS SOFTWARE.
 */

#ifndef _PART_H
#define _PART_H

struct prt {
	u_int64_t bs;
	u_int64_t ns;
	u_int32_t shead, scyl, ssect;
	u_int32_t ehead, ecyl, esect;
	unsigned char flag;
	unsigned char id;
};

void	PRT_printall(void);
const char *PRT_ascii_id(int);
void PRT_parse(struct dos_partition *, off_t, off_t,
    struct prt *);
void PRT_make(struct prt *, off_t, off_t, struct dos_partition *);
void PRT_print(int, struct prt *, char *);
char *PRT_uuid_to_typename(struct uuid *);
int PRT_uuid_to_type(struct uuid *);
struct uuid *PRT_type_to_uuid(int);

/* This does CHS -> bs/ns */
void PRT_fix_BN(struct prt *, int);

/* This does bs/ns -> CHS */
void PRT_fix_CHS(struct prt *);

#endif /* _PART_H */
@


1.20
log
@Add GPT editing. Based on GSOC 2014 work by Markus Muller.
@
text
@d1 1
a1 1
/*	$OpenBSD: part.h,v 1.19 2015/03/26 14:08:12 krw Exp $	*/
d37 2
a38 1
char *PRT_uuid_to_type(struct uuid *);
@


1.19
log
@Expand internal representation of partition starting LBA and size
to 64 bits, adjusting printf()'s, etc. as required. Preparing for
GPT partitions. Add 't' size unit. No other intentional functional
change.
@
text
@d1 1
a1 1
/*	$OpenBSD: part.h,v 1.18 2015/03/16 23:51:50 krw Exp $	*/
d37 2
@


1.18
log
@Stop passing around a pointer to the stack variable 'disk' in main().
There is only one disk being worked on, so just make it a global.

Fewer parameters, less confusion, no functional change.
@
text
@d1 1
a1 1
/*	$OpenBSD: part.h,v 1.17 2015/03/14 15:21:53 krw Exp $	*/
d23 2
a26 2
	u_int32_t bs;
	u_int32_t ns;
@


1.17
log
@Switch all the license blocks to the standard OpenBSD/ISC license.

With the permission of Toby.

ok deraadt@@
@
text
@d1 1
a1 1
/*	$OpenBSD: part.h,v 1.16 2014/03/25 12:59:03 krw Exp $	*/
d33 1
a33 1
void PRT_parse(struct disk *, struct dos_partition *, off_t, off_t,
d39 1
a39 1
void PRT_fix_BN(struct disk *, struct prt *, int);
d42 1
a42 1
void PRT_fix_CHS(struct disk *, struct prt *);
@


1.16
log
@Use 'struct dos_partition' variable to access 'struct dos_partition'
data. Since all the fields but 2 that are specially handled are
u_int8_t's there should be no danger from alignment issues.

ok dlg@@
@
text
@d1 1
a1 1
/*	$OpenBSD: part.h,v 1.15 2014/03/17 16:40:00 krw Exp $	*/
a4 1
 * All rights reserved.
d6 3
a8 8
 * Redistribution and use in source and binary forms, with or without
 * modification, are permitted provided that the following conditions
 * are met:
 * 1. Redistributions of source code must retain the above copyright
 *    notice, this list of conditions and the following disclaimer.
 * 2. Redistributions in binary form must reproduce the above copyright
 *    notice, this list of conditions and the following disclaimer in the
 *    documentation and/or other materials provided with the distribution.
d10 7
a16 10
 * THIS SOFTWARE IS PROVIDED BY THE AUTHOR ``AS IS'' AND ANY EXPRESS OR
 * IMPLIED WARRANTIES, INCLUDING, BUT NOT LIMITED TO, THE IMPLIED WARRANTIES
 * OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE ARE DISCLAIMED.
 * IN NO EVENT SHALL THE AUTHOR BE LIABLE FOR ANY DIRECT, INDIRECT,
 * INCIDENTAL, SPECIAL, EXEMPLARY, OR CONSEQUENTIAL DAMAGES (INCLUDING, BUT
 * NOT LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES; LOSS OF USE,
 * DATA, OR PROFITS; OR BUSINESS INTERRUPTION) HOWEVER CAUSED AND ON ANY
 * THEORY OF LIABILITY, WHETHER IN CONTRACT, STRICT LIABILITY, OR TORT
 * (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE USE OF
 * THIS SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.
@


1.15
log
@Nuke pointless blank lines, defines, comments and casts. Eliminate
#include in *.h files in favour of listing them as required in the *.c
files. Fix error message to correctly state that 64 is the minimum
value for -l. Use errx() where errno is not relevant. Use 'continue'
rather than a label to go back to start of a loop.

No intentional functional change.
@
text
@d1 1
a1 1
/*	$OpenBSD: part.h,v 1.14 2014/03/07 21:56:13 krw Exp $	*/
d42 3
a44 2
void PRT_parse(struct disk *, void *, off_t, off_t, struct prt *);
void PRT_make(struct prt *, off_t, off_t, void *);
@


1.14
log
@Relieve the code of an overburden of unnecessary typedef
abstraction. Call a 'struct' a 'struct' and not a pony.

No functional change.

idea ok deraadt@@
@
text
@d1 1
a1 1
/*	$OpenBSD: part.h,v 1.13 2004/08/03 09:22:03 otto Exp $	*/
a30 1
/* Partition type */
a39 1
/* Prototypes */
a52 1

@


1.13
log
@Handle geometry parameters as unsigned quantities, getting rid of negative
number of sectors on large disks and other similar problems.

ok toby@@ tom@@ deraadt@@
@
text
@d1 1
a1 1
/*	$OpenBSD: part.h,v 1.12 2004/07/13 06:00:33 tom Exp $	*/
d32 1
a32 1
typedef struct _prt_t {
d39 1
a39 1
} prt_t;
d44 3
a46 3
void PRT_parse(disk_t *, void *, off_t, off_t, prt_t *);
void PRT_make(prt_t *, off_t, off_t, void *);
void PRT_print(int, prt_t *, char *);
d49 1
a49 1
void PRT_fix_BN(disk_t *, prt_t *, int);
d52 1
a52 1
void PRT_fix_CHS(disk_t *, prt_t *);
@


1.12
log
@Remove unused argument 'int pn' to PRT_fix_CHS().  The 'int pn'
argument to PRT_parse() then becomes unused, so remove that too.

ok henning@@, otto@@
@
text
@d1 1
a1 1
/*	$OpenBSD: part.h,v 1.11 2003/06/03 01:13:19 weingart Exp $	*/
d33 4
a36 4
	int shead, scyl, ssect;
	int ehead, ecyl, esect;
	int bs;
	int ns;
@


1.11
log
@Nuke terms 3 & 4.
@
text
@d1 1
a1 1
/*	$OpenBSD: part.h,v 1.10 2002/02/16 21:27:34 millert Exp $	*/
d44 1
a44 1
void PRT_parse(disk_t *, void *, off_t, off_t, prt_t *, int);
d52 1
a52 1
void PRT_fix_CHS(disk_t *, prt_t *, int);
@


1.10
log
@Part one of userland __P removal.  Done with a simple regexp with some minor hand editing to make comments line up correctly.  Another pass is forthcoming that handles the cases that could not be done automatically.
@
text
@d1 1
a1 1
/*	$OpenBSD: part.h,v 1.9 2002/01/18 08:38:26 kjell Exp $	*/
a14 5
 * 3. All advertising materials mentioning features or use of this software
 *    must display the following acknowledgement:
 *    This product includes software developed by Tobias Weingartner.
 * 4. The name of the author may not be used to endorse or promote products
 *    derived from this software without specific prior written permission.
@


1.9
log
@Allow size values to be displayed in the user's choice of units.
Idea borrowed from disklabel. i.e. Users can now type "print M"
and be rewarded with partition sizes in Megs
@
text
@d1 1
a1 1
/*	$OpenBSD: part.h,v 1.8 2001/08/12 12:03:01 heko Exp $	*/
d47 5
a51 5
void	PRT_printall __P((void));
const char *PRT_ascii_id __P((int));
void PRT_parse __P((disk_t *, void *, off_t, off_t, prt_t *, int));
void PRT_make __P((prt_t *, off_t, off_t, void *));
void PRT_print __P((int, prt_t *, char *));
d54 1
a54 1
void PRT_fix_BN __P((disk_t *, prt_t *, int));
d57 1
a57 1
void PRT_fix_CHS __P((disk_t *, prt_t *, int));
@


1.8
log
@#(endif|else) foo is incorrect, make it #endif /* foo */
deraadt@@ ok
@
text
@d1 1
a1 1
/*	$OpenBSD: part.h,v 1.7 2001/05/18 07:15:18 mickey Exp $	*/
d51 1
a51 1
void PRT_print __P((int, prt_t *));
@


1.7
log
@a few harmless cleanups
@
text
@d1 1
a1 1
/*	$OpenBSD: part.h,v 1.6 2000/07/01 21:49:12 mickey Exp $	*/
d59 1
a59 1
#endif _PART_H
@


1.6
log
@be more verbose when warning for partition errors,
print partition number in the message.
@
text
@d1 1
a1 1
/*	$OpenBSD: part.h,v 1.5 1998/09/14 03:54:35 rahnds Exp $	*/
d48 1
a48 1
char *PRT_ascii_id __P((int));
@


1.5
log
@Since on the powerpc, the system does not supply the user with
bios valid cyl,head,sector information (the information comes from the
sd driver) I have made some changes to fdisk to do the following.

Allow the powerpc to specify values larger than the bios limits.

All platforms now have code that will translate the LBA values
in the mbr into CHS values according to the disk geometry.
This occurs if the start and ending CHS values have been stored as
0xffffff.

If writing to the disk and one of the values of a partition violates
the bios limits, it writes the requested values in the LBA fields ,
and stores 0xffffff for the starting and ending CHS values.

This should not change the default formatting of any existing system
other than the CHS and LBA values should always match given the detected
geometry of the disk.
@
text
@d1 1
a1 1
/*	$OpenBSD: part.h,v 1.4 1997/10/21 22:49:35 provos Exp $	*/
d49 1
a49 1
void PRT_parse __P((disk_t *, void *, off_t, off_t, prt_t *));
d54 1
a54 1
void PRT_fix_BN __P((disk_t *, prt_t *));
d57 1
a57 1
void PRT_fix_CHS __P((disk_t *, prt_t *));
@


1.4
log
@make fdisk grok extended partitions again. we have to keep track of the
absolute offset of the current mbr and its relative position. because:
the starting sector of the first mbr entry in an extended partition is relative
to the starting offset of the whole mbr itself. the starting offset of a new
extended partition is relative to the offset of the very first extended
partition.
@
text
@d1 1
a1 1
/*	$OpenBSD: part.h,v 1.3 1997/10/16 01:47:12 deraadt Exp $	*/
d49 1
a49 1
void PRT_parse __P((void *, off_t, off_t, prt_t *));
@


1.3
log
@a bunch of improvements by weingart & I
@
text
@d1 1
a1 1
/*	$OpenBSD: part.h,v 1.2 1997/09/29 23:33:40 mickey Exp $	*/
d49 2
a50 2
void PRT_parse __P((void *, prt_t *));
void PRT_make __P((prt_t *, void *));
@


1.2
log
@ID in the first line w/ tabs
@
text
@d1 1
a1 1
/*	$OpenBSD: part.h,v 1.1 1997/09/29 22:58:19 weingart Exp $	*/
d47 1
@


1.1
log
@New fdisk code with interactive (command line type)
editing code.  Rewrite from the ground up, save about
20 lines of code.  Seems to create valid partition
tables on i386 and alphas.
@
text
@d1 1
a1 2

/* $OpenBSD$ */
@
