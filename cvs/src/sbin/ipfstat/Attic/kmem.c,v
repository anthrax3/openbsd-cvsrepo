head	1.18;
access;
symbols
	OPENBSD_2_9:1.17.0.2
	OPENBSD_2_9_BASE:1.17
	OPENBSD_2_8:1.15.0.4
	OPENBSD_2_8_BASE:1.15
	OPENBSD_2_7:1.15.0.2
	OPENBSD_2_7_BASE:1.15
	OPENBSD_2_6:1.11.0.2
	OPENBSD_2_6_BASE:1.11
	OPENBSD_2_5:1.10.0.2
	OPENBSD_2_5_BASE:1.10
	OPENBSD_2_4:1.9.0.4
	OPENBSD_2_4_BASE:1.9
	OPENBSD_2_3:1.9.0.2
	OPENBSD_2_3_BASE:1.9
	OPENBSD_2_2:1.8.0.4
	OPENBSD_2_2_BASE:1.8
	OPENBSD_2_1:1.8.0.2
	OPENBSD_2_1_BASE:1.8
	OPENBSD_2_0:1.4.0.2
	OPENBSD_2_0_BASE:1.4;
locks; strict;
comment	@ * @;


1.18
date	2001.05.30.02.11.45;	author deraadt;	state dead;
branches;
next	1.17;

1.17
date	2001.01.30.04.27.58;	author kjell;	state Exp;
branches;
next	1.16;

1.16
date	2001.01.17.05.01.00;	author fgsch;	state Exp;
branches;
next	1.15;

1.15
date	2000.03.13.23.40.19;	author kjell;	state Exp;
branches;
next	1.14;

1.14
date	2000.02.16.22.34.22;	author kjell;	state Exp;
branches;
next	1.13;

1.13
date	2000.02.01.19.30.00;	author kjell;	state Exp;
branches;
next	1.12;

1.12
date	99.12.15.05.20.25;	author kjell;	state Exp;
branches;
next	1.11;

1.11
date	99.07.08.00.02.26;	author deraadt;	state Exp;
branches;
next	1.10;

1.10
date	99.02.05.05.58.43;	author deraadt;	state Exp;
branches;
next	1.9;

1.9
date	98.01.26.04.13.43;	author dgregor;	state Exp;
branches;
next	1.8;

1.8
date	97.02.12.20.57.44;	author kstailey;	state Exp;
branches;
next	1.7;

1.7
date	97.02.12.18.27.48;	author dm;	state Exp;
branches;
next	1.6;

1.6
date	97.02.11.22.23.44;	author kstailey;	state Exp;
branches;
next	1.5;

1.5
date	96.12.17.23.50.51;	author niklas;	state Exp;
branches;
next	1.4;

1.4
date	96.07.18.05.08.10;	author dm;	state Exp;
branches;
next	1.3;

1.3
date	96.06.23.14.30.58;	author deraadt;	state Exp;
branches;
next	1.2;

1.2
date	96.01.25.05.41.31;	author dm;	state Exp;
branches;
next	1.1;

1.1
date	96.01.07.02.33.37;	author dm;	state Exp;
branches;
next	;


desc
@@


1.18
log
@Remove ipf.  Darren Reed has interpreted his (old, new, whichever)
licence in a way that makes ipf not free according to the rules we
established over 5 years ago, at www.openbsd.org/goals.html (and those
same basic rules govern the other *BSD projects too).  Specifically,
Darren says that modified versions are not permitted.  But software
which OpenBSD uses and redistributes must be free to all (be they
people or companies), for any purpose they wish to use it, including
modification, use, peeing on, or even integration into baby mulching
machines or atomic bombs to be dropped on Australia.  Furthermore, we
know of a number of companies using ipf with modification like us, who
are now in the same situation, and we hope that some of them will work
with us to fill this gap that now exists in OpenBSD (temporarily, we
hope).
@
text
@/*	$OpenBSD: kmem.c,v 1.17 2001/01/30 04:27:58 kjell Exp $	*/

/*
 * Copyright (C) 1993-2000 by Darren Reed.
 *
 * Redistribution and use in source and binary forms are permitted
 * provided that this notice is preserved and due credit is given
 * to the original author and the contributors.
 */
/*
 * kmemcpy() - copies n bytes from kernel memory into user buffer.
 * returns 0 on success, -1 on error.
 */

#include <stdio.h>
#include <sys/types.h>
#include <sys/uio.h>
#include <unistd.h>
#include <fcntl.h>
#include <sys/file.h>
#include "kmem.h"

#if !defined(lint)
static const char sccsid[] = "@@(#)kmem.c	1.4 1/12/96 (C) 1992 Darren Reed";
static const char rcsid[] = "@@(#)$IPFilter: kmem.c,v 2.2 2000/03/13 22:10:25 darrenr Exp $";
#endif

static	int	kmemfd = -1;

int	openkmem(nlistf, memf)
char *nlistf, *memf;
{
	if (memf == NULL)
		memf = KMEM;

	if ((kmemfd = open(memf,O_RDONLY)) == -1)
	    {
		perror("kmeminit:open");
		return -1;
	    }
	return kmemfd;
}

int	kmemcpy(buf, pos, n)
register char	*buf;
long	pos;
register int	n;
{
	register int	r;

	if (!n)
		return 0;
	if (kmemfd == -1)
		if (openkmem(nlistf, memf) == -1)
			return -1;
	if (lseek(kmemfd, pos, 0) == -1)
	    {
		perror("kmemcpy:lseek");
		return -1;
	    }
	while ((r = read(kmemfd, buf, n)) < n)
		if (r <= 0)
		    {
			perror("kmemcpy:read");
			return -1;
		    }
		else
		    {
			buf += r;
			n -= r;
		    }
	return 0;
}

int	kstrncpy(buf, pos, n)
register char	*buf;
long	pos;
register int	n;
{
	register int	r;

	if (!n)
		return 0;
	if (kmemfd == -1)
		if (openkmem(nlistf, memf) == -1)
			return -1;
	if (lseek(kmemfd, pos, 0) == -1)
	    {
		perror("kmemcpy:lseek");
		return -1;
	    }
	while (n > 0) {
		r = read(kmemfd, buf, 1);
		if (r <= 0)
		    {
			perror("kmemcpy:read");
			return -1;
		    }
		else
		    {
			if (*buf == '\0')
				break;
			buf++;
			n--;
		    }
	}
	return 0;
}
@


1.17
log
@reimplement whacked ipfstat changes
@
text
@d1 1
a1 1
/*	$OpenBSD: kmem.c,v 1.16 2001/01/17 05:01:00 fgsch Exp $	*/
@


1.16
log
@1st part of ipf userland code.
@
text
@d1 1
a1 1
/*	$OpenBSD$	*/
d30 2
a31 1
int	openkmem()
d33 4
a36 1
	if ((kmemfd = open(KMEM,O_RDONLY)) == -1)
d54 1
a54 1
		if (openkmem() == -1)
d85 1
a85 1
		if (openkmem() == -1)
@


1.15
log
@Import of Darren Reed's IPFilter 3.3.11. See sbin/ipf/HISTORY for detailed
changelog. Documentation changes are now way behind. Volunteers?
@
text
@d4 1
a4 1
 * Copyright (C) 1993-1998 by Darren Reed.
d25 1
a25 1
static const char rcsid[] = "@@(#)$IPFilter: kmem.c,v 2.1 1999/08/04 17:30:09 darrenr Exp $";
d30 1
a30 2
int	openkmem(nlistf, memf)
char *nlistf, *memf;
d32 1
a32 4
	if (memf == NULL)
		memf = KMEM;

	if ((kmemfd = open(memf,O_RDONLY)) == -1)
d50 1
a50 1
		if (openkmem(nlistf, memf) == -1)
d81 1
a81 1
		if (openkmem(nlistf, memf) == -1)
@


1.14
log
@Import IPFilter 3.3.9. Primarily, bugfixes since 3.3.8. See sbin/ipf/HISTORY
for details.
@
text
@@


1.13
log
@Update to IPFilter 3.3.8. Man pages still to go. See sbin/ipf/HISTORY
for details.
@
text
@@


1.12
log
@Import of Darren Reed's IPFilter 3.3.4, including OpenBSD patches.

Many, many enhancements and improvements, including new in-kernel
proxies, enhancements to logging, and many bugfixes.

Note: Man pages have not yet been re-converted to mdoc.
@
text
@d1 2
a2 1
/* $OpenBSD$ */
d25 1
a25 1
static const char rcsid[] = "@@(#)$Id: kmem.c,v 2.1 1999/08/04 17:30:09 darrenr Exp $";
@


1.11
log
@cleanup; still needs kmem removal (terrible)
@
text
@d1 1
a1 1
/*    $OpenBSD: kmem.c,v 1.10 1999/02/05 05:58:43 deraadt Exp $    */
d24 1
a24 1
static const char rcsid[] = "@@(#)$Id: kmem.c,v 1.10 1999/02/05 05:58:43 deraadt Exp $";
d71 35
@


1.10
log
@ipf 3.2.10; work by kjell
@
text
@d1 1
a1 1
/*    $OpenBSD: kmem.c,v 1.9 1998/01/26 04:13:43 dgregor Exp $    */
d24 1
a24 1
static const char rcsid[] = "@@(#)$Id: kmem.c,v 1.9 1998/01/26 04:13:43 dgregor Exp $";
d29 2
a30 1
int	openkmem()
d32 4
a35 1
	if ((kmemfd = open(KMEM,O_RDONLY)) == -1)
d53 1
a53 1
		if (openkmem() == -1)
@


1.9
log
@IPF 3.2.3
@
text
@d1 1
a1 1
/*    $OpenBSD$    */
d3 1
a3 1
 * Copyright (C) 1993-1997 by Darren Reed.
d24 1
a24 1
static const char rcsid[] = "@@(#)$Id: kmem.c,v 2.0.2.5 1997/10/23 14:50:53 darrenr Exp $";
@


1.8
log
@add tag
@
text
@d1 1
a1 1
/*	$OpenBSD$	*/
d3 1
a3 1
 * (C)opyright 1993,1994,1995 by Darren Reed.
d20 1
d22 3
a24 5
#define KMEM "/dev/kmem"

#if !defined(lint) && defined(LIBC_SCCS)
static  char    sccsid[] = "@@(#)kmem.c	1.4 1/12/96 (C) 1992 Darren Reed";
static	char	rcsid[] = "$Id: kmem.c,v 1.7 1997/02/12 18:27:48 dm Exp $";
d41 1
a41 1
u_long	pos;
@


1.7
log
@Sign extension problem.
@
text
@d1 1
d25 1
a25 1
static	char	rcsid[] = "$Id: kmem.c,v 1.6 1997/02/11 22:23:44 kstailey Exp $";
@


1.6
log
@IPF 1.3.7
@
text
@d24 1
a24 1
static	char	rcsid[] = "$Id: kmem.c,v 2.0.1.1 1997/01/09 15:14:44 darrenr Exp $";
d41 1
a41 1
long	pos;
@


1.5
log
@missing unsigned caused bad sign-extension
@
text
@d22 1
a22 1
#ifndef lint
d24 1
a24 1
static	char	rcsid[] = "$Id: kmem.c,v 1.4 1996/07/18 05:08:10 dm Exp $";
d41 1
a41 1
u_long	pos;
@


1.4
log
@ipfilter 3.1.0
@
text
@d24 1
a24 1
static	char	rcsid[] = "$Id: kmem.c,v 1.1.1.1 1996/06/23 07:27:15 darrenr Exp $";
d41 1
a41 1
long	pos;
@


1.3
log
@update rcsid
@
text
@a0 2
/*	$OpenBSD$	*/

d24 1
@


1.2
log
@IP filter 3.0.1
@
text
@d1 2
@


1.1
log
@from beurton@@fnet.fr:  Darren Reed's IP filter
@
text
@d13 1
d23 1
a23 1
static  char    sccsid[] = "@@(#)kmem.c	1.3 10/15/95 (C) 1992 Darren Reed";
@
