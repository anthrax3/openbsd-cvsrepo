head	1.171;
access;
symbols
	OPENBSD_6_1:1.167.0.4
	OPENBSD_6_1_BASE:1.167
	OPENBSD_6_0:1.165.0.6
	OPENBSD_6_0_BASE:1.165
	OPENBSD_5_9:1.165.0.2
	OPENBSD_5_9_BASE:1.165
	OPENBSD_5_8:1.165.0.4
	OPENBSD_5_8_BASE:1.165
	OPENBSD_5_7:1.164.0.2
	OPENBSD_5_7_BASE:1.164
	OPENBSD_5_6:1.164.0.4
	OPENBSD_5_6_BASE:1.164
	OPENBSD_5_5:1.163.0.6
	OPENBSD_5_5_BASE:1.163
	OPENBSD_5_4:1.163.0.2
	OPENBSD_5_4_BASE:1.163
	OPENBSD_5_3:1.156.0.2
	OPENBSD_5_3_BASE:1.156
	OPENBSD_5_2:1.155.0.4
	OPENBSD_5_2_BASE:1.155
	OPENBSD_5_1_BASE:1.155
	OPENBSD_5_1:1.155.0.2
	OPENBSD_5_0:1.154.0.2
	OPENBSD_5_0_BASE:1.154
	OPENBSD_4_9:1.153.0.2
	OPENBSD_4_9_BASE:1.153
	OPENBSD_4_8:1.145.0.2
	OPENBSD_4_8_BASE:1.145
	OPENBSD_4_7:1.142.0.2
	OPENBSD_4_7_BASE:1.142
	OPENBSD_4_6:1.139.0.8
	OPENBSD_4_6_BASE:1.139
	OPENBSD_4_5:1.139.0.4
	OPENBSD_4_5_BASE:1.139
	OPENBSD_4_4:1.139.0.2
	OPENBSD_4_4_BASE:1.139
	OPENBSD_4_3:1.133.0.4
	OPENBSD_4_3_BASE:1.133
	OPENBSD_4_2:1.133.0.2
	OPENBSD_4_2_BASE:1.133
	OPENBSD_4_1:1.128.0.2
	OPENBSD_4_1_BASE:1.128
	OPENBSD_4_0:1.121.0.2
	OPENBSD_4_0_BASE:1.121
	OPENBSD_3_9:1.120.0.4
	OPENBSD_3_9_BASE:1.120
	OPENBSD_3_8:1.120.0.2
	OPENBSD_3_8_BASE:1.120
	OPENBSD_3_7:1.118.0.2
	OPENBSD_3_7_BASE:1.118
	OPENBSD_3_6:1.115.0.2
	OPENBSD_3_6_BASE:1.115
	OPENBSD_3_5:1.110.0.2
	OPENBSD_3_5_BASE:1.110
	OPENBSD_3_4:1.101.0.2
	OPENBSD_3_4_BASE:1.101
	OPENBSD_3_3:1.92.0.2
	OPENBSD_3_3_BASE:1.92
	OPENBSD_3_2:1.52.0.2
	OPENBSD_3_2_BASE:1.52
	OPENBSD_3_1:1.46.0.2
	OPENBSD_3_1_BASE:1.46
	OPENBSD_3_0:1.34.0.2
	OPENBSD_3_0_BASE:1.34;
locks; strict;
comment	@.\" @;


1.171
date	2017.08.11.22.30.38;	author benno;	state Exp;
branches;
next	1.170;
commitid	y1VyeV9JnotblbHq;

1.170
date	2017.07.20.07.45.10;	author jmc;	state Exp;
branches;
next	1.169;
commitid	SWUNZNim8KMSPiIV;

1.169
date	2017.04.23.07.40.34;	author jmc;	state Exp;
branches;
next	1.168;
commitid	CQvnD69kpoTNESKi;

1.168
date	2017.04.21.23.22.49;	author yasuoka;	state Exp;
branches;
next	1.167;
commitid	VDcRsUYNkO1EkSrm;

1.167
date	2017.01.26.18.45.12;	author jmc;	state Exp;
branches;
next	1.166;
commitid	d80AoK2jJKMYvBIi;

1.166
date	2017.01.26.08.24.34;	author benno;	state Exp;
branches;
next	1.165;
commitid	LS683r4g6WQ5GcPt;

1.165
date	2015.06.15.08.48.23;	author sthen;	state Exp;
branches;
next	1.164;
commitid	mqwXnrlsUFvaYp09;

1.164
date	2014.04.19.14.22.32;	author henning;	state Exp;
branches;
next	1.163;

1.163
date	2013.07.21.17.22.49;	author jmc;	state Exp;
branches;
next	1.162;

1.162
date	2013.07.21.13.55.15;	author jmc;	state Exp;
branches;
next	1.161;

1.161
date	2013.07.21.13.20.11;	author jmc;	state Exp;
branches;
next	1.160;

1.160
date	2013.07.20.05.57.04;	author jmc;	state Exp;
branches;
next	1.159;

1.159
date	2013.07.19.07.44.21;	author jmc;	state Exp;
branches;
next	1.158;

1.158
date	2013.07.05.13.07.57;	author blambert;	state Exp;
branches;
next	1.157;

1.157
date	2013.03.13.20.57.47;	author sthen;	state Exp;
branches;
next	1.156;

1.156
date	2012.09.29.01.41.01;	author lteo;	state Exp;
branches;
next	1.155;

1.155
date	2011.11.23.10.24.37;	author henning;	state Exp;
branches;
next	1.154;

1.154
date	2011.04.23.10.14.59;	author sobrado;	state Exp;
branches;
next	1.153;

1.153
date	2010.10.03.19.24.38;	author jmc;	state Exp;
branches;
next	1.152;

1.152
date	2010.10.01.12.47.38;	author reyk;	state Exp;
branches;
next	1.151;

1.151
date	2010.10.01.12.33.14;	author reyk;	state Exp;
branches;
next	1.150;

1.150
date	2010.09.20.19.25.20;	author jmc;	state Exp;
branches;
next	1.149;

1.149
date	2010.09.19.22.33.44;	author schwarze;	state Exp;
branches;
next	1.148;

1.148
date	2010.09.17.06.33.47;	author jmc;	state Exp;
branches;
next	1.147;

1.147
date	2010.09.16.11.56.36;	author jmc;	state Exp;
branches;
next	1.146;

1.146
date	2010.09.12.16.36.20;	author jmc;	state Exp;
branches;
next	1.145;

1.145
date	2010.06.25.23.27.47;	author henning;	state Exp;
branches;
next	1.144;

1.144
date	2010.03.23.17.34.30;	author jmc;	state Exp;
branches;
next	1.143;

1.143
date	2010.03.23.13.31.29;	author henning;	state Exp;
branches;
next	1.142;

1.142
date	2010.01.18.23.52.46;	author mcbride;	state Exp;
branches;
next	1.141;

1.141
date	2009.09.28.22.13.20;	author dlg;	state Exp;
branches;
next	1.140;

1.140
date	2009.09.03.08.19.04;	author phessler;	state Exp;
branches;
next	1.139;

1.139
date	2008.06.11.07.23.36;	author jmc;	state Exp;
branches;
next	1.138;

1.138
date	2008.06.10.20.55.02;	author mcbride;	state Exp;
branches;
next	1.137;

1.137
date	2008.05.16.06.41.43;	author jmc;	state Exp;
branches;
next	1.136;

1.136
date	2008.05.16.01.22.00;	author mpf;	state Exp;
branches;
next	1.135;

1.135
date	2008.05.09.13.59.31;	author mpf;	state Exp;
branches;
next	1.134;

1.134
date	2008.05.06.03.50.03;	author mpf;	state Exp;
branches;
next	1.133;

1.133
date	2007.07.01.11.38.51;	author henning;	state Exp;
branches;
next	1.132;

1.132
date	2007.05.31.19.19.46;	author jmc;	state Exp;
branches;
next	1.131;

1.131
date	2007.04.21.14.49.45;	author henning;	state Exp;
branches;
next	1.130;

1.130
date	2007.04.20.07.30.16;	author jmc;	state Exp;
branches;
next	1.129;

1.129
date	2007.03.21.03.01.31;	author mcbride;	state Exp;
branches;
next	1.128;

1.128
date	2007.01.30.21.01.56;	author jmc;	state Exp;
branches;
next	1.127;

1.127
date	2007.01.18.20.45.55;	author henning;	state Exp;
branches;
next	1.126;

1.126
date	2006.11.20.14.31.17;	author mcbride;	state Exp;
branches;
next	1.125;

1.125
date	2006.11.01.09.03.00;	author jmc;	state Exp;
branches;
next	1.124;

1.124
date	2006.11.01.00.23.48;	author mcbride;	state Exp;
branches;
next	1.123;

1.123
date	2006.10.31.14.41.25;	author mcbride;	state Exp;
branches;
next	1.122;

1.122
date	2006.10.23.07.05.49;	author jmc;	state Exp;
branches;
next	1.121;

1.121
date	2006.06.09.15.20.03;	author jmc;	state Exp;
branches;
next	1.120;

1.120
date	2005.06.13.20.18.52;	author henning;	state Exp;
branches;
next	1.119;

1.119
date	2005.05.22.21.05.23;	author mpf;	state Exp;
branches;
next	1.118;

1.118
date	2005.01.05.23.41.45;	author jmc;	state Exp;
branches;
next	1.117;

1.117
date	2005.01.05.18.30.14;	author mcbride;	state Exp;
branches;
next	1.116;

1.116
date	2004.12.13.23.59.28;	author jmc;	state Exp;
branches;
next	1.115;

1.115
date	2004.08.26.16.14.58;	author jaredy;	state Exp;
branches;
next	1.114;

1.114
date	2004.07.23.10.20.42;	author jmc;	state Exp;
branches;
next	1.113;

1.113
date	2004.07.16.23.44.24;	author frantzen;	state Exp;
branches;
next	1.112;

1.112
date	2004.06.21.20.47.11;	author msf;	state Exp;
branches;
next	1.111;

1.111
date	2004.05.30.21.48.24;	author jmc;	state Exp;
branches;
next	1.110;

1.110
date	2004.03.20.09.31.42;	author david;	state Exp;
branches;
next	1.109;

1.109
date	2004.02.27.10.42.00;	author henning;	state Exp;
branches;
next	1.108;

1.108
date	2004.02.17.08.48.29;	author cedric;	state Exp;
branches;
next	1.107;

1.107
date	2004.02.12.11.03.45;	author jmc;	state Exp;
branches;
next	1.106;

1.106
date	2004.02.12.02.05.32;	author beck;	state Exp;
branches;
next	1.105;

1.105
date	2003.12.31.11.18.24;	author cedric;	state Exp;
branches;
next	1.104;

1.104
date	2003.12.16.16.43.32;	author jmc;	state Exp;
branches;
next	1.103;

1.103
date	2003.12.15.00.02.03;	author mcbride;	state Exp;
branches;
next	1.102;

1.102
date	2003.09.18.09.18.51;	author jmc;	state Exp;
branches;
next	1.101;

1.101
date	2003.08.29.21.47.36;	author cedric;	state Exp;
branches;
next	1.100;

1.100
date	2003.08.28.09.41.22;	author jmc;	state Exp;
branches;
next	1.99;

1.99
date	2003.08.22.21.50.34;	author david;	state Exp;
branches;
next	1.98;

1.98
date	2003.08.21.19.12.08;	author frantzen;	state Exp;
branches;
next	1.97;

1.97
date	2003.05.24.17.50.16;	author jmc;	state Exp;
branches;
next	1.96;

1.96
date	2003.05.24.14.43.20;	author cedric;	state Exp;
branches;
next	1.95;

1.95
date	2003.05.05.15.43.39;	author dhartmei;	state Exp;
branches;
next	1.94;

1.94
date	2003.05.03.18.57.40;	author jmc;	state Exp;
branches;
next	1.93;

1.93
date	2003.04.03.10.21.40;	author cedric;	state Exp;
branches;
next	1.92;

1.92
date	2003.03.11.09.59.37;	author david;	state Exp;
branches;
next	1.91;

1.91
date	2003.03.11.09.23.30;	author david;	state Exp;
branches;
next	1.90;

1.90
date	2003.03.10.12.34.20;	author henning;	state Exp;
branches;
next	1.89;

1.89
date	2003.03.10.07.22.04;	author deraadt;	state Exp;
branches;
next	1.88;

1.88
date	2003.03.07.15.16.33;	author cedric;	state Exp;
branches;
next	1.87;

1.87
date	2003.03.07.13.27.12;	author henning;	state Exp;
branches;
next	1.86;

1.86
date	2003.03.06.03.49.50;	author david;	state Exp;
branches;
next	1.85;

1.85
date	2003.03.04.22.18.43;	author deraadt;	state Exp;
branches;
next	1.84;

1.84
date	2003.02.24.10.26.01;	author cedric;	state Exp;
branches;
next	1.83;

1.83
date	2003.02.20.22.09.27;	author deraadt;	state Exp;
branches;
next	1.82;

1.82
date	2003.02.20.11.08.06;	author cedric;	state Exp;
branches;
next	1.81;

1.81
date	2003.02.19.21.50.16;	author henning;	state Exp;
branches;
next	1.80;

1.80
date	2003.02.19.12.48.11;	author henning;	state Exp;
branches;
next	1.79;

1.79
date	2003.02.14.17.17.27;	author henning;	state Exp;
branches;
next	1.78;

1.78
date	2003.02.14.14.11.44;	author cedric;	state Exp;
branches;
next	1.77;

1.77
date	2003.02.14.12.04.23;	author henning;	state Exp;
branches;
next	1.76;

1.76
date	2003.02.14.11.04.22;	author cedric;	state Exp;
branches;
next	1.75;

1.75
date	2003.02.14.09.44.31;	author henning;	state Exp;
branches;
next	1.74;

1.74
date	2003.02.13.10.14.43;	author henning;	state Exp;
branches;
next	1.73;

1.73
date	2003.02.11.20.17.35;	author henning;	state Exp;
branches;
next	1.72;

1.72
date	2003.02.08.15.39.06;	author dhartmei;	state Exp;
branches;
next	1.71;

1.71
date	2003.01.28.10.40.21;	author jmc;	state Exp;
branches;
next	1.70;

1.70
date	2003.01.25.01.01.04;	author henning;	state Exp;
branches;
next	1.69;

1.69
date	2003.01.25.00.47.41;	author henning;	state Exp;
branches;
next	1.68;

1.68
date	2003.01.24.13.22.05;	author henning;	state Exp;
branches;
next	1.67;

1.67
date	2003.01.22.01.15.32;	author cedric;	state Exp;
branches;
next	1.66;

1.66
date	2003.01.19.13.48.06;	author dhartmei;	state Exp;
branches;
next	1.65;

1.65
date	2003.01.10.16.09.19;	author cedric;	state Exp;
branches;
next	1.64;

1.64
date	2003.01.10.10.51.48;	author cedric;	state Exp;
branches;
next	1.63;

1.63
date	2003.01.09.17.41.06;	author henning;	state Exp;
branches;
next	1.62;

1.62
date	2003.01.09.10.40.44;	author cedric;	state Exp;
branches;
next	1.61;

1.61
date	2003.01.03.21.37.44;	author cedric;	state Exp;
branches;
next	1.60;

1.60
date	2002.12.15.16.52.35;	author margarida;	state Exp;
branches;
next	1.59;

1.59
date	2002.12.15.15.41.59;	author margarida;	state Exp;
branches;
next	1.58;

1.58
date	2002.12.06.00.47.31;	author dhartmei;	state Exp;
branches;
next	1.57;

1.57
date	2002.12.04.08.07.28;	author deraadt;	state Exp;
branches;
next	1.56;

1.56
date	2002.11.24.18.02.06;	author pb;	state Exp;
branches;
next	1.55;

1.55
date	2002.11.24.17.44.44;	author pb;	state Exp;
branches;
next	1.54;

1.54
date	2002.11.20.14.08.03;	author pb;	state Exp;
branches;
next	1.53;

1.53
date	2002.11.09.00.57.20;	author fgsch;	state Exp;
branches;
next	1.52;

1.52
date	2002.09.18.07.33.47;	author deraadt;	state Exp;
branches;
next	1.51;

1.51
date	2002.06.27.14.12.50;	author henning;	state Exp;
branches;
next	1.50;

1.50
date	2002.06.25.08.13.25;	author henning;	state Exp;
branches;
next	1.49;

1.49
date	2002.06.11.06.49.19;	author kjell;	state Exp;
branches;
next	1.48;

1.48
date	2002.06.11.05.45.10;	author henning;	state Exp;
branches;
next	1.47;

1.47
date	2002.06.03.16.18.53;	author kjell;	state Exp;
branches;
next	1.46;

1.46
date	2002.04.08.16.26.52;	author dhartmei;	state Exp;
branches;
next	1.45;

1.45
date	2002.03.26.17.35.37;	author frantzen;	state Exp;
branches;
next	1.44;

1.44
date	2002.03.25.22.05.49;	author frantzen;	state Exp;
branches;
next	1.43;

1.43
date	2002.03.21.10.12.42;	author dhartmei;	state Exp;
branches;
next	1.42;

1.42
date	2002.03.11.22.22.57;	author dhartmei;	state Exp;
branches;
next	1.41;

1.41
date	2002.02.26.07.25.33;	author dhartmei;	state Exp;
branches;
next	1.40;

1.40
date	2002.02.11.18.43.51;	author mpech;	state Exp;
branches;
next	1.39;

1.39
date	2002.01.09.11.30.53;	author dhartmei;	state Exp;
branches;
next	1.38;

1.38
date	2001.12.21.11.41.50;	author mpech;	state Exp;
branches;
next	1.37;

1.37
date	2001.12.13.20.16.48;	author mpech;	state Exp;
branches;
next	1.36;

1.36
date	2001.12.10.18.13.30;	author dhartmei;	state Exp;
branches;
next	1.35;

1.35
date	2001.12.10.18.08.12;	author dhartmei;	state Exp;
branches;
next	1.34;

1.34
date	2001.10.11.00.53.21;	author dhartmei;	state Exp;
branches;
next	1.33;

1.33
date	2001.09.30.05.29.37;	author frantzen;	state Exp;
branches;
next	1.32;

1.32
date	2001.09.06.15.04.34;	author mpech;	state Exp;
branches;
next	1.31;

1.31
date	2001.08.28.00.02.43;	author frantzen;	state Exp;
branches;
next	1.30;

1.30
date	2001.08.22.17.28.02;	author beck;	state Exp;
branches;
next	1.29;

1.29
date	2001.08.19.19.25.26;	author dhartmei;	state Exp;
branches;
next	1.28;

1.28
date	2001.08.19.18.30.58;	author dhartmei;	state Exp;
branches;
next	1.27;

1.27
date	2001.08.11.12.05.00;	author dhartmei;	state Exp;
branches;
next	1.26;

1.26
date	2001.08.03.16.03.02;	author mpech;	state Exp;
branches;
next	1.25;

1.25
date	2001.07.28.16.38.27;	author dhartmei;	state Exp;
branches;
next	1.24;

1.24
date	2001.07.26.13.01.46;	author dhartmei;	state Exp;
branches;
next	1.23;

1.23
date	2001.07.26.12.55.15;	author dhartmei;	state Exp;
branches;
next	1.22;

1.22
date	2001.07.20.18.07.11;	author mpech;	state Exp;
branches;
next	1.21;

1.21
date	2001.07.04.20.07.55;	author deraadt;	state Exp;
branches;
next	1.20;

1.20
date	2001.07.03.12.16.13;	author ho;	state Exp;
branches;
next	1.19;

1.19
date	2001.07.03.12.11.25;	author ho;	state Exp;
branches;
next	1.18;

1.18
date	2001.07.02.17.21.04;	author ho;	state Exp;
branches;
next	1.17;

1.17
date	2001.07.01.22.10.48;	author angelos;	state Exp;
branches;
next	1.16;

1.16
date	2001.07.01.16.58.51;	author kjell;	state Exp;
branches;
next	1.15;

1.15
date	2001.06.29.21.24.07;	author kjell;	state Exp;
branches;
next	1.14;

1.14
date	2001.06.27.21.54.46;	author kjell;	state Exp;
branches;
next	1.13;

1.13
date	2001.06.27.11.01.11;	author kjell;	state Exp;
branches;
next	1.12;

1.12
date	2001.06.26.23.24.05;	author kjell;	state Exp;
branches;
next	1.11;

1.11
date	2001.06.26.17.52.40;	author kjell;	state Exp;
branches;
next	1.10;

1.10
date	2001.06.26.17.14.12;	author deraadt;	state Exp;
branches;
next	1.9;

1.9
date	2001.06.26.17.04.01;	author kjell;	state Exp;
branches;
next	1.8;

1.8
date	2001.06.26.13.02.39;	author ian;	state Exp;
branches;
next	1.7;

1.7
date	2001.06.26.03.50.54;	author kjell;	state Exp;
branches;
next	1.6;

1.6
date	2001.06.26.00.16.55;	author ian;	state Exp;
branches;
next	1.5;

1.5
date	2001.06.25.23.49.28;	author jasoni;	state Exp;
branches;
next	1.4;

1.4
date	2001.06.25.21.27.16;	author ian;	state Exp;
branches;
next	1.3;

1.3
date	2001.06.25.19.32.19;	author ian;	state Exp;
branches;
next	1.2;

1.2
date	2001.06.25.19.07.22;	author smart;	state Exp;
branches;
next	1.1;

1.1
date	2001.06.25.16.12.33;	author kjell;	state Exp;
branches;
next	;


desc
@@


1.171
log
@add option -N (no domain resolution)
manpage wording and reminder about usage() jmc@@
ok florian@@ henning@@
@
text
@.\" $OpenBSD: pfctl.8,v 1.170 2017/07/20 07:45:10 jmc Exp $
.\"
.\" Copyright (c) 2001 Kjell Wooding.  All rights reserved.
.\"
.\" Redistribution and use in source and binary forms, with or without
.\" modification, are permitted provided that the following conditions
.\" are met:
.\" 1. Redistributions of source code must retain the above copyright
.\"    notice, this list of conditions and the following disclaimer.
.\" 2. Redistributions in binary form must reproduce the above copyright
.\"    notice, this list of conditions and the following disclaimer in the
.\"    documentation and/or other materials provided with the distribution.
.\" 3. The name of the author may not be used to endorse or promote products
.\"    derived from this software without specific prior written permission.
.\"
.\" THIS SOFTWARE IS PROVIDED BY THE AUTHOR ``AS IS'' AND ANY EXPRESS OR
.\" IMPLIED WARRANTIES, INCLUDING, BUT NOT LIMITED TO, THE IMPLIED WARRANTIES
.\" OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE ARE DISCLAIMED.
.\" IN NO EVENT SHALL THE AUTHOR BE LIABLE FOR ANY DIRECT, INDIRECT,
.\" INCIDENTAL, SPECIAL, EXEMPLARY, OR CONSEQUENTIAL DAMAGES (INCLUDING, BUT
.\" NOT LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES; LOSS OF USE,
.\" DATA, OR PROFITS; OR BUSINESS INTERRUPTION) HOWEVER CAUSED AND ON ANY
.\" THEORY OF LIABILITY, WHETHER IN CONTRACT, STRICT LIABILITY, OR TORT
.\" (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE USE OF
.\" THIS SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.
.\"
.Dd $Mdocdate: July 20 2017 $
.Dt PFCTL 8
.Os
.Sh NAME
.Nm pfctl
.Nd control the packet filter (PF) device
.Sh SYNOPSIS
.Nm pfctl
.Bk -words
.Op Fl deghNnPqrvz
.Op Fl a Ar anchor
.Op Fl D Ar macro Ns = Ns Ar value
.Op Fl F Ar modifier
.Op Fl f Ar file
.Op Fl i Ar interface
.Op Fl K Ar key
.Op Fl k Ar key
.Op Fl L Ar statefile
.Op Fl o Ar level
.Op Fl p Ar device
.Op Fl S Ar statefile
.Op Fl s Ar modifier Op Fl R Ar id
.Op Fl t Ar table Fl T Ar command Op Ar address ...
.Op Fl V Ar rdomain
.Op Fl x Ar level
.Ek
.Sh DESCRIPTION
The
.Nm
utility communicates with the packet filter device using the
ioctl interface described in
.Xr pf 4 .
It allows ruleset and parameter configuration,
and retrieval of status information from the packet filter.
Packet filtering restricts the types of packets that pass through
network interfaces entering or leaving the host based on filter
rules as described in
.Xr pf.conf 5 .
The packet filter can also replace addresses and ports of packets.
.Pp
The packet filter is enabled by default.
Should
.Nm
be unable to load a ruleset,
an error occurs and the original ruleset remains in place.
If this happens at system startup,
the ruleset defined by the
.Va RULES
variable in
.Xr rc 8
remains in place.
.Pp
The packet filter does not itself forward packets between interfaces.
Forwarding can be enabled by setting the
.Xr sysctl 8
variables
.Em net.inet.ip.forwarding
and/or
.Em net.inet6.ip6.forwarding
to 1.
Set them permanently in
.Xr sysctl.conf 5 .
.Pp
At least one option must be specified.
The options are as follows:
.Bl -tag -width Ds
.It Fl a Ar anchor
Apply flags
.Fl f ,
.Fl F ,
and
.Fl s
only to the rules in the specified
.Ar anchor .
In addition to the main ruleset,
.Nm
can load and manipulate additional rulesets by name,
called anchors.
The main ruleset is the default anchor.
.Pp
Anchors are referenced by name and may be nested,
with the various components of the anchor path separated by
.Sq /
characters, similar to how file system hierarchies are laid out.
The last component of the anchor path is where ruleset operations are
performed.
.Pp
Evaluation of
.Ar anchor
rules from the main ruleset is described in
.Xr pf.conf 5 .
.Pp
For example, the following will show all filter rules (see the
.Fl s
flag below) inside the anchor
.Dq authpf/smith(1234) ,
which would have been created for user
.Dq smith
by
.Xr authpf 8 ,
PID 1234:
.Bd -literal -offset indent
# pfctl -a "authpf/smith(1234)" -s rules
.Ed
.Pp
Private tables can also be put inside anchors, either by having table
statements in the
.Xr pf.conf 5
file that is loaded in the anchor, or by using regular table commands, as in:
.Bd -literal -offset indent
# pfctl -a foo/bar -t mytable -T add 1.2.3.4 5.6.7.8
.Ed
.Pp
When a rule referring to a table is loaded in an anchor, the rule will use the
private table if one is defined, and then fall back to the table defined in the
main ruleset, if there is one.
This is similar to C rules for variable scope.
It is possible to create distinct tables with the same name in the global
ruleset and in an anchor, but this is often bad design and a warning will be
issued in that case.
.Pp
By default, recursive inline printing of anchors applies only to unnamed
anchors specified inline in the ruleset.
If the anchor name is terminated with a
.Sq *
character, the
.Fl s
flag will recursively print all anchors in a brace delimited block.
For example the following will print the
.Dq authpf
ruleset recursively:
.Bd -literal -offset indent
# pfctl -a 'authpf/*' -sr
.Ed
.Pp
To print the main ruleset recursively, specify only
.Sq *
as the anchor name:
.Bd -literal -offset indent
# pfctl -a '*' -sr
.Ed
.It Fl D Ar macro Ns = Ns Ar value
Define
.Ar macro
to be set to
.Ar value
on the command line.
Overrides the definition of
.Ar macro
in the ruleset.
.It Fl d
Disable the packet filter.
.It Fl e
Enable the packet filter.
.It Fl F Ar modifier
Flush the filter parameters specified by
.Ar modifier
(may be abbreviated):
.Pp
.Bl -tag -width xxxxxxxxxxxx -compact
.It Fl F Cm rules
Flush the filter rules.
.It Fl F Cm states
Flush the state table (NAT and filter).
.It Fl F Cm Sources
Flush the source tracking table.
.It Fl F Cm info
Flush the filter information (statistics that are not bound to rules).
.It Fl F Cm Tables
Flush the tables.
.It Fl F Cm osfp
Flush the passive operating system fingerprints.
.It Fl F Cm all
Flush all of the above.
.El
.It Fl f Ar file
Replace the current ruleset with
the rules contained in
.Ar file .
This
.Ar file
may contain macros, tables, options, and normalization, queueing,
translation, and filtering rules.
With the exception of macros and tables, the statements must appear in that
order.
.It Fl g
Include output helpful for debugging.
.It Fl h
Help.
.It Fl i Ar interface
Restrict the operation to the given
.Ar interface .
.It Fl K Ar key
Kill all of the source tracking entries originating from the
host or network specified by
.Ar key .
A second
.Fl K
option may be specified, which will kill all the source tracking entries
from the first host/network to the second.
.It Fl k Ar key
Kill all of the state entries originating from the
host or network specified by
.Ar key .
A second
.Fl k
option may be specified, which will kill all the state entries
from the first host/network to the second.
.Pp
A network prefix length of 0 can be used as a wildcard.
To kill all states with the target
.Dq host2 :
.Pp
.Dl # pfctl -k 0.0.0.0/0 -k host2
.Pp
It is also possible to kill states by rule label, state key, or state ID.
In this mode the first
.Fl k
argument is used to specify the type;
a second
.Fl k
gives the actual target.
.Pp
To kill states by rule label,
use the
.Cm label
modifier.
To kill all states created from rules carrying the label
.Dq foobar :
.Pp
.Dl # pfctl -k label -k foobar
.Pp
To kill one specific state by its state key
(as shown by pfctl -s state),
use the
.Cm key
modifier.
To kill a state originating from 10.0.0.101:32123 to 10.0.0.1:80,
protocol TCP, use:
.Pp
.Dl # pfctl -k key -k 'tcp 10.0.0.1:80 <- 10.0.0.101:32123'
.Pp
To kill one specific state by its unique state ID
(as shown by pfctl -s state -vv),
use the
.Cm id
modifier.
To kill a state with ID 4823e84500000003 use:
.Pp
.Dl # pfctl -k id -k 4823e84500000003
.Pp
To kill a state with ID 4823e84500000018 created from a backup
firewall with hostid 00000002 use:
.Pp
.Dl # pfctl -k id -k 4823e84500000018/2
.It Fl L Ar statefile
Load pf states from the file specified by
.Ar statefile .
.It Fl N
Do not perform domain name resolution.
If a name cannot be resolved without DNS, an error will be reported.
.It Fl n
Do not actually load rules, just parse them.
.It Fl o Ar level
Control the ruleset optimizer, overriding any rule file settings.
.Pp
.Bl -tag -width xxxxxxxxxxxx -compact
.It Fl o Cm none
Disable the ruleset optimizer.
.It Fl o Cm basic
Enable basic ruleset optimizations.
This is the default behaviour.
.It Fl o Cm profile
Enable basic ruleset optimizations with profiling.
.El
For further information on the ruleset optimizer, see
.Xr pf.conf 5 .
.It Fl P
Print ports using their names in
.Pa /etc/services
if available.
.It Fl p Ar device
Use the device file
.Ar device
instead of the default
.Pa /dev/pf .
.It Fl q
Only print errors and warnings.
.It Fl r
Perform reverse DNS lookups on states when displaying them.
.It Fl S Ar statefile
Store the pf state table in the file specified by
.Ar statefile .
.It Fl s Ar modifier
Show the filter parameters specified by
.Ar modifier
(may be abbreviated):
.Pp
.Bl -tag -width xxxxxxxxxxxxxx -compact
.It Fl s Cm queue
Show the currently loaded queue definitions.
When used together with
.Fl v ,
per-queue statistics are also shown.
When used together with
.Fl v v ,
.Nm
will loop and show updated queue statistics every five seconds, including
measured bandwidth and packets per second.
.It Fl s Cm rules
Show the currently loaded filter rules.
If
.Fl R Ar id
is specified as well,
only the rule with the specified numeric ID is shown.
When used together with
.Fl v ,
the per-rule statistics (number of evaluations,
packets and bytes) are also shown.
Note that the
.Dq skip step
optimization done automatically by the kernel
will skip evaluation of rules where possible.
Packets passed statefully are counted in the rule that created the state
(even though the rule isn't evaluated more than once for the entire
connection).
.It Fl s Cm Anchors
Show the currently loaded anchors directly attached to the main ruleset.
If
.Fl a Ar anchor
is specified as well, the anchors loaded directly below the given
.Ar anchor
are shown instead.
If
.Fl v
is specified, all anchors attached under the target anchor will be
displayed recursively.
.It Fl s Cm states
Show the contents of the state table.
If
.Fl R Ar id
is specified as well,
only states created by the rule with the specified numeric ID are shown.
.It Fl s Cm Sources
Show the contents of the source tracking table.
.It Fl s Cm info
Show filter information (statistics and counters).
When used together with
.Fl v ,
source tracking statistics are also shown.
.It Fl s Cm labels
Show per-rule statistics (label, evaluations, packets total, bytes total,
packets in, bytes in, packets out, bytes out, state creations) of
filter rules with labels, useful for accounting.
If
.Fl R Ar id
is specified as well,
only the statistics for the rule with the specified numeric ID are shown.
.It Fl s Cm timeouts
Show the current global timeouts.
.It Fl s Cm memory
Show the current pool memory hard limits.
.It Fl s Cm Tables
Show the list of tables.
.It Fl s Cm osfp
Show the list of operating system fingerprints.
.It Fl s Cm Interfaces
Show the list of interfaces and interface drivers available to PF.
When used together with
.Fl v ,
it additionally lists which interfaces have skip rules activated.
When used together with
.Fl vv ,
interface statistics are also shown.
.Fl i
can be used to select an interface or a group of interfaces.
.It Fl s Cm all
Show all of the above, except for the lists of interfaces and operating
system fingerprints.
.El
.Pp
Counters shown with
.Fl s Cm info
are:
.Pp
.Bl -tag -width xxxxxxxxxxxxxx -compact
.It match
explicit rule match
.It bad-offset
currently unused
.It fragment
invalid fragments dropped
.It short
short packets dropped
.It normalize
dropped by normalizer: illegal packets
.It memory
memory could not be allocated
.It bad-timestamp
bad TCP timestamp; RFC 1323
.It congestion
network interface queue congested
.It ip-option
bad IP/IPv6 options
.It proto-cksum
invalid protocol checksum
.It state-mismatch
packet was associated with a state entry, but sequence numbers did not match
.It state-insert
state insertion failure
.It state-limit
configured state limit was reached
.It src-limit
source node/connection limit
.It synproxy
dropped by synproxy
.It translate
no free ports in translation port range
.It no-route
dropped by no-route
.El
.It Fl T Ar command Op Ar address ...
Specify the
.Ar command
(may be abbreviated) to apply to the table.
Commands include:
.Pp
.Bl -tag -width xxxxxxxxxxxx -compact
.It Fl T Cm kill
Kill a table.
.It Fl T Cm flush
Flush all addresses of a table.
.It Fl T Cm add
Add one or more addresses in a table.
Automatically create a nonexisting table.
.It Fl T Cm delete
Delete one or more addresses from a table.
.It Fl T Cm expire Ar number
Delete addresses which had their statistics cleared more than
.Ar number
seconds ago.
For entries which have never had their statistics cleared,
.Ar number
refers to the time they were added to the table.
.It Fl T Cm replace
Replace the addresses of the table.
Automatically create a nonexisting table.
.It Fl T Cm show
Show the content (addresses) of a table.
.It Fl T Cm test
Test if the given addresses match a table.
.It Fl T Cm zero
Clear all the statistics of a table.
.El
.Pp
For the
.Cm add ,
.Cm delete ,
.Cm replace ,
and
.Cm test
commands, the list of addresses can be specified either directly on the command
line and/or in an unformatted text file, using the
.Fl f
flag.
Comments starting with a
.Sq #
are allowed in the text file.
With these commands, the
.Fl v
flag can also be used once or twice, in which case
.Nm
will print the
detailed result of the operation for each individual address, prefixed by
one of the following letters:
.Pp
.Bl -tag -width XXX -compact
.It A
The address/network has been added.
.It C
The address/network has been changed (negated).
.It D
The address/network has been deleted.
.It M
The address matches
.Po
.Cm test
operation only
.Pc .
.It X
The address/network is duplicated and therefore ignored.
.It Y
The address/network cannot be added/deleted due to conflicting
.Sq \&!
attributes.
.It Z
The address/network has been cleared (statistics).
.El
.Pp
Each table can maintain a set of counters that can be retrieved using the
.Fl v
flag of
.Nm .
For example, the following commands define a wide open firewall which will keep
track of packets going to or coming from the
.Ox
FTP server.
The following commands configure the firewall and send 10 pings to the FTP
server:
.Bd -literal -offset indent
# printf "table <test> counters { ftp.openbsd.org }\en \e
    pass out to <test>\en" | pfctl -f-
# ping -qc10 ftp.openbsd.org
.Ed
.Pp
We can now use the table
.Cm show
command to output, for each address and packet direction, the number of packets
and bytes that are being passed, matched or blocked by rules referencing the
table.
Note that the match counters are incremented for every match rule in which
they are referenced, meaning that a single packet may be counted multiple times.
The time at which the current accounting started is also shown with the
.Dq Cleared
line.
.Bd -literal -offset indent
# pfctl -t test -vTshow
   198.51.100.81
        Cleared:        Fri Jun 28 11:17:37 2013
        In/Block:       [ Packets: 0	Bytes: 0	]
        In/Match        [ Packets: 54	Bytes: 10028	]
        In/Pass:        [ Packets: 5	Bytes: 1949	]
        Out/Block:      [ Packets: 0	Bytes: 0	]
        Out/Match       [ Packets: 65	Bytes: 12684	]
        Out/Pass:       [ Packets: 6	Bytes: 389	]
.Ed
.Pp
Similarly, it is possible to view global information about the tables
by using the
.Fl v
modifier twice and the
.Fl s
.Cm Tables
command.
This will display the number of addresses on each table,
the number of rules which reference the table, and the global
packet statistics for the whole table:
.Bd -literal -offset indent
# pfctl -vvsTables
--a-r-C test
        Addresses:   1
        Cleared:     Fri Jun 28 11:17:37 2013
        References:  [ Anchors: 0	Rules: 4	]
        Evaluations: [ NoMatch: 35	Match: 8	]
        In/Block:    [ Packets: 0	Bytes: 0	]
        In/Match:    [ Packets: 54	Bytes: 10028	]
        In/Pass:     [ Packets: 5	Bytes: 1949	]
        In/XPass:    [ Packets: 0	Bytes: 0	]
        Out/Block:   [ Packets: 0	Bytes: 0	]
        Out/Match:   [ Packets: 65	Bytes: 12684	]
        Out/Pass:    [ Packets: 6	Bytes: 389	]
        Out/XPass:   [ Packets: 0	Bytes: 0	]
.Ed
.Pp
Only packets creating state are matched in the Evaluations line,
but all packets passing as a result of the state are correctly accounted for.
Reloading the table(s) or ruleset will not affect packet accounting in any way.
The two
.Dq XPass
counters are incremented instead of the
.Dq Pass
counters when a
.Dq stateful
packet is passed but doesn't match the table anymore.
This will happen in our example if someone flushes the table while the
.Xr ping 8
command is running.
.Pp
When used with a single
.Fl v ,
.Nm
will only display the first line containing the table flags and name.
The flags are defined as follows:
.Pp
.Bl -tag -width XXX -compact
.It c
For constant tables, which cannot be altered outside
.Xr pf.conf 5 .
.It p
For persistent tables, which don't get automatically killed when no rules
refer to them.
.It a
For tables which are part of the
.Em active
tableset.
Tables without this flag do not really exist, cannot contain addresses, and are
only listed if the
.Fl g
flag is given.
.It i
For tables which are part of the
.Em inactive
tableset.
This flag can only be witnessed briefly during the loading of
.Xr pf.conf 5 .
.It r
For tables which are referenced (used) by rules.
.It h
This flag is set when a table in the main ruleset is hidden by one or more
tables of the same name from anchors attached below it.
.It C
This flag is set when per-address counters are enabled on the table.
.El
.It Fl t Ar table
Specify the name of the table.
.It Fl V Ar rdomain
Select the routing domain to be used to kill states by host or by label.
The rdomain of a state is displayed in parentheses before the host by
.Fl s Cm states .
.It Fl v
Produce more verbose output.
A second use of
.Fl v
will produce even more verbose output including ruleset warnings.
See the previous section for its effect on table commands.
.It Fl x Ar level
Set the debug
.Ar level ,
which limits the severity of log messages printed by
.Xr pf 4 .
This should be a keyword from the following ordered list
(highest to lowest):
.Cm emerg ,
.Cm alert ,
.Cm crit ,
.Cm err ,
.Cm warning ,
.Cm notice ,
.Cm info ,
and
.Cm debug .
These keywords correspond to the similar (LOG_) values specified to the
.Xr syslog 3
library routine,
and may be abbreviated on the command line.
.It Fl z
Clear per-rule statistics.
.El
.Sh FILES
.Bl -tag -width "/etc/pf.conf" -compact
.It Pa /etc/pf.conf
Packet filter rules file.
.It Pa /etc/pf.os
Passive operating system fingerprint database.
.El
.Sh SEE ALSO
.Xr pf 4 ,
.Xr pf.conf 5 ,
.Xr pf.os 5 ,
.Xr sysctl.conf 5 ,
.Xr authpf 8 ,
.Xr ftp-proxy 8 ,
.Xr rc 8 ,
.Xr rc.conf 8 ,
.Xr sysctl 8
.Sh HISTORY
The
.Nm
program and the
.Xr pf 4
filter mechanism first appeared in
.Ox 3.0 .
@


1.170
log
@"no-route" is also shown by -sinfo;
@
text
@d1 1
a1 1
.\" $OpenBSD: pfctl.8,v 1.169 2017/04/23 07:40:34 jmc Exp $
d27 1
a27 1
.Dd $Mdocdate: April 23 2017 $
d36 1
a36 1
.Op Fl deghnPqrvz
d285 3
@


1.169
log
@trim the documentation for -k: make it more consistent,
and do not try to do all the documenting in SYNOPSIS/usage();

ok deraadt
@
text
@d1 1
a1 1
.\" $OpenBSD: pfctl.8,v 1.168 2017/04/21 23:22:49 yasuoka Exp $
d27 1
a27 1
.Dd $Mdocdate: April 21 2017 $
d442 2
@


1.168
log
@Add "key" modifier for -k to make pfctl can kill a state by specifying
the key of the state.

ok sasha
@
text
@d1 1
a1 1
.\" $OpenBSD: pfctl.8,v 1.167 2017/01/26 18:45:12 jmc Exp $
d27 1
a27 1
.Dd $Mdocdate: January 26 2017 $
d42 2
a43 2
.Op Fl K Ar host | network
.Op Fl k Ar host | network | label | id
d219 12
a230 5
.It Fl K Ar host | network
Kill all of the source tracking entries originating from the specified
.Ar host
or
.Ar network .
a231 6
.Fl K Ar host
or
.Fl K Ar network
option may be specified, which will kill all the source tracking
entries from the first host/network to the second.
.It Xo
a232 19
.Ar host | network | label | key | id
.Xc
Kill all of the state entries matching the specified
.Ar host ,
.Ar network ,
.Ar label ,
.Ar key ,
or
.Ar id .
.Pp
For example, to kill all of the state entries originating from
.Dq host :
.Pp
.Dl # pfctl -k host
.Pp
A second
.Fl k Ar host
or
.Fl k Ar network
a234 10
To kill all of the state entries from
.Dq host1
to
.Dq host2 :
.Pp
.Dl # pfctl -k host1 -k host2
.Pp
To kill all states originating from 192.168.1.0/24 to 172.16.0.0/16:
.Pp
.Dl # pfctl -k 192.168.1.0/24 -k 172.16.0.0/16
d242 1
a242 1
It is also possible to kill states by rule label, state key or state ID.
d245 10
a254 4
argument is used to specify the type
of the second argument.
The following command would kill all states that have been created
from rules carrying the label
d259 2
a260 3
To kill one specific state by its key
(protocol, host1, port1, direction, host2 and port2 in the same format
of pfctl -s state),
d262 4
a265 4
.Ar key
modifier and as a second argument the state key.
To kill a state whose protocol is TCP and originating from
10.0.0.101:32123 to 10.0.0.1:80 use:
d272 2
a273 2
.Ar id
modifier and as a second argument the state ID and optional creator ID.
@


1.167
log
@one more fix i requested for previous;
@
text
@d1 1
a1 1
.\" $OpenBSD: pfctl.8,v 1.166 2017/01/26 08:24:34 benno Exp $
d232 1
a232 1
.Ar host | network | label | id
d238 1
d270 1
a270 1
It is also possible to kill states by rule label or state ID.
d280 11
@


1.166
log
@Select the routing domain to be used for kill states by host or by
label, by adding a -V <rdomain> option.
written by Bertrand Provost, provost DOT bertrand AT gmail DOT com, thanks.
ok florian@@, with feedback from florian and jmc.
@
text
@d1 1
a1 1
.\" $OpenBSD: pfctl.8,v 1.165 2015/06/15 08:48:23 sthen Exp $
d27 1
a27 1
.Dd $Mdocdate: June 15 2015 $
d649 1
a649 1
Select the routing domain to be used for kill states by host or by label.
@


1.165
log
@document pfctl -ss -R <rule>, ok mikeb@@
@
text
@d1 1
a1 1
.\" $OpenBSD: pfctl.8,v 1.164 2014/04/19 14:22:32 henning Exp $
d27 1
a27 1
.Dd $Mdocdate: April 19 2014 $
d50 1
d648 4
@


1.164
log
@remove altq bits here, too
(i was convinced i committed that yesterday already, hrm)
@
text
@d1 1
a1 1
.\" $OpenBSD: pfctl.8,v 1.163 2013/07/21 17:22:49 jmc Exp $
d27 1
a27 1
.Dd $Mdocdate: July 21 2013 $
d373 4
@


1.163
log
@zap one redundant line, replacing it with a note that although
SYNOPSIS suggests no options are neccessary, in fact a minimum of one
is required;

ok henning
@
text
@d1 1
a1 1
.\" $OpenBSD: pfctl.8,v 1.162 2013/07/21 13:55:15 jmc Exp $
a185 2
.It Fl F Cm queue
Flush the queue rules.
d334 1
a334 1
Show the currently loaded queue rules.
@


1.162
log
@tidy up DESCRIPTION somewhat, and format nicer;
ok henning
@
text
@d1 1
a1 1
.\" $OpenBSD: pfctl.8,v 1.161 2013/07/21 13:20:11 jmc Exp $
d89 1
a89 3
The
.Nm
utility provides several commands.
@


1.161
log
@re-zap the previous paragraph, but this time in its place document
what happens when a broken pf config is encountered, both generally
and at system startup;

ok henning
@
text
@d1 1
a1 1
.\" $OpenBSD: pfctl.8,v 1.160 2013/07/20 05:57:04 jmc Exp $
d27 1
a27 1
.Dd $Mdocdate: July 20 2013 $
d58 2
a59 3
It allows ruleset and parameter configuration and retrieval of status
information from the packet filter.
.Pp
a64 11
Replacing source addresses and ports of outgoing packets is called
NAT (Network Address Translation) and is used to connect an internal
network (usually reserved address space) to an external one (the
Internet) by making all connections to external hosts appear to
come from the gateway.
Replacing destination addresses and ports of incoming packets
is used to redirect connections to different hosts and/or ports.
A combination of both translations, bidirectional NAT, is also
supported.
Translation rules are described in
.Xr pf.conf 5 .
d66 1
d561 6
a566 6
        In/Block:       [ Packets: 0              Bytes: 0              ]
        In/Match        [ Packets: 54             Bytes: 10028          ]
        In/Pass:        [ Packets: 5              Bytes: 1949           ]
        Out/Block:      [ Packets: 0              Bytes: 0              ]
        Out/Match       [ Packets: 65             Bytes: 12684          ]
        Out/Pass:       [ Packets: 6              Bytes: 389            ]
d584 10
a593 10
        References:  [ Anchors: 0              Rules: 4              ]
        Evaluations: [ NoMatch: 35             Match: 8              ]
        In/Block:    [ Packets: 0              Bytes: 0              ]
        In/Match:    [ Packets: 54             Bytes: 10028          ]
        In/Pass:     [ Packets: 5              Bytes: 1949           ]
        In/XPass:    [ Packets: 0              Bytes: 0              ]
        Out/Block:   [ Packets: 0              Bytes: 0              ]
        Out/Match:   [ Packets: 65             Bytes: 12684          ]
        Out/Pass:    [ Packets: 6              Bytes: 389            ]
        Out/XPass:   [ Packets: 0              Bytes: 0              ]
@


1.160
log
@reverting previous until i can work out what henning is telling me...
@
text
@d1 1
a1 1
.\" $OpenBSD: pfctl.8,v 1.158 2013/07/05 13:07:57 blambert Exp $
d27 1
a27 1
.Dd $Mdocdate: July 5 2013 $
d78 8
a85 9
When the variable
.Va pf
is set to
.Dv YES
in
.Xr rc.conf.local 8 ,
the rule file specified with the variable
.Va pf_rules
is loaded automatically by the
d87 1
a87 1
scripts and the packet filter is enabled.
@


1.159
log
@remove redundant paragraph; from Pieter Verberne
@
text
@d78 12
@


1.158
log
@Collect and display 'match' counters for pf tables.

While here, fix pf table displays to fit within 80 chars.

Manpage input jmc@@

ok henning@@ reyk@@
@
text
@d1 1
a1 1
.\" $OpenBSD: pfctl.8,v 1.157 2013/03/13 20:57:47 sthen Exp $
d27 1
a27 1
.Dd $Mdocdate: March 13 2013 $
a76 12
.Pp
When the variable
.Va pf
is set to
.Dv YES
in
.Xr rc.conf.local 8 ,
the rule file specified with the variable
.Va pf_rules
is loaded automatically by the
.Xr rc 8
scripts and the packet filter is enabled.
@


1.157
log
@Describe the counters that "pfctl -s info" displays. Tweaks jmc@@, ok deraadt@@
@
text
@d1 1
a1 1
.\" $OpenBSD: pfctl.8,v 1.156 2012/09/29 01:41:01 lteo Exp $
d27 1
a27 1
.Dd $Mdocdate: September 29 2012 $
d562 4
a565 1
and bytes that are being passed or blocked by rules referencing the table.
d571 8
a578 6
   129.128.5.191
    Cleared:     Thu Feb 13 18:55:18 2003
    In/Block:    [ Packets: 0        Bytes: 0        ]
    In/Pass:     [ Packets: 10       Bytes: 840      ]
    Out/Block:   [ Packets: 0        Bytes: 0        ]
    Out/Pass:    [ Packets: 10       Bytes: 840      ]
d594 12
a605 10
    Addresses:   1
    Cleared:     Thu Feb 13 18:55:18 2003
    References:  [ Anchors: 0        Rules: 1        ]
    Evaluations: [ NoMatch: 3496     Match: 1        ]
    In/Block:    [ Packets: 0        Bytes: 0        ]
    In/Pass:     [ Packets: 10       Bytes: 840      ]
    In/XPass:    [ Packets: 0        Bytes: 0        ]
    Out/Block:   [ Packets: 0        Bytes: 0        ]
    Out/Pass:    [ Packets: 10       Bytes: 840      ]
    Out/XPass:   [ Packets: 0        Bytes: 0        ]
d608 2
a609 3
As we can see here, only one packet \- the initial ping request \- matched the
table, but all packets passing as the result of the state are correctly
accounted for.
@


1.156
log
@Remove extra .Pp

ok jmc
@
text
@d1 1
a1 1
.\" $OpenBSD: pfctl.8,v 1.155 2011/11/23 10:24:37 henning Exp $
d27 1
a27 1
.Dd $Mdocdate: November 23 2011 $
d348 1
a348 1
.Bl -tag -width xxxxxxxxxxxxx -compact
d425 39
@


1.155
log
@print ports as numbers by default; -P prints names instead
2/2 from Lawrence Teo <lteo at devio dot us>
ok sthen dlg and myself
@
text
@d1 1
a1 1
.\" $OpenBSD: pfctl.8,v 1.154 2011/04/23 10:14:59 sobrado Exp $
d27 1
a27 1
.Dd $Mdocdate: April 23 2011 $
a307 1
.Pp
@


1.154
log
@improve line breaking in SYNOPSIS now that semantics of the .Bk macro
has changed to conform with modern groff releases.

diff for route6d(8) written mostly by schwarze@@, with lots of useful
advice from jmc@@.

ok jmc@@, schwarze@@
@
text
@d1 1
a1 1
.\" $OpenBSD: pfctl.8,v 1.153 2010/10/03 19:24:38 jmc Exp $
d27 1
a27 1
.Dd $Mdocdate: October 3 2010 $
d36 1
a36 1
.Op Fl deghnqrvz
d328 4
@


1.153
log
@tweak previous;
@
text
@d1 1
a1 1
.\" $OpenBSD: pfctl.8,v 1.152 2010/10/01 12:47:38 reyk Exp $
d27 1
a27 1
.Dd $Mdocdate: October 1 2010 $
d43 1
a43 4
.Oo
.Fl k
.Ar host | network | label | id
.Oc
d48 2
a49 9
.Oo
.Fl s Ar modifier
.Op Fl R Ar id
.Oc
.Oo
.Fl t Ar table
.Fl T Ar command
.Op Ar address ...
.Oc
@


1.152
log
@the grammar of my last commit worked with mandoc, but didn't work with nroff;
convert a long .Op line into a few lines of .Xo ... .Xc.  no "binary" change
with mandoc.
@
text
@d1 1
a1 1
.\" $OpenBSD: pfctl.8,v 1.151 2010/10/01 12:33:14 reyk Exp $
d51 4
a54 4
.Xo
.Oo Fl s Ar modifier
.Op Fl R Ar id Oc
.Xc
@


1.151
log
@Add the -R id option to pfctl that allows to show only a specified rule
by numeric ID in combination with the "-s rules" or "-s labels" options.
For example, this allows you to dump the statistics of a specified rule
only (pfctl -sr -v -R 0).

ok henning@@
@
text
@d1 1
a1 1
.\" $OpenBSD: pfctl.8,v 1.150 2010/09/20 19:25:20 jmc Exp $
d27 1
a27 1
.Dd $Mdocdate: September 20 2010 $
d51 4
a54 1
.Op Fl s Ar modifier Op Fl R Ar id
@


1.150
log
@tweak previous; ok schwarze
@
text
@d1 1
a1 1
.\" $OpenBSD: pfctl.8,v 1.149 2010/09/19 22:33:44 schwarze Exp $
d27 1
a27 1
.Dd $Mdocdate: September 19 2010 $
d51 1
a51 1
.Op Fl s Ar modifier
d365 4
d404 4
@


1.149
log
@Do not break .Op scope by .Oc.
While here, remove .Xo macros that were ugly workarounds
to deal with groff-1.15 bugs, but are required neither by modern groff
nor by mandoc nor by any documentation we are aware of.
Problem originally noticed by jmc@@ running mandoc -Tlint;
patch ok by jmc@@.
@
text
@d1 1
a1 1
.\" $OpenBSD: pfctl.8,v 1.148 2010/09/17 06:33:47 jmc Exp $
d27 1
a27 1
.Dd $Mdocdate: September 17 2010 $
d43 2
a44 1
.Oo Fl k
d52 2
a53 1
.Oo Fl t Ar table
d55 2
a56 1
.Pq Ar address ... Oc
@


1.148
log
@back out the -Fr hunk from previous: deraadt points out it is incorrectly
worded. i think what is there now is clear enough.
@
text
@d1 1
a1 1
.\" $OpenBSD: pfctl.8,v 1.147 2010/09/16 11:56:36 jmc Exp $
d27 1
a27 1
.Dd $Mdocdate: September 16 2010 $
a42 1
.Xo
d45 1
a45 1
.Oc Xc
a50 1
.Xo
d53 1
a53 2
.Op Ar address ... Oc
.Xc
@


1.147
log
@- note that -Fr puts the filer in a "pass all" state
- note that -f replaces the current ruleset

based on a diff from Anders Langworthy, but altered by mcbride and henning;
ok henning
@
text
@d1 1
a1 1
.\" $OpenBSD: pfctl.8,v 1.146 2010/09/12 16:36:20 jmc Exp $
d27 1
a27 1
.Dd $Mdocdate: September 12 2010 $
a210 3
Note that this puts the packet filter in a
.Cm pass all
state.
@


1.146
log
@spacing fix;
@
text
@d1 1
a1 1
.\" $OpenBSD: pfctl.8,v 1.145 2010/06/25 23:27:47 henning Exp $
d27 1
a27 1
.Dd $Mdocdate: June 25 2010 $
d211 3
d228 2
a229 1
Load the rules contained in
@


1.145
log
@remove -m (merge).
it is violating the transactional model we have and made stronger in
pf, it is broken in some cases and since some options are passed to the
kernel while some are userland only and affect how the rules are
parsed it is complete bullshit anyway - obviously, changing options
that affect ruleset parsing without reloading and thus reparsing the
ruleset cannot work. so stop pretending it could and cut the crap.
ok dlg krw deraadt
@
text
@d1 1
a1 1
.\" $OpenBSD: pfctl.8,v 1.144 2010/03/23 17:34:30 jmc Exp $
d27 1
a27 1
.Dd $Mdocdate: March 23 2010 $
d38 1
a38 2
.Oo Fl D Ar macro Ns =
.Ar value Oc
@


1.144
log
@oops - i obviously missed -r1.142;
@
text
@d1 1
a1 1
.\" $OpenBSD: pfctl.8,v 1.143 2010/03/23 13:31:29 henning Exp $
d36 1
a36 1
.Op Fl deghmnqrvz
a318 7
.It Fl m
Merge in explicitly given options without resetting those
which are omitted.
Allows single options to be modified without disturbing the others:
.Bd -literal -offset indent
# echo "set loginterface fxp0" | pfctl -mf -
.Ed
@


1.143
log
@remove -A, -O, -R and -T load
the partial loading of a ruleset (leaving ancors aside) is wrong and
conflicts with the general idea of how pf works. last not least it breaks
with the optimizer generating tables automagically.
ok deraadt sthen krw manpage jmc
@
text
@d1 1
a1 1
.\" $OpenBSD: pfctl.8,v 1.142 2010/01/18 23:52:46 mcbride Exp $
d27 1
a27 1
.Dd $Mdocdate: January 18 2010 $
d626 17
a642 14
which limits the severity of log messages printed by pf. This should be is a
keyword from the following ordered list (highest to lowest):
.Ar emerg ,
.Ar alert ,
.Ar crit ,
.Ar err ,
.Ar warning ,
.Ar notice ,
.Ar info ,
and 
.Ar debug .
These keywords correspond to the similar (LOG_) values specified
to the syslog library routine, and may be abbreviated on the command
line.
@


1.142
log
@Convert pf debug logging to using log()/addlog(), a single standardised
definition of DPFPRINTF(), and log priorities from syslog.h. Old debug
levels will still work for now, but will eventually be phased out.

discussed with henning, ok dlg
@
text
@d1 1
a1 1
.\" $OpenBSD: pfctl.8,v 1.141 2009/09/28 22:13:20 dlg Exp $
d27 1
a27 1
.Dd $Mdocdate: September 28 2009 $
d36 1
a36 1
.Op Fl AdeghmnOqRrvz
a113 3
.It Fl A
Load only the queue rules present in the rule file.
Other rules and options are ignored.
a327 3
.It Fl O
Load only the options present in the rule file.
Other rules and options are ignored.
a348 3
.It Fl R
Load only the filter rules present in the rule file.
Other rules and options are ignored.
a460 9
.It Fl T Cm load
Load only the table definitions from
.Xr pf.conf 5 .
This is used in conjunction with the
.Fl f
flag, as in:
.Bd -literal -offset indent
# pfctl -Tl -f pf.conf
.Ed
@


1.141
log
@add -S and -L options to store and load the pf state table from a file.

inspired by the short reboot times on an rb600a provided by stephan
rickauer.
testing and bugfixing by sthen@@
ok mcbride@@ sthen@@
@
text
@d1 1
a1 1
.\" $OpenBSD: pfctl.8,v 1.140 2009/09/03 08:19:04 phessler Exp $
d27 1
a27 1
.Dd $Mdocdate: September 3 2009 $
d643 15
a657 13
.Ar level
(may be abbreviated) to one of the following:
.Pp
.Bl -tag -width xxxxxxxxxxxx -compact
.It Fl x Cm none
Don't generate debug messages.
.It Fl x Cm urgent
Generate debug messages only for serious errors.
.It Fl x Cm misc
Generate debug messages for various errors.
.It Fl x Cm loud
Generate debug messages for common conditions.
.El
@


1.140
log
@remove NAT specific command line options

noticed by Wiktor Izdebski
OK henning@@
@
text
@d1 1
a1 1
.\" $OpenBSD: pfctl.8,v 1.139 2008/06/11 07:23:36 jmc Exp $
d27 1
a27 1
.Dd $Mdocdate: June 11 2008 $
d48 1
d51 1
d319 3
d360 3
@


1.139
log
@remove an ugly article;
@
text
@d1 1
a1 1
.\" $OpenBSD: pfctl.8,v 1.138 2008/06/10 20:55:02 mcbride Exp $
d27 1
a27 1
.Dd $Mdocdate: June 10 2008 $
d36 1
a36 1
.Op Fl AdeghmNnOqRrvz
a208 2
.It Fl F Cm nat
Flush the NAT rules.
a323 3
.It Fl N
Load only the NAT rules present in the rule file.
Other rules and options are ignored.
a360 2
.It Fl s Cm nat
Show the currently loaded NAT rules.
@


1.138
log
@Make counters on table addresses optional and disabled by default.
Use the 'counters' table option in pf.conf if you actually need them.
If enabled, memory is not allocated until packets match an address.

This saves about 40% memory if counters are not being used, and paves the way
for some more significant cleanups coming soon.

ok henning mpf deraadt
@
text
@d1 1
a1 1
.\" $OpenBSD: pfctl.8,v 1.137 2008/05/16 06:41:43 jmc Exp $
d27 1
a27 1
.Dd $Mdocdate: May 16 2008 $
d630 1
a630 1
This flag is set when the per-address counters are enabled on the table.
@


1.137
log
@no need to quote the argument to .Nd, now that it's nice and short;
@
text
@d1 1
a1 1
.\" $OpenBSD: pfctl.8,v 1.136 2008/05/16 01:22:00 mpf Exp $
d524 1
a524 1
Each table maintains a set of counters that can be retrieved using the
d535 1
a535 1
# printf "table <test> { ftp.openbsd.org }\en \e
d569 1
a569 1
--a-r-  test
d629 2
@


1.136
log
@There is not really a network address translation device.
Remove it from the name section.
OK mcbride, henning
@
text
@d1 1
a1 1
.\" $OpenBSD: pfctl.8,v 1.135 2008/05/09 13:59:31 mpf Exp $
d27 1
a27 1
.Dd $Mdocdate: May 9 2008 $
d32 1
a32 1
.Nd "control the packet filter (PF) device"
@


1.135
log
@Add support to kill states by rule label or state id.
Fix printing of the state id in pfctl -ss -vv.
Remove the psnk_af hack to return the number of killed states.
OK markus, beck. "I like it" henning, deraadt.
Manpage help from jmc.
@
text
@d1 1
a1 1
.\" $OpenBSD: pfctl.8,v 1.134 2008/05/06 03:50:03 mpf Exp $
d27 1
a27 1
.Dd $Mdocdate: May 6 2008 $
d32 1
a32 1
.Nd "control the packet filter (PF) and network address translation (NAT) device"
@


1.134
log
@Document new state creation counter for pfctl -s labels
@
text
@d1 1
a1 1
.\" $OpenBSD: pfctl.8,v 1.133 2007/07/01 11:38:51 henning Exp $
d27 1
a27 1
.Dd $Mdocdate: July 1 2007 $
d44 4
a47 1
.Op Fl k Ar host | network
d255 8
a262 3
.It Fl k Ar host | network
Kill all of the state entries originating from the specified
.Ar host
d264 7
a270 1
.Ar network .
a276 5
For example, to kill all of the state entries originating from
.Dq host :
.Pp
.Dl # pfctl -k host
.Pp
d293 26
@


1.133
log
@states here too not state
@
text
@d1 1
a1 1
.\" $OpenBSD: pfctl.8,v 1.132 2007/05/31 19:19:46 jmc Exp $
d27 1
a27 1
.Dd $Mdocdate: May 31 2007 $
d378 1
a378 1
packets in, bytes in, packets out, bytes out) of
@


1.132
log
@convert to new .Dd format;
@
text
@d1 1
a1 1
.\" $OpenBSD: pfctl.8,v 1.131 2007/04/21 14:49:45 henning Exp $
d27 1
a27 1
.Dd $Mdocdate$
d212 1
a212 1
.It Fl F Cm state
d367 1
a367 1
.It Fl s Cm state
@


1.131
log
@fix -o handling. syntax is now -o none|basic|profile. -o without argument
is invalid now, it doesn't serve any purpose any more anyway since that is
the default. ok mcbride
@
text
@d1 1
a1 1
.\" $OpenBSD: pfctl.8,v 1.130 2007/04/20 07:30:16 jmc Exp $
d27 1
a27 1
.Dd November 20, 2002
@


1.130
log
@no whitespace allowed between -o and its argument, so update doc/usage()
to reflect this;

whilst there i had to wrap -t in Xo/Xc to stop line split,
and i zapped some extra whitespace in usage();

fixes user/5441 from sthen
@
text
@d1 1
a1 1
.\" $OpenBSD: pfctl.8,v 1.129 2007/03/21 03:01:31 mcbride Exp $
d45 1
a45 1
.Op Fl o Ns Op Ar level
d299 1
a299 1
.It Fl o Ns Op Ar level
d303 1
a303 1
.It Fl o Ns Cm none
d305 1
a305 1
.It Fl o Ns Cm basic
d308 1
a308 1
.It Fl o Ns Cm profile
a310 8
.Pp
To retain compatibility with previous behaviour, a single
.Fl o
without any options will enable
.Cm basic
optimizations, and a second
.Fl o
will enable profiling.
@


1.129
log
@Enable basic ruleset optimization by default.

ok deraadt henning
@
text
@d1 1
a1 1
.\" $OpenBSD: pfctl.8,v 1.128 2007/01/30 21:01:56 jmc Exp $
d45 1
a45 1
.Op Fl o Op Ar level
d48 2
a49 2
.Oo
.Fl t Ar table
d51 2
a52 2
.Op Ar address ...
.Oc
d299 1
a299 1
.It Fl o Op Ar level
d303 1
a303 1
.It Fl o Cm none
d305 1
a305 1
.It Fl o Cm basic
d308 1
a308 1
.It Fl o Cm profile
@


1.128
log
@document -sI -v;

from Janne Johansson, tweaked by myself;
ok dhartmei
@
text
@d1 1
a1 1
.\" $OpenBSD: pfctl.8,v 1.127 2007/01/18 20:45:55 henning Exp $
d300 1
a300 3
Control the ruleset optimizer.
The ruleset optimizer attempts to improve rulesets by removing rule
duplication and making better use of rule ordering.
d307 1
a311 31
.Cm basic
optimization does does four things:
.Pp
.Bl -enum -compact
.It
remove duplicate rules
.It
remove rules that are a subset of another rule
.It
combine multiple rules into a table when advantageous
.It
re-order the rules to improve evaluation performance
.El
.Pp
If
.Cm profile
is specified, the currently loaded ruleset will be examined as a feedback
profile to tailor the optimization of the
.Ar quick
rules to the actual network behavior.
.Pp
It is important to note that the ruleset optimizer will modify the ruleset
to improve performance.
A side effect of the ruleset modification is that per-rule accounting
statistics will have different meanings than before.
If per-rule accounting is important for billing purposes or whatnot, either
the ruleset optimizer should not be used or a
.Ar label
field should be added to all of the accounting rules to act as optimization
barriers.
.Pp
d319 2
@


1.127
log
@implement -T expire.
"pfctl -t tablename -T expire 3600" would expire all entries in the given
table that are older than 3600 seconds. ok dhartmei, manpage help & ok jmc
@
text
@d1 1
a1 1
.\" $OpenBSD: pfctl.8,v 1.126 2006/11/20 14:31:17 mcbride Exp $
d428 1
a428 1
When used together with a double
d430 3
@


1.126
log
@-K argument to kill source tracking nodes explicitly, behaves like the
-k argument for killing states; From Berk D. Demir <bdd@@mindcast.org>

ok dhartmei henning
@
text
@d1 1
a1 1
.\" $OpenBSD: pfctl.8,v 1.125 2006/11/01 09:03:00 jmc Exp $
d453 7
@


1.125
log
@tweaks;
@
text
@d1 1
a1 1
.\" $OpenBSD: pfctl.8,v 1.124 2006/11/01 00:23:48 mcbride Exp $
d43 1
d241 11
@


1.124
log
@Document recursive printing of anchors via -a '*' or -a 'anchor/*'.
@
text
@d1 1
a1 1
.\" $OpenBSD: pfctl.8,v 1.123 2006/10/31 14:41:25 mcbride Exp $
d36 1
a36 1
.Op Fl AdeghmNnOoqRrvz
d44 1
a44 4
.Oo
.Fl o
.Op level
.Oc
d172 1
a172 1
flag will recursively print all anchors in brace delimited block.
d182 1
a182 1
as the anchor name.
d287 1
a287 1
.It Fl o Ar level
d300 2
a301 1
.Ar basic
d316 2
a317 2
.Ar profile
is specified the currently loaded ruleset will be examined as a feedback
d335 1
a335 1
.Ar basic
@


1.123
log
@Document new behaviour of the -o (ruleset optimization) flag.
@
text
@d1 1
a1 1
.\" $OpenBSD: pfctl.8,v 1.122 2006/10/23 07:05:49 jmc Exp $
d168 21
@


1.122
log
@no need to use "keep state" and "flags S/SA" in pf rules,
now that it is the default;

ok henning mcbride camield (ftp-proxy bits) deraadt
@
text
@d1 1
a1 1
.\" $OpenBSD: pfctl.8,v 1.121 2006/06/09 15:20:03 jmc Exp $
d44 4
d269 2
a270 2
.It Fl o
Enable the ruleset optimizer.
d273 11
a283 1
Specifically, it does four things:
d296 4
a299 4
A second
.Fl o
may be specified to use the currently loaded ruleset as a feedback profile
to tailor the optimization of the
d312 8
@


1.121
log
@Xo/Xc not needed here; from david
@
text
@d1 1
a1 1
.\" $OpenBSD: pfctl.8,v 1.120 2005/06/13 20:18:52 henning Exp $
d476 1
a476 1
    pass out to <test> keep state\en" | pfctl -f-
@


1.120
log
@document extended pfctl -sl format
@
text
@d1 1
a1 1
.\" $OpenBSD: pfctl.8,v 1.119 2005/05/22 21:05:23 mpf Exp $
d38 2
a39 4
.Xo
.Oo Fl D
.Ar macro Ns = Ns Ar value Oc
.Xc
d46 1
a46 1
.Oo Xo
d49 2
a50 2
.Op Ar address ... Oc
.Xc
@


1.119
log
@Add support to kill states that match networks.
man page from jmc@@
OK dhartmei@@
@
text
@d1 1
a1 1
.\" $OpenBSD: pfctl.8,v 1.118 2005/01/05 23:41:45 jmc Exp $
d364 2
a365 1
Show per-rule statistics (label, evaluations, packets, bytes) of
@


1.118
log
@spelling;
@
text
@d1 1
a1 1
.\" $OpenBSD: pfctl.8,v 1.117 2005/01/05 18:30:14 mcbride Exp $
d45 1
a45 1
.Op Fl k Ar host
d141 4
a144 2
.Li authpf/smith(1234) ,
which would have been created for user smith by
d220 1
a220 1
.It Fl k Ar host
d222 3
a224 1
.Ar host .
d227 2
d230 1
a230 4
from the first
.Ar host
to the second
.Ar host .
d232 3
a234 4
.Li host :
.Bd -literal -offset indent
# pfctl -k host
.Ed
d237 1
a237 1
.Li host1
d239 13
a251 4
.Li host2 :
.Bd -literal -offset indent
# pfctl -k host1 -k host2
.Ed
@


1.117
log
@Document -m flag.
@
text
@d1 1
a1 1
.\" $OpenBSD: pfctl.8,v 1.116 2004/12/13 23:59:28 jmc Exp $
d242 1
a242 1
Merge in explicitly given options without reseting those
@


1.116
log
@sync authpf anchor syntax;
also, spelling while i'm in here;

from joel knight;
@
text
@d1 1
a1 1
.\" $OpenBSD: pfctl.8,v 1.115 2004/08/26 16:14:58 jaredy Exp $
d36 1
a36 1
.Op Fl AdeghNnOoqRrvz
d240 7
@


1.115
log
@update w.r.t. recursive anchors

includes:
- simplify -a syntax
- change an anchor example to mention authpf, which is more useful
- document "pfctl -a anchor -vsA" for showing anchors recursively

ok dhartmei jmc henning
@
text
@d1 1
a1 1
.\" $OpenBSD: pfctl.8,v 1.114 2004/07/23 10:20:42 jmc Exp $
d141 1
a141 1
.Li authpf/smith ,
d143 2
a144 1
.Xr authpf 8 :
d146 1
a146 1
# pfctl -a authpf/smith -s rules
d158 1
a158 1
private table if one is defined, and then fallback to the table defined in the
@


1.114
log
@- make SYNOPSIS and usage() clear that -t precedes -T;
spotted by Tamas Tevesh, via dhartmei@@;

also, add -o to usage(), and note that /ruleset is now the correct syntax,
not :ruleset;

ok dhartmei@@
@
text
@d1 1
a1 1
.\" $OpenBSD: pfctl.8,v 1.113 2004/07/16 23:44:24 frantzen Exp $
d37 1
a37 4
.Xo
.Oo Fl a Ar anchor
.Op Ns / Ns Ar ruleset Oc
.Xc
d112 1
a112 4
.It Xo
.Fl a Ar anchor
.Op Ns / Ns Ar ruleset
.Xc
d119 1
a119 3
.Ar anchor
and optional named ruleset
.Ar ruleset .
d122 11
a132 4
can load and manipulate additional rulesets by name.
Named rulesets are attached at
.Ar anchor
points, which are also referenced by name.
d137 7
a143 2
For example, to show all filter rules inside anchor
.Li foo :
d145 1
a145 1
# pfctl -a foo -s rules
d148 1
a148 1
Private tables can also be put inside subrulesets, either by having table
d151 1
a151 1
file that is loaded in the anchor, or by using regular table commands as in:
d159 1
a159 1
This is similar to C rules for variables.
d325 1
a325 1
Show the currently loaded anchors.
d328 7
a334 2
is specified as well, the named rulesets currently loaded in the specified
anchor are shown instead.
d550 1
a550 1
tables of the same name in subrulesets (anchors).
d590 1
@


1.113
log
@'pfctl -o' ruleset optimizer that doesnt change the meaning of the final ruleset
- remove identical and subsetted rules
- when advantageous merge rules w/ similar addresses into a table and one rule
- re-order rules to improve skip step performance (can do better w/ kernel mods)
- 'pfctl -oo' will load the currently running ruleset and use it as a profile
to direct the optimization of quicked rules
ok henning@@ mcbride@@.  man page help from jmc@@
@
text
@d1 1
a1 1
.\" $OpenBSD: pfctl.8,v 1.112 2004/06/21 20:47:11 msf Exp $
d51 5
a55 2
.Op Fl T Ar command Op Ar address ...
.Op Fl t Ar table
@


1.112
log
@Update manpage to reflect changes in anchor naming

ok beck@@ claudio@@
@
text
@d1 1
a1 1
.\" $OpenBSD: pfctl.8,v 1.111 2004/05/30 21:48:24 jmc Exp $
d36 1
a36 1
.Op Fl AdeghNnOqRrvz
d241 33
@


1.111
log
@various improvements and fixes from jared yanovich;
@
text
@d1 1
a1 1
.\" $OpenBSD: pfctl.8,v 1.110 2004/03/20 09:31:42 david Exp $
d39 1
a39 1
.Op Ns : Ns Ar ruleset Oc
d114 1
a114 1
.Op Ns : Ns Ar ruleset
d146 1
a146 1
# pfctl -a foo:bar -t mytable -T add 1.2.3.4 5.6.7.8
@


1.110
log
@make pfctl -s osfp work and remove -o option from manpage; ok deraadt@@
pointed out by David Hill <davidh at wmis dot net>
@
text
@d1 1
a1 1
.\" $OpenBSD: pfctl.8,v 1.109 2004/02/27 10:42:00 henning Exp $
d37 8
a44 2
.Op Fl a Ar anchor Ns Op Ar :ruleset
.Op Fl D Ar macro=value
d81 8
a88 3
When the variable pf is set to YES in
.Xr rc.conf 8 ,
the rule file specified with the variable pf_rules
d99 1
a99 1
.Em net.inet6.ip6.forwarding ,
d112 4
a115 1
.It Fl a Ar anchor Ns Op Ar :ruleset
d118 1
a118 1
.Fl F
d156 1
a156 1
.It Fl D Ar macro=value
d175 1
a175 1
.It Fl F Ar nat
d177 1
a177 1
.It Fl F Ar queue
d179 1
a179 1
.It Fl F Ar rules
d181 1
a181 1
.It Fl F Ar state
d183 1
a183 1
.It Fl F Ar Sources
d185 1
a185 1
.It Fl F Ar info
d187 1
a187 1
.It Fl F Ar Tables
d189 1
a189 1
.It Fl F Ar osfp
d191 1
a191 1
.It Fl F Ar all
d259 1
a259 1
.It Fl s Ar nat
d261 1
a261 1
.It Fl s Ar queue
d271 1
a271 1
.It Fl s Ar rules
d277 3
a279 1
Note that the 'skip step' optimization done automatically by the kernel
d284 1
a284 1
.It Fl s Ar Anchors
d290 1
a290 1
.It Fl s Ar state
d292 1
a292 1
.It Fl s Ar Sources
d294 1
a294 1
.It Fl s Ar info
d299 1
a299 1
.It Fl s Ar labels
d302 1
a302 1
.It Fl s Ar timeouts
d304 1
a304 1
.It Fl s Ar memory
d306 1
a306 1
.It Fl s Ar Tables
d308 1
a308 1
.It Fl s Ar osfp
d310 1
a310 1
.It Fl s Ar Interfaces
d317 1
a317 1
.It Fl s Ar all
d328 1
a328 1
.It Fl T Ar kill
d330 1
a330 1
.It Fl T Ar flush
d332 1
a332 1
.It Fl T Ar add
d335 1
a335 1
.It Fl T Ar delete
d337 1
a337 1
.It Fl T Ar replace
d340 1
a340 1
.It Fl T Ar show
d342 1
a342 1
.It Fl T Ar test
d344 1
a344 1
.It Fl T Ar zero
d346 1
a346 1
.It Fl T Ar load
d358 3
a360 3
.Ar add ,
.Ar delete ,
.Ar replace
d362 1
a362 1
.Ar test
d367 3
a369 1
Comments starting with a "#" are allowed in the text file.
d386 5
a390 1
The address matches (test operation only).
d394 3
a396 1
The address/network cannot be added/deleted due to conflicting "!" attribute.
d408 2
a409 2
ftp server.
The following commands configure the firewall and send 10 pings to the ftp
d418 1
a418 1
.Ar show
d422 1
a422 1
.Ar Cleared
d438 2
a439 1
.Ar show Tables
d460 1
a460 1
table; but all packets passing as the result of the state are correctly
d464 1
a464 1
.Ar XPass
d466 6
a471 4
.Ar Pass
counters when a "stateful" packet is passed but doesn't match the table
anymore.
This will happen in our example if someone flushes the table while the ping
d485 1
a485 1
For persistent tables, which don't get automatically flushed when no rules
d489 1
a489 1
.Ar active
d497 1
a497 1
.Ar inactive
d505 1
a505 1
tables of the same name in sub-rulesets (anchors).
d514 1
a514 1
See previous section for its effect on table commands.
d521 1
a521 1
.It Fl x Ar none
d523 1
a523 1
.It Fl x Ar urgent
d525 1
a525 1
.It Fl x Ar misc
d527 1
a527 1
.It Fl x Ar loud
d537 2
@


1.109
log
@make pfctl -s all a bit more useful again by not printing a lllooooooottttt of
OS fingerprints and a list of interface drivers...
cedric deraadt ok
@
text
@d1 1
a1 1
.\" $OpenBSD: pfctl.8,v 1.108 2004/02/17 08:48:29 cedric Exp $
a293 5
Can be used in combination with
.Fl o Ar file
to list the fingerprints in a
.Xr pf.os 5
file.
@


1.108
log
@add -i flag, use it for -sI as a start. ok henning@@, ok+test mcbride@@
@
text
@d1 1
a1 1
.\" $OpenBSD: pfctl.8,v 1.107 2004/02/12 11:03:45 jmc Exp $
d307 2
a308 1
Show all of the above.
@


1.107
log
@- sort SYNOPSIS and options list
- add -p to SYNOPSIS
- uppercase start of sentence
- sync usage() w/ SYNOPSIS
@
text
@d1 1
a1 1
.\" $OpenBSD: pfctl.8,v 1.106 2004/02/12 02:05:32 beck Exp $
d41 1
d193 3
d304 2
@


1.106
log
@add -p flag to specify the device - ok mcbride@@, henning@@ with no objections
from deraadt@@
@
text
@d1 1
a1 1
.\" $OpenBSD: pfctl.8,v 1.105 2003/12/31 11:18:24 cedric Exp $
d36 1
a36 1
.Op Fl AdeghnNqrROvz
d39 1
a40 1
.Op Fl F Ar modifier
d42 1
d44 1
a45 1
.Op Fl T Ar command Op Ar address ...
d97 3
a140 5
.It Fl A
Load only the queue rules present in the rule file.
Other rules and options are ignored.
.It Fl d
Disable the packet filter.
d150 2
a153 9
.It Fl f Ar file
Load the rules contained in
.Ar file .
This
.Ar file
may contain macros, tables, options, and normalization, queueing,
translation, and filtering rules.
With the exception of macros and tables, the statements must appear in that
order.
d179 9
d190 2
a214 4
.It Fl h
Help.
.It Fl n
Do not actually load rules, just parse them.
d218 2
a219 7
.It Fl q
Only print errors and warnings.
.It Fl r
Perform reverse DNS lookups on states when displaying them.
.It Fl R
Load only the filter rules present in the rule file.
Other rules and options are ignored.
d224 1
a224 1
use the device file 
d228 7
a302 2
.It Fl t Ar table
Specify the name of the table.
d478 2
@


1.105
log
@Many improvements to the handling of interfaces in PF.

1) PF should do the right thing when unplugging/replugging or cloning/
destroying NICs.

2) Rules can be loaded in the kernel for not-yet-existing devices
(USB, PCMCIA, Cardbus). For example, it is valid to write:
"pass in on kue0" before kue USB is plugged in.

3) It is possible to write rules that apply to group of interfaces
(drivers), like "pass in on ppp all"

4) There is a new ":peer" modifier that completes the ":broadcast"
and ":network" modifiers.

5) There is a new ":0" modifier that will filter out interface aliases.
Can also be applied to DNS names to restore original PF behaviour.

6) The dynamic interface syntax (foo) has been vastly improved, and
now support multiple addresses, v4 and v6 addresses, and all userland
modifiers, like "pass in from (fxp0:network)"

7) Scrub rules now support the !if syntax.

8) States can be bound to the specific interface that created them or
to  a group of interfaces for example:

- pass all keep state (if-bound)
- pass all keep state (group-bound)
- pass all keep state (floating)

9) The default value when only keep state is given can be selected by
using the "set state-policy" statement.

10) "pfctl -ss" will now print the interface scope of the state.

This diff change the pf_state structure slighltly, so you should
recompile your userland tools (pfctl, authpf, pflogd, tcpdump...)

Tested on i386, sparc, sparc64 by Ryan
Tested on macppc, sparc64 by Daniel

ok deraadt@@ mcbride@@
@
text
@d1 1
a1 1
.\" $OpenBSD: pfctl.8,v 1.104 2003/12/16 16:43:32 jmc Exp $
d229 5
@


1.104
log
@quotes, spaces and bars do not need to be escaped within displays;
.Nm does not need an argument;
dashes should be escaped;
@
text
@d1 1
a1 1
.\" $OpenBSD: pfctl.8,v 1.103 2003/12/15 00:02:03 mcbride Exp $
d234 1
a234 1
.Bl -tag -width xxxxxxxxxxxx -compact
d289 5
@


1.103
log
@Add support to track stateful connections by source ip. This allows us
to:
- Ensure that clients get a consistent IP mapping with load-balanced
  translation/routing rules
- Limit the number of simultaneous connections a client can make
- Limit the number of clients which can connect through a rule

ok dhartmei@@ deraadt@@
@
text
@d1 1
a1 1
.\" $OpenBSD: pfctl.8,v 1.102 2003/09/18 09:18:51 jmc Exp $
d344 1
a344 1
.Nm pfctl
d369 1
a369 1
.Nm pfctl .
d377 2
a378 2
# printf \&"table <test> { ftp.openbsd.org }\en \e
\  \  pass out to <test> keep state\en" \&| pfctl -f-
d391 6
a396 6
\ \ \ 129.128.5.191
\ \ \ \ Cleared: \ \ \ \ Thu Feb 13 18:55:18 2003
\ \ \ \ In/Block: \ \ \ [ Packets: 0 \ \ \ \ \ \ \ Bytes: 0 \ \ \ \ \ \ \ ]
\ \ \ \ In/Pass: \ \ \ \ [ Packets: 10 \ \ \ \ \ \ Bytes: 840 \ \ \ \ \ ]
\ \ \ \ Out/Block: \ \ [ Packets: 0 \ \ \ \ \ \ \ Bytes: 0 \ \ \ \ \ \ \ ]
\ \ \ \ Out/Pass: \ \ \ [ Packets: 10 \ \ \ \ \ \ Bytes: 840 \ \ \ \ \ ]
d411 10
a420 10
\ \ \ \ Addresses: \ \ 1
\ \ \ \ Cleared: \ \ \ \ Thu Feb 13 18:55:18 2003
\ \ \ \ References: \ [ Anchors: 0 \ \ \ \ \ \ \ Rules: 1 \ \ \ \ \ \ \ ]
\ \ \ \ Evaluations: [ NoMatch: 3496 \ \ \ \ Match: 1 \ \ \ \ \ \ \ ]
\ \ \ \ In/Block: \ \ \ [ Packets: 0 \ \ \ \ \ \ \ Bytes: 0 \ \ \ \ \ \ \ ]
\ \ \ \ In/Pass: \ \ \ \ [ Packets: 10 \ \ \ \ \ \ Bytes: 840 \ \ \ \ \ ]
\ \ \ \ In/XPass: \ \ \ [ Packets: 0 \ \ \ \ \ \ \ Bytes: 0 \ \ \ \ \ \ \ ]
\ \ \ \ Out/Block: \ \ [ Packets: 0 \ \ \ \ \ \ \ Bytes: 0 \ \ \ \ \ \ \ ]
\ \ \ \ Out/Pass: \ \ \ [ Packets: 10 \ \ \ \ \ \ Bytes: 840 \ \ \ \ \ ]
\ \ \ \ Out/XPass: \ \ [ Packets: 0 \ \ \ \ \ \ \ Bytes: 0 \ \ \ \ \ \ \ ]
d423 1
a423 1
As we can see here, only one packet - the initial ping request - matched the
d431 1
a431 1
counters when a \&"stateful\&" packet is passed but doesn't match the table
d438 1
a438 1
.Nm pfctl
@


1.102
log
@add some space before lists;
@
text
@d1 1
a1 1
.\" $OpenBSD: pfctl.8,v 1.101 2003/08/29 21:47:36 cedric Exp $
d176 2
d266 2
d270 3
@


1.101
log
@Document interactions between tables and anchors.
Add a warning on global/anchor name clashes to help prevent mistakes from our
users during the 3.3 -> 3.4 switch.
ok henning@@
@
text
@d1 1
a1 1
.\" $OpenBSD: pfctl.8,v 1.100 2003/08/28 09:41:22 jmc Exp $
d166 1
d231 1
d292 1
d472 1
@


1.100
log
@tweak;
ok frantzen@@
@
text
@d1 1
a1 1
.\" $OpenBSD: pfctl.8,v 1.99 2003/08/22 21:50:34 david Exp $
d121 16
@


1.99
log
@pf spelling police
ok dhartmei@@ jmc@@
@
text
@d1 1
a1 1
.\" $OpenBSD: pfctl.8,v 1.98 2003/08/21 19:12:08 frantzen Exp $
d474 1
a474 1
.Xr pf.os 5
@


1.98
log
@Add Michal Zalewski's p0f v2 style passive OS fingerprinting to PF.
Exposes the source IP's operating system to the filter language.
Interesting policy decisions are now enforceable:
.	block proto tcp from any os SCO
.	block proto tcp from any os Windows to any port smtp
.	rdr ... from any os "Windows 98" to port WWW -> 127.0.0.1 port 8001
@
text
@d1 1
a1 1
.\" $OpenBSD: pfctl.8,v 1.97 2003/05/24 17:50:16 jmc Exp $
d421 1
a421 1
For persistant tables, which don't get automatically flushed when no rules
d461 1
a461 1
Generate debug messages for common conditons.
@


1.97
log
@tweak;
ok cedric@@
@
text
@d1 1
a1 1
.\" $OpenBSD: pfctl.8,v 1.96 2003/05/24 14:43:20 cedric Exp $
d163 2
d257 7
d447 1
a447 1
will produce even more verbose output.
d460 2
d474 1
@


1.96
log
@sync
@
text
@d1 1
a1 1
.\" $OpenBSD: pfctl.8,v 1.95 2003/05/05 15:43:39 dhartmei Exp $
d139 1
a139 1
.Ar file.
d336 3
a338 1
track of packets going to or coming from the OpenBSD ftp server.
d431 2
a432 2
This flag is set when a table in the main ruleset is hidden by one of more tables
of the same name in sub-rulesets (anchors).
@


1.95
log
@Describe format of pfctl -sl output, reported by Alejandro G. Belluscio.
@
text
@d1 1
a1 1
.\" $OpenBSD: pfctl.8,v 1.94 2003/05/03 18:57:40 jmc Exp $
d373 1
a373 1
--a-r   test
a374 1
\ \ \ \ References: \ 1
d376 2
a377 1
\ \ \ \ Evaluations: [\ NoMatch: 3496 \ \ \ \ Match: 1 \ \ \ \ \ \ \ ]
d428 3
@


1.94
log
@these files all had >9 arguments to .Nd, causing the name description to be
truncated. i wrapped them in double quotes to preserve the line.

grep inspired by an -mdoc lesson from millert@@
@
text
@d1 1
a1 1
.\" $OpenBSD: pfctl.8,v 1.93 2003/04/03 10:21:40 cedric Exp $
d247 2
a248 2
Show per-rule statistics (in terse format) of filter rules with labels,
useful for accounting.
@


1.93
log
@Table stats are reliable now.
@
text
@d1 1
a1 1
.\" $OpenBSD: pfctl.8,v 1.92 2003/03/11 09:59:37 david Exp $
d32 1
a32 1
.Nd control the packet filter (PF) and network address translation (NAT) device
@


1.92
log
@sprinkle some .Li
ok deraadt@@
@
text
@d1 1
a1 1
.\" $OpenBSD: pfctl.8,v 1.91 2003/03/11 09:23:30 david Exp $
d389 1
a389 2
Reloading the table(s) will not affect packet accounting in any way; however,
the state accounting will stop if the rules are reloaded or flushed.
@


1.91
log
@fix spacing in sample output
ok cedric@@
@
text
@d1 1
a1 1
.\" $OpenBSD: pfctl.8,v 1.90 2003/03/10 12:34:20 henning Exp $
d117 1
a117 1
.Cm foo :
d179 1
a179 1
.Cm host :
d185 1
a185 1
.Cm host1
d187 1
a187 1
.Cm host2 :
@


1.90
log
@whitespace
@
text
@d1 1
a1 1
.\" $OpenBSD: pfctl.8,v 1.89 2003/03/10 07:22:04 deraadt Exp $
d373 1
a373 1
--a -r test
@


1.89
log
@based on ideas from david, fix the Cm problems, and others
@
text
@d1 1
a1 1
.\" $OpenBSD: pfctl.8,v 1.88 2003/03/07 15:16:33 cedric Exp $
d167 1
a167 1
Include output helpful for debugging. 
@


1.88
log
@Only show non-active tables when the -g flag is given.
ok dhartmei@@ henning@@
@
text
@d1 1
a1 1
.\" $OpenBSD: pfctl.8,v 1.87 2003/03/07 13:27:12 henning Exp $
d116 2
d119 1
a119 5
Example:
Show all filter rules inside anchor foo
.Xo Ic # pfctl -a\ 
.Ic foo -s rules
.Xc
d150 1
a150 1
.Bl -tag -width "F tables " -compact
d178 2
d181 9
a189 10
Example:
Kill all of the state entries originating from host
.Xo Ic # pfctl -k\ 
.Ic host
.Xc
.Pp
Kill all of the state entries from host1 to host2
.Xo Ic # pfctl -k host1\ 
.Ic -k host2
.Xc
d212 1
a212 1
.Bl -tag -width "s timeouts " -compact
d265 1
a265 1
.Bl -tag -width "T Replace " -compact
d287 1
a287 1
Used in conjunction with the
d289 4
a292 1
flag, like in: "pfctl -Tl -f pf.conf".
a338 1
.Pp
d340 3
a342 10
.Xo Ic # printf \&"table\ 
.Ic <test> { ftp.openbsd.org }\en \e
.Xc
.Xo Ic \  \  pass out\ 
.Ic to <test> keep state\en"\ 
.Ic \&| pfctl -f-
.Xc
.Xo Ic # ping -qc10\ 
.Ic ftp.openbsd.org
.Xc
a351 1
.Pp
d353 7
a359 21
.Xo Ic # pfctl -t\ 
.Ic  test -vTshow
.Xc
.Xo Ic \ \ \ 
.Ic 129.128.5.191
.Xc
.Xo Ic \ \ \ \ Cleared: \ \ \ \ Thu\ 
.Ic  Feb 13 18:55:18 2003
.Xc
.Xo Ic \ \ \ \ In/Block\ 
.Ic : \ \ \ [ Packets: 0 \ \ \ \ \ \ \ Bytes: 0 \ \ \ \ \ \ \ ]
.Xc
.Xo Ic \ \ \ \ In/Pass\ 
.Ic : \ \ \ \ [ Packets: 10 \ \ \ \ \ \ Bytes: 840 \ \ \ \ \ ]
.Xc
.Xo Ic \ \ \ \ Out/Block\ 
.Ic : \ \ [ Packets: 0 \ \ \ \ \ \ \ Bytes: 0 \ \ \ \ \ \ \ ]
.Xc
.Xo Ic \ \ \ \ Out/Pass\ 
.Ic : \ \ \ [ Packets: 10 \ \ \ \ \ \ Bytes: 840 \ \ \ \ \ ]
.Xc
a370 1
.Pp
d372 12
a383 36
.Xo Ic # pfctl\ 
.Ic -vvsTables
.Xc
.Xo Ic --a\ 
.Ic -r   test
.Xc
.Xo Ic \ \ \ \ Addresses\ 
.Ic : \ \ 1
.Xc
.Xo Ic \ \ \ \ References\ 
.Ic : \ 1
.Xc
.Xo Ic \ \ \ \ Cleared\ 
.Ic : \ \ \ \ Thu Feb 13 18:55:18 2003
.Xc
.Xo Ic \ \ \ \ Evaluations\ 
.Ic : [\ NoMatch: 3496 \ \ \ \ Match: 1 \ \ \ \ \ \ \ ]
.Xc
.Xo Ic \ \ \ \ In\ 
.Ic /Block: \ \ \ [ Packets: 0 \ \ \ \ \ \ \ Bytes: 0 \ \ \ \ \ \ \ ]
.Xc
.Xo Ic \ \ \ \ In\ 
.Ic /Pass: \ \ \ \ [ Packets: 10 \ \ \ \ \ \ Bytes: 840 \ \ \ \ \ ]
.Xc
.Xo Ic \ \ \ \ In\ 
.Ic /XPass: \ \ \ [ Packets: 0 \ \ \ \ \ \ \ Bytes: 0 \ \ \ \ \ \ \ ]
.Xc
.Xo Ic \ \ \ \ Out\ 
.Ic /Block: \ \ [ Packets: 0 \ \ \ \ \ \ \ Bytes: 0 \ \ \ \ \ \ \ ]
.Xc
.Xo Ic \ \ \ \ Out\ 
.Ic /Pass: \ \ \ [ Packets: 10 \ \ \ \ \ \ Bytes: 840 \ \ \ \ \ ]
.Xc
.Xo Ic \ \ \ \ Out\ 
.Ic /XPass: \ \ [ Packets: 0 \ \ \ \ \ \ \ Bytes: 0 \ \ \ \ \ \ \ ]
.Xc
d440 1
a440 1
.Bl -tag -width "x urgent " -compact
@


1.87
log
@document -g

ok jmc@@
@
text
@d1 1
a1 1
.\" $OpenBSD: pfctl.8,v 1.86 2003/03/06 03:49:50 david Exp $
d464 2
a465 2
not listed if no
.Fl v
@


1.86
log
@tweak wording and mdoc formatting
ok jmc@@ henning@@
@
text
@d1 1
a1 1
.\" $OpenBSD: pfctl.8,v 1.85 2003/03/04 22:18:43 deraadt Exp $
d36 1
a36 1
.Op Fl AdehnNqrROvz
d168 2
@


1.85
log
@wrap Ic in Xo/Xc until fixed
@
text
@d1 1
a1 1
.\" $OpenBSD: pfctl.8,v 1.84 2003/02/24 10:26:01 cedric Exp $
d27 1
a27 1
.Dd Nov 20, 2002
d37 1
a37 1
.Op Fl a Ar anchor[:ruleset]
d44 1
a44 1
.Op Fl T Ar command [address ...]
d103 1
a103 1
.Pa anchor
d110 1
a110 1
.Pa anchor
d113 1
a113 1
.Pa anchor
d129 8
a136 2
Define macros on the command line.
Overrides macro definition in the ruleset.
d140 5
a144 2
Load rule file.
This file may contain macros, tables, options, and normalization, queueing,
d149 3
a151 2
Flush one of the following.
Modifier name may be abbreviated:
d169 2
a170 1
Kill all of the state entries originating from the specified host.
d174 4
a177 1
from the first host to the second host.
d208 3
a210 2
Show filter parameters.
Modifier names may be abbreviated:
d226 3
a228 1
When used together with -v, the per-rule statistics (number of evaluations,
d259 4
a262 2
.It Fl T Ar command [address ...]
Specify the command to apply to the table.
d481 3
a483 2
Set the debug level to one of the following.
Level names may be abbreviated:
@


1.84
log
@echo->printf, because echo does not accept "\n" in all shells.
ok henning@@
@
text
@d1 1
a1 1
.\" $OpenBSD: pfctl.8,v 1.83 2003/02/20 22:09:27 deraadt Exp $
d119 3
a121 1
.Ic # pfctl -a foo -s rules
d167 3
a169 1
.Ic # pfctl -k host
d172 3
a174 1
.Ic # pfctl -k host1 -k host2
d318 5
a322 2
.Ic # printf \&"table <test> { ftp.openbsd.org }\en \e
.Ic \  \  pass out to <test> keep state\en" Xo
d325 3
a327 1
.Ic # ping -qc10 ftp.openbsd.org
d339 21
a359 7
.Ic # pfctl -t test -vTshow
.Ic \ \ 129.128.5.191
.Ic \ \ \ \ Cleared: \ \ \ \ Thu Feb 13 18:55:18 2003
.Ic \ \ \ \ In/Block: \ \ \ [ Packets: 0 \ \ \ \ \ \ \ Bytes: 0 \ \ \ \ \ \ \ ]
.Ic \ \ \ \ In/Pass: \ \ \ \ [ Packets: 10 \ \ \ \ \ \ Bytes: 840 \ \ \ \ \ ]
.Ic \ \ \ \ Out/Block: \ \ [ Packets: 0 \ \ \ \ \ \ \ Bytes: 0 \ \ \ \ \ \ \ ]
.Ic \ \ \ \ Out/Pass: \ \ \ [ Packets: 10 \ \ \ \ \ \ Bytes: 840 \ \ \ \ \ ]
d373 36
a408 12
.Ic # pfctl -vvsTables
.Ic --a-r   test
.Ic \ \ \ \ Addresses: \ \ 1
.Ic \ \ \ \ References: \ 1
.Ic \ \ \ \ Cleared: \ \ \ \ Thu Feb 13 18:55:18 2003
.Ic \ \ \ \ Evaluations: [\ NoMatch: 3496 \ \ \ \ Match: 1 \ \ \ \ \ \ \ ]
.Ic \ \ \ \ In/Block: \ \ \ [ Packets: 0 \ \ \ \ \ \ \ Bytes: 0 \ \ \ \ \ \ \ ]
.Ic \ \ \ \ In/Pass: \ \ \ \ [ Packets: 10 \ \ \ \ \ \ Bytes: 840 \ \ \ \ \ ]
.Ic \ \ \ \ In/XPass: \ \ \ [ Packets: 0 \ \ \ \ \ \ \ Bytes: 0 \ \ \ \ \ \ \ ]
.Ic \ \ \ \ Out/Block: \ \ [ Packets: 0 \ \ \ \ \ \ \ Bytes: 0 \ \ \ \ \ \ \ ]
.Ic \ \ \ \ Out/Pass: \ \ \ [ Packets: 10 \ \ \ \ \ \ Bytes: 840 \ \ \ \ \ ]
.Ic \ \ \ \ Out/XPass: \ \ [ Packets: 0 \ \ \ \ \ \ \ Bytes: 0 \ \ \ \ \ \ \ ]
@


1.83
log
@extra plurals; openbsd@@davidkrause.com
@
text
@d1 1
a1 1
.\" $OpenBSD: pfctl.8,v 1.82 2003/02/20 11:08:06 cedric Exp $
d312 2
a313 2
.Ic # echo \&"table <test> { ftp.openbsd.org }\en\& "\e
.Ic \  \  pass out to <test> keep state" Xo
@


1.82
log
@Fix table syntax documentation, from David Krause.
@
text
@d1 1
a1 1
.\" $OpenBSD: pfctl.8,v 1.81 2003/02/19 21:50:16 henning Exp $
d44 1
a44 1
.Op Fl T Ar command [addresses ...]
d236 1
a236 1
.It Fl T Ar command [addresses ...]
@


1.81
log
@cmdline options in alphabetical order in usage() and manpage; and sync them

from krause
@
text
@d1 1
a1 1
.\" $OpenBSD: pfctl.8,v 1.80 2003/02/19 12:48:11 henning Exp $
d43 2
a44 1
.Op Fl t Ar table [-T command [addresses]*]
d236 1
a236 1
.It Fl T Ar command
@


1.80
log
@clarify how pfctl -k works a bit; based on a discussion with daniel and sam
smith.
ok dhartmei@@
@
text
@d1 1
a1 1
.\" $OpenBSD: pfctl.8,v 1.79 2003/02/14 17:17:27 henning Exp $
d36 1
a36 1
.Op Fl AdehnNqrRvzO
d39 1
a40 1
.Op Fl f Ar file
d43 1
a44 2
.Op Fl t Ar table
.Op Fl T Ar command
@


1.79
log
@remove explicit table creation ( -T create ), it's useless.

ok pb@@ mcbride@@ deraadt@@
@
text
@d1 1
a1 1
.\" $OpenBSD: pfctl.8,v 1.78 2003/02/14 14:11:44 cedric Exp $
d157 1
a157 1
Kill all of the state entries from the specified host.
d164 1
a164 1
Kill all of the state entries from host
@


1.78
log
@English and mdoc fixes thanks to jmc@@
@
text
@d1 1
a1 1
.\" $OpenBSD: pfctl.8,v 1.77 2003/02/14 12:04:23 henning Exp $
a239 2
.It Fl T Ar create
Create a new table.
@


1.77
log
@tweak
@
text
@d1 1
a1 1
.\" $OpenBSD: pfctl.8,v 1.76 2003/02/14 11:04:22 cedric Exp $
d238 1
a238 1
commands include:
d261 2
a262 1
Load only the table definitions from pf.conf.
d278 1
a278 1
#-starting comments are allowed in the text file.
d295 1
a295 1
The address match (test operation only).
d308 2
a309 2
For example, the following command define a wide open firewall which will keep
track of packets going to or coming from OpenBSD ftp server.
d314 2
a315 2
.Ic # echo \&"table <test> { ftp.openbsd.org }\en\&"\e
.Ic > \&"pass out to <test> keep state\&" Xo
d339 2
a340 2
Similarly, It is possible to view global information about the tables
by using two times the
d342 1
a342 1
modifier and the
d365 1
a365 1
table; but all packets passing at the result of the state are correctly
d387 1
a387 1
.Nm pf.conf .
d390 1
a390 1
refers to them.
d404 1
a404 1
.Nm pf.conf .
@


1.76
log
@Document verbose mode with tables (statistics).
@
text
@d1 1
a1 1
.\" $OpenBSD: pfctl.8,v 1.75 2003/02/14 09:44:31 henning Exp $
d176 1
a176 1
Filter rules and options are ignored.
d343 2
a344 1
command. This will display the number of addresses on each table,
d367 1
a367 2
in this version, the state accounting will unfortunately stop if the rules
are reloaded or flushed.
d374 2
a375 3
This will happen in our example if someone flush the table while the ping
command is
running.
d393 2
a394 1
tableset. Tables without this flag do not really exist, cannot contain addresses, and are
d401 2
a402 1
tableset. This flag can only be witnessed briefly during the loading of
a403 3
If this flag appear for a long time, that mean
.Nm pfctl
failed badly.
d411 1
a411 1
will produce an additional level of more verbose output.
@


1.75
log
@more good tweaks by krause
@
text
@d1 1
a1 1
.\" $OpenBSD: pfctl.8,v 1.74 2003/02/13 10:14:43 henning Exp $
d262 3
a264 1
Used in "pfctl -Tl -f pf.conf".
d299 109
d414 1
@


1.74
log
@when talking about the order requirement, mention all 7 sections we have now.
from krause with minor tweaks by me

grammar ok jmc@@
@
text
@d1 1
a1 1
.\" $OpenBSD: pfctl.8,v 1.73 2003/02/11 20:17:35 henning Exp $
d87 2
a88 1
to 1. Set them permanently in
d175 2
a176 2
Load only the NAT rules present in the rule file. Filter rules and options are
ignored.
d237 2
a238 1
Specify the command to apply to the table. commands include:
d299 2
a300 1
Produce more verbose output.  A second use of
@


1.73
log
@document pfctl -D macro=value
@
text
@d1 1
a1 1
.\" $OpenBSD: pfctl.8,v 1.72 2003/02/08 15:39:06 dhartmei Exp $
d131 5
a135 2
Load rule file. This file may contain scrub, nat, queue and filter
rules, in that order.
@


1.72
log
@Add an example of "pfctl -a anchor -s rules" usage, and make it clear
that -a -s is needed for this, not -sa.
@
text
@d1 1
a1 1
.\" $OpenBSD: pfctl.8,v 1.71 2003/01/28 10:40:21 jmc Exp $
d38 1
d125 3
@


1.71
log
@typos; added white boldface to examples

ok deraadt@@
@
text
@d1 1
a1 1
.\" $OpenBSD: pfctl.8,v 1.70 2003/01/25 01:01:04 henning Exp $
d114 5
d207 2
a208 2
.Fl a
is specified, the named rulesets currently loaded in the specified
@


1.70
log
@tables are just tables; implementation details (radix) don't need to be
mentioned.
accidently already slipped in w/ my last commit; this one is forced.

ok theo
@
text
@d1 1
a1 1
.\" $OpenBSD: pfctl.8,v 1.69 2003/01/25 00:47:41 henning Exp $
d35 1
d45 1
d83 1
a83 1
.Li net.inet.ip.forwarding
d85 1
a85 1
.Li net.inet6.ip6.forwarding ,
d149 1
a149 1
.Bd -literal
d151 5
a155 5
      Kill all of the state entries from host
    # pfctl -k host

      Kill all of the state entries from host1 to host2
    # pfctl -k host1 -k host2
d163 1
a163 1
ignored
d182 5
a186 2
When used together with -v, per-queue statistics are also shown.
When used together with -v -v,
d250 1
d252 2
a253 2
.Ar add
.Ar delete
d262 1
a262 1
With theses commands, the
d264 3
a266 1
flag can also be used once or twice, in which case pfctl will print the
d268 2
a269 1
one of the following letter:
@


1.69
log
@kill whitespace at EOL
@
text
@d1 1
a1 1
.\" $OpenBSD: pfctl.8,v 1.68 2003/01/24 13:22:05 henning Exp $
@


1.68
log
@document pfctl -vvsq
@
text
@d1 1
a1 1
.\" $OpenBSD: pfctl.8,v 1.67 2003/01/22 01:15:32 cedric Exp $
d137 1
a137 1
Flush the radix tables.
d181 1
a181 1
When used together with -v -v, 
d212 1
a212 1
Show the list of radix tables.
d217 1
a217 1
Specify the name of the radix table.
@


1.67
log
@Automatically create tables for the "add" and "replace" table commands.
Requested by deraadt@@, pass all regress tests.
@
text
@d1 1
a1 1
.\" $OpenBSD: pfctl.8,v 1.66 2003/01/19 13:48:06 dhartmei Exp $
d181 4
@


1.66
log
@The -s option to show anchors is 'A' or 'Anchors', not 'a' (which is used
to show 'all' information).
@
text
@d1 1
a1 1
.\" $OpenBSD: pfctl.8,v 1.65 2003/01/10 16:09:19 cedric Exp $
d225 1
d230 1
@


1.65
log
@Fix adding and deleting addresses in a table when there is a conflict with
the "negated" attribute of an address. The previous behaviour was incorrect
in both cases (too strict for the add command and too permissive for the
delete command).
ok dhartmei@@
@
text
@d1 1
a1 1
.\" $OpenBSD: pfctl.8,v 1.64 2003/01/10 10:51:48 cedric Exp $
d190 1
a190 1
.It Fl s Ar anchor
@


1.64
log
@More details about the -T flag. Suggested by Rukh <openbsd@@rukh.net>
@
text
@d1 1
a1 1
.\" $OpenBSD: pfctl.8,v 1.63 2003/01/09 17:41:06 henning Exp $
d266 2
@


1.63
log
@note about queue stats
@
text
@d1 1
a1 1
.\" $OpenBSD: pfctl.8,v 1.62 2003/01/09 10:40:44 cedric Exp $
d238 28
@


1.62
log
@Add support for active/inactive tablesets in the kernel.
Add table definition/initialisation construct in pfctl parser.
Add and fix documentation for pf.4 and pf.conf.5.
Tested on i386 and sparc64 by myself, macppc by Daniel.
ok dhartmei@@
@
text
@d1 1
a1 1
.\" $OpenBSD: pfctl.8,v 1.61 2003/01/03 21:37:44 cedric Exp $
d180 1
@


1.61
log
@Bring in userland code for accessing PF radix tables.
ok dhartmei@@ mcbride@@
@
text
@d1 1
a1 1
.\" $OpenBSD: pfctl.8,v 1.60 2002/12/15 16:52:35 margarida Exp $
d234 3
@


1.60
log
@There is no such thing as pf=YES variable, there is a variable
named pf which you can assign YES.
Mention net.inet6.ip6.forwarding.

inspired by nick@@ and ok'd by henning@@
@
text
@d1 1
a1 1
.\" $OpenBSD: pfctl.8,v 1.59 2002/12/15 15:41:59 margarida Exp $
d42 2
d125 1
a125 1
.Bl -tag -width "F rules " -compact
d136 2
d175 1
a175 1
.Bl -tag -width "s rules " -compact
d206 2
d210 24
@


1.59
log
@rule set(s) -> ruleset(s)

henning@@ ok
@
text
@d1 1
a1 1
.\" $OpenBSD: pfctl.8,v 1.58 2002/12/06 00:47:31 dhartmei Exp $
d68 1
a68 1
When the variable pf=YES is set in
d76 1
a76 1
Forwarding can be enabled using the
d78 5
a82 3
variable
.Li net.inet.ip.forwarding=1 ,
permanently in
@


1.58
log
@Introduce anchors and named rule sets, allowing to load additional rule
sets with pfctl and evaluate them from the main rule set using a new type
of rule (which will support conditional evaluation soon). Makes
maintenance of sub-rulesets simpler for pfctl and daemons.

Idea and ok deraadt@@
@
text
@d1 1
a1 1
.\" $OpenBSD: pfctl.8,v 1.57 2002/12/04 08:07:28 deraadt Exp $
d48 1
a48 1
It allows rule set and parameter configuration and retrieval of status
d96 1
a96 1
and optional named rule set
d98 1
a98 1
In addition to the main rule set,
d100 2
a101 2
can load and manipulate additional rule sets by name.
Named rule sets are attached at
d106 1
a106 1
rules from the main rule set is described in
d187 1
a187 1
is specified, the named rule sets currently loaded in the specified
@


1.57
log
@do not warn for unused variables except with -v -v; henning ok
@
text
@d1 1
a1 1
.\" $OpenBSD: pfctl.8,v 1.56 2002/11/24 18:02:06 pb Exp $
d36 1
d88 20
d183 6
@


1.56
log
@missed one about ordering in the ruleset-file
@
text
@d1 1
a1 1
.\" $OpenBSD: pfctl.8,v 1.55 2002/11/24 17:44:44 pb Exp $
d177 3
a179 1
Produce more verbose output.
@


1.55
log
@modifiers for -F/-s in the same order as it is required in pf.conf(5)
@
text
@d1 1
a1 1
.\" $OpenBSD: pfctl.8,v 1.54 2002/11/20 14:08:03 pb Exp $
d95 1
a95 1
Load rule file. This file may contain scrub, nat, and filter
@


1.54
log
@document the relevant queue options

henning@@ ok
@
text
@d1 1
a1 1
.\" $OpenBSD: pfctl.8,v 1.53 2002/11/09 00:57:20 fgsch Exp $
d103 2
a108 2
.It Fl F Ar queue
Flush the queue rules.
d151 2
a161 2
.It Fl s Ar queue
Show the currently loaded queue rules.
@


1.53
log
@SEE ALSO reordering and corrections.
@
text
@d1 1
a1 1
.\" $OpenBSD: pfctl.8,v 1.51 2002/06/27 14:12:50 henning Exp $
d27 1
a27 1
.Dd June 24, 2001
d35 1
a35 1
.Op Fl deqhnNrRvzO
d87 3
d107 2
d140 2
a141 2
Load only the filter rules present in the rule file. NAT rules and options are
ignored.
d143 2
a144 2
Load only the options present in the rule file. Filter and NAT rules are
ignored
d160 2
@


1.52
log
@fix Xr refs; frisco@@blackant.net
@
text
@d193 1
d197 1
a197 2
.Xr sysctl 8 ,
.Xr sysctl.conf 5
@


1.51
log
@fix synopsis, closes pr2775
ok pb@@
@
text
@d1 1
a1 1
.\" $OpenBSD: pfctl.8,v 1.50 2002/06/25 08:13:25 henning Exp $
d197 1
a197 1
.Xr sysctl.conf 8
@


1.50
log
@move pfctl options -t, -m, -O and -l to pf.conf. These are set using the
"set" keyword. example rulefile:

set optimization aggressive
set timeout { tcp.closing 6, tcp.opening 6 }
set limit { states 1000, frags 1000 }
set loginterface wi0
pass out all keep state label "$nr:$srcaddr:$srcport:$dstaddr:$dstport"
block in all

fries@@ is working on an updated pf.conf(5)
discussed at c2k2 and on icb
ok dhartmei@@, kjell@@
@
text
@d1 1
a1 1
.\" $OpenBSD: pfctl.8,v 1.49 2002/06/11 06:49:19 kjell Exp $
d35 1
a35 1
.Op Fl deqhnNrRvz
a36 1
.Op Fl O Ar level
a38 2
.Op Fl l Ar interface
.Op Fl m Ar modifier
a39 1
.Op Fl t Ar modifier
@


1.49
log
@Add -N, -R
@
text
@d1 1
a1 1
.\" $OpenBSD: pfctl.8,v 1.48 2002/06/11 05:45:10 henning Exp $
a128 24
.It Fl l Ar interface
Enable collection of packet and byte count statistics for interface named
.Ar interface .
These statistics can be viewed with the
.Fl s Ar info
option.
.It Fl m Ar modifier
Gets or sets hard limits on the memory pools used by the packet filter.
See
.Xr pool 9
for an explanation of memory pools.
The modifier has the form name[=limit], where name specifies one of the
following pools and limit is either a positive integer (maximum number
of pool entries) or the string "inf" (removes the limit):
.Bl -tag -width "m states[=limit] " -compact
.It Fl m Ar states[=limit]
Maximum number of entries in the memory pool used by state table
entries (generated by 'keep state' rules).
.It Fl m Ar frags[=limit]
Maximum number of entries in the memory pool used for fragment
caching (generated by 'scrub' rules).
.It Fl m Ar all
Display all maxima, cannot be set.
.El
d132 1
a132 1
Load only the NAT rules present in the rule file. Filter rules are
a133 27
.It Fl O Ar modifier
Optimize the engine to one of the following network topographies or
environments:
.Bl -tag -width "O high-latency " -compact
.It Fl O Ar default
A normal network environment.
Suitable for almost all networks.
.It Fl O Ar normal
Alias for
.Em default
.It Fl O Ar high-latency
A high-latency environment (such as a satellite connection)
.It Fl O Ar satellite
Alias for
.Em high-latency
.It Fl O Ar aggressive
Aggressively expire connections when they are likely no longer valid.
This can greatly reduce the memory usage of the firewall at the cost of
dropping idle connections early.
.It Fl O Ar conservative
Extremely conservative settings.
Pains will be taken to avoid dropping legitimate connections at the
expense of greater memory utilization (possibly much greater on a busy
network) and slightly increased processor utilization.
.El
Currently the optimizations only encompass the state table timeouts but much
more is planned in future revisions of the finite state machines (FSMs).
d139 1
a139 1
Load only the filter rules present in the rule file. NAT rules are
d141 3
d166 4
a172 70
.It Fl t Ar modifier
Get a timeout or interval value.
Any of the modifiers may be set, with the exception of
.Em all ,
by appending =<seconds> to the modifier without any whitespace seperating
the modifier, the equals and the number of seconds.
.Bl -tag -width "t interval " -compact
.It Fl t Ar all
Display all timeouts and intervals.
.It Fl t Ar interval
Interval between purging expired states and fragments.
.It Fl t Ar frag
Seconds before an unassembled fragment is expired.
.El
.Pp
When a packet matches a stateful connection, the seconds to live of the
connection will be updated to that of the proto.modifier which corresponds
to the connection state.
Each packet which matches this state will reset the TTL.
Tuning these values may improve the performance of the
firewall at the risk of dropping valid idled connections.
.Bl -tag -width "t tcp.established " -compact
.It Fl t Ar tcp.first
The state after the first packet.
.It Fl t Ar tcp.opening
The state before the destination host ever sends a packet.
.It Fl t Ar tcp.established
The fully established state.
.It Fl t Ar tcp.closing
The state after the first FIN has been sent.
.It Fl t Ar tcp.finwait
The state after both FINs have been exchanged and the connection is closed.
Some hosts (notably web servers on Solaris) send TCP packets even after closing
the connection.
Increasing tcp.finwait (and possibly tcp.closing) can prevent blocking of
such packets.
.It Fl t Ar tcp.closed
The state after one endpoint sends a RST.
.El
.Pp
ICMP and UDP are handled in a similar fashion to TCP but with a much more
limited set of states:
.Bl -tag -width "t udp.multiple " -compact
.It Fl t Ar udp.first
The state after the first packet.
.It Fl t Ar udp.single
The state if the source host sends more than one packet but the destination
host has never sent one back.
.It Fl t Ar udp.multiple
The state if both hosts have sent packets.
.It Fl t Ar icmp.first
The state after the first packet.
.It Fl t Ar icmp.error
The state after an icmp error came back in response to an icmp packet.
.El
.Pp
Other protocols are handled similarly to UDP:
.Bl -tag -width "t other.multiple " -compact
.It Fl t Ar other.first
.It Fl t Ar other.single
.It Fl t Ar other.multiple
.El
.Bd -literal
Example:
      Timeout established connections after an hour of inactivity
    # pfctl -t tcp.established=3600

      Display the current established idle timeout
    # pfctl -t tcp.established
.Ed
@


1.48
log
@sync with reality
ok dhartmei@@
@
text
@d1 1
a1 1
.\" $OpenBSD: pfctl.8,v 1.47 2002/06/03 16:18:53 kjell Exp $
d35 1
a35 1
.Op Fl deqhnrvz
d95 3
a112 2
.It Fl f Ar file
Load config file.
d155 3
d189 3
@


1.47
log
@Add NAT keyword so it is picked up by apropos (man -k NAT). ok dhartmei@@
@
text
@d1 1
a1 1
.\" $OpenBSD: pfctl.8,v 1.46 2002/04/08 16:26:52 dhartmei Exp $
d35 1
a35 1
.Op Fl dehnqrvz
a36 1
.Op Fl N Ar file
d38 1
a38 1
.Op Fl R Ar file
d69 1
a69 1
.Xr nat.conf 5 .
d73 2
a74 2
the rule files specified with the variables pf_rules and nat_rules
are loaded automatically by the
d110 2
a153 2
.It Fl N Ar file
Load a NAT rules file.
a184 2
.It Fl R Ar file
Load a filter rules file into the filter.
d297 1
a297 1
.Bl -tag -width "/etc/nat.conf" -compact
a299 2
.It Pa /etc/nat.conf
Rules for Network Address Translation.
a302 1
.Xr nat.conf 5 ,
@


1.46
log
@Fix typo, from Raymond M Schneider
@
text
@d1 1
a1 1
.\" $OpenBSD: pfctl.8,v 1.45 2002/03/26 17:35:37 frantzen Exp $
d32 1
a32 1
.Nd control the packet filter device
@


1.45
log
@sort options and clean up the -k descrption.  patch from dfa@@solo.ee
@
text
@d1 1
a1 1
.\" $OpenBSD: pfctl.8,v 1.44 2002/03/25 22:05:49 frantzen Exp $
d79 1
a79 1
The packet filter does not itself forward packet between interfaces.
@


1.44
log
@add -k option to shootdown all the state entries from the specified host
ok dhartmei@@
@
text
@d1 1
a1 1
.\" $OpenBSD: pfctl.8,v 1.43 2002/03/21 10:12:42 dhartmei Exp $
a36 3
.Op Fl l Ar interface
.Op Fl k Ar modifier
.Op Fl m Ar modifier
d40 3
d111 14
a124 4
.It Fl k Ar modifier
Kill all of the state entries from the specified host.  A second -k parameter
may be specified which will kill all the state entries from the first host
and to the second host.
@


1.43
log
@Add r option to SYNOPSIS. From Brian Poole.
@
text
@d1 1
a1 1
.\" $OpenBSD: pfctl.8,v 1.42 2002/03/11 22:22:57 dhartmei Exp $
d38 1
d111 4
@


1.42
log
@Add -r to reverse lookup addresses when displaying states.
From John Kerbawy.
@
text
@d1 1
a1 1
.\" $OpenBSD: pfctl.8,v 1.41 2002/02/26 07:25:33 dhartmei Exp $
d35 1
a35 1
.Op Fl dehnqvz
@


1.41
log
@Add optional pool memory hard limits, mainly as temporary solution
until pool exhaustion causes problems no more.
@
text
@d1 1
a1 1
.\" $OpenBSD: pfctl.8,v 1.40 2002/02/11 18:43:51 mpech Exp $
d169 2
@


1.40
log
@Initial patch.
When you give command examples in a manual page prefix them with
	$ command
or
	# command

deraadt@@ ok
@
text
@d1 1
a1 1
.\" $OpenBSD: pfctl.8,v 1.39 2002/01/09 11:30:53 dhartmei Exp $
d38 1
d118 18
@


1.39
log
@Add labels to rules. These are arbitrary names (not to be confused with
tags that will be used to tag packets later on). Add pfctl -z to clear
per-rule counters. Add pfctl -s labels to output per-rule counters in
terse format and only for rules that have labels. Suggested by
Henning Brauer.
@
text
@d1 1
a1 1
.\" $OpenBSD: pfctl.8,v 1.38 2001/12/21 11:41:50 mpech Exp $
d241 2
a242 2
    # Timeout established connections after an hour of inactivity
    pfctl -t tcp.established=3600
d244 2
a245 2
    # Display the current established idle timeout
    pfctl -t tcp.established
@


1.38
log
@Initial patch for a new mdoc issue.
Powered by @@mantoya:
o) kill extra line in the end of file;
o) kill extra space in the end of line;
o) replace blank lines with .Pp;

millert@@ ok
@
text
@d1 1
a1 1
.\" $OpenBSD: pfctl.8,v 1.37 2001/12/13 20:16:48 mpech Exp $
d35 1
a35 1
.Op Fl dehnqv
d105 1
a105 1
Flush the filter information (statistics and counters).
d171 3
d260 2
@


1.37
log
@o) start new sentence on a new line;
o) wrap long lines;
o) fix bogus .Xr usage;
o) we don't like blank lines;
o) always close .Bl tags;
o) OpenBSD -> .Ox;
o) don't like .Pp before .Ss;

millert@@ ok;
@
text
@d1 1
a1 1
.\" $OpenBSD: pfctl.8,v 1.36 2001/12/10 18:13:30 dhartmei Exp $
a243 1

d266 1
a266 1
.Xr pf 4 , 
d277 1
a277 1
program and the 
@


1.36
log
@Convert usage of 'you' to third person. Reword some sentences.
@
text
@d1 1
a1 1
.\" $OpenBSD: pfctl.8,v 1.35 2001/12/10 18:08:12 dhartmei Exp $
d257 1
@


1.35
log
@Add stateful filtering for other (non-TCP/UDP/ICMP) protocol, based on
source/destination addresses/ports only.
Add RDR for ICMP. Add NAT/RDR/BINAT for other protocols.
Destination and redirection port(s) are now optional for RDR rules.
Not specifying destination port(s) means 'redirect all ports', not
specifying redirection port(s) means 'redirect to the original port'.
@
text
@d1 1
a1 1
.\" $OpenBSD: pfctl.8,v 1.34 2001/10/11 00:53:21 dhartmei Exp $
d32 1
a32 1
.Nd control the packet filter and NAT subsystems
d47 1
a47 1
utility communicates with the packet filter system using the
d50 2
d53 16
a68 8
Packet filtering lets you restrict packets entering or leaving
your host; packets can be specified in a variety of ways including
by protocol, by port number, and by address.
Network Address Translation lets you map a series of internal
host IP numbers to a single external address.
The NAT code also has provisions for redirecting a
range of connections to a different host and/or port number.
Taken together this provides a powerful basic firewall mechanism.
d70 6
a75 5
The
.Nm
command is normally invoked automatically at system initialization
time to start and load the packet filter,
but can also be used when the filter or translation rules change.
d77 7
a83 8
.Nm
requires the
.Xr pf 4
pseudo-device driver.
Forwarding packets, by using NAT, also requires specifying
.Li net.inet.ip.forwarding=1
in the file
.Pa /etc/sysctl.conf .
d118 1
a118 1
Do not actually load rules.
d126 2
a127 1
A normal network environment.  Suitable for almost all networks.
d137 3
a139 3
Aggressively expire connections when they are likely no longer valid.  This
can greatly reduce the memory usage of the firewall at the cost of dropping
idle connections early.
d141 4
a144 3
Extremely conservative settings.  Pains will be taken to avoid dropping
legitimate connections at the expense of greater memory utilization (possibly
much greater on a busy network) and slightly increased processor utilization.
d153 2
a154 1
Show filter parameters. Modifier names may be abbreviated:
d159 1
a159 1
Show the currently loaded packet filter rules.
d161 6
a166 5
packets and bytes) are also shown. Note that the 'skip step' optimization
done automatically by the kernel will skip evaluation of rules where
redundant. Packets passed statefully are counted in the rule that created
the state (even though the rule isn't evaluated more than once for the
entire connection).
d175 2
a176 2
Get a timeout or interval value.  Any of the modifiers may be set,
with the exception of
d191 3
a193 4
to the connection state.  Each packet which matches this state will increase
the TTL.  It is permissible to set the TTL for a particular state to zero
if you do not want packets matching a particular state to prolong the life
of the state.  Tuning these values may improve the performance of the
a194 1

d206 4
a209 2
If you see lots of blocked packets coming back from web servers (notably
Solaris), increase this value and possibly tcp.closing.
d215 1
a215 1
limited set of states.
d270 4
a273 3
.Xr rc 8
.Sh AUTHORS
Daniel Hartmeier wrote the program and the underlying mechanism.
a280 2
.Sh BUGS
Probably.
@


1.34
log
@Corrections from Brian J. Kifiak.
@
text
@d1 1
a1 1
.\" $OpenBSD: pfctl.8,v 1.33 2001/09/30 05:29:37 frantzen Exp $
d216 6
@


1.33
log
@Selectable preset FSM optimizations for several network environments.
Thanks to everyone who sent me packet captures!
@
text
@d1 1
a1 1
.\" $OpenBSD: pfctl.8,v 1.32 2001/09/06 15:04:34 mpech Exp $
d56 1
a56 1
The NAT code also has provision for redirecting a
d135 1
a135 1
more is planned in future revisions of the FSMs.
d141 1
a141 1
Show filter parameters. Modifier names may be abbreviated.
d163 1
a163 1
.Em all,
@


1.32
log
@Initial idea from aaron@@: Last char of .Xr group in SEE ALSO section should
be a single digit. Powered by mantoya@@.

millert@@ ok.
@
text
@d1 1
a1 1
.\" $OpenBSD: pfctl.8,v 1.31 2001/08/28 00:02:43 frantzen Exp $
d39 1
d111 25
@


1.31
log
@Bump state timeouts and allow tweaking them from pfctl.
(The state timeouts need some _serious_ tuning)
@
text
@d1 1
a1 1
.\" $OpenBSD: pfctl.8,v 1.30 2001/08/22 17:28:02 beck Exp $
d224 1
a224 1
.Xr rc 8 .
@


1.30
log
@ftp-proxy
@
text
@d1 1
a1 1
.\" $OpenBSD: pfctl.8,v 1.29 2001/08/19 19:25:26 dhartmei Exp $
d41 1
d134 65
@


1.29
log
@Document per-rule byte counter.
@
text
@d1 1
a1 1
.\" $OpenBSD: pfctl.8,v 1.28 2001/08/19 18:30:58 dhartmei Exp $
d157 1
@


1.28
log
@Document per-rule statistics. If the evaluation counters look funny,
think skip steps.
@
text
@d1 1
a1 1
.\" $OpenBSD: pfctl.8,v 1.27 2001/08/11 12:05:00 dhartmei Exp $
d121 1
a121 1
number of packets) are also shown. Note that the 'skip step' optimization
@


1.27
log
@Add support for ICMP errors referring to ICMP queries/replies. Fixes
'ICMP error message for bad proto' messages. Reported by Mark Grimes
and Steve Rumble.

Add debugging level with ioctl interface and pfctl switch. Default
is 'None'.
@
text
@d1 1
a1 1
.\" $OpenBSD: pfctl.8,v 1.26 2001/08/03 16:03:02 mpech Exp $
d120 6
d134 1
a134 1
Show rules as they are parsed.
@


1.26
log
@o) We always closes .Bl and .Bd tags;

millert@@ ok
@
text
@d1 1
a1 1
.\" $OpenBSD: pfctl.8,v 1.25 2001/07/28 16:38:27 dhartmei Exp $
d41 1
d129 10
@


1.25
log
@start sentence on new line, from mpech@@
@
text
@d1 1
a1 1
.\" $OpenBSD: pfctl.8,v 1.24 2001/07/26 13:01:46 dhartmei Exp $
d135 1
@


1.24
log
@sort SEE ALSO section correctly, from mpech@@.
@
text
@d1 1
a1 1
.\" $OpenBSD: pfctl.8,v 1.23 2001/07/26 12:55:15 dhartmei Exp $
d82 2
a83 1
Flush one of the following. Modifier name may be abbreviated:
@


1.23
log
@usage() with __progname according to style(9), typo in man page. both from mpech@@.
@
text
@d1 1
a1 1
.\" $OpenBSD: pfctl.8,v 1.22 2001/07/20 18:07:11 mpech Exp $
d136 1
a137 1
.Xr nat.conf 5 ,
@


1.22
log
@we don't like:
o) .Pp before/after .Sh;
o) .Pp before/after .Rs/.Re;
o) .Nm without argument in SYNOPSIS;
@
text
@d1 1
a1 1
.\" $OpenBSD: pfctl.8,v 1.21 2001/07/04 20:07:55 deraadt Exp $
d74 1
a74 1
utility provides several commands:
@


1.21
log
@do not pick a fight
@
text
@d1 1
a1 1
.\" $OpenBSD: pfctl.8,v 1.20 2001/07/03 12:16:13 ho Exp $
d34 1
a34 1
.Nm 
@


1.20
log
@Missed a few style fixes...
@
text
@d1 1
a1 1
.\" $OpenBSD: pfctl.8,v 1.19 2001/07/03 12:11:25 ho Exp $
a138 5
.Sh COMPATIBILITY
This mechanism is largely compatible with the previous
IP Filter mechanism, which was removed from
.Ox
due to a licensing conflict.
@


1.19
log
@Document -q option. Some style fixes. dhartmei@@ ok.
@
text
@d1 1
a1 1
.\" $OpenBSD: pfctl.8,v 1.18 2001/07/02 17:21:04 ho Exp $
d96 1
a96 1
Help
d131 1
a131 1
packet filter rules file
d133 1
a133 1
rules for Network Address Translation
@


1.18
log
@Typo.
@
text
@d1 1
a1 1
.\" $OpenBSD: pfctl.8,v 1.17 2001/07/01 22:10:48 angelos Exp $
d35 1
a35 1
.Op Fl dehnv
d78 1
a78 1
Disable the packet filter
d80 1
a80 1
Enable the packet filter
d83 1
a83 1
.Bl -tag -width "F rules" -compact
d85 1
a85 1
Flush the NAT rules
d87 1
a87 1
Flush the filter rules
d89 1
a89 1
Flush the state table (NAT and filter)
d91 1
a91 1
Flush the filter information (statistics and counters)
d93 1
a93 1
Flush all of the above
d104 1
a104 1
Do not actually load rules
d106 3
a108 1
Load a NAT rules file
d110 1
a110 1
Load a filter rules file into the filter
d113 1
a113 1
.Bl -tag -width "s rules" -compact
d115 1
a115 1
Show the currently loaded NAT rules
d117 1
a117 1
Show the currently loaded packet filter rules
d119 1
a119 1
Show the contents of the state table
d121 1
a121 1
Show filter information (statistics and counters)
d123 1
a123 1
Show all of the above
d126 1
a126 1
Show rules as they are parsed
@


1.17
log
@Appeared in 3.0, not 2.9; openbsd@@davidkrause.com
@
text
@d1 1
a1 1
.\" $OpenBSD: pfctl.8,v 1.16 2001/07/01 16:58:51 kjell Exp $
d120 1
a120 1
.It Fl a Ar all
@


1.16
log
@Finish with posixifying command options. Now both "pfctl -Fs" and
"pfctl -F states" work.

Changed -[Fs]S to -[Fs] info (or -[Fs]i) based on an earlier conversation
with theo.

Added -[Fs] "all" to show or flush everything

Fixup some man page pastos in the process
@
text
@d1 1
a1 1
.\" $OpenBSD: pfctl.8,v 1.15 2001/06/29 21:24:07 kjell Exp $
d150 1
a150 1
.Ox 2.9 .
@


1.15
log
@POSIX-ify the flag options at theo's request
@
text
@d1 1
a1 1
.\" $OpenBSD: pfctl.8,v 1.14 2001/06/27 21:54:46 kjell Exp $
d13 1
a13 4
.\" 3. All advertising materials mentioning features or use of this software
.\"    must display the following acknowledgement:
.\"	This product includes software developed by Ericsson Radio Systems.
.\" 4. The name of the author may not be used to endorse or promote products
d35 1
a35 2
.Op Fl d
.Op Fl e
a36 1
.Op Fl h
a38 1
.Op Fl n
a40 1
.Op Fl v
d82 3
a84 3
Flush one of the following sets:
.Bl -tag -width "F n" -compact
.It Fl F Ar n
d86 1
a86 1
.It Fl F Ar r
d88 1
a88 1
.It Fl F Ar s
d90 4
a93 2
.It Fl F Ar S
Flush (zero) the filter statistics
d101 2
a102 2
.Fl "sS"
flag.
d110 3
a112 3
Show filter parameters.
.Bl -tag -width "s n" -compact
.It Fl s Ar n
d114 1
a114 1
.It Fl s Ar r
d116 1
a116 1
.It Fl s Ar s
d118 4
a121 2
.It Fl s Ar S
Show filter statistics
d135 2
a136 1
.Xr nat.conf 5 .
a152 2
.Sh CAVEATS
It is not yet as fully featured as the mechanism it replaced.
@


1.14
log
@Change flag syntax
-Fs, -Fn, -Fr, -FS to flush states, nat rules, filter rules, stats
-ss, -sn, -sr, -sS to show them
-z goes away
@
text
@d1 1
a1 1
.\" $OpenBSD: pfctl.8,v 1.13 2001/06/27 11:01:11 kjell Exp $
d41 1
d90 2
a91 2
.Bl -tag -width "Fn" -compact
.It Fl "\Fn"
d93 1
a93 1
.It Fl "Fr"
d95 1
a95 1
.It Fl "Fs"
d97 1
a97 1
.It Fl "FS"
d100 2
d116 2
a117 2
.Bl -tag -width "sn" -compact
.It Fl "sn"
d119 1
a119 1
.It Fl "sr"
d121 1
a121 1
.It Fl "ss"
d123 1
a123 1
.It Fl "sS"
@


1.13
log
@add -z option
@
text
@d1 1
a1 1
.\" $OpenBSD: pfctl.8,v 1.12 2001/06/26 23:24:05 kjell Exp $
d40 1
a40 1
.Op Fl c Ar set
d42 4
a45 4
.Op Fl n Ar file
.Op Fl N
.Op Fl r Ar file
.Op Fl s Ar set
a46 1
.Op Fl z
d87 11
a97 9
.It Fl c Ar set
Clear one of the following sets:
.Bl -tag -width "states" -compact
.It Ar nat
Clear the NAT rules
.It Ar rules
Clear the filter rules
.It Ar states
Clear the state table (NAT and filter)
d103 3
a105 3
.Fl s Ar status
option.
.It Fl N
d107 1
a107 1
.It Fl n Ar file
d109 1
a109 1
.It Fl r Ar file
d111 1
a111 1
.It Fl s Ar set
d113 2
a114 4
.Ar set
is one of the following:
.Bl -tag -width "status" -compact
.It Ar nat
d116 1
a116 1
.It Ar rules
d118 1
a118 1
.It Ar states
d120 1
a120 1
.It Ar status
a124 2
.It Fl z
Zero the filter statistics
@


1.12
log
@Add -N (parse, but do not load) and -v (verbose: show parsed rules)
for pf and nat rules.
@
text
@d1 1
a1 1
.\" $OpenBSD: pfctl.8,v 1.11 2001/06/26 17:52:40 kjell Exp $
d47 1
d126 2
@


1.11
log
@Clarify what the -l option does.
@
text
@d1 1
a1 1
.\" $OpenBSD: pfctl.8,v 1.10 2001/06/26 17:14:12 deraadt Exp $
d43 1
d46 1
d103 2
d123 2
@


1.10
log
@language
@
text
@d1 1
a1 1
.\" $OpenBSD: pfctl.8,v 1.9 2001/06/26 17:04:01 kjell Exp $
d96 5
a100 2
Enable logging for interface named
.Ar interface
@


1.9
log
@change config file names to pf.conf and nat.conf
@
text
@d1 1
a1 1
.\" $OpenBSD: pfctl.8,v 1.8 2001/06/26 13:02:39 ian Exp $
d68 1
a68 1
requires a kernel with
d70 2
a71 4
configured in (the GENERIC kernel qualifies).
To forward packets (using NAT), 
.Nm
also requires
a74 4
.\"The existance of the variables PF and NAT in 
.\".Pa /etc/rc.conf
.\"determine whether this mechanism will be started automatically
.\"when the system is booted.
@


1.8
log
@Renamed files to pf.filter and pf.rules
@
text
@d1 1
a1 1
.\" $OpenBSD: pfctl.8,v 1.7 2001/06/26 03:50:54 kjell Exp $
d124 2
a125 2
.Bl -tag -width /etc/pf.filter -compact
.It Pa /etc/filter
d127 1
a127 1
.It Pa /etc/pf.nat
d131 2
a132 2
.Xr pf.filter 5 ,
.Xr pf.nat 5 .
@


1.7
log
@Update man page to reflect the new getopt-style parameters
@
text
@d1 1
a1 1
.\" $OpenBSD: pfctl.8,v 1.6 2001/06/26 00:16:55 ian Exp $
d124 2
a125 2
.Bl -tag -width /etc/nat.rules -compact
.It Pa /etc/pf.rules
d127 1
a127 1
.It Pa /etc/nat.rules
d131 2
a132 2
.Xr pf.rules 5 ,
.Xr nat.rules 5 .
@


1.6
log
@Fix .Ox calls
@
text
@d1 1
a1 1
.\" $OpenBSD: pfctl.8,v 1.5 2001/06/25 23:49:28 jasoni Exp $
d37 8
a44 2
.Nm pfctl
.Ar commands
d77 4
a80 4
The variables IPF and IPNAT in 
.Pa /etc/rc.conf
determine whether this mechanism will be started automatically
when the system is booted.
d85 27
a111 7
.Pp
.Bl -tag -width "parse" -compact
.It Cm start
Start the packet filter
.It Cm stop
Stop the packet filter
.It Cm show
d113 8
a120 15
.It Cm rules
Show filter rules
.It Cm nat
Show NAT rules
.It Cm states Op proto
Show active states, optionally for a particular protocol
.It Cm status
Filter status
.El
.It Cm clear
.Bl -tag -width "rules" -compact
.It Cm rules
Clear filter rules
.It Cm nat
Clear NAT rules
a121 6
.It Cm parse
.Bl -tag -width "wules" -compact
.It Cm rules Pa filename
Test the syntax of a rules file
.It Cm nat Pa filename
Test the syntax of a NAT file
a122 11
.It Cm load
.Bl -tag -width "rules" -compact
.It Cm rules Pa filename
Load rules into the filter
.It Cm nat
Load rules into NAT
.El
.It Cm log Ar if
Enable logging for an interface
.El
.Pp
d124 1
a124 1
.Bl -tag -width /etc/nat.rules
@


1.5
log
@fixup .Xr for pf(4); pf(4,) -> pf(4),
@
text
@d1 1
a1 1
.\" $OpenBSD: pfctl.8,v 1.4 2001/06/25 21:27:16 ian Exp $
d134 1
a134 1
.Os
d144 1
a144 2
.Os
2.10.
@


1.4
log
@Better style in description; additional sections at end.
@
text
@d1 1
a1 1
.\" $OpenBSD: pfctl.8,v 1.3 2001/06/25 19:32:19 ian Exp $
d128 1
a128 1
.Xr pf 4, 
@


1.3
log
@Theo wanted a larger man page
@
text
@d1 1
a1 1
.\" $OpenBSD: pfctl.8,v 1.2 2001/06/25 19:07:22 smart Exp $
a60 1
To use
d62 6
a67 10
successfully, you must:
.Bl -enum
.It
Be running a kernel with
.Xr pf 8
configured in (the GENERIC kernel qualifies);
.It
Have written a rules and/or nat file;
.It
If you are forwarding packets (using NAT), have enabled 
d70 2
a71 6
.Pa /etc/sysctl.conf ,
and rebooted since enabling it.
.El
.Pp
For this mechanism to be started when the system reboots,
you should enable IPF and IPNAT in 
d73 2
a74 1
as well.
a120 2
.Sh BUGS
Yes
d128 14
d143 7
@


1.2
log
@'.Nm pfctl' not '.Nm' in SYNOPSIS.  Also, some cleanup of stray punctuation.
aaron@@ ok.
@
text
@d1 1
a1 1
.\" $OpenBSD: pfctl.8,v 1.1 2001/06/25 16:12:33 kjell Exp $
d45 38
@


1.1
log
@pfctl now has a manpage. likely needs fleshing out.
@
text
@d1 1
a1 1
.\" $OpenBSD: isakmpd.8,v 1.27 2001/05/24 15:59:30 ho Exp $
d37 1
a37 1
.Nm 
d44 1
a44 1
.Xr pf 4
d52 1
a52 1
Start the packet filter.
d54 1
a54 1
Stop the packet filter.
@

