head	1.18;
access;
symbols
	OPENBSD_6_2_BASE:1.18
	OPENBSD_6_1:1.18.0.8
	OPENBSD_6_1_BASE:1.18
	OPENBSD_6_0:1.18.0.4
	OPENBSD_6_0_BASE:1.18
	OPENBSD_5_9:1.18.0.2
	OPENBSD_5_9_BASE:1.18
	OPENBSD_5_8:1.17.0.4
	OPENBSD_5_8_BASE:1.17
	OPENBSD_5_7:1.16.0.18
	OPENBSD_5_7_BASE:1.16
	OPENBSD_5_6:1.16.0.22
	OPENBSD_5_6_BASE:1.16
	OPENBSD_5_5:1.16.0.20
	OPENBSD_5_5_BASE:1.16
	OPENBSD_5_4:1.16.0.16
	OPENBSD_5_4_BASE:1.16
	OPENBSD_5_3:1.16.0.14
	OPENBSD_5_3_BASE:1.16
	OPENBSD_5_2:1.16.0.12
	OPENBSD_5_2_BASE:1.16
	OPENBSD_5_1_BASE:1.16
	OPENBSD_5_1:1.16.0.10
	OPENBSD_5_0:1.16.0.8
	OPENBSD_5_0_BASE:1.16
	OPENBSD_4_9:1.16.0.6
	OPENBSD_4_9_BASE:1.16
	OPENBSD_4_8:1.16.0.4
	OPENBSD_4_8_BASE:1.16
	OPENBSD_4_7:1.16.0.2
	OPENBSD_4_7_BASE:1.16
	OPENBSD_4_6:1.15.0.12
	OPENBSD_4_6_BASE:1.15
	OPENBSD_4_5:1.15.0.8
	OPENBSD_4_5_BASE:1.15
	OPENBSD_4_4:1.15.0.6
	OPENBSD_4_4_BASE:1.15
	OPENBSD_4_3:1.15.0.4
	OPENBSD_4_3_BASE:1.15
	OPENBSD_4_2:1.15.0.2
	OPENBSD_4_2_BASE:1.15
	OPENBSD_4_1:1.14.0.10
	OPENBSD_4_1_BASE:1.14
	OPENBSD_4_0:1.14.0.8
	OPENBSD_4_0_BASE:1.14
	OPENBSD_3_9:1.14.0.6
	OPENBSD_3_9_BASE:1.14
	OPENBSD_3_8:1.14.0.4
	OPENBSD_3_8_BASE:1.14
	OPENBSD_3_7:1.14.0.2
	OPENBSD_3_7_BASE:1.14
	OPENBSD_3_6:1.13.0.6
	OPENBSD_3_6_BASE:1.13
	OPENBSD_3_5:1.13.0.4
	OPENBSD_3_5_BASE:1.13
	OPENBSD_3_4:1.13.0.2
	OPENBSD_3_4_BASE:1.13
	OPENBSD_3_3:1.11.0.14
	OPENBSD_3_3_BASE:1.11
	OPENBSD_3_2:1.11.0.12
	OPENBSD_3_2_BASE:1.11
	OPENBSD_3_1:1.11.0.10
	OPENBSD_3_1_BASE:1.11
	OPENBSD_3_0:1.11.0.8
	OPENBSD_3_0_BASE:1.11
	OPENBSD_2_9:1.11.0.6
	OPENBSD_2_9_BASE:1.11
	OPENBSD_2_8:1.11.0.4
	OPENBSD_2_8_BASE:1.11
	OPENBSD_2_7:1.11.0.2
	OPENBSD_2_7_BASE:1.11
	OPENBSD_2_6:1.10.0.2
	OPENBSD_2_6_BASE:1.10
	OPENBSD_2_5:1.8.0.2
	OPENBSD_2_5_BASE:1.8
	OPENBSD_2_4:1.5.0.2
	OPENBSD_2_4_BASE:1.5
	OPENBSD_2_3:1.3.0.4
	OPENBSD_2_3_BASE:1.3
	OPENBSD_2_2:1.3.0.2
	OPENBSD_2_2_BASE:1.3
	R19970424:1.1.1.1
	BOUYER:1.1.1;
locks; strict;
comment	@.\" @;


1.18
date	2015.10.14.14.33.45;	author deraadt;	state Exp;
branches;
next	1.17;
commitid	BweGlCJbPgfbxjH9;

1.17
date	2015.07.27.18.46.19;	author jmc;	state Exp;
branches;
next	1.16;
commitid	U6t1VbVNqdg9vGTD;

1.16
date	2010.01.10.10.53.33;	author jmc;	state Exp;
branches;
next	1.15;

1.15
date	2007.05.31.19.19.44;	author jmc;	state Exp;
branches;
next	1.14;

1.14
date	2005.02.03.05.00.08;	author jaredy;	state Exp;
branches;
next	1.13;

1.13
date	2003.07.08.18.50.40;	author jmc;	state Exp;
branches;
next	1.12;

1.12
date	2003.06.02.20.06.15;	author millert;	state Exp;
branches;
next	1.11;

1.11
date	2000.03.18.22.55.57;	author aaron;	state Exp;
branches;
next	1.10;

1.10
date	99.07.21.01.07.53;	author deraadt;	state Exp;
branches;
next	1.9;

1.9
date	99.06.04.02.45.16;	author aaron;	state Exp;
branches;
next	1.8;

1.8
date	98.12.15.01.20.30;	author aaron;	state Exp;
branches;
next	1.7;

1.7
date	98.11.28.19.56.19;	author aaron;	state Exp;
branches;
next	1.6;

1.6
date	98.11.11.22.19.56;	author aaron;	state Exp;
branches;
next	1.5;

1.5
date	98.09.23.01.20.23;	author aaron;	state Exp;
branches;
next	1.4;

1.4
date	98.09.17.04.14.52;	author aaron;	state Exp;
branches;
next	1.3;

1.3
date	97.06.14.04.16.52;	author downsj;	state Exp;
branches;
next	1.2;

1.2
date	97.06.14.04.06.25;	author downsj;	state Exp;
branches;
next	1.1;

1.1
date	97.05.30.04.33.53;	author downsj;	state Exp;
branches
	1.1.1.1;
next	;

1.1.1.1
date	97.05.30.04.33.53;	author downsj;	state Exp;
branches;
next	;


desc
@@


1.18
log
@Only accept one filesystem/device as argument for checking.  Few people
will be calling these directly, and not for the multiple filesystem case.
fsck(8) is generally the parent and will handle things.
ok semarie; this change will also help a goal jsing has
@
text
@.\"	$OpenBSD: fsck_ext2fs.8,v 1.17 2015/07/27 18:46:19 jmc Exp $
.\"	$NetBSD: fsck_ext2fs.8,v 1.1 1997/06/11 11:21:48 bouyer Exp $
.\"
.\" Copyright (c) 1997 Manuel Bouyer.
.\" Copyright (c) 1980, 1989, 1991, 1993
.\"	The Regents of the University of California.  All rights reserved.
.\"
.\" Redistribution and use in source and binary forms, with or without
.\" modification, are permitted provided that the following conditions
.\" are met:
.\" 1. Redistributions of source code must retain the above copyright
.\"    notice, this list of conditions and the following disclaimer.
.\" 2. Redistributions in binary form must reproduce the above copyright
.\"    notice, this list of conditions and the following disclaimer in the
.\"    documentation and/or other materials provided with the distribution.
.\" 3. Neither the name of the University nor the names of its contributors
.\"    may be used to endorse or promote products derived from this software
.\"    without specific prior written permission.
.\"
.\" THIS SOFTWARE IS PROVIDED BY THE REGENTS AND CONTRIBUTORS ``AS IS'' AND
.\" ANY EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT LIMITED TO, THE
.\" IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE
.\" ARE DISCLAIMED.  IN NO EVENT SHALL THE REGENTS OR CONTRIBUTORS BE LIABLE
.\" FOR ANY DIRECT, INDIRECT, INCIDENTAL, SPECIAL, EXEMPLARY, OR CONSEQUENTIAL
.\" DAMAGES (INCLUDING, BUT NOT LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS
.\" OR SERVICES; LOSS OF USE, DATA, OR PROFITS; OR BUSINESS INTERRUPTION)
.\" HOWEVER CAUSED AND ON ANY THEORY OF LIABILITY, WHETHER IN CONTRACT, STRICT
.\" LIABILITY, OR TORT (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY
.\" OUT OF THE USE OF THIS SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF
.\" SUCH DAMAGE.
.\"
.\"	@@(#)fsck.8	8.3 (Berkeley) 11/29/94
.\"
.Dd $Mdocdate: July 27 2015 $
.Dt FSCK_EXT2FS 8
.Os
.Sh NAME
.Nm fsck_ext2fs
.Nd Second Extended File System consistency check and interactive repair
.Sh SYNOPSIS
.Nm fsck_ext2fs
.Op Fl dfnpy
.Op Fl b Ar block#
.Op Fl m Ar mode
.Ar filesystem
.Sh DESCRIPTION
.Nm
performs interactive file system consistency checks and repairs
the filesystem specified.
It is normally invoked from
.Xr fsck 8 .
.Pp
The kernel takes care that only a restricted class of innocuous file system
inconsistencies can happen unless hardware or software failures intervene.
These are limited to the following:
.Pp
.Bl -item -compact -offset indent
.It
Unreferenced inodes
.It
Link counts in inodes too large
.It
Missing blocks in the free map
.It
Blocks in the free map also in files
.It
Counts in the super-block wrong
.El
.Pp
These are the only inconsistencies that
.Nm
in
.Dq preen
mode (with the
.Fl p
option) will correct; if it encounters other inconsistencies, it exits
with an abnormal return status.
For each corrected inconsistency one or more lines will be printed
identifying the file system on which the correction will take place,
and the nature of the correction.
After successfully correcting a file system,
.Nm
will print the number of files on that file system
and the number of used and free blocks.
.Pp
If sent a
.Dv QUIT
signal,
.Nm
will finish the file system checks, then exit with an abnormal return status.
.Pp
Without the
.Fl p
option,
.Nm
audits and interactively repairs inconsistent conditions for the filesystem.
If the file system is inconsistent, the operator is prompted for concurrence
before each correction is attempted.
It should be noted that some of the corrective actions which are not
correctable under the
.Fl p
option will result in some loss of data.
The amount and severity of data lost may be determined from the diagnostic
output.
The default action for each consistency correction
is to wait for the operator to respond
.Dq yes
or
.Dq no .
If the operator does not have write permission on the file system,
.Nm
will default to a
.Fl n
action.
.Pp
The following flags are interpreted by
.Nm fsck_ext2fs :
.Bl -tag -width indent
.It Fl b Ar block#
Use the block specified immediately after the flag as
the super block for the file system.
Block 8193 is usually an alternate super block.
.It Fl d
Print debugging output.
.It Fl f
Force checking of the filesystem.
Normally, if a file system is cleanly unmounted, the kernel will set a
.Dq clean flag
in the file system superblock and
.Nm
will not check the file system.
This option forces
.Nm
to check the file system, regardless of the state of the clean flag.
.It Fl m Ar mode
Use the
.Ar mode
specified in octal as the
permission bits to use when creating the
.Pa lost+found
directory rather than the default 1777.
In particular, systems that do not wish to have lost files accessible
by all users on the system should use a more restrictive
set of permissions such as 700.
.It Fl n
Assume a
.Dq no
response to all questions asked by
.Nm
except for
.Dq CONTINUE? ,
which is assumed to be affirmative.
The filesystem will not be opened for writing.
This is the default for file systems to be checked that are
concurrently mounted writable.
.It Fl p
Specify
.Dq preen
mode, described above.
.It Fl y
Assume a
.Dq yes
response to all questions asked by
.Nm fsck_ext2fs ;
this should be used with great caution as this is a free license
to continue after essentially unlimited trouble has been encountered.
.El
.Pp
If neither of the
.Fl y
or
.Fl n
options are specified, the user may force
.Nm
to assume an answer of
.Dq yes
to all the remaining questions by replying to a question with a value of
.Dq F .
.Pp
Inconsistencies checked are as follows:
.Pp
.Bl -enum -compact
.It
Blocks claimed more than once by inodes or the free map.
.It
Blocks claimed by an inode outside the range of the file system.
.It
Incorrect link counts.
.It
Size checks:
.Bl -item -compact -offset indent
.It
Directory size not a multiple of file system block size.
.It
Partially truncated file.
.El
.It
Bad inode format.
.It
Blocks not accounted for anywhere.
.It
Directory checks:
.Bl -item -compact -offset indent
.It
File pointing to unallocated inode.
.It
Inode number out of range.
.It
Dot or dot-dot not the first two entries of a directory
or having the wrong inode number.
.El
.It
Super Block checks:
.Bl -item -compact -offset indent
.It
More blocks for inodes than there are in the file system.
.It
Bad free block map format.
.It
Total free block and/or free inode count incorrect.
.El
.El
.Pp
Orphaned files and directories (allocated but unreferenced) are,
with the operator's concurrence, reconnected by
placing them in the
.Pa lost+found
directory.
The name assigned is the inode number.
If the
.Pa lost+found
directory does not exist, it is created.
If there is insufficient space its size is increased.
.Pp
Because of inconsistencies between the block device and the buffer cache,
the raw device should always be used.
.Sh DIAGNOSTICS
The diagnostics produced by
.Nm
are fully enumerated and explained in Appendix A of
.Rs
.%T "Fsck_ffs \- The UNIX File System Check Program"
.Re
.Sh SEE ALSO
.Xr fs 5 ,
.Xr fstab 5 ,
.Xr fsck 8 ,
.Xr mount_ext2fs 8 ,
.Xr rc 8
@


1.17
log
@document "F" in interactive mode, like for fsck.8;
from michael mcconville

ok deraadt
@
text
@d1 1
a1 1
.\"	$OpenBSD: fsck_ext2fs.8,v 1.16 2010/01/10 10:53:33 jmc Exp $
d34 1
a34 1
.Dd $Mdocdate: January 10 2010 $
d45 1
a45 1
.Ar filesystem ...
d48 2
a49 2
performs interactive file system consistency checks and repairs for each of
the file systems specified.
d96 1
a96 1
audits and interactively repairs inconsistent conditions for file systems.
d126 1
a126 1
Force checking of file systems.
d153 1
a153 1
File systems will not be opened for writing.
@


1.16
log
@remove references to docs we no longer install;
@
text
@d1 1
a1 1
.\"	$OpenBSD: fsck_ext2fs.8,v 1.15 2007/05/31 19:19:44 jmc Exp $
d34 1
a34 1
.Dd $Mdocdate: May 31 2007 $
d168 11
@


1.15
log
@convert to new .Dd format;
@
text
@d1 1
a1 1
.\"	$OpenBSD: fsck_ext2fs.8,v 1.14 2005/02/03 05:00:08 jaredy Exp $
d34 1
a34 1
.Dd $Mdocdate$
a238 4
.Rs
.%T "Fsck_ffs \- The UNIX File System Check Program"
.%O /usr/share/doc/smm/03.fsck_ffs
.Re
@


1.14
log
@- simplify, normalize, and sync usage/synopsis forms
- filesystem -> file system, for consistency
- indent sections where applicable
- mdoc, punctuation, grammar, etc. fixes
- document SIGINFO to fsck_ffs
- unify description of -n among documents
- sprinkle xrefs all around
- move parts relevant to fsck.8 from fsck_ffs.8

parts from NetBSD

ok jmc
@
text
@d1 1
a1 1
.\"	$OpenBSD: fsck_ext2fs.8,v 1.13 2003/07/08 18:50:40 jmc Exp $
d34 1
a34 1
.Dd June 13, 1997
@


1.13
log
@- fix some lists/displays
- use .Dl for one-liners, rather than .Bd
@
text
@d1 1
a1 1
.\"	$OpenBSD: fsck_ext2fs.8,v 1.12 2003/06/02 20:06:15 millert Exp $
d42 1
a43 2
.Op Fl d
.Op Fl f
d45 1
a45 5
.Op Fl p
.Op Fl y
.Op Fl n
.Ar filesystem
.Ar ...
d48 2
a49 2
performs interactive filesystem consistency checks and repair for each of
the filesystems specified on the command line.
d53 1
a53 1
The kernel takes care that only a restricted class of innocuous filesystem
d57 1
a57 1
.Bl -item -compact
d79 1
a79 1
identifying the filesystem on which the correction will take place,
d81 1
a81 1
After successfully correcting a filesystem,
d83 1
a83 1
will print the number of files on that filesystem
d90 1
a90 1
will finish the filesystem checks, then exit with an abnormal return status.
d96 2
a97 2
audits and interactively repairs inconsistent conditions for filesystems.
If the filesystem is inconsistent the operator is prompted for concurrence
d110 1
a110 1
If the operator does not have write permission on the filesystem,
d121 1
a121 1
the super block for the filesystem.
d152 4
a155 2
which is assumed to be affirmative;
do not open the filesystem for writing.
d173 1
a173 1
Blocks claimed by more than one inode or the free map.
d175 1
a175 1
Blocks claimed by an inode outside the range of the filesystem.
d180 1
a180 1
.Bl -item -compact
d182 1
a182 1
Directory size not a multiple of filesystem block size.
d192 1
a192 1
.Bl -item -compact
d203 1
a203 1
.Bl -item -compact
d205 1
a205 1
More blocks for inodes than there are in the filesystem.
d231 1
a231 1
.%T "Fsck \- The UNIX File System Check Program"
d237 6
a242 3
.Xr fsdb 8 ,
.Xr newfs 8 ,
.Xr reboot 8
@


1.12
log
@Remove the advertising clause in the UCB license which Berkeley
rescinded 22 July 1999.  Proofed by myself and Theo.
@
text
@d1 1
a1 1
.\"	$OpenBSD: fsck_ext2fs.8,v 1.11 2000/03/18 22:55:57 aaron Exp $
a171 1
.Bl -enum -indent indent -compact
d174 1
d183 1
a183 1
.Bl -item -indent indent -compact
d195 1
a195 1
.Bl -item -indent indent -compact
d206 1
a206 1
.Bl -item -indent indent -compact
@


1.11
log
@Remove hard sentence breaks, and some other cleanup along the way.
@
text
@d1 1
a1 1
.\"	$OpenBSD: fsck_ext2fs.8,v 1.10 1999/07/21 01:07:53 deraadt Exp $
d16 1
a16 5
.\" 3. All advertising materials mentioning features or use of this software
.\"    must display the following acknowledgement:
.\"	This product includes software developed by the University of
.\"	California, Berkeley and its contributors.
.\" 4. Neither the name of the University nor the names of its contributors
@


1.10
log
@use .Ar on later .It Fl lines
@
text
@d1 1
a1 1
.\"	$OpenBSD: fsck_ext2fs.8,v 1.9 1999/06/04 02:45:16 aaron Exp $
d58 2
a59 1
the filesystems specified on the command line. It is normally invoked from
d89 2
a90 1
and the nature of the correction.  After successfully correcting a filesystem,
d130 2
a131 2
the super block for the filesystem.  Block 8193 is usually
an alternate super block.
d135 2
a136 2
Force checking of file systems.  Normally, if a file system is cleanly
unmounted, the kernel will set a
d140 2
a141 1
will not check the file system.  This option forces
@


1.9
log
@start to remove non-escaped trailing whitespace, it can confuse troff; pjanzen@@
@
text
@d1 1
a1 1
.\"	$OpenBSD: fsck_ext2fs.8,v 1.8 1998/12/15 01:20:30 aaron Exp $
a46 1
.Op Fl c Ar level
d126 1
a126 1
.It Fl b
d141 4
a144 2
.It Fl m
Use the mode specified in octal immediately after the flag as the
@


1.8
log
@always give .Nm macros an argument in SYNOPSIS sections; krw@@tcn.net
@
text
@d1 1
a1 1
.\"	$OpenBSD: fsck_ext2fs.8,v 1.7 1998/11/28 19:56:19 aaron Exp $
d104 1
a104 1
audits and interactively repairs inconsistent conditions for filesystems. 
d120 1
a120 1
will default to a 
d153 1
a153 1
response to all questions asked by 
d166 1
a166 1
response to all questions asked by 
d184 1
a184 1
.It 
d196 1
a196 1
.It 
d207 1
a207 1
.It 
d218 1
a218 1
placing them in the 
d230 1
a230 1
The diagnostics produced by 
@


1.7
log
@kill redundant .Nm macro arguments; other misc fixes
@
text
@d1 1
a1 1
.\"	$OpenBSD: fsck_ext2fs.8,v 1.6 1998/11/11 22:19:56 aaron Exp $
d45 1
a45 1
.Nm
@


1.6
log
@more `` '' -> .Dq sillyness; remove redundant .Pp macros; other misc fixes
@
text
@d1 1
a1 1
.\"	$OpenBSD: fsck_ext2fs.8,v 1.5 1998/09/23 01:20:23 aaron Exp $
d45 1
a45 1
.Nm fsck_ext2fs
d57 1
a57 1
.Nm fsck_ext2fs
d80 1
a80 1
.Nm fsck_ext2fs
d90 1
a90 1
.Nm fsck_ext2fs
d97 1
a97 1
.Nm fsck_ext2fs
d103 1
a103 1
.Nm fsck_ext2fs
d119 1
a119 1
.Nm fsck_ext2fs
d154 1
a154 1
.Nm fsck_ext2fs
d231 1
a231 1
.Nm fsck_ext2fs
@


1.5
log
@alphabetize SEE ALSO entries and order them numerically according to section
@
text
@d1 1
a1 1
.\"	$OpenBSD: fsck_ext2fs.8,v 1.4 1998/09/17 04:14:52 aaron Exp $
d81 2
a82 1
in ``preen''
d156 1
a156 1
.Ql CONTINUE? ,
d160 3
a162 1
Specify ``preen'' mode, described above.
@


1.4
log
@sbin/ man page fixes
@
text
@d1 1
a1 1
.\"	$OpenBSD: fsck_ext2fs.8,v 1.3 1997/06/14 04:16:52 downsj Exp $
d234 1
d236 1
a236 1
.Xr fs 5 ,
d239 1
a239 2
.Xr reboot 8 ,
.Xr fsck 8
@


1.3
log
@Add tags, fix man page.  Purely cosmetic.
@
text
@d1 1
a1 1
.\"	$OpenBSD$
d57 1
a57 1
.Nm Fsck_ext2fs
d114 1
a114 1
.Li yes
d116 2
a117 2
.Li no .
If the operator does not have write permission on the filesystem
d124 1
a124 1
.Nm fsck_ext2fs .
d136 1
a136 1
in the file system superblock, and
d150 3
a152 1
Assume a no response to all questions asked by 
d161 3
a163 1
Assume a yes response to all questions asked by 
d171 1
@


1.2
log
@Sync with NetBSD.  Purely cosmetic.
@
text
@d1 1
d38 3
a40 3
.Dd November 29, 1994
.Dt FSCK_FFS 8
.Os BSD 4
d43 1
a43 1
.Nd Fast File System consistency check and interactive repair
@


1.1
log
@Initial revision
@
text
@d1 1
a1 3
.\"	$NetBSD: fsck_ffs.8,v 1.15 1996/12/27 05:51:14 mikel Exp $
.\"
.\" Modified for EXT2FS on NetBSD by Manuel Bouyer, April 1997
d3 1
d127 1
a127 1
the super block for the filesystem.  Block 16386 is usually
@


1.1.1.1
log
@Initial import of Manuel's fsck_ext2fs, unmodified.
@
text
@@
