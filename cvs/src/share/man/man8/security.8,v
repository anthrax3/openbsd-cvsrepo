head	1.26;
access;
symbols
	OPENBSD_6_2:1.26.0.2
	OPENBSD_6_2_BASE:1.26
	OPENBSD_6_1:1.25.0.12
	OPENBSD_6_1_BASE:1.25
	OPENBSD_6_0:1.25.0.8
	OPENBSD_6_0_BASE:1.25
	OPENBSD_5_9:1.25.0.4
	OPENBSD_5_9_BASE:1.25
	OPENBSD_5_8:1.25.0.6
	OPENBSD_5_8_BASE:1.25
	OPENBSD_5_7:1.25.0.2
	OPENBSD_5_7_BASE:1.25
	OPENBSD_5_6:1.24.0.4
	OPENBSD_5_6_BASE:1.24
	OPENBSD_5_5:1.21.0.10
	OPENBSD_5_5_BASE:1.21
	OPENBSD_5_4:1.21.0.6
	OPENBSD_5_4_BASE:1.21
	OPENBSD_5_3:1.21.0.4
	OPENBSD_5_3_BASE:1.21
	OPENBSD_5_2:1.21.0.2
	OPENBSD_5_2_BASE:1.21
	OPENBSD_5_1_BASE:1.20
	OPENBSD_5_1:1.20.0.4
	OPENBSD_5_0:1.20.0.2
	OPENBSD_5_0_BASE:1.20
	OPENBSD_4_9:1.18.0.6
	OPENBSD_4_9_BASE:1.18
	OPENBSD_4_8:1.18.0.4
	OPENBSD_4_8_BASE:1.18
	OPENBSD_4_7:1.18.0.2
	OPENBSD_4_7_BASE:1.18
	OPENBSD_4_6:1.17.0.4
	OPENBSD_4_6_BASE:1.17
	OPENBSD_4_5:1.14.0.4
	OPENBSD_4_5_BASE:1.14
	OPENBSD_4_4:1.14.0.2
	OPENBSD_4_4_BASE:1.14
	OPENBSD_4_3:1.13.0.2
	OPENBSD_4_3_BASE:1.13
	OPENBSD_4_2:1.12.0.2
	OPENBSD_4_2_BASE:1.12
	OPENBSD_4_1:1.11.0.2
	OPENBSD_4_1_BASE:1.11
	OPENBSD_4_0:1.10.0.8
	OPENBSD_4_0_BASE:1.10
	OPENBSD_3_9:1.10.0.6
	OPENBSD_3_9_BASE:1.10
	OPENBSD_3_8:1.10.0.4
	OPENBSD_3_8_BASE:1.10
	OPENBSD_3_7:1.10.0.2
	OPENBSD_3_7_BASE:1.10
	OPENBSD_3_6:1.7.0.4
	OPENBSD_3_6_BASE:1.7
	OPENBSD_3_5:1.7.0.2
	OPENBSD_3_5_BASE:1.7
	OPENBSD_3_4:1.6.0.2
	OPENBSD_3_4_BASE:1.6
	OPENBSD_3_3:1.5.0.2
	OPENBSD_3_3_BASE:1.5
	OPENBSD_3_2:1.3.0.6
	OPENBSD_3_2_BASE:1.3
	OPENBSD_3_1:1.3.0.4
	OPENBSD_3_1_BASE:1.3
	OPENBSD_3_0:1.3.0.2
	OPENBSD_3_0_BASE:1.3
	OPENBSD_2_9:1.2.0.2
	OPENBSD_2_9_BASE:1.2;
locks; strict;
comment	@.\" @;


1.26
date	2017.07.13.19.16.33;	author jmc;	state Exp;
branches;
next	1.25;
commitid	JpuOPPFrvYnLU8Rv;

1.25
date	2014.09.08.01.27.55;	author schwarze;	state Exp;
branches;
next	1.24;
commitid	cPoapLAXYNe1fcgV;

1.24
date	2014.04.22.16.58.20;	author tedu;	state Exp;
branches;
next	1.23;

1.23
date	2014.04.20.22.15.49;	author ajacoutot;	state Exp;
branches;
next	1.22;

1.22
date	2014.03.23.22.08.59;	author sthen;	state Exp;
branches;
next	1.21;

1.21
date	2012.07.08.21.48.38;	author schwarze;	state Exp;
branches;
next	1.20;

1.20
date	2011.04.19.05.17.24;	author jmc;	state Exp;
branches;
next	1.19;

1.19
date	2011.04.18.23.58.45;	author schwarze;	state Exp;
branches;
next	1.18;

1.18
date	2009.12.25.23.11.00;	author schwarze;	state Exp;
branches;
next	1.17;

1.17
date	2009.05.24.22.25.12;	author schwarze;	state Exp;
branches;
next	1.16;

1.16
date	2009.05.20.22.46.48;	author schwarze;	state Exp;
branches;
next	1.15;

1.15
date	2009.05.17.21.50.02;	author schwarze;	state Exp;
branches;
next	1.14;

1.14
date	2008.04.17.19.49.16;	author sthen;	state Exp;
branches;
next	1.13;

1.13
date	2007.10.23.14.02.38;	author jmc;	state Exp;
branches;
next	1.12;

1.12
date	2007.05.31.19.19.59;	author jmc;	state Exp;
branches;
next	1.11;

1.11
date	2006.10.31.10.27.55;	author jmc;	state Exp;
branches;
next	1.10;

1.10
date	2005.01.06.00.00.38;	author jmc;	state Exp;
branches;
next	1.9;

1.9
date	2004.10.04.20.55.29;	author jmc;	state Exp;
branches;
next	1.8;

1.8
date	2004.10.04.20.44.20;	author jmc;	state Exp;
branches;
next	1.7;

1.7
date	2003.09.25.09.22.01;	author jmc;	state Exp;
branches;
next	1.6;

1.6
date	2003.06.06.19.28.06;	author jmc;	state Exp;
branches;
next	1.5;

1.5
date	2003.02.20.20.10.06;	author deraadt;	state Exp;
branches;
next	1.4;

1.4
date	2003.02.20.18.59.13;	author jmc;	state Exp;
branches;
next	1.3;

1.3
date	2001.06.27.21.19.22;	author pvalchev;	state Exp;
branches;
next	1.2;

1.2
date	2001.02.23.20.02.11;	author aaron;	state Exp;
branches;
next	1.1;

1.1
date	2001.01.28.03.52.44;	author d;	state Exp;
branches;
next	;


desc
@@


1.26
log
@man pages with pseudo synopses which list filenames end up creating
very ugly output in man -k; after some discussion with ingo, we feel
the simplest fix is to remove such SYNOPSIS sections: the info is hardly
helpful at page top, is contained already in FILES, and there are
sufficiently few that just zapping them is simple;

ok schwarze, who also helpfully ran things through a build to check
output;
@
text
@.\" $OpenBSD: security.8,v 1.25 2014/09/08 01:27:55 schwarze Exp $
.\"
.\" David Leonard, 2001. Public Domain.
.\"
.Dd $Mdocdate: September 8 2014 $
.Dt SECURITY 8
.Os
.Sh NAME
.Nm security
.Nd periodic system security check
.Sh DESCRIPTION
.Nm
is a command script that examines the system for some signs of security
weaknesses.
It is only a security aid and does not offer complete protection.
.Nm
is run by
.Xr daily 8 ,
which mails any output to root on a daily basis.
.Pp
The
.Nm
script carries out the following list of simple checks:
.Bl -bullet
.It
Check the
.Xr master.passwd 5
and
.Xr group 5
files for
syntax, empty passwords, partially closed accounts,
suspicious UIDs, suspicious GIDs, and duplicate entries.
.It
Check root's home directory and login environment for
insecure permissions, suspicious paths, and umask commands in the
dotfiles.
.It
Check for suspicious commands in
.Pa /etc/mail/aliases .
.It
Check for insecurities in
.Pa /etc/hosts.lpd .
.It
Check user
.Pa .rhosts
and
.Pa .shosts
files for open access.
.It
Check user home directory permissions.
.It
Check many user dotfile permissions.
.It
Check user mailbox permissions.
.It
Check NFS
.Xr exports 5
file for global export entries.
.It
Check for changes in setuid/setgid files and devices.
.It
Check disk ownership and permissions.
.It
Check for changes in the device file list.
.It
Check for permission changes in special files and system binaries listed in
.Pa /etc/mtree/special .
.Nm
also provides hooks for administrators to create their own lists.
These lists should be kept in
.Pa /etc/mtree/
and filenames must have the suffix
.Dq .secure .
The following example shows how to create such a list,
to protect the programs in
.Pa /bin :
.Bd -literal -offset 4n
# mtree -cx -p /bin -K sha256digest,type > /etc/mtree/bin.secure
# chown root:wheel /etc/mtree/bin.secure
# chmod 600 /etc/mtree/bin.secure
.Ed
.Pp
.Sy Note:
These checks do not provide complete protection against
Trojan horse binaries, as
the miscreant can modify the tree specification to match the replaced binary.
For details on really protecting yourself against modified binaries, see
.Xr mtree 8 .
.It
Check for changes in files listed in
.Pa /etc/changelist .
Files being created or deleted,
as well as content change in the files themselves,
are reported.
See
.Xr changelist 5
for further details.
.It
Check for changes to the disklabels of mounted disks.
.It
Report on the installation or removal of any system
.Xr package 5 .
.It
Check
.Xr hostname.if 5
file permissions.
.El
.Pp
The intent of the
.Nm
script is to point out some obvious holes to the system administrator.
.Sh ENVIRONMENT
The following variables can be set in
.Pa /etc/daily.local :
.Pp
.Bl -tag -width "SUIDSKIP" -compact
.It Ev SUIDSKIP
A whitespace-separated list of absolute paths to be skipped
in setuid/setgid file checks and in device special file checks.
Avoid trailing slashes.
.El
.Sh FILES
.Bl -tag -width /dev/changelist -compact
.It Pa /etc/changelist
.It Pa /etc/daily
.It Pa /etc/mtree
.It Pa /usr/libexec/security
.It Pa /var/backups
.El
.Sh SEE ALSO
.Xr changelist 5 ,
.Xr daily 8 ,
.Xr mtree 8
.Sh HISTORY
A
.Nm
shell script appeared in
.Bx 4.3 Reno ,
but most functionality only came with
.Bx 4.4 .
.Sh AUTHORS
.An -nosplit
The present manual was written by
.An David Leonard
for
.Ox 2.9 .
.An Andrew Fresh Aq Mt afresh1@@openbsd.org
and
.An Ingo Schwarze Aq Mt schwarze@@openbsd.org
rewrote
.Nm
from scratch in
.Xr perl 1
for
.Ox 5.0 .
.Sh BUGS
The name of this script may provide a false sense of
.Nm security .
.\" Well, I thought it was amusing.
.Pp
There are perhaps an infinite number of ways the system can be compromised
without this script noticing.
@


1.25
log
@obvious cases of missing .An;
found with the new mandoc(1) MANDOCERR_AN_MISSING warning;
no text changes
@
text
@d1 1
a1 1
.\" $OpenBSD: security.8,v 1.24 2014/04/22 16:58:20 tedu Exp $
d5 1
a5 1
.Dd $Mdocdate: April 22 2014 $
a10 2
.Sh SYNOPSIS
.Nm /usr/libexec/security
d127 1
@


1.24
log
@Trojan horse is still a noun. noted by fritjof
@
text
@d1 1
a1 1
.\" $OpenBSD: security.8,v 1.23 2014/04/20 22:15:49 ajacoutot Exp $
d5 1
a5 1
.Dd $Mdocdate: April 20 2014 $
d143 4
a146 1
The present manual was written by David Leonard for
d148 4
a151 1
Andrew Fresh and Ingo Schwarze rewrote
@


1.23
log
@check_hosts_equiv -> check_hosts_lpd
i.e. don't check for hosts.equiv anymore.

input/ok schwarze@@, ok sthen@@
@
text
@d1 1
a1 1
.\" $OpenBSD: security.8,v 1.22 2014/03/23 22:08:59 sthen Exp $
d5 1
a5 1
.Dd $Mdocdate: March 23 2014 $
d87 1
a87 1
Trojan horsed binaries, as
@


1.22
log
@security doesn't check ftpusers any more; reminded by jmc
@
text
@d1 1
a1 1
.\" $OpenBSD: security.8,v 1.21 2012/07/08 21:48:38 schwarze Exp $
d5 1
a5 1
.Dd $Mdocdate: July 8 2012 $
d43 1
a43 3
Check for insecurities in various trust files such as
.Pa /etc/hosts.equiv , /etc/shosts.equiv ,
and
@


1.21
log
@To detect changes of system files, use SHA-256 rather than MD5,
taking advantage of naddy@@'s recent mtree(8) modernization.
While here, do not provide an example protecting a home directory
from file changes; protect some system binaries instead.
ok naddy@@ jmc@@
@
text
@d1 1
a1 1
.\" $OpenBSD: security.8,v 1.20 2011/04/19 05:17:24 jmc Exp $
d5 1
a5 1
.Dd $Mdocdate: April 19 2011 $
a38 3
.It
Check that root and uucp are in
.Pa /etc/ftpusers .
@


1.20
log
@zap trailing whitespace;
@
text
@d1 1
a1 1
.\" $OpenBSD: security.8,v 1.19 2011/04/18 23:58:45 schwarze Exp $
d5 1
a5 1
.Dd $Mdocdate: April 18 2011 $
d82 2
a83 2
to protect the home directory of user
.Dq bob :
d85 3
a87 3
# mtree -cx -p /home/bob -K md5digest,type \*(Gt/etc/mtree/bob.secure
# chown root:wheel /etc/mtree/bob.secure
# chmod 600 /etc/mtree/bob.secure
@


1.19
log
@Adjust after removal of /etc/security to /usr/libexec.
More HISTORY.
Using feedback from jmc@@.
"I think that is correct.
 If it isn't, someone out there will eventually moan :)" deraadt@@
@
text
@d1 1
a1 1
.\" $OpenBSD: security.8,v 1.18 2009/12/25 23:11:00 schwarze Exp $
d5 1
a5 1
.Dd $Mdocdate: December 25 2009 $
d141 1
a141 1
A 
@


1.18
log
@be nice by documenting a rather non-obvious trap:
as SUIDSKIP internally relies on find(1) -path,
it won't work with trailing slashes.

found the hard way by paul de weerd@@
ok jmc@@
@
text
@d1 1
a1 1
.\" $OpenBSD: security.8,v 1.17 2009/05/24 22:25:12 schwarze Exp $
d5 1
a5 1
.Dd $Mdocdate: May 24 2009 $
d12 1
a12 1
.Nm /etc/security
d140 16
@


1.17
log
@new variable SUIDSKIP to exclude paths from setuid and device checks,
useful for example for release(8) DESTDIRs, ro-mounted foreign OS
partitions, nosuid+nodev-mounted backup areas and the like
while here, do not call ls w/o args in case find returns nothing
based on a patch from halex@@, re-implemented by me; variable naming by jmc@@
ok halex@@ jmc@@
@
text
@d1 1
a1 1
.\" $OpenBSD: security.8,v 1.16 2009/05/20 22:46:48 schwarze Exp $
d5 1
a5 1
.Dd $Mdocdate: May 20 2009 $
d127 1
@


1.16
log
@make previous shorter, simpler and nicer; from jmc@@
@
text
@d1 1
a1 1
.\" $OpenBSD: security.8,v 1.15 2009/05/17 21:50:02 schwarze Exp $
d5 1
a5 1
.Dd $Mdocdate: May 17 2009 $
d119 9
@


1.15
log
@security now uses the new infrastructure from daily
reminded by and ok okan@@, and using feedback from jmc@@
@
text
@d1 1
a1 1
.\" $OpenBSD: security.8,v 1.14 2008/04/17 19:49:16 sthen Exp $
d5 1
a5 1
.Dd $Mdocdate: April 17 2008 $
a17 1
The
d19 3
a21 5
script must be run from the
.Pa /etc/daily
script (see
.Xr daily 8
for further details), which mails any output to root on a daily basis.
@


1.14
log
@Teach security(8) to check for world-readable hostname.if files.
An increasing number of types of these files (e.g. ppp, carp and
wlan adapters) may contain secrets.

ok deraadt oga johan
@
text
@d1 1
a1 1
.\" $OpenBSD: security.8,v 1.13 2007/10/23 14:02:38 jmc Exp $
d5 1
a5 1
.Dd $Mdocdate: October 23 2007 $
d20 1
a20 1
script is normally run from the
d24 1
a24 1
for further details), which sends mails to root on a daily basis.
@


1.13
log
@security(8) now picks up on package installation/removal;
apologies stuart for not providing a diff when your diff was shown
@
text
@d1 1
a1 1
.\" $OpenBSD: security.8,v 1.12 2007/05/31 19:19:59 jmc Exp $
d5 1
a5 1
.Dd $Mdocdate$
d113 4
@


1.12
log
@convert to new .Dd format;
@
text
@d1 1
a1 1
.\" $OpenBSD: security.8,v 1.11 2006/10/31 10:27:55 jmc Exp $
d110 3
@


1.11
log
@note that additions/removals of files in changelist will be reported too;
ok dlg
@
text
@d1 1
a1 1
.\" $OpenBSD: security.8,v 1.10 2005/01/06 00:00:38 jmc Exp $
d5 1
a5 1
.Dd July 1, 2000
@


1.10
log
@- document /etc/security's .secure hooks
- sync the comments in /etc/security

ok millert@@
@
text
@d1 1
a1 1
.\" $OpenBSD: security.8,v 1.9 2004/10/04 20:55:29 jmc Exp $
d100 1
a100 1
Check for content changes in those files specified by
d102 3
@


1.9
log
@master\n.Xr passwd 5 -> .Xr master.passwd 5
@
text
@d1 1
a1 1
.\" $OpenBSD: security.8,v 1.8 2004/10/04 20:44:20 jmc Exp $
d77 16
a92 3
.Pa /etc/mtree/special
and
.Pa "/etc/mtree/*.secure" .
d94 2
a95 1
This is not complete protection against Trojan horsed binaries, as
@


1.8
log
@document that /etc/security checks disklabels for changes;
from alexander taler (pr #3943);
@
text
@d1 1
a1 1
.\" $OpenBSD: security.8,v 1.7 2003/09/25 09:22:01 jmc Exp $
d31 2
a32 2
Check the master
.Xr passwd 5
@


1.7
log
@.Xr daily(8) and changelist(5);
@
text
@d1 1
a1 1
.\" $OpenBSD: security.8,v 1.6 2003/06/06 19:28:06 jmc Exp $
d91 2
@


1.6
log
@- section reorder
- macro fixes
- kill whitespace at EOL
@
text
@d1 1
a1 1
.\" $OpenBSD: security.8,v 1.5 2003/02/20 20:10:06 deraadt Exp $
d22 3
a24 1
script, which sends mails to root on a daily basis.
d88 3
d98 1
a100 1
.It Pa /etc/changelist
d104 2
@


1.5
log
@bad jmc, did not nroff?
@
text
@d1 2
a2 2
.\" $OpenBSD: security.8,v 1.4 2003/02/20 18:59:13 jmc Exp $
.\" 
@


1.4
log
@copyrights added;

these are all David Leonard, and Public Domain
ok deraadt@@
@
text
@d1 4
a4 4
.\" $OpenBSD: security.8,v 1.3 2001/06/27 21:19:22 pvalchev Exp $
+.\" 
+.\" David Leonard, 2001. Public Domain.
+.\"
@


1.3
log
@spelling/grammer fixes; jsyn@@nthought.com
@
text
@d1 4
a4 1
.\" $OpenBSD: security.8,v 1.2 2001/02/23 20:02:11 aaron Exp $
@


1.2
log
@Minor fixes.
@
text
@d1 1
a1 1
.\" $OpenBSD: security.8,v 1.1 2001/01/28 03:52:44 d Exp $
d71 1
a71 1
Check for permssion changes in special files and system binaries listed in
@


1.1
log
@a start for security(8)
@
text
@d1 1
a1 1
.\" $OpenBSD$
d11 1
a11 1
.Nm security
d16 1
a16 1
.Nm security
d22 1
a22 1
.Nm security
d32 1
a32 1
suspicious UIDs, GIDs and duplicate entries
d35 2
a36 2
insecure permissions, suspicious paths and umask commands in the
dotfiles
d39 1
a39 1
.Pa /etc/ftpusers
d42 1
a42 1
.Pa /etc/mail/aliases
d47 1
a47 1
.Pa /etc/hosts.lpd
d50 4
a53 2
.Pa .rhosts , .shosts
files for open access
d55 1
a55 1
Check user home directory permissions
d57 1
a57 1
Check many user dotfile permissions
d59 1
a59 1
Check user mailbox permissions
d63 1
a63 1
file for global export entries
d65 1
a65 1
Check for changes in setuid/setgid files and devices
d67 1
a67 1
Check disk ownership and permissions
d69 1
a69 1
Check for changes in the device file list
d82 1
a82 1
.Pa /etc/changelist
d86 1
a86 1
.Nm security
d88 9
a103 7
.Sh FILES
.Pa /etc/daily ,
.Pa /etc/mtree ,
.Pa /etc/changelist ,
.Pa /var/backups
.Sh SEE ALSO
.Xr mtree 8
@

