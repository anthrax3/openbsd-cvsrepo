head	1.88;
access;
symbols
	OPENBSD_6_1:1.86.0.4
	OPENBSD_6_1_BASE:1.86
	OPENBSD_6_0:1.74.0.2
	OPENBSD_6_0_BASE:1.74
	OPENBSD_5_9:1.72.0.2
	OPENBSD_5_9_BASE:1.72
	OPENBSD_5_8:1.70.0.4
	OPENBSD_5_8_BASE:1.70
	OPENBSD_5_7:1.68.0.2
	OPENBSD_5_7_BASE:1.68
	OPENBSD_5_6:1.68.0.4
	OPENBSD_5_6_BASE:1.68
	OPENBSD_5_5:1.67.0.4
	OPENBSD_5_5_BASE:1.67
	OPENBSD_5_4:1.66.0.4
	OPENBSD_5_4_BASE:1.66
	OPENBSD_5_3:1.66.0.2
	OPENBSD_5_3_BASE:1.66
	OPENBSD_5_2:1.64.0.6
	OPENBSD_5_2_BASE:1.64
	OPENBSD_5_1_BASE:1.64
	OPENBSD_5_1:1.64.0.4
	OPENBSD_5_0:1.64.0.2
	OPENBSD_5_0_BASE:1.64
	OPENBSD_4_9:1.62.0.2
	OPENBSD_4_9_BASE:1.62
	OPENBSD_4_8:1.61.0.6
	OPENBSD_4_8_BASE:1.61
	OPENBSD_4_7:1.61.0.2
	OPENBSD_4_7_BASE:1.61
	OPENBSD_4_6:1.61.0.4
	OPENBSD_4_6_BASE:1.61
	OPENBSD_4_5:1.59.0.2
	OPENBSD_4_5_BASE:1.59
	OPENBSD_4_4:1.55.0.2
	OPENBSD_4_4_BASE:1.55
	OPENBSD_4_3:1.52.0.2
	OPENBSD_4_3_BASE:1.52
	OPENBSD_4_2:1.51.0.2
	OPENBSD_4_2_BASE:1.51
	OPENBSD_4_1:1.45.0.6
	OPENBSD_4_1_BASE:1.45
	OPENBSD_4_0:1.45.0.4
	OPENBSD_4_0_BASE:1.45
	OPENBSD_3_9:1.45.0.2
	OPENBSD_3_9_BASE:1.45
	OPENBSD_3_8:1.41.0.2
	OPENBSD_3_8_BASE:1.41
	OPENBSD_3_7:1.35.0.2
	OPENBSD_3_7_BASE:1.35
	OPENBSD_3_6:1.34.0.4
	OPENBSD_3_6_BASE:1.34
	OPENBSD_3_5:1.34.0.2
	OPENBSD_3_5_BASE:1.34
	OPENBSD_3_4:1.32.0.2
	OPENBSD_3_4_BASE:1.32
	OPENBSD_3_3:1.27.0.2
	OPENBSD_3_3_BASE:1.27
	OPENBSD_3_2:1.22.0.4
	OPENBSD_3_2_BASE:1.22
	OPENBSD_3_1:1.22.0.2
	OPENBSD_3_1_BASE:1.22
	OPENBSD_3_0:1.19.0.2
	OPENBSD_3_0_BASE:1.19
	OPENBSD_2_9:1.14.0.2
	OPENBSD_2_9_BASE:1.14
	OPENBSD_2_8:1.11.0.2
	OPENBSD_2_8_BASE:1.11;
locks; strict;
comment	@.\" @;


1.88
date	2017.04.18.16.21.06;	author jmc;	state Exp;
branches;
next	1.87;
commitid	M1UhW2NSkaOpqlBy;

1.87
date	2017.04.18.13.21.36;	author tb;	state Exp;
branches;
next	1.86;
commitid	l6v7uCQ3T1XTbd9P;

1.86
date	2017.01.24.14.08.53;	author tb;	state Exp;
branches;
next	1.85;
commitid	PpbUgQclyGbxRVw8;

1.85
date	2017.01.22.03.40.43;	author rpe;	state Exp;
branches;
next	1.84;
commitid	5KH6l1p45u5rpkap;

1.84
date	2017.01.21.08.50.58;	author tb;	state Exp;
branches;
next	1.83;
commitid	Gp39AGhmKc5GbawW;

1.83
date	2017.01.01.01.08.11;	author tb;	state Exp;
branches;
next	1.82;
commitid	wnNuSAo7K6MoaRxC;

1.82
date	2016.11.27.16.49.17;	author tb;	state Exp;
branches;
next	1.81;
commitid	VpDSBE3A37GNcUqw;

1.81
date	2016.11.26.18.07.44;	author tb;	state Exp;
branches;
next	1.80;
commitid	WX5O3EjrRcllAvhU;

1.80
date	2016.11.23.20.34.48;	author tb;	state Exp;
branches;
next	1.79;
commitid	5H9eSOh1rS9LMP0g;

1.79
date	2016.11.19.23.31.28;	author tb;	state Exp;
branches;
next	1.78;
commitid	HmuO0Rcv4481NKOZ;

1.78
date	2016.11.19.14.25.15;	author tb;	state Exp;
branches;
next	1.77;
commitid	k7fARFry0wDWGX27;

1.77
date	2016.10.31.20.45.14;	author tb;	state Exp;
branches;
next	1.76;
commitid	znBbAGIghyu0Qpsy;

1.76
date	2016.10.05.09.12.13;	author tb;	state Exp;
branches;
next	1.75;
commitid	2KvZxlDbFvQ2ANM0;

1.75
date	2016.09.02.12.17.33;	author tb;	state Exp;
branches;
next	1.74;
commitid	Z6hUPnAcS0GtAGum;

1.74
date	2016.07.23.00.10.15;	author jmc;	state Exp;
branches;
next	1.73;
commitid	Frq3H96Pojc4SoSQ;

1.73
date	2016.06.26.15.17.43;	author tb;	state Exp;
branches;
next	1.72;
commitid	HdMlEHRSK3QPvNHN;

1.72
date	2015.09.14.20.06.59;	author schwarze;	state Exp;
branches;
next	1.71;
commitid	r87YNrjEWwl7OkJ0;

1.71
date	2015.09.10.15.16.43;	author schwarze;	state Exp;
branches;
next	1.70;
commitid	yPhLfPulVSum2r0H;

1.70
date	2015.07.31.11.30.12;	author tedu;	state Exp;
branches;
next	1.69;
commitid	7EyQApmcgI9sDqjk;

1.69
date	2015.07.30.08.03.50;	author jmc;	state Exp;
branches;
next	1.68;
commitid	jvvdSOl8gxNBg4aJ;

1.68
date	2014.04.06.12.15.26;	author millert;	state Exp;
branches;
next	1.67;

1.67
date	2013.11.26.17.53.22;	author sthen;	state Exp;
branches;
next	1.66;

1.66
date	2012.09.02.13.47.25;	author rpe;	state Exp;
branches;
next	1.65;

1.65
date	2012.08.12.17.01.35;	author schwarze;	state Exp;
branches;
next	1.64;

1.64
date	2011.04.18.16.52.12;	author thib;	state Exp;
branches;
next	1.63;

1.63
date	2011.04.15.05.17.44;	author ajacoutot;	state Exp;
branches;
next	1.62;

1.62
date	2011.01.04.19.19.04;	author deraadt;	state Exp;
branches;
next	1.61;

1.61
date	2009.04.25.15.08.50;	author ajacoutot;	state Exp;
branches;
next	1.60;

1.60
date	2009.04.08.15.59.53;	author stsp;	state Exp;
branches;
next	1.59;

1.59
date	2009.02.18.01.47.01;	author ian;	state Exp;
branches;
next	1.58;

1.58
date	2008.10.16.16.22.10;	author jmc;	state Exp;
branches;
next	1.57;

1.57
date	2008.10.05.19.23.05;	author matthieu;	state Exp;
branches;
next	1.56;

1.56
date	2008.08.23.07.05.40;	author jmc;	state Exp;
branches;
next	1.55;

1.55
date	2008.06.22.20.54.51;	author ajacoutot;	state Exp;
branches;
next	1.54;

1.54
date	2008.04.23.18.50.24;	author jmc;	state Exp;
branches;
next	1.53;

1.53
date	2008.04.08.14.59.07;	author jmc;	state Exp;
branches;
next	1.52;

1.52
date	2008.03.03.07.02.28;	author matthieu;	state Exp;
branches;
next	1.51;

1.51
date	2007.05.31.19.19.59;	author jmc;	state Exp;
branches;
next	1.50;

1.50
date	2007.05.28.17.37.57;	author matthieu;	state Exp;
branches;
next	1.49;

1.49
date	2007.05.17.15.34.13;	author kili;	state Exp;
branches;
next	1.48;

1.48
date	2007.04.23.08.51.30;	author ajacoutot;	state Exp;
branches;
next	1.47;

1.47
date	2007.04.01.10.02.35;	author matthieu;	state Exp;
branches;
next	1.46;

1.46
date	2007.03.26.12.10.49;	author matthieu;	state Exp;
branches;
next	1.45;

1.45
date	2006.02.04.09.28.59;	author jmc;	state Exp;
branches;
next	1.44;

1.44
date	2006.01.09.09.56.24;	author jmc;	state Exp;
branches;
next	1.43;

1.43
date	2005.09.22.14.20.15;	author jmc;	state Exp;
branches;
next	1.42;

1.42
date	2005.09.12.21.30.23;	author jmc;	state Exp;
branches;
next	1.41;

1.41
date	2005.08.18.15.45.46;	author jmc;	state Exp;
branches;
next	1.40;

1.40
date	2005.08.18.14.21.03;	author jmc;	state Exp;
branches;
next	1.39;

1.39
date	2005.08.18.14.18.55;	author jmc;	state Exp;
branches;
next	1.38;

1.38
date	2005.08.06.23.07.13;	author aanriot;	state Exp;
branches;
next	1.37;

1.37
date	2005.04.27.11.52.45;	author jmc;	state Exp;
branches;
next	1.36;

1.36
date	2005.04.08.02.24.26;	author henning;	state Exp;
branches;
next	1.35;

1.35
date	2005.01.31.10.32.18;	author jmc;	state Exp;
branches;
next	1.34;

1.34
date	2004.02.22.09.20.38;	author matthieu;	state Exp;
branches;
next	1.33;

1.33
date	2003.12.30.08.28.00;	author matthieu;	state Exp;
branches;
next	1.32;

1.32
date	2003.07.10.08.30.36;	author jmc;	state Exp;
branches;
next	1.31;

1.31
date	2003.05.13.18.46.50;	author jmc;	state Exp;
branches;
next	1.30;

1.30
date	2003.04.17.18.36.49;	author millert;	state Exp;
branches;
next	1.29;

1.29
date	2003.04.16.01.04.02;	author millert;	state Exp;
branches;
next	1.28;

1.28
date	2003.04.10.16.31.02;	author millert;	state Exp;
branches;
next	1.27;

1.27
date	2003.03.20.19.33.11;	author millert;	state Exp;
branches;
next	1.26;

1.26
date	2003.03.20.18.37.42;	author millert;	state Exp;
branches;
next	1.25;

1.25
date	2003.02.20.00.57.07;	author avsm;	state Exp;
branches;
next	1.24;

1.24
date	2003.02.11.07.26.20;	author jmc;	state Exp;
branches;
next	1.23;

1.23
date	2003.01.16.17.40.02;	author millert;	state Exp;
branches;
next	1.22;

1.22
date	2002.01.04.15.53.44;	author deraadt;	state Exp;
branches;
next	1.21;

1.21
date	2002.01.04.15.43.57;	author deraadt;	state Exp;
branches;
next	1.20;

1.20
date	2001.12.25.01.37.29;	author miod;	state Exp;
branches;
next	1.19;

1.19
date	2001.10.05.14.45.54;	author mpech;	state Exp;
branches;
next	1.18;

1.18
date	2001.10.04.16.56.52;	author mpech;	state Exp;
branches;
next	1.17;

1.17
date	2001.09.18.03.59.16;	author marc;	state Exp;
branches;
next	1.16;

1.16
date	2001.07.27.20.29.19;	author krw;	state Exp;
branches;
next	1.15;

1.15
date	2001.07.27.17.45.35;	author krw;	state Exp;
branches;
next	1.14;

1.14
date	2001.04.24.19.20.35;	author todd;	state Exp;
branches;
next	1.13;

1.13
date	2001.02.01.02.24.00;	author todd;	state Exp;
branches;
next	1.12;

1.12
date	2000.12.17.00.39.26;	author marc;	state Exp;
branches;
next	1.11;

1.11
date	2000.10.21.23.25.36;	author marc;	state Exp;
branches;
next	1.10;

1.10
date	2000.09.27.00.24.25;	author marc;	state Exp;
branches;
next	1.9;

1.9
date	2000.08.03.13.45.23;	author brad;	state Exp;
branches;
next	1.8;

1.8
date	2000.07.22.20.23.28;	author brad;	state Exp;
branches;
next	1.7;

1.7
date	2000.07.22.12.32.57;	author aaron;	state Exp;
branches;
next	1.6;

1.6
date	2000.07.12.23.18.16;	author marc;	state Exp;
branches;
next	1.5;

1.5
date	2000.07.11.17.04.27;	author aaron;	state Exp;
branches;
next	1.4;

1.4
date	2000.07.07.18.40.01;	author deraadt;	state Exp;
branches;
next	1.3;

1.3
date	2000.07.07.18.30.48;	author espie;	state Exp;
branches;
next	1.2;

1.2
date	2000.07.07.18.13.26;	author marc;	state Exp;
branches;
next	1.1;

1.1
date	2000.07.07.18.00.58;	author marc;	state Exp;
branches;
next	;


desc
@@


1.88
log
@spelling fix;
@
text
@.\"	$OpenBSD: release.8,v 1.87 2017/04/18 13:21:36 tb Exp $
.\"
.\"	Copyright (c) 2000 Marco S. Hyman
.\"	Copyright (c) 2016 Theo Buehler <tb@@openbsd.org>
.\"
.\"	Permission to copy all or part of this material for any purpose is
.\"	granted provided that the above copyright notice and this paragraph
.\"	are duplicated in all copies.  THIS SOFTWARE IS PROVIDED ``AS IS''
.\"	AND WITHOUT ANY EXPRESS OR IMPLIED WARRANTIES, INCLUDING, WITHOUT
.\"	LIMITATION, THE IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS
.\"	FOR A PARTICULAR PURPOSE.
.\"
.Dd $Mdocdate: April 18 2017 $
.Dt RELEASE 8
.Os
.Sh NAME
.Nm release
.Nd building an OpenBSD release
.Sh DESCRIPTION
There are several steps necessary to build a release:
.Pp
.Bl -enum -compact -offset indent
.It
Update sources.
.It
Build and install a new kernel.
.It
Build a new base system.
.It
Make and validate the base system release.
.It
Build and install Xenocara.
.It
Make and validate the Xenocara release.
.It
Make the third party packages.
.It
Create boot and installation disk images.
.El
.Pp
This manual describes the steps for the
.Em release
and
.Em stable
branches.
To build a
.Em current
release, additional steps may be required.
See
.Lk https://www.openbsd.org/faq/current.html
for any needed workarounds.
.Pp
Commands to be run as a user are preceded by a dollar sign
.Sq $ .
Commands that must be run as the superuser are preceded by a hash mark
.Sq # .
Privileges will be de-escalated to the user
.Sy build
whenever possible.
.Pp
Most of the defaults can be overridden by setting
the appropriate variables in
.Xr mk.conf 5 .
.Ss 1. Update sources
A
.Nm
should use sources that were checked out using the same
.Xr cvs 1
tag.
There are two families of tags:
.Bl -tag -width OPENBSD_x_y_BASE
.It OPENBSD_x_y_BASE
The sources for the
.Ox x.y
release.
.It OPENBSD_x_y
The sources for the
.Ox x.y
stable branch.
It contains the patches described in
.Lk https://www.openbsd.org/stable.html .
.El
.Pp
See
.Lk https://www.openbsd.org/anoncvs.html
for instructions on fetching the sources for the first time.
.Pp
To update existing sources to the versions identified by one of the above
tags, use the commands:
.Bd -literal -offset indent
$ cd /usr/src && cvs up -r TAG -Pd
$ cd /usr/xenocara && cvs up -r TAG -Pd
$ cd /usr/ports && cvs up -r TAG -Pd
.Ed
.Pp
.Sy Warning :
.Xr cvs 1
tags are
.Sq sticky .
See
.Xr cvs 1
for more information.
.Ss 2. Build and install a new kernel
Always build and install a new kernel and reboot before
building the programs that will use the kernel.
This ensures that any new system calls, for example, will be present
when needed.
.Pp
.Dl # cd /sys/arch/$(machine)/compile/GENERIC.MP
.Pp
Replace
.Pa GENERIC.MP
with a different kernel configuration if necessary.
.Pp
Create the build directory and configuration file,
then compile and install the kernel:
.Bd -literal -offset indent
# make obj
# make config
# make && make install
.Ed
.Pp
The current kernel is copied to
.Pa /obsd
and the new kernel to
.Pa /bsd .
Reboot.
.Ss 3. Build a new base system
The build process will place the object files in a tree under
.Pa /usr/obj .
This directory must be owned by build:wobj with mode 770.
.Pp
The first time, the
.Pa /usr/obj
directory
.Em must be
cleaned out completely before proceeding to avoid permission issues.
After a successful
.Nm
build, this is no longer needed.
.Pp
Create the tree of obj directories and begin the build:
.Bd -literal -offset indent
# cd /usr/src
# make obj && make build
.Ed
.Pp
After the build is completed, update
.Pa /etc ,
.Pa /var ,
and
.Pa /dev ,
using
.Xr sysmerge 8
and
.Xr MAKEDEV 8 .
.Pp
At this point, the base system is up to date and running the code
that will be made into a release.
.Ss 4. Make and validate the base system release
The base system release consists of at least one generic kernel,
some installation media, the release tarballs,
installation instructions, and checksum files.
.Pp
Create a
.Va RELEASEDIR
directory to store the release files.
This directory must be writable by
.Sy build .
.Pp
To build a release, it is necessary to prepare a filesystem mounted with the
.Em noperm
.Xr mount 8
option.
The root of this filesystem must have owner
.Sy build
and mode 700.
On this filesystem, create a
.Va DESTDIR
directory.
This will be the root of a complete
.Ox
installation.
.Pp
.Sy Warning :
.Va DESTDIR
and
.Va RELEASEDIR
must not refer to any directory with
.Pa /mnt
in its path, as
.Pa /mnt
is used in the release generation process.
The
.Xr vnd 4
device vnd0
is also used and must not be configured.
.Pp
Make the release and check the contents of the release tarballs:
.Bd -literal -offset indent
# export DESTDIR=your-destdir; export RELEASEDIR=your-releasedir
# cd /usr/src/etc && make release
# cd /usr/src/distrib/sets && sh checkflist
# unset RELEASEDIR DESTDIR
.Ed
.Ss 5. Build and install Xenocara
Xenocara is based on the X.Org modular build system.
Its sources are supposed to be in
.Pa /usr/xenocara .
The
.Pa /usr/src
tree is also needed while building Xenocara.
The object directory
.Pa /usr/xobj
should be empty and owned by build:wobj with mode 770.
.Pp
The following steps will build and install Xenocara.
.Bd -literal -offset indent
# cd /usr/xenocara
# make bootstrap
# make obj
# make build
.Ed
.Ss 6. Make and validate the Xenocara release
Xenocara uses
.Va DESTDIR
and
.Va RELEASEDIR
as described above.
Use a different
.Va DESTDIR
for the Xenocara release than for the base release,
as the contents of
.Va DESTDIR
will be removed.
.Pp
The steps to build and validate the Xenocara release are:
.Bd -literal -offset indent
# export DESTDIR=your-destdir; export RELEASEDIR=your-releasedir
# make release
# make checkdist
# unset RELEASEDIR DESTDIR
.Ed
.Pp
At this point,
.Ox
base system and X Window System tarballs are in
.Va RELEASEDIR .
.Ss 7. Make the third party packages
The ports subsystem of contributed applications is capable of producing
packages for installation, either individually or in bulk.
This is described in
.Xr ports 7 .
.Ss 8. Create boot and installation disk images
The disk images
.No install${ Ns Va VERSION Ns }.fs
and
.No install${ Ns Va VERSION Ns }.iso
are suitable for installs without network connectivity.
They contain the tarballs and ports built in the previous steps.
.Bd -literal -offset indent
# export RELDIR=your-releasedir
# export RELXDIR=your-xenocara-releasedir
# cd /usr/src/distrib/$(machine)/iso && make
# make install
.Ed
.Pp
The two installer images are now stored in the local release
directory.
.Sh SEE ALSO
.Xr cvs 1 ,
.Xr pkg_add 1 ,
.Xr mk.conf 5 ,
.Xr ports 7 ,
.Xr sysmerge 8
.Sh HISTORY
This document first appeared in
.Ox 2.8 .
@


1.87
log
@Cleaning out /usr/obj is necessary the first time due to permission issues.
Make this more clearly visible and also state explicitly that this is no
longer necessary after completing a full release build.

ok deraadt
@
text
@d1 1
a1 1
.\"	$OpenBSD: release.8,v 1.86 2017/01/24 14:08:53 tb Exp $
d13 1
a13 1
.Dd $Mdocdate: January 24 2017 $
d138 1
a138 1
After a succesful
@


1.86
log
@Remove some superfluous words and convert Ar VERSION into Va VERSION.
@
text
@d1 1
a1 1
.\"	$OpenBSD: release.8,v 1.85 2017/01/22 03:40:43 rpe Exp $
d13 1
a13 1
.Dd $Mdocdate: January 22 2017 $
d131 10
a140 1
This directory should be empty and owned by build:wobj with mode 770.
@


1.85
log
@system release -> release
system -> base system
xenocara -> Xenocara
permissions 770 -> mode 770

Discussed with and OK tb@@
Xenocara change OK matthieu@@
@
text
@d1 1
a1 1
.\"	$OpenBSD: release.8,v 1.84 2017/01/21 08:50:58 tb Exp $
d13 1
a13 1
.Dd $Mdocdate: January 21 2017 $
d73 1
a73 1
This tag marks the source for the
d77 3
a79 1
This tag marks the sources that belong to the stable branch.
a214 3
.Pp
The X Window System is created and installed in
.Pa /usr/X11R6 .
d247 1
a247 1
.No install${ Ns Ar VERSION Ns }.fs
d249 1
a249 1
.No install${ Ns Ar VERSION Ns }.iso
@


1.84
log
@Add my copyright.
@
text
@d1 1
a1 1
.\"	$OpenBSD: release.8,v 1.83 2017/01/01 01:08:11 tb Exp $
d13 1
a13 1
.Dd $Mdocdate: January 1 2017 $
d20 1
a20 1
There are several steps necessary to build a system release:
d28 1
a28 1
Build a new system.
d30 1
a30 1
Make and validate the system release.
d32 1
a32 1
Build and install xenocara.
d34 1
a34 1
Make and validate the xenocara release.
d126 1
a126 1
.Ss 3. Build a new system
d147 4
a150 4
At this point, the system is up to date and running the code that will be
made into a release.
.Ss 4. Make and validate the system release
The system release consists of at least one generic kernel,
d195 1
a195 1
.Ss 5. Build and install xenocara
d201 1
a201 1
tree is also needed while building xenocara.
d204 1
a204 1
should be empty and owned by build:wobj with permissions 770.
d206 1
a206 1
The following steps will build and install xenocara.
d216 1
a216 1
.Ss 6. Make and validate the xenocara release
d224 1
a224 1
for the xenocara release than for the base release,
d229 1
a229 1
The steps to build and validate the xenocara release are:
d239 1
a239 1
system and X Window System tarballs are in
@


1.83
log
@Hyphenate compound adjectives 'up-to-date', 'out-of-date' and 'well-known'
if they precede the noun and omit hyphens otherwise.

ok tj
@
text
@d1 1
a1 1
.\"	$OpenBSD: release.8,v 1.82 2016/11/27 16:49:17 tb Exp $
d4 1
d13 1
a13 1
.Dd $Mdocdate: November 27 2016 $
@


1.82
log
@Remove some more verbiage.

looks alright to tj
@
text
@d1 1
a1 1
.\"	$OpenBSD: release.8,v 1.81 2016/11/26 18:07:44 tb Exp $
d12 1
a12 1
.Dd $Mdocdate: November 26 2016 $
d146 1
a146 1
At this point, the system is up-to-date and running the code that will be
@


1.81
log
@Tighten some sentences.

help & ok tj
@
text
@d1 1
a1 1
.\"	$OpenBSD: release.8,v 1.80 2016/11/23 20:34:48 tb Exp $
d12 1
a12 1
.Dd $Mdocdate: November 23 2016 $
d19 1
a19 2
There are several steps necessary to build a system release.
They are:
d40 1
a40 2
The following sections describe each of the required steps
for the
d66 1
a66 5
should always start from a known set of
.Em coherent
sources.
The easiest way to ensure that the sources are complete and coherent
is to check them out using the appropriate
d76 2
a77 3
This tag is a moving target.
It marks the sources that belong to the stable branch and
contains the patches described in
d187 1
a187 3
Make the release and check that the contents of
.Va DESTDIR
match the contents of the release tarballs:
d246 1
a246 7
At this point,
.Va RELEASEDIR
contains the
.Ox
tarballs necessary to upgrade.
.Pp
The following steps will create the boot and installation images
d250 2
a251 3
suitable for installs without network connectivity.
These images contain the tarballs and ports built in the previous
steps.
@


1.80
log
@Clean up some abuse of the .Va macro to achieve a visual effect: omit it or
replace it with more appropriate macros where possible or necessary.

input & ok schwarze
@
text
@d1 1
a1 1
.\"	$OpenBSD: release.8,v 1.79 2016/11/19 23:31:28 tb Exp $
d12 1
a12 1
.Dd $Mdocdate: November 19 2016 $
d214 1
a214 1
The following steps will build and install everything for the first time.
d230 1
a230 2
While they may be set to the values used to build the rest of the
system, be aware that the existing contents of
d232 4
a235 2
will be removed as part of the xenocara build (this is necessary for
release checklist processing).
d237 1
a237 1
The steps to build the release are:
d241 1
@


1.79
log
@Add that RELEASEDIR must be writable by the build user.

ok tj
@
text
@d1 1
a1 1
.\"	$OpenBSD: release.8,v 1.78 2016/11/19 14:25:15 tb Exp $
d77 1
a77 1
.It Va OPENBSD_x_y_BASE
d81 1
a81 1
.It Va OPENBSD_x_y
d116 1
a116 1
.Va GENERIC.MP
d204 2
a205 3
.Va Xenocara
is based on the X.Org modular build system.
Xenocara sources are supposed to be in
d225 1
a225 2
.Va xenocara
uses
@


1.78
log
@Update for builds with a dedicated build user.  Eliminate some more
customization variables and refer to mk.conf(5) instead.

input & ok tj
@
text
@d1 1
a1 1
.\"	$OpenBSD: release.8,v 1.77 2016/10/31 20:45:14 tb Exp $
d12 1
a12 1
.Dd $Mdocdate: October 31 2016 $
d163 2
@


1.77
log
@Update to reflect the changes necessary for noperm releases.  Trim some
more fat and avoid introducing unnecessary variables.

with & ok tj, ok deraadt, prodded by robert
@
text
@d1 1
a1 1
.\"	$OpenBSD: release.8,v 1.76 2016/10/05 09:12:13 tb Exp $
d12 1
a12 1
.Dd $Mdocdate: October 5 2016 $
d58 2
a59 6
Privileges will be de-escalated to
.Ev USER
or the
.Va BUILDUSER
specified in
.Xr mk.conf 5
d61 4
d96 2
a97 2
$ cd XSRCDIR && cvs up -r TAG -Pd
$ cd PORTSDIR && cvs up -r TAG -Pd
a99 9
Here,
.Va XSRCDIR
and
.Va PORTSDIR
are the path to the X Window System and ports tree sources, typically
.Pa /usr/xenocara
and
.Pa /usr/ports .
.Pp
d134 3
a136 2
.Pa /usr/obj ,
which is assumed to be empty.
d169 1
a169 1
.Va BUILDUSER
a204 2
.Va XSRCDIR
which defaults to
a205 3
This variable should be set in
.Xr mk.conf 5
if a non-default value is used.
d209 4
d215 1
a215 1
# cd XSRCDIR
@


1.76
log
@Overhaul the release(8) manual: the current version prompted some users
to leave their boxes wide open with ... unfortunate doas.conf(5) rules.
Only give the essential commands for -release and -stable.  Remove all
mentions of doas(1).  Tighten up the style: avoid repetitions and the
second person.

requested by & ok deraadt, tweaks & ok tj
@
text
@d1 1
a1 1
.\"	$OpenBSD: release.8,v 1.75 2016/09/02 12:17:33 tb Exp $
d12 1
a12 1
.Dd $Mdocdate: September 2 2016 $
d58 7
d97 1
a97 1
$ cd PORTSPATH && cvs up -r TAG -Pd
d103 1
a103 1
.Va PORTSPATH
d122 1
a122 1
Change to the kernel configuration directory
d124 3
a126 1
.Dl $ cd /usr/src/sys/arch/${ARCH}/conf
d128 2
a129 10
where
.Va ${ARCH}
is the architecture of the machine, e.g.\&
.Li i386 .
Choose a kernel
.Xr config 8
file
.Va ${NAME}
or create a new one.
Build the kernel compilation directory and compile the kernel:
d131 3
a133 8
$ config ${NAME}
$ cd ../compile/${NAME}
$ make clean && make
.Ed
.Pp
Install the new kernel with
.Bd -literal -offset indent
# make install
d145 5
a149 7
Create the tree of obj directories with
.Pp
.Dl $ cd /usr/src && make obj
.Pp
and begin the build:
.Pp
.Dl # make build
d168 15
a182 5
The release process requires two work areas.
They are:
.Bl -tag -width "RELEASEDIR "
.It Va DESTDIR
This is the name of a directory which will be the root of a complete
d185 1
a185 3
.It Va RELEASEDIR
This is the name of a directory where the release output files are stored.
.It " "
d195 1
a195 1
Additionally the first
d197 1
a197 1
device, vnd0,
a198 7
.El
.Pp
Ensure
.Va ${DESTDIR}
exists as an empty directory and
.Va ${RELEASEDIR}
exists.
d201 1
a201 1
.Va ${DESTDIR}
d278 1
a278 1
# cd /usr/src/distrib/${ARCH}/iso && make
a279 1
# unset RELDIR RELXDIR
@


1.75
log
@move links from http to https://www.openbsd.org/

ok beck
@
text
@d1 1
a1 1
.\"	$OpenBSD: release.8,v 1.74 2016/07/23 00:10:15 jmc Exp $
d12 1
a12 1
.Dd $Mdocdate: July 23 2016 $
d41 12
a52 1
The following sections describe each of the required steps in detail.
d55 1
a55 1
.Pq Sq $ .
d57 1
a57 1
.Pq Sq # .
d65 4
a68 17
is to check them out using the
.Tn CVS
tag the
.Ox
developers add to the repository prior to making a release.
There are two tags, one which identifies the release as it exists on the
.Tn CD-ROM
and another which identifies the
.Em stable
branch.
The
.Em stable
branch, starting with
.Ox 2.7 ,
contains the patches described in
.Lk https://www.openbsd.org/errata.html .
The tags are of the form:
d71 3
a73 7
This tag marks the source as it exists on the release
.Tn CD-ROM
where
.Ar x
is the major release number and
.Ar y
is the minor release number.
d76 3
a78 4
It marks the sources that belong to the stable branch.
This branch
.Em only
contains errata, no new features.
d81 6
a86 2
To update your sources to the versions identified by one of the above
tags use the commands:
d93 1
a93 1
Replace
d95 1
a95 3
with the path to your X Window System sources, typically
.Pa /usr/xenocara .
Replace
d97 3
a99 1
with the path to your ports tree sources, typically
a100 5
The above commands assume an existing source tree.
.Pp
See
.Lk http://www.openbsd.org/anoncvs.html
for instructions on fetching the sources for the first time.
d103 1
a103 1
.Tn CVS
d110 1
a110 1
For safety, you should always build and install a new kernel before
a113 1
To build a kernel the steps are:
d115 1
a115 4
Change the current working directory.
.Va ${ARCH}
is the architecture of your machine, e.g.\&
.Li i386 .
d119 7
a125 1
Edit the kernel configuration file.
d127 1
a127 16
is your kernel configuration file.
You should
.Em not
edit
.Li GENERIC ;
create your own kernel configuration if you need to make modifications.
If using
.Li GENERIC
you can skip this step.
And yes, you may use
.Xr vi 1 ,
.Xr mg 1 ,
or any other editor you choose.
.Pp
.Dl $ vi ${NAME}
.Pp
d135 4
a138 3
(In this instance
.Li "make clean"
is your friend.)
a139 1
Replace the old kernel and reboot.
d144 1
a144 8
.Bd -literal -offset indent
$ su
# make install
# shutdown -r now
.Ed
.Pp
If the system does not come up you can boot using
.Pa /obsd .
d146 4
a149 13
Now that you are running your new kernel you can build a new system.
It's safer (but slower) to remove your object directories and re-create
them before the build.
The steps are:
.Pp
Move all your existing object files out of the way and then remove
them in the background:
.Bd -literal -offset indent
$ cd /usr/obj && mkdir -p .old && doas mv * .old && \e
	doas rm -rf .old &
.Ed
.Pp
Re-build your obj directories:
d153 1
a153 3
Create directories that might be missing:
.Pp
.Dl $ cd /usr/src/etc && doas env DESTDIR=/ make distrib-dirs
d155 1
a155 1
Begin the build:
d157 1
a157 3
.Dl $ cd /usr/src && make SUDO=doas build
.Pp
Update
d161 5
a165 3
.Pa /dev/MAKEDEV ,
either by hand or using
.Xr sysmerge 8 .
d167 2
a168 2
At this point your system is up-to-date and running the code that you
are going to make into a release.
d171 1
a171 2
some installation media, the release
.Sq tarballs ,
d180 1
a180 5
installation, thus it must be on a disk partition large enough to store the
entire operating system (less the X Window System and any third party
.Sq packages ) .
The directory can be removed once the release is created.
In any case the release process ensures the directory is empty before starting.
a182 1
The following process will create the directory if necessary.
a198 2
The release process is:
.Pp
a203 10
.Va ${RELEASEDIR}
need not be empty.
You must be root to create a release:
.Bd -literal -offset indent
$ su
# export DESTDIR=your-destdir; export RELEASEDIR=your-releasedir
# test -d ${DESTDIR} && mv ${DESTDIR} ${DESTDIR}- && \e
	rm -rf ${DESTDIR}- &
# mkdir -p ${DESTDIR} ${RELEASEDIR}
.Ed
d207 1
a207 2
pretty much match the contents of the release
.Sq tarballs :
d209 1
a213 6
.Pp
At this point you have most of an
.Ox
release.
The only thing missing is the X Window System
(which is covered in the next section).
a228 1
$ su
d250 1
a250 2
The steps to build the release are (assuming you are still root, and still in
.Va XSRCDIR ) :
a252 3
# test -d ${DESTDIR} && mv ${DESTDIR} ${DESTDIR}- && \e
	rm -rf ${DESTDIR}- &
# mkdir -p ${DESTDIR} ${RELEASEDIR}
d257 1
a257 1
At this point you have both
d259 2
a260 3
system and X Window System
.Sq tarballs
in your release directory.
d262 2
a263 5
The
.Sq ports
subsystem of contributed applications is capable of producing
.Sq packages
for installation, either individually or in bulk.
a291 1
.Xr doas 1 ,
d293 1
@


1.74
log
@hint at the default for XSRCDIR; from tim kuijsten
allows us to zap some verbiage from the beginning...

ok deraadt
@
text
@d1 1
a1 1
.\"	$OpenBSD: release.8,v 1.73 2016/06/26 15:17:43 tb Exp $
d12 1
a12 1
.Dd $Mdocdate: June 26 2016 $
d69 1
a69 1
.Lk http://www.openbsd.org/errata.html .
@


1.73
log
@Document how to create full boot and installation images containing
release tarballs and ports, suitable for installs without network.

Idea and patch from Bryan Everly, thanks!
With input from deraadt, jmc and myself.

ok jmc
@
text
@d1 1
a1 1
.\"	$OpenBSD: release.8,v 1.72 2015/09/14 20:06:59 schwarze Exp $
d12 1
a12 1
.Dd $Mdocdate: September 14 2015 $
d43 1
a43 7
Commands to be run as a user with write permissions on the source and
ports trees
.Pf ( Pa /usr/src
and
.Pa /usr/ports
respectively)
are preceded by a dollar sign
d98 2
a99 1
with the path to your X Window System sources.
@


1.72
log
@Avoid .Ns right after .Pf, it's pointless.
In some cases, do additional cleanup in the immediate vicinity.
@
text
@d1 1
a1 1
.\"	$OpenBSD: release.8,v 1.71 2015/09/10 15:16:43 schwarze Exp $
d12 1
a12 1
.Dd $Mdocdate: September 10 2015 $
d37 2
d343 24
@


1.71
log
@reduce .Nd to one line and kill .Tn while here
@
text
@d1 1
a1 1
.\"	$OpenBSD: release.8,v 1.70 2015/07/31 11:30:12 tedu Exp $
d12 1
a12 1
.Dd $Mdocdate: July 31 2015 $
d43 1
a43 1
.Pf ( Ns Pa /usr/src
@


1.70
log
@need to use env here. from Mark Patruck
@
text
@d1 1
a1 1
.\"	$OpenBSD: release.8,v 1.69 2015/07/30 08:03:50 jmc Exp $
d12 1
a12 1
.Dd $Mdocdate: July 30 2015 $
d17 1
a17 3
.Nd building an
.Ox
release
@


1.69
log
@switch references from sudo to doas;
ok deraadt
@
text
@d1 1
a1 1
.\"	$OpenBSD: release.8,v 1.68 2014/04/06 12:15:26 millert Exp $
d12 1
a12 1
.Dd $Mdocdate: April 6 2014 $
d197 1
a197 1
.Dl $ cd /usr/src/etc && doas DESTDIR=/ make distrib-dirs
@


1.68
log
@Don't suggest people use env(1) in conjunction with sudo.  It is
safer to have sudo set the variable so you get an error message if
it would fail.
@
text
@d1 1
a1 1
.\"	$OpenBSD: release.8,v 1.67 2013/11/26 17:53:22 sthen Exp $
d12 1
a12 1
.Dd $Mdocdate: November 26 2013 $
d187 2
a188 2
$ cd /usr/obj && mkdir -p .old && sudo mv * .old && \e
	sudo rm -rf .old &
d197 1
a197 1
.Dl $ cd /usr/src/etc && sudo DESTDIR=/ make distrib-dirs
d201 1
a201 1
.Dl $ cd /usr/src && make SUDO=sudo build
d345 1
a347 1
.Xr sudo 8 ,
@


1.67
log
@In release(8), defer discussion of ports/package building to ports(7),
which has more complete information (e.g. about DPB). ok espie@@ jmc@@
@
text
@d1 1
a1 1
.\"	$OpenBSD: release.8,v 1.66 2012/09/02 13:47:25 rpe Exp $
d12 1
a12 1
.Dd $Mdocdate: September 2 2012 $
d197 1
a197 1
.Dl $ cd /usr/src/etc && env DESTDIR=/ sudo make distrib-dirs
@


1.66
log
@sync path to kernel sources with config(8), hier(7) and FAQ

ok jmc@@ ajacoutot@@
@
text
@d1 1
a1 1
.\"	$OpenBSD: release.8,v 1.65 2012/08/12 17:01:35 schwarze Exp $
d12 1
a12 1
.Dd $Mdocdate: August 12 2012 $
d338 4
a341 1
subsystem of contributed applications is described in
a342 14
For ease of installation ports can be pre-compiled into
.Sq packages
which can then be installed on multiple machines using
.Xr pkg_add 1 .
Packages are created by selecting an application to build
(we'll call this one CATEGORY/PORT) and then running the following:
as root:
.Bd -literal -offset indent
$ cd /usr/ports/CATEGORY/PORT
$ su
# make package
.Ed
.Pp
That's all there is to it.
@


1.65
log
@Use .Lk for HTTP hyperlinks, not .Pa.
Most of the patch from Arto Jonsson <ajonsson at kapsi dot fi>.
jmc@@ agrees in principle that .Lk is the right macro to use.

While here, update a few broken links,
and add missing markup at a few places.
@
text
@d1 1
a1 1
.\"	$OpenBSD: release.8,v 1.64 2011/04/18 16:52:12 thib Exp $
d12 1
a12 1
.Dd $Mdocdate: April 18 2011 $
d134 1
a134 1
.Dl $ cd /sys/arch/${ARCH}/conf
@


1.64
log
@Deprecate vnds in favour of svnds.

In effect, this removes the "old" vndX nodes, and renames
the svndX nodes to vndX.

Old svndX nodes will still continue to work though, for now.

Cleanup accordingly.

ok deraadt@@, todd@@
comments and ok on the man page bits from jmc@@
@
text
@d1 1
a1 1
.\"	$OpenBSD: release.8,v 1.63 2011/04/15 05:17:44 ajacoutot Exp $
d12 1
a12 1
.Dd $Mdocdate: April 15 2011 $
d75 1
a75 1
.Pa http://www.openbsd.org/errata.html .
d112 1
a112 1
.Pa http://www.openbsd.org/anoncvs.html
@


1.63
log
@Remove mention of "make depend" from here as well.

ok deraadt@@ guenther@@
@
text
@d1 1
a1 1
.\"	$OpenBSD: release.8,v 1.62 2011/01/04 19:19:04 deraadt Exp $
d12 1
a12 1
.Dd $Mdocdate: January 4 2011 $
d244 2
a245 2
.Xr svnd 4
device, svnd0,
@


1.62
log
@using nice is editorializing, it has no place here
@
text
@d1 1
a1 1
.\"	$OpenBSD: release.8,v 1.61 2009/04/25 15:08:50 ajacoutot Exp $
d12 1
a12 1
.Dd $Mdocdate: April 25 2009 $
d158 1
a158 1
$ make clean && make depend && make
@


1.61
log
@Be consistent with what is done before in the man and use sudo(8) while
making sure we start the build from /usr/src.

discussed with and mostly from jmc@@ ("please commit")
@
text
@d1 1
a1 1
.\"	$OpenBSD: release.8,v 1.60 2009/04/08 15:59:53 stsp Exp $
d12 1
a12 1
.Dd $Mdocdate: April 8 2009 $
d193 1
a193 1
.Dl $ cd /usr/src && nice make obj
d201 1
a201 1
.Dl $ cd /usr/src && nice make SUDO=sudo build
d272 1
a272 1
# cd /usr/src/etc && nice make release
d326 1
a326 1
# nice make release
@


1.60
log
@Mention purpose of 'make release' command in surrounding text.
The old text implied 'make release' was only concerned with
verifying file sets. Prodded by me, diff by jmc@@

"if you like it, just commit it" jmc@@
@
text
@d1 1
a1 1
.\"	$OpenBSD: release.8,v 1.59 2009/02/18 01:47:01 ian Exp $
d12 1
a12 1
.Dd $Mdocdate: February 18 2009 $
a199 8
.Bd -literal -offset indent
$ su
# cd /usr/src && nice make build
.Ed
.Pp
If you have set
.Xr sudo 8
up, you can combine this with the previous step using the command
d201 1
a201 1
.Dl $ nice make SUDO=sudo build
@


1.59
log
@Be more generic about what artifacts are created in step 4.
Improved by deraadt@@, ok jmc@@, krw@@.
@
text
@d1 1
a1 1
.\"	$OpenBSD: release.8,v 1.58 2008/10/16 16:22:10 jmc Exp $
d12 1
a12 1
.Dd $Mdocdate: October 16 2008 $
d275 1
a275 1
Check that the contents of
@


1.58
log
@sub-system -> subsystem, for consistency withour other pages;
@
text
@d1 1
a1 1
.\"	$OpenBSD: release.8,v 1.57 2008/10/05 19:23:05 matthieu Exp $
d12 1
a12 1
.Dd $Mdocdate: October 5 2008 $
d222 2
a223 3
The system release consists of a generic kernel, one
.Tn CD-ROM
and two floppy bootable file systems, the release
@


1.57
log
@Mention that /usr/src is now needed to build xenocara.
ok jmc@@, oga@@.
@
text
@d1 1
a1 1
.\"	$OpenBSD: release.8,v 1.56 2008/08/23 07:05:40 jmc Exp $
d12 1
a12 1
.Dd $Mdocdate: August 23 2008 $
d347 1
a347 1
sub-system of contributed applications is described in
@


1.56
log
@it's no longer necessary to build crunch by hand, so adjust the
release instructions accordingly;
@
text
@d1 1
a1 1
.\"	$OpenBSD: release.8,v 1.55 2008/06/22 20:54:51 ajacoutot Exp $
d12 1
a12 1
.Dd $Mdocdate: June 22 2008 $
d301 3
@


1.55
log
@As discussed on ICB, do not invoke make with several targets to make
sure nothing blows up

ok krw@@ espie@@ jmc@@ johan@@ (who came up with the same diff)
@
text
@d1 1
a1 1
.\"	$OpenBSD: release.8,v 1.54 2008/04/23 18:50:24 jmc Exp $
d12 1
a12 1
.Dd $Mdocdate: April 23 2008 $
a257 4
The floppy and
.Tn CD-ROM
.Pa RAMDISK
images require a special tool which is created first.
d260 7
a267 4
.Pp
.Dl $ su
.Pp
Create the special tools needed to build the release:
d269 1
a269 2
# cd /usr/src/distrib/crunch && make obj && make depend \e
	&& make all && make install
a274 8
.Pp
The last two steps ensure
.Va ${DESTDIR}
exists as an empty directory and
.Va ${RELEASEDIR}
exists.
.Va ${RELEASEDIR}
need not be empty.
@


1.54
log
@document sysmerge(8);
@
text
@d1 1
a1 1
.\"	$OpenBSD: release.8,v 1.53 2008/04/08 14:59:07 jmc Exp $
d12 1
a12 1
.Dd $Mdocdate: April 8 2008 $
d158 1
a158 1
$ make clean depend && make
d270 2
a271 2
# cd /usr/src/distrib/crunch && make obj depend \e
	&& make all install
@


1.53
log
@document "make install" for the kernel; requested by Girish Venkatachalam
arm twisting from henning (and an ok)
@
text
@d1 1
a1 1
.\"	$OpenBSD: release.8,v 1.52 2008/03/03 07:02:28 matthieu Exp $
d12 1
a12 1
.Dd $Mdocdate: March 3 2008 $
d215 3
a217 2
.Pa /dev/MAKEDEV
by hand.
d374 2
a375 1
.Xr sudo 8
@


1.52
log
@Change the XSRCDIR default to /usr/xenocara. ok deraadt@@
@
text
@d1 1
a1 1
.\"	$OpenBSD: release.8,v 1.51 2007/05/31 19:19:59 jmc Exp $
d12 1
a12 1
.Dd $Mdocdate: May 31 2007 $
d165 5
a169 1
Replace the old kernel and reboot:
d172 1
a172 1
# mv /bsd /bsd.old && mv bsd / && chown root:wheel /bsd
d177 1
a177 1
.Pa bsd.old .
@


1.51
log
@convert to new .Dd format;
@
text
@d1 1
a1 1
.\"	$OpenBSD: release.8,v 1.50 2007/05/28 17:37:57 matthieu Exp $
d12 1
a12 1
.Dd $Mdocdate$
d302 1
a302 1
.Pa /usr/src/xenocara .
@


1.50
log
@xenocara build no longer overwrite /etc/X11/xdm.
@
text
@d1 1
a1 1
.\"	$OpenBSD: release.8,v 1.49 2007/05/17 15:34:13 kili Exp $
d12 1
a12 1
.Dd July 6, 2000
@


1.49
log
@
Starting with xenocara, /etc/X11/xdm will be overwritten during the
install phase.

discussed with, suggesstions by and ok from jmc@@ matthieu@@
@
text
@d1 1
a1 1
.\"	$OpenBSD: release.8,v 1.48 2007/04/23 08:51:30 ajacoutot Exp $
a316 2
Note that the install phase of the build will also overwrite
.Pa /etc/X11/xdm .
@


1.48
log
@- add /usr/xobj to the file hierarchy

"why not" mblamer@@, ok krw@@ todd@@
@
text
@d1 1
a1 1
.\"	$OpenBSD: release.8,v 1.47 2007/04/01 10:02:35 matthieu Exp $
d317 1
a317 3
However, the install phase of the build does
.Em not
overwrite
a318 8
That directory must be installed by hand.
Or you can
.Ic "cd /etc/X11 && mv xdm xdm-"
before the build and copy any local configuration from
.Pa xdm-
to
.Pa xdm
after the build.
@


1.47
log
@XENOCARA_TOP and XENOCARA_OBJDIR were renamed XSRCDIR and XOBJDIR
respectiveley. with tweaks from jmc@@, ok krw@@ todd@@
@
text
@d1 1
a1 1
.\"	$OpenBSD: release.8,v 1.46 2007/03/26 12:10:49 matthieu Exp $
a308 1
# mkdir -p /usr/xobj
@


1.46
log
@Switch X build instructions to xenocara.
ok deraadt@@ jmc@@ mbalmer@@
@
text
@d1 1
a1 1
.\"	$OpenBSD: release.8,v 1.45 2006/02/04 09:28:59 jmc Exp $
d98 1
a98 1
$ cd XENOCARA_TOP && cvs up -r TAG -Pd
d103 1
a103 1
.Va XENOCARA_TOP
d299 7
d309 2
a310 2
# mkdir -p /usr/obj/xenocara
# cd XENOCARA_TOP
d344 1
a344 1
.Va XENOCARA_TOP ) :
@


1.45
log
@- document that svnd0 must not be configured when making release
- tidy up the whole para whilst here

based on pr #5006, from francisco;
help from mbalmer
@
text
@d1 1
a1 1
.\"	$OpenBSD: release.8,v 1.44 2006/01/09 09:56:24 jmc Exp $
d34 1
a34 1
Build and install XF4.
d36 1
a36 1
Make and validate the XF4 release.
d98 1
a98 1
$ cd XF4SRC && cvs up -r TAG -Pd
d103 1
a103 1
.Va XF4SRC
d296 4
a299 20
.Ss 5. Build and install XF4
The
.Va XF4
tree is primarily
.Xr imake 1 Ns -based
and doesn't contain the
.Dq obj
directory mechanism that comes with Berkeley
.Xr make 1 .
While the tree can be built in place, it's better to refrain from
polluting the cvs sources.
An alternate build location needs to be selected, large enough to hold the
X Window System object files, libraries, and binaries.
Call this location
.Va XF4BLD .
.Va XF4SRC
is the path to your X Window System source files.
Once you've selected
.Va XF4BLD
the build process is:
d302 5
a306 3
# test -d XF4BLD && mv XF4BLD XF4BLD- && rm -rf XF4BLD- &
# mkdir -p XF4BLD
# cd XF4BLD && lndir XF4SRC && nice make build
a308 20
.Sy Note (only for i386) :
.Pa XF86Setup ,
built and installed above, requires version 8.4 of the
.Pa tcl/tk
libraries.
They must be installed to do a proper build.
Version 8.4 of
.Pa tcl/tk
can be found in the ports tree at
.Pa /usr/ports/lang/tcl/8.4/
and
.Pa /usr/ports/x11/tk/8.4/ .
Version 8.4 is required to build XF4.
Version 8.4 may coexist with version 8.0.
.Pp
The above method mimics a
.Ic "make build"
in the
.Pa /usr/src
directory.
d323 2
a324 2
.Ss 6. Make and validate the XF4 release
.Va XF4
d333 1
a333 1
will be removed as part of the XF4 build (this is necessary for
d337 1
a337 1
.Va XF4BLD ) :
@


1.44
log
@double word fix; from joe snikeris
@
text
@d1 1
a1 1
.\"	$OpenBSD: release.8,v 1.43 2005/09/22 14:20:15 jmc Exp $
d244 1
a244 1
in its path as
d247 4
@


1.43
log
@spelling fixes;
from janne johansson (pr #4516, #4517)
@
text
@d1 1
a1 1
.\"	$OpenBSD: release.8,v 1.42 2005/09/12 21:30:23 jmc Exp $
d175 1
a175 1
Now that you are running using your new kernel you can build a new system.
@


1.42
log
@correct prompt;
from xavier venient;
@
text
@d1 1
a1 1
.\"	$OpenBSD: release.8,v 1.41 2005/08/18 15:45:46 jmc Exp $
d219 1
a219 1
and two floppy boot-able file-systems, the release
@


1.41
log
@make sure dependencies are picked up;
from mpf@@, tweaked by millert@@
@
text
@d1 1
a1 1
.\"	$OpenBSD: release.8,v 1.40 2005/08/18 14:21:03 jmc Exp $
d205 1
a205 1
.Dl # nice make SUDO=sudo build
@


1.40
log
@no need to wrap (sub-)section headers in quotes;
@
text
@d1 1
a1 1
.\"	$OpenBSD: release.8,v 1.39 2005/08/18 14:18:55 jmc Exp $
d158 1
a158 1
$ make clean depend bsd
d261 2
a262 1
# cd /usr/src/distrib/crunch && make obj depend all install
@


1.39
log
@rearrange some sections to avoid having instructions and explanations
blocked together: it made the page difficult to read;

ok mpf@@ deraadt@@
@
text
@d1 1
a1 1
.\"	$OpenBSD: release.8,v 1.38 2005/08/06 23:07:13 aanriot Exp $
d53 1
a53 1
.Ss "1. Update sources"
d122 1
a122 1
.Ss "2. Build and install a new kernel"
d174 1
a174 1
.Ss "3. Build a new system"
d216 1
a216 1
.Ss "4. Make and validate the system release"
d291 1
a291 1
.Ss "5. Build and install XF4"
d352 1
a352 1
.Ss "6. Make and validate the XF4 release"
d381 1
a381 1
.Ss "7. Make the third party packages"
@


1.38
log
@move to ksh(1) style.

discussed with many, ok jmc@@
@
text
@d1 1
a1 1
.\"	$OpenBSD: release.8,v 1.37 2005/04/27 11:52:45 jmc Exp $
d129 1
a129 3
.Bl -tag -width 3n -offset indent -compact
.It Li "$ cd /sys/arch/${ARCH}/conf"
where
d131 1
a131 1
is the architecture of your machine, e.g.,
d133 4
a136 2
.It Li "$ vi ${NAME}"
where
d148 2
a149 2
.Li vi ,
.Li mg ,
d151 11
a161 4
.It Li "$ config ${NAME}"
.It Li "$ cd ../compile/${NAME}"
.It Li "$ make clean depend bsd"
In this instance
d163 8
a170 5
is your friend.
.It Li "$ su"
.It Li "# mv /bsd /bsd.old && mv bsd / && chown root:wheel /bsd"
.It Li "# shutdown -r now"
.El
d180 21
a200 11
.Bl -tag -width 3n -offset indent -compact
.It Li "$ cd /usr/obj && mkdir -p .old && sudo mv * .old && \e"
.It Li "sudo rm -rf .old &"
This moves all your existing object files out of the way and then removes
them in the background.
.It Li "$ cd /usr/src && nice make obj"
This re-builds your obj directories.
.It Li "$ cd /usr/src/etc && env DESTDIR=/ sudo make distrib-dirs"
This creates directories that might be missing.
.It Li "$ su"
.It Li "# cd /usr/src && nice make build"
d204 3
a206 5
.Bd -literal -offset indent -compact
nice make SUDO=sudo build
.Ed
.El
.Bd -filled -offset indent -compact
a212 1
.Ed
d255 13
a267 9
.Bl -tag -width 3n -offset indent -compact
.It Li "$ su"
You must be root to create a release.
.It Li "# cd /usr/src/distrib/crunch && make obj depend all install"
Create the special tools needed to build the release.
.It Li "# export DESTDIR=your-destdir; export RELEASEDIR=your-releasedir"
.It Li "# test -d ${DESTDIR} && mv ${DESTDIR} ${DESTDIR}- && \e"
.It Li "rm -rf ${DESTDIR}- &"
.It Li "# mkdir -p ${DESTDIR} ${RELEASEDIR}"
d275 2
a276 3
.It Li "# cd /usr/src/etc && nice make release"
.It Li "# cd /usr/src/distrib/sets && sh checkflist"
This checks that the contents of
d279 6
a284 3
.Sq tarballs .
.It Li "# unset RELEASEDIR DESTDIR"
.El
@


1.37
log
@some corrections from xavier venient;
ok henning@@
@
text
@d1 1
a1 1
.\"	$OpenBSD: release.8,v 1.36 2005/04/08 02:24:26 henning Exp $
d49 2
a50 2
are preceded by a percent sign
.Pq Sq % .
d97 3
a99 3
% cd /usr/src && cvs up -r TAG -Pd
% cd XF4SRC && cvs up -r TAG -Pd
% cd PORTSPATH && cvs up -r TAG -Pd
d130 1
a130 1
.It Li "% cd /sys/arch/${ARCH}/conf"
d135 1
a135 1
.It Li "% vi ${NAME}"
d151 3
a153 3
.It Li "% config ${NAME}"
.It Li "% cd ../compile/${NAME}"
.It Li "% make clean depend bsd"
d157 1
a157 1
.It Li "% su"
d171 1
a171 1
.It Li "% cd /usr/obj && mkdir -p .old && sudo mv * .old && \e"
d175 1
a175 1
.It Li "% cd /usr/src && nice make obj"
d177 1
a177 1
.It Li "% cd /usr/src/etc && env DESTDIR=/ sudo make distrib-dirs"
d179 1
a179 1
.It Li "% su"
d239 1
a239 1
.It Li "% su"
d243 1
a243 1
.It Li "# setenv DESTDIR your-destdir; setenv RELEASEDIR your-releasedir"
d260 1
a260 1
.It Li "# unsetenv RELEASEDIR DESTDIR"
d289 1
a289 1
% su
d345 1
a345 1
# setenv DESTDIR your-destdir; setenv RELEASEDIR your-releasedir
d350 1
a350 1
# unsetenv RELEASEDIR DESTDIR
d371 2
a372 2
% cd /usr/ports/CATEGORY/PORT
% su
@


1.36
log
@make distrib-dirs, ok otto
@
text
@d1 1
a1 1
.\"	$OpenBSD: release.8,v 1.35 2005/01/31 10:32:18 jmc Exp $
d177 1
a177 1
.It Li "% cd /usr/src/etc && env DESTDIR=/ make distrib-dirs"
d180 1
a180 1
.It Li "# nice make build"
@


1.35
log
@fix ugly line split: from raymond lillard;
use displays where possible - they're much tidier;
@
text
@d1 1
a1 1
.\"	$OpenBSD: release.8,v 1.34 2004/02/22 09:20:38 matthieu Exp $
d177 2
@


1.34
log
@Missing tcl 8.3 -> 8.4 conversion. Noticed by Andrey Smagin.
@
text
@d1 1
a1 1
.\"	$OpenBSD: release.8,v 1.33 2003/12/30 08:28:00 matthieu Exp $
d24 1
a24 1
.Bl -enum -compact
d96 5
a100 6
.Pp
.Bl -tag -width 3n -offset indent -compact
.It Li "% cd /usr/src && cvs up -r TAG -Pd"
.It Li "% cd XF4SRC && cvs up -r TAG -Pd"
.It Li "% cd PORTSPATH && cvs up -r TAG -Pd"
.El
d171 2
a172 1
.It Li "% cd /usr/obj && mkdir -p .old && sudo mv * .old && sudo rm -rf .old &"
d242 2
a243 1
.It Li "# test -d ${DESTDIR} && mv ${DESTDIR} ${DESTDIR}- && rm -rf ${DESTDIR}- &"
d286 6
a291 7
.Pp
.Bl -tag -width 3n -offset indent -compact
.It Li "% su"
.It Li "# test -d XF4BLD && mv XF4BLD XF4BLD- && rm -rf XF4BLD- &"
.It Li "# mkdir -p XF4BLD"
.It Li "# cd XF4BLD && lndir XF4SRC && nice make build"
.El
d342 8
a349 8
.Pp
.Bl -tag -width 3n -offset indent -compact
.It Li "# setenv DESTDIR your-destdir; setenv RELEASEDIR your-releasedir"
.It Li "# test -d ${DESTDIR} && mv ${DESTDIR} ${DESTDIR}- && rm -rf ${DESTDIR}- &"
.It Li "# mkdir -p ${DESTDIR} ${RELEASEDIR}"
.It Li "# nice make release"
.It Li "# unsetenv RELEASEDIR DESTDIR"
.El
d368 5
a372 6
.Pp
.Bl -tag -width 3n -offset indent -compact
.It Li "% cd /usr/ports/CATEGORY/PORT"
.It Li "% su"
.It Li "# make package"
.El
@


1.33
log
@XF86Setup uses Tcl/Tk 8.4 now. Ok jose@@ millert@@ jmc@@.
@
text
@d1 1
a1 1
.\"	$OpenBSD: release.8,v 1.32 2003/07/10 08:30:36 jmc Exp $
d295 1
a295 1
built and installed above, requires version 8.3 of the
@


1.32
log
@fix some lists and macros;
@
text
@d1 1
a1 1
.\"	$OpenBSD: release.8,v 1.31 2003/05/13 18:46:50 jmc Exp $
d299 1
a299 1
Version 8.3 of
d302 1
a302 1
.Pa /usr/ports/lang/tcl/8.3/
d304 3
a306 3
.Pa /usr/ports/x11/tk/8.3/ .
Version 8.3 is required to build XF4.
Version 8.3 may coexist with version 8.0.
@


1.31
log
@- it's no longer necessary for sparc64 users to build/install mksuncd as a
separate step, since it's built with crunch (from Pedro Bastos)
- whitespace at EOL

ok deraadt@@ marc@@
@
text
@d1 1
a1 1
.\"	$OpenBSD: release.8,v 1.30 2003/04/17 18:36:49 millert Exp $
d45 1
a45 1
.No ( Ns Pa /usr/src
d66 1
a66 1
.Tn CD\-ROM
d80 1
a80 1
.Tn CD\-ROM
d199 1
a199 1
.Tn CD\-ROM
d231 1
a231 1
.Tn CD\-ROM
d269 1
a269 1
.Xr imake 1 No Ns -based
@


1.30
log
@Proper setenv usage; Martin Reindl
@
text
@d1 1
a1 1
.\"	$OpenBSD: release.8,v 1.29 2003/04/16 01:04:02 millert Exp $
d221 1
a221 1
and 
a240 2
.It Li "# cd /usr/src/distrib/sparc64/mksuncd && make obj depend all install"
On the sparc64 platform only, this tool is needed to create the bootable ISO.
@


1.29
log
@Simplify/clarify the section on XF4 DESTDIR and RELEASEDIR.  Based on
wording by An Metet but changed a bit.
@
text
@d1 1
a1 1
.\"	$OpenBSD: release.8,v 1.28 2003/04/10 16:31:02 millert Exp $
d243 1
a243 1
.It Li "# setenv DESTDIR your-destdir RELEASEDIR=your-releasedir"
d346 1
a346 1
.It Li "# setenv DESTDIR your-destdir RELEASEDIR=your-releasedir"
@


1.28
log
@more POSIX chown; Leandro Costa
@
text
@d1 1
a1 1
.\"	$OpenBSD: release.8,v 1.27 2003/03/20 19:33:11 millert Exp $
d331 1
a331 1
uses the same
d335 3
a337 3
mechanism noted in the section on building a system release, above.
They may be the same values used above, but be warned that the
contents of
d339 2
a340 10
will be removed if you follow this procedure.
However,
.Va DESTDIR
should not be the same directory used to build the system release.  
It may be the same if you don't care to keep the contents of the
system release
.Va DESTDIR .
(The XF4
.Va DESTDIR
needs to be emptied for release checklist processing.)
@


1.27
log
@The '%' lines are used for the ports tree stuff too; noted by sturm@@
@
text
@d1 1
a1 1
.\"	$OpenBSD: release.8,v 1.26 2003/03/20 18:37:42 millert Exp $
d159 1
a159 1
.It Li "# mv /bsd /bsd.old && mv bsd / && chown root.wheel /bsd"
@


1.26
log
@Use csh syntax for environment variable setting since root's shell is csh
Replace bulletted lists with command lines starting with either '%'
for user commands or '#' for root commands.  Also somce other minor
formatting fixes.  marco@@ OK
@
text
@d1 1
a1 1
.\"	$OpenBSD: release.8,v 1.25 2003/02/20 00:57:07 avsm Exp $
d43 6
a48 2
Commands to be run as a user with write permissions on the source tree,
.Pa /usr/src ,
@


1.25
log
@typo
@
text
@d1 1
a1 1
.\"	$OpenBSD: release.8,v 1.24 2003/02/11 07:26:20 jmc Exp $
d42 7
d93 4
a96 7
.Bl -bullet -offset indent -compact
.It
.Li "cd /usr/src && cvs up -r TAG -Pd"
.It
.Li "cd XF4SRC && cvs up -r TAG -Pd"
.It
.Li "cd PORTSPATH && cvs up -r TAG -Pd"
d111 1
a111 1
.Bd -offset indent
a118 1
.Ed
d126 2
a127 4
.Bl -bullet -offset indent -compact
.It
.Li "cd /sys/arch/${ARCH}/conf"
.br
d132 1
a132 3
.It
.Li "vi ${NAME}"
.br
d145 2
a146 1
.Li emacs
d148 3
a150 7
.It
.Li "config ${NAME}"
.It
.Li "cd ../compile/${NAME}"
.It
.Li "make clean && make depend && make"
.br
d154 3
a156 6
.It
.Li su
.It
.Li "mv /bsd /bsd.old && mv bsd / && chown root.wheel /bsd"
.It
.Li "shutdown -r now"
d167 2
a168 4
.Bl -bullet -offset indent -compact
.It
.Li "cd /usr/obj && mkdir -p .old && sudo mv * .old && sudo rm -rf .old &"
.br
d171 1
a171 3
.It
.Li "cd /usr/src && nice make obj"
.br
d173 2
a174 5
.It
.Li su
.It
.Li "nice make build"
.br
d181 2
a182 1
.It
d189 1
a189 1
.El
d232 2
a233 4
.Bl -bullet -offset indent -compact
.It
.Li su
.br
d235 1
a235 3
.It
.Li "cd /usr/src/distrib/crunch && make clean && make && make install"
.br
d237 6
a242 8
.It
.Li "export DESTDIR=your-destdir RELEASEDIR=your-releasedir"
.It
.Li "test -d ${DESTDIR} && mv ${DESTDIR} ${DESTDIR}- && rm -rf ${DESTDIR}- &"
.It
.Li "mkdir -p ${DESTDIR} ${RELEASEDIR}"
.br
These two steps ensure
d249 2
a250 5
.It
.Li "cd /usr/src/etc && nice make release"
.It
.Li "cd /usr/src/distrib/sets && sh checkflist"
.br
d255 1
a255 2
.It
.Li "unset RELEASEDIR DESTDIR"
d284 5
a288 9
.Bl -bullet -offset indent -compact
.It
.Li su
.It
.Li "test -d XF4BLD && mv XF4BLD XF4BLD- && rm -rf XF4BLD- &"
.It
.Li "mkdir -p XF4BLD"
.It
.Li "cd XF4BLD && lndir XF4SRC && nice make build"
d349 6
a354 11
.Bl -bullet -offset indent -compact
.It
.Li "export DESTDIR=your-destdir RELEASEDIR=your-releasedir"
.It
.Li "test -d ${DESTDIR} && mv ${DESTDIR} ${DESTDIR}- && rm -rf ${DESTDIR}- &"
.It
.Li "mkdir -p ${DESTDIR} ${RELEASEDIR}"
.It
.Li "nice make release"
.It
.Li "unset RELEASEDIR DESTDIR"
d371 8
a378 12
Packages are created by:
.Pp
.Bl -bullet -offset indent -compact
.It
Select an application to build, we'll call it
.Va CATEGORY/PORT .
.It
.Li "cd /usr/ports/CATEGORY/PORT"
.It
.Li su
.It
.Li "make package"
@


1.24
log
@typos;

raidctl(8) ok millert@@
mknetid(8) help maja@@
@
text
@d1 1
a1 1
.\"	$OpenBSD: release.8,v 1.23 2003/01/16 17:40:02 millert Exp $
d217 1
a217 1
This is the name of a directory which will be the root of a a complete
@


1.23
log
@Typos; Alan Day w/ changes from me.
@
text
@d1 1
a1 1
.\"	$OpenBSD: release.8,v 1.22 2002/01/04 15:53:44 deraadt Exp $
d140 1
a140 1
.Li GENERIC ,
d183 1
a183 1
this re-builds your obj directories
d249 1
a249 1
you must be root to create a release
d253 1
a253 1
create the special tools needed to build the release
d261 1
a261 1
these two steps ensure
d273 1
a273 1
this checks that the contents of
d339 1
a339 2
.Pa
/usr/X11R6 .
@


1.22
log
@another patch; sams@@moo.cus.org.uk
@
text
@d1 1
a1 1
.\"	$OpenBSD: release.8,v 1.21 2002/01/04 15:43:57 deraadt Exp $
d102 1
a102 1
The above command assume an existing source tree.
d402 1
a402 1
which can then be installed onto machines using
@


1.21
log
@better english; sams@@sebastian.ath.cx
@
text
@d1 1
a1 1
.\"	$OpenBSD: release.8,v 1.20 2001/12/25 01:37:29 miod Exp $
d178 2
a179 2
This moves all your existing object out of the way and then removes them in
the background.
@


1.20
log
@checkflist is a sh script now.
@
text
@d1 1
a1 1
.\"	$OpenBSD: release.8,v 1.19 2001/10/05 14:45:54 mpech Exp $
d170 2
a171 2
It's safer (but slower) to remove and re-build your object directories
and re-building them before the build.
@


1.19
log
@Powered by @@mantoya:
o) start new sentence on a new line;
o) minor mdoc fixes;
millert@@ ok

Tip of the day:   www.mpechismazohist.com
@
text
@d1 1
a1 1
.\"	$OpenBSD: release.8,v 1.18 2001/10/04 16:56:52 mpech Exp $
d271 1
a271 1
.Li "cd /usr/src/distrib/sets && csh checkflist"
@


1.18
log
@we don't like .Pp and blank lines before/after .Ss;

millert@@ ok
@
text
@d1 1
a1 1
.\"	$OpenBSD: release.8,v 1.17 2001/09/18 03:59:16 marc Exp $
d322 3
a324 1
libraries.   They must be installed to do a proper build. Version 8.3 of
d345 2
a346 1
That directory must be installed by hand.   Or you can
d363 2
a364 1
will be removed if you follow this procedure.   However,
@


1.17
log
@
X11R6 -> 'X Window System' so readers don't think the discussion
is about /usr/X11R6. Thanks to millert@@ for comments
@
text
@d1 1
a1 1
.\"	$OpenBSD: release.8,v 1.16 2001/07/27 20:29:19 krw Exp $
a42 1
.Pp
a116 1
.Pp
a168 1
.Pp
a206 1
.Pp
a286 1
.Pp
a350 1
.Pp
a391 1
.Pp
@


1.16
log
@Back out changes adding 'make depend' to recommended build process.

As Theo gently pointed out, this was bullshit. A normal 'make build'
does indeed do all the required 'make depend's. I could have sworn I
tested that and found it wanting. Sigh. mea culpa.

As atonement I will be cleaning up release.8 to implement several of
Theo's suggestions.
@
text
@d1 1
a1 1
.\"	$OpenBSD: release.8,v 1.15 2001/07/27 17:45:35 krw Exp $
d98 1
a98 3
with the path to your
.Tn X11R6
sources.
d223 2
a224 4
installation, thus it must be on a disk partition large enough to
store the entire operating system (less
.Tn X11R6
and any third party
d288 1
a288 2
The only thing missing is
.Va X11R6
d303 1
a303 2
.Tn X11R6
object files, libraries, and binaries.
d307 1
a307 3
is the path to your
.Tn X11R6
sources.
d341 1
a341 2
.Pa X11R6
is created and installed in
d357 1
a357 1
.Va X11R6
d392 3
a394 2
At this point you have both system and
.Tn X11R6
@


1.15
log
@'make depend' really is required, esp. to prevent cruft being installed in the tree during build. Pointed out by beck@@.
@
text
@d1 1
a1 1
.\"	$OpenBSD: release.8,v 1.14 2001/04/24 19:20:35 todd Exp $
a188 7
.It
.Li "nice make depend"
.br
this prepares the tree for a correct build, resolving dependencies and
performing required
.Ox
specific configurations.
@


1.14
log
@update for XF4
@
text
@d1 1
a1 1
.\"	$OpenBSD: release.8,v 1.13 2001/02/01 02:24:00 todd Exp $
d189 7
@


1.13
log
@s/SuperProbe/XF86Setup/ .. oops!
s/8.0/8.3/ .. reflect update to X requirements for building.
@
text
@d1 1
a1 1
.\"	$OpenBSD: release.8,v 1.12 2000/12/17 00:39:26 marc Exp $
d34 1
a34 1
Build and install X11.
d36 1
a36 1
Make and validate the X11 release.
d91 1
a91 1
.Li "cd X11SRC && cvs up -r TAG -Pd"
d97 1
a97 1
.Va X11SRC
d295 1
a295 1
.Ss "5. Build and install X11"
d298 1
a298 1
.Va X11
d311 2
a312 2
.Va X11BLD .
.Va X11SRC
d317 1
a317 1
.Va X11BLD
d324 1
a324 1
.Li "test -d X11BLD && mv X11BLD X11BLD- && rm -rf X11BLD- &"
d326 1
a326 1
.Li "mkdir -p X11BLD"
d328 1
a328 1
.Li "cd X11BLD && lndir X11SRC && nice make DESTDIR=/ build"
d331 1
a331 1
.Sy Note :
d341 2
a342 2
Version 8.3 is required to build X11.   Version 8.3 may coexist with
version 8.0.
d356 1
a356 1
.Pa /var/X11/xdm .
d358 1
a358 1
.Ic "cd /var/X11 && mv xdm xdm-"
d364 1
a364 1
.Ss "6. Make and validate the X11 release"
d381 1
a381 1
(The X11
d386 1
a386 1
.Va X11BLD ) :
@


1.12
log
@
Add warning that /mnt must not be in path of DESTDIR or RELEASEDIR
as it is used in the release generation process.
Idea from Nino Margetic <nino@@cng.fr>
@
text
@d1 1
a1 1
.\"	$OpenBSD: release.8,v 1.11 2000/10/21 23:25:36 marc Exp $
d332 2
a333 2
.Pa SuperProbe ,
built and installed above, requires version 8.0 of the
d335 1
a335 1
libraries.   They must be installed to do a proper build. Version 8.0 of
d338 1
a338 1
.Pa /usr/ports/lang/tcl/8.0/
d340 3
a342 3
.Pa /usr/ports/x11/tk/8.0/ .
Version 8.0 is required to build X11.   Version 8.0 may coexist with
version 8.3.
@


1.11
log
@
Mention that version 8.0 o tcl/tk are required to build X11 and that
they may be found in the ports tree.   Mentioned by fgsch@@.
Remove AUTHORS subheading as it seems to be rarely used.
@
text
@d1 1
a1 1
.\"	$OpenBSD: release.8,v 1.10 2000/09/27 00:24:25 marc Exp $
d235 10
@


1.10
log
@notes on X11 DESTDIR processing from comments by espie@@
@
text
@d1 1
a1 1
.\"	$OpenBSD: release.8,v 1.9 2000/08/03 13:45:23 brad Exp $
d323 1
a323 1
built and installed above, requires the
d325 8
a332 1
libraries.   They must be installed to do a proper build.
a424 5
.Sh AUTHORS
Written by Marco S. Hyman using information gleaned from the various
.Ox
mailing lists and e-mail conversations with Theo de Raadt, Niklas Hallqvist,
Todd T. Fries, and Todd C. Miller.
@


1.9
log
@correct the position of DESTDIR on the command line showing how to build
X11
@
text
@d1 1
a1 1
.\"	$OpenBSD: release.8,v 1.8 2000/07/22 20:23:28 brad Exp $
d261 1
a261 1
exists an empty directory and
d264 2
d358 10
a367 1
will be removed.
@


1.8
log
@typo, them -> then
@
text
@d1 1
a1 1
.\"	$OpenBSD: release.8,v 1.7 2000/07/22 12:32:57 aaron Exp $
d316 1
a316 1
.Li "cd X11BLD && lndir X11SRC && nice DESTDIR=/ make build"
@


1.7
log
@conversions -> conversations; cdjones@@ibid.novusordo.net
@
text
@d1 1
a1 1
.\"	$OpenBSD: release.8,v 1.6 2000/07/12 23:18:16 marc Exp $
d385 1
a385 1
which can them be installed onto machines using
@


1.6
log
@release doc tweaks
@
text
@d1 1
a1 1
.\"	$OpenBSD: release.8,v 1.5 2000/07/11 17:04:27 aaron Exp $
d410 1
a410 1
mailing lists and e-mail conversions with Theo de Raadt, Niklas Hallqvist,
@


1.5
log
@First pass at formatting fixes.
@
text
@d1 1
a1 1
.\"	$OpenBSD: release.8,v 1.4 2000/07/07 18:40:01 deraadt Exp $
d314 1
a314 1
.Li "mkdir -p /usr2/X11"
d316 1
a316 1
.Li "cd X11BLD && lndir X11SRC && nice make build"
d319 16
a334 4
Once the build is done you've a new
.Va X11R6 ...
almost.
The install phase of the build does
d338 7
a344 1
That directory must be installed by hand.
@


1.4
log
@PP
@
text
@d1 1
a1 1
\.\"	$OpenBSD: release.8,v 1.3 2000/07/07 18:30:48 espie Exp $
d21 2
a22 1
There are several steps necessary to build a system release.   They are
d26 1
a26 1
Update sources
d28 1
a28 1
Build and install a new kernel
d30 1
a30 1
Build a new system
d32 1
a32 1
Make and validate the system release
d34 1
a34 1
Build and install X11
d36 1
a36 1
Make and validate the X11 release
d38 1
a38 1
Make the third party packages
d41 1
a41 1
The following sections describe each of the needed steps in detail.
d44 3
a46 1
A release should always start from a known set of
d48 3
a50 2
sources.  The easiest way to ensure that the sources are complete
and coherent is to check the sources out using the
d54 2
a55 2
developers add to the repository prior to making a release.   There
are two tags, one which identifies the release as it exists on the
d59 2
a60 1
branch.   The
d68 1
a68 1
.It Pa OPENBSD_x_y_BASE
d72 1
a72 1
.Pa x
d74 1
a74 1
.Pa y
d76 4
a79 3
.It Pa OPENBSD_x_y
This tag is a moving target.  It marks the sources that belong to the
stable branch.   This branch
d87 1
a87 1
.Bl -bullet -compact -offset indent
d97 1
a97 1
.Pa X11SRC
d100 3
a102 2
sources.  Replace
$PORTSPATH
d105 3
a107 1
The above command assume an existing source tree.   See
d122 3
a124 2
building the programs that will use the kernel.  This ensures that
any new system calls, for example, will be present when needed.
d127 1
a127 1
.Bl -bullet -compact -offset indent
d133 1
a133 1
is the architecture of your machine, e.g.
d140 2
a141 1
is your kernel configuration file.   You should
d148 2
a149 1
you can skip this step.  And yes, you may use
d176 2
a177 1
and re-building them before the build.   The steps are:
d179 1
a179 1
.Bl -bullet -compact -offset indent
d197 1
a197 1
.Bd -literal -compact -offset indent
d219 2
a220 1
The release process requires two work areas.  They are:
d222 1
a222 1
.It Pa DESTDIR
d230 5
a234 5
The directory can be removed once the release is created.  In any case the
release process ensures the directory is empty before starting.
.It Pa RELEASEDIR
This is the name of a directory where the release output files are
stored.   The following process will create the directory if necessary.
d240 4
a243 3
images require a special tool which is created first.   The release process
is:
.Bl -bullet -compact -offset indent
d260 1
a260 1
.Pa ${DESTDIR}
d262 1
a262 1
.Pa ${RELEASEDIR}
d270 1
a270 1
.Pa ${DESTDIR}
d279 3
a281 2
release.   The only thing missing is
.Pa X11R6
d286 1
a286 1
.Pa X11
d288 3
a290 3
.Pa imake
based and doesn't contain the
.Pa obj
d292 1
a292 1
.Pa make .
d294 2
a295 2
polluting the cvs sources.  An alternate build location needs to
be selected, large enough to hold the
d297 4
a300 3
object files, libraries, and binaries.  Call this location
.Pa X11BLD .
.Pa X11SRC
d302 5
a306 3
.Pa X11R6
sources.  Once you've selected
.Pa X11BLD the build process is:
d308 1
a308 1
.Bl -bullet -compact -offset indent
d320 3
a322 2
.Pa X11R6 ...
almost.  The install phase of the build does
d329 1
a329 1
.Pa X11R6
d331 1
a331 1
.Pa DESTDIR
d333 1
a333 1
.Pa RELEASEDIR
d337 4
a340 4
.Pa DESTDIR
will be removed.   The steps to build the release are (assuming you
are still root, and still in
.Pa X11BLD ) :
d342 1
a342 1
.Bl -bullet -compact -offset indent
d356 1
a356 1
.Pa X11R6
d364 2
a365 2
.Xr ports 7 .  For ease of installation ports can be pre-compiled
into
d371 1
a371 1
.Bl -bullet -compact -offset indent
d374 1
a374 1
.Pa CATEGORY/PORT .
a383 4
.\".Sh ENVIRONMENT
.\".Sh FILES
.\".Sh EXAMPLES
.\".Sh DIAGNOSTICS
a388 3
.Sh HISTORY
This document first appeared just after the release of
.Ox 2.7 .
d394 3
@


1.3
log
@Ditch sync; sync; reboot, recommend shutdown -r.

Small grammmatical tweaks.
@
text
@d1 1
a1 1
\.\"	$OpenBSD: release.8,v 1.2 2000/07/07 18:13:26 marc Exp $
d77 1
@


1.2
log
@spelling
@
text
@d1 1
a1 1
\.\"	$OpenBSD: release.8,v 1.1 2000/07/07 18:00:58 marc Exp $
d154 1
a154 8
.Li "sync; sync; reboot"
.br
You can also use
.Bd -literal -compact -offset indent
shutdown -r now
.Ed
.br
for a more orderly shutdown if you're not in a hurry.
d180 1
a180 1
If you've
d182 1
a182 1
set up you can combine this with the previous step using the command
d199 1
a199 1
The system release consist of a generic kernel, one
@


1.1
log
@
First cut at 'how to make a release' doc.   Please read, comment, and
either fix or send corrections
@
text
@d1 1
a1 1
\.\"	$OpenBSD$
d53 1
a53 1
and another which identifes the
d129 1
a129 1
is your kernel config file.   You should
d133 1
a133 1
create your own kernel configuration if you need to make modifiations.
d208 1
a208 1
and two floppy bootable filesystems, the release
d284 1
a284 1
poluting the cvs sources.  An alternate build location needs to
@

