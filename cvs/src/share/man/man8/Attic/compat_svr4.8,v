head	1.19;
access;
symbols
	OPENBSD_4_9:1.18.0.6
	OPENBSD_4_9_BASE:1.18
	OPENBSD_4_8:1.18.0.4
	OPENBSD_4_8_BASE:1.18
	OPENBSD_4_7:1.18.0.2
	OPENBSD_4_7_BASE:1.18
	OPENBSD_4_6:1.16.0.12
	OPENBSD_4_6_BASE:1.16
	OPENBSD_4_5:1.16.0.8
	OPENBSD_4_5_BASE:1.16
	OPENBSD_4_4:1.16.0.6
	OPENBSD_4_4_BASE:1.16
	OPENBSD_4_3:1.16.0.4
	OPENBSD_4_3_BASE:1.16
	OPENBSD_4_2:1.16.0.2
	OPENBSD_4_2_BASE:1.16
	OPENBSD_4_1:1.15.0.16
	OPENBSD_4_1_BASE:1.15
	OPENBSD_4_0:1.15.0.14
	OPENBSD_4_0_BASE:1.15
	OPENBSD_3_9:1.15.0.12
	OPENBSD_3_9_BASE:1.15
	OPENBSD_3_8:1.15.0.10
	OPENBSD_3_8_BASE:1.15
	OPENBSD_3_7:1.15.0.8
	OPENBSD_3_7_BASE:1.15
	OPENBSD_3_6:1.15.0.6
	OPENBSD_3_6_BASE:1.15
	OPENBSD_3_5:1.15.0.4
	OPENBSD_3_5_BASE:1.15
	OPENBSD_3_4:1.15.0.2
	OPENBSD_3_4_BASE:1.15
	OPENBSD_3_3:1.11.0.2
	OPENBSD_3_3_BASE:1.11
	OPENBSD_3_2:1.10.0.6
	OPENBSD_3_2_BASE:1.10
	OPENBSD_3_1:1.10.0.4
	OPENBSD_3_1_BASE:1.10
	OPENBSD_3_0:1.10.0.2
	OPENBSD_3_0_BASE:1.10
	OPENBSD_2_9:1.9.0.2
	OPENBSD_2_9_BASE:1.9
	OPENBSD_2_8:1.8.0.2
	OPENBSD_2_8_BASE:1.8
	OPENBSD_2_7:1.7.0.4
	OPENBSD_2_7_BASE:1.7
	OPENBSD_2_6:1.7.0.2
	OPENBSD_2_6_BASE:1.7
	OPENBSD_2_5:1.5.0.4
	OPENBSD_2_5_BASE:1.5
	OPENBSD_2_4:1.5.0.2
	OPENBSD_2_4_BASE:1.5
	OPENBSD_2_3:1.3.0.2
	OPENBSD_2_3_BASE:1.3
	OPENBSD_2_2:1.2.0.4
	OPENBSD_2_2_BASE:1.2
	OPENBSD_2_1:1.2.0.2
	OPENBSD_2_1_BASE:1.2
	OPENBSD_2_0:1.1.0.2
	OPENBSD_2_0_BASE:1.1;
locks; strict;
comment	@# @;


1.19
date	2011.07.04.22.59.43;	author tedu;	state dead;
branches;
next	1.18;

1.18
date	2009.11.19.07.23.53;	author jmc;	state Exp;
branches;
next	1.17;

1.17
date	2009.11.19.02.36.27;	author guenther;	state Exp;
branches;
next	1.16;

1.16
date	2007.05.31.19.19.58;	author jmc;	state Exp;
branches;
next	1.15;

1.15
date	2003.08.23.19.26.25;	author tedu;	state Exp;
branches;
next	1.14;

1.14
date	2003.07.21.12.43.42;	author jmc;	state Exp;
branches;
next	1.13;

1.13
date	2003.05.10.21.40.54;	author jmc;	state Exp;
branches;
next	1.12;

1.12
date	2003.05.06.08.56.12;	author jmc;	state Exp;
branches;
next	1.11;

1.11
date	2003.02.19.09.10.36;	author jmc;	state Exp;
branches;
next	1.10;

1.10
date	2001.10.05.14.45.54;	author mpech;	state Exp;
branches;
next	1.9;

1.9
date	2000.12.22.16.54.38;	author avsm;	state Exp;
branches;
next	1.8;

1.8
date	2000.08.08.19.16.11;	author brad;	state Exp;
branches;
next	1.7;

1.7
date	99.07.09.13.35.36;	author aaron;	state Exp;
branches;
next	1.6;

1.6
date	99.05.23.14.11.24;	author aaron;	state Exp;
branches;
next	1.5;

1.5
date	98.09.07.16.44.37;	author aaron;	state Exp;
branches;
next	1.4;

1.4
date	98.07.21.21.50.28;	author deraadt;	state Exp;
branches;
next	1.3;

1.3
date	98.01.02.08.51.30;	author deraadt;	state Exp;
branches;
next	1.2;

1.2
date	97.02.14.23.14.21;	author deraadt;	state Exp;
branches;
next	1.1;

1.1
date	96.08.24.22.08.57;	author deraadt;	state Exp;
branches;
next	;


desc
@@


1.19
log
@remove compat_svr4
@
text
@.\"	$OpenBSD: compat_svr4.8,v 1.18 2009/11/19 07:23:53 jmc Exp $
.\"	$NetBSD: compat_svr4.8,v 1.1 1996/07/06 17:14:50 christos Exp $
.\"
.\" Copyright (c) 1996 Christos Zoulas
.\" All rights reserved.
.\"
.\" Redistribution and use in source and binary forms, with or without
.\" modification, are permitted provided that the following conditions
.\" are met:
.\" 1. Redistributions of source code must retain the above copyright
.\"    notice, this list of conditions and the following disclaimer.
.\" 2. Redistributions in binary form must reproduce the above copyright
.\"    notice, this list of conditions and the following disclaimer in the
.\"    documentation and/or other materials provided with the distribution.
.\" 3. All advertising materials mentioning features or use of this software
.\"    must display the following acknowledgment:
.\"      This product includes software developed for the NetBSD Project
.\"      by Christos Zoulas
.\" 4. The name of the author may not be used to endorse or promote products
.\"    derived from this software without specific prior written permission
.\"
.\" THIS SOFTWARE IS PROVIDED BY THE AUTHOR ``AS IS'' AND ANY EXPRESS OR
.\" IMPLIED WARRANTIES, INCLUDING, BUT NOT LIMITED TO, THE IMPLIED WARRANTIES
.\" OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE ARE DISCLAIMED.
.\" IN NO EVENT SHALL THE AUTHOR BE LIABLE FOR ANY DIRECT, INDIRECT,
.\" INCIDENTAL, SPECIAL, EXEMPLARY, OR CONSEQUENTIAL DAMAGES (INCLUDING, BUT
.\" NOT LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES; LOSS OF USE,
.\" DATA, OR PROFITS; OR BUSINESS INTERRUPTION) HOWEVER CAUSED AND ON ANY
.\" THEORY OF LIABILITY, WHETHER IN CONTRACT, STRICT LIABILITY, OR TORT
.\" (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE USE OF
.\" THIS SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.
.\"
.\"	Stolen from compat_linux.8,v 1.2 1995/10/16 20:17:59 fvdl
.\"
.Dd $Mdocdate: November 19 2009 $
.Dt COMPAT_SVR4 8
.Os
.Sh NAME
.Nm compat_svr4
.Nd setup for running SVR4/iBCS2 binaries under emulation
.Sh DESCRIPTION
.Ox
supports running SVR4/iBCS2 binaries.
This code has been tested on i386 and sparc systems.
Most programs should work, but not ones that use or depend on:
.Pp
.Bl -tag -width 123 -compact -offset indent
.It kernel internal data structures
.It the /proc filesystem
.It the ticotsord loopback rpc mechanism (NIS uses this)
.It sound and video interfaces
.It threads (ttsession uses threads)
.It the streams administrative driver
.It "mapping of page zero to the executable for Dell SVR4 binaries"
.El
.Pp
The SVR4 compatibility feature is active
for kernels compiled with the
.Nm COMPAT_SVR4
option and kern.emul.svr4
.Xr sysctl 8
enabled.
.Pp
Most SVR4 programs are dynamically linked.
This means that the shared libraries that the programs depend on
and the runtime linker are also needed.
Additionally, a "shadow root" directory for SVR4 binaries
on the
.Ox
system will have to be created.
This directory is named
.Pa /emul/svr4 .
Any file operations done by SVR4 programs run under
.Ox
will look in this directory first.
So, if a SVR4 program opens, for example,
.Pa /etc/passwd ,
.Ox
will
first try to open
.Pa /emul/svr4/etc/passwd ,
and if that does not exist open the `real'
.Pa /etc/passwd file .
It is recommended that SVR4 packages that include configuration
files, etc., be installed under
.Pa /emul/svr4 ,
to avoid naming conflicts with possible
.Ox
counterparts.
Shared libraries should also be installed in the shadow tree.
.Pp
The simplest way to set up the system for SVR4 binaries is:
.Bl -tag -width 123 -compact
.It 1.
Make the necessary directories:
.Bd -literal -offset indent
(me@@openbsd) mkdir -p /emul/svr4/{dev,etc}
(me@@openbsd) mkdir -p /emul/svr4/usr/{bin,lib}
(me@@openbsd) mkdir -p /emul/svr4/usr/openwin/{bin,lib}
.Ed
.Pp
.It 2.
Copy files from an SVR4 system:
.Bd -literal -offset indent
(me@@svr4) cd /usr/lib
(me@@svr4) tar -cf -\ . | \e
     rsh openbsd 'cd /emul/svr4/usr/lib; tar -xpf -'
.Ed
.Pp
If OpenWindows is going to be run:
.Bd -literal -offset indent
(me@@svr4) cd /usr/openwin/lib
(me@@svr4) tar -cf -\ . | \e
     rsh openbsd 'cd /emul/svr4/usr/openwin/lib; tar -xpf -'
.Ed
.Pp
.It 3.
Set up the configuration files and devices:
.Bd -literal -offset indent
(me@@openbsd) cd /usr/src/etc/etc.svr4
(me@@openbsd) cp netconfig nsswitch.conf /emul/svr4/etc
(me@@openbsd) cp SVR4_MAKEDEV /emul/svr4/dev
(me@@openbsd) cd /emul/svr4/dev; sh SVR4_MAKEDEV all
.Ed
.El
.Pp
An alternative method is to mount a whole SVR4 partition in
.Pa /emul/svr4
and then override with other mounts
.Pa /emul/svr4/etc
and
.Pa /emul/svr4/dev .
.Pp
Clearly, a complete SVR4
.Pa /dev
directory cannot be used as
.Pa /emul/svr4/dev ,
because other device nodes, such as
.Pa /dev/null ,
need to be
.Ox
device nodes.
.Sh BUGS
Many system calls are still not emulated.
The streams emulation is incomplete (socketpair does not work yet).
.Pp
Most SVR4 executables can not handle directory offset cookies > 32
bits.
More recent ones, compiled for large file support (Solaris 2.6 and up) can.
With older programs, the message
"svr4_getdents: dir offset too large for emulated program"
will appear when this happens.
Currently, this can only happen on NFS mounted filesystems, mounted from
servers that return offsets with information in the upper 32 bits.
These errors should rarely happen, but can be avoided by mounting this
filesystem with the
.Fl 2
option to
.Xr mount_nfs 8 .
@


1.18
log
@oops - i did not spot previous was a list item, and needed quoted
because of the number of args. sorry, philip, i should have checked
your diff... fix that, and one more spacing issue in another item;
@
text
@d1 1
a1 1
.\"	$OpenBSD: compat_svr4.8,v 1.17 2009/11/19 02:36:27 guenther Exp $
@


1.17
log
@Dell's SVR4 apparently mapped page zero to the executable.  We don't
do that and, given the security issues it exacerbates, never will.
So document it and delete the disabled support.

ok deraadt@@ tedu@@
@
text
@d1 1
a1 1
.\"	$OpenBSD: compat_svr4.8,v 1.16 2007/05/31 19:19:58 jmc Exp $
d35 1
a35 1
.Dd $Mdocdate: May 31 2007 $
d49 1
a49 3
.It the
.Pa /proc
filesystem
d54 1
a54 1
.It mapping of page zero to the executable for Dell SVR4 binaries
@


1.16
log
@convert to new .Dd format;
@
text
@d1 1
a1 1
.\"	$OpenBSD: compat_svr4.8,v 1.15 2003/08/23 19:26:25 tedu Exp $
d35 1
a35 1
.Dd $Mdocdate$
d56 1
@


1.15
log
@document necessity for sysctl to enable compat code. ok deraadt@@
@
text
@d1 1
a1 1
.\"	$OpenBSD: compat_svr4.8,v 1.14 2003/07/21 12:43:42 jmc Exp $
d35 1
a35 1
.Dd July 6, 1996
@


1.14
log
@remove some old groff macros;
turn some lists into displays;
@
text
@d1 1
a1 1
.\"	$OpenBSD: compat_svr4.8,v 1.13 2003/05/10 21:40:54 jmc Exp $
d61 3
a63 1
option enabled.
@


1.13
log
@uppercased .Dt sections.
setup -> set up in compat_svr4(8)
@
text
@d1 1
a1 1
.\"	$OpenBSD: compat_svr4.8,v 1.12 2003/05/06 08:56:12 jmc Exp $
a48 1
.br
a51 1
.br
a52 1
.br
a53 1
.br
a54 1
.br
d95 5
a99 8
.Pp
.Bl -tag -width 123 -compact -offset indent
.It (me@@openbsd) mkdir -p /emul/svr4/{dev,etc}
.br
.It (me@@openbsd) mkdir -p /emul/svr4/usr/{bin,lib}
.br
.It (me@@openbsd) mkdir -p /emul/svr4/usr/openwin/{bin,lib}
.El
d103 5
a107 9
.Pp
.Bl -tag -width 123 -compact -offset indent
.It (me@@svr4) cd /usr/lib
.br
.It (me@@svr4) tar -cf -\ . | \e
.in +5
.It rsh openbsd 'cd /emul/svr4/usr/lib; tar -xpf -'
.in -5
.El
d110 5
a114 9
.Pp
.Bl -tag -width 123 -compact -offset indent
.It (me@@svr4) cd /usr/openwin/lib
.br
.It (me@@svr4) tar -cf -\ . | \e
.in +5
.It rsh openbsd 'cd /emul/svr4/usr/openwin/lib; tar -xpf -'
.in -5
.El
d118 6
a123 10
.Pp
.Bl -tag -width 123 -compact -offset indent
.It (me@@openbsd) cd /usr/src/etc/etc.svr4
.br
.It (me@@openbsd) cp netconfig nsswitch.conf /emul/svr4/etc
.br
.It (me@@openbsd) cp SVR4_MAKEDEV /emul/svr4/dev
.br
.It (me@@openbsd) cd /emul/svr4/dev; sh SVR4_MAKEDEV all
.El
@


1.12
log
@some typos from Leandro Costa, and a couple from myself.
@
text
@d1 1
a1 1
.\"	$OpenBSD: compat_svr4.8,v 1.11 2003/02/19 09:10:36 jmc Exp $
d36 1
a36 1
.Dt compat_svr4 8
d133 1
a133 1
Setup the configuration files and devices:
@


1.11
log
@changes to compat:

* extensive use of .Pa for paths
* .Nm for kernel options
* `procedure' chopped from .Nd
* 2nd person -> passive
* updated instructions on getting freebsd/linux binaries
* various typos

thanks millert@@ and Grzegorz Czaplinski for help with FreeBSD stuff
prompts and ok deraadt@@
@
text
@d1 1
a1 1
.\"	$OpenBSD: compat_svr4.8,v 1.10 2001/10/05 14:45:54 mpech Exp $
d54 1
a54 1
.It the ticotsord loopback rpc mechanism (nis uses this)
@


1.10
log
@Powered by @@mantoya:
o) start new sentence on a new line;
o) minor mdoc fixes;
millert@@ ok

Tip of the day:   www.mpechismazohist.com
@
text
@d1 1
a1 1
.\"	$OpenBSD: compat_svr4.8,v 1.9 2000/12/22 16:54:38 avsm Exp $
d40 1
a40 1
.Nd setup procedure for running SVR4/iBCS2 binaries under emulation
d50 3
a52 1
.It the /proc filesystem
d69 8
a76 7
This means that you will also need the shared libraries that the program
depends on and the runtime linker.
Also, you will need to create a "shadow root" directory for SVR4 binaries
on your
.Ox
system.
This directory is named /emul/svr4.
d80 2
a81 1
So, if a SVR4 program opens, for example, /etc/passwd,
d84 8
a91 4
first try to open /emul/svr4/etc/passwd, and if that does not exist
open the 'real' /etc/passwd file.
It is recommended that you install SVR4 packages that include configuration
files, etc under /emul/svr4, to avoid naming conflicts with possible
d96 1
a96 1
The simplest way to setup your system for SVR4 binaries is:
d121 1
a121 1
If you are running OpenWindows:
d146 6
a151 2
An alternative method is to mount a whole SVR4 partition in /emul/svr4
and then override with other mounts /emul/svr4/etc and /emul/svr4/dev.
d153 1
a153 1
Clearly, you cannot use a complete SVR4
d155 1
a155 1
directory as
d169 3
a171 2
With older programs, you will see the message "svr4_getdents: dir offset
too large for emulated program" when this happens.
@


1.9
log
@smite typos, and add RCS tags where missing; aaron@@ ok
@
text
@d1 1
a1 1
.\"	$OpenBSD: compat_svr4.8,v 1.8 2000/08/08 19:16:11 brad Exp $
d43 3
a45 3
supports running SVR4/iBCS2 binaries. This code has been tested on
i386 and sparc systems. Most programs should work, but not ones that use
or depend on:
d66 9
a74 8
Most SVR4 programs are dynamically linked. This means that you will
also need the shared libraries that the program depends on and the
runtime linker. Also, you will need to create a "shadow root"
directory for SVR4 binaries on your
.Ox
system. This directory
is named /emul/svr4. Any file operations done by SVR4 programs
run under
d76 2
a77 2
will look in this directory first. So, if a SVR4
program opens, for example, /etc/passwd,
d81 3
a83 3
open the 'real' /etc/passwd file. It is recommended that you install
SVR4 packages that include configuration files, etc under /emul/svr4,
to avoid naming conflicts with possible
d85 2
a86 2
counterparts. Shared
libraries should also be installed in the shadow tree.
d151 2
a152 2
Many system calls are still not emulated. The streams emulation is
incomplete (socketpair does not work yet).
d155 8
a162 7
bits. More recent ones, compiled for large file support (Solaris 2.6
and up) can. With older programs, you will see the message "svr4_getdents:
dir offset too large for emulated program" when this happens. Currently,
this can only happen on NFS mounted filesystems, mounted from servers
that return offsets with information in the upper 32 bits. These errors
should rarely happen, but can be avoided by mounting this filesystem with
the
@


1.8
log
@- bring a bit more in sync with NetBSD's compat_svr4(8)
- OpenBSD -> .Ox macro
- style fixes
@
text
@d1 1
a1 1
.\"	$OpenBSD: compat_svr4.8,v 1.7 1999/07/09 13:35:36 aaron Exp $
d87 1
a87 1
The simplest way to setup your system for SVR4 biraries is:
@


1.7
log
@- remove all trailing whitespace
     * except when it is escaped with a `\' at the end of the line
- fix remaining .Nm usage as well
- this is from a patch I received from kwesterback@@home.com, who has been
  working on some scripts for fixing formatting errors in mdoc'd man pages

Ok, so there could be a cost/benefit debate with this commit, but since I have
the patch we might as well commit it...
@
text
@d1 1
a1 1
.\"	$OpenBSD: compat_svr4.8,v 1.6 1999/05/23 14:11:24 aaron Exp $
d42 2
a43 1
OpenBSD supports running SVR4/iBCS2 binaries. This code has been tested on
d45 15
a59 2
the /proc filesystem, sound, or threads (unfortunately ttsession uses threads).
.\" XXX: What else?
d69 3
a71 1
directory for SVR4 binaries on your OpenBSD system. This directory
d73 6
a78 2
run under OpenBSD will look in this directory first. So, if a SVR4
program opens, for example, /etc/passwd, OpenBSD will
d82 3
a84 1
to avoid naming conflicts with possible OpenBSD counterparts. Shared
a87 1

d101 1
a101 1
Copy files from an svr4 system:
d112 1
a112 1
If you are running openwindows:
d133 1
a133 1
.It (me@@openbsd) cd /emul/svr4/dev; ./SVR4_MAKEDEV all
d137 1
a137 1
An alternative method is to mount a whole svr4 partition in /emul/svr4
d146 3
a148 1
need to be OpenBSD device nodes.
d150 14
a163 2
Many system calls are still not emulated.

@


1.6
log
@remove argument from .Os macros so value in /usr/share/tmac/mdoc/doc-common
is used instead; kwesterback@@home.com
@
text
@d1 1
a1 1
.\"	$OpenBSD: compat_svr4.8,v 1.5 1998/09/07 16:44:37 aaron Exp $
d33 1
a33 1
.\"	Stolen from compat_linux.8,v 1.2 1995/10/16 20:17:59 fvdl 
@


1.5
log
@More man page fixes. Particularly fix uses of it's/its, affect/effect,
then/than and such. Other miscellaneous problems fixed across these source
files.
@
text
@d1 1
a1 1
.\"	$OpenBSD: compat_svr4.8,v 1.4 1998/07/21 21:50:28 deraadt Exp $
d37 1
a37 1
.Os BSD 4
@


1.4
log
@explain that /emul/svr4/dev cannot be a complete svr4 /dev dir
@
text
@d1 1
a1 1
.\"	$OpenBSD: compat_svr4.8,v 1.3 1998/01/02 08:51:30 deraadt Exp $
d125 1
a125 1
need to be OpenBSD device nodes).
@


1.3
log
@change .Nd to include the word "emulation"
@
text
@d1 1
a1 1
.\"	$OpenBSD: compat_svr4.8,v 1.2 1997/02/14 23:14:21 deraadt Exp $
d118 8
@


1.2
log
@lowercase names
@
text
@d1 1
a1 1
.\"	$OpenBSD: compat_svr4.8,v 1.1 1996/08/24 22:08:57 deraadt Exp $
d40 1
a40 1
.Nd setup procedure for running SVR4/iBCS2 binaries
@


1.1
log
@compat_svr4 from christos
@
text
@d1 1
a1 1
.\"	$OpenBSD$
d36 1
a36 1
.Dt COMPAT_SVR4 8
d39 1
a39 1
.Nm COMPAT_SVR4
d46 1
a46 1

d51 1
a51 1

@
