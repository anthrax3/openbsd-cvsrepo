head	1.14;
access;
symbols
	OPENBSD_6_2:1.14.0.2
	OPENBSD_6_2_BASE:1.14
	OPENBSD_6_1:1.13.0.14
	OPENBSD_6_1_BASE:1.13
	OPENBSD_6_0:1.13.0.12
	OPENBSD_6_0_BASE:1.13
	OPENBSD_5_9:1.13.0.2
	OPENBSD_5_9_BASE:1.13
	OPENBSD_5_8:1.13.0.8
	OPENBSD_5_8_BASE:1.13
	OPENBSD_5_7:1.13.0.6
	OPENBSD_5_7_BASE:1.13
	OPENBSD_5_6:1.13.0.4
	OPENBSD_5_6_BASE:1.13
	OPENBSD_5_5:1.10.0.6
	OPENBSD_5_5_BASE:1.10
	OPENBSD_5_4:1.10.0.2
	OPENBSD_5_4_BASE:1.10
	OPENBSD_5_3:1.9.0.2
	OPENBSD_5_3_BASE:1.9
	OPENBSD_5_2:1.8.0.8
	OPENBSD_5_2_BASE:1.8
	OPENBSD_5_1_BASE:1.8
	OPENBSD_5_1:1.8.0.6
	OPENBSD_5_0:1.8.0.4
	OPENBSD_5_0_BASE:1.8
	OPENBSD_4_9:1.8.0.2
	OPENBSD_4_9_BASE:1.8
	OPENBSD_4_8:1.7.0.2
	OPENBSD_4_8_BASE:1.7
	OPENBSD_4_7:1.5.0.2
	OPENBSD_4_7_BASE:1.5
	OPENBSD_4_6:1.3.0.6
	OPENBSD_4_6_BASE:1.3
	OPENBSD_4_5:1.3.0.2
	OPENBSD_4_5_BASE:1.3;
locks; strict;
comment	@.\" @;


1.14
date	2017.09.12.15.06.20;	author schwarze;	state Exp;
branches;
next	1.13;
commitid	OKQyj40QtPWd8eYY;

1.13
date	2014.06.28.06.42.42;	author matthew;	state Exp;
branches;
next	1.12;
commitid	oqNzlWi4w3ZMZil3;

1.12
date	2014.06.26.01.36.49;	author matthew;	state Exp;
branches;
next	1.11;
commitid	odTXD22qrFnKn3oZ;

1.11
date	2014.04.22.10.25.12;	author dlg;	state Exp;
branches;
next	1.10;

1.10
date	2013.07.16.16.05.49;	author schwarze;	state Exp;
branches;
next	1.9;

1.9
date	2012.08.14.01.08.19;	author dlg;	state Exp;
branches;
next	1.8;

1.8
date	2010.09.07.12.33.09;	author jmc;	state Exp;
branches;
next	1.7;

1.7
date	2010.06.27.21.36.02;	author matthew;	state Exp;
branches;
next	1.6;

1.6
date	2010.05.12.08.17.31;	author claudio;	state Exp;
branches;
next	1.5;

1.5
date	2010.03.13.14.33.09;	author dlg;	state Exp;
branches;
next	1.4;

1.4
date	2009.11.16.16.53.56;	author sobrado;	state Exp;
branches;
next	1.3;

1.3
date	2008.12.04.06.29.21;	author jmc;	state Exp;
branches;
next	1.2;

1.2
date	2008.12.04.01.55.02;	author dlg;	state Exp;
branches;
next	1.1;

1.1
date	2008.12.04.00.37.39;	author dlg;	state Exp;
branches;
next	;


desc
@@


1.14
log
@use .Dv for ioctl(2) request names;
from <ScottCheloha at gmail dot com>
@
text
@.\"	$OpenBSD: vscsi.4,v 1.13 2014/06/28 06:42:42 matthew Exp $
.\"
.\" Copyright (c) 2008 David Gwynne <dlg@@openbsd.org>
.\"
.\" Permission to use, copy, modify, and distribute this software for any
.\" purpose with or without fee is hereby granted, provided that the above
.\" copyright notice and this permission notice appear in all copies.
.\"
.\" THE SOFTWARE IS PROVIDED "AS IS" AND THE AUTHOR DISCLAIMS ALL WARRANTIES
.\" WITH REGARD TO THIS SOFTWARE INCLUDING ALL IMPLIED WARRANTIES OF
.\" MERCHANTABILITY AND FITNESS. IN NO EVENT SHALL THE AUTHOR BE LIABLE FOR
.\" ANY SPECIAL, DIRECT, INDIRECT, OR CONSEQUENTIAL DAMAGES OR ANY DAMAGES
.\" WHATSOEVER RESULTING FROM LOSS OF USE, DATA OR PROFITS, WHETHER IN AN
.\" ACTION OF CONTRACT, NEGLIGENCE OR OTHER TORTIOUS ACTION, ARISING OUT OF
.\" OR IN CONNECTION WITH THE USE OR PERFORMANCE OF THIS SOFTWARE.
.\"
.Dd $Mdocdate: June 28 2014 $
.Dt VSCSI 4
.Os
.Sh NAME
.Nm vscsi
.Nd virtual SCSI controller
.Sh SYNOPSIS
.Cd "vscsi0 at root"
.Pp
.In sys/types.h
.In sys/ioctl.h
.In scsi/scsi_all.h
.In dev/vscsivar.h
.Sh DESCRIPTION
The
.Nm
device takes commands from the kernel SCSI midlayer and makes them available
to userland for handling.
Using this interface it is possible to implement virtual SCSI devices that are
usable by the kernel.
.Pp
The following
.Xr ioctl 2
commands are provided to allow userland to dequeue SCSI commands and reply to
them:
.Pp
.Bl -tag -width Ds -compact
.It Dv VSCSI_I2T Fa "struct vscsi_ioc_i2t *"
Dequeue a SCSI command.
If no SCSI commands are available to dequeue,
.Xr ioctl 2
will fail and set
.Va errno
to
.Dv EAGAIN .
.Pp
When one or more SCSI commands are available to dequeue,
.Xr select 2
will indicate the descriptor as ready to read.
.Bd -literal -offset indent
struct vscsi_ioc_i2t {
	int			tag;

	u_int			target;
	u_int			lun;

	struct scsi_generic	cmd;
	size_t			cmdlen;

	size_t			datalen;
	int			direction;
#define VSCSI_DIR_NONE		0
#define VSCSI_DIR_READ		1
#define VSCSI_DIR_WRITE		2
};
.Ed
.Pp
.It Dv VSCSI_DATA_READ Fa "struct vscsi_ioc_data *"
.It Dv VSCSI_DATA_WRITE Fa "struct vscsi_ioc_data *"
Read or write data in response to a SCSI command identified by tag.
.Bd -literal -offset indent
struct vscsi_ioc_data {
	int			tag;

	void *			data;
	size_t			datalen;
};
.Ed
.Pp
.It Dv VSCSI_T2I Fa "struct vscsi_ioc_t2i *"
Signal completion of a SCSI command identified by tag.
.Bd -literal -offset indent
struct vscsi_ioc_t2i {
	int			tag;

	int			status;
#define VSCSI_STAT_DONE		0
#define VSCSI_STAT_SENSE	1
#define VSCSI_STAT_RESET	2
#define VSCSI_STAT_ERR		3
	struct scsi_sense_data	sense;
};
.Ed
.Pp
.It Dv VSCSI_REQPROBE Fa "struct vscsi_ioc_devevent *"
.It Dv VSCSI_REQDETACH Fa "struct vscsi_ioc_devevent *"
Request a probe or a detach of the device at the addresses specified by the
target and lun fields.
.Bd -literal -offset indent
struct vscsi_ioc_devevent {
	u_int			target;
	u_int			lun;
};
.Ed
.El
.Sh FILES
.Bl -tag -width /dev/vscsi0
.It /dev/vscsi0
.El
.Sh SEE ALSO
.Xr ioctl 2 ,
.Xr intro 4 ,
.Xr scsi 4
.Sh HISTORY
The
.Nm
driver first appeared in
.Ox 4.5 .
.Sh AUTHORS
.An David Gwynne Aq Mt dlg@@openbsd.org .
@


1.13
log
@Use Fa for vscsi(4) ioctl() commands.
@
text
@d1 1
a1 1
.\"	$OpenBSD: vscsi.4,v 1.12 2014/06/26 01:36:49 matthew Exp $
d17 1
a17 1
.Dd $Mdocdate: June 26 2014 $
d44 1
a44 1
.It VSCSI_I2T Fa "struct vscsi_ioc_i2t *"
d74 2
a75 2
.It VSCSI_DATA_READ Fa "struct vscsi_ioc_data *"
.It VSCSI_DATA_WRITE Fa "struct vscsi_ioc_data *"
d86 1
a86 1
.It VSCSI_T2I Fa "struct vscsi_ioc_t2i *"
d101 2
a102 2
.It VSCSI_REQPROBE Fa "struct vscsi_ioc_devevent *"
.It VSCSI_REQDETACH Fa "struct vscsi_ioc_devevent *"
@


1.12
log
@Document that VSCSI_I2T is a non-blocking operation and can be
monitored with select(2).
@
text
@d1 1
a1 1
.\"	$OpenBSD: vscsi.4,v 1.11 2014/04/22 10:25:12 dlg Exp $
d17 1
a17 1
.Dd $Mdocdate: April 22 2014 $
d26 4
a29 4
.Fd #include <sys/types.h>
.Fd #include <sys/ioctl.h>
.Fd #include <scsi/scsi_all.h>
.Fd #include <dev/vscsivar.h>
d44 1
a44 1
.It VSCSI_I2T (struct vscsi_ioc_i2t *)
d74 2
a75 2
.It VSCSI_DATA_READ (struct vscsi_ioc_data *)
.It VSCSI_DATA_WRITE (struct vscsi_ioc_data *)
d86 1
a86 1
.It VSCSI_T2I (struct vscsi_ioc_t2i *)
d101 2
a102 2
.It VSCSI_REQPROBE (struct vscsi_ioc_devevent *)
.It VSCSI_REQDETACH (struct vscsi_ioc_devevent *)
@


1.11
log
@list VSCSI_STAT_RESET.

claudio didnt believe it existed cos it wasnt documented. i didnt believe
there was a manpage. i guess we were both wrong.
@
text
@d1 1
a1 1
.\"	$OpenBSD: vscsi.4,v 1.10 2013/07/16 16:05:49 schwarze Exp $
d17 1
a17 1
.Dd $Mdocdate: July 16 2013 $
d46 10
@


1.10
log
@use .Mt for email addresses; from Jan Stary <hans at stare dot cz>; ok jmc@@
@
text
@d1 1
a1 1
.\"	$OpenBSD: vscsi.4,v 1.9 2012/08/14 01:08:19 dlg Exp $
d17 1
a17 1
.Dd $Mdocdate: August 14 2012 $
d85 2
a86 1
#define VSCSI_STAT_ERR		2
@


1.9
log
@kernel configs dont need "scsibus* at foo?" anymore.

"guess you get more commits" deraadt@@
@
text
@d1 1
a1 1
.\"	$OpenBSD: vscsi.4,v 1.8 2010/09/07 12:33:09 jmc Exp $
d17 1
a17 1
.Dd $Mdocdate: September 7 2010 $
d115 1
a115 1
.An David Gwynne Aq dlg@@openbsd.org .
@


1.8
log
@no need for this page to refer to MAKEDEV(8);
@
text
@d1 1
a1 1
.\"	$OpenBSD: vscsi.4,v 1.7 2010/06/27 21:36:02 matthew Exp $
d17 1
a17 1
.Dd $Mdocdate: June 27 2010 $
a24 1
.Cd "scsibus* at vscsi?"
@


1.7
log
@vscsi(4) doesn't use vscsi_ioc_t2i's senselen field anymore, so
garbage collect it.

ok dlg@@, krw@@, claudio@@
@
text
@d1 1
a1 1
.\"	$OpenBSD: vscsi.4,v 1.6 2010/05/12 08:17:31 claudio Exp $
d17 1
a17 1
.Dd $Mdocdate: May 12 2010 $
d109 1
a109 2
.Xr scsi 4 ,
.Xr MAKEDEV 8
@


1.6
log
@Fix includes. Diffy by Remco (remco at d-compu dyndns org)
@
text
@d1 1
a1 1
.\"	$OpenBSD: vscsi.4,v 1.5 2010/03/13 14:33:09 dlg Exp $
d17 1
a17 1
.Dd $Mdocdate: March 13 2010 $
a87 1
	size_t			senselen;
@


1.5
log
@document the REQPROBE and REQDETACH ioctls so i can make claudios slides go
out of date.

ok claudio@@ deraadt@@
@
text
@d1 1
a1 1
.\"	$OpenBSD: vscsi.4,v 1.4 2009/11/16 16:53:56 sobrado Exp $
d17 1
a17 1
.Dd $Mdocdate: November 16 2009 $
d29 2
a30 2
.Fd #include <sys/scsi/scsi_all.h>
.Fd #include <sys/dev/vscsivar.h>
@


1.4
log
@argument to name description (.Nd) macros is usually lower case.
@
text
@d1 1
a1 1
.\"	$OpenBSD: vscsi.4,v 1.3 2008/12/04 06:29:21 jmc Exp $
d17 1
a17 1
.Dd $Mdocdate: December 4 2008 $
d89 11
@


1.3
log
@tidy up the list a little, and add missing .El;
@
text
@d1 1
a1 1
.\"	$OpenBSD: vscsi.4,v 1.2 2008/12/04 01:55:02 dlg Exp $
d22 1
a22 1
.Nd Virtual SCSI controller
@


1.2
log
@dont need this bit of whitespace
@
text
@d1 1
a1 1
.\"	$OpenBSD: vscsi.4,v 1.1 2008/12/04 00:37:39 dlg Exp $
d38 1
a38 1
.Sh IOCTLS
d43 2
a44 1
.Bl -tag -width Ds
d47 1
a47 1
.Bd -literal
d64 1
d68 1
a68 1
.Bd -literal
d76 1
d79 1
a79 1
.Bd -literal
d91 1
d94 1
a94 1
.It Pa /dev/vscsi0
@


1.1
log
@start documenting vscsi(4)
@
text
@d1 1
a1 1
.\"	$OpenBSD$
d17 1
a17 1
.Dd $Mdocdate$
d25 1
a25 1
.Cd "scsibus*  at vscsi?"
@

