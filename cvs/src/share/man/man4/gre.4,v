head	1.47;
access;
symbols
	OPENBSD_6_2:1.47.0.4
	OPENBSD_6_2_BASE:1.47
	OPENBSD_6_1:1.46.0.4
	OPENBSD_6_1_BASE:1.46
	OPENBSD_6_0:1.43.0.8
	OPENBSD_6_0_BASE:1.43
	OPENBSD_5_9:1.43.0.2
	OPENBSD_5_9_BASE:1.43
	OPENBSD_5_8:1.43.0.4
	OPENBSD_5_8_BASE:1.43
	OPENBSD_5_7:1.39.0.8
	OPENBSD_5_7_BASE:1.39
	OPENBSD_5_6:1.39.0.6
	OPENBSD_5_6_BASE:1.39
	OPENBSD_5_5:1.39.0.4
	OPENBSD_5_5_BASE:1.39
	OPENBSD_5_4:1.38.0.2
	OPENBSD_5_4_BASE:1.38
	OPENBSD_5_3:1.37.0.2
	OPENBSD_5_3_BASE:1.37
	OPENBSD_5_2:1.35.0.2
	OPENBSD_5_2_BASE:1.35
	OPENBSD_5_1_BASE:1.34
	OPENBSD_5_1:1.34.0.4
	OPENBSD_5_0:1.34.0.2
	OPENBSD_5_0_BASE:1.34
	OPENBSD_4_9:1.32.0.4
	OPENBSD_4_9_BASE:1.32
	OPENBSD_4_8:1.32.0.2
	OPENBSD_4_8_BASE:1.32
	OPENBSD_4_7:1.31.0.6
	OPENBSD_4_7_BASE:1.31
	OPENBSD_4_6:1.31.0.8
	OPENBSD_4_6_BASE:1.31
	OPENBSD_4_5:1.31.0.4
	OPENBSD_4_5_BASE:1.31
	OPENBSD_4_4:1.31.0.2
	OPENBSD_4_4_BASE:1.31
	OPENBSD_4_3:1.30.0.4
	OPENBSD_4_3_BASE:1.30
	OPENBSD_4_2:1.30.0.2
	OPENBSD_4_2_BASE:1.30
	OPENBSD_4_1:1.28.0.4
	OPENBSD_4_1_BASE:1.28
	OPENBSD_4_0:1.28.0.2
	OPENBSD_4_0_BASE:1.28
	OPENBSD_3_9:1.26.0.8
	OPENBSD_3_9_BASE:1.26
	OPENBSD_3_8:1.26.0.6
	OPENBSD_3_8_BASE:1.26
	OPENBSD_3_7:1.26.0.4
	OPENBSD_3_7_BASE:1.26
	OPENBSD_3_6:1.26.0.2
	OPENBSD_3_6_BASE:1.26
	OPENBSD_3_5:1.23.0.2
	OPENBSD_3_5_BASE:1.23
	OPENBSD_3_4:1.19.0.2
	OPENBSD_3_4_BASE:1.19
	OPENBSD_3_3:1.16.0.2
	OPENBSD_3_3_BASE:1.16
	OPENBSD_3_2:1.13.0.2
	OPENBSD_3_2_BASE:1.13
	OPENBSD_3_1:1.11.0.2
	OPENBSD_3_1_BASE:1.11
	OPENBSD_3_0:1.9.0.2
	OPENBSD_3_0_BASE:1.9
	OPENBSD_2_9:1.7.0.2
	OPENBSD_2_9_BASE:1.7
	OPENBSD_2_8:1.5.0.2
	OPENBSD_2_8_BASE:1.5
	OPENBSD_2_7:1.4.0.2
	OPENBSD_2_7_BASE:1.4;
locks; strict;
comment	@.\" @;


1.47
date	2017.06.08.12.37.14;	author tb;	state Exp;
branches;
next	1.46;
commitid	YGiNzJZXKd1tGxCN;

1.46
date	2016.08.31.18.16.54;	author jmc;	state Exp;
branches;
next	1.45;
commitid	RGg0yUPP5ndjZBry;

1.45
date	2016.08.31.15.00.02;	author reyk;	state Exp;
branches;
next	1.44;
commitid	7HICEJ2aTYkrMgNF;

1.44
date	2016.08.28.07.22.11;	author reyk;	state Exp;
branches;
next	1.43;
commitid	jIduHL9KU1lnm7G1;

1.43
date	2015.07.16.15.46.41;	author sobrado;	state Exp;
branches;
next	1.42;
commitid	Zatj7ekuN9iRMT2A;

1.42
date	2015.06.02.16.02.45;	author sobrado;	state Exp;
branches;
next	1.41;
commitid	swUc5eqR8eq8X5tP;

1.41
date	2015.03.18.06.56.41;	author jmc;	state Exp;
branches;
next	1.40;
commitid	PvhW2ceA2K0qRRAh;

1.40
date	2015.03.18.01.12.16;	author mcbride;	state Exp;
branches;
next	1.39;
commitid	Wovrw86Qlsv0Xqdi;

1.39
date	2013.10.19.16.53.15;	author schwarze;	state Exp;
branches;
next	1.38;

1.38
date	2013.07.16.16.05.48;	author schwarze;	state Exp;
branches;
next	1.37;

1.37
date	2012.09.26.17.34.38;	author jmc;	state Exp;
branches;
next	1.36;

1.36
date	2012.08.18.08.44.25;	author jmc;	state Exp;
branches;
next	1.35;

1.35
date	2012.03.26.19.26.17;	author claudio;	state Exp;
branches;
next	1.34;

1.34
date	2011.07.09.04.01.30;	author deraadt;	state Exp;
branches;
next	1.33;

1.33
date	2011.04.04.15.54.07;	author claudio;	state Exp;
branches;
next	1.32;

1.32
date	2010.06.29.21.43.21;	author sthen;	state Exp;
branches;
next	1.31;

1.31
date	2008.06.26.05.42.06;	author ray;	state Exp;
branches;
next	1.30;

1.30
date	2007.06.01.16.56.26;	author jmc;	state Exp;
branches;
next	1.29;

1.29
date	2007.05.31.19.19.50;	author jmc;	state Exp;
branches;
next	1.28;

1.28
date	2006.06.25.08.58.13;	author brad;	state Exp;
branches;
next	1.27;

1.27
date	2006.05.09.19.03.04;	author jmc;	state Exp;
branches;
next	1.26;

1.26
date	2004.08.16.03.37.47;	author jaredy;	state Exp;
branches;
next	1.25;

1.25
date	2004.07.26.09.20.14;	author jmc;	state Exp;
branches;
next	1.24;

1.24
date	2004.04.20.06.39.04;	author tedu;	state Exp;
branches;
next	1.23;

1.23
date	2004.02.07.19.08.44;	author jmc;	state Exp;
branches;
next	1.22;

1.22
date	2003.12.08.10.03.43;	author markus;	state Exp;
branches;
next	1.21;

1.21
date	2003.11.21.09.26.54;	author jmc;	state Exp;
branches;
next	1.20;

1.20
date	2003.11.09.16.06.07;	author jmc;	state Exp;
branches;
next	1.19;

1.19
date	2003.08.31.20.37.54;	author jmc;	state Exp;
branches;
next	1.18;

1.18
date	2003.06.06.10.29.41;	author jmc;	state Exp;
branches;
next	1.17;

1.17
date	2003.04.01.08.55.39;	author jmc;	state Exp;
branches;
next	1.16;

1.16
date	2003.03.16.10.18.44;	author jmc;	state Exp;
branches;
next	1.15;

1.15
date	2003.03.06.04.03.40;	author david;	state Exp;
branches;
next	1.14;

1.14
date	2002.11.08.08.08.47;	author mpech;	state Exp;
branches;
next	1.13;

1.13
date	2002.06.10.23.08.41;	author itojun;	state Exp;
branches;
next	1.12;

1.12
date	2002.06.10.02.45.30;	author itojun;	state Exp;
branches;
next	1.11;

1.11
date	2002.04.03.20.32.13;	author angelos;	state Exp;
branches;
next	1.10;

1.10
date	2002.03.25.21.18.03;	author angelos;	state Exp;
branches;
next	1.9;

1.9
date	2001.08.03.15.21.16;	author mpech;	state Exp;
branches;
next	1.8;

1.8
date	2001.06.22.12.15.45;	author mpech;	state Exp;
branches;
next	1.7;

1.7
date	2000.12.15.14.31.20;	author aaron;	state Exp;
branches;
next	1.6;

1.6
date	2000.11.10.20.02.16;	author todd;	state Exp;
branches;
next	1.5;

1.5
date	2000.10.18.16.32.11;	author aaron;	state Exp;
branches;
next	1.4;

1.4
date	2000.04.03.21.19.36;	author aaron;	state Exp;
branches;
next	1.3;

1.3
date	2000.01.08.02.30.02;	author angelos;	state Exp;
branches;
next	1.2;

1.2
date	2000.01.08.02.12.47;	author angelos;	state Exp;
branches;
next	1.1;

1.1
date	2000.01.07.22.28.03;	author angelos;	state Exp;
branches;
next	;


desc
@@


1.47
log
@wrec.org is dead. Use working links instead.
patch from jj, found by "Norrland" on icb. Thanks!
@
text
@.\" $OpenBSD: gre.4,v 1.46 2016/08/31 18:16:54 jmc Exp $
.\" $NetBSD: gre.4,v 1.10 1999/12/22 14:55:49 kleink Exp $
.\"
.\" Copyright 1998 (c) The NetBSD Foundation, Inc.
.\" All rights reserved.
.\"
.\" This code is derived from software contributed to The NetBSD Foundation
.\" by Heiko W. Rupp <hwr@@pilhuhn.de>
.\"
.\" Redistribution and use in source and binary forms, with or without
.\" modification, are permitted provided that the following conditions
.\" are met:
.\" 1. Redistributions of source code must retain the above copyright
.\"    notice, this list of conditions and the following disclaimer.
.\" 2. Redistributions in binary form must reproduce the above copyright
.\"    notice, this list of conditions and the following disclaimer in the
.\"    documentation and/or other materials provided with the distribution.
.\"
.\" THIS SOFTWARE IS PROVIDED BY THE NETBSD FOUNDATION, INC. AND CONTRIBUTORS
.\" ``AS IS'' AND ANY EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT LIMITED
.\" TO, THE  IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR
.\" PURPOSE ARE DISCLAIMED.  IN NO EVENT SHALL THE FOUNDATION OR CONTRIBUTORS
.\" BE LIABLE FOR ANY DIRECT, INDIRECT, INCIDENTAL, SPECIAL, EXEMPLARY, OR
.\" CONSEQUENTIAL DAMAGES (INCLUDING, BUT NOT LIMITED TO, PROCUREMENT OF
.\" SUBSTITUTE GOODS OR SERVICES; LOSS OF USE, DATA, OR PROFITS; OR BUSINESS
.\" INTERRUPTION) HOWEVER CAUSED AND ON ANY THEORY OF LIABILITY, WHETHER IN
.\" CONTRACT, STRICT  LIABILITY, OR TORT (INCLUDING NEGLIGENCE OR OTHERWISE)
.\" ARISING IN ANY WAY  OUT OF THE USE OF THIS SOFTWARE, EVEN IF ADVISED OF THE
.\" POSSIBILITY OF SUCH DAMAGE.
.\"
.Dd $Mdocdate: August 31 2016 $
.Dt GRE 4
.Os
.Sh NAME
.Nm gre ,
.Nm mobileip
.Nd encapsulating network device
.Sh SYNOPSIS
.Cd "pseudo-device gre"
.Sh DESCRIPTION
The
.Nm
driver allows tunnel construction using the Cisco GRE or
the Mobile IP (RFC 2004) encapsulation protocols.
.Pp
.Tn GRE ,
.Tn WCCPv1 ,
and
.Tn Mobile IP
are enabled with the following
.Xr sysctl 3
variables respectively in
.Pa /etc/sysctl.conf :
.Bl -tag -width "net.inet.mobileip.allow"
.It Va net.inet.gre.allow
Allow GRE packets in and out of the system.
.It Va net.inet.gre.wccp
Set to 1 to allow WCCPv1-style GRE packets into the system;
set to 2 to handle the packets as WCCPv2-style GRE, truncating
the redirect header.
Some magic with the packet filter configuration
and a caching proxy like squid are needed
to do anything useful with these packets.
This sysctl requires
.Va gre.allow
to be set.
.It Va net.inet.mobileip.allow
Allow Mobile IP packets in and out of the system.
.El
.Pp
This driver currently supports the following modes of operation:
.Bl -tag -width mobileipXXX
.It Nm gre
GRE datagrams (IP protocol number 47)
are prepended by an outer datagram and a GRE header.
The GRE header specifies the type of the encapsulated datagram
and thus allows for tunneling other protocols than IP,
such as AppleTalk.
GRE mode is the default tunnel mode on Cisco routers.
This is also the default mode of operation of the
.Nm
interfaces.
.It Nm mobileip
MOBILE datagrams (IP protocol number 55)
are encapsulated into IP, but with a much smaller
encapsulation header.
This protocol only supports IP in IP encapsulation, and is intended
for use with Mobile IP.
.El
.Pp
A
.Nm gre
or
.Nm mobileip
interface can be created at runtime using the
.Ic ifconfig gre Ns Ar N Ic create
command or by setting up a
.Xr hostname.if 5
configuration file for
.Xr netstart 8 .
The MTU is set to 1476 by default to match the value used by Cisco routers.
This may not be an optimal value,
depending on the link between the two tunnel endpoints,
but it can be adjusted via
.Xr ifconfig 8 .
.Pp
For correct operation,
there needs to be a route to the destination
that is less specific than the one over the tunnel
(there needs to be a route to the decapsulating host that
does not run over the tunnel, as this would create a loop).
.Pp
Note that the IP addresses of the tunnel endpoints may be the same as the
ones defined with
.Xr ifconfig 8
for the interface (as if IP is encapsulated) but need not be as,
for example, when encapsulating AppleTalk.
.Sh EXAMPLES
Configuration example:
.Bd -literal
Host X ---- Host A ------------ tunnel ------------ Cisco D ---- Host E
               \e                                      /
                \e                                    /
                 +------ Host B ------ Host C ------+
.Ed
.Pp
On Host A
.Pq Ox :
.Bd -literal -offset indent
# route add default B
# ifconfig greN create
# ifconfig greN A D netmask 0xffffffff linkX up
# ifconfig greN tunnel A D
# route add E D
.Ed
.Pp
On Host D (Cisco):
.Bd -literal -offset indent
Interface TunnelX
 ip unnumbered D   ! e.g. address from Ethernet interface
 tunnel source D   ! e.g. address from Ethernet interface
 tunnel destination A
ip route C <some interface and mask>
ip route A mask C
ip route X mask tunnelX
.Ed
.Pp
OR
.Pp
On Host D
.Pq Ox :
.Bd -literal -offset indent
# route add default C
# ifconfig greN create
# ifconfig greN D A
# ifconfig greN tunnel D A
.Ed
.Pp
To reach Host A over the tunnel (from Host D), there has to be an
alias on Host A for the Ethernet interface:
.Pp
.Dl # ifconfig <etherif> alias Y
.Pp
and on the Cisco:
.Pp
.Dl ip route Y mask tunnelX
.Pp
Keepalive packets may optionally be sent to the remote endpoint, which
decapsulates and returns them, allowing tunnel failure to be detected.
Enable them like this:
.Bd -literal -offset indent
# ifconfig greN keepalive period count
.Ed
.Pp
This will send a keepalive packet every
.Ar period
seconds.
If no response is received in
.Ar count
*
.Ar period
seconds, the link is considered down.
To return keepalives, the remote host must be configured to forward packets:
.Bd -literal -offset indent
# sysctl net.inet.ip.forwarding=1
.Ed
.Pp
If
.Xr pf 4
is enabled then it is necessary to add a pass rule specific for the keepalive
packets.
The rule must use
.Cm no state
because the keepalive packet is entering the network stack multiple times.
In most cases the following should work:
.Bd -literal -offset indent
pass quick on gre proto gre no state
.Ed
.Sh SEE ALSO
.Xr inet 4 ,
.Xr ip 4 ,
.Xr netintro 4 ,
.Xr options 4 ,
.Xr hostname.if 5 ,
.Xr protocols 5 ,
.Xr ifconfig 8 ,
.Xr netstart 8 ,
.Xr sysctl 8
.Sh STANDARDS
.Rs
.%A S. Hanks
.%A "T. Li"
.%A D. Farinacci
.%A P. Traina
.%D October 1994
.%R RFC 1701
.%T Generic Routing Encapsulation (GRE)
.Re
.Pp
.Rs
.%A S. Hanks
.%A "T. Li"
.%A D. Farinacci
.%A P. Traina
.%D October 1994
.%R RFC 1702
.%T Generic Routing Encapsulation over IPv4 networks
.Re
.Pp
.Rs
.%A C. Perkins
.%D October 1996
.%R RFC 2004
.%T Minimal Encapsulation within IP
.Re
.Pp
.Rs
.%U https://tools.ietf.org/html/draft-ietf-wrec-web-pro-00.txt
.%T Web Cache Coordination Protocol V1.0
.Re
.Pp
.Rs
.%U https://tools.ietf.org/html/draft-wilson-wrec-wccp-v2-00.txt
.%T Web Cache Coordination Protocol V2.0
.Re
.Sh AUTHORS
.An Heiko W. Rupp Aq Mt hwr@@pilhuhn.de
.Sh BUGS
The GRE RFC is not yet fully implemented (no GRE options).
.Pp
The redirect header for WCCPv2 GRE encapsulated packets is skipped.
@


1.46
log
@shuffle this page a little, to make it read better;
@
text
@d1 1
a1 1
.\" $OpenBSD: gre.4,v 1.45 2016/08/31 15:00:02 reyk Exp $
d238 1
a238 1
.%U http://www.wrec.org/Drafts/draft-ietf-wrec-web-pro-00.txt
d243 1
a243 1
.%U http://www.wrec.org/Drafts/draft-wilson-wrec-wccp-v2-00.txt
@


1.45
log
@Split gre(4) into two interfaces: gre(4) and mobileip(4).

Like vlan/svlan and tun/tap, it remains a single driver that decides
on the mode based on the interface name.  This removes the need for
removing the default link0 flag to turn gre into Mobile IP mode.
Using linkX / IFF_LINK{0,1,2} for interface modes is a deprecated style.

OK millert@@ dlg@@ many

Not much consensus on the name but mobileip is also used for the sysctls, so
OK henning@@
@
text
@d1 1
a1 1
.\" $OpenBSD: gre.4,v 1.44 2016/08/28 07:22:11 reyk Exp $
d31 1
a31 1
.Dd $Mdocdate: August 28 2016 $
d61 4
a64 1
This variable depends on
d66 1
a66 1
being set.
d77 2
a78 2
and thus allows for tunneling other protocols than IP like
e.g. AppleTalk.
d96 1
a96 1
.Ic ifconfig Ar gre Ns Ar N Ic create
d101 11
d116 2
a117 2
for the interface (as if IP is encapsulated), but need not be, as e.g. when
encapsulating AppleTalk.
d127 2
a128 1
On Host A (OpenBSD):
d150 2
a151 1
On Host D (OpenBSD):
d193 1
a193 1
.Em no state
a198 31
.Sh NOTES
The MTU of
.Nm
interfaces is set to 1476 by default to match the value used by Cisco routers.
This may not be an optimal value, depending on the link between the two tunnel
endpoints.
It can be adjusted via
.Xr ifconfig 8 .
.Pp
For correct operation, the
.Nm
device needs a route to the destination, that is less specific than the
one over the tunnel.
(There needs to be a route to the decapsulating host that
does not run over the tunnel, as this would create a loop.)
.Pp
In order for
.Xr ifconfig 8
to actually mark the interface as up, the keyword
.Cm up
must be given last on its command line.
.Pp
The kernel must be set to forward datagrams by issuing the appropriate
option to
.Xr sysctl 8 .
.Pp
The GRE interface will accept WCCPv1-style or WWCPv2-style GRE
encapsulated packets from a Cisco router.
Some magic with the packet filter configuration
and a caching proxy like squid are needed to do anything useful with
these packets.
d249 1
a249 1
GRE RFC not yet fully implemented (no GRE options).
@


1.44
log
@Remove obsolete gre(4) ioctls GRESADDRS, GRESADDRD, GREGADDRS,
GREGADDRD, GRESPROTO, and GREGPROTO.  They have been replaced by
generic ioctls some time ago (eg. the "ifconfig gre0 tunnel") and
there is no need to keep the old ones around.  They are neither used
in base nor in ports.

OK sthen@@
@
text
@d1 1
a1 1
.\" $OpenBSD: gre.4,v 1.43 2015/07/16 15:46:41 sobrado Exp $
d31 1
a31 1
.Dd $Mdocdate: July 16 2015 $
d35 2
a36 1
.Nm gre
d43 1
a43 1
network interface allows tunnel construction using the Cisco GRE or
a67 9
A
.Nm
interface can be created at runtime using the
.Ic ifconfig gre Ns Ar N Ic create
command or by setting up a
.Xr hostname.if 5
configuration file for
.Xr netstart 8 .
.Pp
d69 4
a72 3
.Bl -tag -width abc
.It GRE encapsulation (IP protocol number 47)
Encapsulated datagrams are prepended by an outer datagram and a GRE header.
d80 3
a82 2
.It MOBILE encapsulation (IP protocol number 55)
Datagrams are encapsulated into IP, but with a much smaller
d88 10
a97 16
The network interfaces are named
.Li gre0 ,
.Li gre1 ,
etc.
The number of interfaces is given by the corresponding
.Ic pseudo-device
line in the system configuration file.
The operation mode can be set with the following modifiers to
.Xr ifconfig 8 :
.Pp
.Bl -tag -width "-link0" -offset indent -compact
.It Cm link0
.Dv IPPROTO_GRE
.It Cm -link0
.Dv IPPROTO_MOBILE
.El
@


1.43
log
@double word fix.

ok jmc@@
@
text
@d1 1
a1 1
.\" $OpenBSD: gre.4,v 1.42 2015/06/02 16:02:45 sobrado Exp $
d31 1
a31 1
.Dd $Mdocdate: June 2 2015 $
d101 1
a101 20
.Nm gre
interfaces support the following
.Xr ioctl 2 Ns s :
.Bl -tag -width Ds
.It Dv GRESADDRS Fa "struct ifreq *"
Set the IP address of the local tunnel end.
.It Dv GRESADDRD Fa "struct ifreq *"
Set the IP address of the remote tunnel end.
.It Dv GREGADDRS Fa "struct ifreq *"
Query the IP address that is set for the local tunnel end.
.It Dv GREGADDRD Fa "struct ifreq *"
Query the IP address that is set for the remote tunnel end.
.It Dv GRESPROTO Fa "struct ifreq *"
Set the operation mode to the specified IP protocol value.
The protocol is passed to the interface in the
.Va ifr_flags
field of the
.Vt ifreq
structure.
The operation mode can also be set with the following modifiers to
a108 3
.El
.It Dv GREGPROTO Fa "struct ifreq *"
Query operation mode.
@


1.42
log
@write Mobile IP{,v6} in a consistent way, as given in RFCs 5944 and 6275.

ok jmc@@
@
text
@d1 1
a1 1
.\" $OpenBSD: gre.4,v 1.41 2015/03/18 06:56:41 jmc Exp $
d31 1
a31 1
.Dd $Mdocdate: March 18 2015 $
d58 1
a58 1
set to 2 to handle the the packets as WCCPv2-style GRE, truncating
@


1.41
log
@minor tweaks;
@
text
@d1 1
a1 1
.\" $OpenBSD: gre.4,v 1.40 2015/03/18 01:12:16 mcbride Exp $
d43 1
a43 1
the Mobile-IP (RFC 2004) encapsulation protocols.
d48 1
a48 1
.Tn MobileIP
d64 1
a64 1
Allow MobileIP packets in and out of the system.
d91 1
a91 1
for use with mobile IP.
@


1.40
log
@"handle" wccp2 packets if net.inet.gre.wccp is set to 2 by truncating
skipping the wccp 2 header. Tested with Cisco ASA.

"looks correct" claudio
ok yasuoka
@
text
@d1 1
a1 1
.\" $OpenBSD: gre.4,v 1.39 2013/10/19 16:53:15 schwarze Exp $
d31 1
a31 1
.Dd $Mdocdate: October 19 2013 $
d57 1
a57 1
Set to 1 to allow WCCPv1-style GRE packets into the system,
d60 3
a62 1
This variable depends on the above.
d78 1
a78 1
.It GRE encapsulation (IP protocol number 47).
d87 1
a87 1
.It MOBILE encapsulation (IP protocol number 55).
d300 1
a300 2
For WCCPv2 GRE encapsulated packets we don't handle the redirect
header, but simply skip it.
@


1.39
log
@fix obvious .An formatting errors
found while working on mandoc apropos
@
text
@d1 1
a1 1
.\" $OpenBSD: gre.4,v 1.38 2013/07/16 16:05:48 schwarze Exp $
d31 1
a31 1
.Dd $Mdocdate: July 16 2013 $
d57 4
a60 1
Allow WCCPv1-style GRE packets into the system (depends on the above).
d241 2
a242 2
The GRE interface will accept WCCPv1-style GRE encapsulated packets
from a Cisco router.
d298 2
a299 3
For the WCCP GRE encapsulated packets we can only reliably accept
WCCPv1 format; WCCPv2 formatted packets add another header which will
skew the decode, and results are not defined (i.e. don't do WCCPv2).
@


1.38
log
@use .Mt for email addresses; from Jan Stary <hans at stare dot cz>; ok jmc@@
@
text
@d1 1
a1 1
.\" $OpenBSD: gre.4,v 1.37 2012/09/26 17:34:38 jmc Exp $
d8 1
a8 1
.\" by Heiko W.Rupp <hwr@@pilhuhn.de>
d31 1
a31 1
.Dd $Mdocdate: September 26 2012 $
d291 1
a291 1
.An Heiko W.Rupp Aq Mt hwr@@pilhuhn.de
@


1.37
log
@last stage of rfc changes, using consistent Rs/Re blocks, and moving the
references into a STANDARDS section;
@
text
@d1 1
a1 1
.\" $OpenBSD: gre.4,v 1.36 2012/08/18 08:44:25 jmc Exp $
d31 1
a31 1
.Dd $Mdocdate: August 18 2012 $
d291 1
a291 1
.An Heiko W.Rupp Aq hwr@@pilhuhn.de
@


1.36
log
@within Rs/Re reference blocks, use %U instead of %O (or any other
variants) for URLs, allowing mandoc -Thtml to properly generate links;

(sendmail.8 changes are simply using Lk, which i somehow missed in previous)

ingo reminded me to verify that gnu groff recognises %U: 1.20.1 does not,
but 1.21 does;
@
text
@d1 1
a1 1
.\" $OpenBSD: gre.4,v 1.35 2012/03/26 19:26:17 claudio Exp $
d31 1
a31 1
.Dd $Mdocdate: March 26 2012 $
d253 1
d255 5
d261 1
a261 1
.%T Generic Routing Encapsulation
d263 1
d265 5
d273 1
d275 2
d280 1
d285 1
@


1.35
log
@Try to document how to use gre(4) keepalives with pf(4) enabled.
Adding a rule like "pass quick on gre proto gre no state" will ensure that
the keepalive packets get through pf by bypassing the state table once.
Requested by jsing@@ some long time ago.
@
text
@d1 1
a1 1
.\" $OpenBSD: gre.4,v 1.34 2011/07/09 04:01:30 deraadt Exp $
d31 1
a31 1
.Dd $Mdocdate: July 9 2011 $
d266 1
a266 1
.%O http://www.wrec.org/Drafts/draft-ietf-wrec-web-pro-00.txt
d270 1
a270 1
.%O http://www.wrec.org/Drafts/draft-wilson-wrec-wccp-v2-00.txt
@


1.34
log
@remove more atalk bits
@
text
@d1 1
a1 1
.\" $OpenBSD: gre.4,v 1.33 2011/04/04 15:54:07 claudio Exp $
d31 1
a31 1
.Dd $Mdocdate: April 4 2011 $
d199 12
@


1.33
log
@Update BUGS section. The crazy route lookup is gone so is link1.
@
text
@d1 1
a1 1
.\" $OpenBSD: gre.4,v 1.32 2010/06/29 21:43:21 sthen Exp $
d31 1
a31 1
.Dd $Mdocdate: June 29 2010 $
a231 1
.Xr atalk 4 ,
@


1.32
log
@Mention keepalives here too; ok jmc@@
@
text
@d1 1
a1 1
.\" $OpenBSD: gre.4,v 1.31 2008/06/26 05:42:06 ray Exp $
d31 1
a31 1
.Dd $Mdocdate: June 26 2008 $
a264 19
The
.Fn compute_route
code in
.Pa sys/net/if_gre.c
toggles the last bit of the IP address to provoke the search for a less
specific route than the one directly over the tunnel to prevent loops.
This is possibly not the best solution.
.Pp
To avoid the address munging described above, turn on the
.Cm link1
flag on the
.Xr ifconfig 8
command line.
This implies that the GRE packet destination and the remote host are not
the same IP addresses, and that the GRE destination does not route over
the
.Nm Ns Ar X
interface itself.
.Pp
@


1.31
log
@First pass at removing clauses 3 and 4 from NetBSD licenses.

Not sure what's more surprising: how long it took for NetBSD to
catch up to the rest of the BSDs (including UCB), or the amount of
code that NetBSD has claimed for itself without attributing to the
actual authors.

OK deraadt@@
@
text
@d1 1
a1 1
.\" $OpenBSD: gre.4,v 1.30 2007/06/01 16:56:26 jmc Exp $
d31 1
a31 1
.Dd $Mdocdate: June 1 2007 $
d180 20
@


1.30
log
@enforce DESCRIPTION-after-SYNOPSIS order, to appease man -h;
@
text
@d1 1
a1 1
.\" $OpenBSD: gre.4,v 1.29 2007/05/31 19:19:50 jmc Exp $
a17 7
.\" 3. All advertising materials mentioning features or use of this software
.\"    must display the following acknowledgement:
.\"     This product includes software developed by the NetBSD
.\"	Foundation, Inc. and its contributors.
.\" 4. Neither the name of The NetBSD Foundation nor the names of its
.\"    contributors may be used to endorse or promote products derived
.\"    from this software without specific prior written permission.
d31 1
a31 1
.Dd $Mdocdate: May 31 2007 $
@


1.29
log
@convert to new .Dd format;
@
text
@d1 1
a1 1
.\" $OpenBSD: gre.4,v 1.28 2006/06/25 08:58:13 brad Exp $
d38 1
a38 1
.Dd $Mdocdate$
d46 6
a51 1
.Sh NOTE
a67 5
.Sh DESCRIPTION
The
.Nm
network interface allows tunnel construction using the Cisco GRE or
the Mobile-IP (RFC 2004) encapsulation protocols.
@


1.28
log
@add a note for MTU adjustment.

From NetBSD
@
text
@d1 1
a1 1
.\" $OpenBSD: gre.4,v 1.27 2006/05/09 19:03:04 jmc Exp $
d38 1
a38 1
.Dd September 13, 1998
@


1.27
log
@no need to specify a "count" argument: ifconfig(8) handles these
"on demand";

from jan niemann;
ok deraadt
@
text
@d1 1
a1 1
.\" $OpenBSD: gre.4,v 1.26 2004/08/16 03:37:47 jaredy Exp $
d187 9
a195 1
.Sh NOTE
@


1.26
log
@mdoc fixes
normalize ioctl listing
convert SEE ALSO to Rs/Re

ok jmc
@
text
@d1 1
a1 1
.\" $OpenBSD: gre.4,v 1.25 2004/07/26 09:20:14 jmc Exp $
d45 1
a45 1
.Cd "pseudo-device gre" Op Ar count
@


1.25
log
@.Xr hostname.if 5
.Xr netstart 8

from Alexey E. Suslikov
@
text
@d1 1
a1 1
.\" $OpenBSD: gre.4,v 1.24 2004/04/20 06:39:04 tedu Exp $
d56 1
a56 1
.It net.inet.gre.allow
d58 1
a58 1
.It net.inet.gre.wccp
d60 1
a60 1
.It net.inet.mobileip.allow
d72 1
a72 1
.Ic ifconfig greN create
d87 1
a87 1
.Sy gre Ns Ar X
d97 2
a98 2
.Sy gre Ns Ar 0 ,
.Sy gre Ns Ar 1 ,
d101 2
a102 2
.Sy pseudo-device
line in the system config file.
d106 2
a107 2
.Bl -tag -width aaa
.It GRESADDRS:
d109 1
a109 1
.It GRESADDRD:
d111 1
a111 1
.It GREGADDRS:
d113 1
a113 1
.It GREGADDRD:
d115 1
a115 1
.It GRESPROTO:
d117 13
a129 7
The protocol is passed to the interface in (struct ifreq)->ifr_flags.
The operation mode can also be given as
.Bl -tag -width bbb
.It link0
IPPROTO_GRE
.It -link0
IPPROTO_MOBILE
d131 1
a131 1
.It GREGPROTO:
d143 4
a146 7


Host X-- Host A  ----------------tunnel---------- Cisco D------Host E
          \\                                          |
           \\                                        /
             +------Host B----------Host C----------+

d148 1
d179 1
a179 1
To reach Host A over the tunnel (from host D), there has to be an
d181 5
a185 2
.Dl ifconfig <etherif> alias Y
and on the Cisco
d197 3
a199 2
to actually mark the interface as up, the keyword ``up'' must be given
last on its command line.
d221 20
a240 9
.Pp
A description of GRE encapsulation can be found in RFC 1701, RFC 1702.
.Pp
A description of MOBILE encapsulation can be found in RFC 2004.
.Pp
A description of WCCPv1 can be found in draft-ietf-wrec-web-pro-00.txt,
and WCCPv2 in draft-wilson-wrec-wccp-v2-00.txt.
Both of these documents
can be found at http://www.wrec.org/ (at the time of this writing).
d244 5
a248 3
The compute_route() code in
.Pa net/if_gre.c
toggles the last bit of the IP-address to provoke the search for a less
d252 5
a256 2
To avoid the address munging described above, turn on the link1 flag
on the ifconfig command line.
d260 1
a260 1
.Sy gre Ns Ar X
@


1.24
log
@GATEWAY and NMBCLUSTERS are dead.  ok beck@@ deraadt@@ jmc@@
@
text
@d1 1
a1 1
.\" $OpenBSD: gre.4,v 1.23 2004/02/07 19:08:44 jmc Exp $
d208 1
d211 1
@


1.23
log
@remove a typo in the copyright;

with permission of the author (Heiko W. Rupp) and
the (c) holders (The NetBSD Foundation) via wiz@@netbsd;
@
text
@d1 1
a1 1
.\" $OpenBSD: gre.4,v 1.22 2003/12/08 10:03:43 markus Exp $
d193 1
a193 2
The kernel must be set to forward datagrams by including option
``GATEWAY'' in the kernel config file and issuing the appropriate
@


1.22
log
@mention ifconfig create; sync synopsis like (Op Ar count). with jmc, deraadt
@
text
@d1 1
a1 1
.\" $OpenBSD: gre.4,v 1.21 2003/11/21 09:26:54 jmc Exp $
d22 1
a22 1
.\" 4. Neither the name of the The NetBSD Foundation nor the names of its
@


1.21
log
@WCCPv1, not WCCPv2; from Berk D. Demir;
also alter -width of a list to make it look a bit better;
@
text
@d1 1
a1 1
.\" $OpenBSD: gre.4,v 1.20 2003/11/09 16:06:07 jmc Exp $
d45 1
a45 1
.Cd pseudo-device gre Op Ar count
d69 9
d148 1
d170 1
@


1.20
log
@remove .Pp's before lists and displays;
@
text
@d1 1
a1 1
.\" $OpenBSD: gre.4,v 1.19 2003/08/31 20:37:54 jmc Exp $
d55 1
a55 1
.Bl -tag -width xxxxxxxxxxxxxxxxxxxxx
d59 1
a59 1
Allow WCCPv2-style GRE packets into the system (depends on the above).
@


1.19
log
@change .Xr to self -> .Nm;
@
text
@d1 1
a1 1
.\" $OpenBSD: gre.4,v 1.18 2003/06/06 10:29:41 jmc Exp $
a157 1
.Pp
@


1.18
log
@- section reorder
- some macro fixes
- kill whitespace at EOL
@
text
@d1 1
a1 1
.\" $OpenBSD: gre.4,v 1.17 2003/04/01 08:55:39 jmc Exp $
d94 1
a94 1
.Xr gre 4
@


1.17
log
@tidy up of EXAMPLES section;

host A -> Host A
cisco -> Cisco     for consistency
@
text
@d1 1
a1 1
.\" $OpenBSD: gre.4,v 1.16 2003/03/16 10:18:44 jmc Exp $
d47 2
a48 2
.Tn GRE,
.Tn WCCPv1,
d136 28
a163 24
   On Host A (OpenBSD):

   # route add default B
   # ifconfig greN A D netmask 0xffffffff linkX up
   # ifconfig greN tunnel A D
   # route add E D

   On Host D (Cisco):

   Interface TunnelX 	
    ip unnumbered D   ! e.g. address from Ethernet interface
    tunnel source D   ! e.g. address from Ethernet interface
    tunnel destination A
   ip route C <some interface and mask>
   ip route A mask C
   ip route X mask tunnelX

   OR

   On Host D (OpenBSD):

   # route add default C
   # ifconfig greN D A
   # ifconfig greN tunnel D A
d167 3
a169 3
     ifconfig <etherif> alias Y
 and on the Cisco
     ip route Y mask tunnelX
d211 2
d214 4
a217 3
The compute_route() code in net/if_gre.c toggles the last bit of the
IP-address to provoke the search for a less specific route than the
one directly over the tunnel to prevent loops.
a232 2
.Sh AUTHORS
Heiko W.Rupp <hwr@@pilhuhn.de>
@


1.16
log
@typos;

ddb(4), hilid(4), hilkbd(4), hilms(4): ok miod@@
gsckbd(4): found by miod@@
@
text
@d1 1
a1 1
.\" $OpenBSD: gre.4,v 1.15 2003/03/06 04:03:40 david Exp $
d130 1
a130 1
Host X-- Host A  ----------------tunnel---------- cisco D------Host E
d136 1
a136 1
   On host A (OpenBSD):
d164 1
a164 1
 and on the cisco
@


1.15
log
@date should be written formally: .Dd Month day, year
also fixes a few misspellings of the month
ok henning@@ jmc@@
@
text
@d1 1
a1 1
.\" $OpenBSD: gre.4,v 1.14 2002/11/08 08:08:47 mpech Exp $
d72 1
a72 1
Encapsulated datagrams are prepended by a outer datagram and a GRE header.
d217 3
a219 1
the greX interface itself.
@


1.14
log
@Time to cleanup:
o) start new sentence on a new line;
o) wrap long lines;
o) don't use .Pp before/after .Sh, .Ss;
o) OpenBSD -> .Ox;
o) typos;
o) close .Rs;
o) use space between arguments in tag, for example:
   .Xr blabla ) .

miod@@ ok
@
text
@d1 1
a1 1
.\" $OpenBSD: gre.4,v 1.13 2002/06/10 23:08:41 itojun Exp $
d38 1
a38 1
.Dd 13 September 1998
@


1.13
log
@sync with if_gre.c change.
@
text
@d1 1
a1 1
.\" $OpenBSD: gre.4,v 1.12 2002/06/10 02:45:30 itojun Exp $
d185 2
a186 1
from a Cisco router.  Some magic with the packet filter configuration
d204 2
a205 1
and WCCPv2 in draft-wilson-wrec-wccp-v2-00.txt.  Both of these documents
@


1.12
log
@appletalk and NS are supported.  not just IPv4 over IPv4.
@
text
@d1 1
a1 1
.\" $OpenBSD: gre.4,v 1.11 2002/04/03 20:32:13 angelos Exp $
d113 1
a113 1
.It link2
a115 7
.Pp
to
.Xr ifconfig 8 .
As the linkN flags are not mutually exclusive, modes must be set by applying
positive and negative flags, e.g.,
.Xr ifconfig 8
link0 -link1 -link2
d139 2
a140 1
   # ifconfig greN  A D netmask 0xffffffff linkX up
d159 1
@


1.11
log
@Document new sysctl for WCCP packets -- ok deraadt@@
@
text
@d1 1
a1 1
.\" $OpenBSD: gre.4,v 1.10 2002/03/25 21:18:03 angelos Exp $
d75 1
a75 1
e.g. AppleTalk (not yet supported).
d222 1
a222 2
GRE RFC not yet fully implemented (no GRE options), no other protocols
yet than IP over IP.
@


1.10
log
@Verbiage on WCCP support (rather, GRE for WCCPv1) - from joeycoleman@@acm.org
@
text
@d1 1
a1 1
.\" $OpenBSD: gre.4,v 1.9 2001/08/03 15:21:16 mpech Exp $
d47 2
a48 1
.Tn GRE
d58 2
@


1.9
log
@o) We don't like .Pp before/after .Sh;
o) .Nm always has argument in .Sh SYNOPSIS;
o) We always closes .Bl and .Bd tags;

millert@@ ok
@
text
@d1 1
a1 1
.\" $OpenBSD: gre.4,v 1.8 2001/06/22 12:15:45 mpech Exp $
d185 5
d203 4
d221 4
@


1.8
log
@o) remove unnecessary .Pp;
o) remove unnecessary .Nm args;
o) closes .Bl;
o) .Sh AUTHOR -> .Sh AUTHORS;
o) sort SEE ALSO;
o) better -mdoc style;
o) typos;

aaron@@ ok.
@
text
@d1 1
a1 1
.\" $OpenBSD: gre.4,v 1.7 2000/12/15 14:31:20 aaron Exp $
a128 1
.Pp
a211 1
.Pp
@


1.7
log
@.Sh EXAMPLE -> .Sh EXAMPLES. Even if there's only one example, at least
this is consistent.
@
text
@d1 1
a1 1
.\" $OpenBSD: gre.4,v 1.6 2000/11/10 20:02:16 todd Exp $
a59 1
.Pp
d62 1
a62 1
.Nm gre
a186 2
.Xr netintro 4 ,
.Xr ip 4 ,
d189 2
a190 1
.Xr ifconfig 8 ,
d193 1
@


1.6
log
@.Sh AUTHOR -> AUTHORS, ok aaron@@
@
text
@d1 1
a1 1
.\" $OpenBSD: gre.4,v 1.5 2000/10/18 16:32:11 aaron Exp $
d131 1
a131 1
.Sh EXAMPLE
@


1.5
log
@ethernet -> Ethernet
@
text
@d1 1
a1 1
.\" $OpenBSD: gre.4,v 1.4 2000/04/03 21:19:36 aaron Exp $
d215 1
a215 1
.Sh AUTHOR
@


1.4
log
@Remove trailing whitespace.
@
text
@d1 1
a1 1
.\" $OpenBSD: gre.4,v 1.3 2000/01/08 02:30:02 angelos Exp $
d166 1
a166 1
alias on Host A for the ethernet interface:
@


1.3
log
@A bit more language, and remove references to greconfig(8).
@
text
@d1 1
a1 1
.\" $OpenBSD: gre.4,v 1.2 2000/01/08 02:12:47 angelos Exp $
d22 2
a23 2
.\" 4. Neither the name of the The NetBSD Foundation nor the names of its 
.\"    contributors may be used to endorse or promote products derived 
d26 3
a28 3
.\" THIS SOFTWARE IS PROVIDED BY THE NETBSD FOUNDATION, INC. AND CONTRIBUTORS 
.\" ``AS IS'' AND ANY EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT LIMITED 
.\" TO, THE  IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR 
d30 5
a34 5
.\" BE LIABLE FOR ANY DIRECT, INDIRECT, INCIDENTAL, SPECIAL, EXEMPLARY, OR 
.\" CONSEQUENTIAL DAMAGES (INCLUDING, BUT NOT LIMITED TO, PROCUREMENT OF 
.\" SUBSTITUTE GOODS OR SERVICES; LOSS OF USE, DATA, OR PROFITS; OR BUSINESS 
.\" INTERRUPTION) HOWEVER CAUSED AND ON ANY THEORY OF LIABILITY, WHETHER IN 
.\" CONTRACT, STRICT  LIABILITY, OR TORT (INCLUDING NEGLIGENCE OR OTHERWISE) 
d69 1
a69 1
.It GRE encapsulation (IP protocol number 47). 
d78 1
a78 1
.It MOBILE encapsulation (IP protocol number 55). 
d96 1
a96 1
.It GRESADDRS: 
d98 1
a98 1
.It GRESADDRD: 
d100 1
a100 1
.It GREGADDRS: 
d102 1
a102 1
.It GREGADDRD: 
d104 1
a104 1
.It GRESPROTO: 
d107 1
a107 1
The operation mode can also be given as 
d121 1
a121 1
.It GREGPROTO: 
d126 1
a126 1
ones defined with 
d128 1
a128 1
for the interface (as if IP is encapsulated), but need not be, as e.g. when 
d163 1
a163 1
   # ifconfig greN D A 
d184 1
a184 1
``GATEWAY'' in the kernel config file and issuing the appropriate 
@


1.2
log
@Work on the language...
@
text
@d1 1
a1 1
.\" $OpenBSD: gre.4,v 1.1 2000/01/07 22:28:03 angelos Exp $
a145 1
   # greconfig -i greN -s A -d D
a192 1
.Xr greconfig 8 ,
d208 3
a210 3
This implies that the GRE packet destination (set via greconfig -d)
and the ifconfig remote host are not the same IP addresses, and that
the GRE destination does not route over the greX interface itself.
@


1.1
log
@gre(4) man page, from NetBSD.
@
text
@d1 1
a1 1
.\" $OpenBSD$
d50 1
a50 1
is enabled with the following
d52 1
a52 1
variables in
d64 2
a65 4
network interface is a pseudo device that allows to encapsulate datagrams
into IP. These encapsulated datagrams are routed to a destination host,
where they are decapsulated and further routed to their final destination.
The so called ``tunnel'' appears to the inner datagrams like one hop.
d70 6
a75 6
Encapsulated datagrams are
prepended by a outer datagram and a GRE header. The GRE header specifies
the type of the encapsulated datagram and thus allows for tunneling other
protocols than IP like e.g. AppleTalk (not yet supported). GRE mode is
also the default tunnel mode on Cisco routers. This is also the default
mode of operation of the 
d79 4
a82 5
Datagrams are 
encapsulated into IP, but with a shorter encapsulation. The original
IP header is modified and the modifications are inserted between the
so modified header and the original payload. Like IPIP only for IP in IP
encapsulation.
d87 3
a89 2
.Sy gre Ns Ar 1 
and so on, as many as have given on the 
d91 4
a94 3
line in the system config file. Each interface supports a number of
.Xr ioctl 2 Ns s,
such as:
d105 3
a107 4
Set the operation mode to the specified IP protocol value. The
protocol is passed to the interface in (struct ifreq)->ifr_flags.
The operation mode can also
be given as 
d118 1
a118 1
positive and negative flags as e.g. 
d142 1
a142 1
   On host A (NetBSD):
d161 1
a161 1
   On Host D (NetBSD):
d166 2
a167 4
If all goes well, you should see packets flowing ;-)
.Pp
If you want to reach Host A over the tunnel (from the Cisco D), then 
you have to have an alias on Host A for e.g. the Ethernet interface like:
d176 2
a177 2
(Basically, there needs to be a route to the decapsulating host that
does not run over the tunnel, as this would be a loop ..)
d179 1
a179 1
In order to 
d184 2
a185 2
The kernel must be set to forward datagrams by either option
``GATEWAY'' in the kernel config file or by issuing the appropriate 
d203 1
a203 1
The compute_route() code in if_gre.c toggles the last bit of the
d205 2
a206 2
one directly over the tunnel to prevent loops. This is possibly not
the best solution.
d209 4
a212 4
on the ifconfig command line.  This implies that the GRE packet
destination (set via greconfig -d) and the ifconfig remote host are
not the same IP addresses, and that the GRE destination does not route
over the greX interface itself.
a215 1

@

