head	1.28;
access;
symbols
	OPENBSD_6_1:1.28.0.14
	OPENBSD_6_1_BASE:1.28
	OPENBSD_6_0:1.28.0.12
	OPENBSD_6_0_BASE:1.28
	OPENBSD_5_9:1.28.0.2
	OPENBSD_5_9_BASE:1.28
	OPENBSD_5_8:1.28.0.8
	OPENBSD_5_8_BASE:1.28
	OPENBSD_5_7:1.28.0.6
	OPENBSD_5_7_BASE:1.28
	OPENBSD_5_6:1.28.0.4
	OPENBSD_5_6_BASE:1.28
	OPENBSD_5_5:1.27.0.4
	OPENBSD_5_5_BASE:1.27
	OPENBSD_5_4:1.26.0.10
	OPENBSD_5_4_BASE:1.26
	OPENBSD_5_3:1.26.0.8
	OPENBSD_5_3_BASE:1.26
	OPENBSD_5_2:1.26.0.6
	OPENBSD_5_2_BASE:1.26
	OPENBSD_5_1_BASE:1.26
	OPENBSD_5_1:1.26.0.4
	OPENBSD_5_0:1.26.0.2
	OPENBSD_5_0_BASE:1.26
	OPENBSD_4_9:1.21.0.12
	OPENBSD_4_9_BASE:1.21
	OPENBSD_4_8:1.21.0.10
	OPENBSD_4_8_BASE:1.21
	OPENBSD_4_7:1.21.0.6
	OPENBSD_4_7_BASE:1.21
	OPENBSD_4_6:1.21.0.8
	OPENBSD_4_6_BASE:1.21
	OPENBSD_4_5:1.21.0.4
	OPENBSD_4_5_BASE:1.21
	OPENBSD_4_4:1.21.0.2
	OPENBSD_4_4_BASE:1.21
	OPENBSD_4_3:1.20.0.4
	OPENBSD_4_3_BASE:1.20
	OPENBSD_4_2:1.20.0.2
	OPENBSD_4_2_BASE:1.20
	OPENBSD_4_1:1.19.0.10
	OPENBSD_4_1_BASE:1.19
	OPENBSD_4_0:1.19.0.8
	OPENBSD_4_0_BASE:1.19
	OPENBSD_3_9:1.19.0.6
	OPENBSD_3_9_BASE:1.19
	OPENBSD_3_8:1.19.0.4
	OPENBSD_3_8_BASE:1.19
	OPENBSD_3_7:1.19.0.2
	OPENBSD_3_7_BASE:1.19
	OPENBSD_3_6:1.17.0.4
	OPENBSD_3_6_BASE:1.17
	OPENBSD_3_5:1.17.0.2
	OPENBSD_3_5_BASE:1.17
	OPENBSD_3_4:1.16.0.2
	OPENBSD_3_4_BASE:1.16
	OPENBSD_3_3:1.15.0.4
	OPENBSD_3_3_BASE:1.15
	OPENBSD_3_2:1.15.0.2
	OPENBSD_3_2_BASE:1.15
	OPENBSD_3_1:1.14.0.4
	OPENBSD_3_1_BASE:1.14
	OPENBSD_3_0:1.14.0.2
	OPENBSD_3_0_BASE:1.14
	OPENBSD_2_9:1.13.0.4
	OPENBSD_2_9_BASE:1.13
	OPENBSD_2_8:1.13.0.2
	OPENBSD_2_8_BASE:1.13
	OPENBSD_2_7:1.12.0.2
	OPENBSD_2_7_BASE:1.12
	OPENBSD_2_6:1.11.0.2
	OPENBSD_2_6_BASE:1.11
	OPENBSD_2_5:1.8.0.4
	OPENBSD_2_5_BASE:1.8
	OPENBSD_2_4:1.8.0.2
	OPENBSD_2_4_BASE:1.8
	OPENBSD_2_3:1.6.0.2
	OPENBSD_2_3_BASE:1.6
	OPENBSD_2_2:1.5.0.4
	OPENBSD_2_2_BASE:1.5
	OPENBSD_2_1:1.5.0.2
	OPENBSD_2_1_BASE:1.5
	OPENBSD_2_0:1.3.0.2
	OPENBSD_2_0_BASE:1.3;
locks; strict;
comment	@# @;


1.28
date	2014.07.02.22.35.42;	author matthew;	state Exp;
branches;
next	1.27;
commitid	UVfZngFEO8Tf2HEx;

1.27
date	2014.01.21.03.15.46;	author schwarze;	state Exp;
branches;
next	1.26;

1.26
date	2011.06.05.18.42.05;	author matthew;	state Exp;
branches;
next	1.25;

1.25
date	2011.04.25.20.21.04;	author mk;	state Exp;
branches;
next	1.24;

1.24
date	2011.04.18.21.02.33;	author thib;	state Exp;
branches;
next	1.23;

1.23
date	2011.04.18.20.54.13;	author jmc;	state Exp;
branches;
next	1.22;

1.22
date	2011.04.18.16.52.12;	author thib;	state Exp;
branches;
next	1.21;

1.21
date	2008.03.17.16.30.36;	author sobrado;	state Exp;
branches;
next	1.20;

1.20
date	2007.05.31.19.19.53;	author jmc;	state Exp;
branches;
next	1.19;

1.19
date	2005.02.01.03.47.19;	author jaredy;	state Exp;
branches;
next	1.18;

1.18
date	2005.01.11.09.12.09;	author jmc;	state Exp;
branches;
next	1.17;

1.17
date	2004.03.21.19.47.59;	author miod;	state Exp;
branches;
next	1.16;

1.16
date	2003.04.11.04.32.28;	author jmc;	state Exp;
branches;
next	1.15;

1.15
date	2002.09.26.22.09.53;	author miod;	state Exp;
branches;
next	1.14;

1.14
date	2001.10.05.14.45.53;	author mpech;	state Exp;
branches;
next	1.13;

1.13
date	2000.06.28.19.01.17;	author art;	state Exp;
branches;
next	1.12;

1.12
date	2000.03.29.01.28.56;	author deraadt;	state Exp;
branches;
next	1.11;

1.11
date	99.07.09.13.35.48;	author aaron;	state Exp;
branches;
next	1.10;

1.10
date	99.07.03.02.11.12;	author aaron;	state Exp;
branches;
next	1.9;

1.9
date	99.06.05.13.18.33;	author aaron;	state Exp;
branches;
next	1.8;

1.8
date	98.07.03.21.22.37;	author espie;	state Exp;
branches;
next	1.7;

1.7
date	98.06.08.17.14.36;	author deraadt;	state Exp;
branches;
next	1.6;

1.6
date	98.03.10.04.50.46;	author millert;	state Exp;
branches;
next	1.5;

1.5
date	97.05.14.15.34.05;	author niklas;	state Exp;
branches;
next	1.4;

1.4
date	96.12.22.01.42.45;	author deraadt;	state Exp;
branches;
next	1.3;

1.3
date	96.09.16.15.59.11;	author mickey;	state Exp;
branches;
next	1.2;

1.2
date	96.07.08.22.09.33;	author ccappuc;	state Exp;
branches;
next	1.1;

1.1
date	96.01.01.01.42.07;	author deraadt;	state Exp;
branches;
next	;


desc
@@


1.28
log
@Document the ioctl() argument types for sd(4)'s ioctls

Also, cleanup some lies about which header defines these ioctls
@
text
@.\"	$OpenBSD: vnd.4,v 1.27 2014/01/21 03:15:46 schwarze Exp $
.\"	$NetBSD: vnd.4,v 1.1 1995/12/30 18:10:48 thorpej Exp $
.\"
.\" Copyright (c) 1995 Jason R. Thorpe.
.\" All rights reserved.
.\"
.\" Redistribution and use in source and binary forms, with or without
.\" modification, are permitted provided that the following conditions
.\" are met:
.\" 1. Redistributions of source code must retain the above copyright
.\"    notice, this list of conditions and the following disclaimer.
.\" 2. Redistributions in binary form must reproduce the above copyright
.\"    notice, this list of conditions and the following disclaimer in the
.\"    documentation and/or other materials provided with the distribution.
.\" 3. All advertising materials mentioning features or use of this software
.\"    must display the following acknowledgement:
.\"	This product includes software developed for the NetBSD Project
.\"	by Jason R. Thorpe.
.\" 4. Neither the name of the author nor the names of its contributors
.\"    may be used to endorse or promote products derived from this software
.\"    without specific prior written permission.
.\"
.\" THIS SOFTWARE IS PROVIDED BY THE AUTHOR ``AS IS'' AND ANY EXPRESS OR
.\" IMPLIED WARRANTIES, INCLUDING, BUT NOT LIMITED TO, THE IMPLIED WARRANTIES
.\" OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE ARE DISCLAIMED.
.\" IN NO EVENT SHALL THE AUTHOR BE LIABLE FOR ANY DIRECT, INDIRECT,
.\" INCIDENTAL, SPECIAL, EXEMPLARY, OR CONSEQUENTIAL DAMAGES (INCLUDING,
.\" BUT NOT LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES;
.\" LOSS OF USE, DATA, OR PROFITS; OR BUSINESS INTERRUPTION) HOWEVER CAUSED
.\" AND ON ANY THEORY OF LIABILITY, WHETHER IN CONTRACT, STRICT LIABILITY,
.\" OR TORT (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY
.\" OUT OF THE USE OF THIS SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF
.\" SUCH DAMAGE.
.\"
.Dd $Mdocdate: January 21 2014 $
.Dt VND 4
.Os
.Sh NAME
.Nm vnd
.Nd vnode disk driver
.Sh SYNOPSIS
.Cd "pseudo-device vnd" Op Ar count
.Sh DESCRIPTION
The
.Nm
driver provides a disk-like interface to a file.
This is useful for a variety of applications, such as building miniroot or
floppy disk images.
.Pp
This document assumes familiarity with how to generate kernels and
how to properly configure disks and pseudo-devices in a kernel
configuration file.
.Pp
In order to compile in support for
.Nm vnd
devices, a line similar to the following must be present in the kernel
configuration file:
.Bd -unfilled -offset indent
pseudo-device	vnd	4	# vnode disk driver
.Ed
.Pp
The
.Ar count
argument is how many
.Nm vnds
memory is allocated for at boot time.
In this example, no more than 4
.Nm vnds
may be configured.
.Pp
There is a run-time utility that is used for configuring
.Nm vnds .
See
.Xr vnconfig 8
for more information.
.Sh IOCTL INTERFACE
The following
.Xr ioctl 2
calls are defined in
.In dev/vndioctl.h :
.Bl -tag -width Ds
.It Dv VNDIOCSET Fa "struct vnd_ioctl *"
Associate the file
.Va vnd_file
with a
.Nm
pseudo device, optionally encrypted using the Blowfish cipher and the key
specified in
.Va vnd_key
of length
.Va vnd_keylen .
The size of the configured device is returned in
.Va vnd_size .
.Bd -literal -offset indent
struct vnd_ioctl {
	char	*vnd_file;
	off_t	vnd_size;
	u_char	*vnd_key;
	int	vnd_keylen;
};
.Ed
.It Dv VNDIOCCLR Fa "struct vnd_ioctl *"
Disassociate a
.Nm
device.
.It Dv VNDIOCGET Fa "struct vnd_user *"
Get the associated file name, device, inode number, and unit number of a
.Nm
device.
If
.Va vnu_unit
is \-1, information on the
.Nm
device corresponding to the file descriptor passed to
.Xr ioctl 2
will be returned.
Otherwise,
.Va vnu_unit
may contain the unit number of another
.Nm
device.
This allows for opening just
.Li vnd0
and querying all available devices.
.Bd -literal -offset indent
struct vnd_user {
	char	vnufile[VNDNLEN];
	int	vnu_unit;
	dev_t	vnu_dev;
	ino_t	vnu_ino;
};
.Ed
.El
.Pp
Additionally, some
.Xr disklabel 8
related
.Xr ioctl 2
calls defined in
.In sys/dkio.h
are available:
.Dv DIOCGDINFO ,
.Dv DIOCSDINFO ,
and
.Dv DIOCWDINFO .
They are documented in
.Xr sd 4 .
.Sh FILES
.Bl -tag -width /dev/{,r}vnd* -compact
.It Pa /dev/{,r}vnd*
.Nm
device special files
.El
.Sh SEE ALSO
.Xr ioctl 2 ,
.Xr sd 4 ,
.Xr disklabel 5 ,
.Xr config 8 ,
.Xr disklabel 8 ,
.Xr fdisk 8 ,
.Xr fsck 8 ,
.Xr MAKEDEV 8 ,
.Xr mount 8 ,
.Xr newfs 8 ,
.Xr vnconfig 8
@


1.27
log
@obvious .Pa fixes; found with mandocdb(8)
@
text
@d1 1
a1 1
.\"	$OpenBSD: vnd.4,v 1.26 2011/06/05 18:42:05 matthew Exp $
d35 1
a35 1
.Dd $Mdocdate: June 5 2011 $
d140 1
a140 1
.In sys/disklabel.h
@


1.26
log
@Delete mention of DIOCWLABEL in sd(4) and vnd(4).
@
text
@d1 1
a1 1
.\"	$OpenBSD: vnd.4,v 1.25 2011/04/25 20:21:04 mk Exp $
d35 1
a35 1
.Dd $Mdocdate: April 25 2011 $
d80 1
a80 1
.Aq Pa dev/vndioctl.h :
d140 1
a140 1
.Aq Pa sys/disklabel.h
@


1.25
log
@Stating that ``Encryption only works with vnd devices.'' is kind of
silly in a manual that only covers vnd devices.  Get rid of svnd
leftovers.

``yes, clean it.'' deraadt
@
text
@d1 1
a1 1
.\"	$OpenBSD: vnd.4,v 1.24 2011/04/18 21:02:33 thib Exp $
d35 1
a35 1
.Dd $Mdocdate: April 18 2011 $
a143 1
.Dv DIOCWDINFO ,
d145 1
a145 1
.Dv DIOCWLABEL .
@


1.24
log
@As deraadt@@ points out, the history section is not quite right.
Rather then rewriting history, I've chosen to erase it; as it
contains only pointless trivia...

ok deraadt@@
@
text
@d1 1
a1 1
.\"	$OpenBSD: vnd.4,v 1.23 2011/04/18 20:54:13 jmc Exp $
a91 3
Encryption only works with
.Nm vnd
devices.
@


1.23
log
@sort SEE ALSO;
@
text
@d1 1
a1 1
.\"	$OpenBSD: vnd.4,v 1.22 2011/04/18 16:52:12 thib Exp $
a169 16
.Sh HISTORY
The
.Nm
disk driver was originally written at the University of Utah.
The
.Nm svnd
variant was first seen in
.Ox 2.1 .
The orginal
.Nm
was removed and the
.Nm svnd
variant was renamed to
.Nm
in
.Ox 4.9 .
@


1.22
log
@Deprecate vnds in favour of svnds.

In effect, this removes the "old" vndX nodes, and renames
the svndX nodes to vndX.

Old svndX nodes will still continue to work though, for now.

Cleanup accordingly.

ok deraadt@@, todd@@
comments and ok on the man page bits from jmc@@
@
text
@d1 1
a1 1
.\"	$OpenBSD: vnd.4,v 1.21 2008/03/17 16:30:36 sobrado Exp $
d35 1
a35 1
.Dd $Mdocdate: March 17 2008 $
a161 1
.Xr MAKEDEV 8 ,
d166 1
@


1.21
log
@command descriptions (.Nd macros) are usually lowercase

ok jmc@@
@
text
@d1 1
a1 1
.\"	$OpenBSD: vnd.4,v 1.20 2007/05/31 19:19:53 jmc Exp $
d35 1
a35 1
.Dd $Mdocdate: May 31 2007 $
d47 2
a48 15
This is useful for a variety of applications, including swap files and
building miniroot or floppy disk images.
There are two variants, the traditional
.Nm
that bypasses the buffer cache and thus is suitable for swap on files, but
not for building disk-images, and the
.Nm svnd
.Po
.Dq safe
.Nm
.Pc
variant that goes
through the buffer cache, thereby maintaining cache-coherency after the
block-device is closed which makes it suitable for creating disk images.
The latter is not good for swapping on, though.
d93 1
a93 1
.Nm svnd
d153 2
a154 2
.Bl -tag -width /dev/{,r}{,s}vnd* -compact
.It Pa /dev/{,r}{,s}vnd*
d173 1
a173 2
disk driver was originally written at the University of
Utah.
d178 1
a178 2
.Sh BUGS
The
d180 1
a180 2
driver does not work if the file does not reside in a local filesystem.
However the
d182 4
a185 1
variant does.
@


1.20
log
@convert to new .Dd format;
@
text
@d1 1
a1 1
.\"	$OpenBSD: vnd.4,v 1.19 2005/02/01 03:47:19 jaredy Exp $
d35 1
a35 1
.Dd $Mdocdate$
d40 1
a40 1
.Nd Vnode Disk Driver
@


1.19
log
@tweaks
@
text
@d1 1
a1 1
.\"	$OpenBSD: vnd.4,v 1.18 2005/01/11 09:12:09 jmc Exp $
d35 1
a35 1
.Dd December 30, 1995
@


1.18
log
@document vnd ioctls;
from matthias kilian, tweaked by myself;
@
text
@d1 1
a1 1
.\"	$OpenBSD: vnd.4,v 1.17 2004/03/21 19:47:59 miod Exp $
d51 1
a51 1
that bypasses the buffercache and thus is suitable for swap on files, but
d54 4
a57 2
("safe"
.Nm vnd )
d59 1
a59 1
through the buffercache, thereby maintaining cache-coherency after the
d63 1
a63 1
This document assumes that you're familiar with how to generate kernels,
d67 4
a70 4
In order to compile in support for the
.Nm vnd ,
you must add a line similar
to the following to your kernel configuration file:
d75 3
a77 1
The count argument is how many
d89 1
a89 1
.Pp
d106 3
a108 4
.Nm svnd .
The size of the configured
.Nm
device is returned in
d119 1
a119 1
Deassociate a
d123 1
a123 1
Get the associated file name, device, inode, and unit number of a
d138 3
a140 4
This allows for opening just vnd0 and querying all available
.Nm
devices, as is done in
.Xr vnconfig 8 .
d166 5
a170 1
/dev/{,r}{,s}vnd* \- vnd device special files.
@


1.17
log
@Homogeneize config lines for pseudo-devices, and do not put fixed values.
@
text
@d1 1
a1 1
.\"	$OpenBSD: vnd.4,v 1.16 2003/04/11 04:32:28 jmc Exp $
d85 78
d164 1
a164 1
/dev/{,r}{,s}vnd* - vnd device special files.
d166 2
@


1.16
log
@typos;

wscons(4): ok miod@@
@
text
@d1 1
a1 1
.\"	$OpenBSD: vnd.4,v 1.15 2002/09/26 22:09:53 miod Exp $
d42 1
a42 1
.Cd "pseudo-device vnd 4"
@


1.15
log
@Second part of the man4 mi cleanup.
- more/better xrefs
- sync .Cd lines with actual configuration files
- intro(4) reference police
- huge usb(4) update
- follow mdoc.samples suggested man page section ordering when necessary
- add netintro(4) and hostname.if(5) xrefs to all ethernet drivers

ok deraadt@@ mickey@@
@
text
@d1 1
a1 1
.\"	$OpenBSD: vnd.4,v 1.14 2001/10/05 14:45:53 mpech Exp $
d55 2
a56 2
.Nm
) variant that goes
d66 2
a67 2
.Nm
, you must add a line similar
d75 1
a75 1
memory is allocated for a boot time.
d92 1
a93 1
.Xr fdisk 8 ,
d98 3
a100 1
The vnode disk driver was originally written at the University of
d102 3
a104 1
The svnd variant was first seen in
@


1.14
log
@Powered by @@mantoya:
o) start new sentence on a new line;
o) minor mdoc fixes;
millert@@ ok

Tip of the day:   www.mpechismazohist.com
@
text
@d1 1
a1 1
.\"	$OpenBSD: vnd.4,v 1.13 2000/06/28 19:01:17 art Exp $
a84 7
.Sh BUGS
The
.Nm
driver does not work if the file does not reside in a local filesystem.
However the
.Nm svnd
variant does.
a86 5
.Sh HISTORY
The vnode disk driver was originally written at the University of
Utah.
The svnd variant was first seen in
.Ox 2.1 .
d88 1
d91 1
d93 1
d97 12
@


1.13
log
@Remove outdated comment about having to change kernel config
to be able to swap to vnds.
This was fixed in 2.6.
@
text
@d1 1
a1 1
.\"	$OpenBSD: vnd.4,v 1.12 2000/03/29 01:28:56 deraadt Exp $
d46 4
a49 3
driver provides a disk-like interface to a file.  This is useful for
a variety of applications, including swap files and building miniroot
or floppy disk images.  There are two variants, the traditional
d75 2
a76 1
memory is allocated for a boot time.  In this example, no more than 4
d96 2
a97 1
Utah.  The svnd variant was first seen in
@


1.12
log
@Xr repair
@
text
@d1 1
a1 1
.\"	$OpenBSD: vnd.4,v 1.11 1999/07/09 13:35:48 aaron Exp $
a89 6
.Pp
Currently, in order to be able to enable swap on a vnd device, the kernel
must have been configured for it, e.g.,
.Bd -unfilled -offset indent
config   bsd   root on sd0a swap on sd0b and vnd0c dumps on sd0b
.Ed
@


1.11
log
@- remove all trailing whitespace
     * except when it is escaped with a `\' at the end of the line
- fix remaining .Nm usage as well
- this is from a patch I received from kwesterback@@home.com, who has been
  working on some scripts for fixing formatting errors in mdoc'd man pages

Ok, so there could be a cost/benefit debate with this commit, but since I have
the patch we might as well commit it...
@
text
@d1 1
a1 1
.\"	$OpenBSD: vnd.4,v 1.10 1999/07/03 02:11:12 aaron Exp $
a104 1
.Xr config.old 8 ,
@


1.10
log
@remove redundant .Pp macros
@
text
@d1 1
a1 1
.\"	$OpenBSD: vnd.4,v 1.9 1999/06/05 13:18:33 aaron Exp $
d57 1
a57 1
block-device is closed which makes it suitable for creating disk images.  
@


1.9
log
@more .Os cleanup, remove some trailing whitespace, cleanse some .Nm
@
text
@d1 1
a1 1
.\"	$OpenBSD: vnd.4,v 1.8 1998/07/03 21:22:37 espie Exp $
a97 1
.Pp
@


1.8
log
@
Add gotcha to the list of current bugs, according to Niklas e-mail to misc.
@
text
@d1 1
a1 1
.\"	$OpenBSD: vnd.4,v 1.7 1998/06/08 17:14:36 deraadt Exp $
d37 1
a37 1
.Os OpenBSD
@


1.7
log
@clean
@
text
@d1 1
a1 1
.\"	$OpenBSD: vnd.4,v 1.6 1998/03/10 04:50:46 millert Exp $
d90 6
@


1.6
log
@use .Ox
@
text
@d1 1
a1 1
.\"	$OpenBSD: vnd.4,v 1.5 1997/05/14 15:34:05 niklas Exp $
d104 1
a104 1
.Xr vnconfig 8 .
@


1.5
log
@Document svnd
@
text
@d1 1
a1 1
.\"	$OpenBSD: vnd.4,v 1.1 1995/12/30 18:10:48 thorpej Exp $
d95 2
a96 1
Utah.  The svnd variant was first seen in OpenBSD 2.1
@


1.4
log
@disklabels work now
@
text
@d1 1
d48 11
a58 1
or floppy disk images.
d64 3
a66 1
In order to compile in support for the vnd, you must add a line similar
d87 3
d91 1
a91 1
/dev/{,r}vnd* - vnd device special files.
d95 1
a95 1
Utah.
@


1.3
log
@note in bugs that disklabels are not supported.
from netbsd-pr kern/2759 <jonathan@@DSG.Stanford.EDU>
@
text
@a73 3
The
.Nm
driver does not support disklabels at the moment.
@


1.2
log
@kernel is /bsd, os is OpenBSD
@
text
@d74 3
@


1.1
log
@from netbsd; vnd.4 manpage
@
text
@d36 1
a36 1
.Os NetBSD
@

