head	1.39;
access;
symbols
	OPENBSD_6_1_BASE:1.39
	OPENBSD_6_0:1.39.0.18
	OPENBSD_6_0_BASE:1.39
	OPENBSD_5_9:1.39.0.6
	OPENBSD_5_9_BASE:1.39
	OPENBSD_5_8:1.39.0.14
	OPENBSD_5_8_BASE:1.39
	OPENBSD_5_7:1.39.0.12
	OPENBSD_5_7_BASE:1.39
	OPENBSD_5_6:1.39.0.10
	OPENBSD_5_6_BASE:1.39
	OPENBSD_5_5:1.39.0.8
	OPENBSD_5_5_BASE:1.39
	OPENBSD_5_4:1.39.0.4
	OPENBSD_5_4_BASE:1.39
	OPENBSD_5_3:1.39.0.2
	OPENBSD_5_3_BASE:1.39
	OPENBSD_5_2:1.38.0.10
	OPENBSD_5_2_BASE:1.38
	OPENBSD_5_1_BASE:1.38
	OPENBSD_5_1:1.38.0.8
	OPENBSD_5_0:1.38.0.6
	OPENBSD_5_0_BASE:1.38
	OPENBSD_4_9:1.38.0.4
	OPENBSD_4_9_BASE:1.38
	OPENBSD_4_8:1.38.0.2
	OPENBSD_4_8_BASE:1.38
	OPENBSD_4_7:1.37.0.2
	OPENBSD_4_7_BASE:1.37
	OPENBSD_4_6:1.36.0.12
	OPENBSD_4_6_BASE:1.36
	OPENBSD_4_5:1.36.0.8
	OPENBSD_4_5_BASE:1.36
	OPENBSD_4_4:1.36.0.6
	OPENBSD_4_4_BASE:1.36
	OPENBSD_4_3:1.36.0.4
	OPENBSD_4_3_BASE:1.36
	OPENBSD_4_2:1.36.0.2
	OPENBSD_4_2_BASE:1.36
	OPENBSD_4_1:1.35.0.2
	OPENBSD_4_1_BASE:1.35
	OPENBSD_4_0:1.33.0.4
	OPENBSD_4_0_BASE:1.33
	OPENBSD_3_9:1.33.0.2
	OPENBSD_3_9_BASE:1.33
	OPENBSD_3_8:1.32.0.4
	OPENBSD_3_8_BASE:1.32
	OPENBSD_3_7:1.32.0.2
	OPENBSD_3_7_BASE:1.32
	OPENBSD_3_6:1.31.0.2
	OPENBSD_3_6_BASE:1.31
	OPENBSD_3_5:1.29.0.2
	OPENBSD_3_5_BASE:1.29
	OPENBSD_3_4:1.26.0.2
	OPENBSD_3_4_BASE:1.26
	OPENBSD_3_3:1.23.0.2
	OPENBSD_3_3_BASE:1.23
	OPENBSD_3_2:1.21.0.2
	OPENBSD_3_2_BASE:1.21
	OPENBSD_3_1:1.19.0.2
	OPENBSD_3_1_BASE:1.19
	OPENBSD_3_0:1.16.0.2
	OPENBSD_3_0_BASE:1.16
	OPENBSD_2_9:1.15.0.2
	OPENBSD_2_9_BASE:1.15
	OPENBSD_2_8:1.13.0.2
	OPENBSD_2_8_BASE:1.13
	OPENBSD_2_7:1.11.0.2
	OPENBSD_2_7_BASE:1.11
	OPENBSD_2_6:1.6.0.2
	OPENBSD_2_6_BASE:1.6
	OPENBSD_2_5:1.5.0.4
	OPENBSD_2_5_BASE:1.5
	OPENBSD_2_4:1.5.0.2
	OPENBSD_2_4_BASE:1.5
	OPENBSD_2_3:1.4.0.2
	OPENBSD_2_3_BASE:1.4
	OPENBSD_2_2:1.2.0.6
	OPENBSD_2_2_BASE:1.2
	OPENBSD_2_1:1.2.0.4
	OPENBSD_2_1_BASE:1.2
	OPENBSD_2_0:1.2.0.2
	OPENBSD_2_0_BASE:1.2;
locks; strict;
comment	@# @;


1.39
date	2012.08.14.01.08.19;	author dlg;	state Exp;
branches;
next	1.38;

1.38
date	2010.07.03.03.59.16;	author krw;	state Exp;
branches;
next	1.37;

1.37
date	2010.02.18.13.14.19;	author schwarze;	state Exp;
branches;
next	1.36;

1.36
date	2007.05.31.19.19.48;	author jmc;	state Exp;
branches;
next	1.35;

1.35
date	2006.10.28.10.26.26;	author jmc;	state Exp;
branches;
next	1.34;

1.34
date	2006.09.21.12.50.44;	author jmc;	state Exp;
branches;
next	1.33;

1.33
date	2005.12.10.22.58.46;	author martin;	state Exp;
branches;
next	1.32;

1.32
date	2004.09.30.19.59.24;	author mickey;	state Exp;
branches;
next	1.31;

1.31
date	2004.07.05.21.21.21;	author miod;	state Exp;
branches;
next	1.30;

1.30
date	2004.04.16.21.23.08;	author jmc;	state Exp;
branches;
next	1.29;

1.29
date	2004.03.05.03.13.39;	author krw;	state Exp;
branches;
next	1.28;

1.28
date	2003.11.09.16.06.07;	author jmc;	state Exp;
branches;
next	1.27;

1.27
date	2003.11.08.19.17.28;	author jmc;	state Exp;
branches;
next	1.26;

1.26
date	2003.06.06.10.29.41;	author jmc;	state Exp;
branches;
next	1.25;

1.25
date	2003.05.05.09.51.30;	author miod;	state Exp;
branches;
next	1.24;

1.24
date	2003.05.05.09.36.03;	author jmc;	state Exp;
branches;
next	1.23;

1.23
date	2003.03.14.10.07.35;	author jmc;	state Exp;
branches;
next	1.22;

1.22
date	2002.11.08.08.08.46;	author mpech;	state Exp;
branches;
next	1.21;

1.21
date	2002.09.26.07.55.39;	author miod;	state Exp;
branches;
next	1.20;

1.20
date	2002.06.29.02.05.03;	author smurph;	state Exp;
branches;
next	1.19;

1.19
date	2002.03.19.02.49.20;	author millert;	state Exp;
branches;
next	1.18;

1.18
date	2002.02.16.06.11.09;	author smurph;	state Exp;
branches;
next	1.17;

1.17
date	2002.01.24.23.00.05;	author mickey;	state Exp;
branches;
next	1.16;

1.16
date	2001.06.22.12.15.43;	author mpech;	state Exp;
branches;
next	1.15;

1.15
date	2000.12.21.18.15.13;	author avsm;	state Exp;
branches;
next	1.14;

1.14
date	2000.11.10.20.02.16;	author todd;	state Exp;
branches;
next	1.13;

1.13
date	2000.10.13.18.56.48;	author aaron;	state Exp;
branches;
next	1.12;

1.12
date	2000.05.26.17.46.10;	author deraadt;	state Exp;
branches;
next	1.11;

1.11
date	2000.04.28.06.53.26;	author deraadt;	state Exp;
branches;
next	1.10;

1.10
date	2000.04.09.20.53.59;	author aaron;	state Exp;
branches;
next	1.9;

1.9
date	2000.04.03.21.19.35;	author aaron;	state Exp;
branches;
next	1.8;

1.8
date	2000.03.22.03.17.04;	author smurph;	state Exp;
branches;
next	1.7;

1.7
date	2000.03.22.03.00.57;	author smurph;	state Exp;
branches;
next	1.6;

1.6
date	99.07.09.13.35.48;	author aaron;	state Exp;
branches;
next	1.5;

1.5
date	98.09.05.17.41.48;	author deraadt;	state Exp;
branches;
next	1.4;

1.4
date	98.03.16.23.30.56;	author gene;	state Exp;
branches;
next	1.3;

1.3
date	98.03.09.02.45.49;	author millert;	state Exp;
branches;
next	1.2;

1.2
date	96.10.04.02.02.03;	author deraadt;	state Exp;
branches;
next	1.1;

1.1
date	96.07.27.10.50.08;	author deraadt;	state Exp;
branches;
next	;


desc
@@


1.39
log
@kernel configs dont need "scsibus* at foo?" anymore.

"guess you get more commits" deraadt@@
@
text
@.\"	$OpenBSD: ahc.4,v 1.38 2010/07/03 03:59:16 krw Exp $
.\"	$NetBSD: ahc.4,v 1.1.2.1 1996/08/25 17:22:14 thorpej Exp $
.\"
.\" Copyright (c) 1995, 1996
.\" 	Justin T. Gibbs.  All rights reserved.
.\"
.\" Redistribution and use in source and binary forms, with or without
.\" modification, are permitted provided that the following conditions
.\" are met:
.\" 1. Redistributions of source code must retain the above copyright
.\"    notice, this list of conditions and the following disclaimer.
.\" 2. Redistributions in binary form must reproduce the above copyright
.\"    notice, this list of conditions and the following disclaimer in the
.\"    documentation and/or other materials provided with the distribution.
.\" 3. The name of the author may not be used to endorse or promote products
.\"    derived from this software without specific prior written permission.
.\"
.\" THIS SOFTWARE IS PROVIDED BY THE AUTHOR ``AS IS'' AND ANY EXPRESS OR
.\" IMPLIED WARRANTIES, INCLUDING, BUT NOT LIMITED TO, THE IMPLIED WARRANTIES
.\" OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE ARE DISCLAIMED.
.\" IN NO EVENT SHALL THE AUTHOR BE LIABLE FOR ANY DIRECT, INDIRECT,
.\" INCIDENTAL, SPECIAL, EXEMPLARY, OR CONSEQUENTIAL DAMAGES (INCLUDING, BUT
.\" NOT LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES; LOSS OF USE,
.\" DATA, OR PROFITS; OR BUSINESS INTERRUPTION) HOWEVER CAUSED AND ON ANY
.\" THEORY OF LIABILITY, WHETHER IN CONTRACT, STRICT LIABILITY, OR TORT
.\" (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE USE OF
.\" THIS SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.
.\"
.\"
.Dd $Mdocdate: July 3 2010 $
.Dt AHC 4
.Os
.Sh NAME
.Nm ahc
.Nd Adaptec VL/EISA/PCI SCSI interface
.Sh SYNOPSIS
.Cd "ahc0	at isa?	" Pq VL
.Cd "ahc*	at eisa?	" Pq EISA
.Cd "ahc*	at pci?	" Pq PCI
.Cd "option AHC_ALLOW_MEMIO"
.Cd "option AHC_TMODE_ENABLE"
.Sh DESCRIPTION
This driver provides access to the
.Tn SCSI
bus(es) connected to Adaptec
.Tn AIC7770 ,
.Tn AIC7850 ,
.Tn AIC7860 ,
.Tn AIC7870 ,
.Tn AIC7880 ,
.Tn AIC7890 ,
.Tn AIC7891 ,
.Tn AIC7892 ,
.Tn AIC7895 ,
.Tn AIC7896 ,
.Tn AIC7897
and
.Tn AIC7899
host adapter chips.
These chips are found on many motherboards as well as the following
Adaptec SCSI controller cards:
.Tn 274X(W) ,
.Tn 274X(T) ,
.Tn 284X ,
.Tn 2910 ,
.Tn 2915 ,
.Tn 2920 ,
.Tn 2930C ,
.Tn 2930U2 ,
.Tn 2940 ,
.Tn 2940J ,
.Tn 2940N ,
.Tn 2940U ,
.Tn 2940AU ,
.Tn 2940UW ,
.Tn 2940UW Dual ,
.Tn 2940UW Pro ,
.Tn 2940U2W ,
.Tn 2940U2B ,
.Tn 2950U2W ,
.Tn 2950U2B ,
.Tn 19160B ,
.Tn 29160B ,
.Tn 29160N ,
.Tn 3940 ,
.Tn 3940U ,
.Tn 3940AU ,
.Tn 3940UW ,
.Tn 3940AUW ,
.Tn 3940U2W ,
.Tn 3950U2 ,
.Tn 3960 ,
.Tn 39160 ,
.Tn 3985 ,
and
.Tn 4944UW .
.Pp
Driver features include support for twin and wide buses,
fast, ultra, ultra2 and ultra160 synchronous transfers depending on
controller type, tagged queuing, and SCB paging, and target mode.
.Pp
Memory mapped I/O can be enabled for PCI devices with the
.Dq Dv AHC_ALLOW_MEMIO
configuration option.
Memory mapped I/O is more efficient than the alternative, programmed I/O.
Most PCI BIOSes will map devices so that either technique for communicating
with the card is available.
In some cases,
usually when the PCI device is sitting behind a PCI->PCI bridge,
the BIOS may fail to properly initialize the chip for memory mapped I/O.
The typical symptom of this problem is a system hang if memory mapped I/O
is attempted.
Most modern motherboards perform the initialization correctly and work fine
with this option enabled.
This is the default mode of operation on every architecture except i386.
.Pp
Individual controllers may be configured to operate in the target role through
the
.Dq Dv AHC_TMODE_ENABLE
configuration option.
The value assigned to this option should be a bitmap of all units where target
mode is desired.
For example, a value of 0x25, would enable target mode on units 0, 2, and 5.
A value of 0x8a enables it for units 1, 3, and 7.
.Pp
Per target configuration performed in the
.Tn SCSI-Select
menu, accessible at boot
in
.No non- Ns Tn EISA
models,
or through an
.Tn EISA
configuration utility for
.Tn EISA
models,
is honored by this driver.
This includes synchronous/asynchronous transfers,
maximum synchronous negotiation rate,
wide transfers,
disconnection,
the host adapter's SCSI ID,
and,
in the case of
.Tn EISA
Twin Channel controllers,
the primary channel selection.
For systems that store non-volatile settings in a system specific manner
rather than a serial eeprom directly connected to the aic7xxx controller,
the
.Tn BIOS
must be enabled for the driver to access this information.
This restriction applies to all
.Tn EISA
and many motherboard configurations.
.Pp
Note that I/O addresses are determined automatically by the probe routines,
but care should be taken when using a 284x
.Pq Tn VESA No local bus controller
in an
.Tn EISA
system.
The jumpers setting the I/O area for the 284x should match the
.Tn EISA
slot into which the card is inserted to prevent conflicts with other
.Tn EISA
cards.
.Pp
Performance and feature sets vary throughout the aic7xxx product line.
The following table provides a comparison of the different chips supported by
the
.Nm
driver.
Note that wide and twin channel features, although always supported by a
particular chip, may be disabled in a particular motherboard or card design.
.Bd -literal
.Em "Chip       MIPS    Bus      MaxSync   MaxWidth  SCBs  Features"
aic7770     10    EISA/VL    10MHz     16Bit     4    1
aic7850     10    PCI/32     10MHz      8Bit     3
aic7860     10    PCI/32     20MHz      8Bit     3
aic7870     10    PCI/32     10MHz     16Bit    16
aic7880     10    PCI/32     20MHz     16Bit    16
aic7890     20    PCI/32     40MHz     16Bit    16        3 4 5 6 7 8
aic7891     20    PCI/64     40MHz     16Bit    16        3 4 5 6 7 8
aic7892     20    PCI/64     80MHz     16Bit    16        3 4 5 6 7 8
aic7895     15    PCI/32     20MHz     16Bit    16      2 3 4 5
aic7895C    15    PCI/32     20MHz     16Bit    16      2 3 4 5     8
aic7896     20    PCI/32     40MHz     16Bit    16      2 3 4 5 6 7 8
aic7897     20    PCI/64     40MHz     16Bit    16      2 3 4 5 6 7 8
aic7899     20    PCI/64     80MHz     16Bit    16      2 3 4 5 6 7 8
.Ed
.Pp
.Bl -enum -compact
.It
Multiplexed Twin Channel Device - One controller servicing two buses.
.It
Multi-function Twin Channel Device - Two controllers on one chip.
.It
Command Channel Secondary DMA Engine - Allows scatter gather list and
SCB prefetch.
.It
64 Byte SCB Support - SCSI CDB is embedded in the SCB to eliminate an extra DMA.
.It
Block Move Instruction Support - Doubles the speed of certain sequencer
operations.
.It
.Sq Bayonet
style Scatter Gather Engine - Improves S/G prefetch performance.
.It
Queuing Registers - Allows queuing of new transactions without pausing the
sequencer.
.It
Ultra160 support.
.It
Multiple Target IDs - Allows the controller to respond to selection as a target
on multiple SCSI IDs.
.El
.Sh SCSI CONTROL BLOCKS (SCBs)
Every transaction sent to a device on the SCSI bus is assigned a
.Sq SCSI Control Block
(SCB).
The SCB contains all of the information required by the controller to process a
transaction.
The chip feature table lists the number of SCBs that can be stored in on-chip
memory.
All chips with model numbers greater than or equal to 7870 allow for the
on-chip SCB space to be augmented with external SRAM up to a maximum of 255
SCBs.
Very few Adaptec controller configurations have external SRAM.
.Pp
If external SRAM is not available,
SCBs are a limited resource.
Using the SCBs in a straight forward manner would only allow the driver to
handle as many concurrent transactions as there are physical SCBs.
To fully utilize the SCSI bus and the devices on it,
requires much more concurrency.
The solution to this problem is
.Em SCB Paging ,
a concept similar to memory paging.
SCB paging takes advantage of the fact that devices usually disconnect from the
SCSI bus for long periods of time without talking to the controller.
The SCBs for disconnected transactions are only of use to the controller when
the transfer is resumed.
When the host queues another transaction for the controller to execute,
the controller firmware will use a free SCB if one is available.
Otherwise, the state of the most recently disconnected (and therefore most
likely to stay disconnected) SCB is saved, via DMA, to host memory,
and the local SCB reused to start the new transaction.
This allows the controller to queue up to 255 transactions regardless of the
amount of SCB space.
Since the local SCB space serves as a cache for disconnected transactions,
the more SCB space available, the less host bus traffic consumed saving and
restoring SCB data.
.Sh SEE ALSO
.Xr ahd 4 ,
.Xr cd 4 ,
.Xr ch 4 ,
.Xr eisa 4 ,
.Xr intro 4 ,
.Xr isa 4 ,
.Xr pci 4 ,
.Xr scsi 4 ,
.Xr sd 4 ,
.Xr st 4 ,
.Xr uk 4
.Sh AUTHORS
The core
.Nm
driver, the
.Tn AIC7xxx
sequencer-code assembler, and the firmware running on the aic7xxx chips
were written by
.An Justin T. Gibbs .
.Pp
The
.Ox
platform dependent code was written by Steve P. Murphree, Jr and Kenneth
R. Westerback.
.Sh BUGS
Some Quantum drives (at least the Empire 2100 and 1080s) will not run on an
.Tn AIC7870
Rev B in synchronous mode at 10MHz.
Controllers with this problem have a 42 MHz clock crystal on them and run
slightly above 10MHz.
This confuses the drive and hangs the bus.
Setting a maximum synchronous negotiation rate of 8MHz in the
.Tn SCSI-Select
utility will allow normal operation.
.Pp
Although the Ultra2 and Ultra160 products have sufficient instruction RAM space
to support both the initiator and target roles concurrently,
this configuration is disabled in favor of allowing the target role to respond
on multiple target ids.
A method for configuring dual role mode should be provided.
.Pp
Tagged Queuing is not supported in target mode.
.Pp
Reselection in target mode fails to function correctly on all high voltage
differential boards as shipped by Adaptec.
Information on how to modify HVD board to work correctly in target mode is
available from Adaptec.
@


1.38
log
@No more ss(4) or usscanner(4). Unused, unloved and unmaintained.
General huzzahs.

"go for it" deraadt@@
@
text
@d1 1
a1 1
.\"	$OpenBSD: ahc.4,v 1.37 2010/02/18 13:14:19 schwarze Exp $
d30 1
a30 1
.Dd $Mdocdate: February 18 2010 $
a39 1
.Cd "scsibus* at ahc?"
@


1.37
log
@Groff cannot handle so many columns when using the proper syntax
involving .It, so we cannot use .Bl -column here and switch to .Bd.
Found by and unbreaking the build with mandoc(1).
While here, reduce the indentation, it looks better.
OK jmc@@
@
text
@d1 1
a1 1
.\"	$OpenBSD: ahc.4,v 1.36 2007/05/31 19:19:48 jmc Exp $
d30 1
a30 1
.Dd $Mdocdate: May 31 2007 $
a264 1
.Xr ss 4 ,
@


1.36
log
@convert to new .Dd format;
@
text
@d1 1
a1 1
.\"	$OpenBSD: ahc.4,v 1.35 2006/10/28 10:26:26 jmc Exp $
d30 1
a30 1
.Dd $Mdocdate$
d177 1
a177 2
.Bd -ragged -offset indent
.Bl -column "aic7770 " "10 " "EISA/VL  " "10MHz " "16bit " "SCBs " Features
d192 1
a192 1
.El
a218 1
.Ed
@


1.35
log
@prefer `buses' to `busses' for the noun plural;
@
text
@d1 1
a1 1
.\"	$OpenBSD: ahc.4,v 1.34 2006/09/21 12:50:44 jmc Exp $
d30 1
a30 1
.Dd March 4, 2002
@


1.34
log
@sync the eisa scsi devices;
@
text
@d1 1
a1 1
.\"	$OpenBSD: ahc.4,v 1.33 2005/12/10 22:58:46 martin Exp $
d197 1
a197 1
Multiplexed Twin Channel Device - One controller servicing two busses.
@


1.33
log
@- standard synopsis, mention options
- ram->RAM
- memory mapped I/O is default on everything except i386

ok krw@@ jmc@@
@
text
@d1 1
a1 1
.\"	$OpenBSD: ahc.4,v 1.32 2004/09/30 19:59:24 mickey Exp $
d35 1
a35 1
.Nd Adaptec VL/EISA/PCI SCSI host adapter driver
@


1.32
log
@kill default locators
@
text
@d1 1
a1 1
.\"	$OpenBSD: ahc.4,v 1.31 2004/07/05 21:21:21 miod Exp $
d37 3
a39 10
For VL cards:
.Cd "ahc0	at isa?"
.Pp
For EISA cards:
.Cd "ahc*	at eisa?"
.Pp
For PCI cards:
.Cd "ahc*	at pci?"
.Pp
For SCSI buses:
d41 2
d116 1
d294 1
a294 1
Although the Ultra2 and Ultra160 products have sufficient instruction ram space
@


1.31
log
@Xref ahd(4).
@
text
@d1 1
a1 1
.\"	$OpenBSD: ahc.4,v 1.30 2004/04/16 21:23:08 jmc Exp $
d38 1
a38 1
.Cd "ahc0	at isa? port ? irq ?"
d41 1
a41 1
.Cd "ahc*	at eisa? slot ?"
d44 1
a44 1
.Cd "ahc*	at pci? dev ? function ?"
@


1.30
log
@list/display fixes, and whitespace;
@
text
@d1 1
a1 1
.\"	$OpenBSD: ahc.4,v 1.29 2004/03/05 03:13:39 krw Exp $
d262 1
@


1.29
log
@Sync man page with Net/FreeBSD, as we have sync'ed the driver.
@
text
@d1 1
a1 1
.\"	$OpenBSD: ahc.4,v 1.28 2003/11/09 16:06:07 jmc Exp $
a180 1
.Pp
@


1.28
log
@remove .Pp's before lists and displays;
@
text
@d1 1
a1 1
.\"	$OpenBSD: ahc.4,v 1.27 2003/11/08 19:17:28 jmc Exp $
d30 1
a30 1
.Dd March 20, 2000
d62 2
a63 3
.Tn AIC7892 ,
.Tn AIC7897 ,
or
d71 4
a74 1
.Tn 2920C ,
a75 1
.Tn 2930CU ,
d77 2
d83 1
d88 3
a90 2
.Tn 19160 ,
.Tn 29160 ,
d99 2
a100 1
.Tn 3960D ,
d102 1
a102 1
.Tn 3985 .
d106 1
a106 1
controller type, tagged queuing, and SCB paging.
d116 2
a117 2
the BIOS fails to properly initialize the chip for memory mapped I/O.
The symptom of this problem is usually a system hang if memory mapped I/O
d122 9
d142 14
a155 1
is honored by this driver with the stipulation that the
d157 9
a165 1
must be enabled for
d167 4
a170 4
adaptors.
This includes synchronous/asynchronous transfers, maximum synchronous
negotiation rate, disconnection, the host adapter's SCSI ID, and,
in the case of
d172 1
a172 1
Twin Channel controllers, the primary channel selection.
d175 2
a176 2
The following table provides a comparison of the different chips
supported by the
d181 2
a182 1
.Bd -filled -offset indent
d184 2
a185 2
.Em "Chip       MIPS    Bus      MaxSync   MaxWidth  SCBs Features"
aic7770     10    EISA/VL    10MHz     16Bit     4   1
d190 8
a197 7
aic7890     20    PCI/32     40MHz     16Bit    16       3 4 5 6 7
aic7891     20    PCI/64     40MHz     16Bit    16       3 4 5 6 7
aic7892     20    PCI/64     40MHz     16Bit    32       3 4 5 6 7 8
aic7895     15    PCI/32     20MHz     16Bit    16     2 3 4 5
aic7896     20    PCI/32     40MHz     16Bit    16     2 3 4 5 6 7
aic7897     20    PCI/64     40MHz     16Bit    16     2 3 4 5 6 7
aic7899     20    PCI/64     40MHz     16Bit    32       3 4 5 6 7 8
d202 1
a202 1
Multiplexed Twin Channel Device - One controller servicing two buses.
d221 3
d230 4
a233 4
The SCB contains all of the information required by the
controller to process a transaction.
The chip feature table lists the number of SCBs that can be stored
in on chip memory.
d235 10
a244 9
on-chip SCB space to be augmented with external SRAM up to a
maximum of 255 SCBs.
Very few Adaptec controller have external SRAM.
.Pp
If external SRAM is not available, SCBs are a limited resource and
using them in a straightforward manner would only allow us to
keep as many transactions as there are SCBs outstanding at a time.
This would not allow enough concurrency to fully utilize the SCSI
bus and its devices.
d248 4
a251 4
SCB paging takes advantage of the fact that devices usually disconnect from
the SCSI bus for long periods of time without talking to the controller.
The SCBs for disconnected transactions are only of use to the controller
when the transfer is resumed.
d257 2
a258 2
This allows the controller to queue up to 255 transactions regardless
of the amount of SCB space.
d260 2
a261 2
the more SCB space available, the less host bus traffic consumed saving
and restoring SCB data.
d285 2
a286 1
platform dependent code was written by Steve P. Murphree, Jr.
d291 2
a292 2
Controllers with this problem have a 42 MHz clock crystal on them and
run slightly above 10MHz.
d297 13
a309 1
Some disks that don't do tagged queuing will fail.
@


1.27
log
@typos from Jonathon Gray;
@
text
@d1 1
a1 1
.\"	$OpenBSD: ahc.4,v 1.26 2003/06/06 10:29:41 jmc Exp $
a144 1
.Pp
@


1.26
log
@- section reorder
- some macro fixes
- kill whitespace at EOL
@
text
@d1 1
a1 1
.\"	$OpenBSD: ahc.4,v 1.25 2003/05/05 09:51:30 miod Exp $
d244 1
a244 1
platform dependant code was written by Steve P. Murphree, Jr.
@


1.25
log
@Remove FreeBSD configuration lines in SYNOPSIS that slipped through the
previous commit.
@
text
@d1 1
a1 1
.\"	$OpenBSD: ahc.4,v 1.24 2003/05/05 09:36:03 jmc Exp $
d52 12
a63 12
.Tn AIC7770,
.Tn AIC7850,
.Tn AIC7860,
.Tn AIC7870,
.Tn AIC7880,
.Tn AIC7890,
.Tn AIC7891,
.Tn AIC7892
.Tn AIC7895,
.Tn AIC7896,
.Tn AIC7892,
.Tn AIC7897,
d69 26
a94 26
.Tn 274X(W),
.Tn 274X(T),
.Tn 284X,
.Tn 2920C,
.Tn 2930U2,
.Tn 2930CU,
.Tn 2940,
.Tn 2940U,
.Tn 2940AU,
.Tn 2940UW,
.Tn 2940UW Dual,
.Tn 2940U2W,
.Tn 2940U2B,
.Tn 2950U2W,
.Tn 2950U2B,
.Tn 19160,
.Tn 29160,
.Tn 3940,
.Tn 3940U,
.Tn 3940AU,
.Tn 3940UW,
.Tn 3940AUW,
.Tn 3940U2W,
.Tn 3950U2,
.Tn 3960,
.Tn 3960D,
d96 1
a96 1
.Tn 3985,
@


1.24
log
@- removed groff macros that were not formatting SYNOPSIS properly
- more logical order for SYNOPSIS
- plural of bus is buses
- more than one SCSI bus gets you "scsibus0 at ahc0", not "scbus0 at ahc0"
	(from Leandro Costa)
- kill whitespace at EOL
@
text
@d1 1
a1 1
.\"	$OpenBSD: ahc.4,v 1.23 2003/03/14 10:07:35 jmc Exp $
a42 4
For one or more VL/EISA cards:
.Cd "controller eisa0"
.Cd "controller ahc0"
.Pp
a45 4
For one or more PCI cards:
.Cd "controller pci0"
.Cd "controller ahc0"
.Pp
a47 3
.Pp
For one or more SCSI buses:
.Cd "controller scsibus0 at ahc0"
@


1.23
log
@typos;

audio(4): ok naddy@@
cardbus(4): ok deraadt@@
@
text
@d1 1
a1 1
.\"	$OpenBSD: ahc.4,v 1.22 2002/11/08 08:08:46 mpech Exp $
d37 6
a42 1
.ie 0 \{
d44 2
a45 5
.Cd controller eisa0
.Cd controller ahc0
\}
\{For VL cards:
.Cd ahc0	at isa? port ? irq ?
d47 2
a48 2
For EISA cards:
.Cd ahc*	at eisa? slot ?\}
a49 1
.ie 0 \{
d51 8
a58 12
.Cd controller pci0
.Cd controller ahc0
\}
\{For PCI cards:
.Cd ahc*	at pci? dev ? function ?\}
.Pp
.ie 0 \{
For one or more SCSI busses:
.Cd controller scbus0 at ahc0
\}
\{For SCSI busses:
.Cd scsibus* at ahc?\}
d109 1
a109 1
Driver features include support for twin and wide busses,
d167 1
a167 1
aic7892     20    PCI/64     40MHz     16Bit    32       3 4 5 6 7 8 
d176 1
a176 1
Multiplexed Twin Channel Device - One controller servicing two busses.
d251 1
a251 1
.An Justin T. Gibbs .  
@


1.22
log
@Time to cleanup:
o) start new sentence on a new line;
o) wrap long lines;
o) don't use .Pp before/after .Sh, .Ss;
o) OpenBSD -> .Ox;
o) typos;
o) close .Rs;
o) use space between arguments in tag, for example:
   .Xr blabla ) .

miod@@ ok
@
text
@d1 1
a1 1
.\"	$OpenBSD: ahc.4,v 1.21 2002/09/26 07:55:39 miod Exp $
d214 1
a214 1
using them in a straight forward manner would only allow us to
@


1.21
log
@Incomplete section 4 mi manual page cleanup.
- make configuration lines match GENERIC files
- more Xr (hopefully usefule Xr)
- never mention intro(4) on non-physical devices (i.e. protocols), always
mention it for physical devices
- random text style and quoting fixes
- drivers ported from FreeBSD did mention rc.conf instead of hostname.if as
the place to put mediaopt
- some .Tn UNIX -> .Ox replacements
- etc, etc...

reviewd in part by deraadt@@ (until he got bored of this)
@
text
@d1 1
a1 1
.\"	$OpenBSD: ahc.4,v 1.20 2002/06/29 02:05:03 smurph Exp $
d113 2
a114 2
fast, ultra, ultra2 and ultra160 synchronous transfers depending on controller type,
tagged queuing, and SCB paging.
d256 3
a258 1
The OpenBSD platform dependant code was written by Steve P. Murphree, Jr.
d268 2
a269 2
utility will allow normal operation.  Some disks that don't do tagged queuing 
will fail.
@


1.20
log
@Add supported controllers.  And a warning.
@
text
@d1 1
a1 1
.\"	$OpenBSD: ahc.4,v 1.19 2002/03/19 02:49:20 millert Exp $
d236 2
a237 2
.Xr aha 4 ,
.Xr ahb 4 ,
d239 1
d241 6
a246 1
.Xr pci 4
@


1.19
log
@revert to older ahc driver until the new one's bugs are fixed
@
text
@d1 1
a1 1
.\"	$OpenBSD: ahc.4,v 1.17 2002/01/24 23:00:05 mickey Exp $
d73 1
d98 1
d107 2
d110 1
a110 1
.Tn 3985.
d113 1
a113 1
fast, ultra and ultra2 synchronous transfers depending on controller type,
d162 2
a163 2
.Em "Chip       MIPS    Bus      MaxSync   MaxWidth  SCBs  Features"
aic7770     10    EISA/VL    10MHz     16Bit     4    1
d168 7
a174 5
aic7890     20    PCI/32     40MHz     16Bit    16        3 4 5 6 7
aic7891     20    PCI/64     40MHz     16Bit    16        3 4 5 6 7
aic7895     15    PCI/32     20MHz     16Bit    16      2 3 4 5
aic7896     20    PCI/32     40MHz     16Bit    16      2 3 4 5 6 7
aic7897     20    PCI/64     40MHz     16Bit    16      2 3 4 5 6 7
d196 2
d242 1
a242 1
The
d248 3
a250 1
.An Justin T. Gibbs .
d260 2
a261 1
utility will allow normal operation.
@


1.18
log
@update for new ahc driver.
@
text
@a72 1
.Tn AIC7892,
d75 1
d109 2
a110 2
fast, ultra, ultra2, and ultra160 synchronous transfers 
depending on controller type, tagged queuing, and SCB paging.
a165 1
aic7892     20    PCI/64     80MHz     16Bit    16        3 4 5 6 7
a168 1
aic7899     20    PCI/64     80MHz     16Bit    16      2 3 4 5 6 7
d234 1
a234 1
The core 
a240 1
The OpenBSD platform code was written by Steve Murphree, Jr.
@


1.17
log
@eisa page and xref it
@
text
@d1 1
a1 1
.\"	$OpenBSD: ahc.4,v 1.16 2001/06/22 12:15:43 mpech Exp $
d73 1
a75 1
.Tn AIC7892,
d109 2
a110 2
fast, ultra and ultra2 synchronous transfers depending on controller type,
tagged queuing, and SCB paging.
d166 1
d170 1
d236 1
a236 1
The
d243 1
@


1.16
log
@o) remove unnecessary .Pp;
o) remove unnecessary .Nm args;
o) closes .Bl;
o) .Sh AUTHOR -> .Sh AUTHORS;
o) sort SEE ALSO;
o) better -mdoc style;
o) typos;

aaron@@ ok.
@
text
@d1 1
a1 1
.\"	$OpenBSD: ahc.4,v 1.15 2000/12/21 18:15:13 avsm Exp $
d229 4
a232 1
.Xr ahb 4
@


1.15
log
@fix typos, aaron@@ ok
@
text
@d1 1
a1 1
.\"	$OpenBSD: ahc.4,v 1.14 2000/11/10 20:02:16 todd Exp $
a191 2
.Pp

@


1.14
log
@.Sh AUTHOR -> AUTHORS, ok aaron@@
@
text
@d1 1
a1 1
.\"	$OpenBSD: ahc.4,v 1.13 2000/10/13 18:56:48 aaron Exp $
d16 1
a16 1
.\"    derived from this software withough specific prior written permission.
d110 1
a110 1
tagged queueing, and SCB paging.
d211 1
a211 1
bus and it's devices.
@


1.13
log
@Purely mdoc fixes.
@
text
@d1 1
a1 1
.\"	$OpenBSD: ahc.4,v 1.12 2000/05/26 17:46:10 deraadt Exp $
d232 1
a232 1
.Sh AUTHOR
@


1.12
log
@add another model
@
text
@d1 1
a1 1
.\"	$OpenBSD: ahc.4,v 1.11 2000/04/28 06:53:26 deraadt Exp $
a30 2
.\".Dt AHC 4
.\".Os FreeBSD
d141 3
a143 5
adaptors.  This includes synchronous/asynchronous transfers,
maximum synchronous negotiation rate,
disconnection,
the host adapter's SCSI ID,
and,
d146 1
a146 2
Twin Channel controllers,
the primary channel selection.
d149 2
a150 2
The following table provides a comparison of the different chips supported
by the
d152 3
a154 3
driver.  Note that wide and twin channel features, although always supported
by a particular chip, may be disabled in a particular motherboard or card
design.
d197 8
a204 5
(SCB).  The SCB contains all of the information required by the
controller to process a transaction.  The chip feature table lists
the number of SCBs that can be stored in on chip memory.  All chips
with model numbers greater than or equal to 7870 allow for the on chip
SCB space to be augmented with external SRAM up to a maximum of 255 SCBs.
d206 1
a206 1

d214 14
a227 13
a concept similar to memory paging.  SCB paging takes advantage of
the fact that devices usually disconnect from the SCSI bus for long
periods of time without talking to the controller.  The SCBs
for disconnected transactions are only of use to the controller
when the transfer is resumed.  When the host queues another transaction
for the controller to execute, the controller firmware will use a
free SCB if one is available.  Otherwise, the state of the most recently
disconnected (and therefor most likely to stay disconnected) SCB is
saved, via dma, to host memory, and the local SCB reused to start
the new transaction.  This allows the controller to queue up to
255 transactions regardless of the amount of SCB space.  Since the
local SCB space serves as a cache for disconnected transactions, the
more SCB space available, the less host bus traffic consumed saving
a228 11
.Sh BUGS
Some Quantum drives (at least the Empire 2100 and 1080s) will not run on an
.Tn AIC7870
Rev B in synchronous mode at 10MHz.  Controllers with this problem have a
42 MHz clock crystal on them and run slightly above 10MHz.  This confuses
the drive and hangs the bus.  Setting a maximum synchronous negotiation rate
of 8MHz in the
.Tn SCSI-Select
utility
will allow normal operation.

a231 6
.if 0 \{
.Xr cd 4 ,
.Xr scsi 4 ,
.Xr sd 4 ,
.Xr st 4
\}
d237 2
a238 2
sequencer-code assembler,
and the firmware running on the aic7xxx chips was written by
d240 10
a249 1

@


1.11
log
@few tweaks
@
text
@d1 1
a1 1
.\"	$OpenBSD: ahc.4,v 1.10 2000/04/09 20:53:59 aaron Exp $
d89 1
@


1.10
log
@Tagged queueing now supported.
@
text
@d1 1
a1 1
.\"	$OpenBSD: ahc.4,v 1.9 2000/04/03 21:19:35 aaron Exp $
d77 2
d80 1
a80 1
.Tn AIC7897
d98 1
@


1.9
log
@Remove trailing whitespace.
@
text
@d1 1
a1 1
.\"	$OpenBSD: ahc.4,v 1.8 2000/03/22 03:17:04 smurph Exp $
d108 1
a108 1
and SCB paging.
@


1.8
log
@removed reference to tagged queuing.
@
text
@d1 1
a1 1
.\"	$OpenBSD: ahc.4,v 1.7 2000/03/22 03:00:57 smurph Exp $
d124 1
a124 1
Per target configuration performed in the 
d127 1
a127 1
in 
d130 1
a130 1
or through an 
d132 1
a132 1
configuration utility for 
d135 1
a135 1
is honored by this driver with the stipulation that the 
d137 1
a137 1
must be enabled for 
d164 1
a164 1
aic7880     10    PCI/32     20MHz     16Bit    16 
d170 1
a170 1
.El 
d232 1
a232 1
of 8MHz in the 
@


1.7
log
@new ahc driver.  Adds support for newer Adaptec controllers.  This represents two months of work.
@
text
@d1 1
a1 1
.\"	$OpenBSD: ahc.4,v 1.6 1999/07/09 13:35:48 aaron Exp $
a107 1
tagged queuing,
@


1.6
log
@- remove all trailing whitespace
     * except when it is escaped with a `\' at the end of the line
- fix remaining .Nm usage as well
- this is from a patch I received from kwesterback@@home.com, who has been
  working on some scripts for fixing formatting errors in mdoc'd man pages

Ok, so there could be a cost/benefit debate with this commit, but since I have
the patch we might as well commit it...
@
text
@d1 1
a1 1
.\"	$OpenBSD: ahc.4,v 1.5 1998/09/05 17:41:48 deraadt Exp $
d30 1
a30 1
.Dd April 20, 1996
a57 6
To enable tagged queuing:
.Cd option AHC_TAGENABLE
.Pp
To enable SCB paging:
.Cd options AHC_SCBPAGING_ENABLE
.Pp
d67 1
a67 2
bus connected to an Adaptec
274x, 284x, 2940, 3940, or controllers based on the
d72 5
d78 1
a78 1
.Tn AIC7880
d80 28
a107 4
Features include support for twin and wide busses,
ultra
.Tn SCSI,
two active commands at a time per non-tagged queuing target,
d109 4
a112 9
and SCB paging which allows up to 255 active commands on all adapters
except those using
.Tn AIC7770
chips prior to revision E.
Tagged queuing is enabled with the
.Dq Dv AHC_TAGENABLE
configuration option.
SCB paging is enabled with the
.Dq Dv AHC_SCBPAGING_ENABLE
d114 10
d125 1
a125 1
Per target configuration performed in the
d128 1
a128 1
in
d130 2
a131 1
models or through an
d133 1
a133 1
configuration utility for
d136 1
a136 1
is honored by this driver with the stipulation that the
d138 1
a138 1
must be enabled for
d143 84
a226 12
and the host adapter's SCSI ID.
.Pp
Note that I/O addresses are determined automatically by the probe routines,
but care should be taken when using a 284x
.Pq Tn VESA No local bus controller
in an
.Tn EISA
system.  Ensure that the jumpers setting the I/O area for the 284x match the
.Tn EISA
slot into which the card is inserted to prevent conflicts with other
.Tn EISA
cards.
d231 3
a233 3
42 MHz clock crystal on them and run slightly above 10MHz, causing the
drive much confusion.  Setting a maximum synchronous negotiation rate of 8MHz
in the
d236 2
a237 27
will allow normal function.
.if 1 \{
.Pp
There are four problems known in this version of this driver as follows.
All of these problems relate to MI SCSI system.
.Pp
Cannot handle SCSI ID greater than 7 with WIDE SCSI adapter.
.Pp
It is dangerous to simultaneously access SCSI devices more than half
number of SCBs. It may cause fatal disk trouble. In this case,
diagnostics message
.Dq not queued, error ...
is displayed to console.
For example, AHA-274x and AHA-284x have only 4 SCBs, so that using 3 SCSI
devices is dangerous, using 2 devices is OK.
.Pp
When you suddenly access SCSI devices on free physical memory shortage
conditions, and if there have been very few load on SCSI devices until
then, it may cause fatal disk trouble. In this case, diagnostics
message
.Dq ahc0: Can't malloc SCB
and
.Dq not queued, error ...
is displayed to console.
.Pp
SCSI residual handling is not complete.
\}
d250 1
a250 1
driver was written by Justin Gibbs.  The
d252 4
a255 2
sequencer-code assembler was
written by John Aycock.
@


1.5
log
@more man page repairs; aaron@@ug.cs.dal.ca
@
text
@d1 1
a1 1
.\"	$OpenBSD: ahc.4,v 1.4 1998/03/16 23:30:56 gene Exp $
d4 1
a4 1
.\" Copyright (c) 1995, 1996 
d73 1
a73 1
bus connected to an Adaptec 
d88 1
a88 1
except those using 
d98 1
a98 1
Per target configuration performed in the 
d101 1
a101 1
in 
d103 1
a103 1
models or through an 
d105 1
a105 1
configuration utility for 
d108 1
a108 1
is honored by this driver with the stipulation that the 
d110 1
a110 1
must be enabled for 
d121 2
a122 2
.Tn EISA 
system.  Ensure that the jumpers setting the I/O area for the 284x match the 
d133 1
a133 1
in the 
d146 1
a146 1
diagnostics message 
d153 1
a153 1
conditions, and if there have been very few load on SCSI devices until 
d155 1
a155 1
message 
d157 1
a157 1
and 
@


1.4
log
@"options" -> "option" for kernel config options.  Also, add OpenBSD rcsid.
@
text
@d1 1
a1 1
.\"	$OpenBSD$
d58 1
a58 1
To enable tagged queueing:
d85 1
a85 1
two active commands at a time per non-tagged queueing target,
d91 1
a91 1
Tagged queueing is enabled with the
d100 1
a100 1
menu, accesible at boot
d139 1
a139 1
There are four problems known this version of this driver as follows.
@


1.3
log
@These are not i386-specific so remove the i386 tag
@
text
@d1 1
d59 1
a59 1
.Cd options AHC_TAGENABLE
@


1.2
log
@sync
@
text
@d30 1
a30 1
.\".Dt AHC 4 i386
@


1.1
log
@+ahc, +strip
@
text
@d1 1
a1 1
.\"	$NetBSD: ahc.4,v 1.1 1996/07/10 22:58:35 explorer Exp $
d30 4
a33 2
.Dt AHC 4 i386
.Os FreeBSD
d44 1
a44 2
.Cd ahc*	at eisa? slot ?
.Cd options	AHA284X_HACK
d136 26
a177 27
.if 1 \{NetBSD porting is done by Stefan Grefen, Charles M. Hannum,
Michael Graff, Pete Bentley and Noriyuki Soda.
.Sh BUGS
There are four problems known in NetBSD version of this driver.
All of these problems relate to NetBSD MI SCSI system.
.Pp
Cannot handle SCSI ID greater than 7 with WIDE SCSI adapter.
.Pp
It is dangerous to use SCSI devices more than half of SCBs.
For example, AHA-274x and AHA-284x have only 4 SCBs, so that using 3 SCSI
devices is dangerous, using 2 devices is OK.
.Pp
There is possibility of causing "Can't malloc SCB" error.
.Pp
SCSI residual handling is not complete.
\}
.Sh HISTORY
The
.Nm
driver appeared in
.Tn FreeBSD
2.1
.if 1 \{and 
.Tn NetBSD
1.1.
\}

@

