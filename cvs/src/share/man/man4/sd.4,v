head	1.20;
access;
symbols
	OPENBSD_6_2_BASE:1.20
	OPENBSD_6_1:1.20.0.14
	OPENBSD_6_1_BASE:1.20
	OPENBSD_6_0:1.20.0.12
	OPENBSD_6_0_BASE:1.20
	OPENBSD_5_9:1.20.0.2
	OPENBSD_5_9_BASE:1.20
	OPENBSD_5_8:1.20.0.8
	OPENBSD_5_8_BASE:1.20
	OPENBSD_5_7:1.20.0.6
	OPENBSD_5_7_BASE:1.20
	OPENBSD_5_6:1.20.0.4
	OPENBSD_5_6_BASE:1.20
	OPENBSD_5_5:1.19.0.4
	OPENBSD_5_5_BASE:1.19
	OPENBSD_5_4:1.18.0.10
	OPENBSD_5_4_BASE:1.18
	OPENBSD_5_3:1.18.0.8
	OPENBSD_5_3_BASE:1.18
	OPENBSD_5_2:1.18.0.6
	OPENBSD_5_2_BASE:1.18
	OPENBSD_5_1_BASE:1.18
	OPENBSD_5_1:1.18.0.4
	OPENBSD_5_0:1.18.0.2
	OPENBSD_5_0_BASE:1.18
	OPENBSD_4_9:1.17.0.16
	OPENBSD_4_9_BASE:1.17
	OPENBSD_4_8:1.17.0.14
	OPENBSD_4_8_BASE:1.17
	OPENBSD_4_7:1.17.0.10
	OPENBSD_4_7_BASE:1.17
	OPENBSD_4_6:1.17.0.12
	OPENBSD_4_6_BASE:1.17
	OPENBSD_4_5:1.17.0.8
	OPENBSD_4_5_BASE:1.17
	OPENBSD_4_4:1.17.0.6
	OPENBSD_4_4_BASE:1.17
	OPENBSD_4_3:1.17.0.4
	OPENBSD_4_3_BASE:1.17
	OPENBSD_4_2:1.17.0.2
	OPENBSD_4_2_BASE:1.17
	OPENBSD_4_1:1.15.0.10
	OPENBSD_4_1_BASE:1.15
	OPENBSD_4_0:1.15.0.8
	OPENBSD_4_0_BASE:1.15
	OPENBSD_3_9:1.15.0.6
	OPENBSD_3_9_BASE:1.15
	OPENBSD_3_8:1.15.0.4
	OPENBSD_3_8_BASE:1.15
	OPENBSD_3_7:1.15.0.2
	OPENBSD_3_7_BASE:1.15
	OPENBSD_3_6:1.13.0.2
	OPENBSD_3_6_BASE:1.13
	OPENBSD_3_5:1.12.0.2
	OPENBSD_3_5_BASE:1.12
	OPENBSD_3_4:1.11.0.2
	OPENBSD_3_4_BASE:1.11
	OPENBSD_3_3:1.9.0.4
	OPENBSD_3_3_BASE:1.9
	OPENBSD_3_2:1.9.0.2
	OPENBSD_3_2_BASE:1.9
	OPENBSD_3_1:1.7.0.4
	OPENBSD_3_1_BASE:1.7
	OPENBSD_3_0:1.7.0.2
	OPENBSD_3_0_BASE:1.7
	OPENBSD_2_9:1.4.0.2
	OPENBSD_2_9_BASE:1.4
	OPENBSD_2_8:1.2.0.6
	OPENBSD_2_8_BASE:1.2
	OPENBSD_2_7:1.2.0.4
	OPENBSD_2_7_BASE:1.2
	OPENBSD_2_6:1.2.0.2
	OPENBSD_2_6_BASE:1.2
	OPENBSD_2_5:1.1.0.10
	OPENBSD_2_5_BASE:1.1
	OPENBSD_2_4:1.1.0.8
	OPENBSD_2_4_BASE:1.1
	OPENBSD_2_3:1.1.0.6
	OPENBSD_2_3_BASE:1.1
	OPENBSD_2_2:1.1.0.4
	OPENBSD_2_2_BASE:1.1
	OPENBSD_2_1:1.1.0.2
	OPENBSD_2_1_BASE:1.1;
locks; strict;
comment	@# @;


1.20
date	2014.07.02.22.35.42;	author matthew;	state Exp;
branches;
next	1.19;
commitid	UVfZngFEO8Tf2HEx;

1.19
date	2014.01.21.03.15.46;	author schwarze;	state Exp;
branches;
next	1.18;

1.18
date	2011.06.05.18.42.05;	author matthew;	state Exp;
branches;
next	1.17;

1.17
date	2007.05.31.19.19.51;	author jmc;	state Exp;
branches;
next	1.16;

1.16
date	2007.04.03.06.57.06;	author dlg;	state Exp;
branches;
next	1.15;

1.15
date	2004.12.09.17.41.01;	author miod;	state Exp;
branches;
next	1.14;

1.14
date	2004.09.30.19.59.25;	author mickey;	state Exp;
branches;
next	1.13;

1.13
date	2004.04.28.16.59.00;	author grange;	state Exp;
branches;
next	1.12;

1.12
date	2003.11.09.16.06.07;	author jmc;	state Exp;
branches;
next	1.11;

1.11
date	2003.06.29.15.05.26;	author jmc;	state Exp;
branches;
next	1.10;

1.10
date	2003.04.03.11.02.36;	author jmc;	state Exp;
branches;
next	1.9;

1.9
date	2002.10.01.07.10.39;	author miod;	state Exp;
branches;
next	1.8;

1.8
date	2002.09.26.07.55.40;	author miod;	state Exp;
branches;
next	1.7;

1.7
date	2001.10.05.14.45.53;	author mpech;	state Exp;
branches;
next	1.6;

1.6
date	2001.08.03.15.21.16;	author mpech;	state Exp;
branches;
next	1.5;

1.5
date	2001.06.22.12.15.46;	author mpech;	state Exp;
branches;
next	1.4;

1.4
date	2001.03.06.22.20.26;	author brad;	state Exp;
branches;
next	1.3;

1.3
date	2001.03.06.19.56.50;	author brad;	state Exp;
branches;
next	1.2;

1.2
date	99.07.09.13.35.47;	author aaron;	state Exp;
branches;
next	1.1;

1.1
date	97.03.28.22.53.41;	author millert;	state Exp;
branches;
next	;


desc
@@


1.20
log
@Document the ioctl() argument types for sd(4)'s ioctls

Also, cleanup some lies about which header defines these ioctls
@
text
@.\"	$OpenBSD: sd.4,v 1.19 2014/01/21 03:15:46 schwarze Exp $
.\"	$NetBSD: sd.4,v 1.3 1996/10/20 23:15:23 explorer Exp $
.\"
.\" Copyright (c) 1996
.\"     Julian Elischer <julian@@freebsd.org>.  All rights reserved.
.\"
.\" Redistribution and use in source and binary forms, with or without
.\" modification, are permitted provided that the following conditions
.\" are met:
.\" 1. Redistributions of source code must retain the above copyright
.\"    notice, this list of conditions and the following disclaimer.
.\"
.\" 2. Redistributions in binary form must reproduce the above copyright
.\"    notice, this list of conditions and the following disclaimer in the
.\"    documentation and/or other materials provided with the distribution.
.\"
.\" THIS SOFTWARE IS PROVIDED BY THE AUTHOR AND CONTRIBUTORS ``AS IS'' AND
.\" ANY EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT LIMITED TO, THE
.\" IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE
.\" ARE DISCLAIMED.  IN NO EVENT SHALL THE AUTHOR OR CONTRIBUTORS BE LIABLE
.\" FOR ANY DIRECT, INDIRECT, INCIDENTAL, SPECIAL, EXEMPLARY, OR CONSEQUENTIAL
.\" DAMAGES (INCLUDING, BUT NOT LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS
.\" OR SERVICES; LOSS OF USE, DATA, OR PROFITS; OR BUSINESS INTERRUPTION)
.\" HOWEVER CAUSED AND ON ANY THEORY OF LIABILITY, WHETHER IN CONTRACT, STRICT
.\" LIABILITY, OR TORT (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY
.\" OUT OF THE USE OF THIS SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF
.\" SUCH DAMAGE.
.\"
.Dd $Mdocdate: January 21 2014 $
.Dt SD 4
.Os
.Sh NAME
.Nm sd
.Nd SCSI disk driver
.Sh SYNOPSIS
.Cd "sd* at scsibus?"
.Cd "#sd0 at scsibus0 target 3 lun 0" Pq fixed-configuration example
.Sh DESCRIPTION
The
.Nm
driver provides support for a
.Tn SCSI
disk.
It allows the disk to be divided up into a set of pseudo devices called
.Em partitions .
In general the interfaces are similar to those described by
.Xr wd 4 .
.Pp
.Tn SCSI
devices have a fairly high level interface to the system and talk to it via
a
.Tn SCSI
host adapter
(e.g.,
.Xr ahc 4 ) .
A
.Tn SCSI
adapter must also be separately configured into the system
before a
.Tn SCSI
disk can be configured.
.Pp
When the
.Tn SCSI
adapter is probed during boot, the
.Tn SCSI
bus is scanned for devices.
Any devices found which answer as
.Sq Em Direct
type devices will be attached to the
.Nm
driver.
.\"In
.\".Fx
.\"releases prior to 2.1, the first found was attached as
.\".Li sd0 ,
.\"the second
.\".Li sd1 ,
.\"and so on.
.\"Beginning in 2.1 it became possible to lock down the assignment of
.\"devices on the
.\".Tn SCSI
.\"bus to particular units of the
.\".Nm
.\"device; refer to
.\".Xr scsi 4
.\"for details on kernel configuration.
.Sh PARTITIONING
.\"The
.\".Nm
.\"driver allows the disk to have two levels of partitioning.
.\"One layer, called the
.\".Dq slice layer ,
.\"is used to separate the
.\".Fx
.\"areas of the disk from areas used by other operating systems.
.\"The second layer is the native
.\".Bx 4.4
.\"partitioning scheme,
.\".Xr disklabel 5 ,
.\"which is used to subdivide the
.\".Fx
.\"slices into areas for individual filesystems and swap spaces.
.\"For more information, see
.\".Xr fdisk 8
.\"and
.\".Xr disklabel 8 ,
.\"respectively.)
On many systems
.Xr disklabel 8
is used to partition the drive into filesystems.
On some systems the
.Ox
portion of the disk resides within a native partition, and another
program is used to create the
.Ox
portion.
.Pp
For example, the i386 port uses
.Xr fdisk 8
to partition the disk into a BIOS level partition.
This allows sharing the disk with other operating systems.
.\"If an uninitialized disk is opened, the slice table will be
.\"initialized with a fictitious
.\".Fx
.\"slice spanning the entire disk. Similarly, if an uninitialized
.\"(or
.\".No non- Ns Fx )
.\"slice is opened, its disklabel will be initialized with parameters returned
.\"by the drive and a single
.\".Sq Li c
.\"partition encompassing the entire slice.
.Sh IOCTLS
The following
.Xr ioctl 2
calls apply to
.Tn SCSI
disks as well as to other disks.
They are defined in the header file
.In sys/dkio.h .
.Bl -tag -width Ds
.\".It Dv DIOCSBAD
.\"Usually used to set up a bad-block mapping system on the disk.
.\".Tn SCSI
.\"drive incorporate their own bad-block mapping so this command is not
.\"implemented.
.It Dv DIOCGDINFO Fa "struct disklabel *"
Read, from the kernel, the in-core copy of the disklabel for the
drive.
This may be a fictitious disklabel if the drive has never
been initialized, in which case it will contain information read
from the
.Tn SCSI
inquiry commands.
.It Dv DIOCSDINFO Fa "struct disklabel *"
Give the driver a new disklabel to use.
The driver
.Em will not
write the new
disklabel to the disk.
.It Dv DIOCWDINFO Fa "struct disklabel *"
Give the driver a new disklabel to use.
The driver
.Em will
write the new disklabel to the disk.
.It Dv DIOCLOCK Fa "int *"
Lock the media cartridge into the device, or unlock a cartridge previously
locked.
Used to prevent user and software eject while the media is in use.
.It Dv DIOCEJECT
Eject the media cartridge from a removable device.
.It Dv DIOCINQ Fa "struct dk_inquiry *"
Read the devices product information.
.El
.Pp
In addition, the
.Xr scsi 4
general
.Fn ioctl
commands may be used with the
.Nm
driver, but only against the
.Sq Li c
(whole disk) partition.
.Sh NOTES
If a removable device is attached to the
.Nm
driver, then the act of changing the media will invalidate the
disklabel and information held within the kernel.
To avoid corruption, all access to the device will be discarded until there
are no more open file descriptors referencing the device.
During this period, all new open attempts will be rejected.
When no more open file descriptors reference the device, the first next
open will load a new set of parameters (including disklabel) for the drive.
.Sh FILES
.Bl -tag -width /dev/rsdXXXXX -compact
.It Pa /dev/sd Ns Ar u Ns Ar p
block mode
.Tn SCSI
disk unit
.Ar u ,
partition
.Ar p
.It Pa /dev/rsd Ns Ar u Ns Ar p
raw mode
.Tn SCSI
disk unit
.Ar u ,
partition
.Ar p
.El
.Sh DIAGNOSTICS
None.
.Sh SEE ALSO
.Xr intro 4 ,
.Xr scsi 4 ,
.Xr wd 4 ,
.Xr disklabel 5 ,
.Xr disklabel 8 ,
.Xr fdisk 8
.Sh HISTORY
The
.Nm
driver was originally written for
.Tn Mach
2.5, and was ported to
.Fx
by Julian Elischer.
It was later ported to
.Ox .
@


1.19
log
@obvious .Pa fixes; found with mandocdb(8)
@
text
@d1 1
a1 1
.\"	$OpenBSD: sd.4,v 1.18 2011/06/05 18:42:05 matthew Exp $
d29 1
a29 1
.Dd $Mdocdate: June 5 2011 $
d140 2
a141 2
.In sys/disklabel.h .
.Bl -tag -width DIOCSDINFO
d147 1
a147 1
.It Dv DIOCGDINFO
d155 1
a155 1
.It Dv DIOCSDINFO
d161 1
a161 1
.It Dv DIOCWDINFO
d166 1
a166 1
.It Dv DIOCLOCK
d172 1
a172 1
.It Dv DIOCINQ
@


1.18
log
@Delete mention of DIOCWLABEL in sd(4) and vnd(4).
@
text
@d1 1
a1 1
.\"	$OpenBSD: sd.4,v 1.17 2007/05/31 19:19:51 jmc Exp $
d29 1
a29 1
.Dd $Mdocdate: May 31 2007 $
d140 1
a140 1
.Aq Pa sys/disklabel.h .
@


1.17
log
@convert to new .Dd format;
@
text
@d1 1
a1 1
.\"	$OpenBSD: sd.4,v 1.16 2007/04/03 06:57:06 dlg Exp $
d29 1
a29 1
.Dd $Mdocdate$
a160 3
.It Dv DIOCWLABEL
Enable or disable the driver's software
write protect of the disklabel on the disk.
@


1.16
log
@i have a bad habit of not documenting extra interfaces i add...

i added an ioctl to get product information from disks. the sd driver
supports it, so say so.
@
text
@d1 1
a1 1
.\"	$OpenBSD: sd.4,v 1.15 2004/12/09 17:41:01 miod Exp $
d29 1
a29 1
.Dd January 18, 1996
@


1.15
log
@Remove old FreeBSDisms:
- drop the "KERNEL CONFIGURATION" section which is confusing (these are
  not pseudo-devices!) except for st.4 where might be worth keeping.
- drop the "DISCLAIMER" section in ch.4.
- mention cdio and chio in cd.4 and ch.4 respectively.
@
text
@d1 1
a1 1
.\"	$OpenBSD: sd.4,v 1.14 2004/09/30 19:59:25 mickey Exp $
d175 2
@


1.14
log
@kill default locators
@
text
@d1 1
a1 1
.\"	$OpenBSD: sd.4,v 1.13 2004/04/28 16:59:00 grange Exp $
a132 7
.\".Sh KERNEL CONFIGURATION
.\"It is only necessary to explicitly configure one
.\".Nm
.\"device; data structures are dynamically allocated as disks are found
.\"on the
.\".Tn SCSI
.\"bus.
@


1.13
log
@wd(4) devices nowadays also have a ``high level'' interface, we
call it ``ATA''.

ok tom@@ deraadt@@
@
text
@d1 1
a1 1
.\"	$OpenBSD: sd.4,v 1.12 2003/11/09 16:06:07 jmc Exp $
d36 1
a36 1
.Cd "sd* at scsibus? target ? lun ?"
@


1.12
log
@remove .Pp's before lists and displays;
@
text
@d1 1
a1 1
.\"	$OpenBSD: sd.4,v 1.11 2003/06/29 15:05:26 jmc Exp $
a48 3
Where the
.Xr wd 4
device has a fairly low level interface to the system,
d50 1
a50 1
devices have a much higher level interface and talk to the system via
@


1.11
log
@remove superfluous ".Sm off";
from wiz@@netbsd
@
text
@d1 1
a1 1
.\"	$OpenBSD: sd.4,v 1.10 2003/04/03 11:02:36 jmc Exp $
a150 1
.Pp
@


1.10
log
@typos;
@
text
@d1 1
a1 1
.\"	$OpenBSD: sd.4,v 1.9 2002/10/01 07:10:39 miod Exp $
a222 1
.Sm off
@


1.9
log
@Minor corrections, ok doraadt@@
@
text
@d1 1
a1 1
.\"	$OpenBSD: sd.4,v 1.8 2002/09/26 07:55:40 miod Exp $
d129 1
a129 1
.\"slice spanning the entire disk.  Similarly, if an uninitialized
d202 1
a202 1
To avoid corruption, all accesses to the device will be discarded until there
d205 1
a205 1
When no more open file descriptors reference the device, the first next 
d243 1
a243 1
.Nx .
@


1.8
log
@Incomplete section 4 mi manual page cleanup.
- make configuration lines match GENERIC files
- more Xr (hopefully usefule Xr)
- never mention intro(4) on non-physical devices (i.e. protocols), always
mention it for physical devices
- random text style and quoting fixes
- drivers ported from FreeBSD did mention rc.conf instead of hostname.if as
the place to put mediaopt
- some .Tn UNIX -> .Ox replacements
- etc, etc...

reviewd in part by deraadt@@ (until he got bored of this)
@
text
@d1 1
a1 1
.\"	$OpenBSD: sd.4,v 1.7 2001/10/05 14:45:53 mpech Exp $
d116 1
a116 1
.Nx
d119 1
a119 1
.Nx
d150 1
a150 1
.Aq Pa disklabel.h .
@


1.7
log
@Powered by @@mantoya:
o) start new sentence on a new line;
o) minor mdoc fixes;
millert@@ ok

Tip of the day:   www.mpechismazohist.com
@
text
@d1 1
a1 1
.\"	$OpenBSD: sd.4,v 1.6 2001/08/03 15:21:16 mpech Exp $
d36 2
a37 2
.Cd sd* at scsibus? target ? lun ?
.Cd sd3 at scsibus0 target 3 lun 0
d228 2
@


1.6
log
@o) We don't like .Pp before/after .Sh;
o) .Nm always has argument in .Sh SYNOPSIS;
o) We always closes .Bl and .Bd tags;

millert@@ ok
@
text
@d1 1
a1 1
.\"	$OpenBSD: sd.4,v 1.5 2001/06/22 12:15:46 mpech Exp $
d43 2
a44 2
disk. It allows the disk
to be divided up into a set of pseudo devices called
d70 2
a71 1
bus is scanned for devices. Any devices found which answer as
d114 2
a115 1
is used to partition the drive into filesystems.  On some systems the
d124 2
a125 2
to partition the disk into a BIOS level partition.  This allows sharing
the disk with other operating systems.
d148 2
a149 1
disks as well as to other disks.  They are defined in the header file
d160 2
a161 1
drive. This may be a fictitious disklabel if the drive has never
d167 2
a168 1
Give the driver a new disklabel to use. The driver
d176 2
a177 1
Give the driver a new disklabel to use. The driver
d182 2
a183 2
locked.  Used to prevent user and software eject while the media is in
use.
d201 6
a206 6
disklabel and information held within the kernel.  To avoid
corruption, all accesses to the device will be discarded until there
are no more open file descriptors referencing the device.  During this
period, all new open attempts will be rejected.  When no more open
file descriptors reference the device, the first next open will load a
new set of parameters (including disklabel) for the drive.
@


1.5
log
@o) remove unnecessary .Pp;
o) remove unnecessary .Nm args;
o) closes .Bl;
o) .Sh AUTHOR -> .Sh AUTHORS;
o) sort SEE ALSO;
o) better -mdoc style;
o) typos;

aaron@@ ok.
@
text
@d1 1
a1 1
.\"	$OpenBSD: sd.4,v 1.4 2001/03/06 22:20:26 brad Exp $
a123 1
.Pp
@


1.4
log
@NetBSD -> .Nx
FreeBSD -> .Fx
@
text
@d1 1
a1 1
.\"	$OpenBSD: sd.4,v 1.3 2001/03/06 19:56:50 brad Exp $
d40 1
a40 1
.Nm sd
@


1.3
log
@first sweep ...
OpenBSD -> .Ox
NetBSD -> .Nx
FreeBSD -> .Fx
--
Ok'd by aaron@@
@
text
@d1 1
a1 1
.\"	$OpenBSD: sd.4,v 1.2 1999/07/09 13:35:47 aaron Exp $
d76 1
a76 1
.\".Tn FreeBSD
d97 1
a97 1
.\".Tn FreeBSD
d104 1
a104 1
.\".Tn FreeBSD
d127 1
a127 1
.\".Tn FreeBSD
d130 1
a130 1
.\".No non- Ns Tn FreeBSD )
d233 1
a233 1
.Tn FreeBSD
d236 1
a236 1
.Tn NetBSD .
@


1.2
log
@- remove all trailing whitespace
     * except when it is escaped with a `\' at the end of the line
- fix remaining .Nm usage as well
- this is from a patch I received from kwesterback@@home.com, who has been
  working on some scripts for fixing formatting errors in mdoc'd man pages

Ok, so there could be a cost/benefit debate with this commit, but since I have
the patch we might as well commit it...
@
text
@d1 1
a1 1
.\"	$OpenBSD: sd.4,v 1.1 1997/03/28 22:53:41 millert Exp $
d114 5
a118 2
NetBSD portion of the disk resides within a native partition, and another
program is used to create the NetBSD portion.
@


1.1
log
@Move ncr.4 out of man4.i386/ncr.4 and update it from NetBSD.
Remove one of the tekram cards from man4.i386/aha.4 that is really
ncr-based and add cd.4, fpa.4, sd.4, st.4, uk.4 from NetBSD
(some originally from FreeBSD).
@
text
@d1 1
a1 1
.\"	$OpenBSD$
d41 1
a41 1
driver provides support for a 
d46 1
a46 1
In general the interfaces are similar to those described by 
d49 1
a49 1
Where the 
d51 1
a51 1
device has a fairly low level interface to the system, 
d54 1
a54 1
a 
d68 1
a68 1
adapter is probed during boot, the 
d70 1
a70 1
bus is scanned for devices. Any devices found which answer as 
d72 1
a72 1
type devices will be attached to the 
d75 1
a75 1
.\"In 
d91 1
a91 1
.\"The 
d111 1
a111 1
On many systems 
d140 1
a140 1
The following 
d142 1
a142 1
calls apply to 
d149 1
a149 1
.\"Usually used to set up a bad-block mapping system on the disk. 
d180 1
a180 1
In addition, the 
d184 1
a184 1
commands may be used with the 
d186 1
a186 1
driver, but only against the 
d190 1
a190 1
If a removable device is attached to the 
@

