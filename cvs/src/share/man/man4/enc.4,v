head	1.29;
access;
symbols
	OPENBSD_6_1:1.29.0.8
	OPENBSD_6_1_BASE:1.29
	OPENBSD_6_0:1.29.0.10
	OPENBSD_6_0_BASE:1.29
	OPENBSD_5_9:1.29.0.2
	OPENBSD_5_9_BASE:1.29
	OPENBSD_5_8:1.29.0.6
	OPENBSD_5_8_BASE:1.29
	OPENBSD_5_7:1.29.0.4
	OPENBSD_5_7_BASE:1.29
	OPENBSD_5_6:1.28.0.20
	OPENBSD_5_6_BASE:1.28
	OPENBSD_5_5:1.28.0.18
	OPENBSD_5_5_BASE:1.28
	OPENBSD_5_4:1.28.0.14
	OPENBSD_5_4_BASE:1.28
	OPENBSD_5_3:1.28.0.12
	OPENBSD_5_3_BASE:1.28
	OPENBSD_5_2:1.28.0.10
	OPENBSD_5_2_BASE:1.28
	OPENBSD_5_1_BASE:1.28
	OPENBSD_5_1:1.28.0.8
	OPENBSD_5_0:1.28.0.6
	OPENBSD_5_0_BASE:1.28
	OPENBSD_4_9:1.28.0.4
	OPENBSD_4_9_BASE:1.28
	OPENBSD_4_8:1.28.0.2
	OPENBSD_4_8_BASE:1.28
	OPENBSD_4_7:1.27.0.4
	OPENBSD_4_7_BASE:1.27
	OPENBSD_4_6:1.27.0.6
	OPENBSD_4_6_BASE:1.27
	OPENBSD_4_5:1.27.0.2
	OPENBSD_4_5_BASE:1.27
	OPENBSD_4_4:1.26.0.6
	OPENBSD_4_4_BASE:1.26
	OPENBSD_4_3:1.26.0.4
	OPENBSD_4_3_BASE:1.26
	OPENBSD_4_2:1.26.0.2
	OPENBSD_4_2_BASE:1.26
	OPENBSD_4_1:1.24.0.2
	OPENBSD_4_1_BASE:1.24
	OPENBSD_4_0:1.22.0.2
	OPENBSD_4_0_BASE:1.22
	OPENBSD_3_9:1.20.0.4
	OPENBSD_3_9_BASE:1.20
	OPENBSD_3_8:1.20.0.2
	OPENBSD_3_8_BASE:1.20
	OPENBSD_3_7:1.18.0.2
	OPENBSD_3_7_BASE:1.18
	OPENBSD_3_6:1.17.0.4
	OPENBSD_3_6_BASE:1.17
	OPENBSD_3_5:1.17.0.2
	OPENBSD_3_5_BASE:1.17
	OPENBSD_3_4:1.15.0.4
	OPENBSD_3_4_BASE:1.15
	OPENBSD_3_3:1.15.0.2
	OPENBSD_3_3_BASE:1.15
	OPENBSD_3_2:1.14.0.6
	OPENBSD_3_2_BASE:1.14
	OPENBSD_3_1:1.14.0.4
	OPENBSD_3_1_BASE:1.14
	OPENBSD_3_0:1.14.0.2
	OPENBSD_3_0_BASE:1.14
	OPENBSD_2_9:1.11.0.2
	OPENBSD_2_9_BASE:1.11
	OPENBSD_2_8:1.7.0.2
	OPENBSD_2_8_BASE:1.7
	OPENBSD_2_7:1.6.0.2
	OPENBSD_2_7_BASE:1.6
	OPENBSD_2_6:1.3.0.2
	OPENBSD_2_6_BASE:1.3;
locks; strict;
comment	@.\" @;


1.29
date	2015.02.16.16.38.54;	author naddy;	state Exp;
branches;
next	1.28;
commitid	ne9aoqc3owhFBWUD;

1.28
date	2010.06.29.21.28.37;	author reyk;	state Exp;
branches;
next	1.27;

1.27
date	2009.01.28.21.00.32;	author grunk;	state Exp;
branches;
next	1.26;

1.26
date	2007.05.31.19.19.50;	author jmc;	state Exp;
branches;
next	1.25;

1.25
date	2007.05.28.18.26.17;	author jmc;	state Exp;
branches;
next	1.24;

1.24
date	2006.12.12.21.20.02;	author jmc;	state Exp;
branches;
next	1.23;

1.23
date	2006.10.19.08.52.25;	author jmc;	state Exp;
branches;
next	1.22;

1.22
date	2006.05.26.08.51.29;	author jmc;	state Exp;
branches;
next	1.21;

1.21
date	2006.05.26.04.02.59;	author deraadt;	state Exp;
branches;
next	1.20;

1.20
date	2005.04.17.12.31.38;	author jmc;	state Exp;
branches;
next	1.19;

1.19
date	2005.04.15.23.42.15;	author jmc;	state Exp;
branches;
next	1.18;

1.18
date	2005.01.05.03.30.16;	author jaredy;	state Exp;
branches;
next	1.17;

1.17
date	2004.03.21.19.47.59;	author miod;	state Exp;
branches;
next	1.16;

1.16
date	2004.03.12.09.46.03;	author jmc;	state Exp;
branches;
next	1.15;

1.15
date	2003.02.15.09.39.43;	author jmc;	state Exp;
branches;
next	1.14;

1.14
date	2001.06.26.23.24.11;	author angelos;	state Exp;
branches;
next	1.13;

1.13
date	2001.06.22.12.15.44;	author mpech;	state Exp;
branches;
next	1.12;

1.12
date	2001.05.30.03.24.16;	author millert;	state Exp;
branches;
next	1.11;

1.11
date	2001.03.25.22.32.45;	author angelos;	state Exp;
branches;
next	1.10;

1.10
date	2000.12.30.23.55.11;	author angelos;	state Exp;
branches;
next	1.9;

1.9
date	2000.12.21.21.01.16;	author aaron;	state Exp;
branches;
next	1.8;

1.8
date	2000.11.20.08.00.00;	author deraadt;	state Exp;
branches;
next	1.7;

1.7
date	2000.10.18.16.32.11;	author aaron;	state Exp;
branches;
next	1.6;

1.6
date	2000.04.08.18.49.28;	author angelos;	state Exp;
branches;
next	1.5;

1.5
date	2000.01.15.19.43.41;	author angelos;	state Exp;
branches;
next	1.4;

1.4
date	99.10.29.05.37.44;	author angelos;	state Exp;
branches;
next	1.3;

1.3
date	99.10.08.01.50.37;	author aaron;	state Exp;
branches;
next	1.2;

1.2
date	99.10.07.20.56.16;	author angelos;	state Exp;
branches;
next	1.1;

1.1
date	99.10.07.20.51.13;	author angelos;	state Exp;
branches;
next	;


desc
@@


1.29
log
@Replace \*(Lt \*(Le \*(Gt \*(Ge with literal < <= > >= respectively,
except for instances where \*(Le and \*(Ge are clearly understood as
mathematical symbols.  Discussed with schwarze@@
@
text
@.\"	$OpenBSD: enc.4,v 1.28 2010/06/29 21:28:37 reyk Exp $
.\"
.\" Copyright (c) 2006 Jason McIntyre <jmc@@openbsd.org>
.\"
.\" Permission to use, copy, modify, and distribute this software for any
.\" purpose with or without fee is hereby granted, provided that the above
.\" copyright notice and this permission notice appear in all copies.
.\"
.\" THE SOFTWARE IS PROVIDED "AS IS" AND THE AUTHOR DISCLAIMS ALL WARRANTIES
.\" WITH REGARD TO THIS SOFTWARE INCLUDING ALL IMPLIED WARRANTIES OF
.\" MERCHANTABILITY AND FITNESS. IN NO EVENT SHALL THE AUTHOR BE LIABLE FOR
.\" ANY SPECIAL, DIRECT, INDIRECT, OR CONSEQUENTIAL DAMAGES OR ANY DAMAGES
.\" WHATSOEVER RESULTING FROM LOSS OF USE, DATA OR PROFITS, WHETHER IN AN
.\" ACTION OF CONTRACT, NEGLIGENCE OR OTHER TORTIOUS ACTION, ARISING OUT OF
.\" OR IN CONNECTION WITH THE USE OR PERFORMANCE OF THIS SOFTWARE.
.\"
.Dd $Mdocdate: June 29 2010 $
.Dt ENC 4
.Os
.Sh NAME
.Nm enc
.Nd encapsulating interface
.Sh SYNOPSIS
.Cd "pseudo-device enc"
.Sh DESCRIPTION
The
.Nm
interface is a virtual interface for
.Xr ipsec 4
traffic.
It allows packet filtering using
.Xr pf 4 ;
prior to encapsulation and after decapsulation,
packets may be monitored using
.Xr tcpdump 8 .
.Pp
An
.Nm
interface can be created at runtime using the
.Ic ifconfig enc Ns Ar N Ic create
command or by setting up a
.Xr hostname.if 5
configuration file for
.Xr netstart 8 .
The
.Nm enc0
interface will always exist and cannot be destroyed using
.Xr ifconfig 8 .
.Pp
Packet filtering is documented in greater detail in
.Xr pf.conf 5 ,
however some details relevant to filtering on the
.Nm
interface are documented below.
.Pp
Firstly,
.Xr pf 4
is a stateful packet filter,
which means it can track the state of a connection.
It does this
.Em automatically .
States are normally
.Em floating ,
which means they can match packets on any interface.
However this is a potential problem for filtering IPsec traffic:
states need to be interface bound,
to avoid permitting unencrypted traffic
should the SAs expire and not be replaced.
Therefore all rules on the
.Nm
interface should explicitly set
.Dq keep state (if-bound) .
For example:
.Bd -literal -offset indent
pass in on enc0 proto ipencap from 172.25.0.45 to 1.2.3.4 \e
	keep state (if-bound)
.Ed
.Pp
Secondly, the
.Nm
interface does not directly support bandwidth control via
.Xr pf 4
queueing.
Instead, IPsec packets must be tagged and the tagged packets
are assigned to queues.
.Xr ipsec.conf 5
provides an example of tag-based queueing
and further information on packet tagging.
.Pp
Finally,
the use of translation rules to map and redirect network traffic
requires some care.
Packets destined to be IPsec processed are seen by the
filter/translation engine twice,
both before and after being IPsec processed.
If a packet's translated address
on the way back fails to match an existing IPsec flow,
from the translated address to the original source address,
it will be discarded by the filter.
It is best to avoid this situation where possible,
though a flow may be explicitly created to work around it.
.Pp
As noted above,
.Xr tcpdump 8
may be invoked on the
.Nm
interface to see packets prior to encapsulation and after decapsulation.
For example:
.Bd -literal -offset 3n
# tcpdump -envps 1500 -i enc0 -l | grep 10.0.0.33
tcpdump: WARNING: enc0: no IPv4 address assigned
tcpdump: listening on enc0, link-type ENC
15:05:08.934708 (authentic,confidential): SPI 0x6bcac587: \e
	172.25.0.45 > 1.2.3.4: 10.9.9.28.7001 > 10.0.0.33.7000: \e
	[udp sum ok] udp 52 (ttl 64, id 5672, len 80) \e
	(ttl 64, id 30009, len 100, bad cksum 0!)
15:05:09.063517 (authentic,confidential): SPI 0x4b70c05a: \e
	1.2.3.4 > 172.25.0.45: 10.0.0.33.7000 > 10.9.9.28.7001: \e
	[udp sum ok] udp 156 (ttl 63, id 14880, len 184) \e
	(ttl 51, id 19689, len 204)
.Ed
.Pp
The packets above show (for each direction):
date, ESP (not AH), SPI, direction, and encapsulated part.
The first packet is headed from 172.25.0.45 to 1.2.3.4
and the encapsulated part from 10.9.9.28 to 10.0.0.33.
.Pp
Negotiations can be watched on the physical interface too:
.Bd -literal -offset 3n
# tcpdump -envps 1500 -i wi0 port 500 or port 4500
tcpdump: listening on wi0, link-type EN10MB
15:15:58.188747 0:2:6f:3a:3f:3e 0:10:f3:3:bd:8a 0800 226: \e
    172.25.0.45.500 > 1.2.3.4.500: [udp sum ok] \e
[...]
	attribute ENCRYPTION_ALGORITHM = AES_CBC
	attribute HASH_ALGORITHM = SHA
	attribute AUTHENTICATION_METHOD = RSA_SIG
	attribute GROUP_DESCRIPTION = MODP_1024
	attribute LIFE_TYPE = SECONDS
	attribute LIFE_DURATION = 3600
	attribute KEY_LENGTH = 128
[...]
15:15:59.080058 0:10:f3:3:bd:8a 0:2:6f:3a:3f:3e 0800 226: \e
    1.2.3.4.500 > 172.25.0.45.500: [udp sum ok] \e
[...]
	attribute ENCRYPTION_ALGORITHM = AES_CBC
	attribute HASH_ALGORITHM = SHA
	attribute AUTHENTICATION_METHOD = RSA_SIG
	attribute GROUP_DESCRIPTION = MODP_1024
	attribute LIFE_TYPE = SECONDS
	attribute LIFE_DURATION = 3600
	attribute KEY_LENGTH = 128
[...]
.Ed
.Pp
The attribute lines for the negotiation must match.
.Sh SEE ALSO
.Xr ipsec 4 ,
.Xr pf 4 ,
.Xr ipsec.conf 5 ,
.Xr pf.conf 5 ,
.Xr tcpdump 8
@


1.28
log
@Replace enc(4) with a new implementation as a cloner device.  We still
create enc0 by default, but it is possible to add additional enc
interfaces.  This will be used later to allow alternative encs per
policy or to have an enc per rdomain when IPsec becomes rdomain-aware.

manpage bits ok jmc@@
input from henning@@ deraadt@@ toby@@ naddy@@
ok henning@@ claudio@@
@
text
@d1 1
a1 1
.\"	$OpenBSD: enc.4,v 1.27 2009/01/28 21:00:32 grunk Exp $
d17 1
a17 1
.Dd $Mdocdate: January 28 2009 $
d114 1
a114 1
	172.25.0.45 \*(Gt 1.2.3.4: 10.9.9.28.7001 \*(Gt 10.0.0.33.7000: \e
d118 1
a118 1
	1.2.3.4 \*(Gt 172.25.0.45: 10.0.0.33.7000 \*(Gt 10.9.9.28.7001: \e
d133 1
a133 1
    172.25.0.45.500 \*(Gt 1.2.3.4.500: [udp sum ok] \e
d144 1
a144 1
    1.2.3.4.500 \*(Gt 172.25.0.45.500: [udp sum ok] \e
@


1.27
log
@typo, ok bluhm@@ hshoexer@@
@
text
@d1 1
a1 1
.\"	$OpenBSD: enc.4,v 1.26 2007/05/31 19:19:50 jmc Exp $
d17 1
a17 1
.Dd $Mdocdate: May 31 2007 $
d24 1
a24 1
.Cd "pseudo-device enc 1"
d36 2
a37 1
Only one
d39 10
a48 1
interface, enc0, is supported.
@


1.26
log
@convert to new .Dd format;
@
text
@d1 1
a1 1
.\"	$OpenBSD: enc.4,v 1.25 2007/05/28 18:26:17 jmc Exp $
d17 1
a17 1
.Dd $Mdocdate$
d84 1
a84 1
filer/translation engine twice,
@


1.25
log
@some tcpdump examples; from todd and myself
@
text
@d1 1
a1 1
.\"	$OpenBSD: enc.4,v 1.24 2006/12/12 21:20:02 jmc Exp $
d17 1
a17 1
.Dd November 26, 2006
@


1.24
log
@a rewrite of enc.4, hopefully a little more useful than what we previously
had; more can go in here, so feel free...

many thanks to ho for feedback, and angelos and cedric who i harangued
endlessly to explain nat/ipsec to me;

the ipsec.conf.5 change just moves some stuff more appropriate to enc.4;

ok hshoexer
@
text
@d1 1
a1 1
.\"	$OpenBSD$
d65 1
a65 1
pass in on enc0 proto ipencap from 192.168.3.2 to 192.168.3.1 \e
d99 46
d146 1
a146 1
.Dl # tcpdump -i enc0
@


1.23
log
@note that all rules using enc0 should specify: keep state (if-bound)
@
text
@d1 1
a1 1
.\"	$OpenBSD: enc.4,v 1.22 2006/05/26 08:51:29 jmc Exp $
d3 1
a3 2
.\" Copyright (c) 1999 Angelos D. Keromytis
.\" All rights reserved.
d5 3
a7 3
.\" Redistribution and use in source and binary forms, with or without
.\" modification, are permitted provided that the following conditions
.\" are met:
d9 7
a15 10
.\" 1. Redistributions of source code must retain the above copyright
.\"    notice, this list of conditions and the following disclaimer.
.\" 2. Redistributions in binary form must reproduce the above copyright
.\"    notice, this list of conditions and the following disclaimer in the
.\"    documentation and/or other materials provided with the distribution.
.\" 3. All advertising materials mentioning features or use of this software
.\"    must display the following acknowledgement:
.\"	This product includes software developed by Angelos D. Keromytis.
.\" 4. The name of the author may not be used to endorse or promote products
.\"    derived from this software without specific prior written permission.
d17 1
a17 12
.\" THIS SOFTWARE IS PROVIDED BY THE AUTHOR ``AS IS'' AND ANY EXPRESS OR
.\" IMPLIED WARRANTIES, INCLUDING, BUT NOT LIMITED TO, THE IMPLIED WARRANTIES
.\" OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE ARE DISCLAIMED.
.\" IN NO EVENT SHALL THE AUTHOR BE LIABLE FOR ANY DIRECT, INDIRECT,
.\" INCIDENTAL, SPECIAL, EXEMPLARY, OR CONSEQUENTIAL DAMAGES (INCLUDING, BUT
.\" NOT LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES; LOSS OF USE,
.\" DATA, OR PROFITS; OR BUSINESS INTERRUPTION) HOWEVER CAUSED AND ON ANY
.\" THEORY OF LIABILITY, WHETHER IN CONTRACT, STRICT LIABILITY, OR TORT
.\" (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE USE OF
.\" THIS SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.
.\"
.Dd October 7, 1999
d22 1
a22 1
.Nd Encapsulating Interface
d24 1
a24 1
.Cd "pseudo-device enc" Op Ar count
d28 1
a28 2
interface is a software loopback mechanism that allows hosts or
firewalls to filter
d30 9
a38 2
traffic using
.Xr pf 4 .
d40 3
a42 1
The
d44 1
a44 5
interface allows an administrator
to see outgoing packets before they have been processed by
.Xr ipsec 4 ,
or incoming packets after they have been similarly processed, via
.Xr tcpdump 8 .
d46 16
a61 11
The
.Dq enc0
interface inherits all IPsec traffic.
Thus all IPsec traffic can be filtered based on
.Dq enc0 ,
and all IPsec traffic could be seen by invoking
.Xr tcpdump 8
on the
.Dq enc0
interface.
Filter rules on the enc0 interface should explicitly set
d63 13
a75 3
See
.Xr pf.conf 5
and
d77 22
a98 5
for more information on filtering IPsec traffic.
.Sh EXAMPLES
To see all outgoing packets before they have been processed via
.Xr ipsec 4 ,
or all incoming packets after they have been similarly processed:
a101 2
.Xr bpf 4 ,
.Xr inet 4 ,
a102 1
.Xr netintro 4 ,
@


1.22
log
@kill trailing line;
@
text
@d1 1
a1 1
.\"	$OpenBSD: enc.4,v 1.21 2006/05/26 04:02:59 deraadt Exp $
d67 7
d86 2
@


1.21
log
@let us not talk about ipsecadm and vpn anymore; ok reyk
@
text
@d1 1
a1 1
.\"	$OpenBSD: enc.4,v 1.20 2005/04/17 12:31:38 jmc Exp $
a79 1

@


1.20
log
@no need to explicitly bring `enc0' up;
ok hshoexer@@
@
text
@d1 1
a1 1
.\"	$OpenBSD: enc.4,v 1.18 2005/01/05 03:30:16 jaredy Exp $
a47 3
The
.Xr vpn 8
manpage shows an example of such a setup.
d79 2
a80 2
.Xr tcpdump 8 ,
.Xr vpn 8
@


1.19
log
@no need to describe enc(4) as a `software loopback mechanism' twice in
a row;
@
text
@d74 2
a75 4
.Bd -literal -offset indent
# ifconfig enc0 up
# tcpdump -i enc0
.Ed
@


1.18
log
@use standard root prompt in examples
@
text
@d1 1
a1 1
.\"	$OpenBSD: enc.4,v 1.17 2004/03/21 19:47:59 miod Exp $
d54 1
a54 1
interface is a software loopback mechanism that allows an administrator
@


1.17
log
@Homogeneize config lines for pseudo-devices, and do not put fixed values.
@
text
@d1 1
a1 1
.\"	$OpenBSD: enc.4,v 1.16 2004/03/12 09:46:03 jmc Exp $
d74 3
a76 3
.Bd -literal
#> ifconfig enc0 up
#> tcpdump -i enc0
@


1.16
log
@match GENERIC;

from Karl O. Pinc;
ok deraadt@@ markus@@
@
text
@d1 1
a1 1
.\"	$OpenBSD: enc.4,v 1.15 2003/02/15 09:39:43 jmc Exp $
d39 1
a39 1
.Cd "pseudo-device enc 1"
@


1.15
log
@copyrights added;

awi(4): Bill Sommerfeld
clct(4): Tatoku Ogaito
enc(4): angelos@@
@
text
@d1 1
a1 1
.\"	$OpenBSD: enc.4,v 1.14 2001/06/26 23:24:11 angelos Exp $
d39 1
a39 1
.Cd "pseudo-device enc 4"
@


1.14
log
@PF-related text/references (jsyn@@nthought.com)
@
text
@d1 30
a30 1
.\"	$OpenBSD: enc.4,v 1.13 2001/06/22 12:15:44 mpech Exp $
@


1.13
log
@o) remove unnecessary .Pp;
o) remove unnecessary .Nm args;
o) closes .Bl;
o) .Sh AUTHOR -> .Sh AUTHORS;
o) sort SEE ALSO;
o) better -mdoc style;
o) typos;

aaron@@ ok.
@
text
@d1 1
a1 1
.\"	$OpenBSD: enc.4,v 1.12 2001/05/30 03:24:16 millert Exp $
d12 11
a22 14
.\"XXX - replace with ipfw when it is in-tree
.\"The
.\".Nm
.\"interface is a software loopback mechanism that allows hosts or
.\"firewalls to filter
.\".Xr ipsec 4
.\"traffic using
.\".Xr ipf 5 .
.\"The
.\".Xr vpn 8
.\"manpage shows an example of such a setup.
.\".Pp
.\"The other use of the
.\"XXX
d54 1
a54 1
.\".Xr ipf 5 ,
@


1.12
log
@comment out references to ipf to be replaced in the future with whatever packet filter we end up using
@
text
@d1 1
a1 1
.\"	$OpenBSD: enc.4,v 1.11 2001/03/25 22:32:45 angelos Exp $
a52 1
.Xr tcpdump 8 ,
d58 1
@


1.11
log
@Sync with reality.
@
text
@d1 1
a1 1
.\"	$OpenBSD: enc.4,v 1.10 2000/12/30 23:55:11 angelos Exp $
d12 14
d28 2
a29 13
interface is a software loopback mechanism that allows hosts or
firewalls to filter
.Xr ipsec 4
traffic using
.Xr ipf 5 .
The
.Xr vpn 8
manpage shows an example of such a setup.
.Pp
The other use of the
.Nm
interface is to allow an administrator to see outgoing packets before
they have been processed by
d58 1
a58 1
.Xr ipf 5 ,
@


1.10
log
@enc* is not used for the bridge anymore
@
text
@d1 1
a1 1
.\"	$OpenBSD: enc.4,v 1.9 2000/12/21 21:01:16 aaron Exp $
d33 2
a34 6
interface inherits all the IPsec traffic that does not have another
.Nm
interface explicitly assigned to it. Thus, if one were never to assign
an IPsec SA to another
.Nm
interface, all IPsec traffic could be filtered based on
a56 6
.Sh BUGS
The
.Cm PROMISC
flag is not cleared on the enc0 interface after
.Xr tcpdump 8
is stopped.
@


1.9
log
@Various repairs, $Id$ tags added, etc.
@
text
@d1 1
a1 1
.\"	$OpenBSD: enc.4,v 1.8 2000/11/20 08:00:00 deraadt Exp $
d23 1
a23 35
Another use is to allow the creation of virtual-Ethernets, using
.Xr ipsec 4 .
See
.Xr bridge 4
and
.Xr ipsecadm 8
for more details. Briefly,
.Nm
interfaces can be part of a bridge configuration.
Such interfaces are treated as Ethernet interfaces; packets
sent to them by the bridge are IPsec-processed and sent to the
remote bridge (which reverses the process and injects the original
Ethernet frames in the local Ethernet segments).
Packets received with the appropriate IPsec SA are made to appear as if
they arrived over the corresponding
.Nm
interface, and are then processed by the bridge accordingly.
.Xr ifconfig 8
is used to associate an
.Nm
interface with an IPsec SA.
Note that the
.Dq enc0
interface may not be used in a bridge configuration.
.Pp
If the
.Dv IFF_LINK0
flag is set on an
.Nm
interface, IP-in-IP encapsulation (instead of Ethernet-in-IP) is done.
Its use is currently experimental.
This flag should not be set when the interface is used in conjunction
with the bridge.
.Pp
The last use of the
a43 9
interface.
IPsec SAs that have been assigned to some other
.Nm
interface can be snooped via
.Xr tcpdump 8
or filtered via
.Xr ipf 5
through that
.Nm
@


1.8
log
@various Xr fixes; nordin@@cse.ogi.edu
@
text
@d1 2
a2 1
.\"	$OpenBSD: enc.4,v 1.7 2000/10/18 16:32:11 aaron Exp $
d52 1
a52 2
interface, IP-in-IP encapsulation (instead of Ethernet-in-IP) is
done.
@


1.7
log
@ethernet -> Ethernet
@
text
@d1 1
a1 1
.\"	$OpenBSD: enc.4,v 1.6 2000/04/08 18:49:28 angelos Exp $
d63 1
a63 1
.Xr tcpdump 1 .
d75 1
a75 1
.Xr tcpdump 1
d82 1
a82 1
.Xr tcpdump 1
d97 1
a97 1
.Xr tcpdump 1 ,
d108 1
a108 1
.Xr tcpdump
@


1.6
log
@Document IFF_LINK0 flag.
@
text
@d1 1
a1 1
.\"	$OpenBSD: enc.4,v 1.5 2000/01/15 19:43:41 angelos Exp $
d22 1
a22 1
Another use is to allow the creation of virtual-ethernets, using
d31 1
a31 1
Such interfaces are treated as ethernet interfaces; packets
d34 1
a34 1
ethernet frames in the local ethernet segments).
@


1.5
log
@Update.
@
text
@d1 1
a1 1
.\"	$OpenBSD: enc.4,v 1.4 1999/10/29 05:37:44 angelos Exp $
d46 10
@


1.4
log
@Add text on the new uses of the enc interface (currently lying about
the ipsecadm part).
@
text
@d1 1
a1 1
.\"	$OpenBSD: enc.4,v 1.3 1999/10/08 01:50:37 aaron Exp $
d30 5
a34 4
interfaces can be part of a bridge configuration. Such interfaces are
treated as ethernet interfaces; packets sent to them by the bridge are
IPsec-processed and sent to the remote bridge (which reverses the process and
injects the original ethernet frames in the local ethernet segments).
d39 1
a39 1
.Xr ipsecadm 8
d42 4
a45 1
interface with an IPsec SA. This is a one-to-one correspondence.
d68 2
a69 1
interface. IPsec SAs that have been assigned to some other
@


1.3
log
@Tweak.
@
text
@d1 1
a1 1
.\"	$OpenBSD: enc.4,v 1.2 1999/10/07 20:56:16 angelos Exp $
d9 1
a9 1
.Cd "pseudo-device enc 1"
d22 22
a43 1
The other use of the
d51 6
a56 1
There is only one
d58 1
a58 1
interface, named
d60 13
a72 3
regardless of the argument given on the
.Sy pseudo-device
line in the kernel configuration file.
@


1.2
log
@Section order for the SEE ALSO section.
@
text
@d1 1
a1 1
.\"	$OpenBSD: enc.4,v 1.1 1999/10/07 20:51:13 angelos Exp $
d12 1
a12 1
.Nm enc
d23 1
a23 1
.Nm enc
d31 1
a31 1
.Nm enc
d33 1
a33 1
.Sy enc Ns Ar 0 ,
d55 4
a58 4
.Fa PROMISC
flag is not cleared on the
.Sy enc Ns Ar 0
interface after tcpdump is stopped.
@


1.1
log
@enc(4) manpage
@
text
@d1 1
a1 1
.\"	$OpenBSD$
d46 1
a48 1
.Xr ipf 5 ,
d51 1
a51 1
.Xr tcpdump 1 ,
@

