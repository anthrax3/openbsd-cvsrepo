head	1.8;
access;
symbols
	OPENBSD_6_0:1.8.0.18
	OPENBSD_6_0_BASE:1.8
	OPENBSD_5_9:1.8.0.6
	OPENBSD_5_9_BASE:1.8
	OPENBSD_5_8:1.8.0.14
	OPENBSD_5_8_BASE:1.8
	OPENBSD_5_7:1.8.0.12
	OPENBSD_5_7_BASE:1.8
	OPENBSD_5_6:1.8.0.10
	OPENBSD_5_6_BASE:1.8
	OPENBSD_5_5:1.8.0.8
	OPENBSD_5_5_BASE:1.8
	OPENBSD_5_4:1.8.0.4
	OPENBSD_5_4_BASE:1.8
	OPENBSD_5_3:1.8.0.2
	OPENBSD_5_3_BASE:1.8
	OPENBSD_5_2:1.6.0.22
	OPENBSD_5_2_BASE:1.6
	OPENBSD_5_1_BASE:1.6
	OPENBSD_5_1:1.6.0.20
	OPENBSD_5_0:1.6.0.18
	OPENBSD_5_0_BASE:1.6
	OPENBSD_4_9:1.6.0.16
	OPENBSD_4_9_BASE:1.6
	OPENBSD_4_8:1.6.0.14
	OPENBSD_4_8_BASE:1.6
	OPENBSD_4_7:1.6.0.10
	OPENBSD_4_7_BASE:1.6
	OPENBSD_4_6:1.6.0.12
	OPENBSD_4_6_BASE:1.6
	OPENBSD_4_5:1.6.0.8
	OPENBSD_4_5_BASE:1.6
	OPENBSD_4_4:1.6.0.6
	OPENBSD_4_4_BASE:1.6
	OPENBSD_4_3:1.6.0.4
	OPENBSD_4_3_BASE:1.6
	OPENBSD_4_2:1.6.0.2
	OPENBSD_4_2_BASE:1.6
	OPENBSD_4_1:1.5.0.6
	OPENBSD_4_1_BASE:1.5
	OPENBSD_4_0:1.5.0.4
	OPENBSD_4_0_BASE:1.5
	OPENBSD_3_9:1.5.0.2
	OPENBSD_3_9_BASE:1.5
	OPENBSD_3_8:1.2.0.4
	OPENBSD_3_8_BASE:1.2
	OPENBSD_3_7:1.2.0.2
	OPENBSD_3_7_BASE:1.2;
locks; strict;
comment	@.\" @;


1.8
date	2012.08.24.08.54.32;	author jmc;	state Exp;
branches;
next	1.7;

1.7
date	2012.08.12.17.01.35;	author schwarze;	state Exp;
branches;
next	1.6;

1.6
date	2007.05.31.19.19.51;	author jmc;	state Exp;
branches;
next	1.5;

1.5
date	2005.10.07.16.29.10;	author norby;	state Exp;
branches;
next	1.4;

1.4
date	2005.10.04.08.45.23;	author jmc;	state Exp;
branches;
next	1.3;

1.3
date	2005.09.30.20.34.24;	author jaredy;	state Exp;
branches;
next	1.2;

1.2
date	2005.01.16.01.27.43;	author jmc;	state Exp;
branches;
next	1.1;

1.1
date	2005.01.14.14.53.54;	author mcbride;	state Exp;
branches;
next	;


desc
@@


1.8
log
@flesh out STANDARDS;
@
text
@.\" Copyright (c) 2001-2003 International Computer Science Institute
.\"
.\" Permission is hereby granted, free of charge, to any person obtaining a
.\" copy of this software and associated documentation files (the "Software"),
.\" to deal in the Software without restriction, including without limitation
.\" the rights to use, copy, modify, merge, publish, distribute, sublicense,
.\" and/or sell copies of the Software, and to permit persons to whom the
.\" Software is furnished to do so, subject to the following conditions:
.\"
.\" The above copyright notice and this permission notice shall be included in
.\" all copies or substantial portions of the Software.
.\"
.\" The names and trademarks of copyright holders may not be used in
.\" advertising or publicity pertaining to the software without specific
.\" prior permission. Title to copyright in this software and any associated
.\" documentation will at all times remain with the copyright holders.
.\"
.\" THE SOFTWARE IS PROVIDED "AS IS", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR
.\" IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,
.\" FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE
.\" AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER
.\" LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING
.\" FROM, OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER
.\" DEALINGS IN THE SOFTWARE.
.\"
.\" $FreeBSD: src/share/man/man4/pim.4,v 1.2 2004/07/09 09:22:36 ru Exp $
.\" $OpenBSD: pim.4,v 1.7 2012/08/12 17:01:35 schwarze Exp $
.\" $NetBSD: pim.4,v 1.2 2004/09/12 13:06:14 wiz Exp $
.\"
.Dd $Mdocdate: August 12 2012 $
.Dt PIM 4
.Os
.\"
.Sh NAME
.Nm pim
.Nd Protocol Independent Multicast
.\"
.Sh SYNOPSIS
.Cd "options MROUTING"
.Cd "options PIM"
.Pp
.In sys/types.h
.In sys/socket.h
.In netinet/in.h
.In netinet/ip_mroute.h
.In netinet/pim.h
.Ft int
.Fn getsockopt "int s" IPPROTO_IP MRT_PIM "void *optval" "socklen_t *optlen"
.Ft int
.Fn setsockopt "int s" IPPROTO_IP MRT_PIM "const void *optval" "socklen_t optlen"
.Ft int
.Fn getsockopt "int s" IPPROTO_IPV6 MRT6_PIM "void *optval" "socklen_t *optlen"
.Ft int
.Fn setsockopt "int s" IPPROTO_IPV6 MRT6_PIM "const void *optval" "socklen_t optlen"
.Sh DESCRIPTION
.Tn PIM
is the common name for two multicast routing protocols:
Protocol Independent Multicast \- Sparse Mode (PIM-SM) and
Protocol Independent Multicast \- Dense Mode (PIM-DM).
.Pp
PIM-SM is a multicast routing protocol that can use the underlying
unicast routing information base or a separate multicast-capable
routing information base.
It builds unidirectional shared trees rooted at a Rendezvous
Point (RP) per group,
and optionally creates shortest-path trees per source.
.Pp
PIM-DM is a multicast routing protocol that uses the underlying
unicast routing information base to flood multicast datagrams
to all multicast routers.
Prune messages are used to prevent future datagrams from propagating
to routers with no group membership information.
.Pp
Both PIM-SM and PIM-DM are fairly complex protocols,
though PIM-SM is much more complex.
To enable PIM-SM or PIM-DM multicast routing in a router,
the user must enable multicast forwarding via the
.Va net.inet.ip.mforwarding
.Xr sysctl 8
and PIM processing in the kernel
(see
.Sx SYNOPSIS
for the correct kernel configuration option).
The user must also run a PIM-SM or PIM-DM capable user-level process.
From a developer's point of view,
the programming guide described in the
.Sx "Programming Guide"
section should be used to control the PIM processing in the kernel.
.\"
.Ss Programming Guide
After a multicast routing socket is open and multicast forwarding
is enabled in the kernel
(see
.Xr multicast 4 ) ,
one of the following socket options should be used to enable or disable
PIM processing in the kernel.
Note that those options require certain privilege
(i.e., root privilege):
.Bd -literal -offset 4n
/* IPv4 */
int v = 1;        /* 1 to enable, or 0 to disable */
setsockopt(mrouter_s4, IPPROTO_IP, MRT_PIM, (void *)&v, sizeof(v));
.Ed
.Bd -literal -offset 4n
/* IPv6 */
int v = 1;        /* 1 to enable, or 0 to disable */
setsockopt(mrouter_s6, IPPROTO_IPV6, MRT6_PIM, (void *)&v, sizeof(v));
.Ed
.Pp
After PIM processing is enabled, the multicast-capable interfaces
should be added
(see
.Xr multicast 4 ) .
For PIM-SM, the PIM-Register virtual interface must be added
as well.
This can be accomplished by using the following options:
.Bd -literal -offset indent
/* IPv4 */
struct vifctl vc;
memset(&vc, 0, sizeof(vc));
/* Assign all vifctl fields as appropriate */
\&...
if (is_pim_register_vif)
    vc.vifc_flags |= VIFF_REGISTER;
setsockopt(mrouter_s4, IPPROTO_IP, MRT_ADD_VIF, (void *)&vc,
           sizeof(vc));
.Ed
.Bd -literal -offset indent
/* IPv6 */
struct mif6ctl mc;
memset(&mc, 0, sizeof(mc));
/* Assign all mif6ctl fields as appropriate */
\&...
if (is_pim_register_vif)
    mc.mif6c_flags |= MIFF_REGISTER;
setsockopt(mrouter_s6, IPPROTO_IPV6, MRT6_ADD_MIF, (void *)&mc,
           sizeof(mc));
.Ed
.Pp
Sending or receiving of PIM packets can be accomplished by
first opening a
.Dq raw socket
(see
.Xr socket 2 ) ,
with protocol value of
.Dv IPPROTO_PIM :
.Bd -literal -offset indent
/* IPv4 */
int pim_s4;
pim_s4 = socket(AF_INET, SOCK_RAW, IPPROTO_PIM);
.Ed
.Bd -literal -offset indent
/* IPv6 */
int pim_s6;
pim_s6 = socket(AF_INET6, SOCK_RAW, IPPROTO_PIM);
.Ed
.Pp
Then the following system calls can be used to send or receive PIM
packets:
.Xr sendto 2 ,
.Xr sendmsg 2 ,
.Xr recvfrom 2 ,
and
.Xr recvmsg 2 .
.\"
.Sh SEE ALSO
.Xr getsockopt 2 ,
.Xr recvfrom 2 ,
.Xr recvmsg 2 ,
.Xr sendmsg 2 ,
.Xr sendto 2 ,
.Xr setsockopt 2 ,
.Xr socket 2 ,
.Xr inet 4 ,
.Xr intro 4 ,
.Xr ip 4 ,
.Xr multicast 4 ,
.Xr sysctl 8
.\"
.Sh STANDARDS
.Rs
.%A A. Adams
.%A J. Nicholas
.%A W. Siadak
.%D January 2005
.%R RFC 3973
.%T Protocol Independent Multicast \(en Dense Mode (PIM-DM): Protocol Specification (Revised)
.Re
.Pp
.Rs
.%A B. Fenner
.%A M. Handley
.%A H. Holbrook
.%A I. Kouvelas
.%D August 2006
.%R RFC 4601
.%T Protocol Independent Multicast \(en Sparse Mode (PIM-SM): Protocol Specification (Revised)
.Re
.Pp
.Rs
.%A N. Bhaskar
.%A A. Gall
.%A J. Lingard
.%A S. Venaas
.%D January 2008
.%R RFC 5059
.%T Bootstrap Router (BSR) Mechanism for Protocol Independent Multicast (PIM)
.Re
.\"
.Sh AUTHORS
.An -nosplit
The original IPv4 PIM kernel support for IRIX and SunOS-4.x was
implemented by
.An Ahmed Helmy
(USC and SGI).
Later the code was ported to various
.Bx
flavors and modified by
.An George Edmond Eddy
(Rusty) (ISI),
.An Hitoshi Asaeda
(WIDE Project), and
.An Pavlin Radoslavov
(USC/ISI and ICSI).
.Pp
The IPv6 PIM kernel support was implemented by the KAME project
.Pq Lk http://www.kame.net ,
and was based on the IPv4 PIM kernel support.
.Pp
This manual page was written by
.An Pavlin Radoslavov
(ICSI).
@


1.7
log
@Use .Lk for HTTP hyperlinks, not .Pa.
Most of the patch from Arto Jonsson <ajonsson at kapsi dot fi>.
jmc@@ agrees in principle that .Lk is the right macro to use.

While here, update a few broken links,
and add missing markup at a few places.
@
text
@d27 1
a27 1
.\" $OpenBSD: pim.4,v 1.6 2007/05/31 19:19:51 jmc Exp $
d30 1
a30 1
.Dd $Mdocdate: May 31 2007 $
d181 28
a208 3
The PIM-SM protocol is specified in RFC 2362 (to be replaced by
.Pa draft-ietf-pim-sm-v2-new-* ) .
The PIM-DM protocol is specified in RFC 3973.
@


1.6
log
@convert to new .Dd format;
@
text
@d27 1
a27 1
.\" $OpenBSD: pim.4,v 1.5 2005/10/07 16:29:10 norby Exp $
d30 1
a30 1
.Dd $Mdocdate$
d202 1
a202 1
.Pq Pa http://www.kame.net ,
@


1.5
log
@Document the recent changes to the multicast routing in the kernel.

from jmc@@

ok jmc@@
@
text
@d27 1
a27 1
.\" $OpenBSD: pim.4,v 1.4 2005/10/04 08:45:23 jmc Exp $
d30 1
a30 1
.Dd September 4, 2003
@


1.4
log
@update RFC reference for PIM-DM;
remove out of date comment concerning RFC for PIM-SM;

ok mcbride@@
@
text
@d27 1
a27 1
.\" $OpenBSD: pim.4,v 1.3 2005/09/30 20:34:24 jaredy Exp $
d77 4
a80 1
the user must enable multicast routing and PIM processing in the kernel
d83 2
a84 2
about the kernel configuration options),
and must run a PIM-SM or PIM-DM capable user-level process.
d177 2
a178 1
.Xr multicast 4
@


1.3
log
@deploy .An -nosplit; ok jmc
@
text
@d27 1
a27 1
.\" $OpenBSD: pim.4,v 1.2 2005/01/16 01:27:43 jmc Exp $
a176 2
.\" XXX the PIM-SM number must be updated after RFC 2362 is
.\" replaced by a new RFC by the end of year 2003 or so.
d179 1
a179 2
The PIM-DM protocol is specified in
.Pa draft-ietf-pim-dm-new-v2-* .
@


1.2
log
@tweaks;
@
text
@d27 1
a27 1
.\" $OpenBSD: pim.4,v 1.1 2005/01/14 14:53:54 mcbride Exp $
d185 1
@


1.1
log
@Document Protocol Independant Multicast

From Pavlin Radoslavov <pavlin@@icir.org>

ok deraadt@@ brad@@
@
text
@d27 1
a27 1
.\" $OpenBSD$
d58 2
a59 2
Protocol Independent Multicast - Sparse Mode (PIM-SM) and
Protocol Independent Multicast - Dense Mode (PIM-DM).
d82 1
a82 1
From developer's point of view,
d96 1
a96 1
.Bd -literal
d99 1
a99 1
setsockopt(mrouter_s4, IPPROTO_IP, MRT_PIM, (void *)\*[Am]v, sizeof(v));
d101 1
a101 1
.Bd -literal
d104 1
a104 1
setsockopt(mrouter_s6, IPPROTO_IPV6, MRT6_PIM, (void *)\*[Am]v, sizeof(v));
d111 1
a111 1
In case of PIM-SM, the PIM-Register virtual interface must be added
d114 1
a114 1
.Bd -literal
d117 1
a117 1
memset(\*[Am]vc, 0, sizeof(vc));
d122 1
a122 1
setsockopt(mrouter_s4, IPPROTO_IP, MRT_ADD_VIF, (void *)\*[Am]vc,
d125 1
a125 1
.Bd -literal
d128 1
a128 1
memset(\*[Am]mc, 0, sizeof(mc));
d133 1
a133 1
setsockopt(mrouter_s6, IPPROTO_IPV6, MRT6_ADD_MIF, (void *)\*[Am]mc,
d138 1
a138 1
opening first a
d144 1
a144 1
.Bd -literal
d149 1
a149 1
.Bd -literal
d155 1
a155 1
Then, the following system calls can be used to send or receive PIM
d160 1
d180 1
a180 1
.%T draft-ietf-pim-sm-v2-new-* ) .
d182 1
a182 1
.%T draft-ietf-pim-dm-new-v2-* ) .
a184 1
.An -nosplit
d198 1
@

