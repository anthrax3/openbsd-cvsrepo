head	1.19;
access;
symbols
	OPENBSD_6_2_BASE:1.19
	OPENBSD_6_1:1.19.0.14
	OPENBSD_6_1_BASE:1.19
	OPENBSD_6_0:1.19.0.12
	OPENBSD_6_0_BASE:1.19
	OPENBSD_5_9:1.19.0.2
	OPENBSD_5_9_BASE:1.19
	OPENBSD_5_8:1.19.0.8
	OPENBSD_5_8_BASE:1.19
	OPENBSD_5_7:1.19.0.6
	OPENBSD_5_7_BASE:1.19
	OPENBSD_5_6:1.19.0.4
	OPENBSD_5_6_BASE:1.19
	OPENBSD_5_5:1.18.0.4
	OPENBSD_5_5_BASE:1.18
	OPENBSD_5_4:1.14.0.4
	OPENBSD_5_4_BASE:1.14
	OPENBSD_5_3:1.14.0.2
	OPENBSD_5_3_BASE:1.14
	OPENBSD_5_2:1.11.0.4
	OPENBSD_5_2_BASE:1.11
	OPENBSD_5_1_BASE:1.11
	OPENBSD_5_1:1.11.0.2
	OPENBSD_5_0:1.10.0.8
	OPENBSD_5_0_BASE:1.10
	OPENBSD_4_9:1.10.0.6
	OPENBSD_4_9_BASE:1.10
	OPENBSD_4_8:1.10.0.4
	OPENBSD_4_8_BASE:1.10
	OPENBSD_4_7:1.10.0.2
	OPENBSD_4_7_BASE:1.10
	OPENBSD_4_6:1.9.0.6
	OPENBSD_4_6_BASE:1.9
	OPENBSD_4_5:1.9.0.2
	OPENBSD_4_5_BASE:1.9;
locks; strict;
comment	@.\" @;


1.19
date	2014.03.29.11.26.03;	author florian;	state Exp;
branches;
next	1.18;

1.18
date	2014.01.21.21.27.14;	author benno;	state Exp;
branches;
next	1.17;

1.17
date	2014.01.21.03.15.46;	author schwarze;	state Exp;
branches;
next	1.16;

1.16
date	2013.09.14.14.54.30;	author jmc;	state Exp;
branches;
next	1.15;

1.15
date	2013.09.13.14.32.53;	author florian;	state Exp;
branches;
next	1.14;

1.14
date	2012.10.30.12.09.05;	author florian;	state Exp;
branches;
next	1.13;

1.13
date	2012.09.26.17.34.38;	author jmc;	state Exp;
branches;
next	1.12;

1.12
date	2012.08.22.18.22.42;	author jmc;	state Exp;
branches;
next	1.11;

1.11
date	2012.02.02.12.34.37;	author benno;	state Exp;
branches;
next	1.10;

1.10
date	2009.11.27.17.56.48;	author jmc;	state Exp;
branches;
next	1.9;

1.9
date	2008.10.29.14.49.39;	author jmc;	state Exp;
branches;
next	1.8;

1.8
date	2008.10.28.16.55.37;	author gollo;	state Exp;
branches;
next	1.7;

1.7
date	2008.10.10.13.55.25;	author sobrado;	state Exp;
branches;
next	1.6;

1.6
date	2008.09.12.15.22.07;	author henning;	state Exp;
branches;
next	1.5;

1.5
date	2008.09.12.09.09.43;	author henning;	state Exp;
branches;
next	1.4;

1.4
date	2008.09.10.23.32.03;	author brad;	state Exp;
branches;
next	1.3;

1.3
date	2008.09.10.14.54.47;	author jmc;	state Exp;
branches;
next	1.2;

1.2
date	2008.09.09.15.47.15;	author henning;	state Exp;
branches;
next	1.1;

1.1
date	2008.09.09.13.56.38;	author henning;	state Exp;
branches;
next	;


desc
@@


1.19
log
@Kill pflowproto 9, it's unfixable post 2038, a better, standardized
option is pflowproto 10. Also it duplicates a lot of code from
pflowproto 10 and will get in the way in the future.
OK benno@@
@
text
@.\" $OpenBSD: pflow.4,v 1.18 2014/01/21 21:27:14 benno Exp $
.\"
.\" Copyright (c) 2008 Henning Brauer <henning@@openbsd.org>
.\" Copyright (c) 2008 Joerg Goltermann <jg@@osn.de>
.\"
.\" Permission to use, copy, modify, and distribute this software for any
.\" purpose with or without fee is hereby granted, provided that the above
.\" copyright notice and this permission notice appear in all copies.
.\"
.\" THE SOFTWARE IS PROVIDED "AS IS" AND THE AUTHOR DISCLAIMS ALL WARRANTIES
.\" WITH REGARD TO THIS SOFTWARE INCLUDING ALL IMPLIED WARRANTIES OF
.\" MERCHANTABILITY AND FITNESS. IN NO EVENT SHALL THE AUTHOR BE LIABLE FOR
.\" ANY SPECIAL, DIRECT, INDIRECT, OR CONSEQUENTIAL DAMAGES OR ANY DAMAGES
.\" WHATSOEVER RESULTING FROM LOSS OF USE, DATA OR PROFITS, WHETHER IN AN
.\" ACTION OF CONTRACT, NEGLIGENCE OR OTHER TORTIOUS ACTION, ARISING OUT OF
.\" OR IN CONNECTION WITH THE USE OR PERFORMANCE OF THIS SOFTWARE.
.\"
.Dd $Mdocdate: January 21 2014 $
.Dt PFLOW 4
.Os
.Sh NAME
.Nm pflow
.Nd kernel interface for pflow data export
.Sh SYNOPSIS
.Cd "pseudo-device pflow"
.Sh DESCRIPTION
The
.Nm
interface is a pseudo-device which exports
.Nm
accounting data from the kernel using
.Xr udp 4
packets.
.Nm
is compatible with netflow version 5 and IPFIX (10).
The data is extracted from the
.Xr pf 4
state table.
.Pp
Multiple
.Nm
interfaces can be created at runtime using the
.Ic ifconfig pflow Ns Ar N Ic create
command.
Each interface must be configured with a flow receiver IP address
and a flow receiver port number.
.Pp
Only states created by a rule marked with the
.Ar pflow
keyword are exported by the
.Nm
interface.
.Pp
The
.Nm
interface will attempt to export multiple
.Nm
records in one
UDP packet, but will not hold a record for longer than 30 seconds.
The packet size and thus the maximum number of flows is controlled by the
.Cm mtu
parameter of
.Xr ifconfig 8 .
.Pp
Each packet seen on this interface has one header and a variable number of
flows.
The header indicates the version of the protocol, number of
flows in the packet, a unique sequence number, system time, and an engine
ID and type.
Header and flow structs are defined in
.In net/if_pflow.h .
.Pp
There is a one-to-one correspondence between packets seen by
.Xr bpf 4
on the
.Nm
interface and packets sent out to the flow receiver.
That is, a packet with 30 flows on
.Nm
means that the same 30 flows were sent out to the receiver.
.Pp
The
.Nm
source and destination addresses are controlled by
.Xr ifconfig 8 .
.Cm flowsrc
is the sender IP address of the UDP packet which can be used
to identify the source of the data on the
.Nm
collector.
.Cm flowdst
defines the collector IP address and the port.
The
.Cm flowdst
IP address and port must be defined to enable the export of flows.
.Pp
For example, the following command sets 10.0.0.1 as the source
and 10.0.0.2:1234 as destination:
.Bd -literal -offset indent
# ifconfig pflow0 flowsrc 10.0.0.1 flowdst 10.0.0.2:1234
.Ed
.Pp
The protocol is set to IPFIX with the following command:
.Bd -literal -offset indent
# ifconfig pflow0 pflowproto 10
.Ed
.Sh SEE ALSO
.Xr netintro 4 ,
.Xr pf 4 ,
.Xr udp 4 ,
.Xr pf.conf 5 ,
.Xr ifconfig 8 ,
.Xr tcpdump 8
.Sh STANDARDS
.Rs
.%A B. Claise
.%D January 2008
.%R RFC 5101
.%T "Specification of the IP Flow Information Export (IPFIX) Protocol for the Exchange of IP Traffic Flow Information"
.Re
.Sh HISTORY
The
.Nm
device first appeared in
.Ox 4.5 .
.Sh BUGS
A state created by
.Xr pfsync 4
can have a creation or expiration time before the machine came up.
In this case,
.Nm
pretends such flows were created or expired when the machine came up.
.Pp
The IPFIX implementation is incomplete:
The required transport protocol SCTP is not supported.
Transport over TCP and DTLS protected flow export is also not supported.
@


1.18
log
@allow pflow(4) to determine the src IP address based on the route
table if flowsrc is not set. Now works with new udp checksum code.
From Nathanael Rensen (nathanael.openbsd AT list DOT polymorpheus DOT
com), tweak and ok florian@@
@
text
@d1 1
a1 1
.\" $OpenBSD: pflow.4,v 1.17 2014/01/21 03:15:46 schwarze Exp $
d35 1
a35 1
is compatible with netflow version 5, 9, and IPFIX (10).
a114 7
.Rs
.%A B. Claise
.%D October 2004
.%R RFC 3954
.%T Cisco Systems NetFlow Services Export Version 9
.Re
.Pp
@


1.17
log
@obvious .Pa fixes; found with mandocdb(8)
@
text
@d1 1
a1 1
.\" $OpenBSD: pflow.4,v 1.16 2013/09/14 14:54:30 jmc Exp $
d18 1
a18 1
.Dd $Mdocdate: September 14 2013 $
d45 1
a45 2
Each interface must be configured with a flow sender IP address,
a flow receiver IP address,
a93 2
.Cm flowsrc
IP address and
@


1.16
log
@tweak previous;
@
text
@d1 1
a1 1
.\" $OpenBSD: pflow.4,v 1.15 2013/09/13 14:32:53 florian Exp $
d18 1
a18 1
.Dd $Mdocdate: September 13 2013 $
d72 1
a72 1
.Aq Pa net/if_pflow.h .
@


1.15
log
@pflow(4) does not work without flowsrc set.
OK benno@@
@
text
@d1 1
a1 1
.\" $OpenBSD: pflow.4,v 1.14 2012/10/30 12:09:05 florian Exp $
d18 1
a18 1
.Dd $Mdocdate: October 30 2012 $
d45 3
a47 2
Each interface must be configured with flow sender IP address and a flow
receiver IP address and port number.
@


1.14
log
@Use time_uptime for expiration values as time_second can be skewed at
runtime while time_uptime is monotonic. Prevent underflows in
pfsync(4) and pflow(4) by using signed variables.  pfsync(4) problem
pointed out by camield.

Diff originally by dlg, frag and pflow bits by me.

feedback dlg
man page tweak jmc

Various versions of the pflow bits tested by Hrvoje Popovski
(hrvoje AT srce DOT hr), thanks!

ok benno, henning, dlg
@
text
@d1 1
a1 1
.\" $OpenBSD: pflow.4,v 1.13 2012/09/26 17:34:38 jmc Exp $
d18 1
a18 1
.Dd $Mdocdate: September 26 2012 $
d45 2
a46 2
Each interface must be configured with a flow receiver IP address and
port number.
d94 2
@


1.13
log
@last stage of rfc changes, using consistent Rs/Re blocks, and moving the
references into a STANDARDS section;
@
text
@d1 1
a1 1
.\" $OpenBSD: pflow.4,v 1.12 2012/08/22 18:22:42 jmc Exp $
d18 1
a18 1
.Dd $Mdocdate: August 22 2012 $
d134 7
@


1.12
log
@flesh out the rfc details a little; from Florian Obser
@
text
@d1 1
a1 1
.\" $OpenBSD: pflow.4,v 1.11 2012/02/02 12:34:37 benno Exp $
d18 1
a18 1
.Dd $Mdocdate: February 2 2012 $
d114 1
d121 1
@


1.11
log
@add netflow v9/ipfix support to pflow(4).
large parts written by Florian Obser (florian -at- narrans -dot- de).
feedback from sperreault@@ gollo@@ sthen@@
ok from gollo@@ dlg@@ henning@@
@
text
@d1 1
a1 1
.\" $OpenBSD: pflow.4,v 1.10 2009/11/27 17:56:48 jmc Exp $
d18 1
a18 1
.Dd $Mdocdate: November 27 2009 $
d115 2
d118 1
a118 2
.%T "Cisco Systems NetFlow Services Export Version 9"
.%D October 2004
d121 2
a124 1
.%D January 2008
@


1.10
log
@fix some spacing issues in the copyright; permission granted
from the authors, henning and gollo

from Brad Tilley
@
text
@d1 1
a1 1
.\" $OpenBSD: pflow.4,v 1.9 2008/10/29 14:49:39 jmc Exp $
d18 1
a18 1
.Dd $Mdocdate: October 29 2008 $
d35 1
a35 1
is compatible with netflow v5.
d102 5
d114 10
d129 4
@


1.9
log
@tweak previous;
@
text
@d1 1
a1 1
.\" $OpenBSD: pflow.4,v 1.8 2008/10/28 16:55:37 gollo Exp $
d10 1
a10 1
.\" THE SOFTWARE IS PROVIDED "AS IS" AND THE AUTHOR DISCLAIMS ALLWARRANTIES
d12 1
a12 1
.\" MERCHANTABILITY AND FITNESS. IN NO EVENT SHALL THE AUTHOR BELIABLE FOR
d15 1
a15 1
.\" ACTION OF CONTRACT, NEGLIGENCE OR OTHER TORTIOUS ACTION, ARISINGOUT OF
d18 1
a18 1
.Dd $Mdocdate: October 28 2008 $
@


1.8
log
@mention the new pflow(4) features: bpf support and multiple interfaces

OK: henning@@
@
text
@d1 1
a1 1
.\" $OpenBSD: pflow.4,v 1.7 2008/10/10 13:55:25 sobrado Exp $
d18 1
a18 1
.Dd $Mdocdate: October 10 2008 $
d77 2
a78 2
interface, and packets sent out to the flow receiver, i.e.\&
a packet with 30 flows on
@


1.7
log
@write "pflow", "flowsrc" and "flowdst" using the right macros.
@
text
@d1 1
a1 1
.\" $OpenBSD: pflow.4,v 1.6 2008/09/12 15:22:07 henning Exp $
d18 1
a18 1
.Dd $Mdocdate: September 12 2008 $
d40 8
d72 9
@


1.6
log
@oops missed to decapitalize the first char
@
text
@d1 1
a1 1
.\" $OpenBSD: pflow.4,v 1.5 2008/09/12 09:09:43 henning Exp $
d29 2
a30 1
interface is a pseudo-device which exports pflow
d34 2
a35 1
pflow is compatible with netflow v5.
d48 3
a50 1
interface will attempt to export multiple pflow records in one
d65 3
a67 1
The pflow source and destination addresses are controlled by
d69 10
a78 4
flowsrc is the sender IP address of the UDP packet which can be used
to identify the source of the data on the pflow collector.
flowdst defines the collector IP address and the port.
The flowdst IP address and port must be defined to enable the export of flows.
@


1.5
log
@revert last unauthorized commit.
I reAlly doN't ThiNk thAt ranDomLy capiTaliZing chAractErs iN woRdS mAkes
tHeM loOk MoRe ImpoRtaNt eVeN iF cIScO tHinKs sO
@
text
@d1 1
a1 1
.\" $OpenBSD: pflow.4,v 1.4 2008/09/10 23:32:03 brad Exp $
d18 1
a18 1
.Dd $Mdocdate: September 10 2008 $
d33 1
a33 1
pflow is compatible with Netflow v5.
@


1.4
log
@Correct capitalization of NetFlow.
@
text
@d1 1
a1 1
.\" $OpenBSD: pflow.4,v 1.3 2008/09/10 14:54:47 jmc Exp $
d33 1
a33 1
pflow is compatible with NetFlow v5.
@


1.3
log
@some pflow tweaks;
@
text
@d1 1
a1 1
.\" $OpenBSD: pflow.4,v 1.2 2008/09/09 15:47:15 henning Exp $
d18 1
a18 1
.Dd $Mdocdate: September 9 2008 $
d33 1
a33 1
pflow is compatible with netflow v5.
@


1.2
log
@clarify mtu setting, pt out by theo
@
text
@d1 1
a1 1
.\" $OpenBSD: pflow.4,v 1.1 2008/09/09 13:56:38 henning Exp $
a48 4
.Ar mtu
parameter of ifconfig
(see the
.Xr ifconfig 8
d50 2
a51 1
parameter).
@


1.1
log
@welcome pflow(4), a netflow v5 compatible flow export interface.
flows export data gathered from pf states.
initial implementation by Joerg Goltermann <jg@@osn.de>, guidance and many
changes by me. 'put it in' theo
@
text
@d1 1
a1 1
.\" $OpenBSD$
d18 1
a18 1
.Dd $Mdocdate: September 1 2008 $
d48 1
a48 1
The maximum number of flows is controlled by the
@

