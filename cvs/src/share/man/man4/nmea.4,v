head	1.25;
access;
symbols
	OPENBSD_6_2:1.25.0.8
	OPENBSD_6_2_BASE:1.25
	OPENBSD_6_1:1.25.0.12
	OPENBSD_6_1_BASE:1.25
	OPENBSD_6_0:1.25.0.10
	OPENBSD_6_0_BASE:1.25
	OPENBSD_5_9:1.25.0.2
	OPENBSD_5_9_BASE:1.25
	OPENBSD_5_8:1.25.0.6
	OPENBSD_5_8_BASE:1.25
	OPENBSD_5_7:1.25.0.4
	OPENBSD_5_7_BASE:1.25
	OPENBSD_5_6:1.24.0.8
	OPENBSD_5_6_BASE:1.24
	OPENBSD_5_5:1.24.0.6
	OPENBSD_5_5_BASE:1.24
	OPENBSD_5_4:1.24.0.2
	OPENBSD_5_4_BASE:1.24
	OPENBSD_5_3:1.23.0.12
	OPENBSD_5_3_BASE:1.23
	OPENBSD_5_2:1.23.0.10
	OPENBSD_5_2_BASE:1.23
	OPENBSD_5_1_BASE:1.23
	OPENBSD_5_1:1.23.0.8
	OPENBSD_5_0:1.23.0.6
	OPENBSD_5_0_BASE:1.23
	OPENBSD_4_9:1.23.0.4
	OPENBSD_4_9_BASE:1.23
	OPENBSD_4_8:1.23.0.2
	OPENBSD_4_8_BASE:1.23
	OPENBSD_4_7:1.22.0.6
	OPENBSD_4_7_BASE:1.22
	OPENBSD_4_6:1.22.0.8
	OPENBSD_4_6_BASE:1.22
	OPENBSD_4_5:1.22.0.4
	OPENBSD_4_5_BASE:1.22
	OPENBSD_4_4:1.22.0.2
	OPENBSD_4_4_BASE:1.22
	OPENBSD_4_3:1.20.0.2
	OPENBSD_4_3_BASE:1.20
	OPENBSD_4_2:1.16.0.2
	OPENBSD_4_2_BASE:1.16
	OPENBSD_4_1:1.12.0.2
	OPENBSD_4_1_BASE:1.12
	OPENBSD_4_0:1.9.0.2
	OPENBSD_4_0_BASE:1.9;
locks; strict;
comment	@.\" @;


1.25
date	2015.01.15.00.48.10;	author deraadt;	state Exp;
branches;
next	1.24;
commitid	1Hf1LpAl69ZwQUMK;

1.24
date	2013.07.16.16.05.49;	author schwarze;	state Exp;
branches;
next	1.23;

1.23
date	2010.04.21.23.43.39;	author sthen;	state Exp;
branches;
next	1.22;

1.22
date	2008.05.06.09.01.08;	author mbalmer;	state Exp;
branches;
next	1.21;

1.21
date	2008.05.05.20.04.11;	author mbalmer;	state Exp;
branches;
next	1.20;

1.20
date	2008.01.06.09.53.17;	author mbalmer;	state Exp;
branches;
next	1.19;

1.19
date	2007.11.27.15.22.49;	author jmc;	state Exp;
branches;
next	1.18;

1.18
date	2007.11.26.23.05.28;	author mbalmer;	state Exp;
branches;
next	1.17;

1.17
date	2007.11.03.17.26.25;	author jmc;	state Exp;
branches;
next	1.16;

1.16
date	2007.05.31.19.19.51;	author jmc;	state Exp;
branches;
next	1.15;

1.15
date	2007.03.30.07.42.01;	author mbalmer;	state Exp;
branches;
next	1.14;

1.14
date	2007.03.19.13.52.34;	author jmc;	state Exp;
branches;
next	1.13;

1.13
date	2007.03.19.06.42.36;	author mbalmer;	state Exp;
branches;
next	1.12;

1.12
date	2006.11.29.07.32.08;	author jmc;	state Exp;
branches;
next	1.11;

1.11
date	2006.11.29.00.08.34;	author mbalmer;	state Exp;
branches;
next	1.10;

1.10
date	2006.10.07.06.53.28;	author mbalmer;	state Exp;
branches;
next	1.9;

1.9
date	2006.09.03.18.26.05;	author jmc;	state Exp;
branches;
next	1.8;

1.8
date	2006.06.14.09.45.02;	author mbalmer;	state Exp;
branches;
next	1.7;

1.7
date	2006.06.14.08.03.08;	author mbalmer;	state Exp;
branches;
next	1.6;

1.6
date	2006.06.12.09.27.13;	author mbalmer;	state Exp;
branches;
next	1.5;

1.5
date	2006.06.12.09.23.25;	author mbalmer;	state Exp;
branches;
next	1.4;

1.4
date	2006.06.12.09.11.08;	author mbalmer;	state Exp;
branches;
next	1.3;

1.3
date	2006.06.12.08.59.33;	author jmc;	state Exp;
branches;
next	1.2;

1.2
date	2006.06.01.22.10.39;	author jmc;	state Exp;
branches;
next	1.1;

1.1
date	2006.06.01.20.10.28;	author mbalmer;	state Exp;
branches;
next	;


desc
@@


1.25
log
@I bet the reference to <sys/ttycom.h> near the ldisc list in tty(4)
led this program and the associated manual pages to including that
file directly, rather than the canonical include path of <sys/ioctl.h>
discussed with millert
@
text
@.\"	$OpenBSD: nmea.4,v 1.24 2013/07/16 16:05:49 schwarze Exp $
.\"
.\" Copyright (c) 2006, 2007 Marc Balmer <mbalmer@@openbsd.org>
.\"
.\" Permission to use, copy, modify, and distribute this software for any
.\" purpose with or without fee is hereby granted, provided that the above
.\" copyright notice and this permission notice appear in all copies.
.\"
.\" THE SOFTWARE IS PROVIDED "AS IS" AND THE AUTHOR DISCLAIMS ALL WARRANTIES
.\" WITH REGARD TO THIS SOFTWARE INCLUDING ALL IMPLIED WARRANTIES OF
.\" MERCHANTABILITY AND FITNESS. IN NO EVENT SHALL THE AUTHOR BE LIABLE FOR
.\" ANY SPECIAL, DIRECT, INDIRECT, OR CONSEQUENTIAL DAMAGES OR ANY DAMAGES
.\" WHATSOEVER RESULTING FROM LOSS OF USE, DATA OR PROFITS, WHETHER IN AN
.\" ACTION OF CONTRACT, NEGLIGENCE OR OTHER TORTIOUS ACTION, ARISING OUT OF
.\" OR IN CONNECTION WITH THE USE OR PERFORMANCE OF THIS SOFTWARE.
.\"
.Dd $Mdocdate: July 16 2013 $
.Dt NMEA 4
.Os
.Sh NAME
.Nm nmea
.Nd NMEA 0183 timedelta sensor
.Sh SYNOPSIS
.Cd "pseudo-device nmea" Op Ar count
.Sh DESCRIPTION
This line discipline interfaces NMEA devices,
such as GPS receivers attached to a serial or USB port.
.Pp
The line discipline is enabled by the following sequence:
.Bd -literal -offset indent
#include <sys/ioctl.h>
int ldisc = NMEADISC, fildes; ...
ioctl(fildes, TIOCSETD, &ldisc);
.Ed
.Pp
The byte stream is unaltered by the line discipline which
maintains timedelta and position sensors using the NMEA data.
The sensors will appear as nmea* in the list.
The timedelta (nanoseconds difference between the received time
information and the local time), and position (calculated
latitude and longitude in degrees) can be accessed through the
.Xr sysctl 8
interface.
.Sh NMEA SENTENCES
The
.Nm
line discipline decodes the following NMEA 0183 sentences:
.Bl -tag -width "GPRMCXX"
.It GPRMC
Recommended Minimum Specific GPS/TRANSIT Data.
The time and date information and position are extracted.
The warning indication is used to provide the sensor status (see below).
If the attached device sends the GPRMC message in the 13-field format,
the operation mode of the GPS device is reported in the sensor description.
The sensor timestamp is copied from the tty timestamp if a device with PPS
is being used and tty timestamping has been turned on.
Otherwise the sensor timestamp is taken when the initial `$' character of
a message block is received from the NMEA device.
.El
.Sh SENSOR STATES
The quality of the timedelta is reported as the sensor status:
.Bl -tag -width "CRITICALXX" -offset indent
.It OK
The time information and position are valid.
The timedelta is safe to use for applications like
.Xr ntpd 8 .
.It WARN
The attached GPS receiver has been indicating a warning condition
for at least the last ten minutes.
The timedelta should be used with care.
.It CRITICAL
tty timestamping has been turned on but there is no PPS signal present or the
GPS receiver indicated a warning condition for at least the last twenty
minutes.
Check your hardware.
Some GPS units need PPS to be manually turned on.
.El
.Pp
The status of a second sensor is used to report the status of the
device itself:
.Bl -tag -width "CRITICALXX" -offset indent
.It OK
The clock is synchronized, e.g. a GPS receiver has a fix.
.It WARN
The device issued a warning condition, e.g. a GPS receiver has no fix.
.El
.Sh SEE ALSO
.Xr tty 4 ,
.Xr ldattach 8 ,
.Xr ntpd 8 ,
.Xr sysctl 8
.Sh HISTORY
The
.Nm
interface first appeared in
.Ox 4.0 .
.Sh AUTHORS
The
.Nm
line discipline was written by
.An Marc Balmer Aq Mt mbalmer@@openbsd.org .
@


1.24
log
@use .Mt for email addresses; from Jan Stary <hans at stare dot cz>; ok jmc@@
@
text
@d1 1
a1 1
.\"	$OpenBSD: nmea.4,v 1.23 2010/04/21 23:43:39 sthen Exp $
d17 1
a17 1
.Dd $Mdocdate: April 21 2010 $
d31 1
a31 1
#include <sys/ttycom.h>
@


1.23
log
@Provide nmea(4) position information using the new angle sensor type.
Use SENSOR_FINVALID until we have good data, suggested by deraadt@@
"i am happy" deraadt@@
@
text
@d1 1
a1 1
.\"	$OpenBSD: nmea.4,v 1.22 2008/05/06 09:01:08 mbalmer Exp $
d17 1
a17 1
.Dd $Mdocdate: May 6 2008 $
d101 1
a101 1
.An Marc Balmer Aq mbalmer@@openbsd.org .
@


1.22
log
@Better formatting.
@
text
@d1 1
a1 1
.\"	$OpenBSD: nmea.4,v 1.21 2008/05/05 20:04:11 mbalmer Exp $
d17 1
a17 1
.Dd $Mdocdate: May 5 2008 $
d37 5
a41 4
maintains a timedelta sensor using the NMEA data.
The timedelta sensor will appear as nmea* in the list of sensors and the delta
(in nanoseconds) between the received time information and the local time can
be accessed through the
d51 1
a51 1
Only the time and date information is extracted.
d64 1
a64 1
The time information is valid.
@


1.21
log
@Document signal sensor.
@
text
@d1 1
a1 1
.\"	$OpenBSD: nmea.4,v 1.20 2008/01/06 09:53:17 mbalmer Exp $
d17 1
a17 1
.Dd $Mdocdate: January 6 2008 $
d61 1
a61 1
.Bl -tag -width "WARNXX"
d78 2
a79 1
A second sensor is used to report the status of the device itself:
@


1.20
log
@Don't reference {sl|nmea}attach(8) in the SEE ALSO section but ldattach(8)

Discussed with and ok jmc@@
@
text
@d1 1
a1 1
.\"	$OpenBSD: nmea.4,v 1.19 2007/11/27 15:22:49 jmc Exp $
d17 1
a17 1
.Dd $Mdocdate: November 27 2007 $
d76 8
@


1.19
log
@tweak previous;
@
text
@d1 1
a1 1
.\"	$OpenBSD: nmea.4,v 1.18 2007/11/26 23:05:28 mbalmer Exp $
d17 1
a17 1
.Dd $Mdocdate: November 26 2007 $
a79 1
.Xr nmeaattach 8 ,
@


1.18
log
@Document how the sensors degrade over time.
@
text
@d1 1
a1 1
.\"	$OpenBSD: nmea.4,v 1.17 2007/11/03 17:26:25 jmc Exp $
d17 1
a17 1
.Dd $Mdocdate: November 3 2007 $
d67 2
a68 2
The attached GPS receiver indicated a warning condition for at least the
last ten minutes.
@


1.17
log
@+.Xr ldattach 8 ,
@
text
@d1 1
a1 1
.\"	$OpenBSD: nmea.4,v 1.16 2007/05/31 19:19:51 jmc Exp $
d17 1
a17 1
.Dd $Mdocdate: May 31 2007 $
d67 2
a68 1
The attached GPS receiver indicates a warning condition.
d71 3
a73 1
tty timestamping has been turned on but there is no PPS signal present.
@


1.16
log
@convert to new .Dd format;
@
text
@d1 1
a1 1
.\"	$OpenBSD: nmea.4,v 1.15 2007/03/30 07:42:01 mbalmer Exp $
d17 1
a17 1
.Dd $Mdocdate$
d76 1
@


1.15
log
@Shorten the description and mention "timedelta sensor" in it, so users
can find all timedelta sensor related man pages (and thus a list of
supported devices) using 'man -k timedelta' or 'apropos timedelta'.

Discussed with jmc.
@
text
@d1 1
a1 1
.\"	$OpenBSD: nmea.4,v 1.14 2007/03/19 13:52:34 jmc Exp $
d17 1
a17 1
.Dd September 3, 2006
@


1.14
log
@tweak;
@
text
@d1 1
a1 1
.\"	$OpenBSD: nmea.4,v 1.13 2007/03/19 06:42:36 mbalmer Exp $
d22 1
a22 1
.Nd line discipline for NMEA 0183 devices
@


1.13
log
@Document recent changes, i.e. that the sensor status can be CRITICAL when
tty timestamping is enabled but there is no PPS signal present.
@
text
@d1 1
a1 1
.\"	$OpenBSD: nmea.4,v 1.12 2006/11/29 07:32:08 jmc Exp $
d71 1
a71 1
Check you hardware.
@


1.12
log
@tweaks;
@
text
@d1 1
a1 1
.\"	$OpenBSD: nmea.4,v 1.11 2006/11/29 00:08:34 mbalmer Exp $
d3 1
a3 1
.\" Copyright (c) 2006 Marc Balmer <mbalmer@@openbsd.org>
d56 2
a57 2
Otherwise the sensor timestamp is taken when the initial `$' character is
received from the NMEA device.
d69 4
@


1.11
log
@Document the changes I committed earlier:  If we use a device with PPS output,
the timestamp is copied from the tty timestamp (presuming tty timestamping has
been enabled) or taken when the initial '$' character is received otherwise.
@
text
@d1 1
a1 1
.\"	$OpenBSD: nmea.4,v 1.10 2006/10/07 06:53:28 mbalmer Exp $
d55 3
a57 3
is being used and tty timestamping has been turned on.  Otherwise the sensor
timestamp is taken when the initial '$' character is received from the NMEA
device.
@


1.10
log
@Mention nmeaattach(8) in the SEE ALSO section.
@
text
@d1 1
a1 1
.\"	$OpenBSD: nmea.4,v 1.9 2006/09/03 18:26:05 jmc Exp $
d54 4
a57 2
The sensor timestamp is taken when the initial '$' character is received
from the NMEA device.
@


1.9
log
@avoid suggesting may 42nd is a valid date;
from jasper lievisse adriaanse
@
text
@d1 1
a1 1
.\"	$OpenBSD: nmea.4,v 1.8 2006/06/14 09:45:02 mbalmer Exp $
d70 1
@


1.8
log
@GPRMC = Recommended Minimum Specific GPS/TRANSIT Data
@
text
@d1 1
a1 1
.\"	$OpenBSD: nmea.4,v 1.7 2006/06/14 08:03:08 mbalmer Exp $
d17 1
a17 1
.Dd May 42, 2006
@


1.7
log
@describe the NMEA 0183 line discipline with more details, explain the sensor
status and which NMEA messages are decoded.
help jmc@@
@
text
@d1 1
a1 1
.\"	$OpenBSD: nmea.4,v 1.6 2006/06/12 09:27:13 mbalmer Exp $
d49 1
a49 1
Recommended minimal navigation information C.
@


1.6
log
@While are nitpicking on this manpage: NMEA0183 -> NMEA 0183

discussed with Jason ManIntyre
@
text
@d1 1
a1 1
.\"	$OpenBSD: nmea.4,v 1.5 2006/06/12 09:23:25 mbalmer Exp $
d26 2
a27 1
This line discipline interfaces NMEA devices.
d38 30
d69 3
a71 1
.Xr tty 4
d75 1
a75 1
interface appeared in
@


1.5
log
@Even more to the point now.

discussed with jmc...
@
text
@d1 1
a1 1
.\"	$OpenBSD: nmea.4,v 1.4 2006/06/12 09:11:08 mbalmer Exp $
d22 1
a22 1
.Nd line discipline for NMEA0183 devices
@


1.4
log
@Remove redundant wording.
@
text
@d1 1
a1 1
.\"	$OpenBSD: nmea.4,v 1.3 2006/06/12 08:59:33 jmc Exp $
d35 2
a36 3
While applications can still use the device as if it had the
default (termios) line discipline attached, the line discipline
maintains a timedelta sensor in the kernel.
@


1.3
log
@tweak DESCRIPTION, with some help from mbalmer;
@
text
@d1 1
a1 1
.\"	$OpenBSD: nmea.4,v 1.2 2006/06/01 22:10:39 jmc Exp $
d26 1
a26 2
This line discipline interfaces NMEA devices
which are connected to a host through a serial line.
@


1.2
log
@tweaks;
@
text
@d1 1
a1 1
.\"	$OpenBSD: nmea.4,v 1.1 2006/06/01 20:10:28 mbalmer Exp $
d26 1
a26 1
This line discipline provides an interface to NMEA talking devices
@


1.1
log
@Add basic NMEA0183 support as a tty line discipline.  The line discipline
decodes NMEA messages completely transparent to userland applications, i.e.
userland can still use the NMEA stream and talk to the device.  If data
is received, a timedelta sensor suitable for ntpd is created.  The timestamp
is not very precise at the moment, use of this is experimental at best.

"get it in or we see how well the swiss people can swim" deraadt@@
@
text
@d1 1
a1 1
.\"	$OpenBSD$
d29 1
a29 1
The line discipline is enabled by a sequence:
d36 2
a37 2
While application program can still use the device as if it had the
default (termios) line discipline attached, the lince discipline
d49 1
a49 1
line discpiline was written by
@

