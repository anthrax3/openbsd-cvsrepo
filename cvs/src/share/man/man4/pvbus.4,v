head	1.14;
access;
symbols
	OPENBSD_6_2:1.14.0.4
	OPENBSD_6_2_BASE:1.14
	OPENBSD_6_1:1.12.0.4
	OPENBSD_6_1_BASE:1.12
	OPENBSD_6_0:1.7.0.6
	OPENBSD_6_0_BASE:1.7
	OPENBSD_5_9:1.7.0.2
	OPENBSD_5_9_BASE:1.7
	OPENBSD_5_8:1.2.0.4
	OPENBSD_5_8_BASE:1.2;
locks; strict;
comment	@.\" @;


1.14
date	2017.06.14.12.42.09;	author jmc;	state Exp;
branches;
next	1.13;
commitid	zQRfwyMATgfZW3lx;

1.13
date	2017.06.14.10.36.37;	author mikeb;	state Exp;
branches;
next	1.12;
commitid	ecikg6IZgA6r3eLq;

1.12
date	2016.12.07.17.11.09;	author jmc;	state Exp;
branches;
next	1.11;
commitid	Z6FNd4XxqCv7uVdt;

1.11
date	2016.12.07.15.53.05;	author mikeb;	state Exp;
branches;
next	1.10;
commitid	FHiT9MBfRplCtdCi;

1.10
date	2016.10.26.16.25.06;	author mikeb;	state Exp;
branches;
next	1.9;
commitid	y0aH9Eec3mcwzWSv;

1.9
date	2016.09.20.09.42.12;	author jmc;	state Exp;
branches;
next	1.8;
commitid	Y6d93JLeb2jBAOyr;

1.8
date	2016.09.15.16.01.20;	author mikeb;	state Exp;
branches;
next	1.7;
commitid	YTnDruu8lTa5A2AE;

1.7
date	2016.01.28.10.42.23;	author jmc;	state Exp;
branches;
next	1.6;
commitid	0bCOPesr8NP06kjF;

1.6
date	2016.01.28.09.18.54;	author reyk;	state Exp;
branches;
next	1.5;
commitid	rVfCji1SRh6o7lRq;

1.5
date	2016.01.07.11.15.16;	author mikeb;	state Exp;
branches;
next	1.4;
commitid	c8WOP8XqrQQsK2iP;

1.4
date	2015.12.09.08.46.27;	author reyk;	state Exp;
branches;
next	1.3;
commitid	FxzVFpfdKPPY4cDn;

1.3
date	2015.12.08.18.46.53;	author reyk;	state Exp;
branches;
next	1.2;
commitid	21nZs1L1ds0prK9l;

1.2
date	2015.07.21.07.01.21;	author schwarze;	state Exp;
branches;
next	1.1;
commitid	zCUceJAMVGCEMZoG;

1.1
date	2015.07.21.03.40.01;	author reyk;	state Exp;
branches;
next	;
commitid	8S5H6SJYe3buVqu1;


desc
@@


1.14
log
@match the (hvs) description to the man page; ok mikeb
@
text
@.\"	$OpenBSD: pvbus.4,v 1.13 2017/06/14 10:36:37 mikeb Exp $
.\"
.\" Copyright (c) 2015 Reyk Floeter <reyk@@openbsd.org>
.\" Copyright (c) 2006 Jason McIntyre <jmc@@openbsd.org>
.\"
.\" Permission to use, copy, modify, and distribute this software for any
.\" purpose with or without fee is hereby granted, provided that the above
.\" copyright notice and this permission notice appear in all copies.
.\"
.\" THE SOFTWARE IS PROVIDED "AS IS" AND THE AUTHOR DISCLAIMS ALL WARRANTIES
.\" WITH REGARD TO THIS SOFTWARE INCLUDING ALL IMPLIED WARRANTIES OF
.\" MERCHANTABILITY AND FITNESS. IN NO EVENT SHALL THE AUTHOR BE LIABLE FOR
.\" ANY SPECIAL, DIRECT, INDIRECT, OR CONSEQUENTIAL DAMAGES OR ANY DAMAGES
.\" WHATSOEVER RESULTING FROM LOSS OF USE, DATA OR PROFITS, WHETHER IN AN
.\" ACTION OF CONTRACT, NEGLIGENCE OR OTHER TORTIOUS ACTION, ARISING OUT OF
.\" OR IN CONNECTION WITH THE USE OR PERFORMANCE OF THIS SOFTWARE.
.\"
.Dd $Mdocdate: June 14 2017 $
.Dt PVBUS 4
.Os
.Sh NAME
.Nm pvbus
.Nd paravirtual device tree root
.Sh SYNOPSIS
.Cd "pvbus0 at mainbus0"
.Pp
.In sys/types.h
.In sys/ioctl.h
.In dev/pv/pvvar.h
.Sh DESCRIPTION
.Nm
is used on virtual machines that are running on hypervisors.
It provides a pseudo-bus for all paravirtual devices that do not
attach to a well-known bus like
.Xr pci 4 .
The
.Nm
driver is responsible for detecting the hypervisor interface,
checking the capabilities, attaching the paravirtual devices,
and providing access to supported information stores.
.Ss Supported hypervisors
.Bl -tag -width 13n -offset ind -compact
.It KVM
Kernel-based Virtual Machine
.It Hyper-V
Microsoft Hyper-V
.It OpenBSD
.Ox
.Xr vmm 4
.It VMware
VMware vSphere Hypervisor and ESXi
.It Xen
Xen VMM
.El
.Pp
Note that a hypervisor can attempt to emulate other hypervisors, so
multiple hypervisor interfaces may be available on the same host.
.Ss VMware paravirtual devices
.Bl -tag -width 13n -offset ind -compact
.It Xr vmt 4
VMware Tools driver and
.Dq guestinfo
information store
.El
.Ss Hyper-V paravirtual devices
.Bl -tag -width 13n -offset ind -compact
.It Xr hvn 4
Hyper-V virtual networking interface
.It Xr hvs 4
Hyper-V virtual disk
.It Xr hyperv 4
Hyper-V guest nexus device
.El
.Ss Xen paravirtual devices
.Bl -tag -width 13n -offset ind -compact
.It Xr xbf 4
Xen Blkfront virtual disk
.It Xr xen 4
Xen domU nexus device and XenStore information store
.It Xr xnf 4
Xen Netfront virtual networking interface
.El
.Sh IOCTL INTERFACE
.Nm
supports
.Xr ioctl 2
commands to exchange information with the hypervisor interface,
as implemented in the
.Xr hostctl 8
program.
Each detected hypervisor interface is available as a character special
device file,
.Pa /dev/pvbus0 ,
.Pa /dev/pvbus1 ,
etc.
All available commands use the same
.Fa pvbus_req
structure:
.Bd -literal
struct pvbus_req {
	size_t			 pvr_keylen;
	char			*pvr_key;
	size_t			 pvr_valuelen;
	char			*pvr_value;
};
.Ed
.Pp
The caller is responsible for attaching character buffers to the
.Fa pvr_key
and
.Fa pvr_value
fields and to set their length in
.Fa pvr_keylen
and
.Fa pvr_valuelen
accordingly.
All keys and values are nul-terminated strings.
.Pp
The following
.Xr ioctl 2
commands are available:
.Bl -tag -width PVBUSIOC_KVWRITE
.It Dv PVBUSIOC_KVREAD
Read the value from
.Fa pvr_key
and return it in
.Fa pvr_value .
.It Dv PVBUSIOC_KVTYPE
Return the type of the attached hypervisor interface as a string in
.Fa pvr_key ;
see
.Sx Supported hypervisors .
.It Dv PVBUSIOC_KVWRITE
Write the new value
.Fa pvr_value
to the key
.Fa pvr_key .
This command requires write permissions on the device file.
.El
.Sh FILES
.Bl -tag -width "/dev/pvbusX" -compact
.It /dev/pvbus Ns Ar u
.Nm
device unit
.Ar u
file.
.El
.Sh SEE ALSO
.Xr autoconf 4 ,
.Xr intro 4 ,
.Xr mainbus 4 ,
.Xr vmm 4 ,
.Xr hostctl 8
.Sh HISTORY
The
.Nm
pseudo-bus first appeared in
.Ox 5.8 .
.Sh AUTHORS
The
.Nm
pseudo-bus was written by
.An Reyk Floeter Aq Mt reyk@@openbsd.org .
@


1.13
log
@Mention hvs(4)
@
text
@d1 1
a1 1
.\"	$OpenBSD: pvbus.4,v 1.12 2016/12/07 17:11:09 jmc Exp $
d18 1
a18 1
.Dd $Mdocdate: December 7 2016 $
d70 1
a70 1
Hyper-V virtual disk interface
@


1.12
log
@tweak previous;
@
text
@d1 1
a1 1
.\"	$OpenBSD: pvbus.4,v 1.11 2016/12/07 15:53:05 mikeb Exp $
d69 2
@


1.11
log
@Add xbf(4)
@
text
@d1 1
a1 1
.\"	$OpenBSD: pvbus.4,v 1.10 2016/10/26 16:25:06 mikeb Exp $
d18 1
a18 1
.Dd $Mdocdate: October 26 2016 $
d74 2
a77 2
.It Xr xbf 4
Xen Blkfront virtual disk interface
@


1.10
log
@Section name references are case sensitive
@
text
@d1 1
a1 1
.\"	$OpenBSD: pvbus.4,v 1.9 2016/09/20 09:42:12 jmc Exp $
d18 1
a18 1
.Dd $Mdocdate: September 20 2016 $
d76 2
@


1.9
log
@sort;
@
text
@d1 1
a1 1
.\"	$OpenBSD: pvbus.4,v 1.8 2016/09/15 16:01:20 mikeb Exp $
d18 1
a18 1
.Dd $Mdocdate: September 15 2016 $
d128 1
a128 1
.Sx Supported Hypervisors .
@


1.8
log
@Add Hyper-V devices
@
text
@d1 1
a1 1
.\"	$OpenBSD: pvbus.4,v 1.7 2016/01/28 10:42:23 jmc Exp $
d18 1
a18 1
.Dd $Mdocdate: January 28 2016 $
d67 2
a70 2
.It Xr hvn 4
Hyper-V virtual networking interface
@


1.7
log
@avoid Xr to self;
@
text
@d1 1
a1 1
.\"	$OpenBSD: pvbus.4,v 1.6 2016/01/28 09:18:54 reyk Exp $
d64 7
@


1.6
log
@Document the pvbus(4) IOCTL INTERFACE.
@
text
@d1 1
a1 1
.\"	$OpenBSD: pvbus.4,v 1.5 2016/01/07 11:15:16 mikeb Exp $
d18 1
a18 1
.Dd $Mdocdate: January 7 2016 $
d132 1
a132 1
.Xr pvbus 4
@


1.5
log
@Xen Netfront man page
@
text
@d1 1
a1 1
.\"	$OpenBSD: pvbus.4,v 1.4 2015/12/09 08:46:27 reyk Exp $
d18 1
a18 1
.Dd $Mdocdate: December 9 2015 $
d26 4
d39 2
a40 1
checking the capabilities, and attaching the paravirtual devices.
d61 3
a63 1
VMware Tools driver
d68 1
a68 1
Xen domU nexus device
d72 65
d141 2
a142 1
.Xr vmm 4
@


1.4
log
@- pvbus on vmm(4) guests prints "OpenBSD", not vmm(4).
- Add xen(4) to the list.
@
text
@d1 1
a1 1
.\"	$OpenBSD: pvbus.4,v 1.3 2015/12/08 18:46:53 reyk Exp $
d18 1
a18 1
.Dd $Mdocdate: December 8 2015 $
d57 3
d62 2
@


1.3
log
@Add vmm(4) to the list.
@
text
@d1 1
a1 1
.\"	$OpenBSD: pvbus.4,v 1.2 2015/07/21 07:01:21 schwarze Exp $
d18 1
a18 1
.Dd $Mdocdate: July 21 2015 $
d42 1
a42 1
.It Xr vmm 4
d44 1
a44 2
virtual machine monitor
(VMM)
d57 2
@


1.2
log
@don't use .Xr for things that have no manual page
@
text
@d1 1
a1 1
.\"	$OpenBSD: pvbus.4,v 1.1 2015/07/21 03:40:01 reyk Exp $
d42 4
d62 2
a63 1
.Xr mainbus 4
@


1.1
log
@Add manpage for pvbus(4) and update vmt(4).

OK sf@@
@
text
@d1 1
a1 1
.\"	$OpenBSD$
d18 1
a18 1
.Dd $Mdocdate$
d38 1
a38 1
.It Xr KVM
d40 1
a40 1
.It Xr Hyper-V
d42 1
a42 1
.It Xr VMware
d44 1
a44 1
.It Xr Xen
@

