head	1.15;
access;
symbols
	OPENBSD_6_0:1.15.0.4
	OPENBSD_6_0_BASE:1.15
	OPENBSD_5_9:1.14.0.2
	OPENBSD_5_9_BASE:1.14
	OPENBSD_5_8:1.13.0.10
	OPENBSD_5_8_BASE:1.13
	OPENBSD_5_7:1.13.0.8
	OPENBSD_5_7_BASE:1.13
	OPENBSD_5_6:1.13.0.6
	OPENBSD_5_6_BASE:1.13
	OPENBSD_5_5:1.13.0.4
	OPENBSD_5_5_BASE:1.13
	OPENBSD_5_4:1.12.0.12
	OPENBSD_5_4_BASE:1.12
	OPENBSD_5_3:1.12.0.10
	OPENBSD_5_3_BASE:1.12
	OPENBSD_5_2:1.12.0.8
	OPENBSD_5_2_BASE:1.12
	OPENBSD_5_1_BASE:1.12
	OPENBSD_5_1:1.12.0.6
	OPENBSD_5_0:1.12.0.4
	OPENBSD_5_0_BASE:1.12
	OPENBSD_4_9:1.12.0.2
	OPENBSD_4_9_BASE:1.12
	OPENBSD_4_8:1.11.0.12
	OPENBSD_4_8_BASE:1.11
	OPENBSD_4_7:1.11.0.8
	OPENBSD_4_7_BASE:1.11
	OPENBSD_4_6:1.11.0.10
	OPENBSD_4_6_BASE:1.11
	OPENBSD_4_5:1.11.0.6
	OPENBSD_4_5_BASE:1.11
	OPENBSD_4_4:1.11.0.4
	OPENBSD_4_4_BASE:1.11
	OPENBSD_4_3:1.11.0.2
	OPENBSD_4_3_BASE:1.11
	OPENBSD_4_2:1.9.0.2
	OPENBSD_4_2_BASE:1.9
	OPENBSD_4_1:1.7.0.8
	OPENBSD_4_1_BASE:1.7
	OPENBSD_4_0:1.7.0.6
	OPENBSD_4_0_BASE:1.7
	OPENBSD_3_9:1.7.0.4
	OPENBSD_3_9_BASE:1.7
	OPENBSD_3_8:1.7.0.2
	OPENBSD_3_8_BASE:1.7
	OPENBSD_3_7:1.5.0.2
	OPENBSD_3_7_BASE:1.5;
locks; strict;
comment	@.\" @;


1.15
date	2016.02.27.20.57.32;	author natano;	state Exp;
branches;
next	1.14;
commitid	X5P6kChkxtz0ZRyu;

1.14
date	2015.11.01.21.26.48;	author jmc;	state Exp;
branches;
next	1.13;
commitid	WWHUg7NSwgnfw8Dy;

1.13
date	2014.01.21.03.15.46;	author schwarze;	state Exp;
branches;
next	1.12;

1.12
date	2010.09.19.12.32.10;	author jmc;	state Exp;
branches;
next	1.11;

1.11
date	2007.11.29.11.35.35;	author jmc;	state Exp;
branches;
next	1.10;

1.10
date	2007.11.28.13.12.29;	author tedu;	state Exp;
branches;
next	1.9;

1.9
date	2007.05.31.19.19.57;	author jmc;	state Exp;
branches;
next	1.8;

1.8
date	2007.03.19.20.57.18;	author jmc;	state Exp;
branches;
next	1.7;

1.7
date	2005.04.02.21.18.13;	author jmc;	state Exp;
branches;
next	1.6;

1.6
date	2005.04.02.17.55.37;	author uwe;	state Exp;
branches;
next	1.5;

1.5
date	2005.03.04.00.34.38;	author uwe;	state Exp;
branches;
next	1.4;

1.4
date	2005.03.03.22.54.59;	author uwe;	state Exp;
branches;
next	1.3;

1.3
date	2005.02.23.02.08.01;	author uwe;	state Exp;
branches;
next	1.2;

1.2
date	2005.02.22.13.34.42;	author jmc;	state Exp;
branches;
next	1.1;

1.1
date	2005.02.21.21.59.40;	author uwe;	state Exp;
branches;
next	;


desc
@@


1.15
log
@Add documentation for the APM_IOC_HIBERNATE ioctl.

tweaks and ok jmc@@
@
text
@.\"	$OpenBSD: apm.4,v 1.14 2015/11/01 21:26:48 jmc Exp $
.\"
.\"	Copyright (c) 1998 Marco S. Hyman
.\"
.\"	Permission to copy all or part of this material for any purpose is
.\"	granted provided that the above copyright notice and this paragraph
.\"	are duplicated in all copies.  THIS SOFTWARE IS PROVIDED ``AS IS''
.\"	AND WITHOUT ANY EXPRESS OR IMPLIED WARRANTIES, INCLUDING, WITHOUT
.\"	LIMITATION, THE IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS
.\"	FOR A PARTICULAR PURPOSE.
.\"
.Dd $Mdocdate: November 1 2015 $
.Dt APM 4 zaurus
.Os
.Sh NAME
.Nm apm
.Nd advanced power management device interface
.Sh SYNOPSIS
.Cd "apm0 at pxaip?"
.Sh DESCRIPTION
The
.Nm
driver provides an interface which simulates the Advanced Power Management
.Pq APM
BIOS functions.
The BIOS functions are translated into the appropriate Power Manager requests.
Currently only battery level, AC connection, and charging status is available
from the
.Nm
device, and no distinction is made between standby and suspend requests.
Other power events are
.Em NOT YET SUPPORTED .
.Pp
Configuration options:
.Pp
.Bl -tag -width DIAGNOSTIC -compact -offset indent
.It Dv APMDEBUG
Enable various driver status messages.
.It Dv DIAGNOSTIC
Enable debugging messages.
.It Dv DEBUG
Enable other debugging messages.
.El
.Pp
The
.Nm
driver implements the following
.Xr ioctl 2
calls.
They are defined in
.In machine/apmvar.h .
.Bl -tag -width Ds
.It Dv APM_IOC_REJECT
.Pq Li "struct apm_event_info"
.Em Not implemented .
.Em DO NOT USE .
.It Dv APM_IOC_STANDBY
.Pq Li "no parameters"
Request
.Dq standby
mode.
.It Dv APM_IOC_SUSPEND
.Pq Li "no parameters"
Request
.Dq suspend
mode.
.\" .It Dv APM_IOC_HIBERNATE
.\" .Em NOT YET SUPPORTED on zaurus
.\" .Pq Li "no parameters"
.\" Request
.\" .Dq hibernate
.\" mode.
.It Dv APM_IOC_GETPOWER
.Pq Li "struct apm_power_info"
Request the current power state.
The argument structure is as follows:
.Bd -literal -offset indent
struct apm_power_info {
	u_char battery_state;
	u_char ac_state;
	u_char battery_life;
	u_char spare1;
	u_int minutes_left;
	u_int spare2[6];
};
.Ed
.Pp
The following values are defined for
.Va battery_state :
.Bl -tag -width Ds
.It Dv APM_BATT_HIGH
Battery has a high state of charge.
.It Dv APM_BATT_LOW
Battery has a low state of charge.
.It Dv APM_BATT_CRITICAL
Battery has a critical state of charge.
.It Dv APM_BATT_CHARGING
Battery is not high, low, or critical and is currently charging.
.It Dv APM_BATT_UNKNOWN
Cannot read the current battery state.
.It Dv APM_BATTERY_ABSENT
No battery installed.
.El
.Pp
The following values are defined for
.Va ac_state :
.Bl -tag -width Ds
.It Dv APM_AC_OFF
External power not detected.
.It Dv APM_AC_ON
External power detected.
.It Dv APM_AC_BACKUP
Backup power in use.
.It Dv APM_AC_UNKNOWN
External power state unknown.
.El
.Pp
The
.Va battery_life
value contains the estimated percentage of battery life available.
100% indicates a full charge.
.Pp
The
.Va minutes_left
value contains the estimated number of minutes of battery life
remaining.
If no time estimate is available, the
.Va minutes_left
value is 0.
.It Dv APM_IOC_NEXTEVENT
.Em NOT YET SUPPORTED on zaurus
.Pq Li "struct apm_event_info"
The APM driver stores up to
.Dv APM_NEVENTS
events.
This was defined as 16 at the time this documentation was written.
If the event list is full when a new event is detected the new event is lost.
.Dv APM_IOC_NEXTEVENT
ioctl returns the next event on the list or
.Er EAGAIN
if the event list is empty.
The format of the returned event is:
.Bd -literal -offset indent
struct apm_event_info {
	u_int type;
	u_int index;
	u_int spare[8];
};
.Ed
where
.Va index
is a sequential count of events that can be used to check if any
events were lost and
.Va type
is one of:
.Pp
.Bl -tag -width Ds -offset indent -compact
.It Dv APM_STANDBY_REQ
.It Dv APM_SUSPEND_REQ
.It Dv APM_NORMAL_RESUME
.It Dv APM_CRIT_RESUME
.It Dv APM_BATTERY_LOW
.It Dv APM_POWER_CHANGE
.It Dv APM_UPDATE_TIME
.It Dv APM_CRIT_SUSPEND_REQ
.It Dv APM_USER_STANDBY_REQ
.It Dv APM_USER_SUSPEND_REQ
.It Dv APM_SYS_STANDBY_RESUME
.El
.It Dv APM_IOC_DEV_CTL
.Em NOT YET SUPPORTED on zaurus
.Pq Li "struct apm_ctl"
Allows an application to directly set the
APM operating mode.
The argument structure is as follows:
.Bd -literal -offset indent
struct apm_ctl {
	u_int dev;
	u_int mode;
};
.Ed
.Pp
.Va dev
indicates the device, typically
.Dv APM_DEV_ALLDEVS .
.Pp
.Va mode
indicates the desired operating mode.
Possible values are
.Bl -tag -width Ds -compact -offset indent
.It Dv APM_SYS_READY
.It Dv APM_SYS_STANDBY
.It Dv APM_SYS_SUSPEND
.It Dv APM_SYS_OFF
.It Dv APM_LASTREQ_INPROG
.It Dv APM_LASTREQ_REJECTED
.El
.It Dv APM_IOC_PRN_CTL
.Pq Li "int"
This
.Xr ioctl 2
controls message output by the APM
driver when a power change event is detected.
The integer parameter is one of:
.Bl -tag -width Ds
.It Dv APM_PRINT_ON
All power change events result in a message.
This is the normal operating mode for the driver.
.It Dv APM_PRINT_OFF
Power change event messages are suppressed.
.It Dv APM_PRINT_PCT
Power change event messages are suppressed unless the estimated
battery life percentage changes.
.El
.Pp
However, in no case will power status messages be displayed until the
battery life goes below the percentage in the
.Xr sysctl 8
state variable
.Dv machdep.apmwarn .
Setting
.Dv machdep.apmwarn
to zero disables all warnings regardless of the
.Dv APM_IOC_PRN_CTL
setting.
.El
.Sh FILES
.Bl -tag -width "/dev/apmctlXXX"
.It /dev/apm
Power management data device.
May only be opened read-only.
May be opened by multiple concurrent users.
.It /dev/apmctl
Power management control device.
May be opened read-write or write-only.
May only be opened by one user at a time.
An attempt to open the file when in use will fail, returning
.Er EBUSY .
.El
.Sh SEE ALSO
.Xr intro 4 ,
.Xr sysctl.conf 5 ,
.Xr apm 8 ,
.Xr apmd 8 ,
.Xr halt 8 ,
.Xr sysctl 8
.Sh BUGS
Power events are not supported.
.Pp
Reported battery life remaining and minutes left can be off by 25%
or more, and are generally overestimated while the battery is charging.
@


1.14
log
@replace "can not" with "cannot";
@
text
@d1 1
a1 1
.\"	$OpenBSD: apm.4,v 1.13 2014/01/21 03:15:46 schwarze Exp $
d12 1
a12 1
.Dd $Mdocdate: January 21 2014 $
d67 6
@


1.13
log
@obvious .Pa fixes; found with mandocdb(8)
@
text
@d1 1
a1 1
.\"	$OpenBSD: apm.4,v 1.12 2010/09/19 12:32:10 jmc Exp $
d12 1
a12 1
.Dd $Mdocdate: September 19 2010 $
d94 1
a94 1
Can not read the current battery state.
@


1.12
log
@- remove some silly .Tn/.Tm
- supply a missing -width to one of the lists
@
text
@d1 1
a1 1
.\"	$OpenBSD: apm.4,v 1.11 2007/11/29 11:35:35 jmc Exp $
d12 1
a12 1
.Dd $Mdocdate: November 29 2007 $
d51 1
a51 1
.Aq Pa machine/apmvar.h .
@


1.11
log
@- for acpi(4), document /dev/apm and /dev/apmctl
- for apm(4) pages, sync the description of these devices

ok tedu
@
text
@d1 1
a1 1
.\"	$OpenBSD: apm.4,v 1.10 2007/11/28 13:12:29 tedu Exp $
d12 1
a12 1
.Dd $Mdocdate: November 28 2007 $
d24 3
a26 6
.Pq Tn APM
.Tn BIOS
functions.
The
.Tn BIOS
functions are translated into the appropriate Power Manager requests.
d127 1
a127 3
The
.Tn APM
driver stores up to
d168 1
a168 2
.Tm APM
operating mode.
d184 1
a184 1
.Bl -tag -compact -offset indent
d196 1
a196 2
controls message output by the
.Tn APM
@


1.10
log
@history section is totally wrong
@
text
@d1 1
a1 1
.\"	$OpenBSD: apm.4,v 1.9 2007/05/31 19:19:57 jmc Exp $
d12 1
a12 1
.Dd $Mdocdate: May 31 2007 $
d229 3
a231 4
.Bl -tag -width /dev/apmctl
.It Pa /dev/apm
.Tn APM
data device.
d234 2
a235 3
.It Pa /dev/apmctl
.Tn APM
control device.
@


1.9
log
@convert to new .Dd format;
@
text
@d1 1
a1 1
.\"	$OpenBSD: apm.4,v 1.8 2007/03/19 20:57:18 jmc Exp $
d12 1
a12 1
.Dd $Mdocdate$
a249 13
.Sh HISTORY
The
.Nm
driver source code contains these copyrights:
.Pp
.Bl -item -compact
.It
.Li Copyright (c) 1995 John T. Kohl.  All rights reserved.
.It
.Li Copyright (C) 1994 by HOSOKAWA Tatsumi <hosokawa@@mt.cs.keio.ac.jp>
.El
.Pp
\&...and has been hacked on by many others since.
@


1.8
log
@new sentence, new line;
@
text
@d1 1
a1 1
.\"	$OpenBSD: apm.4,v 1.7 2005/04/02 21:18:13 jmc Exp $
d12 1
a12 1
.Dd February 21, 2005
@


1.7
log
@grammar;
@
text
@d1 1
a1 1
.\"	$OpenBSD: apm.4,v 1.6 2005/04/02 17:55:37 uwe Exp $
d58 2
a59 1
.Em Not implemented . DO NOT USE .
@


1.6
log
@battery_life is now valid even if battery_state is APM_BATT_CHARGING,
but the value is overestimated.  Replaces one documented bug with a
slightly smaller one. :)
@
text
@d1 1
a1 1
.\"	$OpenBSD: apm.4,v 1.5 2005/03/04 00:34:38 uwe Exp $
d265 1
a265 1
Reported battery life remaining and minutes left can be off by 25%,
@


1.5
log
@zaurus is unlikely to ever have a machdep.apmhalt sysctl, so zap that
paragraph from apm(4);  ok drahn@@
@
text
@d1 1
a1 1
.\"	$OpenBSD: apm.4,v 1.4 2005/03/03 22:54:59 uwe Exp $
d119 1
a119 8
If the battery is charging, i.e. when
.Va battery_state
is equal to
.Dv APM_BATT_CHARGING ,
the
.Va battery_life
value is invalid.
Otherwise, the
a125 3
(See also
.Sx BUGS ,
below.)
d265 2
a266 3
If the battery is charging, the battery life remaining is incorrectly
reported as 100% until charging is complete.
The estimated number of minutes left is constantly 0 minutes.
@


1.4
log
@Support APM_IOC_PRN_CTL, and machdep.apmwarn as documented in apm(4), and
apmd(8); missing sysctl variable noticed by drahn@@
@
text
@d1 1
a1 1
.\"	$OpenBSD: apm.4,v 1.3 2005/02/23 02:08:01 uwe Exp $
a236 27
.Pp
.Em NOT YET SUPPORTED on zaurus:
As noted above, the operation of the
.Tn APM
driver can be modified using the
.Dv machdep.apmwarn
.Xr sysctl 8
variable.
Another driver modifier is the
.Dv machdep.apmhalt
variable.
When
.Dv machdep.apmhalt
is set to 1 the
.Tn APM
power down code is modified in a way necessary for correct operation on
some systems, mainly
.Tn IBM
laptops.
If your system does not power down when given the command
.Li "halt -p"
try setting
.Dv machdep.apmhalt
to 1 using
.Xr sysctl 8 .
The variable can be set at boot time in
.Xr sysctl.conf 5 .
@


1.3
log
@Make no distinction between standby and suspend requests for now.
@
text
@d1 1
a1 1
.\"	$OpenBSD: apm.4,v 1.2 2005/02/22 13:34:42 jmc Exp $
a207 1
.Em NOT YET SUPPORTED on zaurus
@


1.2
log
@reference to adb(4) does not make sense here;
@
text
@d1 1
a1 1
.\"	$OpenBSD: apm.4,v 1.1 2005/02/21 21:59:40 uwe Exp $
d33 2
a34 4
device.
Suspend mode is
.Ud .
Standby and other power events are
a59 1
.Em NOT YET SUPPORTED on zaurus
d301 1
a301 1
Standby mode and power events are not supported.
@


1.1
log
@Add new apm(4) man page for zaurus based on macppc, and add zaurus to
MANSUBDIR for apm(8).
ok deraadt@@
@
text
@d1 1
a1 1
.\"	$OpenBSD: apm.4,v 1.7 2004/12/03 15:25:21 jsg Exp $
a283 1
.Xr adb 4 ,
@

