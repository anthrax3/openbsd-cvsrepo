head	1.8;
access;
symbols
	OPENBSD_6_1:1.8.0.20
	OPENBSD_6_1_BASE:1.8
	OPENBSD_6_0:1.8.0.18
	OPENBSD_6_0_BASE:1.8
	OPENBSD_5_9:1.8.0.14
	OPENBSD_5_9_BASE:1.8
	OPENBSD_5_8:1.8.0.16
	OPENBSD_5_8_BASE:1.8
	OPENBSD_5_7:1.8.0.8
	OPENBSD_5_7_BASE:1.8
	OPENBSD_5_6:1.8.0.12
	OPENBSD_5_6_BASE:1.8
	OPENBSD_5_5:1.8.0.10
	OPENBSD_5_5_BASE:1.8
	OPENBSD_5_4:1.8.0.6
	OPENBSD_5_4_BASE:1.8
	OPENBSD_5_3:1.8.0.4
	OPENBSD_5_3_BASE:1.8
	OPENBSD_5_2:1.8.0.2
	OPENBSD_5_2_BASE:1.8
	OPENBSD_5_1_BASE:1.7
	OPENBSD_5_1:1.7.0.4
	OPENBSD_5_0:1.7.0.2
	OPENBSD_5_0_BASE:1.7
	OPENBSD_4_9:1.6.0.2
	OPENBSD_4_9_BASE:1.6
	OPENBSD_4_8:1.5.0.6
	OPENBSD_4_8_BASE:1.5
	OPENBSD_4_7:1.5.0.2
	OPENBSD_4_7_BASE:1.5
	OPENBSD_4_6:1.5.0.4
	OPENBSD_4_6_BASE:1.5
	OPENBSD_4_5:1.4.0.6
	OPENBSD_4_5_BASE:1.4
	OPENBSD_4_4:1.4.0.4
	OPENBSD_4_4_BASE:1.4
	OPENBSD_4_3:1.4.0.2
	OPENBSD_4_3_BASE:1.4
	OPENBSD_4_2:1.3.0.2
	OPENBSD_4_2_BASE:1.3
	OPENBSD_4_1:1.1.0.14
	OPENBSD_4_1_BASE:1.1
	OPENBSD_4_0:1.1.0.12
	OPENBSD_4_0_BASE:1.1
	OPENBSD_3_9:1.1.0.10
	OPENBSD_3_9_BASE:1.1
	OPENBSD_3_8:1.1.0.8
	OPENBSD_3_8_BASE:1.1
	OPENBSD_3_7:1.1.0.6
	OPENBSD_3_7_BASE:1.1
	OPENBSD_3_6:1.1.0.4
	OPENBSD_3_6_BASE:1.1
	OPENBSD_3_5:1.1.0.2
	OPENBSD_3_5_BASE:1.1;
locks; strict;
comment	@.\" @;


1.8
date	2012.07.08.21.48.38;	author schwarze;	state Exp;
branches;
next	1.7;

1.7
date	2011.04.18.23.58.45;	author schwarze;	state Exp;
branches;
next	1.6;

1.6
date	2010.09.25.19.39.23;	author jmc;	state Exp;
branches;
next	1.5;

1.5
date	2009.05.18.19.37.47;	author schwarze;	state Exp;
branches;
next	1.4;

1.4
date	2007.09.06.07.01.34;	author jmc;	state Exp;
branches;
next	1.3;

1.3
date	2007.05.31.19.19.58;	author jmc;	state Exp;
branches;
next	1.2;

1.2
date	2007.03.20.21.14.58;	author jmc;	state Exp;
branches;
next	1.1;

1.1
date	2003.09.25.09.19.11;	author jmc;	state Exp;
branches;
next	;


desc
@@


1.8
log
@To detect changes of system files, use SHA-256 rather than MD5,
taking advantage of naddy@@'s recent mtree(8) modernization.
While here, do not provide an example protecting a home directory
from file changes; protect some system binaries instead.
ok naddy@@ jmc@@
@
text
@.\"	$OpenBSD: changelist.5,v 1.7 2011/04/18 23:58:45 schwarze Exp $
.\"
.\" Copyright (c) 2003 Jason McIntyre <jmc@@openbsd.org>
.\"
.\" Permission to use, copy, modify, and distribute this software for any
.\" purpose with or without fee is hereby granted, provided that the above
.\" copyright notice and this permission notice appear in all copies.
.\"
.\" THE SOFTWARE IS PROVIDED "AS IS" AND THE AUTHOR DISCLAIMS ALL WARRANTIES
.\" WITH REGARD TO THIS SOFTWARE INCLUDING ALL IMPLIED WARRANTIES OF
.\" MERCHANTABILITY AND FITNESS. IN NO EVENT SHALL THE AUTHOR BE LIABLE FOR
.\" ANY SPECIAL, DIRECT, INDIRECT, OR CONSEQUENTIAL DAMAGES OR ANY DAMAGES
.\" WHATSOEVER RESULTING FROM LOSS OF USE, DATA OR PROFITS, WHETHER IN AN
.\" ACTION OF CONTRACT, NEGLIGENCE OR OTHER TORTIOUS ACTION, ARISING OUT OF
.\" OR IN CONNECTION WITH THE USE OR PERFORMANCE OF THIS SOFTWARE.
.\"
.Dd $Mdocdate: April 18 2011 $
.Dt CHANGELIST 5
.Os
.Sh NAME
.Nm changelist
.Nd list of backup files
.Sh SYNOPSIS
.Nm /etc/changelist
.Sh DESCRIPTION
The
.Pa /etc/changelist
file is a simple text file containing the names of files to be backed up
and checked for modification by the system security script,
.Xr security 8 .
It is checked daily by the
.Pa /etc/daily
script.
See
.Xr daily 8
for further details.
.Pp
Each line of the file contains the name of a file,
specified by its absolute pathname,
one per line.
By default, configuration files in
.Pa /etc ,
.Pa /root ,
and
.Pa /var
are added during system install.
Administrators may add additional files at their discretion.
Shell globbing is supported in pathnames.
.Pp
Backup files are held in the directory
.Pa /var/backups .
A backup of the current version of a file is kept in this directory, marked
.Qq current .
When the file is altered, the old version is marked as
.Qq backup
and the new version becomes
.Qq current .
.Pp
For example,
the system shell database,
.Pa /etc/shells ,
is held as
.Pa /var/backups/etc_shells.current .
When this file is modified, it is renamed to
.Pa /var/backups/etc_shells.backup
and the new version becomes
.Pa /var/backups/etc_shells.current .
Thereafter, these files are rotated.
.Pp
Diffs are mailed to the root administrator, in unified
.Xr diff 1
format, via
.Xr daily 8 ,
in the following format:
.Bd -unfilled -offset indent
=====
/etc/shells diffs (-OLD  +NEW)
=====
.Ed
.Pp
Files in
.Pa /etc/changelist
beginning with a
.Sq +
character
.Pq generally non-text files
are stored as
.Xr sha256 1
checksums.
Results are mailed in the following format:
.Bd -unfilled -offset indent
======
/etc/ssh/ssh_host_key SHA-256 checksums
======
OLD:
NEW:
.Ed
.Pp
Lines beginning with the comment character
.Pq Sq # ,
blank lines,
and non-existent files are all silently ignored.
.\" .Sh ENVIRONMENT
.Sh FILES
.Bl -tag -width /etc/changelist -compact
.It Pa /etc/changelist
Default changelist.
.It Pa /etc/daily
Maintenance script which runs
.Xr security 8 .
.It Pa /var/backups/
Directory containing file backups.
.El
.Sh SEE ALSO
.Xr diff 1 ,
.Xr sha256 1 ,
.Xr daily 8 ,
.Xr security 8
.Sh HISTORY
The
.Nm
manual page first appeared in
.Ox 3.5 .
.Sh CAVEATS
Anyone with the privileges to alter system configuration files
could also alter the backup files in
.Pa /var/backups .
It is important that this directory be owned by root:wheel
and have permissions 0700 set.
.Pp
Removal of the
.Pa /etc/changelist
file itself could cause confusion.
.Pp
.Nm
cannot warn about files being added to the system, although
.Xr security 8
will pick up on any files listed in
.Pa /etc/changelist
being added or deleted.
Removals are only noticed for files listed explicitly,
but not for files matched by globbing.
.Pp
If you hose your system configuration files,
you just might be able to find the information you need in
.Pa /var/backups .
This is not a CAVEAT, but we had to let you know somehow!
@


1.7
log
@Adjust after removal of /etc/security to /usr/libexec.
More HISTORY.
Using feedback from jmc@@.
"I think that is correct.
 If it isn't, someone out there will eventually moan :)" deraadt@@
@
text
@d1 1
a1 1
.\"	$OpenBSD: changelist.5,v 1.6 2010/09/25 19:39:23 jmc Exp $
d17 1
a17 1
.Dd $Mdocdate: September 25 2010 $
d88 1
a88 1
.Xr md5 1
d93 1
a93 1
/etc/ssh/ssh_host_key MD5 checksums
d116 1
a116 1
.Xr md5 1 ,
@


1.6
log
@missing "Pa" in FILES;
@
text
@d1 1
a1 1
.\"	$OpenBSD: changelist.5,v 1.5 2009/05/18 19:37:47 schwarze Exp $
d17 1
a17 1
.Dd $Mdocdate: May 18 2009 $
a110 3
.It Pa /etc/security
Shell script which reads
.Pa /etc/changelist .
@


1.5
log
@support shell globs on ^+ lines in changelist(5)
based on a patch from John Wong, johnw at wonghome dot net, tweaked by me
while here, document globbing for normal lines, too
"i like that" okan@@;  feedback and ok jmc@@
@
text
@d1 1
a1 1
.\"	$OpenBSD: changelist.5,v 1.4 2007/09/06 07:01:34 jmc Exp $
d17 1
a17 1
.Dd $Mdocdate: September 6 2007 $
d114 1
a114 1
.It /var/backups/
@


1.4
log
@correct error in diff output; from Thoren McDole
@
text
@d1 1
a1 1
.\"	$OpenBSD: changelist.5,v 1.3 2007/05/31 19:19:58 jmc Exp $
d17 1
a17 1
.Dd $Mdocdate$
d48 1
d144 2
@


1.3
log
@convert to new .Dd format;
@
text
@d1 1
a1 1
.\"	$OpenBSD: changelist.5,v 1.2 2007/03/20 21:14:58 jmc Exp $
d76 1
a76 1
/etc/shells diffs (-OLD  -NEW)
@


1.2
log
@some updates/improvements for BUGS;
@
text
@d1 1
a1 1
.\"	$OpenBSD: changelist.5,v 1.1 2003/09/25 09:19:11 jmc Exp $
d17 1
a17 1
.Dd September 11, 2003
@


1.1
log
@man page for /etc/changelist format;
ok deraadt@@
@
text
@d1 1
a1 1
.\"	$OpenBSD$
d138 5
a142 1
cannot warn about files being added to the system.
d147 1
a147 1
This is not a CAVEAT, but we had to warn you somehow!
@

