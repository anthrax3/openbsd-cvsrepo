head	1.19;
access;
symbols
	OPENBSD_6_2_BASE:1.19
	OPENBSD_6_1:1.19.0.8
	OPENBSD_6_1_BASE:1.19
	OPENBSD_6_0:1.19.0.4
	OPENBSD_6_0_BASE:1.19
	OPENBSD_5_9:1.19.0.2
	OPENBSD_5_9_BASE:1.19
	OPENBSD_5_8:1.18.0.10
	OPENBSD_5_8_BASE:1.18
	OPENBSD_5_7:1.18.0.2
	OPENBSD_5_7_BASE:1.18
	OPENBSD_5_6:1.18.0.6
	OPENBSD_5_6_BASE:1.18
	OPENBSD_5_5:1.18.0.4
	OPENBSD_5_5_BASE:1.18
	OPENBSD_5_4:1.16.0.6
	OPENBSD_5_4_BASE:1.16
	OPENBSD_5_3:1.16.0.4
	OPENBSD_5_3_BASE:1.16
	OPENBSD_5_2:1.16.0.2
	OPENBSD_5_2_BASE:1.16
	OPENBSD_5_1_BASE:1.15
	OPENBSD_5_1:1.15.0.4
	OPENBSD_5_0:1.15.0.2
	OPENBSD_5_0_BASE:1.15
	OPENBSD_4_9:1.14.0.2
	OPENBSD_4_9_BASE:1.14
	OPENBSD_4_8:1.13.0.14
	OPENBSD_4_8_BASE:1.13
	OPENBSD_4_7:1.13.0.10
	OPENBSD_4_7_BASE:1.13
	OPENBSD_4_6:1.13.0.12
	OPENBSD_4_6_BASE:1.13
	OPENBSD_4_5:1.13.0.8
	OPENBSD_4_5_BASE:1.13
	OPENBSD_4_4:1.13.0.6
	OPENBSD_4_4_BASE:1.13
	OPENBSD_4_3:1.13.0.4
	OPENBSD_4_3_BASE:1.13
	OPENBSD_4_2:1.13.0.2
	OPENBSD_4_2_BASE:1.13
	OPENBSD_4_1:1.12.0.8
	OPENBSD_4_1_BASE:1.12
	OPENBSD_4_0:1.12.0.6
	OPENBSD_4_0_BASE:1.12
	OPENBSD_3_9:1.12.0.4
	OPENBSD_3_9_BASE:1.12
	OPENBSD_3_8:1.12.0.2
	OPENBSD_3_8_BASE:1.12
	OPENBSD_3_7:1.10.0.8
	OPENBSD_3_7_BASE:1.10
	OPENBSD_3_6:1.10.0.6
	OPENBSD_3_6_BASE:1.10
	OPENBSD_3_5:1.10.0.4
	OPENBSD_3_5_BASE:1.10
	OPENBSD_3_4:1.10.0.2
	OPENBSD_3_4_BASE:1.10
	OPENBSD_3_3:1.8.0.12
	OPENBSD_3_3_BASE:1.8
	OPENBSD_3_2:1.8.0.10
	OPENBSD_3_2_BASE:1.8
	OPENBSD_3_1:1.8.0.8
	OPENBSD_3_1_BASE:1.8
	OPENBSD_3_0:1.8.0.6
	OPENBSD_3_0_BASE:1.8
	OPENBSD_2_9:1.8.0.4
	OPENBSD_2_9_BASE:1.8
	OPENBSD_2_8:1.8.0.2
	OPENBSD_2_8_BASE:1.8
	OPENBSD_2_7:1.7.0.4
	OPENBSD_2_7_BASE:1.7
	OPENBSD_2_6:1.7.0.2
	OPENBSD_2_6_BASE:1.7
	OPENBSD_2_5:1.5.0.2
	OPENBSD_2_5_BASE:1.5
	OPENBSD_2_4:1.3.0.2
	OPENBSD_2_4_BASE:1.3
	OPENBSD_2_3:1.2.0.4
	OPENBSD_2_3_BASE:1.2
	OPENBSD_2_2:1.2.0.2
	OPENBSD_2_2_BASE:1.2
	OPENBSD_2_1:1.1.1.1.0.4
	OPENBSD_2_1_BASE:1.1.1.1
	OPENBSD_2_0:1.1.1.1.0.2
	OPENBSD_2_0_BASE:1.1.1.1
	netbsd_1_1:1.1.1.1;
locks; strict;
comment	@.\" @;


1.19
date	2015.09.10.17.55.21;	author schwarze;	state Exp;
branches;
next	1.18;
commitid	PeV7Ql0T6htfMjhP;

1.18
date	2014.01.21.03.15.46;	author schwarze;	state Exp;
branches;
next	1.17;

1.17
date	2013.10.07.01.50.26;	author guenther;	state Exp;
branches;
next	1.16;

1.16
date	2012.04.13.08.20.15;	author matthew;	state Exp;
branches;
next	1.15;

1.15
date	2011.07.14.02.16.00;	author deraadt;	state Exp;
branches;
next	1.14;

1.14
date	2010.10.28.15.02.41;	author millert;	state Exp;
branches;
next	1.13;

1.13
date	2007.05.31.19.19.58;	author jmc;	state Exp;
branches;
next	1.12;

1.12
date	2005.06.18.18.09.42;	author millert;	state Exp;
branches;
next	1.11;

1.11
date	2005.06.15.17.51.35;	author millert;	state Exp;
branches;
next	1.10;

1.10
date	2003.07.04.23.06.01;	author millert;	state Exp;
branches;
next	1.9;

1.9
date	2003.06.02.23.30.14;	author millert;	state Exp;
branches;
next	1.8;

1.8
date	2000.10.26.00.37.04;	author aaron;	state Exp;
branches;
next	1.7;

1.7
date	99.07.09.13.35.38;	author aaron;	state Exp;
branches;
next	1.6;

1.6
date	99.05.23.14.11.04;	author aaron;	state Exp;
branches;
next	1.5;

1.5
date	98.11.29.15.47.23;	author aaron;	state Exp;
branches;
next	1.4;

1.4
date	98.11.26.04.25.58;	author aaron;	state Exp;
branches;
next	1.3;

1.3
date	98.09.07.16.44.36;	author aaron;	state Exp;
branches;
next	1.2;

1.2
date	97.07.17.07.59.04;	author deraadt;	state Exp;
branches;
next	1.1;

1.1
date	95.10.18.08.44.37;	author deraadt;	state Exp;
branches
	1.1.1.1;
next	;

1.1.1.1
date	95.10.18.08.44.37;	author deraadt;	state Exp;
branches;
next	;


desc
@@


1.19
log
@use .In rather than .Fd #include
@
text
@.\"	$OpenBSD: dir.5,v 1.18 2014/01/21 03:15:46 schwarze Exp $
.\"
.\" Copyright (c) 1983, 1991, 1993
.\"	The Regents of the University of California.  All rights reserved.
.\"
.\" Redistribution and use in source and binary forms, with or without
.\" modification, are permitted provided that the following conditions
.\" are met:
.\" 1. Redistributions of source code must retain the above copyright
.\"    notice, this list of conditions and the following disclaimer.
.\" 2. Redistributions in binary form must reproduce the above copyright
.\"    notice, this list of conditions and the following disclaimer in the
.\"    documentation and/or other materials provided with the distribution.
.\" 3. Neither the name of the University nor the names of its contributors
.\"    may be used to endorse or promote products derived from this software
.\"    without specific prior written permission.
.\"
.\" THIS SOFTWARE IS PROVIDED BY THE REGENTS AND CONTRIBUTORS ``AS IS'' AND
.\" ANY EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT LIMITED TO, THE
.\" IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE
.\" ARE DISCLAIMED.  IN NO EVENT SHALL THE REGENTS OR CONTRIBUTORS BE LIABLE
.\" FOR ANY DIRECT, INDIRECT, INCIDENTAL, SPECIAL, EXEMPLARY, OR CONSEQUENTIAL
.\" DAMAGES (INCLUDING, BUT NOT LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS
.\" OR SERVICES; LOSS OF USE, DATA, OR PROFITS; OR BUSINESS INTERRUPTION)
.\" HOWEVER CAUSED AND ON ANY THEORY OF LIABILITY, WHETHER IN CONTRACT, STRICT
.\" LIABILITY, OR TORT (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY
.\" OUT OF THE USE OF THIS SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF
.\" SUCH DAMAGE.
.\"
.\"     @@(#)dir.5	8.4 (Berkeley) 5/3/95
.\"
.Dd $Mdocdate: January 21 2014 $
.Dt DIR 5
.Os
.Sh NAME
.Nm dir ,
.Nm dirent
.Nd directory file format
.Sh SYNOPSIS
.In dirent.h
.Sh DESCRIPTION
Directories provide a convenient hierarchical method of grouping
files while obscuring the underlying details of the storage medium.
A directory file is differentiated from a plain file by a flag in its
.Xr inode 5
entry.
It consists of records (directory entries) each of which contains
information about a file and a pointer to the file itself.
Directory entries may contain other directories as well as plain files;
such nested directories are referred to as subdirectories.
A hierarchy of directories and files is formed in this manner
and is called a file system (or referred to as a file system tree).
.\" An entry in this tree,
.\" nested or not nested,
.\" is a pathname.
.Pp
Each directory file contains two special directory entries; one is a pointer
to the directory itself called dot
.Pq Dq \&.
and the other a pointer to its parent directory called dot-dot
.Pq Dq \&.. .
Dot and dot-dot are valid pathnames, however, the system root directory
.Pq Dq / ,
has no parent and dot-dot points to itself like dot.
.Pp
File system nodes are ordinary directory files on which has
been grafted a file system object, such as a physical disk or a
partitioned area of such a disk (see
.Xr mount 8 ) .
.Pp
The directory entry format is defined in the file
.In dirent.h :
.Bd -literal
/*
 * A directory entry has a struct dirent at the front of it, containing
 * its inode number, the length of the entry, and the length of the name
 * contained in the entry.  These are followed by the name padded to some
 * alignment (currently 8 bytes) with NUL bytes.  All names are guaranteed
 * NUL terminated.  The maximum length of a name in a directory is MAXNAMLEN.
 */

struct dirent {
	ino_t		d_fileno;	/* file number of entry */
	off_t		d_off;		/* offset of next entry */
	u_int16_t	d_reclen;	/* length of this record */
	u_int8_t	d_type;		/* file type, see below */
	u_int8_t	d_namlen;	/* length of string in d_name */
#define MAXNAMLEN       255
	char    d_name[MAXNAMLEN + 1];  /* maximum name length */
};

#define	d_ino		d_fileno	/* backward compatibility */

/*
 * File types
 */
#define DT_UNKNOWN	0
#define DT_FIFO		1
#define DT_CHR		2
#define DT_DIR		4
#define DT_BLK		6
#define DT_REG		8
#define DT_LNK		10
#define DT_SOCK		12
.Ed
.Sh SEE ALSO
.Xr getdents 2 ,
.Xr fs 5 ,
.Xr inode 5
.Sh HISTORY
A
.Nm dir
file format appeared in
.At v7 .
The
.Fa d_off
member was added in
.Ox 5.5 .
@


1.18
log
@obvious .Pa fixes; found with mandocdb(8)
@
text
@d1 1
a1 1
.\"	$OpenBSD: dir.5,v 1.17 2013/10/07 01:50:26 guenther Exp $
d32 1
a32 1
.Dd $Mdocdate: October 7 2013 $
d40 1
a40 1
.Fd #include <dirent.h>
@


1.17
log
@getdirentries(2) is dead; long live getdents(2)!

confirmation that getdirentries(2) is unused by ports from sthen@@ and naddy@@
@
text
@d1 1
a1 1
.\"	$OpenBSD: dir.5,v 1.16 2012/04/13 08:20:15 matthew Exp $
d32 1
a32 1
.Dd $Mdocdate: April 13 2012 $
d72 1
a72 1
.Aq Pa dirent.h :
@


1.16
log
@Remove 'struct _dirdesc' description and dirfd() macro defintion from
dir(5) now that the former is an opaque type within libc and the
latter is a proper function.

Pointed out by millert; ok jmc, guenther
@
text
@d1 1
a1 1
.\"	$OpenBSD: dir.5,v 1.15 2011/07/14 02:16:00 deraadt Exp $
d32 1
a32 1
.Dd $Mdocdate: July 14 2011 $
a39 1
.Fd #include <sys/types.h>
d77 3
a79 3
 * contained in the entry.  These are followed by the name padded to a 4
 * byte boundary with null bytes.  All names are guaranteed NUL terminated.
 * The maximum length of a name in a directory is MAXNAMLEN.
d83 2
a84 1
	u_int32_t	d_fileno;	/* file number of entry */
a104 6

/*
 * Convert between stat structure types and directory types.
 */
#define IFTODT(mode)	(((mode) & 0170000) >> 12)
#define DTTOIF(dirtype)	((dirtype) << 12)
d107 1
a107 1
.Xr getdirentries 2 ,
d115 4
@


1.15
log
@__opendir2, DTF_NODUP, and __DTF_READALL can die.  struct dirent
dd_flags is renamed to the placeholder position dd_unused so that
we can spot "broken software" which assumes we have Jan Simon Pendry's
union mounts (we don't have them, and won't have them ever again).
__opendir2 question spotted by matthew
verified to not break ports by sthen
@
text
@d1 1
a1 1
.\"	$OpenBSD: dir.5,v 1.14 2010/10/28 15:02:41 millert Exp $
d32 1
a32 1
.Dd $Mdocdate: October 28 2010 $
d92 2
a110 27

#ifdef _POSIX_SOURCE
typedef void *	DIR;
#else

#define	d_ino		d_fileno	/* backward compatibility */

/* definitions for library routines operating on directories. */
#define	DIRBLKSIZ	1024

/* structure describing an open directory. */
typedef struct _dirdesc {
	int	dd_fd;     /* file descriptor associated with directory */
	long	dd_loc;	   /* offset in current buffer */
	long	dd_size;   /* amount of data returned by getdirentries */
	char	*dd_buf;   /* data buffer */
	int	dd_len;    /* size of data buffer */
	off_t	dd_seek;   /* magic cookie returned by getdirentries */
	off_t	dd_rewind; /* magic cookie for rewinding */
	int	dd_unused; /* was flags for readdir */
	struct _telldir *dd_td; /* telldir position recording */
	void	*dd_lock;  /* mutex to protect struct */
} DIR;

#define	dirfd(dirp)	((dirp)->dd_fd)

#endif /* _POSIX_SOURCE */
@


1.14
log
@Change basep parameter of getdirentries() to be off_t *, not long *
so it works correctly with large offsets (and matches other systems).
This requires adding a new getdirentries syscall, with the old one
renamed to ogetdirentries.  All in-tree consumers of getdirentries()
have been updated.  Bump libc and libpthread major numbers.
OK and with deraadt@@
@
text
@d1 1
a1 1
.\"	$OpenBSD: dir.5,v 1.13 2007/05/31 19:19:58 jmc Exp $
d32 1
a32 1
.Dd $Mdocdate$
d128 3
a130 1
	int	dd_flags;  /* flags for readdir */
a133 4

/* flags for opendir2 */
#define DTF_NODUP	0x0002	/* don't return duplicate names */
#define __DTF_READALL	0x0008	/* everything has been read */
@


1.13
log
@convert to new .Dd format;
@
text
@d1 1
a1 1
.\"	$OpenBSD: dir.5,v 1.12 2005/06/18 18:09:42 millert Exp $
d126 2
a127 2
	long	dd_seek;   /* magic cookie returned by getdirentries */
	long	dd_rewind; /* magic cookie for rewinding */
@


1.12
log
@Remove remaining whiteout tentacles; OK deraadt@@ miod@@ weingart@@
@
text
@d1 1
a1 1
.\"	$OpenBSD: dir.5,v 1.11 2005/06/15 17:51:35 millert Exp $
d32 1
a32 1
.Dd May 3, 1995
@


1.11
log
@don't document whiteout/unionfs stuff
@
text
@d1 1
a1 1
.\"	$OpenBSD: dir.5,v 1.10 2003/07/04 23:06:01 millert Exp $
a102 1
#define DT_WHT		14
@


1.10
log
@Update based on reality; this should probably be renamed dirent.5
jmc@@ OK
@
text
@d1 1
a1 1
.\"	$OpenBSD: dir.5,v 1.9 2003/06/02 23:30:14 millert Exp $
a134 1
#define DTF_HIDEW	0x0001	/* hide whiteout entries */
a135 1
#define DTF_REWIND	0x0004	/* rewind after reading union stack */
@


1.9
log
@Remove the advertising clause in the UCB license which Berkeley
rescinded 22 July 1999.  Proofed by myself and Theo.
@
text
@d1 1
a1 2
.\"	$OpenBSD: dir.5,v 1.8 2000/10/26 00:37:04 aaron Exp $
.\"	$NetBSD: dir.5,v 1.5 1995/03/28 17:30:20 jtc Exp $
d30 1
a30 1
.\"     @@(#)dir.5	8.3 (Berkeley) 4/19/94
d32 1
a32 1
.Dd April 19, 1994
d41 1
a41 1
.Fd #include <sys/dir.h>
a74 3
#ifndef _DIRENT_H_
#define _DIRENT_H_

d76 6
a81 6
* A directory entry has a struct dirent at the front of it, containing its
* inode number, the length of the entry, and the length of the name
* contained in the entry.  These are followed by the name padded to a 4
* byte boundary with null bytes.  All names are guaranteed null terminated.
* The maximum length of a name in a directory is MAXNAMLEN.
*/
d84 4
a87 6
	u_long	d_fileno;	/* file number of entry */
	u_short	d_reclen;	/* length of this record */
	u_short	d_namlen;	/* length of string in d_name */
#ifdef _POSIX_SOURCE
	char	d_name[MAXNAMLEN + 1];	/* maximum name length */
#else
d90 14
a103 1
#endif
d105 5
a109 1
};
d122 8
a129 6
	int	dd_fd;    /* file descriptor associated with directory */
	long	dd_loc;	  /* offset in current buffer */
	long	dd_size;  /* amount of data returned by getdirentries */
	char	*dd_buf;  /* data buffer */
	int	dd_len;   /* size of data buffer */
	long	dd_seek;  /* magic cookie returned by getdirentries */
d134 5
a138 3
#ifndef NULL
#define	NULL	0
#endif
a140 8

#ifndef _KERNEL

#include <sys/cdefs.h>

#endif /* !_KERNEL */

#endif /* !_DIRENT_H_ */
d143 1
@


1.8
log
@Some share/man fleshing.
@
text
@d1 1
a1 1
.\"	$OpenBSD: dir.5,v 1.7 1999/07/09 13:35:38 aaron Exp $
d15 1
a15 5
.\" 3. All advertising materials mentioning features or use of this software
.\"    must display the following acknowledgement:
.\"	This product includes software developed by the University of
.\"	California, Berkeley and its contributors.
.\" 4. Neither the name of the University nor the names of its contributors
@


1.7
log
@- remove all trailing whitespace
     * except when it is escaped with a `\' at the end of the line
- fix remaining .Nm usage as well
- this is from a patch I received from kwesterback@@home.com, who has been
  working on some scripts for fixing formatting errors in mdoc'd man pages

Ok, so there could be a cost/benefit debate with this commit, but since I have
the patch we might as well commit it...
@
text
@d1 1
a1 1
.\"	$OpenBSD: dir.5,v 1.6 1999/05/23 14:11:04 aaron Exp $
d41 2
a42 1
.Nm dir , dirent
d50 1
a50 2
A directory file is differentiated from a plain file
by a flag in its
d55 2
a56 3
Directory entries may contain other directories
as well as plain files; such nested directories are referred to as
subdirectories.
d64 1
a64 2
to the directory itself
called dot
d68 1
a68 3
Dot and dot-dot
are valid pathnames, however,
the system root directory
d144 1
a144 1
.Nm
@


1.6
log
@remove argument from .Os macros so value in /usr/share/tmac/mdoc/doc-common
is used instead; kwesterback@@home.com
@
text
@d1 1
a1 1
.\"	$OpenBSD: dir.5,v 1.5 1998/11/29 15:47:23 aaron Exp $
d57 1
a57 1
subdirectories. 
@


1.5
log
@kill superfluous .Nm macro arguments
@
text
@d1 1
a1 1
.\"	$OpenBSD: dir.5,v 1.4 1998/11/26 04:25:58 aaron Exp $
d39 1
a39 1
.Os BSD 4.2
@


1.4
log
@share/man/man5/ man page repairs
@
text
@d1 1
a1 1
.\"	$OpenBSD$
d41 1
a41 2
.Nm dir ,
.Nm dirent
@


1.3
log
@More man page fixes. Particularly fix uses of it's/its, affect/effect,
then/than and such. Other miscellaneous problems fixed across these source
files.
@
text
@d1 1
d68 1
a68 1
.Ql \&.
d70 1
a70 1
.Ql \&.. .
d74 1
a74 1
.Ql / ,
d79 2
a80 3
partitioned area of such a disk.
(See
.Xr mount 8 . )
d83 1
a83 1
.Aq dirent.h :
@


1.2
log
@fix Xr
@
text
@d56 1
a56 1
as well as plain files; such nested directories are refered to as
@


1.1
log
@Initial revision
@
text
@a79 2
.Xr mount 1
and
@


1.1.1.1
log
@initial import of NetBSD tree
@
text
@@
