head	1.24;
access;
symbols
	OPENBSD_6_1_BASE:1.24
	OPENBSD_6_0:1.24.0.4
	OPENBSD_6_0_BASE:1.24
	OPENBSD_5_9:1.24.0.2
	OPENBSD_5_9_BASE:1.24
	OPENBSD_5_8:1.21.0.10
	OPENBSD_5_8_BASE:1.21
	OPENBSD_5_7:1.21.0.2
	OPENBSD_5_7_BASE:1.21
	OPENBSD_5_6:1.21.0.6
	OPENBSD_5_6_BASE:1.21
	OPENBSD_5_5:1.21.0.4
	OPENBSD_5_5_BASE:1.21
	OPENBSD_5_4:1.19.0.2
	OPENBSD_5_4_BASE:1.19
	OPENBSD_5_3:1.18.0.6
	OPENBSD_5_3_BASE:1.18
	OPENBSD_5_2:1.18.0.4
	OPENBSD_5_2_BASE:1.18
	OPENBSD_5_1_BASE:1.18
	OPENBSD_5_1:1.18.0.2
	OPENBSD_5_0:1.17.0.14
	OPENBSD_5_0_BASE:1.17
	OPENBSD_4_9:1.17.0.12
	OPENBSD_4_9_BASE:1.17
	OPENBSD_4_8:1.17.0.10
	OPENBSD_4_8_BASE:1.17
	OPENBSD_4_7:1.17.0.6
	OPENBSD_4_7_BASE:1.17
	OPENBSD_4_6:1.17.0.8
	OPENBSD_4_6_BASE:1.17
	OPENBSD_4_5:1.17.0.4
	OPENBSD_4_5_BASE:1.17
	OPENBSD_4_4:1.17.0.2
	OPENBSD_4_4_BASE:1.17
	OPENBSD_4_3:1.16.0.4
	OPENBSD_4_3_BASE:1.16
	OPENBSD_4_2:1.16.0.2
	OPENBSD_4_2_BASE:1.16
	OPENBSD_4_1:1.13.0.2
	OPENBSD_4_1_BASE:1.13
	OPENBSD_4_0:1.12.0.10
	OPENBSD_4_0_BASE:1.12
	OPENBSD_3_9:1.12.0.8
	OPENBSD_3_9_BASE:1.12
	OPENBSD_3_8:1.12.0.6
	OPENBSD_3_8_BASE:1.12
	OPENBSD_3_7:1.12.0.4
	OPENBSD_3_7_BASE:1.12
	OPENBSD_3_6:1.12.0.2
	OPENBSD_3_6_BASE:1.12
	OPENBSD_3_5:1.11.0.2
	OPENBSD_3_5_BASE:1.11
	OPENBSD_3_4:1.10.0.2
	OPENBSD_3_4_BASE:1.10
	OPENBSD_3_3:1.7.0.2
	OPENBSD_3_3_BASE:1.7
	OPENBSD_3_2:1.6.0.6
	OPENBSD_3_2_BASE:1.6
	OPENBSD_3_1:1.6.0.4
	OPENBSD_3_1_BASE:1.6
	OPENBSD_3_0:1.6.0.2
	OPENBSD_3_0_BASE:1.6
	OPENBSD_2_9:1.5.0.4
	OPENBSD_2_9_BASE:1.5
	OPENBSD_2_8:1.5.0.2
	OPENBSD_2_8_BASE:1.5
	OPENBSD_2_7:1.4.0.2
	OPENBSD_2_7_BASE:1.4
	OPENBSD_2_6:1.3.0.2
	OPENBSD_2_6_BASE:1.3;
locks; strict;
comment	@.\" @;


1.24
date	2015.11.07.03.48.25;	author mmcc;	state Exp;
branches;
next	1.23;
commitid	nUSBkK2cdKwlaPeD;

1.23
date	2015.11.02.04.49.28;	author mmcc;	state Exp;
branches;
next	1.22;
commitid	TAzZF3AwmuOih0kP;

1.22
date	2015.09.14.15.14.55;	author schwarze;	state Exp;
branches;
next	1.21;
commitid	TPchOLbdlEugnrt2;

1.21
date	2013.12.29.18.46.09;	author jmc;	state Exp;
branches;
next	1.20;

1.20
date	2013.12.29.03.15.03;	author guenther;	state Exp;
branches;
next	1.19;

1.19
date	2013.06.04.19.27.11;	author schwarze;	state Exp;
branches;
next	1.18;

1.18
date	2011.09.19.10.25.37;	author miod;	state Exp;
branches;
next	1.17;

1.17
date	2008.06.26.05.42.08;	author ray;	state Exp;
branches;
next	1.16;

1.16
date	2007.06.01.21.10.18;	author moritz;	state Exp;
branches;
next	1.15;

1.15
date	2007.05.31.19.20.00;	author jmc;	state Exp;
branches;
next	1.14;

1.14
date	2007.04.03.06.37.37;	author jasper;	state Exp;
branches;
next	1.13;

1.13
date	2007.01.26.00.20.47;	author jason;	state Exp;
branches;
next	1.12;

1.12
date	2004.04.16.21.23.08;	author jmc;	state Exp;
branches;
next	1.11;

1.11
date	2003.12.21.15.30.20;	author miod;	state Exp;
branches;
next	1.10;

1.10
date	2003.06.13.01.14.54;	author tedu;	state Exp;
branches;
next	1.9;

1.9
date	2003.06.11.18.07.23;	author tedu;	state Exp;
branches;
next	1.8;

1.8
date	2003.06.11.17.28.51;	author tedu;	state Exp;
branches;
next	1.7;

1.7
date	2003.03.06.04.03.40;	author david;	state Exp;
branches;
next	1.6;

1.6
date	2001.07.31.19.55.44;	author deraadt;	state Exp;
branches;
next	1.5;

1.5
date	2000.10.12.18.06.02;	author aaron;	state Exp;
branches;
next	1.4;

1.4
date	2000.04.26.21.28.00;	author mickey;	state Exp;
branches;
next	1.3;

1.3
date	99.09.22.09.54.38;	author espie;	state Exp;
branches;
next	1.2;

1.2
date	99.09.22.03.16.47;	author csapuntz;	state Exp;
branches;
next	1.1;

1.1
date	99.09.05.16.23.11;	author espie;	state Exp;
branches;
next	;


desc
@@


1.24
log
@Simplify and clarify.

Discussed with jca@@
@
text
@.\"	$OpenBSD: printf.9,v 1.23 2015/11/02 04:49:28 mmcc Exp $
.\"     $NetBSD: kprintf.9,v 1.6 1999/03/16 00:40:47 garbled Exp $
.\"
.\" Copyright (c) 1998 The NetBSD Foundation, Inc.
.\" All rights reserved.
.\"
.\" This code is derived from software contributed to The NetBSD Foundation
.\" by Jeremy Cooper.
.\"
.\" Redistribution and use in source and binary forms, with or without
.\" modification, are permitted provided that the following conditions
.\" are met:
.\" 1. Redistributions of source code must retain the above copyright
.\"    notice, this list of conditions and the following disclaimer.
.\" 2. Redistributions in binary form must reproduce the above copyright
.\"    notice, this list of conditions and the following disclaimer in the
.\"    documentation and/or other materials provided with the distribution.
.\"
.\" THIS SOFTWARE IS PROVIDED BY THE NETBSD FOUNDATION, INC. AND CONTRIBUTORS
.\" ``AS IS'' AND ANY EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT LIMITED
.\" TO, THE IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR
.\" PURPOSE ARE DISCLAIMED.  IN NO EVENT SHALL THE FOUNDATION OR CONTRIBUTORS
.\" BE LIABLE FOR ANY DIRECT, INDIRECT, INCIDENTAL, SPECIAL, EXEMPLARY, OR
.\" CONSEQUENTIAL DAMAGES (INCLUDING, BUT NOT LIMITED TO, PROCUREMENT OF
.\" SUBSTITUTE GOODS OR SERVICES; LOSS OF USE, DATA, OR PROFITS; OR BUSINESS
.\" INTERRUPTION) HOWEVER CAUSED AND ON ANY THEORY OF LIABILITY, WHETHER IN
.\" CONTRACT, STRICT LIABILITY, OR TORT (INCLUDING NEGLIGENCE OR OTHERWISE)
.\" ARISING IN ANY WAY OUT OF THE USE OF THIS SOFTWARE, EVEN IF ADVISED OF THE
.\" POSSIBILITY OF SUCH DAMAGE.
.\"
.Dd $Mdocdate: November 2 2015 $
.Dt PRINTF 9
.Os
.Sh NAME
.Nm printf ,
.Nm snprintf ,
.Nm vprintf ,
.Nm vsnprintf ,
.Nm uprintf ,
.Nm ttyprintf ,
.Nm db_printf ,
.Nm db_vprintf
.Nd kernel formatted output conversion
.Sh SYNOPSIS
.In sys/types.h
.In sys/systm.h
.Ft int
.Fo printf
.Fa "const char *format"
.Fa "..."
.Fc
.Ft int
.Fo snprintf
.Fa "char *buf"
.Fa "size_t size"
.Fa "const char *format"
.Fa "..."
.Fc
.Ft int
.Fo vprintf
.Fa "const char *format"
.Fa "va_list ap"
.Fc
.Ft int
.Fo vsnprintf
.Fa "char *buf"
.Fa "size_t size"
.Fa "const char *fmt"
.Fa "va_list ap"
.Fc
.Ft void
.Fo uprintf
.Fa "const char *format"
.Fa "..."
.Fc
.Ft void
.Fo ttyprintf
.Fa "struct tty *tty"
.Fa "const char *format"
.Fa "..."
.Fc
.In ddb/db_output.h
.Ft void
.Fn db_printf "const char *format" ...
.Ft void
.Fn db_vprintf "const char *format" "va_list ap"
.Sh DESCRIPTION
The
.Fn printf ,
.Fn snprintf ,
.Fn vprintf ,
.Fn vsnprintf ,
.Fn uprintf ,
.Fn ttyprintf ,
.Fn db_printf ,
and
.Fn db_vprintf
functions allow the kernel to send formatted messages to various output
devices.
The functions
.Fn printf
and
.Fn vprintf
send formatted strings to the system console and to the system log.
The functions
.Fn uprintf
and
.Fn ttyprintf
send formatted strings to the current process's controlling tty and a specific
tty,
respectively.
The functions
.Fn db_printf
and
.Fn db_vprintf
send formatted strings to the ddb console, and are only used to implement
.Xr ddb 4 .
.Pp
Since each of these kernel functions is a variant of its user space
counterpart, this page describes only the differences between the user
space and kernel versions.
Refer to
.Xr printf 3
for functional details.
.Ss FORMAT OPTIONS
The kernel functions don't support as many formatting specifiers as their
user space counterparts.
In addition to the floating point formatting specifiers,
the following integer type specifiers are not supported:
.Bl -tag -width 5n
.It Li %hh
Argument of
.Li char
type.
This format specifier is accepted by the kernel but will be handled as
.Li %h .
.It Li %j
Argument of
.Li intmax_t
or
.Li uintmax_t
type.
.It Li %t
Argument of
.Li ptrdiff_t
type.
.El
.Pp
The kernel functions support some additional formatting specifiers:
.Bl -tag -width 5n
.It Li %b
Bit field expansion.
This format specifier is useful for decoding bit fields in device registers.
It displays an integer using a specified radix
.Pq base
and an interpretation of
the bits within that integer as though they were flags.
It requires two arguments from the argument vector, the first argument being
the bit field to be decoded
(of type
.Li int ,
unless a width modifier has been specified)
and the second being a decoding directive string.
.Pp
The decoding directive string describes how the bitfield is to be interpreted
and displayed.
The first character of the string is a binary character representation of the
output numeral base in which the bitfield will be printed before it is decoded.
Recognized radix values
.Pq "in C escape-character format"
are
.Li \e10
.Pq octal ,
.Li \e12
.Pq decimal ,
and
.Li \e20
.Pq hexadecimal .
.Pp
The remaining characters in the decoding directive string are interpreted as a
list of bit-position\(endescription pairs.
A bit-position\(endescription pair begins with a binary character value
that represents the position of the bit being described.
A bit position value of one describes the least significant bit.
Whereas a position value of 32
.Pq "octal 40, hexadecimal 20, the ASCII space character"
describes the most significant bit.
.Pp
To deal with more than 32 bits, the characters 128
.Pq "octal 200, hexadecimal 80"
through 255
.Pq "octal 377, hexadecimal FF"
are used.
The value 127 is subtracted from the character to determine the
bit position (1 is least significant, and 128 is most significant).
.Pp
The remaining characters in a bit-position\(endescription pair are the
characters to print should the bit being described be set.
Description strings are delimited by the next bit position value character
encountered
.Po
distinguishable by its value being \*(Le 32 or \*(Ge 128
.Pc ,
or the end of the decoding directive string itself.
.El
.Sh RETURN VALUES
The
.Fn printf
and
.Fn vprintf
functions return the number of characters printed.
.Pp
The
.Fn snprintf
and
.Fn vsnprintf
functions return the number of characters that would have been put into
the buffer
.Fa buf
if the
.Fa size
were unlimited.
.Sh EXAMPLES
Use of the
.Li %b
format specifier for decoding device registers.
.Bd -literal -offset indent
printf("reg=%b\en", 3, "\e10\e2BITTWO\e1BITONE")
\(rA "reg=3<BITTWO,BITONE>"

printf("enablereg=%b\en", 0xe860,
       "\e20\ex10NOTBOOT\ex0fFPP\ex0eSDVMA\ex0cVIDEO"
       "\ex0bLORES\ex0aFPA\ex09DIAG\ex07CACHE"
       "\ex06IOCACHE\ex05LOOPBACK\ex04DBGCACHE")
\(rA "enablereg=e860<NOTBOOT,FPP,SDVMA,VIDEO,CACHE,IOCACHE>"
.Ed
.Sh CODE REFERENCES
.Pa sys/kern/subr_prf.c
.Sh SEE ALSO
.Xr revoke 2 ,
.Xr printf 3 ,
.Xr ddb 4 ,
.Xr log 9
@


1.23
log
@Remove space before colon.
@
text
@d1 1
a1 1
.\"	$OpenBSD: printf.9,v 1.22 2015/09/14 15:14:55 schwarze Exp $
d31 1
a31 1
.Dd $Mdocdate: September 14 2015 $
d129 1
a129 3
the following integer type specifiers are not supported in the format string
.Fa format
either:
d149 1
a149 3
The kernel functions also accept the following format specifiers
in the format string
.Fa format :
@


1.22
log
@Remove useless quoting from .Fo and .Fn function names, to prevent
development of a cargo cult in case people look at existing files
for examples.  This achieves a consistent .Fo and .Fn quoting style
across the whole tree.
@
text
@d1 1
a1 1
.\"	$OpenBSD: printf.9,v 1.21 2013/12/29 18:46:09 jmc Exp $
d31 1
a31 1
.Dd $Mdocdate: December 29 2013 $
d131 1
a131 1
either :
@


1.21
log
@grammar fix previous;
@
text
@d1 1
a1 1
.\"	$OpenBSD: printf.9,v 1.20 2013/12/29 03:15:03 guenther Exp $
d48 1
a48 1
.Fo "printf"
d53 1
a53 1
.Fo "snprintf"
d60 1
a60 1
.Fo "vprintf"
d65 1
a65 1
.Fo "vsnprintf"
d72 1
a72 1
.Fo "uprintf"
d77 1
a77 1
.Fo "ttyprintf"
@


1.20
log
@Add db_vprintf() and indicate that db_v?printf() are in <ddb/db_output.h>
@
text
@d1 1
a1 1
.\"	$OpenBSD: printf.9,v 1.19 2013/06/04 19:27:11 schwarze Exp $
d31 1
a31 1
.Dd $Mdocdate: June 4 2013 $
d116 1
a116 1
sends formatted strings to the ddb console, and are only used to implement
@


1.19
log
@Replace old-fashioned .Fd by new-fangled .In for #include lines.
Diff from Jan Klemkow <j dot klemkow at wemelug dot de> on tech@@.
No objection from jmc@@ against this type of change.
@
text
@d1 1
a1 1
.\"	$OpenBSD: printf.9,v 1.18 2011/09/19 10:25:37 miod Exp $
d31 1
a31 1
.Dd $Mdocdate: September 19 2011 $
d41 2
a42 1
.Nm db_printf
d82 1
d85 2
d95 1
d97 1
a97 1
.Fn db_printf
d112 1
a112 1
The function
d114 3
a116 1
sends formatted strings to the ddb console, and is only used to implement
@


1.18
log
@Sync with reality: remove %r and %z which have been removed quite some time
ago, and mention %hh, %j and %t are not supported.
@
text
@d1 1
a1 1
.\"	$OpenBSD: printf.9,v 1.17 2008/06/26 05:42:08 ray Exp $
d31 1
a31 1
.Dd $Mdocdate: June 26 2008 $
d44 2
a45 2
.Fd #include <sys/types.h>
.Fd #include <sys/systm.h>
@


1.17
log
@First pass at removing clauses 3 and 4 from NetBSD licenses.

Not sure what's more surprising: how long it took for NetBSD to
catch up to the rest of the BSDs (including UCB), or the amount of
code that NetBSD has claimed for itself without attributing to the
actual authors.

OK deraadt@@
@
text
@d1 1
a1 1
.\"	$OpenBSD: printf.9,v 1.16 2007/06/01 21:10:18 moritz Exp $
d31 1
a31 1
.Dd $Mdocdate: June 1 2007 $
d119 26
a144 4
The kernel functions don't support any floating point formatting
specifiers.
In addition to other formatting specifiers common with the user
space functions, the kernel functions accept the following format specifiers
d147 1
a147 1
.Bl -tag -width "\e177"
d157 3
a159 1
.Pq "as an integer"
a201 12
.It Li %r
Displays an integer using the current
.Tn DDB
radix.
This non-standard interpretation of
.Li %r
is only available to
.Fn db_printf .
.It Li %z
Displays a signed integer using the C-style hexadecimal constant format.
This format specifier is only available to
.Fn db_printf .
@


1.16
log
@Sync return value section with reality.

ok jmc@@, "love it" deraadt@@
@
text
@d1 1
a1 1
.\"	$OpenBSD: printf.9,v 1.15 2007/05/31 19:20:00 jmc Exp $
a17 7
.\" 3. All advertising materials mentioning features or use of this software
.\"    must display the following acknowledgement:
.\"        This product includes software developed by the NetBSD
.\"        Foundation, Inc. and its contributors.
.\" 4. Neither the name of The NetBSD Foundation nor the names of its
.\"    contributors may be used to endorse or promote products derived
.\"    from this software without specific prior written permission.
d31 1
a31 1
.Dd $Mdocdate: May 31 2007 $
@


1.15
log
@convert to new .Dd format;
@
text
@d1 1
a1 1
.\"	$OpenBSD: printf.9,v 1.14 2007/04/03 06:37:37 jasper Exp $
d38 1
a38 1
.Dd $Mdocdate$
d200 7
a206 3
.Fn printf ,
.Fn snprintf ,
.Fn vprintf ,
d209 6
a214 2
functions return the number of characters they placed in the buffer
.Fa buf .
@


1.14
log
@put "CODE REFERENCES" before "SEE ALSO" for consistency

ok jmc@@
@
text
@d1 1
a1 1
.\"	$OpenBSD: printf.9,v 1.13 2007/01/26 00:20:47 jason Exp $
d38 1
a38 1
.Dd September 1, 1998
@


1.13
log
@printf(9) %b is not limited to 32 bits or less... document it.
@
text
@d1 1
a1 1
.\"	$OpenBSD: printf.9,v 1.12 2004/04/16 21:23:08 jmc Exp $
d221 2
a227 2
.Sh CODE REFERENCES
.Pa sys/kern/subr_prf.c
@


1.12
log
@list/display fixes, and whitespace;
@
text
@d1 1
a1 1
.\"	$OpenBSD: printf.9,v 1.11 2003/12/21 15:30:20 miod Exp $
d169 8
d181 3
a183 1
.Pq "distinguishable by its value being \(<= 32" ,
a227 5
.Sh LIMITATIONS
The
.Li %b
format specifier cannot be used to decode integers greater than 32 bits in
size.
@


1.11
log
@Kill non-standard kernel printf %: braindead extension for good.
ok markus@@ drahn@@
@
text
@d1 1
a1 1
.\"	$OpenBSD: printf.9,v 1.10 2003/06/13 01:14:54 tedu Exp $
a131 1
.Pp
@


1.10
log
@printf returns int now.  also remove obsolete comment
@
text
@d1 1
a1 1
.\"	$OpenBSD: printf.9,v 1.9 2003/06/11 18:07:23 tedu Exp $
a175 7
.It Li %:
Inline format continuation.
This format specifier allows for recursive formatted output.
Its argument is the new formatting string to obey and the argument which
follows it is a
.Va va_list
argument vector from which to obtain the data to be formatted.
a210 17
.Ed
.Pp
Use of the
.Li %:
format specifier for recursive formatting.
.Bd -literal -offset indent
void
bail(char *fmt, ...)
{
        va_list ap;
        va_start (ap, fmt);
        printf("bailing out: %:\en", fmt, ap);
        va_end(ap);
}

bail("descriptor %d is invalid.", 5)
\(rA "bailing out: descriptor 5 is invalid"
@


1.9
log
@add vsnprintf.  ok deraadt@@
@
text
@d1 1
a1 1
.\"	$OpenBSD: printf.9,v 1.8 2003/06/11 17:28:51 tedu Exp $
d53 1
a53 1
.Ft void
d65 1
a65 1
.Ft void
d198 3
a200 1
.Fn snprintf
a236 2
.\" The following page has not been written, but I am including a cross-
.\" reference to it in the hopes that it will inspire someone to write it.
@


1.8
log
@no more strcpy, strcat.  sprintf -> snprintf.  ok deraadt@@
@
text
@d1 1
a1 1
.\"	$OpenBSD: printf.9,v 1.7 2003/03/06 04:03:40 david Exp $
d45 1
a59 1
.Fa "size_t len"
d61 1
d70 7
d95 1
d199 3
a201 1
function returns the number of characters it placed in the buffer
@


1.7
log
@date should be written formally: .Dd Month day, year
also fixes a few misspellings of the month
ok henning@@ jmc@@
@
text
@d1 1
a1 1
.\"	$OpenBSD: printf.9,v 1.6 2001/07/31 19:55:44 deraadt Exp $
d43 1
a43 1
.Nm sprintf ,
d58 2
a59 1
.Fo "sprintf"
d85 1
a85 1
.Fn sprintf ,
d189 1
a189 1
.Fn sprintf
@


1.6
log
@there is no tprintf
@
text
@d1 1
a1 1
.\"	$OpenBSD: printf.9,v 1.5 2000/10/12 18:06:02 aaron Exp $
d38 1
a38 1
.Dd Sep 1, 1998
@


1.5
log
@General man page cleanups, mostly to remove trailing whitespace, hard
sentence breaks, and other such things.
@
text
@d1 1
a1 1
.\"	$OpenBSD: printf.9,v 1.4 2000/04/26 21:28:00 mickey Exp $
d228 1
a228 2
.Xr log 9 ,
.Xr tprintf 9
@


1.4
log
@rcsids where missing
@
text
@d1 1
a1 1
.\"	$OpenBSD$
d29 1
a29 1
.\" PURPOSE ARE DISCLAIMED.  IN NO EVENT SHALL THE FOUNDATION OR CONTRIBUTORS 
d42 5
a46 5
.Nm printf , 
.Nm sprintf , 
.Nm vprintf, 
.Nm uprintf, 
.Nm ttyprintf, 
d88 1
a88 1
and 
d110 3
a112 3
counterpart,
this page describes only the differences between the user space and kernel
versions. Refer to
d117 2
a118 1
specifiers.  In addition to other formatting specifiers common with the user 
d131 1
a131 1
It requires two arguments from the argument vector, the first argument being 
d177 1
a177 1
This non-standard interpretation of 
@


1.3
log
@REVERT TO PREVIOUS STATE OF AFFAIR.

If those pages are different from the NetBSD version, maybe there's a
reason ?

Like, possibly, I just read our source code, which just happens to do
things in DIFFERENT ways than NetBSD does ?

As far as the added pages go, they obviously haven't been checked against
actual code as well, hence they're worse than useless, since a large part
of the information is definitely misleading.
@
text
@d1 1
@


1.2
log
@

Add/update some man9 pages from NetBSD
@
text
@a0 1
.\"     $OpenBSD: kprintf.9,v 1.6 1999/03/16 00:40:47 garbled Exp $
@


1.1
log
@New man pages, adapted from NetBSD.
Add corresponding cross-references.
Missed some uses of .Dv.
@
text
@d1 1
@

