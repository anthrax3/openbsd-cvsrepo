head	1.17;
access;
symbols
	OPENBSD_6_1:1.17.0.4
	OPENBSD_6_1_BASE:1.17
	OPENBSD_6_0:1.16.0.4
	OPENBSD_6_0_BASE:1.16
	OPENBSD_5_9:1.16.0.2
	OPENBSD_5_9_BASE:1.16
	OPENBSD_5_8:1.15.0.10
	OPENBSD_5_8_BASE:1.15
	OPENBSD_5_7:1.15.0.2
	OPENBSD_5_7_BASE:1.15
	OPENBSD_5_6:1.15.0.6
	OPENBSD_5_6_BASE:1.15
	OPENBSD_5_5:1.15.0.4
	OPENBSD_5_5_BASE:1.15
	OPENBSD_5_4:1.14.0.2
	OPENBSD_5_4_BASE:1.14
	OPENBSD_5_3:1.10.0.20
	OPENBSD_5_3_BASE:1.10
	OPENBSD_5_2:1.10.0.18
	OPENBSD_5_2_BASE:1.10
	OPENBSD_5_1_BASE:1.10
	OPENBSD_5_1:1.10.0.16
	OPENBSD_5_0:1.10.0.14
	OPENBSD_5_0_BASE:1.10
	OPENBSD_4_9:1.10.0.12
	OPENBSD_4_9_BASE:1.10
	OPENBSD_4_8:1.10.0.10
	OPENBSD_4_8_BASE:1.10
	OPENBSD_4_7:1.10.0.6
	OPENBSD_4_7_BASE:1.10
	OPENBSD_4_6:1.10.0.8
	OPENBSD_4_6_BASE:1.10
	OPENBSD_4_5:1.10.0.4
	OPENBSD_4_5_BASE:1.10
	OPENBSD_4_4:1.10.0.2
	OPENBSD_4_4_BASE:1.10
	OPENBSD_4_3:1.9.0.4
	OPENBSD_4_3_BASE:1.9
	OPENBSD_4_2:1.9.0.2
	OPENBSD_4_2_BASE:1.9
	OPENBSD_4_1:1.8.0.6
	OPENBSD_4_1_BASE:1.8
	OPENBSD_4_0:1.8.0.4
	OPENBSD_4_0_BASE:1.8
	OPENBSD_3_9:1.8.0.2
	OPENBSD_3_9_BASE:1.8
	OPENBSD_3_8:1.4.0.10
	OPENBSD_3_8_BASE:1.4
	OPENBSD_3_7:1.4.0.8
	OPENBSD_3_7_BASE:1.4
	OPENBSD_3_6:1.4.0.6
	OPENBSD_3_6_BASE:1.4
	OPENBSD_3_5:1.4.0.4
	OPENBSD_3_5_BASE:1.4
	OPENBSD_3_4:1.4.0.2
	OPENBSD_3_4_BASE:1.4
	OPENBSD_3_3:1.3.0.2
	OPENBSD_3_3_BASE:1.3
	OPENBSD_3_2:1.1.0.2
	OPENBSD_3_2_BASE:1.1;
locks; strict;
comment	@.\" @;


1.17
date	2017.01.18.20.07.40;	author fcambus;	state Exp;
branches;
next	1.16;
commitid	nvGBJxrcQosfsOMB;

1.16
date	2015.09.07.18.43.54;	author kettenis;	state Exp;
branches;
next	1.15;
commitid	GJ8HBSQFCse4YIWh;

1.15
date	2014.01.20.05.07.49;	author schwarze;	state Exp;
branches;
next	1.14;

1.14
date	2013.07.17.20.21.54;	author schwarze;	state Exp;
branches;
next	1.13;

1.13
date	2013.07.05.08.02.04;	author mpi;	state Exp;
branches;
next	1.12;

1.12
date	2013.06.28.20.00.42;	author kettenis;	state Exp;
branches;
next	1.11;

1.11
date	2013.06.04.19.27.11;	author schwarze;	state Exp;
branches;
next	1.10;

1.10
date	2008.06.26.05.42.08;	author ray;	state Exp;
branches;
next	1.9;

1.9
date	2007.05.31.19.20.01;	author jmc;	state Exp;
branches;
next	1.8;

1.8
date	2005.09.30.20.34.25;	author jaredy;	state Exp;
branches;
next	1.7;

1.7
date	2005.09.19.20.22.37;	author jmc;	state Exp;
branches;
next	1.6;

1.6
date	2005.09.19.16.08.29;	author jmc;	state Exp;
branches;
next	1.5;

1.5
date	2005.09.15.20.23.08;	author miod;	state Exp;
branches;
next	1.4;

1.4
date	2003.04.20.20.04.17;	author jmc;	state Exp;
branches;
next	1.3;

1.3
date	2003.01.05.20.07.44;	author deraadt;	state Exp;
branches;
next	1.2;

1.2
date	2002.11.08.08.08.47;	author mpech;	state Exp;
branches;
next	1.1;

1.1
date	2002.08.16.17.51.44;	author jason;	state Exp;
branches;
next	;


desc
@@


1.17
log
@Document the RI_CLEARMARGINS flag.

OK visa@@
@
text
@.\"	$OpenBSD: rasops.9,v 1.16 2015/09/07 18:43:54 kettenis Exp $
.\"     $NetBSD: rasops.9,v 1.4 2002/02/13 08:18:50 ross Exp $
.\"
.\" Copyright (c) 2001 The NetBSD Foundation, Inc.
.\" All rights reserved.
.\"
.\" This code is derived from software contributed to The NetBSD Foundation
.\" by Gregory McGarry.
.\"
.\" Redistribution and use in source and binary forms, with or without
.\" modification, are permitted provided that the following conditions
.\" are met:
.\" 1. Redistributions of source code must retain the above copyright
.\"    notice, this list of conditions and the following disclaimer.
.\" 2. Redistributions in binary form must reproduce the above copyright
.\"    notice, this list of conditions and the following disclaimer in the
.\"    documentation and/or other materials provided with the distribution.
.\"
.\" THIS SOFTWARE IS PROVIDED BY THE NETBSD FOUNDATION, INC. AND CONTRIBUTORS
.\" ``AS IS'' AND ANY EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT LIMITED
.\" TO, THE IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR
.\" PURPOSE ARE DISCLAIMED.  IN NO EVENT SHALL THE FOUNDATION OR CONTRIBUTORS
.\" BE LIABLE FOR ANY DIRECT, INDIRECT, INCIDENTAL, SPECIAL, EXEMPLARY, OR
.\" CONSEQUENTIAL DAMAGES (INCLUDING, BUT NOT LIMITED TO, PROCUREMENT OF
.\" SUBSTITUTE GOODS OR SERVICES; LOSS OF USE, DATA, OR PROFITS; OR BUSINESS
.\" INTERRUPTION) HOWEVER CAUSED AND ON ANY THEORY OF LIABILITY, WHETHER IN
.\" CONTRACT, STRICT LIABILITY, OR TORT (INCLUDING NEGLIGENCE OR OTHERWISE)
.\" ARISING IN ANY WAY OUT OF THE USE OF THIS SOFTWARE, EVEN IF ADVISED OF THE
.\" POSSIBILITY OF SUCH DAMAGE.
.\"
.Dd $Mdocdate: September 7 2015 $
.Dt RASOPS 9
.Os
.Sh NAME
.Nm rasops ,
.Nm rasops_init ,
.Nm rasops_reconfig
.Nd raster display operations
.Sh SYNOPSIS
.In dev/wscons/wsdisplayvar.h
.In dev/rasops/rasops.h
.Ft int
.Fn rasops_init "struct rasops_info *ri" "int wantrows" "int wantcols"
.Ft int
.Fn rasops_reconfig "struct rasops_info *ri" "int wantrows" "int wantcols"
.Sh DESCRIPTION
The
.Nm
subsystem is a set of raster operations for
.Xr wscons 4 .
.Pp
The primary data type for using the raster operations is the
.Em rasops_info
structure in
.Pa dev/rasops/rasops.h :
.Bd -literal
struct rasops_info {

	/*
	 * These must be filled in by the caller
	 */
	int	ri_depth;	/* depth in bits */
	u_char	*ri_bits;	/* ptr to bits */
	int	ri_width;	/* width (pels) */
	int	ri_height;	/* height (pels) */
	int	ri_stride;	/* stride in bytes */

	/*
	 * These can optionally be left zeroed out. If you fill ri_font,
	 * but aren't using wsfont, set ri_wsfcookie to -1.
	 */
	struct	wsdisplay_font *ri_font;
	int	ri_wsfcookie;	/* wsfont cookie */
	void	*ri_hw;		/* driver private data */
	struct wsdisplay_charcell *ri_bs; /* character backing store */
	int	ri_crow;	/* cursor row */
	int	ri_ccol;	/* cursor column */
	int	ri_flg;		/* various operational flags */

	/*
	 * These are optional and will default if zero. Meaningless
	 * on depths other than 15, 16, 24 and 32 bits per pel. On
	 * 24 bit displays, ri_{r,g,b}num must be 8.
	 */
	u_char	ri_rnum;	/* number of bits for red */
	u_char	ri_gnum;	/* number of bits for green */
	u_char	ri_bnum;	/* number of bits for blue */
	u_char	ri_rpos;	/* which bit red starts at */
	u_char	ri_gpos;	/* which bit green starts at */
	u_char	ri_bpos;	/* which bit blue starts at */

	/*
	 * These are filled in by rasops_init()
	 */
	int	ri_emuwidth;	/* width we actually care about */
	int	ri_emuheight;	/* height we actually care about */
	int	ri_emustride;	/* bytes per row we actually care about */
	int	ri_rows;	/* number of rows (characters) */
	int	ri_cols;	/* number of columns (characters) */
	int	ri_delta;	/* row delta in bytes */
	int	ri_pelbytes;	/* bytes per pel (may be zero) */
	int	ri_fontscale;	/* fontheight * fontstride */
	int	ri_xscale;	/* fontwidth * pelbytes */
	int	ri_yscale;	/* fontheight * stride */
	u_char  *ri_origbits;	/* where screen bits actually start */
	int	ri_xorigin;	/* where ri_bits begins (x) */
	int	ri_yorigin;	/* where ri_bits begins (y) */
	int32_t	ri_devcmap[16]; /* color -\*[Gt] framebuffer data */

	/*
	 * The emulops you need to use, and the screen caps for wscons
	 */
	struct	wsdisplay_emulops ri_ops;
	int	ri_caps;

	/*
	 * Callbacks so we can share some code
	 */
	void	(*ri_do_cursor)(struct rasops_info *);
	void	(*ri_updatecursor)(struct rasops_info *);

#if NRASOPS_ROTATION > 0
	/* Used to intercept putchar to permit display rotation */
	struct	wsdisplay_emulops ri_real_ops;
#endif
};
.Ed
.Pp
The value of the
.Em ri_flg
member is formed by OR'ing the following values:
.Pp
.Bl -tag -offset indent -width RI_CLEARMARGINS -compact
.It RI_FULLCLEAR
Force eraserows() to clear the whole screen instead of only text lines,
when invoked with an
.Em nrows
parameter equal to the number of text lines.
.It RI_FORCEMONO
Do not output coloured text, even if the display supports it.
.It RI_BSWAP
Specifies that the frame buffer endianness is different from the CPU's.
.It RI_CURSOR
Set when the text cursor is enabled.
.It RI_CLEAR
Clear the display upon initialization.
.It RI_CLEARMARGINS
Clear display margins upon initialization.
.It RI_CENTER
Center the text area.
.\" Only honoured if option RASOPS_CLIPPING which we don't use.
.\" .It RI_CURSORCLIP
.\" Cursor is currently clipped
.It RI_ROTATE_CW
Rotate the text display quarter clockwise.
.It RI_CFGDONE
.Fn rasops_reconfig
completed successfully
.It RI_VCONS
Support the use of multiple screens.
.It RI_WRONLY
Do not read back pixels from the frame buffer memory when performing
screen-to-screen copy operations.
This flag is ignored unless
.Dv RI_VCONS
is set or the
.Em ri_bs
member is set.
.El
.Sh FUNCTIONS
.Bl -tag -width compact
.It Fn rasops_init "ri" "wantrows" "wantcols"
Initialise a
.Em rasops_info
descriptor.
The arguments
.Fa wantrows
and
.Fa wantcols
are the number of rows and columns we'd like.
In terms of
optimization, fonts that are a multiple of 8 pixels wide work the
best.
.It Fn rasops_reconfig "ri" "wantrows" "wantcols"
Reconfigure a
.Em rasops_info
descriptor because parameters have changed in some way.
The arguments
.Fa wantrows
and
.Fa wantcols
are the number of rows and columns we'd like.
If calling
.Fn rasops_reconfig
to change the font and ri_wsfcookie \*[Ge] 0, you must call
.Fn wsfont_unlock
on it, and reset it to -1 (or a new, valid cookie).
.El
.Sh CODE REFERENCES
This section describes places within the
.Ox
source tree where actual code implementing or utilising the rasops
subsystem can be found.
All pathnames are relative to
.Pa /usr/src .
.Pp
The rasops subsystem is implemented within the directory
.Pa sys/dev/rasops .
The
.Nm
module itself is implemented within the file
.Pa sys/dev/rasops/rasops.c .
.Sh SEE ALSO
.Xr intro 9
.\" XXX These don't exist yet
.\" .Xr wscons 9 ,
.\" .Xr wsdisplay 9 ,
.\" .Xr wsfont 9
.Sh HISTORY
The
.Nm
subsystem appeared in
.Nx 1.5
and
.Ox
first support appeared in
.Ox 2.9 .
.Sh AUTHORS
.An -nosplit
The
.Nm
subsystem was written by
.An Andrew Doran Aq Mt ad@@NetBSD.org .
Display rotation was written by
.An Christopher Pascoe Aq Mt pascoe@@openbsd.org .
.Sh CAVEATS
Display rotation only works for 16bpp displays.
@


1.16
log
@Document the new ri_bs member.
@
text
@d1 1
a1 1
.\"	$OpenBSD: rasops.9,v 1.15 2014/01/20 05:07:49 schwarze Exp $
d31 1
a31 1
.Dd $Mdocdate: January 20 2014 $
d133 1
a133 1
.Bl -tag -offset indent -width RI_CURSORCLIP -compact
d147 2
@


1.15
log
@Obvious .Xr fixes, found while testing mandocdb(8).
@
text
@d1 1
a1 1
.\"	$OpenBSD: rasops.9,v 1.14 2013/07/17 20:21:54 schwarze Exp $
d31 1
a31 1
.Dd $Mdocdate: July 17 2013 $
d75 1
d164 3
a166 1
is set.
@


1.14
log
@use .Mt for AUTHORS email; from Jan Stary <hans at stare dot cz>; ok jmc@@
@
text
@d1 1
a1 1
.\"	$OpenBSD: rasops.9,v 1.13 2013/07/05 08:02:04 mpi Exp $
d31 1
a31 1
.Dd $Mdocdate: July 5 2013 $
d50 1
a50 1
.Xr wscons .
@


1.13
log
@Document RI_WRONLY, committing on behalf of miod@@.

ok kettenis@@
@
text
@d1 1
a1 1
.\"	$OpenBSD: rasops.9,v 1.12 2013/06/28 20:00:42 kettenis Exp $
d31 1
a31 1
.Dd $Mdocdate: June 28 2013 $
d228 1
a228 2
.An Andrew Doran
.Aq ad@@NetBSD.org .
d230 1
a230 2
.An Christopher Pascoe
.Aq pascoe@@openbsd.org .
@


1.12
log
@Document RI_VCONS.
@
text
@d1 1
a1 1
.\"	$OpenBSD: rasops.9,v 1.11 2013/06/04 19:27:11 schwarze Exp $
d31 1
a31 1
.Dd $Mdocdate: June 4 2013 $
d158 6
@


1.11
log
@Replace old-fashioned .Fd by new-fangled .In for #include lines.
Diff from Jan Klemkow <j dot klemkow at wemelug dot de> on tech@@.
No objection from jmc@@ against this type of change.
@
text
@d1 1
a1 1
.\"	$OpenBSD: rasops.9,v 1.10 2008/06/26 05:42:08 ray Exp $
d31 1
a31 1
.Dd $Mdocdate: June 26 2008 $
d156 2
@


1.10
log
@First pass at removing clauses 3 and 4 from NetBSD licenses.

Not sure what's more surprising: how long it took for NetBSD to
catch up to the rest of the BSDs (including UCB), or the amount of
code that NetBSD has claimed for itself without attributing to the
actual authors.

OK deraadt@@
@
text
@d1 1
a1 1
.\"	$OpenBSD: rasops.9,v 1.9 2007/05/31 19:20:01 jmc Exp $
d31 1
a31 1
.Dd $Mdocdate: May 31 2007 $
d40 2
a41 2
.Fd #include \*[Lt]dev/wscons/wsdisplayvar.h\*[Gt]
.Fd #include \*[Lt]dev/rasops/rasops.h\*[Gt]
@


1.9
log
@convert to new .Dd format;
@
text
@d1 1
a1 1
.\"	$OpenBSD: rasops.9,v 1.8 2005/09/30 20:34:25 jaredy Exp $
a17 7
.\" 3. All advertising materials mentioning features or use of this software
.\"    must display the following acknowledgement:
.\"        This product includes software developed by the NetBSD
.\"        Foundation, Inc. and its contributors.
.\" 4. Neither the name of The NetBSD Foundation nor the names of its
.\"    contributors may be used to endorse or promote products derived
.\"    from this software without specific prior written permission.
d31 1
a31 1
.Dd $Mdocdate$
@


1.8
log
@deploy .An -nosplit; ok jmc
@
text
@d1 1
a1 1
.\"	$OpenBSD: rasops.9,v 1.7 2005/09/19 20:22:37 jmc Exp $
d38 1
a38 1
.Dd September 9, 2005
@


1.7
log
@remove a dead Xr;
discussed with miod@@;
@
text
@d1 1
a1 1
.\"	$OpenBSD: rasops.9,v 1.6 2005/09/19 16:08:29 jmc Exp $
d223 1
@


1.6
log
@tweaks;
@
text
@d1 1
a1 1
.\"	$OpenBSD: rasops.9,v 1.5 2005/09/15 20:23:08 miod Exp $
d57 1
a57 1
.Xr wscons 9 .
@


1.5
log
@Stop compiling the texte console rotation code #ifdef __zaurus__, but use
a flag in the rasops_info structure; drivers which may use it shall declare
a specific attribute for the config(8) machinery, so that the necessary code
is compiled in.

In addition to this, rotated font computation is now done on-demand, and a
list of unrotated-rotated font cookie pairs is kept, rather than rotating all
built-in wsfonts at initialization time.

No user-perceptible functional change.

Tested matthieu@@ uwe@@, ok uwe@@
@
text
@d1 1
a1 1
.\"	$OpenBSD: rasops.9,v 1.4 2003/04/20 20:04:17 jmc Exp $
d137 1
a137 3
member is formed by
.Tn OR Ns 'ing
the following values:
d142 1
a142 1
when invoked with a
d144 1
a144 1
paramete equal to the number of text lines.
@


1.4
log
@typos;
@
text
@d1 1
a1 1
.\"	$OpenBSD: rasops.9,v 1.3 2003/01/05 20:07:44 deraadt Exp $
d38 1
a38 1
.Dd October 7, 2001
d127 5
d135 1
a135 1
Valid values for the
d137 3
a139 1
member are:
d143 4
a146 1
eraserows() hack to clear full screen
d148 1
a148 1
monochrome output even if we can do color
d150 1
a150 1
framebuffer endianness doesn't match CPU
d152 1
a152 1
cursor is switched on
d154 1
a154 1
clear display on startup
d156 6
a161 3
center onscreen output
.It RI_CURSORCLIP
cursor is currently clipped
d230 5
@


1.3
log
@spelling
@
text
@d1 1
a1 1
.\"	$OpenBSD: rasops.9,v 1.2 2002/11/08 08:08:47 mpech Exp $
d135 1
a135 1
.It  RI_FULLCLEAR
d137 1
a137 1
.It  RI_FORCEMONO
d139 1
a139 1
.It  RI_BSWAP
d141 1
a141 1
.It  RI_CURSOR
d143 1
a143 1
.It  RI_CLEAR
d145 1
a145 1
.It  RI_CENTER
d147 1
a147 1
.It  RI_CURSORCLIP
d149 1
a149 1
.It  RI_CFGDONE
d194 1
a194 1
module itself is implement within the file
@


1.2
log
@Time to cleanup:
o) start new sentence on a new line;
o) wrap long lines;
o) don't use .Pp before/after .Sh, .Ss;
o) OpenBSD -> .Ox;
o) typos;
o) close .Rs;
o) use space between arguments in tag, for example:
   .Xr blabla ) .

miod@@ ok
@
text
@d1 1
a1 1
.\"	$OpenBSD: rasops.9,v 1.1 2002/08/16 17:51:44 jason Exp $
d158 1
a158 1
desriptor.
@


1.1
log
@Man page for rasops from NetBSD
@
text
@d1 1
a1 1
.\"	$OpenBSD$
d158 2
a159 1
desriptor.  The arguments
d163 2
a164 1
are the number of rows and columns we'd like.  In terms of
d170 2
a171 1
descriptor because parameters have changed in some way.  The arguments
d175 2
a176 1
are the number of rows and columns we'd like.  If calling
d186 2
a187 1
subsystem can be found.  All pathnames are relative to
@

