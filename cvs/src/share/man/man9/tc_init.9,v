head	1.8;
access;
symbols
	OPENBSD_6_2_BASE:1.8
	OPENBSD_6_1:1.8.0.12
	OPENBSD_6_1_BASE:1.8
	OPENBSD_6_0:1.8.0.8
	OPENBSD_6_0_BASE:1.8
	OPENBSD_5_9:1.8.0.4
	OPENBSD_5_9_BASE:1.8
	OPENBSD_5_8:1.8.0.6
	OPENBSD_5_8_BASE:1.8
	OPENBSD_5_7:1.8.0.2
	OPENBSD_5_7_BASE:1.8
	OPENBSD_5_6:1.7.0.8
	OPENBSD_5_6_BASE:1.7
	OPENBSD_5_5:1.7.0.6
	OPENBSD_5_5_BASE:1.7
	OPENBSD_5_4:1.7.0.2
	OPENBSD_5_4_BASE:1.7
	OPENBSD_5_3:1.6.0.2
	OPENBSD_5_3_BASE:1.6
	OPENBSD_5_2:1.5.0.6
	OPENBSD_5_2_BASE:1.5
	OPENBSD_5_1_BASE:1.5
	OPENBSD_5_1:1.5.0.4
	OPENBSD_5_0:1.5.0.2
	OPENBSD_5_0_BASE:1.5
	OPENBSD_4_9:1.4.0.16
	OPENBSD_4_9_BASE:1.4
	OPENBSD_4_8:1.4.0.14
	OPENBSD_4_8_BASE:1.4
	OPENBSD_4_7:1.4.0.10
	OPENBSD_4_7_BASE:1.4
	OPENBSD_4_6:1.4.0.12
	OPENBSD_4_6_BASE:1.4
	OPENBSD_4_5:1.4.0.8
	OPENBSD_4_5_BASE:1.4
	OPENBSD_4_4:1.4.0.6
	OPENBSD_4_4_BASE:1.4
	OPENBSD_4_3:1.4.0.4
	OPENBSD_4_3_BASE:1.4
	OPENBSD_4_2:1.4.0.2
	OPENBSD_4_2_BASE:1.4
	OPENBSD_4_1:1.2.0.6
	OPENBSD_4_1_BASE:1.2
	OPENBSD_4_0:1.2.0.4
	OPENBSD_4_0_BASE:1.2
	OPENBSD_3_9:1.2.0.2
	OPENBSD_3_9_BASE:1.2
	OPENBSD_3_8:1.1.0.4
	OPENBSD_3_8_BASE:1.1
	OPENBSD_3_7:1.1.0.2
	OPENBSD_3_7_BASE:1.1;
locks; strict;
comment	@.\" @;


1.8
date	2014.11.15.14.41.03;	author bentley;	state Exp;
branches;
next	1.7;
commitid	HuCemPIiOkto0SJD;

1.7
date	2013.06.04.19.27.13;	author schwarze;	state Exp;
branches;
next	1.6;

1.6
date	2012.08.18.08.44.25;	author jmc;	state Exp;
branches;
next	1.5;

1.5
date	2011.04.10.20.27.02;	author shadchin;	state Exp;
branches;
next	1.4;

1.4
date	2007.05.31.19.20.01;	author jmc;	state Exp;
branches;
next	1.3;

1.3
date	2007.03.19.00.16.35;	author alek;	state Exp;
branches;
next	1.2;

1.2
date	2005.12.25.14.55.35;	author grange;	state Exp;
branches;
next	1.1;

1.1
date	2004.12.18.14.26.03;	author grange;	state Exp;
branches;
next	;


desc
@@


1.8
log
@Reduce instances of `` '' in manuals.

troff displays these as typographic quotes, but nroff implementations
almost always print them literally, which rarely has the intended effect
with modern fonts, even in stock xterm.

These uses of `` '' can be replaced either with more semantic alternatives
or with Dq, which prints typographic quotes in a UTF-8 locale (but will
automatically fall back to `` '' in an ASCII locale).

improvements and ok schwarze@@
@
text
@.\"	$OpenBSD: tc_init.9,v 1.7 2013/06/04 19:27:13 schwarze Exp $
.\"
.\" Copyright (c) 2004 Alexander Yurchenko <grange@@openbsd.org>
.\"
.\" Permission to use, copy, modify, and distribute this software for any
.\" purpose with or without fee is hereby granted, provided that the above
.\" copyright notice and this permission notice appear in all copies.
.\"
.\" THE SOFTWARE IS PROVIDED "AS IS" AND THE AUTHOR DISCLAIMS ALL WARRANTIES
.\" WITH REGARD TO THIS SOFTWARE INCLUDING ALL IMPLIED WARRANTIES OF
.\" MERCHANTABILITY AND FITNESS. IN NO EVENT SHALL THE AUTHOR BE LIABLE FOR
.\" ANY SPECIAL, DIRECT, INDIRECT, OR CONSEQUENTIAL DAMAGES OR ANY DAMAGES
.\" WHATSOEVER RESULTING FROM LOSS OF USE, DATA OR PROFITS, WHETHER IN AN
.\" ACTION OF CONTRACT, NEGLIGENCE OR OTHER TORTIOUS ACTION, ARISING OUT OF
.\" OR IN CONNECTION WITH THE USE OR PERFORMANCE OF THIS SOFTWARE.
.\"
.Dd $Mdocdate: June 4 2013 $
.Dt TC_INIT 9
.Os
.Sh NAME
.Nm tc_init
.Nd machine-independent binary timescale
.Sh SYNOPSIS
.In sys/timetc.h
.Ft void
.Fn tc_init "struct timecounter *tc"
.Sh DESCRIPTION
The timecounter interface is a machine-independent implementation
of a binary timescale using whatever hardware support is at hand
for tracking time.
.Pp
A timecounter is a binary counter which has two properties:
.Bl -bullet -offset indent
.It
it runs at a fixed, known frequency
.It
it has sufficient bits to not roll over in less than approximately
max(2 msec, 2/HZ seconds) (the value 2 here is really 1 + delta, for some
indeterminate value of delta)
.El
.Pp
The interface between the hardware which implements a timecounter and the
machine-independent code which uses this to keep track of time is a
.Va timecounter
structure:
.Bd -literal -offset indent
struct timecounter {
	timecounter_get_t	*tc_get_timecount;
	timecounter_pps_t	*tc_poll_pps;
	u_int 			tc_counter_mask;
	u_int64_t		tc_frequency;
	char			*tc_name;
	int			tc_quality;
	void			*tc_priv;
	struct timecounter	*tc_next;
}
.Ed
.Pp
The fields of the
.Va timecounter
structure are described below.
.Bl -tag -width indent
.It Fn "u_int (*tc_get_timecount)" "struct timecounter *"
This function reads the counter.
It is not required to mask any unimplemented bits out, as long as they
are constant.
.It Fn "void (*tc_poll_pps)" "struct timecounter *"
This function is optional and can be set to NULL.
It will be called whenever the timecounter is rewound, and is intended
to check for PPS events.
Normal hardware does not need it but timecounters which latch PPS in
hardware do.
.It Va tc_counter_mask
This mask should mask off any unimplemented bits.
.It Va tc_frequency
Frequency of the counter in Hz.
.It Va tc_name
Name of the timecounter.
Can be any null-terminated string.
.It Va tc_quality
Used to determine if this timecounter is better than another timecounter \-
higher means better.
If this field is negative, the counter is only used at explicit request.
.It Va tc_priv
Pointer to the timecounter's private parts.
.It Va tc_next
For internal use.
.El
.Pp
To register a new timecounter,
the hardware device driver should fill a
.Va timecounter
structure with appropriate values and call the
.Fn tc_init
function, giving a pointer to the structure as a
.Fa tc
parameter.
.Sh CODE REFERENCES
The timecounter framework is implemented in the file
.Pa sys/kern/kern_tc.c .
.Sh SEE ALSO
.Xr amdpm 4 ,
.Xr elansc 4 ,
.Xr gscpm 4 ,
.Xr ichpcib 4 ,
.Xr viapm 4 ,
.Xr hz 9 ,
.Xr microtime 9
.Rs
.%A Poul-Henning Kamp
.%T Timecounter: Efficient and precise timekeeping in SMP kernels
.%J The FreeBSD Project
.%U http://phk.freebsd.dk/pubs/timecounter.pdf
.Re
.Sh HISTORY
The timecounter interface first appeared in
.Ox 3.6 .
@


1.7
log
@Replace old-fashioned .Fd by new-fangled .In for #include lines.
Diff from Jan Klemkow <j dot klemkow at wemelug dot de> on tech@@.
No objection from jmc@@ against this type of change.
@
text
@d1 1
a1 1
.\"	$OpenBSD: tc_init.9,v 1.6 2012/08/18 08:44:25 jmc Exp $
d17 1
a17 1
.Dd $Mdocdate: August 18 2012 $
d83 1
a83 1
Negative means ``only use at explicit request''.
@


1.6
log
@within Rs/Re reference blocks, use %U instead of %O (or any other
variants) for URLs, allowing mandoc -Thtml to properly generate links;

(sendmail.8 changes are simply using Lk, which i somehow missed in previous)

ingo reminded me to verify that gnu groff recognises %U: 1.20.1 does not,
but 1.21 does;
@
text
@d1 1
a1 1
.\"	$OpenBSD: tc_init.9,v 1.5 2011/04/10 20:27:02 shadchin Exp $
d17 1
a17 1
.Dd $Mdocdate: April 10 2011 $
d24 1
a24 1
.Fd #include <sys/timetc.h>
@


1.5
log
@Merge viapm and viaenv

Pluses:
- Add support SMBus for VT82C596, VT82C596B, VT82C686A, VT8231
- Add support ACPI timer for all VIA South Bridges

ok deraadt@@, tested sthen@@
@
text
@d1 1
a1 1
.\"	$OpenBSD: tc_init.9,v 1.4 2007/05/31 19:20:01 jmc Exp $
d17 1
a17 1
.Dd $Mdocdate: May 31 2007 $
d113 1
a113 1
.%I http://phk.freebsd.dk/pubs/timecounter.pdf
@


1.4
log
@convert to new .Dd format;
@
text
@d1 1
a1 1
.\"	$OpenBSD: tc_init.9,v 1.3 2007/03/19 00:16:35 alek Exp $
d17 1
a17 1
.Dd $Mdocdate$
d106 1
a106 1
.Xr viaenv 4 ,
@


1.3
log
@correct name for the source file with timecounter implementation; ok jmc@@
@
text
@d1 1
a1 1
.\"	$OpenBSD: tc_init.9,v 1.2 2005/12/25 14:55:35 grange Exp $
d17 1
a17 1
.Dd December 15, 2004
@


1.2
log
@Remove piixpm(4), it doesn't provide time source any more.
@
text
@d1 1
a1 1
.\"	$OpenBSD: tc_init.9,v 1.1 2004/12/18 14:26:03 grange Exp $
d100 1
a100 1
.Pa sys/kern/kern_tc .
@


1.1
log
@Add tc_init(9) page, a description of the timecounters. With some
help from jmc@@.
@
text
@d1 1
a1 1
.\"	$OpenBSD$
a105 1
.Xr piixpm 4 ,
@

