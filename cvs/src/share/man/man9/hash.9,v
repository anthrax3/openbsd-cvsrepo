head	1.7;
access;
symbols
	OPENBSD_6_0:1.7.0.14
	OPENBSD_6_0_BASE:1.7
	OPENBSD_5_9:1.7.0.10
	OPENBSD_5_9_BASE:1.7
	OPENBSD_5_8:1.7.0.12
	OPENBSD_5_8_BASE:1.7
	OPENBSD_5_7:1.7.0.4
	OPENBSD_5_7_BASE:1.7
	OPENBSD_5_6:1.7.0.8
	OPENBSD_5_6_BASE:1.7
	OPENBSD_5_5:1.7.0.6
	OPENBSD_5_5_BASE:1.7
	OPENBSD_5_4:1.7.0.2
	OPENBSD_5_4_BASE:1.7
	OPENBSD_5_3:1.6.0.24
	OPENBSD_5_3_BASE:1.6
	OPENBSD_5_2:1.6.0.22
	OPENBSD_5_2_BASE:1.6
	OPENBSD_5_1_BASE:1.6
	OPENBSD_5_1:1.6.0.20
	OPENBSD_5_0:1.6.0.18
	OPENBSD_5_0_BASE:1.6
	OPENBSD_4_9:1.6.0.16
	OPENBSD_4_9_BASE:1.6
	OPENBSD_4_8:1.6.0.14
	OPENBSD_4_8_BASE:1.6
	OPENBSD_4_7:1.6.0.10
	OPENBSD_4_7_BASE:1.6
	OPENBSD_4_6:1.6.0.12
	OPENBSD_4_6_BASE:1.6
	OPENBSD_4_5:1.6.0.8
	OPENBSD_4_5_BASE:1.6
	OPENBSD_4_4:1.6.0.6
	OPENBSD_4_4_BASE:1.6
	OPENBSD_4_3:1.6.0.4
	OPENBSD_4_3_BASE:1.6
	OPENBSD_4_2:1.6.0.2
	OPENBSD_4_2_BASE:1.6
	OPENBSD_4_1:1.5.0.16
	OPENBSD_4_1_BASE:1.5
	OPENBSD_4_0:1.5.0.14
	OPENBSD_4_0_BASE:1.5
	OPENBSD_3_9:1.5.0.12
	OPENBSD_3_9_BASE:1.5
	OPENBSD_3_8:1.5.0.10
	OPENBSD_3_8_BASE:1.5
	OPENBSD_3_7:1.5.0.8
	OPENBSD_3_7_BASE:1.5
	OPENBSD_3_6:1.5.0.6
	OPENBSD_3_6_BASE:1.5
	OPENBSD_3_5:1.5.0.4
	OPENBSD_3_5_BASE:1.5
	OPENBSD_3_4:1.5.0.2
	OPENBSD_3_4_BASE:1.5
	OPENBSD_3_3:1.4.0.2
	OPENBSD_3_3_BASE:1.4
	OPENBSD_3_2:1.2.0.2
	OPENBSD_3_2_BASE:1.2;
locks; strict;
comment	@.\" @;


1.7
date	2013.06.04.19.27.07;	author schwarze;	state Exp;
branches;
next	1.6;

1.6
date	2007.05.31.19.20.00;	author jmc;	state Exp;
branches;
next	1.5;

1.5
date	2003.04.17.05.08.39;	author jmc;	state Exp;
branches;
next	1.4;

1.4
date	2002.12.09.22.46.11;	author cloder;	state Exp;
branches;
next	1.3;

1.3
date	2002.11.08.08.08.47;	author mpech;	state Exp;
branches;
next	1.2;

1.2
date	2002.06.21.19.14.14;	author weingart;	state Exp;
branches;
next	1.1;

1.1
date	2002.06.21.07.40.14;	author weingart;	state Exp;
branches;
next	;


desc
@@


1.7
log
@Replace old-fashioned .Fd by new-fangled .In for #include lines.
Diff from Jan Klemkow <j dot klemkow at wemelug dot de> on tech@@.
No objection from jmc@@ against this type of change.
@
text
@.\"	$OpenBSD: hash.9,v 1.6 2007/05/31 19:20:00 jmc Exp $
.\"
.\" Copyright (c) 2001 Tobias Weingartner
.\" All rights reserved.
.\"
.\" Redistribution and use in source and binary forms, with or without
.\" modification, are permitted provided that the following conditions
.\" are met:
.\" 1. Redistributions of source code must retain the above copyright
.\"    notice, this list of conditions and the following disclaimer.
.\" 2. Redistributions in binary form must reproduce the above copyright
.\"    notice, this list of conditions and the following disclaimer in the
.\"    documentation and/or other materials provided with the distribution.
.\" 3. The name of the author may not be used to endorse or promote products
.\"    derived from this software without specific prior written permission.
.\"
.\" THIS SOFTWARE IS PROVIDED BY THE AUTHOR ``AS IS'' AND ANY EXPRESS OR
.\" IMPLIED WARRANTIES, INCLUDING, BUT NOT LIMITED TO, THE IMPLIED WARRANTIES
.\" OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE ARE DISCLAIMED.
.\" IN NO EVENT SHALL THE AUTHOR BE LIABLE FOR ANY DIRECT, INDIRECT,
.\" INCIDENTAL, SPECIAL, EXEMPLARY, OR CONSEQUENTIAL DAMAGES (INCLUDING, BUT
.\" NOT LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES; LOSS OF USE,
.\" DATA, OR PROFITS; OR BUSINESS INTERRUPTION) HOWEVER CAUSED AND ON ANY
.\" THEORY OF LIABILITY, WHETHER IN CONTRACT, STRICT LIABILITY, OR TORT
.\" (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE USE OF
.\" THIS SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.
.\"
.Dd $Mdocdate: May 31 2007 $
.Dt HASH 9
.Os
.Sh NAME
.Nm hash
.\" XXX - Should all these be .Nm as well?
.\" .Nm hash32 ,
.\" .Nm hash32_buf ,
.\" .Nm hash32_str ,
.\" .Nm hash32_strn ,
.\" .Nm hash32_stre ,
.\" .Nm hash32_strne
.Nd general kernel hashing functions
.Sh SYNOPSIS
.In sys/hash.h
.Ft uint32_t
.Fn hash32_buf "void *buf" "size_t len" "uint32_t hash"
.Ft uint32_t
.Fn hash32_str "void *buf" "uint32_t hash"
.Ft uint32_t
.Fn hash32_strn "void *buf" "size_t len" "uint32_t hash"
.Ft uint32_t
.Fn hash32_stre "void *buf" "int end" "char **ep" "uint32_t hash"
.Ft uint32_t
.Fn hash32_strne "void *buf" "size_t len" "int end" "char **ep" "uint32_t hash"
.Sh DESCRIPTION
The
.Fn hash32
functions are used to give a consistent and general interface to
a decent hashing algorithm within the kernel.
These functions can be used to hash ASCII
.Dv NUL
terminated strings, as well as blocks of memory.
.Pp
The
.Fn hash32_buf
function is used as a general buffer hashing function.
The argument
.Fa buf
is used to pass in the location, and
.Fa len
is the length of the buffer.
The argument
.Fa hash
is used to extend an existing hash, or is passed the initial value
.Dv HASHINIT
to start a new hash.
.Pp
The
.Fn hash32_str
function is used to hash a
.Dv NUL
terminated string passed in
.Fa buf
with initial hash value given in
.Fa hash .
.Pp
The
.Fn hash32_strn
function is like the
.Fn hash32_str
function, except it also takes a
.Fa len
argument, which is the maximal length of the expected string.
.Pp
The
.Fn hash32_stre
and
.Fn hash32_strne
functions are helper functions used by the kernel to hash pathname
components.
These functions have the additional termination condition
of terminating when they find a character given by
.Fa end
in the string to be hashed.
If the argument
.Fa ep
is not
.Dv NULL ,
it is set to the point in the buffer at which the hash function
terminated hashing.
.Sh RETURN VALUES
The
.Fn hash32
functions return a 32 bit hash value of the buffer or string.
.Sh EXAMPLES
.Bd -literal -offset indent
LIST_HEAD(head, cache) *hashtbl = NULL;
u_long mask = 0;

void
sample_init(void)
{
	hashtbl = hashinit(numwanted, type, flags, &mask);
}

void
sample_use(char *str, int len)
{
	uint32_t hash;

	hash = hash32_str(str, HASHINIT);
	hash = hash32_buf(&len, sizeof(len), hash);
	hashtbl[hash & mask] = len;
}
.Ed
.Sh SEE ALSO
.Xr free 9 ,
.Xr hashinit 9 ,
.Xr malloc 9
.Sh LIMITATIONS
The
.Fn hash32
functions are only 32 bit functions.
They will prove to give poor 64 bit performance, especially for the
top 32 bits.
At the current time, this is not seen as a great limitation, as these
hash values are usually used to index into an array.
Should these hash values be used for other means, this limitation should
be revisited.
.Sh HISTORY
The
.Nm
functions were first committed to
.Nx 1.6 .
The
.Ox
versions were written and massaged for
.Ox 2.3
by Tobias Weingartner,
and finally committed for
.Ox 3.2 .
@


1.6
log
@convert to new .Dd format;
@
text
@d1 1
a1 1
.\"	$OpenBSD: hash.9,v 1.5 2003/04/17 05:08:39 jmc Exp $
d28 1
a28 1
.Dd $Mdocdate$
d42 1
a42 1
.Fd #include <sys/hash.h>
@


1.5
log
@typos;

md5(9): ok tedu@@
@
text
@d1 1
a1 1
.\"	$OpenBSD: hash.9,v 1.4 2002/12/09 22:46:11 cloder Exp $
d28 1
a28 1
.Dd December 8, 2001
@


1.4
log
@Correct typo.  'commited' -> 'committed'.  Also got rid of obsolete
todo-style comment about missing free(9) etc.
@
text
@d1 1
a1 1
.\"	$OpenBSD: hash.9,v 1.3 2002/11/08 08:08:47 mpech Exp $
d135 1
a135 1
.Xr free 9
d137 1
a137 1
.Xr malloc 9 ,
@


1.3
log
@Time to cleanup:
o) start new sentence on a new line;
o) wrap long lines;
o) don't use .Pp before/after .Sh, .Ss;
o) OpenBSD -> .Ox;
o) typos;
o) close .Rs;
o) use space between arguments in tag, for example:
   .Xr blabla ) .

miod@@ ok
@
text
@d1 1
a1 1
.\"	$OpenBSD: hash.9,v 1.2 2002/06/21 19:14:14 weingart Exp $
a134 1
.\" Not written yet, comming I hope
d151 1
a151 1
functions were first commited to
d158 1
a158 1
and finally commited for
@


1.2
log
@Alphabetise.  From Mike Pechkin.
@
text
@d1 1
a1 1
.\"	$OpenBSD: hash.9,v 1.1 2002/06/21 07:40:14 weingart Exp $
a133 1
.Pp
@


1.1
log
@Add hash(9) and hashinit(9).
@
text
@d1 1
a1 1
.\"	$OpenBSD$
d137 1
a139 1
.Xr free 9
@

