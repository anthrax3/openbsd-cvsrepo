head	1.12;
access;
symbols
	OPENBSD_6_2:1.12.0.14
	OPENBSD_6_2_BASE:1.12
	OPENBSD_6_1:1.12.0.12
	OPENBSD_6_1_BASE:1.12
	OPENBSD_6_0:1.12.0.8
	OPENBSD_6_0_BASE:1.12
	OPENBSD_5_9:1.12.0.4
	OPENBSD_5_9_BASE:1.12
	OPENBSD_5_8:1.12.0.6
	OPENBSD_5_8_BASE:1.12
	OPENBSD_5_7:1.12.0.2
	OPENBSD_5_7_BASE:1.12
	OPENBSD_5_6:1.11.0.8
	OPENBSD_5_6_BASE:1.11
	OPENBSD_5_5:1.11.0.6
	OPENBSD_5_5_BASE:1.11
	OPENBSD_5_4:1.11.0.2
	OPENBSD_5_4_BASE:1.11
	OPENBSD_5_3:1.10.0.22
	OPENBSD_5_3_BASE:1.10
	OPENBSD_5_2:1.10.0.20
	OPENBSD_5_2_BASE:1.10
	OPENBSD_5_1_BASE:1.10
	OPENBSD_5_1:1.10.0.18
	OPENBSD_5_0:1.10.0.16
	OPENBSD_5_0_BASE:1.10
	OPENBSD_4_9:1.10.0.14
	OPENBSD_4_9_BASE:1.10
	OPENBSD_4_8:1.10.0.12
	OPENBSD_4_8_BASE:1.10
	OPENBSD_4_7:1.10.0.8
	OPENBSD_4_7_BASE:1.10
	OPENBSD_4_6:1.10.0.10
	OPENBSD_4_6_BASE:1.10
	OPENBSD_4_5:1.10.0.6
	OPENBSD_4_5_BASE:1.10
	OPENBSD_4_4:1.10.0.4
	OPENBSD_4_4_BASE:1.10
	OPENBSD_4_3:1.10.0.2
	OPENBSD_4_3_BASE:1.10
	OPENBSD_4_2:1.9.0.2
	OPENBSD_4_2_BASE:1.9
	OPENBSD_4_1:1.6.0.6
	OPENBSD_4_1_BASE:1.6
	OPENBSD_4_0:1.6.0.4
	OPENBSD_4_0_BASE:1.6
	OPENBSD_3_9:1.6.0.2
	OPENBSD_3_9_BASE:1.6;
locks; strict;
comment	@.\" @;


1.12
date	2015.02.15.22.26.45;	author bentley;	state Exp;
branches;
next	1.11;
commitid	szmpRDHaqpG6RctM;

1.11
date	2013.06.04.19.27.10;	author schwarze;	state Exp;
branches;
next	1.10;

1.10
date	2008.01.26.23.07.55;	author jmc;	state Exp;
branches;
next	1.9;

1.9
date	2007.08.02.07.13.27;	author jmc;	state Exp;
branches;
next	1.8;

1.8
date	2007.05.31.19.20.00;	author jmc;	state Exp;
branches;
next	1.7;

1.7
date	2007.05.12.16.38.10;	author sobrado;	state Exp;
branches;
next	1.6;

1.6
date	2005.11.15.15.24.43;	author jmc;	state Exp;
branches;
next	1.5;

1.5
date	2005.11.15.00.26.43;	author jmc;	state Exp;
branches;
next	1.4;

1.4
date	2005.11.14.17.11.53;	author mickey;	state Exp;
branches;
next	1.3;

1.3
date	2005.11.14.16.42.42;	author mickey;	state Exp;
branches;
next	1.2;

1.2
date	2005.11.14.16.35.33;	author mickey;	state Exp;
branches;
next	1.1;

1.1
date	2005.11.14.14.30.21;	author mickey;	state Exp;
branches;
next	;


desc
@@


1.12
log
@Use "In" to mark up include files, instead of wrongly wrapping with Aq.

Aq is not the same as <> in non-ASCII situations, so this caused
incorrect output in some places. And it provided no semantics besides.

ok schwarze@@
@
text
@.\"	$OpenBSD: pci_conf_read.9,v 1.11 2013/06/04 19:27:10 schwarze Exp $
.\"
.\" Copyright (c) 2005 Michael Shalayeff
.\" All rights reserved.
.\"
.\" Permission to use, copy, modify, and distribute this software for any
.\" purpose with or without fee is hereby granted, provided that the above
.\" copyright notice and this permission notice appear in all copies.
.\"
.\" THE SOFTWARE IS PROVIDED "AS IS" AND THE AUTHOR DISCLAIMS ALL WARRANTIES
.\" WITH REGARD TO THIS SOFTWARE INCLUDING ALL IMPLIED WARRANTIES OF
.\" MERCHANTABILITY AND FITNESS. IN NO EVENT SHALL THE AUTHOR BE LIABLE FOR
.\" ANY SPECIAL, DIRECT, INDIRECT, OR CONSEQUENTIAL DAMAGES OR ANY DAMAGES
.\" WHATSOEVER RESULTING FROM LOSS OF USE, DATA OR PROFITS, WHETHER IN AN
.\" ACTION OF CONTRACT, NEGLIGENCE OR OTHER TORTIOUS ACTION, ARISING OUT OF
.\" OR IN CONNECTION WITH THE USE OR PERFORMANCE OF THIS SOFTWARE.
.\"
.Dd $Mdocdate: June 4 2013 $
.Dt PCI_CONF_READ 9
.Os
.Sh NAME
.Nm pci_make_tag ,
.Nm pci_decompose_tag ,
.Nm pci_conf_read ,
.Nm pci_conf_write
.Nd PCI config space manipulation functions
.Sh SYNOPSIS
.In alpha/pci/pci_machdep.h
.In i386/pci/pci_machdep.h
.In powerpc/pci/pci_machdep.h
.In sgi/pci/pci_machdep.h
.In machine/pci_machdep.h
.Ft pcitag_t
.Fn pci_make_tag "pci_chipset_tag_t pc" "int bus" "int dev" "int func"
.Ft void
.Fn pci_decompose_tag "pci_chipset_tag_t pc" "pcitag_t tag" "int *busp" \
"int *devp" "int *funcp"
.Ft pcireg_t
.Fn pci_conf_read "pci_chipset_tag_t pc" "pcitag_t tag" "int reg"
.Ft void
.Fn pci_conf_write "pci_chipset_tag_t pc" "pcitag_t tag" "int reg" \
"pcireg_t val"
.Sh DESCRIPTION
These functions provide a way to access PCI configuration space.
.Pp
The following types are defined in the machine dependent include file
.In pci_machdep.h .
.Pp
.Bl -tag -width pci_chipset_tag_t -offset indent -compact
.It pci_chipset_tag_t
a PCI chipset descriptor;
.It pcitag_t
a PCI device tag;
.It pcireg_t
a PCI register datum.
.El
.Pp
In order to access PCI configuration space, a device tag shall be made using
.Nm pci_make_tag
given the PCI chipset tag
.Ar pc
and the device specification in a tuple of
.Ar bus ,
.Ar device ,
.Ar function .
The PCI tag composition is a PCI chipset dependent operation
although often as simple as a shift and logical OR combination.
.Pp
The
.Nm pci_decompose_tag
provides a reverse operation.
Once a tag is composed, it is possible to perform configuration
space read and write with
.Nm pci_conf_read
and
.Nm pci_conf_write ,
respectively.
Access to PCI configuration space is only provided for whole
.Nm pcireg_t
items, which is usually a 32-bit integer.
Access to non-existent PCI devices do not (or should not) generate
any kinds of faults or interruptions and thus allow for an easy device
scanning by cycling through all possible device and function numbers
for a given bus.
.Pp
Below is an overview of defined PCI configuration space registers for
devices:
.Bl -tag -width 0xff -offset indent
.It 0x00
Vendor (lower word) and Product (higher word) identification
(see
.Pa /sys/dev/pci/pcidevs
for a comprehensive list).
.It 0x04
Commands and Status register.
.It 0x08
PCI device's class and subclass IDs.
See
.Pa /sys/dev/pci/pcireg.h
for PCI_CLASS_* and PCI_SUBCLASS_* definitions.
.It 0x0c
Specify (low byte to high): cache line size, PCI latency timer, header type,
and BIST.
.It 0x10 - 0x28
Base address registers for I/O and memory space mapped registers.
.It 0x28
CardBus CIS register.
.It 0x2c
Similar to 0x00 register's definitions for a subsystem identification.
.It 0x34
A pointer to the capabilities list.
Each item is an offset in the configuration space itself.
.It 0x3c
Interrupt line and pin numbers.
.El
.Sh SEE ALSO
.Xr cardbus 4 ,
.Xr pci 4 ,
.Xr pci_intr_map 9
.Sh HISTORY
These functions first appeared in
.Ox 1.2 .
.\" .Sh AUTHORS
@


1.11
log
@Replace old-fashioned .Fd by new-fangled .In for #include lines.
Diff from Jan Klemkow <j dot klemkow at wemelug dot de> on tech@@.
No objection from jmc@@ against this type of change.
@
text
@d1 1
a1 1
.\"	$OpenBSD: pci_conf_read.9,v 1.10 2008/01/26 23:07:55 jmc Exp $
d18 1
a18 1
.Dd $Mdocdate: January 26 2008 $
d47 1
a47 1
.Aq Pa pci_machdep.h .
@


1.10
log
@the kids want I/O;
@
text
@d1 1
a1 1
.\"	$OpenBSD: pci_conf_read.9,v 1.9 2007/08/02 07:13:27 jmc Exp $
d18 1
a18 1
.Dd $Mdocdate: August 2 2007 $
d28 5
a32 5
.Fd #include <alpha/pci/pci_machdep.h>
.Fd #include <i386/pci/pci_machdep.h>
.Fd #include <powerpc/pci/pci_machdep.h>
.Fd #include <sgi/pci/pci_machdep.h>
.Fd #include <machine/pci_machdep.h>
@


1.9
log
@more cats removal;
@
text
@d1 1
a1 1
.\"	$OpenBSD: pci_conf_read.9,v 1.8 2007/05/31 19:20:00 jmc Exp $
d18 1
a18 1
.Dd $Mdocdate$
d105 1
a105 1
Base address registers for IO and memory space mapped registers.
@


1.8
log
@convert to new .Dd format;
@
text
@d1 1
a1 1
.\"	$OpenBSD: pci_conf_read.9,v 1.7 2007/05/12 16:38:10 sobrado Exp $
a29 1
.Fd #include <cats/pci/pci_machdep.h>
@


1.7
log
@use the right capitalization for `CardBus'

ok jmc@@
@
text
@d1 1
a1 1
.\"	$OpenBSD: pci_conf_read.9,v 1.6 2005/11/15 15:24:43 jmc Exp $
d18 1
a18 1
.Dd November 20, 2005
@


1.6
log
@.Xr pci_intr_map 9
@
text
@d1 1
a1 1
.\"	$OpenBSD: pci_conf_read.9,v 1.5 2005/11/15 00:26:43 jmc Exp $
d108 1
a108 1
Cardbus CIS register.
@


1.5
log
@various tweaks;
@
text
@d1 1
a1 1
.\"	$OpenBSD: pci_conf_read.9,v 1.4 2005/11/14 17:11:53 mickey Exp $
d119 2
a120 1
.Xr pci 4
@


1.4
log
@pci apaprently came in 1.2!
@
text
@d1 1
a1 1
.\"	$OpenBSD: pci_conf_read.9,v 1.3 2005/11/14 16:42:42 mickey Exp $
d19 1
a19 1
.Dt pci_conf_read 9
d23 1
d45 1
a45 1
These functions provide a way for accessing PCI configuration space.
d47 4
a50 4
The following types are defined in the MD include
.Pa Aq pci_machdep.h
file:
.Bl -tag -width pci_chipset_tag_t -offset indent
d59 1
a59 1
In order to access PCI configuration space a device tag shall be made using
d67 3
a69 2
The PCI tag composition is a PCI chipset dependant operation
although often as simple as shift and logical OR combination.
d72 2
a73 2
provides a reverse opration.
Having a tag composed now it is possible to perform configuration
d77 1
a77 1
.Nm pci_conf_write
d81 2
a82 2
items that is usually a 32-bit integer.
Accesses to non-existant PCI devices do not (or should not) generate
d91 1
a91 1
Vendor (lower word) and Product (higher word) identification.
d94 1
a94 1
for a comprehensive list)
d98 1
a98 1
PCI device's class and subclass ids.
d103 1
a103 1
Specify (low byte to high): cache line size, PCI lattency timer, header type
a116 1
.Pp
d119 1
a119 1
.Xr pci 4 .
@


1.3
log
@add pci_decompose_tag()
@
text
@d1 1
a1 1
.\"	$OpenBSD: pci_conf_read.9,v 1.2 2005/11/14 16:35:33 mickey Exp $
d119 3
a121 1
.\" .Sh HISTORY
@


1.2
log
@oops. proper .dt
@
text
@d1 1
a1 1
.\"	$OpenBSD: pci_conf_read.9,v 1.1 2005/11/14 14:30:21 mickey Exp $
d35 3
d68 3
@


1.1
log
@a quick page for pci_conf_read/write/make_tag
@
text
@d1 1
a1 1
.\"	$OpenBSD$
d19 1
a19 1
.Dt BUS_SPACE 9
@

