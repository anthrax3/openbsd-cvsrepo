head	1.29;
access;
symbols
	OPENBSD_6_1_BASE:1.29
	OPENBSD_6_0:1.25.0.8
	OPENBSD_6_0_BASE:1.25
	OPENBSD_5_9:1.25.0.4
	OPENBSD_5_9_BASE:1.25
	OPENBSD_5_8:1.25.0.6
	OPENBSD_5_8_BASE:1.25
	OPENBSD_5_7:1.25.0.2
	OPENBSD_5_7_BASE:1.25
	OPENBSD_5_6:1.24.0.4
	OPENBSD_5_6_BASE:1.24
	OPENBSD_5_5:1.23.0.14
	OPENBSD_5_5_BASE:1.23
	OPENBSD_5_4:1.23.0.10
	OPENBSD_5_4_BASE:1.23
	OPENBSD_5_3:1.23.0.8
	OPENBSD_5_3_BASE:1.23
	OPENBSD_5_2:1.23.0.6
	OPENBSD_5_2_BASE:1.23
	OPENBSD_5_1_BASE:1.23
	OPENBSD_5_1:1.23.0.4
	OPENBSD_5_0:1.23.0.2
	OPENBSD_5_0_BASE:1.23
	OPENBSD_4_9:1.22.0.8
	OPENBSD_4_9_BASE:1.22
	OPENBSD_4_8:1.22.0.6
	OPENBSD_4_8_BASE:1.22
	OPENBSD_4_7:1.22.0.2
	OPENBSD_4_7_BASE:1.22
	OPENBSD_4_6:1.22.0.4
	OPENBSD_4_6_BASE:1.22
	OPENBSD_4_5:1.21.0.8
	OPENBSD_4_5_BASE:1.21
	OPENBSD_4_4:1.21.0.6
	OPENBSD_4_4_BASE:1.21
	OPENBSD_4_3:1.21.0.4
	OPENBSD_4_3_BASE:1.21
	OPENBSD_4_2:1.21.0.2
	OPENBSD_4_2_BASE:1.21
	OPENBSD_4_1:1.19.0.4
	OPENBSD_4_1_BASE:1.19
	OPENBSD_4_0:1.19.0.2
	OPENBSD_4_0_BASE:1.19
	OPENBSD_3_9:1.17.0.4
	OPENBSD_3_9_BASE:1.17
	OPENBSD_3_8:1.17.0.2
	OPENBSD_3_8_BASE:1.17
	OPENBSD_3_7:1.15.0.6
	OPENBSD_3_7_BASE:1.15
	OPENBSD_3_6:1.15.0.4
	OPENBSD_3_6_BASE:1.15
	OPENBSD_3_5:1.15.0.2
	OPENBSD_3_5_BASE:1.15
	OPENBSD_3_4:1.14.0.6
	OPENBSD_3_4_BASE:1.14
	OPENBSD_3_3:1.14.0.4
	OPENBSD_3_3_BASE:1.14
	OPENBSD_3_2:1.14.0.2
	OPENBSD_3_2_BASE:1.14
	OPENBSD_3_1:1.13.0.4
	OPENBSD_3_1_BASE:1.13
	OPENBSD_3_0:1.13.0.2
	OPENBSD_3_0_BASE:1.13
	OPENBSD_2_9:1.10.0.2
	OPENBSD_2_9_BASE:1.10
	OPENBSD_2_8:1.9.0.2
	OPENBSD_2_8_BASE:1.9
	OPENBSD_2_7:1.8.0.2
	OPENBSD_2_7_BASE:1.8;
locks; strict;
comment	@.\" @;


1.29
date	2016.09.28.17.58.17;	author jmc;	state Exp;
branches;
next	1.28;
commitid	s9dobTTpijRmGfMZ;

1.28
date	2016.09.28.17.54.01;	author jmc;	state Exp;
branches;
next	1.27;
commitid	i6GJabM7mBCx5iGv;

1.27
date	2016.09.18.15.05.02;	author jmc;	state Exp;
branches;
next	1.26;
commitid	QA4a0Ig6oWUvL4fB;

1.26
date	2016.09.18.14.28.05;	author deraadt;	state Exp;
branches;
next	1.25;
commitid	jG8VZuxIYy3qe4Ce;

1.25
date	2014.10.09.04.23.04;	author tedu;	state Exp;
branches;
next	1.24;
commitid	OstWD6HKwApVStAo;

1.24
date	2014.07.14.09.21.04;	author ajacoutot;	state Exp;
branches;
next	1.23;
commitid	ZS2bkZQN85bChvhG;

1.23
date	2011.06.24.19.47.48;	author naddy;	state Exp;
branches;
next	1.22;

1.22
date	2009.05.09.13.45.28;	author sthen;	state Exp;
branches;
next	1.21;

1.21
date	2007.06.01.16.56.26;	author jmc;	state Exp;
branches;
next	1.20;

1.20
date	2007.05.31.19.19.58;	author jmc;	state Exp;
branches;
next	1.19;

1.19
date	2006.08.19.07.51.25;	author jmc;	state Exp;
branches;
next	1.18;

1.18
date	2006.03.25.08.28.45;	author jmc;	state Exp;
branches;
next	1.17;

1.17
date	2005.05.12.08.16.06;	author jmc;	state Exp;
branches;
next	1.16;

1.16
date	2005.04.19.07.28.34;	author jmc;	state Exp;
branches;
next	1.15;

1.15
date	2004.01.08.10.56.07;	author jmc;	state Exp;
branches;
next	1.14;

1.14
date	2002.07.30.00.11.36;	author nordin;	state Exp;
branches;
next	1.13;

1.13
date	2001.06.28.10.09.49;	author hugh;	state Exp;
branches;
next	1.12;

1.12
date	2001.05.30.03.24.16;	author millert;	state Exp;
branches;
next	1.11;

1.11
date	2001.05.01.18.31.43;	author aaron;	state Exp;
branches;
next	1.10;

1.10
date	2001.03.11.05.48.26;	author aaron;	state Exp;
branches;
next	1.9;

1.9
date	2000.06.29.18.12.42;	author hugh;	state Exp;
branches;
next	1.8;

1.8
date	2000.04.27.00.36.01;	author deraadt;	state Exp;
branches;
next	1.7;

1.7
date	2000.03.19.19.25.37;	author aaron;	state Exp;
branches;
next	1.6;

1.6
date	2000.02.27.04.59.10;	author hugh;	state Exp;
branches;
next	1.5;

1.5
date	2000.02.27.04.29.44;	author hugh;	state Exp;
branches;
next	1.4;

1.4
date	2000.02.14.15.36.04;	author aaron;	state Exp;
branches;
next	1.3;

1.3
date	2000.02.14.15.25.57;	author aaron;	state Exp;
branches;
next	1.2;

1.2
date	2000.01.10.07.18.50;	author hugh;	state Exp;
branches;
next	1.1;

1.1
date	2000.01.08.01.55.33;	author hugh;	state Exp;
branches;
next	;


desc
@@


1.29
log
@group the sysctls;
@
text
@.\"     $OpenBSD: securelevel.7,v 1.28 2016/09/28 17:54:01 jmc Exp $
.\"
.\" Copyright (c) 2000 Hugh Graham
.\"
.\" Redistribution and use in source and binary forms, with or without
.\" modification, are permitted provided that the following conditions
.\" are met:
.\" 1. Redistributions of source code must retain the above copyright
.\"    notice, this list of conditions and the following disclaimer.
.\" 2. Redistributions in binary form must reproduce the above copyright
.\"    notice, this list of conditions and the following disclaimer in the
.\"    documentation and/or other materials provided with the distribution.
.\"
.\" THIS SOFTWARE IS PROVIDED ``AS IS'' AND ANY EXPRESS OR IMPLIED
.\" WARRANTIES, INCLUDING, BUT NOT LIMITED TO, IMPLIED WARRANTIES OF
.\" MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE ARE DISCLAIMED.
.\" IN NO EVENT SHALL THE AUTHOR OR CONTRIBUTORS BE LIABLE FOR ANY DIRECT,
.\" INDIRECT, INCIDENTAL, SPECIAL, EXEMPLARY, OR CONSEQUENTIAL DAMAGES
.\" (INCLUDING, BUT NOT LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR
.\" SERVICES; LOSS OF USE, DATA, OR PROFITS; OR BUSINESS INTERRUPTION)
.\" HOWEVER CAUSED AND ON ANY THEORY OF LIABILITY, WHETHER IN CONTRACT,
.\" STRICT LIABILITY, OR TORT (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING
.\" IN ANY WAY OUT OF THE USE OF THIS SOFTWARE, EVEN IF ADVISED OF THE
.\" POSSIBILITY OF SUCH DAMAGE.
.\"
.Dd $Mdocdate: September 28 2016 $
.Dt SECURELEVEL 7
.Os
.Sh NAME
.Nm securelevel
.Nd securelevel and its effects
.Sh DESCRIPTION
The
.Ox
kernel provides four levels of system security:
.Bl -tag -width flag
.It \&-1 Em Permanently insecure mode
.Bl -hyphen -compact
.It
.Xr init 8
will not attempt to raise the securelevel
.It
may only be set with
.Xr sysctl 8
while the system is insecure
.It
otherwise identical to securelevel 0
.El
.It \ 0 Em Insecure mode
.Bl -hyphen -compact
.It
used during bootstrapping and while the system is single-user
.It
all devices may be read or written subject to their permissions
.It
system file flags may be cleared with
.Xr chflags 2
.El
.It \ 1 Em Secure mode
.Bl -hyphen -compact
.It
default mode when system is multi-user
.It
securelevel may no longer be lowered except by init
.It
.Pa /dev/mem
and
.Pa /dev/kmem
may not be written to
.It
raw disk devices of mounted file systems are read-only
.It
system immutable and append-only file flags may not be removed
.It
the
.Va fs.posix.setuid ,
.Va hw.allowpowerdown ,
.Va kern.allowkmem ,
.Va net.inet.ip.sourceroute ,
and
.Va machdep.kbdreset
.Xr sysctl 8
variables may not be changed
.It
the
.Va ddb.console ,
.Va ddb.panic ,
and
.Va machdep.allowaperture
.Xr sysctl 8
variables may not be raised
.It
.Xr gpioctl 8
may only access GPIO pins configured at system startup
.El
.It \ 2 Em Highly secure mode
.Bl -hyphen -compact
.It
all effects of securelevel 1
.It
raw disk devices are always read-only whether mounted or not
.It
.Xr settimeofday 2
and
.Xr clock_settime 2
may not set the time backwards or close to overflow
.It
.Xr pf 4
filter and NAT rules may not be altered
.El
.El
.Pp
Securelevel provides convenient means of
.Dq locking down
a system to a degree suited to its environment.
It is normally set at boot by
.Xr rc 8 ,
or the superuser may raise securelevel at any time by modifying the
.Va kern.securelevel
.Xr sysctl 8
variable.
However, only
.Xr init 8
may lower it once the system has entered secure mode.
.Pp
Highly secure mode may seem Draconian, but is intended as a last line of
defence should the superuser account be compromised.
Its effects preclude
circumvention of file flags by direct modification of a raw disk device,
or erasure of a file system by means of
.Xr newfs 8 .
Further, it can limit the potential damage of a compromised
.Dq firewall
by prohibiting the modification of packet filter rules.
Preventing
the system clock from being set backwards aids in post-mortem analysis
and helps ensure the integrity of logs.
Precision timekeeping is not
affected because the clock may still be slowed.
.Pp
Because securelevel can be modified with the in-kernel debugger
.Xr ddb 4 ,
a convenient means of locking it off (if present) is provided
at securelevels 1 and 2.
This is accomplished by setting
.Va ddb.console
and
.Va ddb.panic
to 0 with the
.Xr sysctl 8
utility.
.Sh FILES
.Bl -tag -width /etc/rc.securelevel -compact
.It Pa /etc/rc.securelevel
commands that run before the security level changes
.El
.Sh SEE ALSO
.Xr init 8 ,
.Xr rc 8 ,
.Xr sysctl 8
.Sh HISTORY
The
.Nm
manual page first appeared in
.Ox 2.6 .
.Sh BUGS
The list of securelevel's effects may not be comprehensive.
@


1.28
log
@document kern.allowkmem; reminded by deraadt
@
text
@d1 1
a1 1
.\"     $OpenBSD: securelevel.7,v 1.27 2016/09/18 15:05:02 jmc Exp $
d26 1
a26 1
.Dd $Mdocdate: September 18 2016 $
d76 5
a80 15
.Va fs.posix.setuid
.Xr sysctl 8
variable may not be changed
.It
the
.Va hw.allowpowerdown
.Xr sysctl 8
variable may not be changed
.It
the
.Va net.inet.ip.sourceroute
.Xr sysctl 8
variable may not be changed
.It
the
d83 1
a83 1
variable may not be changed
d86 2
a87 6
.Va kern.allowkmem
.Xr sysctl 8
variable may not be changed
.It
the
.Va ddb.console
d89 1
a89 1
.Va ddb.panic
a91 5
.It
the
.Va machdep.allowaperture
.Xr sysctl 8
variable may not be raised
@


1.27
log
@there's no reason to point readers to options(4) now;
@
text
@d1 1
a1 1
.\"     $OpenBSD: securelevel.7,v 1.26 2016/09/18 14:28:05 deraadt Exp $
d92 5
@


1.26
log
@option INSECURE is obsolete
@
text
@d1 1
a1 1
.\"     $OpenBSD: securelevel.7,v 1.25 2014/10/09 04:23:04 tedu Exp $
d26 1
a26 1
.Dd $Mdocdate: October 9 2014 $
a171 1
.Xr options 4 ,
@


1.25
log
@no modules
@
text
@d1 1
a1 1
.\"     $OpenBSD: securelevel.7,v 1.24 2014/07/14 09:21:04 ajacoutot Exp $
d26 1
a26 1
.Dd $Mdocdate: July 14 2014 $
a138 3
A kernel built with
.Cm option INSECURE
in the config file will default to permanently insecure mode.
@


1.24
log
@No more "securelevel" variable.
@
text
@d1 1
a1 1
.\"     $OpenBSD: securelevel.7,v 1.23 2011/06/24 19:47:48 naddy Exp $
d26 1
a26 1
.Dd $Mdocdate: June 24 2011 $
a73 2
.It
kernel modules may not be loaded or unloaded
@


1.23
log
@machdep.kbdreset enables a shutdown by Ctrl-Alt-Del on amd64 and
i386.  Stop abusing it on other archs for controling a shutdown by
pressing the soft power button:

* Add a MI sysctl hw.allowpowerdown; if set to 1 (the default) it
  allows a power button shutdown.
* Make acpi(4)/acpibtn(4) honor hw.allowpowerdown.
* Switch the various power button intercepts on landisk, sgi, sparc64
  and zaurus over to hw.allowpowerdown.
* Garbage collect the machdep.kbdreset sysctl on all archs other than
  amd64 and i386.

ok miod@@
@
text
@d1 1
a1 1
.\"     $OpenBSD: securelevel.7,v 1.22 2009/05/09 13:45:28 sthen Exp $
d26 1
a26 1
.Dd $Mdocdate: May 9 2009 $
d132 3
a134 3
It is normally set at boot via the
.Xr rc.securelevel 8
script, or the superuser may raise securelevel at any time by modifying the
@


1.22
log
@- mention that configuring new GPIO pins is locked out with securelevel>0,
discussed with jmc@@ and Marc Balmer
- clear out some .Xr from SEE ALSO that are also in the main text and not
really necessary to repeat, req by jmc@@.

ok jmc.
@
text
@d1 1
a1 1
.\"     $OpenBSD: securelevel.7,v 1.21 2007/06/01 16:56:26 jmc Exp $
d26 1
a26 1
.Dd $Mdocdate: June 1 2007 $
d79 5
@


1.21
log
@enforce DESCRIPTION-after-SYNOPSIS order, to appease man -h;
@
text
@d1 1
a1 1
.\"     $OpenBSD: securelevel.7,v 1.20 2007/05/31 19:19:58 jmc Exp $
d26 1
a26 1
.Dd $Mdocdate: May 31 2007 $
d56 2
a57 1
system file flags may be cleared
d103 3
a171 3
.Xr chflags 2 ,
.Xr settimeofday 2 ,
.Xr mem 4 ,
@


1.20
log
@convert to new .Dd format;
@
text
@d1 1
a1 1
.\"     $OpenBSD: securelevel.7,v 1.19 2006/08/19 07:51:25 jmc Exp $
d26 1
a26 1
.Dd $Mdocdate$
d32 1
a32 1
.Sh SYNOPSIS
d119 1
a119 1
.Sh DESCRIPTION
@


1.19
log
@document machdep.aperture; pointed out by andrew smith
ok deraadt
@
text
@d1 1
a1 1
.\"     $OpenBSD: securelevel.7,v 1.18 2006/03/25 08:28:45 jmc Exp $
d26 1
a26 1
.Dd January 4, 2000
@


1.18
log
@ddb.{console,panic} cannot be raised at securelevel 1 either;

from nicholas marriott;
ok miod ray
@
text
@d1 1
a1 1
.\"     $OpenBSD: securelevel.7,v 1.17 2005/05/12 08:16:06 jmc Exp $
d97 5
@


1.17
log
@change pfctl reference to pf, since programs like authpf also attempt to
alter rulesets, not just pfctl interface;

from tamas tevesz;
@
text
@d1 1
a1 1
.\"     $OpenBSD: securelevel.7,v 1.16 2005/04/19 07:28:34 jmc Exp $
d90 7
a111 7
.It
the
.Va ddb.console
and
.Va ddb.panic
.Xr sysctl 8
variables may not be raised
d149 1
a149 1
on highly secure systems.
@


1.16
log
@- some sysctls may not be lowered either
- document machdep.kbdreset

diff from fgsch@@
ok deraadt@@
@
text
@d1 1
a1 1
.\"     $OpenBSD: securelevel.7,v 1.15 2004/01/08 10:56:07 jmc Exp $
d103 2
a104 2
.Xr pfctl 8
may no longer alter filter or nat rules
@


1.15
log
@document that sysctls fs.posix.setuid and net.inet.ip.sourceroute may not
be set when securelevel > 0;

the latter from Ryan Leslie (PR 3631);
@
text
@d1 1
a1 1
.\"     $OpenBSD: securelevel.7,v 1.14 2002/07/30 00:11:36 nordin Exp $
d79 1
a79 1
variable may not be raised
d84 6
a89 1
variable may not be raised
@


1.14
log
@Clarify time handling at securelevel 2. Idea from mpech@@ ok millert@@
@
text
@d1 1
a1 1
.\"     $OpenBSD: securelevel.7,v 1.13 2001/06/28 10:09:49 hugh Exp $
d75 10
@


1.13
log
@Restore reference to packet filter.
@
text
@d1 1
a1 1
.\"     $OpenBSD: securelevel.7,v 1.12 2001/05/30 03:24:16 millert Exp $
d84 3
a86 1
may not set the time backwards
@


1.12
log
@comment out references to ipf to be replaced in the future with whatever packet filter we end up using
@
text
@d1 1
a1 1
.\"     $OpenBSD: securelevel.7,v 1.11 2001/05/01 18:31:43 aaron Exp $
d85 3
a87 6
.\"XXX - replace with ipfw when it is in-tree
.\".It
.\".Xr ipf 8
.\"and
.\".Xr ipnat 8
.\"rules may not be altered
@


1.11
log
@Sort SEE ALSO entries; mpech@@prosoft.org.lv
@
text
@d1 1
a1 1
.\"     $OpenBSD: securelevel.7,v 1.10 2001/03/11 05:48:26 aaron Exp $
d85 6
a90 5
.It
.Xr ipf 8
and
.Xr ipnat 8
rules may not be altered
@


1.10
log
@Give /etc/rc.securelevel the same FILES-style description as in init(8).
@
text
@d1 1
a1 1
.\"     $OpenBSD: securelevel.7,v 1.9 2000/06/29 18:12:42 hugh Exp $
d150 1
a151 1
.Xr mem 4 ,
@


1.9
log
@escape -1 with \& as per mdoc.samples
@
text
@d1 1
a1 1
.\"     $OpenBSD: securelevel.7,v 1.8 2000/04/27 00:36:01 deraadt Exp $
d143 1
a143 1
.Bl -tag -compact
d145 1
@


1.8
log
@have mem(4) talk about securelevel(7)
@
text
@d1 1
a1 1
.\"     $OpenBSD: securelevel.7,v 1.7 2000/03/19 19:25:37 aaron Exp $
d37 1
a37 1
.It -1 Em Permanently insecure mode
@


1.7
log
@Various cleanups.
@
text
@d1 1
a1 1
.\"     $OpenBSD: securelevel.7,v 1.6 2000/02/27 04:59:10 hugh Exp $
d150 1
@


1.6
log
@document ddb securelevel semantics
@
text
@d1 1
a1 1
.\"     $OpenBSD: securelevel.7,v 1.5 2000/02/27 04:29:44 hugh Exp $
d70 1
a70 1
raw disk devices of mounted filesystems are read-only
d102 2
a103 2
a system to a degree suited to its environment. It is normally set at
boot via the
d108 2
a109 1
variable. However, only
d111 3
a113 2
may lower it once the system has entered secure mode. A kernel built with
.Dq option INSECURE
d117 2
a118 1
defence should the superuser account be compromised. Its effects preclude
d120 1
a120 1
or erasure of a filesystem by means of
d124 2
a125 1
by prohibiting the modification of packet filter rules. Preventing
d127 2
a128 1
and helps ensure the integrity of logs. Precision timekeeping is not
d134 2
a135 1
on highly secure systems. This is accomplished by setting
a152 2
.Sh BUGS
The list of securelevel's effects may not be comprehensive.
d158 2
a159 1

@


1.5
log
@be clear about raw disk devs
@
text
@d1 1
a1 1
.\"     $OpenBSD: securelevel.7,v 1.4 2000/02/14 15:36:04 aaron Exp $
a42 2
otherwise identical to securelevel 0
.It
d46 2
d90 7
d125 11
@


1.4
log
@Kill trailing whitespace.
@
text
@d1 1
a1 1
.\"     $OpenBSD: securelevel.7,v 1.3 2000/02/14 15:25:57 aaron Exp $
a64 2
system immutable and append-only file flags may not be removed
.It
d69 4
@


1.3
log
@Re-order SEE ALSO section.
@
text
@d1 1
a1 1
.\"     $OpenBSD: securelevel.7,v 1.2 2000/01/10 07:18:50 hugh Exp $
d109 1
a109 1
.Xr newfs 8 . 
@


1.2
log
@nits & style
@
text
@d1 1
a1 1
.\"     $OpenBSD: securelevel.7,v 1.1 2000/01/08 01:55:33 hugh Exp $
d121 3
d126 1
a126 4
.Xr sysctl 8 ,
.Xr chflags 2 ,
.Xr settimeofday 2 ,
.Xr options 4
@


1.1
log
@Give securelevel its own manpage and enable.
@
text
@d1 1
a1 1
.\"     $OpenBSD: securelevel.7,v 1.0 2000/01/04 21:38:54 hugh Exp $
d37 3
a39 1
.It -1 Em "Permanently insecure mode" .
d41 5
a45 1
will not attempt to raise the securelevel. May be set via
d47 12
a58 9
while the system is insecure, or by building a kernel with
.Dq option INSECURE
in the config file.
.It 0 Em "Insecure mode" .
Used during bootstrapping and while the system is single user.
System file flags may be cleared, and all devices may be read or
written subject to their permissions.
.It 1 Em "Secure mode" .
Default mode when system is multiuser:
d61 2
d74 1
a74 2
.It 2 Em "Highly secure mode" .
All effects of securelevel 1, plus:
d77 3
a79 1
disk devices are always read-only whether mounted or not
d87 1
a87 1
rulesets may not be changed
d91 1
a91 1
Securelevel provides controlled means of
d101 3
a103 1
may lower it once the system has entered secure mode.
d105 4
a108 5
.Em Highly secure mode
may seem Draconian, but is intended as a last line of defence should the
superuser account be compromised. Its effects preclude circumvention of
file flags by direct modification of a raw disk device, or erasure of a
filesystem by means of
d114 1
a114 1
and helps ensure the intergrity of logs. Precision timekeeping is not
@

