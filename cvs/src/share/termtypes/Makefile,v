head	1.25;
access;
symbols
	OPENBSD_6_1:1.25.0.2
	OPENBSD_6_1_BASE:1.25
	OPENBSD_6_0:1.24.0.4
	OPENBSD_6_0_BASE:1.24
	OPENBSD_5_9:1.24.0.2
	OPENBSD_5_9_BASE:1.24
	OPENBSD_5_8:1.22.0.20
	OPENBSD_5_8_BASE:1.22
	OPENBSD_5_7:1.22.0.12
	OPENBSD_5_7_BASE:1.22
	OPENBSD_5_6:1.22.0.16
	OPENBSD_5_6_BASE:1.22
	OPENBSD_5_5:1.22.0.14
	OPENBSD_5_5_BASE:1.22
	OPENBSD_5_4:1.22.0.10
	OPENBSD_5_4_BASE:1.22
	OPENBSD_5_3:1.22.0.8
	OPENBSD_5_3_BASE:1.22
	OPENBSD_5_2:1.22.0.6
	OPENBSD_5_2_BASE:1.22
	OPENBSD_5_1_BASE:1.22
	OPENBSD_5_1:1.22.0.4
	OPENBSD_5_0:1.22.0.2
	OPENBSD_5_0_BASE:1.22
	OPENBSD_4_9:1.17.0.6
	OPENBSD_4_9_BASE:1.17
	OPENBSD_4_8:1.17.0.4
	OPENBSD_4_8_BASE:1.17
	OPENBSD_4_7:1.17.0.2
	OPENBSD_4_7_BASE:1.17
	OPENBSD_4_6:1.16.0.6
	OPENBSD_4_6_BASE:1.16
	OPENBSD_4_5:1.16.0.2
	OPENBSD_4_5_BASE:1.16
	OPENBSD_4_4:1.15.0.36
	OPENBSD_4_4_BASE:1.15
	OPENBSD_4_3:1.15.0.34
	OPENBSD_4_3_BASE:1.15
	OPENBSD_4_2:1.15.0.32
	OPENBSD_4_2_BASE:1.15
	OPENBSD_4_1:1.15.0.30
	OPENBSD_4_1_BASE:1.15
	OPENBSD_4_0:1.15.0.28
	OPENBSD_4_0_BASE:1.15
	OPENBSD_3_9:1.15.0.26
	OPENBSD_3_9_BASE:1.15
	OPENBSD_3_8:1.15.0.24
	OPENBSD_3_8_BASE:1.15
	OPENBSD_3_7:1.15.0.22
	OPENBSD_3_7_BASE:1.15
	OPENBSD_3_6:1.15.0.20
	OPENBSD_3_6_BASE:1.15
	OPENBSD_3_5:1.15.0.18
	OPENBSD_3_5_BASE:1.15
	OPENBSD_3_4:1.15.0.16
	OPENBSD_3_4_BASE:1.15
	OPENBSD_3_3:1.15.0.14
	OPENBSD_3_3_BASE:1.15
	OPENBSD_3_2:1.15.0.12
	OPENBSD_3_2_BASE:1.15
	OPENBSD_3_1:1.15.0.10
	OPENBSD_3_1_BASE:1.15
	OPENBSD_3_0:1.15.0.8
	OPENBSD_3_0_BASE:1.15
	OPENBSD_2_9:1.15.0.6
	OPENBSD_2_9_BASE:1.15
	OPENBSD_2_8:1.15.0.4
	OPENBSD_2_8_BASE:1.15
	OPENBSD_2_7:1.15.0.2
	OPENBSD_2_7_BASE:1.15
	OPENBSD_2_6:1.10.0.4
	OPENBSD_2_6_BASE:1.10
	OPENBSD_2_5:1.10.0.2
	OPENBSD_2_5_BASE:1.10;
locks; strict;
comment	@# @;


1.25
date	2016.09.25.17.43.11;	author natano;	state Exp;
branches;
next	1.24;
commitid	GjsQAfxYhTdhMc31;

1.24
date	2015.12.03.11.30.46;	author nicm;	state Exp;
branches;
next	1.23;
commitid	LUYaHyh9PKY7ngeB;

1.23
date	2015.11.21.08.05.27;	author nicm;	state Exp;
branches;
next	1.22;
commitid	zlv9RqJQ7TWBocdx;

1.22
date	2011.07.19.10.20.20;	author millert;	state Exp;
branches;
next	1.21;

1.21
date	2011.07.06.18.53.13;	author nicm;	state Exp;
branches;
next	1.20;

1.20
date	2011.07.06.18.49.08;	author millert;	state Exp;
branches;
next	1.19;

1.19
date	2011.07.05.03.34.30;	author nicm;	state Exp;
branches;
next	1.18;

1.18
date	2011.07.04.21.27.57;	author nicm;	state Exp;
branches;
next	1.17;

1.17
date	2009.10.14.19.52.23;	author nicm;	state Exp;
branches;
next	1.16;

1.16
date	2008.09.02.00.01.34;	author drahn;	state Exp;
branches;
next	1.15;

1.15
date	2000.02.17.19.58.34;	author millert;	state Exp;
branches;
next	1.14;

1.14
date	2000.02.17.18.54.15;	author millert;	state Exp;
branches;
next	1.13;

1.13
date	2000.01.12.16.37.48;	author millert;	state Exp;
branches;
next	1.12;

1.12
date	2000.01.09.06.02.42;	author millert;	state Exp;
branches;
next	1.11;

1.11
date	99.12.12.22.24.59;	author millert;	state Exp;
branches;
next	1.10;

1.10
date	99.03.22.18.53.11;	author millert;	state Exp;
branches;
next	1.9;

1.9
date	99.03.11.07.05.20;	author millert;	state Exp;
branches;
next	1.8;

1.8
date	99.03.05.05.08.31;	author millert;	state Exp;
branches;
next	1.7;

1.7
date	99.03.05.04.47.44;	author tholo;	state Exp;
branches;
next	1.6;

1.6
date	98.12.20.18.58.41;	author millert;	state Exp;
branches;
next	1.5;

1.5
date	98.12.16.19.37.33;	author millert;	state Exp;
branches;
next	1.4;

1.4
date	98.12.07.20.07.21;	author millert;	state Exp;
branches;
next	1.3;

1.3
date	98.12.07.20.01.37;	author millert;	state Exp;
branches;
next	1.2;

1.2
date	98.12.07.19.53.41;	author millert;	state Exp;
branches;
next	1.1;

1.1
date	98.12.07.18.23.36;	author millert;	state Exp;
branches;
next	;


desc
@@


1.25
log
@Some ownership fixes for /usr/share/.

feedback and tweaks rpe
ok tb
@
text
@#	$OpenBSD: Makefile,v 1.24 2015/12/03 11:30:46 nicm Exp $

MAN=	termcap.5
TIC=	/usr/bin/tic

all: terminfo termcap

terminfo: termtypes.master
	${TIC} -x -o ${.TARGET} ${.ALLSRC}
	@@[ -d ${.TARGET} ] || exit 1

termcap: termtypes.master
	${TIC} -C -x ${.ALLSRC} > ${.TARGET}
	@@[ -s ${.TARGET} ] || exit 1

realinstall:
	${INSTALL} -d -o root -g wheel ${DESTDIR}${BINDIR}/terminfo
	find terminfo -type f -exec \
	     ${INSTALL} -D ${INSTALL_COPY} -o ${BINOWN} -g ${BINGRP} -m 444 \
	     {} ${DESTDIR}${BINDIR}/{} \;
	${INSTALL} ${INSTALL_COPY} -o ${BINOWN} -g ${BINGRP} -m 444 termcap \
	     ${DESTDIR}${BINDIR}/misc/termcap
	ln -fs ${BINDIR}/misc/termcap ${DESTDIR}/etc/termcap
	chown -h root:wheel ${DESTDIR}/etc/termcap

clean:
	rm -f termcap
	rm -rf terminfo

.include <bsd.prog.mk>
@


1.24
log
@Do not build termcap.db and terminfo.db, they are no longer needed.

ok millert
@
text
@d1 1
a1 1
#	$OpenBSD: Makefile,v 1.23 2015/11/21 08:05:27 nicm Exp $
d17 1
d24 1
@


1.23
log
@Install terminfo files into /usr/share/terminfo (as well as
/usr/share/misc/terminfo.db for the moment). ok millert
@
text
@d1 1
a1 3
#	$OpenBSD: Makefile,v 1.22 2011/07/19 10:20:20 millert Exp $
#
# Take termcap/terminfo master file and generate termcap/terminfo .db files
d6 1
a6 8
all: terminfo.db termcap.db terminfo termcap

terminfo.src: termtypes.master
	${TIC} -I -x ${.ALLSRC} | sed -e '/^#/d' -e '/^$$/d' > ${.TARGET}
	@@[ -s ${.TARGET} ] || exit 1

terminfo.db: terminfo.src
	cap_mkdb -i -f terminfo ${.ALLSRC}
a11 7
termcap.src: termcap
	sed -e '/^#/d' -e '/^$$/d' ${.ALLSRC} > ${.TARGET}
	@@[ -s ${.TARGET} ] || exit 1

termcap.db: termcap.src
	cap_mkdb -f termcap ${.ALLSRC}

a19 4
	${INSTALL} ${INSTALL_COPY} -o ${BINOWN} -g ${BINGRP} -m 444 terminfo.db \
	     ${DESTDIR}${BINDIR}/misc/terminfo.db
	${INSTALL} ${INSTALL_COPY} -o ${BINOWN} -g ${BINGRP} -m 444 termcap.db \
	     ${DESTDIR}${BINDIR}/misc/termcap.db
d25 1
a25 1
	rm -f terminfo.src termcap.src terminfo.db termcap.db termcap
@


1.22
log
@Avoid running tic an extra time when stripping the comments from
termcap.  With help from and OK nicm@@
@
text
@d1 1
a1 1
#	$OpenBSD: Makefile,v 1.21 2011/07/06 18:53:13 nicm Exp $
a5 1
CLEANFILES+= terminfo.src termcap.src terminfo.db termcap.db termcap
d8 1
a8 1
all: terminfo.db termcap.db termcap
d17 4
d33 3
d43 4
@


1.21
log
@Remove old warning about upgrading tic and just exit.

ok millert
@
text
@d1 1
a1 1
#	$OpenBSD: Makefile,v 1.20 2011/07/06 18:49:08 millert Exp $
d16 1
a16 1
	cap_mkdb -i -f terminfo terminfo.src
d18 2
a19 2
termcap.src: termtypes.master
	${TIC} -C -x ${.ALLSRC} | sed -e '/^#/d' -e '/^$$/d' > ${.TARGET}
d23 1
a23 1
	cap_mkdb -f termcap termcap.src
@


1.20
log
@No need to change tabset path in termtypes.master, they've all been
normalized to be /usr/share/tabset (except one that was missed).
OK nicm@@
@
text
@d1 1
a1 1
#	$OpenBSD: Makefile,v 1.19 2011/07/05 03:34:30 nicm Exp $
d13 1
a13 5
	@@if [ ! -s ${.TARGET} ]; then \
	    echo ${.TARGET} is zero length!  You need to update ${TIC} ;\
	    rm -f ${.TARGET} ;\
	    exit 1 ;\
	fi
d20 1
a20 5
	@@if [ ! -s ${.TARGET} ]; then \
	    echo ${.TARGET} is zero length!  You need to update ${TIC} ;\
	    rm -f ${.TARGET} ;\
	    exit 1 ;\
	fi
d27 1
@


1.19
log
@Trim comments from termtypes.master before passing through cap_mkdb,
speeds things up a good bit.

ok tedu
@
text
@d1 1
a1 1
#	$OpenBSD: Makefile,v 1.18 2011/07/04 21:27:57 nicm Exp $
d12 1
a12 5
	${TIC} -I -x ${.ALLSRC} | sed \
	    -e 's,/usr/share/lib/tabset,/usr/share/tabset,g' \
	    -e 's,/usr/lib/tabset,/usr/share/tabset,g' \
	    -e '/^#/d' \
	    > ${.TARGET}
d23 1
a23 5
	${TIC} -C -x ${.ALLSRC} | sed \
	    -e 's,/usr/share/lib/tabset,/usr/share/tabset,g' \
	    -e 's,/usr/lib/tabset,/usr/share/tabset,g' \
	    -e '/^#/d' \
	    > ${.TARGET}
d34 1
a34 4
	${TIC} -C -x ${.ALLSRC} | sed \
	    -e 's,/usr/share/lib/tabset,/usr/share/tabset,g' \
	    -e 's,/usr/lib/tabset,/usr/share/tabset,g' \
	    > ${.TARGET}
@


1.18
log
@Nuke map3270 (tn3270 itself died 9 months ago).

ok deraadt
@
text
@d1 1
a1 1
#	$OpenBSD: Makefile,v 1.17 2009/10/14 19:52:23 nicm Exp $
d6 1
a6 1
CLEANFILES+= terminfo.src termcap.src terminfo.db termcap.db
d9 1
a9 1
all: terminfo.db termcap.db
d15 1
d30 1
d41 6
d52 1
a52 1
	${INSTALL} ${INSTALL_COPY} -o ${BINOWN} -g ${BINGRP} -m 444 termcap.src \
@


1.17
log
@Three cleanups:

- ESR no longer maintains termcap/terminfo and the URL in Makefile is dead, so
  remove it;
- remove the tic(1) stdout usage hack which is no longer necessary;
- remove the README file which doesn't have anything useful anymore.

ok millert
@
text
@d1 1
a1 1
#	$OpenBSD: Makefile,v 1.16 2008/09/02 00:01:34 drahn Exp $
a45 2
	${INSTALL} ${INSTALL_COPY} -o ${BINOWN} -g ${BINGRP} -m 444 ${.CURDIR}/map3270 \
	     ${DESTDIR}${BINDIR}/misc/map3270
@


1.16
log
@Use the installed version of tic instead of the newly built version,
The build/upgrade process requires that changes requiring this type of
update be recorded in faq/current.html. ok deraadt@@
@
text
@d1 1
a1 1
#	$OpenBSD: Makefile,v 1.15 2000/02/17 19:58:34 millert Exp $
a3 1
# master: http://www.tuxedo.org/~esr/terminfo/termtypes.master.gz
a19 5
	else case `sed 1q ${.TARGET}` in \
	    Usage*) echo ${.TARGET} is corrupt!  You need to update ${TIC} ;\
		    rm -f ${.TARGET} ;\
		    exit 1 ;;\
	    esac ;\
a33 5
	else case `sed 1q ${.TARGET}` in \
	    Usage*) echo ${.TARGET} is corrupt!  You need to update ${TIC} ;\
		    rm -f ${.TARGET} ;\
		    exit 1 ;;\
	    esac ;\
@


1.15
log
@Be a little bit smarter about locating the in-tree tic binary.
@
text
@d1 1
a1 1
#	$OpenBSD: Makefile,v 1.14 2000/02/17 18:54:15 millert Exp $
d8 1
a61 9

# Use the tic we just built if possible
.if exists(${.CURDIR}/../../usr.bin/tic/${__objdir}/tic)
TIC=	${.CURDIR}/../../usr.bin/tic/${__objdir}/tic
.elif exists(../../usr.bin/tic/tic)
TIC=	../../usr.bin/tic/tic
.else
TIC=	/usr/bin/tic
.endif
@


1.14
log
@Use the version of tic in the build tree, if available.  This will make
it easier for folks upgrading from 2.6.
@
text
@d1 1
a1 1
#	$OpenBSD: Makefile,v 1.13 2000/01/12 16:37:48 millert Exp $
a8 7
# Use the tic we just built if possible
.if exists(../../usr.bin/tic/tic)
TIC=	../../usr.bin/tic/tic
.else
TIC=	/usr/bin/tic
.endif

d61 9
@


1.13
log
@Hack to detect termcap/terminfo files that just contain a usage string.
This is needed because, until 5 minutes ago, tic prints its usage()
to stdout and not stderr so the zero-length termcap check doesn't help
us here.  This hack should be removed after OpenBSD 2.7 is released.
@
text
@d1 1
a1 1
#	$OpenBSD: Makefile,v 1.12 2000/01/09 06:02:42 millert Exp $
d9 7
d19 1
a19 1
	tic -I -x ${.ALLSRC} | sed \
d24 1
a24 1
	    echo ${.TARGET} is zero length!  You need to update /usr/bin/tic ;\
d28 1
a28 1
	    Usage*) echo ${.TARGET} is corrupt!  You need to update /usr/bin/tic ;\
d38 1
a38 1
	tic -C -x ${.ALLSRC} | sed \
d43 1
a43 1
	    echo ${.TARGET} is zero length!  You need to update /usr/bin/tic ;\
d47 1
a47 1
	    Usage*) echo ${.TARGET} is corrupt!  You need to update /usr/bin/tic ;\
@


1.12
log
@Remove the hack to make xterm fit.  Tic with the new termtypes file is
smart enough to do the right thing.

*NOTE* it is a good idea to install a tic linked with the latest
libcurses before building the new termcap/terminfo files.
@
text
@d1 1
a1 1
#	$OpenBSD: Makefile,v 1.11 1999/12/12 22:24:59 millert Exp $
d18 1
d20 5
d37 1
d39 5
@


1.11
log
@Use perl to do /usr/share/lib/tabset -> and /usr/lib/tabset -> /usr/share/tabset
substiution in termcap generation as well as the pruning of unneeded entries
in the xterm entry.  This is only temporary until such time as we can
remove the xterm hack altogether (new termtypes.master coming soon).
@
text
@d1 1
a1 1
#	$OpenBSD: Makefile,v 1.10 1999/03/22 18:53:11 millert Exp $
d12 1
a12 1
	tic -I ${.ALLSRC} | sed \
a23 2
# Note the hack to remove lines betweem the 'xterm' extry and what it includes.
# This exists to prune out some unneeded entries so it is <= 1023 bytes.
d25 3
a27 5
	tic -C ${.ALLSRC} | perl -e \
	    'undef $$/; $$_ = <STDIN>; \
	    s,/usr/share/lib/tabset,/usr/share/tabset,g; \
	    s,/usr/lib/tabset,/usr/share/tabset,g; \
	    s/(\nxterm\|[^\n]+\n)[^#]+(\s+:tc=)/$$1$$2/s; print' \
@


1.10
log
@Add gross ed hack back in so termcap xterm entry < 1024
@
text
@d1 1
a1 1
#	$OpenBSD: Makefile,v 1.9 1999/03/11 07:05:20 millert Exp $
d24 2
a25 1
# Note the disgusting ed hack to remove three lines from xterm
d27 5
a31 3
	tic -C ${.ALLSRC} | sed \
	    -e 's,/usr/share/lib/tabset,/usr/share/tabset,g' \
	    -e 's,/usr/lib/tabset,/usr/share/tabset,g' \
a32 1
	echo "1\n/^xterm|\n\nd\nd\nd\n.\nw\nq\n" | ed - ${.OBJDIR}/termcap.src >/dev/null 2>&1
@


1.9
log
@tell the user exactly what to do when *.src is 0 length
@
text
@d1 1
a1 1
#	$OpenBSD: Makefile,v 1.8 1999/03/05 05:08:31 millert Exp $
d24 1
d30 1
@


1.8
log
@catch 0-len term*.src in case tic messes up
@
text
@d1 1
a1 1
#	$OpenBSD: Makefile,v 1.7 1999/03/05 04:47:44 tholo Exp $
d17 1
a17 1
	    echo ${.TARGET} is zero length! ;\
d30 1
a30 1
	    echo ${.TARGET} is zero length! ;\
@


1.7
log
@Merge cap_mkdb(1) and info_mkdb(1)
@
text
@d1 1
a1 1
#	$OpenBSD: Makefile,v 1.6 1998/12/20 18:58:41 millert Exp $
d15 5
a19 1
	    > terminfo.src
d28 5
a32 1
	    > termcap.src
@


1.6
log
@Evil ed hack not needed as the termcap entry length for xterm is 830 (limit is 1023)
@
text
@d1 1
a1 1
#	$OpenBSD: Makefile,v 1.5 1998/12/16 19:37:33 millert Exp $
d18 1
a18 1
	info_mkdb -f terminfo terminfo.src
@


1.5
log
@Add missing ${INSTALL_COPY}
@
text
@d1 1
a1 1
#	$OpenBSD: Makefile,v 1.4 1998/12/07 20:07:21 millert Exp $
a19 1
# Note the disgusting ed hack to remove three lines from xterm
a24 1
	echo "1\n/^xterm|\n\nd\nd\nd\n.\nw\nq\n" | ed - termcap.src >/dev/null 2>&1
@


1.4
log
@remove bogus CURDIR
@
text
@d1 1
a1 1
#	$OpenBSD: Makefile,v 1.3 1998/12/07 20:01:37 millert Exp $
d36 1
a36 1
	${INSTALL} -c -o ${BINOWN} -g ${BINGRP} -m 444 termcap.src \
d38 1
a38 1
	${INSTALL} -c -o ${BINOWN} -g ${BINGRP} -m 444 ${.CURDIR}/map3270 \
@


1.3
log
@kill OBJDIR sillyness
@
text
@d1 1
a1 1
#	$OpenBSD: Makefile,v 1.2 1998/12/07 19:53:41 millert Exp $
d36 1
a36 1
	${INSTALL} -c -o ${BINOWN} -g ${BINGRP} -m 444 ${.CURDIR}/termcap.src \
@


1.2
log
@disgusting ed hack to remove three lines from xterm termcap entry; should be redone
@
text
@d1 1
a1 1
#	$OpenBSD: Makefile,v 1.1 1998/12/07 18:23:36 millert Exp $
d15 1
a15 1
	    > ${.OBJDIR}/terminfo.src
d18 1
a18 1
	info_mkdb -f terminfo ${.OBJDIR}/terminfo.src
d25 2
a26 2
	    > ${.OBJDIR}/termcap.src
	echo "1\n/^xterm|\n\nd\nd\nd\n.\nw\nq\n" | ed - ${.OBJDIR}/termcap.src >/dev/null 2>&1
d29 1
a29 1
	cap_mkdb -f termcap ${.OBJDIR}/termcap.src
@


1.1
log
@this will replace share/{termcap,terminfo} soon
@
text
@d1 1
a1 1
#	$OpenBSD: Makefile,v 1.2 1997/04/27 20:56:25 millert Exp $
d20 1
d26 1
@

