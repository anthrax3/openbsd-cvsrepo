head	1.41;
access;
symbols
	OPENBSD_6_0:1.41.0.8
	OPENBSD_6_0_BASE:1.41
	OPENBSD_5_9:1.41.0.4
	OPENBSD_5_9_BASE:1.41
	OPENBSD_5_8:1.41.0.6
	OPENBSD_5_8_BASE:1.41
	OPENBSD_5_7:1.41.0.2
	OPENBSD_5_7_BASE:1.41
	OPENBSD_5_6:1.40.0.4
	OPENBSD_5_6_BASE:1.40
	OPENBSD_5_5:1.39.0.12
	OPENBSD_5_5_BASE:1.39
	OPENBSD_5_4:1.39.0.8
	OPENBSD_5_4_BASE:1.39
	OPENBSD_5_3:1.39.0.6
	OPENBSD_5_3_BASE:1.39
	OPENBSD_5_2:1.39.0.4
	OPENBSD_5_2_BASE:1.39
	OPENBSD_5_1_BASE:1.39
	OPENBSD_5_1:1.39.0.2
	OPENBSD_5_0:1.38.0.2
	OPENBSD_5_0_BASE:1.38
	OPENBSD_4_9:1.32.0.2
	OPENBSD_4_9_BASE:1.32
	OPENBSD_4_8:1.30.0.2
	OPENBSD_4_8_BASE:1.30
	OPENBSD_4_7:1.29.0.8
	OPENBSD_4_7_BASE:1.29
	OPENBSD_4_6:1.29.0.10
	OPENBSD_4_6_BASE:1.29
	OPENBSD_4_5:1.29.0.6
	OPENBSD_4_5_BASE:1.29
	OPENBSD_4_4:1.29.0.4
	OPENBSD_4_4_BASE:1.29
	OPENBSD_4_3:1.29.0.2
	OPENBSD_4_3_BASE:1.29
	OPENBSD_4_2:1.28.0.16
	OPENBSD_4_2_BASE:1.28
	OPENBSD_4_1:1.28.0.14
	OPENBSD_4_1_BASE:1.28
	OPENBSD_4_0:1.28.0.12
	OPENBSD_4_0_BASE:1.28
	OPENBSD_3_9:1.28.0.10
	OPENBSD_3_9_BASE:1.28
	OPENBSD_3_8:1.28.0.8
	OPENBSD_3_8_BASE:1.28
	OPENBSD_3_7:1.28.0.6
	OPENBSD_3_7_BASE:1.28
	OPENBSD_3_6:1.28.0.4
	OPENBSD_3_6_BASE:1.28
	OPENBSD_3_5:1.28.0.2
	OPENBSD_3_5_BASE:1.28
	OPENBSD_3_4:1.27.0.2
	OPENBSD_3_4_BASE:1.27
	OPENBSD_3_3:1.23.0.8
	OPENBSD_3_3_BASE:1.23
	OPENBSD_3_2:1.23.0.6
	OPENBSD_3_2_BASE:1.23
	OPENBSD_3_1:1.23.0.4
	OPENBSD_3_1_BASE:1.23
	OPENBSD_3_0:1.23.0.2
	OPENBSD_3_0_BASE:1.23
	OPENBSD_2_9:1.20.0.2
	OPENBSD_2_9_BASE:1.20
	OPENBSD_2_8:1.18.0.2
	OPENBSD_2_8_BASE:1.18
	OPENBSD_2_7:1.17.0.2
	OPENBSD_2_7_BASE:1.17
	OPENBSD_2_6:1.16.0.2
	OPENBSD_2_6_BASE:1.16
	OPENBSD_2_5:1.15.0.10
	OPENBSD_2_5_BASE:1.15
	OPENBSD_2_4:1.15.0.8
	OPENBSD_2_4_BASE:1.15
	OPENBSD_2_3:1.15.0.6
	OPENBSD_2_3_BASE:1.15
	OPENBSD_2_2:1.15.0.4
	OPENBSD_2_2_BASE:1.15
	OPENBSD_2_1:1.15.0.2
	OPENBSD_2_1_BASE:1.15
	OPENBSD_2_0:1.13.0.2
	OPENBSD_2_0_BASE:1.13
	netbsd_1_1:1.1.1.1;
locks; strict;
comment	@# @;


1.41
date	2015.01.16.01.58.17;	author schwarze;	state Exp;
branches;
next	1.40;
commitid	yazSRxVqe91hmBGV;

1.40
date	2014.03.08.17.08.11;	author schwarze;	state Exp;
branches;
next	1.39;

1.39
date	2012.01.06.21.04.06;	author nicm;	state Exp;
branches;
next	1.38;

1.38
date	2011.07.06.20.40.32;	author schwarze;	state Exp;
branches;
next	1.37;

1.37
date	2011.07.06.04.10.27;	author schwarze;	state Exp;
branches;
next	1.36;

1.36
date	2011.07.05.04.49.35;	author schwarze;	state Exp;
branches;
next	1.35;

1.35
date	2011.06.28.23.50.46;	author schwarze;	state Exp;
branches;
next	1.34;

1.34
date	2011.06.24.14.17.41;	author naddy;	state Exp;
branches;
next	1.33;

1.33
date	2011.06.23.22.46.12;	author schwarze;	state Exp;
branches;
next	1.32;

1.32
date	2010.10.17.22.47.08;	author schwarze;	state Exp;
branches;
next	1.31;

1.31
date	2010.09.09.22.50.47;	author schwarze;	state Exp;
branches;
next	1.30;

1.30
date	2010.04.03.19.34.00;	author schwarze;	state Exp;
branches;
next	1.29;

1.29
date	2007.11.03.10.30.40;	author espie;	state Exp;
branches;
next	1.28;

1.28
date	2004.02.08.01.19.54;	author espie;	state Exp;
branches;
next	1.27;

1.27
date	2003.08.18.22.39.15;	author espie;	state Exp;
branches;
next	1.26;

1.26
date	2003.08.07.10.54.39;	author espie;	state Exp;
branches;
next	1.25;

1.25
date	2003.08.07.10.52.48;	author espie;	state Exp;
branches;
next	1.24;

1.24
date	2003.07.07.21.39.27;	author deraadt;	state Exp;
branches;
next	1.23;

1.23
date	2001.07.20.23.02.21;	author espie;	state Exp;
branches;
next	1.22;

1.22
date	2001.07.20.19.48.26;	author mickey;	state Exp;
branches;
next	1.21;

1.21
date	2001.07.19.23.16.17;	author espie;	state Exp;
branches;
next	1.20;

1.20
date	2000.11.10.02.55.40;	author deraadt;	state Exp;
branches;
next	1.19;

1.19
date	2000.11.10.00.24.31;	author deraadt;	state Exp;
branches;
next	1.18;

1.18
date	2000.05.16.19.34.47;	author espie;	state Exp;
branches;
next	1.17;

1.17
date	99.11.27.04.31.12;	author millert;	state Exp;
branches;
next	1.16;

1.16
date	99.05.02.20.55.55;	author millert;	state Exp;
branches;
next	1.15;

1.15
date	97.04.27.21.38.30;	author millert;	state Exp;
branches;
next	1.14;

1.14
date	96.12.08.14.42.30;	author downsj;	state Exp;
branches;
next	1.13;

1.13
date	96.10.01.09.02.45;	author downsj;	state Exp;
branches;
next	1.12;

1.12
date	96.08.19.09.24.25;	author downsj;	state Exp;
branches;
next	1.11;

1.11
date	96.08.19.08.30.54;	author downsj;	state Exp;
branches;
next	1.10;

1.10
date	96.03.26.22.50.34;	author niklas;	state Exp;
branches;
next	1.9;

1.9
date	96.03.05.13.30.14;	author mickey;	state Exp;
branches;
next	1.8;

1.8
date	96.03.05.11.12.48;	author mickey;	state Exp;
branches;
next	1.7;

1.7
date	96.02.25.19.02.34;	author mickey;	state Exp;
branches;
next	1.6;

1.6
date	96.02.22.13.02.48;	author niklas;	state Exp;
branches;
next	1.5;

1.5
date	96.01.15.20.09.18;	author deraadt;	state Exp;
branches;
next	1.4;

1.4
date	95.12.19.10.44.19;	author niklas;	state Exp;
branches;
next	1.3;

1.3
date	95.12.14.03.47.21;	author deraadt;	state Exp;
branches;
next	1.2;

1.2
date	95.11.13.04.21.04;	author deraadt;	state Exp;
branches;
next	1.1;

1.1
date	95.10.18.08.44.46;	author deraadt;	state Exp;
branches
	1.1.1.1;
next	;

1.1.1.1
date	95.10.18.08.44.46;	author deraadt;	state Exp;
branches;
next	;


desc
@@


1.41
log
@Delete the MANLINT variable and the related SUFFIXES rules because
since yesterday, "mandoc -Tlint -Wfatal" can no longer fail.
Instead, as suggested by deraadt@@, provide a manlint target
that is *not* run during make build, but can be run
whenever you want to check syntax of manuals.
"nice stuff" deraadt@@
@
text
@#	$OpenBSD: bsd.man.mk,v 1.40 2014/03/08 17:08:11 schwarze Exp $
#	$NetBSD: bsd.man.mk,v 1.23 1996/02/10 07:49:33 jtc Exp $
#	@@(#)bsd.man.mk	5.2 (Berkeley) 5/11/90

.if !target(.MAIN)
.  if exists(${.CURDIR}/../Makefile.inc)
.    include "${.CURDIR}/../Makefile.inc"
.  endif

.MAIN: all
.endif

BEFOREMAN?=

# Add / so that we don't have to specify it.
.if defined(MANSUBDIR) && !empty(MANSUBDIR)
MANSUBDIR:=${MANSUBDIR:S,^,/,:S,$,/,}
.else
MANSUBDIR=/
.endif

# Files contained in ${BEFOREMAN} must be built before generating any
# manual page source code.
.for page in ${MAN}
.  if target(${page})
${page}: ${BEFOREMAN}
.  endif
.endfor

# Install the real manuals.
.for page in ${MAN}
.  for sub in ${MANSUBDIR}
_MAN_INST=${DESTDIR}${MANDIR}${page:E}${sub}${page:T}
${_MAN_INST}: ${page}
	${INSTALL} ${INSTALL_COPY} -o ${MANOWN} -g ${MANGRP} -m ${MANMODE} \
		${.ALLSRC} ${.TARGET}

maninstall: ${_MAN_INST}

.PHONY: ${_MAN_INST}
.  endfor
.endfor

# Install the manual hardlinks, if any.
maninstall:
.if defined(MLINKS) && !empty(MLINKS)
.  for sub in ${MANSUBDIR}
.     for lnk file in ${MLINKS}
	@@l=${DESTDIR}${MANDIR}${lnk:E}${sub}${lnk}; \
	t=${DESTDIR}${MANDIR}${file:E}${sub}${file}; \
	echo $$t -\> $$l; \
	rm -f $$t; ln $$l $$t;
.     endfor
.  endfor
.endif

# Explicitly list ${BEFOREMAN} to get it done even if ${MAN} is empty.
all: ${BEFOREMAN} ${MAN}

manlint: ${MAN}
.if defined(MAN) && !empty(MAN)
	mandoc -Tlint ${.ALLSRC}
.endif

.PHONY: manlint
@


1.40
log
@Keep the build log clean:
Hide ugly shell constructs used for exit value handling.
Issue reported and patch ok'ed by deraadt@@.
@
text
@d1 1
a1 1
#	$OpenBSD: bsd.man.mk,v 1.39 2012/01/06 21:04:06 nicm Exp $
a13 2
MANLINT=${MAN:S/$/.manlint/}
CLEANFILES+=.man-linted ${MANLINT}
d23 1
a23 3
# manual page source code.  However, static manual page files contained
# in the source tree must not appear as targets, or the ${.IMPSRC} in
# the .man.manlint suffix rule below will not find them in the .PATH.
a29 19
# In any case, ${BEFOREMAN} must be finished before linting any manuals.
.if !empty(MANLINT)
${MANLINT}: ${BEFOREMAN}
.endif

# Set up the suffix rules for checking manuals.
_MAN_SUFFIXES=1 2 3 3p 4 5 6 7 8 9
.for s in ${_MAN_SUFFIXES}
.SUFFIXES: .${s} .${s}.manlint
.${s}.${s}.manlint:
.if ${WARNINGS:L} == "yes"
	@@echo "mandoc -Tlint ${.IMPSRC}"
	@@mandoc -Tlint ${.IMPSRC} || [ $$? -lt 4 ]
.else
	mandoc -Tlint -Wfatal ${.IMPSRC}
.endif
	@@touch ${.TARGET}
.endfor

d58 8
a65 1
all: ${BEFOREMAN} ${MAN} ${MANLINT}
@


1.39
log
@Make mandoc show all warnings when WARNINGS=yes. Discussed with jmc@@ and
schwarze@@.

ok schwarze deraadt
@
text
@d1 1
a1 1
#	$OpenBSD: bsd.man.mk,v 1.38 2011/07/06 20:40:32 schwarze Exp $
d45 2
a46 1
	mandoc -Tlint ${.IMPSRC} || [ $$? -lt 4 ]
@


1.38
log
@Make sure typing "make install" twice in a row
installs manuals twice, not only the first time.

Admittedly, marking real target files as .PHONY is ugly,
but this is the least complex fix found so far.
If somebody comes up with something better,
i will gladly improve this.

Problem originally reported and some prodding by deraadt@@.
@
text
@d1 1
a1 1
#	$OpenBSD: bsd.man.mk,v 1.37 2011/07/06 04:10:27 schwarze Exp $
d44 3
d48 1
@


1.37
log
@Make sure ${BEFOREMAN} is finished before ${MANLINT} is started;
otherwise, stuff gets done in the wrong order in make -j.
While here, also make sure ${BEFOREMAN} is finished before
any manual source code is generated.

tested in make build / make release by krw@@
@
text
@d1 1
a1 1
#	$OpenBSD: bsd.man.mk,v 1.36 2011/07/05 04:49:35 schwarze Exp $
d57 2
@


1.36
log
@Allow parallel linting of manuals,
by using one mandoc process and one timestamp file per man page.
This might be slightly slower on single-processor machines,
but it's considerably faster with make -j.

"I think so" deraadt@@
@
text
@d1 1
a1 1
#	$OpenBSD: bsd.man.mk,v 1.35 2011/06/28 23:50:46 schwarze Exp $
d13 4
d24 14
a37 1
CLEANFILES+=.man-linted *.manlint
d39 6
a44 3
.for page in ${MAN}
${page}.manlint: ${page}
	mandoc -Tlint -Wfatal ${.ALLSRC}
d46 1
d48 2
a49 2
all: ${page}.manlint

d60 1
d73 2
a74 2
BEFOREMAN?=
all: ${BEFOREMAN} ${MAN}
@


1.35
log
@Less ugly MANSUBDIR handling, not needing '' any longer.
ok espie@@

Note: This does not yet fix the issue noted by deraadt@@
that two consecutive make install invocations install only once.
Both of my proposed solutions are not nice,
and espie@@ is searching for a cleaner way.
@
text
@d1 1
a1 1
#	$OpenBSD: bsd.man.mk,v 1.34 2011/06/24 14:17:41 naddy Exp $
d20 1
a20 1
CLEANFILES+= .man-linted
d22 2
a23 2
.if defined(MAN) && !empty(MAN)
.man-linted: ${MAN}
d27 1
a27 2
all: .man-linted
.endif
a28 1
.for page in ${MAN}
@


1.34
log
@Replace the .PHONY manlint target by an empty timestamp file, so man pages
are only re-linted after an actual change.
Tweaked from schwarze@@'s diff; ok schwarze@@
@
text
@d1 1
a1 1
#	$OpenBSD: bsd.man.mk,v 1.33 2011/06/23 22:46:12 schwarze Exp $
d13 3
a15 3
.if defined(MANSUBDIR)
# Add / so that we don't have to specify it. Better arch -> MANSUBDIR mapping
MANSUBDIR:=${MANSUBDIR:S,^,/,}
d17 1
a17 2
# XXX MANSUBDIR must be non empty for the mlink loops to work
MANSUBDIR=''
d32 2
a33 1
${DESTDIR}${MANDIR}${page:E}${sub}/${page:T}: ${page}
d37 1
a37 1
maninstall: ${DESTDIR}${MANDIR}${page:E}${sub}/${page:T}
d45 2
a46 2
	@@l=${DESTDIR}${MANDIR}${lnk:E}${sub}/${lnk}; \
	t=${DESTDIR}${MANDIR}${file:E}${sub}/${file}; \
@


1.33
log
@switch to installing source manuals (base part)
discussed with lots of people, tested by naddy@@,
"move fast" deraadt@@
@
text
@d1 1
a1 1
#	$OpenBSD: bsd.man.mk,v 1.32 2010/10/17 22:47:08 schwarze Exp $
d21 2
a22 1
manlint: ${MAN}
d24 1
d26 3
d54 1
a54 3
all: ${BEFOREMAN} ${MAN} manlint

.PHONY: manlint
@


1.32
log
@Build tbl(1) pages with mandoc(1), not groff.
Xenocara build checked myself, base build also by jmc@@, thanks!
"don't wait for me" deraadt@@

Pages in base using tbl mostly look good already except for the
rare .T{ macros; there may still be a few formatting issues
in xenocara, please speak up when you run into them.
Eventually, mandoc will catch up.
@
text
@d1 1
a1 1
#	$OpenBSD: bsd.man.mk,v 1.31 2010/09/09 22:50:47 schwarze Exp $
a4 3
MANTARGET?=	cat
MANDOC?=	mandoc

a12 38
.SUFFIXES: .1 .2 .3 .3p .4 .5 .6 .7 .8 .9 \
	.1tbl .2tbl .3tbl .4tbl .5tbl .6tbl .7tbl .8tbl .9tbl \
	.cat1 .cat2 .cat3 .cat3p .cat4 .cat5 .cat6 .cat7 .cat8 .cat9 \
	.ps1 .ps2 .ps3 .ps3p .ps4 .ps5 .ps6 .ps7 .ps8 .ps9

.9.cat9 .8.cat8 .7.cat7 .6.cat6 .5.cat5 \
.4.cat4 .3p.cat3p .3.cat3 .2.cat2 .1.cat1 \
.9tbl.cat9 .8tbl.cat8 .7tbl.cat7 .6tbl.cat6 .5tbl.cat5 \
.4tbl.cat4 .3tbl.cat3 .2tbl.cat2 .1tbl.cat1:
	@@echo "${MANDOC} ${.IMPSRC} > ${.TARGET}"
	@@${MANDOC} ${.IMPSRC} > ${.TARGET} || (rm -f ${.TARGET}; false)

.9.ps9 .8.ps8 .7.ps7 .6.ps6 .5.ps5 .4.ps4 .3p.ps3p .3.ps3 .2.ps2 .1.ps1 \
.9tbl.ps9 .8tbl.ps8 .7tbl.ps7 .6tbl.ps6 .5tbl.ps5 .4tbl.ps4 .3tbl.ps3 \
.2tbl.ps2 .1tbl.ps1:
	@@echo "${MANDOC} -Tps ${.IMPSRC} > ${.TARGET}"
	@@${MANDOC} -Tps ${.IMPSRC} > ${.TARGET} || (rm -f ${.TARGET}; false)

.if defined(MAN) && !empty(MAN) && !defined(MANALL)
.  for v s in MANALL .cat PS2ALL .ps

$v=	${MAN:S/.1$/$s1/g:S/.2$/$s2/g:S/.3$/$s3/g:S/.3p$/$s3p/g:S/.4$/$s4/g:S/.5$/$s5/g:S/.6$/$s6/g:S/.7$/$s7/g:S/.8$/$s8/g:S/.9$/$s9/g:S/.1tbl$/$s1/g:S/.2tbl$/$s2/g:S/.3tbl$/$s3/g:S/.4tbl$/$s4/g:S/.5tbl$/$s5/g:S/.6tbl$/$s6/g:S/.7tbl$/$s7/g:S/.8tbl$/$s8/g:S/.9tbl$/$s9/g}

.  endfor

.  if defined(MANPS)
PSALL=${PS2ALL}
.  endif

.endif

MINSTALL=	${INSTALL} ${INSTALL_COPY} -o ${MANOWN} -g ${MANGRP} -m ${MANMODE}
.if defined(MANZ)
# chown and chmod are done afterward automatically
MCOMPRESS=	gzip -cf
MCOMPRESSSUFFIX= .gz
.endif

d21 3
a23 11
.if !defined(MCOMPRESS) || empty(MCOMPRESS)
install_manpage_fragment= \
	echo ${MINSTALL} $$page $$instpage; \
	${MINSTALL} $$page $$instpage
.else
install_manpage_fragment= \
	rm -f $$instpage; \
	echo ${MCOMPRESS} $$page \> $$instpage; \
	${MCOMPRESS} $$page > $$instpage; \
	chown ${MANOWN}:${MANGRP} $$instpage; \
	chmod ${MANMODE} $$instpage
d26 8
a33 18
maninstall:
.for v d s t in MANALL ${MANDIR} .cat .0 PSALL ${PSDIR} .ps .ps
.  if defined($v)
	@@for page in ${$v}; do \
		set -- ${MANSUBDIR}; \
		subdir=$$1; \
		dir=${DESTDIR}$d$${page##*$s}; \
		base=$${page##*/}; \
		instpage=$${dir}$${subdir}/$${base%.*}$t${MCOMPRESSSUFFIX}; \
		${install_manpage_fragment}; \
		while test $$# -ge 2; do \
			shift; \
			extra=$${dir}$$1/$${base%.*}$t${MCOMPRESSSUFFIX}; \
			echo $$extra -\> $$instpage; \
			ln -f $$instpage $$extra; \
		done; \
	done
.  endif
d36 1
d40 2
a41 2
	@@l=${DESTDIR}${MANDIR}${lnk:E}${sub}/${lnk:R}.0${MCOMPRESSSUFFIX}; \
	t=${DESTDIR}${MANDIR}${file:E}${sub}/${file:R}.0${MCOMPRESSSUFFIX}; \
a47 3
.if (defined(MANALL) || defined(PSALL)) && !defined(MANLOCALBUILD)
all: ${MANALL} ${PSALL}

d49 1
a49 1
${MANALL} ${PSALL}: ${BEFOREMAN}
d51 1
a51 5

cleandir: cleanman
cleanman:
	rm -f ${MANALL} ${PS2ALL}
.endif
@


1.31
log
@Use mandoc instead of groff to build PostScript manuals; note that
these are not built by default, but only built when MANPS is set.
kristaps@@ and jmc@@ agree with the idea,
and the patch doesn't bother deraadt@@ at all
@
text
@d1 1
a1 1
#	$OpenBSD: bsd.man.mk,v 1.30 2010/04/03 19:34:00 schwarze Exp $
a6 3
NROFF?=		nroff -Tascii
TBL?=		tbl
MANLINT?=	\#
d21 4
a24 1
.9.cat9 .8.cat8 .7.cat7 .6.cat6 .5.cat5 .4.cat4 .3p.cat3p .3.cat3 .2.cat2 .1.cat1:
d28 3
a30 8
.9tbl.cat9 .8tbl.cat8 .7tbl.cat7 .6tbl.cat6 .5tbl.cat5 .4tbl.cat4 .3tbl.cat3 \
.2tbl.cat2 .1tbl.cat1:
	@@echo "${TBL} ${.IMPSRC} | ${NROFF} -mandoc > ${.TARGET}"
	@@${MANLINT} -tbl ${.IMPSRC}
	@@${TBL} ${.IMPSRC} | ${NROFF} -mandoc > ${.TARGET} || \
	    (rm -f ${.TARGET}; false)

.9.ps9 .8.ps8 .7.ps7 .6.ps6 .5.ps5 .4.ps4 .3p.ps3p .3.ps3 .2.ps2 .1.ps1:
a32 5

.9tbl.ps9 .8tbl.ps8 .7tbl.ps7 .6tbl.ps6 .5tbl.ps5 .4tbl.ps4 .3tbl.ps3 \
.2tbl.ps2 .1tbl.ps1:
	@@echo "${TBL} ${.IMPSRC} | nroff -Tps -mandoc > ${.TARGET}"
	@@${TBL} ${.IMPSRC} | nroff -Tps -mandoc > ${.TARGET} || (rm -f ${.TARGET}; false)
@


1.30
log
@Build all manual pages in base with mandoc(1) instead of groff,
excepting the tbl(1) pages, which are less than twenty.

"commit the diff that enables it, now"  deraadt@@
@
text
@d1 1
a1 1
#	$OpenBSD: bsd.man.mk,v 1.29 2007/11/03 10:30:40 espie Exp $
d36 2
a37 2
	@@echo "nroff -Tps -mandoc ${.IMPSRC} > ${.TARGET}"
	@@nroff -Tps -mandoc ${.IMPSRC} > ${.TARGET} || (rm -f ${.TARGET}; false)
@


1.29
log
@add a BEFOREMAN hook variable, for those programs that need something to
be done before they can build their manpages.
`ah right' millert@@
@
text
@d1 1
a1 1
#	$OpenBSD: bsd.man.mk,v 1.28 2004/02/08 01:19:54 espie Exp $
d6 1
d25 2
a26 3
	@@echo "${NROFF} -mandoc ${.IMPSRC} > ${.TARGET}"
	@@${MANLINT} ${.IMPSRC}
	@@${NROFF} -mandoc ${.IMPSRC} > ${.TARGET} || (rm -f ${.TARGET}; false)
@


1.28
log
@3p suffix, formatting.
okay millert@@
should have committed before the perl change, except I checked it thru a
make build first, and then forgot to commit.
@
text
@d1 1
a1 1
#	$OpenBSD: bsd.man.mk,v 1.27 2003/08/18 22:39:15 espie Exp $
d118 4
@


1.27
log
@take PSDIR into account. Noticed by David Krause
@
text
@d1 1
a1 1
#	$OpenBSD: bsd.man.mk,v 1.26 2003/08/07 10:54:39 espie Exp $
d18 4
a21 3
.SUFFIXES: .1 .2 .3 .3p .4 .5 .6 .7 .8 .9 .1tbl .2tbl .3tbl .4tbl .5tbl .6tbl \
	.7tbl .8tbl .9tbl .cat1 .cat2 .cat3 .cat4 .cat5 .cat6 .cat7 .cat8 .cat9 \
	.ps1 .ps2 .ps3 .ps4 .ps5 .ps6 .ps7 .ps8 .ps9
@


1.26
log
@add possible call to a MANLINT script (defined to be # by default)
`sounds reasonable' millert@@
@
text
@d1 1
a1 1
#	$OpenBSD: bsd.man.mk,v 1.25 2003/08/07 10:52:48 espie Exp $
d85 1
a85 1
.for v s t in MANALL .cat .0 PSALL .ps .ps
d90 1
a90 1
		dir=${DESTDIR}${MANDIR}$${page##*$s}; \
@


1.25
log
@Simplify install logic by using a shell fragment, and a new-fangled .for
loop.

`sounds reasonable' millert@@
@
text
@d1 1
a1 1
#	$OpenBSD: bsd.man.mk,v 1.24 2003/07/07 21:39:27 deraadt Exp $
d8 1
d24 1
d30 1
@


1.24
log
@for cleandir target, clean the postscript man page output even if MANPS is
not set
@
text
@d1 1
a1 1
#	$OpenBSD: bsd.man.mk,v 1.23 2001/07/20 23:02:21 espie Exp $
d10 3
a12 3
.if exists(${.CURDIR}/../Makefile.inc)
.include "${.CURDIR}/../Makefile.inc"
.endif
d41 1
d43 1
a43 1
MANALL=	${MAN:S/.1$/.cat1/g:S/.2$/.cat2/g:S/.3$/.cat3/g:S/.3p$/.cat3p/g:S/.4$/.cat4/g:S/.5$/.cat5/g:S/.6$/.cat6/g:S/.7$/.cat7/g:S/.8$/.cat8/g:S/.9$/.cat9/g:S/.1tbl$/.cat1/g:S/.2tbl$/.cat2/g:S/.3tbl$/.cat3/g:S/.4tbl$/.cat4/g:S/.5tbl$/.cat5/g:S/.6tbl$/.cat6/g:S/.7tbl$/.cat7/g:S/.8tbl$/.cat8/g:S/.9tbl$/.cat9/g}
d45 1
a45 1
PS2ALL= ${MAN:S/.1$/.ps1/g:S/.2$/.ps2/g:S/.3$/.ps3/g:S/.3p$/.ps3p/g:S/.4$/.ps4/g:S/.5$/.ps5/g:S/.6$/.ps6/g:S/.7$/.ps7/g:S/.8$/.ps8/g:S/.9$/.ps9/g:S/.1tbl$/.ps1/g:S/.2tbl$/.ps2/g:S/.3tbl$/.ps3/g:S/.4tbl$/.ps4/g:S/.5tbl$/.ps5/g:S/.6tbl$/.ps6/g:S/.7tbl$/.ps7/g:S/.8tbl$/.ps8/g:S/.9tbl$/.ps9/g}
d47 1
a47 1
.if defined(MANPS)
d49 1
a49 1
.endif
d68 13
d82 3
a84 2
.if defined(MANALL)
	@@for page in ${MANALL}; do \
d87 1
a87 1
		dir=${DESTDIR}${MANDIR}$${page##*.cat}; \
d89 2
a90 11
		instpage=$${dir}$${subdir}/$${base%.*}.0${MCOMPRESSSUFFIX}; \
		if [ X"${MCOMPRESS}" = X ]; then \
			echo ${MINSTALL} $$page $$instpage; \
			${MINSTALL} $$page $$instpage; \
		else \
			rm -f $$instpage; \
			echo ${MCOMPRESS} $$page \> $$instpage; \
			${MCOMPRESS} $$page > $$instpage; \
			chown ${MANOWN}:${MANGRP} $$instpage; \
			chmod ${MANMODE} $$instpage; \
		fi; \
d93 1
a93 1
			extra=$${dir}$$1/$${base%.*}.0${MCOMPRESSSUFFIX}; \
d98 3
a100 26
.endif
.if defined(PSALL)
	@@for page in ${PSALL}; do \
		set -- ${MANSUBDIR}; \
		subdir=$$1; \
		dir=${DESTDIR}${PSDIR}$${page##*.ps}; \
		base=$${page##*/}; \
		instpage=$${dir}$${subdir}/$${base%.*}.ps${MCOMPRESSSUFFIX}; \
		if [ X"${MCOMPRESS}" = X ]; then \
			echo ${MINSTALL} $$page $$instpage; \
			${MINSTALL} $$page $$instpage; \
		else \
			rm -f $$instpage; \
			echo ${MCOMPRESS} $$page \> $$instpage; \
			${MCOMPRESS} $$page > $$instpage; \
			chown ${PSOWN}:${PSGRP} $$instpage; \
			chmod ${PSMODE} $$instpage; \
		fi; \
		while test $$# -ge 2; do \
			shift; \
			extra=$${dir}$$1/$${base%.*}.ps${MCOMPRESSSUFFIX}; \
			echo $$extra -\> $$instpage; \
			ln -f $$instpage $$extra; \
		done; \
	done
.endif
@


1.23
log
@One BINDIR too many, I don't know how I pulled that one.
@
text
@d1 1
a1 1
#	$OpenBSD: bsd.man.mk,v 1.21 2001/07/19 23:16:17 espie Exp $
d44 2
d47 1
a47 3

PSALL= ${MAN:S/.1$/.ps1/g:S/.2$/.ps2/g:S/.3$/.ps3/g:S/.3p$/.ps3p/g:S/.4$/.ps4/g:S/.5$/.ps5/g:S/.6$/.ps6/g:S/.7$/.ps7/g:S/.8$/.ps8/g:S/.9$/.ps9/g:S/.1tbl$/.ps1/g:S/.2tbl$/.ps2/g:S/.3tbl$/.ps3/g:S/.4tbl$/.ps4/g:S/.5tbl$/.ps5/g:S/.6tbl$/.ps6/g:S/.7tbl$/.ps7/g:S/.8tbl$/.ps8/g:S/.9tbl$/.ps9/g}

d134 1
a134 1
	rm -f ${MANALL} ${PSALL}
@


1.22
log
@undo broken changes, i dunno a fix for these; how many times you gonna repeat the same mistake espie@@ and millert@@ ?
@
text
@d1 1
a1 1
#	$OpenBSD: bsd.man.mk,v 1.20 2000/11/10 02:55:40 deraadt Exp $
d119 7
a125 15
.  for _subdir in ${MANSUBDIR}
	@@set ${MLINKS}; \
	while test $$# -ge 2; do \
		name=$$1; \
		shift; \
		dir=${DESTDIR}${MANDIR}$${name##*.}; \
		l=$${dir}${_subdir}/$${name%.*}.0${MCOMPRESSSUFFIX}; \
		name=$$1; \
		shift; \
		dir=${DESTDIR}${MANDIR}$${name##*.}; \
		t=$${dir}${_subdir}/$${name%.*}.0${MCOMPRESSSUFFIX}; \
		echo $$t -\> $$l; \
		rm -f $$t; \
		ln $$l $$t; \
	done
@


1.21
log
@Minor speed-up tweaks.
- use .for a b in   new syntax for make  to handle links.
- kill mips
- .include shlib_version, since its contents is happy as a Makefile
fragment (avoids 10 shell escapes per lib directory, roughly)

okay millert@@
@
text
@d119 15
a133 7
.  for sub in ${MANSUBDIR}
.     for lnk file in ${MLINKS}
	@@l=${DESTDIR}${MANDIR}${lnk:E}${sub}/${lnk:R}.0${MCOMPRESSSUFFIX}; \
	t=${DESTDIR}${MANDIR}${file:E}${sub}/${file:R}.0${MCOMPRESSSUFFIX}; \
	echo $$t -\> $$l; \
	rm -f $$t; ln $$l $$t;
.     endfor
@


1.20
log
@do not change NROFF
@
text
@d1 1
a1 1
#	$OpenBSD: bsd.man.mk,v 1.19 2000/11/10 00:24:31 deraadt Exp $
d119 7
a125 15
.  for _subdir in ${MANSUBDIR}
	@@set ${MLINKS}; \
	while test $$# -ge 2; do \
		name=$$1; \
		shift; \
		dir=${DESTDIR}${MANDIR}$${name##*.}; \
		l=$${dir}${_subdir}/$${name%.*}.0${MCOMPRESSSUFFIX}; \
		name=$$1; \
		shift; \
		dir=${DESTDIR}${MANDIR}$${name##*.}; \
		t=$${dir}${_subdir}/$${name%.*}.0${MCOMPRESSSUFFIX}; \
		echo $$t -\> $$l; \
		rm -f $$t; \
		ln $$l $$t; \
	done
@


1.19
log
@the new MANPS variable specifies that .ps versions of manual pages should
also be installed in /usr/share/man/ps[0-9]/ as *.ps files.  No MLINKS are
made for them.
@
text
@d1 1
a1 1
#	$OpenBSD: bsd.man.mk,v 1.18 2000/05/16 19:34:47 espie Exp $
d6 1
a6 1
NROFF?=		nroff
d22 2
a23 2
	@@echo "${NROFF} -Tascii -mandoc ${.IMPSRC} > ${.TARGET}"
	@@${NROFF} -Tascii -mandoc ${.IMPSRC} > ${.TARGET} || (rm -f ${.TARGET}; false)
d27 2
a28 2
	@@echo "${TBL} ${.IMPSRC} | ${NROFF} -Tascii -mandoc > ${.TARGET}"
	@@${TBL} ${.IMPSRC} | ${NROFF}  -Tascii -mandoc > ${.TARGET} || \
@


1.18
log
@Extend MANSUBDIR to be a possible list, use links so that this only
consumes inodes.

Add / at start of MANSUBDIR entries automatically (see make(1) for :S),
so that we can use list of machines automatically.

millert@@ ok.
@
text
@d1 1
a1 1
#	$OpenBSD: bsd.man.mk,v 1.17 1999/11/27 04:31:12 millert Exp $
d6 1
a6 1
NROFF?=		nroff -Tascii
d18 2
a19 1
	.7tbl .8tbl .9tbl .cat1 .cat2 .cat3 .cat4 .cat5 .cat6 .cat7 .cat8 .cat9
d22 2
a23 2
	@@echo "${NROFF} -mandoc ${.IMPSRC} > ${.TARGET}"
	@@${NROFF} -mandoc ${.IMPSRC} > ${.TARGET} || (rm -f ${.TARGET}; false)
d27 12
a38 2
	@@echo "${TBL} ${.IMPSRC} | ${NROFF} -mandoc > ${.TARGET}"
	@@${TBL} ${.IMPSRC} | ${NROFF} -mandoc > ${.TARGET} || (rm -f ${.TARGET}; false)
d41 1
d43 7
d93 25
d137 2
a138 2
.if defined(MANALL) && !defined(MANLOCALBUILD)
all: ${MANALL}
d142 1
a142 1
	rm -f ${MANALL}
@


1.17
log
@Call nroff with the -Tascii option to keep groff from using -Tlatin1
which could result in it using 0xAD as a hyphenation character.
This looks ok with less on an xterm but not on others, eg. the
pcvt console.  From NetBSD.
@
text
@d1 1
a1 1
#	$OpenBSD: bsd.man.mk,v 1.16 1999/05/02 20:55:55 millert Exp $
d40 8
d51 2
d55 1
a55 1
		instpage=$${dir}${MANSUBDIR}/$${base%.*}.0${MCOMPRESSSUFFIX}; \
d65 7
a71 1
		fi \
d75 1
d81 1
a81 1
		l=$${dir}${MANSUBDIR}/$${name%.*}.0${MCOMPRESSSUFFIX}; \
d85 1
a85 1
		t=$${dir}${MANSUBDIR}/$${name%.*}.0${MCOMPRESSSUFFIX}; \
d90 1
@


1.16
log
@support *.3p (perl lib manuals); man.conf already supports this
@
text
@d1 1
a1 1
#	$OpenBSD: bsd.man.mk,v 1.15 1997/04/27 21:38:30 millert Exp $
d6 1
a6 1
NROFF?=		nroff
@


1.15
log
@COPY -> INSTALL_COPY and STRIP -> INSTALL_STRIP changes.
For some reason the previous commit did not grab these.
@
text
@d1 1
a1 1
#	$OpenBSD: bsd.man.mk,v 1.14 1996/12/08 14:42:30 downsj Exp $
d17 1
a17 1
.SUFFIXES: .1 .2 .3 .4 .5 .6 .7 .8 .9 .1tbl .2tbl .3tbl .4tbl .5tbl .6tbl \
d20 1
a20 1
.9.cat9 .8.cat8 .7.cat7 .6.cat6 .5.cat5 .4.cat4 .3.cat3 .2.cat2 .1.cat1:
d30 1
a30 1
MANALL=	${MAN:S/.1$/.cat1/g:S/.2$/.cat2/g:S/.3$/.cat3/g:S/.4$/.cat4/g:S/.5$/.cat5/g:S/.6$/.cat6/g:S/.7$/.cat7/g:S/.8$/.cat8/g:S/.9$/.cat9/g:S/.1tbl$/.cat1/g:S/.2tbl$/.cat2/g:S/.3tbl$/.cat3/g:S/.4tbl$/.cat4/g:S/.5tbl$/.cat5/g:S/.6tbl$/.cat6/g:S/.7tbl$/.cat7/g:S/.8tbl$/.cat8/g:S/.9tbl$/.cat9/g}
@


1.14
log
@install -> ${INSTALL}, -c -> ${COPY}
@
text
@d1 1
a1 1
#	$OpenBSD: bsd.man.mk,v 1.13 1996/10/01 09:02:45 downsj Exp $
d33 1
a33 1
MINSTALL=	${INSTALL} ${COPY} -o ${MANOWN} -g ${MANGRP} -m ${MANMODE}
@


1.13
log
@Automagically support building man pages with tbl(1).

foo.1 becomes foo.1tbl
@
text
@d1 1
a1 1
#	$OpenBSD: bsd.man.mk,v 1.12 1996/08/19 09:24:25 downsj Exp $
d33 1
a33 1
MINSTALL=	install ${COPY} -o ${MANOWN} -g ${MANGRP} -m ${MANMODE}
@


1.12
log
@Don't provide all/clean/etc if they don't 'em.
@
text
@d1 1
a1 1
#	$OpenBSD: bsd.man.mk,v 1.11 1996/08/19 08:30:54 downsj Exp $
d7 1
d17 2
a18 2
.SUFFIXES: .1 .2 .3 .4 .5 .6 .7 .8 .9 .cat1 .cat2 .cat3 .cat4 .cat5 .cat6 \
	.cat7 .cat8 .cat9
d24 5
d30 1
a30 1
MANALL=	${MAN:S/.1$/.cat1/g:S/.2$/.cat2/g:S/.3$/.cat3/g:S/.4$/.cat4/g:S/.5$/.cat5/g:S/.6$/.cat6/g:S/.7$/.cat7/g:S/.8$/.cat8/g:S/.9$/.cat9/g}
@


1.11
log
@Don't redefine MANALL
@
text
@d1 1
a1 1
#	$OpenBSD: bsd.man.mk,v 1.8 1996/03/05 11:12:48 mickey Exp $
d69 1
a69 1
.if defined(MANALL)
@


1.10
log
@Revert last change which lost the functionality introduced in rev 1.4
@
text
@d23 1
a23 1
.if defined(MAN) && !empty(MAN)
@


1.9
log
@Fix seemed to be a bug.
@
text
@d38 2
a39 1
		instpage=$${dir}${MANSUBDIR}/$${page%.*}.0${MCOMPRESSSUFFIX}; \
@


1.8
log
@Labeling style changed ($OpenBSD$).
POSTINSTALL added to the <bsd.lkm.mk> (see bsd.README for details).
@
text
@d1 1
a1 1
#	$OpenBSD$
d38 1
a38 2
		base=$${page##*/}; \
		instpage=$${dir}${MANSUBDIR}/$${base%.*}.0${MCOMPRESSSUFFIX}; \
@


1.7
log
@Added <bsd.lkm.mk> file. Correspondent changes made to the bsd.README.
All the rest changed to be $OpenBSD$.
Dedicated to Suzi Quatro (she must be alive still, so best wishes to here).
@
text
@d1 2
a2 1
#	$OpenBSD: bsd.man.mk,v 1.21 1995/11/25 19:53:33 perry Exp $
@


1.6
log
@From NetBSD:
Allow override of nroff program, requested by Masanobu Saitoh
<msaitoh@@spa.is.uec.ac.jp> in PR #1741.
Use ksh-style substring parameter expansion expressions instead of
calling expr when constructing manpage directory and file names.
Much, much faster.
@
text
@d1 1
a1 1
#	$NetBSD: bsd.man.mk,v 1.21 1995/11/25 19:53:33 perry Exp $
@


1.5
log
@from betbsd:
Allow override of nroff program, requested by Masanobu Saitoh
<msaitoh@@spa.is.uec.ac.jp> in PR #1741.
@
text
@d19 2
a20 2
	@@echo "nroff -mandoc ${.IMPSRC} > ${.TARGET}"
	@@nroff -mandoc ${.IMPSRC} > ${.TARGET} || ( rm -f ${.TARGET} ; false )
d36 3
a38 2
		dir=${DESTDIR}${MANDIR}`expr $$page : '.*\.cat\([1-9]\)'`; \
		instpage=$${dir}${MANSUBDIR}/`expr \`basename $$page\` : '\(.*\)\.cat[1-9]'`.0${MCOMPRESSSUFFIX}; \
d56 2
a57 2
		dir=${DESTDIR}${MANDIR}`expr $$name : '.*\.\(.*\)'`; \
		l=$${dir}${MANSUBDIR}/`expr $$name : '\(.*\)\..*'`.0${MCOMPRESSSUFFIX}; \
d60 2
a61 2
		dir=${DESTDIR}${MANDIR}`expr $$name : '.*\.\(.*\)'`; \
		t=$${dir}${MANSUBDIR}/`expr $$name : '\(.*\)\..*'`.0${MCOMPRESSSUFFIX}; \
@


1.4
log
@When doing Makefile.bsd-wrapper-style importing, it's nice to be able
to specify the man-pages with a subdir-path prepended to them.  This
subdir component must be removed when installing.
@
text
@d5 1
@


1.3
log
@update from netbsd
@
text
@d36 1
a36 1
		instpage=$${dir}${MANSUBDIR}/`expr $$page : '\(.*\)\.cat[1-9]'`.0${MCOMPRESSSUFFIX}; \
@


1.2
log
@allow override of nroff command; from msaitoh@@spa.is.uec.ac.jp, netbsd pr #1741
@
text
@d1 1
a1 1
#	$NetBSD: bsd.man.mk,v 1.20 1995/06/07 01:15:20 cgd Exp $
a4 1
NROFF?=		nroff
d14 2
a15 2
.SUFFIXES: .1 .2 .3 .4 .5 .6 .7 .8 .cat1 .cat2 .cat3 .cat4 .cat5 .cat6 \
	.cat7 .cat8
d17 3
a19 3
.8.cat8 .7.cat7 .6.cat6 .5.cat5 .4.cat4 .3.cat3 .2.cat2 .1.cat1:
	@@echo "${NROFF} -mandoc ${.IMPSRC} > ${.TARGET}"
	@@${NROFF} -mandoc ${.IMPSRC} > ${.TARGET} || ( rm -f ${.TARGET} ; false )
d22 1
a22 1
MANALL=	${MAN:S/.1$/.cat1/g:S/.2$/.cat2/g:S/.3$/.cat3/g:S/.4$/.cat4/g:S/.5$/.cat5/g:S/.6$/.cat6/g:S/.7$/.cat7/g:S/.8$/.cat8/g}
d35 2
a36 2
		dir=${DESTDIR}${MANDIR}`expr $$page : '.*\.cat\([1-8]\)'`; \
		instpage=$${dir}${MANSUBDIR}/`expr $$page : '\(.*\)\.cat[1-8]'`.0${MCOMPRESSSUFFIX}; \
@


1.1
log
@Initial revision
@
text
@d5 1
d19 2
a20 2
	@@echo "nroff -mandoc ${.IMPSRC} > ${.TARGET}"
	@@nroff -mandoc ${.IMPSRC} > ${.TARGET} || ( rm -f ${.TARGET} ; false )
@


1.1.1.1
log
@initial import of NetBSD tree
@
text
@@
