head	1.6;
access;
symbols
	OPENBSD_6_1:1.6.0.8
	OPENBSD_6_1_BASE:1.6
	OPENBSD_6_0:1.6.0.10
	OPENBSD_6_0_BASE:1.6
	OPENBSD_5_9:1.6.0.4
	OPENBSD_5_9_BASE:1.6
	OPENBSD_5_8:1.6.0.6
	OPENBSD_5_8_BASE:1.6
	OPENBSD_5_7:1.6.0.2
	OPENBSD_5_7_BASE:1.6
	OPENBSD_5_6:1.5.0.10
	OPENBSD_5_6_BASE:1.5
	OPENBSD_5_5:1.5.0.8
	OPENBSD_5_5_BASE:1.5
	OPENBSD_5_4:1.5.0.4
	OPENBSD_5_4_BASE:1.5
	OPENBSD_5_3:1.5.0.2
	OPENBSD_5_3_BASE:1.5
	OPENBSD_5_2:1.4.0.2
	OPENBSD_5_2_BASE:1.4
	OPENBSD_5_1_BASE:1.3
	OPENBSD_5_1:1.3.0.4
	OPENBSD_5_0:1.3.0.2
	OPENBSD_5_0_BASE:1.3;
locks; strict;
comment	@# @;


1.6
date	2014.08.22.08.10.38;	author jsg;	state Exp;
branches;
next	1.5;
commitid	mMRjBSjDRmpf6dWr;

1.5
date	2012.08.14.07.43.57;	author ajacoutot;	state Exp;
branches;
next	1.4;

1.4
date	2012.07.10.15.03.24;	author halex;	state Exp;
branches;
next	1.3;

1.3
date	2011.08.02.11.59.25;	author robert;	state Exp;
branches;
next	1.2;

1.2
date	2011.08.02.11.50.39;	author robert;	state Exp;
branches;
next	1.1;

1.1
date	2011.07.08.00.54.04;	author ajacoutot;	state Exp;
branches;
next	;


desc
@@


1.6
log
@Set the default nfsd flags to "-tun 4".  Matches the comment
in rc.conf and the behaviour of the backwards compatibility
code in rc.subr for nfs_server=YES.
ok ajacoutot@@
@
text
@#!/bin/sh
#
# $OpenBSD: nfsd,v 1.5 2012/08/14 07:43:57 ajacoutot Exp $

daemon="/sbin/nfsd"
daemon_flags="-tun 4"

. /etc/rc.d/rc.subr

pexp="(${daemon}( |$)|nfsd: (master|server)$)"

rc_reload=NO

rc_pre() {
	[ -s /etc/exports ] && grep -qv '^#' /etc/exports
}

rc_cmd $1
@


1.5
log
@Optimize checks for /etc/exports.

from robert at peichaer dot org
discussed with and ok halex@@
@
text
@d3 1
a3 1
# $OpenBSD: nfsd,v 1.4 2012/07/10 15:03:24 halex Exp $
d6 1
@


1.4
log
@fix pexp

ok robert@@
@
text
@d3 1
a3 1
# $OpenBSD: nfsd,v 1.3 2011/08/02 11:59:25 robert Exp $
d14 1
a14 1
	[ -s /etc/exports -a `sed -e '/^#/d' < /etc/exports | wc -l` -ne 0 ]
@


1.3
log
@handle /var/db/mountdtab in the mountd script and not in nfsd
@
text
@d3 1
a3 1
# $OpenBSD: nfsd,v 1.2 2011/08/02 11:50:39 robert Exp $
d9 1
a9 1
pexp="(${daemon}*|nfsd: (master|server)$)"
@


1.2
log
@catch all the three different process names in pexp
@
text
@d3 1
a3 1
# $OpenBSD: nfsd,v 1.1 2011/07/08 00:54:04 ajacoutot Exp $
d14 1
a14 3
	[ -s /etc/exports -a `sed -e '/^#/d' < /etc/exports | wc -l` -ne 0 ] &&
		rm -f /var/db/mountdtab && \
		echo -n > /var/db/mountdtab
@


1.1
log
@Add the nfs startup scripts.

ok robert@@
@
text
@d3 1
a3 1
# $OpenBSD$
d9 2
a16 4
}

rc_post() {
	pkill -f "^nfsd: server$"
@

