head	1.7;
access;
symbols
	OPENBSD_5_5:1.6.0.40
	OPENBSD_5_5_BASE:1.6
	OPENBSD_5_4:1.6.0.36
	OPENBSD_5_4_BASE:1.6
	OPENBSD_5_3:1.6.0.34
	OPENBSD_5_3_BASE:1.6
	OPENBSD_5_2:1.6.0.32
	OPENBSD_5_2_BASE:1.6
	OPENBSD_5_1_BASE:1.6
	OPENBSD_5_1:1.6.0.30
	OPENBSD_5_0:1.6.0.28
	OPENBSD_5_0_BASE:1.6
	OPENBSD_4_9:1.6.0.26
	OPENBSD_4_9_BASE:1.6
	OPENBSD_4_8:1.6.0.24
	OPENBSD_4_8_BASE:1.6
	OPENBSD_4_7:1.6.0.20
	OPENBSD_4_7_BASE:1.6
	OPENBSD_4_6:1.6.0.22
	OPENBSD_4_6_BASE:1.6
	OPENBSD_4_5:1.6.0.18
	OPENBSD_4_5_BASE:1.6
	OPENBSD_4_4:1.6.0.16
	OPENBSD_4_4_BASE:1.6
	OPENBSD_4_3:1.6.0.14
	OPENBSD_4_3_BASE:1.6
	OPENBSD_4_2:1.6.0.12
	OPENBSD_4_2_BASE:1.6
	OPENBSD_4_1:1.6.0.10
	OPENBSD_4_1_BASE:1.6
	OPENBSD_4_0:1.6.0.8
	OPENBSD_4_0_BASE:1.6
	OPENBSD_3_9:1.6.0.6
	OPENBSD_3_9_BASE:1.6
	OPENBSD_3_8:1.6.0.4
	OPENBSD_3_8_BASE:1.6
	OPENBSD_3_7:1.6.0.2
	OPENBSD_3_7_BASE:1.6
	OPENBSD_3_6:1.4.0.2
	OPENBSD_3_6_BASE:1.4
	OPENBSD_3_5:1.2.0.2
	OPENBSD_3_5_BASE:1.2;
locks; strict;
comment	@# @;


1.7
date	2014.07.11.16.36.35;	author deraadt;	state dead;
branches;
next	1.6;
commitid	zWmQWn8GBmYNGdtX;

1.6
date	2005.02.07.06.08.10;	author david;	state Exp;
branches;
next	1.5;

1.5
date	2005.02.03.17.51.12;	author mpf;	state Exp;
branches;
next	1.4;

1.4
date	2004.04.28.01.01.27;	author deraadt;	state Exp;
branches;
next	1.3;

1.3
date	2004.04.27.03.47.55;	author mcbride;	state Exp;
branches;
next	1.2;

1.2
date	2004.03.17.23.58.27;	author mcbride;	state Exp;
branches;
next	1.1;

1.1
date	2004.02.04.23.49.36;	author mcbride;	state Exp;
branches;
next	;


desc
@@


1.7
log
@move a few more...
@
text
@# $OpenBSD: ifstated.conf,v 1.6 2005/02/07 06:08:10 david Exp $
# This is a sample config for a pair of firewalls with two interfaces
#
# carp0 and carp1 have ip addresses on 192.168.3.0/24 and 192.168.6.0/24
# respectively.

# net.inet.carp.preempt must be enabled (set to 1) for this to work correctly.

# Uncomment one of the following lines to force primary/backup status.
# init-state primary
# init-state backup

carp_up = "carp0.link.up && carp1.link.up"
carp_down = "!carp0.link.up && !carp1.link.up"
carp_sync = "carp0.link.up && carp1.link.up || \
    !carp0.link.up && !carp1.link.up"

# The "net" addresses are other addresses which can be used to determine
# whether we have connectivity. Make sure the hosts are always up, or
# test multiple ip's, 'or'-ing the tests.
net = '( "ping -q -c 1 -w 1 192.168.6.8 > /dev/null" every 10 && \
    "ping -q -c 1 -w 1 192.168.3.8 > /dev/null" every 10)'

# The peer addresses below are the real ip addresses of the OTHER firewall
peer = '( "ping -q -c 1 -w 1 192.168.6.7 > /dev/null" every 10 && \
    "ping -q -c 1 -w 1 192.168.3.7 > /dev/null" every 10)'

state auto {
	if $carp_up
		set-state primary
	if $carp_down
		set-state backup
}

state primary {
	init {
		run "ifconfig carp0 advskew 10"
		run "ifconfig carp1 advskew 10"
	}
	if ! $net
		set-state demoted
}

state demoted {
	init {
		run "ifconfig carp0 advskew 254"
		run "ifconfig carp1 advskew 254"
	}
	if $net
		set-state primary
}

state promoted {
	init {
		run "ifconfig carp0 advskew 0"
		run "ifconfig carp1 advskew 0"
	}
	if $peer || ! $net
		set-state backup
}

state backup {
	init {
		run "ifconfig carp0 advskew 100"
		run "ifconfig carp1 advskew 100"
	}
	# The "sleep 5" below is a hack to dampen the $carp_sync when we come
	# out of promoted state. Thinking about the correct fix...
	if ! $carp_sync && $net && "sleep 5" every 10
		if ! $carp_sync && $net
			set-state promoted
}
@


1.6
log
@indentation whitespace nits
@
text
@d1 1
a1 1
# $OpenBSD: ifstated.conf,v 1.5 2005/02/03 17:51:12 mpf Exp $
@


1.5
log
@Simplify the ifstated syntax:

 "carp0 link up" => carp0.link.up
 "and"           => &&
 "or"            => ||

* Allow one line actions after if statements without braces.
* Remove unecessary parentheses in the example config.

ok mcbride@@
@
text
@d1 1
a1 1
# $OpenBSD: ifstated.conf,v 1.4 2004/04/28 01:01:27 deraadt Exp $
d40 2
a41 2
        if ! $net
                set-state demoted
d49 2
a50 2
        if $net
                set-state primary
d68 1
a68 1
        # out of promoted state. Thinking about the correct fix...
@


1.4
log
@spacing
@
text
@d1 1
a1 1
# $OpenBSD: ifstated.conf,v 1.3 2004/04/27 03:47:55 mcbride Exp $
d13 4
a16 4
carp_up = "((carp0 link up) and (carp1 link up))"
carp_down = "((! carp0 link up) and (! carp1 link up))"
carp_sync = "((carp0 link up and carp1 link up) or \
    ((!carp0 link up) and (!carp1 link up)))"
d21 1
a21 1
net = '( "ping -q -c 1 -w 1 192.168.6.8 > /dev/null" every 10 and \
d25 1
a25 1
peer = '( "ping -q -c 1 -w 1 192.168.6.7 > /dev/null" every 10 and \
d29 1
a29 1
	if $carp_up {
d31 1
a31 2
	}
	if $carp_down {
a32 1
	}
d40 1
a40 1
        if ! $net {
a41 1
        }
d49 1
a49 1
        if $net {
a50 1
        }
d58 1
a58 1
	if $peer or ! $net {
a59 1
	}
d69 2
a70 2
	if ! $carp_sync and $net and "sleep 5" every 10 {
		if (! $carp_sync) and $net {
a71 2
		}
	}
@


1.3
log
@Fix typo in ifstated.conf. Reported by matthew zeier, then forgotten...
re-reported by Jan Filipovsky.
@
text
@d1 1
a1 1
# $OpenBSD: ifstated.conf,v 1.2 2004/03/17 23:58:27 mcbride Exp $
d5 1
a5 1
# respectively. 
d19 1
a19 1
# whether we have connectivity. Make sure the hosts are always up, or 
d34 1
a34 1
	}	
@


1.2
log
@Document need for net.inet.carp.preempt to be enabled.

ok markus@@ henning@@
@
text
@d1 1
a1 1
# $OpenBSD: ifstated.conf,v 1.1 2004/02/04 23:49:36 mcbride Exp $
d10 1
a10 1
# init state primary
@


1.1
log
@Add initial sample config for ifstated. Syntax will change.

ok deraadt@@
@
text
@d1 1
a1 1
# $OpenBSD$
d6 2
@

