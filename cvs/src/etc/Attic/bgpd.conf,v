head	1.17;
access;
symbols
	OPENBSD_5_5:1.16.0.4
	OPENBSD_5_5_BASE:1.16
	OPENBSD_5_4:1.14.0.2
	OPENBSD_5_4_BASE:1.14
	OPENBSD_5_3:1.13.0.4
	OPENBSD_5_3_BASE:1.13
	OPENBSD_5_2:1.13.0.2
	OPENBSD_5_2_BASE:1.13
	OPENBSD_5_1_BASE:1.12
	OPENBSD_5_1:1.12.0.6
	OPENBSD_5_0:1.12.0.4
	OPENBSD_5_0_BASE:1.12
	OPENBSD_4_9:1.12.0.2
	OPENBSD_4_9_BASE:1.12
	OPENBSD_4_8:1.9.0.4
	OPENBSD_4_8_BASE:1.9
	OPENBSD_4_7:1.9.0.2
	OPENBSD_4_7_BASE:1.9
	OPENBSD_4_6:1.8.0.12
	OPENBSD_4_6_BASE:1.8
	OPENBSD_4_5:1.8.0.8
	OPENBSD_4_5_BASE:1.8
	OPENBSD_4_4:1.8.0.6
	OPENBSD_4_4_BASE:1.8
	OPENBSD_4_3:1.8.0.4
	OPENBSD_4_3_BASE:1.8
	OPENBSD_4_2:1.8.0.2
	OPENBSD_4_2_BASE:1.8
	OPENBSD_4_1:1.7.0.10
	OPENBSD_4_1_BASE:1.7
	OPENBSD_4_0:1.7.0.8
	OPENBSD_4_0_BASE:1.7
	OPENBSD_3_9:1.7.0.6
	OPENBSD_3_9_BASE:1.7
	OPENBSD_3_8:1.7.0.4
	OPENBSD_3_8_BASE:1.7
	OPENBSD_3_7:1.7.0.2
	OPENBSD_3_7_BASE:1.7
	OPENBSD_3_6:1.6.0.2
	OPENBSD_3_6_BASE:1.6
	OPENBSD_3_5:1.3.0.2
	OPENBSD_3_5_BASE:1.3;
locks; strict;
comment	@# @;


1.17
date	2014.07.11.17.10.30;	author henning;	state dead;
branches;
next	1.16;
commitid	Ss8oCxVxOZaeRa5k;

1.16
date	2014.02.15.00.18.07;	author pelikan;	state Exp;
branches;
next	1.15;

1.15
date	2013.08.14.21.25.43;	author claudio;	state Exp;
branches;
next	1.14;

1.14
date	2013.06.02.14.11.38;	author florian;	state Exp;
branches;
next	1.13;

1.13
date	2012.04.27.12.02.47;	author phessler;	state Exp;
branches;
next	1.12;

1.12
date	2011.01.19.07.36.40;	author claudio;	state Exp;
branches;
next	1.11;

1.11
date	2010.11.28.17.11.43;	author claudio;	state Exp;
branches;
next	1.10;

1.10
date	2010.10.13.08.27.44;	author sthen;	state Exp;
branches;
next	1.9;

1.9
date	2009.11.20.19.51.05;	author claudio;	state Exp;
branches;
next	1.8;

1.8
date	2007.03.29.13.37.35;	author claudio;	state Exp;
branches;
next	1.7;

1.7
date	2004.10.01.15.12.16;	author henning;	state Exp;
branches;
next	1.6;

1.6
date	2004.05.08.21.04.47;	author henning;	state Exp;
branches;
next	1.5;

1.5
date	2004.05.08.18.43.06;	author henning;	state Exp;
branches;
next	1.4;

1.4
date	2004.05.05.15.25.04;	author henning;	state Exp;
branches;
next	1.3;

1.3
date	2004.02.07.20.03.30;	author henning;	state Exp;
branches;
next	1.2;

1.2
date	2003.12.28.12.52.28;	author henning;	state Exp;
branches;
next	1.1;

1.1
date	2003.12.24.14.12.40;	author henning;	state Exp;
branches;
next	;


desc
@@


1.17
log
@my pleasure to move bgpd.conf to examples. ok theo
@
text
@# $OpenBSD: bgpd.conf,v 1.16 2014/02/15 00:18:07 pelikan Exp $
# sample bgpd configuration file
# see bgpd.conf(5)

#macros
peer1="10.1.0.2"
peer2="10.1.0.3"

# global configuration
AS 65001
router-id 10.0.0.1
# holdtime 180
# holdtime min 3
# listen on 127.0.0.1
# listen on ::1
# fib-update no
# route-collector no
# log updates
# network 10.0.1.0/24

# restricted socket for bgplg(8)
# socket "/var/www/run/bgpd.rsock" restricted

# neighbors and peers
group "peering AS65002" {
	remote-as 65002
	neighbor $peer1 {
		descr	"AS 65001 peer 1"
		announce self
		tcp md5sig password mekmitasdigoat
	}
	neighbor $peer2 {
		descr "AS 65001 peer 2"
		announce all
		local-address 10.0.0.8
		ipsec esp ike
	}
}

group "peering AS65042" {
	descr "peering AS 65042"
	local-address 10.0.0.8
	ipsec ah ike
	neighbor 10.2.0.1
	neighbor 10.2.0.2
}

neighbor 10.0.1.0 {
	remote-as	65003
	descr		upstream
	multihop	2
	local-address	10.0.0.8
	passive
	holdtime	180
	holdtime min	3
	announce	none
	tcp md5sig key	deadbeef
}

neighbor 10.0.2.0 {
	remote-as	65004
	descr		upstream2
	local-address	10.0.0.8
	ipsec ah ike
}

neighbor 10.0.0.0/24 {
	descr		"template for local peers"
}

neighbor 10.2.1.1 {
	remote-as 65023
	local-address 10.0.0.8
	ipsec esp in  spi 10 sha1 0a4f1d1f1a1c4f3c9e2f6f0f2a8e9c8c5a1b0b3b \
	    aes 0c1b3a6c7d7a8d2e0e7b4f3d5e8e6c1e
	ipsec esp out spi 12 sha1 0e9c8f6a8e2c7d3a0b5d0d0f0a3c5c1d2b8e0f8b \
	    aes 4e0f2f1b5c4e3c0d0e2f2d3b8c5c8f0b
}

# filter out prefixes longer than 24 or shorter than 8 bits for IPv4
# and longer than 48 or shorter than 16 bits for IPv6.
deny from any
allow from any inet prefixlen 8 - 24
allow from any inet6 prefixlen 16 - 48

# accept a default route (since the previous rule blocks this)
#allow from any prefix 0.0.0.0/0
#allow from any prefix ::/0

# filter bogus networks according to RFC5735
deny from any prefix 0.0.0.0/8 prefixlen >= 8		# 'this' network [RFC1122]
deny from any prefix 10.0.0.0/8 prefixlen >= 8		# private space [RFC1918]
deny from any prefix 100.64.0.0/10 prefixlen >= 10	# CGN Shared [RFC6598]
deny from any prefix 127.0.0.0/8 prefixlen >= 8 	# localhost [RFC1122]
deny from any prefix 169.254.0.0/16 prefixlen >= 16	# link local [RFC3927]
deny from any prefix 172.16.0.0/12 prefixlen >= 12	# private space [RFC1918]
deny from any prefix 192.0.2.0/24 prefixlen >= 24	# TEST-NET-1 [RFC5737]
deny from any prefix 192.168.0.0/16 prefixlen >= 16	# private space [RFC1918]
deny from any prefix 198.18.0.0/15 prefixlen >= 15	# benchmarking [RFC2544]
deny from any prefix 198.51.100.0/24 prefixlen >= 24	# TEST-NET-2 [RFC5737]
deny from any prefix 203.0.113.0/24 prefixlen >= 24	# TEST-NET-3 [RFC5737]
deny from any prefix 224.0.0.0/4 prefixlen >= 4 	# multicast
deny from any prefix 240.0.0.0/4 prefixlen >= 4 	# reserved

# filter bogus IPv6 networks according to IANA
deny from any prefix ::/8 prefixlen >= 8
deny from any prefix 0100::/64 prefixlen >= 64		# Discard-Only [RFC6666]
deny from any prefix 2001:2::/48 prefixlen >= 48	# BMWG [RFC5180]
deny from any prefix 2001:10::/28 prefixlen >= 28	# ORCHID [RFC4843]
deny from any prefix 2001:db8::/32 prefixlen >= 32	# docu range [RFC3849]
deny from any prefix 3ffe::/16 prefixlen >= 16		# old 6bone
deny from any prefix fc00::/7 prefixlen >= 7		# unique local unicast
deny from any prefix fe80::/10 prefixlen >= 10		# link local unicast
deny from any prefix fec0::/10 prefixlen >= 10		# old site local unicast
deny from any prefix ff00::/8 prefixlen >= 8		# multicast
@


1.16
log
@Show the exemplary rules for accepting default routes for IPv6 as well.

ok sthen florian
@
text
@d1 1
a1 1
# $OpenBSD: bgpd.conf,v 1.15 2013/08/14 21:25:43 claudio Exp $
@


1.15
log
@Filter the IPv6 Discard-Only Prefix because it should not be globally
routable. See RFC6666. Diff by Gleydson Soares.
@
text
@d1 1
a1 1
# $OpenBSD: bgpd.conf,v 1.14 2013/06/02 14:11:38 florian Exp $
d88 1
@


1.14
log
@move bgplg and slowcgi sockets to /var/www/run
input reyk@@, guenther@@
"move fast" deraadt@@
OK naddy@@
@
text
@d1 1
a1 1
# $OpenBSD: bgpd.conf,v 1.13 2012/04/27 12:02:47 phessler Exp $
d106 1
@


1.13
log
@Add a brief comment describing each bogus v4 network that is filtered by
default, similar to the v6 entries.

While here, add a filter for 100.64.0.0/10, which is now reserved by RFC 6598

OK henning@@, sthen@@
@
text
@d1 1
a1 1
# $OpenBSD: bgpd.conf,v 1.12 2011/01/19 07:36:40 claudio Exp $
d22 1
a22 1
# socket "/var/www/logs/bgpd.rsock" restricted
@


1.12
log
@Add 2001:2::/48 (prefix used for benchmarking) to the list of
non-routeable prefixes. While there sort list.
Diff provided by Andre Keller.
@
text
@d1 1
a1 1
# $OpenBSD: bgpd.conf,v 1.11 2010/11/28 17:11:43 claudio Exp $
d90 13
a102 12
deny from any prefix 0.0.0.0/8 prefixlen >= 8
deny from any prefix 10.0.0.0/8 prefixlen >= 8
deny from any prefix 127.0.0.0/8 prefixlen >= 8
deny from any prefix 169.254.0.0/16 prefixlen >= 16
deny from any prefix 172.16.0.0/12 prefixlen >= 12
deny from any prefix 192.0.2.0/24 prefixlen >= 24
deny from any prefix 192.168.0.0/16 prefixlen >= 16
deny from any prefix 198.18.0.0/15 prefixlen >= 15
deny from any prefix 198.51.100.0/24 prefixlen >= 24
deny from any prefix 203.0.113.0/24 prefixlen >= 24
deny from any prefix 224.0.0.0/4 prefixlen >= 4
deny from any prefix 240.0.0.0/4 prefixlen >= 4
@


1.11
log
@Update example filterset to include a basic IPv6 filterset.
While there extend the current IPv4 filterset.
OK sthen@@, henning@@
@
text
@d1 1
a1 1
# $OpenBSD: bgpd.conf,v 1.10 2010/10/13 08:27:44 sthen Exp $
d105 2
a107 1
deny from any prefix 2001:10::/28 prefixlen >= 28	# ORCHID [RFC4843]
@


1.10
log
@add a sample for "socket ... restricted", prompted by mail from
Patrick Lamaiziere, ok henning@@
@
text
@d1 1
a1 1
# $OpenBSD: bgpd.conf,v 1.9 2009/11/20 19:51:05 claudio Exp $
d80 2
a81 1
# filter out prefixes longer than 24 or shorter than 8 bits
d84 1
d89 2
a90 1
# filter bogus networks
d92 2
d95 1
d97 3
a99 2
deny from any prefix 169.254.0.0/16 prefixlen >= 16
deny from any prefix 192.0.2.0/24 prefixlen >= 24
d102 10
@


1.9
log
@The deny all and allow from any inet prefixlen 8 - 24 will block the default
route already so don't add an additional rule for that. Instead add a commented
allow rule. Idea from Mitja Muzenic (mitja at muzenic dot net)
@
text
@d1 1
a1 1
# $OpenBSD: bgpd.conf,v 1.8 2007/03/29 13:37:35 claudio Exp $
d20 3
@


1.8
log
@Update config because of the new way prefixlen works. The prefixlen 8 - 24
rule needs an explicit "inet" to match on IPv4 addresses only. OK henning@@
@
text
@d1 1
a1 1
# $OpenBSD: bgpd.conf,v 1.7 2004/10/01 15:12:16 henning Exp $
d81 2
a82 2
# do not accept a default route
deny from any prefix 0.0.0.0/0
@


1.7
log
@comment out the listen on statements, we don't want any by default,
and some minor tweaks
@
text
@d1 1
a1 1
# $OpenBSD: bgpd.conf,v 1.6 2004/05/08 21:04:47 henning Exp $
d79 1
a79 1
allow from any prefixlen 8 - 24
@


1.6
log
@add an example neighbor with manual keyed IPsec
@
text
@d1 1
a1 1
# $OpenBSD: bgpd.conf,v 1.5 2004/05/08 18:43:06 henning Exp $
d12 6
a17 6
holdtime 180
holdtime min 3
listen on 127.0.0.1
listen on ::1
fib-update no
# route-collector yes
@


1.5
log
@king bula likes more sample fluff
@
text
@d1 1
a1 1
# $OpenBSD: bgpd.conf,v 1.4 2004/05/05 15:25:04 henning Exp $
d66 9
@


1.4
log
@provide some filter examples; PR3764
@
text
@d1 1
a1 1
# $OpenBSD: bgpd.conf,v 1.3 2004/02/07 20:03:30 henning Exp $
d6 2
a7 2
peer1="10.0.0.2"
peer2="10.0.0.3"
d15 1
d17 1
d30 1
a30 1
		descr	"AS 65001 peer 2"
d32 2
d37 8
d55 11
@


1.3
log
@king bula sez: you shall have fluffy sample configs
@
text
@d1 1
a1 1
# $OpenBSD: bgpd.conf,v 1.2 2003/12/28 12:52:28 henning Exp $
d45 15
@


1.2
log
@cope with recent changes and add examples for the new keywords
@
text
@d1 1
a1 1
# $OpenBSD: bgpd.conf,v 1.1 2003/12/24 14:12:40 henning Exp $
d15 1
a15 1
# fib-update no
d17 1
d24 2
d29 1
d39 4
@


1.1
log
@add sample bgpd.conf, not yet connected
requested by theo
@
text
@d1 1
a1 1
# $OpenBSD$
d11 1
a11 1
bgpid 10.0.0.1
d15 2
a16 1
# no fib-update
d33 2
a34 1
	local-addr	10.0.0.8
@

