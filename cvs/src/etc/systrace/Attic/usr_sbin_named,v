head	1.9;
access;
symbols
	OPENBSD_5_6:1.8.0.4
	OPENBSD_5_6_BASE:1.8
	OPENBSD_5_5:1.6.0.18
	OPENBSD_5_5_BASE:1.6
	OPENBSD_5_4:1.6.0.14
	OPENBSD_5_4_BASE:1.6
	OPENBSD_5_3:1.6.0.12
	OPENBSD_5_3_BASE:1.6
	OPENBSD_5_2:1.6.0.10
	OPENBSD_5_2_BASE:1.6
	OPENBSD_5_1_BASE:1.6
	OPENBSD_5_1:1.6.0.8
	OPENBSD_5_0:1.6.0.6
	OPENBSD_5_0_BASE:1.6
	OPENBSD_4_9:1.6.0.4
	OPENBSD_4_9_BASE:1.6
	OPENBSD_4_8:1.6.0.2
	OPENBSD_4_8_BASE:1.6
	OPENBSD_4_7:1.5.0.22
	OPENBSD_4_7_BASE:1.5
	OPENBSD_4_6:1.5.0.24
	OPENBSD_4_6_BASE:1.5
	OPENBSD_4_5:1.5.0.20
	OPENBSD_4_5_BASE:1.5
	OPENBSD_4_4:1.5.0.18
	OPENBSD_4_4_BASE:1.5
	OPENBSD_4_3:1.5.0.16
	OPENBSD_4_3_BASE:1.5
	OPENBSD_4_2:1.5.0.14
	OPENBSD_4_2_BASE:1.5
	OPENBSD_4_1:1.5.0.12
	OPENBSD_4_1_BASE:1.5
	OPENBSD_4_0:1.5.0.10
	OPENBSD_4_0_BASE:1.5
	OPENBSD_3_9:1.5.0.8
	OPENBSD_3_9_BASE:1.5
	OPENBSD_3_8:1.5.0.6
	OPENBSD_3_8_BASE:1.5
	OPENBSD_3_7:1.5.0.4
	OPENBSD_3_7_BASE:1.5
	OPENBSD_3_6:1.5.0.2
	OPENBSD_3_6_BASE:1.5
	OPENBSD_3_5:1.4.0.6
	OPENBSD_3_5_BASE:1.4
	OPENBSD_3_4:1.4.0.4
	OPENBSD_3_4_BASE:1.4
	OPENBSD_3_3:1.4.0.2
	OPENBSD_3_3_BASE:1.4
	OPENBSD_3_2:1.1.0.2
	OPENBSD_3_2_BASE:1.1;
locks; strict;
comment	@# @;


1.9
date	2014.08.22.19.19.25;	author deraadt;	state dead;
branches;
next	1.8;
commitid	DjPuiMfLSQV3ARle;

1.8
date	2014.07.20.04.29.07;	author deraadt;	state Exp;
branches;
next	1.7;
commitid	JEUSmxx66WZ4deOp;

1.7
date	2014.07.14.05.48.18;	author guenther;	state Exp;
branches;
next	1.6;
commitid	qSWgaNNarWWulHG7;

1.6
date	2010.07.23.03.13.51;	author ray;	state Exp;
branches;
next	1.5;

1.5
date	2004.05.13.04.50.04;	author sturm;	state Exp;
branches;
next	1.4;

1.4
date	2003.02.09.22.40.24;	author djm;	state Exp;
branches;
next	1.3;

1.3
date	2003.02.06.10.55.56;	author jakob;	state Exp;
branches;
next	1.2;

1.2
date	2003.02.04.14.52.51;	author jakob;	state Exp;
branches;
next	1.1;

1.1
date	2002.07.18.20.37.47;	author provos;	state Exp;
branches;
next	;


desc
@@


1.9
log
@disable use of bind in base; in the base use nsd/unbound instead.
a proper & complete bind port will show up.
discussed with many for years
@
text
@# $OpenBSD: usr_sbin_named,v 1.8 2014/07/20 04:29:07 deraadt Exp $
#
# Policy for named that uses named user and chroots to /var/named
# This policy works for the default configuration of named.
#
Policy: /usr/sbin/named, Emulation: native
	native-__sysctl: permit
	native-accept: permit
	native-bind: sockaddr match "inet-*:0" then permit
	native-bind: sockaddr match "inet-*:53" then permit
	native-bind: sockaddr match "inet-*:953" then permit
	native-break: permit
	native-chdir: filename eq "/" then permit
	native-chroot: filename eq "/var/named" then permit
	native-close: permit
	native-closefrom: permit
	native-connect: sockaddr match "inet-*" then permit
	native-dup2: permit
	native-exit: permit
	native-fcntl: permit
	native-fork: permit
	native-fsread: filename sub "<non-existent filename>" then deny[enoent]
	native-fsread: filename eq "/etc/malloc.conf" then permit
	native-fsread: filename eq "/dev/arandom" then permit
	native-fsread: filename eq "/etc/group" then permit
	native-fsread: filename eq "/etc/named.conf" then permit
	native-fsread: filename eq "/etc/named.keys" then permit
	native-fsread: filename eq "/etc/pwd.db" then permit
	native-fsread: filename eq "/etc/rndc.key" then permit
	native-fsread: filename eq "/etc/root.hint" then permit
	native-fsread: filename eq "/etc/spwd.db" then deny[eperm]
	native-fsread: filename match "/master" then permit
	native-fsread: filename match "/slave" then permit
	native-fsread: filename match "/standard" then permit
	native-fsread: filename match "/usr/lib" then permit
	native-fsread: filename eq "/usr/libexec/ld.so" then permit
	native-fsread: filename match "/usr/share/nls" then permit
	native-fsread: filename match "/usr/share/zoneinfo" then permit
	native-fsread: filename eq "/var/run/ld.so.hints" then permit
	native-fsread: filename eq "/var/run/named.pid" then permit
	native-fstat: permit
	native-fswrite: filename sub "<non-existent filename>" then deny[enoent]
	native-fswrite: filename eq "/dev/null" then permit
	native-fswrite: filename match "/master/*" then permit
	native-fswrite: filename match "/slave/*" then permit
	native-fswrite: filename eq "/var/run/named.pid" then permit
	native-fswrite: filename match "/var/tmp/*" then permit
	native-fsync: permit
	native-getentropy: permit
	native-getpid: permit
	native-getppid: permit
	native-getrlimit: permit
	native-getsockname: permit
	native-getsockopt: permit
	native-gettimeofday: permit
	native-getuid: permit
	native-geteuid: permit
	native-issetugid: permit
	native-kill: permit
	native-listen: permit
	native-lseek: permit
	native-minherit: permit
	native-mmap: permit
	native-mprotect: permit
	native-mquery: permit
	native-munmap: permit
	native-nanosleep: permit
	native-pipe: permit
	native-pread: permit
	native-read: permit
	native-recvmsg: permit
	native-rename: filename match "/slave/*" and filename[1] match "/slave/*" then permit
	native-select: permit
	native-sendmsg: permit
	native-sendsyslog: permit
	native-sendto: true then permit
	native-setegid: gid eq "70" then permit
	native-seteuid: uid eq "70" and uname eq "named" then permit
	native-setgid: gid eq "70" then permit
	native-setgroups: permit
	native-setresgid: permit
	native-setresuid: permit
	native-setrlimit: permit
	native-setsid: permit
	native-setsockopt: permit
	native-setuid: uid eq "70" and uname eq "named" then permit
	native-sigaction: permit
	native-sigprocmask: permit
	native-sigreturn: permit
	native-socket: permit
	native-socketpair: permit
	native-utimes: permit
	native-wait4: permit
	native-write: permit
@


1.8
log
@no longer play with /dev/log
@
text
@d1 1
a1 1
# $OpenBSD: usr_sbin_named,v 1.7 2014/07/14 05:48:18 guenther Exp $
@


1.7
log
@Update for arc4random and syslog changes
@
text
@d1 1
a1 1
# $OpenBSD: usr_sbin_named,v 1.6 2010/07/23 03:13:51 ray Exp $
a16 1
	native-connect: sockaddr eq "/dev/log" then permit
@


1.6
log
@Permit a few more syscalls for named to run.

OK deraadt
@
text
@d1 1
a1 1
# $OpenBSD: usr_sbin_named,v 1.5 2004/05/13 04:50:04 sturm Exp $
d50 1
d63 1
d76 1
@


1.5
log
@- update policies to what is actually needed in -current
- deny access to /etc/spwd.db, permit pwd.db instead
- fixes pr 3748
- cosmetics

"toss it in" deraadt@@
@
text
@d1 1
a1 1
# $OpenBSD: usr_sbin_named,v 1.4 2003/02/09 22:40:24 djm Exp $
d31 1
d67 1
d79 2
@


1.4
log
@bind9 needs nanosleep too; ok jakob@@
@
text
@d1 1
a1 1
# $OpenBSD: usr_sbin_named,v 1.3 2003/02/06 10:55:56 jakob Exp $
d16 1
d29 1
d31 5
a35 8
	native-fsread: filename eq "/etc/spwd.db" then permit
	native-fsread: filename eq "/master" then permit
	native-fsread: filename match "/master/*" then permit
	native-fsread: filename eq "/slave" then permit
	native-fsread: filename match "/slave/*" then permit
	native-fsread: filename eq "/standard" then permit
	native-fsread: filename match "/standard/*" then permit
	native-fsread: filename match "/usr/lib/*" then permit
d37 2
a38 2
	native-fsread: filename match "/usr/share/nls/*" then permit
	native-fsread: filename match "/usr/share/zoneinfo/*" then permit
d50 1
d63 1
d73 2
d85 1
d87 1
@


1.3
log
@allow to read some directories itself
@
text
@d1 1
a1 1
# $OpenBSD: usr_sbin_named,v 1.2 2003/02/04 14:52:51 jakob Exp $
d64 1
@


1.2
log
@bind9ify
@
text
@d1 1
a1 1
# $OpenBSD$
d30 1
d32 1
d34 1
@


1.1
log
@named policy for systrace
@
text
@d1 2
d5 1
d9 1
d11 1
a13 1
	native-chdir: filename eq "/namedb" then permit
d17 1
d22 2
a23 1
	native-fsread: filename eq "/" then permit
d26 3
a28 5
	native-fsread: filename eq "/etc/localtime" then permit
	native-fsread: filename eq "/etc/malloc.conf" then permit
	native-fsread: filename eq "/etc/protocols" then permit
	native-fsread: filename eq "/etc/resolv.conf" then permit
	native-fsread: filename eq "/etc/services" then permit
d30 4
a33 2
	native-fsread: filename eq "/named.boot" then permit
	native-fsread: filename eq "/usr/lib" then permit
a34 4
	native-fsread: filename eq "/var/run/ld.so.hints" then permit
	native-fsread: filename eq "<non-existent filename>" then deny[enoent]
	native-fsread: filename match "/namedb/*" then permit
	native-fsread: filename match "/usr/lib/*" then permit
d37 2
d40 1
a40 1
	native-fswrite: filename eq "/dev/console" then permit
d42 5
a46 4
	native-fswrite: filename eq "/named.pid" then permit
	native-geteuid: permit
	native-getgid: permit
	native-getpeername: permit
a47 1
	native-getpriority: permit
d49 1
d53 1
d55 1
a60 2
	native-nanosleep: permit
	native-pipe: permit
d63 2
a64 1
	native-recvfrom: permit
d66 1
a69 2
	native-setitimer: permit
	native-setpriority: permit
d73 1
a73 1
	native-setuid: uname eq "named" then permit
d78 1
a78 2
	native-umask: permit
	native-wait4: permit
a79 2
	native-writev: permit

@

