head	1.17;
access;
symbols
	OPENBSD_6_1:1.16.0.4
	OPENBSD_6_1_BASE:1.16
	OPENBSD_6_0:1.14.0.10
	OPENBSD_6_0_BASE:1.14
	OPENBSD_5_9:1.14.0.4
	OPENBSD_5_9_BASE:1.14
	OPENBSD_5_8:1.14.0.6
	OPENBSD_5_8_BASE:1.14
	OPENBSD_5_7:1.14.0.2
	OPENBSD_5_7_BASE:1.14
	OPENBSD_5_6:1.10.0.2
	OPENBSD_5_6_BASE:1.10;
locks; strict;
comment	@# @;


1.17
date	2017.04.16.08.50.49;	author ajacoutot;	state Exp;
branches;
next	1.16;
commitid	DRU2D9pFRXbIEv5d;

1.16
date	2016.09.17.20.05.59;	author tj;	state Exp;
branches;
next	1.15;
commitid	3yzd5xphmxwunuZV;

1.15
date	2016.09.17.15.04.15;	author tj;	state Exp;
branches;
next	1.14;
commitid	ULtM1c9Cu1NqfbYc;

1.14
date	2015.02.04.08.39.35;	author florian;	state Exp;
branches;
next	1.13;
commitid	LPLnLFF0bIalDk65;

1.13
date	2014.12.28.13.55.22;	author reyk;	state Exp;
branches;
next	1.12;
commitid	vhea81TnNQbFR84Q;

1.12
date	2014.12.12.14.45.59;	author reyk;	state Exp;
branches;
next	1.11;
commitid	j2F3LZ1OyONol7u9;

1.11
date	2014.08.25.14.27.54;	author reyk;	state Exp;
branches;
next	1.10;
commitid	9BrKucaQiTo8j21n;

1.10
date	2014.08.06.20.29.54;	author reyk;	state Exp;
branches;
next	1.9;
commitid	JDxuBybaCzkECcWt;

1.9
date	2014.08.05.18.01.10;	author reyk;	state Exp;
branches;
next	1.8;
commitid	bNgJHQQ6lNzksAJO;

1.8
date	2014.08.04.17.50.48;	author reyk;	state Exp;
branches;
next	1.7;
commitid	WchbetI8ClCwbsWN;

1.7
date	2014.08.04.16.07.59;	author reyk;	state Exp;
branches;
next	1.6;
commitid	DOpcuTQXLhUVV2le;

1.6
date	2014.08.03.11.51.40;	author reyk;	state Exp;
branches;
next	1.5;
commitid	XQkOu38V434Wblfe;

1.5
date	2014.08.03.11.28.58;	author reyk;	state Exp;
branches;
next	1.4;
commitid	Px3oQ1B2bO5F2mzR;

1.4
date	2014.07.30.10.05.14;	author reyk;	state Exp;
branches;
next	1.3;
commitid	crg28r1097elBMcd;

1.3
date	2014.07.29.16.17.28;	author reyk;	state Exp;
branches;
next	1.2;
commitid	lVEJBNunwU7ia3Go;

1.2
date	2014.07.26.10.27.19;	author reyk;	state Exp;
branches;
next	1.1;
commitid	AqzeBzlOk1E3tbTr;

1.1
date	2014.07.22.16.58.21;	author reyk;	state Exp;
branches;
next	;
commitid	UAfgqiH6irJs9Wol;


desc
@@


1.17
log
@Remove /etc/ssl/acme/. We don't need it now that we have a default acme-conf(5)
that direclty uses /etc/ssl/{,private} by default. Adapt the httpd.conf example
accordingly.

ok florian@@ benno@@ millert@@
@
text
@# $OpenBSD: httpd.conf,v 1.16 2016/09/17 20:05:59 tj Exp $

#
# Macros
#
ext_addr="*"

#
# Global Options
#
# prefork 3

#
# Servers
#

# A minimal default server
server "default" {
	listen on $ext_addr port 80
}

# A name-based "virtual" server on the same address
server "www.example.com" {
	listen on $ext_addr port 80

	# Logging is enabled by default, but it can be turned off per server
	#no log

	location "/pub/*" {
		directory auto index
		log style combined
	}

	location "*.php" {
		fastcgi socket "/run/php-fpm.sock"
	}

	location "/cgi-bin/*" {
		fastcgi

		# The /cgi-bin directory is outside of the document root
		root "/"
	}

	root "/htdocs/www.example.com"
}

# An HTTPS server using SSL/TLS
server "secure.example.com" {
	listen on 127.0.0.1 tls port 443

	# TLS certificate and key files created with acme-client(1)             
	tls certificate "/etc/ssl/example.com.fullchain.pem"
	tls key "/etc/ssl/private/example.com.key"

	# Define server-specific log files relative to /logs
	log { access "secure-access.log", error "secure-error.log" }

	# Increase connection limits to extend the lifetime
	connection { max requests 500, timeout 3600 }

	root "/htdocs/secure.example.com"
}

# Another server on a different internal IPv4 address
server "intranet.example.com" {
	listen on 10.0.0.1 port 80
	directory { auto index, index "default.htm" }
	root "/htdocs/intranet.example.com"
}

# An IPv6-based server on a non-standard port
server "ipv6.example.com" {
	listen on 2001:db8::53f6:3eab port 81
	root "/htdocs/ipv6.example.com"
}

# Include MIME types instead of the built-in ones
types {
	include "/usr/share/misc/mime.types"
}
@


1.16
log
@pathnames for cert and key files need to be quoted.

reported by brynet
@
text
@d1 1
a1 1
# $OpenBSD: httpd.conf,v 1.15 2016/09/17 15:04:15 tj Exp $
d53 2
a54 2
	tls certificate "/etc/ssl/acme/fullchain.pem"
	tls key "/etc/ssl/acme/private/privkey.pem"
@


1.15
log
@add example certificate and key files generated with acme-client.

ok florian
@
text
@d1 1
a1 1
# $OpenBSD: httpd.conf,v 1.14 2015/02/04 08:39:35 florian Exp $
d53 2
a54 2
	tls certificate /etc/ssl/acme/fullchain.pem                             
	tls key /etc/ssl/acme/private/privkey.pem
@


1.14
log
@Typo
From Michael (lesniewskister AT gmail), thanks!
@
text
@d1 1
a1 1
# $OpenBSD: httpd.conf,v 1.13 2014/12/28 13:55:22 reyk Exp $
d51 4
@


1.13
log
@Change the default ext_addr from "egress" to "*".  Listening on the
egress group only works if you have a default route; this confused
some people.
@
text
@d1 1
a1 1
# $OpenBSD: httpd.conf,v 1.12 2014/12/12 14:45:59 reyk Exp $
d65 1
a65 1
	root "/htdocs/internet.example.com"
@


1.12
log
@Like previously done in relayd, change the keyword "ssl" to "tls" to
reflect reality.

OK benno@@
@
text
@d1 1
a1 1
# $OpenBSD: httpd.conf,v 1.11 2014/08/25 14:27:54 reyk Exp $
d6 1
a6 1
ext_addr="egress"
@


1.11
log
@Add a generic system-wide /usr/share/misc/mime.types file that can be
included in httpd.conf.  httpd(8) now supports both mime.types
flavours with or without semicolon at the end of the line (nginx- or
apache-style).

Discussed with many, with input from halex@@
OK halex@@
@
text
@d1 1
a1 1
# $OpenBSD: httpd.conf,v 1.10 2014/08/06 20:29:54 reyk Exp $
d50 1
a50 1
	listen on 127.0.0.1 ssl port 443
@


1.10
log
@Change grammar to remove a shift/reduce conflict that was introduced
with the ssl options.
"listen on $ip port 443 ssl" turns into "listen on $ip ssl port 443".

ok florian@@
@
text
@d1 1
a1 1
# $OpenBSD: httpd.conf,v 1.9 2014/08/05 18:01:10 reyk Exp $
d72 5
@


1.9
log
@Add configuration options for the most-important connection limits:
max requests (per connection) and timeout.  We don't want to add too
many button, and there are good defaults, but these ones are kind of
mandatory.
@
text
@d1 1
a1 1
# $OpenBSD: httpd.conf,v 1.8 2014/08/04 17:50:48 reyk Exp $
d50 1
a50 1
	listen on 127.0.0.1 port 443 ssl
@


1.8
log
@Add HTTPS server example.
@
text
@d1 1
a1 1
# $OpenBSD: httpd.conf,v 1.7 2014/08/04 16:07:59 reyk Exp $
d51 7
@


1.7
log
@Change grammar from "log [style]" to "log style [style]".
@
text
@d1 1
a1 1
# $OpenBSD: httpd.conf,v 1.6 2014/08/03 11:51:40 reyk Exp $
d46 6
@


1.6
log
@The first server example should be the "minimal default" to illustrate
that you don't have to push all kinds of buttons to run httpd.
@
text
@d1 1
a1 1
# $OpenBSD: httpd.conf,v 1.5 2014/08/03 11:28:58 reyk Exp $
d31 1
a31 1
		log combined
@


1.5
log
@More examples, include FastCGI for php and cgi-bin and logging.
@
text
@d1 1
a1 1
# $OpenBSD: httpd.conf,v 1.4 2014/07/30 10:05:14 reyk Exp $
d3 1
d5 1
d8 1
d10 1
d13 1
d15 3
d20 5
a43 1
}
a44 3
# A name-based "virtual" server on the same address
server "www.example.com" {
	listen on $ext_addr port 80
@


1.4
log
@Add "location" keyword to specify path-specific configuration in
servers, for example auto index for a sub-directory only.  Internally,
a "location" is just a special type of a "virtual" server.
@
text
@d1 1
a1 1
# $OpenBSD: httpd.conf,v 1.3 2014/07/29 16:17:28 reyk Exp $
d12 4
d18 12
@


1.3
log
@Add extended directory index options: "[no] index" and "[no] auto index".
The option "directory auto index" implements basic directory listing
and is turned off by default.

ok deraadt@@
@
text
@d1 1
a1 1
# $OpenBSD: httpd.conf,v 1.2 2014/07/26 10:27:19 reyk Exp $
d12 3
@


1.2
log
@Add more examples.  Requested by deraadt@@
@
text
@d1 1
a1 1
# $OpenBSD: httpd.conf,v 1.1 2014/07/22 16:58:21 reyk Exp $
d23 1
@


1.1
log
@Add initial httpd.conf(5) example for httpd(8)

Requested by deraadt@@
@
text
@d1 1
a1 1
# $OpenBSD$
d12 18
@

