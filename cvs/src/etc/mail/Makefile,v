head	1.13;
access;
symbols
	OPENBSD_6_2:1.13.0.4
	OPENBSD_6_2_BASE:1.13
	OPENBSD_6_1:1.13.0.8
	OPENBSD_6_1_BASE:1.13
	OPENBSD_6_0:1.13.0.6
	OPENBSD_6_0_BASE:1.13
	OPENBSD_5_9:1.13.0.2
	OPENBSD_5_9_BASE:1.13
	OPENBSD_5_8:1.11.0.4
	OPENBSD_5_8_BASE:1.11
	OPENBSD_5_7:1.10.0.2
	OPENBSD_5_7_BASE:1.10
	OPENBSD_5_6:1.8.0.4
	OPENBSD_5_6_BASE:1.8
	OPENBSD_5_5:1.7.0.22
	OPENBSD_5_5_BASE:1.7
	OPENBSD_5_4:1.7.0.18
	OPENBSD_5_4_BASE:1.7
	OPENBSD_5_3:1.7.0.16
	OPENBSD_5_3_BASE:1.7
	OPENBSD_5_2:1.7.0.14
	OPENBSD_5_2_BASE:1.7
	OPENBSD_5_1_BASE:1.7
	OPENBSD_5_1:1.7.0.12
	OPENBSD_5_0:1.7.0.10
	OPENBSD_5_0_BASE:1.7
	OPENBSD_4_9:1.7.0.8
	OPENBSD_4_9_BASE:1.7
	OPENBSD_4_8:1.7.0.6
	OPENBSD_4_8_BASE:1.7
	OPENBSD_4_7:1.7.0.2
	OPENBSD_4_7_BASE:1.7
	OPENBSD_4_6:1.7.0.4
	OPENBSD_4_6_BASE:1.7
	OPENBSD_4_5:1.5.0.10
	OPENBSD_4_5_BASE:1.5
	OPENBSD_4_4:1.5.0.8
	OPENBSD_4_4_BASE:1.5
	OPENBSD_4_3:1.5.0.6
	OPENBSD_4_3_BASE:1.5
	OPENBSD_4_2:1.5.0.4
	OPENBSD_4_2_BASE:1.5
	OPENBSD_4_1:1.5.0.2
	OPENBSD_4_1_BASE:1.5
	OPENBSD_4_0:1.4.0.10
	OPENBSD_4_0_BASE:1.4
	OPENBSD_3_9:1.4.0.8
	OPENBSD_3_9_BASE:1.4
	OPENBSD_3_8:1.4.0.6
	OPENBSD_3_8_BASE:1.4
	OPENBSD_3_7:1.4.0.4
	OPENBSD_3_7_BASE:1.4
	OPENBSD_3_6:1.4.0.2
	OPENBSD_3_6_BASE:1.4
	OPENBSD_3_5:1.2.0.2
	OPENBSD_3_5_BASE:1.2;
locks; strict;
comment	@# @;


1.13
date	2015.12.22.07.39.00;	author sunil;	state Exp;
branches;
next	1.12;
commitid	z5MFNJeJfwiAHvFW;

1.12
date	2015.12.08.09.03.50;	author sunil;	state Exp;
branches;
next	1.11;
commitid	Z7vj7gT8ukrYn4lr;

1.11
date	2015.05.26.14.34.59;	author naddy;	state Exp;
branches;
next	1.10;
commitid	z4MgOPYhRC0ysQ74;

1.10
date	2014.09.17.16.39.45;	author ajacoutot;	state Exp;
branches;
next	1.9;
commitid	0dRNC8rU7HRnbX1p;

1.9
date	2014.09.15.22.28.58;	author matthieu;	state Exp;
branches;
next	1.8;
commitid	KGd36IP2Igl01unI;

1.8
date	2014.03.12.21.40.27;	author tedu;	state Exp;
branches;
next	1.7;

1.7
date	2009.04.02.10.21.08;	author jacekm;	state Exp;
branches;
next	1.6;

1.6
date	2009.03.18.01.56.52;	author jacekm;	state Exp;
branches;
next	1.5;

1.5
date	2007.02.27.02.22.01;	author beck;	state Exp;
branches;
next	1.4;

1.4
date	2004.08.14.17.06.03;	author millert;	state Exp;
branches;
next	1.3;

1.3
date	2004.06.24.18.27.45;	author tom;	state Exp;
branches;
next	1.2;

1.2
date	2003.09.25.15.34.25;	author millert;	state Exp;
branches;
next	1.1;

1.1
date	2003.09.23.21.37.11;	author millert;	state Exp;
branches;
next	;


desc
@@


1.13
log
@Now that default smtpd.conf aliases table has been switched to
'file' backend, we no longer have to generate the .db files.

Ok gilles@@
@
text
@# $OpenBSD: Makefile,v 1.12 2015/12/08 09:03:50 sunil Exp $

all clean:

distribution:
	${INSTALL} -c -o root -g wheel -m 644 aliases \
	    ${DESTDIR}/etc/mail/aliases
	${INSTALL} -c -o root -g wheel -m 644 smtpd.conf \
	    ${DESTDIR}/etc/mail/smtpd.conf
	${INSTALL} -c -o root -g wheel -m 644 spamd.conf \
	    ${DESTDIR}/etc/mail/spamd.conf

.PHONY: distribution
.include <bsd.own.mk>
.include <bsd.sys.mk>
@


1.12
log
@Use mailwrapper path instead of smtpd.

Ok tb@@ jung@@
@
text
@d1 1
a1 3
# $OpenBSD: Makefile,v 1.11 2015/05/26 14:34:59 naddy Exp $
#
# Generate the various .db versions from their source files.
d3 1
a3 7
DB_FILES= aliases.db
MAKEMAP= /usr/sbin/makemap

all: ${DB_FILES}

clean:
	rm -f ${DB_FILES}
a7 2
	${MAKEMAP} -t aliases -o ${DESTDIR}/etc/mail/aliases.db \
	    ${DESTDIR}/etc/mail/aliases
a11 4
	chmod 644 ${DESTDIR}/etc/mail/aliases.db

aliases.db: aliases
	newaliases
@


1.11
log
@Create aliases.db from the installed aliases file, so we get the correct
owner and group.  Reported by Mark Patruck.  ok deraadt@@ miod@@
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.10 2014/09/17 16:39:45 ajacoutot Exp $
d6 1
a6 1
MAKEMAP= /usr/libexec/smtpd/makemap
@


1.10
log
@With sendmail(8) gone, there is not much point in keeping /etc/mail/Makefile.
There is one table in the default configuration which is 'aliases' and
the db can be created using newaliases(8).

"go for it" guenther@@
ok sthen@@ matthieu@@ gilles@@
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.9 2014/09/15 22:28:58 matthieu Exp $
d17 1
a17 1
	    aliases
@


1.9
log
@Remove sendmail tentacles. ok krw@@ ajacoutot@@
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.8 2014/03/12 21:40:27 tedu Exp $
a13 2
	${INSTALL} -c -o root -g wheel -m 644 Makefile \
	    ${DESTDIR}/etc/mail/Makefile
@


1.8
log
@just run newaliases. should be about the same, but less sendmail.
ok todd
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.7 2009/04/02 10:21:08 jacekm Exp $
a3 6
# The sendmail .mc files are not built here.  They live in
# /usr/share/sendmail/cf and have their own Makefile.
#

SENDMAIL=	/usr/libexec/sendmail/sendmail
MAKEMAP=	/usr/libexec/sendmail/makemap
d5 2
a6 5
.for DB in access aliases genericstable mailertable virtusertable userdb
. if exists(${DB})
DB_FILES+= ${DB}.db
. endif
.endfor
a15 5
	${INSTALL} -c -o root -g wheel -m 644 README \
	    ${DESTDIR}/etc/mail/README
	${INSTALL} -c -o root -g wheel -m 644 access \
	    ${DESTDIR}/etc/mail/access
	${MAKEMAP} hash ${DESTDIR}/etc/mail/access < access
d18 4
a21 17
	${SENDMAIL} -C${DESTDIR}/etc/mail/sendmail.cf \
	    -bi -O AliasFile=${DESTDIR}/etc/mail/aliases \
	    -O DontBlameSendmail=mapinunsafedirpath
	${INSTALL} -c -o root -g wheel -m 644 local-host-names \
	    ${DESTDIR}/etc/mail/local-host-names
	${INSTALL} -c -o root -g wheel -m 644 genericstable \
	    ${DESTDIR}/etc/mail/genericstable
	${MAKEMAP} hash ${DESTDIR}/etc/mail/genericstable < genericstable
	${INSTALL} -c -o root -g wheel -m 644 mailertable \
	    ${DESTDIR}/etc/mail/mailertable
	${MAKEMAP} hash ${DESTDIR}/etc/mail/mailertable < mailertable
	${INSTALL} -c -o root -g wheel -m 644 relay-domains \
	    ${DESTDIR}/etc/mail/relay-domains
	${INSTALL} -c -o root -g wheel -m 644 trusted-users \
	    ${DESTDIR}/etc/mail/trusted-users
	${INSTALL} -c -o root -g wheel -m 644 virtusertable \
	    ${DESTDIR}/etc/mail/virtusertable
d24 1
a24 10
	${INSTALL} -c -o root -g wheel -m 644 smtpd.conf \
	    ${DESTDIR}/etc/mail/smtpd.conf
	${MAKEMAP} hash ${DESTDIR}/etc/mail/virtusertable < virtusertable
	@@for db in access.db aliases.db genericstable.db mailertable.db \
	    virtusertable.db; do \
		chmod 644 ${DESTDIR}/etc/mail/$$db; \
	done

access.db: access
	${MAKEMAP} hash ${.ALLSRC} < ${.ALLSRC}
a27 12

genericstable.db: genericstable
	${MAKEMAP} hash ${.ALLSRC} < ${.ALLSRC}

mailertable.db: mailertable
	${MAKEMAP} hash ${.ALLSRC} < ${.ALLSRC}

virtusertable.db: virtusertable
	${MAKEMAP} hash ${.ALLSRC} < ${.ALLSRC}

userdb.db: userdb
	${MAKEMAP} btree ${.ALLSRC} < ${.ALLSRC}
@


1.7
log
@restore previous behaviour and reach directly to libexec for
makemap as !sendmail versions of this binary are not valid here.

pointed out by and ok sthen@@
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.6 2009/03/18 01:56:52 jacekm Exp $
d63 1
a63 1
	${SENDMAIL} -bi
@


1.6
log
@unbreak make release, spotted by todd and kurt
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.5 2007/02/27 02:22:01 beck Exp $
d8 3
d29 1
a29 1
	makemap hash ${DESTDIR}/etc/mail/access < access
d32 1
a32 1
	/usr/libexec/sendmail/sendmail -C${DESTDIR}/etc/mail/sendmail.cf \
d39 1
a39 1
	makemap hash ${DESTDIR}/etc/mail/genericstable < genericstable
d42 1
a42 1
	makemap hash ${DESTDIR}/etc/mail/mailertable < mailertable
d53 1
a53 1
	makemap hash ${DESTDIR}/etc/mail/virtusertable < virtusertable
d60 1
a60 1
	makemap hash ${.ALLSRC} < ${.ALLSRC}
d63 1
a63 1
	sendmail -bi
d66 1
a66 1
	makemap hash ${.ALLSRC} < ${.ALLSRC}
d69 1
a69 1
	makemap hash ${.ALLSRC} < ${.ALLSRC}
d72 1
a72 1
	makemap hash ${.ALLSRC} < ${.ALLSRC}
d75 1
a75 1
	makemap btree ${.ALLSRC} < ${.ALLSRC}
@


1.5
log
@/etc/spamd.conf moves to /etc/mail/spamd.conf
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.4 2004/08/14 17:06:03 millert Exp $
d48 2
@


1.4
log
@Add example genericstable
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.3 2004/06/24 18:27:45 tom Exp $
d46 2
@


1.3
log
@Add genericstable to the list of databases we can create automatically.

"looks fine" millert@@
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.2 2003/09/25 15:34:25 millert Exp $
d34 3
d47 2
a48 1
	@@for db in access.db aliases.db mailertable.db virtusertable.db; do \
@


1.2
log
@Install files as group wheel to match mtree/special; noticed by David Krause
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.1 2003/09/23 21:37:11 millert Exp $
d8 1
a8 1
.for DB in access aliases mailertable virtusertable userdb
d53 3
@


1.1
log
@Sample files for /etc/mail, installed at 'make distribution' time.
@
text
@d1 1
a1 1
# $OpenBSD$
d20 1
a20 1
	${INSTALL} -c -o root -g ${BINGRP} -m 644 Makefile \
d22 1
a22 1
	${INSTALL} -c -o root -g ${BINGRP} -m 644 README \
d24 1
a24 1
	${INSTALL} -c -o root -g ${BINGRP} -m 644 access \
d27 1
a27 1
	${INSTALL} -c -o root -g ${BINGRP} -m 644 aliases \
d32 1
a32 1
	${INSTALL} -c -o root -g ${BINGRP} -m 644 local-host-names \
d34 1
a34 1
	${INSTALL} -c -o root -g ${BINGRP} -m 644 mailertable \
d37 1
a37 1
	${INSTALL} -c -o root -g ${BINGRP} -m 644 relay-domains \
d39 1
a39 1
	${INSTALL} -c -o root -g ${BINGRP} -m 644 trusted-users \
d41 1
a41 1
	${INSTALL} -c -o root -g ${BINGRP} -m 644 virtusertable \
a44 1
		chown root:${BINGRP} ${DESTDIR}/etc/mail/$$db; \
@

