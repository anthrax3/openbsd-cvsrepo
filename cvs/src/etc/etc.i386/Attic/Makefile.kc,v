head	1.4;
access;
symbols
	OPENBSD_2_0:1.3.0.2
	OPENBSD_2_0_BASE:1.3
	netbsd_1_1:1.1.1.1
	netbsd_1_1:1.1.1;
locks; strict;
comment	@# @;


1.4
date	97.05.12.20.10.37;	author deraadt;	state dead;
branches;
next	1.3;

1.3
date	96.06.11.10.20.26;	author deraadt;	state Exp;
branches;
next	1.2;

1.2
date	96.06.11.09.04.53;	author deraadt;	state Exp;
branches;
next	1.1;

1.1
date	95.10.18.08.38.00;	author deraadt;	state Exp;
branches
	1.1.1.1;
next	;

1.1.1.1
date	95.10.18.08.38.00;	author deraadt;	state Exp;
branches;
next	;


desc
@@


1.4
log
@foom
@
text
@#	$Id: Makefile.kc,v 1.3 1996/06/11 10:20:26 deraadt Exp $

.ifndef MOUNT_POINT
MOUNT_POINT=	/mnt
.endif
.if !defined(VND_DEV) || !defined(VND_DEV)
VND_DEV=	/dev/vnd0a
VND_RDEV=	/dev/rvnd0a
.endif

PID!=		echo $$$$
REALIMAGE!=	echo /tmp/image.${PID}

ROOTDIRLIST=	/ /bin /dev /instbin /mnt /sbin /usr
BINDIRLIST=	/usr/bin
FLOPPYBINS=	fsck init mount reboot sh tar test umount

all:
.if !defined(IMAGE) || !defined(KERNEL)
	@@echo both IMAGE and KERNEL must be defined
	@@false
.else
	dd if=/dev/zero of=${REALIMAGE} bs=10k count=120
	vnconfig -c ${VND_DEV} ${REALIMAGE}
	disklabel -w -B -b ${DESTDIR}/usr/mdec/fdboot -s ${DESTDIR}/usr/mdec/bootfd \
		${VND_RDEV} floppy5
	newfs -m 0 -o space -i 6144 -c 80 ${VND_DEV} floppy5
	mount ${VND_DEV} ${MOUNT_POINT}
	for d in ${ROOTDIRLIST} ; do \
		install -d -o root -g wheel -m 755 ${MOUNT_POINT}$$d ; \
	done
	for d in ${BINDIRLIST} ; do \
		install -d -o ${BINOWN} -g ${BINGRP} -m 755 ${MOUNT_POINT}$$d ; \
	done
	cp ${KERNEL} ${MOUNT_POINT}
	cp ${.CURDIR}/etc.i386/MAKEDEV ${MOUNT_POINT}/dev
	(cd ${MOUNT_POINT}/dev; sh MAKEDEV floppy)
	for b in ${FLOPPYBINS} ; do \
		( cd ${.CURDIR}/../sys/arch/i386/floppy/$$b ; \
		    make DESTDIR=${MOUNT_POINT} install ) ; \
	done
	set -- `grep -v '^#' ${.CURDIR}/etc.i386/files.kc/list`; \
	    while [ $$# -ge 2 ]; do \
		from=$$1; shift; \
		to=$$1; shift; \
		cp ${.CURDIR}/etc.i386/files.kc/$$from ${MOUNT_POINT}/$$to; \
	    done
	umount ${MOUNT_POINT}
	vnconfig -u ${VND_DEV}
	cat /*bin/* > /dev/null
	cp ${REALIMAGE} ${IMAGE}
.endif

unconfig:
	-umount -f ${MOUNT_POINT}
	-vnconfig -u ${VND_DEV}
	-/bin/rm -f ${REALIMAGE} ${IMAGE}
@


1.3
log
@proper device
@
text
@d1 1
a1 1
#	$Id: Makefile.kc,v 1.2 1996/06/11 09:04:53 deraadt Exp $
@


1.2
log
@sync to new disklabel, add ${REALIMAGE} support
@
text
@d1 1
a1 1
#	$Id: Makefile.kc,v 1.1.1.1 1995/10/18 08:38:00 deraadt Exp $
d26 1
a26 1
		${VND} floppy5
@


1.1
log
@Initial revision
@
text
@d1 1
a1 1
#	$Id: Makefile.kc,v 1.5 1995/06/26 22:17:38 jtc Exp $
d11 3
d23 4
a26 4
	dd if=/dev/zero of=${IMAGE} bs=100k count=12
	vnconfig -c ${VND_DEV} ${IMAGE}
	disklabel -r -w ${VND_DEV} floppy5 \
		${DESTDIR}/usr/mdec/fdboot ${DESTDIR}/usr/mdec/bootfd
d49 3
a51 1
	vnconfig -u ${VND_DEV} ${IMAGE}
d56 2
a57 2
	-vnconfig -u ${VND_DEV} ${IMAGE}
	-/bin/rm -f ${IMAGE}
@


1.1.1.1
log
@initial import of NetBSD tree
@
text
@@
