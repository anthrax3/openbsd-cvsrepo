head	1.14;
access;
symbols
	OPENBSD_6_1_BASE:1.14
	OPENBSD_6_0:1.14.0.4
	OPENBSD_6_0_BASE:1.14
	OPENBSD_5_9:1.12.0.2
	OPENBSD_5_9_BASE:1.12
	OPENBSD_5_8:1.12.0.4
	OPENBSD_5_8_BASE:1.12
	OPENBSD_5_7:1.6.0.2
	OPENBSD_5_7_BASE:1.6
	OPENBSD_5_6:1.5.0.6
	OPENBSD_5_6_BASE:1.5
	OPENBSD_5_5:1.5.0.2
	OPENBSD_5_5_BASE:1.5;
locks; strict;
comment	@# @;


1.14
date	2016.05.29.07.38.01;	author jsg;	state Exp;
branches;
next	1.13;
commitid	Mj7jvvVOUly1nRny;

1.13
date	2016.05.23.02.19.46;	author jsg;	state Exp;
branches;
next	1.12;
commitid	nc4rJGPfGmGS9MGQ;

1.12
date	2015.08.01.00.15.37;	author jsg;	state Exp;
branches;
next	1.11;
commitid	doqliPCfgnVqq7IG;

1.11
date	2015.07.17.17.02.52;	author jsg;	state Exp;
branches;
next	1.10;
commitid	ukNk3r6GTKJ57Fd6;

1.10
date	2015.06.29.04.52.34;	author jsg;	state Exp;
branches;
next	1.9;
commitid	07H0kGMQZhgLy4Z6;

1.9
date	2015.06.02.01.48.25;	author jsg;	state Exp;
branches;
next	1.8;
commitid	oitX3N4o6JZ5SMvi;

1.8
date	2015.05.20.01.44.20;	author jsg;	state Exp;
branches;
next	1.7;
commitid	AyYz7FgJK6jKwvRv;

1.7
date	2015.05.19.00.05.59;	author jsg;	state Exp;
branches;
next	1.6;
commitid	bo8vCG1OOftVcP5V;

1.6
date	2015.01.26.01.55.55;	author jsg;	state Exp;
branches;
next	1.5;
commitid	h5sclZXjqIofAFSS;

1.5
date	2014.03.05.14.47.34;	author deraadt;	state Exp;
branches;
next	1.4;

1.4
date	2013.11.01.20.35.52;	author jasper;	state Exp;
branches;
next	1.3;

1.3
date	2013.10.28.14.10.41;	author patrick;	state Exp;
branches;
next	1.2;

1.2
date	2013.09.07.23.04.44;	author patrick;	state Exp;
branches;
next	1.1;

1.1
date	2013.09.04.16.53.40;	author patrick;	state Exp;
branches;
next	;


desc
@@


1.14
log
@Stop building u-boot kernel and ramdisk images.  The kernel make targets
are left for now but umg files are no longer built when building
releases.
@
text
@#	$OpenBSD: Makefile.inc,v 1.13 2016/05/23 02:19:46 jsg Exp $

bootblocks:
	cp ${DESTDIR}/usr/mdec/BOOTARM.EFI ${RELEASEDIR}

MDEXT=	bsd.rd BOOTARM.EFI \
	miniroot-am335x-${OSrev}.fs miniroot-beagle-${OSrev}.fs \
	miniroot-cubie-${OSrev}.fs miniroot-cubox-${OSrev}.fs \
	miniroot-nitrogen-${OSrev}.fs miniroot-panda-${OSrev}.fs \
	miniroot-wandboard-${OSrev}.fs
@


1.13
log
@build armv7 efiboot
@
text
@d1 1
a1 16
#	$OpenBSD: Makefile.inc,v 1.12 2015/08/01 00:15:37 jsg Exp $

ALLSOC=EXYNOS IMX OMAP SUNXI VEXPRESSA9 VEXPRESSA15
MDEXT=		bsd.rd BOOTARM.EFI

.for SOC in ${ALLSOC}
MDEXT+=		bsd.${SOC}.umg
MDEXT+=		bsd.rd.${SOC}.umg
.endfor

KERNADDR_OMAP=0x80300000
KERNADDR_IMX=0x10300000
KERNADDR_SUNXI=0x40300000
KERNADDR_VEXPRESSA15=0x80300000
KERNADDR_VEXPRESSA9=0x60300000
KERNADDR_EXYNOS=0x40300000
d6 2
a7 10
kernels: bootblocks ${ALL_KERNELS}
.for CONF K in ${KERNELS}
	cp ../sys/arch/${MACHINE}/compile/${CONF}/bsd ${RELEASEDIR}/$K
.for SOC in ${ALLSOC}
	mkuboot -a arm -o linux -e ${KERNADDR_${SOC}} -l ${KERNADDR_${SOC}} \
	    ${RELEASEDIR}/$K ${RELEASEDIR}/$K.${SOC}.umg
.endfor
.endfor

MDEXT+=	miniroot-am335x-${OSrev}.fs miniroot-beagle-${OSrev}.fs \
@


1.12
log
@Make use of u-boot 2015.07's unified wandboard config to provide a
miniroot to cover all current wandboard variations.

Unlike the other imx u-boot configs the wandboard config doesn't search
for ext2 only a fat fs.

Grow the ramdisk size to fit the extra u-boot files.

From Roman Kravchuk.
@
text
@d1 1
a1 1
#	$OpenBSD: Makefile.inc,v 1.11 2015/07/17 17:02:52 jsg Exp $
d4 1
a4 1
MDEXT=		bsd.rd
d19 1
@


1.11
log
@enable exynos
@
text
@d1 1
a1 1
#	$OpenBSD: Makefile.inc,v 1.10 2015/06/29 04:52:34 jsg Exp $
d31 2
a32 1
	miniroot-nitrogen-${OSrev}.fs miniroot-panda-${OSrev}.fs
@


1.10
log
@enable vexpress
@
text
@d1 1
a1 1
#	$OpenBSD: Makefile.inc,v 1.9 2015/06/02 01:48:25 jsg Exp $
d3 1
a3 1
ALLSOC=IMX OMAP SUNXI VEXPRESSA9 VEXPRESSA15
d16 1
@


1.9
log
@Rename the imx miniroot to nitrogen as it creates "6x_bootscript".
Add a miniroot for the CuBox-i which needs u-boot at a particular
offset in the sd image to boot.  Based on changes made by Patrick
Wildt in bitrig.
@
text
@d1 1
a1 1
#	$OpenBSD: Makefile.inc,v 1.8 2015/05/20 01:44:20 jsg Exp $
d3 1
a3 1
ALLSOC=IMX OMAP SUNXI
d14 2
@


1.8
log
@Now all the socs use the same va entry point and don't have any
conflicting symbols we can combine the configs.

Multiple umg files are still required however.  The bsd.umg target in
the kernel is replaced by targets for bsd.IMX.umg, bsd.OMAP.umg and
bsd.SUNXI.umg.
@
text
@d1 1
a1 1
#	$OpenBSD: Makefile.inc,v 1.7 2015/05/19 00:05:59 jsg Exp $
d27 2
a28 2
	miniroot-imx-${OSrev}.fs miniroot-panda-${OSrev}.fs \
	miniroot-cubie-${OSrev}.fs
@


1.7
log
@use the same va entry point on all armv7 socs
Similiar changes were made in bitrig by Patrick Wildt.

As part of this change the physical load address for imx and sunxi have
changed.  Any u-boot settings that include it will need to be modified.

imx: 0x10800000 -> 0x10300000
sunxi: 0x40800000 -> 0x40300000

Tested by bmercer, canacar and myself.
ok bmercer@@
@
text
@d1 1
a1 1
#	$OpenBSD: Makefile.inc,v 1.6 2015/01/26 01:55:55 jsg Exp $
d4 1
a4 2
KERNELS=
MDEXT=
a6 1
KERNELS+=	GENERIC-${SOC} bsd.${SOC}
a7 1
MDEXT+=		bsd.rd.${SOC}
d15 1
a15 9
.for CONF K in ${KERNELS}
.  if !target($K)
$K:
	cd ../sys/arch/${MACHINE}/conf && config ${CONF}
	cd ../sys/arch/${MACHINE}/compile/${CONF} && \
	    ${MAKE} clean && exec ${MAKE}
.  endif
ALL_KERNELS += $K
.endfor
a19 1
.endfor
d22 2
a23 1
	    ${RELEASEDIR}/bsd.${SOC} ${RELEASEDIR}/bsd.${SOC}.umg
a24 4

ALL_KERNELS=

bootblocks:
@


1.6
log
@Rename miniroot-sunxi to miniroot-cubie as the u-boot included
in the image is for Cubieboard1.  Discussed with bmercer@@
While here switch from using the separate spl and u-boot images
to the combined spl and u-boot 'u-boot-sunxi-with-spl.bin'.
@
text
@d1 1
a1 1
#	$OpenBSD: Makefile.inc,v 1.5 2014/03/05 14:47:34 deraadt Exp $
d15 2
a16 2
KERNADDR_IMX=0x10800000
KERNADDR_SUNXI=0x40800000
@


1.5
log
@some files were not being hashes, because they were missing from MDEXT
noticed by jsg, and important enough to make release
@
text
@d1 1
a1 1
#	$OpenBSD: Makefile.inc,v 1.4 2013/11/01 20:35:52 jasper Exp $
d43 1
a43 1
	miniroot-sunxi-${OSrev}.fs
@


1.4
log
@hookup sunxi bits for miniroot and ramdisk, tested on pcduino.
note that on boards without ahci you will need to install to usb and still
boot of sd, at least until there's support for the sd slot.

ok patrick@@
@
text
@d1 1
a1 1
#	$OpenBSD: Makefile.inc,v 1.3 2013/10/28 14:10:41 patrick Exp $
d42 2
a43 1
	miniroot-panda-${OSrev}.fs
@


1.3
log
@Revamp ARMv7 ramdisk and miniroot creation process.

Instead of running mkuboot during install, we call it on during
the release build, so that we can also ship bootable images
of the generic and the ramdisk kernel.

We can now build miniroots for imx, too.  The installer also
can recognize the SoC and makes decision based on it.

Use ext2fs for i.MX6 based devices.

Tar the bootloader files to save some space.

ok syl@@
@
text
@d1 1
a1 1
#	$OpenBSD: Makefile.inc,v 1.2 2013/09/07 23:04:44 patrick Exp $
d3 1
a3 1
ALLSOC=IMX OMAP
d16 1
@


1.2
log
@Update ARMv7's release build process to build kernels and ramdisks
per SoC.  It's heavily based on the SGI port.

ok florian@@
@
text
@d1 1
a1 1
#	$OpenBSD: Makefile.inc,v 1.1 2013/09/04 16:53:40 patrick Exp $
d9 1
d11 1
d13 24
@


1.1
log
@Beagle has been replaced by armv7.

ok rapha@@
@
text
@d1 10
a10 1
#	$OpenBSD: Makefile.inc,v 1.3 2013/06/22 10:12:11 florian Exp $
d14 1
a14 1
MDEXT=	bsd.rd miniroot-am335x-${OSrev}.fs miniroot-beagle-${OSrev}.fs \
@

