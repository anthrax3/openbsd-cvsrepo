head	1.8;
access;
symbols
	OPENBSD_6_0:1.8.0.4
	OPENBSD_6_0_BASE:1.8
	OPENBSD_5_9:1.7.0.22
	OPENBSD_5_9_BASE:1.7
	OPENBSD_5_8:1.7.0.24
	OPENBSD_5_8_BASE:1.7
	OPENBSD_5_7:1.7.0.16
	OPENBSD_5_7_BASE:1.7
	OPENBSD_5_6:1.7.0.20
	OPENBSD_5_6_BASE:1.7
	OPENBSD_5_5:1.7.0.18
	OPENBSD_5_5_BASE:1.7
	OPENBSD_5_4:1.7.0.14
	OPENBSD_5_4_BASE:1.7
	OPENBSD_5_3:1.7.0.12
	OPENBSD_5_3_BASE:1.7
	OPENBSD_5_2:1.7.0.10
	OPENBSD_5_2_BASE:1.7
	OPENBSD_5_1_BASE:1.7
	OPENBSD_5_1:1.7.0.8
	OPENBSD_5_0:1.7.0.6
	OPENBSD_5_0_BASE:1.7
	OPENBSD_4_9:1.7.0.4
	OPENBSD_4_9_BASE:1.7
	OPENBSD_4_8:1.7.0.2
	OPENBSD_4_8_BASE:1.7
	OPENBSD_4_7:1.6.0.2
	OPENBSD_4_7_BASE:1.6
	OPENBSD_4_6:1.6.0.4
	OPENBSD_4_6_BASE:1.6
	OPENBSD_4_5:1.4.0.4
	OPENBSD_4_5_BASE:1.4
	OPENBSD_4_4:1.4.0.2
	OPENBSD_4_4_BASE:1.4;
locks; strict;
comment	@# @;


1.8
date	2016.05.26.16.29.51;	author deraadt;	state Exp;
branches;
next	1.7;
commitid	Mb7C6XnYoQIeDqBg;

1.7
date	2010.06.16.23.33.38;	author todd;	state Exp;
branches;
next	1.6;

1.6
date	2009.06.03.17.02.17;	author todd;	state Exp;
branches;
next	1.5;

1.5
date	2009.06.03.15.36.54;	author todd;	state Exp;
branches;
next	1.4;

1.4
date	2008.06.16.08.18.39;	author todd;	state Exp;
branches;
next	1.3;

1.3
date	2008.06.15.01.56.59;	author deraadt;	state Exp;
branches;
next	1.2;

1.2
date	2008.06.15.01.51.55;	author todd;	state Exp;
branches;
next	1.1;

1.1
date	2008.06.14.23.09.05;	author todd;	state Exp;
branches;
next	;


desc
@@


1.8
log
@whitespace found during review
@
text
@#	$OpenBSD: Makefile.inc,v 1.7 2010/06/16 23:33:38 todd Exp $

M=${.CURDIR:C/^.*\/etc\.([^\/]*)$/\1/}

DOCDIR=	${.CURDIR}/../../share/man/man8/man8.${M}

MAKEDEV: ${.CURDIR}/MAKEDEV ${DOCDIR}/MAKEDEV.8

# set 'NOCLEAN=:' to debug

MAKEDEVSRC=	${.CURDIR}/../MAKEDEV.mi
MAKEDEVSRC+=	${.CURDIR}/../MAKEDEV.sub
MAKEDEVSRC+=	${.CURDIR}/../MAKEDEV.common
MAKEDEVSRC+=	MAKEDEV.md

${.CURDIR}/MAKEDEV: ${MAKEDEVSRC}
	@@if m4 -I${.CURDIR}/.. -I${.CURDIR} \
	    ${.CURDIR}/../MAKEDEV.mi > MAKEDEV.tmp; then \
	    if ! [ -f ${.CURDIR}/MAKEDEV ]; then \
		echo "    m4 -I.. -I. ../MAKEDEV.mi > MAKEDEV"; \
		cp MAKEDEV.tmp ${.CURDIR}/MAKEDEV; \
		${NOCLEAN} rm MAKEDEV.tmp; \
		exit 0; \
	    fi; \
	    diff MAKEDEV.tmp ${.CURDIR}/MAKEDEV > diffout1 || true; \
	    sed -e 's/^--.*$$//' \
		-e 's/^[\<\>] #.*OpenBSD.*Exp $$//' \
		-e 's/^[0-9,]*c[0-9,]*$$//' \
		-e '/^$$/d' \
		diffout1 > diffout2; \
	    if [ -s diffout2 ]; then \
		echo "    m4 -I.. -I. ../MAKEDEV.mi > MAKEDEV"; \
		cp MAKEDEV.tmp ${.CURDIR}/MAKEDEV || true; \
		${NOCLEAN} rm MAKEDEV.tmp; \
	    fi; \
	    ${NOCLEAN} rm -f diffout1 diffout2; \
	fi; ${NOCLEAN} rm -f MAKEDEV.tmp

MAKEDEVDOC=	${.CURDIR}/../MAKEDEV.man
MAKEDEVDOC+=	${.CURDIR}/../MAKEDEV.mansub
MAKEDEVDOC+=	${.CURDIR}/../MAKEDEV.common
MAKEDEVDOC+=	MAKEDEV.md

${DOCDIR}/MAKEDEV.8: ${MAKEDEVDOC}
	@@if m4 -I${.CURDIR}/.. -I${.CURDIR} \
	    ${.CURDIR}/../MAKEDEV.man > MAKEDEV.mtmp; then \
	    if ! [ -f ${DOCDIR}/MAKEDEV.8 ]; then \
		echo "    m4 -I.. -I. ../MAKEDEV.man > ${DOCDIR}/MAKEDEV.8"; \
		cp MAKEDEV.mtmp ${DOCDIR}/MAKEDEV.8; \
		${NOCLEAN} rm MAKEDEV.mtmp; \
		exit 0; \
	    fi; \
	    diff MAKEDEV.mtmp ${DOCDIR}/MAKEDEV.8 > mdiffout1 || true; \
	    sed -e 's/^--.*$$//' \
		-e 's/^[\<\>] \.\\".*OpenBSD.*Exp $$//' \
		-e 's/^[\<\>] \.\\".*\$$OpenBSD.*\$$$$//' \
		-e 's/^[\<\>] \.Dd \$$Mdocdate.*\$$$$//' \
		-e 's/^[\<\>] \.Dd .*[0-9][0-9][0-9][0-9]$$//' \
		-e 's/^[0-9,]*c[0-9,]*$$//' \
		-e '/^$$/d' \
		mdiffout1 > mdiffout2; \
	    if [ -s mdiffout2 ]; then \
		echo "    m4 -I.. -I. ../MAKEDEV.man > ${DOCDIR}/MAKEDEV.8"; \
		cp MAKEDEV.mtmp ${DOCDIR}/MAKEDEV.8 || true; \
		${NOCLEAN} rm MAKEDEV.mtmp; \
	    fi; \
	    ${NOCLEAN} rm -f mdiffout1 mdiffout2; \
	fi; ${NOCLEAN} rm -f MAKEDEV.mtmp

.PHONY: ${.CURDIR}/MAKEDEV ${DOCDIR}/MAKEDEV.8
@


1.7
log
@Mdocdate is not a valid reason to generate a new MAKEDEV.8, finally noticed
@
text
@d1 1
a1 1
#	$OpenBSD: Makefile.inc,v 1.6 2009/06/03 17:02:17 todd Exp $
d64 1
a64 1
	    	cp MAKEDEV.mtmp ${DOCDIR}/MAKEDEV.8 || true; \
@


1.6
log
@gak, I loose, backout unintended hitchiker on my last commit
@
text
@d1 1
a1 1
#	$OpenBSD: Makefile.inc,v 1.4 2008/06/16 08:18:39 todd Exp $
d57 1
@


1.5
log
@sync
@
text
@d31 1
a31 1
	    if ! [ -s diffout2 ]; then \
@


1.4
log
@build MAKEDEV.8's conditionally upon more than just rcsid changes also
@
text
@d1 1
a1 1
#	$OpenBSD: Makefile.inc,v 1.3 2008/06/15 01:56:59 deraadt Exp $
d31 1
a31 1
	    if [ -s diffout2 ]; then \
@


1.3
log
@minor touch
@
text
@d1 9
a9 1
#	$OpenBSD: Makefile.inc,v 1.2 2008/06/15 01:51:55 todd Exp $
d16 1
a16 1
MAKEDEV: ${MAKEDEVSRC}
d22 1
a22 1
		rm MAKEDEV.tmp; \
d28 1
a28 1
		-e 's/^[0-9]*c[0-9]*$$//' \
d34 1
d36 34
a69 2
	    rm diffout1 diffout2; \
	fi
@


1.2
log
@be smarter, only write a new MAKEDEV if more than just the rcsid changed
@
text
@d1 1
a1 1
#	$OpenBSD: Makefile.inc,v 1.1 2008/06/14 23:09:05 todd Exp $
d25 1
a25 1
	    	cp MAKEDEV.tmp ${.CURDIR}/MAKEDEV || true; \
@


1.1
log
@redo the way MAKEDEV files are generated
get it in, deraadt@@
@
text
@d1 1
a1 1
#	$OpenBSD$
d9 20
a28 5
	@@echo m4 -I.. ../MAKEDEV.mi '>' MAKEDEV
	@@m4 -I${.CURDIR}/.. \
		${.CURDIR}/../MAKEDEV.mi > .MAKEDEV.tmp && \
		mv .MAKEDEV.tmp MAKEDEV || \
		rm .MAKEDEV.tmp
@

