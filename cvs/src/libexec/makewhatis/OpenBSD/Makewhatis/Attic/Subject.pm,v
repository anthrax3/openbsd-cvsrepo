head	1.5;
access;
symbols
	OPENBSD_6_0:1.4.0.10
	OPENBSD_6_0_BASE:1.4
	OPENBSD_5_9:1.4.0.6
	OPENBSD_5_9_BASE:1.4
	OPENBSD_5_8:1.4.0.8
	OPENBSD_5_8_BASE:1.4
	OPENBSD_5_7:1.4.0.2
	OPENBSD_5_7_BASE:1.4
	OPENBSD_5_6:1.4.0.4
	OPENBSD_5_6_BASE:1.4
	OPENBSD_5_5:1.3.0.8
	OPENBSD_5_5_BASE:1.3
	OPENBSD_5_4:1.3.0.4
	OPENBSD_5_4_BASE:1.3
	OPENBSD_5_3:1.3.0.2
	OPENBSD_5_3_BASE:1.3
	OPENBSD_5_2:1.2.0.8
	OPENBSD_5_2_BASE:1.2
	OPENBSD_5_1_BASE:1.2
	OPENBSD_5_1:1.2.0.6
	OPENBSD_5_0:1.2.0.4
	OPENBSD_5_0_BASE:1.2
	OPENBSD_4_9:1.2.0.2
	OPENBSD_4_9_BASE:1.2;
locks; strict;
comment	@# @;


1.5
date	2016.08.22.19.41.18;	author schwarze;	state dead;
branches;
next	1.4;
commitid	ey7eLp6W2n4XJ7B4;

1.4
date	2014.03.21.10.58.46;	author espie;	state Exp;
branches;
next	1.3;

1.3
date	2013.01.29.11.08.56;	author espie;	state Exp;
branches;
next	1.2;

1.2
date	2011.02.22.00.23.14;	author espie;	state Exp;
branches;
next	1.1;

1.1
date	2011.01.26.15.10.59;	author espie;	state Exp;
branches;
next	;


desc
@@


1.5
log
@This code served us well for many years,
but we are unlikely to reactivate it; espie@@ agrees.
The new code is in /usr/src/usr.bin/mandoc/mandocdb.c.
@
text
@# ex:ts=8 sw=4:
# $OpenBSD: Subject.pm,v 1.4 2014/03/21 10:58:46 espie Exp $
# Copyright (c) 2010 Marc Espie <espie@@openbsd.org>
#
# Permission to use, copy, modify, and distribute this software for any
# purpose with or without fee is hereby granted, provided that the above
# copyright notice and this permission notice appear in all copies.
#
# THE SOFTWARE IS PROVIDED "AS IS" AND THE AUTHOR DISCLAIMS ALL WARRANTIES
# WITH REGARD TO THIS SOFTWARE INCLUDING ALL IMPLIED WARRANTIES OF
# MERCHANTABILITY AND FITNESS. IN NO EVENT SHALL THE AUTHOR BE LIABLE FOR
# ANY SPECIAL, DIRECT, INDIRECT, OR CONSEQUENTIAL DAMAGES OR ANY DAMAGES
# WHATSOEVER RESULTING FROM LOSS OF USE, DATA OR PROFITS, WHETHER IN AN
# ACTION OF CONTRACT, NEGLIGENCE OR OTHER TORTIOUS ACTION, ARISING OUT OF
# OR IN CONNECTION WITH THE USE OR PERFORMANCE OF THIS SOFTWARE.

use strict;
use warnings;

package OpenBSD::Makewhatis::SubjectHandler;

sub new
{
	my ($class, $p) = @@_;
	return bless { p => $p, subjects => {}}, $class;
}

sub add
{
	my ($h, $s) = @@_;
	$h->{subjects}{$s} = $h->{current};
	$h->{has_subjects} = 1;
}

sub no_subjects
{
	my $h = shift;
	return !$h->{has_subjects};
}

sub subjects
{
	my $h = shift;
	return keys %{$h->{subjects}};
}

sub subject_hash
{
	my $h = shift;
	return $h->{subjects};
}

sub p
{
	my $h = shift;
	return $h->{p};
}

sub set_filename
{
	my ($h, $name) = @@_;
	$h->{current} = $name;
	$h->{has_subjects} = 0;
}

sub filename
{
	my $h = shift;
	return $h->{current};
}

sub errsay
{
	my $h = shift;
	if ($h->p->verbose) {
		push(@@_, $h->filename);
		$h->p->errsay(@@_);
	}
}

sub weird_subject
{
	my ($h, $line) = @@_;
	$h->errsay("Weird subject line in #2:\n#1", $line) ;
}

sub cant_find_subject
{
	my $h = shift;
	$h->errsay("No subject found in #1");
}

package OpenBSD::MakeWhatis::Subject;

sub new
{
}

1;
@


1.4
log
@fix picky mode, my subject handler was not maintaining enough state.
problem introduced some time ago while improving the code :(

okay millert@@
@
text
@d2 1
a2 1
# $OpenBSD: Subject.pm,v 1.3 2013/01/29 11:08:56 espie Exp $
@


1.3
log
@refactor code a bit to actually store subjects in the subject object
reformat for 8 spaces tab.
okay millert@@
@
text
@d2 1
a2 1
# $OpenBSD: Subject.pm,v 1.1 2011/01/26 15:10:59 espie Exp $
d25 1
a25 1
	return bless { p => $p, subjects => []}, $class;
d31 1
a31 1
	push(@@{$h->{subjects}}, $s);
d44 7
a50 1
	return @@{$h->{subjects}};
@


1.2
log
@shut up unless -v, and a few minor enhancements.
okay miod@@
@
text
@d25 1
a25 1
	return bless { p => $p}, $class;
d30 15
@


1.1
log
@placeholder for future changes, as discussed with miod@@
@
text
@d2 1
a2 1
# $OpenBSD$
d24 2
a25 2
	my $class = shift;
	bless {}, $class;
d30 40
@

