head	1.75;
access;
symbols
	OPENBSD_6_0:1.75.0.4
	OPENBSD_6_0_BASE:1.75
	OPENBSD_5_9:1.75.0.2
	OPENBSD_5_9_BASE:1.75
	OPENBSD_5_8:1.73.0.6
	OPENBSD_5_8_BASE:1.73
	OPENBSD_5_7:1.73.0.2
	OPENBSD_5_7_BASE:1.73
	OPENBSD_5_6:1.72.0.4
	OPENBSD_5_6_BASE:1.72
	OPENBSD_5_5:1.70.0.8
	OPENBSD_5_5_BASE:1.70
	OPENBSD_5_4:1.70.0.4
	OPENBSD_5_4_BASE:1.70
	OPENBSD_5_3:1.70.0.2
	OPENBSD_5_3_BASE:1.70
	OPENBSD_5_2:1.68.0.4
	OPENBSD_5_2_BASE:1.68
	OPENBSD_5_1_BASE:1.68
	OPENBSD_5_1:1.68.0.2
	OPENBSD_5_0:1.66.0.4
	OPENBSD_5_0_BASE:1.66
	OPENBSD_4_9:1.66.0.2
	OPENBSD_4_9_BASE:1.66
	OPENBSD_4_8:1.65.0.14
	OPENBSD_4_8_BASE:1.65
	OPENBSD_4_7:1.65.0.10
	OPENBSD_4_7_BASE:1.65
	OPENBSD_4_6:1.65.0.12
	OPENBSD_4_6_BASE:1.65
	OPENBSD_4_5:1.65.0.8
	OPENBSD_4_5_BASE:1.65
	OPENBSD_4_4:1.65.0.6
	OPENBSD_4_4_BASE:1.65
	OPENBSD_4_3:1.65.0.4
	OPENBSD_4_3_BASE:1.65
	OPENBSD_4_2:1.65.0.2
	OPENBSD_4_2_BASE:1.65
	OPENBSD_4_1:1.64.0.6
	OPENBSD_4_1_BASE:1.64
	OPENBSD_4_0:1.64.0.4
	OPENBSD_4_0_BASE:1.64
	OPENBSD_3_9:1.64.0.2
	OPENBSD_3_9_BASE:1.64
	OPENBSD_3_8:1.63.0.4
	OPENBSD_3_8_BASE:1.63
	OPENBSD_3_7:1.63.0.2
	OPENBSD_3_7_BASE:1.63
	OPENBSD_3_6:1.61.0.4
	OPENBSD_3_6_BASE:1.61
	OPENBSD_3_5:1.61.0.2
	OPENBSD_3_5_BASE:1.61
	OPENBSD_3_4:1.60.0.2
	OPENBSD_3_4_BASE:1.60
	OPENBSD_3_3:1.56.0.2
	OPENBSD_3_3_BASE:1.56
	OPENBSD_3_2:1.54.0.2
	OPENBSD_3_2_BASE:1.54
	OPENBSD_3_1:1.50.0.2
	OPENBSD_3_1_BASE:1.50
	OPENBSD_3_0:1.46.0.2
	OPENBSD_3_0_BASE:1.46
	OPENBSD_2_9:1.39.0.2
	OPENBSD_2_9_BASE:1.39
	OPENBSD_2_8:1.35.0.2
	OPENBSD_2_8_BASE:1.35
	OPENBSD_2_7:1.29.0.2
	OPENBSD_2_7_BASE:1.29
	OPENBSD_2_6:1.25.0.2
	OPENBSD_2_6_BASE:1.25
	OPENBSD_2_5:1.17.0.2
	OPENBSD_2_5_BASE:1.17
	OPENBSD_2_4:1.15.0.2
	OPENBSD_2_4_BASE:1.15
	OPENBSD_2_3:1.14.0.2
	OPENBSD_2_3_BASE:1.14
	OPENBSD_2_2:1.12.0.4
	OPENBSD_2_2_BASE:1.12
	OPENBSD_2_1:1.12.0.2
	OPENBSD_2_1_BASE:1.12
	OPENBSD_2_0:1.8.0.2
	OPENBSD_2_0_BASE:1.8
	netbsd_1_1:1.1.1.1;
locks; strict;
comment	@.\" @;


1.75
date	2015.10.25.23.10.53;	author millert;	state Exp;
branches;
next	1.74;
commitid	dV0xt6ZrATpHvSH7;

1.74
date	2015.10.19.19.08.44;	author schwarze;	state Exp;
branches;
next	1.73;
commitid	tw4epKZF2iii8zHQ;

1.73
date	2015.01.15.19.06.32;	author schwarze;	state Exp;
branches;
next	1.72;
commitid	dven8mWEy4wx3j1c;

1.72
date	2014.03.17.22.13.46;	author jmc;	state Exp;
branches;
next	1.71;

1.71
date	2014.03.17.20.54.10;	author sthen;	state Exp;
branches;
next	1.70;

1.70
date	2012.09.27.12.18.20;	author jmc;	state Exp;
branches;
next	1.69;

1.69
date	2012.08.04.14.49.54;	author pascal;	state Exp;
branches;
next	1.68;

1.68
date	2011.12.15.13.55.00;	author ajacoutot;	state Exp;
branches;
next	1.67;

1.67
date	2011.12.14.18.01.55;	author ajacoutot;	state Exp;
branches;
next	1.66;

1.66
date	2010.08.30.07.06.54;	author lum;	state Exp;
branches;
next	1.65;

1.65
date	2007.05.31.19.19.39;	author jmc;	state Exp;
branches;
next	1.64;

1.64
date	2005.09.09.23.12.37;	author jmc;	state Exp;
branches;
next	1.63;

1.63
date	2004.11.28.19.16.04;	author henning;	state Exp;
branches;
next	1.62;

1.62
date	2004.11.21.23.54.48;	author jmc;	state Exp;
branches;
next	1.61;

1.61
date	2003.11.20.12.32.34;	author jmc;	state Exp;
branches;
next	1.60;

1.60
date	2003.09.04.21.17.47;	author jmc;	state Exp;
branches;
next	1.59;

1.59
date	2003.06.02.19.38.24;	author millert;	state Exp;
branches;
next	1.58;

1.58
date	2003.06.02.12.50.25;	author jmc;	state Exp;
branches;
next	1.57;

1.57
date	2003.04.14.06.39.24;	author jmc;	state Exp;
branches;
next	1.56;

1.56
date	2003.01.31.21.54.40;	author jmc;	state Exp;
branches;
next	1.55;

1.55
date	2002.11.15.19.52.15;	author millert;	state Exp;
branches;
next	1.54;

1.54
date	2002.08.28.14.06.47;	author mpech;	state Exp;
branches;
next	1.53;

1.53
date	2002.08.20.18.18.55;	author deraadt;	state Exp;
branches;
next	1.52;

1.52
date	2002.07.28.00.44.47;	author pvalchev;	state Exp;
branches;
next	1.51;

1.51
date	2002.07.14.07.14.09;	author jakob;	state Exp;
branches;
next	1.50;

1.50
date	2002.03.27.18.10.37;	author millert;	state Exp;
branches;
next	1.49;

1.49
date	2002.03.16.19.15.12;	author millert;	state Exp;
branches;
next	1.48;

1.48
date	2001.11.22.16.19.48;	author mpech;	state Exp;
branches;
next	1.47;

1.47
date	2001.11.13.14.06.10;	author mpech;	state Exp;
branches;
next	1.46;

1.46
date	2001.10.10.03.25.03;	author millert;	state Exp;
branches;
next	1.45;

1.45
date	2001.08.22.17.24.45;	author beck;	state Exp;
branches;
next	1.44;

1.44
date	2001.08.22.15.43.27;	author beck;	state Exp;
branches;
next	1.43;

1.43
date	2001.08.20.06.09.32;	author mpech;	state Exp;
branches;
next	1.42;

1.42
date	2001.07.03.21.17.56;	author millert;	state Exp;
branches;
next	1.41;

1.41
date	2001.06.28.22.42.57;	author millert;	state Exp;
branches;
next	1.40;

1.40
date	2001.05.29.21.35.16;	author millert;	state Exp;
branches;
next	1.39;

1.39
date	2001.04.24.12.54.42;	author aaron;	state Exp;
branches;
next	1.38;

1.38
date	2001.01.06.18.24.29;	author millert;	state Exp;
branches;
next	1.37;

1.37
date	2000.12.24.11.15.26;	author aaron;	state Exp;
branches;
next	1.36;

1.36
date	2000.12.02.18.01.11;	author millert;	state Exp;
branches;
next	1.35;

1.35
date	2000.09.08.18.03.27;	author aaron;	state Exp;
branches;
next	1.34;

1.34
date	2000.08.20.18.42.37;	author millert;	state Exp;
branches;
next	1.33;

1.33
date	2000.08.17.17.08.02;	author brad;	state Exp;
branches;
next	1.32;

1.32
date	2000.08.13.22.31.54;	author millert;	state Exp;
branches;
next	1.31;

1.31
date	2000.06.18.21.23.51;	author aaron;	state Exp;
branches;
next	1.30;

1.30
date	2000.06.17.19.42.18;	author deraadt;	state Exp;
branches;
next	1.29;

1.29
date	2000.04.15.11.46.05;	author aaron;	state Exp;
branches;
next	1.28;

1.28
date	2000.04.15.02.15.29;	author aaron;	state Exp;
branches;
next	1.27;

1.27
date	2000.03.14.21.31.46;	author aaron;	state Exp;
branches;
next	1.26;

1.26
date	99.12.03.01.22.46;	author millert;	state Exp;
branches;
next	1.25;

1.25
date	99.09.30.08.28.52;	author downsj;	state Exp;
branches;
next	1.24;

1.24
date	99.09.30.08.00.17;	author downsj;	state Exp;
branches;
next	1.23;

1.23
date	99.07.21.01.07.57;	author deraadt;	state Exp;
branches;
next	1.22;

1.22
date	99.07.09.13.35.50;	author aaron;	state Exp;
branches;
next	1.21;

1.21
date	99.06.14.00.16.56;	author millert;	state Exp;
branches;
next	1.20;

1.20
date	99.06.05.04.16.06;	author aaron;	state Exp;
branches;
next	1.19;

1.19
date	99.05.28.15.54.31;	author aaron;	state Exp;
branches;
next	1.18;

1.18
date	99.05.23.14.11.11;	author aaron;	state Exp;
branches;
next	1.17;

1.17
date	98.12.30.02.52.38;	author downsj;	state Exp;
branches;
next	1.16;

1.16
date	98.12.30.02.09.46;	author deraadt;	state Exp;
branches;
next	1.15;

1.15
date	98.08.04.18.00.32;	author millert;	state Exp;
branches;
next	1.14;

1.14
date	97.12.15.16.52.10;	author kstailey;	state Exp;
branches;
next	1.13;

1.13
date	97.12.12.08.55.09;	author deraadt;	state Exp;
branches;
next	1.12;

1.12
date	97.05.01.14.45.36;	author deraadt;	state Exp;
branches;
next	1.11;

1.11
date	97.04.14.00.55.03;	author millert;	state Exp;
branches;
next	1.10;

1.10
date	97.03.29.20.02.00;	author millert;	state Exp;
branches;
next	1.9;

1.9
date	96.12.03.03.07.16;	author deraadt;	state Exp;
branches;
next	1.8;

1.8
date	96.08.19.04.36.30;	author millert;	state Exp;
branches;
next	1.7;

1.7
date	96.08.10.06.23.41;	author downsj;	state Exp;
branches;
next	1.6;

1.6
date	96.07.29.03.06.33;	author downsj;	state Exp;
branches;
next	1.5;

1.5
date	96.07.28.23.32.15;	author downsj;	state Exp;
branches;
next	1.4;

1.4
date	96.07.28.22.42.45;	author downsj;	state Exp;
branches;
next	1.3;

1.3
date	96.06.18.10.09.17;	author downsj;	state Exp;
branches;
next	1.2;

1.2
date	96.01.16.00.57.48;	author deraadt;	state Exp;
branches;
next	1.1;

1.1
date	95.10.18.08.43.16;	author deraadt;	state Exp;
branches
	1.1.1.1;
next	;

1.1.1.1
date	95.10.18.08.43.16;	author deraadt;	state Exp;
branches;
next	;


desc
@@


1.75
log
@No longer create /var/run/ftpd.pid in daemon mode; OK jung@@ jca@@
@
text
@.\"	$OpenBSD: ftpd.8,v 1.74 2015/10/19 19:08:44 schwarze Exp $
.\"	$NetBSD: ftpd.8,v 1.8 1996/01/14 20:55:23 thorpej Exp $
.\"
.\" Copyright (c) 1985, 1988, 1991, 1993
.\"	The Regents of the University of California.  All rights reserved.
.\"
.\" Redistribution and use in source and binary forms, with or without
.\" modification, are permitted provided that the following conditions
.\" are met:
.\" 1. Redistributions of source code must retain the above copyright
.\"    notice, this list of conditions and the following disclaimer.
.\" 2. Redistributions in binary form must reproduce the above copyright
.\"    notice, this list of conditions and the following disclaimer in the
.\"    documentation and/or other materials provided with the distribution.
.\" 3. Neither the name of the University nor the names of its contributors
.\"    may be used to endorse or promote products derived from this software
.\"    without specific prior written permission.
.\"
.\" THIS SOFTWARE IS PROVIDED BY THE REGENTS AND CONTRIBUTORS ``AS IS'' AND
.\" ANY EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT LIMITED TO, THE
.\" IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE
.\" ARE DISCLAIMED.  IN NO EVENT SHALL THE REGENTS OR CONTRIBUTORS BE LIABLE
.\" FOR ANY DIRECT, INDIRECT, INCIDENTAL, SPECIAL, EXEMPLARY, OR CONSEQUENTIAL
.\" DAMAGES (INCLUDING, BUT NOT LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS
.\" OR SERVICES; LOSS OF USE, DATA, OR PROFITS; OR BUSINESS INTERRUPTION)
.\" HOWEVER CAUSED AND ON ANY THEORY OF LIABILITY, WHETHER IN CONTRACT, STRICT
.\" LIABILITY, OR TORT (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY
.\" OUT OF THE USE OF THIS SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF
.\" SUCH DAMAGE.
.\"
.\"     @@(#)ftpd.8	8.2 (Berkeley) 4/19/94
.\"
.Dd $Mdocdate: October 19 2015 $
.Dt FTPD 8
.Os
.Sh NAME
.Nm ftpd
.Nd Internet File Transfer Protocol server
.Sh SYNOPSIS
.Nm ftpd
.Op Fl 46ADdlMnPSUW
.Op Fl m Ar minuid
.Op Fl T Ar maxtimeout
.Op Fl t Ar timeout
.Op Fl u Ar mask
.Sh DESCRIPTION
.Nm
is the Internet File Transfer Protocol server process.
The server uses the TCP protocol
and listens at the port specified in the
.Dq ftp
service specification; see
.Xr services 5 .
.Pp
The options are as follows:
.Bl -tag -width Ds
.It Fl 4
When
.Fl D
is specified, forces
.Nm
to use IPv4 addresses only.
.It Fl 6
When
.Fl D
is specified, forces
.Nm
to use IPv6 addresses only.
.It Fl A
Permit only anonymous FTP connections
(unless the
.Fl n
option is specified),
accounts listed in
.Pa /etc/ftpchroot
or users in a login class with the
.Dq ftp-chroot
variable set (see below).
Other connection attempts are refused.
.It Fl D
With this option set,
.Nm
will detach and become a daemon, accepting connections on the FTP port and
forking child processes to handle them.
This has lower overhead than starting
.Nm
from
.Xr inetd 8
and is thus useful on busy servers to reduce load.
.It Fl d
Debugging information is written to the syslog using
.Dv LOG_FTP .
.It Fl l
Each successful and failed
FTP session is logged using syslog with a facility of
.Dv LOG_FTP .
If this option is specified twice, the retrieve (get), store (put), append,
delete, make directory, remove directory and rename operations and
their filename arguments are also logged.
.It Fl M
Enables multihomed mode.
Instead of simply using
.Pa ~ftp
for anonymous transfers, a directory matching the fully qualified name of
the IP number the client connected to, and located inside
.Pa ~ftp ,
is used instead.
.It Fl m Ar minuid
Disallow login to user accounts with a UID below
.Ar minuid .
The default is 1000, to prevent access to administrative and daemon accounts.
Anonymous access is allowed even if the UID of the FTP user is smaller than
.Ar minuid .
.It Fl n
Do not permit anonymous FTP logins.
Normally they are permitted.
.It Fl P
Permit illegal port numbers or addresses for PORT command initiated connects.
By default
.Nm
violates the RFC and thus constrains the PORT command to non-reserved ports
and requires it use the same source address as the connection came from.
This prevents the "FTP bounce attack" against services on both the local
machine and other local machines.
.It Fl S
With this option set,
.Nm
logs all anonymous downloads to the file
.Pa /var/log/ftpd
when this file exists.
.It Fl T Ar maxtimeout
A client may also request a different timeout period;
the maximum period allowed may be set to
.Ar maxtimeout
seconds with the
.Fl T
option.
The default limit is 2 hours.
.It Fl t Ar timeout
The inactivity timeout period is set to
.Ar timeout
seconds (the default is 15 minutes).
.It Fl U
Each concurrent
FTP session is logged to the file
.Pa /var/run/utmp ,
making them visible to commands such as
.Xr who 1 .
.Fl U
and
.Fl W
are mutually exclusive.
.It Fl u Ar mask
Force the umask to
.Ar mask ,
instead of the default specified in
.Pa /etc/login.conf
(usually 022).
Also disallows chmod.
.It Fl W
Do not save login records to
.Pa /var/log/wtmp .
.Fl W
and
.Fl U
are mutually exclusive.
.El
.Pp
The file
.Pa /etc/nologin
can be used to disable FTP access.
If the file exists,
.Nm
displays it and exits.
Note: this method will disable
.Em all
non-root logins; see
.Xr login 1
for further details.
If the file
.Pa /etc/ftpwelcome
exists,
.Nm
prints it before issuing the
.Dq ready
message.
If the welcome file exists
.Pa ( /etc/motd
by default),
.Nm
prints it after a successful login.
If the file
.Pa .message
exists in a directory,
.Nm
prints it when that directory is entered.
.Pp
The FTP server currently supports the following FTP requests.
The case of the requests is ignored.
.Bl -column "Request" -offset indent
.It Sy Request Ta Sy Description
.It ABOR Ta "abort previous command"
.It ACCT Ta "specify account (not implemented)"
.It ALLO Ta "allocate storage (vacuously)"
.It APPE Ta "append to a file"
.It CDUP Ta "change to parent of current working directory"
.It CWD Ta "change working directory"
.It DELE Ta "delete a file"
.It EPRT Ta "specify data connection port"
.It EPSV Ta "prepare for server-to-server transfer"
.It HELP Ta "give help information"
.It LIST Ta "give list of files in a directory" Pq Li "ls -lgA"
.It LPRT Ta "specify data connection port"
.It LPSV Ta "prepare for server-to-server transfer"
.It MDTM Ta "show last modification time of file"
.It MKD Ta "make a directory"
.It MODE Ta "specify data transfer" Em mode
.It NLST Ta "give name list of files in directory"
.It NOOP Ta "do nothing"
.It PASS Ta "specify password"
.It PASV Ta "prepare for server-to-server transfer"
.It PORT Ta "specify data connection port"
.It PWD Ta "print the current working directory"
.It QUIT Ta "terminate session"
.It REIN Ta "reinitialize (not implemented)"
.It REST Ta "restart incomplete transfer"
.It RETR Ta "retrieve a file"
.It RMD Ta "remove a directory"
.It RNFR Ta "specify rename-from file name"
.It RNTO Ta "specify rename-to file name"
.It SITE Ta "non-standard commands (see next section)"
.It SIZE Ta "return size of file"
.It SMNT Ta "structure mount (not implemented)"
.It STAT Ta "return status of server"
.It STOR Ta "store a file"
.It STOU Ta "store a file with a unique name"
.It STRU Ta "specify data transfer" Em structure
.It SYST Ta "show operating system type of server system"
.It TYPE Ta "specify data transfer" Em type
.It USER Ta "specify user name; not valid after login"
.It XCUP Ta "change to parent of current working directory (deprec.)"
.It XCWD Ta "change working directory (deprecated)"
.It XMKD Ta "make a directory (deprecated)"
.It XPWD Ta "print the current working directory (deprecated)"
.It XRMD Ta "remove a directory (deprecated)"
.El
.Pp
The following non-standard or UNIX specific commands
are supported by the SITE request:
.Bl -column Request -offset indent
.It Sy Request Ta Sy Description
.It CHMOD Ta "change mode of a file, e.g., SITE CHMOD 755 filename"
.It HELP Ta "give help information"
.It IDLE Ta "set idle-timer, e.g., SITE IDLE 60"
.It UMASK Ta "change umask, e.g., SITE UMASK 002"
.El
.Pp
The remaining FTP requests specified in Internet RFC 959 are recognized,
but not implemented.
MDTM and SIZE are specified in RFC 3659.
.Pp
The FTP server will abort an active file transfer only when the
ABOR
command is preceded by a Telnet "Interrupt Process" (IP)
signal and a Telnet "Synch" signal in the command Telnet stream,
as described in Internet RFC 959.
If a
STAT
command is received during a data transfer, preceded by a Telnet IP
and Synch, transfer status will be returned.
.Pp
.Nm
interprets file names according to the
.Dq globbing
conventions used by
.Xr csh 1 .
This allows users to utilize the metacharacters
.Dq Li \&*?[]{}~ .
.Pp
.Nm
authenticates users by using the service and type of
.Ar ftp ,
as defined in the
.Pa /etc/login.conf
file (see
.Xr login.conf 5 ) .
An authentication style
may be specified by appending with a colon
.Pq Sq :\&
following the authentication style, i.e.\&
.Dq joe:skey .
The allowed authentication styles for
.Nm
may be explicitly specified by the
.Dq auth-ftp
entry in
.Pa /etc/login.conf .
.Pp
.Nm
authenticates users according to the following rules.
.Bl -enum -offset indent
.It
The login name must be in the password database and not have a null password.
In this case a password must be provided by the client before any
file operations may be performed.
.It
The login name must not appear in the file
.Pa /etc/ftpusers .
.It
The user account must have a UID not less than
.Ar minuid .
.It
The user must have a standard shell as described by
.Xr shells 5 .
.It
If the user name appears in the file
.Pa /etc/ftpchroot ,
which is a text file containing one user name per line,
the session's root will be changed to the user's login directory by
.Xr chroot 2
as for an
.Dq anonymous
or
.Dq ftp
account (see next item).
However, the user must still supply a password.
This feature is intended as a compromise between a fully anonymous account
and a fully privileged account.
The account should also be set up as for an anonymous account.
.It
If the user name is
.Dq anonymous
or
.Dq ftp ,
an
anonymous FTP account must be present in the password
file (user
.Dq ftp ) .
In this case the user is allowed
to log in by specifying any password (by convention an email address for
the user should be used as the password).
.El
.Pp
Once a user is authenticated the user must be approved by any approval
script defined (see
.Xr login.conf 5 ) .
If a valid approval script (by either :approve=...: or :approve-ftp=...:
for the user's class) is defined then it is run and must exit with a 0
(success) status.
When
.Nm
is running under the
.Fl D
flag (and debugging is not turned on) then the approval script will be
called with at least the following variables specified via the
.Fl v
option (see
.Xr login.conf 5 )
to the approve script:
.Bl -column "Variable" -offset indent
.It Sy Variable Ta Sy Description
.It FTPD_HOST Ta "The server's (virtual) hostname"
.El
.Pp
For example (the line is broken to fit the page):
.Bd -literal -offset indent
/usr/libexec/auth/approve_ftpd -v FTPD_HOST=ftp.mycompany.com \e
	username class service
.Ed
.Pp
When the user logs in to the anonymous FTP account,
.Nm
takes special measures to restrict the client's access privileges.
The server performs a
.Xr chroot 2
to the home directory of the
.Dq ftp
user.
In order that system security is not breached, it is recommended
that the
.Dq ftp
subtree be constructed with care, following these rules:
.Bl -tag -width "~ftp/pub" -offset indent
.It Pa ~ftp
Make the home directory owned by
.Dq root
and unwritable by anyone (mode 555).
.It Pa ~ftp/bin
Make this directory owned by
.Dq root
and unwritable by anyone (mode 511).
This directory is optional unless you have commands you wish
the anonymous FTP user to be able to run (the
.Xr ls 1
command exists as a built-in).
Any programs in this directory should be mode 111 (executable only).
.It Pa ~ftp/etc
Make this directory owned by
.Dq root
and unwritable by anyone (mode 511).
The files pwd.db (see
.Xr pwd_mkdb 8 )
and
.Xr group 5
must be present for the
.Xr ls 1
command to be able to produce owner names rather than numbers.
The password field in
.Pa pwd.db
is not used, and should not contain real passwords.
The file
.Pa motd ,
if present, will be printed after a successful login.
These files should be mode 444.
.It Pa ~ftp/pub
Make this directory mode 555 and owned by
.Dq root .
This is traditionally where publicly accessible files are
stored for download.
.El
.Pp
If logging to the
.Pa /var/log/ftpd
file is enabled, information will be written in the following format:
.Pp
.Bl -tag -width XXXXXXXXXXXXXX -offset indent -compact
.It time
The time and date of the download, in
.Xr ctime 3
format.
.It elapsed time
The elapsed time, in seconds.
.It remote host
The remote host (or IP number).
.It bytes
The number of bytes transferred.
.It path
The full path (relative to the FTP chroot space) of the file transferred.
.It type
The type of transfer; either
.Sq a
for ASCII or
.Sq b
for binary.
.It unused
Unused field containing a
.Sq * ,
for compatibility.
.It unused
Unused field containing an
.Sq o ,
for compatibility.
.It user type
The type of user; either
.Sq a
for anonymous or
.Sq r
for a real user (should always be anonymous).
.It name
Either a system login name or the value given for
.Dq email address
if an anonymous user.
.It service name
The network service name (always ftp).
.It unused
Unused field containing a
.Sq 0 ,
for compatibility.
.It real name
The system login name if the connection is not anonymous, or a
.Sq *
if it is.
.\" .It virtual host
.\" The virtual host that the connection was made to.
.El
.Pp
Although fields exist for logging information on real users, this file is
only used for anonymous downloads.
Unused fields exist only for compatibility with other
.Nm
implementations.
.Sh LOGIN.CONF VARIABLES
The
.Nm
daemon uses the following FTP-specific parameters:
.Bl -tag -width ftp-chroot
.It Pa auth-ftp
The list of authentication types available to this class.
See
.Xr login.conf 5 .
.It Pa ftp-chroot
A boolean value.
If set, users in this class will be automatically chrooted to
the user's login directory.
.It Pa ftp-dir
A path to a directory.
This value overrides the login directory for users in this class.
A leading tilde
.Pq Ql ~
in
.Pa ftp-dir
will be expanded to the user's home directory based on the
contents of the password database.
.It Pa welcome
The path of the file containing the welcome message.
If this variable is not set,
.Pa /etc/motd
is used.
.El
.Sh PORT ALLOCATION
For passive mode data connections,
.Nm
will listen to a random high TCP port.
The interval of ports used are configurable using
.Xr sysctl 8
variables
.Va net.inet.ip.porthifirst
and
.Va net.inet.ip.porthilast .
.Sh FILES
.Bl -tag -width /etc/ftpwelcome -compact
.It Pa /etc/ftpchroot
list of normal users who should be chrooted
.It Pa /etc/ftpusers
list of unwelcome/restricted users
.It Pa /etc/ftpwelcome
welcome notice
.It Pa /etc/login.conf
authentication styles
.It Pa /etc/motd
printed after a successful login
.It Pa /etc/nologin
displayed and access refused
.It Pa /var/log/ftpd
log file for anonymous downloads
.It Pa /var/log/wtmp
login account records
.It Pa /var/run/utmp
list of users on the system
.El
.Sh SEE ALSO
.Xr ftp 1 ,
.Xr login 1 ,
.Xr skey 1 ,
.Xr who 1 ,
.Xr chroot 2 ,
.Xr ctime 3 ,
.Xr group 5 ,
.Xr login.conf 5 ,
.Xr motd 5 ,
.Xr services 5 ,
.Xr shells 5 ,
.Xr ftp-proxy 8 ,
.Xr inetd 8 ,
.Xr pwd_mkdb 8 ,
.Xr sysctl 8 ,
.Xr syslogd 8
.Sh STANDARDS
.Rs
.%A J. Postel
.%A J. Reynolds
.%D October 1985
.%R RFC 959
.%T FILE TRANSFER PROTOCOL (FTP)
.Re
.Pp
.Rs
.%A P. Hethmon
.%D March 2007
.%R RFC 3659
.%T Extensions to FTP
.Re
.Sh HISTORY
The
.Nm
command appeared in
.Bx 4.2 .
@


1.74
log
@Delete the empty example file "ftpchroot"; no example is needed.
Move the one useful bit of information contained in the file ("one
user name per line") to the ftpd(8) manual page where it belongs.
OK deraadt@@ sthen@@
@
text
@d1 1
a1 1
.\"	$OpenBSD: ftpd.8,v 1.73 2015/01/15 19:06:32 schwarze Exp $
d33 1
a33 1
.Dd $Mdocdate: January 15 2015 $
d521 1
a521 1
.Bl -tag -width /var/run/ftpd.pid -compact
a537 2
.It Pa /var/run/ftpd.pid
process ID if running in daemon mode
@


1.73
log
@remove .Tn; from Jan Stary <hans at stare dot cz>
@
text
@d1 1
a1 1
.\"	$OpenBSD: ftpd.8,v 1.72 2014/03/17 22:13:46 jmc Exp $
d33 1
a33 1
.Dd $Mdocdate: March 17 2014 $
d318 1
@


1.72
log
@tweak previous;
@
text
@d1 1
a1 1
.\"	$OpenBSD: ftpd.8,v 1.71 2014/03/17 20:54:10 sthen Exp $
d49 1
a49 3
The server uses the
.Tn TCP
protocol
d248 2
a249 5
The following non-standard or
.Tn UNIX
specific commands are supported
by the
SITE request:
@


1.71
log
@Add an option to disallow ftp access to accounts with uid below a certain
number (idea borrowed from pure-ftpd). Enabled by default with minimum uid
1000 to prevent access to admin accounts. tweak/OK millert@@, OK deraadt@@,
gsoares@@ and aja@@ like it too.
@
text
@d1 1
a1 1
.\"	$OpenBSD: ftpd.8,v 1.70 2012/09/27 12:18:20 jmc Exp $
d33 1
a33 1
.Dd $Mdocdate: September 27 2012 $
a101 6
.It Fl m Ar minuid
Disallow login to user accounts with a uid below
.Ar minuid .
The default is 1000, to prevent access to administrative and daemon accounts.
Anonymous access is allowed even if the uid of the ftp user is smaller than
.Ar minuid .
d110 6
d305 1
a305 1
authenticates users according to six rules.
d315 1
a315 1
The user account must have a uid not less than
@


1.70
log
@last stage of rfc changes, using consistent Rs/Re blocks, and moving the
references into a STANDARDS section;
@
text
@d1 1
a1 1
.\"	$OpenBSD: ftpd.8,v 1.69 2012/08/04 14:49:54 pascal Exp $
d33 1
a33 1
.Dd $Mdocdate: August 4 2012 $
d42 1
d102 6
d305 1
a305 1
authenticates users according to five rules.
d314 3
@


1.69
log
@MDTM and SIZE have been in RFC 3659 for over five years.  Also, mention both
RFCs in "SEE ALSO".

ok jmc@@
@
text
@d1 1
a1 1
.\"	$OpenBSD: ftpd.8,v 1.68 2011/12/15 13:55:00 ajacoutot Exp $
d33 1
a33 1
.Dd $Mdocdate: December 15 2011 $
d554 1
d556 3
d560 1
a560 2
.%T "File Transfer Protocol"
.%D October 1985
d562 1
d564 2
d567 1
a567 2
.%T "Extensions to FTP"
.%D March 2007
@


1.68
log
@s,/var/run/wtmp,/var/log/wtmp and add it to FILES.

from Steffen Daode Nurpmeso with a tweak from jmc@@
ok jmc@@
@
text
@d1 1
a1 1
.\"	$OpenBSD: ftpd.8,v 1.67 2011/12/14 18:01:55 ajacoutot Exp $
d33 1
a33 1
.Dd $Mdocdate: December 14 2011 $
d258 1
a258 2
MDTM and SIZE are not specified in RFC 959,
but will appear in the next updated FTP RFC.
d554 10
@


1.67
log
@Add a new '-W' option to prevent saving login records to /var/run/wtmp.
This can become pretty handy on busy anonymous servers to avoid filling
up /var with unused wtmp records.
Note that 'U' and 'W' are mutually exclusive.

ok sthen@@ millert@@
@
text
@d1 1
a1 1
.\"	$OpenBSD: ftpd.8,v 1.66 2010/08/30 07:06:54 lum Exp $
d33 1
a33 1
.Dd $Mdocdate: August 30 2010 $
d157 1
a157 1
.Pa /var/run/wtmp .
d531 2
@


1.66
log
@Add missing network service name from /var/log/ftpd entries.

ok and suggestion from jmc@@ ok tobias@@
@
text
@d1 1
a1 1
.\"	$OpenBSD: ftpd.8,v 1.65 2007/05/31 19:19:39 jmc Exp $
d33 1
a33 1
.Dd $Mdocdate: May 31 2007 $
d41 1
a41 1
.Op Fl 46ADdlMnPSU
d144 4
d155 7
@


1.65
log
@convert to new .Dd format;
@
text
@d1 1
a1 1
.\"	$OpenBSD: ftpd.8,v 1.64 2005/09/09 23:12:37 jmc Exp $
d33 1
a33 1
.Dd $Mdocdate$
d447 2
@


1.64
log
@uppercase `FTP' when talking about the protocol rather than the
ftp(1) binary...this is in line with what ftp(1) already does...
@
text
@d1 1
a1 1
.\"	$OpenBSD: ftpd.8,v 1.63 2004/11/28 19:16:04 henning Exp $
d33 1
a33 1
.Dd June 18, 1996
@


1.63
log
@remove no longer appropriate bugs section
@
text
@d1 1
a1 1
.\"	$OpenBSD: ftpd.8,v 1.62 2004/11/21 23:54:48 jmc Exp $
d71 1
a71 1
Permit only anonymous ftp connections
d96 1
a96 2
.Xr ftp 1
session is logged using syslog with a facility of
d110 1
a110 1
Do not permit anonymous ftp logins.
d140 1
a140 2
.Xr ftp 1
session is logged to the file
d155 1
a155 1
can be used to disable ftp access.
d182 1
a182 1
The ftp server currently supports the following ftp requests.
d245 1
a245 1
The remaining ftp requests specified in Internet RFC 959 are recognized,
d250 1
a250 1
The ftp server will abort an active file transfer only when the
d320 1
a320 1
anonymous ftp account must be present in the password
d355 1
a355 1
When the user logs in to the anonymous ftp account,
d377 1
a377 1
the anonymous ftp user to be able to run (the
d422 1
a422 1
The full path (relative to the ftp chroot space) of the file transferred.
d467 1
a467 1
daemon uses the following ftp specific parameters:
@


1.62
log
@clarify -A option;
from a discussion on misc@@
@
text
@d1 1
a1 1
.\"	$OpenBSD: ftpd.8,v 1.61 2003/11/20 12:32:34 jmc Exp $
a546 8
.Sh BUGS
The server must run as the superuser to create sockets with
privileged port numbers.
It maintains
an effective user ID of the logged in user, reverting to
the superuser only when binding addresses to sockets.
The possible security holes have been extensively scrutinized,
but are possibly incomplete.
@


1.61
log
@ftpd.8:
- simpler macros
- sort options
- some updates

ftpd.c:
- sync usage()
@
text
@d1 1
a1 1
.\"	$OpenBSD: ftpd.8,v 1.60 2003/09/04 21:17:47 jmc Exp $
d71 5
a75 1
Permit only anonymous ftp connections, accounts listed in
@


1.60
log
@typo;
@
text
@d1 1
a1 1
.\"	$OpenBSD: ftpd.8,v 1.59 2003/06/02 19:38:24 millert Exp $
d41 1
a41 1
.Op Fl AdDlMnPSU46
d58 12
a76 2
.It Fl d
Debugging information is written to the syslog using LOG_FTP.
d87 3
d93 2
a94 1
session is logged using syslog with a facility of LOG_FTP.
a122 19
.It Fl U
Each concurrent
.Xr ftp 1
session is logged to the file
.Pa /var/run/utmp ,
making them visible to commands such as
.Xr who 1 .
.It Fl 4
When
.Fl D
is specified, forces
.Nm
to use IPv4 addresses only.
.It Fl 6
When
.Fl D
is specified, forces
.Nm
to use IPv6 addresses only.
d135 7
d157 5
d185 1
a185 1
.It ACCT Ta "specify account (ignored)"
d191 1
a192 1
.It EPRT Ta "specify data connection port"
d194 2
a195 1
.It LIST Ta "give list files in a directory" Pq Dq Li "ls -lgA"
d197 1
a197 1
.It LPRT Ta "specify data connection port"
a198 1
.It MDTM Ta "show last modification time of file"
d207 1
d215 1
d222 2
a223 2
.It USER Ta "specify user name, not valid after login"
.It XCUP Ta "change to parent of current working directory (deprecated)"
d234 1
a234 2
SITE request.
.Pp
d237 4
a240 4
.It UMASK Ta change umask, e.g., ``SITE UMASK 002''
.It IDLE Ta set idle-timer, e.g., ``SITE IDLE 60''
.It CHMOD Ta change mode of a file, e.g., ``SITE CHMOD 755 filename''
.It HELP Ta give help information
d243 4
a246 5
The remaining ftp requests specified in Internet RFC 959
are
recognized, but not implemented.
MDTM and SIZE are not specified in RFC 959, but will appear in the
next updated FTP RFC.
d274 3
a276 6
may be specified by appending with a colon (
.Do
:
.Dc
)
following the authentication style, i.e.
a286 1
.Pp
d300 1
a300 1
.Pa /etc/ftpchroot
d348 3
a350 5
.sp
.Bd -ragged -offset indent
.Pa /usr/libexec/auth/approve_ftpd Fl v
FTPD_HOST=ftp.mycompany.com \\
.Dl Ar username Ar class Ar service
d420 1
a420 1
The full path (relative the ftp chroot space) of the file transferred.
d423 1
a423 1
.Dq a
d425 1
a425 1
.Dq b
d429 1
a429 1
.Dq * ,
d432 2
a433 2
Unused field containing a
.Dq o ,
d436 4
a439 4
The type of user, either
.Dq a
for anonymous, or
.Dq r
d446 2
a447 2
Unused field, containing a
.Dq 0 ,
d451 1
a451 1
.Dq *
d453 2
a454 2
.It virtual host
The virtual host that the connection was made to.
d493 1
a493 1
will listen to a random high tcp port.
d497 1
a497 1
.Li net.inet.ip.porthifirst
d499 1
a499 1
.Li net.inet.ip.porthilast .
d523 1
d527 2
d530 2
d535 2
@


1.59
log
@Remove the advertising clause in the UCB license which Berkeley
rescinded 22 July 1999.  Proofed by myself and Theo.
@
text
@d1 1
a1 1
.\"	$OpenBSD: ftpd.8,v 1.58 2003/06/02 12:50:25 jmc Exp $
d142 1
a142 1
.Ar mask .
@


1.58
log
@- sort an Xr to self
- kill whitespace at EOL
@
text
@d1 1
a1 1
.\"	$OpenBSD: ftpd.8,v 1.57 2003/04/14 06:39:24 jmc Exp $
d15 1
a15 5
.\" 3. All advertising materials mentioning features or use of this software
.\"    must display the following acknowledgement:
.\"	This product includes software developed by the University of
.\"	California, Berkeley and its contributors.
.\" 4. Neither the name of the University nor the names of its contributors
@


1.57
log
@built in -> built-in;

from NetBSD (Igor Sobrado);
smrsh(8) passed on to sendmail people;

ok millert@@
@
text
@d1 1
a1 1
.\"	$OpenBSD: ftpd.8,v 1.56 2003/01/31 21:54:40 jmc Exp $
d102 1
a102 1
.Xr ftpd 8
d494 1
a494 1
For passive mode data connections, 
d498 1
a498 1
.Xr sysctl 8 
@


1.56
log
@typos;
eeprom(8): added .Ar to fields, removed references to sun3
sshd(8): help and ok markus@@

help and ok millert@@
@
text
@d1 1
a1 1
.\"	$OpenBSD: ftpd.8,v 1.55 2002/11/15 19:52:15 millert Exp $
d380 1
a380 1
command exists as a builtin).
@


1.55
log
@o Once a user is logged in, don't allow a change to another user.
o Run more code with the effective uid of the logged in user.
From Frank Denis
@
text
@d1 1
a1 1
.\"	$OpenBSD: ftpd.8,v 1.54 2002/08/28 14:06:47 mpech Exp $
d94 1
a94 1
.Pa ~ftp
d236 1
a236 1
.It HELP Ta give help information.
d531 1
d533 1
a533 2
.Xr syslogd 8 ,
.Xr ftp-proxy 8
@


1.54
log
@o) start new sentence on a new line;
o) don't use .Nm w/o argument in .SYNOPSIS;
I waste time, when fixing already cleaned pages. :(

one man ok@@
@
text
@d1 1
a1 1
.\"	$OpenBSD: ftpd.8,v 1.53 2002/08/20 18:18:55 deraadt Exp $
d217 1
a217 1
.It USER Ta "specify user name"
@


1.53
log
@-n: disallow anon ftp even if ftp account exists
@
text
@d1 1
a1 1
.\"	$OpenBSD: ftpd.8,v 1.52 2002/07/28 00:44:47 pvalchev Exp $
d97 2
a98 1
Do not permit anonymous ftp logins.  Normally they are permitted.
@


1.52
log
@talk about auth-ftp, not auth-ftpd entry in login.conf; from francesco@@toscan.biz
@
text
@d1 1
a1 1
.\"	$OpenBSD: ftpd.8,v 1.51 2002/07/14 07:14:09 jakob Exp $
d45 1
a45 1
.Op Fl AdDlMPSU46
d96 2
@


1.51
log
@make ftpd always listen to a high tcp port for passive data connections.
deprecate and ignore the -h option. ok deraadt@@.
@
text
@d1 1
a1 1
.\"	$OpenBSD: ftpd.8,v 1.50 2002/03/27 18:10:37 millert Exp $
d278 1
a278 1
.Dq auth-ftpd
@


1.50
log
@From David Krause:
o ftpd.8: alphabetically sort FILES and add login.conf & motd
o midi.4 and pckbd.4: there is no pcppi(4) man page
o passwd.5: s/passwd.conf/login.conf
@
text
@d1 1
a1 1
.\"	$OpenBSD: ftpd.8,v 1.49 2002/03/16 19:15:12 millert Exp $
d45 1
a45 1
.Op Fl AdDhlMPSU46
a80 10
.It Fl h
The server will use data ports in the high port range for passive connections.
This range is defined by the
.Ev IPPORT_HIFIRSTAUTO
and
.Ev IPPORT_HILASTAUTO
defines in <netinet/in.h>.
In
.Ox
they are set to 49152 and 65535 respectively.
d490 10
@


1.49
log
@o Don't allow password-less accounts to login (like in 2.9 and below)
o Stash copy of struct passwd via auth_setpwd() to avoid extra needless
  getpwnam() calls.
@
text
@d1 1
a1 1
.\"	$OpenBSD: ftpd.8,v 1.47 2001/11/13 14:06:10 mpech Exp $
d502 2
a505 2
.It Pa /etc/ftpchroot
list of normal users who should be chrooted
d508 4
d514 4
a519 4
.It Pa /var/run/ftpd.pid
process ID if running in daemon mode
.It Pa /var/log/ftpd
log file for anonymous downloads
@


1.48
log
@since 3.0 ftpd allow users w/o password. Spotted by form@@.

millert@@ ok
@
text
@d297 3
a299 1
The login name must be in the password database.
@


1.47
log
@o) fix bogus .Xr usage;
o) start new sentence on a new line;
o) don't use .Xr instead of .Pa tag;
o) minimal -mdoc design fixes;

millert@@ ok;
@
text
@d1 1
a1 1
.\"	$OpenBSD: ftpd.8,v 1.46 2001/10/10 03:25:03 millert Exp $
d297 1
a297 3
The login name must be in the password database and not have a null password.
In this case a password must be provided by the client before any
file operations may be performed.
@


1.46
log
@ftp-chroot variable is documented in this man page, not login.conf(5)
@
text
@d1 1
a1 1
.\"	$OpenBSD: ftpd.8,v 1.45 2001/08/22 17:24:45 beck Exp $
d336 1
a336 1
.Xr login.conf ) .
d339 2
a340 1
(success) status.  When
d398 1
a398 1
.Xr ls
d401 1
a401 1
.Xr pwd.db
@


1.45
log
@missing space
@
text
@d1 1
a1 1
.\"	$OpenBSD: ftpd.8,v 1.44 2001/08/22 15:43:27 beck Exp $
d67 1
a67 2
variable set (see
.Xr login.conf 5 ) .
@


1.44
log
@See also ftp-proxy
@
text
@d1 1
a1 1
.\"	$OpenBSD: ftpd.8,v 1.43 2001/08/20 06:09:32 mpech Exp $
d525 1
a525 1
.Xr syslogd 8,
@


1.43
log
@Powered by @@mantoya.
o) we don't like .Nd without argument, except next line starts with a new
tag;

millert@@ ok
@
text
@d1 1
a1 1
.\"	$OpenBSD: ftpd.8,v 1.42 2001/07/03 21:17:56 millert Exp $
d525 2
a526 1
.Xr syslogd 8
@


1.42
log
@Use the 'welcome' variable from login.conf instead of hard-coding
/etc/motd.
@
text
@d1 1
a1 1
.\"	$OpenBSD: ftpd.8,v 1.41 2001/06/28 22:42:57 millert Exp $
d42 1
a42 2
.Nd
Internet File Transfer Protocol server
@


1.41
log
@Clariry, brevity and grammar
@
text
@d1 1
a1 1
.\"	$OpenBSD: ftpd.8,v 1.40 2001/05/29 21:35:16 millert Exp $
d175 3
a177 3
If the file
.Pa /etc/motd
exists,
d495 5
a508 2
.It Pa /etc/motd
welcome notice after login
@


1.40
log
@use BSD authentication
@
text
@d1 1
a1 1
.\"	$OpenBSD: ftpd.8,v 1.39 2001/04/24 12:54:42 aaron Exp $
d484 2
a485 2
If set, users in this class will be automatically chrooted to login
directory for the user.
d488 1
a488 1
This value overrides the login directory for the users of this class.
d493 2
a494 1
will be expanded based on the contents of the password database.
@


1.39
log
@compatility -> compatibility; mpech@@prosoft.org.lv
@
text
@d1 1
a1 1
.\"	$OpenBSD: ftpd.8,v 1.38 2001/01/06 18:24:29 millert Exp $
d189 1
a189 1
.It Request Ta "Description"
d197 2
d201 2
d273 22
d299 1
a299 3
The login name must be in the password data base,
.Pa /etc/pwd.db ,
and not have a null password.
a301 10
If the user has an S/Key key, the response from a successful USER
command will include an S/Key challenge.
The client may choose to respond with a PASS command giving either a
standard password or an S/Key one-time password.
The server will automatically determine which type of
password it has been given and attempt to authenticate accordingly.
See
.Xr skey 1
for more information on S/Key authentication.
S/Key is a Trademark of Bellcore.
d336 29
a364 1
In the last case,
d411 1
a411 1
This is traditionally where publically accessible files are
d478 4
d500 1
a500 1
list of normal users who should be chroot'd
d518 2
d521 1
@


1.38
log
@Expand tilde (~) in ftp-dir login.conf variable.  Closes PR 1382
@
text
@d1 1
a1 1
.\"	$OpenBSD: ftpd.8,v 1.37 2000/12/24 11:15:26 aaron Exp $
d428 1
a428 1
Unused fields exist only for compatility with other
@


1.37
log
@Xr shells(5), not getusershell(3).
@
text
@d1 1
a1 1
.\"	$OpenBSD: ftpd.8,v 1.36 2000/12/02 18:01:11 millert Exp $
d443 5
@


1.36
log
@The man page says the default umask is 027 but it is really 022 since
that is the value of CMASK.

Have setusercontext() set the umask unless the -u flag was specified.
This allows the admin to set the umask either via -u or via a login
class in login.conf.
@
text
@d1 1
a1 1
.\"	$OpenBSD: ftpd.8,v 1.35 2000/09/08 18:03:27 aaron Exp $
d292 2
a293 2
The user must have a standard shell returned by
.Xr getusershell 3 .
d467 1
a467 1
.Xr getusershell 3 ,
@


1.35
log
@Some miscellaneous man page repairs.
@
text
@d1 1
a1 1
.\"	$OpenBSD: ftpd.8,v 1.34 2000/08/20 18:42:37 millert Exp $
d156 3
a158 1
instead of the default 027.
@


1.34
log
@Add calls to setusercontext() and login_get*().  We basically call
setusercontext() in most places where previously we did a setlogin().
Add default login.conf file and put root in the "daemon" login class.
@
text
@d1 1
a1 1
.\"	$OpenBSD: ftpd.8,v 1.33 2000/08/17 17:08:02 brad Exp $
d51 3
a53 4
.Nm Ftpd
is the
Internet File Transfer Protocol
server process.  The server uses the
d61 1
a61 1
Available options:
d75 1
a75 1
.Nm ftpd
d77 3
a79 3
forking child processes to handle them. This has lower overhead than
starting
.Nm ftpd
d89 2
a90 1
defines in <netinet/in.h>.  In
d101 2
a102 1
Enables multihomed mode.  Instead of simply using
d118 1
a118 1
.Nm ftpd
d156 2
a157 1
instead of the default 027.  Also disallows chmod.
d177 2
a178 1
prints it after a successful login.  If the file
d258 1
a258 1
.Nm Ftpd
d266 1
a266 1
.Nm Ftpd
d277 6
a282 4
command will include an S/Key challenge. The client may choose to respond
with a PASS command giving either a standard password or an S/Key
one-time password. The server will automatically determine which type of
password it has been given and attempt to authenticate accordingly. See
d284 2
a285 2
for more information on S/Key authentication. S/Key is a Trademark of
Bellcore.
d301 2
a302 1
account (see next item).  However, the user must still supply a password.
d304 2
a305 2
and a fully privileged account.  The account should also be set up as for an
anonymous account.
d321 1
a321 1
.Nm ftpd
d425 3
a427 3
only used for anonymous downloads.  Unused fields exist only for compatility
with other
.Nm ftpd
d445 1
a445 1
List of unwelcome/restricted users.
d447 1
a447 1
List of normal users who should be chroot'd.
d449 1
a449 1
Welcome notice.
d451 1
a451 1
Welcome notice after login.
d453 1
a453 1
Displayed and access refused.
d455 1
a455 1
List of users on the system.
d457 1
a457 1
Process id if running in daemon mode.
d459 1
a459 1
Log file for anonymous downloads.
a466 7
.Sh BUGS
The server must run as the superuser
to create sockets with privileged port numbers.  It maintains
an effective user ID of the logged in user, reverting to
the superuser only when binding addresses to sockets.  The
possible security holes have been extensively
scrutinized, but are possibly incomplete.
d472 8
@


1.33
log
@document -4 and -6 options
@
text
@d1 1
a1 1
.\"	$OpenBSD: ftpd.8,v 1.32 2000/08/13 22:31:54 millert Exp $
d65 6
a70 2
Permit only anonymous ftp connections or accounts listed in
.Pa /etc/ftpchroot .
d423 13
@


1.32
log
@Remove documentation for non-existent -p option; a7r@@andern.org
@
text
@d1 1
a1 1
.\"	$OpenBSD: ftpd.8,v 1.31 2000/06/18 21:23:51 aaron Exp $
d46 1
a46 1
.Op Fl AdDhlMPSU
d124 12
@


1.31
log
@transfered -> transferred
@
text
@d1 1
a1 1
.\"	$OpenBSD: ftpd.8,v 1.30 2000/06/17 19:42:18 deraadt Exp $
a102 6
.It Fl p
Disable passive mode ftp connections.  This is useful if you are behind
a firewall that refuses connections to arbitrary high numbered ports.
Many ftp clients try passive mode first and do not always react gracefully
to a server that refuses connections to the port it asked the client to
connect to.
@


1.30
log
@pr 772; -u blocks chmod command, michaels@@inet.no
@
text
@d1 1
a1 1
.\"	$OpenBSD: ftpd.8,v 1.29 2000/04/15 11:46:05 aaron Exp $
d369 1
a369 1
The number of bytes transfered.
d371 1
a371 1
The full path (relative the ftp chroot space) of the file transfered.
@


1.29
log
@- For consistency, `super-user' -> `superuser' in all cases.
- Some punctuation fixes.
- Some `id' -> `ID'.
@
text
@d1 1
a1 1
.\"	$OpenBSD: ftpd.8,v 1.28 2000/04/15 02:15:29 aaron Exp $
d143 1
a143 1
Change the default umask from 027 to
d145 1
@


1.28
log
@Mostly punctuation fixes.
@
text
@d1 1
a1 1
.\"	$OpenBSD: ftpd.8,v 1.27 2000/03/14 21:31:46 aaron Exp $
d438 1
a438 1
The server must run as the super-user
d441 1
a441 1
the super-user only when binding addresses to sockets.  The
@


1.27
log
@Suffix "i.e." and "e.g." with a comma. Just another really picky man page
commit, as we want our documentation to be as consistently formatted as
possible (it's getting there :-)).
@
text
@d1 1
a1 1
.\"	$OpenBSD: ftpd.8,v 1.26 1999/12/03 01:22:46 millert Exp $
d66 1
a66 1
.Pa /etc/ftpchroot.
@


1.26
log
@Write pid to /var/run/ftpd.pid if running in daemon mode.
@
text
@d1 1
a1 1
.\"	$OpenBSD: ftpd.8,v 1.25 1999/09/30 08:28:52 downsj Exp $
d222 3
a224 3
.It UMASK Ta change umask, e.g. ``SITE UMASK 002''
.It IDLE Ta set idle-timer, e.g. ``SITE IDLE 60''
.It CHMOD Ta change mode of a file, e.g. ``SITE CHMOD 755 filename''
@


1.25
log
@Logfile documentation.
@
text
@d1 1
a1 1
.\"	$OpenBSD: ftpd.8,v 1.24 1999/09/30 08:00:17 downsj Exp $
d413 1
a413 1
.Bl -tag -width /etc/ftpwelcome -compact
d426 2
@


1.24
log
@s/transfers/downloads/
@
text
@d1 1
a1 1
.\"	$OpenBSD: ftpd.8,v 1.23 1999/07/21 01:07:57 deraadt Exp $
d353 59
d427 1
a427 1
Log file for anonymous transfers.
@


1.23
log
@use .Ar on later .It Fl lines
@
text
@d1 1
a1 1
.\"	$OpenBSD: ftpd.8,v 1.22 1999/07/09 13:35:50 aaron Exp $
d120 1
a120 1
logs all anonymous transfers to the file
@


1.22
log
@- remove all trailing whitespace
     * except when it is escaped with a `\' at the end of the line
- fix remaining .Nm usage as well
- this is from a patch I received from kwesterback@@home.com, who has been
  working on some scripts for fixing formatting errors in mdoc'd man pages

Ok, so there could be a cost/benefit debate with this commit, but since I have
the patch we might as well commit it...
@
text
@d1 1
a1 1
.\"	$OpenBSD: ftpd.8,v 1.21 1999/06/14 00:16:56 millert Exp $
d130 1
a130 1
.It Fl T
d133 1
a133 1
.Ar timeout
d138 1
a138 1
.It Fl t
d142 1
a142 1
.It Fl u
@


1.21
log
@ls(1) is now builtin to ftpd(8).  Noted by jean@@parc.xerox.com; closes PR 858
@
text
@d1 1
a1 1
.\"	$OpenBSD: ftpd.8,v 1.20 1999/06/05 04:16:06 aaron Exp $
d90 1
a90 1
Each successful and failed 
d157 1
a157 1
prints it before issuing the 
d253 1
a253 1
authenticates users according to five rules. 
d274 1
a274 1
The user must have a standard shell returned by 
d286 1
a286 1
This feature is intended as a compromise between a fully anonymous account 
d303 1
a303 1
In the last case, 
d306 1
a306 1
The server performs a 
d337 1
a337 1
must be present for the 
@


1.20
log
@capitalize the acronym ID
@
text
@d1 1
a1 1
.\"	$OpenBSD: ftpd.8,v 1.19 1999/05/28 15:54:31 aaron Exp $
d103 6
d324 2
a325 1
The program
d327 2
a328 2
must be present to support the list command.
This program should be mode 111 (executable only).
@


1.19
log
@SYNOPSIS section was missing the -A flag
@
text
@d1 1
a1 1
.\"	$OpenBSD: ftpd.8,v 1.18 1999/05/23 14:11:11 aaron Exp $
d372 1
a372 1
an effective user id of the logged in user, reverting to
@


1.18
log
@remove argument from .Os macros so value in /usr/share/tmac/mdoc/doc-common
is used instead; kwesterback@@home.com
@
text
@d1 1
a1 1
.\"	$OpenBSD: ftpd.8,v 1.17 1998/12/30 02:52:38 downsj Exp $
d46 1
a46 1
.Op Fl dDhlMPSU
@


1.17
log
@No, it was a NOT a typo.
@
text
@d1 1
a1 1
.\"	$OpenBSD: ftpd.8,v 1.16 1998/12/30 02:09:46 deraadt Exp $
d39 1
a39 1
.Os BSD 4.2
@


1.16
log
@typo; evanc@@concer.to
@
text
@d1 1
a1 1
.\"	$OpenBSD: ftpd.8,v 1.15 1998/08/04 18:00:32 millert Exp $
d99 2
a100 2
for anonymous transfers, a directory matching the fully qualified name or
IP number the client connected to, and located inside
@


1.15
log
@Fix definition of high port and tell where they come from; noted by karls@@inet.no
@
text
@d1 1
a1 1
.\"	$OpenBSD: ftpd.8,v 1.14 1997/12/15 16:52:10 kstailey Exp $
d99 1
a99 1
for anonymous transfers, a directory matching the fully qualified name of
@


1.14
log
@alphasort flags
@
text
@d1 1
a1 1
.\"	$OpenBSD: ftpd.8,v 1.13 1997/12/12 08:55:09 deraadt Exp $
d81 8
a88 2
The server will use data ports in the high port range (normally 40000..44999)
for passive connections.
@


1.13
log
@default to violating the RFC wrt the PORT command. Use -P to conform to the
RFC and possibly open up non-OpenBSD boxes in a trust relationship on your
network to possible ftp bounce attacks...
@
text
@d1 1
a1 1
.\"	$OpenBSD: ftpd.8,v 1.12 1997/05/01 14:45:36 deraadt Exp $
d46 1
a46 1
.Op Fl dDhlMSUP
@


1.12
log
@change -A to let in anon | chroot accounts
@
text
@d1 1
a1 1
.\"	$OpenBSD: ftpd.8,v 1.11 1997/04/14 00:55:03 millert Exp $
d46 1
a46 1
.Op Fl dDhlMSU
d97 8
@


1.11
log
@Make ftpd man page and ftp spool entries in mtree special file
consistent.  Noted by William Wisner <wisner@@gryphon.com>
@
text
@d1 1
a1 1
.\"	$OpenBSD: ftpd.8,v 1.10 1997/03/29 20:02:00 millert Exp $
d65 2
a66 1
Permit only anonymous ftp connections.
@


1.10
log
@Document .message
@
text
@d1 1
a1 1
.\"	$OpenBSD: ftpd.8,v 1.9 1996/12/03 03:07:16 deraadt Exp $
d302 1
a302 1
and unwritable by anyone (mode 555 or 111).
d310 1
a310 1
and unwritable by anyone (mode 555 or 111).
@


1.9
log
@-A for anon only; from freebsd
@
text
@d1 1
a1 1
.\"	$OpenBSD: ftpd.8,v 1.8 1996/08/19 04:36:30 millert Exp $
d143 5
a147 1
prints it after a successful login.
@


1.8
log
@Don't tell people to make ~ftp/pub mode 777 and other minor nits.
@
text
@d1 1
a1 1
.\"	$OpenBSD: ftpd.8,v 1.7 1996/08/10 06:23:41 downsj Exp $
d64 3
@


1.7
log
@A little documentation never hurt.
@
text
@d1 1
a1 1
.\"	$OpenBSD: ftpd.8,v 1.6 1996/07/29 03:06:33 downsj Exp $
d119 1
a119 1
The default umask is set to
d291 1
a291 1
and unwritable by anyone.
d295 1
a295 1
and unwritable by anyone (mode 555).
d299 1
a299 1
This program should be mode 111.
d303 1
a303 1
and unwritable by anyone (mode 555).
d305 1
a305 1
.Xr passwd 5 )
d312 1
a312 1
.Xr passwd
d319 4
a322 5
Make this directory mode 777 and owned by
.Dq ftp .
Guests
can then place files which are to be accessible via the anonymous
account in this directory.
@


1.6
log
@Add -h, causing passive mode connections to request the high port range.

Also a few other changes.
@
text
@d1 1
a1 1
.\"	$OpenBSD: ftpd.8,v 1.5 1996/07/28 23:32:15 downsj Exp $
d46 1
a46 1
.Op Fl dDhlSU
d86 7
@


1.5
log
@Add daemon mode (from FreeBSD), moving a lot of things around.

Also change the advertised version to '6.1/OpenBSD'; using the old version
number from 4.4BSD seems rather silly at this point.
@
text
@d1 1
a1 1
.\"	$OpenBSD: ftpd.8,v 1.4 1996/07/28 22:42:45 downsj Exp $
d46 1
a46 1
.Op Fl dDlSU
d76 3
@


1.4
log
@Add anonymous statistics logging, based on FreeBSD but with the really
obvious bugs fixed.
@
text
@d1 1
a1 1
.\"	$OpenBSD: ftpd.8,v 1.3 1996/06/18 10:09:17 downsj Exp $
d46 1
a46 1
.Op Fl dlSU
d66 10
@


1.3
log
@my netbsd pr#2217: add utmp support to ftpd, some other small changes/fixes.
@
text
@d1 1
a1 1
.\"	$OpenBSD$
d46 1
a46 1
.Op Fl dlU
d73 6
d319 2
@


1.2
log
@from netbsd:
Correct the instructions regarding the password database in
~ftp/etc, from Rob Windsor <windsor@@ksu.ksu.edu> in PR #544.
@
text
@d1 1
d37 1
a37 1
.Dd April 19, 1994
d46 1
a46 1
.Op Fl dl
d49 1
d73 7
d92 3
d311 2
d317 1
@


1.1
log
@Initial revision
@
text
@d1 1
a1 1
.\"	$NetBSD: ftpd.8,v 1.7 1995/04/11 02:44:53 cgd Exp $
d266 2
a267 2
The files
.Xr passwd 5
@


1.1.1.1
log
@initial import of NetBSD tree
@
text
@@
