head	1.4;
access;
symbols
	OPENBSD_6_1:1.4.0.4
	OPENBSD_6_1_BASE:1.4
	OPENBSD_6_0:1.4.0.2
	OPENBSD_6_0_BASE:1.4
	OPENBSD_5_9:1.1.0.2
	OPENBSD_5_9_BASE:1.1;
locks; strict;
comment	@# @;


1.4
date	2016.05.07.19.05.23;	author guenther;	state Exp;
branches;
next	1.3;
commitid	d9R7VGw9CHTkwXE1;

1.3
date	2016.03.21.01.52.45;	author guenther;	state Exp;
branches;
next	1.2;
commitid	wG7PPtfGd1wknOcX;

1.2
date	2016.03.20.02.29.51;	author guenther;	state Exp;
branches;
next	1.1;
commitid	Kpc3J4Ry51yjfQid;

1.1
date	2015.08.23.23.20.00;	author guenther;	state Exp;
branches;
next	;
commitid	Nimc1TnpkyT0ONny;


desc
@@


1.4
log
@Use a Thread Information Block in both single and multi-threaded programs.
This stores errno, the cancelation flags, and related bits for each thread
and is allocated by ld.so or libc.a.  This is an ABI break from 5.9-stable!

Make libpthread dlopen'able by moving the cancelation wrappers into libc
and doing locking and fork/errno handling via callbacks that libpthread
registers when it first initializes.  'errno' *must* be declared via
<errno.h> now!

Clean up libpthread's symbol exports like libc.

On powerpc, offset the TIB/TCB/TLS data from the register per the ELF spec.

Testing by various, particularly sthen@@ and patrick@@
ok kettenis@@
@
text
@{
	global:
		/* actual exports */
		dl_iterate_phdr;
		dladdr;
		dlclose;
		dlctl;
		dlerror;
		dlopen;
		dlsym;
		environ;
		__progname;

		/* alias in reserved namespace for libpthread to use */
		_dlctl;

		/* TLS related bits */
		_dl_allocate_tib;
		_dl_free_tib;

		/* looked up by gdb */
		_dl_bind;
		_dl_debug_state;

	local:
		*;
};
@


1.3
log
@Provide _dlctl(), an alternate name for dlctl() that's in the reserved
namespace, for use by libpthread

ok deraadt@@
@
text
@d17 4
@


1.2
log
@Export environ and __progname, making the latter a copy of just the filename
portion like crt0 does.  This is prep for eliminating _dl_fixup_user_env()
Mark almost everything in resolve.h as hidden, to improve code generation.

ok kettenis@@ mpi@@  "good time" deraadt@@
@
text
@d14 3
@


1.1
log
@Apply a symbol export list to ld.so with just the expected dl*() and the
two symbols needed by gdb.  Remember: ld.so exports override those in
shared libs.

ok deraadt@@
@
text
@d11 2
@

