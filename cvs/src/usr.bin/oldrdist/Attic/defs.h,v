head	1.14;
access;
symbols
	OPENBSD_5_5:1.13.0.6
	OPENBSD_5_5_BASE:1.13
	OPENBSD_5_4:1.13.0.2
	OPENBSD_5_4_BASE:1.13
	OPENBSD_5_3:1.12.0.38
	OPENBSD_5_3_BASE:1.12
	OPENBSD_5_2:1.12.0.36
	OPENBSD_5_2_BASE:1.12
	OPENBSD_5_1_BASE:1.12
	OPENBSD_5_1:1.12.0.34
	OPENBSD_5_0:1.12.0.32
	OPENBSD_5_0_BASE:1.12
	OPENBSD_4_9:1.12.0.30
	OPENBSD_4_9_BASE:1.12
	OPENBSD_4_8:1.12.0.28
	OPENBSD_4_8_BASE:1.12
	OPENBSD_4_7:1.12.0.24
	OPENBSD_4_7_BASE:1.12
	OPENBSD_4_6:1.12.0.26
	OPENBSD_4_6_BASE:1.12
	OPENBSD_4_5:1.12.0.22
	OPENBSD_4_5_BASE:1.12
	OPENBSD_4_4:1.12.0.20
	OPENBSD_4_4_BASE:1.12
	OPENBSD_4_3:1.12.0.18
	OPENBSD_4_3_BASE:1.12
	OPENBSD_4_2:1.12.0.16
	OPENBSD_4_2_BASE:1.12
	OPENBSD_4_1:1.12.0.14
	OPENBSD_4_1_BASE:1.12
	OPENBSD_4_0:1.12.0.12
	OPENBSD_4_0_BASE:1.12
	OPENBSD_3_9:1.12.0.10
	OPENBSD_3_9_BASE:1.12
	OPENBSD_3_8:1.12.0.8
	OPENBSD_3_8_BASE:1.12
	OPENBSD_3_7:1.12.0.6
	OPENBSD_3_7_BASE:1.12
	OPENBSD_3_6:1.12.0.4
	OPENBSD_3_6_BASE:1.12
	OPENBSD_3_5:1.12.0.2
	OPENBSD_3_5_BASE:1.12
	OPENBSD_3_4:1.11.0.2
	OPENBSD_3_4_BASE:1.11
	OPENBSD_3_3:1.10.0.6
	OPENBSD_3_3_BASE:1.10
	OPENBSD_3_2:1.10.0.4
	OPENBSD_3_2_BASE:1.10
	OPENBSD_3_1:1.10.0.2
	OPENBSD_3_1_BASE:1.10
	OPENBSD_3_0:1.8.0.10
	OPENBSD_3_0_BASE:1.8
	OPENBSD_2_9_BASE:1.8
	OPENBSD_2_9:1.8.0.8
	OPENBSD_2_8:1.8.0.6
	OPENBSD_2_8_BASE:1.8
	OPENBSD_2_7:1.8.0.4
	OPENBSD_2_7_BASE:1.8
	OPENBSD_2_6:1.8.0.2
	OPENBSD_2_6_BASE:1.8
	OPENBSD_2_5:1.7.0.4
	OPENBSD_2_5_BASE:1.7
	OPENBSD_2_4:1.7.0.2
	OPENBSD_2_4_BASE:1.7
	OPENBSD_2_3:1.6.0.6
	OPENBSD_2_3_BASE:1.6
	OPENBSD_2_2:1.6.0.4
	OPENBSD_2_2_BASE:1.6
	OPENBSD_2_1:1.6.0.2
	OPENBSD_2_1_BASE:1.6
	OPENBSD_2_0:1.5.0.2
	OPENBSD_2_0_BASE:1.5;
locks; strict;
comment	@ * @;


1.14
date	2014.07.10.14.26.16;	author tedu;	state dead;
branches;
next	1.13;
commitid	Hzb21S9Xr5CMEb0F;

1.13
date	2013.06.02.06.20.35;	author guenther;	state Exp;
branches;
next	1.12;

1.12
date	2004.01.16.01.12.35;	author espie;	state Exp;
branches;
next	1.11;

1.11
date	2003.06.03.02.56.14;	author millert;	state Exp;
branches;
next	1.10;

1.10
date	2002.02.17.19.42.31;	author millert;	state Exp;
branches;
next	1.9;

1.9
date	2002.02.16.21.27.50;	author millert;	state Exp;
branches;
next	1.8;

1.8
date	99.08.17.09.13.16;	author millert;	state Exp;
branches;
next	1.7;

1.7
date	98.04.27.03.13.51;	author deraadt;	state Exp;
branches;
next	1.6;

1.6
date	97.02.09.19.24.55;	author deraadt;	state Exp;
branches;
next	1.5;

1.5
date	96.08.22.20.40.43;	author millert;	state Exp;
branches;
next	1.4;

1.4
date	96.08.22.20.33.16;	author millert;	state Exp;
branches;
next	1.3;

1.3
date	96.07.19.21.57.31;	author millert;	state Exp;
branches;
next	1.2;

1.2
date	96.06.26.05.37.37;	author deraadt;	state Exp;
branches;
next	1.1;

1.1
date	96.02.03.12.11.53;	author dm;	state Exp;
branches;
next	;


desc
@@


1.14
log
@Snakes. Why'd it have to be snakes?
@
text
@/* *	$OpenBSD: defs.h,v 1.13 2013/06/02 06:20:35 guenther Exp $*/
/*
 * Copyright (c) 1983, 1993
 *	The Regents of the University of California.  All rights reserved.
 *
 * Redistribution and use in source and binary forms, with or without
 * modification, are permitted provided that the following conditions
 * are met:
 * 1. Redistributions of source code must retain the above copyright
 *    notice, this list of conditions and the following disclaimer.
 * 2. Redistributions in binary form must reproduce the above copyright
 *    notice, this list of conditions and the following disclaimer in the
 *    documentation and/or other materials provided with the distribution.
 * 3. Neither the name of the University nor the names of its contributors
 *    may be used to endorse or promote products derived from this software
 *    without specific prior written permission.
 *
 * THIS SOFTWARE IS PROVIDED BY THE REGENTS AND CONTRIBUTORS ``AS IS'' AND
 * ANY EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT LIMITED TO, THE
 * IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE
 * ARE DISCLAIMED.  IN NO EVENT SHALL THE REGENTS OR CONTRIBUTORS BE LIABLE
 * FOR ANY DIRECT, INDIRECT, INCIDENTAL, SPECIAL, EXEMPLARY, OR CONSEQUENTIAL
 * DAMAGES (INCLUDING, BUT NOT LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS
 * OR SERVICES; LOSS OF USE, DATA, OR PROFITS; OR BUSINESS INTERRUPTION)
 * HOWEVER CAUSED AND ON ANY THEORY OF LIABILITY, WHETHER IN CONTRACT, STRICT
 * LIABILITY, OR TORT (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY
 * OUT OF THE USE OF THIS SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF
 * SUCH DAMAGE.
 *
 *	from: @@(#)defs.h	8.1 (Berkeley) 6/9/93
 */

#include <sys/param.h>
#include <sys/stat.h>
#include <sys/time.h>

#include <netinet/in.h>

#include <errno.h>
#include <dirent.h>
#include <fcntl.h>
#include <pwd.h>
#include <grp.h>
#include <stdio.h>
#include <ctype.h>
#include <unistd.h>
#include <string.h>
#include <stdlib.h>
#include "pathnames.h"

/*
 * The version number should be changed whenever the protocol changes.
 */
#define VERSION	 3

	/* defines for yacc */
#define EQUAL	1
#define LP	2
#define RP	3
#define SM	4
#define ARROW	5
#define COLON	6
#define DCOLON	7
#define NAME	8
#define STRING	9
#define INSTALL	10
#define NOTIFY	11
#define EXCEPT	12
#define PATTERN	13
#define SPECIAL	14
#define OPTION	15

	/* lexical definitions */
#define	QUOTE 	0200		/* used internally for quoted characters */
#define	TRIM	0177		/* Mask to strip quote bit */

	/* table sizes */
#define HASHSIZE	1021
#define INMAX	3500

	/* option flags */
#define VERIFY	0x1
#define WHOLE	0x2
#define YOUNGER	0x4
#define COMPARE	0x8
#define REMOVE	0x10
#define FOLLOW	0x20
#define IGNLNKS	0x40

	/* expand type definitions */
#define E_VARS	0x1
#define E_SHELL	0x2
#define E_TILDE	0x4
#define E_ALL	0x7

	/* actions for lookup() */
#define LOOKUP	0
#define INSERT	1
#define REPLACE	2

#define ISDIR(m) (((m) & S_IFMT) == S_IFDIR)

#define ALLOC(x) (struct x *) malloc(sizeof(struct x))

struct namelist {	/* for making lists of strings */
	char	*n_name;
	struct	namelist *n_next;
};

struct subcmd {
	short	sc_type;	/* type - INSTALL,NOTIFY,EXCEPT,SPECIAL */
	short	sc_options;
	char	*sc_name;
	struct	namelist *sc_args;
	struct	subcmd *sc_next;
};

struct cmd {
	int	c_type;		/* type - ARROW,DCOLON */
	char	*c_name;	/* hostname or time stamp file name */
	char	*c_label;	/* label for partial update */
	struct	namelist *c_files;
	struct	subcmd *c_cmds;
	struct	cmd *c_next;
};

struct linkbuf {
	ino_t	inum;
	dev_t	devnum;
	int	count;
	char	pathname[BUFSIZ];
	char	src[BUFSIZ];
	char	target[BUFSIZ];
	struct	linkbuf *nextp;
};

extern int debug;		/* debugging flag */
extern int nflag;		/* NOP flag, don't execute commands */
extern int qflag;		/* Quiet. don't print messages */
extern int options;		/* global options */

extern int nerrs;		/* number of errors seen */
extern int rem;			/* remote file descriptor */
extern int iamremote;		/* acting as remote server */
extern char tempfile[];		/* file name for logging changes */
extern struct linkbuf *ihead;	/* list of files with more than one link */
extern struct passwd *pw;	/* pointer to static area used by getpwent */
extern struct group *gr;	/* pointer to static area used by getgrent */
extern char host[];		/* host name of master copy */
extern char buf[BUFSIZ];	/* general purpose buffer */
extern char target[BUFSIZ];	/* target/source directory name */

int	 any(int, char *);
char	*colon(char *);
void	 cleanup(int);
void	 define(char *);
void	 docmds(char **, int, char **);
void	 error(const char *, ...);
int	 except(char *);
struct namelist *
	 expand(struct namelist *, int);
char	*exptilde(char [], char *, int);
void	 fatal(const char *, ...);
int	 inlist(struct namelist *, char *);
void	 insert(char *, struct namelist *, struct namelist *, struct subcmd *);
void	 install(char *, char *, int, int);
void	 logit(FILE *, const char *, ...);
struct namelist *
	 lookup(char *, int, struct namelist *);
void	 lostconn(int);
struct namelist *
	 makenl(char *);
struct subcmd *
	 makesubcmd(int);
void	 prnames(struct namelist *);
void	 server(void);
void	 yyerror(char *);
int	 yyparse(void);
char	*xbasename(char *);
@


1.13
log
@Switch from antique struct direct to struct dirent
@
text
@d1 1
a1 1
/* *	$OpenBSD: defs.h,v 1.12 2004/01/16 01:12:35 espie Exp $*/
@


1.12
log
@log -> logit ISO C fix.
@
text
@d1 1
a1 1
/* *	$OpenBSD: defs.h,v 1.11 2003/06/03 02:56:14 millert Exp $*/
a33 1
#include <sys/dir.h>
d40 1
@


1.11
log
@Remove the advertising clause in the UCB license which Berkeley
rescinded 22 July 1999.  Proofed by myself and Theo.
@
text
@d1 1
a1 1
/* *	$OpenBSD: defs.h,v 1.10 2002/02/17 19:42:31 millert Exp $*/
d167 1
a167 1
void	 log(FILE *, const char *, ...);
@


1.10
log
@Manual cleanup of remaining userland __P use (excluding packages maintained outside the tree)
@
text
@d1 1
a1 1
/* *	$OpenBSD: defs.h,v 1.9 2002/02/16 21:27:50 millert Exp $*/
d14 1
a14 5
 * 3. All advertising materials mentioning features or use of this software
 *    must display the following acknowledgement:
 *	This product includes software developed by the University of
 *	California, Berkeley and its contributors.
 * 4. Neither the name of the University nor the names of its contributors
@


1.9
log
@Part one of userland __P removal.  Done with a simple regexp with some minor hand editing to make comments line up correctly.  Another pass is forthcoming that handles the cases that could not be done automatically.
@
text
@d1 1
a1 1
/* *	$OpenBSD: defs.h,v 1.8 1999/08/17 09:13:16 millert Exp $*/
d169 1
a169 2
void	 insert __P((char *,
	    struct namelist *, struct namelist *, struct subcmd *));
@


1.8
log
@More <sys/file.h> vs. <fcntl.h> and open() flags fixes.
@
text
@d1 1
a1 1
/* *	$OpenBSD: defs.h,v 1.7 1998/04/27 03:13:51 deraadt Exp $*/
d157 7
a163 7
int	 any __P((int, char *));
char	*colon __P((char *));
void	 cleanup __P((int));
void	 define __P((char *));
void	 docmds __P((char **, int, char **));
void	 error __P((const char *, ...));
int	 except __P((char *));
d165 4
a168 4
	 expand __P((struct namelist *, int));
char	*exptilde __P((char [], char *, int));
void	 fatal __P((const char *, ...));
int	 inlist __P((struct namelist *, char *));
d171 2
a172 2
void	 install __P((char *, char *, int, int));
void	 log __P((FILE *, const char *, ...));
d174 2
a175 2
	 lookup __P((char *, int, struct namelist *));
void	 lostconn __P((int));
d177 1
a177 1
	 makenl __P((char *));
d179 6
a184 6
	 makesubcmd __P((int));
void	 prnames __P((struct namelist *));
void	 server __P((void));
void	 yyerror __P((char *));
int	 yyparse __P((void));
char	*xbasename __P((char *));
@


1.7
log
@Correctly operate on hardlink when source and destination are not on the
same device; freebsd
@
text
@d1 1
a1 1
/* *	$OpenBSD: defs.h,v 1.6 1997/02/09 19:24:55 deraadt Exp $*/
a40 1
#include <sys/file.h>
d45 1
@


1.6
log
@buf oflow, eivind@@freebsd
@
text
@d1 1
a1 1
/* *	$OpenBSD: defs.h,v 1.5 1996/08/22 20:40:43 millert Exp $*/
d136 1
@


1.5
log
@rcmdsh() is now prototyped in unistd.h
@
text
@d1 1
a1 1
/* *	$OpenBSD: defs.h,v 1.4 1996/08/22 20:33:16 millert Exp $*/
d154 1
d165 1
a165 1
char	*exptilde __P((char [], char *));
@


1.4
log
@NetBSD changes: use POSIX regex routines and fix more buff oflow
Can't use mkstemp() so go back to mktemp and open(2) with sane flags.
Now uses rcmdsh and fixes memory leak in NetBSD POSIX regex support
(leak fixed by Charles Amos <amos@@umiacs.umd.edu>).
@
text
@d1 1
a1 1
/* *	$OpenBSD: defs.h,v 1.3 1996/07/19 21:57:31 millert Exp $*/
a181 2
/* XXX - move to /usr/include/unistd.h... */
int	 rcmdsh __P((char **, u_short, char *, char *, char *, char *));
@


1.3
log
@oldrdist now uses rsh so doesn't need to be setuid.
Incorporates some changes from Chris Siebenmann <cks@@utcc.utoronto.ca>
and rdist 6.1.2.  Also fixes at least one possible core dump and
uses strr?chr() instead of r?index().
@
text
@d1 1
a1 1
/* *	$OpenBSD: defs.h,v 1.2 1996/06/26 05:37:37 deraadt Exp $*/
a108 5
/* so we can use rshrcmd.c from rdist 6.1.x */
#define SYSERR	strerror(errno)
#define path_remsh	_PATH_REMSH
#define getsocketpair	socketpair

d153 1
a153 1
extern char buf[];		/* general purpose buffer */
d182 2
a183 1
int	 rshrcmd __P((char **, u_short, char *, char *, char *, int *));
@


1.2
log
@rcsid
@
text
@d1 1
a1 1
/* *	$OpenBSD: defs.h,v 1.1 1996/02/03 12:11:53 dm Exp $*/
d109 5
d187 2
@


1.1
log
@rdist 6.1.1
@
text
@d1 1
a34 1
 *	$Id: defs.h,v 1.1.1.1 1995/10/18 08:45:58 deraadt Exp $
@
