head	1.13;
access;
symbols
	OPENBSD_6_2_BASE:1.13
	OPENBSD_6_1:1.13.0.38
	OPENBSD_6_1_BASE:1.13
	OPENBSD_6_0:1.13.0.34
	OPENBSD_6_0_BASE:1.13
	OPENBSD_5_9:1.13.0.30
	OPENBSD_5_9_BASE:1.13
	OPENBSD_5_8:1.13.0.32
	OPENBSD_5_8_BASE:1.13
	OPENBSD_5_7:1.13.0.24
	OPENBSD_5_7_BASE:1.13
	OPENBSD_5_6:1.13.0.28
	OPENBSD_5_6_BASE:1.13
	OPENBSD_5_5:1.13.0.26
	OPENBSD_5_5_BASE:1.13
	OPENBSD_5_4:1.13.0.22
	OPENBSD_5_4_BASE:1.13
	OPENBSD_5_3:1.13.0.20
	OPENBSD_5_3_BASE:1.13
	OPENBSD_5_2:1.13.0.18
	OPENBSD_5_2_BASE:1.13
	OPENBSD_5_1_BASE:1.13
	OPENBSD_5_1:1.13.0.16
	OPENBSD_5_0:1.13.0.14
	OPENBSD_5_0_BASE:1.13
	OPENBSD_4_9:1.13.0.12
	OPENBSD_4_9_BASE:1.13
	OPENBSD_4_8:1.13.0.10
	OPENBSD_4_8_BASE:1.13
	OPENBSD_4_7:1.13.0.6
	OPENBSD_4_7_BASE:1.13
	OPENBSD_4_6:1.13.0.8
	OPENBSD_4_6_BASE:1.13
	OPENBSD_4_5:1.13.0.4
	OPENBSD_4_5_BASE:1.13
	OPENBSD_4_4:1.13.0.2
	OPENBSD_4_4_BASE:1.13
	OPENBSD_4_3:1.12.0.2
	OPENBSD_4_3_BASE:1.12
	OPENBSD_4_2:1.8.0.2
	OPENBSD_4_2_BASE:1.8
	OPENBSD_4_1:1.6.0.26
	OPENBSD_4_1_BASE:1.6
	OPENBSD_4_0:1.6.0.24
	OPENBSD_4_0_BASE:1.6
	OPENBSD_3_9:1.6.0.22
	OPENBSD_3_9_BASE:1.6
	OPENBSD_3_8:1.6.0.20
	OPENBSD_3_8_BASE:1.6
	OPENBSD_3_7:1.6.0.18
	OPENBSD_3_7_BASE:1.6
	OPENBSD_3_6:1.6.0.16
	OPENBSD_3_6_BASE:1.6
	OPENBSD_3_5:1.6.0.14
	OPENBSD_3_5_BASE:1.6
	OPENBSD_3_4:1.6.0.12
	OPENBSD_3_4_BASE:1.6
	OPENBSD_3_3:1.6.0.10
	OPENBSD_3_3_BASE:1.6
	OPENBSD_3_2:1.6.0.8
	OPENBSD_3_2_BASE:1.6
	OPENBSD_3_1:1.6.0.6
	OPENBSD_3_1_BASE:1.6
	OPENBSD_3_0:1.6.0.4
	OPENBSD_3_0_BASE:1.6
	OPENBSD_2_9_BASE:1.6
	OPENBSD_2_9:1.6.0.2
	OPENBSD_2_8:1.5.0.4
	OPENBSD_2_8_BASE:1.5
	OPENBSD_2_7:1.5.0.2
	OPENBSD_2_7_BASE:1.5
	OPENBSD_2_6:1.3.0.4
	OPENBSD_2_6_BASE:1.3
	OPENBSD_2_5:1.3.0.2
	OPENBSD_2_5_BASE:1.3
	OPENBSD_2_4:1.2.0.2
	OPENBSD_2_4_BASE:1.2;
locks; strict;
comment	@.\" @;


1.13
date	2008.07.08.21.39.52;	author sobrado;	state Exp;
branches;
next	1.12;

1.12
date	2008.02.11.07.58.28;	author jmc;	state Exp;
branches;
next	1.11;

1.11
date	2008.02.04.22.55.52;	author mikeb;	state Exp;
branches;
next	1.10;

1.10
date	2007.10.17.05.29.10;	author jmc;	state Exp;
branches;
next	1.9;

1.9
date	2007.10.17.02.30.23;	author deraadt;	state Exp;
branches;
next	1.8;

1.8
date	2007.05.31.19.20.14;	author jmc;	state Exp;
branches;
next	1.7;

1.7
date	2007.03.15.04.25.30;	author cloder;	state Exp;
branches;
next	1.6;

1.6
date	2000.11.09.17.52.29;	author aaron;	state Exp;
branches;
next	1.5;

1.5
date	2000.03.23.21.10.17;	author aaron;	state Exp;
branches;
next	1.4;

1.4
date	2000.03.10.20.17.49;	author aaron;	state Exp;
branches;
next	1.3;

1.3
date	98.12.16.02.38.50;	author aaron;	state Exp;
branches;
next	1.2;

1.2
date	98.09.27.16.57.49;	author aaron;	state Exp;
branches;
next	1.1;

1.1
date	98.08.30.22.58.03;	author downsj;	state Exp;
branches;
next	;


desc
@@


1.13
log
@sort options in manual page; display a better usage.
@
text
@.\"	$OpenBSD: pctr.1,v 1.12 2008/02/11 07:58:28 jmc Exp $
.\"
.\" Copyright (c) 2007 Mike Belopuhov, Aleksey Lomovtsev
.\"
.\" Permission to use, copy, modify, and distribute this software for any
.\" purpose with or without fee is hereby granted, provided that the above
.\" copyright notice and this permission notice appear in all copies.
.\"
.\" THE SOFTWARE IS PROVIDED "AS IS" AND THE AUTHOR DISCLAIMS ALL WARRANTIES
.\" WITH REGARD TO THIS SOFTWARE INCLUDING ALL IMPLIED WARRANTIES OF
.\" MERCHANTABILITY AND FITNESS. IN NO EVENT SHALL THE AUTHOR BE LIABLE FOR
.\" ANY SPECIAL, DIRECT, INDIRECT, OR CONSEQUENTIAL DAMAGES OR ANY DAMAGES
.\" WHATSOEVER RESULTING FROM LOSS OF USE, DATA OR PROFITS, WHETHER IN AN
.\" ACTION OF CONTRACT, NEGLIGENCE OR OTHER TORTIOUS ACTION, ARISING OUT OF
.\" OR IN CONNECTION WITH THE USE OR PERFORMANCE OF THIS SOFTWARE.
.\"
.\"
.\" Copyright (c) 1998, Jason Downs.  All rights reserved.
.\"
.\" Redistribution and use in source and binary forms, with or without
.\" modification, are permitted provided that the following conditions
.\" are met:
.\" 1. Redistributions of source code must retain the above copyright
.\"    notice, this list of conditions and the following disclaimer.
.\" 2. Redistributions in binary form must reproduce the above copyright
.\"    notice, this list of conditions and the following disclaimer in the
.\"    documentation and/or other materials provided with the distribution.
.\"
.\" THIS SOFTWARE IS PROVIDED BY THE AUTHOR(S) ``AS IS'' AND ANY EXPRESS
.\" OR IMPLIED WARRANTIES, INCLUDING, BUT NOT LIMITED TO, THE IMPLIED
.\" WARRANTIES OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE ARE
.\" DISCLAIMED.  IN NO EVENT SHALL THE AUTHOR(S) BE LIABLE FOR ANY DIRECT,
.\" INDIRECT, INCIDENTAL, SPECIAL, EXEMPLARY, OR CONSEQUENTIAL DAMAGES
.\" (INCLUDING, BUT NOT LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR
.\" SERVICES; LOSS OF USE, DATA, OR PROFITS; OR BUSINESS INTERRUPTION) HOWEVER
.\" CAUSED AND ON ANY THEORY OF LIABILITY, WHETHER IN CONTRACT, STRICT
.\" LIABILITY, OR TORT (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY
.\" OUT OF THE USE OF THIS SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF
.\" SUCH DAMAGE.
.\"
.Dd $Mdocdate: February 11 2008 $
.Dt PCTR 1
.Os
.Sh NAME
.Nm pctr
.Nd display CPU performance counters
.Sh SYNOPSIS
.Nm pctr
.Op Fl AEeIiklMSu
.Op Fl f Ar funct
.Op Fl m Ar umask
.Op Fl s Ar ctr
.Op Fl t Ar thold
.Sh DESCRIPTION
The
.Nm
program is a sample implementation of how to access the
.Xr pctr 4
pseudo device available on many i386 and amd64 compatible machines.
.Pp
By default, the
.Nm
command displays the current values of the TSC and any vendor specific
counter registers.
.Pp
The options are as follows:
.Bl -tag -width Ds
.It Fl A
Some bus events differentiate between the originating physical processor
(a bus agent) and other agents on the bus.
Specifying this option allows counting on all bus agents.
This is supported on Intel processors only.
.It Fl E
Enables counting exclusive cache coherency state (supported on Intel
processors only).
.It Fl e
Enables Edge Detect.
It is mandatory to enable Edge Detect with certain counter functions.
.It Fl f Ar funct
Specifies a function number in hexadecimal to program the counter,
specified by the
.Fl s
option.
.It Fl I
Enables counting invalid cache coherency state (supported on Intel
processors only).
.It Fl i
Invert the result of the threshold comparison, so that both greater than
and less than comparisons can be made.
.It Fl k
Count events occurring in kernel mode.
Specification of either
.Fl k
or
.Fl u
options is mandatory.
.It Fl l
List all possible vendor specific counters available on the current processor.
.It Fl M
Enables counting modified cache coherency state (supported on Intel
processors only).
.It Fl m Ar umask
Specifies a Unit Mask value for a function, specified by the
.Fl f
option.
.It Fl S
Enables counting shared cache coherency state (supported on Intel
processors only).
.It Fl s Ar ctr
Program counter number
.Ar ctr
with the function number specified by the
.Fl f
option.
A list of all possible functions supported on the current processor
can be obtained by the
.Fl l
option output.
.It Fl t Ar thold
Specifies an increment threshold.
The counter
.Ar ctr
will be incremented if the number of events occurring during one cycle is
greater or equal to
.Ar thold .
.It Fl u
Count events occurring in user mode.
Specification of either
.Fl k
or
.Fl u
options is mandatory.
.El
.Sh EXAMPLES
The following command, executed from the command line, will set the first
performance counter to count the number of cacheable L1 data cache reads
in user and kernel modes on an Intel Core2 Duo processor:
.Bd -unfilled -offset indent
# pctr -s 0 -f 40 -uk -MESI
.Ed
.Pp
To reset the counter run the following command:
.Bd -unfilled -offset indent
# pctr -s 0 -f 0
.Ed
.Sh SEE ALSO
.Xr pctr 4
.Pp
OS and Kernel Developer's Guide for AMD NPT Family 0Fh Processors.
.Pp
Intel 64 and IA-32 Architectures Software Developer's Manual.
Volume 3B: System Programming Guide, Part 2.
Appendix A: Performance Monitoring Events.
.Sh HISTORY
The
.Nm
program appeared in
.Ox 2.0
but was subsequently rewritten in
.Ox 4.3 .
.Sh CAVEATS
It is strongly advised to look through the manual for a particular processor
before programming a counter and interpreting the results.
@


1.12
log
@bump Mdocdate for pages committed in "febuary", necessary because
of a typo in rcs.c;
@
text
@d1 1
a1 1
.\"	$OpenBSD: pctr.1,v 1.11 2008/02/04 22:55:52 mikeb Exp $
d41 1
a41 1
.Dd $Mdocdate$
d106 3
a118 3
.It Fl S
Enables counting shared cache coherency state (supported on Intel
processors only).
@


1.11
log
@Fix release number.

ok jmc
@
text
@d1 1
a1 1
.\"	$OpenBSD: pctr.1,v 1.10 2007/10/17 05:29:10 jmc Exp $
d41 1
a41 1
.Dd $Mdocdate: October 17 2007 $
@


1.10
log
@various fixes for previous;
@
text
@d1 1
a1 1
.\"	$OpenBSD: pctr.1,v 1.9 2007/10/17 02:30:23 deraadt Exp $
d160 1
a160 1
.Ox 4.2 .
@


1.9
log
@replacement for the pctr codebase that can handle amd64 processors as
well (in fact, all 4 combinations of codebase and processor) written by
Mike Belopuhov and Aleksey Lomovtsev
@
text
@d1 1
a1 1
.\"	$OpenBSD: pctr.1,v 1.8 2007/05/31 19:20:14 jmc Exp $
d41 1
a41 1
.Dd $Mdocdate: May 31 2007 $
d49 1
a49 1
.Op Fl AeEiIklMu
d52 1
a53 1
.Op Fl s Ar ctr
d69 2
a70 2
Some bus events provide specificity between the originating physical processor 
(a bus agent) versus other agents on the bus.
d73 3
a78 3
.It Fl E
Enables counting exclusive cache coherency state (supported on Intel
processors only).
d84 3
a89 3
.It Fl I
Enables counting invalid cache coherency state (supported on Intel
processors only).
d91 1
a91 1
Count events occurred in kernel mode.
d99 3
a105 3
.It Fl M
Enables counting modified cache coherency state (supported on Intel
processors only).
d109 1
a109 1
with function number specified by the
d112 2
a113 2
List of all possible functions, supported on the current processor,
could be obtained by the
d123 1
a123 1
will be incremented if number of events occurred during the one cycle is
d127 1
a127 1
Count events occurred in user mode.
d137 1
a137 1
in user and kernel modes on Intel Core2 Duo processor:
a145 1
.Pp
d162 1
a162 1
It is strongly advised to look through a manual for a particular processor
@


1.8
log
@convert to new .Dd format;
@
text
@d1 16
a16 1
.\"	$OpenBSD: pctr.1,v 1.7 2007/03/15 04:25:30 cloder Exp $
d41 1
a41 1
.Dd $Mdocdate$
d49 5
a53 1
.Op Fl l Ar 5 | 6
d59 1
a59 1
pseudo device available on many i386 compatible machines.
d68 65
a132 7
.It Fl l Ar 5 | 6
List all possible vendor specific counters.
The argument specifies which
.Dq family
to display; it defaults to the
.Dq family
designation of the current processor.
d134 12
a146 3
The
.Nm
program exits with a value of 0 on success or 1 on failure.
d149 6
d159 6
a164 5
.Ox 2.0 .
.Sh BUGS
The
.Nm
program is still oriented towards Intel brand microprocessors.
@


1.7
log
@s/oriented/orientated/
@
text
@d1 1
a1 1
.\"	$OpenBSD: pctr.1,v 1.6 2000/11/09 17:52:29 aaron Exp $
d26 1
a26 1
.Dd August 30, 1998
@


1.6
log
@Change all option list specifications to ".Bl -tag -width Ds". Most man
pages just needed their -width parameter tweaked to "Ds", which provides
a nice width of 6 constant characters. For consistency more than anything.
@
text
@d1 1
a1 1
.\"	$OpenBSD: pctr.1,v 1.5 2000/03/23 21:10:17 aaron Exp $
d71 1
a71 1
program is still orientated towards Intel brand microprocessors.
@


1.5
log
@Fix some formatting problems I missed before.
@
text
@d1 1
a1 1
.\"	$OpenBSD: pctr.1,v 1.4 2000/03/10 20:17:49 aaron Exp $
d48 1
a48 1
.Bl -tag -width indent
@


1.4
log
@Various cleanups and standardization.
@
text
@d1 1
a1 1
.\"	$OpenBSD: pctr.1,v 1.3 1998/12/16 02:38:50 aaron Exp $
d50 2
a51 1
List all possible vendor specific counters.  The argument specifies which
@


1.3
log
@more .Nm fixes
@
text
@d1 1
a1 1
.\"	$OpenBSD: pctr.1,v 1.2 1998/09/27 16:57:49 aaron Exp $
d46 2
a47 1
.Sh OPTIONS
a48 1
There is one available option:
d56 1
a56 1
.Sh RETURN VALUES
a59 4
.Sh BUGS
The
.Nm
program is still orientated towards Intel brand microprocessors.
d67 4
@


1.2
log
@usr.bin/ man page cleanups, n-s
@
text
@d1 1
a1 1
.\"	$OpenBSD: pctr.1,v 1.1 1998/08/30 22:58:03 downsj Exp $
d33 1
a33 1
.Nm
@


1.1
log
@Add a manpage.
@
text
@d1 1
a1 1
.\"	$OpenBSD$
d31 1
a31 1
.Nd display cpu performance counters
d59 1
a59 1
program exits with a value of 0 on success, and 1 on failure.
@

