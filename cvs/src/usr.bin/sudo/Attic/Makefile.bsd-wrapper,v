head	1.19;
access;
symbols
	OPENBSD_3_4:1.18.0.2
	OPENBSD_3_4_BASE:1.18
	OPENBSD_3_3:1.17.0.2
	OPENBSD_3_3_BASE:1.17
	OPENBSD_3_2:1.15.0.2
	OPENBSD_3_2_BASE:1.15
	OPENBSD_3_1:1.14.0.2
	OPENBSD_3_1_BASE:1.14
	OPENBSD_3_0:1.10.0.2
	OPENBSD_3_0_BASE:1.10
	OPENBSD_2_9_BASE:1.9
	OPENBSD_2_9:1.9.0.4
	OPENBSD_2_8:1.9.0.2
	OPENBSD_2_8_BASE:1.9
	OPENBSD_2_7:1.7.0.2
	OPENBSD_2_7_BASE:1.7
	SUDO_1_6_0:1.1.1.1
	COURTESAN:1.1.1;
locks; strict;
comment	@# @;


1.19
date	2004.01.15.21.32.03;	author millert;	state dead;
branches;
next	1.18;

1.18
date	2003.04.11.22.37.25;	author millert;	state Exp;
branches;
next	1.17;

1.17
date	2003.03.16.02.15.32;	author millert;	state Exp;
branches;
next	1.16;

1.16
date	2003.03.15.19.26.28;	author millert;	state Exp;
branches;
next	1.15;

1.15
date	2002.04.26.16.04.24;	author millert;	state Exp;
branches;
next	1.14;

1.14
date	2002.01.16.18.09.13;	author millert;	state Exp;
branches;
next	1.13;

1.13
date	2002.01.14.00.11.44;	author millert;	state Exp;
branches;
next	1.12;

1.12
date	2002.01.03.15.25.04;	author millert;	state Exp;
branches;
next	1.11;

1.11
date	2002.01.03.03.49.16;	author millert;	state Exp;
branches;
next	1.10;

1.10
date	2001.05.29.21.40.49;	author millert;	state Exp;
branches
	1.10.2.1;
next	1.9;

1.9
date	2000.09.03.18.41.19;	author espie;	state Exp;
branches
	1.9.4.1;
next	1.8;

1.8
date	2000.08.20.18.42.41;	author millert;	state Exp;
branches;
next	1.7;

1.7
date	2000.04.05.14.14.34;	author millert;	state Exp;
branches;
next	1.6;

1.6
date	2000.02.02.04.04.57;	author d;	state Exp;
branches;
next	1.5;

1.5
date	2000.01.31.21.11.12;	author d;	state Exp;
branches;
next	1.4;

1.4
date	99.11.19.05.07.03;	author millert;	state Exp;
branches;
next	1.3;

1.3
date	99.11.18.19.09.13;	author millert;	state Exp;
branches;
next	1.2;

1.2
date	99.11.18.17.09.31;	author millert;	state Exp;
branches;
next	1.1;

1.1
date	99.11.18.16.29.01;	author millert;	state Exp;
branches
	1.1.1.1;
next	;

1.1.1.1
date	99.11.18.16.29.01;	author millert;	state Exp;
branches;
next	;

1.9.4.1
date	2002.01.18.17.20.22;	author millert;	state Exp;
branches;
next	;

1.10.2.1
date	2002.01.18.16.14.44;	author millert;	state Exp;
branches;
next	;


desc
@@


1.19
log
@sudo on OpenBSD no longer runs configure.  You will have to manually
run "rm -f /usr/obj/usr.bin/sudo/*" or "make obj" will fail during
your first build.
@
text
@#	$OpenBSD: Makefile.bsd-wrapper,v 1.18 2003/04/11 22:37:25 millert Exp $

MAN=	sudo.8 sudoers.5 visudo.8
BINOWN=	root
XCFLAGS=	CC="${CC}" CFLAGS="${CFLAGS} ${COPTS}" \
		LDFLAGS="${LDFLAGS} ${LDSTATIC}"
CONFIGURE_OPTS=	--prefix=/usr --with-devel --with-insults --with-bsdauth \
		--with-env-editor --disable-path-info --with-logfac=authpriv

.include <bsd.own.mk>

all:	config.status
	${MAKE}

.FORCE: .IGNORE

.ifdef GLOBAL_AUTOCONF_CACHE
CF=	--cache-file=${GLOBAL_AUTOCONF_CACHE}
.else
CF=
.endif

config: .FORCE
.ifndef GLOBAL_AUTOCONF_CACHE
	-rm -f config.cache
.endif
	PATH="/bin:/usr/bin:/sbin:/usr/sbin" \
	CONFIG_FILES="Makefile config.h pathnames.h" \
	${XCFLAGS} sh ${.CURDIR}/configure ${CONFIGURE_OPTS} ${CF}

config.status: configure
	PATH="/bin:/usr/bin:/sbin:/usr/sbin" \
	CONFIG_FILES="Makefile config.h pathnames.h" \
	${XCFLAGS} sh ${.CURDIR}/configure ${CONFIGURE_OPTS} ${CF}

.ifdef NOMAN
maninstall:
	@@echo NOMAN is set
.endif

install: maninstall
	${INSTALL} ${INSTALL_COPY} ${INSTALL_STRIP} -o ${BINOWN} -g \
	    ${BINGRP} -m 4555 sudo ${DESTDIR}/usr/bin/sudo
	${INSTALL} ${INSTALL_COPY} ${INSTALL_STRIP} -o ${BINOWN} -g \
	    ${BINGRP} -m ${BINMODE} visudo ${DESTDIR}/usr/sbin/visudo

clean cleandir:
	@@test ! -e Makefile || ${MAKE} distclean
	rm -f def_data.c def_data.h

depend:
	# Nothing here so far...

lint:
	# Nothing here so far...

tags:
	# Nothing here so far...

.include <bsd.obj.mk>
.include <bsd.subdir.mk>
.ifndef NOMAN
.include <bsd.man.mk>
.endif
@


1.18
log
@support LDSTATIC
@
text
@d1 1
a1 1
#	$OpenBSD: Makefile.bsd-wrapper,v 1.17 2003/03/16 02:15:32 millert Exp $
@


1.17
log
@Don't need to link in kerberos or skey libs anymore; we use BSD auth
@
text
@d1 1
a1 1
#	$OpenBSD: Makefile.bsd-wrapper,v 1.16 2003/03/15 19:26:28 millert Exp $
d5 2
a6 1
XCFLAGS=	CC="${CC}" CFLAGS="${CFLAGS} ${COPTS}" LDFLAGS="${LDFLAGS}"
@


1.16
log
@re-run configure if it changes
@
text
@d1 1
a1 1
#	$OpenBSD: Makefile.bsd-wrapper,v 1.15 2002/04/26 16:04:24 millert Exp $
a9 12

.if (${SKEY:L} == "yes")
CONFIGURE_OPTS+=--with-skey
LDADD+= -lskey
DPADD+= ${LIBSKEY}
.endif

.if (${KERBEROS:L} == "yes")
CONFIGURE_OPTS+=--with-kerb4
LDADD+= -lkrb -ldes -lkafs
DPADD+= ${LIBKRB} ${LIBDES} ${LIBKAFS}
.endif
@


1.15
log
@Strip sudo and visudo on install.  Noticed by Camiel Dobbelaar.
@
text
@d1 1
a1 1
#	$OpenBSD: Makefile.bsd-wrapper,v 1.14 2002/01/16 18:09:13 millert Exp $
d42 1
a42 1
config.status:
@


1.14
log
@update to sudo 1.6.4p2
@
text
@d1 1
a1 1
#	$OpenBSD: Makefile.bsd-wrapper,v 1.13 2002/01/14 00:11:44 millert Exp $
d53 4
a56 4
	${INSTALL} ${INSTALL_COPY} -o ${BINOWN} -g ${BINGRP} -m 4555 \
	    sudo ${DESTDIR}/usr/bin/sudo
	${INSTALL} ${INSTALL_COPY} -o ${BINOWN} -g ${BINGRP} -m ${BINMODE} \
	    visudo ${DESTDIR}/usr/sbin/visudo
@


1.13
log
@sync with sudo 1.6.4-final
@
text
@d1 1
a1 1
#	$OpenBSD: Makefile.bsd-wrapper,v 1.12 2002/01/03 15:25:04 millert Exp $
d6 2
a7 3
CONFIGURE_OPTS=	--prefix=/usr --with-devel --with-execv --with-insults \
		--with-bsdauth --with-env-editor --disable-path-info \
		--with-logfac=authpriv
@


1.12
log
@clean def_data.c and def_data.h too
@
text
@d1 1
a1 1
#	$OpenBSD: Makefile.bsd-wrapper,v 1.11 2002/01/03 03:49:16 millert Exp $
d6 3
a8 2
CONFIGURE_OPTS=	--prefix=/usr --with-devel --with-insults --with-bsdauth \
		--with-env-editor --disable-path-info --with-logfac=authpriv
@


1.11
log
@Update to sudo 1.6.4
@
text
@d1 1
a1 1
#	$OpenBSD: Makefile.bsd-wrapper,v 1.10 2001/05/29 21:40:49 millert Exp $
d59 2
a60 1
	 @@test ! -e Makefile || ${MAKE} distclean
@


1.10
log
@build with BSD auth support
@
text
@d1 1
a1 1
#	$OpenBSD: Makefile.bsd-wrapper,v 1.9 2000/09/03 18:41:19 espie Exp $
d4 1
d40 1
a40 3
	${XCFLAGS} \
	INSTALL_PROGRAM="${INSTALL} ${INSTALL_COPY} ${INSTALL_STRIP}" \
	sh ${.CURDIR}/configure ${CONFIGURE_OPTS} ${CF}
d45 1
a45 3
	${XCFLAGS} \
	INSTALL_PROGRAM="${INSTALL} ${INSTALL_COPY} ${INSTALL_STRIP}" \
	sh ${.CURDIR}/configure ${CONFIGURE_OPTS} ${CF}
d53 4
a56 3
	${MAKE} ${XCFLAGS} prefix=${DESTDIR}/usr sysconfdir=${DESTDIR}/etc \
		bindir=${DESTDIR}/usr/bin INSTALL="${INSTALL} ${INSTALL_COPY}" \
		install-binaries
@


1.10.2.1
log
@update to sudo 1.6.5p1
@
text
@d1 1
a1 1
#	$OpenBSD: Makefile.bsd-wrapper,v 1.14 2002/01/16 18:09:13 millert Exp $
a3 1
BINOWN=	root
d39 3
a41 1
	${XCFLAGS} sh ${.CURDIR}/configure ${CONFIGURE_OPTS} ${CF}
d46 3
a48 1
	${XCFLAGS} sh ${.CURDIR}/configure ${CONFIGURE_OPTS} ${CF}
d56 3
a58 4
	${INSTALL} ${INSTALL_COPY} -o ${BINOWN} -g ${BINGRP} -m 4555 \
	    sudo ${DESTDIR}/usr/bin/sudo
	${INSTALL} ${INSTALL_COPY} -o ${BINOWN} -g ${BINGRP} -m ${BINMODE} \
	    visudo ${DESTDIR}/usr/sbin/visudo
d61 1
a61 2
	@@test ! -e Makefile || ${MAKE} distclean
	rm -f def_data.c def_data.h
@


1.9
log
@Boring...  Add :L modifier to all tweakable variables tests.

Closes PR 1246
@
text
@d1 1
a1 1
#	$OpenBSD: Makefile.bsd-wrapper,v 1.8 2000/08/20 18:42:41 millert Exp $
d5 1
a5 1
CONFIGURE_OPTS=	--prefix=/usr --with-devel --with-insults --with-logincap \
@


1.9.4.1
log
@update to sudo 1.6.5p1
@
text
@d1 1
a1 1
#	$OpenBSD: Makefile.bsd-wrapper,v 1.14 2002/01/16 18:09:13 millert Exp $
a3 1
BINOWN=	root
d39 3
a41 1
	${XCFLAGS} sh ${.CURDIR}/configure ${CONFIGURE_OPTS} ${CF}
d46 3
a48 1
	${XCFLAGS} sh ${.CURDIR}/configure ${CONFIGURE_OPTS} ${CF}
d56 3
a58 4
	${INSTALL} ${INSTALL_COPY} -o ${BINOWN} -g ${BINGRP} -m 4555 \
	    sudo ${DESTDIR}/usr/bin/sudo
	${INSTALL} ${INSTALL_COPY} -o ${BINOWN} -g ${BINGRP} -m ${BINMODE} \
	    visudo ${DESTDIR}/usr/sbin/visudo
d61 1
a61 2
	@@test ! -e Makefile || ${MAKE} distclean
	rm -f def_data.c def_data.h
@


1.8
log
@Add calls to setusercontext() and login_get*().  We basically call
setusercontext() in most places where previously we did a setlogin().
Add default login.conf file and put root in the "daemon" login class.
@
text
@d1 1
a1 1
#	$OpenBSD: Makefile.bsd-wrapper,v 1.7 2000/04/05 14:14:34 millert Exp $
d10 1
a10 1
.if (${SKEY} == "yes")
d16 1
a16 1
.if (${KERBEROS} == "yes")
@


1.7
log
@Keep configure from complaining about missing *.man.in
@
text
@d1 1
a1 1
#	$OpenBSD: Makefile.bsd-wrapper,v 1.6 2000/02/02 04:04:57 d Exp $
d5 1
a5 1
CONFIGURE_OPTS=	--prefix=/usr --with-devel --with-insults \
@


1.6
log
@eight spaces does not make a tab
@
text
@d1 1
a1 1
#	$OpenBSD: Makefile.bsd-wrapper,v 1.5 2000/01/31 21:11:12 d Exp $
d38 1
d45 1
@


1.5
log
@remove unnecessary, ignored error. ok millert@@
@
text
@d1 1
a1 1
#	$OpenBSD: Makefile.bsd-wrapper,v 1.4 1999/11/19 05:07:03 millert Exp $
d50 1
a50 1
        @@echo NOMAN is set
@


1.4
log
@Add --disable-path-info to configure flags to match options used
in sudo 1.5.9.
@
text
@d1 1
a1 1
#	$OpenBSD: Makefile.bsd-wrapper,v 1.3 1999/11/18 19:09:13 millert Exp $
d59 1
a59 1
	 -@@test -e Makefile && ${MAKE} distclean
@


1.3
log
@Use ${INSTALL} and ${INSTALL_COPY}
@
text
@d1 1
a1 1
#	$OpenBSD: Makefile.bsd-wrapper,v 1.2 1999/11/18 17:09:31 millert Exp $
d6 1
a6 1
		--with-env-editor --with-logfac=authpriv
@


1.2
log
@Don't install empty /etc/sudoers here.  If we want to do so it should go in src/etc.
@
text
@d1 1
a1 1
#	$OpenBSD: Makefile.bsd-wrapper,v 1.1.1.1 1999/11/18 16:29:01 millert Exp $
d55 2
a56 1
		bindir=${DESTDIR}/usr/bin install-binaries
@


1.1
log
@Initial revision
@
text
@d1 1
a1 1
#	$OpenBSD$
d55 1
a55 1
		bindir=${DESTDIR}/usr/bin install-binaries install-sudoers
@


1.1.1.1
log
@sudo 1.6, now with a BSD license
@
text
@@
