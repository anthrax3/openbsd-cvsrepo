head	1.12;
access;
symbols
	OPENBSD_5_7:1.11.0.18
	OPENBSD_5_7_BASE:1.11
	OPENBSD_5_6:1.11.0.22
	OPENBSD_5_6_BASE:1.11
	OPENBSD_5_5:1.11.0.20
	OPENBSD_5_5_BASE:1.11
	OPENBSD_5_4:1.11.0.16
	OPENBSD_5_4_BASE:1.11
	OPENBSD_5_3:1.11.0.14
	OPENBSD_5_3_BASE:1.11
	OPENBSD_5_2:1.11.0.12
	OPENBSD_5_2_BASE:1.11
	OPENBSD_5_1_BASE:1.11
	OPENBSD_5_1:1.11.0.10
	OPENBSD_5_0:1.11.0.8
	OPENBSD_5_0_BASE:1.11
	OPENBSD_4_9:1.11.0.6
	OPENBSD_4_9_BASE:1.11
	OPENBSD_4_8:1.11.0.4
	OPENBSD_4_8_BASE:1.11
	OPENBSD_4_7:1.11.0.2
	OPENBSD_4_7_BASE:1.11
	OPENBSD_4_6:1.10.0.6
	OPENBSD_4_6_BASE:1.10
	OPENBSD_4_5:1.10.0.2
	OPENBSD_4_5_BASE:1.10
	OPENBSD_4_4:1.9.0.2
	OPENBSD_4_4_BASE:1.9
	OPENBSD_4_3:1.8.0.4
	OPENBSD_4_3_BASE:1.8
	OPENBSD_4_2:1.8.0.2
	OPENBSD_4_2_BASE:1.8
	OPENBSD_4_1:1.7.0.10
	OPENBSD_4_1_BASE:1.7
	OPENBSD_4_0:1.7.0.8
	OPENBSD_4_0_BASE:1.7
	OPENBSD_3_9:1.7.0.6
	OPENBSD_3_9_BASE:1.7
	OPENBSD_3_8:1.7.0.4
	OPENBSD_3_8_BASE:1.7
	OPENBSD_3_7:1.7.0.2
	OPENBSD_3_7_BASE:1.7
	OPENBSD_3_6:1.6.0.8
	OPENBSD_3_6_BASE:1.6
	OPENBSD_3_5:1.6.0.6
	OPENBSD_3_5_BASE:1.6
	OPENBSD_3_4:1.6.0.4
	OPENBSD_3_4_BASE:1.6
	OPENBSD_3_3:1.6.0.2
	OPENBSD_3_3_BASE:1.6
	OPENBSD_3_2:1.5.0.4
	OPENBSD_3_2_BASE:1.5
	OPENBSD_3_1:1.5.0.2
	OPENBSD_3_1_BASE:1.5
	OPENBSD_3_0:1.3.0.6
	OPENBSD_3_0_BASE:1.3
	OPENBSD_2_9_BASE:1.3
	OPENBSD_2_9:1.3.0.4
	OPENBSD_2_8:1.3.0.2
	OPENBSD_2_8_BASE:1.3
	OPENBSD_2_7:1.2.0.2
	OPENBSD_2_7_BASE:1.2
	SUDO_1_6_0:1.1.1.1
	COURTESAN:1.1.1;
locks; strict;
comment	@# @;


1.12
date	2015.07.03.21.51.54;	author millert;	state dead;
branches;
next	1.11;
commitid	8ra5qnWqy2bUhcZn;

1.11
date	2010.03.04.12.21.36;	author millert;	state Exp;
branches;
next	1.10;

1.10
date	2008.11.14.11.58.08;	author millert;	state Exp;
branches;
next	1.9;

1.9
date	2008.07.31.16.44.03;	author millert;	state Exp;
branches;
next	1.8;

1.8
date	2007.07.26.16.10.16;	author millert;	state Exp;
branches;
next	1.7;

1.7
date	2004.09.28.15.10.51;	author millert;	state Exp;
branches;
next	1.6;

1.6
date	2003.03.15.21.23.54;	author millert;	state Exp;
branches;
next	1.5;

1.5
date	2002.01.14.00.11.44;	author millert;	state Exp;
branches;
next	1.4;

1.4
date	2002.01.03.03.49.16;	author millert;	state Exp;
branches;
next	1.3;

1.3
date	2000.06.09.16.25.59;	author millert;	state Exp;
branches
	1.3.4.1
	1.3.6.1;
next	1.2;

1.2
date	2000.01.24.04.22.53;	author millert;	state Exp;
branches;
next	1.1;

1.1
date	99.11.18.16.29.01;	author millert;	state Exp;
branches
	1.1.1.1;
next	;

1.1.1.1
date	99.11.18.16.29.01;	author millert;	state Exp;
branches;
next	;

1.3.4.1
date	2002.01.18.17.20.23;	author millert;	state Exp;
branches;
next	;

1.3.6.1
date	2002.01.18.16.14.46;	author millert;	state Exp;
branches;
next	;


desc
@@


1.12
log
@Remove sudo, it is now in ports.
@
text
@#! /bin/sh

## (From INN-1.4, written by Rich Salz)
##  $Revision: 1.11 $
##  A script to install files and directories.

PROGNAME=`basename $0`

##  Paths to programs.  CHOWN, STRIP and WHOAMI are checked below.
CHOWN=chown
CHGRP=chgrp
CHMOD=chmod
CP=cp
LN=ln
MKDIR=mkdir
MV=mv
RM=rm
STRIP=strip
WHOAMI="echo root"

##  Some systems don't support -x, so we have to use -f.
for d in /sbin /etc /usr/sbin /usr/etc; do
    if [ -f $d/chown ]; then
	CHOWN=${d}/chown
	break
    fi
done

for d in /usr/bin /bin /usr/ucb /usr/bsd; do
    if [ -f $d/whoami ]; then
	WHOAMI=${d}/whoami
	break
    elif [ -f $d/id ]; then
	WHOAMI=${d}/id | sed -n 's/^[^(]*(\([^)]*\)).*/\1/p'
    fi
done

for d in /usr/ccs/bin /usr/bin /bin; do
    if [ -f $d/strip ]; then
	STRIP=${d}/strip
	break
    fi
done

##  Defaults.
CHOWNIT=false
CHGROUPIT=false
CHMODIT=false
STRIPIT=false
BACKIT=false
TOUCHIT=true
SAVESRC=false

case `${WHOAMI}` in
root)
    ROOT=true
    ;;
*)
    ROOT=false
    ;;
esac

##  Process JCL.
MORETODO=true
while ${MORETODO} ; do
    case X"$1" in
    X-b)
	BACKIT=true
	BACKUP="$2"
	shift
	;;
    X-b*)
	BACKIT=true
	BACKUP=`expr "$1" : '-b\(.*\)'`
	;;
    X-c)
	SAVESRC=true
	;;
    X-g)
	GROUP="$2"
	CHGROUPIT=true
	shift
	;;
    X-g*)
	GROUP=`expr "$1" : '-g\(.*\)'`
	CHGROUPIT=true
	;;
    X-G)
	GROUP="$2"
	shift
	${ROOT} && CHGROUPIT=true
	;;
    X-G*)
	if ${ROOT} ; then
	    GROUP=`expr "$1" : '-g\(.*\)'`
	    CHGROUPIT=true
	fi
	;;
    X-m)
	MODE="$2"
	CHMODIT=true
	shift
	;;
    X-m*)
	MODE=`expr "$1" : '-m\(.*\)'`
	CHMODIT=true
	;;
    X-M)
	MODE="$2"
	${ROOT} && CHMODIT=true
	shift
	;;
    X-M*)
	MODE=`expr "$1" : '-m\(.*\)'`
	${ROOT} && CHMODIT=true
	;;
    X-n)
	TOUCHIT=false
	;;
    X-o)
	OWNER="$2"
	CHOWNIT=true
	shift
	;;
    X-o*)
	OWNER=`expr "$1" : '-o\(.*\)'`
	CHOWNIT=true
	;;
    X-O)
	OWNER="$2"
	shift
	${ROOT} && CHOWNIT=true
	;;
    X-O*)
	if ${ROOT} ; then
	    OWNER=`expr "$1" : '-o\(.*\)'`
	    CHOWNIT=true
	fi
	;;
    X-s)
	STRIPIT=true
	;;
    X--)
	shift
	MORETODO=false
	;;
    X-*)
	echo "${PROGNAME}:  Unknown flag $1" 1>&2
	exit 1
	;;
    *)
	MORETODO=false
	;;
    esac
    ${MORETODO} && shift
done

##  Process arguments.
if [ $# -ne 2 ] ; then
    echo "Usage:  ${PROGNAME} [flags] source destination"
    exit 1
fi

##  Making a directory?
if [ X"$1" = X. ] ; then
    DEST="$2"
    if [ ! -d "${DEST}" ] ; then
	${MKDIR} "${DEST}" || exit 1
    fi
    if ${CHOWNIT} ; then
	${CHOWN} "${OWNER}" "${DEST}" || exit 1
    fi
    if ${CHGROUPIT} ; then
	${CHGRP} "${GROUP}" "${DEST}" || exit 1
    fi
    if ${CHMODIT} ; then
	umask 0
	${CHMOD} "${MODE}"  "${DEST}" || exit 1
    fi
    exit 0
fi

##  Get the destination and a temp file in the destination diretory.
if [ -d "$2" ] ; then
    DEST="$2/`basename $1`"
    TEMP="$2/$$.tmp"
else
    DEST="$2"
    TEMP="`expr "$2" : '\(.*\)/.*'`/$$.tmp"
fi

##  If not given the same name, we must try to copy.
if [ X"$1" != X"$2" -o $SAVESRC ] ; then
    if cmp -s "$1" "${DEST}" ; then
	##  Files are same; touch or not.
	${TOUCHIT} && touch "${DEST}"
    else
	##  If destination exists and we wish to backup, link to backup.
	if [ -f "${DEST}" ] ; then
	    if ${BACKIT} ; then
		${RM} -f "${DEST}${BACKUP}"
		${LN} "${DEST}" "${DEST}${BACKUP}"
	    fi
	fi
	##  Copy source to the right dir, then move to right spot.
	##  Done in two parts so we can hope for atomicity.
	${RM} -f "${TEMP}" || exit 1
	${CP} "$1" "${TEMP}" || exit 1
	${MV} -f "${TEMP}" "${DEST}" || exit 1
    fi
fi

##  Strip and set the modes.
if ${STRIPIT} ; then
    ${STRIP} "${DEST}" || exit 1
fi
if ${CHOWNIT} ; then
    ${CHOWN} "${OWNER}" "${DEST}" || exit 1
fi
if ${CHGROUPIT} ; then
    ${CHGRP} "${GROUP}" "${DEST}" || exit 1
fi
if ${CHMODIT} ; then
    umask 0
    ${CHMOD} "${MODE}"  "${DEST}" || exit 1
fi
exit 0
@


1.11
log
@Remove old $Sudo$ tags; the main sudo tree no longer lives in cvs.
@
text
@d4 1
a4 1
##  $Revision$
@


1.10
log
@Upgrade to sudo 1.7.  See the WHATSNEW files for details.
@
text
@d4 1
a4 1
##  $Revision: 1.10 $
@


1.9
log
@Update to sudo 1.6.9p17
@
text
@d4 1
a4 1
##  $Revision: 1.9.4.1 $
@


1.8
log
@Update to sudo 1.6.9p1.  Note that the environment handling in sudo
1.6.9 has changed relative to older versions.  Sudo now starts
commands with a minimal environment containing the variables in the
env_keep and env_check lists.  This behavior is configurable in the
sudoers file.  Please see the "SECURITY NOTES" section in the sudo
manual.
@
text
@d4 1
a4 1
##  $Revision: 1.9 $
d185 1
a185 1
    DEST="$2/$1"
@


1.7
log
@Update to sudo 1.6.8p1
@
text
@@


1.6
log
@update to what will soon be sudo 1.6.7
@
text
@@


1.5
log
@sync with sudo 1.6.4-final
@
text
@@


1.4
log
@Update to sudo 1.6.4
@
text
@d4 1
a4 1
##  $Revision: 1.7 $
d19 1
a19 1
WHOAMI=whoami
d29 1
a29 1
for d in /usr/bin /usr/ucb /usr/bsd; do
d33 2
a36 3
if [ X"$WHOAMI" = X"" ]; then
    WHOAMI=id | sed -n 's/^[^(]*(\([^)]*\)).*/\1/p'
fi
d38 1
a38 1
for d in /usr/ccs/bin /usr/bin; do
@


1.3
log
@When looking for chown, check in /sbin too.
@
text
@d4 1
a4 1
##  $Revision: 1.4 $
d22 4
a25 9
if [ ${CHOWN} = chown ] ; then
    if [ -f /sbin/chown ] ; then
	CHOWN=/sbin/chown
    elif [ -f /etc/chown ] ; then
	CHOWN=/etc/chown
    elif [ -f /usr/sbin/chown ] ; then
	CHOWN=/usr/sbin/chown
    elif [ -f /usr/etc/chown ] ; then
	CHOWN=/usr/etc/chown
d27 1
a27 1
fi
d29 4
a32 5
if [ ${WHOAMI} = whoami ] ; then
    if [ -f /usr/ucb/whoami ] ; then
	WHOAMI=/usr/ucb/whoami
    elif [ -f /usr/bin/whoami ] ; then
	WHOAMI=/usr/bin/whoami
d34 3
d39 4
a42 5
if [ ${STRIP} = strip ] ; then
    if [ -f /usr/ccs/bin/strip ] ; then
	STRIP=/usr/ccs/bin/strip
    elif [ -f /usr/bin/strip ] ; then
	STRIP=/usr/bin/strip
d44 1
a44 1
fi
d54 9
a62 1
ROOT=unknown
a89 12
	case ${ROOT} in
	unknown)
	    case `${WHOAMI}` in
	    root)
		ROOT=true
		;;
	    *)
		ROOT=false
		;;
	    esac
	    ;;
	esac
a94 12
	case ${ROOT} in
	unknown)
	    case `${WHOAMI}` in
	    root)
		ROOT=true
		;;
	    *)
		ROOT=false
		;;
	    esac
	    ;;
	esac
d109 9
a130 12
	case ${ROOT} in
	unknown)
	    case `${WHOAMI}` in
	    root)
		ROOT=true
		;;
	    *)
		ROOT=false
		;;
	    esac
	    ;;
	esac
a135 12
	case ${ROOT} in
	unknown)
	    case `${WHOAMI}` in
	    root)
		ROOT=true
		;;
	    *)
		ROOT=false
		;;
	    esac
	    ;;
	esac
@


1.3.4.1
log
@update to sudo 1.6.5p1
@
text
@d4 1
a4 1
##  $Revision: 1.5 $
d19 1
a19 1
WHOAMI="echo root"
d22 9
a30 4
for d in /sbin /etc /usr/sbin /usr/etc; do
    if [ -f $d/chown ]; then
	CHOWN=${d}/chown
	break
d32 1
a32 1
done
d34 5
a38 6
for d in /usr/bin /bin /usr/ucb /usr/bsd; do
    if [ -f $d/whoami ]; then
	WHOAMI=${d}/whoami
	break
    elif [ -f $d/id ]; then
	WHOAMI=${d}/id | sed -n 's/^[^(]*(\([^)]*\)).*/\1/p'
d40 1
a40 1
done
d42 5
a46 4
for d in /usr/ccs/bin /usr/bin /bin; do
    if [ -f $d/strip ]; then
	STRIP=${d}/strip
	break
d48 1
a48 1
done
d58 1
a58 9

case `${WHOAMI}` in
root)
    ROOT=true
    ;;
*)
    ROOT=false
    ;;
esac
d86 12
d103 12
a128 9
    X-M)
	MODE="$2"
	${ROOT} && CHMODIT=true
	shift
	;;
    X-M*)
	MODE=`expr "$1" : '-m\(.*\)'`
	${ROOT} && CHMODIT=true
	;;
d142 12
d159 12
@


1.3.6.1
log
@update to sudo 1.6.5p1
@
text
@d4 1
a4 1
##  $Revision: 1.5 $
d19 1
a19 1
WHOAMI="echo root"
d22 9
a30 4
for d in /sbin /etc /usr/sbin /usr/etc; do
    if [ -f $d/chown ]; then
	CHOWN=${d}/chown
	break
d32 1
a32 1
done
d34 5
a38 6
for d in /usr/bin /bin /usr/ucb /usr/bsd; do
    if [ -f $d/whoami ]; then
	WHOAMI=${d}/whoami
	break
    elif [ -f $d/id ]; then
	WHOAMI=${d}/id | sed -n 's/^[^(]*(\([^)]*\)).*/\1/p'
d40 1
a40 1
done
d42 5
a46 4
for d in /usr/ccs/bin /usr/bin /bin; do
    if [ -f $d/strip ]; then
	STRIP=${d}/strip
	break
d48 1
a48 1
done
d58 1
a58 9

case `${WHOAMI}` in
root)
    ROOT=true
    ;;
*)
    ROOT=false
    ;;
esac
d86 12
d103 12
a128 9
    X-M)
	MODE="$2"
	${ROOT} && CHMODIT=true
	shift
	;;
    X-M*)
	MODE=`expr "$1" : '-m\(.*\)'`
	${ROOT} && CHMODIT=true
	;;
d142 12
d159 12
@


1.2
log
@sudo 1.6.2
@
text
@d23 3
a25 1
    if [ -f /etc/chown ] ; then
d27 2
a30 2
    elif [ -f /usr/sbin/chown ] ; then
	CHOWN=/usr/sbin/chown
@


1.1
log
@Initial revision
@
text
@@


1.1.1.1
log
@sudo 1.6, now with a BSD license
@
text
@@
