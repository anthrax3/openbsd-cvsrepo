head	1.21;
access;
symbols
	OPENBSD_6_1_BASE:1.21
	OPENBSD_6_0:1.21.0.6
	OPENBSD_6_0_BASE:1.21
	OPENBSD_5_9:1.21.0.2
	OPENBSD_5_9_BASE:1.21
	OPENBSD_5_8:1.21.0.4
	OPENBSD_5_8_BASE:1.21
	OPENBSD_5_7:1.20.0.2
	OPENBSD_5_7_BASE:1.20
	OPENBSD_5_6:1.20.0.4
	OPENBSD_5_6_BASE:1.20
	OPENBSD_5_5:1.19.0.4
	OPENBSD_5_5_BASE:1.19
	OPENBSD_5_4:1.18.0.4
	OPENBSD_5_4_BASE:1.18
	OPENBSD_5_3:1.18.0.2
	OPENBSD_5_3_BASE:1.18
	OPENBSD_5_2:1.17.0.6
	OPENBSD_5_2_BASE:1.17
	OPENBSD_5_1_BASE:1.17
	OPENBSD_5_1:1.17.0.4
	OPENBSD_5_0:1.17.0.2
	OPENBSD_5_0_BASE:1.17
	OPENBSD_4_9:1.15.0.4
	OPENBSD_4_9_BASE:1.15
	OPENBSD_4_8:1.15.0.2
	OPENBSD_4_8_BASE:1.15
	OPENBSD_4_7:1.14.0.2
	OPENBSD_4_7_BASE:1.14
	OPENBSD_4_6:1.13.0.4
	OPENBSD_4_6_BASE:1.13
	OPENBSD_4_5:1.12.0.2
	OPENBSD_4_5_BASE:1.12
	OPENBSD_4_4:1.9.0.2
	OPENBSD_4_4_BASE:1.9
	OPENBSD_4_3:1.8.0.20
	OPENBSD_4_3_BASE:1.8
	OPENBSD_4_2:1.8.0.18
	OPENBSD_4_2_BASE:1.8
	OPENBSD_4_1:1.8.0.16
	OPENBSD_4_1_BASE:1.8
	OPENBSD_4_0:1.8.0.14
	OPENBSD_4_0_BASE:1.8
	OPENBSD_3_9:1.8.0.12
	OPENBSD_3_9_BASE:1.8
	OPENBSD_3_8:1.8.0.10
	OPENBSD_3_8_BASE:1.8
	OPENBSD_3_7:1.8.0.8
	OPENBSD_3_7_BASE:1.8
	OPENBSD_3_6:1.8.0.6
	OPENBSD_3_6_BASE:1.8
	OPENBSD_3_5:1.8.0.4
	OPENBSD_3_5_BASE:1.8
	OPENBSD_3_4:1.8.0.2
	OPENBSD_3_4_BASE:1.8
	OPENBSD_3_3:1.7.0.6
	OPENBSD_3_3_BASE:1.7
	OPENBSD_3_2:1.7.0.4
	OPENBSD_3_2_BASE:1.7
	OPENBSD_3_1:1.7.0.2
	OPENBSD_3_1_BASE:1.7
	OPENBSD_3_0:1.3.0.18
	OPENBSD_3_0_BASE:1.3
	OPENBSD_2_9_BASE:1.3
	OPENBSD_2_9:1.3.0.16
	OPENBSD_2_8:1.3.0.14
	OPENBSD_2_8_BASE:1.3
	OPENBSD_2_7:1.3.0.12
	OPENBSD_2_7_BASE:1.3
	OPENBSD_2_6:1.3.0.10
	OPENBSD_2_6_BASE:1.3
	OPENBSD_2_5:1.3.0.8
	OPENBSD_2_5_BASE:1.3
	OPENBSD_2_4:1.3.0.6
	OPENBSD_2_4_BASE:1.3
	OPENBSD_2_3:1.3.0.4
	OPENBSD_2_3_BASE:1.3
	OPENBSD_2_2:1.3.0.2
	OPENBSD_2_2_BASE:1.3
	OPENBSD_2_1:1.2.0.4
	OPENBSD_2_1_BASE:1.2
	OPENBSD_2_0:1.2.0.2
	OPENBSD_2_0_BASE:1.2
	netbsd_1_1:1.1.1.1;
locks; strict;
comment	@ * @;


1.21
date	2015.03.12.01.03.00;	author claudio;	state Exp;
branches;
next	1.20;
commitid	0MoFRWiboJGvZpKs;

1.20
date	2014.07.10.14.39.18;	author deraadt;	state Exp;
branches;
next	1.19;
commitid	zloNlbksPNYHzdvB;

1.19
date	2013.09.07.11.43.50;	author reyk;	state Exp;
branches;
next	1.18;

1.18
date	2012.12.05.23.20.26;	author deraadt;	state Exp;
branches;
next	1.17;

1.17
date	2011.03.31.06.12.34;	author lum;	state Exp;
branches;
next	1.16;

1.16
date	2011.03.02.06.48.17;	author jasper;	state Exp;
branches;
next	1.15;

1.15
date	2010.07.22.12.33.29;	author giovanni;	state Exp;
branches;
next	1.14;

1.14
date	2009.08.13.23.45.35;	author deraadt;	state Exp;
branches;
next	1.13;

1.13
date	2009.06.19.07.48.45;	author jasper;	state Exp;
branches;
next	1.12;

1.12
date	2008.11.08.06.38.27;	author canacar;	state Exp;
branches;
next	1.11;

1.11
date	2008.11.05.15.48.44;	author canacar;	state Exp;
branches;
next	1.10;

1.10
date	2008.11.02.06.23.28;	author canacar;	state Exp;
branches;
next	1.9;

1.9
date	2008.06.12.22.26.01;	author canacar;	state Exp;
branches;
next	1.8;

1.8
date	2003.06.03.02.56.17;	author millert;	state Exp;
branches;
next	1.7;

1.7
date	2002.02.16.21.27.54;	author millert;	state Exp;
branches;
next	1.6;

1.6
date	2001.12.07.09.18.08;	author deraadt;	state Exp;
branches;
next	1.5;

1.5
date	2001.12.07.07.57.36;	author pvalchev;	state Exp;
branches;
next	1.4;

1.4
date	2001.11.23.22.20.06;	author deraadt;	state Exp;
branches;
next	1.3;

1.3
date	97.06.23.22.21.49;	author millert;	state Exp;
branches;
next	1.2;

1.2
date	96.06.26.05.40.12;	author deraadt;	state Exp;
branches;
next	1.1;

1.1
date	95.10.18.08.46.10;	author deraadt;	state Exp;
branches
	1.1.1.1;
next	;

1.1.1.1
date	95.10.18.08.46.10;	author deraadt;	state Exp;
branches;
next	;


desc
@@


1.21
log
@Switch the netstat view of systat to use the same kvm_getfiles()
function similar to netstat(1). The output still shows the same
info but may be a bit differently sorted. Also it will now show
connections that are not UDP or TCP.  This was the last bit of
systat that needed kvm access and so now systat no longer needs
to be setgid kmem.
With this commit OpenBSD is officially setgid kmem free and an
almost 10 year journey finally comes to an end.
OK deraadt@@
@
text
@/*	$OpenBSD: systat.h,v 1.20 2014/07/10 14:39:18 deraadt Exp $	*/
/*	$NetBSD: systat.h,v 1.2 1995/01/20 08:52:14 jtc Exp $	*/

/*-
 * Copyright (c) 1980, 1989, 1992, 1993
 *	The Regents of the University of California.  All rights reserved.
 *
 * Redistribution and use in source and binary forms, with or without
 * modification, are permitted provided that the following conditions
 * are met:
 * 1. Redistributions of source code must retain the above copyright
 *    notice, this list of conditions and the following disclaimer.
 * 2. Redistributions in binary form must reproduce the above copyright
 *    notice, this list of conditions and the following disclaimer in the
 *    documentation and/or other materials provided with the distribution.
 * 3. Neither the name of the University nor the names of its contributors
 *    may be used to endorse or promote products derived from this software
 *    without specific prior written permission.
 *
 * THIS SOFTWARE IS PROVIDED BY THE REGENTS AND CONTRIBUTORS ``AS IS'' AND
 * ANY EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT LIMITED TO, THE
 * IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE
 * ARE DISCLAIMED.  IN NO EVENT SHALL THE REGENTS OR CONTRIBUTORS BE LIABLE
 * FOR ANY DIRECT, INDIRECT, INCIDENTAL, SPECIAL, EXEMPLARY, OR CONSEQUENTIAL
 * DAMAGES (INCLUDING, BUT NOT LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS
 * OR SERVICES; LOSS OF USE, DATA, OR PROFITS; OR BUSINESS INTERRUPTION)
 * HOWEVER CAUSED AND ON ANY THEORY OF LIABILITY, WHETHER IN CONTRACT, STRICT
 * LIABILITY, OR TORT (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY
 * OUT OF THE USE OF THIS SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF
 * SUCH DAMAGE.
 *
 *	@@(#)systat.h	8.1 (Berkeley) 6/6/93
 */

#ifndef _SYSTAT_H_
#define _SYSTAT_H_

#include <netinet/in.h>
#include <fcntl.h>
#include <kvm.h>
#include "engine.h"


#define	CF_INIT		0x1		/* been initialized */
#define	CF_LOADAV	0x2		/* display w/ load average */

#define FIELD_ADDR(struct, x) (&struct[x])
#define KREAD(addr, buf, len)  kvm_ckread((addr), (buf), (len))
#define NVAL(indx)  namelist[(indx)].n_value
#define NPTR(indx)  (void *)NVAL((indx))
#define NREAD(indx, buf, len) kvm_ckread(NPTR((indx)), (buf), (len))
int kvm_ckread(void *, void *, size_t);

extern char	**dr_name;
extern char	hostname[];
extern double	avenrun[3];
extern kvm_t	*kd;
extern long	ntext;
extern int	*dk_select;
extern int	dk_ndrive;
extern int	hz, stathz;
extern double	naptime;
extern size_t	nhosts;
extern size_t	nports;
extern int	protos;
extern int	verbose;
extern int	nflag;
extern char	uloadbuf[];
extern char	timebuf[];

struct inpcb;

void die(void);
int print_header(void);
int keyboard_callback(int);
int initnetstat(void);
int initifstat(void);
int initiostat(void);
int initsensors(void);
int initmembufs(void);
int initpigs(void);
int initswap(void);
int initvmstat(void);
int initpftop(void);
int initpf(void);
int initpool(void);
int initmalloc(void);
int initnfs(void);
int initcpu(void);

void fetchkre(void);
void fetchifstat(void);

void error(const char *fmt, ...);
void nlisterr(struct nlist []);

const char *inetname(struct in_addr);
const char *inet6name(struct in6_addr *);

#endif

struct ifcount {
	u_int64_t	ifc_ib;			/* input bytes */
	u_int64_t	ifc_ip;			/* input packets */
	u_int64_t	ifc_ie;			/* input errors */
	u_int64_t	ifc_ob;			/* output bytes */
	u_int64_t	ifc_op;			/* output packets */
	u_int64_t	ifc_oe;			/* output errors */
	u_int64_t	ifc_co;			/* collisions */
	int		ifc_flags;		/* up / down */
	int		ifc_state;		/* link state */
} sum;
@


1.20
log
@repair prototypes
@
text
@d1 1
a1 1
/*	$OpenBSD: systat.h,v 1.19 2013/09/07 11:43:50 reyk Exp $	*/
a45 3

#define	TCP	0x1
#define	UDP	0x2
@


1.19
log
@Add a new screen "cpu" that simply lists the usage of each CPU core.
Also add a new -B command line flag that works like -b but waits some
cycles before dumping anything to the console.

With much help from jmc@@
OK jj@@ lambert@@ jmc@@
@
text
@d1 1
a1 1
/*	$OpenBSD: systat.h,v 1.18 2012/12/05 23:20:26 deraadt Exp $	*/
d93 3
@


1.18
log
@Remove excessive sys/cdefs.h inclusion
ok guenther millert kettenis
@
text
@d1 1
a1 1
/*	$OpenBSD: systat.h,v 1.17 2011/03/31 06:12:34 lum Exp $	*/
d92 1
@


1.17
log
@Make the top line of systat stop updating, along with the rest of the data
when 'p' is pressed.
ok nicm@@
@
text
@d1 1
a1 1
/*	$OpenBSD: systat.h,v 1.16 2011/03/02 06:48:17 jasper Exp $	*/
a38 1
#include <sys/cdefs.h>
@


1.16
log
@- use a common FIELD_ADDR macro, instead of rolling 78 identical copies.

ok canacar@@
@
text
@d1 1
a1 1
/*	$OpenBSD: systat.h,v 1.15 2010/07/22 12:33:29 giovanni Exp $	*/
d72 2
@


1.15
log
@
Let systat -N states resolve network addresses
help and ok sthen@@ lum@@
ok canacar@@
@
text
@d1 1
a1 1
/*	$OpenBSD: systat.h,v 1.14 2009/08/13 23:45:35 deraadt Exp $	*/
d51 1
@


1.14
log
@there are louder and louder moans about the inability to see packet
rates at the same time as interrupt counts, so sneak them into the
bottom corner of the vmstat screen
ok dlg
@
text
@d1 1
a1 1
/*	$OpenBSD: systat.h,v 1.13 2009/06/19 07:48:45 jasper Exp $	*/
d38 1
d93 3
@


1.13
log
@- add two new views to systat, 'nfsserver' and 'nfsclient'.
output is similar to nfsstat(1), but it allows for better monitoring/debugging

tricked into by and "i love this" thib@@
ok canacar@@
@
text
@d1 1
a1 1
/*	$OpenBSD: systat.h,v 1.12 2008/11/08 06:38:27 canacar Exp $	*/
d94 12
@


1.12
log
@Add malloc and buckets views that display kernel malloc statistics similar
to vmstat -m
@
text
@d1 1
a1 1
/*	$OpenBSD: systat.h,v 1.11 2008/11/05 15:48:44 canacar Exp $	*/
d88 1
@


1.11
log
@Fix some function prototypes, remove unused variables and commented out code
@
text
@d1 1
a1 1
/*	$OpenBSD: systat.h,v 1.10 2008/11/02 06:23:28 canacar Exp $	*/
d87 1
@


1.10
log
@Add a view that displays pool(9) information. Idea and ok deraadt@@
@
text
@d1 1
a1 1
/*	$OpenBSD: systat.h,v 1.9 2008/06/12 22:26:01 canacar Exp $	*/
d84 1
@


1.9
log
@New display engine for systat, based on pftop. Adds new views for pf
(status, state, rule, queue). While all displays work, some keyboard
comands are not implemented yet. Other features include better handling
of display resize and scrolling for long views. Committing now to fix
the remaining issues in the tree.
Testing and comments by otto@@ and harding@@, ok deraadt@@
@
text
@d1 1
a1 1
/*	$OpenBSD: systat.h,v 1.8 2003/06/03 02:56:17 millert Exp $	*/
d85 1
@


1.8
log
@Remove the advertising clause in the UCB license which Berkeley
rescinded 22 July 1999.  Proofed by myself and Theo.
@
text
@d1 1
a1 1
/*	$OpenBSD: systat.h,v 1.7 2002/02/16 21:27:54 millert Exp $	*/
d35 7
a41 1
#include <curses.h>
a42 11
struct  cmdtab {
	char	*c_name;			/* command name */
	void	(*c_refresh)(void);		/* display refresh */
	void	(*c_fetch)(void);		/* sets up data structures */
	void	(*c_label)(void);		/* label display */
	int	(*c_init)(void);		/* initialize namelist, etc. */
	WINDOW	*(*c_open)(void);		/* open display */
	void	(*c_close)(WINDOW *);		/* close display */
	int	(*c_cmd)(char *, char *);	/* display command interpreter */
	char	c_flags;			/* see below */
};
d54 36
@


1.7
log
@Part one of userland __P removal.  Done with a simple regexp with some minor hand editing to make comments line up correctly.  Another pass is forthcoming that handles the cases that could not be done automatically.
@
text
@d1 1
a1 1
/*	$OpenBSD: systat.h,v 1.6 2001/12/07 09:18:08 deraadt Exp $	*/
d16 1
a16 5
 * 3. All advertising materials mentioning features or use of this software
 *    must display the following acknowledgement:
 *	This product includes software developed by the University of
 *	California, Berkeley and its contributors.
 * 4. Neither the name of the University nor the names of its contributors
@


1.6
log
@move back.  pvalchev -- the bug was quite obscure
@
text
@d1 1
a1 1
/*	$OpenBSD: systat.h,v 1.4 2001/11/23 22:20:06 deraadt Exp $	*/
d43 7
a49 7
	void	(*c_refresh) __P((void));	/* display refresh */
	void	(*c_fetch) __P((void));		/* sets up data structures */
	void	(*c_label) __P((void));		/* label display */
	int	(*c_init) __P((void));		/* initialize namelist, etc. */
	WINDOW	*(*c_open) __P((void));		/* open display */
	void	(*c_close) __P((WINDOW *));	/* close display */
	int	(*c_cmd) __P((char *, char *));	/* display command interpreter */
@


1.5
log
@back out latest changes which cause problems on alpha/sparc64 until
they are fixed
@
text
@d1 1
a1 1
/*	$OpenBSD: systat.h,v 1.3 1997/06/23 22:21:49 millert Exp $	*/
a62 1
#define LONG	(sizeof (long))
@


1.4
log
@fix signal races.  use sysctl() instead of kvm where possible, and then KNF
the hell out of it; checked by miod
@
text
@d63 1
@


1.3
log
@Cleanup by Theo and myself.  CMDLINE changed to long to make
command line work on 64bit platforms.  This is somewhat bogus
and is really just a temporary workaround (there may be a curses bug).
@
text
@d1 1
a1 1
/*	$OpenBSD: systat.h,v 1.2 1996/06/26 05:40:12 deraadt Exp $	*/
a62 1
#define LONG	(sizeof (long))
@


1.2
log
@rcsid
@
text
@d1 1
a1 1
/*	$OpenBSD: systat.h,v 1.2 1995/01/20 08:52:14 jtc Exp $	*/
d42 9
a50 9
        char    *c_name;		/* command name */
        void    (*c_refresh)();		/* display refresh */
        void    (*c_fetch)();		/* sets up data structures */
        void    (*c_label)();		/* label display */
	int	(*c_init)();		/* initialize namelist, etc. */
	WINDOW	*(*c_open)();		/* open display */
	void	(*c_close)();		/* close display */
	int	(*c_cmd)();		/* display command interpreter */
	char	c_flags;		/* see below */
@


1.1
log
@Initial revision
@
text
@d1 1
@


1.1.1.1
log
@initial import of NetBSD tree
@
text
@@
