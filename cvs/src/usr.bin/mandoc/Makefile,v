head	1.105;
access;
symbols
	OPENBSD_6_0:1.102.0.2
	OPENBSD_6_0_BASE:1.102
	OPENBSD_5_9:1.100.0.2
	OPENBSD_5_9_BASE:1.100
	OPENBSD_5_8:1.97.0.4
	OPENBSD_5_8_BASE:1.97
	OPENBSD_5_7:1.91.0.2
	OPENBSD_5_7_BASE:1.91
	OPENBSD_5_6:1.80.0.4
	OPENBSD_5_6_BASE:1.80
	OPENBSD_5_5:1.74.0.4
	OPENBSD_5_5_BASE:1.74
	OPENBSD_5_4:1.69.0.6
	OPENBSD_5_4_BASE:1.69
	OPENBSD_5_3:1.69.0.4
	OPENBSD_5_3_BASE:1.69
	OPENBSD_5_2:1.69.0.2
	OPENBSD_5_2_BASE:1.69
	OPENBSD_5_1_BASE:1.68
	OPENBSD_5_1:1.68.0.2
	OPENBSD_5_0:1.57.0.2
	OPENBSD_5_0_BASE:1.57
	OPENBSD_4_9:1.52.0.2
	OPENBSD_4_9_BASE:1.52
	OPENBSD_4_8:1.44.0.2
	OPENBSD_4_8_BASE:1.44
	OPENBSD_4_7:1.27.0.2
	OPENBSD_4_7_BASE:1.27
	OPENBSD_4_6:1.6.0.4
	OPENBSD_4_6_BASE:1.6;
locks; strict;
comment	@# @;


1.105
date	2017.03.03.14.21.41;	author schwarze;	state Exp;
branches;
next	1.104;
commitid	XiReG6k6LbJGRsK6;

1.104
date	2017.01.25.02.54.53;	author schwarze;	state Exp;
branches;
next	1.103;
commitid	vd3WXMfnbYej5rct;

1.103
date	2016.08.01.10.32.39;	author schwarze;	state Exp;
branches;
next	1.102;
commitid	UE9YpFybzQeyHuWW;

1.102
date	2016.07.10.10.03.15;	author schwarze;	state Exp;
branches;
next	1.101;
commitid	R6sNGWOmYohzlHm0;

1.101
date	2016.03.30.06.38.46;	author jmc;	state Exp;
branches;
next	1.100;
commitid	LN9ijdk9SEnzWAbM;

1.100
date	2015.10.22.22.05.42;	author schwarze;	state Exp;
branches;
next	1.99;
commitid	h8gIY5ljbuMubFWJ;

1.99
date	2015.10.20.02.00.49;	author schwarze;	state Exp;
branches;
next	1.98;
commitid	v6RrmxwM663z4mTF;

1.98
date	2015.10.13.15.50.15;	author schwarze;	state Exp;
branches;
next	1.97;
commitid	ZofM5WCqJbf4KjAB;

1.97
date	2015.07.19.05.59.07;	author schwarze;	state Exp;
branches;
next	1.96;
commitid	X9sGdJbndRzfjdoG;

1.96
date	2015.07.17.22.35.36;	author schwarze;	state Exp;
branches;
next	1.95;
commitid	Ik50obX3Gy0LFoMQ;

1.95
date	2015.03.27.17.36.56;	author schwarze;	state Exp;
branches;
next	1.94;
commitid	3WUgQM2C53CGXRkK;

1.94
date	2015.03.26.23.45.37;	author schwarze;	state Exp;
branches;
next	1.93;
commitid	B2tYDUcglJ8FvMsn;

1.93
date	2015.03.18.18.04.12;	author pascal;	state Exp;
branches;
next	1.92;
commitid	vYGhX9PGRyH38wWJ;

1.92
date	2015.03.14.21.33.18;	author schwarze;	state Exp;
branches;
next	1.91;
commitid	kovqieybkB49j5e4;

1.91
date	2015.02.16.16.18.02;	author schwarze;	state Exp;
branches;
next	1.90;
commitid	Za7hVfBo928Vx64a;

1.90
date	2015.01.16.01.58.18;	author schwarze;	state Exp;
branches;
next	1.89;
commitid	yazSRxVqe91hmBGV;

1.89
date	2014.12.14.17.55.37;	author schwarze;	state Exp;
branches;
next	1.88;
commitid	zUwEny1eBY70O47B;

1.88
date	2014.12.13.15.30.52;	author schwarze;	state Exp;
branches;
next	1.87;
commitid	h0BBSnLIz3JAVqwx;

1.87
date	2014.11.28.18.35.37;	author schwarze;	state Exp;
branches;
next	1.86;
commitid	C7yrJvu6v6cTTSgM;

1.86
date	2014.11.28.18.07.38;	author schwarze;	state Exp;
branches;
next	1.85;
commitid	FLjJT6vAqGK0xVjM;

1.85
date	2014.11.28.17.23.34;	author schwarze;	state Exp;
branches;
next	1.84;
commitid	KPB6oZLXpckMtSIh;

1.84
date	2014.11.25.22.20.22;	author schwarze;	state Exp;
branches;
next	1.83;
commitid	XT9DtYI5eyNCSl8e;

1.83
date	2014.10.30.00.05.02;	author schwarze;	state Exp;
branches;
next	1.82;
commitid	dxVoXRJjO1zZjAXI;

1.82
date	2014.08.27.00.06.08;	author schwarze;	state Exp;
branches;
next	1.81;
commitid	52PkSro00emV8qcw;

1.81
date	2014.08.14.02.49.23;	author schwarze;	state Exp;
branches;
next	1.80;
commitid	bTZrezf76YSvDgPG;

1.80
date	2014.07.13.09.58.52;	author schwarze;	state Exp;
branches;
next	1.79;
commitid	gsZSYQZIRBisEsht;

1.79
date	2014.07.12.18.05.50;	author schwarze;	state Exp;
branches;
next	1.78;
commitid	ShegTcjBf4Wea2kz;

1.78
date	2014.07.11.15.37.22;	author schwarze;	state Exp;
branches;
next	1.77;
commitid	FuqGkunXbHbHFHDy;

1.77
date	2014.05.12.19.11.20;	author espie;	state Exp;
branches;
next	1.76;

1.76
date	2014.04.18.10.00.48;	author schwarze;	state Exp;
branches;
next	1.75;

1.75
date	2014.03.21.22.17.01;	author schwarze;	state Exp;
branches;
next	1.74;

1.74
date	2014.01.19.00.09.33;	author schwarze;	state Exp;
branches;
next	1.73;

1.73
date	2014.01.02.17.05.02;	author miod;	state Exp;
branches;
next	1.72;

1.72
date	2013.12.31.00.40.19;	author schwarze;	state Exp;
branches;
next	1.71;

1.71
date	2013.10.06.23.59.59;	author schwarze;	state Exp;
branches;
next	1.70;

1.70
date	2013.08.06.19.11.53;	author miod;	state Exp;
branches;
next	1.69;

1.69
date	2012.04.15.13.52.59;	author schwarze;	state Exp;
branches;
next	1.68;

1.68
date	2012.01.16.08.42.38;	author schwarze;	state Exp;
branches;
next	1.67;

1.67
date	2012.01.10.09.45.13;	author schwarze;	state Exp;
branches;
next	1.66;

1.66
date	2012.01.05.23.03.57;	author schwarze;	state Exp;
branches;
next	1.65;

1.65
date	2011.11.26.16.41.35;	author schwarze;	state Exp;
branches;
next	1.64;

1.64
date	2011.11.17.14.52.32;	author schwarze;	state Exp;
branches;
next	1.63;

1.63
date	2011.11.13.09.58.21;	author schwarze;	state Exp;
branches;
next	1.62;

1.62
date	2011.10.09.17.59.56;	author schwarze;	state Exp;
branches;
next	1.61;

1.61
date	2011.10.06.23.04.16;	author schwarze;	state Exp;
branches;
next	1.60;

1.60
date	2011.09.18.15.54.48;	author schwarze;	state Exp;
branches;
next	1.59;

1.59
date	2011.09.18.10.25.28;	author schwarze;	state Exp;
branches;
next	1.58;

1.58
date	2011.09.17.14.45.22;	author schwarze;	state Exp;
branches;
next	1.57;

1.57
date	2011.07.31.16.15.40;	author schwarze;	state Exp;
branches;
next	1.56;

1.56
date	2011.05.29.21.22.18;	author schwarze;	state Exp;
branches;
next	1.55;

1.55
date	2011.04.24.16.22.02;	author schwarze;	state Exp;
branches;
next	1.54;

1.54
date	2011.04.21.22.59.54;	author schwarze;	state Exp;
branches;
next	1.53;

1.53
date	2011.03.20.23.36.42;	author schwarze;	state Exp;
branches;
next	1.52;

1.52
date	2011.01.09.14.30.48;	author schwarze;	state Exp;
branches;
next	1.51;

1.51
date	2011.01.04.22.28.17;	author schwarze;	state Exp;
branches;
next	1.50;

1.50
date	2010.12.25.13.23.03;	author schwarze;	state Exp;
branches;
next	1.49;

1.49
date	2010.12.07.00.08.52;	author schwarze;	state Exp;
branches;
next	1.48;

1.48
date	2010.12.01.23.02.57;	author schwarze;	state Exp;
branches;
next	1.47;

1.47
date	2010.12.01.22.02.29;	author schwarze;	state Exp;
branches;
next	1.46;

1.46
date	2010.10.15.20.45.03;	author schwarze;	state Exp;
branches;
next	1.45;

1.45
date	2010.09.27.21.25.28;	author schwarze;	state Exp;
branches;
next	1.44;

1.44
date	2010.07.31.21.43.07;	author schwarze;	state Exp;
branches;
next	1.43;

1.43
date	2010.07.13.01.09.12;	author schwarze;	state Exp;
branches;
next	1.42;

1.42
date	2010.06.29.15.49.52;	author schwarze;	state Exp;
branches;
next	1.41;

1.41
date	2010.06.26.17.56.43;	author schwarze;	state Exp;
branches;
next	1.40;

1.40
date	2010.06.10.22.50.10;	author schwarze;	state Exp;
branches;
next	1.39;

1.39
date	2010.06.06.20.30.08;	author schwarze;	state Exp;
branches;
next	1.38;

1.38
date	2010.06.06.18.08.41;	author schwarze;	state Exp;
branches;
next	1.37;

1.37
date	2010.05.16.00.54.03;	author schwarze;	state Exp;
branches;
next	1.36;

1.36
date	2010.05.14.14.47.44;	author schwarze;	state Exp;
branches;
next	1.35;

1.35
date	2010.05.14.01.54.37;	author schwarze;	state Exp;
branches;
next	1.34;

1.34
date	2010.05.10.18.20.31;	author drahn;	state Exp;
branches;
next	1.33;

1.33
date	2010.04.07.23.15.05;	author schwarze;	state Exp;
branches;
next	1.32;

1.32
date	2010.04.02.12.39.47;	author schwarze;	state Exp;
branches;
next	1.31;

1.31
date	2010.04.02.11.37.07;	author schwarze;	state Exp;
branches;
next	1.30;

1.30
date	2010.03.29.22.56.52;	author schwarze;	state Exp;
branches;
next	1.29;

1.29
date	2010.03.26.01.22.05;	author schwarze;	state Exp;
branches;
next	1.28;

1.28
date	2010.03.25.23.23.01;	author schwarze;	state Exp;
branches;
next	1.27;

1.27
date	2010.01.03.23.29.03;	author schwarze;	state Exp;
branches;
next	1.26;

1.26
date	2010.01.03.19.59.59;	author schwarze;	state Exp;
branches;
next	1.25;

1.25
date	2010.01.02.02.42.06;	author schwarze;	state Exp;
branches;
next	1.24;

1.24
date	2009.12.24.02.08.14;	author schwarze;	state Exp;
branches;
next	1.23;

1.23
date	2009.12.23.22.30.17;	author schwarze;	state Exp;
branches;
next	1.22;

1.22
date	2009.12.22.23.58.00;	author schwarze;	state Exp;
branches;
next	1.21;

1.21
date	2009.10.27.21.40.07;	author schwarze;	state Exp;
branches;
next	1.20;

1.20
date	2009.10.21.19.13.50;	author schwarze;	state Exp;
branches;
next	1.19;

1.19
date	2009.10.19.09.16.58;	author schwarze;	state Exp;
branches;
next	1.18;

1.18
date	2009.09.18.22.48.29;	author schwarze;	state Exp;
branches;
next	1.17;

1.17
date	2009.08.22.23.17.39;	author schwarze;	state Exp;
branches;
next	1.16;

1.16
date	2009.08.22.20.14.37;	author schwarze;	state Exp;
branches;
next	1.15;

1.15
date	2009.08.22.17.23.13;	author schwarze;	state Exp;
branches;
next	1.14;

1.14
date	2009.08.22.15.48.21;	author schwarze;	state Exp;
branches;
next	1.13;

1.13
date	2009.08.09.20.53.16;	author schwarze;	state Exp;
branches;
next	1.12;

1.12
date	2009.08.09.17.52.08;	author schwarze;	state Exp;
branches;
next	1.11;

1.11
date	2009.07.26.23.54.24;	author schwarze;	state Exp;
branches;
next	1.10;

1.10
date	2009.07.18.22.15.04;	author schwarze;	state Exp;
branches;
next	1.9;

1.9
date	2009.07.13.00.37.07;	author schwarze;	state Exp;
branches;
next	1.8;

1.8
date	2009.07.12.22.53.55;	author schwarze;	state Exp;
branches;
next	1.7;

1.7
date	2009.07.08.00.04.10;	author schwarze;	state Exp;
branches;
next	1.6;

1.6
date	2009.06.27.13.28.08;	author schwarze;	state Exp;
branches;
next	1.5;

1.5
date	2009.06.21.20.52.39;	author schwarze;	state Exp;
branches;
next	1.4;

1.4
date	2009.06.18.22.16.56;	author schwarze;	state Exp;
branches;
next	1.3;

1.3
date	2009.06.14.23.39.43;	author schwarze;	state Exp;
branches;
next	1.2;

1.2
date	2009.04.15.20.10.20;	author miod;	state Exp;
branches;
next	1.1;

1.1
date	2009.04.06.20.30.40;	author kristaps;	state Exp;
branches;
next	;


desc
@@


1.105
log
@new -mdoc -Tmarkdown output mode; OK millert@@ reyk@@ tb@@;
thanks to reyk@@ and to Vsevolod at FreeBSD for suggesting it
@
text
@#	$OpenBSD: Makefile,v 1.104 2017/01/25 02:54:53 schwarze Exp $

.include <bsd.own.mk>

CFLAGS  += -W -Wall -Wstrict-prototypes -Wno-unused-parameter
DPADD += ${LIBUTIL}
LDADD	+= -lutil -lz

SRCS=	mandoc.c mandoc_aux.c mandoc_ohash.c preconv.c read.c \
	roff.c tbl.c tbl_opts.c tbl_layout.c tbl_data.c eqn.c
SRCS+=	mdoc_macro.c mdoc.c mdoc_hash.c \
	mdoc_argv.c mdoc_state.c mdoc_validate.c att.c msec.c st.c
SRCS+=	man_macro.c man.c man_hash.c man_validate.c
SRCS+=	main.c mdoc_term.c tag.c chars.c term.c tree.c man_term.c eqn_term.c
SRCS+=	mdoc_man.c
SRCS+=	html.c mdoc_html.c man_html.c out.c eqn_html.c
SRCS+=	mdoc_markdown.c
SRCS+=	term_ps.c term_ascii.c tbl_term.c tbl_html.c
SRCS+=	dbm_map.c dbm.c dba_write.c dba_array.c dba.c dba_read.c
SRCS+=	manpath.c mandocdb.c mansearch.c

PROG=	mandoc

LINKS =	${BINDIR}/mandoc ${BINDIR}/apropos \
	${BINDIR}/mandoc ${BINDIR}/help \
	${BINDIR}/mandoc ${BINDIR}/man \
	${BINDIR}/mandoc ${BINDIR}/whatis \
	${BINDIR}/mandoc /usr/sbin/makewhatis \
	${BINDIR}/mandoc /usr/libexec/makewhatis

MAN =	apropos.1 man.1 mandoc.1 man.conf.5 makewhatis.8

CLEANFILES += man.cgi cgi.o


# ----------------------------------------------------------------------
# Variables and targets to build and install man.cgi(8),
# not used during make build and make release.

# To configure, run:	cp cgi.h.example cgi.h; vi cgi.h
# To build, run:	make man.cgi
# To install, run:	sudo make installcgi
# After that, read:	man man.cgi.8

LIBMDOC_OBJS =	mdoc_argv.o mdoc_hash.o mdoc_macro.o mdoc_state.o \
		mdoc_validate.o mdoc.o att.o st.o
LIBMAN_OBJS =	man.o man_hash.o man_macro.o man_validate.o
LIBROFF_OBJS =	roff.o eqn.o tbl.o tbl_data.o tbl_layout.o tbl_opts.o
LIBMANDOC_OBJS = ${LIBMDOC_OBJS} ${LIBMAN_OBJS} ${LIBROFF_OBJS} \
		mandoc.o mandoc_aux.o mandoc_ohash.o \
		chars.o msec.o preconv.o read.o
HTML_OBJS =	html.o mdoc_html.o man_html.o tbl_html.o eqn_html.o out.o
CGI_OBJS =	${LIBMANDOC_OBJS} ${HTML_OBJS} \
		dbm_map.o dbm.o mansearch.o cgi.o

cgi.o: cgi.h main.h manconf.h mandoc.h mandoc_aux.h mansearch.h \
	man.h mdoc.h roff.h

man.cgi: ${CGI_OBJS}
	${CC} ${LDFLAGS} ${STATIC} -o ${.TARGET} ${CGI_OBJS} ${LDADD}

installcgi: man.cgi
	${INSTALL} -d -o root -g wheel -m 755 ${DESTDIR}/var/www/cgi-bin
	${INSTALL} ${INSTALL_COPY} -S ${INSTALL_STRIP} \
	    -o ${BINOWN} -g ${BINGRP} -m ${BINMODE} \
	    man.cgi ${DESTDIR}/var/www/cgi-bin/man.cgi
	${INSTALL} ${INSTALL_COPY} -o root -g wheel -m 644 \
	    ${.CURDIR}/mandoc.css ${DESTDIR}/var/www/htdocs/

.include <bsd.prog.mk>
@


1.104
log
@Add the style sheet used on man.openbsd.org to the source tree.

It is NOT used during "make build" and NOT installed, but it is
helpful for people trying to read and understand html.c and mdoc_html.c,
and maybe even for users of mandoc -Thtml.

OK deraadt@@
@
text
@d1 1
a1 1
#	$OpenBSD: Makefile,v 1.103 2016/08/01 10:32:39 schwarze Exp $
d17 1
@


1.103
log
@Remove the dependency on SQLite without loss of functionality.
Drop the obsolete names_check() now that we deleted MLINKS.
Run "doas makewhatis" after compiling and installing this.

Earlier version tested by jmc@@ and jturner@@;
"commit it all" deraadt@@   "commit and dodge" krw@@
@
text
@d1 1
a1 1
#	$OpenBSD: Makefile,v 1.102 2016/07/10 10:03:15 schwarze Exp $
d66 2
@


1.102
log
@Simplify the code and the server setup by deleting the pseudo-manpath
"mandoc" that was used for man.cgi(8) documentation and by assuming
that the apropos(1) and man.cgi(8) manuals are simply installed in
the default manpath.  Even though man.cgi(8) is not installed by
default when installing OpenBSD, it is easy to copy it into the
default manpath used for man.cgi(8).

Idea found when considering a question asked by wrant dot com.
@
text
@d1 1
a1 1
#	$OpenBSD: Makefile,v 1.101 2016/03/30 06:38:46 jmc Exp $
d7 1
a7 1
LDADD	+= -lsqlite3 -lutil -lz
d18 2
a19 1
SRCS+=	manpath.c mandocdb.c mansearch_const.c mansearch.c
d53 1
a53 1
		mansearch.o mansearch_const.o cgi.o
@


1.101
log
@for some time now mandoc has not required MLINKS to function
correctly - logically complete that now by removing MLINKS from base;

authors need only to ensure there is an entry in NAME for any function/
util being added. MLINKS will still work, and remain for perl to ease
upgrades;

ok nicm (curses) bcook (ssl)
ok schwarze, who provided a lot of feedback and assistance
ok tb natano jung
@
text
@d1 1
a1 1
#	$OpenBSD: Makefile,v 1.100 2015/10/22 22:05:42 schwarze Exp $
a64 6
	${INSTALL} -d -o root -g wheel -m 755 ${DESTDIR}/var/www/man/mandoc/man1
	${INSTALL} -d -o root -g wheel -m 755 ${DESTDIR}/var/www/man/mandoc/man8
	${INSTALL} ${INSTALL_COPY} -o ${MANOWN} -g ${MANGRP} -m ${MANMODE} \
	    ${.CURDIR}/apropos.1 ${DESTDIR}/var/www/man/mandoc/man1/apropos.1
	${INSTALL} ${INSTALL_COPY} -o ${MANOWN} -g ${MANGRP} -m ${MANMODE} \
	    ${.CURDIR}/man.cgi.8 ${DESTDIR}/var/www/man/mandoc/man8/man.cgi.8
@


1.100
log
@use the new function man_validate() here, too
@
text
@d1 1
a1 1
#	$OpenBSD: Makefile,v 1.99 2015/10/20 02:00:49 schwarze Exp $
a29 1
MLINKS=	apropos.1 whatis.1
@


1.99
log
@In order to become able to generate syntax tree nodes on the roff(7)
level, validation must be separated from parsing and rewinding.
This first big step moves calling of the mdoc(7) post_*() functions
out of the parser loop into their own mdoc_validate() pass, while
using a new mdoc_state() module to make syntax tree state handling
available to both the parser loop and the validation pass.
@
text
@d1 1
a1 1
#	$OpenBSD: Makefile,v 1.98 2015/10/13 15:50:15 schwarze Exp $
d56 1
a56 1
	mdoc.h roff.h
@


1.98
log
@Reduce the amount of code by moving the three copies of the ohash
callback functions into one common place, preparing for the use of
ohash for some additional purposes.  No functional change.
@
text
@d1 1
a1 1
#	$OpenBSD: Makefile,v 1.97 2015/07/19 05:59:07 schwarze Exp $
d12 1
a12 1
	mdoc_argv.c mdoc_validate.c att.c msec.c st.c
d44 2
a45 2
LIBMDOC_OBJS =	mdoc_argv.o mdoc_hash.o mdoc_macro.o mdoc_validate.o \
		mdoc.o att.o st.o
d55 2
a56 1
cgi.o: main.h mandoc.h mandoc_aux.h mandoc_ohash.h manconf.h mansearch.h cgi.h
@


1.97
log
@Do not fork and exec gunzip(1), just link with libz instead.
As discussed with deraadt@@, that's cleaner and will help tame(2).
Something like this was also suggested earlier by bapt at FreeBSD.
Minus 50 lines of code, deleting one interface function (mparse_wait),
no functional change intended.
@
text
@d1 1
a1 1
#	$OpenBSD: Makefile,v 1.96 2015/07/17 22:35:36 schwarze Exp $
d9 1
a9 1
SRCS=	mandoc.c mandoc_aux.c preconv.c read.c \
d49 2
a50 1
		mandoc.o mandoc_aux.o chars.o msec.o preconv.o read.o
d55 1
a55 1
cgi.o: main.h mandoc.h mandoc_aux.h manconf.h mansearch.h cgi.h
@


1.96
log
@Initial, still somewhat experimental implementation to leverage
less(1) -T and :t ctags(1)-like functionality to jump to the
definitions of various terms inside manual pages.
To be polished in the tree, so bear with me and report issues.

Technically, if less(1) is used as a pager, information is collected
by the mdoc(7) terminal formatter, first stored using the ohash
library, then ultimately written to a temporary file which is passed
to less via -T.  No change intended for other output formatters or
when running without a pager.

Based on an idea from Kristaps using feedback from many, in particular
phessler@@ nicm@@ millert@@ halex@@ doug@@ kspillner@@ deraadt@@.
@
text
@d1 1
a1 1
#	$OpenBSD: Makefile,v 1.95 2015/03/27 17:36:56 schwarze Exp $
d7 1
a7 1
LDADD	+= -lsqlite3 -lutil
@


1.95
log
@Parse the new man.conf(5) "output" directive.
The next step will be to actually use the parsed data.
@
text
@d1 1
a1 1
#	$OpenBSD: Makefile,v 1.94 2015/03/26 23:45:37 schwarze Exp $
d14 1
a14 1
SRCS+=	main.c mdoc_term.c chars.c term.c tree.c man_term.c eqn_term.c
@


1.94
log
@Strip information that no longer applies and document new "manpath" directive.
jmc@@ agrees with the general direction (but hasn't seen this draft;
let's tweak it in the tree).
@
text
@d1 1
a1 1
#	$OpenBSD: Makefile,v 1.93 2015/03/18 18:04:12 pascal Exp $
d54 1
a54 1
cgi.o: main.h mandoc.h mandoc_aux.h manpath.h mansearch.h cgi.h
@


1.93
log
@Convert -static -> ${STATIC} to make man.cgi static PIE.

no concerns from schwarze@@
@
text
@d1 1
a1 1
#	$OpenBSD: Makefile,v 1.92 2015/03/14 21:33:18 schwarze Exp $
d29 1
a29 1
MAN =	apropos.1 man.1 mandoc.1 makewhatis.8
@


1.92
log
@Delete the separate and incomplete whatis(1) manual
and replace it by an MLINK to apropos(1),
which already contains all information about whatis(1).
"up to you" jmc@@
@
text
@d1 1
a1 1
#	$OpenBSD: Makefile,v 1.91 2015/02/16 16:18:02 schwarze Exp $
d57 1
a57 1
	${CC} ${LDFLAGS} -static -o ${.TARGET} ${CGI_OBJS} ${LDADD}
@


1.91
log
@Delete the -V option.  It serves no purpose but keeps confusing people.
@
text
@d1 1
a1 1
#	$OpenBSD: Makefile,v 1.90 2015/01/16 01:58:18 schwarze Exp $
d29 2
a30 1
MAN =	apropos.1 man.1 mandoc.1 whatis.1 makewhatis.8
@


1.90
log
@Delete the MANLINT variable and the related SUFFIXES rules because
since yesterday, "mandoc -Tlint -Wfatal" can no longer fail.
Instead, as suggested by deraadt@@, provide a manlint target
that is *not* run during make build, but can be run
whenever you want to check syntax of manuals.
"nice stuff" deraadt@@
@
text
@d1 1
a1 1
#	$OpenBSD: Makefile,v 1.89 2014/12/14 17:55:37 schwarze Exp $
a4 1
CFLAGS  += -DVERSION=\"1.13.2\"
@


1.89
log
@Switch man(1) to the mandoc implementation.
OK krw@@ naddy@@ sthen@@  "commit it now" deraadt@@

I won't remove the files in src/usr.bin/man, such that we can quickly
switch back in case a problem is found.
@
text
@d1 1
a1 1
#	$OpenBSD: Makefile,v 1.88 2014/12/13 15:30:52 schwarze Exp $
d32 1
a32 1
CLEANFILES += man.cgi cgi.o man.cgi.8.manlint
@


1.88
log
@just released mandoc 1.13.2
@
text
@d1 1
a1 1
#	$OpenBSD: Makefile,v 1.87 2014/11/28 18:35:37 schwarze Exp $
d24 2
d30 1
a30 1
MAN =	apropos.1 mandoc.1 whatis.1 makewhatis.8
@


1.87
log
@Retire support for CSRG supplementary document titles.  These are
long obsolete and were never written in mdoc(7) in the first place.
Removes 100 lines from source files.
@
text
@d1 1
a1 1
#	$OpenBSD: Makefile,v 1.86 2014/11/28 18:07:38 schwarze Exp $
d5 1
a5 1
CFLAGS  += -DVERSION=\"1.13.1\"
@


1.86
log
@Drop useless architecture table.  Validating architecture names
is a job for makewhatis(8)/mandoc.db(5), not for the parser.
Removes 150 lines from source files and 4k (1%) from the binary.
Bloat found by deraadt@@.
@
text
@d1 1
a1 1
#	$OpenBSD: Makefile,v 1.85 2014/11/28 17:23:34 schwarze Exp $
d13 1
a13 1
	mdoc_argv.c mdoc_validate.c att.c vol.c msec.c st.c
d43 1
a43 1
		mdoc.o att.o st.o vol.o
@


1.85
log
@Remove bulky, irrelevant library description string tables
not used by a single manual in OpenBSD and just print library names;
will remain in the portable version for use by FreeBSD and NetBSD.
Removes 150 lines from source tree and 16 Kilobytes (4%) from binary.
Bloat found by deraadt@@.
@
text
@d1 1
a1 1
#	$OpenBSD: Makefile,v 1.84 2014/11/25 22:20:22 schwarze Exp $
d13 1
a13 2
	mdoc_argv.c mdoc_validate.c att.c \
	arch.c vol.c msec.c st.c
d43 1
a43 1
		mdoc.o arch.o att.o st.o vol.o
@


1.84
log
@fix (disabled) build of man.cgi
@
text
@d1 1
a1 1
#	$OpenBSD: Makefile,v 1.83 2014/10/30 00:05:02 schwarze Exp $
d13 1
a13 1
	mdoc_argv.c mdoc_validate.c lib.c att.c \
d44 1
a44 1
		mdoc.o arch.o att.o lib.o st.o vol.o
@


1.83
log
@support UTF-8 and ISO-8859-1 input by integrating modified parts
of kristaps@@' version of the preconv(1) utility into mandoc(1);
positive feedback from bentley@@ and no concern raised when shown on tech@@
@
text
@d1 1
a1 1
#	$OpenBSD: Makefile,v 1.82 2014/08/27 00:06:08 schwarze Exp $
d48 1
a48 1
		mandoc.o mandoc_aux.o chars.o msec.o read.o
@


1.82
log
@Add an implementation of man(1) into the /usr/bin/mandoc binary and
provide a unified set of command line options for mandoc(1), man(1),
apropos(1), and whatis(1), each option doing the same for all four.
Not adding any completely new options, only extending exiting ones
from one tool to the others.  New options are:
* apropos & whatis -acfkw  (in the past, these were man(1) only)
* apropos & whatis -a -IOTW  (in the past, mandoc(1) only)
* mandoc -ac  (in the past, man(1) only)
* man -IOTW  (in the past, mandoc(1) only)

Before we can decide whether or not we want to replace src/usr.bin/man
with this implementation, considerable bugfixing, testing, and
performance measurements are needed, which i'd rather do in the tree
than outside.  Note that these bugs only affect the new man(1) mode,
existing mandoc(1), apropos(1), and whatis(1) is fine.

The new functionality in mandoc(1), apropos(1), and whatis(1)
is fully enabled.  To play with the new man(1), you can try:
# mv /usr/bin/man /usr/bin/oman
# ln -s /usr/bin/mandoc /usr/bin/man

Positive feedback about the general direction from sthen@@ and jmc@@,
and deraadt@@ is not against it.
@
text
@d1 1
a1 1
#	$OpenBSD: Makefile,v 1.81 2014/08/14 02:49:23 schwarze Exp $
d10 1
a10 1
SRCS=	mandoc.c mandoc_aux.c read.c \
@


1.81
log
@mandoc 1.13.1 has been released
@
text
@d1 1
a1 1
#	$OpenBSD: Makefile,v 1.80 2014/07/13 09:58:52 schwarze Exp $
d20 1
a20 1
SRCS+=	manpath.c mandocdb.c mansearch_const.c mansearch.c apropos.c
@


1.80
log
@Install the manuals of the web interface below the same directory
as manpath.conf, such that we do not need to mix our own documentation
into the documentation we are serving, which may not even be possible
if the latter is updated automatically.

Based on an idea by beck@@.
@
text
@d1 1
a1 1
#	$OpenBSD: Makefile,v 1.79 2014/07/12 18:05:50 schwarze Exp $
d5 1
a5 1
CFLAGS  += -DVERSION=\"1.13.0\"
@


1.79
log
@No need for run-time configuration, add minimal compile-time
configuration facilities, just two paths and two HTML strings.
Show the title on all pages, not just the index page.
@
text
@d1 1
a1 1
#	$OpenBSD: Makefile,v 1.78 2014/07/11 15:37:22 schwarze Exp $
d63 2
d66 3
a68 1
	    ${.CURDIR}/man.cgi.8 ${DESTDIR}${MANDIR}8/man.cgi.8
@


1.78
log
@Bring in man.cgi(8) to maintain it in our tree together with mandoc.
It will not be enabled in the build nor installed by default.

A comment in the Makefile lists the three simple steps
needed to build, install, and run it on the two machines
worldwide that are going to run it.

deraadt@@ agrees with having the code in the tree.
@
text
@d1 1
a1 1
#	$OpenBSD: Makefile,v 1.77 2014/05/12 19:11:20 espie Exp $
d38 1
d53 1
a53 1
cgi.o: main.h mandoc.h mandoc_aux.h manpath.h mansearch.h
@


1.77
log
@adjust to ohash being in libutil now, and to the interface changes.
fix potential integer overflows in memory allocation (mostly for pedagogical
purposes, these are unlikely to overflow in practice)
move the rest of lst.lib stuff into its own directory.
@
text
@d1 1
a1 1
#	$OpenBSD: Makefile,v 1.76 2014/04/18 10:00:48 schwarze Exp $
d30 34
@


1.76
log
@Switch to the new makewhatis(8)/apropos(1)/whatis(1) combo.
"commit the switch now" espie@@  "go for it" deraadt@@

See the apropos(1) manual for a description of what's new.
On machines where you want the full functionality,
run "sudo makewhatis" and put "MAKEWHATISARGS=' '" into weekly.local(8).
Otherwise, when upgrading via source, run "sudo makewhatis -Q".
@
text
@d1 1
a1 1
#	$OpenBSD: Makefile,v 1.75 2014/03/21 22:17:01 schwarze Exp $
d7 2
a8 1
LDADD	+= -lsqlite3
@


1.75
log
@The files mandoc.c and mandoc.h contained both specialised low-level
functions used for multiple languages (mdoc, man, roff), for example
mandoc_escape(), mandoc_getarg(), mandoc_eos(), and generic auxiliary
functions.  Split the auxiliaries out into their own file and header.
While here, do some #include cleanup.
@
text
@d1 1
a1 1
#	$OpenBSD: Makefile,v 1.74 2014/01/19 00:09:33 schwarze Exp $
d23 6
a28 1
MAN=	mandoc.1
@


1.74
log
@Support a second -v on mandocdb(8) to show keys while they are being added;
i need that for debugging, in particular to be used with -t.
To be able to do so, provide a global table of key names, for reuse.
@
text
@d1 1
a1 1
#	$OpenBSD: Makefile,v 1.73 2014/01/02 17:05:02 miod Exp $
d9 2
a10 1
SRCS=	roff.c tbl.c tbl_opts.c tbl_layout.c tbl_data.c eqn.c mandoc.c read.c
@


1.73
log
@LDFLAGS -> LDADD, fixes build on static arches.
@
text
@d1 1
a1 1
#	$OpenBSD: Makefile,v 1.72 2013/12/31 00:40:19 schwarze Exp $
d18 1
a18 1
SRCS+=	manpath.c mandocdb.c mansearch.c apropos.c
@


1.72
log
@Replace the Berkeley-DB based mandocdb(8) by an SQLite3-based version,
aiming for more flexible development and optimization options.
Kristaps started this during the summer 2012, i did some very heavy
bugfixing during t2k13 and finally, during the last few days,
got it to a state where it is ripe for in-tree development.
Beware, neither the user interfaces nor the database formats
are expected to be stable just yet.

Will not be installed or activated until further discussion.
No functional change to mandoc(1).

"As long as it remains off until we decide the cost, fine." deraadt@@
@
text
@d1 1
a1 1
#	$OpenBSD: Makefile,v 1.71 2013/10/06 23:59:59 schwarze Exp $
d7 1
a7 1
LDFLAGS += -lsqlite3
@


1.71
log
@Yesterday, i released (portable) mandoc 1.12.2, so bump our VERSION, too.
No merging is needed; basically, mandoc is developed here and mdocml.bsd.lv
is not really "upstream", but just OpenBSD plus compatibility goo.  All the
same, the exercise is far from useless: NetBSD, FreeBSD, and DragonFly have
mandoc in base, NetBSD uses it by default to show manuals, and FreeBSD and
DragonFly have finally come close to switching away from groff as well.
Useful bug reports come in and help making our mandoc better.
Maybe we should list mandoc as an OpenBSD associated project on index.html.
@
text
@d1 1
a1 1
#	$OpenBSD: Makefile,v 1.70 2013/08/06 19:11:53 miod Exp $
d5 3
a7 2
CFLAGS+=-DVERSION=\"1.12.2\"
CFLAGS+=-W -Wall -Wstrict-prototypes -Wno-unused-parameter
d18 1
a18 1
SRCS+=	manpath.c mandocdb.c apropos_db.c apropos.c
@


1.70
log
@Remove support for COMPILER_VERSION == gcc2.
Change the logic depending upon COMPILER_VERSION everywhere, to assume gcc4
is the norm and to explicitely test for gcc3 when a different behaviour
is required.
No functional change intended. Be sure to `make install' in share/mk before
attempting to do anything.
@
text
@d1 1
a1 1
#	$OpenBSD: Makefile,v 1.69 2012/04/15 13:52:59 schwarze Exp $
d5 1
a5 1
CFLAGS+=-DVERSION=\"1.12.1\"
@


1.69
log
@Call this mandoc 1.12.1.

I refrained from merging one patch that i dislike
and one that requires additional review,
but we are now definitely much closer to 1.12.1 than to 1.12.0.
@
text
@d1 1
a1 1
#	$OpenBSD: Makefile,v 1.68 2012/01/16 08:42:38 schwarze Exp $
d6 1
a6 5
CFLAGS+=-W -Wall -Wstrict-prototypes

.if ${COMPILER_VERSION:L} == "gcc3" || ${COMPILER_VERSION:L} == "gcc4" 
CFLAGS+=-Wno-unused-parameter
.endif
@


1.68
log
@Backout activation of the new apropos(1)/whatis(1)/makewhatis(8).
In its current state, it causes too much slowdown, in particular
during system builds, and there are other regressions.
That cannot be fixed quickly while it's enabled.

Problems pointed out by espie@@, backout requested by deraadt@@,
diff "looks good" to espie@@.
@
text
@d1 1
a1 1
#	$OpenBSD: Makefile,v 1.67 2012/01/10 09:45:13 schwarze Exp $
d5 1
a5 1
CFLAGS+=-DVERSION=\"1.12.0\"
@


1.67
log
@Continue using the traditional name makewhatis(8),
do not rename to mandocdb(8):  Even though there is some
additional functionality, the basic purpose remains the same.
Requested by espie@@; "decide fast" deraadt@@.
@
text
@d1 1
a1 1
#	$OpenBSD: Makefile,v 1.66 2012/01/05 23:03:57 schwarze Exp $
d25 1
a25 6
LINKS=	${BINDIR}/mandoc ${BINDIR}/apropos
LINKS+=	${BINDIR}/mandoc ${BINDIR}/makewhatis
LINKS+=	${BINDIR}/mandoc ${BINDIR}/whatis
LINKS+=	${BINDIR}/mandoc /usr/libexec/makewhatis

MAN=	apropos.1 mandoc.1 makewhatis.8 whatis.1
@


1.66
log
@Enable the new apropos(1), whatis(1), and makewhatis(8).
Unlink the old apropos(1), whatis(1), and makewhatis(8) from the build.
Call the new tools from pkg_create(1) and pkg_add(1).
"Please enable it now."  deraadt@@
@
text
@d1 1
a1 1
#	$OpenBSD: Makefile,v 1.65 2011/11/26 16:41:35 schwarze Exp $
d26 1
a26 1
LINKS+=	${BINDIR}/mandoc ${BINDIR}/mandocdb
d30 1
a30 2
MAN=	apropos.1 mandoc.1 mandocdb.8 whatis.1
MLINKS=	mandocdb.8 makewhatis.8
@


1.65
log
@Resync to bsd.lv, most code from kristaps@@.
In particular, support the MANPATH environment variable
and don't confuse index record numbers when working with
multiple mandoc databases at once.
Besides, remove lots of gratuitious code and whitespace differences.
@
text
@d1 1
a1 1
#	$OpenBSD: Makefile,v 1.64 2011/11/17 14:52:32 schwarze Exp $
d25 4
a28 1
LINKS=	${BINDIR}/mandoc ${BINDIR}/mandocdb
d30 2
a31 1
MAN=	mandoc.1 mandocdb.8
@


1.64
log
@Minimal man.conf(5) _whatdb support for mandocdb(8) and apropos(1),
and add the standard options -M and -m to apropos(1).
Including a bugfix to prevent mandocdb(8) from leaking
database file descriptors.
@
text
@d1 1
a1 1
#	$OpenBSD: Makefile,v 1.63 2011/11/13 09:58:21 schwarze Exp $
d21 1
a21 1
SRCS+=	man_conf.c mandocdb.c apropos_db.c apropos.c
@


1.63
log
@Split the common code to be reused by other mandocdb clients,
for example the future man.cgi, out of apropos.c (which still
contains the apropos(1) main program, command line handling, and
the terminal output formatter) into apropos_db.{h,c} (which now
contains the database searching backend code).

While here,
* Drop the -e option; to search for exact strings, use REs.
* Drop the -r option (more changes related to this coming soon).
* Use the traditional -s and -S instead of inventing our own options.
* Drop the sort option (at least for now), it got in the way.

Written by kristaps@@.
@
text
@d1 1
a1 1
#	$OpenBSD: Makefile,v 1.62 2011/10/09 17:59:56 schwarze Exp $
d21 1
a21 1
SRCS+=	mandocdb.c apropos_db.c apropos.c
@


1.62
log
@Sync to version 1.12.0; all code by kristaps@@:
Implement .Rv in -Tman.
Let -man -Tman work a bit like cat(1).
Add the -Ofragment option to -T[x]html.
Minor fixes in -T[x]html.
Lots of apropos(1) and -Tman code cleanup.
@
text
@d1 1
a1 1
#	$OpenBSD: Makefile,v 1.61 2011/10/06 23:04:16 schwarze Exp $
d21 1
a21 1
SRCS+=	mandocdb.c apropos.c
@


1.61
log
@1) Import the future apropos(1) replacement written by kristaps@@.
2) Link both that one and mandocdb(8) into the mandoc(1) binary.
3) Install a /usr/bin/mandocdb hardlink and the mandocdb(8) manual.

Do not replace /usr/bin/apropos by a hardlink yet because it is
not ready for production, and ports integration is still missing.
Development will be done in the tree, even the user interfaces
are still subject to change at this point.

Both jmc@@ and deraadt@@ agree with getting this in.
@
text
@d1 1
a1 1
#	$OpenBSD: Makefile,v 1.60 2011/09/18 15:54:48 schwarze Exp $
d5 1
a5 1
CFLAGS+=-DVERSION=\"1.11.7\"
@


1.60
log
@sync to version 1.11.7 from kristaps@@
main new feature: support the roff(7) .tr request
plus various bugfixes and some refactoring

regressions are so minor that it's better to get this in
and fix them in the tree
@
text
@d1 1
a1 1
#	$OpenBSD: Makefile,v 1.59 2011/09/18 10:25:28 schwarze Exp $
d21 1
d24 4
@


1.59
log
@sync to version 1.11.5:
adding an implementation of the eqn(7) language
by kristaps@@

So far, only .EQ/.EN blocks are handled, in-line equations are not, and
rendering is not yet very pretty, but the parser is fairly complete.
@
text
@d1 1
a1 1
#	$OpenBSD: Makefile,v 1.58 2011/09/17 14:45:22 schwarze Exp $
d5 1
a5 1
CFLAGS+=-DVERSION=\"1.11.5\"
@


1.58
log
@Initial, incomplete support for -Tman
to convert mdoc(7) documents to the man(7) language.
This is work in progress and will be developed in tree.
It does already handle the cat(1) manual,
but will hardly handle all your fancy manuals yet.
go ahead  kristaps@@ jmc@@ millert@@ deraadt@@
@
text
@d1 1
a1 1
#	$OpenBSD: Makefile,v 1.57 2011/07/31 16:15:40 schwarze Exp $
d5 1
a5 2
VERSION=1.11.4
CFLAGS+=-DVERSION=\"${VERSION}\"
d17 1
a17 1
SRCS+=	main.c mdoc_term.c chars.c term.c tree.c man_term.c
d19 1
a19 1
SRCS+=	html.c mdoc_html.c man_html.c out.c
@


1.57
log
@Actually, by merging individual patches, we are already in sync
with release 1.11.4.  Correct this for release.
@
text
@d1 1
a1 1
#	$OpenBSD: Makefile,v 1.56 2011/05/29 21:22:18 schwarze Exp $
d19 1
@


1.56
log
@Merge release 1.11.3, almost all code by kristaps@@:
* Unicode output support (no Unicode input yet, though).
* Refactoring: completely handle predefined strings in roff.c.
- New function mandoc_escape() replaces a2roffdeco() and mandoc_special().
- Start using mandoc_getarg() in mdoc_argv.c.
- Clean up parsing of delimiters in mdoc(7).
* And many minor fixes and lots of cleanup.
@
text
@d1 1
a1 1
#	$OpenBSD: Makefile,v 1.55 2011/04/24 16:22:02 schwarze Exp $
d5 1
a5 1
VERSION=1.11.3
@


1.55
log
@Merge version 1.11.1:
Again lots of cleanup and maintenance work by kristaps@@.
- simplify error reporting: less function pointers, more mandoc_[v]msg
- main: split document parsing out of main.c into read.c
- roff, mdoc, man: improved recognition of control characters
- roff: better handling of if/else stack overflows
- roff: add some predefined strings for backward compatibility
- mdoc, man: empty sections are not errors
- mdoc: move delimiter handling to libmdoc
- some header restructuring and some minor features and fixes
This merge causes two minor regressions
that i will fix in separate commits right afterwards.
@
text
@d1 1
a1 1
#	$OpenBSD: Makefile,v 1.54 2011/04/21 22:59:54 schwarze Exp $
d5 1
a5 1
VERSION=1.11.1
@


1.54
log
@Merge version 1.10.10:
lots of cleanup and maintenance work by kristaps@@.
- move some main.c globals into struct curparse
- move mandoc_*alloc to mandoc.h such that all code can use them
- make mandoc_isdelim available to formatting frontends
- dissolve mdoc_strings.c, move the code where it is used
- make all error reporting functions void, their return values were useless
- and various minor cleanups and fixes
@
text
@d1 1
a1 1
#	$OpenBSD: Makefile,v 1.53 2011/03/20 23:36:42 schwarze Exp $
d5 1
a5 1
VERSION=1.10.10
d13 1
a13 1
SRCS=	roff.c tbl.c tbl_opts.c tbl_layout.c tbl_data.c eqn.c mandoc.c
d17 1
a17 1
SRCS+=	man_macro.c man.c man_hash.c man_validate.c man_argv.c
@


1.53
log
@Import the foundation for eqn(7) support.
Written by kristaps@@.

For now, i'm adding one line to each of the four frontends
to just pass the input text through to the output,
not yet interpreting any of then eqn keywords.
@
text
@d1 1
a1 1
#	$OpenBSD: Makefile,v 1.52 2011/01/09 14:30:48 schwarze Exp $
d5 1
a5 1
VERSION=1.10.9
d14 1
a14 1
SRCS+=	mdoc_macro.c mdoc.c mdoc_hash.c mdoc_strings.c \
@


1.52
log
@Sync tbl handling to bsd.lv release 1.10.9:
* .T} can be followed by a delimiter, then more data.
* Do not limit table column widths (improves terminfo(5)).
* Let numerical cells respect explicitly specified minimum cell widths.
* Let terminal output survive missing data cells.
* Parse and ignore arguments in parentheses on layout cell specifications.
* Move tbl_calc() into out.c such that it can be used by all frontends.
* Give tables an HTML class.
* Some cleanup in tbl -Thtml code.
All code by kristaps@@.
@
text
@d1 1
a1 1
#	$OpenBSD: Makefile,v 1.51 2011/01/04 22:28:17 schwarze Exp $
d13 1
a13 1
SRCS=	roff.c tbl.c tbl_opts.c tbl_layout.c tbl_data.c mandoc.c
@


1.51
log
@Merge kristaps@@' cleaner tbl integration, removing mine;
there are still a few bugs, but fixing these will be easier in tree.
@
text
@d1 1
a1 1
#	$OpenBSD: Makefile,v 1.50 2010/12/25 13:23:03 schwarze Exp $
d5 1
a5 1
VERSION=1.10.8
@


1.50
log
@Yet another batch of -Thtml polishing from kristaps@@:
In particular, use <SMALL> for .SM and <CODE> for .Dl.
Use <B> for bold and <I> for italic in general.
Also call this mandoc 1.10.8 now, as it is functionally equivalent,
even though one one set of refactoring patches has not been merged
yet because it conflicts with our tbl(1) handling.
@
text
@d1 1
a1 1
#	$OpenBSD: Makefile,v 1.49 2010/12/07 00:08:52 schwarze Exp $
d13 1
a13 1
SRCS=	roff.c mandoc.c
d20 1
a20 2
SRCS+=	term_ps.c term_ascii.c
SRCS+=	tbl.c tbl_data.c tbl_layout.c tbl_option.c tbl_term.c tbl_tree.c
@


1.49
log
@Complete the merge of bsd.lv version 1.10.7:
No more functional changes, just sync ordering, comments and white space.
@
text
@d1 1
a1 1
#	$OpenBSD: Makefile,v 1.48 2010/12/01 23:02:57 schwarze Exp $
d5 1
a5 1
VERSION=1.10.7
@


1.48
log
@Merge man_action.c into man_validate.c.
Same as for mdoc_action.c, but much simpler.
Work by kristaps@@, re-applying OpenBSD changes on top.
@
text
@d1 1
a1 1
#	$OpenBSD: Makefile,v 1.47 2010/12/01 22:02:29 schwarze Exp $
d5 1
a5 1
VERSION=1.10.6
@


1.47
log
@Merge mdoc_action.c into mdoc_validate.c, because having two places to do
basically the same things just causes code duplication and confusion.
Work by kristaps@@, including a few bugfixes he found during the merge,
and reapplying OpenBSD changes on top.
@
text
@d1 1
a1 1
#	$OpenBSD: Makefile,v 1.46 2010/10/15 20:45:03 schwarze Exp $
d17 1
a17 2
SRCS+=	man_macro.c man.c man_hash.c man_validate.c \
	man_action.c man_argv.c
@


1.46
log
@Minimal glue to integrate tbl into the mandoc man(7) parser and formatter.
The output dosn't look nice yet, escape handling is still missing,
but will follow soon.
"move forward aggressively :-)" deraadt@@
@
text
@d1 1
a1 1
#	$OpenBSD: Makefile,v 1.45 2010/09/27 21:25:28 schwarze Exp $
d15 1
a15 1
	mdoc_argv.c mdoc_validate.c mdoc_action.c lib.c att.c \
@


1.45
log
@Merge the last bits of 1.10.6 (released today), most were already in:
* ignore double-.Pp
* ignore .Pp before .Bd and .Bl (unless -compact in specified)
* avoid double blank line upon .Pp, .br and friends in literal context
* cast enums to int when passing them to exit(3) to please lint(1)
While merging, fix a regression introduced by kristaps@@:
Outside literal mode, double blank lines must both be printed.
To achieve this again after kristaps@@ improvements in 1.10.6,
treat such blank lines as .sp (instead of .Pp as in 1.10.5)
and drop .Pp before .sp just like dropping .Pp before .Pp.
@
text
@d1 1
a1 1
#	$OpenBSD: Makefile,v 1.44 2010/07/31 21:43:07 schwarze Exp $
d22 1
@


1.44
log
@Merge bsd.lv version 1.10.5: last larger batch of bug fixes before release.
NOT including Kristaps' .Bd -literal changes which cause regressions.
Features:
* -Tpdf now fully working
Bugfixes:
* proper handling of quoted strings by .ds in roff(7)
* allow empty .Dd
* make .Sm start no-spacing after the first output word
* underline .Ad
* minor fixes in -Thtml
and some optimisations in terminal output.
@
text
@d1 1
a1 1
#	$OpenBSD: Makefile,v 1.43 2010/07/13 01:09:12 schwarze Exp $
d5 1
a5 1
VERSION=1.10.5
@


1.43
log
@Merge release 1.10.4 (all code by kristaps@@), providing four new features:
1) Proper .Bk support: allow output line breaks at input line breaks,
but keep input lines together in the output, finally fixing
synopses like aucat(1), mail(1) and tmux(1).
2) Mostly finished -Tps (PostScript) output.
3) Implement -Thtml output for .Nm blocks and .Bk -words.
4) Allow iterative interpolation of user-defined roff(7) strings.
Also contains some minor bugfixes and some performance improvements.
@
text
@d1 1
a1 1
#	$OpenBSD: Makefile,v 1.42 2010/06/29 15:49:52 schwarze Exp $
d5 1
a5 1
VERSION=1.10.4
@


1.42
log
@sync to bsd.lv version 1.10.3:
* support -Tps -Opaper=a4 and -Opaper=letter
* lots of mandoc.1 manual improvements
@
text
@d1 1
a1 1
#	$OpenBSD: Makefile,v 1.41 2010/06/26 17:56:43 schwarze Exp $
d5 1
a5 1
VERSION=1.10.3
@


1.41
log
@merge release 1.10.2
* bug fixes:
- interaction of ASCII_HYPH with special chars (found by Ulrich Spoerlein)
- handling of roff conditionals (found by Ulrich Spoerlein)
- .Bd -offset will no more default to 6n
* maintenance:
- more caching of .Bd and .Bl arguments for efficiency
- deconstify man(7) validation routines
- add FreeBSD library names (provided by Ulrich Spoerlein)
* start PostScript font-switching
@
text
@d1 1
a1 1
#	$OpenBSD: Makefile,v 1.40 2010/06/10 22:50:10 schwarze Exp $
d5 1
a5 1
VERSION=1.10.2
@


1.40
log
@minimal initial -Tps support, from kristaps@@ GSOC
so far, monospace without font decoration,
but it already has page headers and footers
@
text
@d1 1
a1 1
#	$OpenBSD: Makefile,v 1.39 2010/06/06 20:30:08 schwarze Exp $
d5 1
a5 1
VERSION=1.10.1
@


1.39
log
@Merge bsd.lv version 1.10.1 (to be released soon).

The main step forward is that this now has *much* better .Bl -column
support, now supporting many manuals that previously errored out
without producing any output.

Other fixes include:
* do not die from multiple list types, use the first and warn
* in .Bl without a type, default to -item
* various tweaks to .Dt
* fix .In, .Fd, .Ft, .Fn and .Fo formatting
* some documentation fixes and additions
* and fix a couple of bugs reported by Ulrich Spoerlein:
* better support for roff block-end "\}" without a preceding dot
* .In must not break the line outside SYNOPSIS
* spelling in some error messages

While merging, fix one regression in .In spacing
that needs to go to bsd.lv, too.
@
text
@d1 1
a1 1
#	$OpenBSD: Makefile,v 1.38 2010/06/06 18:08:41 schwarze Exp $
d21 1
@


1.38
log
@Merge bsd.lv release 1.10.0,
which is mostly the post-hackathon release,
bringing in the OpenBSD changes to bsd.lv,
but which also has a few additional minor fixes:

* .Lb is an in-line macro, not in_line_eoln
* .Bt, .Ud now warn when discarding arguments
* allow bad -man dates to flow verbatim into the front-ends
- so far all reported by Ulrich Spoerlein
* .Ar, .Fl and .Li starting with closing punctuation emit an empty element
* empty .Li macros print nothing, but may cause spacing
* proper EOS handling for .Bt, .Ex, .Rv, and .Ud.
* cleanup: collapse posts_xr into posts_wtext (which is the same)
* efficiency: very simple table lookup for roff.c
@
text
@d1 1
a1 1
#	$OpenBSD: Makefile,v 1.37 2010/05/16 00:54:03 schwarze Exp $
d5 1
a5 1
VERSION=1.10.0
@


1.37
log
@In theory, Kristaps never intended to write a roff parser,
but in practice, most real legacy man(7)uals are using so much
low level roff that we can't really get away without at least
partially handling some roff instructions.

As doing this in man(7) only has become messy and as even some
mdoc(7) pages need it, start a minimal partial roff preprocessor.
As a first step, move handling of .am[i], .de[i] and .ig there.
Do not use the roff preprocessor for new manuals!

Now that we have three main parser libraries - roff, man and mdoc -
each one having its own error handling is becoming messy, too.
Thus, start unifying message handling in one central place,
introducing a new generic function mmsg().

coded by kristaps@@
@
text
@d1 1
a1 1
#	$OpenBSD: Makefile,v 1.36 2010/05/14 14:47:44 schwarze Exp $
d5 1
a5 1
VERSION=1.9.25
@


1.36
log
@Merge 1.9.25, keeping local patches;
this does not merge kristaps' end-of-sentences handling yet,
i will check that separately.  This one includes:
* handle \*(Ba as a delimiter
* introduce ARGS_PEND for .Bl -column .It end-of-line special casing
* section ordering: expect EXIT STATUS at the right place
* line break fixes in SYNOPSIS
* allow literal contexts to have arbitrary line lengths
* the input file column number can not be used to identify the beginning
  of a line because white space is allowed after the initial '.'
* proper leading spaces in -man -Tascii mode
* do not let Lb break lines in -mdoc -Thtml LIBRARY
@
text
@d1 1
a1 1
#	$OpenBSD: Makefile,v 1.35 2010/05/14 01:54:37 schwarze Exp $
d13 2
a14 1
SRCS=	mandoc.c mdoc_macro.c mdoc.c mdoc_hash.c mdoc_strings.c \
@


1.35
log
@merge 1.9.24, keeping local patches; some changes:
* preserve multiple consecutive space characters in input
* do not restrict .Cd and .Rv to certain sections (requested by Joerg)
* do not run lookup() on quoted words
* enum return types for mdoc_args and mdoc_argv
* fix auto-closing of LINK tag in -Txhtml (from Daniel Friesel)
* various lint and manual fixes
@
text
@d1 1
a1 1
#	$OpenBSD: Makefile,v 1.34 2010/05/10 18:20:31 drahn Exp $
d5 1
a5 1
VERSION=1.9.24
@


1.34
log
@Switch to using COMPILER_VERSION instead of USE_GCC3, allows for more flexible
complier picking, eg supporting gcc2, gcc3, and gcc4. based on diff by Marco,
with fixes from espie@@.
ok espie@@ general mumbling of approval of others.
@
text
@d1 1
a1 1
#	$OpenBSD: Makefile,v 1.33 2010/04/07 23:15:05 schwarze Exp $
d5 1
a5 1
VERSION=1.9.23
@


1.33
log
@Merge the good parts of 1.9.23,
avoid the bad parts of 1.9.23, and keep local patches.

Input in general:
 * Basic handling of roff-style font escapes \f, \F.
 * Quoted punctuation does not count as punctuation.

mdoc(7) parser:
 * Make .Pf callable; noted by Claus Assmann.
 * Let .Bd and .Bl ignore unknown arguments; noted by deraadt@@.
 * Do not warn when .Er is used outside certain sections.
 * Replace mdoc_node_free[list] by mdoc_node_delete.
 * Replace #define by enum for rew*() return values.

man(7) parser:
 * When .TH is missing, use default section and date.

Output in general:
 * Curly braces do not count as punctuation.
 * No space after .Fl w/o args when a macro follows on the same line.

HTML output:
 * Unify PAIR_*_INIT macros, introduce new PAIR_ID_INIT().
 * Print whitespace after, not before .Vt .Fn .Ft .Fo.

Checked that all manuals in base still build.
@
text
@d1 1
a1 1
#	$OpenBSD: Makefile,v 1.32 2010/04/02 12:39:47 schwarze Exp $
d8 2
a9 1
.if ${USE_GCC3:L} != "no"
@


1.32
log
@merge 1.9.22, keeping local patches
* convert mdoc tokens from #define to enum
* fix a segfault with .Xo/.Xc in explicit blocks
* Thorn is \*(Th, not \*(TH; noticed by Joerg Sonnenberger
@
text
@d1 1
a1 1
#	$OpenBSD: Makefile,v 1.31 2010/04/02 11:37:07 schwarze Exp $
d5 1
a5 1
VERSION=1.9.22
@


1.31
log
@merge 1.9.20, keeping local patches
* prevent roff instructions in man(7) from clobbering scopes and line modes
  (noted by Sascha Wildner)
* handle leading punctuation in mdoc(7) blocks and line macros
  (looks good in principle, but is causing some fallout in OpenBSD,
   so i will disable it locally for now with the next commit)
@
text
@d1 1
a1 1
#	$OpenBSD: Makefile,v 1.30 2010/03/29 22:56:52 schwarze Exp $
d5 1
a5 1
VERSION=1.9.20
@


1.30
log
@merge 1.9.19, keeping local patches
 * scoping fixes for roff instructions
 * accept apostroph in place of dot as a macro control character
 * accept tabs between the control character and the macro name
 * check that man(7) .TH titles use capital letters
@
text
@d1 1
a1 1
#	$OpenBSD: Makefile,v 1.29 2010/03/26 01:22:05 schwarze Exp $
d5 1
a5 1
VERSION=1.9.19
@


1.29
log
@merge 1.9.17, keeping local patches

* much improved pod2man support and low-level roff robustness
* have -Tlint imply -Wall and -fstrict
* use fewer macros and more enum in libman
* and various bug fixes
@
text
@d1 1
a1 1
#	$OpenBSD: Makefile,v 1.28 2010/03/25 23:23:01 schwarze Exp $
d5 1
a5 1
VERSION=1.9.17
@


1.28
log
@merge 1.9.16, keeping local patches

This is mostly cleanup by kristaps@@ after my rather hackish patch
to tolerate the non-text macros .na, .sp, .br in next-line scope;
plus some nesting issues fixed by him, all in man(7).
This survived a full  cd /usr/src; make man.
@
text
@d1 1
a1 1
#	$OpenBSD: Makefile,v 1.27 2010/01/03 23:29:03 schwarze Exp $
d5 1
a5 1
VERSION=1.9.16
@


1.27
log
@This is not intended to document just the mandoc(1) program, but rather
man(7) and mdoc(7) special characters and predefined strings in general;
just as mandoc(1) is not intending to implement new languages,
but provide standard formatting for man(7) and mdoc(7) files,
whatever "standard" may mean in this context (sigh).
So move this to the right place.

noticed by deraadt@@
@
text
@d1 1
a1 1
#	$OpenBSD: Makefile,v 1.26 2010/01/03 19:59:59 schwarze Exp $
d5 1
a5 1
VERSION=1.9.15
@


1.26
log
@Install mandoc_char(7), a comprehensive overview of mandoc(1) special
characters and predefined strings.

In kristaps@@'s words:
"Note that mandoc_char(7) is a superset of the latest groff_char(7)
(which defines most special characters), groff(7) (more special
characters, mostly formatting), and mdoc_samples(7) (predefined
strings and other nits).  Thus, some of the characters that mandoc(1)
accepts are not accepted by the groff in OpenBSD base."

This is useful because you now have everything in one place, and
in a form authoritative for mandoc(1).  At least as long as we still
have groff(1) in base, we must keep groff_char(7) as well, of course.

"sure" jmc@@
@
text
@d1 1
a1 1
#	$OpenBSD: Makefile,v 1.25 2010/01/02 02:42:06 schwarze Exp $
a20 1
MAN=	mandoc.1 mandoc_char.7
@


1.25
log
@complete the sync to 1.9.15-pre2: mostly minor fixes
 * bugfix: do not restore TERMP flags when leaving lists, just reset them
 * and a few HTML fixes
 * clarity: return width from a2width, not width+2, and adapt to it
 * manual: document .Bl and .Fl
 * portability: no need to escape '%' in macro names
@
text
@d1 1
a1 1
#	$OpenBSD: Makefile,v 1.24 2009/12/24 02:08:14 schwarze Exp $
d20 2
a21 1
PROG=	  mandoc
@


1.24
log
@sync to 1.9.14: rewrite escape sequence handling:
- new function a2roffdeco
- font modes (\f) only affect the current stack point
- implement scaling (\s)
- implement space suppression (\c)
- implement non-breaking space (\~) in -Tascii
- many manual improvements
@
text
@d1 1
a1 1
#	$OpenBSD: Makefile,v 1.23 2009/12/23 22:30:17 schwarze Exp $
d5 1
a5 1
VERSION=1.9.14
@


1.23
log
@sync to 1.9.13: minor fixes:

correctness/functionality:
 - bugfix: properly ignore lines with only a dot in -man
 - bugfix: .Bl -ohang doesn't allow -width, warn about this
 - improve date string handling by new function mandoc_a2time
 - some HTML improvements
 - significant documentation additions in man.7 and mdoc.7

portability:
 - replace __dead by __attribute__((noreturn))
 - bugfix: correct .Dx rendering
 - some more library names for NetBSD

simplicity:
 - replace hand-rolled putchar(3)-loops by fwrite(3)
 - replace single-character printf(3) by putchar(3)
@
text
@d1 1
a1 1
#	$OpenBSD: Makefile,v 1.22 2009/12/22 23:58:00 schwarze Exp $
d5 1
a5 1
VERSION=1.9.13
@


1.22
log
@sync to 1.9.12, mostly portability and refactoring:

correctness/functionality:
- bugfix: do not die when overstep hits the right margin
- new option: -fign-escape
- and various HTML features

portability:
- replace bzero(3) by memset(3), which is ANSI C
- replace err(3)/warn(3) by perror(3)/exit(3), which is ANSI C
- iuse argv[0] instead of __progname
- add time.h to various files for FreeBSD compilation

simplicity:
- do not allocate header/footer data dynamically in *_term.c
- provide and use malloc frontends that error out on failure

for full changelogs, see http://bsd.lv/cgi-bin/cvsweb.cgi/
@
text
@d1 1
a1 1
#	$OpenBSD: Makefile,v 1.21 2009/10/27 21:40:07 schwarze Exp $
d5 1
a5 1
VERSION=1.9.12
@


1.21
log
@sync to 1.9.11: adapt printing of dates to groff conventions,
NetBSD portability fixes and some minor bugfixes and feature enhancements;
also checked that my hyphenation code still works on top of this
@
text
@d1 1
a1 1
#	$OpenBSD: Makefile,v 1.20 2009/10/21 19:13:50 schwarze Exp $
d5 1
a5 1
VERSION=1.9.11
@


1.20
log
@sync to 1.9.9, featuring:
 * -Thtml output mode
 * roff scaling units
 * and some minor fixes
for full changelogs, see http://bsd.lv/cgi-bin/cvsweb.cgi/
@
text
@d1 1
a1 1
#	$OpenBSD: Makefile,v 1.19 2009/10/19 09:16:58 schwarze Exp $
d5 1
a5 1
VERSION=1.9.9
@


1.19
log
@sync to 1.9.5: partial rewrite of special character and predefined string
tables and the supporting infrastructure, mostly in preparation for
HTML output support
@
text
@d1 1
a1 1
#	$OpenBSD: Makefile,v 1.18 2009/09/18 22:48:29 schwarze Exp $
d5 1
a5 1
VERSION=1.9.2
d18 1
@


1.18
log
@now in sync with version 1.9.2
@
text
@d1 1
a1 1
#	$OpenBSD: Makefile,v 1.17 2009/08/22 23:17:39 schwarze Exp $
d17 1
a17 1
SRCS+=	main.c mdoc_term.c ascii.c term.c tree.c man_term.c
@


1.17
log
@another large chunk of -man updates,
among others regarding .DT, .HP, .RS, .RE, .SH, .SS, and scoping,
now in sync vith release 1.9.1
@
text
@d1 1
a1 1
#	$OpenBSD: Makefile,v 1.16 2009/08/22 20:14:37 schwarze Exp $
d5 1
a5 1
VERSION=1.9.1
@


1.16
log
@Kristaps@@ significantly overhauled libman.
I'm committing this in one large chunk because in contrast to -mdoc, -man
is mostly untested in OpenBSD anyway, so any fallout can be fixed in-tree.
Among others, improved support for .IP, .HP, and .TP.
Now in sync with release 1.9.0.
@
text
@d1 1
a1 1
#	$OpenBSD: Makefile,v 1.15 2009/08/22 17:23:13 schwarze Exp $
d5 1
a5 1
VERSION=1.9.0
@


1.15
log
@now in sync with 1.8.5 (except for %T underline)
@
text
@d1 1
a1 1
#	$OpenBSD: Makefile,v 1.14 2009/08/22 15:48:21 schwarze Exp $
d5 1
a5 1
VERSION=1.8.5
d15 2
a16 1
SRCS+=	man_macro.c man.c man_hash.c man_validate.c man_action.c
@


1.14
log
@now in sync with 1.8.4
except for the %T underline diff which is still pending (me slacking)
@
text
@d1 1
a1 1
#	$OpenBSD: Makefile,v 1.13 2009/08/09 20:53:16 schwarze Exp $
d5 1
a5 1
VERSION=1.8.4
@


1.13
log
@now in sync with version 1.8.3
excepting one change to .%T that I first want to discuss upstream
@
text
@d1 1
a1 1
#	$OpenBSD: Makefile,v 1.12 2009/08/09 17:52:08 schwarze Exp $
d5 1
a5 1
VERSION=1.8.3
@


1.12
log
@now in sync with release 1.8.2
@
text
@d1 1
a1 1
#	$OpenBSD: Makefile,v 1.11 2009/07/26 23:54:24 schwarze Exp $
d5 1
a5 1
VERSION=1.8.2
@


1.11
log
@now in sync with version 1.8.1
@
text
@d1 1
a1 1
#	$OpenBSD: Makefile,v 1.10 2009/07/18 22:15:04 schwarze Exp $
d5 1
a5 1
VERSION=1.8.1
@


1.10
log
@Kristaps was so happy about .Bl -hang support ("the last major missing
formatting feature") that he bumped the version from 1.7 to 1.8.
We are now in sync with release 1.8.0.
There is lots of work left, though, before we can use this in production...
@
text
@d1 1
a1 1
#	$OpenBSD: Makefile,v 1.9 2009/07/13 00:37:07 schwarze Exp $
d5 1
a5 1
VERSION=1.8.0
@


1.9
log
@now in sync with release 1.7.24
@
text
@d1 1
a1 1
#	$OpenBSD: Makefile,v 1.8 2009/07/12 22:53:55 schwarze Exp $
d5 1
a5 1
VERSION=1.7.24
@


1.8
log
@now in sync with release 1.7.23
@
text
@d1 1
a1 1
#	$OpenBSD: Makefile,v 1.7 2009/07/08 00:04:10 schwarze Exp $
d5 1
a5 1
VERSION=1.7.23
@


1.7
log
@sync to 1.7.21: unified escape sequence validation for mdoc and man
checking is still incomplete, but a bit better, in particular for man
now in sync with 1.7.22: the only 1.7.22 diff was already in
@
text
@d1 1
a1 1
#	$OpenBSD: Makefile,v 1.6 2009/06/27 13:28:08 schwarze Exp $
d5 1
a5 1
VERSION=1.7.22
@


1.6
log
@Now in sync with 1.7.20, except that a few patches looking incorrect
have not been merged but instead reported upstream, and a few additional
patches approved upstream have already been merged.
@
text
@d1 1
a1 1
#	$OpenBSD: Makefile,v 1.5 2009/06/21 20:52:39 schwarze Exp $
d5 1
a5 1
VERSION=1.7.20
d12 1
a12 1
SRCS=	mdoc_macro.c mdoc.c mdoc_hash.c mdoc_strings.c \
@


1.5
log
@now in sync with release 1.7.19
@
text
@d1 1
a1 1
#	$OpenBSD: Makefile,v 1.4 2009/06/18 22:16:56 schwarze Exp $
d5 1
a5 1
VERSION=1.7.19
@


1.4
log
@complete sync to 1.7.17: garbage collect unused functions
mdoc_msg, mdoc_pmsg, mdoc_vmsg, and mdoc_nwarn
@
text
@d1 1
a1 1
#	$OpenBSD: Makefile,v 1.3 2009/06/14 23:39:43 schwarze Exp $
d5 1
a5 1
VERSION=1.7.17
@


1.3
log
@sync to 1.7.16: support -V command line option
@
text
@d1 1
a1 1
#	$OpenBSD: Makefile,v 1.2 2009/04/15 20:10:20 miod Exp $
d5 1
a5 1
VERSION=1.7.16
@


1.2
log
@Replace variadic macros with real functions, so that this compiles on
platforms still using gcc 2.
ok deraadt@@
@
text
@d1 1
a1 1
#	$OpenBSD: Makefile,v 1.1 2009/04/06 20:30:40 kristaps Exp $
d5 2
@


1.1
log
@Initial check-in of mandoc for formatting manuals. ok deraadt@@
@
text
@d1 1
a1 1
#	$OpenBSD$
d3 6
a8 1
CFLAGS+=-W -Wall -Wstrict-prototypes -Wno-unused-parameter
@

