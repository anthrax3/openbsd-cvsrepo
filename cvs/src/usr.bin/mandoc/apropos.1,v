head	1.36;
access;
symbols
	OPENBSD_6_0:1.31.0.6
	OPENBSD_6_0_BASE:1.31
	OPENBSD_5_9:1.31.0.2
	OPENBSD_5_9_BASE:1.31
	OPENBSD_5_8:1.31.0.4
	OPENBSD_5_8_BASE:1.31
	OPENBSD_5_7:1.29.0.2
	OPENBSD_5_7_BASE:1.29
	OPENBSD_5_6:1.24.0.4
	OPENBSD_5_6_BASE:1.24
	OPENBSD_5_5:1.18.0.6
	OPENBSD_5_5_BASE:1.18
	OPENBSD_5_4:1.18.0.2
	OPENBSD_5_4_BASE:1.18
	OPENBSD_5_3:1.17.0.6
	OPENBSD_5_3_BASE:1.17
	OPENBSD_5_2:1.17.0.4
	OPENBSD_5_2_BASE:1.17
	OPENBSD_5_1_BASE:1.17
	OPENBSD_5_1:1.17.0.2;
locks; strict;
comment	@.\" @;


1.36
date	2017.03.27.14.39.56;	author schwarze;	state Exp;
branches;
next	1.35;
commitid	p0lCaWItBdLEVQPl;

1.35
date	2017.03.25.12.46.34;	author schwarze;	state Exp;
branches;
next	1.34;
commitid	oJudDJByBJcue6qK;

1.34
date	2017.03.18.19.50.58;	author schwarze;	state Exp;
branches;
next	1.33;
commitid	0QxAquELPZ9V1aPr;

1.33
date	2017.03.17.17.24.26;	author schwarze;	state Exp;
branches;
next	1.32;
commitid	KwUZxAILUmPjslUk;

1.32
date	2017.01.31.19.43.23;	author schwarze;	state Exp;
branches;
next	1.31;
commitid	b8BS30do8KRqWpFC;

1.31
date	2015.04.03.08.45.27;	author schwarze;	state Exp;
branches;
next	1.30;
commitid	kemTcQbhPNWTnazN;

1.30
date	2015.03.29.21.12.00;	author bentley;	state Exp;
branches;
next	1.29;
commitid	kvreILdjfOFt57KH;

1.29
date	2015.02.16.16.18.02;	author schwarze;	state Exp;
branches;
next	1.28;
commitid	Za7hVfBo928Vx64a;

1.28
date	2014.10.30.00.05.02;	author schwarze;	state Exp;
branches;
next	1.27;
commitid	dxVoXRJjO1zZjAXI;

1.27
date	2014.09.03.05.17.08;	author schwarze;	state Exp;
branches;
next	1.26;
commitid	D4HCUw9YYVx6NSQl;

1.26
date	2014.08.30.18.04.52;	author schwarze;	state Exp;
branches;
next	1.25;
commitid	YrTLlLm4kYlZaLCQ;

1.25
date	2014.08.27.00.06.08;	author schwarze;	state Exp;
branches;
next	1.24;
commitid	52PkSro00emV8qcw;

1.24
date	2014.04.24.00.28.02;	author schwarze;	state Exp;
branches;
next	1.23;

1.23
date	2014.04.18.09.46.41;	author schwarze;	state Exp;
branches;
next	1.22;

1.22
date	2014.04.15.23.01.34;	author schwarze;	state Exp;
branches;
next	1.21;

1.21
date	2014.04.04.15.55.17;	author schwarze;	state Exp;
branches;
next	1.20;

1.20
date	2014.03.17.11.29.11;	author schwarze;	state Exp;
branches;
next	1.19;

1.19
date	2014.03.17.09.25.39;	author schwarze;	state Exp;
branches;
next	1.18;

1.18
date	2013.07.13.19.27.46;	author schwarze;	state Exp;
branches;
next	1.17;

1.17
date	2012.01.14.23.31.33;	author schwarze;	state Exp;
branches;
next	1.16;

1.16
date	2012.01.10.09.45.13;	author schwarze;	state Exp;
branches;
next	1.15;

1.15
date	2012.01.09.01.59.08;	author schwarze;	state Exp;
branches;
next	1.14;

1.14
date	2012.01.05.22.15.17;	author schwarze;	state Exp;
branches;
next	1.13;

1.13
date	2011.12.26.12.45.58;	author schwarze;	state Exp;
branches;
next	1.12;

1.12
date	2011.12.25.20.15.54;	author schwarze;	state Exp;
branches;
next	1.11;

1.11
date	2011.12.25.16.52.55;	author schwarze;	state Exp;
branches;
next	1.10;

1.10
date	2011.12.24.21.51.40;	author schwarze;	state Exp;
branches;
next	1.9;

1.9
date	2011.12.12.01.59.13;	author schwarze;	state Exp;
branches;
next	1.8;

1.8
date	2011.11.29.22.30.56;	author schwarze;	state Exp;
branches;
next	1.7;

1.7
date	2011.11.29.01.07.30;	author schwarze;	state Exp;
branches;
next	1.6;

1.6
date	2011.11.26.16.41.35;	author schwarze;	state Exp;
branches;
next	1.5;

1.5
date	2011.11.26.13.07.15;	author schwarze;	state Exp;
branches;
next	1.4;

1.4
date	2011.11.18.01.10.03;	author schwarze;	state Exp;
branches;
next	1.3;

1.3
date	2011.11.13.09.58.21;	author schwarze;	state Exp;
branches;
next	1.2;

1.2
date	2011.10.09.17.59.56;	author schwarze;	state Exp;
branches;
next	1.1;

1.1
date	2011.10.06.23.04.16;	author schwarze;	state Exp;
branches;
next	;


desc
@@


1.36
log
@Simplify: mention at one place that -fkl override each other,
rather than stating it separately for each option.
Suggested, OKed, and tweaked by jmc@@.
@
text
@.\"	$OpenBSD: apropos.1,v 1.35 2017/03/25 12:46:34 schwarze Exp $
.\"
.\" Copyright (c) 2011, 2012 Kristaps Dzonsons <kristaps@@bsd.lv>
.\" Copyright (c) 2011, 2012, 2014, 2017 Ingo Schwarze <schwarze@@openbsd.org>
.\"
.\" Permission to use, copy, modify, and distribute this software for any
.\" purpose with or without fee is hereby granted, provided that the above
.\" copyright notice and this permission notice appear in all copies.
.\"
.\" THE SOFTWARE IS PROVIDED "AS IS" AND THE AUTHOR DISCLAIMS ALL WARRANTIES
.\" WITH REGARD TO THIS SOFTWARE INCLUDING ALL IMPLIED WARRANTIES OF
.\" MERCHANTABILITY AND FITNESS. IN NO EVENT SHALL THE AUTHOR BE LIABLE FOR
.\" ANY SPECIAL, DIRECT, INDIRECT, OR CONSEQUENTIAL DAMAGES OR ANY DAMAGES
.\" WHATSOEVER RESULTING FROM LOSS OF USE, DATA OR PROFITS, WHETHER IN AN
.\" ACTION OF CONTRACT, NEGLIGENCE OR OTHER TORTIOUS ACTION, ARISING OUT OF
.\" OR IN CONNECTION WITH THE USE OR PERFORMANCE OF THIS SOFTWARE.
.\"
.Dd $Mdocdate: March 25 2017 $
.Dt APROPOS 1
.Os
.Sh NAME
.Nm apropos ,
.Nm whatis
.Nd search manual page databases
.Sh SYNOPSIS
.Nm
.Op Fl acfhklw
.Op Fl C Ar file
.Op Fl M Ar path
.Op Fl m Ar path
.Op Fl O Ar outkey
.Op Fl S Ar arch
.Op Fl s Ar section
.Ar expression ...
.Sh DESCRIPTION
The
.Nm apropos
and
.Nm whatis
utilities query manual page databases generated by
.Xr makewhatis 8 ,
evaluating
.Ar expression
for each file in each database.
By default, they display the names, section numbers, and description lines
of all matching manuals.
.Pp
By default,
.Nm
searches for
.Xr makewhatis 8
databases in the default paths stipulated by
.Xr man 1
and uses case-insensitive substring matching
.Pq the Cm = No operator
over manual names and descriptions
.Pq the Li \&Nm No and Li \&Nd No macro keys .
Multiple terms imply pairwise
.Fl o .
.Pp
.Nm whatis
is a synonym for
.Nm
.Fl f .
.Pp
The options are as follows:
.Bl -tag -width Ds
.It Fl a
Instead of showing only the title lines, show the complete manual pages,
just like
.Xr man 1
.Fl a
would.
If the standard output is a terminal device and
.Fl c
is not specified, use
.Xr more 1
to paginate them.
In
.Fl a
mode, the options
.Fl IKOTW
described in the
.Xr mandoc 1
manual are also available.
.It Fl C Ar file
Specify an alternative configuration
.Ar file
in
.Xr man.conf 5
format.
.It Fl f
Search for all words in
.Ar expression
in manual page names only.
The search is case insensitive and matches whole words only.
In this mode, macro keys, comparison operators, and logical operators
are not available.
.It Fl k
Support the full
.Ar expression
syntax.
It is the default for
.Nm .
.It Fl M Ar path
Use the colon-separated path instead of the default list of paths
searched for
.Xr makewhatis 8
databases.
Invalid paths, or paths without manual databases, are ignored.
.It Fl m Ar path
Prepend the colon-separated paths to the list of paths searched
for
.Xr makewhatis 8
databases.
Invalid paths, or paths without manual databases, are ignored.
.It Fl O Ar outkey
Show the values associated with the key
.Ar outkey
instead of the manual descriptions.
.It Fl S Ar arch
Restrict the search to pages for the specified
.Xr machine 1
architecture.
.Ar arch
is case insensitive.
By default, pages for all architectures are shown.
.It Fl s Ar section
Restrict the search to the specified section of the manual.
By default, pages from all sections are shown.
See
.Xr man 1
for a listing of sections.
.El
.Pp
The options
.Fl chlw
are also supported and are documented in
.Xr man 1 .
The options
.Fl fkl
are mutually exclusive and override each other.
.Pp
An
.Ar expression
consists of search terms joined by logical operators
.Fl a
.Pq and
and
.Fl o
.Pq or .
The
.Fl a
operator has precedence over
.Fl o
and both are evaluated left-to-right.
.Bl -tag -width Ds
.It \&( Ar expr No \&)
True if the subexpression
.Ar expr
is true.
.It Ar expr1 Fl a Ar expr2
True if both
.Ar expr1
and
.Ar expr2
are true (logical
.Sq and ) .
.It Ar expr1 Oo Fl o Oc Ar expr2
True if
.Ar expr1
and/or
.Ar expr2
evaluate to true (logical
.Sq or ) .
.It Ar term
True if
.Ar term
is satisfied.
This has syntax
.Sm off
.Oo
.Op Ar key Op , Ar key ...
.Pq Cm = | \(ti
.Oc
.Ar val ,
.Sm on
where
.Ar key
is an
.Xr mdoc 7
macro to query and
.Ar val
is its value.
See
.Sx Macro Keys
for a list of available keys.
Operator
.Cm =
evaluates a substring, while
.Cm \(ti
evaluates a regular expression.
.It Fl i Ar term
If
.Ar term
is a regular expression, it
is evaluated case-insensitively.
Has no effect on substring terms.
.El
.Pp
Results are sorted according to the following criteria:
.Bl -enum
.It
The manpath directory tree the page is found in, according to the
order specified with
.Fl M ,
.Fl m ,
the
.Ev MANPATH
environment variable, the
.Xr man.conf 5
configuration file, or the default documented in
.Xr man.conf 5 .
.It
The section number in ascending numerical order.
.It
The page name in ascending
.Xr ascii 7
alphabetical order, case-insensitive.
.El
.Pp
Each output line is formatted as
.Pp
.D1 name[, name...](sec) \- description
.Pp
Where
.Dq name
is the manual's name,
.Dq sec
is the manual section, and
.Dq description
is the manual's short description.
If an architecture is specified for the manual, it is displayed as
.Pp
.D1 name(sec/arch) \- description
.Pp
Resulting manuals may be accessed as
.Pp
.Dl $ man \-s sec name
.Pp
If an architecture is specified in the output, use
.Pp
.Dl $ man \-s sec \-S arch name
.Ss Macro Keys
Queries evaluate over a subset of
.Xr mdoc 7
macros indexed by
.Xr makewhatis 8 .
In addition to the macro keys listed below, the special key
.Cm any
may be used to match any available macro key.
.Pp
Names and description:
.Bl -column "xLix" description -offset indent -compact
.It Li \&Nm Ta manual name
.It Li \&Nd Ta one-line manual description
.It Li arch Ta machine architecture (case-insensitive)
.It Li sec  Ta manual section number
.El
.Pp
Sections and cross references:
.Bl -column "xLix" description -offset indent -compact
.It Li \&Sh Ta section header (excluding standard sections)
.It Li \&Ss Ta subsection header
.It Li \&Xr Ta cross reference to another manual page
.It Li \&Rs Ta bibliographic reference
.El
.Pp
Semantic markup for command line utilities:
.Bl -column "xLix" description -offset indent -compact
.It Li \&Fl Ta command line options (flags)
.It Li \&Cm Ta command modifier
.It Li \&Ar Ta command argument
.It Li \&Ic Ta internal or interactive command
.It Li \&Ev Ta environmental variable
.It Li \&Pa Ta file system path
.El
.Pp
Semantic markup for function libraries:
.Bl -column "xLix" description -offset indent -compact
.It Li \&Lb Ta function library name
.It Li \&In Ta include file
.It Li \&Ft Ta function return type
.It Li \&Fn Ta function name
.It Li \&Fa Ta function argument type and name
.It Li \&Vt Ta variable type
.It Li \&Va Ta variable name
.It Li \&Dv Ta defined variable or preprocessor constant
.It Li \&Er Ta error constant
.It Li \&Ev Ta environmental variable
.El
.Pp
Various semantic markup:
.Bl -column "xLix" description -offset indent -compact
.It Li \&An Ta author name
.It Li \&Lk Ta hyperlink
.It Li \&Mt Ta Do mailto Dc hyperlink
.It Li \&Cd Ta kernel configuration declaration
.It Li \&Ms Ta mathematical symbol
.It Li \&Tn Ta tradename
.El
.Pp
Physical markup:
.Bl -column "xLix" description -offset indent -compact
.It Li \&Em Ta italic font or underline
.It Li \&Sy Ta boldface font
.It Li \&Li Ta typewriter font
.El
.Pp
Text production:
.Bl -column "xLix" description -offset indent -compact
.It Li \&St Ta reference to a standards document
.It Li \&At Ta At No version reference
.It Li \&Bx Ta Bx No version reference
.It Li \&Bsx Ta Bsx No version reference
.It Li \&Nx Ta Nx No version reference
.It Li \&Fx Ta Fx No version reference
.It Li \&Ox Ta Ox No version reference
.It Li \&Dx Ta Dx No version reference
.El
.Sh ENVIRONMENT
.Bl -tag -width MANPAGER
.It Ev MANPAGER
Any non-empty value of the environment variable
.Ev MANPAGER
is used instead of the standard pagination program,
.Xr more 1 ;
see
.Xr man 1
for details.
Only used if
.Fl a
or
.Fl l
is specified.
.It Ev MANPATH
A colon-separated list of directories to search for manual pages; see
.Xr man 1
for details.
Overridden by
.Fl M ,
ignored if
.Fl l
is specified.
.It Ev PAGER
Specifies the pagination program to use when
.Ev MANPAGER
is not defined.
If neither PAGER nor MANPAGER is defined,
.Xr more 1
.Fl s
is used.
Only used if
.Fl a
or
.Fl l
is specified.
.El
.Sh FILES
.Bl -tag -width "/etc/man.conf" -compact
.It Pa mandoc.db
name of the
.Xr makewhatis 8
keyword database
.It Pa /etc/man.conf
default
.Xr man 1
configuration file
.El
.Sh EXIT STATUS
.Ex -std
.Sh EXAMPLES
Search for
.Qq .cf
as a substring of manual names and descriptions:
.Pp
.Dl $ apropos .cf
.Pp
Include matches for
.Qq .cnf
and
.Qq .conf
as well:
.Pp
.Dl $ apropos .cf .cnf .conf
.Pp
Search in names and descriptions using a regular expression:
.Pp
.Dl $ apropos \(aq\(tiset.?[ug]id\(aq
.Pp
Search for manuals in the library section mentioning both the
.Qq optind
and the
.Qq optarg
variables:
.Pp
.Dl $ apropos \-s 3 Va=optind \-a Va=optarg
.Pp
Do exactly the same as calling
.Xr whatis 1
with the argument
.Qq ssh :
.Pp
.Dl $ apropos \-\- \-i \(aqNm\(ti[[:<:]]ssh[[:>:]]\(aq
.Pp
The following two invocations are equivalent:
.Pp
.D1 Li $ apropos -S Ar arch Li -s Ar section expression
.Bd -ragged -offset indent
.Li $ apropos \e( Ar expression Li \e)
.Li -a arch\(ti^( Ns Ar arch Ns Li |any)$
.Li -a sec\(ti^ Ns Ar section Ns Li $
.Ed
.Sh SEE ALSO
.Xr man 1 ,
.Xr re_format 7 ,
.Xr makewhatis 8
.Sh HISTORY
Part of the functionality of
.Nm whatis
was already provided by the former
.Nm manwhere
utility in
.Bx 1 .
The
.Nm
and
.Nm whatis
utilities first appeared in
.Bx 2 .
They were rewritten from scratch for
.Ox 5.6 .
.Pp
The
.Fl M
option and the
.Ev MANPATH
variable first appeared in
.Bx 4.3 ;
.Fl m
in
.Bx 4.3 Reno ;
.Fl C
in
.Bx 4.4 Lite1 ;
and
.Fl S
and
.Fl s
in
.Ox 4.5
for
.Nm
and in
.Ox 5.6
for
.Nm whatis .
The options
.Fl acfhIKklOTWw
appeared in
.Ox 5.7 .
.Sh AUTHORS
.An -nosplit
.An Bill Joy
wrote
.Nm manwhere
in 1977 and the original
.Bx
.Nm
and
.Nm whatis
in February 1979.
The current version was written by
.An Kristaps Dzonsons Aq Mt kristaps@@bsd.lv
and
.An Ingo Schwarze Aq Mt schwarze@@openbsd.org .
@


1.35
log
@For some options that are rarely needed in apropos(1) and man(1),
delete the verbose descriptions and point to man(1) and mandoc(1),
respectively, instead.  That shortens the pages and makes them
easier to read.
Tweaks and OK jmc@@, based in part on ideas from tedu@@.
@
text
@d1 1
a1 1
.\"	$OpenBSD: apropos.1,v 1.34 2017/03/18 19:50:58 schwarze Exp $
d18 1
a18 1
.Dd $Mdocdate: March 18 2017 $
a98 5
This overrides any earlier
.Fl k
and
.Fl l
options.
a102 5
This overrides any earlier
.Fl f
and
.Fl l
options.
d140 3
@


1.34
log
@Correct description of MANPATH, and a few more improvements
to the ENVIRONMENT section; OK jmc@@
@
text
@d1 1
a1 1
.\"	$OpenBSD: apropos.1,v 1.33 2017/03/17 17:24:26 schwarze Exp $
d18 1
a18 1
.Dd $Mdocdate: March 17 2017 $
a91 6
.It Fl c
In
.Fl a
mode, copy the formatted manual pages to the standard output without using
.Xr more 1
to paginate them.
a103 5
.It Fl h
Instead of showing the title lines, show the SYNOPSIS sections, just like
.Xr man 1
.Fl h
would.
a114 10
.It Fl l
An alias for
.Xr mandoc 1
.Fl a .
This overrides any earlier
.Fl f ,
.Fl k ,
and
.Fl w
options.
a143 6
.It Fl w
Instead of showing title lines, show the pathnames of the matching
manual pages, just like
.Xr man 1
.Fl w
would.
d145 5
@


1.33
log
@Document man(1) section selection priority,
and correct description of apropos(1) output search order.
Suggested by tb@@.
@
text
@d1 1
a1 1
.\"	$OpenBSD: apropos.1,v 1.32 2017/01/31 19:43:23 schwarze Exp $
d18 1
a18 1
.Dd $Mdocdate: January 31 2017 $
d365 10
a374 2
will be used instead of the standard pagination program,
.Xr more 1 .
d376 1
a376 1
The standard search path used by
d378 1
a378 4
may be changed by specifying a path in the
.Ev MANPATH
environment variable.
Invalid paths, or paths without manual databases, are ignored.
d380 4
a383 9
.Fl M .
If
.Ev MANPATH
begins with a colon, it is appended to the default list;
if it ends with a colon, it is prepended to the default list;
or if it contains two adjacent colons,
the standard search path is inserted between the colons.
If none of these conditions are met, it overrides the
standard search path.
d391 6
a396 1
will be used.
@


1.32
log
@add missing HISTORY information
@
text
@d1 1
a1 1
.\"	$OpenBSD: apropos.1,v 1.31 2015/04/03 08:45:27 schwarze Exp $
d4 1
a4 1
.\" Copyright (c) 2011, 2012, 2014 Ingo Schwarze <schwarze@@openbsd.org>
d18 1
a18 1
.Dd $Mdocdate: April 3 2015 $
d240 22
a261 1
Results are sorted by manual sections and names, with output formatted as
@


1.31
log
@No need to hardcode /usr/bin/ as the path to more(1); helps portability.
We don't hardcode the paths to gunzip(1) and cmp(1) either.
Discussed with ajacoutot@@.
@
text
@d1 1
a1 1
.\"	$OpenBSD: apropos.1,v 1.30 2015/03/29 21:12:00 bentley Exp $
d18 1
a18 1
.Dd $Mdocdate: March 29 2015 $
d471 4
@


1.30
log
@Escape punctuation characters that have a different meaning in -Tpdf.

~, `, and ' get translated to non-ASCII characters by most troff
implementations when generating PostScript/PDF output. When the original
ASCII character is meant, it needs to be manually escaped.

discussed with jmc@@ schwarze@@; ok schwarze@@
@
text
@d1 1
a1 1
.\"	$OpenBSD: apropos.1,v 1.29 2015/02/16 16:18:02 schwarze Exp $
d18 1
a18 1
.Dd $Mdocdate: February 16 2015 $
d368 2
a369 1
.Pa /usr/bin/more Fl s
@


1.29
log
@Delete the -V option.  It serves no purpose but keeps confusing people.
@
text
@d1 1
a1 1
.\"	$OpenBSD: apropos.1,v 1.28 2014/10/30 00:05:02 schwarze Exp $
d18 1
a18 1
.Dd $Mdocdate: October 30 2014 $
d213 1
a213 1
.Pq Cm = | ~
d230 1
a230 1
.Cm ~
d401 1
a401 1
.Dl $ apropos '~set.?[ug]id'
d416 1
a416 1
.Dl $ apropos \-\- \-i 'Nm~[[:<:]]ssh[[:>:]]'
d423 2
a424 2
.Li -a arch~^( Ns Ar arch Ns Li |any)$
.Li -a sec~^ Ns Ar section Ns Li $
@


1.28
log
@support UTF-8 and ISO-8859-1 input by integrating modified parts
of kristaps@@' version of the preconv(1) utility into mandoc(1);
positive feedback from bentley@@ and no concern raised when shown on tech@@
@
text
@d1 1
a1 1
.\"	$OpenBSD: apropos.1,v 1.27 2014/09/03 05:17:08 schwarze Exp $
d18 1
a18 1
.Dd $Mdocdate: September 3 2014 $
d27 1
a27 1
.Op Fl acfhklVw
a164 2
.It Fl V
Print version and exit.
@


1.27
log
@Implement the traditional -h option for man(1): show the SYNOPSIS only.
As usual, we get mandoc -h and apropos -h for free.
Try stuff like "apropos -h In=dirent" or "apropos -h Fa=timespec".

Only useful for terminal output, so -Tps, -Tpdf, -Thtml ignore -h for now.
@
text
@d1 1
a1 1
.\"	$OpenBSD$
d18 1
a18 1
.Dd $Mdocdate: August 30 2014 $
d82 1
a82 1
.Fl IOTW
@


1.26
log
@Introduce a man(1) -l option as an alias for mandoc -a.
Basically, this does the same as man -l in Linux man-db.
The point is that now all functionality of the combined tool
is reachable from the man(1) command name:
apropos = man -k, whatis = man -f, mandoc = man -cl.

Originally suggested by Carsten dot Kunze at arcor dot de,
current maintainer of the Heirloom Documentation Tools.

While here, add various missing information to the usage()
and to the manuals.
@
text
@d1 1
a1 1
.\"	$Id: apropos.1,v 1.25 2014/08/27 00:06:08 schwarze Exp $
d18 1
a18 1
.Dd $Mdocdate: August 27 2014 $
d27 1
a27 1
.Op Fl acfklVw
d110 5
@


1.25
log
@Add an implementation of man(1) into the /usr/bin/mandoc binary and
provide a unified set of command line options for mandoc(1), man(1),
apropos(1), and whatis(1), each option doing the same for all four.
Not adding any completely new options, only extending exiting ones
from one tool to the others.  New options are:
* apropos & whatis -acfkw  (in the past, these were man(1) only)
* apropos & whatis -a -IOTW  (in the past, mandoc(1) only)
* mandoc -ac  (in the past, man(1) only)
* man -IOTW  (in the past, mandoc(1) only)

Before we can decide whether or not we want to replace src/usr.bin/man
with this implementation, considerable bugfixing, testing, and
performance measurements are needed, which i'd rather do in the tree
than outside.  Note that these bugs only affect the new man(1) mode,
existing mandoc(1), apropos(1), and whatis(1) is fine.

The new functionality in mandoc(1), apropos(1), and whatis(1)
is fully enabled.  To play with the new man(1), you can try:
# mv /usr/bin/man /usr/bin/oman
# ln -s /usr/bin/mandoc /usr/bin/man

Positive feedback about the general direction from sthen@@ and jmc@@,
and deraadt@@ is not against it.
@
text
@d1 1
a1 1
.\"	$Id: apropos.1,v 1.24 2014/04/24 00:28:02 schwarze Exp $
d18 1
a18 1
.Dd $Mdocdate: April 24 2014 $
d27 1
a27 1
.Op Fl acfkw
d107 3
a109 1
option.
d116 3
a118 1
option.
d121 10
d160 2
@


1.24
log
@misplaced punctuation
@
text
@d1 1
a1 1
.\"	$Id: apropos.1,v 1.23 2014/04/18 09:46:41 schwarze Exp $
d3 1
a3 1
.\" Copyright (c) 2011 Kristaps Dzonsons <kristaps@@bsd.lv>
d18 1
a18 1
.Dd $Mdocdate: April 18 2014 $
d22 2
a23 1
.Nm apropos
d27 1
d37 4
a40 2
.Nm
utility queries manual page databases generated by
d45 1
a45 1
By default, it displays the names, section numbers, and description lines
d61 6
a66 1
Its arguments are as follows:
d68 18
d92 25
d146 6
d321 6
a326 1
.Bl -tag -width MANPATH
d344 7
d412 7
a418 1
An
d420 3
a422 1
utility first appeared in
d424 1
a424 1
It was rewritten from scratch for
d444 7
a450 1
.Ox 4.5 .
d454 3
a456 1
wrote the original
d459 2
@


1.23
log
@Fix a few lies; polish wording and formatting while here.
@
text
@d1 1
a1 1
.\"	$Id: apropos.1,v 1.22 2014/04/15 23:01:34 schwarze Exp $
d18 1
a18 1
.Dd $Mdocdate: April 15 2014 $
d138 2
a139 2
.Ar val
.Sm on ,
@


1.22
log
@remove documentation of the former macro key "NAME";
it got deleted with mansearch.h rev. 1.8
@
text
@d1 1
a1 1
.\"	$Id: apropos.1,v 1.21 2014/04/04 15:55:17 schwarze Exp $
d18 1
a18 1
.Dd $Mdocdate: April 4 2014 $
d38 1
a38 1
evaluating on
d41 2
d49 3
a51 3
.Xr man 1 ,
parses terms as case-sensitive regular expressions
.Pq the Li \&~ operator
d120 1
a120 1
.Qq and ) .
d127 1
a127 1
.Qq or ) .
d133 9
a141 3
.Li [key[,key]*(=~)]?val ,
where operand
.Cm key
d145 1
a145 1
.Cm val
d151 1
a151 1
.Li \&=
d153 1
a153 1
.Li \&~
d163 1
a163 1
Results are sorted by manual title, with output formatted as
d165 1
a165 1
.D1 title(sec) \- description
d168 3
a170 4
.Qq title
is the manual's title (note multiple manual names may exist for one
title),
.Qq sec
d172 1
a172 1
.Qq description
d176 1
a176 1
.D1 title(cat/arch) \- description
d180 1
a180 1
.Dl $ man \-s sec title
d184 1
a184 1
.Dl $ man \-s sec \-S arch title
d314 1
a314 1
Search for manuals in the library category mentioning both the
@


1.21
log
@Remember which names are in the NAME section.
This helps to find missing MLINKS.
Database build times do not change and database growth is minimal
(1.2% with -Q, 0.7% without -Q in /usr/share/man),
so making this optional would be pointless.
@
text
@d1 1
a1 1
.\"	$Id: apropos.1,v 1.20 2014/03/17 11:29:11 schwarze Exp $
d18 1
a18 1
.Dd $Mdocdate: March 17 2014 $
a188 1
.It Li NAME Ta manual name in the NAME section, subset of \&Nm
@


1.20
log
@describe new features
@
text
@d1 1
a1 1
.\"	$Id: apropos.1,v 1.19 2014/03/17 09:25:39 schwarze Exp $
d3 2
a4 1
.\" Copyright (c) 2011, 2012 Kristaps Dzonsons <kristaps@@bsd.lv>
d189 1
@


1.19
log
@remove Berkeley DB parts
@
text
@d1 1
a1 1
.\"	$Id: apropos.1,v 1.18 2013/07/13 19:27:46 schwarze Exp $
d17 1
a17 1
.Dd $Mdocdate: July 13 2013 $
d28 1
d74 4
d190 2
d320 9
d339 1
a339 1
.Ox 5.1 .
d367 3
a369 1
.An Kristaps Dzonsons Aq Mt kristaps@@bsd.lv .
@


1.18
log
@For citing the names and email addresses of authors,
consistently use the style ".An name Aq Mt email".

Triggered by a question from Jan Stary <hans at stare dot cz>,
ok jmc@@.
@
text
@d1 1
a1 1
.\"	$Id: apropos.1,v 1.17 2012/01/14 23:31:33 schwarze Exp $
d3 1
a3 1
.\" Copyright (c) 2011 Kristaps Dzonsons <kristaps@@bsd.lv>
d17 1
a17 1
.Dd $Mdocdate: January 14 2012 $
a272 4
.It Pa mandoc.index
name of the
.Xr makewhatis 8
filename database
@


1.17
log
@add/fix HISTORY and AUTHORS
@
text
@d1 1
a1 1
.\"	$Id: apropos.1,v 1.16 2012/01/10 09:45:13 schwarze Exp $
d17 1
a17 1
.Dd $Mdocdate: January 10 2012 $
d355 1
a355 2
.An Kristaps Dzonsons ,
.Mt kristaps@@bsd.lv .
@


1.16
log
@Continue using the traditional name makewhatis(8),
do not rename to mandocdb(8):  Even though there is some
additional functionality, the basic purpose remains the same.
Requested by espie@@; "decide fast" deraadt@@.
@
text
@d1 1
a1 1
.\"	$Id: apropos.1,v 1.15 2012/01/09 01:59:08 schwarze Exp $
d17 1
a17 1
.Dd $Mdocdate: January 9 2012 $
d321 26
d348 4
a351 1
The
d353 2
a354 1
utility was written by
@


1.15
log
@Rename whatis.{db,index} back to mandoc.{db,index}
such that makewhatis(8) called from pkg_delete(1)
does not fail trying to open old-style whatis.db files as btree(3).
Suggested by espie@@ deraadt@@ millert@@
@
text
@d1 1
a1 1
.\"	$Id: apropos.1,v 1.14 2012/01/05 22:15:17 schwarze Exp $
d17 1
a17 1
.Dd $Mdocdate: January 5 2012 $
d35 1
a35 1
.Xr mandocdb 8 ,
d43 1
a43 1
.Xr mandocdb 8
d64 1
a64 1
.Xr mandocdb 8
d70 1
a70 1
.Xr mandocdb 8
d176 1
a176 1
.Xr mandocdb 8 .
d271 1
a271 1
.Xr mandocdb 8
d275 1
a275 1
.Xr mandocdb 8
d320 1
a320 1
.Xr mandocdb 8
@


1.14
log
@improve EXAMPLES; feedback and ok jmc@@
@
text
@d1 1
a1 1
.\"	$Id: apropos.1,v 1.13 2011/12/26 12:45:58 schwarze Exp $
d17 1
a17 1
.Dd $Mdocdate: December 26 2011 $
d269 1
a269 1
.It Pa whatis.db
d273 1
a273 1
.It Pa whatis.index
@


1.13
log
@Document whatis(1) -S and -s; leading, trailing, and double colons
in the MANPATH; and the new whatis.index file.
Include some synching to apropos(1) and to the usage() string.
Use some feedback from jmc@@.
@
text
@d1 1
a1 1
.\"	$Id: apropos.1,v 1.12 2011/12/25 20:15:54 schwarze Exp $
d17 1
a17 1
.Dd $Mdocdate: December 25 2011 $
d286 2
a287 3
.Qq mdoc
as a substring and regular expression
within each manual name and description:
d289 1
a289 2
.Dl $ apropos mdoc
.Dl $ apropos ~^mdoc$
d292 1
a292 1
.Qq roff
d294 2
a295 2
.Qq man
for the regular expression case:
d297 1
a297 2
.Dl $ apropos ~^mdoc$ roff man
.Dl $ apropos ~^mdoc$ \-o roff \-o man
d299 5
a303 1
Search for
d305 1
a305 1
and
d307 8
a314 1
as variable names in the library category:
d316 1
a316 1
.Dl $ apropos \-s 3 Va~^optind \-a Va~^optarg$
@


1.12
log
@State default usage before listing arguments of a utility;
from kristaps@@, ok jmc@@.
@
text
@d1 1
a1 1
.\"	$Id: apropos.1,v 1.11 2011/12/25 16:52:55 schwarze Exp $
d26 2
a27 2
.Op Fl M Ar manpath
.Op Fl m Ar manpath
d61 1
a61 1
.It Fl M Ar manpath
d67 1
a67 1
.It Fl m Ar manpath
d74 9
a82 3
Search only for a particular architecture.
.It Fl s Ar cat
Search only for a manual section.
d85 1
a85 1
for a listing of manual sections.
d248 1
a248 1
.Bl -tag -width Ds
d250 5
a254 2
Colon-separated paths modifying the default list of paths searched for
manual databases.
d260 6
a265 9
begins with a
.Sq \&: ,
it is appended to the default list;
else if it ends with
.Sq \&: ,
it is prepended to the default list; else if it contains
.Sq \&:: ,
the default list is inserted between the colons.
If none of these conditions are met, it overrides the default list.
@


1.11
log
@Use the traditional name "whatis.db" for the mandocdb(8) databases.
Requested by deraadt@@, ok kristaps@@.

CAUTION:
If you run "sudo mandocdb" after this, the old apropos(1) and whatis(1)
will not work any longer.  To get temporary copies of the new ones, run:
cd /usr/bin; rm -f apropos whatis; ln -s mandoc apropos; ln -s mandoc whatis
@
text
@d1 1
a1 1
.\"	$Id: apropos.1,v 1.10 2011/12/24 21:51:40 schwarze Exp $
d17 1
a17 1
.Dd $Mdocdate: December 24 2011 $
d39 14
a142 12
By default,
.Nm
searches for
.Xr mandocdb 8
databases in the default paths stipulated by
.Xr man 1 ,
parses terms as case-sensitive regular expressions
.Pq the Li \&~ operator
over manual names and descriptions
.Pq the Li \&Nm No and Li \&Nd No macro keys .
Multiple terms imply pairwise
.Fl o .
@


1.10
log
@Support leading, trailing and double colons in MANPATH
to prepend, append or insert the man.conf(5) default path;
compatible with GNU manpath(1), implementation by kristaps@@,
heavily tweaked by me.
@
text
@d1 1
a1 1
.\"	$Id: apropos.1,v 1.9 2011/12/12 01:59:13 schwarze Exp $
d17 1
a17 1
.Dd $Mdocdate: December 12 2011 $
d261 1
a261 1
.It Pa mandoc.db
d265 1
a265 1
.It Pa mandoc.index
@


1.9
log
@implement -C (alternative config file) for apropos(1) and mandocdb(8);
ok kristaps@@
@
text
@d1 1
a1 1
.\"	$Id: apropos.1,v 1.8 2011/11/29 22:30:56 schwarze Exp $
d17 1
a17 1
.Dd $Mdocdate: November 29 2011 $
d242 1
a242 1
Colon-separated paths overriding the default list of paths searched for
d247 11
@


1.8
log
@Sync to bsd.lv, mostly from kristaps@@.
Make `-i' only apply to regular expressions.
For substring matches, always use strcasestr().
Also, improve some manuals and comments.
@
text
@d1 1
a1 1
.\"	$Id: apropos.1,v 1.7 2011/11/29 01:07:30 schwarze Exp $
d25 1
d30 1
a30 1
.Ar expression...
d41 6
d247 15
@


1.7
log
@tables of matchable keys; from kristaps@@
@
text
@d1 1
a1 1
.\"	$Id: apropos.1,v 1.6 2011/11/26 16:41:35 schwarze Exp $
d17 1
a17 1
.Dd $Mdocdate: November 26 2011 $
d115 1
a115 3
Same as
.Ar term ,
but
d117 1
d119 1
d128 1
a128 1
parses terms as case-insensitive regular expressions
a240 1
.\" .Sh FILES
d246 2
a247 1
within the manual name and description:
d250 1
d252 3
a254 4
Two variants of searching for
.Qq mdoc ,
.Qq roff ,
or
d256 1
a256 1
within manual names and descriptions:
d258 2
a259 2
.Dl $ apropos mdoc roff man
.Dl $ apropos mdoc \-o roff \-o man
d267 1
a267 7
.Dl $ apropos \-s 3 \(dqVa~^optind$\(dq -a \(dqVa~^optarg$\(dq
.Pp
Search for all manuals referencing
.Qq POSIX
in any letter case:
.Pp
.Dl $ apropos \-\- \-i posix
d270 2
a271 2
.Xr mandoc 1 ,
.Xr re_format 7
@


1.6
log
@Resync to bsd.lv, most code from kristaps@@.
In particular, support the MANPATH environment variable
and don't confuse index record numbers when working with
multiple mandoc databases at once.
Besides, remove lots of gratuitious code and whitespace differences.
@
text
@d1 1
a1 1
.\"	$Id: apropos.1,v 1.5 2011/11/26 13:07:15 schwarze Exp $
d100 1
a100 1
.Li key
d104 1
a104 1
.Li val
d106 3
d128 1
a128 1
parses terms as case-sensitive regular expressions
d131 1
a131 1
.Pq the Li \&Nm No and Li \&Nd No macros .
d157 75
@


1.5
log
@minor sync to bsd.lv
@
text
@d1 1
a1 1
.\"	$Id: apropos.1,v 1.4 2011/11/18 01:10:03 schwarze Exp $
d17 1
a17 1
.Dd $Mdocdate: November 18 2011 $
d22 1
a22 1
.Nd search the manual page database
d25 2
d33 1
a33 1
utility queries a manual page database generated by
d37 1
a37 1
for each file in the database.
d40 12
d121 4
d154 9
a162 6
.\" .Sh IMPLEMENTATION NOTES
.\" Not used in OpenBSD.
.\" .Sh RETURN VALUES
.\" For sections 2, 3, & 9 only.
.\" .Sh ENVIRONMENT
.\" For sections 1, 6, 7, & 8 only.
a195 4
.\" .Sh DIAGNOSTICS
.\" For sections 1, 4, 6, 7, & 8 only.
.\" .Sh ERRORS
.\" For sections 2, 3, & 9 only.
a199 2
.\" .Sh STANDARDS
.\" .Sh HISTORY
a205 4
.\" .Sh CAVEATS
.\" .Sh BUGS
.\" .Sh SECURITY CONSIDERATIONS
.\" Not used in OpenBSD.
@


1.4
log
@Support parenthised subexpressions in apropos(1);
written by kristaps@@, massive conflict resolution by me.
Lightly tested, putting it in for polishing it in-tree.
This concludes p2k11 for me, thanks robert@@!
@
text
@d1 1
a1 1
.\"	$Id: apropos.1,v 1.3 2011/11/13 09:58:21 schwarze Exp $
d17 1
a17 1
.Dd $Mdocdate: November 13 2011 $
d32 1
a32 1
.Xr mandocdb 8 , 
a59 1
.Pp
@


1.3
log
@Split the common code to be reused by other mandocdb clients,
for example the future man.cgi, out of apropos.c (which still
contains the apropos(1) main program, command line handling, and
the terminal output formatter) into apropos_db.{h,c} (which now
contains the database searching backend code).

While here,
* Drop the -e option; to search for exact strings, use REs.
* Drop the -r option (more changes related to this coming soon).
* Use the traditional -s and -S instead of inventing our own options.
* Drop the sort option (at least for now), it got in the way.

Written by kristaps@@.
@
text
@d1 1
a1 1
.\"	$Id: apropos.1,v 1.2 2011/10/09 17:59:56 schwarze Exp $
d17 1
a17 1
.Dd $Mdocdate: October 9 2011 $
a24 1
.Op Fl I
d27 1
a27 2
.Op Fl t Ar types
.Ar pattern
d31 5
a35 1
utility queries the manual page database.
d45 59
a103 37
.It Fl I
Case-insensitive pattern matching.
.It Fl t Ar types
Consider only types of keyword match, where
.Ar types
is a comma-separated list consisting of the following:
.Ar name ,
manual names;
.Ar func ,
function names;
.Ar utility ,
utility names;
.Ar incl ,
include files;
.Ar var ,
variable names;
.Ar stand ,
standards ;
.Ar auth ,
authors;
.Ar conf ,
configuration strings;
.Ar desc ,
descriptive text;
.Ar xref ,
cross-references.
.Ar path ,
file pathnames;
.Ar env ,
environment variables; or
.Ar err ,
error codes.
Specifying
.Ar all
will search for all types.
.It Ar key
The search key.
d108 7
a114 5
searches for pattern matches of
.Ar pattern
in manual names and descriptions
and displays results sorted by manual title.
Output is formatted as
d148 16
d165 3
a167 1
as a variable name in the library category:
d169 1
a169 1
.Dl $ apropos \-tvar \-s 3 optind
d171 1
a171 1
Search for all manuals referencing the term
d175 1
a175 1
.Dl $ apropos \-tall \-I posix
@


1.2
log
@Sync to version 1.12.0; all code by kristaps@@:
Implement .Rv in -Tman.
Let -man -Tman work a bit like cat(1).
Add the -Ofragment option to -T[x]html.
Minor fixes in -T[x]html.
Lots of apropos(1) and -Tman code cleanup.
@
text
@d1 1
a1 1
.\"	$Id: apropos.1,v 1.1 2011/10/06 23:04:16 schwarze Exp $
d17 1
a17 1
.Dd $Mdocdate: October 6 2011 $
d25 3
a27 4
.Op Fl eIr
.Op Fl a Ar arch
.Op Fl c Ar cat
.Op Fl s Ar sort
d29 1
a29 1
.Ar key
d36 1
a36 1
.It Fl a Ar arch
d38 2
a39 2
.It Fl c Ar cat
Search only for a category (manual section).
d42 1
a42 4
for a listing of categories.
.It Fl e
Search only for exact matches (subject to
.Fl I ) .
d44 1
a44 16
Case-insensitive matching.
.It Fl r
Consider
.Ar key
to be a POSIX regular expression (subject to
.Fl I ) .
See
.Xr re_format 7
for a description of regular expressions.
.It Fl s Ar sort
Sorting type.
Accepts
.Ar cat
to sort by category and then by title or
.Ar title
to sort by title (which is the default).
d84 2
a85 2
searches for substring matches of
.Ar key
d87 1
a87 1
and displays results by manual title.
d90 1
a90 1
.D1 title(cat) \- description
d96 2
a97 2
.Qq cat
is the category, and
d106 1
a106 1
.Dl $ man -s cat title
d110 1
a110 1
.Dl $ man -s cat -S arch title
d125 1
a125 1
.Dl $ apropos -tvar -c 3 optind
d131 1
a131 1
.Dl $ apropos -tall -I posix
@


1.1
log
@1) Import the future apropos(1) replacement written by kristaps@@.
2) Link both that one and mandocdb(8) into the mandoc(1) binary.
3) Install a /usr/bin/mandocdb hardlink and the mandocdb(8) manual.

Do not replace /usr/bin/apropos by a hardlink yet because it is
not ready for production, and ports integration is still missing.
Development will be done in the tree, even the user interfaces
are still subject to change at this point.

Both jmc@@ and deraadt@@ agree with getting this in.
@
text
@d1 1
a1 1
.\"	$Id: apropos.in.1,v 1.8 2011/07/01 13:49:24 kristaps Exp $
d17 1
a17 1
.Dd $Mdocdate: July 1 2011 $
d165 2
a166 1
.An Kristaps Dzonsons Aq kristaps@@bsd.lv .
@

