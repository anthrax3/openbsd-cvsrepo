head	1.3;
access;
symbols
	OPENBSD_6_2:1.3.0.4
	OPENBSD_6_2_BASE:1.3
	OPENBSD_6_1:1.2.0.16
	OPENBSD_6_1_BASE:1.2
	OPENBSD_6_0:1.2.0.14
	OPENBSD_6_0_BASE:1.2
	OPENBSD_5_9:1.2.0.10
	OPENBSD_5_9_BASE:1.2
	OPENBSD_5_8:1.2.0.8
	OPENBSD_5_8_BASE:1.2
	OPENBSD_5_7:1.2.0.2
	OPENBSD_5_7_BASE:1.2
	OPENBSD_5_6:1.2.0.6
	OPENBSD_5_6_BASE:1.2
	OPENBSD_5_5:1.2.0.4
	OPENBSD_5_5_BASE:1.2;
locks; strict;
comment	@# @;


1.3
date	2017.06.23.03.25.53;	author dtucker;	state Exp;
branches;
next	1.2;
commitid	cDdsOXcGbATmIRB2;

1.2
date	2013.10.14.02.55.47;	author dtucker;	state Exp;
branches;
next	1.1;

1.1
date	2013.10.10.00.59.18;	author dtucker;	state Exp;
branches;
next	;


desc
@@


1.3
log
@Run the screen twice so we end up with more candidate groups.  ok djm@@
@
text
@#!/bin/sh
#	$OpenBSD: moduli-gen.sh,v 1.2 2013/10/14 02:55:47 dtucker Exp $
#

srcdir="$1"
objdir="$2"
bits="$3"

moduli_sieved=${objdir}/moduli.${bits}.sieved.gz
moduli_tested=${objdir}/moduli.${bits}.tested
moduli_part=${srcdir}/moduli.${bits}

if [ ! -d ${objdir} ]; then
	mkdir ${objdir}
fi

if [ -f ${moduli_part} ]; then
	exit 0
fi

if [ ! -f ${moduli_sieved} ]; then
	for i in 0 1; do ssh-keygen -b ${bits} -G /dev/stdout; done | \
	    gzip -9c >${moduli_sieved}.tmp && \
	mv ${moduli_sieved}.tmp ${moduli_sieved}
fi

lines=`gzip -dc ${moduli_sieved} | wc -l`

gzip -dc ${moduli_sieved} | \
    ssh-keygen -K ${moduli_tested}.ckpt -T ${moduli_tested} -J $lines && \
mv ${objdir}/moduli.${bits}.tested ${srcdir}/moduli.${bits}

exit 0
@


1.2
log
@count number of lines in moduli input file and pass to the testing
ssh-keygen process.  this will let it provide an completion time estimate.
@
text
@d2 1
a2 1
#	$OpenBSD: moduli-gen.sh,v 1.1 2013/10/10 00:59:18 dtucker Exp $
d22 1
a22 1
	ssh-keygen -b ${bits} -G /dev/stdout | \
@


1.1
log
@Move moduli generation to usr.bin/ssh/moduli-gen and keep track of
the fragments separately.  "No substantive objection" djm@@
@
text
@d2 1
a2 1
#	$OpenBSD$
d27 2
d30 1
a30 1
    ssh-keygen -K ${moduli_tested}.ckpt -T ${moduli_tested} && \
@

