head	1.33;
access;
symbols
	OPENBSD_6_0:1.32.0.4
	OPENBSD_6_0_BASE:1.32
	OPENBSD_5_9:1.31.0.10
	OPENBSD_5_9_BASE:1.31
	OPENBSD_5_8:1.31.0.8
	OPENBSD_5_8_BASE:1.31
	OPENBSD_5_7:1.31.0.2
	OPENBSD_5_7_BASE:1.31
	OPENBSD_5_6:1.31.0.6
	OPENBSD_5_6_BASE:1.31
	OPENBSD_5_5:1.31.0.4
	OPENBSD_5_5_BASE:1.31
	OPENBSD_5_4:1.30.0.22
	OPENBSD_5_4_BASE:1.30
	OPENBSD_5_3:1.30.0.20
	OPENBSD_5_3_BASE:1.30
	OPENBSD_5_2:1.30.0.18
	OPENBSD_5_2_BASE:1.30
	OPENBSD_5_1_BASE:1.30
	OPENBSD_5_1:1.30.0.16
	OPENBSD_5_0:1.30.0.14
	OPENBSD_5_0_BASE:1.30
	OPENBSD_4_9:1.30.0.12
	OPENBSD_4_9_BASE:1.30
	OPENBSD_4_8:1.30.0.10
	OPENBSD_4_8_BASE:1.30
	OPENBSD_4_7:1.30.0.6
	OPENBSD_4_7_BASE:1.30
	OPENBSD_4_6:1.30.0.8
	OPENBSD_4_6_BASE:1.30
	OPENBSD_4_5:1.30.0.4
	OPENBSD_4_5_BASE:1.30
	OPENBSD_4_4:1.30.0.2
	OPENBSD_4_4_BASE:1.30
	OPENBSD_4_3:1.29.0.8
	OPENBSD_4_3_BASE:1.29
	OPENBSD_4_2:1.29.0.6
	OPENBSD_4_2_BASE:1.29
	OPENBSD_4_1:1.29.0.2
	OPENBSD_4_1_BASE:1.29
	OPENBSD_4_0:1.29.0.4
	OPENBSD_4_0_BASE:1.29
	OPENBSD_3_9:1.25.0.4
	OPENBSD_3_9_BASE:1.25
	OPENBSD_3_8:1.25.0.2
	OPENBSD_3_8_BASE:1.25
	OPENBSD_3_7:1.23.0.4
	OPENBSD_3_7_BASE:1.23
	OPENBSD_3_6:1.23.0.2
	OPENBSD_3_6_BASE:1.23
	OPENBSD_3_5:1.21.0.2
	OPENBSD_3_5_BASE:1.21
	OPENBSD_3_4:1.20.0.2
	OPENBSD_3_4_BASE:1.20
	OPENBSD_3_3:1.19.0.4
	OPENBSD_3_3_BASE:1.19
	OPENBSD_3_2:1.19.0.2
	OPENBSD_3_2_BASE:1.19
	OPENBSD_3_1:1.17.0.2
	OPENBSD_3_1_BASE:1.17
	OPENBSD_3_0:1.13.0.2
	OPENBSD_3_0_BASE:1.13
	OPENBSD_2_9_BASE:1.6
	OPENBSD_2_9:1.6.0.2
	OPENBSD_2_8:1.3.0.2
	OPENBSD_2_8_BASE:1.3
	OPENBSD_2_7:1.2.0.2
	OPENBSD_2_7_BASE:1.2;
locks; strict;
comment	@ * @;


1.33
date	2016.08.13.17.47.41;	author markus;	state Exp;
branches;
next	1.32;
commitid	dl4RDERdJITM8DKC;

1.32
date	2016.03.07.19.02.43;	author djm;	state Exp;
branches;
next	1.31;
commitid	kr9hjdmg99uVnhW2;

1.31
date	2013.10.14.21.20.52;	author djm;	state Exp;
branches;
next	1.30;

1.30
date	2008.05.08.12.21.16;	author djm;	state Exp;
branches;
next	1.29;

1.29
date	2006.08.03.03.34.42;	author deraadt;	state Exp;
branches;
next	1.28;

1.28
date	2006.07.06.16.03.53;	author stevesk;	state Exp;
branches;
next	1.27;

1.27
date	2006.03.25.22.22.43;	author djm;	state Exp;
branches;
next	1.26;

1.26
date	2006.03.20.18.26.55;	author deraadt;	state Exp;
branches;
next	1.25;

1.25
date	2005.07.17.06.49.04;	author djm;	state Exp;
branches
	1.25.2.1
	1.25.4.1;
next	1.24;

1.24
date	2005.06.17.02.44.33;	author djm;	state Exp;
branches;
next	1.23;

1.23
date	2004.07.17.05.31.41;	author dtucker;	state Exp;
branches
	1.23.2.1
	1.23.4.1;
next	1.22;

1.22
date	2004.04.27.09.46.37;	author djm;	state Exp;
branches;
next	1.21;

1.21
date	2003.09.23.20.17.11;	author markus;	state Exp;
branches
	1.21.2.1;
next	1.20;

1.20
date	2003.08.22.10.56.09;	author markus;	state Exp;
branches
	1.20.2.1;
next	1.19;

1.19
date	2002.06.30.21.59.45;	author deraadt;	state Exp;
branches
	1.19.2.1
	1.19.4.1;
next	1.18;

1.18
date	2002.06.23.21.06.41;	author deraadt;	state Exp;
branches;
next	1.17;

1.17
date	2002.03.29.18.59.32;	author markus;	state Exp;
branches
	1.17.2.1;
next	1.16;

1.16
date	2002.03.19.10.35.39;	author markus;	state Exp;
branches;
next	1.15;

1.15
date	2002.03.18.17.50.31;	author provos;	state Exp;
branches;
next	1.14;

1.14
date	2002.02.03.17.53.25;	author markus;	state Exp;
branches;
next	1.13;

1.13
date	2001.10.10.22.18.47;	author markus;	state Exp;
branches
	1.13.2.1;
next	1.12;

1.12
date	2001.10.09.21.59.41;	author markus;	state Exp;
branches;
next	1.11;

1.11
date	2001.07.02.13.59.15;	author markus;	state Exp;
branches;
next	1.10;

1.10
date	2001.06.27.02.12.54;	author markus;	state Exp;
branches;
next	1.9;

1.9
date	2001.06.26.17.27.24;	author markus;	state Exp;
branches;
next	1.8;

1.8
date	2001.06.26.06.33.01;	author itojun;	state Exp;
branches;
next	1.7;

1.7
date	2001.06.25.08.25.39;	author markus;	state Exp;
branches;
next	1.6;

1.6
date	2001.03.21.11.43.45;	author markus;	state Exp;
branches
	1.6.2.1;
next	1.5;

1.5
date	2001.01.29.01.58.18;	author niklas;	state Exp;
branches;
next	1.4;

1.4
date	2001.01.18.17.00.00;	author markus;	state Exp;
branches;
next	1.3;

1.3
date	2000.09.07.20.27.53;	author deraadt;	state Exp;
branches
	1.3.2.1;
next	1.2;

1.2
date	2000.04.06.08.55.22;	author markus;	state Exp;
branches
	1.2.2.1;
next	1.1;

1.1
date	2000.03.28.21.15.45;	author markus;	state Exp;
branches;
next	;

1.2.2.1
date	2000.11.08.21.31.17;	author jason;	state Exp;
branches;
next	1.2.2.2;

1.2.2.2
date	2001.03.12.15.44.14;	author jason;	state Exp;
branches;
next	1.2.2.3;

1.2.2.3
date	2001.03.21.18.53.04;	author jason;	state Exp;
branches;
next	;

1.3.2.1
date	2001.02.16.20.13.14;	author jason;	state Exp;
branches;
next	1.3.2.2;

1.3.2.2
date	2001.02.19.17.19.21;	author jason;	state Exp;
branches;
next	1.3.2.3;

1.3.2.3
date	2001.03.21.19.46.28;	author jason;	state Exp;
branches;
next	1.3.2.4;

1.3.2.4
date	2001.05.07.21.09.34;	author jason;	state Exp;
branches;
next	1.3.2.5;

1.3.2.5
date	2001.09.27.00.15.42;	author miod;	state Exp;
branches;
next	1.3.2.6;

1.3.2.6
date	2001.11.15.00.15.00;	author miod;	state Exp;
branches;
next	1.3.2.7;

1.3.2.7
date	2002.03.08.17.04.43;	author brad;	state Exp;
branches;
next	;

1.6.2.1
date	2001.09.27.19.03.55;	author jason;	state Exp;
branches;
next	1.6.2.2;

1.6.2.2
date	2001.11.15.00.15.19;	author miod;	state Exp;
branches;
next	1.6.2.3;

1.6.2.3
date	2002.03.09.00.20.45;	author miod;	state Exp;
branches;
next	1.6.2.4;

1.6.2.4
date	2002.06.02.22.56.11;	author miod;	state Exp;
branches;
next	;

1.13.2.1
date	2002.03.07.17.37.47;	author jason;	state Exp;
branches;
next	1.13.2.2;

1.13.2.2
date	2002.05.17.00.03.24;	author miod;	state Exp;
branches;
next	1.13.2.3;

1.13.2.3
date	2002.06.26.18.22.35;	author miod;	state Exp;
branches;
next	1.13.2.4;

1.13.2.4
date	2002.10.11.14.53.07;	author miod;	state Exp;
branches;
next	;

1.17.2.1
date	2002.06.26.15.30.38;	author jason;	state Exp;
branches;
next	1.17.2.2;

1.17.2.2
date	2002.10.11.14.51.52;	author miod;	state Exp;
branches;
next	;

1.19.2.1
date	2003.09.16.21.20.27;	author brad;	state Exp;
branches;
next	;

1.19.4.1
date	2003.09.16.20.50.43;	author brad;	state Exp;
branches;
next	1.19.4.2;

1.19.4.2
date	2004.03.04.18.18.16;	author brad;	state Exp;
branches;
next	;

1.20.2.1
date	2004.02.28.03.51.34;	author brad;	state Exp;
branches;
next	1.20.2.2;

1.20.2.2
date	2004.08.19.22.37.32;	author brad;	state Exp;
branches;
next	;

1.21.2.1
date	2004.08.19.04.13.27;	author brad;	state Exp;
branches;
next	;

1.23.2.1
date	2005.09.02.03.45.00;	author brad;	state Exp;
branches;
next	;

1.23.4.1
date	2005.09.04.18.40.03;	author brad;	state Exp;
branches;
next	;

1.25.2.1
date	2006.10.06.03.19.33;	author brad;	state Exp;
branches;
next	;

1.25.4.1
date	2006.09.30.04.06.51;	author brad;	state Exp;
branches;
next	;


desc
@@


1.33
log
@remove ssh1 server code; ok djm@@
@
text
@/* $OpenBSD: session.h,v 1.32 2016/03/07 19:02:43 djm Exp $ */

/*
 * Copyright (c) 2000, 2001 Markus Friedl.  All rights reserved.
 *
 * Redistribution and use in source and binary forms, with or without
 * modification, are permitted provided that the following conditions
 * are met:
 * 1. Redistributions of source code must retain the above copyright
 *    notice, this list of conditions and the following disclaimer.
 * 2. Redistributions in binary form must reproduce the above copyright
 *    notice, this list of conditions and the following disclaimer in the
 *    documentation and/or other materials provided with the distribution.
 *
 * THIS SOFTWARE IS PROVIDED BY THE AUTHOR ``AS IS'' AND ANY EXPRESS OR
 * IMPLIED WARRANTIES, INCLUDING, BUT NOT LIMITED TO, THE IMPLIED WARRANTIES
 * OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE ARE DISCLAIMED.
 * IN NO EVENT SHALL THE AUTHOR BE LIABLE FOR ANY DIRECT, INDIRECT,
 * INCIDENTAL, SPECIAL, EXEMPLARY, OR CONSEQUENTIAL DAMAGES (INCLUDING, BUT
 * NOT LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES; LOSS OF USE,
 * DATA, OR PROFITS; OR BUSINESS INTERRUPTION) HOWEVER CAUSED AND ON ANY
 * THEORY OF LIABILITY, WHETHER IN CONTRACT, STRICT LIABILITY, OR TORT
 * (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE USE OF
 * THIS SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.
 */
#ifndef SESSION_H
#define SESSION_H

#define TTYSZ 64
typedef struct Session Session;
struct Session {
	int	used;
	int	self;
	int	next_unused;
	struct passwd *pw;
	Authctxt *authctxt;
	pid_t	pid;

	/* tty */
	char	*term;
	int	ptyfd, ttyfd, ptymaster;
	u_int	row, col, xpixel, ypixel;
	char	tty[TTYSZ];

	/* X11 */
	u_int	display_number;
	char	*display;
	u_int	screen;
	char	*auth_display;
	char	*auth_proto;
	char	*auth_data;
	int	single_connection;

	int	chanid;
	int	*x11_chanids;
	int	is_subsystem;
	char	*subsys;
	u_int	num_env;
	struct {
		char	*name;
		char	*val;
	} *env;
};

void	 do_authenticated(Authctxt *);
void	 do_cleanup(Authctxt *);

int	 session_open(Authctxt *, int);
void	 session_unused(int);
int	 session_input_channel_req(Channel *, const char *);
void	 session_close_by_pid(pid_t, int);
void	 session_close_by_channel(int, void *);
void	 session_destroy_all(void (*)(Session *));
void	 session_pty_cleanup2(Session *);

Session	*session_new(void);
Session	*session_by_tty(char *);
void	 session_close(Session *);
void	 do_setusercontext(struct passwd *);
void	 child_set_env(char ***envp, u_int *envsizep, const char *name,
		       const char *value);

const char	*session_get_remote_name_or_ip(struct ssh *, u_int, int);

#endif
@


1.32
log
@refactor canohost.c: move functions that cache results closer to the
places that use them (authn and session code). After this, no state is
cached in canohost.c

feedback and ok markus@@
@
text
@d1 1
a1 1
/* $OpenBSD: session.h,v 1.31 2013/10/14 21:20:52 djm Exp $ */
a53 1
	/* proto 2 */
@


1.31
log
@Add logging of session starts in a useful format; ok markus@@ feedback and
ok dtucker@@
@
text
@d1 1
a1 1
/* $OpenBSD: session.h,v 1.30 2008/05/08 12:21:16 djm Exp $ */
d83 2
@


1.30
log
@Make the maximum number of sessions run-time controllable via
a sshd_config MaxSessions knob. This is useful for disabling
login/shell/subsystem access while leaving port-forwarding working
(MaxSessions 0), disabling connection multiplexing (MaxSessions 1) or
simply increasing the number of allows multiplexed sessions.

Because some bozos are sure to configure MaxSessions in excess of the
number of available file descriptors in sshd (which, at peak, might be
as many as 9*MaxSessions), audit sshd to ensure that it doesn't leak fds
on error paths, and make it fail gracefully on out-of-fd conditions -
sending channel errors instead of than exiting with fatal().

bz#1090; MaxSessions config bits and manpage from junyer AT gmail.com

ok markus@@
@
text
@d1 1
a1 1
/* $OpenBSD: session.h,v 1.29 2006/08/03 03:34:42 deraadt Exp $ */
d58 1
@


1.29
log
@almost entirely get rid of the culture of ".h files that include .h files"
ok djm, sort of ok stevesk
makes the pain stop in one easy step
@
text
@d1 1
a1 1
/* $OpenBSD: session.h,v 1.28 2006/07/06 16:03:53 stevesk Exp $ */
d34 1
d69 1
@


1.28
log
@move #include <pwd.h> out of includes.h; ok markus@@
@
text
@d1 1
a1 1
/* $OpenBSD: session.h,v 1.27 2006/03/25 22:22:43 djm Exp $ */
a27 4

#include <sys/types.h>

#include <pwd.h>
@


1.27
log
@standardise spacing in $OpenBSD$ tags; requested by deraadt@@
@
text
@d1 1
a1 1
/* $OpenBSD: session.h,v 1.26 2006/03/20 18:26:55 deraadt Exp $ */
d28 4
@


1.26
log
@annoying spacing fixes getting in the way of real diffs
@
text
@d1 1
a1 1
/*	$OpenBSD: session.h,v 1.25 2005/07/17 06:49:04 djm Exp $	*/
@


1.25
log
@Fix a number of X11 forwarding channel leaks:
1. Refuse multiple X11 forwarding requests on the same session
2. Clean up all listeners after a single_connection X11 forward, not just
   the one that made the single connection
3. Destroy X11 listeners when the session owning them goes away
testing and ok dtucker@@
@
text
@d1 1
a1 1
/*	$OpenBSD: session.h,v 1.24 2005/06/17 02:44:33 djm Exp $	*/
d37 1
d43 1
d52 1
d61 1
a61 1
	}	*env;
@


1.25.2.1
log
@upgrade to OpenSSH 4.4
@
text
@d1 1
a1 1
/* $OpenBSD: session.h,v 1.29 2006/08/03 03:34:42 deraadt Exp $ */
a36 1

a41 1

a49 1

d58 1
a58 1
	} *env;
@


1.25.4.1
log
@upgrade to OpenSSH 4.4
@
text
@d1 1
a1 1
/* $OpenBSD: session.h,v 1.29 2006/08/03 03:34:42 deraadt Exp $ */
a36 1

a41 1

a49 1

d58 1
a58 1
	} *env;
@


1.24
log
@make this -Wsign-compare clean; ok avsm@@ markus@@
@
text
@d1 1
a1 1
/*	$OpenBSD: session.h,v 1.23 2004/07/17 05:31:41 dtucker Exp $	*/
d52 1
@


1.23
log
@Move "Last logged in at.." message generation to the monitor, right
before recording the new login.  Fixes missing lastlog message when
/var/log/lastlog is not world-readable and incorrect datestamp when
multiple sessions are used (bz #463);  much assistance & ok markus@@
@
text
@d1 1
a1 1
/*	$OpenBSD: session.h,v 1.22 2004/04/27 09:46:37 djm Exp $	*/
d53 1
a53 1
	int	num_env;
@


1.23.4.1
log
@upgrade to OpenSSH 4.2
@
text
@d1 1
a1 1
/*	$OpenBSD: session.h,v 1.25 2005/07/17 06:49:04 djm Exp $	*/
a51 1
	int	*x11_chanids;
d53 1
a53 1
	u_int	num_env;
@


1.23.2.1
log
@upgrade to OpenSSH 4.2
@
text
@d1 1
a1 1
/*	$OpenBSD: session.h,v 1.25 2005/07/17 06:49:04 djm Exp $	*/
a51 1
	int	*x11_chanids;
d53 1
a53 1
	u_int	num_env;
@


1.22
log
@bz #815: implement ability to pass specified environment variables from the
client to the server; ok markus@@
@
text
@d1 1
a1 1
/*	$OpenBSD: session.h,v 1.21 2003/09/23 20:17:11 markus Exp $	*/
a41 3
	/* last login */
	char	hostname[MAXHOSTNAMELEN];
	time_t	last_login_time;
@


1.21
log
@replace fatal_cleanup() and linked list of fatal callbacks with static
cleanup_exit() function.  re-refine cleanup_exit() where appropriate,
allocate sshd's authctxt eary to allow simpler cleanup in sshd.
tested by many, ok deraadt@@
@
text
@d1 1
a1 1
/*	$OpenBSD: session.h,v 1.20 2003/08/22 10:56:09 markus Exp $	*/
d56 5
@


1.21.2.1
log
@upgrade to OpenSSH 3.9
@
text
@d1 1
a1 1
/*	$OpenBSD: session.h,v 1.23 2004/07/17 05:31:41 dtucker Exp $	*/
d42 3
a55 5
	int	num_env;
	struct {
		char	*name;
		char	*val;
	}	*env;
@


1.20
log
@support GSS API user authentication; patches from Simon Wilkinson,
stripped down and tested by Jakob and myself.
@
text
@d1 1
a1 1
/*	$OpenBSD: session.h,v 1.19 2002/06/30 21:59:45 deraadt Exp $	*/
d59 1
d66 1
a66 1
void	 session_pty_cleanup2(void *);
@


1.20.2.1
log
@upgrade to OpenSSH 3.8
@
text
@d1 1
a1 1
/*	$OpenBSD: session.h,v 1.21 2003/09/23 20:17:11 markus Exp $	*/
a58 1
void	 do_cleanup(Authctxt *);
d65 1
a65 1
void	 session_pty_cleanup2(Session *);
@


1.20.2.2
log
@upgrade to OpenSSH 3.9
@
text
@d1 1
a1 1
/*	$OpenBSD: session.h,v 1.23 2004/07/17 05:31:41 dtucker Exp $	*/
d42 3
a55 5
	int	num_env;
	struct {
		char	*name;
		char	*val;
	}	*env;
@


1.19
log
@minor KNF
@
text
@d1 1
a1 1
/*	$OpenBSD: session.h,v 1.18 2002/06/23 21:06:41 deraadt Exp $	*/
d71 3
@


1.19.2.1
log
@upgrade to OpenSSH 3.7
@
text
@d1 1
a1 1
/*	$OpenBSD: session.h,v 1.20 2003/08/22 10:56:09 markus Exp $	*/
a70 3
void	 child_set_env(char ***envp, u_int *envsizep, const char *name,
		       const char *value);

@


1.19.4.1
log
@upgrade to OpenSSH 3.7
@
text
@d1 1
a1 1
/*	$OpenBSD: session.h,v 1.20 2003/08/22 10:56:09 markus Exp $	*/
a70 3
void	 child_set_env(char ***envp, u_int *envsizep, const char *name,
		       const char *value);

@


1.19.4.2
log
@upgrade to OpenSSH 3.8upgrade to OpenSSH 3.8upgrade to OpenSSH 3.8
@
text
@d1 1
a1 1
/*	$OpenBSD: session.h,v 1.21 2003/09/23 20:17:11 markus Exp $	*/
a58 1
void	 do_cleanup(Authctxt *);
d65 1
a65 1
void	 session_pty_cleanup2(Session *);
@


1.18
log
@display, screen, row, col, xpixel, ypixel are u_int; markus ok
@
text
@d1 1
a1 1
/*	$OpenBSD: session.h,v 1.17 2002/03/29 18:59:32 markus Exp $	*/
d60 1
a60 1
int	 session_open(Authctxt*, int);
@


1.17
log
@retrieve last login time before the pty is allocated, store per session
@
text
@d1 1
a1 1
/*	$OpenBSD: session.h,v 1.16 2002/03/19 10:35:39 markus Exp $	*/
d40 1
a40 1
	int	row, col, xpixel, ypixel;
d46 1
a46 1
	int	display_number;
d48 1
a48 1
	int	screen;
@


1.17.2.1
log
@Pull in OpenSSH-3.4
@
text
@d1 1
a1 1
/*	$OpenBSD: session.h,v 1.18 2002/06/23 21:06:41 deraadt Exp $	*/
d40 1
a40 1
	u_int	row, col, xpixel, ypixel;
d46 1
a46 1
	u_int	display_number;
d48 1
a48 1
	u_int	screen;
@


1.17.2.2
log
@Update to OpenSSH 3.5
@
text
@d1 1
a1 1
/*	$OpenBSD: session.h,v 1.19 2002/06/30 21:59:45 deraadt Exp $	*/
d60 1
a60 1
int	 session_open(Authctxt *, int);
@


1.16
log
@clean up prototypes
@
text
@d1 1
a1 1
/*	$OpenBSD: session.h,v 1.15 2002/03/18 17:50:31 provos Exp $	*/
d42 3
@


1.15
log
@integrate privilege separated openssh; its turned off by default for now.
work done by me and markus@@
@
text
@d1 1
a1 1
/*	$OpenBSD: session.h,v 1.14 2002/02/03 17:53:25 markus Exp $	*/
d62 1
@


1.14
log
@don't use channel_input_channel_request and callback
use new server_input_channel_req() instead:
	server_input_channel_req does generic request parsing on server side
	session_input_channel_req handles just session specific things now
ok djm@@
@
text
@d1 1
a1 1
/*	$OpenBSD: session.h,v 1.13 2001/10/10 22:18:47 markus Exp $	*/
d29 26
d61 1
a61 1
void	 session_destroy_all(void);
d63 4
@


1.13
log
@try to keep channels open until an exit-status message is sent.
don't kill the login shells if the shells stdin/out/err is closed.
this should now work:
ssh -2n localhost 'exec > /dev/null 2>&1; sleep 10; exit 5'; echo ?
@
text
@d1 1
a1 1
/*	$OpenBSD: session.h,v 1.12 2001/10/09 21:59:41 markus Exp $	*/
d32 1
a32 1
void	 session_input_channel_req(int, void *);
@


1.13.2.1
log
@Update to OpenSSH-3.1 on 3.0-stable branch
@
text
@d1 1
a1 1
/*	$OpenBSD: session.h,v 1.14 2002/02/03 17:53:25 markus Exp $	*/
d32 1
a32 1
int	 session_input_channel_req(Channel *, const char *);
@


1.13.2.2
log
@Update OpenSSH to version 3.2.2.
@
text
@d1 1
a1 1
/*	$OpenBSD: session.h,v 1.17 2002/03/29 18:59:32 markus Exp $	*/
a28 29
#define TTYSZ 64
typedef struct Session Session;
struct Session {
	int	used;
	int	self;
	struct passwd *pw;
	Authctxt *authctxt;
	pid_t	pid;
	/* tty */
	char	*term;
	int	ptyfd, ttyfd, ptymaster;
	int	row, col, xpixel, ypixel;
	char	tty[TTYSZ];
	/* last login */
	char	hostname[MAXHOSTNAMELEN];
	time_t	last_login_time;
	/* X11 */
	int	display_number;
	char	*display;
	int	screen;
	char	*auth_display;
	char	*auth_proto;
	char	*auth_data;
	int	single_connection;
	/* proto 2 */
	int	chanid;
	int	is_subsystem;
};

d35 1
a35 2
void	 session_destroy_all(void (*)(Session *));
void	 session_pty_cleanup2(void *);
a36 4
Session	*session_new(void);
Session	*session_by_tty(char *);
void	 session_close(Session *);
void	 do_setusercontext(struct passwd *);
@


1.13.2.3
log
@There was an update to OpenSSH 3.4, and people rejoiced.
@
text
@d1 1
a1 1
/*	$OpenBSD: session.h,v 1.13.2.2 2002/05/17 00:03:24 miod Exp $	*/
d40 1
a40 1
	u_int	row, col, xpixel, ypixel;
d46 1
a46 1
	u_int	display_number;
d48 1
a48 1
	u_int	screen;
@


1.13.2.4
log
@Update to OpenSSH 3.5
@
text
@d1 1
a1 1
/*	$OpenBSD: session.h,v 1.19 2002/06/30 21:59:45 deraadt Exp $	*/
d60 1
a60 1
int	 session_open(Authctxt *, int);
@


1.12
log
@simplify session close: no more delayed session_close, no more blocking wait() calls.
@
text
@d1 1
a1 1
/*	$OpenBSD: session.h,v 1.11 2001/07/02 13:59:15 markus Exp $	*/
d35 1
a35 1
void	 session_close_all(void);
@


1.11
log
@wait until !session_have_children(); bugreport from Lutz.Jaenicke@@aet.TU-Cottbus.DE
@
text
@d1 1
a1 1
/*	$OpenBSD: session.h,v 1.10 2001/06/27 02:12:54 markus Exp $	*/
d35 1
a35 1
int	 session_have_children(void);
@


1.10
log
@quick hack to make ssh2 work again.
@
text
@d1 1
a1 1
/*	$OpenBSD: session.h,v 1.9 2001/06/26 17:27:24 markus Exp $	*/
d35 1
@


1.9
log
@remove comments from .h, since they are cut&paste from the .c files
and out of sync
@
text
@d1 1
a1 1
/*	$OpenBSD: session.h,v 1.8 2001/06/26 06:33:01 itojun Exp $	*/
d31 1
a31 1
int	 session_open(int);
@


1.8
log
@prototype pedant.  not very creative...
- () -> (void)
- no variable names
@
text
@d1 1
a1 1
/*	$OpenBSD: session.h,v 1.7 2001/06/25 08:25:39 markus Exp $	*/
d29 1
a29 1
void	do_authenticated(Authctxt *);
d31 4
a34 4
int	session_open(int);
void	session_input_channel_req(int, void *);
void	session_close_by_pid(pid_t, int);
void	session_close_by_channel(int, void *);
@


1.7
log
@update copyright for 2001
@
text
@d1 1
a1 1
/*	$OpenBSD: session.h,v 1.6 2001/03/21 11:43:45 markus Exp $	*/
d29 1
a29 1
void	do_authenticated(Authctxt *ac);
d31 4
a34 4
int	session_open(int id);
void	session_input_channel_req(int id, void *arg);
void	session_close_by_pid(pid_t pid, int status);
void	session_close_by_channel(int id, void *arg);
@


1.6
log
@merge common ssh v1/2 code
@
text
@d1 1
a1 1
/*	$OpenBSD: session.h,v 1.5 2001/01/29 01:58:18 niklas Exp $	*/
d4 1
a4 1
 * Copyright (c) 2000 Markus Friedl.  All rights reserved.
@


1.6.2.1
log
@Pull in OpenSSH-2.9.9
@
text
@d1 1
a1 1
/*	$OpenBSD: session.h,v 1.11 2001/07/02 13:59:15 markus Exp $	*/
d4 1
a4 1
 * Copyright (c) 2000, 2001 Markus Friedl.  All rights reserved.
d29 1
a29 1
void	 do_authenticated(Authctxt *);
d31 4
a34 5
int	 session_open(Authctxt*, int);
void	 session_input_channel_req(int, void *);
void	 session_close_by_pid(pid_t, int);
void	 session_close_by_channel(int, void *);
int	 session_have_children(void);
@


1.6.2.2
log
@Merge OpenSSH 3.0
@
text
@d1 1
a1 1
/*	$OpenBSD: session.h,v 1.6.2.1 2001/09/27 19:03:55 jason Exp $	*/
d35 1
a35 1
void	 session_destroy_all(void);
@


1.6.2.3
log
@Merge OpenSSH 3.1, keeping /etc as configuration files directory.
(i.e. OpenSSH 3.1 + openbsd29_3.1.patch)
@
text
@d1 1
a1 1
/*	$OpenBSD: session.h,v 1.14 2002/02/03 17:53:25 markus Exp $	*/
d32 1
a32 1
int	 session_input_channel_req(Channel *, const char *);
@


1.6.2.4
log
@Upgrade to OpenSSH 3.2.3.

Except for improbable compilation error fixes, this should be the last
commit made to the 2.9-STABLE branche. Have fun upgrading.
@
text
@d1 1
a1 1
/*	$OpenBSD: session.h,v 1.17 2002/03/29 18:59:32 markus Exp $	*/
a28 29
#define TTYSZ 64
typedef struct Session Session;
struct Session {
	int	used;
	int	self;
	struct passwd *pw;
	Authctxt *authctxt;
	pid_t	pid;
	/* tty */
	char	*term;
	int	ptyfd, ttyfd, ptymaster;
	int	row, col, xpixel, ypixel;
	char	tty[TTYSZ];
	/* last login */
	char	hostname[MAXHOSTNAMELEN];
	time_t	last_login_time;
	/* X11 */
	int	display_number;
	char	*display;
	int	screen;
	char	*auth_display;
	char	*auth_proto;
	char	*auth_data;
	int	single_connection;
	/* proto 2 */
	int	chanid;
	int	is_subsystem;
};

d35 1
a35 2
void	 session_destroy_all(void (*)(Session *));
void	 session_pty_cleanup2(void *);
a36 4
Session	*session_new(void);
Session	*session_by_tty(char *);
void	 session_close(Session *);
void	 do_setusercontext(struct passwd *);
@


1.5
log
@$OpenBSD$
@
text
@d1 1
a1 1
/*	$OpenBSD$	*/
d29 1
a29 2
/* SSH1 */
void	do_authenticated(struct passwd * pw);
a30 2
/* SSH2 */
void	do_authenticated2(Authctxt *ac);
@


1.4
log
@1) removes fake skey from sshd, since this will be much
   harder with /usr/libexec/auth/login_XXX
2) share/unify code used in ssh-1 and ssh-2 authentication (server side)
3) make addition of BSD_AUTH and other challenge reponse methods
   easier.
@
text
@d1 2
@


1.3
log
@cleanup copyright notices on all files.  I have attempted to be accurate with
the details.  everything is now under Tatu's licence (which I copied from his
readme), and/or the core-sdi bsd-ish thing for deattack, or various openbsd
developers under a 2-term bsd licence.  We're not changing any rules, just
being accurate.
@
text
@d31 1
a31 1
void	do_authenticated2(void);
@


1.3.2.1
log
@Pull in OpenSSH 2.5.0
@
text
@a0 2
/*	$OpenBSD: session.h,v 1.5 2001/01/29 01:58:18 niklas Exp $	*/

d31 1
a31 1
void	do_authenticated2(Authctxt *ac);
@


1.3.2.2
log
@Pull in OpenSSH-2.5.1
@
text
@@


1.3.2.3
log
@Pull in OpenSSH-2.5.2 for 2.8 branch.
@
text
@@


1.3.2.4
log
@Pull in OpenSSH-2.9 to 2.8 branch.
@
text
@d1 1
a1 1
/*	$OpenBSD: session.h,v 1.6 2001/03/21 11:43:45 markus Exp $	*/
d29 2
a30 1
void	do_authenticated(Authctxt *ac);
d32 2
@


1.3.2.5
log
@Pull in OpenSSH 2.9.9 to the 2.8 branch.
@
text
@d1 1
a1 1
/*	$OpenBSD: session.h,v 1.11 2001/07/02 13:59:15 markus Exp $	*/
d4 1
a4 1
 * Copyright (c) 2000, 2001 Markus Friedl.  All rights reserved.
d29 1
a29 1
void	 do_authenticated(Authctxt *);
d31 4
a34 5
int	 session_open(Authctxt*, int);
void	 session_input_channel_req(int, void *);
void	 session_close_by_pid(pid_t, int);
void	 session_close_by_channel(int, void *);
int	 session_have_children(void);
@


1.3.2.6
log
@Merge OpenSSH 3.0
@
text
@d1 1
a1 1
/*	$OpenBSD: session.h,v 1.3.2.5 2001/09/27 00:15:42 miod Exp $	*/
d35 1
a35 1
void	 session_destroy_all(void);
@


1.3.2.7
log
@Merge OpenSSH 3.1.
@
text
@d1 1
a1 1
/*	$OpenBSD: session.h,v 1.14 2002/02/03 17:53:25 markus Exp $	*/
d32 1
a32 1
int	 session_input_channel_req(Channel *, const char *);
@


1.2
log
@ssh2 server side, see README.openssh2; enable with 'sshd -2'
@
text
@d1 23
@


1.2.2.1
log
@openssh-2.3.0 (again) for 2.7 branch
@
text
@a0 23
/*
 * Copyright (c) 2000 Markus Friedl.  All rights reserved.
 *
 * Redistribution and use in source and binary forms, with or without
 * modification, are permitted provided that the following conditions
 * are met:
 * 1. Redistributions of source code must retain the above copyright
 *    notice, this list of conditions and the following disclaimer.
 * 2. Redistributions in binary form must reproduce the above copyright
 *    notice, this list of conditions and the following disclaimer in the
 *    documentation and/or other materials provided with the distribution.
 *
 * THIS SOFTWARE IS PROVIDED BY THE AUTHOR ``AS IS'' AND ANY EXPRESS OR
 * IMPLIED WARRANTIES, INCLUDING, BUT NOT LIMITED TO, THE IMPLIED WARRANTIES
 * OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE ARE DISCLAIMED.
 * IN NO EVENT SHALL THE AUTHOR BE LIABLE FOR ANY DIRECT, INDIRECT,
 * INCIDENTAL, SPECIAL, EXEMPLARY, OR CONSEQUENTIAL DAMAGES (INCLUDING, BUT
 * NOT LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES; LOSS OF USE,
 * DATA, OR PROFITS; OR BUSINESS INTERRUPTION) HOWEVER CAUSED AND ON ANY
 * THEORY OF LIABILITY, WHETHER IN CONTRACT, STRICT LIABILITY, OR TORT
 * (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE USE OF
 * THIS SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.
 */
@


1.2.2.2
log
@OpenSSH-2.5.1 for 2.7 patch branch
@
text
@a0 2
/*	$OpenBSD: session.h,v 1.5 2001/01/29 01:58:18 niklas Exp $	*/

d31 1
a31 1
void	do_authenticated2(Authctxt *ac);
@


1.2.2.3
log
@Pull in OpenSSH-2.5.2 for 2.7 branch.
@
text
@@


1.1
log
@split sshd.c -> auth.c session.c sshd.c plus cleanup and goto-removal
@
text
@d7 7
@

