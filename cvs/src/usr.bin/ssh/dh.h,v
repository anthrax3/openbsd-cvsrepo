head	1.15;
access;
symbols
	OPENBSD_6_2:1.15.0.8
	OPENBSD_6_2_BASE:1.15
	OPENBSD_6_1:1.15.0.6
	OPENBSD_6_1_BASE:1.15
	OPENBSD_6_0:1.15.0.4
	OPENBSD_6_0_BASE:1.15
	OPENBSD_5_9:1.14.0.2
	OPENBSD_5_9_BASE:1.14
	OPENBSD_5_8:1.13.0.2
	OPENBSD_5_8_BASE:1.13
	OPENBSD_5_7:1.12.0.2
	OPENBSD_5_7_BASE:1.12
	OPENBSD_5_6:1.11.0.6
	OPENBSD_5_6_BASE:1.11
	OPENBSD_5_5:1.11.0.4
	OPENBSD_5_5_BASE:1.11
	OPENBSD_5_4:1.10.0.22
	OPENBSD_5_4_BASE:1.10
	OPENBSD_5_3:1.10.0.20
	OPENBSD_5_3_BASE:1.10
	OPENBSD_5_2:1.10.0.18
	OPENBSD_5_2_BASE:1.10
	OPENBSD_5_1_BASE:1.10
	OPENBSD_5_1:1.10.0.16
	OPENBSD_5_0:1.10.0.14
	OPENBSD_5_0_BASE:1.10
	OPENBSD_4_9:1.10.0.12
	OPENBSD_4_9_BASE:1.10
	OPENBSD_4_8:1.10.0.10
	OPENBSD_4_8_BASE:1.10
	OPENBSD_4_7:1.10.0.6
	OPENBSD_4_7_BASE:1.10
	OPENBSD_4_6:1.10.0.8
	OPENBSD_4_6_BASE:1.10
	OPENBSD_4_5:1.10.0.4
	OPENBSD_4_5_BASE:1.10
	OPENBSD_4_4:1.10.0.2
	OPENBSD_4_4_BASE:1.10
	OPENBSD_4_3:1.9.0.8
	OPENBSD_4_3_BASE:1.9
	OPENBSD_4_2:1.9.0.6
	OPENBSD_4_2_BASE:1.9
	OPENBSD_4_1:1.9.0.2
	OPENBSD_4_1_BASE:1.9
	OPENBSD_4_0:1.9.0.4
	OPENBSD_4_0_BASE:1.9
	OPENBSD_3_9:1.8.0.8
	OPENBSD_3_9_BASE:1.8
	OPENBSD_3_8:1.8.0.6
	OPENBSD_3_8_BASE:1.8
	OPENBSD_3_7:1.8.0.4
	OPENBSD_3_7_BASE:1.8
	OPENBSD_3_6:1.8.0.2
	OPENBSD_3_6_BASE:1.8
	OPENBSD_3_5:1.7.0.12
	OPENBSD_3_5_BASE:1.7
	OPENBSD_3_4:1.7.0.10
	OPENBSD_3_4_BASE:1.7
	OPENBSD_3_3:1.7.0.8
	OPENBSD_3_3_BASE:1.7
	OPENBSD_3_2:1.7.0.6
	OPENBSD_3_2_BASE:1.7
	OPENBSD_3_1:1.7.0.4
	OPENBSD_3_1_BASE:1.7
	OPENBSD_3_0:1.7.0.2
	OPENBSD_3_0_BASE:1.7
	OPENBSD_2_9_BASE:1.5
	OPENBSD_2_9:1.5.0.2
	OPENBSD_2_7:1.1.0.4
	OPENBSD_2_8:1.1.0.2
	OPENBSD_2_8_BASE:1.1;
locks; strict;
comment	@ * @;


1.15
date	2016.05.02.10.26.04;	author djm;	state Exp;
branches;
next	1.14;
commitid	rVUG0L3JBpFl5b0k;

1.14
date	2015.10.16.22.32.22;	author djm;	state Exp;
branches;
next	1.13;
commitid	dDeA1RvUwyKIek3f;

1.13
date	2015.05.27.23.39.18;	author dtucker;	state Exp;
branches;
next	1.12;
commitid	eEfyWHLDvL3lFUIb;

1.12
date	2015.01.19.20.16.15;	author markus;	state Exp;
branches;
next	1.11;
commitid	U9l75XYAjMKaQ8Jp;

1.11
date	2013.10.08.11.42.13;	author dtucker;	state Exp;
branches;
next	1.10;

1.10
date	2008.06.26.09.19.40;	author djm;	state Exp;
branches;
next	1.9;

1.9
date	2006.03.25.22.22.43;	author djm;	state Exp;
branches;
next	1.8;

1.8
date	2004.06.13.12.53.24;	author djm;	state Exp;
branches
	1.8.6.1
	1.8.8.1;
next	1.7;

1.7
date	2001.06.26.17.27.23;	author markus;	state Exp;
branches
	1.7.10.1
	1.7.12.1;
next	1.6;

1.6
date	2001.06.26.06.32.52;	author itojun;	state Exp;
branches;
next	1.5;

1.5
date	2001.04.03.19.53.29;	author markus;	state Exp;
branches
	1.5.2.1;
next	1.4;

1.4
date	2001.03.29.21.17.39;	author markus;	state Exp;
branches;
next	1.3;

1.3
date	2001.03.27.17.46.49;	author provos;	state Exp;
branches;
next	1.2;

1.2
date	2001.01.29.01.58.15;	author niklas;	state Exp;
branches;
next	1.1;

1.1
date	2000.10.11.04.02.17;	author provos;	state Exp;
branches
	1.1.2.1
	1.1.4.1;
next	;

1.1.2.1
date	2001.02.16.20.13.01;	author jason;	state Exp;
branches;
next	1.1.2.2;

1.1.2.2
date	2001.02.19.17.18.54;	author jason;	state Exp;
branches;
next	1.1.2.3;

1.1.2.3
date	2001.03.21.19.46.25;	author jason;	state Exp;
branches;
next	1.1.2.4;

1.1.2.4
date	2001.05.07.21.09.29;	author jason;	state Exp;
branches;
next	1.1.2.5;

1.1.2.5
date	2001.09.27.00.15.42;	author miod;	state Exp;
branches;
next	;

1.1.4.1
date	2000.11.08.21.30.44;	author jason;	state Exp;
branches;
next	1.1.4.2;

1.1.4.2
date	2001.03.12.15.44.10;	author jason;	state Exp;
branches;
next	1.1.4.3;

1.1.4.3
date	2001.03.21.18.52.44;	author jason;	state Exp;
branches;
next	;

1.5.2.1
date	2001.09.27.19.03.54;	author jason;	state Exp;
branches;
next	1.5.2.2;

1.5.2.2
date	2002.03.09.00.20.44;	author miod;	state Exp;
branches;
next	;

1.7.10.1
date	2004.08.19.22.37.31;	author brad;	state Exp;
branches;
next	;

1.7.12.1
date	2004.08.19.04.13.26;	author brad;	state Exp;
branches;
next	;

1.8.6.1
date	2006.10.06.03.19.32;	author brad;	state Exp;
branches;
next	;

1.8.8.1
date	2006.09.30.04.06.50;	author brad;	state Exp;
branches;
next	;


desc
@@


1.15
log
@add support for additional fixed DH groups from
draft-ietf-curdle-ssh-kex-sha2-03

diffie-hellman-group14-sha256 (2K group)
diffie-hellman-group16-sha512 (4K group)
diffie-hellman-group18-sha512 (8K group)

based on patch from Mark D. Baushke and Darren Tucker
ok markus@@
@
text
@/* $OpenBSD: dh.h,v 1.14 2015/10/16 22:32:22 djm Exp $ */

/*
 * Copyright (c) 2000 Niels Provos.  All rights reserved.
 *
 * Redistribution and use in source and binary forms, with or without
 * modification, are permitted provided that the following conditions
 * are met:
 * 1. Redistributions of source code must retain the above copyright
 *    notice, this list of conditions and the following disclaimer.
 * 2. Redistributions in binary form must reproduce the above copyright
 *    notice, this list of conditions and the following disclaimer in the
 *    documentation and/or other materials provided with the distribution.
 *
 * THIS SOFTWARE IS PROVIDED BY THE AUTHOR ``AS IS'' AND ANY EXPRESS OR
 * IMPLIED WARRANTIES, INCLUDING, BUT NOT LIMITED TO, THE IMPLIED WARRANTIES
 * OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE ARE DISCLAIMED.
 * IN NO EVENT SHALL THE AUTHOR BE LIABLE FOR ANY DIRECT, INDIRECT,
 * INCIDENTAL, SPECIAL, EXEMPLARY, OR CONSEQUENTIAL DAMAGES (INCLUDING, BUT
 * NOT LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES; LOSS OF USE,
 * DATA, OR PROFITS; OR BUSINESS INTERRUPTION) HOWEVER CAUSED AND ON ANY
 * THEORY OF LIABILITY, WHETHER IN CONTRACT, STRICT LIABILITY, OR TORT
 * (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE USE OF
 * THIS SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.
 */
#ifndef DH_H
#define DH_H

struct dhgroup {
	int size;
	BIGNUM *g;
	BIGNUM *p;
};

DH	*choose_dh(int, int, int);
DH	*dh_new_group_asc(const char *, const char *);
DH	*dh_new_group(BIGNUM *, BIGNUM *);
DH	*dh_new_group1(void);
DH	*dh_new_group14(void);
DH	*dh_new_group16(void);
DH	*dh_new_group18(void);
DH	*dh_new_group_fallback(int);

int	 dh_gen_key(DH *, int);
int	 dh_pub_is_valid(DH *, BIGNUM *);

u_int	 dh_estimate(int);

/*
 * Max value from RFC4419.
 * Miniumum increased in light of DH precomputation attacks.
 */
#define DH_GRP_MIN	2048
#define DH_GRP_MAX	8192

/*
 * Values for "type" field of moduli(5)
 * Specifies the internal structure of the prime modulus.
 */
#define MODULI_TYPE_UNKNOWN		(0)
#define MODULI_TYPE_UNSTRUCTURED	(1)
#define MODULI_TYPE_SAFE		(2)
#define MODULI_TYPE_SCHNORR		(3)
#define MODULI_TYPE_SOPHIE_GERMAIN	(4)
#define MODULI_TYPE_STRONG		(5)

/*
 * Values for "tests" field of moduli(5)
 * Specifies the methods used in checking for primality.
 * Usually, more than one test is used.
 */
#define MODULI_TESTS_UNTESTED		(0x00)
#define MODULI_TESTS_COMPOSITE		(0x01)
#define MODULI_TESTS_SIEVE		(0x02)
#define MODULI_TESTS_MILLER_RABIN	(0x04)
#define MODULI_TESTS_JACOBI		(0x08)
#define MODULI_TESTS_ELLIPTIC		(0x10)


#endif
@


1.14
log
@increase the minimum modulus that we will send or accept in
diffie-hellman-group-exchange to 2048 bits; ok markus@@
@
text
@d1 1
a1 1
/* $OpenBSD: dh.h,v 1.13 2015/05/27 23:39:18 dtucker Exp $ */
d40 2
@


1.13
log
@Add a stronger (4k bit) fallback group that sshd can use when the moduli
file is missing or broken, sourced from RFC3526.  bz#2302, ok markus@@
(earlier version), djm@@
@
text
@d1 1
a1 1
/* $OpenBSD: dh.h,v 1.12 2015/01/19 20:16:15 markus Exp $ */
d47 5
a51 2
/* Min and max values from RFC4419. */
#define DH_GRP_MIN	1024
@


1.12
log
@adapt kex to sshbuf and struct ssh; ok djm@@
@
text
@d1 1
a1 1
/* $OpenBSD: dh.h,v 1.11 2013/10/08 11:42:13 dtucker Exp $ */
d40 1
@


1.11
log
@Increase the size of the Diffie-Hellman groups requested for a each symmetric
key size.  New values from NIST Special Publication 800-57 with the upper
limit specified by RFC4419.  Pointed out by Peter Backes, ok djm@@.
@
text
@d1 1
a1 1
/* $OpenBSD: dh.h,v 1.10 2008/06/26 09:19:40 djm Exp $ */
d41 1
a41 1
void	 dh_gen_key(DH *, int);
d44 1
a44 1
int	 dh_estimate(int);
@


1.10
log
@when loading moduli from /etc/moduli in sshd(8), check that they
are of the expected "safe prime" structure and have had
appropriate primality tests performed;
feedback and ok dtucker@@
@
text
@d1 1
a1 1
/* $OpenBSD: dh.h,v 1.9 2006/03/25 22:22:43 djm Exp $ */
d46 1
@


1.9
log
@standardise spacing in $OpenBSD$ tags; requested by deraadt@@
@
text
@d1 1
a1 1
/* $OpenBSD: dh.h,v 1.8 2004/06/13 12:53:24 djm Exp $ */
d48 24
@


1.8
log
@implement diffie-hellman-group14-sha1 kex method (trivial extension to
existing diffie-hellman-group1-sha1); ok markus@@
@
text
@d1 1
a1 1
/*	$OpenBSD: dh.h,v 1.7 2001/06/26 17:27:23 markus Exp $	*/
@


1.8.6.1
log
@upgrade to OpenSSH 4.4
@
text
@d1 1
a1 1
/* $OpenBSD: dh.h,v 1.9 2006/03/25 22:22:43 djm Exp $ */
@


1.8.8.1
log
@upgrade to OpenSSH 4.4
@
text
@d1 1
a1 1
/* $OpenBSD: dh.h,v 1.9 2006/03/25 22:22:43 djm Exp $ */
@


1.7
log
@remove comments from .h, since they are cut&paste from the .c files
and out of sync
@
text
@d1 1
a1 1
/*	$OpenBSD: dh.h,v 1.6 2001/06/26 06:32:52 itojun Exp $	*/
d39 1
@


1.7.10.1
log
@upgrade to OpenSSH 3.9
@
text
@d1 1
a1 1
/*	$OpenBSD: dh.h,v 1.8 2004/06/13 12:53:24 djm Exp $	*/
a38 1
DH	*dh_new_group14(void);
@


1.7.12.1
log
@upgrade to OpenSSH 3.9
@
text
@d1 1
a1 1
/*	$OpenBSD: dh.h,v 1.8 2004/06/13 12:53:24 djm Exp $	*/
a38 1
DH	*dh_new_group14(void);
@


1.6
log
@prototype pedant.  not very creative...
- () -> (void)
- no variable names
@
text
@d1 1
a1 1
/*	$OpenBSD: dh.h,v 1.5 2001/04/03 19:53:29 markus Exp $	*/
d40 2
a41 2
void	dh_gen_key(DH *, int);
int	dh_pub_is_valid(DH *, BIGNUM *);
d43 1
a43 1
int	dh_estimate(int);
@


1.5
log
@move kex to kex*.c, used dispatch_set() callbacks for kex. should
make rekeying easier.
@
text
@d1 1
a1 1
/*	$OpenBSD: dh.h,v 1.4 2001/03/29 21:17:39 markus Exp $	*/
d35 1
a35 1
DH	*choose_dh(int min, int nbits, int max);
d41 1
a41 1
int	dh_pub_is_valid(DH *dh, BIGNUM *dh_pub);
d43 1
a43 1
int	dh_estimate(int bits);
@


1.5.2.1
log
@Pull in OpenSSH-2.9.9
@
text
@d1 1
a1 1
/*	$OpenBSD: dh.h,v 1.7 2001/06/26 17:27:23 markus Exp $	*/
d35 1
a35 1
DH	*choose_dh(int, int, int);
d40 2
a41 2
void	 dh_gen_key(DH *, int);
int	 dh_pub_is_valid(DH *, BIGNUM *);
d43 1
a43 1
int	 dh_estimate(int);
@


1.5.2.2
log
@Merge OpenSSH 3.1, keeping /etc as configuration files directory.
(i.e. OpenSSH 3.1 + openbsd29_3.1.patch)
@
text
@@


1.4
log
@prepare for rekeying: move DH code to dh.c
@
text
@d1 1
a1 1
/*	$OpenBSD: dh.h,v 1.3 2001/03/27 17:46:49 provos Exp $	*/
d42 2
@


1.3
log
@make dh group exchange more flexible, allow min and max group size,
okay markus@@, deraadt@@
@
text
@d1 1
a1 1
/*	$OpenBSD: dh.h,v 1.2 2001/01/29 01:58:15 niklas Exp $	*/
d35 7
a41 1
DH *choose_dh(int min, int nbits, int max);
@


1.2
log
@$OpenBSD$
@
text
@d1 1
a1 1
/*	$OpenBSD$	*/
d35 4
a38 1
DH *choose_dh(int minbits);
@


1.1
log
@First rough implementation of the diffie-hellman group exchange.  The
client can ask the server for bigger groups to perform the diffie-hellman
in, thus increasing the attack complexity when using ciphers with longer
keys.  University of Windsor provided network, T the company.
@
text
@d1 2
@


1.1.2.1
log
@Pull in OpenSSH 2.5.0
@
text
@a0 2
/*	$OpenBSD: dh.h,v 1.2 2001/01/29 01:58:15 niklas Exp $	*/

@


1.1.2.2
log
@Pull in OpenSSH-2.5.1
@
text
@@


1.1.2.3
log
@Pull in OpenSSH-2.5.2 for 2.8 branch.
@
text
@@


1.1.2.4
log
@Pull in OpenSSH-2.9 to 2.8 branch.
@
text
@d1 1
a1 1
/*	$OpenBSD: dh.h,v 1.5 2001/04/03 19:53:29 markus Exp $	*/
d35 1
a35 12
DH	*choose_dh(int min, int nbits, int max);
DH	*dh_new_group_asc(const char *, const char *);
DH	*dh_new_group(BIGNUM *, BIGNUM *);
DH	*dh_new_group1(void);

void	dh_gen_key(DH *, int);
int	dh_pub_is_valid(DH *dh, BIGNUM *dh_pub);

int	dh_estimate(int bits);

#define DH_GRP_MIN	1024
#define DH_GRP_MAX	8192
@


1.1.2.5
log
@Pull in OpenSSH 2.9.9 to the 2.8 branch.
@
text
@d1 1
a1 1
/*	$OpenBSD: dh.h,v 1.7 2001/06/26 17:27:23 markus Exp $	*/
d35 1
a35 1
DH	*choose_dh(int, int, int);
d40 2
a41 2
void	 dh_gen_key(DH *, int);
int	 dh_pub_is_valid(DH *, BIGNUM *);
d43 1
a43 1
int	 dh_estimate(int);
@


1.1.4.1
log
@openssh-2.3.0 (again) for 2.7 branch
@
text
@@


1.1.4.2
log
@OpenSSH-2.5.1 for 2.7 patch branch
@
text
@a0 2
/*	$OpenBSD: dh.h,v 1.2 2001/01/29 01:58:15 niklas Exp $	*/

@


1.1.4.3
log
@Pull in OpenSSH-2.5.2 for 2.7 branch.
@
text
@@


