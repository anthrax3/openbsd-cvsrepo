head	1.5;
access;
symbols
	OPENBSD_2_7:1.2.0.2;
locks; strict;
comment	@ * @;


1.5
date	2000.08.01.19.01.42;	author provos;	state dead;
branches;
next	1.4;

1.4
date	2000.07.13.22.53.21;	author provos;	state Exp;
branches;
next	1.3;

1.3
date	2000.06.18.17.13.41;	author markus;	state Exp;
branches;
next	1.2;

1.2
date	2000.05.17.09.47.59;	author markus;	state Exp;
branches
	1.2.2.1;
next	1.1;

1.1
date	2000.05.17.08.20.15;	author markus;	state Exp;
branches;
next	;

1.2.2.1
date	2000.06.12.02.37.32;	author jason;	state Exp;
branches;
next	1.2.2.2;

1.2.2.2
date	2000.09.01.18.23.17;	author jason;	state dead;
branches;
next	;


desc
@@


1.5
log
@rename aux.c to util.c to help with cygwin port
@
text
@#include "includes.h"
RCSID("$OpenBSD: aux.c,v 1.4 2000/07/13 22:53:21 provos Exp $");

#include "ssh.h"

char *
chop(char *s)
{
	char *t = s;
	while (*t) {
		if(*t == '\n' || *t == '\r') {
			*t = '\0';
			return s;
		}
		t++;
	}
	return s;

}

void
set_nonblock(int fd)
{
	int val;
	if (isatty(fd)) {
		/* do not mess with tty's */
		debug("no set_nonblock for tty fd %d", fd);
		return;
	}
	val = fcntl(fd, F_GETFL, 0);
	if (val < 0) {
		error("fcntl(%d, F_GETFL, 0): %s", fd, strerror(errno));
		return;
	}
	if (val & O_NONBLOCK)
		return;
	debug("fd %d setting O_NONBLOCK", fd);
	val |= O_NONBLOCK;
	if (fcntl(fd, F_SETFL, val) == -1)
		error("fcntl(%d, F_SETFL, O_NONBLOCK): %s", fd, strerror(errno));
}

/* Characters considered whitespace in strsep calls. */
#define WHITESPACE " \t\r\n"

char *
strdelim(char **s)
{
	char *old;
	int wspace = 0;

	if (*s == NULL)
		return NULL;

	old = *s;

	*s = strpbrk(*s, WHITESPACE "=");
	if (*s == NULL)
		return (old);

	/* Allow only one '=' to be skipped */
	if (*s[0] == '=')
		wspace = 1;
	*s[0] = '\0';

	*s += strspn(*s + 1, WHITESPACE) + 1;
	if (*s[0] == '=' && !wspace)
		*s += strspn(*s + 1, WHITESPACE) + 1;

	return (old);
}
@


1.4
log
@allow multiple whitespace but only one '=' between tokens, bug report from
Ralf S. Engelschall <rse@@engelschall.com> but different fix. okay deraadt@@
@
text
@d2 1
a2 1
RCSID("$OpenBSD: aux.c,v 1.3 2000/06/18 17:13:41 markus Exp $");
@


1.3
log
@
do not mess with tty's. makes EDITOR=ed cvs commit work over ssh2
@
text
@d2 1
a2 1
RCSID("$OpenBSD: aux.c,v 1.2 2000/05/17 09:47:59 markus Exp $");
d41 30
@


1.2
log
@missing include
@
text
@d2 1
a2 1
RCSID("$OpenBSD: aux.c,v 1.1 2000/05/17 08:20:15 markus Exp $");
d25 5
@


1.2.2.1
log
@lovin' CVS... update patch branch to OpenSSH-2.1.1
@
text
@d2 1
a2 1
RCSID("$OpenBSD: aux.c,v 1.2 2000/05/17 09:47:59 markus Exp $");
@


1.2.2.2
log
@Pull in the rest of openssh-2.2.0 to 2.7 branch (luvin' cvs...)
@
text
@d2 1
a2 1
RCSID("$OpenBSD: aux.c,v 1.2.2.1 2000/06/12 02:37:32 jason Exp $");
@


1.1
log
@enable nonblocking IO for sshd w/ proto 1, too; split out common code
@
text
@d2 3
a4 1
RCSID("$OpenBSD: aux.c,v 1.12 2000/04/14 10:30:32 markus Exp $");
@

