head	1.8;
access;
symbols
	OPENBSD_6_1:1.8.0.10
	OPENBSD_6_1_BASE:1.8
	OPENBSD_6_0:1.8.0.6
	OPENBSD_6_0_BASE:1.8
	OPENBSD_5_9:1.8.0.2
	OPENBSD_5_9_BASE:1.8
	OPENBSD_5_8:1.8.0.4
	OPENBSD_5_8_BASE:1.8
	OPENBSD_5_7:1.7.0.18
	OPENBSD_5_7_BASE:1.7
	OPENBSD_5_6:1.7.0.22
	OPENBSD_5_6_BASE:1.7
	OPENBSD_5_5:1.7.0.20
	OPENBSD_5_5_BASE:1.7
	OPENBSD_5_4:1.7.0.16
	OPENBSD_5_4_BASE:1.7
	OPENBSD_5_3:1.7.0.14
	OPENBSD_5_3_BASE:1.7
	OPENBSD_5_2:1.7.0.12
	OPENBSD_5_2_BASE:1.7
	OPENBSD_5_1_BASE:1.7
	OPENBSD_5_1:1.7.0.10
	OPENBSD_5_0:1.7.0.8
	OPENBSD_5_0_BASE:1.7
	OPENBSD_4_9:1.7.0.6
	OPENBSD_4_9_BASE:1.7
	OPENBSD_4_8:1.7.0.4
	OPENBSD_4_8_BASE:1.7
	OPENBSD_4_7:1.7.0.2
	OPENBSD_4_7_BASE:1.7
	OPENBSD_4_6:1.6.0.18
	OPENBSD_4_6_BASE:1.6
	OPENBSD_4_5:1.6.0.14
	OPENBSD_4_5_BASE:1.6
	OPENBSD_4_4:1.6.0.12
	OPENBSD_4_4_BASE:1.6
	OPENBSD_4_3:1.6.0.10
	OPENBSD_4_3_BASE:1.6
	OPENBSD_4_2:1.6.0.8
	OPENBSD_4_2_BASE:1.6
	OPENBSD_4_1:1.6.0.6
	OPENBSD_4_1_BASE:1.6
	OPENBSD_4_0:1.6.0.4
	OPENBSD_4_0_BASE:1.6
	OPENBSD_3_9:1.6.0.2
	OPENBSD_3_9_BASE:1.6
	OPENBSD_3_8:1.5.0.4
	OPENBSD_3_8_BASE:1.5
	OPENBSD_3_7:1.5.0.2
	OPENBSD_3_7_BASE:1.5
	OPENBSD_3_6:1.4.0.6
	OPENBSD_3_6_BASE:1.4
	OPENBSD_3_5:1.4.0.4
	OPENBSD_3_5_BASE:1.4
	OPENBSD_3_4:1.4.0.2
	OPENBSD_3_4_BASE:1.4
	OPENBSD_3_3:1.3.0.18
	OPENBSD_3_3_BASE:1.3
	OPENBSD_3_2:1.3.0.16
	OPENBSD_3_2_BASE:1.3
	OPENBSD_3_1:1.3.0.14
	OPENBSD_3_1_BASE:1.3
	OPENBSD_3_0:1.3.0.12
	OPENBSD_3_0_BASE:1.3
	OPENBSD_2_9_BASE:1.3
	OPENBSD_2_9:1.3.0.10
	OPENBSD_2_8:1.3.0.8
	OPENBSD_2_8_BASE:1.3
	OPENBSD_2_7:1.3.0.6
	OPENBSD_2_7_BASE:1.3
	OPENBSD_2_6:1.3.0.4
	OPENBSD_2_6_BASE:1.3
	OPENBSD_2_5:1.3.0.2
	OPENBSD_2_5_BASE:1.3
	OPENBSD_2_4:1.1.0.8
	OPENBSD_2_4_BASE:1.1
	OPENBSD_2_3:1.1.0.6
	OPENBSD_2_3_BASE:1.1
	OPENBSD_2_2:1.1.0.4
	OPENBSD_2_2_BASE:1.1
	OPENBSD_2_1:1.1.0.2
	OPENBSD_2_1_BASE:1.1;
locks; strict;
comment	@ * @;


1.8
date	2015.03.15.00.41.28;	author millert;	state Exp;
branches;
next	1.7;
commitid	IbVxlqGw2UipKdDr;

1.7
date	2009.10.27.23.59.36;	author deraadt;	state Exp;
branches;
next	1.6;

1.6
date	2005.11.16.16.45.11;	author deraadt;	state Exp;
branches;
next	1.5;

1.5
date	2004.12.10.15.31.01;	author mickey;	state Exp;
branches;
next	1.4;

1.4
date	2003.06.25.22.41.24;	author deraadt;	state Exp;
branches;
next	1.3;

1.3
date	98.12.13.07.31.08;	author pjanzen;	state Exp;
branches;
next	1.2;

1.2
date	98.11.05.04.44.08;	author pjanzen;	state Exp;
branches;
next	1.1;

1.1
date	96.12.05.06.04.40;	author millert;	state Exp;
branches;
next	;


desc
@@


1.8
log
@tzfile.h is an internal header that should never have been installed.
What's worse, the tzfile.h that gets installed is over 20 years old
and doesn't match the real tzfile.h in libc/time.  This makes the
tree safe for /usr/include/tzfile.h removal.  The TM_YEAR_BASE
define has been moved to time.h temporarily until its usage is
replaced by 1900 in the tree.  Actual removal of tzfile.h is pending
a ports build.  Based on a diff from deraadt@@
@
text
@/*	$OpenBSD: ostern.c,v 1.7 2009/10/27 23:59:36 deraadt Exp $	*/

/*
 * Copyright (c) 1996 Wolfram Schneider <wosch@@FreeBSD.org>. Berlin.
 * All rights reserved.
 *
 * Redistribution and use in source and binary forms, with or without
 * modification, are permitted provided that the following conditions
 * are met:
 * 1. Redistributions of source code must retain the above copyright
 *    notice, this list of conditions and the following disclaimer.
 * 2. Redistributions in binary form must reproduce the above copyright
 *    notice, this list of conditions and the following disclaimer in the
 *    documentation and/or other materials provided with the distribution.
 *
 * THIS SOFTWARE IS PROVIDED BY THE AUTHOR AND CONTRIBUTORS ``AS IS'' AND
 * ANY EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT LIMITED TO, THE
 * IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE
 * ARE DISCLAIMED.  IN NO EVENT SHALL THE AUTHOR OR CONTRIBUTORS BE LIABLE
 * FOR ANY DIRECT, INDIRECT, INCIDENTAL, SPECIAL, EXEMPLARY, OR CONSEQUENTIAL
 * DAMAGES (INCLUDING, BUT NOT LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS
 * OR SERVICES; LOSS OF USE, DATA, OR PROFITS; OR BUSINESS INTERRUPTION)
 * HOWEVER CAUSED AND ON ANY THEORY OF LIABILITY, WHETHER IN CONTRACT, STRICT
 * LIABILITY, OR TORT (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY
 * OUT OF THE USE OF THIS SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF
 * SUCH DAMAGE.
 *
 * 	$Id: ostern.c,v 1.7 2009/10/27 23:59:36 deraadt Exp $
 */

#include <stdio.h>
#include <time.h>

#include "calendar.h"

/* return year day for Easter */

int
easter(int year)	/* 0 ... abcd, NOT since 1900 */
{
	int	e_a, e_b, e_c, e_d, e_e,e_f, e_g, e_h, e_i, e_k;
	int	e_l, e_m, e_n, e_p, e_q;

	/* silly, but it works */
	e_a = year % 19;
	e_b = year / 100;
	e_c = year % 100;

	e_d = e_b / 4;
	e_e = e_b % 4;
	e_f = (e_b + 8) / 25;
	e_g = (e_b + 1 - e_f) / 3;
	e_h = ((19 * e_a) + 15 + e_b - (e_d + e_g)) % 30;
	e_i = e_c / 4;
	e_k = e_c % 4;
	e_l = (32 + 2 * e_e + 2 * e_i - (e_h + e_k)) % 7;
	e_m = (e_a + 11 * e_h + 22 * e_l) / 451;
	e_n = (e_h + e_l + 114 - (7 * e_m)) / 31;
	e_p = (e_h + e_l + 114 - (7 * e_m)) % 31;
	e_p = e_p + 1;

	e_q = 31 + 28 + e_p;
	if (isleap(year))
		e_q++;

	if (e_n == 4)
	e_q += 31;

#if DEBUG
	printf("%d %d %d %d %d %d %d %d %d %d %d %d %d %d %d\n",
	    e_a, e_b, e_c, e_d, e_e, e_f, e_g, e_h,
	    e_i, e_k, e_l, e_m, e_n, e_p, e_q);
#endif

	return (e_q);
}
@


1.7
log
@rcsid[] and sccsid[] and copyright[] are essentially unmaintained (and
unmaintainable).  these days, people use source.  these id's do not provide
any benefit, and do hurt the small install media
(the 33,000 line diff is essentially mechanical)
ok with the idea millert, ok dms
@
text
@d1 1
a1 1
/*	$OpenBSD: ostern.c,v 1.6 2005/11/16 16:45:11 deraadt Exp $	*/
d28 1
a28 1
 * 	$Id: ostern.c,v 1.6 2005/11/16 16:45:11 deraadt Exp $
a32 1
#include <tzfile.h>
@


1.6
log
@knf & cleanup; mickey ok
@
text
@d1 1
a1 1
/*	$OpenBSD: ostern.c,v 1.5 2004/12/10 15:31:01 mickey Exp $	*/
d28 1
a28 1
 * 	$Id: ostern.c,v 1.5 2004/12/10 15:31:01 mickey Exp $
a29 4

#ifndef lint
static const char rcsid[] = "$OpenBSD: ostern.c,v 1.5 2004/12/10 15:31:01 mickey Exp $";
#endif /* not lint */
@


1.5
log
@cleanup extra includes and -Wall
@
text
@d1 1
a1 1
/*	$OpenBSD: ostern.c,v 1.4 2003/06/25 22:41:24 deraadt Exp $	*/
d28 1
a28 1
 * 	$Id: ostern.c,v 1.4 2003/06/25 22:41:24 deraadt Exp $
d32 1
a32 1
static const char rcsid[] = "$OpenBSD: ostern.c,v 1.4 2003/06/25 22:41:24 deraadt Exp $";
d43 2
a44 2
int easter (year)
    int year;            /* 0 ... abcd, NOT since 1900 */
d46 2
d49 21
a69 2
    int e_a, e_b, e_c, e_d, e_e,e_f, e_g, e_h, e_i, e_k,
        e_l, e_m, e_n, e_p, e_q;
d71 1
a71 23
    /* silly, but it works */
    e_a = year % 19;
    e_b = year / 100;
    e_c = year % 100;

    e_d = e_b / 4;
    e_e = e_b % 4;
    e_f = (e_b + 8) / 25;
    e_g = (e_b + 1 - e_f) / 3;
    e_h = ((19 * e_a) + 15 + e_b - (e_d + e_g)) % 30;
    e_i = e_c / 4;
    e_k = e_c % 4;
    e_l = (32 + 2 * e_e + 2 * e_i - (e_h + e_k)) % 7;
    e_m = (e_a + 11 * e_h + 22 * e_l) / 451;
    e_n = (e_h + e_l + 114 - (7 * e_m)) / 31;
    e_p = (e_h + e_l + 114 - (7 * e_m)) % 31;
    e_p = e_p + 1;

    e_q = 31 + 28 + e_p;
    if (isleap(year))
	    e_q++;

    if (e_n == 4)
d75 3
a77 1
    printf("%d %d %d %d %d %d %d %d %d %d %d %d %d %d %d\n", e_a , e_b , e_c , e_d , e_e , e_f , e_g , e_h , e_i , e_k , e_l , e_m , e_n  , e_p , e_q);
d80 1
a80 1
    return (e_q);
@


1.4
log
@bring in protos via headers
@
text
@d1 1
a1 1
/*	$OpenBSD: ostern.c,v 1.3 1998/12/13 07:31:08 pjanzen Exp $	*/
d28 1
a28 1
 * 	$Id: ostern.c,v 1.3 1998/12/13 07:31:08 pjanzen Exp $
d32 1
a32 1
static char rcsid[] = "$OpenBSD: ostern.c,v 1.3 1998/12/13 07:31:08 pjanzen Exp $";
a35 2
#include <stdlib.h>
#include <string.h>
@


1.3
log
@Show periodic events the correct number of times.
Calculate special events (Easter) correctly regardless of which year
they occur in (thus fixing user/562).
Keep locales and special event names from propogating from one user
to the next during "calendar -a".
Set up a framework to handle special events other than Easter (for instance,
Jewish events, eventually).
Various other fixes.
@
text
@d1 1
a1 1
/*	$OpenBSD: ostern.c,v 1.2 1998/11/05 04:44:08 pjanzen Exp $	*/
d28 1
a28 1
 * 	$Id: ostern.c,v 1.2 1998/11/05 04:44:08 pjanzen Exp $
d32 1
a32 1
static char rcsid[] = "$OpenBSD: ostern.c,v 1.2 1998/11/05 04:44:08 pjanzen Exp $";
d40 2
@


1.2
log
@Easter and Y2K leap year fix
@
text
@d1 1
a1 1
/*	$OpenBSD: ostern.c,v 1.1 1996/12/05 06:04:40 millert Exp $	*/
d28 1
a28 1
 * 	$Id: ostern.c,v 1.1 1996/12/05 06:04:40 millert Exp $
d32 1
a32 1
static char rcsid[] = "$OpenBSD: ostern.c,v 1.1 1996/12/05 06:04:40 millert Exp $";
d39 1
a39 2

#include "calendar.h"
a48 1
    extern int *cumdays;
d68 3
a70 1
    e_q = cumdays[3] + 1 + e_p;
a79 46
}

/* return year day for  Easter or easter depending days
 * Match: Easter([+-][0-9]+)?
 * e.g: Easter-2 is  Good Friday (2 days before Easter)
 */

int
geteaster(s, year)
	char *s;
        int year;
{
	register int offset = 0;
	extern struct fixs neaster;

#define EASTER "easter"
#define EASTERNAMELEN (sizeof(EASTER) - 1)

	if (strncasecmp(s, EASTER, EASTERNAMELEN) == 0)
	    s += EASTERNAMELEN;
	else if (   neaster.name != NULL
		 && strncasecmp(s, neaster.name, neaster.len) == 0
		)
	    s += neaster.len;
	else
	    return(0);

#if DEBUG
	printf("%s %d %d\n", s, year, EASTERNAMELEN);
#endif

	/* Easter+1  or Easter-2
	 *       ^            ^   */

	switch(*s) {

	case '-':
	case '+':
	    offset = atoi(s);
	    break;

	default:
	    offset = 0;
	}

	return (easter(year) + offset);
@


1.1
log
@FreeBSD calendar(1) + OpenBSD changes.
@
text
@d1 1
a1 1
/*	$OpenBSD: $	*/
d28 1
a28 1
 * 	$Id: ostern.c,v 1.5 1996/08/27 20:04:15 wosch Exp $
d32 1
a32 1
static char rcsid[] = "$OpenBSD: $";
d50 1
d70 1
a70 4
    e_q = 31 + 28;

    if (e_k == 0 && e_c != 0)
	e_q += 1;
a73 2

    e_q += e_p;
@

