head	1.54;
access;
symbols
	OPENBSD_5_7:1.53.0.2
	OPENBSD_5_7_BASE:1.53
	OPENBSD_5_6:1.52.0.20
	OPENBSD_5_6_BASE:1.52
	OPENBSD_5_5:1.52.0.18
	OPENBSD_5_5_BASE:1.52
	OPENBSD_5_4:1.52.0.14
	OPENBSD_5_4_BASE:1.52
	OPENBSD_5_3:1.52.0.12
	OPENBSD_5_3_BASE:1.52
	OPENBSD_5_2:1.52.0.10
	OPENBSD_5_2_BASE:1.52
	OPENBSD_5_1_BASE:1.52
	OPENBSD_5_1:1.52.0.8
	OPENBSD_5_0:1.52.0.6
	OPENBSD_5_0_BASE:1.52
	OPENBSD_4_9:1.52.0.4
	OPENBSD_4_9_BASE:1.52
	OPENBSD_4_8:1.52.0.2
	OPENBSD_4_8_BASE:1.52
	OPENBSD_4_7:1.33.0.2
	OPENBSD_4_7_BASE:1.33
	OPENBSD_4_6:1.31.0.10
	OPENBSD_4_6_BASE:1.31
	OPENBSD_4_5:1.31.0.6
	OPENBSD_4_5_BASE:1.31
	OPENBSD_4_4:1.31.0.4
	OPENBSD_4_4_BASE:1.31
	OPENBSD_4_3:1.31.0.2
	OPENBSD_4_3_BASE:1.31
	OPENBSD_4_2:1.30.0.2
	OPENBSD_4_2_BASE:1.30
	OPENBSD_4_1:1.28.0.2
	OPENBSD_4_1_BASE:1.28
	OPENBSD_4_0:1.27.0.2
	OPENBSD_4_0_BASE:1.27
	OPENBSD_3_9:1.18.0.8
	OPENBSD_3_9_BASE:1.18
	OPENBSD_3_8:1.18.0.6
	OPENBSD_3_8_BASE:1.18
	OPENBSD_3_7:1.18.0.4
	OPENBSD_3_7_BASE:1.18
	OPENBSD_3_6:1.18.0.2
	OPENBSD_3_6_BASE:1.18
	OPENBSD_3_5:1.17.0.2
	OPENBSD_3_5_BASE:1.17
	OPENBSD_3_4:1.15.0.2
	OPENBSD_3_4_BASE:1.15
	OPENBSD_3_3:1.14.0.4
	OPENBSD_3_3_BASE:1.14
	OPENBSD_3_2:1.14.0.2
	OPENBSD_3_2_BASE:1.14
	OPENBSD_3_1:1.12.0.2
	OPENBSD_3_1_BASE:1.12
	OPENBSD_3_0:1.11.0.2
	OPENBSD_3_0_BASE:1.11
	OPENBSD_2_9_BASE:1.10
	OPENBSD_2_9:1.10.0.6
	OPENBSD_2_8:1.10.0.4
	OPENBSD_2_8_BASE:1.10
	OPENBSD_2_7:1.10.0.2
	OPENBSD_2_7_BASE:1.10
	OPENBSD_2_6:1.9.0.6
	OPENBSD_2_6_BASE:1.9
	OPENBSD_2_5:1.9.0.4
	OPENBSD_2_5_BASE:1.9
	OPENBSD_2_4:1.9.0.2
	OPENBSD_2_4_BASE:1.9
	OPENBSD_2_3:1.8.0.4
	OPENBSD_2_3_BASE:1.8
	OPENBSD_2_2:1.8.0.2
	OPENBSD_2_2_BASE:1.8
	OPENBSD_2_1:1.6.0.2
	OPENBSD_2_1_BASE:1.6
	OPENBSD_2_0:1.3.0.2
	OPENBSD_2_0_BASE:1.3
	netbsd_1_1:1.1.1.1;
locks; strict;
comment	@ * @;


1.54
date	2015.04.24.18.05.21;	author nicm;	state dead;
branches;
next	1.53;
commitid	rYO6EyDAuDX1Hb8y;

1.53
date	2015.02.07.10.07.15;	author deraadt;	state Exp;
branches;
next	1.52;
commitid	PXiaGXVynCsWpGYh;

1.52
date	2010.07.02.07.32.16;	author nicm;	state Exp;
branches;
next	1.51;

1.51
date	2010.07.02.05.56.29;	author nicm;	state Exp;
branches;
next	1.50;

1.50
date	2010.07.02.05.52.48;	author nicm;	state Exp;
branches;
next	1.49;

1.49
date	2010.07.01.21.43.38;	author nicm;	state Exp;
branches;
next	1.48;

1.48
date	2010.07.01.21.28.01;	author nicm;	state Exp;
branches;
next	1.47;

1.47
date	2010.07.01.20.30.05;	author nicm;	state Exp;
branches;
next	1.46;

1.46
date	2010.06.30.00.26.49;	author nicm;	state Exp;
branches;
next	1.45;

1.45
date	2010.06.29.23.38.05;	author nicm;	state Exp;
branches;
next	1.44;

1.44
date	2010.06.29.23.32.52;	author nicm;	state Exp;
branches;
next	1.43;

1.43
date	2010.06.29.23.20.38;	author nicm;	state Exp;
branches;
next	1.42;

1.42
date	2010.06.29.23.10.56;	author nicm;	state Exp;
branches;
next	1.41;

1.41
date	2010.06.29.21.34.50;	author nicm;	state Exp;
branches;
next	1.40;

1.40
date	2010.06.29.20.57.33;	author nicm;	state Exp;
branches;
next	1.39;

1.39
date	2010.06.29.20.09.39;	author nicm;	state Exp;
branches;
next	1.38;

1.38
date	2010.06.29.18.39.18;	author nicm;	state Exp;
branches;
next	1.37;

1.37
date	2010.06.29.17.42.35;	author nicm;	state Exp;
branches;
next	1.36;

1.36
date	2010.06.29.16.44.38;	author nicm;	state Exp;
branches;
next	1.35;

1.35
date	2010.06.29.16.41.56;	author nicm;	state Exp;
branches;
next	1.34;

1.34
date	2010.06.29.05.55.37;	author nicm;	state Exp;
branches;
next	1.33;

1.33
date	2009.12.12.18.14.00;	author nicm;	state Exp;
branches;
next	1.32;

1.32
date	2009.12.12.13.38.09;	author nicm;	state Exp;
branches;
next	1.31;

1.31
date	2007.09.11.18.20.21;	author cloder;	state Exp;
branches;
next	1.30;

1.30
date	2007.06.25.15.57.28;	author jmc;	state Exp;
branches;
next	1.29;

1.29
date	2007.05.15.19.42.05;	author moritz;	state Exp;
branches;
next	1.28;

1.28
date	2006.11.06.19.37.21;	author millert;	state Exp;
branches;
next	1.27;

1.27
date	2006.08.18.03.06.18;	author jason;	state Exp;
branches;
next	1.26;

1.26
date	2006.06.06.23.24.52;	author deraadt;	state Exp;
branches;
next	1.25;

1.25
date	2006.03.17.21.43.51;	author deraadt;	state Exp;
branches;
next	1.24;

1.24
date	2006.03.17.19.39.46;	author deraadt;	state Exp;
branches;
next	1.23;

1.23
date	2006.03.17.19.17.13;	author moritz;	state Exp;
branches;
next	1.22;

1.22
date	2006.03.17.19.12.20;	author deraadt;	state Exp;
branches;
next	1.21;

1.21
date	2006.03.17.14.43.06;	author moritz;	state Exp;
branches;
next	1.20;

1.20
date	2006.03.16.21.13.12;	author moritz;	state Exp;
branches;
next	1.19;

1.19
date	2006.03.16.19.32.46;	author deraadt;	state Exp;
branches;
next	1.18;

1.18
date	2004.05.26.18.17.59;	author deraadt;	state Exp;
branches;
next	1.17;

1.17
date	2003.10.15.22.33.18;	author deraadt;	state Exp;
branches;
next	1.16;

1.16
date	2003.09.20.18.15.32;	author millert;	state Exp;
branches;
next	1.15;

1.15
date	2003.06.03.02.56.18;	author millert;	state Exp;
branches;
next	1.14;

1.14
date	2002.06.04.00.09.08;	author deraadt;	state Exp;
branches;
next	1.13;

1.13
date	2002.05.29.22.58.56;	author millert;	state Exp;
branches;
next	1.12;

1.12
date	2002.02.16.21.27.55;	author millert;	state Exp;
branches;
next	1.11;

1.11
date	2001.09.09.19.30.49;	author millert;	state Exp;
branches;
next	1.10;

1.10
date	2000.04.20.06.19.33;	author deraadt;	state Exp;
branches;
next	1.9;

1.9
date	98.07.12.05.27.03;	author todd;	state Exp;
branches;
next	1.8;

1.8
date	97.09.01.23.24.26;	author deraadt;	state Exp;
branches;
next	1.7;

1.7
date	97.08.22.22.42.08;	author millert;	state Exp;
branches;
next	1.6;

1.6
date	97.04.20.23.29.33;	author millert;	state Exp;
branches;
next	1.5;

1.5
date	97.04.02.01.47.03;	author millert;	state Exp;
branches;
next	1.4;

1.4
date	96.10.15.23.47.22;	author millert;	state Exp;
branches;
next	1.3;

1.3
date	96.06.26.05.40.47;	author deraadt;	state Exp;
branches;
next	1.2;

1.2
date	95.12.14.03.12.16;	author deraadt;	state Exp;
branches;
next	1.1;

1.1
date	95.10.18.08.46.17;	author deraadt;	state Exp;
branches
	1.1.1.1;
next	;

1.1.1.1
date	95.10.18.08.46.17;	author deraadt;	state Exp;
branches;
next	;


desc
@@


1.54
log
@Remove tip(1), superseded by cu(1).

ok deraadt sthen bmercer
@
text
@/*	$OpenBSD: tip.h,v 1.53 2015/02/07 10:07:15 deraadt Exp $	*/
/*	$NetBSD: tip.h,v 1.7 1997/04/20 00:02:46 mellon Exp $	*/

/*
 * Copyright (c) 1989, 1993
 *	The Regents of the University of California.  All rights reserved.
 *
 *
 * Redistribution and use in source and binary forms, with or without
 * modification, are permitted provided that the following conditions
 * are met:
 * 1. Redistributions of source code must retain the above copyright
 *    notice, this list of conditions and the following disclaimer.
 * 2. Redistributions in binary form must reproduce the above copyright
 *    notice, this list of conditions and the following disclaimer in the
 *    documentation and/or other materials provided with the distribution.
 * 3. Neither the name of the University nor the names of its contributors
 *    may be used to endorse or promote products derived from this software
 *    without specific prior written permission.
 *
 * THIS SOFTWARE IS PROVIDED BY THE REGENTS AND CONTRIBUTORS ``AS IS'' AND
 * ANY EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT LIMITED TO, THE
 * IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE
 * ARE DISCLAIMED.  IN NO EVENT SHALL THE REGENTS OR CONTRIBUTORS BE LIABLE
 * FOR ANY DIRECT, INDIRECT, INCIDENTAL, SPECIAL, EXEMPLARY, OR CONSEQUENTIAL
 * DAMAGES (INCLUDING, BUT NOT LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS
 * OR SERVICES; LOSS OF USE, DATA, OR PROFITS; OR BUSINESS INTERRUPTION)
 * HOWEVER CAUSED AND ON ANY THEORY OF LIABILITY, WHETHER IN CONTRACT, STRICT
 * LIABILITY, OR TORT (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY
 * OUT OF THE USE OF THIS SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF
 * SUCH DAMAGE.
 *
 *      @@(#)tip.h	8.1 (Berkeley) 6/6/93
 */

/*
 * tip - terminal interface program
 */

#include <sys/types.h>
#include <sys/file.h>
#include <sys/time.h>
#include <sys/wait.h>
#include <sys/ioctl.h>

#include <termios.h>
#include <signal.h>
#include <stdio.h>
#include <stdlib.h>
#include <string.h>
#include <pwd.h>
#include <ctype.h>
#include <setjmp.h>
#include <unistd.h>
#include <errno.h>
#include <err.h>
#include <limits.h>

/* tip paths. */
#define _PATH_ACULOG "/var/log/aculog"
#define _PATH_REMOTE "/etc/remote"

/* Variable table entry. */
typedef	struct {
	char	*v_name;	/* variable name */
	int	 v_flags;	/* type and flags */
	char	*v_abbrev;	/* possible abbreviation */

	char	*v_string;
	int	 v_number;
} value_t;
extern value_t	vtable[];	/* variable table */

#define V_STRING	01	/* string valued */
#define V_BOOL		02	/* true-false value */
#define V_NUMBER	04	/* numeric value */
#define V_CHAR		010	/* character value */
#define V_TYPEMASK	017

#define V_CHANGED	020	/* to show modification */
#define V_READONLY	040	/* variable is not writable */
#define V_INIT		0100	/* static data space used for initialization */

/* Variable table indexes. */
enum {
	BEAUTIFY = 0,
	BAUDRATE,
	CONNECT,
	DEVICE,
	EOFREAD,
	EOFWRITE,
	EOL,
	ESCAPE,
	EXCEPTIONS,
	FORCE,
	FRAMESIZE,
	HOST,
	LOG,
	PROMPT,
	RAISE,
	RAISECHAR,
	RECORD,
	REMOTE,
	SCRIPT,
	TABEXPAND,
	VERBOSE,
	SHELL,
	HOME,
	ECHOCHECK,
	DISCONNECT,
	TAND,
	LDELAY,
	CDELAY,
	ETIMEOUT,
	RAWFTP,
	HALFDUPLEX,
	LECHO,
	PARITY,
	HARDWAREFLOW,
	LINEDISC,
	DC
};

/*
 * Escape command table definitions --
 *   lookup in this table is performed when ``escapec'' is recognized
 *   at the begining of a line (as defined by the eolmarks variable).
*/

typedef
	struct {
		char	e_char;			/* char to match on */
		char	*e_help;		/* help string */
		void	(*e_func)(int);		/* command */
	}
	esctable_t;

extern int	vflag;		/* verbose during reading of .tiprc file */
extern int	noesc;		/* no escape `~' char */

struct termios	term;		/* current mode of terminal */
struct termios	defterm;	/* initial mode of terminal */
struct termios	defchars;	/* current mode with initial chars */
int	gotdefterm;

FILE	*fscript;		/* FILE for scripting */

int	FD;			/* open file descriptor to remote host */
int	vflag;			/* print .tiprc initialization sequence */
int	noesc;			/* no `~' escape char */
int	sfd;			/* for ~< operation */
pid_t	tipin_pid;		/* pid of tipin */
int	tipin_fd;		/* tipin side of socketpair */
pid_t	tipout_pid;		/* pid of tipout */
int	tipout_fd;		/* tipout side of socketpair */
volatile sig_atomic_t stop;	/* stop transfer session flag */
volatile sig_atomic_t quit;	/* same; but on other end */
volatile sig_atomic_t stoprompt;/* for interrupting a prompt session */
volatile sig_atomic_t timedout;	/* ~> transfer timedout */
int	bits8;			/* terminal is 8-bit mode */
#define STRIP_PAR	(bits8 ? 0377 : 0177)

char	fname[PATH_MAX];	/* file name buffer for ~< */
char	copyname[PATH_MAX];	/* file name buffer for ~> */
char	ccc;			/* synchronization character */
char	*uucplock;		/* name of lock file for uucp's */

int	odisc;			/* initial tty line discipline */
extern	int disc;		/* current tty discpline */

extern	char *__progname;	/* program name */

/* cmds.c */
char	*expand(char *);
void	 chdirectory(int);
void	 consh(int);
void	 cu_put(int);
void	 cu_take(int);
void	 finish(int);
void	 genbrk(int);
void	 getfl(int);
void	 listvariables(int);
void	 parwrite(int, char *, size_t);
void	 pipefile(int);
void	 pipeout(int);
void	 sendfile(int);
void	 setscript(void);
void	 shell(int);
void	 suspend(int);
void	 timeout(int);
void	 tipabort(char *);
void	 variable(int);

/* hunt.c */
int	 hunt(char *);

/* log.c */
void	 logent(char *, char *, char *);
void	 loginit(void);

/* remote.c */
char	*getremote(char *);

/* tip.c */
void	 con(void);
char	*ctrl(char);
char	*interp(char *);
int	 any(int, char *);
int	 prompt(char *, char *, size_t);
size_t	 size(char *);
void	 cleanup(int);
void	 help(int);
void	 parwrite(int, char *, size_t);
void	 raw(void);
void	 setparity(char *);
int	 ttysetup(int);
void	 unraw(void);

/* tipout.c */
void	tipout(void);

/* value.c */
void	vinit(void);
void	vlex(char *);
char   *vgetstr(int);
int	vgetnum(int);
void	vsetstr(int, char *);
void	vsetnum(int, int);
@


1.53
log
@remove unused cu(1) support in tip; it is supplied as a seperate
simpler binary written by nicm since 5.4
ok jsing dlg
@
text
@d1 1
a1 1
/*	$OpenBSD: tip.h,v 1.52 2010/07/02 07:32:16 nicm Exp $	*/
@


1.52
log
@Merge almost-empty pathnames.h into tip.h.
@
text
@d1 1
a1 1
/*	$OpenBSD: tip.h,v 1.51 2010/07/02 05:56:29 nicm Exp $	*/
a159 1
int	cumode;			/* simulating the "cu" program */
a192 3

/* cu.c */
void	 cumain(int, char **);
@


1.51
log
@Bye-bye vstring, and add value type checking code to vgetstr/vsetstr/etc.
@
text
@d1 1
a1 1
/*	$OpenBSD: tip.h,v 1.50 2010/07/02 05:52:48 nicm Exp $	*/
d59 4
a148 1
int	AC;			/* open file descriptor to dialer (v831 only) */
@


1.50
log
@Rewrite hunt() to put the "rotary action" into it rather than remote.c, and so
it isn't so stupid (returning a char * as a long which goes into an int to use
as a flag, ugh).
@
text
@d1 1
a1 1
/*	$OpenBSD: tip.h,v 1.49 2010/07/01 21:43:38 nicm Exp $	*/
a225 1
int	vstring(char *, char *);
@


1.49
log
@Split v_value into v_string/v_number, change macros to functions and lo let
there be type checking.
@
text
@d1 1
a1 1
/*	$OpenBSD: tip.h,v 1.48 2010/07/01 21:28:01 nicm Exp $	*/
d196 1
a196 1
long	 hunt(char *);
@


1.48
log
@Change variable get/set macros to have better names and drop boolean/character
ones.
@
text
@d1 1
a1 1
/*	$OpenBSD: tip.h,v 1.47 2010/07/01 20:30:05 nicm Exp $	*/
d64 4
a67 2
	char	*v_value;	/* casted to a union later */
}  value_t;
a79 10
#define vgetstr(v)	(vtable[v].v_value)
#define	vgetnum(v)	((long)(vtable[v].v_value))

#define vsetstr(v, s) do {				\
		vtable[v].v_value = s;			\
	} while (0)
#define	vsetnum(v, n) do {				\
		vtable[v].v_value = (char *)(long)(n);	\
	} while (0)

d227 4
@


1.47
log
@Kill a couple of macros, move a few bits around in header.
@
text
@d1 1
a1 1
/*	$OpenBSD: tip.h,v 1.46 2010/06/30 00:26:49 nicm Exp $	*/
d78 2
a79 1
#define value(v)	vtable[v].v_value
d81 6
a86 7
#define	number(v)	((long)(v))
#define	boolean(v)      ((short)(long)(v))
#define	character(v)    ((char)(long)(v))

#define	setnumber(v,n)		do { (v) = (char *)(long)(n); } while (0)
#define	setboolean(v,n)		do { (v) = (char *)(long)(n); } while (0)
#define	setcharacter(v,n)	do { (v) = (char *)(long)(n); } while (0)
d88 1
a88 21
/*
 * Escape command table definitions --
 *   lookup in this table is performed when ``escapec'' is recognized
 *   at the begining of a line (as defined by the eolmarks variable).
*/

typedef
	struct {
		char	e_char;			/* char to match on */
		char	*e_help;		/* help string */
		void	(*e_func)(int);		/* command */
	}
	esctable_t;

extern int	vflag;		/* verbose during reading of .tiprc file */
extern int	noesc;		/* no escape `~' char */

/*
 * Definition of indices into variable table so
 *  value(DEFINE) turns into a static address.
 */
d127 17
@


1.46
log
@Only two variables - HOME and SHELL - are from the environment, so just fill
them in explicitly and get rid of the ENVIRON flag.
@
text
@d1 1
a1 1
/*	$OpenBSD: tip.h,v 1.45 2010/06/29 23:38:05 nicm Exp $	*/
d59 1
a59 3
/*
 * String value table
 */
d66 1
a77 7
/*
 * variable manipulation stuff --
 *   if we defined the value entry in value_t, then we couldn't
 *   initialize it in vars.c, so we cast it as needed to keep lint
 *   happy.
 */

a78 1
#define lvalue(v)	(long)vtable[v].v_value
a82 1
#define	address(v)      ((long *)(v))
a86 1
#define	setaddress(v,n)		do { (v) = (char *)(n); } while (0)
a103 1
extern value_t	vtable[];	/* variable table */
@


1.45
log
@Add new read-only vtable entries for device and connection string and use those
instead of variables.
@
text
@d1 1
a1 1
/*	$OpenBSD: tip.h,v 1.44 2010/06/29 23:32:52 nicm Exp $	*/
d77 1
a77 3

#define V_ENVIRON	0100	/* initialize out of the environment */
#define V_INIT		0400	/* static data space used for initialization */
@


1.44
log
@Since dial-up is no longer supported, no need to store a phone number, or
accept one to cu(1).
@
text
@d1 1
a1 1
/*	$OpenBSD: tip.h,v 1.43 2010/06/29 23:20:38 nicm Exp $	*/
a59 7
 * Remote host attributes
 */
char	*DV;			/* UNIX device(s) to open */
char	*CM;			/* initial connection message */
char	*DI;			/* disconnect string */

/*
d126 2
@


1.43
log
@Do the same for di, es, fo, rc and remove their remote variables.
@
text
@d1 1
a1 1
/*	$OpenBSD: tip.h,v 1.42 2010/06/29 23:10:56 nicm Exp $	*/
a63 1
char	*PN;			/* phone number(s) */
@


1.42
log
@For every variable which has a value table entry with IREMOTE, remove the
remote variable and always use the value from the vtable. This then allows the
IREMOTE flag to be removed.
@
text
@d1 1
a1 1
/*	$OpenBSD: tip.h,v 1.41 2010/06/29 21:34:50 nicm Exp $	*/
a65 5

char	*ES;			/* escape character */
char	*FO;			/* force (literal next) char*/
char	*RC;			/* raise character */
char	*PR;			/* remote prompt */
@


1.41
log
@Merge v_type and v_access into one v_flags member in value_t, get rid of TRUE
and FALSE, and rename the other flags to have a V_ prefix.
@
text
@d1 1
a1 1
/*	$OpenBSD: tip.h,v 1.40 2010/06/29 20:57:33 nicm Exp $	*/
a62 1
char	*EL;			/* chars marking an EOL */
a63 2
char	*IE;			/* EOT to expect on input */
char	*OE;			/* EOT to send to complete FT */
a65 7
char	*PA;			/* parity to be generated */

char	*RM;			/* remote file name */
char	*HO;			/* host name */

long	BR;			/* line speed for conversation */
long	FS;			/* frame size for transfers */
a67 1
char	*EX;			/* exceptions */
a69 1
char	*RE;			/* script record file */
a70 5
long	DL;			/* line delay for file transfers to remote */
long	CL;			/* char delay for file transfers to remote */
long	ET;			/* echocheck timeout */
long	LD;			/* line disc */
short	HD;			/* this host is half duplex - do local echo */
d82 4
a85 4
#define V_STRING	01		/* string valued */
#define V_BOOL		02		/* true-false value */
#define V_NUMBER	04		/* numeric value */
#define V_CHAR		010		/* character value */
d88 2
a89 2
#define V_CHANGED	020		/* to show modification */
#define V_READONLY	040		/* variable is not writable */
d91 2
a92 3
#define V_ENVIRON	0100		/* initialize out of the environment */
#define V_IREMOTE	0200		/* initialize out of remote structure */
#define V_INIT		0400		/* static data space used for initialization */
@


1.40
log
@tip is no longer setuid or setgid so get rid of the complicated
public/private/root permissions scheme for options in favour of a single
read-only bit.
@
text
@d1 1
a1 1
/*	$OpenBSD: tip.h,v 1.39 2010/06/29 20:09:39 nicm Exp $	*/
d92 19
a110 28
typedef
	struct {
		char	*v_name;	/* whose name is it */
		char	v_type;		/* for interpreting set's */
		char	v_access;	/* protection of touchy ones */
		char	*v_abrev;	/* possible abreviation */
		char	*v_value;	/* casted to a union later */
	}
	value_t;

#define STRING	01		/* string valued */
#define BOOL	02		/* true-false value */
#define NUMBER	04		/* numeric value */
#define CHAR	010		/* character value */

#define WRITE	01		/* write access to variable */
#define	READ	02		/* read access */

#define CHANGED	01		/* used to show modification */
#define READONLY 02		/* variable is not writable */

#define	TRUE	1
#define FALSE	0

#define ENVIRON	020		/* initialize out of the environment */
#define IREMOTE	040		/* initialize out of remote structure */
#define INIT	0100		/* static data space used for initialization */
#define TMASK	017
@


1.39
log
@Use the libutil implementation of UUCP locking.
@
text
@d1 1
a1 1
/*	$OpenBSD: tip.h,v 1.38 2010/06/29 18:39:18 nicm Exp $	*/
d110 2
a111 4
#define CHANGED	01		/* low bit is used to show modification */
#define PUBLIC	1		/* public access rights */
#define PRIVATE	03		/* private to definer */
#define ROOT	05		/* root defined */
@


1.38
log
@Remove now unused prototypes and sort by file.
@
text
@d1 1
a1 1
/*	$OpenBSD: tip.h,v 1.37 2010/06/29 17:42:35 nicm Exp $	*/
a286 4

/* uucplock.c */
int	uu_lock(char *);
int	uu_unlock(char *);
@


1.37
log
@Now that there is no dial-up support, all connections are hardwired so drop the
flag and ignore the -t option to cu(1).
@
text
@d1 1
a1 1
/*	$OpenBSD: tip.h,v 1.36 2010/06/29 16:44:38 nicm Exp $	*/
d236 1
a236 2
void	con(void);
char	*ctrl(char);
d238 30
d269 4
d274 15
a288 14
int	any(int, char *);
int	biz22w_dialer(char *, char *);
int	biz22f_dialer(char *, char *);
int	biz31w_dialer(char *, char *);
int	biz31f_dialer(char *, char *);
int	cour_dialer(char *, char *);
int	df02_dialer(char *, char *);
int	df03_dialer(char *, char *);
int	dn_dialer(char *, char *);
int	hay_dialer(char *, char *);
int	prompt(char *, char *, size_t);
size_t	size(char *);
int	t3000_dialer(char *, char *);
int	ttysetup(int);
d291 2
a292 53
int	v3451_dialer(char *, char *);
int	v831_dialer(char *, char *);
int	ven_dialer(char *, char *);
int	vstring(char *, char *);
long	hunt(char *);
void	biz22_disconnect(void);
void	biz22_abort(void);
void	biz31_disconnect(void);
void	biz31_abort(void);
void	chdirectory(int);
void	cleanup(int);
void	consh(int);
void	cour_abort(void);
void	cour_disconnect(void);
void	cu_put(int);
void	cu_take(int);
void	cumain(int, char **);
void	df_abort(void);
void	df_disconnect(void);
void	disconnect(void);
void	dn_abort(void);
void	dn_disconnect(void);
void	finish(int);
void	genbrk(int);
void	getfl(int);
void	hay_abort(void);
void	hay_disconnect(void);
void	help(int);
void	listvariables(int);
void	logent(char *, char *, char *);
void	loginit(void);
void	parwrite(int, char *, size_t);
void	pipefile(int);
void	pipeout(int);
void	raw(void);
void	sendfile(int);
void	setparity(char *);
void	setscript(void);
void	shell(int);
void	suspend(int);
void	t3000_disconnect(void);
void	t3000_abort(void);
void	timeout(int);
void	tipabort(char *);
void	tipout(void);
void	unraw(void);
void	v3451_abort(void);
void	v3451_disconnect(void);
void	v831_disconnect(void);
void	v831_abort(void);
void	variable(int);
void	ven_disconnect(void);
void	ven_abort(void);
d295 1
@


1.36
log
@Nuke -DCONNECT and -DACULOG which we always set, also trim huge useless comment
from Makefile.
@
text
@d1 1
a1 1
/*	$OpenBSD: tip.h,v 1.35 2010/06/29 16:41:56 nicm Exp $	*/
a76 1
short	HW;			/* this device is hardwired, see hunt.c */
@


1.35
log
@Bye-bye acu which even UUCP-using naddy agrees "was obsolete 20 years ago" :-).
@
text
@d1 1
a1 1
/*	$OpenBSD: tip.h,v 1.34 2010/06/29 05:55:37 nicm Exp $	*/
a161 5
#ifndef ACULOG
#define logent(a, b, c)
#define loginit()
#endif

a165 1

@


1.34
log
@Replace "nice" strcmp() wrapper macro with strcmp.

ok jsing
@
text
@d1 1
a1 1
/*	$OpenBSD: tip.h,v 1.33 2009/12/12 18:14:00 nicm Exp $	*/
a66 2
char	*CU;			/* call unit if making a phone call */
char	*AT;			/* acu type */
a70 1
char	*PH;			/* phone number file */
a76 1
short	DU;			/* this host is dialed up */
a124 12
 * Definition of ACU line description
 */
typedef
	struct {
		char	*acu_name;
		int	(*acu_dialer)(char *, char *);
		void	(*acu_disconnect)(void);
		void	(*acu_abort)(void);
	}
	acu_t;

/*
d163 1
a163 1
#define logent(a, b, c, d)
d172 36
a207 36
#define BEAUTIFY	0
#define BAUDRATE	1
#define DIALTIMEOUT	2
#define EOFREAD		3
#define EOFWRITE	4
#define EOL		5
#define ESCAPE		6
#define EXCEPTIONS	7
#define FORCE		8
#define FRAMESIZE	9
#define HOST		10
#define LOG		11
#define PHONES		12
#define PROMPT		13
#define RAISE		14
#define RAISECHAR	15
#define RECORD		16
#define REMOTE		17
#define SCRIPT		18
#define TABEXPAND	19
#define VERBOSE		20
#define SHELL		21
#define HOME		22
#define ECHOCHECK	23
#define DISCONNECT	24
#define TAND		25
#define LDELAY		26
#define CDELAY		27
#define ETIMEOUT	28
#define RAWFTP		29
#define HALFDUPLEX	30
#define	LECHO		31
#define	PARITY		32
#define	HARDWAREFLOW	33
#define	LINEDISC	34
#define	DC		35
d243 1
a243 1
char	*con(void);
d283 1
a283 1
void	disconnect(char *);
d293 1
a293 1
void	logent(char *, char *, char *, char *);
@


1.33
log
@tip is not setuid or setgid anymore and there are no PRIV/EXPR commands, so
remove the code.

ok deraadt
@
text
@d1 1
a1 1
/*	$OpenBSD: tip.h,v 1.32 2009/12/12 13:38:09 nicm Exp $	*/
a138 2

#define	equal(a, b)	(strcmp(a,b)==0)/* A nice function to string compare */
@


1.32
log
@Use a socketpair instead of a pair of pipes.

looks ok to millert@@
@
text
@d1 1
a1 1
/*	$OpenBSD: tip.h,v 1.31 2007/09/11 18:20:21 cloder Exp $	*/
a170 1
		char	e_flags;		/* experimental, privileged */
a175 4
#define NORM	00		/* normal protection, execute anyone */
#define EXP	01		/* experimental, mark it with a `*' on help */
#define PRIV	02		/* privileged, root execute only */

a242 2
uid_t	uid, euid;		/* real and effective user id's */
gid_t	gid, egid;		/* real and effective group id's */
a298 1
void	daemon_uid(void);
a320 1
void	shell_uid(void);
a326 1
void	user_uid(void);
@


1.31
log
@Use sig_atomic_t where required. OK moritz, deraadt
@
text
@d1 1
a1 1
/*	$OpenBSD: tip.h,v 1.30 2007/06/25 15:57:28 jmc Exp $	*/
a238 2
int	fildes[2];		/* file transfer synchronization channel */
int	repdes[2];		/* read process sychronization channel */
d245 1
d247 1
@


1.30
log
@kill "is is"; from Charles Longeau
@
text
@d1 1
a1 1
/*	$OpenBSD: tip.h,v 1.29 2007/05/15 19:42:05 moritz Exp $	*/
d250 4
a253 5
int	stop;			/* stop transfer session flag */
int	quit;			/* same; but on other end */
int	intflag;		/* recognized interrupt */
int	stoprompt;		/* for interrupting a prompt session */
int	timedout;		/* ~> transfer timedout */
@


1.29
log
@Remove useless NOxxx defines and use NULL instead.
No binary change.

OK ray@@
@
text
@d1 1
a1 1
/*	$OpenBSD: tip.h,v 1.28 2006/11/06 19:37:21 millert Exp $	*/
d256 1
a256 1
int	bits8;			/* terminal is is 8-bit mode */
@


1.28
log
@Replace -### with -s### pre-getopt() and use strtonum()
instead of strtol() when parsing the speed string.  Closes PR 5222.
@
text
@d1 1
a1 1
/*	$OpenBSD: tip.h,v 1.27 2006/08/18 03:06:18 jason Exp $	*/
a230 6

#define NOVAL	((value_t *)NULL)
#define NOACU	((acu_t *)NULL)
#define NOSTR	((char *)NULL)
#define NOFILE	((FILE *)NULL)
#define NOPWD	((struct passwd *)0)
@


1.27
log
@tip/cu always set "dc" because the code was reading from the wrong value
in the array.  Point it at the correct chunk of memory.  For now, also
preserve the old ":dc:" is always set behavior.
ok deraadt
@
text
@d1 1
a1 1
/*	$OpenBSD: tip.h,v 1.26 2006/06/06 23:24:52 deraadt Exp $	*/
d56 1
@


1.26
log
@teach tip about line disciplines; tried by mbalmer too
@
text
@d1 1
a1 1
/*	$OpenBSD: tip.h,v 1.25 2006/03/17 21:43:51 deraadt Exp $	*/
a91 1
short	DC;			/* this host is directly connected. */
d229 1
@


1.25
log
@size_t size()
@
text
@d1 1
a1 1
/*	$OpenBSD: tip.h,v 1.24 2006/03/17 19:39:46 deraadt Exp $	*/
d90 1
d229 1
@


1.24
log
@more cleanups; ok moritz
@
text
@d1 1
a1 1
/*	$OpenBSD: tip.h,v 1.23 2006/03/17 19:17:13 moritz Exp $	*/
d288 1
a288 1
int	size(char *);
@


1.23
log
@ansification and correct prototypes. ok deraadt@@
@
text
@d1 1
a1 1
/*	$OpenBSD: tip.h,v 1.22 2006/03/17 19:12:20 deraadt Exp $	*/
d325 1
a325 1
void	parwrite(int, char *, int);
@


1.22
log
@global not needed; ok moritz
@
text
@d1 1
a1 1
/*	$OpenBSD: tip.h,v 1.21 2006/03/17 14:43:06 moritz Exp $	*/
d133 3
a135 3
		int	(*acu_dialer)();
		int	(*acu_disconnect)();
		int	(*acu_abort)();
d278 9
d289 1
d293 3
d298 4
d305 2
d311 2
d314 2
d319 2
d335 2
d342 4
d347 2
@


1.21
log
@big prototype cleanup:

o make more functions static
o add all the prototypes to tip.h
o consistently declare functions in the cmd table

testing and ok dhill@@
@
text
@d1 1
a1 1
/*	$OpenBSD: tip.h,v 1.20 2006/03/16 21:13:12 moritz Exp $	*/
d149 1
a264 1
char	ch;			/* for tipout */
@


1.20
log
@Fix bug that was uncovered by adding correct prototypes and
remove lots of names from func declarations. ok dhill@@
@
text
@d1 1
a1 1
/*	$OpenBSD: tip.h,v 1.19 2006/03/16 19:32:46 deraadt Exp $	*/
d171 1
a171 1
		int	(*e_func)(int);		/* command */
d272 4
a275 5
extern	char *ctrl(char);
extern	char *vinterp(char *, int);
extern	char *con(void);

char	*sname(char *);
a277 3
int	anyof(char *, char *);
int	args(char *, char **, int);
int	escape(void);
d285 5
d293 5
a297 2
void	execute(char *);
void	hardwareflow(char *);
a299 1
void	prtime(char *, time_t);
d301 2
d304 1
a304 1
void	send(int);
d307 1
d309 2
a310 1
void	tandem(char *);
a311 1
void	tipin(void);
d313 1
a313 2
void	transfer(char *, int, char *);
void	transmit(FILE *, char *, char *);
d315 1
a315 1
void	user_uid(void);
@


1.19
log
@first pass of cleanup of this mess; ok dhill
@
text
@d1 1
a1 1
/*	$OpenBSD: tip.h,v 1.18 2004/05/26 18:17:59 deraadt Exp $	*/
d272 1
a272 1
extern	char *ctrl(char c);
d276 5
a280 4
char	*sname(char *s);
int	any(int cc, char *p);
int	anyof(char *s1, char *s2);
int	args(char *buf, char *a[], int num);
d282 8
a289 8
int	prompt(char *s, char *p, size_t sz);
int	size(char *s);
int	ttysetup(int speed);
int	uu_lock(char *ttyname);
int	uu_unlock(char *ttyname);
int	vstring(char *s, char *v);
long	hunt(char *name);
void	cumain(int argc, char *argv[]);
d291 4
a294 4
void	disconnect(char *reason);
void	execute(char *s);
void	hardwareflow(char *option);
void	logent(char *group, char *num, char *acu, char *message);
d296 2
a297 2
void	prtime(char *s, time_t a);
void	parwrite(int fd, char *buf, int n);
d299 2
a300 2
void	send(int c);
void	setparity(char *defparity);
d303 2
a304 2
void	tandem(char *option);
void	tipabort(char *msg);
d307 2
a308 2
void	transfer(char *buf, int fd, char *eofchars);
void	transmit(FILE *fd, char *eofchars, char *command);
d312 1
a312 1
void	vlex(char *s);
@


1.18
log
@if one process is killed, kill the other ourself; various ok
@
text
@d1 1
a1 1
/*	$OpenBSD: tip.h,v 1.17 2003/10/15 22:33:18 deraadt Exp $	*/
d168 4
a171 4
		char	e_char;		/* char to match on */
		char	e_flags;	/* experimental, privileged */
		char	*e_help;	/* help string */
		int 	(*e_func)();	/* command */
d272 3
a274 3
extern	char *ctrl();
extern	char *vinterp();
extern	char *connect();
@


1.17
log
@on fatal error, repair tty; millert ok
@
text
@d1 1
a1 1
/*	$OpenBSD: tip.h,v 1.16 2003/09/20 18:15:32 millert Exp $	*/
d248 2
a249 1
int	pid;			/* pid of tipout */
@


1.16
log
@Implement hardwareflow varable in tip(1) like Solaris and hf in /etc/remote.
Based on PR 3411 from Matthew Gream
Also document "tandem" variable (XON/XOFF) in tip man page.
@
text
@d1 1
a1 1
/*	$OpenBSD: tip.h,v 1.15 2003/06/03 02:56:18 millert Exp $	*/
d237 1
@


1.15
log
@Remove the advertising clause in the UCB license which Berkeley
rescinded 22 July 1999.  Proofed by myself and Theo.
@
text
@d1 1
a1 1
/*	$OpenBSD: tip.h,v 1.14 2002/06/04 00:09:08 deraadt Exp $	*/
d226 1
d290 1
@


1.14
log
@spelling; raj@@cerias.purdue.edu
@
text
@d1 1
a1 1
/*	$OpenBSD: tip.h,v 1.13 2002/05/29 22:58:56 millert Exp $	*/
d17 1
a17 5
 * 3. All advertising materials mentioning features or use of this software
 *    must display the following acknowledgement:
 *	This product includes software developed by the University of
 *	California, Berkeley and its contributors.
 * 4. Neither the name of the University nor the names of its contributors
@


1.13
log
@Don't hard-code a list of allowed baud rates.  Instead, accept
anything but check the return value of tcsetattr() and error out
if it fails.  This way we accept any baud rate the serial driver
will support.  mickey@@ OK
@
text
@d1 1
a1 1
/*	$OpenBSD: tip.h,v 1.12 2002/02/16 21:27:55 millert Exp $	*/
d173 1
a173 1
		char	e_flags;	/* experimental, priviledged */
d181 1
a181 1
#define PRIV	02		/* priviledged, root execute only */
@


1.12
log
@Part one of userland __P removal.  Done with a simple regexp with some minor hand editing to make comments line up correctly.  Another pass is forthcoming that handles the cases that could not be done automatically.
@
text
@d1 1
a1 1
/*	$OpenBSD: tip.h,v 1.11 2001/09/09 19:30:49 millert Exp $	*/
d284 1
a284 1
int	speed(int n);
a307 1
void	ttysetup(int speed);
@


1.11
log
@implement some more command line options for cu and use getopt(3)
@
text
@d1 1
a1 1
/*	$OpenBSD: tip.h,v 1.10 2000/04/20 06:19:33 deraadt Exp $	*/
d277 36
a312 36
char	*sname __P((char *s));
int	any __P((int cc, char *p));
int	anyof __P((char *s1, char *s2));
int	args __P((char *buf, char *a[], int num));
int	escape __P((void));
int	prompt __P((char *s, char *p, size_t sz));
int	size __P((char *s));
int	speed __P((int n));
int	uu_lock __P((char *ttyname));
int	uu_unlock __P((char *ttyname));
int	vstring __P((char *s, char *v));
long	hunt __P((char *name));
void	cumain __P((int argc, char *argv[]));
void	daemon_uid __P((void));
void	disconnect __P((char *reason));
void	execute __P((char *s));
void	logent __P((char *group, char *num, char *acu, char *message));
void	loginit __P((void));
void	prtime __P((char *s, time_t a));
void	parwrite __P((int fd, char *buf, int n));
void	raw __P((void));
void	send __P((int c));
void	setparity __P((char *defparity));
void	setscript __P((void));
void	shell_uid __P((void));
void	tandem __P((char *option));
void	tipabort __P((char *msg));
void	tipin __P((void));
void	tipout __P((void));
void	transfer __P((char *buf, int fd, char *eofchars));
void	transmit __P((FILE *fd, char *eofchars, char *command));
void	ttysetup __P((int speed));
void	unraw __P((void));
void	user_uid __P((void));
void	vinit __P((void));
void	vlex __P((char *s));
@


1.10
log
@avoid naming something pwrite()
@
text
@d1 1
a1 1
/*	$OpenBSD: tip.h,v 1.9 1998/07/12 05:27:03 todd Exp $	*/
d268 4
a271 2
int	odisc;				/* initial tty line discipline */
extern	int disc;			/* current tty discpline */
@


1.9
log
@add no escape option (-n)
@
text
@d1 1
a1 1
/*	$OpenBSD: tip.h,v 1.8 1997/09/01 23:24:26 deraadt Exp $	*/
d294 1
a294 1
void	pwrite __P((int fd, char *buf, int n));
@


1.8
log
@Wall pass, and oflow fix from eivind@@bitbox.follo.net
@
text
@d1 1
a1 1
/*	$OpenBSD: tip.h,v 1.7 1997/08/22 22:42:08 millert Exp $	*/
d184 1
d248 1
@


1.7
log
@Buf oflow fix from Warner Losh <imp@@rover.village.org>
@
text
@d1 1
a1 1
/*	$OpenBSD: tip.h,v 1.6 1997/04/20 23:29:33 millert Exp $	*/
d47 2
d272 37
@


1.6
log
@Incorporate some NetBSD changes:
tip.c
    getchar() returns an int [important since EOF == -1] (thorpej)
    Set CLOCAL if dc flag is set (mellon)
tip.h
    Change booleans from char to short so that comparisons against negative
    values work as expected on systems with unsigned chars. (thorpej)
    Add boolean for dc flag (mellon)
hunt.c
    Set O_NONBLOCK if dc flag set. Don't set HUPCL if dc flag is set. (mellon)
remote.c
    Add boolean for dc flag (mellon)
@
text
@d1 1
a1 1
/*	$OpenBSD: tip.h,v 1.5 1997/04/02 01:47:03 millert Exp $	*/
d58 1
d258 2
a259 2
char	fname[80];		/* file name buffer for ~< */
char	copyname[80];		/* file name buffer for ~> */
@


1.5
log
@Merge in good changes from NetBSD:
    Compile in strcict ansi (some day I'll get around to -Wall)
    use set* functions instead of modifying the lvalue
    Change a few sprintf() to snprintf() where it coudl possibly matter.
    Replace zzhack stuff with something saner to make tip work on alpha
@
text
@d1 2
a2 2
/*	$OpenBSD: tip.h,v 1.4 1996/10/15 23:47:22 millert Exp $	*/
/*	$NetBSD: tip.h,v 1.5 1996/12/29 10:34:11 cgd Exp $	*/
d80 2
a81 2
char	DU;			/* this host is dialed up */
char	HW;			/* this device is hardwired, see hunt.c */
d91 2
a92 1
char	HD;			/* this host is half duplex - do local echo */
@


1.4
log
@Possible buf oflow + index -> strchr.
@
text
@d1 2
a2 2
/*	$OpenBSD: tip.h,v 1.3 1996/06/26 05:40:47 deraadt Exp $	*/
/*	$NetBSD: tip.h,v 1.4 1995/10/29 00:49:43 pk Exp $	*/
a146 8
typedef
	union {
		int	zz_number;
		short	zz_boolean[2];
		char	zz_character[4];
		int	*zz_address;
	}
	zzhack;
d150 9
a158 13
#define number(v)	((((zzhack *)(&(v))))->zz_number)

#if BYTE_ORDER == LITTLE_ENDIAN
#define boolean(v)	((((zzhack *)(&(v))))->zz_boolean[0])
#define character(v)	((((zzhack *)(&(v))))->zz_character[0])
#endif

#if BYTE_ORDER == BIG_ENDIAN
#define boolean(v)	((((zzhack *)(&(v))))->zz_boolean[1])
#define character(v)	((((zzhack *)(&(v))))->zz_character[3])
#endif

#define address(v)	((((zzhack *)(&(v))))->zz_address)
@


1.3
log
@rcsid
@
text
@d1 1
a1 1
/*	$OpenBSD: tip.h,v 1.4 1995/10/29 00:49:43 pk Exp $	*/
a44 1
#include <machine/endian.h>
@


1.2
log
@from netbsd:
Convert to termios (from Scott Reynolds; PR#1621).
8-bit patches (from Matthieu Herrb; PR#1384).
@
text
@d1 1
@


1.1
log
@Initial revision
@
text
@d1 1
a1 1
/*	$NetBSD: tip.h,v 1.3 1994/12/08 09:31:10 jtc Exp $	*/
d48 1
a48 1
#include <sgtty.h>
d244 3
a246 6
struct sgttyb	arg;		/* current mode of local terminal */
struct sgttyb	defarg;		/* initial mode of local terminal */
struct tchars	tchars;		/* current state of terminal */
struct tchars	defchars;	/* initial state of terminal */
struct ltchars	ltchars;	/* current local characters of terminal */
struct ltchars	deflchars;	/* initial local characters of terminal */
d265 2
@


1.1.1.1
log
@initial import of NetBSD tree
@
text
@@
