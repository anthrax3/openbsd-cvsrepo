head	1.23;
access;
symbols
	OPENBSD_6_2:1.23.0.6
	OPENBSD_6_2_BASE:1.23
	OPENBSD_6_1:1.23.0.4
	OPENBSD_6_1_BASE:1.23
	OPENBSD_6_0:1.22.0.2
	OPENBSD_6_0_BASE:1.22
	OPENBSD_5_9:1.20.0.4
	OPENBSD_5_9_BASE:1.20
	OPENBSD_5_8:1.20.0.6
	OPENBSD_5_8_BASE:1.20
	OPENBSD_5_7:1.20.0.2
	OPENBSD_5_7_BASE:1.20
	OPENBSD_5_6:1.19.0.6
	OPENBSD_5_6_BASE:1.19
	OPENBSD_5_5:1.19.0.4
	OPENBSD_5_5_BASE:1.19
	OPENBSD_5_4:1.18.0.2
	OPENBSD_5_4_BASE:1.18
	OPENBSD_5_3:1.17.0.6
	OPENBSD_5_3_BASE:1.17
	OPENBSD_5_2:1.17.0.4
	OPENBSD_5_2_BASE:1.17
	OPENBSD_5_1_BASE:1.17
	OPENBSD_5_1:1.17.0.2
	OPENBSD_5_0:1.12.0.2
	OPENBSD_5_0_BASE:1.12
	OPENBSD_4_9:1.10.0.2
	OPENBSD_4_9_BASE:1.10
	OPENBSD_4_8:1.9.0.2
	OPENBSD_4_8_BASE:1.9
	OPENBSD_4_7:1.7.0.2
	OPENBSD_4_7_BASE:1.7
	OPENBSD_4_6:1.5.0.8
	OPENBSD_4_6_BASE:1.5
	OPENBSD_4_5:1.5.0.4
	OPENBSD_4_5_BASE:1.5
	OPENBSD_4_4:1.5.0.2
	OPENBSD_4_4_BASE:1.5
	djm_20080509:1.1.1.1
	djm:1.1.1;
locks; strict;
comment	@.\" @;


1.23
date	2016.09.25.23.31.50;	author deraadt;	state Exp;
branches;
next	1.22;
commitid	GFxOYc4MhdRm1QMx;

1.22
date	2016.07.21.10.42.49;	author jmc;	state Exp;
branches;
next	1.21;
commitid	D3oVq5UDlNObXlpi;

1.21
date	2016.07.21.10.11.11;	author claudio;	state Exp;
branches;
next	1.20;
commitid	3t7BrHlxRXyQ7R8F;

1.20
date	2014.08.19.03.28.53;	author dlg;	state Exp;
branches;
next	1.19;
commitid	SGI11URMmQGX99lo;

1.19
date	2014.02.26.20.56.11;	author claudio;	state Exp;
branches;
next	1.18;

1.18
date	2013.07.16.00.07.52;	author schwarze;	state Exp;
branches;
next	1.17;

1.17
date	2012.01.26.17.53.53;	author henning;	state Exp;
branches;
next	1.16;

1.16
date	2011.12.18.01.19.07;	author haesbaert;	state Exp;
branches;
next	1.15;

1.15
date	2011.09.09.00.40.54;	author haesbaert;	state Exp;
branches;
next	1.14;

1.14
date	2011.08.23.07.02.34;	author jmc;	state Exp;
branches;
next	1.13;

1.13
date	2011.08.23.04.13.37;	author haesbaert;	state Exp;
branches;
next	1.12;

1.12
date	2011.03.16.08.06.10;	author jmc;	state Exp;
branches;
next	1.11;

1.11
date	2011.03.09.18.13.18;	author claudio;	state Exp;
branches;
next	1.10;

1.10
date	2010.10.26.20.26.37;	author fkr;	state Exp;
branches;
next	1.9;

1.9
date	2010.07.03.07.26.14;	author jmc;	state Exp;
branches;
next	1.8;

1.8
date	2010.07.03.04.44.51;	author guenther;	state Exp;
branches;
next	1.7;

1.7
date	2009.08.13.17.38.28;	author jmc;	state Exp;
branches;
next	1.6;

1.6
date	2009.08.13.14.19.43;	author claudio;	state Exp;
branches;
next	1.5;

1.5
date	2008.06.26.07.05.56;	author jmc;	state Exp;
branches;
next	1.4;

1.4
date	2008.06.12.23.00.51;	author jmc;	state Exp;
branches;
next	1.3;

1.3
date	2008.06.12.20.34.47;	author henning;	state Exp;
branches;
next	1.2;

1.2
date	2008.05.09.09.01.23;	author jmc;	state Exp;
branches;
next	1.1;

1.1
date	2008.05.09.00.54.07;	author djm;	state Exp;
branches
	1.1.1.1;
next	;

1.1.1.1
date	2008.05.09.00.54.07;	author djm;	state Exp;
branches;
next	;


desc
@@


1.23
log
@Document the dependency on sysctl kern.allowkmem
ok tb
@
text
@.\" $OpenBSD: tcpbench.1,v 1.22 2016/07/21 10:42:49 jmc Exp $
.\"
.\" Copyright (c) 2008 Damien Miller <djm@@mindrot.org>
.\"
.\" Permission to use, copy, modify, and distribute this software for any
.\" purpose with or without fee is hereby granted, provided that the above
.\" copyright notice and this permission notice appear in all copies.
.\"
.\" THE SOFTWARE IS PROVIDED "AS IS" AND THE AUTHOR DISCLAIMS ALL WARRANTIES
.\" WITH REGARD TO THIS SOFTWARE INCLUDING ALL IMPLIED WARRANTIES OF
.\" MERCHANTABILITY AND FITNESS. IN NO EVENT SHALL THE AUTHOR BE LIABLE FOR
.\" ANY SPECIAL, DIRECT, INDIRECT, OR CONSEQUENTIAL DAMAGES OR ANY DAMAGES
.\" WHATSOEVER RESULTING FROM LOSS OF USE, DATA OR PROFITS, WHETHER IN AN
.\" ACTION OF CONTRACT, NEGLIGENCE OR OTHER TORTIOUS ACTION, ARISING OUT OF
.\" OR IN CONNECTION WITH THE USE OR PERFORMANCE OF THIS SOFTWARE.
.\"
.Dd $Mdocdate: July 21 2016 $
.Dt TCPBENCH 1
.Os
.Sh NAME
.Nm tcpbench
.Nd TCP/UDP benchmarking and measurement tool
.Sh SYNOPSIS
.Nm
.Fl l
.Nm
.Op Fl 46RUuv
.Op Fl B Ar buf
.Op Fl b Ar addr
.Op Fl k Ar kvars
.Op Fl n Ar connections
.Op Fl p Ar port
.Op Fl r Ar interval
.Op Fl S Ar space
.Op Fl T Ar toskeyword
.Op Fl t Ar secs
.Op Fl V Ar rtable
.Ar hostname
.Nm
.Bk -words
.Fl s
.Op Fl 46Uuv
.Op Fl B Ar buf
.Op Fl k Ar kvars
.Op Fl p Ar port
.Op Fl r Ar interval
.Op Fl S Ar space
.Op Fl T Ar toskeyword
.Op Fl V Ar rtable
.Op Ar hostname
.Ek
.Sh DESCRIPTION
.Nm
is a small tool that performs throughput benchmarking and concurrent
sampling of kernel network variables.
.Pp
.Nm
is run as a client/server pair.
The server must be invoked with the
.Fl s
flag, which will cause it to listen for incoming connections.
The client must be invoked with the
.Ar hostname
of a listening server to connect to.
.Pp
Once connected, the client will send TCP or UDP traffic as fast as possible to
the server.
Both the client and server will periodically display throughput
statistics along with any kernel variables the user has selected to
sample (using the
.Fl k
option, which is only available in TCP mode).
A list of available kernel variables may be obtained using the
.Fl l
option.
.Pp
The options are as follows:
.Bl -tag -width Ds
.It Fl 4
Forces
.Nm
to use IPv4 addresses only.
.It Fl 6
Forces
.Nm
to use IPv6 addresses only.
.It Fl B Ar buf
Specify the size of the internal read/write buffer used by
.Nm .
The default is 262144 bytes for TCP client/server and UDP server.
In UDP client mode this may be used to specify the packet size on the test
stream.
.It Fl b Ar addr
Specifies the IP address of the interface which is used to send the packets.
.It Fl k Ar kvars
Specify one or more kernel variables to monitor; multiple variables must be
separated with commas.
This option is only valid in TCP mode.
The default is not to monitor any variables.
Using this option requires read access to
.Pa /dev/kmem ,
which may be restricted based upon the value of the
.Ar kern.allowkmem
.Xr sysctl 8 .
.It Fl l
List the name of kernel variables available for monitoring and exit.
.It Fl n Ar connections
Use the given number of TCP connections (default: 1).
UDP is connectionless so this option isn't valid.
.It Fl p Ar port
Specify the port used for the test stream (default: 12345).
.It Fl R
In client mode the write buffer size is randomized up to the size specified via
.Fl B .
.It Fl r Ar interval
Specify the statistics interval reporting rate in milliseconds (default: 1000).
.It Fl S Ar space
Set the size of the socket buffer used for the test stream.
On the client this option will resize the send buffer;
on the server it will resize the receive buffer.
.It Fl s
Place
.Nm
in server mode, where it will listen on all interfaces for incoming
connections.
It defaults to using TCP if
.Fl u
is not specified.
.It Fl T Ar toskeyword
Change the IPv4 TOS or IPv6 TCLASS value.
.Ar toskeyword
may be one of
.Ar critical ,
.Ar inetcontrol ,
.Ar lowdelay ,
.Ar netcontrol ,
.Ar throughput ,
.Ar reliability ,
or one of the DiffServ Code Points:
.Ar ef ,
.Ar af11 ... af43 ,
.Ar cs0 ... cs7 ;
or a number in either hex or decimal.
.It Fl t Ar secs
Stop after
.Ar secs
seconds.
.It Fl U
Use AF_UNIX sockets instead of IPv4 or IPv6 sockets.
In client and server mode
.Ar hostname
is used as the path to the AF_UNIX socket.
.It Fl u
Use UDP instead of TCP; this must be specified on both the client
and the server.
Transmitted packets per second (TX PPS) will be accounted on the client
side, while received packets per second (RX PPS) will be accounted on the
server side.
UDP has no Protocol Control Block (PCB) so the
.Fl k
flags don't apply.
.It Fl V Ar rtable
Set the routing table to be used.
.It Fl v
Display verbose output.
If specified more than once, increase the detail of information displayed.
.El
.Sh SEE ALSO
.Xr netstat 1 ,
.Xr pstat 8
.Sh HISTORY
The
.Nm
program first appeared in
.Ox 4.4 .
.Sh AUTHORS
.An -nosplit
The
.Nm
program was written by
.An Damien Miller Aq Mt djm@@openbsd.org .
.Pp
UDP mode and libevent port by
.An Christiano F. Haesbaert Aq Mt haesbaert@@haesbaert.org .
@


1.22
log
@zap trailing whitespace;
@
text
@d1 1
a1 1
.\" $OpenBSD: tcpbench.1,v 1.21 2016/07/21 10:11:11 claudio Exp $
d101 4
a104 1
.Pa /dev/kmem .
@


1.21
log
@Add AF_UNIX support to tcpbench and also make it possible to randomize the
write size in the client. pledge setup can be made tighter but that will be
done in a second step.
OK benno@@, henning@@, markus@@ and some man page input by jmc@@
@
text
@d1 1
a1 1
.\" $OpenBSD: tcpbench.1,v 1.20 2014/08/19 03:28:53 dlg Exp $
d17 1
a17 1
.Dd $Mdocdate: August 19 2014 $
d147 1
a147 1
In client and server mode 
@


1.20
log
@add -4 and -6 flags for saying if you want to force ipv4 or ipv6
respectively.

tweaks from jmc@@
ok djm@@
@
text
@d1 1
a1 1
.\" $OpenBSD: tcpbench.1,v 1.19 2014/02/26 20:56:11 claudio Exp $
d17 1
a17 1
.Dd $Mdocdate: February 26 2014 $
d27 1
a27 1
.Op Fl 46uv
d42 1
a42 1
.Op Fl 46uv
d50 1
d109 3
d145 5
@


1.19
log
@Once more, the default routing table id is inherited from the process
like for any other process as well. OK by many
@
text
@d1 1
a1 1
.\" $OpenBSD: tcpbench.1,v 1.18 2013/07/16 00:07:52 schwarze Exp $
d17 1
a17 1
.Dd $Mdocdate: July 16 2013 $
d27 1
a27 1
.Op Fl uv
d42 1
a42 1
.Op Fl uv
d78 8
@


1.18
log
@use .Mt for email addresses; from Jan Stary <hans at stare dot cz>; ok jmc@@
@
text
@d1 1
a1 1
.\" $OpenBSD: tcpbench.1,v 1.17 2012/01/26 17:53:53 henning Exp $
d17 1
a17 1
.Dd $Mdocdate: January 26 2012 $
a143 1
The default is 0.
@


1.17
log
@add a timer to tcpbench as a command-line option (-t) so
that it is possible to stop the tcpbench client after a certain number
of seconds. This makes it easier to use tcpbench as part of a script.
From: Lawrence Teo <lteo at lteo.net>
ok phessler haesbaert and myself
@
text
@d1 1
a1 1
.\" $OpenBSD: tcpbench.1,v 1.16 2011/12/18 01:19:07 haesbaert Exp $
d17 1
a17 1
.Dd $Mdocdate: December 18 2011 $
d162 1
a162 1
.An Damien Miller Aq djm@@openbsd.org .
d165 1
a165 1
.An Christiano F. Haesbaert Aq haesbaert@@haesbaert.org .
@


1.16
log
@Typo.
@
text
@d1 1
a1 1
.\" $OpenBSD: tcpbench.1,v 1.15 2011/09/09 00:40:54 haesbaert Exp $
d17 1
a17 1
.Dd $Mdocdate: September 9 2011 $
d36 1
d129 4
@


1.15
log
@Add -b option which allows the client side to bind the socket to a
numeric address.  Requested by mikeb@@ in order to test ipsec.

ok mcbride mikeb djm jmc
@
text
@d1 1
a1 1
.\" $OpenBSD: tcpbench.1,v 1.14 2011/08/23 07:02:34 jmc Exp $
d17 1
a17 1
.Dd $Mdocdate: August 23 2011 $
d132 1
a132 1
side, while received packets per second (RX PPS) whill be accounted on the
@


1.14
log
@oops! -T snuck into the wrong place...
@
text
@d1 1
a1 1
.\" $OpenBSD: tcpbench.1,v 1.13 2011/08/23 04:13:37 haesbaert Exp $
d29 1
d83 2
@


1.13
log
@Allow TOS/TCLASS to be set with -T, accept the same keywords as in pf.conf.

ok mcbride@@ djm@@
'fine from me' jmc@@
@
text
@d1 1
a1 1
.\" $OpenBSD: tcpbench.1,v 1.12 2011/03/16 08:06:10 jmc Exp $
d17 1
a17 1
.Dd $Mdocdate: March 16 2011 $
d45 1
a46 1
.Op Fl S Ar space
@


1.12
log
@various cleanup;
@
text
@d1 1
a1 1
.\" $OpenBSD: tcpbench.1,v 1.11 2011/03/09 18:13:18 claudio Exp $
d17 1
a17 1
.Dd $Mdocdate: March 9 2011 $
d34 1
d45 1
d110 15
@


1.11
log
@Implement UDP mode for tcpbench and switch tcpbench to use libevent.
In UDP mode the tcpbench client tries to flood the pipe to the maximum
and the server will busy read the packets. For TCP mode nothing has
changed.  All the work was done by Christiano F. Haesbaert
(haesbaert(at)haesbaert org).
OK myself and a lot of pushing from deraadt@@
@
text
@d1 1
a1 1
.\" $OpenBSD: tcpbench.1,v 1.10 2010/10/26 20:26:37 fkr Exp $
d17 1
a17 1
.Dd $Mdocdate: October 26 2010 $
d22 1
a22 1
.Nd TCP and UDP benchmarking and measurement tool
d27 1
a27 2
.Op Fl v
.Op Fl u
d39 1
a39 2
.Op Fl v
.Op Fl u
d78 1
a78 2

In UDP client mode, this may be used to specify the packet size on the test
d82 2
a83 1
separated with commas. This option is only valid in TCP mode.
d90 2
a91 2
Use the given number of TCP connections (default: 1). UDP is connectionless so
this option isn't valid.
d93 1
a93 1
Specify the port used for the TCP or UDP test stream (default: 12345).
d97 1
a97 1
Set the size of the socket buffer used for the TCP or UDP test stream.
d104 2
a105 1
connections. Defaults to TCP if
d107 1
a107 1
not specified.
d109 3
a111 2
Use UDP instead of TCP, this must be specified on both client and
server. Transmitted packets per second (TX PPS) will be accounted on the client
d113 2
a114 1
server side. UDP has no Protocol Control Block (PCB) so the
d133 1
d138 1
a138 1

@


1.10
log
@add HISTORY and AUTHORS sections.
ok jmc@@, djm@@
@
text
@d1 1
a1 1
.\" $OpenBSD: tcpbench.1,v 1.9 2010/07/03 07:26:14 jmc Exp $
d17 1
a17 1
.Dd $Mdocdate: July 3 2010 $
d22 1
a22 1
.Nd TCP benchmarking and measurement tool
d28 1
d33 1
a33 1
.Op Fl r Ar rate
d41 1
d45 1
a45 1
.Op Fl r Ar rate
d63 1
a63 1
Once connected, the client will send TCP traffic as fast as possible to
d69 1
a69 1
option).
d79 4
a82 1
The default is 262144 bytes.
d85 1
a85 1
separated with commas.
d92 2
a93 1
Use the given number of TCP connections (default: 1).
d95 3
a97 3
Specify the port used for the TCP test stream (default: 12345).
.It Fl r Ar rate
Specify the statistics reporting rate in milliseconds (default: 1000).
d99 1
a99 1
Set the size of the socket buffer used for the TCP test stream.
d106 10
a115 1
connections.
d136 3
@


1.9
log
@put .Os in the right place;
@
text
@d1 1
a1 1
.\" $OpenBSD: tcpbench.1,v 1.8 2010/07/03 04:44:51 guenther Exp $
d111 10
@


1.8
log
@Fix the naming of interfaces and variables for rdomains and rtables
and make it possible to bind sockets (including listening sockets!)
to rtables and not just rdomains.  This changes the name of the
system calls, socket option, and ioctl.  After building with this
you should remove the files /usr/share/man/cat2/[gs]etrdomain.0.

Since this removes the existing [gs]etrdomain() system calls, the
libc major is bumped.

Written by claudio@@, criticized^Wcritiqued by me
@
text
@d1 1
a1 1
.\" $OpenBSD: tcpbench.1,v 1.7 2009/08/13 17:38:28 jmc Exp $
d17 2
a18 1
.Dd $Mdocdate: August 13 2009 $
a19 1
.Dt TCPBENCH 1
@


1.7
log
@use Bk/Ek to avoid ugly split in synopsis;
@
text
@d1 1
a1 1
.\" $OpenBSD: tcpbench.1,v 1.6 2009/08/13 14:19:43 claudio Exp $
d34 1
a34 1
.Op Fl V Ar rdomain
d45 1
a45 1
.Op Fl V Ar rdomain
d101 2
a102 2
.It Fl V Ar rdomain
Set the routing domain.
@


1.6
log
@Allow tcpbench to bind to a different rdomain.
OK sthen, djm and maybe more
@
text
@d1 1
a1 1
.\" $OpenBSD: tcpbench.1,v 1.5 2008/06/26 07:05:56 jmc Exp $
d17 1
a17 1
.Dd $Mdocdate: June 26 2008 $
d37 1
d46 1
@


1.5
log
@some minor improvements from Pierre Riteau; ok djm
@
text
@d1 1
a1 1
.\" $OpenBSD: tcpbench.1,v 1.4 2008/06/12 23:00:51 jmc Exp $
d17 1
a17 1
.Dd $Mdocdate: June 12 2008 $
d34 1
d44 1
d99 3
@


1.4
log
@tweak previous;
@
text
@d1 1
a1 1
.\" $OpenBSD: tcpbench.1,v 1.3 2008/06/12 20:34:47 henning Exp $
d71 1
a71 1
Specify the size of the internal write buffer used by
d73 1
d78 2
@


1.3
log
@allow the tcpbench client side to open more than one tcp connection
to the server and use them simultaniously. ok djm ryan
@
text
@d1 1
a1 1
.\" $OpenBSD: tcpbench.1,v 1.2 2008/05/09 09:01:23 jmc Exp $
d17 1
a17 1
.Dd $Mdocdate: May 9 2008 $
d80 1
a80 1
Use given number of tcp connections (default: 1).
@


1.2
log
@tweak previous; ok djm
@
text
@d1 1
a1 1
.\" $OpenBSD: tcpbench.1,v 1.1.1.1 2008/05/09 00:54:07 djm Exp $
d30 1
d79 2
@


1.1
log
@Initial revision
@
text
@d1 1
a1 1
.\" $OpenBSD$
d17 1
a17 1
.Dd $Mdocdate$
d28 1
a31 1
.Op Fl B Ar buf
d37 1
a40 1
.Op Fl B Ar buf
d69 1
a69 1
.It Fl B
a71 2
.It Fl l
List the name of kernel variables available for monitoring and exit.
d73 1
a73 1
Specify one or more kernel variables to monitor; multiple variables must be 
d76 2
d80 6
a90 6
.It Fl r Ar rate
Specify the statistics reporting rate in milliseconds (default: 1000).
.It Fl S Ar space
Set the size of the socket buffer used for the TCP test stream.
On the client this option will resize the send buffer, on the server
it will resize the receive buffer.
d96 1
a96 1
.Xr netstat 1
@


1.1.1.1
log
@import tcpbench, a small TCP benchmarking tool that can also sample
relevant kernel variables via kvm(3)

ok dlg@@ deraadt@@
@
text
@@
