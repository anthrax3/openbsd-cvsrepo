head	1.7;
access;
symbols
	OPENBSD_6_1:1.7.0.6
	OPENBSD_6_1_BASE:1.7
	OPENBSD_6_0:1.7.0.4
	OPENBSD_6_0_BASE:1.7
	OPENBSD_5_9:1.7.0.2
	OPENBSD_5_9_BASE:1.7
	OPENBSD_5_8:1.6.0.16
	OPENBSD_5_8_BASE:1.6
	OPENBSD_5_7:1.6.0.8
	OPENBSD_5_7_BASE:1.6
	OPENBSD_5_6:1.6.0.12
	OPENBSD_5_6_BASE:1.6
	OPENBSD_5_5:1.6.0.10
	OPENBSD_5_5_BASE:1.6
	OPENBSD_5_4:1.6.0.6
	OPENBSD_5_4_BASE:1.6
	OPENBSD_5_3:1.6.0.4
	OPENBSD_5_3_BASE:1.6
	OPENBSD_5_2:1.6.0.2
	OPENBSD_5_2_BASE:1.6;
locks; strict;
comment	@ * @;


1.7
date	2015.10.05.23.15.31;	author nicm;	state Exp;
branches;
next	1.6;
commitid	x6PApQ5v6vaG3lGh;

1.6
date	2012.07.10.12.47.23;	author nicm;	state Exp;
branches;
next	1.5;

1.5
date	2012.07.10.12.14.21;	author nicm;	state Exp;
branches;
next	1.4;

1.4
date	2012.07.10.11.42.02;	author nicm;	state Exp;
branches;
next	1.3;

1.3
date	2012.07.10.10.28.05;	author nicm;	state Exp;
branches;
next	1.2;

1.2
date	2012.07.10.08.16.27;	author nicm;	state Exp;
branches;
next	1.1;

1.1
date	2012.07.10.08.02.27;	author nicm;	state Exp;
branches;
next	;


desc
@@


1.7
log
@Set the line file descriptor nonblocking and make it blocking again for
xmodem and child processes, makes xmodem work with -d. Reported by Kim
Zeitler via guenther@@, tested by Jiri B. ok (and a small change) guenther
@
text
@/* $OpenBSD: cu.h,v 1.6 2012/07/10 12:47:23 nicm Exp $ */

/*
 * Copyright (c) 2012 Nicholas Marriott <nicm@@openbsd.org>
 *
 * Permission to use, copy, modify, and distribute this software for any
 * purpose with or without fee is hereby granted, provided that the above
 * copyright notice and this permission notice appear in all copies.
 *
 * THE SOFTWARE IS PROVIDED "AS IS" AND THE AUTHOR DISCLAIMS ALL WARRANTIES
 * WITH REGARD TO THIS SOFTWARE INCLUDING ALL IMPLIED WARRANTIES OF
 * MERCHANTABILITY AND FITNESS. IN NO EVENT SHALL THE AUTHOR BE LIABLE FOR
 * ANY SPECIAL, DIRECT, INDIRECT, OR CONSEQUENTIAL DAMAGES OR ANY DAMAGES
 * WHATSOEVER RESULTING FROM LOSS OF MIND, USE, DATA OR PROFITS, WHETHER
 * IN AN ACTION OF CONTRACT, NEGLIGENCE OR OTHER TORTIOUS ACTION, ARISING
 * OUT OF OR IN CONNECTION WITH THE USE OR PERFORMANCE OF THIS SOFTWARE.
 */

#ifndef CU_H
#define CU_H

/* command.c */
void				 do_command(char);

/* cu.c */
extern FILE			*record_file;
extern struct termios		 saved_tio;
extern int			 line_fd;
extern struct bufferevent	*line_ev;
void				 set_blocking(int, int);
int				 set_line(int);
void				 set_termios(void);
void				 restore_termios(void);
char				*tilde_expand(const char *);

/* input.c */
const char			*get_input(const char *);

/* error.c */
void				 cu_warn(const char *, ...)
				     __attribute__ ((format (printf, 1, 2)));
void				 cu_warnx(const char *, ...)
				     __attribute__ ((format (printf, 1, 2)));
void				 cu_err(int, const char *, ...)
				     __attribute__ ((format (printf, 2, 3)));
void				 cu_errx(int, const char *, ...)
				     __attribute__ ((format (printf, 2, 3)));

/* xmodem.c */
void				 xmodem_send(const char *);

#endif
@


1.6
log
@Add ~R command to start recording output to a file.
@
text
@d1 1
a1 1
/* $OpenBSD: cu.h,v 1.5 2012/07/10 12:14:21 nicm Exp $ */
d30 1
@


1.5
log
@Trim some unused externs.
@
text
@d1 1
a1 1
/* $OpenBSD: cu.h,v 1.4 2012/07/10 11:42:02 nicm Exp $ */
d26 1
@


1.4
log
@Add builtin XMODEM send support with ~X, only tested with lrz -X so far.
@
text
@d1 1
a1 1
/* $OpenBSD: cu.h,v 1.3 2012/07/10 10:28:05 nicm Exp $ */
a26 2
extern struct bufferevent	*input_ev;
extern struct bufferevent	*output_ev;
@


1.3
log
@Once we've set up termios, lines need to be \r\n terminated, and we need
to reset termios before exiting. So add custom versions of err(),
errx(), warn(), warnx() to handle this.
@
text
@d1 1
a1 1
/* $OpenBSD: cu.h,v 1.2 2012/07/10 08:16:27 nicm Exp $ */
d26 1
d48 3
@


1.2
log
@Add a ~S escape to change the speed interactively (not using ~s since
may want to use it for variables later).
@
text
@d1 1
a1 1
/* $OpenBSD: cu.h,v 1.1 2012/07/10 08:02:27 nicm Exp $ */
d37 10
@


1.1
log
@Add first cut of replacement for tip/cu. Not linked to the build.

Currently supports only -l and -s (no parity), no variables and ~., ~>,
~$, ~#, ~^Z, ~?. More to come.

Tested by naddy, otto. ok miod deraadt
@
text
@d1 1
a1 1
/* $OpenBSD$ */
d30 1
@

