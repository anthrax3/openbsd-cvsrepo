head	1.12;
access;
symbols
	OPENBSD_6_1:1.12.0.6
	OPENBSD_6_1_BASE:1.12
	OPENBSD_6_0:1.12.0.4
	OPENBSD_6_0_BASE:1.12
	OPENBSD_5_9:1.12.0.2
	OPENBSD_5_9_BASE:1.12
	OPENBSD_5_8:1.9.0.26
	OPENBSD_5_8_BASE:1.9
	OPENBSD_5_7:1.9.0.18
	OPENBSD_5_7_BASE:1.9
	OPENBSD_5_6:1.9.0.22
	OPENBSD_5_6_BASE:1.9
	OPENBSD_5_5:1.9.0.20
	OPENBSD_5_5_BASE:1.9
	OPENBSD_5_4:1.9.0.16
	OPENBSD_5_4_BASE:1.9
	OPENBSD_5_3:1.9.0.14
	OPENBSD_5_3_BASE:1.9
	OPENBSD_5_2:1.9.0.12
	OPENBSD_5_2_BASE:1.9
	OPENBSD_5_1_BASE:1.9
	OPENBSD_5_1:1.9.0.10
	OPENBSD_5_0:1.9.0.8
	OPENBSD_5_0_BASE:1.9
	OPENBSD_4_9:1.9.0.6
	OPENBSD_4_9_BASE:1.9
	OPENBSD_4_8:1.9.0.4
	OPENBSD_4_8_BASE:1.9
	OPENBSD_4_7:1.9.0.2
	OPENBSD_4_7_BASE:1.9
	OPENBSD_4_6:1.8.0.28
	OPENBSD_4_6_BASE:1.8
	OPENBSD_4_5:1.8.0.24
	OPENBSD_4_5_BASE:1.8
	OPENBSD_4_4:1.8.0.22
	OPENBSD_4_4_BASE:1.8
	OPENBSD_4_3:1.8.0.20
	OPENBSD_4_3_BASE:1.8
	OPENBSD_4_2:1.8.0.18
	OPENBSD_4_2_BASE:1.8
	OPENBSD_4_1:1.8.0.16
	OPENBSD_4_1_BASE:1.8
	OPENBSD_4_0:1.8.0.14
	OPENBSD_4_0_BASE:1.8
	OPENBSD_3_9:1.8.0.12
	OPENBSD_3_9_BASE:1.8
	OPENBSD_3_8:1.8.0.10
	OPENBSD_3_8_BASE:1.8
	OPENBSD_3_7:1.8.0.8
	OPENBSD_3_7_BASE:1.8
	OPENBSD_3_6:1.8.0.6
	OPENBSD_3_6_BASE:1.8
	OPENBSD_3_5:1.8.0.4
	OPENBSD_3_5_BASE:1.8
	OPENBSD_3_4:1.8.0.2
	OPENBSD_3_4_BASE:1.8
	OPENBSD_3_3:1.6.0.2
	OPENBSD_3_3_BASE:1.6
	OPENBSD_3_2:1.5.0.4
	OPENBSD_3_2_BASE:1.5
	OPENBSD_3_1:1.5.0.2
	OPENBSD_3_1_BASE:1.5
	OPENBSD_3_0:1.4.0.2
	OPENBSD_3_0_BASE:1.4
	OPENBSD_2_9_BASE:1.3
	OPENBSD_2_9:1.3.0.10
	OPENBSD_2_8:1.3.0.8
	OPENBSD_2_8_BASE:1.3
	OPENBSD_2_7:1.3.0.6
	OPENBSD_2_7_BASE:1.3
	OPENBSD_2_6:1.3.0.4
	OPENBSD_2_6_BASE:1.3
	OPENBSD_2_5:1.3.0.2
	OPENBSD_2_5_BASE:1.3
	OPENBSD_2_4:1.2.0.10
	OPENBSD_2_4_BASE:1.2
	OPENBSD_2_3:1.2.0.8
	OPENBSD_2_3_BASE:1.2
	OPENBSD_2_2:1.2.0.6
	OPENBSD_2_2_BASE:1.2
	OPENBSD_2_1:1.2.0.4
	OPENBSD_2_1_BASE:1.2
	OPENBSD_2_0:1.2.0.2
	OPENBSD_2_0_BASE:1.2
	netbsd_1_1:1.1.1.1;
locks; strict;
comment	@ * @;


1.12
date	2015.11.03.04.54.07;	author mmcc;	state Exp;
branches;
next	1.11;
commitid	6iomTLcemQwPjauB;

1.11
date	2015.10.09.01.37.06;	author deraadt;	state Exp;
branches;
next	1.10;
commitid	sbrB3Q5CNxcwZpfU;

1.10
date	2015.10.05.05.33.29;	author deraadt;	state Exp;
branches;
next	1.9;
commitid	CYY4D6PUQgidt9Py;

1.9
date	2009.10.27.23.59.35;	author deraadt;	state Exp;
branches;
next	1.8;

1.8
date	2003.06.10.22.20.44;	author deraadt;	state Exp;
branches;
next	1.7;

1.7
date	2003.06.03.02.56.06;	author millert;	state Exp;
branches;
next	1.6;

1.6
date	2003.03.13.23.11.16;	author tedu;	state Exp;
branches;
next	1.5;

1.5
date	2001.11.19.19.02.13;	author mpech;	state Exp;
branches;
next	1.4;

1.4
date	2001.06.21.16.35.18;	author lebel;	state Exp;
branches;
next	1.3;

1.3
date	98.12.07.20.09.40;	author deraadt;	state Exp;
branches;
next	1.2;

1.2
date	96.06.26.05.31.33;	author deraadt;	state Exp;
branches;
next	1.1;

1.1
date	95.10.18.08.44.55;	author deraadt;	state Exp;
branches
	1.1.1.1;
next	;

1.1.1.1
date	95.10.18.08.44.55;	author deraadt;	state Exp;
branches;
next	;


desc
@@


1.12
log
@Add blank line after pledge call.
@
text
@/*	$OpenBSD: banner.c,v 1.11 2015/10/09 01:37:06 deraadt Exp $	*/
/*	$NetBSD: banner.c,v 1.2 1995/04/09 06:00:15 cgd Exp $	*/

/*
 *	Changes for banner(1)
 *
 *      @@(#)Copyright (c) 1995, Simon J. Gerraty.
 *      
 *      This is free software.  It comes with NO WARRANTY.
 *      Permission to use, modify and distribute this source code 
 *      is granted subject to the following conditions.
 *      1/ that the above copyright notice and this notice 
 *      are preserved in all copies and that due credit be given 
 *      to the author.  
 *      2/ that any changes to this code are clearly commented 
 *      as such so that the author does not get blamed for bugs 
 *      other than his own.
 *      
 *      Please send copies of changes and bug-fixes to:
 *      sjg@@zen.void.oz.au
 */

/*
 * Copyright (c) 1983, 1993
 *	The Regents of the University of California.  All rights reserved.
 *
 * Redistribution and use in source and binary forms, with or without
 * modification, are permitted provided that the following conditions
 * are met:
 * 1. Redistributions of source code must retain the above copyright
 *    notice, this list of conditions and the following disclaimer.
 * 2. Redistributions in binary form must reproduce the above copyright
 *    notice, this list of conditions and the following disclaimer in the
 *    documentation and/or other materials provided with the distribution.
 * 3. Neither the name of the University nor the names of its contributors
 *    may be used to endorse or promote products derived from this software
 *    without specific prior written permission.
 *
 * THIS SOFTWARE IS PROVIDED BY THE REGENTS AND CONTRIBUTORS ``AS IS'' AND
 * ANY EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT LIMITED TO, THE
 * IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE
 * ARE DISCLAIMED.  IN NO EVENT SHALL THE REGENTS OR CONTRIBUTORS BE LIABLE
 * FOR ANY DIRECT, INDIRECT, INCIDENTAL, SPECIAL, EXEMPLARY, OR CONSEQUENTIAL
 * DAMAGES (INCLUDING, BUT NOT LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS
 * OR SERVICES; LOSS OF USE, DATA, OR PROFITS; OR BUSINESS INTERRUPTION)
 * HOWEVER CAUSED AND ON ANY THEORY OF LIABILITY, WHETHER IN CONTRACT, STRICT
 * LIABILITY, OR TORT (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY
 * OUT OF THE USE OF THIS SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF
 * SUCH DAMAGE.
 */

#include <stdio.h>
#include <unistd.h>
#include <stdlib.h>
#include <string.h>
#include <err.h>

#include "banner.h"

static long PW = LINELEN;

/* the char gen code below is lifted from lpd */

static char *
scnline(int key, char *p, int c)
{
	int scnwidth;

	/*
	 * <sjg> lpd makes chars out of the letter in question.
	 * the results are somewhat mixed.  Sticking to '#' as
	 * banner(1) does is more consistent.
	 */
#ifndef NOHASH_ONLY
	c = '#';
#endif
	
	for (scnwidth = WIDTH; --scnwidth;) {
		key <<= 1;
		*p++ = key & 0200 ? c : BACKGND;
	}
	return (p);
}

#define TRC(q)	(((q)-' ')&0177)


static int
dropit(int c)
{
	switch(c) {

	case TRC('_'):
	case TRC(';'):
	case TRC(','):
	case TRC('g'):
	case TRC('j'):
	case TRC('p'):
	case TRC('q'):
	case TRC('y'):
		return (DROP);

	default:
		return (0);
	}
}

static void
scan_out(int scfd, char *scsp, int dlm)
{
	char *strp;
	int nchrs, j;
	char outbuf[LINELEN+1], *sp, c, cc;
	int d, scnhgt;
	extern char scnkey[][HEIGHT];	/* in lpdchar.c */

	for (scnhgt = 0; scnhgt++ < HEIGHT+DROP; ) {
		strp = &outbuf[0];
		sp = scsp;
		for (nchrs = 0; *sp != dlm && *sp != '\0'; ) {
			cc = *sp++;
			if ((unsigned char)cc < ' ' ||
			    (unsigned char)cc > 0x7f)
				cc = INVALID;

			c = TRC(cc);
			d = dropit(c);
			if ((!d && scnhgt > HEIGHT) || (scnhgt <= DROP && d))
				for (j = WIDTH; --j;)
					*strp++ = BACKGND;
			else
				strp = scnline(scnkey[(int)c][scnhgt-1-d], strp, cc);
			if (nchrs++ >= PW/(WIDTH+1)-1)
				break;
			*strp++ = BACKGND;
#ifdef LPD_CHSET				/* <sjg> */
			*strp++ = BACKGND;
#endif
		}
		while (*--strp == BACKGND && strp >= outbuf)
			;
		strp++;
		*strp++ = '\n';	
		(void) write(scfd, outbuf, strp-outbuf);
	}
}

/*
 * for each word, print up to 10 chars in big letters.
 */
int
main(int argc, char *argv[])
{
	char word[10+1];			/* strings limited to 10 chars */
	
	if (pledge("stdio", NULL) == -1)
		err(1, "pledge");

	while (*++argv) {
		(void)strlcpy(word, *argv, sizeof (word));
		scan_out(1, word, '\0');
	}
	exit(0);
}
@


1.11
log
@Change all tame callers to namechange to pledge(2).
@
text
@d1 1
a1 1
/*	$OpenBSD: banner.c,v 1.10 2015/10/05 05:33:29 deraadt Exp $	*/
d158 1
@


1.10
log
@banner can be restricted to tame "stdio".  if this program is put into a
foreign-data pipeline, and happens to contain a string handling bug, i do
not want it being controlled to open a socket.
ok doug
@
text
@d1 1
a1 1
/*	$OpenBSD: banner.c,v 1.9 2009/10/27 23:59:35 deraadt Exp $	*/
d156 2
a157 2
	if (tame("stdio", NULL) == -1)
		err(1, "tame");
@


1.9
log
@rcsid[] and sccsid[] and copyright[] are essentially unmaintained (and
unmaintainable).  these days, people use source.  these id's do not provide
any benefit, and do hurt the small install media
(the 33,000 line diff is essentially mechanical)
ok with the idea millert, ok dms
@
text
@d1 1
a1 1
/*	$OpenBSD: banner.c,v 1.8 2003/06/10 22:20:44 deraadt Exp $	*/
d56 1
d156 2
@


1.8
log
@mostly ansi cleanup; pval ok
@
text
@d1 1
a1 1
/*	$OpenBSD: banner.c,v 1.7 2003/06/03 02:56:06 millert Exp $	*/
a50 10
#ifndef lint
static const char copyright[] =
"@@(#) Copyright (c) 1983, 1993\n\
	The Regents of the University of California.  All rights reserved.\n";
#if 0
static char sccsid[] = "@@(#)printjob.c	8.2 (Berkeley) 4/16/94";
#else
static const char rcsid[] = "$OpenBSD: banner.c,v 1.7 2003/06/03 02:56:06 millert Exp $";
#endif
#endif /* not lint */
@


1.7
log
@Remove the advertising clause in the UCB license which Berkeley
rescinded 22 July 1999.  Proofed by myself and Theo.
@
text
@d1 1
a1 1
/*	$OpenBSD: banner.c,v 1.6 2003/03/13 23:11:16 tedu Exp $	*/
d58 1
a58 1
static const char rcsid[] = "$OpenBSD: banner.c,v 1.6 2003/03/13 23:11:16 tedu Exp $";
d74 1
a74 4
scnline(key, p, c)
	int key;
	char *p;
	int c;
d98 1
a98 2
dropit(c)
	int c;
d118 1
a118 3
scan_out(scfd, scsp, dlm)
	int scfd, dlm;
	char *scsp;
d161 1
a161 3
main(argc, argv)
	int argc;
	char **argv;
@


1.6
log
@fix printing of "" and other weird chars.  from alexander@@beard.se
closes pr3146 and pr3147

ok millert@@
@
text
@d1 1
a1 1
/*	$OpenBSD: banner.c,v 1.5 2001/11/19 19:02:13 mpech Exp $	*/
d35 1
a35 5
 * 3. All advertising materials mentioning features or use of this software
 *    must display the following acknowledgement:
 *	This product includes software developed by the University of
 *	California, Berkeley and its contributors.
 * 4. Neither the name of the University nor the names of its contributors
d58 1
a58 1
static const char rcsid[] = "$OpenBSD: banner.c,v 1.5 2001/11/19 19:02:13 mpech Exp $";
@


1.5
log
@kill more registers

millert@@ ok
@
text
@d1 1
a1 1
/*	$OpenBSD: banner.c,v 1.4 2001/06/21 16:35:18 lebel Exp $	*/
d56 1
a56 1
static char copyright[] =
a58 3
#endif /* not lint */

#ifndef lint
d62 1
a62 1
static char rcsid[] = "$OpenBSD: banner.c,v 1.4 2001/06/21 16:35:18 lebel Exp $";
d139 7
a145 2
		for (nchrs = 0; ; ) {
			c = TRC(cc = *sp++);
d152 1
a152 1
			if (*sp == dlm || *sp == '\0' || nchrs++ >= PW/(WIDTH+1)-1)
@


1.4
log
@use strlcpy vs strncpy+a[len-1]='\0'; Brian Poole <raj@@cerias.purdue.edu>
@
text
@d1 1
a1 1
/*	$OpenBSD: banner.c,v 1.3 1998/12/07 20:09:40 deraadt Exp $	*/
d65 1
a65 1
static char rcsid[] = "$OpenBSD: banner.c,v 1.3 1998/12/07 20:09:40 deraadt Exp $";
d82 2
a83 2
	register int key;
	register char *p;
@


1.3
log
@Wall
@
text
@d1 1
a1 1
/*	$OpenBSD: banner.c,v 1.2 1996/06/26 05:31:33 deraadt Exp $	*/
d65 1
a65 1
static char rcsid[] = "$OpenBSD: banner.c,v 1.2 1996/06/26 05:31:33 deraadt Exp $";
d176 1
a176 2
		(void)strncpy(word, *argv, sizeof (word) - 1);
		word[sizeof (word) - 1] = '\0';
@


1.2
log
@rcsid
@
text
@d1 1
a1 1
/*	$OpenBSD: banner.c,v 1.2 1995/04/09 06:00:15 cgd Exp $	*/
d65 1
a65 1
static char rcsid[] = "$OpenBSD: banner.c,v 1.2 1995/04/09 06:00:15 cgd Exp $";
d70 3
d86 1
a86 1
	register scnwidth;
d133 2
a134 2
	register char *strp;
	register nchrs, j;
d143 2
a144 1
			d = dropit(c = TRC(cc = *sp++));
d149 1
a149 1
				strp = scnline(scnkey[c][scnhgt-1-d], strp, cc);
@


1.1
log
@Initial revision
@
text
@d1 1
d65 1
a65 1
static char rcsid[] = "$NetBSD: banner.c,v 1.2 1995/04/09 06:00:15 cgd Exp $";
@


1.1.1.1
log
@initial import of NetBSD tree
@
text
@@
