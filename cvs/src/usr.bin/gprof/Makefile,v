head	1.21;
access;
symbols
	OPENBSD_6_0:1.21.0.12
	OPENBSD_6_0_BASE:1.21
	OPENBSD_5_9:1.21.0.8
	OPENBSD_5_9_BASE:1.21
	OPENBSD_5_8:1.21.0.10
	OPENBSD_5_8_BASE:1.21
	OPENBSD_5_7:1.21.0.2
	OPENBSD_5_7_BASE:1.21
	OPENBSD_5_6:1.21.0.6
	OPENBSD_5_6_BASE:1.21
	OPENBSD_5_5:1.21.0.4
	OPENBSD_5_5_BASE:1.21
	OPENBSD_5_4:1.20.0.2
	OPENBSD_5_4_BASE:1.20
	OPENBSD_5_3:1.19.0.10
	OPENBSD_5_3_BASE:1.19
	OPENBSD_5_2:1.19.0.8
	OPENBSD_5_2_BASE:1.19
	OPENBSD_5_1_BASE:1.19
	OPENBSD_5_1:1.19.0.6
	OPENBSD_5_0:1.19.0.4
	OPENBSD_5_0_BASE:1.19
	OPENBSD_4_9:1.19.0.2
	OPENBSD_4_9_BASE:1.19
	OPENBSD_4_8:1.18.0.4
	OPENBSD_4_8_BASE:1.18
	OPENBSD_4_7:1.18.0.2
	OPENBSD_4_7_BASE:1.18
	OPENBSD_4_6:1.17.0.10
	OPENBSD_4_6_BASE:1.17
	OPENBSD_4_5:1.17.0.6
	OPENBSD_4_5_BASE:1.17
	OPENBSD_4_4:1.17.0.4
	OPENBSD_4_4_BASE:1.17
	OPENBSD_4_3:1.17.0.2
	OPENBSD_4_3_BASE:1.17
	OPENBSD_4_2:1.14.0.18
	OPENBSD_4_2_BASE:1.14
	OPENBSD_4_1:1.14.0.16
	OPENBSD_4_1_BASE:1.14
	OPENBSD_4_0:1.14.0.14
	OPENBSD_4_0_BASE:1.14
	OPENBSD_3_9:1.14.0.12
	OPENBSD_3_9_BASE:1.14
	OPENBSD_3_8:1.14.0.10
	OPENBSD_3_8_BASE:1.14
	OPENBSD_3_7:1.14.0.8
	OPENBSD_3_7_BASE:1.14
	OPENBSD_3_6:1.14.0.6
	OPENBSD_3_6_BASE:1.14
	OPENBSD_3_5:1.14.0.4
	OPENBSD_3_5_BASE:1.14
	OPENBSD_3_4:1.14.0.2
	OPENBSD_3_4_BASE:1.14
	OPENBSD_3_3:1.13.0.4
	OPENBSD_3_3_BASE:1.13
	OPENBSD_3_2:1.13.0.2
	OPENBSD_3_2_BASE:1.13
	OPENBSD_3_1:1.12.0.4
	OPENBSD_3_1_BASE:1.12
	OPENBSD_3_0:1.12.0.2
	OPENBSD_3_0_BASE:1.12
	OPENBSD_2_9_BASE:1.9
	OPENBSD_2_9:1.9.0.2
	OPENBSD_2_8:1.8.0.2
	OPENBSD_2_8_BASE:1.8
	OPENBSD_2_7:1.7.0.8
	OPENBSD_2_7_BASE:1.7
	OPENBSD_2_6:1.7.0.6
	OPENBSD_2_6_BASE:1.7
	OPENBSD_2_5:1.7.0.4
	OPENBSD_2_5_BASE:1.7
	OPENBSD_2_4:1.7.0.2
	OPENBSD_2_4_BASE:1.7
	OPENBSD_2_3:1.6.0.4
	OPENBSD_2_3_BASE:1.6
	OPENBSD_2_2:1.6.0.2
	OPENBSD_2_2_BASE:1.6
	OPENBSD_2_1:1.5.0.2
	OPENBSD_2_1_BASE:1.5
	OPENBSD_2_0:1.3.0.2
	OPENBSD_2_0_BASE:1.3
	netbsd_1_1:1.1.1.1;
locks; strict;
comment	@# @;


1.21
date	2013.10.17.10.51.57;	author deraadt;	state Exp;
branches;
next	1.20;

1.20
date	2013.07.05.21.29.51;	author miod;	state Exp;
branches;
next	1.19;

1.19
date	2010.10.17.22.54.37;	author schwarze;	state Exp;
branches;
next	1.18;

1.18
date	2010.02.03.20.49.01;	author miod;	state Exp;
branches;
next	1.17;

1.17
date	2007.12.09.19.51.30;	author espie;	state Exp;
branches;
next	1.16;

1.16
date	2007.12.05.09.59.38;	author deraadt;	state Exp;
branches;
next	1.15;

1.15
date	2007.11.24.16.02.04;	author espie;	state Exp;
branches;
next	1.14;

1.14
date	2003.07.22.17.15.13;	author brad;	state Exp;
branches;
next	1.13;

1.13
date	2002.05.08.16.46.35;	author art;	state Exp;
branches;
next	1.12;

1.12
date	2001.09.10.23.31.34;	author drahn;	state Exp;
branches;
next	1.11;

1.11
date	2001.09.10.23.03.20;	author jason;	state Exp;
branches;
next	1.10;

1.10
date	2001.07.11.03.02.24;	author pvalchev;	state Exp;
branches;
next	1.9;

1.9
date	2001.03.21.22.27.36;	author miod;	state Exp;
branches;
next	1.8;

1.8
date	2000.10.05.15.28.15;	author mickey;	state Exp;
branches;
next	1.7;

1.7
date	98.07.06.15.19.31;	author millert;	state Exp;
branches;
next	1.6;

1.6
date	97.09.21.11.49.15;	author deraadt;	state Exp;
branches;
next	1.5;

1.5
date	97.04.27.20.56.44;	author millert;	state Exp;
branches;
next	1.4;

1.4
date	96.12.08.14.32.25;	author downsj;	state Exp;
branches;
next	1.3;

1.3
date	96.10.04.19.16.54;	author deraadt;	state Exp;
branches;
next	1.2;

1.2
date	96.06.26.05.33.46;	author deraadt;	state Exp;
branches;
next	1.1;

1.1
date	95.10.18.08.45.20;	author deraadt;	state Exp;
branches
	1.1.1.1;
next	;

1.1.1.1
date	95.10.18.08.45.20;	author deraadt;	state Exp;
branches;
next	;


desc
@@


1.21
log
@pretty up
@
text
@#	$OpenBSD: Makefile,v 1.20 2013/07/05 21:29:51 miod Exp $

.include <bsd.own.mk>

TARGET_MACHINE_ARCH?=	${MACHINE_ARCH}
TARGET_MACHINE_CPU?=	${MACHINE_CPU}

PROG=	gprof
SRCS=	gprof.c arcs.c dfn.c elf.c lookup.c ${TARGET_MACHINE_CPU}.c \
	hertz.c printgprof.c printlist.c
CFLAGS+= -I. -DMD_INCLUDE=\"${TARGET_MACHINE_CPU}.h\"

beforeinstall:
	${INSTALL} ${INSTALL_COPY} -o ${BINOWN} -g ${BINGRP} -m 444 \
	    ${.CURDIR}/gprof.flat ${.CURDIR}/gprof.callg \
	    ${DESTDIR}/usr/share/misc

.include <bsd.prog.mk>
@


1.20
log
@ELF_TOOLCHAIN bye bye.
@
text
@d1 1
a1 1
#	$OpenBSD: Makefile,v 1.19 2010/10/17 22:54:37 schwarze Exp $
d9 2
a10 2
SRCS=	gprof.c arcs.c dfn.c lookup.c ${TARGET_MACHINE_CPU}.c hertz.c \
	printgprof.c printlist.c
a11 2

SRCS+=elf.c
@


1.19
log
@Stop installing me(1) and ms(1) source code.
We will soon get rid of groff in base,
so there is no longer any way to use these files with base.
No opposition on tech@@.
@
text
@d1 1
a1 1
#	$OpenBSD: Makefile,v 1.18 2010/02/03 20:49:01 miod Exp $
a12 2
# XXX - need support for multiple archs.
.if (${ELF_TOOLCHAIN:L} == "yes")
a13 3
.else
SRCS+=aout.c
.endif
@


1.18
log
@Use MACHINE_CPU instead of MACHINE_ARCH to pick the correct machine dependent
files or directories when applicable.
The inspiration and name of MACHINE_CPU come from NetBSD, although the way to
provide it to Makefiles is completely different.
ok kettenis@@
@
text
@d1 1
a1 1
#	$OpenBSD: Makefile,v 1.17 2007/12/09 19:51:30 espie Exp $
a23 4

.if make(install)
SUBDIR+= PSD.doc
.endif
@


1.17
log
@remove makefile hacks to build links. Instead, change the files that
gprof uses directly.

okay deraadt@@, miod@@.
Thanks for checking that gcc 2.95 is happy with
#include MACRO
@
text
@d1 1
a1 1
#	$OpenBSD: Makefile,v 1.16 2007/12/05 09:59:38 deraadt Exp $
d6 1
d9 1
a9 1
SRCS=	gprof.c arcs.c dfn.c lookup.c ${TARGET_MACHINE_ARCH}.c hertz.c \
d11 1
a11 1
CFLAGS+= -I. -DMD_INCLUDE=\"${TARGET_MACHINE_ARCH}.h\"
@


1.16
log
@unbreak build, on vax
@
text
@d1 1
a1 1
#	$OpenBSD: Makefile,v 1.14 2003/07/22 17:15:13 brad Exp $
d8 1
a8 1
SRCS=	gprof.c arcs.c dfn.c lookup.c machine.c hertz.c \
d10 1
a10 1
CFLAGS+= -I${.CURDIR} -I.
a17 6

.if defined(PROG)
beforedepend:
	ln -sf ${.CURDIR}/${TARGET_MACHINE_ARCH}.h machine.h
	ln -sf ${.CURDIR}/${TARGET_MACHINE_ARCH}.c machine.c
.endif # defined (PROG)
@


1.15
log
@write explicit dependencies for make -j. beforedepend creates the file,
but make -j tries to find them earlier, and can't.
@
text
@d18 1
a22 7

machine.c:
	ln -sf ${.CURDIR}/${TARGET_MACHINE_ARCH}.c machine.c

machine.h:
	ln -sf ${.CURDIR}/${TARGET_MACHINE_ARCH}.h machine.h

@


1.14
log
@- use :L variable modifier with ELF_TOOLCHAIN variable
- change 2 instances of the check from != "yes" to == "no"

ok deraadt@@
@
text
@d1 1
a1 1
#	$OpenBSD: Makefile,v 1.13 2002/05/08 16:46:35 art Exp $
a17 1

d22 7
@


1.13
log
@Split out symbol handling into a separate file.
Implement symbol handling for ELF (based on FreeBSD).
Implement dummy support for alpha, hppa, powerpc and sparc64.

Tested during the last 2 months on various archs (never comitted because
other stuff got in the way).
Some fixups to i386 support from mickey@@

This lets us switch all elf archs to this gprof.
@
text
@d1 1
a1 1
#	$OpenBSD: Makefile,v 1.12 2001/09/10 23:31:34 drahn Exp $
d13 1
a13 1
.if (${ELF_TOOLCHAIN} == "yes")
@


1.12
log
@Do not make symlinks to files for architectures which do not use
this gprof. This wasy sparc64.c does not need to be created.
@
text
@d1 3
a3 1
#	$OpenBSD: Makefile,v 1.11 2001/09/10 23:03:20 jason Exp $
a6 6
.if (${TARGET_MACHINE_ARCH} == "alpha") || \
    (${TARGET_MACHINE_ARCH} == "powerpc") || \
    (${TARGET_MACHINE_ARCH} == "sparc64") || \
    (${TARGET_MACHINE_ARCH} == "hppa")
NOPROG=
.else
d11 6
@


1.11
log
@Don't use this gprof
@
text
@d1 1
a1 1
#	$OpenBSD: Makefile,v 1.10 2001/07/11 03:02:24 pvalchev Exp $
d17 1
d21 1
@


1.10
log
@remove mips leftovers; ok brad
@
text
@d1 1
a1 1
#	$OpenBSD: Makefile,v 1.9 2001/03/21 22:27:36 miod Exp $
d7 1
@


1.9
log
@New compilation scheme, more cross-compiler friendly, less error-prone.
As a bonus, bring support for mvme88k.
millert@@ ok
@
text
@d1 1
a1 1
#	$OpenBSD: Makefile,v 1.8 2000/10/05 15:28:15 mickey Exp $
a5 1
    (${TARGET_MACHINE_ARCH} == "mips") || \
@


1.8
log
@hppa not yet
@
text
@d1 1
a1 1
#	$OpenBSD: Makefile,v 1.7 1998/07/06 15:19:31 millert Exp $
d3 6
a8 2
.if (${MACHINE_ARCH} == "alpha") || (${MACHINE_ARCH} == "mips") || \
	(${MACHINE_ARCH} == "powerpc") || (${MACHINE_ARCH} == "hppa")
d12 1
a12 1
SRCS=	gprof.c arcs.c dfn.c lookup.c ${MACHINE_ARCH}.c hertz.c \
d14 1
a14 1
CFLAGS+= -D${MACHINE_ARCH}
d16 4
@


1.7
log
@powerpc uses binutils gprof
@
text
@d1 1
a1 1
#	$OpenBSD: Makefile,v 1.6 1997/09/21 11:49:15 deraadt Exp $
d4 1
a4 1
	(${MACHINE_ARCH} == "powerpc")
@


1.6
log
@$OpenBSD$
@
text
@d1 1
a1 1
#	$OpenBSD: Makefile,v 1.5 1997/04/27 20:56:44 millert Exp $
d3 2
a4 1
.if (${MACHINE_ARCH} == "alpha" || ${MACHINE_ARCH} == "mips")
@


1.5
log
@COPY -> INSTALL_COPY and STRIP -> INSTALL_STRIP
This fixes namespace problems where STRIP is sometimes used as
the name of the strip(1) to use and other times used as
the flag to send install(1) when stripping (or not).
COPY doesn't have this problem (yet) but was poorly named.
@
text
@d1 1
a1 2
#	$OpenBSD: Makefile,v 1.4 1996/12/08 14:32:25 downsj Exp $
#	$NetBSD: Makefile,v 1.14 1995/04/19 07:24:08 cgd Exp $
@


1.4
log
@install -> ${INSTALL}, -c -> ${COPY}
@
text
@d1 1
a1 1
#	$OpenBSD: Makefile,v 1.3 1996/10/04 19:16:54 deraadt Exp $
d14 1
a14 1
	${INSTALL} ${COPY} -o ${BINOWN} -g ${BINGRP} -m 444 \
@


1.3
log
@let gprof docs still get installed on mips/alpha
@
text
@d1 1
a1 1
#	$OpenBSD: Makefile,v 1.2 1996/06/26 05:33:46 deraadt Exp $
d14 1
a14 1
	install -c -o ${BINOWN} -g ${BINGRP} -m 444 \
@


1.2
log
@rcsid
@
text
@d1 1
a1 1
#	$OpenBSD: Makefile,v 1.14 1995/04/19 07:24:08 cgd Exp $
d4 3
d11 1
@


1.1
log
@Initial revision
@
text
@d1 1
a2 1
#	@@(#)Makefile	8.1 (Berkeley) 6/29/93
@


1.1.1.1
log
@initial import of NetBSD tree
@
text
@@
