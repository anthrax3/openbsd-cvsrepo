head	1.5;
access;
symbols
	OPENBSD_3_2:1.4.0.10
	OPENBSD_3_2_BASE:1.4
	OPENBSD_3_1:1.4.0.8
	OPENBSD_3_1_BASE:1.4
	OPENBSD_3_0:1.4.0.6
	OPENBSD_3_0_BASE:1.4
	OPENBSD_2_9_BASE:1.4
	OPENBSD_2_9:1.4.0.4
	OPENBSD_2_8:1.4.0.2
	OPENBSD_2_8_BASE:1.4
	TCFS00:1.1.1.1
	PROVOS001:1.1.1;
locks; strict;
comment	@ * @;


1.5
date	2003.02.24.02.13.14;	author deraadt;	state dead;
branches;
next	1.4;

1.4
date	2000.06.20.08.01.21;	author fgsch;	state Exp;
branches;
next	1.3;

1.3
date	2000.06.19.22.42.29;	author aaron;	state Exp;
branches;
next	1.2;

1.2
date	2000.06.19.20.06.19;	author fgsch;	state Exp;
branches;
next	1.1;

1.1
date	2000.06.18.22.07.24;	author provos;	state Exp;
branches
	1.1.1.1;
next	;

1.1.1.1
date	2000.06.18.22.07.24;	author provos;	state Exp;
branches;
next	;


desc
@@


1.5
log
@bye bye
@
text
@/*	$OpenBSD: unix_auth.c,v 1.4 2000/06/20 08:01:21 fgsch Exp $	*/

/*
 *	Transparent Cryptographic File System (TCFS) for NetBSD 
 *	Author and mantainer: 	Luigi Catuogno [luicat@@tcfs.unisa.it]
 *	
 *	references:		http://tcfs.dia.unisa.it
 *				tcfs-bsd@@tcfs.unisa.it
 */

/*
 *	Base utility set v0.1
 */

#include <sys/param.h>
#include <limits.h>
#include <pwd.h>
#include <stdio.h>
#include <stdlib.h>
#include <string.h>
#include <unistd.h>

#include <miscfs/tcfs/tcfs.h>
#include "tcfslib.h"
#include "tcfserrors.h"

int
unix_auth(char **user, char **password, int flag)
{
	char *luser, *passwd;
	struct passwd *passentry;

	luser = (char *)calloc(LOGIN_NAME_MAX, sizeof(char));
	passwd = (char *)calloc(_PASSWORD_LEN, sizeof(char));

	if (!luser || !passwd)
		tcfs_error(ER_MEM, NULL);

	if (flag) {
		passentry = getpwuid(getuid());
		strlcpy(luser, passentry->pw_name, LOGIN_NAME_MAX);
	} else {
		printf("Enter user: ");
		fgets(luser, LOGIN_NAME_MAX, stdin);
		luser[strlen(luser)-1] = '\0';
		passentry = getpwnam(luser);
	}

	passwd = getpass("Password:");
	
	if (passentry == NULL) {
		bzero(passwd, strlen(passwd));
		return (0);
	}

	if (strcmp(crypt(passwd, passentry->pw_passwd), passentry->pw_passwd))
		return (0);

	*user = luser;
	*password = passwd;

	return (1);
}
@


1.4
log
@weird. missing OpenBSD tags.
@
text
@d1 1
a1 1
/*	$OpenBSD$	*/
@


1.3
log
@KNF
@
text
@d1 2
@


1.2
log
@add missing headers, declare missing functions remove unused vars, KNF;
more to come.
@
text
@d26 1
a26 1
unix_auth (char **user, char **password, int flag)
d31 2
a32 2
	luser = (char*)calloc (LOGIN_NAME_MAX, sizeof(char));
	passwd = (char*)calloc (_PASSWORD_LEN, sizeof(char));
d35 1
a35 1
		tcfs_error (ER_MEM, NULL);
d41 1
a41 1
		printf ("Enter user: ");
d50 2
a51 2
		bzero (passwd, strlen(passwd));
		return 0;
@


1.1
log
@Initial revision
@
text
@a12 2
#include <stdio.h>
#include <unistd.h>
d15 3
d19 1
a19 1
#include <pwd.h>
@


1.1.1.1
log
@Initial import of very much rewritten TCFS userland.  This code is still
nasty.
@
text
@@
