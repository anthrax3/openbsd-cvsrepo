head	1.7;
access;
symbols
	OPENBSD_6_2_BASE:1.7
	OPENBSD_6_1:1.7.0.16
	OPENBSD_6_1_BASE:1.7
	OPENBSD_6_0:1.7.0.12
	OPENBSD_6_0_BASE:1.7
	OPENBSD_5_9:1.7.0.8
	OPENBSD_5_9_BASE:1.7
	OPENBSD_5_8:1.7.0.10
	OPENBSD_5_8_BASE:1.7
	OPENBSD_5_7:1.7.0.4
	OPENBSD_5_7_BASE:1.7
	OPENBSD_5_6:1.7.0.6
	OPENBSD_5_6_BASE:1.7
	OPENBSD_5_5:1.7.0.2
	OPENBSD_5_5_BASE:1.7
	OPENBSD_5_4:1.5.0.14
	OPENBSD_5_4_BASE:1.5
	OPENBSD_5_3:1.5.0.12
	OPENBSD_5_3_BASE:1.5
	OPENBSD_5_2:1.5.0.10
	OPENBSD_5_2_BASE:1.5
	OPENBSD_5_1_BASE:1.5
	OPENBSD_5_1:1.5.0.8
	OPENBSD_5_0:1.5.0.6
	OPENBSD_5_0_BASE:1.5
	OPENBSD_4_9:1.5.0.4
	OPENBSD_4_9_BASE:1.5
	OPENBSD_4_8:1.5.0.2
	OPENBSD_4_8_BASE:1.5
	OPENBSD_4_7:1.3.0.2
	OPENBSD_4_7_BASE:1.3
	OPENBSD_4_6:1.3.0.4
	OPENBSD_4_6_BASE:1.3
	OPENBSD_4_5:1.2.0.2
	OPENBSD_4_5_BASE:1.2
	OPENBSD_4_4:1.1.0.2
	OPENBSD_4_4_BASE:1.1;
locks; strict;
comment	@ * @;


1.7
date	2013.11.13.20.41.14;	author deraadt;	state Exp;
branches;
next	1.6;

1.6
date	2013.11.12.22.50.39;	author deraadt;	state Exp;
branches;
next	1.5;

1.5
date	2010.07.03.00.21.14;	author halex;	state Exp;
branches;
next	1.4;

1.4
date	2010.06.27.20.00.58;	author phessler;	state Exp;
branches;
next	1.3;

1.3
date	2009.05.05.19.35.30;	author martynas;	state Exp;
branches;
next	1.2;

1.2
date	2008.10.21.17.54.00;	author martynas;	state Exp;
branches;
next	1.1;

1.1
date	2008.07.08.21.07.57;	author martynas;	state Exp;
branches;
next	;


desc
@@


1.7
log
@protos
@
text
@/*	$OpenBSD: list.c,v 1.6 2013/11/12 22:50:39 deraadt Exp $	*/

/*
 * Copyright (c) 2008 Martynas Venckus <martynas@@openbsd.org>
 *
 * Permission to use, copy, modify, and distribute this software for any
 * purpose with or without fee is hereby granted, provided that the above
 * copyright notice and this permission notice appear in all copies.
 *
 * THE SOFTWARE IS PROVIDED "AS IS" AND THE AUTHOR DISCLAIMS ALL WARRANTIES
 * WITH REGARD TO THIS SOFTWARE INCLUDING ALL IMPLIED WARRANTIES OF
 * MERCHANTABILITY AND FITNESS. IN NO EVENT SHALL THE AUTHOR BE LIABLE FOR
 * ANY SPECIAL, DIRECT, INDIRECT, OR CONSEQUENTIAL DAMAGES OR ANY DAMAGES
 * WHATSOEVER RESULTING FROM LOSS OF USE, DATA OR PROFITS, WHETHER IN AN
 * ACTION OF CONTRACT, NEGLIGENCE OR OTHER TORTIOUS ACTION, ARISING OUT OF
 * OR IN CONNECTION WITH THE USE OR PERFORMANCE OF THIS SOFTWARE.
 */

#ifndef SMALL

#include <string.h>

void	parse_list(char **, char *);

static void
parse_unix(char **line, char *type)
{
	char *tok;
	int field = 0;

	while ((tok = strsep(line, " \t")) != NULL) {
		if (*tok == '\0')
			continue;

		if (field == 0)
			*type = *tok;

		if (field == 7) {
			if (line == NULL || *line == NULL)
				break;
			while (**line == ' ' || **line == '\t')
				(*line)++;
			break;
		}

		field++;
	}
}

static void
parse_windows(char **line, char *type)
{
	char *tok;
	int field = 0;

	*type = '-';
	while ((tok = strsep(line, " \t")) != NULL) {
		if (*tok == '\0')
			continue;

		if (field == 2 && strcmp(tok, "<DIR>") == 0)
			*type = 'd';

		if (field == 2) {
			if (line == NULL || *line == NULL)
				break;
			while (**line == ' ' || **line == '\t')
				(*line)++;
			break;
		}

		field++;
	}
}

void
parse_list(char **line, char *type)
{
	if (**line >= '0' && **line <= '9')
		parse_windows(line, type);
	else
		parse_unix(line, type);
}

#endif /* !SMALL */

@


1.6
log
@simple prototype repairs
@
text
@d1 1
a1 1
/*	$OpenBSD: list.c,v 1.5 2010/07/03 00:21:14 halex Exp $	*/
d25 1
a25 1
void
d50 1
a50 1
void
@


1.5
log
@make lint happy

ok phessler@@
@
text
@d1 1
a1 1
/*	$OpenBSD: list.c,v 1.4 2010/06/27 20:00:58 phessler Exp $	*/
d22 2
@


1.4
log
@Fix a crash when the directory entry isn't complete.

found by Alexander Schrijver
OK halex@@
@
text
@d1 1
a1 1
/*	$OpenBSD: list.c,v 1.3 2009/05/05 19:35:30 martynas Exp $	*/
d78 3
a80 3
		return parse_windows(line, type);

	return parse_unix(line, type);
@


1.3
log
@make it clean removing the ifdef SMALL maze.  separate cmds and
small stuff.  make it a fetcher.  shrinks quite a bit
agreed by millert@@, krw@@
ok theo, sthen@@
@
text
@d1 1
a1 1
/*	$OpenBSD: list.c,v 1.2 2008/10/21 17:54:00 martynas Exp $	*/
d37 2
d63 2
@


1.2
log
@add rcs id
@
text
@d1 2
a2 1
/*	$OpenBSD$	*/
d20 1
d80 1
@


1.1
log
@- add support for recursive transfers (but not for floppies), e.g.
'mget -cr 4.*' would recursively fetch (-r), and resume the previous
transfers (-c) of 4.X release directories
uses local matching (fnmatch), but only for recursive transfers.
current behavior is not changed in any way.
- while here, ifndef SMALL debugging stuff, this saves some space,
for floppies
- some debugging code was enabled for non-debugging mode, checks
assume debug is set to zero, but it's not initially set
- all "Confirm with" prompts are forced, remove redundant argument
- fix usage: -C and -c are not available for SMALL

discussed a year ago w/ pyr@@
looks good to millert@@
previous version looked good to pyr@@
man page tweaks & ok jmc@@
@
text
@d1 1
@

