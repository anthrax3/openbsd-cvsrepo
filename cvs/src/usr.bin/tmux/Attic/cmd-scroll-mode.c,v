head	1.7;
access;
symbols
	OPENBSD_4_6:1.2.0.4
	OPENBSD_4_6_BASE:1.2;
locks; strict;
comment	@ * @;


1.7
date	2009.10.06.07.19.32;	author nicm;	state dead;
branches;
next	1.6;

1.6
date	2009.08.18.16.21.04;	author nicm;	state Exp;
branches;
next	1.5;

1.5
date	2009.07.26.12.58.44;	author nicm;	state Exp;
branches;
next	1.4;

1.4
date	2009.07.13.23.11.35;	author nicm;	state Exp;
branches;
next	1.3;

1.3
date	2009.07.13.18.44.17;	author nicm;	state Exp;
branches;
next	1.2;

1.2
date	2009.06.29.07.11.20;	author nicm;	state Exp;
branches;
next	1.1;

1.1
date	2009.06.01.22.58.49;	author nicm;	state Exp;
branches;
next	;


desc
@@


1.7
log
@Remove scroll mode which is now redundant, copy mode should be used instead.

The = key binding now does nothing.
@
text
@/* $OpenBSD: cmd-scroll-mode.c,v 1.6 2009/08/18 16:21:04 nicm Exp $ */

/*
 * Copyright (c) 2007 Nicholas Marriott <nicm@@users.sourceforge.net>
 *
 * Permission to use, copy, modify, and distribute this software for any
 * purpose with or without fee is hereby granted, provided that the above
 * copyright notice and this permission notice appear in all copies.
 *
 * THE SOFTWARE IS PROVIDED "AS IS" AND THE AUTHOR DISCLAIMS ALL WARRANTIES
 * WITH REGARD TO THIS SOFTWARE INCLUDING ALL IMPLIED WARRANTIES OF
 * MERCHANTABILITY AND FITNESS. IN NO EVENT SHALL THE AUTHOR BE LIABLE FOR
 * ANY SPECIAL, DIRECT, INDIRECT, OR CONSEQUENTIAL DAMAGES OR ANY DAMAGES
 * WHATSOEVER RESULTING FROM LOSS OF MIND, USE, DATA OR PROFITS, WHETHER
 * IN AN ACTION OF CONTRACT, NEGLIGENCE OR OTHER TORTIOUS ACTION, ARISING
 * OUT OF OR IN CONNECTION WITH THE USE OR PERFORMANCE OF THIS SOFTWARE.
 */

#include <sys/types.h>

#include "tmux.h"

/*
 * Enter scroll mode.
 */

void	cmd_scroll_mode_init(struct cmd *, int);
int	cmd_scroll_mode_exec(struct cmd *, struct cmd_ctx *);

const struct cmd_entry cmd_scroll_mode_entry = {
	"scroll-mode", NULL,
	"[-u] " CMD_TARGET_PANE_USAGE,
	0, CMD_CHFLAG('u'),
	cmd_scroll_mode_init,
	cmd_target_parse,
	cmd_scroll_mode_exec,
	cmd_target_free,
	cmd_target_print
};

void
cmd_scroll_mode_init(struct cmd *self, int key)
{
	struct cmd_target_data	*data;

	cmd_target_init(self, key);
	data = self->data;

	switch (key) {
	case KEYC_PPAGE:
		data->chflags |= CMD_CHFLAG('u');
		break;
	}
}

int
cmd_scroll_mode_exec(struct cmd *self, struct cmd_ctx *ctx)
{
	struct cmd_target_data	*data = self->data;
	struct window_pane	*wp;

	if (cmd_find_pane(ctx, data->target, NULL, &wp) == NULL)
		return (-1);

	window_pane_set_mode(wp, &window_scroll_mode);
	if (wp->mode == &window_scroll_mode && data->chflags & CMD_CHFLAG('u'))
		window_scroll_pageup(wp);

	return (0);
}
@


1.6
log
@Now that pane targets (-t) are supported, switch some commands to use them
where it makes sense: clock-mode, copy-mode, scroll-mode, send-keys,
send-prefix.
@
text
@d1 1
a1 1
/* $OpenBSD: cmd-scroll-mode.c,v 1.5 2009/07/26 12:58:44 nicm Exp $ */
@


1.5
log
@Make all messages sent between the client and server fixed size.

This is the first of two changes to make the protocol more resilient and less
sensitive to other changes in the code, particularly with commands. The client
now packs argv into a buffer and sends it to the server for parsing, rather
than doing it itself and sending the parsed command data.

As a side-effect this also removes a lot of now-unused command marshalling
code.

Mixing a server without this change and a client with or vice versa will cause
tmux to hang or crash, please ensure that tmux is entirely killed before
upgrading.
@
text
@d1 1
a1 1
/* $OpenBSD: cmd-scroll-mode.c,v 1.4 2009/07/13 23:11:35 nicm Exp $ */
d32 1
a32 1
	"[-u] " CMD_TARGET_WINDOW_USAGE,
a59 1
	struct winlink		*wl;
d62 1
a62 1
	if ((wl = cmd_find_window(ctx, data->target, NULL)) == NULL)
a63 1
	wp = wl->window->active;
@


1.4
log
@Having fixed flags for single-character getopt options is a bit hard to
maintain and is only going to get worse as more are used. So instead, add a new
uint64_t member to cmd_entry which is a bitmask of upper and lowercase options
accepted by the command.

This means new single character options can be used without the need to add it
explicitly to the list.
@
text
@d1 1
a1 1
/* $OpenBSD: cmd-scroll-mode.c,v 1.3 2009/07/13 18:44:17 nicm Exp $ */
a36 2
	cmd_target_send,
	cmd_target_recv,
@


1.3
log
@copy-mode and scroll-mode have a -u flag missing from usage, add it.
@
text
@d1 1
a1 1
/* $OpenBSD: cmd-scroll-mode.c,v 1.2 2009/06/29 07:11:20 nicm Exp $ */
d33 1
a33 1
	CMD_UFLAG,
d53 1
a53 1
		data->flags |= CMD_UFLAG;
d70 1
a70 1
	if (wp->mode == &window_scroll_mode && data->flags & CMD_UFLAG)
@


1.2
log
@Don't try to page up with scroll-mode -u or copy-mode -u unless the mode was
successfully changed - if already in a different mode, it would corrupt the
mode data.
@
text
@d1 1
a1 1
/* $OpenBSD: cmd-scroll-mode.c,v 1.1 2009/06/01 22:58:49 nicm Exp $ */
d32 1
a32 1
	CMD_TARGET_WINDOW_USAGE,
@


1.1
log
@Import tmux, a terminal multiplexor allowing (among other things) a single
terminal to be switched between several different windows and programs
displayed on one terminal be detached from one terminal and moved to another.

ok deraadt pirofti
@
text
@d1 1
a1 1
/* $OpenBSD$ */
d63 1
d67 1
d69 3
a71 3
	window_pane_set_mode(wl->window->active, &window_scroll_mode);
	if (data->flags & CMD_UFLAG)
		window_scroll_pageup(wl->window->active);
@

