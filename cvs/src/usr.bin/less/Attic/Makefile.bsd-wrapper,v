head	1.24;
access;
symbols
	OPENBSD_5_0:1.23.0.16
	OPENBSD_5_0_BASE:1.23
	OPENBSD_4_9:1.23.0.14
	OPENBSD_4_9_BASE:1.23
	OPENBSD_4_8:1.23.0.12
	OPENBSD_4_8_BASE:1.23
	OPENBSD_4_7:1.23.0.8
	OPENBSD_4_7_BASE:1.23
	OPENBSD_4_6:1.23.0.10
	OPENBSD_4_6_BASE:1.23
	OPENBSD_4_5:1.23.0.6
	OPENBSD_4_5_BASE:1.23
	OPENBSD_4_4:1.23.0.4
	OPENBSD_4_4_BASE:1.23
	OPENBSD_4_3:1.23.0.2
	OPENBSD_4_3_BASE:1.23
	OPENBSD_4_2:1.22.0.4
	OPENBSD_4_2_BASE:1.22
	OPENBSD_4_1:1.22.0.2
	OPENBSD_4_1_BASE:1.22
	OPENBSD_4_0:1.21.0.14
	OPENBSD_4_0_BASE:1.21
	OPENBSD_3_9:1.21.0.12
	OPENBSD_3_9_BASE:1.21
	OPENBSD_3_8:1.21.0.10
	OPENBSD_3_8_BASE:1.21
	OPENBSD_3_7:1.21.0.8
	OPENBSD_3_7_BASE:1.21
	OPENBSD_3_6:1.21.0.6
	OPENBSD_3_6_BASE:1.21
	OPENBSD_3_5:1.21.0.4
	OPENBSD_3_5_BASE:1.21
	OPENBSD_3_4:1.21.0.2
	OPENBSD_3_4_BASE:1.21
	OPENBSD_3_3:1.18.0.18
	OPENBSD_3_3_BASE:1.18
	OPENBSD_3_2:1.18.0.16
	OPENBSD_3_2_BASE:1.18
	OPENBSD_3_1:1.18.0.14
	OPENBSD_3_1_BASE:1.18
	OPENBSD_3_0:1.18.0.12
	OPENBSD_3_0_BASE:1.18
	OPENBSD_2_9_BASE:1.18
	OPENBSD_2_9:1.18.0.10
	OPENBSD_2_8:1.18.0.8
	OPENBSD_2_8_BASE:1.18
	OPENBSD_2_7:1.18.0.6
	OPENBSD_2_7_BASE:1.18
	OPENBSD_2_6:1.18.0.4
	OPENBSD_2_6_BASE:1.18
	OPENBSD_2_5:1.18.0.2
	OPENBSD_2_5_BASE:1.18
	OPENBSD_2_4:1.17.0.2
	OPENBSD_2_4_BASE:1.17
	OPENBSD_2_3:1.16.0.4
	OPENBSD_2_3_BASE:1.16
	OPENBSD_2_2:1.16.0.2
	OPENBSD_2_2_BASE:1.16
	OPENBSD_2_1:1.9.0.2
	OPENBSD_2_1_BASE:1.9
	OPENBSD_2_0:1.7.0.2
	OPENBSD_2_0_BASE:1.7
	OpenBSD_1_2:1.7;
locks; strict;
comment	@# @;


1.24
date	2011.09.16.18.12.09;	author shadchin;	state dead;
branches;
next	1.23;

1.23
date	2007.11.03.15.15.40;	author espie;	state Exp;
branches;
next	1.22;

1.22
date	2006.10.14.20.20.51;	author drahn;	state Exp;
branches;
next	1.21;

1.21
date	2003.04.16.17.54.20;	author millert;	state Exp;
branches;
next	1.20;

1.20
date	2003.04.14.14.33.57;	author millert;	state Exp;
branches;
next	1.19;

1.19
date	2003.04.13.18.26.25;	author millert;	state Exp;
branches;
next	1.18;

1.18
date	99.02.03.23.36.45;	author millert;	state Exp;
branches;
next	1.17;

1.17
date	98.10.18.20.02.36;	author millert;	state Exp;
branches;
next	1.16;

1.16
date	97.09.05.07.15.10;	author kstailey;	state Exp;
branches;
next	1.15;

1.15
date	97.08.01.20.14.31;	author kstailey;	state Exp;
branches;
next	1.14;

1.14
date	97.08.01.20.12.30;	author kstailey;	state Exp;
branches;
next	1.13;

1.13
date	97.07.29.03.37.04;	author kstailey;	state Exp;
branches;
next	1.12;

1.12
date	97.07.29.03.16.29;	author kstailey;	state Exp;
branches;
next	1.11;

1.11
date	97.06.23.22.15.14;	author kstailey;	state Exp;
branches;
next	1.10;

1.10
date	97.06.22.16.12.00;	author kstailey;	state Exp;
branches;
next	1.9;

1.9
date	97.04.27.20.56.46;	author millert;	state Exp;
branches;
next	1.8;

1.8
date	97.01.23.02.24.22;	author niklas;	state Exp;
branches;
next	1.7;

1.7
date	96.09.27.06.09.00;	author etheisen;	state Exp;
branches;
next	1.6;

1.6
date	96.09.26.04.39.17;	author etheisen;	state Exp;
branches;
next	1.5;

1.5
date	96.09.25.06.38.33;	author etheisen;	state Exp;
branches;
next	1.4;

1.4
date	96.09.25.03.59.03;	author etheisen;	state Exp;
branches;
next	1.3;

1.3
date	96.09.22.06.34.07;	author etheisen;	state Exp;
branches;
next	1.2;

1.2
date	96.09.21.07.49.07;	author etheisen;	state Exp;
branches;
next	1.1;

1.1
date	96.09.21.05.55.35;	author etheisen;	state Exp;
branches;
next	;


desc
@@


1.24
log
@Merge in less 444 plus local changes

ok nicm@@
@
text
@#	$OpenBSD: Makefile.bsd-wrapper,v 1.23 2007/11/03 15:15:40 espie Exp $

#
# less config
#
PREFIX=		/usr
BINDIR=		${PREFIX}/bin
DATADIR=	${PREFIX}/share/misc
LIBS=		-lcurses
LESS_HLP=	more.help
LINKS=		${BINDIR}/less ${BINDIR}/more ${BINDIR}/less ${BINDIR}/page
MAN=		less.1 lesskey.1
MLINKS=		less.1 more.1 less.1 page.1
CLEANFILES=	config.cache config.log

#
# Wrapped flags
#
XCFLAGS= CC="${CC}" CFLAGS="${CFLAGS} ${COPTS}" LDFLAGS="${LDFLAGS} ${LDSTATIC}"

all: config.status gnu_build

.FORCE: .IGNORE

.include <bsd.own.mk>

.ifdef GLOBAL_AUTOCONF_CACHE
CF=     --cache-file=${GLOBAL_AUTOCONF_CACHE}
.else
CF=	--cache-file=config.cache
.endif

HOST_ARCH!=arch -s
.if    (${MACHINE_ARCH} != ${HOST_ARCH})
CF+=   --target=openbsd-${MACHINE_ARCH} --host=${HOST_ARCH}
.endif

config: .FORCE
.ifndef GLOBAL_AUTOCONF_CACHE
	-rm -f config.cache
.endif
	${XCFLAGS} PATH="/bin:/usr/bin:/sbin:/usr/sbin" \
		INSTALL_PROGRAM="${INSTALL} ${INSTALL_COPY} ${INSTALL_STRIP}" \
		TERMLIBS=-lcurses /bin/sh ${.CURDIR}/configure \
		--prefix=/usr --mandir=/usr/share/man --sysconfdir=/etc ${CF}

config.status:
	${XCFLAGS} PATH="/bin:/usr/bin:/sbin:/usr/sbin" \
		INSTALL_PROGRAM="${INSTALL} ${INSTALL_COPY} ${INSTALL_STRIP}" \
		TERMLIBS=-lcurses /bin/sh ${.CURDIR}/configure \
		--prefix=/usr --mandir=/usr/share/man --sysconfdir=/etc ${CF}

gnu_build: config.status
	${MAKE} ${XCFLAGS} LIBS=${LIBS} datadir=${DATADIR} LESS_HLP=${LESS_HLP}

.ifdef NOMAN
maninstall:
	@@echo NOMAN is set
.endif

install: gnu_install maninstall afterinstall _SUBDIRUSE
.if defined(LINKS) && !empty(LINKS)
	@@set ${LINKS}; \
	while test $$# -ge 2; do \
		l=${DESTDIR}$$1; \
		shift; \
		t=${DESTDIR}$$1; \
		shift; \
		echo $$t -\> $$l; \
		rm -f $$t; \
		ln $$l $$t; \
	done; true
.endif

gnu_install:
	${MAKE} ${XCFLAGS} LIBS=${LIBS} \
		LESS_HLP=${LESS_HLP} bindir=${DESTDIR}${BINDIR} \
		datadir=${DESTDIR}${PREFIX}/share/misc \
		INSTALL_PROGRAM="${INSTALL} ${INSTALL_COPY} ${INSTALL_STRIP} -o ${BINOWN} -g ${BINGRP} -m ${BINMODE}" \
		INSTALL_DATA="${INSTALL} ${INSTALL_COPY} -o ${BINOWN} -g ${BINGRP} -m 444" \
		INSTALL_MAN= INSTALLDIRS= install

clean cleandir:
	rm -f ${CLEANFILES}
	-@@if [ -e Makefile ]; then ${MAKE} distclean; fi

afterinstall:
	${INSTALL} ${INSTALL_COPY} -o ${BINOWN} -g ${BINGRP} -m ${NONBINMODE} \
		${.CURDIR}/less.hlp ${DESTDIR}${DATADIR}/${LESS_HLP}

depend:
	# Nothing here so far...

lint:
	# Nothing here so far...

tags:
	# Nothing here so far...

.include <bsd.obj.mk>
.include <bsd.subdir.mk>
.if !defined(NOMAN)
.include <bsd.man.mk>
.endif
@


1.23
log
@main build can only happen after configure has run.
@
text
@d1 1
a1 1
#	$OpenBSD: Makefile.bsd-wrapper,v 1.22 2006/10/14 20:20:51 drahn Exp $
@


1.22
log
@Allow less to build in Makefile.cross environment.
@
text
@d1 1
a1 1
#	$OpenBSD: Makefile.bsd-wrapper,v 1.22 2006/10/14 20:14:18 drahn Exp $
d53 1
a53 1
gnu_build:
@


1.21
log
@mdoc format man pages from jmc@@
@
text
@d1 1
a1 1
#	$OpenBSD: Makefile.bsd-wrapper,v 1.20 2003/04/14 14:33:57 millert Exp $
d31 5
@


1.20
log
@o go back to using a help file instead of embedding it in the binary
o deal with HELPFILE not being defined
o add a SMALL definition to make a smaller less for the boot floppies
This still needs to be pared down a bit for the SMALL case
@
text
@d1 1
a1 1
#	$OpenBSD: Makefile.bsd-wrapper,v 1.19 2003/04/13 18:26:25 millert Exp $
d14 1
a14 1
CLEANFILES=	config.cache config.log $(MAN)
a22 19
#
# XXX - This is needed because crunchgen wasn't 
#       designed to work with wrappers.  The
#	default sys.mk SUFFIX rules were being
#	invoked accidentally and crunchgen
#	couldn't figure out what objects were
#	needed.
#
OBJS=	main.o screen.o brac.o ch.o charset.o cmdbuf.o \
	command.o decode.o edit.o filename.o forwback.o \
	help.o ifile.o input.o jump.o line.o linenum.o \
	lsystem.o mark.o optfunc.o option.o opttbl.o os.o \
	output.o position.o prompt.o search.o signal.o \
	tags.o ttyin.o version.o
.SUFFIXES: .o .c
.c.o: config.status
	@@$(MAKE) ${XCFLAGS} LIBS=${LIBS} \
		 datadir=${DATADIR} LESS_HLP=${LESS_HLP} ${.TARGET}

a84 8

#
# Fix less manpage suffix 
#
.SUFFIXES: .nro .1 .2 .3 .4 .5 .6 .7 .8 .9

.nro.1 .nro.2 .nro.3 .nro.4 .nro.5 .nro.6 .nro.7 .nro.8 .nro.9:
	-@@ln -sf ${.IMPSRC} ${.TARGET}
@


1.19
log
@Merge in less-381 w/ local changes and remove obsolete files.
@
text
@d1 1
a1 1
#	$OpenBSD: Makefile.bsd-wrapper,v 1.18 1999/02/03 23:36:45 millert Exp $
d10 1
d40 1
a40 1
		 datadir=${DATADIR} ${.TARGET}
d57 1
a57 1
	INSTALL_PROGRAM="${INSTALL} ${INSTALL_COPY} ${INSTALL_STRIP}" \
d63 1
a63 1
	INSTALL_PROGRAM="${INSTALL} ${INSTALL_COPY} ${INSTALL_STRIP}" \
d68 1
a68 1
	${MAKE} ${XCFLAGS} LIBS=${LIBS} datadir=${DATADIR}
d75 1
a75 1
install: gnu_install maninstall _SUBDIRUSE
d91 1
a91 1
		bindir=${DESTDIR}${BINDIR} \
d100 4
@


1.18
log
@Use ${COPTS}; wd@@ics.nara-wu.ac.jp
@
text
@d1 1
a1 1
#	$OpenBSD: Makefile.bsd-wrapper,v 1.17 1998/10/18 20:02:36 millert Exp $
a8 1
LESS_HLP=	more.help
d18 1
a18 3
WCC=		CC="${CC}"
WCFLAGS=	CFLAGS="${CFLAGS} ${COPTS}"
WLDFLAGS=	LDFLAGS="${LDSTATIC}"
d38 2
a39 2
	@@$(MAKE) ${WCC} ${WCFLAGS} ${WLDFLAGS} LIBS=${LIBS} \
		 datadir=${DATADIR} LESS_HLP=${LESS_HLP} ${.TARGET}
d48 1
a48 1
CF=
d55 1
a55 1
	PATH="/bin:/usr/bin:/sbin:/usr/sbin" \
d57 2
a58 1
		/bin/sh ${.CURDIR}/configure --prefix=/usr ${CF}
d61 1
a61 1
	PATH="/bin:/usr/bin:/sbin:/usr/sbin" \
d63 2
a64 1
		/bin/sh ${.CURDIR}/configure --prefix=/usr ${CF}
d67 1
a67 2
	${MAKE} ${WCC} ${WCFLAGS} ${WLDFLAGS} LIBS=${LIBS} datadir=${DATADIR} \
		LESS_HLP=${LESS_HLP}
d89 2
a90 2
	${MAKE} ${WCC} ${WCFLAGS} ${WLDFLAGS} LIBS=${LIBS} \
		LESS_HLP=${LESS_HLP} bindir=${DESTDIR}${BINDIR} \
@


1.17
log
@set PATH before running configure since we can't rely on the user's path being sane
@
text
@d1 1
a1 1
#	$OpenBSD: Makefile.bsd-wrapper,v 1.16 1997/09/05 07:15:10 kstailey Exp $
d20 1
a20 1
WCFLAGS=	CFLAGS="${CFLAGS}"
@


1.16
log
@s/$(CF)/${CF}/
@
text
@d1 1
a1 1
#	$OpenBSD: Makefile.bsd-wrapper,v 1.15 1997/08/01 20:14:31 kstailey Exp $
d10 1
a10 1
LIBS=		-ltermcap
d58 1
d63 1
@


1.15
log
@tabify.
@
text
@d1 1
a1 1
#	$OpenBSD: Makefile.bsd-wrapper,v 1.14 1997/08/01 20:12:30 kstailey Exp $
d46 2
d59 1
a59 1
		/bin/sh ${.CURDIR}/configure --prefix=/usr $(CF)
d63 1
a63 1
		/bin/sh ${.CURDIR}/configure --prefix=/usr $(CF)
@


1.14
log
@reduce GLOBAL_AUTOCONF_CACHE code.
@
text
@d1 1
a1 1
#	$OpenBSD: Makefile.bsd-wrapper,v 1.13 1997/07/29 03:37:04 kstailey Exp $
d54 1
a54 1
        -rm -f config.cache
d56 2
a57 2
        INSTALL_PROGRAM="${INSTALL} ${INSTALL_COPY} ${INSTALL_STRIP}" \
                /bin/sh ${.CURDIR}/configure --prefix=/usr $(CF)
d60 2
a61 2
        INSTALL_PROGRAM="${INSTALL} ${INSTALL_COPY} ${INSTALL_STRIP}" \
                /bin/sh ${.CURDIR}/configure --prefix=/usr $(CF)
@


1.13
log
@Changed the rules.
The variable is now GLOBAL_AUTOCONF_CACHE.  You must set it to the name
of the cache file to use.  Ether "setenv GLOBAL_AUTOCONF_CACHE /var/tmp/foo"
or add it to /etc/mk.conf
@
text
@d1 1
a1 1
#	$OpenBSD: Makefile.bsd-wrapper,v 1.12 1997/07/29 03:16:29 kstailey Exp $
d47 4
a50 3
config: .FORCE
	/bin/sh ${.CURDIR}/configure --prefix=${PREFIX} \
		--cache-file=${GLOBAL_AUTOCONF_CACHE}
a51 4
config.status:
	/bin/sh ${.CURDIR}/configure --prefix=${PREFIX} \
		--cache-file=${GLOBAL_AUTOCONF_CACHE}
.else
d53 5
a57 2
	-rm -f config.cache
	/bin/sh ${.CURDIR}/configure --prefix=${PREFIX}
d60 2
a61 3
	/bin/sh ${.CURDIR}/configure --prefix=${PREFIX}
.endif

@


1.12
log
@Start of GLOBAL_CACHE option to speed compiles.
This change should have no effect by default.
"setenv GLOBAL_CACHE" or add GLOBAL_CACHE to /etc/mk.conf to activate.
Global cache files are on a per-account basis to deal with security.
@
text
@d1 1
a1 1
#	$OpenBSD: Makefile.bsd-wrapper,v 1.11 1997/06/23 22:15:14 kstailey Exp $
d46 1
a46 1
.ifdef GLOBAL_CACHE
d49 1
a49 1
		--cache-file=${HOME}/.Makefile.bsd-wrapper.cache
d53 1
a53 1
		--cache-file=${HOME}/.Makefile.bsd-wrapper.cache
@


1.11
log
@respect NOMAN during install
@
text
@d1 1
a1 1
#	$OpenBSD: Makefile.bsd-wrapper,v 1.10 1997/06/22 16:12:00 kstailey Exp $
d46 9
d61 2
@


1.10
log
@respect NOMAN!
@
text
@d1 1
a1 1
#	$OpenBSD: Makefile.bsd-wrapper,v 1.9 1997/04/27 20:56:46 millert Exp $
d56 5
@


1.9
log
@COPY -> INSTALL_COPY and STRIP -> INSTALL_STRIP
This fixes namespace problems where STRIP is sometimes used as
the name of the strip(1) to use and other times used as
the flag to send install(1) when stripping (or not).
COPY doesn't have this problem (yet) but was poorly named.
@
text
@d1 1
a1 1
#	$OpenBSD: Makefile.bsd-wrapper,v 1.8 1997/01/23 02:24:22 niklas Exp $
d102 1
d104 1
@


1.8
log
@Use ${INSTALL}.  Also make all $(foo) be ${foo}.
@
text
@d1 1
a1 1
#	$OpenBSD: Makefile.bsd-wrapper,v 1.7 1996/09/27 06:09:00 etheisen Exp $
d75 2
a76 2
		INSTALL_PROGRAM="${INSTALL} ${COPY} ${STRIP} -o ${BINOWN} -g ${BINGRP} -m ${BINMODE}" \
		INSTALL_DATA="${INSTALL} ${COPY} -o ${BINOWN} -g ${BINGRP} -m 444" \
@


1.7
log
@Beat crunchgen'd less into submission.
@
text
@d1 1
a1 1
#	$OpenBSD: Makefile.bsd-wrapper,v 1.6 1996/09/26 04:39:17 etheisen Exp $
d7 2
a8 2
BINDIR=		$(PREFIX)/bin
DATADIR=	$(PREFIX)/share/misc
d19 3
a21 2
WCFLAGS=	CFLAGS="$(CFLAGS)"
WLDFLAGS=	LDFLAGS="$(LDSTATIC)"
d41 2
a42 1
	@@$(MAKE) $(WCFLAGS) $(WLDFLAGS) LIBS=$(LIBS) datadir=$(DATADIR) LESS_HLP=$(LESS_HLP) $(.TARGET)
d48 1
a48 1
	/bin/sh $(.CURDIR)/configure --prefix=$(PREFIX)
d51 1
a51 1
	/bin/sh $(.CURDIR)/configure --prefix=$(PREFIX)
d54 2
a55 1
	$(MAKE) $(WCFLAGS) $(WLDFLAGS) LIBS=$(LIBS) datadir=$(DATADIR) LESS_HLP=$(LESS_HLP)
d72 5
a76 5
	$(MAKE) $(WCFLAGS) $(WLDFLAGS) LIBS=$(LIBS) LESS_HLP=$(LESS_HLP) \
		bindir=$(DESTDIR)$(BINDIR) \
		datadir=$(DESTDIR)$(PREFIX)/share/misc \
		INSTALL_PROGRAM="install $(COPY) $(STRIP) -o $(BINOWN) -g $(BINGRP) -m $(BINMODE)" \
		INSTALL_DATA="install $(COPY) -o ${BINOWN} -g ${BINGRP} -m 444" \
d80 2
a81 2
	rm -f $(CLEANFILES)
	-@@if [ -e Makefile ]; then $(MAKE) distclean; fi
d89 1
a89 1
	-@@ln -sf $(.IMPSRC) $(.TARGET)
@


1.6
log
@Doh! DESTDIR
@
text
@d1 1
a1 1
#	$OpenBSD: Makefile.bsd-wrapper,v 1.5 1996/09/25 06:38:33 etheisen Exp $
d7 1
d25 6
a30 1
# crunchgen
d38 3
a40 1
$(OBJS): config.status cg_build
a53 6
#
# crunchgen build
#
cg_build:
	$(MAKE) $(WCFLAGS) $(WLDFLAGS) LIBS=$(LIBS) datadir=$(DATADIR) LESS_HLP=$(LESS_HLP) $(OBJS)

d70 1
a70 1
		bindir=$(DESTDIR)$(PREFIX)/bin \
a96 1
.include <bsd.prog.mk>
@


1.5
log
@Better crunchgen support.
@
text
@d1 1
a1 1
#	$OpenBSD: Makefile.bsd-wrapper,v 1.4 1996/09/25 03:59:03 etheisen Exp $
d67 3
a69 1
	$(MAKE) $(WCFLAGS) $(WLDFLAGS) LIBS=$(LIBS) datadir=$(DATADIR) LESS_HLP=$(LESS_HLP) \
@


1.4
log
@OBJS var needed for crunchgen.
@
text
@d1 1
a1 3
#	$OpenBSD: Makefile.bsd-wrapper,v 1.3 1996/09/22 06:34:07 etheisen Exp $

LINKS=		${BINDIR}/less ${BINDIR}/more ${BINDIR}/less ${BINDIR}/page
d10 1
d16 9
a24 1
# XXX - crunchgen crap
d32 1
a32 8

#
# Wrapped flags
#
WCFLAGS=	CFLAGS="$(CFLAGS)"
WLDFLAGS=	LDFLAGS="$(LDSTATIC)"

all: config.status gnu_build
d46 6
d93 1
a93 1
.include <../Makefile.inc>
@


1.3
log
@I don't do curses and certainly not with termcap.  Fix the libraries
being linked in.
@
text
@d1 1
a1 1
#	$OpenBSD: Makefile.bsd-wrapper,v 1.2 1996/09/21 07:49:07 etheisen Exp $
d15 10
@


1.2
log
@Cleanup
@
text
@d1 1
a1 1
#	$OpenBSD: Makefile.bsd-wrapper,v 1.1 1996/09/21 05:55:35 etheisen Exp $
d11 1
d34 1
a34 1
	$(MAKE) $(WCFLAGS) $(WLDFLAGS) datadir=$(DATADIR) LESS_HLP=$(LESS_HLP)
d51 1
a51 1
	$(MAKE) $(WCFLAGS) $(WLDFLAGS) datadir=$(DATADIR) LESS_HLP=$(LESS_HLP) \
@


1.1
log
@Build less-290 using wrappers.
@
text
@d1 1
a1 1
#	$OpenBSD$
d10 1
d33 1
a33 1
	$(MAKE) $(WCFLAGS) $(WLDFLAGS) datadir=$(DATADIR)
d50 1
a50 1
	$(MAKE) $(WCFLAGS) $(WLDFLAGS) datadir=$(DATADIR) \
@
