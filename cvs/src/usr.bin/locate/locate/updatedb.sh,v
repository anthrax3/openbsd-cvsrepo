head	1.13;
access;
symbols
	OPENBSD_6_1:1.13.0.6
	OPENBSD_6_1_BASE:1.13
	OPENBSD_6_0:1.13.0.4
	OPENBSD_6_0_BASE:1.13
	OPENBSD_5_9:1.13.0.2
	OPENBSD_5_9_BASE:1.13
	OPENBSD_5_8:1.12.0.36
	OPENBSD_5_8_BASE:1.12
	OPENBSD_5_7:1.12.0.28
	OPENBSD_5_7_BASE:1.12
	OPENBSD_5_6:1.12.0.32
	OPENBSD_5_6_BASE:1.12
	OPENBSD_5_5:1.12.0.30
	OPENBSD_5_5_BASE:1.12
	OPENBSD_5_4:1.12.0.26
	OPENBSD_5_4_BASE:1.12
	OPENBSD_5_3:1.12.0.24
	OPENBSD_5_3_BASE:1.12
	OPENBSD_5_2:1.12.0.22
	OPENBSD_5_2_BASE:1.12
	OPENBSD_5_1_BASE:1.12
	OPENBSD_5_1:1.12.0.20
	OPENBSD_5_0:1.12.0.18
	OPENBSD_5_0_BASE:1.12
	OPENBSD_4_9:1.12.0.16
	OPENBSD_4_9_BASE:1.12
	OPENBSD_4_8:1.12.0.14
	OPENBSD_4_8_BASE:1.12
	OPENBSD_4_7:1.12.0.10
	OPENBSD_4_7_BASE:1.12
	OPENBSD_4_6:1.12.0.12
	OPENBSD_4_6_BASE:1.12
	OPENBSD_4_5:1.12.0.8
	OPENBSD_4_5_BASE:1.12
	OPENBSD_4_4:1.12.0.6
	OPENBSD_4_4_BASE:1.12
	OPENBSD_4_3:1.12.0.4
	OPENBSD_4_3_BASE:1.12
	OPENBSD_4_2:1.12.0.2
	OPENBSD_4_2_BASE:1.12
	OPENBSD_4_1:1.11.0.14
	OPENBSD_4_1_BASE:1.11
	OPENBSD_4_0:1.11.0.12
	OPENBSD_4_0_BASE:1.11
	OPENBSD_3_9:1.11.0.10
	OPENBSD_3_9_BASE:1.11
	OPENBSD_3_8:1.11.0.8
	OPENBSD_3_8_BASE:1.11
	OPENBSD_3_7:1.11.0.6
	OPENBSD_3_7_BASE:1.11
	OPENBSD_3_6:1.11.0.4
	OPENBSD_3_6_BASE:1.11
	OPENBSD_3_5:1.11.0.2
	OPENBSD_3_5_BASE:1.11
	OPENBSD_3_4:1.10.0.24
	OPENBSD_3_4_BASE:1.10
	OPENBSD_3_3:1.10.0.22
	OPENBSD_3_3_BASE:1.10
	OPENBSD_3_2:1.10.0.20
	OPENBSD_3_2_BASE:1.10
	OPENBSD_3_1:1.10.0.18
	OPENBSD_3_1_BASE:1.10
	OPENBSD_3_0:1.10.0.16
	OPENBSD_3_0_BASE:1.10
	OPENBSD_2_9_BASE:1.10
	OPENBSD_2_9:1.10.0.14
	OPENBSD_2_8:1.10.0.12
	OPENBSD_2_8_BASE:1.10
	OPENBSD_2_7:1.10.0.10
	OPENBSD_2_7_BASE:1.10
	OPENBSD_2_6:1.10.0.8
	OPENBSD_2_6_BASE:1.10
	OPENBSD_2_5:1.10.0.6
	OPENBSD_2_5_BASE:1.10
	OPENBSD_2_4:1.10.0.4
	OPENBSD_2_4_BASE:1.10
	OPENBSD_2_3:1.10.0.2
	OPENBSD_2_3_BASE:1.10
	OPENBSD_2_2:1.9.0.4
	OPENBSD_2_2_BASE:1.9
	OPENBSD_2_1:1.9.0.2
	OPENBSD_2_1_BASE:1.9
	OPENBSD_2_0:1.3.0.2
	OPENBSD_2_0_BASE:1.3;
locks; strict;
comment	@# @;


1.13
date	2015.08.14.03.02.07;	author rzalamena;	state Exp;
branches;
next	1.12;
commitid	PisPPvIXzvGpQidJ;

1.12
date	2007.03.15.22.24.18;	author jmc;	state Exp;
branches;
next	1.11;

1.11
date	2003.09.29.16.03.16;	author deraadt;	state Exp;
branches;
next	1.10;

1.10
date	97.12.13.20.06.14;	author deraadt;	state Exp;
branches;
next	1.9;

1.9
date	97.04.03.00.57.49;	author michaels;	state Exp;
branches;
next	1.8;

1.8
date	97.04.02.08.35.01;	author deraadt;	state Exp;
branches;
next	1.7;

1.7
date	97.01.04.01.36.01;	author millert;	state Exp;
branches;
next	1.6;

1.6
date	97.01.03.23.33.49;	author millert;	state Exp;
branches;
next	1.5;

1.5
date	96.11.30.18.12.51;	author millert;	state Exp;
branches;
next	1.4;

1.4
date	96.10.20.00.52.58;	author michaels;	state Exp;
branches;
next	1.3;

1.3
date	96.09.15.23.38.39;	author deraadt;	state Exp;
branches;
next	1.2;

1.2
date	96.09.15.16.50.41;	author michaels;	state Exp;
branches;
next	1.1;

1.1
date	96.08.17.09.37.47;	author michaels;	state Exp;
branches;
next	;


desc
@@


1.13
log
@Move locate(1) database build directory back to /tmp and kill non-existent
/usr/tmp references.

Diff from Craig Skinner via tech@@ plus a /usr/tmp removal from me in the
updatedb script.

ok millert@@.
@
text
@#!/bin/sh
#
#	$OpenBSD: updatedb.sh,v 1.12 2007/03/15 22:24:18 jmc Exp $
#
# Copyright (c) September 1995 Wolfram Schneider <wosch@@FreeBSD.org>. Berlin.
# All rights reserved.
#
# Redistribution and use in source and binary forms, with or without
# modification, are permitted provided that the following conditions
# are met:
# 1. Redistributions of source code must retain the above copyright
#    notice, this list of conditions and the following disclaimer.
# 2. Redistributions in binary form must reproduce the above copyright
#    notice, this list of conditions and the following disclaimer in the
#    documentation and/or other materials provided with the distribution.
#
# THIS SOFTWARE IS PROVIDED BY THE AUTHOR AND CONTRIBUTORS ``AS IS'' AND
# ANY EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT LIMITED TO, THE
# IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE
# ARE DISCLAIMED.  IN NO EVENT SHALL THE AUTHOR OR CONTRIBUTORS BE LIABLE
# FOR ANY DIRECT, INDIRECT, INCIDENTAL, SPECIAL, EXEMPLARY, OR CONSEQUENTIAL
# DAMAGES (INCLUDING, BUT NOT LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS
# OR SERVICES; LOSS OF USE, DATA, OR PROFITS; OR BUSINESS INTERRUPTION)
# HOWEVER CAUSED AND ON ANY THEORY OF LIABILITY, WHETHER IN CONTRACT, STRICT
# LIABILITY, OR TORT (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY
# OUT OF THE USE OF THIS SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF
# SUCH DAMAGE.
#
# updatedb - update locate database for local mounted filesystems
#
# $Id: updatedb.sh,v 1.12 2007/03/15 22:24:18 jmc Exp $

LOCATE_CONFIG="/etc/locate.rc"
if [ -f "$LOCATE_CONFIG" -a -r "$LOCATE_CONFIG" ]; then
       . $LOCATE_CONFIG
fi

# The directory containing locate subprograms
: ${LIBEXECDIR=/usr/libexec}; export LIBEXECDIR
TMPDIR=${TMPDIR:-/tmp}; export TMPDIR;

PATH=$LIBEXECDIR:/bin:/usr/bin:$PATH; export PATH

USAGE="usage: $0 [--fcodes=dbfile] [--filesystems='type ...'] [--prunepaths='dir ...'] [--searchpaths='dir ...'] [--tmpdir=dir]"

: ${mklocatedb=locate.mklocatedb}	 # make locate database program
: ${FCODES=/var/db/locate.database}	 # the database
: ${SEARCHPATHS="/"}			 # directories to be put in the database
: ${PRUNEPATHS="/tmp /var/tmp"}		 # unwanted directories
: ${FILESYSTEMS="ffs ufs"}		 # allowed filesystems 
: ${find=find}

# Command line args override rc file and defaults
while test $# != 0; do
	option=`echo $1 | sed 's/^\([^=]*\).*$/\1/'`
	optarg=`echo $1 | sed 's/^[^=]*=\(.*$\)/\1/'`

	# All options take an argument
	if [ "$option" = "$optarg" ]; then
		echo "$USAGE"
		exit 1
	fi

	case "$option" in
		--tmpdir) TMPDIR="$optarg";;
		--fcodes) FCODES="$optarg";;
		--searchpaths) SEARCHPATHS="$optarg";;
		--prunepaths) PRUNEPATHS="$optarg";;
		--filesystems) FILESYSTEMS="$optarg";;
	esac
	shift
done

case X"$SEARCHPATHS" in 
	X) echo "$0: empty variable SEARCHPATHS"; exit 1;; esac
case X"$FILESYSTEMS" in 
	X) echo "$0: empty variable FILESYSTEMS"; exit 1;; esac

# Make a list a paths to exclude in the locate run
excludes="! (" or=""
for fstype in $FILESYSTEMS
do
       excludes="$excludes $or -fstype $fstype"
       or="-or"
done
excludes="$excludes ) -prune"

case X"$PRUNEPATHS" in
	X) ;;
	*) for path in $PRUNEPATHS
           do 
		excludes="$excludes -or -path $path -prune"
	   done;;
esac

tmp=`mktemp ${TMPDIR=/tmp}/_updatedb.XXXXXXXXXX` || exit 1
trap 'rm -rf $tmp' 0 1 2 3 5 10 15

# search locally
# echo $find $SEARCHPATHS $excludes -or -print && exit
if $find $SEARCHPATHS $excludes -or -print 2>/dev/null | 
        $mklocatedb > $tmp
then
	case X"`$find $tmp -size -257c -print`" in
		X) if [ "$FCODES" = "-" ]; then
			cat $tmp
		   else
			cat $tmp > $FCODES
		   fi;;
		*) echo "updatedb: locate database $tmp is empty"
		   exit 1
	esac
fi
@


1.12
log
@simplify synopsis/usage() and sort options. also fixes documentation/5411
from han
@
text
@d3 1
a3 1
#	$OpenBSD: updatedb.sh,v 1.11 2003/09/29 16:03:16 deraadt Exp $
d31 1
a31 1
# $Id: updatedb.sh,v 1.11 2003/09/29 16:03:16 deraadt Exp $
d49 1
a49 1
: ${PRUNEPATHS="/tmp /usr/tmp /var/tmp"} # unwanted directories
@


1.11
log
@knf
@
text
@d3 1
a3 1
#	$OpenBSD: updatedb.sh,v 1.10 1997/12/13 20:06:14 deraadt Exp $
d31 1
a31 1
# $Id: updatedb.sh,v 1.10 1997/12/13 20:06:14 deraadt Exp $
d44 1
a44 1
USAGE="Usage: $0 [--tmpdir=dir] [--fcodes=dbfile] [--searchpaths='dir1 dir2...'] [--prunepaths='dir1 dir2...'] [--filesystems='type1 type2...']"
@


1.10
log
@permit TMPDIR override; sef
@
text
@d3 1
a3 1
#	$OpenBSD: updatedb.sh,v 1.9 1997/04/03 00:57:49 michaels Exp $
d31 1
a31 1
# $Id: updatedb.sh,v 1.9 1997/04/03 00:57:49 michaels Exp $
d98 1
a98 1
		
@


1.9
log
@per wishes of deraadt add ufs to default fs's to search.
@
text
@d3 1
a3 1
#	$OpenBSD: updatedb.sh,v 1.8 1997/04/02 08:35:01 deraadt Exp $
d31 1
a31 1
# $Id: updatedb.sh,v 1.8 1997/04/02 08:35:01 deraadt Exp $
d40 1
a40 1
: ${TMPDIR=/tmp}; export TMPDIR
@


1.8
log
@use 10 X for mktemp(1)
@
text
@d3 1
a3 1
#	$OpenBSD: updatedb.sh,v 1.7 1997/01/04 01:36:01 millert Exp $
d31 1
a31 1
# $Id: updatedb.sh,v 1.7 1997/01/04 01:36:01 millert Exp $
d50 1
a50 1
: ${FILESYSTEMS="ffs"}			 # allowed filesystems 
@


1.7
log
@Command line args to updatedb.  Also, a filename of "-" for the db
means output to stdout.
@
text
@d3 1
a3 1
#	$OpenBSD: updatedb.sh,v 1.6 1997/01/03 23:33:49 millert Exp $
d31 1
a31 1
# $Id: updatedb.sh,v 1.6 1997/01/03 23:33:49 millert Exp $
d48 1
a48 1
: ${SEARCHPATHS="/"}		# directories to be put in the database
d96 1
a96 1
tmp=`mktemp ${TMPDIR=/tmp}/_updatedb.XXXXXX` || exit 1
@


1.6
log
@locate shell scripts now use mktemp(1) and weekly runs updatedb
as bin not nobody to avoid NFS problems.
@
text
@d3 1
a3 1
#	$OpenBSD: updatedb.sh,v 1.5 1996/11/30 18:12:51 millert Exp $
d31 1
a31 1
# $Id: updatedb.sh,v 1.5 1996/11/30 18:12:51 millert Exp $
d44 1
d53 21
d105 5
a109 1
		X) cat $tmp > $FCODES;;
@


1.5
log
@filesystem is named "ffs" not "ufs".
@
text
@d3 1
a3 1
#	$OpenBSD: updatedb.sh,v 1.4 1996/10/20 00:52:58 michaels Exp $
d31 1
a31 1
# $Id: updatedb.sh,v 1.4 1996/10/20 00:52:58 michaels Exp $
d74 2
a75 10
um=`umask`
umask 022
DTMP=${TMPDIR=/tmp}/_updatedb$$
tmp=$DTMP/updatedb
if ! mkdir $DTMP ; then
	echo failed to create tmp dir $DTMP
	exit 1
fi
umask $um
trap 'rm -rf $DTMP' 0 1 2 3 5 10 15
a84 1
		   rm -rf $DTMP
a87 1
rm -rf $DTMP
@


1.4
log
@8-Bit character support.  From wosch@@freebsd.
@
text
@d3 1
a3 1
#	$OpenBSD: updatedb.sh,v 1.2 1996/09/15 16:50:41 michaels Exp $
d31 1
a31 1
# $Id: updatedb.sh,v 1.3 1996/09/15 23:38:39 deraadt Exp $
d49 1
a49 1
: ${FILESYSTEMS="ufs"}			 # allowed filesystems 
@


1.3
log
@kill the race; noticed by bitblt
@
text
@d31 1
a31 1
# $Id: updatedb.sh,v 1.2 1996/09/15 16:50:41 michaels Exp $
d40 1
@


1.2
log
@Blind update of wosch@@FreeBSD's code:

optimized search algorithm
faster IO due mmap(2) [-m | -s]
better error check for damaged databases
support for databases in network byte order (SunOS/sparc)
optional case insensitve search [-i]
optional multiple databases
optional multiple pattern
new enviroment variable LOCATE_PATH for database(s)
[-S] print some statistic about the database
[-l number] limit output to number file names
[-c] suppress normal output; instead print a count of matching file names
fix prototypes/forward declarations/return type
@
text
@d3 1
a3 1
#	$OpenBSD$
d31 1
a31 1
# $Id: updatedb.sh,v 1.4 1996/08/27 20:04:28 wosch Exp $
d73 10
a82 2
tmp=${TMPDIR=/tmp}/_updatedb$$
trap 'rm -f $tmp' 0 1 2 3 5 10 15
d92 1
d96 1
@


1.1
log
@argv.
@
text
@d3 1
a3 1
# $OpenBSD$
d5 23
a27 1
# (c) Wolfram Schneider, Berlin. September 1995. Public domain.
d31 1
a31 1
# $Id: updatedb.sh,v 1.3 1996/08/14 00:22:31 wosch Exp $
@
