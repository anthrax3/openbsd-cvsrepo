head	1.6;
access;
symbols
	OPENBSD_6_1_BASE:1.6
	OPENBSD_6_0:1.6.0.10
	OPENBSD_6_0_BASE:1.6
	OPENBSD_5_9:1.6.0.6
	OPENBSD_5_9_BASE:1.6
	OPENBSD_5_8:1.6.0.8
	OPENBSD_5_8_BASE:1.6
	OPENBSD_5_7:1.6.0.2
	OPENBSD_5_7_BASE:1.6
	OPENBSD_5_6:1.6.0.4
	OPENBSD_5_6_BASE:1.6
	OPENBSD_5_5:1.5.0.10
	OPENBSD_5_5_BASE:1.5
	OPENBSD_5_4:1.5.0.6
	OPENBSD_5_4_BASE:1.5
	OPENBSD_5_3:1.5.0.4
	OPENBSD_5_3_BASE:1.5
	OPENBSD_5_2:1.5.0.2
	OPENBSD_5_2_BASE:1.5;
locks; strict;
comment	@# @;


1.6
date	2014.04.16.10.31.27;	author zhuk;	state Exp;
branches;
next	1.5;

1.5
date	2012.07.10.12.24.45;	author espie;	state Exp;
branches;
next	1.4;

1.4
date	2012.07.10.11.39.11;	author espie;	state Exp;
branches;
next	1.3;

1.3
date	2012.07.08.10.42.25;	author espie;	state Exp;
branches;
next	1.2;

1.2
date	2012.07.06.11.30.41;	author espie;	state Exp;
branches;
next	1.1;

1.1
date	2012.06.19.09.30.44;	author espie;	state Exp;
branches;
next	;


desc
@@


1.6
log
@Make directory ordering in our libtool stable. Fixes quiet a few issues
ajacoutot@@, me and probably others were seeing. No fallout in bulk build.

Input from espie@@ and ajacoutot@@.
Prodding by ajacoutot@@
Bulk test by jasper@@
@
text
@# $OpenBSD: Util.pm,v 1.5 2012/07/10 12:24:45 espie Exp $

# Copyright (c) 2007-2010 Steven Mestdagh <steven@@openbsd.org>
# Copyright (c) 2012 Marc Espie <espie@@openbsd.org>
#
# Permission to use, copy, modify, and distribute this software for any
# purpose with or without fee is hereby granted, provided that the above
# copyright notice and this permission notice appear in all copies.
#
# THE SOFTWARE IS PROVIDED "AS IS" AND THE AUTHOR DISCLAIMS ALL WARRANTIES
# WITH REGARD TO THIS SOFTWARE INCLUDING ALL IMPLIED WARRANTIES OF
# MERCHANTABILITY AND FITNESS. IN NO EVENT SHALL THE AUTHOR BE LIABLE FOR
# ANY SPECIAL, DIRECT, INDIRECT, OR CONSEQUENTIAL DAMAGES OR ANY DAMAGES
# WHATSOEVER RESULTING FROM LOSS OF USE, DATA OR PROFITS, WHETHER IN AN
# ACTION OF CONTRACT, NEGLIGENCE OR OTHER TORTIOUS ACTION, ARISING OUT OF
# OR IN CONNECTION WITH THE USE OR PERFORMANCE OF THIS SOFTWARE.

use strict;
use warnings;
package LT::Util;
require Exporter;
our @@ISA = qw(Exporter);
our @@EXPORT = qw(abs_dir $ltdir $version shortdie);
use File::Basename;
use Cwd;

our $ltdir = '.libs';
our $version = '1.5.26'; # pretend to be this version of libtool

sub abs_dir
{
	my $a = shift;
	return dirname(Cwd::abs_path($a));
}

sub shortdie
{
	$SIG{__DIE__} = 'DEFAULT';
	die @@_;
}

1;
@


1.5
log
@clean-up shit, pull some of LT::Util into ltconfig object
make that a somewhat more "real" object...
@
text
@d1 1
a1 1
# $OpenBSD: Util.pm,v 1.4 2012/07/10 11:39:11 espie Exp $
d23 1
a23 1
our @@EXPORT = qw(reverse_zap_duplicates_ref abs_dir $ltdir $version shortdie);
a28 15

# walk a list from back to front, removing any duplicates
# this should make sure a library's dependencies are behind the library itself
sub reverse_zap_duplicates_ref
{
	my $arglist = shift;
	my $h = {};
	my $r = [];
	for my $el (reverse @@$arglist) {
		next if defined $h->{$el};
		unshift @@$r, $el;
		$h->{$el} = 1;
	}
	return $r;
}
@


1.4
log
@nit
@
text
@d1 1
a1 1
# $OpenBSD: Util.pm,v 1.3 2012/07/08 10:42:25 espie Exp $
d23 1
a23 2
our @@EXPORT = qw(reverse_zap_duplicates_ref abs_dir $ltdir $version
    @@picflags $sharedflag shortdie);
a28 2
our @@picflags = ('-fPIC', '-DPIC');
our $sharedflag = '-shared';
@


1.3
log
@a few big changes
- start using our options parser for main libtool options
- put link related stuff into their own module.
Long term, some unification should happen.
- shortdie for cases where we  know libtool is not at fault.
@
text
@d1 1
a1 1
# $OpenBSD: Util.pm,v 1.2 2012/07/06 11:30:41 espie Exp $
d56 1
a56 1
	delete $SIG{__DIE__};
@


1.2
log
@add my copyright, since I'm going to do yet MORE changes...
@
text
@d1 1
a1 1
# $OpenBSD: Util.pm,v 1.1 2012/06/19 09:30:44 espie Exp $
d24 1
a24 1
    @@picflags $sharedflag);
d52 6
@


1.1
log
@add libtool to base, okay deraadt@@, jasper@@, millert@@...
(as requested by matthieu@@ so we can work on xenocara).
@
text
@d1 1
a1 1
# $OpenBSD$
d4 1
@

