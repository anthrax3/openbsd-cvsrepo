head	1.20;
access;
symbols
	OPENBSD_6_1_BASE:1.20
	OPENBSD_6_0:1.20.0.8
	OPENBSD_6_0_BASE:1.20
	OPENBSD_5_9:1.20.0.4
	OPENBSD_5_9_BASE:1.20
	OPENBSD_5_8:1.20.0.6
	OPENBSD_5_8_BASE:1.20
	OPENBSD_5_7:1.20.0.2
	OPENBSD_5_7_BASE:1.20
	OPENBSD_5_6:1.19.0.10
	OPENBSD_5_6_BASE:1.19
	OPENBSD_5_5:1.19.0.8
	OPENBSD_5_5_BASE:1.19
	OPENBSD_5_4:1.19.0.4
	OPENBSD_5_4_BASE:1.19
	OPENBSD_5_3:1.19.0.2
	OPENBSD_5_3_BASE:1.19
	OPENBSD_5_2:1.18.0.10
	OPENBSD_5_2_BASE:1.18
	OPENBSD_5_1_BASE:1.18
	OPENBSD_5_1:1.18.0.8
	OPENBSD_5_0:1.18.0.6
	OPENBSD_5_0_BASE:1.18
	OPENBSD_4_9:1.18.0.4
	OPENBSD_4_9_BASE:1.18
	OPENBSD_4_8:1.18.0.2
	OPENBSD_4_8_BASE:1.18
	OPENBSD_4_7:1.16.0.8
	OPENBSD_4_7_BASE:1.16
	OPENBSD_4_6:1.16.0.10
	OPENBSD_4_6_BASE:1.16
	OPENBSD_4_5:1.16.0.6
	OPENBSD_4_5_BASE:1.16
	OPENBSD_4_4:1.16.0.4
	OPENBSD_4_4_BASE:1.16
	OPENBSD_4_3:1.16.0.2
	OPENBSD_4_3_BASE:1.16
	OPENBSD_4_2:1.14.0.18
	OPENBSD_4_2_BASE:1.14
	OPENBSD_4_1:1.14.0.16
	OPENBSD_4_1_BASE:1.14
	OPENBSD_4_0:1.14.0.14
	OPENBSD_4_0_BASE:1.14
	OPENBSD_3_9:1.14.0.12
	OPENBSD_3_9_BASE:1.14
	OPENBSD_3_8:1.14.0.10
	OPENBSD_3_8_BASE:1.14
	OPENBSD_3_7:1.14.0.8
	OPENBSD_3_7_BASE:1.14
	OPENBSD_3_6:1.14.0.6
	OPENBSD_3_6_BASE:1.14
	OPENBSD_3_5:1.14.0.4
	OPENBSD_3_5_BASE:1.14
	OPENBSD_3_4:1.14.0.2
	OPENBSD_3_4_BASE:1.14
	OPENBSD_3_3:1.13.0.6
	OPENBSD_3_3_BASE:1.13
	OPENBSD_3_2:1.13.0.4
	OPENBSD_3_2_BASE:1.13
	OPENBSD_3_1:1.13.0.2
	OPENBSD_3_1_BASE:1.13
	OPENBSD_3_0:1.12.0.2
	OPENBSD_3_0_BASE:1.12
	OPENBSD_2_9_BASE:1.9
	OPENBSD_2_9:1.9.0.10
	OPENBSD_2_8:1.9.0.8
	OPENBSD_2_8_BASE:1.9
	OPENBSD_2_7:1.9.0.6
	OPENBSD_2_7_BASE:1.9
	OPENBSD_2_6:1.9.0.4
	OPENBSD_2_6_BASE:1.9
	OPENBSD_2_5:1.9.0.2
	OPENBSD_2_5_BASE:1.9
	OPENBSD_2_4:1.8.0.8
	OPENBSD_2_4_BASE:1.8
	OPENBSD_2_3:1.8.0.6
	OPENBSD_2_3_BASE:1.8
	OPENBSD_2_2:1.8.0.4
	OPENBSD_2_2_BASE:1.8
	OPENBSD_2_1:1.8.0.2
	OPENBSD_2_1_BASE:1.8
	OPENBSD_2_0:1.6.0.2
	OPENBSD_2_0_BASE:1.6
	netbsd_1_1:1.1.1.1;
locks; strict;
comment	@ * @;


1.20
date	2014.10.18.07.50.06;	author espie;	state Exp;
branches;
next	1.19;
commitid	nCTR0oP8E86MqGpq;

1.19
date	2012.12.07.07.08.16;	author espie;	state Exp;
branches;
next	1.18;

1.18
date	2010.07.19.19.46.44;	author espie;	state Exp;
branches;
next	1.17;

1.17
date	2010.07.19.19.30.37;	author espie;	state Exp;
branches;
next	1.16;

1.16
date	2007.09.16.09.49.24;	author espie;	state Exp;
branches;
next	1.15;

1.15
date	2007.09.16.09.46.14;	author espie;	state Exp;
branches;
next	1.14;

1.14
date	2003.06.03.02.56.11;	author millert;	state Exp;
branches;
next	1.13;

1.13
date	2002.01.30.18.40.26;	author matthieu;	state Exp;
branches;
next	1.12;

1.12
date	2001.06.05.11.59.11;	author espie;	state Exp;
branches;
next	1.11;

1.11
date	2001.05.23.12.34.41;	author espie;	state Exp;
branches;
next	1.10;

1.10
date	2001.05.03.13.41.03;	author espie;	state Exp;
branches;
next	1.9;

1.9
date	98.12.05.00.06.27;	author espie;	state Exp;
branches;
next	1.8;

1.8
date	96.12.22.20.15.35;	author rahnds;	state Exp;
branches;
next	1.7;

1.7
date	96.11.30.21.08.53;	author millert;	state Exp;
branches;
next	1.6;

1.6
date	96.09.21.19.36.27;	author niklas;	state Exp;
branches;
next	1.5;

1.5
date	96.09.02.16.04.07;	author briggs;	state Exp;
branches;
next	1.4;

1.4
date	96.07.31.00.01.03;	author niklas;	state Exp;
branches;
next	1.3;

1.3
date	96.06.26.05.36.28;	author deraadt;	state Exp;
branches;
next	1.2;

1.2
date	96.02.22.22.24.45;	author niklas;	state Exp;
branches;
next	1.1;

1.1
date	95.10.18.08.45.41;	author deraadt;	state Exp;
branches
	1.1.1.1;
next	;

1.1.1.1
date	95.10.18.08.45.41;	author deraadt;	state Exp;
branches;
next	;


desc
@@


1.20
log
@enable the sinclude/-include feature support I wrote long ago.
Other systems now have it, xenocara is using it.
talked over with kettenis@@ who checked release still works.
I did a full bulk build with this and did not notice any issue.
@
text
@#ifndef CONFIG_H
#define CONFIG_H

/*	$OpenBSD: config.h,v 1.19 2012/12/07 07:08:16 espie Exp $	*/
/*	$NetBSD: config.h,v 1.7 1996/11/06 17:59:03 christos Exp $	*/

/*
 * Copyright (c) 1988, 1989, 1990 The Regents of the University of California.
 * Copyright (c) 1988, 1989 by Adam de Boor
 * Copyright (c) 1989 by Berkeley Softworks
 * All rights reserved.
 *
 * This code is derived from software contributed to Berkeley by
 * Adam de Boor.
 *
 * Redistribution and use in source and binary forms, with or without
 * modification, are permitted provided that the following conditions
 * are met:
 * 1. Redistributions of source code must retain the above copyright
 *    notice, this list of conditions and the following disclaimer.
 * 2. Redistributions in binary form must reproduce the above copyright
 *    notice, this list of conditions and the following disclaimer in the
 *    documentation and/or other materials provided with the distribution.
 * 3. Neither the name of the University nor the names of its contributors
 *    may be used to endorse or promote products derived from this software
 *    without specific prior written permission.
 *
 * THIS SOFTWARE IS PROVIDED BY THE REGENTS AND CONTRIBUTORS ``AS IS'' AND
 * ANY EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT LIMITED TO, THE
 * IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE
 * ARE DISCLAIMED.  IN NO EVENT SHALL THE REGENTS OR CONTRIBUTORS BE LIABLE
 * FOR ANY DIRECT, INDIRECT, INCIDENTAL, SPECIAL, EXEMPLARY, OR CONSEQUENTIAL
 * DAMAGES (INCLUDING, BUT NOT LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS
 * OR SERVICES; LOSS OF USE, DATA, OR PROFITS; OR BUSINESS INTERRUPTION)
 * HOWEVER CAUSED AND ON ANY THEORY OF LIABILITY, WHETHER IN CONTRACT, STRICT
 * LIABILITY, OR TORT (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY
 * OUT OF THE USE OF THIS SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF
 * SUCH DAMAGE.
 *
 *	from: @@(#)config.h	8.1 (Berkeley) 6/6/93
 */

#define DEFSHELL	1			/* Bourne shell */

/*
 * DEFMAXJOBS
 * DEFMAXLOCAL
 *	These control the default concurrency. On no occasion will more
 *	than DEFMAXJOBS targets be created at once (locally or remotely)
 *	DEFMAXLOCAL is the highest number of targets which will be
 *	created on the local machine at once. Note that if you set this
 *	to 0, nothing will ever happen...
 */
#define DEFMAXJOBS	4
#define DEFMAXLOCAL	1

/*
 * SYSVINCLUDE
 *	Recognize system V like include directives [include "filename"]
 * SYSVVARSUB
 *	Recognize system V like ${VAR:x=y} variable substitutions
 */
#define SYSVINCLUDE
#define SYSVVARSUB

/*
 * SUNSHCMD
 *	Recognize SunOS and Solaris:
 *		VAR :sh= CMD	# Assign VAR to the command substitution of CMD
 *		${VAR:sh}	# Return the command substitution of the value
 *				# of ${VAR}
 */
#define SUNSHCMD

#if !defined(__svr4__) && !defined(__SVR4) && !defined(__ELF__)
# ifndef RANLIBMAG
#  define RANLIBMAG "__.SYMDEF"
# endif
#endif

#ifdef HAS_EXTENDED_GETCWD
#define dogetcwd()	getcwd(NULL, 0)
#else
#define dogetcwd()	getcwd(emalloc(PATH_MAX), PATH_MAX)
#endif

#ifdef SYSVINCLUDE
#define DOFEATURE_SYSVINCLUDE	FEATURE_SYSVINCLUDE
#else
#define DOFEATURE_SYSVINCLUDE	0
#endif
#ifdef SYSVVARSUB
#define DOFEATURE_SYSVVARSUB	FEATURE_SYSVVARSUB
#else
#define DOFEATURE_SYSVVARSUB	0
#endif
#ifdef SUNSHCMD
#define DOFEATURE_SUNSHCMD	FEATURE_SUNSHCMD
#else
#define DOFEATURE_SUNSHCMD	0
#endif

#ifndef DEFAULT_FEATURES
#define DEFAULT_FEATURES	(FEATURE_UPPERLOWER | DOFEATURE_SYSVVARSUB | DOFEATURE_SYSVINCLUDE | DOFEATURE_SUNSHCMD | FEATURE_RECVARS | FEATURE_CONDINCLUDE)
#endif

#define FEATURES(x)	((DEFAULT_FEATURES & (x)) != 0)
#define FEATURE_ODE		1
#define FEATURE_UNIQ		2
#define FEATURE_SORT		4
#define FEATURE_UPPERLOWER	8
#define FEATURE_SYSVVARSUB	16
#define FEATURE_SYSVINCLUDE	32
#define FEATURE_SUNSHCMD	64
#define FEATURE_RECVARS		128
#define FEATURE_CONDINCLUDE	256
#define FEATURE_ASSIGN		512
#define FEATURE_EXECMOD		1024

/*
 * There are several places where expandable buffers are used (parse.c and
 * var.c). This constant is merely the starting point for those buffers. If
 * lines tend to be much shorter than this, it would be best to reduce BSIZE.
 * If longer, it should be increased. Reducing it will cause more copying to
 * be done for longer lines, but will save space for shorter ones. In any
 * case, it ought to be a power of two simply because most storage allocation
 * schemes allocate in powers of two.
 */
#define MAKE_BSIZE		256	/* starting size for expandable buffers */

#endif
@


1.19
log
@gc old define
@
text
@d4 1
a4 1
/*	$OpenBSD: config.h,v 1.18 2010/07/19 19:46:44 espie Exp $	*/
d104 1
a104 1
#define DEFAULT_FEATURES	(FEATURE_UPPERLOWER | DOFEATURE_SYSVVARSUB | DOFEATURE_SYSVINCLUDE | DOFEATURE_SUNSHCMD | FEATURE_RECVARS)
@


1.18
log
@Correct $OpenBSD$ stuff
@
text
@d4 1
a4 1
/*	$OpenBSD: config.h,v 1.17 2010/07/19 19:30:37 espie Exp $	*/
a55 7

/*
 * LIBSUFF
 *	Is the suffix used to denote libraries and is used by the Suff module
 *	to find the search path on which to seek any -l<xx> targets.
 */
#define LIBSUFF ".a"
@


1.17
log
@two small changes:
- allow variables in SysV modifiers, as requested by matthieu@@
(since recursive variables are an extension, this just extends the
extension)
- variation on :Q  called :QL (quote list), which does quote every character
EXCEPT for whitespace. e.g.,

toto:
	@@for i in ${VAR:QL} ...
@
text
@d4 1
a4 2
/*	$OpenPackages$ */
/*	$OpenBSD$	*/
@


1.16
log
@more dead code: we always define LIBRARIES and INCLUDES
@
text
@d5 1
a5 1
/*	$OpenBSD: config.h,v 1.15 2007/09/16 09:46:14 espie Exp $	*/
@


1.15
log
@remove dead code: #define RECHECK is always on
@
text
@d5 1
a5 1
/*	$OpenBSD: config.h,v 1.14 2003/06/03 02:56:11 millert Exp $	*/
a56 12

/*
 * INCLUDES
 * LIBRARIES
 *	These control the handling of the .INCLUDES and .LIBS variables.
 *	If INCLUDES is defined, the .INCLUDES variable will be filled
 *	from the search paths of those suffixes which are marked by
 *	.INCLUDES dependency lines. Similarly for LIBRARIES and .LIBS
 *	See suff.c for more details.
 */
#define INCLUDES
#define LIBRARIES
@


1.14
log
@Remove the advertising clause in the UCB license which Berkeley
rescinded 22 July 1999.  Proofed by myself and Theo.
@
text
@d5 1
a5 1
/*	$OpenBSD: config.h,v 1.13 2002/01/30 18:40:26 matthieu Exp $	*/
a73 10
 *
 * RECHECK
 *	If defined, Make_Update will check a target for its current
 *	modification time after it has been re-made, setting it to the
 *	starting time of the make only if the target still doesn't exist.
 *	Unfortunately, under NFS the modification time often doesn't
 *	get updated in time, so a target will appear to not have been
 *	re-made, causing later targets to appear up-to-date. On systems
 *	that don't have this problem, you should defined this. Under
 *	NFS you probably should not, unless you aren't exporting jobs.
a75 1
#define RECHECK
@


1.13
log
@use defined(__ELF__) instead of a list of ELF architectures from which
sparc64 was missing.
This fixes a bug with ELF static libraries on sparc64
@
text
@d5 1
a5 1
/*	$OpenBSD: config.h,v 1.12 2001/06/05 11:59:11 espie Exp $	*/
d25 1
a25 5
 * 3. All advertising materials mentioning features or use of this software
 *    must display the following acknowledgement:
 *	This product includes software developed by the University of
 *	California, Berkeley and its contributors.
 * 4. Neither the name of the University nor the names of its contributors
@


1.12
log
@Use Str_concat instead of fixed buffers and snprintf in building paths.
Replace MAXPATHLEN with PATH_MAX (synch with op-make).
ok naddy@@
@
text
@d5 1
a5 1
/*	$OpenBSD: config.h,v 1.11 2001/05/23 12:34:41 espie Exp $	*/
d110 1
a110 2
#if !defined(__svr4__) && !defined(__SVR4) && !defined(__alpha__) && \
    !defined(__mips__) && !defined(__powerpc__)
@


1.11
log
@Mostly clean-up:
- cut up those huge include files into separate interfaces for all modules.
Put the interface documentation there, and not with the implementation.
- light-weight includes for needed concrete types (lst_t.h, timestamp_t.h).
- cut out some more logically separate parts: cmd_exec, varname, parsevar,
timestamp.
- put all error handling functions together, so that we will be able to
clean them up.
- more systematic naming: functioni  to handle interval, function to handle
string.
- put the init/end code apart to minimize coupling.
- kill weird types like ReturnStatus and Boolean. Use standard bool (with a
fallback for non-iso systems)
- better interface documentation for lots of subsystems.

As a result, make compilation goes somewhat faster (5%, even considering
the largish BSD copyrights to read). The corresponding preprocessed
source goes down from 1,5M to 1M.

A few minor code changes as well: Parse_DoVar is no longer destructive.
Parse_IsVar functionality is folded into Parse_DoVar (as it knows what an
assignment is), a few more interval handling functions. Avoid calling
XXX_End when they do nothing, just #define XXX_End   to nothing.

Parse_DoVar is slightly more general: it will handle compound assignments
as long as they make sense, e.g., VAR +!= cmd
will work.  As a side effect, VAR++=value now triggers an error
(two + in assignment).
- this stuff doesn't occur in portable Makefiles.
- writing VAR++ = value or VAR+ +=value  disambiguates it.
- this is a good thing, it uncovered a bug in bsd.port.mk.

Tested by naddy@@. Okayed millert@@. I'll handle the fallback if there is
any. This went through a full make build anyways, including isakmpd
(without mickey's custom binutils, as he didn't see fit to share it with me).
@
text
@d5 1
a5 1
/*	$OpenBSD: config.h,v 1.9 1998/12/05 00:06:27 espie Exp $	*/
d115 6
@


1.10
log
@Synch with my current work.
Numerous changes:
- generate can build several tables
- style cleanup
- statistics code
- use variable names throughout (struct Name)
- recursive variables everywhere
- faster parser (pass buffer along instead of allocating multiple copies)
- correct parser. Handles comments everywhere, and ; correctly
- more string intervals
- simplified dir.c, less recursion.
- extended for loops
- sinclude()
- finished removing extra junk from Lst_*
- handles ${@@D} and friends in a simpler way
- cleaned up and modular VarModifiers handling.
- recognizes some gnu Makefile usages and errors out about them.

Additionally, some extra functionality is defined by FEATURES. The set of
functionalities is currently hardcoded to OpenBSD defaults, but this may
include support for some NetBSD extensions, like ODE modifiers.

Backed by miod@@ and millert@@, who finally got sick of my endless patches...
@
text
@d1 3
d149 13
@


1.9
log
@Modifications from netbsd:
- don't interfere with MACHINE/MACHINE_ARCH defines for bootstrap
- type clean-up, time_t, and printing `unknown' ints
- fix TARGET/MEMBER bug in archive rules
- memmove...
- cleaner Error handler.
- reentrant brk_string
- .MAKE env variable
- preliminary scaffolding for .NOPATH

Other improvements:
- efree
- shellneed streamlined
- display Stop in .CURDIR after an error.
- document most features and misfeatures.
- add a few OpenBSD notes to the tutorial.
@
text
@d1 2
a2 1
/*	$OpenBSD: config.h,v 1.7 1996/11/30 21:08:53 millert Exp $	*/
d45 1
a45 1
#define	DEFSHELL	1			/* Bourne shell */
d86 2
a87 11
#define	LIBSUFF	".a"
#define	RECHECK

/*
 * POSIX
 *	Adhere to the POSIX 1003.2 draft for the make(1) program.
 *	- Use MAKEFLAGS instead of MAKE to pick arguments from the
 *	  environment.
 *	- Allow empty command lines if starting with tab.
 */
#define POSIX
d113 33
@


1.8
log
@PowerPC port is ELF based, treat same as svr4, mips, and alpha.
@
text
@@


1.7
log
@Sync with NetBSD:
- Merge in FreeBSD and Lite2 changes.
- Fix bug where a non-archive target with a .a suffix would always
  be considered to be out of date, since it does not have a TOC.
- Fix NetBSD PR #2930: declare missing variable.
@
text
@d1 1
a1 1
/*	$OpenBSD: config.h,v 1.6 1996/09/21 19:36:27 niklas Exp $	*/
d116 1
a116 1
    !defined(__mips__)
@


1.6
log
@Do not look for a.out t.o.c sections in the mips-based ports
@
text
@d1 2
a2 2
/*	$OpenBSD: config.h,v 1.5 1996/09/02 16:04:07 briggs Exp $	*/
/*	$NetBSD: config.h,v 1.6 1996/05/28 23:34:39 christos Exp $	*/
d41 1
a41 1
 *	from: @@(#)config.h	5.9 (Berkeley) 6/1/90
d98 1
a98 1
 * SYSVINCLUDES
d103 1
a103 1
#define SYSVINCLUDES
a120 1
/*#define POSIX*/
@


1.5
log
@Sync up with NetBSD:
(christos)
	Fix bug reported by Greg Hudson where leaf (source only) nodes were
	referenced only by their basename and not by their full pathname. This
	breaks when .PATH or MAKEOBJDIR are used. There might be Makefiles
	around that try to work around this bug by prepending ${.CURDIR} to
	the sources, and they should be found and fixed. Also a lot of the gunk
	in suff.c that was attempting to work around the same problem could be
	removed.
(christos)
	- Move -D flags from Makefile to config.h and explain what they do. Add
	  -Wall -Wno-unused to CFLAGS. Add new define SYSVVARSUB to enable SysV
	  style variable substitutions and enable them.
	- Add SunOS style command substitutions via SUNSHCMD
	- Fix core dump with '{variable = value'
(christos)
	Fix bug where make will always exit with 0, even when one or more
	parallel jobs failed. (Only affects parallel make code)
(christos)
	Protect __P from being multiply defined (for systems that already
	define it)
(christos) Add strdup() since ultrix is missing it.
	From Larry Schwimmer <rosebud@@cyclone.Stanford.EDU>
(christos) Add estrdup(), a checked version of strdup and use it.
(christos) Recognize SVR4 style long filename entries in archives.
(thorpej) Tidy up some RCS ids a bit.
@
text
@d1 1
a1 1
/*	$OpenBSD: config.h,v 1.4 1996/07/31 00:01:03 niklas Exp $	*/
d115 2
a116 1
#if !defined(__svr4__) && !defined(__SVR4) && !defined(__alpha__)
@


1.4
log
@RANLIBMAG should not be set on alphas, as make doesn't know ECOFF archives
@
text
@d1 2
a2 2
/*	$OpenBSD: config.h,v 1.3 1996/06/26 05:36:28 deraadt Exp $	*/
/*	$NetBSD: config.h,v 1.5 1996/02/04 20:34:43 christos Exp $	*/
a83 4
 *
 * POSIX
 *	If the POSIX standard for Make is to be followed. There are
 *	several areas that I dislike, hence this constant.
d87 27
@


1.3
log
@rcsid
@
text
@d1 1
a1 1
/*	$OpenBSD: config.h,v 1.5 1996/02/04 20:34:43 christos Exp $	*/
d92 1
a92 1
#if !defined(__svr4__) && !defined(__SVR4)
@


1.2
log
@From NetBSD:
Support SVR4 style archives.
Fix pr/1421 (from Matthew Green) and pr/1997 (from Jeff Thieleke).
In ParseDoInclude(), make a temporary copy of the current file name
while searching for ""-type include files, since the current file name
might not be a writeable string.
@
text
@d1 1
@


1.1
log
@Initial revision
@
text
@d1 1
a1 1
/*	$NetBSD: config.h,v 1.4 1995/06/14 15:19:03 christos Exp $	*/
d91 4
a94 2
#ifndef RANLIBMAG
#define RANLIBMAG "__.SYMDEF"
@


1.1.1.1
log
@initial import of NetBSD tree
@
text
@@
