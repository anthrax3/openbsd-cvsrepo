head	1.22;
access;
symbols
	OPENBSD_6_0:1.22.0.26
	OPENBSD_6_0_BASE:1.22
	OPENBSD_5_9:1.22.0.22
	OPENBSD_5_9_BASE:1.22
	OPENBSD_5_8:1.22.0.24
	OPENBSD_5_8_BASE:1.22
	OPENBSD_5_7:1.22.0.16
	OPENBSD_5_7_BASE:1.22
	OPENBSD_5_6:1.22.0.20
	OPENBSD_5_6_BASE:1.22
	OPENBSD_5_5:1.22.0.18
	OPENBSD_5_5_BASE:1.22
	OPENBSD_5_4:1.22.0.14
	OPENBSD_5_4_BASE:1.22
	OPENBSD_5_3:1.22.0.12
	OPENBSD_5_3_BASE:1.22
	OPENBSD_5_2:1.22.0.10
	OPENBSD_5_2_BASE:1.22
	OPENBSD_5_1_BASE:1.22
	OPENBSD_5_1:1.22.0.8
	OPENBSD_5_0:1.22.0.6
	OPENBSD_5_0_BASE:1.22
	OPENBSD_4_9:1.22.0.4
	OPENBSD_4_9_BASE:1.22
	OPENBSD_4_8:1.22.0.2
	OPENBSD_4_8_BASE:1.22
	OPENBSD_4_7:1.20.0.2
	OPENBSD_4_7_BASE:1.20
	OPENBSD_4_6:1.20.0.4
	OPENBSD_4_6_BASE:1.20
	OPENBSD_4_5:1.17.0.4
	OPENBSD_4_5_BASE:1.17
	OPENBSD_4_4:1.17.0.2
	OPENBSD_4_4_BASE:1.17
	OPENBSD_4_3:1.16.0.2
	OPENBSD_4_3_BASE:1.16
	OPENBSD_4_2:1.14.0.4
	OPENBSD_4_2_BASE:1.14
	OPENBSD_4_1:1.14.0.2
	OPENBSD_4_1_BASE:1.14
	OPENBSD_4_0:1.13.0.2
	OPENBSD_4_0_BASE:1.13
	OPENBSD_3_9:1.7.0.2
	OPENBSD_3_9_BASE:1.7;
locks; strict;
comment	@ * @;


1.22
date	2010.07.28.21.19.30;	author nicm;	state Exp;
branches;
next	1.21;

1.21
date	2010.07.23.21.46.05;	author ray;	state Exp;
branches;
next	1.20;

1.20
date	2009.06.07.08.39.13;	author ray;	state Exp;
branches;
next	1.19;

1.19
date	2009.06.06.14.17.27;	author ray;	state Exp;
branches;
next	1.18;

1.18
date	2009.04.28.09.05.40;	author sthen;	state Exp;
branches;
next	1.17;

1.17
date	2008.03.08.20.26.34;	author joris;	state Exp;
branches;
next	1.16;

1.16
date	2008.02.27.22.34.04;	author joris;	state Exp;
branches;
next	1.15;

1.15
date	2008.02.03.18.18.44;	author tobias;	state Exp;
branches;
next	1.14;

1.14
date	2007.01.28.02.04.45;	author joris;	state Exp;
branches;
next	1.13;

1.13
date	2006.06.14.14.10.50;	author joris;	state Exp;
branches;
next	1.12;

1.12
date	2006.05.31.22.24.12;	author joris;	state Exp;
branches;
next	1.11;

1.11
date	2006.05.27.03.30.30;	author joris;	state Exp;
branches;
next	1.10;

1.10
date	2006.04.14.23.29.01;	author joris;	state Exp;
branches;
next	1.9;

1.9
date	2006.04.10.09.57.32;	author xsa;	state Exp;
branches;
next	1.8;

1.8
date	2006.03.14.15.59.06;	author xsa;	state Exp;
branches;
next	1.7;

1.7
date	2005.11.21.15.01.10;	author xsa;	state Exp;
branches;
next	1.6;

1.6
date	2005.10.26.18.13.58;	author xsa;	state Exp;
branches;
next	1.5;

1.5
date	2005.10.22.19.05.25;	author joris;	state Exp;
branches;
next	1.4;

1.4
date	2005.10.22.17.32.57;	author joris;	state Exp;
branches;
next	1.3;

1.3
date	2005.10.11.14.27.27;	author joris;	state Exp;
branches;
next	1.2;

1.2
date	2005.10.07.23.59.56;	author niallo;	state Exp;
branches;
next	1.1;

1.1
date	2005.10.05.23.11.07;	author niallo;	state Exp;
branches;
next	;


desc
@@


1.22
log
@Support -U and -C to specify the context length for "cvs diff".

This doesn't alter cvs rdiff, where -U and -C are not support by GNU
cvs.

ok sthen zinovik
@
text
@/*	$OpenBSD: diff.h,v 1.21 2010/07/23 21:46:05 ray Exp $	*/
/*
 * Copyright (C) Caldera International Inc.  2001-2002.
 * All rights reserved.
 *
 * Redistribution and use in source and binary forms, with or without
 * modification, are permitted provided that the following conditions
 * are met:
 * 1. Redistributions of source code and documentation must retain the above
 *    copyright notice, this list of conditions and the following disclaimer.
 * 2. Redistributions in binary form must reproduce the above copyright
 *    notice, this list of conditions and the following disclaimer in the
 *    documentation and/or other materials provided with the distribution.
 * 3. All advertising materials mentioning features or use of this software
 *    must display the following acknowledgement:
 *	This product includes software developed or owned by Caldera
 *	International, Inc.
 * 4. Neither the name of Caldera International, Inc. nor the names of other
 *    contributors may be used to endorse or promote products derived from
 *    this software without specific prior written permission.
 *
 * USE OF THE SOFTWARE PROVIDED FOR UNDER THIS LICENSE BY CALDERA
 * INTERNATIONAL, INC. AND CONTRIBUTORS ``AS IS'' AND ANY EXPRESS OR
 * IMPLIED WARRANTIES, INCLUDING, BUT NOT LIMITED TO, THE IMPLIED WARRANTIES
 * OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE ARE DISCLAIMED.
 * IN NO EVENT SHALL CALDERA INTERNATIONAL, INC. BE LIABLE FOR ANY DIRECT,
 * INDIRECT INCIDENTAL, SPECIAL, EXEMPLARY, OR CONSEQUENTIAL DAMAGES
 * (INCLUDING, BUT NOT LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR
 * SERVICES; LOSS OF USE, DATA, OR PROFITS; OR BUSINESS INTERRUPTION)
 * HOWEVER CAUSED AND ON ANY THEORY OF LIABILITY, WHETHER IN CONTRACT,
 * STRICT LIABILITY, OR TORT (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING
 * IN ANY WAY OUT OF THE USE OF THIS SOFTWARE, EVEN IF ADVISED OF THE
 * POSSIBILITY OF SUCH DAMAGE.
 */
/*-
 * Copyright (c) 1991, 1993
 *	The Regents of the University of California.  All rights reserved.
 * Copyright (c) 2004 Jean-Francois Brousseau.  All rights reserved.
 *
 * Redistribution and use in source and binary forms, with or without
 * modification, are permitted provided that the following conditions
 * are met:
 * 1. Redistributions of source code must retain the above copyright
 *    notice, this list of conditions and the following disclaimer.
 * 2. Redistributions in binary form must reproduce the above copyright
 *    notice, this list of conditions and the following disclaimer in the
 *    documentation and/or other materials provided with the distribution.
 * 3. Neither the name of the University nor the names of its contributors
 *    may be used to endorse or promote products derived from this software
 *    without specific prior written permission.
 *
 * THIS SOFTWARE IS PROVIDED BY THE REGENTS AND CONTRIBUTORS ``AS IS'' AND
 * ANY EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT LIMITED TO, THE
 * IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE
 * ARE DISCLAIMED.  IN NO EVENT SHALL THE REGENTS OR CONTRIBUTORS BE LIABLE
 * FOR ANY DIRECT, INDIRECT, INCIDENTAL, SPECIAL, EXEMPLARY, OR CONSEQUENTIAL
 * DAMAGES (INCLUDING, BUT NOT LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS
 * OR SERVICES; LOSS OF USE, DATA, OR PROFITS; OR BUSINESS INTERRUPTION)
 * HOWEVER CAUSED AND ON ANY THEORY OF LIABILITY, WHETHER IN CONTRACT, STRICT
 * LIABILITY, OR TORT (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY
 * OUT OF THE USE OF THIS SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF
 * SUCH DAMAGE.
 *
 *	@@(#)diffreg.c   8.1 (Berkeley) 6/6/93
 */
#ifndef DIFF_H
#define DIFF_H
#define CVS_DIFF_DEFCTX	3	/* default context length */

/*
 * Output format options
 */
#define	D_NORMAL	0	/* Normal output */
#define	D_CONTEXT	1	/* Diff with context */
#define	D_UNIFIED	2	/* Unified context diff */
#define	D_IFDEF		3	/* Diff with merged #ifdef's */
#define	D_BRIEF		4	/* Say if the files differ */
#define	D_RCSDIFF	5       /* Reverse editor output: RCS format */

/*
 * Command line flags
 */
#define	D_FORCEASCII	0x01	/* Treat file as ascii regardless of content */
#define	D_FOLDBLANKS	0x02	/* Treat all white space as equal */
#define	D_MINIMAL	0x04	/* Make diff as small as possible */
#define	D_IGNORECASE	0x08	/* Case-insensitive matching */
#define	D_PROTOTYPE	0x10	/* Display C function prototype */
#define	D_EXPANDTABS	0x20	/* Expand tabs to spaces */
#define	D_IGNOREBLANKS	0x40	/* Ignore white space changes */

/*
 * Status values for diffreg() return values
 */
#define	D_SAME		0	/* Files are the same */
#define	D_DIFFER	1	/* Files are different */
#define	D_BINARY	2	/* Binary files are different */
#define	D_COMMON	3	/* Subdirectory common to both dirs */
#define	D_ONLY		4	/* Only exists in one directory */
#define	D_MISMATCH1	5	/* path1 was a dir, path2 a file */
#define	D_MISMATCH2	6	/* path1 was a file, path2 a dir */
#define	D_ERROR		7	/* An error occurred */
#define	D_SKIPPED1	8	/* path1 was a special file */
#define	D_SKIPPED2	9	/* path2 was a special file */

void		cvs_merge_file(struct cvs_file *, int);
void		diff_output(const char *, ...);
int		diffreg(const char *, const char *, int, int, BUF *, int);
int		ed_patch_lines(struct rcs_lines *, struct rcs_lines *);

extern int       diff_format;
extern int	 diff_context;
extern int	 diff3_conflicts;
extern int	 diff_aflag;
extern int	 diff_bflag;
extern int	 diff_dflag;
extern int	 diff_iflag;
extern int	 diff_pflag;
extern int	 diff_wflag;
extern char	*diff_file;
extern char	 diffargs[512]; /* XXX */
extern BUF	*diffbuf;
extern RCSNUM	*diff_rev1;
extern RCSNUM	*diff_rev2;
extern RCSNUM	*d3rev1;
extern RCSNUM	*d3rev2;

#endif	/* DIFF_H */
@


1.21
log
@Reduce variable/function name and whitespace differences between
cvs/rcs.

OK xsa zinovik
@
text
@d1 1
a1 1
/*	$OpenBSD: diff.h,v 1.20 2009/06/07 08:39:13 ray Exp $	*/
d111 1
@


1.20
log
@More cvs/diff/rcs convergence:
1. Mostly variable/function renaming, SIZE_T_MAX->SIZE_MAX, and
spacing.
2. One strchr -> strncspn.
3. diff had a weird thing where it set file[12] = ofile[12] but
never updated file or ofile, then if file and ofile were different
it freed it. I removed it.

OK millert
@
text
@d1 1
a1 1
/*	$OpenBSD: diff.h,v 1.19 2009/06/06 14:17:27 ray Exp $	*/
d66 2
a67 2
#ifndef CVS_DIFF_H
#define CVS_DIFF_H
d83 7
a89 7
#define D_FORCEASCII	0x01	/* Treat file as ascii regardless of content */
#define D_FOLDBLANKS	0x02	/* Treat all white space as equal */
#define D_MINIMAL	0x04	/* Make diff as small as possible */
#define D_IGNORECASE	0x08	/* Case-insensitive matching */
#define D_PROTOTYPE	0x10	/* Display C function prototype */
#define D_EXPANDTABS	0x20	/* Expand tabs to spaces */
#define D_IGNOREBLANKS	0x40	/* Ignore white space changes */
d108 1
a108 1
int		ed_patch_lines(struct cvs_lines *, struct cvs_lines *);
d119 1
a119 1
extern char	 diffargs[128];
d126 1
a126 1
#endif
@


1.19
log
@Sync some rcsdiff changes to cvsdiff.  As a side effect,
cvs diff -t now works.  There should be no functional change
otherwise.

OK millert
@
text
@d1 1
a1 1
/*	$OpenBSD: diff.h,v 1.18 2009/04/28 09:05:40 sthen Exp $	*/
d92 1
a92 1
 * Status values for cvs_diffreg() return values
d107 1
a107 1
int		cvs_diffreg(const char *, const char *, int, int, BUF *, int);
@


1.18
log
@support some additional diff options: -a, -b, -d, -w
ok joris@@
@
text
@d1 1
a1 1
/*	$OpenBSD: diff.h,v 1.17 2008/03/08 20:26:34 joris Exp $	*/
d81 11
d107 1
a107 1
int		cvs_diffreg(const char *, const char *, int, int, BUF *);
@


1.17
log
@add checkout/update -j support.
still has some rough edges.
@
text
@d1 1
a1 1
/*	$OpenBSD: diff.h,v 1.16 2008/02/27 22:34:04 joris Exp $	*/
d101 3
d106 1
@


1.16
log
@prevent file races

ok tobias@@
@
text
@d1 1
a1 1
/*	$OpenBSD: diff.h,v 1.15 2008/02/03 18:18:44 tobias Exp $	*/
d108 2
@


1.15
log
@Added rdiff support.  In order to do this, some output and option fixes
had to be done for diff, too.

OK joris@@
@
text
@d1 1
a1 1
/*	$OpenBSD: diff.h,v 1.14 2007/01/28 02:04:45 joris Exp $	*/
d96 1
a96 1
int		cvs_diffreg(const char *, const char *, BUF *out);
@


1.14
log
@add merging support in both local and remote sides.
tested by many, thanks.
@
text
@d1 1
a1 1
/*	$OpenBSD: diff.h,v 1.13 2006/06/14 14:10:50 joris Exp $	*/
d101 1
@


1.13
log
@add cvs_buf_load_fd() which does the same as cvs_buf_load()
except it takes a decriptor as argument instead of a path.

modified cvs_buf_load() to open the descriptor then pass
it to cvs_buf_load_fd().

change all the calls to cvs_buf_load() that have a descriptor
open for the path to cvs_buf_load_fd() to prevent races.
@
text
@d1 1
a1 1
/*	$OpenBSD: diff.h,v 1.12 2006/05/31 22:24:12 joris Exp $	*/
d94 1
a94 1
BUF		*cvs_diff3(RCSFILE *, char *, int, RCSNUM *, RCSNUM *, int);
@


1.12
log
@support -p flag for diff, makes dlg@@ feel all warm
and fuzzie inside.
@
text
@d1 1
a1 1
/*	$OpenBSD: diff.h,v 1.11 2006/05/27 03:30:30 joris Exp $	*/
d94 1
a94 1
BUF		*cvs_diff3(RCSFILE *, char *, RCSNUM *, RCSNUM *, int);
@


1.11
log
@commit the new opencvs code, i have been hacking on
this for the past 2 weeks now and it should go in at
the start of the hackathon so others can help out.

this code is a lot safer, smarter, faster and best of
all it is actually doing what it is suppose to do!

basic checkout, update, status, diff and commit are
working in local mode only.
there is no support for any remote setups now.
@
text
@d1 1
a1 1
/*	$OpenBSD: diff.h,v 1.10 2006/04/14 23:29:01 joris Exp $	*/
d101 1
@


1.10
log
@- don't append the extension if it's already there (PR 5076).
- show magic branches in rlog (thanks for that nicer hack niall).
- correct output in rcsdiff, so we perfectly match gnu's

all these bugs were found by sturm@@ while he was using cvsweb
(which uses the RCS tools).

"it is in my view that you should put it in" niallo@@
@
text
@d1 1
a1 1
/*	$OpenBSD: diff.h,v 1.9 2006/04/10 09:57:32 xsa Exp $	*/
a69 1

a92 5


#if defined(RCSPROG)
struct cvs_lines;
#endif
@


1.9
log
@sync comments with reality.
@
text
@d1 1
a1 1
/*	$OpenBSD: diff.h,v 1.8 2006/03/14 15:59:06 xsa Exp $	*/
d110 2
@


1.8
log
@add an argument to cvs_diff3() to be able to handle verbosity of
commands; fixes rcsmerge -q  behaviour. OK niallo@@ ray@@.
@
text
@d1 1
a1 1
/*	$OpenBSD: diff.h,v 1.7 2005/11/21 15:01:10 xsa Exp $	*/
d82 1
a82 1
 * Status values for print_status() and diffreg() return values
@


1.7
log
@- print some more informative messages
- minor knf
niallo ok
@
text
@d1 1
a1 1
/*	$OpenBSD: diff.h,v 1.6 2005/10/26 18:13:58 xsa Exp $	*/
d100 1
a100 1
BUF		*cvs_diff3(RCSFILE *, char *, RCSNUM *, RCSNUM *);
@


1.6
log
@diff3_conflicts cleanup; joris ok
@
text
@d1 1
a1 1
/*	$OpenBSD: diff.h,v 1.5 2005/10/22 19:05:25 joris Exp $	*/
d105 2
a106 2
extern int      diff_format;
extern int	diff3_conflicts;
d108 1
@


1.5
log
@fix warning when compiling usr.bin/rcs
@
text
@d1 1
a1 1
/*	$OpenBSD: diff.h,v 1.4 2005/10/22 17:32:57 joris Exp $	*/
d106 1
@


1.4
log
@diff3 support, needed for merging files together;

"go for it" niallo@@
@
text
@d1 1
a1 1
/*	$OpenBSD: diff.h,v 1.3 2005/10/11 14:27:27 joris Exp $	*/
d95 4
@


1.3
log
@export diff_file variable so it can be set from without diff functions;
ok niallo@@
@
text
@d1 1
a1 1
/*	$OpenBSD: diff.h,v 1.2 2005/10/07 23:59:56 niallo Exp $	*/
d96 4
a100 1
int		cvs_diffreg(const char *, const char *, BUF *out);
d103 2
@


1.2
log
@basic `ci' support is here! more coming soon.

combined effort with joris.

ok joris@@
@
text
@d1 1
a1 1
/*	$OpenBSD: diff.h,v 1.1 2005/10/05 23:11:07 niallo Exp $	*/
d99 1
@


1.1
log
@- add a diff.h header file, corresponding to public functions in diff.c
  and some #defines
- include this header in rcs.c
- link rcs against diff.c

this allows us to use the existing diff work from opencvs within functions
in the rcs.c API and thus in rcs programs. paves the way for diff support
in usr.bin/rcs programs.

ok joris@@
@
text
@d1 1
a1 1
/*	$OpenBSD: diff.c,v 1.55 2005/08/14 19:49:18 xsa Exp $	*/
d97 2
a98 1
int		cvs_diffreg(const char *, const char *);
@

