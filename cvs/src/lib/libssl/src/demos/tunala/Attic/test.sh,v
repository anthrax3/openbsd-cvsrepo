head	1.2;
access;
symbols
	butholakala:1.1.1.1
	openssl_1_0_1_g:1.1.1.1
	OPENSSL:1.1.1
	OPENBSD_5_5:1.1.1.1.0.24
	OPENBSD_5_5_BASE:1.1.1.1
	OPENBSD_5_4:1.1.1.1.0.20
	OPENBSD_5_4_BASE:1.1.1.1
	OPENBSD_5_3:1.1.1.1.0.18
	OPENBSD_5_3_BASE:1.1.1.1
	openssl_1_0_1_c:1.1.1.1
	OPENBSD_5_2:1.1.1.1.0.14
	OPENBSD_5_2_BASE:1.1.1.1
	OPENBSD_5_1_BASE:1.1.1.1
	OPENBSD_5_1:1.1.1.1.0.16
	openssl_1_0_0_f:1.1.1.1
	openssl_1_0_0_e:1.1.1.1
	OPENBSD_5_0:1.1.1.1.0.12
	OPENBSD_5_0_BASE:1.1.1.1
	OPENBSD_4_9:1.1.1.1.0.10
	OPENBSD_4_9_BASE:1.1.1.1
	openssh_1_0_0_a:1.1.1.1
	OPENBSD_4_8:1.1.1.1.0.8
	OPENBSD_4_8_BASE:1.1.1.1
	OPENBSD_4_7:1.1.1.1.0.4
	OPENBSD_4_7_BASE:1.1.1.1
	OPENBSD_4_6:1.1.1.1.0.6
	OPENBSD_4_6_BASE:1.1.1.1
	openssl_0_9_8_k:1.1.1.1
	OPENBSD_4_5:1.1.1.1.0.2
	OPENBSD_4_5_BASE:1.1.1.1
	openssl_0_9_8_j:1.1.1.1
	openssl_0_9_8_h:1.1.1.1
	openssl:1.1.1;
locks; strict;
comment	@# @;


1.2
date	2014.04.16.18.35.15;	author tedu;	state dead;
branches;
next	1.1;

1.1
date	2008.09.06.12.15.48;	author djm;	state Exp;
branches
	1.1.1.1;
next	;

1.1.1.1
date	2008.09.06.12.15.48;	author djm;	state Exp;
branches;
next	;


desc
@@


1.2
log
@quoth the readme:
NOTE: Don't expect any of these programs to work with current
OpenSSL releases, or even with later SSLeay releases.
ok miod
@
text
@#!/bin/sh

HTTP="localhost:8080"
CLIENT_PORT="9020"
SERVER_PORT="9021"

sub_test ()
{
	echo "STARTING - $VER $CIPHER"
	./tunala -listen localhost:$CLIENT_PORT -proxy localhost:$SERVER_PORT \
		-cacert CA.pem -cert A-client.pem -server 0 \
		-dh_special standard -v_peer -v_strict \
		$VER -cipher $CIPHER 1> tc1.txt 2> tc2.txt &
	./tunala -listen localhost:$SERVER_PORT -proxy $HTTP \
		-cacert CA.pem -cert A-server.pem -server 1 \
		-dh_special standard -v_peer -v_strict \
		$VER -cipher $CIPHER 1> ts1.txt 2> ts2.txt &
	# Wait for the servers to be listening before starting the wget test
	DONE="no"
	while [ "$DONE" != "yes" ]; do
		L1=`netstat -a | egrep "LISTEN[\t ]*$" | grep ":$CLIENT_PORT"`
		L2=`netstat -a | egrep "LISTEN[\t ]*$" | grep ":$SERVER_PORT"`
		if [ "x$L1" != "x" ]; then
			DONE="yes"
		elif [ "x$L2" != "x" ]; then
			DONE="yes"
		else
			sleep 1
		fi
	done
	HTML=`wget -O - -T 1 http://localhost:$CLIENT_PORT 2> /dev/null | grep "<HTML>"`
	if [ "x$HTML" != "x" ]; then
		echo "OK - $CIPHER ($VER)"
	else
		echo "FAIL - $CIPHER ($VER)"
		killall tunala
		exit 1
	fi
	killall tunala
	# Wait for the servers to stop before returning - otherwise the next
	# test my fail to start ... (fscking race conditions)
	DONE="yes"
	while [ "$DONE" != "no" ]; do
		L1=`netstat -a | egrep "LISTEN[\t ]*$" | grep ":$CLIENT_PORT"`
		L2=`netstat -a | egrep "LISTEN[\t ]*$" | grep ":$SERVER_PORT"`
		if [ "x$L1" != "x" ]; then
			DONE="yes"
		elif [ "x$L2" != "x" ]; then
			DONE="yes"
		else
			DONE="no"
		fi
	done
	exit 0
}

run_test ()
{
	(sub_test 1> /dev/null) || exit 1
}

run_ssl_test ()
{
killall tunala 1> /dev/null 2> /dev/null
echo ""
echo "Starting all $PRETTY tests"
if [ "$PRETTY" != "SSLv2" ]; then
	if [ "$PRETTY" != "SSLv3" ]; then
		export VER="-no_ssl2 -no_ssl3"
		export OSSL="-tls1"
	else
		export VER="-no_ssl2 -no_tls1"
		export OSSL="-ssl3"
	fi
else
	export VER="-no_ssl3 -no_tls1"
	export OSSL="-ssl2"
fi
LIST="`../../apps/openssl ciphers $OSSL | sed -e 's/:/ /g'`"
#echo "$LIST"
for i in $LIST; do \
	DSS=`echo "$i" | grep "DSS"`
	if [ "x$DSS" != "x" ]; then
		echo "---- skipping $i (no DSA cert/keys) ----"
	else
		export CIPHER=$i
		run_test
		echo "SUCCESS: $i"
	fi
done;
}

# Welcome the user
echo "Tests will assume an http server running at $HTTP"

# TLSv1 test
export PRETTY="TLSv1"
run_ssl_test

# SSLv3 test
export PRETTY="SSLv3"
run_ssl_test

# SSLv2 test
export PRETTY="SSLv2"
run_ssl_test

@


1.1
log
@Initial revision
@
text
@@


1.1.1.1
log
@import of OpenSSL 0.9.8h
@
text
@@
