head	1.5;
access;
symbols
	OPENBSD_3_3:1.3.0.26
	OPENBSD_3_3_BASE:1.3
	OPENBSD_3_2:1.3.0.24
	OPENBSD_3_2_BASE:1.3
	OPENBSD_3_1:1.3.0.22
	OPENBSD_3_1_BASE:1.3
	OPENBSD_3_0:1.3.0.20
	OPENBSD_3_0_BASE:1.3
	OPENBSD_2_9:1.3.0.18
	OPENBSD_2_9_BASE:1.3
	OPENBSD_2_8:1.3.0.16
	OPENBSD_2_8_BASE:1.3
	OPENBSD_2_7:1.3.0.14
	OPENBSD_2_7_BASE:1.3
	OPENBSD_2_6:1.3.0.12
	OPENBSD_2_6_BASE:1.3
	OPENBSD_2_5:1.3.0.10
	OPENBSD_2_5_BASE:1.3
	OPENBSD_2_4:1.3.0.8
	OPENBSD_2_4_BASE:1.3
	OPENBSD_2_3:1.3.0.6
	OPENBSD_2_3_BASE:1.3
	OPENBSD_2_2:1.3.0.4
	OPENBSD_2_2_BASE:1.3
	OPENBSD_2_1:1.3.0.2
	OPENBSD_2_1_BASE:1.3;
locks; strict;
comment	@ * @;


1.5
date	2003.07.15.19.02.52;	author deraadt;	state dead;
branches;
next	1.4;

1.4
date	2003.04.03.12.07.24;	author hin;	state Exp;
branches;
next	1.3;

1.3
date	96.12.14.06.55.56;	author tholo;	state Exp;
branches;
next	1.2;

1.2
date	96.11.11.09.49.47;	author downsj;	state Exp;
branches;
next	1.1;

1.1
date	96.11.11.04.55.03;	author downsj;	state Exp;
branches;
next	;


desc
@@


1.5
log
@now built into krb5
@
text
@/*	$OpenBSD: error_message.c,v 1.4 2003/04/03 12:07:24 hin Exp $	*/

/*-
 * Copyright 1987, 1988 by the Student Information Processing Board
 *	of the Massachusetts Institute of Technology
 *
 * Permission to use, copy, modify, and distribute this software
 * and its documentation for any purpose and without fee is
 * hereby granted, provided that the above copyright notice
 * appear in all copies and that both that copyright notice and
 * this permission notice appear in supporting documentation,
 * and that the names of M.I.T. and the M.I.T. S.I.P.B. not be
 * used in advertising or publicity pertaining to distribution
 * of the software without specific, written prior permission.
 * M.I.T. and the M.I.T. S.I.P.B. make no representations about
 * the suitability of this software for any purpose.  It is
 * provided "as is" without express or implied warranty.
 */

#include <stdio.h>
#include <string.h>
#include <errno.h>
#include "error_table.h"

#ifndef lint
static const char rcsid[] =
    "$OpenBSD: error_message.c,v 1.4 2003/04/03 12:07:24 hin Exp $";
static const char copyright[] =
    "Copyright 1986, 1987, 1988 by the Student Information Processing Board\nand the department of Information Systems\nof the Massachusetts Institute of Technology";
#endif

static char buffer[25];

struct et_list * _et_list = (struct et_list *) NULL;

const char *
error_message (code)
	long	code;
{
    int offset;
    struct et_list *et;
    int table_num;
    int started = 0;
    char *cp;

    offset = (int)(code & ((1<<ERRCODE_RANGE)-1));
    table_num = (int)code - offset;
    if (!table_num) {
#ifdef HAS_SYS_ERRLIST
	if (offset < sys_nerr)
	    return(sys_errlist[offset]);
	else
	    goto oops;
#else
	cp = strerror(offset);
	if (cp)
	    return(cp);
	else
	    goto oops;
#endif
    }
    for (et = _et_list; et; et = et->next) {
	if (et->table->base == table_num) {
	    /* This is the right table */
	    if (et->table->n_msgs <= offset)
		goto oops;
	    return(et->table->msgs[offset]);
	}
    }
oops:
    strlcpy (buffer, "Unknown code ", sizeof(buffer));
    if (table_num) {
	strcat (buffer, error_table_name (table_num));
	strcat (buffer, " ");
    }
    for (cp = buffer; *cp; cp++)
	;
    if (offset >= 100) {
	*cp++ = '0' + offset / 100;
	offset %= 100;
	started++;
    }
    if (started || offset >= 10) {
	*cp++ = '0' + offset / 10;
	offset %= 10;
    }
    *cp++ = '0' + offset;
    *cp = '\0';
    return(buffer);
}
@


1.4
log
@strcpy -> strlcpy

ok millert@@
@
text
@d1 1
a1 1
/*	$OpenBSD: error_message.c,v 1.3 1996/12/14 06:55:56 tholo Exp $	*/
d27 1
a27 1
    "$OpenBSD: error_message.c,v 1.3 1996/12/14 06:55:56 tholo Exp $";
@


1.3
log
@lean up lint & compile warnings
@
text
@d1 1
a1 1
/*	$OpenBSD: error_message.c,v 1.2 1996/11/11 09:49:47 downsj Exp $	*/
d27 1
a27 1
    "$OpenBSD: error_message.c,v 1.2 1996/11/11 09:49:47 downsj Exp $";
d71 1
a71 1
    strcpy (buffer, "Unknown code ");
@


1.2
log
@Slight update.
@
text
@d1 1
a1 1
/*	$OpenBSD: error_message.c,v 1.1 1996/11/11 04:55:03 downsj Exp $	*/
d25 1
d27 1
a27 1
    "$Id: error_message.c,v 1.1 1996/11/11 04:55:03 downsj Exp $";
d30 1
d46 2
a47 2
    offset = code & ((1<<ERRCODE_RANGE)-1);
    table_num = code - offset;
@


1.1
log
@Move libcom_err out of Kerberos, change include location.
@
text
@d1 1
a1 1
/*	$OpenBSD$	*/
d26 1
a26 1
    "$Id: error_message.c,v 1.2 1996/01/30 06:00:35 tholo Exp $";
d47 1
d52 7
@
