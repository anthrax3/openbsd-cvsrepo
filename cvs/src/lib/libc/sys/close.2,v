head	1.18;
access;
symbols
	OPENBSD_6_1:1.18.0.12
	OPENBSD_6_1_BASE:1.18
	OPENBSD_6_0:1.18.0.8
	OPENBSD_6_0_BASE:1.18
	OPENBSD_5_9:1.18.0.4
	OPENBSD_5_9_BASE:1.18
	OPENBSD_5_8:1.18.0.6
	OPENBSD_5_8_BASE:1.18
	OPENBSD_5_7:1.18.0.2
	OPENBSD_5_7_BASE:1.18
	OPENBSD_5_6:1.16.0.8
	OPENBSD_5_6_BASE:1.16
	OPENBSD_5_5:1.16.0.6
	OPENBSD_5_5_BASE:1.16
	OPENBSD_5_4:1.16.0.2
	OPENBSD_5_4_BASE:1.16
	OPENBSD_5_3:1.15.0.6
	OPENBSD_5_3_BASE:1.15
	OPENBSD_5_2:1.15.0.4
	OPENBSD_5_2_BASE:1.15
	OPENBSD_5_1_BASE:1.15
	OPENBSD_5_1:1.15.0.2
	OPENBSD_5_0:1.14.0.18
	OPENBSD_5_0_BASE:1.14
	OPENBSD_4_9:1.14.0.16
	OPENBSD_4_9_BASE:1.14
	OPENBSD_4_8:1.14.0.14
	OPENBSD_4_8_BASE:1.14
	OPENBSD_4_7:1.14.0.10
	OPENBSD_4_7_BASE:1.14
	OPENBSD_4_6:1.14.0.12
	OPENBSD_4_6_BASE:1.14
	OPENBSD_4_5:1.14.0.8
	OPENBSD_4_5_BASE:1.14
	OPENBSD_4_4:1.14.0.6
	OPENBSD_4_4_BASE:1.14
	OPENBSD_4_3:1.14.0.4
	OPENBSD_4_3_BASE:1.14
	OPENBSD_4_2:1.14.0.2
	OPENBSD_4_2_BASE:1.14
	OPENBSD_4_1:1.13.0.8
	OPENBSD_4_1_BASE:1.13
	OPENBSD_4_0:1.13.0.6
	OPENBSD_4_0_BASE:1.13
	OPENBSD_3_9:1.13.0.4
	OPENBSD_3_9_BASE:1.13
	OPENBSD_3_8:1.13.0.2
	OPENBSD_3_8_BASE:1.13
	OPENBSD_3_7:1.11.0.6
	OPENBSD_3_7_BASE:1.11
	OPENBSD_3_6:1.11.0.4
	OPENBSD_3_6_BASE:1.11
	OPENBSD_3_5:1.11.0.2
	OPENBSD_3_5_BASE:1.11
	OPENBSD_3_4:1.10.0.2
	OPENBSD_3_4_BASE:1.10
	OPENBSD_3_3:1.9.0.12
	OPENBSD_3_3_BASE:1.9
	OPENBSD_3_2:1.9.0.10
	OPENBSD_3_2_BASE:1.9
	OPENBSD_3_1:1.9.0.8
	OPENBSD_3_1_BASE:1.9
	OPENBSD_3_0:1.9.0.6
	OPENBSD_3_0_BASE:1.9
	OPENBSD_2_9:1.9.0.4
	OPENBSD_2_9_BASE:1.9
	OPENBSD_2_8:1.9.0.2
	OPENBSD_2_8_BASE:1.9
	OPENBSD_2_7:1.8.0.4
	OPENBSD_2_7_BASE:1.8
	OPENBSD_2_6:1.8.0.2
	OPENBSD_2_6_BASE:1.8
	OPENBSD_2_5:1.4.0.2
	OPENBSD_2_5_BASE:1.4
	OPENBSD_2_4:1.3.0.2
	OPENBSD_2_4_BASE:1.3
	OPENBSD_2_3:1.2.0.4
	OPENBSD_2_3_BASE:1.2
	OPENBSD_2_2:1.2.0.2
	OPENBSD_2_2_BASE:1.2
	OPENBSD_2_1:1.1.1.1.0.4
	OPENBSD_2_1_BASE:1.1.1.1
	OPENBSD_2_0:1.1.1.1.0.2
	OPENBSD_2_0_BASE:1.1.1.1
	netbsd_1_1:1.1.1.1;
locks; strict;
comment	@.\" @;


1.18
date	2014.12.10.19.19.00;	author schwarze;	state Exp;
branches;
next	1.17;
commitid	sADK4BTCz4ZrHHo9;

1.17
date	2014.11.25.15.02.13;	author schwarze;	state Exp;
branches;
next	1.16;
commitid	fs1SE28DgegtJk7b;

1.16
date	2013.03.31.08.34.27;	author guenther;	state Exp;
branches;
next	1.15;

1.15
date	2011.11.06.17.22.20;	author schwarze;	state Exp;
branches;
next	1.14;

1.14
date	2007.05.31.19.19.32;	author jmc;	state Exp;
branches;
next	1.13;

1.13
date	2005.08.11.05.18.45;	author jmc;	state Exp;
branches;
next	1.12;

1.12
date	2005.08.10.01.25.51;	author jaredy;	state Exp;
branches;
next	1.11;

1.11
date	2004.01.14.09.30.19;	author tedu;	state Exp;
branches;
next	1.10;

1.10
date	2003.06.02.20.18.39;	author millert;	state Exp;
branches;
next	1.9;

1.9
date	2000.10.18.05.12.08;	author aaron;	state Exp;
branches;
next	1.8;

1.8
date	99.06.29.14.09.53;	author aaron;	state Exp;
branches;
next	1.7;

1.7
date	99.05.23.14.10.50;	author aaron;	state Exp;
branches;
next	1.6;

1.6
date	99.05.16.19.55.20;	author alex;	state Exp;
branches;
next	1.5;

1.5
date	99.05.11.02.34.03;	author aaron;	state Exp;
branches;
next	1.4;

1.4
date	99.02.27.21.56.11;	author deraadt;	state Exp;
branches;
next	1.3;

1.3
date	98.07.06.18.27.13;	author deraadt;	state Exp;
branches;
next	1.2;

1.2
date	97.06.13.10.08.30;	author deraadt;	state Exp;
branches;
next	1.1;

1.1
date	95.10.18.08.42.24;	author deraadt;	state Exp;
branches
	1.1.1.1;
next	;

1.1.1.1
date	95.10.18.08.42.24;	author deraadt;	state Exp;
branches;
next	;


desc
@@


1.18
log
@use .Rv; no change of meaning; from Kaspars at Bankovskis dot net
@
text
@.\"	$OpenBSD: close.2,v 1.17 2014/11/25 15:02:13 schwarze Exp $
.\"	$NetBSD: close.2,v 1.5 1995/02/27 12:32:14 cgd Exp $
.\"
.\" Copyright (c) 1980, 1991, 1993, 1994
.\"	The Regents of the University of California.  All rights reserved.
.\"
.\" Redistribution and use in source and binary forms, with or without
.\" modification, are permitted provided that the following conditions
.\" are met:
.\" 1. Redistributions of source code must retain the above copyright
.\"    notice, this list of conditions and the following disclaimer.
.\" 2. Redistributions in binary form must reproduce the above copyright
.\"    notice, this list of conditions and the following disclaimer in the
.\"    documentation and/or other materials provided with the distribution.
.\" 3. Neither the name of the University nor the names of its contributors
.\"    may be used to endorse or promote products derived from this software
.\"    without specific prior written permission.
.\"
.\" THIS SOFTWARE IS PROVIDED BY THE REGENTS AND CONTRIBUTORS ``AS IS'' AND
.\" ANY EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT LIMITED TO, THE
.\" IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE
.\" ARE DISCLAIMED.  IN NO EVENT SHALL THE REGENTS OR CONTRIBUTORS BE LIABLE
.\" FOR ANY DIRECT, INDIRECT, INCIDENTAL, SPECIAL, EXEMPLARY, OR CONSEQUENTIAL
.\" DAMAGES (INCLUDING, BUT NOT LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS
.\" OR SERVICES; LOSS OF USE, DATA, OR PROFITS; OR BUSINESS INTERRUPTION)
.\" HOWEVER CAUSED AND ON ANY THEORY OF LIABILITY, WHETHER IN CONTRACT, STRICT
.\" LIABILITY, OR TORT (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY
.\" OUT OF THE USE OF THIS SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF
.\" SUCH DAMAGE.
.\"
.\"     @@(#)close.2	8.2 (Berkeley) 4/19/94
.\"
.Dd $Mdocdate: November 25 2014 $
.Dt CLOSE 2
.Os
.Sh NAME
.Nm close
.Nd delete a descriptor
.Sh SYNOPSIS
.In unistd.h
.Ft int
.Fn close "int d"
.Sh DESCRIPTION
The
.Fn close
call deletes a descriptor
.Fa d
from the per-process object
reference table.
If this is the last reference to the underlying object, the
object will be deactivated.
For example, on the last close of a file,
the current
.Em seek
pointer associated with the file is lost;
on the last close of a
.Xr socket 2 ,
associated naming information and queued data are discarded;
and on the last close of a file holding an advisory lock,
the lock is released (see
.Xr flock 2 ) .
However, the semantics of System V and
.St -p1003.1-88
dictate that all
.Xr fcntl 2
advisory record locks associated with a file for a given process
are removed when
.Em any
file descriptor for that file is closed by that process.
.Pp
When a process exits,
all associated file descriptors are freed, but since there is
a limit on active descriptors per process, the
.Fn close
function call
is useful when a large quantity of file descriptors are being handled.
.Pp
When a process forks (see
.Xr fork 2 ) ,
all descriptors for the new child process reference the same
objects as they did in the parent before the fork.
If a new process image is to then be run using
.Xr execve 2 ,
the process would normally inherit these descriptors.
Most of the descriptors can be rearranged with
.Xr dup2 2
or deleted with
.Fn close
before the
.Xr execve 2
is attempted, but since some of these descriptors may still
be needed should the
.Xr execve 2
fail, it is necessary to arrange for them
to be closed when the
.Xr execve 2
succeeds.
For this reason, the call
.Fn fcntl d F_SETFD FD_CLOEXEC
is provided,
which arranges that a descriptor will be closed after a successful
.Xr execve 2 ;
the call
.Fn fcntl d F_SETFD 0
restores the default,
which is to not close the descriptor.
.Sh RETURN VALUES
.Rv -std
.Sh ERRORS
.Fn close
will fail if:
.Bl -tag -width Er
.It Bq Er EBADF
.Fa d
is not an active descriptor.
.It Bq Er EINTR
An interrupt was received.
.It Bq Er EIO
An I/O error occurred while writing to the file system.
.El
.Sh SEE ALSO
.Xr accept 2 ,
.Xr closefrom 2 ,
.Xr dup2 2 ,
.Xr execve 2 ,
.Xr fcntl 2 ,
.Xr flock 2 ,
.Xr open 2 ,
.Xr pipe 2 ,
.Xr socket 2 ,
.Xr socketpair 2
.Sh STANDARDS
.Fn close
conforms to
.St -p1003.1-2008 .
.Sh HISTORY
The
.Fn close
system call first appeared in
.At v1 .
@


1.17
log
@macro and typo fixes from kaspars at bankovskis dot net
@
text
@d1 1
a1 1
.\"	$OpenBSD: close.2,v 1.16 2013/03/31 08:34:27 guenther Exp $
d33 1
a33 1
.Dd $Mdocdate: March 31 2013 $
d108 1
a108 4
Upon successful completion, a value of 0 is returned.
Otherwise, a value of \-1 is returned and the global integer variable
.Va errno
is set to indicate the error.
@


1.16
log
@Updates to SYNOPSIS, ERRORS, and STANDARDS

ok jmc@@
@
text
@d1 1
a1 1
.\"	$OpenBSD: close.2,v 1.15 2011/11/06 17:22:20 schwarze Exp $
d33 1
a33 1
.Dd $Mdocdate: November 6 2011 $
d40 1
a40 1
.Fd #include <unistd.h>
d46 3
a48 1
call deletes a descriptor from the per-process object
@


1.15
log
@Commemorate  research!dmr  by documenting the history of all
system calls existing since Version 1 AT&T UNIX (first batch).
All information taken from primary sources at the UNIX tree of the
UNIX heritage society, http://minnie.tuhs.org/cgi-bin/utree.pl .
The number of errors in the existing manuals is astonishing.
All facts checked by sobrado@@.
Feedback and ok on wording and formatting by jmc@@.
@
text
@d1 1
a1 1
.\"	$OpenBSD: close.2,v 1.14 2007/05/31 19:19:32 jmc Exp $
d33 1
a33 1
.Dd $Mdocdate: May 31 2007 $
d119 2
d125 1
d136 1
a136 1
.St -p1003.1-88 .
@


1.14
log
@convert to new .Dd format;
@
text
@d1 1
a1 1
.\"	$OpenBSD: close.2,v 1.13 2005/08/11 05:18:45 jmc Exp $
d33 1
a33 1
.Dd $Mdocdate$
d134 5
@


1.13
log
@wording; ok jaredy@@
@
text
@d1 1
a1 1
.\"	$OpenBSD: close.2,v 1.12 2005/08/10 01:25:51 jaredy Exp $
d33 1
a33 1
.Dd April 19, 1994
@


1.12
log
@- macros, punctuation, wording, and rewording
- fix issue from -r 1.5 about a reference to
  flock(2) being moved to the wrong place
- use FD_CLOEXEC instead of 1 to fcntl()
- refer to formal parameters consistently

ok jmc
@
text
@d1 1
a1 1
.\"	$OpenBSD: close.2,v 1.11 2004/01/14 09:30:19 tedu Exp $
d58 1
a58 1
the lock is released (see further
@


1.11
log
@.Xr closefrom
@
text
@d1 1
a1 1
.\"	$OpenBSD: close.2,v 1.10 2003/06/02 20:18:39 millert Exp $
d50 1
a50 1
For example, on the last close of a file
d55 1
a55 1
.Xr socket 2
d57 3
a59 2
on the last close of a file holding an advisory lock
the lock is released.
d67 1
a67 3
file descriptor for that file is closed by that process (see
further
.Xr flock 2 ) .
d71 1
a71 1
a limit on active descriptors per processes, the
d80 1
a80 1
If a new process is then to be run using
d89 7
a95 3
is attempted, but if some of these descriptors will still
be needed if the execve fails, it is necessary to arrange for them
to be closed if the execve succeeds.
d97 1
a97 1
.Dq Li fcntl(d, F_SETFD, 1)
d100 3
a102 2
execve; the call
.Dq Li fcntl(d, F_SETFD, 0)
d115 1
a115 1
.Fa D
@


1.10
log
@Remove the advertising clause in the UCB license which Berkeley
rescinded 22 July 1999.  Proofed by myself and Theo.
@
text
@d1 1
a1 1
.\"	$OpenBSD: close.2,v 1.9 2000/10/18 05:12:08 aaron Exp $
d118 1
@


1.9
log
@Another round of man page cleanup, this time to remove more hard sentence
breaks and getting rid of short lines, making these files easier to work with.
@
text
@d1 1
a1 1
.\"	$OpenBSD: close.2,v 1.8 1999/06/29 14:09:53 aaron Exp $
d15 1
a15 5
.\" 3. All advertising materials mentioning features or use of this software
.\"    must display the following acknowledgement:
.\"	This product includes software developed by the University of
.\"	California, Berkeley and its contributors.
.\" 4. Neither the name of the University nor the names of its contributors
@


1.8
log
@- change references to nil to null; tschroed@@acm.org
- remove trailing spaces from end of lines
- add some .Dv
- change -1 to \-1, so `-' is taken as a negative sign
- other misc formatting fixes
@
text
@d1 1
a1 1
.\"	$OpenBSD: close.2,v 1.7 1999/05/23 14:10:50 aaron Exp $
d62 2
a63 1
the lock is released. However, the semantics of System V and
d87 2
a88 2
the process would normally inherit these descriptors.  Most
of the descriptors can be rearranged with
@


1.7
log
@remove argument from .Os macros so value in /usr/share/tmac/mdoc/doc-common
is used instead; kwesterback@@home.com
@
text
@d1 1
a1 1
.\"	$OpenBSD: close.2,v 1.6 1999/05/16 19:55:20 alex Exp $
d67 1
a67 1
are removed when 
d106 1
a106 1
Otherwise, a value of -1 is returned and the global integer variable
d130 1
a130 1
conforms to 
@


1.6
log
@Cleanup xrefs under SEE ALSO.  Specifically:

  - Sort xrefs by section, and then alphabetically.
  - Add missing commas between xref items.
  - Remove commas from the last xref entry.
  - Remove duplicate entries.
@
text
@d1 1
a1 1
.\"	$OpenBSD: close.2,v 1.5 1999/05/11 02:34:03 aaron Exp $
d39 1
a39 1
.Os BSD 4
@


1.5
log
@note that close(2)'ing any file descriptor which refers to a file holding
any advisory locks will cause the file to lose its locks; from FreeBSD,
verified by page 373 of APUE
@
text
@d1 1
a1 1
.\"	$OpenBSD: close.2,v 1.4 1999/02/27 21:56:11 deraadt Exp $
d121 2
d127 1
a127 3
.Xr socketpair 2 ,
.Xr execve 2 ,
.Xr fcntl 2
@


1.4
log
@make function names the correct case
@
text
@d1 1
a1 1
.\"	$OpenBSD: close.2,v 1.3 1998/07/06 18:27:13 deraadt Exp $
d62 9
a70 1
the lock is released (see further
@


1.3
log
@fix openbsd tag
@
text
@d1 1
a1 1
.\"	$OpenBSD: close.2,v 1.5 1995/02/27 12:32:14 cgd Exp $
d102 1
a102 1
.Fn Close
d121 1
a121 1
.Fn Close
@


1.2
log
@fix lots of .Xr and other minor things
@
text
@d1 1
@


1.1
log
@Initial revision
@
text
@d83 1
a83 1
.Xr execve
@


1.1.1.1
log
@initial import of NetBSD tree
@
text
@@
