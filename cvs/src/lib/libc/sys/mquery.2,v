head	1.11;
access;
symbols
	OPENBSD_6_1_BASE:1.11
	OPENBSD_6_0:1.11.0.10
	OPENBSD_6_0_BASE:1.11
	OPENBSD_5_9:1.11.0.6
	OPENBSD_5_9_BASE:1.11
	OPENBSD_5_8:1.11.0.8
	OPENBSD_5_8_BASE:1.11
	OPENBSD_5_7:1.11.0.2
	OPENBSD_5_7_BASE:1.11
	OPENBSD_5_6:1.11.0.4
	OPENBSD_5_6_BASE:1.11
	OPENBSD_5_5:1.10.0.6
	OPENBSD_5_5_BASE:1.10
	OPENBSD_5_4:1.10.0.2
	OPENBSD_5_4_BASE:1.10
	OPENBSD_5_3:1.9.0.20
	OPENBSD_5_3_BASE:1.9
	OPENBSD_5_2:1.9.0.18
	OPENBSD_5_2_BASE:1.9
	OPENBSD_5_1_BASE:1.9
	OPENBSD_5_1:1.9.0.16
	OPENBSD_5_0:1.9.0.14
	OPENBSD_5_0_BASE:1.9
	OPENBSD_4_9:1.9.0.12
	OPENBSD_4_9_BASE:1.9
	OPENBSD_4_8:1.9.0.10
	OPENBSD_4_8_BASE:1.9
	OPENBSD_4_7:1.9.0.6
	OPENBSD_4_7_BASE:1.9
	OPENBSD_4_6:1.9.0.8
	OPENBSD_4_6_BASE:1.9
	OPENBSD_4_5:1.9.0.4
	OPENBSD_4_5_BASE:1.9
	OPENBSD_4_4:1.9.0.2
	OPENBSD_4_4_BASE:1.9
	OPENBSD_4_3:1.8.0.4
	OPENBSD_4_3_BASE:1.8
	OPENBSD_4_2:1.8.0.2
	OPENBSD_4_2_BASE:1.8
	OPENBSD_4_1:1.7.0.16
	OPENBSD_4_1_BASE:1.7
	OPENBSD_4_0:1.7.0.14
	OPENBSD_4_0_BASE:1.7
	OPENBSD_3_9:1.7.0.12
	OPENBSD_3_9_BASE:1.7
	OPENBSD_3_8:1.7.0.10
	OPENBSD_3_8_BASE:1.7
	OPENBSD_3_7:1.7.0.8
	OPENBSD_3_7_BASE:1.7
	OPENBSD_3_6:1.7.0.6
	OPENBSD_3_6_BASE:1.7
	OPENBSD_3_5:1.7.0.4
	OPENBSD_3_5_BASE:1.7
	OPENBSD_3_4:1.7.0.2
	OPENBSD_3_4_BASE:1.7;
locks; strict;
comment	@.\" @;


1.11
date	2014.07.02.22.22.35;	author matthew;	state Exp;
branches;
next	1.10;
commitid	cXzdthTwYzgYTwmX;

1.10
date	2013.04.08.19.35.00;	author guenther;	state Exp;
branches;
next	1.9;

1.9
date	2008.06.30.05.59.19;	author otto;	state Exp;
branches;
next	1.8;

1.8
date	2007.05.31.19.19.33;	author jmc;	state Exp;
branches;
next	1.7;

1.7
date	2003.06.01.20.25.23;	author jmc;	state Exp;
branches;
next	1.6;

1.6
date	2003.04.25.18.59.29;	author drahn;	state Exp;
branches;
next	1.5;

1.5
date	2003.04.21.11.09.42;	author mpech;	state Exp;
branches;
next	1.4;

1.4
date	2003.04.18.23.52.38;	author drahn;	state Exp;
branches;
next	1.3;

1.3
date	2003.04.18.23.50.32;	author drahn;	state Exp;
branches;
next	1.2;

1.2
date	2003.04.17.18.38.01;	author millert;	state Exp;
branches;
next	1.1;

1.1
date	2003.04.14.04.53.50;	author art;	state Exp;
branches;
next	;


desc
@@


1.11
log
@Various small typographic fixes for mman.h manual pages:

Use .Fn instead of .Nm as appropriate
Use .In for include lines
Use .Rv -std where possible
Use .Xr to refer to functions from other manual pages
Remove extraneous sys/types.h include

More substantive changes to follow.

Discussed with schwarze
@
text
@.\"	$OpenBSD: mquery.2,v 1.10 2013/04/08 19:35:00 guenther Exp $
.\"
.\" Copyright (c) 2003 Artur Grabowski <art@@openbsd.org>
.\" All rights reserved.
.\"
.\" Redistribution and use in source and binary forms, with or without
.\" modification, are permitted provided that the following conditions
.\" are met:
.\"
.\" 1. Redistributions of source code must retain the above copyright
.\"    notice, this list of conditions and the following disclaimer.
.\" 2. The name of the author may not be used to endorse or promote products
.\"    derived from this software without specific prior written permission.
.\"
.\" THIS SOFTWARE IS PROVIDED ``AS IS'' AND ANY EXPRESS OR IMPLIED WARRANTIES,
.\" INCLUDING, BUT NOT LIMITED TO, THE IMPLIED WARRANTIES OF MERCHANTABILITY
.\" AND FITNESS FOR A PARTICULAR PURPOSE ARE DISCLAIMED. IN NO EVENT SHALL
.\" THE AUTHOR BE LIABLE FOR ANY DIRECT, INDIRECT, INCIDENTAL, SPECIAL,
.\" EXEMPLARY, OR CONSEQUENTIAL  DAMAGES (INCLUDING, BUT NOT LIMITED TO,
.\" PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES; LOSS OF USE, DATA, OR PROFITS;
.\" OR BUSINESS INTERRUPTION) HOWEVER CAUSED AND ON ANY THEORY OF LIABILITY,
.\" WHETHER IN CONTRACT, STRICT LIABILITY, OR TORT (INCLUDING NEGLIGENCE OR
.\" OTHERWISE) ARISING IN ANY WAY OUT OF THE USE OF THIS SOFTWARE, EVEN IF
.\" ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.
.\"
.Dd $Mdocdate: April 8 2013 $
.Dt MQUERY 2
.Os
.Sh NAME
.Nm mquery
.Nd provide mapping hints to applications
.Sh SYNOPSIS
.In sys/mman.h
.Ft void *
.Fn mquery "void *addr" "size_t len" "int prot" "int flags" "int fd" "off_t offset"
.Sh DESCRIPTION
The
.Fn mquery
system call checks the existing memory mappings of a process and returns
hints to the caller about where to put a memory mapping.
This hint can be later used when performing memory mappings with the
.Xr mmap 2
system call with
.Dv MAP_FIXED
in the flags.
The
.Fa addr
argument should be a memory location that which the caller specifies the
preferred address.
The
.Fa size
argument specifies the requested size of the memory area the caller
is looking for.
The
.Fa fd
and
.Fa off
arguments specify the file that will be mapped and the offset in it,
this is the same as the corresponding arguments to
.Xr mmap 2 .
.Pp
The behavior of the function depends on the
.Fa flags
argument.
If set to
.Dv MAP_FIXED
the pointer
.Fa addr
is used as a fixed hint and
.Fn mquery
will return
.Dv MAP_FAILED
and set
.Va errno
to
.Er ENOMEM
if there is not
.Fa size
bytes free after that address.
Otherwise it will return the hint addr.
If no flags are set
.Fn mquery
will use
.Fa addr
as a starting point in memory and will search forward to find
a memory area with
.Fa size
bytes free and that will be suitable for creating a mapping for the
file and offset specified in the
.Fa fd
and
.Fa off
arguments.
When no such area can be found
.Fn mquery
will return
and set
.Va errno
to indicate the error.
.Sh RETURN VALUES
When a memory range satisfying the request is found
.Fn mquery
returns the available address.
Otherwise,
.Dv MAP_FAILED
is returned and
.Va errno
is set to indicate the error.
.Sh ERRORS
.Fn mquery
will fail if:
.Bl -tag -width Er
.It Bq Er EINVAL
.Dv MAP_FIXED
was specified and the requested memory area is unavailable.
.It Bq Er ENOMEM
There was not enough memory left after the hint specified.
.It Bq Er EBADF
.Fa fd
is not a valid open file descriptor.
.El
.Sh SEE ALSO
.Xr mmap 2
.Sh STANDARDS
The
.Fn mquery
function should not be used in portable applications.
.Sh HISTORY
The
.Fn mquery
function first appeared in
.Ox 3.4 .
@


1.10
log
@Use .Er for errno E* constants
@
text
@d1 1
a1 1
.\"	$OpenBSD: mquery.2,v 1.9 2008/06/30 05:59:19 otto Exp $
d26 1
a26 1
.Dd $Mdocdate: June 30 2008 $
d33 1
a33 2
.Fd #include <sys/types.h>
.Fd #include <sys/mman.h>
d38 1
a38 1
.Nm mquery
d42 1
a42 1
.Fn mmap
d60 1
a60 1
.Fn mmap .
@


1.9
log
@document that mquery(2) is non-standard; hint and ok deraadt@@
@
text
@d1 1
a1 1
.\"	$OpenBSD: mquery.2,v 1.8 2007/05/31 19:19:33 jmc Exp $
d26 1
a26 1
.Dd $Mdocdate$
d77 1
a77 1
.Dv ENOMEM
@


1.8
log
@convert to new .Dd format;
@
text
@d1 1
a1 1
.\"	$OpenBSD: mquery.2,v 1.7 2003/06/01 20:25:23 jmc Exp $
d125 4
@


1.7
log
@- section reorder
- merge COMPATIBILITY
- kill whitespace at EOL
@
text
@d1 1
a1 1
.\"	$OpenBSD: mquery.2,v 1.6 2003/04/25 18:59:29 drahn Exp $
d26 1
a26 1
.Dd April 2, 2003
@


1.6
log
@Document changes to mquery(2) function signature change, now the same as mmap(2)
@
text
@d1 1
a1 1
.\"	$OpenBSD: mquery.2,v 1.5 2003/04/21 11:09:42 mpech Exp $
d4 1
a4 1
.\" All rights reserved. 
d6 3
a8 3
.\" Redistribution and use in source and binary forms, with or without 
.\" modification, are permitted provided that the following conditions 
.\" are met: 
d10 2
a11 2
.\" 1. Redistributions of source code must retain the above copyright 
.\"    notice, this list of conditions and the following disclaimer. 
d13 1
a13 1
.\"    derived from this software without specific prior written permission. 
d24 1
a24 1
.\" ADVISED OF THE POSSIBILITY OF SUCH DAMAGE. 
d97 1
a97 1
will return 
d105 1
a105 1
Otherwise, 
@


1.5
log
@Close .Bl

millert@@
@
text
@d1 1
a1 1
.\"	$OpenBSD: mquery.2,v 1.4 2003/04/18 23:52:38 drahn Exp $
d35 2
a36 2
.Ft int
.Fn mquery "int flags" "void **addr" "size_t size" "int fd" "off_t off"
d49 2
a50 3
argument should point to a memory location that stores a pointer
which is used both as an input argument where the caller specifies the
preferred address and as an output of the resulting hint.
d69 1
a69 1
.Fa *addr
d72 3
a74 1
will return \-1 and set
d81 1
a81 3
Otherwise it will return 0 and
.Fa *addr
will not be changed.
d85 1
a85 1
.Fa *addr
d97 2
a98 1
will return \-1 and set
d104 4
a107 2
returns 0.
Otherwise, \-1 is returned and
@


1.4
log
@Fix format odditiy in 'ERRORS' section, formats like mmap(2) manpage now.
@
text
@d1 1
a1 1
.\"	$OpenBSD: mquery.2,v 1.3 2003/04/18 23:50:32 drahn Exp $
d120 1
@


1.3
log
@Document that mquery() returns EINVAL if request memory was not available
when MAP_FIXED is specified. ok tedu@@
@
text
@d1 1
a1 1
.\"	$OpenBSD: mquery.2,v 1.2 2003/04/17 18:38:01 millert Exp $
d111 1
a111 1
.Bl -tag -width EINVAL
@


1.2
log
@fix typo; Julien Bordet
@
text
@d1 1
a1 1
.\"	$OpenBSD: mquery.2,v 1.1 2003/04/14 04:53:50 art Exp $
d100 1
a100 2
to
.Dv ENOMEM .
d111 2
a112 2
.Bl -tag -width ENOMEM
.It Bq Er ENOMEM
@


1.1
log
@There are two related changes.

The first one is an mquery(2) syscall. It's for asking the VM system
about where to map things. It will be used by ld.so, read the man page
for details.

The second change is related and is a centralization of uvm_map hint
that all callers of uvm_map calculated. This will allow us to adjust
this hint on architectures that have segments for non-exec mappings.

deraadt@@ drahn@@ ok.
@
text
@d1 1
a1 1
.\"	$OpenBSD$
d39 1
a39 1
.Nm mqeury
@

