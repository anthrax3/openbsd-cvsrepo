head	1.51;
access;
symbols
	OPENBSD_6_1:1.51.0.2
	OPENBSD_6_1_BASE:1.51
	OPENBSD_6_0:1.50.0.2
	OPENBSD_6_0_BASE:1.50
	OPENBSD_5_9:1.49.0.2
	OPENBSD_5_9_BASE:1.49
	OPENBSD_5_8:1.48.0.6
	OPENBSD_5_8_BASE:1.48
	OPENBSD_5_7:1.48.0.2
	OPENBSD_5_7_BASE:1.48
	OPENBSD_5_6:1.46.0.4
	OPENBSD_5_6_BASE:1.46
	OPENBSD_5_5:1.42.0.4
	OPENBSD_5_5_BASE:1.42
	OPENBSD_5_4:1.40.0.2
	OPENBSD_5_4_BASE:1.40
	OPENBSD_5_3:1.38.0.2
	OPENBSD_5_3_BASE:1.38
	OPENBSD_5_2:1.36.0.4
	OPENBSD_5_2_BASE:1.36
	OPENBSD_5_1_BASE:1.36
	OPENBSD_5_1:1.36.0.2
	OPENBSD_5_0:1.34.0.2
	OPENBSD_5_0_BASE:1.34
	OPENBSD_4_9:1.28.0.2
	OPENBSD_4_9_BASE:1.28
	OPENBSD_4_8:1.27.0.2
	OPENBSD_4_8_BASE:1.27
	OPENBSD_4_7:1.25.0.6
	OPENBSD_4_7_BASE:1.25
	OPENBSD_4_6:1.25.0.8
	OPENBSD_4_6_BASE:1.25
	OPENBSD_4_5:1.25.0.4
	OPENBSD_4_5_BASE:1.25
	OPENBSD_4_4:1.25.0.2
	OPENBSD_4_4_BASE:1.25
	OPENBSD_4_3:1.22.0.4
	OPENBSD_4_3_BASE:1.22
	OPENBSD_4_2:1.22.0.2
	OPENBSD_4_2_BASE:1.22
	OPENBSD_4_1:1.21.0.10
	OPENBSD_4_1_BASE:1.21
	OPENBSD_4_0:1.21.0.8
	OPENBSD_4_0_BASE:1.21
	OPENBSD_3_9:1.21.0.6
	OPENBSD_3_9_BASE:1.21
	OPENBSD_3_8:1.21.0.4
	OPENBSD_3_8_BASE:1.21
	OPENBSD_3_7:1.21.0.2
	OPENBSD_3_7_BASE:1.21
	OPENBSD_3_6:1.20.0.6
	OPENBSD_3_6_BASE:1.20
	OPENBSD_3_5:1.20.0.4
	OPENBSD_3_5_BASE:1.20
	OPENBSD_3_4:1.20.0.2
	OPENBSD_3_4_BASE:1.20
	OPENBSD_3_3:1.18.0.6
	OPENBSD_3_3_BASE:1.18
	OPENBSD_3_2:1.18.0.4
	OPENBSD_3_2_BASE:1.18
	OPENBSD_3_1:1.18.0.2
	OPENBSD_3_1_BASE:1.18
	OPENBSD_3_0:1.16.0.6
	OPENBSD_3_0_BASE:1.16
	OPENBSD_2_9:1.16.0.4
	OPENBSD_2_9_BASE:1.16
	OPENBSD_2_8:1.16.0.2
	OPENBSD_2_8_BASE:1.16
	OPENBSD_2_7:1.15.0.2
	OPENBSD_2_7_BASE:1.15
	OPENBSD_2_6:1.14.0.2
	OPENBSD_2_6_BASE:1.14
	OPENBSD_2_5:1.8.0.2
	OPENBSD_2_5_BASE:1.8
	OPENBSD_2_4:1.6.0.2
	OPENBSD_2_4_BASE:1.6
	OPENBSD_2_3:1.4.0.2
	OPENBSD_2_3_BASE:1.4
	OPENBSD_2_2:1.3.0.2
	OPENBSD_2_2_BASE:1.3
	OPENBSD_2_1:1.1.1.1.0.4
	OPENBSD_2_1_BASE:1.1.1.1
	OPENBSD_2_0:1.1.1.1.0.2
	OPENBSD_2_0_BASE:1.1.1.1
	netbsd_1_1:1.1.1.1;
locks; strict;
comment	@.\" @;


1.51
date	2016.10.19.05.50.54;	author jmc;	state Exp;
branches;
next	1.50;
commitid	Wznqo21P32WT9vuf;

1.50
date	2016.06.13.21.24.43;	author bluhm;	state Exp;
branches;
next	1.49;
commitid	t4rQrmZwTmcYiFNW;

1.49
date	2015.09.04.19.12.31;	author bluhm;	state Exp;
branches;
next	1.48;
commitid	wdmLPxST3MpslvRH;

1.48
date	2014.12.16.00.06.49;	author schwarze;	state Exp;
branches;
next	1.47;
commitid	V04BuZyu1wULJQGU;

1.47
date	2014.12.10.19.19.00;	author schwarze;	state Exp;
branches;
next	1.46;
commitid	sADK4BTCz4ZrHHo9;

1.46
date	2014.04.07.10.04.17;	author mpi;	state Exp;
branches;
next	1.45;

1.45
date	2014.03.28.08.33.51;	author sthen;	state Exp;
branches;
next	1.44;

1.44
date	2014.03.27.13.27.28;	author mpi;	state Exp;
branches;
next	1.43;

1.43
date	2014.03.06.17.38.28;	author jmc;	state Exp;
branches;
next	1.42;

1.42
date	2014.02.26.21.01.38;	author claudio;	state Exp;
branches;
next	1.41;

1.41
date	2014.01.21.03.15.45;	author schwarze;	state Exp;
branches;
next	1.40;

1.40
date	2013.06.02.01.07.47;	author benno;	state Exp;
branches;
next	1.39;

1.39
date	2013.04.08.06.26.12;	author guenther;	state Exp;
branches;
next	1.38;

1.38
date	2013.01.18.09.41.51;	author bluhm;	state Exp;
branches;
next	1.37;

1.37
date	2012.10.21.13.06.02;	author benno;	state Exp;
branches;
next	1.36;

1.36
date	2011.12.23.17.00.47;	author jmc;	state Exp;
branches;
next	1.35;

1.35
date	2011.09.03.22.59.07;	author jmc;	state Exp;
branches;
next	1.34;

1.34
date	2011.07.04.05.52.17;	author jmc;	state Exp;
branches;
next	1.33;

1.33
date	2011.07.04.00.34.43;	author mikeb;	state Exp;
branches;
next	1.32;

1.32
date	2011.05.02.20.18.17;	author jmc;	state Exp;
branches;
next	1.31;

1.31
date	2011.05.02.16.45.29;	author mikeb;	state Exp;
branches;
next	1.30;

1.30
date	2011.04.22.11.59.26;	author bluhm;	state Exp;
branches;
next	1.29;

1.29
date	2011.03.08.00.13.41;	author bluhm;	state Exp;
branches;
next	1.28;

1.28
date	2011.01.31.13.27.05;	author bluhm;	state Exp;
branches;
next	1.27;

1.27
date	2010.07.01.13.39.19;	author jmc;	state Exp;
branches;
next	1.26;

1.26
date	2010.06.30.19.57.03;	author deraadt;	state Exp;
branches;
next	1.25;

1.25
date	2008.05.09.11.58.16;	author jmc;	state Exp;
branches;
next	1.24;

1.24
date	2008.05.09.08.24.06;	author markus;	state Exp;
branches;
next	1.23;

1.23
date	2008.05.02.06.49.31;	author ckuethe;	state Exp;
branches;
next	1.22;

1.22
date	2007.05.31.19.19.32;	author jmc;	state Exp;
branches;
next	1.21;

1.21
date	2005.03.07.23.41.53;	author jmc;	state Exp;
branches;
next	1.20;

1.20
date	2003.06.02.20.18.39;	author millert;	state Exp;
branches;
next	1.19;

1.19
date	2003.06.01.20.25.23;	author jmc;	state Exp;
branches;
next	1.18;

1.18
date	2002.04.08.23.13.10;	author espie;	state Exp;
branches;
next	1.17;

1.17
date	2002.01.02.15.57.16;	author mpech;	state Exp;
branches;
next	1.16;

1.16
date	2000.10.18.05.12.10;	author aaron;	state Exp;
branches;
next	1.15;

1.15
date	2000.04.15.02.15.24;	author aaron;	state Exp;
branches;
next	1.14;

1.14
date	99.08.15.13.14.11;	author deraadt;	state Exp;
branches;
next	1.13;

1.13
date	99.07.05.06.08.05;	author aaron;	state Exp;
branches;
next	1.12;

1.12
date	99.06.29.14.23.29;	author aaron;	state Exp;
branches;
next	1.11;

1.11
date	99.06.29.14.10.02;	author aaron;	state Exp;
branches;
next	1.10;

1.10
date	99.05.23.14.10.54;	author aaron;	state Exp;
branches;
next	1.9;

1.9
date	99.05.16.19.55.27;	author alex;	state Exp;
branches;
next	1.8;

1.8
date	99.02.27.21.56.24;	author deraadt;	state Exp;
branches;
next	1.7;

1.7
date	99.02.15.19.04.21;	author millert;	state Exp;
branches;
next	1.6;

1.6
date	98.08.17.17.35.11;	author deraadt;	state Exp;
branches;
next	1.5;

1.5
date	98.07.06.18.27.39;	author deraadt;	state Exp;
branches;
next	1.4;

1.4
date	98.01.06.23.49.47;	author deraadt;	state Exp;
branches;
next	1.3;

1.3
date	97.06.19.10.29.24;	author deraadt;	state Exp;
branches;
next	1.2;

1.2
date	97.06.13.10.08.33;	author deraadt;	state Exp;
branches;
next	1.1;

1.1
date	95.10.18.08.42.26;	author deraadt;	state Exp;
branches
	1.1.1.1;
next	;

1.1.1.1
date	95.10.18.08.42.26;	author deraadt;	state Exp;
branches;
next	;


desc
@@


1.51
log
@note that SO_REUSEADDR is restricted to callers with the same uid or root;
while there, super-user -> superuser for internal consistency;

diff from kirill miazine, tweaked by myself;
ok deraadt millert guenther
@
text
@.\"	$OpenBSD: getsockopt.2,v 1.50 2016/06/13 21:24:43 bluhm Exp $
.\"	$NetBSD: getsockopt.2,v 1.7 1995/02/27 12:33:29 cgd Exp $
.\"
.\" Copyright (c) 1983, 1991, 1993
.\"	The Regents of the University of California.  All rights reserved.
.\"
.\" Redistribution and use in source and binary forms, with or without
.\" modification, are permitted provided that the following conditions
.\" are met:
.\" 1. Redistributions of source code must retain the above copyright
.\"    notice, this list of conditions and the following disclaimer.
.\" 2. Redistributions in binary form must reproduce the above copyright
.\"    notice, this list of conditions and the following disclaimer in the
.\"    documentation and/or other materials provided with the distribution.
.\" 3. Neither the name of the University nor the names of its contributors
.\"    may be used to endorse or promote products derived from this software
.\"    without specific prior written permission.
.\"
.\" THIS SOFTWARE IS PROVIDED BY THE REGENTS AND CONTRIBUTORS ``AS IS'' AND
.\" ANY EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT LIMITED TO, THE
.\" IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE
.\" ARE DISCLAIMED.  IN NO EVENT SHALL THE REGENTS OR CONTRIBUTORS BE LIABLE
.\" FOR ANY DIRECT, INDIRECT, INCIDENTAL, SPECIAL, EXEMPLARY, OR CONSEQUENTIAL
.\" DAMAGES (INCLUDING, BUT NOT LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS
.\" OR SERVICES; LOSS OF USE, DATA, OR PROFITS; OR BUSINESS INTERRUPTION)
.\" HOWEVER CAUSED AND ON ANY THEORY OF LIABILITY, WHETHER IN CONTRACT, STRICT
.\" LIABILITY, OR TORT (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY
.\" OUT OF THE USE OF THIS SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF
.\" SUCH DAMAGE.
.\"
.\"     @@(#)getsockopt.2	8.3 (Berkeley) 4/19/94
.\"
.Dd $Mdocdate: June 13 2016 $
.Dt GETSOCKOPT 2
.Os
.Sh NAME
.Nm getsockopt ,
.Nm setsockopt
.Nd get and set options on sockets
.Sh SYNOPSIS
.In sys/socket.h
.Ft int
.Fn getsockopt "int s" "int level" "int optname" "void *optval" "socklen_t *optlen"
.Ft int
.Fn setsockopt "int s" "int level" "int optname" "const void *optval" "socklen_t optlen"
.Sh DESCRIPTION
.Fn getsockopt
and
.Fn setsockopt
manipulate the
.Em options
associated with a socket.
Options may exist at multiple protocol levels;
they are always present at the uppermost
.Dq socket
level.
.Pp
When manipulating socket options the level at which the
option resides and the name of the option must be specified.
To manipulate options at the socket level,
.Fa level
is specified as
.Dv SOL_SOCKET .
To manipulate options at any other level the protocol number of the
appropriate protocol controlling the option is supplied.
For example, to indicate that an option is to be interpreted by the
TCP protocol,
.Fa level
should be set to the protocol number of TCP; see
.Xr getprotoent 3 .
.Pp
The parameters
.Fa optval
and
.Fa optlen
are used to access option values for
.Fn setsockopt .
For
.Fn getsockopt
they identify a buffer in which the value for the
requested option(s) are to be returned.
For
.Fn getsockopt ,
.Fa optlen
is a value-result parameter, initially containing the
size of the buffer pointed to by
.Fa optval ,
and modified on return to indicate the actual size of the value returned.
If no option value is to be supplied or returned,
.Fa optval
may be
.Dv NULL .
.Pp
.Fa optname
and any specified options are passed uninterpreted to the appropriate
protocol module for interpretation.
The include file
.In sys/socket.h
contains definitions for socket level options, described below.
Options at other protocol levels vary in format and name;
consult the appropriate entries in section 4 of the manual.
.Pp
Most socket-level options utilize an
.Li int
parameter for
.Fa optval .
For
.Fn setsockopt ,
the parameter should be non-zero to enable a boolean option,
or zero if the option is to be disabled.
.Dv SO_LINGER
uses a
.Li struct linger
parameter, defined in
.In sys/socket.h ,
which specifies the desired state of the option and the
linger interval (see below).
.Dv SO_SNDTIMEO
and
.Dv SO_RCVTIMEO
use a
.Li struct timeval
parameter, defined in
.In sys/time.h .
.Pp
The following options are recognized at the socket level.
Except as noted, each may be examined with
.Fn getsockopt
and set with
.Fn setsockopt .
.Pp
.Bl -tag -width SO_OOBINLINE -offset indent -compact
.It Dv SO_DEBUG
enables recording of debugging information
.It Dv SO_REUSEADDR
enables local address reuse
.It Dv SO_REUSEPORT
enables duplicate address and port bindings
.It Dv SO_KEEPALIVE
enables keep connections alive
.It Dv SO_DONTROUTE
enables routing bypass; not supported
.It Dv SO_LINGER
linger on close if data present
.It Dv SO_BROADCAST
enables permission to transmit broadcast messages
.It Dv SO_OOBINLINE
enables reception of out-of-band data in band
.It Dv SO_BINDANY
enables binding to any address
.It Dv SO_SNDBUF
set buffer size for output
.It Dv SO_RCVBUF
set buffer size for input
.It Dv SO_SNDLOWAT
set minimum count for output
.It Dv SO_RCVLOWAT
set minimum count for input
.It Dv SO_SNDTIMEO
set timeout value for output
.It Dv SO_RCVTIMEO
set timeout value for input
.It Dv SO_TIMESTAMP
enables reception of a timestamp with datagrams
.It Dv SO_PEERCRED
get the credentials from other side of connection
.It Dv SO_RTABLE
set the routing table used for route lookups
.It Dv SO_SPLICE
splice two sockets together or get data length
.It Dv SO_TYPE
get the type of the socket (get only)
.It Dv SO_ERROR
get and clear error on the socket (get only)
.El
.Pp
.Dv SO_DEBUG
enables debugging in the underlying protocol modules.
.Dv SO_REUSEADDR
indicates that the rules used in validating addresses supplied in a
.Xr bind 2
call should allow reuse of local addresses
by callers with the same user ID (or the superuser).
.Dv SO_REUSEPORT
allows completely duplicate bindings by multiple processes if they all set
.Dv SO_REUSEPORT
before binding the port.
This option permits multiple instances of a program to each
receive UDP/IP multicast or broadcast datagrams destined for the bound port.
.Dv SO_KEEPALIVE
enables the periodic transmission of messages on a connected socket.
Should the connected party fail to respond to these messages, the connection
is considered broken and processes using the socket are notified via a
.Dv SIGPIPE
signal when attempting to send data.
.Pp
.Dv SO_LINGER
controls the action taken when unsent messages
are queued on socket and a
.Xr close 2
is performed.
If the socket promises reliable delivery of data and
.Dv SO_LINGER
is set, the system will block the process on the
.Xr close 2
attempt until it is able to transmit the data or until it decides it
is unable to deliver the information (a timeout period measured in seconds,
termed the linger interval, is specified in the
.Fn setsockopt
call when
.Dv SO_LINGER
is requested).
If
.Dv SO_LINGER
is disabled and a
.Xr close 2
is issued, the system will process the close in a manner that allows
the process to continue as quickly as possible.
.Pp
The option
.Dv SO_BROADCAST
requests permission to send broadcast datagrams
on the socket.
Broadcast was a privileged operation in earlier versions of the system.
With protocols that support out-of-band data, the
.Dv SO_OOBINLINE
option requests that out-of-band data be placed in the normal data input
queue as received; it will then be accessible with
.Xr recv 2
or
.Xr read 2
calls without the
.Dv MSG_OOB
flag.
Some protocols always behave as if this option is set.
.Pp
.Dv SO_BINDANY
allows the socket to be bound to addresses
which are not local to the machine, so it
can be used to make a transparent proxy.
Note that this option is limited to the superuser.
In order to receive packets for these addresses,
.Dv SO_BINDANY
needs to be combined with matching outgoing
.Xr pf 4
rules with the
.Ar divert-reply
parameter.
For example, with the following rule the socket receives packets
for 192.168.0.10 even if it is not a local address:
.Pp
.Dl pass out inet from 192.168.0.10 divert-reply
.Pp
.Dv SO_SNDBUF
and
.Dv SO_RCVBUF
are options to adjust the normal
buffer sizes allocated for output and input buffers, respectively.
The buffer size may be increased for high-volume connections,
or may be decreased to limit the possible backlog of incoming data.
The system places an absolute limit on these values.
.Pp
.Dv SO_SNDLOWAT
is an option to set the minimum count for output operations.
Most output operations process all of the data supplied
by the call, delivering data to the protocol for transmission
and blocking as necessary for flow control.
Nonblocking output operations will process as much data as permitted
subject to flow control without blocking, but will process no data
if flow control does not allow the smaller of the low water mark value
or the entire request to be processed.
A
.Xr select 2
or
.Xr poll 2
operation testing the ability to write to a socket will return true
only if the low water mark amount could be processed.
The default value for
.Dv SO_SNDLOWAT
is set to a convenient size for network efficiency, often 1024.
.Dv SO_RCVLOWAT
is an option to set the minimum count for input operations.
In general, receive calls will block until any (non-zero) amount of data
is received, then return with the smaller of the amount available or the amount
requested.
The default value for
.Dv SO_RCVLOWAT
is 1.
If
.Dv SO_RCVLOWAT
is set to a larger value, blocking receive calls normally
wait until they have received the smaller of the low water mark value
or the requested amount.
Receive calls may still return less than the low water mark if an error
occurs, a signal is caught, or the type of data next in the receive queue
is different than that returned.
.Pp
.Dv SO_SNDTIMEO
is an option to set a timeout value for output operations.
It accepts a
.Li struct timeval
parameter with the number of seconds and microseconds
used to limit waits for output operations to complete.
If a send operation has blocked for this much time,
it returns with a partial count or with the error
.Er EWOULDBLOCK
if no data was sent.
In the current implementation, this timer is restarted each time additional
data are delivered to the protocol,
implying that the limit applies to output portions ranging in size
from the low water mark to the high water mark for output.
.Dv SO_RCVTIMEO
is an option to set a timeout value for input operations.
It accepts a
.Li struct timeval
parameter with the number of seconds and microseconds
used to limit waits for input operations to complete.
In the current implementation, this timer is restarted each time additional
data are received by the protocol,
and thus the limit is in effect an inactivity timer.
If a receive operation has been blocked for this much time without
receiving additional data, it returns with a short count
or with the error
.Er EWOULDBLOCK
if no data were received.
.Pp
If the
.Dv SO_TIMESTAMP
option is enabled on a
.Dv SOCK_DGRAM
socket, the
.Xr recvmsg 2
call will return a timestamp corresponding to when the datagram was
received.
The msg_control field in the msghdr structure points to a buffer
that contains a cmsghdr structure followed by a struct timeval.
The cmsghdr fields have the following values:
.Bd -literal -offset indent
cmsg_len = CMSG_LEN(sizeof(struct timeval))
cmsg_level = SOL_SOCKET
cmsg_type = SCM_TIMESTAMP
.Ed
.Pp
.Dv SO_PEERCRED
fetches the
.Va struct sockpeercred
credentials from the other side of the connection
(currently only possible on
.Dv AF_UNIX
sockets).
These credentials are from the time that
.Xr bind 2
or
.Xr connect 2
were called.
.Pp
The
.Dv SO_RTABLE
option gets or sets the routing table which will be used by the socket
for address lookups.
If a protocol family of the socket doesn't support switching routing tables,
the
.Er ENOPROTOOPT
error is returned.
Only the superuser is allowed to change the routing table if it is already
set to a non-zero value.
A socket's chosen routing table is initialized from the process's configuration,
previously selected using
.Xr setrtable 2 .
.Pp
.Dv SO_SPLICE
can splice together two TCP or UDP sockets for unidirectional
zero-copy data transfers.
Splice also the other way around to get bidirectional data flow.
Both sockets must be of the same type.
In the first form,
.Fn setsockopt
is called with the source socket
.Fa s
and the drain socket's
.Vt int
file descriptor as
.Fa optval .
In the second form,
.Fa optval
is a
.Vt struct splice
with the drain socket in
.Va sp_fd ,
a positive maximum number of bytes or 0 in
.Va sp_max
and an idle timeout
.Va sp_idle
in the form of a
.Vt struct timeval .
If \-1 is given as drain socket, the source socket
.Fa s
gets unspliced.
Otherwise the spliced data transfer continues within the kernel
until the optional maximum is reached, one of the connections
terminates, idle timeout expires or an error occurs.
A successful
.Xr select 2 ,
.Xr poll 2 ,
or
.Xr kqueue 2
operation testing the ability to read from the source socket indicates
that the splicing has terminated.
When one of the sockets gets closed, splicing ends.
The error status can be examined with
.Dv SO_ERROR
at the source socket.
The
.Er ELOOP
error is set if userland created a loop by splicing sockets connected
to localhost.
The
.Er ETIMEDOUT
error is set if there was no data transferred between two sockets
during the
.Va sp_idle
period of time.
The
.Er EFBIG
error is set after exactly
.Va sp_max
bytes have been transferred.
Note that if a maximum is given, it is only guaranteed that no more
bytes are transferred.
A short splice can happen, but then a second call to splice will
transfer the remaining data immediately.
The
.Dv SO_SPLICE
option with
.Fn getsockopt
and an
.Vt off_t
value as
.Fa optval
can be used to retrieve the number of bytes transferred so far from the
source socket
.Fa s .
A successful new splice resets this number.
.Pp
Finally,
.Dv SO_TYPE
and
.Dv SO_ERROR
are options used only with
.Fn getsockopt .
.Dv SO_TYPE
returns the type of the socket, such as
.Dv SOCK_STREAM ;
it is useful for servers that inherit sockets on startup.
.Dv SO_ERROR
returns any pending error on the socket and clears the error status.
It may be used to check for asynchronous errors on connected
datagram sockets or for other asynchronous errors.
.Sh RETURN VALUES
.Rv -std
.Sh ERRORS
The call succeeds unless:
.Bl -tag -width Er
.It Bq Er EBADF
The argument
.Fa s
is not a valid descriptor.
.It Bq Er ENOTSOCK
The argument
.Fa s
is a file, not a socket.
.It Bq Er ENOPROTOOPT
The option is unknown at the level indicated.
.It Bq Er EOPNOTSUPP
The option is unsupported.
.It Bq Er EFAULT
The address pointed to by
.Fa optval
is not in a valid part of the process address space.
For
.Fn getsockopt ,
this error may also be returned if
.Fa optlen
is not in a valid part of the process address space.
.El
.Sh SEE ALSO
.Xr connect 2 ,
.Xr getrtable 2 ,
.Xr ioctl 2 ,
.Xr poll 2 ,
.Xr select 2 ,
.Xr socket 2 ,
.Xr getprotoent 3 ,
.Xr divert 4 ,
.Xr pf.conf 5 ,
.Xr protocols 5 ,
.Xr sosplice 9
.Sh STANDARDS
The
.Fn getsockopt
and
.Fn setsockopt
functions conform to
.St -p1003.1-2008 .
.Sh HISTORY
The
.Fn getsockopt
system call appeared in
.Bx 4.2 .
.Sh BUGS
Several of the socket options should be handled at lower levels of the system.
@


1.50
log
@On localhost a user program may create a socket splicing loop.
After writing data into this loop, it was spinning forever causing
a kernel hang.  Detect the loop by counting how often the same mbuf
is spliced.  If that happens 128 times, assume that there is a loop
and abort the splicing with ELOOP.
Bug found by tedu@@;  OK tedu@@ millert@@ benno@@
@
text
@d1 1
a1 1
.\"	$OpenBSD: getsockopt.2,v 1.49 2015/09/04 19:12:31 bluhm Exp $
d33 1
a33 1
.Dd $Mdocdate: September 4 2015 $
d182 2
a183 1
call should allow reuse of local addresses.
d241 1
a241 1
Note that this option is limited to the super-user.
@


1.49
log
@Add missing information to the socket splicing man page to make it
more comprehensible.
OK jmc@@ tedu@@
@
text
@d1 1
a1 1
.\"	$OpenBSD: getsockopt.2,v 1.48 2014/12/16 00:06:49 schwarze Exp $
d33 1
a33 1
.Dd $Mdocdate: December 16 2014 $
d412 4
@


1.48
log
@use .In and delete .Tn; from Kaspars at Bankovskis dot net
@
text
@d1 1
a1 1
.\"	$OpenBSD: getsockopt.2,v 1.47 2014/12/10 19:19:00 schwarze Exp $
d33 1
a33 1
.Dd $Mdocdate: December 10 2014 $
d371 3
a373 1
can splice together two TCP or UDP sockets for zero-copy data transfers.
d408 1
@


1.47
log
@use .Rv; no change of meaning; from Kaspars at Bankovskis dot net
@
text
@d1 1
a1 1
.\"	$OpenBSD: getsockopt.2,v 1.46 2014/04/07 10:04:17 mpi Exp $
d33 1
a33 1
.Dd $Mdocdate: April 7 2014 $
d41 1
a41 1
.Fd #include <sys/socket.h>
d67 1
a67 2
.Tn TCP
protocol,
d69 1
a69 3
should be set to the protocol number of
.Tn TCP ;
see
@


1.46
log
@Retire kernel support for SO_DONTROUTE, this time without breaking
localhost connections.

The plan is to always use the routing table for addresses and routes
resolutions, so there is no future for an option that wants to bypass
it.  This option has never been implemented for IPv6 anyway, so let's
just remove the IPv4 bits that you weren't aware of.

Tested a least by lteo@@, guenther@@ and chrisz@@, ok mikeb@@, benno@@
@
text
@d1 1
a1 1
.\"	$OpenBSD: getsockopt.2,v 1.44 2014/03/27 13:27:28 mpi Exp $
d33 1
a33 1
.Dd $Mdocdate: March 28 2014 $
d455 1
a455 1
A 0 is returned if the call succeeds, \-1 if it fails.
@


1.45
log
@revert "Retire kernel support for SO_DONTROUTE" diff, which does bad things
for localhost connections. discussed with deraadt@@
@
text
@d1 1
a1 1
.\"	$OpenBSD: getsockopt.2,v 1.43 2014/03/06 17:38:28 jmc Exp $
d33 1
a33 1
.Dd $Mdocdate: March 6 2014 $
d145 1
a145 1
enables routing bypass for outgoing messages
a197 5
.Dv SO_DONTROUTE
indicates that outgoing messages should
bypass the standard routing facilities.
Instead, messages are directed to the appropriate network interface
according to the network portion of the destination address.
d469 2
@


1.44
log
@Retire kernel support for SO_DONTROUTE, since the plan is to always
use the routing table there's no future for an option that wants to
bypass it.  This option has never been implemented for IPv6 anyway,
so let's just remove the IPv4 bits that you weren't aware of.

Tested by florian@@, man pages inputs from jmc@@, ok benno@@
@
text
@d145 1
a145 1
enables routing bypass; not supported
d198 5
a473 2
.It Bq Er EOPNOTSUPP
The option is unsupported.
@


1.43
log
@sort SEE ALSO;
@
text
@d1 1
a1 1
.\"	$OpenBSD: getsockopt.2,v 1.42 2014/02/26 21:01:38 claudio Exp $
d33 1
a33 1
.Dd $Mdocdate: February 26 2014 $
d145 1
a145 1
enables routing bypass for outgoing messages
a197 5
.Dv SO_DONTROUTE
indicates that outgoing messages should
bypass the standard routing facilities.
Instead, messages are directed to the appropriate network interface
according to the network portion of the destination address.
d469 2
@


1.42
log
@Try to document SO_RTABLE better. With input from deraadt@@
@
text
@d1 1
a1 1
.\"	$OpenBSD: getsockopt.2,v 1.41 2014/01/21 03:15:45 schwarze Exp $
d33 1
a33 1
.Dd $Mdocdate: January 21 2014 $
d486 1
a490 1
.Xr getrtable 2 ,
@


1.41
log
@obvious .Pa fixes; found with mandocdb(8)
@
text
@d1 1
a1 1
.\"	$OpenBSD: getsockopt.2,v 1.40 2013/06/02 01:07:47 benno Exp $
d33 1
a33 1
.Dd $Mdocdate: June 2 2013 $
d171 1
a171 1
set the routing domain
d366 3
a368 2
option gets or sets a routing domain.
If a protocol family of the socket doesn't support routing domains,
d372 5
d490 1
@


1.40
log
@improve the divert-* description a bit more
ok lteo & jmc
@
text
@d1 1
a1 1
.\"	$OpenBSD: getsockopt.2,v 1.39 2013/04/08 06:26:12 guenther Exp $
d33 1
a33 1
.Dd $Mdocdate: April 8 2013 $
d101 1
a101 1
.Aq Pa sys/socket.h
d118 1
a118 1
.Aq Pa sys/socket.h ,
d127 1
a127 1
.Aq Pa sys/time.h .
@


1.39
log
@Updates to SYNOPSIS, ERRORS, and STANDARDS.
@
text
@d1 1
a1 1
.\"	$OpenBSD: getsockopt.2,v 1.38 2013/01/18 09:41:51 bluhm Exp $
d33 1
a33 1
.Dd $Mdocdate: January 18 2013 $
d253 3
a255 1
divert rules.
@


1.38
log
@Update the setsockopt(2) interface documentation for the EFBIG and
UDP socket splicing changes.
help and OK jmc@@
@
text
@d1 1
a1 1
.\"	$OpenBSD: getsockopt.2,v 1.37 2012/10/21 13:06:02 benno Exp $
d33 1
a33 1
.Dd $Mdocdate: October 21 2012 $
a40 1
.Fd #include <sys/types.h>
d487 7
@


1.37
log
@Add the IP_DIVERTFL socket option on divert(4) sockets to control
which packets (as in direction) of the traffic will be diverted
through the divert socket.
ok claudio@@, henning@@
@
text
@d1 1
a1 1
.\"	$OpenBSD: getsockopt.2,v 1.36 2011/12/23 17:00:47 jmc Exp $
d33 1
a33 1
.Dd $Mdocdate: December 23 2011 $
d372 2
a373 2
can splice together two connected TCP sockets for zero-copy data
transfers.
a406 2
After reaching the maximum, it becomes readable only when more data
is available.
d416 5
d423 1
a423 1
A short splice can happen but then a second call to splice will
a424 2
Also the readability check will not indicate that the maximum has
been reached but that data after the maximum is available.
@


1.36
log
@some spelling fixes, found using freebsd's "igor" document verifier;
@
text
@d1 1
a1 1
.\"	$OpenBSD: getsockopt.2,v 1.35 2011/09/03 22:59:07 jmc Exp $
d33 1
a33 1
.Dd $Mdocdate: September 3 2011 $
d483 1
@


1.35
log
@make -column lists pretty again;

specifically, rewrite them to permit some markup in the column headers,
and use "Ta" instead of literal tabs; mandoc does not currently match groff
100%, but a mandoc fix may be some time off, and we've gone enough releases
with poorly formatting column lists.

in some cases i have rewritten the lists as -tag, where -column made
little sense.
@
text
@d1 1
a1 1
.\"	$OpenBSD: getsockopt.2,v 1.34 2011/07/04 05:52:17 jmc Exp $
d33 1
a33 1
.Dd $Mdocdate: July 4 2011 $
d414 1
a414 1
error is set if there was no data transfered between two sockets
@


1.34
log
@tweak previous;
@
text
@d1 1
a1 1
.\"	$OpenBSD: getsockopt.2,v 1.33 2011/07/04 00:34:43 mikeb Exp $
d135 44
a178 22
.Bl -column SO_OOBINLINE -offset indent
.It Dv SO_DEBUG Ta "enables recording of debugging information"
.It Dv SO_REUSEADDR Ta "enables local address reuse"
.It Dv SO_REUSEPORT Ta "enables duplicate address and port bindings"
.It Dv SO_KEEPALIVE Ta "enables keep connections alive"
.It Dv SO_DONTROUTE Ta "enables routing bypass for outgoing messages"
.It Dv SO_LINGER Ta "linger on close if data present"
.It Dv SO_BROADCAST Ta "enables permission to transmit broadcast messages"
.It Dv SO_OOBINLINE Ta "enables reception of out-of-band data in band"
.It Dv SO_BINDANY Ta "enables binding to any address"
.It Dv SO_SNDBUF Ta "set buffer size for output"
.It Dv SO_RCVBUF Ta "set buffer size for input"
.It Dv SO_SNDLOWAT Ta "set minimum count for output"
.It Dv SO_RCVLOWAT Ta "set minimum count for input"
.It Dv SO_SNDTIMEO Ta "set timeout value for output"
.It Dv SO_RCVTIMEO Ta "set timeout value for input"
.It Dv SO_TIMESTAMP Ta "enables reception of a timestamp with datagrams"
.It Dv SO_PEERCRED Ta "get the credentials from other side of connection"
.It Dv SO_RTABLE Ta "set the routing domain"
.It Dv SO_SPLICE Ta "splice two sockets together or get data length"
.It Dv SO_TYPE Ta "get the type of the socket (get only)"
.It Dv SO_ERROR Ta "get and clear error on the socket (get only)"
@


1.33
log
@Implement an idle timeout for the socket splicing.  A new `sp_idle'
field of the `splice' structure can be used to specify a period of
inactivity after which splicing will be dissolved.  ETIMEDOUT error
retrieved with a SO_ERROR indicates the idle timeout expiration.
With comments from and OK bluhm.
@
text
@d1 1
a1 1
.\"	$OpenBSD: getsockopt.2,v 1.32 2011/05/02 20:18:17 jmc Exp $
d33 1
a33 1
.Dd $Mdocdate: May 2 2011 $
d370 1
a370 1
in a form of a
d390 1
@


1.32
log
@forgotten in previous;
@
text
@d1 1
a1 1
.\"	$OpenBSD: getsockopt.2,v 1.31 2011/05/02 16:45:29 mikeb Exp $
d365 7
a371 3
.Va sp_fd
and a positive maximum number of bytes or 0 in
.Va sp_max .
d377 1
a377 1
terminates or an error occurs.
d390 5
@


1.31
log
@document SO_RTABLE;  with suggestions and ok jmc, claudio
@
text
@d1 1
a1 1
.\"	$OpenBSD: getsockopt.2,v 1.30 2011/04/22 11:59:26 bluhm Exp $
d33 1
a33 1
.Dd $Mdocdate: April 22 2011 $
d343 1
a343 1
option allows to get or set a routing domain.
@


1.30
log
@Clarify SO_SPLICE semantics in setsockopt(2).
ok jmc@@
@
text
@d1 1
a1 1
.\"	$OpenBSD: getsockopt.2,v 1.29 2011/03/08 00:13:41 bluhm Exp $
d33 1
a33 1
.Dd $Mdocdate: March 8 2011 $
d153 1
d340 8
@


1.29
log
@Add a kernel man page sosplice(9) for the socket splicing implementation.
ok jmc@@
@
text
@d1 1
a1 1
.\"	$OpenBSD: getsockopt.2,v 1.28 2011/01/31 13:27:05 bluhm Exp $
d33 1
a33 1
.Dd $Mdocdate: January 31 2011 $
d366 2
a367 1
.Xr select 2
d369 6
a374 4
.Xr poll 2
operation testing the ability to read from the source socket,
indicates that the splicing has terminated.
In this case, the error status can be examined with
@


1.28
log
@Document the kernel option SOCKET_SPLICE and the socket option
SO_SPLICE for zero-copy socket splicing.
ok jmc@@
@
text
@d1 1
a1 1
.\"	$OpenBSD: getsockopt.2,v 1.27 2010/07/01 13:39:19 jmc Exp $
d33 1
a33 1
.Dd $Mdocdate: July 1 2010 $
d440 2
a441 1
.Xr protocols 5
@


1.27
log
@zap trailing whitespace;
@
text
@d1 1
a1 1
.\"	$OpenBSD: getsockopt.2,v 1.26 2010/06/30 19:57:03 deraadt Exp $
d33 1
a33 1
.Dd $Mdocdate: June 30 2010 $
d153 1
d339 53
@


1.26
log
@Add getsockopt SOL_SOCKET SO_PEERCRED support. This behaves similar to
getpeereid(2), but also supplies the remote pid.  This is supplied in
a 'struct sockpeercred' (unlike Linux -- they showed how little they
know about real unix by calling theirs 'struct ucred').
ok guenther ajacoutot
@
text
@d1 1
a1 1
.\"	$OpenBSD: getsockopt.2,v 1.25 2008/05/09 11:58:16 jmc Exp $
d33 1
a33 1
.Dd $Mdocdate: May 9 2008 $
d335 1
a335 1
or 
@


1.25
log
@kill trailing whitespace;
@
text
@d1 1
a1 1
.\"	$OpenBSD: getsockopt.2,v 1.24 2008/05/09 08:24:06 markus Exp $
d152 1
d326 13
a386 5
.Sh STANDARDS
.Dv SO_PEERCRED
is not supported, see
.Xr getpeereid 2
instead.
@


1.24
log
@add SO_BINDANY with pf example; help from jmc, ok beck@@
@
text
@d1 1
a1 1
.\"	$OpenBSD: getsockopt.2,v 1.23 2008/05/02 06:49:31 ckuethe Exp $
d33 1
a33 1
.Dd $Mdocdate$
d220 1
a220 1
.Dv SO_BINDANY 
@


1.23
log
@Make the SO_TIMESTAMP sockopt work. When set, this allows the user to
get a timestamp of when the datagram was accepted (by udp(4), for
example) rather than having to take a timestamp with gettimeofday(2)
when recv(2) returns - possibly several hundreds of microseconds later.
May be of use to those interested in precision network timing schemes
or QoS for media applications. Tested on alpha, amd64, i386 and sparc64.
manpage suggestions from jmc, ok deraadt
@
text
@d1 1
a1 1
.\"	$OpenBSD: getsockopt.2,v 1.22 2007/05/31 19:19:32 jmc Exp $
d33 1
a33 1
.Dd $Mdocdate: May 31 2007 $
d144 1
d219 16
d371 1
@


1.22
log
@convert to new .Dd format;
@
text
@d1 1
a1 1
.\"	$OpenBSD: getsockopt.2,v 1.21 2005/03/07 23:41:53 jmc Exp $
d33 1
a33 1
.Dd $Mdocdate$
d150 1
d290 17
@


1.21
log
@more macro simplification;
@
text
@d1 1
a1 1
.\"	$OpenBSD: getsockopt.2,v 1.20 2003/06/02 20:18:39 millert Exp $
d33 1
a33 1
.Dd February 15, 1999
@


1.20
log
@Remove the advertising clause in the UCB license which Berkeley
rescinded 22 July 1999.  Proofed by myself and Theo.
@
text
@d1 1
a1 1
.\"	$OpenBSD: getsockopt.2,v 1.19 2003/06/01 20:25:23 jmc Exp $
d102 1
a102 1
.Ao Pa sys/socket.h Ac
@


1.19
log
@- section reorder
- merge COMPATIBILITY
- kill whitespace at EOL
@
text
@d1 1
a1 1
.\"	$OpenBSD: getsockopt.2,v 1.18 2002/04/08 23:13:10 espie Exp $
d15 1
a15 5
.\" 3. All advertising materials mentioning features or use of this software
.\"    must display the following acknowledgement:
.\"	This product includes software developed by the University of
.\"	California, Berkeley and its contributors.
.\" 4. Neither the name of the University nor the names of its contributors
@


1.18
log
@.Xr getpeereid.
ok millert@@
@
text
@d1 1
a1 1
.\"	$OpenBSD: getsockopt.2,v 1.17 2002/01/02 15:57:16 mpech Exp $
d145 1
a145 1
.It Dv SO_LINGER  Ta "linger on close if data present"
a332 5
.Sh COMPATIBILITY
.Dv SO_PEERCRED
is not supported, see
.Xr getpeereid 2
instead.
d341 5
a345 2
.Sh BUGS
Several of the socket options should be handled at lower levels of the system.
d351 2
@


1.17
log
@Remove extra reference to poll.2. Spotted by form@@.

millert@@ ok;
@
text
@d1 1
a1 1
.\"	$OpenBSD: getsockopt.2,v 1.16 2000/10/18 05:12:10 aaron Exp $
d333 5
@


1.16
log
@Another round of man page cleanup, this time to remove more hard sentence
breaks and getting rid of short lines, making these files easier to work with.
@
text
@d1 1
a1 1
.\"	$OpenBSD: getsockopt.2,v 1.15 2000/04/15 02:15:24 aaron Exp $
a337 1
.Xr poll 2 ,
@


1.15
log
@Mostly punctuation fixes.
@
text
@d1 1
a1 1
.\"	$OpenBSD: getsockopt.2,v 1.14 1999/08/15 13:14:11 deraadt Exp $
d57 3
a59 2
associated with a socket.  Options may exist at multiple
protocol levels; they are always present at the uppermost
d69 3
a71 4
To manipulate options at any
other level the protocol number of the appropriate protocol
controlling the option is supplied.  For example,
to indicate that an option is to be interpreted by the
d89 2
a90 1
requested option(s) are to be returned.  For
d96 2
a97 3
and modified on return to indicate the actual size of
the value returned.  If no option value is
to be supplied or returned,
d107 3
a109 6
contains definitions for
socket level options, described below.
Options at other protocol levels vary in format and
name; consult the appropriate entries in
section
4 of the manual.
d132 1
a132 1
.Ao Pa sys/time.h Ac .
d161 1
a161 2
indicates that the rules used in validating addresses supplied
in a
d165 1
a165 2
allows completely duplicate bindings by multiple processes
if they all set
d171 3
a173 4
enables the
periodic transmission of messages on a connected socket.  Should the
connected party fail to respond to these messages, the connection is
considered broken and processes using the socket are notified via a
d178 3
a180 3
bypass the standard routing facilities.  Instead, messages are directed
to the appropriate network interface according to the network portion
of the destination address.
d212 2
a213 3
option
requests that out-of-band data be placed in the normal data input queue
as received; it will then be accessible with
d272 1
a272 2
it returns with a partial count
or with the error
d274 1
a274 1
if no data were sent.
d305 1
a305 2
returns any pending error on the socket and clears
the error status.
@


1.14
log
@more poll
@
text
@d1 1
a1 1
.\"	$OpenBSD: getsockopt.2,v 1.13 1999/07/05 06:08:05 aaron Exp $
d194 2
a195 2
.Dv SO_LINGER is set,
the system will block the process on the
@


1.13
log
@use .Li to refer to data types
@
text
@d1 1
a1 1
.\"	$OpenBSD: getsockopt.2,v 1.12 1999/06/29 14:23:29 aaron Exp $
d248 2
d347 1
@


1.12
log
@.Fa int -> .Li int (should use literal macro to refer to data types)
@
text
@d1 1
a1 1
.\"	$OpenBSD: getsockopt.2,v 1.11 1999/06/29 14:10:02 aaron Exp $
d124 1
a124 1
.Fa struct linger
d126 1
a126 1
.Ao Pa sys/socket.h Ac ,
d133 1
a133 1
.Fa struct timeval
d273 1
a273 1
.Fa struct timeval
d288 1
a288 1
.Fa struct timeval
@


1.11
log
@- change references to nil to null; tschroed@@acm.org
- remove trailing spaces from end of lines
- add some .Dv
- change -1 to \-1, so `-' is taken as a negative sign
- other misc formatting fixes
@
text
@d1 1
a1 1
.\"	$OpenBSD: getsockopt.2,v 1.10 1999/05/23 14:10:54 aaron Exp $
d115 1
a115 1
.Fa int
@


1.10
log
@remove argument from .Os macros so value in /usr/share/tmac/mdoc/doc-common
is used instead; kwesterback@@home.com
@
text
@d1 1
a1 1
.\"	$OpenBSD: getsockopt.2,v 1.9 1999/05/16 19:55:27 alex Exp $
d99 2
a100 1
may be NULL.
d190 1
a190 1
are queued on socket and a 
d195 1
a195 1
the system will block the process on the 
d203 1
a203 1
is requested). 
d206 1
a206 1
is disabled and a 
d261 1
a261 1
If 
d316 1
a316 1
A 0 is returned if the call succeeds, -1 if it fails.
d331 1
a331 1
The address pointed to by 
@


1.9
log
@Cleanup xrefs under SEE ALSO.  Specifically:

  - Sort xrefs by section, and then alphabetically.
  - Add missing commas between xref items.
  - Remove commas from the last xref entry.
  - Remove duplicate entries.
@
text
@d1 1
a1 1
.\"	$OpenBSD: getsockopt.2,v 1.8 1999/02/27 21:56:24 deraadt Exp $
d39 1
a39 1
.Os BSD 4.3r
@


1.8
log
@make function names the correct case
@
text
@d1 1
a1 1
.\"	$OpenBSD: getsockopt.2,v 1.7 1999/02/15 19:04:21 millert Exp $
d340 1
a341 1
.Xr socket 2 ,
d344 1
a344 1
.Xr connect 2 ,
@


1.7
log
@Use and document socklen_t
@
text
@d1 1
a1 1
.\"	$OpenBSD: getsockopt.2,v 1.6 1998/08/17 17:35:11 deraadt Exp $
d52 1
a52 1
.Fn Getsockopt
d101 1
a101 1
.Fa Optname
@


1.6
log
@Xr poll
@
text
@d1 1
a1 1
.\"	$OpenBSD: getsockopt.2,v 1.5 1998/07/06 18:27:39 deraadt Exp $
d37 1
a37 1
.Dd April 19, 1994
d48 1
a48 1
.Fn getsockopt "int s" "int level" "int optname" "void *optval" "int *optlen"
d50 1
a50 1
.Fn setsockopt "int s" "int level" "int optname" "const void *optval" "int optlen"
@


1.5
log
@fix openbsd tag
@
text
@d1 1
a1 1
.\"	$OpenBSD: getsockopt.2,v 1.7 1995/02/27 12:33:29 cgd Exp $
d342 2
@


1.4
log
@so_linger is in seconds
@
text
@d1 1
@


1.3
log
@Xr nice
@
text
@d196 2
a197 2
is unable to deliver the information (a timeout period, termed the
linger interval, is specified in the
@


1.2
log
@fix lots of .Xr and other minor things
@
text
@d341 1
@


1.1
log
@Initial revision
@
text
@d194 1
a194 1
.Xr close
d205 1
a205 1
.Xr close
d219 1
a219 1
.Xr recv
d221 1
a221 1
.Xr read
d341 1
a341 1
.Xr getprotoent 3
@


1.1.1.1
log
@initial import of NetBSD tree
@
text
@@
