head	1.22;
access;
symbols
	OPENBSD_6_1:1.22.0.6
	OPENBSD_6_1_BASE:1.22
	OPENBSD_6_0:1.22.0.4
	OPENBSD_6_0_BASE:1.22
	OPENBSD_5_9:1.22.0.2
	OPENBSD_5_9_BASE:1.22
	OPENBSD_5_8:1.21.0.6
	OPENBSD_5_8_BASE:1.21
	OPENBSD_5_7:1.21.0.2
	OPENBSD_5_7_BASE:1.21
	OPENBSD_5_6:1.19.0.8
	OPENBSD_5_6_BASE:1.19
	OPENBSD_5_5:1.19.0.6
	OPENBSD_5_5_BASE:1.19
	OPENBSD_5_4:1.19.0.2
	OPENBSD_5_4_BASE:1.19
	OPENBSD_5_3:1.16.0.8
	OPENBSD_5_3_BASE:1.16
	OPENBSD_5_2:1.16.0.6
	OPENBSD_5_2_BASE:1.16
	OPENBSD_5_1_BASE:1.16
	OPENBSD_5_1:1.16.0.4
	OPENBSD_5_0:1.16.0.2
	OPENBSD_5_0_BASE:1.16
	OPENBSD_4_9:1.14.0.10
	OPENBSD_4_9_BASE:1.14
	OPENBSD_4_8:1.14.0.8
	OPENBSD_4_8_BASE:1.14
	OPENBSD_4_7:1.14.0.4
	OPENBSD_4_7_BASE:1.14
	OPENBSD_4_6:1.14.0.6
	OPENBSD_4_6_BASE:1.14
	OPENBSD_4_5:1.14.0.2
	OPENBSD_4_5_BASE:1.14
	OPENBSD_4_4:1.13.0.6
	OPENBSD_4_4_BASE:1.13
	OPENBSD_4_3:1.13.0.4
	OPENBSD_4_3_BASE:1.13
	OPENBSD_4_2:1.13.0.2
	OPENBSD_4_2_BASE:1.13
	OPENBSD_4_1:1.12.0.6
	OPENBSD_4_1_BASE:1.12
	OPENBSD_4_0:1.12.0.4
	OPENBSD_4_0_BASE:1.12
	OPENBSD_3_9:1.12.0.2
	OPENBSD_3_9_BASE:1.12
	OPENBSD_3_8:1.11.0.10
	OPENBSD_3_8_BASE:1.11
	OPENBSD_3_7:1.11.0.8
	OPENBSD_3_7_BASE:1.11
	OPENBSD_3_6:1.11.0.6
	OPENBSD_3_6_BASE:1.11
	OPENBSD_3_5:1.11.0.4
	OPENBSD_3_5_BASE:1.11
	OPENBSD_3_4:1.11.0.2
	OPENBSD_3_4_BASE:1.11
	OPENBSD_3_3:1.9.0.6
	OPENBSD_3_3_BASE:1.9
	OPENBSD_3_2:1.9.0.4
	OPENBSD_3_2_BASE:1.9
	OPENBSD_3_1:1.9.0.2
	OPENBSD_3_1_BASE:1.9
	OPENBSD_3_0:1.8.0.6
	OPENBSD_3_0_BASE:1.8
	OPENBSD_2_9:1.8.0.4
	OPENBSD_2_9_BASE:1.8
	OPENBSD_2_8:1.8.0.2
	OPENBSD_2_8_BASE:1.8
	OPENBSD_2_7:1.7.0.4
	OPENBSD_2_7_BASE:1.7
	OPENBSD_2_6:1.7.0.2
	OPENBSD_2_6_BASE:1.7
	OPENBSD_2_5:1.4.0.2
	OPENBSD_2_5_BASE:1.4
	OPENBSD_2_4:1.2.0.2
	OPENBSD_2_4_BASE:1.2
	OPENBSD_2_3:1.1.1.1.0.8
	OPENBSD_2_3_BASE:1.1.1.1
	OPENBSD_2_2:1.1.1.1.0.6
	OPENBSD_2_2_BASE:1.1.1.1
	OPENBSD_2_1:1.1.1.1.0.4
	OPENBSD_2_1_BASE:1.1.1.1
	OPENBSD_2_0:1.1.1.1.0.2
	OPENBSD_2_0_BASE:1.1.1.1
	netbsd_1_1:1.1.1.1;
locks; strict;
comment	@.\" @;


1.22
date	2015.09.10.17.55.21;	author schwarze;	state Exp;
branches;
next	1.21;
commitid	PeV7Ql0T6htfMjhP;

1.21
date	2015.01.19.15.54.11;	author millert;	state Exp;
branches;
next	1.20;
commitid	nJ2wjGsUe8RwMTRS;

1.20
date	2014.12.10.19.19.00;	author schwarze;	state Exp;
branches;
next	1.19;
commitid	sADK4BTCz4ZrHHo9;

1.19
date	2013.05.08.16.13.12;	author tedu;	state Exp;
branches;
next	1.18;

1.18
date	2013.04.01.20.16.31;	author guenther;	state Exp;
branches;
next	1.17;

1.17
date	2013.03.31.05.07.55;	author guenther;	state Exp;
branches;
next	1.16;

1.16
date	2011.07.19.07.06.22;	author jmc;	state Exp;
branches;
next	1.15;

1.15
date	2011.07.18.23.04.40;	author matthew;	state Exp;
branches;
next	1.14;

1.14
date	2008.10.24.14.34.39;	author jmc;	state Exp;
branches;
next	1.13;

1.13
date	2007.05.31.19.19.33;	author jmc;	state Exp;
branches;
next	1.12;

1.12
date	2005.10.19.18.27.05;	author jaredy;	state Exp;
branches;
next	1.11;

1.11
date	2003.07.15.10.09.21;	author jmc;	state Exp;
branches;
next	1.10;

1.10
date	2003.06.02.20.18.39;	author millert;	state Exp;
branches;
next	1.9;

1.9
date	2002.03.10.17.15.42;	author millert;	state Exp;
branches;
next	1.8;

1.8
date	2000.10.18.05.12.11;	author aaron;	state Exp;
branches;
next	1.7;

1.7
date	99.06.29.14.10.16;	author aaron;	state Exp;
branches;
next	1.6;

1.6
date	99.05.23.14.10.55;	author aaron;	state Exp;
branches;
next	1.5;

1.5
date	99.05.16.19.55.34;	author alex;	state Exp;
branches;
next	1.4;

1.4
date	99.02.27.21.56.42;	author deraadt;	state Exp;
branches;
next	1.3;

1.3
date	99.02.26.19.36.12;	author csapuntz;	state Exp;
branches;
next	1.2;

1.2
date	98.07.06.18.28.19;	author deraadt;	state Exp;
branches;
next	1.1;

1.1
date	95.10.18.08.42.28;	author deraadt;	state Exp;
branches
	1.1.1.1;
next	;

1.1.1.1
date	95.10.18.08.42.28;	author deraadt;	state Exp;
branches;
next	;


desc
@@


1.22
log
@use .In rather than .Fd #include
@
text
@.\"	$OpenBSD: rename.2,v 1.21 2015/01/19 15:54:11 millert Exp $
.\"	$NetBSD: rename.2,v 1.7 1995/02/27 12:36:15 cgd Exp $
.\"
.\" Copyright (c) 1983, 1991, 1993
.\"	The Regents of the University of California.  All rights reserved.
.\"
.\" Redistribution and use in source and binary forms, with or without
.\" modification, are permitted provided that the following conditions
.\" are met:
.\" 1. Redistributions of source code must retain the above copyright
.\"    notice, this list of conditions and the following disclaimer.
.\" 2. Redistributions in binary form must reproduce the above copyright
.\"    notice, this list of conditions and the following disclaimer in the
.\"    documentation and/or other materials provided with the distribution.
.\" 3. Neither the name of the University nor the names of its contributors
.\"    may be used to endorse or promote products derived from this software
.\"    without specific prior written permission.
.\"
.\" THIS SOFTWARE IS PROVIDED BY THE REGENTS AND CONTRIBUTORS ``AS IS'' AND
.\" ANY EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT LIMITED TO, THE
.\" IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE
.\" ARE DISCLAIMED.  IN NO EVENT SHALL THE REGENTS OR CONTRIBUTORS BE LIABLE
.\" FOR ANY DIRECT, INDIRECT, INCIDENTAL, SPECIAL, EXEMPLARY, OR CONSEQUENTIAL
.\" DAMAGES (INCLUDING, BUT NOT LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS
.\" OR SERVICES; LOSS OF USE, DATA, OR PROFITS; OR BUSINESS INTERRUPTION)
.\" HOWEVER CAUSED AND ON ANY THEORY OF LIABILITY, WHETHER IN CONTRACT, STRICT
.\" LIABILITY, OR TORT (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY
.\" OUT OF THE USE OF THIS SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF
.\" SUCH DAMAGE.
.\"
.\"     @@(#)rename.2	8.1 (Berkeley) 6/4/93
.\"
.Dd $Mdocdate: January 19 2015 $
.Dt RENAME 2
.Os
.Sh NAME
.Nm rename ,
.Nm renameat
.Nd change the name of a file
.Sh SYNOPSIS
.In stdio.h
.Ft int
.Fn rename "const char *from" "const char *to"
.In fcntl.h
.In stdio.h
.Ft int
.Fn renameat "int fromfd" "const char *from" "int tofd" "const char *to"
.Sh DESCRIPTION
The
.Fn rename
function causes the link named
.Fa from
to be renamed as
.Fa to .
If
.Fa to
exists, it is first removed.
Both
.Fa from
and
.Fa to
must be of the same type (that is, both directories or both
non-directories), and must reside on the same file system.
.Pp
.Fn rename
guarantees that if
.Fa to
already exists, an instance of
.Fa to
will always exist, even if the system should crash in
the middle of the operation.
.Pp
If the final component of
.Fa from
is a symbolic link,
the symbolic link is renamed,
not the file or directory to which it points.
.Pp
The
.Fn renameat
function is equivalent to
.Fn rename
except that where
.Fa from
or
.Fa to
specifies a relative path,
the directory entry names used are resolved relative to
the directories associated with file descriptors
.Fa fromfd
or
.Fa tofd
(respectively) instead of the current working directory.
.Pp
If
.Fn renameat
is passed the special value
.Dv AT_FDCWD
(defined in
.In fcntl.h )
in the
.Fa fromfd
or
.Fa tofd
parameter, the current working directory is used for resolving the respective
.Fa from
or
.Fa to
argument.
.Sh RETURN VALUES
.Rv -std
.Sh ERRORS
.Fn rename
and
.Fn renameat
will fail and neither of the argument files will be
affected if:
.Bl -tag -width Er
.It Bq Er ENAMETOOLONG
A component of a pathname exceeded
.Dv NAME_MAX
characters, or an entire pathname (including the terminating NUL)
exceeded
.Dv PATH_MAX
bytes.
.It Bq Er ENOENT
A component of the
.Fa from
path does not exist,
or a path prefix of
.Fa to
does not exist.
.It Bq Er EACCES
A component of either path prefix denies search permission.
.It Bq Er EACCES
The requested change requires writing in a directory that denies write
permission.
.It Bq Er EACCES
The
.Fa from
argument is a directory and denies write permission.
.It Bq Er EPERM
The directory containing
.Fa from
is marked sticky,
and neither the containing directory nor
.Fa from
are owned by the effective user ID.
.It Bq Er EPERM
The
.Fa to
file exists,
the directory containing
.Fa to
is marked sticky,
and neither the containing directory nor
.Fa to
are owned by the effective user ID.
.It Bq Er ELOOP
Too many symbolic links were encountered in translating either pathname.
.It Bq Er EMLINK
The link count on the source file or destination directory is at the maximum.
A rename cannot be completed under these conditions.
.It Bq Er ENOTDIR
A component of either path prefix is not a directory.
.It Bq Er ENOTDIR
.Fa from
is a directory, but
.Fa to
is not a directory.
.It Bq Er EISDIR
.Fa to
is a directory, but
.Fa from
is not a directory.
.It Bq Er EXDEV
The link named by
.Fa to
and the file named by
.Fa from
are on different logical devices (file systems).
Note that this error code will not be returned if the implementation
permits cross-device links.
.It Bq Er ENOSPC
The directory in which the entry for the new name is being placed
cannot be extended because there is no space left on the file
system containing the directory.
.It Bq Er EDQUOT
The directory in which the entry for the new name
is being placed cannot be extended because the
user's quota of disk blocks on the file system
containing the directory has been exhausted.
.It Bq Er EIO
An I/O error occurred while making or updating a directory entry.
.It Bq Er EROFS
The requested link requires writing in a directory on a read-only file
system.
.It Bq Er EFAULT
.Fa from
or
.Fa to
points outside the process's allocated address space.
.It Bq Er EINVAL
.Fa from
is a parent directory of
.Fa to ,
or an attempt is made to rename
.Ql \&.
or
.Ql \&.. .
.It Bq Er ENOTEMPTY
.Fa to
is a directory and is not empty.
.El
.Pp
Additionally,
.Fn renameat
will fail if:
.Bl -tag -width Er
.It Bq Er EBADF
The
.Fa from
or
.Fa to
argument specifies a relative path and the
.Fa fromfd
or
.Fa tofd
argument, respectively, is neither
.Dv AT_FDCWD
nor a valid file descriptor.
.It Bq Er ENOTDIR
The
.Fa from
or
.Fa to
argument specifies a relative path and the
.Fa fromfd
or
.Fa tofd
argument, respectively,
is a valid file descriptor but it does not reference a directory.
.It Bq Er EACCES
The
.Fa from
or
.Fa to
argument specifies a relative path but search permission is denied
for the directory which the
.Fa fromfd
or
.Fa tofd
file descriptor, respectively, references.
.El
.Sh SEE ALSO
.Xr mv 1 ,
.Xr open 2 ,
.Xr symlink 7
.Sh STANDARDS
The
.Fn rename
and
.Fn renameat
functions conform to
.St -p1003.1-2008 .
.Sh HISTORY
The
.Fn renameat
function appeared in
.Ox 5.0 .
.Sh CAVEATS
The system can deadlock if a loop in the file system graph is present.
This loop takes the form of an entry in directory
.Sq Pa a ,
say
.Sq Pa a/foo ,
being a hard link to directory
.Sq Pa b ,
and an entry in
directory
.Sq Pa b ,
say
.Sq Pa b/bar ,
being a hard link
to directory
.Sq Pa a .
When such a loop exists and two separate processes attempt to
perform
.Ql rename a/foo b/bar
and
.Ql rename b/bar a/foo ,
respectively,
the system may deadlock attempting to lock
both directories for modification.
Hard links to directories should be
replaced by symbolic links by the system administrator.
@


1.21
log
@Explicitly mention that PATH_MAX includes the NUL in the ENAMETOOLONG
description.
@
text
@d1 1
a1 1
.\"	$OpenBSD: rename.2,v 1.20 2014/12/10 19:19:00 schwarze Exp $
d33 1
a33 1
.Dd $Mdocdate: December 10 2014 $
d41 1
a41 1
.Fd #include <stdio.h>
d44 2
a45 2
.Fd #include <fcntl.h>
.Fd #include <stdio.h>
@


1.20
log
@use .Rv; no change of meaning; from Kaspars at Bankovskis dot net
@
text
@d1 1
a1 1
.\"	$OpenBSD: rename.2,v 1.19 2013/05/08 16:13:12 tedu Exp $
d33 1
a33 1
.Dd $Mdocdate: May 8 2013 $
d121 5
a125 4
.Dv {NAME_MAX}
characters, or an entire path name exceeded
.Dv {PATH_MAX}
characters.
@


1.19
log
@clarify when EACCESS can fail. if from is read only, you're out of luck.
failure to document this case noticed by Mike Small
@
text
@d1 1
a1 1
.\"	$OpenBSD: rename.2,v 1.18 2013/04/01 20:16:31 guenther Exp $
d33 1
a33 1
.Dd $Mdocdate: April 1 2013 $
d111 1
a111 5
A 0 value is returned if the operation succeeds, otherwise
.Fn rename
returns \-1 and the global variable
.Va errno
indicates the reason for the failure.
@


1.18
log
@When there are multiple groups of functions with their own #includes
listed, the #includes in each group are independent, so that users
don't need to guess at possible carry-over.

general idea ok otto@@ millert@@
actual diff ok jmc@@ schwarze@@
@
text
@d1 1
a1 1
.\"	$OpenBSD: rename.2,v 1.17 2013/03/31 05:07:55 guenther Exp $
d33 1
a33 1
.Dd $Mdocdate: March 31 2013 $
d139 6
a144 2
The requested link requires writing in a directory with a mode
that denies write permission.
@


1.17
log
@Use consistent wording for the EINVAL, EBADF, ENOTDIR, and EACCES cases
of the various *at() functions.
@
text
@d1 1
a1 1
.\"	$OpenBSD: rename.2,v 1.16 2011/07/19 07:06:22 jmc Exp $
d33 1
a33 1
.Dd $Mdocdate: July 19 2011 $
a40 1
.Fd #include <fcntl.h>
d44 2
@


1.16
log
@knock out some useless Pp;
@
text
@d1 1
a1 1
.\"	$OpenBSD: rename.2,v 1.15 2011/07/18 23:04:40 matthew Exp $
d33 1
a33 1
.Dd $Mdocdate: July 18 2011 $
d223 1
a223 1
argument does not specify an absolute path and
d226 2
a227 2
.Fa tofd ,
respectively, is neither
d229 23
a251 1
nor a valid file descriptor open for reading.
@


1.15
log
@Add (rough draft) documentation for fdopendir(3) and the 15 new
XXXat(2) system calls from POSIX 2008.  Editing will be done in tree.

General style discussed with jmc@@, schwarze@@, and deraadt@@
ok jmc@@
@
text
@d1 1
a1 1
.\"	$OpenBSD: rename.2,v 1.14 2008/10/24 14:34:39 jmc Exp $
d33 1
a33 1
.Dd $Mdocdate: October 24 2008 $
a230 1
.Pp
@


1.14
log
@some SEE ALSO additions from Ingo Schwarze;
@
text
@d1 1
a1 1
.\"	$OpenBSD: rename.2,v 1.13 2007/05/31 19:19:33 jmc Exp $
d33 1
a33 1
.Dd $Mdocdate: May 31 2007 $
d37 2
a38 1
.Nm rename
d41 1
d45 2
d48 1
d50 1
a50 1
causes the link named
d77 32
d117 2
d213 19
d239 9
a247 2
function conforms to
.St -p1003.1-88 .
@


1.13
log
@convert to new .Dd format;
@
text
@d1 1
a1 1
.\"	$OpenBSD: rename.2,v 1.12 2005/10/19 18:27:05 jaredy Exp $
d33 1
a33 1
.Dd $Mdocdate$
d175 1
@


1.12
log
@EFAULT corrections; ok millert and otto
@
text
@d1 1
a1 1
.\"	$OpenBSD: rename.2,v 1.11 2003/07/15 10:09:21 jmc Exp $
d33 1
a33 1
.Dd June 4, 1993
@


1.11
log
@.Ql Pa -> .Sq Pa  where literal makes no sense;
@
text
@d1 1
a1 1
.\"	$OpenBSD: rename.2,v 1.10 2003/06/02 20:18:39 millert Exp $
d158 3
a160 1
.Em Path
@


1.10
log
@Remove the advertising clause in the UCB license which Berkeley
rescinded 22 July 1999.  Proofed by myself and Theo.
@
text
@d1 1
a1 1
.\"	$OpenBSD: rename.2,v 1.9 2002/03/10 17:15:42 millert Exp $
d183 1
a183 1
.Ql Pa a ,
d185 1
a185 1
.Ql Pa a/foo ,
d187 1
a187 1
.Ql Pa b ,
d190 1
a190 1
.Ql Pa b ,
d192 1
a192 1
.Ql Pa b/bar ,
d195 1
a195 1
.Ql Pa a .
@


1.9
log
@Clarify rename(2) behavior in the presence of a system crash.
From FreeBSD by way of Claus Assmann.
@
text
@d1 1
a1 1
.\"	$OpenBSD: rename.2,v 1.8 2000/10/18 05:12:11 aaron Exp $
d15 1
a15 5
.\" 3. All advertising materials mentioning features or use of this software
.\"    must display the following acknowledgement:
.\"	This product includes software developed by the University of
.\"	California, Berkeley and its contributors.
.\" 4. Neither the name of the University nor the names of its contributors
@


1.8
log
@Another round of man page cleanup, this time to remove more hard sentence
breaks and getting rid of short lines, making these files easier to work with.
@
text
@d1 1
a1 1
.\"	$OpenBSD: rename.2,v 1.7 1999/06/29 14:10:16 aaron Exp $
d64 3
a66 1
guarantees that an instance of
@


1.7
log
@- change references to nil to null; tschroed@@acm.org
- remove trailing spaces from end of lines
- add some .Dv
- change -1 to \-1, so `-' is taken as a negative sign
- other misc formatting fixes
@
text
@d1 1
a1 1
.\"	$OpenBSD: rename.2,v 1.6 1999/05/23 14:10:55 aaron Exp $
a73 26
.Sh CAVEAT
The system can deadlock if a loop in the file system graph is present.
This loop takes the form of an entry in directory
.Ql Pa a ,
say
.Ql Pa a/foo ,
being a hard link to directory
.Ql Pa b ,
and an entry in
directory
.Ql Pa b ,
say
.Ql Pa b/bar ,
being a hard link
to directory
.Ql Pa a .
When such a loop exists and two separate processes attempt to
perform
.Ql rename a/foo b/bar
and
.Ql rename b/bar a/foo ,
respectively,
the system may deadlock attempting to lock
both directories for modification.
Hard links to directories should be
replaced by symbolic links by the system administrator.
d142 3
a144 3
are on different logical devices (file systems).  Note that this error
code will not be returned if the implementation permits cross-device
links.
d182 26
@


1.6
log
@remove argument from .Os macros so value in /usr/share/tmac/mdoc/doc-common
is used instead; kwesterback@@home.com
@
text
@d1 1
a1 1
.\"	$OpenBSD: rename.2,v 1.5 1999/05/16 19:55:34 alex Exp $
d53 1
a53 1
If 
d56 1
a56 1
Both 
d95 1
a95 1
respectively, 
d103 1
a103 1
returns -1 and the global variable 
d112 1
a112 1
A component of a pathname exceeded 
d114 1
a114 1
characters, or an entire path name exceeded 
d206 1
a206 1
function conforms to 
@


1.5
log
@Cleanup xrefs under SEE ALSO.  Specifically:

  - Sort xrefs by section, and then alphabetically.
  - Add missing commas between xref items.
  - Remove commas from the last xref entry.
  - Remove duplicate entries.
@
text
@d1 1
a1 1
.\"	$OpenBSD: rename.2,v 1.4 1999/02/27 21:56:42 deraadt Exp $
d39 1
a39 1
.Os BSD 4.2
@


1.4
log
@make function names the correct case
@
text
@d1 1
a1 1
.\"	$OpenBSD: rename.2,v 1.3 1999/02/26 19:36:12 csapuntz Exp $
d201 1
a201 1
.Xr open 2
@


1.3
log
@

Add EMLINK error message
@
text
@d1 1
a1 1
.\"	$OpenBSD: rename.2,v 1.2 1998/07/06 18:28:19 deraadt Exp $
d48 1
a48 1
.Fn Rename
d63 1
a63 1
.Fn Rename
d107 1
a107 1
.Fn Rename
d189 1
a189 1
.Fa From
d197 1
a197 1
.Fa To
@


1.2
log
@fix openbsd tag
@
text
@d1 1
a1 1
.\"	$OpenBSD: rename.2,v 1.7 1995/02/27 12:36:15 cgd Exp $
d148 3
@


1.1
log
@Initial revision
@
text
@d1 1
@


1.1.1.1
log
@initial import of NetBSD tree
@
text
@@
