head	1.22;
access;
symbols
	OPENBSD_6_1:1.22.0.2
	OPENBSD_6_1_BASE:1.22
	OPENBSD_6_0:1.20.0.2
	OPENBSD_6_0_BASE:1.20
	OPENBSD_5_9:1.19.0.6
	OPENBSD_5_9_BASE:1.19
	OPENBSD_5_8:1.19.0.8
	OPENBSD_5_8_BASE:1.19
	OPENBSD_5_7:1.19.0.2
	OPENBSD_5_7_BASE:1.19
	OPENBSD_5_6:1.19.0.4
	OPENBSD_5_6_BASE:1.19
	OPENBSD_5_5:1.17.0.4
	OPENBSD_5_5_BASE:1.17
	OPENBSD_5_4:1.16.0.2
	OPENBSD_5_4_BASE:1.16
	OPENBSD_5_3:1.15.0.14
	OPENBSD_5_3_BASE:1.15
	OPENBSD_5_2:1.15.0.12
	OPENBSD_5_2_BASE:1.15
	OPENBSD_5_1_BASE:1.15
	OPENBSD_5_1:1.15.0.10
	OPENBSD_5_0:1.15.0.8
	OPENBSD_5_0_BASE:1.15
	OPENBSD_4_9:1.15.0.6
	OPENBSD_4_9_BASE:1.15
	OPENBSD_4_8:1.15.0.4
	OPENBSD_4_8_BASE:1.15
	OPENBSD_4_7:1.15.0.2
	OPENBSD_4_7_BASE:1.15
	OPENBSD_4_6:1.14.0.12
	OPENBSD_4_6_BASE:1.14
	OPENBSD_4_5:1.14.0.8
	OPENBSD_4_5_BASE:1.14
	OPENBSD_4_4:1.14.0.6
	OPENBSD_4_4_BASE:1.14
	OPENBSD_4_3:1.14.0.4
	OPENBSD_4_3_BASE:1.14
	OPENBSD_4_2:1.14.0.2
	OPENBSD_4_2_BASE:1.14
	OPENBSD_4_1:1.13.0.6
	OPENBSD_4_1_BASE:1.13
	OPENBSD_4_0:1.13.0.4
	OPENBSD_4_0_BASE:1.13
	OPENBSD_3_9:1.13.0.2
	OPENBSD_3_9_BASE:1.13
	OPENBSD_3_8:1.10.0.6
	OPENBSD_3_8_BASE:1.10
	OPENBSD_3_7:1.10.0.4
	OPENBSD_3_7_BASE:1.10
	OPENBSD_3_6:1.10.0.2
	OPENBSD_3_6_BASE:1.10
	OPENBSD_3_5:1.9.0.4
	OPENBSD_3_5_BASE:1.9
	OPENBSD_3_4:1.9.0.2
	OPENBSD_3_4_BASE:1.9
	OPENBSD_3_3:1.8.0.6
	OPENBSD_3_3_BASE:1.8
	OPENBSD_3_2:1.8.0.4
	OPENBSD_3_2_BASE:1.8
	OPENBSD_3_1:1.8.0.2
	OPENBSD_3_1_BASE:1.8
	OPENBSD_3_0:1.7.0.10
	OPENBSD_3_0_BASE:1.7
	OPENBSD_2_9:1.7.0.8
	OPENBSD_2_9_BASE:1.7
	OPENBSD_2_8:1.7.0.6
	OPENBSD_2_8_BASE:1.7
	OPENBSD_2_7:1.7.0.4
	OPENBSD_2_7_BASE:1.7
	OPENBSD_2_6:1.7.0.2
	OPENBSD_2_6_BASE:1.7
	OPENBSD_2_5:1.6.0.4
	OPENBSD_2_5_BASE:1.6
	OPENBSD_2_4:1.6.0.2
	OPENBSD_2_4_BASE:1.6
	OPENBSD_2_3:1.4.0.2
	OPENBSD_2_3_BASE:1.4
	OPENBSD_2_2:1.3.0.6
	OPENBSD_2_2_BASE:1.3
	OPENBSD_2_1:1.3.0.4
	OPENBSD_2_1_BASE:1.3
	OPENBSD_2_0:1.3.0.2
	OPENBSD_2_0_BASE:1.3
	netbsd_1_1:1.1.1.1;
locks; strict;
comment	@.\" @;


1.22
date	2017.03.11.22.58.46;	author jmc;	state Exp;
branches;
next	1.21;
commitid	3Wx5sY3PjUtTOUcj;

1.21
date	2017.03.11.05.54.30;	author deraadt;	state Exp;
branches;
next	1.20;
commitid	HdaVd8ZoSUBKlUY9;

1.20
date	2016.05.27.19.45.04;	author deraadt;	state Exp;
branches;
next	1.19;
commitid	nQEqvpt7rKDi6fz0;

1.19
date	2014.07.02.22.22.35;	author matthew;	state Exp;
branches;
next	1.18;
commitid	cXzdthTwYzgYTwmX;

1.18
date	2014.07.02.19.08.40;	author matthew;	state Exp;
branches;
next	1.17;
commitid	ukug7jO3A2aW5WqV;

1.17
date	2014.02.13.07.30.39;	author guenther;	state Exp;
branches;
next	1.16;

1.16
date	2013.03.31.08.28.21;	author guenther;	state Exp;
branches;
next	1.15;

1.15
date	2010.02.12.21.49.10;	author jmc;	state Exp;
branches;
next	1.14;

1.14
date	2007.05.31.19.19.33;	author jmc;	state Exp;
branches;
next	1.13;

1.13
date	2006.01.18.18.35.57;	author tom;	state Exp;
branches;
next	1.12;

1.12
date	2006.01.18.11.15.33;	author jmc;	state Exp;
branches;
next	1.11;

1.11
date	2006.01.18.02.25.46;	author deraadt;	state Exp;
branches;
next	1.10;

1.10
date	2004.04.15.19.52.18;	author jmc;	state Exp;
branches;
next	1.9;

1.9
date	2003.06.02.20.18.39;	author millert;	state Exp;
branches;
next	1.8;

1.8
date	2001.10.24.14.09.53;	author jjbg;	state Exp;
branches;
next	1.7;

1.7
date	99.06.29.14.10.08;	author aaron;	state Exp;
branches;
next	1.6;

1.6
date	98.07.06.18.28.00;	author deraadt;	state Exp;
branches;
next	1.5;

1.5
date	98.06.15.17.55.26;	author mickey;	state Exp;
branches;
next	1.4;

1.4
date	97.11.14.20.56.12;	author deraadt;	state Exp;
branches;
next	1.3;

1.3
date	96.08.15.23.50.43;	author deraadt;	state Exp;
branches;
next	1.2;

1.2
date	95.12.14.02.21.17;	author deraadt;	state Exp;
branches;
next	1.1;

1.1
date	95.10.18.08.42.27;	author deraadt;	state Exp;
branches
	1.1.1.1;
next	;

1.1.1.1
date	95.10.18.08.42.27;	author deraadt;	state Exp;
branches;
next	;


desc
@@


1.22
log
@shuffle back: wxabort is described in sysctl(3);
@
text
@.\"	$OpenBSD: mprotect.2,v 1.21 2017/03/11 05:54:30 deraadt Exp $
.\"	$NetBSD: mprotect.2,v 1.6 1995/10/12 15:41:08 jtc Exp $
.\"
.\" Copyright (c) 1991, 1993
.\"	The Regents of the University of California.  All rights reserved.
.\"
.\" Redistribution and use in source and binary forms, with or without
.\" modification, are permitted provided that the following conditions
.\" are met:
.\" 1. Redistributions of source code must retain the above copyright
.\"    notice, this list of conditions and the following disclaimer.
.\" 2. Redistributions in binary form must reproduce the above copyright
.\"    notice, this list of conditions and the following disclaimer in the
.\"    documentation and/or other materials provided with the distribution.
.\" 3. Neither the name of the University nor the names of its contributors
.\"    may be used to endorse or promote products derived from this software
.\"    without specific prior written permission.
.\"
.\" THIS SOFTWARE IS PROVIDED BY THE REGENTS AND CONTRIBUTORS ``AS IS'' AND
.\" ANY EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT LIMITED TO, THE
.\" IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE
.\" ARE DISCLAIMED.  IN NO EVENT SHALL THE REGENTS OR CONTRIBUTORS BE LIABLE
.\" FOR ANY DIRECT, INDIRECT, INCIDENTAL, SPECIAL, EXEMPLARY, OR CONSEQUENTIAL
.\" DAMAGES (INCLUDING, BUT NOT LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS
.\" OR SERVICES; LOSS OF USE, DATA, OR PROFITS; OR BUSINESS INTERRUPTION)
.\" HOWEVER CAUSED AND ON ANY THEORY OF LIABILITY, WHETHER IN CONTRACT, STRICT
.\" LIABILITY, OR TORT (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY
.\" OUT OF THE USE OF THIS SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF
.\" SUCH DAMAGE.
.\"
.\"	@@(#)mprotect.2	8.1 (Berkeley) 6/9/93
.\"
.Dd $Mdocdate: March 11 2017 $
.Dt MPROTECT 2
.Os
.Sh NAME
.Nm mprotect
.Nd control the protection of pages
.Sh SYNOPSIS
.In sys/mman.h
.Ft int
.Fn mprotect "void *addr" "size_t len" "int prot"
.Sh DESCRIPTION
The
.Fn mprotect
system call sets the access protections for the pages that contain
the address range
.Fa addr
through
.Fa addr
\&+
.Fa len
\- 1
(inclusive).
If
.Fa len
is 0, no action is taken on the page that contains
.Fa addr .
.Pp
The protections (region accessibility) are specified in the
.Fa prot
argument.
It should either be
.Dv PROT_NONE
.Pq no permissions
or the bitwise OR of one or more of the following values:
.Pp
.Bl -tag -width "PROT_WRITEXX" -offset indent -compact
.It Dv PROT_EXEC
Pages may be executed.
.It Dv PROT_READ
Pages may be read.
.It Dv PROT_WRITE
Pages may be written.
.El
.Pp
Not all implementations will guarantee protection on a page basis;
the granularity of protection changes may be as large as an entire region.
Nor will all implementations guarantee to give exactly the requested
permissions; more permissions may be granted than requested by
.Fa prot .
However, if
.Dv PROT_WRITE
was not specified then the page will not be writable.
.Sh RETURN VALUES
.Rv -std
.Sh ERRORS
.Fn mprotect
will fail if:
.Bl -tag -width Er
.It Bq Er EACCES
The process does not have sufficient access to the underlying memory
object to provide the requested protection.
.It Bq Er ENOMEM
The process has locked future pages with
.Fn mlockall MCL_FUTURE ,
a page being protected is not currently accessible,
and making it accessible and locked would exceed process or system limits.
.It Bq Er ENOTSUP
The accesses requested in the
.Ar prot
argument are not allowed.
In particular,
.Dv PROT_WRITE | PROT_EXEC
mappings are not permitted in most binaries (see
.Dv kern.wxabort
in
.Xr sysctl 3
for more information).
.It Bq Er EINVAL
The
.Fa prot
argument is invalid or the specified address range would wrap around.
.El
.Sh SEE ALSO
.Xr madvise 2 ,
.Xr mincore 2 ,
.Xr msync 2 ,
.Xr munmap 2
.Sh STANDARDS
The
.Fn mprotect
function conforms to
.St -p1003.1-2008 .
.Sh HISTORY
The
.Fn mprotect
function first appeared in
.Bx 4.4 .
.Sh CAVEATS
The
.Ox
implementation of
.Fn mprotect
does not require
.Fa addr
to be page-aligned,
although other implementations may.
@


1.21
log
@repair Xr, and point to sysctl(8) instead because sysctl(3) fails to
document kern.wxabort
from michael reed
@
text
@d1 1
a1 1
.\"	$OpenBSD: mprotect.2,v 1.20 2016/05/27 19:45:04 deraadt Exp $
d33 1
a33 1
.Dd $Mdocdate: May 27 2016 $
d108 1
a108 1
.Xr sysctl 8
@


1.20
log
@W^X violations are no longer permitted by default.  A kernel log message
is generated, and mprotect/mmap return ENOTSUP.  If the sysctl(8) flag
kern.wxabort is set then a SIGABRT occurs instead, for gdb use or coredump
creation.

W^X violating programs can be permitted on a ffs/nfs filesystem-basis,
using the "wxallowed" mount option.  One day far in the future
upstream software developers will understand that W^X violations are a
tremendously risky practice and that style of programming will be
banished outright.  Until then, we recommend most users need to use the
wxallowed option on their /usr/local filesystem.  At least your other
filesystems don't permit such programs.

ok jca kettenis mlarkin natano
@
text
@d1 1
a1 1
.\"	$OpenBSD: mprotect.2,v 1.19 2014/07/02 22:22:35 matthew Exp $
d33 1
a33 1
.Dd $Mdocdate: July 2 2014 $
d107 2
a108 1
in sysctl 3
@


1.19
log
@Various small typographic fixes for mman.h manual pages:

Use .Fn instead of .Nm as appropriate
Use .In for include lines
Use .Rv -std where possible
Use .Xr to refer to functions from other manual pages
Remove extraneous sys/types.h include

More substantive changes to follow.

Discussed with schwarze
@
text
@d1 1
a1 1
.\"	$OpenBSD: mprotect.2,v 1.18 2014/07/02 19:08:40 matthew Exp $
d99 10
@


1.18
log
@Sync description of PROT_* flags between mmap.2 and mprotect.2

ok guenther
@
text
@d1 1
a1 1
.\"	$OpenBSD: mprotect.2,v 1.17 2014/02/13 07:30:39 guenther Exp $
d33 1
a33 1
.Dd $Mdocdate: February 13 2014 $
d40 1
a40 1
.Fd #include <sys/mman.h>
d86 1
a86 5
Upon successful completion,
a value of 0 is returned.
Otherwise, a value of \-1 is returned and
.Va errno
is set to indicate the error.
@


1.17
log
@Don't use use .Tn with AND/OR/NOT
Phrase any "The _flags_ argument is the ..." line consistently,
eliminating unnecessary use of 'inclusive' and saying "zero or more"
or "one or more" as appropriate

ok millert@@ jmc@@ schwarze@@
@
text
@d1 1
a1 1
.\"	$OpenBSD: mprotect.2,v 1.16 2013/03/31 08:28:21 guenther Exp $
d33 1
a33 1
.Dd $Mdocdate: March 31 2013 $
d65 1
@


1.16
log
@Add ERRORS and STANDARDS sections; reorder and reword description to
clarify PROT_NONE vs PROT_* and what protections are actually sure to
be supprted.

ok jmc@@, deraadt@@
@
text
@d1 1
a1 1
.\"	$OpenBSD: mprotect.2,v 1.15 2010/02/12 21:49:10 jmc Exp $
d33 1
a33 1
.Dd $Mdocdate: February 12 2010 $
d65 1
a65 3
or a bitwise-inclusive
.Tn OR
of one or more of the following values:
@


1.15
log
@typo; ok oga
(sorry, i can't actually find where this started....)
@
text
@d1 1
a1 1
.\"	$OpenBSD: mprotect.2,v 1.14 2007/05/31 19:19:33 jmc Exp $
d33 1
a33 1
.Dd $Mdocdate: May 31 2007 $
a39 1
.Fd #include <sys/types.h>
a59 6
Not all implementations will guarantee protection on a page basis;
the granularity of protection changes may be as large as an entire region.
Nor will all implementations guarantee to give exactly the requested
permissions; more permissions may be granted than requested by
.Fa prot .
.Pp
d62 6
a67 3
argument by
.Tn OR Ns 'ing
the following values:
a75 2
.It Dv PROT_NONE
No permissions.
d77 9
d92 17
d114 5
@


1.14
log
@convert to new .Dd format;
@
text
@d1 1
a1 1
.\"	$OpenBSD: mprotect.2,v 1.13 2006/01/18 18:35:57 tom Exp $
d33 1
a33 1
.Dd $Mdocdate$
d58 1
a58 1
is 0, then action will be taken on the page that contains
@


1.13
log
@Clarify.  Based on a diff by millert@@, with additional input from miod@@.

ok millert@@
@
text
@d1 1
a1 1
.\"	$OpenBSD: mprotect.2,v 1.12 2006/01/18 11:15:33 jmc Exp $
d33 1
a33 1
.Dd June 9, 1993
@


1.12
log
@make the PROT_ list a little nicer;
@
text
@d1 1
a1 1
.\"	$OpenBSD: mprotect.2,v 1.11 2006/01/18 02:25:46 deraadt Exp $
d47 14
a60 3
system call
changes the specified pages to have protection
.Fa prot .
d99 9
@


1.11
log
@add a piece of text, copied here so that people can think about it:
+Nor will all implementations guarantee to give exactly the requested
+permissions; more permissions may be granted than requested by
+.Fa prot .
ok miod jmc
@
text
@d1 1
a1 1
.\"	$OpenBSD: mprotect.2,v 1.10 2004/04/15 19:52:18 jmc Exp $
d61 2
a62 1
.Bl -tag -width MAP_FIXEDX
@


1.10
log
@various improvements to lists and displays:

.Pp removal
-compact removal for displays
other list/display errors
@
text
@d1 1
a1 1
.\"	$OpenBSD: mprotect.2,v 1.9 2003/06/02 20:18:39 millert Exp $
d52 3
@


1.9
log
@Remove the advertising clause in the UCB license which Berkeley
rescinded 22 July 1999.  Proofed by myself and Theo.
@
text
@d1 1
a1 1
.\"	$OpenBSD: mprotect.2,v 1.8 2001/10/24 14:09:53 jjbg Exp $
a57 1
.Pp
@


1.8
log
@detail the different protections in mprotect(2) man page and add PROT_NONE
in mmap(2) man page. deraadt@@ ok.
@
text
@d1 1
a1 1
.\"	$OpenBSD: mprotect.2,v 1.7 1999/06/29 14:10:08 aaron Exp $
d15 1
a15 5
.\" 3. All advertising materials mentioning features or use of this software
.\"    must display the following acknowledgement:
.\"	This product includes software developed by the University of
.\"	California, Berkeley and its contributors.
.\" 4. Neither the name of the University nor the names of its contributors
@


1.7
log
@- change references to nil to null; tschroed@@acm.org
- remove trailing spaces from end of lines
- add some .Dv
- change -1 to \-1, so `-' is taken as a negative sign
- other misc formatting fixes
@
text
@d1 1
a1 1
.\"	$OpenBSD: mprotect.2,v 1.6 1998/07/06 18:28:00 deraadt Exp $
d56 17
@


1.6
log
@fix openbsd tag
@
text
@d1 1
a1 1
.\"	$OpenBSD: mprotect.2,v 1.6 1995/10/12 15:41:08 jtc Exp $
d59 1
a59 1
Otherwise, a value of -1 is returned and
d63 2
a64 2
.Xr madvise 2 , 
.Xr mincore 2 , 
@


1.5
log
@use Bx macro for BSD versions
@
text
@d1 1
@


1.4
log
@convert to void *addr
@
text
@d69 2
a70 1
function first appeared in 4.4BSD.
@


1.3
log
@problems reported by freebsd pr#1493; schweikhardt@@rus.uni-stuttgart.de
@
text
@d46 1
a46 1
.Fn mprotect "caddr_t addr" "size_t len" "int prot"
@


1.2
log
@from netbsd:
add & fix a bunch of system call pages
@
text
@d55 6
@


1.1
log
@Initial revision
@
text
@d1 1
a1 1
.\"	$NetBSD: mprotect.2,v 1.5 1995/02/27 12:34:56 cgd Exp $
d46 1
a46 1
.Fn mprotect "caddr_t addr" "int len" "int prot"
@


1.1.1.1
log
@initial import of NetBSD tree
@
text
@@
