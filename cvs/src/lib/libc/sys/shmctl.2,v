head	1.17;
access;
symbols
	OPENBSD_6_0:1.17.0.8
	OPENBSD_6_0_BASE:1.17
	OPENBSD_5_9:1.17.0.4
	OPENBSD_5_9_BASE:1.17
	OPENBSD_5_8:1.17.0.6
	OPENBSD_5_8_BASE:1.17
	OPENBSD_5_7:1.17.0.2
	OPENBSD_5_7_BASE:1.17
	OPENBSD_5_6:1.15.0.6
	OPENBSD_5_6_BASE:1.15
	OPENBSD_5_5:1.15.0.4
	OPENBSD_5_5_BASE:1.15
	OPENBSD_5_4:1.14.0.8
	OPENBSD_5_4_BASE:1.14
	OPENBSD_5_3:1.14.0.6
	OPENBSD_5_3_BASE:1.14
	OPENBSD_5_2:1.14.0.4
	OPENBSD_5_2_BASE:1.14
	OPENBSD_5_1_BASE:1.14
	OPENBSD_5_1:1.14.0.2
	OPENBSD_5_0:1.13.0.18
	OPENBSD_5_0_BASE:1.13
	OPENBSD_4_9:1.13.0.16
	OPENBSD_4_9_BASE:1.13
	OPENBSD_4_8:1.13.0.14
	OPENBSD_4_8_BASE:1.13
	OPENBSD_4_7:1.13.0.10
	OPENBSD_4_7_BASE:1.13
	OPENBSD_4_6:1.13.0.12
	OPENBSD_4_6_BASE:1.13
	OPENBSD_4_5:1.13.0.8
	OPENBSD_4_5_BASE:1.13
	OPENBSD_4_4:1.13.0.6
	OPENBSD_4_4_BASE:1.13
	OPENBSD_4_3:1.13.0.4
	OPENBSD_4_3_BASE:1.13
	OPENBSD_4_2:1.13.0.2
	OPENBSD_4_2_BASE:1.13
	OPENBSD_4_1:1.12.0.28
	OPENBSD_4_1_BASE:1.12
	OPENBSD_4_0:1.12.0.26
	OPENBSD_4_0_BASE:1.12
	OPENBSD_3_9:1.12.0.24
	OPENBSD_3_9_BASE:1.12
	OPENBSD_3_8:1.12.0.22
	OPENBSD_3_8_BASE:1.12
	OPENBSD_3_7:1.12.0.20
	OPENBSD_3_7_BASE:1.12
	OPENBSD_3_6:1.12.0.18
	OPENBSD_3_6_BASE:1.12
	OPENBSD_3_5:1.12.0.16
	OPENBSD_3_5_BASE:1.12
	OPENBSD_3_4:1.12.0.14
	OPENBSD_3_4_BASE:1.12
	OPENBSD_3_3:1.12.0.12
	OPENBSD_3_3_BASE:1.12
	OPENBSD_3_2:1.12.0.10
	OPENBSD_3_2_BASE:1.12
	OPENBSD_3_1:1.12.0.8
	OPENBSD_3_1_BASE:1.12
	OPENBSD_3_0:1.12.0.6
	OPENBSD_3_0_BASE:1.12
	OPENBSD_2_9:1.12.0.4
	OPENBSD_2_9_BASE:1.12
	OPENBSD_2_8:1.12.0.2
	OPENBSD_2_8_BASE:1.12
	OPENBSD_2_7:1.11.0.2
	OPENBSD_2_7_BASE:1.11
	OPENBSD_2_6:1.10.0.2
	OPENBSD_2_6_BASE:1.10
	OPENBSD_2_5:1.6.0.4
	OPENBSD_2_5_BASE:1.6
	OPENBSD_2_4:1.6.0.2
	OPENBSD_2_4_BASE:1.6
	OPENBSD_2_3:1.5.0.2
	OPENBSD_2_3_BASE:1.5
	OPENBSD_2_2:1.3.0.4
	OPENBSD_2_2_BASE:1.3
	OPENBSD_2_1:1.3.0.2
	OPENBSD_2_1_BASE:1.3
	OPENBSD_2_0:1.2.0.2
	OPENBSD_2_0_BASE:1.2;
locks; strict;
comment	@# @;


1.17
date	2014.12.10.19.19.00;	author schwarze;	state Exp;
branches;
next	1.16;
commitid	sADK4BTCz4ZrHHo9;

1.16
date	2014.11.15.22.19.53;	author guenther;	state Exp;
branches;
next	1.15;
commitid	GguL5OiT55XFPGr2;

1.15
date	2014.01.21.03.15.45;	author schwarze;	state Exp;
branches;
next	1.14;

1.14
date	2011.10.27.07.56.28;	author robert;	state Exp;
branches;
next	1.13;

1.13
date	2007.05.31.19.19.33;	author jmc;	state Exp;
branches;
next	1.12;

1.12
date	2000.10.18.05.12.11;	author aaron;	state Exp;
branches;
next	1.11;

1.11
date	2000.04.15.11.46.04;	author aaron;	state Exp;
branches;
next	1.10;

1.10
date	99.06.29.14.10.20;	author aaron;	state Exp;
branches;
next	1.9;

1.9
date	99.06.05.04.16.08;	author aaron;	state Exp;
branches;
next	1.8;

1.8
date	99.05.27.14.05.10;	author aaron;	state Exp;
branches;
next	1.7;

1.7
date	99.05.10.17.56.29;	author aaron;	state Exp;
branches;
next	1.6;

1.6
date	98.06.11.18.32.11;	author deraadt;	state Exp;
branches;
next	1.5;

1.5
date	97.11.24.07.24.56;	author deraadt;	state Exp;
branches;
next	1.4;

1.4
date	97.11.24.02.07.35;	author deraadt;	state Exp;
branches;
next	1.3;

1.3
date	97.03.30.18.49.52;	author millert;	state Exp;
branches;
next	1.2;

1.2
date	96.10.08.01.20.15;	author michaels;	state Exp;
branches;
next	1.1;

1.1
date	95.12.14.02.22.01;	author deraadt;	state Exp;
branches;
next	;


desc
@@


1.17
log
@use .Rv; no change of meaning; from Kaspars at Bankovskis dot net
@
text
@.\"	$OpenBSD: shmctl.2,v 1.16 2014/11/15 22:19:53 guenther Exp $
.\"	$NetBSD: shmctl.2,v 1.3 1997/03/27 08:20:39 mikel Exp $
.\"
.\" Copyright (c) 1995 Frank van der Linden
.\" All rights reserved.
.\"
.\" Redistribution and use in source and binary forms, with or without
.\" modification, are permitted provided that the following conditions
.\" are met:
.\" 1. Redistributions of source code must retain the above copyright
.\"    notice, this list of conditions and the following disclaimer.
.\" 2. Redistributions in binary form must reproduce the above copyright
.\"    notice, this list of conditions and the following disclaimer in the
.\"    documentation and/or other materials provided with the distribution.
.\" 3. All advertising materials mentioning features or use of this software
.\"    must display the following acknowledgement:
.\"      This product includes software developed for the NetBSD Project
.\"      by Frank van der Linden
.\" 4. The name of the author may not be used to endorse or promote products
.\"    derived from this software without specific prior written permission
.\"
.\" THIS SOFTWARE IS PROVIDED BY THE AUTHOR ``AS IS'' AND ANY EXPRESS OR
.\" IMPLIED WARRANTIES, INCLUDING, BUT NOT LIMITED TO, THE IMPLIED WARRANTIES
.\" OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE ARE DISCLAIMED.
.\" IN NO EVENT SHALL THE AUTHOR BE LIABLE FOR ANY DIRECT, INDIRECT,
.\" INCIDENTAL, SPECIAL, EXEMPLARY, OR CONSEQUENTIAL DAMAGES (INCLUDING, BUT
.\" NOT LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES; LOSS OF USE,
.\" DATA, OR PROFITS; OR BUSINESS INTERRUPTION) HOWEVER CAUSED AND ON ANY
.\" THEORY OF LIABILITY, WHETHER IN CONTRACT, STRICT LIABILITY, OR TORT
.\" (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE USE OF
.\" THIS SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.
.\"/
.Dd $Mdocdate: November 15 2014 $
.Dt SHMCTL 2
.Os
.Sh NAME
.Nm shmctl
.Nd shared memory control operations
.Sh SYNOPSIS
.In sys/shm.h
.Ft int
.Fn shmctl "int shmid" "int cmd" "struct shmid_ds *buf"
.Sh DESCRIPTION
The
.Fn shmctl
system call performs some control operations on the shared memory area
specified by
.Fa shmid .
.Pp
Each shared memory segment has a data structure associated with it,
parts of which may be altered by
.Fn shmctl
and parts of which determine the actions of
.Fn shmctl .
.Pp
This structure is defined as follows in
.In sys/shm.h :
.Bd -literal
struct shmid_ds {
	struct ipc_perm shm_perm;     /* operation permissions */
	int             shm_segsz;    /* size of segment in bytes */
	pid_t           shm_lpid;     /* pid of last shm op */
	pid_t           shm_cpid;     /* pid of creator */
	short           shm_nattch;   /* # of current attaches */
	time_t          shm_atime;    /* last shmat() time*/
	time_t          shm_dtime;    /* last shmdt() time */
	time_t          shm_ctime;    /* last change by shmctl() */
	void		*shm_internal; /* sysv stupidity */
};
.Ed
.Pp
The
.Bf -literal
ipc_perm
.Ef
structure used inside the
.Bf -literal
shmid_ds
.Ef
structure is defined in
.In sys/ipc.h
and looks like this:
.Bd -literal
struct ipc_perm {
	uid_t		cuid;	/* creator user id */
	gid_t		cgid;	/* creator group id */
	uid_t		uid;	/* user id */
	gid_t		gid;	/* group id */
	mode_t		mode;	/* r/w permission (see chmod(2)) */
	u_short		seq;	/* sequence # (to generate unique msg/sem/shm id) */
	key_t		key;	/* user specified msg/sem/shm key */
};
.Ed
.Pp
The operation to be performed by
.Fn shmctl
is specified in
.Fa cmd
and is one of:
.Bl -tag -width IPC_RMIDX
.It Dv IPC_STAT
Gather information about the shared memory segment and place it in the
structure pointed to by
.Fa buf .
.It Dv IPC_SET
Set the value of the
.Va shm_perm.uid ,
.Va shm_perm.gid
and
.Va shm_perm.mode
fields in the structure associated with
.Fa shmid .
The values are taken from the corresponding fields in the structure
pointed to by
.Fa buf .
This operation can only be executed by the superuser, or a process that
has an effective user ID equal to either
.Va shm_perm.cuid
or
.Va shm_perm.uid
in the data structure associated with the shared memory segment.
.It Dv IPC_RMID
Mark the shared memory segment specified by
.Fa shmid
for removal when it is no longer in use by any process.
When it is removed, all data associated with it will be destroyed too.
Only the superuser or a process with an effective UID equal to the
.Va shm_perm.cuid
or
.Va shm_perm.uid
values in the data structure associated with the queue can do this.
.El
.Pp
The read and write permissions on a shared memory identifier
are determined by the
.Va shm_perm.mode
field in the same way as is
done with files (see
.Xr chmod 2 ) ,
but the effective UID can match either the
.Va shm_perm.cuid
field or the
.Va shm_perm.uid
field, and the
effective GID can match either
.Va shm_perm.cgid
or
.Va shm_perm.gid .
.Sh RETURN VALUES
.Rv -std
.Sh ERRORS
.Fn shmctl
will fail if:
.Bl -tag -width Er
.It Bq Er EPERM
.Fa cmd
is equal to
.Dv IPC_SET
or
.Dv IPC_RMID
and the caller is not the superuser, nor does
the effective UID match either the
.Va shm_perm.uid
or
.Va shm_perm.cuid
fields of the data structure associated with the shared memory segment.
.Pp
An attempt is made to increase the value of
.Va shm_qbytes
through
.Dv IPC_SET
but the caller is not the superuser.
.It Bq Er EACCES
The command is
.Dv IPC_STAT
and the caller has no read permission for this shared memory segment.
.It Bq Er EINVAL
.Fa shmid
is not a valid shared memory segment identifier.
.Pp
.Va cmd
is not a valid command.
.It Bq Er EFAULT
.Fa buf
specifies an invalid address.
.El
.Sh SEE ALSO
.Xr shmat 2 ,
.Xr shmget 2
.Sh STANDARDS
Segments which are marked for removal (but not yet removed
since they are still in use) can be attached to by new callers
using
.Xr shmat 2 .
This is permitted as an extension beyond the standards.
@


1.16
log
@Per POSIX, we now only require <sys/msg.h>, <sys/sem.h>, or <sys/shm.h>
@
text
@d1 1
a1 1
.\"	$OpenBSD: shmctl.2,v 1.15 2014/01/21 03:15:45 schwarze Exp $
d33 1
a33 1
.Dd $Mdocdate: January 21 2014 $
d150 1
a150 4
Upon successful completion, a value of 0 is returned.
Otherwise, \-1 is returned and the global variable
.Va errno
is set to indicate the error.
@


1.15
log
@obvious .Pa fixes; found with mandocdb(8)
@
text
@d1 1
a1 1
.\"	$OpenBSD: shmctl.2,v 1.14 2011/10/27 07:56:28 robert Exp $
d33 1
a33 1
.Dd $Mdocdate: October 27 2011 $
d40 1
a40 3
.Fd #include <sys/types.h>
.Fd #include <sys/ipc.h>
.Fd #include <sys/shm.h>
@


1.14
log
@Allow segments to be used even after they were marked for deletion with
the IPC_RMID flag.
This is permitted as an extension beyond the standards and this is similar
to what other operating systems like linux do.

Because compat_linux(8) was emulating this already, remove that code
since now this is the default.

input from oga@@, guenther@@, jmc@@, deraadt@@
ok deraadt@@
@
text
@d1 1
a1 1
.\"	$OpenBSD: shmctl.2,v 1.13 2007/05/31 19:19:33 jmc Exp $
d33 1
a33 1
.Dd $Mdocdate: May 31 2007 $
d59 1
a59 1
.Aq Pa sys/shm.h :
d83 1
a83 1
.Aq Pa sys/ipc.h
a123 1
.Pp
@


1.13
log
@convert to new .Dd format;
@
text
@d1 1
a1 1
.\"	$OpenBSD: shmctl.2,v 1.12 2000/10/18 05:12:11 aaron Exp $
d33 1
a33 1
.Dd $Mdocdate$
d126 1
a126 1
Remove the shared memory segment specified by
d128 2
a129 1
and destroy the data associated with it.
d196 6
@


1.12
log
@Another round of man page cleanup, this time to remove more hard sentence
breaks and getting rid of short lines, making these files easier to work with.
@
text
@d1 1
a1 1
.\"	$OpenBSD: shmctl.2,v 1.11 2000/04/15 11:46:04 aaron Exp $
d33 1
a33 1
.Dd August 17, 1995
@


1.11
log
@- For consistency, `super-user' -> `superuser' in all cases.
- Some punctuation fixes.
- Some `id' -> `ID'.
@
text
@d1 1
a1 1
.\"	$OpenBSD: shmctl.2,v 1.10 1999/06/29 14:10:20 aaron Exp $
d128 2
a129 2
and destroy the data associated with it. Only the superuser or a process
with an effective UID equal to the
d152 2
a153 2
Upon successful completion, a value of 0 is returned. Otherwise, \-1 is
returned and the global variable
@


1.10
log
@- change references to nil to null; tschroed@@acm.org
- remove trailing spaces from end of lines
- add some .Dv
- change -1 to \-1, so `-' is taken as a negative sign
- other misc formatting fixes
@
text
@d1 1
a1 1
.\"	$OpenBSD: shmctl.2,v 1.9 1999/06/05 04:16:08 aaron Exp $
d118 1
a118 1
This operation can only be executed by the super-user, or a process that
d128 1
a128 1
and destroy the data associated with it. Only the super-user or a process
d166 1
a166 1
and the caller is not the super-user, nor does
d177 1
a177 1
but the caller is not the super-user.
@


1.9
log
@capitalize the acronym ID
@
text
@d1 1
a1 1
.\"	$OpenBSD: shmctl.2,v 1.8 1999/05/27 14:05:10 aaron Exp $
d119 1
a119 1
has an effective user ID equal to either 
d129 1
a129 1
with an effective UID equal to the 
d152 1
a152 1
Upon successful completion, a value of 0 is returned. Otherwise, -1 is
@


1.8
log
@add some .Dv and .Er, replace blank lines with .Pp
@
text
@d1 1
a1 1
.\"	$OpenBSD: shmctl.2,v 1.7 1999/05/10 17:56:29 aaron Exp $
d119 1
a119 1
has an effective user id equal to either 
@


1.7
log
@correct some Xr's which referred to the wrong man page sections
@
text
@d1 1
a1 1
.\"	$OpenBSD: shmctl.2,v 1.6 1998/06/11 18:32:11 deraadt Exp $
d51 1
a51 1

d57 1
a57 1

d96 1
a96 1

d124 1
a124 1

d129 1
a129 1
with an effective uid equal to the 
d135 1
a135 1

d142 1
a142 1
but the effective uid can match either the
d147 1
a147 1
effective gid can match either
d162 6
a167 2
is equal to IPC_SET or IPC_RMID and the caller is not the super-user, nor does
the effective uid match either the
d172 1
a172 1

d175 2
a176 1
through IPC_SET
d179 2
a180 1
The command is IPC_STAT
d185 1
a185 1

@


1.6
log
@change ipc.h to use uid_t and friends, and then build compat system calls for the old ushort based ipc.h
@
text
@d1 1
a1 1
.\"	$OpenBSD: shmctl.2,v 1.5 1997/11/24 07:24:56 deraadt Exp $
d141 1
a141 1
.Xr chmod 2 ),
@


1.5
log
@missing blank lines
@
text
@d1 1
a1 1
.\"	$OpenBSD: shmctl.2,v 1.4 1997/11/24 02:07:35 deraadt Exp $
d62 9
a70 9
    struct ipc_perm shm_perm;     /* operation permissions */
    int             shm_segsz;    /* size of segment in bytes */
    pid_t           shm_lpid;     /* pid of last shm op */
    pid_t           shm_cpid;     /* pid of creator */
    short           shm_nattch;   /* # of current attaches */
    time_t          shm_atime;    /* last shmat() time*/
    time_t          shm_dtime;    /* last shmdt() time */
    time_t          shm_ctime;    /* last change by shmctl() */
    void           *shm_internal; /* sysv stupidity */
d87 7
a93 7
    ushort cuid; /* creator user id */
    ushort cgid; /* creator group id */
    ushort uid;	 /* user id */
    ushort gid;	 /* group id */
    ushort mode; /* r/w permission (see chmod(2)) */
    ushort seq;	 /* sequence # (to generate unique msg/sem/shm id) */
    key_t key;	 /* user specified msg/sem/shm key */
@


1.4
log
@fix mispelling of EACCES; bde
@
text
@d1 1
a1 1
.\"	$OpenBSD: shmctl.2,v 1.3 1997/03/30 18:49:52 millert Exp $
d73 1
@


1.3
log
@We run OpenBSD not NetBSD
From NetBSD:
    Fix includes specified for shmctl(2)
    Make xrefs consistent
@
text
@d1 1
a1 1
.\"	$OpenBSD: shmctl.2,v 1.2 1996/10/08 01:20:15 michaels Exp $
d172 1
a172 1
.It Bq Er EACCESS
@


1.2
log
@Attempt at cleanup.
@
text
@d1 2
a2 2
.\"   $OpenBSD$
.\"	$NetBSD: shmctl.2,v 1.1 1995/10/16 23:49:30 jtc Exp $	
d42 1
a42 1
.Fd #include <sys/msg.h>
a186 1
.Xr shmdt 2 ,
@


1.1
log
@properly add them...
@
text
@d1 1
d35 1
a35 1
.Os NetBSD
@
