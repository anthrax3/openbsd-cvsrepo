head	1.21;
access;
symbols
	OPENBSD_6_1:1.21.0.12
	OPENBSD_6_1_BASE:1.21
	OPENBSD_6_0:1.21.0.8
	OPENBSD_6_0_BASE:1.21
	OPENBSD_5_9:1.21.0.4
	OPENBSD_5_9_BASE:1.21
	OPENBSD_5_8:1.21.0.6
	OPENBSD_5_8_BASE:1.21
	OPENBSD_5_7:1.21.0.2
	OPENBSD_5_7_BASE:1.21
	OPENBSD_5_6:1.19.0.6
	OPENBSD_5_6_BASE:1.19
	OPENBSD_5_5:1.19.0.4
	OPENBSD_5_5_BASE:1.19
	OPENBSD_5_4:1.18.0.2
	OPENBSD_5_4_BASE:1.18
	OPENBSD_5_3:1.17.0.2
	OPENBSD_5_3_BASE:1.17
	OPENBSD_5_2:1.16.0.22
	OPENBSD_5_2_BASE:1.16
	OPENBSD_5_1_BASE:1.16
	OPENBSD_5_1:1.16.0.20
	OPENBSD_5_0:1.16.0.18
	OPENBSD_5_0_BASE:1.16
	OPENBSD_4_9:1.16.0.16
	OPENBSD_4_9_BASE:1.16
	OPENBSD_4_8:1.16.0.14
	OPENBSD_4_8_BASE:1.16
	OPENBSD_4_7:1.16.0.10
	OPENBSD_4_7_BASE:1.16
	OPENBSD_4_6:1.16.0.12
	OPENBSD_4_6_BASE:1.16
	OPENBSD_4_5:1.16.0.8
	OPENBSD_4_5_BASE:1.16
	OPENBSD_4_4:1.16.0.6
	OPENBSD_4_4_BASE:1.16
	OPENBSD_4_3:1.16.0.4
	OPENBSD_4_3_BASE:1.16
	OPENBSD_4_2:1.16.0.2
	OPENBSD_4_2_BASE:1.16
	OPENBSD_4_1:1.15.0.2
	OPENBSD_4_1_BASE:1.15
	OPENBSD_4_0:1.14.0.6
	OPENBSD_4_0_BASE:1.14
	OPENBSD_3_9:1.14.0.4
	OPENBSD_3_9_BASE:1.14
	OPENBSD_3_8:1.14.0.2
	OPENBSD_3_8_BASE:1.14
	OPENBSD_3_7:1.13.0.8
	OPENBSD_3_7_BASE:1.13
	OPENBSD_3_6:1.13.0.6
	OPENBSD_3_6_BASE:1.13
	OPENBSD_3_5:1.13.0.4
	OPENBSD_3_5_BASE:1.13
	OPENBSD_3_4:1.13.0.2
	OPENBSD_3_4_BASE:1.13
	OPENBSD_3_3:1.10.0.2
	OPENBSD_3_3_BASE:1.10
	OPENBSD_3_2:1.9.0.6
	OPENBSD_3_2_BASE:1.9
	OPENBSD_3_1:1.9.0.4
	OPENBSD_3_1_BASE:1.9
	OPENBSD_3_0:1.9.0.2
	OPENBSD_3_0_BASE:1.9
	OPENBSD_2_9:1.8.0.6
	OPENBSD_2_9_BASE:1.8
	OPENBSD_2_8:1.8.0.4
	OPENBSD_2_8_BASE:1.8
	OPENBSD_2_7:1.8.0.2
	OPENBSD_2_7_BASE:1.8
	OPENBSD_2_6:1.6.0.2
	OPENBSD_2_6_BASE:1.6
	OPENBSD_2_5:1.5.0.2
	OPENBSD_2_5_BASE:1.5
	OPENBSD_2_4:1.4.0.4
	OPENBSD_2_4_BASE:1.4
	OPENBSD_2_3:1.4.0.2
	OPENBSD_2_3_BASE:1.4
	OPENBSD_2_2:1.2.0.6
	OPENBSD_2_2_BASE:1.2
	OPENBSD_2_1:1.2.0.4
	OPENBSD_2_1_BASE:1.2
	OPENBSD_2_0:1.2.0.2
	OPENBSD_2_0_BASE:1.2
	netbsd_1_1:1.1.1.1;
locks; strict;
comment	@.\" @;


1.21
date	2015.02.28.21.51.57;	author bentley;	state Exp;
branches;
next	1.20;
commitid	NNu2UZnsd5zmNVYD;

1.20
date	2015.01.13.14.02.30;	author schwarze;	state Exp;
branches;
next	1.19;
commitid	vuDIxCTQQireD6ui;

1.19
date	2014.01.21.03.15.45;	author schwarze;	state Exp;
branches;
next	1.18;

1.18
date	2013.06.05.03.39.23;	author tedu;	state Exp;
branches;
next	1.17;

1.17
date	2012.09.07.05.37.06;	author jmc;	state Exp;
branches;
next	1.16;

1.16
date	2007.05.31.19.19.31;	author jmc;	state Exp;
branches;
next	1.15;

1.15
date	2007.01.29.19.13.05;	author jmc;	state Exp;
branches;
next	1.14;

1.14
date	2005.07.26.03.30.25;	author jaredy;	state Exp;
branches;
next	1.13;

1.13
date	2003.06.02.20.18.37;	author millert;	state Exp;
branches;
next	1.12;

1.12
date	2003.06.01.18.56.04;	author jmc;	state Exp;
branches;
next	1.11;

1.11
date	2003.04.02.19.00.26;	author jmc;	state Exp;
branches;
next	1.10;

1.10
date	2003.03.06.19.54.52;	author jmc;	state Exp;
branches;
next	1.9;

1.9
date	2001.09.22.17.53.59;	author heko;	state Exp;
branches;
next	1.8;

1.8
date	2000.04.20.01.39.32;	author aaron;	state Exp;
branches;
next	1.7;

1.7
date	2000.01.09.09.36.17;	author deraadt;	state Exp;
branches;
next	1.6;

1.6
date	99.07.09.13.35.23;	author aaron;	state Exp;
branches;
next	1.5;

1.5
date	99.02.27.21.55.50;	author deraadt;	state Exp;
branches;
next	1.4;

1.4
date	98.03.12.20.17.42;	author deraadt;	state Exp;
branches;
next	1.3;

1.3
date	98.03.12.20.03.54;	author deraadt;	state Exp;
branches;
next	1.2;

1.2
date	96.08.19.08.33.09;	author tholo;	state Exp;
branches;
next	1.1;

1.1
date	95.10.18.08.42.15;	author deraadt;	state Exp;
branches
	1.1.1.1;
next	;

1.1.1.1
date	95.10.18.08.42.15;	author deraadt;	state Exp;
branches;
next	;


desc
@@


1.21
log
@Reduce usage of predefined strings in manpages.

Predefined strings are not very portable across troff implementations,
and they make the source much harder to read. Usually the intended
character can be written directly.

No output changes, except for two instances where the incorrect escape
was used in the first place.

tweaks + ok schwarze@@
@
text
@.\"	$OpenBSD: tmpnam.3,v 1.20 2015/01/13 14:02:30 schwarze Exp $
.\"
.\" Copyright (c) 1988, 1991, 1993
.\"	The Regents of the University of California.  All rights reserved.
.\"
.\" This code is derived from software contributed to Berkeley by
.\" the American National Standards Committee X3, on Information
.\" Processing Systems.
.\"
.\" Redistribution and use in source and binary forms, with or without
.\" modification, are permitted provided that the following conditions
.\" are met:
.\" 1. Redistributions of source code must retain the above copyright
.\"    notice, this list of conditions and the following disclaimer.
.\" 2. Redistributions in binary form must reproduce the above copyright
.\"    notice, this list of conditions and the following disclaimer in the
.\"    documentation and/or other materials provided with the distribution.
.\" 3. Neither the name of the University nor the names of its contributors
.\"    may be used to endorse or promote products derived from this software
.\"    without specific prior written permission.
.\"
.\" THIS SOFTWARE IS PROVIDED BY THE REGENTS AND CONTRIBUTORS ``AS IS'' AND
.\" ANY EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT LIMITED TO, THE
.\" IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE
.\" ARE DISCLAIMED.  IN NO EVENT SHALL THE REGENTS OR CONTRIBUTORS BE LIABLE
.\" FOR ANY DIRECT, INDIRECT, INCIDENTAL, SPECIAL, EXEMPLARY, OR CONSEQUENTIAL
.\" DAMAGES (INCLUDING, BUT NOT LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS
.\" OR SERVICES; LOSS OF USE, DATA, OR PROFITS; OR BUSINESS INTERRUPTION)
.\" HOWEVER CAUSED AND ON ANY THEORY OF LIABILITY, WHETHER IN CONTRACT, STRICT
.\" LIABILITY, OR TORT (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY
.\" OUT OF THE USE OF THIS SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF
.\" SUCH DAMAGE.
.\"
.Dd $Mdocdate: January 13 2015 $
.Dt TMPFILE 3
.Os
.Sh NAME
.Nm tempnam ,
.Nm tmpfile ,
.Nm tmpnam
.Nd temporary file routines
.Sh SYNOPSIS
.In stdio.h
.Ft FILE *
.Fn tmpfile void
.Ft char *
.Fn tmpnam "char *str"
.Ft char *
.Fn tempnam "const char *tmpdir" "const char *prefix"
.Sh DESCRIPTION
The
.Fn tmpfile
function returns a pointer to a stream associated with a file descriptor
returned by the routine
.Xr mkstemp 3 .
The created file is unlinked before
.Fn tmpfile
returns, causing the file to be automatically deleted when the last
reference to it is closed.
Since
.Xr mkstemp 3
creates the file with mode
.Dv S_IRUSR | S_IWUSR ,
after the unlink,
.Xr fchown 2
and
.Xr umask 2
are used to set the file mode to the expected value.
The file is opened with the access value
.Ql w+ .
.Pp
The
.Fn tmpnam
function returns a pointer to a file name, in the
.Dv P_tmpdir
directory, which did not reference an existing file at some
indeterminate point in the past.
.Dv P_tmpdir
is defined in the include file
.In stdio.h .
If the argument
.Fa str
is non-null, the file name is copied to the buffer it references.
Otherwise, the file name is copied to a static buffer.
In either case,
.Fn tmpnam
returns a pointer to the file name.
.Pp
The buffer referenced by
.Fa str
is expected to be at least
.Dv L_tmpnam
bytes in length.
.Dv L_tmpnam
is defined in the include file
.In stdio.h .
.Pp
The
.Fn tempnam
function is similar to
.Fn tmpnam ,
but provides the ability to specify the directory which will
contain the temporary file and the file name prefix.
.Pp
The environment variable
.Ev TMPDIR
(if set), the argument
.Fa tmpdir
(if non-null),
the directory
.Dv P_tmpdir ,
and the directory
.Pa /tmp
are tried, in the listed order, as directories in which to store the
temporary file.
.Pp
The argument
.Fa prefix ,
if non-null, is used to specify a file name prefix, which will be the
first part of the created file name.
.Fn tempnam
allocates memory in which to store the file name; the returned pointer
may be used as a subsequent argument to
.Xr free 3 .
.Sh RETURN VALUES
The
.Fn tmpfile
function returns a pointer to an open file stream on success, and a null
pointer on error.
.Pp
The
.Fn tmpnam
and
.Fn tempnam
functions return a pointer to a file name on success, and a null pointer
on error.
.Sh ENVIRONMENT
.Bl -tag -width Ds
.It Ev TMPDIR
.Pf [ Fn tempnam
only]
If set,
the directory in which the temporary file is stored.
.Ev TMPDIR
is ignored for processes
for which
.Xr issetugid 2
is true.
.El
.Sh ERRORS
The
.Fn tmpfile
function may fail and set the global variable
.Va errno
for any of the errors specified for the library functions
.Xr fdopen 3
or
.Xr mkstemp 3 .
.Pp
The
.Fn tmpnam
function may fail and set
.Va errno
for any of the errors specified for the library function
.Xr mktemp 3 .
.Pp
The
.Fn tempnam
function may fail and set
.Va errno
for any of the errors specified for the library functions
.Xr malloc 3
or
.Xr mktemp 3 .
.Sh SEE ALSO
.Xr issetugid 2 ,
.Xr mkstemp 3 ,
.Xr mktemp 3
.Sh STANDARDS
The
.Fn tmpfile
and
.Fn tmpnam
functions conform to
.St -ansiC .
.Sh BUGS
.Fn tmpnam
and
.Fn tempnam
are provided for System V and ANSI compatibility only.
These interfaces are typically not used in safe ways.
The
.Xr mkstemp 3
interface is strongly preferred.
.Pp
There are four important problems with these interfaces (as well as
with the historic
.Xr mktemp 3
interface).
First, there is an obvious race between file name selection and file
creation and deletion: the program is typically written to call
.Fn tmpnam ,
.Fn tempnam ,
or
.Xr mktemp 3 .
Subsequently, the program calls
.Xr open 2
or
.Xr fopen 3
and erroneously opens a file (or symbolic link, or FIFO or other
device) that the attacker has placed in the expected file location.
Hence
.Xr mkstemp 3
is recommended, since it atomically creates the file.
.Pp
Second, most historic implementations provide only a limited number
of possible temporary file names (usually 26) before file names will
start being recycled.
Third, the System V implementations of these functions (and of
.Xr mktemp 3 )
use the
.Xr access 2
function to determine whether or not the temporary file may be created.
This has obvious ramifications for daemons or setuid/setgid programs,
complicating the portable use of these interfaces in such programs.
Finally, there is no specification of the permissions with which the
temporary files are created.
.Pp
This implementation does not have these flaws, but portable software
cannot depend on that.
.Pp
For these reasons,
.Xr ld 1
will output a warning message whenever it links code that uses the functions
.Fn tmpnam
or
.Fn tempnam .
@


1.20
log
@remove .Tn from stdio manuals; Kaspars Bankovskis found one of these
@
text
@d1 1
a1 1
.\"	$OpenBSD: tmpnam.3,v 1.19 2014/01/21 03:15:45 schwarze Exp $
d34 1
a34 1
.Dd $Mdocdate: January 21 2014 $
d63 1
a63 1
.Dv S_IRUSR \*(Ba S_IWUSR ,
@


1.19
log
@obvious .Pa fixes; found with mandocdb(8)
@
text
@d1 1
a1 1
.\"	$OpenBSD: tmpnam.3,v 1.18 2013/06/05 03:39:23 tedu Exp $
d34 1
a34 1
.Dd $Mdocdate: June 5 2013 $
d190 1
a190 3
are provided for System V and
.Tn ANSI
compatibility only.
@


1.18
log
@Use the fancy .In macro for includes. From Jan Klemkow. ok jmc schwarze
@
text
@d1 1
a1 1
.\"	$OpenBSD: tmpnam.3,v 1.17 2012/09/07 05:37:06 jmc Exp $
d34 1
a34 1
.Dd $Mdocdate: September 7 2012 $
d80 1
a80 1
.Aq Pa stdio.h .
d96 1
a96 1
.Aq Pa stdio.h .
@


1.17
log
@tmpname -> tempnam; from Artturi Alm
@
text
@d1 1
a1 1
.\"	$OpenBSD: tmpnam.3,v 1.16 2007/05/31 19:19:31 jmc Exp $
d34 1
a34 1
.Dd $Mdocdate: May 31 2007 $
d43 1
a43 1
.Fd #include <stdio.h>
@


1.16
log
@convert to new .Dd format;
@
text
@d1 1
a1 1
.\"	$OpenBSD: tmpnam.3,v 1.15 2007/01/29 19:13:05 jmc Exp $
d34 1
a34 1
.Dd $Mdocdate$
d205 1
a205 1
.Fn tmpname ,
@


1.15
log
@add an ENVIRONMENT section for TMPDIR;
from freebsd pr# 108346, from Anton Yuzhaninov

much tweaked by otto and myself;
@
text
@d1 1
a1 1
.\"	$OpenBSD: tmpnam.3,v 1.14 2005/07/26 03:30:25 jaredy Exp $
d34 1
a34 1
.Dd November 17, 1993
@


1.14
log
@- typos, punctuation, spacing, macro, layout, etc. fixes
- avoid first person

ok jmc
@
text
@d1 1
a1 1
.\"	$OpenBSD: tmpnam.3,v 1.13 2003/06/02 20:18:37 millert Exp $
d137 13
d176 1
@


1.13
log
@Remove the advertising clause in the UCB license which Berkeley
rescinded 22 July 1999.  Proofed by myself and Theo.
@
text
@d1 1
a1 1
.\"	$OpenBSD: tmpnam.3,v 1.12 2003/06/01 18:56:04 jmc Exp $
d63 2
a64 2
.Dv S_IRUSR | S_IWUSR ,
after the unlink
@


1.12
log
@- section reorder
- kill unnecessary .Ns macros
- add some man page section numbers to .Xr's
@
text
@d1 1
a1 1
.\"	$OpenBSD: tmpnam.3,v 1.11 2003/04/02 19:00:26 jmc Exp $
d18 1
a18 5
.\" 3. All advertising materials mentioning features or use of this software
.\"    must display the following acknowledgement:
.\"	This product includes software developed by the University of
.\"	California, Berkeley and its contributors.
.\" 4. Neither the name of the University nor the names of its contributors
@


1.11
log
@fifo -> FIFO

ok millert@@
@
text
@d1 1
a1 1
.\"	$OpenBSD: tmpnam.3,v 1.10 2003/03/06 19:54:52 jmc Exp $
d194 3
a196 2
.Fn tmpnam Ns ,
.Fn tmpname Ns , or
d212 1
a212 1
.Xr mktemp )
@


1.10
log
@.Xr's;
typos in man page section

ok deraadt@@
@
text
@d1 1
a1 1
.\"	$OpenBSD: tmpnam.3,v 1.9 2001/09/22 17:53:59 heko Exp $
d201 1
a201 1
and erroneously opens a file (or symbolic link, or fifo or other
@


1.9
log
@Typo: tempfile ==> tempnam.
ok millert@@
@
text
@d1 1
a1 1
.\"	$OpenBSD: tmpnam.3,v 1.8 2000/04/20 01:39:32 aaron Exp $
d224 1
a224 1
.Xr ld 8
@


1.8
log
@Flesh out all of the stdio man pages.
@
text
@d1 1
a1 1
.\"	$OpenBSD: tmpnam.3,v 1.7 2000/01/09 09:36:17 deraadt Exp $
d138 1
a138 1
.Fn tempfile
@


1.7
log
@fix tmpnam() argument; kris@@freebsd
@
text
@d1 1
a1 1
.\"	$OpenBSD: tmpnam.3,v 1.6 1999/07/09 13:35:23 aaron Exp $
d57 2
a58 3
function
returns a pointer to a stream associated with a file descriptor returned
by the routine
d67 1
a67 1
.Em "S_IRUSR|S_IWUSR",
d78 1
a78 2
function
returns a pointer to a file name, in the
d80 2
a81 3
directory, which
did not reference an existing file at some indeterminate point in the
past.
d87 1
a87 3
is
.Pf non- Dv NULL ,
the file name is copied to the buffer it references.
d104 1
a104 2
function
is similar to
d113 1
a113 2
(if
.Pf non- Dv NULL ) ,
d123 1
a123 3
if
.Pf non- Dv NULL ,
is used to specify a file name prefix, which will be the
d132 2
a133 5
function
returns a pointer to an open file stream on success, and a
.Dv NULL
pointer
on error.
d139 1
a139 4
functions
return a pointer to a file name on success, and a
.Dv NULL
pointer
d144 1
a144 2
function
may fail and set the global variable
d153 1
a153 2
function
may fail and set
d160 1
a160 2
function
may fail and set
d174 1
a174 2
functions
conform to
d225 1
a225 2
will output a warning message whenever it links code that uses the
functions
@


1.6
log
@- remove all trailing whitespace
     * except when it is escaped with a `\' at the end of the line
- fix remaining .Nm usage as well
- this is from a patch I received from kwesterback@@home.com, who has been
  working on some scripts for fixing formatting errors in mdoc'd man pages

Ok, so there could be a cost/benefit debate with this commit, but since I have
the patch we might as well commit it...
@
text
@d1 1
a1 1
.\"	$OpenBSD: tmpnam.3,v 1.5 1999/02/27 21:55:50 deraadt Exp $
d89 1
a89 1
.Fa s
d99 1
a99 1
.Fa s
@


1.5
log
@make function names the correct case
@
text
@d1 1
a1 1
.\"	$OpenBSD: tmpnam.3,v 1.4 1998/03/12 20:17:42 deraadt Exp $
d98 1
a98 1
The buffer referenced by 
d245 1
a245 1
functions 
@


1.4
log
@minor glitch
@
text
@d1 1
a1 1
.\"	$OpenBSD: tmpnam.3,v 1.3 1998/03/12 20:03:54 deraadt Exp $
d134 1
a134 1
.Fn Tempnam
@


1.3
log
@explain security considerations in some detail
@
text
@d1 1
a1 1
.\"	$OpenBSD: tmpnam.3,v 1.2 1996/08/19 08:33:09 tholo Exp $
d214 1
a214 1
.Fn tmpnam Ns , or
@


1.2
log
@Fix RCS ids
Make sure everything uses {SYS,}LIBC_SCCS properly
@
text
@d1 1
a1 1
.\"	$OpenBSD: tmpnam.3,v 1.3 1995/02/02 01:15:57 jtc Exp $
d65 9
d196 4
a199 1
These interfaces are provided for System V and
d202 1
d212 14
a225 1
creation and deletion.
d234 2
a235 2
This has obvious ramifications for setuid or setgid programs, complicating
the portable use of these interfaces in such programs.
d241 8
a248 5
In particular, the
.Fn tmpfile
interface should not be used in software expected to be used on other systems
if there is any possibility that the user does not wish the temporary file to
be publicly readable and writable.
@


1.1
log
@Initial revision
@
text
@d1 1
a1 1
.\"	$NetBSD: tmpnam.3,v 1.3 1995/02/02 01:15:57 jtc Exp $
a36 2
.\"
.\"     @@(#)tmpnam.3	8.2 (Berkeley) 11/17/93
@


1.1.1.1
log
@initial import of NetBSD tree
@
text
@@

