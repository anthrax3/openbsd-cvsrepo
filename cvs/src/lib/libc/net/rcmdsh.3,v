head	1.18;
access;
symbols
	OPENBSD_6_2_BASE:1.18
	OPENBSD_6_1:1.18.0.6
	OPENBSD_6_1_BASE:1.18
	OPENBSD_6_0:1.18.0.2
	OPENBSD_6_0_BASE:1.18
	OPENBSD_5_9:1.17.0.2
	OPENBSD_5_9_BASE:1.17
	OPENBSD_5_8:1.17.0.4
	OPENBSD_5_8_BASE:1.17
	OPENBSD_5_7:1.16.0.2
	OPENBSD_5_7_BASE:1.16
	OPENBSD_5_6:1.16.0.4
	OPENBSD_5_6_BASE:1.16
	OPENBSD_5_5:1.14.0.6
	OPENBSD_5_5_BASE:1.14
	OPENBSD_5_4:1.14.0.2
	OPENBSD_5_4_BASE:1.14
	OPENBSD_5_3:1.13.0.14
	OPENBSD_5_3_BASE:1.13
	OPENBSD_5_2:1.13.0.12
	OPENBSD_5_2_BASE:1.13
	OPENBSD_5_1_BASE:1.13
	OPENBSD_5_1:1.13.0.10
	OPENBSD_5_0:1.13.0.8
	OPENBSD_5_0_BASE:1.13
	OPENBSD_4_9:1.13.0.6
	OPENBSD_4_9_BASE:1.13
	OPENBSD_4_8:1.13.0.4
	OPENBSD_4_8_BASE:1.13
	OPENBSD_4_7:1.13.0.2
	OPENBSD_4_7_BASE:1.13
	OPENBSD_4_6:1.12.0.12
	OPENBSD_4_6_BASE:1.12
	OPENBSD_4_5:1.12.0.8
	OPENBSD_4_5_BASE:1.12
	OPENBSD_4_4:1.12.0.6
	OPENBSD_4_4_BASE:1.12
	OPENBSD_4_3:1.12.0.4
	OPENBSD_4_3_BASE:1.12
	OPENBSD_4_2:1.12.0.2
	OPENBSD_4_2_BASE:1.12
	OPENBSD_4_1:1.11.0.16
	OPENBSD_4_1_BASE:1.11
	OPENBSD_4_0:1.11.0.14
	OPENBSD_4_0_BASE:1.11
	OPENBSD_3_9:1.11.0.12
	OPENBSD_3_9_BASE:1.11
	OPENBSD_3_8:1.11.0.10
	OPENBSD_3_8_BASE:1.11
	OPENBSD_3_7:1.11.0.8
	OPENBSD_3_7_BASE:1.11
	OPENBSD_3_6:1.11.0.6
	OPENBSD_3_6_BASE:1.11
	OPENBSD_3_5:1.11.0.4
	OPENBSD_3_5_BASE:1.11
	OPENBSD_3_4:1.11.0.2
	OPENBSD_3_4_BASE:1.11
	OPENBSD_3_3:1.8.0.10
	OPENBSD_3_3_BASE:1.8
	OPENBSD_3_2:1.8.0.8
	OPENBSD_3_2_BASE:1.8
	OPENBSD_3_1:1.8.0.6
	OPENBSD_3_1_BASE:1.8
	OPENBSD_3_0:1.8.0.4
	OPENBSD_3_0_BASE:1.8
	OPENBSD_2_9:1.8.0.2
	OPENBSD_2_9_BASE:1.8
	OPENBSD_2_8:1.7.0.4
	OPENBSD_2_8_BASE:1.7
	OPENBSD_2_7:1.7.0.2
	OPENBSD_2_7_BASE:1.7
	OPENBSD_2_6:1.6.0.2
	OPENBSD_2_6_BASE:1.6
	OPENBSD_2_5:1.3.0.4
	OPENBSD_2_5_BASE:1.3
	OPENBSD_2_4:1.3.0.2
	OPENBSD_2_4_BASE:1.3
	OPENBSD_2_3:1.2.0.2
	OPENBSD_2_3_BASE:1.2
	OPENBSD_2_2:1.1.0.6
	OPENBSD_2_2_BASE:1.1
	OPENBSD_2_1:1.1.0.4
	OPENBSD_2_1_BASE:1.1
	OPENBSD_2_0:1.1.0.2
	OPENBSD_2_0_BASE:1.1;
locks; strict;
comment	@# @;


1.18
date	2016.05.28.15.48.30;	author millert;	state Exp;
branches;
next	1.17;
commitid	dx73mL1wLPoHaoc3;

1.17
date	2015.03.23.22.29.32;	author halex;	state Exp;
branches;
next	1.16;
commitid	Gu7ZLHEzDGVTpwP4;

1.16
date	2014.04.19.18.11.19;	author tedu;	state Exp;
branches;
next	1.15;

1.15
date	2014.04.18.22.04.54;	author jmc;	state Exp;
branches;
next	1.14;

1.14
date	2013.06.05.03.39.23;	author tedu;	state Exp;
branches;
next	1.13;

1.13
date	2009.12.29.10.25.43;	author sobrado;	state Exp;
branches;
next	1.12;

1.12
date	2007.05.31.19.19.30;	author jmc;	state Exp;
branches;
next	1.11;

1.11
date	2003.06.02.20.18.35;	author millert;	state Exp;
branches;
next	1.10;

1.10
date	2003.05.30.21.37.59;	author jmc;	state Exp;
branches;
next	1.9;

1.9
date	2003.05.05.22.13.03;	author millert;	state Exp;
branches;
next	1.8;

1.8
date	2000.12.24.00.30.56;	author aaron;	state Exp;
branches;
next	1.7;

1.7
date	2000.02.23.17.28.25;	author aaron;	state Exp;
branches;
next	1.6;

1.6
date	99.07.05.04.41.00;	author aaron;	state Exp;
branches;
next	1.5;

1.5
date	99.07.02.17.04.16;	author aaron;	state Exp;
branches;
next	1.4;

1.4
date	99.05.23.14.11.02;	author aaron;	state Exp;
branches;
next	1.3;

1.3
date	98.06.26.17.54.09;	author millert;	state Exp;
branches;
next	1.2;

1.2
date	98.03.07.22.18.05;	author millert;	state Exp;
branches;
next	1.1;

1.1
date	96.09.01.21.25.35;	author millert;	state Exp;
branches;
next	;


desc
@@


1.18
log
@rcmd(3) and rcmdsh(3) use getaddrinfo(3) not gethostbyname(3).
@
text
@.\"	$OpenBSD: rcmdsh.3,v 1.17 2015/03/23 22:29:32 halex Exp $
.\"
.\" Copyright (c) 1983, 1991, 1993
.\"	The Regents of the University of California.  All rights reserved.
.\"
.\" Redistribution and use in source and binary forms, with or without
.\" modification, are permitted provided that the following conditions
.\" are met:
.\" 1. Redistributions of source code must retain the above copyright
.\"    notice, this list of conditions and the following disclaimer.
.\" 2. Redistributions in binary form must reproduce the above copyright
.\"    notice, this list of conditions and the following disclaimer in the
.\"    documentation and/or other materials provided with the distribution.
.\" 3. Neither the name of the University nor the names of its contributors
.\"    may be used to endorse or promote products derived from this software
.\"    without specific prior written permission.
.\"
.\" THIS SOFTWARE IS PROVIDED BY THE REGENTS AND CONTRIBUTORS ``AS IS'' AND
.\" ANY EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT LIMITED TO, THE
.\" IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE
.\" ARE DISCLAIMED.  IN NO EVENT SHALL THE REGENTS OR CONTRIBUTORS BE LIABLE
.\" FOR ANY DIRECT, INDIRECT, INCIDENTAL, SPECIAL, EXEMPLARY, OR CONSEQUENTIAL
.\" DAMAGES (INCLUDING, BUT NOT LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS
.\" OR SERVICES; LOSS OF USE, DATA, OR PROFITS; OR BUSINESS INTERRUPTION)
.\" HOWEVER CAUSED AND ON ANY THEORY OF LIABILITY, WHETHER IN CONTRACT, STRICT
.\" LIABILITY, OR TORT (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY
.\" OUT OF THE USE OF THIS SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF
.\" SUCH DAMAGE.
.\"
.Dd $Mdocdate: March 23 2015 $
.Dt RCMDSH 3
.Os
.Sh NAME
.Nm rcmdsh
.Nd return a stream to a remote command without superuser
.Sh SYNOPSIS
.In unistd.h
.Ft int
.Fn rcmdsh "char **ahost" "int inport" "const char *locuser" "const char *remuser" "const char *cmd" "char *rshprog"
.Sh DESCRIPTION
The
.Fn rcmdsh
function is used by normal users to execute a command on a remote machine
using an authentication scheme based on reserved port numbers using
.Xr ssh 1
or the value of
.Fa rshprog
(if non-null).
.Fa rshprog
may be a fully-qualified path, a non-qualified command, or a command containing
space-separated command line arguments.
.Pp
The
.Fn rcmdsh
function looks up the host
.Fa *ahost
using
.Xr getaddrinfo 3
and, if the host exists,
.Fa *ahost
is set to the canonical name of the host.
A connection is then established to
a server residing at the well-known Internet port
.Li shell/tcp
(or whatever port is used by
.Fa rshprog ) .
The parameter
.Fa inport
is ignored; it is only included to provide an interface similar to
.Xr rcmd 3 .
.Pp
If the connection succeeds, a socket in the
.Ux Ns -domain
of type
.Dv SOCK_STREAM
is returned to the caller, and given to the remote
command as stdin and stdout, and stderr.
.Sh DIAGNOSTICS
The
.Fn rcmdsh
function returns a valid socket descriptor on success.
It returns \-1 on error and prints a diagnostic message on the standard error.
.Sh SEE ALSO
.Xr ssh 1 ,
.Xr socketpair 2 ,
.Xr rcmd 3
.Sh HISTORY
The
.Fn rcmdsh
function first appeared in
.Ox 2.0 .
.Sh BUGS
If
.Xr ssh 1
encounters an error, a file descriptor is still returned instead of \-1.
@


1.17
log
@Make rcmdsh(3) not fail if it is passed a non resolvable hostname.
Instead, silently ignore the fact and instead let the underlying
ssh (or $RSH) command handle it.

ok millert@@
@
text
@d1 1
a1 1
.\"	$OpenBSD: rcmdsh.3,v 1.16 2014/04/19 18:11:19 tedu Exp $
d30 1
a30 1
.Dd $Mdocdate: April 19 2014 $
d58 1
a58 1
.Xr gethostbyname 3
d61 1
a61 1
is set to the standard name of the host.
@


1.16
log
@change some rsh references to ssh. poke by jmc
@
text
@d1 1
a1 1
.\"	$OpenBSD: rcmdsh.3,v 1.15 2014/04/18 22:04:54 jmc Exp $
d30 1
a30 1
.Dd $Mdocdate: April 18 2014 $
d58 2
a59 3
.Xr gethostbyname 3 ,
returning \-1 if the host does not exist.
Otherwise
d61 2
a62 1
is set to the standard name of the host and a connection is established to
@


1.15
log
@remove references to rshd;
@
text
@d1 1
a1 1
.\"	$OpenBSD: rcmdsh.3,v 1.14 2013/06/05 03:39:23 tedu Exp $
d30 1
a30 1
.Dd $Mdocdate: June 5 2013 $
d45 1
a45 1
.Xr rsh 1
d84 1
a84 1
.Xr rsh 1 ,
d94 1
a94 1
.Xr rsh 1
@


1.14
log
@Use the fancy .In macro for includes. From Jan Klemkow. ok jmc schwarze
@
text
@d1 1
a1 1
.\"	$OpenBSD: rcmdsh.3,v 1.13 2009/12/29 10:25:43 sobrado Exp $
d30 1
a30 1
.Dd $Mdocdate: December 29 2009 $
d86 1
a86 2
.Xr rcmd 3 ,
.Xr rshd 8
@


1.13
log
@replace a few remaining UNIX terms with .Ux macros; this diff
completes the changes from Oct 22.
@
text
@d1 1
a1 1
.\"	$OpenBSD: rcmdsh.3,v 1.12 2007/05/31 19:19:30 jmc Exp $
d30 1
a30 1
.Dd $Mdocdate: May 31 2007 $
d37 1
a37 1
.Fd #include <unistd.h>
@


1.12
log
@convert to new .Dd format;
@
text
@d1 1
a1 1
.\"	$OpenBSD: rcmdsh.3,v 1.11 2003/06/02 20:18:35 millert Exp $
d30 1
a30 1
.Dd $Mdocdate$
d73 2
a74 2
.Tn UNIX
domain of type
@


1.11
log
@Remove the advertising clause in the UCB license which Berkeley
rescinded 22 July 1999.  Proofed by myself and Theo.
@
text
@d1 1
a1 1
.\"	$OpenBSD: rcmdsh.3,v 1.10 2003/05/30 21:37:59 jmc Exp $
d30 1
a30 1
.Dd May 5, 2003
@


1.10
log
@- section reorder
- macro cleanup
@
text
@d1 1
a1 1
.\"	$OpenBSD: rcmdsh.3,v 1.9 2003/05/05 22:13:03 millert Exp $
d14 1
a14 5
.\" 3. All advertising materials mentioning features or use of this software
.\"    must display the following acknowledgement:
.\"	This product includes software developed by the University of
.\"	California, Berkeley and its contributors.
.\" 4. Neither the name of the University nor the names of its contributors
@


1.9
log
@Add support for command line args in rshprog, e.g. "ssh -C".
@
text
@d1 1
a1 1
.\"	$OpenBSD: rcmdsh.3,v 1.8 2000/12/24 00:30:56 aaron Exp $
a91 4
.Sh BUGS
If
.Xr rsh 1
encounters an error, a file descriptor is still returned instead of \-1.
d97 4
@


1.8
log
@Various repairs, mostly to get rid of short lines.
@
text
@d1 1
a1 1
.\"	$OpenBSD: rcmdsh.3,v 1.7 2000/02/23 17:28:25 aaron Exp $
d34 1
a34 1
.Dd September 1, 1996
d49 1
a49 1
.Xr rshd 8
d53 3
@


1.7
log
@Small bits of clean-up.
@
text
@d1 1
a1 1
.\"	$OpenBSD: rcmdsh.3,v 1.6 1999/07/05 04:41:00 aaron Exp $
d47 2
a48 4
function
is used by normal users to execute a command on
a remote machine using an authentication scheme based
on reserved port numbers using
d56 1
a56 2
function
looks up the host
d63 2
a64 3
is set to the standard name of the host
and a connection is established to a server
residing at the well-known Internet port
d73 1
a73 2
If the connection succeeds,
a socket in the
d82 1
a82 2
function
returns a valid socket descriptor on success.
@


1.6
log
@repairs; better English, formatting, etc.
@
text
@d1 1
a1 1
.\"	$OpenBSD: rcmdsh.3,v 1.5 1999/07/02 17:04:16 aaron Exp $
d71 2
a72 2
.Fa rshprog
).  The parameter
d98 1
a98 1
gets an error a file descriptor is still returned instead of \-1.
@


1.5
log
@.Dd should not be given abbreviated month names
@
text
@d1 1
a1 1
.\"	$OpenBSD: rcmdsh.3,v 1.4 1999/05/23 14:11:02 aaron Exp $
d54 1
a54 1
(if non-NULL).
d83 1
a83 6
command as 
.Em stdin
and
.Em stdout ,
and
.Em stderr .
@


1.4
log
@remove argument from .Os macros so value in /usr/share/tmac/mdoc/doc-common
is used instead; kwesterback@@home.com
@
text
@d1 1
a1 1
.\"	$OpenBSD: rcmdsh.3,v 1.3 1998/06/26 17:54:09 millert Exp $
d34 1
a34 1
.Dd Sep 1, 1996
@


1.3
log
@rcmdsh, not rcmd
@
text
@d1 1
a1 1
.\"	$OpenBSD: rcmdsh.3,v 1.2 1998/03/07 22:18:05 millert Exp $
d36 1
a36 1
.Os OpenBSD
@


1.2
log
@.Bx Open -> .Ox 2.x
@
text
@d1 1
a1 1
.\"	$OpenBSD: rcmdsh.3,v 1.1 1996/09/01 21:25:35 millert Exp $
d38 2
a39 2
.Nm rcmd
.Nd return a stream to a remote command as unprivileged user
@


1.1
log
@First cut at man page for rcmdsh()
@
text
@d1 1
a1 1
.\"	$OpenBSD: rcmdsh.3,v 1.4 1996/08/19 08:29:37 tholo Exp $
d108 1
a108 1
.Bx Open .
@

