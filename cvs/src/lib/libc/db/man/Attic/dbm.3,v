head	1.16;
access;
symbols
	OPENBSD_5_9:1.15.0.2
	OPENBSD_5_9_BASE:1.15
	OPENBSD_5_8:1.13.0.12
	OPENBSD_5_8_BASE:1.13
	OPENBSD_5_7:1.13.0.4
	OPENBSD_5_7_BASE:1.13
	OPENBSD_5_6:1.13.0.8
	OPENBSD_5_6_BASE:1.13
	OPENBSD_5_5:1.13.0.6
	OPENBSD_5_5_BASE:1.13
	OPENBSD_5_4:1.13.0.2
	OPENBSD_5_4_BASE:1.13
	OPENBSD_5_3:1.11.0.24
	OPENBSD_5_3_BASE:1.11
	OPENBSD_5_2:1.11.0.22
	OPENBSD_5_2_BASE:1.11
	OPENBSD_5_1_BASE:1.11
	OPENBSD_5_1:1.11.0.20
	OPENBSD_5_0:1.11.0.18
	OPENBSD_5_0_BASE:1.11
	OPENBSD_4_9:1.11.0.16
	OPENBSD_4_9_BASE:1.11
	OPENBSD_4_8:1.11.0.14
	OPENBSD_4_8_BASE:1.11
	OPENBSD_4_7:1.11.0.10
	OPENBSD_4_7_BASE:1.11
	OPENBSD_4_6:1.11.0.12
	OPENBSD_4_6_BASE:1.11
	OPENBSD_4_5:1.11.0.8
	OPENBSD_4_5_BASE:1.11
	OPENBSD_4_4:1.11.0.6
	OPENBSD_4_4_BASE:1.11
	OPENBSD_4_3:1.11.0.4
	OPENBSD_4_3_BASE:1.11
	OPENBSD_4_2:1.11.0.2
	OPENBSD_4_2_BASE:1.11
	OPENBSD_4_1:1.10.0.8
	OPENBSD_4_1_BASE:1.10
	OPENBSD_4_0:1.10.0.6
	OPENBSD_4_0_BASE:1.10
	OPENBSD_3_9:1.10.0.4
	OPENBSD_3_9_BASE:1.10
	OPENBSD_3_8:1.10.0.2
	OPENBSD_3_8_BASE:1.10
	OPENBSD_3_7:1.9.0.4
	OPENBSD_3_7_BASE:1.9
	OPENBSD_3_6:1.9.0.2
	OPENBSD_3_6_BASE:1.9
	OPENBSD_3_5:1.8.0.4
	OPENBSD_3_5_BASE:1.8
	OPENBSD_3_4:1.8.0.2
	OPENBSD_3_4_BASE:1.8
	OPENBSD_3_3:1.6.0.14
	OPENBSD_3_3_BASE:1.6
	OPENBSD_3_2:1.6.0.12
	OPENBSD_3_2_BASE:1.6
	OPENBSD_3_1:1.6.0.10
	OPENBSD_3_1_BASE:1.6
	OPENBSD_3_0:1.6.0.8
	OPENBSD_3_0_BASE:1.6
	OPENBSD_2_9:1.6.0.6
	OPENBSD_2_9_BASE:1.6
	OPENBSD_2_8:1.6.0.4
	OPENBSD_2_8_BASE:1.6
	OPENBSD_2_7:1.6.0.2
	OPENBSD_2_7_BASE:1.6
	OPENBSD_2_6:1.5.0.2
	OPENBSD_2_6_BASE:1.5
	OPENBSD_2_5:1.1.0.2
	OPENBSD_2_5_BASE:1.1;
locks; strict;
comment	@.\" @;


1.16
date	2016.05.07.21.58.07;	author tedu;	state dead;
branches;
next	1.15;
commitid	OMuRQlskknJ9fp2M;

1.15
date	2015.11.30.17.03.05;	author jmc;	state Exp;
branches;
next	1.14;
commitid	34hNwlxcxhcYPM8K;

1.14
date	2015.11.10.23.48.17;	author jmc;	state Exp;
branches;
next	1.13;
commitid	QU70QaxjyBAtj4Rv;

1.13
date	2013.07.17.05.42.10;	author schwarze;	state Exp;
branches;
next	1.12;

1.12
date	2013.06.05.03.39.22;	author tedu;	state Exp;
branches;
next	1.11;

1.11
date	2007.05.31.19.19.27;	author jmc;	state Exp;
branches;
next	1.10;

1.10
date	2005.07.17.09.10.36;	author jaredy;	state Exp;
branches;
next	1.9;

1.9
date	2004.05.03.17.27.50;	author millert;	state Exp;
branches;
next	1.8;

1.8
date	2003.06.17.21.56.23;	author millert;	state Exp;
branches;
next	1.7;

1.7
date	2003.06.03.01.52.39;	author millert;	state Exp;
branches;
next	1.6;

1.6
date	2000.04.18.02.31.35;	author aaron;	state Exp;
branches;
next	1.5;

1.5
date	99.07.07.10.50.04;	author aaron;	state Exp;
branches;
next	1.4;

1.4
date	99.07.02.17.04.15;	author aaron;	state Exp;
branches;
next	1.3;

1.3
date	99.05.23.14.10.59;	author aaron;	state Exp;
branches;
next	1.2;

1.2
date	99.04.18.17.08.10;	author millert;	state Exp;
branches;
next	1.1;

1.1
date	99.02.15.05.11.24;	author millert;	state Exp;
branches;
next	;


desc
@@


1.16
log
@remove ancient dbm functions (ndbm remains). nothing uses them in forever.
@
text
@.\" $OpenBSD: dbm.3,v 1.15 2015/11/30 17:03:05 jmc Exp $
.\"
.\" Copyright (c) 1999 Todd C. Miller <Todd.Miller@@courtesan.com>
.\"
.\" Permission to use, copy, modify, and distribute this software for any
.\" purpose with or without fee is hereby granted, provided that the above
.\" copyright notice and this permission notice appear in all copies.
.\"
.\" THE SOFTWARE IS PROVIDED "AS IS" AND THE AUTHOR DISCLAIMS ALL WARRANTIES
.\" WITH REGARD TO THIS SOFTWARE INCLUDING ALL IMPLIED WARRANTIES OF
.\" MERCHANTABILITY AND FITNESS. IN NO EVENT SHALL THE AUTHOR BE LIABLE FOR
.\" ANY SPECIAL, DIRECT, INDIRECT, OR CONSEQUENTIAL DAMAGES OR ANY DAMAGES
.\" WHATSOEVER RESULTING FROM LOSS OF USE, DATA OR PROFITS, WHETHER IN AN
.\" ACTION OF CONTRACT, NEGLIGENCE OR OTHER TORTIOUS ACTION, ARISING OUT OF
.\" OR IN CONNECTION WITH THE USE OR PERFORMANCE OF THIS SOFTWARE.
.\"
.Dd $Mdocdate: November 30 2015 $
.Dt DBMINIT 3
.Os
.Sh NAME
.Nm dbminit ,
.Nm dbmclose ,
.Nm fetch ,
.Nm store ,
.Nm delete ,
.Nm firstkey ,
.Nm nextkey
.Nd database subroutines
.Sh SYNOPSIS
.In dbm.h
.Ft int
.Fn dbminit "const char *file"
.Ft int
.Fn dbmclose "void"
.Ft datum
.Fn fetch "datum key"
.Ft int
.Fn store "datum key" "datum content"
.Ft int
.Fn delete "datum key"
.Ft datum
.Fn firstkey "void"
.Ft datum
.Fn nextkey "datum key"
.Sh DESCRIPTION
These functions provide a dbm-compatible interface to the
database access methods described in
.Xr dbopen 3 .
Each unique record in the database is a key/content pair,
the components of which may be any arbitrary binary data.
The key and the content data are described by the
.Ft datum
data structure:
.Bd -literal -offset indent
typedef struct {
	void *dptr;
	size_t dsize;
} datum;
.Ed
.Pp
The
.Fn dbminit
function is used to open a database.
Before the call to
.Fn dbminit ,
the files
.Pa file.pag
and
.Pa file.dir
must exist.
The user is responsible for creating the zero-length
.Pa \&.pag
and
.Pa \&.dir
files.
.Pp
Once the database is open,
.Fn fetch
is used to retrieve the data content associated with the specified
.Fa key .
Similarly,
.Fn store
is used to store the
.Fa content
data with the specified
.Fa key .
.Pp
The
.Fn delete
function removes the specified
.Fa key
and its associated content from the database.
.Pp
The functions
.Fn firstkey
and
.Fn nextkey
are used to iterate over all of the records in the database.
Each record will be reached exactly once, but in no particular order.
The
.Fn firstkey
function returns the first record of the database, and thereafter
.Fn nextkey
returns the following records.
The following code traverses the entire database:
.Bd -literal -offset indent
for (key = firstkey(); key.dptr != NULL; key = nextkey(key))
.Ed
.Pp
The behaviour of
.Fn nextkey
is undefined if the database is modified after a call to
.Fn firstkey .
.Pp
The database is closed with the
.Fn dbmclose
function (it must be closed before a new one can be opened).
.Ss Implementation notes
The underlying database is a
.Xr hash 3
database with a
bucket size of 4096,
a filling factor of 40,
default hashing function and cache size,
and uses the host's native byte order.
.Sh RETURN VALUES
Upon successful completion, all functions that return
.Ft int
return a value of 0, otherwise a negative value is returned.
.Pp
Functions that return a
.Ft datum
indicate errors by setting the
.Va dptr
field to
.Dv NULL .
.Sh SEE ALSO
.Xr dbopen 3 ,
.Xr hash 3 ,
.Xr ndbm 3
.Sh HISTORY
The functions
.Fn dbminit ,
.Fn fetch ,
.Fn store ,
.Fn delete ,
.Fn firstkey ,
and
.Fn nextkey
first appeared in
.At v7 .
.Sh BUGS
Because the
.Nm dbm
routines are implemented on top of those described in
.Xr dbopen 3 ,
only a single file,
.Pa file.pag ,
is used to actually store the database.
The references to
.Pa file.dir
are purely for backwards compatibility with historic implementations.
@


1.15
log
@change Xrs from now-defunct db(3) to dbopen(3); this wasn;t a
straight replace: thanks both to schwarze and maja for feedback
on how to rewrite parts;

i've snuck in an rcs id->openbsd id change in dev_mkdb too;
@
text
@d1 1
a1 1
.\" $OpenBSD: dbm.3,v 1.14 2015/11/10 23:48:17 jmc Exp $
d17 1
a17 1
.Dd $Mdocdate: November 10 2015 $
@


1.14
log
@update NAME section to include all documented functions,
or otherwise change Dt to reflect the name of an existing function;

feedback/ok schwarze
@
text
@d1 1
a1 1
.\" $OpenBSD: dbm.3,v 1.13 2013/07/17 05:42:10 schwarze Exp $
d17 1
a17 1
.Dd $Mdocdate: July 17 2013 $
d48 1
a48 1
.Xr db 3 .
d138 1
a138 1
.Xr db 3 ,
d155 2
a156 2
routines are implemented on top of
.Xr db 3 ,
@


1.13
log
@more library history
facts checked by sobrado@@
style tweaks and ok jmc@@
@
text
@d1 1
a1 1
.\" $OpenBSD: dbm.3,v 1.12 2013/06/05 03:39:22 tedu Exp $
d17 2
a18 2
.Dd $Mdocdate: June 5 2013 $
.Dt DBM 3
@


1.12
log
@Use the fancy .In macro for includes. From Jan Klemkow. ok jmc schwarze
@
text
@d1 1
a1 1
.\" $OpenBSD: dbm.3,v 1.11 2007/05/31 19:19:27 jmc Exp $
d17 1
a17 1
.Dd $Mdocdate: May 31 2007 $
d141 11
@


1.11
log
@convert to new .Dd format;
@
text
@d1 1
a1 1
.\" $OpenBSD: dbm.3,v 1.10 2005/07/17 09:10:36 jaredy Exp $
d17 1
a17 1
.Dd $Mdocdate$
d30 1
a30 1
.Fd #include <dbm.h>
@


1.10
log
@- punctuation, macro, layout, wording improvements
- avoid first person
- document dbm_rdonly
- update some error return values in the mpool(3) routines
- sync header file excerpts

ok jmc
@
text
@d1 1
a1 1
.\" $OpenBSD: dbm.3,v 1.9 2004/05/03 17:27:50 millert Exp $
d17 1
a17 1
.Dd February 14, 1999
@


1.9
log
@Make ndbm match POSIX.  A datum consists of a void *dptr and a size_t dsize.
Also make the open functions take a mode_t, not int.  OK deraadt@@
@
text
@d1 1
a1 1
.\" $OpenBSD: dbm.3,v 1.8 2003/06/17 21:56:23 millert Exp $
d58 1
a58 1
} datum
d106 2
a107 2
.Bd -literal
  for (key = firstkey(); key.dptr != NULL; key = nextkey(key))
d117 1
a117 1
function (you must close a database before opening a new one).
d144 1
a144 1
routines are implemented on top of the
@


1.8
log
@Sync with share/misc/license.template and add missing DARPA credit
where applicable.
@
text
@d1 1
a1 1
.\" $OpenBSD: dbm.3,v 1.7 2003/06/03 01:52:39 millert Exp $
d56 2
a57 2
	char *dptr;
	int dsize;
@


1.7
log
@Use an ISC-tyle license for all my code; it is simpler and more permissive.
@
text
@d1 1
a1 1
.\" $OpenBSD: dbm.3,v 1.6 2000/04/18 02:31:35 aaron Exp $
d9 7
a15 7
.\" THE SOFTWARE IS PROVIDED "AS IS" AND TODD C. MILLER DISCLAIMS ALL
.\" WARRANTIES WITH REGARD TO THIS SOFTWARE INCLUDING ALL IMPLIED WARRANTIES
.\" OF MERCHANTABILITY AND FITNESS. IN NO EVENT SHALL TODD C. MILLER BE LIABLE
.\" FOR ANY SPECIAL, DIRECT, INDIRECT, OR CONSEQUENTIAL DAMAGES OR ANY DAMAGES
.\" WHATSOEVER RESULTING FROM LOSS OF USE, DATA OR PROFITS, WHETHER IN AN ACTION
.\" OF CONTRACT, NEGLIGENCE OR OTHER TORTIOUS ACTION, ARISING OUT OF OR IN
.\" CONNECTION WITH THE USE OR PERFORMANCE OF THIS SOFTWARE.
@


1.6
log
@Repairs.
@
text
@d1 1
a1 1
.\" $OpenBSD: dbm.3,v 1.5 1999/07/07 10:50:04 aaron Exp $
a3 1
.\" All rights reserved.
d5 3
a7 10
.\" Redistribution and use in source and binary forms, with or without
.\" modification, are permitted provided that the following conditions
.\" are met:
.\" 1. Redistributions of source code must retain the above copyright
.\"    notice, this list of conditions and the following disclaimer.
.\" 2. Redistributions in binary form must reproduce the above copyright
.\"    notice, this list of conditions and the following disclaimer in the
.\"    documentation and/or other materials provided with the distribution.
.\" 3. The name of the author may not be used to endorse or promote products
.\"    derived from this software without specific prior written permission.
d9 7
a15 10
.\" THIS SOFTWARE IS PROVIDED ``AS IS'' AND ANY EXPRESS OR IMPLIED WARRANTIES,
.\" INCLUDING, BUT NOT LIMITED TO, THE IMPLIED WARRANTIES OF MERCHANTABILITY
.\" AND FITNESS FOR A PARTICULAR PURPOSE ARE DISCLAIMED.  IN NO EVENT SHALL
.\" THE AUTHOR BE LIABLE FOR ANY DIRECT, INDIRECT, INCIDENTAL, SPECIAL,
.\" EXEMPLARY, OR CONSEQUENTIAL DAMAGES (INCLUDING, BUT NOT LIMITED TO,
.\" PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES; LOSS OF USE, DATA, OR PROFITS;
.\" OR BUSINESS INTERRUPTION) HOWEVER CAUSED AND ON ANY THEORY OF LIABILITY,
.\" WHETHER IN CONTRACT, STRICT LIABILITY, OR TORT (INCLUDING NEGLIGENCE OR
.\" OTHERWISE) ARISING IN ANY WAY OUT OF THE USE OF THIS SOFTWARE, EVEN IF
.\" ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.
@


1.5
log
@The proper order of the ``introductory'' macros in a man page is .Dd/.Dt/.Os.
Out of the approximately 1450 man pages, only about 90 of them were wrong.
Thanks to kwesterback@@home.com for coming up with a script and patch to repair
this. The patch also inserted a .Os macro in the few man pages that were
missing one.
@
text
@d1 1
a1 1
.\" $OpenBSD: dbm.3,v 1.4 1999/07/02 17:04:15 aaron Exp $
a31 1
.Nm dbm ,
d33 1
d38 1
a38 2
.Nm nextkey ,
.Nm dbmclose
d74 2
a75 1
function is used to open a database.  Before the call to
d78 1
a78 1
.Fa file.pag
d80 7
a86 3
.Fa file.dir
must exist.  The user is responsible for creating the zero-length
\&.pag and .dir files.
d90 1
a90 1
is used to retrieve the data content associated with the key
d96 1
a96 1
data with the key
d101 1
a101 1
function removes the key
d158 4
a161 3
.Ar file.pag ,
is used to actually store the database.  The references to
.Ar file.dir
@


1.4
log
@.Dd should not be given abbreviated month names
@
text
@d1 1
a1 1
.\" $OpenBSD: dbm.3,v 1.3 1999/05/23 14:10:59 aaron Exp $
d29 1
a30 1
.Dt DBM 3
@


1.3
log
@remove argument from .Os macros so value in /usr/share/tmac/mdoc/doc-common
is used instead; kwesterback@@home.com
@
text
@d1 1
a1 1
.\" $OpenBSD: dbm.3,v 1.2 1999/04/18 17:08:10 millert Exp $
d28 1
a28 1
.Dd Feb 14, 1999
@


1.2
log
@o Opening a zero-length hash file should not be an error
o Correct odbm support
o Add man links for ndbm and odbm
@
text
@d1 1
a1 1
.\" $OpenBSD: dbm.3,v 1.1 1999/02/15 05:11:24 millert Exp $
d29 1
a29 1
.Os OpenBSD
@


1.1
log
@ o Minor changes from db.1.86 (sleepycat).  Does not include the new hash
   routines since they cannot read a hashed .db file from the old code.
   Most of these files just have their RCS/SCCS tags standardized.
   Note that mpool.3 has not been updated to reflect the new mpool interface.
 o Add a real dbm(3) manpage
@
text
@d1 1
a1 1
.\" $OpenBSD$
d75 8
a82 6
function is used to open a database in the file named by
.Fa file ,
suffixed with
.Dv DBM_SUFFIX
.Pq Sq Pa .db .
The file is created if it does not already exist.
d142 1
a142 1
field set to
d146 12
a157 2
.Xr ndbm 3 ,
.Xr hash 3
@

