head	1.8;
access;
symbols
	OPENBSD_6_0:1.8.0.8
	OPENBSD_6_0_BASE:1.8
	OPENBSD_5_9:1.8.0.4
	OPENBSD_5_9_BASE:1.8
	OPENBSD_5_8:1.8.0.6
	OPENBSD_5_8_BASE:1.8
	OPENBSD_5_7:1.8.0.2
	OPENBSD_5_7_BASE:1.8
	OPENBSD_5_6:1.6.0.8
	OPENBSD_5_6_BASE:1.6
	OPENBSD_5_5:1.6.0.6
	OPENBSD_5_5_BASE:1.6
	OPENBSD_5_4:1.6.0.2
	OPENBSD_5_4_BASE:1.6
	OPENBSD_5_3:1.5.0.4
	OPENBSD_5_3_BASE:1.5
	OPENBSD_5_2:1.5.0.2
	OPENBSD_5_2_BASE:1.5;
locks; strict;
comment	@.\" @;


1.8
date	2015.02.05.02.33.09;	author schwarze;	state Exp;
branches;
next	1.7;
commitid	3DjwIM9vrpCmLhTQ;

1.7
date	2014.11.30.02.41.43;	author schwarze;	state Exp;
branches;
next	1.6;
commitid	uY3eMfQCqsZHEu4G;

1.6
date	2013.07.16.15.21.11;	author schwarze;	state Exp;
branches;
next	1.5;

1.5
date	2012.04.11.14.32.38;	author jmc;	state Exp;
branches;
next	1.4;

1.4
date	2012.04.11.09.38.45;	author espie;	state Exp;
branches;
next	1.3;

1.3
date	2012.04.11.08.11.30;	author espie;	state Exp;
branches;
next	1.2;

1.2
date	2012.03.23.12.58.48;	author espie;	state Exp;
branches;
next	1.1;

1.1
date	2012.03.21.23.20.35;	author matthew;	state Exp;
branches;
next	;


desc
@@


1.8
log
@macro fixes from Kaspars at Bankovskis dot net;
also fixing one typo in fts(3) while here
@
text
@.\"	$OpenBSD: posix_spawn.3,v 1.7 2014/11/30 02:41:43 schwarze Exp $
.\"
.\" Copyright (c) 2012 Marc Espie <espie@@openbsd.org>
.\"
.\" Permission to use, copy, modify, and distribute this software for any
.\" purpose with or without fee is hereby granted, provided that the above
.\" copyright notice and this permission notice appear in all copies.
.\"
.\" THE SOFTWARE IS PROVIDED "AS IS" AND THE AUTHOR DISCLAIMS ALL WARRANTIES
.\" WITH REGARD TO THIS SOFTWARE INCLUDING ALL IMPLIED WARRANTIES OF
.\" MERCHANTABILITY AND FITNESS. IN NO EVENT SHALL THE AUTHOR BE LIABLE FOR
.\" ANY SPECIAL, DIRECT, INDIRECT, OR CONSEQUENTIAL DAMAGES OR ANY DAMAGES
.\" WHATSOEVER RESULTING FROM LOSS OF USE, DATA OR PROFITS, WHETHER IN AN
.\" ACTION OF CONTRACT, NEGLIGENCE OR OTHER TORTIOUS ACTION, ARISING OUT OF
.\" OR IN CONNECTION WITH THE USE OR PERFORMANCE OF THIS SOFTWARE.
.\"
.Dd $Mdocdate: November 30 2014 $
.Dt POSIX_SPAWN 3
.Os
.Sh NAME
.Nm posix_spawn , posix_spawnp
.Nd launch external command
.Sh SYNOPSIS
.In spawn.h
.Ft int
.Fn posix_spawn "pid_t *restrict pidp" "const char *restrict path" "const posix_spawn_file_actions_t *file_actions" "const posix_spawnattr_t *restrict attrp" "char *const argv[restrict]" "char *const envp[restrict]"
.Ft int
.Fn posix_spawnp "pid_t *restrict pidp" "const char *restrict file" "const posix_spawn_file_actions_t *file_actions" "const posix_spawnattr_t *restrict attrp" "char *const argv[restrict]" "char *const envp[restrict]"
.Sh DESCRIPTION
The
.Fn posix_spawn
function forks a new process and starts an external program from
pathname
.Fa path .
.Pp
The
.Fn posix_spawnp
function is similar, except it constructs the pathname from
.Fa file
following the usual
.Ev PATH
handling rules:
if file contains a slash, then it is directly used as a path.
Otherwise,
.Fn posix_spawnp
searches every directory mentioned in
.Ev PATH
until it finds an executable.
If
.Ev PATH
is not set, the default is
.Dq /usr/bin:/bin .
.Pp
Arguments to the new process are passed to
.Xr execve 2
as
.Fa argv
and
.Fa envp .
If
.Fa envp
is NULL, the environment is passed unchanged from the parent process.
.Pp
If
.Fa file_actions
is a null pointer, file descriptors open in the parent process
follow the usual rules: they remain open in the child process unless they've
been marked
.Dv FD_CLOEXEC
with
.Xr fcntl 2 .
.Pp
Otherwise, file descriptors in the child process
are altered according to
.Xr posix_spawn_file_actions_init 3 ,
.Xr posix_spawn_file_actions_addclose 3 ,
.Xr posix_spawn_file_actions_adddup2 3 ,
and
.Xr posix_spawn_file_actions_addopen 3 .
.Pp
The
.Fa attrp
argument can be used to control signal, UID and GID handling in the
child process.
.Pp
If
.Fa attrp
is NULL, default values are used: caught signals in the parent
process are set to the default value in the child process, and ignored signals
stay ignored.
.Pp
See
.Xr posix_spawnattr_setflags 3
for attribute details.
.Sh RETURN VALUES
Upon successful completion, both functions return 0.
If
.Fa pidp
is not a NULL pointer,
.Li *pidp
gets set to the PID of the newly created child process.
.Pp
In case of an error, both functions may return
.Fn fork
or
.Fn exec
return values and set
.Va errno
accordingly.
.Pp
Note, however, that after the new process is started, the child
process has no way to return an error value.
In case of a problem, the child process will instead exit
with exit status 127.
.Sh SEE ALSO
.Xr execve 2 ,
.Xr fork 2 ,
.Xr posix_spawn_file_actions_addclose 3 ,
.Xr posix_spawn_file_actions_init 3 ,
.Xr posix_spawnattr_init 3 ,
.Xr posix_spawnattr_setflags 3
.Sh STANDARDS
Both functions conform to
.St -p1003.1-2001 .
.Sh AUTHORS
.An \&Ed Shouten Aq Mt ed@@FreeBSD.org
@


1.7
log
@Even though not callable, "Ed" is a macro name, so for clarity,
escape it when it appears on a macro line.
@
text
@d1 1
a1 1
.\"	$OpenBSD: posix_spawn.3,v 1.6 2013/07/16 15:21:11 schwarze Exp $
d17 1
a17 1
.Dd $Mdocdate: July 16 2013 $
d69 1
a69 1
.Ev FD_CLOEXEC
d108 1
a108 1
.Ev errno
@


1.6
log
@use .Mt for email addresses; from Jan Stary <hans at stare dot cz>; ok jmc@@
@
text
@d1 1
a1 1
.\"	$OpenBSD: posix_spawn.3,v 1.5 2012/04/11 14:32:38 jmc Exp $
d17 1
a17 1
.Dd $Mdocdate: April 11 2012 $
d126 1
a126 1
.An Ed Shouten Aq Mt ed@@FreeBSD.org
@


1.5
log
@tweak previous;
@
text
@d1 1
a1 1
.\"	$OpenBSD: posix_spawn.3,v 1.4 2012/04/11 09:38:45 espie Exp $
d126 1
a126 1
.An Ed Shouten Aq ed@@FreeBSD.org
@


1.4
log
@fuss with details
@
text
@d1 1
a1 1
.\"	$OpenBSD: posix_spawn.3,v 1.3 2012/04/11 08:11:30 espie Exp $
d40 1
a40 1
following usual 
d46 1
a46 1
search every directory mentioned in
d54 1
a54 1
Arguments to the new process are passed to 
d78 1
d83 1
a83 1
argument can be used to control signal, uid and gid handling in the
d92 2
a93 1
.Xr posix_spawnattr_setflags 3 ,
d96 1
a96 1
Upon succesful completion, both functions return 0.
d99 1
a99 1
is not a NULL pointer, 
d101 1
a101 1
gets set to the pid of the newly created child process.
d118 1
a119 1
.Xr posix_spawn_file_actions_addclose 3 ,
@


1.3
log
@new clean-room manpages for posix_spawn, unencumbered by any POSIX bullshit.
"just commit it" deraadt@@

(nits to be fixed soon)
@
text
@d1 1
a1 1
.\"	$OpenBSD$
d17 1
a17 1
.Dd $Mdocdate$
a90 2
See
.Xr posix_spawnattr_init 3 ,
a91 4
.Xr posix_spawnattr_setpgroup 3 ,
.Xr posix_spawnattr_setschedparam 3 ,
.Xr posix_spawnattr_setsigdefault 3 ,
.Xr posix_spawnattr_setsigmask 3
d104 1
a104 1
.Nm exec
d118 2
a119 1
.Xr posix_spawnattr_init 3 .
@


1.2
log
@we don't mention LIBRARY: c
"of course" deraadt@@
@
text
@d1 1
a1 3
.\"	$OpenBSD: posix_spawn.3,v 1.1 2012/03/21 23:20:35 matthew Exp $
.\" Copyright (c) 2008 Ed Schouten <ed@@FreeBSD.org>
.\" All rights reserved.
d3 1
a3 8
.\" Redistribution and use in source and binary forms, with or without
.\" modification, are permitted provided that the following conditions
.\" are met:
.\" 1. Redistributions of source code must retain the above copyright
.\"    notice, this list of conditions and the following disclaimer.
.\" 2. Redistributions in binary form must reproduce the above copyright
.\"    notice, this list of conditions and the following disclaimer in the
.\"    documentation and/or other materials provided with the distribution.
d5 3
a7 11
.\" THIS SOFTWARE IS PROVIDED BY THE AUTHOR AND CONTRIBUTORS ``AS IS'' AND
.\" ANY EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT LIMITED TO, THE
.\" IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE
.\" ARE DISCLAIMED.  IN NO EVENT SHALL THE AUTHOR OR CONTRIBUTORS BE LIABLE
.\" FOR ANY DIRECT, INDIRECT, INCIDENTAL, SPECIAL, EXEMPLARY, OR CONSEQUENTIAL
.\" DAMAGES (INCLUDING, BUT NOT LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS
.\" OR SERVICES; LOSS OF USE, DATA, OR PROFITS; OR BUSINESS INTERRUPTION)
.\" HOWEVER CAUSED AND ON ANY THEORY OF LIABILITY, WHETHER IN CONTRACT, STRICT
.\" LIABILITY, OR TORT (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY
.\" OUT OF THE USE OF THIS SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF
.\" SUCH DAMAGE.
d9 7
a15 9
.\" Portions of this text are reprinted and reproduced in electronic form
.\" from IEEE Std 1003.1, 2004 Edition, Standard for Information Technology --
.\" Portable Operating System Interface (POSIX), The Open Group Base
.\" Specifications Issue 6, Copyright (C) 2001-2004 by the Institute of
.\" Electrical and Electronics Engineers, Inc and The Open Group.  In the
.\" event of any discrepancy between this version and the original IEEE and
.\" The Open Group Standard, the original IEEE and The Open Group Standard is
.\" the referee document.  The original Standard can be obtained online at
.\"	http://www.opengroup.org/unix/online.html.
d17 1
a17 1
.Dd Mar 24, 2008
d21 2
a22 3
.Nm posix_spawn ,
.Nm posix_spawnp
.Nd "spawn a process"
d26 1
a26 1
.Fn posix_spawn "pid_t *restrict pid" "const char *restrict path" "const posix_spawn_file_actions_t *file_actions" "const posix_spawnattr_t *restrict attrp" "char *const argv[restrict]" "char *const envp[restrict]"
d28 1
a28 1
.Fn posix_spawnp "pid_t *restrict pid" "const char *restrict file" "const posix_spawn_file_actions_t *file_actions" "const posix_spawnattr_t *restrict attrp" "char *const argv[restrict]" "char *const envp[restrict]"
d32 3
a34 6
and
.Fn posix_spawnp
functions create a new process (child process) from the specified
process image.
The new process image is constructed from a regular executable
file called the new process image file.
d36 1
a36 35
When a C program is executed as the result of this call, it is
entered as a C-language function call as follows:
.Bd -literal -offset indent
int main(int argc, char *argv[]);
.Ed
.Pp
where
.Fa argc
is the argument count and
.Fa argv
is an array of character pointers to the arguments themselves.
In addition, the variable:
.Bd -literal -offset indent
extern char **environ;
.Ed
.Pp
points to an array of character pointers to
the environment strings.
.Pp
The argument
.Fa argv
is an array of character pointers to null-terminated
strings.
The last member of this array is a null pointer and is not counted
in
.Fa argc .
These strings constitute the argument list available to the new process
image.
The value in
.Fa argv Ns [0]
should point to
a filename that is associated with the process image being started by
the
.Fn posix_spawn
or
d38 1
a38 15
function.
.Pp
The argument
.Fa envp
is an array of character pointers to null-terminated strings.
These strings constitute the environment for the new process image.
The environment array is terminated by a null pointer.
.Pp
The
.Fa path
argument to
.Fn posix_spawn
is a pathname that identifies the new process image file to execute.
.Pp
The
d40 20
a59 17
parameter to
.Fn posix_spawnp
is used to construct a pathname that identifies the new process
image file.
If the file parameter contains a slash character, the file parameter
is used as the pathname for the new process image file.
Otherwise, the path prefix for this file is obtained by a search
of the directories passed as the environment variable
.Dq Ev PATH .
If this variable is not specified,
the default path is set according to the
.Dv _PATH_DEFPATH
definition in
.In paths.h ,
which is set to
.Dq Ev /usr/bin:/bin .
.Pp
d61 2
a62 12
.Fa file_actions
is a null pointer, then file descriptors open in the
calling process remain open in the child process, except for those
whose close-on-exec flag
.Dv FD_CLOEXEC
is set (see
.Fn fcntl ) .
For those
file descriptors that remain open, all attributes of the corresponding
open file descriptions, including file locks (see
.Fn fcntl ) ,
remain unchanged.
d66 6
a71 33
is not NULL, then the file descriptors open in the child process are
those open in the calling process as modified by the spawn file
actions object pointed to by
.Fa file_actions
and the
.Dv FD_CLOEXEC
flag of each remaining open file descriptor after the spawn file actions
have been processed.
The effective order of processing the spawn file actions are:
.Bl -enum
.It
The set of open file descriptors for the child process initially
are the same set as is open for the calling process.
All attributes of the corresponding open file descriptions, including
file locks (see
.Fn fcntl ) ,
remain unchanged.
.It
The signal mask, signal default actions, and the effective user and
group IDs for the child process are changed as specified in the
attributes object referenced by
.Fa attrp .
.It
The file actions specified by the spawn file actions object are 
performed in the order in which they were added to the spawn file
actions object.
.It
Any file descriptor that has its
.Dv FD_CLOEXEC
flag set (see
.Fn fcntl )
is closed.
.El
d73 6
a78 28
The
.Vt posix_spawnattr_t
spawn attributes object type is defined in
.In spawn.h .
It contains the attributes defined below.
.Pp
If the
.Dv POSIX_SPAWN_SETPGROUP
flag is set in the spawn-flags attribute of the object referenced by
.Fa attrp ,
and the spawn-pgroup attribute of the same object is non-zero, then the
child's process group is as specified in the spawn-pgroup
attribute of the object referenced by
.Fa attrp .
.Pp
As a special case, if the
.Dv POSIX_SPAWN_SETPGROUP
flag is set in the spawn-flags attribute of the object referenced by
.Fa attrp ,
and the spawn-pgroup attribute of the same object is set to zero, then
the child is in a new process group with a process group ID equal
to its process ID.
.Pp
If the
.Dv POSIX_SPAWN_SETPGROUP
flag is not set in the spawn-flags attribute of the object referenced by
.Fa attrp ,
the new child process inherits the parent's process group.
a80 2
.Dv POSIX_SPAWN_RESETIDS
flag in the spawn-flags attribute of the object referenced by
d82 2
a83 8
governs the effective user ID of the child process.
If this flag is not set, the child process inherits the parent
process' effective user ID.
If this flag is set, the child process' effective user ID is reset
to the parent's real user ID.
In either case, if the set-user-ID mode bit of the new process image
file is set, the effective user ID of the child process becomes
that file's owner ID before the new process image begins execution.
d85 1
a85 3
The
.Dv POSIX_SPAWN_RESETIDS
flag in the spawn-flags attribute of the object referenced by
d87 3
a89 8
also governs the effective group ID of the child process.
If this flag is not set, the child process inherits the parent
process' effective group ID.
If this flag is set, the child process' effective group ID is
reset to the parent's real group ID.
In either case, if the set-group-ID mode bit of the new process image
file is set, the effective group ID of the child process becomes
that file's group ID before the new process image begins execution.
d91 8
a98 43
If the
.Dv POSIX_SPAWN_SETSIGMASK
flag is set in the spawn-flags attribute of the object referenced by
.Fa attrp ,
the child process initially has the signal mask specified in the
spawn-sigmask attribute of the object referenced by
.Fa attrp .
.Pp
If the
.Dv POSIX_SPAWN_SETSIGDEF
flag is set in the spawn-flags attribute of the object referenced by
.Fa attrp ,
the signals specified in the spawn-sigdefault attribute of the same
object is set to their default actions in the child process.
Signals set to the default action in the parent process is set to
the default action in the child process.
.Pp
Signals set to be caught by the calling process is set to the
default action in the child process.
.Pp
Signals set to be ignored by the calling process image is set to
be ignored by the child process, unless otherwise specified by the
.Dv POSIX_SPAWN_SETSIGDEF
flag being set in the spawn-flags attribute of the object referenced by
.Fa attrp
and the signals being indicated in the spawn-sigdefault attribute
of the object referenced by
.Fa attrp .
.Pp
If the value of the
.Fa attrp
pointer is NULL, then the default values are used.
.Pp
All process attributes, other than those influenced by the attributes
set in the object referenced by
.Fa attrp
as specified above or by the file descriptor manipulations specified in
.Fa file_actions ,
appear in the new process image as though
.Fn fork
had been called to create a child process and then
.Fn execve
had been called by the child process to execute the new process image.
d100 1
a100 20
Upon successful completion,
.Fn posix_spawn
and
.Fn posix_spawnp
return the process ID of the child process to the parent process,
in the variable pointed to by a non-NULL
.Fa pid
argument, and return zero as the function return value.
Otherwise, no child process is created, no value is stored into
the variable pointed to by
.Fa pid ,
and an error number is returned as the function return value to
indicate the error.
If the
.Fa pid
argument is a null pointer, the process ID of the child is not returned
to the caller.
.Sh ERRORS
.Bl -enum
.It
d102 6
a107 4
.Fn posix_spawn
and
.Fn posix_spawnp
fail for any of the reasons that would cause
d109 1
a109 1
or one of the
d111 8
a118 45
to fail, an error value is returned as described by
.Fn fork
and
.Nm exec ,
respectively (or, if the error occurs after the calling process successfully
returns, the child process exits with exit status 127).
.It
If
.Nm POSIX_SPAWN_SETPGROUP
is set in the spawn-flags attribute of the object referenced by attrp, and
.Fn posix_spawn
or
.Fn posix_spawnp
fails while changing the child's process group, an error value is returned as
described by
.Fn setpgid
(or, if the error occurs after the calling process successfully returns,
the child process exits with exit status 127).
.It
If the
.Fa file_actions
argument is not NULL, and specifies any close, dup2, or open actions to be
performed, and if
.Fn posix_spawn
or
.Fn posix_spawnp
fails for any of the reasons that would cause
.Fn close ,
.Fn dup2 ,
or
.Fn open
to fail, an error value is returned as described by
.Fn close ,
.Fn dup2 ,
and
.Fn open ,
respectively (or, if the error occurs after the calling process successfully
returns, the child process exits with exit status 127). An open file action
may, by itself, result in any of the errors described by
.Fn close
or
.Fn dup2 ,
in addition to those described by
.Fn open .
.El
a119 2
.Xr close 2 ,
.Xr dup2 2 ,
a120 1
.Xr fcntl 2 ,
d122 1
a122 1
.Xr open 2 ,
d124 1
a124 19
.Xr posix_spawn_file_actions_adddup2 3 ,
.Xr posix_spawn_file_actions_addopen 3 ,
.Xr posix_spawn_file_actions_destroy 3 ,
.Xr posix_spawn_file_actions_init 3 ,
.Xr posix_spawnattr_destroy 3 ,
.Xr posix_spawnattr_getflags 3 ,
.Xr posix_spawnattr_getpgroup 3 ,
.Xr posix_spawnattr_getschedparam 3 ,
.Xr posix_spawnattr_getschedpolicy 3 ,
.Xr posix_spawnattr_getsigdefault 3 ,
.Xr posix_spawnattr_getsigmask 3 ,
.Xr posix_spawnattr_init 3 ,
.Xr posix_spawnattr_setflags 3 ,
.Xr posix_spawnattr_setpgroup 3 ,
.Xr posix_spawnattr_setschedparam 3 ,
.Xr posix_spawnattr_setschedpolicy 3 ,
.Xr posix_spawnattr_setsigdefault 3 ,
.Xr posix_spawnattr_setsigmask 3 ,
.Xr setpgid 2
d126 1
a126 5
The
.Fn posix_spawn
and
.Fn posix_spawnp
functions conform to
d129 1
a129 1
.An Ed Schouten Aq ed@@FreeBSD.org
@


1.1
log
@Implement execvpe(3) and posix_spawn(3) and family.  Based on
FreeBSD's implementation via Frank Denis, with various cleanups and
tweaks by me.

ok deraadt@@, guenther@@; discussions and tweaks from many others
jmc@@ promises to help me further with the man pages in tree
@
text
@d1 1
a1 1
.\"	$OpenBSD$
a42 2
.Sh LIBRARY
.Lb libc
@

