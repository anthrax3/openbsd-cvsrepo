head	1.19;
access;
symbols
	OPENBSD_6_0:1.19.0.2
	OPENBSD_6_0_BASE:1.19
	OPENBSD_5_9:1.17.0.4
	OPENBSD_5_9_BASE:1.17
	OPENBSD_5_8:1.17.0.6
	OPENBSD_5_8_BASE:1.17
	OPENBSD_5_7:1.17.0.2
	OPENBSD_5_7_BASE:1.17
	OPENBSD_5_6:1.16.0.6
	OPENBSD_5_6_BASE:1.16
	OPENBSD_5_5:1.16.0.4
	OPENBSD_5_5_BASE:1.16
	OPENBSD_5_4:1.14.0.2
	OPENBSD_5_4_BASE:1.14
	OPENBSD_5_3:1.13.0.6
	OPENBSD_5_3_BASE:1.13
	OPENBSD_5_2:1.13.0.4
	OPENBSD_5_2_BASE:1.13
	OPENBSD_5_1_BASE:1.13
	OPENBSD_5_1:1.13.0.2
	OPENBSD_5_0:1.12.0.10
	OPENBSD_5_0_BASE:1.12
	OPENBSD_4_9:1.12.0.8
	OPENBSD_4_9_BASE:1.12
	OPENBSD_4_8:1.12.0.6
	OPENBSD_4_8_BASE:1.12
	OPENBSD_4_7:1.12.0.2
	OPENBSD_4_7_BASE:1.12
	OPENBSD_4_6:1.12.0.4
	OPENBSD_4_6_BASE:1.12
	OPENBSD_4_5:1.11.0.8
	OPENBSD_4_5_BASE:1.11
	OPENBSD_4_4:1.11.0.6
	OPENBSD_4_4_BASE:1.11
	OPENBSD_4_3:1.11.0.4
	OPENBSD_4_3_BASE:1.11
	OPENBSD_4_2:1.11.0.2
	OPENBSD_4_2_BASE:1.11
	OPENBSD_4_1:1.10.0.16
	OPENBSD_4_1_BASE:1.10
	OPENBSD_4_0:1.10.0.14
	OPENBSD_4_0_BASE:1.10
	OPENBSD_3_9:1.10.0.12
	OPENBSD_3_9_BASE:1.10
	OPENBSD_3_8:1.10.0.10
	OPENBSD_3_8_BASE:1.10
	OPENBSD_3_7:1.10.0.8
	OPENBSD_3_7_BASE:1.10
	OPENBSD_3_6:1.10.0.6
	OPENBSD_3_6_BASE:1.10
	OPENBSD_3_5:1.10.0.4
	OPENBSD_3_5_BASE:1.10
	OPENBSD_3_4:1.10.0.2
	OPENBSD_3_4_BASE:1.10
	OPENBSD_3_3:1.8.0.14
	OPENBSD_3_3_BASE:1.8
	OPENBSD_3_2:1.8.0.12
	OPENBSD_3_2_BASE:1.8
	OPENBSD_3_1:1.8.0.10
	OPENBSD_3_1_BASE:1.8
	OPENBSD_3_0:1.8.0.8
	OPENBSD_3_0_BASE:1.8
	OPENBSD_2_9:1.8.0.6
	OPENBSD_2_9_BASE:1.8
	OPENBSD_2_8:1.8.0.4
	OPENBSD_2_8_BASE:1.8
	OPENBSD_2_7:1.8.0.2
	OPENBSD_2_7_BASE:1.8
	OPENBSD_2_6:1.5.0.2
	OPENBSD_2_6_BASE:1.5
	OPENBSD_2_5:1.3.0.4
	OPENBSD_2_5_BASE:1.3
	OPENBSD_2_4:1.3.0.2
	OPENBSD_2_4_BASE:1.3
	OPENBSD_2_3:1.2.0.8
	OPENBSD_2_3_BASE:1.2
	OPENBSD_2_2:1.2.0.6
	OPENBSD_2_2_BASE:1.2
	OPENBSD_2_1:1.2.0.4
	OPENBSD_2_1_BASE:1.2
	OPENBSD_2_0:1.2.0.2
	OPENBSD_2_0_BASE:1.2
	netbsd_1_1:1.1.1.1;
locks; strict;
comment	@.\" @;


1.19
date	2016.05.04.01.32.04;	author zhuk;	state Exp;
branches;
next	1.18;
commitid	Hh6PVp6PKGCOOMyg;

1.18
date	2016.04.25.20.42.55;	author tedu;	state Exp;
branches;
next	1.17;
commitid	TB0dzL0QliW2ylCr;

1.17
date	2015.02.11.03.03.08;	author guenther;	state Exp;
branches;
next	1.16;
commitid	F0jSFhaff58X5UIB;

1.16
date	2013.10.22.16.40.27;	author guenther;	state Exp;
branches;
next	1.15;

1.15
date	2013.08.03.06.25.32;	author guenther;	state Exp;
branches;
next	1.14;

1.14
date	2013.06.05.03.40.26;	author tedu;	state Exp;
branches;
next	1.13;

1.13
date	2011.08.18.13.01.26;	author jmc;	state Exp;
branches;
next	1.12;

1.12
date	2009.06.07.03.09.34;	author millert;	state Exp;
branches;
next	1.11;

1.11
date	2007.05.31.19.19.35;	author jmc;	state Exp;
branches;
next	1.10;

1.10
date	2003.06.02.20.18.40;	author millert;	state Exp;
branches;
next	1.9;

1.9
date	2003.06.02.09.56.20;	author jmc;	state Exp;
branches;
next	1.8;

1.8
date	2000.04.15.02.15.28;	author aaron;	state Exp;
branches;
next	1.7;

1.7
date	2000.03.04.15.29.56;	author aaron;	state Exp;
branches;
next	1.6;

1.6
date	2000.01.05.18.51.10;	author deraadt;	state Exp;
branches;
next	1.5;

1.5
date	99.07.02.21.13.04;	author aaron;	state Exp;
branches;
next	1.4;

1.4
date	99.05.16.19.55.52;	author alex;	state Exp;
branches;
next	1.3;

1.3
date	98.08.06.21.23.00;	author kstailey;	state Exp;
branches;
next	1.2;

1.2
date	96.05.05.14.57.06;	author deraadt;	state Exp;
branches;
next	1.1;

1.1
date	95.10.18.08.42.44;	author deraadt;	state Exp;
branches
	1.1.1.1;
next	;

1.1.1.1
date	95.10.18.08.42.44;	author deraadt;	state Exp;
branches;
next	;


desc
@@


1.19
log
@Add ERRORS section (requested by bluhm@@). While there, move start of
RETURN VALUES section upper, where it belongs more.
@
text
@.\"	$OpenBSD: kvm_getfiles.3,v 1.18 2016/04/25 20:42:55 tedu Exp $
.\"	$NetBSD: kvm_getfiles.3,v 1.3 1996/03/18 22:33:23 thorpej Exp $
.\"
.\" Copyright (c) 1992, 1993
.\"	The Regents of the University of California.  All rights reserved.
.\"
.\" This code is derived from software developed by the Computer Systems
.\" Engineering group at Lawrence Berkeley Laboratory under DARPA contract
.\" BG 91-66 and contributed to Berkeley.
.\"
.\" Redistribution and use in source and binary forms, with or without
.\" modification, are permitted provided that the following conditions
.\" are met:
.\" 1. Redistributions of source code must retain the above copyright
.\"    notice, this list of conditions and the following disclaimer.
.\" 2. Redistributions in binary form must reproduce the above copyright
.\"    notice, this list of conditions and the following disclaimer in the
.\"    documentation and/or other materials provided with the distribution.
.\" 3. Neither the name of the University nor the names of its contributors
.\"    may be used to endorse or promote products derived from this software
.\"    without specific prior written permission.
.\"
.\" THIS SOFTWARE IS PROVIDED BY THE REGENTS AND CONTRIBUTORS ``AS IS'' AND
.\" ANY EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT LIMITED TO, THE
.\" IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE
.\" ARE DISCLAIMED.  IN NO EVENT SHALL THE REGENTS OR CONTRIBUTORS BE LIABLE
.\" FOR ANY DIRECT, INDIRECT, INCIDENTAL, SPECIAL, EXEMPLARY, OR CONSEQUENTIAL
.\" DAMAGES (INCLUDING, BUT NOT LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS
.\" OR SERVICES; LOSS OF USE, DATA, OR PROFITS; OR BUSINESS INTERRUPTION)
.\" HOWEVER CAUSED AND ON ANY THEORY OF LIABILITY, WHETHER IN CONTRACT, STRICT
.\" LIABILITY, OR TORT (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY
.\" OUT OF THE USE OF THIS SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF
.\" SUCH DAMAGE.
.\"
.\"     @@(#)kvm_getfiles.3	8.2 (Berkeley) 4/19/94
.\"
.Dd $Mdocdate: April 25 2016 $
.Dt KVM_GETFILES 3
.Os
.Sh NAME
.Nm kvm_getfiles
.Nd survey open files
.Sh SYNOPSIS
.In kvm.h
.In sys/types.h
.In sys/sysctl.h
.Ft struct kinfo_file *
.Fn kvm_getfiles "kvm_t *kd" "int op" "int arg" "size_t elemsize" "int *cnt"
.Sh DESCRIPTION
.Fn kvm_getfiles
returns a (sub-)set of the open files in the kernel indicated by
.Fa kd .
The
.Fa op
and
.Fa arg
arguments constitute a predicate which limits the set of files
returned.
The value of
.Fa op
describes the filtering predicate as follows:
.Pp
.Bl -tag -width 20n -offset indent -compact
.It Dv KERN_FILE_BYFILE
all open files with type
.Fa arg
(0 for all files)
.It Dv KERN_FILE_BYPID
files opened by process ID
.Fa arg
(\-1 for all processes)
.It Dv KERN_FILE_BYUID
files opened by processes with effective user ID
.Fa arg
(\-1 for all users)
.El
.Pp
Files associated with a process will include information about
the process that has the file open.
.Pp
For
.Dv KERN_FILE_BYFILE
the recognized file types are defined in
.In sys/file.h :
.Pp
.Bl -tag -width 20n -offset indent -compact
.It Dv DTYPE_VNODE
files and devices
.It Dv DTYPE_SOCKET
sockets, regardless of domain
.It Dv DTYPE_PIPE
pipes and FIFOs
.It Dv DTYPE_KQUEUE
kqueues
.El
.Pp
Only the first
.Fa elemsize
bytes of each array entry are returned.
If the size of the
.Vt kinfo_file
structure increases in size in a future release of
.Ox ,
the kernel will only return the requested amount of data for
each array entry and programs that use
.Fn kvm_getfiles
will continue to function without the need for recompilation.
.Sh RETURN VALUES
The files are returned as a contiguous array of
.Vt kinfo_file
structures.
The number of structures found is returned in the reference parameter
.Fa cnt .
This memory is owned by kvm and will be overwritten by subsequent calls to
.Fn kvm_getfiles
and destroyed by
.Fn kvm_close .
Data should be copied out if it needs to be saved.
.Pp
.Fn kvm_getfiles
will return
.Dv NULL
on failure.
.Sh ERRORS
.Fn kvm_getfiles
will fail if:
.Bl -tag -width Er
.It Bq Er ENOMEM
Could not allocate enough memory for internal buffer.
.It Bq Er ESRCH
The
.Fa op
argument has
.Dv KERN_FILE_BYPID
value and the process specified by
.Fa arg
was not found.
.El
.Sh SEE ALSO
.Xr kvm 3 ,
.Xr kvm_geterr 3 ,
.Xr kvm_nlist 3 ,
.Xr kvm_open 3 ,
.Xr kvm_read 3
.Sh BUGS
This routine does not belong in the kvm interface.
@


1.18
log
@no more systrace
@
text
@d1 1
a1 1
.\"	$OpenBSD: kvm_getfiles.3,v 1.17 2015/02/11 03:03:08 guenther Exp $
d37 1
a37 1
.Dd $Mdocdate: February 11 2015 $
d108 1
a108 1
.Pp
d119 1
a119 1
.Sh RETURN VALUES
d124 15
@


1.17
log
@sysctl({CTL_KERN, KERN_FILE, KERN_FILE_BYFILE}) previously required
the extra argument to be zero; instead, make it filter on the file
type (DTYPE_*) when non-zero to make claudio's netstat work easier.

ok claudio@@
@
text
@d1 1
a1 1
.\"	$OpenBSD: kvm_getfiles.3,v 1.16 2013/10/22 16:40:27 guenther Exp $
d37 1
a37 1
.Dd $Mdocdate: October 22 2013 $
a94 2
.It Dv DTYPE_SYSTRACE
systrace control files
@


1.16
log
@- add UNIX-domain socket info to struct kinfo_file2
- convert netstat from kvm_getfiles() to kvm_getfile2() using that
- delete kvm_getfiles() and KERN_FILE as no longer used (bump libkvm's major)
- rename kvm_getfile2() to kvm_getfiles(), kinfo_file2 to kinfo_file
  and KERN_FILE2 to KERN_FILE.

ok deraadt@@, millert@@
ports scan sthen@@
@
text
@d1 1
a1 1
.\"	$OpenBSD: kvm_getfiles.3,v 1.15 2013/08/03 06:25:32 guenther Exp $
d37 1
a37 1
.Dd $Mdocdate: August 3 2013 $
d65 3
a67 1
all open files
d75 1
d80 18
@


1.15
log
@KERN_PROC_BYPID --> KERN_FILE_BYPID

pointed out by Dominique Laigle (dlaigle (at) gmail.com)
@
text
@d1 1
a1 1
.\"	$OpenBSD: kvm_getfiles.3,v 1.14 2013/06/05 03:40:26 tedu Exp $
d37 1
a37 1
.Dd $Mdocdate: June 5 2013 $
d46 3
a48 8
.Fd #define _KERNEL
.In sys/file.h
.Fd #undef _KERNEL
.\" .Fa kvm_t *kd
.Ft char *
.Fn kvm_getfiles "kvm_t *kd" "int op" "int arg" "int *cnt"
.Ft struct kinfo_file2 *
.Fn kvm_getfile2 "kvm_t *kd" "int op" "int arg" "size_t elemsize" "int *cnt"
a58 32
No predicates are currently defined.
.Pp
The number of processes found is returned in the reference parameter
.Fa cnt .
The files are returned as a contiguous array of file structures,
preceded by the address of the first file entry in the kernel.
This memory is owned by kvm and is not guaranteed to be persistent across
subsequent kvm library calls.
Data should be copied out if it needs to be saved.
.Pp
.Fn kvm_getfile2
is similar to
.Fn kvm_getfiles
but returns an array of
.Vt kinfo_file2
structures.
Additionally, only the first
.Fa elemsize
bytes of each array entry are returned.
If the size of the
.Vt kinfo_file2
structure increases in size in a future release of
.Ox ,
the kernel will only return the requested amount of data for
each array entry and programs that use
.Fn kvm_getfile2
will continue to function without the need for recompilation.
The
.Fa op
and
.Fa arg
arguments constitute a predicate which limits the set of processes returned.
d78 12
d91 1
a91 1
.Vt kinfo_file2
d96 1
a96 1
.Fn kvm_getfile2
a101 2
and
.Fn kvm_getfile2
@


1.14
log
@use fancy .In macro for includes. from Jan Klemkow. ok jmc schwarze
@
text
@d1 1
a1 1
.\"	$OpenBSD: kvm_getfiles.3,v 1.13 2011/08/18 13:01:26 jmc Exp $
d37 1
a37 1
.Dd $Mdocdate: August 18 2011 $
d103 1
a103 1
.It Dv KERN_PROC_BYPID
@


1.13
log
@where a man page has multiple links, only reference that page
once in SEE ALSO; also prefer Xr to Fn where relevant;

diff started by Martin Pelikan
@
text
@d1 1
a1 1
.\"	$OpenBSD: kvm_getfiles.3,v 1.12 2009/06/07 03:09:34 millert Exp $
d37 1
a37 1
.Dd $Mdocdate: June 7 2009 $
d44 2
a45 2
.Fd #include <kvm.h>
.Fd #include <sys/types.h>
d47 1
a47 1
.Fd #include <sys/file.h>
@


1.12
log
@Add kvm_getfile2 which uses KERN_FILE2 when possible, falling
back on kmem grovelling for non-live kernels.  OK deraadt@@
@
text
@d1 1
a1 1
.\"	$OpenBSD: kvm_getfiles.3,v 1.11 2007/05/31 19:19:35 jmc Exp $
d37 1
a37 1
.Dd $Mdocdate$
a133 1
.Xr kvm_close 3 ,
d137 1
a137 3
.Xr kvm_openfiles 3 ,
.Xr kvm_read 3 ,
.Xr kvm_write 3
@


1.11
log
@convert to new .Dd format;
@
text
@d1 1
a1 1
.\"	$OpenBSD: kvm_getfiles.3,v 1.10 2003/06/02 20:18:40 millert Exp $
d52 2
d73 52
d127 2
@


1.10
log
@Remove the advertising clause in the UCB license which Berkeley
rescinded 22 July 1999.  Proofed by myself and Theo.
@
text
@d1 1
a1 1
.\"	$OpenBSD: kvm_getfiles.3,v 1.9 2003/06/02 09:56:20 jmc Exp $
d37 1
a37 1
.Dd April 19, 1994
@


1.9
log
@section reorder;
@
text
@d1 1
a1 1
.\"	$OpenBSD: kvm_getfiles.3,v 1.8 2000/04/15 02:15:28 aaron Exp $
d19 1
a19 5
.\" 3. All advertising materials mentioning features or use of this software
.\"    must display the following acknowledgement:
.\"	This product includes software developed by the University of
.\"	California, Berkeley and its contributors.
.\" 4. Neither the name of the University nor the names of its contributors
@


1.8
log
@Mostly punctuation fixes.
@
text
@d1 1
a1 1
.\"	$OpenBSD: kvm_getfiles.3,v 1.7 2000/03/04 15:29:56 aaron Exp $
a79 2
.Sh BUGS
This routine does not belong in the kvm interface.
d89 2
@


1.7
log
@Various cleanups and mdoc'ing.
@
text
@d1 1
a1 1
.\"	$OpenBSD: kvm_getfiles.3,v 1.6 2000/01/05 18:51:10 deraadt Exp $
d59 1
a59 1
.Fa kd.
@


1.6
log
@update header requirements; bde
@
text
@d1 1
a1 1
.\"	$OpenBSD: kvm_getfiles.3,v 1.5 1999/07/02 21:13:04 aaron Exp $
a53 1
.br
d65 2
a66 1
returned.  No predicates are currently defined.
d73 2
a74 2
subsequent kvm library calls.  Data should be copied out if it needs to be
saved.
@


1.5
log
@remove redundant .Pp macros
@
text
@d1 1
a1 1
.\"	$OpenBSD: kvm_getfiles.3,v 1.4 1999/05/16 19:55:52 alex Exp $
d49 1
@


1.4
log
@Cleanup xrefs under SEE ALSO.  Specifically:

  - Sort xrefs by section, and then alphabetically.
  - Add missing commas between xref items.
  - Remove commas from the last xref entry.
  - Remove duplicate entries.
@
text
@d1 1
a1 1
.\"	$OpenBSD: kvm_getfiles.3,v 1.3 1998/08/06 21:23:00 kstailey Exp $
d76 3
a78 2
will return NULL on failure.
.Pp
@


1.3
log
@there is no <sys/kinfo.h>
@
text
@d1 1
a1 1
.\"	$OpenBSD: kvm_getfiles.3,v 1.2 1996/05/05 14:57:06 deraadt Exp $
d82 3
a86 1
.Xr kvm_close 3 ,
d88 1
a88 3
.Xr kvm_write 3 ,
.Xr kvm_nlist 3 ,
.Xr kvm_geterr 3
@


1.2
log
@sync with 0430
@
text
@d1 1
a1 1
.\"	$OpenBSD$
a48 1
.Fd #include <sys/kinfo.h>
@


1.1
log
@Initial revision
@
text
@d1 3
@


1.1.1.1
log
@initial import of NetBSD tree
@
text
@@
