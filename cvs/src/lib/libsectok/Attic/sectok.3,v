head	1.12;
access;
symbols
	OPENBSD_4_8:1.11.0.14
	OPENBSD_4_8_BASE:1.11
	OPENBSD_4_7:1.11.0.10
	OPENBSD_4_7_BASE:1.11
	OPENBSD_4_6:1.11.0.12
	OPENBSD_4_6_BASE:1.11
	OPENBSD_4_5:1.11.0.8
	OPENBSD_4_5_BASE:1.11
	OPENBSD_4_4:1.11.0.6
	OPENBSD_4_4_BASE:1.11
	OPENBSD_4_3:1.11.0.4
	OPENBSD_4_3_BASE:1.11
	OPENBSD_4_2:1.11.0.2
	OPENBSD_4_2_BASE:1.11
	OPENBSD_4_1:1.10.0.16
	OPENBSD_4_1_BASE:1.10
	OPENBSD_4_0:1.10.0.14
	OPENBSD_4_0_BASE:1.10
	OPENBSD_3_9:1.10.0.12
	OPENBSD_3_9_BASE:1.10
	OPENBSD_3_8:1.10.0.10
	OPENBSD_3_8_BASE:1.10
	OPENBSD_3_7:1.10.0.8
	OPENBSD_3_7_BASE:1.10
	OPENBSD_3_6:1.10.0.6
	OPENBSD_3_6_BASE:1.10
	OPENBSD_3_5:1.10.0.4
	OPENBSD_3_5_BASE:1.10
	OPENBSD_3_4:1.10.0.2
	OPENBSD_3_4_BASE:1.10
	OPENBSD_3_3:1.6.0.2
	OPENBSD_3_3_BASE:1.6
	OPENBSD_3_2:1.5.0.6
	OPENBSD_3_2_BASE:1.5
	OPENBSD_3_1:1.5.0.4
	OPENBSD_3_1_BASE:1.5
	OPENBSD_3_0:1.5.0.2
	OPENBSD_3_0_BASE:1.5;
locks; strict;
comment	@.\" @;


1.12
date	2010.10.17.08.45.17;	author djm;	state dead;
branches;
next	1.11;

1.11
date	2007.05.31.19.19.37;	author jmc;	state Exp;
branches;
next	1.10;

1.10
date	2003.07.08.12.04.37;	author jmc;	state Exp;
branches;
next	1.9;

1.9
date	2003.06.02.11.24.14;	author jmc;	state Exp;
branches;
next	1.8;

1.8
date	2003.05.24.18.30.32;	author jmc;	state Exp;
branches;
next	1.7;

1.7
date	2003.04.04.00.50.56;	author deraadt;	state Exp;
branches;
next	1.6;

1.6
date	2003.02.18.07.51.08;	author jmc;	state Exp;
branches;
next	1.5;

1.5
date	2001.08.06.15.18.25;	author rees;	state Exp;
branches;
next	1.4;

1.4
date	2001.08.03.20.03.17;	author deraadt;	state Exp;
branches;
next	1.3;

1.3
date	2001.08.03.19.52.27;	author jakob;	state Exp;
branches;
next	1.2;

1.2
date	2001.08.03.19.23.38;	author millert;	state Exp;
branches;
next	1.1;

1.1
date	2001.08.03.18.29.14;	author rees;	state Exp;
branches;
next	;


desc
@@


1.12
log
@remove libsectok; it hasn't been updated in years and doesn't work
with the current generation of tokens; ok markus@@ deraadt@@
@
text
@.\"	$OpenBSD: sectok.3,v 1.11 2007/05/31 19:19:37 jmc Exp $
.\"
.\" Jim Rees <rees@@umich.edu>
.\" CITI Smartcard development <smartcards@@umich.edu>
.\"
.\" copyright 2000
.\" the regents of the university of michigan
.\" all rights reserved
.\"
.\" permission is granted to use, copy, create derivative works
.\" and redistribute this software and such derivative works
.\" for any purpose, so long as the name of the university of
.\" michigan is not used in any advertising or publicity
.\" pertaining to the use or distribution of this software
.\" without specific, written prior authorization.  if the
.\" above copyright notice or any other identification of the
.\" university of michigan is included in any copy of any
.\" portion of this software, then the disclaimer below must
.\" also be included.
.\"
.\" this software is provided as is, without representation
.\" from the university of michigan as to its fitness for any
.\" purpose, and without warranty by the university of
.\" michigan of any kind, either express or implied, including
.\" without limitation the implied warranties of
.\" merchantability and fitness for a particular purpose. the
.\" regents of the university of michigan shall not be liable
.\" for any damages, including special, indirect, incidental, or
.\" consequential damages, with respect to any claim arising
.\" out of or in connection with the use of the software, even
.\" if it has been or is hereafter advised of the possibility of
.\" such damages.
.Dd $Mdocdate: May 31 2007 $
.Dt SECTOK 3
.Os
.Sh NAME
.Nm sectok
.Nd library for communicating with ISO 7816 smartcards
.Sh SYNOPSIS
.Fd #include <sectok.h>
.Ft int
.Fn sectok_open "int rn" "int flags" "int *swp"
.Ft int
.Fn sectok_friendly_open "const char *rn" "int flags" "int *swp"
.Ft int
.Fn sectok_xopen "int rn" "int flags" "char *config_path" "char *driver_path" "int *swp"
.Ft int
.Fn sectok_reset "int fd" "int flags" "unsigned char *atr" "int *swp"
.Ft int
.Fo sectok_apdu
.Fa "int fd"
.Fa "int cla"
.Fa "int ins"
.Fa "int p1"
.Fa "int p2"
.Fa "int ilen"
.Fa "unsigned char *ibuf"
.Fa "int olen"
.Fa "unsigned char *obuf"
.Fa "int *swp"
.Fc
.Ft int
.Fn sectok_cardpresent "int fd"
.Ft int
.Fn sectok_close "int fd"
.Ft int
.Fn sectok_selectfile "int fd" "int cla" "unsigned char *fid" "int *swp"
.Ft void
.Fn sectok_fmt_fid "char *fname" "size_t fnamelen" "unsigned char *fid"
.Ft int
.Fn sectok_parse_atr "int fd" "int flags" "unsigned char *atr" "int len" "struct scparam *param"
.Ft void
.Fn sectok_parse_fname "char *buf" "unsigned char *fid"
.Ft int
.Fn sectok_parse_input "char *ibuf" "unsigned char *obuf" "int olen"
.Ft int
.Fn sectok_get_input "FILE *f" "unsigned char *obuf" "int omin" "int olen"
.Ft int
.Fn sectok_fdump_reply "FILE *f" "unsigned char *p" "int n" "int sw"
.Ft int
.Fn sectok_dump_reply "unsigned char *p" "int n" "int sw"
.Ft void
.Fn sectok_print_sw "int sw"
.Ft "char *"
.Fn sectok_get_sw "int sw"
.Ft "char *"
.Fn sectok_get_ins "int ins"
.Ft int
.Fn sectok_swOK "int sw"
.Sh DESCRIPTION
.Nm sectok
provides initialization, input, output, and other basic routines for ISO
7816 smart cards.
Many of the routines return a status word.
This will either be an error code as given in the include file,
or an SW1/SW2 pair as specified in ISO 7816.
.Pp
.Fn sectok_open
opens a connection to a smart card via serial port number
.Fa rn .
Ports are
numbered from 0, which corresponds to /dev/tty00 on UNIX.
If there is no card in the reader,
.Fn sectok_open
will either wait for card insertion, or if flag
.Dv STONOWAIT
is given, it will return immediately with error
.Dv STENOCARD .
.Fa swp
points to a status word that will be set on return.
.Pp
.Fn sectok_friendly_open
opens a connection to a smart card via a reader device name
.Fa rn .
Mapping from reader name to serial port number is the same as used in
.Fn sectok_open .
For other arguments and return values, see
.Fn sectok_open .
.Pp
.Fn sectok_reset
resets the card and returns the ATR in the buffer pointed to by
.Fa atr
if it is not
.Dv NULL .
If the
.Dv STRFORCE
flag is given, a connection to the card will be established
using default protocol parameters even if the card ATR is illegal.
.Pp
.Fn sectok_apdu
sends an APDU to the card with optional IN and OUT data.
.Bl -tag -width Ds
.It Fa cla
application class
.It Fa ins
instruction code
.It Fa p1 , Fa p2
per ISO 7816-3 or application dependent
.It Fa ilen
length of IN data
.It Fa ibuf
pointer to IN data
.It Fa olen
length of OUT data
.It Fa obuf
pointer to OUT data
.It Fa swp
pointer to return status word
.El
.Pp
.Fn sectok_cardpresent
returns whether a card is present in the reader.
.Pp
.Fn sectok_close
closes a connection to a smart card.
.Pp
.Fn sectok_selectfile
selects a file given its FID by sending a "select" apdu to the card.
.Pp
.Fn sectok_fmt_fid
returns a printable name for a FID.
.Pp
.Fn sectok_parse_atr
parses a card ATR and returns the protocol parameters.
If the
.Dv STRV
flag is given it will print the parameters to standard out.
.Pp
.Fn sectok_parse_fname
translates a printable name to a FID.
.Pp
.Fn sectok_print_sw
looks up the error message string affiliated with a status word
and writes it to standard out.
.Pp
.Fn sectok_swOK
returns 1 if
.Dv sw
indicates success, or 0 if it indicates failure.
.Sh SEE ALSO
.Xr sectok 1
.Sh HISTORY
.Nm
first appeared in
.Ox 3.0 .
.Sh AUTHORS
Jim Rees and others at University of Michigan
Center for Information Technology Integration (CITI).
.\"
@


1.11
log
@convert to new .Dd format;
@
text
@d1 1
a1 1
.\"	$OpenBSD: sectok.3,v 1.10 2003/07/08 12:04:37 jmc Exp $
d33 1
a33 1
.Dd $Mdocdate$
@


1.10
log
@fix a list;
@
text
@d1 1
a1 1
.\"	$OpenBSD: sectok.3,v 1.9 2003/06/02 11:24:14 jmc Exp $
d33 1
a33 1
.Dd August 3, 2001
@


1.9
log
@section reorder;
@
text
@d1 1
a1 1
.\"	$OpenBSD: sectok.3,v 1.8 2003/05/24 18:30:32 jmc Exp $
d132 1
a132 2
.Pp
.Bl -tag -literal -width Ds
@


1.8
log
@- typos;
- new sentence, new line;
- whitespace at EOL
@
text
@d1 1
a1 1
.\"	$OpenBSD: sectok.3,v 1.7 2003/04/04 00:50:56 deraadt Exp $
d183 4
a190 4
.Sh HISTORY
.Nm
first appeared in
.Ox 3.0 .
@


1.7
log
@change sectok_fmt_fid() to accept a size_t for the pathname length;
must crank major, and update utils that use it
@
text
@d1 1
a1 1
.\"	$OpenBSD: sectok.3,v 1.6 2003/02/18 07:51:08 jmc Exp $
d9 1
a9 1
.\" 
d20 1
a20 1
.\" 
d96 1
a96 1
or a SW1/SW2 pair as specified in ISO 7816.
@


1.6
log
@copyrights added;

bootpef(8), pppd(8): Carnegie Mellon
map-mbone(8), mrinfo(8): Xerox
pdisk(8): Apple
awk(1): Lucent
sectok(3): University of Michigan
@
text
@d1 1
a1 1
.\"	$OpenBSD: sectok.3,v 1.5 2001/08/06 15:18:25 rees Exp $
d69 1
a69 1
.Fn sectok_fmt_fid "char *fname" "unsigned char *fid"
@


1.5
log
@Add CITI to Author section
Add HISTORY section
@
text
@d1 1
a1 1
.\"	$OpenBSD: sectok.3,v 1.4 2001/08/03 20:03:17 deraadt Exp $
d6 27
@


1.4
log
@fix #include
@
text
@d1 1
a1 1
.\"	$OpenBSD: sectok.3,v 1.3 2001/08/03 19:52:27 jakob Exp $
d157 7
a163 2
Jim Rees
.Aq rees@@umich.edu
@


1.3
log
@document sectok_friendly_open. fix sectoc_open arg. ok rees@@
@
text
@d1 1
a1 1
.\"	$OpenBSD: sectok.3,v 1.2 2001/08/03 19:23:38 millert Exp $
d13 1
a13 1
.Fd #include \&"sectok.h\&"
@


1.2
log
@o Fix sectok_apdu() proto
o s/sectok_scopen/sectok_open/
o Change the block of sectok_apdu options to a tagged list
ress@@ OK
@
text
@d1 1
a1 1
.\"	$OpenBSD: sectok.3,v 1.1 2001/08/03 18:29:14 rees Exp $
d73 1
a73 1
.Fa ttyn .
d84 8
@


1.1
log
@add man page
@
text
@d1 1
a1 1
.\"	$OpenBSD: $
d24 10
a33 10
.Fa int fd
.Fa int cla
.Fa int ins
.Fa int p1
.Fa int p2
.Fa int ilen
.Fa unsigned char *ibuf
.Fa int olen
.Fa unsigned char *obuf
.Fa int *swp
d64 1
a64 1
.Nm
d71 1
a71 1
.Fn sectok_scopen
d77 1
a77 1
.Fn sectok_scopen
d97 19
a115 10
.Bd -literal -offset xx
cla - application class
ins - instruction code
p1, p2 - per ISO 7816-3 or application dependent
ilen - length of IN data
ibuf - pointer to IN data
olen - length of OUT data
obuf - pointer to OUT data
swp - pointer to return status word
.Ed
@

