head	1.10;
access;
symbols
	OPENBSD_3_2:1.9.0.2
	OPENBSD_3_2_BASE:1.9
	OPENBSD_3_1:1.7.0.2
	OPENBSD_3_1_BASE:1.7
	OPENBSD_3_0:1.6.0.8
	OPENBSD_3_0_BASE:1.6
	OPENBSD_2_9:1.6.0.6
	OPENBSD_2_9_BASE:1.6
	OPENBSD_2_8:1.6.0.4
	OPENBSD_2_8_BASE:1.6
	OPENBSD_2_7:1.6.0.2
	OPENBSD_2_7_BASE:1.6
	OPENBSD_2_6:1.4.0.2
	OPENBSD_2_6_BASE:1.4
	OPENBSD_2_5:1.3.0.2
	OPENBSD_2_5_BASE:1.3;
locks; strict;
comment	@.\" @;


1.10
date	2003.01.20.18.14.06;	author marc;	state dead;
branches;
next	1.9;

1.9
date	2002.05.01.08.03.30;	author mpech;	state Exp;
branches;
next	1.8;

1.8
date	2002.04.30.16.31.42;	author mpech;	state Exp;
branches;
next	1.7;

1.7
date	2002.02.21.20.12.19;	author fgsch;	state Exp;
branches;
next	1.6;

1.6
date	2000.01.22.13.59.29;	author aaron;	state Exp;
branches;
next	1.5;

1.5
date	99.11.24.05.35.33;	author d;	state Exp;
branches;
next	1.4;

1.4
date	99.07.09.13.35.25;	author aaron;	state Exp;
branches;
next	1.3;

1.3
date	99.03.10.21.25.27;	author pjanzen;	state Exp;
branches;
next	1.2;

1.2
date	99.03.10.10.04.42;	author d;	state Exp;
branches;
next	1.1;

1.1
date	99.01.17.23.57.28;	author d;	state Exp;
branches;
next	;


desc
@@


1.10
log
@
bye-bye libc_r sources.
the sources have been moved (with history) to /usr/src/lib/libpthread
@
text
@.\" $OpenBSD: pthread_testcancel.3,v 1.9 2002/05/01 08:03:30 mpech Exp $
.\"
.Dd January 17, 1999
.Dt PTHREAD_TESTCANCEL 3
.Os
.Sh NAME
.Nm pthread_setcancelstate ,
.Nm pthread_setcanceltype ,
.Nm pthread_testcancel
.Nd set cancelability state
.Sh SYNOPSIS
.Fd #include <pthread.h>
.Ft int
.Fn pthread_setcancelstate "int state" "int *oldstate"
.Ft int
.Fn pthread_setcanceltype "int type" "int *oldtype"
.Ft void
.Fn pthread_testcancel "void"
.Sh DESCRIPTION
The
.Fn pthread_setcancelstate
function atomically both sets the calling thread's cancelability state
to the indicated
.Fa state
and, if
.Fa oldstate
is not
.Dv NULL ,
returns the previous cancelability state at the location referenced by
.Fa oldstate .
Legal values for
.Fa state
are
.Dv PTHREAD_CANCEL_ENABLE
and
.Dv PTHREAD_CANCEL_DISABLE .
.Pp
The
.Fn pthread_setcanceltype
function atomically both sets the calling thread's cancelability type
to the indicated
.Fa type
and, if
.Fa oldtype
is not
.Dv NULL ,
returns the previous cancelability type at the location referenced by
.Fa oldtype .
Legal values for
.Fa type
are
.Dv PTHREAD_CANCEL_DEFERRED
and
.Dv PTHREAD_CANCEL_ASYNCHRONOUS .
.Pp
The cancelability state and type of any newly created threads, including the
thread in which
.Fn main
was first invoked, are
.Dv PTHREAD_CANCEL_ENABLE
and
.Dv PTHREAD_CANCEL_DEFERRED
respectively.
.Pp
The
.Fn pthread_testcancel
function creates a cancellation point in the calling thread.
The
.Fn pthread_testcancel
function has no effect if cancelability is disabled.
.Ss Cancelability States
The cancelability state of a thread determines the action taken upon
receipt of a cancellation request.
The thread may control cancellation in a number of ways.
.Pp
Each thread maintains its own
.Dq cancelability state
which may be encoded in two bits:
.Bl -hang
.It Em Cancelability Enable
When cancelability is
.Dv PTHREAD_CANCEL_DISABLE ,
cancellation requests against the target thread are held pending.
.It Em Cancelability Type
When cancelability is enabled and the cancelability type is
.Dv PTHREAD_CANCEL_ASYNCHRONOUS ,
new or pending cancellation requests may be acted upon at any time.
When cancelability is enabled and the cancelability type is
.Dv PTHREAD_CANCEL_DEFERRED ,
cancellation requests are held pending until a cancellation point (see
below) is reached.
If cancelability is disabled, the setting of the
cancelability type has no immediate effect as all cancellation requests
are held pending; however, once cancelability is enabled again the new
type will be in effect.
.El
.Ss Cancellation Points
Cancellation points will occur when a thread is executing the following
functions:
.Fn close ,
.Fn creat ,
.Fn fcntl ,
.Fn fsync ,
.Fn msync ,
.Fn nanosleep ,
.Fn open ,
.Fn pause ,
.Fn pthread_cond_timedwait ,
.Fn pthread_cond_wait ,
.Fn pthread_join ,
.Fn pthread_testcancel ,
.Fn read ,
.Fn sigwaitinfo ,
.Fn sigsuspend ,
.Fn sigwait ,
.Fn sleep ,
.Fn system ,
.Fn tcdrain ,
.Fn wait ,
.Fn waitpid ,
.Fn write .
.Sh RETURN VALUES
If successful, the
.Fn pthread_setcancelstate
and
.Fn pthread_setcanceltype
functions will return zero.
Otherwise, an error number shall be returned to indicate the error.
.Pp
The
.Fn pthread_setcancelstate
and
.Fn pthread_setcanceltype
functions are used to control the points at which a thread may be
asynchronously cancelled.
For cancellation control to be usable in modular
fashion, some rules must be followed.
.Pp
For purposes of this discussion, consider an object to be a generalization
of a procedure. It is a set of procedures and global variables written as
a unit and called by clients not known by the object.
Objects may depend on other objects.
.Pp
First, cancelability should only be disabled on entry to an object, never
explicitly enabled.
On exit from an object, the cancelability state should
always be restored to its value on entry to the object.
.Pp
This follows from a modularity argument: if the client of an object (or the
client of an object that uses that object) has disabled cancelability, it is
because the client doesn't want to have to worry about how to clean up if the
thread is cancelled while executing some sequence of actions.
If an object
is called in such a state and it enables cancelability and a cancellation
request is pending for that thread, then the thread will be cancelled,
contrary to the wish of the client that disabled.
.Pp
Second, the cancelability type may be explicitly set to either
.Em deferred
or
.Em asynchronous
upon entry to an object.
But as with the cancelability state, on exit from
an object that cancelability type should always be restored to its value on
entry to the object.
.Pp
Finally, only functions that are cancel-safe may be called from a thread that
is asynchronously cancelable.
.Sh ERRORS
The function
.Fn pthread_setcancelstate
may fail with:
.Bl -tag -width Er
.It Bq Er EINVAL
The specified state is not
.Dv PTHREAD_CANCEL_ENABLE
or
.Dv PTHREAD_CANCEL_DISABLE .
.El
.Pp
The function
.Fn pthread_setcanceltype
may fail with:
.Bl -tag -width Er
.It Bq Er EINVAL
The specified state is not
.Dv PTHREAD_CANCEL_DEFERRED
or
.Dv PTHREAD_CANCEL_ASYNCHRONOUS .
.El
.Sh SEE ALSO
.Xr pthread_cancel 3
.Sh STANDARDS
.Fn pthread_testcancel
conforms to
.St -p1003.1-96
@


1.9
log
@o) start new sentence on a new line;
o) always close .Bl tags;
o) fix usage of .Xr;

millert@@ ok
@
text
@d1 1
a1 1
.\" $OpenBSD: pthread_testcancel.3,v 1.8 2002/04/30 16:31:42 mpech Exp $
@


1.8
log
@Initial cleanup:
o) remove extra space in the end of line;
o) remove extra blank lines in the end of file;
o) remove .Pp before .Ss;
o) CAVEAT -> CAVEATS;
o) fix usage of .Fa;
o) <blank-line> -> .Pp;
o) wrap long lines;

millert@@ ok
@
text
@d1 1
a1 1
.\" $OpenBSD: pthread_testcancel.3,v 1.7 2002/02/21 20:12:19 fgsch Exp $
d67 2
a68 1
function creates a cancellation point in the calling thread. The
d73 2
a74 2
receipt of a cancellation request. The thread may control cancellation in
a number of ways.
d91 2
a92 1
below) is reached. If cancelability is disabled, the setting of the
d127 2
a128 2
functions will return zero. Otherwise, an error number shall be returned to
indicate the error.
d135 2
a136 1
asynchronously cancelled. For cancellation control to be usable in modular
d141 2
a142 2
a unit and called by clients not known by the object. Objects may depend
on other objects.
d145 2
a146 1
explicitly enabled. On exit from an object, the cancelability state should
d152 2
a153 1
thread is cancelled while executing some sequence of actions. If an object
d162 2
a163 1
upon entry to an object. But as with the cancelability state, on exit from
@


1.7
log
@Use .St for standards. Random cleanups as well.
@
text
@d1 1
a1 1
.\" $OpenBSD: pthread_testcancel.3,v 1.6 2000/01/22 13:59:29 aaron Exp $
a69 1
.Pp
d190 1
a190 1
.St -p1003.1-96   
@


1.6
log
@canceled -> cancelled
@
text
@d1 2
a2 1
.\" $OpenBSD: pthread_testcancel.3,v 1.5 1999/11/24 05:35:33 d Exp $
d25 5
a29 1
and returns the previous cancelability state at the location referenced by
d43 5
a47 1
and returns the previous cancelability type at the location referenced by
d190 2
a191 3
conforms to ISO/IEC 9945-1 ANSI/IEEE
.Pq Dq Tn POSIX
Std 1003.1 Second Edition 1996-07-12.
@


1.5
log
@Add FreeBSD tags
@
text
@d1 1
a1 1
.\" $OpenBSD$
d125 1
a125 1
asynchronously canceled. For cancellation control to be usable in modular
d140 1
a140 1
thread is canceled while executing some sequence of actions. If an object
d142 1
a142 1
request is pending for that thread, then the thread will be canceled,
@


1.4
log
@- remove all trailing whitespace
     * except when it is escaped with a `\' at the end of the line
- fix remaining .Nm usage as well
- this is from a patch I received from kwesterback@@home.com, who has been
  working on some scripts for fixing formatting errors in mdoc'd man pages

Ok, so there could be a cost/benefit debate with this commit, but since I have
the patch we might as well commit it...
@
text
@d1 1
@


1.3
log
@fix comma splices involving 'however'
@
text
@d39 1
a39 1
Legal values for 
d84 1
a84 1
type will be in effect. 
d123 1
a123 1
functions are used to control the points at which a thread may be 
@


1.2
log
@Fix .Os so that correct OS version appears
@
text
@d83 1
a83 1
are held pending, however, once cancelability is enabled again the new
@


1.1
log
@pthread_cancel() and cancellation points
@
text
@d3 1
a3 1
.Os BSD 4
@

