head	1.7;
access;
symbols
	OPENBSD_6_2_BASE:1.7
	OPENBSD_6_1:1.7.0.4
	OPENBSD_6_1_BASE:1.7
	OPENBSD_6_0:1.6.0.10
	OPENBSD_6_0_BASE:1.6
	OPENBSD_5_9:1.6.0.6
	OPENBSD_5_9_BASE:1.6
	OPENBSD_5_8:1.6.0.8
	OPENBSD_5_8_BASE:1.6
	OPENBSD_5_7:1.6.0.2
	OPENBSD_5_7_BASE:1.6
	OPENBSD_5_6:1.6.0.4
	OPENBSD_5_6_BASE:1.6
	OPENBSD_5_5:1.5.0.6
	OPENBSD_5_5_BASE:1.5
	OPENBSD_5_4:1.5.0.2
	OPENBSD_5_4_BASE:1.5
	OPENBSD_5_3:1.4.0.2
	OPENBSD_5_3_BASE:1.4
	OPENBSD_5_2:1.2.0.6
	OPENBSD_5_2_BASE:1.2
	OPENBSD_5_1_BASE:1.2
	OPENBSD_5_1:1.2.0.4
	OPENBSD_5_0:1.2.0.2
	OPENBSD_5_0_BASE:1.2
	OPENBSD_4_9:1.1.0.8
	OPENBSD_4_9_BASE:1.1
	OPENBSD_4_8:1.1.0.6
	OPENBSD_4_8_BASE:1.1
	OPENBSD_4_7:1.1.0.2
	OPENBSD_4_7_BASE:1.1
	OPENBSD_4_6:1.1.0.4
	OPENBSD_4_6_BASE:1.1;
locks; strict;
comment	@ * @;


1.7
date	2016.09.12.19.47.02;	author guenther;	state Exp;
branches;
next	1.6;
commitid	Lp8bnB2xK76nGFvJ;

1.6
date	2014.04.18.15.09.52;	author guenther;	state Exp;
branches;
next	1.5;

1.5
date	2013.03.28.18.09.38;	author martynas;	state Exp;
branches;
next	1.4;

1.4
date	2013.01.13.03.44.59;	author martynas;	state Exp;
branches;
next	1.3;

1.3
date	2012.12.05.23.20.03;	author deraadt;	state Exp;
branches;
next	1.2;

1.2
date	2011.05.30.18.34.38;	author martynas;	state Exp;
branches;
next	1.1;

1.1
date	2009.04.05.19.26.27;	author martynas;	state Exp;
branches;
next	;


desc
@@


1.7
log
@Reduce libm's exports and make internal calls go direct.
All dependencies on libc are now via reserved/standardized names.

ok kettenis@@ millert@@ deraadt@@
@
text
@/*	$OpenBSD: e_sqrt.c,v 1.6 2014/04/18 15:09:52 guenther Exp $	*/

/*
 * Written by Martynas Venckus.  Public domain
 */

#include <sys/types.h>
#include <math.h>

#define	FPSCR_PR	(1 << 19)
#define	FPSCR_SZ	(1 << 20)

double
sqrt(double d)
{
	register_t fpscr, nfpscr;

	__asm__ volatile ("sts fpscr, %0" : "=r" (fpscr));

	/* Set floating-point mode to double-precision. */
	nfpscr = fpscr | FPSCR_PR;

	/* Do not set SZ and PR to 1 simultaneously. */
	nfpscr &= ~FPSCR_SZ;

	__asm__ volatile ("lds %0, fpscr" : : "r" (nfpscr));
	__asm__ volatile ("fsqrt %0" : "+f" (d));

	/* Restore fp status/control register. */
	__asm__ volatile ("lds %0, fpscr" : : "r" (fpscr));

	return (d);
}
DEF_STD(sqrt);
LDBL_CLONE(sqrt);
@


1.6
log
@It's been a quarter century: we can assume volatile is present with that name.
@
text
@d1 1
a1 1
/*	$OpenBSD: e_sqrt.c,v 1.5 2013/03/28 18:09:38 martynas Exp $	*/
d34 2
a35 2

__strong_alias(sqrtl,sqrt);
@


1.5
log
@Switch libc and libm to use strong aliases rather than weak aliases
where appropriate.  Among other things makes the symbols consistent
across all architectures (notably where ldbl mantissa is 53 bits).

While at it, kill unused LINTLIBRARY/PROTOLIB1 cruft which was there
to trick lint into recording the right prototypes for aliased
functions.  Most of the work done at the awesome n2k13 hackathon.

Agreed by kettenis@@, guenther@@, matthew@@.
@
text
@d1 1
a1 1
/*	$OpenBSD: e_sqrt.c,v 1.4 2013/01/13 03:44:59 martynas Exp $	*/
d18 1
a18 1
	__asm__ __volatile__ ("sts fpscr, %0" : "=r" (fpscr));
d26 2
a27 2
	__asm__ __volatile__ ("lds %0, fpscr" : : "r" (nfpscr));
	__asm__ __volatile__ ("fsqrt %0" : "+f" (d));
d30 1
a30 1
	__asm__ __volatile__ ("lds %0, fpscr" : : "r" (fpscr));
@


1.4
log
@Get rid of the very ugly lint workarounds: LINTLIBRARY, PROTOLIB,
and a few empty files for lint to chew on.
@
text
@d1 1
a1 1
/*	$OpenBSD: e_sqrt.c,v 1.3 2012/12/05 23:20:03 deraadt Exp $	*/
d35 1
a35 1
__weak_alias(sqrtl,sqrt);
@


1.3
log
@Remove excessive sys/cdefs.h inclusion
ok guenther millert kettenis
@
text
@d1 1
a1 1
/*	$OpenBSD: e_sqrt.c,v 1.2 2011/05/30 18:34:38 martynas Exp $	*/
a6 2
/* LINTLIBRARY */

a34 5
/* No extended-precision is present. */
#ifdef	lint
/* PROTOLIB1 */
long double sqrtl(long double);
#else	/* lint */
a35 1
#endif	/* lint */
@


1.2
log
@Trick lint into recording the right prototypes in the llib-lm.ln
database on platforms without extended-precision floating-point
support.

Seems like a reasonable approach to millert@@.
@
text
@d1 1
a1 1
/*	$OpenBSD: e_sqrt.c,v 1.1 2009/04/05 19:26:27 martynas Exp $	*/
a9 1
#include <sys/cdefs.h>
@


1.1
log
@implement and use sqrt, sqrtf & fabsf in hardware;  since it's
faster that way.  tested by myself.  discussed w/ & ok miod@@, millert@@
@
text
@d1 1
a1 1
/*	$OpenBSD$	*/
d7 2
d39 4
d44 1
a44 1

@

