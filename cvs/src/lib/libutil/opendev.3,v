head	1.22;
access;
symbols
	OPENBSD_6_1:1.22.0.10
	OPENBSD_6_1_BASE:1.22
	OPENBSD_6_0:1.22.0.8
	OPENBSD_6_0_BASE:1.22
	OPENBSD_5_9:1.22.0.4
	OPENBSD_5_9_BASE:1.22
	OPENBSD_5_8:1.22.0.6
	OPENBSD_5_8_BASE:1.22
	OPENBSD_5_7:1.22.0.2
	OPENBSD_5_7_BASE:1.22
	OPENBSD_5_6:1.21.0.8
	OPENBSD_5_6_BASE:1.21
	OPENBSD_5_5:1.21.0.6
	OPENBSD_5_5_BASE:1.21
	OPENBSD_5_4:1.21.0.2
	OPENBSD_5_4_BASE:1.21
	OPENBSD_5_3:1.20.0.10
	OPENBSD_5_3_BASE:1.20
	OPENBSD_5_2:1.20.0.8
	OPENBSD_5_2_BASE:1.20
	OPENBSD_5_1_BASE:1.20
	OPENBSD_5_1:1.20.0.6
	OPENBSD_5_0:1.20.0.4
	OPENBSD_5_0_BASE:1.20
	OPENBSD_4_9:1.20.0.2
	OPENBSD_4_9_BASE:1.20
	OPENBSD_4_8:1.18.0.2
	OPENBSD_4_8_BASE:1.18
	OPENBSD_4_7:1.17.0.10
	OPENBSD_4_7_BASE:1.17
	OPENBSD_4_6:1.17.0.12
	OPENBSD_4_6_BASE:1.17
	OPENBSD_4_5:1.17.0.8
	OPENBSD_4_5_BASE:1.17
	OPENBSD_4_4:1.17.0.6
	OPENBSD_4_4_BASE:1.17
	OPENBSD_4_3:1.17.0.4
	OPENBSD_4_3_BASE:1.17
	OPENBSD_4_2:1.17.0.2
	OPENBSD_4_2_BASE:1.17
	OPENBSD_4_1:1.16.0.2
	OPENBSD_4_1_BASE:1.16
	OPENBSD_4_0:1.15.0.18
	OPENBSD_4_0_BASE:1.15
	OPENBSD_3_9:1.15.0.16
	OPENBSD_3_9_BASE:1.15
	OPENBSD_3_8:1.15.0.14
	OPENBSD_3_8_BASE:1.15
	OPENBSD_3_7:1.15.0.12
	OPENBSD_3_7_BASE:1.15
	OPENBSD_3_6:1.15.0.10
	OPENBSD_3_6_BASE:1.15
	OPENBSD_3_5:1.15.0.8
	OPENBSD_3_5_BASE:1.15
	OPENBSD_3_4:1.15.0.6
	OPENBSD_3_4_BASE:1.15
	OPENBSD_3_3:1.15.0.4
	OPENBSD_3_3_BASE:1.15
	OPENBSD_3_2:1.15.0.2
	OPENBSD_3_2_BASE:1.15
	OPENBSD_3_1:1.13.0.2
	OPENBSD_3_1_BASE:1.13
	OPENBSD_3_0:1.10.0.8
	OPENBSD_3_0_BASE:1.10
	OPENBSD_2_9:1.10.0.6
	OPENBSD_2_9_BASE:1.10
	OPENBSD_2_8:1.10.0.4
	OPENBSD_2_8_BASE:1.10
	OPENBSD_2_7:1.10.0.2
	OPENBSD_2_7_BASE:1.10
	OPENBSD_2_6:1.8.0.2
	OPENBSD_2_6_BASE:1.8
	OPENBSD_2_5:1.5.0.6
	OPENBSD_2_5_BASE:1.5
	OPENBSD_2_4:1.5.0.4
	OPENBSD_2_4_BASE:1.5
	OPENBSD_2_3:1.5.0.2
	OPENBSD_2_3_BASE:1.5
	OPENBSD_2_2:1.4.0.6
	OPENBSD_2_2_BASE:1.4
	OPENBSD_2_1:1.4.0.4
	OPENBSD_2_1_BASE:1.4
	OPENBSD_2_0:1.4.0.2
	OPENBSD_2_0_BASE:1.4;
locks; strict;
comment	@# @;


1.22
date	2015.01.15.19.06.32;	author schwarze;	state Exp;
branches;
next	1.21;
commitid	dven8mWEy4wx3j1c;

1.21
date	2013.06.05.03.40.26;	author tedu;	state Exp;
branches;
next	1.20;

1.20
date	2011.01.03.14.26.51;	author krw;	state Exp;
branches;
next	1.19;

1.19
date	2010.12.17.19.35.34;	author millert;	state Exp;
branches;
next	1.18;

1.18
date	2010.04.01.17.06.55;	author jmc;	state Exp;
branches;
next	1.17;

1.17
date	2007.05.31.19.19.38;	author jmc;	state Exp;
branches;
next	1.16;

1.16
date	2007.02.06.20.07.15;	author jmc;	state Exp;
branches;
next	1.15;

1.15
date	2002.05.01.08.03.30;	author mpech;	state Exp;
branches;
next	1.14;

1.14
date	2002.04.30.16.31.42;	author mpech;	state Exp;
branches;
next	1.13;

1.13
date	2002.02.26.21.16.26;	author pvalchev;	state Exp;
branches;
next	1.12;

1.12
date	2002.02.26.07.28.51;	author pvalchev;	state Exp;
branches;
next	1.11;

1.11
date	2002.02.25.22.19.45;	author pvalchev;	state Exp;
branches;
next	1.10;

1.10
date	2000.05.01.06.05.33;	author hugh;	state Exp;
branches;
next	1.9;

1.9
date	2000.04.30.17.37.46;	author millert;	state Exp;
branches;
next	1.8;

1.8
date	99.07.07.10.50.06;	author aaron;	state Exp;
branches;
next	1.7;

1.7
date	99.07.02.21.13.07;	author aaron;	state Exp;
branches;
next	1.6;

1.6
date	99.05.27.16.21.00;	author aaron;	state Exp;
branches;
next	1.5;

1.5
date	98.03.10.04.50.37;	author millert;	state Exp;
branches;
next	1.4;

1.4
date	96.06.20.10.46.01;	author deraadt;	state Exp;
branches;
next	1.3;

1.3
date	96.06.18.09.13.41;	author downsj;	state Exp;
branches;
next	1.2;

1.2
date	96.06.18.09.12.03;	author downsj;	state Exp;
branches;
next	1.1;

1.1
date	96.06.17.08.17.33;	author downsj;	state Exp;
branches;
next	;


desc
@@


1.22
log
@remove .Tn; from Jan Stary <hans at stare dot cz>
@
text
@.\"	$OpenBSD: opendev.3,v 1.21 2013/06/05 03:40:26 tedu Exp $
.\"
.\" Copyright (c) 2000, Todd C. Miller.  All rights reserved.
.\" Copyright (c) 1996, Jason Downs.  All rights reserved.
.\"
.\" Redistribution and use in source and binary forms, with or without
.\" modification, are permitted provided that the following conditions
.\" are met:
.\" 1. Redistributions of source code must retain the above copyright
.\"    notice, this list of conditions and the following disclaimer.
.\" 2. Redistributions in binary form must reproduce the above copyright
.\"    notice, this list of conditions and the following disclaimer in the
.\"    documentation and/or other materials provided with the distribution.
.\"
.\" THIS SOFTWARE IS PROVIDED BY THE AUTHOR(S) ``AS IS'' AND ANY EXPRESS
.\" OR IMPLIED WARRANTIES, INCLUDING, BUT NOT LIMITED TO, THE IMPLIED
.\" WARRANTIES OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE ARE
.\" DISCLAIMED.  IN NO EVENT SHALL THE AUTHOR(S) BE LIABLE FOR ANY DIRECT,
.\" INDIRECT, INCIDENTAL, SPECIAL, EXEMPLARY, OR CONSEQUENTIAL DAMAGES
.\" (INCLUDING, BUT NOT LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR
.\" SERVICES; LOSS OF USE, DATA, OR PROFITS; OR BUSINESS INTERRUPTION) HOWEVER
.\" CAUSED AND ON ANY THEORY OF LIABILITY, WHETHER IN CONTRACT, STRICT
.\" LIABILITY, OR TORT (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY
.\" OUT OF THE USE OF THIS SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF
.\" SUCH DAMAGE.
.\"
.Dd $Mdocdate: June 5 2013 $
.Dt OPENDEV 3
.Os
.Sh NAME
.Nm opendev
.Nd short form device open routine
.Sh SYNOPSIS
.In util.h
.Ft int
.Fn opendev "const char *path" "int oflags" "int dflags" "char **realpath"
.Sh DESCRIPTION
The
.Fn opendev
function opens a device using a
.Dq short form
name or
.Xr disklabel 8
UID
.Pq DUID .
For instance
.Dq sd0
or
.Dq sd0c
will be expanded to
.Pa /dev/rsd0c
on most architectures.
.Pp
Device name lookup is done by first checking
.Fa path
for a
.Sq /
and if one is found attempting to open that file.
If not,
.Fa path
is checked to see if it is a valid DUID.
If it is, the corresponding device is obtained via
.Xr diskmap 4 .
If
.Fa path
has no
.Sq /
and is not a DUID,
.Fa /dev
is searched for a matching device.
.Pp
The
.Fa oflags
are the same as the
.Fa flags
passed to
.Xr open 2 .
.Pp
The
.Fa dflags
are specified by OR'ing the following values:
.Bd -literal -offset indent
OPENDEV_PART	attempt to open the raw partition during expansion
OPENDEV_BLCK	open the block device (default is character device)
.Ed
.Pp
If
.Fa realpath
is not
.Dv NULL ,
it is modified to point at the fully expanded device name.
.Sh RETURN VALUES
The
.Fn opendev
return value and errors are the same as the return value and errors of
.Xr open 2 .
.Sh SEE ALSO
.Xr open 2 ,
.Xr getrawpartition 3 ,
.Xr diskmap 4 ,
.Xr disklabel 8
.Sh HISTORY
The
.Fn opendev
function first appeared in
.Ox 1.2 .
.Sh CAVEATS
If
.Fa realpath
is not
.Dv NULL ,
on return it will point to internal
static storage space that will be overwritten by subsequent calls.
@


1.21
log
@use fancy .In macro for includes. from Jan Klemkow. ok jmc schwarze
@
text
@d1 1
a1 1
.\"	$OpenBSD: opendev.3,v 1.20 2011/01/03 14:26:51 krw Exp $
d27 1
a27 1
.Dd $Mdocdate: January 3 2011 $
d81 1
a81 3
are specified by
.Tn OR Ns 'ing
the following values:
@


1.20
log
@Update to better describe reality, i.e. disklabel(8) UID usage.

ok jmc@@ jsing@@
@
text
@d1 1
a1 1
.\"	$OpenBSD: opendev.3,v 1.19 2010/12/17 19:35:34 millert Exp $
d27 1
a27 1
.Dd $Mdocdate: December 17 2010 $
d34 1
a34 1
.Fd #include <util.h>
@


1.19
log
@opendev() path argument should be const.  OK deraadt@@
@
text
@d1 1
a1 1
.\"	$OpenBSD: opendev.3,v 1.18 2010/04/01 17:06:55 jmc Exp $
d27 1
a27 1
.Dd $Mdocdate: April 1 2010 $
d40 1
a40 1
function opens a device using the
d42 5
a46 2
name.
This is typically
d49 2
a50 2
.Dq sd0c ,
for instance, which will be expanded to
d57 1
a57 1
.Dq /
d59 10
a68 1
Otherwise
d101 3
a103 1
.Xr getrawpartition 3
@


1.18
log
@WARNINGS -> CAVEATS, and a little neccessary cleanup;
@
text
@d1 1
a1 1
.\"	$OpenBSD: opendev.3,v 1.17 2007/05/31 19:19:38 jmc Exp $
d27 1
a27 1
.Dd $Mdocdate: May 31 2007 $
d36 1
a36 1
.Fn opendev "char *path" "int oflags" "int dflags" "char **realpath"
@


1.17
log
@convert to new .Dd format;
@
text
@d1 1
a1 1
.\"	$OpenBSD: opendev.3,v 1.16 2007/02/06 20:07:15 jmc Exp $
d27 1
a27 1
.Dd $Mdocdate$
a86 7
.Sh WARNINGS
If
.Fa realpath
is not
.Dv NULL ,
on return it will point to internal
static storage space that will be overwritten by subsequent calls.
d95 7
@


1.16
log
@fix some dodgy displays;
@
text
@d1 1
a1 1
.\"	$OpenBSD: opendev.3,v 1.15 2002/05/01 08:03:30 mpech Exp $
d27 1
a27 1
.Dd February 15, 2000
@


1.15
log
@o) start new sentence on a new line;
o) always close .Bl tags;
o) fix usage of .Xr;

millert@@ ok
@
text
@d1 1
a1 1
.\"	$OpenBSD: opendev.3,v 1.14 2002/04/30 16:31:42 mpech Exp $
d72 1
a72 2
.Pp
.Bd -literal -offset indent -compact
@


1.14
log
@Initial cleanup:
o) remove extra space in the end of line;
o) remove extra blank lines in the end of file;
o) remove .Pp before .Ss;
o) CAVEAT -> CAVEATS;
o) fix usage of .Fa;
o) <blank-line> -> .Pp;
o) wrap long lines;

millert@@ ok
@
text
@d1 1
a1 1
.\"	$OpenBSD: opendev.3,v 1.13 2002/02/26 21:16:26 pvalchev Exp $
d42 2
a43 1
name.  This is typically
@


1.13
log
@mdoc fixes from pjanzen
@
text
@d1 1
a1 1
.\"	$OpenBSD: opendev.3,v 1.12 2002/02/26 07:28:51 pvalchev Exp $
d90 1
a90 1
is not 
@


1.12
log
@rephrase warning; from miod
@
text
@d1 1
a1 1
.\"	$OpenBSD: opendev.3,v 1.11 2002/02/25 22:19:45 pvalchev Exp $
d88 5
a92 1
If realpath is not NULL, on return it will point to internal
@


1.11
log
@print a warning that realpath points to internal static storage space that
will be overwritten by subsequent calls; suggested by pjanzen, ok millert
@
text
@d1 1
a1 1
.\"	$OpenBSD: opendev.3,v 1.10 2000/05/01 06:05:33 hugh Exp $
d88 2
a89 2
realpath points to internal static storage space that will be
overwritten by subsequent calls.
@


1.10
log
@Document device lookup semantics.
@
text
@d1 1
a1 1
.\"	$OpenBSD: opendev.3,v 1.9 2000/04/30 17:37:46 millert Exp $
d87 3
@


1.9
log
@Add OPENDEV_BLCK flag for opening the block devices (the character
device is opened by default).

Don't open the file w/o adding a /dev/ prefix unless the file has
a '/' in it.  This prevents problems where someone says "disklabel
sd0" with a file called "sd0" in the cwd.

The OPENDEV_DRCT flag has been deprecated as it is the the default
behavior and always has been.

Add checks for >= MAXPATHLEN and return ENAMETOOLONG in that case.
@
text
@d1 1
a1 1
.\"	$OpenBSD: opendev.3,v 1.8 1999/07/07 10:50:06 aaron Exp $
d49 9
@


1.8
log
@The proper order of the ``introductory'' macros in a man page is .Dd/.Dt/.Os.
Out of the approximately 1450 man pages, only about 90 of them were wrong.
Thanks to kwesterback@@home.com for coming up with a script and patch to repair
this. The patch also inserted a .Os macro in the few man pages that were
missing one.
@
text
@d1 1
a1 1
.\"	$OpenBSD: opendev.3,v 1.7 1999/07/02 21:13:07 aaron Exp $
d3 1
d27 1
a27 1
.Dd June 17, 1996
d65 1
a65 1
OPENDEV_DRCT	attempt to open the device itself during expansion
d79 2
a80 1
.Xr open 2
@


1.7
log
@remove redundant .Pp macros
@
text
@d1 1
a1 1
.\"	$OpenBSD: opendev.3,v 1.6 1999/05/27 16:21:00 aaron Exp $
d28 1
a28 1
.Os OpenBSD
@


1.6
log
@or'ing -> OR'ing
@
text
@d1 1
a1 1
.\"	$OpenBSD: opendev.3,v 1.5 1998/03/10 04:50:37 millert Exp $
d39 7
a45 2
function opens a device using the "short form" name.  This is typically
"sd0" or "sd0c", for instance, which will be expanded to
d50 1
a50 1
.Ar oflags
d52 1
a52 1
.Ar flags
d57 1
a57 1
.Ar dflags
d59 1
a59 1
.Em OR Ns 'ing
d68 4
a71 3
.Ar realpath
is not NULL, it is modified to point at the fully expanded device name.
.Pp
d77 2
d80 1
d82 1
a82 1
first appeared in
a83 2
.Sh SEE ALSO
.Xr open 2
@


1.5
log
@use .Ox
@
text
@d1 1
a1 1
.\"	$OpenBSD: opendev.3,v 1.4 1996/06/20 10:46:01 deraadt Exp $
d54 1
a54 1
.Em or Ns 'ing
@


1.4
log
@only write to realpath if non-NULL
@
text
@d1 1
a1 1
.\"	$OpenBSD: opendev.3,v 1.3 1996/06/18 09:13:41 downsj Exp $
d73 2
a74 1
first appeared in OpenBSD 1.2.
@


1.3
log
@oops, still missed a typo
@
text
@d1 1
a1 1
.\"	$OpenBSD: opendev.3,v 1.2 1996/06/18 09:12:03 downsj Exp $
d62 3
a64 2
.Ar Realpath
will be modified to point at the fully expanded device name.
@


1.2
log
@slight cleaning
@
text
@d1 1
a1 1
.\"	$OpenBSD: opendev.3,v 1.1 1996/06/17 08:17:33 downsj Exp $
d40 1
a40 1
"sd0" or "sd0c", for instance, which will be expaned to
@


1.1
log
@opendev.3: opendev(3) man page
@
text
@d1 1
a1 1
.\"	$OpenBSD$
d39 2
a40 2
function opens a device using the ``short form'' name.  This is typically
``sd0'' or ``sd0c'', for instance, which will be expaned to
d68 1
a68 1
return value is the return value of
d70 3
@

