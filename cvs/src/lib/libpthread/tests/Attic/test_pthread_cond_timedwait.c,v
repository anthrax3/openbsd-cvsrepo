head	1.2;
access;
symbols
	OPENBSD_2_4:1.1.1.1.0.2
	OPENBSD_2_4_BASE:1.1.1.1
	from_mysql_3_22_4:1.1.1.1
	mit:1.1.1;
locks; strict;
comment	@ * @;


1.2
date	99.03.10.08.54.07;	author d;	state dead;
branches;
next	1.1;

1.1
date	98.07.21.13.22.20;	author peter;	state Exp;
branches
	1.1.1.1;
next	;

1.1.1.1
date	98.07.21.13.22.20;	author peter;	state Exp;
branches;
next	;


desc
@@


1.2
log
@Goodbye, MIT pthreads... you were a handy reference implementation
@
text
@/* ==== test_pthread_cond.c =========================================
 * Copyright (c) 1993 by Chris Provenzano, proven@@athena.mit.edu
 *
 * Description : Test pthread_cond(). Run this after test_create()
 *
 *  1.23 94/05/04 proven
 *      -Started coding this file.
 */

#include <pthread.h>
#include <stdio.h>
#include <errno.h>

#ifndef ETIME
#define ETIME ETIMEDOUT  
#endif

pthread_mutex_t mutex = PTHREAD_MUTEX_INITIALIZER;
pthread_cond_t cond = PTHREAD_COND_INITIALIZER;

void* thread_1(void * new_buf)
{
	pthread_mutex_lock(&mutex);
	pthread_cond_signal(&cond);
	pthread_mutex_unlock(&mutex);
	pthread_exit(NULL);
}

void* thread_2(void * new_buf)
{
	sleep(1);
	pthread_mutex_lock(&mutex);
	pthread_cond_signal(&cond);
	pthread_mutex_unlock(&mutex);
	pthread_exit(NULL);
}

main()
{
	struct timespec abstime = { 0, 0 };
	struct timeval curtime;
	pthread_t thread;
	int error;

	pthread_init(); 
	printf("pthread_cond_timedwait START\n");

	pthread_mutex_lock(&mutex);
	gettimeofday(&curtime, NULL);
	abstime.tv_sec = curtime.tv_sec + 5; 

	/* Test a condition timeout */
	if (pthread_cond_timedwait(&cond, &mutex, &abstime) != ETIME) {
		printf("pthread_cond_timedwait failed to timeout\n");
		printf("pthread_cond_timedwait FAILED\n");
		pthread_mutex_unlock(&mutex);
		exit(1);
	}
	printf("Got first timeout ok\n");	/* Added by monty */
	/* Test a normal condition signal */
	if (pthread_create(&thread, NULL, thread_1, NULL)) {
		printf("pthread_create failed\n");
		exit(2);
	}

	abstime.tv_sec = curtime.tv_sec + 10; 
	if (pthread_cond_timedwait(&cond, &mutex, &abstime)) {
		printf("pthread_cond_timedwait #1 timedout\n");
		printf("pthread_cond_timedwait FAILED\n");
		pthread_mutex_unlock(&mutex);
		exit(1);
	}

	/* Test a normal condition signal after a sleep */
	if (pthread_create(&thread, NULL, thread_2, NULL)) {
		printf("pthread_create failed\n");
		exit(2);
	}

	pthread_yield();

	abstime.tv_sec = curtime.tv_sec + 10; 
	if (pthread_cond_timedwait(&cond, &mutex, &abstime)) {
		printf("pthread_cond_timedwait #2 timedout\n");
		printf("pthread_cond_timedwait FAILED\n");
		pthread_mutex_unlock(&mutex);
		exit(1);
	}

	printf("pthread_cond_timedwait PASSED\n");
	pthread_mutex_unlock(&mutex);
	exit(0);
}
@


1.1
log
@Initial revision
@
text
@@


1.1.1.1
log
@Complete initial import from mySQL 3.22.4 (mit-pthreads/).
Lots of dross to move and remove yet.

At minimum:
o	remove GNU config and GNU Makefiles
o	build arch directory and migrate away machdep/
o	rebuild BSD Makefiles
o	move notes etc. into doc/

@
text
@@
