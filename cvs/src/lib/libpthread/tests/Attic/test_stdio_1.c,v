head	1.2;
access;
symbols
	OPENBSD_2_4:1.1.1.1.0.2
	OPENBSD_2_4_BASE:1.1.1.1
	from_mysql_3_22_4:1.1.1.1
	mit:1.1.1;
locks; strict;
comment	@ * @;


1.2
date	99.03.10.08.54.10;	author d;	state dead;
branches;
next	1.1;

1.1
date	98.07.21.13.22.21;	author peter;	state Exp;
branches
	1.1.1.1;
next	;

1.1.1.1
date	98.07.21.13.22.21;	author peter;	state Exp;
branches;
next	;


desc
@@


1.2
log
@Goodbye, MIT pthreads... you were a handy reference implementation
@
text
@#include <pthread.h>
#include <sys/types.h>
#include <sys/stat.h>
#include <string.h>
#include <stdlib.h>
#include <stdio.h>

char * base_name = "test_stdio_1.c";
char * dir_name = SRCDIR;
char * fullname;

#define OK 		0
#define NOTOK  -1

/* Test fopen()/ftell()/getc() */
int test_1(void)
{
	struct stat statbuf;
    FILE * fp;
	int i;

	if (stat(fullname, &statbuf) < OK) {
		printf("ERROR: Couldn't stat %s\n", fullname);
		return(NOTOK);
	}

	if ((fp = fopen(fullname, "r")) == NULL) {
		printf("ERROR: Couldn't open %s\n", fullname);
		return(NOTOK);
	}

	/* Get the entire file */
	while ((i = getc(fp)) != EOF);

	if (ftell(fp) != statbuf.st_size) {
		printf("ERROR: ftell() and stat() don't agree.");
		return(NOTOK);
	}

	if (fclose(fp) < OK) {
		printf("ERROR: fclose() failed.");
		return(NOTOK);
	}
	return(OK);
}

/* Test fopen()/fclose() */
int test_2(void)
{
	FILE *fp1, *fp2;

	if ((fp1 = fopen(fullname, "r")) == NULL) {
		printf("ERROR: Couldn't fopen %s\n", fullname);
		return(NOTOK);
	}

	if (fclose(fp1) < OK) {
		printf("ERROR: fclose() failed.");
		return(NOTOK);
	}

	if ((fp2 = fopen(fullname, "r")) == NULL) {
		printf("ERROR: Couldn't fopen %s\n", fullname);
		return(NOTOK);
	}

	if (fclose(fp2) < OK) {
		printf("ERROR: fclose() failed.");
		return(NOTOK);
	}

	if (fp1 != fp2) {
		printf("ERROR: FILE table leak.\n");
		return(NOTOK);
	}

	return(OK);
}

/* Test sscanf()/sprintf() */
int test_3(void)
{
    char * str = "10 4.53";
	char buf[64];
    double d;
    int    i;

    if (sscanf(str, "%d %lf", &i, &d) != 2) {
		printf("ERROR: sscanf didn't parse input string correctly\n");
		return(NOTOK);
	}

	/* Should have a check */
	sprintf(buf, "%d %2.2lf", i, d);

	if (strcmp(buf, str)) {
		printf("ERROR: sscanf()/sprintf() didn't parse unparse correctly\n");
		return(NOTOK);
	}
	return(OK);
}

main()
{

	printf("test_stdio_1 START\n");

	if (fullname = malloc (strlen (dir_name) + strlen (base_name) + 2)) {
		sprintf (fullname, "%s/%s", dir_name, base_name);
	} else {
		perror ("malloc");
		exit(1);
	}

	if (test_1() || test_2() || test_3()) {
		printf("test_stdio_1 FAILED\n");
		exit(1);
	}

	printf("test_stdio_1 PASSED\n");
	exit(0);
}


@


1.1
log
@Initial revision
@
text
@@


1.1.1.1
log
@Complete initial import from mySQL 3.22.4 (mit-pthreads/).
Lots of dross to move and remove yet.

At minimum:
o	remove GNU config and GNU Makefiles
o	build arch directory and migrate away machdep/
o	rebuild BSD Makefiles
o	move notes etc. into doc/

@
text
@@
