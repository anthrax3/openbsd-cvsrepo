head	1.12;
access;
symbols
	OPENBSD_6_1:1.12.0.8
	OPENBSD_6_1_BASE:1.12
	OPENBSD_6_0:1.12.0.6
	OPENBSD_6_0_BASE:1.12
	OPENBSD_5_9:1.12.0.2
	OPENBSD_5_9_BASE:1.12
	OPENBSD_5_8:1.12.0.4
	OPENBSD_5_8_BASE:1.12
	OPENBSD_5_7:1.10.0.4
	OPENBSD_5_7_BASE:1.10
	OPENBSD_5_6:1.10.0.8
	OPENBSD_5_6_BASE:1.10
	OPENBSD_5_5:1.10.0.6
	OPENBSD_5_5_BASE:1.10
	OPENBSD_5_4:1.10.0.2
	OPENBSD_5_4_BASE:1.10
	OPENBSD_5_3:1.9.0.24
	OPENBSD_5_3_BASE:1.9
	OPENBSD_5_2:1.9.0.22
	OPENBSD_5_2_BASE:1.9
	OPENBSD_5_1_BASE:1.9
	OPENBSD_5_1:1.9.0.20
	OPENBSD_5_0:1.9.0.18
	OPENBSD_5_0_BASE:1.9
	OPENBSD_4_9:1.9.0.16
	OPENBSD_4_9_BASE:1.9
	OPENBSD_4_8:1.9.0.14
	OPENBSD_4_8_BASE:1.9
	OPENBSD_4_7:1.9.0.10
	OPENBSD_4_7_BASE:1.9
	OPENBSD_4_6:1.9.0.12
	OPENBSD_4_6_BASE:1.9
	OPENBSD_4_5:1.9.0.8
	OPENBSD_4_5_BASE:1.9
	OPENBSD_4_4:1.9.0.6
	OPENBSD_4_4_BASE:1.9
	OPENBSD_4_3:1.9.0.4
	OPENBSD_4_3_BASE:1.9
	OPENBSD_4_2:1.9.0.2
	OPENBSD_4_2_BASE:1.9
	OPENBSD_4_1:1.8.0.6
	OPENBSD_4_1_BASE:1.8
	OPENBSD_4_0:1.8.0.4
	OPENBSD_4_0_BASE:1.8
	OPENBSD_3_9:1.8.0.2
	OPENBSD_3_9_BASE:1.8
	OPENBSD_2_5:1.2.0.2
	OPENBSD_2_5_BASE:1.2;
locks; strict;
comment	@.\" @;


1.12
date	2015.05.15.18.47.53;	author jmc;	state Exp;
branches;
next	1.11;
commitid	tI4jiOFXqFJqNdsq;

1.11
date	2015.05.12.20.13.15;	author guenther;	state Exp;
branches;
next	1.10;
commitid	LBsQxmhDA7VCXlFd;

1.10
date	2013.06.05.03.44.50;	author tedu;	state Exp;
branches;
next	1.9;

1.9
date	2007.05.31.19.19.36;	author jmc;	state Exp;
branches;
next	1.8;

1.8
date	2005.11.14.23.46.40;	author jmc;	state Exp;
branches;
next	1.7;

1.7
date	2005.11.01.19.27.58;	author fgsch;	state Exp;
branches;
next	1.6;

1.6
date	2005.10.31.20.04.05;	author brad;	state Exp;
branches;
next	1.5;

1.5
date	2005.10.30.08.46.52;	author jmc;	state Exp;
branches;
next	1.4;

1.4
date	2005.10.30.03.37.34;	author brad;	state Exp;
branches;
next	1.3;

1.3
date	99.06.15.00.07.40;	author d;	state dead;
branches;
next	1.2;

1.2
date	99.03.10.10.04.41;	author d;	state Exp;
branches;
next	1.1;

1.1
date	99.01.18.00.06.35;	author d;	state Exp;
branches;
next	;


desc
@@


1.12
log
@trailing whitespace;
@
text
@.\"	$OpenBSD: pthread_atfork.3,v 1.11 2015/05/12 20:13:15 guenther Exp $
.\"
.\" David Leonard <d@@openbsd.org>, 1999. Public domain.
.\"
.Dd $Mdocdate: May 12 2015 $
.Dt PTHREAD_ATFORK 3
.Os
.Sh NAME
.Nm pthread_atfork
.Nd specify handler functions to call when the process forks
.Sh SYNOPSIS
.In pthread.h
.Ft int
.Fn pthread_atfork "void (*prepare)(void)" "void (*parent)(void)" "void (*child)(void)"
.Sh DESCRIPTION
The
.Fn pthread_atfork
function declares fork handlers to be called before and after
.Xr fork 2 ,
in the context of the thread that called
.Xr fork 2 .
The
.Fa prepare
fork handler will be called before
.Xr fork 2
processing commences.
The
.Fa parent
fork handler will be called after
.Xr fork 2
processing completes in the parent process.
The
.Fa child
fork handler will be called after
.Xr fork 2
processing completes in the child process.
If no handling is desired at
one or more of these three points,
the corresponding fork handler
address(es) may be set to
.Dv NULL .
.Pp
The order of calls to
.Fn pthread_atfork
is significant.
The
.Fa parent
and
.Fa child
fork handlers will be called in the order in which they were established
by calls to
.Fn pthread_atfork .
The
.Fa prepare
fork handlers will be called in the opposite order.
.Pp
If a shared object is unloaded from process memory using
.Xr dlclose 3 ,
then any functions registered by calling
.Fn pthread_atfork
from that shared object will be unregistered without being invoked.
Note that it is the source of the call to
.Fn pthread_atfork
that matters, not the source of the functions that were registered.
.Sh RETURN VALUES
Upon successful completion,
.Fn pthread_atfork
will return a value of zero.
Otherwise, an error number will be
returned to indicate the error.
.Sh ERRORS
.Fn pthread_atfork
will fail if:
.Bl -tag -width Er
.It Bq Er ENOMEM
Insufficient table space exists to record the fork handler addresses.
None of the handler lists are modified.
.El
.Sh SEE ALSO
.Xr fork 2 ,
.Xr atexit 3 ,
.Xr dlclose 3
.Sh STANDARDS
.Fn pthread_atfork
conforms to
.St -p1003.1-2004 .
.Pp
The behavior when a shared object is unloaded is an extension to
that standard.
@


1.11
log
@Document pthread_atfork(3)'s interaction with dlclose(3)
Use Xr instead of Fn for functions documented on other manpages

ok millert@@ jmc@@ schwarze@@
@
text
@d1 1
a1 1
.\"	$OpenBSD: pthread_atfork.3,v 1.10 2013/06/05 03:44:50 tedu Exp $
d5 1
a5 1
.Dd $Mdocdate: June 5 2013 $
d88 1
a88 1
The behavior when a shared object is unloaded is an extension to   
@


1.10
log
@use fancy .In macro for includes. from Jan Klemkow. ok jmc schwarze
@
text
@d1 1
a1 1
.\"	$OpenBSD: pthread_atfork.3,v 1.9 2007/05/31 19:19:36 jmc Exp $
d5 1
a5 1
.Dd $Mdocdate: May 31 2007 $
d19 1
a19 1
.Fn fork ,
d21 1
a21 1
.Fn fork .
d25 1
a25 1
.Fn fork
d30 1
a30 1
.Fn fork
d35 1
a35 1
.Fn fork
d56 9
d81 2
a82 1
.Xr atexit 3
d87 3
@


1.9
log
@convert to new .Dd format;
@
text
@d1 1
a1 1
.\"	$OpenBSD: pthread_atfork.3,v 1.8 2005/11/14 23:46:40 jmc Exp $
d5 1
a5 1
.Dd $Mdocdate$
d12 1
a12 1
.Fd #include <pthread.h>
@


1.8
log
@revert this file to -r1.2, when it was originally written,
because of an unacceptable license:

the file was originally written by david leonard, who has kindly agreed
to us putting a (public domain) license on it: the original page did not
contain any license. thanks david.

this also includes some tweaks by me, so it does not exactly match
revision 1.2.
@
text
@d1 1
a1 1
.\"	$OpenBSD$
d5 1
a5 1
.Dd January 17, 1999
@


1.7
log
@a bit of rewording; with input from jmc@@.
@
text
@d1 1
a1 2
.\" Copyright (c) 2004 Alex Vasylenko <lxv@@omut.org>
.\" All rights reserved.
d3 1
a3 8
.\" Redistribution and use in source and binary forms, with or without
.\" modification, are permitted provided that the following conditions
.\" are met:
.\" 1. Redistributions of source code must retain the above copyright
.\"    notice, this list of conditions and the following disclaimer.
.\" 2. Redistributions in binary form must reproduce the above copyright
.\"    notice, this list of conditions and the following disclaimer in the
.\"    documentation and/or other materials provided with the distribution.
d5 1
a5 26
.\" THIS SOFTWARE IS PROVIDED BY THE AUTHOR AND CONTRIBUTORS ``AS IS'' AND
.\" ANY EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT LIMITED TO, THE
.\" IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE
.\" ARE DISCLAIMED.  IN NO EVENT SHALL THE AUTHOR OR CONTRIBUTORS BE LIABLE
.\" FOR ANY DIRECT, INDIRECT, INCIDENTAL, SPECIAL, EXEMPLARY, OR CONSEQUENTIAL
.\" DAMAGES (INCLUDING, BUT NOT LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS
.\" OR SERVICES; LOSS OF USE, DATA, OR PROFITS; OR BUSINESS INTERRUPTION)
.\" HOWEVER CAUSED AND ON ANY THEORY OF LIABILITY, WHETHER IN CONTRACT, STRICT
.\" LIABILITY, OR TORT (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY
.\" OUT OF THE USE OF THIS SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF
.\" SUCH DAMAGE.
.\"
.\" Portions of this text are reprinted and reproduced in electronic form
.\" from IEEE Std 1003.1, 2004 Edition, Standard for Information Technology --
.\" Portable Operating System Interface (POSIX), The Open Group Base
.\" Specifications Issue 6, Copyright (C) 2001-2004 by the Institute of
.\" Electrical and Electronics Engineers, Inc and The Open Group.  In the
.\" event of any discrepancy between this version and the original IEEE and
.\" The Open Group Standard, the original IEEE and The Open Group Standard is
.\" the referee document.  The original Standard can be obtained online at
.\"	http://www.opengroup.org/unix/online.html.
.\"
.\" $OpenBSD: pthread_atfork.3,v 1.6 2005/10/31 20:04:05 brad Exp $
.\" $FreeBSD: /repoman/r/ncvs/src/share/man/man3/pthread_atfork.3,v 1.3 2005/06/16 18:46:16 ru Exp $
.\"
.Dd June 21, 2004
d10 1
a10 1
.Nd register fork handlers
a12 1
.Pp
d19 1
a19 1
.Xr fork 2 ,
d21 1
a21 1
.Xr fork 2 .
d25 1
a25 1
.Xr fork 2
d29 2
a30 2
fork handle will be called after
.Xr fork 2
d35 1
a35 1
.Xr fork 2
d37 5
d43 1
a43 4
If no handling is desired at one or more of these three points, the
corresponding fork handler address(es) may be set to NULL.
.Pp
Multiple sets of handlers can be installed by calling
d45 1
a45 1
several times.
d50 4
a53 4
fork handlers will be called in the order in which they were
established by calls to
.Fn pthread_atfork
while the
d59 3
a61 2
returns a value of zero; otherwise, an error number is returned
to indicate the error.
a62 1
The
d64 1
a64 1
function will fail if:
d68 1
d71 2
a72 1
.Xr fork 2
a73 1
The
d75 2
a76 2
function is expected to conform to
.St -p1003.1 .
@


1.6
log
@add copyright from the original FreeBSD man page.
@
text
@d35 1
a35 1
.\" $OpenBSD: pthread_atfork.3,v 1.4 2005/10/30 03:37:34 brad Exp $
d71 1
d75 1
a75 1
The order of calls to
d77 1
a77 1
is significant.
d84 2
a85 2
.Fn pthread_atfork .
The
@


1.5
log
@remove trailing spaces;
@
text
@d1 33
d36 1
a36 1
.\" $FreeBSD: src/share/man/man3/pthread_atfork.3,v 1.0 2004/06/21 15:59:00 xx Exp $
@


1.4
log
@Add pthread_atfork(3)

From FreeBSD

'looks ok' fgsch@@ miod@@
man page reviewed by jmc@@
@
text
@d2 1
a2 1
.\" $OpenBSD$
d41 1
a41 1
The order of calls to 
d48 1
a48 1
fork handlers will be called in the order in which they were 
@


1.3
log
@Remove pthread_atfork(). It was only part of draft 10 for a little while and was removed before stddization.
@
text
@d1 5
a5 1
.Dd January 17, 1999
d10 1
a10 1
.Nd specify handler functions to call when the process forks
d13 1
d20 1
a20 1
.Fn fork ,
d22 1
a22 1
.Fn fork .
d26 3
a28 2
.Fn fork
processing commences. The
d30 4
a33 3
fork handler will be called after
.Fn fork
prcessing completes in the parent process. The
d36 4
a39 5
.Fn fork
processing completes in the child process. If no handling is desired at
one or more of these three points, the correspoding fork handler
address(es) may be set to
.Dv NULL .
d41 1
a41 1
The order of calls to
d43 2
a44 1
is significant. The
d48 2
a49 2
fork handlers will be called in the order in which they were established
by calls to
d57 2
a58 2
will return a value of zero. Otherwise, an error number will be
returned to indicate the error.
d60 1
d62 1
a62 1
will fail if:
a65 1
None of the handler lists are modified.
a66 1
.Pp
d68 1
a68 2
.Xr fork 2 ,
.Xr atexit 3
d70 1
d72 2
a73 3
conforms to ISO/IEC 9945-1 ANSI/IEEE
.Pq Dq Tn POSIX
Std 1003.1 Second Edition 1996-07-12.
@


1.2
log
@Fix .Os so that correct OS version appears
@
text
@@


1.1
log
@document
@
text
@d3 1
a3 1
.Os BSD 4
@

