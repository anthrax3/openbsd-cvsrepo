head	1.4;
access;
symbols
	OPENBSD_6_1:1.4.0.2
	OPENBSD_6_1_BASE:1.4
	OPENBSD_6_0:1.2.0.8
	OPENBSD_6_0_BASE:1.2
	OPENBSD_5_9:1.2.0.4
	OPENBSD_5_9_BASE:1.2
	OPENBSD_5_8:1.2.0.6
	OPENBSD_5_8_BASE:1.2
	OPENBSD_5_7:1.2.0.2
	OPENBSD_5_7_BASE:1.2;
locks; strict;
comment	@# @;


1.4
date	2016.11.20.11.00.19;	author tb;	state Exp;
branches;
next	1.3;
commitid	ZGfCotfRGHjInYrv;

1.3
date	2016.11.06.12.16.14;	author tb;	state Exp;
branches;
next	1.2;
commitid	0HsPTgUsj3jkgFn6;

1.2
date	2014.09.11.16.59.50;	author rpe;	state Exp;
branches;
next	1.1;
commitid	spu0MpBwj2CvXf3t;

1.1
date	2014.08.26.20.19.26;	author rpe;	state Exp;
branches;
next	;
commitid	2uCZGoLImpFRV5IL;


desc
@@


1.4
log
@Fix up some permissions in RELEASEDIR and /var/sysmerge.

help, testing & ok rpe
@
text
@#!/bin/sh
#       $OpenBSD: makeetcset,v 1.3 2016/11/06 12:16:14 tb Exp $
#
#  Copyright (c) 2014 Robert Peichaer <rpe@@openbsd.org>
# 
#  Permission to use, copy, modify, and distribute this software for any
#  purpose with or without fee is hereby granted, provided that the above
#  copyright notice and this permission notice appear in all copies.
# 
#  THE SOFTWARE IS PROVIDED "AS IS" AND THE AUTHOR DISCLAIMS ALL WARRANTIES
#  WITH REGARD TO THIS SOFTWARE INCLUDING ALL IMPLIED WARRANTIES OF
#  MERCHANTABILITY AND FITNESS. IN NO EVENT SHALL THE AUTHOR BE LIABLE FOR
#  ANY SPECIAL, DIRECT, INDIRECT, OR CONSEQUENTIAL DAMAGES OR ANY DAMAGES
#  WHATSOEVER RESULTING FROM LOSS OF USE, DATA OR PROFITS, WHETHER IN AN
#  ACTION OF CONTRACT, NEGLIGENCE OR OTHER TORTIOUS ACTION, ARISING OUT OF
#  OR IN CONNECTION WITH THE USE OR PERFORMANCE OF THIS SOFTWARE.

set -e
umask 022

CURDIR=$1
MAKE=$2
BASELISTS=$CURDIR/distrib/sets/lists/base/{mi,md.`machine`} 

cleanup() {
	[ "X$ETCDIR" != "X" -a -d "/tmp/${ETCDIR#/tmp/}" ] &&
		rm -rf "/tmp/${ETCDIR#/tmp/}"
}

if [ "X$CURDIR" = "X" -o "X$MAKE" = "X" ]; then
	echo "Usage: `basename $0` <CURDIR> <MAKE>"
	exit 1
fi

ETCDIR=`mktemp -d /tmp/_etcdir.XXXXXXXXXX`

trap 'cleanup' EXIT
trap 'exit' HUP INT QUIT TERM

cd $CURDIR/etc
$MAKE DESTDIR=$ETCDIR distribution-etc-root-var

cd $ETCDIR
find . \( -type f -o -type l \) -exec fgrep -hx {} $BASELISTS \; | \
	pax -rw -d -peam /

exit 0
@


1.3
log
@Pass -peam to pax(1), so ownership and permissions that were set by
etc/Makefile during 'make distribution-etc-root-var' are explicitly
honored on the build machine.

ok rpe
@
text
@d2 1
a2 1
#       $OpenBSD: makeetcset,v 1.2 2014/09/11 16:59:50 rpe Exp $
d19 1
@


1.2
log
@Install files that moved from etc to base during "make build"
to unbreak updating from src.

OK ajacoutot@@
@
text
@d2 1
a2 1
#       $OpenBSD: makeetcset,v 1.1 2014/08/26 20:19:26 rpe Exp $
d43 2
a44 1
find . \( -type f -o -type l \) -exec fgrep -hx {} $BASELISTS \; | pax -rw -d /
@


1.1
log
@Create etc set during 'make build' and embed it in base set to make
it available during a regular install or upgrade so that it doesn't
need to be independently fetched.

Idea, directions and OK deraadt@@
Feedback and Ok halex@@ and aja@@
@
text
@d2 1
a2 1
#       $OpenBSD$
d22 1
a34 1
ETCSET=$ETCDIR/usr/share/sysmerge/etc.tgz
d41 3
a43 2
[ -s "$ETCSET" ]
cp $ETCSET /usr/share/sysmerge/
@

