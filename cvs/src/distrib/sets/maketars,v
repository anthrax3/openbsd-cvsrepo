head	1.26;
access;
symbols
	OPENBSD_6_2:1.26.0.2
	OPENBSD_6_2_BASE:1.26
	OPENBSD_6_1:1.25.0.4
	OPENBSD_6_1_BASE:1.25
	OPENBSD_6_0:1.24.0.8
	OPENBSD_6_0_BASE:1.24
	OPENBSD_5_9:1.24.0.4
	OPENBSD_5_9_BASE:1.24
	OPENBSD_5_8:1.24.0.6
	OPENBSD_5_8_BASE:1.24
	OPENBSD_5_7:1.24.0.2
	OPENBSD_5_7_BASE:1.24
	OPENBSD_5_6:1.23.0.4
	OPENBSD_5_6_BASE:1.23
	OPENBSD_5_5:1.20.0.14
	OPENBSD_5_5_BASE:1.20
	OPENBSD_5_4:1.20.0.12
	OPENBSD_5_4_BASE:1.20
	OPENBSD_5_3:1.20.0.10
	OPENBSD_5_3_BASE:1.20
	OPENBSD_5_2:1.20.0.8
	OPENBSD_5_2_BASE:1.20
	OPENBSD_5_1_BASE:1.20
	OPENBSD_5_1:1.20.0.6
	OPENBSD_5_0:1.20.0.4
	OPENBSD_5_0_BASE:1.20
	OPENBSD_4_9:1.20.0.2
	OPENBSD_4_9_BASE:1.20
	OPENBSD_4_8:1.19.0.16
	OPENBSD_4_8_BASE:1.19
	OPENBSD_4_7:1.19.0.12
	OPENBSD_4_7_BASE:1.19
	OPENBSD_4_6:1.19.0.14
	OPENBSD_4_6_BASE:1.19
	OPENBSD_4_5:1.19.0.10
	OPENBSD_4_5_BASE:1.19
	OPENBSD_4_4:1.19.0.8
	OPENBSD_4_4_BASE:1.19
	OPENBSD_4_3:1.19.0.6
	OPENBSD_4_3_BASE:1.19
	OPENBSD_4_2:1.19.0.4
	OPENBSD_4_2_BASE:1.19
	OPENBSD_4_1:1.19.0.2
	OPENBSD_4_1_BASE:1.19
	OPENBSD_4_0:1.18.0.2
	OPENBSD_4_0_BASE:1.18
	OPENBSD_3_9:1.17.0.8
	OPENBSD_3_9_BASE:1.17
	OPENBSD_3_8:1.17.0.6
	OPENBSD_3_8_BASE:1.17
	OPENBSD_3_7:1.17.0.4
	OPENBSD_3_7_BASE:1.17
	OPENBSD_3_6:1.17.0.2
	OPENBSD_3_6_BASE:1.17
	OPENBSD_3_5:1.16.0.4
	OPENBSD_3_5_BASE:1.16
	OPENBSD_3_4:1.16.0.2
	OPENBSD_3_4_BASE:1.16
	OPENBSD_3_3:1.14.0.6
	OPENBSD_3_3_BASE:1.14
	OPENBSD_3_2:1.14.0.4
	OPENBSD_3_2_BASE:1.14
	OPENBSD_3_1:1.14.0.2
	OPENBSD_3_1_BASE:1.14
	OPENBSD_3_0:1.12.0.8
	OPENBSD_3_0_BASE:1.12
	OPENBSD_2_9:1.12.0.6
	OPENBSD_2_9_BASE:1.12
	OPENBSD_2_8:1.12.0.4
	OPENBSD_2_8_BASE:1.12
	OPENBSD_2_7:1.12.0.2
	OPENBSD_2_7_BASE:1.12
	OPENBSD_2_6:1.10.0.4
	OPENBSD_2_6_BASE:1.10
	OPENBSD_2_5:1.10.0.2
	OPENBSD_2_5_BASE:1.10
	OPENBSD_2_4:1.9.0.2
	OPENBSD_2_4_BASE:1.9
	OPENBSD_2_3:1.7.0.2
	OPENBSD_2_3_BASE:1.7
	OPENBSD_2_2:1.6.0.2
	OPENBSD_2_2_BASE:1.6
	OPENBSD_2_1:1.5.0.2
	OPENBSD_2_1_BASE:1.5
	OPENBSD_2_0:1.2.0.2
	OPENBSD_2_0_BASE:1.2
	netbsd_1_1:1.1.1.1;
locks; strict;
comment	@# @;


1.26
date	2017.04.17.19.44.59;	author deraadt;	state Exp;
branches;
next	1.25;
commitid	joReXAt0JS3LJumP;

1.25
date	2016.11.20.11.00.19;	author tb;	state Exp;
branches;
next	1.24;
commitid	ZGfCotfRGHjInYrv;

1.24
date	2014.08.26.20.19.26;	author rpe;	state Exp;
branches;
next	1.23;
commitid	2uCZGoLImpFRV5IL;

1.23
date	2014.07.09.19.23.28;	author espie;	state Exp;
branches;
next	1.22;
commitid	7cDYL9MDx0DC1oMf;

1.22
date	2014.07.09.17.30.09;	author espie;	state Exp;
branches;
next	1.21;
commitid	jK1tuGIPT9RjIXuY;

1.21
date	2014.07.09.16.01.17;	author espie;	state Exp;
branches;
next	1.20;
commitid	HSkyb9lTXoikNm4l;

1.20
date	2010.10.18.04.11.15;	author deraadt;	state Exp;
branches;
next	1.19;

1.19
date	2006.12.09.21.12.54;	author deraadt;	state Exp;
branches;
next	1.18;

1.18
date	2006.07.13.02.19.28;	author nick;	state Exp;
branches;
next	1.17;

1.17
date	2004.09.02.19.55.36;	author millert;	state Exp;
branches;
next	1.16;

1.16
date	2003.06.02.04.04.32;	author deraadt;	state Exp;
branches;
next	1.15;

1.15
date	2003.03.28.01.14.56;	author deraadt;	state Exp;
branches;
next	1.14;

1.14
date	2002.03.01.01.38.58;	author miod;	state Exp;
branches;
next	1.13;

1.13
date	2001.12.25.01.30.22;	author deraadt;	state Exp;
branches;
next	1.12;

1.12
date	2000.04.26.02.11.54;	author deraadt;	state Exp;
branches;
next	1.11;

1.11
date	2000.03.01.22.10.09;	author todd;	state Exp;
branches;
next	1.10;

1.10
date	98.12.19.18.32.32;	author deraadt;	state Exp;
branches;
next	1.9;

1.9
date	98.09.19.00.48.33;	author todd;	state Exp;
branches;
next	1.8;

1.8
date	98.09.15.21.36.24;	author deraadt;	state Exp;
branches;
next	1.7;

1.7
date	98.03.08.00.27.03;	author deraadt;	state Exp;
branches;
next	1.6;

1.6
date	97.10.01.22.13.00;	author deraadt;	state Exp;
branches;
next	1.5;

1.5
date	97.04.28.11.20.09;	author niklas;	state Exp;
branches;
next	1.4;

1.4
date	96.11.05.03.16.36;	author deraadt;	state Exp;
branches;
next	1.3;

1.3
date	96.10.24.13.20.39;	author briggs;	state Exp;
branches;
next	1.2;

1.2
date	96.10.06.23.25.31;	author deraadt;	state Exp;
branches;
next	1.1;

1.1
date	95.10.18.08.37.44;	author deraadt;	state Exp;
branches
	1.1.1.1;
next	;

1.1.1.1
date	95.10.18.08.37.44;	author deraadt;	state Exp;
branches;
next	;


desc
@@


1.26
log
@create a gross mechanism that can handle gcc-only, clang-only,
and gcc+clang architectures
with kettenis
@
text
@#!/bin/sh
#	$OpenBSD: maketars,v 1.25 2016/11/20 11:00:19 tb Exp $
#
# Copyright (c) 2001 Theo de Raadt
# All rights reserved.
#
# Redistribution and use in source and binary forms, with or without
# modification, are permitted provided that the following conditions
# are met:
# 1. Redistributions of source code must retain the above copyright
#    notice, this list of conditions and the following disclaimer.
# 2. Redistributions in binary form must reproduce the above copyright
#    notice, this list of conditions and the following disclaimer in the
#    documentation and/or other materials provided with the distribution.
#
# THIS SOFTWARE IS PROVIDED BY THE AUTHOR ``AS IS'' AND ANY EXPRESS OR
# IMPLIED WARRANTIES, INCLUDING, BUT NOT LIMITED TO, THE IMPLIED WARRANTIES
# OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE ARE DISCLAIMED.
# IN NO EVENT SHALL THE AUTHOR BE LIABLE FOR ANY DIRECT, INDIRECT,
# INCIDENTAL, SPECIAL, EXEMPLARY, OR CONSEQUENTIAL DAMAGES (INCLUDING, BUT
# NOT LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES; LOSS OF USE,
# DATA, OR PROFITS; OR BUSINESS INTERRUPTION) HOWEVER CAUSED AND ON ANY
# THEORY OF LIABILITY, WHETHER IN CONTRACT, STRICT LIABILITY, OR TORT
# (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE USE OF
# THIS SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.

umask 022
RELEASE=$1

if [ "X${RELEASE}" = "X" ]; then
	echo "Usage: `basename $0` <OSREVISION>"
	exit 1
fi

if [ "X${RELEASEDIR}" = "X" ]; then
	echo RELEASEDIR must be set
	exit 1
fi

if [ "X${DESTDIR}" = "X" ]; then
	echo DESTDIR must be set
	exit 1
fi

arch=`machine`
lists=`pwd`/lists
tardir=$RELEASEDIR
fsdir=$DESTDIR

TMP=`mktemp /tmp/_maketars.XXXXXXXXXX` || exit 1
TMP2=`mktemp /tmp/_maketars2.XXXXXXXXXX` || exit 1
trap 'rm -f $TMP $TMP2; exit 1' 1 15

cd $fsdir

for i in base comp game man; do
	echo -n "$i: "
	cat ${lists}/$i/mi ${lists}/$i/md.${arch} > $TMP2
	if [ $i = comp ]; then
		[ -f ${lists}/$i/gcc.${arch} ] && \
		    cat ${lists}/$i/gcc.${arch} >> $TMP2
		[ -f ${lists}/$i/clang.${arch} ] && \
		    cat ${lists}/$i/clang.${arch} >> $TMP2
	fi
	sort $TMP2 > $TMP
	cat $TMP | grep '^./usr/lib/lib' > $TMP2
	cat $TMP | grep -v '^./usr/lib/lib' >> $TMP2
	cat $TMP2 | pax -w -d | gzip > ${tardir}/$i${RELEASE}.tgz
	echo    "done."
done
rm -f $TMP $TMP2

exit 0
@


1.25
log
@Fix up some permissions in RELEASEDIR and /var/sysmerge.

help, testing & ok rpe
@
text
@d2 1
a2 1
#	$OpenBSD: maketars,v 1.24 2014/08/26 20:19:26 rpe Exp $
d58 8
a65 1
	sort ${lists}/$i/mi ${lists}/$i/md.${arch} > $TMP
@


1.24
log
@Create etc set during 'make build' and embed it in base set to make
it available during a regular install or upgrade so that it doesn't
need to be independently fetched.

Idea, directions and OK deraadt@@
Feedback and Ok halex@@ and aja@@
@
text
@d2 1
a2 1
#	$OpenBSD: maketars,v 1.23 2014/07/09 19:23:28 espie Exp $
d27 1
a27 1

@


1.23
log
@do locatedb as part of the build process
"works for me" deraadt@@
@
text
@d2 1
a2 1
#	$OpenBSD: maketars,v 1.22 2014/07/09 17:30:09 espie Exp $
d56 1
a56 1
for i in base comp etc game man; do
@


1.22
log
@oops, stripped a / too many
@
text
@d2 1
a2 1
#	$OpenBSD: maketars,v 1.21 2014/07/09 16:01:17 espie Exp $
a64 5

for i in base comp etc game man; do
	cat ${lists}/$i/mi ${lists}/$i/md.${arch} | \
	    sed -e "s,^\.,$i${RELEASE}:,"
done | sort | /usr/libexec/locate.mklocatedb > $tardir/src${RELEASE}.db
@


1.21
log
@generate a locatedb while making release.
input and okay deraadt@@
@
text
@d2 1
a2 1
#	$OpenBSD: maketars,v 1.20 2010/10/18 04:11:15 deraadt Exp $
d68 1
a68 1
	    sed -e "s,^\./,$i${RELEASE}:,"
@


1.20
log
@sync
@
text
@d2 1
a2 1
#	$OpenBSD: maketars,v 1.19 2006/12/09 21:12:54 deraadt Exp $
d65 6
@


1.19
log
@sort the sets to make sure that shared libraries are early in the sets, to
avoid various "interrupt while upgrading and you are hosed" problems.
prodded by drahn, this will save kitella from doing 6 hour drives, ok espie
@
text
@d2 1
a2 1
#	$OpenBSD: maketars,v 1.18 2006/07/13 02:19:28 nick Exp $
d56 1
a56 1
for i in base comp etc game man misc; do
@


1.18
log
@
remove the -9 from gzip.  Huge performance hit for a trivial (<1%)
reduction in file set size, not worth it.  "Go for it", deraadt@@
@
text
@d2 1
a2 1
#	$OpenBSD: maketars,v 1.17 2004/09/02 19:55:36 millert Exp $
d50 4
d58 4
a61 2
	cat ${lists}/$i/mi ${lists}/$i/md.${arch} | sort | \
	    pax -w -d | gzip > ${tardir}/$i${RELEASE}.tgz
d64 2
@


1.17
log
@Fix an occurence of "==" that should be "="; no functional change.
@
text
@d2 1
a2 1
#	$OpenBSD: maketars,v 1.16 2003/06/02 04:04:32 deraadt Exp $
d55 1
a55 1
	    pax -w -d | gzip -9 > ${tardir}/$i${RELEASE}.tgz
@


1.16
log
@typos
@
text
@d2 1
a2 1
#	$OpenBSD: maketars,v 1.15 2003/03/28 01:14:56 deraadt Exp $
d30 1
a30 1
if [ "X${RELEASE}" == "X" ]; then
@


1.15
log
@I rewrote these a while back; copyright to me
@
text
@d2 1
a2 1
#	$OpenBSD: maketars,v 1.15 2003/03/28 00:42:45 deraadt Exp $
a14 1
#    derived from this software without specific prior written permission.
@


1.14
log
@#!/bin/sh not csh
@
text
@d2 25
a26 1
#	$OpenBSD: maketars,v 1.13 2001/12/25 01:30:22 deraadt Exp $
@


1.13
log
@convert mkr/ckr to shell scripts, use mktemp(1)
@
text
@d1 2
a2 2
#!/bin/csh -f
#	$OpenBSD: maketars,v 1.12 2000/04/26 02:11:54 deraadt Exp $
@


1.12
log
@sync
@
text
@d2 1
a2 1
#	$OpenBSD: maketars,v 1.11 2000/03/01 22:10:09 todd Exp $
d5 1
a5 1
set RELEASE=$1
d7 1
a7 1
if ( "X${RELEASE}" == "X" ) then
d10 1
a10 1
endif
d12 1
a12 1
if (! $?RELEASEDIR) then
d15 1
a15 1
endif
d17 1
a17 1
if (! $?DESTDIR) then
d20 1
a20 1
endif
d22 4
a25 4
set arch=`machine`
set listsdir=`pwd`/lists
set tardir=$RELEASEDIR
set fsdir=$DESTDIR
d29 4
a32 7
set lists=(base comp etc game)
# SPECIAL: man misc

foreach setname ($lists)
	echo -n "${setname}: "
	cat $listsdir/$setname/mi $listsdir/$setname/md.${arch} | sort | \
	    pax -w -d | gzip -9 > ${tardir}/${setname}${RELEASE}.tgz
d34 1
a34 15
end

set setname=man
echo -n "${setname}: "
grep ${arch} $listsdir/man/md_share | \
    cat $listsdir/$setname/mi $listsdir/$setname/md.${arch} - | sort | \
    pax -w -d | gzip -9 > ${tardir}/${setname}${RELEASE}.tgz
echo    "done."

set setname=misc
echo -n "${setname}: "
grep -v ${arch} $listsdir/man/md_share | \
    cat $listsdir/$setname/mi $listsdir/$setname/md.${arch} - | sort | \
    pax -w -d | gzip -9 > ${tardir}/${setname}${RELEASE}.tgz
echo    "done."
@


1.11
log
@$OpenBSD$
@
text
@d2 1
a2 1
#	$OpenBSD$
d35 1
a35 1
	    pax -w -d | gzip -9 > ${tardir}/${setname}${RELEASE}.tar.gz
d43 1
a43 1
    pax -w -d | gzip -9 > ${tardir}/${setname}${RELEASE}.tar.gz
d50 1
a50 1
    pax -w -d | gzip -9 > ${tardir}/${setname}${RELEASE}.tar.gz
@


1.10
log
@merge text into base
@
text
@d2 2
@


1.9
log
@use OSrev
@
text
@d27 1
a27 1
set lists=(base comp etc game text)
a28 1
# EXTRA SPECIAL (not done here): secr
@


1.8
log
@hello 2.4
@
text
@d3 6
a8 1
set RELEASE=24
@


1.7
log
@moving to 2.3
@
text
@d3 1
a3 1
set RELEASE=23
@


1.6
log
@21 -> 22
@
text
@d3 1
a3 1
set RELEASE=22
@


1.5
log
@2.1
@
text
@d3 1
a3 1
set RELEASE=21
@


1.4
log
@s/games/game/
@
text
@d3 1
a3 1
set RELEASE=20
@


1.3
log
@Use machine instead of uname -m to get .
This allows the scripts to work more easily in some cross-development
situations and does not break any normal uses.
@
text
@d22 1
a22 1
set lists=(base comp etc games text)
@


1.2
log
@name tar files nicely
@
text
@d15 1
a15 1
set arch=`uname -m`
@


1.1
log
@Initial revision
@
text
@d3 2
d29 1
a29 1
	    pax -w -d | gzip -9 > ${tardir}/$setname.tar.gz
d37 1
a37 1
    pax -w -d | gzip -9 > ${tardir}/$setname.tar.gz
d44 1
a44 1
    pax -w -d | gzip -9 > ${tardir}/$setname.tar.gz
@


1.1.1.1
log
@initial import of NetBSD tree
@
text
@@

