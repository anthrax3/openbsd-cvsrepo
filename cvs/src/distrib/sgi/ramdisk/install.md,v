head	1.42;
access;
symbols
	OPENBSD_6_1_BASE:1.42
	OPENBSD_6_0:1.39.0.4
	OPENBSD_6_0_BASE:1.39
	OPENBSD_5_9:1.39.0.2
	OPENBSD_5_9_BASE:1.39
	OPENBSD_5_8:1.36.0.4
	OPENBSD_5_8_BASE:1.36
	OPENBSD_5_7:1.33.0.2
	OPENBSD_5_7_BASE:1.33
	OPENBSD_5_6:1.33.0.4
	OPENBSD_5_6_BASE:1.33
	OPENBSD_5_5:1.32.0.2
	OPENBSD_5_5_BASE:1.32
	OPENBSD_5_4:1.31.0.4
	OPENBSD_5_4_BASE:1.31
	OPENBSD_5_3:1.31.0.2
	OPENBSD_5_3_BASE:1.31
	OPENBSD_5_2:1.30.0.2
	OPENBSD_5_2_BASE:1.30
	OPENBSD_5_1_BASE:1.29
	OPENBSD_5_1:1.29.0.4
	OPENBSD_5_0:1.29.0.2
	OPENBSD_5_0_BASE:1.29
	OPENBSD_4_9:1.26.0.2
	OPENBSD_4_9_BASE:1.26
	OPENBSD_4_8:1.23.0.2
	OPENBSD_4_8_BASE:1.23
	OPENBSD_4_7:1.22.0.2
	OPENBSD_4_7_BASE:1.22
	OPENBSD_4_6:1.20.0.4
	OPENBSD_4_6_BASE:1.20
	OPENBSD_4_5:1.12.0.2
	OPENBSD_4_5_BASE:1.12
	OPENBSD_4_4:1.11.0.2
	OPENBSD_4_4_BASE:1.11
	OPENBSD_4_3:1.9.0.2
	OPENBSD_4_3_BASE:1.9
	OPENBSD_4_2:1.7.0.6
	OPENBSD_4_2_BASE:1.7
	OPENBSD_4_1:1.7.0.4
	OPENBSD_4_1_BASE:1.7
	OPENBSD_4_0:1.7.0.2
	OPENBSD_4_0_BASE:1.7
	OPENBSD_3_9:1.6.0.4
	OPENBSD_3_9_BASE:1.6
	OPENBSD_3_8:1.6.0.2
	OPENBSD_3_8_BASE:1.6
	OPENBSD_3_7:1.3.0.2
	OPENBSD_3_7_BASE:1.3
	OPENBSD_3_6:1.2.0.2
	OPENBSD_3_6_BASE:1.2;
locks; strict;
comment	@# @;


1.42
date	2017.01.22.23.43.54;	author rpe;	state Exp;
branches;
next	1.41;
commitid	T8Ujv1g6HeWswBdS;

1.41
date	2016.10.05.16.06.02;	author visa;	state Exp;
branches;
next	1.40;
commitid	wezG0xHrE9vQKEtd;

1.40
date	2016.09.04.09.52.03;	author rpe;	state Exp;
branches;
next	1.39;
commitid	MluxzkKaq4wrtv84;

1.39
date	2016.01.01.00.47.51;	author rpe;	state Exp;
branches;
next	1.38;
commitid	L9AzsoLe5i8xrqI6;

1.38
date	2015.12.27.19.39.28;	author rpe;	state Exp;
branches;
next	1.37;
commitid	iQYS3tTAdDl1pru2;

1.37
date	2015.12.27.16.31.08;	author deraadt;	state Exp;
branches;
next	1.36;
commitid	U0bA7BIph3cgPpCH;

1.36
date	2015.06.02.19.54.06;	author rpe;	state Exp;
branches;
next	1.35;
commitid	zUqrjWrWSBxkCmbI;

1.35
date	2015.05.31.19.40.10;	author rpe;	state Exp;
branches;
next	1.34;
commitid	p6r5f9n0C0WoWNND;

1.34
date	2015.05.04.19.55.26;	author rpe;	state Exp;
branches;
next	1.33;
commitid	NyWrBKI5Tnb4FUEi;

1.33
date	2014.03.24.20.47.30;	author miod;	state Exp;
branches;
next	1.32;

1.32
date	2013.11.16.18.37.27;	author rpe;	state Exp;
branches;
next	1.31;

1.31
date	2012.10.18.16.57.31;	author deraadt;	state Exp;
branches;
next	1.30;

1.30
date	2012.07.10.14.25.00;	author halex;	state Exp;
branches;
next	1.29;

1.29
date	2011.07.06.20.02.16;	author halex;	state Exp;
branches;
next	1.28;

1.28
date	2011.06.07.09.38.59;	author jasper;	state Exp;
branches;
next	1.27;

1.27
date	2011.04.17.20.57.11;	author krw;	state Exp;
branches;
next	1.26;

1.26
date	2011.02.19.10.18.03;	author miod;	state Exp;
branches;
next	1.25;

1.25
date	2011.02.06.21.50.44;	author miod;	state Exp;
branches;
next	1.24;

1.24
date	2011.01.03.00.36.50;	author deraadt;	state Exp;
branches;
next	1.23;

1.23
date	2010.06.26.23.16.41;	author krw;	state Exp;
branches;
next	1.22;

1.22
date	2010.02.13.14.02.58;	author miod;	state Exp;
branches;
next	1.21;

1.21
date	2010.01.19.19.55.52;	author miod;	state Exp;
branches;
next	1.20;

1.20
date	2009.06.04.00.44.47;	author krw;	state Exp;
branches;
next	1.19;

1.19
date	2009.06.02.16.23.45;	author krw;	state Exp;
branches;
next	1.18;

1.18
date	2009.05.30.04.01.29;	author miod;	state Exp;
branches;
next	1.17;

1.17
date	2009.05.18.20.57.27;	author miod;	state Exp;
branches;
next	1.16;

1.16
date	2009.05.14.18.58.17;	author miod;	state Exp;
branches;
next	1.15;

1.15
date	2009.04.12.12.56.02;	author krw;	state Exp;
branches;
next	1.14;

1.14
date	2009.04.12.01.35.01;	author krw;	state Exp;
branches;
next	1.13;

1.13
date	2009.04.10.23.11.17;	author krw;	state Exp;
branches;
next	1.12;

1.12
date	2009.03.01.06.27.28;	author jsing;	state Exp;
branches;
next	1.11;

1.11
date	2008.06.26.05.42.04;	author ray;	state Exp;
branches;
next	1.10;

1.10
date	2008.03.22.23.28.10;	author krw;	state Exp;
branches;
next	1.9;

1.9
date	2008.03.04.00.36.38;	author krw;	state Exp;
branches;
next	1.8;

1.8
date	2008.02.18.16.08.26;	author jsing;	state Exp;
branches;
next	1.7;

1.7
date	2006.03.17.09.22.43;	author otto;	state Exp;
branches;
next	1.6;

1.6
date	2005.07.08.19.40.31;	author krw;	state Exp;
branches;
next	1.5;

1.5
date	2005.04.02.14.34.46;	author krw;	state Exp;
branches;
next	1.4;

1.4
date	2005.03.27.15.13.50;	author krw;	state Exp;
branches;
next	1.3;

1.3
date	2004.12.02.23.02.48;	author miod;	state Exp;
branches;
next	1.2;

1.2
date	2004.08.26.13.32.15;	author pefo;	state Exp;
branches;
next	1.1;

1.1
date	2004.08.06.22.33.27;	author deraadt;	state Exp;
branches;
next	;


desc
@@


1.42
log
@Whitespaces ...
@
text
@#	$OpenBSD: install.md,v 1.41 2016/10/05 16:06:02 visa Exp $
#
# Copyright (c) 1996 The NetBSD Foundation, Inc.
# All rights reserved.
#
# This code is derived from software contributed to The NetBSD Foundation
# by Jason R. Thorpe.
#
# Redistribution and use in source and binary forms, with or without
# modification, are permitted provided that the following conditions
# are met:
# 1. Redistributions of source code must retain the above copyright
#    notice, this list of conditions and the following disclaimer.
# 2. Redistributions in binary form must reproduce the above copyright
#    notice, this list of conditions and the following disclaimer in the
#    documentation and/or other materials provided with the distribution.
#
# THIS SOFTWARE IS PROVIDED BY THE NETBSD FOUNDATION, INC. AND CONTRIBUTORS
# ``AS IS'' AND ANY EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT LIMITED
# TO, THE IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR
# PURPOSE ARE DISCLAIMED.  IN NO EVENT SHALL THE REGENTS OR CONTRIBUTORS BE
# LIABLE FOR ANY DIRECT, INDIRECT, INCIDENTAL, SPECIAL, EXEMPLARY, OR
# CONSEQUENTIAL DAMAGES (INCLUDING, BUT NOT LIMITED TO, PROCUREMENT OF
# SUBSTITUTE GOODS OR SERVICES; LOSS OF USE, DATA, OR PROFITS; OR BUSINESS
# INTERRUPTION) HOWEVER CAUSED AND ON ANY THEORY OF LIABILITY, WHETHER IN
# CONTRACT, STRICT LIABILITY, OR TORT (INCLUDING NEGLIGENCE OR OTHERWISE)
# ARISING IN ANY WAY OUT OF THE USE OF THIS SOFTWARE, EVEN IF ADVISED OF THE
# POSSIBILITY OF SUCH DAMAGE.
#
#
# machine dependent section of installation/upgrade script.
#

IPARCH=$(sysctl -n hw.model)
NCPU=$(sysctl -n hw.ncpufound)

MDSETS="bsd.$IPARCH bsd.rd.$IPARCH"
SANESETS="bsd.$IPARCH"
if ((NCPU > 1)); then
	MDSETS="$MDSETS bsd.mp.$IPARCH"
	SANESETS="$SANESETS bsd.mp.$IPARCH"
fi
DEFAULTSETS=$MDSETS

md_installboot() {
	local _disk=$1

	echo "Installing boot loader in volume header."
	if ! /usr/mdec/sgivol -w boot /mnt/usr/mdec/boot-$IPARCH $_disk; then
		echo "\nWARNING: Boot install failed. Booting from disk will not be possible"
	fi

	for _k in /mnt/bsd{,.mp,.rd}; do
		[[ -f $_k.$IPARCH ]] && mv $_k.$IPARCH $_k
	done 
}

md_prep_disklabel()
{
	local _disk=$1 _f=/tmp/i/fstab.$1

	echo "\nChecking SGI Volume Header:"
	/usr/mdec/sgivol -q $_disk >/dev/null 2>/dev/null
	case $? in
	0)	/usr/mdec/sgivol $_disk
	cat <<__EOT

An SGI Volume Header was found on the disk. Normally you want to replace it
with a new Volume Header suitable for installing OpenBSD. Doing this will
of course delete all data currently on the disk.
__EOT
		if ask_yn "Do you want to overwrite the current header?" y; then
			/usr/mdec/sgivol -qi $_disk
		else
			cat <<__EOT

If the Volume Header was installed by a previous OpenBSD install keeping
it is OK as long as the Volume Header has room for the 'boot' program.
If you are trying to keep an old IRIX Volume Header, OpenBSD install will
use the 'a' partition on the disk for the install and any data in that
partition will be lost.
__EOT
			if ! ask_yn "Are you sure you want to try to keep the old header?" y; then
				ask_yn "Do you want to overwrite the old header instead?" ||
					return 1
				/usr/mdec/sgivol -qi $_disk
			fi
		fi
		;;
	1)	echo "\nYour disk seems to be unaccessible. It was not possible"
		echo "determine if there is a proper Volume Header or not."
		ask_yn "Do you want to continue anyway?" || return 1
		;;
	2)	echo "\nThere is no Volume Header found on the disk. A Volume"
		echo "header is required to be able to boot from the disk."
		ask_yn "Do you want to install a Volume Header?" y || return 1
		/usr/mdec/sgivol -qi $_disk
		;;
	esac

	disklabel_autolayout $_disk $_f || return
	[[ -s $_f ]] && return

	cat <<__EOT

You will now create an OpenBSD disklabel. The disklabel must have an
'a' partition, being the space available for OpenBSD's root file system.
The 'p' partition must be retained since it contains the SGI Volume Header;
this in turn contains the boot loader. No other partitions should overlap
with the SGI Volume Header, which by default will use the first 3134 sectors.

Do not change any parameters except the partition layout and the label name.

__EOT
	disklabel -c -F /tmp/i/fstab.$_disk -E $_disk
}

md_congrats() {
	cat <<__EOT

INSTALL.$ARCH describes how to configure the ARCS PROM to boot OpenBSD.
__EOT
}

md_consoleinfo() {
}
@


1.41
log
@Remove an outdated remark about the 'a' partition. The sgi bootblocks
now locate the partition by using the disklabel.

ok jsing@@
@
text
@d1 1
a1 2
#	$OpenBSD: install.md,v 1.40 2016/09/04 09:52:03 rpe Exp $
#
@


1.40
log
@Move files created by root during install/upgrade in a subdir of
/tmp with proper permissions so that unprivileged programs can not
tamper with them.

positive feedback from deraadt
OK halex
@
text
@d1 1
a1 1
#	$OpenBSD: install.md,v 1.39 2016/01/01 00:47:51 rpe Exp $
a111 6

Additionally, the 'a' partition must be the first partition on the disk,
immediately following the SGI Volume Header. If the default SGI Volume Header
size is used, the 'a' partition should be located at offset 3135. If the
'a' partition is not located immediately after the SGI Volume Header the
boot loader will not be able to locate and load the kernel.
@


1.39
log
@- enable activation of MP kernel for IP27
- use IPARCH instead of sysctl again
- use for-loop to copy kernels

feedback, tested and OK visa@@
no objections krw@@
@
text
@d1 1
a1 1
#	$OpenBSD: install.md,v 1.38 2015/12/27 19:39:28 rpe Exp $
d61 1
a61 1
	local _disk=$1 _f=/tmp/fstab.$1
d122 1
a122 1
	disklabel -c -F /tmp/fstab.$_disk -E $_disk
@


1.38
log
@Remove stray '}'.
@
text
@d1 1
a1 1
#	$OpenBSD: install.md,v 1.37 2015/12/27 16:31:08 deraadt Exp $
d40 1
a40 3
# Since we do not provide bsd.mp on IP27 yet, do not add bsd.mp.IP27 to the
# sets, as this will cause a warning in sane_install()
if ((NCPU > 1)) && [[ $IPARCH == IP30 ]]; then
d50 1
a50 1
	if ! /usr/mdec/sgivol -w boot /mnt/usr/mdec/boot-$(sysctl -n hw.model) $_disk; then
d54 3
a56 3
	[[ -f /mnt/bsd.$IPARCH ]] && mv /mnt/bsd.$IPARCH /mnt/bsd
	[[ -f /mnt/bsd.mp.$IPARCH ]] && mv /mnt/bsd.mp.$IPARCH /mnt/bsd.mp
	[[ -f /mnt/bsd.rd.$IPARCH ]] && mv /mnt/bsd.rd.$IPARCH /mnt/bsd.rd
@


1.37
log
@welcome GENERIC.IP27 MP (dual cpu on O350 now)
ok visa
@
text
@d1 1
a1 1
#	$OpenBSD: install.md,v 1.36 2015/06/02 19:54:06 rpe Exp $
d43 1
a43 1
	MDSETS="$MDSETS bsd.mp.$IPARCH}"
@


1.36
log
@Remove the $FSTABFLAG variable and use -F directly. The installer
uses disklabel UIDs unconditionally for a while already.

OK krw@@
"looks good" deraadt@@
@
text
@d1 1
a1 1
#	$OpenBSD: install.md,v 1.35 2015/05/31 19:40:10 rpe Exp $
d38 2
a39 2
MDSETS="bsd.${IPARCH} bsd.rd.${IPARCH}"
SANESETS="bsd.${IPARCH}"
d42 3
a44 3
if ((NCPU > 1)) && [[ $IPARCH = IP30 ]]; then
	MDSETS="${MDSETS} bsd.mp.${IPARCH}"
	SANESETS="${SANESETS} bsd.mp.${IPARCH}"
d46 1
a46 1
DEFAULTSETS=${MDSETS}
d52 3
a54 8
	/usr/mdec/sgivol -w boot /mnt/usr/mdec/boot-`sysctl -n hw.model` $_disk
	case $? in
	0)
		;;
	*)	echo
		echo "WARNING: Boot install failed. Booting from disk will not be possible"
		;;
	esac
d56 3
a58 9
	if [[ -f /mnt/bsd.${IPARCH} ]]; then
		mv /mnt/bsd.${IPARCH} /mnt/bsd
	fi
	if [[ -f /mnt/bsd.mp.${IPARCH} ]]; then
		mv /mnt/bsd.mp.${IPARCH} /mnt/bsd.mp
	fi
	if [[ -f /mnt/bsd.rd.${IPARCH} ]]; then
		mv /mnt/bsd.rd.${IPARCH} /mnt/bsd.rd
	fi
d65 1
a65 2
	echo
	echo "Checking SGI Volume Header:"
d75 1
a75 3
		ask "Do you want to overwrite the current header?" y
		case "$resp" in
		y*|Y*)
d77 1
a77 2
			;;
		n*|N*)
d86 2
a87 11
			ask "Are you sure you want to try to keep the old header?" y
			case "$resp" in
			y*|Y*)
				;;
			n*|N*)
				ask "Do you want to overwrite the old header instead?" n
				case "$resp" in
				y*|Y*)
					/usr/mdec/sgivol -qi $_disk
					;;
				n*|N*)
d89 3
a91 6
					;;
				esac
				;;
			esac
			;;
		esac
d93 1
a93 2
	1)	echo
		echo "Your disk seems to be unaccessible. It was not possible"
d95 1
a95 7
		ask "Do you want to continue anyway?" n
		case "$resp" in
		y*|Y*)
			;;
		n*|N*)
			return 1 ;;
		esac
d97 1
a97 2
	2)	echo
		echo "There is no Volume Header found on the disk. A Volume"
d99 2
a100 9
		ask "Do you want to install a Volume Header?" y
		case "$resp" in
		y*|Y*)
			/usr/mdec/sgivol -qi $_disk
			;;
		n*|N*)
			return 1
			;;
		esac
@


1.35
log
@Replace identical code in the MD scripts of the installer with a new
MI function disklabel_autolayout() which now handles all aspects of
the disklabel auto-layout and autopartitioning case for the root disk.
Remove get_disklabel_template() and merge it with the new function.

"move forward" deraadt@@
@
text
@d1 1
a1 1
#	$OpenBSD: install.md,v 1.34 2015/05/04 19:55:26 rpe Exp $
d166 1
a166 1
	disklabel -c $FSTABFLAG /tmp/fstab.$_disk -E $_disk
@


1.34
log
@Add the new template file based autopartitioning feature of disklabel(8)
to the OpenBSD installer. It is available during unattended installation.
The template file is fetched from an url, provided as answer to a new
question in the response file:

    URL to autopartitioning template for disklabel = url

Original diff from and OK henning@@
'no objection' krw@@
@
text
@d1 1
a1 1
#	$OpenBSD: install.md,v 1.33 2014/03/24 20:47:30 miod Exp $
d74 1
a74 1
	local _disk=$1 _f _op
d146 2
a147 21
	_f=/tmp/fstab.$_disk
	if [[ $_disk == $ROOTDISK ]]; then
		if $AUTO && get_disklabel_template; then
			disklabel -T /disklabel.auto $FSTABFLAG $_f -w -A $_disk && return
			echo "Autopartitioning failed"
			exit 1
		fi
		while :; do
			echo "The auto-allocated layout for $_disk is:"
			disklabel -h -A $_disk | egrep "^#  |^  [a-p]:"
			ask "Use (A)uto layout, (E)dit auto layout, or create (C)ustom layout?" a
			case $resp in
			a*|A*)	_op=-w ;;
			e*|E*)	_op=-E ;;
			c*|C*)	break ;;
			*)	continue ;;
			esac
			disklabel $FSTABFLAG $_f $_op -A $_disk
			return
		done
	fi
@


1.33
log
@Bail out from md_prep_disklabel() with `return', not `exit'.
@
text
@d1 1
a1 1
#	$OpenBSD: install.md,v 1.32 2013/11/16 18:37:27 rpe Exp $
d148 5
@


1.32
log
@Remove AUTOROOT variable which is a leftover of r1.183 of install.sub

diff from Philipp e1c1bac6253dc54a1e89ddc046585792 at osteo dot net

ok krw@@ halex@@
@
text
@d1 1
a1 1
#	$OpenBSD: install.md,v 1.31 2012/10/18 16:57:31 deraadt Exp $
d112 1
a112 1
					exit 1
d128 1
a128 1
			exit 1 ;;
d140 1
a140 1
			exit 1
@


1.31
log
@put fewer things in usr/mdec on the ramdisk filesystem, and use them
once baseXX has been installed in /mnt.  sgivol installs the bootblocks
much later now.
ok miod
@
text
@d1 1
a1 1
#	$OpenBSD: install.md,v 1.30 2012/07/10 14:25:00 halex Exp $
d153 1
a153 1
			a*|A*)	_op=-w ; AUTOROOT=y ;;
@


1.30
log
@since disklabel -W is no more, zap it from all the install.md's

ok krw@@
@
text
@d1 1
a1 1
#	$OpenBSD: install.md,v 1.29 2011/07/06 20:02:16 halex Exp $
d49 12
a142 10
		;;
	esac

	echo "Installing boot loader in volume header."
	/usr/mdec/sgivol -w boot /usr/mdec/boot-`sysctl -n hw.model` $_disk
	case $? in
	0)
		;;
	*)	echo
		echo "WARNING: Boot install failed. Booting from disk will not be possible"
@


1.29
log
@As non-mp install.md's neither set NCPU, nor will have a bsd.mp,
we could as well pull the 'mv bsd.mp bsd' and the associated checks
out of there.

ok deraadt@@ "makes sense" todd@@
@
text
@d1 1
a1 1
#	$OpenBSD: install.md,v 1.28 2011/06/07 09:38:59 jasper Exp $
a143 1
	disklabel -W $_disk >/dev/null 2>&1
@


1.28
log
@fix style nit
@
text
@d1 1
a1 1
#	$OpenBSD: install.md,v 1.27 2011/04/17 20:57:11 krw Exp $
a56 6
	fi

	if [[ -f /mnt/bsd.mp ]] && ((NCPU > 1)); then
		echo "Multiprocessor machine; using bsd.mp instead of bsd."
		mv /mnt/bsd /mnt/bsd.sp 2>/dev/null
		mv /mnt/bsd.mp /mnt/bsd
@


1.27
log
@First crack at enabling the installation of a DUID version of
/etc/fstab, after asking user. Current default is existing behaviour.

Feedback & suggestions deraadt@@, halex@@, jsing@@, todd@@.

ok deraadt@@
@
text
@d1 1
a1 1
#	$OpenBSD: install.md,v 1.26 2011/02/19 10:18:03 miod Exp $
d77 1
a77 1
A SGI Volume Header was found on the disk. Normally you want to replace it
@


1.26
log
@Fix previous ``fix'' - since the hw.model sysctl does not return a number
after all, we need to use a regular [[ ]] construct instead of (( )).
@
text
@d1 1
a1 1
#	$OpenBSD: install.md,v 1.25 2011/02/06 21:50:44 miod Exp $
d163 1
a163 1
			disklabel -f $_f $_op -A $_disk
d185 1
a185 1
	disklabel -c -f /tmp/fstab.$_disk -E $_disk
@


1.25
log
@Do 1.22 correctly, to let IP30 systems pick the mp kernel if applicable.
Noticed by jasper@@
@
text
@d1 1
a1 1
#	$OpenBSD: install.md,v 1.24 2011/01/03 00:36:50 deraadt Exp $
d42 1
a42 1
if ((NCPU > 1)) && ((IPARCH == IP30)); then
@


1.24
log
@reduce the amount of cd'ing in the install script, since it sucks
to change the environment that functions assume they run in.  use
sub-shells or absolute paths when possible.
ok krw
@
text
@d1 1
a1 1
#	$OpenBSD: install.md,v 1.23 2010/06/26 23:16:41 krw Exp $
d42 1
a42 1
if ((NCPU > 1)) && ((IPARCH == 30)); then
@


1.23
log
@Tighten up the congrats text. Too much info to summarize, simply encourage
the user to read INSTALL.$ARCH.

ok jsing@@
@
text
@d1 1
a1 1
#	$OpenBSD: install.md,v 1.22 2010/02/13 14:02:58 miod Exp $
d49 2
a50 3
	cd /mnt
	if [[ -f bsd.${IPARCH} ]]; then
		mv bsd.${IPARCH} bsd
d52 2
a53 2
	if [[ -f bsd.mp.${IPARCH} ]]; then
		mv bsd.mp.${IPARCH} bsd.mp
d55 2
a56 2
	if [[ -f bsd.rd.${IPARCH} ]]; then
		mv bsd.rd.${IPARCH} bsd.rd
d59 1
a59 1
	if [[ -f bsd.mp ]] && ((NCPU > 1)); then
d61 2
a62 2
		mv bsd bsd.sp 2>/dev/null
		mv bsd.mp bsd
@


1.22
log
@Only add bsd.mp to the sets on IP30 so far, as this causes `are you sure your
installation is complete without bsd.mp.IP27' on multiprocessor Origin systems.
This is temporary until we actually have a MP kernel for Origin.

Noticed by jasper@@
@
text
@d1 1
a1 1
#	$OpenBSD: install.md,v 1.21 2010/01/19 19:55:52 miod Exp $
d192 1
a192 7
Your machine is now set up to boot OpenBSD. Normally the ARCS PROM will
set up the system to boot from the first disk found with a valid Volume
Header. If the 'OSLoader' environment variable already is set to 'boot'
nothing in the firmware setup should need to be changed. To set up booting
refer to the install document.

To reboot the system, just enter 'reboot' at the shell prompt.
@


1.21
log
@Build GENERIC-IP30.MP as bsd.mp.IP30 in the distribution, and allow the
installer to pick it and install it as /bsd when applicable.
@
text
@d1 1
a1 1
#	$OpenBSD: install.md,v 1.20 2009/06/04 00:44:47 krw Exp $
d40 3
a42 1
if ((NCPU > 1)); then
@


1.20
log
@Nuke now superfluous ARCH=ARCH lines in install.md and the sed processing of
those lines in list2sh.awk.

ok deraadt@@
@
text
@d1 1
a1 1
#	$OpenBSD: install.md,v 1.19 2009/06/02 16:23:45 krw Exp $
d35 2
a36 1
IPARCH=`sysctl -n hw.model`
d39 5
a44 1
SANESETS="bsd.${IPARCH}"
d51 3
d56 6
@


1.19
log
@Add '-h' flag, and '*' as a unit specifier for 'p' Editor command.
Both cause partition sizes to be displayed using a human readable
format with the units automatically chosen by looking at the smallest
partition in the disk label. Remove forceable humanization in 'A'
code and use '-h' in install scripts.

Prodded & ok deraadt@@, verbiage tweaks from jmc@@
@
text
@d1 1
a1 1
#	$OpenBSD: install.md,v 1.18 2009/05/30 04:01:29 miod Exp $
a34 1
ARCH=ARCH
@


1.18
log
@Build IP27 and IP30 kernels on sgi; put then on the cdrom images too
(although for now our cd images fail to boot on IP27 and IP30).
@
text
@d1 1
a1 1
#	$OpenBSD: install.md,v 1.17 2009/05/18 20:57:27 miod Exp $
d141 1
a141 1
			disklabel -A $_disk | egrep "^#  |^  [a-p]:"
@


1.17
log
@Oops, want sysctl -n for proper operation.
@
text
@d1 1
a1 1
#	$OpenBSD: install.md,v 1.16 2009/05/14 18:58:17 miod Exp $
d36 5
d43 7
@


1.16
log
@Update to match the new bootblocks filenames.
@
text
@d1 1
a1 1
#	$OpenBSD: install.md,v 1.15 2009/04/12 12:56:02 krw Exp $
d115 1
a115 1
	/usr/mdec/sgivol -w boot /usr/mdec/boot-`sysctl hw.model` $_disk
@


1.15
log
@Tweak pattern used to select partition lines for display so the
'# /dev/r...' line is not selected.

Noticed by deraadt@@
@
text
@d1 1
a1 1
#	$OpenBSD: install.md,v 1.14 2009/04/12 01:35:01 krw Exp $
d115 1
a115 1
	/usr/mdec/sgivol -w boot /usr/mdec/boot $_disk
@


1.14
log
@No longer need '-f' or '-p' when displaying layout. A few patterns
missed the '# size offset ...' line at the top of the partition
list.
@
text
@d1 1
a1 1
#	$OpenBSD: install.md,v 1.13 2009/04/10 23:11:17 krw Exp $
d129 1
a129 1
			disklabel -A $_disk | egrep "^#|^  [a-p]:"
@


1.13
log
@Where appropriate display the auto-allocation layout of the root
disk and ask if the installee wants to use it, edit it, or create
their own custom disklabel. Most one-disk installs will not need
to see fdisk or disklabel.

i386 and macppc by me, adapted for others by deraadt@@.

ok deraadt@@
@
text
@d1 1
a1 1
#	$OpenBSD: install.md,v 1.12 2009/03/01 06:27:28 jsing Exp $
d129 1
a129 1
			disklabel -f $_f -p g -A $_disk | grep "^  [a-p]:"
@


1.12
log
@Sync disklabel instructions with reality and those detailed in INSTALL.sgi.

Issue spotted by matthieu@@.

ok miod@@ deraadt@@
@
text
@d1 1
a1 1
#	$OpenBSD: install.md,v 1.10 2008/03/22 23:28:10 krw Exp $
d42 1
a42 1
	local _disk
a43 1
	_disk=$1
d124 18
a158 1
	disklabel -W $_disk
@


1.11
log
@First pass at removing clauses 3 and 4 from NetBSD licenses.

Not sure what's more surprising: how long it took for NetBSD to
catch up to the rest of the BSDs (including UCB), or the amount of
code that NetBSD has claimed for itself without attributing to the
actual authors.

OK deraadt@@
@
text
@d127 11
a137 4
You will now create an OpenBSD disklabel. The default disklabel must have
an 'a' partition which is the space available for OpenBSD.
The 'i' partition must be retained since it contains the Volume Header and
the boot loader.
a139 3
Also, don't change the 'i' partition or start any other partition below the
end of the 'i' partition. This is the Volume Header and destroying it will
render the disk useless.
@


1.10
log
@No point in checking disklabel output for 'disk label corrupted' message
since it isn't emitted anymore.

ok deraadt@@
@
text
@d1 1
a1 1
#	$OpenBSD: install.md,v 1.9 2008/03/04 00:36:38 krw Exp $
a17 7
# 3. All advertising materials mentioning features or use of this software
#    must display the following acknowledgement:
#        This product includes software developed by the NetBSD
#        Foundation, Inc. and its contributors.
# 4. Neither the name of The NetBSD Foundation nor the names of its
#    contributors may be used to endorse or promote products derived
#    from this software without specific prior written permission.
@


1.9
log
@Redo serial console configuration logic. Smaller, easier to
understand.

Add serial console handling for alpha, macppc, zaurus.  No functional
change for i386/amd64.

All archs should now have automatic serial console configuration.

ok deraadt@@
@
text
@d1 1
a1 1
#	$OpenBSD: install.md,v 1.8 2008/02/18 16:08:26 jsing Exp $
a46 17
md_checkfordisklabel() {
	# $1 is the disk to check
	local rval

	disklabel $1 >/dev/null 2>/tmp/checkfordisklabel
	if grep "no disk label" /tmp/checkfordisklabel; then
		rval=1
	elif grep "disk label corrupted" /tmp/checkfordisklabel; then
		rval=2
	else
		rval=0
	fi

	rm -f /tmp/checkfordisklabel
	return $rval
}

a144 6
	md_checkfordisklabel $_disk
	case $? in
	2)	echo "WARNING: Label on disk $_disk is corrupted. You will be repairing it.\n"
		;;
	esac

@


1.8
log
@sgivol(8) no longer requires the '-f' option.
@
text
@d1 1
a1 1
#	$OpenBSD: install.md,v 1.7 2006/03/17 09:22:43 otto Exp $
d183 3
@


1.7
log
@Better (maybe even comprehensible) message about volume header and boot
loader. And fix a typo as well! Prompted by Jasper Lievisse Adriaanse.
ok miod@@
@
text
@d1 1
a1 1
#	$OpenBSD: install.md,v 1.6 2005/07/08 19:40:31 krw Exp $
d140 1
a140 1
	/usr/mdec/sgivol -wf boot /usr/mdec/boot $_disk
@


1.6
log
@Don't need to specify MDTERM=vt220. vt220 is the default value.

ok millert@@
@
text
@d1 1
a1 1
#	$OpenBSD: install.md,v 1.5 2005/04/02 14:34:46 krw Exp $
d151 4
a154 3
You will now create an OpenBSD disklabel. The default disklabel have an 'a'
partition which is the space available for OpenBSD. The 'i' partition must
be retained since it contains the Volume Header nad the boot.
@


1.5
log
@Scrounge a few more characters of whitespace, mostly to be consistant.
@
text
@d1 1
a1 1
#	$OpenBSD: install.md,v 1.4 2005/03/27 15:13:50 krw Exp $
a41 2
# Machine-dependent install sets
MDTERM=vt220
@


1.4
log
@Use new skeleton kbd(8) '-l' to generalize kbd(8) use.  Eliminate
fixed list of available maps and machine dependant md_set_term()
functions.

Any ramdisk with /sbin/kbd present (amd64, cats, i386 at the moment)
will now present list of available keyboard encodings.

ok deraadt@@
@
text
@d1 1
a1 1
#	$OpenBSD: install.md,v 1.3 2004/12/02 23:02:48 miod Exp $
d53 1
a53 1
	disklabel $1 > /dev/null 2> /tmp/checkfordisklabel
d73 1
a73 1
	/usr/mdec/sgivol -q $_disk > /dev/null 2> /dev/null
d76 1
a76 1
	cat << __EOT
d88 1
a88 1
			cat << __EOT
d151 1
a151 1
	cat << __EOT
d174 1
a174 1
	cat << __EOT
@


1.3
log
@No need to provide an MDSETS for sgi.
@
text
@d1 1
a1 1
#	$OpenBSD: install.md,v 1.2 2004/08/26 13:32:15 pefo Exp $
a45 3
md_set_term() {
}

a46 1
# Nothing to do. Boot is installed when preparing volume header.
@


1.2
log
@install for disk bootable system
@
text
@d1 1
a1 1
#	$OpenBSD: install.md,v 1.1 2004/08/06 22:33:27 deraadt Exp $
a42 1
MDSETS=kernel
@


1.1
log
@put ramdisk in right place
@
text
@d1 1
a1 1
#	$OpenBSD: install.md,v 1.17 2004/08/06 22:30:02 pefo Exp $
d51 1
a51 5
	echo "Installing boot TBD, only netboot for now"
	return
	echo "Installing boot on /dev/${1}a"
	cp /usr/mdec/boot /mnt/boot
	/usr/mdec/installboot /mnt/boot /usr/mdec/bootxx /dev/r${1}a
d76 3
a78 1
	md_checkfordisklabel $_disk
d80 39
a118 1
	0)	ask "Do you wish to edit the disklabel on $_disk?" y
d120 10
a129 2
	1)	echo "WARNING: Disk $_disk has no label"
		ask "Do you want to create one with the disklabel editor?" y
d131 12
a142 2
	2)	echo "WARNING: Label on disk $_disk is corrupted"
		ask "Do you want to try and repair the damage using the disklabel editor?" y
a143 1

d146 8
a153 3
	case "$resp" in
	y*|Y*)	;;
	*)	return ;;
a155 1
	# display example
d158 3
a160 4
Disk partition sizes and offsets are in sector (most likely 512 bytes) units.
You may set these size/offset pairs on cylinder boundaries
     (the number of sector per cylinder is given in )
     (the 'sectors/cylinder' entry, which is not shown here)
d163 3
a166 12
   [Here is an example of what the partition information may look like.]
10 partitions:
#        size   offset    fstype   [fsize bsize   cpg]
  a:   120832    10240    4.2BSD     1024  8192    16   # (Cyl.   11*- 142*)
  b:   131072   131072      swap                        # (Cyl.  142*- 284*)
  c:  6265200        0    unused     1024  8192         # (Cyl.    0 - 6809)
  e:   781250   262144    4.2BSD     1024  8192    16   # (Cyl.  284*- 1134*)
  f:  1205000  1043394    4.2BSD     1024  8192    16   # (Cyl. 1134*- 2443*)
  g:  2008403  2248394    4.2BSD     1024  8192    16   # (Cyl. 2443*- 4626*)
  h:  2008403  4256797    4.2BSD     1024  8192    16   # (Cyl. 4626*- 6809*)
  i:    10208       32     MSDOS                        # (Cyl.    0*- 11*)
[End of example]
d168 5
a172 1
	ask "Press [Enter] to continue"
d174 2
a175 5
	disklabel -W ${_disk}
	disklabel ${_disk} >/tmp/label.$$
	disklabel -r -R ${_disk} /tmp/label.$$
	rm -f /tmp/label.$$
	disklabel -f /tmp/fstab.${_disk} -E ${_disk}
d181 7
a187 2
Once the machine has rebooted use netbooting to boot into OpenBSD,
as described in the install document.
@

