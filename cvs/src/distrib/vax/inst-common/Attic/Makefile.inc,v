head	1.7;
access;
symbols
	OPENBSD_3_1:1.6.0.6
	OPENBSD_3_1_BASE:1.6
	OPENBSD_3_0:1.6.0.4
	OPENBSD_3_0_BASE:1.6
	OPENBSD_2_9:1.6.0.2
	OPENBSD_2_9_BASE:1.6
	OPENBSD_2_8:1.5.0.14
	OPENBSD_2_8_BASE:1.5
	OPENBSD_2_7:1.5.0.12
	OPENBSD_2_7_BASE:1.5
	OPENBSD_2_6:1.5.0.10
	OPENBSD_2_6_BASE:1.5
	OPENBSD_2_5:1.5.0.8
	OPENBSD_2_5_BASE:1.5
	OPENBSD_2_4:1.5.0.6
	OPENBSD_2_4_BASE:1.5
	OPENBSD_2_3:1.5.0.4
	OPENBSD_2_3_BASE:1.5
	OPENBSD_2_2:1.5.0.2
	OPENBSD_2_2_BASE:1.5
	OPENBSD_2_1:1.4.0.2
	OPENBSD_2_1_BASE:1.4
	OPENBSD_2_0:1.2.0.2
	OPENBSD_2_0_BASE:1.2
	netbsd_1_1:1.1.1.1;
locks; strict;
comment	@# @;


1.7
date	2002.04.25.22.10.28;	author deraadt;	state dead;
branches;
next	1.6;

1.6
date	2001.03.16.04.55.52;	author hugh;	state Exp;
branches;
next	1.5;

1.5
date	97.09.26.02.12.09;	author millert;	state Exp;
branches;
next	1.4;

1.4
date	97.05.14.18.39.08;	author niklas;	state Exp;
branches;
next	1.3;

1.3
date	96.12.22.01.52.52;	author deraadt;	state Exp;
branches;
next	1.2;

1.2
date	96.09.05.21.27.36;	author deraadt;	state Exp;
branches;
next	1.1;

1.1
date	95.10.18.08.37.54;	author deraadt;	state Exp;
branches
	1.1.1.1;
next	;

1.1.1.1
date	95.10.18.08.37.54;	author deraadt;	state Exp;
branches;
next	;


desc
@@


1.7
log
@runlist.sh & list2sh.awk unification
@
text
@#	$OpenBSD: Makefile.inc,v 1.6 2001/03/16 04:55:52 hugh Exp $

# TOP is assumed to be defined by Makefile including this one.

CBIN=		instbin
COMMONDIR=	${TOP}/inst-common

MOUNT_POINT?=	/mnt
VND?=		svnd0
VND_DEV=	/dev/${VND}a
VND_RDEV=	/dev/r${VND}a
IMAGE?=		miniroot-${REV}.fs
BOOTSYS=	bootroot-${REV}.fs
MDEC=		${DESTDIR}/usr/mdec

LISTS=		${COMMONDIR}/list ${.CURDIR}/list
CRUNCHCONF=	${COMMONDIR}/${CBIN}.conf
MTREE=		${COMMONDIR}/mtree.conf

all: ${CBIN} bootroot
	dd if=/dev/zero of=${IMAGE} bs=64k count=32
	vnconfig -v -c ${VND} ${IMAGE}
	disklabel -w ${VND} miniroot
	newfs -O -m 0 -o space -i 8192 ${VND_RDEV}
	mount ${VND_DEV} ${MOUNT_POINT}
	mtree -def ${MTREE} -p ${MOUNT_POINT}/ -u
	TOPDIR=${TOP} CURDIR=${.CURDIR} OBJDIR=${.OBJDIR} \
	    TARGDIR=${MOUNT_POINT} sh ${TOP}/runlist.sh ${LISTS}
	@@echo ""
	@@df -i ${MOUNT_POINT}
	@@echo ""
	umount -f ${MOUNT_POINT}
	vnconfig -u ${VND}

bootroot: xxboot boot
	dd if=/dev/zero of=${BOOTSYS} bs=512 count=8192
	vnconfig -v -c ${VND} ${BOOTSYS}
	disklabel -w ${VND} bootroot
	newfs -O -m 0 -o space -i 8192 ${VND_RDEV}
	dd if=xxboot of=${VND_RDEV} count=16
	mount ${VND_DEV} ${MOUNT_POINT}
	cp boot ${MOUNT_POINT}
	umount -f ${MOUNT_POINT}
	vnconfig -u ${VND}

xxboot boot:
	(cd /usr/src/sys/arch/vax/boot;make)
	cp /usr/src/sys/arch/vax/boot/xxboot/xxboot .
	cp /usr/src/sys/arch/vax/boot/boot/boot .


unconfig:
	-umount -f ${MOUNT_POINT}
	-vnconfig -u ${VND} ${IMAGE}
	-/bin/rm -f ${IMAGE}

${CBIN}.mk ${CBIN}.cache ${CBIN}.c: ${CRUNCHCONF}
	crunchgen -D ${TOP}/../../ -L ${DESTDIR}/usr/lib ${.ALLSRC}

${CBIN}: ${CBIN}.mk ${CBIN}.cache ${CBIN}.c
	make -f ${CBIN}.mk

clean cleandir:
	/bin/rm -f core ${IMAGE} ${CBIN} ${CBIN}.mk ${CBIN}.cache *.o *.lo *.c

.include <bsd.obj.mk>
.include <bsd.subdir.mk>
@


1.6
log
@More tree syncing.
@
text
@d1 1
a1 1
#	$OpenBSD: Makefile.inc,v 1.5 1997/09/26 02:12:09 millert Exp $
@


1.5
log
@Add a missing disklabel and fix newfs usage.
@
text
@d1 1
a1 1
#	$OpenBSD: Makefile.inc,v 1.4 1997/05/14 18:39:08 niklas Exp $
d35 2
a36 2
bootroot: edlabel copy xxboot boot
	dd if=/dev/zero of=${BOOTSYS} bs=64k count=4
d42 1
a42 1
	cp edlabel copy boot ${MOUNT_POINT}
d46 5
a50 6
edlabel copy xxboot boot:
	(cd /sys/arch/vax/boot;make)
	cp /sys/arch/vax/boot/edlabel .
	cp /sys/arch/vax/boot/copy .
	cp /sys/arch/vax/boot/xxboot .
	cp /sys/arch/vax/boot/boot .
d58 1
a58 1
	crunchgen ${CRUNCHCONF}
@


1.4
log
@Use svnds and remove ugly cache flushing
@
text
@d1 1
a1 1
#	$OpenBSD: Makefile.inc,v 1.3 1996/12/22 01:52:52 deraadt Exp $
d38 2
a39 1
	newfs -O -m 0 -o space -i 8192 ${VND_RDEV} bootroot
@


1.3
log
@disklabel the vnd
@
text
@d1 1
a1 1
#	$Id: Makefile.inc,v 1.2 1996/09/05 21:27:36 deraadt Exp $
d9 1
a9 1
VND?=		vnd0
@


1.2
log
@sync to netbsd
@
text
@d1 1
a1 1
#	$Id: Makefile.inc,v 1.1 1995/10/01 21:22:30 ragge Exp $
d10 2
a11 2
VND_DEV=	/dev/${VND}c
VND_RDEV=	/dev/r${VND}c
d22 3
a24 2
	vnconfig -v -c ${VND_DEV} ${IMAGE}
	newfs -O -m 0 -o space -i 8192 ${VND_RDEV} miniroot
d33 1
a33 1
	vnconfig -u ${VND_DEV}
d37 1
a37 1
	vnconfig -v -c ${VND_DEV} ${BOOTSYS}
d39 1
a39 1
	dd if=xxboot of=/dev/rvnd0a count=16
d43 1
a43 1
	vnconfig -u ${VND_DEV}
d54 1
a54 1
	-vnconfig -u ${VND_DEV} ${IMAGE}
@


1.1
log
@Initial revision
@
text
@@


1.1.1.1
log
@initial import of NetBSD tree
@
text
@@
