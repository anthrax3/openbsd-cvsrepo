head	1.7;
access;
symbols
	OPENBSD_2_7:1.5.0.8
	OPENBSD_2_7_BASE:1.5
	OPENBSD_2_6:1.5.0.6
	OPENBSD_2_6_BASE:1.5
	OPENBSD_2_5:1.5.0.4
	OPENBSD_2_5_BASE:1.5
	OPENBSD_2_4:1.5.0.2
	OPENBSD_2_4_BASE:1.5
	OPENBSD_2_3:1.4.0.8
	OPENBSD_2_3_BASE:1.4
	OPENBSD_2_2:1.4.0.6
	OPENBSD_2_2_BASE:1.4
	OPENBSD_2_1:1.4.0.4
	OPENBSD_2_1_BASE:1.4
	OPENBSD_2_0:1.4.0.2
	OPENBSD_2_0_BASE:1.4
	netbsd_1_1:1.1.1.1;
locks; strict;
comment	@# @;


1.7
date	2000.06.20.21.29.34;	author miod;	state dead;
branches;
next	1.6;

1.6
date	2000.06.06.20.47.51;	author miod;	state Exp;
branches;
next	1.5;

1.5
date	98.08.23.18.09.02;	author kstailey;	state Exp;
branches;
next	1.4;

1.4
date	96.09.05.21.27.31;	author deraadt;	state Exp;
branches;
next	1.3;

1.3
date	96.04.25.21.32.01;	author niklas;	state Exp;
branches;
next	1.2;

1.2
date	95.11.23.15.58.31;	author deraadt;	state Exp;
branches;
next	1.1;

1.1
date	95.10.18.08.37.51;	author deraadt;	state Exp;
branches
	1.1.1.1;
next	;

1.1.1.1
date	95.10.18.08.37.51;	author deraadt;	state Exp;
branches;
next	;


desc
@@


1.7
log
@Completely new ramdisk stuff, inspired by the existing sparc ramdisk.
@
text
@#	$OpenBSD: Makefile,v 1.6 2000/06/06 20:47:51 miod Exp $
#	$NetBSD: Makefile,v 1.1 1995/07/18 04:13:06 briggs Exp $

TOP=		${.CURDIR}/..

.include "${TOP}/Makefile.inc"
IMAGE=		ramdisk-${REV}.fs
CRUNCHCONF?=    ${.CURDIR}/${CBIN}.conf
BASE=		ramdisk

MOUNT_POINT=	/mnt

VND?=		svnd0
VND_DEV=	/dev/${VND}a
VND_RDEV=	/dev/r${VND}a
VND_CRDEV=	/dev/r${VND}c
PID!=		echo $$$$
REALIMAGE!=	echo /var/tmp/image.${PID}

GZIP?=		gzip
GZIPFLAGS?=	-9f

all: ${CBIN} ${IMAGE} bsd.rd
	@@echo "all done"

install: bsd.rd
	cp bsd.rd ${DESTDIR}/snapshot/bsd.rd
	cp ${.CURDIR}/../HP-IB.geometry ${DESTDIR}/snapshot

.include "Makefile.inc"

DISKTYPE=       rdroot
NBLKS=          4096
NEWFSARGS= -m 0 -o space -c 16 -i 3072

bsd.rd: ${IMAGE} bsd rdsetroot
	${.OBJDIR}/rdsetroot bsd < ${IMAGE}
	${GZIP} -c ${GZIPFLAGS} bsd > bsd.rd
	rm bsd

bsd:
	cd ${.CURDIR}/../../../sys/arch/sun3/conf && config RAMDISK
	cd ${.CURDIR}/../../../sys/arch/sun3/compile/RAMDISK && \
	    make clean && make depend && make
	cp ${.CURDIR}/../../../sys/arch/sun3/compile/RAMDISK/bsd bsd

${IMAGE}: ${CBIN} rd_setup do_files rd_teardown

rd_setup: ${CBIN}
	dd if=/dev/zero of=${REALIMAGE} bs=512 count=${NBLKS}
	vnconfig -v -c ${VND} ${REALIMAGE}
	disklabel -w ${VND} ${DISKTYPE}
	newfs ${NEWFSARGS} ${VND_RDEV}
	fsck ${VND_RDEV}
	mount ${VND_DEV} ${MOUNT_POINT}

rd_teardown:
	@@df -i ${MOUNT_POINT}
	-umount ${MOUNT_POINT}
	-vnconfig -u ${VND}
	cp ${REALIMAGE} ${IMAGE}
	rm ${REALIMAGE}

rdsetroot:	${TOP}/../common/rdsetroot.c
	${HOSTCC} -DDEBUG -o rdsetroot ${TOP}/../common/rdsetroot.c

unconfig:
	-umount -f ${MOUNT_POINT}
	-vnconfig -u ${VND}
	-/bin/rm -f ${IMAGE}

.PRECIOUS:	${IMAGE}
@


1.6
log
@Better create a sun3 kernel here
@
text
@d1 1
a1 1
#	$OpenBSD: Makefile,v 1.5 1998/08/23 18:09:02 kstailey Exp $
@


1.5
log
@update to be more like alpha, hp300, etc
@
text
@d1 1
a1 1
#	$OpenBSD$
d42 2
a43 2
	cd ${.CURDIR}/../../../sys/arch/hp300/conf && config RAMDISK
	cd ${.CURDIR}/../../../sys/arch/hp300/compile/RAMDISK && \
d45 1
a45 1
	cp ${.CURDIR}/../../../sys/arch/hp300/compile/RAMDISK/bsd bsd
@


1.4
log
@sync to netbsd
@
text
@d1 2
a2 1
#	$NetBSD: Makefile,v 1.3 1995/11/21 21:19:14 gwr Exp $
a5 1
# This include just sets REV=XX
d7 3
d11 1
a11 7
IMAGE=	ramdisk
CBIN=	rd_bin

TREE=	${TOP}/common/${IMAGE}.tree

LISTS=	${TOP}/common/${CBIN}.list \
	${TOP}/common/${IMAGE}.list
d13 43
a55 5
KERNEL=${SRCSYSDIR}/arch/sun3/compile/RAMDISK/netbsd

MOUNT_POINT=	/mnt
BDEV=		/dev/rd0
CDEV=		/dev/rd0
d57 1
a57 25
# These are all the parameters for the root fs: (256K)
DISKTYPE=	rdroot
NBLKS=		512
# old format, minfree, opt, b/i  trks, sects, cpg
NEWFSARGS= -O -m 0 -o space -i 2048 -t 2 -u 16 -c 16

CLEANFILES= netbsd-rd rdsetroot ${IMAGE}.fs

netbsd-rd : rdsetroot ${IMAGE}.fs
	cp ${KERNEL} netbsd-tmp
	./rdsetroot  netbsd-tmp < ${IMAGE}.fs
	-mv -f netbsd-tmp $@@

rdsetroot: ${TOP}/common/rdsetroot.c
	$(CC) -o $@@ -DDEBUG ${TOP}/common/rdsetroot.c

${IMAGE}.fs: ${TREE} ${LISTS} ${CBIN}
	-newfs ${NEWFSARGS} -s ${NBLKS} ${CDEV} ${DISKTYPE}
	mount ${BDEV} ${MOUNT_POINT}
	mtree -def ${TREE} -p ${MOUNT_POINT}/ -u
	TOPDIR=${TOP} CURDIR=${.CURDIR} \
	  OBJDIR=${.OBJDIR} TARGDIR=${MOUNT_POINT} \
	  sh ${TOP}/common/RunList.sh ${LISTS}
	sync
	@@echo ""
a58 1
	@@echo ""
d60 11
a70 18
	dd if=${CDEV} of=$@@ count=${NBLKS}

# Do not delete this if I change my mind and kill make...
.PRECIOUS: ${IMAGE}.fs

# Rules for making ${CBIN} ...
.include "${TOP}/common/Make.crunch"

# This is listed in rd_bin.conf but is built here.
${CBIN} : libhack.o

# Use stubs to eliminate some large stuff from libc
HACKSRC=${TOP}/../utils/libhack
.include "${HACKSRC}/Makefile.inc"

clean cleandir:
	-rm -f a.out core *.core *.o
	-rm -f ${CLEANFILES}
d72 1
a72 2
# Standard rules needed by the above...
.include <bsd.obj.mk>
@


1.3
log
@Did some s/NetBSD/OpenBSD/, s/netbsd/bsd/ and $OpenBSD$ additions.
However this stuff is largely related to NetBSD and must be completely
redone, if we will make real relases sometime
@
text
@a0 1
#	$OpenBSD$
d16 1
a16 1
KERNEL=${SRCSYSDIR}/arch/sun3/compile/RAMDISK/bsd
d28 1
a28 1
CLEANFILES= bsd-rd rdsetroot ${IMAGE}.fs
d30 4
a33 4
bsd-rd : rdsetroot ${IMAGE}.fs
	cp ${KERNEL} bsd-tmp
	./rdsetroot  bsd-tmp < ${IMAGE}.fs
	-mv -f bsd-tmp $@@
@


1.2
log
@update from netbsd
@
text
@d1 1
d17 1
a17 1
KERNEL=${SRCSYSDIR}/arch/sun3/compile/RAMDISK/netbsd
d29 1
a29 1
CLEANFILES= netbsd-rd rdsetroot ${IMAGE}.fs
d31 4
a34 4
netbsd-rd : rdsetroot ${IMAGE}.fs
	cp ${KERNEL} netbsd-tmp
	./rdsetroot  netbsd-tmp < ${IMAGE}.fs
	-mv -f netbsd-tmp $@@
@


1.1
log
@Initial revision
@
text
@d1 1
a1 1
#	$NetBSD: Makefile,v 1.2 1995/10/13 16:51:30 gwr Exp $
d16 2
a18 1
DISKTYPE=	rdroot
d20 1
a20 3
CDEV?=		/dev/rd0

KERNEL=${SRCSYSDIR}/arch/sun3/compile/RAMDISK/netbsd
d23 1
d25 1
a25 1
# args: old fmt, minfree, opt, b/i  trks, sects, cpg
d28 1
a28 1
CLEANFILES= netbsd-rd rdsetroot
d38 12
a49 1
${IMAGE}.fs: ${CBIN} do_mount do_files do_umount
a54 3
# Rules used making ${IMAGE}.fs (do_*)
.include "${TOP}/common/Make.fsimage"

d58 1
@


1.1.1.1
log
@initial import of NetBSD tree
@
text
@@
