head	1.5;
access;
symbols
	OPENBSD_2_3:1.4.0.8
	OPENBSD_2_3_BASE:1.4
	OPENBSD_2_2:1.4.0.6
	OPENBSD_2_2_BASE:1.4
	OPENBSD_2_1:1.4.0.4
	OPENBSD_2_1_BASE:1.4
	OPENBSD_2_0:1.4.0.2
	OPENBSD_2_0_BASE:1.4
	netbsd_1_1:1.1.1.1;
locks; strict;
comment	@# @;


1.5
date	98.08.23.18.09.00;	author kstailey;	state dead;
branches;
next	1.4;

1.4
date	96.09.05.21.27.30;	author deraadt;	state Exp;
branches;
next	1.3;

1.3
date	96.04.25.21.31.56;	author niklas;	state Exp;
branches;
next	1.2;

1.2
date	95.11.23.15.58.30;	author deraadt;	state Exp;
branches;
next	1.1;

1.1
date	95.10.18.08.37.51;	author deraadt;	state Exp;
branches
	1.1.1.1;
next	;

1.1.1.1
date	95.10.18.08.37.51;	author deraadt;	state Exp;
branches;
next	;


desc
@@


1.5
log
@update to be more like alpha, hp300, etc
@
text
@#	$NetBSD: Makefile,v 1.3.6.1 1996/08/29 03:24:24 gwr Exp $

TOP=		${.CURDIR}/..

# This include just sets REV=XX
.include "${TOP}/Makefile.inc"

IMAGE=	miniroot
CBIN=	mini_usr

TREE=	${TOP}/common/${IMAGE}.tree

LISTS=	${TOP}/common/mini_sbin.list \
	${TOP}/common/mini_bin.list \
	${TOP}/common/${CBIN}.list \
	${TOP}/common/mini_xx.list \
	${TOP}/common/${IMAGE}.list

KERNEL=${SRCSYSDIR}/arch/sun3/compile/GENERIC/netbsd

MOUNT_POINT=	/mnt
BDEV=		/dev/sd2b
CDEV=		/dev/rsd2b
#BDEV=		/dev/sd0d
#CDEV=		/dev/rsd0d

# These are all the parameters for the miniroot: (8MB)
DISKTYPE=	miniroot
NBLKS=		16384
# old format, minfree, opt, b/i  trks, sects, cpg
NEWFSARGS= -O -m 0 -o space -i 8192 -t 8 -u 32 -c 16

CLEANFILES= ${IMAGE}.gz install.sub

${IMAGE}.gz: ${TREE} ${LISTS} ${CBIN} mini_xx install.sub
	-newfs ${NEWFSARGS} -s ${NBLKS} ${CDEV} ${DISKTYPE}
	mount ${BDEV} ${MOUNT_POINT}
	mtree -def ${TREE} -p ${MOUNT_POINT}/ -u
	TOPDIR=${TOP} CURDIR=${.CURDIR} \
	  OBJDIR=${.OBJDIR} TARGDIR=${MOUNT_POINT} \
	  sh ${TOP}/common/RunList.sh ${LISTS}
	sync ; sleep 1 ; sync
	cd ${MOUNT_POINT} ;\
	  usr/mdec/installboot -v ufsboot usr/mdec/bootxx ${CDEV}
	cp ${KERNEL} ${MOUNT_POINT}/netbsd
	sync
	@@echo ""
	@@df -i ${MOUNT_POINT}
	@@echo ""
	-umount ${MOUNT_POINT}
	dd if=${CDEV} bs=16b count=`expr ${NBLKS} / 16` |\
	  gzip > ${IMAGE}.tmp
	-mv -f ${IMAGE}.tmp ${IMAGE}.gz

# Do not delete this if I change my mind and kill make...
.PRECIOUS: ${IMAGE}.gz

# Rules for making ${CBIN} ...
.include "${TOP}/common/Make.crunch"

install.sub : ${TOP}/../miniroot/install.sub
	sed -e "/^VERSION=/s/=.*/=${REV}/" < $? > $@@

clean cleandir: clean_xx
	-rm -f a.out core *.core *.o
	-rm -f ${CLEANFILES}

# Standard rules needed by the above...
.include <bsd.obj.mk>

# Hacks for re-linking some program -static
.include "${TOP}/common/mini_xx.mk"
@


1.4
log
@sync to netbsd
@
text
@@


1.3
log
@Did some s/NetBSD/OpenBSD/, s/netbsd/bsd/ and $OpenBSD$ additions.
However this stuff is largely related to NetBSD and must be completely
redone, if we will make real relases sometime
@
text
@d1 1
a1 2
#	$OpenBSD$
#	$NetBSD: Makefile,v 1.3 1995/11/21 21:19:12 gwr Exp $
d19 1
a19 1
KERNEL=${SRCSYSDIR}/arch/sun3/compile/GENERIC/bsd
d22 4
a25 4
#BDEV=		/dev/sd2b
#CDEV=		/dev/rsd2b
BDEV=		/dev/sd0d
CDEV=		/dev/rsd0d
d33 1
a33 1
CLEANFILES= ${IMAGE}.gz
d35 1
a35 1
${IMAGE}.gz: ${TREE} ${LISTS} ${CBIN} mini_xx
d45 1
a45 1
	cp ${KERNEL} ${MOUNT_POINT}/bsd
d60 3
@


1.2
log
@update from netbsd
@
text
@d1 1
d20 1
a20 1
KERNEL=${SRCSYSDIR}/arch/sun3/compile/GENERIC/netbsd
d46 1
a46 1
	cp ${KERNEL} ${MOUNT_POINT}/netbsd
@


1.1
log
@Initial revision
@
text
@d1 1
a1 1
#	$NetBSD: Makefile,v 1.2 1995/10/13 16:46:47 gwr Exp $
d16 1
d19 2
d22 6
d29 2
a30 8
BDEV=		/dev/sd2b
CDEV=		/dev/rsd2b

KERNEL=${SRCSYSDIR}/arch/sun3/compile/GENERIC/netbsd

# These are all the parameters for the miniroot: (6MB)
NBLKS=		12288
# old format, minfree, opt,  b/i  trks, sects, cpg
d33 1
a33 2
${IMAGE}.fs: ${CBIN} do_mount do_files do_bootxx do_kernel do_umount
	dd if=${CDEV} of=$@@ bs=64b count=`expr ${NBLKS} / 64`
d35 7
a41 2
# Only do these for the miniroot, not the ramdisk.
do_bootxx:
d45 9
a53 4

# Copy the generic kernel
do_kernel:
	cp -p ${KERNEL} ${MOUNT_POINT}/netbsd
d56 1
a56 4
.PRECIOUS: ${IMAGE}.fs

# Rules used making ${IMAGE}.fs (do_*)
.include "${TOP}/common/Make.fsimage"
d61 1
a61 1
clean cleandir:
d67 3
@


1.1.1.1
log
@initial import of NetBSD tree
@
text
@@
