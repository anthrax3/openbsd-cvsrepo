head	1.24;
access;
symbols
	OPENBSD_6_1_BASE:1.24
	OPENBSD_6_0:1.22.0.6
	OPENBSD_6_0_BASE:1.22
	OPENBSD_5_9:1.22.0.2
	OPENBSD_5_9_BASE:1.22
	OPENBSD_5_8:1.21.0.2
	OPENBSD_5_8_BASE:1.21
	OPENBSD_5_7:1.21.0.8
	OPENBSD_5_7_BASE:1.21
	OPENBSD_5_6:1.21.0.6
	OPENBSD_5_6_BASE:1.21
	OPENBSD_5_5:1.21.0.4
	OPENBSD_5_5_BASE:1.21
	OPENBSD_5_4:1.17.0.12
	OPENBSD_5_4_BASE:1.17
	OPENBSD_5_3:1.17.0.10
	OPENBSD_5_3_BASE:1.17
	OPENBSD_5_2:1.17.0.8
	OPENBSD_5_2_BASE:1.17
	OPENBSD_5_1_BASE:1.17
	OPENBSD_5_1:1.17.0.6
	OPENBSD_5_0:1.17.0.4
	OPENBSD_5_0_BASE:1.17
	OPENBSD_4_9:1.17.0.2
	OPENBSD_4_9_BASE:1.17
	OPENBSD_4_8:1.15.0.22
	OPENBSD_4_8_BASE:1.15
	OPENBSD_4_7:1.15.0.18
	OPENBSD_4_7_BASE:1.15
	OPENBSD_4_6:1.15.0.20
	OPENBSD_4_6_BASE:1.15
	OPENBSD_4_5:1.15.0.16
	OPENBSD_4_5_BASE:1.15
	OPENBSD_4_4:1.15.0.14
	OPENBSD_4_4_BASE:1.15
	OPENBSD_4_3:1.15.0.12
	OPENBSD_4_3_BASE:1.15
	OPENBSD_4_2:1.15.0.10
	OPENBSD_4_2_BASE:1.15
	OPENBSD_4_1:1.15.0.8
	OPENBSD_4_1_BASE:1.15
	OPENBSD_4_0:1.15.0.6
	OPENBSD_4_0_BASE:1.15
	OPENBSD_3_9:1.15.0.4
	OPENBSD_3_9_BASE:1.15
	OPENBSD_3_8:1.15.0.2
	OPENBSD_3_8_BASE:1.15
	OPENBSD_3_7:1.14.0.6
	OPENBSD_3_7_BASE:1.14
	OPENBSD_3_6:1.14.0.4
	OPENBSD_3_6_BASE:1.14
	OPENBSD_3_5:1.14.0.2
	OPENBSD_3_5_BASE:1.14
	OPENBSD_3_4:1.13.0.2
	OPENBSD_3_4_BASE:1.13
	OPENBSD_3_3:1.9.0.4
	OPENBSD_3_3_BASE:1.9
	OPENBSD_3_2:1.9.0.2
	OPENBSD_3_2_BASE:1.9
	OPENBSD_3_1:1.7.0.16
	OPENBSD_3_1_BASE:1.7
	OPENBSD_3_0:1.7.0.14
	OPENBSD_3_0_BASE:1.7
	OPENBSD_2_9:1.7.0.12
	OPENBSD_2_9_BASE:1.7
	OPENBSD_2_8:1.7.0.10
	OPENBSD_2_8_BASE:1.7
	OPENBSD_2_7:1.7.0.8
	OPENBSD_2_7_BASE:1.7
	OPENBSD_2_6:1.7.0.6
	OPENBSD_2_6_BASE:1.7
	OPENBSD_2_5:1.7.0.4
	OPENBSD_2_5_BASE:1.7
	OPENBSD_2_4:1.7.0.2
	OPENBSD_2_4_BASE:1.7
	OPENBSD_2_3:1.6.0.6
	OPENBSD_2_3_BASE:1.6
	OPENBSD_2_2:1.6.0.4
	OPENBSD_2_2_BASE:1.6
	OPENBSD_2_1:1.6.0.2
	OPENBSD_2_1_BASE:1.6
	OPENBSD_2_0:1.3.0.2
	OPENBSD_2_0_BASE:1.3;
locks; strict;
comment	@# @;


1.24
date	2017.03.11.04.09.32;	author deraadt;	state Exp;
branches;
next	1.23;
commitid	9Sjx6mBRwfYXBHQm;

1.23
date	2016.12.30.22.28.34;	author deraadt;	state Exp;
branches;
next	1.22;
commitid	ZS4bEPoRtWFJBm0a;

1.22
date	2015.11.14.23.44.26;	author deraadt;	state Exp;
branches;
next	1.21;
commitid	nupLPkEL3DN0OFzt;

1.21
date	2014.02.21.19.14.23;	author deraadt;	state Exp;
branches;
next	1.20;

1.20
date	2014.02.21.16.30.14;	author deraadt;	state Exp;
branches;
next	1.19;

1.19
date	2014.02.21.16.29.08;	author deraadt;	state Exp;
branches;
next	1.18;

1.18
date	2013.10.13.23.38.30;	author guenther;	state Exp;
branches;
next	1.17;

1.17
date	2010.10.17.21.33.53;	author deraadt;	state Exp;
branches;
next	1.16;

1.16
date	2010.10.15.10.18.42;	author jsg;	state Exp;
branches;
next	1.15;

1.15
date	2005.08.04.16.35.03;	author espie;	state Exp;
branches;
next	1.14;

1.14
date	2003.12.16.22.41.40;	author henning;	state Exp;
branches;
next	1.13;

1.13
date	2003.06.22.22.25.48;	author deraadt;	state Exp;
branches;
next	1.12;

1.12
date	2003.05.18.07.18.27;	author mho;	state Exp;
branches;
next	1.11;

1.11
date	2003.05.06.00.23.02;	author millert;	state Exp;
branches;
next	1.10;

1.10
date	2003.04.17.23.02.42;	author deraadt;	state Exp;
branches;
next	1.9;

1.9
date	2002.05.24.13.19.48;	author markus;	state Exp;
branches;
next	1.8;

1.8
date	2002.04.30.03.23.44;	author deraadt;	state Exp;
branches;
next	1.7;

1.7
date	98.08.14.15.30.25;	author millert;	state Exp;
branches;
next	1.6;

1.6
date	97.05.15.00.11.13;	author deraadt;	state Exp;
branches;
next	1.5;

1.5
date	97.05.01.00.33.11;	author deraadt;	state Exp;
branches;
next	1.4;

1.4
date	97.04.30.18.52.48;	author niklas;	state Exp;
branches;
next	1.3;

1.3
date	96.10.08.07.03.50;	author deraadt;	state Exp;
branches;
next	1.2;

1.2
date	96.09.05.21.26.42;	author deraadt;	state Exp;
branches;
next	1.1;

1.1
date	95.12.26.18.35.43;	author deraadt;	state Exp;
branches;
next	;


desc
@@


1.24
log
@link libraries in a more canonical form (libc at the end)
@
text
@#	$OpenBSD: makeconf.awk,v 1.23 2016/12/30 22:28:34 deraadt Exp $

#
# generate crunchgen(1) configuration file from `list' spec.
#

BEGIN {
	printf("#\n# This file is automatically generated by `makeconf'\n#\n\n");
	libs = "libs -lstubs -lutil -lm -ltls -lssl -lcrypto -lc";
}

$1 == "LIBS" {
	$1 = tolower($1);
	libs = $0;
}

$1 == "SRCDIRS" {
	$1 = tolower($1);
	print;
}

($1 == "LINK" || $1 == "SYMLINK") && index($2,CBIN) {
	# find basenames for inclusion in crunchgen's `prog' and `ln' directives
	n = split($3, x, "/");
	p = x[n];
	progs[p] = NF - 3;
	for (i = 4; i <= NF; i++) {
		n = split($i, x, "/");
		l = x[n];
		links[i - 3, p] = l;
	}
}

$1 == "ARGVLINK" {
	# add extra `ln' entries (these don't appear in the filesystem)
	n = progs[$2];
	progs[$2] = ++n;
	links[n, $2] = $3;
}

$1 == "CRUNCHSPECIAL" {
	# collect crunchgen `special' directives
	$1 = "";
	specials[$0] = 1;
}

END {
	# write crunchgen configuration

	# `prog' directives; print 8 to a line
	column = 0;
	for (p in progs) {
		if ((column++ % 8) == 0)
			printf("\nprogs");
		printf(" %s", p);
	}
	printf("\n\n");

	# `ln' directives
	for (p in progs) {
		n = progs[p];
		for (i = 1; i <= n; i++)
			printf("ln %s %s\n", p, links[i,p]);
	}
	printf("\n%s\n\n", libs);
	printf("libdirs distrib/special/libstubs\n");

	# `special' directives
	for (s in specials) {
		printf("special %s\n", s);
	}
}
@


1.23
log
@Also link with -ltls -lssl -lcrypto, in case the instbin binary contains
calls to those libraries.
@
text
@d1 1
a1 1
#	$OpenBSD: makeconf.awk,v 1.22 2015/11/14 23:44:26 deraadt Exp $
d9 1
a9 1
	libs = "libs -lstubs -lutil -lm -lc -ltls -lssl -lcrypto";
@


1.22
log
@no longer need -locurses, since more is selfcontained
@
text
@d1 1
a1 1
#	$OpenBSD: makeconf.awk,v 1.21 2014/02/21 19:14:23 deraadt Exp $
d9 1
a9 1
	libs = "libs -lstubs -lutil -lm -lc";
@


1.21
log
@remove irksome useless comments
@
text
@d1 1
a1 1
#	$OpenBSD: makeconf.awk,v 1.19 2014/02/21 16:29:08 deraadt Exp $
d9 1
a9 1
	libs = "libs -lstubs -lutil -locurses -lm -lc";
@


1.20
log
@oops, seperate pieces coming...
@
text
@d1 1
a1 2
#	$OpenBSD: makeconf.awk,v 1.18 2013/10/13 23:38:30 guenther Exp $
#	$NetBSD: makeconf.awk,v 1.3 1996/05/04 15:45:32 pk Exp $
@


1.19
log
@services
@
text
@d2 1
@


1.18
log
@libotermcap is just an alias/link to libocurses.  Use the latter so that
the library name matches the name of its src directory.  Also, include -lc
here so that the crunchgen knows to build a distrib libc.a for these
@
text
@d1 1
a1 2
#	$OpenBSD: makeconf.awk,v 1.17 2010/10/17 21:33:53 deraadt Exp $
#	$NetBSD: makeconf.awk,v 1.3 1996/05/04 15:45:32 pk Exp $
@


1.17
log
@there is no need for -ll at link time
@
text
@d1 1
a1 1
#	$OpenBSD: makeconf.awk,v 1.16 2010/10/15 10:18:42 jsg Exp $
d10 1
a10 1
	libs = "libs -lstubs -lutil -lotermcap -lm";
@


1.16
log
@Switch the remaining users of libdes in src to libcrypto,
telnet portion partially from the latest heimdal.

ok mikeb@@
@
text
@d1 1
a1 1
#	$OpenBSD: makeconf.awk,v 1.15 2005/08/04 16:35:03 espie Exp $
d10 1
a10 1
	libs = "libs -lstubs -lutil -lotermcap -ll -lm";
@


1.15
log
@activate libstubs (setlocale + dbopen)

okay deraadt@@
@
text
@d1 1
a1 1
#	$OpenBSD: makeconf.awk,v 1.14 2003/12/16 22:41:40 henning Exp $
d10 1
a10 1
	libs = "libs -lstubs -lutil -lotermcap -ll -lm -ldes";
@


1.14
log
@no more libz
@
text
@d1 1
a1 1
#	$OpenBSD: makeconf.awk,v 1.13 2003/06/22 22:25:48 deraadt Exp $
d10 1
a10 1
	libs = "libs -lutil -lotermcap -ll -lm -ldes";
d67 1
@


1.13
log
@need -lz now
@
text
@d1 1
a1 1
#	$OpenBSD: makeconf.awk,v 1.12 2003/05/18 07:18:27 mho Exp $
d10 1
a10 1
	libs = "libs -lutil -lotermcap -ll -lm -ldes -lz";
@


1.12
log
@Don't link with -lkrb.; Found by mickey@@, ok todd@@
@
text
@d1 1
a1 1
#	$OpenBSD: makeconf.awk,v 1.11 2003/05/06 00:23:02 millert Exp $
d10 1
a10 1
	libs = "libs -lutil -lotermcap -ll -lm -ldes";
@


1.11
log
@more(1) now uses POSIX regex, no more ned for -lcompat; deraadt@@ OK
@
text
@d1 1
a1 1
#	$OpenBSD: makeconf.awk,v 1.10 2003/04/17 23:02:42 deraadt Exp $
d10 1
a10 1
	libs = "libs -lutil -lotermcap -ll -lm -lkrb -ldes";
@


1.10
log
@-lcompat too
@
text
@d1 1
a1 1
#	$OpenBSD: makeconf.awk,v 1.9 2002/05/24 13:19:48 markus Exp $
d10 1
a10 1
	libs = "libs -lutil -lotermcap -ll -lm -lkrb -ldes -lcompat";
@


1.9
log
@add LIBS option the crunchgen config, allows adding custom libraries
in list.local (e.g. for adding ssh to the ramdisk); ok deraadt@@
@
text
@d1 1
a1 1
#	$OpenBSD: makeconf.awk,v 1.8 2002/04/30 03:23:44 deraadt Exp $
d10 1
a10 1
	libs = "libs -lutil -lotermcap -ll -lm -lkrb -ldes";
@


1.8
log
@use leaner libraries; like most already did
@
text
@d1 1
a1 1
#	$OpenBSD: makeconf.awk,v 1.7 1998/08/14 15:30:25 millert Exp $
d10 2
a11 1
	printf("\nlibs -lutil -lotermcap -ll -lm -lkrb -ldes\n");
d13 3
d66 1
a66 1
	printf("\n\n");
@


1.7
log
@Don't need to explicately link in with -ltermlib now that curses and termlib are merged
@
text
@d1 1
a1 1
#	$OpenBSD: makeconf.awk,v 1.6 1997/05/15 00:11:13 deraadt Exp $
d10 1
a10 1
	printf("\nlibs -ledit -lutil -lcurses -ll -lm -lkvm -lz -lkrb -ldes\n");
@


1.6
log
@fit vi onto sparc ramdisk
@
text
@d1 1
a1 1
#	$OpenBSD: makeconf.awk,v 1.5 1997/05/01 00:33:11 deraadt Exp $
d10 1
a10 1
	printf("\nlibs -ledit -lutil -lcurses -ltermlib -ll -lm -lkvm -lz -lkrb -ldes\n");
@


1.5
log
@-lcrypt rots
@
text
@d1 1
a1 1
#	$OpenBSD: makeconf.awk,v 1.4 1997/04/30 18:52:48 niklas Exp $
d10 1
a10 1
	printf("\nlibs -ledit -lutil -lcurses -ltermcap -ll -lm -lkvm -lz -lkrb -ldes\n");
@


1.4
log
@We run OpenBSD. we also want vim acting as vi.
@
text
@d1 1
a1 1
#	$OpenBSD: makeconf.awk,v 1.3 1996/05/04 15:45:32 pk Exp $
d10 1
a10 1
	printf("\nlibs -ledit -lutil -lcurses -ltermcap -lcrypt -ll -lm -lkvm -lz -lkrb -ldes\n");
@


1.3
log
@krb/des/z
@
text
@d1 1
@


1.2
log
@sync to netbsd
@
text
@d9 1
a9 1
	printf("\nlibs -ledit -lutil -lcurses -ltermcap -lcrypt -ll -lm -lkvm\n");
@


1.1
log
@update from netbsd
@
text
@d1 5
a5 1
#	$NetBSD: makeconf.awk,v 1.2 1995/12/19 00:54:08 pk Exp $
d8 8
a15 20
	# a list of `aliases'
	links["[",0] = "test";
	links["awk",0] = "gawk";
	links["chgrp",0] = "chown";
	links["egrep",0] = "grep";
	links["fgrep",0] = "grep";
	links["gzcat",0] = "gzip";
	links["gunzip",0] = "gzip";
	links["halt",0] = "reboot";
	links["reset",0] = "tset";
	links["rrestore",0] = "restore";
	links["sum",0] = "cksum";
	links["uncompress",0] = "compress";
	links["vi",0] = "common";	# XXX catch vi
	links["zcat",0] = "compress";

	argvlinks["mount_ffs"] = "ffs";	# mount invokes mount_* this way
	argvlinks["mount_nfs"] = "nfs";
	argvlinks["mount_cd9660"] = "cd9660";
	argvlinks["sh"] = "-sh";	# init invokes the shell this way
d19 1
d22 5
a26 3
	if ((p,0) in links) {
		links[p,1] = links[p,0];
		p = links[p,0];
d28 13
a40 3
	progs[p] = 1;
	if (argvlinks[p])
		links[argvlinks[p],1] = p;
d46 2
a47 4
	printf("#\n# This file is automatically generated by `makeconf'\n#\n");
	printf("srcdirs bin sbin usr.bin usr.sbin gnu/usr.bin usr.bin/vi\n");

	i = 0;
d49 1
a49 1
		if ((i++ % 8) == 0)
d55 5
a59 4
	for (I in links) {
		split(I, l, SUBSEP);
		if (l[2])
			printf("ln %s %s\n", links[l[1],1], l[1]);
d61 1
d63 4
a66 1
	printf("\nlibs -ledit -lutil -lcurses -ltermcap -lcrypt -ll -lm -lkvm\n");
@
