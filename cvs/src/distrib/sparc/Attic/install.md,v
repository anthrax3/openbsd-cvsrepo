head	1.75;
access;
symbols
	OPENBSD_6_0:1.74.0.4
	OPENBSD_6_0_BASE:1.74
	OPENBSD_5_9:1.74.0.2
	OPENBSD_5_9_BASE:1.74
	OPENBSD_5_8:1.73.0.4
	OPENBSD_5_8_BASE:1.73
	OPENBSD_5_7:1.69.0.4
	OPENBSD_5_7_BASE:1.69
	OPENBSD_5_6:1.69.0.6
	OPENBSD_5_6_BASE:1.69
	OPENBSD_5_5:1.69.0.2
	OPENBSD_5_5_BASE:1.69
	OPENBSD_5_4:1.68.0.4
	OPENBSD_5_4_BASE:1.68
	OPENBSD_5_3:1.68.0.2
	OPENBSD_5_3_BASE:1.68
	OPENBSD_5_2:1.67.0.2
	OPENBSD_5_2_BASE:1.67
	OPENBSD_5_1_BASE:1.65
	OPENBSD_5_1:1.65.0.4
	OPENBSD_5_0:1.65.0.2
	OPENBSD_5_0_BASE:1.65
	OPENBSD_4_9:1.64.0.8
	OPENBSD_4_9_BASE:1.64
	OPENBSD_4_8:1.64.0.6
	OPENBSD_4_8_BASE:1.64
	OPENBSD_4_7:1.64.0.2
	OPENBSD_4_7_BASE:1.64
	OPENBSD_4_6:1.64.0.4
	OPENBSD_4_6_BASE:1.64
	OPENBSD_4_5:1.55.0.4
	OPENBSD_4_5_BASE:1.55
	OPENBSD_4_4:1.55.0.2
	OPENBSD_4_4_BASE:1.55
	OPENBSD_4_3:1.53.0.2
	OPENBSD_4_3_BASE:1.53
	OPENBSD_4_2:1.52.0.10
	OPENBSD_4_2_BASE:1.52
	OPENBSD_4_1:1.52.0.8
	OPENBSD_4_1_BASE:1.52
	OPENBSD_4_0:1.52.0.6
	OPENBSD_4_0_BASE:1.52
	OPENBSD_3_9:1.52.0.4
	OPENBSD_3_9_BASE:1.52
	OPENBSD_3_8:1.52.0.2
	OPENBSD_3_8_BASE:1.52
	OPENBSD_3_7:1.50.0.6
	OPENBSD_3_7_BASE:1.50
	OPENBSD_3_6:1.50.0.4
	OPENBSD_3_6_BASE:1.50
	OPENBSD_3_5:1.50.0.2
	OPENBSD_3_5_BASE:1.50
	OPENBSD_3_4:1.47.0.4
	OPENBSD_3_4_BASE:1.47
	OPENBSD_3_3:1.47.0.2
	OPENBSD_3_3_BASE:1.47
	OPENBSD_3_2:1.46.0.2
	OPENBSD_3_2_BASE:1.46
	OPENBSD_3_1:1.37.0.2
	OPENBSD_3_1_BASE:1.37
	OPENBSD_3_0:1.34.0.2
	OPENBSD_3_0_BASE:1.34
	OPENBSD_2_9:1.33.0.2
	OPENBSD_2_9_BASE:1.33
	OPENBSD_2_8:1.32.0.4
	OPENBSD_2_8_BASE:1.32
	OPENBSD_2_7:1.32.0.2
	OPENBSD_2_7_BASE:1.32
	OPENBSD_2_6:1.30.0.2
	OPENBSD_2_6_BASE:1.30
	OPENBSD_2_5:1.27.0.2
	OPENBSD_2_5_BASE:1.27
	OPENBSD_2_4:1.22.0.2
	OPENBSD_2_4_BASE:1.22
	OPENBSD_2_3:1.18.0.2
	OPENBSD_2_3_BASE:1.18
	OPENBSD_2_2:1.16.0.2
	OPENBSD_2_2_BASE:1.16
	OPENBSD_2_1:1.12.0.2
	OPENBSD_2_1_BASE:1.12
	OPENBSD_2_0:1.3.0.2
	OPENBSD_2_0_BASE:1.3;
locks; strict;
comment	@# @;


1.75
date	2016.09.01.10.08.29;	author deraadt;	state dead;
branches;
next	1.74;
commitid	qVq42rwKOPg5Qxjs;

1.74
date	2016.02.08.17.28.09;	author krw;	state Exp;
branches;
next	1.73;
commitid	4nj4L34RoKX0PFN0;

1.73
date	2015.06.02.19.54.07;	author rpe;	state Exp;
branches;
next	1.72;
commitid	zUqrjWrWSBxkCmbI;

1.72
date	2015.05.31.19.40.10;	author rpe;	state Exp;
branches;
next	1.71;
commitid	p6r5f9n0C0WoWNND;

1.71
date	2015.05.04.19.55.27;	author rpe;	state Exp;
branches;
next	1.70;
commitid	NyWrBKI5Tnb4FUEi;

1.70
date	2015.03.11.15.21.50;	author deraadt;	state Exp;
branches;
next	1.69;
commitid	2rIXvyGRVYSUIZRo;

1.69
date	2013.11.16.18.37.27;	author rpe;	state Exp;
branches;
next	1.68;

1.68
date	2012.10.17.02.06.39;	author deraadt;	state Exp;
branches;
next	1.67;

1.67
date	2012.07.13.14.50.34;	author halex;	state Exp;
branches;
next	1.66;

1.66
date	2012.07.10.14.25.00;	author halex;	state Exp;
branches;
next	1.65;

1.65
date	2011.04.17.20.57.11;	author krw;	state Exp;
branches;
next	1.64;

1.64
date	2009.06.04.00.44.47;	author krw;	state Exp;
branches;
next	1.63;

1.63
date	2009.06.02.16.23.45;	author krw;	state Exp;
branches;
next	1.62;

1.62
date	2009.05.31.17.49.53;	author deraadt;	state Exp;
branches;
next	1.61;

1.61
date	2009.05.11.17.13.07;	author deraadt;	state Exp;
branches;
next	1.60;

1.60
date	2009.05.09.21.37.26;	author deraadt;	state Exp;
branches;
next	1.59;

1.59
date	2009.04.25.03.21.51;	author deraadt;	state Exp;
branches;
next	1.58;

1.58
date	2009.04.12.12.56.02;	author krw;	state Exp;
branches;
next	1.57;

1.57
date	2009.04.12.01.35.01;	author krw;	state Exp;
branches;
next	1.56;

1.56
date	2009.04.10.23.11.17;	author krw;	state Exp;
branches;
next	1.55;

1.55
date	2008.06.26.05.42.04;	author ray;	state Exp;
branches;
next	1.54;

1.54
date	2008.03.22.23.28.10;	author krw;	state Exp;
branches;
next	1.53;

1.53
date	2008.03.04.00.36.38;	author krw;	state Exp;
branches;
next	1.52;

1.52
date	2005.04.03.19.33.59;	author krw;	state Exp;
branches;
next	1.51;

1.51
date	2005.03.27.15.13.50;	author krw;	state Exp;
branches;
next	1.50;

1.50
date	2003.10.12.13.18.37;	author krw;	state Exp;
branches;
next	1.49;

1.49
date	2003.09.21.02.11.42;	author krw;	state Exp;
branches;
next	1.48;

1.48
date	2003.09.19.01.05.34;	author krw;	state Exp;
branches;
next	1.47;

1.47
date	2002.11.07.01.28.52;	author krw;	state Exp;
branches;
next	1.46;

1.46
date	2002.09.24.23.45.05;	author deraadt;	state Exp;
branches;
next	1.45;

1.45
date	2002.08.27.02.18.34;	author krw;	state Exp;
branches;
next	1.44;

1.44
date	2002.05.22.01.48.38;	author krw;	state Exp;
branches;
next	1.43;

1.43
date	2002.05.20.16.53.57;	author krw;	state Exp;
branches;
next	1.42;

1.42
date	2002.05.18.17.56.03;	author krw;	state Exp;
branches;
next	1.41;

1.41
date	2002.05.14.01.49.25;	author krw;	state Exp;
branches;
next	1.40;

1.40
date	2002.05.09.21.54.46;	author krw;	state Exp;
branches;
next	1.39;

1.39
date	2002.05.08.23.01.47;	author krw;	state Exp;
branches;
next	1.38;

1.38
date	2002.05.07.02.03.57;	author krw;	state Exp;
branches;
next	1.37;

1.37
date	2002.03.31.17.30.31;	author deraadt;	state Exp;
branches;
next	1.36;

1.36
date	2002.02.14.03.34.15;	author deraadt;	state Exp;
branches;
next	1.35;

1.35
date	2001.12.23.01.51.52;	author krw;	state Exp;
branches;
next	1.34;

1.34
date	2001.06.23.19.44.57;	author deraadt;	state Exp;
branches;
next	1.33;

1.33
date	2001.01.25.19.18.42;	author deraadt;	state Exp;
branches;
next	1.32;

1.32
date	2000.04.24.16.33.44;	author millert;	state Exp;
branches;
next	1.31;

1.31
date	2000.03.11.02.29.03;	author deraadt;	state Exp;
branches;
next	1.30;

1.30
date	99.10.13.02.47.42;	author jason;	state Exp;
branches;
next	1.29;

1.29
date	99.09.03.18.55.36;	author deraadt;	state Exp;
branches;
next	1.28;

1.28
date	99.08.15.10.05.05;	author millert;	state Exp;
branches;
next	1.27;

1.27
date	99.04.02.05.17.37;	author millert;	state Exp;
branches;
next	1.26;

1.26
date	99.04.02.01.08.16;	author millert;	state Exp;
branches;
next	1.25;

1.25
date	99.04.01.21.30.51;	author deraadt;	state Exp;
branches;
next	1.24;

1.24
date	98.11.03.04.10.16;	author aaron;	state Exp;
branches;
next	1.23;

1.23
date	98.10.28.17.53.29;	author millert;	state Exp;
branches;
next	1.22;

1.22
date	98.10.09.11.21.03;	author deraadt;	state Exp;
branches;
next	1.21;

1.21
date	98.09.11.22.55.45;	author millert;	state Exp;
branches;
next	1.20;

1.20
date	98.07.20.08.02.56;	author todd;	state Exp;
branches;
next	1.19;

1.19
date	98.07.16.22.27.46;	author deraadt;	state Exp;
branches;
next	1.18;

1.18
date	98.03.27.23.28.17;	author deraadt;	state Exp;
branches;
next	1.17;

1.17
date	98.03.12.08.48.54;	author deraadt;	state Exp;
branches;
next	1.16;

1.16
date	97.10.27.04.59.11;	author todd;	state Exp;
branches;
next	1.15;

1.15
date	97.10.25.09.44.51;	author todd;	state Exp;
branches;
next	1.14;

1.14
date	97.09.30.17.52.49;	author deraadt;	state Exp;
branches;
next	1.13;

1.13
date	97.05.29.08.38.57;	author grr;	state Exp;
branches;
next	1.12;

1.12
date	97.05.22.17.01.23;	author johns;	state Exp;
branches;
next	1.11;

1.11
date	97.05.16.03.40.41;	author grr;	state Exp;
branches;
next	1.10;

1.10
date	97.05.16.02.09.38;	author grr;	state Exp;
branches;
next	1.9;

1.9
date	97.05.14.21.39.15;	author millert;	state Exp;
branches;
next	1.8;

1.8
date	97.05.01.11.30.43;	author niklas;	state Exp;
branches;
next	1.7;

1.7
date	97.04.30.23.56.06;	author grr;	state Exp;
branches;
next	1.6;

1.6
date	97.04.30.08.17.59;	author grr;	state Exp;
branches;
next	1.5;

1.5
date	97.04.11.01.12.44;	author gene;	state Exp;
branches;
next	1.4;

1.4
date	96.10.24.15.32.37;	author deraadt;	state Exp;
branches;
next	1.3;

1.3
date	96.09.05.21.27.10;	author deraadt;	state Exp;
branches;
next	1.2;

1.2
date	96.03.28.21.48.22;	author niklas;	state Exp;
branches;
next	1.1;

1.1
date	96.01.07.13.23.02;	author deraadt;	state Exp;
branches;
next	;


desc
@@


1.75
log
@remove sparc media building goop
@
text
@#	$OpenBSD: install.md,v 1.74 2016/02/08 17:28:09 krw Exp $
#	$NetBSD: install.md,v 1.3.2.5 1996/08/26 15:45:28 gwr Exp $
#
#
# Copyright (c) 1996 The NetBSD Foundation, Inc.
# All rights reserved.
#
# This code is derived from software contributed to The NetBSD Foundation
# by Jason R. Thorpe.
#
# Redistribution and use in source and binary forms, with or without
# modification, are permitted provided that the following conditions
# are met:
# 1. Redistributions of source code must retain the above copyright
#    notice, this list of conditions and the following disclaimer.
# 2. Redistributions in binary form must reproduce the above copyright
#    notice, this list of conditions and the following disclaimer in the
#    documentation and/or other materials provided with the distribution.
#
# THIS SOFTWARE IS PROVIDED BY THE NETBSD FOUNDATION, INC. AND CONTRIBUTORS
# ``AS IS'' AND ANY EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT LIMITED
# TO, THE IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR
# PURPOSE ARE DISCLAIMED.  IN NO EVENT SHALL THE REGENTS OR CONTRIBUTORS BE
# LIABLE FOR ANY DIRECT, INDIRECT, INCIDENTAL, SPECIAL, EXEMPLARY, OR
# CONSEQUENTIAL DAMAGES (INCLUDING, BUT NOT LIMITED TO, PROCUREMENT OF
# SUBSTITUTE GOODS OR SERVICES; LOSS OF USE, DATA, OR PROFITS; OR BUSINESS
# INTERRUPTION) HOWEVER CAUSED AND ON ANY THEORY OF LIABILITY, WHETHER IN
# CONTRACT, STRICT LIABILITY, OR TORT (INCLUDING NEGLIGENCE OR OTHERWISE)
# ARISING IN ANY WAY OUT OF THE USE OF THIS SOFTWARE, EVEN IF ADVISED OF THE
# POSSIBILITY OF SUCH DAMAGE.
#
#
# machine dependent section of installation/upgrade script.
#

MDTERM=sun
MDXDM=y
MDDKDEVS='/^sd[0-9] /s/ .*//p;/^x[dy][0-9] /s/ .*//p'

md_installboot() {
	# Use cat to avoid holes created by cp(1)
	cat /mnt/usr/mdec/boot > /mnt/boot
	sync; sleep 3
	/mnt/usr/mdec/installboot /mnt/boot /mnt/usr/mdec/bootxx /dev/r${1}c
}

md_prep_disklabel() {
	local _disk=$1 _f=/tmp/fstab.$1

	disklabel_autolayout $_disk $_f || return
	[[ -s $_f ]] && return

	# Edit disklabel manually.
	# Abandon all hope, ye who enter here.
	disklabel -F $_f -E $_disk
}

md_congrats() {
}

md_consoleinfo() {
}
@


1.74
log
@If manual disklabel editing is requested during install, don't emit
verbiage explaining what disklabels are.

If you don't know, you should be using (A)uto!

ok rpe@@ halex@@
@
text
@d1 1
a1 1
#	$OpenBSD: install.md,v 1.73 2015/06/02 19:54:07 rpe Exp $
@


1.73
log
@Remove the $FSTABFLAG variable and use -F directly. The installer
uses disklabel UIDs unconditionally for a while already.

OK krw@@
"looks good" deraadt@@
@
text
@d1 1
a1 1
#	$OpenBSD: install.md,v 1.72 2015/05/31 19:40:10 rpe Exp $
d53 2
a54 8
	cat <<__EOT

You will now create a Sun-style disklabel on the disk.  The disklabel defines
how OpenBSD splits up the disk into OpenBSD partitions in which filesystems
and swap space are created.  You must provide each filesystem's mountpoint
in this program.

__EOT
@


1.72
log
@Replace identical code in the MD scripts of the installer with a new
MI function disklabel_autolayout() which now handles all aspects of
the disklabel auto-layout and autopartitioning case for the root disk.
Remove get_disklabel_template() and merge it with the new function.

"move forward" deraadt@@
@
text
@d1 1
a1 1
#	$OpenBSD: install.md,v 1.71 2015/05/04 19:55:27 rpe Exp $
d61 1
a61 1
	disklabel $FSTABFLAG $_f -E $_disk
@


1.71
log
@Add the new template file based autopartitioning feature of disklabel(8)
to the OpenBSD installer. It is available during unattended installation.
The template file is fetched from an url, provided as answer to a new
question in the response file:

    URL to autopartitioning template for disklabel = url

Original diff from and OK henning@@
'no objection' krw@@
@
text
@d1 1
a1 1
#	$OpenBSD: install.md,v 1.70 2015/03/11 15:21:50 deraadt Exp $
d48 4
a51 1
	local _disk=$1 _f _op
a52 21
	_f=/tmp/fstab.$_disk
	if [[ $_disk == $ROOTDISK ]]; then
		if $AUTO && get_disklabel_template; then
			disklabel -T /disklabel.auto $FSTABFLAG $_f -w -A $_disk && return
			echo "Autopartitioning failed"
			exit 1
		fi
		while :; do
			echo "The auto-allocated layout for $_disk is:"
			disklabel -h -A $_disk | egrep "^#  |^  [a-p]:"
			ask "Use (A)uto layout, (E)dit auto layout, or create (C)ustom layout?" a
			case $resp in
			a*|A*)	_op=-w ;;
			e*|E*)	_op=-E ;;
			c*|C*)	break ;;
			*)	continue ;;
			esac
			disklabel $FSTABFLAG $_f $_op -A $_disk
			return
		done
	fi
@


1.70
log
@If this is going to use sync, it should use the sync + sleep idiom.
Yes, this is stupid, but MI installboot later will make the problem
go away.  Until then..
@
text
@d1 1
a1 1
#	$OpenBSD: install.md,v 1.69 2013/11/16 18:37:27 rpe Exp $
d52 5
@


1.69
log
@Remove AUTOROOT variable which is a leftover of r1.183 of install.sub

diff from Philipp e1c1bac6253dc54a1e89ddc046585792 at osteo dot net

ok krw@@ halex@@
@
text
@d1 1
a1 1
#	$OpenBSD: install.md,v 1.68 2012/10/17 02:06:39 deraadt Exp $
d43 1
a43 1
	sync
@


1.68
log
@use the baseXX installed goop in /mnt to install bootblocks
tested by krw
@
text
@d1 1
a1 1
#	$OpenBSD: install.md,v 1.67 2012/07/13 14:50:34 halex Exp $
d57 1
a57 1
			a*|A*)	_op=-w ; AUTOROOT=y ;;
@


1.67
log
@copy boot loaders using cat and shell redirection rather than cp,
since the latter may insert holes in the target files, which could
be bad for the boot process

ok deraadt@@ guenther@@
@
text
@d1 1
a1 1
#	$OpenBSD: install.md,v 1.66 2012/07/10 14:25:00 halex Exp $
a40 12
	local _prefix

	# use extracted mdec if it exists (may be newer)
	if [ -e /mnt/usr/mdec/boot ]; then
		_prefix=/mnt/usr/mdec
	elif [ -e /usr/mdec/boot ]; then
		_prefix=/usr/mdec
	else
		echo No boot block prototypes found, you must run installboot manually.
		return
	fi

d42 1
a42 1
	cat ${_prefix}/boot > /mnt/boot
d44 1
a44 1
	installboot /mnt/boot ${_prefix}/bootxx /dev/r${1}c
@


1.66
log
@since disklabel -W is no more, zap it from all the install.md's

ok krw@@
@
text
@d1 1
a1 1
#	$OpenBSD: install.md,v 1.65 2011/04/17 20:57:11 krw Exp $
d53 2
a54 1
	cp ${_prefix}/boot /mnt/boot
@


1.65
log
@First crack at enabling the installation of a DUID version of
/etc/fstab, after asking user. Current default is existing behaviour.

Feedback & suggestions deraadt@@, halex@@, jsing@@, todd@@.

ok deraadt@@
@
text
@d1 1
a1 1
#	$OpenBSD: install.md,v 1.64 2009/06/04 00:44:47 krw Exp $
a60 1
	disklabel -W $_disk >/dev/null 2>&1
@


1.64
log
@Nuke now superfluous ARCH=ARCH lines in install.md and the sed processing of
those lines in list2sh.awk.

ok deraadt@@
@
text
@d1 1
a1 1
#	$OpenBSD: install.md,v 1.63 2009/06/02 16:23:45 krw Exp $
d74 1
a74 1
			disklabel -f $_f $_op -A $_disk
d86 1
a86 1
	disklabel -f $_f -E $_disk
@


1.63
log
@Add '-h' flag, and '*' as a unit specifier for 'p' Editor command.
Both cause partition sizes to be displayed using a human readable
format with the units automatically chosen by looking at the smallest
partition in the disk label. Remove forceable humanization in 'A'
code and use '-h' in install scripts.

Prodded & ok deraadt@@, verbiage tweaks from jmc@@
@
text
@d1 1
a1 1
#	$OpenBSD: install.md,v 1.62 2009/05/31 17:49:53 deraadt Exp $
a38 1
ARCH=ARCH
@


1.62
log
@Make bootblock installation as silent as possible by default.  While
there, remove a lot of cruft from the various md_installboot functions
ok halex
@
text
@d1 1
a1 1
#	$OpenBSD: install.md,v 1.61 2009/05/11 17:13:07 deraadt Exp $
d67 1
a67 1
			disklabel -A $_disk | egrep "^#  |^  [a-p]:"
@


1.61
log
@Remind people that mountpoints must now be entered using the disklabel
command; the script does not ask afterwards.  Note I am not adjusting
the macppc or sgi install.md scripts.  I ask their maintainers to clean
them before I will maintain them further.  Please
@
text
@d1 1
a1 1
#	$OpenBSD: install.md,v 1.60 2009/05/09 21:37:26 deraadt Exp $
d42 1
a42 1
	local _rawdev=/dev/r${1}c _prefix
d56 1
a56 1
	installboot -v /mnt/boot ${_prefix}/bootxx ${_rawdev}
@


1.60
log
@remove some chatty disklabel stuff
@
text
@d1 1
a1 1
#	$OpenBSD: install.md,v 1.59 2009/04/25 03:21:51 deraadt Exp $
d79 8
@


1.59
log
@If the right conditions exist, ask if xdm should be started automatically.
Yes, there are machines where you X needs configuration, but let us be
realistic about it: THAT IS AN X BUG.  And there are machines where getty
and xdm fight: THAT IS A CONSOLE DRIVER BUG.  And this commit is going to
force those bugs to eventually matter enough so that they get fixed.   Just
watch.
@
text
@d1 1
a1 1
#	$OpenBSD: install.md,v 1.58 2009/04/12 12:56:02 krw Exp $
a53 1
	echo Installing boot block...
d55 1
a55 1
	sync; sync; sync
@


1.58
log
@Tweak pattern used to select partition lines for display so the
'# /dev/r...' line is not selected.

Noticed by deraadt@@
@
text
@d1 1
a1 1
#	$OpenBSD: install.md,v 1.57 2009/04/12 01:35:01 krw Exp $
d37 1
@


1.57
log
@No longer need '-f' or '-p' when displaying layout. A few patterns
missed the '# size offset ...' line at the top of the partition
list.
@
text
@d1 1
a1 1
#	$OpenBSD: install.md,v 1.56 2009/04/10 23:11:17 krw Exp $
d67 1
a67 1
			disklabel -A $_disk | egrep "^#|^  [a-p]:"
@


1.56
log
@Where appropriate display the auto-allocation layout of the root
disk and ask if the installee wants to use it, edit it, or create
their own custom disklabel. Most one-disk installs will not need
to see fdisk or disklabel.

i386 and macppc by me, adapted for others by deraadt@@.

ok deraadt@@
@
text
@d1 1
a1 1
#	$OpenBSD: install.md,v 1.55 2008/06/26 05:42:04 ray Exp $
d67 1
a67 1
			disklabel -f $_f -p g -A $_disk | egrep "^#|^  [a-p]:"
@


1.55
log
@First pass at removing clauses 3 and 4 from NetBSD licenses.

Not sure what's more surprising: how long it took for NetBSD to
catch up to the rest of the BSDs (including UCB), or the amount of
code that NetBSD has claimed for itself without attributing to the
actual authors.

OK deraadt@@
@
text
@d1 1
a1 1
#	$OpenBSD: install.md,v 1.54 2008/03/22 23:28:10 krw Exp $
d60 1
a60 1
	local _disk=$1
d63 17
a79 1
	disklabel -f /tmp/fstab.$_disk -E $_disk
@


1.54
log
@No point in checking disklabel output for 'disk label corrupted' message
since it isn't emitted anymore.

ok deraadt@@
@
text
@d1 1
a1 1
#	$OpenBSD: install.md,v 1.53 2008/03/04 00:36:38 krw Exp $
a18 7
# 3. All advertising materials mentioning features or use of this software
#    must display the following acknowledgement:
#        This product includes software developed by the NetBSD
#        Foundation, Inc. and its contributors.
# 4. Neither the name of The NetBSD Foundation nor the names of its
#    contributors may be used to endorse or promote products derived
#    from this software without specific prior written permission.
@


1.53
log
@Redo serial console configuration logic. Smaller, easier to
understand.

Add serial console handling for alpha, macppc, zaurus.  No functional
change for i386/amd64.

All archs should now have automatic serial console configuration.

ok deraadt@@
@
text
@d1 1
a1 1
#	$OpenBSD: install.md,v 1.52 2005/04/03 19:33:59 krw Exp $
a65 14
# $1 is the disk to check
md_checkfordisklabel() {
	local rval=0

	disklabel $1 >/dev/null 2>/tmp/checkfordisklabel

	if grep "disk label corrupted" /tmp/checkfordisklabel; then
		rval=2
	fi >/dev/null 2>&1

	rm -f /tmp/checkfordisklabel
	return $rval
}

a67 6

	md_checkfordisklabel $_disk
	case $? in
	2)	echo "WARNING: Label on disk $_disk is corrupted. You will be repairing it.\n"
		;;
	esac
@


1.52
log
@More shrinkage with a bit of code factoring.
@
text
@d1 1
a1 1
#	$OpenBSD: install.md,v 1.51 2005/03/27 15:13:50 krw Exp $
d94 3
@


1.51
log
@Use new skeleton kbd(8) '-l' to generalize kbd(8) use.  Eliminate
fixed list of available maps and machine dependant md_set_term()
functions.

Any ramdisk with /sbin/kbd present (amd64, cats, i386 at the moment)
will now present list of available keyboard encodings.

ok deraadt@@
@
text
@d1 1
a1 1
#	$OpenBSD: install.md,v 1.50 2003/10/12 13:18:37 krw Exp $
d44 1
a44 1
MDDISKDEVS='/^sd[0-9] /s/ .*//p;/^x[dy][0-9] /s/ .*//p'
@


1.50
log
@Cleanup and shrinkage:

1) Eliminate 'WARNING: Disk xxx has no label.' message. When installing OpenBSD
this is a normal condition not worth commenting on. From some discussion on
hackers/icb.

2) Use consistant verbiage and case statement when checking the disklabel.

3) Consistantly suppress output of 'disklabel -W', reducing duplicate messages
like '# using MBR partition ...' which are issued again when the 'disklabel -f
...' command is executed.

4) Usual code rectifications - eliminate extra {}'s, multiple echos
elimination, etc.
@
text
@d1 1
a1 1
#	$OpenBSD: install.md,v 1.49 2003/09/21 02:11:42 krw Exp $
a45 3

md_set_term() {
}
@


1.49
log
@Fix extraneous display of grep output when searching disklabel output for
error information. Previously things like:

disklabel: no disk label
WARNING: Disk wd0 has no disk label. You will be creating a new one.

would be printed. Now the 'disklabel: no disk label' message is correctly
sent to /dev/null.

Take the opportunity to clean up a bit of code and formatting, making all
the md_checkfordisklabel() functions as identical as possible.
@
text
@d1 1
a1 1
#	$OpenBSD: install.md,v 1.48 2003/09/19 01:05:34 krw Exp $
d75 1
a75 3
	if grep "no disk label" /tmp/checkfordisklabel; then
		rval=1
	elif grep "disk label corrupted" /tmp/checkfordisklabel; then
d83 1
a83 2
md_prep_disklabel()
{
d88 1
a88 6
	0)	;;
	1)	echo WARNING: Disk $_disk has no label. You will be creating a new one.
		echo
		;;
	2)	echo WARNING: Label on disk $_disk is corrupted. You will be repairing.
		echo
d92 2
a93 2
	disklabel -W ${_disk}
	disklabel -f /tmp/fstab.${_disk} -E ${_disk}
@


1.48
log
@Excise more unused code.

md_installboot() is only called from one place, with $ROOTDEV as the
parameter.  $ROOTDEV is guaranteed to be set to a valid device so
don't bother testing it.

And if the user deliberately unsets ROOTDEV the installboot will fail
trying to use /dev/rc.
@
text
@d1 1
a1 1
#	$OpenBSD: install.md,v 1.47 2002/11/07 01:28:52 krw Exp $
d69 1
d71 3
a73 2
	# $1 is the disk to check
	local rval
a74 1
	disklabel $1 > /dev/null 2> /tmp/checkfordisklabel
d79 1
a79 3
	else
		rval=0
	fi
@


1.47
log
@Treat 'bsd' like just another filename in THESETS, no more 'kernel'
logic.  As result, MDSETS gone from everything but mac68k.

MDSETS now treated as a list of complete file names to add to THESETS,
allowing more MD flexibility, i.e. may or may not be .tgz files.

All traces of tar.gz removed. Not used for sets since 2.7 or so. As a
result of code simplification from not having to consider tar.gz, the
functions get_sets(), make_lastset(), and set_not_done() are
eliminated, along with the global SETS.

Build THESETS and DEFAULTSETS to contain full file names.

Always install sets in the order they appear in THESETS, keeping
siteXX last but without needing special logic. More predictable for
user if a lot of set additions and removals done before being
satisfied, as the sets are now installed in the same order they appear
in the selection list.

Remove ability to look for non-set .tgz/.tar.gz files. The job of the
install scripts is to install the standard sets in a simple and
rational way. Not to install general tar balls. The user can do that
post-install or simply '!' out to do it during install. On their head
be it.

If no sets are found in a specified source, list the filenames in
THESETS to show what is being looked for.
@
text
@d1 1
a1 1
#	$OpenBSD: install.md,v 1.46 2002/09/24 23:45:05 deraadt Exp $
d51 1
a51 7
	local _rawdev _prefix

	if [ -z "$1" ]; then
		echo No disk device specified, you must run installboot manually.
		return
	fi
	_rawdev=/dev/r${1}c
@


1.46
log
@fix english; krw ok
@
text
@d1 1
a1 1
#	$OpenBSD: install.md,v 1.45 2002/08/27 02:18:34 krw Exp $
a42 2
# Machine-dependent install sets
MDSETS=kernel
@


1.45
log
@Move general partitioning advice from machine dependant per disk
routine to install.sh so it is displayed only once.

Strongly advise /, /tmp, /var, /usr and /home have their own
disk partitions as requested by deraadt@@.

Rather than rely on users not re-selecting an already initialized
disk, just allow them to choose from un-initialized disks.

Move get_root invocation into install.sub as both install.sh and
upgrade.sh did it first thing.

Remove the 'workaround' to a 'vnode aliasing bug' that came in
with the initial import of upgrade.sh from NetBSD. ok millert@@.

Rework verbiage in a few places. Clean up logic around looping
through disk units by handling root disk better.
@
text
@d1 1
a1 1
#	$OpenBSD: install.md,v 1.44 2002/05/22 01:48:38 krw Exp $
d101 1
a101 1
	1)	echo WARNING: Label on disk $_disk has no label. You will be creating a new one.
@


1.44
log
@Fix quoting botch in earlier commit. Make sure MDDISKDEVS and
MDCDDEVS actually work with non-empty values as well as the
supplied default this time.

Problem first detected by jsyn@@.
@
text
@d1 1
a1 1
#	$OpenBSD: install.md,v 1.43 2002/05/20 16:53:57 krw Exp $
a108 7
	# display example
	cat << __EOT
If you are unsure of how to use multiple partitions properly
(ie. separating /, /usr, /tmp, /var, /usr/local, and other things)
just split the space into a root and swap partition for now.

__EOT
@


1.43
log
@Eliminate md_questions(). It was used only to control the setting of
machdep.allowaperture. Remove the setting of machdep.allowaperture
from md_installboot().

Add MDXAPERTURE variable to relevant architectures.

Add a new function set_machdep_allowaperture(). It is called *after*
install_sets() (which changes when the X Window question is asked), and
if MDXAPERTURE is present modifies sysctl.conf.

Shrinks overall size for i386, macppc, sparc64 (which used md_questions
for machdep.allowaperture) but increases size a bit for other
architectures since set_machep_allowaperture is in install.sub.
@
text
@d1 1
a1 1
#	$OpenBSD: install.md,v 1.42 2002/05/18 17:56:03 krw Exp $
d46 1
a46 1
MDDISKDEVS="'/^sd[0-9] /s/ .*//p;/^x[dy][0-9] /s/ .*//p'"
@


1.42
log
@Eliminate md_get_diskdevs() and md_get_cddevs() by

1) Saving one boot's worth of dmesg in /tmp/dmesg.boot
2) Using sed to scan for devices and pull out names in
   new get_diskdevs() and get_cddevs() in install.sub
3) Saving any md disk/cd sed patterns in MDDISKDEVS and
   MDCDDEVS variables.
@
text
@d1 1
a1 1
#	$OpenBSD: install.md,v 1.41 2002/05/14 01:49:25 krw Exp $
a49 4
}

md_questions() {
	:
@


1.41
log
@Eliminate md_native_fstype() and md_native_fsopts(). Both functions
simply echo'd a single word if present at all.

Replace with variables MDFSTYPE and MDFSOPTS if required. Rework logic
in install.sub's mount_a_disk() to always include 'ro' as an option to
the mount command. This allows even those arch's with MDFSTYPE to
usually get by without MDFSOPTS.

ok deraadt@@
@
text
@d1 1
a1 1
#	$OpenBSD: install.md,v 1.40 2002/05/09 21:54:46 krw Exp $
d46 1
a49 24
}

md_get_msgbuf() {
	# Only want to see one boot's worth of info
	dmesg > /tmp/msgbuf
	sed -n -f /dev/stdin /tmp/msgbuf <<- OOF
		/^OpenBSD /h
		/^OpenBSD /!H
		\${
			g
			p
		}
	OOF
}

md_get_diskdevs() {
	# return available disk devices
	md_get_msgbuf | sed -n 	-e '/^sd[0-9] /{s/ .*//;p;}' \
	    -e '/^x[dy][0-9] /{s/ .*//;p;}'
}

md_get_cddevs() {
	# return available CDROM devices
	md_get_msgbuf | sed -n 	-e '/^cd[0-9] /{s/ .*//;p;}'
@


1.40
log
@Elminate md_welcome_banner() and md_not_going_to_install() as the
output of both was essentially identical on all architectures. Replace
with welcome_banner() and not_going_to_install() in install.sub.

Abstract common verbiage from md_congrats() into congrats() which
calls md_congrats() for any architecture specific additional verbiage.

Reword things so ${MODE} can be plausibly used in more places.

Remove extraneous #!/bin/sh in hp300 install.md.

ok deraadt@@ espie@@
@
text
@d1 1
a1 1
#	$OpenBSD: install.md,v 1.39 2002/05/08 23:01:47 krw Exp $
a101 8
}

md_native_fstype() {
	:
}

md_native_fsopts() {
	:
@


1.39
log
@Abstract out common md_set_term() code into set_term() in install.sub,
calling md_set_term() from set_term() to do machine dependent stuff.
Currently only i386 does anything - keyboard mappings.

Add MDTERM variable to allow install.md to set proper default terminal
type. Default to vt220.

Eliminate md_get_partition_range() as useless since every architecture
returned '[a-p]'.

Make default term for all mvme* architectures vt100 as requested by miod@@.

ok deraadt@@ millert@@ miod@@
@
text
@d1 1
a1 1
#	$OpenBSD: install.md,v 1.38 2002/05/07 02:03:57 krw Exp $
a154 48
md_welcome_banner() {
{
	if [ "$MODE" = install ]; then
		cat << __EOT
Welcome to the OpenBSD/sparc ${VERSION_MAJOR}.${VERSION_MINOR} installation program.

This program is designed to help you put OpenBSD on your disk in a simple and
rational way.
__EOT

	else
		cat << __EOT
Welcome to the OpenBSD/sparc ${VERSION_MAJOR}.${VERSION_MINOR} upgrade program.

This program is designed to help you upgrade your OpenBSD system in a
simple and rational way.

As a reminder, installing the 'etc' binary set is NOT recommended.
Once the rest of your system has been upgraded, you should manually
merge any changes to files in the 'etc' set into those files which
already exist on your system.
__EOT
	fi

cat << __EOT

As with anything which modifies your disk's contents, this program can
cause SIGNIFICANT data loss, and you are advised to make sure your
data is backed up before beginning the installation process.

Default answers are displayed in brackets after the questions.  You
can hit Control-C at any time to quit, but if you do so at a prompt,
you may have to hit return.  Also, quitting in the middle of
installation may leave your system in an inconsistent state.

__EOT
} | more
}

md_not_going_to_install() {
	cat << __EOT

OK, then.  Enter 'halt' at the prompt to halt the machine.  Once the
machine has halted, power-cycle the system to load new boot code.

__EOT
}

a155 13
	local what;
	if [ "$MODE" = install ]; then
		what=installed
	else
		what=upgraded
	fi
	cat << __EOT

CONGRATULATIONS!  You have successfully $what OpenBSD!
To boot the installed system, enter halt at the command prompt. Once the
system has halted, reset the machine and boot from the disk.

__EOT
@


1.38
log
@All architectures now use miniroot, so eliminate last few getresp()
calls in favour of ask().

Fix the erroneous advice I gave to Hugh in vax getresp() -> ask().

ok deraadt@@
@
text
@d1 1
a1 1
#	$OpenBSD: install.md,v 1.37 2002/03/31 17:30:31 deraadt Exp $
d45 1
a48 4
	test -n "$TERM" && return
	ask "Specify terminal type:" sun
	TERM=$resp
	export TERM
a72 5
}

md_get_partition_range() {
	# return range of valid partition letters
	echo [a-p]
@


1.37
log
@bit of shrinkage, krw ok
@
text
@d1 1
a1 1
#	$OpenBSD: install.md,v 1.36 2002/02/14 03:34:15 deraadt Exp $
d49 1
a49 2
	echo -n "Specify terminal type [sun]: "
	getresp sun
@


1.36
log
@version mishandling
@
text
@d1 1
a1 1
#	$OpenBSD: install.md,v 1.35 2001/12/23 01:51:52 krw Exp $
a38 1

d44 1
a44 1
MDSETS="kernel xbin xman xinc xcon"
d59 6
a64 6
                /^OpenBSD /h
                /^OpenBSD /!H
                \${
                        g
                        p
                }
d71 1
a71 1
				-e '/^x[dy][0-9] /{s/ .*//;p;}' 
d80 2
a81 2
    # return range of valid partition letters
    echo [a-p]
d106 1
a106 1
		
d144 2
a145 4
	0)
		;;
	1)
		echo WARNING: Label on disk $_disk has no label. You will be creating a new one.
d148 1
a148 2
	2)
		echo WARNING: Label on disk $_disk is corrupted. You will be repairing.
@


1.35
log
@Remove extra blank line displayed before the paragraph 'As with
anything ...' during install and/or upgrade on some archs.

On sparc, sparc64, sun3 and vax fix a typo ('echo Welcome' ->
'Welcome') in here-document displayed in md_welcome_banner().
@
text
@d1 1
a1 1
#	$OpenBSD: install.md,v 1.34 2001/06/23 19:44:57 deraadt Exp $
d180 1
a180 1
Welcome to the OpenBSD/sparc ${VERSION} upgrade program.
@


1.34
log
@argh.  stop using kernfs, using dmesg using sysctl.  encode ARCH into
install.md at build time.  remove some crud.  and the icing on the cake:
skip testing all this until next week
@
text
@d1 1
a1 1
#	$OpenBSD: install.md,v 1.33 2001/01/25 19:18:42 deraadt Exp $
a175 1

d180 1
a180 1
echo Welcome to the OpenBSD/sparc ${VERSION} upgrade program.
a188 1

@


1.33
log
@egrep -a to permit working with binary data in dmesg
@
text
@d1 1
a1 1
#	$OpenBSD: install.md,v 1.32 2000/04/24 16:33:44 millert Exp $
a44 1
HOSTNAME=/kern/hostname
d46 1
a46 13

# an alias for hostname(1)
hostname() {
	if [ -x /bin/hostname ]; then
		/bin/hostname $1
	else
		if [ -z "$1" ]; then
			cat $HOSTNAME
		else
			echo $1 > $HOSTNAME
		fi
	fi
}
a55 21
md_makerootwritable() {
	# Was: do_mfs_mount "/tmp" "2048"
	# /tmp is the mount point
	# 2048 is the size in DEV_BIZE blocks

	if [ ! -w /tmp ]; then
		umount /tmp > /dev/null 2>&1
		if ! mount_mfs -s 2048 swap /tmp ; then
			cat << __EOT

FATAL ERROR: Can't mount the memory filesystem.

__EOT
			exit
		fi

		# Bleh.  Give mount_mfs a chance to DTRT.
		sleep 2
	fi
}

d57 3
a59 2
        # Only want to see one boot's worth of info
        sed -n -f /dev/stdin /kern/msgbuf <<- OOF
a66 4
}

md_machine_arch() {
	cat /kern/machine
@


1.32
log
@Treat the beginning of the current dmesg output as starting at
/^OpenBSD /, not /^Copyright / (the latter doesn't show up in dmesg).
@
text
@d1 1
a1 1
#	$OpenBSD: install.md,v 1.31 2000/03/11 02:29:03 deraadt Exp $
a44 1
MSGBUF=/kern/msgbuf
d92 1
a92 1
        sed -n -f /dev/stdin $MSGBUF <<- OOF
@


1.31
log
@work around /kern/msgbuf NUL behaviour; pjanzen
@
text
@d1 1
a1 1
#	$OpenBSD: install.md,v 1.30 1999/10/13 02:47:42 jason Exp $
d94 2
a95 2
                /^Copyright (c)/h
                /^Copyright (c)/!H
@


1.30
log
@always add kernel to MDSETS; millert & deraadt ok'd
@
text
@d1 1
a1 1
#	$OpenBSD: install.md,v 1.29 1999/09/03 18:55:36 deraadt Exp $
d109 1
a109 2
	md_get_msgbuf | sed -n -e '1,/^OpenBSD /d' \
				-e '/^sd[0-9] /{s/ .*//;p;}' \
d115 1
a115 2
	md_get_msgbuf | sed -n -e '1,/^OpenBSD /d' \
				-e '/^cd[0-9] /{s/ .*//;p;}'
@


1.29
log
@md_questions() interface allows asking questions before sets
@
text
@d1 1
a1 1
#	$OpenBSD: install.md,v 1.28 1999/08/15 10:05:05 millert Exp $
d47 1
a47 4
MDSETS="xbin xman xinc xcon"
if [ ! -f /bsd ]; then
	MDSETS="kernel ${MDSETS}"
fi
@


1.28
log
@Kill md_copy_kernel()
@
text
@d1 1
a1 1
#	$OpenBSD: install.md,v 1.27 1999/04/02 05:17:37 millert Exp $
d126 4
@


1.27
log
@Fix "no closing quote" problem.
@
text
@d1 1
a1 1
#	$OpenBSD: install.md,v 1.26 1999/04/02 01:08:16 millert Exp $
a204 4
}

md_copy_kernel() {
	check_kernel
@


1.26
log
@shave a few bytes
@
text
@d1 1
a1 1
#	$OpenBSD: install.md,v 1.25 1999/04/01 21:30:51 deraadt Exp $
d229 1
a229 1
As a reminder, installing the `etc' binary set is NOT recommended.
d231 1
a231 1
merge any changes to files in the `etc' set into those files which
d255 1
a255 1
OK, then.  Enter `halt' at the prompt to halt the machine.  Once the
@


1.25
log
@disklabel -f use, for fstab tweaking
@
text
@d1 1
a1 1
#	$OpenBSD: install.md,v 1.24 1998/11/03 04:10:16 aaron Exp $
d66 1
a66 3
	if [ ! -z "$TERM" ]; then
		return
	fi
d68 2
a69 2
	getresp "sun"
	TERM="$resp"
d81 1
a81 1
			cat << \__mfs_failed_1
d85 1
a85 1
__mfs_failed_1
d125 1
a125 1
    echo "[a-p]"
d129 1
a129 2
	local _rawdev
	local _prefix
d131 2
a132 2
	if [ "X${1}" = X"" ]; then
		echo "No disk device specified, you must run installboot manually."
d143 1
a143 1
		echo "No boot block prototypes found, you must run installboot manually."
d147 1
a147 1
	echo "Installing boot block..."
d154 1
d158 1
d180 1
a180 1
	local _disk
a181 1
	_disk=$1
d187 1
a187 1
		echo "WARNING: Label on disk $_disk has no label. You will be creating a new one."
d191 1
a191 1
		echo "WARNING: Label on disk $_disk is corrupted. You will be repairing."
d197 1
a197 1
	cat << \__md_prep_disklabel_1
d202 1
a202 1
__md_prep_disklabel_1
d213 3
a215 3
	if [ "$MODE" = "install" ]; then
		echo "Welcome to the OpenBSD/sparc ${VERSION_MAJOR}.${VERSION_MINOR} installation program."
		cat << \__welcome_banner_1
d220 1
a220 1
__welcome_banner_1
d223 2
a224 3
		echo ""
		echo "Welcome to the OpenBSD/sparc ${VERSION} upgrade program."
		cat << \__welcome_banner_2
d234 1
a234 1
__welcome_banner_2
d237 1
a237 1
cat << \__welcome_banner_3
d248 1
a248 1
__welcome_banner_3
d253 1
a253 1
	cat << \__not_going_to_install_1
d258 1
a258 1
__not_going_to_install_1
d263 2
a264 2
	if [ "$MODE" = "install" ]; then
		what="installed";
d266 1
a266 1
		what="upgraded";
d268 1
a268 1
	cat << __congratulations_1
d274 1
a274 1
__congratulations_1
@


1.24
log
@seperating -> separating
@
text
@d1 1
a1 1
#	$OpenBSD: install.md,v 1.23 1998/10/28 17:53:29 millert Exp $
d206 1
a206 1
	disklabel -E ${_disk}
@


1.23
log
@call check_kernel instead of having the same code in all the .md files
@
text
@d1 1
a1 1
#	$OpenBSD: install.md,v 1.22 1998/10/09 11:21:03 deraadt Exp $
d201 1
a201 1
(ie. seperating /, /usr, /tmp, /var, /usr/local, and other things)
@


1.22
log
@proper version number at startup
@
text
@d1 1
a1 1
#	$OpenBSD: install.md,v 1.21 1998/09/11 22:55:45 millert Exp $
d210 1
a210 5
	if [ -f /bsd ]; then
		echo -n "Copying kernel..."
		cp -p /bsd /mnt/bsd
		echo "done."
	fi
@


1.21
log
@kill md_get_ifdevs, miniroot/install.sub uses mi version now
@
text
@d1 1
a1 1
#	$OpenBSD: install.md,v 1.20 1998/07/20 08:02:56 todd Exp $
d220 1
a220 1
		echo "Welcome to the OpenBSD/sparc ${VERSION} installation program."
@


1.20
log
@o sparcs can have msgbuf's carried over from one boot to another.
  only use the last msgbuf based upon alpha install.md
o we have ie0 le0 be0 and hme0 on sparc not just le0.
@
text
@d1 1
a1 1
#	$OpenBSD: install.md,v 1.19 1998/07/16 22:27:46 deraadt Exp $
a122 7
}

md_get_ifdevs() {
	# return available network devices
	md_get_msgbuf | sed -n -e '1,/^OpenBSD /d' \
				-e '/^[bli]e[0-9] /{s/ .*//;p;}' \
				-e '/^hme[0-9] /{s/ .*//;p;}'
@


1.19
log
@add support for hme* and be* network devices
@
text
@d1 1
a1 1
#	$OpenBSD: install.md,v 1.18 1998/03/27 23:28:17 deraadt Exp $
d96 12
d114 3
a116 3
	# dmesg | egrep "(^sd[0-9] |^x[dy][0-9] )" | cut -d" " -f1 | sort -u
	sed -n -e '1,/^OpenBSD /d' -e '/^sd[0-9] /{s/ .*//;p;}' \
				-e '/^x[dy][0-9] /{s/ .*//;p;}' <  $MSGBUF
d121 2
a122 2
	# dmesg | grep "^cd[0-9] " | cut -d" " -f1 | sort -u
	sed -n -e '1,/^OpenBSD /d' -e '/^cd[0-9] /{s/ .*//;p;}' < $MSGBUF
d127 3
a129 2
	# dmesg | egrep "(^le[0-9] |^ie[0-9] |^hme[0-9] |^be[0-9])" | cut -d" " -f1 | sort -u
	sed -n -e '1,/^OpenBSD /d' -e '/^le[0-9] /{s/ .*//;p;}'< $MSGBUF
@


1.18
log
@simplify a message
@
text
@d1 1
a1 1
#	$OpenBSD: install.md,v 1.17 1998/03/12 08:48:54 deraadt Exp $
d115 1
a115 1
	# dmesg | egrep "(^le[0-9] |^ie[0-9] )" | cut -d" " -f1 | sort -u
@


1.17
log
@banner fixups
@
text
@d1 1
a1 1
#	$OpenBSD: install.md,v 1.16 1997/10/27 04:59:11 todd Exp $
d217 3
a219 4
This program is designed to help you put OpenBSD on your disk, in a
simple and rational way.  You'll be asked several questions, and it
would probably be useful to have your disk's hardware manual, the
installation notes, and a calculator handy.
@


1.16
log
@me bad.
@
text
@d1 1
a1 1
#	$OpenBSD: install.md,v 1.15 1997/10/25 09:44:51 todd Exp $
a213 1
		echo ""
@


1.15
log
@Mirror alpha install.md:
deraadt: clarify
millert: don't use sync(1)
millert: Bitch if md_installboot called with no args
@
text
@d1 1
a1 1
#	$OpenBSD: install.md,v 1.14 1997/09/30 17:52:49 deraadt Exp $
d146 2
a147 1
	${_prefix}/installboot -v /mnt/boot ${_prefix}/bootxx ${_rawdev}
@


1.14
log
@use new fdisk & disklabel
@
text
@d1 1
a1 1
#	$OpenBSD: install.md,v 1.13 1997/05/29 08:38:57 grr Exp $
d125 19
d145 2
a146 3
	cp /usr/mdec/boot /mnt/boot
	sync; sync; sync
	installboot -v /mnt/boot /usr/mdec/bootxx /dev/r${1}a
a179 1
		echo -n "Do you wish to edit the disklabel on $_disk? [y]"
d182 2
a183 2
		echo "WARNING: Disk $_disk has no label"
		echo -n "Do you want to create one with the disklabel editor? [y]"
d186 2
a187 2
		echo "WARNING: Label on disk $_disk is corrupted"
		echo -n "Do you want to try and repair the damage using the disklabel editor? [y]"
a190 6
	getresp "y"
	case "$resp" in
	y*|Y*) ;;
	*)	return ;;
	esac

d193 3
a195 33

Here is an example of what the partition information will look like once
you have entered the disklabel editor. Disk partition sizes and offsets
are in sector (most likely 512 bytes) units.

Make sure these size/offset pairs are on cylinder boundaries (the number
of sector per cylinder is given in the `sectors/cylinder' entry.

If this disk is previously un-labeled, only the "c" partition will show up
in the editor and you will have to enter lines similar to those shown in the
example for the other paritions.  If you are uncertain about the syntax or
space requirements, this is a good time to review the installation notes.

Do not change any parameters except the partition layout and the label name.
It's probably also wisest not to touch the `16 partitions:' line, even
in case you have defined less than sixteen partitions.

[** EXAMPLE **]
disk: p4200s
bytes/sector: 512
sectors/track: 40
tracks/cylinder: 8
sectors/cylinder: 320
cylinders: 1280
total sectors: 409600

16 partitions:
#        size   offset    fstype   [fsize bsize   cpg]
  a:    51200        0    4.2BSD     1024  8192    16 	# (Cyl.    0 - 159)
  b:    51200    51200      swap                    	# (Cyl.  160 - 319)
  c:   409600        0    unused        0     0       	# (Cyl.    0 - 1279)
  d:   307200   102400    4.2BSD     1024  8192    16 	# (Cyl.  320 - 1279)
[End of **EXAMPLE**]
a197 2
	echo -n "Press [Enter] to continue "
	getresp ""
d217 4
a220 4
This program is designed to help you put OpenBSD on your disk,
in a simple and rational way.  You'll be asked several questions,
and it would probably be useful to have your disk's hardware
manual, the installation notes, and a calculator handy.
d235 1
d241 7
a247 8
As with anything which modifies your disk's contents, this
program can cause SIGNIFICANT data loss, and you are advised
to make sure your data is backed up before beginning the
installation process.

Default answers are displayed in brackets after the questions.
You can hit Control-C at any time to quit, but if you do so at a
prompt, you may have to hit return.  Also, quitting in the middle of
@


1.13
log
@fix sparc install.md so that it copes with either  a kernel image present to copy (minidisk) or need to install one from the distribution sets (ramdisk), also work around binstall vs. instbin problems by simply using installboot for bootstrap installation
@
text
@d1 1
a1 1
#	$OpenBSD: install.md,v 1.12 1997/05/22 17:01:23 johns Exp $
d220 1
a220 1
	disklabel -e ${_disk}
@


1.12
log
@Fixed a type in md_get_diskdevs().. Removed an extra '\' char..
@
text
@d1 1
a1 1
#	$OpenBSD: install.md,v 1.11 1997/05/16 03:40:41 grr Exp $
a44 1
MDSETS="xbin xman xinc xcon"
d47 4
d126 3
a128 1
	/usr/mdec/binstall ffs /mnt
d224 5
a228 3
	echo -n "Copying kernel..."
	cp -p /bsd /mnt/bsd
	echo "done."
@


1.11
log
@/kern/msgbuf has about 2048 leading nulls, which seems to confuse sed...  also add hostname(1) alias via /kern/hostname
@
text
@d1 1
a1 1
#	$OpenBSD: install.md,v 1.10 1997/05/16 02:09:38 grr Exp $
d101 1
a101 1
				-e '/^x[dy][0-9] /{s/ .*//;p;}' \ <  $MSGBUF
@


1.10
log
@don't mount a mfs /tmp if /tmp is already writable...
@
text
@d1 1
a1 1
#	$OpenBSD: install.md,v 1.9 1997/05/14 21:39:15 millert Exp $
d47 14
d100 2
a101 2
	sed -n -e '1,/^Copyright /d' -e '/^sd[0-9]/{s/ .*//;p;}' -e '/^x[dy][0-9]/{s/ .*//;p;}' \
	    <  $MSGBUF
d107 1
a107 1
	sed -n -e '1,/^Copyright /d' -e '/^cd[0-9]/{s/ .*//;p;q;}' < $MSGBUF
d113 1
a113 1
	sed -n -e '1,/^Copyright /d' -e '/^le[0-9]/{s/ .*//;p;q;}'< $MSGBUF
@


1.9
log
@Add md_machine_arch()
@
text
@d1 1
a1 1
#	$OpenBSD: install.md,v 1.8 1997/05/01 11:30:43 niklas Exp $
d46 1
d63 4
a66 3
	umount /tmp > /dev/null 2>&1
	if ! mount_mfs -s 2048 swap /tmp ; then
		cat << \__mfs_failed_1
d71 5
a75 1
		exit
a76 3

	# Bleh.  Give mount_mfs a chance to DTRT.
	sleep 2
d85 3
a87 1
	dmesg | egrep "(^sd[0-9] |^x[dy][0-9] )" | cut -d" " -f1 | sort -u
d92 2
a93 1
	dmesg | grep "^cd[0-9] " | cut -d" " -f1 | sort -u
d98 2
a99 1
	dmesg | egrep "(^le[0-9] |^ie[0-9] )" | cut -d" " -f1 | sort -u
@


1.8
log
@OpenBSD!  I.e. tags + no update(8) need
@
text
@d1 1
a1 1
#	$OpenBSD: install.md,v 1.3.2.5 1996/08/26 15:45:28 gwr Exp $
d74 4
@


1.7
log
@clean up sparc mini-root stuff and eliminate some mysteries and surprises therein
@
text
@d1 1
@


1.6
log
@fix assorted problems with miniroot stuff
@
text
@d154 9
a162 3
are in sector (most likely 512 bytes) units. Make sure these size/offset
pairs are on cylinder boundaries (the number of sector per cylinder is
given in the `sectors/cylinder' entry, which is not shown here).
d168 9
a176 1
[Example]
d179 5
a183 5
  a:    50176        0    4.2BSD     1024  8192    16   # (Cyl.    0 - 111)
  b:    64512    50176      swap                        # (Cyl.  112 - 255)
  c:   640192        0   unknown                        # (Cyl.    0 - 1428)
  d:   525504   114688    4.2BSD     1024  8192    16   # (Cyl.  256 - 1428)
[End of example]
@


1.5
log
@We run OpenBSD, as such our kernel is named /bsd, and copying /netbsd into
the newly installed partition won't do much good.  Thanks to Tobias Richter
<tsr@@cave.isdn.cs.tu-berlin.de> for noticing this.
@
text
@d92 1
a92 1
    echo "[a-h]"
d159 2
a160 2
It's probably also wisest not to touch the `8 partitions:' line, even
in case you have defined less than eight partitions.
d163 1
a163 1
8 partitions:
@


1.4
log
@openbsd
@
text
@d180 1
a180 1
	cp -p /netbsd /mnt/netbsd
@


1.3
log
@sync to netbsd
@
text
@d188 1
a188 1
		echo "Welcome to the NetBSD/sparc ${VERSION} installation program."
d191 1
a191 1
This program is designed to help you put NetBSD on your disk,
d199 1
a199 1
		echo "Welcome to the NetBSD/sparc ${VERSION} upgrade program."
d202 1
a202 1
This program is designed to help you upgrade your NetBSD system in a
d246 1
a246 1
CONGRATULATIONS!  You have successfully $what NetBSD!
@


1.2
log
@From NetBSD: merge of 960317
@
text
@d1 1
a1 2
#	$OpenBSD$
#	$NetBSD: install.md,v 1.2 1996/02/28 00:50:28 thorpej Exp $
d43 3
d56 19
d90 5
d97 7
a103 1
	/usr/mdec/binstall -v ffs /mnt
d108 1
d112 1
a112 1
		rval="1"
d114 1
a114 1
		rval="2"
d116 1
a116 1
		rval="0"
d120 1
d125 24
d151 1
d172 10
d188 1
a188 1
		echo "Welcome to the OpenBSD/sparc ${VERSION} installation program."
d191 1
a191 1
This program is designed to help you put OpenBSD on your disk,
d199 1
a199 1
		echo "Welcome to the OpenBSD/sparc ${VERSION} upgrade program."
d202 1
a202 1
This program is designed to help you upgrade your OpenBSD system in a
d219 1
a219 1
Default answers are displyed in brackets after the questions.
d246 1
a246 1
CONGRATULATIONS!  You have successfully $what OpenBSD!
@


1.1
log
@update from netbsd
@
text
@d1 2
a2 1
#	$NetBSD: install.md,v 1.1 1996/01/06 22:42:13 pk Exp $
d4 2
a5 1
# Copyright (c) 1995 Jason R. Thorpe.
d8 3
d21 17
a37 15
#	This product includes software developed for the NetBSD Project
#	by Jason R. Thorpe.
# 4. The name of the author may not be used to endorse or promote products
#    derived from this software without specific prior written permission
#
# THIS SOFTWARE IS PROVIDED BY THE AUTHOR ``AS IS'' AND ANY EXPRESS OR
# IMPLIED WARRANTIES, INCLUDING, BUT NOT LIMITED TO, THE IMPLIED WARRANTIES
# OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE ARE DISCLAIMED.
# IN NO EVENT SHALL THE AUTHOR BE LIABLE FOR ANY DIRECT, INDIRECT,
# INCIDENTAL, SPECIAL, EXEMPLARY, OR CONSEQUENTIAL DAMAGES (INCLUDING, BUT
# NOT LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES; LOSS OF USE,
# DATA, OR PROFITS; OR BUSINESS INTERRUPTION) HOWEVER CAUSED AND ON ANY
# THEORY OF LIABILITY, WHETHER IN CONTRACT, STRICT LIABILITY, OR TORT
# (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE USE OF
# THIS SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.
d119 1
a119 1
		echo "Welcome to the NetBSD/sparc ${VERSION} installation program."
d122 1
a122 1
This program is designed to help you put NetBSD on your disk,
d130 1
a130 1
		echo "Welcome to the NetBSD/sparc ${VERSION} upgrade program."
d133 1
a133 1
This program is designed to help you upgrade your NetBSD system in a
d177 1
a177 1
CONGRATULATIONS!  You have successfully $what NetBSD!
@

