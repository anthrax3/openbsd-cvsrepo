head	1.17;
access;
symbols
	OPENBSD_6_2:1.17.0.4
	OPENBSD_6_2_BASE:1.17
	OPENBSD_6_1:1.12.0.4
	OPENBSD_6_1_BASE:1.12
	OPENBSD_6_0:1.10.0.4
	OPENBSD_6_0_BASE:1.10
	OPENBSD_5_9:1.7.0.2
	OPENBSD_5_9_BASE:1.7
	OPENBSD_5_8:1.7.0.4
	OPENBSD_5_8_BASE:1.7
	OPENBSD_5_7:1.6.0.2
	OPENBSD_5_7_BASE:1.6
	OPENBSD_5_6:1.4.0.4
	OPENBSD_5_6_BASE:1.4
	OPENBSD_5_5:1.3.0.2
	OPENBSD_5_5_BASE:1.3;
locks; strict;
comment	@# @;


1.17
date	2017.09.29.05.44.33;	author jsg;	state Exp;
branches;
next	1.16;
commitid	sfIc0ysVm4hEEHVA;

1.16
date	2017.09.01.04.40.40;	author jsg;	state Exp;
branches;
next	1.15;
commitid	JSdY5ndU7KiCVAp0;

1.15
date	2017.08.26.13.25.17;	author jsg;	state Exp;
branches;
next	1.14;
commitid	3SJ07f7LjBVYSHOY;

1.14
date	2017.08.13.11.45.22;	author jsg;	state Exp;
branches;
next	1.13;
commitid	JHnerq3hcj6ksQ45;

1.13
date	2017.08.13.11.20.53;	author jsg;	state Exp;
branches;
next	1.12;
commitid	DRiL45ZDOOghDsTa;

1.12
date	2017.01.19.06.22.56;	author jsg;	state Exp;
branches;
next	1.11;
commitid	IW8y9Aj7m6ygRCa4;

1.11
date	2016.10.01.01.33.20;	author jsg;	state Exp;
branches;
next	1.10;
commitid	GDp9cX0eBDuKlnjl;

1.10
date	2016.07.23.16.22.17;	author jsg;	state Exp;
branches;
next	1.9;
commitid	M9jDxdf6Vwm9bs1k;

1.9
date	2016.07.09.07.19.52;	author jsg;	state Exp;
branches;
next	1.8;
commitid	poel3oxppU8LeZAk;

1.8
date	2016.05.29.13.50.13;	author jsg;	state Exp;
branches;
next	1.7;
commitid	uQNsLl5AUFa2mSgy;

1.7
date	2015.06.02.01.48.25;	author jsg;	state Exp;
branches;
next	1.6;
commitid	oitX3N4o6JZ5SMvi;

1.6
date	2015.01.26.01.55.55;	author jsg;	state Exp;
branches;
next	1.5;
commitid	h5sclZXjqIofAFSS;

1.5
date	2014.11.14.06.12.36;	author jsg;	state Exp;
branches;
next	1.4;
commitid	sn87AMzIEHXmzkJL;

1.4
date	2014.05.01.11.48.47;	author jasper;	state Exp;
branches;
next	1.3;

1.3
date	2014.02.28.00.47.14;	author afresh1;	state Exp;
branches;
next	1.2;

1.2
date	2013.10.22.16.24.11;	author jasper;	state Exp;
branches;
next	1.1;

1.1
date	2013.09.04.20.00.26;	author patrick;	state Exp;
branches;
next	;


desc
@@


1.17
log
@Mention that U-Boot images for Allwinner and Rockchip targets contain a
default DTB.
@
text
@dnl	$OpenBSD: prep,v 1.16 2017/09/01 04:40:40 jsg Exp $
Please be aware that OpenBSD support for this platform is far from
complete.

To perform an installation you must be able to interact with the serial
console of the machine.  USB OTG ports such as the one found on the
BeagleBone will not function as a console.  You need to be able to
interact with the firmware on the console.  Often this requires a 3.3V
TTL level adapter connected to pins or a header on the board.

Firmware which provides an EFI interface with a Device Tree Blob (DTB)
file is required to boot.  In most cases this is provided by images of
U-Boot 2016.07 or newer on SD/MMC devices or in SPI flash.  If the
miniroot images are used, U-Boot and DTB files are distributed as part
of the miniroot disk images.

OpenBSD can be installed onto a disk by copying the miniroot for your
board "miniroot-board-{:--:}OSrev.fs" image to an SD card.

Booting from an SD card:

  To use the miniroot image you will need another machine to plug the
  SD card in to. Any machine type will do, as long as it supports SD card
  storage devices.  Under OpenBSD, it will appear as a ``sd'' device, for
  example sd1.
  
  Use the dd(1) utility to copy the miniroot to the hard drive.
  The command would likely be, under OpenBSD:
  	dd if=miniroot-am335x-{:--:}OSrev.fs of=/dev/rsd1c
  
  When you have connected the BeagleBone to your computer, a command such
  as "cu -l cuaU0 -s 115200" (assuming cuaU0 is your serial port device)
  should connect you to the board's console.
  
  Note: By default the BeagleBone Black will boot from the internal emmc.
  In order to make it boot from the micro SD card, you will need to hold down
  the small button located by the SD card slot while powering on the board.
  Once you have done this the board will boot from the SD card as the default.

Running EFI payloads with U-Boot:

If the U-Boot target supports "distro_bootcmd" efiboot will automatically
be loaded by placing bootarm.efi into /efi/boot/bootarm.efi on a FAT
filesystem.  With dtb files placed in in /, /dtbs/, or /dtb/current/.

If the U-Boot target supports bootefi but not automatically finding it with
"distro_bootcmd" then it must be loaded manually or by U-Boot commands or
script.
	=> run findfdt
	=> load mmc 0:1 ${fdt_addr_r} ${fdtfile}
	=> load mmc 0:1 ${kernel_addr_r} efi/boot/bootarm.efi
	=> bootefi ${kernel_addr_r} ${fdt_addr_r}
The bootloader will then run and try to load sd0a:/bsd off an FFS
filesystem after a timeout.

Install on systems without a supported miniroot:

  If a miniroot is not available for your system you will have to modify
  an existing image before booting it.

  To do so first install the u-boot-arm and dtb packages.  Write one of the
  provided miniroot images to an SD card:

 	dd if=miniroot-am335x-{:--:}OSrev.fs of=/dev/rsdXc

  Add a board specific DTB file (Allwinner and Rockchip U-Boot images
  come with a default DTB):

 	mount /dev/sdXi /mnt
 	cp /usr/local/share/dtb/arm/board.dtb /mnt/
 	umount /mnt

  For systems based on Texas Instruments OMAP and AMxxxx SoCs:

 	mount /dev/sdXi /mnt
 	cp /usr/local/share/u-boot/board/{MLO,u-boot.img} /mnt/
 	umount /mnt

  For systems based on Freescale/NXP i.MX SoCs:

 	dd if=/usr/local/share/u-boot/board/SPL of=/dev/sdXc bs=1024 seek=1
 	dd if=/usr/local/share/u-boot/board/u-boot.img \
 	    of=/dev/sdXc bs=1024 seek=69

  For systems based on Allwinner Axx SoCs:

 	dd if=/usr/local/share/u-boot/board/u-boot-sunxi-with-spl.bin \
 	    of=/dev/sdXc bs=1024 seek=8

  For systems based on Rockchip RK3xxx SoCs:

 	dd if=/usr/local/share/u-boot/board/u-boot-with-spl.bin \
 	    of=/dev/sdXc seek=64

  For systems based on Marvell ARMADA 38x SoCs:

 	dd if=/usr/local/share/u-boot/board/u-boot-spl.kwb \
 	    of=/dev/sdXc bs=512 seek=1
@


1.16
log
@Remove the miniroot for the OMAP3 BeagleBoards.  Ethernet is on USB and
USB isn't supported.  The installer turns out to have been broken on
BeagleBoard for over a year and no one noticed.  The existing support
for OMAP3 in the kernel remains though it isn't clear if anyone has
tried it after the fdt changes went in.

ok patrick@@ tom@@ kettenis@@ matthieu@@
@
text
@d1 1
a1 1
dnl	$OpenBSD: prep,v 1.15 2017/08/26 13:25:17 jsg Exp $
d66 2
a67 1
  Add a board specific DTB file:
@


1.15
log
@mention U-Boot file/offset for Marvell ARMADA 38x
ok patrick@@
@
text
@d1 1
a1 1
dnl	$OpenBSD: prep,v 1.14 2017/08/13 11:45:22 jsg Exp $
d29 1
a29 1
  	dd if=miniroot-beagle-{:--:}OSrev.fs of=/dev/rsd1c
d31 1
a31 1
  When you have connected the BeagleBoard to you computer, a command such
d64 1
a64 1
 	dd if=miniroot-beagle-{:--:}OSrev.fs of=/dev/rsdXc
@


1.14
log
@mention raw SD card offset for U-Boot on Rockchip RK3xxx
@
text
@d1 1
a1 1
dnl	$OpenBSD: prep,v 1.13 2017/08/13 11:20:53 jsg Exp $
d93 5
@


1.13
log
@Avoid raw devices when dd'ing U-Boot.  Avoids cases that might require
conv=sync.  Discussed with kettenis some time ago.
@
text
@d1 1
a1 1
dnl	$OpenBSD: prep,v 1.12 2017/01/19 06:22:56 jsg Exp $
d88 5
@


1.12
log
@The u-boot package was renamed to u-boot-arm.
@
text
@d1 1
a1 1
dnl	$OpenBSD: prep,v 1.11 2016/10/01 01:33:20 jsg Exp $
d80 1
a80 1
 	dd if=/usr/local/share/u-boot/board/SPL of=/dev/rsdXc bs=1024 seek=1
d82 1
a82 1
 	    of=/dev/rsdXc bs=1024 seek=69
d84 1
a84 1
  For systems based on Allwinner Axx Socs:
d87 1
a87 1
 	    of=/dev/rsdXc bs=1024 seek=8
@


1.11
log
@Add notes on installing on systems a miniroot is not available for.
ok kettenis@@
@
text
@d1 1
a1 1
dnl	$OpenBSD: prep,v 1.10 2016/07/23 16:22:17 jsg Exp $
d61 1
a61 1
  To do so first install the u-boot and dtb packages.  Write one of the
@


1.10
log
@Some armv7 machines are shipped with linux images that run USB OTG ports
in client mode and provide serial access to a getty and networking.

Make it clear that a real serial console that can interact with the
firmware is required.

Suggested by and wording tweaks from ian@@
@
text
@d1 1
a1 1
dnl	$OpenBSD: prep,v 1.9 2016/07/09 07:19:52 jsg Exp $
d55 33
@


1.9
log
@Mention the EFI and DTB requirement.  List U-Boot 2016.07 as 2016.05
needs a patch to work with efiboot on non imx platforms that is
included in ports/packages but might not be present otherwise.

While U-Boot 2016.07 final is not released yet the
"efi_loader: Don't allocate from memory holes" patch is included
in rc1/rc2/rc3 and should make the final release.
@
text
@d1 1
a1 1
dnl	$OpenBSD: prep,v 1.8 2016/05/29 13:50:13 jsg Exp $
d4 6
@


1.8
log
@Remove the section on tftp booting a umg file.  This might come back in
a different form when u-boot supports efi networking interfaces.
@
text
@d1 1
a1 1
dnl	$OpenBSD: prep,v 1.7 2015/06/02 01:48:25 jsg Exp $
d5 6
d33 16
@


1.7
log
@Rename the imx miniroot to nitrogen as it creates "6x_bootscript".
Add a miniroot for the CuBox-i which needs u-boot at a particular
offset in the sd image to boot.  Based on changes made by Patrick
Wildt in bitrig.
@
text
@d1 1
a1 1
dnl	$OpenBSD: prep,v 1.6 2015/01/26 01:55:55 jsg Exp $
d6 1
a6 2
board "miniroot-board-{:--:}OSrev.fs" image to an SD card or by booting
the ramdisk kernel over the network using a TFTP server.
a26 25

Booting over the network:

  To interrupt the U-Boot boot process press a key after the banner is
  displayed on the serial console.

  Then the U-Boot image of the ramdisk kernel can be loaded via TFTP.

  Configure the local IP address via DHCP:

      U-Boot# setenv autoload no
      U-Boot# dhcp

  Or with a static address:

      U-Boot# setenv ipaddr 192.168.1.2

  Set the IP address of the TFTP server:

      U-Boot# setenv serverip 192.168.1.1

  To load an OMAP ramdisk image via TFTP:

      U-Boot# tftpboot bsd.rd.OMAP.umg
      U-Boot# bootm
@


1.6
log
@Rename miniroot-sunxi to miniroot-cubie as the u-boot included
in the image is for Cubieboard1.  Discussed with bmercer@@
While here switch from using the separate spl and u-boot images
to the combined spl and u-boot 'u-boot-sunxi-with-spl.bin'.
@
text
@d1 1
a1 1
dnl	$OpenBSD: prep,v 1.5 2014/11/14 06:12:36 jsg Exp $
d6 2
a7 3
board "miniroot-{am335x,beagle,imx,panda,cubie}-{:--:}OSrev.fs"
image to an SD card or by booting the ramdisk kernel over the network
using a TFTP server.
@


1.5
log
@Describe how to load the installer over the network via TFTP.
At least on the bbb there is no need to specify the load address,
I'd be interested to hear if this isn't the case for other boards.
@
text
@d1 1
a1 1
dnl	$OpenBSD: prep,v 1.4 2014/05/01 11:48:47 jasper Exp $
d6 1
a6 1
board "miniroot-{am335x,beagle,imx,panda,sunxi}-{:--:}OSrev.fs"
@


1.4
log
@- add 'sunxi' to list of miniroot files
- add list of supported 'sunxi' and 'imx' hardware

ok bmercer@@
@
text
@d1 1
a1 1
dnl	$OpenBSD: prep,v 1.3 2014/02/28 00:47:14 afresh1 Exp $
d5 49
a53 20
At the moment the only way to boot the OpenBSD install is to copy the
miniroot for your board "miniroot-{am335x,beagle,imx,panda,sunxi}-{:--:}OSrev.fs"
image to an sdcard.

As a result you need another machine to plug the sdcard in. Any
machine type will do, as long as it supports sdcard storage devices.
Under OpenBSD, it will appear as a ``sd'' device, for example sd1.

Use the dd(1) utility to copy the miniroot to the hard drive.
The command would likely be, under OpenBSD:
	dd if=miniroot-beagle-{:--:}OSrev.fs of=/dev/rsd1c

When you have connected the BeagleBoard to you computer, a command such
as "cu -l cuaU0 -s 115200" (assuming cuaU0 is your serial port device)
should connect you to the board's console.

Note: By default the BeagleBone Black will boot from the internal emmc.
In order to make it boot from the micro sdcard, you will need to hold down
the small button located by the sdcard slot while powering on the board.
Once you have done this the board will boot from the sdcard as the default.
@


1.3
log
@Recommend cu instead of tip in the INSTALL prep notes

As well as using a USB serial device in the example.

"cu in general works better on various systems" -- deraadt
"cu is more predictable across platforms" -- dlg

Ok from maja, tedu, bmercer, jj. "I like it" from deraadt

First commit is in documentation, that must be sign of something.
Thanks to everyone for making me feel welcome.
@
text
@d1 1
a1 1
dnl	$OpenBSD: prep,v 1.2 2013/10/22 16:24:11 jasper Exp $
d6 2
a7 2
miniroot for your board "miniroot-{am335x,beagle,imx,panda}-{:--:}OSrev.fs"
image to a sdcard.
d21 1
a21 1
Note: By default the BeagleBone Black will boot from the internal emmc. 
d23 2
a24 2
the small button located by the sdcard slot while powering on the board. 
Once you have done this the board will boot from the sdcard as the default. 
@


1.2
log
@- expand hardware list with iMX boards
- mention miniroot-imx

ok patrick@@
@
text
@d1 1
a1 1
dnl	$OpenBSD: prep,v 1.1 2013/09/04 20:00:26 patrick Exp $
d18 2
a19 2
as "tip -115200 tty00" (assuming tty00 is your serial port device) should
connect you to the board's console.
@


1.1
log
@Beagle has been replaced by armv7.
@
text
@d1 1
a1 1
dnl	$OpenBSD: prep,v 1.3 2013/08/07 19:24:54 bmercer Exp $
d6 1
a6 1
miniroot for your board "miniroot-{am335x,beagle,panda}-{:--:}OSrev.fs"
@

