head	1.25;
access;
symbols
	OPENBSD_6_0:1.25.0.50
	OPENBSD_6_0_BASE:1.25
	OPENBSD_5_9:1.25.0.46
	OPENBSD_5_9_BASE:1.25
	OPENBSD_5_8:1.25.0.48
	OPENBSD_5_8_BASE:1.25
	OPENBSD_5_7:1.25.0.42
	OPENBSD_5_7_BASE:1.25
	OPENBSD_5_6:1.25.0.44
	OPENBSD_5_6_BASE:1.25
	OPENBSD_5_5:1.25.0.40
	OPENBSD_5_5_BASE:1.25
	OPENBSD_5_4:1.25.0.38
	OPENBSD_5_4_BASE:1.25
	OPENBSD_5_3:1.25.0.36
	OPENBSD_5_3_BASE:1.25
	OPENBSD_5_2:1.25.0.34
	OPENBSD_5_2_BASE:1.25
	OPENBSD_5_1_BASE:1.25
	OPENBSD_5_1:1.25.0.30
	OPENBSD_5_0:1.25.0.32
	OPENBSD_5_0_BASE:1.25
	OPENBSD_4_9:1.25.0.28
	OPENBSD_4_9_BASE:1.25
	OPENBSD_4_8:1.25.0.26
	OPENBSD_4_8_BASE:1.25
	OPENBSD_4_7:1.25.0.22
	OPENBSD_4_7_BASE:1.25
	OPENBSD_4_6:1.25.0.24
	OPENBSD_4_6_BASE:1.25
	OPENBSD_4_5:1.25.0.20
	OPENBSD_4_5_BASE:1.25
	OPENBSD_4_4:1.25.0.16
	OPENBSD_4_4_BASE:1.25
	OPENBSD_4_3:1.25.0.18
	OPENBSD_4_3_BASE:1.25
	OPENBSD_4_2:1.25.0.14
	OPENBSD_4_2_BASE:1.25
	OPENBSD_4_1:1.25.0.12
	OPENBSD_4_1_BASE:1.25
	OPENBSD_4_0:1.25.0.10
	OPENBSD_4_0_BASE:1.25
	OPENBSD_3_9:1.25.0.8
	OPENBSD_3_9_BASE:1.25
	OPENBSD_3_8:1.25.0.6
	OPENBSD_3_8_BASE:1.25
	OPENBSD_3_7:1.25.0.4
	OPENBSD_3_7_BASE:1.25
	OPENBSD_3_6:1.25.0.2
	OPENBSD_3_6_BASE:1.25
	OPENBSD_3_5:1.24.0.2
	OPENBSD_3_5_BASE:1.24
	OPENBSD_3_4:1.20.0.2
	OPENBSD_3_4_BASE:1.20
	OPENBSD_3_3:1.16.0.8
	OPENBSD_3_3_BASE:1.16
	OPENBSD_3_2:1.16.0.6
	OPENBSD_3_2_BASE:1.16
	OPENBSD_3_1:1.16.0.4
	OPENBSD_3_1_BASE:1.16
	OPENBSD_3_0:1.16.0.2
	OPENBSD_3_0_BASE:1.16
	OPENBSD_2_9:1.15.0.2
	OPENBSD_2_9_BASE:1.15
	OPENBSD_2_8:1.14.0.10
	OPENBSD_2_8_BASE:1.14
	OPENBSD_2_7:1.14.0.8
	OPENBSD_2_7_BASE:1.14
	OPENBSD_2_6:1.14.0.6
	OPENBSD_2_6_BASE:1.14
	OPENBSD_2_5:1.14.0.4
	OPENBSD_2_5_BASE:1.14
	OPENBSD_2_4:1.14.0.2
	OPENBSD_2_4_BASE:1.14
	OPENBSD_2_3:1.13.0.2
	OPENBSD_2_3_BASE:1.13
	OPENBSD_2_2:1.9.0.2
	OPENBSD_2_2_BASE:1.9
	OPENBSD_2_1:1.7.0.2
	OPENBSD_2_1_BASE:1.7
	OPENBSD_2_0:1.4.0.2
	OPENBSD_2_0_BASE:1.4
	netbsd_1_1:1.1.1.1;
locks; strict;
comment	@# @;


1.25
date	2004.09.10.19.12.16;	author miod;	state Exp;
branches;
next	1.24;

1.24
date	2004.03.28.20.38.09;	author millert;	state Exp;
branches;
next	1.23;

1.23
date	2004.03.17.09.25.09;	author jmc;	state Exp;
branches;
next	1.22;

1.22
date	2003.11.10.22.11.35;	author espie;	state Exp;
branches;
next	1.21;

1.21
date	2003.11.10.21.23.20;	author miod;	state Exp;
branches;
next	1.20;

1.20
date	2003.09.09.22.03.56;	author miod;	state Exp;
branches;
next	1.19;

1.19
date	2003.09.07.12.01.56;	author krw;	state Exp;
branches;
next	1.18;

1.18
date	2003.09.07.00.21.47;	author miod;	state Exp;
branches;
next	1.17;

1.17
date	2003.09.06.22.22.43;	author miod;	state Exp;
branches;
next	1.16;

1.16
date	2001.10.02.23.08.47;	author miod;	state Exp;
branches;
next	1.15;

1.15
date	2001.04.24.23.06.58;	author miod;	state Exp;
branches;
next	1.14;

1.14
date	98.05.18.00.33.51;	author todd;	state Exp;
branches;
next	1.13;

1.13
date	98.04.06.21.45.48;	author deraadt;	state Exp;
branches;
next	1.12;

1.12
date	98.04.06.00.14.57;	author deraadt;	state Exp;
branches;
next	1.11;

1.11
date	98.04.05.02.11.41;	author deraadt;	state Exp;
branches;
next	1.10;

1.10
date	98.03.08.00.12.16;	author deraadt;	state Exp;
branches;
next	1.9;

1.9
date	97.10.24.07.11.03;	author todd;	state Exp;
branches;
next	1.8;

1.8
date	97.10.01.23.14.31;	author todd;	state Exp;
branches;
next	1.7;

1.7
date	97.05.02.15.18.06;	author deraadt;	state Exp;
branches;
next	1.6;

1.6
date	96.10.12.03.30.01;	author tholo;	state Exp;
branches;
next	1.5;

1.5
date	96.10.12.03.21.38;	author tholo;	state Exp;
branches;
next	1.4;

1.4
date	96.10.03.00.21.27;	author deraadt;	state Exp;
branches;
next	1.3;

1.3
date	96.04.25.21.29.33;	author niklas;	state Exp;
branches;
next	1.2;

1.2
date	95.11.28.17.32.25;	author deraadt;	state Exp;
branches;
next	1.1;

1.1
date	95.10.18.08.37.40;	author deraadt;	state Exp;
branches
	1.1.1.1;
next	;

1.1.1.1
date	95.10.18.08.37.40;	author deraadt;	state Exp;
branches;
next	;


desc
@@


1.25
log
@Do not mention a.out upgrades anymore, they are not supported anymore.
@
text
@dnl	$OpenBSD: upgrade,v 1.24 2004/03/28 20:38:09 millert Exp $
OpenBSDUpgrade({:-the CD-ROM or an installation floppy as you would do for
a new installation-:})
@


1.24
log
@Revise for OpenBSD 3.5 and mentio bsd.rd-a.out; OK deraadt@@
@
text
@d1 3
a3 107
dnl	$OpenBSD: upgrade,v 1.23 2004/03/17 09:25:09 jmc Exp $
dnl OpenBSDUpgrade({:-the CD-ROM or an installation floppy as you would do for
dnl a new installation-:})
Prior to version 3.4, OpenBSD used the a.out binary format.  Beginning
with version 3.4, OpenBSD uses the ELF binary format.  Because of
this, upgrades from a version of OpenBSD prior to 3.4 can be a
complex, delicate process.  The best solution, whenever possible,
is to back up your data and reinstall from scratch.

The second best solution is to remove all ports, third party programs
and libraries installed on your system; upgrade; and then add ELF
versions of the removed files.

In all cases, once you start the upgrade you MUST complete it. If
the upgrade process fails, or is abandoned before it completes, you
will almost certainly be left with a non-functional system.

If upgrading from a version of OpenBSD prior to 3.4, you cannot use
the bsd.rd kernel to upgrade the system.  The existing bootblocks
on your system cannot boot the OSREV bsd.rd--use the bsd.rd-a.out
kernel instead.

If you must do an upgrade while preserving the functionality of any
existing a.out binary files, then the rest of this section will guide you
through that process.

The two main hurdles in upgrading from an a.out system to an ELF OpenBSD
OSREV system while preserving the functioning of a.out binaries are:
- the a.out binary emulation, required for compatibility with a.out
  binaries using shared libraries, is not enabled by default, and requires
  an explicit configuration change.
- a.out shared libraries (lib*.so) need to be moved to a specific location
  for proper operation of older binaries.

Before you start the upgrade process, the a.out emulation area needs to be
set up. It needs to be put inside an /emul/a.out hierarchy. This directory can,
however, be a symbolic link, should the available space in the root partition
not be enough.

It is recommended that the following instructions and commands are issued in
single-user mode.

The /emul/a.out hierarchy should be populated by the a.out shared libraries.
An easy way to do it is to run the following commands as root:

   mkdir -p /emul/a.out/var/run
   tar cf - /sbin/ldconfig /usr/bin/ldd /usr/libexec/ld.so |
       tar -C /emul/a.out -xpf -
   for lib in $(/sbin/ldconfig -r |
     awk '/=>/ { print $3 }');
   do
     dirname $lib;
   done | sort -u > /root/a.out-libdirs
   tar cf - $(find $(< /root/a.out-libdirs) -name "lib*.so.*") |
       tar -C /emul/a.out -xpf -

Then, a cache of these shared libraries must be generated with:

   cp /var/run/ld.so.hints /var/run/ld.so.hints.backup
   /sbin/ldconfig -s $(/usr/bin/sed 's,^/,/emul/a.out/,' /root/a.out-libdirs) 
   /bin/mv /var/run/ld.so.hints /emul/a.out/var/run
   /bin/mv /var/run/ld.so.hints.backups /var/run/ld.so.hints

The last step before the upgrade is to enable the a.out emulation, in
order to be sure that /etc/rc.local or any other customization you have
made to the system will still run:

  echo "kern.emul.aout=1" >> /etc/sysctl.conf


ATTENTION! Several configuration files under /etc, such as /etc/login.conf,
will refer to existing a.out binaries. DO NOT UPGRADE YOUR SYSTEM UNLESS
YOU HAVE ENABLED A.OUT EMULATION FIRST! After you merge configuration files
changes and replace or remove your existing a.out binaries, it will be
possible to disable a.out emulation.


The upgrade is now possible. Boot from the CD-ROM, an installation
floppy, or the bsd.rd-a.out kernel as you would do for a new installation. 

When prompted, select the (U)pgrade option rather than the (I)nstall
option at the prompt in the install process.

The upgrade script will ask you for the existing root partition, and
will use the existing filesystems defined in /etc/fstab to install the
new system in. It will also use your existing network parameters.

From then on, the upgrade procedure is very close to the installation
procedure described earlier in this document. Note that the upgrade
procedure will not let you pick the ``etc{:--:}OSrev.tgz'' set, so as to
preserve your files in `/etc' which you are likely to have customized
since a previous installation.

When the upgrade procedure tells you that the upgrade is complete, do not
reboot the system yet.

It is STRONGLY advised that you unpack the etc{:--:}OSrev.tgz set in
a temporary directory and merge changes by hand, since all components of
your system may not function correctly until your files in `/etc' are
updated.

After the upgrade is completed, it is possible to remove the old a.out
shared libraries from their initial locations:

  rm -f $(file $(find $(< /root/a.out-libdirs) -name "lib*.so.*") |
    awk -F: '/demand paged/ { print $1 }')
  rm -f /root/a.out-libdirs
@


1.23
log
@grammar, consistency fixes, and typos;
ok miod@@
@
text
@d1 1
a1 1
dnl	$OpenBSD: upgrade,v 1.22 2003/11/10 22:11:35 espie Exp $
d4 18
a21 14
Due to the change from a.out to ELF binary format in OpenBSD OSREV,
upgrades can be a complex, delicate process. The best solution, whenever
possible, is to back up your data and reinstall from scratch.

The second best solution is to remove all ports, third party programs and
libraries installed on your system; upgrade; and then add ELF versions of
the removed files.

In all cases, once you start the upgrade you MUST complete it. If the
upgrade process fails, or is abandoned before it completes, you will almost
certainly be left with a non-functional system.

Finally, you cannot use the bsd.rd kernel to upgrade the system. The
existing bootblocks on your system cannot boot the OSREV bsd.rd.
d78 2
a79 2
The upgrade is now possible. Boot from the CD-ROM or an installation
floppy, as you would do for a new installation. 
d88 1
a88 1
From then, the upgrade procedure is very close to the installation
d97 1
a97 1
However, it is strongly advised that you unpack the etc{:--:}OSrev.tgz set in
d102 1
a102 1
After the upgrade is completed, it is now possible to remove the old a.out
@


1.22
log
@typos are my friend.
@
text
@d1 1
a1 1
dnl	$OpenBSD: upgrade,v 1.21 2003/11/10 21:23:20 miod Exp $
d6 1
a6 1
possible, is to backup your data and reinstall from scratch.
d13 1
a13 1
upgrade process fails or is abandoned before it completes you will almost
d32 1
a32 1
set up. It needs to be put inside a /emul/a.out hierarchy. This directory can,
@


1.21
log
@A futile attempt to make very clear that, for upgrades to work, you really
need to enable a.out emulation first. Although this warning section USES
A FEW ALL CAPS WORDS, it is likely to be skipped by the hasty user.
@
text
@d1 1
a1 1
dnl	$OpenBSD: upgrade,v 1.20 2003/09/09 22:03:56 miod Exp $
d68 1
a68 1
will refer to existinng a.out binaries. DO NOT UPGRADE YOUR SYSTEM UNLESS
d71 1
a71 1
possible do disable a.out emulation.
@


1.20
log
@Improve the upgrade helper scripts, which should now be tricky enough to
scare anyone from upgrading, but then perform what they are supposed to do,
contrary to the previous, simpler version which had issues.

Joint effort by drahn@@ and I.
@
text
@d1 1
a1 1
dnl	$OpenBSD: upgrade,v 1.19 2003/09/07 12:01:56 krw Exp $
d65 8
@


1.19
log
@i386: Some more verbiage around i386 a.out -> ELF upgrades.

Sparc64: Mention Blade 100 problems with upgrading over the network vs
non-serial console.

ok miod@@.
@
text
@d1 1
a1 1
dnl	$OpenBSD: upgrade,v 1.18 2003/09/07 00:21:47 miod Exp $
d5 1
a5 1
upgrades can be a complex, delicate process.  The best solution, whenever
d24 1
a24 1
OSREV system while preserving the functioning of a.out binaryies are:
d32 1
a32 1
setup. It needs to be put inside a /emul/a.out hierarchy. This directory can,
d36 3
d42 9
a50 2
   mkdir -p /emul/a.out/sbin /emul/a.out/var/run
   tar cf - `/sbin/ldconfig -r | awk '/=>/ { print $3 }'` |
a51 1
   cp -p /sbin/ldconfig /emul/a.out/sbin
d56 1
a56 6
   for lib in `/sbin/ldconfig -r |
       awk '/=>/ { printf("/emul/a.out%s\n", $3"); }'`;
   do
       dirname $lib;
   done | sort | uniq > /root/a.out-newlibdirs
   /sbin/ldconfig -s `cat /root/a.out-newlibdirs`
a58 7
   rm -f /root/a.out-newlibdirs

Finally, it is a good idea to keep a list of the various shared libraries
which have been copied to the /emul/a.out hierarchy, as they will need to
be removed after the upgrade is completed:

  /sbin/ldconfig -r | awk '/=>/ { print $3 }' > /root/a.out-sharedlibs
d74 1
a74 1
new system in.  It will also use your existing network parameters.
d77 1
a77 1
procedure described earlier in this document.  Note that the upgrade
d93 3
a95 2
  rm -f `cat /root/a.out-sharedlibs`
  rm -f /root/a.out-sharedlibs
@


1.18
log
@Wording; Martin Reindl
@
text
@d1 1
a1 1
dnl	$OpenBSD: upgrade,v 1.17 2003/09/06 22:22:43 miod Exp $
d4 2
a5 2
Due to the change in binary format from a.out to ELF in OpenBSD OSREV,
upgrades, albeit possible, are very tricky.  The best solution, whenever
d8 17
a24 2
The two main hurdles in the upgrade from an a.out system to an ELF OpenBSD
OSREV system are:
@


1.17
log
@MD Installation notes updates for 3.4, 1/3

This mainly includes an hopefully helpful section about i386 upgrades, which
I urge knowledgeable people and native english speakers to check out, in
order to polish it soon enough.
@
text
@d1 1
a1 1
dnl	$OpenBSD$
d21 1
a21 1
The /emul/a.out should be populated by the a.out shared libraries.
@


1.16
log
@- fix a few typos in the hardware list and update it
- doesn't shout, improve style a bit
- mention you can boot from cd-rom. Really. Yes you can.
- don't support upgrades from prehistoric versions (< 2.0), so don't babble
  about the partition ID change or the so-called new shared libraries
- get more text sync'ed with other arches
And with the help of mickey@@
- don't mention you can install over NFS, none of the floppies or the cd-rom
  has nfs support

Thanks to mickey@@ for insightful feedback
@
text
@d1 82
a82 2
OpenBSDUpgrade({:-the CD-ROM or an installation floppy as you would do for
a new installation-:})
@


1.15
log
@Update supported hardware list, fix typos, use m4.common macros
whenever possible, remove obsolete information, etc.

ok fries@@
@
text
@d1 2
a2 132
NOTE! If you are going to do the upgrade manually, you MUST use the "-r"
flag when invoking disklabel(8).  You MUST also change the partition table
such that partition 'c' encompasses the entire drive, and not only the
OpenBSD partition.  Finally, partition 'd' is no longer special and can be
used for any purpose whatsoever.

Also, OpenBSD now uses partition ID 0xA6 (166 decimal), but will continue
to work with 0xA5 for compatibility reasons.  However, if you change the
partition ID to 0xA6, you will be able to share the disk with 386BSD,
FreeBSD or NetBSD. Note that the latter three can NOT easily share the disk
with each other.

To do the upgrade, you must have the floppy{:--:}OSrev.fs floppy image on a disk.
You must also have at least the "base{:--:}OSrev" and "bsd" binary distribution set
available, so that you can upgrade with it, using one of the upgrade
methods described above.  Finally, you must have sufficient disk space
available to install the new binaries.  Since the old binaries are being
overwritten in place, you only need space for the new binaries, which
weren't previously on the system.  If you have a few megabytes free on each
of your root and /usr partitions, you should have enough space.

Since upgrading involves replacing the boot blocks on your OpenBSD
partition, the kernel, and most of the system binaries, it has the
potential to cause data loss.  You are strongly advised to BACK UP ANY
IMPORTANT DATA ON YOUR DISK, whether on the OpenBSD partition or on another
operating system's partition, before beginning the upgrade process.

  To upgrade your system, follow the following instructions:

	Boot your machine using of the floppy{:--:}OSrev.fs floppy.  When presented
	with the boot prompt (the "boot>" prompt), hit return.

	While booting, you will probably see several warnings.  You should
	be warned that no swap space is present.  Do not be alarmed,
	these are completely normal.  When you reach the prompt asking
	you for a shell name, just hit return.
	
	You will be presented with a welcome message and a prompt.  If you
	are upgrading from a pre-OpenBSD 1.0 release, you should upgrade
	your file systems manually now, using "fsck -c 2".  Read the
	fsck(8) manual page for more details.
	
	Now you will be asked whether you wish to do an "install" or an
	"upgrade".  Enter 'u' to upgrade your existing installation.  You
	will be presented with some information about the upgrade process
	and a warning message, and will be asked if you wish to proceed
	with the upgrade process.  If you answer negatively, the upgrade
	process will stop, and your disk will not be modified.  If you
	answer affirmatively, the upgrade process will begin, and your disk
	will be modified.  You may hit Control-C to stop the upgrade
	process at any time.  However, if you hit it at an inopportune
	moment, your system may be left in an inconsistent (and possibly
	unusable) state.
	
	You will be asked which terminal type to use, you should just hit
	return to select the default (pcvt25).

	The upgrade program will then tell you which disks of that type it
	can upgrade, and ask you which it should use.  The name of the disk
	is typically "wd0" for IDE/RLL/ESDI/ST506 drives or "sd0" for SCSI
	drives.  Reply with the name of your disk.
	
	The upgrade program will then ask you for the partition which
	contains the root file system and proceed with checking it.  It
	will then mount your root file system on /mnt.
	
	After all your root file system has been mounted, the upgrade
	program will ask you if you want to enable the network.  If you
	answer affirmatively, the configuration stored on the root file
	system will be used.  After this you will be given the opportunity
	to escape to the command shell to do any additional network
	configuration.  This may {:-include-:} adding or altering routes, if
	needed.
	
	At the next point you can edit the fstab, which is used for the
	upgrade process.  You may need to resolve dependencies in the order
	in which the file systems are mounted.  All partitions will be
	checked and mounted under /mnt.  In other words, your root
	partition will be mounted on /mnt, your /usr partition on /mnt/usr,
	etc.

	You will be asked if the upgrade sets are already on the mounted
	file systems.  If you answer with yes, you can type in the path
	where the sets are stored.  The upgrade then continues with the
	procedure described in the paragraph "Common file system
	installations" in the install section of this document.

	If you don't already have the OpenBSD distribution sets on your
	disk, look at the installation section of this document for
	information on how to go on.  Your options are to install via FTP,
	via HTTP, via nfs, from tape, from CD-ROM or, again, from local
	disk.  But remember to not install the "etc{:--:}OSrev" distribution file!

  Your system has now been upgraded to OpenBSD OSREV.

	After rebooting your machine is a complete OpenBSD OSREV system.
	However, that doesn't mean that you're finished with the upgrade
	process.  There are several things that you should do, or might
	have to do, to insure that the system works properly.

	First, you will probably want to get the etc{:--:}OSrev distribution,
	extract it to a temporary location, and compare its contents with
	those in your /etc/ directory.  You will probably want to replace
	some of your system configuration files, or incorporate some of the
	changes in the new versions into yours.

	Second, you will probably want to update the set of device nodes
	you have in /dev.  If you've changed the contents of /dev by hand,
	you will need to be careful about this.  A "MAKEDEV all" was
	already run during the upgrade procedure, so you will have to take
	care about those devices, that are not remade by "MAKEDEV all".

	Third, you must deal with certain changes in the formats of some of
	the configuration files.  The most notable change is that the
	"options" given to many of the file systems in /etc/fstab or by
	hand have changed, and some of the file systems have changed names.
	*IMPORTANT*: ANY INSTANCES OF "ufs" IN /etc/fstab ARE CHANGED TO
	"ffs" BY THE UPGRADE PROGRAM. To find out what the new options are,
	it's suggested that you read the manual page for the file systems'
	mount commands, for example mount_nfs(8) for NFS. (Note that the
	information for mounts of type "ffs", i.e.  Fast File Systems, are
	contained in the mount(8) man page.)

	Finally, you will want to delete old binaries that were part of the
	version of OpenBSD that you upgraded from and have since been
	removed from the OpenBSD distribution.  If you are upgrading from a
	pre-1.0 OpenBSD, you might also want to recompile any locally-built
	binaries, to take advantage of the shared libraries.  (Note that
	any new binaries that you build will be dynamically linked, and
	therefore take advantage of the shared libraries, by default.  For
	information on how to make statically linked binaries, see the
	cc(1) and ld(1) manual pages.)
@


1.14
log
@s/cpp/m4/g
@
text
@d34 3
a36 4
	be warned that no swap space is present, and that init(8) cannot
	find /etc/rc.  Do not be alarmed, these are completely normal.
	When you reach the prompt asking you for a shell name, just hit
	return.
@


1.13
log
@more cleanup; hgweigand@@wiesbaden.netsurf.de
@
text
@d13 2
a14 2
To do the upgrade, you must have the floppy23.fs floppy image on a disk.
You must also have at least the "base23" and "bsd" binary distribution set
d30 1
a30 1
	Boot your machine using of the floppy23.fs floppy.  When presented
d73 1
a73 1
	configuration.  This may include adding or altering routes, if
d85 1
a85 1
	where the sets are stored.  The upgrade then contiues with the
d93 1
a93 1
	disk.  But remember to not install the "etc23" distribution file!
d95 1
a95 1
  Your system has now been upgraded to OpenBSD 2.3.
d97 1
a97 1
	After rebooting your machine is a complete OpenBSD 2.3 system.
d102 1
a102 1
	First, you will probably want to get the etc23 distribution,
@


1.12
log
@fixes from hgweigand@@wiesbaden.netsurf.de
@
text
@d1 1
a1 1
+ NOTE! If you are going to do the upgrade manually, you MUST use the "-r"
d97 3
a99 3
	After rebooting your machine is a complete OpenBSD 2.3 system.  
	However, that doesn't mean that you're finished with the upgrade 
	process.  There are several things that you should do, or might 
@


1.11
log
@23
@
text
@d1 20
a20 22
NOTE!  If you are going to do the upgrade manually, you MUST use the
"-r" flag when invoking disklabel(8).  You MUST also change the
partition table such that partition 'c' encompasses the entire drive,
and not only the OpenBSD partition.  Finally, partition 'd' is no
longer special and can be used for any purpose whatsoever.

Also, OpenBSD now uses partition ID 0xA6 (166 decimal), but will
continue to work with 0xA5 for compatibility reasons.  However, if
you change the partition ID to 0xA6, you will be able to share the
disk with 386BSD, FreeBSD or NetBSD.  Note that the latter three can
NOT easily share the disk with each other.

To do the upgrade, you must have the appropriate kernel-copy floppy
image on a disk, and the floppy23.fs floppy image on another.  You must
also have at least the "base23" binary distribution set available,
so that you can upgrade with it, using one of the upgrade methods
described above.  Finally, you must have sufficient disk space
available to install the new binaries.  Since the old binaries are
being overwritten in place, you only need space for the new binaries,
which weren't previously on the system.  If you have a few megabytes
free on each of your root and /usr partitions, you should have enough
space.
d25 63
a87 49
IMPORTANT DATA ON YOUR DISK, whether on the OpenBSD partition or on
another operating system's partition, before beginning the upgrade
process.

To upgrade your system, follow the following instructions:

	Boot your machine using of the appropriate kernel-copy floppy.
	When presented with the boot prompt (the "boot>" prompt), hit return.

	You will be prompted to insert a file system floppy.  Remove
	the kernel-copy floppy and insert the upgr23 floppy, then hit
	any key to continue booting.

	While booting, you will probably see several warnings.  You
	should be warned that no swap space is present, and that
	init(8) cannot find /etc/rc.  Do not be alarmed, these are
	completely normal.  When you reach the prompt asking you for a
	shell name, just hit return, then type 'upgrade'.

	You will be presented with some information about the upgrade
	process and a warning message, and will be asked if you wish
	to proceed with the upgrade process.  If you answer
	negatively, the upgrade process will stop, and your disk will
	not be modified.  If you answer affirmatively, the upgrade
	process will begin, and your disk will be modified.  You may
	hit Control-C to stop the upgrade process at any time.
	However, if you hit it at an inopportune moment, your system
	may be left in an inconsistent (and possibly unusable) state.

	You may be asked if you wish to upgrade your file systems to
	the new file system format.  If you do, reply affirmatively.
	If you don't have your file systems upgraded now, you should
	probably do it manually after the install process is complete,
	by using "fsck -c 2". Read the fsck(8) manual page for more
	details. Note that this step is only important when upgrading
        from a pre-OpenBSD 1.0 release.

	The upgrade program will then check your root file system,
	and, if you approved, will upgrade it to the new file system
	format.  It will then mount your root file system on /mnt.

	If your file systems are being upgraded, the upgrade script
	will copy the new fsck(8) program to your hard disk and
	upgrade your remaining file systems.

	The upgrade program will then automatically replace the boot
	blocks on your disk with newer versions, and mount all of your
	file systems under /mnt.  (In other words, your root partition
	will be mounted on /mnt, your /usr partition on /mnt/usr, etc.)
d90 44
a133 117
	disk, look in the installation section for information on how
	to transfer them to your disk.

	If you have only one floppy drive, and don't have the disk
	space to copy all of the distribution onto the hard drive, you
	can do the following:

		Install a kernel on the hard drive as detailed a few
		paragraphs below, then boot off the hard drive.  Now
		you can copy and install distribution sets
		incrementally from your lone floppy drive.

	Once the distribution sets are transferred to your disk,
	continue here.  (Obviously, if the OpenBSD distribution sets
	are already on your disk, because you've transferred them
	before starting the upgrade process, you don't need to
	transfer them again now!)

	After the software has been transferred to the machine (or
	mounted, in the case of upgrading via NFS), change into the
	directory containing the "base23" distribution set.  Once you
	are there, run the "Set_tmp_dir" command, and hit return at
	the prompt to select the default answer for the temporary
	directory's path name.  (It should be the path name of the
	directory that you're in.)

	Run the command "Extract base23" to upgrade the base
	distribution.

	Repeat the above two steps for all of the sets you wish to
	upgrade.  (For each, change into the directory containing the
	set, run "Set_tmp_dir" and accept the default path name, then
	run the "Extract <setname>" command.)

	If you were previously using the security distribution set,
	you MUST upgrade to the new version, or you will not be able
	to log in when the upgrade process is complete.  Similarly, if
	you were not previously using the security set, you must NOT
	upgrade to the new version.

	When you are done upgrading all of the distribution sets you
	wish to upgrade, issue the command "Cleanup".  It will clean
	up the installation, by remaking some system databases.  When
	it is complete, you should use "halt" to halt the system.

	When the system is halted, remove the "upgr23" floppy from
	the floppy drive, and replace it with the OpenBSD 2.3
	kernel-copy floppy that you previously booted from. Reboot
	with that floppy.

	Once again, you will be prompted to insert a file system
	floppy.  DO NOT replace the kernel-copy floppy, just hit any
	key.

	Again, While booting, you may see several warnings.  You may
	be warned that no swap space is present, that init(8) cannot
	find /etc/rc, and that one or more databases with names like
	"pwd.db" cannot be found.  Do not be alarmed, as, again, these
	are completely normal.  Hit return at the prompt asking you
	for a shell name.

	You will be presented with a shell prompt, at which you should
	enter the "copy_kernel" command.  It will ask you what
	partition to copy the kernel to, and you should reply with the
	name of your root partition (e.g. sd0a or wd0a).

	You will be asked if you are sure that you want to copy the
	kernel.  Reply affirmatively, and it will check the file
	system on your root partition, mount it, and copy the kernel.
	Once the kernel is copied, you should use "halt" to halt the
	system.

	Once the system is halted, remove the kernel-copy floppy from
	the floppy disk drive, and hit any key to reboot.

Your system has now been upgraded to OpenBSD 2.3.

        After a new kernel has been copied to your hard disk, your
	machine is a complete OpenBSD 2.3 system.  However, that
	doesn't mean that you're finished with the upgrade process.
	There are several things that you should do, or might have to
	do, to insure that the system works properly.

	Second, you will probably want to get the etc23 distribution,
	extract it, and compare its contents with those in your /etc/
	directory.  You will probably want to replace some of your
	system configuration files, or incorporate some of the changes
	in the new versions into yours.

	Third, you will probably want to update the set of device
	nodes you have in /dev.  If you've changed the contents of
	/dev by hand, you will need to be careful about this, but if
	not, you can just cd into /dev, and run the command "sh
	MAKEDEV all".

	Fourth, you must deal with certain changes in the formats of
	some of the configuration files.  The most notable change is
	that the "options" given to many of the file systems in
	/etc/fstab or by hand have changed, and some of the file
	systems have changed names. *IMPORTANT*: ANY INSTANCES OF "ufs"
        IN /etc/fstab MUST BE CHANGED TO "ffs".  To find out what the
        new options are, it's suggested that you read the manual page
        for the file systems' mount commands, for example mount_nfs(8)
        for NFS.  (Note that the information for mounts of type "ffs",
	i.e. Fast File Systems, are contained in the mount(8) man
	page.)

	Finally, you will want to delete old binaries that were part
	of the version of OpenBSD that you upgraded from and have since
	been removed from the OpenBSD distribution.  If you are
        upgrading from a pre-1.0 OpenBSD, you might also
	want to recompile any locally-built binaries, to take
	advantage of the shared libraries.  (Note that any new
	binaries that you build will be dynamically linked, and
	therefore take advantage of the shared libraries, by default.
	For information on how to make statically linked binaries,
	see the cc(1) and ld(1) manual pages.)
@


1.10
log
@moving to 2.3
@
text
@d14 2
a15 2
image on a disk, and the floppy22.fs floppy image on another.  You must
also have at least the "base22" binary distribution set available,
d37 1
a37 1
	the kernel-copy floppy and insert the upgr22 floppy, then hit
d98 1
a98 1
	directory containing the "base22" distribution set.  Once you
d104 1
a104 1
	Run the command "Extract base22" to upgrade the base
d123 1
a123 1
	When the system is halted, remove the "upgr22" floppy from
d161 1
a161 1
	Second, you will probably want to get the etc22 distribution,
@


1.9
log
@typos.
@
text
@d124 1
a124 1
	the floppy drive, and replace it with the OpenBSD 2.2
d153 1
a153 1
Your system has now been upgraded to OpenBSD 2.2.
d156 1
a156 1
	machine is a complete OpenBSD 2.2 system.  However, that
@


1.8
log
@21 -> 22
@
text
@d11 1
a11 1
NOT easily share the disk with each others.
d14 2
a15 2
image on a disk, and the upgr20.fs floppy image on another.  You must
also have at least the "base20" binary distribution set available,
d34 1
a34 2
	When presented with the boot prompt (the prompt begins with
	"Boot" and ends with ":-"), hit return.
d37 1
a37 1
	the kernel-copy floppy and insert the upgr20 floppy, then hit
d44 1
a44 1
	shell name, just hit return.
d98 1
a98 1
	directory containing the "base20" distribution set.  Once you
d104 1
a104 1
	Run the command "Extract base20" to upgrade the base
d123 1
a123 1
	When the system is halted, remove the "upgr20" floppy from
d161 1
a161 1
	Second, you will probably want to get the etc20 distribution,
@


1.7
log
@2.1, needs more work
@
text
@d125 1
a125 1
	the floppy drive, and replace it with the OpenBSD 2.1
d154 1
a154 1
Your system has now been upgraded to OpenBSD 2.1.
d157 1
a157 1
	machine is a complete OpenBSD 2.1 system.  However, that
@


1.6
log
@Note changed partition ID
@
text
@d125 1
a125 1
	the floppy drive, and replace it with the OpenBSD 2.0
d154 1
a154 1
Your system has now been upgraded to OpenBSD 2.0.
d157 1
a157 1
	machine is a complete OpenBSD 2.0 system.  However, that
@


1.5
log
@Warn about changed all-disk partition and updating boot blocks
@
text
@d7 6
@


1.4
log
@first cut
@
text
@d1 6
d51 1
a51 1
	You will be asked if you wish to upgrade your file systems to
@


1.3
log
@Did some s/NetBSD/OpenBSD/, s/netbsd/bsd/ and $OpenBSD$ additions.
However this stuff is largely related to NetBSD and must be completely
redone, if we will make real relases sometime
@
text
@a0 7
The upgrade to OpenBSD 1.1 is a binary upgrade; it would be prohibitive
to make users upgrade by compiling and installing the 1.1 sources, and
it would be very difficult to even compile a set of instructions that
allowed them to do so.  Because of the many changes to the system, it
is difficult impractical to upgrade by recompiling from the sources
and installing.

d2 2
a3 2
image on a disk, and the upgr11.fs floppy image on another.  You must
also have at least the "base11" binary distribution set available,
d26 1
a26 1
	the kernel-copy floppy and insert the upgr11 floppy, then hit
d87 1
a87 1
	directory containing the "base11" distribution set.  Once you
d93 1
a93 1
	Run the command "Extract base11" to upgrade the base
d112 2
a113 2
	When the system is halted, remove the "upgr11" floppy from
	the floppy drive, and replace it with the OpenBSD 1.1
d142 1
a142 1
Your system has now been upgraded to OpenBSD 1.1.
d145 1
a145 1
	machine is a complete OpenBSD 1.1 system.  However, that
d150 1
a150 7
	First, if you did not upgrade your file systems to the new
	file system format during the upgrade process, and you are
        upgrading from a pre-1.0 OpenBSD, you may want to do so now,
        with "fsck -c 2".  If you are unsure about the process, it's
        suggested that you read the fsck(8) manual page.

	Second, you will probably want to get the etc11 distribution,
@


1.2
log
@update from netbsd
@
text
@d1 1
a1 1
The upgrade to NetBSD 1.1 is a binary upgrade; it would be prohibitive
d19 1
a19 1
Since upgrading involves replacing the boot blocks on your NetBSD
d22 1
a22 1
IMPORTANT DATA ON YOUR DISK, whether on the NetBSD partition or on
d58 1
a58 1
        from a pre-NetBSD 1.0 release.
d73 1
a73 1
	If you don't already have the NetBSD distribution sets on your
d87 1
a87 1
	continue here.  (Obviously, if the NetBSD distribution sets
d120 1
a120 1
	the floppy drive, and replace it with the NetBSD 1.1
d149 1
a149 1
Your system has now been upgraded to NetBSD 1.1.
d152 1
a152 1
	machine is a complete NetBSD 1.1 system.  However, that
d159 1
a159 1
        upgrading from a pre-1.0 NetBSD, you may want to do so now,
d188 3
a190 3
	of the version of NetBSD that you upgraded from and have since
	been removed from the NetBSD distribution.  If you are
        upgrading from a pre-1.0 NetBSD, you might also
@


1.1
log
@Initial revision
@
text
@d1 2
a2 2
The upgrade to NetBSD 1.0 is a binary upgrade; it would be prohibitive
to make users upgrade by compiling and installing the 1.0 sources, and
d4 3
a6 4
allowed them to do so.  Because of the various changes to the system,
the largest being the 64-bit file size support and shared libraries,
it is impractical to upgrade by recompiling from the sources and
installing.
d9 2
a10 2
image on a disk, and the upgr-10.fs floppy image on another.  You must
also have at least the "base10" binary distribution set available,
d33 1
a33 1
	the kernel-copy floppy and insert the upgr-10 floppy, then hit
d57 2
a58 1
	details.
d94 1
a94 1
	directory containing the "base10" distribution set.  Once you
d100 1
a100 1
	Run the command "Extract base10" to upgrade the base
d119 2
a120 2
	When the system is halted, remove the "upgr-10" floppy from
	the floppy drive, and replace it with the NetBSD 1.0
d149 1
a149 1
Your system has now been upgraded to NetBSD 1.0.
d151 2
a152 2
After a new kernel has been copied to your hard disk, your
	machine is a complete NetBSD 1.0 system.  However, that
d158 4
a161 3
	file system format during the upgrade process, you may want to
	do so now, with "fsck -c 2".  If you are unsure about the
	process, it's suggested that you read the fsck(8) manual page.
d163 1
a163 1
	Second, you will probably want to get the etc10 distribution,
d179 5
a183 4
	systems have changed names.  To find out what the new options
	are, it's suggested that you read the manual page for the
	file systems' mount commands, for example mount_nfs(8) for
	NFS.  (Note that the information for mounts of type "ufs",
d189 2
a190 1
	been removed from the NetBSD distribution.  You might also
@


1.1.1.1
log
@initial import of NetBSD tree
@
text
@@

