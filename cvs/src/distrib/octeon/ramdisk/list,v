head	1.21;
access;
symbols
	OPENBSD_6_0:1.17.0.2
	OPENBSD_6_0_BASE:1.17
	OPENBSD_5_9:1.16.0.2
	OPENBSD_5_9_BASE:1.16
	OPENBSD_5_8:1.16.0.4
	OPENBSD_5_8_BASE:1.16
	OPENBSD_5_7:1.13.0.2
	OPENBSD_5_7_BASE:1.13
	OPENBSD_5_6:1.9.0.4
	OPENBSD_5_6_BASE:1.9
	OPENBSD_5_5:1.8.0.2
	OPENBSD_5_5_BASE:1.8
	OPENBSD_5_4:1.1.0.2
	OPENBSD_5_4_BASE:1.1;
locks; strict;
comment	@# @;


1.21
date	2016.09.17.15.03.39;	author florian;	state Exp;
branches;
next	1.20;
commitid	4iDaUFNgyRvNiP2A;

1.20
date	2016.09.13.22.27.50;	author rpe;	state Exp;
branches;
next	1.19;
commitid	GBnmSiVk0pmscj9y;

1.19
date	2016.09.04.09.54.22;	author rpe;	state Exp;
branches;
next	1.18;
commitid	GShD1XwYMI1YRfdA;

1.18
date	2016.09.03.10.57.12;	author rpe;	state Exp;
branches;
next	1.17;
commitid	pFfkafQ0XO5kSNdx;

1.17
date	2016.04.02.12.23.46;	author rpe;	state Exp;
branches;
next	1.16;
commitid	RiZ3BjQb9aPCOLdl;

1.16
date	2015.04.13.21.27.07;	author deraadt;	state Exp;
branches;
next	1.15;
commitid	XlnjSM8QPyxXBJUX;

1.15
date	2015.04.02.16.13.25;	author deraadt;	state Exp;
branches;
next	1.14;
commitid	xCtdNbyuk86cJEuz;

1.14
date	2015.03.11.15.27.32;	author deraadt;	state Exp;
branches;
next	1.13;
commitid	CiK8k4NfUdHOtlhW;

1.13
date	2015.02.23.08.09.46;	author deraadt;	state Exp;
branches;
next	1.12;
commitid	OJZZR2nB2iwRyEOa;

1.12
date	2014.12.28.04.40.19;	author deraadt;	state Exp;
branches;
next	1.11;
commitid	0Q152diy3j6ZcHnS;

1.11
date	2014.12.27.06.02.01;	author deraadt;	state Exp;
branches;
next	1.10;
commitid	ynzGEyGPUs5Lc7eO;

1.10
date	2014.12.03.20.11.19;	author florian;	state Exp;
branches;
next	1.9;
commitid	BNzpeI3z4QKLCMCf;

1.9
date	2014.07.20.02.37.35;	author deraadt;	state Exp;
branches;
next	1.8;
commitid	Js54FgDjh3ceuvNj;

1.8
date	2014.03.03.07.40.34;	author deraadt;	state Exp;
branches;
next	1.7;

1.7
date	2014.01.19.00.33.40;	author deraadt;	state Exp;
branches;
next	1.6;

1.6
date	2014.01.11.05.40.16;	author deraadt;	state Exp;
branches;
next	1.5;

1.5
date	2014.01.10.07.57.28;	author deraadt;	state Exp;
branches;
next	1.4;

1.4
date	2014.01.09.19.02.04;	author deraadt;	state Exp;
branches;
next	1.3;

1.3
date	2014.01.08.21.53.35;	author deraadt;	state Exp;
branches;
next	1.2;

1.2
date	2014.01.07.02.27.56;	author deraadt;	state Exp;
branches;
next	1.1;

1.1
date	2013.03.26.18.03.53;	author jasper;	state Exp;
branches;
next	;


desc
@@


1.21
log
@ping6(8) is now a hardlink to ping(8).
The instbin stuff looks good to deraadt@@
@
text
@#	$OpenBSD: list,v 1.20 2016/09/13 22:27:50 rpe Exp $

SRCDIRS distrib/special

# copy the crunched binary, link to it, and kill it
COPY	${OBJDIR}/instbin			instbin
LINK	instbin					bin/arch
LINK	instbin					bin/cat
LINK	instbin					bin/chmod bin/chgrp sbin/chown
LINK	instbin					bin/cp
LINK	instbin					bin/date
LINK	instbin					bin/dd
LINK	instbin					bin/df
LINK	instbin					bin/ed
LINK	instbin					bin/hostname
LINK	instbin					bin/ksh bin/sh
ARGVLINK ksh					-sh
LINK	instbin					bin/ln
LINK	instbin					bin/ls
LINK	instbin					bin/md5 bin/sha256 bin/sha512
SPECIAL	rm bin/md5
LINK	instbin					bin/mkdir
LINK	instbin					bin/mt bin/eject
LINK	instbin					bin/mv
LINK	instbin					bin/pax bin/tar
LINK	instbin					bin/rm
LINK	instbin					bin/sleep
LINK	instbin					bin/stty
LINK	instbin					bin/sync
LINK	instbin					sbin/dhclient
LINK	instbin					sbin/disklabel
LINK	instbin					sbin/dmesg
LINK	instbin					sbin/fdisk
LINK	instbin					sbin/fsck
LINK	instbin					sbin/fsck_ffs
LINK	instbin					sbin/ifconfig
LINK	instbin					sbin/init
LINK	instbin					sbin/mknod
LINK	instbin					sbin/mount
LINK	instbin					sbin/mount_cd9660
LINK	instbin					sbin/mount_ffs
LINK	instbin					sbin/mount_msdos
LINK	instbin					sbin/mount_nfs
LINK	instbin					sbin/mount_udf
LINK	instbin					sbin/newfs
LINK	instbin					sbin/newfs_msdos
LINK	instbin					sbin/ping sbin/ping6
LINK	instbin					sbin/reboot sbin/halt
LINK	instbin					sbin/route
LINK	instbin					sbin/sysctl
LINK	instbin					sbin/umount
LINK	instbin					usr/bin/doas
LINK	instbin					usr/bin/encrypt
LINK	instbin					usr/bin/ftp
LINK	instbin					usr/bin/grep usr/bin/egrep usr/bin/fgrep
LINK	instbin					usr/bin/gzip usr/bin/gunzip usr/bin/gzcat
LINK	instbin					usr/bin/more usr/bin/less
LINK	instbin					usr/bin/sed
LINK	instbin					usr/bin/signify
LINK	instbin					usr/sbin/chroot
LINK	instbin					usr/sbin/pwd_mkdb

# copy the MAKEDEV script and make some devices
SCRIPT	${DESTDIR}/dev/MAKEDEV			dev/MAKEDEV
SPECIAL	cd dev; sh MAKEDEV ramdisk

# various files that we need in /etc for the install
COPY	${CURDIR}/../../miniroot/group		etc/group
COPY	${CURDIR}/../../miniroot/master.passwd	etc/master.passwd
SPECIAL	pwd_mkdb -p -d etc master.passwd; rm etc/master.passwd
COPY	${DESTDIR}/etc/signify/openbsd-${REV}-base.pub	etc/signify/openbsd-${REV}-base.pub
COPY	${CURDIR}/../../miniroot/protocols	etc/protocols
COPY	${CURDIR}/../../miniroot/services	etc/services
SYMLINK	/tmp/i/fstab.shadow			etc/fstab
SYMLINK	/tmp/i/resolv.conf.shadow		etc/resolv.conf
SYMLINK	/tmp/i/hosts				etc/hosts
TERMCAP	vt100,vt220,dumb			usr/share/misc/termcap

# firmware we might need
# ...none yet untill USB works.

# and the installation tools
SCRIPT	${CURDIR}/../../miniroot/dot.profile	.profile
SCRIPT	${CURDIR}/install.md			install.md
SCRIPT	${CURDIR}/../../miniroot/install.sub	install.sub
SPECIAL	chmod 755 install.sub
SYMLINK	install.sub				autoinstall
SYMLINK	install.sub				install
SYMLINK	install.sub				upgrade

TZ
@


1.20
log
@Provide a stripped down group file for the install media.
Saves precious 896 bytes as a side effect.

OK deraadt
@
text
@d1 1
a1 1
#	$OpenBSD: list,v 1.19 2016/09/04 09:54:22 rpe Exp $
d47 1
a47 2
LINK	instbin					sbin/ping
LINK	instbin					sbin/ping6
@


1.19
log
@Move files created by root during install/upgrade in a subdir of
/tmp with proper permissions so that unprivileged programs can not
tamper with them.

positive feedback from deraadt
OK halex
@
text
@d1 1
a1 1
#	$OpenBSD: list,v 1.18 2016/09/03 10:57:12 rpe Exp $
d69 1
a69 1
COPY	${DESTDIR}/etc/group			etc/group
@


1.18
log
@Enable a stripped down version of doas(1) on the install media.

OK halex, tb, deraadt
@
text
@d1 1
a1 1
#	$OpenBSD: list,v 1.17 2016/04/02 12:23:46 rpe Exp $
d75 3
a77 3
SYMLINK	/tmp/fstab.shadow			etc/fstab
SYMLINK	/tmp/resolv.conf.shadow			etc/resolv.conf
SYMLINK	/tmp/hosts				etc/hosts
@


1.17
log
@- merge install.sh into install.sub as do_install()
- merge upgrade.sh into install.sub as do_upgrade()
- delete install.sh and upgrade.sh
- make install.sub executable
- turn install and upgrade into symbolic links to install.sub
- add autoinstall symbolic link to install.sub
- change dot.profile to use these symlinks
- introduce a -m option to set MODE in install.sub
- alternativly set MODE and AUTO depending on PROGNAME
- execute the do_{install,upgrade) functions depending on $MODE

OK halex@@, krw@@
'go for it' deraadt@@
@
text
@d1 1
a1 1
#	$OpenBSD: list,v 1.16 2015/04/13 21:27:07 deraadt Exp $
d53 1
@


1.16
log
@pwd_mkdb now fits onto the install media.  no more chroot games.
@
text
@d1 1
a1 1
#	$OpenBSD: list,v 1.15 2015/04/02 16:13:25 deraadt Exp $
a84 2
SCRIPT	${CURDIR}/../../miniroot/upgrade.sh	upgrade
SCRIPT	${CURDIR}/../../miniroot/install.sh	install
d86 4
a89 1
SPECIAL	chmod 755 install upgrade
@


1.15
log
@more -> less; not less -> more
@
text
@d1 1
a1 1
#	$OpenBSD: list,v 1.14 2015/03/11 15:27:32 deraadt Exp $
d61 1
@


1.14
log
@adjust for removal of expr (and while here, sort all these lists, with the
goal of eventually refactoring them)
@
text
@d1 1
a1 1
#	$OpenBSD: list,v 1.12 2014/12/28 04:40:19 deraadt Exp $
d57 1
a57 1
LINK	instbin					usr/bin/less usr/bin/more
@


1.13
log
@expr no longer needed on media, thanks to halex and todd and rpe
@
text
@a8 1
LINK	instbin					bin/date
d11 1
a40 1
LINK	instbin					sbin/mount_udf
d44 1
d55 1
a55 1
LINK	instbin					usr/bin/grep usr/bin/fgrep usr/bin/egrep
d60 1
@


1.12
log
@Build special/encrypt into instbin, to prepare for dropping use of the
version in just installed base.
@
text
@d1 1
a1 1
#	$OpenBSD: list,v 1.11 2014/12/27 06:02:01 deraadt Exp $
a14 1
LINK	instbin					bin/expr
@


1.11
log
@SRCDIRS must now always come from distrib/special.  A few systems
still MD installboot, and we will need to repair those before
release, or force them pure -static use by both base and instbin.
@
text
@d1 1
a1 1
#	$OpenBSD: list,v 1.10 2014/12/03 20:11:19 florian Exp $
d54 1
@


1.10
log
@rtsol(8) is no longer needed on the ramdisks.
OK deraadt@@
@
text
@d1 1
a1 1
#	$OpenBSD: list,v 1.9 2014/07/20 02:37:35 deraadt Exp $
a3 1
SRCDIRS bin sbin
@


1.9
log
@place sysctl in sorted order; Jean-Philippe Ouellet
@
text
@d1 1
a1 1
#	$OpenBSD: list,v 1.8 2014/03/03 07:40:34 deraadt Exp $
a52 1
LINK	instbin					sbin/rtsol
@


1.8
log
@use official 5.5 key
@
text
@d1 1
a1 1
#	$OpenBSD: list,v 1.7 2014/01/19 00:33:40 deraadt Exp $
d54 1
a60 1
LINK	instbin					sbin/sysctl
@


1.7
log
@we no long use the /var/hash files, but rely on the SHA256.sig file.
We can remove the hashing support.
@
text
@d1 1
a1 1
#	$OpenBSD: list,v 1.6 2014/01/11 05:38:13 deraadt Exp $
d71 1
a71 1
COPY	${DESTDIR}/etc/signify/${REV}base.pub	etc/signify/${REV}base.pub
@


1.6
log
@No need for a bin/cpio link on the media, because the pax|tar binary does
not support cpio anymore.
@
text
@d1 1
a1 1
#	$OpenBSD: list,v 1.5 2014/01/10 07:57:28 deraadt Exp $
a89 1
HASH	var/hash
@


1.5
log
@remove md5 after installing it (with the links to the sha256/512 commands).
this is because the md5/sha256/sha512 are in the same binary, found in the
md5 directory, but the version on the media lacks md5 support.  Understand?
@
text
@d1 1
a1 1
#	$OpenBSD: list,v 1.4 2014/01/09 19:02:04 deraadt Exp $
d27 1
a27 1
LINK	instbin					bin/pax bin/tar bin/cpio
@


1.4
log
@copy the relevant key for the release onto the media
@
text
@d1 1
a1 1
#	$OpenBSD: list,v 1.3 2014/01/08 21:53:35 deraadt Exp $
d23 1
@


1.3
log
@Switch to using the base sha256 command, rather than some customized
abomination.
install.sub chunk tested by rpe
@
text
@d1 1
a1 1
#	$OpenBSD: list,v 1.2 2014/01/07 02:27:56 deraadt Exp $
d70 1
@


1.2
log
@SRCDRS usr.bin usr.sbin is a bad idea (because of PIE).  The places we
pick binaries up must be compiled -static or at least in some safe
model for reuse.  Since we now use distrib/special for those, we can
safely remove usr.bin and usr.sbin from this list.
@
text
@d1 1
a1 1
#	$OpenBSD: list,v 1.1 2013/03/26 18:03:53 jasper Exp $
d22 1
a27 1
LINK	instbin					bin/sha256
d60 1
@


1.1
log
@add ramdisk installer for octeon, still has some rough edges and needs some
manual fiddling, but works good enough to perform an install on the CAM-0100.
@
text
@d1 1
a1 1
#	$OpenBSD$
d4 1
a4 1
SRCDIRS bin sbin usr.bin usr.sbin
@

