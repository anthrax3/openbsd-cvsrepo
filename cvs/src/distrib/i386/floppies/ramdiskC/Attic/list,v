head	1.8;
access;
symbols
	OPENBSD_3_0:1.5.0.2
	OPENBSD_3_0_BASE:1.5
	OPENBSD_2_9:1.2.0.2
	OPENBSD_2_9_BASE:1.2;
locks; strict;
comment	@# @;


1.8
date	2002.03.30.20.35.31;	author millert;	state dead;
branches;
next	1.7;

1.7
date	2001.12.17.00.41.51;	author krw;	state Exp;
branches;
next	1.6;

1.6
date	2001.12.13.01.40.15;	author krw;	state Exp;
branches;
next	1.5;

1.5
date	2001.08.23.02.37.02;	author krw;	state Exp;
branches;
next	1.4;

1.4
date	2001.08.17.13.58.21;	author krw;	state Exp;
branches;
next	1.3;

1.3
date	2001.06.23.19.44.43;	author deraadt;	state Exp;
branches;
next	1.2;

1.2
date	2001.04.19.02.17.33;	author deraadt;	state Exp;
branches;
next	1.1;

1.1
date	2001.04.09.06.55.40;	author deraadt;	state Exp;
branches;
next	;


desc
@@


1.8
log
@o Add support for local list and crunch files so ramdiskC and ramdisk_cd
can include wicontrol and ancontrol.
o Rename instbin.conf to crunch.conf
o Remove the custom list and crunch files from ramdiskC (no longer needed).
@
text
@#	$OpenBSD: list,v 1.7 2001/12/17 00:41:51 krw Exp $

# copy the crunched binary, link to it, and kill it
COPY	${OBJDIR}/instbin	instbin
LINK	instbin			bin/cat
LINK	instbin			bin/chmod
LINK	instbin			bin/chgrp
LINK	instbin			bin/cp
LINK	instbin			bin/cpio bin/pax bin/tar
LINK	instbin			bin/dd
LINK	instbin			bin/df
LINK	instbin			bin/ed
LINK	instbin			bin/ln
LINK	instbin			bin/ls
LINK	instbin			bin/mkdir
LINK	instbin			bin/mv
LINK	instbin			bin/rm
LINK	instbin			bin/hostname
LINK	instbin			bin/sh bin/ksh
LINK	instbin			bin/sleep
LINK	instbin			bin/stty
LINK	instbin			sbin/chown
LINK	instbin			sbin/disklabel
LINK	instbin			sbin/dhclient
LINK	instbin			sbin/wicontrol
LINK	instbin			sbin/ancontrol
LINK	instbin			sbin/fdisk
LINK	instbin			sbin/dmesg
LINK	instbin			sbin/fsck sbin/fsck_ffs
LINK	instbin			sbin/halt sbin/reboot
LINK	instbin			sbin/ifconfig
LINK	instbin			sbin/init
LINK	instbin			sbin/mknod
LINK	instbin			sbin/mount
LINK	instbin			sbin/mount_cd9660
LINK	instbin			sbin/mount_ffs
LINK	instbin			sbin/mount_msdos
LINK	instbin			sbin/mount_ext2fs
LINK	instbin			sbin/ping
LINK	instbin			sbin/newfs
LINK	instbin			sbin/restore
LINK	instbin			sbin/route
#LINK	instbin			sbin/scsi
#LINK	instbin			sbin/swapon
LINK	instbin			sbin/umount
LINK	instbin			usr/bin/egrep usr/bin/fgrep usr/bin/grep
LINK	instbin			usr/bin/ftp
LINK	instbin			usr/bin/gzip usr/bin/gunzip usr/bin/gzcat
LINK	instbin			usr/bin/less usr/bin/more
LINK	instbin			usr/bin/rsh
LINK	instbin			usr/bin/sed
LINK	instbin			usr/mdec/installboot
SPECIAL	/bin/rm instbin

# `internal' crunchgen links
ARGVLINK sh		-sh

# copy the MAKEDEV script and make some devices
COPY	${DESTDIR}/dev/MAKEDEV	dev/MAKEDEV
SPECIAL	cd dev; sh MAKEDEV ramdisk
SPECIAL	/bin/rm dev/MAKEDEV

# we need the contents of /usr/mdec
COPY	${DESTDIR}/usr/mdec/biosboot	usr/mdec/biosboot
COPY	${DESTDIR}/usr/mdec/mbr		usr/mdec/mbr
COPY	${DESTDIR}/usr/mdec/boot	usr/mdec/boot

# various files that we need in /etc for the install
COPY	${DESTDIR}/etc/group		etc/group
COPY	${DESTDIR}/etc/spwd.db		etc/spwd.db
COPY	${DESTDIR}/etc/disktab		etc/disktab.shadow
COPY	${CURDIR}/../../../miniroot/protocols etc/protocols
COPY	${CURDIR}/../../../miniroot/services  etc/services
SYMLINK	/tmp/disktab.shadow		etc/disktab
SYMLINK	/tmp/fstab.shadow		etc/fstab
SYMLINK	/tmp/resolv.conf.shadow		etc/resolv.conf
SYMLINK	/tmp/hosts			etc/hosts

# dhcp things
COPY	${DESTDIR}/sbin/dhclient-script sbin/dhclient-script

# and the common installation tools
COPY	${CURDIR}/../common/termcap.vt		usr/share/misc/termcap
#COPY	${DESTDIR}/usr/share/misc/scsi_modes	usr/share/misc/scsi_modes

# and the installation tools
SPECIAL sed -e '/^[ 	]*#[ 	].*$/d' -e '/^[ 	]*#$/d' < ${CURDIR}/../common/dot.profile	 > .profile
SPECIAL sed -e '/^[ 	]*#[ 	].*$/d' -e '/^[ 	]*#$/d' -e "s/^ARCH=ARCH$/ARCH=`arch -s`/" < ${CURDIR}/../common/install.md	 > install.md
SPECIAL	sed -e '/^[ 	]*#[ 	].*$/d' -e '/^[ 	]*#$/d' < ${CURDIR}/../../../miniroot/upgrade.sh > upgrade
SPECIAL	sed -e '/^[ 	]*#[ 	].*$/d' -e '/^[ 	]*#$/d' < ${CURDIR}/../../../miniroot/install.sh > install
SPECIAL sed -e '/^[ 	]*#[ 	].*$/d' -e '/^[ 	]*#$/d' -e "/^VERSION=/s/=.*/=${REV}/" < ${CURDIR}/../../../miniroot/install.sub > install.sub
SPECIAL	chmod 755 install upgrade
@


1.7
log
@Use actual files for short versions of /etc/protocols and
/etc/services used during installations.

This way it is not necessary to run the install script before
using commands requiring these files.

Requested by deraadt@@.
@
text
@d1 1
a1 1
#	$OpenBSD: list,v 1.6 2001/12/13 01:40:15 krw Exp $
@


1.6
log
@Remove /etc/protocols and /etc/services from install media
that use the miniroot install scripts.

During an install, donetconfig() in miniroot/install.sub now
creates a minimal /etc/protocols and /etc/services.

During an upgrade, enable_network() now copies the existing
protocols and services files into /etc.

Saves approximately 13K on floppy/cd images.
@
text
@d1 1
a1 1
#	$OpenBSD: list,v 1.5 2001/08/23 02:37:02 krw Exp $
d72 2
@


1.5
log
@Expand regular expressions used in sed invocations in SPECIAL lines to
find and delete more comments from scripts put on floppy images.

Now, leading whitespace and no trailing characters are both detected
and either cause the comment line to be deleted.

Fix list2sh.awk so that the tabs in the sed statements are not lost
during script creation. Previously the remainder of the SPECIAL line,
i.e. the shell statement to write, was recreated from the fields, but
awk treated the <blank><tab> in the sed expression as a field
separator and discarded the blank and tab. The blank was then added
back in the recreation process, but the tab was lost.

These changes cause the scripts to shrink by a total of 6596
characters.

This handles the i386 cases, other architectures can probably be fixed
the same way.
@
text
@d1 1
a1 1
#	$OpenBSD: list,v 1.4 2001/08/17 13:58:21 krw Exp $
a69 2
COPY	${DESTDIR}/etc/protocols	etc/protocols
COPY	${DESTDIR}/etc/services		etc/services
@


1.4
log
@Make floppyC29.fs installable again.

With kernfs gone, dmesg must be compiled into the image. Also
add hostname as in ../common/*.

Encountered by George Shaffer. ok deraadt@@.
@
text
@d1 1
a1 1
#	$OpenBSD: list,v 1.3 2001/06/23 19:44:43 deraadt Exp $
d87 5
a91 5
SPECIAL sed -e '/^#[ 	].*$/d' < ${CURDIR}/../common/dot.profile	 > .profile
SPECIAL sed -e '/^#[ 	].*$/d' < ${CURDIR}/../common/install.md	 > install.md
SPECIAL	sed -e '/^#[ 	].*$/d' < ${CURDIR}/../../../miniroot/upgrade.sh > upgrade
SPECIAL	sed -e '/^#[ 	].*$/d' < ${CURDIR}/../../../miniroot/install.sh > install
SPECIAL sed -e '/^#[ 	].*$/d' -e "/^VERSION=/s/=.*/=${REV}/" < ${CURDIR}/../../../miniroot/install.sub > install.sub
@


1.3
log
@argh.  stop using kernfs, using dmesg using sysctl.  encode ARCH into
install.md at build time.  remove some crud.  and the icing on the cake:
skip testing all this until next week
@
text
@d1 1
a1 1
#	$OpenBSD: list,v 1.2 2001/04/19 02:17:33 deraadt Exp $
d18 1
d28 1
@


1.2
log
@strip comments, as on the alpha; millert ok
@
text
@d1 1
a1 1
#	$OpenBSD: list,v 1.1 2001/04/09 06:55:40 deraadt Exp $
a35 1
LINK	instbin			sbin/mount_kernfs
@


1.1
log
@only put wicontrol (and ancontrol now too) on floppyC
@
text
@d1 1
a1 1
#	$OpenBSD: list,v 1.17 2001/03/03 08:13:46 deraadt Exp $
d86 5
a90 5
COPY	${CURDIR}/../common/dot.profile			.profile
COPY	${CURDIR}/../common/install.md			install.md
COPY	${CURDIR}/../../../miniroot/install.sh		install
COPY	${CURDIR}/../../../miniroot/upgrade.sh		upgrade
SPECIAL sed "/^VERSION=/s/=.*/=${REV}/" < ${CURDIR}/../../../miniroot/install.sub > install.sub
@

