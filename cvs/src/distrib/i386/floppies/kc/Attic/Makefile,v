head	1.18;
access;
symbols
	OPENBSD_2_5:1.17.0.8
	OPENBSD_2_5_BASE:1.17
	OPENBSD_2_4:1.17.0.6
	OPENBSD_2_4_BASE:1.17
	OPENBSD_2_3:1.17.0.4
	OPENBSD_2_3_BASE:1.17
	OPENBSD_2_2:1.17.0.2
	OPENBSD_2_2_BASE:1.17
	OPENBSD_2_1:1.15.0.2
	OPENBSD_2_1_BASE:1.15
	OPENBSD_2_0:1.9.0.2
	OPENBSD_2_0_BASE:1.9
	netbsd_1_1:1.1.1.1;
locks; strict;
comment	@# @;


1.18
date	99.08.06.20.49.09;	author deraadt;	state dead;
branches;
next	1.17;

1.17
date	97.09.26.02.09.55;	author millert;	state Exp;
branches;
next	1.16;

1.16
date	97.09.05.21.16.50;	author deraadt;	state Exp;
branches;
next	1.15;

1.15
date	97.05.14.18.38.59;	author niklas;	state Exp;
branches;
next	1.14;

1.14
date	97.05.11.20.01.55;	author millert;	state Exp;
branches;
next	1.13;

1.13
date	97.04.17.02.10.40;	author niklas;	state Exp;
branches;
next	1.12;

1.12
date	97.01.25.09.16.42;	author deraadt;	state Exp;
branches;
next	1.11;

1.11
date	96.12.21.05.20.25;	author deraadt;	state Exp;
branches;
next	1.10;

1.10
date	96.12.20.15.35.55;	author kstailey;	state Exp;
branches;
next	1.9;

1.9
date	96.09.25.17.03.58;	author deraadt;	state Exp;
branches;
next	1.8;

1.8
date	96.09.14.03.43.02;	author deraadt;	state Exp;
branches;
next	1.7;

1.7
date	96.07.01.18.09.16;	author deraadt;	state Exp;
branches;
next	1.6;

1.6
date	96.06.16.11.02.26;	author deraadt;	state Exp;
branches;
next	1.5;

1.5
date	96.06.11.09.04.17;	author deraadt;	state Exp;
branches;
next	1.4;

1.4
date	96.06.02.11.41.40;	author deraadt;	state Exp;
branches;
next	1.3;

1.3
date	96.05.31.23.00.23;	author mickey;	state Exp;
branches;
next	1.2;

1.2
date	95.11.01.17.00.51;	author deraadt;	state dead;
branches;
next	1.1;

1.1
date	95.10.18.08.37.35;	author deraadt;	state Exp;
branches
	1.1.1.1;
next	;

1.1.1.1
date	95.10.18.08.37.35;	author deraadt;	state Exp;
branches;
next	;


desc
@@


1.18
log
@new install media.  floppyXX.fs is the regular one.  floppyBXX.fs contains no
none of the scsi drivers on the first floppy, but others (to be detailed
elsewhere).  bsd.rd is still the one from floppyXX.fs.  finally, cdromXX.fs
is a 2.88MB install, which contains a superset of all these.. to be placed on
the CD.
@
text
@#	$OpenBSD: Makefile,v 1.17 1997/09/26 02:09:55 millert Exp $

TOP=		${.CURDIR}/..

.include "${TOP}/Makefile.inc"
IMAGE=		kc${REV}.fs
CBIN=		kcbin
MOUNT_POINT?=	/mnt
VND?=		svnd0
VND_DEV=	/dev/${VND}a
VND_RDEV=	/dev/r${VND}a
IMAGE?=		xxx-${REV}.fs
PID!=		echo $$$$
REALIMAGE!=	echo /var/tmp/image.${PID}
MDEC=		${DESTDIR}/usr/mdec

LIST=		${.CURDIR}/list
CRUNCHCONF=	${.CURDIR}/${CBIN}.conf
MTREE=		${.CURDIR}/mtree.conf

bsd:
	cd ${.CURDIR}/../../../../sys/arch/i386/conf && config INST
	cd ${.CURDIR}/../../../../sys/arch/i386/compile/INST && \
	    make clean && make
	cp ${.CURDIR}/../../../../sys/arch/i386/compile/INST/bsd bsd
	strip bsd

all: bsd ${CBIN}
.ifndef FLOPPY3
.else
.endif
.ifndef FLOPPY3
	dd if=/dev/zero of=${REALIMAGE} bs=10k count=120
	vnconfig -v -c ${VND} ${REALIMAGE}
	disklabel -w -B -b /usr/mdec/fdboot -s /usr/mdec/bootfd ${VND} floppy5
	newfs -O -m 0 -o space -i 8192 -c 80 ${VND_RDEV}
.else
	dd if=/dev/zero of=${REALIMAGE} bs=10k count=144
	vnconfig -v -c ${VND} ${REALIMAGE}
	disklabel -w -B -b /usr/mdec/fdboot -s /usr/mdec/bootfd ${VND} floppy3
	newfs -O -m 0 -o space -i 6500 -c 80 ${VND_RDEV}
.endif
	mount ${VND_DEV} ${MOUNT_POINT}
	mtree -def ${MTREE} -p ${MOUNT_POINT}/ -u
	TOPDIR=${TOP} CURDIR=${.CURDIR} OBJDIR=${.OBJDIR} \
	    TARGDIR=${MOUNT_POINT} sh ${TOP}/runlist.sh ${LIST}
	@@echo ""
	@@df -i ${MOUNT_POINT}
	@@echo ""
	umount ${MOUNT_POINT}
	vnconfig -u ${VND}
	cp ${REALIMAGE} ${IMAGE}
	rm ${REALIMAGE}

unconfig:
	-umount -f ${MOUNT_POINT}
	-vnconfig -u ${VND}
	-/bin/rm -f ${IMAGE}

${CBIN}.mk ${CBIN}.cache ${CBIN}.c: ${CRUNCHCONF}
	crunchgen -D ${TOP}/../../.. -L ${DESTDIR}/usr/lib ${CRUNCHCONF}

${CBIN}: ${CBIN}.mk ${CBIN}.cache ${CBIN}.c
	make -f ${CBIN}.mk all

clean cleandir:
	/bin/rm -f *.core bsd ${IMAGE} ${CBIN} ${CBIN}.mk ${CBIN}.cache *.o *.lo *.c

install:
	cp ${IMAGE} ${DESTDIR}/snapshot

.include <bsd.obj.mk>
.include <bsd.subdir.mk>
@


1.17
log
@Fix some newfs usage.
@
text
@d1 1
a1 1
#	$OpenBSD: Makefile,v 1.16 1997/09/05 21:16:50 deraadt Exp $
@


1.16
log
@make depend (in this case) is a total waste of time
@
text
@d1 1
a1 1
#	$OpenBSD: Makefile,v 1.15 1997/05/14 18:38:59 niklas Exp $
d36 1
a36 1
	newfs -O -m 0 -o space -i 8192 -c 80 ${VND_RDEV} floppy5
d41 1
a41 1
	newfs -O -m 0 -o space -i 6500 -c 80 ${VND_RDEV} floppy3
@


1.15
log
@Use svnds and remove ugly cache flushing
@
text
@d1 1
a1 1
#	$OpenBSD: Makefile,v 1.14 1997/05/11 20:01:55 millert Exp $
d24 1
a24 1
	    make clean && make depend && make
@


1.14
log
@Build filesystems images in /var/tmp to avoid panic'ing if /tmp is MFS.
@
text
@d1 1
a1 1
#	$OpenBSD: Makefile,v 1.13 1997/04/17 02:10:40 niklas Exp $
d9 1
a9 1
VND?=		vnd0
a51 1
	cat /*bin/* > /dev/null
@


1.13
log
@I had rcs-openbsd.pl have its way here
@
text
@d1 1
a1 1
#	$OpenBSD: Makefile,v 1.12 1997/01/25 09:16:42 deraadt Exp $
d14 1
a14 1
REALIMAGE!=	echo /tmp/image.${PID}
@


1.12
log
@hacks to make it fit, parts by niklas
@
text
@d1 1
a1 1
#	$Id: Makefile,v 1.11 1996/12/21 05:20:25 deraadt Exp $
@


1.11
log
@vnd driver has disklabel support now; use it
@
text
@d1 1
a1 1
#	$Id: Makefile,v 1.10 1996/12/20 15:35:55 kstailey Exp $
d26 1
@


1.10
log
@add fs type arg to newfs
@
text
@d1 1
a1 1
#	$Id: Makefile,v 1.9 1996/09/25 17:03:58 deraadt Exp $
d33 3
a35 3
	disklabel -w -B -b /usr/mdec/fdboot -s /usr/mdec/bootfd ${REALIMAGE} floppy5
	vnconfig -v -c ${VND_DEV} ${REALIMAGE}
	newfs -t ffs -O -m 0 -o space -i 8192 -c 80 ${VND_RDEV} floppy5
d38 3
a40 3
	disklabel -w -B -b /usr/mdec/fdboot -s /usr/mdec/bootfd ${REALIMAGE} floppy3
	vnconfig -v -c ${VND_DEV} ${REALIMAGE}
	newfs -t ffs -O -m 0 -o space -i 6500 -c 80 ${VND_RDEV} floppy3
d50 1
a50 1
	vnconfig -u ${VND_DEV}
d57 1
a57 1
	-vnconfig -u ${VND_DEV}
@


1.9
log
@clean bsd too
@
text
@d1 1
a1 1
#	$Id: Makefile,v 1.8 1996/09/14 03:43:02 deraadt Exp $
d35 1
a35 1
	newfs -O -m 0 -o space -i 8192 -c 80 ${VND_RDEV} floppy5
d40 1
a40 1
	newfs -O -m 0 -o space -i 6500 -c 80 ${VND_RDEV} floppy3
@


1.8
log
@install target; disklabel on image instead, more inodes
@
text
@d1 1
a1 1
#	$Id: Makefile,v 1.7 1996/07/01 18:09:16 deraadt Exp $
d67 1
a67 1
	/bin/rm -f *.core ${IMAGE} ${CBIN} ${CBIN}.mk ${CBIN}.cache *.o *.lo *.c
@


1.7
log
@build kernel automatically
@
text
@d1 1
a1 1
#	$Id: Makefile,v 1.6 1996/06/16 11:02:26 deraadt Exp $
d27 1
a27 1
all: ${CBIN} bsd
d33 1
a34 1
	disklabel -w -B -b /usr/mdec/fdboot -s /usr/mdec/bootfd ${VND} floppy5
d38 1
d40 1
a40 2
	disklabel -w -B -b /usr/mdec/fdboot -s /usr/mdec/bootfd ${VND} floppy3
	newfs -O -m 0 -o space -i 8192 -c 80 ${VND_RDEV} floppy3
d68 3
@


1.6
log
@clean ${REALIMAGE} better
@
text
@d1 1
a1 1
#	$Id: Makefile,v 1.5 1996/06/11 09:04:17 deraadt Exp $
d21 7
a27 1
all: ${CBIN}
@


1.5
log
@delete ${REALIMAGE} on completion
@
text
@d1 1
a1 1
#	$Id: Makefile,v 1.4 1996/06/02 11:41:40 deraadt Exp $
d47 1
d52 1
a52 1
	-/bin/rm -f ${REALIMAGE} ${IMAGE}
d61 1
a61 1
	/bin/rm -f core ${IMAGE} ${CBIN} ${CBIN}.mk ${CBIN}.cache *.o *.lo *.c
@


1.4
log
@create vnd filesystem in a file in /tmp (now we assume /tmp is a non-nfs
filesystem, instead of assuming src or obj are non-nfs)
@
text
@d1 1
a1 1
#	$Id: Makefile,v 1.3 1996/05/31 23:00:23 mickey Exp $
d51 1
a51 1
	-/bin/rm -f ${IMAGE}
@


1.3
log
@Fix last commit (kc was w/ kc-common CVS/*)
@
text
@d1 1
a1 1
#	$Id: Makefile,v 1.1 1996/05/31 22:52:33 mickey Exp $
d13 2
d26 2
a27 2
	dd if=/dev/zero of=${IMAGE} bs=10k count=120
	vnconfig -v -c ${VND_DEV} ${IMAGE}
d31 2
a32 2
	dd if=/dev/zero of=${IMAGE} bs=10k count=144
	vnconfig -v -c ${VND_DEV} ${IMAGE}
d46 1
@


1.2
log
@from NetBSD
@
text
@d1 1
a1 1
#	$Id: Makefile,v 1.1 1995/10/18 08:37:35 deraadt Exp deraadt $
d6 8
a13 1
IMAGE=		kc-${REV}.fs
d15 46
a60 1
.include "${TOP}/kc-common/Makefile.inc"
@


1.1
log
@Initial revision
@
text
@d1 1
a1 1
#	$Id: Makefile,v 1.1 1995/05/12 03:32:09 cgd Exp $
@


1.1.1.1
log
@initial import of NetBSD tree
@
text
@@
