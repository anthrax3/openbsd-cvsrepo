head	1.3;
access;
symbols
	OPENBSD_5_5:1.2.0.6
	OPENBSD_5_5_BASE:1.2
	OPENBSD_5_4:1.2.0.2
	OPENBSD_5_4_BASE:1.2
	OPENBSD_5_3:1.1.1.4.0.28
	OPENBSD_5_3_BASE:1.1.1.4
	OPENBSD_5_2:1.1.1.4.0.26
	OPENBSD_5_2_BASE:1.1.1.4
	OPENBSD_5_1_BASE:1.1.1.4
	OPENBSD_5_1:1.1.1.4.0.24
	OPENBSD_5_0:1.1.1.4.0.22
	OPENBSD_5_0_BASE:1.1.1.4
	OPENBSD_4_9:1.1.1.4.0.20
	OPENBSD_4_9_BASE:1.1.1.4
	OPENBSD_4_8:1.1.1.4.0.18
	OPENBSD_4_8_BASE:1.1.1.4
	OPENBSD_4_7:1.1.1.4.0.14
	OPENBSD_4_7_BASE:1.1.1.4
	OPENBSD_4_6:1.1.1.4.0.16
	OPENBSD_4_6_BASE:1.1.1.4
	OPENBSD_4_5:1.1.1.4.0.12
	OPENBSD_4_5_BASE:1.1.1.4
	OPENBSD_4_4:1.1.1.4.0.10
	OPENBSD_4_4_BASE:1.1.1.4
	OPENBSD_4_3:1.1.1.4.0.8
	OPENBSD_4_3_BASE:1.1.1.4
	OPENBSD_4_2:1.1.1.4.0.6
	OPENBSD_4_2_BASE:1.1.1.4
	OPENBSD_4_1:1.1.1.4.0.4
	OPENBSD_4_1_BASE:1.1.1.4
	OPENBSD_4_0:1.1.1.4.0.2
	OPENBSD_4_0_BASE:1.1.1.4
	HEIMDAL_0_7_2:1.1.1.4
	OPENBSD_3_9:1.1.1.3.0.18
	OPENBSD_3_9_BASE:1.1.1.3
	OPENBSD_3_8:1.1.1.3.0.16
	OPENBSD_3_8_BASE:1.1.1.3
	OPENBSD_3_7:1.1.1.3.0.14
	OPENBSD_3_7_BASE:1.1.1.3
	HEIMDAL_0_6_3:1.1.1.3
	OPENBSD_3_6:1.1.1.3.0.12
	OPENBSD_3_6_BASE:1.1.1.3
	OPENBSD_3_5:1.1.1.3.0.10
	OPENBSD_3_5_BASE:1.1.1.3
	OPENBSD_3_4:1.1.1.3.0.8
	OPENBSD_3_4_BASE:1.1.1.3
	HEIMDAL_0_6:1.1.1.3
	HEIMDAL_0_6RC1:1.1.1.3
	OPENBSD_3_3:1.1.1.3.0.6
	OPENBSD_3_3_BASE:1.1.1.3
	OPENBSD_3_2:1.1.1.3.0.4
	OPENBSD_3_2_BASE:1.1.1.3
	OPENBSD_3_1:1.1.1.3.0.2
	OPENBSD_3_1_BASE:1.1.1.3
	HEIMDAL_0_4e:1.1.1.3
	OPENBSD_3_0:1.1.1.2.0.2
	OPENBSD_3_0_BASE:1.1.1.2
	HEIMDAL_0_3f:1.1.1.2
	HEIMDAL_0_3e:1.1.1.1
	KTH:1.1.1;
locks; strict;
comment	@# @;


1.3
date	2014.04.22.10.01.21;	author reyk;	state dead;
branches;
next	1.2;

1.2
date	2013.06.17.18.57.41;	author robert;	state Exp;
branches;
next	1.1;

1.1
date	2001.05.25.07.46.47;	author hin;	state Exp;
branches
	1.1.1.1;
next	;

1.1.1.1
date	2001.05.25.07.46.47;	author hin;	state Exp;
branches;
next	1.1.1.2;

1.1.1.2
date	2001.06.22.21.17.23;	author hin;	state Exp;
branches;
next	1.1.1.3;

1.1.1.3
date	2002.02.06.08.53.10;	author hin;	state Exp;
branches;
next	1.1.1.4;

1.1.1.4
date	2006.04.14.07.32.32;	author biorn;	state Exp;
branches;
next	;


desc
@@


1.3
log
@The complexity and quality of kerberosV and the fact that almost
nobody is using it doesn't justify to have it in base - disable and
remove it.  If the 2 two people who use it still want it, they can
make a port or recompile OpenBSD on their own.

There is a quote in theo.c from August 2010: "basically, dung beetles
fucking.  that's what kerberosV + openssl is like".

Discussed with many.  Tests by henning@@ reyk@@ and others.
ok deraadt@@ henning@@
@
text
@@@c $Id: win2k.texi,v 1.2 2013/06/17 18:57:41 robert Exp $


@@node Windows compatibility, Programming with Kerberos, Kerberos 4 issues, Top
@@comment  node-name,  next,  previous,  up
@@chapter Windows compatibility

Microsoft Windows, starting from version 2000 (formerly known as Windows NT 5), implements Kerberos 5. Their implementation, however, has some quirks,
peculiarities, and bugs. This chapter is a short summary of the compatibility
issues between Heimdal and various Windows versions.

The big problem with the Kerberos implementation in Windows
is that the available documentation is more focused on getting
things to work rather than how they work, and not that useful in figuring
out how things really work. It's of course subject to change all the time and
mostly consists of our not so inspired guesses.  Hopefully it's still
somewhat useful.

@@menu
* Configuring Windows to use a Heimdal KDC::  
* Inter-Realm keys (trust) between Windows and a Heimdal KDC::  
* Create account mappings::     
* Encryption types::            
* Authorisation data::          
* Quirks of Windows 2000 KDC::  
* Useful links when reading about the Windows::  
@@end menu

@@node Configuring Windows to use a Heimdal KDC, Inter-Realm keys (trust) between Windows and a Heimdal KDC, Windows compatibility, Windows compatibility
@@comment node-name, next, precious, up
@@section Configuring Windows to use a Heimdal KDC

You need the command line program called @@command{ksetup.exe}. This program comes with the Windows Support Tools, available from either the installation CD-ROM (@@file{SUPPORT/TOOLS/SUPPORT.CAB}), or from Microsoft web site. Starting from Windows 2008, it is already installed. This program is used to configure the Kerberos settings on a Workstation.

@@command{Ksetup} store the domain information under the registry key:
@@code{HKEY_LOCAL_MACHINE\System\CurrentControlSet\Control\LSA\Kerberos\Domains}.

Use the @@command{kadmin} program in Heimdal to create a host principal in the
Kerberos realm.

@@example
unix% kadmin
kadmin> ank --password=password host/datan.example.com
@@end example

The name @@samp{datan.example.com} should be replaced with DNS name of
the workstation.

You must configure the workstation as a member of a workgroup, as opposed
to a member in an NT domain, and specify the KDC server of the realm
as follows:
@@example
C:> ksetup /setdomain EXAMPLE.COM
C:> ksetup /addkdc EXAMPLE.COM kdc.example.com
@@end example

Set the machine password, i.e.@@: create the local keytab:
@@example
C:> ksetup /SetComputerPassword password
@@end example

The password used in @@kbd{ksetup /setmachpassword} must be the same
as the password used in the @@kbd{kadmin ank} command.

The workstation must now be rebooted.

A mapping between local NT users and Kerberos principals must be specified.
You have two choices. First:

@@example
C:> ksetup /mapuser user@@@@MY.REALM nt_user
@@end example

This will map a user to a specific principal; this allows you to have
other usernames in the realm than in your NT user database. (Don't ask
me why on earth you would want that@@enddots{})

You can also say:
@@example
C:> ksetup /mapuser * *
@@end example
The Windows machine will now map any user to the corresponding principal,
for example @@samp{nisse} to the principal @@samp{nisse@@@@MY.REALM}.
(This is most likely what you want.)

@@node Inter-Realm keys (trust) between Windows and a Heimdal KDC, Create account mappings, Configuring Windows to use a Heimdal KDC, Windows compatibility
@@comment node-name, next, precious, up
@@section Inter-Realm keys (trust) between Windows and a Heimdal KDC

See also the Step-by-Step guide from Microsoft, referenced below.

Install Windows, and create a new controller (Active Directory
Server) for the domain.

By default the trust will be non-transitive. This means that only users
directly from the trusted domain may authenticate. This can be changed
to transitive by using the @@command{netdom.exe} tool. @@command{netdom.exe} 
can also be used to add the trust between two realms.

You need to tell Windows on what hosts to find the KDCs for the
non-Windows realm with @@command{ksetup}, see @@xref{Configuring Windows 
to use a Heimdal KDC}.

This needs to be done on all computers that want enable cross-realm
login with @@code{Mapped Names}. @@c XXX probably shouldn't be @@code

Then you need to add the inter-realm keys on the Windows KDC@@. Start the
Domain Tree Management tool (found in Programs, Administrative tools,
Active Directory Domains and Trusts).

Right click on Properties of your domain, select the Trust tab.  Press
Add on the appropriate trust windows and enter domain name and
password. When prompted if this is a non-Windows Kerberos realm, press
OK.

Do not forget to add trusts in both directions (if that's what you want).

If you want to use @@command{netdom.exe} instead of the Domain Tree
Management tool, you do it like this:

@@example
netdom trust NT.REALM.EXAMPLE.COM /Domain:EXAMPLE.COM /add /realm /passwordt:TrustPassword
@@end example

You also need to add the inter-realm keys to the Heimdal KDC. But take
care to the encryption types and salting used for those keys. There should be
no encryption type stronger than the one configured on Windows side for this
relationship, itself limited to the ones supported by this specific version of
Windows, nor any Kerberos 4 salted hashes, as Windows does not seem to
understand them. Otherwise, the trust will not works.

Here are the version-specific needed information:
@@enumerate
@@item Windows 2000: maximum encryption type is DES
@@item Windows 2003: maximum encryption type is DES
@@item Windows 2003RC2: maximum encryption type is RC4, relationship defaults to DES
@@item Windows 2008: maximum encryption type is AES, relationship defaults to RC4
@@end enumerate

For Windows 2003RC2, to change the trust encryption type, you have to use the
@@command{ktpass}, from the Windows 2003 Resource kit *service pack2*, available
from Microsoft web site.

@@example
C:> ktpass /MITRealmName UNIX.EXAMPLE.COM /TrustEncryp RC4 
@@end example

For Windows 2008, the same operation can be done with the @@command{ksetup}, installed by default.

@@example
C:> ksetup /SetEncTypeAttre EXAMPLE.COM AES256-SHA1 
@@end example

Once the relationship is correctly configured, you can add the required
inter-realm keys, using heimdal default encryption types:

@@example
kadmin add krbtgt/NT.REALM.EXAMPLE.COM@@@@EXAMPLE.COM
kadmin add krbtgt/REALM.EXAMPLE.COM@@@@NT.EXAMPLE.COM
@@end example

Use the same passwords for both keys.

And if needed, to remove unsupported encryptions, such as the following ones for a Windows 2003RC2 server.

@@example
kadmin del_enctype krbtgt/REALM.EXAMPLE.COM@@@@NT.EXAMPLE.COM aes256-cts-hmac-sha1-96
kadmin del_enctype krbtgt/REALM.EXAMPLE.COM@@@@NT.EXAMPLE.COM des3-cbc-sha1
kadmin del_enctype krbtgt/NT.EXAMPLE.COM@@@@EXAMPLE.COM aes256-cts-hmac-sha1-96
kadmin del_enctype krbtgt/NT.EXAMPLE.COM@@@@EXAMPLE.COM des3-cbc-sha1
@@end example

Do not forget to reboot before trying the new realm-trust (after
running @@command{ksetup}). It looks like it might work, but packets are
never sent to the non-Windows KDC.

@@node Create account mappings, Encryption types, Inter-Realm keys (trust) between Windows and a Heimdal KDC, Windows compatibility
@@comment node-name, next, precious, up
@@section Create account mappings

Start the @@code{Active Directory Users and Computers} tool. Select the
View menu, that is in the left corner just below the real menu (or press
Alt-V), and select Advanced Features. Right click on the user that you
are going to do a name mapping for and choose Name mapping.

Click on the Kerberos Names tab and add a new principal from the
non-Windows domain.

@@c XXX check entry name then I have network again
This adds @@samp{authorizationNames} entry to the users LDAP entry to
the Active Directory LDAP catalog. When you create users by script you
can add this entry instead.

@@node Encryption types, Authorisation data, Create account mappings, Windows compatibility
@@comment  node-name,  next,  previous,  up
@@section Encryption types

Windows 2000 supports both the standard DES encryptions (@@samp{des-cbc-crc} and
@@samp{des-cbc-md5}) and its own proprietary encryption that is based on MD4 and
RC4 that is documented in and is supposed to be described in
@@file{draft-brezak-win2k-krb-rc4-hmac-03.txt}.  New users will get both
MD4 and DES keys.  Users that are converted from a NT4 database, will
only have MD4 passwords and will need a password change to get a DES
key.

@@node Authorisation data, Quirks of Windows 2000 KDC, Encryption types, Windows compatibility
@@comment  node-name,  next,  previous,  up
@@section Authorisation data

The Windows 2000 KDC also adds extra authorisation data in tickets.
It is at this point unclear what triggers it to do this.  The format of
this data is only available under a ``secret'' license from Microsoft,
which prohibits you implementing it.

A simple way of getting hold of the data to be able to understand it
better is described here.

@@enumerate
@@item Find the client example on using the SSPI in the SDK documentation.
@@item Change ``AuthSamp'' in the source code to lowercase.
@@item Build the program.
@@item Add the ``authsamp'' principal with a known password to the
database.  Make sure it has a DES key.
@@item Run @@kbd{ktutil add} to add the key for that principal to a
keytab.
@@item Run @@kbd{appl/test/nt_gss_server -p 2000 -s authsamp
@@kbd{--dump-auth}=@@var{file}} where @@var{file} is an appropriate file.
@@item It should authenticate and dump for you the authorisation data in
the file.
@@item The tool @@kbd{lib/asn1/asn1_print} is somewhat useful for
analysing the data.
@@end enumerate

@@node Quirks of Windows 2000 KDC, Useful links when reading about the Windows, Authorisation data, Windows compatibility
@@comment  node-name,  next,  previous,  up
@@section Quirks of Windows 2000 KDC

There are some issues with salts and Windows 2000.  Using an empty salt---which is the only one that Kerberos 4 supported, and is therefore known
as a Kerberos 4 compatible salt---does not work, as far as we can tell
from out experiments and users' reports.  Therefore, you have to make
sure you keep around keys with all the different types of salts that are
required.  Microsoft have fixed this issue post Windows 2003.

Microsoft seems also to have forgotten to implement the checksum
algorithms @@samp{rsa-md4-des} and @@samp{rsa-md5-des}. This can make Name
mapping (@@pxref{Create account mappings}) fail if a @@samp{des-cbc-md5} key
is used. To make the KDC return only @@samp{des-cbc-crc} you must delete
the @@samp{des-cbc-md5} key from the kdc using the @@kbd{kadmin
del_enctype} command.

@@example
kadmin del_enctype lha des-cbc-md5
@@end example

You should also add the following entries to the @@file{krb5.conf} file:

@@example
[libdefaults]
	default_etypes = des-cbc-crc
	default_etypes_des = des-cbc-crc
@@end example

These configuration options will make sure that no checksums of the
unsupported types are generated.

@@node Useful links when reading about the Windows,  , Quirks of Windows 2000 KDC, Windows compatibility
@@comment  node-name,  next,  previous,  up
@@section Useful links when reading about the Windows

See also our paper presented at the 2001 Usenix Annual Technical
Conference, available in the proceedings or at
@@uref{http://www.usenix.org/publications/library/proceedings/usenix01/freenix01/westerlund.html}.

There are lots of texts about Kerberos on Microsoft's web site, here is a
short list of the interesting documents that we have managed to find.

@@itemize @@bullet

@@item Step-by-Step Guide to Kerberos 5 (krb5 1.0) Interoperability:
@@uref{http://www.microsoft.com/technet/prodtechnol/windows2000serv/howto/kerbstep.mspx}.
Kerberos GSS-API (in Windows-eze SSPI), Windows as a client in a
non-Windows KDC realm, adding unix clients to a Windows 2000 KDC, and
adding cross-realm trust (@@pxref{Inter-Realm keys (trust) between Windows
and a Heimdal KDC}).

@@item Windows 2000 Kerberos Authentication:
@@uref{www.microsoft.com/technet/prodtechnol/windows2000serv/deploy/confeat/kerberos.mspx}.
White paper that describes how Kerberos is used in Windows 2000.

@@item Overview of Kerberos:
@@uref{http://support.microsoft.com/support/kb/articles/Q248/7/58.ASP}.
Links to useful other links.

@@c @@item Klist for Windows:
@@c @@uref{http://msdn.microsoft.com/library/periodic/period00/security0500.htm}.
@@c Describes where to get a klist for Windows 2000.

@@item Event logging for Kerberos:
@@uref{http://support.microsoft.com/support/kb/articles/Q262/1/77.ASP}.
Basically it say that you can add a registry key
@@code{HKEY_LOCAL_MACHINE\SYSTEM\CurrentControlSet\Control\Lsa\Kerberos\Parameters\LogLevel}
with value DWORD equal to 1, and then you'll get logging in the Event
Logger.

@@c @@item Access to the Active Directory through LDAP:
@@c @@uref{http://msdn.microsoft.com/library/techart/kerberossamp.htm}

@@end itemize

Other useful programs include these:

@@itemize @@bullet
@@item pwdump2
@@uref{http://www.bindview.com/Support/RAZOR/Utilities/Windows/pwdump2_readme.cfm}@@end itemize
@


1.2
log
@update kerberosV to Heimdal 1.5.2 using BSD Makefiles based
on the ones from FreeBSD

This is getting commited now so that we can patch it up
fast in the tree.
There are known regressions so please don't try to build
this on your own now, please wait for the next available
snapshot.

If however you would still want to build it, make sure
build and install everything in the tools directory first.

This is not the full commit yet because there are several
subdirectories.
@
text
@d1 1
a1 1
@@c $Id$
@


1.1
log
@Initial revision
@
text
@d1 1
a1 1
@@c $KTH: win2k.texi,v 1.12 2001/01/28 22:10:35 assar Exp $
d3 2
a4 1
@@node Windows 2000 compatability, Acknowledgments, Migration, Top
d6 1
a6 1
@@chapter Windows 2000 compatability
d8 10
a17 12
Windows 2000 (formerly known as Windows NT 5) from Microsoft implements
Kerberos 5.  Their implementation, however, has some quirks,
peculiarities, and bugs.  This chapter is a short summary of the things
that we have found out while trying to test Heimdal against Windows
2000.  Another big problem with the Kerberos implementation in Windows
2000 is that the available documentation is more focused on getting
things to work rather than how they work and not that useful in figuring
out how things really work.

This information should apply to Heimdal @@value{VERSION} and Windows
2000 Professional.  It's of course subject all the time and mostly consists of
our not so inspired guesses.  Hopefully it's still somewhat useful.
d20 2
a21 2
* Configuring Windows 2000 to use a Heimdal KDC::  
* Inter-Realm keys (trust) between Windows 2000 and a Heimdal KDC::  
d24 1
a24 1
* Authorization data::          
d26 1
a26 1
* Useful links when reading about the Windows 2000::  
d29 1
a29 1
@@node Configuring Windows 2000 to use a Heimdal KDC, Inter-Realm keys (trust) between Windows 2000 and a Heimdal KDC, Windows 2000 compatability, Windows 2000 compatability
d31 1
a31 1
@@section Configuring Windows 2000 to use a Heimdal KDC
d33 1
a33 4
You need the command line program called @@code{ksetup.exe} which is available
in the file @@code{SUPPORT/TOOLS/SUPPORT.CAB} on the Windows 2000 Professional
CD-ROM. This program is used to configure the Kerberos settings on a
Workstation.
d35 1
a35 1
@@code{Ksetup} store the domain information under the registry key:
d38 1
a38 1
Use the kadmin program in Heimdal to create a host principal in the
d43 1
a43 1
kadmin> ank -pw password host/datan.my.domain
d46 4
a49 1
You must configure the Workstation as a member of a workgroup, as opposed
d53 2
a54 2
C:> ksetup /setdomain MY.REALM
C:> ksetup /addkdc MY.REALM kdc.my.domain
d57 1
a57 1
Set the machine password, i.e. create the local keytab:
d59 1
a59 1
C:> ksetup /setmachpassword password
d62 3
d67 2
a68 2
A mapping between local NT users and Kerberos principals must be specified,
you have two choices:
d74 1
a74 1
This will map a user to a specific principal, this allows you to have
d76 1
a76 1
me why on earth you would want that...)
d86 1
a86 1
@@node Inter-Realm keys (trust) between Windows 2000 and a Heimdal KDC, Create account mappings, Configuring Windows 2000 to use a Heimdal KDC, Windows 2000 compatability
d88 1
a88 1
@@section Inter-Realm keys (trust) between Windows 2000 and a Heimdal KDC
d92 1
a92 1
Install Windows 2000, and create a new controller (Active Directory
d97 2
a98 1
to transitive by using the @@code{netdom.exe} tool.
d100 2
a101 2
You need to tell Windows 2000 on what hosts to find the KDCs for the
non-Windows realm with @@code{ksetup}, see @@xref{Configuring Windows 2000
d104 2
a105 2
This need to be done on all computers that want enable cross-realm
login with @@code{Mapped Names}.
d107 2
a108 2
Then you need to add the inter-realm keys on the Windows kdc. Start the
Domain Tree Management tool. (Found in Programs, Administrative tools,
d116 1
a116 1
Do not forget to add trusts in both directions.
d118 2
a119 2
You also need to add the inter-realm keys to the Heimdal KDC. There are
some tweaks that you need to do to @@file{krb5.conf} beforehand.
d122 1
a122 3
[libdefaults]
	default_etypes = des-cbc-crc
	default_etypes_des = des-cbc-crc
d125 6
a130 2
since otherwise checksum types that are not understood by Windows 2000
will be generated (@@xref{Quirks of Windows 2000 KDC}.).
d132 11
a142 4
Another issue is salting.  Since Windows 2000 does not seem to
understand Kerberos 4 salted hashes you might need to turn off anything
similar to the following if you have it, at least while adding the
principals that are going to share keys with Windows 2000.
d145 1
a145 1
	[kadmin]default_keys = des3:pw-salt des:pw-salt des:pw-salt:
d148 5
a152 1
You must also set:
d154 2
a155 1
Once that is also done, you can add the required inter-realm keys:
d164 12
a175 3
Do not forget to reboot before trying the new realm-trust (after running
@@code{ksetup}). It looks like it might work, but packets are never sent to the
non-Windows KDC.
d177 1
a177 1
@@node Create account mappings, Encryption types, Inter-Realm keys (trust) between Windows 2000 and a Heimdal KDC, Windows 2000 compatability
d189 6
a194 1
@@node Encryption types, Authorization data, Create account mappings, Windows 2000 compatability
d198 3
a200 3
Windows 2000 supports both the standard DES encryptions (des-cbc-crc and
des-cbc-md5) and its own proprietary encryption that is based on MD4 and
rc4 that is documented in and is supposed to be described in
d206 1
a206 4
Heimdal implements both of these encryption types, but since DES is the
standard and the hmac-code is somewhat newer, it is likely to work better.

@@node Authorization data, Quirks of Windows 2000 KDC, Encryption types, Windows 2000 compatability
d208 1
a208 1
@@section Authorization data
d210 1
a210 1
The Windows 2000 KDC also adds extra authorization data in tickets.
d227 2
a228 2
--dump-auth=file} where file is an appropriate file.
@@item It should authenticate and dump for you the authorization data in
d231 1
a231 1
analyzing the data.
d234 1
a234 1
@@node Quirks of Windows 2000 KDC, Useful links when reading about the Windows 2000, Authorization data, Windows 2000 compatability
d238 3
a240 4
There are some issues with salts and Windows 2000.  Using an empty salt,
which is the only one that Kerberos 4 supported and is therefore known
as a Kerberos 4 compatible salt does not work, as far as we can tell
from out experiments and users reports.  Therefore, you have to make
d242 1
a242 1
required.
d246 3
a248 3
mapping (@@pxref{Create account mappings}) fail if a @@code{des-cbc-md5} key
is used. To make the KDC return only @@code{des-cbc-crc} you must delete
the @@code{des-cbc-md5} key from the kdc using the @@code{kadmin
d266 1
a266 1
@@node Useful links when reading about the Windows 2000,  , Quirks of Windows 2000 KDC, Windows 2000 compatability
d268 1
a268 1
@@section Useful links when reading about the Windows 2000
d270 5
a274 1
There are lots of text about Kerberos on Microsoft's web site, here is a
d279 3
a281 3
@@item Step-by-Step Guide to Kerberos 5 (krb5 1.0) Interoperability -
@@url{http://www.microsoft.com/windows2000/library/planning/security/kerbsteps.asp}
Kerberos GSS-API (in Windows-ize SSPI), Windows as a client in a
d283 2
a284 2
adding cross-realm trust (@@xref{Inter-Realm keys (trust) between Windows 2000
and a Heimdal KDC}.).
d286 2
a287 2
@@item Windows 2000 Kerberos Authentication - 
@@url{http://www.microsoft.com/TechNet/win2000/win2ksrv/technote/kerberos.asp}
d290 2
a291 2
@@item Overview of kerberos -
@@url{http://support.microsoft.com/support/kb/articles/Q248/7/58.ASP}
d294 7
a300 7
@@item Klist for windows - 
@@url{http://msdn.microsoft.com/library/periodic/period00/security0500.htm}
Describes where to get a klist for Windows 2000.

@@item Event logging for kerberos -
@@url{http://support.microsoft.com/support/kb/articles/Q262/1/77.ASP}.
Basicly it say that you can add a registry key
d305 2
a306 2
@@item Access to the active directory through LDAP
@@url{http://msdn.microsoft.com/library/techart/kerberossamp.htm}
d314 1
a314 2
@@url{http://www.webspan.net/~tas/pwdump2/}
@@end itemize
@


1.1.1.1
log
@Import of heimdal-0.3e
@
text
@@


1.1.1.2
log
@Import of heimdal-0.3f

Lots of changes, highlights include:

 * change default keytab to ANY:FILE:/etc/krb5.keytab,krb4:/etc/srvtab,
   the new keytab type that tries both of these in order (SRVTAB is
   also an alias for krb4:)

 * improve error reporting and error handling (error messages should
   be more detailed and more useful)

 * the API is closer to what MIT krb5 is using

 * more compatible with windows 2000

 * removed some memory leaks

 * bug fixes
@
text
@d1 1
a1 1
@@c $KTH: win2k.texi,v 1.13 2001/02/24 05:09:24 assar Exp $
d3 1
a3 1
@@node Windows 2000 compatability, Programming with Kerberos, Kerberos 4 issues, Top
@


1.1.1.3
log
@Import of heimdal-0.4e
@
text
@d1 1
a1 1
@@c $KTH: win2k.texi,v 1.15 2001/07/19 16:44:41 assar Exp $
d133 1
a133 1
	[kadmin]default_keys = v5 v4
a241 4

See also our paper presented at the 2001 usenix Annual Technical
Conference, available in the proceedings or at
@@url{http://www.usenix.org/publications/library/proceedings/usenix01/freenix01/westerlund.html}.
@


1.1.1.4
log
@Import of heimdal-0.7.2
@
text
@d1 1
a1 1
@@c $KTH: win2k.texi,v 1.19 2004/12/27 14:56:30 lha Exp $
d13 1
a13 1
things to work rather than how they work, and not that useful in figuring
d17 2
a18 3
2000 Professional.  It's of course subject to change all the time and
mostly consists of our not so inspired guesses.  Hopefully it's still
somewhat useful.
d34 2
a35 2
You need the command line program called @@command{ksetup.exe} which is available
in the file @@file{SUPPORT/TOOLS/SUPPORT.CAB} on the Windows 2000 Professional
d39 1
a39 1
@@command{Ksetup} store the domain information under the registry key:
d42 1
a42 1
Use the @@command{kadmin} program in Heimdal to create a host principal in the
d47 1
a47 1
kadmin> ank --password=password host/datan.example.com
d50 1
a50 4
The name @@samp{datan.example.com} should be replaced with DNS name of
the workstation.

You must configure the workstation as a member of a workgroup, as opposed
d54 2
a55 2
C:> ksetup /setdomain EXAMPLE.COM
C:> ksetup /addkdc EXAMPLE.COM kdc.example.com
d58 1
a58 1
Set the machine password, i.e.@@: create the local keytab:
a62 3
The password used in @@kbd{ksetup /setmachpassword} must be the same
as the password used in the @@kbd{kadmin ank} command.

d65 2
a66 2
A mapping between local NT users and Kerberos principals must be specified.
You have two choices. First:
d72 1
a72 1
This will map a user to a specific principal; this allows you to have
d74 1
a74 1
me why on earth you would want that@@enddots{})
d95 1
a95 2
to transitive by using the @@command{netdom.exe} tool. @@command{netdom.exe} 
can also be used to add the trust between two realms.
d98 1
a98 1
non-Windows realm with @@command{ksetup}, see @@xref{Configuring Windows 2000
d101 2
a102 2
This needs to be done on all computers that want enable cross-realm
login with @@code{Mapped Names}. @@c XXX probably shouldn't be @@code
d104 2
a105 2
Then you need to add the inter-realm keys on the Windows KDC@@. Start the
Domain Tree Management tool (found in Programs, Administrative tools,
d113 1
a113 8
Do not forget to add trusts in both directions (if that's what you want).

If you want to use @@command{netdom.exe} instead of the Domain Tree
Management tool, you do it like this:

@@example
netdom trust NT.REALM.EXAMPLE.COM /Domain:EXAMPLE.COM /add /realm /passwordt:TrustPassword
@@end example
d120 2
a121 2
        default_etypes = des-cbc-crc
        default_etypes_des = des-cbc-crc
d125 1
a125 1
will be generated (@@pxref{Quirks of Windows 2000 KDC}).
d133 1
a133 2
[kadmin]
        default_keys = v5 v4
d136 1
a136 12
So remove v4 from default keys.

What you probably want to use is this:

@@example
[kadmin]
        default_keys = des-cbc-crc:pw-salt arcfour-hmac-md5:pw-salt
@@end example

@@c XXX check this
Note that before Windows 2003, arcfour-hmac-md5 wasn't supported
beteen Windows realms and Non Windows realms.
d147 3
a149 3
Do not forget to reboot before trying the new realm-trust (after
running @@command{ksetup}). It looks like it might work, but packets are
never sent to the non-Windows KDC.
a162 5
@@c XXX check entry name then I have network again
This adds @@samp{authorizationNames} entry to the users LDAP entry to
the Active Directory LDAP catalog. When you create users by script you
can add this entry instead.

d167 3
a169 3
Windows 2000 supports both the standard DES encryptions (@@samp{des-cbc-crc} and
@@samp{des-cbc-md5}) and its own proprietary encryption that is based on MD4 and
RC4 that is documented in and is supposed to be described in
d175 3
d199 1
a199 1
--dump-auth=@@var{file}} where @@var{file} is an appropriate file.
d210 4
a213 3
There are some issues with salts and Windows 2000.  Using an empty salt---which is the only one that Kerberos 4 supported, and is therefore known
as a Kerberos 4 compatible salt---does not work, as far as we can tell
from out experiments and users' reports.  Therefore, you have to make
d215 1
a215 1
required.  Microsoft have fixed this issue post Windows 2003.
d219 3
a221 3
mapping (@@pxref{Create account mappings}) fail if a @@samp{des-cbc-md5} key
is used. To make the KDC return only @@samp{des-cbc-crc} you must delete
the @@samp{des-cbc-md5} key from the kdc using the @@kbd{kadmin
d245 1
a245 1
@@uref{http://www.usenix.org/publications/library/proceedings/usenix01/freenix01/westerlund.html}.
d247 1
a247 1
There are lots of texts about Kerberos on Microsoft's web site, here is a
d252 3
a254 3
@@item Step-by-Step Guide to Kerberos 5 (krb5 1.0) Interoperability:
@@uref{http://www.microsoft.com/windows2000/library/planning/security/kerbsteps.asp}.
Kerberos GSS-API (in Windows-eze SSPI), Windows as a client in a
d256 2
a257 2
adding cross-realm trust (@@pxref{Inter-Realm keys (trust) between Windows 2000
and a Heimdal KDC}).
d259 2
a260 2
@@item Windows 2000 Kerberos Authentication:
@@uref{http://www.microsoft.com/TechNet/win2000/win2ksrv/technote/kerberos.asp}.
d263 2
a264 2
@@item Overview of Kerberos:
@@uref{http://support.microsoft.com/support/kb/articles/Q248/7/58.ASP}.
d267 3
a269 3
@@c @@item Klist for Windows:
@@c @@uref{http://msdn.microsoft.com/library/periodic/period00/security0500.htm}.
@@c Describes where to get a klist for Windows 2000.
d271 2
a272 2
@@item Event logging for Kerberos:
@@uref{http://support.microsoft.com/support/kb/articles/Q262/1/77.ASP}.
d278 2
a279 2
@@c @@item Access to the Active Directory through LDAP:
@@c @@uref{http://msdn.microsoft.com/library/techart/kerberossamp.htm}
d287 2
a288 1
@@uref{http://www.bindview.com/Support/RAZOR/Utilities/Windows/pwdump2_readme.cfm}@@end itemize
@


