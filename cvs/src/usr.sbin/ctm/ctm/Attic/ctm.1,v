head	1.10;
access;
symbols
	OPENBSD_2_6:1.9.0.2
	OPENBSD_2_6_BASE:1.9
	OPENBSD_2_5:1.5.0.2
	OPENBSD_2_5_BASE:1.5
	OPENBSD_2_4:1.2.0.6
	OPENBSD_2_4_BASE:1.2
	OPENBSD_2_3:1.2.0.4
	OPENBSD_2_3_BASE:1.2
	OPENBSD_2_2:1.2.0.2
	OPENBSD_2_2_BASE:1.2
	OPENBSD_2_1:1.1.1.1.0.2
	OPENBSD_2_1_BASE:1.1.1.1
	GRAICHEN_961030:1.1.1.1
	GRAICHEN:1.1.1;
locks; strict;
comment	@.\" @;


1.10
date	99.12.02.04.00.47;	author deraadt;	state dead;
branches;
next	1.9;

1.9
date	99.07.13.23.02.05;	author deraadt;	state Exp;
branches;
next	1.8;

1.8
date	99.07.07.10.50.11;	author aaron;	state Exp;
branches;
next	1.7;

1.7
date	99.07.02.20.11.48;	author aaron;	state Exp;
branches;
next	1.6;

1.6
date	99.06.05.22.16.36;	author aaron;	state Exp;
branches;
next	1.5;

1.5
date	99.04.02.15.12.18;	author aaron;	state Exp;
branches;
next	1.4;

1.4
date	99.03.01.05.53.58;	author aaron;	state Exp;
branches;
next	1.3;

1.3
date	98.11.08.00.21.28;	author aaron;	state Exp;
branches;
next	1.2;

1.2
date	97.09.14.01.02.22;	author deraadt;	state Exp;
branches;
next	1.1;

1.1
date	96.10.30.17.32.57;	author graichen;	state Exp;
branches
	1.1.1.1;
next	;

1.1.1.1
date	96.10.30.17.32.57;	author graichen;	state Exp;
branches;
next	;


desc
@@


1.10
log
@bye bye ctm (soon in ports tree)
@
text
@.\"----------------------------------------------------------------------------
.\""THE BEER-WARE LICENSE" (Revision 42):
.\"<joerg@@freebsd.org> wrote this file.  As long as you retain this notice you
.\"can do whatever you want with this stuff. If we meet some day, and you think
.\"this stuff is worth it, you can buy me a beer in return.       Joerg Wunsch
.\"----------------------------------------------------------------------------
.\"
.\" This manual page is partially obtained from Poul-Hennings CTM README
.\" file.
.\"
.\" CTM and ctm(1) by <phk@@login.dknet.dk>
.\"
.\" $Id: ctm.1,v 1.9 1999/07/13 23:02:05 deraadt Exp $
.\"
.Dd Mar 25, 1995
.Os
.Dt CTM 1
.Sh NAME
.Nm ctm
.Nd source code mirror program
.Sh SYNOPSIS
.Nm ctm
.Op Fl cFklquv
.Op Fl b Ar basedir
.Op Fl B Ar backup-file
.Op Fl e Ar include-regex
.Op Fl t Ar tar-command
.Op Fl T Ar tmpdir
.Op Fl V Ar level
.Op Fl x Ar exclude-regex
.Ar
.Sh DESCRIPTION
.Nm
was originally
.Dq Cvs Through eMail ,
but now instead it seems more fitting to call it
.Dq Current Through eMail .
.Pp
.Nm
is now meant to be the definitive way to make and apply a delta between
two versions of a directory tree.

There are two parts to this, making the delta and applying it.  These are two
entirely different things.

.Ss Usage
To apply a CTM delta, you pass it to the
.Nm
command.  You can pass a CTM delta on stdin, or you can give the
filename as an argument.  If you do the latter, you make life a lot
easier for yourself, since the program can accept gzip'ed files and
since it will not have to make a temporary copy of your file.  You can
specify multiple deltas at one time, they will be processed one at a
time.  Deltas that are already applied will be ignored.

The
.Nm
command runs in a number of passes.  It will process the entire
input file in each pass, before commencing with the next pass.

Before working on a file
.Ar name
.Nm
first checks for the existence of the file
.Ar name.ctm .
If this file exists,
.Nm
works on it instead.
.Pp
Pass 1 will verify that the input file is OK.  The syntax, the data
and the global MD5 checksum will be checked.  If any of these fail,
.Nm
will simply reject the input file.

Pass 2 will validate that the directory tree is in the state expected by
the CTM delta.  This is done by looking for files and directories which
should/should not exist and by checking the MD5 checksums of files.

If a
.Ar backup-file
had been specified using the 
.Fl B
option, all files that would be modified by this 
.Nm
invocation are backed up
to this file using the archiver command specified by the 
.Fl t
option.  The default archiver command is
.Nm "tar -rf %s -T -" .

Pass 3 will actually apply the delta. 

The list of files that would be modified by
.Nm
is subject to filtering regular expressions specified
using the
.Fl e
and
.Fl x
options.
The
.Fl e
and 
.Fl x
options are applied in order of appearance on the command line.  The last
filter that matched a given file name determines whether the file would be 
operated on or left alone by
.Nm ctm .

.Nm
will extract the file hierarchy below its working directory.  Absolute
filenames or filenames containing references through
.Dq \&.
or
.Dq \&.\&.
are explicitly prohibited as a security measure.
.Pp
.Ss Options
.Bl -tag -width indent -compact

.It Fl b Ar basedir
Prepend the path
.Ar basedir
to every filename.

.It Fl B Ar backup-file
Backup all files that would be modified by this CTM run to
.Ar backup-file .
If any filters are specified using the
.Fl e
and
.Fl x
options, then the final set of files backed up are those that would be
modified by CTM after the filters are applied.

.It Fl c
Check it out, don't do anything.

.It Fl e Ar regular_expression
Match each name in the CTM file against
.Ar regular_expression ,
and if it matches process the file, otherwise leave it alone.  There may be
any number of these options.  Use of this option disables the
.Pa .ctm_status
sequence number checks.  For example, the expression 
.Ic ^usr.sbin/ctm 
for example, will select the
.Nm usr.sbin/ctm
source directory and all pathnames under it. 

Pathnames can be disabled from being considered by CTM using the 
.Fl x
option.

.It Fl F
Force.

.It Fl k
Keep files and directories and don't remove them even if the CTM file
specifies they are to be removed.  If the
.Fl B
option is specified, these files and directories will not be backed up.

.It Fl l
List files that would be modified by this invocation of CTM and the
actions that would be performed on them.  Use of the
.Fl l
option disables the
.Pa .ctm_status
checks and integrity checks on the source tree being operated on.  The
.Fl l
option can be combined with the 
.Fl e
and
.Fl x
options to determine which files would be modified by the given set of
command line options.

.It Fl q
Tell us less.

.It Fl t Ar tar-command
Use
.Ar tar-command
instead of the default archiver
.Nm tar .
This option takes effect only if a backup file had been specified using the
.Fl B
option.  A %s in the tar command will be replaced by the name of the backup 
file.

.It Fl T Ar tmpdir
Put temporary files under
.Ar tmpdir .

.It Fl u
Set the modification time of created and modified files to the CTM delta
creation time.

.It Fl v
Tell us more.

.It Fl V Ar level
Tell us more.
.Ar level
is the level of verbosity.

.It Fl x Ar regular_expression
Match each name in the CTM file against
.Ar regular_expression
and if it matches, leave the file alone.  There may be any number of these
options.  Use of this option disables the
.Pa .ctm_status
sequence number checks.   

Pathnames can be selected for CTM's consideration using the
.Fl e
option.

.El
.Sh ENVIRONMENT
.Ev TMPDIR,
if set to a pathname, will cause
.Nm
to use that pathname
as the location of temporary file.
See
.Xr tempnam 3
for more details on this.
The same effect may be achieved with the
.Fl T
flag.
.Sh FILES
.Pa .ctm_status
contains the sequence number of the last CTM delta applied.  Changing
or removing this file will greatly confuse
.Nm ctm .

Using the
.Fl e
and
.Fl x
options can update a partial subset of the source tree and causes sources
to be in an inconsistent state.  It is assumed that you know what you are
doing when you use these options.

.Sh EXAMPLES
.Bd -literal -offset indent
.Ic cd ~cvs
.Ic /usr/sbin/ctm ~ctm/cvs-*

.Ed
To extract and patch all sources under `lib'
.Bd -literal -offset indent
.Ic cd ~/lib-srcs
.Ic /usr/sbin/ctm -e '^lib' ~ctm/src-cur*
.Ed
.Sh DIAGNOSTICS
Numerous messages, hopefully self-explanatory.  The
.Dq noise level
can be adjusted with the
.Fl q ,
.Fl v
and
.Fl V
options.
.Sh SEE ALSO
.Xr ctm_rmail 1 ,
.Xr ctm 5
.Sh HISTORY
Initial trials were run during the work on FreeBSD 1.1.5, and many bugs and
methods were hashed out.
The
.Nm
command appeared in FreeBSD 2.1.
.Sh AUTHORS
The CTM system has been designed and implemented by
Poul-Henning Kamp
.Aq phk@@FreeBSD.org .
Joerg Wunsch
.Aq joerg@@FreeBSD.org
wrote this man page.
@


1.9
log
@Merge with FreeBSD 3.2, while keeping OpenBSD mktemp/mkstemp fixes.
Some minor man page enhancements.
Brings better man pages, new features, more error checking, and improved
performance; some FreeBSD examples for creating ctm deltas
merged by hgweigand@@wiesbaden.netsurf.de
@
text
@d13 1
a13 1
.\" $Id: ctm.1,v 1.6 1999/06/05 22:16:36 aaron Exp $
@


1.8
log
@The proper order of the ``introductory'' macros in a man page is .Dd/.Dt/.Os.
Out of the approximately 1450 man pages, only about 90 of them were wrong.
Thanks to kwesterback@@home.com for coming up with a script and patch to repair
this. The patch also inserted a .Os macro in the few man pages that were
missing one.
@
text
@d13 1
a13 1
.\" $Id: ctm.1,v 1.7 1999/07/02 20:11:48 aaron Exp $
d15 2
a16 1
.Dd March 25, 1995
a17 1
.Os
d23 1
a23 1
.Op Fl cFpPquv
d25 3
d30 2
a31 1
.Ar file Op Ar ...
d36 1
a36 1
but now it seems more fitting to call it
d42 4
a45 6
.Pp
There are two parts to this: making the delta and applying it.  These are two
entirely different things. The
.Nm
command is only used to apply deltas.
.Pp
d53 3
a55 3
specify multiple deltas at one time, they will be proccessed one at a
time.  Deltas that have already been applied will be ignored.
.Pp
d58 1
a58 1
command runs in three passes.  It will process the entire
d60 3
a62 3
.Pp
Before working on the file
.Ar file ,
d65 1
a65 1
.Ar file.ctm .
d70 1
a70 1
Pass 1 will validate that the input file is OK.  The syntax, the data
d73 2
a74 3
will never be able to do anything with the file, so it will simply
reject it.
.Pp
d78 32
a109 3
.Pp
Pass 3 will actually apply the delta.
.Pp
d119 2
a120 1
.Bl -tag -width indent
d124 12
a135 1
on every filename.
d138 17
d157 22
a178 4
.It Fl p
Less paranoid.
.It Fl P
Paranoid.
d181 11
d195 1
d197 1
a197 1
Set the modification time of created and modified files to the CTM delta's
d199 1
d202 1
d207 13
d235 1
a235 1
contains the sequence number of the last CTM delta applied; changing
d238 9
d248 9
a256 3
.Bd -literal
cd ~cvs
/usr/sbin/ctm ~ctm/cvs-*
d262 2
a263 1
.Fl q
d265 1
a265 1
.Fl v
d271 1
a271 1
Initial trials ran during FreeBSD 1.1.5, and many bugs and
@


1.7
log
@consistent .Dd usage; proper format is: .Dd Month DD, YYYY
@
text
@d13 1
a13 1
.\" $Id: ctm.1,v 1.6 1999/06/05 22:16:36 aaron Exp $
d16 1
a17 1
.Dt CTM 1
@


1.6
log
@remove trailing whitespace, some Nm cleanup
@
text
@d13 1
a13 1
.\" $Id: ctm.1,v 1.5 1999/04/02 15:12:18 aaron Exp $
d15 1
a15 1
.Dd Mar 25, 1995
@


1.5
log
@all .Nm macros should have an argument in SYNOPSIS; also misc cleanup
@
text
@d2 1
a2 1
.\""THE BEER-WARE LICENSE" (Revision 42): 
d13 1
a13 1
.\" $Id: ctm.1,v 1.4 1999/03/01 05:53:58 aaron Exp $
d76 1
a76 1
should/should not exist and by checking the MD5 checksums of files.  
d151 1
a151 1
Initial trials ran during FreeBSD 1.1.5, and many bugs and 
@


1.4
log
@cleanup; d@@
@
text
@d13 1
a13 1
.\" $Id: ctm.1,v 1.3 1998/11/08 00:21:28 aaron Exp $
d22 1
a22 1
.Nm
@


1.3
log
@usr.sbin/ man page repairs, a-i
@
text
@d13 1
a13 1
.\" $Id: ctm.1,v 1.2 1997/09/14 01:02:22 deraadt Exp $
d22 1
a22 1
.Nm ctm
d29 1
a29 1
.Nm ctm
d32 1
a32 1
but now instead it seems more fitting to call it
d34 2
a35 2

.Nm ctm
d38 6
a43 4

There are two parts to this, making the delta and applying it.  These are two
entirely different things.

d46 1
a46 1
.Nm ctm
d52 1
a52 1
time.  Deltas that are already applied will be ignored.
d55 2
a56 2
.Nm ctm
command runs in a number of passes.  It will process the entire
d59 3
a61 3
Before working on a file
.Ar name
.Nm ctm
d63 1
a63 1
.Ar name.ctm .
d65 1
a65 1
.Nm ctm
d70 1
a70 1
.Nm ctm
d80 1
a80 1
.Nm ctm
d108 1
a108 1
Set modification time of created and modified files to the CTM delta
d120 1
a120 1
.Nm ctm
d151 1
a151 1
Initial trials ran during the FreeBSD 1.1.5, and many bugs and 
d154 1
a154 1
.Nm ctm
@


1.2
log
@.Xr foo #, botches
@
text
@d13 1
a13 1
.\" $Id: ctm.1,v 1.1.1.1 1996/10/30 17:32:57 graichen Exp $
d27 1
a27 1
.Ar file Op ...
d29 1
a29 1
.Nm Ctm
d35 1
a35 1
.Nm Ctm
a42 1

d47 1
a47 1
easier for your self, since the program can accept gzip'ed files and
d51 1
a51 1

d56 2
a57 2

Before working one a file
d65 1
a65 1

d71 1
a71 1

d74 2
a75 2
should/should not exists and by checking the MD5 checksums of files.  

d77 2
a78 2

.Nm Ctm
d81 3
a83 3
.Sq \&.
and
.Sq \&.\&.
d85 1
a85 1

d87 1
a87 3

.Bl -tag -width indent -compact

a91 1

a93 1

a95 1

a97 1

a99 1

a101 1

a104 1

a107 1

a109 1

d112 1
a112 1
.Ar Level
a113 1

a114 1

d117 3
a119 1
if set to a pathname, will cause ctm to use that pathname
d122 1
a122 1
.Xr tempnam 3 ,
a126 1

a127 1

d129 1
a129 1
contains the sequence number of the last CTM delta applied.  Changing
a131 1

a132 1

a133 1

a135 1

a136 1

d138 1
a138 2

Numerous messages, hopefully self-explaining.  The
a144 1

d146 2
a147 3
.Xr ctm 5 ,
.Xr ctm_rmail 1

a148 1

a150 1

a153 1

a154 1

d158 3
a160 3

Joerg Wunsch wrote this man-page.
.Aq joerg@@FreeBSD.org .
@


1.1
log
@Initial revision
@
text
@d13 1
a13 1
.\" $Id: ctm.1,v 1.7 1996/07/24 21:36:48 phk Exp $
d134 1
a134 1
.Xr tempnam 3,
@


1.1.1.1
log
@import ctm (current through mail)
for more see http://www.openbsd.org/ctm.html - it's basicaly the FreeBSD
version adapted to OpenBSD - i'll bring in the latest FreeBSD changes in the
next days
@
text
@@
