head	1.19;
access;
symbols
	OPENBSD_6_1:1.19.0.26
	OPENBSD_6_1_BASE:1.19
	OPENBSD_6_0:1.19.0.22
	OPENBSD_6_0_BASE:1.19
	OPENBSD_5_9:1.19.0.18
	OPENBSD_5_9_BASE:1.19
	OPENBSD_5_8:1.19.0.20
	OPENBSD_5_8_BASE:1.19
	OPENBSD_5_7:1.19.0.12
	OPENBSD_5_7_BASE:1.19
	OPENBSD_5_6:1.19.0.16
	OPENBSD_5_6_BASE:1.19
	OPENBSD_5_5:1.19.0.14
	OPENBSD_5_5_BASE:1.19
	OPENBSD_5_4:1.19.0.10
	OPENBSD_5_4_BASE:1.19
	OPENBSD_5_3:1.19.0.8
	OPENBSD_5_3_BASE:1.19
	OPENBSD_5_2:1.19.0.6
	OPENBSD_5_2_BASE:1.19
	OPENBSD_5_1_BASE:1.19
	OPENBSD_5_1:1.19.0.4
	OPENBSD_5_0:1.19.0.2
	OPENBSD_5_0_BASE:1.19
	OPENBSD_4_9:1.18.0.2
	OPENBSD_4_9_BASE:1.18
	OPENBSD_4_8:1.17.0.4
	OPENBSD_4_8_BASE:1.17
	OPENBSD_4_7:1.17.0.2
	OPENBSD_4_7_BASE:1.17
	OPENBSD_4_6:1.15.0.12
	OPENBSD_4_6_BASE:1.15
	OPENBSD_4_5:1.15.0.8
	OPENBSD_4_5_BASE:1.15
	OPENBSD_4_4:1.15.0.6
	OPENBSD_4_4_BASE:1.15
	OPENBSD_4_3:1.15.0.4
	OPENBSD_4_3_BASE:1.15
	OPENBSD_4_2:1.15.0.2
	OPENBSD_4_2_BASE:1.15
	OPENBSD_4_1:1.14.0.12
	OPENBSD_4_1_BASE:1.14
	OPENBSD_4_0:1.14.0.10
	OPENBSD_4_0_BASE:1.14
	OPENBSD_3_9:1.14.0.8
	OPENBSD_3_9_BASE:1.14
	OPENBSD_3_8:1.14.0.6
	OPENBSD_3_8_BASE:1.14
	OPENBSD_3_7:1.14.0.4
	OPENBSD_3_7_BASE:1.14
	OPENBSD_3_6:1.14.0.2
	OPENBSD_3_6_BASE:1.14
	OPENBSD_3_5:1.13.0.4
	OPENBSD_3_5_BASE:1.13
	OPENBSD_3_4:1.13.0.2
	OPENBSD_3_4_BASE:1.13
	OPENBSD_3_3:1.12.0.2
	OPENBSD_3_3_BASE:1.12
	OPENBSD_3_2:1.10.0.14
	OPENBSD_3_2_BASE:1.10
	OPENBSD_3_1:1.10.0.12
	OPENBSD_3_1_BASE:1.10
	OPENBSD_3_0:1.10.0.10
	OPENBSD_3_0_BASE:1.10
	OPENBSD_2_9_BASE:1.10
	OPENBSD_2_9:1.10.0.8
	OPENBSD_2_8:1.10.0.6
	OPENBSD_2_8_BASE:1.10
	OPENBSD_2_7:1.10.0.4
	OPENBSD_2_7_BASE:1.10
	OPENBSD_2_6:1.10.0.2
	OPENBSD_2_6_BASE:1.10
	OPENBSD_2_5:1.8.0.2
	OPENBSD_2_5_BASE:1.8
	OPENBSD_2_4:1.5.0.2
	OPENBSD_2_4_BASE:1.5
	OPENBSD_2_3:1.4.0.2
	OPENBSD_2_3_BASE:1.4
	OPENBSD_2_2:1.3.0.2
	OPENBSD_2_2_BASE:1.3
	OPENBSD_2_1:1.1.1.1.0.4
	OPENBSD_2_1_BASE:1.1.1.1
	OPENBSD_2_0:1.1.1.1.0.2
	OPENBSD_2_0_BASE:1.1.1.1
	netbsd_1_1:1.1.1.1;
locks; strict;
comment	@.\" @;


1.19
date	2011.07.25.18.33.19;	author jmc;	state Exp;
branches;
next	1.18;

1.18
date	2010.10.28.18.34.44;	author jmc;	state Exp;
branches;
next	1.17;

1.17
date	2009.08.08.18.36.34;	author jmc;	state Exp;
branches;
next	1.16;

1.16
date	2009.08.08.14.09.34;	author sobrado;	state Exp;
branches;
next	1.15;

1.15
date	2007.05.31.19.20.28;	author jmc;	state Exp;
branches;
next	1.14;

1.14
date	2004.04.03.21.53.15;	author jmc;	state Exp;
branches;
next	1.13;

1.13
date	2003.06.13.09.56.13;	author jmc;	state Exp;
branches;
next	1.12;

1.12
date	2003.02.01.16.29.52;	author jmc;	state Exp;
branches;
next	1.11;

1.11
date	2002.10.25.05.19.35;	author jason;	state Exp;
branches;
next	1.10;

1.10
date	99.09.23.04.12.11;	author alex;	state Exp;
branches;
next	1.9;

1.9
date	99.06.05.22.17.54;	author aaron;	state Exp;
branches;
next	1.8;

1.8
date	99.03.10.21.25.31;	author pjanzen;	state Exp;
branches;
next	1.7;

1.7
date	99.03.01.06.09.51;	author aaron;	state Exp;
branches;
next	1.6;

1.6
date	99.02.24.08.41.06;	author deraadt;	state Exp;
branches;
next	1.5;

1.5
date	98.05.08.04.52.35;	author millert;	state Exp;
branches;
next	1.4;

1.4
date	98.01.17.20.30.32;	author millert;	state Exp;
branches;
next	1.3;

1.3
date	97.09.01.21.48.27;	author millert;	state Exp;
branches;
next	1.2;

1.2
date	97.05.31.06.03.09;	author deraadt;	state Exp;
branches;
next	1.1;

1.1
date	95.10.18.08.48.00;	author deraadt;	state Exp;
branches
	1.1.1.1;
next	;

1.1.1.1
date	95.10.18.08.48.00;	author deraadt;	state Exp;
branches;
next	;


desc
@@


1.19
log
@document syslog facility/level; from Stefan Unterweger
ok dcoppa
@
text
@.\"	$OpenBSD: chat.8,v 1.18 2010/10/28 18:34:44 jmc Exp $
.\" Id: chat.8,v 1.7 1998/02/04 01:35:49 paulus Exp $
.\" manual page [] for chat 1.8
.Dd $Mdocdate: October 28 2010 $
.Dt CHAT 8
.Os
.Sh NAME
.Nm chat
.Nd automated conversational script with a modem
.Sh SYNOPSIS
.Nm chat
.Op Fl eSsVv
.Bk -words
.Op Fl f Ar chat_file
.Op Fl r Ar report_file
.Op Fl T Ar phone_number
.Op Fl t Ar timeout
.Op Fl U Ar phone_number_2
.Ar script
.Ek
.Sh DESCRIPTION
The
.Nm
program defines a conversational exchange between the computer and the modem.
Its primary purpose is to establish a connection between the
Point-to-Point Protocol Daemon
.Pf ( Xr pppd 8 )
and the remote's pppd process.
.Sh OPTIONS
.Bl -tag -width Ds
.It Fl e
Start with the echo option turned on.
Echoing may also be turned on or off at specific points in the chat script
by using the
.Ic ECHO
keyword.
When echoing is enabled, all output from the modem is echoed to
.Ar stderr .
.It Fl f Ar chat_file
Read the chat script from the
.Ar chat_file .
The use of this option is mutually exclusive with the chat
.Ar script
parameter.
The user must have read access to the file.
Multiple lines are permitted in the file.
Space or horizontal tab characters should be used to separate the strings.
.It Fl r Ar report_file
Set the file for output of the report strings.
If you use the keyword
.Ic REPORT ,
the resulting strings are written to this file.
If this option is not used and you still use
.Ic REPORT
keywords, the
.Ar stderr
file is used for the report strings.
.It Fl S
Do not use
.Xr syslog 3 .
By default, error messages are logged through
.Xr syslog 3
with facility
.Dq local2
and level
.Dq warning .
The use of
.Fl S
will prevent both log messages from
.Fl v
and error messages from being logged via
.Xr syslog 3 .
.It Fl s
Use
.Ar stderr .
All log messages from
.Fl v
and all error messages will be sent to
.Ar stderr .
.It Fl T Ar phone_number
Pass in an arbitrary string, usually a phone number, that will be
substituted for the \eT substitution metacharacter in a send string.
.It Fl t Ar timeout
Set the timeout for the expected string to be received.
If the string is not received within the time limit then the reply string
is not sent.
An alternate reply may be sent or the script will fail if there
is no alternate reply string.
A failed script will cause the
.Nm
program to terminate with a non-zero error code.
.It Fl U Ar phone_number_2
Pass in a second string, usually a phone number, that will be
substituted for the \eU substitution metacharacter in a send string.
This is useful when dialing an ISDN terminal adapter that requires two numbers.
.It Fl V
Request that the chat script be executed in a
.Ar stderr
verbose mode.
The
.Nm
program will then log all text received from the modem and the output strings
sent to the modem to the
.Ar stderr
device.
This device is usually the local console at the station running the
.Nm
or
.Xr pppd 8
program.
.It Fl v
Request that the chat script be executed in a verbose mode.
The
.Nm
program will then log the execution state of the chat script as well as all
text received from the modem and the output strings sent to the modem.
The default is to log through
.Xr syslog 3
with level
.Dq info ,
though this may be altered with the
.Fl S
and
.Fl s
flags.
.It Ar script
If the script is not specified in a file with the
.Fl f
option, then the script is included as parameters to the
.Nm
program.
.El
.Sh CHAT SCRIPT
The chat script defines the communications.
.Pp
A script consists of one or more
.Dq expect-send
pairs of strings,
separated by spaces, with an optional
.Dq subexpect-subsend
string pair, separated by a dash as in the following example:
.Pp
.Dl ogin:-BREAK-ogin: ppp ssword: hello2u2
.Pp
This line indicates that the
.Nm
program should expect the string
.Dq ogin: .
If it fails to receive a login prompt within the time interval allotted,
it is to send a break sequence to the remote and then expect the
string
.Dq ogin: .
If the first
.Dq ogin:
is received then the break sequence is not generated.
.Pp
Once it receives the login prompt, the
.Nm
program will send the string ppp and then expect the prompt
.Dq ssword: .
When it receives the prompt for the password, it will send the password
hello2u2.
.Pp
A carriage return is normally sent following the reply string.
It is not expected in the
.Dq expect
string unless it is specifically requested by using the \er character sequence.
.Pp
The expect sequence should contain only what is needed to identify the string.
Since it is normally stored on a disk file, it should not contain
variable information.
It is generally not acceptable to look for time strings, network
identification strings, or other variable pieces of data as an expect string.
.Pp
To help correct for characters which may be corrupted during the initial
sequence, look for the string
.Dq ogin:
rather than
.Dq login: .
It is possible that the leading
.Dq l
character may be received in error and you may never find the string
even though it was sent by the system.
For this reason, scripts look for
.Dq ogin:
rather than
.Dq login:
and
.Dq ssword:
rather than
.Dq password: .
.Pp
A very simple script might look like this:
.Pp
.Dl ogin: ppp ssword: hello2u2
.Pp
In other words, expect ....ogin:, send ppp, expect ...ssword:, send hello2u2.
.Pp
In actual practice, simple scripts are rare.
At the very least, you should include sub-expect sequences should the
original string not be received.
For example, consider the following script:
.Pp
.Dl ogin:--ogin: ppp ssword: hello2u2
.Pp
This would be a better script than the simple one used earlier.
This would look for the same login: prompt.
If one is not received, a single return sequence is sent and then it will
look for login: again.
Should line noise obscure the first login prompt then sending the empty line
will usually generate a login prompt again.
.Sh COMMENTS
Comments can be embedded in the chat script.
A comment is a line which starts with the
.Sq #
(hash) character in column 1.
Such comment lines are just ignored by the
.Nm
program.
If a
.Sq #
character is to be expected as the first character of the expect sequence,
you should quote the expect string.
If you want to wait for a prompt that starts with a
.Sq #
(hash) character, you would have to write something like this:
.Bd -literal -offset indent
# Now wait for the prompt and send logout string
\'# ' logout
.Ed
.Sh ABORT STRINGS
Many modems will report the status of the call as a string.
These strings may be
.Em CONNECT
or
.Em NO CARRIER
or
.Em BUSY .
It is often desirable to terminate the script should the modem fail to
connect to the remote.
The difficulty is that a script would not know exactly which modem string
it may receive.
On one attempt it may receive
.Em BUSY ,
while the next time it may receive
.Em NO CARRIER .
.Pp
These
.Dq abort
strings may be specified in the script using the
.Ic ABORT
sequence.
It is written in the script as in the following example:
.Pp
.Dl "ABORT BUSY ABORT 'NO CARRIER' '' ATZ OK ATDT5551212 CONNECT"
.Pp
This sequence will expect nothing; and then send the string ATZ.
The expected response to this is the string
.Em OK .
When it receives
.Em OK ,
it sends the string ATDT5551212 to dial the telephone.
The expected string is
.Em CONNECT .
If the string
.Em CONNECT
is received the remainder of the script is executed.
However, should the modem find a busy telephone, it will send the string
.Em BUSY .
This will cause the string to match the abort character sequence.
The script will then fail because it found a match to the abort string.
If it received the string
.Em NO CARRIER ,
it will abort for the same reason.
Either string may be received.
Either string will terminate the chat script.
.Sh CLR_ABORT STRINGS
This sequence allows for clearing previously set
.Ic ABORT
strings.
.Ic ABORT
strings are kept in an array of a pre-determined size (at compilation time);
.Ic CLR_ABORT
will reclaim the space for cleared entries so that new strings can use
that space.
.Sh SAY STRINGS
The
.Ic SAY
directive allows the script to send strings to the user
at the terminal via standard error.
If
.Nm
is being run by
.Xr pppd 8 ,
and pppd is running as a daemon (detached from its controlling terminal),
standard error will normally be redirected to the file
.Pa /etc/ppp/connect-errors .
.Pp
.Ic SAY
strings must be enclosed in single or double quotes.
If carriage return and line feed are needed in the string to be output,
you must explicitly add them to your string.
.Pp
The
.Ic SAY
strings could be used to give progress messages in sections of
the script where you want to have 'ECHO OFF' but still let the user
know what is happening.
An example is:
.Bd -literal -offset indent
ABORT BUSY
ECHO OFF
SAY "Dialling your ISP...\en"
\'' ATDT5551212
TIMEOUT 120
SAY "Waiting up to 2 minutes for connection ... "
CONNECT ''
SAY "\enConnected, now logging in ...\en"
ogin: account
ssword: pass
$ \c
SAY "Logged in OK ...\en"
etc ...
.Ed
.Pp
This sequence will only present the
.Ic SAY
strings to the user and all the details of the script will remain hidden.
For example, if the above script works, the user will see:
.Bd -literal -offset indent
Dialling your ISP...
Waiting up to 2 minutes for connection ...
Connected, now logging in ...
Logged in OK ...
.Ed
.Sh REPORT STRINGS
A report string is similar to the
.Ic ABORT
string.
The difference is that the strings, and all characters to the next control
character such as a carriage return, are written to the report file.
.Pp
The report strings may be used to isolate the transmission rate of the
modem's connect string and return the value to the
.Nm
user.
The analysis of the report string logic occurs in conjunction with the
other string processing such as looking for the expect string.
The use of the same string for a report and abort sequence is probably not
very useful; however, it is possible.
.Pp
The report strings do not change the completion code of the program.
.Pp
These
.Dq report
strings may be specified in the script using the
.Ic REPORT
sequence.
It is written in the script as in the following example:
.Pp
.Dl "REPORT CONNECT ABORT BUSY '' ATDT5551212 CONNECT '' ogin: account"
.Pp
This sequence will expect nothing; and then send the string
ATDT5551212 to dial the telephone.
The expected string is
.Em CONNECT .
If the string
.Em CONNECT
is received the remainder of the script is executed.
In addition the program will write to the expect-file the string
.Dq CONNECT
plus any characters which follow it such as the connection rate.
.Sh CLR_REPORT STRINGS
This sequence allows for clearing previously set
.Ic REPORT
strings.
.Ic REPORT
strings are kept in an array of a pre-determined size (at compilation time);
.Ic CLR_REPORT
will reclaim the space for cleared entries so that new strings can use
that space.
.Sh ECHO
The echo options controls whether the output from the modem is echoed to
.Ar stderr .
This option may be set with the
.Fl e
option, but it can also be controlled by the
.Ic ECHO
keyword.
The
.Dq expect-send
pair
.Ic ECHO ON
enables echoing, and
.Ic ECHO OFF
disables it.
With this keyword you can select which parts of the conversation should be
visible.
For instance, with the following script:
.Bd -literal -offset indent
ABORT   'BUSY'
ABORT   'NO CARRIER'
\&''      ATZ
OK\er\en  ATD1234567
\er\en    \ec
ECHO    ON
CONNECT \ec
ogin:   account
.Ed
.Pp
all output resulting from modem configuration and dialing is not visible,
but starting with the
.Em CONNECT
(or
.Em BUSY )
message, everything will be echoed.
.Sh HANGUP
The
.Ic HANGUP
options control whether a modem hangup should be considered as an error or not.
This option is useful in scripts for dialing systems which will hang up and
call your system back.
The
.Ic HANGUP
options can be
.Ic ON
or
.Ic OFF .
.Pp
When
.Ic HANGUP
is set
.Ic OFF
and the modem hangs up (e.g., after the first stage of logging in to a
callback system),
.Nm
will continue running the script
(e.g., waiting for the incoming call and second-stage login prompt).
As soon as the incoming call is connected, you should use the
.Ic HANGUP ON
directive to reinstall normal hangup signal behavior.
Here is an example script:
.Bd -literal -offset indent
ABORT   'BUSY'
\&''      ATZ
OK\er\en  ATD1234567
\er\en    \ec
CONNECT \ec
\'Callback login:' call_back_ID
HANGUP OFF
ABORT "Bad Login"
\'Callback Password:' Call_back_password
TIMEOUT 120
CONNECT \ec
HANGUP ON
ABORT "NO CARRIER"
ogin:--BREAK--ogin: real_account
etc ...
.Ed
.Sh TIMEOUT
The initial timeout value is 45 seconds.
This may be changed using the
.Fl t
parameter.
.Pp
The following example illustrates how to change the timeout value for
the next expect string:
.Pp
.Dl "ATZ OK ATDT5551212 CONNECT TIMEOUT 10 ogin:--ogin: TIMEOUT 5 assword: hello2u2"
.Pp
This will change the timeout to 10 seconds when it expects the login: prompt.
The timeout is then changed to 5 seconds when it looks for the password prompt.
.Pp
The timeout, once changed, remains in effect until it is changed again.
.Sh SENDING EOT
The special reply string of
.Ic EOT
indicates that the
.Nm
program should send an EOT character to the remote.
This is normally the End-of-file character sequence.
A return character is not sent following the EOT.
The EOT sequence may be embedded into the send string using the sequence
.Em ^D .
.Sh GENERATING BREAK
The special reply string of
.Ic BREAK
will cause a break condition to be sent.
The break is a special signal on the transmitter.
The normal processing on the receiver is to change the transmission rate.
It may be used to cycle through the available transmission rates on
the remote until you are able to receive a valid login prompt.
The break sequence may be embedded into the send string using the
.Em \eK
sequence.
.Sh ESCAPE SEQUENCES
The expect and reply strings may contain escape sequences.
All of the sequences are legal in the reply string.
Many are legal in the expect string.
Those which are not valid in the expect sequence are so indicated.
.Bl -tag -width Ds
.It ''
Expects or sends a null string.
If you send a null string then it will still send the return character.
This sequence may be a pair of either apostrophe or quote characters.
.It \eb
Represents a backspace character.
.It \ec
Suppresses the newline at the end of the reply string.
This is the only method to send a string without a trailing return character.
It must be at the end of the send string.
For example, the sequence
.Qq hello\ec
will simply send the characters h, e, l, l, o.
(Not valid in expect.)
.It \ed
Delay for one second.
The program uses
.Xr sleep 3
to sleep for one second.
(Not valid in expect.)
.It \eK
Insert a
.Ic BREAK .
(Not valid in expect.)
.It \en
Send a newline or linefeed character.
.It \eN
Send a NUL character.
The same sequence may be represented by \e0.
(Not valid in expect.)
.It \ep
Pause for a fraction of a second.
The delay is 1/10th of a second.
(Not valid in expect.)
.It \eq
Suppress writing the string to the
.Xr syslog 3
file.
The string ?????? is written to the log in its place.
(Not valid in expect.)
.It \er
Send or expect a carriage return.
.It \es
Represents a space character in the string.
This may be used when it is not desirable to quote the strings which
contain spaces.
The sequence 'HI TIM' and HI\esTIM are the same.
.It \et
Send or expect a tab character.
.It \e\e
Send or expect a backslash character.
.It \eddd
Collapse the octal digits (ddd) into a single ASCII character and send that
character.
(Some characters are not valid in expect.)
.It ^C
Substitute the sequence with the control character represented by C.
For example, the character DC1 (17) is shown as ^Q.
(Some characters are not valid in expect.)
.El
.Sh TERMINATION CODES
The
.Nm
program will terminate with the following completion codes:
.Bl -tag -width Ds
.It 0
The normal termination of the program.
This indicates that the script was executed without error to the normal
conclusion.
.It 1
One or more of the parameters are invalid or an expect string was too
large for the internal buffers.
This indicates that the program was not properly executed.
.It 2
An error occurred during the execution of the program.
This may be due to a read or write operation failing for some reason or
.Nm
receiving a signal such as
.Dv SIGINT .
.It 3
A timeout event occurred when there was an
.Dq expect
string without having a
.Dq \-subsend
string.
This may mean that you did not program the script correctly for the condition
or that some unexpected event has occurred and the expected string could not
be found.
.It 4
The first string marked as an
.Ic ABORT
condition occurred.
.It 5
The second string marked as an
.Ic ABORT
condition occurred.
.It 6
The third string marked as an
.Ic ABORT
condition occurred.
.It 7
The fourth string marked as an
.Ic ABORT
condition occurred.
.It ...
The other termination codes are also strings marked as an
.Ic ABORT
condition.
.El
.Pp
Using the termination code, it is possible to determine which event
terminated the script.
It is possible to decide if the string
.Dq BUSY
was received from the modem as opposed to
.Dq NO DIAL TONE .
While the first event may be retried, the second will probably have little
chance of succeeding during a retry.
.\" .Sh SEE ALSO
.\" Additional information about chat scripts may be found with UUCP
.\" documentation.
.\" The chat script was taken from the ideas proposed
.\" by the scripts used by the uucico program.
.\" .Pp
.\" .Xr uucp 1
.Sh COPYRIGHT
The
.Nm
program is in the public domain.
This is not the GNU public license.
If it breaks then you get to keep both pieces.
@


1.18
log
@knock out some "-*- nroff -*-" lines;
@
text
@d1 1
a1 1
.\"	$OpenBSD: chat.8,v 1.17 2009/08/08 18:36:34 jmc Exp $
d4 1
a4 1
.Dd $Mdocdate: August 8 2009 $
d61 6
a66 2
By default, error messages are logged via
.Xr syslog 3 .
d117 5
a121 3
The default is to log via
.Xr syslog 3 ;
the logging method may be altered with the
@


1.17
log
@better synopsis;
@
text
@d1 1
a1 1
.\"	$OpenBSD: chat.8,v 1.16 2009/08/08 14:09:34 sobrado Exp $
a2 1
.\" -*- nroff -*-
@


1.16
log
@add a real synopsis to chat(8); synchronize synopsis and usage;
sort flags in the DESCRIPTION section of the manual page.

synopsis tweaked by jmc@@

ok jmc@@, martynas@@
@
text
@d1 1
a1 1
.\"	$OpenBSD: chat.8,v 1.15 2007/05/31 19:20:28 jmc Exp $
d5 1
a5 1
.Dd $Mdocdate: May 31 2007 $
d15 1
d20 1
a20 1
.Fl f Ar chat_file | script
d43 3
a45 1
The use of this option is mutually exclusive with the chat script parameters.
@


1.15
log
@convert to new .Dd format;
@
text
@d1 1
a1 1
.\"	$OpenBSD: chat.8,v 1.14 2004/04/03 21:53:15 jmc Exp $
d5 1
a5 1
.Dd $Mdocdate$
d13 8
a20 2
.Op Cm options
.Op Ar script
d31 8
a45 9
.It Fl t Ar timeout
Set the timeout for the expected string to be received.
If the string is not received within the time limit then the reply string
is not sent.
An alternate reply may be sent or the script will fail if there
is no alternate reply string.
A failed script will cause the
.Nm
program to terminate with a non-zero error code.
d56 17
a72 7
.It Fl e
Start with the echo option turned on.
Echoing may also be turned on or off at specific points in the chat script
by using the
.Ic ECHO
keyword.
When echoing is enabled, all output from the modem is echoed to
d74 10
a83 3
.It Fl v
Request that the chat script be executed in a verbose mode.
The
d85 5
a89 9
program will then log the execution state of the chat script as well as all
text received from the modem and the output strings sent to the modem.
The default is to log via
.Xr syslog 3 ;
the logging method may be altered with the
.Fl S
and
.Fl s
flags.
d105 9
a113 13
.It Fl s
Use
.Ar stderr .
All log messages from
.Fl v
and all error messages will be sent to
.Ar stderr .
.It Fl S
Do not use
.Xr syslog 3 .
By default, error messages are logged via
.Xr syslog 3 .
The use of
d115 3
a117 11
will prevent both log messages from
.Fl v
and error messages from being logged via
.Xr syslog 3 .
.It Fl T Ar phone_number
Pass in an arbitrary string, usually a phone number, that will be
substituted for the \eT substitution metacharacter in a send string.
.It Fl U Ar phone_number_2
Pass in a second string, usually a phone number, that will be
substituted for the \eU substitution metacharacter in a send string.
This is useful when dialing an ISDN terminal adapter that requires two numbers.
@


1.14
log
@.br workaround no longer necessary;
.Pp removal;
@
text
@d1 1
a1 1
.\"	$OpenBSD: chat.8,v 1.13 2003/06/13 09:56:13 jmc Exp $
d5 1
a5 1
.Dd September 27, 1997
@


1.13
log
@mdoc version of chat(8);
sanity checked and help from pjanzen@@
@
text
@d1 1
a1 1
.\"	$OpenBSD: chat.8,v 1.12 2003/02/01 16:29:52 jmc Exp $
a197 1
.br
a212 1
.Pp
a385 1
.Pp
a428 1
.Pp
a486 1
.Pp
a551 1
.Pp
@


1.12
log
@typos;
chat(8): removed reference to uucico(8)

ok deraadt@@
@
text
@d1 2
d5 101
a105 74
.\" $OpenBSD: chat.8,v 1.11 2002/10/25 05:19:35 jason Exp $
.\" Id: chat.8,v 1.7 1998/02/04 01:35:49 paulus Exp $
.\" SH section heading
.\" SS subsection heading
.\" LP paragraph
.\" IP indented paragraph
.\" TP hanging label
.TH CHAT 8 "27 Sep 1997" "Chat Version 1.17"
.SH NAME
chat \- Automated conversational script with a modem
.SH SYNOPSIS
.B chat
[
.I options
]
.I script
.SH DESCRIPTION
.LP
The \fIchat\fR program defines a conversational exchange between the
computer and the modem. Its primary purpose is to establish a
connection between the Point-to-Point Protocol Daemon (\fIpppd\fR) and
the remote's \fIpppd\fR process.
.SH OPTIONS
.TP
.B -f \fI<chat file>
Read the chat script from the chat \fIfile\fR. The use of this option
is mutually exclusive with the chat script parameters. The user must
have read access to the file. Multiple lines are permitted in the
file. Space or horizontal tab characters should be used to separate
the strings.
.TP
.B -t \fI<timeout>
Set the timeout for the expected string to be received. If the string
is not received within the time limit then the reply string is not
sent. An alternate reply may be sent or the script will fail if there
is no alternate reply string. A failed script will cause the
\fIchat\fR program to terminate with a non-zero error code.
.TP
.B -r \fI<report file>
Set the file for output of the report strings. If you use the keyword
\fIREPORT\fR, the resulting strings are written to this file. If this
option is not used and you still use \fIREPORT\fR keywords, the
\fIstderr\fR file is used for the report strings.
.TP
.B -e
Start with the echo option turned on. Echoing may also be turned on
or off at specific points in the chat script by using the \fIECHO\fR
keyword. When echoing is enabled, all output from the modem is echoed
to \fIstderr\fR.
.TP
.B -v
Request that the \fIchat\fR script be executed in a verbose mode. The
\fIchat\fR program will then log the execution state of the chat
script as well as all text received from the modem and the output
strings sent to the modem.  The default is to log through the SYSLOG;
the logging method may be altered with the -S and -s flags.
.TP
.B -V
Request that the \fIchat\fR script be executed in a stderr verbose
mode. The \fIchat\fR program will then log all text received from the
modem and the output strings sent to the modem to the stderr device. This
device is usually the local console at the station running the chat or
pppd program.
.TP
.B -s
Use stderr.  All log messages from '-v' and all error messages will be
sent to stderr.
.TP
.B -S
Do not use the SYSLOG.  By default, error messages are sent to the
SYSLOG.  The use of -S will prevent both log messages from '-v' and
error messages from being sent to the SYSLOG.
.TP
.B -T \fI<phone number>
d107 2
a108 3
substituted for the \\T substitution metacharacter in a send string.
.TP
.B -U \fI<phone number 2>
d110 51
a160 37
substituted for the \\U substitution metacharacter in a send string.
This is useful when dialing an ISDN terminal adapter that requires two
numbers.
.TP
.B script
If the script is not specified in a file with the \fI-f\fR option then
the script is included as parameters to the \fIchat\fR program.
.SH CHAT SCRIPT
.LP
The \fIchat\fR script defines the communications.
.LP
A script consists of one or more "expect-send" pairs of strings,
separated by spaces, with an optional "subexpect-subsend" string pair,
separated by a dash as in the following example:
.IP
ogin:-BREAK-ogin: ppp ssword: hello2u2
.LP
This line indicates that the \fIchat\fR program should expect the string
"ogin:". If it fails to receive a login prompt within the time interval
allotted, it is to send a break sequence to the remote and then expect the
string "ogin:". If the first "ogin:" is received then the break sequence is
not generated.
.LP
Once it received the login prompt the \fIchat\fR program will send the
string ppp and then expect the prompt "ssword:". When it receives the
prompt for the password, it will send the password hello2u2.
.LP
A carriage return is normally sent following the reply string. It is not
expected in the "expect" string unless it is specifically requested by using
the \\r character sequence.
.LP
The expect sequence should contain only what is needed to identify the
string. Since it is normally stored on a disk file, it should not contain
variable information. It is generally not acceptable to look for time
strings, network identification strings, or other variable pieces of data as
an expect string.
.LP
d162 17
a178 6
sequence, look for the string "ogin:" rather than "login:". It is possible
that the leading "l" character may be received in error and you may never
find the string even though it was sent by the system. For this reason,
scripts look for "ogin:" rather than "login:" and "ssword:" rather than
"password:".
.LP
d180 3
a182 3
.IP
ogin: ppp ssword: hello2u2
.LP
d184 32
a215 21
.LP
In actual practice, simple scripts are rare. At the very least, you
should include sub-expect sequences should the original string not be
received. For example, consider the following script:
.IP
ogin:--ogin: ppp ssword: hello2u2
.LP
This would be a better script than the simple one used earlier. This would look
for the same login: prompt.  If one is not received, a single
return sequence is sent and then it will look for login: again. Should line
noise obscure the first login prompt then sending the empty line will
usually generate a login prompt again.
.SH COMMENTS
Comments can be embedded in the chat script. A comment is a line which
starts with the \fB#\fR (hash) character in column 1. Such comment
lines are just ignored by the chat program. If a '#' character is to
be expected as the first character of the expect sequence, you should
quote the expect string.
If you want to wait for a prompt that starts with a # (hash)
character, you would have to write something like this:
.IP
a216 1
.br
d218 72
a289 39
.LP

.SH ABORT STRINGS
Many modems will report the status of the call as a string. These
strings may be \fBCONNECTED\fR or \fBNO CARRIER\fR or \fBBUSY\fR. It
is often desirable to terminate the script should the modem fail to
connect to the remote. The difficulty is that a script would not know
exactly which modem string it may receive. On one attempt it may
receive \fBBUSY\fR, while the next time it may receive \fBNO CARRIER\fR.
.LP
These "abort" strings may be specified in the script using the \fIABORT\fR
sequence. It is written in the script as in the following example:
.IP
ABORT BUSY ABORT 'NO CARRIER' '' ATZ OK ATDT5551212 CONNECT
.LP
This sequence will expect nothing; and then send the string ATZ. The
expected response to this is the string \fIOK\fR. When it receives \fIOK\fR,
the string ATDT5551212 to dial the telephone. The expected string is
\fICONNECT\fR. If the string \fICONNECT\fR is received the remainder of the
script is executed. However, should the modem find a busy telephone, it will
send the string \fIBUSY\fR. This will cause the string to match the abort
character sequence. The script will then fail because it found a match to
the abort string. If it received the string \fINO CARRIER\fR, it will abort
for the same reason. Either string may be received. Either string will
terminate the \fIchat\fR script.
.SH CLR_ABORT STRINGS
This sequence allows for clearing previously set \fBABORT\fR strings.
\fBABORT\fR strings are kept in an array of a pre-determined size (at
compilation time); \fBCLR_ABORT\fR will reclaim the space for cleared
entries so that new strings can use that space.
.SH SAY STRINGS
The \fBSAY\fR directive allows the script to send strings to the user
at the terminal via standard error.  If \fBchat\fR is being run by
pppd, and pppd is running as a daemon (detached from its controlling
terminal), standard error will normally be redirected to the file
/etc/ppp/connect-errors.
.LP
\fBSAY\fR strings must be enclosed in single or double quotes. If
carriage return and line feed are needed in the string to be output,
d291 4
a294 2
.LP
The SAY strings could be used to give progress messages in sections of
d296 3
a298 2
know what is happening.  An example is:
.IP
a299 1
.br
d301 1
a301 3
.br
SAY "Dialling your ISP...\\n"
.br
a302 1
.br
a303 1
.br
a304 1
.br
d306 1
a306 3
.br
SAY "Connected, now logging in ...\\n"
.br
a307 1
.br
a308 1
.br
d310 9
a318 7
SAY "Logged in OK ...\\n"
\fIetc ...\fR
.LP
This sequence will only present the SAY strings to the user and all
the details of the script will remain hidden. For example, if the
above script works, the user will see:
.IP
d320 2
a321 3
.br
Waiting up to 2 minutes for connection ... Connected, now logging in ...
.br
d323 8
a330 7
.LP

.SH REPORT STRINGS
A \fBreport\fR string is similar to the ABORT string. The difference
is that the strings, and all characters to the next control character
such as a carriage return, are written to the report file.
.LP
d332 6
a337 4
modem's connect string and return the value to the chat user. The
analysis of the report string logic occurs in conjunction with the
other string processing such as looking for the expect string. The use
of the same string for a report and abort sequence is probably not
d339 1
a339 1
.LP
d341 10
a350 6
.LP
These "report" strings may be specified in the script using the \fIREPORT\fR
sequence. It is written in the script as in the following example:
.IP
REPORT CONNECT ABORT BUSY '' ATDT5551212 CONNECT '' ogin: account
.LP
d352 38
a389 19
ATDT5551212 to dial the telephone. The expected string is
\fICONNECT\fR. If the string \fICONNECT\fR is received the remainder
of the script is executed. In addition the program will write to the
expect-file the string "CONNECT" plus any characters which follow it
such as the connection rate.
.SH CLR_REPORT STRINGS
This sequence allows for clearing previously set \fBREPORT\fR strings.
\fBREPORT\fR strings are kept in an array of a pre-determined size (at
compilation time); \fBCLR_REPORT\fR will reclaim the space for cleared
entries so that new strings can use that space.
.SH ECHO
The echo options controls whether the output from the modem is echoed
to \fIstderr\fR. This option may be set with the \fI-e\fR option, but
it can also be controlled by the \fIECHO\fR keyword. The "expect-send"
pair \fIECHO\fR \fION\fR enables echoing, and \fIECHO\fR \fIOFF\fR
disables it. With this keyword you can select which parts of the
conversation should be visible. For instance, with the following
script:
.IP
a390 1
.br
d392 3
a394 7
.br
''      ATZ
.br
OK\\r\\n  ATD1234567
.br
\\r\\n    \\c
.br
d396 1
a396 3
.br
CONNECT \\c
.br
d398 2
a399 1
.LP
d401 33
a433 15
but starting with the \fICONNECT\fR (or \fIBUSY\fR) message, everything
will be echoed.
.SH HANGUP
The HANGUP options control whether a modem hangup should be considered
as an error or not.  This option is useful in scripts for dialling
systems which will hang up and call your system back.  The HANGUP
options can be \fBON\fR or \fBOFF\fR.
.br
When HANGUP is set OFF and the modem hangs up (e.g., after the first
stage of logging in to a callback system), \fBchat\fR will continue
running the script (e.g., waiting for the incoming call and second
stage login prompt). As soon as the incoming call is connected, you
should use the \fBHANGUP ON\fR directive to reinstall normal hang up
signal behavior.  Here is an (simple) example script:
.IP
d435 4
a438 9
.br
''      ATZ
.br
OK\\r\\n  ATD1234567
.br
\\r\\n    \\c
.br
CONNECT \\c
.br
a439 1
.br
a440 1
.br
a441 1
.br
a442 1
.br
d444 1
a444 3
.br
CONNECT \\c
.br
a445 1
.br
a446 1
.br
d448 6
a453 5
.br
\fIetc ...\fR
.LP
.SH TIMEOUT
The initial timeout value is 45 seconds. This may be changed using the \fB-t\fR
d455 9
a463 10
.LP
To change the timeout value for the next expect string, the following
example may be used:
.IP
ATZ OK ATDT5551212 CONNECT TIMEOUT 10 ogin:--ogin: TIMEOUT 5 assword: hello2u2
.LP
This will change the timeout to 10 seconds when it expects the login:
prompt. The timeout is then changed to 5 seconds when it looks for the
password prompt.
.LP
d465 16
a480 12
.SH SENDING EOT
The special reply string of \fIEOT\fR indicates that the chat program
should send an EOT character to the remote. This is normally the
End-of-file character sequence. A return character is not sent
following the EOT.
.PR
The EOT sequence may be embedded into the send string using the
sequence \fI^D\fR.
.SH GENERATING BREAK
The special reply string of \fIBREAK\fR will cause a break condition
to be sent. The break is a special signal on the transmitter. The
normal processing on the receiver is to change the transmission rate.
a482 1
.PR
d484 6
a489 4
\fI\\K\fR sequence.
.SH ESCAPE SEQUENCES
The expect and reply strings may contain escape sequences. All of the
sequences are legal in the reply string. Many are legal in the expect.
d491 7
a497 7
.TP
.B ''
Expects or sends a null string. If you send a null string then it will still
send the return character. This sequence may either be a pair of apostrophe
or quote characters.
.TP
.B \\\\b
d499 19
a517 18
.TP
.B \\\\c
Suppresses the newline at the end of the reply string. This is the only
method to send a string without a trailing return character. It must
be at the end of the send string. For example,
the sequence hello\\c will simply send the characters h, e, l, l, o.
.I (not valid in expect.)
.TP
.B \\\\d
Delay for one second. The program uses sleep(1) which will delay to a
maximum of one second.
.I (not valid in expect.)
.TP
.B \\\\K
Insert a BREAK
.I (not valid in expect.)
.TP
.B \\\\n
d519 15
a533 15
.TP
.B \\\\N
Send a null character. The same sequence may be represented by \\0.
.I (not valid in expect.)
.TP
.B \\\\p
Pause for a fraction of a second. The delay is 1/10th of a second.
.I (not valid in expect.)
.TP
.B \\\\q
Suppress writing the string to the SYSLOG file. The string ?????? is
written to the log in its place.
.I (not valid in expect.)
.TP
.B \\\\r
d535 6
a540 7
.TP
.B \\\\s
Represents a space character in the string. This may be used when it
is not desirable to quote the strings which contain spaces. The
sequence 'HI\ TIM' and HI\\sTIM are the same.
.TP
.B \\\\t
d542 1
a542 2
.TP
.B \\\\\\\\
d544 1
a544 2
.TP
.B \\\\ddd
d547 2
a548 3
.I (some characters are not valid in expect.)
.TP
.B \^^C
d550 14
a563 11
For example, the character DC1 (17) is shown as \^^Q.
.I (some characters are not valid in expect.)
.SH TERMINATION CODES
The \fIchat\fR program will terminate with the following completion
codes.
.TP
.B 0
The normal termination of the program. This indicates that the script
was executed without error to the normal conclusion.
.TP
.B 1
d565 36
a600 28
large for the internal buffers. This indicates that the program was not
properly executed.
.TP
.B 2
An error occurred during the execution of the program. This may be due
to a read or write operation failing for some reason or chat receiving
a signal such as SIGINT.
.TP
.B 3
A timeout event occurred when there was an \fIexpect\fR string without
having a "-subsend" string. This may mean that you did not program the
script correctly for the condition or that some unexpected event has
occurred and the expected string could not be found.
.TP
.B 4
The first string marked as an \fIABORT\fR condition occurred.
.TP
.B 5
The second string marked as an \fIABORT\fR condition occurred.
.TP
.B 6
The third string marked as an \fIABORT\fR condition occurred.
.TP
.B 7
The fourth string marked as an \fIABORT\fR condition occurred.
.TP
.B ...
The other termination codes are also strings marked as an \fIABORT\fR
d602 2
a603 1
.LP
d605 6
a610 3
terminated the script. It is possible to decide if the string "BUSY"
was received from the modem as opposed to "NO DIAL TONE". While the
first event may be retried, the second will probably have little
d612 13
a624 9
.SH SEE ALSO
Additional information about \fIchat\fR scripts may be found with UUCP
documentation. The \fIchat\fR script was taken from the ideas proposed
by the scripts used by the \fIuucico\fR program.
.LP
uucp(1)
.SH COPYRIGHT
The \fIchat\fR program is in public domain. This is not the GNU public
license. If it breaks then you get to keep both pieces.
@


1.11
log
@escape a couple of literal \n's so they print correctly
@
text
@d3 1
a3 1
.\" $OpenBSD: chat.8,v 1.10 1999/09/23 04:12:11 alex Exp $
d22 1
a22 1
computer and the modem. Its primary purpose is to establish the
d162 2
a163 2
exactly which modem string it may receive. On one attempt, it may
receive \fBBUSY\fR while the next time it may receive \fBNO CARRIER\fR.
d247 1
a247 1
The report strings to no change the completion code of the program.
d378 1
a378 1
represents a backspace character.
d417 1
a417 1
is not desirable to quote the strings which contains spaces. The
d445 1
a445 1
large for the internal buffers. This indicates that the program as not
d485 1
a485 1
uucico(1), uucp(1)
@


1.10
log
@Typo fixes.
@
text
@d3 1
a3 1
.\" $OpenBSD: chat.8,v 1.9 1999/06/05 22:17:54 aaron Exp $
d214 1
a214 1
SAY "Connected, now logging in ...\n"
d221 1
a221 1
SAY "Logged in OK ...\n"
@


1.9
log
@remove trailing whitespace, some Nm cleanup
@
text
@d3 1
a3 1
.\" $OpenBSD: chat.8,v 1.8 1999/03/10 21:25:31 pjanzen Exp $
d77 1
a77 1
Pass in an arbitary string, usually a phone number, that will be
@


1.8
log
@fix comma splices involving 'however'
@
text
@d3 1
a3 1
.\" $OpenBSD: chat.8,v 1.7 1999/03/01 06:09:51 aaron Exp $
d83 1
a83 1
This is useful when dialing an ISDN terminal adapter that requires two 
d200 1
a200 1
ABORT BUSY 
d202 1
a202 1
ECHO OFF 
d204 1
a204 1
SAY "Dialling your ISP...\\n" 
d206 1
a206 1
\'' ATDT5551212 
d212 1
a212 1
CONNECT '' 
@


1.7
log
@vary -> very; d@@
@
text
@d3 1
a3 1
.\" $OpenBSD: chat.8,v 1.6 1999/02/24 08:41:06 deraadt Exp $
d139 1
a139 1
for the same login: prompt, however, if one was not received, a single
d245 1
a245 1
very useful, however, it is possible.
@


1.6
log
@keep example on one line; ross@@netbsd
@
text
@d3 1
a3 1
.\" $OpenBSD: chat.8,v 1.5 1998/05/08 04:52:35 millert Exp $
d132 1
a132 1
In actual practice, simple scripts are rare. At the vary least, you
d194 1
a194 1
you must explicitely add them to your string.
@


1.5
log
@pppd 2.3.5
@
text
@d3 1
a3 1
.\" $OpenBSD: chat.8,v 1.4 1998/01/17 20:30:32 millert Exp $
d418 1
a418 1
sequence 'HI TIM' and HI\\sTIM are the same.
@


1.4
log
@ppp-2.3.3 + some -Wall
@
text
@d3 2
a4 2
.\" $OpenBSD: chat.8,v 1.3 1997/09/01 21:48:27 millert Exp $
.\" Id: chat.8,v 1.6 1997/11/27 06:00:06 paulus Exp $
d65 1
a65 4
pppd program. This option will not work properly if the stderr is
redirected to the /dev/null location as is the case should pppd be run
in the 'detached' mode. In that case, use the '-v' option to record
the session on the SYSLOG device.
@


1.3
log
@Update from ppp 3.2.1
@
text
@d2 3
a4 3
.\" manual page [] for chat 1.9
.\" Id: chat.8,v 1.5 1997/07/14 03:49:41 paulus Exp $
.\" $OpenBSD$
d10 1
a10 1
.TH CHAT 8 "5 May 1995" "Chat Version 1.9"
d55 4
a58 2
\fIchat\fR program will then log all text received from the modem and
the output strings which it sends to the SYSLOG.
d63 1
a63 1
modem and the output strings which it sends to the stderr device. This
d69 19
@


1.2
log
@fix typos; khym@@bga.com
@
text
@d2 3
a4 2
.\" manual page [] for chat 1.8
.\" $Id: chat.8,v 1.1.1.1 1995/10/18 08:48:00 deraadt Exp $
d47 6
d58 10
d125 14
d162 54
d242 76
@


1.1
log
@Initial revision
@
text
@d3 1
a3 1
.\" $Id: chat.8,v 1.2 1995/07/04 23:36:22 paulus Exp $
d101 1
a101 1
ogin:--ogin: ppp ssowrd: hello2u2
d164 1
a164 1
ATZ OK ATDT5551212 CONNECT TIMEOUT 10 ogin:--ogin: TIMEOUT 5 assowrd: hello2u2
@


1.1.1.1
log
@initial import of NetBSD tree
@
text
@@
