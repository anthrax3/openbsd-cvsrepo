head	1.38;
access;
symbols
	OPENBSD_5_3:1.37.0.2
	OPENBSD_5_3_BASE:1.37
	OPENBSD_5_2:1.34.0.18
	OPENBSD_5_2_BASE:1.34
	OPENBSD_5_1_BASE:1.34
	OPENBSD_5_1:1.34.0.16
	OPENBSD_5_0:1.34.0.14
	OPENBSD_5_0_BASE:1.34
	OPENBSD_4_9:1.34.0.12
	OPENBSD_4_9_BASE:1.34
	OPENBSD_4_8:1.34.0.10
	OPENBSD_4_8_BASE:1.34
	OPENBSD_4_7:1.34.0.6
	OPENBSD_4_7_BASE:1.34
	OPENBSD_4_6:1.34.0.8
	OPENBSD_4_6_BASE:1.34
	OPENBSD_4_5:1.34.0.4
	OPENBSD_4_5_BASE:1.34
	OPENBSD_4_4:1.34.0.2
	OPENBSD_4_4_BASE:1.34
	OPENBSD_4_3:1.32.0.4
	OPENBSD_4_3_BASE:1.32
	OPENBSD_4_2:1.32.0.2
	OPENBSD_4_2_BASE:1.32
	OPENBSD_4_1:1.31.0.8
	OPENBSD_4_1_BASE:1.31
	OPENBSD_4_0:1.31.0.6
	OPENBSD_4_0_BASE:1.31
	OPENBSD_3_9:1.31.0.4
	OPENBSD_3_9_BASE:1.31
	OPENBSD_3_8:1.31.0.2
	OPENBSD_3_8_BASE:1.31
	OPENBSD_3_7:1.29.0.2
	OPENBSD_3_7_BASE:1.29
	OPENBSD_3_6:1.28.0.4
	OPENBSD_3_6_BASE:1.28
	OPENBSD_3_5:1.28.0.2
	OPENBSD_3_5_BASE:1.28
	OPENBSD_3_4:1.27.0.2
	OPENBSD_3_4_BASE:1.27
	OPENBSD_3_3:1.23.0.2
	OPENBSD_3_3_BASE:1.23
	OPENBSD_3_2:1.22.0.2
	OPENBSD_3_2_BASE:1.22
	OPENBSD_3_1:1.19.0.4
	OPENBSD_3_1_BASE:1.19
	OPENBSD_3_0:1.19.0.2
	OPENBSD_3_0_BASE:1.19
	OPENBSD_2_9_BASE:1.13
	OPENBSD_2_9:1.13.0.2
	OPENBSD_2_8:1.8.0.2
	OPENBSD_2_8_BASE:1.8
	OPENBSD_2_7:1.5.0.2
	OPENBSD_2_7_BASE:1.5
	snap19991220:1.1.1.1
	KAME:1.1.1;
locks; strict;
comment	@.\" @;


1.38
date	2013.03.14.11.08.20;	author mpi;	state dead;
branches;
next	1.37;

1.37
date	2012.09.26.16.19.44;	author jmc;	state Exp;
branches;
next	1.36;

1.36
date	2012.08.18.08.44.25;	author jmc;	state Exp;
branches;
next	1.35;

1.35
date	2012.08.12.17.01.36;	author schwarze;	state Exp;
branches;
next	1.34;

1.34
date	2008.07.19.10.35.31;	author reyk;	state Exp;
branches;
next	1.33;

1.33
date	2008.05.17.23.31.52;	author sobrado;	state Exp;
branches;
next	1.32;

1.32
date	2007.05.31.19.20.23;	author jmc;	state Exp;
branches;
next	1.31;

1.31
date	2005.07.14.15.16.58;	author jmc;	state Exp;
branches;
next	1.30;

1.30
date	2005.06.02.07.51.37;	author jmc;	state Exp;
branches;
next	1.29;

1.29
date	2005.03.01.22.04.35;	author jmc;	state Exp;
branches;
next	1.28;

1.28
date	2004.02.25.08.42.38;	author jmc;	state Exp;
branches;
next	1.27;

1.27
date	2003.08.08.10.13.33;	author jmc;	state Exp;
branches;
next	1.26;

1.26
date	2003.07.02.09.14.30;	author jmc;	state Exp;
branches;
next	1.25;

1.25
date	2003.06.12.12.59.50;	author jmc;	state Exp;
branches;
next	1.24;

1.24
date	2003.04.14.06.51.49;	author jmc;	state Exp;
branches;
next	1.23;

1.23
date	2003.01.18.23.53.49;	author deraadt;	state Exp;
branches;
next	1.22;

1.22
date	2002.05.09.14.26.41;	author itojun;	state Exp;
branches;
next	1.21;

1.21
date	2002.05.09.14.12.17;	author itojun;	state Exp;
branches;
next	1.20;

1.20
date	2002.05.06.23.34.33;	author millert;	state Exp;
branches;
next	1.19;

1.19
date	2001.07.25.10.04.57;	author mpech;	state Exp;
branches;
next	1.18;

1.18
date	2001.07.20.19.09.47;	author mpech;	state Exp;
branches;
next	1.17;

1.17
date	2001.06.30.01.05.23;	author itojun;	state Exp;
branches;
next	1.16;

1.16
date	2001.06.23.05.57.09;	author deraadt;	state Exp;
branches;
next	1.15;

1.15
date	2001.06.23.02.33.07;	author deraadt;	state Exp;
branches;
next	1.14;

1.14
date	2001.05.01.07.40.04;	author itojun;	state Exp;
branches;
next	1.13;

1.13
date	2001.02.15.17.56.28;	author itojun;	state Exp;
branches;
next	1.12;

1.12
date	2001.02.15.17.51.27;	author itojun;	state Exp;
branches;
next	1.11;

1.11
date	2001.02.15.17.43.36;	author itojun;	state Exp;
branches;
next	1.10;

1.10
date	2001.02.15.17.37.33;	author itojun;	state Exp;
branches;
next	1.9;

1.9
date	2001.02.15.16.35.16;	author todd;	state Exp;
branches;
next	1.8;

1.8
date	2000.09.16.10.33.44;	author itojun;	state Exp;
branches;
next	1.7;

1.7
date	2000.07.03.06.44.46;	author itojun;	state Exp;
branches;
next	1.6;

1.6
date	2000.05.31.03.09.22;	author itojun;	state Exp;
branches;
next	1.5;

1.5
date	2000.04.12.21.47.52;	author aaron;	state Exp;
branches;
next	1.4;

1.4
date	2000.03.12.16.50.26;	author itojun;	state Exp;
branches;
next	1.3;

1.3
date	2000.02.25.10.25.46;	author itojun;	state Exp;
branches;
next	1.2;

1.2
date	99.12.20.16.32.53;	author itojun;	state Exp;
branches;
next	1.1;

1.1
date	99.12.20.16.07.42;	author itojun;	state Exp;
branches
	1.1.1.1;
next	;

1.1.1.1
date	99.12.20.16.07.42;	author itojun;	state Exp;
branches;
next	;


desc
@@


1.38
log
@tedu faithd(8), suggested by todd@@ some weeks ago after a submission by
dhill.

ok krw@@, mikeb@@, tedu@@ (implicit)
@
text
@.\"	$OpenBSD: faithd.8,v 1.37 2012/09/26 16:19:44 jmc Exp $
.\"	$KAME: faithd.8,v 1.36 2002/05/09 13:59:16 itojun Exp $
.\"
.\" Copyright (C) 1995, 1996, 1997, and 1998 WIDE Project.
.\" All rights reserved.
.\"
.\" Redistribution and use in source and binary forms, with or without
.\" modification, are permitted provided that the following conditions
.\" are met:
.\" 1. Redistributions of source code must retain the above copyright
.\"    notice, this list of conditions and the following disclaimer.
.\" 2. Redistributions in binary form must reproduce the above copyright
.\"    notice, this list of conditions and the following disclaimer in the
.\"    documentation and/or other materials provided with the distribution.
.\" 3. Neither the name of the project nor the names of its contributors
.\"    may be used to endorse or promote products derived from this software
.\"    without specific prior written permission.
.\"
.\" THIS SOFTWARE IS PROVIDED BY THE PROJECT AND CONTRIBUTORS ``AS IS'' AND
.\" ANY EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT LIMITED TO, THE
.\" IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE
.\" ARE DISCLAIMED.  IN NO EVENT SHALL THE PROJECT OR CONTRIBUTORS BE LIABLE
.\" FOR ANY DIRECT, INDIRECT, INCIDENTAL, SPECIAL, EXEMPLARY, OR CONSEQUENTIAL
.\" DAMAGES (INCLUDING, BUT NOT LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS
.\" OR SERVICES; LOSS OF USE, DATA, OR PROFITS; OR BUSINESS INTERRUPTION)
.\" HOWEVER CAUSED AND ON ANY THEORY OF LIABILITY, WHETHER IN CONTRACT, STRICT
.\" LIABILITY, OR TORT (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY
.\" OUT OF THE USE OF THIS SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF
.\" SUCH DAMAGE.
.\"
.Dd $Mdocdate: September 26 2012 $
.Dt FAITHD 8
.Os
.Sh NAME
.Nm faithd
.Nd FAITH IPv6/v4 translator daemon
.Sh SYNOPSIS
.Nm
.Op Fl dp
.Op Fl f Ar configfile
.Ar service
.Op Ar serverpath Op Ar serverargs
.\".Nm ""
.Sh DESCRIPTION
.Nm
provides an IPv6-to-IPv4 TCP relay.
.Nm
must be used on an IPv4/v6 dual stack router.
.Pp
When
.Nm
receives
.Tn TCPv6
traffic,
.Nm
will relay the
.Tn TCPv6
traffic to
.Tn TCPv4 .
The destination for the relayed
.Tn TCPv4
connection is determined by the last 4 octets of the original
.Tn IPv6
destination.
For example, if
.Li 2001:db8:4819:ffff::
is reserved for
.Nm faithd ,
and the
.Tn TCPv6
destination address is
.Li 2001:db8:4819:ffff::0a01:0101 ,
the traffic is relayed to IPv4 destination
.Li 10.1.1.1 .
.Pp
To use the
.Nm
translation service,
an IPv6 address prefix must be reserved for mapping IPv4 addresses onto.
The kernel must be properly configured to route all the TCP connections
toward the reserved IPv6 address prefix into the
.Xr faith 4
pseudo interface, by using the
.Xr route 8
command.
Also,
.Xr sysctl 8
should be used to configure
.Dv net.inet6.ip6.keepfaith
to
.Dv 1 .
.Pp
The router must be configured to capture all the TCP traffic
for a given reserved
.Tn IPv6
address prefix, by using the
.Xr route 8
and
.Xr sysctl 8
commands.
.Pp
.Nm
needs a special name-to-address translation logic, so that
hostnames get resolved into a special
.Tn IPv6
address prefix.
For small-scale installation, use
.Xr hosts 5 .
For large-scale installation, it is useful to have
a DNS server with special address translation support.
An implementation called
.Nm totd
is available
at
.Lk http://www.dillema.net/software/totd.html .
Make sure you do not propagate translated DNS records to normal DNS cloud,
it is highly harmful.
.\".Ss Daemon mode
When
.Nm
.\"is invoked as a stand-alone program,
is invoked,
.Nm
will daemonize itself.
.Nm
will listen to
.Tn TCPv6
port
.Ar service .
If
.Tn TCPv6
traffic to port
.Ar service
is found, it relays the connection.
.Pp
Since
.Nm
listens to TCP port
.Ar service ,
it is not possible to run local TCP daemons for port
.Ar service
on the router, using
.Xr inetd 8
or other standard mechanisms.
Local daemons can be run on the router
by specifying a
.Ar serverpath
to
.Nm faithd .
.Nm
will invoke a local daemon at
.Ar serverpath
if the destination address is a local interface address,
and will perform translation to IPv4 TCP in other cases.
.Ar serverargs
can also be specified as
arguments for the local daemon.
.Pp
The following options are available:
.Bl -tag -width indent
.It Fl d
Debugging information will be generated using
.Xr syslog 3 .
.It Fl f Ar configfile
Specify a configuration file for access control.
See below.
.It Fl p
Use the privileged TCP port number as a source port,
for an IPv4 TCP connection toward the final destination.
For relaying
.Xr ftp 1
this flag is not necessary as special program code is supplied.
.El
.Pp
.Nm
will relay both normal and out-of-band TCP data.
It is capable of emulating TCP half close as well.
.Nm
includes special support for protocols used by
.Xr ftp 1 .
When translating FTP protocol,
.Nm
translates network level addresses in
.Li PORT/LPRT/EPRT
and
.Li PASV/LPSV/EPSV
commands.
.Pp
Inactive sessions will be disconnected in 30 minutes,
to avoid stale sessions from chewing up resources.
This may be inappropriate for some of the services
.Pq should this be configurable? .
.Ss Access control
To prevent malicious access,
.Nm
implements a simple address-based access control.
With
.Pa /etc/faithd.conf
.Po
or
.Ar configfile
specified by
.Fl f
.Pc ,
.Nm
will avoid relaying unwanted traffic.
.Pa faithd.conf
contains directives with the following format:
.Bl -bullet
.It
.Xo
.Ar src/slen Li deny Ar dst/dlen
.Xc
.Pp
If the source address of a query matches
.Ar src/slen ,
and the translated destination address matches
.Ar dst/dlen ,
deny the connection.
.It
.Xo
.Ar src/slen Li permit Ar dst/dlen
.Xc
.Pp
If the source address of a query matches
.Ar src/slen ,
and the translated destination address matches
.Ar dst/dlen ,
permit the connection.
.El
.Pp
The directives are evaluated in sequence,
and the first matching entry will be effective.
If there is no match
.Pq the end of the ruleset has been reached ,
the traffic is denied.
.\".Pp
.\"With inetd mode,
.\"traffic may be filtered by using access control functionality in
.\".Xr inetd 8 .
.Sh RETURN VALUES
.Nm
exits with
.Dv EXIT_SUCCESS
.Pq 0
on success, and
.Dv EXIT_FAILURE
.Pq 1
on error.
.Sh EXAMPLES
Before invoking
.Nm faithd ,
the
.Xr faith 4
interface has to be configured properly:
.Bd -literal -offset indent
# sysctl net.inet6.ip6.accept_rtadv=0
# sysctl net.inet6.ip6.forwarding=1
# sysctl net.inet6.ip6.keepfaith=1
# ifconfig faith0 up
# route add -inet6 2001:db8:4819:ffff:: -prefixlen 96 ::1
# route change -inet6 2001:db8:4819:ffff:: -prefixlen 96 -ifp faith0
.Ed
.\".Ss Daemon mode samples
.Pp
To translate
.Li telnet
service, and provide no local telnet service, invoke
.Nm
as follows:
.Pp
.Dl # faithd telnet
.Pp
Pass extra arguments to the local daemon:
.Pp
.Dl # faithd ftp /usr/libexec/ftpd ftpd -l
.Ss Access control samples
The following illustrates a simple
.Pa faithd.conf
setting.
.Bd -literal -offset indent
# Permit anyone from 2001:db8:ffff::/48 to use the translator,
# to connect to the following IPv4 destinations:
# - any location except 10.0.0.0/8 and 127.0.0.0/8.
# Permit no other connections.
#
2001:db8:ffff::/48 deny 10.0.0.0/8
2001:db8:ffff::/48 deny 127.0.0.0/8
2001:db8:ffff::/48 permit 0.0.0.0/0
.Ed
.Sh SEE ALSO
.Xr faith 4 ,
.Xr route 8 ,
.Xr sysctl 8
.Sh STANDARDS
.Rs
.%A J. Hagino
.%A K. Yamamoto
.%D June 2001
.%R RFC 3142
.%T "An IPv6-to-IPv4 Transport Relay Translator"
.Re
.\"
.Sh HISTORY
The
.Nm
command first appeared in the WIDE Hydrangea IPv6 protocol stack kit.
.\"
.Sh SECURITY CONSIDERATIONS
It is very insecure to use IP-address-based authentication
for connections relayed by
.Nm .
.Pp
Administrators are advised to limit access to
.Nm
using
.Pa faithd.conf ,
or by using IPv6 packet filters,
to protect the
.Nm
service from malicious parties and avoid theft of service/bandwidth.
IPv6 destination addresses can be limited by
carefully configuring routing entries that point to
.Xr faith 4 ,
using
.Xr route 8 .
IPv6 source addresses need to be filtered using a packet filter.
The documents listed in
.Sx SEE ALSO
have more discussions on this topic.
@


1.37
log
@last stage of rfc changes, using consistent Rs/Re blocks, and moving the
references into a STANDARDS section;
@
text
@d1 1
a1 1
.\"	$OpenBSD: faithd.8,v 1.36 2012/08/18 08:44:25 jmc Exp $
d31 1
a31 1
.Dd $Mdocdate: August 18 2012 $
@


1.36
log
@within Rs/Re reference blocks, use %U instead of %O (or any other
variants) for URLs, allowing mandoc -Thtml to properly generate links;

(sendmail.8 changes are simply using Lk, which i somehow missed in previous)

ingo reminded me to verify that gnu groff recognises %U: 1.20.1 does not,
but 1.21 does;
@
text
@d1 1
a1 1
.\"	$OpenBSD: faithd.8,v 1.35 2012/08/12 17:01:36 schwarze Exp $
d31 1
a31 1
.Dd $Mdocdate: August 12 2012 $
d295 1
d297 2
a298 5
.%A Jun-ichiro itojun Hagino
.%A Kazu Yamamoto
.%T "An IPv6-to-IPv4 transport relay translator"
.%B RFC 3142
.%U ftp://ftp.isi.edu/in-notes/rfc3142.txt
d300 2
@


1.35
log
@Use .Lk for HTTP hyperlinks, not .Pa.
Most of the patch from Arto Jonsson <ajonsson at kapsi dot fi>.
jmc@@ agrees in principle that .Lk is the right macro to use.

While here, update a few broken links,
and add missing markup at a few places.
@
text
@d1 1
a1 1
.\"	$OpenBSD: faithd.8,v 1.34 2008/07/19 10:35:31 reyk Exp $
d31 1
a31 1
.Dd $Mdocdate: July 19 2008 $
d300 1
a300 1
.%O ftp://ftp.isi.edu/in-notes/rfc3142.txt
@


1.34
log
@Use the IPv6 documentation prefix 2001:db8::/32 from RFC 3849 instead
of the deprecated 3ffe::/16 6bone test address space.  Deprecated or
public IPv6 allocations should not be used for documentation; we have
the same approach for IPv4 by using RFC 1918 private addresses.

ok jmc@@ todd@@
@
text
@d1 1
a1 1
.\"	$OpenBSD: faithd.8,v 1.33 2008/05/17 23:31:52 sobrado Exp $
d31 1
a31 1
.Dd $Mdocdate: May 17 2008 $
d115 1
a115 1
.Pa http://www.vermicelli.pasta.cs.uit.no/ipv6/software.html .
@


1.33
log
@documentation tweaks.

ok (some time ago) jmc@@
@
text
@d1 1
a1 1
.\"	$OpenBSD: faithd.8,v 1.32 2007/05/31 19:20:23 jmc Exp $
d31 1
a31 1
.Dd $Mdocdate: May 31 2007 $
d66 1
a66 1
.Li 3ffe:0501:4819:ffff::
d72 1
a72 1
.Li 3ffe:0501:4819:ffff::0a01:0101 ,
d261 2
a262 2
# route add -inet6 3ffe:501:4819:ffff:: -prefixlen 96 ::1
# route change -inet6 3ffe:501:4819:ffff:: -prefixlen 96 -ifp faith0
d282 1
a282 1
# Permit anyone from 3ffe:501:ffff::/48 to use the translator,
d287 3
a289 3
3ffe:501:ffff::/48 deny 10.0.0.0/8
3ffe:501:ffff::/48 deny 127.0.0.0/8
3ffe:501:ffff::/48 permit 0.0.0.0/0
@


1.32
log
@convert to new .Dd format;
@
text
@d1 1
a1 1
.\"	$OpenBSD: faithd.8,v 1.31 2005/07/14 15:16:58 jmc Exp $
d31 1
a31 1
.Dd $Mdocdate$
d155 1
a155 1
.Ar Serverargs
@


1.31
log
@improvements from tamas tevesz;
@
text
@d1 1
a1 1
.\"	$OpenBSD: faithd.8,v 1.30 2005/06/02 07:51:37 jmc Exp $
d31 1
a31 1
.Dd May 17, 1998
@


1.30
log
@remove references to telnetd(8);
ok deraadt@@
@
text
@d1 1
a1 1
.\"	$OpenBSD: faithd.8,v 1.29 2005/03/01 22:04:35 jmc Exp $
d307 1
a307 1
command first appeared in WIDE Hydrangea IPv6 protocol stack kit.
d310 3
a312 3
It is very insecure to use IP-address based authentication, for connections relayed by
.Nm faithd ,
and any other TCP relaying services.
d314 1
a314 1
Administrators are advised to limit accesses to
d328 1
a328 1
Documents listed in
@


1.29
log
@provide missing `indent' argument to -offset in displays;
convert some displays to .Dl where it's simpler;
@
text
@d1 1
a1 1
.\"	$OpenBSD: faithd.8,v 1.28 2004/02/25 08:42:38 jmc Exp $
a273 7
Provide local telnet service via
.Xr telnetd 8
using
.Pa /usr/libexec/telnetd :
.Pp
.Dl # faithd telnet /usr/libexec/telnetd telnetd
.Pp
a276 9
.Pp
Here are some other examples.
If the service checks the source port range,
.Fl p
may be required.
.Bd -literal -offset indent
# faithd ssh
# faithd telnet /usr/libexec/telnetd telnetd
.Ed
@


1.28
log
@remove -w option to sysctl;

diffs from Paul de Weerd;
ok deraadt@@
@
text
@d1 1
a1 1
.\"	$OpenBSD: faithd.8,v 1.27 2003/08/08 10:13:33 jmc Exp $
d256 1
a256 1
.Bd -literal -offset
d271 2
a272 3
.Bd -literal -offset
# faithd telnet
.Ed
d277 3
a279 4
.Pa /usr/libexec/telnetd .
.Bd -literal -offset
# faithd telnet /usr/libexec/telnetd telnetd
.Ed
d282 2
a283 3
.Bd -literal -offset
# faithd ftp /usr/libexec/ftpd ftpd -l
.Ed
d289 1
a289 1
.Bd -literal -offset
d297 2
a298 2
.Bd -literal -offset
# permit anyone from 3ffe:501:ffff::/48 to use the translator,
@


1.27
log
@refer to RFCs consistently (RFC XXXX);
@
text
@d1 1
a1 1
.\"	$OpenBSD: faithd.8,v 1.26 2003/07/02 09:14:30 jmc Exp $
d257 3
a259 3
# sysctl -w net.inet6.ip6.accept_rtadv=0
# sysctl -w net.inet6.ip6.forwarding=1
# sysctl -w net.inet6.ip6.keepfaith=1
@


1.26
log
@.Ic Ar -> .Ar
from wiz@@netbsd;
@
text
@d1 1
a1 1
.\"	$OpenBSD: faithd.8,v 1.25 2003/06/12 12:59:50 jmc Exp $
d318 1
a318 1
.%B RFC3142
@


1.25
log
@- section reorder
- macro fixes
- kill whitespace at EOL
- new sentence, new line
@
text
@d1 1
a1 1
.\"	$OpenBSD: faithd.8,v 1.24 2003/04/14 06:51:49 jmc Exp $
d212 1
a212 1
.Ic Ar src/slen Li deny Ar dst/dlen
d222 1
a222 1
.Ic Ar src/slen Li permit Ar dst/dlen
@


1.24
log
@standalone/stand alone -> stand-alone;

from NetBSD (Igor Sobrado);
httpd stuff passed to apache people;

ok millert@@
@
text
@d1 1
a1 1
.\"	$OpenBSD: faithd.8,v 1.23 2003/01/18 23:53:49 deraadt Exp $
d68 1
a68 1
.Nm Ns ,
d149 1
a149 1
.Nm Ns .
d252 1
a252 1
.Nm Ns ,
d330 1
a330 1
.Nm Ns ,
d346 1
a346 1
IPv6 source addresses need to be filtered  using a packet filter.
@


1.23
log
@inet6 fixes from jmc@@prioris.mini.pw.edu.pl
@
text
@d1 1
a1 1
.\"	$OpenBSD: faithd.8,v 1.22 2002/05/09 14:26:41 itojun Exp $
d121 1
a121 1
.\"is invoked as a standalone program,
@


1.22
log
@obey mdoc(7) section ordering.  sync w/kame
@
text
@d1 1
a1 1
.\"	$OpenBSD: faithd.8,v 1.21 2002/05/09 14:12:17 itojun Exp $
d46 1
a46 1
provides IPv6-to-IPv4 TCP relay.
d60 1
a60 1
Destination for relayed
d62 1
a62 1
connection will be determined by the last 4 octets of the original
d73 1
a73 1
the traffic will be relayed to IPv4 destination
d76 1
a76 1
To use
d79 2
a80 2
an IPv6 address prefix must be reserved for mapping IPv4 addresses into.
Kernel must be properly configured to route all the TCP connection
d83 1
a83 1
pseudo interface, by using
d94 1
a94 1
toward reserved
d96 1
a96 1
address prefix, by using
d104 1
a104 1
hostnames gets resolved into special
d145 2
a146 1
By specifying
d149 1
a149 2
.Nm Ns ,
you can run local daemons on the router.
d151 1
a151 1
will invoke local daemon at
d153 1
a153 1
if the destination address is local interface address,
d155 3
a157 3
You can also specify
.Ar serverargs
for the arguments for the local daemon.
d168 2
a169 2
Use privileged TCP port number as source port,
for IPv4 TCP connection toward final destination.
d194 1
a194 1
To prevent malicious accesses,
a206 1
The
d235 2
a236 2
.Pq if we reach the end of the ruleset
the traffic will be denied.
d253 1
d255 1
a255 1
interface has to be configured properly.
d265 1
d275 1
a275 1
If you would like to provide local telnet service via
d277 2
a278 3
on
.Pa /usr/libexec/telnetd ,
use the following command line:
d283 1
a283 1
If you would like to pass extra arguments to the local daemon:
d289 1
a289 1
You may need
d291 1
a291 1
if the service checks the source port range.
d337 2
a338 2
or by using IPv6 packet filters.
It is to protect
d341 2
a342 2
IPv6 destination address can be limited by
carefully configuring routing entries that points to
d346 1
a346 1
IPv6 source address needs to be filtered by using packet filters.
@


1.21
log
@drop support for rlogin/rsh service (we shouldn't have support it as
they usually use IP address for authentication).  sync with kame
@
text
@d1 1
a1 1
.\"	$OpenBSD: faithd.8,v 1.20 2002/05/06 23:34:33 millert Exp $
d242 9
a309 9
.Sh RETURN VALUES
.Nm
exits with
.Dv EXIT_SUCCESS
.Pq 0
on success, and
.Dv EXIT_FAILURE
.Pq 1
on error.
@


1.20
log
@Kill/adjust r(login|exec)d? references now that those are no longer in
the tree.
@
text
@d1 2
a2 2
.\"	$OpenBSD: faithd.8,v 1.19 2001/07/25 10:04:57 mpech Exp $
.\"	$KAME: faithd.8,v 1.31 2001/06/30 00:57:01 itojun Exp $
a117 1
.Pp
a171 2
and
.Xr rsh 1 ,
d180 1
a180 3
.Xr ftp 1
and
.Xr rsh 1 .
a187 7
For RLOGIN protocol,
.Nm
will relay back connection from
.Nm rlogind
on the server to
.Nm rlogin
on client.
d235 3
d240 1
a240 1
.\"traffic may be filtered by using access control functionality in 
a254 1
.Pp
d282 1
a282 1
to translate rsh/rlogin services.
d285 1
a285 2
# faithd login /usr/libexec/rlogin rlogind
# faithd shell /usr/libexec/rshd rshd
a286 6
.Pp
However, you should be careful when translating rlogin or rsh
connections.
See
.Sx SECURITY CONSIDERATIONS
for more details.
d329 1
a329 3
It is very insecure to use
.Xr rhosts 5
and other IP-address based authentication, for connections relayed by
@


1.19
log
@We have to undo the changes to the 3rd party code, because it makes
upgrading those components hell.

Tip of the day: Don't commit without confirmation.
@
text
@d1 1
a1 1
.\"	$OpenBSD: faithd.8,v 1.18 2001/07/20 19:09:47 mpech Exp $
d174 1
a174 1
.Xr rlogin 1 ,
d185 1
a185 1
.Xr rlogin 1 .
d196 1
a196 1
.Xr rlogind 8
d198 1
a198 1
.Xr rlogin 1
@


1.18
log
@we don't like:
o) .Pp before/after .Sh;
o) .Pp before/after .Sh;
o) .Nm without argument in SYNOPSIS;
@
text
@d1 1
a1 1
.\"	$OpenBSD: faithd.8,v 1.17 2001/06/30 01:05:23 itojun Exp $
d38 1
a38 1
.Nm faithd
@


1.17
log
@faith(4) is now documented in RFC3142.
@
text
@d1 1
a1 1
.\"	$OpenBSD: faithd.8,v 1.16 2001/06/23 05:57:09 deraadt Exp $
d38 1
a38 1
.Nm
@


1.16
log
@ok, tmac is now fixed
@
text
@d1 2
a2 2
.\"	$OpenBSD: faithd.8,v 1.15 2001/06/23 02:33:07 deraadt Exp $
.\"	$KAME: faithd.8,v 1.28 2001/04/25 11:24:15 itojun Exp $
d335 3
a337 3
.%R internet draft
.%N draft-ietf-ngtrans-tcpudp-relay-04.txt
.%O work in progress material
d349 2
a350 2
.Nm
.Pq and any other TCP relaying services .
@


1.15
log
@join .%A entries; most by bk@@rt.fm
@
text
@d1 1
a1 1
.\"	$OpenBSD: faithd.8,v 1.14 2001/05/01 07:40:04 itojun Exp $
d332 2
a333 1
.%A Jun-ichiro itojun Hagino and Kazu Yamamoto
@


1.14
log
@avodi null pointer dereference.  sync with kame
@
text
@d1 1
a1 1
.\"	$OpenBSD: faithd.8,v 1.13 2001/02/15 17:56:28 itojun Exp $
d332 1
a332 2
.%A Jun-ichiro itojun Hagino
.%A Kazu Yamamoto
@


1.13
log
@obey mdoc(4).
@
text
@d1 2
a2 2
.\"	$OpenBSD: faithd.8,v 1.12 2001/02/15 17:51:27 itojun Exp $
.\"	$KAME: faithd.8,v 1.26 2001/02/15 17:55:54 itojun Exp $
d336 1
a336 1
.%N draft-ietf-ngtrans-tcpudp-relay-01.txt
@


1.12
log
@kill old default port number (telnet was assumed before)
@
text
@d1 2
a2 2
.\"	$OpenBSD: faithd.8,v 1.11 2001/02/15 17:43:36 itojun Exp $
.\"	$KAME: faithd.8,v 1.24 2001/02/15 17:51:46 itojun Exp $
d302 1
a302 1
.Sx SECURITY NOTICE
d339 7
a345 1
.Sh SECURITY NOTICE
a368 5
.\"
.Sh HISTORY
The
.Nm
command first appeared in WIDE Hydrangea IPv6 protocol stack kit.
@


1.11
log
@no argument is not permitted (inetd mode disabled for openbsd)
@
text
@d1 2
a2 2
.\"	$OpenBSD: faithd.8,v 1.10 2001/02/15 17:37:33 itojun Exp $
.\"	$KAME: faithd.8,v 1.20 2001/01/22 02:23:40 itojun Exp $
d270 1
a270 1
as either of the following:
a271 1
# faithd
@


1.10
log
@pull latest KAME faithd.  access control is possible by /etc/faithd.conf.
req'ed by todd
@
text
@d1 1
a1 1
.\"	$OpenBSD: faithd.8,v 1.9 2001/02/15 16:35:16 todd Exp $
d43 1
a43 1
.Nm ""
@


1.9
log
@sshd is not in /etc/services, but ssh is .. provide a working example.
@
text
@d1 2
a2 2
.\"	$OpenBSD: faithd.8,v 1.8 2000/09/16 10:33:44 itojun Exp $
.\"	$KAME: faithd.8,v 1.14 2000/09/12 05:20:35 itojun Exp $
d40 1
d101 18
d160 4
a163 3
If
.Fl d
is given, debugging information will be generated using
d165 5
a169 5
If
.Fl p
is given,
.Nm
will use privileged TCP port number as source port,
d175 2
a176 2
.Fl p
is not necessary as special program code is supplied.
d205 46
d264 1
d287 1
a287 1
# faithd ftpd /usr/libexec/ftpd ftpd -l
d301 2
a302 1
connections. See
d305 14
d347 6
d354 1
a354 3
itself does not implement access controls, as
it intends to implement transparent TCP relay services.
Administrators are advised to filter packets based on IPv6 address.
@


1.8
log
@synchronize with latest kame.
- improve exit code and logging.
- repair multicast address rejection (IN_MULTICAST takes host endian value)
- repair ftp relaying, when the result of PASV does not have paren.
- repair ftp relaying, when EPSV is sent from client.
@
text
@d1 1
a1 1
.\"	$OpenBSD: faithd.8,v 1.7 2000/07/03 06:44:46 itojun Exp $
d228 1
a228 1
# faithd sshd
@


1.7
log
@add warning on rsh/rlogin relay
@
text
@d1 2
a2 2
.\"	$OpenBSD: faithd.8,v 1.6 2000/05/31 03:09:22 itojun Exp $
.\"	$KAME: faithd.8,v 1.11 2000/07/03 06:35:25 jinmei Exp $
d40 3
a42 1
.Op Ar service Op Ar serverpath Op Ar serverargs
d45 1
a45 3
provides IPv6/v4 TCP relay for the specified
.Ar service .
.Pp
d47 1
a47 11
must be invoked on IPv4/v6 dual stack router.
The router must be configured to capture all the TCP traffic
toward reserved
.Tn IPv6
address prefix, by using
.Xr route 8
and
.Xr sysctl 8
commands.
.Nm
will daemonize itself on invocation.
d49 1
d51 1
a51 1
will listen to
d53 1
a53 7
port
.Ar service .
If
.Tn TCPv6
traffic to port
.Ar service
is found,
d75 30
a104 5
If
.Ar service
is not given,
.Li telnet
is assumed, and
d106 1
a106 4
will relay TCP traffic on TCP port
.Li telnet .
With
.Ar service ,
d108 7
a114 1
will work as TCP relaying daemon for specified
d116 1
a116 1
as described above.
a140 17
To use
.Nm
translation service,
an IPv6 address prefix must be reserved for mapping IPv4 addresses into.
Kernel must be properly configured to route all the TCP connection
toward the reserved IPv6 address prefix into the
.Dv faith
pseudo interface, by using
.Xr route 8
command.
Also,
.Xr sysctl 8
should be used to configure
.Dv net.inet6.ip6.keepfaith
to
.Dv 1 .
.Pp
d190 9
a198 1
.Pp
d213 1
a213 1
user the following command line:
d223 4
a226 1
Here are some other examples:
@


1.6
log
@sync with the latest kame code.  insufficient len in malloc() call is
corrected.
@
text
@d1 2
a2 2
.\"	$OpenBSD: faithd.8,v 1.5 2000/04/12 21:47:52 aaron Exp $
.\"	$KAME: faithd.8,v 1.9 2000/05/31 03:06:07 itojun Exp $
d221 1
a223 1
# faithd sshd
d225 5
@


1.5
log
@Trailing whitespace begone!
@
text
@d1 2
a2 1
.\"	$OpenBSD: faithd.8,v 1.4 2000/03/12 16:50:26 itojun Exp $
a30 2
.\"	KAME Id: faithd.8,v 1.6 2000/03/12 16:49:34 itojun Exp
.\"
d38 1
a38 1
.Nm faithd
d40 1
a40 7
.Oo
.Ar service
.Oo
.Ar serverpath
.Op Ar serverargs
.Oc
.Oc
d49 3
a51 1
toward reserved IPv6 address prefix, by using
d60 3
a62 1
will listen to TCPv6 port
d64 3
a66 1
If TCPv6 traffic to port
d70 9
a78 3
will relay the TCPv6 traffic to TCPv4.
Destination for relayed TCPv4 connection will be determined by the
last 4 octets of the original IPv6 destination.
d82 4
a85 2
.Nm faithd ,
and the TCPv6 destination address is
d117 1
a117 1
.Nm faithd ,
d188 1
a188 4
.Po
should this be configurable?
.Pc .
.\"
d191 1
a191 1
.Nm faithd ,
a224 1
.\"
a233 1
.\"
d243 1
a243 1
.%N draft-ietf-ngtrans-tcpudp-relay-00.txt
a245 1
.\"
d251 1
a251 3
.Po
and any other TCP relaying services
.Pc .
@


1.4
log
@improve SECURITY section.  sync with kame.
@
text
@d1 1
a1 1
.\"	$OpenBSD: faithd.8,v 1.3 2000/02/25 10:25:46 itojun Exp $
d5 1
a5 1
.\" 
d17 1
a17 1
.\" 
d125 1
a125 1
Kernel must be properly configured to route all the TCP connection 
d155 1
a155 1
.Nm 
d198 1
a198 1
# faithd telnet 
d255 1
a255 1
itself does not implement access controls, as 
@


1.3
log
@use getifaddrs, not SIOCGIFCONF, to avoid LP64 alignment issues.
@
text
@d1 1
a1 1
.\"	$OpenBSD: faithd.8,v 1.2 1999/12/20 16:32:53 itojun Exp $
d30 1
a30 1
.\"	KAME Id: faithd.8,v 1.4 2000/01/22 07:56:48 itojun Exp
d253 14
@


1.2
log
@rcsid police.
pathname change (/usr/local/v6/libexec -> /usr/libexec)
bring in some of kame fixes (sprintf -> snprintf, proc title).
@
text
@d1 1
a1 1
.\"	$OpenBSD$
d30 1
a30 1
.\"	KAME Id: faithd.8,v 1.1.1.1 1999/12/20 16:07:42 itojun Exp
d236 8
@


1.1
log
@Initial revision
@
text
@d1 2
d30 1
a30 1
.\"	$Id: faithd.8,v 1.3 1999/10/07 04:22:14 itojun Exp $
d34 1
a34 1
.Os KAME
d204 1
a204 1
.Pa /usr/local/v6/libexec/telnetd ,
d207 1
a207 1
# faithd telnet /usr/local/v6/libexec/telnetd telnetd
d212 1
a212 1
# faithd ftpd /usr/local/v6/libexec/ftpd ftpd -l
d217 2
a218 2
# faithd login /usr/local/v6/libexec/rlogin rlogind
# faithd shell /usr/local/v6/libexec/rshd rshd
@


1.1.1.1
log
@faith translator deamon, from KAME
@
text
@@
