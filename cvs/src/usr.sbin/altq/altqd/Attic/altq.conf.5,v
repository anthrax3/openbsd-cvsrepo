head	1.9;
access;
symbols
	OPENBSD_3_2:1.7.0.4
	OPENBSD_3_2_BASE:1.7
	OPENBSD_3_1:1.7.0.2
	OPENBSD_3_1_BASE:1.7
	OPENBSD_3_0:1.5.0.2
	OPENBSD_3_0_BASE:1.5
	snap20010624:1.1.1.1
	KAME:1.1.1;
locks; strict;
comment	@.\" @;


1.9
date	2002.11.23.18.47.28;	author deraadt;	state dead;
branches;
next	1.8;

1.8
date	2002.11.17.02.46.30;	author kjc;	state Exp;
branches;
next	1.7;

1.7
date	2002.03.01.11.07.25;	author kjc;	state Exp;
branches;
next	1.6;

1.6
date	2002.02.19.21.11.23;	author miod;	state Exp;
branches;
next	1.5;

1.5
date	2001.07.25.10.44.33;	author kjc;	state Exp;
branches;
next	1.4;

1.4
date	2001.07.25.10.04.56;	author mpech;	state Exp;
branches;
next	1.3;

1.3
date	2001.07.20.19.09.47;	author mpech;	state Exp;
branches;
next	1.2;

1.2
date	2001.06.29.15.44.38;	author espie;	state Exp;
branches;
next	1.1;

1.1
date	2001.06.27.18.23.17;	author kjc;	state Exp;
branches
	1.1.1.1;
next	;

1.1.1.1
date	2001.06.27.18.23.17;	author kjc;	state Exp;
branches;
next	;


desc
@@


1.9
log
@bye bye
@
text
@.\"	$OpenBSD: altq.conf.5,v 1.8 2002/11/17 02:46:30 kjc Exp $
.\"	$KAME: altq.conf.5,v 1.11 2001/07/25 10:40:15 kjc Exp $
.\"
.\" Copyright (C) 2000
.\" Sony Computer Science Laboratories Inc.  All rights reserved.
.\"
.\" Redistribution and use in source and binary forms, with or without
.\" modification, are permitted provided that the following conditions
.\" are met:
.\" 1. Redistributions of source code must retain the above copyright
.\"    notice, this list of conditions and the following disclaimer.
.\" 2. Redistributions in binary form must reproduce the above copyright
.\"    notice, this list of conditions and the following disclaimer in the
.\"    documentation and/or other materials provided with the distribution.
.\"
.\" THIS SOFTWARE IS PROVIDED BY SONY CSL AND CONTRIBUTORS ``AS IS'' AND
.\" ANY EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT LIMITED TO, THE
.\" IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE
.\" ARE DISCLAIMED.  IN NO EVENT SHALL SONY CSL OR CONTRIBUTORS BE LIABLE
.\" FOR ANY DIRECT, INDIRECT, INCIDENTAL, SPECIAL, EXEMPLARY, OR CONSEQUENTIAL
.\" DAMAGES (INCLUDING, BUT NOT LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS
.\" OR SERVICES; LOSS OF USE, DATA, OR PROFITS; OR BUSINESS INTERRUPTION)
.\" HOWEVER CAUSED AND ON ANY THEORY OF LIABILITY, WHETHER IN CONTRACT, STRICT
.\" LIABILITY, OR TORT (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY
.\" OUT OF THE USE OF THIS SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF
.\" SUCH DAMAGE.
.\"
.Dd September 28, 1999
.Dt ALTQ.CONF 5
.Os
.\"
.Sh NAME
.Nm altq.conf
.Nd ALTQ configuration file
.\"
.Sh DESCRIPTION
The
.Nm
file contains a number of lines specifying the behavior of queueing
disciplines.
Comments start with a # and extend to the end of the line.
.Pp
The
.Xr altqd 8
program reads
.Pa /etc/altq.conf
at startup and sets up queueing disciplines.
BLUE, CBQ (Class-Based Queueing), FIFOQ (First-In First-Out Queue),
HFSC (Hierarchical Fair Service Curve), PRIQ (Priority Queueing),
RED (Random Early Detection), RIO (RED with IN/OUT),
WFQ (Weighted Fair Queueing),
and CDNR (Diffserv Traffic Conditioner) can be configured in this file.
.Ss Interface Commands
.Bl -tag -width interface -offset indent
.It Cm interface
.Ar if_name
.Op Cm bandwidth Ar bps
.Op Cm tbrsize Ar bytes
.Op Ar sched_type
.Op Ar discipline-specific-options
.El
.Pp
The
.Cm interface
command specifies a network interface to be under control of ALTQ.
One interface specification is provided for each network interface
under control of ALTQ.
A system configured as a router may have multiple interface
specifications.
.Bl -tag -width 8n -offset indent
.It Ar if_name
specifies the name of a network interface (e.g., fxp0).
.It Cm bandwidth
specifies the interface bandwidth in bits per second.
This is the maximum rate that the queueing discipline will allow on this
interface.
.It Cm tbrsize
specifies the bucket size of a token bucket regulator in bytes.
When
.Cm tbrsize
is omitted, the system automatically sets the bucket size
using heuristics.
The token rate is set to the interface bandwidth specified by the
.Cm interface
command.
.It Ar sched_type
Type of a queueing discipline.
It must be either
.Cm blue ,
.Cm cbq ,
.Cm fifoq ,
.Cm hfsc ,
.Cm priq ,
.Cm red ,
.Cm rio ,
or
.Cm wfq .
If the interface has only traffic conditioners and no queueing
discipline,
.Ar sched_type
can be omitted.
.El
.Ss Class Command
.Bl -tag -width class -offset indent
.It Cm class
.Ar sched_type
.Ar if_name
.Ar class_name
.Ar parent_name
.Op Cm red|rio
.Op Cm ecn
.Op Cm cleardscp
.Op Ar discipline-specific-options
.El
.Pp
The
.Cm class
command specifies a packet scheduling class for CBQ, HFSC, or PRIQ.
A class specifier must be provided for each packet scheduling class.
.Bl -tag -width 8n -offset indent
.It Ar sched_type
Type of queueing discipline.
Must correspond to the discipline name in interface specification.
.It Ar if_name
Interface name.
Must correspond to name in interface specification.
.It Ar class_name
Arbitrary name for this class.
Must be unique for this interface.
.It Ar parent_name
The name of the parent class for this class (for CBQ or HFSC).
Parent class must have been previously defined.
PRIQ does not have class hierarchy and parent_name must be
.Dv NULL
for PRIQ classes.
.It Cm red
Use RED (Random Early Detection) on this class queue.
RED drops packets with the probability proportional to the average
queue length.
.It Cm rio
Use RIO (RED with In/Out bit) on this class queue.
RIO runs triple RED algorithms at the same time.
.It Cm ecn
Use RED/ECN (Explicit Congestion Notification) on this
class queue (experimental implementation).
ECN implies RED.
.It Cm cleardscp
Clear diffserv codepoint in the IP header.
.El
.Ss Filter Commands
.Bl -tag -width filter -offset indent
.It Cm filter
.Ar if_name
.Ar class_name
.Op Cm name Ar fltr_name
.Op Cm ruleno Ar num
.Ar filter_values
.El
.Pp
The
.Cm filter
command specifies a filter to classify packets into
a scheduling class.
A filter specifier determines any statically-defined packet
classification rules.
.Bl -tag -width 10n -offset indent
.It Ar if_name
Name of a network interface (e.g., fxp0).
.It Ar class_name
Name of a class or a conditioner to which matching packets are directed.
.It Cm name
Add an arbitrary name to the filter for a future refenece.
.It Cm ruleno
Specifies explicit order of filter matching.
Filter matching is performed from a filter with a larger ruleno.
Default is 0.
.El
.Pp
.Ar filter_value
should be in the following format:
.Bl -tag -width filter -offset indent
.Ar filter_values :
.Ad dst_addr Op Cm netmask Ar mask
.Ar dport
.Ad src_addr Op Cm netmask Ar mask
.Ar sport
.Ar proto
.Oo
.Cm tos
.Ar value
.Op Cm tosmask Ar value
.Oc
.Op Cm gpi Ar value
.El
.Pp
Here
.Ad dst_addr
and
.Ad src_addr
are dotted-decimal addresses of
the destination and the source respectively.
An address may be followed by
.Cm netmask
keyword.
.Ar dport
and
.Ar sport
are port numbers of the destination and the source respectively.
.Ar proto
is a protocol number defined for IP packets (e.g. 6 for TCP).
.Cm tos
keyword can be used to specify the type of service field value.
.Cm gpi
keyword can be used to specify the Security Parameter Index value for
IPsec.
.Pp
When filter value 0 is used, it is taken as a wildcard.
.Bl -tag -width filter6 -offset indent
.It Cm filter6
.Ar if_name
.Ar class_name
.Op Cm name Ar fltr_name
.Op Cm ruleno Ar num
.Ar filter6_values
.El
.Pp
The
.Cm filter6
command is for IPv6.
.Ar filter6_value
should be in the following format:
.Bl -tag -width filter6 -offset indent
.It filter6_values :
.Ad dst_addr Ns Op /prefix_len
.Ar dport
.Ad src_addr Ns Op /prefix_len
.Ar sport
.Ar proto
.Op Cm flowlabel Ar value
.Oo
.Cm tclass
.Ar value
.Op Cm tclassmask Ar value
.Oc
.Op Cm gpi Ar value
.El
.Pp
Here
.Ad dst_addr
and
.Ad src_addr
are IPv6 addresses of the destination and the source respectively.
An address may be followed by an optional address prefix length.
.Ar dport
and
.Ar sport
are port numbers of the destination and the source respectively.
.Ar proto
is a protocol number defined for IPv6 packets (e.g. 6 for TCP).
.Cm flowlabel
keyword can be used to specify the flowlabel field value.
.Cm tclass
keyword can be used to specify the traffic class field value.
.Cm gpi
keyword can be used to specify the Security Parameter Index value for
IPsec.
.Pp
When filter value 0 is used, it is taken as a wildcard.
.Ss CBQ Commands
CBQ (Class Based Queueing) achieves both partitioning and sharing of
link bandwidth by hierarchically structured classes.
Each class has its own queue and is assigned its share of bandwidth.
A child class can borrow bandwidth from its parent class as long as
excess bandwidth is available.
.Bl -tag -width interface -offset indent
.It Cm interface
.Ar if_name
.Op Cm bandwidth Ar bps
.Op Cm tbrsize Ar bytes
.Op Ar sched_type
.Op Cm efficient
.El
.Pp
.Bl -tag -width 8n -offset indent
.It Ar if_name
specifies the name of a network interface (e.g., fxp0).
.It Cm bandwidth
specifies the interface bandwidth in bits per second.
.It Cm tbrsize
specifies the bucket size of a token bucket regulator in bytes.
.It Ar sched_type
must be either
.Cm cbq ,
.Cm cbq-wrr
(weighted-round robin) or
.Cm cbq-prr
(packet-by-packet round robin).
.Cm cbq
is equivalent to
.Cm cbq-wrr .
.It Cm efficient
Enables CBQ's link efficiency mode.
This means that the scheduler will send a packet from the first
overlimit class it encounters of all classes of the link-sharing
structure when all classes are overlimit.
This will also cause the scheduler to use greater than it's assigned
bandwidth, if the link is capable of more than the assigned bandwidth.
By default, this mode is turned off.
By adding the keyword
.Cm efficient
to the interface specification line, enables this mode.
.El
.Pp
.Bl -tag -width class -offset indent
.It Cm class
.Ar sched_type
.Ar if_name
.Ar class_name
.Ar parent_name
.Op Cm admission cntlload|none
.Op Cm priority Ar pri
.Op Cm pbandwidth Ar percent
.Op Cm exactbandwidth Ar bps
.Op Cm borrow
.Op Cm default
.Op Cm control
.Op Cm maxburst Ar count
.Op Cm minburst Ar count
.Bk -words
.Op Cm maxdelay Ar msec
.Ek
.Op Cm packetsize Ar bytes
.Op Cm maxpacketsize Ar bytes
.Op Cm red|rio
.Op Cm ecn
.Op Cm flowvalve
.Op Cm cleardscp
.El
.Pp
The
.Cm class
command specifies a CBQ class.
The classes are organized as a hierarchy, and every class, except
for the root class, has a parent.
.Bl -tag -width 8n -offset indent
.It Ar sched_type
must be
.Cm cbq
for a CBQ class.
.It Ar if_name
Interface name.
Must correspond to name in interface specification.
.It Ar class_name
Arbitrary name for this class.
Must be unique within the class
hierarchy for this interface.
The name
.Cm ctl_class
is a reserved class name.
.It Cm parent_name
The name of the parent class for this class or
.Dv NULL
if this is the root class.
Parent class must have been previously defined.
.It Cm admission
The type of admission control and QoS type.
.Cm cntlload
is controlled load service for RSVP, otherwise, it should be
.Cm none .
The default is
.Cm none .
.It Cm priority
High numbers are higher priority.
Max value is 7 and Min value is 0.
Default is 1.
.It Cm pbandwidth
The percentage of the interface bandwidth allocated to this class.
Generally should add up to 100 percent at each level of the class
hierarchy, although other amounts can be specified for purposes of
experimentation.
.It Cm exactbandwidth
Specify the bandwidth in bits-per-second instead of
.Cm pbandwidth .
Note that the bandwidth allocation of CBQ is not so precise but this
is just a way to pass a parameter to CBQ; the user is supposed to know
the detailed internals of CBQ.
.Cm pbandwidth
is a preferred way to specify the bandwidth of a class.
.It Cm borrow
The class can borrow bandwidth from its parent class when this class
is overlimit.
If this keyword is not present, then no borrowing is done, and the
packet is delayed or dropped when the class is overlimit.
.It Cm default
Specify the default class.
When this keyword is present, all packets that do not match some
classification criteria are assigned to this class.
Must be exactly one class on each interface defined as the default
class.
.It Cm control
Specify the control class.
When this keyword is present, the predefined control class packets
(RSVP, IGMP, and ICMP) are assigned to this class.
Note that when the control class is not specified by the time the
default class is created, one is automatically created with default
parameters.
Thus, if the control class is specified, it must be listed before the
default class.
Must be exactly one class on each interface defined as the control
class.
.It Cm maxburst
The maximum burst of back-to-back packets allowed in this class.
Default is 16 but the default value is automatically reduced to 4 when
the class bandwidth is small (about less than 1Mbps).
.It Cm minburst
The minimum burst is used to obtain the steady state burst size.
It's the parameter to help compute offtime for the class.
Offtime is the amount of time a class is to wait between packets.
Default is 2.
.It Cm maxdelay
The maxdelay is specified in millisecond and used to obtain the max
queue size of the class.
If not specified, the default max queue size (30 packets) is used.
.It Cm packetsize
The average packet size in bytes to be used in CBQ over-/under-limit
computations.
Default value is MTU of the interface.
.It Cm maxpacketsize
The maximum packet size in bytes for the class.
Default value is MTU of the interface.
.It Cm red
enables RED on this class queue.
.It Cm rio
enables RIO on this class queue.
.It Cm ecn
enables RED/ECN on this class queue.
.It Cm flowvalve
enables RED/flow-valve (a.k.a. red-penalty-box) on this class queue.
.It Cm cleardscp
clears diffserv codepoint in the IP header.
.El
.Ss HFSC Commands
HFSC (Hierarchical Fair Service Curve) supports both link-sharing and
guaranteed real-time services.
H-FSC employs a service curve based QoS model, and its unique feature
is an ability to decouple delay and bandwidth allocation.
HFSC has 2 independent scheduling mechanisms.
Real-time scheduling is used to guarantee the delay and the
bandwidth allocation at the same time.
Hierarchical link-sharing is used to distribute the excess
bandwidth.
When dequeueing a packet, HFSC always tries real-time scheduling
first.
If no packet is eligible for real-time scheduling, link-sharing
scheduling is performed.
HFSC does not use class hierarchy for real-time scheduling.
.Bl -tag -width interface -offset indent
.It Cm interface
.Ar if_name
.Op Cm bandwidth Ar bps
.Op Cm tbrsize Ar bytes
.Op Ar sched_type
.El
.Pp
.Bl -tag -width 8n -offset indent
.It Ar if_name
specifies the name of a network interface (e.g., fxp0).
.It Cm bandwidth
specifies the interface bandwidth in bits per second.
.It Cm tbrsize
specifies the bucket size of a token bucket regulator in bytes.
.It Ar sched_type
must be
.Cm hfsc
for HFSC.
.El
.Pp
.Bl -tag -width class -offset indent
.It Cm class
.Ar sched_type
.Ar if_name
.Ar class_name
.Ar parent_name
.Op Cm admission cntlload|none
.Op Bq Cm sc Ar m1 d m2
.Op Bq Cm rt Ar m1 d m2
.Op Bq Cm ls Ar m1 d m2
.Op Cm pshare Ar percent
.Op Cm grate Ar bps
.Op Cm default
.Op Cm qlimit Ar count
.Op Cm red|rio
.Op Cm ecn
.Op Cm cleardscp
.El
.Pp
The
.Cm class
command specifies a HFSC class.
The classes are organized as a hierarchy, and every class, except
for the root class, has a parent.
.Pp
Each HFSC class has 2 service curves, the real-time service curve and
the link-sharing service curve.
Service curves are specified by
.Bq Ar type Ar m1 d m2 .
.Ar type
should be either
.Cm sc, rt
or
.Cm ls .
.Cm sc
(service curve) is used to set the same values to both service curves.
.Cm rt
(real-time) is used to specify the real-time service curve.
.Cm ls
(link-sharing) is used to specify the link-sharing service curve.
.Ar m1
is the slope of the first segment specified in bits-per-second.
.Ar d
is the x-projection of the intersection point of the 2 segments
specified in milli-second.
.Ar m2
is the slope of the second segment specified in bits-per-second.
.Bl -tag -width 8n -offset indent
.It Ar sched_type
must be
.Cm hfsc
for a HFSC class.
.It Ar if_name
Interface name.
Must correspond to name in interface specification.
.It Ar class_name
Arbitrary name for this class.
Must be unique within the class hierarchy for this interface.
The name
.Cm root
is a reserved class name for the root class.
The root class for the interface is automatically created by the
.Cm interface
command.
.It Ar parent_name
The name of the parent class for this class.
Keyword
.Cm root
is used when the parent is the root class.
Parent class must have been previously defined.
.It Cm admission
The type of admission control and QoS type.
.Cm cntlload
is controlled load service for RSVP, otherwise, it should be
.Cm none .
The default is
.Cm none .
.It Cm pshare
Percent of the link share.
This specifies a linear link-sharing service curve as a fraction of
the link bandwidth.
It is a short hand of
.Li [ls 0 0 (link-bandwidth * percent / 100)] .
.It Cm grate
Guaranteed rate.
This specifies a linear real-time service curve.
It is a short hand of
.Li [rt 0 0 bps] .
.It Cm default
Specify the default class.
When this keyword is present, all packets that do not match some
classification criteria are assigned to this class.
Must be exactly one class on each interface defined as the default
class.
.It Cm qlimit
The maximum queue size in number of packets.
Default value is 50.
.It Cm red
enables RED on this class queue.
.It Cm rio
enables RIO on this class queue.
.It Cm ecn
enables RED/ECN on this class queue.
.It Cm cleardscp
clears diffserv codepoint in the IP header.
.El
.Ss PRIQ Commands
PRIQ (Priority Queueing) implements a simple priority-based queueing.
A higher priority class is always served first.
Up to 16 priorities can be used with PRIQ.
.Bl -tag -width interface -offset indent
.It Cm interface
.Ar if_name
.Op Cm bandwidth Ar bps
.Op Cm tbrsize Ar bytes
.Op Ar sched_type
.El
.Pp
.Bl -tag -width 8n -offset indent
.It Ar if_name
specifies the name of a network interface (e.g., fxp0).
.It Cm bandwidth
specifies the interface bandwidth in bits per second.
.It Cm tbrsize
specifies the bucket size of a token bucket regulator in bytes.
.It Ar sched_type
must be
.Cm priq
for PRIQ.
.El
.Pp
.Bl -tag -width class -offset indent
.It Cm class
.Ar sched_type
.Ar if_name
.Ar class_name
.Ar parent_name
.Op Cm priority Ar pri
.Op Cm default
.Op Cm qlimit Ar count
.Op Cm red|rio
.Op Cm ecn
.Op Cm cleardscp
.El
.Pp
.Bl -tag -width 8n -offset indent
.It Ar sched_type
must be
.Cm priq
for a PRIQ class.
.It Ar if_name
Interface name.
Must correspond to name in interface specification.
.It Ar class_name
Arbitrary name for this class.
Must be unique for this interface.
.It Ar parent_name
Parent class must be
.Dv NULL
for PRIQ.
.It Cm priority
High numbers are higher priority.
Max value is 15 and Min value is 0.
Default is 0.
A higher priority class is always served first in PRIQ.
Priority must be unique for the interface.
.It Cm default
Specify the default class.
When this keyword is present, all packets that do not match some
classification criteria are assigned to this class.
Must be exactly one class on each interface defined as the default
class.
.It Cm qlimit
The maximum queue size in number of packets.
Default value is 50.
.It Cm red
enables RED on this class queue.
.It Cm rio
enables RIO on this class queue.
.It Cm ecn
enables RED/ECN on this class queue.
.It Cm cleardscp
clears diffserv codepoint in the IP header.
.El
.Ss WFQ Commands
WFQ (Weighted Fair Queueing) implements a weighted-round robin
scheduler for a set of queue.
A weight can be assigned to each queue to give a
different proportion of the link capacity.
A hash function is used to map a flow to one of a set of queues, and
thus, it is possible for two different flows to be mapped into the same
queue.
.Bl -tag -width interface -offset indent
.It Cm interface
.Ar if_name
.Op Cm bandwidth Ar bps
.Op Cm tbrsize Ar bytes
.Op Ar sched_type
.Op Cm nqueues Ar count
.Op Cm qsize Ar bytes
.Op Cm hash Ar policy
.El
.Pp
.Bl -tag -width 8n -offset indent
.It Cm if_name
specifies the name of a network interface (e.g., fxp0).
.It Cm bandwidth
specifies the interface bandwidth in bits per second.
.It Cm tbrsize
specifies the bucket size of a token bucket regulator in bytes.
.It Ar sched_type
must be
.Cm wfq
for WFQ.
.It Cm nqueues
The number of queues in WFQ.  Default value is 256.
.It Cm qsize
The size of each queue in number of bytes.
Default value is 64K bytes.
.It Cm hash
Type of hash policy to select a queue.
.Cm dstaddr
specifies a hashing policy by IP destination address.
.Cm full
specifies a hashing policy by IP addresses and ports.
.Cm srcport
specifies a hashing policy by IP source port number.
Default is
.Cm dstaddr
.El
.Ss FIFOQ Commands
FIFOQ (First-In First-Out Queueing) is a simple tail-drop FIFO queue.
FIFOQ is the simplest possible implementation of a queueing discipline
in ALTQ, and can be used to compare with other queueing disciplines.
FIFOQ can be also used as a template for those who want to write their
own queueing disciplines.
.Bl -tag -width interface -offset indent
.It Cm interface
.Ar if_name
.Op Cm bandwidth Ar bps
.Op Cm tbrsize Ar bytes
.Op Ar sched_type
.Op Cm qlimit Ar count
.El
.Pp
.Bl -tag -width 8n -offset indent
.It Ar if_name
specifies the name of a network interface (e.g., fxp0).
.It Cm bandwidth
specifies the interface bandwidth in bits per second.
.It Cm tbrsize
specifies the bucket size of a token bucket regulator in bytes.
.It Ar sched_type
must be
.Cm fifoq
for FIFOQ.
.It Cm qlimit
The maximum queue size in number of packets.
Default value is 50.
.El
.Ss RED Commands
RED (Random Early Detection) is an implicit congestion notification
mechanism that exercises packet dropping or packet marking
stochastically according to the average queue length.
RED can be viewed as a buffer management mechanism
and can be integrated into other packet scheduling schemes.
.Bl -tag -width red -offset indent
.It Cm red
.Ar min_th
.Ar max_th
.Ar inv_pmax
.El
.Pp
The
.Cm red
command sets the default RED paramters.
.Ar min_th
and
.Ar max_th
are the minimum and the maximum threshold values.
.Ar inv_pmax
is the inverse (reciprocal) of the maximum drop probability.
For example, 10 means the maximum drop probability of 1/10.
.Bl -tag -width interface -offset indent
.It Cm interface
.Ar if_name
.Op Cm bandwidth Ar bps
.Op Cm tbrsize Ar bytes
.Op Ar sched_type
.Op Cm qlimit Ar count
.Op Cm packetsize Ar bytes
.Op Cm weight Ar n
.Op Cm thmin Ar n
.Op Cm thmax Ar n
.Op Cm invpmax Ar n
.Op Cm ecn
.Op Cm flowvalve
.El
.Pp
.Bl -tag -width 8n -offset indent
.It Ar if_name
specifies the name of a network interface (e.g., fxp0).
.It Cm bandwidth
specifies the interface bandwidth in bits per second.
.It Cm tbrsize
specifies the bucket size of a token bucket regulator in bytes.
.It Ar sched_type
must be
.Cm red
for RED.
.It Cm qlimit
The maximum queue size in number of packets.
Default value is 60.
.It Cm packetsize
The average packet size in number of bytes.
This parameter is used to calibrate the idle period.
Default value is 1000.
.It Cm weight
The inverse of the weight of EWMA (exponentially weighted moving average).
.It Cm thmin
The minimum threshold.
.It Cm thmax
The maximum threshold.
.It Cm invpmax
The inverse of the maximum drop probability.
.It Cm ecn
enables ECN.
.It Cm flowvalve
enables flowvalve.
.El
.Ss RIO Commands
ALTQ/RIO has 3 drop precedence levels defined for the Assured
Forwarding of DiffServ (RFC2597).
Since adaptive flows are likely to stay under the medium drop
precedence level under congestion, the medium drop precedence would
protect adaptive flows from unadaptive flows.
.Pp
The original RIO has 2 sets of RED parameters; one for in-profile
packets and the other for out-of-profile packets.
At the ingress of the network, profile meters tag packets as IN
or OUT based on contracted profiles for customers.
Inside the network, IN packets receive preferential treatment by
the RIO dropper.
It is possible to provision the network not to drop IN packets
at all by providing enough capacity for the total volume of IN
packets.
Thus, RIO can be used to provide a service that statistically assures
capacity allocated for users.
This mechanism can be extended to support an arbitrary number of drop
precedence levels.  ALTQ supports 3 drop precedence levels.
.Bl -tag -width rio -offset indent
.It Cm rio
.Ar low_min_th
.Ar low_max_th
.Ar low_inv_pmax
.Ar medium_min_th
.Ar medium_max_th
.Ar medium_inv_pmax
.Ar high_min_th
.Ar high_max_th
.Ar high_inv_pmax
.El
.Pp
The
.Cm rio
command sets the default RIO paramters.
The parameters are RED parameters for 3 (low, medium, high) drop
precedence.
.Bl -tag -width interface -offset indent
.It Cm interface
.Ar if_name
.Op Cm bandwidth Ar bps
.Op Cm tbrsize Ar bytes
.Op Ar sched_type
.Op Cm qlimit Ar count
.Op Cm packetsize Ar bytes
.Op Cm weight Ar n
.Op Cm lo_thmin Ar n
.Op Cm lo_thmax Ar n
.Op Cm lo_invpmax Ar n
.Op Cm med_thmin Ar n
.Op Cm med_thmax Ar n
.Op Cm med_invpmax Ar n
.Op Cm hi_thmin Ar n
.Op Cm hi_thmax Ar n
.Op Cm hi_invpmax Ar n
.Op Cm ecn
.El
.Pp
.Bl -tag -width 8n -offset indent
.It Ar if_name
specifies the name of a network interface (e.g., fxp0).
.It Cm bandwidth
specifies the interface bandwidth in bits per second.
.It Cm tbrsize
specifies the bucket size of a token bucket regulator in bytes.
.It Ar sched_type
must be
.Cm rio
for RIO.
.It Cm qlimit
The maximum queue size in number of packets.
Default value is 60.
.It Cm packetsize
The average packet size in number of bytes.
This parameter is used to calibrate the idle period.
Default value is 1000.
.It Cm weight
The inverse of the weight of EWMA (exponentially weighted moving average).
.It Cm lo_thmin
The minimum threshold for low drop precedence.
.It Cm lo_thmax
The maximum threshold for low drop precedence.
.It Cm lo_invpmax
The inverse of the maximum drop probability for low drop precedence.
.It Cm med_thmin
The minimum threshold for medium drop precedence.
.It Cm med_thmax
The maximum threshold for medium drop precedence.
.It Cm med_invpmax
The inverse of the maximum drop probability for medium drop precedence.
.It Cm hi_thmin
The minimum threshold for high drop precedence.
.It Cm hi_thmax
The maximum threshold for high drop precedence.
.It Cm hi_invpmax
The inverse of the maximum drop probability for high drop precedence.
.It Cm ecn
enables ECN.
.El
.Ss BLUE Commands
.Bl -tag -width interface -offset indent
.It Cm interface
.Ar if_name
.Op Cm bandwidth Ar bps
.Op Cm tbrsize Ar bytes
.Op Ar sched_type
.Op Cm qlimit Ar count
.Op Cm packetsize Ar bytes
.Op Cm maxpmark Ar n
.Op Cm holdtime Ar usec
.Op Cm ecn
.El
.Pp
.Bl -tag -width 8n -offset indent
.It Ar if_name
specifies the name of a network interface (e.g., fxp0).
.It Cm bandwidth
specifies the interface bandwidth in bits per second.
.It Cm tbrsize
specifies the bucket size of a token bucket regulator in bytes.
.It Ar sched_type
must be
.Cm blue
for BLUE.
.It Cm qlimit
The maximum queue size in number of packets.
Default value is 60.
.It Cm packetsize
The average packet size in number of bytes.  Default value is 1000.
.It Cm maxpmark
specifies the precision of marking probability.
.It Cm holdtime
specifies the hold time in usec.
.It Cm ecn
enables ECN.
.El
.Ss CDNR Commands
The
.Cm conditioner
command specifies a diffserv traffic conditioner.
A traffic conditioner is not a queueing discipline but a component to
meter, mark or drop incoming packets according to some rules.
.Pp
As opposed to a queueing discipline, a traffic conditioner handles
incoming packets at an input interface.
If no queueing discipline (e.g., CBQ) is used for the interface,
a null interface command should be used to specify an input network
interface.
.Bl -tag -width interface -offset indent
.It Cm interface
.Ar if_name
.Op Cm bandwidth Ar bps
.Op Cm tbrsize Ar bytes
.El
.Pp
The
.Cm conditioner
command has the following syntax.
.Bl -tag -width conditioner -offset indent
.It Cm conditioner
.Ar if_name
.Ar cdnr_name
.Aq action
.El
.Pp
.Bl -tag -width 10n -offset indent
.It Ar if_name
Interface name. Must correspond to name in interface specification.
.It Ar cdnr_name
Arbitrary name for this conditioner.
Must be unique for this interface.
.It Ar action
Action of the conditioner.
.El
.Pp
An action can be a recursively defined action.
The following actions are defined.
.Bl -tag -width pass -offset indent
.It Cm pass
.Bl -inset -offset indent
.It Cm pass
allows the packet to go through without any modification to the packet.
.El
.El
.Pp
.Bl -tag -width drop -offset indent
.It Cm drop
.Bl -inset -offset indent
.It Cm drop
rejects the packet.
The packet is immediately discarded.
.El
.El
.Pp
.Bl -tag -width mark -offset indent
.It Cm mark
.Ar value
.Bl -inset -offset indent
.It Cm mark
sets the specified value to the ds field in the IP header.
Then, the packet is allowed to go through.
.El
.El
.Pp
.Bl -tag -width tbmeter -offset indent
.It Cm tbmeter
.Ar rate depth
.Aq in_action
.Aq out_action
.Pp
.Bl -inset -offset indent
.It Cm tbmeter
is a token bucket meter configured with rate and depth parameters.
Rate is token rate in bits-per-second.
Depth is bucket depth in KB.
When an incoming packet is in profile (available token is more than
the packet size), tbmeter takes in_action.
Otherwise, tbmeter takes out_action.
.El
.El
.Pp
.Bl -tag -width trtcm -offset indent
.It Cm trtcm
.Ar cmtd_rate cmtd_depth peak_rate peak_depth
.Aq green_action
.Aq yellow_action
.Aq red_action
.Op Cm coloraware|colorblind
.Bl -inset -offset indent
.It Cm trtcm
is a 2-rate 3 color marker for Assured Forwarding.
A trtcm consists of 2 token buckets, one for a committed rate and the
other for a peak rate.
When an incoming packet is in the committed profile, trtcm takes
green_action.
When the packet is out of the committed profile but in the peak
profile, trtcm takes yellow_action.
Otherwise, tbtcm takes red_action.
A trtcm is either color-aware or color-blind.
A color-aware trtcm do not raise the color (ds field value), that is,
a yellow packet can be yellow or red but can not be blue.
Default is color-blind.
.El
.El
.Pp
.Bl -tag -width tswtcm -offset indent
.It Cm tswtcm
.Ar cmtd_rate peak_rate avg_interval
.Aq green_action
.Aq yellow_action
.Aq red_action
.Bl -inset -offset indent
.It Cm tswtcm
is a time sliding window 3 color marker for Assured Forwarding.
A tswtcm differs from trtcm in that a tswtcm probabilistically marks
packets.
A tswtcm consists of 2 rates, one for a committed rate and the
other for a peak rate.
When an incoming packet is in the committed profile, tswtcm takes
green_action.
When the packet is out of the committed profile but in the peak
profile, tswtcm takes yellow_action.
Otherwise, tswtcm takes red_action.
cmtd_rate and peak_rate are specified in bits per second.
avg_interval provides the size of time window for averaging incoming
rate, and is specified in milli-second.
500 msec is ok for normal settings.
.El
.El
.Sh EXAMPLES
.Ss CBQ Example
.Bd -literal
#
# cbq configuration for vx0 (10Mbps ether)
# give at least 40% to TCP
# limit HTTP from network 133.138.1.0 up to 10%, use RED.
# other traffic goes into default class
#
interface vx0 bandwidth 10M cbq
#
class cbq vx0 root_class NULL priority 0 pbandwidth 100
class cbq vx0 def_class root_class borrow pbandwidth 95 default
class cbq vx0 tcp_class def_class borrow pbandwidth  40
        filter vx0 tcp_class 0 0 0 0 6
class cbq vx0 csl_class tcp_class pbandwidth  10   red
        filter vx0 csl_class 0 0 133.138.1.0 netmask 0xffffff00 80 6
        filter vx0 csl_class 133.138.1.0 netmask 0xffffff00 0 0 80 6
#
# sample filter6 command
#
                filter6 vx0 csl_class ::0 0 d000:a:0:123::/64 80 6
.Ed
.Ss HFSC Example
.Bd -literal
#
# hfsc configuration for hierachical sharing
#
interface pvc0 bandwidth 45M hfsc
#
# (10% of the bandwidth share goes to the default class)
class hfsc pvc0 def_class root pshare 10 default
#
#          bandwidth share    guaranteed rate
#    CMU:       45%             15Mbps
#    PITT:      45%             15Mbps
#
class hfsc pvc0 cmu  root pshare 45 grate 15M
class hfsc pvc0 pitt root pshare 45 grate 15M
#
# CMU      bandwidth share    guaranteed rate
#    CS:        20%             10Mbps
#    other:     20%              5Mbps
#
class hfsc pvc0 cmu_other cmu  pshare 20 grate 10M
        filter pvc0 cmu_other   0 0 128.2.0.0   netmask 0xffff0000 0 0
class hfsc pvc0 cmu_cs    cmu  pshare 20 grate  5M
        filter pvc0 cmu_cs      0 0 128.2.242.0 netmask 0xffffff00 0 0
#
# PITT     bandwidth share    guaranteed rate
#    CS:        20%             10Mbps
#    other:     20%              5Mbps
#
class hfsc pvc0 pitt_other pitt  pshare 20 grate 10M
        filter pvc0 pitt_other  0 0 136.142.0.0  netmask 0xffff0000 0 0
class hfsc pvc0 pitt_cs    pitt  pshare 20 grate  5M
        filter pvc0 pitt_cs     0 0 136.142.79.0 netmask 0xffffff00 0 0
.Ed
.Ss PRIQ Example
.Bd -literal
#
# priq configuration for fxp0 (100Mbps ether)
#     icmp: high priority
#     tcp:  medium priority
#     others: low priority
#
interface fxp0 bandwidth 100M priq
#
class priq fxp0 high_class NULL priority 2
        filter fxp0 high_class 0 0 0 0 1
class priq fxp0 med_class NULL priority 1
        filter fxp0 med_class 0 0 0 0 6
class priq fxp0 low_class NULL priority 0 default
.Ed
.Ss WFQ Example
.Bd -literal
interface pvc0 bandwidth 134000000 wfq
.Ed
.Ss FIFOQ Example
.Bd -literal
interface rl0 bandwidth 10M fifoq
.Ed
.Ss Conditioner Example
.Bd -literal
#
interface fxp0
#
# a simple dropper
# discard all packets from 192.168.0.83
#
conditioner fxp0 dropper <drop>
        filter fxp0 dropper 0 0 192.168.0.83 0 0

#
# EF conditioner
# mark EF to all packets from 192.168.0.117
#
conditioner pvc1 ef_cdnr <tbmeter 6M 64K <mark 0xb8><drop>>
        filter fxp0 ef_cdnr 0 0 192.168.0.117 0 0

#
# AF1x conditioner
# mark AF1x to packets from 192.168.0.178
#       AF11 (low drop precedence):    less than 3Mbps
#       AF12 (medium drop precedence): more than 3Mbps and less than 10Mbps
#       AF13 (high drop precedence):   more than 10Mbps
#
conditioner fxp0 af1x_cdnr <trtcm 3M 32K 10M 64K <mark 0x28><mark 0x30><mark 0x38>>
        filter fxp0 af1x_cdnr 0 0 192.168.0.178 0 0
.Ed
.Sh SEE ALSO
.Xr altqd 8
.Sh BUGS
This man page is incomplete. For more information read the source.
@


1.8
log
@typo fix: high_class should be med_class in priq example.

PR2847
@
text
@d1 1
a1 1
.\"	$OpenBSD: altq.conf.5,v 1.7 2002/03/01 11:07:25 kjc Exp $
@


1.7
log
@sync with KAME
minor man fixes from NetBSD.
@
text
@d1 1
a1 1
.\"	$OpenBSD: altq.conf.5,v 1.6 2002/02/19 21:11:23 miod Exp $
d1149 1
a1149 1
        filter fxp0 high_class 0 0 0 0 6
@


1.6
log
@IPsec is written ``IPsec'', not ``IPSec''.
@
text
@d1 1
a1 1
.\"	$OpenBSD: altq.conf.5,v 1.5 2001/07/25 10:44:33 kjc Exp $
d30 1
a30 1
.Os KAME
@


1.5
log
@mdoc fixes; sync with KAME.
@
text
@d1 1
a1 1
.\"	$OpenBSD: altq.conf.5,v 1.3 2001/07/20 19:09:47 mpech Exp $
d215 1
a215 1
IPSec.
d266 1
a266 1
IPSec.
@


1.4
log
@We have to undo the changes to the 3rd party code, because it makes
upgrading those components hell.

Tip of the day: Don't commit without confirmation.
@
text
@d2 1
a2 1
.\"	$KAME: altq.conf.5,v 1.8 2001/04/09 16:26:28 thorpej Exp $
d38 1
a38 1
.Nm altq.conf
d40 2
a41 1
disciplines.  Comments start with a # and extend to the end of the line.
d53 1
a53 2
.Pp
.Sh Interface Commands
d55 1
a55 1
.It Nm interface
d64 1
a64 1
.Sy interface
d67 3
a69 3
under control of ALTQ.  A system configured as a router may have
multiple interface specifications.
.\"
d71 1
a71 1
.It Em if_name
d73 1
a73 1
.It Sy bandwidth
d77 1
a77 1
.It Sy tbrsize
d80 1
a80 1
.Sy tbrsize
d84 1
a84 1
.Sy interface
d86 10
a95 9
.It Em sched_type
Type of a queueing discipline.  It must be either
.Sy blue ,
.Sy cbq ,
.Sy fifoq ,
.Sy hfsc ,
.Sy priq ,
.Sy red ,
.Sy rio ,
d97 1
a97 1
.Sy wfq .
d99 3
a101 1
discipline, sched_type can be omitted.
d103 1
a103 2
.Pp
.Sh Class Command
d105 1
a105 1
.It Nm class
d117 1
a117 1
.Sy class
d121 10
a130 8
.It Em sched_type
Type of queueing discipline.  Must correspond to the discipline name
in interface specification.
.It Em if_name
Interface name. Must correspond to name in interface specification.
.It Em class_name
Arbitrary name for this class.  Must be unique for this interface.
.It Em parent_name
d133 2
a134 1
PRIQ does not have class hierarchy and parent_name must be ``NULL''
d136 1
a136 1
.It Sy red
d140 1
a140 1
.It Sy rio
d143 1
a143 1
.It Sy ecn
d145 3
a147 2
class queue (experimental implementation).  ECN implies RED.
.It Sy cleardscp
d150 1
a150 2
.Pp
.Sh Filter Commands
d152 1
a152 1
.It Nm filter
d161 1
a161 1
.Sy filter
d167 1
a167 1
.It Em if_name
d169 1
a169 1
.It Em class_name
d171 1
a171 1
.It Sy name
d173 4
a176 3
.It Sy ruleno
Specifies explicit order of filter matching.  Filter matching is performed
from a filter with a larger ruleno.  Default is 0.
d179 1
a179 1
.Em filter_value
d182 1
a182 1
.It filter_values :
d189 1
a189 1
.Sy tos
d201 3
a203 3
the destination and the source respectively.  An address may be
followed by
.Sy netmask
d205 1
a205 1
.Em dport
d207 1
a207 1
.Em sport
d209 1
a209 1
.Em proto
d211 1
a211 1
.Sy tos
d213 1
a213 1
.Sy gpi
d219 1
a219 1
.It Nm filter6
d228 1
a228 1
.Sy filter6
d230 1
a230 1
.Em filter6_value
d234 1
a234 1
.Ad dst_addr[/prefix_len]
d236 1
a236 1
.Ad src_addr[/prefix_len]
d241 1
a241 1
.Sy tclass
d253 2
a254 3
An address may be followed by an optional
.Sy address prefix length .
.Em dport
d256 1
a256 1
.Em sport
d258 1
a258 1
.Em proto
d260 1
a260 1
.Sy flowlabel
d262 1
a262 1
.Sy tclass
d264 1
a264 1
.Sy gpi
d269 1
a269 2
.Pp
.Sh CBQ Commands
d271 1
a271 1
link bandwidth  by hierarchically structured classes.
d276 1
a276 1
.It Nm interface
d285 1
a285 1
.It Em if_name
d287 1
a287 1
.It Sy bandwidth
d289 1
a289 1
.It Sy tbrsize
d291 1
a291 1
.It Em sched_type
d293 2
a294 2
.Sy cbq ,
.Sy cbq-wrr
d296 1
a296 1
.Sy cbq-prr
d298 1
a298 1
.Sy cbq
d300 5
a304 5
.Sy cbq-wrr .
.It Sy efficient
Enables CBQ's link efficiency mode.  This means that
the scheduler will send a packet from the first overlimit
class it encounters of all classes of the link-sharing
d308 3
a310 2
By default, this mode is turned off.  By adding the keyword
.Sy efficient
d315 1
a315 1
.It Nm class
d341 1
a341 1
.Sy class
d346 1
a346 1
.It Em sched_type
d348 1
a348 1
.Sy cbq
d350 9
a358 6
.It Em if_name
Interface name. Must correspond to name in interface specification.
.It Em class_name
Arbitrary name for this class.  Must be unique within the class
hierarchy for this interface.  The name
.Sy ctl_class
d360 1
a360 1
.It Em parent_name
d362 4
a365 3
.Sy NULL
if this is the root class.  Parent class must have been previously defined.
.It Sy admission
d367 3
a369 5
.Sy cntlload
is controlled load service for
.Em RSVP ,
otherwise, it should be
.Sy none .
d371 4
a374 3
.Sy none .
.It Sy priority
High numbers are higher priority.  Max value is 7 and Min value is 0.
d376 1
a376 1
.It Sy pbandwidth
d381 1
a381 1
.It Sy exactbandwidth
d383 1
a383 1
.Sy pbandwidth .
d387 1
a387 1
.Sy pbandwidth
d389 1
a389 1
.It Sy borrow
d394 5
a398 8
.It Sy default
Specify the default class.  When this keyword is present, all packets
that do not match some classification criteria are assigned to this
class.  Must be exactly one class on each interface defined as the
default class.
.It Sy control
Specify the control class.  When this keyword is present, the predefined
control class packets (RSVP, IGMP, and ICMP) are assigned to this
d400 4
d406 6
a411 5
parameters.  Thus, if the control class is specified, it must be
listed before the default class.
Must be exactly one class on each interface defined as the
control class.
.It Sy maxburst
d415 6
a420 5
.It Sy minburst
The minimum burst is used to obtain the steady state burst size.  It's
the parameter to help compute offtime for the class.  Offtime is the
amount of time a class is to wait between packets. Default is 2.
.It Sy maxdelay
d424 1
a424 1
.It Sy packetsize
d426 4
a429 3
computations.  Default value is MTU of the interface.
.It Sy maxpacketsize
The maxium packet size in bytes for the class.
d431 1
a431 1
.It Sy red
d433 1
a433 1
.It Sy rio
d435 1
a435 1
.It Sy ecn
d437 1
a437 1
.It Sy flowvalve
d439 1
a439 1
.It Sy cleardscp
d442 1
a442 2
.Pp
.Sh HFSC Commands
d444 3
a446 3
guaranteed real-time services.  H-FSC employs a service curve based QoS
model, and its unique feature is an ability to decouple delay and
bandwidth allocation.
d453 3
a455 2
first.  If no packet is eligible for real-time scheduling,
link-sharing scheduling is performed.
d458 1
a458 1
.It Nm interface
d466 1
a466 1
.It Em if_name
d468 1
a468 1
.It Sy bandwidth
d470 1
a470 1
.It Sy tbrsize
d472 1
a472 1
.It Em sched_type
d474 1
a474 1
.Sy hfsc
d479 1
a479 1
.It Nm class
d485 3
a487 3
.Op Bq Cm sc Em m1 d m2
.Op Bq Cm rt Em m1 d m2
.Op Bq Cm ls Em m1 d m2
d498 1
a498 1
.Sy class
d504 4
a507 4
the link-sharing service curve.  Service curves are specified by
.Bq Em type m1 d m2
\&.
.Em type
d509 1
a509 1
.Sy sc, rt
d511 2
a512 2
.Sy ls .
.Sy sc
d514 1
a514 1
.Sy rt
d516 1
a516 1
.Sy ls
d518 1
a518 1
.Em m1
d520 1
a520 1
.Em d
d523 1
a523 1
.Em m2
d526 1
a526 1
.It Em sched_type
d528 1
a528 1
.Sy hfsc
d530 11
a540 9
.It Em if_name
Interface name. Must correspond to name in interface specification.
.It Em class_name
Arbitrary name for this class.  Must be unique within the class
hierarchy for this interface.  The name
.Sy root
is a reserved class name for the root class.  The root class for the
interface is automatically created by the
.Sy interface
d542 7
a548 6
.It Em parent_name
The name of the parent class for this class.  Keyword
.Sy root
is used when the parent is the root class.  Parent class must
have been previously defined.
.It Sy admission
d550 3
a552 5
.Sy cntlload
is controlled load service for
.Em RSVP ,
otherwise, it should be
.Sy none .
d554 20
a573 15
.Sy none .
.It Sy pshare
Percent of the link share.  This specifies a linear link-sharing
service curve as a fraction of the link bandwidth.
It is a short hand of [ls 0 0 (link-bandwidth * percent / 100)].
.It Sy grate
Guaranteed rate.  This specifies a linear real-time service curve.
It is a short hand of [rt 0 0 bps].
.It Sy default
Specify the default class.  When this keyword is present, all packets
that do not match some classification criteria are assigned to this
class.  Must be exactly one class on each interface defined as the
default class.
.It Sy qlimit
The maxium queue size in number of packets.
d575 1
a575 1
.It Sy red
d577 1
a577 1
.It Sy rio
d579 1
a579 1
.It Sy ecn
d581 1
a581 1
.It Sy cleardscp
d584 1
a584 2
.Pp
.Sh PRIQ Commands
d589 1
a589 1
.It Nm interface
d597 1
a597 1
.It Em if_name
d599 1
a599 1
.It Sy bandwidth
d601 1
a601 1
.It Sy tbrsize
d603 1
a603 1
.It Em sched_type
d605 1
a605 1
.Sy priq
d610 1
a610 1
.It Nm class
d624 1
a624 1
.It Em sched_type
d626 1
a626 1
.Sy priq
d628 11
a638 7
.It Em if_name
Interface name. Must correspond to name in interface specification.
.It Em class_name
Arbitrary name for this class.  Must be unique for this interface.
.It Em parent_name
Parent class must be ``NULL'' for PRIQ.
.It Sy priority
d640 2
a641 1
Max value is 15 and Min value is 0.  Default is 0.
d644 8
a651 7
.It Sy default
Specify the default class.  When this keyword is present, all packets
that do not match some classification criteria are assigned to this
class.  Must be exactly one class on each interface defined as the
default class.
.It Sy qlimit
The maxium queue size in number of packets.
d653 1
a653 1
.It Sy red
d655 1
a655 1
.It Sy rio
d657 1
a657 1
.It Sy ecn
d659 1
a659 1
.It Sy cleardscp
d662 1
a662 2
.Pp
.Sh WFQ Commands
d671 1
a671 1
.It Nm interface
d682 1
a682 1
.It Em if_name
d684 1
a684 1
.It Sy bandwidth
d686 1
a686 1
.It Sy tbrsize
d688 1
a688 1
.It Em sched_type
d690 1
a690 1
.Sy wfq
d692 1
a692 1
.It Sy nqueues
d694 4
a697 3
.It Sy qsize
The size of each queue in number of bytes.  Default value is 64K bytes.
.It Sy hash
d699 1
a699 1
.Sy dstaddr
d701 1
a701 1
.Sy full
d703 4
a706 3
.Sy srcport
specifies a hashing policy by IP source port number.  Default is
.Sy dstaddr
d708 1
a708 2
.Pp
.Sh FIFOQ Commands
d715 1
a715 1
.It Nm interface
d724 1
a724 1
.It Em if_name
d726 1
a726 1
.It Sy bandwidth
d728 1
a728 1
.It Sy tbrsize
d730 1
a730 1
.It Em sched_type
d732 1
a732 1
.Sy fifoq
d734 2
a735 2
.It Sy qlimit
The maxium queue size in number of packets.
d738 1
a738 2
.Pp
.Sh RED Commands
d745 1
a745 1
.It Nm red
d752 1
a752 1
.Sy red
d754 1
a754 1
.Em min_th
d756 1
a756 1
.Em max_th
d758 1
a758 1
.Em inv_pmax
d762 1
a762 1
.It Nm interface
d778 1
a778 1
.It Em if_name
d780 1
a780 1
.It Sy bandwidth
d782 1
a782 1
.It Sy tbrsize
d784 1
a784 1
.It Em sched_type
d786 1
a786 1
.Sy red
d788 2
a789 2
.It Sy qlimit
The maxium queue size in number of packets.
d791 5
a795 4
.It Sy packetsize
The average packet size in number of bytes.  This parameter is used to
calibrate the idle period.  Default value is 1000.
.It Sy weight
d797 1
a797 1
.It Sy thmin
d799 1
a799 1
.It Sy thmax
d801 1
a801 1
.It Sy invpmax
d803 1
a803 1
.It Sy ecn
d805 1
a805 1
.It Sy flowvalve
d808 1
a808 2
.Pp
.Sh RIO Commands
d811 3
a813 3
Since adaptive flows are likely to stay under
the medium drop precedence level under congestion, the medium drop
precedence would protect adaptive flows from unadaptive flows.
d829 1
a829 1
.It Nm rio
d842 4
a845 3
.Sy rio
command sets the default RIO paramters.  The parameters are
RED parameters for 3 (low, medium, high) drop precedence.
d847 1
a847 1
.It Nm interface
d868 1
a868 1
.It Em if_name
d870 1
a870 1
.It Sy bandwidth
d872 1
a872 1
.It Sy tbrsize
d874 1
a874 1
.It Em sched_type
d876 1
a876 1
.Sy rio
d878 2
a879 2
.It Sy qlimit
The maxium queue size in number of packets.
d881 5
a885 4
.It Sy packetsize
The average packet size in number of bytes.  This parameter is used to
calibrate the idle period.  Default value is 1000.
.It Sy weight
d887 1
a887 1
.It Sy lo_thmin
d889 1
a889 1
.It Sy lo_thmax
d891 1
a891 1
.It Sy lo_invpmax
d893 1
a893 1
.It Sy med_thmin
d895 1
a895 1
.It Sy med_thmax
d897 1
a897 1
.It Sy med_invpmax
d899 1
a899 1
.It Sy hi_thmin
d901 1
a901 1
.It Sy hi_thmax
d903 1
a903 1
.It Sy hi_invpmax
d905 1
a905 1
.It Sy ecn
d908 1
a908 2
.Pp
.Sh BLUE Commands
d910 1
a910 1
.It Nm interface
d923 1
a923 1
.It Em if_name
d925 1
a925 1
.It Sy bandwidth
d927 1
a927 1
.It Sy tbrsize
d929 1
a929 1
.It Em sched_type
d931 1
a931 1
.Sy blue
d933 1
a933 1
.It Sy qlimit
d936 1
a936 1
.It Sy packetsize
d938 1
a938 1
.It Sy maxpmark
d940 1
a940 1
.It Sy holdtime
d942 1
a942 1
.It Sy ecn
d945 1
a945 2
.Pp
.Sh CDNR Commands
d947 4
a950 4
.Sy conditioner
command specifies a diffserv traffic conditioner.  A traffic
conditioner is not a queueing discipline but a component to meter,
mark or drop incoming packets according to some rules.
d958 1
a958 1
.It Nm interface
d965 1
a965 1
.Sy conditioner
d968 1
a968 1
.It Nm conditioner
d975 1
a975 1
.It Em if_name
d977 4
a980 4
.It Em cdnr_name
Arbitrary name for this conditioner.  Must be unique for this
interface.
.It Em action
d984 2
a985 2
An action can be a recursively defined action. The following actions
are defined.
d987 1
a987 1
.It Nm pass
d989 1
a989 1
.It Sy pass
d995 1
a995 1
.It Nm drop
d997 3
a999 2
.It Sy drop
rejects the packet.  The packet is immediately discarded.
d1004 1
a1004 1
.It Nm mark
d1007 3
a1009 3
.It Sy mark
sets the specified value to the ds field in the IP header.  Then, the
packet is allowed to go through.
d1014 1
a1014 1
.It Nm tbmeter
d1020 1
a1020 1
.It Sy tbmeter
d1022 2
a1023 1
Rate is token rate in bits-per-second.  Depth is bucket depth in KB.
d1031 1
a1031 1
.It Nm trtcm
d1038 1
a1038 1
.It Sy trtcm
d1043 8
a1050 6
green_action.  When the packet is out of the committed profile but in
the peak profile, trtcm takes yellow_action.  Otherwise, tbtcm takes
red_action.
A trtcm is either color-aware or color-blind.  A color-aware trtcm do
not raise the color (ds field value), that is, a yellow packet can be
yellow or red but can not be blue.  Default is color-blind.
d1055 1
a1055 1
.It Nm tswtcm
d1061 1
a1061 1
.It Sy tswtcm
d1068 4
a1071 3
green_action.  When the packet is out of the committed profile but in
the peak profile, tswtcm takes yellow_action.  Otherwise, tswtcm takes
red_action.
d1074 2
a1075 2
rate, and is specified in milli-second.  500 msec is ok for normal
settings.
a1077 1
.Pp
d1079 2
a1080 4
.nf

CBQ Example:

d1100 3
a1102 3

HFSC Example:

d1135 3
a1137 4


PRIQ Example:

d1151 3
a1153 4


WFQ Example:

d1155 3
a1157 4


FIFOQ Example:

d1159 3
a1161 4


Conditioner Example:

d1187 1
a1187 3

.fi
.Pp
@


1.3
log
@we don't like:
o) .Pp before/after .Sh;
o) .Pp before/after .Sh;
o) .Nm without argument in SYNOPSIS;
@
text
@d1 1
a1 1
.\"	$OpenBSD: altq.conf.5,v 1.2 2001/06/29 15:44:38 espie Exp $
d52 1
d100 1
d144 1
d264 1
d430 1
d566 1
d639 1
d684 1
d715 1
d785 1
d884 1
d922 1
d1051 1
d1169 1
@


1.2
log
@typos
@
text
@d1 1
a1 1
.\"	$OpenBSD: altq.conf.5,v 1.1.1.1 2001/06/27 18:23:17 kjc Exp $
a51 1
.Pp
a98 1
.Pp
a141 1
.Pp
a260 1
.Pp
a425 1
.Pp
a560 1
.Pp
a632 1
.Pp
a676 1
.Pp
a706 1
.Pp
a775 1
.Pp
a873 1
.Pp
a910 1
.Pp
a1038 1
.Pp
a1155 1
.Pp
@


1.1
log
@Initial revision
@
text
@d1 1
a1 1
.\"	$OpenBSD$
d133 1
a133 1
RED drops packets with the probability propotional to the average
d911 1
a911 1
The maxium queue size in number of packets.
d1045 1
a1045 1
cmtd_rate and peak_rate are specified in bits per seccond.
@


1.1.1.1
log
@import ALTQ userland tools from KAME.
@
text
@@
