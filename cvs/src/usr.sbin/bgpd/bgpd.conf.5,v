head	1.154;
access;
symbols
	OPENBSD_6_1:1.152.0.4
	OPENBSD_6_1_BASE:1.152
	OPENBSD_6_0:1.144.0.4
	OPENBSD_6_0_BASE:1.144
	OPENBSD_5_9:1.140.0.2
	OPENBSD_5_9_BASE:1.140
	OPENBSD_5_8:1.136.0.4
	OPENBSD_5_8_BASE:1.136
	OPENBSD_5_7:1.133.0.2
	OPENBSD_5_7_BASE:1.133
	OPENBSD_5_6:1.131.0.4
	OPENBSD_5_6_BASE:1.131
	OPENBSD_5_5:1.130.0.4
	OPENBSD_5_5_BASE:1.130
	OPENBSD_5_4:1.125.0.2
	OPENBSD_5_4_BASE:1.125
	OPENBSD_5_3:1.124.0.2
	OPENBSD_5_3_BASE:1.124
	OPENBSD_5_2:1.120.0.2
	OPENBSD_5_2_BASE:1.120
	OPENBSD_5_1_BASE:1.116
	OPENBSD_5_1:1.116.0.2
	OPENBSD_5_0:1.115.0.2
	OPENBSD_5_0_BASE:1.115
	OPENBSD_4_9:1.113.0.2
	OPENBSD_4_9_BASE:1.113
	OPENBSD_4_8:1.111.0.2
	OPENBSD_4_8_BASE:1.111
	OPENBSD_4_7:1.104.0.2
	OPENBSD_4_7_BASE:1.104
	OPENBSD_4_6:1.94.0.4
	OPENBSD_4_6_BASE:1.94
	OPENBSD_4_5:1.90.0.2
	OPENBSD_4_5_BASE:1.90
	OPENBSD_4_4:1.88.0.2
	OPENBSD_4_4_BASE:1.88
	OPENBSD_4_3:1.87.0.2
	OPENBSD_4_3_BASE:1.87
	OPENBSD_4_2:1.86.0.2
	OPENBSD_4_2_BASE:1.86
	OPENBSD_4_1:1.83.0.2
	OPENBSD_4_1_BASE:1.83
	OPENBSD_4_0:1.76.0.2
	OPENBSD_4_0_BASE:1.76
	OPENBSD_3_9:1.64.0.2
	OPENBSD_3_9_BASE:1.64
	OPENBSD_3_8:1.60.0.2
	OPENBSD_3_8_BASE:1.60
	OPENBSD_3_7:1.46.0.2
	OPENBSD_3_7_BASE:1.46
	OPENBSD_3_6:1.37.0.2
	OPENBSD_3_6_BASE:1.37
	OPENBSD_3_5:1.20.0.2
	OPENBSD_3_5_BASE:1.20;
locks; strict;
comment	@.\" @;


1.154
date	2017.05.27.10.33.15;	author phessler;	state Exp;
branches;
next	1.153;
commitid	SM4OMu9209fRs2iQ;

1.153
date	2017.05.27.10.24.44;	author phessler;	state Exp;
branches;
next	1.152;
commitid	lmPnpLRIggYi6nnK;

1.152
date	2017.01.13.18.59.12;	author phessler;	state Exp;
branches;
next	1.151;
commitid	3Jvf15B19ysa8i2W;

1.151
date	2016.10.30.16.50.22;	author phessler;	state Exp;
branches;
next	1.150;
commitid	Slu6lHH7bHSq4rfD;

1.150
date	2016.10.18.19.47.52;	author benno;	state Exp;
branches;
next	1.149;
commitid	5x9UhbnnXpAv8nhe;

1.149
date	2016.10.15.12.35.19;	author jmc;	state Exp;
branches;
next	1.148;
commitid	roeOxMDmay2G4YpT;

1.148
date	2016.10.14.16.05.35;	author phessler;	state Exp;
branches;
next	1.147;
commitid	Ai7XVOgXw9ZLovz1;

1.147
date	2016.10.05.07.38.06;	author phessler;	state Exp;
branches;
next	1.146;
commitid	XF7pIhaJDJdwfpZW;

1.146
date	2016.08.17.08.14.40;	author phessler;	state Exp;
branches;
next	1.145;
commitid	tSy0nRUk8o8kJxVG;

1.145
date	2016.08.17.08.13.52;	author phessler;	state Exp;
branches;
next	1.144;
commitid	tasExp07gfuZGMMu;

1.144
date	2016.06.28.16.59.14;	author jca;	state Exp;
branches;
next	1.143;
commitid	PdUNFhKkQf3LiGM0;

1.143
date	2016.06.11.11.43.02;	author tobias;	state Exp;
branches;
next	1.142;
commitid	5has4gkNJ69vv6Xi;

1.142
date	2016.06.03.20.58.13;	author jmc;	state Exp;
branches;
next	1.141;
commitid	0i3DlZsCDKzVkqWg;

1.141
date	2016.06.03.17.36.37;	author benno;	state Exp;
branches;
next	1.140;
commitid	utIafqBHH3dRVCSC;

1.140
date	2016.01.07.18.41.41;	author florian;	state Exp;
branches;
next	1.139;
commitid	X4RjS5dmoWbV8I87;

1.139
date	2015.10.11.19.30.12;	author phessler;	state Exp;
branches;
next	1.138;
commitid	2KBZGXKaVqa0PMnV;

1.138
date	2015.09.21.10.06.47;	author jmc;	state Exp;
branches;
next	1.137;
commitid	kAbWAmP78bKJUd73;

1.137
date	2015.09.21.09.47.15;	author phessler;	state Exp;
branches;
next	1.136;
commitid	0iY3tr4GQ1eTlhDV;

1.136
date	2015.07.19.14.35.41;	author jmc;	state Exp;
branches;
next	1.135;
commitid	RFni9Vf0SVru2wWq;

1.135
date	2015.07.19.04.54.53;	author benno;	state Exp;
branches;
next	1.134;
commitid	s1ADA59uOI72xctv;

1.134
date	2015.04.25.15.28.18;	author phessler;	state Exp;
branches;
next	1.133;
commitid	4yPC9ACFnDblFb1s;

1.133
date	2015.02.28.21.51.57;	author bentley;	state Exp;
branches;
next	1.132;
commitid	NNu2UZnsd5zmNVYD;

1.132
date	2014.11.10.20.48.33;	author miod;	state Exp;
branches;
next	1.131;
commitid	B60kqG6DZgjL7Cwr;

1.131
date	2014.05.20.23.41.36;	author dlg;	state Exp;
branches;
next	1.130;

1.130
date	2013.11.13.09.14.48;	author florian;	state Exp;
branches;
next	1.129;

1.129
date	2013.10.19.15.04.25;	author claudio;	state Exp;
branches;
next	1.128;

1.128
date	2013.10.17.09.14.02;	author blambert;	state Exp;
branches;
next	1.127;

1.127
date	2013.10.16.21.17.27;	author jmc;	state Exp;
branches;
next	1.126;

1.126
date	2013.09.10.07.29.12;	author weerd;	state Exp;
branches;
next	1.125;

1.125
date	2013.05.30.10.13.58;	author sthen;	state Exp;
branches;
next	1.124;

1.124
date	2013.01.02.15.06.46;	author florian;	state Exp;
branches;
next	1.123;

1.123
date	2012.11.13.14.26.26;	author jmc;	state Exp;
branches;
next	1.122;

1.122
date	2012.11.13.09.47.20;	author claudio;	state Exp;
branches;
next	1.121;

1.121
date	2012.08.24.17.04.06;	author jmc;	state Exp;
branches;
next	1.120;

1.120
date	2012.07.07.08.22.57;	author claudio;	state Exp;
branches;
next	1.119;

1.119
date	2012.06.19.08.22.27;	author sthen;	state Exp;
branches;
next	1.118;

1.118
date	2012.04.24.14.56.09;	author jmc;	state Exp;
branches;
next	1.117;

1.117
date	2012.04.07.17.25.51;	author claudio;	state Exp;
branches;
next	1.116;

1.116
date	2011.09.17.16.29.44;	author claudio;	state Exp;
branches;
next	1.115;

1.115
date	2011.06.23.20.35.22;	author sthen;	state Exp;
branches;
next	1.114;

1.114
date	2011.04.30.07.52.33;	author sthen;	state Exp;
branches;
next	1.113;

1.113
date	2010.10.23.16.44.56;	author sthen;	state Exp;
branches;
next	1.112;

1.112
date	2010.10.13.21.04.13;	author sthen;	state Exp;
branches;
next	1.111;

1.111
date	2010.06.27.21.01.49;	author jmc;	state Exp;
branches;
next	1.110;

1.110
date	2010.06.27.19.53.34;	author claudio;	state Exp;
branches;
next	1.109;

1.109
date	2010.05.17.17.46.22;	author jmc;	state Exp;
branches;
next	1.108;

1.108
date	2010.05.17.16.08.20;	author claudio;	state Exp;
branches;
next	1.107;

1.107
date	2010.05.17.15.49.29;	author claudio;	state Exp;
branches;
next	1.106;

1.106
date	2010.05.04.07.37.56;	author claudio;	state Exp;
branches;
next	1.105;

1.105
date	2010.04.28.13.07.48;	author claudio;	state Exp;
branches;
next	1.104;

1.104
date	2010.03.05.15.25.00;	author claudio;	state Exp;
branches;
next	1.103;

1.103
date	2009.12.16.15.40.55;	author claudio;	state Exp;
branches;
next	1.102;

1.102
date	2009.11.26.13.40.43;	author henning;	state Exp;
branches;
next	1.101;

1.101
date	2009.10.28.21.38.03;	author jmc;	state Exp;
branches;
next	1.100;

1.100
date	2009.10.28.09.16.49;	author claudio;	state Exp;
branches;
next	1.99;

1.99
date	2009.10.22.21.12.47;	author sobrado;	state Exp;
branches;
next	1.98;

1.98
date	2009.10.13.09.51.53;	author claudio;	state Exp;
branches;
next	1.97;

1.97
date	2009.10.06.09.44.13;	author claudio;	state Exp;
branches;
next	1.96;

1.96
date	2009.09.28.08.25.25;	author sthen;	state Exp;
branches;
next	1.95;

1.95
date	2009.08.31.09.08.04;	author claudio;	state Exp;
branches;
next	1.94;

1.94
date	2009.06.07.00.31.22;	author claudio;	state Exp;
branches;
next	1.93;

1.93
date	2009.06.04.01.20.44;	author sthen;	state Exp;
branches;
next	1.92;

1.92
date	2009.05.27.04.18.21;	author reyk;	state Exp;
branches;
next	1.91;

1.91
date	2009.03.22.22.34.59;	author henning;	state Exp;
branches;
next	1.90;

1.90
date	2008.12.19.18.58.12;	author henning;	state Exp;
branches;
next	1.89;

1.89
date	2008.10.02.12.39.25;	author jmc;	state Exp;
branches;
next	1.88;

1.88
date	2008.03.22.08.38.38;	author claudio;	state Exp;
branches;
next	1.87;

1.87
date	2007.10.21.21.34.14;	author mk;	state Exp;
branches;
next	1.86;

1.86
date	2007.05.31.19.20.22;	author jmc;	state Exp;
branches;
next	1.85;

1.85
date	2007.04.24.13.45.24;	author claudio;	state Exp;
branches;
next	1.84;

1.84
date	2007.03.29.13.10.32;	author claudio;	state Exp;
branches;
next	1.83;

1.83
date	2007.03.06.16.52.48;	author henning;	state Exp;
branches;
next	1.82;

1.82
date	2007.03.04.17.41.40;	author henning;	state Exp;
branches;
next	1.81;

1.81
date	2007.01.27.08.08.54;	author jmc;	state Exp;
branches;
next	1.80;

1.80
date	2007.01.26.23.17.18;	author claudio;	state Exp;
branches;
next	1.79;

1.79
date	2007.01.26.21.39.10;	author claudio;	state Exp;
branches;
next	1.78;

1.78
date	2006.12.05.12.08.13;	author henning;	state Exp;
branches;
next	1.77;

1.77
date	2006.11.28.16.39.34;	author henning;	state Exp;
branches;
next	1.76;

1.76
date	2006.09.12.13.39.37;	author jmc;	state Exp;
branches;
next	1.75;

1.75
date	2006.08.31.18.44.48;	author jmc;	state Exp;
branches;
next	1.74;

1.74
date	2006.08.28.23.16.51;	author stevesk;	state Exp;
branches;
next	1.73;

1.73
date	2006.08.04.12.01.48;	author henning;	state Exp;
branches;
next	1.72;

1.72
date	2006.06.19.20.51.46;	author jmc;	state Exp;
branches;
next	1.71;

1.71
date	2006.06.17.14.06.09;	author henning;	state Exp;
branches;
next	1.70;

1.70
date	2006.05.26.04.02.59;	author deraadt;	state Exp;
branches;
next	1.69;

1.69
date	2006.04.04.12.39.19;	author henning;	state Exp;
branches;
next	1.68;

1.68
date	2006.03.23.20.26.44;	author claudio;	state Exp;
branches;
next	1.67;

1.67
date	2006.03.08.13.20.25;	author claudio;	state Exp;
branches;
next	1.66;

1.66
date	2006.03.07.17.54.08;	author claudio;	state Exp;
branches;
next	1.65;

1.65
date	2006.03.07.15.06.43;	author claudio;	state Exp;
branches;
next	1.64;

1.64
date	2006.02.25.15.53.15;	author claudio;	state Exp;
branches;
next	1.63;

1.63
date	2006.02.05.11.06.01;	author jmc;	state Exp;
branches;
next	1.62;

1.62
date	2006.02.04.13.16.44;	author claudio;	state Exp;
branches;
next	1.61;

1.61
date	2005.10.19.10.42.06;	author henning;	state Exp;
branches;
next	1.60;

1.60
date	2005.08.10.09.00.16;	author jmc;	state Exp;
branches;
next	1.59;

1.59
date	2005.08.09.20.27.25;	author claudio;	state Exp;
branches;
next	1.58;

1.58
date	2005.07.28.20.32.33;	author henning;	state Exp;
branches;
next	1.57;

1.57
date	2005.06.29.09.43.25;	author claudio;	state Exp;
branches;
next	1.56;

1.56
date	2005.06.09.15.32.03;	author claudio;	state Exp;
branches;
next	1.55;

1.55
date	2005.06.04.21.48.16;	author henning;	state Exp;
branches;
next	1.54;

1.54
date	2005.05.01.17.35.26;	author david;	state Exp;
branches;
next	1.53;

1.53
date	2005.04.28.13.54.45;	author claudio;	state Exp;
branches;
next	1.52;

1.52
date	2005.04.18.11.19.39;	author jmc;	state Exp;
branches;
next	1.51;

1.51
date	2005.04.18.00.16.16;	author henning;	state Exp;
branches;
next	1.50;

1.50
date	2005.04.13.20.05.12;	author jmc;	state Exp;
branches;
next	1.49;

1.49
date	2005.04.12.21.53.38;	author jmc;	state Exp;
branches;
next	1.48;

1.48
date	2005.04.12.14.32.00;	author claudio;	state Exp;
branches;
next	1.47;

1.47
date	2005.04.12.14.22.46;	author claudio;	state Exp;
branches;
next	1.46;

1.46
date	2005.03.15.23.41.52;	author henning;	state Exp;
branches;
next	1.45;

1.45
date	2005.03.15.09.24.05;	author jmc;	state Exp;
branches;
next	1.44;

1.44
date	2005.03.14.17.32.04;	author claudio;	state Exp;
branches;
next	1.43;

1.43
date	2005.03.11.12.54.19;	author claudio;	state Exp;
branches;
next	1.42;

1.42
date	2004.12.31.10.47.37;	author jaredy;	state Exp;
branches;
next	1.41;

1.41
date	2004.11.19.10.06.33;	author claudio;	state Exp;
branches;
next	1.40;

1.40
date	2004.11.11.10.35.15;	author claudio;	state Exp;
branches;
next	1.39;

1.39
date	2004.11.09.10.37.42;	author henning;	state Exp;
branches;
next	1.38;

1.38
date	2004.09.28.12.09.31;	author claudio;	state Exp;
branches;
next	1.37;

1.37
date	2004.08.20.14.56.09;	author claudio;	state Exp;
branches;
next	1.36;

1.36
date	2004.08.19.16.12.31;	author hshoexer;	state Exp;
branches;
next	1.35;

1.35
date	2004.08.13.14.03.20;	author claudio;	state Exp;
branches;
next	1.34;

1.34
date	2004.08.09.16.29.18;	author jaredy;	state Exp;
branches;
next	1.33;

1.33
date	2004.07.30.22.50.49;	author claudio;	state Exp;
branches;
next	1.32;

1.32
date	2004.07.13.18.27.57;	author jaredy;	state Exp;
branches;
next	1.31;

1.31
date	2004.07.11.00.53.20;	author jfb;	state Exp;
branches;
next	1.30;

1.30
date	2004.07.09.11.01.22;	author henning;	state Exp;
branches;
next	1.29;

1.29
date	2004.07.05.17.04.44;	author henning;	state Exp;
branches;
next	1.28;

1.28
date	2004.05.24.08.45.04;	author jmc;	state Exp;
branches;
next	1.27;

1.27
date	2004.05.23.23.05.31;	author jmc;	state Exp;
branches;
next	1.26;

1.26
date	2004.05.21.15.36.40;	author claudio;	state Exp;
branches;
next	1.25;

1.25
date	2004.05.17.12.39.32;	author djm;	state Exp;
branches;
next	1.24;

1.24
date	2004.05.08.20.18.45;	author henning;	state Exp;
branches;
next	1.23;

1.23
date	2004.05.08.20.00.44;	author henning;	state Exp;
branches;
next	1.22;

1.22
date	2004.05.07.10.06.15;	author djm;	state Exp;
branches;
next	1.21;

1.21
date	2004.04.02.18.28.49;	author henning;	state Exp;
branches;
next	1.20;

1.20
date	2004.03.12.20.23.01;	author henning;	state Exp;
branches;
next	1.19;

1.19
date	2004.03.12.17.39.46;	author claudio;	state Exp;
branches;
next	1.18;

1.18
date	2004.02.25.21.15.01;	author claudio;	state Exp;
branches;
next	1.17;

1.17
date	2004.02.07.20.40.47;	author henning;	state Exp;
branches;
next	1.16;

1.16
date	2004.02.01.19.49.10;	author claudio;	state Exp;
branches;
next	1.15;

1.15
date	2004.01.18.07.35.30;	author jmc;	state Exp;
branches;
next	1.14;

1.14
date	2004.01.13.14.31.18;	author claudio;	state Exp;
branches;
next	1.13;

1.13
date	2004.01.07.12.33.15;	author claudio;	state Exp;
branches;
next	1.12;

1.12
date	2004.01.06.20.41.55;	author henning;	state Exp;
branches;
next	1.11;

1.11
date	2004.01.06.03.43.50;	author henning;	state Exp;
branches;
next	1.10;

1.10
date	2003.12.27.21.40.43;	author henning;	state Exp;
branches;
next	1.9;

1.9
date	2003.12.27.18.43.36;	author henning;	state Exp;
branches;
next	1.8;

1.8
date	2003.12.27.14.42.59;	author henning;	state Exp;
branches;
next	1.7;

1.7
date	2003.12.26.20.52.14;	author jakob;	state Exp;
branches;
next	1.6;

1.6
date	2003.12.26.20.40.10;	author henning;	state Exp;
branches;
next	1.5;

1.5
date	2003.12.26.20.29.10;	author jmc;	state Exp;
branches;
next	1.4;

1.4
date	2003.12.25.14.28.49;	author henning;	state Exp;
branches;
next	1.3;

1.3
date	2003.12.24.13.49.21;	author henning;	state Exp;
branches;
next	1.2;

1.2
date	2003.12.24.11.38.56;	author henning;	state Exp;
branches;
next	1.1;

1.1
date	2003.12.23.17.06.32;	author henning;	state Exp;
branches;
next	;


desc
@@


1.154
log
@Allow OpenBGPD to selectively choose which local ASN to use per-peer.
This is intended to be used for ASN migrations, not for permanent use.

You MUST use filters to protect yourself from receiving your own routes.
There be dragons and grues.

OK claudio@@ benno@@
@
text
@.\" $OpenBSD: bgpd.conf.5,v 1.153 2017/05/27 10:24:44 phessler Exp $
.\"
.\" Copyright (c) 2004 Claudio Jeker <claudio@@openbsd.org>
.\" Copyright (c) 2003, 2004 Henning Brauer <henning@@openbsd.org>
.\" Copyright (c) 2002 Daniel Hartmeier <dhartmei@@openbsd.org>
.\"
.\" Permission to use, copy, modify, and distribute this software for any
.\" purpose with or without fee is hereby granted, provided that the above
.\" copyright notice and this permission notice appear in all copies.
.\"
.\" THE SOFTWARE IS PROVIDED "AS IS" AND THE AUTHOR DISCLAIMS ALL WARRANTIES
.\" WITH REGARD TO THIS SOFTWARE INCLUDING ALL IMPLIED WARRANTIES OF
.\" MERCHANTABILITY AND FITNESS. IN NO EVENT SHALL THE AUTHOR BE LIABLE FOR
.\" ANY SPECIAL, DIRECT, INDIRECT, OR CONSEQUENTIAL DAMAGES OR ANY DAMAGES
.\" WHATSOEVER RESULTING FROM LOSS OF USE, DATA OR PROFITS, WHETHER IN AN
.\" ACTION OF CONTRACT, NEGLIGENCE OR OTHER TORTIOUS ACTION, ARISING OUT OF
.\" OR IN CONNECTION WITH THE USE OR PERFORMANCE OF THIS SOFTWARE.
.\"
.Dd $Mdocdate: May 27 2017 $
.Dt BGPD.CONF 5
.Os
.Sh NAME
.Nm bgpd.conf
.Nd Border Gateway Protocol daemon configuration file
.Sh DESCRIPTION
The
.Xr bgpd 8
daemon implements the Border Gateway Protocol version 4 as described
in RFC 4271.
.Sh SECTIONS
The
.Nm
config file is divided into five main sections.
.Bl -tag -width xxxx
.It Sy Macros
User-defined variables may be defined and used later, simplifying the
configuration file.
.It Sy Global Configuration
Global settings for
.Xr bgpd 8 .
.It Sy Routing Domain Configuration
The definition and properties for BGP MPLS VPNs are set in this section.
.It Sy Neighbors and Groups
.Xr bgpd 8
establishes sessions with
.Em neighbors .
The neighbor definition and properties are set in this section, as well as
grouping neighbors for the ease of configuration.
.It Sy Filter
Filter rules for incoming and outgoing
.Em UPDATES .
.El
.Pp
With the exception of macros,
the sections should be grouped and appear in
.Nm
in the order shown above.
.Pp
The current line can be extended over multiple lines using a backslash
.Pq Sq \e .
Comments can be put anywhere in the file using a hash mark
.Pq Sq # ,
and extend to the end of the current line.
Care should be taken when commenting out multi-line text:
the comment is effective until the end of the entire block.
.Pp
Argument names not beginning with a letter, digit, or underscore
must be quoted.
.Pp
Additional configuration files can be included with the
.Ic include
keyword, for example:
.Bd -literal -offset indent
include "/etc/bgpd/bgpd-10.0.0.1.filter"
.Ed
.Sh MACROS
Macros can be defined that will later be expanded in context.
Macro names must start with a letter, digit, or underscore,
and may contain any of those characters.
Macro names may not be reserved words (for example,
.Ic AS ,
.Ic neighbor ,
or
.Ic group ) .
Macros are not expanded inside quotes.
.Pp
For example:
.Bd -literal -offset indent
peer1="1.2.3.4"
neighbor $peer1 {
	remote-as 65001
}
.Ed
.Sh GLOBAL CONFIGURATION
There are quite a few settings that affect the operation of the
.Xr bgpd 8
daemon globally.
.Pp
.Bl -tag -width Ds -compact
.It Ic AS Ar as-number Op Ar as-number
Set the local
.Em autonomous system
number to
.Ar as-number .
If the first AS number is a 4-byte AS it is possible to specify a secondary
2-byte AS number which is used for neighbors which do not support 4-byte AS
numbers.
The default for the secondary AS is 23456.
.Pp
The AS numbers are assigned by local RIRs, such as:
.Pp
.Bl -tag -width xxxxxxxx -compact
.It AfriNIC
for Africa
.It APNIC
for Asia Pacific
.It ARIN
for North America and parts of the Caribbean
.It LACNIC
for Latin America and the Caribbean
.It RIPE NCC
for Europe, the Middle East, and parts of Asia
.El
.Pp
For example:
.Bd -literal -offset indent
AS 65001
.Ed
.Pp
sets the local AS to 65001.
.Pp
The AS numbers 64512 \(en 65534 are designated for private use.
The AS number 23456 is a specially designated Autonomous System Number and
should not be used.
4-byte AS numbers are specified as two numbers separated by a dot
(ASDOT format),
for example:
.Bd -literal -offset indent
AS 3.10
.Ed
.Pp
or as a large number (ASPLAIN format), for example:
.Bd -literal -offset indent
AS 196618
.Ed
.Pp
.It Ic connect-retry Ar seconds
Set the number of seconds before retrying to open a connection.
This timer should be sufficiently large in EBGP configurations.
The default is 120 seconds.
.Pp
.It Xo
.Ic dump
.Op Ic rib Ar name
.Pq Ic table Ns | Ns Ic table-mp Ns | Ns Ic table-v2
.Ar file Op Ar timeout
.Xc
.It Xo
.Ic dump
.Pq Ic all Ns | Ns Ic updates
.Pq Ic in Ns | Ns Ic out
.Ar file Op Ar timeout
.Xc
Dump the RIB, a.k.a. the
.Em routing information base ,
and all BGP messages in Multi-threaded Routing Toolkit (MRT) format.
It is possible to dump alternate RIB with the use of
.Ar name .
.Pp
For example, the following will dump the entire table to the
.Xr strftime 3 Ns -expanded
filename.
Only the
.Ic table-v2
format is able to dump a multi-protocol RIB correctly.
Both
.Ic table
and
.Ic table-mp
formats are more or less limited when handling multi-protocol entries and
are only left around to support 3rd party tools not handling the new format.
The timeout is optional:
.Bd -literal -offset indent
dump table "/tmp/rib-dump-%H%M" 300
.Ed
.Pp
Similar to the table dump, but this time all
BGP messages and
.Em state transitions
will be dumped to the specified file:
.Bd -literal -offset indent
dump all in "/tmp/all-in-%H%M" 300
.Ed
.Pp
As before, but only the
.Em UPDATE
messages will be dumped to the file:
.Bd -literal -offset indent
dump updates in "/tmp/updates-in-%H%M" 300
.Ed
.Pp
It is also possible to dump outgoing messages:
.Bd -literal -offset indent
dump all out "/tmp/all-out-%H%M" 300
# or
dump updates out "/tmp/updates-out-%H%M" 300
.Ed
.Pp
.It Ic fib-priority Ar prio
Set the routing priority to
.Ar prio .
The default is 48.
.Pp
.It Xo
.Ic fib-update
.Pq Ic yes Ns | Ns Ic no
.Xc
If set to
.Ic no ,
do not update the Forwarding Information Base, a.k.a. the kernel
routing table.
The default is
.Ic yes .
.Pp
.It Ic holdtime Ar seconds
Set the holdtime in seconds.
The holdtime is reset to its initial value every time either a
.Em KEEPALIVE
or an
.Em UPDATE
message is received from the neighbor.
If the holdtime expires the session is dropped.
The default is 90 seconds.
Neighboring systems negotiate the holdtime used when the connection is
established in the
.Em OPEN
messages.
Each neighbor announces its configured holdtime; the smaller one is
then agreed upon.
.Pp
.It Ic holdtime min Ar seconds
The minimal accepted holdtime in seconds.
This value must be greater than or equal to 3.
.Pp
.It Ic listen on Ar address
Specify the local IP address
.Xr bgpd 8
should listen on.
.Bd -literal -offset indent
listen on 127.0.0.1
.Ed
.Pp
.It Ic log updates
Log received and sent updates.
.Pp
.It Xo
.Ic network
.Ar address Ns Li / Ns Ar prefix
.Op Ic set ...\&
.Xc
.It Xo
.Ic network
.Pq Ic inet Ns | Ns Ic inet6
.Ic static Op Ic set ...\&
.Xc
.It Xo
.Ic network
.Pq Ic inet Ns | Ns Ic inet6
.Ic connected Op Ic set ...\&
.Xc
.It Xo
.Ic network
.Pq Ic inet Ns | Ns Ic inet6
.Ic rtlabel Ar label Op Ic set ...\&
.Xc
Announce the specified network as belonging to our AS.
If set to
.Ic connected ,
routes to directly attached networks will be announced.
If set to
.Ic static ,
all static routes will be announced.
If set to
.Ic rtlabel ,
routes with the specified
.Ar label
will be announced.
.Bd -literal -offset indent
network 192.168.7.0/24
.Ed
.Pp
It is possible to set default
.Em AS path attributes
per
.Ic network
statement:
.Bd -literal -offset indent
network 192.168.7.0/24 set localpref 220
.Ed
.Pp
See also the
.Sx ATTRIBUTE SET
section.
.Pp
.It Xo
.Ic nexthop
.Ic qualify
.Ic via
.Pq Ic bgp Ns | Ns Ic default
.Xc
If set to
.Ic bgp ,
.Xr bgpd 8
may use BGP routes to verify nexthops.
If set to
.Ic default ,
bgpd may use the default route to verify nexthops.
By default bgpd will only use static routes or routes added by other routing
daemons like
.Xr ospfd 8 .
.Pp
.It Xo
.Ic rde
.Ic med
.Ic compare
.Pq Ic always Ns | Ns Ic strict
.Xc
If set to
.Ic always ,
the
.Em MULTI_EXIT_DISC
attributes will always be compared.
The default is
.Ic strict ,
where the metric is only compared between peers belonging to the same AS.
.Pp
.It Xo
.Ic rde
.Ic rib Ar name
.Op Ic no Ic evaluate
.Xc
.It Xo
.Ic rde
.Ic rib Ar name
.Op Ic rtable Ar number
.Xc
Create an additional RIB named
.Ar name .
It is possible to disable the decision process per RIB with the
.Ic no Ic evaluate
flag.
If a
.Ic rtable
is specified, routes will be exported to the given kernel routing table.
Currently the routing table must belong to the default routing domain and
nexthop verification happens on table 0.
Routes in the specified table will not be considered for nexthop verification.
.Ic Adj-RIB-In
and
.Ic Loc-RIB
are created automatically and used as default.
.Pp
.It Xo
.Ic rde
.Ic route-age
.Pq Ic ignore Ns | Ns Ic evaluate
.Xc
If set to
.Ic evaluate ,
the best path selection will not only be based on the path attributes but
also on the age of the route, giving preference to the older, typically
more stable, route.
In this case the decision process is no longer deterministic.
The default is
.Ic ignore .
.Pp
.It Xo
.Ic route-collector
.Pq Ic yes Ns | Ns Ic no
.Xc
If set to
.Ic yes ,
the route selection process is turned off.
The default is
.Ic no .
.Pp
.It Ic router-id Ar address
Set the router ID to the given IP address, which must be local to the
machine.
.Bd -literal -offset indent
router-id 10.0.0.1
.Ed
.Pp
If not given, the BGP ID is determined as the biggest IP address assigned
to the local machine.
.Pp
.It Ic rtable Ar number
Work with the given kernel routing table
instead of the default table,
.Ar 0 .
Note that table 0 is used for nexthop verification.
Routes in the specified table will not be considered for nexthop verification.
This is the same as using the following syntax:
.Bd -literal -offset indent
rde rib Loc-RIB rtable number
.Ed
.Pp
.It Ic socket Qo Ar path Qc Op Ic restricted
Create a control socket at
.Ar path .
If
.Ic restricted
is specified a restricted control socket will be created.
By default
.Pa /var/run/bgpd.sock
is used and no restricted socket is created.
.Pp
.It Xo
.Ic transparent-as
.Pq Ic yes Ns | Ns Ic no
.Xc
If set to
.Ic yes ,
.Em AS paths
to EBGP neighbors are not prepended with the local AS.
The default is
.Ic no .
.El
.Sh ROUTING DOMAIN CONFIGURATION
.Xr bgpd 8
supports the setup and distribution of Virtual Private Networks.
It is possible to import and export prefixes between routing domains.
Each routing domain is specified by an
.Ic rdomain
section, which allows properties to be set specifically for that rdomain:
.Bd -literal -offset indent
rdomain 1 {
	descr "a rdomain"
	rd 65002:1
	import-target rt 65002:42
	export-target rt 65002:42
	network 192.168.1/24
	depend on mpe0
}
.Ed
.Pp
There are several routing domain properties:
.Pp
.Bl -tag -width Ds -compact
.It Ic depend on Ar interface
Routes added to the rdomain will use this interface as the outgoing interface.
Normally this will be an MPLS Provider Edge,
.Xr mpe 4 ,
interface that is part of the rdomain.
Local networks will be announced with the MPLS label specified on the interface.
.Pp
.It Ic descr Ar description
Add a description.
The description is used when logging but has no further meaning to
.Xr bgpd 8 .
.Pp
.It Ic export-target Ar subtype Ar as-number : Ns Ar local
.It Ic export-target Ar subtype Ar IP : Ns Ar local
Specify an extended community which will be attached to announced networks.
More than one
.Ic export-target
can be specified.
See also the
.Sx ATTRIBUTE SET
section for further information about the encoding.
The
.Ar subtype
should be set to
.Ar rt
for best compatibility with other implementations.
.Pp
.It Xo
.Ic fib-update
.Pq Ic yes Ns | Ns Ic no
.Xc
If set to
.Ic no ,
do not update the Forwarding Information Base, a.k.a. the kernel
routing table.
The default is
.Ic yes .
.Pp
.It Ic import-target Ar subtype Ar as-number : Ns Ar local
.It Ic import-target Ar subtype Ar IP : Ns Ar local
Only prefixes matching one of the specified
.Ic import-targets
will be imported into the rdomain.
More than one
.Ic import-target
can be specified.
See also the
.Sx ATTRIBUTE SET
section for further information about the encoding of extended communities.
The
.Ar subtype
should be set to
.Ar rt
for best compatibility with other implementations.
.Pp
.It Ic network Ar arguments ...
Define which networks should be exported into this VPN.
See also the
.Ic nexthop
section in
.Sx GLOBAL CONFIGURATION
for further information about the arguments.
.Pp
.It Ic rd Ar as-number : Ns Ar local
.It Ic rd Ar IP : Ns Ar local
The sole purpose of the Route Distinguisher
.Ic rd
is to ensure that possible common prefixes are distinct between VPNs.
The
.Ic rd
is neither used to identify the origin of the prefix nor to control into
which VPNs the prefix is distributed to.
The
.Ar as-number
or
.Ar IP
of a
.Ic rd
should be set to a number or IP that was assigned by an appropriate authority.
Whereas
.Ar local
can be chosen by the local operator.
.El
.Sh NEIGHBORS AND GROUPS
.Xr bgpd 8
establishes TCP connections to other BGP speakers called
.Em neighbors .
Each neighbor is specified by a
.Ic neighbor
section, which allows properties to be set specifically for that neighbor:
.Bd -literal -offset indent
neighbor 10.0.0.2 {
	remote-as 65002
	descr "a neighbor"
}
.Ed
.Pp
Multiple neighbors can be grouped together by a
.Ic group
section.
Each
.Ic neighbor
section within the
.Ic group
section inherits all properties from its group:
.Bd -literal -offset indent
group "peering AS65002" {
	remote-as 65002
	neighbor 10.0.0.2 {
		descr "AS65002-p1"
	}
	neighbor 10.0.0.3 {
		descr "AS65002-p2"
	}
}
.Ed
.Pp
Instead of the neighbor's IP address, an address/netmask pair may be given:
.Bd -literal -offset indent
neighbor 10.0.0.0/8
.Ed
.Pp
In this case, the neighbor specification becomes a
.Em template ,
and if a neighbor connects from an IP address within the given network,
the template is
.Em cloned ,
inheriting everything from the template but the remote address, which is
replaced by the connecting neighbor's address.
With a template specification it is valid to omit
.Ic remote-as ;
.Xr bgpd 8
will then accept any AS the neighbor presents in the
.Em OPEN
message.
.Pp
There are several neighbor properties:
.Pp
.Bl -tag -width Ds -compact
.It Xo
.Ic announce
.Sm off
.Pq Ic all | none | self | default-route
.Sm on
.Xc
If set to
.Ic none ,
no
.Em UPDATE
messages will be sent to the neighbor.
If set to
.Ic default-route ,
only the default route will be announced to the neighbor.
If set to
.Ic all ,
all generated
.Em UPDATE
messages will be sent to the neighbor.
This is usually used for
.Em transit AS's
and
.Em IBGP
peers.
The default value
for
.Em EBGP
peers is
.Ic self ,
which limits the sent
.Em UPDATE
messages to announcements of the local AS.
The default for IBGP peers is
.Ic all .
.Pp
.It Xo
.Ic announce
.Pq Ic IPv4 Ns | Ns Ic IPv6
.Pq Ic none Ns | Ns Ic unicast Ns | Ns Ic vpn
.Xc
For the given address family, control which subsequent address families
are announced during the capabilities negotiation.
Only routes for that address family and subsequent address families will be
announced and processed.
.Pp
At the moment, only
.Em none ,
which disables the announcement of that address family,
.Em unicast ,
and
.Em vpn ,
which allows the distribution of BGP MPLS VPNs, are supported.
.Pp
The default is
.Ic unicast
for the same address family of the session.
.Pp
.It Xo
.Ic announce as-4byte
.Pq Ic yes Ns | Ns Ic no
.Xc
If set to
.Ic no ,
the 4-byte AS capability is not announced and so native 4-byte AS support is
disabled.
The default is
.Ic yes .
.Pp
.It Xo
.Ic announce capabilities
.Pq Ic yes Ns | Ns Ic no
.Xc
If set to
.Ic no ,
capability negotiation is disabled during the establishment of the session.
This can be helpful to connect to old or broken BGP implementations.
The default is
.Ic yes .
.Pp
.It Xo
.Ic announce refresh
.Pq Ic yes Ns | Ns Ic no
.Xc
If set to
.Ic no ,
the route refresh capability is not announced.
The default is
.Ic yes .
.Pp
.It Xo
.Ic announce restart
.Pq Ic yes Ns | Ns Ic no
.Xc
If set to
.Ic no ,
the graceful restart capability is not announced.
Currently only the End-of-RIB marker is supported and announced by the
.Ic restart
capability.
The default is
.Ic yes .
.Pp
.It Ic demote Ar group
Increase the
.Xr carp 4
demotion counter on the given interface group, usually
.Ar carp ,
when the session is not in state
.Em ESTABLISHED .
The demotion counter will be increased as soon as
.Xr bgpd 8
starts and decreased
60 seconds after the session went to state
.Em ESTABLISHED .
For neighbors added at runtime, the demotion counter is only increased after
the session has been
.Em ESTABLISHED
at least once before dropping.
.Pp
For more information on interface groups,
see the
.Ic group
keyword in
.Xr ifconfig 8 .
.Pp
.It Ic depend on Ar interface
The neighbor session will be kept in state
.Em IDLE
as long as
.Ar interface
reports no link.
For
.Xr carp 4
interfaces, no link means that the interface is currently
.Em backup .
This is primarily intended to be used with
.Xr carp 4
to reduce failover times.
.Pp
The state of the network interfaces on the system can be viewed
using the
.Cm show interfaces
command to
.Xr bgpctl 8 .
.Pp
.It Ic descr Ar description
Add a description.
The description is used when logging neighbor events, in status
reports, for specifying neighbors, etc., but has no further meaning to
.Xr bgpd 8 .
.Pp
.It Ic down Op Ar reason
Do not start the session when bgpd comes up but stay in
.Em IDLE .
If the session is cleared at runtime, after a
.Ic down
.Ar reason
was configured at runtime, the
.Ar reason
is sent as Administrative Shutdown Communication.
The
.Ar reason
cannot exceed 128 octets.
.Pp
.It Xo
.Ic dump
.Pq Ic all Ns | Ns Ic updates
.Pq Ic in Ns | Ns Ic out
.Ar file Op Ar timeout
.Xc
Do a peer specific MRT dump.
Peer specific dumps are limited to
.Ic all
and
.Ic updates .
See also the
.Ic dump
section in
.Sx GLOBAL CONFIGURATION .
.Pp
.It Xo
.Ic enforce neighbor-as
.Pq Ic yes Ns | Ns Ic no
.Xc
If set to
.Ic yes ,
.Em AS paths
whose
.Em leftmost AS
is not equal to the
.Em remote AS
of the neighbor are rejected and a
.Em NOTIFICATION
is sent back.
The default value for IBGP peers is
.Ic no
otherwise the default is
.Ic yes .
.Pp
.It Ic holdtime Ar seconds
Set the holdtime in seconds.
Inherited from the global configuration if not given.
.Pp
.It Ic holdtime min Ar seconds
Set the minimal acceptable holdtime.
Inherited from the global configuration if not given.
.Pp
.It Xo
.Ic ipsec
.Pq Ic ah Ns | Ns Ic esp
.Pq Ic in Ns | Ns Ic out
.Ic spi Ar spi-number authspec Op Ar encspec
.Xc
Enable IPsec with static keying.
There must be at least two
.Ic ipsec
statements per peer with manual keying, one per direction.
.Ar authspec
specifies the authentication algorithm and key.
It can be
.Bd -literal -offset indent
sha1 <key>
md5 <key>
.Ed
.Pp
.Ar encspec
specifies the encryption algorithm and key.
.Ic ah
does not support encryption.
With
.Ic esp ,
encryption is optional.
.Ar encspec
can be
.Bd -literal -offset indent
3des <key>
3des-cbc <key>
aes <key>
aes-128-cbc <key>
.Ed
.Pp
Keys must be given in hexadecimal format.
.Pp
.It Xo
.Ic ipsec
.Pq Ic ah Ns | Ns Ic esp
.Ic ike
.Xc
Enable IPsec with dynamic keying.
In this mode,
.Xr bgpd 8
sets up the flows, and a key management daemon such as
.Xr isakmpd 8
is responsible for managing the session keys.
With
.Xr isakmpd 8 ,
it is sufficient to copy the peer's public key, found in
.Pa /etc/isakmpd/local.pub ,
to the local machine.
It must be stored in a file
named after the peer's IP address and must be stored in
.Pa /etc/isakmpd/pubkeys/ipv4/ .
The local public key must be copied to the peer in the same way.
As
.Xr bgpd 8
manages the flows on its own, it is sufficient to restrict
.Xr isakmpd 8
to only take care of keying by specifying the flags
.Fl Ka .
This can be done in
.Xr rc.conf.local 8 .
After starting the
.Xr isakmpd 8
and
.Xr bgpd 8
daemons on both sides, the session should be established.
.Pp
.It Ic local-address Ar address
When
.Xr bgpd 8
initiates the TCP connection to the neighbor system, it normally does not
bind to a specific IP address.
If a
.Ic local-address
is given,
.Xr bgpd 8
binds to this address first.
.Pp
.It Ic local-as Ar as-number Op Ar as-number
Set the AS number sent to the remote system.
Used as described above under
.Sx GLOBAL CONFIGURATION
option
.Ic AS .
.Pp
Since there is no AS path loop check, this option is dangerous, and
requires you to add filters to prevent receiving your ASNs.
Intended to be used temporarily, for migrations to another AS.
.Pp
.It Ic log no
Disable neighbor specific logging.
.Pp
.It Ic log updates
Log received and sent updates for this neighbor.
.Pp
.It Xo
.Ic max-prefix Ar number
.Op Ic restart Ar number
.Xc
Terminate the session when the maximum
.Ar number
of prefixes received is exceeded
(no such limit is imposed by default).
If
.Ic restart
is specified, the session will be restarted after
.Ar number
minutes.
.Pp
.It Ic multihop Ar hops
Neighbors not in the same AS as the local
.Xr bgpd 8
normally have to be directly connected to the local machine.
If this is not the case, the
.Ic multihop
statement defines the maximum hops the neighbor may be away.
.Pp
.It Ic passive
Do not attempt to actively open a TCP connection to the neighbor system.
.Pp
.It Ic remote-as Ar as-number
Set the AS number of the remote system.
.Pp
.It Ic rib Ar name
Bind the neighbor to the specified RIB.
.Pp
.It Ic route-reflector Op Ar address
Act as an RFC 4456
.Em route-reflector
for this neighbor.
An optional cluster ID can be specified; otherwise the BGP ID will be used.
.Pp
.It Ic set Ar attribute ...
Set the
.Em AS path attributes
to some default per
.Ic neighbor
or
.Ic group
block:
.Bd -literal -offset indent
set localpref 300
.Ed
.Pp
See also the
.Sx ATTRIBUTE SET
section.
Set parameters are applied to the received prefixes; the only exceptions are
.Ic prepend-self ,
.Ic nexthop no-modify
and
.Ic nexthop self .
These sets are rewritten into filter rules and can be viewed with
.Dq bgpd -nv .
.Pp
.It Xo
.Ic softreconfig
.Pq Ic in Ns | Ns Ic out
.Pq Ic yes Ns | Ns Ic no
.Xc
Turn soft reconfiguration on or off for the specified direction.
If soft reconfiguration is turned on, filter changes will be applied on
configuration reloads.
If turned off, a BGP session needs to be cleared to apply the filter changes.
Enabling
.Ic softreconfig in
will raise the memory requirements of
.Xr bgpd 8
because the unmodified
.Em AS path attributes
need to be stored as well.
The default is
.Ic yes .
.Pp
.It Ic tcp md5sig password Ar secret
.It Ic tcp md5sig key Ar secret
Enable TCP MD5 signatures per RFC 2385.
The shared secret can either be given as a password or hexadecimal key.
.Bd -literal -offset indent
tcp md5sig password mekmitasdigoat
tcp md5sig key deadbeef
.Ed
.Pp
.It Xo
.Ic transparent-as
.Pq Ic yes Ns | Ns Ic no
.Xc
If set to
.Ic yes ,
.Em AS paths
to EBGP neighbors are not prepended with the local AS.
The default is inherited from the global
.Ic transparent-as
setting.
.Pp
.It Xo
.Ic ttl-security
.Pq Ic yes Ns | Ns Ic no
.Xc
Enable or disable ttl-security.
When enabled,
outgoing packets are sent using a TTL of 255
and a check is made against an incoming packet's TTL.
For directly connected peers,
incoming packets are required to have a TTL of 255,
ensuring they have not been routed.
For multihop peers,
incoming packets are required to have a TTL of 256 minus multihop distance,
ensuring they have not passed through more than the expected number of hops.
The default is
.Ic no .
.El
.Sh FILTER
.Xr bgpd 8
has the ability to
.Ic allow
and
.Ic deny
.Em UPDATES
based on
.Em prefix
or
.Em AS path attributes .
In addition,
.Em UPDATES
may also be modified by filter rules.
.Pp
For each
.Em UPDATE
processed by the filter, the filter rules are evaluated in sequential order,
from first to last.
The last matching
.Ic allow
or
.Ic deny
rule decides what action is taken.
.Pp
The following actions can be used in the filter:
.Bl -tag -width xxxxxxxx
.It Ic allow
The
.Em UPDATE
is passed.
.It Ic deny
The
.Em UPDATE
is blocked.
.It Ic match
Apply the filter attribute set without influencing the filter decision.
.El
.Sh PARAMETERS
The rule parameters specify the
.Em UPDATES
to which a rule applies.
An
.Em UPDATE
always comes from, or goes to, one neighbor.
Most parameters are optional, but each can appear at most once per rule.
If a parameter is specified, the rule only applies to packets with
matching attributes.
.Pp
.Bl -tag -width Ds -compact
.It Xo
.Ar as-type Op Ar operator
.Ar as-number
.Xc
This rule applies only to
.Em UPDATES
where the
.Em AS path
matches.
The
.Ar as-number
is matched against a part of the
.Em AS path
specified by the
.Ar as-type :
.Pp
.Bl -tag -width transmit-as -compact
.It Ic AS
(any part)
.It Ic peer-as
(leftmost AS number)
.It Ic source-as
(rightmost AS number)
.It Ic transit-as
(all but the rightmost AS number)
.El
.Pp
.Ar as-number
is an AS number as explained above under
.Sx GLOBAL CONFIGURATION .
It may be set to
.Ic neighbor-as ,
which is expanded to the current neighbor remote AS number, or
.Ic local-as ,
which is expanded to the locally assigned AS number.
.Pp
The
.Ar operator
can be unspecified (this case is identical to the equality operator), or one of the numerical operators
.Bd -literal -offset indent
=	(equal)
!=	(unequal)
-	(range including boundaries)
><	(except range)
.Ed
.Pp
>< and -
are binary operators (they take two arguments); with these,
.Ar as-number
cannot be set to
.Ic neighbor-as .
.Pp
Multiple
.Ar as-number
entries for a given type or
.Ar as-type as-number
entries may also be specified,
separated by commas or whitespace,
if enclosed in curly brackets:
.Bd -literal -offset indent
deny from any AS { 1, 2, 3 }
deny from any { AS 1, source-as 2, transit-as 3 }
deny from any { AS { 1, 2, 3 }, source-as 4, transit-as 5 }
.Ed
.Pp
.It Xo
.Ic community
.Ar as-number Ns Li \&: Ns Ar local
.Xc
.It Ic community Ar name
This rule applies only to
.Em UPDATES
where the
.Ic community
path attribute is present and matches.
Communities are specified as
.Ar as-number : Ns Ar local ,
where
.Ar as-number
is an AS number and
.Ar local
is a locally significant number between zero and
.Li 65535 .
Both
.Ar as-number
and
.Ar local
may be set to
.Sq *
to do wildcard matching.
Alternatively, well-known communities may be given by name instead and
include
.Ic BLACKHOLE ,
.Ic NO_EXPORT ,
.Ic NO_ADVERTISE ,
.Ic NO_EXPORT_SUBCONFED ,
and
.Ic NO_PEER .
Both
.Ar as-number
and
.Ar local
may be set to
.Ic neighbor-as ,
which is expanded to the current neighbor remote AS number, or
.Ic local-as ,
which is expanded to the locally assigned AS number.
.Pp
.It Xo
.Ic large-community
.Ar as-number : Ns Ar local : Ns Ar local
.Xc
This rule applies only to
.Em UPDATES
where the
.Ic Large community
path attribute is present and matches.
Communities are specified as
.Ar as-number : Ns Ar local : Ns Ar local ,
where
.Ar as-number
is an AS number and
.Ar local
is a locally significant number between zero and
.Li 4294967295 .
Both
.Ar as-number
and
.Ar local
may be set to
.Sq *
to do wildcard matching.
Both
.Ar as-number
and
.Ar local
may be set to
.Ic neighbor-as ,
which is expanded to the current neighbor remote AS number,
.Ic local-as ,
which is expanded to the locally assigned AS number.
.Pp
.It Xo
.Ic ext-community
.Ar subtype Ar as-number : Ns Ar local
.Xc
.It Xo
.Ic ext-community
.Ar subtype Ar IP : Ns Ar local
.Xc
.It Xo
.Ic ext-community
.Ar subtype Ar numvalue
.Xc
This rule applies only to
.Em UPDATES
where the
.Em extended community
path attribute is present and matches.
Extended Communities are specified by a
.Ar subtype
and normally two values, a globally unique part (e.g. the AS number) and a
local part.
See also the
.Sx ATTRIBUTE SET
section for further information about the encoding.
.Pp
.It Xo
.Pq Ic from Ns | Ns Ic to
.Ar peer
.Xc
This rule applies only to
.Em UPDATES
coming from, or going to, this particular neighbor.
This parameter must be specified.
.Ar peer
is one of the following:
.Pp
.Bl -tag -width "group descr" -compact
.It Ic any
Any neighbor will be matched.
.It Ar address
Neighbors with this address will be matched.
.It Ic group Ar descr
Neighbors in this group will be matched.
.It Ic AS Ar as-number
Neighbors with this AS will be matched.
.El
.Pp
Multiple
.Ar peer
entries may also be specified,
separated by commas or whitespace,
if enclosed in curly brackets:
.Bd -literal -offset indent
deny from { 128.251.16.1, 251.128.16.2, group hojo }
.Ed
.Pp
.It Pq Ic inet Ns | Ns Ic inet6
Match only routes in the IPv4 or IPv6 address families, respectively.
.Ic inet
is an alias for
.Qq prefix 0.0.0.0/0 prefixlen >= 0 ;
.Ic inet6
is an alias for
.Qq prefix ::/0 prefixlen >= 0 .
.Pp
.It Ic max-as-len Ar len
This rule applies only to
.Em UPDATES
where the
.Em AS path
has more than
.Ar len
elements.
.Pp
.It Ic max-as-seq Ar len
This rule applies only to
.Em UPDATES
where a single
.Em AS number
is repeated more than
.Ar len
times.
.Pp
.It Ic nexthop Ar address
This rule applies only to
.Em UPDATES
where the nexthop is equal to
.Ar address .
The
.Ar address
can be set to
.Em neighbor
in which case the nexthop is compared against the address of the neighbor.
Nexthop filtering is not supported on locally announced networks and one must
take into consideration previous rules overwriting nexthops.
.Pp
.It Ic prefix Ar address Ns Li / Ns Ar len
.It Ic prefix Ar address Ns Li / Ns Ar len Ic prefixlen Ar range
.It Ic prefix Ar address Ns Li / Ns Ar len Ic or-longer
This rule applies only to
.Em UPDATES
for the specified prefix.
.Pp
Multiple entries may be specified,
separated by commas or whitespace,
if enclosed in curly brackets:
.Bd -literal -offset indent
deny from any prefix { 192.168.0.0/16, 10.0.0.0/8 or-longer }
.Ed
.Pp
Multiple lists can also be specified, which is useful for
macro expansion:
.Bd -literal -offset indent
good="{ 192.168.0.0/16, 172.16.0.0/12, 10.0.0.0/8 }"
bad="{ 224.0.0.0/4 prefixlen >= 4, 240.0.0.0/4 prefixlen >= 4 }"
ugly="{ 127.0.0.1/8, 169.254.0.0/16 }"

deny from any prefix { $good $bad $ugly }
.Ed
.Pp
Prefix length ranges are specified by using these operators:
.Bd -literal -offset indent
=	(equal)
!=	(unequal)
<	(less than)
<=	(less than or equal)
>	(greater than)
>=	(greater than or equal)
-	(range including boundaries)
><	(except range)
.Ed
.Pp
>< and -
are binary operators (they take two arguments).
For instance, to match all prefix lengths >= 8 and <= 12, and hence the
CIDR netmasks 8, 9, 10, 11 and 12:
.Bd -literal -offset indent
prefixlen 8-12
.Ed
.Pp
Or, to match all prefix lengths < 8 or > 12, and hence the CIDR netmasks
0\(en7 and 13\(en32:
.Bd -literal -offset indent
prefixlen 8><12
.Ed
.Pp
This will match all prefixes in the 10.0.0.0/8 netblock with netmasks longer
than 16:
.Bd -literal -offset indent
prefix 10.0.0.0/8 prefixlen > 16
.Ed
.Pp
.Ic or-longer
is a shorthand for:
.Bd -literal -offset indent
.Ic prefix Ar address Ns Li / Ns Ar len Ic prexiflen Ic >= Ar len
.Ed
.Pp
.It Ic quick
If an
.Em UPDATE
matches a rule which has the
.Ic quick
option set, this rule is considered the last matching rule, and evaluation
of subsequent rules is skipped.
.Pp
.It Ic rib Ar name
Apply rule only to the specified RIB.
This only applies for received updates, so not for rules using the
.Ar to peer
parameter.
.Pp
.It Ic set Ar attribute ...
All matching rules can set the
.Em AS path attributes
to some default.
The set of every matching rule is applied, not only the last matching one.
See also the following section.
.El
.Sh ATTRIBUTE SET
.Em AS path attributes
can be modified with
.Ic set .
.Pp
.Ic set
can be used on
.Ic network
statements, in
.Ic neighbor
or
.Ic group
blocks, and on filter rules.
Attribute sets can be expressed as lists.
.Pp
The following attributes can be modified:
.Pp
.Bl -tag -width Ds -compact
.It Xo
.Ic community Op Ar delete
.Ar as-number : Ns Ar local
.Xc
.It Xo
.Ic community Op Ar delete
.Ar name
.Xc
Set or delete the
.Em COMMUNITIES
AS path attribute.
Communities are specified as
.Ar as-number : Ns Ar local ,
where
.Ar as-number
is an AS number and
.Ar local
is a locally-significant number between zero and
.Li 65535 .
Alternately, well-known communities may be specified by name:
.Ic NO_EXPORT ,
.Ic NO_ADVERTISE ,
.Ic NO_EXPORT_SUBCONFED ,
or
.Ic NO_PEER .
For
.Cm delete ,
both
.Ar as-number
and
.Ar local
may be set to
.Sq *
to do wildcard matching.
.Pp
.It Xo
.Ic large-community Op Ar delete
.Ar as-number : Ns Ar local : Ns Ar local
.Xc
.It Xo
.Ic large-community Op Ar delete
.Ar name
.Xc
Set or delete the
.Em Large Communities
path attribute.
Communities are specified as
.Ar as-number : Ns Ar local : Ns Ar local ,
where
.Ar as-number
is an AS number and
.Ar local
is a locally-significant number between zero and
.Li 4294967295 .
For
.Cm delete ,
both
.Ar as-number
and
.Ar local
may be set to
.Sq *
to do wildcard matching.
.Pp
.It Xo
.Ic ext-community Op Ar delete
.Ar subtype Ar as-number : Ns Ar local
.Xc
.It Xo
.Ic ext-community Op Ar delete
.Ar subtype Ar IP : Ns Ar local
.Xc
.It Xo
.Ic ext-community Op Ar delete
.Ar subtype Ar numvalue
.Xc
Set or delete the
.Em Extended Community
AS path attribute.
Extended Communities are specified by a
.Ar subtype
and normally two values, a globally unique part (e.g. the AS number) and a
local part.
The type is selected depending on the encoding of the global part.
Two-octet AS Specific Extended Communities and Four-octet AS Specific Extended
Communities are encoded as
.Ar as-number : Ns Ar local .
Four-octet encoding is used if the
.Ar as-number
is bigger than 65535 or if the AS_DOT encoding is used.
IPv4 Address Specific Extended Communities are encoded as
.Ar IP : Ns Ar local .
Opaque Extended Communities are encoded with a single numeric value.
Currently the following subtypes are supported:
.Bd -literal -offset indent
rt       Route Target
soo      Source of Origin
odi      OSPF Domain Identifier
ort      OSPF Route Type
ori      OSPF Router ID
bdc      BGP Data Collection
.Ed
.Pp
Not all type and subtype value pairs are allowed by IANA and the parser
will ensure that no invalid combination is created.
.Pp
.It Ic localpref Ar number
Set the
.Em LOCAL_PREF
AS path attribute.
If
.Ar number
starts with a plus or minus sign,
.Em LOCAL_PREF
will be adjusted by adding or subtracting
.Ar number ;
otherwise it will be set to
.Ar number .
The default is 100.
.Pp
.It Ic med Ar number
.It Ic metric Ar number
Set the
.Em MULTI_EXIT_DISC
AS path attribute.
If
.Ar number
starts with a plus or minus sign,
.Em MULTI_EXIT_DISC
will be adjusted by adding or subtracting
.Ar number ;
otherwise it will be set to
.Ar number .
.Pp
.It Xo
.Ic origin
.Sm off
.Pq Ic igp | egp | incomplete
.Sm on
.Xc
Set the
.Em ORIGIN
AS path attribute to mark the source of this
route as being injected from an igp protocol, an egp protocol
or being an aggregated route.
.Pp
.It Xo
.Ic nexthop
.Sm off
.Pq Ar address | Ic blackhole | reject | self | no-modify
.Sm on
.Xc
Set the
.Em NEXTHOP
AS path attribute
to a different nexthop address or use blackhole or reject routes.
If set to
.Em no-modify ,
the nexthop attribute is not modified.
Unless set to
.Em self ,
the nexthop is left unmodified for IBGP
sessions.
.Em self
forces the nexthop to be set to the local interface address.
.Bd -literal -offset indent
set nexthop 192.168.0.1
set nexthop blackhole
set nexthop reject
set nexthop no-modify
set nexthop self
.Ed
.Pp
.It Ic pftable Ar table
Add the prefix in the update to the specified
.Xr pf 4
table, regardless of whether or not the path was selected for routing.
This option may be useful in building realtime blacklists.
.Pp
.It Ic prepend-neighbor Ar number
Prepend the neighbor's AS
.Ar number
times to the
.Em AS path .
.Pp
.It Ic prepend-self Ar number
Prepend the local AS
.Ar number
times to the
.Em AS path .
.Pp
.It Ic rtlabel Ar label
Add the prefix to the kernel routing table with the specified
.Ar label .
.Pp
.It Ic weight Ar number
The
.Em weight
is used to tip prefixes with equally long AS paths in one or
the other direction.
A prefix is weighed at a very late stage in the decision process.
If
.Ar number
starts with a plus or minus sign, the
.Em weight
will be adjusted by adding or subtracting
.Ar number ;
otherwise it will be set to
.Ar number .
.Em Weight
is a local non-transitive attribute and a bgpd-specific extension.
For prefixes with equally long paths, the prefix with the larger weight
is selected.
.El
.Sh FILES
.Bl -tag -width "/etc/bgpd.conf" -compact
.It Pa /etc/bgpd.conf
.Xr bgpd 8
configuration file
.El
.Sh SEE ALSO
.Xr strftime 3 ,
.Xr ipsec 4 ,
.Xr pf 4 ,
.Xr tcp 4 ,
.Xr bgpctl 8 ,
.Xr bgpd 8 ,
.Xr ipsecctl 8 ,
.Xr isakmpd 8 ,
.Xr rc.conf.local 8
.Sh HISTORY
The
.Nm
file format first appeared in
.Ox 3.5 .
@


1.153
log
@allow us to use 'local-as' in the filter language

"match in from any set community local-as:neighbor-as"

OK claudio@@
@
text
@d1 1
a1 1
.\" $OpenBSD: bgpd.conf.5,v 1.152 2017/01/13 18:59:12 phessler Exp $
d19 1
a19 1
.Dd $Mdocdate: January 13 2017 $
d876 11
@


1.152
log
@Add support for draft-ietf-idr-shutdown

    BGP state = Idle, marked down with shutdown reason "goodbye, we are
    upgrading to openbsd 6.1", down for 00:00:17

developed by Peter van Dijk <peter.van.dijk@@powerdns.com> and Job
Snijders <job@@ntt.net>, thank you!

OK benno@@
@
text
@d1 1
a1 1
.\" $OpenBSD: bgpd.conf.5,v 1.151 2016/10/30 16:50:22 phessler Exp $
d19 1
a19 1
.Dd $Mdocdate: October 30 2016 $
d1082 3
a1084 1
which is expanded to the current neighbor remote AS number.
d1154 3
a1156 1
which is expanded to the current neighbor remote AS number.
d1188 3
a1190 1
which is expanded to the current neighbor remote AS number.
@


1.151
log
@large-community needs to have an argument
@
text
@d1 1
a1 1
.\" $OpenBSD: bgpd.conf.5,v 1.150 2016/10/18 19:47:52 benno Exp $
d19 1
a19 1
.Dd $Mdocdate: October 18 2016 $
d740 1
a740 1
.It Ic down
d743 9
@


1.150
log
@"Terminate the session after number prefixes have been received" means
that max-prefix 1 will close the session on the first prefix which is
off by one to what one would expect. Change it to No. received >
max-prefix, which is also in line with other implementations.
Found by jbg@@ and deraadt@@.
ok phessler@@ deraadt@@ henning@@ claudio@@
@
text
@d1 1
a1 1
.\" $OpenBSD: bgpd.conf.5,v 1.149 2016/10/15 12:35:19 jmc Exp $
d19 1
a19 1
.Dd $Mdocdate: October 15 2016 $
d1147 1
a1148 1
.Ar as-number : Ns Ar local : Ns Ar local
@


1.149
log
@add missing Xc, and macro fix;
@
text
@d1 1
a1 1
.\" $OpenBSD: bgpd.conf.5,v 1.148 2016/10/14 16:05:35 phessler Exp $
d19 1
a19 1
.Dd $Mdocdate: October 14 2016 $
d878 1
a878 1
Terminate the session after
d880 1
a880 1
prefixes have been received
@


1.148
log
@Add support for draft-ietf-idr-large-community

Joint work with Job Snijders, many thanks!
OK benno@@ deraadt@@
@
text
@d1 1
a1 1
.\" $OpenBSD: bgpd.conf.5,v 1.147 2016/10/05 07:38:06 phessler Exp $
d19 1
a19 1
.Dd $Mdocdate: October 5 2016 $
d1147 1
d1161 1
a1161 1
.Li 4294967295.
@


1.147
log
@Let bgpd announce routes based on a route-label.

OK henning@@ benno@@
@
text
@d1 1
a1 1
.\" $OpenBSD: bgpd.conf.5,v 1.146 2016/08/17 08:14:40 phessler Exp $
d19 1
a19 1
.Dd $Mdocdate: August 17 2016 $
d1146 31
d1398 29
@


1.146
log
@pluralize a word
@
text
@d1 1
a1 1
.\" $OpenBSD: bgpd.conf.5,v 1.145 2016/08/17 08:13:52 phessler Exp $
d271 5
d283 5
@


1.145
log
@The man page is a bit confusing for how we can control which address
families we support during capabilities negotiation.  Re-organize the
man page to be more clear, and explicitly state what the default is.

OK sthen@@ benno@@
@
text
@d1 1
a1 1
.\" $OpenBSD: bgpd.conf.5,v 1.144 2016/06/28 16:59:14 jca Exp $
d19 1
a19 1
.Dd $Mdocdate: June 28 2016 $
d621 1
a621 1
Only routes for that address family and subsequent address family will be
@


1.144
log
@Use IPV6_MINHOPCOUNT to finish implementing ttl-security for IPv6.

ok renato@@ deraadt@@
@
text
@d1 1
a1 1
.\" $OpenBSD: bgpd.conf.5,v 1.143 2016/06/11 11:43:02 tobias Exp $
d19 1
a19 1
.Dd $Mdocdate: June 11 2016 $
d620 5
a624 1
(at the moment, only
d630 5
a634 4
which allows the distribution of BGP MPLS VPNs, are supported) are announced
during the capabilities negotiation.
Only routes for that address family and subsequent address family will be
announced and processed.
@


1.143
log
@Fixed "then" vs "than" typo.

ok jmc
@
text
@d1 1
a1 1
.\" $OpenBSD: bgpd.conf.5,v 1.142 2016/06/03 20:58:13 jmc Exp $
d19 1
a19 1
.Dd $Mdocdate: June 3 2016 $
a974 4
.Pp
There is currently only partial support for ttl-security with IPv6:
the TTL of outgoing packets is set,
but no check is made for the TTL of incoming packets.
@


1.142
log
@grammar fix;
@
text
@d1 1
a1 1
.\" $OpenBSD: bgpd.conf.5,v 1.141 2016/06/03 17:36:37 benno Exp $
d1391 1
a1391 1
is bigger then 65535 or if the AS_DOT encoding is used.
@


1.141
log
@Add operators =, !=, - (range), >< (exclsive range) to the as-path
filters (AS, peer-as, source-as, transit-as).

Add a use case (block illegal AS numbers) to the bgpd.conf example.

feedback from claudio, sthen, florian,
ok florian@@ phessler@@
@
text
@d1 1
a1 1
.\" $OpenBSD: bgpd.conf.5,v 1.140 2016/01/07 18:41:41 florian Exp $
d19 1
a19 1
.Dd $Mdocdate: January 7 2016 $
d1075 1
a1075 1
are binary operators (they take two arguments), with these,
@


1.140
log
@If transparent-as is set to no AS paths are prepended with the local
AS not "their" AS. Which would be silly, the peer would just reject
the prefix because the AS path contains its own AS.
Pointed out by Colin Petrie cpetrie AT ripe DOT net, thanks!
OK phessler, sthen, benno, jmc
@
text
@d1 1
a1 1
.\" $OpenBSD: bgpd.conf.5,v 1.139 2015/10/11 19:30:12 phessler Exp $
d19 1
a19 1
.Dd $Mdocdate: October 11 2015 $
d1030 4
a1033 1
.It Ar as-type as-number
d1044 1
a1044 7
.Ar as-type .
.Ar as-number
may be set to
.Ic neighbor-as ,
which is expanded to the current neighbor remote AS number.
.Ar as-type
is one of the following operators:
d1056 23
@


1.139
log
@standardize a community that has been independently created by nearly
every single AS on the planet: the blackhole

OK benno@@, claudio@@, sthen@@
@
text
@d1 1
a1 1
.\" $OpenBSD: bgpd.conf.5,v 1.138 2015/09/21 10:06:47 jmc Exp $
d19 1
a19 1
.Dd $Mdocdate: September 21 2015 $
d415 1
a415 1
to EBGP neighbors are not prepended with their own AS.
d954 1
a954 1
to EBGP neighbors are not prepended with their own AS.
@


1.138
log
@sort;
@
text
@d1 1
a1 1
.\" $OpenBSD: bgpd.conf.5,v 1.137 2015/09/21 09:47:15 phessler Exp $
d1100 1
@


1.137
log
@Let us log all updates sent from an individual peer.  Since this can be
applied to a group, also let us disable logging on a sub-member of the
group.  Very handy for debugging naughty peers on a router with multiple
peers.

OK benno@@
@
text
@d1 1
a1 1
.\" $OpenBSD: bgpd.conf.5,v 1.136 2015/07/19 14:35:41 jmc Exp $
d19 1
a19 1
.Dd $Mdocdate: July 19 2015 $
d853 3
a857 3
.Pp
.It Ic log no
Disable neighbor specific logging.
@


1.136
log
@knock out "Ns Li" before colons - the Li was being ignored anyway, and i
don;t think the colon needs marked up.
@
text
@d1 1
a1 1
.\" $OpenBSD: bgpd.conf.5,v 1.135 2015/07/19 04:54:53 benno Exp $
d852 6
@


1.135
log
@clarify how inet|inet6 work in filters
mofified version by jmc@@, ok phessler@@ and claudio@@ is fine with it
(but notes that the details are more complicated)
@
text
@d1 1
a1 1
.\" $OpenBSD: bgpd.conf.5,v 1.134 2015/04/25 15:28:18 phessler Exp $
d19 1
a19 1
.Dd $Mdocdate: April 25 2015 $
d452 2
a453 2
.It Ic export-target Ar subtype Ar as-number Ns Li : Ns Ar local
.It Ic export-target Ar subtype Ar IP Ns Li : Ns Ar local
d478 2
a479 2
.It Ic import-target Ar subtype Ar as-number Ns Li : Ns Ar local
.It Ic import-target Ar subtype Ar IP Ns Li : Ns Ar local
d503 2
a504 2
.It Ic rd Ar as-number Ns Li : Ns Ar local
.It Ic rd Ar IP Ns Li : Ns Ar local
d1078 1
a1078 1
.Ar as-number Ns Li : Ns Ar local ,
d1109 1
a1109 1
.Ar subtype Ar as-number Ns Li : Ns Ar local
d1113 1
a1113 1
.Ar subtype Ar IP Ns Li : Ns Ar local
d1306 1
a1306 1
.Ar as-number Ns Li : Ns Ar local
d1316 1
a1316 1
.Ar as-number Ns Li : Ns Ar local ,
d1341 1
a1341 1
.Ar subtype Ar as-number Ns Li : Ns Ar local
d1345 1
a1345 1
.Ar subtype Ar IP Ns Li : Ns Ar local
d1361 1
a1361 1
.Ar as-number Ns Li : Ns Ar local .
d1366 1
a1366 1
.Ar IP Ns Li : Ns Ar local .
@


1.134
log
@allow us to write rules that match directly on the peer AS

...
allow from AS 1 prefix 192.0.2.0/24
...

Also adjust the IRR ruleset output to include the declared peer AS,
instead of hoping they listed their neighbor IP address!


OK benno@@
older version OK: claudio@@ henning@@
@
text
@d1 1
a1 1
.\" $OpenBSD: bgpd.conf.5,v 1.133 2015/02/28 21:51:57 bentley Exp $
d19 1
a19 1
.Dd $Mdocdate: February 28 2015 $
d1164 7
a1170 1
This rule applies only to routes matching the stated address family.
@


1.133
log
@Reduce usage of predefined strings in manpages.

Predefined strings are not very portable across troff implementations,
and they make the source much harder to read. Usually the intended
character can be written directly.

No output changes, except for two instances where the incorrect escape
was used in the first place.

tweaks + ok schwarze@@
@
text
@d1 1
a1 1
.\" $OpenBSD: bgpd.conf.5,v 1.132 2014/11/10 20:48:33 miod Exp $
d19 1
a19 1
.Dd $Mdocdate: November 10 2014 $
d1150 2
@


1.132
log
@Fix horrible spelling mistake introduced in r1.17
@
text
@d1 1
a1 1
.\" $OpenBSD: bgpd.conf.5,v 1.131 2014/05/20 23:41:36 dlg Exp $
d19 1
a19 1
.Dd $Mdocdate: May 20 2014 $
d582 1
a582 2
.Po Ic all \*(Ba none \*(Ba
.Ic self \*(Ba default-route Pc
d1404 1
a1404 3
.Po Ic igp \*(Ba
.Ic egp \*(Ba
.Ic incomplete Pc
d1416 1
a1416 5
.Po Ar address \*(Ba
.Ic blackhole \*(Ba
.Ic reject \*(Ba
.Ic self \*(Ba
.Ic no-modify Pc
@


1.131
log
@destinct is spelled distinct.

ok henning@@ jmc@@
@
text
@d1 1
a1 1
.\" $OpenBSD: bgpd.conf.5,v 1.130 2013/11/13 09:14:48 florian Exp $
d19 1
a19 1
.Dd $Mdocdate: November 13 2013 $
d938 1
a938 1
tcp md5sig password mekmidasdigoat
@


1.130
log
@Knob to set priority with which bgpd inserts routes into the kernel
routing table. Need for it in "special" setups pointed out by
Loic Blot (loic.blot _AT_ unix-experience _DOT_ fr) on tech.
OK benno, henning
@
text
@d1 1
a1 1
.\" $OpenBSD: bgpd.conf.5,v 1.129 2013/10/19 15:04:25 claudio Exp $
d19 1
a19 1
.Dd $Mdocdate: October 19 2013 $
d507 1
a507 1
is to ensure that possible common prefixes are destinct between VPNs.
@


1.129
log
@Merge the prefix and prefixlen filter bits into one filter. Change the
filter expansion so that rules are grouped by prefixes last. The RDE will
then be able to optimize the rules into table lookups but that is a later
step. As additional goodies it is now possible to use inet and inet6
on their own and or-longer can be used as a shorthand for prefixlen >= len.
OK henning@@ sthen@@ florian@@
@
text
@d1 1
a1 1
.\" $OpenBSD: bgpd.conf.5,v 1.128 2013/10/17 09:14:02 blambert Exp $
d19 1
a19 1
.Dd $Mdocdate: October 17 2013 $
d208 5
@


1.128
log
@Less ambiguous wording concerning control socket configuration options.

requested by and ok deraadt@@
@
text
@d1 1
a1 1
.\" $OpenBSD: bgpd.conf.5,v 1.127 2013/10/16 21:17:27 jmc Exp $
d19 1
a19 1
.Dd $Mdocdate: October 16 2013 $
a1158 5
The address family needs to be set only in rules that use
.Ic prefixlen
without specifying a
.Ic prefix
beforehand.
d1191 3
a1193 4
.It Xo
.Ic prefix
.Ar address Ns Li / Ns Ar len
.Xc
d1198 1
a1198 3
Multiple
.Ar address Ns Li / Ns Ar len
entries may be specified,
d1202 1
a1202 1
deny from any prefix { 192.168.0.0/16, 10.0.0.0/8 }
d1209 1
a1209 1
bad="{ 224.0.0.0/4, 240.0.0.0/4 }"
a1214 4
.It Ic prefixlen Ar range
This rule applies only to
.Em UPDATES
for prefixes where the prefixlen matches.
a1240 4
.Ic prefixlen
can be used together with
.Ic prefix .
.Pp
d1245 6
@


1.127
log
@some .Pa;
@
text
@d1 1
a1 1
.\" $OpenBSD: bgpd.conf.5,v 1.126 2013/09/10 07:29:12 weerd Exp $
d19 1
a19 1
.Dd $Mdocdate: September 10 2013 $
d394 1
a394 1
Set the control socket location to
@


1.126
log
@Document that wildcards can also be used when deleting communities.
After a discussion with sthen@@ and claudio@@; wording help from sthen@@.

OK claudio@@, sthen@@, jmc@@
@
text
@d1 1
a1 1
.\" $OpenBSD: bgpd.conf.5,v 1.125 2013/05/30 10:13:58 sthen Exp $
d19 1
a19 1
.Dd $Mdocdate: May 30 2013 $
d399 3
a401 1
By default /var/run/bgpd.sock is used and no restricted socket is created.
@


1.125
log
@Add partial support to bgpd for the ttl hack with ipv6. This sends the correct
ttl on outgoing packets so peer sessions can come up correctly if both sides
use ttl-security, but the kernel side is not yet implemented so incoming
packets aren't verified (note added to manual for this). ok henning@@
@
text
@d1 1
a1 1
.\" $OpenBSD: bgpd.conf.5,v 1.124 2013/01/02 15:06:46 florian Exp $
d19 1
a19 1
.Dd $Mdocdate: January 2 2013 $
d1325 9
@


1.124
log
@man page bits for "announce restart yes" default
ok sthen@@
@
text
@d1 1
a1 1
.\" $OpenBSD: bgpd.conf.5,v 1.123 2012/11/13 14:26:26 jmc Exp $
d19 1
a19 1
.Dd $Mdocdate: November 13 2012 $
d963 4
@


1.123
log
@macro tweaking;
@
text
@d1 1
a1 1
.\" $OpenBSD: bgpd.conf.5,v 1.122 2012/11/13 09:47:20 claudio Exp $
d662 2
a663 2
.Ic yes ,
the graceful restart capability is announced.
d668 1
a668 1
.Ic no .
@


1.122
log
@Allow filtering based on the NEXTHOP attribute. This allows to build rules
like: allow from any nexthop neighbor (to allow only prefixes that use the
routers IP address as nexthop). Lots of testing, input and OK florian@@
@
text
@d1 1
a1 1
.\" $OpenBSD: bgpd.conf.5,v 1.121 2012/08/24 17:04:06 jmc Exp $
d19 1
a19 1
.Dd $Mdocdate: August 24 2012 $
a514 1
.Pp
d1181 1
a1181 1
.Ar address.
@


1.121
log
@rfc 4456 replaces rfc 2796; ok claudio
@
text
@d1 1
a1 1
.\" $OpenBSD: bgpd.conf.5,v 1.120 2012/07/07 08:22:57 claudio Exp $
d19 1
a19 1
.Dd $Mdocdate: July 7 2012 $
d1177 13
@


1.120
log
@Explain the bgpd decision process in the man page. I'm tired of looking
at the C code over and over again. With and OK sthen@@, henning@@, jmc@@
@
text
@d1 1
a1 1
.\" $OpenBSD: bgpd.conf.5,v 1.119 2012/06/19 08:22:27 sthen Exp $
d19 1
a19 1
.Dd $Mdocdate: June 19 2012 $
d880 1
a880 1
Act as an RFC 2796
@


1.119
log
@There are five main sections, not four, since routing domain support was added.
From Rod Whitworth.
@
text
@d1 1
a1 1
.\" $OpenBSD: bgpd.conf.5,v 1.118 2012/04/24 14:56:09 jmc Exp $
d19 1
a19 1
.Dd $Mdocdate: April 24 2012 $
d316 1
a316 1
.Em MED
d320 1
a320 3
where the
.Em MED
is only compared between peers belonging to the same AS.
@


1.118
log
@take a stab at documenting when arguments need quoted, and valid macro
characters;

prompted by a diff from robert peichaer org

thanks gilles and henning for feedback
ok deraadt zinke
@
text
@d1 1
a1 1
.\" $OpenBSD: bgpd.conf.5,v 1.117 2012/04/07 17:25:51 claudio Exp $
d19 1
a19 1
.Dd $Mdocdate: April 7 2012 $
d33 1
a33 1
config file is divided into four main sections.
@


1.117
log
@The Route Distinguishers should not be used to control distribution.
Found by and fix tested by Rimi Philippe
@
text
@d1 1
a1 1
.\" $OpenBSD: bgpd.conf.5,v 1.116 2011/09/17 16:29:44 claudio Exp $
d19 1
a19 1
.Dd $Mdocdate: September 17 2011 $
d67 3
d78 2
a79 2
Macro names must start with a letter, and may contain letters, digits
and underscores.
@


1.116
log
@Implement new mrt table dump format as specified in draft-ietf-grow-mrt.
Tested with IP and IPv6 sessions and against the libbgpdump parser.
OK henning@@
@
text
@d1 1
a1 1
.\" $OpenBSD: bgpd.conf.5,v 1.115 2011/06/23 20:35:22 sthen Exp $
d19 1
a19 1
.Dd $Mdocdate: June 23 2011 $
d497 1
a497 2
The Route Distinguishers uniquely identifies a set of VPN prefixes.
Only prefixes matching the
d499 2
a500 2
will be imported into the routing domain.
The purpose of the
d502 2
a503 1
is solely to allow one to create distinct routes to a common address prefix.
@


1.115
log
@Use a common text explaining how the various configuration parsers using
the standard OpenBSD-style parse.y handle continuing lines with backslashes,
paying particular attention to how comments are handled (which can cause
nasty side-effects if you're not expecting it).

Most wording from jmc@@, with suggestions from fgsch@@, marc@@, Richard Toohey,
patrick keshishian and Florian Obser, ok jmc@@.
@
text
@d1 1
a1 1
.\" $OpenBSD: bgpd.conf.5,v 1.114 2011/04/30 07:52:33 sthen Exp $
d19 1
a19 1
.Dd $Mdocdate: April 30 2011 $
d152 1
a152 1
.Pq Ic table Ns | Ns Ic table-mp
a163 2
Dumping the RIB is normally an expensive operation,
but it should not influence the session handling.
d170 6
a175 1
The
d177 2
a178 1
format is multi-protocol capable but often not supported by 3rd-party tools.
@


1.114
log
@no need to escape |, pointed out by jmc@@
"it's worth killing, if just to stop it being copied all over the place"
@
text
@d1 1
a1 1
.\" $OpenBSD: bgpd.conf.5,v 1.113 2010/10/23 16:44:56 sthen Exp $
d19 1
a19 1
.Dd $Mdocdate: October 23 2010 $
d59 2
d64 2
@


1.113
log
@Reorder the wording where we talk about tagging kernel route table prefixes,
following misc@@ discussion with Tony Sarendal. ok phessler@@
@
text
@d1 1
a1 1
.\" $OpenBSD: bgpd.conf.5,v 1.112 2010/10/13 21:04:13 sthen Exp $
d19 1
a19 1
.Dd $Mdocdate: October 13 2010 $
d148 1
a148 1
.Pq Ic table Ns \&| Ns Ic table-mp
d153 2
a154 2
.Pq Ic all Ns \&| Ns Ic updates
.Pq Ic in Ns \&| Ns Ic out
d200 1
a200 1
.Pq Ic yes Ns \&| Ns Ic no
d247 1
a247 1
.Pq Ic inet Ns \&| Ns Ic inet6
d252 1
a252 1
.Pq Ic inet Ns \&| Ns Ic inet6
d283 1
a283 1
.Pq Ic bgp Ns \&| Ns Ic default
d300 1
a300 1
.Pq Ic always Ns \&| Ns Ic strict
d342 1
a342 1
.Pq Ic ignore Ns \&| Ns Ic evaluate
d355 1
a355 1
.Pq Ic yes Ns \&| Ns Ic no
d394 1
a394 1
.Pq Ic yes Ns \&| Ns Ic no
d453 1
a453 1
.Pq Ic yes Ns \&| Ns Ic no
d602 2
a603 2
.Pq Ic IPv4 Ns \&| Ns Ic IPv6
.Pq Ic none Ns \&| Ns Ic unicast Ns \&| Ns Ic vpn
d619 1
a619 1
.Pq Ic yes Ns \&| Ns Ic no
d630 1
a630 1
.Pq Ic yes Ns \&| Ns Ic no
d641 1
a641 1
.Pq Ic yes Ns \&| Ns Ic no
d651 1
a651 1
.Pq Ic yes Ns \&| Ns Ic no
d717 2
a718 2
.Pq Ic all Ns \&| Ns Ic updates
.Pq Ic in Ns \&| Ns Ic out
d733 1
a733 1
.Pq Ic yes Ns \&| Ns Ic no
d760 2
a761 2
.Pq Ic ah Ns \&| Ns Ic esp
.Pq Ic in Ns \&| Ns Ic out
d796 1
a796 1
.Pq Ic ah Ns \&| Ns Ic esp
d901 2
a902 2
.Pq Ic in Ns \&| Ns Ic out
.Pq Ic yes Ns \&| Ns Ic no
d929 1
a929 1
.Pq Ic yes Ns \&| Ns Ic no
d941 1
a941 1
.Pq Ic yes Ns \&| Ns Ic no
d1115 1
a1115 1
.Pq Ic from Ns \&| Ns Ic to
d1143 1
a1143 1
.It Pq Ic inet Ns \&| Ns Ic inet6
@


1.112
log
@'socket "path" [restricted]' needs quotes around path; make it clear
in the manual.  Help from jmc@@.
@
text
@d1 1
a1 1
.\" $OpenBSD: bgpd.conf.5,v 1.111 2010/06/27 21:01:49 jmc Exp $
d19 1
a19 1
.Dd $Mdocdate: June 27 2010 $
d1435 2
a1436 3
Add the prefix with the specified
.Ar label
to the kernel routing table.
@


1.111
log
@right way round for macros;
@
text
@d1 1
a1 1
.\" $OpenBSD: bgpd.conf.5,v 1.110 2010/06/27 19:53:34 claudio Exp $
d384 1
a384 1
.It Ic socket Ar path Op Ic restricted
@


1.110
log
@Instead of specifying the control sockets on the command line have them
in bgpd.conf. This allows to add/modify restricted control sockets on runtime.
Feature request by a few people how often forgot to add -r path when restarting
bgpd (including myself).
NOTE: this removes the -s and -r arguments from bgpd so pay attention when
updateing.
jajaja sthen@@, OK henning@@
@
text
@d1 1
a1 1
.\" $OpenBSD: bgpd.conf.5,v 1.109 2010/05/17 17:46:22 jmc Exp $
d19 1
a19 1
.Dd $Mdocdate: May 17 2010 $
d384 1
a384 1
.It Ic socket Ar path Ic Op restricted
@


1.109
log
@tweak previous;
@
text
@d1 1
a1 1
.\" $OpenBSD: bgpd.conf.5,v 1.108 2010/05/17 16:08:20 claudio Exp $
d383 8
@


1.108
log
@Implement two new filters, max-as-len and max-as-seq. The first is limiting
the length of an AS path (matches if the path is longer then the specified
lenght) the second matches when a sequence of the same AS number is longer
then the specified length).
max-as-len is good to protect crappy comercial bgp boxes from other crappy
comercial bgp boxes. max-as-seq was a feature request from SwissIX and maybe
EuroIX to find and filter prepends.
Additinal testing and OK sthen@@
@
text
@d1 1
a1 1
.\" $OpenBSD: bgpd.conf.5,v 1.107 2010/05/17 15:49:29 claudio Exp $
d399 1
a399 1
Each routing domain is specified by a
d417 2
a418 2
Routes added to the rdomain will use this this interface as outgoing interface.
Normaly this will be a MPLS Provider Edge,
d1148 1
a1148 1
has more then
d1157 1
a1157 1
is repeated more then
@


1.107
log
@Last bits of MPLS VPN support. Hook kernel routing tables and RIB together.
This adds a bit of new config to specify the mapping between an rdomain and
the BGP MPLS VPN instance, example:
rdomain 1 {
        descr "CUSTOMER1"
	rd 65003:1
	import-target rt 65003:3
	export-target rt 65003:1
	depend on mpe0
	network 192.168.224/24
}
The "depend on mpe0" is a but ugly but for now this is the quickest way to
figure out which interface bgp should use to insert the MPLS routes.

A big side-effect of this diff is that networks are now internally
distributed through kroute.c.
This needs some kernel changes that will follow hopefully soon.
OK henning@@
@
text
@d1 1
a1 1
.\" $OpenBSD: bgpd.conf.5,v 1.106 2010/05/04 07:37:56 claudio Exp $
d19 1
a19 1
.Dd $Mdocdate: May 4 2010 $
d1142 18
@


1.106
log
@Add some documentation about the last change (nexthop verification and
extended rde rib syntax).
OK sthen
@
text
@d1 1
a1 1
.\" $OpenBSD: bgpd.conf.5,v 1.105 2010/04/28 13:07:48 claudio Exp $
d19 1
a19 1
.Dd $Mdocdate: April 28 2010 $
d29 1
a29 1
in RFC 1771.
d41 2
d395 105
d595 1
a595 1
.Pq Ic none Ns \&| Ns Ic unicast
d600 6
a605 3
which disables the announcement of that address family, and
.Em unicast
are supported) are announced during the capabilities negotiation.
@


1.105
log
@Allow neighbor-as in AS filter statements like:
match from any source-as neighbor-as set localpref 1000
OK henning@@
@
text
@d1 1
a1 1
.\" $OpenBSD: bgpd.conf.5,v 1.104 2010/03/05 15:25:00 claudio Exp $
d19 1
a19 1
.Dd $Mdocdate: March 5 2010 $
d316 5
d326 6
d375 6
a380 3
Note that this table is used for nexthop verification as well.
Directly connected networks are always taken into account, even though
their routes live in table 0.
@


1.104
log
@Allow to filter for ext-community attributes. Currently only perfect matches
work but that's already better then nothing. OK sthen@@
@
text
@d1 1
a1 1
.\" $OpenBSD: bgpd.conf.5,v 1.103 2009/12/16 15:40:55 claudio Exp $
d19 1
a19 1
.Dd $Mdocdate: December 16 2009 $
d886 4
@


1.103
log
@Implement "set ext-community [delete] subtype key:value" to set and delete
extended communities as specified in RFC 4360. No matching implemented yet
and stuff like * and neighbor-as are neither supported but will be soon.
Looks good henning & sthen, manpage fixed by jmc
@
text
@d1 1
a1 1
.\" $OpenBSD: bgpd.conf.5,v 1.102 2009/11/26 13:40:43 henning Exp $
d19 1
a19 1
.Dd $Mdocdate: November 26 2009 $
d952 25
@


1.102
log
@support for set origin; based on an initial diff from
Sebastian Benoit <benoit-lists at fb12 dot de> who also tested this version
claudio ok
@
text
@d1 1
a1 1
.\" $OpenBSD: bgpd.conf.5,v 1.101 2009/10/28 21:38:03 jmc Exp $
d19 1
a19 1
.Dd $Mdocdate: October 28 2009 $
d541 1
a541 1
.Em ESTABLISHED.
d1121 42
@


1.101
log
@tweak previous;
@
text
@d1 1
a1 1
.\" $OpenBSD: bgpd.conf.5,v 1.100 2009/10/28 09:16:49 claudio Exp $
d1149 14
@


1.100
log
@Document the "rib" filter parameter to specify the rib a rule applies to.
@
text
@d1 1
a1 1
.\" $OpenBSD: bgpd.conf.5,v 1.99 2009/10/22 21:12:47 sobrado Exp $
d19 1
a19 1
.Dd $Mdocdate: October 22 2009 $
d1067 2
a1068 2
This only applies for recieved updates, so not for rules using the
.Ar to Ar peer
@


1.99
log
@fix two typos in documentation.

ok claudio@@
@
text
@d1 1
a1 1
.\" $OpenBSD: bgpd.conf.5,v 1.98 2009/10/13 09:51:53 claudio Exp $
d19 1
a19 1
.Dd $Mdocdate: October 13 2009 $
d1064 6
@


1.98
log
@Disable graceful restart for now. The EOR marker is sent in the wrong place
and fixing this is not a two liner. Will be enabled again when I found out
how to fix this.
@
text
@d1 1
a1 1
.\" $OpenBSD: bgpd.conf.5,v 1.97 2009/10/06 09:44:13 claudio Exp $
d19 1
a19 1
.Dd $Mdocdate: October 6 2009 $
d96 1
a96 1
If the first AS number is a 4-byte AS it is possible to specifiy a secondary
d324 1
a324 1
are created automaticaly and used as default.
@


1.97
log
@Add config knobs to enable/disable individual BGP capabilities per neighbor.
e.g. announce refresh no. With this be more aggressive when announcing our
capabilities and enable all of them by default. If there are troubles with
some neighbors adding the following config lines should bring you back
to the old behaviour:
announce refresh yes # was already on by default
announce restart no
announce as-4byte no # was only set on sessions to peers with 4byte AS nums
OK henning and sthen
@
text
@d1 1
a1 1
.\" $OpenBSD: bgpd.conf.5,v 1.96 2009/09/28 08:25:25 sthen Exp $
d19 1
a19 1
.Dd $Mdocdate: September 28 2009 $
d522 2
a523 2
.Ic no ,
the graceful restart capability is not announced.
d528 1
a528 1
.Ic yes .
@


1.96
log
@Fix typo (creat/create)
@
text
@d1 1
a1 1
.\" $OpenBSD: bgpd.conf.5,v 1.95 2009/08/31 09:08:04 claudio Exp $
d19 1
a19 1
.Dd $Mdocdate: August 31 2009 $
d486 11
d504 23
@


1.95
log
@Fix mandoc magic to make the command render correctly.
@
text
@d1 1
a1 1
.\" $OpenBSD: bgpd.conf.5,v 1.94 2009/06/07 00:31:22 claudio Exp $
d19 1
a19 1
.Dd $Mdocdate: June 7 2009 $
d316 1
a316 1
Creat an additional RIB named
@


1.94
log
@Initial documentation for the new stuff
@
text
@d1 1
a1 1
.\" $OpenBSD: bgpd.conf.5,v 1.93 2009/06/04 01:20:44 sthen Exp $
d19 1
a19 1
.Dd $Mdocdate: June 4 2009 $
d701 1
a701 1
.It rib .Ar name
@


1.93
log
@Document that we accept ASPLAIN format 32-bit ASN.
@
text
@d1 1
a1 1
.\" $OpenBSD: bgpd.conf.5,v 1.92 2009/05/27 04:18:21 reyk Exp $
d19 1
a19 1
.Dd $Mdocdate: May 27 2009 $
d145 1
d160 2
a161 1
Excessive dumping may result in delayed update processing.
d313 15
d700 3
@


1.92
log
@add an option to change the "connect-retry" timer which defaults to 120s.
this can be used to decrease the failover time in specific carp'ed
IBGP setups.

ok henning@@
@
text
@d1 1
a1 1
.\" $OpenBSD: bgpd.conf.5,v 1.91 2009/03/22 22:34:59 henning Exp $
d19 1
a19 1
.Dd $Mdocdate: March 22 2009 $
d126 3
a128 2
4-byte AS numbers are specified as two numbers separated by a dot.
For example:
d131 5
@


1.91
log
@make transparent-as yes|no settable peer neighbor with the global setting
acting as default.
per-neighbor requested by arnold nipper @@ decix, ok claudio
@
text
@d1 1
a1 1
.\" $OpenBSD: bgpd.conf.5,v 1.90 2008/12/19 18:58:12 henning Exp $
d19 1
a19 1
.Dd $Mdocdate: December 19 2008 $
d131 5
@


1.90
log
@document the default localpref, from discussion with
Mick Hohmann <mick at IM dot net>
@
text
@d1 1
a1 1
.\" $OpenBSD: bgpd.conf.5,v 1.89 2008/10/02 12:39:25 jmc Exp $
d19 1
a19 1
.Dd $Mdocdate: October 2 2008 $
d729 12
@


1.89
log
@correct path for isakmpd/local.pub; from Matthew Dempsky
@
text
@d1 1
a1 1
.\" $OpenBSD: bgpd.conf.5,v 1.88 2008/03/22 08:38:38 claudio Exp $
d19 1
a19 1
.Dd $Mdocdate: March 22 2008 $
d1051 1
@


1.88
log
@Mention that softreconfig is on by default. From Matthew Dempsky
@
text
@d1 1
a1 1
.\" $OpenBSD: bgpd.conf.5,v 1.87 2007/10/21 21:34:14 mk Exp $
d19 1
a19 1
.Dd $Mdocdate: October 21 2007 $
d614 1
a614 1
.Pa /etc/isakmpd/private/local.pub ,
@


1.87
log
@Being able to set the decision weight of prefixes is a nice feature, but
when it's not really documented in what way it influences the decision
process, people like myself will screw it up and assume that it gets
added to the prefix path lenth, and thus that smaller weight wins.

.. which is not the case.  Document the actual behaviour.

ok claudio, the general change agreed by henning.
proofraed by jmc.
@
text
@d1 1
a1 1
.\" $OpenBSD: bgpd.conf.5,v 1.86 2007/05/31 19:20:22 jmc Exp $
d19 1
a19 1
.Dd $Mdocdate: May 31 2007 $
d718 2
@


1.86
log
@convert to new .Dd format;
@
text
@d1 1
a1 1
.\" $OpenBSD: bgpd.conf.5,v 1.85 2007/04/24 13:45:24 claudio Exp $
d19 1
a19 1
.Dd $Mdocdate$
d1134 2
@


1.85
log
@Try to document the new 4-byte AS numbers without being to invasive.
"people will complain if it's unclear" jmc@@
@
text
@d1 1
a1 1
.\" $OpenBSD: bgpd.conf.5,v 1.84 2007/03/29 13:10:32 claudio Exp $
d19 1
a19 1
.Dd March 10, 2004
@


1.84
log
@Document the new inet and inet6 filter parameters. OK henning@@
@
text
@d1 1
a1 1
.\" $OpenBSD: bgpd.conf.5,v 1.83 2007/03/06 16:52:48 henning Exp $
d91 1
a91 1
.It Ic AS Ar as-number
d96 5
d126 5
@


1.83
log
@allow filtering on peer-as (leftmost AS in path), ok claudio
@
text
@d1 1
a1 1
.\" $OpenBSD: bgpd.conf.5,v 1.82 2007/03/04 17:41:40 henning Exp $
d892 8
@


1.82
log
@document include, and comments
stolen from hostapd.conf.5
@
text
@d1 1
a1 1
.\" $OpenBSD: bgpd.conf.5,v 1.81 2007/01/27 08:08:54 jmc Exp $
d803 2
@


1.81
log
@use \(en for ranges e.g. 10 \(en 12
@
text
@d1 1
a1 1
.\" $OpenBSD: bgpd.conf.5,v 1.80 2007/01/26 23:17:18 claudio Exp $
d56 11
@


1.80
log
@Finally document announce capabilities (yes|no).
With help from jmc@@
@
text
@d1 1
a1 1
.\" $OpenBSD: bgpd.conf.5,v 1.79 2007/01/26 21:39:10 claudio Exp $
d107 1
a107 1
The AS numbers 64512 - 65534 are designated for private use.
d932 1
a932 1
0\-7 and 13\-32:
@


1.79
log
@Document which AS are designated for private use and which are reserved
for special stuff (4-byte AS support).
@
text
@d1 1
a1 1
.\" $OpenBSD: bgpd.conf.5,v 1.78 2006/12/05 12:08:13 henning Exp $
d435 11
@


1.78
log
@implement the ttl security hack. since the pc slaves fear the word hack,
they call it "Generalized TTL Security Mechanism" officially, RFC 3682.
manpage with help from jmc
@
text
@d1 1
a1 1
.\" $OpenBSD: bgpd.conf.5,v 1.77 2006/11/28 16:39:34 henning Exp $
d106 4
@


1.77
log
@allow bgpd to work on alternate routing tables, claudio ok, jmc manpage help
@
text
@d1 1
a1 1
.\" $OpenBSD: bgpd.conf.5,v 1.76 2006/09/12 13:39:37 jmc Exp $
d691 17
@


1.76
log
@for apps which use interface groups, point to the section of
ifconfig(8) where they are explained;

ok mcbride mpf henning
@
text
@d1 1
a1 1
.\" $OpenBSD: bgpd.conf.5,v 1.75 2006/08/31 18:44:48 jmc Exp $
d306 8
@


1.75
log
@knock out the cpp/m4 stuff from MACROS; after discussion with many...
@
text
@d1 1
a1 1
.\" $OpenBSD: bgpd.conf.5,v 1.74 2006/08/28 23:16:51 stevesk Exp $
d427 1
a427 1
demotion counter on the given group, usually
d440 6
@


1.74
log
@use Forwarding Information Base vs. Forward Information Base;
ok jmc@@ claudio@@
@
text
@d1 1
a1 1
.\" $OpenBSD: bgpd.conf.5,v 1.73 2006/08/04 12:01:48 henning Exp $
d57 1
a57 5
Much like
.Xr cpp 1
or
.Xr m4 1 ,
macros can be defined that will later be expanded in context.
@


1.73
log
@add "restart" to max-prefix, allows sessions suspended due to reaching
max-prefix to be restarted automagically after a given number of minutes
requested by "Sylwester S. Biernacki" <obeer@@obeer.com>, manpage help jmc,
ok claudio
@
text
@d1 1
a1 1
.\" $OpenBSD: bgpd.conf.5,v 1.72 2006/06/19 20:51:46 jmc Exp $
d168 1
a168 1
do not update the Forward Information Base, a.k.a. the kernel
@


1.72
log
@a little .Xr;
@
text
@d1 1
a1 1
.\" $OpenBSD: bgpd.conf.5,v 1.71 2006/06/17 14:06:09 henning Exp $
d599 13
a611 3
.It Ic max-prefix Ar number
Limit the amount of prefixes received.
No such limit is imposed by default.
@


1.71
log
@implement carp demotion control for bgpd.
sessions can be configured to modify the carp demotion counter for a
given interface group (usually, "carp", which has all carp interfaces)
when the session is not established. once the session is established for
60 seconds, the demotion is cleared.
this, used correctly, can prevent a bgpd-box which lost all sessions (and
thus has no routes) to be carp master, while the backup has sessions.
thought through and partially hacked on a drive from calgary to vancouver
with ryan, ok claudio
@
text
@d1 1
a1 1
.\" $OpenBSD: bgpd.conf.5,v 1.70 2006/05/26 04:02:59 deraadt Exp $
d430 1
a430 1
.Xr carp
d435 3
a437 1
The demotion counter will be increased as soon as bgpd starts and decreased
@


1.70
log
@let us not talk about ipsecadm and vpn anymore; ok reyk
@
text
@d1 1
a1 1
.\" $OpenBSD: bgpd.conf.5,v 1.69 2006/04/04 12:39:19 henning Exp $
d427 15
@


1.69
log
@document set nexthop self, and improve that section whil eon it, claudio ok
@
text
@d1 1
a1 1
.\" $OpenBSD: bgpd.conf.5,v 1.68 2006/03/23 20:26:44 claudio Exp $
d1048 1
a1048 1
.Xr ipsecadm 8 ,
@


1.68
log
@Document nexthop qualify via (bgp|default).
OK henning, additional input jmc@@
@
text
@d1 1
a1 1
.\" $OpenBSD: bgpd.conf.5,v 1.67 2006/03/08 13:20:25 claudio Exp $
d622 2
a623 1
.Ic prepend-self
d625 1
a625 1
.Ic nexthop no-modify .
d970 1
d977 10
a986 2
to a different nexthop address, use blackhole or reject routes,
or do not modify it.
d991 2
@


1.67
log
@Document "set community delete ..." and sync that section with the one
from the PARAMETERS section. ok henning@@
@
text
@d1 1
a1 1
.\" $OpenBSD: bgpd.conf.5,v 1.66 2006/03/07 17:54:08 claudio Exp $
d242 17
@


1.66
log
@"set attribute ..." in neighbor blocks needs better documentation.
With input from jmc@@ and ok henning@@
@
text
@d1 1
a1 1
.\" $OpenBSD: bgpd.conf.5,v 1.65 2006/03/07 15:06:43 claudio Exp $
d894 1
a894 1
.Ic community
d897 5
a901 2
.It Ic community Ar name
Set the
d915 1
d917 1
a917 1
.Ic NO_EXPORT_SUBCONFED .
@


1.65
log
@Use 65535 instead of 0xffff to specify the maximum number that can be used
for the local part of communities.
@
text
@d1 1
a1 1
.\" $OpenBSD: bgpd.conf.5,v 1.64 2006/02/25 15:53:15 claudio Exp $
d604 6
@


1.64
log
@Document the softreconfig (in|out) switch. With help from jmc@@
@
text
@d1 1
a1 1
.\" $OpenBSD: bgpd.conf.5,v 1.63 2006/02/05 11:06:01 jmc Exp $
d902 1
a902 1
.Li 0xffff .
@


1.63
log
@tweaks; ok claudio
@
text
@d1 1
a1 1
.\" $OpenBSD: bgpd.conf.5,v 1.62 2006/02/04 13:16:44 claudio Exp $
d604 17
@


1.62
log
@Document the new special community part "neighbor-as". OK henning@@
@
text
@d1 1
a1 1
.\" $OpenBSD: bgpd.conf.5,v 1.61 2005/10/19 10:42:06 henning Exp $
d738 2
a739 2
.Ic neighbor-as 
which is on the fly expanded to the current neighbor remote AS number.
@


1.61
log
@new keyword "down" in neighbor spec, when givenm, the session is not
started on bgpd startup but stays in IDLE. requested by claudio
@
text
@d1 1
a1 1
.\" $OpenBSD: bgpd.conf.5,v 1.60 2005/08/10 09:00:16 jmc Exp $
d733 7
@


1.60
log
@- comapared -> compared
- correct word order
- grammar
@
text
@d1 1
a1 1
.\" $OpenBSD: bgpd.conf.5,v 1.59 2005/08/09 20:27:25 claudio Exp $
d436 4
@


1.59
log
@Introduce new route decision tunable "rde med compare (always|strict)".
If set to always the med will also be compared between different AS.
The default is strict which is the way the RFC specifies it.
OK henning@@
@
text
@d1 1
a1 1
.\" $OpenBSD: bgpd.conf.5,v 1.58 2005/07/28 20:32:33 henning Exp $
d253 1
a253 1
attributes will be comapared always.
d255 1
a255 1
.Ic strict
@


1.58
log
@document the v4/v6 safi control buttons
(and of course it is marc balmer who's spreading the kaesefondue here,
not marcm) claudio ok
@
text
@d1 1
a1 1
.\" $OpenBSD: bgpd.conf.5,v 1.57 2005/06/29 09:43:25 claudio Exp $
d242 17
@


1.57
log
@rtlabel support via filter sets. Just use "set rtlabel foobar" in filters
network and neighbor statements and the routes are labeled accordingly.
While doing that fix some mem-leaks by introducing filterset_free() and
remove the free on send option of send_filterset().
This took a bit longer because we need to carefully track the rtlabel id
refcnts or bad things may happen on reloads.
henning@@ looks fine
@
text
@d1 1
a1 1
.\" $OpenBSD: bgpd.conf.5,v 1.56 2005/06/09 15:32:03 claudio Exp $
d379 14
@


1.56
log
@Change the "network connected|static" statements to "network inet|inet6
connected|static" so that it is possible to distinguish between IPv4 and IPv6
addresses. "network connected|static" is considered deprecated but will be
supported as an alias for "network inet connected|static" for some time (one
release) to simplify upgrades. This also solve a nasty crash when using
"network connected".  OK henning@@
@
text
@d1 1
a1 1
.\" $OpenBSD: bgpd.conf.5,v 1.55 2005/06/04 21:48:16 henning Exp $
d900 1
a900 1
radix table, regardless of whether or not the path was selected for routing.
d914 5
@


1.55
log
@be more clear about route-age
@
text
@d1 1
a1 1
.\" $OpenBSD: bgpd.conf.5,v 1.54 2005/05/01 17:35:26 david Exp $
d209 10
a218 2
.It Ic network static Op Ic set ...\&
.It Ic network connected Op Ic set ...\&
@


1.54
log
@spelling
@
text
@d1 1
a1 1
.\" $OpenBSD: bgpd.conf.5,v 1.53 2005/04/28 13:54:45 claudio Exp $
d243 2
a244 1
also on the age of the route.
@


1.53
log
@Support for "network connected" and "network static" -- announce all
directly connected respectively all static routes. The list is auto-
matically adjusted as soon as a route changes.
OK henning@@
@
text
@d1 1
a1 1
.\" $OpenBSD: bgpd.conf.5,v 1.52 2005/04/18 11:19:39 jmc Exp $
d285 1
a285 1
section, which allows properties to be set specifially for that neighbor:
@


1.52
log
@tidy up AS section a little;
ok henning@@
@
text
@d1 1
a1 1
.\" $OpenBSD: bgpd.conf.5,v 1.51 2005/04/18 00:16:16 henning Exp $
d209 2
d212 6
@


1.51
log
@AfriNIC has been established as RIR for Africa now
@
text
@d1 1
a1 1
.\" $OpenBSD: bgpd.conf.5,v 1.50 2005/04/13 20:05:12 jmc Exp $
d89 1
a89 1
The AS numbers are assigned by local RIRs, such as
d93 1
a93 1
for Africa,
d95 1
a95 1
for the Asia Pacific region,
d97 1
a97 1
for North America and parts of the Caribbean region,
d99 1
a99 1
for Latin America and Caribbean, and
d101 1
a101 1
for Europe, the Middle East and parts of Asia.
d104 1
a104 1
For example,
@


1.50
log
@tweak to make this use similar format to ospfd.conf.5 and hostapd.conf.5;
@
text
@d1 1
a1 1
.\" $OpenBSD: bgpd.conf.5,v 1.49 2005/04/12 21:53:38 jmc Exp $
d92 2
d97 1
a97 1
for North America, parts of the Caribbean and Africa,
d101 1
a101 1
for Europe, the Middle East and parts of Asia and Africa.
@


1.49
log
@tweaks;
ok claudio@@
@
text
@d1 1
a1 1
.\" $OpenBSD: bgpd.conf.5,v 1.48 2005/04/12 14:32:00 claudio Exp $
d71 1
a71 1
For example,
@


1.48
log
@Introduce a per prefix weight.  The weight is used to tip prefixes with equal
long AS pathes in one or the other direction.  It weights a prefix at a very
late stage in the decision process. This is a nice bgpd feature to traffic
engineer networks where most AS pathes are equally long.
OK henning@@
@
text
@d1 1
a1 1
.\" $OpenBSD: bgpd.conf.5,v 1.47 2005/04/12 14:22:46 claudio Exp $
d899 1
a899 1
is used to tip prefixes with equal long AS pathes in one or
d901 1
a901 1
It weights a prefix at a very late stage in the decision process.
d911 1
a911 1
is a local non-transitive attribute and a bgpd specific extension.
@


1.47
log
@set metric is an alias of set med since a long time. OK henning@@
@
text
@d1 1
a1 1
.\" $OpenBSD: bgpd.conf.5,v 1.46 2005/03/15 23:41:52 henning Exp $
d895 17
@


1.46
log
@describe "depend on"
you wouldn't guess how hard it was to get that right...
initial diffs and lots of input from Jason Ackley and jaredy,
ok claudio jaredy jmc deraadt
@
text
@d1 1
a1 1
.\" $OpenBSD: bgpd.conf.5,v 1.45 2005/03/15 09:24:05 jmc Exp $
d845 1
@


1.45
log
@tweaks;
ok claudio@@
@
text
@d1 1
a1 1
.\" $OpenBSD: bgpd.conf.5,v 1.44 2005/03/14 17:32:04 claudio Exp $
d360 20
@


1.44
log
@Allow to modify the metrics in a relative way by prepending the number with
a '+' or '-'. e.g. set localpref +20. This is another gem from the FOSDEM
lying around on my HD gathering dust. OK henning@@
@
text
@d1 1
a1 1
.\" $OpenBSD: bgpd.conf.5,v 1.43 2005/03/11 12:54:19 claudio Exp $
d815 1
a815 1
If 
d817 1
a817 1
starts with a sign 
d819 3
a821 3
will be adjusted by adding or substracting
.Ar number
else it will be set to
d828 1
a828 1
If 
d830 1
a830 1
starts with a sign 
d832 3
a834 3
will be adjusted by adding or substracting
.Ar number
else it will be set to
@


1.43
log
@Finally commit the transparent-as and nexthop no-modify stuff I wrote on the
way to FOSDEM. With transparent-as set to ye bgpd will not prepend his own
AS for sent updates. NB the neighbor needs to set "enforce neighbor-as no"
or it will not like the received AS paths. With set nexthop no-modify bgpd
will change the nexthop as done normaly.
OK henning@@ man page update with help of jmc@@
@
text
@d1 1
a1 1
.\" $OpenBSD: bgpd.conf.5,v 1.42 2004/12/31 10:47:37 jaredy Exp $
d815 8
d828 8
@


1.42
log
@document using neighbor descriptions to specify neighbors where
applicable.  ok henning, jmc
@
text
@d1 1
a1 1
.\" $OpenBSD: bgpd.conf.5,v 1.41 2004/11/19 10:06:33 claudio Exp $
d257 11
d823 6
a828 2
.Po Ar address Ns \&| Ns
.Ic blackhole Ns \&| Ns Ic reject Pc
d833 2
a834 1
to a different nexthop address, or use blackhole or reject routes.
@


1.41
log
@Add NO_PEER to the list of well-known communities and use 65535 instead of
0xffff. OK henning@@
@
text
@d1 1
a1 1
.\" $OpenBSD: bgpd.conf.5,v 1.40 2004/11/11 10:35:15 claudio Exp $
d352 2
a353 2
The description is used when logging neighbor events and in status
reports, etc., and has no further meaning to
@


1.40
log
@New config statement "rde route-age [evaluate|ignore]". If set to evaluate
the best path selection will not only be based on the path attributes but
also on the age of the prefix. This is an extension to the RFC. The default
is ignore but previously it was implicitly set to evaluate.
OK henning@@ man page OK jaredy@@ jmc@@
@
text
@d1 1
a1 1
.\" $OpenBSD: bgpd.conf.5,v 1.39 2004/11/09 10:37:42 henning Exp $
d633 1
a633 1
.Li 0xffff .
d645 1
d647 1
a647 1
.Ic NO_EXPORT_SUBCONFED .
@


1.39
log
@in the list of RIRs:
-add LACNIC
-RIPE serves more than just europe, and ARIN more than north america
-order alphabetically
From: Klaus Steding-Jessen <jessen@@nic.br>
@
text
@d1 1
a1 1
.\" $OpenBSD: bgpd.conf.5,v 1.38 2004/09/28 12:09:31 claudio Exp $
d224 13
@


1.38
log
@Add prepend-neighbor feature. Prepend the remote-as n times similar to
prepend-self. Only for incomming UPDATEs. OK henning@@
@
text
@d1 1
a1 1
.\" $OpenBSD: bgpd.conf.5,v 1.37 2004/08/20 14:56:09 claudio Exp $
d91 3
a93 3
.Bl -tag -width xxxxx -compact
.It RIPE
for Europe,
d95 5
a99 3
for America, and
.It APNIC
for the Asian-Pacific region.
@


1.37
log
@foobar-AS -> foobar-as as already done in some places. mIXeD cASe keywords
are not fluffy. OK henning@@
@
text
@d1 1
a1 1
.\" $OpenBSD: bgpd.conf.5,v 1.36 2004/08/19 16:12:31 hshoexer Exp $
d814 6
@


1.36
log
@document use of "isakmpd -Ka" with bgpd.

ok (and help) henning@@ jmc@@ jaredy@@
@
text
@d1 1
a1 1
.\" $OpenBSD: bgpd.conf.5,v 1.35 2004/08/13 14:03:20 claudio Exp $
d358 1
a358 1
.Ic enforce neighbor-AS
d579 1
a579 1
.Bl -tag -width transmit-AS -compact
d582 1
a582 1
.It Ic source-AS
d584 1
a584 1
.It Ic transit-AS
d597 2
a598 2
deny from any { AS 1, source-AS 2, transit-AS 3 }
deny from any { AS { 1, 2, 3 }, source-AS 4, transit-AS 5 }
@


1.35
log
@Fix minor issues with IPv6 dumps and add a function for dumping the RIB table
protocol independent. This new dump format is not (yet) supported by the
mrtd route_btoa tool. OK henning@@
@
text
@d1 1
a1 1
.\" $OpenBSD: bgpd.conf.5,v 1.34 2004/08/09 16:29:18 jaredy Exp $
d440 8
a447 8
A simple
.Pa /etc/isakmpd/isakmpd.policy
file is needed as well; it can be as simple as
.Bd -literal -offset indent
Authorizer: "POLICY"
Comment: This bare-bones assertion accepts everything
.Ed
.Pp
d835 2
a836 1
.Xr isakmpd 8
@


1.34
log
@document new list expansion syntax & add examples
reorganize the "to/from <peer>" filter rule parameter section
add a few other various clarification bits
and fix some mdoc macros

ok henning
@
text
@d1 1
a1 1
.\" $OpenBSD: bgpd.conf.5,v 1.33 2004/07/30 22:50:49 claudio Exp $
d107 5
a111 1
.It Ic dump table Ar file Op Ar timeout
d128 3
@


1.33
log
@Document "announce default-route" with a lot of help from jmc@@
@
text
@d1 1
a1 1
.\" $OpenBSD: bgpd.conf.5,v 1.32 2004/07/13 18:27:57 jaredy Exp $
d552 1
a552 1
Most parameters are optional.
a556 11
.It Ic any
.It Ar address
.It Ic group Ar description
This rule applies only to
.Em UPDATES
coming from, or going to, this particular neighbor.
Neighbors can be matched against their address, the group description,
or the token
.Ic any
can be used to match any neighbor.
.Pp
d581 13
d604 8
d621 2
a622 2
.Cm NO_EXPORT ,
.Cm NO_ADVERTISE ,
d624 12
a635 1
.Cm NO_EXPORT_SUBCONFED .
d637 17
a653 5
.It Ic from
.It Ic to
This rule applies to incoming or outgoing
.Em UPDATES .
Either one or the other must be specified.
d663 19
d772 2
a773 2
.Cm NO_EXPORT ,
.Cm NO_ADVERTISE ,
d775 1
a775 1
.Cm NO_EXPORT_SUBCONFED .
@


1.32
log
@lots of cleanup and revising:
- typo fixes, rewording, punctuation
- better use of and more format macros
- section reorganization in some places
- list directives with their arguments
- add some cross-refs

ok jmc, henning, otto
@
text
@d1 1
a1 1
.\" $OpenBSD: bgpd.conf.5,v 1.31 2004/07/11 00:53:20 jfb Exp $
d294 4
a297 2
.Po Ic all Ns \&| Ns
.Ic none Ns \&| Ns Ic self Pc
d304 3
@


1.31
log
@Fix a cross reference to bgpd in the FILES section

ok jmc@@, should make brad stop whining
@
text
@d1 1
a1 1
.\" $OpenBSD: bgpd.conf.5,v 1.30 2004/07/09 11:01:22 henning Exp $
d27 1
a27 1
.Ar bgpd
d35 1
a35 1
.It Cm Macros
d38 1
a38 1
.It Cm Global configuration
d40 3
a42 3
.Ar bgpd .
.It Cm Neighbors and Groups
.Ar bgpd
d44 1
a44 1
.Ar neighbors .
d47 1
a47 1
.It Cm Filter
d52 1
a52 2
With the exception of
.Cm macros
d64 5
a68 4
Macro names may not be reserved words (for example
.Ar AS ,
.Ar neighbor ,
.Ar group ) .
d80 1
a80 1
.Ar bgpd
d82 7
a88 3
.Bl -tag -width xxxxxxxx
.It Ar AS
Set the local Autonomous System number.
d92 1
a92 1
.It Ar RIPE
d94 3
a96 3
.It Ar ARIN
for America and
.It Ar APNIC
d105 14
a118 16
sets the local
.Ar AS
to 65001.
.It Ar dump
.Ar bgpd
is capable of dumping the
.Em RIB ,
aka the Routing Information Base and all
.Em bgp
messages in
.Em mrt
format.
Dumping the
.Em RIB
is normally an expensive operation, but it should not influence the session
handling.
d121 4
a124 1
For example,
d129 4
a132 6
will dump all 300 seconds of the
.Em RIB
table to the
.Xr strftime 3
expanded filename.
The timeout is optional.
d137 3
a139 5
Similar to the table dump, but this time all
.Em bgp
messages and
.Em state
transitions are dumped to the specified file.
a143 3
As before, but only the
.Em UPDATE
messages are dumped to the file.
d147 2
d151 4
a154 5
or
.Bd -literal -offset indent
dump updates out "/tmp/updates-out-%H%M" 300
.Ed
.It Ar fib-update
d156 2
a157 2
.Em no ,
do not update the Forward Information Base aka the kernel
d160 4
a163 3
.Em yes .
.It Ar holdtime
Sets the holdtime in seconds.
d175 4
a178 3
Each neighbor announces its configured holdtime, the smaller one is
then agreed on.
.It Ar holdtime min
d180 6
a185 5
Must be greater or equal to 3.
.It Ar listen on
Specify the local IP address the
.Ar bgpd
daemon should listen on.
d189 2
a190 1
.It Ar log updates
d192 7
a198 3
.It Ar network
Announce the specified network as belonging to our
.Em AS .
d206 1
a206 1
.Ar network
d215 5
a219 1
.It Ar route-collector
d221 1
a221 1
.Em yes ,
d224 4
a227 3
.Em no .
.It Ar router-id
Set the router ID to the given IP address which must be local to the
d233 1
a233 1
If not given, the bgp ID is determined as the biggest IP address assigned
d237 6
a242 4
.Ar bgpd
establishes TCP connections to other BGP speakers, called neighbors.
Each neighbor is specified by a neighbor section, specifying properties for
that neighbor:
d250 8
a257 3
Multiple neighbors can be grouped together by a group section.
Each neighbor statement within the group section inherits all properties
from the group section.
d270 1
a270 1
Instead of the neighbor's IP address an address/netmask pair may be given.
d280 1
a280 1
inheriting everything from the template but the remote address which is
d283 3
a285 3
.Ar remote-as ,
.Ar bgpd
will accept any AS the neighbor presents in the
d287 1
a287 1
message then.
d290 7
a296 2
.Bl -tag -width xxxxxxxx
.It Ar announce
d298 1
a298 1
.Em none ,
d303 1
a303 1
.Em all ,
d307 2
a308 2
This is usually used for transit
.Em AS's
d316 1
a316 1
.Em self
d319 5
a323 7
messages to announcements of the local
.Em AS .
The default for
.Em IBGP
peers is
.Em all .
.It Ar descr
d326 10
a335 4
reports etc and has no further meaning to
.Ar bgpd .
.It Ar dump
Do a peer specific mrt dump.
d337 1
a337 1
.Em all
d339 1
a339 1
.Em updates .
d341 1
a341 1
.Em dump
d344 5
a348 1
.It Ar enforce neighbor-AS
d350 1
a350 1
.Em yes ,
d356 1
a356 3
of the
.Em neighbor
are rejected and a
d359 2
a360 4
The default value for
.Em IBGP
peers is
.Em no
d362 3
a364 2
.Em yes .
.It Ar holdtime
d367 2
a368 1
.It Ar holdtime min
d371 7
a377 1
.It Ar ipsec (ah|esp) (in|out) spi <number> <authspec> [<encspec>]
d379 3
a381 2
There have to be at least two "ipsec" statements per peer with manual
keying, one per direction.
d392 1
a392 1
.Ar ah
d395 1
a395 1
.Ar esp ,
d406 7
a412 2
Keys have to be given in hexadecimal format.
.It Ar ipsec (ah|esp) ike
d415 1
a415 1
.Ar bgpd
d418 1
a418 1
is responsible for the session keys.
d424 2
a425 2
It has to be stored in a file
named after the peer's IP address and has to be stored in
d427 1
a427 1
The local public key has to be copied to the peer in the same way.
d439 4
a442 3
.Ar bgpd
daemons on both sides the session should be established.
.It Ar local-address
d444 1
a444 1
.Ar bgpd
d447 8
a454 4
If a local-address is given it binds
to this address before.
.It Ar max-prefix
Limit amount of prefixes received.
d456 2
a457 1
.It Ar multihop
d459 1
a459 1
.Ar bgpd
d462 1
a462 1
.Ar multihop
d464 2
a465 1
.It Ar passive
d467 2
a468 1
.It Ar remote-as
d470 8
a477 4
.It Ar route-reflector
Act as an RFC 2796 route-reflector for this neighbor.
An optional cluster ID can be specified; otherwise the bgp ID will be used.
.It Ar set
d481 1
a481 1
.Ar neighbor
d483 2
a484 2
.Ar group
statement:
d492 3
a494 1
.It Ar tcp md5sig
d503 1
a503 1
.Ar bgpd
d505 1
a505 1
.Ar allow
d507 1
a507 1
.Ar deny
d522 1
a522 1
.Ar allow
d524 1
a524 1
.Ar deny
d529 1
a529 1
.It Ar allow
d533 1
a533 1
.It Ar deny
d537 1
a537 1
.It Ar match
d551 4
a554 4
.Bl -tag -width xxxxxxxx -compact
.It Ar any
.It Ar <address>
.It Ar group <descr>
d560 1
a560 1
.Ar any
d563 1
a563 1
.It Ar <astype> <asnum>
d570 1
a570 1
.Ar <asnum>
d574 2
a575 2
.Ar <astype> .
.Ar <astype>
a576 5
.Bd -literal -offset indent
AS		(any part)
source-AS	(rightmost AS number)
transit-AS	(all but the rightmost AS number)
.Ed
d578 14
a591 1
.It Ar community <as>:<num>
d594 3
a596 1
where the community path attribute is present and matches.
d598 1
a598 1
.Ar <as>
d600 1
a600 1
.Ar <num>
d603 7
a609 2
to do an
.Dq anymatch .
d611 2
a612 1
.It Ar from No or Ar to
d617 4
a620 1
.It Ar prefix <address>/<len>
d625 1
a625 1
.It Ar prefixlen <desc>
d643 11
a653 11
For instance:
.Bl -tag -width Fl
.It Ar prefixlen 8-12
means
.Sq all prefix lengths >= 8 and <= 12 ,
hence the CIDR netmasks 8, 9, 10, 11 and 12.
.It Ar prefixlen 8><12
means
.Sq all prefix lengths < 8 and > 12 ,
hence the CIDR netmasks 0-7 and 13-32.
.El
d655 1
a655 1
.Ar prefixlen
d657 1
a657 1
.Ar prefix .
d665 1
a665 1
.It Ar quick
d669 1
a669 1
.Ar quick
d673 1
a673 1
.It Ar set
d683 1
a683 1
.Ar set .
d685 1
a685 1
.Ar set
d687 1
a687 1
.Ar network
d689 1
a689 1
.Ar neighbor
d691 3
a693 4
.Ar group
blocks and on
filter rules.
Attribute sets can be expressed as list.
d696 7
a702 2
.Bl -tag -width xxxxxxxx
.It Ar community
d707 1
a707 1
.Ar asnum:local ,
d709 1
a709 1
.Ar asnum
d712 2
a713 1
is a locally-significant number between zero and 0xffff.
d715 2
a716 2
.Em NO_EXPORT ,
.Em NO_ADVERTISE ,
d718 3
a720 2
.Em NO_EXPORT_SUBCONFED .
.It Ar localpref
d724 2
a725 1
.It Ar med
d729 6
a734 1
.It Ar nexthop
d744 3
a746 2
.It Ar pftable
Adds the prefix in the update to the specified
d750 5
a754 4
.It Ar prepend-self
Prepend the local
.Em AS
multiple times to the
d761 1
a761 1
configuration file.
d766 1
d768 1
@


1.30
log
@various tweaks from the Frankfurt->Hamburg flight
@
text
@d1 1
a1 1
.\" $OpenBSD: bgpd.conf.5,v 1.29 2004/07/05 17:04:44 henning Exp $
d671 1
a671 1
.Nm
@


1.29
log
@new blackhole/reject nexthops
@
text
@d1 1
a1 1
.\" $OpenBSD: bgpd.conf.5,v 1.28 2004/05/24 08:45:04 jmc Exp $
d39 2
a40 1
Global settings for the bgpd daemon.
d73 2
a74 2
c7206="1.2.3.4"
neighbor $c7206 {
d117 1
a117 1
Dumping too often may result in a slow update speed.
d119 6
a124 1
This will dump all 300 seconds of the
d131 1
a131 1
dump table "/tmp/rib-dump-%H%M" 300
d134 1
a134 1
Similar to the table dump but this time all
d138 1
a138 1
transitions are dumped to the specified file:
d140 1
a140 1
dump all in "/tmp/all-in-%H%M" 300
d145 1
a145 5
messages are dumped to the file:
.Bd -literal -offset indent
dump updates in "/tmp/updates-in-%H%M" 300
.Ed
.Pp
@


1.28
log
@uppercase `id';
ok henning@@
@
text
@d1 1
a1 1
.\" $OpenBSD: bgpd.conf.5,v 1.27 2004/05/23 23:05:31 jmc Exp $
d649 6
a654 1
to a different nexthop address.
@


1.27
log
@some readability fixes, mainly keeping things in alphabetical order;
ok henning@@
@
text
@d1 1
a1 1
.\" $OpenBSD: bgpd.conf.5,v 1.25 2004/05/17 12:39:32 djm Exp $
d213 1
a213 1
Set the router id to the given IP address which must be local to the
d219 1
a219 1
If not given the bgp id is determined as the biggest IP address assigned
d420 1
a420 1
An optional cluster id can be specified; otherwise the bgp id will be used.
@


1.26
log
@RFC 2796 bgp route reflector support. This is very useful in conjunction
with templates. looks good, go for it henning@@
@
text
@d85 1
a338 46
.It Ar local-address
When
.Ar bgpd
initiates the TCP connection to the neighbor system, it normally does not
bind to a specific IP address.
If a local-address is given it binds
to this address before.
.It Ar max-prefix
Limit amount of prefixes received.
No such limit is imposed by default.
.It Ar multihop
Neighbors not in the same AS as the local
.Ar bgpd
normally have to be directly connected to the local machine.
If this is not the case, the
.Ar multihop
statement defines the maximum hops the neighbor may be away.
.It Ar passive
Do not attempt to actively open a TCP connection to the neighbor system.
.It Ar remote-as
Set the AS number of the remote system.
.It Ar route-reflector
Act as a RFC 2796 route-reflector for this neighbor.
An optional cluster id can be specified else the own bgp id will be used.
.It Ar set
Set the
.Em AS path attributes
to some default per
.Ar neighbor
or
.Ar group
statement:
.Bd -literal -offset indent
set localpref 300
.Ed
.Pp
See also the
.Sx ATTRIBUTE SET
section.
.It Ar tcp md5sig
Enable TCP MD5 signatures per RFC 2385.
The shared secret can either be given as a password or hexadecimal key.
.Bd -literal -offset indent
tcp md5sig password mekmidasdigoat
tcp md5sig key deadbeef
.Ed
d378 3
a380 2
.Pa /etc/isakmpd/private/local.pub
to the local machine. It has to be stored in a file
d386 1
a386 1
file is needed as well, it can be as simple as
d397 46
d471 4
a478 4
.It Ar allow
The
.Em UPDATE
is passed.
d492 2
a493 12
.Bl -tag -width xxxxxxxx
.It Ar quick
If an
.Em UPDATE
matches a rule which has the
.Ar quick
option set, this rule is considered the last matching rule, and evaluation
of subsequent rules is skipped.
.It Ar from No or Ar to
This rule applies to incoming or outgoing
.Em UPDATES .
Either one or the other must be specified.
d504 39
d547 1
d588 7
a594 19
.It Ar <astype> <asnum>
This rule applies only to
.Em UPDATES
where the
.Em AS path
matches.
The
.Ar <asnum>
is matched against a part of the
.Em AS path
specified by the
.Ar <astype> .
.Ar <astype>
is one of the following operators:
.Bd -literal -offset indent
AS		(any part)
source-AS	(rightmost AS number)
transit-AS	(all but the rightmost AS number)
.Ed
a595 12
.It Ar community <as>:<num>
This rule applies only to
.Em UPDATES
where the community path attribute is present and matches.
Both
.Ar <as>
and
.Ar <num>
may be set to
.Sq *
to do an
.Dq anymatch .
a620 4
.It Ar localpref
Set the
.Em LOCAL_PREF
.Em AS path attribute .
d624 2
a625 2
.Em AS path attribute .
Communities are specified as 
d632 1
a632 1
Alternately, well-known communities may be specified by name: 
d635 1
a635 1
or 
d637 4
d644 1
a644 1
.Em AS path attribute .
d648 1
a648 1
.Em AS path attribute
@


1.25
log
@extend filter language to allow basic setting of COMMUNITIES attribute.
ok claudio@@
@
text
@d1 1
a1 1
.\" $OpenBSD: bgpd.conf.5,v 1.24 2004/05/08 20:18:45 henning Exp $
d359 3
@


1.24
log
@as bloody attempt to document neighbor cloning
@
text
@d1 1
a1 1
.\" $OpenBSD: bgpd.conf.5,v 1.23 2004/05/08 20:00:44 henning Exp $
d614 16
@


1.23
log
@a bloody attempt at documenting the ipsec fluff.
this needs to be fleshed out and polished, but at least it is somewhat
documented now...
@
text
@d1 1
a1 1
.\" $OpenBSD: bgpd.conf.5,v 1.22 2004/05/07 10:06:15 djm Exp $
d247 19
@


1.22
log
@add a filter option to dump prefixes learned in UPDATEs into a PF table,
intended for building realtime BGP blacklists (e.g. with spamd);
ok claudio & henning
@
text
@d1 1
a1 1
.\" $OpenBSD: bgpd.conf.5,v 1.21 2004/04/02 18:28:49 henning Exp $
d362 57
d623 1
d625 3
a627 1
.Xr bgpd 8
@


1.21
log
@spelink
@
text
@d1 1
a1 1
.\" $OpenBSD: bgpd.conf.5,v 1.20 2004/03/12 20:23:01 henning Exp $
d547 5
@


1.20
log
@tweak
@
text
@d1 1
a1 1
.\" $OpenBSD: bgpd.conf.5,v 1.19 2004/03/12 17:39:46 claudio Exp $
d428 1
a428 1
comming from, or going to, this particular neighbor.
@


1.19
log
@Update man page to reflect reality. Added filtering section and some new
statements. OK jmc@@ henning@@
@
text
@d1 1
a1 1
.\" $OpenBSD: bgpd.conf.5,v 1.18 2004/02/25 21:15:01 claudio Exp $
d19 1
a19 1
.Dd December 23, 2003
d113 1
a113 1
is normally an expensive operation but it should not influence the session
d261 1
a261 1
This is normally only necessary for transit
d274 1
a274 2
.Em AS
only.
d328 1
a328 1
The default is unlimited.
d330 1
a330 1
Normally neighbors that are not in the same AS as the local
d332 2
a333 2
have to be directly connected to the local machine.
If this is not the case the
d335 1
a335 1
statement defines the maximum hops the neighbor is away.
d399 1
a399 1
Apply only the filter attribute set without influencing the action to be taken.
d441 1
a441 1
Ranges of prefix length are specified by using these operators:
a474 6
.Ed
.Pp
The following two examples are alike:
.Bd -literal -offset indent
prefix 10.0.0.0/8
prefix 10.0.0.0/8 prefixlen = 8
@


1.18
log
@Man page update for the mrt dump changes. OK henning@@ jmc@@
@
text
@d1 1
a1 1
.\" $OpenBSD: bgpd.conf.5,v 1.17 2004/02/07 20:40:47 henning Exp $
d3 1
d33 1
a33 1
config file is divided into three main sections.
d46 3
d192 19
d291 3
a293 1
See also the dump section in
d295 19
d335 1
a335 1
.Em multihop
d341 15
d363 196
@


1.17
log
@it's about time to document tcp md5sig ...
jmc help and ok
@
text
@d1 1
a1 1
.\" $OpenBSD: bgpd.conf.5,v 1.16 2004/02/01 19:49:10 claudio Exp $
d129 1
a129 1
dump msg all in "/tmp/all-in-%H%M" 300
d132 1
a132 1
As before, but only the filtered
d136 11
a146 1
dump msg filtered in "/tmp/filtered-in-%H%M" 300
d262 8
@


1.16
log
@Update: document the network statement and update the announce description
OK henning@@
@
text
@d1 1
a1 1
.\" $OpenBSD: bgpd.conf.5,v 1.15 2004/01/18 07:35:30 jmc Exp $
d279 7
d295 1
@


1.15
log
@sort options;
ok claudio@@ henning@@
@
text
@d1 1
a1 1
.\" $OpenBSD: bgpd.conf.5,v 1.14 2004/01/13 14:31:18 claudio Exp $
d172 6
d229 8
a236 2
.Em AS's .
The default value is
d243 4
@


1.14
log
@Update manual for the new config statements.
Spelling correction by jmc@@ OK henning@@
@
text
@d1 1
a1 1
.\" $OpenBSD: bgpd.conf.5,v 1.13 2004/01/07 12:33:15 claudio Exp $
a97 43
.It Ar router-id
Set the router id to the given IP address which must be local to the
machine.
.Bd -literal -offset indent
router-id 10.0.0.1
.Ed
.Pp
If not given the bgp id is determined as the biggest IP address assigned
to the local machine.
.It Ar holdtime
Sets the holdtime in seconds.
The holdtime is reset to its initial value every time either a
.Em KEEPALIVE
or an
.Em UPDATE
message is received from the neighbor.
If the holdtime expires the session is dropped.
The default is 90 seconds.
Neighboring systems negotiate the holdtime used when the connection is
established in the
.Em OPEN
messages.
Each neighbor announces its configured holdtime, the smaller one is
then agreed on.
.It Ar holdtime min
The minimal accepted holdtime in seconds.
Must be greater or equal to 3.
.It Ar listen on
Specify the local IP address the
.Ar bgpd
daemon should listen on.
.Bd -literal -offset indent
listen on 127.0.0.1
.Ed
.It Ar log updates
Log received and sent updates.
.It Ar fib-update
If set to
.Em no ,
do not update the Forward Information Base aka the kernel
routing table.
The default is
.Em yes .
d138 43
a210 29
.It Ar remote-as
Set the AS number of the remote system.
.It Ar descr
Add a description.
The description is used when logging neighbor events and in status
reports etc and has no further meaning to
.Ar bgpd .
.It Ar local-address
When
.Ar bgpd
initiates the TCP connection to the neighbor system, it normally does not
bind to a specific IP address.
If a local-address is given it binds
to this address before.
.It Ar multihop
Normally neighbors that are not in the same AS as the local
.Ar bgpd
have to be directly connected to the local machine.
If this is not the case the
.Em multihop
statement defines the maximum hops the neighbor is away.
.It Ar passive
Do not attempt to actively open a TCP connection to the neighbor system.
.It Ar holdtime
Set the holdtime in seconds.
Inherited from the global configuration if not given.
.It Ar holdtime min
Set the minimal acceptable holdtime.
Inherited from the global configuration if not given.
d231 18
d252 11
@


1.13
log
@Document mrt dump comands. Help by jmc@@ OK henning@@
@
text
@d1 1
a1 1
.\" $OpenBSD: bgpd.conf.5,v 1.12 2004/01/06 20:41:55 henning Exp $
d240 23
@


1.12
log
@allow holdtime and holdtime min to be configuered per peer

ok claudio@@
@
text
@d1 1
a1 1
.\" $OpenBSD: bgpd.conf.5,v 1.11 2004/01/06 03:43:50 henning Exp $
d141 40
d236 1
a236 1
Inherit from the global configuration if not given.
d239 1
a239 1
Inherit from the global configuration if not given.
d248 1
@


1.11
log
@2004
@
text
@d1 1
a1 1
.\" $OpenBSD: bgpd.conf.5,v 1.10 2003/12/27 21:40:43 henning Exp $
d194 6
@


1.10
log
@bgpid -> router-id
local-addr -> local-address
@
text
@d1 1
a1 1
.\" $OpenBSD: bgpd.conf.5,v 1.9 2003/12/27 18:43:36 henning Exp $
d3 1
a3 1
.\" Copyright (c) 2003 Henning Brauer <henning@@openbsd.org>
@


1.9
log
@style
@
text
@d1 1
a1 1
.\" $OpenBSD: bgpd.conf.5,v 1.8 2003/12/27 14:42:59 henning Exp $
d98 2
a99 2
.It Ar bgpid
Set the bgp id to the given IP address which must be local to the
d102 1
a102 1
bgpid 10.0.0.1
d178 1
a178 1
.It Ar local-addr
d183 1
a183 1
If a local-addr is given it binds
@


1.8
log
@"no fib-update" -> "fib-update [yes|no]"
makes more sense this way
@
text
@d1 1
a1 1
.\" $OpenBSD: bgpd.conf.5,v 1.7 2003/12/26 20:52:14 jakob Exp $
d140 1
a140 1
.Em yes . 
@


1.7
log
@add option 'log updates' to log updates. ok henning@@
@
text
@d1 1
a1 1
.\" $OpenBSD: bgpd.conf.5,v 1.6 2003/12/26 20:40:10 henning Exp $
d134 7
a140 2
.It Ar no fib-update
Do not update the Forward Information Base aka the kernel routing table.
@


1.6
log
@yes, i have to admit that Wouter Clarie <rimshot@@pandora.be> is right,
The bgpd.conf program didn't first appear in OpenBSD 3.5, because,
well, a config file is not a program.
@
text
@d1 1
a1 1
.\" $OpenBSD: bgpd.conf.5,v 1.5 2003/12/26 20:29:10 jmc Exp $
d132 2
@


1.5
log
@FILES before SEE ALSO;
@
text
@d1 1
a1 1
.\" $OpenBSD: bgpd.conf.5,v 1.4 2003/12/25 14:28:49 henning Exp $
d199 1
a199 1
program first appeared in
@


1.4
log
@implement "passive": do not attempt to open a tcp connection to the
neighbor system
@
text
@d1 1
a1 1
.\" $OpenBSD: bgpd.conf.5,v 1.3 2003/12/24 13:49:21 henning Exp $
a187 2
.Sh SEE ALSO
.Xr bgpd 8
d194 2
@


1.3
log
@add option to not touch the kernel routing table
@
text
@d1 1
a1 1
.\" $OpenBSD: bgpd.conf.5,v 1.2 2003/12/24 11:38:56 henning Exp $
d185 2
@


1.2
log
@typos from jared
apparently these were already fixed in the diff jmc@@ sent me and I somehow
screwed up when getting it in - sorry.
@
text
@d1 1
a1 1
.\" $OpenBSD: bgpd.conf.5,v 1.1 2003/12/23 17:06:32 henning Exp $
d132 2
@


1.1
log
@bloody attempt at the other manpage.
this time with (non-bloody) help from jmc@@
@
text
@d1 1
a1 1
.\" $OpenBSD$
d32 1
a32 1
config file is devided into three main sections.
d135 1
a135 1
estables tcp connections to other bgp speakers, called neighbors.
d172 1
a172 1
initiates the tcp connection to the neighbor system, it normaly does not
@

