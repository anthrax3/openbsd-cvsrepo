head	1.32;
access;
symbols
	OPENBSD_6_2_BASE:1.32
	OPENBSD_6_1:1.30.0.4
	OPENBSD_6_1_BASE:1.30
	OPENBSD_6_0:1.29.0.28
	OPENBSD_6_0_BASE:1.29
	OPENBSD_5_9:1.29.0.22
	OPENBSD_5_9_BASE:1.29
	OPENBSD_5_8:1.29.0.24
	OPENBSD_5_8_BASE:1.29
	OPENBSD_5_7:1.29.0.16
	OPENBSD_5_7_BASE:1.29
	OPENBSD_5_6:1.29.0.20
	OPENBSD_5_6_BASE:1.29
	OPENBSD_5_5:1.29.0.18
	OPENBSD_5_5_BASE:1.29
	OPENBSD_5_4:1.29.0.14
	OPENBSD_5_4_BASE:1.29
	OPENBSD_5_3:1.29.0.12
	OPENBSD_5_3_BASE:1.29
	OPENBSD_5_2:1.29.0.10
	OPENBSD_5_2_BASE:1.29
	OPENBSD_5_1_BASE:1.29
	OPENBSD_5_1:1.29.0.8
	OPENBSD_5_0:1.29.0.6
	OPENBSD_5_0_BASE:1.29
	OPENBSD_4_9:1.29.0.4
	OPENBSD_4_9_BASE:1.29
	OPENBSD_4_8:1.29.0.2
	OPENBSD_4_8_BASE:1.29
	OPENBSD_4_7:1.28.0.2
	OPENBSD_4_7_BASE:1.28
	OPENBSD_4_6:1.28.0.4
	OPENBSD_4_6_BASE:1.28
	OPENBSD_4_5:1.27.0.6
	OPENBSD_4_5_BASE:1.27
	OPENBSD_4_4:1.27.0.4
	OPENBSD_4_4_BASE:1.27
	OPENBSD_4_3:1.27.0.2
	OPENBSD_4_3_BASE:1.27
	OPENBSD_4_2:1.26.0.4
	OPENBSD_4_2_BASE:1.26
	OPENBSD_4_1:1.26.0.2
	OPENBSD_4_1_BASE:1.26
	OPENBSD_4_0:1.25.0.2
	OPENBSD_4_0_BASE:1.25
	OPENBSD_3_9:1.24.0.2
	OPENBSD_3_9_BASE:1.24
	OPENBSD_3_8:1.23.0.2
	OPENBSD_3_8_BASE:1.23
	OPENBSD_3_7:1.20.0.2
	OPENBSD_3_7_BASE:1.20
	OPENBSD_3_6:1.19.0.2
	OPENBSD_3_6_BASE:1.19
	OPENBSD_3_5:1.18.0.2
	OPENBSD_3_5_BASE:1.18;
locks; strict;
comment	@# @;


1.32
date	2017.08.21.14.43.33;	author phessler;	state Exp;
branches;
next	1.31;
commitid	w8HmSxD2kSqL3Ase;

1.31
date	2017.08.21.14.41.22;	author phessler;	state Exp;
branches;
next	1.30;
commitid	GKJPovOeNtV6hnQq;

1.30
date	2016.09.02.14.00.29;	author benno;	state Exp;
branches;
next	1.29;
commitid	cUiKeXOsNjNjPeSK;

1.29
date	2010.05.26.16.44.32;	author nicm;	state Exp;
branches;
next	1.28;

1.28
date	2009.06.25.14.14.54;	author deraadt;	state Exp;
branches;
next	1.27;

1.27
date	2007.12.20.17.08.47;	author henning;	state Exp;
branches;
next	1.26;

1.26
date	2006.12.08.22.31.15;	author itojun;	state Exp;
branches;
next	1.25;

1.25
date	2006.06.17.14.06.09;	author henning;	state Exp;
branches;
next	1.24;

1.24
date	2006.01.03.22.19.59;	author claudio;	state Exp;
branches;
next	1.23;

1.23
date	2005.06.13.21.16.18;	author henning;	state Exp;
branches;
next	1.22;

1.22
date	2005.03.28.15.16.45;	author henning;	state Exp;
branches;
next	1.21;

1.21
date	2005.03.28.15.03.33;	author henning;	state Exp;
branches;
next	1.20;

1.20
date	2004.11.11.16.59.47;	author claudio;	state Exp;
branches;
next	1.19;

1.19
date	2004.05.07.10.06.15;	author djm;	state Exp;
branches;
next	1.18;

1.18
date	2004.03.11.12.16.46;	author claudio;	state Exp;
branches;
next	1.17;

1.17
date	2004.02.19.23.07.00;	author claudio;	state Exp;
branches;
next	1.16;

1.16
date	2004.02.08.23.44.57;	author henning;	state Exp;
branches;
next	1.15;

1.15
date	2004.02.04.09.18.03;	author claudio;	state Exp;
branches;
next	1.14;

1.14
date	2004.02.04.09.07.44;	author claudio;	state Exp;
branches;
next	1.13;

1.13
date	2004.01.26.14.42.47;	author henning;	state Exp;
branches;
next	1.12;

1.12
date	2004.01.05.02.55.28;	author espie;	state Exp;
branches;
next	1.11;

1.11
date	2004.01.02.00.04.07;	author deraadt;	state Exp;
branches;
next	1.10;

1.10
date	2004.01.01.23.53.43;	author henning;	state Exp;
branches;
next	1.9;

1.9
date	2004.01.01.23.49.10;	author henning;	state Exp;
branches;
next	1.8;

1.8
date	2004.01.01.23.46.47;	author henning;	state Exp;
branches;
next	1.7;

1.7
date	2003.12.23.17.06.32;	author henning;	state Exp;
branches;
next	1.6;

1.6
date	2003.12.22.15.22.13;	author henning;	state Exp;
branches;
next	1.5;

1.5
date	2003.12.22.00.10.33;	author henning;	state Exp;
branches;
next	1.4;

1.4
date	2003.12.20.20.46.08;	author henning;	state Exp;
branches;
next	1.3;

1.3
date	2003.12.20.15.10.33;	author henning;	state Exp;
branches;
next	1.2;

1.2
date	2003.12.17.12.34.06;	author henning;	state Exp;
branches;
next	1.1;

1.1
date	2003.12.17.11.46.54;	author henning;	state Exp;
branches;
next	;


desc
@@


1.32
log
@undo unintentional commits
@
text
@#	$OpenBSD: Makefile,v 1.31 2017/08/21 14:41:22 phessler Exp $

PROG=	bgpd
SRCS=	bgpd.c session.c log.c logmsg.c parse.y config.c \
	rde.c rde_rib.c rde_decide.c rde_prefix.c mrt.c kroute.c \
	control.c pfkey.c rde_update.c rde_attr.c printconf.c \
	rde_filter.c pftable.c name2id.c util.c carp.c timer.c
CFLAGS+= -Wall -I${.CURDIR}
CFLAGS+= -Wstrict-prototypes -Wmissing-prototypes
CFLAGS+= -Wmissing-declarations
CFLAGS+= -Wshadow -Wpointer-arith -Wcast-qual
CFLAGS+= -Wsign-compare
YFLAGS=
LDADD+=	-lutil
DPADD+= ${LIBUTIL}
MAN= bgpd.8 bgpd.conf.5

.include <bsd.prog.mk>
@


1.31
log
@When 'enforce neighbor-as no' is set, don't do a config-time check for the neighbor-as, as it is dynamic.
@
text
@d1 1
a1 1
#	$OpenBSD: Makefile,v 1.30 2016/09/02 14:00:29 benno Exp $
a7 1
SRCS+=	rde_table.c
@


1.30
log
@work on making log.c similar in all daemons:

move daemon-local functions into new logmsg.c, and reduce
the (mostly whitespace) differences so that log.c's can be diffed easily.

ok claudio@@, feedback from henning@@, deraadt@@, reyk@@
@
text
@d1 1
a1 1
#	$OpenBSD: Makefile,v 1.29 2010/05/26 16:44:32 nicm Exp $
d8 1
@


1.29
log
@Move imsg into libutil and add a man page.

Minor bump for libutil.

Previous versions of this diff and man page looked at by various people.

"you should just commit" deraadt
@
text
@d1 1
a1 1
#	$OpenBSD: Makefile,v 1.28 2009/06/25 14:14:54 deraadt Exp $
d4 1
a4 1
SRCS=	bgpd.c session.c log.c parse.y config.c \
@


1.28
log
@incorrect .PATH setting, discovered with nicm
@
text
@d1 1
a1 1
#	$OpenBSD: Makefile,v 1.27 2007/12/20 17:08:47 henning Exp $
d4 1
a4 1
SRCS=	bgpd.c buffer.c session.c log.c parse.y config.c imsg.c \
d14 2
@


1.27
log
@rework timers.
stop changing tienmr values directly, always use new
timer_(get/set/stop/running) functions. preparation for more to come :)
ok claudio
@
text
@d1 1
a1 3
#	$OpenBSD: Makefile,v 1.26 2006/12/08 22:31:15 itojun Exp $

.PATH:		${.CURDIR}/..
@


1.26
log
@no need for KAME_SCOPEID; just check __KAME__.
@
text
@d1 1
a1 1
#	$OpenBSD: Makefile,v 1.25 2006/06/17 14:06:09 henning Exp $
d9 1
a9 1
	rde_filter.c pftable.c name2id.c util.c carp.c
@


1.25
log
@implement carp demotion control for bgpd.
sessions can be configured to modify the carp demotion counter for a
given interface group (usually, "carp", which has all carp interfaces)
when the session is not established. once the session is established for
60 seconds, the demotion is cleared.
this, used correctly, can prevent a bgpd-box which lost all sessions (and
thus has no routes) to be carp master, while the backup has sessions.
thought through and partially hacked on a drive from calgary to vancouver
with ryan, ok claudio
@
text
@d1 1
a1 1
#	$OpenBSD: Makefile,v 1.24 2006/01/03 22:19:59 claudio Exp $
a16 3

# kame scopeid hack
CPPFLAGS+=-DKAME_SCOPEID
@


1.24
log
@Move functions shared with bgpctl into new file util.c. Simplifies the
link between bgpctl and bgpd mostly because of rde_attr.c.
@
text
@d1 1
a1 1
#	$OpenBSD: Makefile,v 1.23 2005/06/13 21:16:18 henning Exp $
d9 1
a9 1
	rde_filter.c pftable.c name2id.c util.c
@


1.23
log
@route label support, kroute part and ID allocator as well as the internal
interface changes. support in the filter language and rde to come. claudio ok
@
text
@d1 1
a1 1
#	$OpenBSD: Makefile,v 1.22 2005/03/28 15:16:45 henning Exp $
d9 1
a9 1
	rde_filter.c pftable.c name2id.c
@


1.22
log
@ewps, this was not supposed to creep in
@
text
@d1 1
a1 1
#	$OpenBSD: Makefile,v 1.21 2005/03/28 15:03:33 henning Exp $
d9 1
a9 1
	rde_filter.c pftable.c
@


1.21
log
@free rules_l if the initial config file parse fails
@
text
@d1 1
a1 1
#	$OpenBSD: Makefile,v 1.20 2004/11/11 16:59:47 claudio Exp $
d9 1
a9 1
	rde_filter.c pftable.c leak.c
@


1.20
log
@Unbreak peer_localaddr() because Link Local Addresses reported by
getifaddrs() have the scope id added to the address and so fuck up in the
compare later. This part has bin stolen from ifconfig/ifconfig.c and shows
the beauty of IPv6. Thank you KAME.
disgusting but OK henning@@
@
text
@d1 1
a1 1
#	$OpenBSD: Makefile,v 1.19 2004/05/07 10:06:15 djm Exp $
d9 1
a9 1
	rde_filter.c pftable.c
@


1.19
log
@add a filter option to dump prefixes learned in UPDATEs into a PF table,
intended for building realtime BGP blacklists (e.g. with spamd);
ok claudio & henning
@
text
@d1 1
a1 1
#	$OpenBSD: Makefile,v 1.18 2004/03/11 12:16:46 claudio Exp $
d17 3
@


1.18
log
@Type in Makefile. CLFAGS != CFLAGS and we don't want -Wredundant-decls the
standard include files are full of redundant declarations. OK henning@@
@
text
@d1 1
a1 1
#	$OpenBSD: Makefile,v 1.17 2004/02/19 23:07:00 claudio Exp $
d8 2
a9 1
	control.c pfkey.c rde_update.c rde_attr.c printconf.c rde_filter.c
@


1.17
log
@Add support for basic filters. Nothing optimized and it has some issues but
this is a huge step forward. OK henning@@
@
text
@d1 1
a1 1
#	$OpenBSD: Makefile,v 1.16 2004/02/08 23:44:57 henning Exp $
d11 1
a11 1
CLFAGS+= -Wmissing-declarations -Wredundant-decls
@


1.16
log
@factor out functions to print the configuration (rules only for now)
will become more and needed by bgpctl too
@
text
@d1 1
a1 1
#	$OpenBSD: Makefile,v 1.15 2004/02/04 09:18:03 claudio Exp $
d8 1
a8 1
	control.c pfkey.c rde_update.c rde_attr.c printconf.c
@


1.15
log
@Move BGP path attribute handling functions in a own file. henning@@ conceptual ok
@
text
@d1 1
a1 1
#	$OpenBSD: Makefile,v 1.14 2004/02/04 09:07:44 claudio Exp $
d8 1
a8 1
	control.c pfkey.c rde_update.c rde_attr.c
@


1.14
log
@Move the update generation into a separate file. The update generation has
nothing to do with the decision process. henning@@ "conceptual ok ;-)"
@
text
@d1 1
a1 1
#	$OpenBSD: Makefile,v 1.13 2004/01/26 14:42:47 henning Exp $
d8 1
a8 1
	control.c pfkey.c rde_update.c
@


1.13
log
@first cut at tcpmd5 setup seupport from within bgpd. works so far.
with help from hshoexer@@ and markus@@
ok claudio@@ hshoexer@@ markus@@
@
text
@d1 1
a1 1
#	$OpenBSD: Makefile,v 1.12 2004/01/05 02:55:28 espie Exp $
d8 1
a8 1
	control.c pfkey.c
@


1.12
log
@include path fixes for gcc3.
tests otto@@, okay millert@@
@
text
@d1 1
a1 1
#	$OpenBSD: Makefile,v 1.11 2004/01/02 00:04:07 deraadt Exp $
d8 1
a8 1
	control.c
@


1.11
log
@compile like it used to
@
text
@d1 1
a1 1
#	$OpenBSD: Makefile,v 1.8 2004/01/01 23:46:47 henning Exp $
d9 1
a9 1
CFLAGS+= -Wall
@


1.10
log
@add bgpdctl
@
text
@d1 1
a1 1
#	$OpenBSD: Makefile,v 1.9 2004/01/01 23:49:10 henning Exp $
d3 1
a3 1
SUBDIR=	bgpd bgpdctl
d5 13
a17 1
.include <bsd.subdir.mk>
@


1.9
log
@prepare for bgpdctl
@
text
@d1 1
a1 1
#	$OpenBSD$
d3 1
a3 1
SUBDIR=	bgpd
@


1.8
log
@listen on a AF_LOCAL socket for imsgs too.
only implemented type yet is IMSG_CTL_SHOW_NEIGHBOR which sends back
the struct peer for all neighbors.
will be used by bgpdctl
@
text
@d1 1
a1 1
#	$OpenBSD: Makefile,v 1.7 2003/12/23 17:06:32 henning Exp $
d3 1
a3 1
.PATH:		${.CURDIR}/..
d5 1
a5 13
PROG=	bgpd
SRCS=	bgpd.c buffer.c session.c log.c parse.y config.c imsg.c \
	rde.c rde_rib.c rde_decide.c rde_prefix.c mrt.c kroute.c \
	control.c
CFLAGS+= -Wall
CFLAGS+= -Wstrict-prototypes -Wmissing-prototypes
CLFAGS+= -Wmissing-declarations -Wredundant-decls
CFLAGS+= -Wshadow -Wpointer-arith -Wcast-qual
CFLAGS+= -Wsign-compare
YFLAGS=
MAN= bgpd.8 bgpd.conf.5

.include <bsd.prog.mk>
@


1.7
log
@bloody attempt at the other manpage.
this time with (non-bloody) help from jmc@@
@
text
@d1 3
a3 1
#	$OpenBSD: Makefile,v 1.6 2003/12/22 15:22:13 henning Exp $
d7 2
a8 1
	rde.c rde_rib.c rde_decide.c rde_prefix.c mrt.c kroute.c
a15 2

CFLAGS+=	-Wall
@


1.6
log
@o add low-level functions for adding/chaining/removing kernel routes
o define new imsg types for this
o process these imsgs in the parent process

now "only" debugging and the rde sending these messages is missing.

ok claudio@@
@
text
@d1 1
a1 1
#	$OpenBSD: Makefile,v 1.5 2003/12/22 00:10:33 henning Exp $
d12 1
a12 1
MAN= bgpd.8
@


1.5
log
@my bloody attempt at a manpage. to be fleshed out.
@
text
@d1 1
a1 1
#	$OpenBSD: Makefile,v 1.4 2003/12/20 20:46:08 henning Exp $
d5 1
a5 1
	rde.c rde_rib.c rde_decide.c rde_prefix.c mrt.c
@


1.4
log
@zap -Werror and -Wcast-align
@
text
@d1 1
a1 1
#	$OpenBSD: Makefile,v 1.3 2003/12/20 15:10:33 henning Exp $
d12 1
a12 1
NOMAN=
@


1.3
log
@better set of warning opts
@
text
@d1 1
a1 1
#	$OpenBSD: Makefile,v 1.2 2003/12/17 12:34:06 henning Exp $
d9 1
a9 1
CFLAGS+= -Wshadow -Wpointer-arith -Wcast-qual -Wcast-align
a10 1
CFLAGS+= -Werror
@


1.2
log
@oups, kill (then helpful) shit from the time when it live out of the tree...
noticed by Dries Schellekens <gwyllion@@ace.ulyssis.org>
@
text
@d1 1
a1 1
#	$OpenBSD: Makefile,v 1.1 2003/12/17 11:46:54 henning Exp $
d6 5
a10 4
CFLAGS+= -Wall -Wmissing-prototypes -Wno-uninitialized
CFLAGS+= -Wstrict-prototypes
CFLAGS+= -Wreturn-type -Wcast-qual -Wswitch
CFLAGS+= -Wpointer-arith -Wshadow
@


1.1
log
@welcome, bgpd
started by me some time ago with moral support from theo, the proceeded up to
the point where the session engine worked correctly. claudio jeker joined
then and did a lot of work in the RDE.
it is not particulary usefull as application right now as parts are still
missing but is imported to enable more people to work on it.
status:
BGP sessions get established fine, OPEN messages and then KEEPALIVEs
exchanged etc. session FSM works fine; NOTIFICATIONs are handled fine, and
all connection drops etc I provoked get handled fine.
Incoming UPDATE messgages are parsed well and the data entered to the RIB,
the decision process is not yet there, neither is outgoing UPDATEs or sync
to the kernel routing table.

not connected to the builds yet.
@
text
@d1 1
a1 1
#	$OpenBSD$
a16 5

publish:
	-rm ${.CURDIR}/*~
	-cp ${.CURDIR}/* /var/www/www/bgpd/
	-scp ${.CURDIR}/* henning@@cvs.openbsd.org:~/bgpd/
@

