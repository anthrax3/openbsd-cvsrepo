head	1.53;
access;
symbols
	OPENBSD_6_1:1.52.0.4
	OPENBSD_6_1_BASE:1.52
	OPENBSD_6_0:1.48.0.14
	OPENBSD_6_0_BASE:1.48
	OPENBSD_5_9:1.48.0.8
	OPENBSD_5_9_BASE:1.48
	OPENBSD_5_8:1.48.0.10
	OPENBSD_5_8_BASE:1.48
	OPENBSD_5_7:1.48.0.2
	OPENBSD_5_7_BASE:1.48
	OPENBSD_5_6:1.48.0.6
	OPENBSD_5_6_BASE:1.48
	OPENBSD_5_5:1.48.0.4
	OPENBSD_5_5_BASE:1.48
	OPENBSD_5_4:1.47.0.2
	OPENBSD_5_4_BASE:1.47
	OPENBSD_5_3:1.46.0.2
	OPENBSD_5_3_BASE:1.46
	OPENBSD_5_2:1.44.0.2
	OPENBSD_5_2_BASE:1.44
	OPENBSD_5_1_BASE:1.40
	OPENBSD_5_1:1.40.0.2
	OPENBSD_5_0:1.39.0.4
	OPENBSD_5_0_BASE:1.39
	OPENBSD_4_9:1.39.0.2
	OPENBSD_4_9_BASE:1.39
	OPENBSD_4_8:1.38.0.2
	OPENBSD_4_8_BASE:1.38
	OPENBSD_4_7:1.34.0.2
	OPENBSD_4_7_BASE:1.34
	OPENBSD_4_6:1.28.0.6
	OPENBSD_4_6_BASE:1.28
	OPENBSD_4_5:1.28.0.2
	OPENBSD_4_5_BASE:1.28
	OPENBSD_4_4:1.27.0.6
	OPENBSD_4_4_BASE:1.27
	OPENBSD_4_3:1.27.0.4
	OPENBSD_4_3_BASE:1.27
	OPENBSD_4_2:1.27.0.2
	OPENBSD_4_2_BASE:1.27
	OPENBSD_4_1:1.22.0.2
	OPENBSD_4_1_BASE:1.22
	OPENBSD_4_0:1.21.0.2
	OPENBSD_4_0_BASE:1.21
	OPENBSD_3_9:1.16.0.2
	OPENBSD_3_9_BASE:1.16
	OPENBSD_3_8:1.13.0.6
	OPENBSD_3_8_BASE:1.13
	OPENBSD_3_7:1.13.0.4
	OPENBSD_3_7_BASE:1.13
	OPENBSD_3_6:1.13.0.2
	OPENBSD_3_6_BASE:1.13
	OPENBSD_3_5:1.8.0.2
	OPENBSD_3_5_BASE:1.8;
locks; strict;
comment	@.\" @;


1.53
date	2017.05.26.20.55.30;	author phessler;	state Exp;
branches;
next	1.52;
commitid	p82SYNnm0pVdbRCn;

1.52
date	2017.02.19.11.38.24;	author phessler;	state Exp;
branches;
next	1.51;
commitid	PoMAZySPUf8ol0Fo;

1.51
date	2017.01.13.18.59.12;	author phessler;	state Exp;
branches;
next	1.50;
commitid	3Jvf15B19ysa8i2W;

1.50
date	2016.11.10.10.01.33;	author phessler;	state Exp;
branches;
next	1.49;
commitid	jM66jpEW5e2WAw66;

1.49
date	2016.10.14.16.05.35;	author phessler;	state Exp;
branches;
next	1.48;
commitid	Ai7XVOgXw9ZLovz1;

1.48
date	2013.08.14.06.32.36;	author jmc;	state Exp;
branches;
next	1.47;

1.47
date	2013.06.14.19.49.19;	author lum;	state Exp;
branches;
next	1.46;

1.46
date	2012.09.26.16.19.44;	author jmc;	state Exp;
branches;
next	1.45;

1.45
date	2012.08.24.20.13.03;	author jmc;	state Exp;
branches;
next	1.44;

1.44
date	2012.07.07.12.29.18;	author jmc;	state Exp;
branches;
next	1.43;

1.43
date	2012.07.07.08.22.57;	author claudio;	state Exp;
branches;
next	1.42;

1.42
date	2012.07.04.20.43.26;	author claudio;	state Exp;
branches;
next	1.41;

1.41
date	2012.06.10.11.16.08;	author claudio;	state Exp;
branches;
next	1.40;

1.40
date	2011.09.17.16.29.44;	author claudio;	state Exp;
branches;
next	1.39;

1.39
date	2010.10.15.07.45.32;	author claudio;	state Exp;
branches;
next	1.38;

1.38
date	2010.06.27.19.53.34;	author claudio;	state Exp;
branches;
next	1.37;

1.37
date	2010.05.24.19.44.23;	author jmc;	state Exp;
branches;
next	1.36;

1.36
date	2010.05.17.17.46.22;	author jmc;	state Exp;
branches;
next	1.35;

1.35
date	2010.05.17.15.49.29;	author claudio;	state Exp;
branches;
next	1.34;

1.34
date	2010.02.23.21.30.40;	author schwarze;	state Exp;
branches;
next	1.33;

1.33
date	2009.12.16.15.40.55;	author claudio;	state Exp;
branches;
next	1.32;

1.32
date	2009.10.26.09.58.19;	author claudio;	state Exp;
branches;
next	1.31;

1.31
date	2009.09.22.14.07.53;	author claudio;	state Exp;
branches;
next	1.30;

1.30
date	2009.09.02.08.06.42;	author claudio;	state Exp;
branches;
next	1.29;

1.29
date	2009.08.06.08.53.11;	author claudio;	state Exp;
branches;
next	1.28;

1.28
date	2009.01.13.23.01.36;	author sthen;	state Exp;
branches;
next	1.27;

1.27
date	2007.05.31.19.20.22;	author jmc;	state Exp;
branches;
next	1.26;

1.26
date	2007.04.26.16.22.51;	author jmc;	state Exp;
branches;
next	1.25;

1.25
date	2007.04.26.14.16.45;	author claudio;	state Exp;
branches;
next	1.24;

1.24
date	2007.04.24.08.51.53;	author claudio;	state Exp;
branches;
next	1.23;

1.23
date	2007.03.16.14.01.19;	author claudio;	state Exp;
branches;
next	1.22;

1.22
date	2006.12.12.21.14.22;	author jmc;	state Exp;
branches;
next	1.21;

1.21
date	2006.06.19.20.48.36;	author jmc;	state Exp;
branches;
next	1.20;

1.20
date	2006.06.19.12.06.24;	author henning;	state Exp;
branches;
next	1.19;

1.19
date	2006.06.17.14.06.09;	author henning;	state Exp;
branches;
next	1.18;

1.18
date	2006.03.23.20.20.45;	author claudio;	state Exp;
branches;
next	1.17;

1.17
date	2006.03.15.12.51.40;	author claudio;	state Exp;
branches;
next	1.16;

1.16
date	2006.01.24.17.55.09;	author jmc;	state Exp;
branches;
next	1.15;

1.15
date	2006.01.24.15.06.29;	author claudio;	state Exp;
branches;
next	1.14;

1.14
date	2006.01.24.10.21.14;	author henning;	state Exp;
branches;
next	1.13;

1.13
date	2004.07.13.23.01.02;	author jmc;	state Exp;
branches;
next	1.12;

1.12
date	2004.07.13.19.53.01;	author jmc;	state Exp;
branches;
next	1.11;

1.11
date	2004.07.09.11.01.22;	author henning;	state Exp;
branches;
next	1.10;

1.10
date	2004.06.23.00.11.27;	author claudio;	state Exp;
branches;
next	1.9;

1.9
date	2004.05.23.22.32.42;	author jmc;	state Exp;
branches;
next	1.8;

1.8
date	2004.02.05.01.33.57;	author mcbride;	state Exp;
branches;
next	1.7;

1.7
date	2004.01.06.03.43.50;	author henning;	state Exp;
branches;
next	1.6;

1.6
date	2004.01.05.12.41.47;	author henning;	state Exp;
branches;
next	1.5;

1.5
date	2004.01.02.09.12.27;	author jmc;	state Exp;
branches;
next	1.4;

1.4
date	2003.12.23.17.08.54;	author henning;	state Exp;
branches;
next	1.3;

1.3
date	2003.12.23.12.17.33;	author henning;	state Exp;
branches;
next	1.2;

1.2
date	2003.12.22.15.07.05;	author henning;	state Exp;
branches;
next	1.1;

1.1
date	2003.12.22.00.10.33;	author henning;	state Exp;
branches;
next	;


desc
@@


1.53
log
@AS 0 is special and should be considered an error.

Drop the session if it shows during OPEN or CAPA, or mark as invalid if
it is part of an Update.

required by RFC 7607

man page OK jmc@@
OK florian@@ benno@@ claudio@@
@
text
@.\" $OpenBSD: bgpd.8,v 1.52 2017/02/19 11:38:24 phessler Exp $
.\"
.\" Copyright (c) 2003, 2004 Henning Brauer <henning@@openbsd.org>
.\"
.\" Permission to use, copy, modify, and distribute this software for any
.\" purpose with or without fee is hereby granted, provided that the above
.\" copyright notice and this permission notice appear in all copies.
.\"
.\" THE SOFTWARE IS PROVIDED "AS IS" AND THE AUTHOR DISCLAIMS ALL WARRANTIES
.\" WITH REGARD TO THIS SOFTWARE INCLUDING ALL IMPLIED WARRANTIES OF
.\" MERCHANTABILITY AND FITNESS. IN NO EVENT SHALL THE AUTHOR BE LIABLE FOR
.\" ANY SPECIAL, DIRECT, INDIRECT, OR CONSEQUENTIAL DAMAGES OR ANY DAMAGES
.\" WHATSOEVER RESULTING FROM LOSS OF USE, DATA OR PROFITS, WHETHER IN AN
.\" ACTION OF CONTRACT, NEGLIGENCE OR OTHER TORTIOUS ACTION, ARISING OUT OF
.\" OR IN CONNECTION WITH THE USE OR PERFORMANCE OF THIS SOFTWARE.
.\"
.Dd $Mdocdate: February 19 2017 $
.Dt BGPD 8
.Os
.Sh NAME
.Nm bgpd
.Nd Border Gateway Protocol daemon
.Sh SYNOPSIS
.Nm bgpd
.Bk -words
.Op Fl cdnv
.Op Fl D Ar macro Ns = Ns Ar value
.Op Fl f Ar file
.Ek
.Sh DESCRIPTION
.Nm
is a Border Gateway Protocol
.Pq BGP
daemon which manages the network routing tables.
Its main purpose is to exchange information
concerning
.Qq network reachability
with other BGP systems.
.Nm
uses the Border Gateway Protocol, Version 4,
as described in RFC 4271.
.Pp
BGP is an exterior gateway protocol using a multiple step decision process
to find the best path.
Advanced filtering can be used to influence the route
decision for traffic engineering.
The session engine of
.Nm
is responsible for maintaining the TCP session with each neighbor.
Updates are passed to the Route Decision Engine (RDE) where the paths
are filtered and used to compute a Routing Information Base (RIB).
The parent process is responsible for keeping the RIB in sync with
the kernel routing table.
.Pp
The route decision process selects the best path by evaluating all paths to
the same destination.
The decision process continues to the next step if paths have equal attributes.
Paths that are less preferred are taken out of consideration until there is
only one path left.
.Bl -enum -width 42 -offset bula
.It
All paths with errors or loops are not eligible.
.It
Paths with an unreachable nexthop are not eligible.
After this step all remaining paths are valid.
.It
The path with the highest
.Em LOCAL_PREF
is selected.
.It
The path with the shortest
.Em AS path
attribute is selected.
.It
The
.Em ORIGIN
attribute is compared.
The order is IGP before EGP before incomplete origins.
.It
The path with the lowest
.Em MULTI_EXIT_DISC
metric is selected.
Normally, this value is only considered when choosing between multiple
routes sent by the same neighbouring AS.
However, if
.Dq Li rde med compare always
is set in the configuration, the metric is compared for routes sent by any AS.
.It
Comparison of the BGP session type.
Paths learned over an external (EBGP) session are preferred over those
learned via an internal (IBGP) session.
.It
The path with the lowest local
.Em weight
is selected.
.It
If
.Dq Li rde route-age evaluate
is set then the oldest path is selected.
.It
The path coming from the neighbor with the lowest
.Em BGP ID
wins.
If the
.Em ORIGINATOR_ID
attribute is present that value will be used in the comparison instead.
.It
The path with the shortest
.Em CLUSTER_LIST
attribute is selected.
If it is not present then a length of 0 is used in the comparison.
.It
The path coming from the peer with the lowest IP address is selected.
IPv4 sessions will be preferred over IPv6 ones.
.It
In case of locally announced prefixes
.Nm
will prefer statically set prefixes over dynamically inserted ones.
.El
.Pp
Attributes set by filters can be used to tip the decision process to prefer
particular paths over others.
This can be achieved by changing the
.Em localpref ,
.Em med ,
or
.Em weight
attributes.
AS path prepending or changing the
.Em med
or
.Em origin
attribute can be used to influence the routing behaviour on remote systems.
.Pp
.Nm
is usually started at boot time, and can be enabled by
setting the following in
.Pa /etc/rc.conf.local :
.Pp
.Dl bgpd_flags=\&"\&"
.Pp
See
.Xr rc 8
and
.Xr rc.conf 8
for more information on the boot process
and enabling daemons.
.Pp
When
.Nm
starts up, it reads settings from a configuration file,
typically
.Xr bgpd.conf 5 .
A running
.Nm
process can be controlled using the
.Xr bgpctl 8
utility.
.Pp
The options are as follows:
.Bl -tag -width "-f fileXXX"
.It Fl c
Force
.Nm
to do
.Xr carp 4
demotion at startup when the
.Em demote
functionality is used.
Normally,
.Nm
will only do demotion at startup when the demotion counter for the group
in question is already greater than 0.
.Nm
will start handling demotion after all sessions with demotion configured for
the given group have been successfully established.
At system startup,
.Xr rc 8
has the demotion counter for the group
.Em carp
increased until after
.Nm
is started, so this option should
.Em not
be used in
.Xr rc.conf 8 .
.It Fl D Ar macro Ns = Ns Ar value
Define
.Ar macro
to be set to
.Ar value
on the command line.
Overrides the definition of
.Ar macro
in the configuration file.
.It Fl d
Do not daemonize.
If this option is specified,
.Nm
will run in the foreground and log to
.Em stderr .
.It Fl f Ar file
Use
.Ar file
as the configuration file,
instead of the default
.Pa /etc/bgpd.conf .
.It Fl n
Configtest mode.
Only check the configuration file for validity.
.It Fl v
Produce more verbose output.
.El
.Sh FILES
.Bl -tag -width "/var/run/bgpd.sockXXX" -compact
.It Pa /etc/bgpd.conf
default
.Nm
configuration file
.It Pa /var/run/bgpd.sock
default
.Nm
control socket
.El
.Sh SEE ALSO
.Xr bgpd.conf 5 ,
.Xr bgpctl 8 ,
.Xr bgplg 8 ,
.Xr bgplgsh 8
.Sh STANDARDS
.Rs
.%A R. Chandra
.%A P. Traina
.%A "T. Li"
.%D August 1996
.%R RFC 1997
.%T BGP Communities Attribute
.Re
.Pp
.Rs
.%A A. Heffernan
.%D August 1998
.%R RFC 2385
.%T Protection of BGP Sessions via the TCP MD5 Signature Option
.Re
.Pp
.Rs
.%A P. Marques
.%A F. Dupont
.%D March 1999
.%R RFC 2545
.%T Use of BGP-4 Multiprotocol Extensions for IPv6 Inter-Domain Routing
.Re
.Pp
.Rs
.%A E. Chen
.%D September 2000
.%R RFC 2918
.%T Route Refresh Capability for BGP-4
.Re
.Pp
.Rs
.%A G. Huston
.%D April 2004
.%R RFC 3765
.%T NOPEER Community for Border Gateway Protocol (BGP) Route Scope Control
.Re
.Pp
.Rs
.%A Y. Rekhter
.%A "T. Li"
.%A S. Hares
.%D January 2006
.%R RFC 4271
.%T A Border Gateway Protocol 4 (BGP-4)
.Re
.Pp
.Rs
.%A S. Sangli
.%A D. Tappan
.%A Y. Rekhter
.%D February 2006
.%R RFC 4360
.%T BGP Extended Communities Attribute
.Re
.Pp
.Rs
.%A E. Rosen
.%A Y. Rekhter
.%D February 2006
.%R RFC 4364
.%T BGP/MPLS IP Virtual Private Networks (VPNs)
.Re
.Pp
.Rs
.%A T. Bates
.%A E. Chen
.%A R. Chandra
.%D April 2006
.%R RFC 4456
.%T "BGP Route Reflection: An Alternative to Full Mesh Internal BGP (IBGP)"
.Re
.Pp
.Rs
.%A E. Chen
.%A V. Gillet
.%D April 2006
.%R RFC 4486
.%T Subcodes for BGP Cease Notification Message
.Re
.Pp
.Rs
.%A T. Bates
.%A R. Chandra
.%A D. Katz
.%A Y. Rekhter
.%D January 2007
.%R RFC 4760
.%T Multiprotocol Extensions for BGP-4
.Re
.Pp
.Rs
.%A Q. Vohra
.%A E. Chen
.%D May 2007
.%R RFC 4893
.%T BGP Support for Four-octet AS Number Space
.Re
.Pp
.Rs
.%A V. Gill
.%A J. Heasley
.%A D. Meyer
.%A P. Savola
.%A C. Pignatoro
.%D October 2007
.%R RFC 5082
.%T The Generalized TTL Security Mechanism (GTSM)
.Re
.Pp
.Rs
.%A J. Scudder
.%A R. Chandra
.%D February 2009
.%R RFC 5492
.%T Capabilities Advertisement with BGP-4
.Re
.Pp
.Rs
.%A E. Chen
.%A J. Scudder
.%A P. Mohapatra
.%A K. Patel
.%D August 2015
.%R RFC 7606
.%T Revised Error Handling for BGP UPDATE Messages
.Re
.Pp
.Rs
.%A W. Kumari
.%A R. Bush
.%A H. Schiller
.%A K. Patel
.%D August 2015
.%R RFC 7607
.%T Codification of AS 0 Processing
.Re
.Pp
.Rs
.%D August 2011
.%R draft-ietf-grow-mrt-17
.%T MRT routing information export format
.Re
.Pp
.Rs
.%A J. Dong
.%A M. Chen
.%A A. Suryanarayana
.%D May 2012
.%R RFC 6608
.%T Subcodes for BGP Finite State Machine Error
.Re
.Pp
.Rs
.%A J. Heitz
.%A J. Snijders
.%A K. Patel
.%A I. Bagdonas
.%A N. Hilliard
.%D February 2017
.%R RFC 8092
.%T BGP Large Communities Attribute
.Re
.Pp
.Rs
.%A J. Snijders
.%A J. Heitz
.%A J. Scudder
.%D January 2017
.%R draft-ietf-idr-shutdown
.%T BGP Administrative Shutdown Communication
.Re
.Sh HISTORY
The
.Nm
program first appeared in
.Ox 3.5 .
@


1.52
log
@draft-ietf-idr-large-community has been published as RFC 8092
@
text
@d1 1
a1 1
.\" $OpenBSD: bgpd.8,v 1.51 2017/01/13 18:59:12 phessler Exp $
d17 1
a17 1
.Dd $Mdocdate: January 13 2017 $
d357 10
@


1.51
log
@Add support for draft-ietf-idr-shutdown

    BGP state = Idle, marked down with shutdown reason "goodbye, we are
    upgrading to openbsd 6.1", down for 00:00:17

developed by Peter van Dijk <peter.van.dijk@@powerdns.com> and Job
Snijders <job@@ntt.net>, thank you!

OK benno@@
@
text
@d1 1
a1 1
.\" $OpenBSD: bgpd.8,v 1.50 2016/11/10 10:01:33 phessler Exp $
d17 1
a17 1
.Dd $Mdocdate: January 9 2017 $
d375 1
a376 1
.%A J. Heitz
d380 2
a381 2
.%D January 2017
.%R draft-ietf-idr-large-community
@


1.50
log
@update reference to the RFC now numbered 7606

reminded by jmc@@
@
text
@d1 1
a1 1
.\" $OpenBSD: bgpd.8,v 1.49 2016/10/14 16:05:35 phessler Exp $
d17 1
a17 1
.Dd $Mdocdate: October 14 2016 $
a240 11
.%A J. Snijders
.%A J. Heitz
.%A K. Patel
.%A I. Bagdonas
.%A A. Simpson
.%D September 2016
.%R draft-ietf-idr-large-community
.%T Large BGP Communities Attribute
.Re
.Pp
.Rs
d372 20
@


1.49
log
@Add support for draft-ietf-idr-large-community

Joint work with Job Snijders, many thanks!
OK benno@@ deraadt@@
@
text
@d1 1
a1 1
.\" $OpenBSD: bgpd.8,v 1.48 2013/08/14 06:32:36 jmc Exp $
d17 1
a17 1
.Dd $Mdocdate: August 14 2013 $
d361 7
a367 3
.%D April 2009
.%R draft-ietf-idr-optional-transitive-00
.%T Error Handling for Optional Transitive BGP Attributes
@


1.48
log
@no longer any need to quote macro lines with >9 args;
From: Jan Stary
@
text
@d1 1
a1 1
.\" $OpenBSD: bgpd.8,v 1.47 2013/06/14 19:49:19 lum Exp $
d17 1
a17 1
.Dd $Mdocdate: June 14 2013 $
d238 11
@


1.47
log
@grammar. ok jmc@@
@
text
@d1 1
a1 1
.\" $OpenBSD: bgpd.8,v 1.46 2012/09/26 16:19:44 jmc Exp $
d17 1
a17 1
.Dd $Mdocdate: September 26 2012 $
d22 1
a22 1
.Nd "Border Gateway Protocol daemon"
@


1.46
log
@last stage of rfc changes, using consistent Rs/Re blocks, and moving the
references into a STANDARDS section;
@
text
@d1 1
a1 1
.\" $OpenBSD: bgpd.8,v 1.45 2012/08/24 20:13:03 jmc Exp $
d17 1
a17 1
.Dd $Mdocdate: August 24 2012 $
d133 1
a133 1
attribute can be used to influencing the routing behaviour on remote systems.
@


1.45
log
@- rfc 5082 replaces rfc 3682; ok claudio
- flesh out SEE ALSO in bgpd.8
- fix a formatting warning in relayd.conf.5
@
text
@d1 1
a1 1
.\" $OpenBSD: bgpd.8,v 1.44 2012/07/07 12:29:18 jmc Exp $
d17 1
a17 1
.Dd $Mdocdate: July 7 2012 $
d230 1
d239 1
d246 1
d254 1
d261 1
d268 1
d277 1
d286 1
d294 1
d303 1
d311 1
d321 1
d329 1
d340 1
d348 1
d354 7
a367 5
.Re
.Rs
.%D August 2011
.%R draft-ietf-grow-mrt-17
.%T MRT routing information export format
@


1.44
log
@prefered -> preferred;
@
text
@d1 1
a1 1
.\" $OpenBSD: bgpd.8,v 1.43 2012/07/07 08:22:57 claudio Exp $
d231 4
a234 5
.%R RFC 4271
.%T "A Border Gateway Protocol 4 (BGP-4)"
.%D January 2006
.Re
.Rs
d236 1
a236 2
.%T "BGP Communities Attribute"
.%D August 1996
d239 2
d242 1
a242 2
.%T "Protection of BGP Sessions via the TCP MD5 Signature Option"
.%D August 1998
d245 3
d249 1
a249 2
.%T "Use of BGP-4 Multiprotocol Extensions for IPv6 Inter-Domain Routing"
.%D March 1999
d252 2
d255 1
a255 2
.%T "Route Refresh Capability for BGP-4"
.%D September 2000
d258 4
a261 3
.%R RFC 3682
.%T "The Generalized TTL Security Mechanism (GTSM)"
.%D February 2004
d264 6
a269 3
.%R RFC 3765
.%T "NOPEER Community for Border Gateway Protocol"
.%D April 2004
d272 4
d277 1
a277 2
.%T "BGP Extended Communities Attribute"
.%D February 2006
d280 3
d284 1
a284 2
.%T "BGP/MPLS IP Virtual Private Networks (VPNs)"
.%D February 2006
d287 4
d292 1
a292 2
.%T "BGP Route Reflection - An Alternative to Full Mesh IBGP"
.%D April 2006
d295 3
d299 1
a299 2
.%T "BGP Cease Notification Message Subcodes"
.%D April 2006
d302 5
d308 1
a308 2
.%T "Multiprotocol Extensions for BGP-4"
.%D January 2007
d311 3
d315 11
a325 2
.%T "BGP Support for Four-octet AS Number Space"
.%D May 2007
d328 3
d332 1
a332 2
.%T "Capabilities Advertisement with BGP-4"
.%D February 2009
d335 1
d337 1
a337 2
.%T "Error Handling for Optional Transitive BGP Attributes"
.%D April 2009
d340 4
d345 1
a345 2
.%T "Subcodes for BGP Finite State Machine Error"
.%D May 2012
d348 1
d350 1
a350 2
.%T "MRT routing information export format"
.%D August 2011
@


1.43
log
@Explain the bgpd decision process in the man page. I'm tired of looking
at the C code over and over again. With and OK sthen@@, henning@@, jmc@@
@
text
@d1 1
a1 1
.\" $OpenBSD: bgpd.8,v 1.42 2012/07/04 20:43:26 claudio Exp $
d17 1
a17 1
.Dd $Mdocdate: July 4 2012 $
d114 1
a114 1
IPv4 sessions will be prefered over IPv6 ones.
@


1.42
log
@Seems like I missed to adjust the route decision code to cover the things
that need to be checked because of route reflection. Do this now and reference
the new RR RFC in the man page. OK henning@@ sthen@@
@
text
@d1 1
a1 1
.\" $OpenBSD: bgpd.8,v 1.41 2012/06/10 11:16:08 claudio Exp $
d17 1
a17 1
.Dd $Mdocdate: June 10 2012 $
d42 92
a133 1
Please refer to that document for more information about BGP.
@


1.41
log
@Add error messages for BGP Finite State Machine Error subcodes as defined
in RFC 6608. OK henning@@ sthen@@
@
text
@d1 1
a1 1
.\" $OpenBSD: bgpd.8,v 1.40 2011/09/17 16:29:44 claudio Exp $
d17 1
a17 1
.Dd $Mdocdate: September 17 2011 $
a159 5
.%R RFC 2796
.%T "BGP Route Reflection - An Alternative to Full Mesh IBGP"
.%D April 2000
.Re
.Rs
d183 5
@


1.40
log
@Implement new mrt table dump format as specified in draft-ietf-grow-mrt.
Tested with IP and IPv6 sessions and against the libbgpdump parser.
OK henning@@
@
text
@d1 1
a1 1
.\" $OpenBSD: bgpd.8,v 1.39 2010/10/15 07:45:32 claudio Exp $
d17 1
a17 1
.Dd $Mdocdate: October 15 2010 $
d215 1
a215 1
.%R draft-ietf-idr-fsm-subcode-02
d217 1
a217 1
.%D August 2011
@


1.39
log
@Add the FSM suberrors specified in draft-ietf-idr-fsm-subcode. This
should help identifying FSM errors since the state is know known.
OK henning@@ sthen@@
@
text
@d1 1
a1 1
.\" $OpenBSD: bgpd.8,v 1.38 2010/06/27 19:53:34 claudio Exp $
d17 1
a17 1
.Dd $Mdocdate: June 27 2010 $
d215 1
a215 1
.%R draft-ietf-idr-fsm-subcode-00
d217 6
a222 1
.%D September 2010
@


1.38
log
@Instead of specifying the control sockets on the command line have them
in bgpd.conf. This allows to add/modify restricted control sockets on runtime.
Feature request by a few people how often forgot to add -r path when restarting
bgpd (including myself).
NOTE: this removes the -s and -r arguments from bgpd so pay attention when
updateing.
jajaja sthen@@, OK henning@@
@
text
@d1 1
a1 1
.\" $OpenBSD: bgpd.8,v 1.37 2010/05/24 19:44:23 jmc Exp $
d17 1
a17 1
.Dd $Mdocdate: May 24 2010 $
d213 5
@


1.37
log
@now that we can handle >9 args, put "-D name=value" on one line: it's a bit
more readable, and fixes a spacing bug we had in smtpd.8;
@
text
@d1 1
a1 1
.\" $OpenBSD: bgpd.8,v 1.36 2010/05/17 17:46:22 jmc Exp $
d17 1
a17 1
.Dd $Mdocdate: May 17 2010 $
a28 2
.Op Fl r Ar path
.Op Fl s Ar path
a119 9
.It Fl r Ar path
Open a second, restricted, control socket that
.Xr bgpctl 8
can use.
Only
.Em show
requests are allowed on this socket.
.It Fl s Ar path
Use an alternate location for the default control socket.
@


1.36
log
@tweak previous;
@
text
@d1 1
a1 1
.\" $OpenBSD: bgpd.8,v 1.35 2010/05/17 15:49:29 claudio Exp $
d27 1
a27 3
.Oo
.Fl D Ar macro Ns = Ns Ar value
.Oc
@


1.35
log
@Last bits of MPLS VPN support. Hook kernel routing tables and RIB together.
This adds a bit of new config to specify the mapping between an rdomain and
the BGP MPLS VPN instance, example:
rdomain 1 {
        descr "CUSTOMER1"
	rd 65003:1
	import-target rt 65003:3
	export-target rt 65003:1
	depend on mpe0
	network 192.168.224/24
}
The "depend on mpe0" is a but ugly but for now this is the quickest way to
figure out which interface bgp should use to insert the MPLS routes.

A big side-effect of this diff is that networks are now internally
distributed through kroute.c.
This needs some kernel changes that will follow hopefully soon.
OK henning@@
@
text
@d1 1
a1 1
.\" $OpenBSD: bgpd.8,v 1.34 2010/02/23 21:30:40 schwarze Exp $
d17 1
a17 1
.Dd $Mdocdate: February 23 2010 $
d45 1
a45 1
as described in RFC 4271/1771.
@


1.34
log
@Fix .Oo .Xo .Oc .Xc mis-nesting by just dropping the .Xo and .Xc which,
in these cases, is useless anyway.
Found by and fixing the build with mandoc;
still fine with both old and new groff.
ok jmc@@
@
text
@d1 1
a1 1
.\" $OpenBSD: bgpd.8,v 1.33 2009/12/16 15:40:55 claudio Exp $
d17 1
a17 1
.Dd $Mdocdate: December 16 2009 $
d45 1
a45 1
as described in RFC 1771.
d153 1
a153 1
.%R RFC 1771
d155 1
a155 1
.%D March 1995
d195 5
@


1.33
log
@Implement "set ext-community [delete] subtype key:value" to set and delete
extended communities as specified in RFC 4360. No matching implemented yet
and stuff like * and neighbor-as are neither supported but will be soon.
Looks good henning & sthen, manpage fixed by jmc
@
text
@d1 1
a1 1
.\" $OpenBSD: bgpd.8,v 1.32 2009/10/26 09:58:19 claudio Exp $
d17 1
a17 1
.Dd $Mdocdate: October 26 2009 $
d27 3
a29 3
.Oo Xo
.Fl D Ar macro Ns = Ns Ar value Oc
.Xc
@


1.32
log
@Add RFC2545 to the list of standarts supported by bgpd.
@
text
@d1 1
a1 1
.\" $OpenBSD: bgpd.8,v 1.31 2009/09/22 14:07:53 claudio Exp $
d17 1
a17 1
.Dd $Mdocdate: September 22 2009 $
d191 5
@


1.31
log
@Update capability code to follow RFC 5492. Unlike before multiple
capabilities are now encoded in a single capability option.
RFC conforming BGP implementations must be able to parse both the old
and the new way of the encoding (most still seem to use the old one).
bgpd still accepts both ways on reception. OK henning, sthen
@
text
@d1 1
a1 1
.\" $OpenBSD: bgpd.8,v 1.30 2009/09/02 08:06:42 claudio Exp $
d17 1
a17 1
.Dd $Mdocdate: September 2 2009 $
d166 5
@


1.30
log
@Implement all of RFC 4486 BGP Cease Notification Message Subcodes.
The other side should now see why a session was dropped. e.g:
bgpd: ... received notification: Cease, administratively down
OK henning
@
text
@d1 1
a1 1
.\" $OpenBSD: bgpd.8,v 1.29 2009/08/06 08:53:11 claudio Exp $
d17 1
a17 1
.Dd $Mdocdate: August 6 2009 $
a177 5
.%R RFC 3392
.%T "Capabilities Advertisement with BGP-4"
.%D January 1999
.Re
.Rs
d201 5
@


1.29
log
@Implement the error handling as proposed in draft-ietf-idr-optional-transitive
for optional transitive attributes. In short if the partial bit is set on
an optional transitive attribute but the attribute fails validation ignore
the attribute or mark the path as ineligible instead of killing the session
with a NOTIFICATION. Tested, input and OK sthen, OK henning
@
text
@d1 1
a1 1
.\" $OpenBSD: bgpd.8,v 1.28 2009/01/13 23:01:36 sthen Exp $
d17 1
a17 1
.Dd $Mdocdate: January 13 2009 $
d191 5
@


1.28
log
@Reference RFC 4893 instead of draft-ietf-idr-as4bytes-13.
ok claudio
@
text
@d1 1
a1 1
.\" $OpenBSD: bgpd.8,v 1.27 2007/05/31 19:20:22 jmc Exp $
d17 1
a17 1
.Dd $Mdocdate: May 31 2007 $
d201 5
@


1.27
log
@convert to new .Dd format;
@
text
@d1 1
a1 1
.\" $OpenBSD: bgpd.8,v 1.26 2007/04/26 16:22:51 jmc Exp $
d17 1
a17 1
.Dd $Mdocdate$
d198 1
a198 1
.%R draft-ietf-idr-as4bytes-13
d200 1
a200 1
.%D February 2007
@


1.26
log
@put RFC 3765 in the right place;
@
text
@d1 1
a1 1
.\" $OpenBSD: bgpd.8,v 1.25 2007/04/26 14:16:45 claudio Exp $
d17 1
a17 1
.Dd December 22, 2003
@


1.25
log
@bgpd supports RFC 2796 and 3682 so mention them with all the others.
@
text
@d1 1
a1 1
.\" $OpenBSD: bgpd.8,v 1.24 2007/04/24 08:51:53 claudio Exp $
d183 5
a190 5
.Re
.Rs
.%R RFC 3682
.%T "The Generalized TTL Security Mechanism (GTSM)"
.%D February 2004
@


1.24
log
@Add draft-ietf-idr-as4bytes-13 to the see also list.
@
text
@d1 1
a1 1
.\" $OpenBSD: bgpd.8,v 1.23 2007/03/16 14:01:19 claudio Exp $
d168 5
d186 5
@


1.23
log
@Multiprotocol Extensions for BGP-4 is now RFC 4760
@
text
@d1 1
a1 1
.\" $OpenBSD: bgpd.8,v 1.22 2006/12/12 21:14:22 jmc Exp $
d186 5
@


1.22
log
@Xr bgplg and bgplgsh;
@
text
@d1 1
a1 1
.\" $OpenBSD: bgpd.8,v 1.21 2006/06/19 20:48:36 jmc Exp $
a167 5
.%R RFC 2858
.%T "Multiprotocol Extensions for BGP-4"
.%D June 2000
.Re
.Rs
d181 5
@


1.21
log
@add -c to usage() and synopsis;
@
text
@d1 1
a1 1
.\" $OpenBSD: bgpd.8,v 1.20 2006/06/19 12:06:24 henning Exp $
d149 3
a151 1
.Xr bgpctl 8
@


1.20
log
@if at startup a given group has carpdemote == 0, we don't do carp demotion.
now, once all sessions went to established, we start doing demotion, so
that when one drops and has dmeotion enabled, we actually demote.
ok claudio
@
text
@d1 1
a1 1
.\" $OpenBSD: bgpd.8,v 1.19 2006/06/17 14:06:09 henning Exp $
d26 1
a26 1
.Op Fl dnv
@


1.19
log
@implement carp demotion control for bgpd.
sessions can be configured to modify the carp demotion counter for a
given interface group (usually, "carp", which has all carp interfaces)
when the session is not established. once the session is established for
60 seconds, the demotion is cleared.
this, used correctly, can prevent a bgpd-box which lost all sessions (and
thus has no routes) to be carp master, while the backup has sessions.
thought through and partially hacked on a drive from calgary to vancouver
with ryan, ok claudio
@
text
@d1 1
a1 1
.\" $OpenBSD: bgpd.8,v 1.18 2006/03/23 20:20:45 claudio Exp $
d80 1
a80 1
demotion when the
d85 5
a89 2
will only do demotion when the demotion counter for the group in question
is already greater than 0.
@


1.18
log
@Simplify the -s documentation and add /var/run/bgpd.sock to the FILES list.
help from jmc@@
@
text
@d1 1
a1 1
.\" $OpenBSD: bgpd.8,v 1.17 2006/03/15 12:51:40 claudio Exp $
d75 22
@


1.17
log
@Document new -s path option to select an alternate path for the main control
socket.
@
text
@d1 1
a1 1
.\" $OpenBSD: bgpd.8,v 1.16 2006/01/24 17:55:09 jmc Exp $
d107 1
a107 3
Use an alternate location for the main control socket than
.Xr bgpctl 8
can use.
d112 1
a112 1
.Bl -tag -width "/etc/bgpd.confXXX" -compact
d117 4
@


1.16
log
@add -r to synopsis, and tweak its description a little;
@
text
@d1 1
a1 1
.\" $OpenBSD: bgpd.8,v 1.15 2006/01/24 15:06:29 claudio Exp $
d32 1
d106 4
@


1.15
log
@bgpd does not and will never support route flap damping as defined in the
mentioned RFC. Even RIPE (RIPE-229) realized that route flap damping should be
considered evil.
@
text
@d1 1
a1 1
.\" $OpenBSD: bgpd.8,v 1.14 2006/01/24 10:21:14 henning Exp $
d31 1
d99 1
a99 1
Open a second, restricted control socket that
@


1.14
log
@document -r
@
text
@d1 1
a1 1
.\" $OpenBSD: bgpd.8,v 1.13 2004/07/13 23:01:02 jmc Exp $
a130 5
.Re
.Rs
.%R RFC 2439
.%T "BGP Route Flap Damping"
.%D November 1998
@


1.13
log
@slightly reword myself;
@
text
@d1 1
a1 1
.\" $OpenBSD: bgpd.8,v 1.12 2004/07/13 19:53:01 jmc Exp $
d97 7
@


1.12
log
@tweaks; ok henning@@
@
text
@d1 1
a1 1
.\" $OpenBSD: bgpd.8,v 1.11 2004/07/09 11:01:22 henning Exp $
d37 4
a40 3
Its main purpose is to exchange information with other BGP systems
describing
.Qq network reachability .
@


1.11
log
@various tweaks from the Frankfurt->Hamburg flight
@
text
@d1 1
a1 1
.\" $OpenBSD: bgpd.8,v 1.10 2004/06/23 00:11:27 claudio Exp $
d27 3
a29 1
.Op Fl D Ar macro=value
d34 36
a69 2
is a daemon usually invoked at boot time to manage the network routing tables.
It uses the Border Gateway Protocol, Version 4, as described in RFC 1771.
d71 2
a72 2
.Bl -tag -width Ds
.It Fl D Ar macro=value
d82 4
a85 1
Do not daemonize and log to
d88 5
a92 3
Specify an alternate location,
.Ar file ,
for the configuration file.
d95 1
a95 1
Only check the config file for validity.
d100 1
a100 1
.Bl -tag -width "/etc/bgpd.conf" -compact
d102 1
d104 1
a104 1
configuration file.
@


1.10
log
@Support rfc 3765 which adds a new well known community NOPEER. OK henning@@
@
text
@d1 1
a1 1
.\" $OpenBSD: bgpd.8,v 1.9 2004/05/23 22:32:42 jmc Exp $
a30 1
The
d32 2
a33 2
daemon implements the Border Gateway Protocol version 4 as described
in RFC 1771.
@


1.9
log
@add relevant rfc's to SEE ALSO;

suggested by Alexey E. Suslikov;
help and ok henning@@
@
text
@d1 1
a1 1
.\" $OpenBSD: bgpd.8,v 1.8 2004/02/05 01:33:57 mcbride Exp $
d102 5
@


1.8
log
@Emphasise 'stderr'.

ok henning@@
@
text
@d1 1
a1 1
.\" $OpenBSD: bgpd.8,v 1.7 2004/01/06 03:43:50 henning Exp $
d68 35
@


1.7
log
@2004
@
text
@d1 1
a1 1
.\" $OpenBSD: bgpd.8,v 1.6 2004/01/05 12:41:47 henning Exp $
d47 2
a48 1
Do not daemonize and log to stderr.
@


1.6
log
@.Xr bgpctl
@
text
@d1 1
a1 1
.\" $OpenBSD: bgpd.8,v 1.5 2004/01/02 09:12:27 jmc Exp $
d3 1
a3 1
.\" Copyright (c) 2003 Henning Brauer <henning@@openbsd.org>
@


1.5
log
@SEE ALSO after FILES;
@
text
@d1 1
a1 1
.\" $OpenBSD: bgpd.8,v 1.4 2003/12/23 17:08:54 henning Exp $
d65 2
a66 1
.Xr bgpd.conf 5
@


1.4
log
@.Xr the more or less shiny new bgpd.conf manpage
@
text
@d1 1
a1 1
.\" $OpenBSD: bgpd.8,v 1.3 2003/12/23 12:17:33 henning Exp $
a57 2
.Sh SEE ALSO
.Xr bgpd.conf 5
d64 2
@


1.3
log
@jmc says -D before -d
@
text
@d1 1
a1 1
.\" $OpenBSD: bgpd.8,v 1.2 2003/12/22 15:07:05 henning Exp $
d58 2
@


1.2
log
@add a configtest mode
@
text
@d1 1
a1 1
.\" $OpenBSD: bgpd.8,v 1.1 2003/12/22 00:10:33 henning Exp $
a36 2
.It Fl d
Do not daemonize and log to stderr.
d46 2
@


1.1
log
@my bloody attempt at a manpage. to be fleshed out.
@
text
@d1 1
a1 1
.\" $OpenBSD$
d26 1
a26 1
.Op Fl dv
d52 3
@

