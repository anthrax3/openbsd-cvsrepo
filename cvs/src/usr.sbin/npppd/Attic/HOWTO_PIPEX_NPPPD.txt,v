head	1.9;
access;
symbols
	OPENBSD_5_2:1.8.0.4
	OPENBSD_5_2_BASE:1.8
	OPENBSD_5_1_BASE:1.8
	OPENBSD_5_1:1.8.0.2
	OPENBSD_5_0:1.5.0.2
	OPENBSD_5_0_BASE:1.5
	OPENBSD_4_9:1.3.0.2
	OPENBSD_4_9_BASE:1.3
	OPENBSD_4_8:1.1.0.4
	OPENBSD_4_8_BASE:1.1
	OPENBSD_4_7:1.1.0.2
	OPENBSD_4_7_BASE:1.1;
locks; strict;
comment	@# @;


1.9
date	2012.09.18.13.14.08;	author yasuoka;	state dead;
branches;
next	1.8;

1.8
date	2012.01.18.03.21.28;	author yasuoka;	state Exp;
branches;
next	1.7;

1.7
date	2012.01.06.11.20.36;	author sebastia;	state Exp;
branches;
next	1.6;

1.6
date	2011.10.28.11.53.21;	author yasuoka;	state Exp;
branches;
next	1.5;

1.5
date	2011.07.08.18.30.17;	author yasuoka;	state Exp;
branches;
next	1.4;

1.4
date	2011.07.06.20.52.28;	author yasuoka;	state Exp;
branches;
next	1.3;

1.3
date	2010.09.26.06.54.44;	author yasuoka;	state Exp;
branches;
next	1.2;

1.2
date	2010.09.20.03.51.31;	author yasuoka;	state Exp;
branches;
next	1.1;

1.1
date	2010.01.31.13.27.36;	author yasuoka;	state Exp;
branches;
next	;


desc
@@


1.9
log
@New configuration syntax for npppd(8).  `npppd.conf' will be based on
parse.y and `npppd-users' will be based on getcap(3).  Add man pages.

feedback from giovanni
@
text
@$Id: HOWTO_PIPEX_NPPPD.txt,v 1.8 2012/01/18 03:21:28 yasuoka Exp $

How to test npppd and pipex
---------------------------

  client ------ server
                A.B.C.D

on server

  1. update your source tree

  2. build and update kernel

  3. build npppd

	% cd /usr/src/usr.sbin/npppd
	% make
	% sudo make install

  4. install npppd.conf and npppd-users.csv to /etc/npppd/
     sample npppd.conf and npppd-user.csv attached below on this file.

	% sudo mkdir -m 0755 /etc/npppd
	% sudo cp npppd.conf /etc/npppd/
	% sudo cp npppd-users.csv /etc/npppd/

  5. enable PIPEX and GRE by sysctl

	% sudo sysctl net.inet.gre.allow=1  (for PPTP)
	% sudo sysctl net.pipex.enable=1    (for PIPEX)

  6. run npppd

	% sudo /usr/sbin/npppd -d

  NOTE:

  * Previous version required to create `_npppd' user and group, but
    now it uses '_ppp' instead.  Delete `_npppd' if you created.

	% sudo userdel _npppd
	% sudo groupdel _npppd

  * Previous version has `npppdctl', but it was replaced by `npppctl'.
    So please remove `npppdctl' related files.

	% sudo rm /usr/sbin/npppdctl
	% sudo rm /usr/share/man/cat8/npppdctl.0
	% sudo rm /usr/share/man/man8/npppdctl.8


on client

  1. install 'pptp' from ports.
  2. edit /etc/ppp/ppp.conf
     -------------------------------
     test_pptp:
       set device "!/usr/local/sbin/pptp --nolaunchpppd A.B.C.D"
       set authname test
       set authkey hogehoge
       set mppe 128 stateless
       disable protocomp
       deny protocomp
       disable ipv6cp
     -------------------------------
     modify "A.B.C.D" to actual IP address.
  3. dial test_pptp
     % sudo ppp -ddial test_pptp


How to test L2TP/IPsec
----------------------

  1. run isakmpd
     % sudo isakmpd -Kv
  2. append below lines to /etc/ipsec.conf
     -------------------------------
     ike passive esp transport \
         proto udp from A.B.C.D to any port 1701 \
         main auth "hmac-sha" enc "3des" group modp1024 \
         quick auth "hmac-sha" enc "aes" \
         psk "secret"
     -------------------------------
     - change A.B.C.D to actual IP address
     - change "secret" to actual shared secret

   3. exec ipsecctl to notice isakmpd
     % sudo ipsecctl -f /etc/ipsec.conf

   4. connect from iPhone, MacOS or Windows


[npppd.conf]
-------------------------------------------------------------------------------
#
# Simplest npppd.conf sample
#
# $Id: HOWTO_PIPEX_NPPPD.txt,v 1.8 2012/01/18 03:21:28 yasuoka Exp $

interface_list:                         tun0
interface.tun0.ip4addr:                 10.0.0.1

# IP address pool
pool.dyna_pool:                         10.0.0.0/25
pool.pool:                              10.0.0.128/25

# Local file authentication
auth.local.realm_list:                  local
auth.local.realm.acctlist:              /etc/npppd/npppd-users.csv
realm.local.concentrate:                tun0

# RADIUS authentication / accounting
#auth.radius.realm_list:                radius
#auth.radius.realm.server.address:	127.0.0.1:1812
#auth.radius.realm.server.secret:	hogehoge
#auth.radius.realm.acct_server.address:	127.0.0.1:1813
#auth.radius.realm.acct_server.secret:	hogehoge
#realm.radius.concentrate:		tun0

lcp.mru:                                1400
auth.method:                            mschapv2 chap
#auth.method:                           mschapv2 chap pap
#ipcp.dns_primary:                      192.168.4.20
#ipcp.dns_secondary:                    192.168.6.20
#ipcp.nbns_primary:                     192.168.4.20
#ipcp.nbns_secondary:                   192.168.6.20
#ipcp.assign_fixed:                     true
#ipcp.assign_userselect:                true

pptpd.enabled:                          true
pptpd.ip4_allow:                        0.0.0.0/0
#pptpd.listener_in:                     PPTP 192.168.0.1

# L2TP daemon
l2tpd.enabled:                          true
l2tpd.ip4_allow:                        0.0.0.0/0
#l2tpd.listener_in:                     L2TP 192.168.0.1
#l2tpd.purge_ipsec_sa:                  true
l2tpd.require_ipsec:                    false

# PPPoE daemon
#pppoed.enabled:                                true
#pppoed.interface:                      PPPoE vic0

#pipex.enabled:				false
-------------------------------------------------------------------------------

[npppd-users.csv]
  - First line of the CSV is *IGNORED*.  It is treated as a title line.
-------------------------------------------------------------------------------
Username,Password,Framed-IP-Address,Framed-IP-Netmask,Description,Calling-Id
user1,user1's secret,10.0.0.129,,memo for user1
-------------------------------------------------------------------------------
@


1.8
log
@npppdctl related files should be removed.  Added a mention about that.
@
text
@d1 1
a1 1
$Id: HOWTO_PIPEX_NPPPD.txt,v 1.7 2012/01/06 11:20:36 sebastia Exp $
d99 1
a99 1
# $Id: HOWTO_PIPEX_NPPPD.txt,v 1.7 2012/01/06 11:20:36 sebastia Exp $
@


1.7
log
@mkdir needs -m to set the mode

OK yasuoka@@
@
text
@d1 1
a1 1
$Id: HOWTO_PIPEX_NPPPD.txt,v 1.6 2011/10/28 11:53:21 yasuoka Exp $
d45 7
d99 1
a99 1
# $Id: HOWTO_PIPEX_NPPPD.txt,v 1.6 2011/10/28 11:53:21 yasuoka Exp $
@


1.6
log
@use existing _ppp instead of _npppd as a user/group id for npppd.

ok deraadt@@ henning@@
@
text
@d1 1
a1 1
$Id: HOWTO_PIPEX_NPPPD.txt,v 1.5 2011/07/08 18:30:17 yasuoka Exp $
d24 1
a24 1
	% sudo mkdir 0755 /etc/npppd
d92 1
a92 1
# $Id: HOWTO_PIPEX_NPPPD.txt,v 1.5 2011/07/08 18:30:17 yasuoka Exp $
@


1.5
log
@Include PIPEX in kernel by default.  And add new sysctl variable
`net.pipex.enable' to enable PIPEX.   By default, pipex is disabled
and it will not process packets from wire.  Update man pages and
update HOWTO_PIPEX_NPPPD.txt for testers.

discussed with dlg@@, ok deraadt@@ mcbride@@ claudio@@
@
text
@d1 1
a1 1
$Id: HOWTO_PIPEX_NPPPD.txt,v 1.4 2011/07/06 20:52:28 yasuoka Exp $
d28 1
a28 6
  5. create user '_npppd'

	% sudo groupadd _npppd
	% sudo useradd -d /var/empty -s /sbin/nologin -g _npppd _npppd

  6. enable PIPEX and GRE by sysctl
d33 1
a33 1
  7. run npppd
d37 9
d92 1
a92 1
# $Id: HOWTO_PIPEX_NPPPD.txt,v 1.4 2011/07/06 20:52:28 yasuoka Exp $
@


1.4
log
@Add RADIUS accounting support and some authentication related changes:

- Add functions to radius+.c that are required to implement RADIUS
  accounting.
- Send RADIUS Account-Start and Account-Stop messages with attributes that
  are defined by RFC 2866, 2868, 2869.
- If any authentication realm is deleted from the configuration, npppd may
  exit by segmentation fault.
- Delete radius_common.c, radius_common.h and eap.c because they are not
  used.
- Retransmission and failover are reimplemented.
- Cleanup
@
text
@d1 1
a1 1
$Id: HOWTO_PIPEX_NPPPD.txt,v 1.3 2010/09/26 06:54:44 yasuoka Exp $
d13 1
a13 2
  2. enable PIPEX on your kernel and reboot with the kernel
     Add bellow line to your kernel configuration file
d15 1
a15 5
	option          PIPEX           # Pppac IP EXtension, for npppd

  3. build and update kernel

  4. build npppd
d21 1
a21 2
  5. install npppd.conf and npppd-users.csv to /etc/npppd/

d28 1
a28 1
  6. create user '_npppd'
d30 2
a31 2
     	% sudo groupadd _npppd
     	% sudo useradd -d /var/empty -s /sbin/nologin -g _npppd _npppd
d33 4
a36 2
  6. set net.inet.gre.allow=1
	% sudo sysctl net.inet.gre.allow=1
d39 1
d88 1
a88 1
# $Id: HOWTO_PIPEX_NPPPD.txt,v 1.3 2010/09/26 06:54:44 yasuoka Exp $
d134 2
@


1.3
log
@correct the path of npppd, and use modp1024 on the sample ipsec.conf
because iPhone doesn't support modp2048.
@
text
@d1 1
a1 1
$Id: HOWTO_PIPEX_NPPPD.txt,v 1.2 2010/09/20 03:51:31 yasuoka Exp $
d91 1
a91 1
# $Id: HOWTO_PIPEX_NPPPD.txt,v 1.2 2010/09/20 03:51:31 yasuoka Exp $
d100 1
a100 1
# Authentication
d104 8
@


1.2
log
@Update instructions for testing npppd and pipex.  The instructions was
out-of-date-ed after my privilege separation work at n2k10.
@
text
@d1 1
a1 1
$Id: HOWTO_PIPEX_NPPPD.txt,v 1.1 2010/01/31 13:27:36 yasuoka Exp $
d43 1
a43 1
	% sudo /usr/sbin/npppd/npppd -d
d73 1
a73 1
         main auth "hmac-sha" enc "3des" group modp2048 \
d91 1
a91 1
# $Id: HOWTO_PIPEX_NPPPD.txt,v 1.1 2010/01/31 13:27:36 yasuoka Exp $
@


1.1
log
@add HOWTO_PIPEX_NPPPD.txt for people who try to use pipex and npppd before
everything is done.
@
text
@d1 1
a1 1
$Id$
d11 7
a17 2
  1. create user '_npppd'
  2. update your source tree
d19 1
d21 18
a38 5
     % cd usr.sbin/npppd
     % make
  5. copy npppd.conf and npppd-user.csv to /tmp/
     - npppd.conf and npppd-users.csv are attached below.
     - if you are using 10.0.0.0/24, edit npppd.conf.
d40 2
a41 1
     % sudo sysctl net.inet.gre.allow=1
d43 1
a43 1
     % sudo usr.sbin/npppd/npppd/npppd -dc /tmp/npppd.conf
d91 1
a91 1
# $Id: npppd.conf,v 1.1.1.1 2008/05/21 09:40:11 yasuoka Exp $
d102 1
a102 1
auth.local.realm.acctlist:              /tmp/npppd-users.csv
@

