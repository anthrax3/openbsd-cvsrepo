head	1.7;
access;
symbols
	OPENBSD_6_2:1.7.0.6
	OPENBSD_6_2_BASE:1.7
	OPENBSD_6_1:1.7.0.4
	OPENBSD_6_1_BASE:1.7;
locks; strict;
comment	@ * @;


1.7
date	2017.01.21.12.59.06;	author benno;	state Exp;
branches;
next	1.6;
commitid	0yg1zkbZVPED65C0;

1.6
date	2017.01.21.09.00.29;	author benno;	state Exp;
branches;
next	1.5;
commitid	CMrTfyA83h2coxRw;

1.5
date	2017.01.21.08.55.09;	author florian;	state Exp;
branches;
next	1.4;
commitid	Hg0OwJOQlOaOYtKU;

1.4
date	2017.01.21.08.47.21;	author benno;	state Exp;
branches;
next	1.3;
commitid	MbkMl6gkRxhbIoJK;

1.3
date	2017.01.21.08.43.09;	author benno;	state Exp;
branches;
next	1.2;
commitid	finywD0D93nLo0tu;

1.2
date	2017.01.21.08.41.42;	author benno;	state Exp;
branches;
next	1.1;
commitid	gRa5yf7qfj3cY6Ul;

1.1
date	2016.09.18.20.18.25;	author benno;	state Exp;
branches;
next	;
commitid	aNA1IkqJB7MlJKGl;


desc
@@


1.7
log
@move config data structures mostly to TAILQs, because that way we
preserve order.

ok florian@@
@
text
@/*	$OpenBSD: parse.h,v 1.6 2017/01/21 09:00:29 benno Exp $ */
/*
 * Copyright (c) 2016 Sebastian Benoit <benno@@openbsd.org>
 *
 * Permission to use, copy, modify, and distribute this software for any
 * purpose with or without fee is hereby granted, provided that the above
 * copyright notice and this permission notice appear in all copies.
 *
 * THE SOFTWARE IS PROVIDED "AS IS" AND THE AUTHOR DISCLAIMS ALL WARRANTIES
 * WITH REGARD TO THIS SOFTWARE INCLUDING ALL IMPLIED WARRANTIES OF
 * MERCHANTABILITY AND FITNESS. IN NO EVENT SHALL THE AUTHOR BE LIABLE FOR
 * ANY SPECIAL, DIRECT, INDIRECT, OR CONSEQUENTIAL DAMAGES OR ANY DAMAGES
 * WHATSOEVER RESULTING FROM LOSS OF USE, DATA OR PROFITS, WHETHER IN AN
 * ACTION OF CONTRACT, NEGLIGENCE OR OTHER TORTIOUS ACTION, ARISING OUT OF
 * OR IN CONNECTION WITH THE USE OR PERFORMANCE OF THIS SOFTWARE.
 */
#ifndef PARSE_H
#define PARSE_H

#include <sys/queue.h>

#define AUTH_MAXLEN	120	/* max lenght of an authority_c name */
#define DOMAIN_MAXLEN	255	/* max len of a domain name (rfc2181) */

/*
 * XXX other size limits needed?
 * limit all paths to PATH_MAX
 */

struct authority_c {
	TAILQ_ENTRY(authority_c)	 entry;
	char		       	*name;
	char		       	*agreement;
	char		       	*api;
	char		       	*account;
};

struct domain_c {
	TAILQ_ENTRY(domain_c)	 entry;
	TAILQ_HEAD(, altname_c)	altname_list;
	int			altname_count;
	char		       	*domain;
	char		       	*key;
	char		       	*cert;
	char			*chain;
	char			*fullchain;
	char		       	*auth;
	char		       	*challengedir;
};

struct altname_c {
	TAILQ_ENTRY(altname_c)	 entry;
	char		       	*domain;
};

struct keyfile {
	LIST_ENTRY(keyfile)	 entry;
	char			*name;
};

#define ACME_OPT_VERBOSE	0x00000001
#define ACME_OPT_NEWACCT	0x00000002
#define ACME_OPT_NEWDKEY	0x00000004
#define ACME_OPT_CHECK		0x00000008

struct acme_conf {
	int			 opts;
	TAILQ_HEAD(, authority_c) authority_list;
	TAILQ_HEAD(, domain_c)	 domain_list;
	LIST_HEAD(, keyfile)	 used_key_list;
};

struct acme_conf	*parse_config(const char *, int);
int			 cmdline_symset(char *);

/* use these to find a authority or domain by name */
struct authority_c	*authority_find(struct acme_conf *, char *);
struct authority_c	*authority_find0(struct acme_conf *);
struct domain_c		*domain_find(struct acme_conf *, char *);

int			 domain_valid(const char *);

#endif /* PARSE_H */
@


1.6
log
@add option 'domain full chain certificate "path"',
revokation works, the fullchain file will be unlinked.

ok florian
@
text
@d1 1
a1 1
/*	$OpenBSD: parse.h,v 1.5 2017/01/21 08:55:09 florian Exp $ */
d31 1
a31 1
	LIST_ENTRY(authority_c)	 entry;
d39 2
a40 2
	LIST_ENTRY(domain_c)	 entry;
	LIST_HEAD(, altname_c)	altname_list;
d52 1
a52 1
	LIST_ENTRY(altname_c)	 entry;
d68 2
a69 2
	LIST_HEAD(, authority_c) authority_list;
	LIST_HEAD(, domain_c)	 domain_list;
@


1.5
log
@Implement domain chain certificate.
OK benno
@
text
@d1 1
a1 1
/*	$OpenBSD: parse.h,v 1.4 2017/01/21 08:47:21 benno Exp $ */
d46 1
@


1.4
log
@acme-client use configuration file [5 of 5]
implement new -n option to check and print configuration

ok florian
@
text
@d1 1
a1 1
/*	$OpenBSD: parse.h,v 1.3 2017/01/21 08:43:09 benno Exp $ */
d45 1
@


1.3
log
@acme-client use configuration file [2 of 5]

- add challengedir option to config file
- remove -C option from command line

ok florian
@
text
@d1 1
a1 1
/*	$OpenBSD: parse.h,v 1.2 2017/01/21 08:41:42 benno Exp $ */
d62 1
@


1.2
log
@acme-client use configuration file [1 of 5]

start using the configuration file and delete command line arguments:

-a agreement    -> agreement url ...
-c certdir      -> domain certificate "path"
-f accountkey   -> account key "path"
-k domainkey    -> domain key "path"
-s authority    -> sign with "name"

new argument:
-f configfile

the changes needed to use the new configuration are local to main.c for now.
While the configuration could be passed directly to netproc(), keyproc() etc,
the diff is smaller this way.

This also removes the multidir (-m) mode for now - specify different paths in
each domain {} block instead.

ok florian
@
text
@d1 1
a1 1
/*	$OpenBSD: parse.h,v 1.1 2016/09/18 20:18:25 benno Exp $ */
d46 1
@


1.1
log
@add a config file parser to acme-client (unused at the moment, so that
it can be worked on in the tree).
ok florian@@ deraadt@@
@
text
@d1 1
a1 1
/*	$OpenBSD$ */
d41 1
d59 2
@

