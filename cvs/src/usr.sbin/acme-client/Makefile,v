head	1.8;
access;
symbols
	OPENBSD_6_2:1.8.0.2
	OPENBSD_6_2_BASE:1.8
	OPENBSD_6_1:1.7.0.4
	OPENBSD_6_1_BASE:1.7;
locks; strict;
comment	@# @;


1.8
date	2017.07.03.22.21.47;	author espie;	state Exp;
branches;
next	1.7;
commitid	SoYT2zMcub5xTPqC;

1.7
date	2017.01.21.08.41.42;	author benno;	state Exp;
branches;
next	1.6;
commitid	gRa5yf7qfj3cY6Ul;

1.6
date	2016.09.18.20.18.25;	author benno;	state Exp;
branches;
next	1.5;
commitid	aNA1IkqJB7MlJKGl;

1.5
date	2016.09.05.13.31.42;	author deraadt;	state Exp;
branches;
next	1.4;
commitid	E7FIQd4ySjyFDI3j;

1.4
date	2016.09.01.00.21.36;	author deraadt;	state Exp;
branches;
next	1.3;
commitid	P9IiJlKSbxnKzQyC;

1.3
date	2016.08.31.22.28.23;	author florian;	state Exp;
branches;
next	1.2;
commitid	iwIvXWJY14P8POvh;

1.2
date	2016.08.31.22.11.15;	author florian;	state Exp;
branches;
next	1.1;
commitid	t0F0e7qNjTcQmu8o;

1.1
date	2016.08.31.22.01.42;	author florian;	state Exp;
branches;
next	;
commitid	1Bh2CBIwvUy50FSg;


desc
@@


1.8
log
@no need to generate y.tab.h if nothing uses it, set YFLAGS to nothing
instead of CLEANFILES += y.tab.h

okay millert@@
@
text
@#	$OpenBSD: Makefile,v 1.7 2017/01/21 08:41:42 benno Exp $
PROG=		acme-client
SRCS=		acctproc.c base64.c certproc.c chngproc.c dbg.c dnsproc.c
SRCS+=		fileproc.c http.c jsmn.c json.c keyproc.c main.c netproc.c
SRCS+=		parse.y revokeproc.c rsa.c util.c

MAN=		acme-client.1 acme-client.conf.5

LDADD=		-ltls -lssl -lcrypto
DPADD=		${LIBTLS} ${LIBSSL} ${LIBCRYPTO}

CFLAGS+=	-W -Wall -I${.CURDIR}
CFLAGS+=	-Wstrict-prototypes -Wmissing-prototypes
CFLAGS+=	-Wmissing-declarations
CFLAGS+=	-Wshadow -Wpointer-arith
CFLAGS+=	-Wsign-compare -Wunused
YFLAGS=

.include <bsd.prog.mk>
@


1.7
log
@acme-client use configuration file [1 of 5]

start using the configuration file and delete command line arguments:

-a agreement    -> agreement url ...
-c certdir      -> domain certificate "path"
-f accountkey   -> account key "path"
-k domainkey    -> domain key "path"
-s authority    -> sign with "name"

new argument:
-f configfile

the changes needed to use the new configuration are local to main.c for now.
While the configuration could be passed directly to netproc(), keyproc() etc,
the diff is smaller this way.

This also removes the multidir (-m) mode for now - specify different paths in
each domain {} block instead.

ok florian
@
text
@d1 1
a1 1
#	$OpenBSD: Makefile,v 1.6 2016/09/18 20:18:25 benno Exp $
d17 1
@


1.6
log
@add a config file parser to acme-client (unused at the moment, so that
it can be worked on in the tree).
ok florian@@ deraadt@@
@
text
@d1 1
a1 1
#	$OpenBSD: Makefile,v 1.5 2016/09/05 13:31:42 deraadt Exp $
d16 1
a16 1
CFLAGS+=	-Wsign-compare
@


1.5
log
@We do not compile things -g by default
@
text
@d1 1
a1 1
#	$OpenBSD: Makefile,v 1.4 2016/09/01 00:21:36 deraadt Exp $
d5 3
a7 2
SRCS+=		revokeproc.c rsa.c util.c
MAN=		acme-client.1
d12 1
a12 1
CFLAGS+=	-W -Wall
@


1.4
log
@Collapse krazy abstractions for other sandbox models, using chroot and
pledge directly as needed.
ok florian
@
text
@d1 1
a1 1
#	$OpenBSD: Makefile,v 1.3 2016/08/31 22:28:23 florian Exp $
d11 1
a11 1
CFLAGS+=	-g -W -Wall
@


1.3
log
@whitespace
@
text
@d1 1
a1 1
#	$OpenBSD: Makefile,v 1.2 2016/08/31 22:11:15 florian Exp $
d5 1
a5 1
SRCS+=		revokeproc.c rsa.c sandbox-pledge.c util-pledge.c util.c
@


1.2
log
@use bsd.prog.mk
@
text
@d1 1
a1 1
#	$OpenBSD$
d11 1
a11 1
CFLAGS		+= -g -W -Wall
@


1.1
log
@Import Kristaps' letskencrypt and call it acme-client in tree.
OK to get it in deraadt@@ (and probably beck@@)

At least deraadt@@, beck@@ and otto@@ are fine with the name and the
disagreements stopped.
@
text
@d1 15
a15 20
PREFIX	 = /usr/local
CFLAGS	+= -g -W -Wall
OBJS 	 = acctproc.o \
	   base64.o \
	   certproc.o \
	   chngproc.o \
	   dbg.o \
	   dnsproc.o \
	   fileproc.o \
	   http.o \
	   jsmn.o \
	   json.o \
	   keyproc.o \
	   main.o \
	   netproc.o \
	   revokeproc.o \
	   rsa.o \
	   sandbox-pledge.o \
	   util.o \
	   util-pledge.o
d17 1
a17 19
letskencrypt: $(OBJS)
	$(CC) -o $@@ $(OBJS) -ltls -lssl -lcrypto

rsa.o acctproc.o keyproc.o: rsa.h

jsmn.o json.o: jsmn.h

http.o netproc.o: http.h

install: letskencrypt
	mkdir -p $(DESTDIR)$(PREFIX)/bin
	mkdir -p $(DESTDIR)$(PREFIX)/man/man1
	install -m 0755 letskencrypt $(DESTDIR)$(PREFIX)/bin
	install -m 0644 letskencrypt.1 $(DESTDIR)$(PREFIX)/man/man1

$(OBJS): extern.h

clean:
	rm -f letskencrypt $(OBJS)
@

