head	1.18;
access;
symbols
	OPENBSD_5_6:1.17.0.6
	OPENBSD_5_6_BASE:1.17
	OPENBSD_5_5:1.17.0.4
	OPENBSD_5_5_BASE:1.17
	OPENBSD_5_4:1.15.0.2
	OPENBSD_5_4_BASE:1.15
	OPENBSD_5_3:1.14.0.8
	OPENBSD_5_3_BASE:1.14
	OPENBSD_5_2:1.14.0.6
	OPENBSD_5_2_BASE:1.14
	OPENBSD_5_1_BASE:1.14
	OPENBSD_5_1:1.14.0.4
	OPENBSD_5_0:1.14.0.2
	OPENBSD_5_0_BASE:1.14
	OPENBSD_4_9:1.13.0.10
	OPENBSD_4_9_BASE:1.13
	OPENBSD_4_8:1.13.0.8
	OPENBSD_4_8_BASE:1.13
	OPENBSD_4_7:1.13.0.4
	OPENBSD_4_7_BASE:1.13
	OPENBSD_4_6:1.13.0.6
	OPENBSD_4_6_BASE:1.13
	OPENBSD_4_5:1.13.0.2
	OPENBSD_4_5_BASE:1.13
	OPENBSD_4_4:1.12.0.2
	OPENBSD_4_4_BASE:1.12
	OPENBSD_4_3:1.11.0.18
	OPENBSD_4_3_BASE:1.11
	OPENBSD_4_2:1.11.0.16
	OPENBSD_4_2_BASE:1.11
	OPENBSD_4_1:1.11.0.14
	OPENBSD_4_1_BASE:1.11
	OPENBSD_4_0:1.11.0.12
	OPENBSD_4_0_BASE:1.11
	OPENBSD_3_9:1.11.0.10
	OPENBSD_3_9_BASE:1.11
	OPENBSD_3_8:1.11.0.8
	OPENBSD_3_8_BASE:1.11
	OPENBSD_3_7:1.11.0.6
	OPENBSD_3_7_BASE:1.11
	OPENBSD_3_6:1.11.0.4
	OPENBSD_3_6_BASE:1.11
	OPENBSD_3_5:1.11.0.2
	OPENBSD_3_5_BASE:1.11
	OPENBSD_3_4:1.10.0.6
	OPENBSD_3_4_BASE:1.10
	OPENBSD_3_3:1.10.0.4
	OPENBSD_3_3_BASE:1.10
	OPENBSD_3_2:1.10.0.2
	OPENBSD_3_2_BASE:1.10
	OPENBSD_3_1:1.8.0.2
	OPENBSD_3_1_BASE:1.8
	OPENBSD_3_0:1.6.0.2
	OPENBSD_3_0_BASE:1.6
	OPENBSD_2_9_BASE:1.5
	OPENBSD_2_9:1.5.0.4
	OPENBSD_2_8:1.5.0.2
	OPENBSD_2_8_BASE:1.5
	OPENBSD_2_7:1.3.0.2
	OPENBSD_2_7_BASE:1.3
	kame_19991209:1.1.1.1
	KAME:1.1.1;
locks; strict;
comment	@ * @;


1.18
date	2014.12.22.09.13.35;	author florian;	state dead;
branches;
next	1.17;
commitid	QHLwHNotIjbdLNCu;

1.17
date	2013.11.12.22.27.13;	author deraadt;	state Exp;
branches;
next	1.16;

1.16
date	2013.10.21.08.46.07;	author phessler;	state Exp;
branches;
next	1.15;

1.15
date	2013.04.21.19.42.32;	author florian;	state Exp;
branches;
next	1.14;

1.14
date	2011.03.23.00.59.49;	author bluhm;	state Exp;
branches;
next	1.13;

1.13
date	2009.01.30.17.25.51;	author rainer;	state Exp;
branches;
next	1.12;

1.12
date	2008.06.10.04.49.11;	author reyk;	state Exp;
branches;
next	1.11;

1.11
date	2004.01.05.20.32.50;	author itojun;	state Exp;
branches;
next	1.10;

1.10
date	2002.05.31.21.24.28;	author itojun;	state Exp;
branches;
next	1.9;

1.9
date	2002.05.31.10.11.14;	author itojun;	state Exp;
branches;
next	1.8;

1.8
date	2002.02.17.19.42.39;	author millert;	state Exp;
branches;
next	1.7;

1.7
date	2002.02.16.21.28.09;	author millert;	state Exp;
branches;
next	1.6;

1.6
date	2001.07.09.22.37.33;	author itojun;	state Exp;
branches;
next	1.5;

1.5
date	2000.10.06.02.46.58;	author itojun;	state Exp;
branches;
next	1.4;

1.4
date	2000.08.13.18.24.00;	author itojun;	state Exp;
branches;
next	1.3;

1.3
date	2000.02.25.10.32.21;	author itojun;	state Exp;
branches;
next	1.2;

1.2
date	99.12.09.15.10.49;	author itojun;	state Exp;
branches;
next	1.1;

1.1
date	99.12.09.14.56.03;	author itojun;	state Exp;
branches
	1.1.1.1;
next	;

1.1.1.1
date	99.12.09.14.56.03;	author itojun;	state Exp;
branches;
next	;


desc
@@


1.18
log
@Out out you evil network daemon.
OK deraadt@@ some time ago
@
text
@/*	$OpenBSD: rtsold.h,v 1.17 2013/11/12 22:27:13 deraadt Exp $	*/
/*	$KAME: rtsold.h,v 1.14 2002/05/31 10:10:03 itojun Exp $	*/

/*
 * Copyright (C) 1995, 1996, 1997, and 1998 WIDE Project.
 * All rights reserved.
 * 
 * Redistribution and use in source and binary forms, with or without
 * modification, are permitted provided that the following conditions
 * are met:
 * 1. Redistributions of source code must retain the above copyright
 *    notice, this list of conditions and the following disclaimer.
 * 2. Redistributions in binary form must reproduce the above copyright
 *    notice, this list of conditions and the following disclaimer in the
 *    documentation and/or other materials provided with the distribution.
 * 3. Neither the name of the project nor the names of its contributors
 *    may be used to endorse or promote products derived from this software
 *    without specific prior written permission.
 * 
 * THIS SOFTWARE IS PROVIDED BY THE PROJECT AND CONTRIBUTORS ``AS IS'' AND
 * ANY EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT LIMITED TO, THE
 * IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE
 * ARE DISCLAIMED.  IN NO EVENT SHALL THE PROJECT OR CONTRIBUTORS BE LIABLE
 * FOR ANY DIRECT, INDIRECT, INCIDENTAL, SPECIAL, EXEMPLARY, OR CONSEQUENTIAL
 * DAMAGES (INCLUDING, BUT NOT LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS
 * OR SERVICES; LOSS OF USE, DATA, OR PROFITS; OR BUSINESS INTERRUPTION)
 * HOWEVER CAUSED AND ON ANY THEORY OF LIABILITY, WHETHER IN CONTRACT, STRICT
 * LIABILITY, OR TORT (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY
 * OUT OF THE USE OF THIS SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF
 * SUCH DAMAGE.
 */

struct ifinfo {
	struct ifinfo *next;	/* pointer to the next interface */

	struct sockaddr_dl *sdl; /* link-layer address */
	char ifname[IF_NAMESIZE]; /* interface name */
	u_int32_t linkid;	/* link ID of this interface */
	int active;		/* interface status */
	int probeinterval;	/* interval of probe timer(if necessary) */
	int probetimer;		/* rest of probe timer */
	int mediareqok;		/* wheter the IF supports SIOCGIFMEDIA */
	int otherconfig;	/* need a separate protocol for the "other"
				 * configuration */
	int state;
	int probes;
	int dadcount;
	struct timeval timer;
	struct timeval expire;
	int stoptimer;
	int errors;		/* # of errors we've got - detect wedge */

	int racnt;		/* total # of valid RAs it have got */

	size_t rs_datalen;
	u_char *rs_data;
};

/* per interface status */
#define IFS_IDLE	0
#define IFS_DELAY	1
#define IFS_PROBE	2
#define IFS_DOWN	3
#define IFS_TENTATIVE	4

/* rtsold.c */
extern int dflag;
extern char *otherconf_script;
struct ifinfo *find_ifinfo(int ifindex);
void rtsol_timer_update(struct ifinfo *);
extern void warnmsg(int, const char *, const char *, ...)
     __attribute__((__format__(__printf__, 3, 4)));
extern char **autoifprobe(u_int);

/* if.c */
extern int ifinit(void);
int get_rdomain(char *);
extern int interface_up(char *);
extern int interface_status(struct ifinfo *);
extern int lladdropt_length(struct sockaddr_dl *);
extern void lladdropt_fill(struct sockaddr_dl *, struct nd_opt_hdr *);
extern struct sockaddr_dl *if_nametosdl(char *);
extern int getinet6sysctl(int, int);
extern int setinet6sysctl(int, int, int);

/* rtsol.c */
extern int sockopen(u_int);
extern void sendpacket(struct ifinfo *);
extern void rtsol_input(int);

/* probe.c */
extern int probe_init(void);
extern void defrouter_probe(struct ifinfo *);

/* dump.c */
extern void rtsold_dump_file(char *);
@


1.17
log
@ensure there are prototypes
@
text
@d1 1
a1 1
/*	$OpenBSD: rtsold.h,v 1.16 2013/10/21 08:46:07 phessler Exp $	*/
@


1.16
log
@Add rdomain support to IPv6 configuration tools

OK claudio@@ and bluhm@@
@
text
@d1 1
a1 1
/*	$OpenBSD: rtsold.h,v 1.15 2013/04/21 19:42:32 florian Exp $	*/
d77 1
@


1.15
log
@IPv6 might still be around in 2038, replace magic timeval
{0x7fffffff, 0x7fffffff} with an explicit flag that timers should
be stopped.
input deraadt@@, kettenis@@
"Looks like a nice solution." deraadt@@
OK benno@@
@
text
@d1 1
a1 1
/*	$OpenBSD: rtsold.h,v 1.14 2011/03/23 00:59:49 bluhm Exp $	*/
d73 1
a73 1
extern char **autoifprobe(void);
d86 1
a86 1
extern int sockopen(void);
@


1.14
log
@Print a warning when rtsol or rtsold are used to do IPv6 autoconfiguration
but accepting redirects is turned off.  If the -F switch is given,
set sysctl net.inet6.icmp6.rediraccept to 1 instead.
ok claudio@@ deraadt@@ sthen@@
@
text
@d1 1
a1 1
/*	$OpenBSD: rtsold.h,v 1.13 2009/01/30 17:25:51 rainer Exp $	*/
d50 1
a66 1
extern struct timeval tm_max;
@


1.13
log
@Delete code which was never used (rtsock.c is even not there).

old commit message from itojun:
"rtsock.c is omitted for simplicity, as it is not meaningful on openbsd."

Ok grunk@@, naddy@@
@
text
@d1 1
a1 1
/*	$OpenBSD: rtsold.h,v 1.12 2008/06/10 04:49:11 reyk Exp $	*/
d82 2
a83 2
extern int getinet6sysctl(int);
extern int setinet6sysctl(int, int);
@


1.12
log
@add the -O option to run an external script when the "other
configuration" flag is found in the RA message. it basically means
"here is your IPv6 address, but run something like DHCPv6 to get more
information".  so the main purpose is to run a dhcpv6 client to get
DNS etc.

Merged from KAME

ok rainer@@
@
text
@d1 1
a1 1
/*	$OpenBSD: rtsold.h,v 1.11 2004/01/05 20:32:50 itojun Exp $	*/
a95 6

#if 0
/* rtsock.c */
extern int rtsock_open(void);
extern int rtsock_input(int);
#endif
@


1.11
log
@add -F option, which sets sysctl(8) variables rather than warn(3) about the
current setting.  basically for boot floppy.  req'ed by fries@@. deraadt@@ ok.
@
text
@d1 1
a1 1
/*	$OpenBSD: rtsold.h,v 1.10 2002/05/31 21:24:28 itojun Exp $	*/
d43 2
d68 1
@


1.10
log
@sync w/ latest kame.  link id handling.
@
text
@d1 1
a1 1
/*	$OpenBSD: rtsold.h,v 1.9 2002/05/31 10:11:14 itojun Exp $	*/
d80 1
@


1.9
log
@function prototypes shoulnd't carry variable name
@
text
@d1 2
a2 2
/*	$OpenBSD: rtsold.h,v 1.8 2002/02/17 19:42:39 millert Exp $	*/
/*	$KAME: rtsold.h,v 1.11 2000/10/10 06:18:04 itojun Exp $	*/
d38 1
d70 1
d88 1
a88 1
extern void defrouter_probe(int);
@


1.8
log
@Manual cleanup of remaining userland __P use (excluding packages maintained outside the tree)
@
text
@d1 1
a1 1
/*	$OpenBSD: rtsold.h,v 1.7 2002/02/16 21:28:09 millert Exp $	*/
d66 1
a66 1
void rtsol_timer_update(struct ifinfo *ifinfo);
d72 6
a77 6
extern int interface_up(char *name);
extern int interface_status(struct ifinfo*);
extern int lladdropt_length(struct sockaddr_dl *sdl);
extern void lladdropt_fill(struct sockaddr_dl *sdl, struct nd_opt_hdr *ndopt);
extern struct sockaddr_dl *if_nametosdl(char *name);
extern int getinet6sysctl(int code);
d81 2
a82 2
extern void sendpacket(struct ifinfo *ifinfo);
extern void rtsol_input(int s);
d86 1
a86 1
extern void defrouter_probe(int ifindex);
@


1.7
log
@Part one of userland __P removal.  Done with a simple regexp with some minor hand editing to make comments line up correctly.  Another pass is forthcoming that handles the cases that could not be done automatically.
@
text
@d1 1
a1 1
/*	$OpenBSD: rtsold.h,v 1.6 2001/07/09 22:37:33 itojun Exp $	*/
d75 1
a75 2
extern void lladdropt_fill __P((struct sockaddr_dl *sdl,
				struct nd_opt_hdr *ndopt));
@


1.6
log
@sync with latest kame.
- a memory leak
- correct timer value
- wording fixes in manpage
rtsock.c is omitted for simplicity, as it is not meaningful on openbsd.
@
text
@d1 1
a1 1
/*	$OpenBSD: rtsold.h,v 1.5 2000/10/06 02:46:58 itojun Exp $	*/
d65 3
a67 3
struct ifinfo *find_ifinfo __P((int ifindex));
void rtsol_timer_update __P((struct ifinfo *ifinfo));
extern void warnmsg __P((int, const char *, const char *, ...))
d71 4
a74 4
extern int ifinit __P((void));
extern int interface_up __P((char *name));
extern int interface_status __P((struct ifinfo*));
extern int lladdropt_length __P((struct sockaddr_dl *sdl));
d77 2
a78 2
extern struct sockaddr_dl *if_nametosdl __P((char *name));
extern int getinet6sysctl __P((int code));
d81 3
a83 3
extern int sockopen __P((void));
extern void sendpacket __P((struct ifinfo *ifinfo));
extern void rtsol_input __P((int s));
d86 2
a87 2
extern int probe_init __P((void));
extern void defrouter_probe __P((int ifindex));
d90 1
a90 1
extern void rtsold_dump_file __P((char *));
d94 2
a95 2
extern int rtsock_open __P((void));
extern int rtsock_input __P((int));
@


1.5
log
@printf string format audit.  from: sommerfeld@@netbsd.org
@
text
@d1 2
a2 2
/*	$OpenBSD: rtsold.h,v 1.4 2000/08/13 18:24:00 itojun Exp $	*/
/*	$KAME: rtsold.h,v 1.10 2000/10/05 22:20:39 itojun Exp $	*/
d91 6
@


1.4
log
@add "rtsol -a" (automatically lookup outgoign interface).
warn if net.inet6.ip6.forwarding == 1.
improve manpage.
use $KAME$ for KAME tags.

sync with kame.
@
text
@d1 2
a2 2
/*	$OpenBSD: rtsold.h,v 1.3 2000/02/25 10:32:21 itojun Exp $	*/
/*	$KAME: rtsold.h,v 1.9 2000/08/13 06:15:00 itojun Exp $	*/
d67 2
a68 5
#ifdef __STDC__
extern void warnmsg __P((int, const char *, const char *, ...));
#else
extern void warnmsg __P((int, const char *, const char *, va_list));
#endif
@


1.3
log
@use getifaddrs, not SIOCGIFCONF for LP64 align issue. (sync with kame).
@
text
@d1 2
a2 1
/*	$OpenBSD: rtsold.h,v 1.2 1999/12/09 15:10:49 itojun Exp $	*/
@


1.2
log
@rtsold(8); router solicitation daemon.
rtsol(8); router solicitation program, for use in bootstrap process
(statically linked)

rcsid police.  add missing prototypes.
(sync with KAME)
@
text
@d1 1
a1 1
/*	$OpenBSD$	*/
d36 1
a36 1
	char ifname[16];	/* interface name */
d46 1
@


1.1
log
@Initial revision
@
text
@d1 2
@


1.1.1.1
log
@initial import from KAME tree
@
text
@@
