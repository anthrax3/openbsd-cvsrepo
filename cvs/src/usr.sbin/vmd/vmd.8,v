head	1.7;
access;
symbols
	OPENBSD_6_1_BASE:1.7
	OPENBSD_6_0:1.6.0.2
	OPENBSD_6_0_BASE:1.6
	OPENBSD_5_9:1.5.0.2
	OPENBSD_5_9_BASE:1.5;
locks; strict;
comment	@.\" @;


1.7
date	2017.03.25.16.28.25;	author reyk;	state Exp;
branches;
next	1.6;
commitid	s82EA2LBuZtftmLN;

1.6
date	2016.06.10.18.32.40;	author jmc;	state Exp;
branches;
next	1.5;
commitid	D7w9T6VEMLk5E7pd;

1.5
date	2015.12.03.21.45.45;	author reyk;	state Exp;
branches;
next	1.4;
commitid	MPLOtGQkSv2xIotz;

1.4
date	2015.12.03.16.18.13;	author reyk;	state Exp;
branches;
next	1.3;
commitid	32vG2ozzEdZ6a46n;

1.3
date	2015.11.23.13.04.49;	author reyk;	state Exp;
branches;
next	1.2;
commitid	8LSTqui1EesFdS0T;

1.2
date	2015.11.22.21.24.48;	author jmc;	state Exp;
branches;
next	1.1;
commitid	zTe48rQlveInnCLK;

1.1
date	2015.11.22.20.20.32;	author mlarkin;	state Exp;
branches;
next	;
commitid	O5Ay1ZamHQn9lamK;


desc
@@


1.7
log
@Boot using BIOS from /etc/firmware/vmm-bios by default.

Instead of using the internal "vmboot", VMs will now be booted using
the external BIOS firmware in /etc/firmware/vmm-bios (which is subject
to a LGPLv3 license).  Direct booting of OpenBSD kernels or
non-default BIOS images is still supported for now using the -b/boot
option that is replacing the -k/kernel option.

As requested by Theo, vmd(8) fails if neither the default BIOS is
found nor a kernel has been specified in the VM configuration.  The
"vmm" BIOS has to be installed using fw_update(1), which will be done
automatically in most cases where the OpenBSD can fetch it after
install/upgrade.

OK mlarkin@@
@
text
@.\"	$OpenBSD: vmd.8,v 1.6 2016/06/10 18:32:40 jmc Exp $
.\"
.\" Copyright (c) 2015 Mike Larkin <mlarkin@@openbsd.org>
.\"
.\" Permission to use, copy, modify, and distribute this software for any
.\" purpose with or without fee is hereby granted, provided that the above
.\" copyright notice and this permission notice appear in all copies.
.\"
.\" THE SOFTWARE IS PROVIDED "AS IS" AND THE AUTHOR DISCLAIMS ALL WARRANTIES
.\" WITH REGARD TO THIS SOFTWARE INCLUDING ALL IMPLIED WARRANTIES OF
.\" MERCHANTABILITY AND FITNESS. IN NO EVENT SHALL THE AUTHOR BE LIABLE FOR
.\" ANY SPECIAL, DIRECT, INDIRECT, OR CONSEQUENTIAL DAMAGES OR ANY DAMAGES
.\" WHATSOEVER RESULTING FROM LOSS OF USE, DATA OR PROFITS, WHETHER IN AN
.\" ACTION OF CONTRACT, NEGLIGENCE OR OTHER TORTIOUS ACTION, ARISING OUT OF
.\" OR IN CONNECTION WITH THE USE OR PERFORMANCE OF THIS SOFTWARE.
.\"
.Dd $Mdocdate: June 10 2016 $
.Dt VMD 8
.Os
.Sh NAME
.Nm vmd
.Nd virtual machine daemon
.Sh SYNOPSIS
.Nm vmd
.Op Fl dnv
.Op Fl D Ar macro Ns = Ns Ar value
.Op Fl f Ar file
.Sh DESCRIPTION
.Nm
is a daemon responsible for the execution of virtual machines (VMs) on a
host.
.Nm
is typically started at boot time and is controlled via
.Xr vmctl 8 .
.Pp
.Nm
can be enabled during system boot by setting the following in
.Pa /etc/rc.conf.local :
.Pp
.Dl vmd_flags=\&"\&"
.Pp
.Nm
interfaces with the virtual machine monitor (VMM) built into the kernel.
One instance of
.Nm
will be spawned for each VM running on the host, plus an extra instance
for control operations.
Each child
.Nm
will in turn create one or more VCPU (virtual CPU) threads responsible for
driving the VM's operations using
.Xr vmm 4 .
.Pp
.Nm
is also responsible for proxying various other commands/requests from
.Xr vmctl 8 ,
such as stopping VMs, and retrieving information from
.Xr vmm 4
about running VMs.
.Pp
The options are as follows:
.Bl -tag -width Dssmacro=value
.It Fl D Ar macro Ns = Ns Ar value
Define
.Ar macro
to be set to
.Ar value
on the command line.
Overrides the definition of
.Ar macro
in the configuration file.
.It Fl d
Do not daemonize and log to
.Em stderr .
.It Fl f Ar file
Specify an alternative configuration file.
The default is
.Pa /etc/vm.conf .
.It Fl n
Configtest mode.
Only check the configuration file for validity.
.It Fl v
Verbose mode.
Multiple
.Fl v
options increase the verbosity.
.El
.Sh FILES
.Bl -tag -width "/etc/firmware/vmm-biosXX" -compact
.It Pa /etc/firmware/vmm-bios
Default BIOS boot image.
The BIOS is an external firmware file that is distributed separately
due to an incompatible license.
A prepackaged version of the firmware can be installed using
.Xr fw_update 1 .
.It Pa /etc/vm.conf
Default configuration file.
This is optional.
.It Pa /var/run/vmd.sock
.Ux Ns -domain
socket used for communication with
.Xr vmctl 8 .
.El
.Sh SEE ALSO
.Xr vmm 4 ,
.Xr vm.conf 5 ,
.Xr rc.conf 8 ,
.Xr vmctl 8
.Sh HISTORY
The
.Nm
command first appeared in
.Ox 5.9 .
.Sh AUTHORS
.An Mike Larkin Aq Mt mlarkin@@openbsd.org
and
.An Reyk Floeter Aq Mt reyk@@openbsd.org
@


1.6
log
@grammar fix; from nick permyakov
@
text
@d1 1
a1 1
.\"	$OpenBSD: vmd.8,v 1.5 2015/12/03 21:45:45 reyk Exp $
d17 1
a17 1
.Dd $Mdocdate: December 3 2015 $
d89 7
a95 1
.Bl -tag -width "/var/run/vmd.sockXX" -compact
@


1.5
log
@Replace vmmctl with vmctl.  Also remove parse.y from the "new" vmctl.

As discussed with mlarkin@@ and deraadt@@
@
text
@d1 1
a1 1
.\"	$OpenBSD: vmd.8,v 1.4 2015/12/03 16:18:13 reyk Exp $
d86 1
a86 1
options increases the verbosity.
@


1.4
log
@Add and document -D and -f flags to vmd.
@
text
@d1 1
a1 1
.\"	$OpenBSD: vmd.8,v 1.3 2015/11/23 13:04:49 reyk Exp $
d17 1
a17 1
.Dd $Mdocdate: November 23 2015 $
d34 1
a34 1
.Xr vmmctl 8 .
d56 1
a56 1
.Xr vmmctl 8 ,
d96 1
a96 1
.Xr vmmctl 8 .
d102 1
a102 1
.Xr vmmctl 8
@


1.3
log
@Add support for logging to stderr or syslog, and to run vmd in
foreground with -d.

OK mlarkin@@ jung@@
@
text
@d1 1
a1 1
.\"	$OpenBSD: vmd.8,v 1.2 2015/11/22 21:24:48 jmc Exp $
d17 1
a17 1
.Dd $Mdocdate: November 22 2015 $
d25 3
a27 1
.Op Fl dv
d63 9
d75 7
d88 10
d100 1
d110 2
@


1.2
log
@sundry tweaks;
@
text
@d1 1
a1 1
.\"	$OpenBSD$
d25 1
a25 1
.Op Fl f Ar file
d58 12
@


1.1
log
@
vmd(8) - virtual machine daemon.

There is still a lot to be done, and fixed, in these userland components
but I have received enough "it works, commit it" emails that it's time
to finish those things in tree.

discussed with many, tested by many.
@
text
@d1 1
d3 1
a3 1
.\"Copyright (c) 2015 Mike Larkin <mlarkin@@openbsd.org>
d5 3
a7 3
.\"Permission to use, copy, modify, and distribute this software for any
.\"purpose with or without fee is hereby granted, provided that the above
.\"copyright notice and this permission notice appear in all copies.
d9 9
a17 8
.\"THE SOFTWARE IS PROVIDED "AS IS" AND THE AUTHOR DISCLAIMS ALL WARRANTIES
.\"WITH REGARD TO THIS SOFTWARE INCLUDING ALL IMPLIED WARRANTIES OF
.\"MERCHANTABILITY AND FITNESS. IN NO EVENT SHALL THE AUTHOR BE LIABLE FOR
.\"ANY SPECIAL, DIRECT, INDIRECT, OR CONSEQUENTIAL DAMAGES OR ANY DAMAGES
.\"WHATSOEVER RESULTING FROM LOSS OF USE, DATA OR PROFITS, WHETHER IN AN
.\"ACTION OF CONTRACT, NEGLIGENCE OR OTHER TORTIOUS ACTION, ARISING OUT OF
.\"OR IN CONNECTION WITH THE USE OR PERFORMANCE OF THIS SOFTWARE.
.Dd $Mdocdate$
d34 1
a34 1
.Nm 
d45 2
a46 1
for control operations. Each child
d55 2
a56 2
such as stopping VMs, and retrieving information from 
.Xr vmm 4 
a57 1
.Pp
a59 1
.Xr vmmctl 8 ,
d61 1
@

