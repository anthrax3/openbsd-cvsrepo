head	1.10;
access;
symbols
	OPENBSD_6_1:1.10.0.4
	OPENBSD_6_1_BASE:1.10
	OPENBSD_6_0:1.10.0.6
	OPENBSD_6_0_BASE:1.10
	OPENBSD_5_9:1.10.0.2
	OPENBSD_5_9_BASE:1.10
	OPENBSD_5_8:1.8.0.4
	OPENBSD_5_8_BASE:1.8
	OPENBSD_5_7:1.7.0.18
	OPENBSD_5_7_BASE:1.7
	OPENBSD_5_6:1.7.0.22
	OPENBSD_5_6_BASE:1.7
	OPENBSD_5_5:1.7.0.20
	OPENBSD_5_5_BASE:1.7
	OPENBSD_5_4:1.7.0.16
	OPENBSD_5_4_BASE:1.7
	OPENBSD_5_3:1.7.0.14
	OPENBSD_5_3_BASE:1.7
	OPENBSD_5_2:1.7.0.12
	OPENBSD_5_2_BASE:1.7
	OPENBSD_5_1_BASE:1.7
	OPENBSD_5_1:1.7.0.10
	OPENBSD_5_0:1.7.0.8
	OPENBSD_5_0_BASE:1.7
	OPENBSD_4_9:1.7.0.6
	OPENBSD_4_9_BASE:1.7
	OPENBSD_4_8:1.7.0.4
	OPENBSD_4_8_BASE:1.7
	OPENBSD_4_7:1.7.0.2
	OPENBSD_4_7_BASE:1.7
	OPENBSD_4_6:1.6.0.10
	OPENBSD_4_6_BASE:1.6
	OPENBSD_4_5:1.6.0.6
	OPENBSD_4_5_BASE:1.6
	OPENBSD_4_4:1.6.0.4
	OPENBSD_4_4_BASE:1.6
	OPENBSD_4_3:1.6.0.2
	OPENBSD_4_3_BASE:1.6
	OPENBSD_4_2:1.5.0.18
	OPENBSD_4_2_BASE:1.5
	OPENBSD_4_1:1.5.0.16
	OPENBSD_4_1_BASE:1.5
	OPENBSD_4_0:1.5.0.14
	OPENBSD_4_0_BASE:1.5
	OPENBSD_3_9:1.5.0.12
	OPENBSD_3_9_BASE:1.5
	OPENBSD_3_8:1.5.0.10
	OPENBSD_3_8_BASE:1.5
	OPENBSD_3_7:1.5.0.8
	OPENBSD_3_7_BASE:1.5
	OPENBSD_3_6:1.5.0.6
	OPENBSD_3_6_BASE:1.5
	OPENBSD_3_5:1.5.0.4
	OPENBSD_3_5_BASE:1.5
	OPENBSD_3_4:1.5.0.2
	OPENBSD_3_4_BASE:1.5
	OPENBSD_3_3:1.3.0.12
	OPENBSD_3_3_BASE:1.3
	OPENBSD_3_2:1.3.0.10
	OPENBSD_3_2_BASE:1.3
	OPENBSD_3_1:1.3.0.8
	OPENBSD_3_1_BASE:1.3
	OPENBSD_3_0:1.3.0.6
	OPENBSD_3_0_BASE:1.3
	OPENBSD_2_9_BASE:1.3
	OPENBSD_2_9:1.3.0.4
	OPENBSD_2_8:1.3.0.2
	OPENBSD_2_8_BASE:1.3
	OPENBSD_2_7:1.2.0.4
	OPENBSD_2_7_BASE:1.2
	OPENBSD_2_6:1.2.0.2
	OPENBSD_2_6_BASE:1.2;
locks; strict;
comment	@ * @;


1.10
date	2015.11.16.00.16.39;	author mmcc;	state Exp;
branches;
next	1.9;
commitid	enjTsnD5UO6xazKc;

1.9
date	2015.08.21.02.07.32;	author deraadt;	state Exp;
branches;
next	1.8;
commitid	Zx2k82IzYwwZaEz9;

1.8
date	2015.04.05.17.02.57;	author guenther;	state Exp;
branches;
next	1.7;
commitid	aiXk5EdrcUpeXylC;

1.7
date	2009.10.27.23.59.57;	author deraadt;	state Exp;
branches;
next	1.6;

1.6
date	2007.10.07.16.41.05;	author deraadt;	state Exp;
branches;
next	1.5;

1.5
date	2003.04.04.02.56.51;	author millert;	state Exp;
branches;
next	1.4;

1.4
date	2003.04.02.20.42.22;	author millert;	state Exp;
branches;
next	1.3;

1.3
date	2000.10.03.14.31.59;	author ho;	state Exp;
branches;
next	1.2;

1.2
date	99.07.29.13.12.34;	author jakob;	state Exp;
branches;
next	1.1;

1.1
date	99.07.28.20.41.36;	author jakob;	state Exp;
branches;
next	;


desc
@@


1.10
log
@Remove remaining instances of the register keyword.

ok deraadt@@
@
text
@/*	$OpenBSD: savestr.c,v 1.9 2015/08/21 02:07:32 deraadt Exp $	*/

/*
 * Copyright (c) 1997
 *	The Regents of the University of California.  All rights reserved.
 *
 * Redistribution and use in source and binary forms, with or without
 * modification, are permitted provided that: (1) source code distributions
 * retain the above copyright notice and this paragraph in its entirety, (2)
 * distributions including binary code include the above copyright notice and
 * this paragraph in its entirety in the documentation or other materials
 * provided with the distribution, and (3) all advertising materials mentioning
 * features or use of this software display the following acknowledgement:
 * ``This product includes software developed by the University of California,
 * Lawrence Berkeley Laboratory and its contributors.'' Neither the name of
 * the University nor the names of its contributors may be used to endorse
 * or promote products derived from this software without specific prior
 * written permission.
 * THIS SOFTWARE IS PROVIDED ``AS IS'' AND WITHOUT ANY EXPRESS OR IMPLIED
 * WARRANTIES, INCLUDING, WITHOUT LIMITATION, THE IMPLIED WARRANTIES OF
 * MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE.
 */

#include <sys/types.h>

#include <stdio.h>
#include <stdlib.h>
#include <string.h>

#ifdef HAVE_OS_PROTO_H
#include "os-proto.h"
#endif

#include "savestr.h"

/* A replacement for strdup() that cuts down on malloc() overhead */
char *
savestr(const char *str)
{
	size_t size;
	char *p;
	static char *strptr = NULL;
	static size_t strsize = 0;

	size = strlen(str) + 1;
	if (size > strsize) {
		strsize = 1024;
		if (strsize < size)
			strsize = size;
		strptr = malloc(strsize);
		if (strptr == NULL) {
			fprintf(stderr, "savestr: malloc\n");
			exit(1);
		}
	}
	(void)strlcpy(strptr, str, size);
	p = strptr;
	strptr += size;
	strsize -= size;
	return (p);
}
@


1.9
log
@since stdlib.h is in scope, don't cast.... you know the drill.
no sneakiness detected by krw
@
text
@d1 1
a1 1
/*	$OpenBSD: savestr.c,v 1.8 2015/04/05 17:02:57 guenther Exp $	*/
d38 1
a38 1
savestr(register const char *str)
d40 2
a41 2
	register size_t size;
	register char *p;
@


1.8
log
@Upstream has retired the gnuc.h header, so do so as well, killing a gcc 2.x
reference.

ok sthen@@ jca@@ deraadt@@
@
text
@d1 1
a1 1
/*	$OpenBSD: savestr.c,v 1.7 2009/10/27 23:59:57 deraadt Exp $	*/
d50 1
a50 1
		strptr = (char *)malloc(strsize);
@


1.7
log
@rcsid[] and sccsid[] and copyright[] are essentially unmaintained (and
unmaintainable).  these days, people use source.  these id's do not provide
any benefit, and do hurt the small install media
(the 33,000 line diff is essentially mechanical)
ok with the idea millert, ok dms
@
text
@d1 1
a1 1
/*	$OpenBSD: savestr.c,v 1.6 2007/10/07 16:41:05 deraadt Exp $	*/
a29 1
#include "gnuc.h"
@


1.6
log
@trash $Header goo which is just annoying; 5595
@
text
@d1 1
a1 1
/*	$OpenBSD: savestr.c,v 1.5 2003/04/04 02:56:51 millert Exp $	*/
a22 5

#ifndef lint
static const char rcsid[] =
    "@@(#) $Id$ (LBL)";
#endif
@


1.5
log
@Back out the realloc change, to do it right requires more record
keeping and could result in very large memory chunks.
@
text
@d1 1
a1 1
/*	$OpenBSD: savestr.c,v 1.4 2003/04/02 20:42:22 millert Exp $	*/
d26 1
a26 1
    "@@(#) $Header: /cvs/src/usr.sbin/tcpdump/savestr.c,v 1.4 2003/04/02 20:42:22 millert Exp $ (LBL)";
@


1.4
log
@o Use realloc() instead of leaking memory when we need more than 1024 bytes
o use strlcpy()
deraadt@@ OK
@
text
@d1 1
a1 1
/*	$OpenBSD: savestr.c,v 1.3 2000/10/03 14:31:59 ho Exp $	*/
d26 1
a26 1
    "@@(#) $Header: /cvs/src/usr.sbin/tcpdump/savestr.c,v 1.3 2000/10/03 14:31:59 ho Exp $ (LBL)";
d56 1
a56 1
		strptr = strptr ? realloc(strptr, strsize) : malloc(strsize);
d58 1
a58 1
			fprintf(stderr, "savestr: cannot allocate memory\n");
@


1.3
log
@Add $OpenBSD$. (jakob@@ ok)
@
text
@d1 1
a1 1
/*	$OpenBSD$	*/
d26 1
a26 1
    "@@(#) $Header: /cvs/src/usr.sbin/tcpdump/savestr.c,v 1.2 1999/07/29 13:12:34 jakob Exp $ (LBL)";
d46 1
a46 1
	register u_int size;
d49 1
a49 1
	static u_int strsize = 0;
d56 1
a56 1
		strptr = (char *)malloc(strsize);
d58 1
a58 1
			fprintf(stderr, "savestr: malloc\n");
d62 1
a62 1
	(void)strcpy(strptr, str);
@


1.2
log
@missing include; goeran@@cdg.chalmers.se
@
text
@d1 2
d26 1
a26 1
    "@@(#) $Header: /cvs/src/usr.sbin/tcpdump/savestr.c,v 1.1 1999/07/28 20:41:36 jakob Exp $ (LBL)";
@


1.1
log
@-  Merge some changes from tcpdump 3.4
   -a flag; attempt to convert network and broadcast addresses to names
   Improved signal handling
   Miscellaneous fixes and typos
   OSPF MD5 authentication support

-  -X flag; emacs-hexl print (including ascii)

-  Add ECN bits to TCP and IP headers

-  IKE & IPsec (ESP & AH) support

OK deraadt@@
@
text
@d24 1
a24 1
    "@@(#) $Header: savestr.c,v 1.2 97/05/09 14:52:31 leres Exp $ (LBL)";
d31 1
@

