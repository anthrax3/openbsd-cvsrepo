head	1.12;
access;
symbols
	OPENBSD_6_2_BASE:1.12
	OPENBSD_6_1:1.11.0.30
	OPENBSD_6_1_BASE:1.11
	OPENBSD_6_0:1.11.0.26
	OPENBSD_6_0_BASE:1.11
	OPENBSD_5_9:1.11.0.22
	OPENBSD_5_9_BASE:1.11
	OPENBSD_5_8:1.11.0.24
	OPENBSD_5_8_BASE:1.11
	OPENBSD_5_7:1.11.0.16
	OPENBSD_5_7_BASE:1.11
	OPENBSD_5_6:1.11.0.20
	OPENBSD_5_6_BASE:1.11
	OPENBSD_5_5:1.11.0.18
	OPENBSD_5_5_BASE:1.11
	OPENBSD_5_4:1.11.0.14
	OPENBSD_5_4_BASE:1.11
	OPENBSD_5_3:1.11.0.12
	OPENBSD_5_3_BASE:1.11
	OPENBSD_5_2:1.11.0.10
	OPENBSD_5_2_BASE:1.11
	OPENBSD_5_1_BASE:1.11
	OPENBSD_5_1:1.11.0.8
	OPENBSD_5_0:1.11.0.6
	OPENBSD_5_0_BASE:1.11
	OPENBSD_4_9:1.11.0.4
	OPENBSD_4_9_BASE:1.11
	OPENBSD_4_8:1.11.0.2
	OPENBSD_4_8_BASE:1.11
	OPENBSD_4_7:1.10.0.6
	OPENBSD_4_7_BASE:1.10
	OPENBSD_4_6:1.10.0.8
	OPENBSD_4_6_BASE:1.10
	OPENBSD_4_5:1.10.0.4
	OPENBSD_4_5_BASE:1.10
	OPENBSD_4_4:1.10.0.2
	OPENBSD_4_4_BASE:1.10
	OPENBSD_4_3:1.9.0.4
	OPENBSD_4_3_BASE:1.9
	OPENBSD_4_2:1.9.0.2
	OPENBSD_4_2_BASE:1.9
	OPENBSD_4_1:1.8.0.6
	OPENBSD_4_1_BASE:1.8
	OPENBSD_4_0:1.8.0.4
	OPENBSD_4_0_BASE:1.8
	OPENBSD_3_9:1.8.0.2
	OPENBSD_3_9_BASE:1.8
	OPENBSD_3_8:1.7.0.2
	OPENBSD_3_8_BASE:1.7;
locks; strict;
comment	@.\" @;


1.12
date	2017.04.04.22.37.01;	author jsg;	state Exp;
branches;
next	1.11;
commitid	loTPS0cwI4SPyo3R;

1.11
date	2010.06.16.17.39.05;	author reyk;	state Exp;
branches;
next	1.10;

1.10
date	2008.04.04.06.21.27;	author otto;	state Exp;
branches;
next	1.9;

1.9
date	2007.05.31.19.20.29;	author jmc;	state Exp;
branches;
next	1.8;

1.8
date	2005.09.21.07.44.06;	author jmc;	state Exp;
branches;
next	1.7;

1.7
date	2005.07.09.07.53.26;	author jmc;	state Exp;
branches;
next	1.6;

1.6
date	2005.05.27.21.20.50;	author ho;	state Exp;
branches;
next	1.5;

1.5
date	2005.05.23.20.41.47;	author jmc;	state Exp;
branches;
next	1.4;

1.4
date	2005.05.23.17.32.49;	author ho;	state Exp;
branches;
next	1.3;

1.3
date	2005.05.01.20.44.12;	author jmc;	state Exp;
branches;
next	1.2;

1.2
date	2005.04.01.17.02.11;	author jmc;	state Exp;
branches;
next	1.1;

1.1
date	2005.03.30.18.44.49;	author ho;	state Exp;
branches;
next	;


desc
@@


1.12
log
@add a config test flag to sasyncd

ok reyk@@ deraadt@@ jmc@@
@
text
@.\" $OpenBSD: sasyncd.8,v 1.11 2010/06/16 17:39:05 reyk Exp $
.\"
.\" Copyright (c) 2005 Håkan Olsson.  All rights reserved.
.\"
.\" Redistribution and use in source and binary forms, with or without
.\" modification, are permitted provided that the following conditions
.\" are met:
.\"
.\" 1. Redistributions of source code must retain the above copyright
.\"    notice, this list of conditions and the following disclaimer.
.\" 2. Redistributions in binary form must reproduce the above copyright
.\"    notice, this list of conditions and the following disclaimer in the
.\"    documentation and/or other materials provided with the distribution.
.\"
.\" THIS SOFTWARE IS PROVIDED BY THE AUTHOR ``AS IS'' AND ANY EXPRESS OR
.\" IMPLIED WARRANTIES, INCLUDING, BUT NOT LIMITED TO, THE IMPLIED WARRANTIES
.\" OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE ARE DISCLAIMED.
.\" IN NO EVENT SHALL THE AUTHOR BE LIABLE FOR ANY DIRECT, INDIRECT,
.\" INCIDENTAL, SPECIAL, EXEMPLARY, OR CONSEQUENTIAL DAMAGES (INCLUDING, BUT
.\" NOT LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES; LOSS OF USE,
.\" DATA, OR PROFITS; OR BUSINESS INTERRUPTION) HOWEVER CAUSED AND ON ANY
.\" THEORY OF LIABILITY, WHETHER IN CONTRACT, STRICT LIABILITY, OR TORT
.\" (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE USE OF
.\" THIS SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.
.\"
.\" This code was written under funding by Multicom Security AB.
.\"
.\" Manual page for sasyncd
.\"
.Dd $Mdocdate: June 16 2010 $
.Dt SASYNCD 8
.Os
.Sh NAME
.Nm sasyncd
.Nd IPsec SA synchronization daemon for failover gateways
.Sh SYNOPSIS
.Nm
.Op Fl dnv
.Op Fl c Ar config-file
.Sh DESCRIPTION
The
.Nm
daemon synchronizes IPsec SA and SPD information between a number of
failover IPsec gateways.
The most typical scenario is to run
.Nm
on hosts also running
.Xr isakmpd 8
or
.Xr iked 8
and sharing a common IP address using
.Xr carp 4 .
.Pp
The daemon runs either in master or slave mode, in which the master
tracks all local IPsec SA changes and sends this information along to
all slaves so they will have the same data.
.Pp
When a slave connects, or reconnects, the master will transmit a
snapshot of all its current IPsec SA and SPD information.
.Ss Failover
.Nm
does not itself do any failover processing; the normal mode of
operation is to track state changes on a specified
.Xr carp 4
interface.
Whenever it changes,
.Nm
will follow suit.
For debugging purposes, it is possible to
.Qq lock
the daemon to a particular state; see
.Xr sasyncd.conf 5 .
.Ss sasyncd to sasyncd communication
As
.Nm
will transmit IPsec SA key and policy information over a network not
guaranteed to be private,
.Nm
messages are protected using AES and SHA.
The shared key used for the encryption must be specified in
.Pa /etc/sasyncd.conf .
See
.Xr sasyncd.conf 5
for more information.
.Ss SA replay counters
For SAs with replay protection enabled, such as those created by
.Xr isakmpd 8 ,
the
.Nm
hosts must have
.Xr pfsync 4
enabled to synchronize the in-kernel SA replay counters.
Without this replay counter synchronization the IPsec packets a host
sends after failover will not be accepted by the remote VPN endpoint.
.Pp
In most redundancy setups
.Xr pfsync 4
is likely already activated to synchronize
.Xr pf 4
states.
See
.Xr pfsync 4
for more information.
.Pp
The options are as follows:
.Bl -tag -width Ds
.It Fl c Ar config-file
If given, the
.Fl c
option specifies an alternate configuration file instead of
.Pa /etc/sasyncd.conf .
.It Fl d
The
.Fl d
option causes the daemon to run in the foreground, logging to stderr.
Without this option,
.Nm
sends log messages to
.Xr syslog 3 .
.It Fl n
Configtest mode.
Only check the configuration file for validity.
.It Fl v
The
.Fl v
option increases the verbosity level of the daemon, used primarily for
debugging.
This option may be specified several times.
.El
.Sh FILES
.Bl -tag -width /etc/ssl/private/sasyncd.key -compact
.It Pa /etc/sasyncd.conf
The default
.Nm
configuration file.
.El
.Sh SEE ALSO
.Xr crypto 3 ,
.Xr syslog 3 ,
.Xr carp 4 ,
.Xr ipsec 4 ,
.Xr pfsync 4 ,
.Xr sasyncd.conf 5 ,
.Xr iked 8 ,
.Xr isakmpd 8
.Sh HISTORY
The
.Nm
daemon first appeared in
.Ox 3.8 .
It was written in 2004-2005 by Hakan Olsson, in part sponsored by
Multicom Security AB, Sweden.
.Sh BUGS
Due to the absence of a proper on the wire SA transfer protocol,
.Nm
only works if the peers share the same hardware architecture.
@


1.11
log
@Add support to use sasyncd(8) with iked(8) instead of isakmpd(8).  The
new config option "control isakmpd|iked|all|none" in sasyncd.conf(5)
is used to set the mode; the default is to control isakmpd like
before.  When controlling iked, sasyncd connects to the daemon using
the imsg socket and sends imsgs - this is easy because the imsg
framework has been imported into libutil. iked(8) already includes
the important bits to work with sasyncd(8) (the active/passive mode
option in ikectl).

manpage bits ok jsg@@
ok jsg@@
@
text
@d1 1
a1 1
.\" $OpenBSD: sasyncd.8,v 1.10 2008/04/04 06:21:27 otto Exp $
d30 1
a30 1
.Dd $Mdocdate: April 4 2008 $
d38 1
a38 1
.Op Fl dv
d120 3
@


1.10
log
@document the bug that sasyncd peers should share the same
platform. it would be really nice if somebody would fix this.
ok mpf@@ todd@@ jmc@@
@
text
@d1 1
a1 1
.\" $OpenBSD: sasyncd.8,v 1.9 2007/05/31 19:20:29 jmc Exp $
d30 1
a30 1
.Dd $Mdocdate$
d49 2
d141 1
@


1.9
log
@convert to new .Dd format;
@
text
@d1 1
a1 1
.\" $OpenBSD: sasyncd.8,v 1.8 2005/09/21 07:44:06 jmc Exp $
d147 4
@


1.8
log
@IPSec -> IPsec
grammar

from joel@@
@
text
@d1 1
a1 1
.\" $OpenBSD: sasyncd.8,v 1.7 2005/07/09 07:53:26 jmc Exp $
d30 1
a30 1
.Dd August 07, 2004
@


1.7
log
@IP-address -> IP address;
from tamas tevesz;
@
text
@d1 1
a1 1
.\" $OpenBSD: sasyncd.8,v 1.6 2005/05/27 21:20:50 ho Exp $
d35 1
a35 1
.Nd IPSec SA synchronization daemon for failover gateways
d43 1
a43 1
daemon synchronizes IPSec SA and SPD information between a number of
d57 1
a57 1
snapshot of all it's current IPsec SA and SPD information.
d74 1
a74 1
will transmit IPSec SA key and policy information over a network not
@


1.6
log
@Update, also mention pfsync integration
@
text
@d1 1
a1 1
.\" $OpenBSD: sasyncd.8,v 1.5 2005/05/23 20:41:47 jmc Exp $
d49 1
a49 1
and sharing a common IP-address using
@


1.5
log
@Xr and whitespace fixes;
@
text
@d1 1
a1 1
.\" $OpenBSD: sasyncd.8,v 1.4 2005/05/23 17:32:49 ho Exp $
d43 2
a44 2
daemon synchronizes IPSec SA information between a number of failover
IPsec gateways.
d55 3
d67 1
a67 1
It is possible to
d71 1
a71 1
.Ss Host to host communication
d74 2
a75 2
will transmit IPSec SA keys over a network not guaranteed to be
private,
d83 19
d137 1
d145 1
a145 1
It was written in 2004 by Hakan Olsson, in part sponsored by
@


1.4
log
@No more SSL. Make text somewhat clearer.
@
text
@d1 1
a1 1
.\" $OpenBSD: sasyncd.8,v 1.3 2005/05/01 20:44:12 jmc Exp $
d77 1
a77 1
See 
d95 1
a95 1
.Xr syslog(3) .
@


1.3
log
@typarella; from alexandre anriot;
@
text
@d1 1
a1 1
.\" $OpenBSD: sasyncd.8,v 1.2 2005/04/01 17:02:11 jmc Exp $
d69 1
a69 1
All
d71 9
a79 9
host to host communication is protected by
.Xr ssl 8 ,
so the daemon requires certificates configured for each host.
Normally
.Pa /etc/ssl/sasyncd.crt
and
.Pa /etc/ssl/private/sasyncd.key
are used, although alternate locations may be specified in the
configuration file.
d92 4
d99 3
a101 2
option increases the verbosity level of the daemon.
This option can be specified several times.
a108 6
.It Pa /etc/ssl/sasyncd.crt
The default certificate.
.It Pa /etc/ssl/private/sasyncd.key
The default private key.
.It Pa /etc/ssl/ca.crt
The default CA certificate.
d111 2
a112 1
.Xr openssl 1 ,
d116 1
a116 2
.Xr isakmpd 8 ,
.Xr ssl 8
@


1.2
log
@.Ox 3.8, not 3.7;
@
text
@d1 1
a1 1
.\" $OpenBSD: sasyncd.8,v 1.1 2005/03/30 18:44:49 ho Exp $
d104 1
a104 1
.It Pa /etc/ssl/sascynd.crt
@


1.1
log
@Move sasyncd(8), for IPsec SA synchronization, in-tree. Work in progress.
deraadt@@ ok.
@
text
@d1 1
a1 1
.\" $OpenBSD$
d122 1
a122 1
.Ox 3.7 .
@

