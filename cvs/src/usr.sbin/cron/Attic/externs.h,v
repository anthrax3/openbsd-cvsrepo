head	1.19;
access;
symbols
	OPENBSD_5_8:1.16.0.6
	OPENBSD_5_8_BASE:1.16
	OPENBSD_5_7:1.16.0.2
	OPENBSD_5_7_BASE:1.16
	OPENBSD_5_6:1.11.0.8
	OPENBSD_5_6_BASE:1.11
	OPENBSD_5_5:1.11.0.6
	OPENBSD_5_5_BASE:1.11
	OPENBSD_5_4:1.11.0.2
	OPENBSD_5_4_BASE:1.11
	OPENBSD_5_3:1.10.0.36
	OPENBSD_5_3_BASE:1.10
	OPENBSD_5_2:1.10.0.34
	OPENBSD_5_2_BASE:1.10
	OPENBSD_5_1_BASE:1.10
	OPENBSD_5_1:1.10.0.32
	OPENBSD_5_0:1.10.0.30
	OPENBSD_5_0_BASE:1.10
	OPENBSD_4_9:1.10.0.28
	OPENBSD_4_9_BASE:1.10
	OPENBSD_4_8:1.10.0.26
	OPENBSD_4_8_BASE:1.10
	OPENBSD_4_7:1.10.0.22
	OPENBSD_4_7_BASE:1.10
	OPENBSD_4_6:1.10.0.24
	OPENBSD_4_6_BASE:1.10
	OPENBSD_4_5:1.10.0.20
	OPENBSD_4_5_BASE:1.10
	OPENBSD_4_4:1.10.0.18
	OPENBSD_4_4_BASE:1.10
	OPENBSD_4_3:1.10.0.16
	OPENBSD_4_3_BASE:1.10
	OPENBSD_4_2:1.10.0.14
	OPENBSD_4_2_BASE:1.10
	OPENBSD_4_1:1.10.0.12
	OPENBSD_4_1_BASE:1.10
	OPENBSD_4_0:1.10.0.10
	OPENBSD_4_0_BASE:1.10
	OPENBSD_3_9:1.10.0.8
	OPENBSD_3_9_BASE:1.10
	OPENBSD_3_8:1.10.0.6
	OPENBSD_3_8_BASE:1.10
	OPENBSD_3_7:1.10.0.4
	OPENBSD_3_7_BASE:1.10
	OPENBSD_3_6:1.10.0.2
	OPENBSD_3_6_BASE:1.10
	OPENBSD_3_5:1.9.0.6
	OPENBSD_3_5_BASE:1.9
	OPENBSD_3_4:1.9.0.4
	OPENBSD_3_4_BASE:1.9
	OPENBSD_3_3:1.9.0.2
	OPENBSD_3_3_BASE:1.9
	OPENBSD_3_2:1.8.0.2
	OPENBSD_3_2_BASE:1.8
	OPENBSD_3_1:1.3.0.6
	OPENBSD_3_1_BASE:1.3
	OPENBSD_3_0:1.3.0.4
	OPENBSD_3_0_BASE:1.3
	OPENBSD_2_9_BASE:1.3
	OPENBSD_2_9:1.3.0.2
	OPENBSD_2_8:1.2.0.16
	OPENBSD_2_8_BASE:1.2
	OPENBSD_2_7:1.2.0.14
	OPENBSD_2_7_BASE:1.2
	OPENBSD_2_6:1.2.0.12
	OPENBSD_2_6_BASE:1.2
	OPENBSD_2_5:1.2.0.10
	OPENBSD_2_5_BASE:1.2
	OPENBSD_2_4:1.2.0.8
	OPENBSD_2_4_BASE:1.2
	OPENBSD_2_3:1.2.0.6
	OPENBSD_2_3_BASE:1.2
	OPENBSD_2_2:1.2.0.4
	OPENBSD_2_2_BASE:1.2
	OPENBSD_2_1:1.2.0.2
	OPENBSD_2_1_BASE:1.2
	OPENBSD_2_0:1.1.1.1.0.2
	OPENBSD_2_0_BASE:1.1.1.1
	netbsd_1_1:1.1.1.1;
locks; strict;
comment	@ * @;


1.19
date	2015.11.04.20.28.17;	author millert;	state dead;
branches;
next	1.18;
commitid	6N0oXtYc5KM1a7DW;

1.18
date	2015.11.04.12.53.05;	author millert;	state Exp;
branches;
next	1.17;
commitid	2QMTGnuouMIAKrAq;

1.17
date	2015.10.06.14.58.37;	author tedu;	state Exp;
branches;
next	1.16;
commitid	DORRwC1MyrO1Yl4N;

1.16
date	2015.02.09.22.35.08;	author deraadt;	state Exp;
branches;
next	1.15;
commitid	eGq01x6bjr83TVho;

1.15
date	2015.01.14.17.30.53;	author millert;	state Exp;
branches;
next	1.14;
commitid	qsePpGDsMLqV3DYZ;

1.14
date	2015.01.14.17.27.30;	author millert;	state Exp;
branches;
next	1.13;
commitid	jXmo2gNqOzD6QEsx;

1.13
date	2015.01.14.17.27.13;	author millert;	state Exp;
branches;
next	1.12;
commitid	DFl2K6Llc1m42RPv;

1.12
date	2014.10.29.04.39.02;	author deraadt;	state Exp;
branches;
next	1.11;
commitid	a5uifLuQvX2DkoEc;

1.11
date	2013.04.17.15.58.45;	author deraadt;	state Exp;
branches;
next	1.10;

1.10
date	2004.06.17.22.11.55;	author millert;	state Exp;
branches;
next	1.9;

1.9
date	2003.02.20.20.38.08;	author millert;	state Exp;
branches;
next	1.8;

1.8
date	2002.07.17.22.10.56;	author millert;	state Exp;
branches;
next	1.7;

1.7
date	2002.07.15.19.13.29;	author millert;	state Exp;
branches;
next	1.6;

1.6
date	2002.07.08.23.42.17;	author millert;	state Exp;
branches;
next	1.5;

1.5
date	2002.07.08.18.11.02;	author millert;	state Exp;
branches;
next	1.4;

1.4
date	2002.05.09.21.22.01;	author millert;	state Exp;
branches;
next	1.3;

1.3
date	2001.02.18.19.48.34;	author millert;	state Exp;
branches;
next	1.2;

1.2
date	96.11.01.23.27.35;	author millert;	state Exp;
branches;
next	1.1;

1.1
date	95.10.18.08.47.30;	author deraadt;	state Exp;
branches
	1.1.1.1;
next	;

1.1.1.1
date	95.10.18.08.47.30;	author deraadt;	state Exp;
branches;
next	;


desc
@@


1.19
log
@Change cron from including all headers in every file to only including
what each .c file needs.  I have not removed cron.h since it will
be used in a future clean up of the cron's .h files.  OK nicm@@
@
text
@/*	$OpenBSD: externs.h,v 1.18 2015/11/04 12:53:05 millert Exp $	*/

/* Copyright 1993,1994 by Paul Vixie
 * Copyright (c) 2004 by Internet Systems Consortium, Inc. ("ISC")
 * Copyright (c) 1997,2000 by Internet Software Consortium, Inc.
 *
 * Permission to use, copy, modify, and distribute this software for any
 * purpose with or without fee is hereby granted, provided that the above
 * copyright notice and this permission notice appear in all copies.
 *
 * THE SOFTWARE IS PROVIDED "AS IS" AND ISC DISCLAIMS ALL WARRANTIES
 * WITH REGARD TO THIS SOFTWARE INCLUDING ALL IMPLIED WARRANTIES OF
 * MERCHANTABILITY AND FITNESS.  IN NO EVENT SHALL ISC BE LIABLE FOR
 * ANY SPECIAL, DIRECT, INDIRECT, OR CONSEQUENTIAL DAMAGES OR ANY DAMAGES
 * WHATSOEVER RESULTING FROM LOSS OF USE, DATA OR PROFITS, WHETHER IN AN
 * ACTION OF CONTRACT, NEGLIGENCE OR OTHER TORTIOUS ACTION, ARISING OUT
 * OF OR IN CONNECTION WITH THE USE OR PERFORMANCE OF THIS SOFTWARE.
 */

/* reorder these #include's at your peril */

#include <sys/types.h>
#include <sys/time.h>
#include <sys/wait.h>
#include <sys/file.h>
#include <sys/stat.h>
#include <sys/socket.h>
#include <sys/un.h>

#include <bitstring.h>
#include <ctype.h>
#include <dirent.h>
#include <errno.h>
#include <fcntl.h>
#include <grp.h>
#include <limits.h>
#include <locale.h>
#include <pwd.h>
#include <signal.h>
#include <stdarg.h>
#include <stdio.h>
#include <stdlib.h>
#include <string.h>
#include <time.h>
#include <poll.h>
#include <unistd.h>
#include <utime.h>
#include <syslog.h>
#include <login_cap.h>
#include <bsd_auth.h>
@


1.18
log
@Change some globals from extern to static when they are not used
outside their respective .c files.  Also remove some unused defines.
OK jung@@
@
text
@d1 1
a1 1
/*	$OpenBSD: externs.h,v 1.17 2015/10/06 14:58:37 tedu Exp $	*/
@


1.17
log
@clear out some more legacy code and whatnot
@
text
@d1 1
a1 1
/*	$OpenBSD: externs.h,v 1.16 2015/02/09 22:35:08 deraadt Exp $	*/
d48 3
a50 15

# include <syslog.h>

# include <login_cap.h>

# include <bsd_auth.h>

#ifndef TZNAME_ALREADY_DEFINED
extern char *tzname[2];
#endif
#define TZONE(tm) tzname[(tm).tm_isdst]

#ifndef WCOREDUMP
# define WCOREDUMP(st)          (((st) & 0200) != 0)
#endif
@


1.16
log
@correct copyright, upon approval from paul vixie via todd miller.  the
head copyright assertion was seperated from the remaining ones.
@
text
@d1 1
a1 1
/*	$OpenBSD: externs.h,v 1.15 2015/01/14 17:30:53 millert Exp $	*/
a48 1
#if defined(SYSLOG)
a49 1
#endif
a50 1
#if defined(LOGIN_CAP)
a51 1
#endif /*LOGIN_CAP*/
a52 1
#if defined(BSD_AUTH)
a53 1
#endif /*BSD_AUTH*/
@


1.15
log
@Replace MAXHOSTNAMELEN with HOST_NAME_MAX+1 and MAXNAMLEN with NAME_MAX
and use limits.h instead of sys/param.h.
@
text
@d1 1
a1 1
/*	$OpenBSD: externs.h,v 1.14 2015/01/14 17:27:30 millert Exp $	*/
a3 4
 * All rights reserved
 */

/*
@


1.14
log
@Use standard types for wait, readdir, signals and pids.
@
text
@d1 1
a1 1
/*	$OpenBSD: externs.h,v 1.13 2015/01/14 17:27:13 millert Exp $	*/
a25 1
#include <sys/param.h>
d40 1
@


1.13
log
@Remove compatibility defines for ancient systems.  We assume a
reasonable level of POSIX compliance.
@
text
@d1 1
a1 1
/*	$OpenBSD: externs.h,v 1.12 2014/10/29 04:39:02 deraadt Exp $	*/
a63 5

#define DIR_T	struct dirent
#define WAIT_T	int
#define SIG_T	sig_t
#define PID_T	pid_t
@


1.12
log
@use poll() instead of the select malloc/free dance which was used to
avoid fd_set overflows.

Back when I was young, I fixed these throughout the tree, and the world
continued on ignoring the issue...  The malloc/free dance was used because
poll() was not very portable yet.  Now poll() is commonplace, and we should
use this safer API.

ok guenther millert
@
text
@d1 1
a1 1
/*	$OpenBSD: externs.h,v 1.11 2013/04/17 15:58:45 deraadt Exp $	*/
a29 1
#include <sys/fcntl.h>
a36 3
#ifndef isascii
#define isascii(c)      ((unsigned)(c)<=0177)
#endif
a73 46

#if (defined(BSD)) && (BSD >= 198606) || defined(__linux)
# define HAVE_FCHOWN
# define HAVE_FCHMOD
#endif

#if (defined(BSD)) && (BSD >= 199103) || defined(__linux)
# define HAVE_SAVED_UIDS
#endif

#define MY_UID(pw) getuid()
#define MY_GID(pw) getgid()

/* getopt() isn't part of POSIX.  some systems define it in <stdlib.h> anyway.
 * of those that do, some complain that our definition is different and some
 * do not.  to add to the misery and confusion, some systems define getopt()
 * in ways that we cannot predict or comprehend, yet do not define the adjunct
 * external variables needed for the interface.
 */
#if (!defined(BSD) || (BSD < 198911))
int	getopt(int, char * const *, const char *);
#endif

#if (!defined(BSD) || (BSD < 199103))
extern	char *optarg;
extern	int optind, opterr, optopt;
#endif

/* digital unix needs this but does not give us a way to identify it.
 */
extern	int		flock(int, int);

/* not all systems who provide flock() provide these definitions.
 */
#ifndef LOCK_SH
# define LOCK_SH 1
#endif
#ifndef LOCK_EX
# define LOCK_EX 2
#endif
#ifndef LOCK_NB
# define LOCK_NB 4
#endif
#ifndef LOCK_UN
# define LOCK_UN 8
#endif
@


1.11
log
@Adapt cron and at for future large time_t and tv_sec types.  These were some
of the harder programs to adapt, so let me know if problems happen.
tested by guenther, gilles, chl, others
@
text
@d1 1
a1 1
/*	$OpenBSD: externs.h,v 1.10 2004/06/17 22:11:55 millert Exp $	*/
d53 1
@


1.10
log
@UUpdate ISC copyright year to 2004
Remove unused macros Skip_Line and MkLower
Remove trailing whitespace
@
text
@d1 1
a1 1
/*	$OpenBSD: externs.h,v 1.9 2003/02/20 20:38:08 millert Exp $	*/
a70 1
#define TIME_T	time_t
@


1.9
log
@Sync with ISC cron-current + my at(1) integration.
The at(1) code is now more tightly integrated into the cron codebase.
@
text
@d1 1
a1 1
/*	$OpenBSD: externs.h,v 1.8 2002/07/17 22:10:56 millert Exp $	*/
d8 1
d15 7
a21 8
 * THE SOFTWARE IS PROVIDED "AS IS" AND INTERNET SOFTWARE CONSORTIUM DISCLAIMS
 * ALL WARRANTIES WITH REGARD TO THIS SOFTWARE INCLUDING ALL IMPLIED WARRANTIES
 * OF MERCHANTABILITY AND FITNESS. IN NO EVENT SHALL INTERNET SOFTWARE
 * CONSORTIUM BE LIABLE FOR ANY SPECIAL, DIRECT, INDIRECT, OR CONSEQUENTIAL
 * DAMAGES OR ANY DAMAGES WHATSOEVER RESULTING FROM LOSS OF USE, DATA OR
 * PROFITS, WHETHER IN AN ACTION OF CONTRACT, NEGLIGENCE OR OTHER TORTIOUS
 * ACTION, ARISING OUT OF OR IN CONNECTION WITH THE USE OR PERFORMANCE OF THIS
 * SOFTWARE.
@


1.8
log
@Include limits.h since we use LONG_MAX; we squeaked by with an
implicit inclusion before.
@
text
@d1 1
a1 1
/*	$OpenBSD: externs.h,v 1.7 2002/07/15 19:13:29 millert Exp $	*/
a27 1
#if !defined(AIX) && !defined(UNICOS)
a28 1
#endif
d33 2
a44 1
#include <limits.h>
d61 1
a61 1
#include <login_cap.h>
d65 1
a65 1
#include <bsd_auth.h>
d79 1
a79 1
#if (BSD >= 198606)
d84 2
a85 2
#if (BSD >= 199103)
# define HAVE_SAVED_GIDS
@


1.7
log
@Move atrun(8) functionality into cron(8) proper.  This fixes the
long-standing annoyance that atrun's granularity is 10 minutes.
Most at jobs run with a 1 minute granularity.  Jobs submitted via
"at now" or "batch" will run immediately.  Includes a rewritten
cron(8) man page.  at(1) will be integrated more closely into
cron at a future date.

Upgrading notes:
    the atrun job in root's crontab should be removed.
    the /var/at/spool directory is no longer used
@
text
@d1 1
a1 1
/*	$OpenBSD: externs.h,v 1.6 2002/07/08 23:42:17 millert Exp $	*/
d45 1
@


1.6
log
@minor cosmetic change to reduce diffs
@
text
@d1 1
a1 1
/*	$OpenBSD: externs.h,v 1.5 2002/07/08 18:11:02 millert Exp $	*/
a59 8
#if (defined(BSD)) && (BSD >= 199103) || defined(__linux) || defined(AIX)
# include <paths.h>
#endif /*BSD*/

#if !defined(_PATH_SENDMAIL)
# define _PATH_SENDMAIL "/usr/lib/sendmail"
#endif /*SENDMAIL*/

d110 1
a110 1
/* not all systems who provice flock() provide these definitions.
@


1.5
log
@Merge in some changes from Paul Vixie's tree; most are cosmetic
o ANSI function headers
o return (foo) not return foo
o add -oi to sendmail flags
o update email address in man pages
o make some strings const
o completely remove globbing cruft from popen.c
o whitespace changes
o add DOW_STAR to flags for "monthly", "weekly", and "daily" cron entries
@
text
@d1 1
a1 1
/*	$OpenBSD: externs.h,v 1.4 2002/05/09 21:22:01 millert Exp $	*/
d6 1
@


1.4
log
@crontab is no longer setuid root, it is now setgid crontab.
These changes were modelled after the Owl version of vixie-cron,
but developed independently.

Our crontab used to send cron SIGUSR1 to tell cron to reread the
spool dir.  Now that crontab is not setuid root this doesn't work.
Instead, crontab pokes cron via a Unix domain socket located in the
tabs dir.

Please note, after these changes, the owner on user crontab files
will have to be changed manually from root to the uid of the
corresponding user for crontab to be usable.  cron itself will accept
tab files owned by either root or the user.
Also, any /var/cron/{allow,deny} files must be readable by group crontab.
@
text
@d1 1
a1 1
/*	$OpenBSD: externs.h,v 1.3 2001/02/18 19:48:34 millert Exp $	*/
d37 3
d130 4
@


1.3
log
@Update to ISC cron 4.0b1 + our patches.  This is now under a BSD license.
I also fixed the signal handlers while I was at it.
@
text
@d1 1
a1 1
/*	$OpenBSD$	*/
d27 1
d29 1
d89 1
a89 1
# define HAVE_SAVED_UIDS
a93 6

#if !defined(AIX) && !defined(UNICOS)
# define SYS_TIME_H 1
#else
# define SYS_TIME_H 0
#endif
@


1.2
log
@Check malloc/strdup ret val and deal.
@
text
@d1 2
d5 3
d9 3
a11 8
 * Distribute freely, except: don't remove my name from the source or
 * documentation (don't take credit for my work), mark your changes (don't
 * get me blamed for your possible bugs), don't alter or remove this
 * notice.  May be sold if buildable source is provided to buyer.  No
 * warrantee of any kind, express or implied, is included with this
 * software; use at your own risk, responsibility for damages (if any) to
 * anyone resulting from the use of this software rests entirely with the
 * user.
d13 8
a20 3
 * Send bug reports, bug fixes, enhancements, requests, flames, etc., and
 * I'll try to keep a version up to date.  I can be reached as follows:
 * Paul Vixie          <paul@@vix.com>          uunet!decwrl!vixie!paul
d23 54
a76 9
#if defined(POSIX) || defined(ATT)
# include <stdlib.h>
# include <unistd.h>
# include <string.h>
# include <dirent.h>
# include <errno.h>
# define DIR_T	struct dirent
# define WAIT_T	int
# define WAIT_IS_INT 1
a77 1
# define TZONE(tm) tzname[(tm).tm_isdst]
d79 1
d81 16
a96 35
#if defined(UNIXPC)
# undef WAIT_T
# undef WAIT_IS_INT
# define WAIT_T	union wait
#endif

#if defined(POSIX)
# define SIG_T	sig_t
# define TIME_T	time_t
# define PID_T pid_t
#endif

#if defined(ATT)
# define SIG_T	void
# define TIME_T	long
# define PID_T int
#endif

#if !defined(POSIX) && !defined(ATT)
/* classic BSD */
extern	time_t		time();
extern	unsigned	sleep();
extern	struct tm	*localtime();
extern	struct passwd	*getpwnam();
extern	int		errno;
extern	void		perror(), exit(), free();
extern	char		*getenv(), *strcpy(), *strchr(), *strtok();
extern	void		*malloc(), *realloc();
# define SIG_T	void
# define TIME_T	long
# define PID_T int
# define WAIT_T	union wait
# define DIR_T	struct direct
# include <sys/dir.h>
# define TZONE(tm) (tm).tm_zone
d105 2
a106 2
#if (!defined(BSD) || (BSD < 198911)) && !defined(ATT) && !defined(UNICOS)
int	getopt __P((int, char * const *, const char *));
d114 3
a116 36
#if WAIT_IS_INT
# ifndef WEXITSTATUS
#  define WEXITSTATUS(x) (((x) >> 8) & 0xff)
# endif
# ifndef WTERMSIG
#  define WTERMSIG(x)	((x) & 0x7f)
# endif
# ifndef WCOREDUMP
#  define WCOREDUMP(x)	((x) & 0x80)
# endif
#else /*WAIT_IS_INT*/
# ifndef WEXITSTATUS
#  define WEXITSTATUS(x) ((x).w_retcode)
# endif
# ifndef WTERMSIG
#  define WTERMSIG(x)	((x).w_termsig)
# endif
# ifndef WCOREDUMP
#  define WCOREDUMP(x)	((x).w_coredump)
# endif
#endif /*WAIT_IS_INT*/

#ifndef WIFSIGNALED
#define WIFSIGNALED(x)	(WTERMSIG(x) != 0)
#endif
#ifndef WIFEXITED
#define WIFEXITED(x)	(WTERMSIG(x) == 0)
#endif

#ifdef NEED_STRCASECMP
extern	int		strcasecmp __P((char *, char *));
#endif

#ifdef NEED_STRDUP
extern	char		*strdup __P((char *));
#endif
d118 4
a121 2
#ifdef NEED_STRERROR
extern	char		*strerror __P((int));
d123 1
a123 4

#ifdef NEED_FLOCK
extern	int		flock __P((int, int));
# define LOCK_SH 1
d125 2
d128 2
a130 16
#endif

#ifdef NEED_SETSID
extern	int		setsid __P((void));
#endif

#ifdef NEED_GETDTABLESIZE
extern	int		getdtablesize __P((void));
#endif

#ifdef NEED_SETENV
extern	int		setenv __P((char *, char *, int));
#endif

#ifdef NEED_VFORK
extern	PID_T		vfork __P((void));
@


1.1
log
@Initial revision
@
text
@d23 1
@


1.1.1.1
log
@initial import of NetBSD tree
@
text
@@
