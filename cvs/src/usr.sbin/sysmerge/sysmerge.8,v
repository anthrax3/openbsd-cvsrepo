head	1.79;
access;
symbols
	OPENBSD_6_2:1.79.0.2
	OPENBSD_6_2_BASE:1.79
	OPENBSD_6_1:1.79.0.4
	OPENBSD_6_1_BASE:1.79
	OPENBSD_6_0:1.77.0.2
	OPENBSD_6_0_BASE:1.77
	OPENBSD_5_9:1.75.0.2
	OPENBSD_5_9_BASE:1.75
	OPENBSD_5_8:1.69.0.4
	OPENBSD_5_8_BASE:1.69
	OPENBSD_5_7:1.68.0.2
	OPENBSD_5_7_BASE:1.68
	OPENBSD_5_6:1.50.0.4
	OPENBSD_5_6_BASE:1.50
	OPENBSD_5_5:1.44.0.4
	OPENBSD_5_5_BASE:1.44
	OPENBSD_5_4:1.39.0.2
	OPENBSD_5_4_BASE:1.39
	OPENBSD_5_3:1.38.0.2
	OPENBSD_5_3_BASE:1.38
	OPENBSD_5_2:1.36.0.2
	OPENBSD_5_2_BASE:1.36
	OPENBSD_5_1_BASE:1.35
	OPENBSD_5_1:1.35.0.4
	OPENBSD_5_0:1.35.0.2
	OPENBSD_5_0_BASE:1.35
	OPENBSD_4_9:1.34.0.2
	OPENBSD_4_9_BASE:1.34
	OPENBSD_4_8:1.32.0.2
	OPENBSD_4_8_BASE:1.32
	OPENBSD_4_7:1.30.0.2
	OPENBSD_4_7_BASE:1.30
	OPENBSD_4_6:1.26.0.4
	OPENBSD_4_6_BASE:1.26
	OPENBSD_4_5:1.14.0.2
	OPENBSD_4_5_BASE:1.14
	OPENBSD_4_4:1.10.0.2
	OPENBSD_4_4_BASE:1.10;
locks; strict;
comment	@.\" @;


1.79
date	2016.09.06.12.32.13;	author ajacoutot;	state Exp;
branches;
next	1.78;
commitid	dCrY1cE4vqFKFnkR;

1.78
date	2016.09.02.12.17.33;	author tb;	state Exp;
branches;
next	1.77;
commitid	Z6hUPnAcS0GtAGum;

1.77
date	2016.05.14.14.44.35;	author ajacoutot;	state Exp;
branches;
next	1.76;
commitid	PoOLTNRkFJ5FLSGp;

1.76
date	2016.04.27.21.04.34;	author ajacoutot;	state Exp;
branches;
next	1.75;
commitid	Zz9ICpL1AqhawujO;

1.75
date	2016.01.14.19.58.32;	author ajacoutot;	state Exp;
branches;
next	1.74;
commitid	zaUG2pzRo1oBWzYm;

1.74
date	2015.10.16.19.55.39;	author ajacoutot;	state Exp;
branches;
next	1.73;
commitid	Hk7p5VrQyEpxrBhy;

1.73
date	2015.09.18.17.03.44;	author ajacoutot;	state Exp;
branches;
next	1.72;
commitid	BvkHneZ8jUxGRNXu;

1.72
date	2015.09.07.10.02.04;	author ajacoutot;	state Exp;
branches;
next	1.71;
commitid	uTl2wFu2kYhF9nn8;

1.71
date	2015.08.24.11.03.41;	author ajacoutot;	state Exp;
branches;
next	1.70;
commitid	7NgJOc03qdu2WIgz;

1.70
date	2015.08.24.10.42.08;	author ajacoutot;	state Exp;
branches;
next	1.69;
commitid	fjvxZoJ9vynXEQQK;

1.69
date	2015.07.27.17.28.40;	author sobrado;	state Exp;
branches;
next	1.68;
commitid	a73SHFfjDK7MTyGx;

1.68
date	2014.11.26.15.52.30;	author ajacoutot;	state Exp;
branches;
next	1.67;
commitid	NYWFjNVrcySCJ9AK;

1.67
date	2014.09.05.17.26.08;	author ajacoutot;	state Exp;
branches;
next	1.66;
commitid	DHkMdwAsiBcefCpO;

1.66
date	2014.09.05.17.19.48;	author ajacoutot;	state Exp;
branches;
next	1.65;
commitid	MKPXKtzl35aMRlMw;

1.65
date	2014.09.05.10.35.31;	author jmc;	state Exp;
branches;
next	1.64;
commitid	wF313SLcsiDY2HMs;

1.64
date	2014.09.05.07.16.38;	author ajacoutot;	state Exp;
branches;
next	1.63;
commitid	yaDCqVaKVik059zG;

1.63
date	2014.08.30.14.44.20;	author ajacoutot;	state Exp;
branches;
next	1.62;
commitid	5FDcSMLWSi0iA0fY;

1.62
date	2014.08.29.06.03.34;	author jmc;	state Exp;
branches;
next	1.61;
commitid	R3Zvinrjdv5GhpTO;

1.61
date	2014.08.28.22.09.00;	author ajacoutot;	state Exp;
branches;
next	1.60;
commitid	wQne3pQKhafgX5RD;

1.60
date	2014.08.28.20.55.28;	author jmc;	state Exp;
branches;
next	1.59;
commitid	nbxVBRYGlXyYC9h3;

1.59
date	2014.08.28.17.43.21;	author ajacoutot;	state Exp;
branches;
next	1.58;
commitid	DgyVyKzJEDoaNCTF;

1.58
date	2014.08.26.21.29.56;	author ajacoutot;	state Exp;
branches;
next	1.57;
commitid	O0yWo4lc1SMKXXmU;

1.57
date	2014.08.11.09.03.27;	author ajacoutot;	state Exp;
branches;
next	1.56;
commitid	bPvVUTFWHSx3SyRY;

1.56
date	2014.08.11.06.30.39;	author ajacoutot;	state Exp;
branches;
next	1.55;
commitid	q2tSstc7DaMWBCLB;

1.55
date	2014.08.10.17.15.18;	author jmc;	state Exp;
branches;
next	1.54;
commitid	8ebGH2HELtax1UVM;

1.54
date	2014.08.09.16.39.25;	author jmc;	state Exp;
branches;
next	1.53;
commitid	qc6NMEDZqd3fiEKC;

1.53
date	2014.08.09.12.45.03;	author ajacoutot;	state Exp;
branches;
next	1.52;
commitid	FskWo4sInNg8ZY4O;

1.52
date	2014.08.09.12.34.05;	author ajacoutot;	state Exp;
branches;
next	1.51;
commitid	QIcMDBFc9gImxa58;

1.51
date	2014.08.08.17.04.55;	author ajacoutot;	state Exp;
branches;
next	1.50;
commitid	HD586OzJQCuC6sHI;

1.50
date	2014.07.15.09.27.04;	author ajacoutot;	state Exp;
branches;
next	1.49;
commitid	y5g5q0ndqFZgnXb1;

1.49
date	2014.07.13.07.12.41;	author ajacoutot;	state Exp;
branches;
next	1.48;
commitid	N0cI7FlzHM0PVQdF;

1.48
date	2014.07.12.16.26.35;	author ajacoutot;	state Exp;
branches;
next	1.47;
commitid	7pASukHTS9tEh4uI;

1.47
date	2014.07.12.15.31.54;	author ajacoutot;	state Exp;
branches;
next	1.46;
commitid	4ZnxXWzBDY3JwfP8;

1.46
date	2014.07.10.11.00.03;	author ajacoutot;	state Exp;
branches;
next	1.45;
commitid	nqjY67Y9lxMFqQhf;

1.45
date	2014.03.26.23.03.59;	author ajacoutot;	state Exp;
branches;
next	1.44;

1.44
date	2014.01.28.09.42.42;	author ajacoutot;	state Exp;
branches;
next	1.43;

1.43
date	2014.01.28.09.25.22;	author ajacoutot;	state Exp;
branches;
next	1.42;

1.42
date	2014.01.27.17.05.37;	author ajacoutot;	state Exp;
branches;
next	1.41;

1.41
date	2014.01.21.19.03.44;	author ajacoutot;	state Exp;
branches;
next	1.40;

1.40
date	2013.09.10.08.44.38;	author ajacoutot;	state Exp;
branches;
next	1.39;

1.39
date	2013.07.16.11.13.34;	author schwarze;	state Exp;
branches;
next	1.38;

1.38
date	2012.08.28.05.42.07;	author ajacoutot;	state Exp;
branches;
next	1.37;

1.37
date	2012.08.15.19.25.41;	author jmc;	state Exp;
branches;
next	1.36;

1.36
date	2012.02.17.14.06.42;	author ajacoutot;	state Exp;
branches;
next	1.35;

1.35
date	2011.07.21.12.31.51;	author ajacoutot;	state Exp;
branches;
next	1.34;

1.34
date	2010.11.11.12.51.31;	author ajacoutot;	state Exp;
branches;
next	1.33;

1.33
date	2010.11.11.10.46.10;	author ajacoutot;	state Exp;
branches;
next	1.32;

1.32
date	2010.07.05.08.30.28;	author ajacoutot;	state Exp;
branches;
next	1.31;

1.31
date	2010.03.20.09.45.11;	author ajacoutot;	state Exp;
branches;
next	1.30;

1.30
date	2009.12.18.13.51.02;	author ajacoutot;	state Exp;
branches;
next	1.29;

1.29
date	2009.12.06.16.21.36;	author ajacoutot;	state Exp;
branches;
next	1.28;

1.28
date	2009.08.23.20.06.32;	author ajacoutot;	state Exp;
branches;
next	1.27;

1.27
date	2009.08.18.08.27.32;	author ajacoutot;	state Exp;
branches;
next	1.26;

1.26
date	2009.06.05.06.27.52;	author jmc;	state Exp;
branches;
next	1.25;

1.25
date	2009.06.04.23.24.17;	author ajacoutot;	state Exp;
branches;
next	1.24;

1.24
date	2009.05.12.20.58.15;	author jmc;	state Exp;
branches;
next	1.23;

1.23
date	2009.05.12.13.04.18;	author jmc;	state Exp;
branches;
next	1.22;

1.22
date	2009.05.11.20.25.55;	author ajacoutot;	state Exp;
branches;
next	1.21;

1.21
date	2009.04.12.07.43.17;	author ajacoutot;	state Exp;
branches;
next	1.20;

1.20
date	2009.04.09.14.43.54;	author ajacoutot;	state Exp;
branches;
next	1.19;

1.19
date	2009.04.09.10.44.50;	author ajacoutot;	state Exp;
branches;
next	1.18;

1.18
date	2009.04.06.14.39.23;	author jmc;	state Exp;
branches;
next	1.17;

1.17
date	2009.04.06.10.35.20;	author ajacoutot;	state Exp;
branches;
next	1.16;

1.16
date	2009.03.25.18.02.12;	author ajacoutot;	state Exp;
branches;
next	1.15;

1.15
date	2009.03.25.13.20.02;	author ajacoutot;	state Exp;
branches;
next	1.14;

1.14
date	2009.02.17.16.48.11;	author ajacoutot;	state Exp;
branches;
next	1.13;

1.13
date	2008.12.17.09.17.47;	author jmc;	state Exp;
branches;
next	1.12;

1.12
date	2008.12.16.22.23.55;	author ajacoutot;	state Exp;
branches;
next	1.11;

1.11
date	2008.09.12.13.31.59;	author ajacoutot;	state Exp;
branches;
next	1.10;

1.10
date	2008.07.04.15.03.45;	author sthen;	state Exp;
branches;
next	1.9;

1.9
date	2008.07.04.10.23.56;	author jmc;	state Exp;
branches;
next	1.8;

1.8
date	2008.06.13.00.46.57;	author ajacoutot;	state Exp;
branches;
next	1.7;

1.7
date	2008.06.13.00.33.04;	author ajacoutot;	state Exp;
branches;
next	1.6;

1.6
date	2008.06.09.23.11.01;	author ajacoutot;	state Exp;
branches;
next	1.5;

1.5
date	2008.06.01.15.07.00;	author ajacoutot;	state Exp;
branches;
next	1.4;

1.4
date	2008.05.14.07.48.35;	author ajacoutot;	state Exp;
branches;
next	1.3;

1.3
date	2008.04.30.20.15.54;	author ajacoutot;	state Exp;
branches;
next	1.2;

1.2
date	2008.04.24.17.51.41;	author deraadt;	state Exp;
branches;
next	1.1;

1.1
date	2008.04.22.20.53.16;	author ajacoutot;	state Exp;
branches;
next	;


desc
@@


1.79
log
@Mention PAGER behavior when undefined/empty.

from Michael Reed
ok jmc@@
@
text
@.\"	$OpenBSD: sysmerge.8,v 1.78 2016/09/02 12:17:33 tb Exp $
.\"
.\" Copyright (c) 2008 Antoine Jacoutot <ajacoutot@@openbsd.org>
.\"
.\" Permission to use, copy, modify, and distribute this software for any
.\" purpose with or without fee is hereby granted, provided that the above
.\" copyright notice and this permission notice appear in all copies.
.\"
.\" THE SOFTWARE IS PROVIDED "AS IS" AND THE AUTHOR DISCLAIMS ALL WARRANTIES
.\" WITH REGARD TO THIS SOFTWARE INCLUDING ALL IMPLIED WARRANTIES OF
.\" MERCHANTABILITY AND FITNESS. IN NO EVENT SHALL THE AUTHOR BE LIABLE FOR
.\" ANY SPECIAL, DIRECT, INDIRECT, OR CONSEQUENTIAL DAMAGES OR ANY DAMAGES
.\" WHATSOEVER RESULTING FROM LOSS OF USE, DATA OR PROFITS, WHETHER IN AN
.\" ACTION OF CONTRACT, NEGLIGENCE OR OTHER TORTIOUS ACTION, ARISING OUT OF
.\" OR IN CONNECTION WITH THE USE OR PERFORMANCE OF THIS SOFTWARE.
.\"
.Dd $Mdocdate: September 2 2016 $
.Dt SYSMERGE 8
.Os
.Sh NAME
.Nm sysmerge
.Nd update system configuration files
.Sh SYNOPSIS
.Nm
.Bk -words
.Op Fl bdp
.Ek
.Sh DESCRIPTION
.Nm
is a utility designed to help the administrator update configuration files
after upgrading to a new release or snapshot.
.Pp
.Nm
works by comparing a reference root directory against currently installed files.
.Pp
.Nm
will work through the fileset,
offering the chance to merge any differences using
.Xr sdiff 1 .
Merged files may be edited using the default editor or be left to deal
with at a later date.
Should any problems occur,
such as a failure to upgrade a file,
the user will be notified and will have to deal with the issue by hand.
.Pp
By default (if
.Fl d
is not used)
.Nm
only compares files whose reference sources have changed since the last run
and attempts to automatically upgrade them to the newest version,
provided that they have no local changes.
It automatically installs missing files and binaries,
and updates files differing only by CVS Id.
Files whose reference sources have matching CVS Id are skipped from comparison.
.Pa /etc/fbtab
and
.Pa /etc/ttys
are created using helper scripts and are
.Sy always
compared.
Users and groups that are missing from the current installation but
present in the new
.Xr master.passwd 5
and
.Xr group 5
files will
.Sy always
be automatically (re)created.
.Pp
.Nm
will finish by running
.Xr mtree 8
to make sure the directory structure has correct permissions.
.Pp
The options are as follows:
.Bl -tag -width Ds
.It Fl b
Batch mode.
.Nm
runs non-interactively,
saving differing files for later manual processing.
.It Fl d
Diff mode.
.Nm
does not take any automatic action, allowing for a full diff comparison.
.It Fl p
Package mode.
.Nm
only compares the default configuration files of installed
.Xr packages 7
against their target on the system (@@sample).
.El
.Pp
Files can be excluded from comparison by listing them in
.Pa /etc/sysmerge.ignore .
Checksum files stored under
.Pa /var/sysmerge
as well as the following files will always be skipped from direct comparison:
.Pa /etc/group ,
.Pa /etc/localtime ,
.Pa /etc/master.passwd ,
.Pa /etc/motd ,
.Pa /etc/passwd ,
.Pa /etc/pwd.db ,
.Pa /etc/spwd.db ,
.Pa /var/db/locate.database ,
.Pa /var/mail/root .
.Sh ENVIRONMENT
.Bl -tag -width "EDITORXXVISUAL"
.It Ev EDITOR , VISUAL
Specifies an editor to use.
If both
.Ev EDITOR
and
.Ev VISUAL
are set,
.Ev VISUAL
takes precedence.
If neither
.Ev EDITOR
nor
.Ev VISUAL
are set,
the default is
.Xr vi 1 .
.It Ev PAGER
Specifies the pagination program to use.
If
.Ev PAGER
is empty or not set,
.Xr more 1
will be used.
.El
.Sh FILES
.Bl -tag -width "/var/sysmerge/xetc.tgz" -compact
.It Pa /etc/sysmerge.ignore
Files and directories to ignore from comparison.
.It Pa /var/sysmerge/backups
Directory containing backup of
.Nm
last run modified files.
Rotated automatically in order of increasing age from
.Pa backups.0
to
.Pa backups.3 .
.It Pa /var/sysmerge/etc.tgz
Base system set containing the reference files
corresponding to the currently installed release.
.It Pa /var/sysmerge/xetc.tgz
.Xr X 7
set containing the reference files
corresponding to the currently installed release.
.El
.Sh SEE ALSO
.Xr more 1 ,
.Xr sdiff 1
.Pp
.Lk https://www.openbsd.org/faq/current.html
.Lk https://www.openbsd.org/faq/upgradeXX.html
.Sh HISTORY
The
.Nm
script first appeared in
.Ox 4.4 .
.Sh AUTHORS
.An -nosplit
.Nm
was written by
.An Antoine Jacoutot Aq Mt ajacoutot@@openbsd.org .
It was originally started as a friendly fork from
mergemaster by
.An Douglas Barton Aq Mt DougB@@FreeBSD.org .
@


1.78
log
@move links from http to https://www.openbsd.org/

ok beck
@
text
@d1 1
a1 1
.\"	$OpenBSD: sysmerge.8,v 1.77 2016/05/14 14:44:35 ajacoutot Exp $
d17 1
a17 1
.Dd $Mdocdate: May 14 2016 $
d129 5
@


1.77
log
@Remove handling of /etc/examples/ files by sysmerge(8). Getting regular messages
about pkg.conf isn't really that helpful and if a big syntax change comes along
well we have current.html.

it was disabled during p2k16 and no one complained so far
discussed with and ok deraadt@@
@
text
@d1 1
a1 1
.\"	$OpenBSD: sysmerge.8,v 1.76 2016/04/27 21:04:34 ajacoutot Exp $
d17 1
a17 1
.Dd $Mdocdate: April 27 2016 $
d154 2
a155 2
.Lk http://www.openbsd.org/faq/current.html
.Lk http://www.openbsd.org/faq/upgradeXX.html
@


1.76
log
@sysmerge(8) is the bastard child of ksh and perl, so just call it a "utility".
@
text
@d1 1
a1 1
.\"	$OpenBSD: sysmerge.8,v 1.75 2016/01/14 19:58:32 ajacoutot Exp $
d17 1
a17 1
.Dd $Mdocdate: January 14 2016 $
a44 6
.Nm
will also compare the checksum of each file stored under
.Pa /etc/examples
against the previous one then warn if it does not match and the
corresponding file exists under
.Pa /etc .
@


1.75
log
@No more /etc/mail/aliases.db.
@
text
@d1 1
a1 1
.\"	$OpenBSD: sysmerge.8,v 1.74 2015/10/16 19:55:39 ajacoutot Exp $
d17 1
a17 1
.Dd $Mdocdate: October 16 2015 $
d30 1
a30 3
is a
.Xr ksh 1
script designed to help the administrator update configuration files
@


1.74
log
@Drop usage of TMPDIR.
While here, stop refering to /tmp/sysmerge.XXXXXXXXXX, that's a script
internal we don't need to know about.
@
text
@d1 1
a1 1
.\"	$OpenBSD: sysmerge.8,v 1.73 2015/09/18 17:03:44 ajacoutot Exp $
d17 1
a17 1
.Dd $Mdocdate: September 18 2015 $
a109 1
.Pa /etc/mail/aliases.db ,
@


1.73
log
@Simplify: we don't need a work directory anymore, temproot is enough.
@
text
@d1 1
a1 1
.\"	$OpenBSD: sysmerge.8,v 1.72 2015/09/07 10:02:04 ajacoutot Exp $
d17 1
a17 1
.Dd $Mdocdate: September 7 2015 $
d36 1
a36 3
works by comparing the reference root directory
.Pa ${TMPDIR}/sysmerge.XXXXXXXXXX
against currently installed files.
a137 4
.It Ev TMPDIR
Path in which to store temporary files.
If unset, this defaults to
.Pa /tmp .
d140 1
a140 3
.Bl -tag -width "${TMPDIR}/sysmerge.XXXXXXXXXX" -compact
.It Pa ${TMPDIR}/sysmerge.XXXXXXXXXX
Directory in which the reference root directory is created.
@


1.72
log
@Simplify handling of sum files.
@
text
@d1 1
a1 1
.\"	$OpenBSD: sysmerge.8,v 1.71 2015/08/24 11:03:41 ajacoutot Exp $
d17 1
a17 1
.Dd $Mdocdate: August 24 2015 $
d36 2
a37 1
works by comparing a temporary reference root directory
a38 6
All work is done under
.Pa ${TMPDIR}/sysmerge.XXXXXXXXXX
(known as the
.Em work directory )
which contains the temporary root directory
.Pa temproot .
d141 1
a141 1
Directory in which the work directory is created.
d148 1
a148 4
Default work directory.
The
.Sy temproot
directory is created relative to this.
@


1.71
log
@Make backup directory of replaced files persistent: /var/sysmerge/backups.
3 rotations so that we have history of modified files.
In batch mode, when a file cannot be handled automatically, remove it from
the checksum file so that the next interactive sysmerge(8) run will ask
to merge the changes.

ok rpe@@
@
text
@d1 1
a1 1
.\"	$OpenBSD: sysmerge.8,v 1.70 2015/08/24 10:42:08 ajacoutot Exp $
d112 3
a114 1
The following files will always be skipped from direct comparison:
d124 1
a124 4
.Pa /var/mail/root ,
.Pa /var/sysmerge/etcsum ,
.Pa /var/sysmerge/examplessum ,
.Pa /var/sysmerge/xetcsum .
@


1.70
log
@/usr/share/sysmerge -> /var/sysmerge

requested by several
discussed with deraadt@@
@
text
@d1 1
a1 1
.\"	$OpenBSD: sysmerge.8,v 1.69 2015/07/27 17:28:40 sobrado Exp $
d17 1
a17 1
.Dd $Mdocdate: July 27 2015 $
d43 1
a43 4
.Pa temproot ,
and the
.Pa backup
directory containing modified and/or replaced files.
d121 2
d125 1
a125 3
.Pa /var/sysmerge/xetcsum ,
.Pa /var/db/locate.database ,
.Pa /var/mail/root .
d157 1
a157 3
and
.Sy backup
directories are created relative to this.
d160 8
@


1.69
log
@use file system path (.Pa) semantic markup macros where appropriate.

ok jmc@@
@
text
@d1 1
a1 1
.\"	$OpenBSD: sysmerge.8,v 1.68 2014/11/26 15:52:30 ajacoutot Exp $
d17 1
a17 1
.Dd $Mdocdate: November 26 2014 $
d124 3
a126 3
.Pa /usr/share/sysmerge/etcsum ,
.Pa /usr/share/sysmerge/examplessum ,
.Pa /usr/share/sysmerge/xetcsum ,
d165 1
a165 1
.It Pa /usr/share/sysmerge/etc.tgz
d168 1
a168 1
.It Pa /usr/share/sysmerge/xetc.tgz
@


1.68
log
@Drop sysmerge.log ; it used to be handy for batch mode but now the
console output is clear and clean in that mode.

Since /var/tmp is now a symlink to /tmp:
- directly use /tmp
- if modifications were done; at the end of the run:
  - display our backup directory (in case we want to move it to survive a reboot)
  - display where and what files are still left for comparison

discussed with and ok sthen@@
@
text
@d1 1
a1 1
.\"	$OpenBSD: sysmerge.8,v 1.67 2014/09/05 17:26:08 ajacoutot Exp $
d17 1
a17 1
.Dd $Mdocdate: September 5 2014 $
d156 1
a156 1
.It ${TMPDIR}/sysmerge.XXXXXXXXXX
d163 1
a163 1
.It /etc/sysmerge.ignore
d165 1
a165 1
.It /usr/share/sysmerge/etc.tgz
d168 1
a168 1
.It /usr/share/sysmerge/xetc.tgz
@


1.67
log
@Drop support for SM_MERGE. The goal is to be a less interactive as possible
so there is no point in allowing graphical merge tools to be used; especially
since it is _completely_ untested...
@
text
@d1 1
a1 1
.\"	$OpenBSD: sysmerge.8,v 1.66 2014/09/05 17:19:48 ajacoutot Exp $
d44 1
a44 1
the
d46 1
a46 4
directory containing modified and/or replaced files
and the
.Pa sysmerge.log
run output log file.
d152 1
a152 1
.Pa /var/tmp .
a162 3
.It ${WRKDIR}/sysmerge.log
.Nm
log file.
@


1.66
log
@Drop support for sendmail(8) -- hopefully it'll go away from base soon.
@
text
@d1 1
a1 1
.\"	$OpenBSD: sysmerge.8,v 1.65 2014/09/05 10:35:31 jmc Exp $
d53 2
a54 1
offering the chance to merge any differences using ${SM_MERGE}.
a151 10
.It Ev SM_MERGE
Command used to merge diffs.
This will be called with three arguments: the first argument is the
output file to create, the second argument is the currently installed
file and the third argument is the reference file.
If unset, this defaults to
.Dq sdiff -as -w ${SWIDTH} -o
where
.Ev SWIDTH
is the size of the terminal.
@


1.65
log
@tweak previous;
@
text
@d1 1
a1 1
.\"	$OpenBSD: sysmerge.8,v 1.64 2014/09/05 07:16:38 ajacoutot Exp $
a117 1
.Pa /etc/*.db ,
d120 1
a120 1
.Pa /etc/mail/*.db ,
d122 1
d124 2
a125 2
.Pa /etc/motd ,
.Pa /var/db/locate.database ,
d129 1
a130 11
.Pp
The
.Xr sendmail 8
configuration files
.Pa /etc/mail/localhost.cf ,
.Pa /etc/mail/sendmail.cf
and
.Pa /etc/mail/submit.cf
will always differ because they include their build date and directories.
A special test was added to handle this
and they are offered for comparison only if they really differ.
@


1.64
log
@/etc/{hosts,myname} are going away from etc.tgz.
@
text
@d1 1
a1 1
.\"	$OpenBSD: sysmerge.8,v 1.63 2014/08/30 14:44:20 ajacoutot Exp $
d17 1
a17 1
.Dd $Mdocdate: August 30 2014 $
d119 1
a119 1
.Pa /etc/group,
@


1.63
log
@Indent.
@
text
@d1 1
a1 1
.\"	$OpenBSD: sysmerge.8,v 1.62 2014/08/29 06:03:34 jmc Exp $
d17 1
a17 1
.Dd $Mdocdate: August 29 2014 $
d117 1
a117 1
The following files will always be skipped from comparison:
d119 1
d122 1
a124 1
.Pa /etc/myname ,
@


1.62
log
@knock out double .Pp;
@
text
@d1 1
a1 1
.\"	$OpenBSD: sysmerge.8,v 1.61 2014/08/28 22:09:00 ajacoutot Exp $
d17 1
a17 1
.Dd $Mdocdate: August 28 2014 $
d141 1
a141 1
.Bl -tag -width "DESTDIRXXX"
@


1.61
log
@Merge a paragraph.
@
text
@d1 1
a1 1
.\"	$OpenBSD: sysmerge.8,v 1.60 2014/08/28 20:55:28 jmc Exp $
a89 1
.Pp
@


1.60
log
@tweak AUTHORS; ok ajacoutot
@
text
@d1 1
a1 1
.\"	$OpenBSD: sysmerge.8,v 1.59 2014/08/28 17:43:21 ajacoutot Exp $
d59 6
a90 7
Each time
.Nm
is run it will compare the checksum of each file stored under
.Pa /etc/examples
against the previous one, then warn if it does not match and the
corresponding file exists under
.Pa /etc .
d111 1
a111 1
compares the default configuration files of installed
@


1.59
log
@Major sysmerge cleanup now that both etc and xetc sets are part of base.
Expect more changes/cleanup/... in the near future.

-S (signature) option is gone since we are not fetching sets anymore
-s and -x are gone as well for obvious reasons

Left is:
usage: sysmerge [-bdp]

I would appreciate feedback, *lots* of things have changed and there may be
side effects I missed. Consider sysmerge as WIP for the time being.
@
text
@d1 1
a1 1
.\"	$OpenBSD: sysmerge.8,v 1.58 2014/08/26 21:29:56 ajacoutot Exp $
d17 1
a17 1
.Dd $Mdocdate: August 26 2014 $
d211 1
d217 1
a217 2
Douglas Barton
.Aq Mt DougB@@FreeBSD.org .
@


1.58
log
@Fist shot at fixing sysmerge(8) with etc-in-base; note that it's still in
transition state and the utility will get a lot of revamping in the near
future.
@
text
@d1 1
a1 1
.\"	$OpenBSD: sysmerge.8,v 1.57 2014/08/11 09:03:27 ajacoutot Exp $
d17 1
a17 1
.Dd $Mdocdate: August 11 2014 $
d26 1
a26 2
.Op Fl bdS
.Op Fl p | Op Fl x Ar xetcXX.tgz
a37 4
The reference files are created from
.Pa /usr/share/sysmerge/etc.tgz
and
.Pa xetcXX.tgz .
d41 4
a44 5
.Em work directory ) .
The temporary root directory
.Pa temproot
is created under the work directory.
Each modified and/or replaced file is saved under the
d46 4
a49 15
directory inside the work directory.
.Pp
If no path to
.Pa xetcXX.tgz
is specified on the command line,
.Nm
uses
.Xr ftp 1
to fetch and cryptographically verify the set from the URL pointed
to by the
.Ev SM_PATH
environment variable.
If no such variable is set,
.Pa xetcXX.tgz
is skipped.
d53 1
a53 1
offering the chance to merge any differences using ${MERGE_CMD}.
a114 8
This option is mutually exclusive with
.Fl x .
.It Fl x Ar xetcXX.tgz
Specify a path to an
xetcXX.tgz tarball.
A tarball path specified as a URL will be passed
to
.Xr ftp 1 .
a143 8
.It Ev DBDIR
Directory in which checksum files are stored.
If unset, this defaults to
.Pa /usr/share/sysmerge .
.It Ev DESTDIR
Directory in which to merge and install files.
If unset, this defaults to
.Pa / .
d160 3
a162 11
.It Ev FTP_KEEPALIVE
Have
.Xr ftp 1
send a byte after every
.Ev FTP_KEEPALIVE
seconds,
so that incorrectly configured network equipment won't aggressively drop it.
See
.Dq ftp -k
for more information.
.It Ev MERGE_CMD
d168 4
a171 13
.Dq sdiff -as -w ${SWIDTH} -o .
.It Ev PAGER
Specifies the pagination program to use.
.It Ev REPORT
Log summary which may contain information for further, manual,
updating.
Defaults to
.Pa ${WRKDIR}/sysmerge.log .
.It Ev SM_PATH
A URL, specifying the directory to search for
.Pa xetcXX.tgx
matching the
currently running release if none is specified on the command line.
d187 2
a188 1
Default log file.
d192 6
a197 3
Base system
.Em etc
set corresponding to the currently installed release.
a210 2
.An -nosplit
The
d212 6
a217 7
shell script was written by
.An Antoine Jacoutot Aq Mt ajacoutot@@openbsd.org
using
.Fx
mergemaster written by
.An Douglas Barton Aq Mt DougB@@FreeBSD.org
as a base.
@


1.57
log
@Steal stripcom() from /etc/rc to parse sysmerge.ignore.
@
text
@d1 1
a1 1
.\"	$OpenBSD: sysmerge.8,v 1.56 2014/08/11 06:30:39 ajacoutot Exp $
d27 1
a27 1
.Op Fl p | Oo Fl s Ar src \*(Ba etcXX.tgz Oc Op Fl x Ar xetcXX.tgz
d39 4
a42 5
The reference files are created from a
.Xr cvs 1
source tree or a
.Dq .tgz
release or snapshot file.
d54 3
a56 1
If no source is specified on the command line,
d60 2
a61 1
to fetch the required sets from the URL pointed to by the
d63 2
a64 10
environment variable, and falls back to
.Pa /usr/src
if this variable is unset.
.Pp
To make sure configuration files are in sync with the actual binaries,
use the same source as was used to upgrade the system:
.Pa /usr/src
when upgrading from source;
.Pa etcXX.tgz
and
d66 1
a66 5
when upgrading from tgz sets.
When using sets,
.Nm
will cryptographically verify their integrity,
stopping immediately should signatures not match.
a132 2
.Fl s
and
a133 10
.It Fl S
Do not verify signatures for tgz sets.
This option has no effect when sets aren't used.
.It Fl s Ar src \*(Ba etcXX.tgz
Specify a path to an
.Ox
top src directory or an etcXX.tgz tarball.
A tarball path specified as a URL will be passed
to
.Xr ftp 1 .
d218 4
a221 2
A URL, specifying the directory to search for sets matching the
currently running release if none are specified on the command line.
d240 4
a247 2
.Pp
.Pa /usr/src/etc/Makefile
@


1.56
log
@Move a sentence to the corresponding option description.

from jmc@@
@
text
@d1 1
a1 1
.\"	$OpenBSD: sysmerge.8,v 1.55 2014/08/10 17:15:18 jmc Exp $
d17 1
a17 1
.Dd $Mdocdate: August 10 2014 $
d164 2
a165 4
Files and directories can be excluded from comparison
by listing them in the file
.Pa /etc/sysmerge.ignore ,
each entry separated by white space or a new line.
@


1.55
log
@- add -p to SYNOPSIS
- the argument to -s is not optional

ok ajacoutot
@
text
@d1 1
a1 1
.\"	$OpenBSD: sysmerge.8,v 1.54 2014/08/09 16:39:25 jmc Exp $
d17 1
a17 1
.Dd $Mdocdate: August 9 2014 $
d142 4
a162 7
.Pp
The
.Fl p
option is mutually exclusive with
.Fl s
and
.Fl x .
@


1.54
log
@less chatty; ok ajacoutot
@
text
@d1 1
a1 1
.\"	$OpenBSD: sysmerge.8,v 1.53 2014/08/09 12:45:03 ajacoutot Exp $
d27 1
a27 2
.Op Fl s Op Ar src \*(Ba etcXX.tgz
.Op Fl x Ar xetcXX.tgz
d145 1
a145 1
.It Fl s Op Ar src \*(Ba etcXX.tgz
@


1.53
log
@Initial support for handling configuration files from packages
(aka @@sample) -- `sysmerge -p`
Worked done at g2k14.
Committing early so we have plenty of time for testing.

with help from espie@@
thanks to landry@@ for feedback on initial testing
@
text
@d1 1
a1 1
.\"	$OpenBSD: sysmerge.8,v 1.52 2014/08/09 12:34:05 ajacoutot Exp $
a134 1
In this mode,
d136 1
a136 1
will not take any automatic action, allowing for a full diff comparison.
d138 3
a141 4
mode.
In this mode,
.Nm
will compare the default configuration files of installed packages
@


1.52
log
@sysctl.conf is an example.
Tweak error output.
Mention that `-S' has no effect when sets aren't used.
@
text
@d1 1
a1 1
.\"	$OpenBSD: sysmerge.8,v 1.51 2014/08/08 17:04:55 ajacoutot Exp $
d17 1
a17 1
.Dd $Mdocdate: August 8 2014 $
d138 7
d162 7
@


1.51
log
@Drop some useless verbiage.
sysctl.conf is an example now.
@
text
@d1 1
a1 1
.\"	$OpenBSD: sysmerge.8,v 1.50 2014/07/15 09:27:04 ajacoutot Exp $
d17 1
a17 1
.Dd $Mdocdate: July 15 2014 $
d140 1
@


1.50
log
@/var/db/sysmerge -> /usr/share/sysmerge

ok deraadt@@
@
text
@d1 1
a1 1
.\"	$OpenBSD: sysmerge.8,v 1.49 2014/07/13 07:12:41 ajacoutot Exp $
d17 1
a17 1
.Dd $Mdocdate: July 13 2014 $
a35 9
The configuration files are typically those held in
.Pa /etc ,
though
.Nm
is also able to update files held in
.Pa /dev ,
.Pa /root ,
and
.Pa /var .
d82 2
a83 3
Merged files may be edited using a default editor,
or one defined by the ${VISUAL} or ${EDITOR} environment variables.
Files may also be left to deal with at a later date.
d86 1
a86 1
the user will be notified and have to deal with the issue by hand.
d98 1
a98 2
.Pa /etc/fbtab ,
.Pa /etc/sysctl.conf ,
@


1.49
log
@Also ignore examplessum.
@
text
@d1 1
a1 1
.\"	$OpenBSD: sysmerge.8,v 1.48 2014/07/12 16:26:35 ajacoutot Exp $
d17 1
a17 1
.Dd $Mdocdate: July 12 2014 $
d178 3
a180 3
.Pa /var/db/sysmerge/etcsum ,
.Pa /var/db/sysmerge/examplessum ,
.Pa /var/db/sysmerge/xetcsum ,
d198 1
a198 1
.Pa /var/db/sysmerge .
@


1.48
log
@Extend output a bit.
@
text
@d1 1
a1 1
.\"	$OpenBSD: sysmerge.8,v 1.47 2014/07/12 15:31:54 ajacoutot Exp $
d179 1
@


1.47
log
@Initial support for /etc/examples.
@
text
@d1 1
a1 1
.\"	$OpenBSD: sysmerge.8,v 1.46 2014/07/10 11:00:03 ajacoutot Exp $
d17 1
a17 1
.Dd $Mdocdate: July 10 2014 $
d126 1
a126 1
is run, it will compare the checksum of the files stored under
d128 3
a130 1
against the previous run and warn if they do not match.
@


1.46
log
@/var/games/tetris.scores will move away from the etc set.
@
text
@d1 1
a1 1
.\"	$OpenBSD: sysmerge.8,v 1.45 2014/03/26 23:03:59 ajacoutot Exp $
d17 1
a17 1
.Dd $Mdocdate: March 26 2014 $
d123 6
@


1.45
log
@login.conf(5) is not special anymore.
@
text
@d1 1
a1 1
.\"	$OpenBSD: sysmerge.8,v 1.44 2014/01/28 09:42:42 ajacoutot Exp $
d17 1
a17 1
.Dd $Mdocdate: January 28 2014 $
a171 1
.Pa /var/games/tetris.scores ,
@


1.44
log
@Drop comma (sthen@@).
@
text
@d1 1
a1 1
.\"	$OpenBSD: sysmerge.8,v 1.43 2014/01/28 09:25:22 ajacoutot Exp $
a108 1
.Pa /etc/login.conf ,
@


1.43
log
@Drop FETCH_CMD and always use ftp(1).
New fetch() function that wraps ftp(1) with our needed knobs
(courtesy of halex@@)

input from halex@@ rpe@@
ok halex@@
@
text
@d1 1
a1 1
.\"	$OpenBSD: sysmerge.8,v 1.42 2014/01/27 17:05:37 ajacoutot Exp $
d17 1
a17 1
.Dd $Mdocdate: January 27 2014 $
d260 1
a260 1
.Xr sdiff 1 ,
@


1.42
log
@Make it clear SM_PATH will fetch the sets corresponding to the currently
running release.
@
text
@d1 1
a1 1
.\"	$OpenBSD: sysmerge.8,v 1.41 2014/01/21 19:03:44 ajacoutot Exp $
d17 1
a17 1
.Dd $Mdocdate: January 21 2014 $
d67 3
a69 2
uses ${FETCH_CMD} to fetch the required sets from the URI pointed
to by the
d148 3
a150 2
A tarball path specified as an FTP or HTTP URL will be passed
to ${FETCH_CMD}.
d154 3
a156 2
A tarball path specified as an FTP or HTTP URL will be passed
to ${FETCH_CMD}.
a211 4
.It Ev FETCH_CMD
Command used to fetch remote files.
Defaults to
.Xr ftp 1 .
d237 1
a237 1
A URI, specifying the directory to search for sets matching the
a258 4
.Xr cap_mkdb 1 ,
.Xr chpass 1 ,
.Xr diff 1 ,
.Xr mktemp 1 ,
a260 7
.Xr signify 1 ,
.Xr groupadd 8 ,
.Xr MAKEDEV 8 ,
.Xr makemap 8 ,
.Xr mtree 8 ,
.Xr newaliases 8 ,
.Xr pwd_mkdb 8
@


1.41
log
@Document -S and the new signify(1) use by sysmerge(8).

input and ok jmc@@
@
text
@d1 1
a1 1
.\"	$OpenBSD: sysmerge.8,v 1.40 2013/09/10 08:44:38 ajacoutot Exp $
d17 1
a17 1
.Dd $Mdocdate: September 10 2013 $
d238 2
a239 2
A URI, specifying the directory to search for sets if none are specified
on the command line.
@


1.40
log
@Add support for the SM_PATH environment variable. This changes the
default behavior of sysmerge when no source is specified on the
command line:
* if SM_PATH is set, then sysmerge will search this path for etcXX.tgz
and/or xetcXX.tgz
* if SM_PATH is not set (the default), then the behaviour is the same
as before and /usr/src is used

idea from espie@@
man page refactoring jmc@@ (who else :-))
"good idea" krw@@
ok rpe@@ landry@@ espie@@
@
text
@d1 1
a1 1
.\"	$OpenBSD: sysmerge.8,v 1.39 2013/07/16 11:13:34 schwarze Exp $
d17 1
a17 1
.Dd $Mdocdate: July 16 2013 $
d26 1
a26 1
.Op Fl bd
d81 5
a85 1
when upgrading from binary sets.
d141 2
d162 1
d266 1
@


1.39
log
@use .Mt for email addresses; from Jan Stary <hans at stare dot cz>; ok jmc@@
@
text
@d1 1
a1 1
.\"	$OpenBSD: sysmerge.8,v 1.38 2012/08/28 05:42:07 ajacoutot Exp $
d17 1
a17 1
.Dd $Mdocdate: August 28 2012 $
a53 3
The default, if no source is specified on the command line,
is to use
.Pa /usr/src .
d65 9
d230 3
@


1.38
log
@Always compare master.passwd(5) and group(5) regardless of their sums:
this is a sanity check to ensure no system user(s)/group(s) are missing.

ok sthen@@
@
text
@d1 1
a1 1
.\"	$OpenBSD: sysmerge.8,v 1.37 2012/08/15 19:25:41 jmc Exp $
d17 1
a17 1
.Dd $Mdocdate: August 15 2012 $
d271 1
a271 1
.An Antoine Jacoutot Aq ajacoutot@@openbsd.org
d275 1
a275 1
.An Douglas Barton Aq DougB@@FreeBSD.org
@


1.37
log
@use Lk for links;
@
text
@d1 1
a1 1
.\"	$OpenBSD: sysmerge.8,v 1.36 2012/02/17 14:06:42 ajacoutot Exp $
d17 1
a17 1
.Dd $Mdocdate: February 17 2012 $
d110 3
a112 1
files will be automatically created.
@


1.36
log
@Remove the backup chunk from the man page. People should use backup
anyway and sysmerge(8) automatically save replaced files.

ok sthen@@
@
text
@d1 1
a1 1
.\"	$OpenBSD: sysmerge.8,v 1.35 2011/07/21 12:31:51 ajacoutot Exp $
d17 1
a17 1
.Dd $Mdocdate: July 21 2011 $
d257 2
a258 2
.Pa http://www.openbsd.org/faq/current.html
.Pa http://www.openbsd.org/faq/upgradeXX.html
@


1.35
log
@Adjust work directory name.
@
text
@d1 1
a1 1
.\"	$OpenBSD: sysmerge.8,v 1.34 2010/11/11 12:51:31 ajacoutot Exp $
d17 1
a17 1
.Dd $Mdocdate: November 11 2010 $
a44 6
.Pp
It is
.Sy HIGHLY
recommended to back up the
.Pa /etc
directory before running this script.
@


1.34
log
@Missed that part in previous.

from jmc@@
@
text
@d1 1
a1 1
.\"	$OpenBSD: sysmerge.8,v 1.33 2010/11/11 10:46:10 ajacoutot Exp $
d64 1
a64 1
.Pa ${TMPDIR}/sysmerge.XXXXX
d234 2
a235 2
.Bl -tag -width "${TMPDIR}/sysmerge.XXXXXXXX" -compact
.It ${TMPDIR}/sysmerge.XXXXX
@


1.33
log
@Unconfuse usage.

prodded by and ok espie@@, ok jmc@@
@
text
@d1 1
a1 1
.\"	$OpenBSD: sysmerge.8,v 1.32 2010/07/05 08:30:28 ajacoutot Exp $
d17 1
a17 1
.Dd $Mdocdate: July 5 2010 $
d135 1
a135 1
.It Fl s Ar src \*(Ba etcXX.tgz
@


1.32
log
@Automatically install missing users and groups.
(does *NOT* touch existing users/groups)

"I like it" from several...
inputs from sthen@@ and halex@@
ok krw@@ halex@@ sthen@@
@
text
@d1 1
a1 1
.\"	$OpenBSD: sysmerge.8,v 1.31 2010/03/20 09:45:11 ajacoutot Exp $
d17 1
a17 1
.Dd $Mdocdate: March 20 2010 $
d27 1
a27 1
.Op Fl s Ar src \*(Ba etcXX.tgz
@


1.31
log
@s/sh/ksh/
@
text
@d1 1
a1 1
.\"	$OpenBSD: sysmerge.8,v 1.30 2009/12/18 13:51:02 ajacoutot Exp $
d17 1
a17 1
.Dd $Mdocdate: December 18 2009 $
d111 6
d249 1
d254 1
@


1.30
log
@Add etcsum and xetcsum to IGNORE_FILES. Needed for upcoming change.

ok sthen@@
@
text
@d1 1
a1 1
.\"	$OpenBSD: sysmerge.8,v 1.29 2009/12/06 16:21:36 ajacoutot Exp $
d17 1
a17 1
.Dd $Mdocdate: December 6 2009 $
d33 1
a33 1
.Xr sh 1
@


1.29
log
@Add /var/db/locate.database and /var/games/tetris.scores to IGNORE_FILES.

ok sthen@@
@
text
@d1 1
a1 1
.\"	$OpenBSD: sysmerge.8,v 1.28 2009/08/23 20:06:32 ajacoutot Exp $
d17 1
a17 1
.Dd $Mdocdate: August 23 2009 $
d153 2
@


1.28
log
@Document all variables used by sysmerge.

"fine" jmc@@
@
text
@d1 1
a1 1
.\"	$OpenBSD: sysmerge.8,v 1.27 2009/08/18 08:27:32 ajacoutot Exp $
d17 1
a17 1
.Dd $Mdocdate: August 18 2009 $
d152 2
@


1.27
log
@HEADS-UP:  change the way sysmerge(8) runs by default.
Remove the '-a' switch (auto-mode) and make this behaviour the default.
Add a new '-d' switch to get former default (full diff) mode.

General idea ok for several.
man page improvements from jmc@@
ok jim@@ oga@@ sobrado@@
ok sthen@@ "sane defaults++ :)"
@
text
@d1 1
a1 1
.\"	$OpenBSD: sysmerge.8,v 1.26 2009/06/05 06:27:52 jmc Exp $
d17 1
a17 1
.Dd $Mdocdate: June 5 2009 $
d194 10
d211 2
@


1.26
log
@tweak previous;
@
text
@d1 1
a1 1
.\"	$OpenBSD: sysmerge.8,v 1.25 2009/06/04 23:24:17 ajacoutot Exp $
d17 1
a17 1
.Dd $Mdocdate: June 4 2009 $
d26 1
a26 1
.Op Fl ab
d93 3
a95 9
.Nm
will finish by running
.Xr mtree 8
to make sure the directory structure has correct permissions.
.Pp
The options are as follows:
.Bl -tag -width Ds
.It Fl a
Automatic mode.
a101 1
.Pp
d111 8
d124 5
@


1.25
log
@When in auto-mode, automatically install binary files (from the X set).

``please put it in'', pyr@@
@
text
@d1 1
a1 1
.\"	$OpenBSD: sysmerge.8,v 1.24 2009/05/12 20:58:15 jmc Exp $
d17 1
a17 1
.Dd $Mdocdate: May 12 2009 $
d106 1
a106 1
It automatically installs missing files, binaries
@


1.24
log
@simplify the descriptions of -a and -b; this has taken me and antoine
an entire day of mailing to make this tweak ;(

ok ajacoutot
@
text
@d1 1
a1 1
.\"	$OpenBSD: sysmerge.8,v 1.23 2009/05/12 13:04:18 jmc Exp $
d106 1
a106 1
It automatically installs missing files
@


1.23
log
@- tweak the description of -a
- remove -SX from usage()

ok ajacoutot
@
text
@d1 1
a1 1
.\"	$OpenBSD: sysmerge.8,v 1.22 2009/05/11 20:25:55 ajacoutot Exp $
d17 1
a17 1
.Dd $Mdocdate: May 11 2009 $
a101 1
If this option is specified,
d103 7
a109 6
will only compare files whose reference sources have changed since
the last run and will attempt to automatically upgrade them to the
newest version provided that they have no local changes.
It will automatically install missing files
and files differing only by CVS Id,
and will disable strict file comparison when possible (using CVS Id).
d115 1
a115 1
are created using helper scripts and will
d117 1
a117 3
be strictly compared, even when
.Fl a
is specified.
a119 1
If this option is specified,
d121 2
a122 2
will run unattended (non-interactively), saving differing files for
later manual processing.
@


1.22
log
@This commit adds a new feature to sysmerge(8), usable in '-a' mode.
From now on, checksums of reference files (sets and/or src) will be
stored under /var/db/sysmerge/{etcsum,xetcsum,srcsum} . This allows for
"remembering last choice" several people have requested.
This deprecates the need for -X and -S which have been removed (these
switches may come back at some point for the auto-patch feature which
halex@@ proposed).

It will only compare files which reference sources have changed since
the last run and will attempt to automatically upgrade them to the
newest version provided that they have no local changes.
i.e. first run should dislay differences, second run should not display
anything except if something changed between old and new sets/src. This
way sysmerge can also warn you from files which may have been obsoleted.

General idea taken from Net/FreeBSD but we're doing things differently.

Intensively discussed with oga@@, sthen@@ and halex@@
ok oga@@ sthen@@
@
text
@d1 1
a1 1
.\"	$OpenBSD: sysmerge.8,v 1.21 2009/04/12 07:43:17 ajacoutot Exp $
d17 1
a17 1
.Dd $Mdocdate: April 12 2009 $
d104 1
a104 1
will only compare files which reference sources have changed since
@


1.21
log
@When in automode, sysmerge will now automatically install files
that only differ by CVS Id (adapted from FreeBSD mergemaster)

Ground work on the man page, from jmc@@
 * do not duplicate info
 * rewordings
 * move some stuffs around

ok jmc@@ sthen@@
@
text
@d1 1
a1 1
.\"	$OpenBSD: sysmerge.8,v 1.20 2009/04/09 14:43:54 ajacoutot Exp $
d17 1
a17 1
.Dd $Mdocdate: April 9 2009 $
a26 1
.Op Fl S Ar etcXX.tgz
a27 1
.Op Fl X Ar xetcXX.tgz
d104 4
a107 1
will automatically install missing files
a125 13
.It Fl S Ar etcXX.tgz
Specify a path to an
etcXX.tgz tarball,
where XX represents the version to be upgraded from.
.Nm
will attempt to automatically upgrade files from this version
to the one specified by
.Fl s ,
provided that the file has no local changes.
Files that have not been modified between the supplied tarballs will
not be offered for comparison.
A tarball path specified as an FTP or HTTP URL will be passed
to ${FETCH_CMD}.
a131 13
.It Fl X Ar xetcXX.tgz
Specify a path to an
xetcXX.tgz tarball,
where XX represents the version to be upgraded from.
.Nm
will attempt to automatically upgrade files from this version
to the one specified by
.Fl x ,
provided that the file has no local changes.
Files that have not been modified between the supplied tarballs will
not be offered for comparison.
A tarball path specified as an FTP or HTTP URL will be passed
to ${FETCH_CMD}.
d163 4
@


1.20
log
@Sort.
requested by jmc@@
@
text
@d1 1
a1 1
.\"	$OpenBSD: sysmerge.8,v 1.19 2009/04/09 10:44:50 ajacoutot Exp $
a84 24
When run in
.Em automatic
mode
.Pq Fl a
.Nm
will skip files with identical CVS Id and install missing ones.
In
.Em manual
mode (the default unless
.Fl a
is specified),
.Nm
will perform a strict comparison of files.
.Pa /etc/fbtab ,
.Pa /etc/login.conf ,
.Pa /etc/sysctl.conf ,
and
.Pa /etc/ttys
are created using helper scripts and will
.Sy always
be strictly compared even in
.Fl a
mode.
.Pp
a94 34
When updating from sets, a tarball from an older snapshot or release
may be provided using the
.Fl S
or
.Fl X
options.
If files differ between the supplied tarballs, then installed
files which have not been modified from the originals will
be updated automatically.
Those that have been modified will be offered for comparison.
.Pp
Files and directories can be excluded from comparison
by listing them in the file
.Pa /etc/sysmerge.ignore ,
each entry separated by white space or a new line.
The following files will always be skipped from comparison:
.Pa /etc/*.db ,
.Pa /etc/mail/*.db ,
.Pa /etc/passwd ,
.Pa /etc/motd ,
.Pa /etc/myname ,
.Pa /var/mail/root .
.Pp
The
.Xr sendmail 8
configuration files
.Pa /etc/mail/localhost.cf ,
.Pa /etc/mail/sendmail.cf
and
.Pa /etc/mail/submit.cf
will always differ because they include their build date and directories.
A special test was added to handle this
and they are offered for comparison only if they really differ.
.Pp
d106 13
a118 2
will automatically install missing files and disable strict file
comparison when possible (using CVS Ids).
d134 2
d153 2
d163 23
@


1.19
log
@Add a hook to deal with special sendmail db files under /etc/mail/
Tweak some outputs and put interesting messages into sysmerge.log.
export the NEED_NEWALIASES variable.

inputs from and ok sthen@@
@
text
@d1 1
a1 1
.\"	$OpenBSD: sysmerge.8,v 1.18 2009/04/06 14:39:23 jmc Exp $
d17 1
a17 1
.Dd $Mdocdate: April 6 2009 $
a265 1
.Xr makemap 8 ,
d270 1
@


1.18
log
@new sentence, new line;
@
text
@d1 1
a1 1
.\"	$OpenBSD: sysmerge.8,v 1.17 2009/04/06 10:35:20 ajacoutot Exp $
d266 1
@


1.17
log
@Add a report summary file, ${WRKDIR}/sysmerge.log, that will include all
worthy post run information instead of spreading info into several
files.  Tweak some output while here.

Enchance description for the -S and -X options; thanks to sthen@@ and
jmc@@ for finding the correct wording... it was not as easy as it seems.
Fix a typo in the man page, spotted by jmc@@

ok sthen@@ jmc@@
@
text
@d1 1
a1 1
.\"	$OpenBSD: sysmerge.8,v 1.16 2009/03/25 18:02:12 ajacoutot Exp $
d17 1
a17 1
.Dd $Mdocdate: March 25 2009 $
d127 2
a128 2
be updated automatically.  Those that have been modified will
be offered for comparison.
@


1.16
log
@Several cleanups:

 * constistency in redirections (and fix a wrong one)
 * enclose variables
 * several UPPER -> lowercase rewordings
 * add "" on conditionals (suggested by jared r r spiegel a while ago)
 * use cmp instead of md5 for sets comparison (from sthen@@)
 * some man page rewordings from sthen@@

ok sthen@@
@
text
@d1 1
a1 1
.\"	$OpenBSD: sysmerge.8,v 1.15 2009/03/25 13:20:02 ajacoutot Exp $
d125 4
a128 2
Installed files which have not been modified from the originals
will be updated automatically.
d196 1
a196 1
.Fl s ,
d239 5
d258 2
@


1.15
log
@You can now feed sysmerge with an etcXX and/or xetcXX tarball(s)
corresponding to your current snapshot or release. Any file that was
modified between this old reference and the new one *and* that you did
not change locally will automatically be updated to the new version.

Make sure we don't compare files that have not changed between old and
new tarball (from Alexander Hall).

man page flushing, tweaking, rewording and enhancing from jmc@@

Several people came up with this request or alike, thanks to them.

looked over and tested by several
ok weerd@@
@
text
@d1 1
a1 1
.\"	$OpenBSD: sysmerge.8,v 1.14 2009/02/17 16:48:11 ajacoutot Exp $
d17 1
a17 1
.Dd $Mdocdate: February 17 2009 $
d119 2
a120 2
If a tarball from an older snapshot or release is also specified
using the
d124 3
a126 3
options,
installed files which have not been modified since the earlier referenced
sources will automatically be updated to the eventual new version.
@


1.14
log
@- always run pwd_mdb, newaliases, MAKEDEV and cap_mkdb even when not in
auto-mode so that the system is not left in an inconsistent state
- unify messages
- tweak manpage according to new behavior

based on an initial patch from matthieu@@
ok matthieu@@
@
text
@d1 1
a1 1
.\"	$OpenBSD: sysmerge.8,v 1.13 2008/12/17 09:17:47 jmc Exp $
d17 1
a17 1
.Dd $Mdocdate: December 17 2008 $
d25 1
d27 1
d29 1
d31 1
d119 9
d170 11
d185 11
@


1.13
log
@more on editors; ok ajacoutot
@
text
@d1 1
a1 1
.\"	$OpenBSD: sysmerge.8,v 1.12 2008/12/16 22:23:55 ajacoutot Exp $
d17 1
a17 1
.Dd $Mdocdate: December 16 2008 $
d84 1
a84 1
.Pq Fl a ,
d86 1
a86 6
will skip files with identical CVS Id, install missing ones and run commands
associated with the following special files if they were modified:
.Xr aliases 5 ,
.Xr login.conf 5 ,
.Xr MAKEDEV 8 ,
.Xr passwd 5 .
d149 2
a150 3
will automatically install missing files,
create databases and device nodes,
and will disable strict file comparison when possible (using CVS Ids).
@


1.12
log
@- make it possible to edit a merged file using an external editor ;
useful when 'sdiff eb' does not cope with one's needs.

idea and input from weerd@@
ok weerd@@ sthen@@
@
text
@d1 1
a1 1
.\"	$OpenBSD: sysmerge.8,v 1.11 2008/09/12 13:31:59 ajacoutot Exp $
d17 1
a17 1
.Dd $Mdocdate: September 12 2008 $
d112 3
a114 3
offering the chance to merge any differences
using ${MERGE_CMD} as well as edit the merged file with your favorite
editor defined by the ${VISUAL} or ${EDITOR} environment variables.
d181 16
@


1.11
log
@- make it possible to use a user defined MERGE_CMD instead of sdiff

mostly from andreas@@
man page enhancing by jmc@@
ok andreas@@
@
text
@d1 1
a1 1
.\"	$OpenBSD: sysmerge.8,v 1.10 2008/07/04 15:03:45 sthen Exp $
d17 1
a17 1
.Dd $Mdocdate: July 4 2008 $
d113 2
a114 1
using ${MERGE_CMD}.
@


1.10
log
@Teach sysmerge to retrieve {etc,xetc}*.tgz files from FTP/HTTP
paths using ftp(1). Thanks ajacoutot and jmc for suggestions.

ok ajacoutot jmc, no objection deraadt
@
text
@d1 1
a1 1
.\"	$OpenBSD: sysmerge.8,v 1.9 2008/07/04 10:23:56 jmc Exp $
d112 2
a113 2
offering the chance to merge any differences using
.Xr sdiff 1 .
d184 7
@


1.9
log
@some small text improvements; ok ajacoutot
@
text
@d1 1
a1 1
.\"	$OpenBSD: sysmerge.8,v 1.8 2008/06/13 00:46:57 ajacoutot Exp $
d17 1
a17 1
.Dd $Mdocdate: June 13 2008 $
d166 2
d171 2
a172 3
If this option is specified, it will add
.Xr X 7
configuration files to the comparison.
d180 4
@


1.8
log
@- add support for ignoring files and directories from comparison
through an optionnal /etc/sysmerge.ignore file
requested by many

man page tweak from jmc@@
/etc/changelist addition suggested by sthen@@

ok sthen@@ jdixon@@ jmc@@ naddy@@
@
text
@d1 1
a1 1
.\"	$OpenBSD: sysmerge.8,v 1.7 2008/06/13 00:33:04 ajacoutot Exp $
d52 1
a52 1
against locally installed files.
a60 6
To make sure configuration files are in sync with the actual binaries,
use the same source as was used to upgrade the system:
.Pa /usr/src
when upgrading from source and
.Pa etcXX.tgz
when upgrading from binary sets.
d71 9
@


1.7
log
@- always force full file check on fbtab, login.conf, sysctl.conf and
ttys since they are created using helper scripts and comparing CVS Id
would not be accurate

original diff from sthen@@
man page tweak from jmc@@

ok sthen@@ jdixon@@ jmc@@ naddy@@
@
text
@d1 1
a1 1
.\"	$OpenBSD: sysmerge.8,v 1.6 2008/06/09 23:11:01 ajacoutot Exp $
d17 1
a17 1
.Dd $Mdocdate: June 9 2008 $
d116 4
d190 2
@


1.6
log
@- encourage people to use the same source as was used to upgrade system
binaries so that some etc files don't get forgotten in the process

discussed with kurt@@
tweaks and ok jmc@@
@
text
@d1 1
a1 1
.\"	$OpenBSD: sysmerge.8,v 1.5 2008/06/01 15:07:00 ajacoutot Exp $
d17 1
a17 1
.Dd $Mdocdate: June 1 2008 $
d96 10
@


1.5
log
@- make it possible to merge files from xetcXX only

man page bits by jmc@@
suggested by an ok jdixon@@ merdely@@
@
text
@d1 1
a1 1
.\"	$OpenBSD: sysmerge.8,v 1.4 2008/05/14 07:48:35 ajacoutot Exp $
d17 1
a17 1
.Dd $Mdocdate: May 14 2008 $
d61 6
@


1.4
log
@- add a non-interactive mode to sysmerge ('-b')
- yesno is only used once

man page consulting jmc@@ ;)
ok laurent@@ pyr@@
@
text
@d1 1
a1 1
.\"	$OpenBSD: sysmerge.8,v 1.3 2008/04/30 20:15:54 ajacoutot Exp $
d17 1
a17 1
.Dd $Mdocdate: April 30 2008 $
d53 8
a142 2
The default is
.Pa /usr/src .
@


1.3
log
@* add xetcXX.tgz support to sysmerge and handle binary files
* update man page accordingly
* several cleanups in the process:
- smaller sendmail configuration files diff check
- remove a condition that would always evaluate to true
- define AUTOMODE to a value we can reuse later
- tell user when installing a file automatically
- better check for src directory validity
- remove full PATH to some commands to be consistent

testing from several
man pages bits ok jmc@@
"go ahead" jasper@@, ok sthen@@ pyr@@
@
text
@d1 1
a1 1
.\"	$OpenBSD: sysmerge.8,v 1.2 2008/04/24 17:51:41 deraadt Exp $
d17 1
a17 1
.Dd $Mdocdate: April 24 2008 $
d25 1
a25 1
.Op Fl a
d125 6
@


1.2
log
@kill first person
@
text
@d1 1
a1 1
.\"	$OpenBSD: sysmerge.8,v 1.1 2008/04/22 20:53:16 ajacoutot Exp $
d17 1
a17 1
.Dd $Mdocdate: April 22 2008 $
d27 1
d107 1
a107 1
will always differ because they include their build date.
d131 6
@


1.1
log
@Welcome sysmerge(8), a mergemaster-based utility to help you update
configuration files after upgrading to a new release or snapshot.
The "sysmerge" name was chosen by weingart@@

Lots of inputs from deraadt@@ jmc@@ millert@@ krw@@ and several, thank you!
Man page enhancements by jmc@@
Testings from at least okan@@ landry@@ gilles@@ pyr@@ merdely@@

Still a _work-in-progress_, not connected to the build.

"fine with me" krw@@, "get it in" deraadt@@
@
text
@d1 1
a1 1
.\"	$OpenBSD$
d17 1
a17 1
.Dd $Mdocdate$
d113 1
a113 1
to make sure your directory structure has correct permissions.
@

