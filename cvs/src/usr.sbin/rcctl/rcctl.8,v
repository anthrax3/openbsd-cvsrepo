head	1.34;
access;
symbols
	OPENBSD_6_1:1.34.0.2
	OPENBSD_6_1_BASE:1.34
	OPENBSD_6_0:1.33.0.2
	OPENBSD_6_0_BASE:1.33
	OPENBSD_5_9:1.30.0.2
	OPENBSD_5_9_BASE:1.30
	OPENBSD_5_8:1.21.0.4
	OPENBSD_5_8_BASE:1.21
	OPENBSD_5_7:1.16.0.2
	OPENBSD_5_7_BASE:1.16;
locks; strict;
comment	@.\" @;


1.34
date	2016.10.10.15.22.26;	author schwarze;	state Exp;
branches;
next	1.33;
commitid	k2dAvjqbBGVNNqV5;

1.33
date	2016.06.19.10.54.20;	author ajacoutot;	state Exp;
branches;
next	1.32;
commitid	cYadOGpG6No2SVsV;

1.32
date	2016.04.26.17.58.42;	author ajacoutot;	state Exp;
branches;
next	1.31;
commitid	wcKESoQAakspGb4F;

1.31
date	2016.04.01.08.18.57;	author ajacoutot;	state Exp;
branches;
next	1.30;
commitid	u5ex1puxVA4hDZRY;

1.30
date	2016.01.30.18.57.31;	author ajacoutot;	state Exp;
branches;
next	1.29;
commitid	PhE0PLwjZYFa9M8N;

1.29
date	2016.01.30.12.14.08;	author schwarze;	state Exp;
branches;
next	1.28;
commitid	pwg2GORI6JTvM0Zn;

1.28
date	2016.01.29.23.53.08;	author jmc;	state Exp;
branches;
next	1.27;
commitid	pNUYsWfVoeriBK2y;

1.27
date	2016.01.29.20.14.08;	author ajacoutot;	state Exp;
branches;
next	1.26;
commitid	pYrDaxqlVtKaSJcR;

1.26
date	2015.10.24.17.08.36;	author jmc;	state Exp;
branches;
next	1.25;
commitid	O2BUZXPPHXoZuceP;

1.25
date	2015.10.24.13.57.24;	author ajacoutot;	state Exp;
branches;
next	1.24;
commitid	xBhyabk6ONmONtJz;

1.24
date	2015.10.06.18.46.05;	author schwarze;	state Exp;
branches;
next	1.23;
commitid	peSkLa2o7xANIMJI;

1.23
date	2015.10.06.18.35.55;	author schwarze;	state Exp;
branches;
next	1.22;
commitid	oLRXRHkONvf6RIUr;

1.22
date	2015.10.04.13.38.25;	author ajacoutot;	state Exp;
branches;
next	1.21;
commitid	LsNGEBJzfajiyQNg;

1.21
date	2015.07.25.09.45.51;	author schwarze;	state Exp;
branches;
next	1.20;
commitid	oOpSNcO0THL0l3JO;

1.20
date	2015.07.15.05.51.08;	author jmc;	state Exp;
branches;
next	1.19;
commitid	cyJOHTxlMbaQH1a3;

1.19
date	2015.07.15.04.19.41;	author ajacoutot;	state Exp;
branches;
next	1.18;
commitid	yxBpeXp3UAKZbYBW;

1.18
date	2015.07.14.23.16.56;	author ajacoutot;	state Exp;
branches;
next	1.17;
commitid	7OYOUh5nldN4YZwq;

1.17
date	2015.04.22.16.25.31;	author schwarze;	state Exp;
branches;
next	1.16;
commitid	DaXFbviqKrvrnggq;

1.16
date	2015.01.08.09.03.26;	author ajacoutot;	state Exp;
branches;
next	1.15;
commitid	znDNCLthUjeNQGnm;

1.15
date	2015.01.07.17.15.47;	author ajacoutot;	state Exp;
branches;
next	1.14;
commitid	JIUG4WNjAalRNGQG;

1.14
date	2015.01.07.10.44.14;	author ajacoutot;	state Exp;
branches;
next	1.13;
commitid	fvuVtowaBATk6G9o;

1.13
date	2015.01.06.12.28.56;	author ajacoutot;	state Exp;
branches;
next	1.12;
commitid	fW4yrETER2Zu6yBX;

1.12
date	2014.12.29.15.09.00;	author schwarze;	state Exp;
branches;
next	1.11;
commitid	VjlPEQnqghI58epE;

1.11
date	2014.12.24.13.04.43;	author ajacoutot;	state Exp;
branches;
next	1.10;
commitid	8Il3Ss79EtWtXb6k;

1.10
date	2014.10.13.14.12.57;	author schwarze;	state Exp;
branches;
next	1.9;
commitid	dmOs87Xnb31MsNiM;

1.9
date	2014.10.11.13.42.49;	author ajacoutot;	state Exp;
branches;
next	1.8;
commitid	uBr8dJGDbeBOEk6x;

1.8
date	2014.08.31.06.52.46;	author ajacoutot;	state Exp;
branches;
next	1.7;
commitid	nGfLluODLCLbY19v;

1.7
date	2014.08.29.17.17.22;	author ajacoutot;	state Exp;
branches;
next	1.6;
commitid	uD9ZM2UaNKGk6T5w;

1.6
date	2014.08.24.07.33.26;	author ajacoutot;	state Exp;
branches;
next	1.5;
commitid	lsbRcZMiAAkNWJ2i;

1.5
date	2014.08.21.12.47.22;	author ajacoutot;	state Exp;
branches;
next	1.4;
commitid	RUUoF1ATEdgHPtHE;

1.4
date	2014.08.21.10.15.11;	author schwarze;	state Exp;
branches;
next	1.3;
commitid	7dS5BswChcZVFDBc;

1.3
date	2014.08.19.17.45.43;	author schwarze;	state Exp;
branches;
next	1.2;
commitid	jk62SWJoZ1jf319l;

1.2
date	2014.08.19.16.05.02;	author schwarze;	state Exp;
branches;
next	1.1;
commitid	DqahMokGHPn6JlrE;

1.1
date	2014.08.19.14.08.20;	author ajacoutot;	state Exp;
branches;
next	;
commitid	mpurVxj2DZYZZkdt;


desc
@@


1.34
log
@improve .Bl -tag -width for -Tps mode;
patch from Jan Stary <hans at stare dot cz>;
"go ahead" jmc@@
@
text
@.\"	$OpenBSD: rcctl.8,v 1.33 2016/06/19 10:54:20 ajacoutot Exp $
.\"
.\" Copyright (c) 2014 Antoine Jacoutot <ajacoutot@@openbsd.org>
.\"
.\" Permission to use, copy, modify, and distribute this software for any
.\" purpose with or without fee is hereby granted, provided that the above
.\" copyright notice and this permission notice appear in all copies.
.\"
.\" THE SOFTWARE IS PROVIDED "AS IS" AND THE AUTHOR DISCLAIMS ALL WARRANTIES
.\" WITH REGARD TO THIS SOFTWARE INCLUDING ALL IMPLIED WARRANTIES OF
.\" MERCHANTABILITY AND FITNESS. IN NO EVENT SHALL THE AUTHOR BE LIABLE FOR
.\" ANY SPECIAL, DIRECT, INDIRECT, OR CONSEQUENTIAL DAMAGES OR ANY DAMAGES
.\" WHATSOEVER RESULTING FROM LOSS OF USE, DATA OR PROFITS, WHETHER IN AN
.\" ACTION OF CONTRACT, NEGLIGENCE OR OTHER TORTIOUS ACTION, ARISING OUT OF
.\" OR IN CONNECTION WITH THE USE OR PERFORMANCE OF THIS SOFTWARE.
.\"
.Dd $Mdocdate: June 19 2016 $
.Dt RCCTL 8
.Os
.Sh NAME
.Nm rcctl
.Nd configure and control daemons and services
.Sh SYNOPSIS
.Nm rcctl
.Cm get Ns | Ns Cm getdef Ns | Ns Cm set
.Ar service | daemon Op Ar variable Op Ar arguments
.Nm rcctl
.Op Fl df
.Ar action daemon ...
.Nm rcctl
.Cm disable Ns | Ns Cm enable Ns | Ns Cm order
.Op Ar daemon ...
.Nm rcctl
.Cm ls
.Ar lsarg
.Sh DESCRIPTION
The
.Nm
utility can enable or disable a base system
.Ar service
or a base system or package
.Ar daemon
in
.Xr rc.conf.local 8
or display its configuration and status.
For a
.Ar daemon ,
it can also change the command line arguments, the user to run as, the
.Xr rc.d 8
action timeout or call its
.Xr rc.d 8
.Ar daemon
control script.
.Pp
The following commands are available
.Po
.Ar variable
can be one of
.Cm class ,
.Cm flags ,
.Cm status ,
.Cm timeout
or
.Cm user
.Pc :
.Bl -tag -width Ds
.It Oo Fl df Oc Ar action daemon ...
Run the
.Xr rc.d 8
.Ar daemon
scripts with the
.Ar action
argument, passing through the specified options, if any.
.It Cm disable Ar service ... | daemon ...
Alias for
.Cm set Ar service Ns | Ns Ar daemon Cm status off .
.It Cm enable Ar service ... | daemon ...
Alias for
.Cm set Ar service Ns | Ns Ar daemon Cm status on .
.It Cm get Ar service | daemon Op Ar variable
Display the value of
.Ar service
or
.Ar daemon Ns _ Ns Ar variable .
If
.Ar variable
is empty, display all
.Ar service
or
.Ar daemon
variables and values in a format
compatible with
.Xr rc.conf 8 .
When
.Ar daemon
is set to
.Qq all ,
.Ar variable
must not be set and
.Nm
will display all services and daemons variables.
.It Cm getdef Ar service | daemon Op Ar variable
Like
.Cm get
but returns the default values.
.It Cm ls Ar lsarg
Display a list of services and daemons matching
.Ar lsarg ,
which can be one of:
.Pp
.Bl -tag -width stopped -offset indent -compact
.It Cm all
all services and daemons
.It Cm failed
enabled but stopped daemons
.It Cm off
disabled services and daemons
.It Cm on
enabled services and daemons
.It Cm started
running daemons
.It Cm stopped
stopped daemons
.El
.It Cm order Op Ar daemon ...
Move the specified package daemons to the beginning of
.Va pkg_scripts .
They need to be already enabled.
If no
.Ar daemon
is specified, display the current order.
.Pp
The
.Cm order
command is only needed after enabling a new daemon
that needs to run before one or more already enabled daemons.
Specify the new daemon preceded by all that need to run before it,
but not the ones depending on it.
.It Cm set Ar service | daemon variable Op Ar arguments
For a daemon, set the variable
.Ar daemon Ns _ Ns Ar variable
to the specified
.Ar arguments .
If
.Ar variable
is already set,
.Ar daemon Ns _ Ns Ar variable
is reset to the optionally provided
.Ar arguments
or to its default value.
.Pp
The
.Cm status
.Ar variable
must be provided with the
.Cm on
or
.Cm off
.Ar arguments .
It is used to enable or disable
.Ar service
or
.Ar daemon
in
.Xr rc.conf.local 8 .
When a disabled package daemon is enabled, it is appended to the end of
.Va pkg_scripts .
When a package daemon is disabled, it is removed from
.Va pkg_scripts .
.El
.Sh EXIT STATUS
.Nm Ar action
returns with the exit status of the
.Xr rc.d 8
.Ar daemon
script.
.Nm Cm get Ar daemon | service Op Cm status
exits with 0 if the daemon or service is enabled and 1 if it is not.
.Nm Cm getdef Ar daemon | service Op Cm status
exits with 0 if the daemon or service is enabled by default
and 1 if it is not.
.Nm Cm ls failed
exits with 1 if an enabled daemon is not running.
Otherwise, the
.Nm
utility exits with 0 on success, and >0 if an error occurs
.Po 2 indicates a non-existent
.Ar daemon | service
.Pc .
.Sh EXAMPLES
Enable and set
.Xr apmd 8
flags:
.Bd -literal -offset indent
# rcctl set apmd status on
# rcctl set apmd flags -A
# rcctl get apmd
apmd_class=daemon
apmd_flags=-A
apmd_rtable=0
apmd_timeout=30
apmd_user=root
# echo $?
0
.Ed
.Pp
The recommended way to run a second copy of a given daemon for a
different purpose is to create a symbolic link to its
.Xr rc.d 8
control script:
.Bd -literal -offset indent
# ln -s /etc/rc.d/snmpd /etc/rc.d/snmpd6
# rcctl set snmpd6 status on
# rcctl set snmpd6 flags -D addr=2001:db8::1234
# rcctl start snmpd6
.Ed
.Sh SEE ALSO
.Xr rc.conf.local 8 ,
.Xr rc.d 8
.Sh HISTORY
.Nm
first appeared in
.Ox 5.7 .
.Sh AUTHORS
.Nm
was written by
.An Antoine Jacoutot Aq Mt ajacoutot@@openbsd.org .
@


1.33
log
@Implement rcctl get|getdef all.
With this and the previous 2 commits, we can move from constructs like:
$ for i in $(rcctl ls all); do rcctl get $i; done
to just:
$ rcctl get all
Shrinking the run by a factor of more than 3.5.

prodded by and discussed with reyk@@ at BSDcan2016
ok robert@@
@
text
@d1 1
a1 1
.\"	$OpenBSD: rcctl.8,v 1.32 2016/04/26 17:58:42 ajacoutot Exp $
d17 1
a17 1
.Dd $Mdocdate: April 26 2016 $
d111 1
a111 1
.Bl -tag -width started -offset indent -compact
@


1.32
log
@Implement daemon_rtable support.
From Jiri B <jirib ! devio ! us>, thanks!
@
text
@d1 1
a1 1
.\"	$OpenBSD: rcctl.8,v 1.31 2016/04/01 08:18:57 ajacoutot Exp $
d17 1
a17 1
.Dd $Mdocdate: April 1 2016 $
d94 8
@


1.31
log
@Rename the 'faulty' list action to 'failed'; it clearer.

prodded by matthieu@@
ok millert@@ jung@@ sthen@@
@
text
@d1 1
a1 1
.\"	$OpenBSD: rcctl.8,v 1.30 2016/01/30 18:57:31 ajacoutot Exp $
d17 1
a17 1
.Dd $Mdocdate: January 30 2016 $
d192 1
@


1.30
log
@Actually order matters; I missed it when reviewing previous.
@
text
@d1 1
a1 1
.\"	$OpenBSD: rcctl.8,v 1.29 2016/01/30 12:14:08 schwarze Exp $
d106 1
a106 1
.It Cm faulty
d174 1
a174 1
.Nm Cm ls faulty
@


1.29
log
@Explain how to run multiple copies of the same daemon;
triggered by a frequently asked question by Paolo Aglialoro on misc@@;
using snmpd(8) on inet6(4) as an example suggested by sthen@@;
tweaks and OK ajacoutot@@.
@
text
@d1 1
a1 1
.\"	$OpenBSD: rcctl.8,v 1.28 2016/01/29 23:53:08 jmc Exp $
d17 1
a17 1
.Dd $Mdocdate: January 29 2016 $
d204 1
a205 1
# rcctl set snmpd6 status on
@


1.28
log
@whitespace fixes; ok ajacoutot
@
text
@d1 1
a1 1
.\"	$OpenBSD: rcctl.8,v 1.27 2016/01/29 20:14:08 ajacoutot Exp $
d196 11
@


1.27
log
@Use apmd instead of ntpd in the example since the later is on by default.
@
text
@d1 1
a1 1
.\"	$OpenBSD: rcctl.8,v 1.26 2015/10/24 17:08:36 jmc Exp $
d17 1
a17 1
.Dd $Mdocdate: October 24 2015 $
d187 1
a187 1
# rcctl set apmd status on                                                                      
d189 1
a189 1
# rcctl get apmd                                                                                
@


1.26
log
@some minor tweaks; ok ajacoutot
@
text
@d1 1
a1 1
.\"	$OpenBSD: rcctl.8,v 1.25 2015/10/24 13:57:24 ajacoutot Exp $
d184 1
a184 1
.Xr ntpd 8
d187 7
a193 6
# rcctl set ntpd status on
# rcctl set ntpd flags -s
# rcctl get ntpd
ntpd_flags=-s
ntpd_timeout=30
ntpd_user=root
@


1.25
log
@"enable" and "disable" are here to stay now that they have a real added value
(possibility to pass several enable|disable daemons at once); so document them.
While here, add a check to make sure a service|daemon exists when running "order".

"Yay" and ok sthen@@
@
text
@d1 1
a1 1
.\"	$OpenBSD: rcctl.8,v 1.24 2015/10/06 18:46:05 schwarze Exp $
d17 1
a17 1
.Dd $Mdocdate: October 6 2015 $
d31 1
a31 1
.Cm disable|enable|order
d76 1
a76 1
.Dq Cm set Ar service | daemon Cm status off .
d79 1
a79 1
.Dq Cm set Ar service | daemon Cm status on .
@


1.24
log
@With growing functionality, the synopsis became long and confusing.
The syntax of some subcommands has almost nothing in common with the
syntax of others.  So split the synopsis to make it more readable.
"if you feel it helps, go for it"  jmc@@ ajacoutot@@
@
text
@d1 1
a1 1
.\"	$OpenBSD: rcctl.8,v 1.23 2015/10/06 18:35:55 schwarze Exp $
d31 1
a31 1
.Cm order
d74 6
@


1.23
log
@use ellipsis for arguments that can be repeated;
ok ajacoutot@@ jmc@@
@
text
@d1 1
a1 1
.\"	$OpenBSD: rcctl.8,v 1.22 2015/10/04 13:38:25 ajacoutot Exp $
d17 1
a17 1
.Dd $Mdocdate: October 4 2015 $
d25 3
d29 7
a35 4
.Sm off
.Ar action | Cm get | getdef | ls | order | set
.Sm on
.Op Ar service | daemon Oo Ar variable Oo Ar arguments Oc Oc | Ar daemons | lsarg
@


1.22
log
@Plural.
@
text
@d1 1
a1 1
.\"	$OpenBSD: rcctl.8,v 1.21 2015/07/25 09:45:51 schwarze Exp $
d17 1
a17 1
.Dd $Mdocdate: July 25 2015 $
d61 1
a61 1
.It Oo Fl df Oc Ar action daemons
d64 1
a64 1
.Ar daemons
d105 2
a106 4
.It Cm order Op Ar daemons
Move the specified package
.Ar daemons
to the beginning of
d109 3
a111 3
If
.Ar daemons
is empty, display the current order.
@


1.21
log
@Use .Cm rather than .Ar for fixed strings passed as arguments (command
modifiers).  Patch from Michael Reed <m dot reed at mykolab dot com>,
tweaked by jmc@@.
@
text
@d1 1
a1 1
.\"	$OpenBSD: rcctl.8,v 1.20 2015/07/15 05:51:08 jmc Exp $
d17 1
a17 1
.Dd $Mdocdate: July 15 2015 $
d61 1
a61 1
.It Oo Fl df Oc Ar action daemon
d64 2
a65 2
.Ar daemon
script with the
@


1.20
log
@tweak previous;
@
text
@d1 1
a1 1
.\"	$OpenBSD: rcctl.8,v 1.19 2015/07/15 04:19:41 ajacoutot Exp $
d88 2
a89 3
.Ar lsarg .
.Ar lsargs
can be one of:
d92 1
a92 1
.It Ar all
d94 1
a94 1
.It Ar faulty
d96 1
a96 1
.It Ar off
d98 1
a98 1
.It Ar on
d100 1
a100 1
.It Ar started
d102 1
a102 1
.It Ar stopped
d164 1
a164 1
.Nm Cm ls Ar faulty
@


1.19
log
@Make it possible to get the daemon_class.
@
text
@d1 1
a1 1
.\"	$OpenBSD: rcctl.8,v 1.18 2015/07/14 23:16:56 ajacoutot Exp $
d17 1
a17 1
.Dd $Mdocdate: July 14 2015 $
d29 1
a29 1
.Op Ar service | daemon Oo Ar variable Oo Ar arguments Oc Oc | Ar daemons | Ar lsarg
d91 1
a92 1
.Pp
@


1.18
log
@Deprecate getall (will be removed after 5.8).
Implement a new "ls" subcommand, to list daemons according to the argument
(all, started, ...).

input and ok robert@@
ok jasper@@
@
text
@d1 1
a1 1
.\"	$OpenBSD: rcctl.8,v 1.17 2015/04/22 16:25:31 schwarze Exp $
d17 1
a17 1
.Dd $Mdocdate: April 22 2015 $
d53 1
@


1.17
log
@Use .Ar for placeholders and .Cm for arguments to be provided verbatim.
No text change.
Inconsistent markup noticed by Alex dot Greif at greifdesign dot net.
OK jmc@@ ajacoutot@@.
@
text
@d1 1
a1 1
.\"	$OpenBSD: rcctl.8,v 1.16 2015/01/08 09:03:26 ajacoutot Exp $
d17 1
a17 1
.Dd $Mdocdate: January 8 2015 $
d27 1
a27 1
.Cm enable | disable | get | set | getdef | getall | order | Ar action
d29 1
a29 1
.Op Ar service | daemon Oo Ar variable Oo Ar arguments Oc Oc | Ar daemons
d60 7
a66 6
.It Cm enable Ar service | daemon
Alias for
.Dq Cm set Ar service | daemon Cm status on .
.It Cm disable Ar service | daemon
Alias for
.Dq Cm set Ar service | daemon Cm status off .
d81 40
a151 31
.It Cm getdef Ar service | daemon Op Ar variable
Like
.Cm get
but returns the default values.
.It Cm getall
Display all services and daemon variables with their values in a format
compatible with
.Xr rc.conf 8 .
.It Cm order Op Ar daemons
Move the specified package
.Ar daemons
to the beginning of
.Va pkg_scripts .
They need to be already enabled.
If
.Ar daemons
is empty, display the current order.
.Pp
The
.Cm order
command is only needed after enabling a new daemon
that needs to run before one or more already enabled daemons.
Specify the new daemon preceded by all that need to run before it,
but not the ones depending on it.
.It Oo Fl df Oc Ar action daemon
Run the
.Xr rc.d 8
.Ar daemon
script with the
.Ar action
argument, passing through the specified options, if any.
d164 2
@


1.16
log
@Clarify and simplify.
@
text
@d1 1
a1 1
.\"	$OpenBSD: rcctl.8,v 1.15 2015/01/07 17:15:47 ajacoutot Exp $
d17 1
a17 1
.Dd $Mdocdate: January 7 2015 $
d53 3
a55 3
.Ar flags ,
.Ar status ,
.Ar timeout
d57 1
a57 1
.Ar user
d62 1
a62 1
.Dq Cm set Ar service | daemon Cm status Ar on .
d65 1
a65 1
.Dq Cm set Ar service | daemon Cm status Ar off .
d70 1
a70 1
.Ar daemon_variable .
d80 1
a80 1
.It Cm set Ar service | daemon Cm variable Op Ar arguments
d82 1
a82 1
.Ar daemon Ns _variable
d86 1
a86 1
.Cm variable
d88 1
a88 1
.Ar daemon Ns _variable
d94 4
a97 4
.Ar status Cm variable
must be provided with
the
.Ar on
d99 1
a99 1
.Ar off
d149 1
a149 1
.Nm Cm get Ar daemon | service Op status
d151 1
a151 1
.Nm Cm getdef Ar daemon | service Op status
@


1.15
log
@Tweaks from jmc@@
@
text
@d1 1
a1 1
.\"	$OpenBSD: rcctl.8,v 1.14 2015/01/07 10:44:14 ajacoutot Exp $
d40 3
a42 2
For a daemon, it can also change the command line arguments, the running
user, the
d44 1
a44 1
script timeout or call its
d62 1
a62 1
.Dq Cm set Ar service|daemon Cm status Ar on .
d65 2
a66 2
.Dq Cm set Ar service|daemon Cm status Ar off .
.It Cm get Ar daemon Op variable
d70 6
d77 1
a77 4
variable.
Without a variable, display all
.Ar daemon
variables with their values in a format
d80 1
a80 1
.It Cm set Ar daemon Cm variable Op arguments
d90 2
a91 7
.Cm variable .
If
.Cm variable
is appended without any
.Ar arguments ,
.Ar daemon Ns _variable
is reset to its default value.
d95 2
a96 1
only takes the
d100 6
a105 2
argument.
It is used to enable or disable a service or daemon in
d111 1
a111 1
.It Cm getdef Ar daemon Op variable
d116 2
a117 1
Display all services and daemon values in a format compatible with
d149 1
a149 1
.Nm Cm get Ar daemon|service Op status
d151 1
a151 1
.Nm Cm getdef Ar daemon|service Op status
d156 1
a156 1
utility exits 0 on success, and >0 if an error occurs
d158 1
a158 1
.Ar daemon|service
@


1.14
log
@Start tweaking a bit.
@
text
@d1 1
a1 1
.\"	$OpenBSD: rcctl.8,v 1.13 2015/01/06 12:28:56 ajacoutot Exp $
d17 1
a17 1
.Dd $Mdocdate: January 6 2015 $
d48 1
a48 2
The following commands are available:
.D1
d57 1
a57 1
.Pc
@


1.13
log
@Sync with new rcctl usage. Will get some much needed love within the next
few days.
@
text
@d1 1
a1 1
.\"	$OpenBSD: rcctl.8,v 1.12 2014/12/29 15:09:00 schwarze Exp $
d17 1
a17 1
.Dd $Mdocdate: December 29 2014 $
d40 4
a43 1
For a daemon, it can also change the command line arguments or call its
d48 3
d57 2
a58 2
.Ar user .
The following commands are available:
d72 3
a74 1
Without a variable, display all variables with their values in a format
@


1.12
log
@document ordering more explicitly;
feedback and ok ajacoutot@@ rpe@@
@
text
@d1 1
a1 1
.\"	$OpenBSD: rcctl.8,v 1.11 2014/12/24 13:04:43 ajacoutot Exp $
d17 1
a17 1
.Dd $Mdocdate: December 24 2014 $
d27 1
a27 1
.Cm enable | disable | status | default | order | Ar action
d29 1
a29 1
.Op Ar service | daemon Oo Cm flags Oo Ar arguments Oc Oc | Ar daemons
d39 1
a39 1
or display its status.
d45 7
d54 18
a71 8
.It Cm enable Ar service | daemon Op Cm flags Op Ar arguments
Enable the service or daemon in
.Xr rc.conf.local 8 .
When a disabled package daemon is enabled, it is appended to the end of
.Va pkg_scripts .
.Pp
For a daemon, optionally set the variable
.Ar daemon Ns _flags
d75 7
a81 1
.Cm flags
d84 1
a84 1
.Ar daemon Ns _flags
d86 9
a94 8
If
.Ar daemon
is already enabled,
.Ar daemon Ns _flags
is reset to the optionally provided
.Cm flags .
.It Cm disable Ar service | daemon
Disable the service or daemon in
d96 1
a96 1
A package daemon is removed from
d98 8
a105 8
.It Cm status Op Ar service | daemon
Display the value of
.Ar service
or
.Ar daemon Ns _flags .
Without an argument, display all services and
.Ar daemon Ns _flags
with their values in a format compatible with
a106 6
.It Cm default Op Ar service | daemon
For a daemon, display the flags that will be used if
.Dq Cm enable Ar daemon Cm flags
is called without
.Ar arguments .
For a base system service, display whether it is enabled by default.
d137 1
a137 1
.Nm Cm status
d139 1
a139 1
.Nm Cm default
d146 1
a146 1
.Ar service
d153 6
a158 3
# rcctl enable ntpd flags -s
# rcctl status ntpd
-s
@


1.11
log
@Implement some kind ordering in the startup of package script daemons.
'rcctl order ...' will prepend the daemon(s) given as argument to the
pkg_scripts line (it can be all daemons, some, or just one).
Without argument, it'll display the current order.

While here, drop a couple of examples from the man page to only leave
the most interesting one.

ok schwarze@@ rpe@@ (with tweaks) jasper@@ robert@@ sthen@@
@
text
@d1 1
a1 1
.\"	$OpenBSD: rcctl.8,v 1.10 2014/10/13 14:12:57 schwarze Exp $
d17 1
a17 1
.Dd $Mdocdate: October 13 2014 $
d50 3
d72 2
d90 1
a90 4
Order
.Sy enabled
.Xr packages 7
daemons startup by prepending
d92 3
a94 1
to the pkg_scripts line.
d98 7
@


1.10
log
@document the "default" subcommand more precisely;
joint work with and OK by ajacoutot@@
@
text
@d1 1
a1 1
.\"	$OpenBSD: rcctl.8,v 1.9 2014/10/11 13:42:49 ajacoutot Exp $
d17 1
a17 1
.Dd $Mdocdate: October 11 2014 $
d27 1
a27 1
.Cm enable | disable | status | default | Ar action
d29 1
a29 1
.Op Ar service | daemon Op Cm flags Op Ar arguments
d84 10
a119 11
Disable
.Xr ntpd 8
and check its status:
.Bd -literal -offset indent
# rcctl disable ntpd
# rcctl status ntpd
NO
# echo $?
1
.Ed
.Pp
a126 12
# echo $?
0
.Ed
.Pp
Start
.Xr ntpd 8
and check that it is running:
.Bd -literal -offset indent
# rcctl start ntpd
ntpd(ok)
# rcctl check ntpd
ntpd(ok)
@


1.9
log
@Add a new "default" command to  display the default flags and whether a
service is enabled or disabled by default.

idea from Patrik Lundin
discussed with and ok schwarze@@
@
text
@d1 1
a1 1
.\"	$OpenBSD: rcctl.8,v 1.8 2014/08/31 06:52:46 ajacoutot Exp $
d17 1
a17 1
.Dd $Mdocdate: August 31 2014 $
d79 5
a83 3
Like
.Cm status
but return the default values instead of the configured ones.
d100 3
@


1.8
log
@Document that exit code 2 indicates a non-existent service.
@
text
@d1 1
a1 1
.\"	$OpenBSD: rcctl.8,v 1.7 2014/08/29 17:17:22 ajacoutot Exp $
d17 1
a17 1
.Dd $Mdocdate: August 29 2014 $
d27 1
a27 1
.Cm enable | disable | status | Ar action
d78 4
@


1.7
log
@Document the fact that 'enable' can also be used to modify flags even if
the daemon is already enabled.
@
text
@d1 1
a1 1
.\"	$OpenBSD: rcctl.8,v 1.6 2014/08/24 07:33:26 ajacoutot Exp $
d17 1
a17 1
.Dd $Mdocdate: August 24 2014 $
d96 4
a99 1
utility exits 0 on success, and >0 if an error occurs.
@


1.6
log
@Make it possible to pass `-d' and `-f' to the rc.d(8) script.

man page bits from schwarze@@
ok jasper@@ schwarze@@
@
text
@d1 1
a1 1
.\"	$OpenBSD: rcctl.8,v 1.5 2014/08/21 12:47:22 ajacoutot Exp $
d17 1
a17 1
.Dd $Mdocdate: August 21 2014 $
d60 6
@


1.5
log
@Make "rcctl status" output match rc.conf(8) format.

ok jasper@@
@
text
@d1 1
a1 1
.\"	$OpenBSD: rcctl.8,v 1.4 2014/08/21 10:15:11 schwarze Exp $
d25 1
d72 1
a72 1
.It Ar action daemon
d78 1
a78 1
argument.
@


1.4
log
@Now that rc.conf(8) defines what a base system service, a base
system daemon, and a package daemon is, refer to it instead of
duplicating information.  While here, clean up wording.
OK ajacoutot@@
@
text
@d1 1
a1 1
.\"	$OpenBSD: rcctl.8,v 1.3 2014/08/19 17:45:43 schwarze Exp $
d17 1
a17 1
.Dd $Mdocdate: August 19 2014 $
d67 4
a70 2
Without an argument, list all services and daemons
with their current status and flags.
@


1.3
log
@To make it even more obvious which combinations are allowed,
provide sub-synopses for the various internal commands,
and make it explicit what applies to daemons only and what
applies to other services as well.
Feedback and OK ajacoutot@@.
@
text
@d1 1
a1 1
.\"	$OpenBSD: rcctl.8,v 1.2 2014/08/19 16:05:02 schwarze Exp $
d30 1
d32 8
a39 6
is a simple utility for maintaining
.Xr rc.conf.local 8 .
It can enable or disable
.Xr rc 8
services and get/set their status and flags.
It can also be used to interact with
d41 2
a42 1
scripts.
d44 1
a44 3
The following
.Ar actions
are available.
a76 7
.Pp
These services have no corresponding
.Xr rc.d 8
script and have no
.Cm flags :
accounting, check_quotas, ipsec, multicast_host, multicast_router,
pf, spamd_black.
@


1.2
log
@mdoc(7) style: remove trailing whitespace and .Pp before non-compact .Bd/.Bl
@
text
@d1 1
a1 1
.\"	$OpenBSD: rcctl.8,v 1.1 2014/08/19 14:08:20 ajacoutot Exp $
d22 1
a22 1
.Nd configure and control services
d28 1
a28 1
.Op Ar service Op Cm flags Op Ar arguments
d43 3
a45 5
.Bl -tag -width disable
.It Cm enable
Enable
.Ar service
in
d47 2
a48 2
Optionally set
.Ar service Ns _flags
a49 1
.Cm flags
d55 1
a55 1
.Ar service Ns _flags
d57 2
a58 4
.It Cm disable
Disable
.Ar service
in
d60 1
a60 1
.It Cm status
d62 1
a62 1
.Ar service Ns _flags
d64 4
a67 4
.Ar service .
If none is provided, list all services with their current status and
flags.
.It Ar action
d70 1
a70 1
.Ar service
d86 1
a86 1
.Ar service
d89 1
a89 1
exits with 0 if the service is enabled and 1 if it is not.
@


1.1
log
@Introduce rcctl(8), a simple utility for maintaining rc.conf.local(8).

# rcctl
usage: rcctl enable|disable|status|action [service [flags [...]]]

Lots of man page improvement from the usual suspects (jmc@@ and schwarze@@)
not hooked up yet but committing now so work can continue in-tree
agreed by several
@
text
@d1 1
a1 1
.\"	$OpenBSD$
d17 1
a17 1
.Dd $Mdocdate$
a42 1
.Pp
d80 1
a80 1
.Pp                 
a101 1
.Pp
a112 1
.Pp
a123 1
.Pp
@

