head	1.18;
access;
symbols
	OPENBSD_4_9:1.16.0.4
	OPENBSD_4_9_BASE:1.16
	OPENBSD_4_8:1.16.0.2
	OPENBSD_4_8_BASE:1.16
	OPENBSD_4_7:1.15.0.10
	OPENBSD_4_7_BASE:1.15
	OPENBSD_4_6:1.15.0.12
	OPENBSD_4_6_BASE:1.15
	OPENBSD_4_5:1.15.0.8
	OPENBSD_4_5_BASE:1.15
	OPENBSD_4_4:1.15.0.6
	OPENBSD_4_4_BASE:1.15
	OPENBSD_4_3:1.15.0.4
	OPENBSD_4_3_BASE:1.15
	OPENBSD_4_2:1.15.0.2
	OPENBSD_4_2_BASE:1.15
	OPENBSD_4_1:1.14.0.2
	OPENBSD_4_1_BASE:1.14
	OPENBSD_4_0:1.13.0.10
	OPENBSD_4_0_BASE:1.13
	OPENBSD_3_9:1.13.0.8
	OPENBSD_3_9_BASE:1.13
	OPENBSD_3_8:1.13.0.6
	OPENBSD_3_8_BASE:1.13
	OPENBSD_3_7:1.13.0.4
	OPENBSD_3_7_BASE:1.13
	OPENBSD_3_6:1.13.0.2
	OPENBSD_3_6_BASE:1.13
	OPENBSD_3_5:1.12.0.2
	OPENBSD_3_5_BASE:1.12
	OPENBSD_3_4:1.10.0.2
	OPENBSD_3_4_BASE:1.10
	OPENBSD_3_3:1.8.0.8
	OPENBSD_3_3_BASE:1.8
	OPENBSD_3_2:1.8.0.6
	OPENBSD_3_2_BASE:1.8
	OPENBSD_3_1:1.8.0.4
	OPENBSD_3_1_BASE:1.8
	OPENBSD_3_0:1.8.0.2
	OPENBSD_3_0_BASE:1.8
	OPENBSD_2_9_BASE:1.6
	OPENBSD_2_9:1.6.0.6
	OPENBSD_2_8:1.6.0.4
	OPENBSD_2_8_BASE:1.6
	OPENBSD_2_7:1.6.0.2
	OPENBSD_2_7_BASE:1.6
	OPENBSD_2_6:1.5.0.2
	OPENBSD_2_6_BASE:1.5
	OPENBSD_2_5:1.3.0.2
	OPENBSD_2_5_BASE:1.3
	OPENBSD_2_4:1.1.1.1.0.10
	OPENBSD_2_4_BASE:1.1.1.1
	OPENBSD_2_3:1.1.1.1.0.8
	OPENBSD_2_3_BASE:1.1.1.1
	OPENBSD_2_2:1.1.1.1.0.6
	OPENBSD_2_2_BASE:1.1.1.1
	OPENBSD_2_1:1.1.1.1.0.4
	OPENBSD_2_1_BASE:1.1.1.1
	OPENBSD_2_0:1.1.1.1.0.2
	OPENBSD_2_0_BASE:1.1.1.1
	netbsd_1_1:1.1.1.1;
locks; strict;
comment	@.\" @;


1.18
date	2011.07.07.21.00.59;	author deraadt;	state dead;
branches;
next	1.17;

1.17
date	2011.05.02.11.14.11;	author jmc;	state Exp;
branches;
next	1.16;

1.16
date	2010.04.01.17.06.55;	author jmc;	state Exp;
branches;
next	1.15;

1.15
date	2007.05.31.19.20.30;	author jmc;	state Exp;
branches;
next	1.14;

1.14
date	2007.02.19.22.39.57;	author jmc;	state Exp;
branches;
next	1.13;

1.13
date	2004.07.09.19.33.09;	author jmc;	state Exp;
branches;
next	1.12;

1.12
date	2003.11.04.14.06.15;	author jmc;	state Exp;
branches;
next	1.11;

1.11
date	2003.09.22.04.49.53;	author jmc;	state Exp;
branches;
next	1.10;

1.10
date	2003.06.17.06.21.55;	author jmc;	state Exp;
branches;
next	1.9;

1.9
date	2003.06.02.23.36.55;	author millert;	state Exp;
branches;
next	1.8;

1.8
date	2001.06.23.05.57.11;	author deraadt;	state Exp;
branches;
next	1.7;

1.7
date	2001.06.23.02.33.00;	author deraadt;	state Exp;
branches;
next	1.6;

1.6
date	2000.03.19.17.57.16;	author aaron;	state Exp;
branches;
next	1.5;

1.5
date	99.06.05.22.18.17;	author aaron;	state Exp;
branches;
next	1.4;

1.4
date	99.05.23.14.11.38;	author aaron;	state Exp;
branches;
next	1.3;

1.3
date	99.04.02.15.12.21;	author aaron;	state Exp;
branches;
next	1.2;

1.2
date	99.03.11.21.08.04;	author aaron;	state Exp;
branches;
next	1.1;

1.1
date	95.10.18.08.48.28;	author deraadt;	state Exp;
branches
	1.1.1.1;
next	;

1.1.1.1
date	95.10.18.08.48.28;	author deraadt;	state Exp;
branches;
next	;


desc
@@


1.18
log
@timed's time is up.  use ntpd(8).  Even our own fossil developers
switched a while back.
ok miod, kettenis
@
text
@.\"	$OpenBSD: timed.8,v 1.17 2011/05/02 11:14:11 jmc Exp $
.\"
.\" Copyright (c) 1980, 1991 Regents of the University of California.
.\" All rights reserved.
.\"
.\" Redistribution and use in source and binary forms, with or without
.\" modification, are permitted provided that the following conditions
.\" are met:
.\" 1. Redistributions of source code must retain the above copyright
.\"    notice, this list of conditions and the following disclaimer.
.\" 2. Redistributions in binary form must reproduce the above copyright
.\"    notice, this list of conditions and the following disclaimer in the
.\"    documentation and/or other materials provided with the distribution.
.\" 3. Neither the name of the University nor the names of its contributors
.\"    may be used to endorse or promote products derived from this software
.\"    without specific prior written permission.
.\"
.\" THIS SOFTWARE IS PROVIDED BY THE REGENTS AND CONTRIBUTORS ``AS IS'' AND
.\" ANY EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT LIMITED TO, THE
.\" IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE
.\" ARE DISCLAIMED.  IN NO EVENT SHALL THE REGENTS OR CONTRIBUTORS BE LIABLE
.\" FOR ANY DIRECT, INDIRECT, INCIDENTAL, SPECIAL, EXEMPLARY, OR CONSEQUENTIAL
.\" DAMAGES (INCLUDING, BUT NOT LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS
.\" OR SERVICES; LOSS OF USE, DATA, OR PROFITS; OR BUSINESS INTERRUPTION)
.\" HOWEVER CAUSED AND ON ANY THEORY OF LIABILITY, WHETHER IN CONTRACT, STRICT
.\" LIABILITY, OR TORT (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY
.\" OUT OF THE USE OF THIS SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF
.\" SUCH DAMAGE.
.\"
.\"     @@(#)timed.8	6.7 (Berkeley) 5/11/93
.\"
.Dd $Mdocdate: May 2 2011 $
.Dt TIMED 8
.Os
.Sh NAME
.Nm timed
.Nd time server daemon
.Sh SYNOPSIS
.Nm timed
.Op Fl dMt
.Op Fl F Ar host ...
.Op Fl G Ar netgroup
.Xo
.Oo Fl i Ar network |
.Fl n Ar network Oc
.Xc
.Sh DESCRIPTION
The
.Nm
utility is a time server daemon
which is normally invoked at boot time from the
.Xr rc 8
file.
It synchronizes the host's time with the time of other
machines, which are also running
.Nm timed ,
in a local area network.
These time servers will slow down the clocks of some machines
and speed up the clocks of others to bring them to the average network time.
The average network time is computed from measurements of clock differences
using the
.Tn ICMP
timestamp request message.
.Pp
The following options are available:
.Bl -tag -width indent
.It Fl d
Enable debugging mode;
do not detach from the terminal.
.It Fl F Ar host ...
Create a list of trusted hosts.
The
.Nm
utility will only accept trusted hosts as masters.
If it finds an untrusted host claiming to be master,
.Nm
will suppress incoming messages from that host
and call for a new election.
This option implies the
.Fl M
option.
If this option is not specified,
all hosts on the connected networks are treated as trustworthy.
.It Fl G Ar netgroup
Specify a netgroup of trustworthy hosts,
in addition to any masters specified with the
.It Fl i Ar network
Add
.Ar network
to the list of networks to ignore.
All other networks
to which the machine is directly connected
are used by
.Nm timed .
This option may be specified multiple times
to add more than one network to the list.
.Fl M
flag.
This option may only be specified once.
.It Fl M
Allow this host to become a
.Nm
master if necessary.
.It Fl n Ar network
Add
.Ar network
to the list of allowed networks.
All other networks
to which the machine is directly connected
are ignored by
.Nm timed .
This option may be specified multiple times
to add more than one network to the list.
.It Fl t
Enable tracing of received messages
and log to the file
.Pa /var/log/timed.log .
Tracing can be turned on or off while
.Nm
is running with the
.Xr timedc 8
utility.
.El
.Pp
The
.Fl n
and
.Fl i
flags are mutually exclusive
and require as arguments real networks to which
the host is connected
(see
.Xr networks 5 ) .
If neither flag is specified,
.Nm
will listen on all connected networks.
.Pp
A
.Nm
running without the
.Fl M
nor
.Fl F
flags will always remain a slave.
If the
.Fl F
flag is not used,
.Nm
will treat all machines as trustworthy.
.Pp
The
.Nm
utility is based on a master-slave
scheme.
When
.Nm
is started on a machine, it asks the master for the network time
and sets the host's clock to that time.
After that, it accepts synchronization messages periodically sent by
the master and calls
.Xr adjtime 2
to perform the needed corrections on the host's clock.
.Pp
It also communicates with
.Xr date 1
in order to set the date globally,
and with
.Xr timedc 8 ,
a
.Nm
control utility.
If the machine running the master becomes unreachable,
the slaves will elect a new master
from among those slaves
which are running with at least one of the
.Fl M
and
.Fl F
flags.
.Pp
At startup
.Nm
normally checks for a master time server on each network to which
it is connected, except as modified by the
.Fl n
and
.Fl i
options described above.
It will request synchronization service from the first master server
located.
If permitted by the
.Fl M
or
.Fl F
flags, it will provide synchronization service on any attached networks
on which no trusted master server was detected.
Such a server propagates the time computed by the top-level master.
The
.Nm
utility will periodically check for the presence of a master
on those networks for which it is operating as a slave.
If it finds that there are no trusted masters on a network,
it will begin the election process on that network.
.Pp
One way to synchronize a group of machines is to use an
.Tn NTP
daemon to
synchronize the clock of one machine to a distant standard or a radio
receiver and
.Fl F Ar hostname
to tell its timed daemon to trust only itself.
.Pp
Messages printed by the kernel on the system console occur with
interrupts disabled.
This means that the clock stops while they are printing.
A machine with many disk or network hardware problems and consequent
messages cannot keep good time by itself.
Each message typically causes
the clock to lose a dozen milliseconds.
A time daemon can correct the result.
.Pp
Messages in the system log about machines that failed to respond
usually indicate machines that crashed or were turned off.
Complaints about machines that failed to respond to initial time
settings are often associated with
.Dq multi-homed
machines that looked for time masters on more than one network and eventually
chose to become a slave on the other network.
.Sh FILES
.Bl -tag -width /var/log/timed.masterlog -compact
.It Pa /var/log/timed.log
tracing file for
.Nm
.It Pa /var/log/timed.masterlog
log file for master
.Nm
.El
.Sh SEE ALSO
.Xr date 1 ,
.Xr adjtime 2 ,
.Xr gettimeofday 2 ,
.Xr icmp 4 ,
.Xr netgroup 5 ,
.Xr networks 5 ,
.Xr ntpd 8 ,
.Xr rdate 8 ,
.Xr timedc 8
.Rs
.%T "TSP: The Time Synchronization Protocol for UNIX 4.3BSD"
.%A R. Gusella
.%A S. Zatti
.Re
.Sh HISTORY
The
.Nm
utility appeared in
.Bx 4.3 .
.Sh CAVEATS
Temporal chaos will result if two or more time daemons attempt
to adjust the same clock.
If both
.Nm
and another time daemon are run on the same machine,
ensure that the
.Fl F
flag is used, so that
.Nm
never attempts to adjust the local clock.
.Pp
The protocol is based on
.Tn UDP/IP
broadcasts.
All machines within the range of a broadcast that are using the
.Tn TSP
protocol must cooperate.
There cannot be more than a single administrative domain using the
.Fl F
flag among all machines reached by a broadcast packet.
Failure to follow this rule is usually indicated by complaints concerning
.Dq untrusted
machines in the system log.
@


1.17
log
@no need to escape `|'; as discussed with schwartze
@
text
@d1 1
a1 1
.\"	$OpenBSD: timed.8,v 1.16 2010/04/01 17:06:55 jmc Exp $
d32 1
a32 1
.Dd $Mdocdate: April 1 2010 $
@


1.16
log
@WARNINGS -> CAVEATS, and a little neccessary cleanup;
@
text
@d1 1
a1 1
.\"	$OpenBSD: timed.8,v 1.15 2007/05/31 19:20:30 jmc Exp $
d32 1
a32 1
.Dd $Mdocdate: May 31 2007 $
d44 1
a44 1
.Oo Fl i Ar network No \&|
@


1.15
log
@convert to new .Dd format;
@
text
@d1 1
a1 1
.\"	$OpenBSD: timed.8,v 1.14 2007/02/19 22:39:57 jmc Exp $
d32 1
a32 1
.Dd $Mdocdate$
a228 24
.Sh WARNINGS
Temporal chaos will result if two or more time daemons attempt
to adjust the same clock.
If both
.Nm
and another time daemon are run on the same machine,
ensure that the
.Fl F
flag is used, so that
.Nm
never attempts to adjust the local clock.
.Pp
The protocol is based on
.Tn UDP/IP
broadcasts.
All machines within the range of a broadcast that are using the
.Tn TSP
protocol must cooperate.
There cannot be more than a single administrative domain using the
.Fl F
flag among all machines reached by a broadcast packet.
Failure to follow this rule is usually indicated by complaints concerning
.Dq untrusted
machines in the system log.
d258 24
@


1.14
log
@sort options and sync usage(); from Igor Sobrado
@
text
@d1 1
a1 1
.\"	$OpenBSD: timed.8,v 1.13 2004/07/09 19:33:09 jmc Exp $
d32 1
a32 1
.Dd May 11, 1993
@


1.13
log
@make date(1), rdate(8), ntpd(8), and timed(8) .Xr themselves;
mostly from Andreas Kahari (PR #3846);
@
text
@d1 1
a1 1
.\"	$OpenBSD: timed.8,v 1.12 2003/11/04 14:06:15 jmc Exp $
d41 2
a46 2
.Op Fl F Ar host ...
.Op Fl G Ar netgroup
a69 10
.It Fl i Ar network
Add
.Ar network
to the list of networks to ignore.
All other networks
to which the machine is directly connected
are used by
.Nm timed .
This option may be specified multiple times
to add more than one network to the list.
d87 10
@


1.12
log
@sort options in SYNOPSIS and sync usage();
@
text
@d1 1
a1 1
.\"	$OpenBSD: timed.8,v 1.11 2003/09/22 04:49:53 jmc Exp $
d269 2
@


1.11
log
@sync with FreeBSD page, including standard options list and some mdoc nits;
from naddy@@
@
text
@d1 1
a1 1
.\"	$OpenBSD: timed.8,v 1.10 2003/06/17 06:21:55 jmc Exp $
d40 1
a40 1
.Op Fl dtM
@


1.10
log
@- document "-G netgroup";
from Kurt V. Hindenburg on misc@@
- show that -i and -n are mutually exclusive
- sync SYNOPSIS and usage()

help from millert@@
@
text
@d1 1
a1 1
.\"	$OpenBSD: timed.8,v 1.9 2003/06/02 23:36:55 millert Exp $
d45 1
a45 1
.Op Fl F Ar host1 host2 ...
d48 4
a51 3
This
is a time server daemon and is normally invoked
at boot time from the
d55 3
a57 2
machines in a local area network running
.Nm timed .
d65 21
a85 1
The service provided by
d87 67
a153 1
is based on a master-slave
d169 1
a169 6
a timed control program.
If the machine running the master crashes, then the slaves will elect
a new master from among slaves running with the
.Fl M
flag.
A
d171 5
a175 1
running without the
d177 1
a177 1
or
d179 3
a181 4
flags will remain a slave.
The
.Fl t
flag enables
d183 6
a188 13
to trace the messages it receives in the
file
.Pa /var/log/timed.log .
Tracing can be turned on or off by the program
.Xr timedc 8 .
The
.Fl d
flag is for debugging the daemon.
It causes the program to not put itself into the background.
Normally
.Nm
checks for a master time server on each network to which
it is connected, except as modified by the options described below.
d193 4
a196 2
flag, it will provide synchronization service on any attached networks
on which no current master server was detected.
a198 35
.Fl n
flag, followed by the name of a network which the host is connected to
(see
.Xr networks 5 ) ,
overrides the default choice of the
network addresses made by the program.
Each time the
.Fl n
flag appears, that network name is added to a list of valid networks.
All other networks are ignored.
The
.Fl i
flag, followed by the name of a network to which the host is connected
(see
.Xr networks 5 ) ,
overrides the default choice of the network addresses made by the program.
Each time the
.Fl i
flag appears, that network name is added to a list of networks to ignore.
All other networks are used by the time daemon.
The
.Fl n
and
.Fl i
flags are meaningless if used together.
The
.Fl G
flag is used to specify a
.Ar netgroup
of trustworthy hosts,
in addition to any masters specified with the
.Fl M
flag.
It may only be specified once.
.Pp
d200 4
a203 9
checks for a master time server on each network to which
it is connected, except as modified by the
.Fl n
and
.Fl i
options described above.
If it finds masters on more than one network, it chooses one network
on which to be a "slave," and then periodically checks the other
networks to see if the masters there have disappeared.
d205 3
a207 1
One way to synchronize a group of machines is to use an NTP daemon to
d230 2
a231 4
If two or more time daemons, whether
.Nm timed ,
.Xr NTP ,
try to adjust the same clock, temporal chaos will result.
d241 6
a246 3
The protocol is based on UDP/IP broadcasts.
All machines within
the range of a broadcast that are using the TSP protocol must cooperate.
d267 2
d278 1
a278 1
daemon appeared in
@


1.9
log
@Remove the advertising clause in the UCB license which Berkeley
rescinded 22 July 1999.  Proofed by myself and Theo.
@
text
@d1 1
a1 1
.\"	$OpenBSD: timed.8,v 1.8 2001/06/23 05:57:11 deraadt Exp $
d40 5
a44 5
.Op Fl M
.Op Fl t
.Op Fl d
.Op Fl i Ar network
.Op Fl n Ar network
d46 1
d143 9
@


1.8
log
@ok, tmac is now fixed
@
text
@d1 1
a1 1
.\"	$OpenBSD: timed.8,v 1.7 2001/06/23 02:33:00 deraadt Exp $
d14 1
a14 5
.\" 3. All advertising materials mentioning features or use of this software
.\"    must display the following acknowledgement:
.\"	This product includes software developed by the University of
.\"	California, Berkeley and its contributors.
.\" 4. Neither the name of the University nor the names of its contributors
@


1.7
log
@join .%A entries; most by bk@@rt.fm
@
text
@d1 1
a1 1
.\"	$OpenBSD: timed.8,v 1.6 2000/03/19 17:57:16 aaron Exp $
d220 2
a221 1
.%A R. Gusella and S. Zatti
@


1.6
log
@Remove hard sentence breaks. Add $OpenBSD$ tags where appropriate. Some other
cleanup along the way.
@
text
@d1 1
a1 1
.\"	$OpenBSD: timed.8,v 1.5 1999/06/05 22:18:17 aaron Exp $
d220 1
a220 2
.%A R. Gusella
.%A S. Zatti
@


1.5
log
@remove trailing whitespace, some Nm cleanup
@
text
@d1 2
a2 1
.\"	$OpenBSD: timed.8,v 1.4 1999/05/23 14:11:38 aaron Exp $
d168 4
a171 3
messages cannot keep good time by itself.  Each message typically causes
the clock to lose a dozen milliseconds.  A time daemon can
correct the result.
d194 2
a195 1
The protocol is based on UDP/IP broadcasts.  All machines within
@


1.4
log
@remove argument from .Os macros so value in /usr/share/tmac/mdoc/doc-common
is used instead; kwesterback@@home.com
@
text
@d1 1
a1 1
.\"	$OpenBSD: timed.8,v 1.3 1999/04/02 15:12:21 aaron Exp $
d54 1
a54 1
file.  
d56 1
a56 1
machines in a local area network running 
d74 1
a74 1
the master and calls 
d81 1
a81 1
and with 
d85 1
a85 1
a new master from among slaves running with the 
d95 1
a95 1
The 
d119 1
a119 1
The 
d130 1
a130 1
The 
d142 1
a142 1
and 
d157 1
a157 1
One way to synchronize a group of machines is to use an NTP daemon to 
d159 1
a159 1
receiver and 
d164 1
a164 1
interrupts disabled. 
d179 1
a179 1
If two or more time daemons, whether 
d183 1
a183 1
If both 
d186 1
a186 1
ensure that the 
d188 1
a188 1
flag is used, so that 
d191 1
a191 1
.Pp 
@


1.3
log
@all .Nm macros should have an argument in SYNOPSIS; also misc cleanup
@
text
@d1 1
a1 1
.\"	$OpenBSD: timed.8,v 1.2 1999/03/11 21:08:04 aaron Exp $
d37 1
a37 1
.Os BSD 4.3
@


1.2
log
@cleanup
@
text
@d1 1
a1 1
.\"	$OpenBSD$
d42 1
a42 1
.Nm
@


1.1
log
@Initial revision
@
text
@d1 1
d42 1
a42 1
.Nm timed
d66 2
a67 2
.Nm timed
is based  on a master-slave
d70 1
a70 1
.Nm timed
d89 1
a89 1
.Nm timed
d98 1
a98 1
.Nm timed
d109 1
a109 1
.Nm timed
d146 1
a146 1
.Nm Timed
d189 1
a189 1
.Nm timed
d203 2
a204 1
tracing file for timed
d206 2
a207 1
log file for master timed 
@


1.1.1.1
log
@initial import of NetBSD tree
@
text
@@
