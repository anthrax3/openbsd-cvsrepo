head	1.19;
access;
symbols
	OPENBSD_6_0:1.19.0.18
	OPENBSD_6_0_BASE:1.19
	OPENBSD_5_9:1.19.0.14
	OPENBSD_5_9_BASE:1.19
	OPENBSD_5_8:1.19.0.16
	OPENBSD_5_8_BASE:1.19
	OPENBSD_5_7:1.19.0.8
	OPENBSD_5_7_BASE:1.19
	OPENBSD_5_6:1.19.0.12
	OPENBSD_5_6_BASE:1.19
	OPENBSD_5_5:1.19.0.10
	OPENBSD_5_5_BASE:1.19
	OPENBSD_5_4:1.19.0.6
	OPENBSD_5_4_BASE:1.19
	OPENBSD_5_3:1.19.0.4
	OPENBSD_5_3_BASE:1.19
	OPENBSD_5_2:1.19.0.2
	OPENBSD_5_2_BASE:1.19
	OPENBSD_5_1_BASE:1.17
	OPENBSD_5_1:1.17.0.4
	OPENBSD_5_0:1.17.0.2
	OPENBSD_5_0_BASE:1.17
	OPENBSD_4_9:1.16.0.4
	OPENBSD_4_9_BASE:1.16
	OPENBSD_4_8:1.16.0.2
	OPENBSD_4_8_BASE:1.16
	OPENBSD_4_7:1.15.0.2
	OPENBSD_4_7_BASE:1.15
	OPENBSD_4_6:1.13.0.6
	OPENBSD_4_6_BASE:1.13
	OPENBSD_4_5:1.13.0.2
	OPENBSD_4_5_BASE:1.13
	OPENBSD_4_4:1.5.0.2
	OPENBSD_4_4_BASE:1.5;
locks; strict;
comment	@.\" @;


1.19
date	2012.04.30.11.28.25;	author jmatthew;	state Exp;
branches;
next	1.18;

1.18
date	2012.04.24.14.56.09;	author jmc;	state Exp;
branches;
next	1.17;

1.17
date	2011.07.07.02.22.11;	author ajacoutot;	state Exp;
branches;
next	1.16;

1.16
date	2010.06.03.16.10.21;	author ajacoutot;	state Exp;
branches;
next	1.15;

1.15
date	2010.01.02.19.44.53;	author schwarze;	state Exp;
branches;
next	1.14;

1.14
date	2009.12.19.16.21.30;	author jmc;	state Exp;
branches;
next	1.13;

1.13
date	2009.02.16.08.27.20;	author jmc;	state Exp;
branches;
next	1.12;

1.12
date	2009.02.15.21.57.27;	author aschrijver;	state Exp;
branches;
next	1.11;

1.11
date	2008.11.17.13.22.10;	author mbalmer;	state Exp;
branches;
next	1.10;

1.10
date	2008.10.20.16.13.37;	author aschrijver;	state Exp;
branches;
next	1.9;

1.9
date	2008.10.15.07.50.43;	author jmc;	state Exp;
branches;
next	1.8;

1.8
date	2008.10.14.23.05.37;	author deraadt;	state Exp;
branches;
next	1.7;

1.7
date	2008.10.14.22.29.51;	author aschrijver;	state Exp;
branches;
next	1.6;

1.6
date	2008.09.19.08.06.16;	author pyr;	state Exp;
branches;
next	1.5;

1.5
date	2008.06.29.22.04.19;	author pyr;	state Exp;
branches;
next	1.4;

1.4
date	2008.06.29.14.08.00;	author jmc;	state Exp;
branches;
next	1.3;

1.3
date	2008.06.29.10.44.47;	author pyr;	state Exp;
branches;
next	1.2;

1.2
date	2008.06.26.21.24.34;	author jmc;	state Exp;
branches;
next	1.1;

1.1
date	2008.06.26.15.10.01;	author pyr;	state Exp;
branches;
next	;


desc
@@


1.19
log
@add 'groupdn' option for specifying a separate base DN for group searches.
from Jim Smith, ok dlg@@
@
text
@.\"	$OpenBSD: ypldap.conf.5,v 1.18 2012/04/24 14:56:09 jmc Exp $
.\"
.\" Copyright (c) 2008 Pierre-Yves Ritschard <pyr@@openbsd.org>
.\"
.\" Permission to use, copy, modify, and distribute this software for any
.\" purpose with or without fee is hereby granted, provided that the above
.\" copyright notice and this permission notice appear in all copies.
.\"
.\" THE SOFTWARE IS PROVIDED "AS IS" AND THE AUTHOR DISCLAIMS ALL WARRANTIES
.\" WITH REGARD TO THIS SOFTWARE INCLUDING ALL IMPLIED WARRANTIES OF
.\" MERCHANTABILITY AND FITNESS. IN NO EVENT SHALL THE AUTHOR BE LIABLE FOR
.\" ANY SPECIAL, DIRECT, INDIRECT, OR CONSEQUENTIAL DAMAGES OR ANY DAMAGES
.\" WHATSOEVER RESULTING FROM LOSS OF USE, DATA OR PROFITS, WHETHER IN AN
.\" ACTION OF CONTRACT, NEGLIGENCE OR OTHER TORTIOUS ACTION, ARISING OUT OF
.\" OR IN CONNECTION WITH THE USE OR PERFORMANCE OF THIS SOFTWARE.
.\"
.Dd $Mdocdate: April 24 2012 $
.Dt YPLDAP.CONF 5
.Os
.Sh NAME
.Nm ypldap.conf
.Nd LDAP YP map daemon configuration file
.Sh DESCRIPTION
The
.Xr ypldap 8
daemon provides YP maps using LDAP as a backend.
.Sh SECTIONS
The
.Nm
config file is divided into three main sections.
.Bl -tag -width xxxx
.It Sy Macros
User-defined variables may be defined and used later, simplifying the
configuration file.
.It Sy Global Configuration
Global settings for
.Xr ypldap 8 .
.It Sy Directories
LDAP Directory specific parameters.
.El
.Sh MACROS
Much like
.Xr cpp 1
or
.Xr m4 1 ,
macros can be defined that will later be expanded in context.
Macro names must start with a letter, digit, or underscore,
and may contain any of those characters.
Macro names may not be reserved words (for example,
.Ic domain ) .
Macros are not expanded inside quotes.
.Pp
For example:
.Bd -literal -offset indent

fixed_gecos="Pulled from LDAP"

fixed attribute gecos $fixed_gecos
.Ed
.Sh GLOBAL CONFIGURATION
Global settings concern the main behaviour of the daemon.
.Pp
.Bl -tag -width Ds -compact
.It domain Ar string
Specify the name of the NIS domain
.Nm
will provide.
.It interval Ar seconds
Specify the interval in seconds at which the whole directory will be pulled
from LDAP.
.It provide map Ar string
Specify a map that should be provided by
.Nm
The currently implemented maps are: passwd.byname, passwd.byuid,
group.byname, group.bygid.
.El
.Sh DIRECTORIES
Directories are used to describe the LDAP schema and help
.Nm
convert LDAP entries to
.Xr passwd 5 ,
.Xr master.passwd 5 ,
and
.Xr group 5
lines.
A directory declaration is of the following form:
.Bd -literal -offset indent
directory "some.host" {
	# directives
}
.Ed
.Pp
Valid directives for directories are:
.Bl -tag -width Ds
.It Xo
.Ic attribute Ar name Ic maps to Ar string
.Xc
Map the
.Xr passwd 5 ,
.Xr master.passwd 5 ,
or
.Xr group 5
attribute to the LDAP attribute name supplied.
.It Ic basedn Ar string
Use the supplied search base as starting point for the directory search.
.It Ic groupdn Ar string
Use the supplied search base as starting point for the directory search for
groups.
If not supplied, the basedn value will be used.
.It Ic bindcred Ar string
Use the supplied credentials for simple authentication against the directory.
.It Ic binddn Ar string
Use the supplied Distinguished Name to bind to the directory.
.It Ic fixed attribute Ar attribute string
Do not retrieve the specified attribute from LDAP but
instead set it unconditionally to the supplied value for
every entry.
.It Ic group filter Ar string
Use the supplied LDAP filter to retrieve group entries.
.It Xo
.Ic list Ar name Ic maps to Ar string
.Xc
Map the
.Xr passwd 5 ,
.Xr master.passwd 5 ,
or
.Xr group 5
attribute to the LDAP attribute name supplied.
A list creates a comma separated list of all the LDAP attributes found.
.Pp
Valid attributes are:
.Pp
.Bl -tag -width groupmembers -offset indent -compact
.It Ic name
.It Ic passwd
.It Ic uid
.It Ic gid
.It Ic gecos
.It Ic home
.It Ic shell
.It Ic change
.It Ic expire
.It Ic class
.It Ic groupname
.It Ic grouppasswd
.It Ic groupgid
.It Ic groupmembers
.El
.It Ic passwd filter Ar string
Use the supplied LDAP filter to retrieve password entries.
.El
.Sh FILES
.Bl -tag -width "/etc/ypldap.conf" -compact
.It Pa /etc/ypldap.conf
.Xr ypldap 8
configuration file.
.El
.Sh SEE ALSO
.Xr ypbind 8 ,
.Xr ypldap 8 ,
.Xr ypserv 8
.Sh HISTORY
The
.Nm
file format first appeared in
.Ox 4.4 .
@


1.18
log
@take a stab at documenting when arguments need quoted, and valid macro
characters;

prompted by a diff from robert peichaer org

thanks gilles and henning for feedback
ok deraadt zinke
@
text
@d1 1
a1 1
.\"	$OpenBSD: ypldap.conf.5,v 1.17 2011/07/07 02:22:11 ajacoutot Exp $
d17 1
a17 1
.Dd $Mdocdate: July 7 2011 $
d106 4
@


1.17
log
@Install a default ypldap.conf(5) based on the one from the man page
(which we remove now) with a couple of tweaks; use the same base DN and
admin user as our default ldap.conf(5).
@
text
@d1 1
a1 1
.\"	$OpenBSD: ypldap.conf.5,v 1.16 2010/06/03 16:10:21 ajacoutot Exp $
d17 1
a17 1
.Dd $Mdocdate: June 3 2010 $
d47 2
a48 2
Macro names must start with a letter, and may contain letters, digits,
and underscores.
@


1.16
log
@Don't hardcode /bin/ksh in the example, but use "loginShell" instead.

ok pyr@@
@
text
@d1 1
a1 1
.\"	$OpenBSD: ypldap.conf.5,v 1.15 2010/01/02 19:44:53 schwarze Exp $
d17 1
a17 1
.Dd $Mdocdate: January 2 2010 $
a147 38
.Sh DIRECTORY EXAMPLE
This configuration searches the LDAP directory 127.0.0.1 for users and groups.
On the LDAP side the RFC 2307 object classes posixAccount and posixGroup
are used.
In this example the attributes are either mapped to
their corresponding LDAP attributes or a fixed value.
A list directive is used for the groupmembers attribute
because the ldap memberUid returns multiple group members.
.Bd -literal -offset indent
directory "127.0.0.1" {
        # directory options
        binddn "cn=Manager,dc=openbsd,dc=org"
        bindcred "secret"
        basedn "ou=Users,dc=openbsd,dc=org"

	# passwd maps configuration
        passwd filter "(objectClass=posixAccount)"

        attribute name maps to "uid"
        fixed attribute passwd "*"
        attribute uid maps to "uidNumber"
        attribute gid maps to "gidNumber"
        attribute gecos maps to "cn"
        attribute home maps to "homeDirectory"
        attribute shell maps to "loginShell"
        fixed attribute change "0"
        fixed attribute expire "0"
        fixed attribute class "ldap"

        # group maps configuration
        group filter "(objectClass=posixGroup)"

        attribute groupname maps to "cn"
        fixed attribute grouppasswd "*"
        attribute groupgid maps to "gidNumber"
        list groupmembers maps to "memberUid"
}
.Ed
@


1.15
log
@The .Rs macro must be followed by .Re, and empty .Rs is useless anyway.
Markup syntax error found by mandoc(1), also required to fix the mandoc build.
ok jmc@@ sobrado@@
@
text
@d1 1
a1 1
.\"	$OpenBSD: ypldap.conf.5,v 1.14 2009/12/19 16:21:30 jmc Exp $
d17 1
a17 1
.Dd $Mdocdate: December 19 2009 $
d172 1
a172 1
        fixed attribute shell "/bin/ksh"
@


1.14
log
@- "cost" is not a good example of a macro name; from Rogier Krieger
- zap an unneccessary .Pp whilst here
@
text
@d1 1
a1 1
.\"	$OpenBSD: ypldap.conf.5,v 1.13 2009/02/16 08:27:20 jmc Exp $
d17 1
a17 1
.Dd $Mdocdate: February 16 2009 $
a195 1
.Rs
@


1.13
log
@- use .Pp, not blank lines
- format some text to avoid line wrapping
@
text
@d1 1
a1 1
.\"	$OpenBSD: ypldap.conf.5,v 1.12 2009/02/15 21:57:27 aschrijver Exp $
d17 1
a17 1
.Dd $Mdocdate: Febuary 15 2009 $
d50 1
a50 1
.Ic cost ) .
a155 1
.Pp
@


1.12
log
@

Change the full sample configuration into an use case.
@
text
@d1 1
a1 1
.\"	$OpenBSD: ypldap.conf.5,v 1.11 2008/11/17 13:22:10 mbalmer Exp $
d17 1
a17 1
.Dd $Mdocdate: November 17 2008 $
d150 7
a156 4
On the LDAP side the RFC 2307 object classes posixAccount and posixGroup are used.
In this example the attributes are either mapped to their corresponding LDAP attributes or a fixed value.
A list directive is used for the groupmembers attribute because the ldap memberUid returns multiple group members.

@


1.11
log
@Missing end quote in example.
@
text
@d1 1
a1 1
.\"	$OpenBSD: ypldap.conf.5,v 1.10 2008/10/20 16:13:37 aschrijver Exp $
d17 1
a17 1
.Dd $Mdocdate: October 20 2008 $
d148 6
a153 1
.Sh EXAMPLE CONFIGURATION
a154 9
interval 300          # how many seconds between retries
domain "openbsd.org"  # only one domain for now

# what do we provide
provide map "passwd.byname"
provide map "passwd.byuid"
provide map "group.byname"
provide map "group.bygid"

a156 1

d161 1
a161 1
        # passwd maps configuration
@


1.10
log
@Add 2 missing directives and remove duplicate configuration entry.

Thanks to: uw at o3si dot de
@
text
@d1 1
a1 1
.\"	$OpenBSD: ypldap.conf.5,v 1.9 2008/10/15 07:50:43 jmc Exp $
d17 1
a17 1
.Dd $Mdocdate: October 15 2008 $
d167 1
a167 1
        passwd filter "(objectClass=posixAccount)
@


1.9
log
@- no need to separate list items with .Pp
- sort
@
text
@d1 1
a1 1
.\"	$OpenBSD: ypldap.conf.5,v 1.8 2008/10/14 23:05:37 deraadt Exp $
d17 1
a17 1
.Dd $Mdocdate: October 14 2008 $
d104 4
d109 1
a109 1
Use the supplied credentials to bind to the directory.
a174 1
        fixed attribute home "/bin/ksh"
@


1.8
log
@Sh capitalization
@
text
@d1 1
a1 1
.\"	$OpenBSD: ypldap.conf.5,v 1.7 2008/10/14 22:29:51 aschrijver Exp $
d104 8
a111 1
.Pp
a140 8
.It Ic binddn Ar string
Use the supplied credentials to bind to the directory.
.It Ic fixed attribute Ar attribute string
Do not retrieve the specified attribute from LDAP but
instead set it unconditionally to the supplied value for
every entry.
.It Ic group filter Ar string
Use the supplied LDAP filter to retrieve group entries.
@


1.7
log
@Add the list directive and an example configuration to the manpage.
@
text
@d1 1
a1 1
.\"	$OpenBSD: ypldap.conf.5,v 1.6 2008/09/19 08:06:16 pyr Exp $
d17 1
a17 1
.Dd $Mdocdate: September 19 2008 $
d145 1
a145 2

.Sh Example configuration
d147 2
a148 5
# how many seconds between retries
interval 300

# only one domain for now
domain "openbsd.org"
a186 1

@


1.6
log
@typo
spotted by uw at o3si dot de
@
text
@d1 1
a1 1
.\"	$OpenBSD: ypldap.conf.5,v 1.5 2008/06/29 22:04:19 pyr Exp $
d17 1
a17 1
.Dd $Mdocdate: June 29 2008 $
d104 12
d145 47
@


1.5
log
@repetition, spotted by <bsd@@openbsd.rutgers.edu>
@
text
@d1 1
a1 1
.\"	$OpenBSD: ypldap.conf.5,v 1.4 2008/06/29 14:08:00 jmc Exp $
d74 2
a75 2
The currently implemented maps are: passwd.byname, passwd.byid,
group.byname, group.byid.
@


1.4
log
@various macro/spelling/grammar fixes;
@
text
@d1 1
a1 1
.\"	$OpenBSD: ypldap.conf.5,v 1.3 2008/06/29 10:44:47 pyr Exp $
d107 1
a107 1
.It Ic uid
@


1.3
log
@document the configuration directives for directories.
@
text
@d1 1
a1 1
.\"	$OpenBSD: ypldap.conf.5,v 1.2 2008/06/26 21:24:34 jmc Exp $
d17 1
a17 1
.Dd $Mdocdate: June 26 2008 $
d81 3
a83 2
.Xr passwd 5, master.passwd 5
and 
d92 1
d99 3
a101 2
.Xr passwd 5, master.passwd 5
or 
d105 1
d126 1
a126 1
instead set it unconditionnaly to the supplied value for
d129 1
a129 1
use the supplied LDAP filter to retrieve group entries.
d131 1
a131 1
use the supplied LDAP filter to retrieve password entries.
@


1.2
log
@tweak;
@
text
@d1 1
a1 1
.\"	$OpenBSD: ypldap.conf.5,v 1.1 2008/06/26 15:10:01 pyr Exp $
d78 51
@


1.1
log
@ypldap -- Intended to be a drop-in replacement for ypserv, gluing in a
LDAP directory and thus providing support for users and groups stored in
LDAP for the get{pw,gr}ent family of functions.

As of now it relies on external LDAP libraries, choose the one of your
liking though openldap would do fine. Not linked to the builds until
some things are sorted out, having our own LDAP client code for
instance, better support for group membership lookup as well.

Remember to sync with the latest master.passwd and group files as well
to have the _ypldap user available, which is needed.

``just get it in'' deraadt@@
@
text
@d1 1
a1 1
.\"	$OpenBSD$
d17 1
a17 1
.Dd $Mdocdate: June 17 2008 $
d61 1
a61 1
Global settings concerns the main behaviour of the daemon.
d74 1
a74 1
the currently implemented maps are: passwd.byname, passwd.byid,
d82 1
a82 1
configuration file
d85 1
d87 1
a87 2
.Xr ypserv 8 ,
.Xr ypbind 8
@

