head	1.19;
access;
symbols
	OPENBSD_6_1:1.19.0.4
	OPENBSD_6_1_BASE:1.19
	OPENBSD_6_0:1.18.0.2
	OPENBSD_6_0_BASE:1.18
	OPENBSD_5_9:1.14.0.2
	OPENBSD_5_9_BASE:1.14
	OPENBSD_5_8:1.13.0.8
	OPENBSD_5_8_BASE:1.13
	OPENBSD_5_7:1.13.0.2
	OPENBSD_5_7_BASE:1.13
	OPENBSD_5_6:1.13.0.4
	OPENBSD_5_6_BASE:1.13
	OPENBSD_5_5:1.12.0.4
	OPENBSD_5_5_BASE:1.12;
locks; strict;
comment	@# @;


1.19
date	2016.08.14.13.47.52;	author krw;	state Exp;
branches;
next	1.18;
commitid	ZcosZaHFeAjuNb8j;

1.18
date	2016.07.20.19.56.24;	author krw;	state Exp;
branches;
next	1.17;
commitid	z6JuuHadtqCT2di6;

1.17
date	2016.05.31.18.35.58;	author kettenis;	state Exp;
branches;
next	1.16;
commitid	SSNdWynr0QR24Y26;

1.16
date	2016.05.11.21.52.51;	author deraadt;	state Exp;
branches;
next	1.15;
commitid	VpgRpYXqYSJy4P7J;

1.15
date	2016.03.09.16.28.50;	author deraadt;	state Exp;
branches;
next	1.14;
commitid	OSDG2O3Cgeifnf1W;

1.14
date	2015.12.01.15.33.17;	author deraadt;	state Exp;
branches;
next	1.13;
commitid	egDnoT7JLrnhbeqE;

1.13
date	2014.03.18.22.36.37;	author miod;	state Exp;
branches;
next	1.12;

1.12
date	2014.02.21.08.54.57;	author deraadt;	state Exp;
branches;
next	1.11;

1.11
date	2014.01.19.02.58.50;	author jsing;	state Exp;
branches;
next	1.10;

1.10
date	2014.01.18.02.47.27;	author jsing;	state Exp;
branches;
next	1.9;

1.9
date	2014.01.18.02.45.38;	author jsing;	state Exp;
branches;
next	1.8;

1.8
date	2014.01.05.16.02.40;	author jsing;	state Exp;
branches;
next	1.7;

1.7
date	2013.12.28.14.45.57;	author jsing;	state Exp;
branches;
next	1.6;

1.6
date	2013.12.28.13.58.15;	author jsing;	state Exp;
branches;
next	1.5;

1.5
date	2013.12.28.12.03.57;	author jsing;	state Exp;
branches;
next	1.4;

1.4
date	2013.12.28.11.00.33;	author jsing;	state Exp;
branches;
next	1.3;

1.3
date	2013.12.27.14.23.49;	author jsing;	state Exp;
branches;
next	1.2;

1.2
date	2013.12.27.14.12.56;	author jsing;	state Exp;
branches;
next	1.1;

1.1
date	2013.12.27.13.52.40;	author jsing;	state Exp;
branches;
next	;


desc
@@


1.19
log
@Merge identical amd64 and i386 stanzas.

Requested & ok jsing@@
@
text
@#	$OpenBSD: Makefile,v 1.18 2016/07/20 19:56:24 krw Exp $

PROG=		installboot
SRCS=		installboot.c util.c
MAN=		installboot.8

CPPFLAGS=	-I${.CURDIR}
LDADD=		-lutil
DPADD=		${LIBUTIL}

LDSTATIC=	${STATIC}

.if ${MACHINE} == "amd64" || ${MACHINE} == "i386"
CFLAGS += -DSOFTRAID
SRCS += i386_installboot.c
SRCS += i386_nlist.c
SRCS += i386_softraid.c
.elif ${MACHINE} == "armv7"
SRCS += armv7_installboot.c
.elif ${MACHINE} == "hppa"
CFLAGS += -DBOOTSTRAP
SRCS += hppa_installboot.c
.elif ${MACHINE} == "landisk"
CFLAGS += -DBOOTSTRAP
SRCS += landisk_installboot.c
.elif ${MACHINE} == "sparc64"
CFLAGS += -DSOFTRAID
SRCS += sparc64_installboot.c
SRCS += sparc64_softraid.c
.else
SRCS += stubs.c
.endif

.if !empty(CFLAGS:M-DBOOTSTRAP)
SRCS += bootstrap.c
.endif

.if !empty(CFLAGS:M-DSOFTRAID)
SRCS += softraid.c
.endif

.include <bsd.prog.mk>
@


1.18
log
@Use more compact idiom to select architecture dependent files to compile. No
intentional functional change.

Diff from Miod.

ok millert@@ deraadt@@
@
text
@d1 1
a1 1
#	$OpenBSD: Makefile,v 1.17 2016/05/31 18:35:58 kettenis Exp $
d13 1
a13 1
.if ${MACHINE} == "amd64"
a22 5
.elif ${MACHINE} == "i386"
CFLAGS += -DSOFTRAID
SRCS += i386_installboot.c
SRCS += i386_nlist.c
SRCS += i386_softraid.c
@


1.17
log
@Add support for armv7.  Fix an error message in the i386 support before
creating more copies.

ok deraadt@@, jsing@@
@
text
@d1 1
a1 1
#	$OpenBSD: Makefile,v 1.16 2016/05/11 21:52:51 deraadt Exp $
a12 4
.if ${MACHINE} == "alpha"
SRCS += stubs.c
.endif

d18 1
a18 7
.endif

.if ${MACHINE} == "armish"
SRCS += stubs.c
.endif

.if ${MACHINE} == "armv7"
d20 1
a20 3
.endif

.if ${MACHINE} == "hppa"
d23 1
a23 3
.endif

.if ${MACHINE} == "i386"
d28 1
a28 3
.endif

.if ${MACHINE} == "landisk"
d31 1
a31 31
.endif

.if ${MACHINE} == "loongson"
SRCS += stubs.c
.endif

.if ${MACHINE} == "luna88k"
SRCS += stubs.c
.endif

.if ${MACHINE} == "macppc"
SRCS += stubs.c
.endif

.if ${MACHINE} == "octeon"
SRCS += stubs.c
.endif

.if ${MACHINE} == "sgi"
SRCS += stubs.c
.endif

.if ${MACHINE} == "socppc"
SRCS += stubs.c
.endif

.if ${MACHINE} == "sparc"
SRCS += stubs.c
.endif

.if ${MACHINE} == "sparc64"
d35 1
a35 3
.endif

.if ${MACHINE} == "zaurus"
@


1.16
log
@remove hppa64 port, which we never got going beyond broken single users.
hppa reverse-stack gives us a valuable test case, but most developers don't
have a 2nd one to proceed further with this.
ok kettenis
@
text
@d1 1
a1 1
#	$OpenBSD: Makefile,v 1.15 2016/03/09 16:28:50 deraadt Exp $
d29 1
a29 1
SRCS += stubs.c
@


1.15
log
@We are done providing support for the vax.
lots of agreement.
@
text
@d1 1
a1 1
#	$OpenBSD: Makefile,v 1.14 2015/12/01 15:33:17 deraadt Exp $
a34 5
.endif

.if ${MACHINE} == "hppa64"
CFLAGS += -DBOOTSTRAP
SRCS += hppa64_installboot.c
@


1.14
log
@aviion went away
@
text
@d1 1
a1 1
#	$OpenBSD: Makefile,v 1.13 2014/03/18 22:36:37 miod Exp $
a85 5
.endif

.if ${MACHINE} == "vax"
CFLAGS += -DBOOTSTRAP
SRCS += vax_installboot.c
@


1.13
log
@Retire hp300, mvme68k and mvme88k ports. These ports have no users, keeping
this hardware alive is becoming increasingly difficult, and I should heed the
message sent by the three disks which have died on me over the last few days.

Noone sane will mourn these ports anyway. So long, and thanks for the fish.
@
text
@d1 1
a1 1
#	$OpenBSD: Makefile,v 1.12 2014/02/21 08:54:57 deraadt Exp $
a28 4
SRCS += stubs.c
.endif

.if ${MACHINE} == "aviion"
@


1.12
log
@Use ${STATIC} not -static
ok jsing
@
text
@d1 1
a1 1
#	$OpenBSD: Makefile,v 1.11 2014/01/19 02:58:50 jsing Exp $
a35 5
.if ${MACHINE} == "hp300"
CFLAGS += -DBOOTSTRAP
SRCS += hp300_installboot.c
.endif

a66 8
SRCS += stubs.c
.endif

.if ${MACHINE} == "mvme68k"
SRCS += stubs.c
.endif

.if ${MACHINE} == "mvme88k"
@


1.11
log
@Rework installboot and use a single directory with a single makefile. The
directory per machine model is arguably cleaner, however it does not play
well with distrib/special and instbin.

Discussed with deraadt@@
@
text
@d1 1
a1 1
#	$OpenBSD: Makefile,v 1.10 2014/01/18 02:47:27 jsing Exp $
d11 1
a11 1
LDSTATIC=	-static
@


1.10
log
@Add a -r flag that allows for the mount point of the root filesystem to be
specified. This is primarily for use by the installer and defaults to /.
@
text
@d1 1
a1 1
#	$OpenBSD: Makefile,v 1.9 2014/01/18 02:45:38 jsing Exp $
d13 100
a112 1
.include "${.CURDIR}/${MACHINE}/Makefile.inc"
@


1.9
log
@Build installboot on all architectures.
@
text
@d1 1
a1 1
#	$OpenBSD: Makefile,v 1.8 2014/01/05 16:02:40 jsing Exp $
d4 1
a4 1
SRCS=		installboot.c
@


1.8
log
@Add initial man page for installboot.
@
text
@d1 1
a1 6
#	$OpenBSD: Makefile,v 1.7 2013/12/28 14:45:57 jsing Exp $

.if (${MACHINE} == "amd64" || ${MACHINE} == "hp300" || \
     ${MACHINE} == "hppa" || ${MACHINE} == "hppa64" || \
     ${MACHINE} == "i386" || ${MACHINE} == "landisk" || \
     ${MACHINE} == "sparc64" || ${MACHINE} == "vax")
a20 5
.endif

.else
NOPROG=
NOMAN=
@


1.7
log
@Add installboot support for sparc64.
@
text
@d1 1
a1 3
#	$OpenBSD: Makefile,v 1.6 2013/12/28 13:58:15 jsing Exp $

NOMAN=
d9 2
a17 2
SRCS += installboot.c

d30 1
@


1.6
log
@Add installboot support for the remaining `disklabel -B' architectures
(hp300, hppa64 and landisk). hp300 and landisk are untested, however they
should "just work" - hopefully someone with access to this hardware can
confirm.
@
text
@d1 1
a1 1
#	$OpenBSD: Makefile,v 1.5 2013/12/28 12:03:57 jsing Exp $
d8 1
a8 1
     ${MACHINE} == "vax")
@


1.5
log
@Add installboot support for vax.
@
text
@d1 1
a1 1
#	$OpenBSD: Makefile,v 1.4 2013/12/28 11:00:33 jsing Exp $
d5 3
a7 1
.if (${MACHINE} == "amd64" || ${MACHINE} == "hppa" || ${MACHINE} == "i386" || \
@


1.4
log
@Tweak makefiles so that we pull in source files based on defines.
@
text
@d1 1
a1 1
#	$OpenBSD: Makefile,v 1.3 2013/12/27 14:23:49 jsing Exp $
d5 2
a6 1
.if (${MACHINE} == "amd64" || ${MACHINE} == "hppa" || ${MACHINE} == "i386")
@


1.3
log
@Add installboot support for hppa.
@
text
@d1 1
a1 1
#	$OpenBSD: Makefile,v 1.2 2013/12/27 14:12:56 jsing Exp $
d18 8
@


1.2
log
@Add installboot support for amd64.
@
text
@d1 1
a1 1
#	$OpenBSD: Makefile,v 1.1 2013/12/27 13:52:40 jsing Exp $
d5 1
a5 1
.if (${MACHINE} == "amd64" || ${MACHINE} == "i386")
@


1.1
log
@Initial version of a unified installboot(8) that lives outside of
sys/arch/${MACHINE}/stand. For now this only supports i386, however
additional architectures will be added and further development can happen
in tree.

Requested by deraadt@@ quite some time ago.
@
text
@d1 1
a1 1
#	$OpenBSD$
d5 1
a5 1
.if (${MACHINE} == "i386")
@

