head	1.19;
access;
symbols
	OPENBSD_5_5:1.18.0.4
	OPENBSD_5_5_BASE:1.18
	OPENBSD_5_4:1.17.0.26
	OPENBSD_5_4_BASE:1.17
	OPENBSD_5_3:1.17.0.24
	OPENBSD_5_3_BASE:1.17
	OPENBSD_5_2:1.17.0.22
	OPENBSD_5_2_BASE:1.17
	OPENBSD_5_1_BASE:1.17
	OPENBSD_5_1:1.17.0.20
	OPENBSD_5_0:1.17.0.18
	OPENBSD_5_0_BASE:1.17
	OPENBSD_4_9:1.17.0.16
	OPENBSD_4_9_BASE:1.17
	OPENBSD_4_8:1.17.0.14
	OPENBSD_4_8_BASE:1.17
	OPENBSD_4_7:1.17.0.10
	OPENBSD_4_7_BASE:1.17
	OPENBSD_4_6:1.17.0.12
	OPENBSD_4_6_BASE:1.17
	OPENBSD_4_5:1.17.0.8
	OPENBSD_4_5_BASE:1.17
	OPENBSD_4_4:1.17.0.6
	OPENBSD_4_4_BASE:1.17
	OPENBSD_4_3:1.17.0.4
	OPENBSD_4_3_BASE:1.17
	OPENBSD_4_2:1.17.0.2
	OPENBSD_4_2_BASE:1.17
	OPENBSD_4_1:1.16.0.14
	OPENBSD_4_1_BASE:1.16
	OPENBSD_4_0:1.16.0.12
	OPENBSD_4_0_BASE:1.16
	OPENBSD_3_9:1.16.0.10
	OPENBSD_3_9_BASE:1.16
	OPENBSD_3_8:1.16.0.8
	OPENBSD_3_8_BASE:1.16
	OPENBSD_3_7:1.16.0.6
	OPENBSD_3_7_BASE:1.16
	OPENBSD_3_6:1.16.0.4
	OPENBSD_3_6_BASE:1.16
	OPENBSD_3_5:1.16.0.2
	OPENBSD_3_5_BASE:1.16
	OPENBSD_3_4:1.14.0.2
	OPENBSD_3_4_BASE:1.14
	OPENBSD_3_3:1.12.0.10
	OPENBSD_3_3_BASE:1.12
	OPENBSD_3_2:1.12.0.8
	OPENBSD_3_2_BASE:1.12
	OPENBSD_3_1:1.12.0.6
	OPENBSD_3_1_BASE:1.12
	OPENBSD_3_0:1.12.0.4
	OPENBSD_3_0_BASE:1.12
	OPENBSD_2_9_BASE:1.12
	OPENBSD_2_9:1.12.0.2
	OPENBSD_2_8:1.11.0.4
	OPENBSD_2_8_BASE:1.11
	OPENBSD_2_7:1.11.0.2
	OPENBSD_2_7_BASE:1.11
	OPENBSD_2_6:1.10.0.2
	OPENBSD_2_6_BASE:1.10
	OPENBSD_2_5:1.8.0.2
	OPENBSD_2_5_BASE:1.8
	OPENBSD_2_4:1.6.0.2
	OPENBSD_2_4_BASE:1.6
	OPENBSD_2_3:1.5.0.4
	OPENBSD_2_3_BASE:1.5
	OPENBSD_2_2:1.5.0.2
	OPENBSD_2_2_BASE:1.5
	OPENBSD_2_1:1.4.0.2
	OPENBSD_2_1_BASE:1.4
	OPENBSD_2_0:1.2.0.2
	OPENBSD_2_0_BASE:1.2
	netbsd_1_1:1.1.1.1;
locks; strict;
comment	@.\" @;


1.19
date	2014.04.24.14.59.06;	author tedu;	state dead;
branches;
next	1.18;

1.18
date	2014.01.20.05.07.48;	author schwarze;	state Exp;
branches;
next	1.17;

1.17
date	2007.05.31.19.20.29;	author jmc;	state Exp;
branches;
next	1.16;

1.16
date	2003.10.04.15.08.05;	author jmc;	state Exp;
branches;
next	1.15;

1.15
date	2003.10.04.07.51.32;	author deraadt;	state Exp;
branches;
next	1.14;

1.14
date	2003.06.12.12.59.53;	author jmc;	state Exp;
branches;
next	1.13;

1.13
date	2003.06.02.23.36.54;	author millert;	state Exp;
branches;
next	1.12;

1.12
date	2001.02.08.15.03.19;	author deraadt;	state Exp;
branches;
next	1.11;

1.11
date	2000.03.19.17.57.14;	author aaron;	state Exp;
branches;
next	1.10;

1.10
date	99.06.05.22.18.07;	author aaron;	state Exp;
branches;
next	1.9;

1.9
date	99.05.23.14.11.37;	author aaron;	state Exp;
branches;
next	1.8;

1.8
date	99.04.02.15.12.20;	author aaron;	state Exp;
branches;
next	1.7;

1.7
date	99.03.11.21.07.58;	author aaron;	state Exp;
branches;
next	1.6;

1.6
date	98.04.25.01.14.41;	author deraadt;	state Exp;
branches;
next	1.5;

1.5
date	97.07.15.16.31.03;	author deraadt;	state Exp;
branches;
next	1.4;

1.4
date	97.03.26.00.45.56;	author deraadt;	state Exp;
branches;
next	1.3;

1.3
date	97.03.26.00.39.34;	author deraadt;	state Exp;
branches;
next	1.2;

1.2
date	96.07.08.22.09.49;	author ccappuc;	state Exp;
branches;
next	1.1;

1.1
date	95.10.18.08.48.07;	author deraadt;	state Exp;
branches
	1.1.1.1;
next	;

1.1.1.1
date	95.10.18.08.48.07;	author deraadt;	state Exp;
branches;
next	;


desc
@@


1.19
log
@That is strength, boy! That is power! What is steel compared to the hand
that wields it? Look at the strength in your body, the desire in your
heart, I gave you this! Such a waste. Contemplate this on the tree of woe.
@
text
@.\"	$OpenBSD: rwhod.8,v 1.18 2014/01/20 05:07:48 schwarze Exp $
.\"
.\" Copyright (c) 1983, 1991, 1993
.\"	The Regents of the University of California.  All rights reserved.
.\"
.\" Redistribution and use in source and binary forms, with or without
.\" modification, are permitted provided that the following conditions
.\" are met:
.\" 1. Redistributions of source code must retain the above copyright
.\"    notice, this list of conditions and the following disclaimer.
.\" 2. Redistributions in binary form must reproduce the above copyright
.\"    notice, this list of conditions and the following disclaimer in the
.\"    documentation and/or other materials provided with the distribution.
.\" 3. Neither the name of the University nor the names of its contributors
.\"    may be used to endorse or promote products derived from this software
.\"    without specific prior written permission.
.\"
.\" THIS SOFTWARE IS PROVIDED BY THE REGENTS AND CONTRIBUTORS ``AS IS'' AND
.\" ANY EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT LIMITED TO, THE
.\" IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE
.\" ARE DISCLAIMED.  IN NO EVENT SHALL THE REGENTS OR CONTRIBUTORS BE LIABLE
.\" FOR ANY DIRECT, INDIRECT, INCIDENTAL, SPECIAL, EXEMPLARY, OR CONSEQUENTIAL
.\" DAMAGES (INCLUDING, BUT NOT LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS
.\" OR SERVICES; LOSS OF USE, DATA, OR PROFITS; OR BUSINESS INTERRUPTION)
.\" HOWEVER CAUSED AND ON ANY THEORY OF LIABILITY, WHETHER IN CONTRACT, STRICT
.\" LIABILITY, OR TORT (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY
.\" OUT OF THE USE OF THIS SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF
.\" SUCH DAMAGE.
.\"
.\"     from: @@(#)rwhod.8	8.2 (Berkeley) 12/11/93
.\"     $OpenBSD: rwhod.8,v 1.18 2014/01/20 05:07:48 schwarze Exp $
.\"
.Dd $Mdocdate: January 20 2014 $
.Dt RWHOD 8
.Os
.Sh NAME
.Nm rwhod
.Nd system status server
.Sh SYNOPSIS
.Nm rwhod
.Op Fl d
.Sh DESCRIPTION
.Nm
is the server which maintains the database used by the
.Xr rwho 1
and
.Xr ruptime 1
programs.
Its operation is predicated on the ability to
.Em broadcast
messages on a network.
.Pp
.Nm
operates as both a producer and consumer of status information.
As a producer of information it periodically
queries the state of the system and constructs
status messages which are broadcast on a network.
As a consumer of information, it listens for other
.Nm
servers' status messages, validating them, then recording
them in a collection of files located in the directory
.Pa /var/rwho .
.Pp
The options are as follows:
.Bl -tag -width Ds
.It Fl d
Turn on debug mode.
.El
.Pp
The server transmits and receives messages at the port indicated
in the ``who'' service specification; see
.Xr services 5 .
The messages sent and received, are of the form:
.Bd -literal -offset indent
struct	outmp {
	char	out_line[8];		/* tty name */
	char	out_name[8];		/* user id */
	int32_t	out_time;		/* time on */
};

struct	whod {
	char	wd_vers;
	char	wd_type;
	char	wd_fill[2];
	int32_t	wd_sendtime;
	int32_t	wd_recvtime;
	char	wd_hostname[32];
	int32_t	wd_loadav[3];
	int32_t	wd_boottime;
	struct	whoent {
		struct	outmp we_utmp;
		int32_t	we_idle;
	} wd_we[1024 / sizeof (struct whoent)];
};
.Ed
.Pp
All fields are converted to network byte order prior to
transmission.
The load averages are as calculated by the
.Xr w 1
program, and represent load averages over the 5, 10, and 15 minute
intervals prior to a server's transmission; they are multiplied by 100
for representation in an integer.
The host name included is that returned by
.Xr gethostname 3
with any trailing domain name omitted.
The array at the end of the message contains information about
the users logged in to the sending machine.
This information includes the contents of the
.Xr utmp 5
entry for each non-idle terminal line and a value indicating the
time in seconds since a character was last received on the terminal line.
.Pp
Messages received by the rwho server are discarded
unless they originated at an rwho server's port.
In addition, if the host's name, as specified
in the message, contains any unprintable
.Tn ASCII
characters, the
message is discarded.
Valid messages received by
.Nm
are placed in files named
.Pa whod.hostname
in the directory
.Pa /var/rwho .
These files contain only the most recent message, in the
format described above.
.Pp
Status messages are generated approximately once every
3 minutes.
.Sh SEE ALSO
.Xr ruptime 1 ,
.Xr rwho 1
.Sh HISTORY
The
.Nm
command appeared in
.Bx 4.2 .
.Sh BUGS
There should be a way to relay status information between networks.
Status information should be sent only upon request rather than continuously.
People often interpret the server dying
or network communication failures
as a machine going down.
@


1.18
log
@Obvious .Xr fixes, found while testing mandocdb(8).
@
text
@d1 1
a1 1
.\"	$OpenBSD: rwhod.8,v 1.17 2007/05/31 19:20:29 jmc Exp $
d31 1
a31 1
.\"     $OpenBSD: rwhod.8,v 1.17 2007/05/31 19:20:29 jmc Exp $
d33 1
a33 1
.Dd $Mdocdate: May 31 2007 $
@


1.17
log
@convert to new .Dd format;
@
text
@d1 1
a1 1
.\"	$OpenBSD: rwhod.8,v 1.16 2003/10/04 15:08:05 jmc Exp $
d31 1
a31 1
.\"     $OpenBSD: rwhod.8,v 1.16 2003/10/04 15:08:05 jmc Exp $
d33 1
a33 1
.Dd $Mdocdate$
d114 2
a115 5
Messages received by the
.Xr rwho
server are discarded unless they originated at an
.Xr rwho
server's port.
@


1.16
log
@move [-d] from NAME to SYNOPSIS;
@
text
@d1 1
a1 1
.\"	$OpenBSD: rwhod.8,v 1.15 2003/10/04 07:51:32 deraadt Exp $
d31 1
a31 1
.\"     $OpenBSD: rwhod.8,v 1.15 2003/10/04 07:51:32 deraadt Exp $
d33 1
a33 1
.Dd December 11, 1993
@


1.15
log
@incorrect Ar vs Fl
@
text
@d1 1
a1 1
.\"	$OpenBSD: rwhod.8,v 1.14 2003/06/12 12:59:53 jmc Exp $
d31 1
a31 1
.\"     $OpenBSD: rwhod.8,v 1.14 2003/06/12 12:59:53 jmc Exp $
a37 1
.Op Fl d
d41 1
@


1.14
log
@- section reorder
- macro fixes
- kill whitespace at EOL
- new sentence, new line
@
text
@d1 1
a1 1
.\"	$OpenBSD: rwhod.8,v 1.13 2003/06/02 23:36:54 millert Exp $
d31 1
a31 1
.\"     $OpenBSD: rwhod.8,v 1.13 2003/06/02 23:36:54 millert Exp $
d38 1
a38 1
.Op Ar d
@


1.13
log
@Remove the advertising clause in the UCB license which Berkeley
rescinded 22 July 1999.  Proofed by myself and Theo.
@
text
@d1 1
a1 1
.\"	$OpenBSD: rwhod.8,v 1.12 2001/02/08 15:03:19 deraadt Exp $
d31 1
a31 1
.\"     $OpenBSD: rwhod.8,v 1.12 2001/02/08 15:03:19 deraadt Exp $
a63 1
.Pp
d138 5
a148 5
.Sh HISTORY
The
.Nm
command appeared in
.Bx 4.2 .
@


1.12
log
@put debug code in by default, and make it work
@
text
@d1 1
a1 1
.\"	$OpenBSD: rwhod.8,v 1.11 2000/03/19 17:57:14 aaron Exp $
d14 1
a14 5
.\" 3. All advertising materials mentioning features or use of this software
.\"    must display the following acknowledgement:
.\"	This product includes software developed by the University of
.\"	California, Berkeley and its contributors.
.\" 4. Neither the name of the University nor the names of its contributors
d31 1
a31 1
.\"     $OpenBSD: rwhod.8,v 1.11 2000/03/19 17:57:14 aaron Exp $
@


1.11
log
@Remove hard sentence breaks. Add $OpenBSD$ tags where appropriate. Some other
cleanup along the way.
@
text
@d1 1
a1 1
.\"	$OpenBSD: rwhod.8,v 1.10 1999/06/05 22:18:07 aaron Exp $
d35 1
a35 1
.\"     $OpenBSD: rwhod.8,v 1.10 1999/06/05 22:18:07 aaron Exp $
d42 1
d67 7
@


1.10
log
@remove trailing whitespace, some Nm cleanup
@
text
@d1 2
a2 1
.\"	$OpenBSD: rwhod.8,v 1.9 1999/05/23 14:11:37 aaron Exp $
d35 1
a35 1
.\"     $OpenBSD: rwhod.8,v 1.9 1999/05/23 14:11:37 aaron Exp $
d51 2
a52 1
programs.  Its operation is predicated on the ability to
d95 2
a96 1
transmission.  The load averages are as calculated by the
d100 2
a101 2
for representation in an integer.  The host name
included is that returned by
d105 2
a106 2
the users logged in to the sending machine.  This information
includes the contents of the
d115 2
a116 1
server's port.  In addition, if the host's name, as specified
d120 2
a121 1
message is discarded.  Valid messages received by
@


1.9
log
@remove argument from .Os macros so value in /usr/share/tmac/mdoc/doc-common
is used instead; kwesterback@@home.com
@
text
@d1 1
a1 1
.\"	$OpenBSD: rwhod.8,v 1.8 1999/04/02 15:12:20 aaron Exp $
d34 1
a34 1
.\"     $OpenBSD: rwhod.8,v 1.8 1999/04/02 15:12:20 aaron Exp $
d66 1
a66 1
in the ``who'' service specification; see 
d95 1
a95 1
program, and represent load averages over the 5, 10, and 15 minute 
d102 2
a103 2
the users logged in to the sending machine.  This information 
includes the contents of the 
d131 1
a131 1
There should be a way to relay status information between networks. 
@


1.8
log
@all .Nm macros should have an argument in SYNOPSIS; also misc cleanup
@
text
@d1 1
a1 1
.\"	$OpenBSD: rwhod.8,v 1.7 1999/03/11 21:07:58 aaron Exp $
d34 1
a34 1
.\"     $OpenBSD: rwhod.8,v 1.7 1999/03/11 21:07:58 aaron Exp $
d38 1
a38 1
.Os BSD 4.2
@


1.7
log
@cleanup
@
text
@d1 1
a1 1
.\"	$OpenBSD$
d34 1
a34 1
.\"     $OpenBSD: rwhod.8,v 1.6 1998/04/25 01:14:41 deraadt Exp $
d43 1
a43 1
.Nm
@


1.6
log
@service is called "who"; ru@@ucb.crimea.ua
@
text
@d1 1
d34 1
a34 1
.\"     $OpenBSD: rwhod.8,v 1.5 1997/07/15 16:31:03 deraadt Exp $
d43 1
a43 1
.Nm rwhod
d45 1
a45 1
.Nm Rwhod
d54 1
a54 1
.Nm Rwhod
d60 1
a60 1
.Nm rwhod
d117 1
a117 1
.Nm rwhod
d128 2
a129 2
.Xr rwho 1 ,
.Xr ruptime 1
@


1.5
log
@Xr repair
@
text
@d33 1
a33 1
.\"     $OpenBSD: rwhod.8,v 1.4 1997/03/26 00:45:56 deraadt Exp $
d65 1
a65 1
in the ``rwho'' service specification; see 
@


1.4
log
@clean; netbsd
@
text
@d33 1
a33 1
.\"     $OpenBSD: rwhod.8,v 1.3 1997/03/26 00:39:34 deraadt Exp $
d97 3
a99 3
included is that returned by the
.Xr gethostname 2
system call, with any trailing domain name omitted.
@


1.3
log
@sync to rwhod.h
@
text
@d33 1
a33 1
.\"     $Id: rwhod.8,v 1.2 1996/07/08 22:09:49 ccappuc Exp $
a125 8
.Nm Rwhod
performs an
.Xr nlist 3
on
.Pa /bsd
every 30 minutes to guard against
the possibility that this file is not the system
image currently operating.
@


1.2
log
@kernel is /bsd, os is OpenBSD
@
text
@d33 1
a33 1
.\"     $Id: rwhod.8,v 1.1.1.1 1995/10/18 08:48:07 deraadt Exp $
d72 1
a72 1
	long	out_time;		/* time on */
d79 2
a80 2
	int	wd_sendtime;
	int	wd_recvtime;
d82 2
a83 2
	int	wd_loadav[3];
	int	wd_boottime;
d86 1
a86 1
		int	we_idle;
@


1.1
log
@Initial revision
@
text
@d33 1
a33 1
.\"     $Id: rwhod.8,v 1.4 1994/05/29 02:53:21 jtc Exp $
d130 1
a130 1
.Pa /netbsd
@


1.1.1.1
log
@initial import of NetBSD tree
@
text
@@
