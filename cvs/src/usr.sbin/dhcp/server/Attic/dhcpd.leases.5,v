head	1.8;
access;
symbols
	OPENBSD_3_5:1.7.0.4
	OPENBSD_3_5_BASE:1.7
	OPENBSD_3_4:1.7.0.2
	OPENBSD_3_4_BASE:1.7
	OPENBSD_3_3:1.6.0.2
	OPENBSD_3_3_BASE:1.6
	OPENBSD_3_2:1.3.0.6
	OPENBSD_3_2_BASE:1.3
	OPENBSD_3_1:1.3.0.4
	OPENBSD_3_1_BASE:1.3
	OPENBSD_3_0:1.3.0.2
	OPENBSD_3_0_BASE:1.3
	OPENBSD_2_9_BASE:1.2
	OPENBSD_2_9:1.2.0.8
	OPENBSD_2_8:1.2.0.6
	OPENBSD_2_8_BASE:1.2
	OPENBSD_2_7:1.2.0.4
	OPENBSD_2_7_BASE:1.2
	OPENBSD_2_6:1.2.0.2
	OPENBSD_2_6_BASE:1.2
	OPENBSD_2_5:1.1.0.4
	OPENBSD_2_5_BASE:1.1
	OPENBSD_2_4:1.1.0.2
	OPENBSD_2_4_BASE:1.1;
locks; strict;
comment	@.\" @;


1.8
date	2004.04.28.06.57.41;	author henning;	state dead;
branches;
next	1.7;

1.7
date	2003.06.25.09.27.57;	author jmc;	state Exp;
branches;
next	1.6;

1.6
date	2003.03.18.23.43.27;	author avsm;	state Exp;
branches;
next	1.5;

1.5
date	2003.01.23.08.58.47;	author jmc;	state Exp;
branches;
next	1.4;

1.4
date	2003.01.17.19.25.01;	author deraadt;	state Exp;
branches;
next	1.3;

1.3
date	2001.06.24.06.05.11;	author beck;	state Exp;
branches;
next	1.2;

1.2
date	99.05.30.02.42.23;	author pjanzen;	state Exp;
branches;
next	1.1;

1.1
date	98.08.18.03.43.35;	author deraadt;	state Exp;
branches;
next	;


desc
@@


1.8
log
@It is a big pleasure for me to remove this highe pile of gunk from the tree.
dhclient, dhcrelay and dhcpd have been factored out and cleaned up big time,
dhcpd and dhcrelay chroot itself, drop privileges and lock their bpf
descriptors after applyiing read/write filters now, and this pile of ISC code
with it's lovely char ServerName; /* Name of Server */ constructs is
obsolete.
theo ok, I owe you some beers for this pleasure
@
text
@.\"	$OpenBSD: dhcpd.leases.5,v 1.7 2003/06/25 09:27:57 jmc Exp $
.\"
.\" Copyright (c) 1997, 1998 The Internet Software Consortium.
.\" All rights reserved.
.\"
.\" Redistribution and use in source and binary forms, with or without
.\" modification, are permitted provided that the following conditions
.\" are met:
.\"
.\" 1. Redistributions of source code must retain the above copyright
.\"    notice, this list of conditions and the following disclaimer.
.\" 2. Redistributions in binary form must reproduce the above copyright
.\"    notice, this list of conditions and the following disclaimer in the
.\"    documentation and/or other materials provided with the distribution.
.\" 3. Neither the name of The Internet Software Consortium nor the names
.\"    of its contributors may be used to endorse or promote products derived
.\"    from this software without specific prior written permission.
.\"
.\" THIS SOFTWARE IS PROVIDED BY THE INTERNET SOFTWARE CONSORTIUM AND
.\" CONTRIBUTORS ``AS IS'' AND ANY EXPRESS OR IMPLIED WARRANTIES,
.\" INCLUDING, BUT NOT LIMITED TO, THE IMPLIED WARRANTIES OF
.\" MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE ARE
.\" DISCLAIMED.  IN NO EVENT SHALL THE INTERNET SOFTWARE CONSORTIUM OR
.\" CONTRIBUTORS BE LIABLE FOR ANY DIRECT, INDIRECT, INCIDENTAL,
.\" SPECIAL, EXEMPLARY, OR CONSEQUENTIAL DAMAGES (INCLUDING, BUT NOT
.\" LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES; LOSS OF
.\" USE, DATA, OR PROFITS; OR BUSINESS INTERRUPTION) HOWEVER CAUSED AND
.\" ON ANY THEORY OF LIABILITY, WHETHER IN CONTRACT, STRICT LIABILITY,
.\" OR TORT (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT
.\" OF THE USE OF THIS SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF
.\" SUCH DAMAGE.
.\"
.\" This software has been written for the Internet Software Consortium
.\" by Ted Lemon <mellon@@fugue.com> in cooperation with Vixie
.\" Enterprises.  To learn more about the Internet Software Consortium,
.\" see ``http://www.isc.org/isc''.  To learn more about Vixie
.\" Enterprises, see ``http://www.vix.com''.
.\"
.Dd January 1, 1997
.Dt DHCPD.LEASES 5
.Os
.Sh NAME
.Nm dhcpd.leases
.Nd DHCP client lease database
.Sh DESCRIPTION
The Internet Software Consortium DHCP Server keeps a persistent
database of leases that it has assigned.
This database is a free-form ASCII file containing a series of
lease declarations.
Every time a lease is acquired, renewed or released, its new value is
recorded at the end of the lease file.
So if more than one declaration appears for a given lease,
the last one in the file is the current one.
.Pp
When
.Xr dhcpd 8
is first installed, there is no lease database.
However, dhcpd requires that a lease database be present before it will start.
To make the initial lease database, just create an empty file called
.Pa /var/db/dhcpd.leases .
.Pp
In order to prevent the lease database from growing without bound, the
file is rewritten from time to time.
First, a temporary lease database is created and all known leases are
dumped to it.
Then, the old lease database is renamed
.Pa /var/db/dhcpd.leases~ .
Finally, the newly written lease database is moved into place.
.Pp
There is a window of vulnerability where if the dhcpd process is
killed or the system crashes after the old lease database has been
renamed but before the new one has been moved into place, there will
be no
.Pa /var/db/dhcpd.leases .
In this case, dhcpd will refuse to start,
and will require manual intervention.
.Em DO NOT
simply create a new lease file when this happens \- if you do,
you will lose all your old bindings, and chaos will ensue.
Instead, rename
.Pa /var/db/dhcpd.leases~
to
.Pa /var/db/dhcpd.leases ,
restoring the old, valid lease file, and then start dhcpd.
This guarantees that a valid lease file will be restored.
.Sh FORMAT
Lease descriptions are stored in a format that is parsed by the same
recursive descent parser used to read the
.Xr dhcpd.conf 5
and
.Xr dhclient.conf 5
files.
Currently, the only declaration that is used in the
.Nm
file is the
.Ic lease
declaration.
.Pp
.Xo
.Ic \	\&lease Ar ip-address No { Ar statements... No }
.Xc
.Pp
Each lease declaration includes the single IP address that has been
leased to the client.
The statements within the braces define the duration of the lease
and to whom it is assigned.
.Pp
The start and end time of a lease are recorded using the ``starts''
and ``ends'' statements:
.Pp
.D1 Ic starts Ar date ;
.D1 Ic ends Ar date ;
.Pp
Dates are specified as follows:
.Pp
.Sm off
.Xo
.Ar \	\&weekday\ \&year No / Ar month
.Pf / Ar day\ \& hour No :
.Ar minute No : Ar second
.Xc
.Sm on
.Pp
The weekday is present to make it easy for a human to tell when a
lease expires \- it's specified as a number from zero to six, with zero
being Sunday.
The day of week is ignored on input.
The year is specified with the century, so it should generally be four digits
except for really long leases.
The month is specified as a number starting with 1 for January.
The day of the month is likewise specified starting with 1.
The hour is a number from 0 to 23, the minute a number from 0 to 59,
and the second also a number from 0 to 59.
.Pp
Lease times are specified in Coordinated Universal Time (UTC), not in the
local time zone.
.Qq Li date -u
will show the current time in UTC.
.Pp
The MAC address of the network interface that was used to acquire the
lease is recorded with the
.Ic hardware
statement:
.Pp
.D1 Ic hardware Ar hardware-type mac-address ;
.Pp
The MAC address is specified as a series of hexadecimal octets,
separated by colons.
.Pp
If the client uses a client identifier to acquire its address, the
client identifier is recorded using the
.Ic uid
statement:
.Pp
.D1 Ic uid Ar client-identifier ;
.Pp
The client identifier is recorded as a series of hexadecimal octets,
regardless of whether the client specifies an ASCII string or uses the
newer hardware type/MAC address format.
.Pp
If the client sends a hostname using the
.Ic Client Hostname
option, as specified in some versions of the DHCP-DNS Interaction draft, that
hostname is recorded using the
.Ic client-hostname
statement.
.Pp
.D1 Ic client-hostname Ar \&"hostname\&" ;
.Pp
If the client sends its hostname using the
.Ic Hostname
option, as Windows 95 does, it is recorded using the
.Ic hostname
statement.
.Pp
.D1 Ic hostname Ar \&"hostname\&" ;
.Pp
The DHCP server may determine that a lease has been misused in some
way, either because a client that has been assigned a lease NAKs it,
or because the server's own attempt to see if an address is in use
prior to reusing it reveals that the address is in fact already in
use.
In that case, the
.Ic abandoned
statement will be used to indicate that the lease should not be reassigned.
.Pp
.D1 Ic abandoned ;
.Pp
Abandoned leases are reclaimed automatically.
When a client asks for a new address, and the server finds that there
are no new addresses, it checks to see if there are any abandoned leases,
and allocates the least recently abandoned lease.
The standard mechanisms for checking for lease address conflicts are still
followed, so if the abandoned lease's IP address is still in use,
it will be reabandoned.
.Pp
If a client
.Em requests
an abandoned address, the server assumes that the reason the address was
abandoned was that the lease file was corrupted, and that the client is
the machine that responded when the lease was probed,
causing it to be abandoned.
In that case, the address is immediately assigned to the client.
.Sh FILES
.Bl -tag -width Ds -compact
.It /var/db/dhcpd.leases
.It /var/db/dhcpd.leases~
.El
.Sh SEE ALSO
.Xr dhcp-options 5 ,
.Xr dhcpd.conf 5 ,
.Xr dhcpd 8
.Pp
RFC 2132, RFC 2131.
.Sh AUTHORS
.Xr dhcpd 8
was written by
.An Ted Lemon Aq mellon@@vix.com
under a contract with Vixie Labs.
Funding for this project was provided by the Internet Software Corporation.
Information about the Internet Software Consortium can be found at
.Pa http://www.isc.org/isc .
@


1.7
log
@mdoc version of the dhcp pages;
from myself and pjanzen@@.

input and ok in dhclient-script.8 from krw@@
@
text
@d1 1
a1 1
.\"	$OpenBSD$
@


1.6
log
@- expand DBDIR, ETCDIR, RUNDIR to the actual directories to make
  the man pages easier to read
- add dhcp(8) to SEE ALSO in dhcpd(8)
- rearrange SEE ALSO in section order as well as alphabetical in dhcpd(8)

ok millert@@, todd@@
@
text
@d1 1
a1 1
.\"	dhcpd.leases.5
d38 8
a45 4
.TH dhcpd.leases 5
.SH NAME
dhcpd.leases - DHCP client lease database
.SH DESCRIPTION
d47 12
a58 8
database of leases that it has assigned.  This database is a free-form
ASCII file containing a series of lease declarations.  Every time a
lease is acquired, renewed or released, its new value is recorded at
the end of the lease file.  So if more than one declaration appears
for a given lease, the last one in the file is the current one.
.PP
When dhcpd is first installed, there is no lease database.   However,
dhcpd requires that a lease database be present before it will start.
d60 2
a61 2
/var/db/dhcpd.leases.
.PP
d63 7
a69 5
file is rewritten from time to time.   First, a temporary lease
database is created and all known leases are dumped to it.   Then, the
old lease database is renamed /var/db/dhcpd.leases~.   Finally, the
newly written lease database is moved into place.
.PP
d73 14
a86 8
be no /var/db/dhcpd.leases.   In this case, dhcpd will refuse to start,
and will require manual intervention.   \fBDO NOT\fR simply create a
new lease file when this happens - if you do, you will lose all your
old bindings, and chaos will ensue.   Instead, rename
/var/db/dhcpd.leases~ to /var/db/dhcpd.leases, restoring the old, valid
lease file, and then start dhcpd.   This guarantees that a valid lease
file will be restored.
.SH FORMAT
d89 1
a89 1
.B dhcpd.conf(5)
d91 6
a96 4
.B dhclient.conf(5)
files.   Currently, the only declaration that is
used in the dhcpd.leases file is the 
.B lease
d98 5
a102 3
.PP
 \fBlease \fIip-address\fB { \fIstatements...\fB }
.PP
d104 4
a107 3
leased to the client.   The statements within the braces define the
duration of the lease and to whom it is assigned.
.PP
d110 4
a113 4
.PP
 \fB starts \fIdate\fB;\fR
 \fB ends \fIdate\fB;\fR
.PP
d115 9
a123 4
.PP
 \fIweekday year\fB/\fImonth\fB/\fIday
hour\fB:\fIminute\fB:\fIsecond\fR
.PP
d125 15
a139 16
lease expires - it's specified as a number from zero to six, with zero
being Sunday.  The day of week is ignored on input.  The year is
specified with the century, so it should generally be four digits
except for really long leases.  The month is specified as a number
starting with 1 for January.  The day of the month is likewise
specified starting with 1.  The hour is a number between 0 and 23, the
minute a number between 0 and 59, and the second also a number between
0 and 59.
.PP
Lease times are specified in Greenwich Mean Time (GMT), not in the
local time zone.   Since Greenwich is actually on Daylight Savings
Time part of the year, there is probably nowhere in the world where
the times recorded on a lease are always the same as wall clock times.
On a unix machine, one can often figure out the current time in GMT by
typing \fBdate -u\fR.
.PP
d141 6
a146 4
lease is recorded with the \fBhardware\fR statement:
.PP
 \fBhardware \fIhardware-type mac-address\fB;\fR
.PP
d149 8
a156 6
.PP
If the client used a client identifier to acquire its address, the
client identifier is recorded using the \fBuid\fR statement:
.PP
 \fBuid \fIclient-identifier\fB;\fR
.PP
d160 18
a177 12
.PP
If the client sends a hostname using the \fIClient Hostname\fR option,
as specified in some versions of the DHCP-DNS Interaction draft, that
hostname is recorded using the \fBclient-hostname\fR statement.
.PP
 \fBclient-hostname "\fIhostname\fB";\fR
.PP
If the client sends its hostname using the \fIHostname\fR option, as
Windows 95 does, it is recorded using the \fBhostname\fR statement.
.PP
 \fBhostname "\fIhostname\fB";\fR
.PP
d182 39
a220 26
use.   In that case, the \fBabandoned\fR statement will be used to
indicate that the lease should not be reassigned.
.PP
 \fBabandoned;\fR
.PP
Abandoned leases are reclaimed automatically.   When a client asks for
a new address, and the server finds that there are no new addresses,
it checks to see if there are any abandoned leases, and allocates the
least recently abandoned lease.   The standard mechanisms for checking
for lease address conflicts are still followed, so if the abandoned
lease's IP address is still in use, it will be reabandoned.
.PP
If a client \fBrequests\fR an abandoned address, the server assumes
that the reason the address was abandoned was that the lease file was
corrupted, and that the client is the machine that responded when the
lease was probed, causing it to be abandoned.   In that case, the
address is immediately assigned to the client.
.SH FILES
.B /var/db/dhcpd.leases
.SH SEE ALSO
dhcpd(8), dhcp-options(5), dhcpd.conf(5), RFC2132, RFC2131.
.SH AUTHOR
.B dhcpd(8)
was written by Ted Lemon <mellon@@vix.com>
under a contract with Vixie Labs.   Funding
for this project was provided by the Internet Software Corporation.
d222 1
a222 1
.B http://www.isc.org/isc.
@


1.5
log
@typos;
ok millert@@
@
text
@d52 1
a52 1
DBDIR/dhcpd.leases.
d57 1
a57 1
old lease database is renamed DBDIR/dhcpd.leases~.   Finally, the
d63 1
a63 1
be no DBDIR/dhcpd.leases.   In this case, dhcpd will refuse to start,
d67 1
a67 1
DBDIR/dhcpd.leases~ to DBDIR/dhcpd.leases, restoring the old, valid
d165 1
a165 1
.B DBDIR/dhcpd.leases
@


1.4
log
@seperate[d][ly] -> separate[d][ly]; alan@@alanday.com
@
text
@d83 1
a83 1
Each lease declaration include the single IP address that has been
@


1.3
log
@dhcp 2.0pl5 merge/cleanup/deadcode slashing. still needs more eyes on this
but appears to work better than what's been in-tree before for dealing with
stupid dhcp servers.
@
text
@d121 1
a121 1
seperated by colons.
@


1.2
log
@It's spelled "occurrence".  Also a few other minor mods while I'm at it.
@
text
@d1 1
a1 2
.\"	$OpenBSD$
.\"	dhcpd.conf.5
d3 1
a3 1
.\" Copyright (c) 1997 The Internet Software Consortium.
d44 4
a47 4
ASCII file containing one valid declaration per lease.  If more than
one declaration appears for a given lease, the last one in the file is
used.  The file is written as a log, so this is not an unusual
occurrence.
d52 1
a52 1
/var/db/dhcpd.leases.
d57 1
a57 1
old lease database is renamed /var/db/dhcpd.leases~.   Finally, the
d63 1
a63 1
be no /var/db/dhcpd.leases.   In this case, dhcpd will refuse to start,
d67 1
a67 1
/var/db/dhcpd.leases~ to /var/db/dhcpd.leases, restoring the old, valid
d71 93
a163 1
The format of the lease declarations is not currently documented.
d165 1
a165 1
.B /var/db/dhcpd.leases
@


1.1
log
@ISC dhcp, needs security audit for sure
@
text
@d1 1
d48 1
a48 1
occurrance.
@

