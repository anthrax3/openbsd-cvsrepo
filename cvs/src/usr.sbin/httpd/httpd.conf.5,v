head	1.83;
access;
symbols
	OPENBSD_6_1:1.81.0.4
	OPENBSD_6_1_BASE:1.81
	OPENBSD_6_0:1.73.0.2
	OPENBSD_6_0_BASE:1.73
	OPENBSD_5_9:1.68.0.2
	OPENBSD_5_9_BASE:1.68
	OPENBSD_5_8:1.68.0.4
	OPENBSD_5_8_BASE:1.68
	OPENBSD_5_7:1.54.0.2
	OPENBSD_5_7_BASE:1.54
	OPENBSD_5_6:1.29.0.2
	OPENBSD_5_6_BASE:1.29;
locks; strict;
comment	@.\" @;


1.83
date	2017.08.11.18.48.56;	author jsing;	state Exp;
branches;
next	1.82;
commitid	RqXM9HKDTTdTxuJj;

1.82
date	2017.04.09.09.13.28;	author florian;	state Exp;
branches;
next	1.81;
commitid	PUTCf4k1TvRyFNYI;

1.81
date	2017.03.25.17.25.34;	author claudio;	state Exp;
branches;
next	1.80;
commitid	43NsM2S8LTb1McoD;

1.80
date	2017.03.16.10.18.11;	author florian;	state Exp;
branches;
next	1.79;
commitid	pOJdU03lhyFuOUS6;

1.79
date	2017.02.07.12.27.42;	author reyk;	state Exp;
branches;
next	1.78;
commitid	39LWvR7k2X9Ou0Vd;

1.78
date	2017.01.24.13.28.47;	author jmc;	state Exp;
branches;
next	1.77;
commitid	r2hRsEJPs4wV5LYY;

1.77
date	2017.01.24.12.37.00;	author beck;	state Exp;
branches;
next	1.76;
commitid	vKl6misvpqsQFbCR;

1.76
date	2016.11.14.10.28.31;	author schwarze;	state Exp;
branches;
next	1.75;
commitid	zARyOlyHtfEBjqXS;

1.75
date	2016.11.06.11.27.04;	author jmc;	state Exp;
branches;
next	1.74;
commitid	JF1CIzksT79zphEA;

1.74
date	2016.11.06.10.49.38;	author beck;	state Exp;
branches;
next	1.73;
commitid	49Xfy4fsPamn6Ga1;

1.73
date	2016.05.09.19.36.54;	author tj;	state Exp;
branches;
next	1.72;
commitid	do1YcIhijh0e5H9P;

1.72
date	2016.04.28.22.16.41;	author schwarze;	state Exp;
branches;
next	1.71;
commitid	i38Q6KghRCzFl6Nj;

1.71
date	2016.04.24.21.06.53;	author jmc;	state Exp;
branches;
next	1.70;
commitid	sklxk2ysiVwgBR4w;

1.70
date	2016.04.24.20.12.25;	author chrisz;	state Exp;
branches;
next	1.69;
commitid	P0xiXo8KJxzSB8uB;

1.69
date	2016.04.20.12.48.54;	author jmc;	state Exp;
branches;
next	1.68;
commitid	cpkywpbgt6YNvIC7;

1.68
date	2015.07.19.05.17.27;	author reyk;	state Exp;
branches;
next	1.67;
commitid	jdqdR7UPKnGDga2T;

1.67
date	2015.07.18.09.29.47;	author jmc;	state Exp;
branches;
next	1.66;
commitid	tjKHclr8hl1nbRVz;

1.66
date	2015.07.18.06.00.43;	author reyk;	state Exp;
branches;
next	1.65;
commitid	GYrjpgr4p814WbAx;

1.65
date	2015.07.18.05.41.18;	author florian;	state Exp;
branches;
next	1.64;
commitid	2Fg8acs1mTRftiTA;

1.64
date	2015.07.15.17.10.47;	author jsing;	state Exp;
branches;
next	1.63;
commitid	3OOtfySoYZhWwAW3;

1.63
date	2015.06.23.17.29.19;	author jmc;	state Exp;
branches;
next	1.62;
commitid	HTKnd9fMi0wny4yJ;

1.62
date	2015.06.23.15.23.14;	author reyk;	state Exp;
branches;
next	1.61;
commitid	KmQD0QhuAUl1XRCr;

1.61
date	2015.05.28.19.29.40;	author jmc;	state Exp;
branches;
next	1.60;
commitid	sr35cIvUROi1zqVM;

1.60
date	2015.05.19.18.16.32;	author sobrado;	state Exp;
branches;
next	1.59;
commitid	maDa9wsw2lGxRYYh;

1.59
date	2015.05.19.18.12.58;	author sobrado;	state Exp;
branches;
next	1.58;
commitid	T8yhY3l2IkmGMk7w;

1.58
date	2015.05.19.18.03.32;	author sobrado;	state Exp;
branches;
next	1.57;
commitid	smbxM1RfH70awQfU;

1.57
date	2015.03.26.19.16.57;	author jmc;	state Exp;
branches;
next	1.56;
commitid	IrKgkMlKS7zy99JF;

1.56
date	2015.03.11.21.52.20;	author reyk;	state Exp;
branches;
next	1.55;
commitid	7qk3GfDoM6pMjYmD;

1.55
date	2015.03.09.15.51.17;	author reyk;	state Exp;
branches;
next	1.54;
commitid	GtjRRmcj5L1Cd0GX;

1.54
date	2015.03.06.05.10.18;	author reyk;	state Exp;
branches;
next	1.53;
commitid	BKbGOKkqMmr1CbTS;

1.53
date	2015.02.23.18.43.18;	author reyk;	state Exp;
branches;
next	1.52;
commitid	xe3hvTl4EsdtcfCj;

1.52
date	2015.02.19.09.19.01;	author florian;	state Exp;
branches;
next	1.51;
commitid	becZwRY5mngF6aK5;

1.51
date	2015.02.15.13.43.32;	author jsing;	state Exp;
branches;
next	1.50;
commitid	LYHxTfyJZlazQLUR;

1.50
date	2015.02.07.08.12.30;	author jmc;	state Exp;
branches;
next	1.49;
commitid	sMbhU0yg7Sv61pRp;

1.49
date	2015.02.07.06.46.01;	author jsing;	state Exp;
branches;
next	1.48;
commitid	ddAOPNCnC4II2M3H;

1.48
date	2015.02.07.01.23.12;	author reyk;	state Exp;
branches;
next	1.47;
commitid	tJajgOHQ1aZRGbKl;

1.47
date	2015.01.19.19.37.50;	author reyk;	state Exp;
branches;
next	1.46;
commitid	95e2Z6BqzOOfEsll;

1.46
date	2015.01.18.18.39.46;	author florian;	state Exp;
branches;
next	1.45;
commitid	ooB0NFy6I9JHE9WG;

1.45
date	2015.01.18.14.01.17;	author florian;	state Exp;
branches;
next	1.44;
commitid	7n1dHfzjQzsDnx3e;

1.44
date	2015.01.13.09.21.15;	author reyk;	state Exp;
branches;
next	1.43;
commitid	vlRoyiZgaC5QvCo7;

1.43
date	2015.01.05.11.03.57;	author reyk;	state Exp;
branches;
next	1.42;
commitid	RORQcaXFxComSi96;

1.42
date	2015.01.04.22.23.58;	author chrisz;	state Exp;
branches;
next	1.41;
commitid	PxQkOIiHP7NqIPYy;

1.41
date	2015.01.03.15.49.18;	author reyk;	state Exp;
branches;
next	1.40;
commitid	9CmQ2ohpRPUtdzFN;

1.40
date	2014.12.28.13.53.23;	author reyk;	state Exp;
branches;
next	1.39;
commitid	tjI1SEp0qBIbPR7s;

1.39
date	2014.12.18.10.18.25;	author reyk;	state Exp;
branches;
next	1.38;
commitid	MpYmB8CzdxmqIFsz;

1.38
date	2014.12.18.09.00.19;	author reyk;	state Exp;
branches;
next	1.37;
commitid	PEUoquHjQ55yFr72;

1.37
date	2014.12.12.14.45.59;	author reyk;	state Exp;
branches;
next	1.36;
commitid	j2F3LZ1OyONol7u9;

1.36
date	2014.11.12.16.52.44;	author jmc;	state Exp;
branches;
next	1.35;
commitid	YQXjm7garIt9exhl;

1.35
date	2014.11.11.15.54.45;	author beck;	state Exp;
branches;
next	1.34;
commitid	ki9qbAAMZ7dFJTRL;

1.34
date	2014.09.01.12.22.38;	author jmc;	state Exp;
branches;
next	1.33;
commitid	qxSjepsQ2rU0SGPv;

1.33
date	2014.08.25.14.27.54;	author reyk;	state Exp;
branches;
next	1.32;
commitid	9BrKucaQiTo8j21n;

1.32
date	2014.08.17.18.46.29;	author jmc;	state Exp;
branches;
next	1.31;
commitid	H1jlCcyw3Pjx6aoR;

1.31
date	2014.08.09.09.07.14;	author jmc;	state Exp;
branches;
next	1.30;
commitid	4PhFRxYZfnEQKdZG;

1.30
date	2014.08.09.08.54.03;	author jmc;	state Exp;
branches;
next	1.29;
commitid	4YxU8ar4oW0mscPD;

1.29
date	2014.08.06.20.29.54;	author reyk;	state Exp;
branches;
next	1.28;
commitid	JDxuBybaCzkECcWt;

1.28
date	2014.08.06.18.21.14;	author reyk;	state Exp;
branches;
next	1.27;
commitid	jZUEHtimlVJa4lx5;

1.27
date	2014.08.06.16.31.09;	author jsing;	state Exp;
branches;
next	1.26;
commitid	vMPQtYwfkxOqHsKb;

1.26
date	2014.08.05.18.01.10;	author reyk;	state Exp;
branches;
next	1.25;
commitid	bNgJHQQ6lNzksAJO;

1.25
date	2014.08.05.17.13.16;	author reyk;	state Exp;
branches;
next	1.24;
commitid	2nfBdGefXSzNhlwv;

1.24
date	2014.08.05.17.03.21;	author reyk;	state Exp;
branches;
next	1.23;
commitid	ulX0VuMNq02xaDM4;

1.23
date	2014.08.05.15.36.59;	author reyk;	state Exp;
branches;
next	1.22;
commitid	0eZ0KmX2vQuZV9Ts;

1.22
date	2014.08.05.09.24.21;	author jsg;	state Exp;
branches;
next	1.21;
commitid	NFtWiwbcZQWHRBUA;

1.21
date	2014.08.04.17.38.12;	author reyk;	state Exp;
branches;
next	1.20;
commitid	QN0gng3yApfUkUG0;

1.20
date	2014.08.04.17.12.44;	author reyk;	state Exp;
branches;
next	1.19;
commitid	mkpXIkPjjyUwjBb7;

1.19
date	2014.08.04.15.49.28;	author reyk;	state Exp;
branches;
next	1.18;
commitid	LDlAyIlUWDBjADa5;

1.18
date	2014.08.03.10.26.43;	author reyk;	state Exp;
branches;
next	1.17;
commitid	J4iRjIQasNlCySVe;

1.17
date	2014.08.02.21.21.47;	author doug;	state Exp;
branches;
next	1.16;
commitid	eYHmkmq5eeXpnLSo;

1.16
date	2014.08.02.10.24.36;	author reyk;	state Exp;
branches;
next	1.15;
commitid	FdmHdw5fXagddUPG;

1.15
date	2014.08.02.08.07.07;	author jmc;	state Exp;
branches;
next	1.14;
commitid	yunMWfb5DDwuw3ap;

1.14
date	2014.08.01.21.59.56;	author reyk;	state Exp;
branches;
next	1.13;
commitid	x6XXpbpENAdHhEQS;

1.13
date	2014.08.01.21.51.02;	author doug;	state Exp;
branches;
next	1.12;
commitid	EQrn6y0IO5CKfaGo;

1.12
date	2014.07.31.14.18.38;	author reyk;	state Exp;
branches;
next	1.11;
commitid	YuIDlOouHxlacCk2;

1.11
date	2014.07.31.09.34.57;	author reyk;	state Exp;
branches;
next	1.10;
commitid	KZnViLTHk4UhEJQd;

1.10
date	2014.07.30.10.05.14;	author reyk;	state Exp;
branches;
next	1.9;
commitid	crg28r1097elBMcd;

1.9
date	2014.07.30.09.51.40;	author reyk;	state Exp;
branches;
next	1.8;
commitid	tMzK2kZxamMPlOU9;

1.8
date	2014.07.29.16.17.28;	author reyk;	state Exp;
branches;
next	1.7;
commitid	lVEJBNunwU7ia3Go;

1.7
date	2014.07.25.17.49.11;	author reyk;	state Exp;
branches;
next	1.6;
commitid	GEp21VEdYVQND59C;

1.6
date	2014.07.25.15.47.11;	author reyk;	state Exp;
branches;
next	1.5;
commitid	xtB2Bs9CALPvM8y3;

1.5
date	2014.07.22.19.03.21;	author jmc;	state Exp;
branches;
next	1.4;
commitid	xUC5uXPoJqtr8keK;

1.4
date	2014.07.22.18.31.16;	author ajacoutot;	state Exp;
branches;
next	1.3;
commitid	iaiV4L13bnmzCTwH;

1.3
date	2014.07.17.11.32.14;	author stsp;	state Exp;
branches;
next	1.2;
commitid	IUV9SsBHHBNdolBt;

1.2
date	2014.07.13.14.17.37;	author reyk;	state Exp;
branches;
next	1.1;
commitid	4gg9IcDTWDACYa56;

1.1
date	2014.07.12.23.34.54;	author reyk;	state Exp;
branches;
next	;
commitid	U5OqzWAgis3Sb3uE;


desc
@@


1.83
log
@Convert httpd to tls_config_set_ecdhecurves(), allowing a list of curves
to be specified, rather than a single curve.

ok beck@@
@
text
@.\"	$OpenBSD: httpd.conf.5,v 1.82 2017/04/09 09:13:28 florian Exp $
.\"
.\" Copyright (c) 2014, 2015 Reyk Floeter <reyk@@openbsd.org>
.\"
.\" Permission to use, copy, modify, and distribute this software for any
.\" purpose with or without fee is hereby granted, provided that the above
.\" copyright notice and this permission notice appear in all copies.
.\"
.\" THE SOFTWARE IS PROVIDED "AS IS" AND THE AUTHOR DISCLAIMS ALL WARRANTIES
.\" WITH REGARD TO THIS SOFTWARE INCLUDING ALL IMPLIED WARRANTIES OF
.\" MERCHANTABILITY AND FITNESS. IN NO EVENT SHALL THE AUTHOR BE LIABLE FOR
.\" ANY SPECIAL, DIRECT, INDIRECT, OR CONSEQUENTIAL DAMAGES OR ANY DAMAGES
.\" WHATSOEVER RESULTING FROM LOSS OF USE, DATA OR PROFITS, WHETHER IN AN
.\" ACTION OF CONTRACT, NEGLIGENCE OR OTHER TORTIOUS ACTION, ARISING OUT OF
.\" OR IN CONNECTION WITH THE USE OR PERFORMANCE OF THIS SOFTWARE.
.\"
.Dd $Mdocdate: April 9 2017 $
.Dt HTTPD.CONF 5
.Os
.Sh NAME
.Nm httpd.conf
.Nd HTTP daemon configuration file
.Sh DESCRIPTION
.Nm
is the configuration file for the HTTP daemon,
.Xr httpd 8 .
.Sh SECTIONS
.Nm
is divided into four main sections:
.Bl -tag -width xxxx
.It Sy Macros
User-defined variables may be defined and used later, simplifying the
configuration file.
.It Sy Global Configuration
Global settings for
.Xr httpd 8 .
.It Sy Servers
Listening HTTP web servers.
.It Sy Types
Media types and extensions.
.El
.Pp
Within the sections,
a host
.Ar address
can be specified by IPv4 address, IPv6 address, interface name,
interface group, or DNS hostname.
If the address is an interface name,
.Xr httpd 8
will look up the first IPv4 address and any other IPv4 and IPv6
addresses of the specified network interface.
If
.Sq *
is given as an address,
it will be used as an alias for
.Ar 0.0.0.0
to listen on all IPv4 addresses.
Likewise,
.Sq ::
can be used to listen on all IPv6 addresses.
A
.Ar port
can be specified by number or name.
The port name to number mappings are found in the file
.Pa /etc/services ;
see
.Xr services 5
for details.
.Pp
The current line can be extended over multiple lines using a backslash
.Pq Sq \e .
Comments can be put anywhere in the file using a hash mark
.Pq Sq # ,
and extend to the end of the current line.
Care should be taken when commenting out multi-line text:
the comment is effective until the end of the entire block.
.Pp
Argument names not beginning with a letter, digit, or underscore
must be quoted.
.Pp
Additional configuration files can be included with the
.Ic include
keyword, for example:
.Bd -literal -offset indent
include "/etc/httpd.conf.local"
.Ed
.Sh MACROS
Macros can be defined that will later be expanded in context.
Macro names must start with a letter, digit, or underscore,
and may contain any of those characters.
Macro names may not be reserved words (for example,
.Ic directory ,
.Ic log ,
or
.Ic root ) .
Macros are not expanded inside quotes.
.Pp
For example:
.Bd -literal -offset indent
ext_ip="10.0.0.1"
server "default" {
	listen on $ext_ip port 80
}
.Ed
.Sh GLOBAL CONFIGURATION
Here are the settings that can be set globally:
.Bl -tag -width Ds
.It Ic chroot Ar directory
Set the
.Xr chroot 2
directory.
If not specified, it defaults to
.Pa /var/www ,
the home directory of the www user.
.It Ic default type Ar type/subtype
Set the default media type that is used if the media type for a
specified extension is not found in the configured types or for files
without a file extension;
see the
.Sx TYPES
section below.
If not specified, the default type is set to
.Ar application/octet-stream .
.It Ic logdir Ar directory
Specifies the full path of the directory in which log files will be written.
If not specified, it defaults to
.Pa /logs
within the
.Xr chroot 2
directory.
.It Ic prefork Ar number
Run the specified number of server processes.
This increases the performance and prevents delays when connecting
to a server.
.Xr httpd 8
runs 3 server processes by default.
.El
.Sh SERVERS
The configured web servers.
.Pp
Each
.Ic server
section starts with a declaration of the server
.Ar name :
.Bl -tag -width Ds
.It Ic server Ar name Brq ...
Match the server name using shell globbing rules.
This can be an explicit name,
.Ar www.example.com ,
or a name including wildcards,
.Ar *.example.com .
.It Ic server match Ar name Brq ...
Match the server name using pattern matching,
see
.Xr patterns 7 .
.El
.Pp
Followed by a block of options that is enclosed in curly brackets:
.Bl -tag -width Ds
.It Ic alias Ar name
Specify an additional alias
.Ar name
for this server.
.It Ic alias match Ar name
Like the
.Ic alias
option,
but
.Ic match
the
.Ar name
using pattern matching instead of shell globbing rules,
see
.Xr patterns 7 .
.It Oo Ic no Oc Ic authenticate Oo Ar realm Oc Ic with Pa htpasswd
Authenticate a remote user for
.Ar realm
by checking the credentials against the user authentication file
.Pa htpasswd .
The file name is relative to the
.Ic chroot
and must be readable by the www user.
Use the
.Ic no authenticate
directive to disable authentication in a location.
.It Ic block drop
Drop the connection without sending an error page.
.It Ic block Op Ic return Ar code Op Ar uri
Close the connection and send an error page.
If the optional return code is not specified,
.Xr httpd 8
denies access with a
.Sq 403 Forbidden
response.
The optional
.Ar uri
argument can be used with return codes in the 3xx range to send a
.Sq Location:
header for redirection to a specified URI.
.Pp
The
.Ar uri
may contain predefined macros that will be expanded at runtime:
.Pp
.Bl -tag -width $DOCUMENT_URI -offset indent -compact
.It Ic $DOCUMENT_URI
The request path.
.It Ic $QUERY_STRING
The optional query string of the request.
.It Ic $REMOTE_ADDR
The IP address of the connected client.
.It Ic $REMOTE_PORT
The TCP source port of the connected client.
.It Ic $REMOTE_USER
The remote user for HTTP authentication.
.It Ic $REQUEST_URI
The request path and optional query string.
.It Ic $SERVER_ADDR
The configured IP address of the server.
.It Ic $SERVER_PORT
The configured TCP server port of the server.
.It Ic $SERVER_NAME
The name of the server.
.It Ic $HTTP_HOST
The host from the HTTP Host header.
.It Pf % Ar n
The capture index
.Ar n
of a string that was captured by the enclosing
.Ic location match
option.
.El
.It Ic connection Ar option
Set the specified options and limits for HTTP connections.
Valid options are:
.Bl -tag -width Ds
.It Ic max request body Ar number
Set the maximum body size in bytes that the client can send to the server.
The default value is 1048576 bytes (1M).
.It Ic max requests Ar number
Set the maximum number of requests per persistent HTTP connection.
Persistent connections are negotiated using the Keep-Alive header in
HTTP/1.0 and enabled by default in HTTP/1.1.
The default maximum number of requests per connection is 100.
.It Ic request timeout Ar seconds
Specify the inactivity timeout for HTTP operations between client and server,
for example the maximum time to wait for a request from the client.
The default timeout is 60 seconds (1 minute).
The maximum is 2147483647 seconds (68 years).
.It Ic timeout Ar seconds
Specify the inactivity timeout in seconds for accepted sessions,
for example the maximum time to wait for I/O from the FastCGI backend.
The default timeout is 600 seconds (10 minutes).
The maximum is 2147483647 seconds (68 years).
.El
.It Ic default type Ar type/subtype
Set the default media type for the specified location,
overwriting the global setting.
.It Ic directory Ar option
Set the specified options when serving or accessing directories.
Valid options are:
.Bl -tag -width Ds
.It Oo Ic no Oc Ic auto index
If no index file is found, automatically generate a directory listing.
This is disabled by default.
.It Ic index Ar string
Set the directory index file.
If not specified, it defaults to
.Pa index.html .
.It Ic no index
Disable the directory index.
.Xr httpd 8
will neither display nor generate a directory index.
.El
.It Oo Ic no Oc Ic fastcgi Op Ic socket Ar socket
Enable FastCGI instead of serving files.
The
.Ar socket
is a local path name within the
.Xr chroot 2
root directory of
.Xr httpd 8
and defaults to
.Pa /run/slowcgi.sock .
.Pp
The FastCGI handler will be given the following variables:
.Pp
.Bl -tag -width GATEWAY_INTERFACE -offset indent -compact
.It Ic DOCUMENT_ROOT
The document root in which the script is located as configured by the
.Ic root
option for the server or location that matches the request.
.It Ic GATEWAY_INTERFACE
The revision of the CGI specification used.
.It Ic HTTP_*
Additional HTTP headers the connected client sent in the request, if
any.
.It Ic HTTPS
A variable that is set to
.Qq on
when the server has been configured to use TLS.
This variable is omitted otherwise.
.It Ic REQUEST_URI
The path and optional query string as requested by the connected client.
.It Ic DOCUMENT_URI
The canonicalized request path, possibly with a slash or
directory index file name appended.
This is the same as
.Ic PATH_INFO
appended to
.Ic SCRIPT_NAME .
.It Ic SCRIPT_NAME
The virtual URI path to the script.
.It Ic PATH_INFO
The optional path appended after the script name in the request path.
This variable is an empty string if no path is appended after the
script name.
.It Ic SCRIPT_FILENAME
The absolute, physical path to the script within the
.Xr chroot 2
directory.
.It Ic QUERY_STRING
The optional query string of the request.
This variable is an empty
string if there is no query string in the request.
.It Ic REMOTE_ADDR
The IP address of the connected client.
.It Ic REMOTE_PORT
The TCP source port of the connected client.
.It Ic REMOTE_USER
The remote user when using HTTP authentication.
.It Ic REQUEST_METHOD
The HTTP method the connected client used when making the request.
.It Ic SERVER_ADDR
The configured IP address of the server.
.It Ic SERVER_NAME
The name of the server.
.It Ic SERVER_PORT
The configured TCP server port of the server.
.It Ic SERVER_PROTOCOL
The revision of the HTTP specification used.
.It Ic SERVER_SOFTWARE
The server software name of
.Xr httpd 8 .
.El
.It Ic hsts Oo Ar option Oc
Enable HTTP Strict Transport Security.
Valid options are:
.Bl -tag -width Ds
.It Ic max-age Ar seconds
Set the maximum time in seconds a receiving user agent should regard
this host as an HSTS host.
The default is one year.
.It Ic preload
Confirm and authenticate that the site is permitted to be included in
a browser's preload list.
.It Ic subdomains
Signal to the receiving user agent that this host and all sub domains
of the host's domain should be considered HSTS hosts.
.El
.It Ic listen on Ar address Oo Ic tls Oc Ic port Ar number
Set the listen address and port.
This statement can be specified multiple times.
.It Ic location Ar path Brq ...
Specify server configuration rules for a specific location.
The
.Ar path
argument will be matched against the request path with shell globbing rules.
In case of multiple location statements in the same context, the
first matching location statement will be put into effect, while all
later ones will be ignored.
Therefore it is advisable to match for more specific paths first
and for generic ones later on.
A location section may include most of the server configuration rules
except
.Ic alias ,
.Ic connection ,
.Ic hsts ,
.Ic listen on ,
.Ic location ,
.Ic tcp
and
.Ic tls .
.It Ic location match Ar path Brq ...
Like the
.Ic location
option,
but
.Ic match
the
.Ar path
using pattern matching instead of shell globbing rules,
see
.Xr patterns 7 .
The pattern may contain captures that can be used in the
.Ar uri
of an enclosed
.Ic block return
option.
.It Oo Ic no Oc Ic log Op Ar option
Set the specified logging options.
Logging is enabled by default using the standard
.Ic access
and
.Ic error
log files,
but can be changed per server or location.
Use the
.Ic no log
directive to disable logging of any requests.
Valid options are:
.Bl -tag -width Ds
.It Ic access Ar name
Set the
.Ar name
of the access log file relative to the log directory.
If not specified, it defaults to
.Pa access.log .
.It Ic error Ar name
Set the
.Ar name
of the error log file relative to the log directory.
If not specified, it defaults to
.Pa error.log .
.It Ic style Ar style
Set the logging style.
The
.Ar style
can be
.Cm common ,
.Cm combined
or
.Cm connection .
The styles
.Cm common
and
.Cm combined
write a log entry after each request similar to the standard Apache
and nginx access log formats.
The style
.Cm connection
writes a summarized log entry after each connection,
that can have multiple requests,
similar to the format that is used by
.Xr relayd 8 .
If not specified, the default is
.Cm common .
.It Oo Ic no Oc Ic syslog
Enable or disable logging to
.Xr syslog 3
instead of the log files.
.El
.It Ic pass
Disable any previous
.Ic block
in a location.
.It Ic root Ar option
Configure the document root and options for the request path.
Valid options are:
.Bl -tag -width Ds
.It Ar directory
Set the document root of the server.
The
.Ar directory
is a pathname within the
.Xr chroot 2
root directory of
.Nm httpd .
If not specified, it defaults to
.Pa /htdocs .
.It Ic strip Ar number
Strip
.Ar number
path components from the beginning of the request path before looking
up the stripped-down path at the document root.
.El
.It Ic tcp Ar option
Enable or disable the specified TCP/IP options; see
.Xr tcp 4
and
.Xr ip 4
for more information about the options.
Valid options are:
.Bl -tag -width Ds
.It Ic backlog Ar number
Set the maximum length the queue of pending connections may grow to.
The backlog option is 10 by default and is limited by the
.Va kern.somaxconn
.Xr sysctl 8
variable.
.It Ic ip minttl Ar number
This option for the underlying IP connection may be used to discard packets
with a TTL lower than the specified value.
This can be used to implement the
Generalized TTL Security Mechanism (GTSM)
according to RFC 5082.
.It Ic ip ttl Ar number
Change the default time-to-live value in the IP headers.
.It Oo Ic no Oc Ic nodelay
Enable the TCP NODELAY option for this connection.
This is recommended to avoid delays in the data stream.
.It Oo Ic no Oc Ic sack
Use selective acknowledgements for this connection.
.It Ic socket buffer Ar number
Set the socket-level buffer size for input and output for this
connection.
This will affect the TCP window size.
.El
.It Ic tls Ar option
Set the TLS configuration for the server.
These options are only used if TLS has been enabled via the listen directive.
Valid options are:
.Bl -tag -width Ds
.It Ic certificate Ar file
Specify the certificate to use for this server.
The
.Ar file
should contain a PEM encoded certificate.
The default is
.Pa /etc/ssl/server.crt .
.It Ic ciphers Ar string
Specify the TLS cipher string.
If not specified, the default value
.Qq HIGH:!aNULL
will be used (strong crypto cipher suites without anonymous DH).
See the CIPHERS section of
.Xr openssl 1
for information about SSL/TLS cipher suites and preference lists.
.It Ic dhe Ar params
Specify the DHE parameters to use for DHE cipher suites.
Valid parameter values are none, legacy and auto.
For legacy a fixed key length of 1024 bits is used, whereas for auto the key
length is determined automatically.
The default is none, which disables DHE cipher suites.
.It Ic ecdhe Ar curves
Specify a comma separated list of elliptic curves to use for ECDHE cipher suites,
in order of preference.
The special value of "default" will use the default curves, see
.Xr tls_config_set_ecdhecurves 3
for further details.
.It Ic key Ar file
Specify the private key to use for this server.
The
.Ar file
should contain a PEM encoded private key and reside outside of the
.Xr chroot 2
root directory of
.Nm httpd .
The default is
.Pa /etc/ssl/private/server.key .
.It Ic ocsp Ar file
Specify an OCSP response to be stapled during TLS handshakes
with this server.
The
.Ar file
should contain a DER-format OCSP response retrieved from an
OCSP server for the
.Ar certificate
in use.
The default is to not use OCSP stapling.
.It Ic protocols Ar string
Specify the TLS protocols to enable for this server.
If not specified, the value
.Qq default
will be used (secure protocols; TLSv1.2-only).
Refer to the
.Xr tls_config_parse_protocols 3
function for other valid protocol string values.
.It Ic ticket Ic lifetime Ar seconds
Enable TLS session tickets with a
.Ar seconds
session lifetime.
It is possible to set
.Ar seconds
to default to use the httpd default timeout of 2 hours.
.El
.El
.Sh TYPES
Configure the supported media types.
.Xr httpd 8
will set the
.Ar Content-Type
of the response header based on the file extension listed in the
.Ic types
section.
If not specified,
.Xr httpd 8
will use built-in media types for
.Ar text/css ,
.Ar text/html ,
.Ar text/plain ,
.Ar image/gif ,
.Ar image/png ,
.Ar image/jpeg ,
.Ar image/svg+xml ,
and
.Ar application/javascript .
.Pp
The
.Ic types
section must include one or more lines of the following syntax:
.Bl -tag -width Ds
.It Ar type/subtype Ar name Op Ar name ...
Set the media
.Ar type
and
.Ar subtype
to the specified extension
.Ar name .
One or more names can be specified per line.
Each line may end with an optional semicolon.
.It Ic include Ar file
Include types definitions from an external file, for example
.Pa /usr/share/misc/mime.types .
.El
.Sh EXAMPLES
The following example will start one server that is pre-forked two
times and is listening on all local IP addresses.
It additionally defines some media types overriding the defaults.
.Bd -literal -offset indent
prefork 2

server "default" {
	listen on * port 80
}

types {
	text/css		css
	text/html		html htm
	text/plain		txt
	image/gif		gif
	image/jpeg		jpeg jpg
	image/png		png
	application/javascript	js
	application/xml		xml
}
.Ed
.Pp
The server can also be configured to only listen on the primary IP
address of the network interface that is a member of the
.Qq egress
group.
.Bd -literal -offset indent
server "default" {
	listen on egress port 80
}
.Ed
.Pp
Multiple servers can be configured to support hosting of different domains.
If the same address is repeated multiple times in the
.Ic listen on
statement,
the server will be matched based on the requested host name.
.Bd -literal -offset indent
server "www.example.com" {
	alias "example.com"
	listen on * port 80
	listen on * tls port 443
	root "/htdocs/www.example.com"
}

server "www.a.example.com" {
	listen on 203.0.113.1 port 80
	root "/htdocs/www.a.example.com"
}

server "www.b.example.com" {
	listen on 203.0.113.1 port 80
	root "/htdocs/www.b.example.com"
}

server "intranet.example.com" {
	listen on 10.0.0.1 port 80
	root "/htdocs/intranet.example.com"
}
.Ed
.Pp
Simple redirections can be configured with the
.Ic block
directive:
.Bd -literal -offset indent
server "example.com" {
	listen on 10.0.0.1 port 80
	block return 301 "http://www.example.com$REQUEST_URI"
}

server "www.example.com" {
	listen on 10.0.0.1 port 80
}
.Ed
.Sh SEE ALSO
.Xr htpasswd 1 ,
.Xr patterns 7 ,
.Xr httpd 8 ,
.Xr ocspcheck 8 ,
.Xr slowcgi 8
.Sh AUTHORS
.An -nosplit
The
.Xr httpd 8
program was written by
.An Reyk Floeter Aq Mt reyk@@openbsd.org .
@


1.82
log
@image/svg+xml is a default inbuilt media type.
Pointed out by Anton Lindqvist (anton.lindqvist AT gmail), thanks!
@
text
@d1 1
a1 1
.\"	$OpenBSD: httpd.conf.5,v 1.81 2017/03/25 17:25:34 claudio Exp $
d17 1
a17 1
.Dd $Mdocdate: March 25 2017 $
d535 6
a540 4
.It Ic ecdhe Ar curve
Specify the ECDHE curve to use for ECDHE cipher suites.
Valid parameter values are none, auto and the short name of any known curve.
The default is auto.
@


1.81
log
@Implement TLS ticket support in httpd. Off by default. Use
	tls ticket lifetime default
to turn it on with a 2h ticket lifetime.
Rekeying happens after a quarter of that time.
OK reky@@ and bob@@
@
text
@d1 1
a1 1
.\"	$OpenBSD: httpd.conf.5,v 1.80 2017/03/16 10:18:11 florian Exp $
d17 1
a17 1
.Dd $Mdocdate: March 16 2017 $
d593 1
@


1.80
log
@Expand $HTTP_HOST in redirects.
From Rivo Nurges Rivo.Nurges AT smit.ee, thanks!
OK reyk
@
text
@d1 1
a1 1
.\"	$OpenBSD: httpd.conf.5,v 1.79 2017/02/07 12:27:42 reyk Exp $
d17 1
a17 1
.Dd $Mdocdate: February 7 2017 $
d567 7
@


1.79
log
@/tmp/cvsspEkok
@
text
@d1 1
a1 1
.\"	$OpenBSD: httpd.conf.5,v 1.78 2017/01/24 13:28:47 jmc Exp $
d17 1
a17 1
.Dd $Mdocdate: January 24 2017 $
d224 2
@


1.78
log
@sort SEE ALSO;
@
text
@d1 1
a1 1
.\"	$OpenBSD: httpd.conf.5,v 1.77 2017/01/24 12:37:00 beck Exp $
d243 5
d249 2
a250 1
Specify the inactivity timeout in seconds for accepted sessions.
@


1.77
log
@add ocspcheck to see also
@
text
@d1 1
a1 1
.\"	$OpenBSD: httpd.conf.5,v 1.76 2016/11/14 10:28:31 schwarze Exp $
d17 1
a17 1
.Dd $Mdocdate: November 14 2016 $
d677 2
a678 2
.Xr slowcgi 8 ,
.Xr ocspcheck 8
@


1.76
log
@specify ordering and precedence of location { } sections;
patch from grunk@@; feedback and OK jmc@@; OK florian@@
@
text
@d1 1
a1 1
.\"	$OpenBSD: httpd.conf.5,v 1.75 2016/11/06 11:27:04 jmc Exp $
d17 1
a17 1
.Dd $Mdocdate: November 6 2016 $
d677 2
a678 1
.Xr slowcgi 8
@


1.75
log
@tweak previous;
@
text
@d1 1
a1 1
.\"	$OpenBSD: httpd.conf.5,v 1.74 2016/11/06 10:49:38 beck Exp $
d361 5
@


1.74
log
@Add OCSP stapling support to httpd
ok jsing@@ bcook@@
@
text
@d1 1
a1 1
.\"	$OpenBSD: httpd.conf.5,v 1.73 2016/05/09 19:36:54 tj Exp $
d17 1
a17 1
.Dd $Mdocdate: May 9 2016 $
d541 1
a541 1
should contain a DER format OCSP response retrieved from an
d544 2
a545 2
in use. 
The default is to not to use OCSP stapling.
@


1.73
log
@in the http redirect example, also include the requested url instead
of just going to the home page.

requested by and ok beck
@
text
@d1 1
a1 1
.\"	$OpenBSD: httpd.conf.5,v 1.72 2016/04/28 22:16:41 schwarze Exp $
d17 1
a17 1
.Dd $Mdocdate: April 28 2016 $
d536 10
@


1.72
log
@Avoid unusual Content-Type: even in an example;
people might get hurt when doing copy & paste.
Patch from Hiltjo Posthuma <hiltjo at codemadness dot org>.
OK florian@@ jmc@@
@
text
@d1 1
a1 1
.\"	$OpenBSD: httpd.conf.5,v 1.71 2016/04/24 21:06:53 jmc Exp $
d17 1
a17 1
.Dd $Mdocdate: April 24 2016 $
d651 1
a651 1
	block return 301 "http://www.example.com/"
@


1.71
log
@new sentence, new line;
@
text
@d1 1
a1 1
.\"	$OpenBSD: httpd.conf.5,v 1.70 2016/04/24 20:12:25 chrisz Exp $
d597 1
a597 1
	text/txt		txt
@


1.70
log
@Document CGI variables. Work done by Tim Baumgard <openbsd@@bmgrd.com>
I clarified DOCUMENT_URI and SCRIPT_NAME.

ok florian@@
@
text
@d1 1
a1 1
.\"	$OpenBSD: httpd.conf.5,v 1.69 2016/04/20 12:48:54 jmc Exp $
d17 1
a17 1
.Dd $Mdocdate: April 20 2016 $
d293 2
a294 2
when the server has been configured to use TLS. This variable is
omitted otherwise.
d299 2
a300 1
directory index file name appended. This is the same as
d315 2
a316 1
The optional query string of the request. This variable is an empty
@


1.69
log
@from tim baumgard: a location section may not include hsts;
to that, i've added alias and tls

no feedback on this diff, so let's hope i'm right/.
@
text
@d1 1
a1 1
.\"	$OpenBSD: httpd.conf.5,v 1.68 2015/07/19 05:17:27 reyk Exp $
d17 1
a17 1
.Dd $Mdocdate: July 19 2015 $
d277 59
@


1.68
log
@For the completeness of HSTS, add the non-standard preload option.

OK florian@@
@
text
@d1 1
a1 1
.\"	$OpenBSD: httpd.conf.5,v 1.67 2015/07/18 09:29:47 jmc Exp $
d17 1
a17 1
.Dd $Mdocdate: July 18 2015 $
d302 1
d304 1
d306 2
a307 1
.Ic location
d309 1
a309 1
.Ic tcp .
@


1.67
log
@tweak previous;
@
text
@d1 1
a1 1
.\"	$OpenBSD: httpd.conf.5,v 1.66 2015/07/18 06:00:43 reyk Exp $
d285 3
@


1.66
log
@Allow to change the default media type globally or per-location,
eg. default type text/html.

OK florian@@
@
text
@d1 1
a1 1
.\"	$OpenBSD: httpd.conf.5,v 1.65 2015/07/18 05:41:18 florian Exp $
d283 1
a283 1
this host as a HSTS host.
@


1.65
log
@Implement HTTP Strict Transport Security (HSTS).
Input & OK reyk
@
text
@d1 1
a1 1
.\"	$OpenBSD: httpd.conf.5,v 1.64 2015/07/15 17:10:47 jsing Exp $
d17 1
a17 1
.Dd $Mdocdate: July 15 2015 $
d115 9
d248 3
@


1.64
log
@Document default locations for TLS certificate and key.

ok reyk@@
@
text
@d1 1
a1 1
.\"	$OpenBSD: httpd.conf.5,v 1.63 2015/06/23 17:29:19 jmc Exp $
d17 1
a17 1
.Dd $Mdocdate: June 23 2015 $
d265 12
@


1.63
log
@various tweaks;
@
text
@d1 1
a1 1
.\"	$OpenBSD: httpd.conf.5,v 1.62 2015/06/23 15:23:14 reyk Exp $
d415 2
d443 2
@


1.62
log
@Add initial support for pattern matching using Lua's pattern matching code.

With important help on the pattern matcher from semarie@@

OK semarie@@
@
text
@d1 1
a1 1
.\"	$OpenBSD: httpd.conf.5,v 1.61 2015/05/28 19:29:40 jmc Exp $
d17 1
a17 1
.Dd $Mdocdate: May 28 2015 $
d215 1
a215 1
.It Ic Pf % Ar n
@


1.61
log
@use "uri"; from yegor timoschenko
@
text
@d1 1
a1 1
.\"	$OpenBSD: httpd.conf.5,v 1.60 2015/05/19 18:16:32 sobrado Exp $
d17 1
a17 1
.Dd $Mdocdate: May 19 2015 $
d134 16
a149 3
must have a
.Ar name
and include one or more lines of the following syntax:
d155 11
d215 6
d280 16
d565 1
@


1.60
log
@better spacing in media types.

ok reyk@@
@
text
@d1 1
a1 1
.\"	$OpenBSD: httpd.conf.5,v 1.59 2015/05/19 18:12:58 sobrado Exp $
d155 1
a155 1
.It Ic block Op Ic return Ar code Op uri
d169 1
a169 1
.Ar url
@


1.59
log
@sort media type extensions for text/html and image/jpeg as given in
/usr/share/misc/mime.types; do not include shtml as it is for Server
Side Includes (SSI) -- we will never do SSI.

joint work with reyk@@

ok reyk@@
@
text
@d1 1
a1 1
.\"	$OpenBSD: httpd.conf.5,v 1.58 2015/05/19 18:03:32 sobrado Exp $
d454 8
a461 8
	text/css			css
	text/html			html htm
	text/txt			txt
	image/gif			gif
	image/jpeg			jpeg jpg
	image/png			png
	application/javascript		js
	application/xml			xml
@


1.58
log
@drop comment about being possible to include /etc/nginx/mime.types,
we do not have to care about nginx anymore.

ok jmc@@ (who thinks previously suggested removing it), and reyk@@
@
text
@d1 1
a1 1
.\"	$OpenBSD: httpd.conf.5,v 1.57 2015/03/26 19:16:57 jmc Exp $
d17 1
a17 1
.Dd $Mdocdate: March 26 2015 $
d455 1
a455 1
	text/html			htm html
d458 1
a458 1
	image/jpeg			jpg jpeg
@


1.57
log
@pointers to slowcgi(8); from alexei malinin
@
text
@d1 1
a1 1
.\"	$OpenBSD: httpd.conf.5,v 1.56 2015/03/11 21:52:20 reyk Exp $
d17 1
a17 1
.Dd $Mdocdate: March 11 2015 $
a515 8
.Ed
.Pp
The syntax of the types section is also compatible with the format
used by nginx, so it is possible to include its
.Pa mime.types
file directly:
.Bd -literal -offset indent
include "/etc/nginx/mime.types"
@


1.56
log
@Wrap long line.  This is another airplane commit from an 747-8
somewhere over Siberia and I think I'm just getting into minor
turbulences.
@
text
@d1 1
a1 1
.\"	$OpenBSD: httpd.conf.5,v 1.55 2015/03/09 15:51:17 reyk Exp $
d17 1
a17 1
.Dd $Mdocdate: March 9 2015 $
d527 2
a528 1
.Xr httpd 8
@


1.55
log
@Document the TLSv1.2-only change.

Figured out sthen@@
@
text
@d1 1
a1 1
.\"	$OpenBSD: httpd.conf.5,v 1.54 2015/03/06 05:10:18 reyk Exp $
d17 1
a17 1
.Dd $Mdocdate: March 6 2015 $
d518 2
a519 2
The syntax of the types section is also compatible with the format used by nginx,
so it is possible to include its
@


1.54
log
@Fix minor manpage bug: it is a server, not a relay.

OK deraadt@@
@
text
@d1 1
a1 1
.\"	$OpenBSD: httpd.conf.5,v 1.53 2015/02/23 18:43:18 reyk Exp $
d17 1
a17 1
.Dd $Mdocdate: February 23 2015 $
d397 3
a399 3
If not specified, the default value
.Qq all
will be used (all available protocols).
@


1.53
log
@Allow to specify CGI variables as macros in redirection strings, eg.
block return 301 "http://www.example.com/$REQUEST_URI"

OK tedu@@ florian@@
@
text
@d1 1
a1 1
.\"	$OpenBSD: httpd.conf.5,v 1.52 2015/02/19 09:19:01 florian Exp $
d17 1
a17 1
.Dd $Mdocdate: February 19 2015 $
d186 1
a186 1
The configured IP address of the relay.
d188 1
a188 1
The configured TCP server port of the relay.
@


1.52
log
@Typo.
From Navan Carson, thanks!
@
text
@d1 1
a1 1
.\"	$OpenBSD: httpd.conf.5,v 1.51 2015/02/15 13:43:32 jsing Exp $
d17 1
a17 1
.Dd $Mdocdate: February 15 2015 $
d167 25
@


1.51
log
@Document the tls protocols option.
@
text
@d1 1
a1 1
.\"	$OpenBSD: httpd.conf.5,v 1.50 2015/02/07 08:12:30 jmc Exp $
d17 1
a17 1
.Dd $Mdocdate: February 7 2015 $
d160 1
a160 1
.Sq 404 Forbidden
@


1.50
log
@double word fix;
@
text
@d1 1
a1 1
.\"	$OpenBSD: httpd.conf.5,v 1.49 2015/02/07 06:46:01 jsing Exp $
d370 8
@


1.49
log
@Document tls dhe and tls ecdhe options.
@
text
@d1 1
a1 1
.\"	$OpenBSD: httpd.conf.5,v 1.48 2015/02/07 01:23:12 reyk Exp $
d360 1
a360 1
Valid parameter values are none, auto and the short name of any any known curve.
@


1.48
log
@Add support for blocking, dropping, and redirecting requests.

OK florian@@
@
text
@d1 1
a1 1
.\"	$OpenBSD: httpd.conf.5,v 1.47 2015/01/19 19:37:50 reyk Exp $
d17 1
a17 1
.Dd $Mdocdate: January 19 2015 $
d352 10
@


1.47
log
@Decouple auth parameters from struct server_config into struct auth.

OK florian@@
@
text
@d1 1
a1 1
.\"	$OpenBSD: httpd.conf.5,v 1.46 2015/01/18 18:39:46 florian Exp $
d17 1
a17 1
.Dd $Mdocdate: January 18 2015 $
d153 14
d278 4
d458 14
@


1.46
log
@tweak previous
with help from jmc@@
@
text
@d1 1
a1 1
.\"	$OpenBSD: httpd.conf.5,v 1.45 2015/01/18 14:01:17 florian Exp $
d142 1
a142 1
.It Ic authenticate Oo Ar realm Oc Ic with Pa htpasswd
d150 3
@


1.45
log
@First stab at implementing basic auth.
Currently the htpasswd file needs to be in the chroot; will hopefully
improved soonish.
Based on a diff from Oscar Linderholm many months ago but turned into
a complete rewrite.
input/OK reyk@@
@
text
@d1 1
a1 1
.\"	$OpenBSD: httpd.conf.5,v 1.44 2015/01/13 09:21:15 reyk Exp $
d17 1
a17 1
.Dd $Mdocdate: January 13 2015 $
d147 3
a149 4
This file needs to be readable by the user
.Xr httpd 8
drops to
.Pq www by default Pc .
@


1.44
log
@bump copyright year
@
text
@d1 1
a1 1
.\"	$OpenBSD: httpd.conf.5,v 1.43 2015/01/05 11:03:57 reyk Exp $
d17 1
a17 1
.Dd $Mdocdate: January 5 2015 $
d142 9
d449 1
@


1.43
log
@Be more specific: path is a component of the URI/URL, so use "path"
instead of "URI" or "URL" when referring to it.
@
text
@d1 1
a1 1
.\"	$OpenBSD: httpd.conf.5,v 1.42 2015/01/04 22:23:58 chrisz Exp $
d3 1
a3 1
.\" Copyright (c) 2014 Reyk Floeter <reyk@@openbsd.org>
d17 1
a17 1
.Dd $Mdocdate: January 4 2015 $
@


1.42
log
@add new url stripping option:

strip number
	Strip number path components from the beginning of the
	request URI before looking up the stripped-down URI at
	the document root.


reviewed with much patience and OK by reyk@@
@
text
@d1 1
a1 1
.\"	$OpenBSD: httpd.conf.5,v 1.41 2015/01/03 15:49:18 reyk Exp $
d17 1
a17 1
.Dd $Mdocdate: January 3 2015 $
d192 1
a192 1
argument will be matched against the URL path with shell globbing rules.
d254 1
d270 2
a271 2
path components from the beginning of the request URI before
looking up the stripped-down URI at the document root.
@


1.41
log
@Support alias names and multiple listen statements per server block.
The implementation is done in the parser by expanding each
alias/listen into an independent server configuration; this makes it
easier to handle internally without adding additional loops or
conditions.

OK florian@@
@
text
@d1 1
a1 1
.\"	$OpenBSD: httpd.conf.5,v 1.40 2014/12/28 13:53:23 reyk Exp $
d17 1
a17 1
.Dd $Mdocdate: December 28 2014 $
d253 4
a256 1
.It Ic root Ar directory
d266 6
@


1.40
log
@Change the default example from "listen on egress" to "listen on *".
Listening on the egress group only works if you have a default route;
this confused some people.
@
text
@d1 1
a1 1
.\"	$OpenBSD: httpd.conf.5,v 1.39 2014/12/18 10:18:25 reyk Exp $
d17 1
a17 1
.Dd $Mdocdate: December 18 2014 $
d138 4
d187 1
d399 7
@


1.39
log
@Document * and :: to listen on all IPv4 or IPv6 addresses.
@
text
@d1 1
a1 1
.\"	$OpenBSD: httpd.conf.5,v 1.38 2014/12/18 09:00:19 reyk Exp $
d357 1
a357 4
times and listening on the primary IP address of the network interface
that is a member of the
.Qq egress
group.
d363 1
a363 1
	listen on egress port 80
d375 10
@


1.38
log
@"tcp nodelay" shouldn't be discussing relaying SSH; this was a remnant
from relayd.conf.5.

From Ross L Richardson
@
text
@d1 1
a1 1
.\"	$OpenBSD: httpd.conf.5,v 1.37 2014/12/12 14:45:59 reyk Exp $
d17 1
a17 1
.Dd $Mdocdate: December 12 2014 $
d52 9
@


1.37
log
@Like previously done in relayd, change the keyword "ssl" to "tls" to
reflect reality.

OK benno@@
@
text
@d1 1
a1 1
.\"	$OpenBSD: httpd.conf.5,v 1.36 2014/11/12 16:52:44 jmc Exp $
d17 1
a17 1
.Dd $Mdocdate: November 12 2014 $
d273 1
a273 2
This is recommended to avoid delays in the relayed data stream,
e.g. for SSH connections.
@


1.36
log
@tweak previous;
@
text
@d1 1
a1 1
.\"	$OpenBSD: httpd.conf.5,v 1.35 2014/11/11 15:54:45 beck Exp $
d17 1
a17 1
.Dd $Mdocdate: November 11 2014 $
d172 1
a172 1
.It Ic listen on Ar address Oo Ic ssl Oc Ic port Ar number
a248 27
.It Ic ssl Ar option
Set the SSL configuration for the server.
These options are only used if SSL has been enabled via the listen directive.
Valid options are:
.Bl -tag -width Ds
.It Ic certificate Ar file
Specify the certificate to use for this server.
The
.Ar file
should contain a PEM encoded certificate.
.It Ic ciphers Ar string
Specify the SSL cipher string.
If not specified, the default value
.Qq HIGH:!aNULL
will be used (strong crypto cipher suites without anonymous DH).
See the CIPHERS section of
.Xr openssl 1
for information about SSL cipher suites and preference lists.
.It Ic key Ar file
Specify the private key to use for this server.
The
.Ar file
should contain a PEM encoded private key and reside outside of the
.Xr chroot 2
root directory of
.Nm httpd .
.El
d281 27
@


1.35
log
@Allow the log directory to be configurable in the config file, rather than
fixed as /logs within the chroot.  As this httpd is properly privesp'ed this
has the nice property of allowing us to put the logs outside the chroot if
we want to.
ok reyk@@
@
text
@d1 1
a1 1
.\"	$OpenBSD: httpd.conf.5,v 1.34 2014/09/01 12:22:38 jmc Exp $
d17 1
a17 1
.Dd $Mdocdate: September 1 2014 $
d106 7
d119 1
a119 7
.It Ic logdir Ar directory
Specifies the full path of the directory in which log files will be written. 
If not specified, it defaults to
.Pa /logs
within the
.Xr chroot 2
directory.
@


1.34
log
@remove Xr, but not the reference, to nginx, after some discussion with reyk;
@
text
@d1 1
a1 1
.\"	$OpenBSD: httpd.conf.5,v 1.33 2014/08/25 14:27:54 reyk Exp $
d17 1
a17 1
.Dd $Mdocdate: August 25 2014 $
d112 7
a118 1
.El
@


1.33
log
@Add a generic system-wide /usr/share/misc/mime.types file that can be
included in httpd.conf.  httpd(8) now supports both mime.types
flavours with or without semicolon at the end of the line (nginx- or
apache-style).

Discussed with many, with input from halex@@
OK halex@@
@
text
@d1 1
a1 1
.\"	$OpenBSD: httpd.conf.5,v 1.32 2014/08/17 18:46:29 jmc Exp $
d17 1
a17 1
.Dd $Mdocdate: August 17 2014 $
d388 1
a388 2
The syntax of the types section is also compatible with the format used by
.Xr nginx 8 ,
@


1.32
log
@don;t mark up {};
@
text
@d1 1
a1 1
.\"	$OpenBSD: httpd.conf.5,v 1.31 2014/08/09 09:07:14 jmc Exp $
d17 1
a17 1
.Dd $Mdocdate: August 9 2014 $
d327 1
a327 1
.It Ar type/subtype Ar name Op Ar name ... ;
d335 4
d355 8
a362 8
	text/css			css;
	text/html			htm html;
	text/txt			txt;
	image/gif			gif;
	image/jpeg			jpg jpeg;
	image/png			png;
	application/javascript		js;
	application/xml			xml;
d388 1
a388 1
The syntax of the types section is compatible with the format used by
@


1.31
log
@some minor tweaks;
@
text
@d1 1
a1 1
.\"	$OpenBSD: httpd.conf.5,v 1.30 2014/08/09 08:54:03 jmc Exp $
d167 1
a167 1
.It Ic location Ar path { ... }
@


1.30
log
@sort "prefork", and remove a useless macro;
@
text
@d1 1
a1 1
.\"	$OpenBSD: httpd.conf.5,v 1.29 2014/08/06 20:29:54 reyk Exp $
d17 1
a17 1
.Dd $Mdocdate: August 6 2014 $
d83 2
a84 2
.Ic table ,
.Ic relay ,
d86 1
a86 1
.Ic timeout ) .
d128 1
a128 3
The default value is
.Ar 1048576
bytes (1M).
d133 1
a133 2
The default maximum number of requests per connection is
.Ar 100 .
d152 1
a152 1
.Nm httpd
d162 1
a162 1
.Nm httpd
d209 2
a210 2
.Ar common ,
.Ar combined
d212 1
a212 1
.Ar connection .
d214 1
a214 1
.Ar common
d216 1
a216 1
.Ar combined
d220 1
a220 1
.Ar connection
d226 1
a226 1
.Ar common .
d228 3
a230 1
Enable or disable logging to syslog instead of the log files.
d255 1
a255 1
.Ar HIGH:!aNULL
d280 1
a280 1
.Ic kern.somaxconn
d291 1
a291 4
.It Xo
.Op Ic no
.Ic nodelay
.Xc
d295 1
a295 4
.It Xo
.Op Ic no
.Ic sack
.Xc
d305 1
a305 1
.Nm httpd
d312 1
a312 1
.Nm httpd
d340 1
a340 1
.Ar egress
@


1.29
log
@Change grammar to remove a shift/reduce conflict that was introduced
with the ssl options.
"listen on $ip port 443 ssl" turns into "listen on $ip ssl port 443".

ok florian@@
@
text
@d1 1
a1 1
.\"	$OpenBSD: httpd.conf.5,v 1.28 2014/08/06 18:21:14 reyk Exp $
a98 6
.It Ic prefork Ar number
Run the specified number of server processes.
This increases the performance and prevents delays when connecting
to a server.
.Xr httpd 8
runs 3 server processes by default.
d106 6
d288 1
a288 1
.Ar Generalized TTL Security Mechanism (GTSM)
@


1.28
log
@Limit the body size in client requests (eg. POST data) to 1M by default;
add a configuration option to change the limit.

ok florian@@
@
text
@d1 1
a1 1
.\"	$OpenBSD: httpd.conf.5,v 1.27 2014/08/06 16:31:09 jsing Exp $
d168 1
a168 1
.It Ic listen on Ar address Ic port Ar number Op Ic ssl
@


1.27
log
@Document the SSL configuration for httpd (partly based on relayd.conf(5)).
@
text
@d1 1
a1 1
.\"	$OpenBSD: httpd.conf.5,v 1.26 2014/08/05 18:01:10 reyk Exp $
d17 1
a17 1
.Dd $Mdocdate: August 5 2014 $
d126 5
@


1.26
log
@Add configuration options for the most-important connection limits:
max requests (per connection) and timeout.  We don't want to add too
many button, and there are good defaults, but these ones are kind of
mandatory.
@
text
@d1 1
a1 1
.\"	$OpenBSD: httpd.conf.5,v 1.25 2014/08/05 17:13:16 reyk Exp $
d238 27
@


1.25
log
@Tweak the httpd.conf manpage with "sub-lists".
@
text
@d1 1
a1 1
.\"	$OpenBSD: httpd.conf.5,v 1.24 2014/08/05 17:03:21 reyk Exp $
d122 15
d170 1
a170 1
A location section may include all of the server configuration rules
d172 1
@


1.24
log
@Bring back the tcp/ip configuration options.  This code was already
there and is from relayd.  We can decide later which options should
be added or removed, but it shouldn't do any harm.
@
text
@d1 1
a1 1
.\"	$OpenBSD: httpd.conf.5,v 1.23 2014/08/05 15:36:59 reyk Exp $
d122 5
a126 1
.It Ic directory Oo Ic no Oc Ic auto index
d129 1
a129 1
.It Ic directory Ic index Ar string
d133 1
a133 1
.It Ic directory no index
d137 1
d161 14
a174 1
.It Ic log access Ar name
d180 1
a180 1
.It Ic log error Ar name
d186 1
a186 1
.It Ic log style Ar style
d209 1
a209 1
.It Ic log Oo Ic no Oc Ic syslog
d211 1
a211 2
.It Ic no log
Disable logging.
@


1.23
log
@Improve logging to allow per- server/location log files.  The log
files can also be owned by root now: they're opened by the parent and
send to the logger process with fd passing.  This also works with reload.

ok deraadt@@
@
text
@d1 1
a1 1
.\"	$OpenBSD: httpd.conf.5,v 1.22 2014/08/05 09:24:21 jsg Exp $
d152 2
a153 1
.Ic listen on
d155 1
a155 1
.Ic location .
d205 39
@


1.22
log
@add a config option to specify the chroot directory
ok reyk@@
@
text
@d1 1
a1 1
.\"	$OpenBSD: httpd.conf.5,v 1.21 2014/08/04 17:38:12 reyk Exp $
d17 1
a17 1
.Dd $Mdocdate: August 4 2014 $
d155 13
a167 1
.It Ic log style Op Ar style
@


1.21
log
@Proxy commit for jsing@@:
"Add TLS/SSL support to httpd, based on the recent ressl commits."

From jsing@@
ok reyk@@
@
text
@d1 1
a1 1
.\"	$OpenBSD: httpd.conf.5,v 1.20 2014/08/04 17:12:44 reyk Exp $
d105 7
@


1.20
log
@manpage tweaks about logging
@
text
@d1 1
a1 1
.\"	$OpenBSD: httpd.conf.5,v 1.19 2014/08/04 15:49:28 reyk Exp $
d136 1
a136 1
.It Ic listen on Ar address Ic port Ar number
@


1.19
log
@Add initial support for log files in /var/www/logs/.  Logging with
syslog is still supported but disabled by default.

ok deraadt@@
@
text
@d1 1
a1 1
.\"	$OpenBSD: httpd.conf.5,v 1.18 2014/08/03 10:26:43 reyk Exp $
d17 1
a17 1
.Dd $Mdocdate: August 3 2014 $
d148 2
a149 2
.It Oo Ic no Oc Ic log style Op Ar style
Enable writing an access log to the log files or syslog.
d171 4
a174 2
.It Oo Ic no Oc Ic log syslog
Log to syslog instead of the log files.
@


1.18
log
@Add another log mode "connection" for a relayd(8)-style log entry after
each connection, not every request.  The code was already there and enabled
on debug, I just turned it into an alternative log format.
@
text
@d1 1
a1 1
.\"	$OpenBSD: httpd.conf.5,v 1.17 2014/08/02 21:21:47 doug Exp $
d17 1
a17 1
.Dd $Mdocdate: August 2 2014 $
d148 2
a149 2
.It Oo Ic no Oc Ic log Op Ar style
Enable writing an access log to syslog.
d171 2
@


1.17
log
@Locations now inherit access log settings from the server.

Add log to the server flags.

input/"Looks ok" reyk@@
@
text
@d1 1
a1 1
.\"	$OpenBSD: httpd.conf.5,v 1.16 2014/08/02 10:24:36 reyk Exp $
d153 5
d159 10
a168 3
or
.Ar combined .
It is similar to the default Apache and nginx access log.
@


1.16
log
@'fastcgi socket "path"' is the correct syntax; update the manpage.
Found by jsg@@
@
text
@d1 1
a1 1
.\"	$OpenBSD: httpd.conf.5,v 1.15 2014/08/02 08:07:07 jmc Exp $
d156 1
a156 1
It is similar to the Apache and nginx logging format.
@


1.15
log
@remove nasty unclosed Xo in previous; ok reyk
@
text
@d1 1
a1 1
.\"	$OpenBSD: httpd.conf.5,v 1.14 2014/08/01 21:59:56 reyk Exp $
d17 1
a17 1
.Dd $Mdocdate: August 1 2014 $
d126 1
a126 1
.It Oo Ic no Oc Ic fastcgi Op Ar socket
@


1.14
log
@remove the global "log updates/all" option that came from relayd.
@
text
@d1 1
a1 1
.\"	$OpenBSD: httpd.conf.5,v 1.13 2014/08/01 21:51:02 doug Exp $
a98 1
.It Xo
@


1.13
log
@Add common and combined access logging to httpd.

ok reyk@@
@
text
@d1 1
a1 1
.\"	$OpenBSD: httpd.conf.5,v 1.12 2014/07/31 14:18:38 reyk Exp $
d17 1
a17 1
.Dd $Mdocdate: July 31 2014 $
a99 4
.Ic log
.Pq Ic updates Ns | Ns Ic all
.Xc
Set logging verbosity.
@


1.12
log
@Allow to specify a non-default fastcgi socket.
@
text
@d1 1
a1 1
.\"	$OpenBSD: httpd.conf.5,v 1.11 2014/07/31 09:34:57 reyk Exp $
d153 11
@


1.11
log
@Add a configuration variable "fastcgi" to enable it per server or location.
@
text
@d1 1
a1 1
.\"	$OpenBSD: httpd.conf.5,v 1.10 2014/07/30 10:05:14 reyk Exp $
d17 1
a17 1
.Dd $Mdocdate: July 30 2014 $
d131 1
a131 1
.It Oo Ic no Oc Ic fastcgi
d133 8
@


1.10
log
@Add "location" keyword to specify path-specific configuration in
servers, for example auto index for a sub-directory only.  Internally,
a "location" is just a special type of a "virtual" server.
@
text
@d1 1
a1 1
.\"	$OpenBSD: httpd.conf.5,v 1.9 2014/07/30 09:51:40 reyk Exp $
d131 2
@


1.9
log
@Small fix and clarification
@
text
@d1 1
a1 1
.\"	$OpenBSD: httpd.conf.5,v 1.8 2014/07/29 16:17:28 reyk Exp $
d17 1
a17 1
.Dd $Mdocdate: July 29 2014 $
d133 10
@


1.8
log
@Add extended directory index options: "[no] index" and "[no] auto index".
The option "directory auto index" implements basic directory listing
and is turned off by default.

ok deraadt@@
@
text
@d1 1
a1 1
.\"	$OpenBSD: httpd.conf.5,v 1.7 2014/07/25 17:49:11 reyk Exp $
d17 1
a17 1
.Dd $Mdocdate: July 25 2014 $
d92 1
a92 1
server \*(Ltwww\*(Gt {
d114 5
a118 1
The following general server options are available:
@


1.7
log
@Add multiple-servers "virtual hosts" example.
@
text
@d1 1
a1 1
.\"	$OpenBSD: httpd.conf.5,v 1.6 2014/07/25 15:47:11 reyk Exp $
d114 1
a114 1
The following general table options are available:
d116 11
@


1.6
log
@Add and document 'root' configuration option for the docroot.
@
text
@d1 1
a1 1
.\"	$OpenBSD: httpd.conf.5,v 1.5 2014/07/22 19:03:21 jmc Exp $
d17 1
a17 1
.Dd $Mdocdate: July 22 2014 $
d163 3
a165 3
The following example will start two pre-forked servers that are
listening on the primary IP address of the network interface that is a
member of the
d185 22
@


1.5
log
@some minor fixes;
@
text
@d1 1
a1 1
.\"	$OpenBSD: httpd.conf.5,v 1.4 2014/07/22 18:31:16 ajacoutot Exp $
d118 10
@


1.4
log
@Typo.

no ok needed miod@@ guenther@@
@
text
@d1 1
a1 1
.\"	$OpenBSD: httpd.conf.5,v 1.3 2014/07/17 11:32:14 stsp Exp $
d17 1
a17 1
.Dd $Mdocdate: July 17 2014 $
d124 1
a124 1
of the response header based on the file extension that is listed in the
d143 1
a143 1
.It Ar type/subtype Ar name Oo Ar name ... Oc Ic ;
d178 1
a178 1
The syntax of the types section is compatible to the format that is used by
d180 1
a180 1
so you can optionally include its
d187 1
a187 1
.Xr httpd 8 .
@


1.3
log
@Fix typo in example httpd config which caused error on startup.
/etc/httpd.conf:8: failed to add media type
ok reyk
@
text
@d1 1
a1 1
.\"	$OpenBSD: httpd.conf.5,v 1.2 2014/07/13 14:17:37 reyk Exp $
d17 1
a17 1
.Dd $Mdocdate: July 13 2014 $
d152 1
a152 1
.Sh EAMPLES
@


1.2
log
@Add support for media types (aka. MIME types): the types section is
compatible to nginx' mime.types file which can be included directly.
If not present, use a few built-in defaults for html, css, txt, jpeg,
gif, png, and js.
@
text
@d1 1
a1 1
.\"	$OpenBSD: httpd.conf.5,v 1.1 2014/07/12 23:34:54 reyk Exp $
d17 1
a17 1
.Dd $Mdocdate: July 12 2014 $
d168 1
a168 1
	text/html			html html;
@


1.1
log
@Add httpd(8), an attempt to turn the relayd(8) codebase into a simple
web server.  It is not finished yet and I just started it today, but
the goal is to provide an HTTP server that a) provides minimal
features, b) serves static files, c) provides FastCGI support, and d)
follows common coding practices of OpenBSD.

It will neither support plugins, nor custom memory allocators, EBCDIC
support, PCRE or any other things that can be found elsewhere.
httpd(8) is not intended to provide a fully-featured replacement for
nginx(8) or the Apache, but it will provide enough functionality that
is needed in the OpenBSD base system.

ok deraadt@@
@
text
@d1 1
a1 1
.\"	$OpenBSD$
d29 1
a29 1
is divided into three main sections:
d39 2
d119 67
@

