head	1.15;
access;
symbols
	OPENBSD_5_5:1.14.0.46
	OPENBSD_5_5_BASE:1.14
	OPENBSD_5_4:1.14.0.42
	OPENBSD_5_4_BASE:1.14
	OPENBSD_5_3:1.14.0.40
	OPENBSD_5_3_BASE:1.14
	OPENBSD_5_2:1.14.0.38
	OPENBSD_5_2_BASE:1.14
	OPENBSD_5_1_BASE:1.14
	OPENBSD_5_1:1.14.0.36
	OPENBSD_5_0:1.14.0.34
	OPENBSD_5_0_BASE:1.14
	OPENBSD_4_9:1.14.0.32
	OPENBSD_4_9_BASE:1.14
	OPENBSD_4_8:1.14.0.30
	OPENBSD_4_8_BASE:1.14
	OPENBSD_4_7:1.14.0.26
	OPENBSD_4_7_BASE:1.14
	OPENBSD_4_6:1.14.0.28
	OPENBSD_4_6_BASE:1.14
	OPENBSD_4_5:1.14.0.24
	OPENBSD_4_5_BASE:1.14
	OPENBSD_4_4:1.14.0.22
	OPENBSD_4_4_BASE:1.14
	OPENBSD_4_3:1.14.0.20
	OPENBSD_4_3_BASE:1.14
	OPENBSD_4_2:1.14.0.18
	OPENBSD_4_2_BASE:1.14
	OPENBSD_4_1:1.14.0.16
	OPENBSD_4_1_BASE:1.14
	OPENBSD_4_0:1.14.0.14
	OPENBSD_4_0_BASE:1.14
	OPENBSD_3_9:1.14.0.12
	OPENBSD_3_9_BASE:1.14
	OPENBSD_3_8:1.14.0.10
	OPENBSD_3_8_BASE:1.14
	OPENBSD_3_7:1.14.0.8
	OPENBSD_3_7_BASE:1.14
	OPENBSD_3_6:1.14.0.6
	OPENBSD_3_6_BASE:1.14
	OPENBSD_3_5:1.14.0.4
	OPENBSD_3_5_BASE:1.14
	apache_1_3_29-mod_ssl_2_8_16:1.1.1.4
	OPENBSD_3_4:1.14.0.2
	OPENBSD_3_4_BASE:1.14
	apache_1_3_28-mod_ssl_2_8_15:1.1.1.4
	OPENBSD_3_3:1.13.0.2
	OPENBSD_3_3_BASE:1.13
	apache_1_3_27-mod_ssl_2_8_12:1.1.1.3
	apache_1_3_27:1.1.1.3
	OPENBSD_3_2:1.12.0.2
	OPENBSD_3_2_BASE:1.12
	apache_1_3_26:1.1.1.2
	OPENBSD_3_1:1.11.0.2
	OPENBSD_3_1_BASE:1.11
	OPENBSD_3_0:1.9.0.4
	OPENBSD_3_0_BASE:1.9
	OPENBSD_2_9_BASE:1.9
	OPENBSD_2_9:1.9.0.2
	OPENBSD_2_8:1.7.0.4
	OPENBSD_2_8_BASE:1.7
	OPENBSD_2_7:1.7.0.2
	OPENBSD_2_7_BASE:1.7
	OPENBSD_2_6:1.4.0.2
	OPENBSD_2_6_BASE:1.4
	OPENBSD_2_5:1.3.0.2
	OPENBSD_2_5_BASE:1.3
	OPENBSD_2_4:1.1.1.1.0.2
	OPENBSD_2_4_BASE:1.1.1.1
	apache_1_3_2:1.1.1.1
	apache:1.1.1;
locks; strict;
comment	@# @;


1.15
date	2014.04.22.14.47.23;	author henning;	state dead;
branches;
next	1.14;

1.14
date	2003.08.21.13.10.20;	author henning;	state Exp;
branches;
next	1.13;

1.13
date	2002.11.22.16.18.53;	author pb;	state Exp;
branches;
next	1.12;

1.12
date	2002.07.19.21.31.13;	author henning;	state Exp;
branches;
next	1.11;

1.11
date	2002.03.29.02.08.03;	author beck;	state Exp;
branches;
next	1.10;

1.10
date	2002.02.12.07.56.46;	author beck;	state Exp;
branches;
next	1.9;

1.9
date	2001.03.29.10.21.22;	author beck;	state Exp;
branches;
next	1.8;

1.8
date	2000.12.18.20.49.13;	author beck;	state Exp;
branches;
next	1.7;

1.7
date	2000.03.19.11.16.14;	author beck;	state Exp;
branches;
next	1.6;

1.6
date	2000.01.28.18.24.19;	author beck;	state Exp;
branches;
next	1.5;

1.5
date	99.11.23.02.28.32;	author deraadt;	state Exp;
branches;
next	1.4;

1.4
date	99.09.29.06.42.44;	author beck;	state Exp;
branches;
next	1.3;

1.3
date	99.03.01.04.27.47;	author beck;	state Exp;
branches;
next	1.2;

1.2
date	99.03.01.01.04.51;	author beck;	state Exp;
branches;
next	1.1;

1.1
date	98.10.01.17.19.33;	author beck;	state Exp;
branches
	1.1.1.1;
next	;

1.1.1.1
date	98.10.01.17.19.33;	author beck;	state Exp;
branches;
next	1.1.1.2;

1.1.1.2
date	2002.07.19.21.27.14;	author henning;	state Exp;
branches;
next	1.1.1.3;

1.1.1.3
date	2002.10.07.19.48.05;	author henning;	state Exp;
branches;
next	1.1.1.4;

1.1.1.4
date	2003.08.21.12.53.28;	author henning;	state Exp;
branches;
next	;


desc
@@


1.15
log
@this commit is really florian@@'s, since he's the one who made removal
of our forked apache possible by his work on nginx and slowcgi, but he
doesn't want it - so it is my pleasure to tedu it. I spent so much work
on chroot in it 10 years ago - and am very happy to see it go now, nginx
is a far better choice today.
Bye bye, Apache, won't miss you.
@
text
@#!/bin/sh
## ====================================================================
## The Apache Software License, Version 1.1
##
## Copyright (c) 2000-2003 The Apache Software Foundation.  All rights
## reserved.
##
## Redistribution and use in source and binary forms, with or without
## modification, are permitted provided that the following conditions
## are met:
##
## 1. Redistributions of source code must retain the above copyright
##    notice, this list of conditions and the following disclaimer.
##
## 2. Redistributions in binary form must reproduce the above copyright
##    notice, this list of conditions and the following disclaimer in
##    the documentation and/or other materials provided with the
##    distribution.
##
## 3. The end-user documentation included with the redistribution,
##    if any, must include the following acknowledgment:
##       "This product includes software developed by the
##        Apache Software Foundation (http://www.apache.org/)."
##    Alternately, this acknowledgment may appear in the software itself,
##    if and wherever such third-party acknowledgments normally appear.
##
## 4. The names "Apache" and "Apache Software Foundation" must
##    not be used to endorse or promote products derived from this
##    software without prior written permission. For written
##    permission, please contact apache@@apache.org.
##
## 5. Products derived from this software may not be called "Apache",
##    nor may "Apache" appear in their name, without prior written
##    permission of the Apache Software Foundation.
##
## THIS SOFTWARE IS PROVIDED ``AS IS'' AND ANY EXPRESSED OR IMPLIED
## WARRANTIES, INCLUDING, BUT NOT LIMITED TO, THE IMPLIED WARRANTIES
## OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE ARE
## DISCLAIMED.  IN NO EVENT SHALL THE APACHE SOFTWARE FOUNDATION OR
## ITS CONTRIBUTORS BE LIABLE FOR ANY DIRECT, INDIRECT, INCIDENTAL,
## SPECIAL, EXEMPLARY, OR CONSEQUENTIAL DAMAGES (INCLUDING, BUT NOT
## LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES; LOSS OF
## USE, DATA, OR PROFITS; OR BUSINESS INTERRUPTION) HOWEVER CAUSED AND
## ON ANY THEORY OF LIABILITY, WHETHER IN CONTRACT, STRICT LIABILITY,
## OR TORT (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT
## OF THE USE OF THIS SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF
## SUCH DAMAGE.
## ====================================================================
##
## This software consists of voluntary contributions made by many
## individuals on behalf of the Apache Software Foundation.  For more
## information on the Apache Software Foundation, please see
## <http://www.apache.org/>.
##
## Portions of this software are based upon public domain software
## originally written at the National Center for Supercomputing Applications,
## University of Illinois, Urbana-Champaign.
##

##
##  configure -- Apache Autoconf-style Interface (APACI) 
##
##  Initially written by Ralf S. Engelschall <rse@@apache.org>
##

## Force SSL_BASE=SYSTEM
SSL_BASE=SYSTEM
export SSL_BASE

#   default input separator chars: <space><tab><cr>
DIFS=' 	
'

##
##  avoid brain dead shells on Ultrix and friends
##
if [ -f /bin/sh5 ]; then
    if [ ".$APACI_SH5_UPGRADE_STEP" != .done ]; then
         APACI_SH5_UPGRADE_STEP=done
         export APACI_SH5_UPGRADE_STEP
         exec /bin/sh5 $0 "$@@"
    fi
fi

##
##  the paths to the Apache source tree
##
top=.
mkf=Makefile
src=src
aux=src/helpers
sedsubst=src/.apaci.sedsubst
addconf=src/.apaci.addconf
tplconf=src/.apaci.tplconf
pldconf=src/.apaci.pldconf
configlayout=config.layout
configstatus=config.status
shadow=''

##
##  pre-determine runtime modes
##
help=no
quiet=no
verbose=no
case "$*" in
    --help|*--help|*--help* ) 
        help=yes; quiet=yes
        echo "[hang on a moment, generating help]"
        echo ""
        ;;
    --quiet|*--quiet|*--quiet* ) 
        quiet=yes
        ;;
    --verbose|*--verbose|*--verbose*|-v|*-v|*-v* ) 
        verbose=yes
        ;;
    * ) 
        ;;
esac

##
##  determine platform id
##
PLATFORM="`sh $aux/GuessOS`"

##
##  display version information
##
if [ "x$quiet" = "xno" ]; then
    APV=`cat $src/include/httpd.h |\
         grep "#define SERVER_BASEREVISION" |\
         sed -e 's/^[^"]*"//' -e 's/".*$//' -e 's/^\///'`
    echo "Configuring for Apache, Version $APV"
fi

##
##  important hint for the first-time users
##
if [ $# -eq 0 ]; then
    echo " + Warning: Configuring Apache with default settings."
    echo " + This is probably not what you really want."
    echo " + Please read the README.configure and INSTALL files"
    echo " + first or at least run '$0 --help' for"
    echo " + a compact summary of available options."
fi

##
##
##  determine path to (optional) Perl interpreter
##
PERL=no-perl-on-this-system
perlpath="`sh $aux/PrintPath perl5 perl miniperl`"
if [ "x$perlpath" != "x" ]; then
    PERL="$perlpath"
fi

##
##  look for deadly broken echo commands which interpret escape
##  sequences `\XX' *per default*. For those we first try the -E option
##  and if it then is still broken we give a warning message.
##  If it works set the `Safe Echo Option' (SEO) variable.
##
SEO='' # CHANGE THIS VARIABLE HERE IF YOU HAVE PROBLEMS WITH ECHO!
bytes=`echo $SEO '\1' | wc -c | awk '{ printf("%s", $1); }'`
if [ "x$bytes" != "x3" ]; then
    bytes=`echo -E '\1' | wc -c | awk '{ printf("%s", $1); }'`
    if [ "x$bytes" != "x3" ]; then
        echo " + Warning: Your 'echo' command is slightly broken."
        echo " + It interprets escape sequences per default. We already"
        echo " + tried 'echo -E' but had no real success. If errors occur"
        echo " + please set the SEO variable in 'configure' manually to"
        echo " + the required 'echo' options, i.e. those which force your"
        echo " + 'echo' to not interpret escape sequences per default."
    else
        SEO='-E'
    fi
fi

##
##  look for the best Awk we can find because some
##  standard Awks are really braindead and cause 
##  problems for our scripts under some platforms.
##
AWK=awk
awkpath="`sh $aux/PrintPath nawk gawk awk`"
if [ "x$awkpath" != "x" ]; then
    AWK="$awkpath"
fi

##
## Look for a good Tar. If we don't find 'GNU tar' then make
## sure ours can handle the '-h' (don't copy symlink, copy
## the actual data) option.
##
TAR=tar
tarpath="`sh $aux/PrintPath gtar gnutar tar`"
if [ "x$tarpath" != "x" ]; then
    TAR="$tarpath"
fi
case "`$TAR -tf /dev/null --version 2>/dev/null`" in
    *GNU*) TAROPT="-hcf" ;;
    *) if $TAR -hcf - Makefile.tmpl > /dev/null 2>&1
       then
           TAROPT="-hcf"
       else
           TAROPT="-cf"
       fi
       ;;
esac

##
## Request USTAR format for tar files on OS/390
## Request that prelink step be used for 390
##
case $PLATFORM in
    *-IBM-OS390*)
       TAROPT="${TAROPT}U"
       ;;
esac

##
##  determine path to sh, it's not /bin/sh on ALL systems
##
SHELL=/bin/sh
if [ ! -f "$SHELL" ]; then
    SHELL="`sh $aux/PrintPath sh`"
    if [ "x$SHELL" = "x" ]; then
        echo "configure:Error: Cannot determine path to Bourne-Shell" 1>&2
        exit 1
    fi
fi

##
##  determine default parameters
##

#   default paths
prefix=UNSET

#   layout configuration
with_layout=0
show_layout=0

#   suexec defaults
suexec=0
suexec_ok=0
suexec_docroot='$datadir/htdocs'
suexec_logexec='$logfiledir/suexec_log'
suexec_caller=www
suexec_userdir=public_html
suexec_uidmin=100
suexec_gidmin=100
suexec_safepath="/usr/local/bin:/usr/bin:/bin"
# if the umask is undefined, we don't change it
#suexec_umask=0755

#   the installation flags
iflags_program="-m 755 -s"
iflags_core="-m 755"
iflags_dso="-m 755"
iflags_script="-m 755"
iflags_data="-m 644"

#   ssl defaults
ssl=0

#   various other flags
support=1
confadjust=1
permute=''

#   determine rules
rules=''
rulelist=''
OIFS="$IFS"
IFS='
'
for rule in `grep '^Rule' $src/Configuration.tmpl`; do
    rule=`echo "$rule" | sed -e 's/^Rule[ 	]*//'`
    name=`echo "$rule" | sed -e 's/=.*$//'`
    namelow=`echo "$name" | tr '[A-Z]' '[a-z]'`
    arg=`echo "$rule" | sed -e 's/^.*=//'`
    eval "rule_$namelow=$arg"
    rules="$rules:$namelow"
    rulelist="$rulelist:$name=$arg"
done
IFS="$OIFS"
rules=`echo $rules | sed -e 's/^://'`

#   determine modules
modules=''
modulelist=''
OIFS="$IFS"
IFS='
'
for module in `egrep '^[# 	]*(Add|Shared)Module' $src/Configuration.tmpl`; do
    add=yes
    share=no
    if [ "x`echo $module | grep '^#'`" != "x" ]; then
        add=no
    fi
    if [ "x`echo $module | grep 'SharedModule'`" != "x" ]; then
        share=yes
    fi
    module=`echo "$module" |\
            sed -e 's%^.*/\(.*\)$%\1%' \
                -e 's/\.[oa]$//' \
                -e 's/\.module$//' \
                -e 's/^mod_//' \
                -e 's/^lib//'`
    eval "module_$module=$add"
    eval "shared_$module=$share"
    modules="${modules}:$module"
    modulelist="${modulelist}:$module=$add"
    if [ "x$share" = "xyes" ]; then
        modulelist="${modulelist}*"
    fi
done
IFS="$OIFS"
modules=`echo $modules | sed -e 's/^://'`

#   backward compatibility for old src/Configuration.tmpl
#   parameter names to the canonical Autoconf-style shell
#   variable names.
OIFS="$IFS"
IFS="$DIFS"
for var in CFLAGS LDFLAGS LIBS INCLUDES DEPS; do
    eval "val=\$EXTRA_$var"
    if [ "x$val" != "x" ]; then
        eval "$var=\$val"
        eval "EXTRA_$var=\"\"; export EXTRA_$var"
        echo " + Hint: please use $var instead of EXTRA_$var next time"
    fi
done
IFS="$OIFS"

##
## Platform-specific defaults
##
case $PLATFORM in
    *-apple-rhapsody*)
	default_layout="Mac OS X Server"
	iflags_core="${iflags_core} -S \"-S\""
	iflags_dso="${iflags_dso} -S \"-S\""
	;;
    *-apple-darwin*)
	default_layout="Darwin"
	iflags_core="${iflags_core} -S \"-S\"" 
	iflags_dso="${iflags_dso} -S \"-S\""
	;;
    *OS/2* ) 
        default_layout="Apache"
        iflags_program="${iflags_program} -e .exe" 
        iflags_core="${iflags_core} -e .exe" 
        ;;
    *MPE/iX* )
	default_layout="Apache"
	iflags_program="-m 755"
	;;
    *)
	default_layout="Apache"
	;;
esac

##
##  support for the default layout
##
case "$*" in
    *--with-layout=* ) 
        ;;
    * ) 
        if [ "x$*" = "x" ]; then
            set -- --with-layout="$default_layout"
        else
            set -- --with-layout="$default_layout" "$@@"
        fi
        ;;
esac

##
##  Initialize server user ID and group ID variables
##
conf_user=""
conf_group=""

##
##  Iterate over the command line options the first time.
##
##  This time we pre-process options which need high priority 
##  on the command line independent of their position, so they 
##  can be overridden by others.
##
apc_prev=''
OIFS1="$IFS"
IFS="$DIFS"
for apc_option
do
    #   if previous option needs an argument, assign it.
    if [ "x$apc_prev" != "x" ]; then
        eval "$apc_prev=\$apc_option"
        apc_prev=""
        continue
    fi
    #   split out arguments
    case "$apc_option" in
        -*=*) apc_optarg=`echo "$apc_option" | sed 's/[-_a-zA-Z0-9]*=//'` ;;
           *) apc_optarg= ;;
    esac
    #  pre-process only a few options now
    case "$apc_option" in
        --help | -h | -help )
            echo "Usage: configure [options]"
            echo "Options: [defaults in brackets after descriptions]"
            echo "General options:"
            echo " --quiet, --silent      do not print messages"
            echo " --verbose, -v          print even more messages"
            echo " --shadow[=DIR]         switch to a shadow tree (under DIR) for building"
            echo ""
            echo "Stand-alone options:"
            echo " --help, -h             print this message"
            echo " --show-layout          print installation path layout (check and debug)"
            echo ""
            echo "Installation layout options:"
            echo " --with-layout=[F:]ID   use installation path layout ID (from file F)"
            echo " --target=TARGET        install name-associated files using basename TARGET"
            echo " --prefix=PREFIX        install architecture-independent files in PREFIX"
            echo " --exec-prefix=EPREFIX  install architecture-dependent files in EPREFIX"
            echo " --bindir=DIR           install user     executables in DIR"
            echo " --sbindir=DIR          install sysadmin executables in DIR"
            echo " --libexecdir=DIR       install program  executables in DIR"
            echo " --mandir=DIR           install manual pages in DIR"
            echo " --sysconfdir=DIR       install configuration files in DIR"
            echo " --datadir=DIR          install read-only data files in DIR"
            echo " --iconsdir=DIR         install read-only icon files in DIR"
            echo " --htdocsdir=DIR        install read-only welcome pages in DIR"
            echo " --manualdir=DIR        install read-only on-line documentation in DIR"
            echo " --cgidir=DIR           install read-only cgi files in DIR"
            echo " --includedir=DIR       install includes files in DIR"
            echo " --localstatedir=DIR    install modifiable data files in DIR"
            echo " --runtimedir=DIR       install runtime data in DIR"
            echo " --logfiledir=DIR       install logfile data in DIR"
            echo " --proxycachedir=DIR    install proxy cache data in DIR"
            echo ""
            echo "Configuration options:"
            echo " --enable-rule=NAME     enable  a particular Rule named 'NAME'"
            echo " --disable-rule=NAME    disable a particular Rule named 'NAME'"
            $aux/ppl.sh $rulelist
            echo " --add-module=FILE      on-the-fly copy & activate a 3rd-party Module"
            echo " --activate-module=FILE on-the-fly activate existing 3rd-party Module"
            echo " --permute-module=N1:N2 on-the-fly permute module 'N1' with module 'N2'"
            echo " --enable-module=NAME   enable  a particular Module named 'NAME'"
            echo " --disable-module=NAME  disable a particular Module named 'NAME'"
            $aux/ppl.sh $modulelist
            echo " --enable-shared=NAME   enable  build of Module named 'NAME' as a DSO"
            echo " --disable-shared=NAME  disable build of Module named 'NAME' as a DSO"
            echo " --with-perl=FILE       path to the optional Perl interpreter"
            echo " --with-port=PORT       set the port number for httpd.conf"
            echo " --without-support      disable the build and installation of support tools"
            echo " --without-confadjust   disable the user/situation adjustments in config"
            echo " --without-execstrip    disable the stripping of executables on installation"
            echo " --server-uid=UID       set the user ID the web server should run as [nobody]"
            echo " --server-gid=GID       set the group ID the web server UID is a memeber of [#-1]"
            echo ""
            echo "suEXEC options:"
            echo " --enable-suexec        enable the suEXEC feature"
            echo " --suexec-caller=NAME   set the suEXEC username of the allowed caller [$suexec_caller]"
            echo " --suexec-docroot=DIR   set the suEXEC root directory [PREFIX/share/htdocs]"
            echo " --suexec-logfile=FILE  set the suEXEC logfile [PREFIX/var/log/suexec_log]"
            echo " --suexec-userdir=DIR   set the suEXEC user subdirectory [$suexec_userdir]"
            echo " --suexec-uidmin=UID    set the suEXEC minimal allowed UID [$suexec_uidmin]"
            echo " --suexec-gidmin=GID    set the suEXEC minimal allowed GID [$suexec_gidmin]"
            echo " --suexec-safepath=PATH set the suEXEC safe PATH [$suexec_safepath]"
            echo " --suexec-umask=UMASK   set the umask for the suEXEC'd script [server's umask]"
            echo ""
            echo "Deprecated options:"
            echo " --layout               backward compat only: use --show-layout"
            echo " --compat               backward compat only: use --with-layout=Apache"
            exit 0
            ;;
        --with-layout=*|--compat)
            if [ "x$apc_option" = "x--compat" ]; then
                apc_optarg="Apache"
            fi
            case $apc_optarg in
                *:* ) 
                    file=`echo $apc_optarg | sed -e 's/:.*//'`
                    name=`echo $apc_optarg | sed -e 's/.*://'`
                    ;;
                * ) 
                    name=$apc_optarg
                    file=$configlayout
                    ;;
            esac
            if [ ! -f "$file" ]; then
                echo "configure:Error: Path layout definition file $file not found" 1>&2
                exit 1
            fi
            (echo ''; cat $file; echo '') |\
            sed -e "1,/[ 	]*<[Ll]ayout[ 	]*$name[ 	]*>[ 	]*/d" \
                -e '/[ 	]*<\/Layout>[ 	]*/,$d' \
                -e "s/^[ 	]*//g" \
                -e "s/:[ 	]*/=\'/g" \
                -e "s/[ 	]*$/'/g" \
                >$pldconf
            . $pldconf
            OOIFS="$IFS"  # most likely not needed: jmj
            IFS="$DIFS"   # ditto
            for var in prefix exec_prefix bindir sbindir libexecdir mandir \
                       sysconfdir datadir iconsdir htdocsdir manualdir cgidir \
                       includedir localstatedir runtimedir logfiledir \
                       proxycachedir; do
                eval "val=\"\$$var\""
                case $val in
                    *+ )
                        val=`echo $val | sed -e 's;\+$;;'`
                        eval "$var=\"\$val\""
                        eval "autosuffix_$var=yes"
                        ;;
                    * )
                        eval "autosuffix_$var=no"
                        ;;
                esac
            done
            IFS="$OOIFS"
            rm -f $pldconf 2>/dev/null
            if [ "x$prefix" = "xUNSET" ]; then
                echo "configure:Error: Path layout definition not found or incorrect" 1>&2
                exit 1
            fi
            if [ "x$quiet" = "xno" ]; then
                echo " + using installation path layout: $name ($file)"
            fi
            name_layout=$name
            with_layout=1
            ;;
        *)
            ;;
    esac
done

##
##  Iterate over the command line options the second time.
##
##  This time we parse the standard options.
##
addconf_created=0
apc_prev=''
for apc_option
do
    #   if previous option needs an argument, assign it.
    if [ "x$apc_prev" != "x" ]; then
        eval "$apc_prev=\$apc_option"
        apc_prev=""
        continue
    fi
    #   split out arguments
    case "$apc_option" in
        -*=*) apc_optarg=`echo "$apc_option" | sed 's/[-_a-zA-Z0-9]*=//'` ;;
           *) apc_optarg= ;;
    esac
    #  accept only the most important GNU Autoconf-style options
    case "$apc_option" in
        --help|-h|-help|--with-layout=*|-compat)
            #   just ignore already parsed options
            ;;
        --quiet | --silent) 
            quiet=yes
            ;;
        --verbose | -v)
            verbose=yes
            ;;
        --shadow*)
            #   if we use an external shadow tree, first shadow all of ourself
            #   to this tree and switch over to to it for internal (=platform)
            #   shadowing...
            case "$apc_option" in
                --shadow=*)
                    shadow="$apc_optarg"
                    if [ "x$quiet" = "xno" ]; then
                        echo " + creating external package shadow tree ($shadow)"
                    fi
                    rm -rf $shadow 2>/dev/null
                    $aux/mkshadow.sh . $shadow
                    for file in $mkf $sedsubst $addconf $tplconf $pldconf $configstatus; do
                        rm -f $shadow/$file 2>/dev/null
                    done
                    if [ "x$quiet" = "xno" ]; then
                        echo " + switching to external package shadow tree ($shadow)"
                    fi
                    cd $shadow
                    ;;
            esac
            #   determine GNU platform triple
            gnutriple=`echo "$PLATFORM" | sed -e 's:/:-:g' | $AWK '{ printf("%s",$1); }'`
            #   create Makefile wrapper (the first time only)
            if [ "x`ls $top/src.* 2>/dev/null`" = "x" ]; then
                if [ "x$quiet" = "xno" ]; then
                    echo " + creating Makefile (shadow wrapper)"
                fi
                echo "##" > Makefile
                echo "##  Apache Makefile (shadow wrapper)" >> Makefile
                echo "##" >> Makefile
                echo "" >> Makefile
                if [ "x$shadow" != "x" ]; then
                    echo "SHADOW=$shadow" >> Makefile
                else
                    echo "SHADOW=." >> Makefile
                fi
                #   (the use of `awk' and not `$AWK' here is correct, because this
                #   Makefile is for platform bootstrapping, so don't hardcode paths)
                echo "GNUTRIPLE=\`$aux/GuessOS | sed -e 's:/:-:g' | awk '{ printf(\"%s\",\$\$1); }'\`" >> Makefile
                echo "" >> Makefile
                echo "all build install install-quiet clean distclean:" >> Makefile
                echo "	@@cd \$(SHADOW); \$(MAKE) -f Makefile.\$(GNUTRIPLE) \$(MFLAGS) \$@@" >> Makefile
                echo "" >> Makefile
            fi
            #   set shadow paths
            shadowmkf="Makefile.$gnutriple"
            shadowsrc="src.$gnutriple"
            shadowaux="src.$gnutriple/helpers"
            shadowsedsubst="src.$gnutriple/.apaci.sedsubst"
            shadowaddconf="src.$gnutriple/.apaci.addconf"
            shadowtplconf="src.$gnutriple/.apaci.tplconf"
            #   (re)create shadow tree
            if [ "x$quiet" = "xno" ]; then
                echo " + creating internal platform shadow tree ($shadowsrc)"
            fi
            rm -rf $shadowsrc
            $aux/mkshadow.sh $src $shadowsrc
            #   delegate us to the shadow paths
            mkf=$shadowmkf
            src=$shadowsrc
            aux=$shadowaux
            sedsubst=$shadowsedsubst
            addconf=$shadowaddconf
            tplconf=$shadowtplconf
            ;;
        --show-layout|--layout)
            show_layout=1
            ;;
        --target=*)
            TARGET="$apc_optarg"
            ;;
        --prefix=*)
            prefix="$apc_optarg"
            autosuffix_prefix=no
            ;;
        --exec-prefix=*)
            exec_prefix="$apc_optarg"
            autosuffix_exec_prefix=no
            ;;
        --bindir=*)       
            bindir="$apc_optarg"
            autosuffix_bindir=no
            ;;
        --sbindir=*)       
            sbindir="$apc_optarg"
            autosuffix_sbindir=no
            ;;
        --libexecdir=*)
            libexecdir="$apc_optarg"    
            autosuffix_libexecdir=no
            ;;
        --mandir=*)        
            mandir="$apc_optarg"        
            autosuffix_mandir=no
            ;;
        --sysconfdir=*)    
            sysconfdir="$apc_optarg"    
            autosuffix_sysconfdir=no
            ;;
        --datadir=*)       
            datadir="$apc_optarg"       
            autosuffix_datadir=no
            ;;
        --iconsdir=*) 
            iconsdir="$apc_optarg" 
            autosuffix_iconsdir=no
            ;;
        --htdocsdir=*) 
            htdocsdir="$apc_optarg" 
            autosuffix_htdocsdir=no
            ;;
        --manualdir=*) 
            manualdir="$apc_optarg" 
            autosuffix_manualdir=no
            ;;
        --cgidir=*) 
            cgidir="$apc_optarg" 
            autosuffix_cgidir=no
            ;;
        --includedir=*)       
            includedir="$apc_optarg"       
            autosuffix_includedir=no
            ;;
        --localstatedir=*) 
            localstatedir="$apc_optarg" 
            autosuffix_localstatedir=no
            ;;
        --runtimedir=*) 
            runtimedir="$apc_optarg" 
            autosuffix_runtimedir=no
            ;;
        --logfiledir=*) 
            logfiledir="$apc_optarg" 
            autosuffix_logfiledir=no
            ;;
        --proxycachedir=*) 
            proxycachedir="$apc_optarg" 
            autosuffix_proxycachedir=no
            ;;
        --add-module=*) 
            file="$apc_optarg"
            if [ "x`echo $file | egrep '/?mod_[a-zA-Z0-9][a-zA-Z0-9_]*\.c$'`" = "x" ]; then
                echo "configure:Error: Module filename doesn't match '/?mod_[a-zA-Z0-9][a-zA-Z0-9_]*\.c'" 1>&2
                exit 1
            fi
            if [ ! -f $file ]; then
                echo "configure:Error: Module source $file not found" 1>&2
                exit 1
            fi
            modfilec=`echo $file | sed -e 's;^.*/;;'`
            modfileo=`echo $file | sed -e 's;^.*/;;' -e 's;\.c$;.o;'`
            if [ "x$file" != "x$src/modules/extra/$modfilec" ]; then
                cp $file $src/modules/extra/$modfilec
            fi
            if [ "x$addconf_created" = "x0" ]; then
                addconf_created=1
                rm -f $addconf 2>/dev/null
                touch $addconf 2>/dev/null
            fi
            echo "" >>$addconf
            echo "## On-the-fly added module" >>$addconf
            echo "## (configure --add-module=$file)" >>$addconf
            echo "AddModule modules/extra/$modfileo" >>$addconf
            module=`echo "$modfileo" |\
                    sed -e 's%^.*/\(.*\)$%\1%' \
                        -e 's/\.[^.]*$//' \
                        -e 's/^mod_//' \
                        -e 's/^lib//'`
            eval "module_$module=yes"
            eval "shared_$module=no"
            modules="${modules}:$module"
            modulelist="${modulelist}:$module=yes"
            if [ "x$quiet" = "xno" ]; then
                echo " + on-the-fly added and activated $module module (modules/extra/$modfileo)"
            fi
            ;;
        --activate-module=*) 
            file="$apc_optarg"
            case $file in
                src/modules/* ) ;;
                *)  echo "configure:Error: Module source already has to be below src/modules/ to be activated" 1>&2
                    exit 1
                    ;;
            esac
            modfile=`echo $file | sed -e 's;^src/;;'`
            if [ "x$addconf_created" = "x0" ]; then
                addconf_created=1
                rm -f $addconf 2>/dev/null
                touch $addconf 2>/dev/null
            fi
            echo "" >>$addconf
            echo "## On-the-fly activated module" >>$addconf
            echo "## (configure --activate-module=$file)" >>$addconf
            echo "AddModule $modfile" >>$addconf
            module=`echo "$modfile" |\
                    sed -e 's%^.*/\(.*\)$%\1%' \
                        -e 's/\.[^.]*$//' \
                        -e 's/^mod_//' \
                        -e 's/^lib//'`
            eval "module_$module=yes"
            eval "shared_$module=no"
            modules="${modules}:$module"
            modulelist="${modulelist}:$module=yes"
            if [ "x$quiet" = "xno" ]; then
                echo " + activated $module module ($modfile)"
            fi
            ;;
        --enable-*)
            apc_feature=`echo $apc_option | sed -e 's/-*enable-//' -e 's/=.*//'`
            apc_feature=`echo $apc_feature | sed 's/-/_/g'`
            case "$apc_option" in
                *=*) ;;
                  *) apc_optarg=yes ;;
            esac
            case "$apc_feature" in
                rule   )
                    apc_optarg=`echo "$apc_optarg" | tr '[A-Z]' '[a-z]'`
                    apc_optarg_real=`echo "$apc_optarg" | tr '[a-z]' '[A-Z]'`
                    eval "exists=\$rule_${apc_optarg}" 
                    if [ "x$exists" = "x" ]; then
                        echo "configure:Error: No such rule named '${apc_optarg_real}'" 1>&2
                        exit 1
                    fi
                    eval "rule_${apc_optarg}=yes"
                    ;;
                module ) 
                    case $apc_optarg in
                       all ) 
                           OOIFS="$IFS"
                           IFS=':'
                           for module in $modules; do
                               eval "module_${module}=yes" 
                           done
                           IFS="$OOIFS"
                           module_auth_digest=no # conflict with mod_digest
                           ;;
                       most ) 
                           OOIFS="$IFS"
                           IFS=':'
                           for module in $modules; do
                               eval "module_${module}=yes" 
                           done
                           IFS="$OOIFS"
                           module_auth_db=no     # not all platforms have -ldb
                           module_mmap_static=no # not all platforms have mmap()
                           module_so=no          # not all platforms have dlopen()
                           module_example=no     # only for developers
                           module_auth_digest=no # conflict with mod_digest
                           module_log_agent=no   # deprecated
                           module_log_referer=no # deprecated
                           ;;
                       * ) 
                           eval "exists=\$module_${apc_optarg}" 
                           if [ "x$exists" = "x" ]; then
                               echo "configure:Error: No such module named '${apc_optarg}'" 1>&2
                               exit 1
                           fi
                           eval "module_${apc_optarg}=yes" 
                           ;;
                    esac
                    ;;
                shared ) 
                    case $apc_optarg in
                       max ) 
                           OOIFS="$IFS"
                           IFS=':'
                           for module in $modules; do
                               eval "shared_${module}=yes" 
                           done
                           IFS="$OOIFS"
                           shared_so=no        # because of bootstrapping
                           ;;
                       remain ) 
                           OOIFS="$IFS"
                           IFS=':'
                           for module in $modules; do
                               eval "add=\$module_${module}" 
                               if [ "x$add" = "xno" ]; then
                                   eval "module_${module}=yes" 
                                   eval "shared_${module}=yes" 
                               fi
                           done
                           IFS="$OOIFS"
                           shared_so=no
                           ;;
                       * ) 
                           eval "exists=\$module_${apc_optarg}" 
                           if [ "x$exists" = "x" ]; then
                               echo "configure:Error: No such module named '${apc_optarg}'" 1>&2
                               exit 1
                           fi
                           eval "shared_${apc_optarg}=yes" 
                           ;;
                    esac
                    ;;
                suexec ) 
                    suexec=1
                    ;;
                * ) 
                    echo "configure:Error: invalid option '$apc_option'" 1>&2
                    exit 1
                    ;;
            esac
            ;;
        --disable-*)
            apc_feature=`echo $apc_option | sed -e 's/-*disable-//' -e 's/=.*//'`
            apc_feature=`echo $apc_feature| sed 's/-/_/g'`
            case "$apc_option" in
                *=*) ;;
                  *) apc_optarg=yes ;;
            esac
            case "$apc_feature" in
                rule   ) 
                    apc_optarg=`echo "$apc_optarg" | tr '[A-Z]' '[a-z]'`
                    apc_optarg_real=`echo "$apc_optarg" | tr '[a-z]' '[A-Z]'`
                    eval "exists=\$rule_${apc_optarg}" 
                    if [ "x$exists" = "x" ]; then
                        echo "configure:Error: No such rule named '${apc_optarg_real}'" 1>&2
                        exit 1
                    fi
                    eval "rule_${apc_optarg}=no"
                    ;;
                module )
                    case $apc_optarg in
                       all ) 
                           OOIFS="$IFS"
                           IFS=':'
                           for module in $modules; do
                               eval "module_${module}=no" 
                           done
                           IFS="$OOIFS"
                           ;;
                       * ) 
                           eval "exists=\$module_${apc_optarg}" 
                           if [ "x$exists" = "x" ]; then
                               echo "configure:Error: No such module named '${apc_optarg}'" 1>&2
                               exit 1
                           fi
                           eval "module_${apc_optarg}=no" 
                           ;;
                    esac
                    ;;
                shared )
                    case $apc_optarg in
                       all ) 
                           OOIFS="$IFS"
                           IFS=':'
                           for module in $modules; do
                               eval "shared_${module}=no" 
                           done
                           IFS="$OOIFS"
                           ;;
                       * ) 
                           eval "exists=\$module_${apc_optarg}" 
                           if [ "x$exists" = "x" ]; then
                               echo "configure:Error: No such module named '${apc_optarg}'" 1>&2
                               exit 1
                           fi
                           eval "shared_${apc_optarg}=no" 
                           ;;
                    esac
                    ;;
                * ) 
                    echo "configure:Error: invalid option '$apc_option'" 1>&2
                    exit 1
                    ;;
            esac
            ;;
        --permute-module=*:*)
            mod1=`echo $apc_optarg | sed -e 's/:.*//'`
            mod2=`echo $apc_optarg | sed -e 's/.*://'`
            for mod in $mod1 $mod2; do
                case $mod in
                    BEGIN|END)
                        ;;
                    *)  eval "exists=\$module_${mod}" 
                        if [ "x$exists" = "x" ]; then
                            echo "configure:Error: No such module named '${mod}'" 1>&2
                            exit 1
                        fi
                        ;;
                esac
            done
            case $mod1:$mod2 in
                BEGIN:END|*:BEGIN|END:*)
                    echo "configure:Error: Invalid combination of pseudo module identifiers" 1>&2
                    exit 1
                    ;;
            esac
            permute="${permute},${mod1}:${mod2}"
            ;;
        --with-perl=*)
            PERL="$apc_optarg"
            ;;
        --with-port=*)
            port="$apc_optarg"
            ;;
        --without-support)
            support=0
            ;;
        --without-confadjust)
            confadjust=0
            ;;
        --without-execstrip)
            iflags_program=`echo "$iflags_program" | sed -e 's/-s//'`
            ;;
        --suexec-caller=*)
            suexec_caller="$apc_optarg"
            suexec_ok=1
            ;;
        --suexec-docroot=*)
            suexec_docroot="$apc_optarg"
            suexec_ok=1
            ;;
        --suexec-logfile=*)
            suexec_logexec="$apc_optarg"
            suexec_ok=1
            ;;
        --suexec-userdir=*)
            suexec_userdir="$apc_optarg"
            suexec_ok=1
            ;;
        --suexec-uidmin=*)
            suexec_uidmin="$apc_optarg"
            suexec_ok=1
            ;;
        --suexec-gidmin=*)
            suexec_gidmin="$apc_optarg"
            suexec_ok=1
            ;;
        --suexec-safepath=*)
            suexec_safepath="$apc_optarg"
            suexec_ok=1
            ;;
        --suexec-umask=*)
            suexec_umask_val="$apc_optarg"
            suexec_umask="-DSUEXEC_UMASK=0$apc_optarg"
            suexec_ok=1
            ;;
        --server-uid=*)
            conf_user="$apc_optarg"
	    # protect the '#' against interpretation as comment
	    case x"${conf_user}" in
              "#"*)  conf_user="\\\\${conf_user}";;
              "\\#"*)conf_user="\\${conf_user}";;
            esac
            ;;
        --server-gid=*)
            conf_group="$apc_optarg"
	    # protect the '#' against interpretation as comment
	    case x"${conf_group}" in
              "#"*)  conf_group="\\\\${conf_group}";;
              "\\#"*)conf_group="\\${conf_group}";;
            esac
            ;;
        * )
            echo "configure:Error: invalid option '$apc_option'" 1>&2
            exit 1
            ;;
    esac
done
IFS="$OIFS1"
if [ "x$apc_prev" != "x" ]; then
    echo "configure:Error: missing argument to --`echo $apc_prev | sed 's/_/-/g'`" 1>&2
    exit 1
fi
if [ "x$addconf_created" = "x0" ]; then
    rm -f $addconf 2>/dev/null
    touch $addconf 2>/dev/null
fi

##
##   create a config status script for restoring
##   the configuration via a simple shell script
##
rm -f $configstatus 2>/dev/null
echo "#!/bin/sh" >$configstatus
echo "##" >>$configstatus
echo "##  $configstatus -- APACI auto-generated configuration restore script" >>$configstatus
echo "##" >>$configstatus
echo "##  Use this shell script to re-run the APACI configure script for" >>$configstatus
echo "##  restoring your configuration. Additional parameters can be supplied." >>$configstatus
echo "##" >>$configstatus
echo "" >>$configstatus
for var in CC CPP OPTIM CFLAGS CFLAGS_SHLIB LDFLAGS LD_SHLIB LDFLAGS_SHLIB \
           LDFLAGS_SHLIB_EXPORT LIBS INCLUDES RANLIB DEPS TARGET EAPI_MM SSL_BASE; do
    eval "val=\"\$$var\""
    if [ "x$val" != "x" ]; then
        echo "$var=$val" |\
        sed -e 's:\(["$\\]\):\\\1:g' \
            -e 's:\([A-Z]*=\):\1":' \
            -e 's:$:" \\:' >>$configstatus
    fi
done
echo $SEO "${SHELL} ./configure \\" >>$configstatus
for arg
do
    echo "$arg" |\
    sed -e 's:\(["$\\]\):\\\1:g' \
        -e 's:^:":' \
        -e 's:$:" \\:' >>$configstatus
done
echo '"$@@"' >>$configstatus
echo '' >>$configstatus
chmod a+x $configstatus

##
##  a few errors and warnings
##
if [ "x$suexec" = "x1" ]; then
    if [ "x$suexec_ok" = "x0" ]; then
        echo "configure:Error: You enabled the suEXEC feature via --enable-suexec but"
        echo "                 without explicitly configuring it via at least one"
        echo "                 --suexec-xxxxx option. Seems like you are still not"
        echo "                 familiar with the suEXEC risks. Please read the INSTALL"
        echo "                 and htdocs/manual/suexec.html documents first."
        exit 1
    fi
    if [ "x`${SHELL} $aux/getuid.sh`" != "x0" ]; then
        echo " + Warning: You have enabled the suEXEC feature. Be aware that you need" 1>&2
        echo " + root privileges to complete the final installation step." 1>&2
    fi
fi
if [ "x$PERL" = "xno-perl-on-this-system" ]; then
    if [ "x$quiet" = "xno" ]; then
        echo " + Warning: no Perl interpreter detected for support scripts."
        echo " + Perhaps you need to specify one with --with-perl=FILE."
    fi
fi

##
##  SSL support
##
if [ ".$module_ssl" = .yes ]; then
    ssl=1
fi

##
##  target name
##
if [ "x$TARGET" != "x" ]; then
    thetarget="$TARGET"
else
    thetarget=httpd
fi

##
##  expand path variables and make sure
##  they do not end in a backslash
##
OIFS="$IFS"
IFS="$DIFS"
for var in prefix exec_prefix bindir sbindir libexecdir mandir \
           sysconfdir datadir iconsdir htdocsdir manualdir cgidir \
           includedir localstatedir runtimedir logfiledir \
           proxycachedir suexec_docroot suexec_logexec ; do
    eval "val=\"\$$var\"";
    val=`echo $val | sed -e 's:\(.\)/*$:\1:'`
    eval "$var=\"$val\""
    #   expand value
    eval "val=\$$var"
    #   automatically add target suffix to path when it's
    #   requested (path has a trailing plus in config.layout) and
    #   looks reasonable (i.e. when "apache" or target-name
    #   still not part of path)
    eval "autosuffix=\$autosuffix_$var"
    if [ "x$autosuffix" = "xyes" ]; then
        addtarget=no
        if [ "x`echo $val | grep apache`" = "x" ]; then
            if [ "x`echo $val | grep $thetarget`" = "x" ]; then
                addtarget=yes
            fi
        fi
        if [ "x$addtarget" = "xyes" ]; then
            eval "$var=\"\$$var/$thetarget\""
        fi
    fi
done
IFS="$OIFS"

##
##  determine special configurable Makefile targets
##
if [ "x$support" = "x1" ]; then
    build_support='build-support'
    if [ "x$name_layout" = "xBinaryDistribution" ]; then
        install_support='install-binsupport'
    else
        install_support='install-support'
    fi
    clean_support='clean-support'
    distclean_support='distclean-support'
else
    build_support=''
    install_support=''
    clean_support=''
    distclean_support=''
fi

##
##  determine special configuration parameters
## 
##  The checks via /etc/passwd and /etc/group will obviously fail
##  on platforms using NIS. But then you propably do not want a
##  UID/GID as production oriented as a web server in NIS anyway.
##
if [ "x$port" != "x" ]; then
    conf_port=$port
else
    conf_port="80"
fi
conf_port_ssl="443"
conf_serveradmin="you@@your.address"
conf_servername="new.host.name"
if [ "x$confadjust" = "x1" ]; then
    if [ -f /etc/passwd ]; then
        if [ "x$conf_user" = "x" ]; then
        for uid in nobody www daemon demon http httpd; do 
            if [ "x`egrep \^${uid}: /etc/passwd`" != "x" ]; then
                conf_user="$uid"
                break
            fi
        done
        fi
        if [ "x$conf_group" = "x" ]; then
        for gid in nobody nogroup www daemon demon http httpd; do 
            if [ "x`egrep \^${gid}: /etc/group`" != "x" ]; then
                conf_group="$gid"
                break
            fi
        done
    fi
    fi
    if [ "x`${SHELL} $aux/getuid.sh`" != "x0" -a "x$port" = "x" ]; then
        conf_port="8080"
        conf_port_ssl="8443"
    fi
    conf_serveradmin="`${SHELL} $aux/buildinfo.sh -n %u@@%h%d`"
    conf_servername="`${SHELL} $aux/buildinfo.sh -n %h%d`"
fi
 
##
## Default server user id and group id if not specified on configure invocation and none
## of the ids in /etc/passwd or /etc/group worked.
##
if [ "x$conf_user" = "x" ]; then
    conf_user="nobody"
fi
if [ "x$conf_group" = "x" ]; then
    conf_group="\\\\#-1"
fi

##
##  determine prefix-relative paths for directories
##  because Apache supports them for the -d and -f 
##  options, the LoadModule directive, etc.
##
##  [we have to make sure that it ends with a slash
##   or we cannot support the case where the relative
##   path is just the emtpy one, i.e. ""]
##
runtimedir_relative=`echo $runtimedir | sed -e "s:^$prefix/*::" -e 's:\(.\)$:\1/:'`
logfiledir_relative=`echo $logfiledir | sed -e "s:^$prefix/*::" -e 's:\(.\)$:\1/:'`
sysconfdir_relative=`echo $sysconfdir | sed -e "s:^$prefix/*::" -e 's:\(.\)$:\1/:'`
libexecdir_relative=`echo $libexecdir | sed -e "s:^$prefix/*::" -e 's:\(.\)$:\1/:'`

##
##  check and debug
##
if [ "x$show_layout" = "x1" ]; then
    echo ""
    echo "Installation paths:"
    echo "               prefix: $prefix"
    echo "          exec_prefix: $exec_prefix" 
    echo "               bindir: $bindir" 
    echo "              sbindir: $sbindir" 
    echo "           libexecdir: $libexecdir" 
    echo "               mandir: $mandir" 
    echo "           sysconfdir: $sysconfdir" 
    echo "              datadir: $datadir" 
    echo "             iconsdir: $iconsdir" 
    echo "            htdocsdir: $htdocsdir" 
    echo "            manualdir: $manualdir" 
    echo "               cgidir: $cgidir" 
    echo "           includedir: $includedir" 
    echo "        localstatedir: $localstatedir" 
    echo "           runtimedir: $runtimedir" 
    echo "           logfiledir: $logfiledir" 
    echo "        proxycachedir: $proxycachedir" 
    echo ""
    echo "Compilation paths:"
    echo "           HTTPD_ROOT: $prefix"
    echo "      SHARED_CORE_DIR: $libexecdir"
    echo "       DEFAULT_PIDLOG: ${runtimedir_relative}${thetarget}.pid"
    echo "   DEFAULT_SCOREBOARD: ${runtimedir_relative}${thetarget}.scoreboard"
    echo "     DEFAULT_LOCKFILE: ${runtimedir_relative}${thetarget}.lock"
    echo "     DEFAULT_ERRORLOG: ${logfiledir_relative}error_log"
    echo "    TYPES_CONFIG_FILE: ${sysconfdir_relative}mime.types"
    echo "   SERVER_CONFIG_FILE: ${sysconfdir_relative}${thetarget}.conf"
    echo "   ACCESS_CONFIG_FILE: ${sysconfdir_relative}access.conf"
    echo " RESOURCE_CONFIG_FILE: ${sysconfdir_relative}srm.conf"
    echo " SSL_CERTIFICATE_FILE: ${sysconfdir_relative}ssl.crt/server.crt"
    echo ""
    if [ "x$suexec" = "x1" ]; then
        echo "suEXEC setup:"
        echo "        suexec binary: $sbindir/suexec"
        echo "        document root: $suexec_docroot"
        echo "       userdir suffix: $suexec_userdir"
        echo "              logfile: $suexec_logexec"
        echo "            safe path: $suexec_safepath"
        echo "            caller ID: $suexec_caller"
        echo "      minimum user ID: $suexec_uidmin"
        echo "     minimum group ID: $suexec_gidmin"
        if [ "x$suexec_umask" != "x" ]; then
            echo "                umask: $suexec_umask_val"
	else
            echo "                umask: running server's"
        fi
        echo ""
    fi
    exit 0
fi

##
##  create Makefile from Makefile.tmpl
##
if [ "x$quiet" = "xno" ]; then
    echo "Creating $mkf"
fi
sed <Makefile.tmpl >$mkf \
-e "s%@@PLATFORM@@%$PLATFORM%g" \
-e "s%@@PERL@@%$PERL%g" \
-e "s%@@TAR@@%$TAR%g" \
-e "s%@@TAROPT@@%$TAROPT%g" \
-e "s%@@SRC@@%$src%g" \
-e "s%@@MKF@@%$mkf%g" \
-e "s%@@AUX@@%$aux%g" \
-e "s%@@TARGET@@%$thetarget%g" \
-e "s%@@IFLAGS_PROGRAM@@%$iflags_program%g" \
-e "s%@@IFLAGS_CORE@@%$iflags_core%g" \
-e "s%@@IFLAGS_DSO@@%$iflags_dso%g" \
-e "s%@@IFLAGS_SCRIPT@@%$iflags_script%g" \
-e "s%@@IFLAGS_DATA@@%$iflags_data%g" \
-e "s%@@prefix@@%$prefix%g" \
-e "s%@@exec_prefix@@%$exec_prefix%g" \
-e "s%@@bindir@@%$bindir%g" \
-e "s%@@sbindir@@%$sbindir%g" \
-e "s%@@libexecdir@@%$libexecdir%g" \
-e "s%@@libexecdir_relative@@%$libexecdir_relative%g" \
-e "s%@@mandir@@%$mandir%g" \
-e "s%@@sysconfdir@@%$sysconfdir%g" \
-e "s%@@datadir@@%$datadir%g" \
-e "s%@@iconsdir@@%$iconsdir%g" \
-e "s%@@htdocsdir@@%$htdocsdir%g" \
-e "s%@@manualdir@@%$manualdir%g" \
-e "s%@@cgidir@@%$cgidir%g" \
-e "s%@@localstatedir@@%$localstatedir%g" \
-e "s%@@includedir@@%$includedir%g" \
-e "s%@@runtimedir@@%$runtimedir%g" \
-e "s%@@logfiledir@@%$logfiledir%g" \
-e "s%@@proxycachedir@@%$proxycachedir%g" \
-e "s%@@suexec@@%$suexec%g" \
-e "s%@@suexec_caller@@%$suexec_caller%g" \
-e "s%@@suexec_docroot@@%$suexec_docroot%g" \
-e "s%@@suexec_logexec@@%$suexec_logexec%g" \
-e "s%@@suexec_userdir@@%$suexec_userdir%g" \
-e "s%@@suexec_uidmin@@%$suexec_uidmin%g" \
-e "s%@@suexec_gidmin@@%$suexec_gidmin%g" \
-e "s%@@suexec_safepath@@%$suexec_safepath%g" \
-e "s%@@suexec_umask@@%$suexec_umask%g" \
-e "s%@@ssl@@%$ssl%g" \
-e "s%@@conf_user@@%$conf_user%g" \
-e "s%@@conf_group@@%$conf_group%g" \
-e "s%@@conf_port@@%$conf_port%g" \
-e "s%@@conf_port_ssl@@%$conf_port_ssl%g" \
-e "s%@@conf_serveradmin@@%$conf_serveradmin%g" \
-e "s%@@conf_servername@@%$conf_servername%g" \
-e "s%@@build_support@@%$build_support%g" \
-e "s%@@install_support@@%$install_support%g" \
-e "s%@@clean_support@@%$clean_support%g" \
-e "s%@@distclean_support@@%$distclean_support%g" \
-e "s%@@SHELL@@%$SHELL%g"

##
##  override default paths in $src/include/httpd.h
##  via command line arguments for the compiler
##  supplied by a little shell script named $src/apaci
##
echo "#!/bin/sh" >$src/apaci
echo "## USED AS A COMMAND LINE EXPANDER TO OVERRIDE PATHS" >>$src/apaci
echo "## WITHOUT DISTURBING THE KNOWN MAKE BUILD PROCESS DISPLAY" >>$src/apaci
echo "echo '-DHTTPD_ROOT=\"$prefix\"'" >>$src/apaci
echo "echo '-DSUEXEC_BIN=\"$sbindir/suexec\"'" >>$src/apaci
echo "echo '-DSHARED_CORE_DIR=\"$libexecdir\"'" >>$src/apaci
echo "echo '-DDEFAULT_PIDLOG=\"${runtimedir_relative}${thetarget}.pid\"'" >>$src/apaci
echo "echo '-DDEFAULT_SCOREBOARD=\"${runtimedir_relative}${thetarget}.scoreboard\"'" >>$src/apaci
echo "echo '-DDEFAULT_LOCKFILE=\"${runtimedir_relative}${thetarget}.lock\"'" >>$src/apaci
echo "echo '-DDEFAULT_ERRORLOG=\"${logfiledir_relative}error_log\"'" >>$src/apaci
echo "echo '-DTYPES_CONFIG_FILE=\"${sysconfdir_relative}mime.types\"'" >>$src/apaci
echo "echo '-DSERVER_CONFIG_FILE=\"${sysconfdir_relative}${thetarget}.conf\"'" >>$src/apaci
echo "echo '-DACCESS_CONFIG_FILE=\"${sysconfdir_relative}access.conf\"'" >>$src/apaci
echo "echo '-DRESOURCE_CONFIG_FILE=\"${sysconfdir_relative}srm.conf\"'" >>$src/apaci
echo "echo '-DSSL_CERTIFICATE_FILE=\"${sysconfdir_relative}ssl.crt/server.crt\"'" >>$src/apaci
echo "echo '-DEAPI_MM_CORE_PATH=\"${runtimedir_relative}${thetarget}.mm\"'" >>$src/apaci
chmod a+x $src/apaci
CFLAGS="$CFLAGS \\\`\$(SRCDIR)/apaci\\\`"

##
##  create $src/Configuration.apaci file
##
if [ "x$quiet" = "xno" ]; then
    echo "Creating Configuration.apaci in $src"
fi
rm -f $sedsubst 2>/dev/null
touch $sedsubst

#   generate settings from imported environment variables
OIFS="$IFS"
IFS="$DIFS"
for var in CC CPP OPTIM CFLAGS CFLAGS_SHLIB LDFLAGS LD_SHLIB LDFLAGS_SHLIB \
           LDFLAGS_SHLIB_EXPORT LIBS INCLUDES RANLIB DEPS TARGET EAPI_MM SSL_BASE; do
    eval "val=\"\$$var\"";
    if [ "x$val" != "x" ]; then
        case $var in 
            CFLAGS|LDFLAGS|LIBS|INCLUDES|DEPS) 
                echo $SEO "s%^#*\\(EXTRA_$var=\\).*%\\1$val%g" >>$sedsubst
                ;;
            *)
                echo $SEO "s%^#*\\($var=\\).*%\\1$val%g" >>$sedsubst
                ;;
        esac
        eval "$var=\"\"; export $var"
    fi
done
IFS="$OIFS"

#   generate rule directives 
OIFS="$IFS"
IFS=':'
for rule in $rules; do
    name="`echo $rule | tr '[a-z]' '[A-Z]'`"
    eval "val=\$rule_$rule"
    echo $SEO "s%^\\(Rule $name=\\).*%\\1$val%g" >>$sedsubst
    if [ "x$verbose" = "xyes" ]; then
        echo " + Rule $name=$val"
    fi
done
IFS="$OIFS"

#   consistency checks for shared object support
some_shares=0
OIFS="$IFS"
IFS=':'
for module in $modules; do
    eval "share=\$shared_$module"
    if [ "x$share" = "xyes" ]; then
        some_shares=1
    fi
done
IFS="$OIFS"
if [ "x$some_shares" = "x1" ]; then
    if [ "x$module_so" = "xno" ]; then
        module_so=yes
        if [ "x$quiet" = "xno" ]; then
            echo " + enabling mod_so for DSO support"
        fi
    fi
fi
if [ "x$shared_so" = "xyes" ]; then
    shared_so=no
    echo "configure:Error: Module mod_so cannot be made a DSO itself" 1>&2
    exit 1
fi

#   module permutation support
if [ "x$permute" != "x" ]; then
    sed -e '/## mod_mmap_static/,$d' <src/Configuration.tmpl >$tplconf
    OIFS="$IFS"
    IFS='
'
    for line in `cat src/Configuration.tmpl $addconf | egrep '^[# ]*(Add|Shared)Module'`; do
        name=`echo "$line" |\
              sed -e 's%^.*/\(.*\)$%\1%' \
                  -e 's/\.[oa]$//' \
                  -e 's/\.module$//' \
                  -e 's/^mod_//' \
                  -e 's/^lib//'`
        echo "${name}:${line}"
    done |\
    $AWK -F: '
        BEGIN { 
            n = 0; 
        }
        { 
            module_pos[$1]  = n; 
            module_list[n]  = $1; 
            module_line[$1] = $2;
            n++; 
        }
        END {
            pn = split(permute, perm, ",");
            for (p = 1; p <= pn; p++) {
                split(perm[p], m, ":")
                m1 = m[1];
                m2 = m[2];
                if (m1 == "BEGIN") {
                    for (i = module_pos[m2]-1; i >= 0; i--) {
                        n1 = module_list[i];
                        n2 = module_list[i+1];
                        module_list[i]   = n2;
                        module_list[i+1] = n1;
                        module_pos[n1]   = i+1;
                        module_pos[n2]   = i;
                    }
                }
                else if (m2 == "END") {
                    for (i = module_pos[m1]; i < n-1; i++) {
                        n1 = module_list[i];
                        n2 = module_list[i+1];
                        module_list[i]   = n2;
                        module_list[i+1] = n1;
                        module_pos[n1]   = i+1;
                        module_pos[n2]   = i;
                    }
                }
                else {
                    p1 = module_pos[m1];
                    p2 = module_pos[m2];
                    n1 = module_list[p1];
                    n2 = module_list[p2];
                    module_list[p1] = n2;
                    module_list[p2] = n1;
                    module_pos[m1] = p2;
                    module_pos[m2] = p1;
                }
            }
            for (i = 0; i < n; i++) {
                name = module_list[i];
                printf("%s\n", module_line[name]);
            }
        }
    ' "permute=$permute" >>$tplconf
    IFS="$OIFS"
else
    cat $src/Configuration.tmpl $addconf >$tplconf
fi

#   generate module directives
#   (paths are modules/foo/mod_bar.ext and modules/foo/libbar.ext)
OIFS="$IFS"
IFS=':'
for module in $modules; do
    eval "add=\$module_$module"
    if [ "x$add" = "xyes" ]; then
        echo $SEO "s%^.*\\(AddModule.*mod_$module\\..*\\)%\\1%g" >>$sedsubst
        echo $SEO "s%^.*\\(AddModule.*lib$module\\..*\\)%\\1%g" >>$sedsubst
        echo $SEO "s%^.*\\(SharedModule.*mod_$module\\..*\\)%\\1%g" >>$sedsubst
        echo $SEO "s%^.*\\(SharedModule.*lib$module\\..*\\)%\\1%g" >>$sedsubst
        m="yes"
    else
        echo $SEO "s%^.*\\(AddModule.*mod_$module\\..*\\)%# \\1%g" >>$sedsubst
        echo $SEO "s%^.*\\(AddModule.*lib$module\\..*\\)%# \\1%g" >>$sedsubst
        echo $SEO "s%^.*\\(SharedModule.*mod_$module\\..*\\)%# \\1%g" >>$sedsubst
        echo $SEO "s%^.*\\(SharedModule.*lib$module\\..*\\)%# \\1%g" >>$sedsubst
        m=no
    fi
    eval "share=\$shared_$module"
    if [ "x$share" = "xyes" ]; then
        echo $SEO "s%^\\(.*\\)AddModule\\(.*mod_$module\\.\\)[oam].*\\(.*\\)%\\1SharedModule\\2so\\3%g" >>$sedsubst
        echo $SEO "s%^\\(.*\\)AddModule\\(.*lib$module\\.\\)[oam].*\\(.*\\)%\\1SharedModule\\2so\\3%g" >>$sedsubst
        m="$m [shared]"
    fi
    if [ "x$verbose" = "xyes" ]; then
        echo " + Module $module: $m"
    fi
done
IFS="$OIFS"

# translate module names to dll names for OS/2 so that they are no more
# than 8 characters long and have an extension of "dll" instead of "so"
case $PLATFORM in
    *OS/2* ) 
        echo $SEO "s%/mod_\\(.\\{1,8\\}\\).*\\.so%/\\1\\.dll%" >>$sedsubst
        echo $SEO "s%/\\(lib.*\\)\\.so$%/\\1.dll%" >>$sedsubst
        ;;
    *cygwin* ) 
        echo $SEO "s%/\\(mod_.*\\)\\.so$%/\\1.dll%" >>$sedsubst
        echo $SEO "s%/\\(lib.*\\)\\.so$%/\\1.dll%" >>$sedsubst
        ;;
esac

#   split sedsubst into chunks of 50 commands
#   to workaround limits in braindead seds
files=`$AWK <$sedsubst '
    BEGIN { line=0; cnt=0; }
    {
        if (line % 50 == 0) {
            file = sedsubst "." cnt;
            printf("%s\n", file);
            cnt++;
        }
        line++;
        print $0 >file;
    }
' "sedsubst=$sedsubst"`
OIFS="$IFS"
IFS="$DIFS"
substcmd=""
for file in $files; do
    substcmd="${substcmd} sed -f $file |"
done
substcmd="${substcmd} cat"
IFS="$OIFS"

#   and finally translate the config template 
#   according to our defined configuration
eval "cat $tplconf | $substcmd >$src/Configuration.apaci"

#   cleanup
rm -f $sedsubst $sedsubst.[0-9] 2>/dev/null
rm -f $addconf 2>/dev/null
rm -f $tplconf 2>/dev/null

##
##  create all other Makefiles by running the proprietary 
##  $src/Configure script with our custom Configuration.apaci file
##
if [ "x$verbose" = "xyes" ]; then
    vflag="-v";
fi
exec 4>&1
rc=`if [ "x$quiet" = "xyes" ]; then
    (cd $src; ${SHELL} ./Configure ${vflag} -file Configuration.apaci >/dev/null; echo $? >&3; );
else
    (cd $src; (${SHELL} ./Configure ${vflag} -file Configuration.apaci; echo $? >&3; ) |\
     sed -e '/^Using config file:.*/d' \
         -e "s:Makefile in :Makefile in $src\\/:" \
         -e "s:Makefile\$:Makefile in $src:" >&4 )
fi 3>&1`

## Ugly. So far, we've only used -eq, so just in case, use this
## stupid code unless we're *sure* that -ne is also available
if [ $rc -eq 0 ]; then
    :
else
    exit 1
fi

##
##  final hints
##
if [ "x$quiet" = "xno" ]; then
    if [ "x$shadow" != "x" ]; then
        echo "Hint: You now have to build inside $shadow."
        echo "This can be done either by running the canonical commands"
        echo "  \$ cd $shadow"
        echo "  \$ make"
        echo "  \$ make install"
        echo "or by running this alternative commands"
        echo "  \$ make -f $shadow/Makefile"
        echo "  \$ make -f $shadow/Makefile install"
    fi
fi

@


1.14
log
@merge
@
text
@@


1.13
log
@fix fd handling, so 'make build >log 2>fixme' really works

henning@@ ok
@
text
@d5 1
a5 1
## Copyright (c) 2000-2002 The Apache Software Foundation.  All rights
d1010 1
a1010 1
            suexec_umask="-DSUEXEC_UMASK=$apc_optarg"
@


1.12
log
@merge
@
text
@d1604 1
d1611 2
a1612 2
         -e "s:Makefile\$:Makefile in $src:")
fi 3>&1 1>&2`
@


1.11
log
@fix half baked abortion of a merge to 1.3.23 and take
tree to apache-1.3.24+mod+ssl2.8.8
@
text
@a1269 1
    echo "      DEFAULT_XFERLOG: ${logfiledir_relative}access_log"
a1370 1
echo "echo '-DDEFAULT_XFERLOG=\"${logfiledir_relative}access_log\"'" >>$src/apaci
@


1.10
log
@Apache 1.3.23+mod_ssl-2.8.6-1.3.23 merge
@
text
@d5 1
a5 1
## Copyright (c) 2000 The Apache Software Foundation.  All rights
d1606 2
a1607 2
if [ "x$quiet" = "xyes" ]; then
    (cd $src; ${SHELL} ./Configure ${vflag} -file Configuration.apaci >/dev/null);
d1609 1
a1609 1
    (cd $src; ${SHELL} ./Configure ${vflag} -file Configuration.apaci |\
d1613 8
@


1.9
log
@Apache 1.3.19+mod_ssl 2.8.1 merge - also adds shared build of mod_headers
and mod_expire
@
text
@d436 2
a437 1
            echo " --htdocsdir=DIR        install read-only document files in DIR"
d510 3
a512 2
                       sysconfdir datadir iconsdir htdocsdir cgidir includedir \
                       localstatedir runtimedir logfiledir proxycachedir; do
d685 4
d1122 1
a1122 1
##  they do not end with a backslash
d1127 3
a1129 3
           sysconfdir datadir iconsdir htdocsdir cgidir includedir \
           localstatedir runtimedir logfiledir proxycachedir \
           suexec_docroot suexec_logexec ; do
d1256 1
d1329 1
d1559 4
@


1.8
log
@Argh. this commit didn't make it when I did it earlier - apache 1.3.14 + mod_ssl 2.7.1 merge
@
text
@d3 4
a6 1
## Copyright (c) 1998-1999 The Apache Group.  All rights reserved.
d13 1
a13 1
##    notice, this list of conditions and the following disclaimer. 
d20 20
a39 23
## 3. All advertising materials mentioning features or use of this
##    software must display the following acknowledgment:
##    "This product includes software developed by the Apache Group
##    for use in the Apache HTTP server project (http://www.apache.org/)."
##
## 4. The names "Apache Server" and "Apache Group" must not be used to
##    endorse or promote products derived from this software without
##    prior written permission. For written permission, please contact
##    apache@@apache.org.
##
## 5. Products derived from this software may not be called "Apache"
##    nor may "Apache" appear in their names without prior written
##    permission of the Apache Group.
##
## 6. Redistributions of any form whatsoever must retain the following
##    acknowledgment:
##    "This product includes software developed by the Apache Group
##    for use in the Apache HTTP server project (http://www.apache.org/)."
##
## THIS SOFTWARE IS PROVIDED BY THE APACHE GROUP ``AS IS'' AND ANY
## EXPRESSED OR IMPLIED WARRANTIES, INCLUDING, BUT NOT LIMITED TO, THE
## IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR
## PURPOSE ARE DISCLAIMED.  IN NO EVENT SHALL THE APACHE GROUP OR
d41 7
a47 7
## SPECIAL, EXEMPLARY, OR CONSEQUENTIAL DAMAGES (INCLUDING, BUT
## NOT LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES;
## LOSS OF USE, DATA, OR PROFITS; OR BUSINESS INTERRUPTION)
## HOWEVER CAUSED AND ON ANY THEORY OF LIABILITY, WHETHER IN CONTRACT,
## STRICT LIABILITY, OR TORT (INCLUDING NEGLIGENCE OR OTHERWISE)
## ARISING IN ANY WAY OUT OF THE USE OF THIS SOFTWARE, EVEN IF ADVISED
## OF THE POSSIBILITY OF SUCH DAMAGE.
d51 7
a57 5
## individuals on behalf of the Apache Group and was originally based
## on public domain software written at the National Center for
## Supercomputing Applications, University of Illinois, Urbana-Champaign.
## For more information on the Apache Group and the Apache HTTP server
## project, please see <http://www.apache.org/>.
d593 1
a593 1
            gnutriple=`$aux/GuessOS | sed -e 's:/:-:g' | $AWK '{ printf("%s",$1); }'`
@


1.7
log
@apache 1.3.12 + mod_ssl 2.6.2 merge
@
text
@d130 2
a131 2
         grep "#define SERVER_BASEVERSION" |\
         sed -e 's/^[^"]*"//' -e 's/".*$//' -e 's/^Apache\///'`
d345 2
a346 2
    *-apple-macos*)
	default_layout="Mac OS X Server"
d356 3
a358 3
       default_layout="Apache"
       iflags_program="-m 755"
       ;;
d496 1
d502 1
a502 1
                $file >$pldconf
d1051 1
a1051 1
           LDFLAGS_SHLIB_EXPORT LIBS INCLUDES RANLIB DEPS TARGET EAPI_MM SSL_BASE RSA_BASE; do
d1386 1
a1386 1
           LDFLAGS_SHLIB_EXPORT LIBS INCLUDES RANLIB DEPS TARGET EAPI_MM SSL_BASE RSA_BASE; do
@


1.6
log
@More apache 1.3.11 changes
@
text
@d75 7
a81 1
test -f /bin/sh5 && exec /bin/sh5 $0 "$@@"
d432 4
a435 1
            echo " --datadir=DIR          install read-only  data files in DIR"
d460 1
a460 1
            echo " --server-gid=GID       set the group ID the web server UID is a memeber of [-1]"
@


1.5
log
@do not assume shell scripts are +x; d
@
text
@a57 4
## Force SSL_BASE=SYSTEM
SSL_BASE=SYSTEM
export SSL_BASE

d64 4
d141 1
d205 10
d247 2
a255 6
case $PLATFORM in
    *OS/2* ) 
        iflags_program="$iflags_program -e .exe" 
        iflags_core="$iflags_core -e .exe" 
        ;;
esac
d274 1
a274 1
    namelow=`echo "$name" | tr 'A-Z' 'a-z'`
d344 10
a353 1
   *)
d374 6
d446 1
d450 2
d462 1
d581 1
a581 3
            #   (the use of `awk' and not `$AWK' here is correct, because this
            #   Makefile is for platform bootstrapping, so don't hardcode paths)
            gnutriple=`$aux/GuessOS | sed -e 's:/:-:g' | awk '{ printf("%s",$1); }'`
d596 3
a598 1
                echo "GNUTRIPLE=\`$aux/GuessOS | sed -e 's:/:-:g' | $AWK '{ printf(\"%s\",\$\$1); }'\`" >> Makefile
d663 12
d950 3
d990 21
d1111 1
a1111 1
           suexec_docroot suexec_logexec; do
d1113 1
a1113 1
    val=`echo $val | sed -e 's:/*$::'`
d1162 5
a1166 3
conf_user="nobody"
conf_group="#-1"
conf_port="80"
d1172 1
d1179 2
d1188 2
a1189 1
    if [ "x`${SHELL} $aux/getuid.sh`" != "x0" ]; then
d1198 11
d1269 5
d1286 1
d1324 1
d1579 3
d1583 1
a1583 1
    (cd $src; ${SHELL} ./Configure -file Configuration.apaci >/dev/null);
d1585 1
a1585 1
    (cd $src; ${SHELL} ./Configure -file Configuration.apaci |\
@


1.4
log
@add makefile.bsd-wrapper
@
text
@d117 1
a117 1
PLATFORM="`$aux/GuessOS`"
d144 1
a144 1
perlpath="`$aux/PrintPath perl5 perl miniperl`"
d177 1
a177 1
awkpath="`$aux/PrintPath nawk gawk awk`"
d188 1
a188 1
tarpath="`$aux/PrintPath gtar gnutar tar`"
d208 1
a208 1
    SHELL="`$aux/PrintPath sh`"
d988 1
a988 1
echo $SEO "./configure \\" >>$configstatus
d1012 1
a1012 1
    if [ "x`$aux/getuid.sh`" != "x0" ]; then
d1121 1
a1121 1
    if [ "x`$aux/getuid.sh`" != "x0" ]; then
d1125 2
a1126 2
    conf_serveradmin="`$aux/buildinfo.sh -n %u@@%h%d`"
    conf_servername="`$aux/buildinfo.sh -n %h%d`"
d1494 1
a1494 1
    (cd $src; ./Configure -file Configuration.apaci >/dev/null);
d1496 1
a1496 1
    (cd $src; ./Configure -file Configuration.apaci |\
@


1.3
log
@mod_ssl-2.2.3-1.3.4 (will require libssl-1.1 for https to work, but
mostly harmless otherwise).
@
text
@d58 4
d73 5
d99 13
a111 4
    --help|*--help|*--help* ) help=yes; quiet=yes ;;
    --quiet|*--quiet|*--quiet* ) quiet=yes ;;
    --verbose|*--verbose|*--verbose*|-v|*-v|*-v* ) verbose=yes ;;
    * ) ;;
d115 5
d122 1
a122 1
if [ ".$quiet" = .no ]; then
d145 1
a145 1
if [ ".$perlpath" != . ]; then
d157 1
a157 1
if [ ".$bytes" != .3 ]; then
d159 1
a159 1
    if [ ".$bytes" != .3 ]; then
d178 1
a178 1
if [ ".$awkpath" != . ]; then
d183 33
d237 13
d261 2
a262 1
OIFS="$IFS" IFS='
d279 2
a280 1
OIFS="$IFS" IFS='
d285 1
a285 1
    if [ ".`echo $module | grep '^#'`" != . ]; then
d288 1
a288 1
    if [ ".`echo $module | grep 'SharedModule'`" != . ]; then
d301 1
a301 1
    if [ ".$share" = .yes ]; then
d311 2
a312 1
OIFS="$IFS" IFS="$DIFS"
d315 1
a315 1
    if [ ".$val" != . ]; then
d324 19
d349 2
a350 2
        if [ ".$*" = . ]; then
            set -- '--with-layout=Apache'
d352 1
a352 1
            set -- '--with-layout=Apache' "$@@"
d365 2
a366 1
OIFS1="$IFS" IFS="$DIFS"
d370 1
a370 1
    if [ ".$apc_prev" != . ]; then
d426 1
d444 1
a444 1
            if [ ".$apc_option" = ".--compat" ]; then
d468 2
a469 1
            OIFS="$IFS" IFS="$DIFS"
d471 2
a472 2
                       sysconfdir datadir includedir localstatedir runtimedir \
                       logfiledir proxycachedir; do
d485 1
a485 1
            IFS="$OIFS"
d487 1
a487 1
            if [ ".$prefix" = .UNSET ]; then
d491 1
a491 1
            if [ ".$quiet" = .no ]; then
d494 1
a508 1
OIFS1="$IFS" IFS="$DIFS"
d512 1
a512 1
    if [ ".$apc_prev" != . ]; then
d540 1
a540 1
                    if [ .$quiet = .no ]; then
d548 1
a548 1
                    if [ .$quiet = .no ]; then
d555 3
a557 1
            gnutriple=`$aux/GuessOS | sed -e 's:/:-:g' | $AWK '{ printf("%s",$1); }'`
d559 2
a560 2
            if [ ".`ls $top/src.* 2>/dev/null`" = . ]; then
                if [ .$quiet = .no ]; then
d567 1
a567 1
                if [ ".$shadow" != . ]; then
d586 1
a586 1
            if [ .$quiet = .no ]; then
d659 1
a659 1
            if [ ".`echo $file | egrep '/?mod_[a-zA-Z0-9][a-zA-Z0-9_]*\.c$'`" = . ]; then
d669 1
a669 1
            if [ ".$file" != ".$src/modules/extra/$modfilec" ]; then
d672 1
a672 1
            if [ ".$addconf_created" = .0 ]; then
d690 1
a690 1
            if [ ".$quiet" = .no ]; then
d698 1
a698 1
                *)  echo "configure:Error: Module source already has to stay below src/modules/ to be activated" 1>&2
d703 1
a703 1
            if [ ".$addconf_created" = .0 ]; then
d721 1
a721 1
            if [ ".$quiet" = .no ]; then
d734 2
a735 2
                    apc_optarg=`echo "$apc_optarg" | tr "A-Z" "a-z"`
                    apc_optarg_real=`echo "$apc_optarg" | tr "a-z" "A-Z"`
d737 1
a737 1
                    if [ ".$exists" = . ]; then
d746 2
a747 1
                           OIFS="$IFS" IFS=':'
d751 2
a752 1
                           IFS="$OIFS"
d755 2
a756 1
                           OIFS="$IFS" IFS=':'
d760 1
a760 1
                           IFS="$OIFS"
d765 1
d771 1
a771 1
                           if [ ".$exists" = . ]; then
d782 2
a783 1
                           OIFS="$IFS" IFS=':'
d787 1
a787 1
                           IFS="$OIFS"
d791 2
a792 1
                           OIFS="$IFS" IFS=':'
d795 1
a795 1
                               if [ ".$add" = .no ]; then
d800 1
a800 1
                           IFS="$OIFS"
d805 1
a805 1
                           if [ ".$exists" = . ]; then
d816 4
d831 2
a832 2
                    apc_optarg=`echo "$apc_optarg" | tr "A-Z" "a-z"`
                    apc_optarg_real=`echo "$apc_optarg" | tr "a-z" "A-Z"`
d834 1
a834 1
                    if [ ".$exists" = . ]; then
d843 2
a844 1
                           OIFS="$IFS" IFS=':'
d848 1
a848 1
                           IFS="$OIFS"
d852 1
a852 1
                           if [ ".$exists" = . ]; then
d863 2
a864 1
                           OIFS="$IFS" IFS=':'
d868 1
a868 1
                           IFS="$OIFS"
d872 1
a872 1
                           if [ ".$exists" = . ]; then
d880 4
d894 1
a894 1
                        if [ ".$exists" = . ]; then
d918 3
d956 1
a956 1
if [ ".$apc_prev" != . ]; then
d960 1
a960 1
if [ ".$addconf_created" = .0 ]; then
d979 1
a979 1
           LDFLAGS_SHLIB_EXPORT LIBS INCLUDES RANLIB DEPS TARGET SSL_BASE RSA_BASE; do
d981 1
a981 1
    if [ ".$val" != . ]; then
d1003 2
a1004 2
if [ ".$suexec" = .1 ]; then
    if [ ".$suexec_ok" = .0 ]; then
d1012 3
a1014 3
    if [ ".`id | grep root`" = . ]; then
        echo " + Warning: You enabled the suEXEC feature. Be aware that you need" 1>&2
        echo " + root privileges for this, at the latest at the installation step." 1>&2
d1017 4
a1020 4
if [ ".$PERL" = .no-perl-on-this-system ]; then
    if [ .$quiet = .no ]; then
        echo " + Warning: no Perl interpreter available for support scripts."
        echo " + Perhaps you have to select one with --with-perl=FILE."
d1034 2
a1035 2
if [ ".$TARGET" != . ]; then
    thetarget=$TARGET
d1044 2
a1045 1
OIFS="$IFS" IFS="$DIFS"
d1047 3
a1049 2
           sysconfdir datadir includedir localstatedir runtimedir \
           logfiledir proxycachedir suexec_docroot suexec_logexec; do
d1055 13
a1067 4
    #   add target suffix when requested
    if [ ".`echo $val | grep $thetarget`" = . ]; then
        eval "autosuffix=\$autosuffix_$var"
        if [ ".$autosuffix" = .yes ]; then
d1077 1
a1077 1
if [ ".$support" = .1 ]; then
d1079 5
a1083 1
    install_support='install-support'
d1095 4
d1100 1
d1106 14
a1119 7
if [ ".$confadjust" = .1 ]; then
    if [ ".`egrep '^nobody:' /etc/group`" != . ]; then
        conf_group="nobody"
    else
        if [ ".`egrep '^nogroup:' /etc/group`" != . ]; then
            conf_group="nogroup"
        fi
d1121 1
a1121 1
    if [ ".`id | grep root`" = . ]; then
d1146 1
a1146 1
if [ ".$show_layout" = .1 ]; then
d1157 3
d1178 1
a1178 1
    echo "  SSL_CERTIFCATE_FILE: ${sysconfdir_relative}ssl.crt/server.crt"
d1180 1
a1180 1
    if [ ".$suexec" = .1 ]; then
d1198 1
a1198 1
if [ .$quiet = .no ]; then
d1203 2
d1209 5
d1223 3
d1240 1
d1249 2
a1250 1
-e "s%@@distclean_support@@%$distclean_support%g"
d1272 2
a1273 1
echo "echo '-DSSL_CERTIFCATE_FILE=\"${sysconfdir_relative}ssl.crt/server.crt\"'" >>$src/apaci
d1280 1
a1280 1
if [ .$quiet = .no ]; then
d1287 2
a1288 1
OIFS="$IFS" IFS="$DIFS"
d1290 1
a1290 1
           LDFLAGS_SHLIB_EXPORT LIBS INCLUDES RANLIB DEPS TARGET SSL_BASE RSA_BASE; do
d1292 1
a1292 1
    if [ ".$val" != . ]; then
d1307 2
a1308 1
OIFS="$IFS" IFS=':'
d1310 1
a1310 1
    name="`echo $rule | tr "a-z" "A-Z"`"
d1313 1
a1313 1
    if [ $verbose = yes ]; then
d1321 2
a1322 1
OIFS="$IFS" IFS=':'
d1325 1
a1325 1
    if [ $share = yes ]; then
d1330 2
a1331 2
if [ $some_shares = 1 ]; then
    if [ $module_so = no ]; then
d1333 1
a1333 1
        if [ .$quiet = .no ]; then
d1338 1
a1338 1
if [ ".$shared_so" = .yes ]; then
d1345 1
a1345 1
if [ ".$permute" != . ]; then
d1347 2
a1348 1
    OIFS="$IFS" IFS='
d1418 3
a1420 1
OIFS="$IFS" IFS=':'
d1423 6
a1428 4
    if [ $add = yes ]; then
        echo $SEO "s%^.*\\(AddModule.*[_b/]$module\\..*\\)%\\1%g" >>$sedsubst
        echo $SEO "s%^.*\\(SharedModule.*[_b/]$module\\..*\\)%\\1%g" >>$sedsubst
        m="yes [static]"
d1430 4
a1433 2
        echo $SEO "s%^.*\\(AddModule.*[_b/]$module\\..*\\)%# \\1%g" >>$sedsubst
        echo $SEO "s%^.*\\(SharedModule.*[_b/]$module\\..*\\)%# \\1%g" >>$sedsubst
d1437 4
a1440 3
    if [ $share = yes ]; then
        echo $SEO "s%^\\(.*\\)AddModule\\(.*[_b/]$module\\.\\)[oam].*\\(.*\\)%\\1SharedModule\\2so\\3%g" >>$sedsubst
        m="yes [shared]"
d1442 1
a1442 1
    if [ $verbose = yes ]; then
d1448 9
d1471 2
a1472 1
OIFS="$IFS" IFS="$DIFS"
d1493 1
a1493 1
if [ .$quiet = .yes ]; then
d1505 2
a1506 2
if [ .$quiet = .no ]; then
    if [ ".$shadow" != . ]; then
@


1.2
log
@Apache 1.3.4 merge
@
text
@d181 3
d864 1
a864 1
           LDFLAGS_SHLIB_EXPORT LIBS INCLUDES RANLIB DEPS TARGET; do
d910 7
d968 1
d981 1
d1033 1
d1084 1
d1087 1
d1115 1
d1131 1
a1131 1
           LDFLAGS_SHLIB_EXPORT LIBS INCLUDES RANLIB DEPS TARGET; do
@


1.1
log
@Initial revision
@
text
@d3 1
a3 1
## Copyright (c) 1998 The Apache Group.  All rights reserved.
d61 1
a61 1
##  Written by Ralf S. Engelschall <rse@@apache.org>
a70 1

d77 3
d81 1
a85 1

a98 1

a108 1

a119 1

a131 1

a152 1

d164 1
a164 20
prefix='/usr/local/apache'
exec_prefix='$prefix'
bindir='$exec_prefix/bin'
sbindir='$exec_prefix/sbin'
libexecdir='$exec_prefix/libexec'
mandir='$prefix/man'
sysconfdir='$prefix/etc'
datadir='$prefix/share'
includedir='$prefix/include'
localstatedir='$prefix/var'
runtimedir='$localstatedir/run'
logfiledir='$localstatedir/log'
proxycachedir='$localstatedir/proxy'

#   customization flags for
#   automatic "apache" suffix 
customized_sysconfdir=0
customized_datadir=0
customized_localstatedir=0
customized_includedir=0
d166 3
a168 2
#   check and debug
layout=0
d173 2
d181 1
a181 1
#   with support tools
a182 2

#   with adjustments
d184 1
d187 2
a188 2
rules=""
rulelist=""
d192 1
a192 1
    rule=`echo "$rule" | sed -e 's/^Rule[ ]*//'`
d194 1
a194 1
    namelow=`echo "$name" | tr "A-Z" "a-z"`
d204 2
a205 4
rm -f $addconf 2>/dev/null
touch $addconf
modules=""
modulelist=""
d208 1
a208 1
for module in `egrep '^[# ]*(Add|Shared)Module' $src/Configuration.tmpl`; do
d220 1
d234 1
a234 1
#   backward compatibility from old src/Configuration.tmpl
d248 11
a258 20
#   create a config status script for restoring
#   the configuration via a simple shell script
if [ ".$help" = .no ]; then
    rm -f $configstatus 2>/dev/null
    echo "#!/bin/sh" >$configstatus
    echo "##" >>$configstatus
    echo "##  $configstatus -- APACI auto-generated configuration restore script" >>$configstatus
    echo "##" >>$configstatus
    echo "##  Use this shell script to re-run the APACI configure script for" >>$configstatus
    echo "##  restoring your configuration. Additional parameters can be supplied." >>$configstatus
    echo "##" >>$configstatus
    echo "" >>$configstatus
    for var in CC CPP OPTIM CFLAGS CFLAGS_SHLIB LDFLAGS LD_SHLIB LDFLAGS_SHLIB \
               LDFLAGS_SHLIB_EXPORT LIBS INCLUDES RANLIB; do
        eval "val=\"\$$var\""
        if [ ".$val" != . ]; then
            echo "$var=$val" |\
            sed -e 's:\(["$\\]\):\\\1:g' \
                -e 's:\([A-Z]*=\):\1":' \
                -e 's:$:" \\:' >>$configstatus
d260 2
a261 17
    done
    if [ $# -eq 0 ]; then
        echo "./configure" >>$configstatus
    else
        echo $SEO "./configure \\" >>$configstatus
        for arg
        do
            echo "$arg" |\
            sed -e 's:\(["$\\]\):\\\1:g' \
                -e 's:^:":' \
                -e 's:$:" \\:' >>$configstatus
        done
    fi
    echo '"$@@"' >>$configstatus
    echo '' >>$configstatus
    chmod a+x $configstatus
fi
d264 5
a268 1
##  parse argument line options
d270 133
d404 7
a410 1
apc_prev=""
a424 1

d427 3
d436 21
a456 1
        --shadow)
d468 5
d476 1
a476 1
                echo "	@@\$(MAKE) -f Makefile.\$(GNUTRIPLE) \$(MFLAGS) \$@@" >> Makefile
d485 1
d488 1
a488 1
                echo " + create shadow tree ($shadowsrc)"
a496 1
            rm -f $addconf 2>/dev/null
d498 1
a498 2
            rm -f $addconf 2>/dev/null
            touch $addconf
d500 2
a501 52
        --help | -h | -help )
            echo "Usage: configure [options]"
            echo "Options: [defaults in brackets after descriptions]"
            echo "General options:"
            echo " --quiet, --silent      do not print messages"
            echo " --verbose, -v          print even more messages"
            echo " --shadow               switch to a shadow tree for building"
            echo ""
            echo "Stand-alone options:"
            echo " --help, -h             print this message"
            echo " --layout               print installation layout (check and debug)"
            echo ""
            echo "Installation layout options:"
            echo " --prefix=PREFIX        install architecture-independent files in PREFIX"
            echo " --exec-prefix=EPREFIX  install architecture-dependent files in EPREFIX"
            echo " --bindir=DIR           install user     executables in DIR  [EPREFIX/bin]"
            echo " --sbindir=DIR          install sysadmin executables in DIR  [EPREFIX/sbin]"
            echo " --libexecdir=DIR       install program  executables in DIR  [EPREFIX/libexec]"
            echo " --mandir=DIR           install manual pages in DIR          [PREFIX/man]"
            echo " --sysconfdir=DIR       install configuration files in DIR   [PREFIX/etc]"
            echo " --datadir=DIR          install read-only  data files in DIR [PREFIX/share]"
            echo " --includedir=DIR       install includes files in DIR        [PREFIX/include]"
            echo " --localstatedir=DIR    install modifiable data files in DIR [PREFIX/var]"
            echo " --runtimedir=DIR       install runtime data in DIR          [PREFIX/var/run]"
            echo " --logfiledir=DIR       install logfile data in DIR          [PREFIX/var/log]"
            echo " --proxycachedir=DIR    install proxy cache data in DIR      [PREFIX/var/proxy]"
            echo " --compat               install with old Apache 1.2 installation paths"
            echo ""
            echo "Configuration options:"
            echo " --enable-rule=NAME     enable  a particular Rule named 'NAME'"
            echo " --disable-rule=NAME    disable a particular Rule named 'NAME'"
            $aux/ppl.sh $rulelist
            echo " --add-module=FILE      on-the-fly copy & activate a third-party Module source"
            echo " --activate-module=FILE on-the-fly activate existing third-party Module source"
            echo " --enable-module=NAME   enable  a particular Module named 'NAME'"
            echo " --disable-module=NAME  disable a particular Module named 'NAME'"
            $aux/ppl.sh $modulelist
            echo " --enable-shared=NAME   enable  build of Module named 'NAME' as a shared object"
            echo " --disable-shared=NAME  disable build of Module named 'NAME' as a shared object"
            echo " --with-perl=FILE       set the path to the optional Perl interpreter to use"
            echo " --without-support      disable the build and installation of support tools"
            echo " --without-confadjust   disable some build user/situation adjustments to config files"
            echo ""
            echo "suEXEC options:"
            echo " --enable-suexec        enable the suEXEC feature"
            echo " --suexec-caller=NAME   set the suEXEC username of the allowed caller [$suexec_caller]"
            echo " --suexec-userdir=DIR   set the suEXEC user subdirectory [$suexec_userdir]"
            echo " --suexec-uidmin=UID    set the suEXEC minimal allowed UID [$suexec_uidmin]"
            echo " --suexec-gidmin=GID    set the suEXEC minimal allowed GID [$suexec_gidmin]"
            echo " --suexec-safepath=PATH set the suEXEC safe PATH [$suexec_safepath]"
            echo ""
            exit 0
d503 2
a504 2
        --layout)
            layout=1
d508 1
d512 1
d516 1
d520 1
d524 1
d528 1
d532 1
a532 1
            customized_sysconfdir=1
d536 1
a536 1
            customized_datadir=1
d540 1
a540 1
            customized_includedir=1
d544 1
a544 1
            customized_localstatedir=1
d548 1
d552 1
d556 1
a556 18
            ;;
        --compat) 
            exec_prefix='$prefix'
            bindir='$exec_prefix/bin'
            sbindir='$exec_prefix/bin'
            libexecdir='$exec_prefix/libexec'
            mandir='$prefix/man'
            sysconfdir='$prefix/conf'
            datadir='$prefix'
            includedir='$prefix/include'
            localstatedir='$prefix'
            runtimedir='$localstatedir/logs'
            logfiledir='$localstatedir/logs'
            proxycachedir='$localstatedir/proxy'
            customized_sysconfdir=1
            customized_datadir=1
            customized_localstatedir=1
            customized_includedir=1
d573 5
d604 5
d771 23
d807 8
d842 4
d848 36
a883 1
##  a few errors
a893 6
fi

##
##  a few warnings
##
if [ ".$suexec" = .1 ]; then
d907 9
d920 3
a922 4
for var in prefix exec_prefix bindir sbindir \
           libexecdir mandir sysconfdir datadir \
           includedir localstatedir runtimedir \
           logfiledir proxycachedir; do
d926 9
a934 13
    case $var in
       libexecdir|sysconfdir|datadir|localstatedir|includedir ) 
           eval "val=\$$var"
           case $val in
               *apache | *apache* ) ;;
               * ) eval "customized=\$customized_$var"
                   if [ ".$customized" = .0 ]; then
                       eval "$var=\"\$$var/apache\""
                   fi
                   ;;
           esac
           ;;
    esac
d942 4
a945 4
      build_support=build-support
    install_support=install-support
      clean_support=clean-support
  distclean_support=distclean-support
d947 4
a950 4
      build_support=
    install_support=
      clean_support=
  distclean_support=
d992 1
a992 1
if [ ".$layout" = .1 ]; then
a1010 1
    echo "           SUEXEC_BIN: $sbindir/suexec"
d1012 3
a1014 3
    echo "       DEFAULT_PIDLOG: ${runtimedir_relative}httpd.pid"
    echo "   DEFAULT_SCOREBOARD: ${runtimedir_relative}httpd.scoreboard"
    echo "     DEFAULT_LOCKFILE: ${runtimedir_relative}httpd.lock"
d1018 1
a1018 1
    echo "   SERVER_CONFIG_FILE: ${sysconfdir_relative}httpd.conf"
d1022 12
a1044 1
-e "s%@@TOP@@%$top%g" \
d1048 1
d1065 2
d1091 3
a1093 3
echo "echo '-DDEFAULT_PIDLOG=\"${runtimedir_relative}httpd.pid\"'" >>$src/apaci
echo "echo '-DDEFAULT_SCOREBOARD=\"${runtimedir_relative}httpd.scoreboard\"'" >>$src/apaci
echo "echo '-DDEFAULT_LOCKFILE=\"${runtimedir_relative}httpd.lock\"'" >>$src/apaci
d1097 1
a1097 1
echo "echo '-DSERVER_CONFIG_FILE=\"${sysconfdir_relative}httpd.conf\"'" >>$src/apaci
d1115 1
a1115 1
           LDFLAGS_SHLIB_EXPORT LIBS INCLUDES RANLIB DEPS; do
d1167 72
d1244 2
a1245 2
        echo $SEO "s%^.*\\(AddModule.*$module\\..*\\)%\\1%g" >>$sedsubst
        echo $SEO "s%^.*\\(SharedModule.*$module\\..*\\)%\\1%g" >>$sedsubst
d1248 2
a1249 2
        echo $SEO "s%^.*\\(AddModule.*$module\\..*\\)%# \\1%g" >>$sedsubst
        echo $SEO "s%^.*\\(SharedModule.*$module\\..*\\)%# \\1%g" >>$sedsubst
d1254 1
a1254 1
        echo $SEO "s%^\\(.*\\)AddModule\\(.*$module\\.\\)[oa]\\(.*\\)%\\1SharedModule\\2so\\3%g" >>$sedsubst
d1287 1
a1287 1
eval "cat $src/Configuration.tmpl $addconf | $substcmd >$src/Configuration.apaci"
d1292 1
d1305 16
@


1.1.1.1
log
@Apache 1.3.2
@
text
@@


1.1.1.2
log
@import apache 1.3.26 + mod_ssl 2.8.10
@
text
@d3 1
a3 4
## The Apache Software License, Version 1.1
##
## Copyright (c) 2000-2002 The Apache Software Foundation.  All rights
## reserved.
d10 1
a10 1
##    notice, this list of conditions and the following disclaimer.
d17 23
a39 20
## 3. The end-user documentation included with the redistribution,
##    if any, must include the following acknowledgment:
##       "This product includes software developed by the
##        Apache Software Foundation (http://www.apache.org/)."
##    Alternately, this acknowledgment may appear in the software itself,
##    if and wherever such third-party acknowledgments normally appear.
##
## 4. The names "Apache" and "Apache Software Foundation" must
##    not be used to endorse or promote products derived from this
##    software without prior written permission. For written
##    permission, please contact apache@@apache.org.
##
## 5. Products derived from this software may not be called "Apache",
##    nor may "Apache" appear in their name, without prior written
##    permission of the Apache Software Foundation.
##
## THIS SOFTWARE IS PROVIDED ``AS IS'' AND ANY EXPRESSED OR IMPLIED
## WARRANTIES, INCLUDING, BUT NOT LIMITED TO, THE IMPLIED WARRANTIES
## OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE ARE
## DISCLAIMED.  IN NO EVENT SHALL THE APACHE SOFTWARE FOUNDATION OR
d41 7
a47 7
## SPECIAL, EXEMPLARY, OR CONSEQUENTIAL DAMAGES (INCLUDING, BUT NOT
## LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES; LOSS OF
## USE, DATA, OR PROFITS; OR BUSINESS INTERRUPTION) HOWEVER CAUSED AND
## ON ANY THEORY OF LIABILITY, WHETHER IN CONTRACT, STRICT LIABILITY,
## OR TORT (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT
## OF THE USE OF THIS SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF
## SUCH DAMAGE.
d51 5
a55 7
## individuals on behalf of the Apache Software Foundation.  For more
## information on the Apache Software Foundation, please see
## <http://www.apache.org/>.
##
## Portions of this software are based upon public domain software
## originally written at the National Center for Supercomputing Applications,
## University of Illinois, Urbana-Champaign.
d61 1
a61 1
##  Initially written by Ralf S. Engelschall <rse@@apache.org>
d69 1
a69 1
##  avoid brain dead shells on Ultrix and friends
a70 7
if [ -f /bin/sh5 ]; then
    if [ ".$APACI_SH5_UPGRADE_STEP" != .done ]; then
         APACI_SH5_UPGRADE_STEP=done
         export APACI_SH5_UPGRADE_STEP
         exec /bin/sh5 $0 "$@@"
    fi
fi
a71 3
##
##  the paths to the Apache source tree
##
a77 3
tplconf=src/.apaci.tplconf
pldconf=src/.apaci.pldconf
configlayout=config.layout
a78 1
shadow=''
d83 1
d88 4
a91 13
    --help|*--help|*--help* ) 
        help=yes; quiet=yes
        echo "[hang on a moment, generating help]"
        echo ""
        ;;
    --quiet|*--quiet|*--quiet* ) 
        quiet=yes
        ;;
    --verbose|*--verbose|*--verbose*|-v|*-v|*-v* ) 
        verbose=yes
        ;;
    * ) 
        ;;
d95 1
a95 1
##  determine platform id
a96 1
PLATFORM="`$aux/GuessOS`"
d98 1
a98 4
##
##  display version information
##
if [ "x$quiet" = "xno" ]; then
d100 2
a101 2
         grep "#define SERVER_BASEREVISION" |\
         sed -e 's/^[^"]*"//' -e 's/".*$//' -e 's/^\///'`
d108 1
a117 1
##
d120 1
d123 1
a123 1
if [ "x$perlpath" != "x" ]; then
d133 1
d136 1
a136 1
if [ "x$bytes" != "x3" ]; then
d138 1
a138 1
    if [ "x$bytes" != "x3" ]; then
d155 1
d158 1
a158 1
if [ "x$awkpath" != "x" ]; then
a162 43
## Look for a good Tar. If we don't find 'GNU tar' then make
## sure ours can handle the '-h' (don't copy symlink, copy
## the actual data) option.
##
TAR=tar
tarpath="`$aux/PrintPath gtar gnutar tar`"
if [ "x$tarpath" != "x" ]; then
    TAR="$tarpath"
fi
case "`$TAR --version 2>/dev/null`" in
    *GNU*) TAROPT="-hcf" ;;
    *) if $TAR -hcf - Makefile.tmpl > /dev/null 2>&1
       then
           TAROPT="-hcf"
       else
           TAROPT="-cf"
       fi
       ;;
esac

##
## Request USTAR format for tar files on OS/390
## Request that prelink step be used for 390
##
case $PLATFORM in
    *-IBM-OS390*)
       TAROPT="${TAROPT}U"
       ;;
esac

##
##  determine path to sh, it's not /bin/sh on ALL systems
##
SHELL=/bin/sh
if [ ! -f "$SHELL" ]; then
    SHELL="`$aux/PrintPath sh`"
    if [ "x$SHELL" = "x" ]; then
        echo "configure:Error: Cannot determine path to Bourne-Shell" 1>&2
        exit 1
    fi
fi

##
d167 20
a186 1
prefix=UNSET
d188 2
a189 3
#   layout configuration
with_layout=0
show_layout=0
a193 2
suexec_docroot='$datadir/htdocs'
suexec_logexec='$logfiledir/suexec_log'
a198 2
# if the umask is undefined, we don't change it
#suexec_umask=0755
d200 2
a201 6
#   the installation flags
iflags_program="-m 755 -s"
iflags_core="-m 755"
iflags_dso="-m 755"
iflags_script="-m 755"
iflags_data="-m 644"
d203 1
a203 2
#   various other flags
support=1
a204 1
permute=''
d207 3
a209 4
rules=''
rulelist=''
OIFS="$IFS"
IFS='
d212 1
a212 1
    rule=`echo "$rule" | sed -e 's/^Rule[ 	]*//'`
d214 1
a214 1
    namelow=`echo "$name" | tr '[A-Z]' '[a-z]'`
d224 5
a228 4
modules=''
modulelist=''
OIFS="$IFS"
IFS='
d230 1
a230 1
for module in `egrep '^[# 	]*(Add|Shared)Module' $src/Configuration.tmpl`; do
d233 1
a233 1
    if [ "x`echo $module | grep '^#'`" != "x" ]; then
d236 1
a236 1
    if [ "x`echo $module | grep 'SharedModule'`" != "x" ]; then
a241 1
                -e 's/\.module$//' \
d248 1
a248 1
    if [ "x$share" = "xyes" ]; then
d255 1
a255 1
#   backward compatibility for old src/Configuration.tmpl
d258 1
a258 2
OIFS="$IFS"
IFS="$DIFS"
d261 1
a261 1
    if [ "x$val" != "x" ]; then
d269 20
a288 39
##
## Platform-specific defaults
##
case $PLATFORM in
    *-apple-rhapsody*)
	default_layout="Mac OS X Server"
	iflags_core="${iflags_core} -S \"-S\""
	iflags_dso="${iflags_dso} -S \"-S\""
	;;
    *-apple-darwin*)
	default_layout="Darwin"
	iflags_core="${iflags_core} -S \"-S\"" 
	iflags_dso="${iflags_dso} -S \"-S\""
	;;
    *OS/2* ) 
        default_layout="Apache"
        iflags_program="${iflags_program} -e .exe" 
        iflags_core="${iflags_core} -e .exe" 
        ;;
    *MPE/iX* )
	default_layout="Apache"
	iflags_program="-m 755"
	;;
    *)
	default_layout="Apache"
	;;
esac

##
##  support for the default layout
##
case "$*" in
    *--with-layout=* ) 
        ;;
    * ) 
        if [ "x$*" = "x" ]; then
            set -- --with-layout="$default_layout"
        else
            set -- --with-layout="$default_layout" "$@@"
d290 17
a306 2
        ;;
esac
d309 1
a309 1
##  Initialize server user ID and group ID variables
a310 2
conf_user=""
conf_group=""
d312 2
a313 10
##
##  Iterate over the command line options the first time.
##
##  This time we pre-process options which need high priority 
##  on the command line independent of their position, so they 
##  can be overridden by others.
##
apc_prev=''
OIFS1="$IFS"
IFS="$DIFS"
d317 1
a317 1
    if [ "x$apc_prev" != "x" ]; then
a326 131
    #  pre-process only a few options now
    case "$apc_option" in
        --help | -h | -help )
            echo "Usage: configure [options]"
            echo "Options: [defaults in brackets after descriptions]"
            echo "General options:"
            echo " --quiet, --silent      do not print messages"
            echo " --verbose, -v          print even more messages"
            echo " --shadow[=DIR]         switch to a shadow tree (under DIR) for building"
            echo ""
            echo "Stand-alone options:"
            echo " --help, -h             print this message"
            echo " --show-layout          print installation path layout (check and debug)"
            echo ""
            echo "Installation layout options:"
            echo " --with-layout=[F:]ID   use installation path layout ID (from file F)"
            echo " --target=TARGET        install name-associated files using basename TARGET"
            echo " --prefix=PREFIX        install architecture-independent files in PREFIX"
            echo " --exec-prefix=EPREFIX  install architecture-dependent files in EPREFIX"
            echo " --bindir=DIR           install user     executables in DIR"
            echo " --sbindir=DIR          install sysadmin executables in DIR"
            echo " --libexecdir=DIR       install program  executables in DIR"
            echo " --mandir=DIR           install manual pages in DIR"
            echo " --sysconfdir=DIR       install configuration files in DIR"
            echo " --datadir=DIR          install read-only data files in DIR"
            echo " --iconsdir=DIR         install read-only icon files in DIR"
            echo " --htdocsdir=DIR        install read-only welcome pages in DIR"
            echo " --manualdir=DIR        install read-only on-line documentation in DIR"
            echo " --cgidir=DIR           install read-only cgi files in DIR"
            echo " --includedir=DIR       install includes files in DIR"
            echo " --localstatedir=DIR    install modifiable data files in DIR"
            echo " --runtimedir=DIR       install runtime data in DIR"
            echo " --logfiledir=DIR       install logfile data in DIR"
            echo " --proxycachedir=DIR    install proxy cache data in DIR"
            echo ""
            echo "Configuration options:"
            echo " --enable-rule=NAME     enable  a particular Rule named 'NAME'"
            echo " --disable-rule=NAME    disable a particular Rule named 'NAME'"
            $aux/ppl.sh $rulelist
            echo " --add-module=FILE      on-the-fly copy & activate a 3rd-party Module"
            echo " --activate-module=FILE on-the-fly activate existing 3rd-party Module"
            echo " --permute-module=N1:N2 on-the-fly permute module 'N1' with module 'N2'"
            echo " --enable-module=NAME   enable  a particular Module named 'NAME'"
            echo " --disable-module=NAME  disable a particular Module named 'NAME'"
            $aux/ppl.sh $modulelist
            echo " --enable-shared=NAME   enable  build of Module named 'NAME' as a DSO"
            echo " --disable-shared=NAME  disable build of Module named 'NAME' as a DSO"
            echo " --with-perl=FILE       path to the optional Perl interpreter"
            echo " --with-port=PORT       set the port number for httpd.conf"
            echo " --without-support      disable the build and installation of support tools"
            echo " --without-confadjust   disable the user/situation adjustments in config"
            echo " --without-execstrip    disable the stripping of executables on installation"
            echo " --server-uid=UID       set the user ID the web server should run as [nobody]"
            echo " --server-gid=GID       set the group ID the web server UID is a memeber of [#-1]"
            echo ""
            echo "suEXEC options:"
            echo " --enable-suexec        enable the suEXEC feature"
            echo " --suexec-caller=NAME   set the suEXEC username of the allowed caller [$suexec_caller]"
            echo " --suexec-docroot=DIR   set the suEXEC root directory [PREFIX/share/htdocs]"
            echo " --suexec-logfile=FILE  set the suEXEC logfile [PREFIX/var/log/suexec_log]"
            echo " --suexec-userdir=DIR   set the suEXEC user subdirectory [$suexec_userdir]"
            echo " --suexec-uidmin=UID    set the suEXEC minimal allowed UID [$suexec_uidmin]"
            echo " --suexec-gidmin=GID    set the suEXEC minimal allowed GID [$suexec_gidmin]"
            echo " --suexec-safepath=PATH set the suEXEC safe PATH [$suexec_safepath]"
            echo " --suexec-umask=UMASK   set the umask for the suEXEC'd script [server's umask]"
            echo ""
            echo "Deprecated options:"
            echo " --layout               backward compat only: use --show-layout"
            echo " --compat               backward compat only: use --with-layout=Apache"
            exit 0
            ;;
        --with-layout=*|--compat)
            if [ "x$apc_option" = "x--compat" ]; then
                apc_optarg="Apache"
            fi
            case $apc_optarg in
                *:* ) 
                    file=`echo $apc_optarg | sed -e 's/:.*//'`
                    name=`echo $apc_optarg | sed -e 's/.*://'`
                    ;;
                * ) 
                    name=$apc_optarg
                    file=$configlayout
                    ;;
            esac
            if [ ! -f "$file" ]; then
                echo "configure:Error: Path layout definition file $file not found" 1>&2
                exit 1
            fi
            (echo ''; cat $file; echo '') |\
            sed -e "1,/[ 	]*<[Ll]ayout[ 	]*$name[ 	]*>[ 	]*/d" \
                -e '/[ 	]*<\/Layout>[ 	]*/,$d' \
                -e "s/^[ 	]*//g" \
                -e "s/:[ 	]*/=\'/g" \
                -e "s/[ 	]*$/'/g" \
                >$pldconf
            . $pldconf
            OOIFS="$IFS"  # most likely not needed: jmj
            IFS="$DIFS"   # ditto
            for var in prefix exec_prefix bindir sbindir libexecdir mandir \
                       sysconfdir datadir iconsdir htdocsdir manualdir cgidir \
                       includedir localstatedir runtimedir logfiledir \
                       proxycachedir; do
                eval "val=\"\$$var\""
                case $val in
                    *+ )
                        val=`echo $val | sed -e 's;\+$;;'`
                        eval "$var=\"\$val\""
                        eval "autosuffix_$var=yes"
                        ;;
                    * )
                        eval "autosuffix_$var=no"
                        ;;
                esac
            done
            IFS="$OOIFS"
            rm -f $pldconf 2>/dev/null
            if [ "x$prefix" = "xUNSET" ]; then
                echo "configure:Error: Path layout definition not found or incorrect" 1>&2
                exit 1
            fi
            if [ "x$quiet" = "xno" ]; then
                echo " + using installation path layout: $name ($file)"
            fi
            name_layout=$name
            with_layout=1
            ;;
        *)
            ;;
    esac
done
a327 20
##
##  Iterate over the command line options the second time.
##
##  This time we parse the standard options.
##
addconf_created=0
apc_prev=''
for apc_option
do
    #   if previous option needs an argument, assign it.
    if [ "x$apc_prev" != "x" ]; then
        eval "$apc_prev=\$apc_option"
        apc_prev=""
        continue
    fi
    #   split out arguments
    case "$apc_option" in
        -*=*) apc_optarg=`echo "$apc_option" | sed 's/[-_a-zA-Z0-9]*=//'` ;;
           *) apc_optarg= ;;
    esac
a329 3
        --help|-h|-help|--with-layout=*|-compat)
            #   just ignore already parsed options
            ;;
d336 1
a336 21
        --shadow*)
            #   if we use an external shadow tree, first shadow all of ourself
            #   to this tree and switch over to to it for internal (=platform)
            #   shadowing...
            case "$apc_option" in
                --shadow=*)
                    shadow="$apc_optarg"
                    if [ "x$quiet" = "xno" ]; then
                        echo " + creating external package shadow tree ($shadow)"
                    fi
                    rm -rf $shadow 2>/dev/null
                    $aux/mkshadow.sh . $shadow
                    for file in $mkf $sedsubst $addconf $tplconf $pldconf $configstatus; do
                        rm -f $shadow/$file 2>/dev/null
                    done
                    if [ "x$quiet" = "xno" ]; then
                        echo " + switching to external package shadow tree ($shadow)"
                    fi
                    cd $shadow
                    ;;
            esac
d338 1
a338 1
            gnutriple=`echo "$PLATFORM" | sed -e 's:/:-:g' | $AWK '{ printf("%s",$1); }'`
d340 2
a341 2
            if [ "x`ls $top/src.* 2>/dev/null`" = "x" ]; then
                if [ "x$quiet" = "xno" ]; then
d348 1
a348 8
                if [ "x$shadow" != "x" ]; then
                    echo "SHADOW=$shadow" >> Makefile
                else
                    echo "SHADOW=." >> Makefile
                fi
                #   (the use of `awk' and not `$AWK' here is correct, because this
                #   Makefile is for platform bootstrapping, so don't hardcode paths)
                echo "GNUTRIPLE=\`$aux/GuessOS | sed -e 's:/:-:g' | awk '{ printf(\"%s\",\$\$1); }'\`" >> Makefile
d351 1
a351 1
                echo "	@@cd \$(SHADOW); \$(MAKE) -f Makefile.\$(GNUTRIPLE) \$(MFLAGS) \$@@" >> Makefile
a359 1
            shadowtplconf="src.$gnutriple/.apaci.tplconf"
d361 2
a362 2
            if [ "x$quiet" = "xno" ]; then
                echo " + creating internal platform shadow tree ($shadowsrc)"
d371 1
d373 2
a374 1
            tplconf=$shadowtplconf
d376 52
a427 2
        --show-layout|--layout)
            show_layout=1
d429 2
a430 2
        --target=*)
            TARGET="$apc_optarg"
a433 1
            autosuffix_prefix=no
a436 1
            autosuffix_exec_prefix=no
a439 1
            autosuffix_bindir=no
a442 1
            autosuffix_sbindir=no
a445 1
            autosuffix_libexecdir=no
a448 1
            autosuffix_mandir=no
d452 1
a452 1
            autosuffix_sysconfdir=no
d456 1
a456 17
            autosuffix_datadir=no
            ;;
        --iconsdir=*) 
            iconsdir="$apc_optarg" 
            autosuffix_iconsdir=no
            ;;
        --htdocsdir=*) 
            htdocsdir="$apc_optarg" 
            autosuffix_htdocsdir=no
            ;;
        --manualdir=*) 
            manualdir="$apc_optarg" 
            autosuffix_manualdir=no
            ;;
        --cgidir=*) 
            cgidir="$apc_optarg" 
            autosuffix_cgidir=no
d460 1
a460 1
            autosuffix_includedir=no
d464 1
a464 1
            autosuffix_localstatedir=no
a467 1
            autosuffix_runtimedir=no
a470 1
            autosuffix_logfiledir=no
d474 18
a491 1
            autosuffix_proxycachedir=no
d495 1
a495 1
            if [ "x`echo $file | egrep '/?mod_[a-zA-Z0-9][a-zA-Z0-9_]*\.c$'`" = "x" ]; then
d505 1
a505 1
            if [ "x$file" != "x$src/modules/extra/$modfilec" ]; then
a507 5
            if [ "x$addconf_created" = "x0" ]; then
                addconf_created=1
                rm -f $addconf 2>/dev/null
                touch $addconf 2>/dev/null
            fi
d521 1
a521 1
            if [ "x$quiet" = "xno" ]; then
d529 1
a529 1
                *)  echo "configure:Error: Module source already has to be below src/modules/ to be activated" 1>&2
a533 5
            if [ "x$addconf_created" = "x0" ]; then
                addconf_created=1
                rm -f $addconf 2>/dev/null
                touch $addconf 2>/dev/null
            fi
d547 1
a547 1
            if [ "x$quiet" = "xno" ]; then
d560 2
a561 2
                    apc_optarg=`echo "$apc_optarg" | tr '[A-Z]' '[a-z]'`
                    apc_optarg_real=`echo "$apc_optarg" | tr '[a-z]' '[A-Z]'`
d563 1
a563 1
                    if [ "x$exists" = "x" ]; then
d572 1
a572 2
                           OOIFS="$IFS"
                           IFS=':'
d576 1
a576 2
                           IFS="$OOIFS"
                           module_auth_digest=no # conflict with mod_digest
d579 1
a579 2
                           OOIFS="$IFS"
                           IFS=':'
d583 1
a583 1
                           IFS="$OOIFS"
a587 1
                           module_auth_digest=no # conflict with mod_digest
d593 1
a593 1
                           if [ "x$exists" = "x" ]; then
d604 1
a604 2
                           OOIFS="$IFS"
                           IFS=':'
d608 1
a608 1
                           IFS="$OOIFS"
d612 1
a612 2
                           OOIFS="$IFS"
                           IFS=':'
d615 1
a615 1
                               if [ "x$add" = "xno" ]; then
d620 1
a620 1
                           IFS="$OOIFS"
d625 1
a625 1
                           if [ "x$exists" = "x" ]; then
a635 4
                * ) 
                    echo "configure:Error: invalid option '$apc_option'" 1>&2
                    exit 1
                    ;;
d647 2
a648 2
                    apc_optarg=`echo "$apc_optarg" | tr '[A-Z]' '[a-z]'`
                    apc_optarg_real=`echo "$apc_optarg" | tr '[a-z]' '[A-Z]'`
d650 1
a650 1
                    if [ "x$exists" = "x" ]; then
d659 1
a659 2
                           OOIFS="$IFS"
                           IFS=':'
d663 1
a663 1
                           IFS="$OOIFS"
d667 1
a667 1
                           if [ "x$exists" = "x" ]; then
d678 1
a678 2
                           OOIFS="$IFS"
                           IFS=':'
d682 1
a682 1
                           IFS="$OOIFS"
d686 1
a686 1
                           if [ "x$exists" = "x" ]; then
a693 4
                * ) 
                    echo "configure:Error: invalid option '$apc_option'" 1>&2
                    exit 1
                    ;;
a695 23
        --permute-module=*:*)
            mod1=`echo $apc_optarg | sed -e 's/:.*//'`
            mod2=`echo $apc_optarg | sed -e 's/.*://'`
            for mod in $mod1 $mod2; do
                case $mod in
                    BEGIN|END)
                        ;;
                    *)  eval "exists=\$module_${mod}" 
                        if [ "x$exists" = "x" ]; then
                            echo "configure:Error: No such module named '${mod}'" 1>&2
                            exit 1
                        fi
                        ;;
                esac
            done
            case $mod1:$mod2 in
                BEGIN:END|*:BEGIN|END:*)
                    echo "configure:Error: Invalid combination of pseudo module identifiers" 1>&2
                    exit 1
                    ;;
            esac
            permute="${permute},${mod1}:${mod2}"
            ;;
a698 3
        --with-port=*)
            port="$apc_optarg"
            ;;
a704 3
        --without-execstrip)
            iflags_program=`echo "$iflags_program" | sed -e 's/-s//'`
            ;;
a708 8
        --suexec-docroot=*)
            suexec_docroot="$apc_optarg"
            suexec_ok=1
            ;;
        --suexec-logfile=*)
            suexec_logexec="$apc_optarg"
            suexec_ok=1
            ;;
a724 21
        --suexec-umask=*)
            suexec_umask_val="$apc_optarg"
            suexec_umask="-DSUEXEC_UMASK=$apc_optarg"
            suexec_ok=1
            ;;
        --server-uid=*)
            conf_user="$apc_optarg"
	    # protect the '#' against interpretation as comment
	    case x"${conf_user}" in
              "#"*)  conf_user="\\\\${conf_user}";;
              "\\#"*)conf_user="\\${conf_user}";;
            esac
            ;;
        --server-gid=*)
            conf_group="$apc_optarg"
	    # protect the '#' against interpretation as comment
	    case x"${conf_group}" in
              "#"*)  conf_group="\\\\${conf_group}";;
              "\\#"*)conf_group="\\${conf_group}";;
            esac
            ;;
d732 1
a732 1
if [ "x$apc_prev" != "x" ]; then
a735 4
if [ "x$addconf_created" = "x0" ]; then
    rm -f $addconf 2>/dev/null
    touch $addconf 2>/dev/null
fi
d738 1
a738 2
##   create a config status script for restoring
##   the configuration via a simple shell script
d740 2
a741 36
rm -f $configstatus 2>/dev/null
echo "#!/bin/sh" >$configstatus
echo "##" >>$configstatus
echo "##  $configstatus -- APACI auto-generated configuration restore script" >>$configstatus
echo "##" >>$configstatus
echo "##  Use this shell script to re-run the APACI configure script for" >>$configstatus
echo "##  restoring your configuration. Additional parameters can be supplied." >>$configstatus
echo "##" >>$configstatus
echo "" >>$configstatus
for var in CC CPP OPTIM CFLAGS CFLAGS_SHLIB LDFLAGS LD_SHLIB LDFLAGS_SHLIB \
           LDFLAGS_SHLIB_EXPORT LIBS INCLUDES RANLIB DEPS TARGET; do
    eval "val=\"\$$var\""
    if [ "x$val" != "x" ]; then
        echo "$var=$val" |\
        sed -e 's:\(["$\\]\):\\\1:g' \
            -e 's:\([A-Z]*=\):\1":' \
            -e 's:$:" \\:' >>$configstatus
    fi
done
echo $SEO "./configure \\" >>$configstatus
for arg
do
    echo "$arg" |\
    sed -e 's:\(["$\\]\):\\\1:g' \
        -e 's:^:":' \
        -e 's:$:" \\:' >>$configstatus
done
echo '"$@@"' >>$configstatus
echo '' >>$configstatus
chmod a+x $configstatus

##
##  a few errors and warnings
##
if [ "x$suexec" = "x1" ]; then
    if [ "x$suexec_ok" = "x0" ]; then
a748 10
    if [ "x`$aux/getuid.sh`" != "x0" ]; then
        echo " + Warning: You have enabled the suEXEC feature. Be aware that you need" 1>&2
        echo " + root privileges to complete the final installation step." 1>&2
    fi
fi
if [ "x$PERL" = "xno-perl-on-this-system" ]; then
    if [ "x$quiet" = "xno" ]; then
        echo " + Warning: no Perl interpreter detected for support scripts."
        echo " + Perhaps you need to specify one with --with-perl=FILE."
    fi
d752 1
a752 1
##  target name
d754 11
a764 4
if [ "x$TARGET" != "x" ]; then
    thetarget="$TARGET"
else
    thetarget=httpd
d769 1
a769 1
##  they do not end in a backslash
d771 5
a775 6
OIFS="$IFS"
IFS="$DIFS"
for var in prefix exec_prefix bindir sbindir libexecdir mandir \
           sysconfdir datadir iconsdir htdocsdir manualdir cgidir \
           includedir localstatedir runtimedir logfiledir \
           proxycachedir suexec_docroot suexec_logexec ; do
d777 1
a777 1
    val=`echo $val | sed -e 's:\(.\)/*$:\1:'`
d779 13
a791 18
    #   expand value
    eval "val=\$$var"
    #   automatically add target suffix to path when it's
    #   requested (path has a trailing plus in config.layout) and
    #   looks reasonable (i.e. when "apache" or target-name
    #   still not part of path)
    eval "autosuffix=\$autosuffix_$var"
    if [ "x$autosuffix" = "xyes" ]; then
        addtarget=no
        if [ "x`echo $val | grep apache`" = "x" ]; then
            if [ "x`echo $val | grep $thetarget`" = "x" ]; then
                addtarget=yes
            fi
        fi
        if [ "x$addtarget" = "xyes" ]; then
            eval "$var=\"\$$var/$thetarget\""
        fi
    fi
d798 5
a802 9
if [ "x$support" = "x1" ]; then
    build_support='build-support'
    if [ "x$name_layout" = "xBinaryDistribution" ]; then
        install_support='install-binsupport'
    else
        install_support='install-support'
    fi
    clean_support='clean-support'
    distclean_support='distclean-support'
d804 4
a807 4
    build_support=''
    install_support=''
    clean_support=''
    distclean_support=''
a811 4
## 
##  The checks via /etc/passwd and /etc/group will obviously fail
##  on platforms using NIS. But then you propably do not want a
##  UID/GID as production oriented as a web server in NIS anyway.
d813 2
a814 5
if [ "x$port" != "x" ]; then
    conf_port=$port
else
    conf_port="80"
fi
d817 6
a822 9
if [ "x$confadjust" = "x1" ]; then
    if [ -f /etc/passwd ]; then
        if [ "x$conf_user" = "x" ]; then
        for uid in nobody www daemon demon http httpd; do 
            if [ "x`egrep \^${uid}: /etc/passwd`" != "x" ]; then
                conf_user="$uid"
                break
            fi
        done
a823 7
        if [ "x$conf_group" = "x" ]; then
        for gid in nobody nogroup www daemon demon http httpd; do 
            if [ "x`egrep \^${gid}: /etc/group`" != "x" ]; then
                conf_group="$gid"
                break
            fi
        done
d825 1
a825 2
    fi
    if [ "x`$aux/getuid.sh`" != "x0" -a "x$port" = "x" ]; then
a832 11
## Default server user id and group id if not specified on configure invocation and none
## of the ids in /etc/passwd or /etc/group worked.
##
if [ "x$conf_user" = "x" ]; then
    conf_user="nobody"
fi
if [ "x$conf_group" = "x" ]; then
    conf_group="\\\\#-1"
fi

##
d849 1
a849 1
if [ "x$show_layout" = "x1" ]; then
a859 4
    echo "             iconsdir: $iconsdir" 
    echo "            htdocsdir: $htdocsdir" 
    echo "            manualdir: $manualdir" 
    echo "               cgidir: $cgidir" 
d868 1
d870 4
a873 3
    echo "       DEFAULT_PIDLOG: ${runtimedir_relative}${thetarget}.pid"
    echo "   DEFAULT_SCOREBOARD: ${runtimedir_relative}${thetarget}.scoreboard"
    echo "     DEFAULT_LOCKFILE: ${runtimedir_relative}${thetarget}.lock"
d876 1
a876 1
    echo "   SERVER_CONFIG_FILE: ${sysconfdir_relative}${thetarget}.conf"
a879 17
    if [ "x$suexec" = "x1" ]; then
        echo "suEXEC setup:"
        echo "        suexec binary: $sbindir/suexec"
        echo "        document root: $suexec_docroot"
        echo "       userdir suffix: $suexec_userdir"
        echo "              logfile: $suexec_logexec"
        echo "            safe path: $suexec_safepath"
        echo "            caller ID: $suexec_caller"
        echo "      minimum user ID: $suexec_uidmin"
        echo "     minimum group ID: $suexec_gidmin"
        if [ "x$suexec_umask" != "x" ]; then
            echo "                umask: $suexec_umask_val"
	else
            echo "                umask: running server's"
        fi
        echo ""
    fi
d886 1
a886 1
if [ "x$quiet" = "xno" ]; then
a889 1
-e "s%@@PLATFORM@@%$PLATFORM%g" \
d891 1
a891 2
-e "s%@@TAR@@%$TAR%g" \
-e "s%@@TAROPT@@%$TAROPT%g" \
a894 6
-e "s%@@TARGET@@%$thetarget%g" \
-e "s%@@IFLAGS_PROGRAM@@%$iflags_program%g" \
-e "s%@@IFLAGS_CORE@@%$iflags_core%g" \
-e "s%@@IFLAGS_DSO@@%$iflags_dso%g" \
-e "s%@@IFLAGS_SCRIPT@@%$iflags_script%g" \
-e "s%@@IFLAGS_DATA@@%$iflags_data%g" \
a903 4
-e "s%@@iconsdir@@%$iconsdir%g" \
-e "s%@@htdocsdir@@%$htdocsdir%g" \
-e "s%@@manualdir@@%$manualdir%g" \
-e "s%@@cgidir@@%$cgidir%g" \
a910 2
-e "s%@@suexec_docroot@@%$suexec_docroot%g" \
-e "s%@@suexec_logexec@@%$suexec_logexec%g" \
a914 2
-e "s%@@suexec_umask@@%$suexec_umask%g" \
-e "s%@@conf_user@@%$conf_user%g" \
d922 1
a922 2
-e "s%@@distclean_support@@%$distclean_support%g" \
-e "s%@@SHELL@@%$SHELL%g"
d935 4
a938 3
echo "echo '-DDEFAULT_PIDLOG=\"${runtimedir_relative}${thetarget}.pid\"'" >>$src/apaci
echo "echo '-DDEFAULT_SCOREBOARD=\"${runtimedir_relative}${thetarget}.scoreboard\"'" >>$src/apaci
echo "echo '-DDEFAULT_LOCKFILE=\"${runtimedir_relative}${thetarget}.lock\"'" >>$src/apaci
d941 1
a941 1
echo "echo '-DSERVER_CONFIG_FILE=\"${sysconfdir_relative}${thetarget}.conf\"'" >>$src/apaci
d950 1
a950 1
if [ "x$quiet" = "xno" ]; then
d957 1
a957 2
OIFS="$IFS"
IFS="$DIFS"
d959 1
a959 1
           LDFLAGS_SHLIB_EXPORT LIBS INCLUDES RANLIB DEPS TARGET; do
d961 1
a961 1
    if [ "x$val" != "x" ]; then
d976 1
a976 2
OIFS="$IFS"
IFS=':'
d978 1
a978 1
    name="`echo $rule | tr '[a-z]' '[A-Z]'`"
d981 1
a981 1
    if [ "x$verbose" = "xyes" ]; then
d989 1
a989 2
OIFS="$IFS"
IFS=':'
d992 1
a992 1
    if [ "x$share" = "xyes" ]; then
d997 2
a998 2
if [ "x$some_shares" = "x1" ]; then
    if [ "x$module_so" = "xno" ]; then
d1000 1
a1000 1
        if [ "x$quiet" = "xno" ]; then
d1005 1
a1005 1
if [ "x$shared_so" = "xyes" ]; then
a1010 73
#   module permutation support
if [ "x$permute" != "x" ]; then
    sed -e '/## mod_mmap_static/,$d' <src/Configuration.tmpl >$tplconf
    OIFS="$IFS"
    IFS='
'
    for line in `cat src/Configuration.tmpl $addconf | egrep '^[# ]*(Add|Shared)Module'`; do
        name=`echo "$line" |\
              sed -e 's%^.*/\(.*\)$%\1%' \
                  -e 's/\.[oa]$//' \
                  -e 's/\.module$//' \
                  -e 's/^mod_//' \
                  -e 's/^lib//'`
        echo "${name}:${line}"
    done |\
    $AWK -F: '
        BEGIN { 
            n = 0; 
        }
        { 
            module_pos[$1]  = n; 
            module_list[n]  = $1; 
            module_line[$1] = $2;
            n++; 
        }
        END {
            pn = split(permute, perm, ",");
            for (p = 1; p <= pn; p++) {
                split(perm[p], m, ":")
                m1 = m[1];
                m2 = m[2];
                if (m1 == "BEGIN") {
                    for (i = module_pos[m2]-1; i >= 0; i--) {
                        n1 = module_list[i];
                        n2 = module_list[i+1];
                        module_list[i]   = n2;
                        module_list[i+1] = n1;
                        module_pos[n1]   = i+1;
                        module_pos[n2]   = i;
                    }
                }
                else if (m2 == "END") {
                    for (i = module_pos[m1]; i < n-1; i++) {
                        n1 = module_list[i];
                        n2 = module_list[i+1];
                        module_list[i]   = n2;
                        module_list[i+1] = n1;
                        module_pos[n1]   = i+1;
                        module_pos[n2]   = i;
                    }
                }
                else {
                    p1 = module_pos[m1];
                    p2 = module_pos[m2];
                    n1 = module_list[p1];
                    n2 = module_list[p2];
                    module_list[p1] = n2;
                    module_list[p2] = n1;
                    module_pos[m1] = p2;
                    module_pos[m2] = p1;
                }
            }
            for (i = 0; i < n; i++) {
                name = module_list[i];
                printf("%s\n", module_line[name]);
            }
        }
    ' "permute=$permute" >>$tplconf
    IFS="$OIFS"
else
    cat $src/Configuration.tmpl $addconf >$tplconf
fi

d1012 1
a1012 3
#   (paths are modules/foo/mod_bar.ext and modules/foo/libbar.ext)
OIFS="$IFS"
IFS=':'
d1015 4
a1018 6
    if [ "x$add" = "xyes" ]; then
        echo $SEO "s%^.*\\(AddModule.*mod_$module\\..*\\)%\\1%g" >>$sedsubst
        echo $SEO "s%^.*\\(AddModule.*lib$module\\..*\\)%\\1%g" >>$sedsubst
        echo $SEO "s%^.*\\(SharedModule.*mod_$module\\..*\\)%\\1%g" >>$sedsubst
        echo $SEO "s%^.*\\(SharedModule.*lib$module\\..*\\)%\\1%g" >>$sedsubst
        m="yes"
d1020 2
a1021 4
        echo $SEO "s%^.*\\(AddModule.*mod_$module\\..*\\)%# \\1%g" >>$sedsubst
        echo $SEO "s%^.*\\(AddModule.*lib$module\\..*\\)%# \\1%g" >>$sedsubst
        echo $SEO "s%^.*\\(SharedModule.*mod_$module\\..*\\)%# \\1%g" >>$sedsubst
        echo $SEO "s%^.*\\(SharedModule.*lib$module\\..*\\)%# \\1%g" >>$sedsubst
d1025 3
a1027 4
    if [ "x$share" = "xyes" ]; then
        echo $SEO "s%^\\(.*\\)AddModule\\(.*mod_$module\\.\\)[oam].*\\(.*\\)%\\1SharedModule\\2so\\3%g" >>$sedsubst
        echo $SEO "s%^\\(.*\\)AddModule\\(.*lib$module\\.\\)[oam].*\\(.*\\)%\\1SharedModule\\2so\\3%g" >>$sedsubst
        m="$m [shared]"
d1029 1
a1029 1
    if [ "x$verbose" = "xyes" ]; then
a1034 13
# translate module names to dll names for OS/2 so that they are no more
# than 8 characters long and have an extension of "dll" instead of "so"
case $PLATFORM in
    *OS/2* ) 
        echo $SEO "s%/mod_\\(.\\{1,8\\}\\).*\\.so%/\\1\\.dll%" >>$sedsubst
        echo $SEO "s%/\\(lib.*\\)\\.so$%/\\1.dll%" >>$sedsubst
        ;;
    *cygwin* ) 
        echo $SEO "s%/\\(mod_.*\\)\\.so$%/\\1.dll%" >>$sedsubst
        echo $SEO "s%/\\(lib.*\\)\\.so$%/\\1.dll%" >>$sedsubst
        ;;
esac

d1049 1
a1049 2
OIFS="$IFS"
IFS="$DIFS"
d1059 1
a1059 1
eval "cat $tplconf | $substcmd >$src/Configuration.apaci"
a1063 1
rm -f $tplconf 2>/dev/null
d1069 2
a1070 5
if [ "x$verbose" = "xyes" ]; then
    vflag="-v";
fi
rc=`if [ "x$quiet" = "xyes" ]; then
    (cd $src; ./Configure ${vflag} -file Configuration.apaci >/dev/null; echo $? >&3; );
d1072 1
a1072 1
    (cd $src; ( ./Configure ${vflag} -file Configuration.apaci; echo $? >&3; ) |\
a1075 24
fi 3>&1 1>&2`

## Ugly. So far, we've only used -eq, so just in case, use this
## stupid code unless we're *sure* that -ne is also available
if [ $rc -eq 0 ]; then
    :
else
    exit 1
fi

##
##  final hints
##
if [ "x$quiet" = "xno" ]; then
    if [ "x$shadow" != "x" ]; then
        echo "Hint: You now have to build inside $shadow."
        echo "This can be done either by running the canonical commands"
        echo "  \$ cd $shadow"
        echo "  \$ make"
        echo "  \$ make install"
        echo "or by running this alternative commands"
        echo "  \$ make -f $shadow/Makefile"
        echo "  \$ make -f $shadow/Makefile install"
    fi
@


1.1.1.3
log
@import apache 1.3.27 and mod_ssl 2.8.11
@
text
@a260 3
#   ssl defaults
ssl=0

d1052 1
a1052 1
           LDFLAGS_SHLIB_EXPORT LIBS INCLUDES RANLIB DEPS TARGET EAPI_MM SSL_BASE; do
a1097 7
##  SSL support
##
if [ ".$module_ssl" = .yes ]; then
    ssl=1
fi

##
a1170 1
conf_port_ssl="443"
a1193 1
        conf_port_ssl="8443"
a1258 1
    echo " SSL_CERTIFICATE_FILE: ${sysconfdir_relative}ssl.crt/server.crt"
a1326 1
-e "s%@@ssl@@%$ssl%g" \
a1329 1
-e "s%@@conf_port_ssl@@%$conf_port_ssl%g" \
a1356 2
echo "echo '-DSSL_CERTIFICATE_FILE=\"${sysconfdir_relative}ssl.crt/server.crt\"'" >>$src/apaci
echo "echo '-DEAPI_MM_CORE_PATH=\"${runtimedir_relative}${thetarget}.mm\"'" >>$src/apaci
d1373 1
a1373 1
           LDFLAGS_SHLIB_EXPORT LIBS INCLUDES RANLIB DEPS TARGET EAPI_MM SSL_BASE; do
@


1.1.1.4
log
@import apache 1.3.28 and mod_ssl 2.8.15
@
text
@d5 1
a5 1
## Copyright (c) 2000-2003 The Apache Software Foundation.  All rights
d1006 1
a1006 1
            suexec_umask="-DSUEXEC_UMASK=0$apc_optarg"
@


