head	1.5;
access;
symbols
	apache_1_3_29-mod_ssl_2_8_16:1.1.1.3
	apache_1_3_28-mod_ssl_2_8_15:1.1.1.2
	OPENBSD_3_3:1.3.0.6
	OPENBSD_3_3_BASE:1.3
	apache_1_3_27-mod_ssl_2_8_12:1.1.1.1
	apache_1_3_27:1.1.1.1
	OPENBSD_3_2:1.3.0.4
	OPENBSD_3_2_BASE:1.3
	apache_1_3_26:1.1.1.1
	apache:1.1.1
	OPENBSD_3_1:1.3.0.2
	OPENBSD_3_1_BASE:1.3
	OPENBSD_3_0:1.2.0.4
	OPENBSD_3_0_BASE:1.2
	OPENBSD_2_9_BASE:1.2
	OPENBSD_2_9:1.2.0.2;
locks; strict;
comment	@# @;


1.5
date	2003.08.27.14.34.36;	author fgsch;	state dead;
branches;
next	1.4;

1.4
date	2003.08.21.13.11.34;	author henning;	state Exp;
branches;
next	1.3;

1.3
date	2002.03.29.02.08.05;	author beck;	state Exp;
branches;
next	1.2;

1.2
date	2001.03.29.10.21.38;	author beck;	state Exp;
branches;
next	1.1;

1.1
date	2000.12.15.22.17.53;	author beck;	state Exp;
branches
	1.1.1.1;
next	;

1.1.1.1
date	2002.07.19.21.28.29;	author henning;	state Exp;
branches;
next	1.1.1.2;

1.1.1.2
date	2003.08.21.12.53.37;	author henning;	state Exp;
branches;
next	1.1.1.3;

1.1.1.3
date	2003.11.17.17.03.19;	author henning;	state Exp;
branches;
next	;


desc
@@


1.5
log
@these are not needed here; henning@@ ok.
@
text
@# Makefile for Windows NT and Windows 95/98/2000

# Targets are:
#   _apacher   - build Apache in Release mode
#   _apached   - build Apache in Debug mode
#   installr   - build and install a Release build
#   installd   - build and install a Debug build
#   clean      - remove (most) generated files
#   _cleanr    - remove (most) files generated by a Release build
#   _cleand    - remove (most) files generated by a Debug build
#
# The default installation directory is \Apache. This can be changed
# with the INSTDIR macro, for example:
#
#   nmake /f Makefile.win INSTDIR="d:\Program Files\Apache" installr
#
# Note: this does *NOT* change the compiled in default "server root"
# Also be aware that certain awk's will not accept backslahed names,
# so the server root should be given in forward slashes (quoted),
# preferably with the drive designation!

!IF "$(INSTDIR)" == ""
INSTDIR=\Apache
!MESSAGE Using default install directory \Apache
!ENDIF 

!IF "$(MAKE)" == "NMAKE"
# Microsoft NMake options
MAKEOPT=-nologo
!ELSEIF "$(MAKE)" == "make"
# Borland make options 
# Borland build of Apache is highly experimental and unsupported.
MAKEOPT=-s -N
!ELSE
!MESSAGE Warning: unrecognized build command "$(MAKE)"
!ENDIF

default:        _apacher

_apacher: 
	$(MAKE) $(MAKEOPT) -f Makefile.win SHORT=R LONG=Release _build

_apached: 
	$(MAKE) $(MAKEOPT) -f Makefile.win SHORT=D LONG=Debug   _build

installr: 
	$(MAKE) $(MAKEOPT) -f Makefile.win SHORT=R LONG=Release _build _install

installd: 
	$(MAKE) $(MAKEOPT) -f Makefile.win SHORT=D LONG=Debug   _build _install

_cleanr:  
	$(MAKE) $(MAKEOPT) -f Makefile.win SHORT=R LONG=Release CTARGET=CLEAN _build

_cleand:  
	$(MAKE) $(MAKEOPT) -f Makefile.win SHORT=D LONG=Debug   CTARGET=CLEAN _build

clean:	_cleanr _cleand


_build:
#	echo LONG $(LONG) SHORT $(SHORT) x
	cd os\win32
	 $(MAKE) $(MAKEOPT) -f ApacheOS.mak CFG="ApacheOS - Win32 $(LONG)" RECURSE=0 $(CTARGET)
	 $(MAKE) $(MAKEOPT) -f Win9xConHook.mak CFG="Win9xConHook - Win32 $(LONG)" RECURSE=0 $(CTARGET)
	cd ..\..
	cd regex
	 $(MAKE) $(MAKEOPT) -f regex.mak CFG="regex - Win32 $(LONG)" RECURSE=0 $(CTARGET)
	cd ..
	cd ap
	 $(MAKE) $(MAKEOPT) -f ap.mak CFG="ap - Win32 $(LONG)" RECURSE=0 $(CTARGET)
	cd ..
	cd support
	 $(MAKE) $(MAKEOPT) -f htpasswd.mak CFG="htpasswd - Win32 $(LONG)" RECURSE=0 $(CTARGET)
	 $(MAKE) $(MAKEOPT) -f htdigest.mak CFG="htdigest - Win32 $(LONG)" RECURSE=0 $(CTARGET)
	 $(MAKE) $(MAKEOPT) -f logresolve.mak CFG="logresolve - Win32 $(LONG)" RECURSE=0 $(CTARGET)
	 $(MAKE) $(MAKEOPT) -f rotatelogs.mak CFG="rotatelogs - Win32 $(LONG)" RECURSE=0 $(CTARGET)
	cd ..
	cd lib\expat-lite
	 $(MAKE) $(MAKEOPT) -f xmltok.mak CFG="xmltok - Win32 $(LONG)" RECURSE=0 $(CTARGET)
	 $(MAKE) $(MAKEOPT) -f xmlparse.mak CFG="xmlparse - Win32 $(LONG)" RECURSE=0 $(CTARGET)
	cd ..\..
	cd lib\sdbm
	 $(MAKE) $(MAKEOPT) -f sdbm.mak CFG="sdbm - Win32 $(LONG)" RECURSE=0 $(CTARGET)
	cd ..\..
	cd main
	 $(MAKE) $(MAKEOPT) -f gen_uri_delims.mak CFG="gen_uri_delims - Win32 $(LONG)" RECURSE=0 $(CTARGET)
	 $(MAKE) $(MAKEOPT) -f gen_test_char.mak CFG="gen_test_char - Win32 $(LONG)" RECURSE=0 $(CTARGET)
	cd ..
	 $(MAKE) $(MAKEOPT) -f ApacheCore.mak CFG="ApacheCore - Win32 $(LONG)" RECURSE=0 $(CTARGET)
	 $(MAKE) $(MAKEOPT) -f Apache.mak CFG="Apache - Win32 $(LONG)" RECURSE=0 $(CTARGET)
	cd os\win32
	 $(MAKE) $(MAKEOPT) -f mod_status.mak CFG="mod_status - Win32 $(LONG)" RECURSE=0 $(CTARGET)
	 $(MAKE) $(MAKEOPT) -f mod_info.mak CFG="mod_info - Win32 $(LONG)" RECURSE=0 $(CTARGET)
	 $(MAKE) $(MAKEOPT) -f mod_auth_anon.mak CFG="mod_auth_anon - Win32 $(LONG)" RECURSE=0 $(CTARGET)
	 $(MAKE) $(MAKEOPT) -f mod_digest.mak CFG="mod_digest - Win32 $(LONG)" RECURSE=0 $(CTARGET)
	 $(MAKE) $(MAKEOPT) -f mod_cern_meta.mak CFG="mod_cern_meta - Win32 $(LONG)" RECURSE=0 $(CTARGET)
	 $(MAKE) $(MAKEOPT) -f mod_expires.mak CFG="mod_expires - Win32 $(LONG)" RECURSE=0 $(CTARGET)
	 $(MAKE) $(MAKEOPT) -f mod_headers.mak CFG="mod_headers - Win32 $(LONG)" RECURSE=0 $(CTARGET)
	 $(MAKE) $(MAKEOPT) -f mod_speling.mak CFG="mod_speling - Win32 $(LONG)" RECURSE=0 $(CTARGET)
	 $(MAKE) $(MAKEOPT) -f mod_usertrack.mak CFG="mod_usertrack - Win32 $(LONG)" RECURSE=0 $(CTARGET)
	 $(MAKE) $(MAKEOPT) -f mod_rewrite.mak CFG="mod_rewrite - Win32 $(LONG)" RECURSE=0 $(CTARGET)
	 $(MAKE) $(MAKEOPT) -f mod_auth_digest.mak CFG="mod_auth_digest - Win32 $(LONG)" RECURSE=0 $(CTARGET)
	 $(MAKE) $(MAKEOPT) -f mod_auth_dbm.mak CFG="mod_auth_dbm - Win32 $(LONG)" RECURSE=0 $(CTARGET)
	 $(MAKE) $(MAKEOPT) -f mod_proxy.mak CFG="mod_proxy - Win32 $(LONG)" RECURSE=0 $(CTARGET)
	 $(MAKE) $(MAKEOPT) -f mod_unique_id.mak CFG="mod_unique_id - Win32 $(LONG)" RECURSE=0 $(CTARGET)
	 $(MAKE) $(MAKEOPT) -f mod_vhost_alias.mak CFG="mod_vhost_alias - Win32 $(LONG)" RECURSE=0 $(CTARGET)
	 $(MAKE) $(MAKEOPT) -f mod_mime_magic.mak CFG="mod_mime_magic - Win32 $(LONG)" RECURSE=0 $(CTARGET)
	cd ..\..

_install:
	-mkdir "$(INSTDIR)"
	-mkdir "$(INSTDIR)\bin"
	-mkdir "$(INSTDIR)\cgi-bin"
	-mkdir "$(INSTDIR)\conf"
        -mkdir "$(INSTDIR)\htdocs"
        -mkdir "$(INSTDIR)\icons"
        -mkdir "$(INSTDIR)\include"
        -mkdir "$(INSTDIR)\include\regex"
        -mkdir "$(INSTDIR)\include\sdbm"
        -mkdir "$(INSTDIR)\include\xml"
	-mkdir "$(INSTDIR)\lib"
	-mkdir "$(INSTDIR)\libexec"
	-mkdir "$(INSTDIR)\logs"
	-mkdir "$(INSTDIR)\modules"
	-mkdir "$(INSTDIR)\proxy"
	copy $(LONG)\Apache.exe "$(INSTDIR)"
	copy $(LONG)\ApacheCore.dll "$(INSTDIR)"
	copy os\win32\$(LONG)\Win9xConHook.dll "$(INSTDIR)"
	copy lib\expat-lite\$(LONG)\xmltok.dll "$(INSTDIR)"
	copy lib\expat-lite\$(LONG)\xmlparse.dll "$(INSTDIR)"
	copy os\win32\$(LONG)\mod_status.so "$(INSTDIR)\modules"
	copy os\win32\$(LONG)\mod_info.so "$(INSTDIR)\modules"
	copy os\win32\$(LONG)\mod_auth_anon.so "$(INSTDIR)\modules"
	copy os\win32\$(LONG)\mod_digest.so "$(INSTDIR)\modules"
	copy os\win32\$(LONG)\mod_cern_meta.so "$(INSTDIR)\modules"
	copy os\win32\$(LONG)\mod_expires.so "$(INSTDIR)\modules"
	copy os\win32\$(LONG)\mod_headers.so "$(INSTDIR)\modules"
	copy os\win32\$(LONG)\mod_rewrite.so "$(INSTDIR)\modules"
	copy os\win32\$(LONG)\mod_speling.so "$(INSTDIR)\modules"
	copy os\win32\$(LONG)\mod_usertrack.so "$(INSTDIR)\modules"
	copy os\win32\$(LONG)\mod_auth_digest.so "$(INSTDIR)\modules"
	copy os\win32\$(LONG)\mod_auth_dbm.so "$(INSTDIR)\modules"
	copy os\win32\$(LONG)\mod_proxy.so "$(INSTDIR)\modules"
	copy os\win32\$(LONG)\mod_unique_id.so "$(INSTDIR)\modules"
	copy os\win32\$(LONG)\mod_vhost_alias.so "$(INSTDIR)\modules"
	copy os\win32\$(LONG)\mod_mime_magic.so "$(INSTDIR)\modules"
	copy support\$(LONG)\htpasswd.exe "$(INSTDIR)\bin"
	copy support\$(LONG)\htdigest.exe "$(INSTDIR)\bin"
	copy support\$(LONG)\logresolve.exe "$(INSTDIR)\bin"
	copy support\$(LONG)\rotatelogs.exe "$(INSTDIR)\bin"
	copy ..\cgi-bin\printenv "$(INSTDIR)\cgi-bin\printenv.pl"
        -xcopy ..\htdocs "$(INSTDIR)\htdocs" /s /d < <<
A
<<
	xcopy include\*.h "$(INSTDIR)\include" /d < <<
A
<<
	xcopy os\win32\*.h "$(INSTDIR)\include" /d < <<
A
<<
	xcopy regex\*.h "$(INSTDIR)\include\regex" /d < <<
A
<<
	xcopy lib\sdbm\*.h "$(INSTDIR)\include\sdbm" /d < <<
A
<<
	xcopy lib\expat-lite\*.h "$(INSTDIR)\include\xml" /d < <<
A
<<
        -xcopy ..\icons "$(INSTDIR)\icons" /s /d < <<
A
<<
	copy ap\Lib$(SHORT)\ap.lib "$(INSTDIR)\lib"
	copy os\win32\Lib$(SHORT)\ApacheOS.lib "$(INSTDIR)\lib"
	copy regex\Lib$(SHORT)\regex.lib "$(INSTDIR)\lib"
	copy lib\sdbm\Lib$(SHORT)\sdbm.lib "$(INSTDIR)\lib"
	copy $(LONG)\ApacheCore.exp "$(INSTDIR)\libexec"
	copy $(LONG)\ApacheCore.lib "$(INSTDIR)\libexec"
	copy os\win32\$(LONG)\Win9xConHook.exp "$(INSTDIR)\libexec"
	copy os\win32\$(LONG)\Win9xConHook.lib "$(INSTDIR)\libexec"
	copy lib\expat-lite\$(LONG)\xmltok.exp "$(INSTDIR)\libexec"
	copy lib\expat-lite\$(LONG)\xmltok.lib "$(INSTDIR)\libexec"
	copy lib\expat-lite\$(LONG)\xmlparse.exp "$(INSTDIR)\libexec"
	copy lib\expat-lite\$(LONG)\xmlparse.lib "$(INSTDIR)\libexec"
	copy $(LONG)\Apache.pdb "$(INSTDIR)"
	copy $(LONG)\ApacheCore.pdb "$(INSTDIR)"
	copy os\win32\$(LONG)\Win9xConHook.pdb "$(INSTDIR)"
	copy lib\expat-lite\$(LONG)\xmltok.pdb "$(INSTDIR)"
	copy lib\expat-lite\$(LONG)\xmlparse.pdb "$(INSTDIR)"
	copy os\win32\$(LONG)\mod_status.pdb "$(INSTDIR)\modules"
	copy os\win32\$(LONG)\mod_info.pdb "$(INSTDIR)\modules"
	copy os\win32\$(LONG)\mod_auth_anon.pdb "$(INSTDIR)\modules"
	copy os\win32\$(LONG)\mod_digest.pdb "$(INSTDIR)\modules"
	copy os\win32\$(LONG)\mod_cern_meta.pdb "$(INSTDIR)\modules"
	copy os\win32\$(LONG)\mod_expires.pdb "$(INSTDIR)\modules"
	copy os\win32\$(LONG)\mod_headers.pdb "$(INSTDIR)\modules"
	copy os\win32\$(LONG)\mod_rewrite.pdb "$(INSTDIR)\modules"
	copy os\win32\$(LONG)\mod_speling.pdb "$(INSTDIR)\modules"
	copy os\win32\$(LONG)\mod_usertrack.pdb "$(INSTDIR)\modules"
	copy os\win32\$(LONG)\mod_auth_digest.pdb "$(INSTDIR)\modules"
	copy os\win32\$(LONG)\mod_auth_dbm.pdb "$(INSTDIR)\modules"
	copy os\win32\$(LONG)\mod_proxy.pdb "$(INSTDIR)\modules"
	copy os\win32\$(LONG)\mod_unique_id.pdb "$(INSTDIR)\modules"
	copy os\win32\$(LONG)\mod_vhost_alias.pdb "$(INSTDIR)\modules"
	copy os\win32\$(LONG)\mod_mime_magic.pdb "$(INSTDIR)\modules"
	copy support\$(LONG)\htpasswd.pdb "$(INSTDIR)\bin"
	copy support\$(LONG)\htdigest.pdb "$(INSTDIR)\bin"
	copy support\$(LONG)\logresolve.pdb "$(INSTDIR)\bin"
	copy support\$(LONG)\rotatelogs.pdb "$(INSTDIR)\bin"
	copy ap\Lib$(SHORT)\ap.pdb "$(INSTDIR)\lib"
	copy os\win32\Lib$(SHORT)\ApacheOS.pdb "$(INSTDIR)\lib"
	copy regex\Lib$(SHORT)\regex.pdb "$(INSTDIR)\lib"
	copy lib\sdbm\Lib$(SHORT)\sdbm.pdb "$(INSTDIR)\lib"
        copy ..\conf\magic "$(INSTDIR)\conf\magic.default"
        if not exist "$(INSTDIR)\conf\magic" \
            copy "$(INSTDIR)\conf\magic.default" "$(INSTDIR)\conf\magic"
        copy ..\conf\mime.types "$(INSTDIR)\conf\mime.types.default"
        if not exist "$(INSTDIR)\conf\mime.types" \
            copy "$(INSTDIR)\conf\mime.types.default" "$(INSTDIR)\conf\mime.types"
	copy ..\conf\access.conf-dist "$(INSTDIR)\conf\access.default.conf"
	if not exist "$(INSTDIR)\conf\access.conf" \
            copy "$(INSTDIR)\conf\access.default.conf" "$(INSTDIR)\conf\access.conf"
	copy ..\conf\srm.conf-dist "$(INSTDIR)\conf\srm.default.conf"
	if not exist "$(INSTDIR)\conf\srm.conf" \
            copy "$(INSTDIR)\conf\srm.default.conf" "$(INSTDIR)\conf\srm.conf"
	awk -f <<script.awk "..\conf\httpd.conf-dist-win" "$(INSTDIR)\conf\httpd.default.conf" "$(INSTDIR)"
    BEGIN { 
        srcfl = ARGV[1];
        dstfl = ARGV[2];
        serverroot = ARGV[3];
        gsub( /\\/, "/", serverroot );
        while ( ( getline < srcfl ) > 0 ) {
            gsub( /@@@@ServerRoot@@@@/, serverroot );
            print $$0 > dstfl;
        }
    }
<<
	if not exist "$(INSTDIR)\conf\httpd.conf" \
            copy "$(INSTDIR)\conf\httpd.default.conf" "$(INSTDIR)\conf\httpd.conf" 
	awk -f <<script.awk "support\dbmmanage" >"$(INSTDIR)\bin\dbmmanage.pl"
    { if ( $$0 !~ /^#.*-lsdbm/) {
          gsub( /AnyDBM_File::ISA = qw\(.*\)/, "AnyDBM_File::ISA = qw(SDBM_File)" ); 
      } 
      print $$0;
    }
<<
	awk -f <<script2.awk "support\apxs.pl" "$(INSTDIR)" >"$(INSTDIR)\bin\apxs.pl"
    BEGIN {
          target = ARGV[2];
          gsub( /\\/, "/", target );
          delete ARGV[2];
    }
    { if ( $$0 ~ /@@/) {
          gsub( /@@TARGET@@/,            "httpd" ); 
          gsub( /@@CC@@/,                "cl" ); 
          gsub( /@@CFLAGS@@/,            "-nologo -MD -W3 -O2 -DNDEBUG -DWIN32 -D_WINDOWS -FD" ); 
          gsub( /@@CFLAGS_SHLIB@@/,      "-DSHARED_MODULE" ); 
          gsub( /@@LD_SHLIB@@/,          "link" ); 
          gsub( /@@LDFLAGS_MOD_SHLIB@@/, "-nologo -subsystem:windows -dll -libpath:\"" target "/libexec\" -incremental:no -map -machine:I386" ); 
          gsub( /@@LIBS_SHLIB@@/,        "ApacheCore.lib kernel32.lib advapi32.lib wsock32.lib ws2_32.lib" ); 
          gsub( /@@prefix@@/,            target  ); 
          gsub( /@@sbindir@@/,           target ); 
          gsub( /@@includedir@@/,        target "/include" ); 
          gsub( /@@libexecdir@@/,        target "/modules" ); 
          gsub( /@@sysconfdir@@/,        target "/conf" ); 
      } 
      print $$0;
    }
<<
@


1.4
log
@merge
@
text
@@


1.3
log
@fix half baked abortion of a merge to 1.3.23 and take
tree to apache-1.3.24+mod+ssl2.8.8
@
text
@a89 1
	 -del $(LONG)\buildmark.obj
d186 29
@


1.2
log
@Apache 1.3.19+mod_ssl 2.8.1 merge - also adds shared build of mod_headers
and mod_expire
@
text
@d107 3
d146 3
d216 23
@


1.1
log
@apache 1.3.14 + mod_ssl 2.7.1 merge
@
text
@d15 1
a15 1
#   nmake /f Makefile.nt INSTDIR="d:\Program Files\Apache" installr
d18 3
a58 4
	$(MAKE) $(MAKEOPT) -f Makefile.win SHORT=R LONG=Release CTARGET=CLEAN _installdll

installdll:
	$(MAKE) $(MAKEOPT) -f Makefile.win SHORT=R LONG=Release _installdll
d65 1
d79 1
a79 1
	cd lib/expat-lite
d82 2
a83 2
	cd ../..
	cd lib/sdbm
d85 1
a85 1
	cd ../..
d90 1
a90 1
	 -del Core$(SHORT)\buildmark.obj
d94 13
a106 16
	 set CFG=ApacheModuleStatus - Win32 $(LONG)
	 $(MAKE) $(MAKEOPT) -f ApacheModuleStatus.mak CFG="ApacheModuleStatus - Win32 $(LONG)" RECURSE=0 $(CTARGET)
	 $(MAKE) $(MAKEOPT) -f ApacheModuleInfo.mak CFG="ApacheModuleInfo - Win32 $(LONG)" RECURSE=0 $(CTARGET)
	 $(MAKE) $(MAKEOPT) -f ApacheModuleAuthAnon.mak CFG="ApacheModuleAuthAnon - Win32 $(LONG)" RECURSE=0 $(CTARGET)
	 $(MAKE) $(MAKEOPT) -f ApacheModuleDigest.mak CFG="ApacheModuleDigest - Win32 $(LONG)" RECURSE=0 $(CTARGET)
	 $(MAKE) $(MAKEOPT) -f ApacheModuleCERNMeta.mak CFG="ApacheModuleCERNMeta - Win32 $(LONG)" RECURSE=0 $(CTARGET)
	 $(MAKE) $(MAKEOPT) -f ApacheModuleExpires.mak CFG="ApacheModuleExpires - Win32 $(LONG)" RECURSE=0 $(CTARGET)
	 $(MAKE) $(MAKEOPT) -f ApacheModuleHeaders.mak CFG="ApacheModuleHeaders - Win32 $(LONG)" RECURSE=0 $(CTARGET)
	 $(MAKE) $(MAKEOPT) -f ApacheModuleSpeling.mak CFG="ApacheModuleSpeling - Win32 $(LONG)" RECURSE=0 $(CTARGET)
	 $(MAKE) $(MAKEOPT) -f ApacheModuleUserTrack.mak CFG="ApacheModuleUserTrack - Win32 $(LONG)" RECURSE=0 $(CTARGET)
	 $(MAKE) $(MAKEOPT) -f ApacheModuleRewrite.mak CFG="ApacheModuleRewrite - Win32 $(LONG)" RECURSE=0 $(CTARGET)
	 $(MAKE) $(MAKEOPT) -f ApacheModuleAuthDigest.mak CFG="ApacheModuleAuthDigest - Win32 $(LONG)" RECURSE=0 $(CTARGET)
	 $(MAKE) $(MAKEOPT) -f ApacheModuleAuthDBM.mak CFG="ApacheModuleAuthDBM - Win32 $(LONG)" RECURSE=0 $(CTARGET)
	cd ..\..
	cd modules\proxy
	 $(MAKE) $(MAKEOPT) -f ApacheModuleProxy.mak CFG="ApacheModuleProxy - Win32 $(LONG)" RECURSE=0 $(CTARGET)
d110 104
a213 32
	-mkdir $(INSTDIR)
	-mkdir $(INSTDIR)\modules
	-mkdir $(INSTDIR)\logs
	-mkdir $(INSTDIR)\conf
	-mkdir $(INSTDIR)\bin
	copy Apache$(SHORT)\Apache.exe $(INSTDIR)
	copy Core$(SHORT)\ApacheCore.dll $(INSTDIR)
	copy lib\expat-lite\$(LONG)\xmltok.dll $(INSTDIR)
	copy lib\expat-lite\$(LONG)\xmlparse.dll $(INSTDIR)
	copy os\win32\ApacheModuleStatus$(SHORT)\ApacheModuleStatus.dll $(INSTDIR)\modules
	copy os\win32\ApacheModuleInfo$(SHORT)\ApacheModuleInfo.dll $(INSTDIR)\modules
	copy os\win32\ApacheModuleAuthAnon$(SHORT)\ApacheModuleAuthAnon.dll $(INSTDIR)\modules
	copy os\win32\ApacheModuleDigest$(SHORT)\ApacheModuleDigest.dll $(INSTDIR)\modules
	copy os\win32\ApacheModuleCERNMeta$(SHORT)\ApacheModuleCERNMeta.dll $(INSTDIR)\modules
	copy os\win32\ApacheModuleExpires$(SHORT)\ApacheModuleExpires.dll $(INSTDIR)\modules
	copy os\win32\ApacheModuleHeaders$(SHORT)\ApacheModuleHeaders.dll $(INSTDIR)\modules
	copy os\win32\ApacheModuleRewrite$(SHORT)\ApacheModuleRewrite.dll $(INSTDIR)\modules
	copy os\win32\ApacheModuleSpeling$(SHORT)\ApacheModuleSpeling.dll $(INSTDIR)\modules
	copy os\win32\ApacheModuleUserTrack$(SHORT)\ApacheModuleUserTrack.dll $(INSTDIR)\modules
	copy os\win32\ApacheModuleAuthDigest$(SHORT)\ApacheModuleAuthDigest.dll $(INSTDIR)\modules
	copy os\win32\ApacheModuleAuthDBM$(SHORT)\ApacheModuleAuthDBM.dll $(INSTDIR)\modules
	copy modules\proxy\$(LONG)\ApacheModuleProxy.dll $(INSTDIR)\modules
	copy support\$(LONG)\htpasswd.exe $(INSTDIR)\bin
	copy support\$(LONG)\htdigest.exe $(INSTDIR)\bin
	copy support\$(LONG)\logresolve.exe $(INSTDIR)\bin
	copy support\$(LONG)\rotatelogs.exe $(INSTDIR)\bin
        copy support\dbmmanage $(INSTDIR)\bin\dbmmanage.pl

_installdll:
 	cd os\win32\installer\installdll
	 $(MAKE) $(MAKEOPT) -f install.mak CFG="install - Win32 $(LONG)" RECURSE=0 $(CTARGET)
	cd ..\..\..
@


1.1.1.1
log
@import apache 1.3.26 + mod_ssl 2.8.10
@
text
@d15 1
a15 1
#   nmake /f Makefile.win INSTDIR="d:\Program Files\Apache" installr
a17 3
# Also be aware that certain awk's will not accept backslahed names,
# so the server root should be given in forward slashes (quoted),
# preferably with the drive designation!
d56 4
a65 1
	 $(MAKE) $(MAKEOPT) -f Win9xConHook.mak CFG="Win9xConHook - Win32 $(LONG)" RECURSE=0 $(CTARGET)
d79 1
a79 1
	cd lib\expat-lite
d82 2
a83 2
	cd ..\..
	cd lib\sdbm
d85 1
a85 1
	cd ..\..
d90 1
a90 1
	 -del $(LONG)\buildmark.obj
d94 16
a109 16
	 $(MAKE) $(MAKEOPT) -f mod_status.mak CFG="mod_status - Win32 $(LONG)" RECURSE=0 $(CTARGET)
	 $(MAKE) $(MAKEOPT) -f mod_info.mak CFG="mod_info - Win32 $(LONG)" RECURSE=0 $(CTARGET)
	 $(MAKE) $(MAKEOPT) -f mod_auth_anon.mak CFG="mod_auth_anon - Win32 $(LONG)" RECURSE=0 $(CTARGET)
	 $(MAKE) $(MAKEOPT) -f mod_digest.mak CFG="mod_digest - Win32 $(LONG)" RECURSE=0 $(CTARGET)
	 $(MAKE) $(MAKEOPT) -f mod_cern_meta.mak CFG="mod_cern_meta - Win32 $(LONG)" RECURSE=0 $(CTARGET)
	 $(MAKE) $(MAKEOPT) -f mod_expires.mak CFG="mod_expires - Win32 $(LONG)" RECURSE=0 $(CTARGET)
	 $(MAKE) $(MAKEOPT) -f mod_headers.mak CFG="mod_headers - Win32 $(LONG)" RECURSE=0 $(CTARGET)
	 $(MAKE) $(MAKEOPT) -f mod_speling.mak CFG="mod_speling - Win32 $(LONG)" RECURSE=0 $(CTARGET)
	 $(MAKE) $(MAKEOPT) -f mod_usertrack.mak CFG="mod_usertrack - Win32 $(LONG)" RECURSE=0 $(CTARGET)
	 $(MAKE) $(MAKEOPT) -f mod_rewrite.mak CFG="mod_rewrite - Win32 $(LONG)" RECURSE=0 $(CTARGET)
	 $(MAKE) $(MAKEOPT) -f mod_auth_digest.mak CFG="mod_auth_digest - Win32 $(LONG)" RECURSE=0 $(CTARGET)
	 $(MAKE) $(MAKEOPT) -f mod_auth_dbm.mak CFG="mod_auth_dbm - Win32 $(LONG)" RECURSE=0 $(CTARGET)
	 $(MAKE) $(MAKEOPT) -f mod_proxy.mak CFG="mod_proxy - Win32 $(LONG)" RECURSE=0 $(CTARGET)
	 $(MAKE) $(MAKEOPT) -f mod_unique_id.mak CFG="mod_unique_id - Win32 $(LONG)" RECURSE=0 $(CTARGET)
	 $(MAKE) $(MAKEOPT) -f mod_vhost_alias.mak CFG="mod_vhost_alias - Win32 $(LONG)" RECURSE=0 $(CTARGET)
	 $(MAKE) $(MAKEOPT) -f mod_mime_magic.mak CFG="mod_mime_magic - Win32 $(LONG)" RECURSE=0 $(CTARGET)
d113 32
a144 130
	-mkdir "$(INSTDIR)"
	-mkdir "$(INSTDIR)\bin"
	-mkdir "$(INSTDIR)\cgi-bin"
	-mkdir "$(INSTDIR)\conf"
        -mkdir "$(INSTDIR)\htdocs"
        -mkdir "$(INSTDIR)\icons"
        -mkdir "$(INSTDIR)\include"
        -mkdir "$(INSTDIR)\include\regex"
        -mkdir "$(INSTDIR)\include\sdbm"
        -mkdir "$(INSTDIR)\include\xml"
	-mkdir "$(INSTDIR)\lib"
	-mkdir "$(INSTDIR)\libexec"
	-mkdir "$(INSTDIR)\logs"
	-mkdir "$(INSTDIR)\modules"
	-mkdir "$(INSTDIR)\proxy"
	copy $(LONG)\Apache.exe "$(INSTDIR)"
	copy $(LONG)\ApacheCore.dll "$(INSTDIR)"
	copy os\win32\$(LONG)\Win9xConHook.dll "$(INSTDIR)"
	copy lib\expat-lite\$(LONG)\xmltok.dll "$(INSTDIR)"
	copy lib\expat-lite\$(LONG)\xmlparse.dll "$(INSTDIR)"
	copy os\win32\$(LONG)\mod_status.so "$(INSTDIR)\modules"
	copy os\win32\$(LONG)\mod_info.so "$(INSTDIR)\modules"
	copy os\win32\$(LONG)\mod_auth_anon.so "$(INSTDIR)\modules"
	copy os\win32\$(LONG)\mod_digest.so "$(INSTDIR)\modules"
	copy os\win32\$(LONG)\mod_cern_meta.so "$(INSTDIR)\modules"
	copy os\win32\$(LONG)\mod_expires.so "$(INSTDIR)\modules"
	copy os\win32\$(LONG)\mod_headers.so "$(INSTDIR)\modules"
	copy os\win32\$(LONG)\mod_rewrite.so "$(INSTDIR)\modules"
	copy os\win32\$(LONG)\mod_speling.so "$(INSTDIR)\modules"
	copy os\win32\$(LONG)\mod_usertrack.so "$(INSTDIR)\modules"
	copy os\win32\$(LONG)\mod_auth_digest.so "$(INSTDIR)\modules"
	copy os\win32\$(LONG)\mod_auth_dbm.so "$(INSTDIR)\modules"
	copy os\win32\$(LONG)\mod_proxy.so "$(INSTDIR)\modules"
	copy os\win32\$(LONG)\mod_unique_id.so "$(INSTDIR)\modules"
	copy os\win32\$(LONG)\mod_vhost_alias.so "$(INSTDIR)\modules"
	copy os\win32\$(LONG)\mod_mime_magic.so "$(INSTDIR)\modules"
	copy support\$(LONG)\htpasswd.exe "$(INSTDIR)\bin"
	copy support\$(LONG)\htdigest.exe "$(INSTDIR)\bin"
	copy support\$(LONG)\logresolve.exe "$(INSTDIR)\bin"
	copy support\$(LONG)\rotatelogs.exe "$(INSTDIR)\bin"
	copy ..\cgi-bin\printenv "$(INSTDIR)\cgi-bin\printenv.pl"
        -xcopy ..\htdocs "$(INSTDIR)\htdocs" /s /d < <<
A
<<
	xcopy include\*.h "$(INSTDIR)\include" /d < <<
A
<<
	xcopy os\win32\*.h "$(INSTDIR)\include" /d < <<
A
<<
	xcopy regex\*.h "$(INSTDIR)\include\regex" /d < <<
A
<<
	xcopy lib\sdbm\*.h "$(INSTDIR)\include\sdbm" /d < <<
A
<<
	xcopy lib\expat-lite\*.h "$(INSTDIR)\include\xml" /d < <<
A
<<
        -xcopy ..\icons "$(INSTDIR)\icons" /s /d < <<
A
<<
	copy ap\Lib$(SHORT)\ap.lib "$(INSTDIR)\lib"
	copy os\win32\Lib$(SHORT)\ApacheOS.lib "$(INSTDIR)\lib"
	copy regex\Lib$(SHORT)\regex.lib "$(INSTDIR)\lib"
	copy lib\sdbm\Lib$(SHORT)\sdbm.lib "$(INSTDIR)\lib"
	copy $(LONG)\ApacheCore.exp "$(INSTDIR)\libexec"
	copy $(LONG)\ApacheCore.lib "$(INSTDIR)\libexec"
	copy os\win32\$(LONG)\Win9xConHook.exp "$(INSTDIR)\libexec"
	copy os\win32\$(LONG)\Win9xConHook.lib "$(INSTDIR)\libexec"
	copy lib\expat-lite\$(LONG)\xmltok.exp "$(INSTDIR)\libexec"
	copy lib\expat-lite\$(LONG)\xmltok.lib "$(INSTDIR)\libexec"
	copy lib\expat-lite\$(LONG)\xmlparse.exp "$(INSTDIR)\libexec"
	copy lib\expat-lite\$(LONG)\xmlparse.lib "$(INSTDIR)\libexec"
        copy ..\conf\magic "$(INSTDIR)\conf\magic.default"
        if not exist "$(INSTDIR)\conf\magic" \
            copy "$(INSTDIR)\conf\magic.default" "$(INSTDIR)\conf\magic"
        copy ..\conf\mime.types "$(INSTDIR)\conf\mime.types.default"
        if not exist "$(INSTDIR)\conf\mime.types" \
            copy "$(INSTDIR)\conf\mime.types.default" "$(INSTDIR)\conf\mime.types"
	copy ..\conf\access.conf-dist "$(INSTDIR)\conf\access.default.conf"
	if not exist "$(INSTDIR)\conf\access.conf" \
            copy "$(INSTDIR)\conf\access.default.conf" "$(INSTDIR)\conf\access.conf"
	copy ..\conf\srm.conf-dist "$(INSTDIR)\conf\srm.default.conf"
	if not exist "$(INSTDIR)\conf\srm.conf" \
            copy "$(INSTDIR)\conf\srm.default.conf" "$(INSTDIR)\conf\srm.conf"
	awk -f <<script.awk "..\conf\httpd.conf-dist-win" "$(INSTDIR)\conf\httpd.default.conf" "$(INSTDIR)"
    BEGIN { 
        srcfl = ARGV[1];
        dstfl = ARGV[2];
        serverroot = ARGV[3];
        gsub( /\\/, "/", serverroot );
        while ( ( getline < srcfl ) > 0 ) {
            gsub( /@@@@ServerRoot@@@@/, serverroot );
            print $$0 > dstfl;
        }
    }
<<
	if not exist "$(INSTDIR)\conf\httpd.conf" \
            copy "$(INSTDIR)\conf\httpd.default.conf" "$(INSTDIR)\conf\httpd.conf" 
	awk -f <<script.awk "support\dbmmanage" >"$(INSTDIR)\bin\dbmmanage.pl"
    { if ( $$0 !~ /^#.*-lsdbm/) {
          gsub( /AnyDBM_File::ISA = qw\(.*\)/, "AnyDBM_File::ISA = qw(SDBM_File)" ); 
      } 
      print $$0;
    }
<<
	awk -f <<script2.awk "support\apxs.pl" "$(INSTDIR)" >"$(INSTDIR)\bin\apxs.pl"
    BEGIN {
          target = ARGV[2];
          gsub( /\\/, "/", target );
          delete ARGV[2];
    }
    { if ( $$0 ~ /@@/) {
          gsub( /@@TARGET@@/,            "httpd" ); 
          gsub( /@@CC@@/,                "cl" ); 
          gsub( /@@CFLAGS@@/,            "-nologo -MD -W3 -O2 -DNDEBUG -DWIN32 -D_WINDOWS -FD" ); 
          gsub( /@@CFLAGS_SHLIB@@/,      "-DSHARED_MODULE" ); 
          gsub( /@@LD_SHLIB@@/,          "link" ); 
          gsub( /@@LDFLAGS_MOD_SHLIB@@/, "-nologo -subsystem:windows -dll -libpath:\"" target "/libexec\" -incremental:no -map -machine:I386" ); 
          gsub( /@@LIBS_SHLIB@@/,        "ApacheCore.lib kernel32.lib advapi32.lib wsock32.lib ws2_32.lib" ); 
          gsub( /@@prefix@@/,            target  ); 
          gsub( /@@sbindir@@/,           target ); 
          gsub( /@@includedir@@/,        target "/include" ); 
          gsub( /@@libexecdir@@/,        target "/modules" ); 
          gsub( /@@sysconfdir@@/,        target "/conf" ); 
      } 
      print $$0;
    }
<<
@


1.1.1.2
log
@import apache 1.3.28 and mod_ssl 2.8.15
@
text
@d90 1
a186 29
	copy $(LONG)\Apache.pdb "$(INSTDIR)"
	copy $(LONG)\ApacheCore.pdb "$(INSTDIR)"
	copy os\win32\$(LONG)\Win9xConHook.pdb "$(INSTDIR)"
	copy lib\expat-lite\$(LONG)\xmltok.pdb "$(INSTDIR)"
	copy lib\expat-lite\$(LONG)\xmlparse.pdb "$(INSTDIR)"
	copy os\win32\$(LONG)\mod_status.pdb "$(INSTDIR)\modules"
	copy os\win32\$(LONG)\mod_info.pdb "$(INSTDIR)\modules"
	copy os\win32\$(LONG)\mod_auth_anon.pdb "$(INSTDIR)\modules"
	copy os\win32\$(LONG)\mod_digest.pdb "$(INSTDIR)\modules"
	copy os\win32\$(LONG)\mod_cern_meta.pdb "$(INSTDIR)\modules"
	copy os\win32\$(LONG)\mod_expires.pdb "$(INSTDIR)\modules"
	copy os\win32\$(LONG)\mod_headers.pdb "$(INSTDIR)\modules"
	copy os\win32\$(LONG)\mod_rewrite.pdb "$(INSTDIR)\modules"
	copy os\win32\$(LONG)\mod_speling.pdb "$(INSTDIR)\modules"
	copy os\win32\$(LONG)\mod_usertrack.pdb "$(INSTDIR)\modules"
	copy os\win32\$(LONG)\mod_auth_digest.pdb "$(INSTDIR)\modules"
	copy os\win32\$(LONG)\mod_auth_dbm.pdb "$(INSTDIR)\modules"
	copy os\win32\$(LONG)\mod_proxy.pdb "$(INSTDIR)\modules"
	copy os\win32\$(LONG)\mod_unique_id.pdb "$(INSTDIR)\modules"
	copy os\win32\$(LONG)\mod_vhost_alias.pdb "$(INSTDIR)\modules"
	copy os\win32\$(LONG)\mod_mime_magic.pdb "$(INSTDIR)\modules"
	copy support\$(LONG)\htpasswd.pdb "$(INSTDIR)\bin"
	copy support\$(LONG)\htdigest.pdb "$(INSTDIR)\bin"
	copy support\$(LONG)\logresolve.pdb "$(INSTDIR)\bin"
	copy support\$(LONG)\rotatelogs.pdb "$(INSTDIR)\bin"
	copy ap\Lib$(SHORT)\ap.pdb "$(INSTDIR)\lib"
	copy os\win32\Lib$(SHORT)\ApacheOS.pdb "$(INSTDIR)\lib"
	copy regex\Lib$(SHORT)\regex.pdb "$(INSTDIR)\lib"
	copy lib\sdbm\Lib$(SHORT)\sdbm.pdb "$(INSTDIR)\lib"
@


1.1.1.3
log
@import Apache 1.3.29 and mod_ssl 2.8.16
@
text
@a126 5
	copy ..\ABOUT_APACHE "$(INSTDIR)\ABOUT_APACHE.TXT"
	copy ..\Announcement "$(INSTDIR)\Announcement.txt"
	copy ..\LICENSE "$(INSTDIR)\LICENSE.TXT"
	copy ..\README-WIN.TXT "$(INSTDIR)"
	copy ..\WARNING-WIN.TXT "$(INSTDIR)"
@


