head	1.6;
access;
symbols
	OPENBSD_6_1_BASE:1.6
	OPENBSD_6_0:1.3.0.2
	OPENBSD_6_0_BASE:1.3;
locks; strict;
comment	@# @;


1.6
date	2016.10.07.08.49.53;	author reyk;	state Exp;
branches;
next	1.5;
commitid	xgJDyBGKZ2b1TKC0;

1.5
date	2016.09.30.12.48.27;	author reyk;	state Exp;
branches;
next	1.4;
commitid	xHMNHfWpPneWqH4E;

1.4
date	2016.09.30.11.57.57;	author reyk;	state Exp;
branches;
next	1.3;
commitid	Bk6N1Zmhuj3ewIdN;

1.3
date	2016.07.20.14.04.51;	author reyk;	state Exp;
branches;
next	1.2;
commitid	OHCy0wiUhJ9GuuAI;

1.2
date	2016.07.19.18.14.08;	author reyk;	state Exp;
branches;
next	1.1;
commitid	QaXohszP3qByKnvb;

1.1
date	2016.07.19.16.54.26;	author reyk;	state Exp;
branches;
next	;
commitid	NvD0Bp0qm4zs28YJ;


desc
@@


1.6
log
@Move some shared code into a new file.

Discussed with rzalamena@@
@
text
@# $OpenBSD: Makefile,v 1.5 2016/09/30 12:48:27 reyk Exp $

PROG=		switchd
MAN=		switchd.8 switchd.conf.5

SRCS=		imsg_util.c log.c packet.c proc.c switch.c timer.c util.c
SRCS+=		switchd.c control.c ofp.c ofp10.c ofp13.c ofp_common.c ofrelay.c
SRCS+=		${.OBJDIR}/ofp_map.c ${.OBJDIR}/ofp10_map.c
SRCS+=		parse.y ofcconn.c

LDADD=		-levent -lutil
DPADD=		${LIBEVENT} ${LIBUTIL}

CFLAGS+=	-Wall -I${.CURDIR} -I${.CURDIR}/../switchd
CFLAGS+=	-Wstrict-prototypes -Wmissing-prototypes
CFLAGS+=	-Wmissing-declarations
CFLAGS+=	-Wshadow -Wpointer-arith -Wcast-qual
CFLAGS+=	-Wsign-compare

GENERATED=	ofp_map.c ofp10_map.c
CLEANFILES+=	${GENERATED} *~

ofp_map.c: genmap.sh ${.CURDIR}/ofp_map.h ${.CURDIR}/../../sys/net/ofp.h
	/bin/sh ${.CURDIR}/genmap.sh -i ${.CURDIR}/../../sys/net/ofp.h -t ofp \
	    -m ${.CURDIR}/ofp_map.h -h '<net/ofp.h>' > $@@
	@@touch $@@

ofp10_map.c: genmap.sh ${.CURDIR}/ofp_map.h ${.CURDIR}/ofp10.h
	/bin/sh ${.CURDIR}/genmap.sh -i ${.CURDIR}/ofp10.h -t ofp10 \
	    -m ${.CURDIR}/ofp_map.h -h '"ofp10.h"' > $@@
	@@touch $@@

.include <bsd.prog.mk>
@


1.5
log
@Remove local copy of ofp.h and use net/ofp.h instead
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.4 2016/09/30 11:57:57 reyk Exp $
d7 1
a7 1
SRCS+=		switchd.c control.c ofp.c ofp10.c ofp13.c ofrelay.c
@


1.4
log
@Implement socket server code that properly handles async I/O, partial
messages, multiple messages per buffer and important things like
connection limits and file descriptor accounting.  It works with TCP
connections as well as switch(4).  The ofrelay.c part replaces
networking that was in ofp.c and will soon handle all socket
connections of switchd.  It is called "ofrelay" because it will be
used as client, server, and forwarder.

OK rzalamena@@
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.3 2016/07/20 14:04:51 reyk Exp $
d23 3
a25 3
ofp_map.c: genmap.sh ${.CURDIR}/ofp_map.h ${.CURDIR}/ofp.h
	/bin/sh ${.CURDIR}/genmap.sh -i ${.CURDIR}/ofp.h -t ofp \
	    -m ${.CURDIR}/ofp_map.h -h '"ofp.h"' > $@@
@


1.3
log
@Fix dependencies of generated map files.
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.2 2016/07/19 18:14:08 reyk Exp $
d6 2
a7 2
SRCS=		imsg_util.c log.c packet.c switch.c timer.c util.c
SRCS+=		switchd.c ofp.c ofp10.c ofp13.c control.c proc.c
@


1.2
log
@The -DNAME=switch flag is an artifact from the PoC when I couldn't
decide on a name.  Remove it and fix the name to switchd now.
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.1 2016/07/19 16:54:26 reyk Exp $
d23 1
a23 1
ofp_map.c: genmap.sh ${.CURDIR}/ofp.h
d28 1
a28 1
ofp10_map.c: genmap.sh ${.CURDIR}/ofp10.h
@


1.1
log
@Import switchd(8), a basic WIP OpenFlow implementation for OpenBSD.

switchd consists of two parts:
1. switchd(8) and switchctl(8), an OpenFlow controller or "vswitch".
2. switch(4), an OpenFlow-aware kernel "bridge".

This the 1st part, the driver will be imported later.  The code will
remain disabled for a while, but it helps development to have it in
the tree.  switchd currently supports partial OpenFlow 1.0, but the
goal is to use OpenFlow 1.3.5 instead (switch(4) already does 1.3.5).

For more background information see:
http://www.openbsd.org/papers/bsdcan2016-switchd.pdf
https://youtu.be/Cuo0qT-lqig

With help from yasuoka@@ goda@@
Import discussed with deraadt@@
@
text
@d1 1
a1 1
# $OpenBSD$
d3 2
a4 4
NAME=		switch

PROG=		${NAME}d
MAN=		${NAME}d.8 ${NAME}d.conf.5
d14 1
a14 2
CFLAGS+=	-DSWITCHD_NAME=\"${NAME}\"
CFLAGS+=	-Wall -I${.CURDIR} -I${.CURDIR}/../${NAME}d
@

