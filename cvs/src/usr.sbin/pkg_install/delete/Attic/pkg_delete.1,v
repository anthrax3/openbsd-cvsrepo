head	1.18;
access;
symbols
	OPENBSD_3_5:1.17.0.4
	OPENBSD_3_5_BASE:1.17
	OPENBSD_3_4:1.17.0.2
	OPENBSD_3_4_BASE:1.17
	OPENBSD_3_3:1.15.0.2
	OPENBSD_3_3_BASE:1.15
	OPENBSD_3_2:1.14.0.4
	OPENBSD_3_2_BASE:1.14
	OPENBSD_3_1:1.14.0.2
	OPENBSD_3_1_BASE:1.14
	OPENBSD_3_0:1.13.0.2
	OPENBSD_3_0_BASE:1.13
	OPENBSD_2_9_BASE:1.12
	OPENBSD_2_9:1.12.0.2
	OPENBSD_2_8:1.10.0.4
	OPENBSD_2_8_BASE:1.10
	OPENBSD_2_7:1.10.0.2
	OPENBSD_2_7_BASE:1.10
	OPENBSD_2_6:1.7.0.2
	OPENBSD_2_6_BASE:1.7
	OPENBSD_2_5:1.4.0.2
	OPENBSD_2_5_BASE:1.4
	OPENBSD_2_4:1.3.0.2
	OPENBSD_2_4_BASE:1.3
	OPENBSD_2_3:1.2.0.8
	OPENBSD_2_3_BASE:1.2
	OPENBSD_2_2:1.2.0.6
	OPENBSD_2_2_BASE:1.2
	OPENBSD_2_1:1.2.0.4
	OPENBSD_2_1_BASE:1.2
	OPENBSD_2_0:1.2.0.2
	OPENBSD_2_0_BASE:1.2;
locks; strict;
comment	@# @;


1.18
date	2004.05.28.20.15.48;	author brad;	state dead;
branches;
next	1.17;

1.17
date	2003.08.21.20.24.56;	author espie;	state Exp;
branches;
next	1.16;

1.16
date	2003.08.01.08.56.01;	author espie;	state Exp;
branches;
next	1.15;

1.15
date	2003.03.07.06.30.38;	author david;	state Exp;
branches;
next	1.14;

1.14
date	2002.04.06.01.07.19;	author espie;	state Exp;
branches;
next	1.13;

1.13
date	2001.08.17.11.13.58;	author mpech;	state Exp;
branches;
next	1.12;

1.12
date	2000.11.09.17.53.20;	author aaron;	state Exp;
branches;
next	1.11;

1.11
date	2000.11.08.19.37.36;	author aaron;	state Exp;
branches;
next	1.10;

1.10
date	2000.04.15.02.15.19;	author aaron;	state Exp;
branches;
next	1.9;

1.9
date	2000.03.19.17.57.10;	author aaron;	state Exp;
branches;
next	1.8;

1.8
date	2000.03.06.21.46.55;	author aaron;	state Exp;
branches;
next	1.7;

1.7
date	99.10.09.20.35.45;	author beck;	state Exp;
branches;
next	1.6;

1.6
date	99.07.03.02.11.10;	author aaron;	state Exp;
branches;
next	1.5;

1.5
date	99.06.05.22.17.50;	author aaron;	state Exp;
branches;
next	1.4;

1.4
date	98.12.16.02.47.53;	author aaron;	state Exp;
branches;
next	1.3;

1.3
date	98.09.07.22.30.15;	author marc;	state Exp;
branches;
next	1.2;

1.2
date	96.10.08.01.21.02;	author michaels;	state Exp;
branches;
next	1.1;

1.1
date	96.06.04.07.56.08;	author niklas;	state Exp;
branches;
next	;


desc
@@


1.18
log
@bye bye old package tools.

ok deraadt@@
@
text
@.\"	$OpenBSD: pkg_delete.1,v 1.17 2003/08/21 20:24:56 espie Exp $
.\"
.\" FreeBSD install - a package for the installation and maintenance
.\" of non-core utilities.
.\"
.\" Redistribution and use in source and binary forms, with or without
.\" modification, are permitted provided that the following conditions
.\" are met:
.\" 1. Redistributions of source code must retain the above copyright
.\"    notice, this list of conditions and the following disclaimer.
.\" 2. Redistributions in binary form must reproduce the above copyright
.\"    notice, this list of conditions and the following disclaimer in the
.\"    documentation and/or other materials provided with the distribution.
.\"
.\" Jordan K. Hubbard
.\"
.\"
.\"     from FreeBSD: @@(#)pkg_delete.1
.\"
.Dd November 25, 1994
.Dt PKG_DELETE 1
.Os
.Sh NAME
.Nm pkg_delete
.Nd a utility for deleting previously installed software package distributions
.Sh SYNOPSIS
.Nm pkg_delete
.Op Fl cvDdnfq
.Op Fl p Ar prefix
.Ar pkg-name Op Ar ...
.Sh DESCRIPTION
The
.Nm
command is used to delete packages that have been previously installed
with the
.Xr pkg_add 1
command.
.Pp
Package names may be specified either as the package name itself, or as filenames which consist of the package name plus the
.Dq .tgz
,
.Dq .tar.gz
, or the
.Dq .tar
suffix.
.Pp
The options are as follows:
.Bl -tag -width Ds
.It Ar pkg-name Op Ar ...
The named packages are deinstalled.
.It Fl v
Turn on verbose output.
.It Fl D
If a deinstallation script exists for a given package, do not execute it.
.It Fl n
Don't actually deinstall a package, just report the steps that
would be taken if it were.
.It Fl p Ar prefix
Set
.Ar prefix
as the directory in which to delete files from any installed packages
which do not explicitly set theirs.
For most packages, the prefix will
be set automatically to the installed location by
.Xr pkg_add 1 .
.It Fl d
Remove empty directories created by file cleanup.
By default, only
files/directories explicitly listed in a package's contents (either as
normal files/directories or with the
.Cm @@dirrm
directive) will be removed at deinstallation time.
This option tells
.Nm
to also remove any directories that were emptied as a result of removing
the package.
.It Fl f
Force removal of the package, even if a dependency is recorded or the
deinstall or require script fails.
.It Fl c
Delete extra configuration file, mentioned as
.Bd -literal
@@extra file
.Ed
in the packing-list.
.It Fl q
Delete package quickly, do not bother checking md5s before removing files.
.El
.Sh TECHNICAL DETAILS
.Nm
does pretty much what it says.
It examines installed package records in
.Pa /var/db/pkg/<pkg-name> ,
deletes the package contents, and finally removes the package records.
.Pp
If a package is required by other installed packages,
.Nm
will list those dependent packages and refuse to delete the package
(unless the
.Fl f
option is given).
.Pp
If the package contains a
.Ar require
file (see
.Xr pkg_create 1 ) ,
then this is executed first as
.Bd -filled -offset indent
.Cm require
.Ar <pkg-name>
.Ar DEINSTALL
.Ed
.Pp
(where
.Ar pkg-name
is the name of the package in question and
.Ar DEINSTALL
is a keyword denoting that this is a deinstallation)
to see whether or not deinstallation should continue.
A non-zero exit status means no, unless the
.Fl f
option is specified.
.Pp
If a
.Cm deinstall
script exists for the package, it is executed before any files are removed.
It is this script's responsibility to clean up any additional messy details
around the package's installation, since all
.Nm
knows how to do is delete the files created in the original distribution.
The
.Nm deinstall
script is called as:
.Bd -filled -offset indent
.Cm deinstall
.Ar <pkg-name>
.Ar DEINSTALL
.Ed
.Pp
Passing the keyword
.Ar DEINSTALL
lets you potentially write only one program/script that handles all
aspects of installation and deletion.
.Pp
All scripts are called with the environment variable
.Ev PKG_PREFIX
set to the installation prefix (see the
.Fl p
option above).
This allows a package author to write a script
that reliably performs some action on the directory where the package
is installed, even if the user might have changed it by specifying the
.Fl p
option when running
.Nm
or
.Cm pkg_add .
.Sh SEE ALSO
.Xr pkg_add 1 ,
.Xr pkg_create 1 ,
.Xr pkg_info 1 ,
.Xr mkstemp 3 ,
.Xr mtree 8
.Sh AUTHORS
.Bl -tag -width indent -compact
.It "Jordan Hubbard"
most of the work
.It "John Kohl"
refined it for
.Nx
.El
.Sh WARNING
.Bf -emphasis
Since the
.Nm
command may execute scripts or programs provided by a package file,
your system may be susceptible to ``trojan horses'' or other subtle
attacks from miscreants who create dangerous package files.
.Pp
You are advised to verify the competence and identity of those who
provide installable package files.
For extra protection, examine all
the package control files in the package record directory
.Pq Pa /var/db/pkg/<pkg-name>/ .
Pay particular
attention to any +INSTALL, +DEINSTALL, +REQUIRE or +MTREE_DIRS files,
and inspect the +CONTENTS file for
.Cm @@cwd ,
.Cm @@mode
(check for setuid),
.Cm @@dirrm ,
.Cm @@exec ,
and
.Cm @@unexec
directives, and/or use the
.Xr pkg_info 1
command to examine the installed package control files.
.Ef
@


1.17
log
@New keywords: @@extra and @@extraunexec.
Used to record extra files (configuration) and action, that will only
be taken with pkg_delete -c.
@
text
@d1 1
a1 1
.\"	$OpenBSD: pkg_delete.1,v 1.16 2003/08/01 08:56:01 espie Exp $
@


1.16
log
@Add -q flag to pkg_delete: don't check md5 before removing.
Useful for bulk-package builders who want to clean /usr/local quickly.
@
text
@d1 1
a1 1
.\"	$OpenBSD: pkg_delete.1,v 1.15 2003/03/07 06:30:38 david Exp $
d28 1
a28 1
.Op Fl vDdnfq
d80 6
@


1.15
log
@spelling errors/typos
ok jmc@@
@
text
@d1 1
a1 1
.\"	$OpenBSD: pkg_delete.1,v 1.14 2002/04/06 01:07:19 espie Exp $
d28 1
a28 1
.Op Fl vDdnf
d80 2
@


1.14
log
@PR2525
@
text
@d1 1
a1 1
.\"	$OpenBSD: pkg_delete.1,v 1.13 2001/08/17 11:13:58 mpech Exp $
d3 1
a3 1
.\" FreeBSD install - a package for the installation and maintainance
@


1.13
log
@o) {Open,Net,Free}BSD -> .{O,N,F}x;
o) "start sentence on new line" issues;
o) minimal -mdoc improvements;

millert@@ ok
@
text
@d1 1
a1 1
.\"	$OpenBSD: pkg_delete.1,v 1.12 2000/11/09 17:53:20 aaron Exp $
d154 1
a154 1
.Xr mktemp 3 ,
@


1.12
log
@Change all option list specifications to ".Bl -tag -width Ds". Most man
pages just needed their -width parameter tweaked to "Ds", which provides
a nice width of 6 constant characters. For consistency more than anything.
@
text
@d1 1
a1 1
.\"	$OpenBSD: pkg_delete.1,v 1.11 2000/11/08 19:37:36 aaron Exp $
d161 2
a162 1
refined it for NetBSD
@


1.11
log
@- Get rid of ".Sh OPTIONS" and always use the standard options list intro.
- Move some BUGS/CAVEATS to the end of the man pages where they should go.
- Correct some .Nm usage.
@
text
@d1 1
a1 1
.\"	$OpenBSD: pkg_delete.1,v 1.10 2000/04/15 02:15:19 aaron Exp $
d48 1
a48 1
.Bl -tag -width indent
@


1.10
log
@Mostly punctuation fixes.
@
text
@d1 1
a1 1
.\"	$OpenBSD: pkg_delete.1,v 1.9 2000/03/19 17:57:10 aaron Exp $
a45 7
.Sh WARNING
.Bf -emphasis
Since the
.Nm
command may execute scripts or programs provided by a package file,
your system may be susceptible to ``trojan horses'' or other subtle
attacks from miscreants who create dangerous package files.
d47 1
a47 21
You are advised to verify the competence and identity of those who
provide installable package files.
For extra protection, examine all
the package control files in the package record directory
.Pq Pa /var/db/pkg/<pkg-name>/ .
Pay particular
attention to any +INSTALL, +DEINSTALL, +REQUIRE or +MTREE_DIRS files,
and inspect the +CONTENTS file for
.Cm @@cwd ,
.Cm @@mode
(check for setuid),
.Cm @@dirrm ,
.Cm @@exec ,
and
.Cm @@unexec
directives, and/or use the
.Xr pkg_info 1
command to examine the installed package control files.
.Ef
.Sh OPTIONS
The following command line options are supported:
d163 27
a189 2
.Sh BUGS
Sure to be some.
@


1.9
log
@Remove hard sentence breaks. Add $OpenBSD$ tags where appropriate. Some other
cleanup along the way.
@
text
@d1 1
a1 1
.\"	$OpenBSD: pkg_delete.1,v 1.8 2000/03/06 21:46:55 aaron Exp $
d125 1
a125 1
.Xr pkg_create 1 ),
@


1.8
log
@Do not leave `(' characters dangling at the end of lines; instead, use the
appropriate mdoc macros to handle these cases.
@
text
@d1 1
a1 1
.\"	$OpenBSD: pkg_delete.1,v 1.7 1999/10/09 20:35:45 beck Exp $
d55 2
a56 1
provide installable package files.  For extra protection, examine all
d89 2
a90 1
which do not explicitly set theirs.  For most packages, the prefix will
d94 2
a95 1
Remove empty directories created by file cleanup.  By default, only
d99 2
a100 1
directive) will be removed at deinstallation time.  This option tells
d110 2
a111 1
does pretty much what it says.  It examines installed package records in
d138 2
a139 2
to see whether or not deinstallation should continue.  A non-zero exit
status means no, unless the
d168 2
a169 1
option above).  This allows a package author to write a script
@


1.7
log
@Band Aid fixes, polyglot of espies and mine:

  - ensure package files end in .tgz if not suffixed, but allow for .tar.gz and
uncompressed .tar as well.

  - make pkg_add take as many args as you can feed it. - "pkg_add *.tgz"
works now.

  - fix bug where realpath could fail and leave NULL in arg list.
  - fix bug where nonexistent package could fail and leave NULL in arg list.
@
text
@d1 1
a1 1
.\"	$OpenBSD: pkg_delete.1,v 1.6 1999/07/03 02:11:10 aaron Exp $
d56 2
a57 2
the package control files in the package record directory (
.Pa /var/db/pkg/<pkg-name>/ ).
@


1.6
log
@remove redundant .Pp macros
@
text
@d1 1
a1 1
.\"	$OpenBSD: pkg_delete.1,v 1.5 1999/06/05 22:17:50 aaron Exp $
d38 8
@


1.5
log
@remove trailing whitespace, some Nm cleanup
@
text
@d1 1
a1 1
.\"	$OpenBSD: pkg_delete.1,v 1.4 1998/12/16 02:47:53 aaron Exp $
a95 1
.Pp
@


1.4
log
@more .Nm fixes
@
text
@d1 1
a1 1
.\"	$OpenBSD: pkg_delete.1,v 1.3 1998/09/07 22:30:15 marc Exp $
d54 1
a54 1
.Cm @@mode 
d91 1
a91 1
the package.  
d99 1
a99 1
does pretty much what it says.  It examines installed package records in 
d112 1
a112 1
file (see 
@


1.3
log
@updated pkg_* tools.  Merged in many changes/improvements from NetBSD.
New features include md5 hash so pkg_delete won't remove files that have
changed and the ability to define conflicting packages, e.g. you can't
install both mh and nmh.  The ports tree will have to be updated to take
advantage of this.

Let me know of any problems, real or imagined :-)
@
text
@d1 1
a1 1
.\"	$OpenBSD: pkg_delete.1,v 1.2 1996/10/08 01:21:02 michaels Exp $
d21 1
a21 1
.Dt pkg_delete 1
d27 1
a27 1
.Nm
d30 1
a30 1
.Ar pkg-name ...
a37 1

a63 1

d67 1
a67 1
.It Ar pkg-name ...
a95 1

d115 1
a115 1
.Bd -filled -offset indent -compact
d120 1
d141 1
a141 1
.Bd -filled -offset indent -compact
d146 1
d169 1
a169 1
.Xr mtree 8 .
@


1.2
log
@Attempt at cleanup.
@
text
@d1 1
a1 1
.\"	$OpenBSD$
d18 1
a18 1
.\"     @@(#)pkg_delete.1
d25 1
a25 1
.Nd a utility for deleting previously installed software package distributions.
d67 1
a67 1
The following command line options are supported.
d72 1
a72 2
Turns on verbose output.
.Em "Optional."
a74 1
.Em "Optional."
a77 1
.Em "Optional."
d79 1
a79 1
Sets
a84 1
.Em "Optional."
a93 1
.Em "Optional."
a96 1
.Em "Optional."
d126 1
a126 1
.I DEINSTALL
@


1.1
log
@add package tools from FreeBSD
@
text
@d22 1
a22 1
.Os FreeBSD 2.0
@
