head	1.16;
access;
symbols
	OPENBSD_3_5:1.15.0.4
	OPENBSD_3_5_BASE:1.15
	OPENBSD_3_4:1.15.0.2
	OPENBSD_3_4_BASE:1.15
	OPENBSD_3_3:1.14.0.6
	OPENBSD_3_3_BASE:1.14
	OPENBSD_3_2:1.14.0.4
	OPENBSD_3_2_BASE:1.14
	OPENBSD_3_1:1.14.0.2
	OPENBSD_3_1_BASE:1.14
	OPENBSD_3_0:1.13.0.4
	OPENBSD_3_0_BASE:1.13
	OPENBSD_2_9_BASE:1.13
	OPENBSD_2_9:1.13.0.2
	OPENBSD_2_8:1.12.0.8
	OPENBSD_2_8_BASE:1.12
	OPENBSD_2_7:1.12.0.6
	OPENBSD_2_7_BASE:1.12
	OPENBSD_2_6:1.12.0.4
	OPENBSD_2_6_BASE:1.12
	OPENBSD_2_5:1.12.0.2
	OPENBSD_2_5_BASE:1.12
	OPENBSD_2_4:1.11.0.2
	OPENBSD_2_4_BASE:1.11
	OPENBSD_2_3:1.9.0.2
	OPENBSD_2_3_BASE:1.9
	OPENBSD_2_2:1.3.0.4
	OPENBSD_2_2_BASE:1.3
	OPENBSD_2_1:1.3.0.2
	OPENBSD_2_1_BASE:1.3
	OPENBSD_2_0:1.2.0.2
	OPENBSD_2_0_BASE:1.2;
locks; strict;
comment	@ * @;


1.16
date	2004.05.28.20.15.48;	author brad;	state dead;
branches;
next	1.15;

1.15
date	2003.07.04.17.31.19;	author avsm;	state Exp;
branches;
next	1.14;

1.14
date	2002.02.16.21.28.07;	author millert;	state Exp;
branches;
next	1.13;

1.13
date	2001.04.08.16.45.47;	author espie;	state Exp;
branches;
next	1.12;

1.12
date	99.02.28.18.55.25;	author deraadt;	state Exp;
branches;
next	1.11;

1.11
date	98.10.13.23.09.51;	author marc;	state Exp;
branches;
next	1.10;

1.10
date	98.09.07.22.30.15;	author marc;	state Exp;
branches;
next	1.9;

1.9
date	98.04.07.04.17.52;	author deraadt;	state Exp;
branches;
next	1.8;

1.8
date	98.04.04.22.44.20;	author deraadt;	state Exp;
branches;
next	1.7;

1.7
date	97.12.14.10.04.01;	author gene;	state Exp;
branches;
next	1.6;

1.6
date	97.12.14.09.42.19;	author gene;	state Exp;
branches;
next	1.5;

1.5
date	97.12.14.09.18.08;	author gene;	state Exp;
branches;
next	1.4;

1.4
date	97.11.17.14.01.28;	author gene;	state Exp;
branches;
next	1.3;

1.3
date	97.01.15.23.44.11;	author millert;	state Exp;
branches;
next	1.2;

1.2
date	96.06.04.08.43.39;	author niklas;	state Exp;
branches;
next	1.1;

1.1
date	96.06.04.07.56.09;	author niklas;	state Exp;
branches;
next	;


desc
@@


1.16
log
@bye bye old package tools.

ok deraadt@@
@
text
@/*	$OpenBSD: main.c,v 1.15 2003/07/04 17:31:19 avsm Exp $	*/

#ifndef lint
static const char rcsid[] = "$OpenBSD: main.c,v 1.15 2003/07/04 17:31:19 avsm Exp $";
#endif

/*
 *
 * FreeBSD install - a package for the installation and maintainance
 * of non-core utilities.
 *
 * Redistribution and use in source and binary forms, with or without
 * modification, are permitted provided that the following conditions
 * are met:
 * 1. Redistributions of source code must retain the above copyright
 *    notice, this list of conditions and the following disclaimer.
 * 2. Redistributions in binary form must reproduce the above copyright
 *    notice, this list of conditions and the following disclaimer in the
 *    documentation and/or other materials provided with the distribution.
 *
 * Jordan K. Hubbard
 * 18 July 1993
 *
 * This is the add module.
 *
 */

#include <err.h>
#include "lib.h"
#include "info.h"

static char Options[] = "acDde:fIikLl:mpqRrvh";

int	Flags		= 0;
Boolean AllInstalled	= FALSE;
Boolean Quiet		= FALSE;
char *InfoPrefix	= "";
char PlayPen[FILENAME_MAX];
size_t PlayPenSize	= sizeof(PlayPen);
char *CheckPkg		= NULL;

static void usage(void);

int
main(int argc, char **argv)
{
    int ch;
    char **pkgs, **start;

    pkgs = start = argv;
    while ((ch = getopt(argc, argv, Options)) != -1)
	switch(ch) {
	case 'a':
	    AllInstalled = TRUE;
	    break;

	case 'c':
	    Flags |= SHOW_COMMENT;
	    break;

	case 'D':
	    Flags |= SHOW_DISPLAY;
	    break;

	case 'd':
	    Flags |= SHOW_DESC;
	    break;

	case 'e':
	    CheckPkg = optarg;
	    break;

	case 'f':
	    Flags |= SHOW_PLIST;
	    break;

	case 'I':
	    Flags |= SHOW_INDEX;
	    break;

	case 'i':
	    Flags |= SHOW_INSTALL;
	    break;

	case 'k':
	    Flags |= SHOW_DEINSTALL;
	    break;

	case 'L':
	    Flags |= SHOW_FILES;
	    break;

	case 'l':
	    InfoPrefix = optarg;
	    break;

	case 'm':
	    Flags |= SHOW_MTREE;
	    break;

	case 'p':
	    Flags |= SHOW_PREFIX;
	    break;

	case 'q':
	    Quiet = TRUE;
	    break;

	case 'R':
	    Flags |= SHOW_REQBY;
	    break;

	case 'r':
	    Flags |= SHOW_REQUIRE;
	    break;

	case 'v':
	    Verbose = TRUE;
	    /* Reasonable definition of 'everything' */
	    Flags = SHOW_COMMENT | SHOW_DESC | SHOW_PLIST | SHOW_INSTALL |
		SHOW_DEINSTALL | SHOW_REQUIRE | SHOW_DISPLAY | SHOW_MTREE |
		SHOW_REQBY;
	    break;

	case 'h':
	case '?':
	default:
	    usage();
	    /* NOTREACHED */
	}

    argc -= optind;
    argv += optind;

    if (argc == 0 && !Flags) {
	/* No argument or flags specified - assume -Ia */
	Flags = SHOW_INDEX;
	AllInstalled = TRUE;
    }

    /* Set some reasonable defaults */
    if (!Flags)
	Flags = SHOW_COMMENT | SHOW_DESC | SHOW_REQBY;

    /* Get all the remaining package names, if any */
    while (*argv)
	*pkgs++ = *argv++;

    /* If no packages, yelp */
    if (pkgs == start && !AllInstalled && !CheckPkg)
	pwarnx("missing package name(s)"), usage();
    *pkgs = NULL;
    return pkg_perform(start);
}

static void
usage()
{
    fprintf(stderr, "usage: %s\nusage: %s\n",
	"pkg_info [-cDdfIikLmpqRrvh] [-e package] [-l prefix] pkg-name ...",
	"pkg_info -a [flags]");
    exit(1);
}
@


1.15
log
@'static const char rcsid[]' to make it -Wall clean
@
text
@d1 1
a1 1
/*	$OpenBSD: main.c,v 1.14 2002/02/16 21:28:07 millert Exp $	*/
d4 1
a4 1
static const char rcsid[] = "$OpenBSD: main.c,v 1.14 2002/02/16 21:28:07 millert Exp $";
@


1.14
log
@Part one of userland __P removal.  Done with a simple regexp with some minor hand editing to make comments line up correctly.  Another pass is forthcoming that handles the cases that could not be done automatically.
@
text
@d1 1
a1 1
/*	$OpenBSD: main.c,v 1.13 2001/04/08 16:45:47 espie Exp $	*/
d4 1
a4 1
static char *rcsid = "$OpenBSD: main.c,v 1.13 2001/04/08 16:45:47 espie Exp $";
@


1.13
log
@Better error messages: pwarnx function, which works like pwarn, except
it shows a current package name along with the program name, e.g.,
pkg_add(foo-3.0): some error occurred.

A few messages now bear redundant pkgnames, which is much better than
doing pkg_add * and being informed that something went slightly wrong
somewhere...
@
text
@d1 1
a1 1
/*	$OpenBSD: main.c,v 1.12 1999/02/28 18:55:25 deraadt Exp $	*/
d4 1
a4 1
static char *rcsid = "$OpenBSD: main.c,v 1.12 1999/02/28 18:55:25 deraadt Exp $";
d42 1
a42 1
static void usage __P((void));
@


1.12
log
@nice usage messages
@
text
@d1 1
a1 1
/*	$OpenBSD: main.c,v 1.11 1998/10/13 23:09:51 marc Exp $	*/
d4 1
a4 1
static char *rcsid = "$OpenBSD: main.c,v 1.11 1998/10/13 23:09:51 marc Exp $";
d151 1
a151 1
	warnx("missing package name(s)"), usage();
@


1.11
log
@Sync with recent NetBSD changes:
- use snprintf in place of sprintf
- code cleanup
- Package -> package_t, PackingList -> plist_t
Also: remove files that haven't been linked in a while
Pass -q to mtree so it is quiet in the presence of symlinks
@
text
@d1 1
a1 1
/*	$OpenBSD: main.c,v 1.10 1998/09/07 22:30:15 marc Exp $	*/
d4 1
a4 1
static char *rcsid = "$OpenBSD: main.c,v 1.10 1998/09/07 22:30:15 marc Exp $";
d159 3
a161 4
    fprintf(stderr, "%s\n%s\n%s\n",
	"usage: pkg_info [-cDdfIikLmpqRrvh] [-e package] [-l prefix]",
	"                pkg-name [pkg-name ...]",
	"       pkg_info -a [flags]");
@


1.10
log
@updated pkg_* tools.  Merged in many changes/improvements from NetBSD.
New features include md5 hash so pkg_delete won't remove files that have
changed and the ability to define conflicting packages, e.g. you can't
install both mh and nmh.  The ports tree will have to be updated to take
advantage of this.

Let me know of any problems, real or imagined :-)
@
text
@d1 1
a1 1
/*	$OpenBSD: main.c,v 1.9 1998/04/07 04:17:52 deraadt Exp $	*/
d4 1
a4 1
static char *rcsid = "$OpenBSD: main.c,v 1.9 1998/04/07 04:17:52 deraadt Exp $";
d39 1
d121 2
a122 1
		SHOW_DEINSTALL | SHOW_REQUIRE | SHOW_DISPLAY | SHOW_MTREE;
@


1.9
log
@cleanup usage even more; very annoying
@
text
@d1 1
a1 1
/*	$OpenBSD: main.c,v 1.8 1998/04/04 22:44:20 deraadt Exp $	*/
d4 1
a4 1
static char *rcsid = "$OpenBSD: main.c,v 1.8 1998/04/04 22:44:20 deraadt Exp $";
d28 1
d32 1
a32 1
static char Options[] = "acdDe:fikrRpLqImvhl:";
d37 5
a41 3
char	*InfoPrefix	= "";
char 	PlayPen[FILENAME_MAX];
char 	*CheckPkg	= NULL;
a47 1
    char *prog_name = argv[0];
d56 2
a57 5
	case 'v':
	    Verbose = TRUE;
	    /* Reasonable definition of 'everything' */
	    Flags = SHOW_COMMENT | SHOW_DESC | SHOW_PLIST | SHOW_INSTALL |
		SHOW_DEINSTALL | SHOW_REQUIRE | SHOW_DISPLAY | SHOW_MTREE;
d60 2
a61 10
	case 'I':
	    Flags |= SHOW_INDEX;
	    break;

	case 'p':
	    Flags |= SHOW_PREFIX;
	    break;

	case 'c':
	    Flags |= SHOW_COMMENT;
d68 2
a69 2
	case 'D':
	    Flags |= SHOW_DISPLAY;
d76 4
d88 2
a89 2
	case 'r':
	    Flags |= SHOW_REQUIRE;
d92 2
a93 6
	case 'R':
	    Flags |= SHOW_REQBY;
	    break;

	case 'L':
	    Flags |= SHOW_FILES;
d100 2
a101 2
	case 'l':
	    InfoPrefix = optarg;
d108 6
a113 2
	case 't':
	    strncpy(PlayPen, optarg, FILENAME_MAX);
d116 5
a120 2
	case 'e':
	    CheckPkg = optarg;
d126 2
a127 2
	    usage(prog_name, NULL);
	    break;
d133 10
d147 3
a149 6
    /* Set some reasonable defaults */
    if (!Flags) {
	Flags |= SHOW_INDEX;
	if (pkgs == start)
	    AllInstalled = TRUE;
    }
d154 2
a155 2
void
usage(const char *name, const char *fmt, ...)
d157 4
a160 12
    va_list args;

    va_start(args, fmt);
    if (fmt) {
	fprintf(stderr, "%s: ", name);
	vfprintf(stderr, fmt, args);
	fprintf(stderr, "\n");
    }
    va_end(args);
    fprintf(stderr,
	"usage: %s [-a] [-cdDikrRpLqImv] [-e package] [-l prefix] pkg ...\n",
	name);
@


1.8
log
@fix usage
@
text
@d1 1
a1 1
/*	$OpenBSD: main.c,v 1.7 1997/12/14 10:04:01 gene Exp $	*/
d4 1
a4 1
static char *rcsid = "$OpenBSD: main.c,v 1.7 1997/12/14 10:04:01 gene Exp $";
d158 1
a158 1
	fprintf(stderr, "\n\n");
d161 3
a163 19
    fprintf(stderr, "Usage: %s [args] pkg [ .. pkg ]\n", name);
    fprintf(stderr, "\t-a         show all installed packages (if any)\n");
    fprintf(stderr, "\t-I         print 'index' of packages\n");
    fprintf(stderr, "\t-c         print `one line comment'\n");
    fprintf(stderr, "\t-d         print description\n");
    fprintf(stderr, "\t-D         print install notice\n");
    fprintf(stderr, "\t-f         show packing list\n");
    fprintf(stderr, "\t-i         show install script\n");
    fprintf(stderr, "\t-k         show deinstall script\n");
    fprintf(stderr, "\t-r         show requirements script\n");
    fprintf(stderr, "\t-R         show packages depending on this package\n");
    fprintf(stderr, "\t-p         show prefix\n");
    fprintf(stderr, "\t-l <str>   Prefix each info catagory with <str>\n");
    fprintf(stderr, "\t-L         show installed files\n");
    fprintf(stderr, "\t-q         minimal output (``quiet'' mode)\n");
    fprintf(stderr, "\t-v         show all information\n");
    fprintf(stderr, "\t-t temp    use temp as template for mktemp()\n");
    fprintf(stderr, "\t-e pkg     returns 0 if pkg is installed, 1 otherwise\n");
    fprintf(stderr, "\t[default: args = -a -I]\n");
@


1.7
log
@Whoops.  Remember to update usage when changing the way defualt handling is
done.
@
text
@d1 1
a1 1
/*	$OpenBSD: main.c,v 1.6 1997/12/14 09:42:19 gene Exp $	*/
d4 1
a4 1
static char *rcsid = "$OpenBSD: main.c,v 1.6 1997/12/14 09:42:19 gene Exp $";
d162 18
a179 19
    fprintf(stderr, "Where args are one or more of:\n\n");
    fprintf(stderr, "-a         show all installed packages (if any)\n");
    fprintf(stderr, "-I         print 'index' of packages\n");
    fprintf(stderr, "-c         print `one line comment'\n");
    fprintf(stderr, "-d         print description\n");
    fprintf(stderr, "-D         print install notice\n");
    fprintf(stderr, "-f         show packing list\n");
    fprintf(stderr, "-i         show install script\n");
    fprintf(stderr, "-k         show deinstall script\n");
    fprintf(stderr, "-r         show requirements script\n");
    fprintf(stderr, "-R         show packages depending on this package\n");
    fprintf(stderr, "-p         show prefix\n");
    fprintf(stderr, "-l <str>   Prefix each info catagory with <str>\n");
    fprintf(stderr, "-L         show installed files\n");
    fprintf(stderr, "-q         minimal output (``quiet'' mode)\n");
    fprintf(stderr, "-v         show all information\n");
    fprintf(stderr, "-t temp    use temp as template for mktemp()\n");
    fprintf(stderr, "-e pkg     returns 0 if pkg is installed, 1 otherwise\n");
    fprintf(stderr, "\n[no args = -a -I]\n");
@


1.6
log
@Invoke raging paranoia on strcpy's that should be strncpy's.
These should be checked in all but one case anyway, but you never know.
@
text
@d1 1
a1 1
/*	$OpenBSD: main.c,v 1.5 1997/12/14 09:18:08 gene Exp $	*/
d4 1
a4 1
static char *rcsid = "$OpenBSD: main.c,v 1.5 1997/12/14 09:18:08 gene Exp $";
d180 1
a180 1
    fprintf(stderr, "\n[no args = -c -d -R]\n");
@


1.5
log
@Inspired by changes in NetBSD but done a different way.
pkg_info by itself acts as if -a -I were given, and
when no flags are passed with package names, -I is implied.
@
text
@d1 1
a1 1
/*	$OpenBSD: main.c,v 1.4 1997/11/17 14:01:28 gene Exp $	*/
d4 1
a4 1
static char *rcsid = "$OpenBSD: main.c,v 1.4 1997/11/17 14:01:28 gene Exp $";
d118 1
a118 1
	    strcpy(PlayPen, optarg);
@


1.4
log
@Fix a pretty embarrassing typo in the Usage help message.
Also, minor KNF whlle here.
@
text
@d1 1
a1 1
/*	$OpenBSD: main.c,v 1.3 1997/01/15 23:44:11 millert Exp $	*/
d4 1
a4 1
static char *rcsid = "$OpenBSD: main.c,v 1.3 1997/01/15 23:44:11 millert Exp $";
a134 4
    /* Set some reasonable defaults */
    if (!Flags)
	Flags = SHOW_COMMENT | SHOW_DESC | SHOW_REQBY;

d139 6
a144 3
    /* If no packages, yelp */
    if (pkgs == start && !AllInstalled && !CheckPkg)
	usage(prog_name, "Missing package name(s)");
@


1.3
log
@getopt(3) returns -1 when out of args, not EOF, whee!
@
text
@d1 1
a1 1
/*	$OpenBSD: main.c,v 1.2 1996/06/04 08:43:39 niklas Exp $	*/
d4 1
a4 1
static char *rcsid = "$OpenBSD: main.c,v 1.2 1996/06/04 08:43:39 niklas Exp $";
d36 3
a38 3
char *InfoPrefix	= "";
char PlayPen[FILENAME_MAX];
char *CheckPkg		= NULL;
d176 1
a176 1
    fprintf(stderr, "-L         show intalled files\n");
@


1.2
log
@Oops, screwed up the $OpenBSD$ IDs
@
text
@d1 1
a1 1
/*	$OpenBSD: main.c,v 1.1 1996/06/04 07:56:09 niklas Exp $	*/
d4 1
a4 1
static char *rcsid = "$OpenBSD: main.c,v 1.1 1996/06/04 07:56:09 niklas Exp $";
d48 1
a48 1
    while ((ch = getopt(argc, argv, Options)) != EOF)
@


1.1
log
@add package tools from FreeBSD
@
text
@d1 2
a2 1
#	$OpenBSD$
d4 1
a4 1
static char *rcsid = "$OpenBSD: main.c,v 1.10 1995/10/25 15:38:29 jkh Exp $";
@
