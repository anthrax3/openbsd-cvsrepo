head	1.5;
access;
symbols
	OPENBSD_3_3:1.4.0.4
	OPENBSD_3_3_BASE:1.4
	OPENBSD_3_2:1.4.0.2
	OPENBSD_3_2_BASE:1.4
	OPENBSD_3_1:1.2.0.12
	OPENBSD_3_1_BASE:1.2
	OPENBSD_3_0:1.2.0.10
	OPENBSD_3_0_BASE:1.2
	OPENBSD_2_9_BASE:1.2
	OPENBSD_2_9:1.2.0.8
	OPENBSD_2_8:1.2.0.6
	OPENBSD_2_8_BASE:1.2
	OPENBSD_2_7:1.2.0.4
	OPENBSD_2_7_BASE:1.2
	OPENBSD_2_6:1.2.0.2
	OPENBSD_2_6_BASE:1.2
	OPENBSD_2_5:1.1.0.10
	OPENBSD_2_5_BASE:1.1
	OPENBSD_2_4:1.1.0.8
	OPENBSD_2_4_BASE:1.1
	OPENBSD_2_3:1.1.0.6
	OPENBSD_2_3_BASE:1.1
	OPENBSD_2_2:1.1.0.4
	OPENBSD_2_2_BASE:1.1
	OPENBSD_2_1:1.1.0.2
	OPENBSD_2_1_BASE:1.1;
locks; strict;
comment	@ * @;


1.5
date	2003.07.23.19.44.28;	author deraadt;	state dead;
branches;
next	1.4;

1.4
date	2002.06.01.20.27.15;	author deraadt;	state Exp;
branches;
next	1.3;

1.3
date	2002.05.29.19.01.48;	author deraadt;	state Exp;
branches;
next	1.2;

1.2
date	99.05.23.17.19.23;	author aaron;	state Exp;
branches;
next	1.1;

1.1
date	97.03.11.03.23.15;	author kstailey;	state Exp;
branches;
next	;


desc
@@


1.5
log
@bye bye
@
text
@static char *rcs_id = "$Id: reset_scanner.c,v 1.4 2002/06/01 20:27:15 deraadt Exp $";
#ifdef _IBMR2
/*
 *  PINT Pint Is Not TWAIN - common scanner driver interface for UN*X
 *  Copyright (C) 1994 Kenneth Stailey kstailey@@leidecker.gsfc.nasa.gov
 *
 *  This program is free software; you can redistribute it and/or modify
 *  it under the terms of the GNU General Public License as published by
 *  the Free Software Foundation; either version 2 of the License, or
 *  (at your option) any later version.
 *
 *  This program is distributed in the hope that it will be useful,
 *  but WITHOUT ANY WARRANTY; without even the implied warranty of
 *  MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
 *  GNU General Public License for more details.
 *
 *  You should have received a copy of the GNU General Public License
 *  along with this program; if not, write to the Free Software
 *  Foundation, Inc., 675 Mass Ave, Cambridge, MA 02139, USA.
 */

/*
 * reset_scanner.c: clear scanner of error conditions
 * Ricoh IS-50's and IS-410's don't have reset buttons, but could use them.
 */

#include <stdio.h>
#include <fcntl.h>
#include <sys/scsi.h>

void
usage(char *prog_name)
{
  fprintf(stderr, "usage: %s [-l <logical name>]\n", prog_name);
  exit(1);
}

main(int argc, char *argv[])
{
  int sfd;
  char *logical_name = "scan0";
  char device[255];
  char cmd[255];

  int fast = FALSE;

  int c;
  extern int optind;
  extern char *optarg;

  while ((c = getopt(argc, argv, "fl:")) != -1) {
    switch (c) {
    case 'l':
      logical_name = optarg;
      break;

    case 'f':
      fast = TRUE;
      break;

    case '?':
      usage(argv[0]);
      break;
    }
  }

  snprintf(device, sizeof device, "/dev/%s", logical_device);

  if ((sfd = openx(device, O_RDONLY, 0, SC_FORCED_OPEN)) < 0) {
    fprintf(stderr, "openx of %s failed: ", device);
    perror("");
    exit(1);
  }

  close(sfd);

  if (fast)
    exit(0);

  snprintf(cmd, sizeof cmd, "rmdev -l %s", logical_name);
  system(cmd);
  snprintf(cmd, sizeof cmd, "mkdev -l %s", logical_name);
  system(cmd);
}
#else
main()
{
  printf("this only works for AIX 3.2\n");
}
#endif
@


1.4
log
@exit 1 not -1
@
text
@d1 1
a1 1
static char *rcs_id = "$Id: reset_scanner.c,v 1.3 2002/05/29 19:01:48 deraadt Exp $";
@


1.3
log
@snprintf, strlcpy, strlcat
@
text
@d1 1
a1 1
static char *rcs_id = "$Id: reset_scanner.c,v 1.2 1999/05/23 17:19:23 aaron Exp $";
d35 1
a35 1
  exit(-1);
d72 1
a72 1
    exit(-1);
@


1.2
log
@getopt(3) returns -1, not EOF
@
text
@d1 1
a1 1
static char *rcs_id = "$Id: reset_scanner.c,v 1.1 1997/03/11 03:23:15 kstailey Exp $";
d67 1
a67 2
  strcpy(device, "/dev/");
  strcat(device, logical_name);
d80 1
a80 1
  sprintf(cmd, "rmdev -l %s", logical_name);
d82 1
a82 1
  sprintf(cmd, "mkdev -l %s", logical_name);
@


1.1
log
@the PINT scanner utilities for now
@
text
@d1 1
a1 1
static char *rcs_id = "$Id: reset_scanner.c,v 1.1 1996/01/14 01:36:57 ken Exp $";
d51 1
a51 1
  while ((c = getopt(argc, argv, "fl:")) != EOF) {
@

