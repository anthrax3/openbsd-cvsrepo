head	1.47;
access;
symbols
	OPENBSD_6_0:1.47.0.8
	OPENBSD_6_0_BASE:1.47
	OPENBSD_5_9:1.47.0.4
	OPENBSD_5_9_BASE:1.47
	OPENBSD_5_8:1.47.0.6
	OPENBSD_5_8_BASE:1.47
	OPENBSD_5_7:1.47.0.2
	OPENBSD_5_7_BASE:1.47
	OPENBSD_5_6:1.44.0.4
	OPENBSD_5_6_BASE:1.44
	OPENBSD_5_5:1.43.0.16
	OPENBSD_5_5_BASE:1.43
	OPENBSD_5_4:1.43.0.12
	OPENBSD_5_4_BASE:1.43
	OPENBSD_5_3:1.43.0.10
	OPENBSD_5_3_BASE:1.43
	OPENBSD_5_2:1.43.0.8
	OPENBSD_5_2_BASE:1.43
	OPENBSD_5_1_BASE:1.43
	OPENBSD_5_1:1.43.0.6
	OPENBSD_5_0:1.43.0.4
	OPENBSD_5_0_BASE:1.43
	OPENBSD_4_9:1.43.0.2
	OPENBSD_4_9_BASE:1.43
	OPENBSD_4_8:1.42.0.2
	OPENBSD_4_8_BASE:1.42
	OPENBSD_4_7:1.41.0.2
	OPENBSD_4_7_BASE:1.41
	OPENBSD_4_6:1.38.0.10
	OPENBSD_4_6_BASE:1.38
	OPENBSD_4_5:1.38.0.6
	OPENBSD_4_5_BASE:1.38
	OPENBSD_4_4:1.38.0.4
	OPENBSD_4_4_BASE:1.38
	OPENBSD_4_3:1.38.0.2
	OPENBSD_4_3_BASE:1.38
	OPENBSD_4_2:1.36.0.2
	OPENBSD_4_2_BASE:1.36
	OPENBSD_4_1:1.35.0.4
	OPENBSD_4_1_BASE:1.35
	OPENBSD_4_0:1.35.0.2
	OPENBSD_4_0_BASE:1.35
	OPENBSD_3_9:1.33.0.2
	OPENBSD_3_9_BASE:1.33
	OPENBSD_3_8:1.28.0.2
	OPENBSD_3_8_BASE:1.28
	OPENBSD_3_7:1.26.0.2
	OPENBSD_3_7_BASE:1.26
	OPENBSD_3_6:1.24.0.6
	OPENBSD_3_6_BASE:1.24
	OPENBSD_3_5:1.24.0.4
	OPENBSD_3_5_BASE:1.24
	OPENBSD_3_4:1.24.0.2
	OPENBSD_3_4_BASE:1.24
	OPENBSD_3_3:1.23.0.4
	OPENBSD_3_3_BASE:1.23
	OPENBSD_3_2:1.23.0.2
	OPENBSD_3_2_BASE:1.23
	OPENBSD_3_1:1.21.0.4
	OPENBSD_3_1_BASE:1.21
	OPENBSD_3_0:1.21.0.2
	OPENBSD_3_0_BASE:1.21
	OPENBSD_2_9_BASE:1.16
	OPENBSD_2_9:1.16.0.2
	OPENBSD_2_8:1.11.0.4
	OPENBSD_2_8_BASE:1.11
	OPENBSD_2_7:1.11.0.2
	OPENBSD_2_7_BASE:1.11
	OPENBSD_2_6:1.10.0.2
	OPENBSD_2_6_BASE:1.10
	OPENBSD_2_5:1.8.0.2
	OPENBSD_2_5_BASE:1.8
	OPENBSD_2_4:1.5.0.2
	OPENBSD_2_4_BASE:1.5
	OPENBSD_2_3:1.3.0.2
	OPENBSD_2_3_BASE:1.3
	OPENBSD_2_2:1.2.0.2
	OPENBSD_2_2_BASE:1.2
	OPENBSD_2_1:1.1.0.4
	OPENBSD_2_1_BASE:1.1
	OPENBSD_2_0:1.1.0.2
	OPENBSD_2_0_BASE:1.1;
locks; strict;
comment	@# @;


1.47
date	2015.02.12.14.03.49;	author schwarze;	state Exp;
branches;
next	1.46;
commitid	TFim9dXi86llUxLq;

1.46
date	2014.12.31.11.37.40;	author dcoppa;	state Exp;
branches;
next	1.45;
commitid	oHCcc3NAV9sXjYxh;

1.45
date	2014.10.17.01.55.00;	author tedu;	state Exp;
branches;
next	1.44;
commitid	3d0XOepUjTsn1T1F;

1.44
date	2014.07.24.01.04.58;	author tedu;	state Exp;
branches;
next	1.43;
commitid	PBySuG2OqgHtxAQi;

1.43
date	2010.10.28.18.21.20;	author jmc;	state Exp;
branches;
next	1.42;

1.42
date	2010.04.02.04.12.46;	author deraadt;	state Exp;
branches;
next	1.41;

1.41
date	2009.10.22.15.02.12;	author sobrado;	state Exp;
branches;
next	1.40;

1.40
date	2009.10.22.12.35.53;	author sobrado;	state Exp;
branches;
next	1.39;

1.39
date	2009.08.04.18.26.48;	author jmc;	state Exp;
branches;
next	1.38;

1.38
date	2007.12.05.19.49.34;	author jmc;	state Exp;
branches;
next	1.37;

1.37
date	2007.12.05.16.47.09;	author jmc;	state Exp;
branches;
next	1.36;

1.36
date	2007.05.31.19.20.22;	author jmc;	state Exp;
branches;
next	1.35;

1.35
date	2006.05.16.21.17.21;	author ian;	state Exp;
branches;
next	1.34;

1.34
date	2006.03.15.20.30.28;	author sturm;	state Exp;
branches;
next	1.33;

1.33
date	2006.01.19.19.17.10;	author sturm;	state Exp;
branches;
next	1.32;

1.32
date	2005.12.02.09.19.39;	author jmc;	state Exp;
branches;
next	1.31;

1.31
date	2005.12.02.04.27.52;	author beck;	state Exp;
branches;
next	1.30;

1.30
date	2005.11.23.08.02.58;	author sturm;	state Exp;
branches;
next	1.29;

1.29
date	2005.11.15.01.19.56;	author jmc;	state Exp;
branches;
next	1.28;

1.28
date	2005.06.14.15.18.53;	author deraadt;	state Exp;
branches;
next	1.27;

1.27
date	2005.06.09.15.14.23;	author xsa;	state Exp;
branches;
next	1.26;

1.26
date	2005.03.01.14.55.19;	author mickey;	state Exp;
branches;
next	1.25;

1.25
date	2005.03.01.13.22.43;	author miod;	state Exp;
branches;
next	1.24;

1.24
date	2003.05.11.05.26.10;	author pjanzen;	state Exp;
branches;
next	1.23;

1.23
date	2002.06.14.04.21.41;	author deraadt;	state Exp;
branches;
next	1.22;

1.22
date	2002.05.16.08.47.50;	author mpech;	state Exp;
branches;
next	1.21;

1.21
date	2001.07.18.16.03.06;	author mickey;	state Exp;
branches;
next	1.20;

1.20
date	2001.07.07.01.10.41;	author mickey;	state Exp;
branches;
next	1.19;

1.19
date	2001.07.05.22.06.00;	author mickey;	state Exp;
branches;
next	1.18;

1.18
date	2001.07.04.07.10.51;	author mickey;	state Exp;
branches;
next	1.17;

1.17
date	2001.07.04.06.03.10;	author jasoni;	state Exp;
branches;
next	1.16;

1.16
date	2001.03.23.01.00.41;	author mickey;	state Exp;
branches;
next	1.15;

1.15
date	2001.03.22.06.06.27;	author deraadt;	state Exp;
branches;
next	1.14;

1.14
date	2001.03.22.05.24.03;	author angelos;	state Exp;
branches;
next	1.13;

1.13
date	2001.03.22.04.51.13;	author angelos;	state Exp;
branches;
next	1.12;

1.12
date	2001.03.22.01.14.06;	author angelos;	state Exp;
branches;
next	1.11;

1.11
date	2000.03.19.17.57.01;	author aaron;	state Exp;
branches;
next	1.10;

1.10
date	99.06.05.22.16.28;	author aaron;	state Exp;
branches;
next	1.9;

1.9
date	99.05.23.14.11.32;	author aaron;	state Exp;
branches;
next	1.8;

1.8
date	99.02.23.04.17.34;	author marc;	state Exp;
branches;
next	1.7;

1.7
date	98.12.15.01.20.47;	author aaron;	state Exp;
branches;
next	1.6;

1.6
date	98.11.08.00.21.26;	author aaron;	state Exp;
branches;
next	1.5;

1.5
date	98.07.21.04.06.29;	author marc;	state Exp;
branches;
next	1.4;

1.4
date	98.07.18.02.42.27;	author marc;	state Exp;
branches;
next	1.3;

1.3
date	98.03.10.04.51.05;	author millert;	state Exp;
branches;
next	1.2;

1.2
date	97.07.24.14.58.53;	author deraadt;	state Exp;
branches;
next	1.1;

1.1
date	96.04.29.13.08.45;	author hvozda;	state Exp;
branches;
next	;


desc
@@


1.47
log
@add missing .Pa macros; patch from Theo Buehler <theo at math dot ethz dot ch>
@
text
@.\"	$OpenBSD: apmd.8,v 1.46 2014/12/31 11:37:40 dcoppa Exp $
.\"
.\" Copyright (c) 1995 John T. Kohl
.\" All rights reserved.
.\"
.\" Redistribution and use in source and binary forms, with or without
.\" modification, are permitted provided that the following conditions
.\" are met:
.\" 1. Redistributions of source code must retain the above copyright
.\"    notice, this list of conditions and the following disclaimer.
.\" 2. Redistributions in binary form must reproduce the above copyright
.\"    notice, this list of conditions and the following disclaimer in the
.\"    documentation and/or other materials provided with the distribution.
.\" 3. The name of the author may not be used to endorse or promote products
.\"    derived from this software without specific prior written permission.
.\"
.\" THIS SOFTWARE IS PROVIDED BY THE AUTHOR `AS IS'' AND ANY EXPRESS OR
.\" IMPLIED WARRANTIES, INCLUDING, BUT NOT LIMITED TO, THE IMPLIED
.\" WARRANTIES OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE ARE
.\" DISCLAIMED.  IN NO EVENT SHALL THE AUTHOR BE LIABLE FOR ANY DIRECT,
.\" INDIRECT, INCIDENTAL, SPECIAL, EXEMPLARY, OR CONSEQUENTIAL DAMAGES
.\" (INCLUDING, BUT NOT LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR
.\" SERVICES; LOSS OF USE, DATA, OR PROFITS; OR BUSINESS INTERRUPTION)
.\" HOWEVER CAUSED AND ON ANY THEORY OF LIABILITY, WHETHER IN CONTRACT,
.\" STRICT LIABILITY, OR TORT (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN
.\" ANY WAY OUT OF THE USE OF THIS SOFTWARE, EVEN IF ADVISED OF THE
.\" POSSIBILITY OF SUCH DAMAGE.
.\"
.Dd $Mdocdate: December 31 2014 $
.Dt APMD 8
.Os
.Sh NAME
.Nm apmd
.Nd Advanced Power Management daemon
.Sh SYNOPSIS
.Nm apmd
.Op Fl AadHLs
.Op Fl f Ar devname
.Op Fl S Ar sockname
.Op Fl t Ar seconds
.Sh DESCRIPTION
.Nm
monitors the advanced power management device,
.Xr apm 4 ,
acting on signaled events and upon user requests as sent by the
.Xr apm 8
program.
.Pp
For suspend and standby request events delivered by the BIOS, or via
.Xr apm 8 ,
.Nm
runs the appropriate configuration program (if one exists),
syncs the buffer cache to disk and initiates the requested state.
When resuming after suspend or standby,
.Nm
runs the appropriate configuration program (if one exists).
.Pp
When the power status changes
(battery is connected or disconnected)
.Nm
fetches the current status and reports it via
.Xr syslog 3
with logging facility
.Dv LOG_DAEMON .
.Pp
The options are as follows:
.Bl -tag -width Ds
.It Fl A
Start
.Nm
in automatic performance adjustment mode.
.It Fl a
BIOS-initiated suspend or standby requests are
ignored if the system is connected to line current and not running from
batteries (user requests are still honored).
.It Fl d
.Nm
enters debug mode, logging to facility
.Dv LOG_LOCAL1 ,
and stays in the foreground on the controlling terminal.
.It Fl f Ar devname
Specify an alternate device file name,
.Ar devname .
.It Fl H
Start
.Nm
in manual performance adjustment mode, initialising
.Va hw.setperf
to 100.
.It Fl L
Start
.Nm
in manual performance adjustment mode, initialising
.Va hw.setperf
to 0.
.It Fl S Ar sockname
Specify an alternate socket name,
.Ar sockname .
The socket is protected to mode 0660, UID 0, GID 0; this protects access
to suspend requests to authorized users only.
.It Fl s
Current battery statistics are reported via
.Xr syslog 3
and
.Nm
exits without monitoring the APM status.
.It Fl t Ar seconds
.Nm
periodically polls the APM driver for the current power state.
If the battery charge level changes substantially or the external power
status changes, the new status is logged.
The polling rate defaults to
once per 10 minutes, but may be specified using the
.Fl t
command-line flag.
.El
.Pp
When a client requests a suspend or stand-by state,
.Nm
does not wait for positive confirmation that the requested
state has been entered before replying to the client; to do so would mean
the client does not get a reply until the system resumes from its sleep state.
Rather,
.Nm
replies with the intended state to the client and then places the system
in the requested state after running the configuration script and
flushing the buffer cache.
.Pp
Actions can be configured for the following transitions:
suspend,
hibernate,
standby,
resume,
powerup,
and
powerdown.
The suspend, hibernate and standby actions are run prior to
.Nm
performing any other actions (such as disk syncs) and entering the new
state.
The resume program is run after resuming from a stand-by or
suspended state.
The powerup and powerdown programs are run after the power status (AC
connected or not) changes, as well as after a resume (if the power
status changed in the mean time).
.Sh FILES
.Bl -tag -width "/etc/apm/powerdownXX" -compact
.It Pa /dev/apmctl
Default device used to control the APM kernel driver.
.Pp
.It Pa /etc/apm/suspend
.It Pa /etc/apm/hibernate
.It Pa /etc/apm/standby
.It Pa /etc/apm/resume
.It Pa /etc/apm/powerup
.It Pa /etc/apm/powerdown
These files contain the host's customized actions.
Each file must be an executable binary or shell script.
A single program or script can be used to control all transitions
by examining the name by which it was called,
which is one of
suspend,
hibernate,
standby,
resume,
powerup,
or
powerdown.
.Pp
.It Pa /var/run/apmdev
Default
.Ux Ns -domain
socket used for communication with
.Xr apm 8 .
.El
.Sh SEE ALSO
.Xr syslog 3 ,
.Xr apm 4 ,
.Xr apm 8 ,
.Xr sysctl 8
.Pp
Advanced Power Management (APM) BIOS Interface Specification
(revision 1.2),
Intel Corporation and Microsoft Corporation.
.Sh HISTORY
The
.Nm
command first appeared in
.Nx 1.3 .
.Ox
support was added in
.Ox 1.2 .
@


1.46
log
@
Mention previously missing '/etc/apm/hibernate' action

From Alessandro DE LAURENZIS <just22_dot_adl_at_gmail_dot_com>

tweak and ok jmc@@
@
text
@d1 1
a1 1
.\"	$OpenBSD: apmd.8,v 1.45 2014/10/17 01:55:00 tedu Exp $
d29 1
a29 1
.Dd $Mdocdate: October 17 2014 $
d148 1
a148 1
.It /dev/apmctl
d151 6
a156 6
.It /etc/apm/suspend
.It /etc/apm/hibernate
.It /etc/apm/standby
.It /etc/apm/resume
.It /etc/apm/powerup
.It /etc/apm/powerdown
d170 1
a170 1
.It /var/run/apmdev
@


1.45
log
@remove performance throttling code from here, use the kernel version
instead. this effectively kills -C, though the option is kept for compat.
@
text
@d1 1
a1 1
.\"	$OpenBSD: apmd.8,v 1.44 2014/07/24 01:04:58 tedu Exp $
d29 1
a29 1
.Dd $Mdocdate: July 24 2014 $
d129 1
a129 1
Actions can be configured for the following five transitions:
d131 1
d137 1
a137 1
The suspend and standby actions are run prior to
d152 1
d163 1
@


1.44
log
@Steven Roberts sent me a patch updating the various setperf thresholds.
But instead of continuing to overdocument internal behavior, provide a
high level description of the modes and their purpose.
@
text
@d1 1
a1 1
.\"	$OpenBSD: apmd.8,v 1.43 2010/10/28 18:21:20 jmc Exp $
d29 1
a29 1
.Dd $Mdocdate: October 28 2010 $
d37 1
a37 1
.Op Fl AaCdHLs
a71 4
Optimize for performance, but lower
.Va hw.setperf
when running on battery power or when AC is connected but the battery charge
level is low.
a75 7
.It Fl C
Start
.Nm
in cool running performance adjustment mode.
Optimize for low power use by keeping
.Va hw.setperf
low, except when CPU idle time drops and more performance is required.
@


1.43
log
@wording clarification; from Jan Stary
ok deraadt
@
text
@d1 1
a1 1
.\"	$OpenBSD: apmd.8,v 1.42 2010/04/02 04:12:46 deraadt Exp $
d29 1
a29 1
.Dd $Mdocdate: April 2 2010 $
d72 1
a72 11
In this mode, when CPU idle time falls below 10%,
or if the AC power is connected and the battery is more than 15% charged,
or if the battery is absent,
.Nm
raises
.Va hw.setperf
to 100.
Otherwise when CPU idle time is above 30%
and the system is running on battery power,
.Nm
lowers
d74 2
a75 1
as much as possible to reduce power consumption.
d84 1
a84 8
In this mode, when CPU idle time falls below 10%,
.Nm
raises
.Va hw.setperf
as much as necessary.
Otherwise when CPU idle time is above 30%,
.Nm
lowers
d86 1
a86 1
as much as possible to reduce heat, noise, and power consumption.
@


1.42
log
@In automatic mode if the battery is absent go to 100%
From Pawlowski Marcin Piotr
ok tedu
@
text
@d1 1
a1 1
.\"	$OpenBSD: apmd.8,v 1.41 2009/10/22 15:02:12 sobrado Exp $
d29 1
a29 1
.Dd $Mdocdate: October 22 2009 $
d185 2
a186 2
by examining its argument list,
which is set to one of
@


1.41
log
@write UNIX-domain in a more consistent way; while here, replace a
few remaining ".Tn UNIX" macros with ".Ux" ones.

pointed out by ratchov@@, thanks!

ok jmc@@
@
text
@d1 1
a1 1
.\"	$OpenBSD: apmd.8,v 1.40 2009/10/22 12:35:53 sobrado Exp $
d74 1
@


1.40
log
@use the UNIX-related macros (.At and .Ux) where appropriate.

ok jmc@@
@
text
@d1 1
a1 1
.\"	$OpenBSD: apmd.8,v 1.39 2009/08/04 18:26:48 jmc Exp $
d29 1
a29 1
.Dd $Mdocdate: August 4 2009 $
d195 2
a196 2
.Ux
domain socket used for communication with
@


1.39
log
@-epm are not relevant to most (any?) setups and quiet is good anyway: remove
these options;

thanks marc for feedback on what these options were for;
ok oga deraadt
@
text
@d1 1
a1 1
.\"	$OpenBSD: apmd.8,v 1.38 2007/12/05 19:49:34 jmc Exp $
d29 1
a29 1
.Dd $Mdocdate: December 5 2007 $
d194 3
a196 1
Default UNIX-domain socket used for communication with
@


1.38
log
@make description of -A and -C more consistent;
help/ok tedu
@
text
@d1 1
a1 1
.\"	$OpenBSD: apmd.8,v 1.37 2007/12/05 16:47:09 jmc Exp $
d37 1
a37 1
.Op Fl AaCdeHLmps
d57 3
a59 1
For power status change events,
a106 5
.It Fl e
Re-enable APM driver power status messages.
.Nm
exits immediately after setting this option.
Use of this flag unconditionally enables power status messages.
a121 23
.It Fl m
Do not disable power status messages issued by the APM driver.
In normal operation these status messages are disabled as they are
the same as the information collected by this daemon and reported via
.Xr syslog 3 .
.It Fl p
Re-enable APM driver power status messages.
.Nm
exits immediately after setting this option.
Use of this flag causes power status messages to be displayed only when the
battery life expectancy changes.
This minimizes message output
for those devices that are constantly updating the estimated time
remaining based upon current processor load.
However, in no case
will power status messages be displayed until the battery life
goes below the percentage in the
.Xr sysctl 8
state variable
.Va machdep.apmwarn .
Setting
.Va machdep.apmwarn
to zero disables all warnings.
d156 4
a159 4
.Cm suspend ,
.Cm standby ,
.Cm resume ,
.Cm powerup
d161 1
a161 1
.Cm powerdown .
d182 3
a184 7
Each file must be an executable binary or shell script suitable
for execution by the
.Xr execve 2
function.
If you wish to have the same program or script control all transitions,
it may determine which transition is in progress by examining its
.Va argv[0] ,
d186 4
a189 4
.Ar suspend ,
.Ar standby ,
.Ar resume ,
.Ar powerup ,
d191 1
a191 1
.Ar powerdown .
a197 1
.Xr execve 2 ,
d201 1
a201 2
.Xr sysctl 8 ,
.Xr syslogd 8
@


1.37
log
@some minor changes in .Nd and DESCRIPTION to make this more consistent
with apm(8);
@
text
@d1 1
a1 1
.\"	$OpenBSD: apmd.8,v 1.36 2007/05/31 19:20:22 jmc Exp $
d29 1
a29 1
.Dd $Mdocdate: May 31 2007 $
d75 3
a77 3
as much as possible.
Otherwise, when the CPU idle time
is above 30% and the system is running on battery power,
d90 1
a90 2
In this mode, when CPU idle time falls below
10%,
d95 1
a95 1
Otherwise, when idle time is above 30%
d97 1
a97 1
reduces
@


1.36
log
@convert to new .Dd format;
@
text
@d1 1
a1 1
.\"	$OpenBSD: apmd.8,v 1.35 2006/05/16 21:17:21 ian Exp $
d29 1
a29 1
.Dd $Mdocdate$
d34 1
a34 1
.Nd Advanced Power Management monitor daemon
d43 3
a45 2
monitors the advanced power management (APM) pseudo-device, acting on
signaled events and upon user requests as sent by the
d48 1
@


1.35
log
@typo
@
text
@d1 1
a1 1
.\"	$OpenBSD: apmd.8,v 1.34 2006/03/15 20:30:28 sturm Exp $
d29 1
a29 1
.Dd March 24, 1996
@


1.34
log
@consistently use power *states* and performance *modes*

ok beck, mickey
@
text
@d1 1
a1 1
.\"	$OpenBSD: apmd.8,v 1.33 2006/01/19 19:17:10 sturm Exp $
d98 1
a98 1
as much as possible to reduce heat, noise, and power comsumption.
@


1.33
log
@prompted by deraadt:
manual performance mode -> low/high performance mode
show cpuspeed in apm output

ok beck, weingart
man page bits ok jmc
@
text
@d1 1
a1 1
.\"	$OpenBSD: apmd.8,v 1.32 2005/12/02 09:19:39 jmc Exp $
d51 1
a51 1
syncs the buffer cache to disk and initiates the requested mode.
d115 1
a115 1
in high performance mode, initialising
d121 1
a121 1
in low performance mode, initialising
d169 1
a169 1
When a client requests a suspend or stand-by mode,
d172 1
a172 1
mode has been entered before replying to the client; to do so would mean
d177 1
a177 1
in the requested mode after running the configuration script and
d190 1
a190 1
mode.
@


1.32
log
@remove trailing whitespace;
@
text
@d1 1
a1 1
.\"	$OpenBSD: apmd.8,v 1.31 2005/12/02 04:27:52 beck Exp $
d115 1
a115 1
in manual performance adjustment mode, initialising
d121 1
a121 1
in manual performance adjustment mode, initialising
@


1.31
log
@Modify automatic performance adjustment mode so that the cpu is set
to go fast if the power is connected and the battery is more than 15%
charged, and when on batteries keeps setperf low unless needed.
add a cool runnings mode option (-C) that does the previous behaviour
of keeping the CPU as low as possible unless needed.
ok deradt@@, sturm@@, "i like it's" djm@@ henning@@ and others.
@
text
@d1 1
a1 1
.\"	$OpenBSD: apmd.8,v 1.30 2005/11/23 08:02:58 sturm Exp $
d69 1
a69 1
or if the AC power is connected and the battery is more than 15% charged, 
d75 1
a75 1
is above 30% and the system is running on battery power, 
d77 1
a77 1
lowers 
d89 2
a90 2
10%, 
.Nm 
@


1.30
log
@permit apmd to run on systems without apm support
let apmd control hw.setperf manually or dynamically

tested by Chris Kuethe and beck@@, 'get it in' deraadt@@
@
text
@d1 1
a1 1
.\"	$OpenBSD: apmd.8,v 1.29 2005/11/15 01:19:56 jmc Exp $
d37 1
a37 1
.Op Fl AadeHLmps
d68 12
d84 15
a167 20
.Pp
In automatic performance adjustment mode,
.Nm
monitors the processor's idle time and adjusts
.Va hw.setperf
dynamically.
This keeps the processor at low speed whenever possible, reducing noise and
power consumption.
When idle time falls below 10%, the daemon raises
.Va hw.setperf
as much as necessary.
When idle time is above 30%,
.Nm
reduces
.Va hw.setperf
as much as possible.
By default
.Nm
does not change
.Va hw.setperf .
@


1.29
log
@use a standard options list;
various rearrangements concerned with this;

prompted by deraadt@@
@
text
@d1 1
a1 1
.\"	$OpenBSD: apmd.8,v 1.28 2005/06/14 15:18:53 deraadt Exp $
d37 1
a37 1
.Op Fl ademps
d64 4
d85 12
d141 20
@


1.28
log
@remove speaker handling code.  if you really want this, use the /etc/apm/*
scripts to do it. as it is, for most people this is terribly annoying and
unneccessary; toby ok
@
text
@d1 1
a1 1
.\"	$OpenBSD: apmd.8,v 1.27 2005/06/09 15:14:23 xsa Exp $
d62 4
a65 20
.Nm
periodically polls the APM driver for the current power state.
If the battery charge level changes substantially or the external power
status changes, the new status is logged.
The polling rate defaults to
once per 10 minutes, but may be specified using the
.Fl t
command-line flag.
.Pp
If the
.Fl s
flag is specified, the current battery statistics are reported via
.Xr syslog 3
and
.Nm
exits without monitoring the APM status.
.Pp
If the
.Fl a
flag is specified, any BIOS-initiated suspend or standby requests are
d68 1
a68 4
.Pp
If the
.Fl d
flag is specified,
d71 12
a82 10
.Dv LOG_LOCAL1
and staying in the foreground on the controlling terminal.
.Pp
If the
.Fl m
flag is specified,
.Nm
does not disable power status messages issued by the
.Tn APM
driver.
d84 4
a87 10
the same as the information collected by this daemon and reported via syslog.
.Pp
The
.Fl e
and
.Fl p
flags are used to re-enable
.Tn APM
driver power status messages.
In both cases
d89 2
a90 7
exits immediately after setting the desired option.
The
.Fl e
flag unconditionally enables power status messages.
The
.Fl p
flag causes power status messages to be displayed only when the
d100 1
a100 1
.Dv machdep.apmwarn .
d102 1
a102 1
.Dv machdep.apmwarn
d104 21
d154 10
a163 7
.Pa /etc/apm/suspend ,
.Pa /etc/apm/standby ,
.Pa /etc/apm/resume ,
.Pa /etc/apm/powerup
and
.Pa /etc/apm/powerdown
are the files that contain the host's customized actions.
d168 3
a170 3
If you wish to have the same program or script control all transitions, it
may determine which transition is in progress by examining its
.Va argv[0]
d175 2
a176 2
.Ar powerup
and
d179 2
a180 2
.Pa /var/run/apmdev
is the default UNIX-domain socket used for communication with
d182 1
a182 11
The
.Fl S
flag may be used to specify an alternate socket name.
The socket is protected to mode 0660, UID 0, GID 0; this protects access
to suspend requests to authorized users only.
.Pp
.Pa /dev/apmctl
is the default device used to control the APM kernel driver.
The
.Fl f
flag may be used to specify an alternate device file name.
d190 4
a193 3
.Sh REFERENCES
Advanced Power Management (APM) BIOS Interface Specification (revision
1.2), Intel Corporation and Microsoft Corporation.
d197 1
a197 1
command appeared in
@


1.27
log
@.Xr sysctl(8); ok jmc, deraadt
@
text
@d1 1
a1 1
.\"	$OpenBSD: apmd.8,v 1.26 2005/03/01 14:55:19 mickey Exp $
d37 1
a37 1
.Op Fl adempqs
a62 7
announces the transition to standby mode with a single high tone on the
speaker (using the
.Pa /dev/speaker
device).
Suspends are announced with two high tones.
.Pp
.Nm
a93 6
.Fl q
flag is specified,
.Nm
does not announce suspend and standby requests on the speaker.
.Pp
If the
a200 1
.Xr speaker 4 ,
@


1.26
log
@too fast little futterbly; cvs said it was before 1.2
@
text
@d1 1
a1 1
.\"	$OpenBSD: apmd.8,v 1.25 2005/03/01 13:22:43 miod Exp $
d216 1
@


1.25
log
@apm and apmd appeared for 2.0 not 1.2; spotted by marc@@
@
text
@d1 1
a1 1
.\"	$OpenBSD: apmd.8,v 1.24 2003/05/11 05:26:10 pjanzen Exp $
d227 1
a227 1
.Ox 2.0 .
@


1.24
log
@comma splice.
@
text
@d1 1
a1 1
.\"	$OpenBSD: apmd.8,v 1.23 2002/06/14 04:21:41 deraadt Exp $
d227 1
a227 1
.Ox 1.2 .
@


1.23
log
@this group operator stuff is completely wrong
@
text
@d1 1
a1 1
.\"	$OpenBSD: apmd.8,v 1.21 2001/07/18 16:03:06 mickey Exp $
d224 1
a224 1
.Nx 1.3 ,
@


1.22
log
@Since now /var/run/apmdev socket will be root:operator.
Idea from form@@.

millert@@ ok
@
text
@d202 1
a202 1
The socket is protected to mode 0660, UID 0, GID 5; this protects access
@


1.21
log
@reference 1.2 specs
@
text
@d1 1
a1 1
.\"	$OpenBSD: apmd.8,v 1.20 2001/07/07 01:10:41 mickey Exp $
d202 1
a202 1
The socket is protected to mode 0660, UID 0, GID 0; this protects access
@


1.20
log
@cleanup and knf, some are from Kevin Steves <stevesk@@pobox.com>
@
text
@d1 1
a1 1
.\"	$OpenBSD: apmd.8,v 1.19 2001/07/05 22:06:00 mickey Exp $
d219 1
a219 1
1.1), Intel Corporation and Microsoft Corporation.
@


1.19
log
@order the options
@
text
@d1 1
a1 1
.\"	$OpenBSD: apmd.8,v 1.18 2001/07/04 07:10:51 mickey Exp $
d128 1
a128 1
unconditionally enables power status messages.
d131 1
a131 1
causes power status messages to be displayed only when the
d133 1
a133 1
This minimized message output
d157 1
a157 1
Actions can be configured for the three transitions:
@


1.18
log
@no you are wrong aain, get the hell off the this crusade!
@
text
@d1 1
a1 1
.\"	$OpenBSD: apmd.8,v 1.17 2001/07/04 06:03:10 jasoni Exp $
d37 3
a39 1
.Op Fl dsaqepm
a40 2
.Op Fl S Ar sockname
.Op Fl f Ar devname
d126 1
d129 1
@


1.17
log
@fix history
@
text
@d1 1
a1 1
.\"	$OpenBSD: apmd.8,v 1.16 2001/03/23 01:00:41 mickey Exp $
d225 1
a225 1
.Ox 2.0 .
@


1.16
log
@ac on/off hooks; from angelos@@
@
text
@d1 1
a1 1
.\"	$OpenBSD$
d222 4
a225 1
.Ox 1.2 .
@


1.15
log
@backing out undiscussed changes outside your area
@
text
@d1 2
a28 2
.\"	$Id: apmd.8,v 1.11 2000/03/19 17:57:01 aaron Exp $
.\"
d157 3
a159 1
.Cm standby
d161 1
a161 1
.Cm resume .
d168 3
d173 3
a175 1
.Pa /etc/apm/standby
d177 1
a177 1
.Pa /etc/apm/resume
d189 4
a192 2
or
.Ar resume .
@


1.14
log
@Power status change after resume only if it really changed.
@
text
@d27 1
a27 1
.\"	$Id: apmd.8,v 1.13 2001/03/22 04:51:13 angelos Exp $
d157 1
a157 3
.Cm standby ,
.Cm resume ,
.Cm powerup
d159 1
a159 1
.Cm powerdown .
a165 3
The powerup and powerdown programs are run after the power status (AC
connected or not) changes, as well as after a resume (if the power
status changed in the mean time).
d168 1
a168 3
.Pa /etc/apm/standby ,
.Pa /etc/apm/resume ,
.Pa /etc/apm/powerup
d170 1
a170 1
.Pa /etc/apm/powerdown
d182 2
a183 4
.Ar resume ,
.Ar powerup
and
.Ar powerdown .
@


1.13
log
@Document.
@
text
@d27 1
a27 1
.\"	$Id: apmd.8,v 1.12 2001/03/22 01:14:06 angelos Exp $
d169 2
a170 1
connected or not) changes, as well as after a resume.
@


1.12
log
@Introduce powerup/powerdown actions, when power status changes (AC
connected/disconnected).
@
text
@d27 1
a27 1
.\"	$Id: apmd.8,v 1.11 2000/03/19 17:57:01 aaron Exp $
d169 1
a169 1
connected or not) changes.
d172 3
a174 1
.Pa /etc/apm/standby
d176 1
a176 1
.Pa /etc/apm/resume
d188 4
a191 2
or
.Ar resume .
@


1.11
log
@Remove hard sentence breaks. Add $OpenBSD$ tags where appropriate. Some other
cleanup along the way.
@
text
@d27 1
a27 1
.\"	$Id: apmd.8,v 1.10 1999/06/05 22:16:28 aaron Exp $
d157 3
a159 1
.Cm standby
d161 1
a161 1
.Cm resume .
d168 2
@


1.10
log
@remove trailing whitespace, some Nm cleanup
@
text
@d27 1
a27 1
.\"	$Id: apmd.8,v 1.9 1999/05/23 14:11:32 aaron Exp $
d72 2
a73 1
status changes, the new status is logged.  The polling rate defaults to
d112 2
a113 1
driver.  In normal operation these status messages are disabled as they are
d122 2
a123 1
driver power status messages.  In both cases
d130 2
a131 1
battery life expectancy changes.  This minimized message output
d133 2
a134 1
remaining based upon current processor load.  However, in no case
d163 2
a164 1
mode.  The resume program is run after resuming from a stand-by or
@


1.9
log
@remove argument from .Os macros so value in /usr/share/tmac/mdoc/doc-common
is used instead; kwesterback@@home.com
@
text
@d27 1
a27 1
.\"	$Id: apmd.8,v 1.8 1999/02/23 04:17:34 marc Exp $
d45 1
a45 1
.Xr apm 8 
d58 1
a58 1
.Xr syslog 3 
d70 1
a70 1
periodically polls the APM driver for the current power state.  
d168 1
a168 1
.Xr execve 2 
d171 1
a171 1
may determine which transition is in progress by examining its 
@


1.8
log
@document power status messages supressed until the
battery life falls below machdep.apmwarn
@
text
@d27 1
a27 1
.\"	$Id: apmd.8,v 1.7 1998/12/15 01:20:47 aaron Exp $
d31 1
a31 1
.Os OpenBSD
@


1.7
log
@always give .Nm macros an argument in SYNOPSIS sections; krw@@tcn.net
@
text
@d27 1
a27 1
.\"	$Id: apmd.8,v 1.6 1998/11/08 00:21:26 aaron Exp $
d129 9
a137 1
remaining based upon current processor load.
@


1.6
log
@usr.sbin/ man page repairs, a-i
@
text
@d27 1
a27 1
.\"	$Id: apmd.8,v 1.5 1998/07/21 04:06:29 marc Exp $
d36 1
a36 1
.Nm
@


1.5
log
@update usage; back out time remaining display change until I'm sure it
is correct; don't long every power status change in normal operation (patch
from danw@@MIT.EDU).
@
text
@d27 1
a27 1
.\"	$Id: apmd.8,v 1.4 1998/07/18 02:42:27 marc Exp $
d191 1
a191 1
.Xr syslogd 8 .
@


1.4
log
@apmd will turn off apm driver messages when in daemon mode
added three flags.  -m to not turn off messages.  -e to turn them
back on after an apmd crash.  -p to turn on print percentage change mode.
@
text
@d27 1
a27 1
.\"	$Id: apmd.8,v 1.3 1998/03/10 04:51:05 millert Exp $
d186 2
d189 1
a190 3
.Xr execve 2 ,
.Xr speaker 4 ,
.Xr syslog 3 ,
d197 1
a197 1
.Nm apmd
@


1.3
log
@use .Ox
@
text
@d27 1
a27 1
.\"	$Id: apmd.8,v 1.2 1997/07/24 14:58:53 deraadt Exp $
d37 1
a37 4
.Op Fl d
.Op Fl s
.Op Fl a
.Op Fl q
d104 26
@


1.2
log
@Xr
@
text
@d27 1
a27 1
.\"	$Id: apmd.8,v 1.1 1996/04/29 13:08:45 hvozda Exp $
d175 2
a176 1
command appeared in OpenBSD 1.1B.
@


1.1
log
@Pull in John Kohl's most recent (15Apr96) APM and PCMCIA work
(original PCMCIA framework  by Stefan Grefen).
@
text
@d27 1
a27 1
.\"	$Id: apmd.8,v 1.7 1996/04/12 00:30:37 jtk Exp $
d165 1
a165 1
.Xr execv 2 ,
@

