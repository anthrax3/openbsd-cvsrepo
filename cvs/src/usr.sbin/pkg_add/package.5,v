head	1.26;
access;
symbols
	OPENBSD_6_2:1.26.0.4
	OPENBSD_6_2_BASE:1.26
	OPENBSD_6_1:1.25.0.4
	OPENBSD_6_1_BASE:1.25
	OPENBSD_6_0:1.24.0.6
	OPENBSD_6_0_BASE:1.24
	OPENBSD_5_9:1.24.0.2
	OPENBSD_5_9_BASE:1.24
	OPENBSD_5_8:1.23.0.4
	OPENBSD_5_8_BASE:1.23
	OPENBSD_5_7:1.22.0.2
	OPENBSD_5_7_BASE:1.22
	OPENBSD_5_6:1.21.0.4
	OPENBSD_5_6_BASE:1.21
	OPENBSD_5_5:1.20.0.4
	OPENBSD_5_5_BASE:1.20
	OPENBSD_5_4:1.12.0.8
	OPENBSD_5_4_BASE:1.12
	OPENBSD_5_3:1.12.0.6
	OPENBSD_5_3_BASE:1.12
	OPENBSD_5_2:1.12.0.4
	OPENBSD_5_2_BASE:1.12
	OPENBSD_5_1_BASE:1.12
	OPENBSD_5_1:1.12.0.2
	OPENBSD_5_0:1.9.0.8
	OPENBSD_5_0_BASE:1.9
	OPENBSD_4_9:1.9.0.6
	OPENBSD_4_9_BASE:1.9
	OPENBSD_4_8:1.9.0.4
	OPENBSD_4_8_BASE:1.9
	OPENBSD_4_7:1.9.0.2
	OPENBSD_4_7_BASE:1.9
	OPENBSD_4_6:1.8.0.4
	OPENBSD_4_6_BASE:1.8
	OPENBSD_4_5:1.7.0.2
	OPENBSD_4_5_BASE:1.7
	OPENBSD_4_4:1.6.0.6
	OPENBSD_4_4_BASE:1.6
	OPENBSD_4_3:1.6.0.4
	OPENBSD_4_3_BASE:1.6
	OPENBSD_4_2:1.6.0.2
	OPENBSD_4_2_BASE:1.6
	OPENBSD_4_1:1.4.0.4
	OPENBSD_4_1_BASE:1.4
	OPENBSD_4_0:1.4.0.2
	OPENBSD_4_0_BASE:1.4
	OPENBSD_3_9:1.3.0.2
	OPENBSD_3_9_BASE:1.3;
locks; strict;
comment	@.\" @;


1.26
date	2017.09.18.14.10.11;	author espie;	state Exp;
branches;
next	1.25;
commitid	R3dpvhdXfJQzR76i;

1.25
date	2016.10.05.14.59.19;	author espie;	state Exp;
branches;
next	1.24;
commitid	ZpyLXXGF0Ck0V7yb;

1.24
date	2015.09.10.15.16.44;	author schwarze;	state Exp;
branches;
next	1.23;
commitid	yPhLfPulVSum2r0H;

1.23
date	2015.04.16.20.01.39;	author jmc;	state Exp;
branches;
next	1.22;
commitid	rk9qSv3XblYlOSej;

1.22
date	2014.08.10.11.26.07;	author jasper;	state Exp;
branches;
next	1.21;
commitid	nIN7TYlONf8aYfkV;

1.21
date	2014.07.23.14.43.44;	author espie;	state Exp;
branches;
next	1.20;
commitid	VIkVdcqs6Jx4JMpU;

1.20
date	2014.02.11.08.04.18;	author espie;	state Exp;
branches;
next	1.19;

1.19
date	2014.01.18.22.28.18;	author halex;	state Exp;
branches;
next	1.18;

1.18
date	2014.01.17.11.09.36;	author espie;	state Exp;
branches;
next	1.17;

1.17
date	2014.01.05.10.29.16;	author espie;	state Exp;
branches;
next	1.16;

1.16
date	2014.01.04.00.14.08;	author espie;	state Exp;
branches;
next	1.15;

1.15
date	2014.01.03.15.23.16;	author jmc;	state Exp;
branches;
next	1.14;

1.14
date	2014.01.03.13.10.04;	author espie;	state Exp;
branches;
next	1.13;

1.13
date	2014.01.03.12.54.59;	author espie;	state Exp;
branches;
next	1.12;

1.12
date	2011.09.29.17.57.09;	author jmc;	state Exp;
branches;
next	1.11;

1.11
date	2011.08.26.13.00.41;	author jmc;	state Exp;
branches;
next	1.10;

1.10
date	2011.08.26.08.46.09;	author espie;	state Exp;
branches;
next	1.9;

1.9
date	2010.01.11.10.16.20;	author jmc;	state Exp;
branches;
next	1.8;

1.8
date	2009.04.14.17.53.58;	author espie;	state Exp;
branches;
next	1.7;

1.7
date	2008.12.14.10.56.51;	author jmc;	state Exp;
branches;
next	1.6;

1.6
date	2007.05.31.19.20.26;	author jmc;	state Exp;
branches;
next	1.5;

1.5
date	2007.04.15.10.17.29;	author espie;	state Exp;
branches;
next	1.4;

1.4
date	2006.08.30.10.22.35;	author jmc;	state Exp;
branches;
next	1.3;

1.3
date	2006.01.13.11.50.31;	author espie;	state Exp;
branches;
next	1.2;

1.2
date	2005.09.19.09.58.33;	author bernd;	state Exp;
branches;
next	1.1;

1.1
date	2005.09.18.00.54.29;	author espie;	state Exp;
branches;
next	;


desc
@@


1.26
log
@document @@version
@
text
@.\"	$OpenBSD: package.5,v 1.25 2016/10/05 14:59:19 espie Exp $
.\" Copyright (c) 2005-2006 Marc Espie <espie@@openbsd.org>
.\"
.\" Permission to use, copy, modify, and distribute this software for any
.\" purpose with or without fee is hereby granted, provided that the above
.\" copyright notice and this permission notice appear in all copies.
.\"
.\" THE SOFTWARE IS PROVIDED "AS IS" AND THE AUTHOR DISCLAIMS ALL WARRANTIES
.\" WITH REGARD TO THIS SOFTWARE INCLUDING ALL IMPLIED WARRANTIES OF
.\" MERCHANTABILITY AND FITNESS. IN NO EVENT SHALL THE AUTHOR BE LIABLE FOR
.\" ANY SPECIAL, DIRECT, INDIRECT, OR CONSEQUENTIAL DAMAGES OR ANY DAMAGES
.\" WHATSOEVER RESULTING FROM LOSS OF USE, DATA OR PROFITS, WHETHER IN AN
.\" ACTION OF CONTRACT, NEGLIGENCE OR OTHER TORTIOUS ACTION, ARISING OUT OF
.\" OR IN CONNECTION WITH THE USE OR PERFORMANCE OF THIS SOFTWARE.
.Dd $Mdocdate: October 5 2016 $
.Dt PACKAGE 5
.Os
.Sh NAME
.Nm package
.Nd format for OpenBSD binary packages
.Sh DESCRIPTION
Binary packages for
.Ox
can be created using
.Xr pkg_create 1
and are usually manipulated using
.Xr pkg_add 1 ,
.Xr pkg_mklocatedb 1 ,
or
.Xr pkg_info 1 .
.Pp
The basic underlying format is an archive following the ustar specification
that can be handled with
.Xr tar 1
and compressed using
.Xr gzip 1 .
.Pp
Package names always end in
.Dq .tgz ;
the file name itself should conform to
.Xr packages-specs 7 .
.Pp
Note that the base distribution tarballs of
.Ox
(e.g.\&
.Pa baseXX.tgz ,
.Pa compXX.tgz ,
\&...) are not binary packages fit for
.Xr pkg_add 1 .
.Pp
All types of archive contents can be present in a package,
including files, directories, hardlinks, symlinks, fifos, block and character
devices.
.Pp
In order to allow just-in-time extraction,
packages always begin with a table of contents, named
.Pa +CONTENTS .
This table of contents can be read using the API described in
.Xr OpenBSD::PackingList 3p .
.Pp
All the remaining information in the archive should be referenced in
the packing-list, including all relevant information: symlinks destinations,
special permissions, and file owners
.Po
.Xr pkg_create 1
and
.Xr pkg_add 1
actually enforce this
.Pc .
See
.Xr pkg_create 1
for annotation details.
.Pp
This table of contents is always followed by a few special files, some of
which are optional: the package description (+DESC),
a display message (+DISPLAY), etc.
.Pp
The basic ustar format has some limitations with respect to file names.
Packages now use the
.Qq extended record specification
(header type x)
for long links and long file names.
Other extended ustar headers are currently recognized, but not supported.
.Pp
Starting with
.Ox 5.5 ,
the compressed archive may be composed of several
.Xr gzip 1
archives concatenated together.
.Xr gzip 1
doesn't mind, and
.Xr tar 1
is happy as long as the uncompressed stream is sane.
This allows for faster signing and better rsync properties.
.Pp
Starting with
.Ox 5.6 ,
tarballs are stored
.Qq out-of-order :
each archive entry will match an entry in the packing-list (and all file-like
entries will be matched), but the order will be adjusted so that most recently
changed files come first, in order to allow faster updates.
.Sh PACKING LIST ANNOTATIONS
User annotations are described in
.Xr pkg_create 1 .
The following annotations are automatically inserted during package creation
and installations:
.Pp
.Bl -tag -width Ds -compact
.It Cm @@arch Ar arches
List of architectures for which this package is intended.
This corresponds to
.Fl A Ar arches
of
.Xr pkg_create 1
.Pp
.It Cm @@comment pkgpath=path cdrom=yes/no ftp=yes/no
Historical accident.
This specific comment encodes the actual
.Fl D Ar FULLPKGPATH ,
.Fl D Ar CDROM ,
and
.Fl D Ar FTP
arguments to
.Xr pkg_create 1 .
.Pp
.It Xo
.Cm @@depend
.Sm off
.Ar pkgpath :
.Ar pkgspec :
.Ar default
.Sm on
.Xc
Record a dependency declared using the option
.Fl P
of
.Xr pkg_create 1 .
.Pp
.It Xo
.Cm @@digital-signature
.Sm off
.Ar style :
.Ar date :
.Ar details
.Sm on
.Xc
Record a digital signature of the packing-list, synthetized by
.Xr pkg_add 1
from
.Xr signify 1
output.
.Pp
.It Cm @@link Ar name
Added after a file entry by
.Nm
to record that the entry is actually a hard link.
.Pp
.It Cm @@localbase Ar base
Used internally to record the settings of
.Fl L
option.
.Pp
.It Cm @@name Ar pkgname
Set the name of the package.
This name is potentially different than the name of
the file it came in, and is used when keeping track of the package
for later deinstallation.
.Xr pkg_create 1
will derive this field from the package file name.
.Pp
.It Cm @@option Ar name
Some options are automatically inserted by the package tools:
.Bl -tag -width indent
.It Ar firmware
Set by
.Xr fw_update 1
to trigger firmware-specific handling.
In particular, firmware is hidden from normal updates.
.It Ar manual-installation
Record that a package has been explicitly installed by the user,
and not as a result of a dependency look-up.
Refer to
.Xr pkg_add 1 Ns 's
.Fl a
option for details.
.El
.Pp
.It Cm @@sha
Added after a file entry by
.Xr pkg_create 1
to record the files's cryptographic checksum,
as a sha256 digest encoded in base64.
.Pp
.It Cm @@signer
Internal annotation necessary to identify packages signed with
.Xr signify 1
keys, as those keys don't carry any identity.
.Pp
.It Cm @@size
Added after a file entry by
.Xr pkg_create 1
to record a file size.
.Pp
.It Cm @@symlink Ar name
Added after a file entry by
.Xr pkg_create 1
to record that the entry is actually a symbolic link.
.Pp
.It Cm @@url
Original location of the package, automatically recorded in installed packages
by
.Xr pkg_add 1 .
.Pp
.It Cm @@ts Ar timestamp
Added after a file entry to record the actual file timestamp.
The package tools read and process that annotation correctly.
Starting with
.Ox 5.7 ,
.Xr pkg_create 1
will migrate timestamps from the tarball meta-info to the packing-list
to better create unchanging archive chunks.
.Pp
.It Cm @@version Ar number
Record a global (system) version number for the package.
This is built adding together
.Fl V
options from
.Xr pkg_create 1 ,
and triggers updates when it changes.
.Pp
.It Cm @@wantlib Ar libspec
Record a library requirement declared using the option
.Fl W
of
.Xr pkg_create 1 .
.El
.Sh PACKAGE SIGNATURES
All information within a package is checksummed, using SHA256 since
.Ox 4.4 .
During creation and installation, meta-information, such as file owners and
permissions, are also checked: any important stuff that isn't recorded
in the packing-list is an error.
.Pp
Packing-lists can be signed.
If a signature is found, then it will be checked
during installation, and failure to verify will prevent the package from
installing correctly.
.Pp
Starting with
.Ox 6.1 ,
.Xr signify 1
.Fl zS
.Xr gzip 1
header signatures are the only supported format.
This allows for
.Sq just-in-time
signature checking, as the binary data is checked in 64K bytes long chunks.
.Pp
Fat packages were removed in
.Ox 5.1 ,
since no practical application was found.
.Sh SEE ALSO
.Xr pkg_add 1 ,
.Xr pkg_create 1 ,
.Xr pkg_info 1 ,
.Xr pkg_sign 1 ,
.Xr packages 7 ,
.Xr packages-specs 7
.Sh STANDARDS
Packages are valid gzip'ed ustar archives that can be extracted using
.Xr tar 1 .
In particular, hardlink names should be valid, and all items will
extract to different names.
However, it may be a bit difficult to make sense of the package contents
without peeking at the packing-list.
@


1.25
log
@document signature change
@
text
@d1 1
a1 1
.\"	$OpenBSD: package.5,v 1.24 2015/09/10 15:16:44 schwarze Exp $
d15 1
a15 1
.Dd $Mdocdate: September 10 2015 $
d223 8
@


1.24
log
@reduce .Nd to one line and kill .Tn while here
@
text
@d1 1
a1 1
.\"	$OpenBSD: package.5,v 1.23 2015/04/16 20:01:39 jmc Exp $
d15 1
a15 1
.Dd $Mdocdate: April 16 2015 $
d145 1
a145 1
.Ar b64sig
d148 5
a152 5
Record a digital signature of the packing-list, corresponding
to
.Xr pkg_create 1 Ns 's
.Fl s
option.
d241 3
a243 1
Currently,
d245 4
a248 6
and X.509-style signatures are supported.
X.509 signatures rely on a certificate authority file being present as
.Pa /etc/ssl/pkgca.pem
and all signatures will be checked against it.
Once the packing-list signature is checked, all individual packing elements
will be checksummed, resulting in a
d250 1
a250 1
signature checking.
@


1.23
log
@firmware, not firmwares;
@
text
@d1 1
a1 1
.\"	$OpenBSD: package.5,v 1.22 2014/08/10 11:26:07 jasper Exp $
d15 1
a15 1
.Dd $Mdocdate: August 10 2014 $
d20 1
a20 3
.Nd format for
.Ox
binary packages
@


1.22
log
@zap trailing whitespace
@
text
@d1 1
a1 1
.\"	$OpenBSD: package.5,v 1.21 2014/07/23 14:43:44 espie Exp $
d15 1
a15 1
.Dd $Mdocdate: July 23 2014 $
d181 1
a181 1
In particular, firmwares are hidden from normal updates.
@


1.21
log
@document format changes, including the new @@ts annotation that pkg_create
will generate after 5.6.
@
text
@d1 1
a1 1
.\"	$OpenBSD: package.5,v 1.20 2014/02/11 08:04:18 espie Exp $
d15 1
a15 1
.Dd $Mdocdate: February 11 2014 $
d81 1
a81 1
Packages now use the 
@


1.20
log
@document that metainfo in plist is enforced.
explain about ustar extended headers status.
Xr pkg_sign
@
text
@d1 1
a1 1
.\"	$OpenBSD: package.5,v 1.19 2014/01/18 22:28:18 halex Exp $
d15 1
a15 1
.Dd $Mdocdate: January 18 2014 $
d81 24
a104 7
Accordingly, the package tools will replace very long names with
.Pa LongName#n
and long link names with
.Pa LongLink#n .
The packing-list will hold the real file names, and the package tools
will reconstitute the correct names behind the scenes.
Extended ustar headers are currently recognized, but not supported.
d197 5
d217 8
a224 4
.It Cm @@signer
Internal annotation necessary to identify packages signed with
.Xr signify 1
keys, as those keys don't carry any identity.
@


1.19
log
@use the standard notation of <set>XX.tgz for the install sets

from frantisek holop, thanks!

"Go ahead" espie@@
@
text
@d1 1
a1 1
.\"	$OpenBSD: package.5,v 1.18 2014/01/17 11:09:36 espie Exp $
d15 1
a15 1
.Dd $Mdocdate: January 17 2014 $
d65 7
a71 1
special permissions, and file owners.
d80 1
a80 1
The ustar format has some limitations with respect to file names.
d87 1
d235 1
@


1.18
log
@tweak documentation to match what's going on
@
text
@d1 1
a1 1
.\"	$OpenBSD: package.5,v 1.17 2014/01/05 10:29:16 espie Exp $
d15 1
a15 1
.Dd $Mdocdate: January 5 2014 $
d48 2
a49 2
.Pa baseXXX.tgz ,
.Pa compXXX.tgz ,
@


1.17
log
@document -DFW_UPDATE/@@option firmware
@
text
@d1 1
a1 1
.\"	$OpenBSD: package.5,v 1.16 2014/01/04 00:14:08 espie Exp $
d15 1
a15 1
.Dd $Mdocdate: January 4 2014 $
d189 3
a191 4
Internal annotation corresponding to
.Xr pkg_create 1 Ns 's
.Fl D Ar SIGNER
option.
@


1.16
log
@vendor->signer
shorten pubkey -> pub (naddy@@)
\\ -> \e (jmc@@)
@
text
@d1 1
a1 1
.\"	$OpenBSD: package.5,v 1.15 2014/01/03 15:23:16 jmc Exp $
d15 1
a15 1
.Dd $Mdocdate: January 3 2014 $
d153 5
@


1.15
log
@remove trailing whitespace and unneccessary macros from previous;
@
text
@d1 1
a1 1
.\"	$OpenBSD: package.5,v 1.14 2014/01/03 13:10:04 espie Exp $
d183 1
a183 1
.It Cm @@vendor
d186 1
a186 1
.Fl D Ar VENDOR
@


1.14
log
@finish moving annotations around
@
text
@d1 1
a1 1
.\"	$OpenBSD: package.5,v 1.13 2014/01/03 12:54:59 espie Exp $
d101 1
a101 1
.Fl D Ar FTP 
d206 1
a206 1
Currently, 
@


1.13
log
@start moving internal annotations' description into package(5) proper,
pkg_create(1) should only document what users can use.
Accordingly, describe dependencies in terms of -P and -W directly.
@
text
@d1 1
a1 1
.\"	$OpenBSD: package.5,v 1.12 2011/09/29 17:57:09 jmc Exp $
d15 1
a15 1
.Dd $Mdocdate: September 29 2011 $
d94 1
d118 70
@


1.12
log
@ssl.8: Certifying Authority -> Certificate Authority
isakmpd.8: rsa:1024 -> rsa:2048 (ok markus)
all: X509 -> X.509

from Lawrence Teo
@
text
@d1 1
a1 1
.\"	$OpenBSD: package.5,v 1.11 2011/08/26 13:00:41 jmc Exp $
d15 1
a15 1
.Dd $Mdocdate: August 26 2011 $
d81 43
d135 4
a138 2
Currently, only X.509-style signatures are supported.
They rely on a certificate authority file being present as
@


1.11
log
@remove one more reference to pkg_merge; ok espie
@
text
@d1 1
a1 1
.\"	$OpenBSD: package.5,v 1.10 2011/08/26 08:46:09 espie Exp $
d92 1
a92 1
Currently, only x509-style signatures are supported.
@


1.10
log
@zap fatpackages. nobody actually uses them.
accordingly, locations do not need to track architecture.
@
text
@d1 1
a1 1
.\"	$OpenBSD: package.5,v 1.9 2010/01/11 10:16:20 jmc Exp $
d15 1
a15 1
.Dd $Mdocdate: January 11 2010 $
a27 2
and
.Xr pkg_merge 1 ,
@


1.9
log
@various cleanup, including a fix from Daniel Dickman;
ok espie
@
text
@d1 1
a1 1
.\"	$OpenBSD: package.5,v 1.8 2009/04/14 17:53:58 espie Exp $
d15 1
a15 1
.Dd $Mdocdate: April 14 2009 $
a31 1
.Xr pkg_merge 1 ,
a58 3
A special extension to the format, dubbed fat packages, is described in
the next section.
.Pp
d73 2
a74 2
which are optional: the package description (+DESC), an installation script
(+INSTALL), a display message (+DISPLAY), etc.
a101 9
.Sh FAT PACKAGES DESCRIPTION
The
.Xr pkg_merge 1
command can create fat packages, which coalesce several normal packages in
a single ustar archive, by interleaving their contents.
.Pp
Other tools, such as
.Xr pkg_add 1 ,
are aware of fat packages and can handle them transparently.
d103 3
a105 15
In a fat package, every item has a small prefix that identifies the
original package.
For instance, after merging two packages, the package will usually
begin with
.Pa a/+CONTENTS
and
.Pa b/+CONTENTS .
Individual items will then begin with
.Pa ab/file ,
for a file common to both packages;
.Pa a/file
for a file belonging to the first package;
and
.Pa b/file
for a file belonging to the second package.
a109 1
.Xr pkg_merge 1 ,
@


1.8
log
@initial implementation of package signatures, based on x509 certificates and
smime detached signatures.
@
text
@d1 1
a1 1
.\"	$OpenBSD$
d15 1
a15 1
.Dd $Mdocdate$
d90 2
a91 2
During creation and creation, meta-information, such as file owners and
permissions, are also checked: any important stuff that isn't recorded 
d94 2
a95 1
Packing-lists can be signed. If a signature is found, then it will be checked
d98 1
a98 1
Currently, only x509-style signatures are supported. 
@


1.7
log
@display message is +DISPLAY; from Ingo Schwarze
ok espie
@
text
@d1 1
a1 1
.\"	$OpenBSD: package.5,v 1.6 2007/05/31 19:20:26 jmc Exp $
d15 1
a15 1
.Dd $Mdocdate: May 31 2007 $
d87 18
@


1.6
log
@convert to new .Dd format;
@
text
@d1 1
a1 1
.\"	$OpenBSD: package.5,v 1.5 2007/04/15 10:17:29 espie Exp $
d15 1
a15 1
.Dd $Mdocdate$
d78 1
a78 1
(+INSTALL), a display message (+MESSAGE), etc.
@


1.5
log
@update copyright years, standardize licence.
reword the introduction to the stuff originally from FreeBSD to clarify
slightly.
@
text
@d1 1
a1 1
.\"	$OpenBSD: package.5,v 1.4 2006/08/30 10:22:35 jmc Exp $
d15 1
a15 1
.Dd September 17, 2005
@


1.4
log
@U[Ss]tar -> ustar, as per posix and our pax docs;
from ross l richardson (pr #5216)
@
text
@d1 2
a2 1
.\"	$OpenBSD: package.5,v 1.3 2006/01/13 11:50:31 espie Exp $
d4 11
a14 8
.\" Redistribution and use in source and binary forms, with or without
.\" modification, are permitted provided that the following conditions
.\" are met:
.\" 1. Redistributions of source code must retain the above copyright
.\"    notice, this list of conditions and the following disclaimer.
.\" 2. Redistributions in binary form must reproduce the above copyright
.\"    notice, this list of conditions and the following disclaimer in the
.\"    documentation and/or other materials provided with the distribution.
@


1.3
log
@nit
@
text
@d1 1
a1 1
.\"	$OpenBSD: package.5,v 1.2 2005/09/19 09:58:33 bernd Exp $
d33 1
a33 1
The basic underlying format is an archive following the UStar specification
d76 1
a76 1
The Ustar format has some limitations with respect to file names.
d87 1
a87 1
a single Ustar archive, by interleaving their contents.
d116 1
a116 1
Packages are valid gzip'ed Ustar archives that can be extracted using
@


1.2
log
@OpenBSD::PackingList is in section 3p.

ok espie@@
@
text
@d1 1
a1 1
.\"	$OpenBSD: package.5,v 1.1 2005/09/18 00:54:29 espie Exp $
d40 1
a40 1
.Dq tgz ;
@


1.1
log
@document the package(5) format.
Some tweaks by jmc@@
@
text
@d1 1
a1 1
.\"	$OpenBSD$
d63 1
a63 1
.Xr OpenBSD::PackingList 7 .
@

