head	1.145;
access;
symbols
	OPENBSD_6_0:1.138.0.4
	OPENBSD_6_0_BASE:1.138
	OPENBSD_5_9:1.134.0.2
	OPENBSD_5_9_BASE:1.134
	OPENBSD_5_8:1.132.0.4
	OPENBSD_5_8_BASE:1.132
	OPENBSD_5_7:1.129.0.2
	OPENBSD_5_7_BASE:1.129
	OPENBSD_5_6:1.127.0.4
	OPENBSD_5_6_BASE:1.127
	OPENBSD_5_5:1.125.0.4
	OPENBSD_5_5_BASE:1.125
	OPENBSD_5_4:1.116.0.2
	OPENBSD_5_4_BASE:1.116
	OPENBSD_5_3:1.115.0.2
	OPENBSD_5_3_BASE:1.115
	OPENBSD_5_2:1.114.0.2
	OPENBSD_5_2_BASE:1.114
	OPENBSD_5_1_BASE:1.111
	OPENBSD_5_1:1.111.0.2
	OPENBSD_5_0:1.109.0.2
	OPENBSD_5_0_BASE:1.109
	OPENBSD_4_9:1.104.0.2
	OPENBSD_4_9_BASE:1.104
	OPENBSD_4_8:1.102.0.2
	OPENBSD_4_8_BASE:1.102
	OPENBSD_4_7:1.97.0.2
	OPENBSD_4_7_BASE:1.97
	OPENBSD_4_6:1.78.0.4
	OPENBSD_4_6_BASE:1.78
	OPENBSD_4_5:1.75.0.2
	OPENBSD_4_5_BASE:1.75
	OPENBSD_4_4:1.74.0.2
	OPENBSD_4_4_BASE:1.74
	OPENBSD_4_3:1.69.0.2
	OPENBSD_4_3_BASE:1.69
	OPENBSD_4_2:1.67.0.2
	OPENBSD_4_2_BASE:1.67
	OPENBSD_4_1:1.61.0.2
	OPENBSD_4_1_BASE:1.61
	OPENBSD_4_0:1.60.0.2
	OPENBSD_4_0_BASE:1.60
	OPENBSD_3_9:1.56.0.2
	OPENBSD_3_9_BASE:1.56
	OPENBSD_3_8:1.46.0.2
	OPENBSD_3_8_BASE:1.46
	OPENBSD_3_7:1.33.0.2
	OPENBSD_3_7_BASE:1.33
	OPENBSD_3_6:1.14.0.2
	OPENBSD_3_6_BASE:1.14
	OPENBSD_3_5:1.13.0.2
	OPENBSD_3_5_BASE:1.13;
locks; strict;
comment	@.\" @;


1.145
date	2017.03.25.19.53.33;	author espie;	state Exp;
branches;
next	1.144;
commitid	lfyDuvCWHPEgUFSe;

1.144
date	2017.03.11.17.34.40;	author schwarze;	state Exp;
branches;
next	1.143;
commitid	rsrHbIY9F91ib24Q;

1.143
date	2017.03.11.11.42.10;	author espie;	state Exp;
branches;
next	1.142;
commitid	pJVQfhlR0hZwj9Do;

1.142
date	2017.02.27.21.53.11;	author rpe;	state Exp;
branches;
next	1.141;
commitid	7XQfqtkSXX43wr6R;

1.141
date	2017.02.15.13.19.08;	author jmc;	state Exp;
branches;
next	1.140;
commitid	j8UnunCP9XczEY7i;

1.140
date	2017.01.01.01.08.11;	author tb;	state Exp;
branches;
next	1.139;
commitid	wnNuSAo7K6MoaRxC;

1.139
date	2016.10.03.14.24.18;	author espie;	state Exp;
branches;
next	1.138;
commitid	DLdmreRiY6cWqQky;

1.138
date	2016.06.14.17.06.23;	author espie;	state Exp;
branches;
next	1.137;
commitid	sGRDEjdpccmGHs95;

1.137
date	2016.06.14.15.41.31;	author espie;	state Exp;
branches;
next	1.136;
commitid	XOkjG8dyAbBzo5Y6;

1.136
date	2016.06.14.13.02.35;	author espie;	state Exp;
branches;
next	1.135;
commitid	2E4oqKZqO8YBiLTG;

1.135
date	2016.05.14.03.41.48;	author tj;	state Exp;
branches;
next	1.134;
commitid	oXPyWTPox1NvwF2M;

1.134
date	2015.11.04.16.59.58;	author mmcc;	state Exp;
branches;
next	1.133;
commitid	9FF7bBCnZAnG4C0j;

1.133
date	2015.10.07.17.52.38;	author jmc;	state Exp;
branches;
next	1.132;
commitid	wtnyUwU0yuhbcppY;

1.132
date	2015.04.16.20.01.39;	author jmc;	state Exp;
branches;
next	1.131;
commitid	rk9qSv3XblYlOSej;

1.131
date	2015.04.16.14.11.29;	author espie;	state Exp;
branches;
next	1.130;
commitid	KXAbpG1wu2FJFmIx;

1.130
date	2015.04.16.13.40.56;	author espie;	state Exp;
branches;
next	1.129;
commitid	fjqJAepdZu2COb36;

1.129
date	2014.11.17.23.03.37;	author sthen;	state Exp;
branches;
next	1.128;
commitid	jss1rgehcB7J4dFH;

1.128
date	2014.09.08.01.27.55;	author schwarze;	state Exp;
branches;
next	1.127;
commitid	cPoapLAXYNe1fcgV;

1.127
date	2014.07.12.20.41.09;	author jmc;	state Exp;
branches;
next	1.126;
commitid	24A6bkrGQ2JGbZAd;

1.126
date	2014.07.12.19.53.43;	author espie;	state Exp;
branches;
next	1.125;
commitid	Itx0UrSqWG4hLHWE;

1.125
date	2014.02.14.14.13.19;	author espie;	state Exp;
branches;
next	1.124;

1.124
date	2014.02.11.10.36.13;	author espie;	state Exp;
branches;
next	1.123;

1.123
date	2014.02.08.08.54.26;	author espie;	state Exp;
branches;
next	1.122;

1.122
date	2014.01.22.01.29.33;	author juanfra;	state Exp;
branches;
next	1.121;

1.121
date	2014.01.17.11.09.36;	author espie;	state Exp;
branches;
next	1.120;

1.120
date	2014.01.11.18.34.20;	author espie;	state Exp;
branches;
next	1.119;

1.119
date	2014.01.11.13.50.56;	author sthen;	state Exp;
branches;
next	1.118;

1.118
date	2014.01.09.10.51.51;	author espie;	state Exp;
branches;
next	1.117;

1.117
date	2014.01.05.10.29.16;	author espie;	state Exp;
branches;
next	1.116;

1.116
date	2013.04.30.18.33.30;	author espie;	state Exp;
branches;
next	1.115;

1.115
date	2013.02.04.12.07.14;	author espie;	state Exp;
branches;
next	1.114;

1.114
date	2012.07.06.12.11.51;	author espie;	state Exp;
branches;
next	1.113;

1.113
date	2012.07.06.12.02.50;	author espie;	state Exp;
branches;
next	1.112;

1.112
date	2012.06.08.15.15.58;	author espie;	state Exp;
branches;
next	1.111;

1.111
date	2011.08.23.10.32.26;	author espie;	state Exp;
branches;
next	1.110;

1.110
date	2011.08.17.10.48.27;	author espie;	state Exp;
branches;
next	1.109;

1.109
date	2011.07.20.14.30.45;	author espie;	state Exp;
branches;
next	1.108;

1.108
date	2011.07.19.22.25.12;	author espie;	state Exp;
branches;
next	1.107;

1.107
date	2011.07.12.10.19.54;	author espie;	state Exp;
branches;
next	1.106;

1.106
date	2011.06.20.09.51.07;	author espie;	state Exp;
branches;
next	1.105;

1.105
date	2011.03.19.09.32.36;	author jmc;	state Exp;
branches;
next	1.104;

1.104
date	2011.02.07.00.02.50;	author schwarze;	state Exp;
branches;
next	1.103;

1.103
date	2010.10.28.22.33.43;	author espie;	state Exp;
branches;
next	1.102;

1.102
date	2010.08.01.23.03.48;	author espie;	state Exp;
branches;
next	1.101;

1.101
date	2010.06.09.10.25.17;	author espie;	state Exp;
branches;
next	1.100;

1.100
date	2010.06.05.07.11.43;	author espie;	state Exp;
branches;
next	1.99;

1.99
date	2010.05.10.14.14.08;	author jmc;	state Exp;
branches;
next	1.98;

1.98
date	2010.05.10.09.12.18;	author espie;	state Exp;
branches;
next	1.97;

1.97
date	2010.02.28.15.35.41;	author jmc;	state Exp;
branches;
next	1.96;

1.96
date	2010.01.26.15.03.39;	author espie;	state Exp;
branches;
next	1.95;

1.95
date	2010.01.11.10.16.20;	author jmc;	state Exp;
branches;
next	1.94;

1.94
date	2010.01.11.09.43.08;	author bernd;	state Exp;
branches;
next	1.93;

1.93
date	2010.01.10.22.44.00;	author espie;	state Exp;
branches;
next	1.92;

1.92
date	2010.01.10.21.27.59;	author espie;	state Exp;
branches;
next	1.91;

1.91
date	2010.01.04.00.20.05;	author espie;	state Exp;
branches;
next	1.90;

1.90
date	2010.01.01.11.49.55;	author espie;	state Exp;
branches;
next	1.89;

1.89
date	2009.12.21.11.03.00;	author espie;	state Exp;
branches;
next	1.88;

1.88
date	2009.12.06.07.53.08;	author jmc;	state Exp;
branches;
next	1.87;

1.87
date	2009.12.05.23.13.01;	author espie;	state Exp;
branches;
next	1.86;

1.86
date	2009.12.03.18.55.43;	author espie;	state Exp;
branches;
next	1.85;

1.85
date	2009.12.01.11.21.30;	author espie;	state Exp;
branches;
next	1.84;

1.84
date	2009.11.24.10.32.33;	author espie;	state Exp;
branches;
next	1.83;

1.83
date	2009.11.09.17.52.19;	author espie;	state Exp;
branches;
next	1.82;

1.82
date	2009.10.27.11.45.22;	author espie;	state Exp;
branches;
next	1.81;

1.81
date	2009.10.12.05.17.33;	author jmc;	state Exp;
branches;
next	1.80;

1.80
date	2009.10.11.22.08.27;	author espie;	state Exp;
branches;
next	1.79;

1.79
date	2009.10.11.18.45.42;	author espie;	state Exp;
branches;
next	1.78;

1.78
date	2009.05.09.13.30.09;	author jmc;	state Exp;
branches;
next	1.77;

1.77
date	2009.05.09.11.17.32;	author sthen;	state Exp;
branches;
next	1.76;

1.76
date	2009.04.14.17.53.58;	author espie;	state Exp;
branches;
next	1.75;

1.75
date	2008.10.29.12.35.10;	author espie;	state Exp;
branches;
next	1.74;

1.74
date	2008.07.04.14.55.59;	author jmc;	state Exp;
branches;
next	1.73;

1.73
date	2008.07.04.10.47.13;	author espie;	state Exp;
branches;
next	1.72;

1.72
date	2008.03.09.15.36.45;	author jmc;	state Exp;
branches;
next	1.71;

1.71
date	2008.03.08.11.48.01;	author espie;	state Exp;
branches;
next	1.70;

1.70
date	2008.03.08.11.41.42;	author espie;	state Exp;
branches;
next	1.69;

1.69
date	2008.01.26.16.38.52;	author landry;	state Exp;
branches;
next	1.68;

1.68
date	2007.11.05.13.09.13;	author jmc;	state Exp;
branches;
next	1.67;

1.67
date	2007.06.20.15.41.36;	author steven;	state Exp;
branches;
next	1.66;

1.66
date	2007.06.17.10.35.55;	author espie;	state Exp;
branches;
next	1.65;

1.65
date	2007.05.31.19.20.26;	author jmc;	state Exp;
branches;
next	1.64;

1.64
date	2007.05.31.11.05.41;	author espie;	state Exp;
branches;
next	1.63;

1.63
date	2007.05.07.08.14.51;	author espie;	state Exp;
branches;
next	1.62;

1.62
date	2007.04.15.10.17.29;	author espie;	state Exp;
branches;
next	1.61;

1.61
date	2006.10.17.21.47.22;	author espie;	state Exp;
branches;
next	1.60;

1.60
date	2006.03.07.11.03.17;	author espie;	state Exp;
branches;
next	1.59;

1.59
date	2006.03.05.09.02.36;	author jmc;	state Exp;
branches;
next	1.58;

1.58
date	2006.03.04.13.00.43;	author espie;	state Exp;
branches;
next	1.57;

1.57
date	2006.03.04.11.56.57;	author espie;	state Exp;
branches;
next	1.56;

1.56
date	2006.01.06.13.00.07;	author jmc;	state Exp;
branches;
next	1.55;

1.55
date	2005.11.05.10.27.33;	author sturm;	state Exp;
branches;
next	1.54;

1.54
date	2005.10.10.09.38.29;	author espie;	state Exp;
branches;
next	1.53;

1.53
date	2005.10.02.20.46.23;	author espie;	state Exp;
branches;
next	1.52;

1.52
date	2005.09.17.21.49.40;	author jmc;	state Exp;
branches;
next	1.51;

1.51
date	2005.09.17.11.14.03;	author espie;	state Exp;
branches;
next	1.50;

1.50
date	2005.09.17.09.47.32;	author espie;	state Exp;
branches;
next	1.49;

1.49
date	2005.09.17.09.16.21;	author espie;	state Exp;
branches;
next	1.48;

1.48
date	2005.09.07.09.11.22;	author jmc;	state Exp;
branches;
next	1.47;

1.47
date	2005.09.04.22.47.56;	author espie;	state Exp;
branches;
next	1.46;

1.46
date	2005.08.17.19.22.31;	author espie;	state Exp;
branches;
next	1.45;

1.45
date	2005.08.17.10.03.17;	author espie;	state Exp;
branches;
next	1.44;

1.44
date	2005.08.16.14.13.42;	author jmc;	state Exp;
branches;
next	1.43;

1.43
date	2005.08.16.12.20.21;	author espie;	state Exp;
branches;
next	1.42;

1.42
date	2005.08.16.12.05.58;	author espie;	state Exp;
branches;
next	1.41;

1.41
date	2005.08.16.10.37.06;	author espie;	state Exp;
branches;
next	1.40;

1.40
date	2005.08.16.10.01.16;	author espie;	state Exp;
branches;
next	1.39;

1.39
date	2005.08.13.06.41.55;	author jmc;	state Exp;
branches;
next	1.38;

1.38
date	2005.08.12.18.00.33;	author espie;	state Exp;
branches;
next	1.37;

1.37
date	2005.04.09.21.36.57;	author jmc;	state Exp;
branches;
next	1.36;

1.36
date	2005.04.09.21.35.35;	author jmc;	state Exp;
branches;
next	1.35;

1.35
date	2005.03.26.02.14.36;	author pvalchev;	state Exp;
branches;
next	1.34;

1.34
date	2005.03.25.22.33.40;	author espie;	state Exp;
branches;
next	1.33;

1.33
date	2005.01.03.13.01.27;	author jmc;	state Exp;
branches;
next	1.32;

1.32
date	2005.01.03.01.02.45;	author espie;	state Exp;
branches;
next	1.31;

1.31
date	2004.12.28.14.50.38;	author espie;	state Exp;
branches;
next	1.30;

1.30
date	2004.12.26.15.01.06;	author espie;	state Exp;
branches;
next	1.29;

1.29
date	2004.12.18.14.13.33;	author espie;	state Exp;
branches;
next	1.28;

1.28
date	2004.12.16.11.07.33;	author espie;	state Exp;
branches;
next	1.27;

1.27
date	2004.12.09.18.58.25;	author espie;	state Exp;
branches;
next	1.26;

1.26
date	2004.11.21.11.29.35;	author xsa;	state Exp;
branches;
next	1.25;

1.25
date	2004.11.15.13.20.40;	author jmc;	state Exp;
branches;
next	1.24;

1.24
date	2004.11.15.10.21.40;	author jmc;	state Exp;
branches;
next	1.23;

1.23
date	2004.11.14.12.04.19;	author espie;	state Exp;
branches;
next	1.22;

1.22
date	2004.11.14.11.58.43;	author espie;	state Exp;
branches;
next	1.21;

1.21
date	2004.11.11.12.15.28;	author espie;	state Exp;
branches;
next	1.20;

1.20
date	2004.11.07.13.47.12;	author espie;	state Exp;
branches;
next	1.19;

1.19
date	2004.10.18.14.37.20;	author espie;	state Exp;
branches;
next	1.18;

1.18
date	2004.10.11.13.10.25;	author espie;	state Exp;
branches;
next	1.17;

1.17
date	2004.10.11.10.07.37;	author espie;	state Exp;
branches;
next	1.16;

1.16
date	2004.09.18.13.28.19;	author espie;	state Exp;
branches;
next	1.15;

1.15
date	2004.09.14.22.58.30;	author espie;	state Exp;
branches;
next	1.14;

1.14
date	2004.08.25.22.34.27;	author jmc;	state Exp;
branches;
next	1.13;

1.13
date	2004.03.07.19.29.08;	author espie;	state Exp;
branches;
next	1.12;

1.12
date	2004.02.20.19.13.51;	author espie;	state Exp;
branches;
next	1.11;

1.11
date	2004.01.28.22.12.01;	author espie;	state Exp;
branches;
next	1.10;

1.10
date	2004.01.27.14.50.52;	author espie;	state Exp;
branches;
next	1.9;

1.9
date	2004.01.27.13.50.55;	author espie;	state Exp;
branches;
next	1.8;

1.8
date	2004.01.27.13.09.16;	author espie;	state Exp;
branches;
next	1.7;

1.7
date	2004.01.22.21.11.43;	author espie;	state Exp;
branches;
next	1.6;

1.6
date	2003.11.14.23.18.50;	author espie;	state Exp;
branches;
next	1.5;

1.5
date	2003.11.14.23.03.55;	author espie;	state Exp;
branches;
next	1.4;

1.4
date	2003.11.08.19.17.29;	author jmc;	state Exp;
branches;
next	1.3;

1.3
date	2003.11.06.18.20.04;	author espie;	state Exp;
branches;
next	1.2;

1.2
date	2003.10.26.10.33.24;	author espie;	state Exp;
branches;
next	1.1;

1.1
date	2003.10.19.18.38.06;	author espie;	state Exp;
branches;
next	;


desc
@@


1.145
log
@document tweaked checksum behavior, reorder environment, remove old cruft.
@
text
@.\"	$OpenBSD: pkg_add.1,v 1.144 2017/03/11 17:34:40 schwarze Exp $
.\"
.\" Documentation and design originally from FreeBSD. All the code has
.\" been rewritten since. We keep the documentation's notice:
.\"
.\" Redistribution and use in source and binary forms, with or without
.\" modification, are permitted provided that the following conditions
.\" are met:
.\" 1. Redistributions of source code must retain the above copyright
.\"    notice, this list of conditions and the following disclaimer.
.\" 2. Redistributions in binary form must reproduce the above copyright
.\"    notice, this list of conditions and the following disclaimer in the
.\"    documentation and/or other materials provided with the distribution.
.\"
.\" Jordan K. Hubbard
.\"
.\"
.Dd $Mdocdate: March 11 2017 $
.Dt PKG_ADD 1
.Os
.Sh NAME
.Nm pkg_add
.Nd install or update software packages
.Sh SYNOPSIS
.Nm pkg_add
.Bk -words
.Op Fl acIimnqrsUuVvxz
.Op Fl A Ar arch
.Op Fl B Ar pkg-destdir
.Op Fl D Ar name Ns Op = Ns Ar value
.Op Fl L Ar localbase
.Op Fl l Ar file
.Op Fl P Ar type
.Ar pkg-name ...
.Ek
.Sh DESCRIPTION
The
.Nm
command is used to install packages created
with the
.Xr pkg_create 1
command.
Packages containing pre-compiled applications from the
.Pa /usr/ports
tree can be found on the
.Ox
FTP site or on the official
.Ox
CD.
.Bd -filled -offset indent
.Em Note :
System distribution files, e.g., base58.tgz, comp58.tgz, are
.Em not
packages and may not be installed using
.Nm .
.Ed
.Pp
.Nm
can be used to install new packages, to replace existing packages with other
flavors
.Po
option
.Fl r
.Pc
or to update packages to newer versions
.Po
option
.Fl u
.Pc .
.Pp
In a hurry, a new package can be installed using
.Sq Nm Fl U Ar package ,
which updates dependencies and then installs the new
.Ar package .
.Pp
Details of packing-list internals are documented in
.Xr pkg_create 1 .
.Pp
.Nm
will
.Xr syslog 3
installations and updates by default.
.Pp
.Nm
relies on the file system information being consistent.
In case of a system crash,
.Pa /var/db/pkg
may become corrupted.
Use
.Xr pkg_check 8
to repair things.
.Pp
If a package is digitally signed:
.Bl -bullet
.It
.Nm
checks that its signature is valid and that the compressed package
data matches the signature.
.It
.Nm
verifies that the signature was emitted by a valid signing key, as
stored in
.Pa /etc/signify/*-pkg.pub
.It
.Nm
verifies that each file matches its sha256 checksum right after extraction,
before doing anything with it.
.It
.Nm
verifies that any dangerous mode or owner is registered in the packing-list.
.El
.Pp
By default,
.Nm
enforces signed packages, except if they come from a trusted source
.Po
.Ev TRUSTED_PKG_PATH
.Pc
or if
.Fl D Ns Ar unsigned
is specified.
.Pp
In normal mode,
the package names given on the command lines are names of new packages that
.Nm
should install, without ever deinstalling existing packages.
.Pp
In replacement mode,
the package names given on the command lines are names of new packages that
.Nm
should install, possibly replacing existing installed packages.
.Pp
In update mode,
the package names given on the command lines are names of installed
packages, and
.Nm
should figure out newer package names for these, then replace the old
packages with the new.
.Pp
Each package name may be specified as a filename (which normally consists of the
package name itself plus the
.Dq .tgz
suffix) or a URL referring to FTP, HTTP, HTTPS, or SCP locations.
If the given package names are not found in the current working directory,
.Nm
will search for them in each directory (local or remote) named by the
.Ev TRUSTED_PKG_PATH
environment variable,
then the
.Ev PKG_PATH
environment variable.
If neither
.Ev TRUSTED_PKG_PATH
nor
.Ev PKG_PATH
are defined,
.Nm
will build its path based on the contents of
.Xr installurl 5 .
Specifying
.Ql -
as a package name causes
.Nm
to read from the standard input.
.Pp
.Nm
also understands
.Sq stems ,
that is, package names without any version specification.
For instance, with
.Sq Nm Ar kdelibs ,
.Nm
will look in the current directory
.Po
or the
.Ev PKG_PATH
.Pc
for a
.Ar kdelibs
package.
.Pp
.Nm
may ask questions in interactive mode, or error out otherwise.
Interactive mode is the default on a tty, see
options
.Fl I/i .
.Pp
For instance
.Sq Nm Ar screen
is ambiguous as it matches
.Ar screen-4.03p6
and
.Ar screen-4.03p6-shm .
.Pp
To avoid ambiguities,
.Nm
supports
.Sq stems with flavors ,
that is, a stem separated from flavors with a double dash.
For instance, the previous ambiguity could be resolved by using
.Sq Nm Ar screen--
(matches only the empty flavor)
or
.Sq Nm Ar screen--shm
(matches only the shm flavor).
.Pp
There is also an ambiguity related to ports with multiple branches.
For instance
.Sq Nm Ar python
is ambiguous, as there are several versions of python in the ports tree.
So is
.Sq Nm Ar postfix .
The special form
.Sq Ar pkgname Ns % Ns Ar branch
can be used to restrict matches to a branch matching the
.Xr pkgpath 7 .
.Pp
The above ambiguities can be resolved using
.Sq Nm Ar postfix Ns % Ns Ar stable
and
.Sq Nm Ar python Ns % Ns Ar 3.4 ,
respectively.
.Pp
All paths recognize special sequences
.Sq %a ,
.Sq %m ,
.Sq %c ,
.Sq %v ,
which will be expanded to
.Sq package architecture ,
.Sq OS version or snapshots ,
.Sq full mirror path
and
.Sq OS version
respectively.
.Pp
The sequences
.Sq %c
and
.Sq %m
are slightly more magical.
One can force them to expand to
.Sq snapshots
on a release kernel by using
.Fl D Ar snap .
Otherwise, on a
.Sq -stable
system, they will expand
.Sq %c/packages
into
two directories:
.Pa <VERSION>/packages-stable
and
.Pa <VERSION>/packages .
.Pp
The following examples are valid:
.Bd -literal -offset indent
pkg_add -v http://ftp.openbsd.org/%m/rsync--
pkg_add -v http://ftp.openbsd.org/%m/m4
pkg_add -v scp://login@@host/usr/ports/packages/%a/all/tcl%8.5
.Ed
.Pp
If the environment variable
.Ev PKG_CACHE
is set to a directory name, every package retrieved from a distant location
will also be copied here.
.Pp
Some packages may depend on other packages.
When resolving dependencies
.Nm
will first look at already installed packages, then match
dependencies with the list of packages left to install, then ask the
user's opinion in interactive mode,
then install default packages that satisfy the dependencies.
.Pp
.Sy Warning:
Since the
.Nm
command may execute scripts or programs contained within a package file,
your system may be susceptible to
.Dq trojan horses
or other subtle attacks from miscreants who create dangerous packages.
Be sure the specified package(s) are from trusted sources.
.Pp
The options are as follows:
.Bl -tag -width keyword
.It Fl A Ar arch
Assume
.Ar arch
as current machine architecture for any package tests.
.It Fl a
Automated package installation; do not record packages as installed manually.
.It Fl aa
Force already installed packages to be tagged as installed automatically.
.It Fl B Ar pkg-destdir
Set
.Ar pkg-destdir
as the prefix to prepend to any object extracted from the package.
.It Fl c
While replacing packages, delete extra configuration file in the old package,
mentioned as
.Dl @@extra file
in the packing-list.
.It Fl D Ar name Ns Op = Ns Ar value
Force installation of the package.
.Ar name
is a keyword that states what failsafe
should be waived.
Recognized keywords include:
.Pp
.Bl -tag -width "updatedependsXX" -compact
.It Ar allversions
Do not trim older p* variants of packages for updates.
.It Ar arch
Architecture recorded in package may not match.
.It Ar checksum
Verify checksums before deleting or tieing old files.
.It Ar dontmerge
By default, if dependencies are too strict,
.Nm
will merge updates together to make sure everything stays in sync.
.Fl D Ns Ar dontmerge
disables that behavior.
.It Ar donttie
By default,
.Nm
will try to find new files in old packages by comparing the stored sha256,
and tie the entries together to avoid extracting files needlessly.
.Fl D Ns Ar donttie
disables that behavior.
.It Ar downgrade
Don't filter out package versions older than what's currently installed.
.It Ar installed
In update mode, reinstall an existing package with the same update signature.
.It Ar libdepends
Library specifications may not be fulfilled.
.It Ar nonroot
Install even if not running as root.
.It Ar paranoid
Very safe update: don't run any @@exec/@@unexec.
This may break some packages that will need manual intervention.
.It Ar repair
Attempt to repair installed packages with missing registration data.
.It Ar scripts
External scripts may fail.
.It Ar SIGNER
List of trusted signers, separated by commas.
Corresponds to list of public keys under
.Pa /etc/signify
we want to trust.
Defaults to any key matching
.Sq *pkg
for packages, and any key matching
.Sq *fw
for firmware.
.It Ar snap
Force
.Sq %c
and
.Sq %m
to expand to
.Sq snapshots ,
even on a release kernel.
.It Ar unsigned
Allow the installation of unsigned packages without warnings/errors
(necessary for
.Xr ports 7 ,
automatically set by the build infrastructure).
.It Ar updatedepends
Force update even if forward dependencies no longer match.
.El
.It Fl I
Force non-interactive mode.
Default is to be interactive when run from a tty.
.It Fl i
Force interactive mode, even if not run from a tty.
.Nm
may ask questions to the user if faced with difficult decisions.
.It Fl L Ar localbase
Install a package under
.Ar localbase .
By default,
.Ar localbase
equals
.Pa /usr/local ,
and specifying it is not necessary.
However, packages can be created using a different
.Ar localbase
.Po
see
.Xr pkg_create 1
.Pc ,
and those packages can only be installed by using the same
.Ar localbase .
See
.Xr bsd.port.mk 5
for a description of
.Ev LOCALBASE .
.It Fl l Ar file
Installs packages from the raw output of
.Xr pkg_info 1 ,
as saved in
.Ar file .
Generally, use with
.Li pkg_info -m \*(Gtfile ,
to reproduce an installation from machine to machine.
With
.Fl z
and
.Fl l
.Nm
will try its best to reproduce the installation, even if the
version numbers don't quite match and even if some packages cannot
be found.
.It Fl m
Causes
.Nm
to always display the progress meter in cases it would not do so by default.
.It Fl n
Don't actually install a package, just report the steps that
would be taken if it was.
Will still copy packages to
.Ev PKG_CACHE
if applicable.
.It Fl P Ar type
Check permissions for distribution, where
.Ar type
can be
.Sq cdrom
or
.Sq ftp .
.It Fl qq
Do not bother with checksums for configuration files.
.It Fl r
Replace existing packages.
.Nm
will try to take every precaution to make sure the replacement can
proceed before removing the old package and adding the new one, and it
should also handle shared libraries correctly.
Among other things,
.Nm
will refuse to replace packages as soon as it needs to run scripts that
might fail
.Po
use
.Fl D Ar update
to force the replacement
.Pc ;
.Nm
will also refuse to replace packages when the dependencies don't quite
match
.Po
use
.Fl D Ar updatedepends
to force the replacement
.Pc .
.It Fl s
Don't actually install packages, skip as many steps as needed and report
only the disk size changes that would happen.
Similar to
.Fl n ,
except it also skips fetching full packages and stops at getting the
information it needs.
.It Fl U
Update dependencies if required before installing the new package(s).
.It Fl u
Update the given installed
.Ar pkgname(s) ,
and anything it depends upon.
If no
.Ar pkgname
is given,
.Nm
will update all installed packages.
This relies on
.Ev PKG_PATH
to figure out the new package names.
.It Fl V
Turn on statistics output.
For now, only displays the number of packages done/total number of packages.
Several
.Fl V
will turn on more statistics in the future.
.It Fl v
Turn on verbose output.
Several
.Fl v
turn on more verbose output.
By default,
.Nm
is almost completely silent, but it reacts to keyboard status requests
.Po
see
.Xr stty 1
.Pc .
.Fl v
turns on basic messages,
.Fl vv
adds relevant system operations,
.Fl vvv
shows most internal computations apart from individual file/directory
additions,
.Fl vvvv
also shows dependencies adjustments, and
.Fl vvvvv
shows everything.
.It Fl x
Disable progress meter.
.It Fl z
Fuzzy package addition:
.Nm
should do its best to match package names passed on the command line,
even if the versions don't match and it will proceed even if
some packages can't be found.
.El
.Pp
By default, when adding packages via FTP, the
.Xr ftp 1
program operates in
.Dq passive
mode.
If you wish to use active mode instead, set the
.Ev FTPMODE
environment variable to
.Dq active .
If
.Nm
consistently fails to fetch a package from a site known to work,
it may be because the site does not support
passive mode FTP correctly.
This is very rare since
.Nm
will try active mode FTP if the server refuses a passive mode
connection.
.Ss Manual installation
.Nm
differentiates between packages specified on the command line, and packages
installed automatically because of inter-dependencies:
the first kind will be tagged as
.Sq installed manually .
The
.Fl a
option is used internally by the
.Xr ports 7
infrastructure
and
.Xr dpb 1
to handle dependencies.
.Pp
It is also possible to tweak the
.Sq installed manually
status of a package after the fact.
Running
.Nm
on an already installed package will tag it as
.Sq installed manually ,
even if it was already there as a dependency of something else,
and doubling the
.Fl a
option will remove the
.Sq installed manually
tag from installed packages.
.Pp
.Xr pkg_info 1
can be used to show only manually-installed packages, and
.Xr pkg_delete 1
can be used to remove dependencies when they are no longer needed.
.Ss Technical details
.Nm
deals with
.Sq updatesets
internally.
An updateset is a collection of old package(s) to delete, and new package(s)
to install, as an atomic operation.
Under normal circumstances, an updateset contains at most one old package
and one new package, but some situations may require
.Nm
to perform several installations/deletions at once.
.Pp
For each new package in an updateset,
.Nm
extracts the package's
.Dq packing information
(the packing-list, description, and installation/deinstallation scripts)
into a special staging directory in
.Pa /var/tmp
(or
.Ev PKG_TMPDIR
if set)
and then runs through the following sequence to fully extract the contents
of the package:
.Bl -enum
.It
A check is made to determine if the package is already recorded as installed.
If it is,
the installation is terminated.
.It
A check is made to determine if the package conflicts (from
.Cm @@conflict
directives; see
.Xr pkg_create 1 )
with a package already recorded as installed.
In non-replacement mode, its installation is terminated.
.It
For packages tagged with architecture constraints,
.Nm
verifies that the current machine architecture agrees with the constraints.
.It
All package dependencies (from
.Cm @@depend
and
.Cm @@wantlib
directives; see
.Xr pkg_create 1 )
are read from the packing-list.
If any of these dependencies are not currently fulfilled,
an attempt is made to find a package that meets them and install it,
looking first in the current updateset, then in the list of packages
to install passed to
.Nm ;
if no adequate package can be found and installed,
the installation is terminated.
.It
.Nm
checks for collisions with installed file names, read-only file systems,
and enough space to store files.
.It
The packing-list is used as a guide for extracting
files from the package into their final locations.
.It
After installation is complete, a copy of all package files
such as the packing-list, extra messages, or
the description file is made into
.Pa /var/db/pkg/<pkg-name>
for subsequent possible use by
.Xr pkg_delete 1
and
.Xr pkg_info 1 .
Any package dependencies are recorded in the other packages'
.Pa /var/db/pkg/<other-pkg>/+REQUIRED_BY
file
(if the environment variable
.Ev PKG_DBDIR
is set, this overrides the
.Pa /var/db/pkg/
path shown above).
.It
Finally, the staging area is deleted and the program terminates.
.El
.Pp
Note that it is safe to interrupt
.Nm pkg_add
through
.Dv SIGINT ,
.Dv SIGHUP ,
and other signals, as it will safely record an interrupted install as
.Pa partial-<pkgname>[.n] .
.Pp
When replacing packages, the procedure is slightly different.
.Bl -enum
.It
A check is made to determine if a similar package is already installed.
If so, its full update signature is computed, which contains all the
necessary dependency information along with the actual package version.
If that signature is identical to that of the new package, no replacement
is performed (unless -D installed is specified).
.It
A check is made to determine what old package(s) the new package(s) should
replace, using conflicts.
.Nm
will attempt to update those packages.
If they update to the new package(s), nothing needs to be done.
If they're part of the list of updatesets to install, the corresponding
updatesets will be merged.
Otherwise,
.Nm
will add them to the current updateset, and rerun update to find suitable
update to those packages.
.It
A check is made to determine whether the old packages will be deleted without
issue, and whether the new packages will install correctly.
This includes refusing to run any code (unless -D update), and verifying
that the new package still matches dependencies (unless -D updatedepends).
.It
Shared libraries deserve special treatment: each shared library from the old
packages that does no longer exist in the new packages, but that is required
from a wantlib of another package is kept along in a stub package named
.Pa \&.libs-<pkgname> .
.It
The new packages are extracted to the filesystem, using temporary filenames
of the form
.Pa pkg.XXXXXXX
since the old packages are still there.
The packing-list is amended to record these names as @@temp annotations,
in cases the installation fails.
.It
The old packages are deleted as usual, except that some packages may still
depend on them.
Note also that
.Cm @@unexec-delete
commands are not executed.
.It
The new packages are installed as usual, except that the files are already
present and only need to be renamed.
Note also that
.Cm @@exec-add
commands are not executed.
.It
Dependencies from the old packages are adjusted to point to the correct new
package.
.El
.Pp
To update packages in -u mode,
.Nm
performs the following steps.
.Bl -enum
.It
Each package name is reduced to its stem, and every package name with matching
stem available through
.Ev PKG_PATH
is considered as an update candidate.
.It
.Nm
searches for a
.Sq quirks
package first, which may contain exceptions to these rules.
This special package contains global information, such as packages that
can be deleted because they're now part of base, or stem changes.
.It
Version matching occurs: unless -D downgrade, only packages with newer
versions will be considered as update candidates.
Note that version matching is costly, thus
.Ev PKG_PATH
should point to a snapshot of packages for a given version of
.Ox ,
similar to the organization on the FTP sites.
.It
Candidates are then matched according to their pkgpaths
.Po
see
.Xr pkgpath 7
and
.Xr pkg_create 1
.Pc
in order to weed out similar packages with distinct options.
.It
The update signature of the candidate is compared to the signature of the
already installed package: identical signatures mean no update needed.
.It
If several candidates are left,
.Nm
will ask the user in interactive mode, and not perform the update in
non-interactive mode.
.It
Once a suitable update candidate has been found,
.Nm
checks the package dependencies.
If necessary, it will install or update them first.
Once all dependencies are up to date,
.Nm
will update the package.
.El
.Sh ENVIRONMENT
.Bl -tag -width PKG_DESTDIR
.It Ev FTPMODE
Specifies whether
.Xr ftp 1
should operate in
.Dq active
or
.Dq passive
mode.
The default is
.Dq passive .
.It Ev FETCH_CMD
Override use of
.Xr ftp 1 .
Must point to a command that understands
.Li ${FETCH_CMD} -o - url .
.It Ev PKG_CACHE
If set, any package retrieved from a distant location will be copied to
that directory as well.
.It Ev PKG_CHECKSUM
If set, verify files checksums during deletion, exactly like
.Fl D Ns Ar checksum .
.It Ev PKG_DBDIR
Where to register packages instead of
.Pa /var/db/pkg .
.It Ev PKG_DESTDIR
Value for
.Ar pkg-destdir ,
if no
.Fl B
option is specified.
.It Ev PKG_PATH
If a given package name cannot be found,
the directories named by
.Ev PKG_PATH
are searched.
It should contain a series of entries separated by colons.
Each entry consists of a directory name.
URL schemes such as FTP, HTTP, HTTPS, or SCP are also appropriate.
The current directory may be indicated
implicitly by an empty directory name, or explicitly by a single
period
.Pq Ql \&./ .
Special sequences
.Sq %a ,
.Sq %c ,
.Sq %m ,
.Sq %v
will be expanded.
.It Ev PKG_TMPDIR
Temporary area where package information files will be extracted, instead of
.Pa /var/tmp .
.It Ev TRUSTED_PKG_PATH
Same semantics as
.Ev PKG_PATH ,
but it is searched before
.Ev PKG_PATH
and waves any kind of signature checking.
.El
.Sh SEE ALSO
.Xr ftp 1 ,
.Xr pkg_create 1 ,
.Xr pkg_delete 1 ,
.Xr pkg_info 1 ,
.Xr OpenBSD::Intro 3p ,
.Xr bsd.port.mk 5 ,
.Xr installurl 5 ,
.Xr package 5 ,
.Xr pkg_check 8
.Sh AUTHORS
.Bl -tag -width indent -compact
.It An Jordan Hubbard
Initial design.
.It An Marc Espie
Complete rewrite.
.El
@


1.144
log
@Make spacing after -D consistent.
Manual pages should only use .Fl X Ns Ar in the unusual case that no
space is allowed between the option letter and the option argument.

See POSIX for details:
http://pubs.opengroup.org/onlinepubs/9699919799/basedefs/V1_chap12.html

OK espie@@
@
text
@d1 1
a1 1
.\"	$OpenBSD: pkg_add.1,v 1.143 2017/03/11 11:42:10 espie Exp $
d120 1
a120 1
.Fl D Ar unsigned
d316 2
d322 1
a322 1
.Fl D Ar dontmerge
d329 1
a329 1
.Fl D Ar donttie
a338 3
.\" .It Ar nosig
.\" do not check digital signatures.
.\" Still displays a very prominent message if a signature is found.
d341 1
d432 2
a433 5
.It Fl q
Replace package quickly; do not bother with checksums before removing normal
files.
If used twice,
it will not bother with checksums for configuration files either.
d780 6
a785 10
.It Ev FTP_KEEPALIVE
Have
.Xr ftp 1
send a byte after every
.Ev FTP_KEEPALIVE
seconds,
so that incorrectly configured network equipment won't aggressively drop it.
See
.Dq ftp -k
for more information.
a794 3
.It Ev PKG_CACHE
If set, any package retrieved from a distant location will be copied to
that directory as well.
@


1.143
log
@document recent changes.
acknowledge that installurl requires some internal treatment
explain how %c works now.
Document -Dsnap and -V
Remove the pesky spaces in -Dname, since no-one types the space ever
@
text
@d1 1
a1 1
.\"	$OpenBSD: pkg_add.1,v 1.142 2017/02/27 21:53:11 rpe Exp $
d18 1
a18 1
.Dd $Mdocdate: February 27 2017 $
d30 1
a30 1
.Op Fl D Ns Ar name Ns Op = Ns Ar value
d120 1
a120 1
.Fl D Ns Ar unsigned
d245 1
a245 1
.Fl D Ns Ar snap .
d304 1
a304 3
.It Xo
.Fl D Ns Ar name Ns Op = Ns Ar value
.Xc
@


1.142
log
@Remove support for pkg.conf in light of the consolidation towards
a single configuration file for the OpenBSD repository location.

The pkg_* tools now use installurl(5) to find the package repository.

NOTE:
/etc/installurl only contains a single URL pointing to a mirror.
Use the PKG_PATH environment variable to specify more than one
package repository.

prodded by and OK deraadt@@ aja@@
@
text
@d1 1
a1 1
.\"	$OpenBSD: pkg_add.1,v 1.141 2017/02/15 13:19:08 jmc Exp $
d18 1
a18 1
.Dd $Mdocdate: February 15 2017 $
d27 1
a27 1
.Op Fl acIimnqrsUuvxz
d30 1
a30 1
.Op Fl D Ar name Ns Op = Ns Ar value
d120 1
a120 1
.Fl D Ar unsigned
d158 1
a158 1
will use the path in
d226 1
d228 27
a254 2
.Sq %m ,
.Sq %v .
d305 1
a305 2
.Fl D
.Ar name Ns Op = Ns Ar value
d358 8
d483 6
d842 1
@


1.141
log
@improve list item formatting;
from salvador sabaini
@
text
@d1 1
a1 1
.\"	$OpenBSD: pkg_add.1,v 1.140 2017/01/01 01:08:11 tb Exp $
d18 1
a18 1
.Dd $Mdocdate: January 1 2017 $
d82 1
a82 5
installations and updates by default
.Po
but see
.Xr pkg.conf 5
.Pc .
d158 2
a159 4
will use the path named by
.Ar installpath
within
.Xr pkg.conf 5 .
d228 1
a228 5
.Sq %v
.Po
from
.Xr pkg.conf 5
.Pc .
d785 1
a785 4
will be expanded with the same semantics as
.Ar installpath
in
.Xr pkg.conf 5 .
a803 1
.Xr pkg.conf 5 ,
@


1.140
log
@Hyphenate compound adjectives 'up-to-date', 'out-of-date' and 'well-known'
if they precede the noun and omit hyphens otherwise.

ok tj
@
text
@d1 1
a1 1
.\"	$OpenBSD: pkg_add.1,v 1.139 2016/10/03 14:24:18 espie Exp $
d18 1
a18 1
.Dd $Mdocdate: October 3 2016 $
d300 1
a300 1
do not trim older p* variants of packages for updates.
d302 1
a302 1
architecture recorded in package may not match.
d304 1
a304 1
by default, if dependencies are too strict,
d310 1
a310 1
by default,
d317 1
a317 1
don't filter out package versions older than what's currently installed.
d319 1
a319 1
in update mode, reinstall an existing package with the same update signature.
d321 1
a321 1
library specifications may not be fulfilled.
d323 1
a323 1
install even if not running as root.
d328 1
a328 1
very safe update: don't run any @@exec/@@unexec.
d330 1
a330 1
attempt to repair installed packages with missing registration data.
d332 1
a332 1
external scripts may fail.
d334 1
a334 1
list of trusted signers, separated by commas.
d344 1
a344 1
allow the installation of unsigned packages without warnings/errors
d349 1
a349 1
force update even if forward dependencies no longer match.
@


1.139
log
@document (partially) new stuff
@
text
@d1 1
a1 1
.\"	$OpenBSD: pkg_add.1,v 1.138 2016/06/14 17:06:23 espie Exp $
d18 1
a18 1
.Dd $Mdocdate: June 14 2016 $
d735 1
a735 1
Once all dependencies are up-to-date,
@


1.138
log
@more unification of stuff run on the command line
don't mention FW_UPDATE, it's an internal detail
@
text
@d1 1
a1 1
.\"	$OpenBSD: pkg_add.1,v 1.137 2016/06/14 15:41:31 espie Exp $
d101 2
a102 2
checks that its packing-list is not corrupted and matches the cryptographic
signature stored within.
d105 3
a107 3
verifies that the signature was emitted by a valid user certificate, signed
by one of the authorities in
.Pa /etc/ssl/pkgca.pem
d117 10
d151 3
d156 3
a158 1
If
d160 1
a160 1
is not defined,
d179 6
a184 1
will look in the current directory (or the PKG_PATH) for a
d324 3
a326 3
.It Ar nosig
do not check digital signatures.
Still displays a very prominent message if a signature is found.
d802 6
@


1.137
log
@new syntax: pkgname%branch   to select a branch wherever it makes sense.
see pkg_add(1) for details.

Search framework makes that surprisingly simple.
@
text
@d1 1
a1 1
.\"	$OpenBSD: pkg_add.1,v 1.136 2016/06/14 13:02:35 espie Exp $
d162 1
a162 1
.Li pkg_add kdelibs ,
d164 3
a166 1
will look in the current directory (or the PKG_PATH) for a kdelibs package.
a297 4
.It Ar FW_UPDATE
set by
.Xr fw_update 1
to separate firmware from normal packages.
@


1.136
log
@reorg examples to better use actual options.
emphasize -U straight away because people often don't even realize it's
there.

Make more use of default stem so that we don't have to update examples too
often.

Ditch the interactive ftp stuff, there's nobody that actually uses that,
especially since there are almost no ftp mirrors left.
@
text
@d1 1
a1 1
.\"	$OpenBSD: pkg_add.1,v 1.135 2016/05/14 03:41:48 tj Exp $
d18 1
a18 1
.Dd $Mdocdate: May 14 2016 $
d73 1
a73 1
which updates dependencies and then installs the new 
d174 1
a174 1
is ambiguous as it matches 
d176 1
a176 1
and 
d191 17
d222 1
a222 1
pkg_add -v scp://login@@host/usr/ports/packages/%a/all/tcl-8.5.18.tgz
@


1.135
log
@ftp:// -> http:// for main ftp site example.
@
text
@d1 1
a1 1
.\"	$OpenBSD: pkg_add.1,v 1.134 2015/11/04 16:59:58 mmcc Exp $
d18 1
a18 1
.Dd $Mdocdate: November 4 2015 $
d23 1
a23 1
.Nd install software package distributions
d43 1
a43 1
Selected packages containing pre-compiled applications from the
d71 5
a137 5
The following examples are valid:
.Pp
.Li pkg_add -v http://ftp.openbsd.org/pub/OpenBSD/2.7/packages/i386/m4-1.4.tgz
.Li pkg_add -v scp://login@@host/usr/ports/packages/sparc/all/tcl-8.4.7.tgz
.Pp
d173 5
a177 2
.Li pkg_add screen
is ambiguous as it matches screen-4.02  and screen-4.02-static.
d185 2
a186 2
.Li pkg_add screen--
(matches only the normal flavor)
d188 19
a206 2
.Li pkg_add screen--static
(matches only the static flavor).
a219 26
.Pp
Alternatively, it is possible to add packages interactively from within the
.Xr ftp 1
client,
in which case setting
.Ev PKG_PATH
correctly will be necessary for any dependency to be found out and retrieved
the same way.
For example, the following works:
.Bd -literal -offset indent
$ ftp ftp://ftp.openbsd.org/pub/OpenBSD/2.7/packages/i386/
250 CWD command successful
ftp> ls m*
227 Entering Passive Mode (129,128,5,191,164,73)
150 Opening ASCII mode data connection for m*.
m4-1.4.tgz
metamail-2.7.tgz
mh-6.8.4.tgz
mm-1.0.12.tgz
mpeg_lib-1.2.1.tgz
mpeg_play-2.4.tgz
mpg123-0.59q.tgz
mutt-0.95.7i.tgz
226 Transfer complete.
ftp> get m4-1.4.tgz "|pkg_add -v -"
.Ed
@


1.134
log
@Bump distribution tarball versions.
@
text
@d1 1
a1 1
.\"	$OpenBSD: pkg_add.1,v 1.133 2015/10/07 17:52:38 jmc Exp $
d18 1
a18 1
.Dd $Mdocdate: October 7 2015 $
d135 1
a135 1
.Li pkg_add -v ftp://ftp.openbsd.org/pub/OpenBSD/2.7/packages/i386/m4-1.4.tgz
@


1.133
log
@"..." implies optional, so no need for []; from michael reed
@
text
@d1 1
a1 1
.\"	$OpenBSD: pkg_add.1,v 1.132 2015/04/16 20:01:39 jmc Exp $
d18 1
a18 1
.Dd $Mdocdate: April 16 2015 $
d52 1
a52 1
System distribution files, e.g., base50.tgz, comp50.tgz, are
@


1.132
log
@firmware, not firmwares;
@
text
@d1 1
a1 1
.\"	$OpenBSD: pkg_add.1,v 1.131 2015/04/16 14:11:29 espie Exp $
d34 1
a34 1
.Ar pkg-name Op Ar ...
@


1.131
log
@document %m, sort %.
@
text
@d1 1
a1 1
.\"	$OpenBSD: pkg_add.1,v 1.130 2015/04/16 13:40:56 espie Exp $
d288 1
a288 1
to separate firmwares from normal packages.
d313 1
a313 1
for firmwares.
@


1.130
log
@document % sequences.
@
text
@d1 1
a1 1
.\"	$OpenBSD: pkg_add.1,v 1.129 2014/11/17 23:03:37 sthen Exp $
d18 1
a18 1
.Dd $Mdocdate: November 17 2014 $
d762 1
d764 2
a765 2
.Sq %v ,
.Sq %a 
@


1.129
log
@CAVEATS was removed (no more INSTALL/DEINSTALL scripts, so it's OK for
PKG_TMPDIR to be on a fs mounted with noexec); remove a reference to CAVEATS
from the section talking about PKG_TMPDIR.  ok espie@@
@
text
@d1 1
a1 1
.\"	$OpenBSD: pkg_add.1,v 1.128 2014/09/08 01:27:55 schwarze Exp $
d18 1
a18 1
.Dd $Mdocdate: September 8 2014 $
d761 8
@


1.128
log
@obvious cases of missing .An;
found with the new mandoc(1) MANDOCERR_AN_MISSING warning;
no text changes
@
text
@d1 1
a1 1
.\"	$OpenBSD: pkg_add.1,v 1.127 2014/07/12 20:41:09 jmc Exp $
d18 1
a18 1
.Dd $Mdocdate: July 12 2014 $
d536 1
a536 3
if set \- see
.Sx CAVEATS ,
below)
@


1.127
log
@zap trailing whitespace;
@
text
@d1 1
a1 1
.\"	$OpenBSD: pkg_add.1,v 1.126 2014/07/12 19:53:43 espie Exp $
d779 1
a779 1
.It "Jordan Hubbard"
d781 1
a781 1
.It "Marc Espie"
@


1.126
log
@undocument -Q
@
text
@d1 1
a1 1
.\"	$OpenBSD: pkg_add.1,v 1.125 2014/02/14 14:13:19 espie Exp $
d18 1
a18 1
.Dd $Mdocdate: February 14 2014 $
d696 1
a696 1
The update signature of the candidate is compared to the signature of the 
@


1.125
log
@INSTALL/DEINSTALL scripts are completely dead these days
@
text
@d1 1
a1 1
.\"	$OpenBSD: pkg_add.1,v 1.124 2014/02/11 10:36:13 espie Exp $
d18 1
a18 1
.Dd $Mdocdate: February 11 2014 $
a33 1
.Op Fl Q Ar quick-destdir
a381 9
.It Fl Q Ar quick-destdir
Quick and dirty installation under
.Ar quick-destdir .
Contrary to
.Fl B
.Ar pkg-destdir ,
symbolic links are resolved, and package installation stops at
.Cm @@endfake
marker.
@


1.124
log
@requalify signature -> update signature and explain a bit more.

unconfusing, okay sthen@@
@
text
@d1 1
a1 1
.\"	$OpenBSD: pkg_add.1,v 1.123 2014/02/08 08:54:26 espie Exp $
d18 1
a18 1
.Dd $Mdocdate: February 8 2014 $
a793 11
.Sh CAVEATS
Package extraction does need a temporary area that
can hold executable scripts.
.Pp
If
.Pa /var/tmp
is mounted noexec, you must currently set
.Ev PKG_TMPDIR
to a suitable area, as
.Nm
will refuse to install any package that contains executable scripts.
@


1.123
log
@document -Dunsigned
@
text
@d1 1
a1 1
.\"	$OpenBSD: pkg_add.1,v 1.122 2014/01/22 01:29:33 juanfra Exp $
d18 1
a18 1
.Dd $Mdocdate: January 22 2014 $
d291 1
a291 1
in update mode, reinstall an existing package with the same signature.
d622 3
a624 1
If its signature is identical to that of the new package, no replacement
d706 2
a707 2
The signature of the candidate is compared to the signature of the already
installed package: identical signatures mean no update needed.
@


1.122
log
@Fix the ambigous text in afterboot. For a newbie, the text really
said: "download the packages from a mirror and install these with
pkg_add". Also add a mention to pkg.conf in pkg_add.1.

Help and suggestions from jmc@@ and sthen@@. OK from both.
@
text
@d1 1
a1 1
.\"	$OpenBSD: pkg_add.1,v 1.121 2014/01/17 11:09:36 espie Exp $
d18 1
a18 1
.Dd $Mdocdate: January 17 2014 $
d315 5
@


1.121
log
@tweak documentation to match what's going on
@
text
@d1 1
a1 1
.\"	$OpenBSD: pkg_add.1,v 1.120 2014/01/11 18:34:20 espie Exp $
d18 1
a18 1
.Dd $Mdocdate: January 11 2014 $
d141 1
a141 1
will search for them in each directory named by the
d144 8
@


1.120
log
@typos, from Markus Lude, thx!
@
text
@d1 1
a1 1
.\"	$OpenBSD: pkg_add.1,v 1.119 2014/01/11 13:50:56 sthen Exp $
d301 6
a306 4
we can trust.
Defaults to official packages or firmwares matched to the current
version as reported by
.Xr uname 1 .
@


1.119
log
@remove extraneous D, from Markus Lude
@
text
@d1 1
a1 1
.\"	$OpenBSD: pkg_add.1,v 1.118 2014/01/09 10:51:51 espie Exp $
d18 1
a18 1
.Dd $Mdocdate: January 9 2014 $
d266 1
a266 1
will merge updates together to make sure everything stays in synch.
d302 1
a302 1
Defaults to offical packages or firmwares matched to the current
@


1.118
log
@document SIGNER
@
text
@d1 1
a1 1
.\"	$OpenBSD: pkg_add.1,v 1.117 2014/01/05 10:29:16 espie Exp $
d18 1
a18 1
.Dd $Mdocdate: January 5 2014 $
d278 1
a278 1
.It D Ar FW_UPDATE
@


1.117
log
@document -DFW_UPDATE/@@option firmware
@
text
@d1 1
a1 1
.\"	$OpenBSD: pkg_add.1,v 1.116 2013/04/30 18:33:30 espie Exp $
d18 1
a18 1
.Dd $Mdocdate: April 30 2013 $
d297 8
@


1.116
log
@point people at pkg_check
ok jmc@@
@
text
@d1 1
a1 1
.\"	$OpenBSD: pkg_add.1,v 1.115 2013/02/04 12:07:14 espie Exp $
d18 1
a18 1
.Dd $Mdocdate: February 4 2013 $
d278 4
@


1.115
log
@just noticed that -aa was not documented yet.
@
text
@d1 1
a1 1
.\"	$OpenBSD: pkg_add.1,v 1.114 2012/07/06 12:11:51 espie Exp $
d18 1
a18 1
.Dd $Mdocdate: July 6 2012 $
d84 9
d756 2
a757 1
.Xr pkg.conf 5
@


1.114
log
@a bit of cleanup
- remove description of INSTALL/DEINSTALL scripts, they've been dead
for years.
- explain upfront about interactive mode.
@
text
@d1 1
a1 1
.\"	$OpenBSD: pkg_add.1,v 1.113 2012/07/06 12:02:50 espie Exp $
d228 2
@


1.113
log
@have -i be automatically on for ttys.
use -i/-I to force interactive/non interactive mode
(-I for not running scripts has been dead for years)
@
text
@d1 1
a1 1
.\"	$OpenBSD: pkg_add.1,v 1.112 2012/06/08 15:15:58 espie Exp $
d18 1
a18 1
.Dd $Mdocdate: June 8 2012 $
d150 7
a156 1
In case of ambiguities, for instance:
d158 1
a158 10
(matches screen-4.02  and screen-4.02-static),
.Nm
will error out, unless it is invoked in interactive mode
.Po
default when invoked on a tty, see
option
.Fl I
and
.Fl i
.Pc .
a548 17
If the package contains an
.Ar install
script (deprecated,
.Cm @@exec
is more versatile), it is executed with the following arguments:
.Bl -tag -width indentindent
.It Ar pkg-name
The name of the package being installed.
.It Cm PRE-INSTALL
Keyword denoting that the script is to perform any actions needed before
the package is installed.
.El
.Pp
If the
.Ar install
script exits with a non-zero status code, the installation is terminated.
.It
a551 12
If an
.Ar install
script exists for the package (deprecated),
it is executed with the following arguments:
.Bl -tag -width indentindent
.It Ar pkg_name
The name of the package being installed.
.It Cm POST-INSTALL
Keyword denoting that the script is to perform any actions needed
after the package has been installed.
.El
.It
d553 2
a554 5
such as the packing-list, the
.Ar install
and
.Ar deinstall
scripts, the description file is made into
d717 1
a717 6
option is specified;
value passed to any
.Cm INSTALL
or
.Cm REQUIRE
script invoked from the package.
@


1.112
log
@document pkgpath matching a bit more thoroughly, be more consistent in
naming stuff.
(based on a comment from sthen@@)
@
text
@d1 1
a1 1
.\"	$OpenBSD: pkg_add.1,v 1.111 2011/08/23 10:32:26 espie Exp $
d18 1
a18 1
.Dd $Mdocdate: August 23 2011 $
d27 1
a27 1
.Op Fl acimnqrsUuvxz
d156 1
d158 2
d288 3
d292 1
a292 1
Switch on interactive mode.
@


1.111
log
@zap old INSTALL/DEINSTALL stuff, it's been deprecated for 3 years, and removed
from pkg_create for over a year.
@
text
@d1 1
a1 1
.\"	$OpenBSD: pkg_add.1,v 1.110 2011/08/17 10:48:27 espie Exp $
d18 1
a18 1
.Dd $Mdocdate: August 17 2011 $
d686 8
a693 3
Candidates are then matched according to their source paths (the subdirectory of
the ports dir, plus flavors and multi-packages modifiers), in order to weed
out similar packages with distinct options.
@


1.110
log
@pkg_add and pkg_delete will now syslog activity by default.
@
text
@d1 1
a1 1
.\"	$OpenBSD: pkg_add.1,v 1.109 2011/07/20 14:30:45 espie Exp $
d18 1
a18 1
.Dd $Mdocdate: July 20 2011 $
d27 1
a27 1
.Op Fl acIimnqrsUuvxz
a284 2
.It Fl I
If scripts exist for a given package, do not execute them.
@


1.109
log
@small tidbits
@
text
@d1 1
a1 1
.\"	$OpenBSD: pkg_add.1,v 1.108 2011/07/19 22:25:12 espie Exp $
d18 1
a18 1
.Dd $Mdocdate: July 19 2011 $
d74 9
@


1.108
log
@better text
@
text
@d1 1
a1 1
.\"	$OpenBSD: pkg_add.1,v 1.107 2011/07/12 10:19:54 espie Exp $
d18 1
a18 1
.Dd $Mdocdate: July 12 2011 $
d53 1
a53 1
System distribution files, e.g., base28.tgz, comp28.tgz, are
d165 2
a166 2
is set, every package retrieved from a distant location will also be
copied here.
d308 1
a308 1
.Li pkg_info \*(Gtfile ,
d325 3
@


1.107
log
@write a small blurb about `installed manually'  and how it fits with the other
tools.
@
text
@d1 1
a1 1
.\"	$OpenBSD: pkg_add.1,v 1.106 2011/06/20 09:51:07 espie Exp $
d18 1
a18 1
.Dd $Mdocdate: June 20 2011 $
d445 1
a445 1
such packages will be tagged as
d473 1
a473 1
can be used to remove dependencies no longer needed.
@


1.106
log
@document -Ddonttie, even though I only put it in for performance testing
@
text
@d1 1
a1 1
.\"	$OpenBSD: pkg_add.1,v 1.105 2011/03/19 09:32:36 jmc Exp $
d18 1
a18 1
.Dd $Mdocdate: March 19 2011 $
d441 33
@


1.105
log
@Xr pkg.conf.5; from Patrick Lamaiziere
ok espie
@
text
@d1 1
a1 1
.\"	$OpenBSD: pkg_add.1,v 1.104 2011/02/07 00:02:50 schwarze Exp $
d18 1
a18 1
.Dd $Mdocdate: February 7 2011 $
d248 7
@


1.104
log
@Between groff-1.15 and groff-1.20.1, the .Ns macro was changed to no
longer suppress spacing when used at the beginning of an input line,
and mandoc now follows the same behaviour as new groff.
Thus, sweep the tree and remove useless .Ns.
Most places found by jmc@@; ok jmc@@ kristaps@@.
@
text
@d1 1
a1 1
.\"	$OpenBSD: pkg_add.1,v 1.103 2010/10/28 22:33:43 espie Exp $
d18 1
a18 1
.Dd $Mdocdate: October 28 2010 $
d723 2
a724 1
.Xr package 5
@


1.103
log
@:-P
@
text
@d1 1
a1 1
.\"	$OpenBSD: pkg_add.1,v 1.102 2010/08/01 23:03:48 espie Exp $
d18 1
a18 1
.Dd $Mdocdate: August 1 2010 $
d30 1
a30 4
.Oo Fl D Ar name
.Ns Oo Ns = Ns Ar value
.Oc
.Oc
@


1.102
log
@note specifically that pkg_add -u parameters are *installed* package names,
since that's the distinction with -U....
@
text
@d1 1
a1 1
.\"	$OpenBSD: pkg_add.1,v 1.101 2010/06/09 10:25:17 espie Exp $
d18 1
a18 1
.Dd $Mdocdate: June 9 2010 $
d263 2
a268 2
.It Ar update
unsafe update: old packing-list will run scripts that may fail.
@


1.101
log
@uniform spelling: packing-list
@
text
@d1 1
a1 1
.\"	$OpenBSD: pkg_add.1,v 1.100 2010/06/05 07:11:43 espie Exp $
d18 1
a18 1
.Dd $Mdocdate: June 5 2010 $
d375 1
a375 1
Update the given
@


1.100
log
@document front-end changes
@
text
@d1 1
a1 1
.\"	$OpenBSD: pkg_add.1,v 1.99 2010/05/10 14:14:08 jmc Exp $
d18 1
a18 1
.Dd $Mdocdate: May 10 2010 $
d453 1
a453 1
(the packing list, description, and installation/deinstallation scripts)
d486 1
a486 1
are read from the packing list.
d516 1
a516 1
The packing list is used as a guide for extracting
@


1.99
log
@zap trailing whitespace;
@
text
@d1 1
a1 1
.\"	$OpenBSD: pkg_add.1,v 1.98 2010/05/10 09:12:18 espie Exp $
d27 1
a27 1
.Op Fl acIinqrsUuvxz
d314 4
@


1.98
log
@document that INSTALL/DEINSTALL scripts are dead.
@
text
@d1 1
a1 1
.\"	$OpenBSD$
d18 1
a18 1
.Dd $Mdocdate$
d497 1
a497 1
script (deprecated, 
@


1.97
log
@progress-meter -> progress meter, which is at least consistent with our
other pages;
@
text
@d1 1
a1 1
.\"	$OpenBSD: pkg_add.1,v 1.96 2010/01/26 15:03:39 espie Exp $
d18 1
a18 1
.Dd $Mdocdate: January 26 2010 $
d497 3
a499 1
script, it is executed with the following arguments:
d517 2
a518 1
script exists for the package, it is executed with the following arguments:
@


1.96
log
@downgrade, not downgrades
@
text
@d1 1
a1 1
.\"	$OpenBSD$
d18 1
a18 1
.Dd $Mdocdate$
d406 1
a406 1
Disable progress-meter.
@


1.95
log
@various cleanup, including a fix from Daniel Dickman;
ok espie
@
text
@d1 1
a1 1
.\"	$OpenBSD: pkg_add.1,v 1.94 2010/01/11 09:43:08 bernd Exp $
d18 1
a18 1
.Dd $Mdocdate: January 11 2010 $
d252 1
a252 1
.It Ar downgrades
@


1.94
log
@It's '-D dontmerge' now.
@
text
@d1 1
a1 1
.\"	$OpenBSD: pkg_add.1,v 1.93 2010/01/10 22:44:00 espie Exp $
d18 1
a18 1
.Dd $Mdocdate: January 10 2010 $
d350 1
a350 1
.Fl F Ar update
d358 1
a358 1
.Fl F Ar updatedepends
d560 1
a560 1
is performed (unless -F installed is specified).
d576 2
a577 2
This includes refusing to run any code (unless -F update), and verifying
that the new package still matches dependencies (unless -F updatedepends).
d624 1
a624 1
Version matching occurs: unless -F downgrade, only packages with newer
@


1.93
log
@fix some mdoc tidbits. Thanks to jmc@@ for advice.
@
text
@d1 1
a1 1
.\"	$OpenBSD$
d18 1
a18 1
.Dd $Mdocdate$
d250 1
a250 1
.Fl F Ar dontmerge
@


1.92
log
@unify options a bit: use -Dname=value for defines uniformously (e.g., deprecate
-F keyword heavily).
@
text
@d231 4
a234 1
.It Fl D Ar name Ns = Ns Ar value
a238 3
The
.Op = Ns value
part is actually unnecessary in most cases.
@


1.91
log
@-l no longer implies -z
@
text
@d30 4
a33 1
.Op Fl F Ar keywords
d231 1
a231 1
.It Fl F Ar keywords
d233 2
a234 2
.Ar keywords
is a comma-separated list of keywords that state what failsafes
d236 4
a239 1
These include:
@


1.90
log
@revert the merge flags.
In normal cases, updatedepends should no longer be needed:
pkg_add will merge updates together to make sure depdencies are
always satisfied.
e.g.,

sdlmame-tools-0.130p0->sdlmame-tools-0.132p0 forward dependencies:
| Dependency of sdlmame-0.130p1 on sdlmame-tools-0.130p0 doesn't match
Merging sdlmame-0.130p1->sdlmame-0.132p0
sdlmame-0.130p1+sdlmame-tools-0.130p0->sdlmame-0.132p0+sdlmame-tools-0.132p0: ok
@
text
@d300 3
d304 1
@


1.89
log
@document recent changes, clean up old pkg_delete options
@
text
@d240 6
@


1.88
log
@-U before -u;
@
text
@d1 1
a1 1
.\"	$OpenBSD: pkg_add.1,v 1.87 2009/12/05 23:13:01 espie Exp $
d18 1
a18 1
.Dd $Mdocdate: December 5 2009 $
d27 1
a27 1
.Op Fl acIinqrUuvxz
d345 7
d371 18
@


1.87
log
@a bit more documentation, including revisit of OpenBSD::Intro to reflect
the current state of things.
@
text
@d1 1
a1 1
.\"	$OpenBSD$
d18 1
a18 1
.Dd $Mdocdate$
d27 1
a27 1
.Op Fl acIinqruUvxz
d345 2
a358 2
.It Fl U
Update dependencies if required before installing the new package(s).
@


1.86
log
@fix typos and blanks
@
text
@d27 1
a27 1
.Op Fl acIinqruvxz
d357 2
@


1.85
log
@document more or less what's going on now.
With updatesets, technical details are ways more complicated.
@
text
@d400 1
a400 1
to perform several installation/suppression at once.
d442 1
a442 1
looking first in the current updateset, then in the list of packages 
d519 1
a519 1
A check is made to determine what old package(s) the new package(s) should 
d524 2
a525 2
If they're part of the replacement list, the corresponding updatesets will
be merged.
d529 1
a529 1
update packages.
d548 1
a548 1
The old package are deleted as usual, except that some packages may still 
d554 1
a554 1
The new package are installed as usual, except that the files are already 
d560 2
a561 2
Dependencies from the old packages are adjusted to point to the correct new 
packages.
d583 1
a583 2
Note that
version matching  is cosly, thus
d605 1
a605 1
Once all dependencies are uptodate,
@


1.84
log
@kill some old cruft, in particular -F conflicts has never worked...
@
text
@d392 13
a404 1
extracts each package's
d420 1
a420 1
installation is terminated.
d427 1
a427 1
If it is, installation is terminated.
d442 2
a443 1
looking first in the list of packages to install passed to
d519 11
a529 2
A check is made to determine what old package the new package should replace,
using conflicts.
d531 2
a532 2
A check is made to determine whether the old package will be deleted without
issue, and whether the new package will install correctly.
d537 1
a537 1
package that does no longer exist in the new package, but that is required
d541 1
a541 1
The new package is extracted to the filesystem, using temporary filenames
d544 1
a544 1
since the old package is still there.
d548 2
a549 2
The old package is deleted as usual, except that some packages may still depend
on it.
d554 2
a555 2
The new package is installed as usual, except that the files are already present
and only need to be renamed.
d560 2
a561 1
Dependencies from the old package are adjusted to point to the new package.
a568 3
Packages to update are checked for dependencies, and their dependencies are
marked for update as well, unless -F noclosure.
.It
d574 9
a582 3
Some minimal version matching occurs: out of all p* variations of a given
package, only the most recent package is kept (unless -F allversions
is given).
d584 1
a584 2
.Nm pkg_add
does not try to compare versions in a smarter way, thus
d602 1
a602 1
Once a suitable update candidate has been found for every package,
d604 3
a606 3
proceeds to print out the list of new packages, and then performs the update.
.It
If some updates can't be solved,
d608 1
a608 1
stops before the update, unless -F alwaysupdate.
@


1.83
log
@document -F downgrades (note: for now, it's just the package name, we should
look further at the signature if we can actually compare things)
@
text
@a237 4
.It Ar alwaysupdate
proceed with an update even if
.Nm
can't find new packages for all installed packages.
a239 2
.It Ar conflicts
force installation of package in the presence of conflicts.
a245 4
.It Ar noclosure
do not compute the closure of dependencies to figure out which packages to
update when using
.Fl u .
a250 4
.It Ar pkgpath
with
.Fl u ,
do not check the pkgpath matches if only one candidate is found.
@


1.82
log
@finish zapping old "kitchensink" option, we have much better ways to test
big stuff now.
@
text
@d246 2
@


1.81
log
@tweak previous;
@
text
@d1 1
a1 1
.\"	$OpenBSD: pkg_add.1,v 1.80 2009/10/11 22:08:27 espie Exp $
d18 1
a18 1
.Dd $Mdocdate: October 11 2009 $
a247 3
.It Ar kitchensink
will install everything and the kitchen sink: randomly reorder the list
of packages to install, and proceed after weeding out conflicts.
@


1.80
log
@new mode of operation: fuzzy addition. Allows adding packages even if
you don't know version numbers. Useful for quickly trying to duplicate
an installation on a new machine from the package list as obtained through
pkg_info.

Generally won't give a perfect result, but hey, if you have 300 packages
installed, will get you 95% of the way there.

prompted by problems reported by theo and msf.
@
text
@d1 1
a1 1
.\"	$OpenBSD$
d18 1
a18 1
.Dd $Mdocdate$
d31 1
a32 1
.Op Fl L Ar localbase
a280 12
.It Fl l Ar file
installs packages from the raw output of
.Xr pkg_info 1 ,
as saved in 
.Ar file .
Generally, use with
.Li pkg_info >file ,
to reproduce an installation from machine to machine.
.Fl l
will try its best to reproduce the installation, even if the
version numbers don't quite match and even if some packages cannot
be found.
d301 12
a378 1
.El
d383 1
a383 1
even if the versions don't match and it will proceed even if 
d385 1
@


1.79
log
@document stem--flavor
@
text
@d27 1
a27 1
.Op Fl acIinqruvx
d31 1
d281 12
d380 6
@


1.78
log
@zap trailing whitespace;
@
text
@d1 1
a1 1
.\"	$OpenBSD: pkg_add.1,v 1.77 2009/05/09 11:17:32 sthen Exp $
d18 1
a18 1
.Dd $Mdocdate: May 9 2009 $
d149 12
@


1.77
log
@tell people about -F repair. ok phessler, espie
@
text
@d1 1
a1 1
.\"	$OpenBSD: pkg_add.1,v 1.76 2009/04/14 17:53:58 espie Exp $
d18 1
a18 1
.Dd $Mdocdate: April 14 2009 $
d76 1
a76 1
.It 
d80 1
a80 1
.It 
@


1.76
log
@initial implementation of package signatures, based on x509 certificates and
smime detached signatures.
@
text
@d1 1
a1 1
.\"	$OpenBSD$
d18 1
a18 1
.Dd $Mdocdate$
d253 2
@


1.75
log
@Xr OpenBSD::Intro(3p)
@
text
@d74 20
d246 3
@


1.74
log
@remove trailing whitespace;
@
text
@d1 1
a1 1
.\"	$OpenBSD: pkg_add.1,v 1.73 2008/07/04 10:47:13 espie Exp $
d18 1
a18 1
.Dd $Mdocdate: July 4 2008 $
d609 1
@


1.73
log
@clean up parser a bit, separating local/distant parts in a more reusable way,
and simplify file: parsing scheme (trying it with file:, then without is
a bit stupid once we have the pieces to put it back together directly).
Drop the restriction on urls from the man page, no need to finish stuff with /.
@
text
@d1 1
a1 1
.\"	$OpenBSD$
d18 1
a18 1
.Dd $Mdocdate$
d283 1
a283 1
Replace package quickly; do not bother with checksums before removing normal 
@


1.72
log
@tweak previous;
@
text
@d1 1
a1 1
.\"	$OpenBSD: pkg_add.1,v 1.71 2008/03/08 11:48:01 espie Exp $
d18 1
a18 1
.Dd $Mdocdate: March 8 2008 $
a104 3
Since a few URL schemes contain colons,
.Nm
relies on each directory ending in a / to split the path correctly.
d594 1
a594 1
Each entry consists of a directory name, ending in a slash.
@


1.71
log
@better -q: mention once, and it speeds up (assumes normal files haven't
changed), but still checks config files. Use twice, and wipe your config
out as well.
@
text
@d1 1
a1 1
.\"	$OpenBSD$
d18 1
a18 1
.Dd $Mdocdate$
d288 2
a289 1
If used twice, it will not bother with checksums either for configuration files.
@


1.70
log
@tweak messages mentioning checksums so that they mention checksums, not
specifics like md5, since that's likely to change.
@
text
@d286 3
a288 1
Replace package quickly; do not bother with checksums before removing files.
@


1.69
log
@replace reference to deprecated @@pkgcfl keyword by @@conflict

ok espie@@
@
text
@d1 1
a1 1
.\"	$OpenBSD: pkg_add.1,v 1.68 2007/11/05 13:09:13 jmc Exp $
d18 1
a18 1
.Dd $Mdocdate: November 5 2007 $
d286 1
a286 1
Replace package quickly; do not bother checking MD5s before removing files.
@


1.68
log
@document Ev FTP_KEEPALIVE;
from giovanni, tweaked by espie and myself
@
text
@d1 1
a1 1
.\"	$OpenBSD: pkg_add.1,v 1.67 2007/06/20 15:41:36 steven Exp $
d18 1
a18 1
.Dd $Mdocdate: June 17 2007 $
d370 1
a370 1
.Cm @@pkgcfl
@


1.67
log
@mention https protocol, for which support was added recently.

ok espie@@
@
text
@d1 1
a1 1
.\"	$OpenBSD: pkg_add.1,v 1.66 2007/06/17 10:35:55 espie Exp $
d561 10
@


1.66
log
@document @@exec/@@unexec variations in more detail.
Point users at pkg_create for packing-list details (suggested by
ajacoutot@@)
@
text
@d1 1
a1 1
.\"	$OpenBSD: pkg_add.1,v 1.65 2007/05/31 19:20:26 jmc Exp $
d18 1
a18 1
.Dd $Mdocdate: May 31 2007 $
d94 1
a94 1
suffix) or a URL referring to FTP, HTTP, or SCP locations.
d585 1
a585 1
URL schemes such as FTP, HTTP, or SCP are also appropriate.
@


1.65
log
@convert to new .Dd format;
@
text
@d1 1
a1 1
.\"	$OpenBSD: pkg_add.1,v 1.64 2007/05/31 11:05:41 espie Exp $
d18 1
a18 1
.Dd $Mdocdate$
d71 3
d487 3
d493 3
@


1.64
log
@kill REQ script directly. I'm pretty sure it doesn't quite work anyways.
Deprecate INSTALL and DEINSTALL, write out warnings in pkg_create.

Clean up some more old cruft
@
text
@d1 1
a1 1
.\"	$OpenBSD: pkg_add.1,v 1.63 2007/05/07 08:14:51 espie Exp $
d18 1
a18 1
.Dd November 25, 1994
@


1.63
log
@remove -Fboguslibs, we haven't had unmarked libraries for years
@
text
@d1 1
a1 1
.\"	$OpenBSD: pkg_add.1,v 1.62 2007/04/15 10:17:29 espie Exp $
a393 18
.It
If the package contains a
.Ar require
script (see
.Xr pkg_create 1 ) ,
it is executed with the following arguments:
.Bl -tag -width indentindent
.It Ar pkg-name
The name of the package being installed
.It Cm INSTALL
Keyword denoting to the script that it is to run an installation requirements
check
(the keyword is useful only to scripts which serve multiple functions).
.El
.Pp
If the
.Ar require
script exits with a non-zero status code, the installation is terminated.
@


1.62
log
@update copyright years, standardize licence.
reword the introduction to the stuff originally from FreeBSD to clarify
slightly.
@
text
@d1 1
a1 1
.\"	$OpenBSD: pkg_add.1,v 1.61 2006/10/17 21:47:22 espie Exp $
a210 3
.It Ar boguslibs
not all shared libraries are marked with @@lib.
Inefficiently rescan package lists for non marked libraries.
@


1.61
log
@add -F conflicts: force installation in the presence of registered conflicts,
provided nothing else happens (like, huh, the presence of actual conflicts
between files).

Allows nikolay@@ to work with redhat/base and fedora_core at the same time.
@
text
@d1 1
a1 1
.\"	$OpenBSD: pkg_add.1,v 1.60 2006/03/07 11:03:17 espie Exp $
d3 2
a4 2
.\" FreeBSD install - a package for the installation and maintenance
.\" of non-core utilities.
a16 2
.\"
.\"     @@(#)pkg_add.1
@


1.60
log
@let scp repositories work. Avoid run-away processes by just having one single
ssh connection for each repository.
@
text
@d1 1
a1 1
.\"	$OpenBSD: pkg_add.1,v 1.59 2006/03/05 09:02:36 jmc Exp $
d216 2
@


1.59
log
@- kill whitespace at eol
- kill double .Pp
@
text
@d1 1
a1 1
.\"	$OpenBSD: pkg_add.1,v 1.58 2006/03/04 13:00:43 espie Exp $
a630 6
.Sh BUGS
.Xr scp 1
processes do not die like they should when their pipe is closed,
so using
.Nm
over SCP consumes an insane amount of resources.
@


1.58
log
@accurate description of script execution.
@
text
@d1 1
a1 1
.\"	$OpenBSD: pkg_add.1,v 1.57 2006/03/04 11:56:57 espie Exp $
d63 1
a63 1
.Po 
d68 1
a68 1
.Po 
d123 1
a123 1
.Li pkg_add screen 
d142 1
a142 1
user's opinion in interactive mode, 
a622 1
.Pp
@


1.57
log
@Spell out normal modes of operation for pkg_add more.
Explain about ambiguities, and expand a bit on interactive mode.
@
text
@d1 1
a1 1
.\"	$OpenBSD: pkg_add.1,v 1.56 2006/01/06 13:00:07 jmc Exp $
a623 9
.Nm
looks through
.Ev ${PKG_TMPDIR} ,
.Ev ${TMPDIR} ,
.Pa /var/tmp ,
.Pa /tmp ,
and
.Pa /usr/tmp
for such an area, in sequence.
a625 2
.Ev ${TMPDIR}
and
d627 1
a627 1
are mounted noexec, you must currently set
d631 1
a631 2
does not check for noexec status except by failing to run installation
scripts.
@


1.56
log
@tweak the descriptions of -r and -u: make the distinction
between them a little clearer;

ok espie
@
text
@d1 1
a1 1
.\"	$OpenBSD: pkg_add.1,v 1.55 2005/11/05 10:27:33 sturm Exp $
d60 30
d113 19
d141 3
a143 2
dependencies with the list of packages left to install, then
install default packages that satisfy the dependencies.
d568 5
@


1.55
log
@-F conflicts does not really exist, so don't document it

ok espie@@
@
text
@d1 1
a1 1
.\"	$OpenBSD: pkg_add.1,v 1.54 2005/10/10 09:38:29 espie Exp $
d238 3
a240 2
Allow replacing existing packages.
The code will try to take every precaution to make sure the update can
d245 1
a245 1
will refuse to update packages as soon as it needs to run scripts that
d250 1
a250 1
to force the update
d253 1
a253 1
will also refuse to update packages when the dependencies don't quite
d258 1
a258 1
to force the update
d264 1
a264 1
With this option, if no
@


1.54
log
@Xref package(5)
@
text
@d1 1
a1 1
.\"	$OpenBSD: pkg_add.1,v 1.53 2005/10/02 20:46:23 espie Exp $
a165 2
.It Ar conflicts
package may conflict with other packages.
@


1.53
log
@pkg_add -u does updates.
noticed by brad@@
@
text
@d1 1
a1 1
.\"	$OpenBSD: pkg_add.1,v 1.52 2005/09/17 21:49:40 jmc Exp $
d557 2
a558 1
.Xr bsd.port.mk 5
@


1.52
log
@kill trailing space;
uppercase some abbreviations;
@
text
@d1 1
a1 1
.\"	$OpenBSD: pkg_add.1,v 1.51 2005/09/17 11:14:03 espie Exp $
d262 3
a264 2
Display the name of packages to use for an update of the given
.Ar pkgname(s) .
d269 1
a269 1
will display update names for all installed packages.
a272 4
After
.Ox 3.8
rolls out and enough tests are conducted, this will become a true update
switch and will proceed with the update proper.
@


1.51
log
@Document the process for pkg_add -u.
@
text
@d1 1
a1 1
.\"	$OpenBSD: pkg_add.1,v 1.50 2005/09/17 09:47:32 espie Exp $
d74 1
a74 1
Since a few url schemes contain colons,
d454 1
a454 1
The packing-list is amended to record these names as @@temp annotations, 
d457 1
a457 1
The old package is deleted as usual, except that some packages may still depend 
d488 1
a488 1
similar to the organization on the ftp sites.
d546 1
a546 1
URL schemes such as ftp, http, or scp are also appropriate.
@


1.50
log
@write down explicitly that directory names in PKG_PATH should end with a /,
since pkg_add will have trouble splitting the path correctly in the presence
of weird url schemes otherwise.
@
text
@d1 1
a1 1
.\"	$OpenBSD: pkg_add.1,v 1.49 2005/09/17 09:16:21 espie Exp $
d443 1
a443 1
that the new package still matches dependencies.
d460 1
a460 1
The new package is installed as usal, except that files are already present
d464 45
@


1.49
log
@Document PKG_CACHE.
Document a few more -F toggles.
Explain in more details what happens during pkg_add -r.
@
text
@d1 1
a1 1
.\"	$OpenBSD: pkg_add.1,v 1.48 2005/09/07 09:11:22 jmc Exp $
d74 3
d500 2
a501 1
Each entry consists of a directory name.
d505 1
a505 1
.Pq Ql \&. .
@


1.48
log
@sort options, and sync usage();
@
text
@d1 1
a1 1
.\"	$OpenBSD: pkg_add.1,v 1.47 2005/09/04 22:47:56 espie Exp $
d80 5
d152 6
d423 2
a424 1
as it will safely record an interrupted install as
d426 36
d488 3
@


1.47
log
@* New -i interactive option, that can ask obnoxious questions.
* move the signature code to a packing-list method, prepend the pkgname.
* depend on distant listings, cache these systematically.
* cut the PKG_PATH at :/ systematically, much simpler than parsing URLs.
People should get used to trailing /s.
* let pkg_add -u actually run the update.
* check for signature in more places, for instance, let pkg_add installed_stuff
be a void operation.
* grab enough stuff during updates to check signatures, so that pkg_add -u
can report updates that are not needed right away, instead of waiting
for the more confusing `trying to update'
* beginning of @@module support.
* @@pkgpath support, including updates.
* systematically expand stems when applicable.
* use visitors systematically in pkg_info.
* pkg_info -S reports signature.
* remove hardcoding of categories in PackingList, so that future modules
will be able to expand them.
* add @@updateset and @@incompatibility keywords.
@
text
@d1 1
a1 1
.\"	$OpenBSD: pkg_add.1,v 1.46 2005/08/17 19:22:31 espie Exp $
d29 1
a29 1
.Op Fl aciInqruvx
d178 2
a183 2
.It Fl I
If scripts exist for a given package, do not execute them.
@


1.46
log
@drop paragraph about ftp-proxy.

jmc@@ insisted... and yeah, it's a bit confusing.
@
text
@d1 1
a1 1
.\"	$OpenBSD: pkg_add.1,v 1.45 2005/08/17 10:03:17 espie Exp $
d29 1
a29 1
.Op Fl acInqruvx
d178 4
@


1.45
log
@ftp-proxy misbehavior is of the past.
@
text
@d1 1
a1 1
.\"	$OpenBSD: pkg_add.1,v 1.44 2005/08/16 14:13:42 jmc Exp $
a493 10
.Pp
Using
.Nm
over FTP requires that the distant host supports
.Cm ABORT
commands, otherwise it may hang for long periods.
.Xr ftp-proxy 8
used to not forward
.Cm ABORT
requests correctly.
@


1.44
log
@remove trailing space;
@
text
@d1 1
a1 1
.\"	$OpenBSD: pkg_add.1,v 1.43 2005/08/16 12:20:21 espie Exp $
d501 1
a501 1
currently does not forward
@


1.43
log
@update dependency explanation, noticed by Gerardo Santana.
@
text
@d1 1
a1 1
.\"	$OpenBSD: pkg_add.1,v 1.42 2005/08/16 12:05:58 espie Exp $
d229 1
a229 1
might fail 
d256 1
a256 1
rolls out and enough tests are conducted, this will become a true update 
@


1.42
log
@when you ask to update a package, you generally want to update its
dependencies as well...

so do the stem -> pkgname conversion early, and then compute the
closure of dependencies on the list of packages we asked for.
@
text
@d1 1
a1 1
.\"	$OpenBSD: pkg_add.1,v 1.41 2005/08/16 10:37:06 espie Exp $
d317 1
a317 2
.Cm @@pkgdep ,
.Cm @@libdepend ,
d319 1
a319 1
.Cm @@newdepend
@


1.41
log
@document the current state of pkg_add -u
@
text
@d1 1
a1 1
.\"	$OpenBSD: pkg_add.1,v 1.40 2005/08/16 10:01:16 espie Exp $
d161 4
@


1.40
log
@be more specific about `every precaution' in pkg_add, so that people won't
be scared about -F update.
Document the nasty issues I've encountered with FTP.
@
text
@d1 1
a1 1
.\"	$OpenBSD: pkg_add.1,v 1.39 2005/08/13 06:41:55 jmc Exp $
d29 1
a29 1
.Op Fl acInqrvx
d163 4
d239 15
@


1.39
log
@minor tweaks for BUGS;
ok espie@@
@
text
@d1 1
a1 1
.\"	$OpenBSD: pkg_add.1,v 1.38 2005/08/12 18:00:33 espie Exp $
d218 17
d472 10
@


1.38
log
@pkg_add -r does work.
on the other hand, scp(1) is a pig.
@
text
@d1 1
a1 1
.\"	$OpenBSD: pkg_add.1,v 1.37 2005/04/09 21:36:57 jmc Exp $
d452 1
a452 1
and so using
d454 1
a454 1
over scp consumes an insane amount of resources.
@


1.37
log
@`an URL' -> `a URL';
@
text
@d1 1
a1 1
.\"	$OpenBSD: pkg_add.1,v 1.36 2005/04/09 21:35:35 jmc Exp $
d450 5
a454 3
The
.Fl r
option has not seen wide-testing yet and is almost certainly full of bugs.
@


1.36
log
@add scp example;

from olivier cherrier;
ok espie@@
@
text
@d1 1
a1 1
.\"	$OpenBSD: pkg_add.1,v 1.35 2005/03/26 02:14:36 pvalchev Exp $
d63 1
a63 1
suffix) or an URL referring to FTP, HTTP, or SCP locations.
@


1.35
log
@start sentence with capital letter
@
text
@d1 1
a1 1
.\"	$OpenBSD: pkg_add.1,v 1.34 2005/03/25 22:33:40 espie Exp $
d64 1
a64 1
For example, the following is valid:
d67 1
@


1.34
log
@all hail Theo and do as He wishes.
@
text
@d1 1
a1 1
.\"	$OpenBSD: pkg_add.1,v 1.33 2005/01/03 13:01:27 jmc Exp $
d214 1
a214 1
the code will try to take every precaution to make sure the update can
@


1.33
log
@- use .Bk/.Ek to keep SYNOPSIS tidy
- `-F keyword' -> `-F keywords' in SYNOPSIS for consistency
@
text
@d1 1
a1 1
.\"	$OpenBSD: pkg_add.1,v 1.32 2005/01/03 01:02:45 espie Exp $
a213 1
This is an experimental option for now:
a216 2
But this functionality has seen very little testing yet, and since it is
rather powerful, it can break a system in a thorough way.
@


1.32
log
@rename -f -> -F
okay pvalchev@@, naddy@@, marco@@, deraadt@@

(keep -f around for the transition, will scrap it soon)
@
text
@d1 1
a1 1
.\"	$OpenBSD: pkg_add.1,v 1.31 2004/12/28 14:50:38 espie Exp $
d28 1
d32 1
a32 1
.Op Fl F Ar keyword
d37 1
@


1.31
log
@add a boguslibs forced option, that rescans packages for libraries
not marked with @@lib.

This allows pkg_add -current to deal with 3.6 packages fully.
@
text
@d1 1
a1 1
.\"	$OpenBSD: pkg_add.1,v 1.30 2004/12/26 15:01:06 espie Exp $
d31 1
a31 1
.Op Fl f Ar keys
d136 1
a136 1
.It Fl f Ar keys
d138 1
a138 1
.Ar keys
@


1.30
log
@simplify BUGS message, especially since it is not accurate any longer.
@
text
@d1 1
a1 1
.\"	$OpenBSD: pkg_add.1,v 1.29 2004/12/18 14:13:33 espie Exp $
d146 3
@


1.29
log
@document kitchensink option
@
text
@d1 1
a1 1
.\"	$OpenBSD: pkg_add.1,v 1.28 2004/12/16 11:07:33 espie Exp $
a449 8
In particular, failure modes are untested, and a large number of code paths
have not seen actual use yet.
This option only handles atomic updates of single packages, there is no code
to replace multiple packages with another set of equivalent multiple packages.
For instance, since this option will often replace a package with
a newer package by creating an extra stub package for older shared libraries,
reversing the effect of pkg_add -r without wiping out most installed packages
will be impossible.
@


1.28
log
@renamed borked_installation from borked.n to partial-<pkgname> ...
partial-<pkgname>.n if needed.

Make borked_installation take a message, to show installation/deinstallation
issues correctly.

Fix handling of ^C: this may lead some system calls to return early, thus
registering as errors: so always mark the last file as done, so that borked
installation will register it correctly.

Kill packing-list cache for anything but depends: we've got a global cache
of libraries now (use it in pkg_add).

Make almost everyone look at $main::not, so that we can call
register_installation
to_installation
RequirementList->add/delete
safely.

Simplify $not logic accordingly, do thing much more closely to what would
happen without -n.

This should allow pkg_add/pkg_delete -n to handle most nasty cases correctly
now, since all the relevant information is kept internally in a compact
format:
- register of shared libraries
- global register of conflicts
- cache of depends.
@
text
@d1 1
a1 1
.\"	$OpenBSD: pkg_add.1,v 1.27 2004/12/09 18:58:25 espie Exp $
d150 3
@


1.27
log
@make -f scripts work again, and document it properly in both pkg_add and
pkg_delete since it now works for both.
@
text
@d1 1
a1 1
.\"	$OpenBSD: pkg_add.1,v 1.26 2004/11/21 11:29:35 xsa Exp $
d364 1
a364 1
.Pa borked.n .
@


1.26
log
@remove .Xr's that do not belong here anymore with the new pkg_* tools;
espie@@ ok.
@
text
@d1 1
a1 1
.\"	$OpenBSD: pkg_add.1,v 1.25 2004/11/15 13:20:40 jmc Exp $
d149 1
a149 1
reinstall an existing package.
d155 1
a155 1
install scripts may fail.
@


1.25
log
@tweaks;
ok espie@@
@
text
@d1 1
a1 1
.\"	$OpenBSD: pkg_add.1,v 1.24 2004/11/15 10:21:40 jmc Exp $
a410 2
.Xr mkdtemp 3 ,
.Xr sysconf 3 ,
@


1.24
log
@sort options, and some whitespace issues;
ok espie@@
@
text
@d1 1
a1 1
.\"	$OpenBSD: pkg_add.1,v 1.23 2004/11/14 12:04:19 espie Exp $
d52 1
a52 1
System distribution files, e.g. base28.tgz, comp28.tgz, etc., are
d55 1
a55 1
.Nm pkg_add .
d64 1
a64 1
.Ic pkg_add -v ftp://ftp.openbsd.org/pub/OpenBSD/2.7/packages/i386/m4-1.4.tgz
d84 3
a86 2
Alternatively, it is possible to add packages interactively from within
the ftp client,
d126 1
a126 1
Automated package installation, do not record packages as installed manually.
d196 1
a196 1
Contrarily to
d203 1
a203 1
Replace package quickly, do not bother checking md5s before removing files.
d229 1
a229 1
.Qq active .
d234 1
a234 1
passive mode ftp correctly.
d237 1
a237 1
will try active mode ftp if the server refuses a passive mode
d248 3
a250 1
if set - see CAVEATS section)
d261 1
a261 1
directives, see
d275 1
a275 1
directives, see
d367 10
d407 1
d412 2
a413 1
.Xr sysconf 3
d431 1
d451 1
a451 1
This options only handles atomic updates of single packages, there is no code
@


1.23
log
@don't try to tell exactly what gets copied into /var/db/pkg, since this
changes over time.
@
text
@d1 1
a1 1
.\"	$OpenBSD: pkg_add.1,v 1.22 2004/11/14 11:58:43 espie Exp $
d28 1
a28 1
.Op Fl acqInrvx
a30 1
.Op Fl Q Ar quick-destdir
d34 1
d91 16
a106 16
.Bd -literal
	$ ftp ftp://ftp.openbsd.org/pub/OpenBSD/2.7/packages/i386/
	250 CWD command successful
	ftp> ls m*
	227 Entering Passive Mode (129,128,5,191,164,73)
	150 Opening ASCII mode data connection for m*.
	m4-1.4.tgz
	metamail-2.7.tgz
	mh-6.8.4.tgz
	mm-1.0.12.tgz
	mpeg_lib-1.2.1.tgz
	mpeg_play-2.4.tgz
	mpg123-0.59q.tgz
	mutt-0.95.7i.tgz
	226 Transfer complete.
	ftp> get m4-1.4.tgz "|pkg_add -v -"
a119 29
.It Fl a
Automated package installation, do not record packages as installed manually.
.It Fl c
While replacing packages, delete extra configuration file in the old package, 
mentioned as
.Dl @@extra file
in the packing-list.
.It Fl I
If scripts exist for a given package, do not execute them.
.It Fl n
Don't actually install a package, just report the steps that
would be taken if it was.
.It Fl q
Replace package quickly, do not bother checking md5s before removing files.
.It Fl r
Allow replacing existing packages.
This is an experimental option for now:
the code will try to take every precaution to make sure the update can
proceed before removing the old package and adding the new one, and it
should also handle shared libraries correctly.
But this functionality has seen very little testing yet, and since it is
rather powerful, it can break a system in a thorough way.
.It Fl v
Turn on verbose output.
Several
.Fl v
turn on more verbose output.
.It Fl x
Disable progress-meter.
d124 2
d130 5
a134 9
.It Fl Q Ar quick-destdir
Quick and dirty installation under
.Ar quick-destdir .
Contrarily to
.Fl B 
.Ar pkg-destdir ,
symbolic links are resolved, and package installation stops at
.Cm @@endfake
marker.
d139 1
a139 1
should be waived. 
d141 2
a142 1
.Bl -tag -width keyword
d160 2
d171 1
a171 1
.Ar localbase 
d176 1
a176 1
and those packages can only be installed by using the same 
d182 3
d192 26
a363 11
.It Ev PKG_PATH
If a given package name cannot be found,
the directories named by
.Ev PKG_PATH
are searched.
It should contain a series of entries separated by colons.
Each entry consists of a directory name.
The current directory may be indicated
implicitly by an empty directory name, or explicitly by a single
period
.Pq Ql \&. .
d378 11
a405 12
.Sh BUGS
The
.Fl r
option has not seen wide-testing yet and is almost certainly full of bugs.
In particular, failure modes are untested, and a large number of code paths
have not seen actual use yet.
This options only handles atomic updates of single packages, there is no code
to replace multiple packages with another set of equivalent multiple packages.
For instance, since this option will often replace a package with 
a newer package by creating an extra stub package for older shared libraries, 
reversing the effect of pkg_add -r without wiping out most installed packages
will be impossible.
d429 12
@


1.22
log
@turn on progress meter by default, use -x to disable it.
document the new stuff, partial reorder of options.
@
text
@d1 1
a1 1
.\"	$OpenBSD: pkg_add.1,v 1.21 2004/11/11 12:15:28 espie Exp $
d332 4
a335 1
After installation is complete, a copy of the packing list,
d337 1
a337 1
script, description, and display files are copied into
d340 3
a342 1
.Xr pkg_delete 1 .
@


1.21
log
@restrict update operation less: we're not bothered by @@exec or INSTALL,
only DEINSTALL or @@unexec (we should need to run symetric checks on
the package we're going to install, though...)

allows forced replacement: script running, and breaking forward dependencies.

Communicate more about what may break.
@
text
@d1 1
a1 1
.\"	$OpenBSD: pkg_add.1,v 1.20 2004/11/07 13:47:12 espie Exp $
d28 1
a28 1
.Op Fl aInrv
d122 5
a126 2
.It Fl v
Turn on verbose output.
d132 2
d142 7
@


1.20
log
@document the current behavior of pkg_add -r.
Clearly marks this as an experimental option that can thoroughly mangle
your system.
@
text
@d1 1
a1 1
.\"	$OpenBSD: pkg_add.1,v 1.19 2004/10/18 14:37:20 espie Exp $
d173 4
@


1.19
log
@Documents @@endfake and -Q semantics.
@
text
@d1 1
a1 1
.\"	$OpenBSD: pkg_add.1,v 1.18 2004/10/11 13:10:25 espie Exp $
d28 1
a28 1
.Op Fl aInv
d129 8
d384 12
@


1.18
log
@common code for all script running.
Common option for not running scripts: -I for both pkg_add and pkg_delete.
@
text
@d1 1
a1 1
.\"	$OpenBSD: pkg_add.1,v 1.17 2004/10/11 10:07:37 espie Exp $
d31 1
d137 9
@


1.17
log
@kill old MTREE option that was never implemented in the new tools anyways.
kill -C and -P options which are definitely no longer used as well.
Reorder special files so that REQUIRE is at front (and it's executed first
anyways).
@
text
@d1 1
a1 1
.\"	$OpenBSD: pkg_add.1,v 1.16 2004/09/18 13:28:19 espie Exp $
d124 1
a124 1
If an installation script exists for a given package, do not execute it.
@


1.16
log
@framework to be able to distinguish packages installed manually (and thus
wanted by the user) from packages installed automatically to satisfy a
dependency.
@
text
@d1 1
a1 1
.\"	$OpenBSD: pkg_add.1,v 1.15 2004/09/14 22:58:30 espie Exp $
d358 1
a358 2
.Xr sysconf 3 ,
.Xr mtree 8
@


1.15
log
@better wording for documentation.
use System more or less everywhere.
prepare to delete info directories properly.
@
text
@d1 1
a1 1
.\"	$OpenBSD: pkg_add.1,v 1.14 2004/08/25 22:34:27 jmc Exp $
d28 1
a28 1
.Op Fl Inv
d119 2
@


1.14
log
@typos from -f (PR #3908);
@
text
@d1 1
a1 1
.\"	$OpenBSD: pkg_add.1,v 1.13 2004/03/07 19:29:08 espie Exp $
d223 1
a223 1
with an already recorded as installed package.
@


1.13
log
@A few useful features:
- pkg_add -A arch, to make believe we are extracting on a given arch
(matches pkg_create).
- pkg_add -P cdrom/-P ftp, to enforce extracting only cdrom'able packages
or ftp'able packages. Helps a lot for checking cdrom lists.
- dependency look-up will look through local directory listings to solve
dependencies, so that non-default dependencies will work more seemlessly.
(doing the same thing for distant repository will happen after 3.5, but
this requires more apparatus: caching package lists, and killing/restoring
existing connections, plus more error handling).

okay pval
@
text
@d1 1
a1 1
.\"	$OpenBSD: pkg_add.1,v 1.12 2004/02/20 19:13:51 espie Exp $
d148 1
a148 1
library specifications may not be fullfilled.
d238 1
a238 1
If any of these dependencies are not currently fullfilled,
@


1.12
log
@PKG_DESTDIR / -B support in pkg_add.
@
text
@d1 1
a1 1
.\"	$OpenBSD: pkg_add.1,v 1.11 2004/01/28 22:12:01 espie Exp $
d29 1
d33 1
d126 4
d174 7
@


1.11
log
@Add -L to record/enforce localbase.
Okay sturm@@
@
text
@d1 1
a1 1
.\"	$OpenBSD: pkg_add.1,v 1.10 2004/01/27 14:50:52 espie Exp $
d29 1
d124 4
d308 1
a308 1
.Bl -tag -width PKG_TMPDIR
d323 11
@


1.10
log
@first series of -forced switches, looks okay to henning@@.
@
text
@d1 1
a1 1
.\"	$OpenBSD: pkg_add.1,v 1.9 2004/01/27 13:50:55 espie Exp $
d30 1
d143 20
@


1.9
log
@bullet lists of one item don't make much sense.
@
text
@d1 1
a1 1
.\"	$OpenBSD: pkg_add.1,v 1.8 2004/01/27 13:09:16 espie Exp $
d126 16
a141 1
should be waived.
@


1.8
log
@-f framework, manpage fixes.
comments and okay jmc@@
@
text
@d1 1
a1 1
.\"	$OpenBSD: pkg_add.1,v 1.7 2004/01/22 21:11:43 espie Exp $
a301 2
.Bl -bullet -compact
.It
a302 1
.El
@


1.7
log
@document/activate @@arch. Fix list handling.
@
text
@d1 1
a1 1
.\"	$OpenBSD: pkg_add.1,v 1.6 2003/11/14 23:18:50 espie Exp $
d28 2
a29 1
.Op Fl vIn
d34 1
a34 1
command is used to extract packages that have been previously created
a44 2
These packages are provided as a convenience for quickly installing software
that would otherwise need to be built manually.
d72 7
d114 1
a114 1
.Bl -tag -width Ds
d122 5
d172 1
a172 1
For packages tagged with architecture constraints, 
d185 3
a187 1
an attempt is made to find a package that meets them and install it;
d191 4
d260 6
d308 6
a313 1
looks through ${PKG_TMPDIR}, ${TMPDIR}, /var/tmp, /tmp, /usr/tmp
d316 6
a321 1
If ${TMPDIR} and /var/tmp are mounted noexec, you must set PKG_TMPDIR
d324 1
a324 1
has no way to check for noexec status except by failing to run installation
@


1.6
log
@finicky, finicky...
@
text
@d1 1
a1 1
.\"	$OpenBSD: pkg_add.1,v 1.5 2003/11/14 23:03:55 espie Exp $
d160 4
@


1.5
log
@synch doc with reality
@
text
@d1 1
a1 1
.\"	$OpenBSD: pkg_add.1,v 1.4 2003/11/08 19:17:29 jmc Exp $
d28 1
a28 1
.Op Fl vInfRMS
d256 1
a256 1
Temporary area where packages will be extracted, instead of
@


1.4
log
@typos from Jonathon Gray;
@
text
@d1 1
a1 1
.\"	$OpenBSD: pkg_add.1,v 1.3 2003/11/06 18:20:04 espie Exp $
a28 2
.Op Fl t Ar template
.Op Fl p Ar prefix
d54 1
a54 1
Package names may be specified as filenames (which normally consist of the
d56 2
a57 5
.Dq .tgz ,
.Dq .tar.gz ,
or
.Dq .tar
suffix) or URL referring to FTP, HTTP, or SCP locations.
a238 15
The
.Ar install
and
.Ar require
scripts are called with the environment variable
.Ev PKG_PREFIX
set to the installation prefix (see the
.Fl p
option above).
This allows a package author to write a script
that reliably performs some action on the directory where the package
is installed, even if the user might change it with the
.Fl p
flag to
.Cm pkg_add .
@


1.3
log
@Tell people to set PKG_PATH for pkg_add - to handle dependencies.
@
text
@d1 1
a1 1
.\"	$OpenBSD: pkg_add.1,v 1.2 2003/10/26 10:33:24 espie Exp $
d62 1
a62 1
suffix) or URL refering to FTP, HTTP, or SCP locations.
@


1.2
log
@Partial synch with reality, ok sturm.
@
text
@d1 1
a1 1
.\"	$OpenBSD: pkg_add.1,v 1.1 2003/10/19 18:38:06 espie Exp $
d79 5
a83 1
the ftp client.
@


1.1
log
@Add manpages, with a few minor changes from old ones.
ok pval
@
text
@d1 1
a1 1
.\"	$OpenBSD: pkg_add.1,v 1.32 2003/07/14 13:38:24 jmc Exp $
d62 1
a62 1
suffix) or an FTP location in the form of an URL.
a116 95
.It Fl R
Do not record the installation of a package.
This means that you cannot deinstall it later, so only use this option if
you know what you are doing!
.It Fl f
Force installation to proceed even if prerequisite packages are not
installed or the requirements script fails.
Although
.Nm
will still try to find and auto-install missing prerequisite packages,
a failure to find one will not be fatal.
.It Fl p Ar prefix
Set
.Ar prefix
as the directory in which to extract files from a package.
If a package has set its default directory, it will be overridden
by this flag.
Note that only the first
.Cm @@cwd
directive will be replaced, since
.Nm
has no way of knowing which directory settings are relative and
which are absolute.
It is rare in any case to see more than one
directory transition made, but when such does happen and you wish
to have control over
.Em all
directory transitions, then you may then wish to look into the use of
.Cm MASTER
and
.Cm SLAVE
modes (see the
.Fl M
and
.Fl S
options).
.It Fl t Ar template
Use
.Ar template
as the input to
.Xr mkdtemp 3
when creating a
.Dq staging area .
By default, this is the string
.Pa /var/tmp/instmp.XXXXXX ,
but it may be necessary to override it (see CAVEATS).
Be sure to leave some number of
.Dq X
characters for
.Xr mkdtemp 3
to fill in with a unique ID.
.Pp
You can get a performance boost by setting the staging area
.Ar template
to reside on the same disk partition as target directories for package
file installation; often this is
.Pa /usr .
.It Fl M
Run in
.Cm MASTER
mode.
This is a very specialized mode for running
.Nm
and is meant to be run in conjunction with
.Cm SLAVE
mode.
When run in this mode,
.Nm
does no work beyond extracting the package into a temporary staging
area (see the
.Fl t
option), reading in the packing list, and then dumping it (prefaced by
the current staging area) to the standard output where it may be filtered by a
program such as
.Xr sed 1 .
When used in conjunction with
.Cm SLAVE
mode, it allows you to make radical changes to the package structure
before acting on its contents.
.It Fl S
Run in
.Cm SLAVE
mode.
This is a very specialized mode for running
.Nm
and is meant to be run in conjunction with
.Cm MASTER
mode.
When run in this mode,
.Nm
expects the release contents to be already extracted and waiting
in the staging area, the location of which is read as a string
from the standard input.
The complete packing list is also read from stdin,
and the contents then acted on as normal.
d140 2
a141 1
.Dq packing list
d163 4
a166 1
.Cm @@pkgdep
d170 3
a172 3
If any of these required packages are not currently installed,
an attempt is made to find and install it;
if the missing package cannot be found or installed,
a174 4
A staging area is created under
.Pa /var/tmp ,
and the package is extracted into the staging area.
.It
d208 2
a209 29
The packing list is used as a guide for moving (or copying, as necessary)
files from the staging area into their final locations.
.It
If the package contains an
.Ar mtreefile
file (see
.Xr pkg_create 1 ) ,
then mtree is invoked as:
.Pp
.Bd -filled -offset indent -compact
.Cm mtree
.Fl u
.Fl f
.Ar mtreefile
.Fl d
.Fl e
.Fl p
.Pa prefix
.Ed
.Pp
where
.Pa prefix
is either the prefix specified with the
.Fl p
flag or, if no
.Fl p
flag was specified, the name of the first directory named by a
.Cm @@cwd
directive within this package.
@

