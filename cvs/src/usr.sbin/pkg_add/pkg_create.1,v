head	1.107;
access;
symbols
	OPENBSD_6_2:1.107.0.2
	OPENBSD_6_2_BASE:1.107
	OPENBSD_6_1:1.106.0.4
	OPENBSD_6_1_BASE:1.106
	OPENBSD_6_0:1.102.0.4
	OPENBSD_6_0_BASE:1.102
	OPENBSD_5_9:1.99.0.2
	OPENBSD_5_9_BASE:1.99
	OPENBSD_5_8:1.98.0.6
	OPENBSD_5_8_BASE:1.98
	OPENBSD_5_7:1.98.0.2
	OPENBSD_5_7_BASE:1.98
	OPENBSD_5_6:1.97.0.4
	OPENBSD_5_6_BASE:1.97
	OPENBSD_5_5:1.96.0.4
	OPENBSD_5_5_BASE:1.96
	OPENBSD_5_4:1.82.0.6
	OPENBSD_5_4_BASE:1.82
	OPENBSD_5_3:1.82.0.4
	OPENBSD_5_3_BASE:1.82
	OPENBSD_5_2:1.82.0.2
	OPENBSD_5_2_BASE:1.82
	OPENBSD_5_1_BASE:1.80
	OPENBSD_5_1:1.80.0.2
	OPENBSD_5_0:1.77.0.2
	OPENBSD_5_0_BASE:1.77
	OPENBSD_4_9:1.72.0.2
	OPENBSD_4_9_BASE:1.72
	OPENBSD_4_8:1.64.0.2
	OPENBSD_4_8_BASE:1.64
	OPENBSD_4_7:1.60.0.2
	OPENBSD_4_7_BASE:1.60
	OPENBSD_4_6:1.49.0.4
	OPENBSD_4_6_BASE:1.49
	OPENBSD_4_5:1.48.0.4
	OPENBSD_4_5_BASE:1.48
	OPENBSD_4_4:1.48.0.2
	OPENBSD_4_4_BASE:1.48
	OPENBSD_4_3:1.45.0.2
	OPENBSD_4_3_BASE:1.45
	OPENBSD_4_2:1.44.0.2
	OPENBSD_4_2_BASE:1.44
	OPENBSD_4_1:1.31.0.2
	OPENBSD_4_1_BASE:1.31
	OPENBSD_4_0:1.29.0.4
	OPENBSD_4_0_BASE:1.29
	OPENBSD_3_9:1.29.0.2
	OPENBSD_3_9_BASE:1.29
	OPENBSD_3_8:1.24.0.4
	OPENBSD_3_8_BASE:1.24
	OPENBSD_3_7:1.24.0.2
	OPENBSD_3_7_BASE:1.24
	OPENBSD_3_6:1.11.0.2
	OPENBSD_3_6_BASE:1.11
	OPENBSD_3_5:1.5.0.2
	OPENBSD_3_5_BASE:1.5;
locks; strict;
comment	@.\" @;


1.107
date	2017.09.18.14.10.11;	author espie;	state Exp;
branches;
next	1.106;
commitid	R3dpvhdXfJQzR76i;

1.106
date	2017.03.11.18.24.55;	author schwarze;	state Exp;
branches;
next	1.105;
commitid	5HNpPqUHe6rv1kaw;

1.105
date	2017.03.03.14.13.58;	author espie;	state Exp;
branches;
next	1.104;
commitid	XAQQHOuNgZpYuuJH;

1.104
date	2017.02.27.21.53.11;	author rpe;	state Exp;
branches;
next	1.103;
commitid	7XQfqtkSXX43wr6R;

1.103
date	2016.09.06.10.41.51;	author espie;	state Exp;
branches;
next	1.102;
commitid	s2PPIDjn9UAqg50C;

1.102
date	2016.06.28.15.30.29;	author espie;	state Exp;
branches;
next	1.101;
commitid	K7q0JuFeBndCSgUP;

1.101
date	2016.04.25.10.16.33;	author espie;	state Exp;
branches;
next	1.100;
commitid	x7kkwMThXHSN0STY;

1.100
date	2016.04.25.10.12.58;	author espie;	state Exp;
branches;
next	1.99;
commitid	YqCfgScl8lnWHOaz;

1.99
date	2015.09.15.17.20.53;	author schwarze;	state Exp;
branches;
next	1.98;
commitid	9lIBGKVpfkIuFvhX;

1.98
date	2014.09.08.01.27.55;	author schwarze;	state Exp;
branches;
next	1.97;
commitid	cPoapLAXYNe1fcgV;

1.97
date	2014.07.12.19.44.54;	author espie;	state Exp;
branches;
next	1.96;
commitid	KcyTTBfO0Oqu2lnk;

1.96
date	2014.01.23.12.21.44;	author espie;	state Exp;
branches;
next	1.95;

1.95
date	2014.01.21.03.15.46;	author schwarze;	state Exp;
branches;
next	1.94;

1.94
date	2014.01.17.11.09.36;	author espie;	state Exp;
branches;
next	1.93;

1.93
date	2014.01.14.13.57.20;	author naddy;	state Exp;
branches;
next	1.92;

1.92
date	2014.01.11.11.51.01;	author espie;	state Exp;
branches;
next	1.91;

1.91
date	2014.01.08.16.15.45;	author jmc;	state Exp;
branches;
next	1.90;

1.90
date	2014.01.07.10.44.07;	author espie;	state Exp;
branches;
next	1.89;

1.89
date	2014.01.04.00.14.08;	author espie;	state Exp;
branches;
next	1.88;

1.88
date	2014.01.03.16.56.22;	author espie;	state Exp;
branches;
next	1.87;

1.87
date	2014.01.03.15.23.16;	author jmc;	state Exp;
branches;
next	1.86;

1.86
date	2014.01.03.13.10.04;	author espie;	state Exp;
branches;
next	1.85;

1.85
date	2014.01.03.12.54.59;	author espie;	state Exp;
branches;
next	1.84;

1.84
date	2014.01.02.17.02.48;	author espie;	state Exp;
branches;
next	1.83;

1.83
date	2014.01.02.15.01.37;	author espie;	state Exp;
branches;
next	1.82;

1.82
date	2012.06.08.15.15.58;	author espie;	state Exp;
branches;
next	1.81;

1.81
date	2012.06.08.15.02.10;	author espie;	state Exp;
branches;
next	1.80;

1.80
date	2011.11.21.12.56.31;	author espie;	state Exp;
branches;
next	1.79;

1.79
date	2011.11.21.12.06.12;	author espie;	state Exp;
branches;
next	1.78;

1.78
date	2011.09.29.17.57.09;	author jmc;	state Exp;
branches;
next	1.77;

1.77
date	2011.06.09.11.19.33;	author sthen;	state Exp;
branches;
next	1.76;

1.76
date	2011.05.30.10.35.40;	author jmc;	state Exp;
branches;
next	1.75;

1.75
date	2011.05.30.09.59.38;	author espie;	state Exp;
branches;
next	1.74;

1.74
date	2011.03.19.09.39.39;	author jmc;	state Exp;
branches;
next	1.73;

1.73
date	2011.03.19.09.32.36;	author jmc;	state Exp;
branches;
next	1.72;

1.72
date	2011.02.07.00.02.50;	author schwarze;	state Exp;
branches;
next	1.71;

1.71
date	2011.01.02.22.58.45;	author fgsch;	state Exp;
branches;
next	1.70;

1.70
date	2010.12.20.16.30.03;	author espie;	state Exp;
branches;
next	1.69;

1.69
date	2010.12.20.11.32.30;	author espie;	state Exp;
branches;
next	1.68;

1.68
date	2010.10.27.17.26.03;	author espie;	state Exp;
branches;
next	1.67;

1.67
date	2010.10.22.15.59.50;	author espie;	state Exp;
branches;
next	1.66;

1.66
date	2010.10.04.16.07.56;	author jmc;	state Exp;
branches;
next	1.65;

1.65
date	2010.10.04.10.44.58;	author espie;	state Exp;
branches;
next	1.64;

1.64
date	2010.06.25.09.00.56;	author espie;	state Exp;
branches;
next	1.63;

1.63
date	2010.06.09.10.25.17;	author espie;	state Exp;
branches;
next	1.62;

1.62
date	2010.06.05.07.11.43;	author espie;	state Exp;
branches;
next	1.61;

1.61
date	2010.05.10.09.17.55;	author espie;	state Exp;
branches;
next	1.60;

1.60
date	2010.02.28.15.35.41;	author jmc;	state Exp;
branches;
next	1.59;

1.59
date	2010.02.28.10.08.48;	author espie;	state Exp;
branches;
next	1.58;

1.58
date	2010.02.24.14.38.21;	author schwarze;	state Exp;
branches;
next	1.57;

1.57
date	2010.02.04.07.49.15;	author jmc;	state Exp;
branches;
next	1.56;

1.56
date	2010.01.10.22.44.00;	author espie;	state Exp;
branches;
next	1.55;

1.55
date	2010.01.10.21.27.59;	author espie;	state Exp;
branches;
next	1.54;

1.54
date	2010.01.05.11.31.07;	author espie;	state Exp;
branches;
next	1.53;

1.53
date	2010.01.03.16.43.46;	author schwarze;	state Exp;
branches;
next	1.52;

1.52
date	2010.01.01.16.17.19;	author espie;	state Exp;
branches;
next	1.51;

1.51
date	2010.01.01.14.18.45;	author espie;	state Exp;
branches;
next	1.50;

1.50
date	2009.11.07.08.10.07;	author espie;	state Exp;
branches;
next	1.49;

1.49
date	2009.04.14.17.53.58;	author espie;	state Exp;
branches;
next	1.48;

1.48
date	2008.07.26.01.11.30;	author jmc;	state Exp;
branches;
next	1.47;

1.47
date	2008.07.25.19.39.40;	author ian;	state Exp;
branches;
next	1.46;

1.46
date	2008.04.07.12.30.04;	author espie;	state Exp;
branches;
next	1.45;

1.45
date	2007.11.05.17.15.16;	author sthen;	state Exp;
branches;
next	1.44;

1.44
date	2007.07.18.05.58.32;	author ajacoutot;	state Exp;
branches;
next	1.43;

1.43
date	2007.06.17.10.35.55;	author espie;	state Exp;
branches;
next	1.42;

1.42
date	2007.06.14.10.16.37;	author espie;	state Exp;
branches;
next	1.41;

1.41
date	2007.06.02.15.32.07;	author jmc;	state Exp;
branches;
next	1.40;

1.40
date	2007.06.02.10.19.29;	author espie;	state Exp;
branches;
next	1.39;

1.39
date	2007.05.31.19.20.26;	author jmc;	state Exp;
branches;
next	1.38;

1.38
date	2007.05.31.11.05.41;	author espie;	state Exp;
branches;
next	1.37;

1.37
date	2007.05.22.11.02.57;	author espie;	state Exp;
branches;
next	1.36;

1.36
date	2007.05.22.00.25.42;	author espie;	state Exp;
branches;
next	1.35;

1.35
date	2007.04.30.08.43.19;	author espie;	state Exp;
branches;
next	1.34;

1.34
date	2007.04.23.14.47.37;	author jmc;	state Exp;
branches;
next	1.33;

1.33
date	2007.04.23.11.13.07;	author espie;	state Exp;
branches;
next	1.32;

1.32
date	2007.04.15.10.17.29;	author espie;	state Exp;
branches;
next	1.31;

1.31
date	2006.10.15.15.37.28;	author jmc;	state Exp;
branches;
next	1.30;

1.30
date	2006.10.15.09.32.52;	author espie;	state Exp;
branches;
next	1.29;

1.29
date	2006.01.12.11.33.59;	author espie;	state Exp;
branches;
next	1.28;

1.28
date	2005.11.18.10.56.15;	author jmc;	state Exp;
branches;
next	1.27;

1.27
date	2005.11.17.11.20.24;	author espie;	state Exp;
branches;
next	1.26;

1.26
date	2005.10.10.09.38.29;	author espie;	state Exp;
branches;
next	1.25;

1.25
date	2005.09.14.10.38.02;	author espie;	state Exp;
branches;
next	1.24;

1.24
date	2004.12.01.12.17.40;	author espie;	state Exp;
branches;
next	1.23;

1.23
date	2004.11.21.11.29.35;	author xsa;	state Exp;
branches;
next	1.22;

1.22
date	2004.11.19.00.02.51;	author jmc;	state Exp;
branches;
next	1.21;

1.21
date	2004.11.18.21.51.43;	author espie;	state Exp;
branches;
next	1.20;

1.20
date	2004.11.15.13.20.40;	author jmc;	state Exp;
branches;
next	1.19;

1.19
date	2004.11.15.10.43.45;	author jmc;	state Exp;
branches;
next	1.18;

1.18
date	2004.10.18.14.37.20;	author espie;	state Exp;
branches;
next	1.17;

1.17
date	2004.10.13.18.44.09;	author espie;	state Exp;
branches;
next	1.16;

1.16
date	2004.10.11.10.30.33;	author espie;	state Exp;
branches;
next	1.15;

1.15
date	2004.10.11.10.07.37;	author espie;	state Exp;
branches;
next	1.14;

1.14
date	2004.09.22.10.57.27;	author espie;	state Exp;
branches;
next	1.13;

1.13
date	2004.09.18.09.22.14;	author espie;	state Exp;
branches;
next	1.12;

1.12
date	2004.09.15.18.54.17;	author espie;	state Exp;
branches;
next	1.11;

1.11
date	2004.08.10.12.50.14;	author espie;	state Exp;
branches;
next	1.10;

1.10
date	2004.08.06.16.45.51;	author millert;	state Exp;
branches;
next	1.9;

1.9
date	2004.08.06.16.41.31;	author millert;	state Exp;
branches;
next	1.8;

1.8
date	2004.08.06.08.45.11;	author espie;	state Exp;
branches;
next	1.7;

1.7
date	2004.07.14.10.44.03;	author espie;	state Exp;
branches;
next	1.6;

1.6
date	2004.07.05.23.21.56;	author espie;	state Exp;
branches;
next	1.5;

1.5
date	2004.01.31.17.56.13;	author espie;	state Exp;
branches;
next	1.4;

1.4
date	2004.01.28.22.12.01;	author espie;	state Exp;
branches;
next	1.3;

1.3
date	2004.01.22.21.11.43;	author espie;	state Exp;
branches;
next	1.2;

1.2
date	2003.11.14.23.03.55;	author espie;	state Exp;
branches;
next	1.1;

1.1
date	2003.10.19.18.38.06;	author espie;	state Exp;
branches;
next	;


desc
@@


1.107
log
@document @@version
@
text
@.\"	$OpenBSD: pkg_create.1,v 1.106 2017/03/11 18:24:55 schwarze Exp $
.\"
.\" Documentation and design originally from FreeBSD. All the code has
.\" been rewritten since. We keep the documentation's notice:
.\"
.\" Redistribution and use in source and binary forms, with or without
.\" modification, are permitted provided that the following conditions
.\" are met:
.\" 1. Redistributions of source code must retain the above copyright
.\"    notice, this list of conditions and the following disclaimer.
.\" 2. Redistributions in binary form must reproduce the above copyright
.\"    notice, this list of conditions and the following disclaimer in the
.\"    documentation and/or other materials provided with the distribution.
.\"
.\" Jordan K. Hubbard
.\"
.\"
.\" hacked up by John Kohl for NetBSD--fixed a few bugs, extended keywords,
.\" added dependency tracking, etc.
.\"
.\" [jkh] Took John's changes back and made some additional extensions for
.\" better integration with FreeBSD's new ports collection.
.\"
.Dd $Mdocdate: March 11 2017 $
.Dt PKG_CREATE 1
.Os
.Sh NAME
.Nm pkg_create
.Nd create binary software package for distribution
.Sh SYNOPSIS
.Nm pkg_create
.Bk -words
.Op Fl mnQqvx
.Op Fl A Ar arches
.Op Fl B Ar pkg-destdir
.Op Fl D Ar name Ns Op = Ns Ar value
.Op Fl L Ar localbase
.Op Fl M Ar displayfile
.Op Fl P Ar pkgpath : Ns Ar pkgspec : Ns Ar default
.Op Fl U Ar undisplayfile
.Op Fl V Ar n
.Op Fl W Ar libspec
.Fl d Ar desc
.Fl D Ar COMMENT Ns = Ns Ar value
.Fl D Ar PORTSDIR Ns = Ns Ar value
.Fl f Ar packinglist
.Fl p Ar prefix
.Ar pkg-name
.Ek
.Nm pkg_create
.Fl f Ar packinglist
.Sh DESCRIPTION
The
.Nm
command is normally used to create a binary package named
.Ar pkg-name ,
for subsequent use with
.Xr pkg_add 1 ,
.Xr pkg_delete 1
and
.Xr pkg_info 1 .
.Ar pkg-name
will traditionally have a
.Dq .tgz
extension, to denote the underlying binary format.
.Ar pkg-name
must follow
.Xr packages-specs 7 .
.Pp
Use of the
.Xr ports 7
infrastructure instead of manual
.Nm
invocation is strongly recommended.
.Pp
.Nm
can also be used to recreate a binary package from an existing installation.
.Pp
During package creation,
.Nm
replaces too long file names with smaller equivalents
.Po
see
.Xr package 5
.Pc ,
records extra information in the packing-list, such as the existence
of symlinks and hard links, computes and stores file checksums, and
verifies that all special objects are properly annotated in the packing-list.
.Pp
It will also check all required shared libraries
for reachability, by looking into all installed dependencies.
It may also ask the ports tree for extra dependencies,
provided some other dependency refers to the same
.Ev BASE_PKGPATH
.Po
see
.Xr bsd.port.mk 5
.Pc .
The rationale is that those libraries must already be present for
the package to build correctly, and thus be reachable through the
subset of dependencies that are not pure
.Ev RUN_DEPENDS .
.Pp
The options are as follows:
.Bl -tag -width Ds
.It Fl A Ar arches
Register a list of architectures for which this package should install.
.Ar arches
is a comma-separated list of architectures.
Use
.Sq *
to mean any architecture (e.g., arch-independent packages).
.It Fl B Ar pkg-destdir
Set
.Ar pkg-destdir
as the prefix to prepend to any file to select for the package.
.It Fl D Ar name Ns Op = Ns Ar value
Define
.Ar name
to
.Ar value
(or just define it)
for substitution and fragment inclusion purposes.
Some specific
.Ar names
have extra meaning, see
.Xr bsd.port.mk 5
for details:
.Pp
.Bl -tag -width FULLPKGPATH -compact
.It Ar CDROM
Set to the port's Makefile
.Ar PERMIT_PACKAGE_CDROM .
.It Ar COMMENT
Set package
.Dq one line description
(mandatory).
.It Ar HISTORY_DIR
Record checksums of files in permanent location
.Pa ${HISTORY_DIR}/${FULLPKGPATH:S,/,./g} .
.It Ar FTP
Set to the port's Makefile
.Ar PERMIT_PACKAGE_FTP .
.It Ar FULLPKGPATH
Strongly recommended, otherwise updates won't work.
.It Ar HOMEPAGE
If defined, appended to the description.
.It Ar MAINTAINER
If defined, appended to the description.
.It Ar USE_GROFF
Set to 1 to have groff format manpages behind the scenes during
package creation.
.El
.It Fl d Oo Fl Oc Ns Ar desc
Fetch long description for package from file
.Ar desc
or, if preceded by
.Sq - ,
the argument itself.
.It Fl f Ar packinglist
Fetch
.Dq packing-list
for package from the file
.Ar packinglist .
Several packing-lists can be mentioned, in which case they will be
concatenated together.
.It Fl L Ar localbase
Record
.Ar localbase
as the localbase used in the package
.Po
By default,
.Pa /usr/local
.Pc .
Packages built with another localbase can only be installed by using
the same localbase in
.Xr pkg_add 1 ,
to prevent errors.
.It Fl M Ar displayfile
Display the file (using
.Xr more 1 )
after installing the package.
Useful for things like
legal notices on almost-free software, etc.
.It Fl m
Causes
.Nm
to always display the progress meter in cases it would not do so by default.
.It Fl n
Don't actually create a package.
.It Fl P Ar pkgpath : Ns Ar pkgspec : Ns Ar default
Declare a dependency on a package matching
.Ar pkgspec
.Pq see Xr packages-specs 7 .
An appropriate package must be installed before this package may be
installed, and that package must be deinstalled before this package
is deinstalled.
The dependency also contains a
.Ar pkgpath
.Po
see
.Xr pkgpath 7
.Pc
and a
.Ar default
package name, in case there is no listing of available packages.
.It Fl p Ar prefix
Set
.Ar prefix
as the initial directory
.Dq base
to start from in selecting files for
the package, and to record as the base for installing the package.
.It Fl Q
Print out the files in the actual packing-list of the package being
generated, with explicit typing
.Pq e.g. Cm @@file , @@lib , ... .
.It Fl q
Print out the actual packing-list of the package being generated
(query mode).
Most often used in combination with
.Fl n .
.It Fl U Ar undisplayfile
Display the file (using
.Xr more 1 )
when deinstalling the package.
Useful for reminders about stuff to clean up.
.It Fl V Ar n
Adds
.Ar n
to the
.Sq global system version
of the package
.Po see
.Xr package 5
.Pc .
The default value of 0 is not recorded, thus packages without
.Cm @@version
have an implicit version of 0.
.It Fl v
Turn on verbose output.
.It Fl W Ar libspec
Package needs a shared library to work.
.Ar libspec
is
.Sq name.major.minor
or
.Sq path/name.major.minor .
The package won't be installed unless a library with the same name,
the exact same major number and at least the same minor number can
be located.
A library without path is searched through dependent packages under the
same
.Ar localbase ,
then in the system libraries under
.Pa /usr/lib
and
.Pa /usr/X11R6/lib .
A library with a path is only searched through dependent packages,
that path being relative to
.Ar localbase .
.It Fl x
Disable progress meter.
.El
.Pp
.Nm
can also be invoked with only the packing-list from an installed package.
It will recreate the corresponding binary package in the current directory
from the installation, or error out if any problem is found.
For example,
the following will recreate a
.Pa kdelibs-3.4.3.tgz
package:
.Bd -literal -offset indent
pkg_create -f /var/db/pkg/kdelibs-3.4.3/+CONTENTS
.Ed
.Sh PACKING-LIST DETAILS
The
.Dq packing-list
format (see
.Fl f )
is fairly simple, being basically a list of filenames and directory names
to include in the package.
.Pp
Substitution of variables and inclusion of fragments is documented in the
next section.
.Pp
Directory names are denoted by a trailing slash.
.Pp
There are some annotations that can be inserted for better control.
All these commands start with an
.Sq @@ .
The following annotations can be inserted manually:
.Pp
.Bl -tag -width Ds -compact
.It Cm @@ask-update Ar pkgspec Ar message
Mechanism to prevent unwanted updates.
If the new package is installed as part of an update matching
.Ar pkgspec ,
the
.Ar message
will be displayed to the user.
In non-interactive mode, the update will abort.
Otherwise, the user will have a chance to proceed.
Automated updates can be done by using
.Fl D Ar update_stem ,
with
.Ar stem
the stem of the
.Ar pkgspec .
Classical use case for postgresql:
.Bd -literal -offset 3n
@@ask-update postgresql-server-<8 Make sure your existing database is backed up
.Ed
.Pp
Use very sparingly.
Most cases that seem to require manual updates just require a bit more thought.
.Pp
.It Cm @@bin Ar filename
Describe the file as an
.Ox
binary executable (not a script).
.Pp
.It Cm @@comment Ar string
Place a comment in the packing-list.
Useful in trying to document some particularly hairy sequence that
may trip someone up later.
Can also be used to comment out elements that update-plist
.Pq see Xr bsd.port.mk 5
will insist in inserting in a packing-list.
.Pp
The special comment
.Cm @@comment Ar "no checksum"
can be used to tag the next file as special: even though its characteristics
will be recorded in the package, it can be altered after installation, and
.Xr pkg_delete 1
will still delete it.
.Pp
.It Cm @@conflict Ar pkgspec
Declare a conflict with packages matching
.Ar pkgspec
.Pq see Xr packages-specs 7 .
The
.Ar pkgname
package can
.Em not
be installed if a package
matching
.Ar pkgspec
has been installed because they install the same files and thus conflict.
.Pp
.It Cm @@cwd Ar pathname
Set the package current directory.
All subsequent filenames will be assumed relative to
.Ar pathname .
.Pp
.It Cm @@dir Ar directoryname
Create directory
.Ar directoryname
at
.Xr pkg_add 1
time, taking
.Cm @@mode ,
.Cm @@group ,
and
.Cm @@owner
into account, and remove it during
.Xr pkg_delete 1 .
Directories to remove can be shared between packages.
If
.Ar name
does not begin with an @@, same as
.Dl name/
.Pp
.It Cm @@exec Ar command
Execute
.Ar command
during
.Xr pkg_add 1 .
Note that
.Cm @@exec
commands are executed relative to their location in the packing-list,
so they can rely on any data that have already been extracted,
but not on anything that is listed after them.
Some special elements, such as new users and new groups, are always
created first, so that
.Cm @@exec
can rely on them.
.Pp
.Xr pkg_add 1
and
.Xr pkg_delete 1
set the
.Ev PATH
to a predictable value:
.Bd -literal -offset indent
/bin:/sbin:/usr/bin:/usr/sbin:/usr/X11R6/bin:${LOCALBASE}/bin:${LOCALBASE}/sbin
.Ed
.Pp
during execution.
.Pp
If
.Ar command
contains any of the following sequences somewhere in it, they will
be expanded inline.
For the following examples, assume that
.Cm @@cwd
is set to
.Pa /usr/local
and the last extracted file was
.Pa bin/emacs .
.Bl -tag -width indent
.It Cm "\&%B"
Expands to the
.Dq basename
of the fully qualified filename, that
is the current directory prefix, plus the last filespec, minus
the trailing filename.
In the example case, that would be
.Pa /usr/local/bin .
.It Cm "\&%D"
Expands to the current directory prefix, as set with
.Cm @@cwd ;
in the example case
.Pa /usr/local .
.It Cm "\&%F"
Expands to the last filename extracted (as specified); in the example case,
.Pa bin/emacs .
.It Cm "\&%f"
Expands to the
.Dq filename
part of the fully qualified name, or
the converse of
.Cm \&%B ;
in the example case,
.Pa emacs .
.El
.Pp
.It Cm @@exec-always Ar command
Synonym of
.Cm @@exec .
.Pp
.It Cm @@exec-add Ar command
Similar to
.Cm @@exec ,
except it only gets executed during new installations,
and not during updates.
.Pp
.It Cm @@exec-update Ar command
Similar to
.Cm @@exec ,
except it only gets executed during updates,
and not during new installations.
.Pp
.It Cm @@extra Ar filename
Declare extra file
.Ar filename
to be deleted at deinstall time, if user sets the
.Fl c
option.
Those files are extra configuration files that are normally not deleted.
.Ar filename
can be an absolute path.
If
.Ar filename
ends with a slash, it is a directory.
.Pp
.It Cm @@extraunexec Ar command
Extra
.Ar command
to execute when removing extra files.
.Pp
.It Cm @@file Ar filename
Default annotation, to use if
.Ar filename
begins with @@.
.Ar filename
is always a relative path, relative to the current
.Cm @@cwd .
.Pp
.It Cm @@fontdir Ar directoryname
Specialized version of
.Cm @@dir ,
to handle font directories: create
.Pa font.alias
from
.Pa font.alias-*
fragments, execute
.Xr mkfontdir 1 ,
.Xr mkfontscale 1
and
.Xr fc-cache 1
when needed.
Delete extra files at
.Xr pkg_delete 1
time.
.Pp
.It Cm @@group Ar group
Set default group ownership for all subsequently extracted files to
.Ar group .
Use without an arg to set back to default (extraction)
group ownership.
.Pp
.It Cm @@info Ar filename
Specialized version of
.Cm @@file ,
to handle GNU info files.
Automatically grab
.Ar filename Ns -*
chapter files, run
.Xr install-info 1
as needed.
.Pp
.It Cm @@lib Ar filename
Specialized version of
.Cm @@file ,
to handle shared libraries.
Satisfy LIB_DEPENDS and WANTLIB,
run
.Xr ldconfig 8
as needed.
See
.Sq VARIABLE SUBSTITUTION AND FRAGMENT INCLUSION
for some details.
.Pp
.It Cm @@man Ar filename
Specialized version of
.Cm @@file ,
to handle manual pages.
.Pp
.It Cm @@mandir Ar directoryname
Specialized version of
.Cm @@dir ,
to handle manual directories: instruct user to add/remove the
directory to
.Xr man.conf 5 ,
remove
.Xr apropos 1
database when needed.
.Pp
.It Cm @@mode Ar mode
Set default permission for all subsequently extracted files to
.Ar mode .
Format is the same as that used by the
.Xr chmod 1
command.
Use without an arg to set back to default (extraction) permissions.
.Pp
.It Cm @@newgroup Ar name : Ns Ar gid
During
.Xr pkg_add 1 ,
create a new group, using
.Xr groupadd 8 .
Happens before file and user creations.
.Ar gid
can be prefixed with a
.Sq !\&
to ensure group has the correct GID.
During
.Xr pkg_delete 1 ,
groups will be deleted if extra clean-up has been requested, and if
other installed packages don't list the same group.
.Pp
.It Xo
.Cm @@newuser
.Sm off
.Ar name :
.Ar uid :
.Ar group :
.Ar loginclass :
.Ar comment :
.Ar home :
.Ar shell
.Sm on
.Xc
During
.Xr pkg_add 1 ,
create a new user.
Happens before any file creation.
All fields correspond to
.Xr useradd 8
parameters.
Some fields are optional and can be left empty.
If the user already exists, no action is taken.
Individual fields can be prefixed by a
.Sq !\&
to make sure an existing
user matches.
For instance, the directive
.Li @@newuser foo:!42
will make sure user foo has UID 42.
During
.Xr pkg_delete 1 ,
users will be deleted if extra clean-up has been requested, and if
other installed packages don't list the same user.
.Pp
.It Cm @@option Ar name
Effects vary depending on
.Ar name .
These are the user settable options
.Bl -tag -width indent
.It Ar always-update
By default,
.Xr pkg_add 1
uses some simplified information to decide whether an installed package
needs updating.
With this option, the package is updated whenever anything changes.
To be used sparingly, as this is more expensive.
.It Ar is-branch
Annotate the few rare ports where several branches are present in the
ports tree (such as autoconf), to help
.Xr pkg_info 1
produce
.Ar stem Ns % Ns Ar branch
annotations when needed.
.It Ar no-default-conflict
By default, a package conflicts with other versions of the same package.
With this option, the older package version will still be noticed, but the
installation will proceed anyway.
.El
.Pp
.It Cm @@owner Ar user
Set default ownership for all subsequently extracted files to
.Ar user .
Use without an arg to set back to default (extraction)
ownership.
.Pp
.It Cm @@pkgpath Ar pkgpath
Declare a secondary
.Ar pkgpath
for the package.
This is used for updates:
.Nm pkg_add
.Fl u
normally checks that the
.Ar pkgpath
embedded in the package corresponds to the old package,
to solve ambiguities when packages with similar names are involved.
When ports get renamed, or flavors change, extra
.Cm @@pkgpath
annotations can help
.Nm pkg_add
get a sense of continuity.
Note that these
.Ar pkgpath
can take extra optional components, to allow the matching of several
flavors at once, and are order independent.
For instance,
.Bd -literal -offset indent
@@pkgpath some/dir,f1,f2
.Ed
.Pp
and
.Bd -literal -offset indent
@@pkgpath some/dir,f2,f2,f1
.Ed
.Pp
are equivalent.
.Bd -literal -offset indent
@@pkgpath some/dir,f1[,f2,f3][,f4]
.Ed
.Pp
will match all pkgpaths to some/dir with flavor f1, and optionally f4, and
optionally both f2 and f3, e.g.,
.Ar some/dir,f1,f4 ,
.Ar some/dir,f1,f2,f3 ,
.Ar some/dir,f1,f2,f3,f4 ,
.Ar some/dir,f1
would match,
but
.Ar some/dir,f1,f5 ,
.Ar some/dir,f2,f3 ,
.Ar some/dir,f1,f2,f4
would not.
.Pp
Each binary package contains a set of pkgpaths: the primary pkgpath that
was used to build the package, recorded as
.Cm @@comment Ar pkgpath=some/path ,
and secondary pkgpaths as recorded through
.Cm @@pkgpath .
.Pp
In order for two packages to match, their primary pkgpaths must match, or
a secondary pkgpath must match the other package's primary pkgpath.
.Pp
.It Cm @@rcscript Ar filename
Script for the
.Pa /etc/rc.d
framework.
Contrary to
.Cm @@file ,
absolute paths are okay, e.g.,
.Bd -literal -offset indent
@@rcscript ${RCDIR}/ballsd
.Ed
.Pp
In this case, performs an implicit
.Cm @@cwd
to
.Pa ${RCDIR} .
.Pp
.It Cm @@sample Ar filename
Last preceding
.Cm @@file
item is a sample configuration file, to be copied to
.Ar filename
at
.Xr pkg_add 1
time and to be removed at
.Xr pkg_delete 1
time.
During installation, existing configuration files are untouched.
During deinstallation, configuration files are only removed if unchanged.
.Ar filename
can be an absolute path.
If
.Ar filename
ends with a slash,
it refers to a configuration directory instead.
.Pp
.It Cm @@shell Ar filename
Specialized version of
.Cm @@file ,
to handle shells.
See
.Xr shells 5 .
.Pp
.It Cm @@unexec Ar command
Execute
.Ar command
during
.Xr pkg_delete 1 .
.Ev PATH
and expansion of special
.Cm \&%
sequences are the same as for
.Cm @@exec .
Note that
.Cm @@unexec
commands are executed relative to their location in the packing-list,
so they cannot rely on any data that has already been deleted,
thus they should occur before the files they need to function.
Some special elements, such as new users and new groups, are always
deleted last, so that
.Cm @@unexec
can rely on them.
.Pp
.It Cm @@unexec-always Ar command
Synonym of
.Cm @@unexec .
.Pp
.It Cm @@unexec-delete Ar command
Similar to
.Cm @@unexec ,
except it only gets executed during true deletions
and not while removing an old package during updates.
.Pp
.It Cm @@unexec-update Ar command
Similar to
.Cm @@unexec ,
except it only gets executed while removing an old package during updates,
and not during true deletions.
.El
.Pp
See
.Xr package 5
for other internal annotations that are automatically added by the
package tools.
.Sh VARIABLE SUBSTITUTION AND FRAGMENT INCLUSION
In packing-lists, installation, deinstallation and requirement scripts,
description and message files,
constructs like
.Li ${VAR}
will be replaced with the variable value, according to
.Fl D Ar name Ns = Ns Ar value
options.
.Pp
In particular, shared library versions should never be mentioned explicitly
in a packing-list.
Shared library
.Sq foo
will take its version number from
.Ev LIBfoo_VERSION .
The ports framework normally takes care of all details, see
.Ev SHARED_LIBS
in
.Xr bsd.port.mk 5 .
.Pp
Constructs like
.Li %%VAR%%
and
.Li !%%VAR%%
trigger fragment inclusion.
If such a line is encountered in a packing-list, the corresponding variable
must be defined to 0 or 1.
If the variable's value is 1,
.Li %%VAR%%
will be replaced by the corresponding positive fragment, and
.Li !%%VAR%%
will be ignored.
If the variable's value is 0,
.Li %%VAR%%
will be ignored, and
.Li !%%VAR%%
will be replaced by the corresponding positive fragment.
.Pp
A fragment is an auxiliary packing-list file, whose name is derived from the
current packing-list, and the variable name
.Va VAR
triggering the inclusion:
.Pa pkg/PLIST
yields a positive fragment
.Pa pkg/PFRAG.VAR
and a negative fragment
.Pa pkg/PFRAG.no-VAR ,
.Pa pkg/PLIST-FOO
yields a positive fragment
.Pa pkg/PFRAG.VAR-foo
and a negative fragment
.Pa pkg/PFRAG.no-VAR-foo .
.Pp
Fragments can be included inside fragments, so that
.Li %%VAR2%%
inside
.Pa pkg/PFRAG.VAR
triggers the inclusion of
.Pa pkg/PFRAG.VAR2-VAR
and
.Li !%%VAR2%%
triggers the inclusion of
.Pa pkg/PFRAG.no-VAR2-VAR .
.Pp
If a positive or a negative fragment file does not exist, the corresponding
inclusion will be ignored.
However, if both the positive and negative fragment files do not exist,
.Nm
will error out, to make it easier to spot fragment names errors.
.Sh ENVIRONMENT
.Bl -tag -width PKG_DESTDIR
.It Ev PKG_DESTDIR
Default value for
.Ar pkg-destdir ,
if no
.Fl B
option is specified.
.El
.Sh SEE ALSO
.Xr pkg_add 1 ,
.Xr pkg_delete 1 ,
.Xr pkg_info 1 ,
.Xr pkg_sign 1 ,
.Xr tar 1 ,
.Xr bsd.port.mk 5 ,
.Xr package 5 ,
.Xr packages-specs 7 ,
.Xr pkgpath 7 ,
.Xr ports 7
.Sh HISTORY
The
.Nm
command first appeared in
.Fx .
.Sh AUTHORS
.Bl -tag -width indent -compact
.It An Jordan Hubbard
initial design
.It An Marc Espie
complete rewrite.
.El
@


1.106
log
@more consistency on .Fl ... Ns Ar lines, requested by jmc@@
@
text
@d1 1
a1 1
.\"	$OpenBSD: pkg_create.1,v 1.105 2017/03/03 14:13:58 espie Exp $
d24 1
a24 1
.Dd $Mdocdate: March 3 2017 $
d41 1
d228 12
@


1.105
log
@spring cleanup, remove sysctl from doc, and finally gc some older annotations
which don't even exist in the PackingElement hierarchy anymore.
@
text
@d1 1
a1 1
.\"	$OpenBSD: pkg_create.1,v 1.104 2017/02/27 21:53:11 rpe Exp $
d24 1
a24 1
.Dd $Mdocdate: February 27 2017 $
d153 1
a153 1
.It Fl d No [-] Ns Ar desc
@


1.104
log
@Remove support for pkg.conf in light of the consolidation towards
a single configuration file for the OpenBSD repository location.

The pkg_* tools now use installurl(5) to find the package repository.

NOTE:
/etc/installurl only contains a single URL pointing to a mirror.
Use the PKG_PATH environment variable to specify more than one
package repository.

prodded by and OK deraadt@@ aja@@
@
text
@d1 1
a1 1
.\"	$OpenBSD: pkg_create.1,v 1.103 2016/09/06 10:41:51 espie Exp $
d24 1
a24 1
.Dd $Mdocdate: September 6 2016 $
a712 12
.Pp
.It Cm @@sysctl Ar var Ns = Ns Ar val
.It Cm @@sysctl Ar var Ns \*(Ge Ns Ar val
During
.Xr pkg_add 1 ,
check that
.Xr sysctl 8
variable
.Ar var
is set to exactly/at least a given value
.Ar val .
Adjust it otherwise.
@


1.103
log
@remove code that allows pkg_create to sign
@
text
@d1 1
a1 1
.\"	$OpenBSD: pkg_create.1,v 1.102 2016/06/28 15:30:29 espie Exp $
d24 1
a24 1
.Dd $Mdocdate: June 28 2016 $
a852 1
.Xr pkg.conf 5 ,
@


1.102
log
@document is-branch
@
text
@d1 1
a1 1
.\"	$OpenBSD: pkg_create.1,v 1.101 2016/04/25 10:16:33 espie Exp $
d24 1
a24 1
.Dd $Mdocdate: April 25 2016 $
a39 1
.Op Fl s Ar signature-parameter
a49 1
.Op Fl s Ar signature-parameter
a221 6
.It Fl s Ar signature-parameter
Specify signature parameters for signing packages on-the-fly during
building.
Refer to
.Xr pkg_sign 1
for the meaning of the parameters and the signing process.
@


1.101
log
@pkgcfl was put in the old keywords bin a few generations ago...
@
text
@d1 1
a1 1
.\"	$OpenBSD: pkg_create.1,v 1.100 2016/04/25 10:12:58 espie Exp $
d604 7
@


1.100
log
@kill remnants of non shared arches
@
text
@d1 1
a1 1
.\"	$OpenBSD: pkg_create.1,v 1.99 2015/09/15 17:20:53 schwarze Exp $
d24 1
a24 1
.Dd $Mdocdate: September 15 2015 $
a614 19
.Pp
.It Cm @@pkgcfl Ar pkgcflname
Declare a conflict to the
.Ar pkgcflname
package.
The
.Ar pkgcflname
package must
.Em not
be installed if
.Ar pkgname
package gets installed because they install the same files and thus conflict.
.Ar pkgcflname
may use
.Xr fnmatch 3
wildcards.
Deprecated, use
.Cm @@conflict
instead.
@


1.99
log
@avoid useless .Ns before punctuation after in-line macros
@
text
@d1 1
a1 1
.\"	$OpenBSD: pkg_create.1,v 1.98 2014/09/08 01:27:55 schwarze Exp $
d24 1
a24 1
.Dd $Mdocdate: September 8 2014 $
d805 1
a805 4
.Xr bsd.port.mk 5 ,
not to be confused with
.Va SHARED_LIBS
later in this document.
a855 31
.Pp
Shared libraries no longer require any fragments, but can be included directly
in the final packing-list:
on an architecture without shared libraries,
.Li @@lib lib/libfoo.so.${LIBfoo_VERSION}
will automatically devolve into
.Li lib/libfoo.a ,
if needed (e.g., for a port that builds both a shared library and a normal
library on a shared libraries architecture,
.Li @@lib lib/libfoo.so.${LIBfoo_VERSION}
will simply vanish on non-shared architectures).
Extra copies living in other directories will be ignored
.Po
See the description of
.Ev SHARED_ONLY
and
.Ev NO_SHARED_LIBS
in
.Xr bsd.port.mk 5
.Pc .
.Pp
As a special historical exception, the variable
.Va SHARED_LIBS
still control the inclusion of fragments
.Pa PFRAG.shared
and
.Pa PFRAG.no-shared
through the lines
.Li %%SHARED%%
and
.Li !%%SHARED%% .
@


1.98
log
@obvious cases of missing .An;
found with the new mandoc(1) MANDOCERR_AN_MISSING warning;
no text changes
@
text
@d1 1
a1 1
.\"	$OpenBSD: pkg_create.1,v 1.97 2014/07/12 19:44:54 espie Exp $
d24 1
a24 1
.Dd $Mdocdate: July 12 2014 $
d39 1
a39 1
.Op Fl P Ar pkgpath Ns : Ns Ar pkgspec Ns : Ns Ar default
d192 1
a192 1
.It Fl P Ar pkgpath Ns : Ns Ar pkgspec Ns : Ns Ar default
@


1.97
log
@@@endfake died a while ago
@
text
@d1 1
a1 1
.\"	$OpenBSD: pkg_create.1,v 1.96 2014/01/23 12:21:44 espie Exp $
d24 1
a24 1
.Dd $Mdocdate: January 23 2014 $
d918 1
a918 1
.It "Jordan Hubbard"
d920 1
a920 1
.It "Marc Espie"
@


1.96
log
@separate pkg_sign documentation. Option description becomes MUCH saner.
@
text
@d1 1
a1 1
.\"	$OpenBSD: pkg_create.1,v 1.95 2014/01/21 03:15:46 schwarze Exp $
d24 1
a24 1
.Dd $Mdocdate: January 21 2014 $
a368 6
.Pp
.It Cm @@endfake
Mark end of packing-list for
.Xr pkg_add 1
.Fl Q
option.
@


1.95
log
@obvious .Pa fixes; found with mandocdb(8)
@
text
@d1 1
a1 1
.\"	$OpenBSD: pkg_create.1,v 1.94 2014/01/17 11:09:36 espie Exp $
d24 1
a24 1
.Dd $Mdocdate: January 17 2014 $
a52 6
.Nm pkg_create
.Fl s Ar signature-parameter ...
.Op Fl j Ar maxjobs
.Op Fl o Ar dir
.Op Fl S Ar source
.Op Ar pkgfile ...
d77 2
a78 2
It can also be used to recreate a binary package from an existing installation
(second synopsis) or to sign a collection of built packages (third synopsis).
a150 9
.It Ar resign
Allows signing over already signed packages.
Obviously, this checks the existing signature first,
so the
.Fl D Ar SIGNER
and
.Fl D Ar nosig
apply with the same semantics as
.Xr pkg_add 1 .
a167 2
.It Fl j Ar maxjobs
Sign existing packages in parallel.
a191 3
.It Fl o Ar dir
Specify output directory for signing packages after the fact.
Otherwise, unsigned packages will be replaced with signed packages.
d224 6
a229 49
.It Fl S Ar source
Source repository for packages to be signed.
This can be any url admissible for a
.Ev PKG_PATH ,
so that it is possible to sign packages during a transfer, e.g.,
.Bd -literal -offset indent
pkg_create -s signify -s mykey-pkg.sec \e
	-o output -S scp://build-machine/packages/
.Ed
.It Xo
.Fl s Ar signify|x509
.Op Fl s Ar cert
.Fl s Ar privkey
.Xc
Specify signature parameters for signed packages.
Option parameters are as follows:
.Bl -tag -width ArsignifyDx509 -compact
.It Ar signify|x509
choose
.Xr signify 1
or X.509-style signatures.
.It Ar cert
the path to the signer's certificate (X.509 only)
.It Ar privkey
the path to the signer's private key.
For
.Xr signify ,
the private key name is used to set the
.Cm \@@signer
annotation.
If a corresponding public key is found, the first signatures will be
checked for key mismatches.
.El
.Pp
For X.509, the signer's certificate and the signer's private key
should be generated using standard openssl x509 commands.
This assumes the existence of a certificate authority (or several), whose
public information is recorded as a
.Pa /etc/ssl/pkgca.pem
file.
.Pp
For
.Xr signify 1
private usage, a
.Ar SIGNER
must be specified, so that
.Xr pkg_add 1
will be able to retrieve the correct public key from
.Pa /etc/signify/<signer>.pub .
a905 1
.Xr openssl 1 ,
d909 1
a909 1
.Xr signify 1 ,
@


1.94
log
@tweak documentation to match what's going on
@
text
@d1 1
a1 1
.\"	$OpenBSD: pkg_create.1,v 1.93 2014/01/14 13:57:20 naddy Exp $
d24 1
a24 1
.Dd $Mdocdate: January 14 2014 $
d417 1
a417 1
.Pa directoryname
d521 1
a521 1
.Pa filename
d529 1
a529 1
.Pa filename
d573 1
a573 1
.Pa filename-*
@


1.93
log
@fix public key names
@
text
@d1 1
a1 1
.\"	$OpenBSD: pkg_create.1,v 1.92 2014/01/11 11:51:01 espie Exp $
d24 1
a24 1
.Dd $Mdocdate: January 11 2014 $
a51 1
.Op Fl D Ar SIGNER Ns = Ns Ar value
a55 1
.Op Fl D Ar SIGNER Ns = Ns Ar value
d157 9
a168 2
.It Ar SIGNER
Specify a signer name, used for signing packages.
d250 1
a250 1
pkg_create -s signify -s mykey -DSIGNER=me \e
d269 7
@


1.92
log
@a bit of spring cleanup in advance: scrape old stuff that's not really
used.
@
text
@d1 1
a1 1
.\"	$OpenBSD: pkg_create.1,v 1.91 2014/01/08 16:15:45 jmc Exp $
d24 1
a24 1
.Dd $Mdocdate: January 8 2014 $
d280 1
a280 1
.Pa /etc/signify/<signer>.pubkey .
@


1.91
log
@zap trailing whitespace;
@
text
@d1 1
a1 1
.\"	$OpenBSD: pkg_create.1,v 1.90 2014/01/07 10:44:07 espie Exp $
d24 1
a24 1
.Dd $Mdocdate: January 7 2014 $
a660 6
.It Ar explicit-update
packages tagged with this option, either in the installed version or in an
update candidate, won't be considered during a global update.
User has to explicitly ask to update them.
Typical use is for firmware packages, whose updates are usually tied to
kernel changes.
@


1.90
log
@document new stuff
@
text
@d1 1
a1 1
.\"	$OpenBSD: pkg_create.1,v 1.89 2014/01/04 00:14:08 espie Exp $
d24 1
a24 1
.Dd $Mdocdate: January 4 2014 $
d148 1
a148 1
Record checksums of files in permanent location 
@


1.89
log
@vendor->signer
shorten pubkey -> pub (naddy@@)
\\ -> \e (jmc@@)
@
text
@d1 1
a1 1
.\"	$OpenBSD: pkg_create.1,v 1.88 2014/01/03 16:56:22 espie Exp $
d24 1
a24 1
.Dd $Mdocdate: January 3 2014 $
d56 1
d147 3
d178 2
@


1.88
log
@PATH is now fixed
@
text
@d1 1
a1 1
.\"	$OpenBSD: pkg_create.1,v 1.87 2014/01/03 15:23:16 jmc Exp $
d52 1
a52 1
.Op Fl D Ar VENDOR Ns = Ns Ar value
d56 1
a56 1
.Op Fl D Ar VENDOR Ns = Ns Ar value
d158 2
a159 2
.It Ar VENDOR
Specify a vendor-name, mostly used for signing packages.
d239 1
a239 1
pkg_create -s signify -s mykey -DVENDOR=me \\
d270 1
a270 1
.Ar VENDOR
d274 1
a274 1
.Pa /etc/signify/<vendor>.pubkey .
@


1.87
log
@remove trailing whitespace and unneccessary macros from previous;
@
text
@d1 1
a1 1
.\"	$OpenBSD: pkg_create.1,v 1.86 2014/01/03 13:10:04 espie Exp $
d435 13
d808 2
a809 1
Expansion of special
d811 1
a811 1
sequences is the same as for
@


1.86
log
@finish moving annotations around
@
text
@d1 1
a1 1
.\"	$OpenBSD: pkg_create.1,v 1.85 2014/01/03 12:54:59 espie Exp $
a216 1
.Pp
@


1.85
log
@start moving internal annotations' description into package(5) proper,
pkg_create(1) should only document what users can use.
Accordingly, describe dependencies in terms of -P and -W directly.
@
text
@d1 1
a1 1
.\"	$OpenBSD: pkg_create.1,v 1.84 2014/01/02 17:02:48 espie Exp $
d24 1
a24 1
.Dd $Mdocdate: January 2 2014 $
a537 4
.It Cm @@ignore
Was used internally to tell extraction to ignore the next file.
No longer needed.
.Pp
a559 10
.It Cm @@link Ar name
Added after a file entry by
.Nm
to record that the entry is actually a hard link.
.Pp
.It Cm @@localbase Ar base
Used internally to record the settings of
.Fl L
option.
.Pp
a574 9
.It Cm @@md5
Added after a file entry by
.Nm
to record the files's cryptographic checksum.
Replaced by
.Cm @@sha
since
.Ox 4.5 .
.Pp
a582 10
.It Cm @@name Ar pkgname
Set the name of the package.
This name is potentially different than the name of
the file it came in, and is used when keeping track of the package
for later deinstallation.
Note that
.Nm
will derive this field from the package name and add it automatically
if none is given.
.Pp
d634 1
a634 1
Some options are not documented yet.
a771 6
.It Cm @@sha
Added after a file entry by
.Nm
to record the files's cryptographic checksum,
as a sha256 digest encoded in base64.
.Pp
a778 10
.It Cm @@size
Added after a file entry by
.Nm
to record a file size.
.Pp
.It Cm @@symlink Ar name
Added after a file entry by
.Nm
to record that the entry is actually a symbolic link.
.Pp
d825 1
a826 5
.It Cm @@url
Original location of the package, automatically recorded in installed packages
by
.Xr pkg_add 1 .
.El
@


1.84
log
@Someone accidentally the verb (Henri Kemppainen)
@
text
@d1 1
a1 1
.\"	$OpenBSD: pkg_create.1,v 1.83 2014/01/02 15:01:37 espie Exp $
d39 1
a39 1
.Op Fl P Ar pkg-dependency
d42 1
a42 1
.Op Fl W Ar wantedlib
d98 2
a99 4
It will also check all
.Cm @@wantlib
for reachability, by looking into all installed
.Cm @@depend .
d101 1
a101 3
provided some other
.Cm @@depend
refers to the same
d109 1
a109 3
subset of
.Cm @@depend
that are not pure
d177 2
a178 1
as the localbase used in the package.
d180 2
a181 1
.Pa /usr/local .
d201 17
a217 4
.It Fl P Ar pkg-dependency
Specify a
.Cm @@depend
dependency on the command line.
d283 20
a302 4
.It Fl W Ar wantedlib
Specify a
.Cm @@wantlib
requirement on the command line.
d331 1
a331 1
There are a few annotations that can be inserted for better control.
d334 1
a334 1
Here is a list:
a359 3
.It Cm @@arch Ar arches
List of architectures for which this package is intended.
.Pp
a397 24
.It Xo
.Cm @@depend
.Sm off
.Ar pkgpath :
.Ar pkgspec :
.Ar default
.Sm on
.Xc
Declare a dependency on a package matching
.Ar pkgspec
.Pq see Xr packages-specs 7 .
An appropriate package must be installed before this package may be
installed, and that package must be deinstalled before this package
is deinstalled.
The dependency also contains a
.Ar pkgpath
.Po
see
.Xr pkgpath 7
.Pc
and a
.Ar default
package name, in case there is no listing of available packages.
.Pp
a415 7
.It Cm @@display Ar name
Declare
.Pa name
as the file to be displayed at install time (see
.Fl M
above).
.Pp
a878 21
.Pp
.It Cm @@wantlib Ar libspec
Package needs a shared library to work.
.Ar libspec
is
.Sq name.major.minor
or
.Sq path/name.major.minor .
The package won't be installed unless a library with the same name,
the exact same major number and at least the same minor number can
be located.
A library without path is searched through dependent packages under the
same
.Ar localbase ,
then in the system libraries under
.Pa /usr/lib
and
.Pa /usr/X11R6/lib .
A library with a path is only searched through dependent packages,
that path being relative to
.Ar localbase .
d880 4
@


1.83
log
@Document new options related to signatures
@
text
@d1 1
a1 1
.\"	$OpenBSD: pkg_create.1,v 1.82 2012/06/08 15:15:58 espie Exp $
d24 1
a24 1
.Dd $Mdocdate: June 8 2012 $
d63 1
a63 1
command is normally used to a binary package named
@


1.82
log
@document pkgpath matching a bit more thoroughly, be more consistent in
naming stuff.
(based on a comment from sthen@@)
@
text
@d1 1
a1 1
.\"	$OpenBSD: pkg_create.1,v 1.81 2012/06/08 15:02:10 espie Exp $
d52 1
d54 6
d63 1
a63 1
command creates a binary package named
d84 3
d164 2
d202 3
d225 9
d235 2
a236 2
.Fl s Ar x509
.Fl s Ar cert
d240 9
a248 9
For now, the only supported use involves three
.Fl s
options:
.Ar x509
to indicate X.509-style signatures,
.Ar cert
the path to the signer's certificate
and
.Ar privkey
d250 4
a253 2
The signer's certificate and the signer's private key should be generated
using standard openssl x509 commands.
d258 9
d1027 1
@


1.81
log
@activate new pkg_create magic.
Note that, in most cases, PFRAG.shared are probably no longer needed...
@
text
@d1 1
a1 1
.\"	$OpenBSD: pkg_create.1,v 1.80 2011/11/21 12:56:31 espie Exp $
d24 1
a24 1
.Dd $Mdocdate: November 21 2011 $
d688 1
a688 1
Declare an extra
d734 9
@


1.80
log
@more pkgpath(7)
@
text
@d1 1
a1 1
.\"	$OpenBSD: pkg_create.1,v 1.79 2011/11/21 12:06:12 espie Exp $
d309 1
a309 1
Imbed a comment in the packing-list.
d530 1
a530 1
Satisfy LIB_DEPENDS,
d534 3
d875 14
d939 20
d961 1
a961 1
controls the inclusion of fragments
@


1.79
log
@point to pkgpath(7)
@
text
@d1 1
a1 1
.\"	$OpenBSD: pkg_create.1,v 1.78 2011/09/29 17:57:09 jmc Exp $
d24 1
a24 1
.Dd $Mdocdate: September 29 2011 $
d357 4
a360 4
(see
.Ev FULLPKGPATH
in
.Xr bsd.port.mk 5 )
@


1.78
log
@ssl.8: Certifying Authority -> Certificate Authority
isakmpd.8: rsa:1024 -> rsa:2048 (ok markus)
all: X509 -> X.509

from Lawrence Teo
@
text
@d1 1
a1 1
.\"	$OpenBSD: pkg_create.1,v 1.77 2011/06/09 11:19:33 sthen Exp $
d24 1
a24 1
.Dd $Mdocdate: June 9 2011 $
d951 1
@


1.77
log
@fix @@ask-update example
@
text
@d1 1
a1 1
.\"	$OpenBSD: pkg_create.1,v 1.76 2011/05/30 10:35:40 jmc Exp $
d24 1
a24 1
.Dd $Mdocdate: May 30 2011 $
d220 1
a220 1
to indicate x509-style signatures,
@


1.76
log
@tweak previous;
@
text
@d1 1
a1 1
.\"	$OpenBSD: pkg_create.1,v 1.75 2011/05/30 09:59:38 espie Exp $
d294 1
a294 1
@@ask-update postgresql-server<-8 Make sure your existing database is backed up
@


1.75
log
@turn @@pkgpath into real objects, to simplify some updates by not having to
figure out what matches precisely.

approved by dcoppa@@. okay sthen@@, landry@@
@
text
@d1 1
a1 1
.\"	$OpenBSD: pkg_create.1,v 1.74 2011/03/19 09:39:39 jmc Exp $
d24 1
a24 1
.Dd $Mdocdate: March 19 2011 $
d707 1
a708 1
.Ed
@


1.74
log
@fix some name[=value] horrors;
@
text
@d1 1
a1 1
.\"	$OpenBSD: pkg_create.1,v 1.73 2011/03/19 09:32:36 jmc Exp $
d700 31
@


1.73
log
@Xr pkg.conf.5; from Patrick Lamaiziere
ok espie
@
text
@d1 1
a1 1
.\"	$OpenBSD: pkg_create.1,v 1.72 2011/02/07 00:02:50 schwarze Exp $
d24 1
a24 1
.Dd $Mdocdate: February 7 2011 $
d121 1
a121 4
.It Xo
.Fl D
.Ar name Ns Op = Ns Ar value
.Xc
@


1.72
log
@Between groff-1.15 and groff-1.20.1, the .Ns macro was changed to no
longer suppress spacing when used at the beginning of an input line,
and mandoc now follows the same behaviour as new groff.
Thus, sweep the tree and remove useless .Ns.
Most places found by jmc@@; ok jmc@@ kristaps@@.
@
text
@d1 1
a1 1
.\"	$OpenBSD: pkg_create.1,v 1.71 2011/01/02 22:58:45 fgsch Exp $
d24 1
a24 1
.Dd $Mdocdate: January 2 2011 $
d921 1
@


1.71
log
@add missing newline between @@url and @@wantlib.
espie@@ ok.
@
text
@d1 1
a1 1
.\"	$OpenBSD: pkg_create.1,v 1.70 2010/12/20 16:30:03 espie Exp $
d24 1
a24 1
.Dd $Mdocdate: December 20 2010 $
d36 1
a36 4
.Oo Fl D Ar name
.Ns Oo Ns = Ns Ar value
.Oc
.Oc
@


1.70
log
@use a better strategy: ask the ports tree for the plist for packages with
the same pkgpath. Thus, PseudoSets need to have a real list, and
pkgcreate needs to loop to solve those depends.

reactivate the check
@
text
@d1 1
a1 1
.\"	$OpenBSD: pkg_create.1,v 1.69 2010/12/20 11:32:30 espie Exp $
d816 1
@


1.69
log
@new check in pkg_create: walk the dependency tree for @@wantlib, thus
preventing packages that won't install (much easier to fix that when
you still have the fake tree around !)

specifically, look into depend that are installed, and possibly in the
fake tree: if the package does build, it requires the libraries to be
around anyways, so pure RUN_DEPENDS are not an issue (and avoid old libraries,
if we find wantlib only in .lib, something really fishy is going on).

Reuse the Dependencies class, so we're sure to have the exact same way
to find libraries.

Also fix exit codes from pkg_create...
@
text
@d1 1
a1 1
.\"	$OpenBSD: pkg_create.1,v 1.68 2010/10/27 17:26:03 espie Exp $
d24 1
a24 1
.Dd $Mdocdate: October 27 2010 $
d48 1
d95 1
a95 2
It will also look into the build directory itself as specified by
.Fl B Ar pkg-destdir ,
@


1.68
log
@document @@rcscript
@
text
@d1 1
a1 1
.\"	$OpenBSD: pkg_create.1,v 1.67 2010/10/22 15:59:50 espie Exp $
d24 1
a24 1
.Dd $Mdocdate: October 22 2010 $
d89 21
@


1.67
log
@USE_GROFF
@
text
@d1 1
a1 1
.\"	$OpenBSD: pkg_create.1,v 1.66 2010/10/04 16:07:56 jmc Exp $
d24 1
a24 1
.Dd $Mdocdate: October 4 2010 $
d685 16
@


1.66
log
@tweak previous;
@
text
@d1 1
a1 1
.\"	$OpenBSD: pkg_create.1,v 1.65 2010/10/04 10:44:58 espie Exp $
d136 3
@


1.65
log
@document ask-update
@
text
@d1 1
a1 1
.\"	$OpenBSD: pkg_create.1,v 1.64 2010/06/25 09:00:56 espie Exp $
d24 1
a24 1
.Dd $Mdocdate: June 25 2010 $
d275 2
a276 2
.Bd -literal
	@@ask-update postgresql-server<-8 Make sure your existing database is backed up
d278 1
d281 1
@


1.64
log
@sha25 -> sha256 as noticed by Nigel Taylor
@
text
@d1 1
a1 1
.\"	$OpenBSD: pkg_create.1,v 1.63 2010/06/09 10:25:17 espie Exp $
d24 1
a24 1
.Dd $Mdocdate: June 9 2010 $
d259 21
@


1.63
log
@uniform spelling: packing-list
@
text
@d1 1
a1 1
.\"	$OpenBSD: pkg_create.1,v 1.62 2010/06/05 07:11:43 espie Exp $
d24 1
a24 1
.Dd $Mdocdate: June 5 2010 $
d683 1
a683 1
as a sha25 digest encoded in base64.
@


1.62
log
@document front-end changes
@
text
@d1 1
a1 1
.\"	$OpenBSD: pkg_create.1,v 1.61 2010/05/10 09:17:55 espie Exp $
d24 1
a24 1
.Dd $Mdocdate: May 10 2010 $
d145 1
a145 1
.Dq packing list
d240 1
a240 1
.Sh PACKING LIST DETAILS
d242 1
a242 1
.Dq packing list
d268 1
a268 1
Imbed a comment in the packing list.
@


1.61
log
@whitespace fixes
@
text
@d1 1
a1 1
.\"	$OpenBSD$
d24 1
a24 1
.Dd $Mdocdate$
d33 1
a33 1
.Op Fl nQqvx
d166 4
@


1.60
log
@progress-meter -> progress meter, which is at least consistent with our
other pages;
@
text
@d1 1
a1 1
.\"	$OpenBSD: pkg_create.1,v 1.59 2010/02/28 10:08:48 espie Exp $
d24 1
a24 1
.Dd $Mdocdate: February 28 2010 $
@


1.59
log
@ProgressMeter support.
@
text
@d1 1
a1 1
.\"	$OpenBSD$
d24 1
a24 1
.Dd $Mdocdate$
d222 1
a222 1
Disable progress-meter.
@


1.58
log
@revert rev. 1.54 because it doesn't change the rendering with groff
but breaks the build with mandoc(1);
ok jmc@@ espie@@
@
text
@d1 1
a1 1
.\"	$OpenBSD: pkg_create.1,v 1.57 2010/02/04 07:49:15 jmc Exp $
d24 1
a24 1
.Dd $Mdocdate: February 4 2010 $
d33 1
a33 1
.Op Fl nQqv
d221 2
@


1.57
log
@no -S option; from Daniel Dickman
@
text
@d1 1
a1 1
.\"	$OpenBSD: pkg_create.1,v 1.56 2010/01/10 22:44:00 espie Exp $
d24 1
a24 1
.Dd $Mdocdate: January 10 2010 $
a252 1
.Pp
@


1.56
log
@fix some mdoc tidbits. Thanks to jmc@@ for advice.
@
text
@d1 1
a1 1
.\"	$OpenBSD$
d24 1
a24 1
.Dd $Mdocdate$
a844 2
or
.Fl S
@


1.55
log
@unify options a bit: use -Dname=value for defines uniformously (e.g., deprecate
-F keyword heavily).
@
text
@d103 4
a106 1
.It Fl D Ar name Ns = Ns Ar value
d110 2
a111 1
.Ar value ,
@


1.54
log
@use Auto::cache
@
text
@d37 2
a38 1
.Ns = Ns Ar value
@


1.53
log
@Neither .Pp nor unqualified text are allowed at the top level of .Bl;
instead, .It is required.  Thus, move .Pp and text before the .Bl,
and remove the .Pp altogether where it is not needed.

Syntax errors found by mandoc(1), also required to fix the mandoc build;
feedback and ok jmc@@, and sobrado@@ also supports the direction.
@
text
@d1 1
a1 1
.\"	$OpenBSD: pkg_create.1,v 1.52 2010/01/01 16:17:19 espie Exp $
d24 1
a24 1
.Dd $Mdocdate: January 1 2010 $
d248 1
@


1.52
log
@explain -Dvalues better
@
text
@d1 1
a1 1
.\"	$OpenBSD$
d24 1
a24 1
.Dd $Mdocdate$
a247 1
.Pp
@


1.51
log
@New and shiny:
- describe @@sha, @@option explicit-update, @@url
- describe -Dname=value in more detail
- remove some deprecated/obsolete options
- rework synopsis to better show mandatory parts
@
text
@d52 1
d115 3
d122 3
d126 1
a130 2
.It Ar PERMIT_PACKAGE_CDROM
.It Ar PERMIT_PACKAGE_FTP
@


1.50
log
@Document @@option always-update
@
text
@a38 2
.Op Fl i Ar iscript
.Op Fl k Ar dscript
a41 1
.Op Fl p Ar prefix
a42 1
.Op Fl S Ar pkg-destdir
a44 1
.Fl c Ar desc
d46 1
d48 1
a100 14
.It Fl c No [-] Ns Ar desc
Fetch package
.Dq one line description
from file
.Ar desc
or, if preceded by
.Sq - ,
the argument itself.
This string should also
give some idea of which version of the product (if any) the package
represents.
Deprecated, use
.Fl D Ar COMMENT Ns = Ns Ar value
instead.
d107 19
a138 18
.It Fl i Ar iscript
Set
.Ar iscript
to be the install procedure for the package (deprecated, use
.Cm @@exec
instead).
This can be any executable program (or shell script).
It will be invoked automatically
when the package is later installed.
.It Fl k Ar dscript
Set
.Ar dscript
to be the de-install procedure for the package (deprecated, use
.Cm @@unexec
instead).
This can be any executable program (or shell script).
It will be invoked automatically
when the package is later (if ever) de-installed.
d182 1
a182 1
Specify signature parameters for signed packages. 
a198 5
.It Fl S Ar pkg-destdir
Deprecated, use
identical
.Fl B
option instead.
a325 8
.It Cm @@dirrm Ar directoryname
Declare directory
.Pa directoryname
to be deleted at deinstall time.
Deprecated, use
.Dl directoryname/
instead, as it handles proper directory creation as well.
.Pp
d507 4
d590 6
d663 6
d733 4
@


1.49
log
@initial implementation of package signatures, based on x509 certificates and
smime detached signatures.
@
text
@d608 7
@


1.48
log
@kill trailing whitespace;
@
text
@d1 1
a1 1
.\"	$OpenBSD: pkg_create.1,v 1.47 2008/07/25 19:39:40 ian Exp $
d24 1
a24 1
.Dd $Mdocdate: July 25 2008 $
d45 1
d193 22
d841 1
@


1.47
log
@Mention @@bin plist element, ok espie@@
@
text
@d1 1
a1 1
.\"	$OpenBSD: pkg_create.1,v 1.46 2008/04/07 12:30:04 espie Exp $
d24 1
a24 1
.Dd $Mdocdate: April 7 2008 $
d245 1
a245 1
Describe the file as an 
@


1.46
log
@deprecate -c, we've been using -DCOMMENT=value more or less forever by now.
@
text
@d1 1
a1 1
.\"	$OpenBSD$
d24 1
a24 1
.Dd $Mdocdate$
d243 5
@


1.45
log
@Slight rewording of @@depend description (this -> that)

ok espie
@
text
@d1 1
a1 1
.\"	$OpenBSD: pkg_create.1,v 1.44 2007/07/18 05:58:32 ajacoutot Exp $
d24 1
a24 1
.Dd $Mdocdate: July 18 2007 $
d114 3
@


1.44
log
@- document the fact that mkfontscale is now run as well as mkfontdir and
fc-cache for @@fontdir

ok kili@@ espie@@
@
text
@d1 1
a1 1
.\"	$OpenBSD: pkg_create.1,v 1.43 2007/06/17 10:35:55 espie Exp $
d24 1
a24 1
.Dd $Mdocdate: June 17 2007 $
d286 1
a286 1
installed, and this package must be deinstalled before this package
@


1.43
log
@document @@exec/@@unexec variations in more detail.
Point users at pkg_create for packing-list details (suggested by
ajacoutot@@)
@
text
@d1 1
a1 1
.\"	$OpenBSD: pkg_create.1,v 1.42 2007/06/14 10:16:37 espie Exp $
d24 1
a24 1
.Dd $Mdocdate: June 14 2007 $
d439 2
@


1.42
log
@explicitly mark -S as deprecated, I'd love to use for something else...
@
text
@d1 1
a1 1
.\"	$OpenBSD: pkg_create.1,v 1.41 2007/06/02 15:32:07 jmc Exp $
d24 1
a24 1
.Dd $Mdocdate: June 2 2007 $
d342 9
d388 16
d680 25
@


1.41
log
@zap trailing whitespace;
@
text
@d1 1
a1 1
.\"	$OpenBSD: pkg_create.1,v 1.40 2007/06/02 10:19:29 espie Exp $
d190 2
a191 6
Set
.Ar pkg-destdir
as the prefix to prepend to any file to select for the package.
This option is identical to the
.Fl B
option; however the
d193 1
a193 1
option is preferred.
@


1.40
log
@document how fragments work.
document a few `internal' keywords
document some of the checks that pkg_create does during archive creation.
@
text
@d1 1
a1 1
.\"	$OpenBSD: pkg_create.1,v 1.39 2007/05/31 19:20:26 jmc Exp $
d24 1
a24 1
.Dd $Mdocdate: May 31 2007 $
d709 1
a709 1
current packing-list, and the variable name 
d734 1
a734 1
If a positive or a negative fragment file does not exist, the corresponding 
@


1.39
log
@convert to new .Dd format;
@
text
@d1 1
a1 1
.\"	$OpenBSD: pkg_create.1,v 1.38 2007/05/31 11:05:41 espie Exp $
d24 1
a24 1
.Dd $Mdocdate$
d79 11
d453 5
d478 5
d628 10
d689 61
@


1.38
log
@kill REQ script directly. I'm pretty sure it doesn't quite work anyways.
Deprecate INSTALL and DEINSTALL, write out warnings in pkg_create.

Clean up some more old cruft
@
text
@d1 1
a1 1
.\"	$OpenBSD: pkg_create.1,v 1.37 2007/05/22 11:02:57 espie Exp $
d24 1
a24 1
.Dd April 21, 1995
@


1.37
log
@zap references to pkgdep. Packing-Lists no longer even record it, anyways.
@
text
@d1 1
a1 1
.\"	$OpenBSD: pkg_create.1,v 1.36 2007/05/22 00:25:42 espie Exp $
a44 1
.Op Fl r Ar rscript
d125 3
a127 1
to be the install procedure for the package.
d134 3
a136 1
to be the de-install procedure for the package.
a177 10
.It Fl r Ar rscript
Set
.Ar rscript
to be the
.Dq requirements
procedure for the package.
This can be any executable program (or shell script).
It will be invoked automatically
at installation/deinstallation time to determine whether or not
installation/deinstallation should proceed.
@


1.36
log
@finish removing unused -h option
@
text
@d1 1
a1 1
.\"	$OpenBSD: pkg_create.1,v 1.35 2007/04/30 08:43:19 espie Exp $
a568 17
instead.
.Pp
.It Cm @@pkgdep Ar pkgname
Declare a dependency on the
.Ar pkgname
package.
The
.Ar pkgname
package must be installed before this package may be
installed, and this package must be deinstalled before the
.Ar pkgname
package is deinstalled.
Multiple
.Cm @@pkgdep
directives may be used if the package depends on multiple other packages.
Deprecated, use
.Cm @@depend
@


1.35
log
@add most things concerning @@ignore, since we now have ways nicer to do
things.

We still recognize @@ignore in packing-lists for now, but we don't handle
it. Not that register-plist has smart enough comparison functions that
it doesn't care about @@ignore at all...
@
text
@d1 1
a1 1
.\"	$OpenBSD: pkg_create.1,v 1.34 2007/04/23 14:47:37 jmc Exp $
d33 1
a33 1
.Op Fl hnQqv
a122 5
.It Fl h
Force
.Xr tar 1
to follow symbolic links, so that the files they point to
are dumped, rather than the links themselves (deprecated).
@


1.34
log
@groff cannot deal with ".Li" before other macros that change font - just
remove it;
@
text
@d1 1
a1 1
.\"	$OpenBSD: pkg_create.1,v 1.33 2007/04/23 11:13:07 espie Exp $
d432 2
a433 2
Used internally to tell extraction to ignore the next file (don't
copy it anywhere), as it's used for some special purpose.
@


1.33
log
@Document
@@comment no checksum
as noticed by Martynas.
@
text
@d1 1
a1 1
.\"	$OpenBSD: pkg_create.1,v 1.32 2007/04/15 10:17:29 espie Exp $
d255 1
a255 1
.Li Cm @@comment Ar "no checksum"
@


1.32
log
@update copyright years, standardize licence.
reword the introduction to the stuff originally from FreeBSD to clarify
slightly.
@
text
@d1 1
a1 1
.\"	$OpenBSD: pkg_create.1,v 1.31 2006/10/15 15:37:28 jmc Exp $
d253 7
@


1.31
log
@tweaks;
@
text
@d1 1
a1 1
.\"	$OpenBSD: pkg_create.1,v 1.30 2006/10/15 09:32:52 espie Exp $
d3 2
a4 2
.\" FreeBSD install - a package for the installation and maintenance
.\" of non-core utilities.
a16 3
.\"
.\"     @@(#)pkg_create.1
.\"	from FreeBSD Id: pkg_create.1,v 1.19 1997/05/02 22:00:05 max Exp
@


1.30
log
@Normalize query options: make them not stop the package generation unless
-n is also mentioned. Do some devious speed tricks in case -n && -[qQ]
(forgetting to checksum files, for instance), so that it can be used for
batch jobs.
@
text
@d1 1
a1 1
.\"	$OpenBSD: pkg_create.1,v 1.29 2006/01/12 11:33:59 espie Exp $
d36 1
a36 1
.Op Fl hnqQv
d174 4
d180 1
a180 1
(query mode),
a182 7
.It Fl Q
Print out the files in the actual packing-list of the package being 
generated, with explicit typing 
.Po e.g.,
.Cm @@file ,
.Cm @@lib ...
.Pc
@


1.29
log
@be way more explicit in pointing people to packages-specs(7)
@
text
@d1 1
a1 1
.\"	$OpenBSD: pkg_create.1,v 1.28 2005/11/18 10:56:15 jmc Exp $
d36 1
a36 1
.Op Fl hnv
d174 12
@


1.28
log
@restructure some text slightly;
ok espie@@
@
text
@d1 1
a1 1
.\"	$OpenBSD: pkg_create.1,v 1.27 2005/11/17 11:20:24 espie Exp $
d73 3
@


1.27
log
@finally get around to documenting the alternate call to pkg_create.
@
text
@d1 1
a1 1
.\"	$OpenBSD: pkg_create.1,v 1.26 2005/10/10 09:38:29 espie Exp $
d206 7
a212 3
from the installation, or error out if any problem is found, e.g.,
.Bd -literal
	pkg_create -f /var/db/pkg/kdelibs-3.4.3/+CONTENTS
a213 3
will recreate a
.Pa kdelibs-3.4.3.tgz
package.
@


1.26
log
@Xref package(5)
@
text
@d1 1
a1 1
.\"	$OpenBSD: pkg_create.1,v 1.25 2005/09/14 10:38:02 espie Exp $
d57 2
d202 11
@


1.25
log
@document @@pkgpath
@
text
@d1 1
a1 1
.\"	$OpenBSD: pkg_create.1,v 1.24 2004/12/01 12:17:40 espie Exp $
d674 1
@


1.24
log
@allow stuff to recreate a package from an installed CONTENTS: since
we have all the md5 and stuff, we just need to make sure the package is
correct (hence verify_checksum).

Add a -n option to pkg_create: this is consistent with pkg_add/pkg_delete,
and with this new verify_checksum, pkg_create can be used to check that a
package still matches its contents.
@
text
@d1 1
a1 1
.\"	$OpenBSD: pkg_create.1,v 1.23 2004/11/21 11:29:35 xsa Exp $
d562 17
@


1.23
log
@remove .Xr's that do not belong here anymore with the new pkg_* tools;
espie@@ ok.
@
text
@d1 1
a1 1
.\"	$OpenBSD: pkg_create.1,v 1.22 2004/11/19 00:02:51 jmc Exp $
d36 1
a36 1
.Op Fl hv
d156 2
@


1.22
log
@tweaks;
@
text
@d1 1
a1 1
.\"	$OpenBSD: pkg_create.1,v 1.21 2004/11/18 21:51:43 espie Exp $
a653 1
.Xr sysconf 3 ,
@


1.21
log
@document @@wantlib, @@depend. Provide -P and -W flags to be able to specify
those on the command line instead of having to generate a separate plist.
@
text
@d1 1
a1 1
.\"	$OpenBSD: pkg_create.1,v 1.20 2004/11/15 13:20:40 jmc Exp $
d263 4
a266 1
.Pq see Ev FULLPKGPATH in Xr bsd.port.mk 5
d270 1
d608 1
@


1.20
log
@tweaks;
ok espie@@
@
text
@d1 1
a1 1
.\"	$OpenBSD: pkg_create.1,v 1.19 2004/11/15 10:43:45 jmc Exp $
d46 1
d51 1
d156 4
d193 4
d226 1
a226 4
.Po
see
.Xr bsd.port.mk 5
.Pc
d232 1
a232 4
.Po
see
.Xr packages-specs 7
.Pc .
d247 20
d553 3
d604 20
@


1.19
log
@sort options; whitespace;
ok espie@@
@
text
@d1 1
a1 1
.\"	$OpenBSD: pkg_create.1,v 1.18 2004/10/18 14:37:20 espie Exp $
d39 3
a41 1
.Op Fl D Ar name=value
d50 3
a52 3
.Fl c Ar comment
.Fl d Ar description
.Fl f Ar packlist
d67 1
a67 1
.Pa .tgz
d85 5
a89 1
.It Fl c [ Ar \&- ] Ns Ar desc
d95 1
a95 1
.Dq \&- ,
d100 7
a106 3
.It Fl D Ar name=value
Define name to value, for substitution and fragment inclusion purpose.
.It Fl d [ Ar \&- ] Ns Ar desc
d110 1
a110 1
.Dq \&- ,
a171 1
.It Fl B Ar pkg-destdir
d175 5
a179 2
Prefer
.Fl B .
d205 3
a207 1
.Bl -tag -width indent
d210 1
d221 1
d226 1
a226 1
See
d237 1
d242 1
d251 1
d260 1
d268 1
d275 1
d281 1
d323 1
d327 1
a327 1
to be deleted at deinstall time, if user sets
d336 1
d341 1
d349 1
d364 1
d370 1
d374 1
d384 1
d393 1
d398 1
d403 1
d413 1
d421 1
d431 2
a432 1
.It Cm @@newgroup Ar name:gid
d439 3
a441 1
can be prefixed with a ! to ensure group has the correct gid.
d446 13
a458 1
.It Cm @@newuser Ar name:uid:group:loginclass:comment:home:shell
d461 2
a462 1
create a new user, happens before any file creation.
d468 3
a470 1
Individual fields can be prefixed by a ! to make sure an existing
d474 1
a474 1
will make sure user foo has uid 42.
d479 1
d490 1
d496 1
d515 1
d529 1
d548 1
d555 3
a557 2
.It Cm @@sysctl Ar var=val
.It Cm @@sysctl Ar var>=val
d567 1
d584 1
a584 1
.Fl D Ar name=value
d602 4
a605 1
.Xr sysconf 3
@


1.18
log
@Documents @@endfake and -Q semantics.
@
text
@d1 1
a1 1
.\"	$OpenBSD: pkg_create.1,v 1.17 2004/10/13 18:44:09 espie Exp $
a39 1
.Op Fl p Ar prefix
d42 3
a46 1
.Op Fl M Ar displayfile
a47 1
.Op Fl L Ar localbase
a82 7
.It Fl f Ar packinglist
Fetch
.Dq packing list
for package from the file
.Ar packinglist .
Several packing-lists can be mentioned, in which case they will be 
concatenated together.
d94 2
d102 7
a108 4
.It Fl D Ar name=value
Define name to value, for substitution and fragment inclusion purpose.
.It Fl v
Turn on verbose output.
d121 1
a121 1
.It Fl p Ar prefix
d123 5
a127 12
.Ar prefix
as the initial directory
.Dq base
to start from in selecting files for
the package, and to record as the base for installing the package.
.It Fl S Ar pkg-destdir
.It Fl B Ar pkg-destdir
Set
.Ar pkg-destdir
as the prefix to prepend to any file to select for the package.
Prefer
.Fl B .
d138 7
a144 1
.It Fl k Ar dscript
d146 5
a150 5
.Ar dscript
to be the de-install procedure for the package.
This can be any executable program (or shell script).
It will be invoked automatically
when the package is later (if ever) de-installed.
d161 7
a167 6
.It Fl M Ar displayfile
Display the file (using
.Xr more 1 )
after installing the package.
Useful for things like
legal notices on almost-free software, etc.
d173 2
d190 1
a190 1
All these commands start with an 
a193 64
.It Cm @@file Ar filename
Default annotation, to use if
.Ar filename
begins with @@.
.Ar filename
is always a relative path, relative to the current
.Cm @@cwd .
.It Cm @@man Ar filename
Specialized version of
.Cm @@file ,
to handle manual pages.
.It Cm @@info Ar filename
Specialized version of
.Cm @@file ,
to handle GNU info files.
Automatically grab
.Pa filename-*
chapter files, run
.Xr install-info 1
as needed.
.It Cm @@lib Ar filename
Specialized version of
.Cm @@file ,
to handle shared libraries.
Satisfy LIB_DEPENDS,
run
.Xr ldconfig 8
as needed.
.It Cm @@shell Ar filename
Specialized version of
.Cm @@file , 
to handle shells.
See
.Xr shells 5 .
.It Cm @@newuser Ar name:uid:group:loginclass:comment:home:shell
During
.Xr pkg_add 1 ,
create a new user, happens before any file creation.
All fields correspond to
.Xr useradd 8
parameters.
Some fields are optional and can be left empty.
If the user already exists, no action is taken.
Individual fields can be prefixed by a ! to make sure an existing
user matches.
For instance, the directive
.Li @@newuser foo:!42
will make sure user foo has uid 42.
During
.Xr pkg_delete 1 ,
users will be deleted if extra clean-up has been requested, and if
other installed packages don't list the same user.
.It Cm @@newgroup Ar name:gid
During
.Xr pkg_add 1 ,
create a new group, using
.Xr groupadd 8 .
Happens before file and user creations.
.Ar gid
can be prefixed with a ! to ensure group has the correct gid.
During
.Xr pkg_delete 1 ,
groups will be deleted if extra clean-up has been requested, and if
other installed packages don't list the same group.
d196 25
d223 1
a223 1
All subsequent filenames will be assumed relative to 
d225 29
a274 8
.It Cm "\&%F"
Expands to the last filename extracted (as specified); in the example case,
.Pa bin/emacs .
.It Cm "\&%D"
Expands to the current directory prefix, as set with
.Cm @@cwd ;
in the example case
.Pa /usr/local .
d283 8
d300 14
a313 2
.It Cm @@unexec Ar command
Execute
d315 64
a378 17
during
.Xr pkg_delete 1 .
Expansion of special
.Cm \&%
sequences is the same as for
.Cm @@exec .
.It Cm @@sysctl Ar var=val
.It Cm @@sysctl Ar var>=val
During
.Xr pkg_add 1 ,
check that
.Xr sysctl 8
variable 
.Ar var
is set to exactly/at least a given value
.Ar val .
Adjust it otherwise.
a385 27
.It Cm @@owner Ar user
Set default ownership for all subsequently extracted files to
.Ar user .
Use without an arg to set back to default (extraction)
ownership.
.It Cm @@group Ar group
Set default group ownership for all subsequently extracted files to
.Ar group .
Use without an arg to set back to default (extraction)
group ownership.
.It Cm @@comment Ar string
Imbed a comment in the packing list.
Useful in trying to document some particularly hairy sequence that
may trip someone up later.
Can also be used to comment out elements that update-plist
.Po
see
.Xr bsd.port.mk 5
.Pc
will insist in inserting in a packing-list.
.It Cm @@ignore
Used internally to tell extraction to ignore the next file (don't
copy it anywhere), as it's used for some special purpose.
.It Cm @@localbase Ar base
Used internally to record the settings of
.Fl L
option.
d395 60
a454 20
.It Cm @@dir Ar directoryname
Create directory 
.Pa directoryname 
at 
.Xr pkg_add 1
time, taking 
.Cm @@mode ,
.Cm @@group ,
.Cm @@owner
into account, and remove it during
.Xr pkg_delete 1 .
Directories to remove can be shared between packages.
If
.Ar name
does not begin with an @@, same as
.Dl name/
.It Cm @@dirrm Ar directoryname
Declare directory
.Pa directoryname
to be deleted at deinstall time.
d456 15
a470 41
.Dl directoryname/
instead, as it handles proper directory creation as well.
.It Cm @@mandir Ar directoryname
Specialized version of
.Cm @@dir ,
to handle manual directories: instruct user to add/remove the
directory to 
.Xr man.conf 5 ,
remove
.Xr apropos 1
database when needed.
.It Cm @@fontdir Ar directoryname
Specialized version of
.Cm @@dir ,
to handle font directories: create
.Pa font.alias
from
.Pa font.alias-*
fragments, execute
.Xr mkfontdir 1 ,
.Xr fc-cache 1
when needed.
Delete extra files at
.Xr pkg_delete 1
time.
.It Cm @@extra Ar filename
Declare extra file
.Pa filename
to be deleted at deinstall time, if user sets
.Fl c
option.
Those files are extra configuration files that are normally not deleted.
.Ar filename
can be an absolute path.
If
.Pa filename
ends with a slash, it is a directory.
.It Cm @@extraunexec Ar command
Extra
.Ar command
to execute when removing extra files.
d489 4
a492 4
.It Cm @@conflict Ar pkgspec
Declare a conflict with packages matching
.Ar pkgspec
.Po
d494 21
a514 57
.Xr packages-specs 7 
.Pc .
The
.Ar pkgname
package can
.Em not
be installed if a package
matching
.Ar pkgspec
has been installed because they install the same files and thus conflict.
.It Cm @@display Ar name
Declare
.Pa name
as the file to be displayed at install time (see
.Fl M
above).
.It Cm @@pkgdep Ar pkgname
Declare a dependency on the
.Ar pkgname
package.
The
.Ar pkgname
package must be installed before this package may be
installed, and this package must be deinstalled before the
.Ar pkgname
package is deinstalled.
Multiple
.Cm @@pkgdep
directives may be used if the package depends on multiple other packages.
.It Cm @@pkgcfl Ar pkgcflname
Declare a conflict to the
.Ar pkgcflname
package.
The
.Ar pkgcflname
package must
.Em not
be installed if
.Ar pkgname
package gets installed because they install the same files and thus conflict.
.Ar pkgcflname
may use
.Xr fnmatch 3
wildcards.
Deprecated, use
.Cm @@conflict
instead.
.It Cm @@option Ar name
Effects vary depending on
.Ar name .
Some options are not documented yet.
.Bl -tag -width indent
.It Ar no-default-conflict
By default, a package conflicts with other versions of the same package.
With this option, the older package version will still be noticed, but the
installation will proceed anyway.
.El
@


1.17
log
@document @@sysctl
@
text
@d1 1
a1 1
.\"	$OpenBSD: pkg_create.1,v 1.16 2004/10/11 10:30:33 espie Exp $
d264 5
@


1.16
log
@add support for undisplay file, to be able to show information at pkg
removal without having to run a DEINSTALL script...
@
text
@d1 1
a1 1
.\"	$OpenBSD: pkg_create.1,v 1.15 2004/10/11 10:07:37 espie Exp $
d314 11
@


1.15
log
@kill old MTREE option that was never implemented in the new tools anyways.
kill -C and -P options which are definitely no longer used as well.
Reorder special files so that REQUIRE is at front (and it's executed first
anyways).
@
text
@d1 1
a1 1
.\"	$OpenBSD: pkg_create.1,v 1.14 2004/09/22 10:57:27 espie Exp $
d46 1
d170 5
@


1.14
log
@document the semantics of @@newuser/@@newgroup
@
text
@d1 1
a1 1
.\"	$OpenBSD: pkg_create.1,v 1.13 2004/09/18 09:22:14 espie Exp $
a39 2
.Op Fl P Ar dpkgs
.Op Fl C Ar cpkgs
a121 8
.It Fl P Ar dpkgs
Set the initial package dependency list to
.Ar dpkgs 
(deprecated).
.It Fl C Ar cpkgs
Set the initial package conflict list to
.Ar cpkgs 
(deprecated).
@


1.13
log
@document new @@shell and @@conflict.
@
text
@d1 1
a1 1
.\"	$OpenBSD: pkg_create.1,v 1.12 2004/09/15 18:54:17 espie Exp $
d232 30
@


1.12
log
@Support for -Dvar=value in pkg_create:
- do the substitution for ${var}
- handle fragments %%var%% depending on value being 0 or 1.
@
text
@d1 1
a1 1
.\"	$OpenBSD: pkg_create.1,v 1.11 2004/08/10 12:50:14 espie Exp $
d226 6
d309 6
d411 15
d460 3
@


1.11
log
@Document @@man, @@info, @@lib, @@mandir, @@fontdir.
@
text
@d1 1
a1 1
.\"	$OpenBSD: pkg_create.1,v 1.10 2004/08/06 16:45:51 millert Exp $
d39 1
d47 1
a47 1
.Op Fl D Ar displayfile
d88 3
a90 5
.Ar packinglist
or stdin if
.Ar packinglist
is a dash
.Dq \&- .
d108 2
d173 1
a173 1
.It Fl D Ar displayfile
d188 3
d403 1
a403 1
.Fl D
d444 8
@


1.10
log
@Use .Dl instead of a literal block when we only have a single line.  Has
the side effect of fixing some ugly indentation (or the lack thereof).
@
text
@d1 1
a1 1
.\"	$OpenBSD: pkg_create.1,v 1.9 2004/08/06 16:41:31 millert Exp $
d201 21
d338 24
a361 1
.It Cm @@extra Ar file
d363 1
a363 1
.Pa file
d368 1
a368 1
.Ar file
d371 1
a371 1
.Pa file
@


1.9
log
@Fix typo (.Bd that should be .Ed)
@
text
@d1 1
a1 1
.\"	$OpenBSD: pkg_create.1,v 1.8 2004/08/06 08:45:11 espie Exp $
d309 1
a309 3
.Bd -literal -offset
name/
.Ed
d315 1
a315 3
.Bd -literal -offset
directoryname/
.Ed
@


1.8
log
@Document filename semantics, @@sample, @@extra.
Clean up.
@
text
@d1 1
a1 1
.\"	$OpenBSD: pkg_create.1,v 1.7 2004/07/14 10:44:03 espie Exp $
d311 1
a311 1
.Bd
@


1.7
log
@Rework @@dirrm: keep them all, and remove them at the end of pkg_delete.
Add @@dir, more powerful than @@dirrm, so that we can get rid of those
pesky @@exec mkdir -p.

okay naddy@@
@
text
@d1 1
a1 1
.\"	$OpenBSD: pkg_create.1,v 1.6 2004/07/05 23:21:56 espie Exp $
d59 2
a60 1
.Xr pkg_add 1
d184 5
a188 2
is fairly simple, being basically a list of filenames to include in
the package.
d194 7
d203 4
a206 7
.It Cm @@cwd Ar directory
Set the internal directory pointer to point to
.Ar directory .
All subsequent filenames will be assumed relative to this directory.
Note:
.Cm @@cd
is also an alias for this command.
d210 2
a211 1
as part of the unpacking process.
d251 2
a252 1
as part of the deinstallation process.
a256 15
This command is not executed during the package add, as
.Cm @@exec
is, but rather when the package is deleted.
This is useful
for deleting links and other ancillary files that were created
as a result of adding the package, but not directly known to
the package's table of contents (and hence not automatically
removable).
The advantage of using
.Cm @@unexec
over a deinstallation script is that you can use the
.Dq special sequence expansion
to get at files regardless of where they've
been potentially redirected (see
.Fl p ) .
d261 2
a262 3
.Cm chmod
command (well, considering that it's later handed off to it, that's
no surprise).
d281 1
a281 1
.It Cm @@localbase
d285 1
a285 1
.It Cm @@name Ar name
a286 1
This is mandatory and is usually put at the top.
d294 1
a294 1
.It Cm @@dir Ar name
d296 17
a312 4
.Pa name 
at install time, taking @@mode, @@group, @@owner into account, 
and remove it at deinstall time.
.It Cm @@dirrm Ar name
d314 1
a314 1
.Pa name
d316 5
a320 8
By default, directories created by a
package installation are not deleted when the package is deinstalled;
this provides an explicit directory cleanup method.
The
.Pa name
directory will not be removed unless it is empty after the package is
de-installed.
Directories to remove can be shared between packages.
d328 2
d337 18
@


1.6
log
@description looking slightly more like a regular manpage and not a pipe-dream.
okay naddy@@, with nits from jmc@@.
@
text
@d1 1
a1 1
.\"	$OpenBSD: pkg_create.1,v 1.5 2004/01/31 17:56:13 espie Exp $
d301 5
a312 4
This directive should appear at the end of the package list.
If more than one
.Cm @@dirrm
directive is used, the directories are removed in the order specified.
d315 3
a317 1
directory will not be removed unless it is empty.
@


1.5
log
@pkg_create -L support, which I forgot to commit.
-B pkg-destdir, synonymous to -S, and PKG_DESTDIR support.
@
text
@d1 1
a1 1
.\"	$OpenBSD: pkg_create.1,v 1.4 2004/01/28 22:12:01 espie Exp $
d32 1
a32 1
.Nd a utility for creating software package distributions
d56 16
a71 10
command is used to create packages that will subsequently be fed to
one of the package extraction/info utilities.
The input description
and command line arguments for the creation of a package are not
really meant to be human-generated, though it is easy enough to
do so.
It is more expected that you will use a front-end tool for
the job rather than muddling through it yourself.
Nonetheless, a short
description of the input syntax is included in this document.
d112 1
a112 1
.Xr tar
d183 6
a188 11
is fairly simple, being
nothing more than a single column of filenames to include in the
package.
However, since absolute pathnames are generally a bad idea
for a package that could be installed potentially anywhere, there is
another method of specifying where things are supposed to go
and, optionally, what ownership and mode information they should be
installed with.
This is done by imbedding specialized command sequences
in the packing list.
Briefly described, these sequences are:
d389 1
@


1.4
log
@Add -L to record/enforce localbase.
Okay sturm@@
@
text
@d1 1
a1 1
.\"	$OpenBSD: pkg_create.1,v 1.3 2004/01/22 21:11:43 espie Exp $
d38 1
d45 1
a45 1
.Op Fl S Ar fake-base
d131 2
a132 1
.It Fl S Ar fake-base
d134 1
a134 1
.Ar fake-base
d136 2
d372 11
@


1.3
log
@document/activate @@arch. Fix list handling.
@
text
@d1 1
a1 1
.\"	$OpenBSD: pkg_create.1,v 1.2 2003/11/14 23:03:55 espie Exp $
d46 1
d134 10
d282 4
@


1.2
log
@synch doc with reality
@
text
@d1 1
a1 1
.\"	$OpenBSD: pkg_create.1,v 1.1 2003/10/19 18:38:06 espie Exp $
d37 1
d67 7
d174 2
@


1.1
log
@Add manpages, with a few minor changes from old ones.
ok pval
@
text
@d1 1
a1 1
.\"	$OpenBSD: pkg_create.1,v 1.28 2003/08/21 20:24:56 espie Exp $
d36 1
a36 1
.Op Fl Ohv
a42 1
.Op Fl s Ar fake-prefix
a43 2
.Op Fl t Ar template
.Op Fl X Ar excludefile
a44 1
.Op Fl m Ar mtreefile
a91 17
.It Fl Y
Assume a default answer of
.Dq Yes
for any questions asked.
.It Fl N
Assume a default answer of
.Dq \&No
for any questions asked.
.It Fl O
Go into a
.Dq packing list only
mode.
This is used to do
.Dq fake pkg_add
operations when a package is installed.
In such cases, it is necessary to know what the final, adjusted packing
list will look like.
d98 1
a98 1
are dumped, rather than the links themselves.
d108 2
a109 7
.Ar dpkgs .
This is assumed to be a whitespace separated list of package names
and is meant as a convenient shorthand for specifying multiple
.Cm @@pkgdep
directives in the packing list (see
.Sx PACKING LIST DETAILS
section below).
d112 2
a113 7
.Ar cpkgs .
This is assumed to be a whitespace separated list of package names
and is meant as a convenient shorthand for specifying multiple
.Cm @@pkgcfl
directives in the packing list (see
.Sx PACKING LIST DETAILS
section below).
a120 5
.It Fl s Ar fake-prefix
Set
.Ar fake-prefix
as the real initial directory
to start from in selecting files for the package.
a141 31
.It Fl t Ar template
Use
.Ar template
as the input to
.Xr mkstemp 3 .
By default, this is the string
.Pa /tmp/instmp.XXXXXX ,
but it may be necessary to override it in the situation where
space in your
.Pa /tmp
directory is limited.
Be sure to leave some number of
.Dq X
characters for
.Xr mkstemp 3
 to fill in with a unique ID.
.It Fl X Ar excludefile
Pass
.Ar excludefile
as a
.Fl exclude-from
argument to
.Xr tar
when creating final package.
See
.Xr tar
man page (or run
.Xr tar
with
.Fl -help
flag) for further information on using this flag.
a147 19
.It Fl m Ar mtreefile
Run
.Xr mtree 8
with input from mtreefile before the package is installed.
.Xr mtree
is invoked as
.Cm mtree
.Fl u
.Fl f
.Ar mtreefile
.Fl d
.Fl e
.Fl p
.Pa prefix ,
where
.Pa prefix
is the name of the first directory named by a
.Cm @@cwd
directive.
a172 8
.It Cm @@src Ar directory
Set the internal directory pointer for creation
.Em only
to
.Ar directory .
That is to say that it overrides
.Cm @@cwd
for package creation but not extraction.
a298 11
.It Cm @@mtree Ar name
Declare
.Pa name
as an
.Xr mtree 8
input file to be used at install time (see
.Fl m
above).
Only the first
.Cm @@mtree
directive is honored.
@

