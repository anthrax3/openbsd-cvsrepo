head	1.12;
access;
symbols
	OPENBSD_4_1:1.6.0.4
	OPENBSD_4_1_BASE:1.6
	OPENBSD_4_0:1.6.0.2
	OPENBSD_4_0_BASE:1.6
	OPENBSD_3_9:1.5.0.6
	OPENBSD_3_9_BASE:1.5
	OPENBSD_3_8:1.5.0.4
	OPENBSD_3_8_BASE:1.5
	OPENBSD_3_7:1.5.0.2
	OPENBSD_3_7_BASE:1.5
	OPENBSD_3_6:1.2.0.2
	OPENBSD_3_6_BASE:1.2;
locks; strict;
comment	@# @;


1.12
date	2007.05.01.18.29.36;	author espie;	state dead;
branches;
next	1.11;

1.11
date	2007.05.01.18.22.20;	author espie;	state Exp;
branches;
next	1.10;

1.10
date	2007.05.01.18.20.12;	author espie;	state Exp;
branches;
next	1.9;

1.9
date	2007.05.01.18.07.00;	author espie;	state Exp;
branches;
next	1.8;

1.8
date	2007.05.01.17.54.46;	author espie;	state Exp;
branches;
next	1.7;

1.7
date	2007.04.15.10.17.29;	author espie;	state Exp;
branches;
next	1.6;

1.6
date	2006.03.17.20.44.01;	author espie;	state Exp;
branches;
next	1.5;

1.5
date	2004.11.08.18.47.35;	author espie;	state Exp;
branches;
next	1.4;

1.4
date	2004.09.20.10.36.39;	author espie;	state Exp;
branches;
next	1.3;

1.3
date	2004.09.20.08.53.53;	author espie;	state Exp;
branches;
next	1.2;

1.2
date	2004.08.06.07.51.17;	author espie;	state Exp;
branches;
next	1.1;

1.1
date	2004.06.21.16.33.45;	author espie;	state Exp;
branches;
next	;


desc
@@


1.12
log
@remove PackingOld entirely
@
text
@# ex:ts=8 sw=4:
# $OpenBSD: PackingOld.pm,v 1.11 2007/05/01 18:22:20 espie Exp $
#
# Copyright (c) 2004-2006 Marc Espie <espie@@openbsd.org>
#
# Permission to use, copy, modify, and distribute this software for any
# purpose with or without fee is hereby granted, provided that the above
# copyright notice and this permission notice appear in all copies.
#
# THE SOFTWARE IS PROVIDED "AS IS" AND THE AUTHOR DISCLAIMS ALL WARRANTIES
# WITH REGARD TO THIS SOFTWARE INCLUDING ALL IMPLIED WARRANTIES OF
# MERCHANTABILITY AND FITNESS. IN NO EVENT SHALL THE AUTHOR BE LIABLE FOR
# ANY SPECIAL, DIRECT, INDIRECT, OR CONSEQUENTIAL DAMAGES OR ANY DAMAGES
# WHATSOEVER RESULTING FROM LOSS OF USE, DATA OR PROFITS, WHETHER IN AN
# ACTION OF CONTRACT, NEGLIGENCE OR OTHER TORTIOUS ACTION, ARISING OUT OF
# OR IN CONNECTION WITH THE USE OR PERFORMANCE OF THIS SOFTWARE.

use strict;
use warnings;
use OpenBSD::PackingElement;

1;
@


1.11
log
@move the old elements into PackingElements, since the code is now
much shorter.
@
text
@d2 1
a2 1
# $OpenBSD: PackingOld.pm,v 1.10 2007/05/01 18:20:12 espie Exp $
@


1.10
log
@use new functionality of register_with_factory: create objects for old
packing elements.
@
text
@d2 1
a2 1
# $OpenBSD: PackingOld.pm,v 1.9 2007/05/01 18:07:00 espie Exp $
a20 26

package OpenBSD::PackingElement::Old;
our @@ISA=qw(OpenBSD::PackingElement);

my $warned;

sub add
{
	my ($o, $plist, @@args) = @@_;
	my $keyword = $$o;
	if (!$warned->{$keyword}) {
		print STDERR "Warning: obsolete construct: \@@$keyword @@args\n";
		$warned->{$keyword} = 1;
	}
	$plist->{deprecated} = 1;
}

sub register_old_keyword
{
	my ($class, $k) = @@_;
	$class->register_with_factory($k, bless \$k, $class);
}

for my $k (qw(src display mtree ignore_inst)) {
	__PACKAGE__->register_old_keyword($k);
}
@


1.9
log
@define keyword() first, and allow register_with_factory() to reuse it
by default.
@
text
@d2 1
a2 1
# $OpenBSD: PackingOld.pm,v 1.8 2007/05/01 17:54:46 espie Exp $
d25 2
d29 8
a36 1
	my ($class, $plist, @@args) = @@_;
d38 4
a41 3
	my $self = $class->new(@@args);
	print STDERR "Warning: obsolete construct: ", $self->fullstring(), "\n";
	return $self->add_object($plist);
d44 3
a46 24
package OpenBSD::PackingElement::Src;
our @@ISA=qw(OpenBSD::PackingElement::Old);


sub keyword() { 'src' }
__PACKAGE__->register_with_factory;

package OpenBSD::PackingElement::Display;
our @@ISA=qw(OpenBSD::PackingElement::Old);

sub keyword() { 'display' }
__PACKAGE__->register_with_factory;

package OpenBSD::PackingElement::Mtree;
our @@ISA=qw(OpenBSD::PackingElement::Old);

sub keyword() { 'mtree' }
__PACKAGE__->register_with_factory;

package OpenBSD::PackingElement::ignore_inst;
our @@ISA=qw(OpenBSD::PackingElement::Old);

sub keyword() { 'ignore_inst' }
__PACKAGE__->register_with_factory;
@


1.8
log
@rename setKeyword to register_with_factory
@
text
@d2 1
a2 1
# $OpenBSD: PackingOld.pm,v 1.7 2007/04/15 10:17:29 espie Exp $
a36 1
__PACKAGE__->register_with_factory('src');
d39 1
a43 2
__PACKAGE__->register_with_factory('display');

d45 1
a49 2
__PACKAGE__->register_with_factory('mtree');

d51 1
a55 2
__PACKAGE__->register_with_factory('ignore_inst');

d57 1
@


1.7
log
@update copyright years, standardize licence.
reword the introduction to the stuff originally from FreeBSD to clarify
slightly.
@
text
@d2 1
a2 1
# $OpenBSD: PackingOld.pm,v 1.6 2006/03/17 20:44:01 espie Exp $
d37 1
a37 1
__PACKAGE__->setKeyword('src');
d44 1
a44 1
__PACKAGE__->setKeyword('display');
d51 1
a51 1
__PACKAGE__->setKeyword('mtree');
d58 1
a58 1
__PACKAGE__->setKeyword('ignore_inst');
@


1.6
log
@un-special case old constructs: make them inherit from the same class,
and remove any special code from Factory.

As it's simpler remove local variables.
@
text
@d2 1
a2 1
# $OpenBSD: PackingOld.pm,v 1.5 2004/11/08 18:47:35 espie Exp $
d4 1
a4 1
# Copyright (c) 2004 Marc Espie <espie@@openbsd.org>
@


1.5
log
@add more olden times keyword.
noticed by fries@@ who is running really old shit (hey, why not ?)
@
text
@d2 1
a2 1
# $OpenBSD: PackingOld.pm,v 1.4 2004/09/20 10:36:39 espie Exp $
d22 12
d35 1
a35 1
our @@ISA=qw(OpenBSD::PackingElement);
d37 1
a37 1
__PACKAGE__->setOldKeyword('src');
d42 1
a42 1
our @@ISA=qw(OpenBSD::PackingElement);
d44 1
a44 1
__PACKAGE__->setOldKeyword('display');
d49 1
a49 1
our @@ISA=qw(OpenBSD::PackingElement);
d51 1
a51 1
__PACKAGE__->setOldKeyword('mtree');
d56 1
a56 1
our @@ISA=qw(OpenBSD::PackingElement);
d58 1
a58 1
__PACKAGE__->setOldKeyword('ignore_inst');
@


1.4
log
@error out for pkgcfl in pkg_create, but don't warn if it's found in
existing packages or installed packages. Too much noise for now.
@
text
@d2 1
a2 1
# $OpenBSD: PackingOld.pm,v 1.3 2004/09/20 08:53:53 espie Exp $
d28 21
@


1.3
log
@old pkgcfl is dead.
@
text
@d2 1
a2 1
# $OpenBSD: PackingOld.pm,v 1.2 2004/08/06 07:51:17 espie Exp $
a27 7

package OpenBSD::PackingElement::PkgConflict;
our @@ISA=qw(OpenBSD::PackingElement);

__PACKAGE__->setOldKeyword('pkgcfl');
sub keyword() { "pkgcfl" }
sub category() { "pkgcfl" }
@


1.2
log
@unified headers, switch to smaller copyright notice.
@
text
@d2 1
a2 1
# $OpenBSD: PackingOld.pm,v 1.1 2004/06/21 16:33:45 espie Exp $
d28 7
@


1.1
log
@support for old stuff in pkg_info/pkg_delete, e.g., @@src
prompted by miod@@, okay miod@@ millert@@.
@
text
@d1 3
a3 1
# $OpenBSD$
@

