head	1.87;
access;
symbols
	OPENBSD_6_1:1.87.0.2
	OPENBSD_6_1_BASE:1.87
	OPENBSD_6_0:1.85.0.10
	OPENBSD_6_0_BASE:1.85
	OPENBSD_5_9:1.85.0.4
	OPENBSD_5_9_BASE:1.85
	OPENBSD_5_8:1.85.0.6
	OPENBSD_5_8_BASE:1.85
	OPENBSD_5_7:1.85.0.2
	OPENBSD_5_7_BASE:1.85
	OPENBSD_5_6:1.82.0.4
	OPENBSD_5_6_BASE:1.82
	OPENBSD_5_5:1.79.0.4
	OPENBSD_5_5_BASE:1.79
	OPENBSD_5_4:1.76.0.4
	OPENBSD_5_4_BASE:1.76
	OPENBSD_5_3:1.76.0.2
	OPENBSD_5_3_BASE:1.76
	OPENBSD_5_2:1.75.0.2
	OPENBSD_5_2_BASE:1.75
	OPENBSD_5_1_BASE:1.72
	OPENBSD_5_1:1.72.0.2
	OPENBSD_5_0:1.70.0.2
	OPENBSD_5_0_BASE:1.70
	OPENBSD_4_9:1.68.0.4
	OPENBSD_4_9_BASE:1.68
	OPENBSD_4_8:1.68.0.2
	OPENBSD_4_8_BASE:1.68
	OPENBSD_4_7:1.59.0.2
	OPENBSD_4_7_BASE:1.59
	OPENBSD_4_6:1.52.0.4
	OPENBSD_4_6_BASE:1.52
	OPENBSD_4_5:1.51.0.2
	OPENBSD_4_5_BASE:1.51
	OPENBSD_4_4:1.49.0.2
	OPENBSD_4_4_BASE:1.49
	OPENBSD_4_3:1.48.0.2
	OPENBSD_4_3_BASE:1.48
	OPENBSD_4_2:1.46.0.2
	OPENBSD_4_2_BASE:1.46
	OPENBSD_4_1:1.39.0.2
	OPENBSD_4_1_BASE:1.39
	OPENBSD_4_0:1.36.0.2
	OPENBSD_4_0_BASE:1.36
	OPENBSD_3_9:1.33.0.2
	OPENBSD_3_9_BASE:1.33
	OPENBSD_3_8:1.29.0.2
	OPENBSD_3_8_BASE:1.29
	OPENBSD_3_7:1.23.0.2
	OPENBSD_3_7_BASE:1.23
	OPENBSD_3_6:1.6.0.2
	OPENBSD_3_6_BASE:1.6
	OPENBSD_3_5:1.5.0.2
	OPENBSD_3_5_BASE:1.5;
locks; strict;
comment	@# @;


1.87
date	2017.02.27.21.53.11;	author rpe;	state Exp;
branches;
next	1.86;
commitid	7XQfqtkSXX43wr6R;

1.86
date	2016.10.04.14.27.25;	author espie;	state Exp;
branches;
next	1.85;
commitid	xPfTqDS8lBGpjpcG;

1.85
date	2015.01.11.22.34.08;	author espie;	state Exp;
branches;
next	1.84;
commitid	GfLWkj45p9jYy5uq;

1.84
date	2014.12.27.23.59.44;	author espie;	state Exp;
branches;
next	1.83;
commitid	dHBr3g8Yo4IQjolo;

1.83
date	2014.08.27.18.39.57;	author kspillner;	state Exp;
branches;
next	1.82;
commitid	634hl9204nK0ovPn;

1.82
date	2014.07.13.17.24.06;	author espie;	state Exp;
branches;
next	1.81;
commitid	JoDiaCRt4wN8ZyJj;

1.81
date	2014.07.13.15.58.40;	author espie;	state Exp;
branches;
next	1.80;
commitid	MNXqw5YRtJstvl53;

1.80
date	2014.04.14.10.56.11;	author espie;	state Exp;
branches;
next	1.79;

1.79
date	2014.01.23.12.21.44;	author espie;	state Exp;
branches;
next	1.78;

1.78
date	2014.01.23.11.45.22;	author espie;	state Exp;
branches;
next	1.77;

1.77
date	2013.12.31.11.21.10;	author espie;	state Exp;
branches;
next	1.76;

1.76
date	2012.08.06.00.00.28;	author fgsch;	state Exp;
branches;
next	1.75;

1.75
date	2012.07.13.23.54.24;	author deraadt;	state Exp;
branches;
next	1.74;

1.74
date	2012.07.13.16.45.10;	author deraadt;	state Exp;
branches;
next	1.73;

1.73
date	2012.06.11.10.16.46;	author espie;	state Exp;
branches;
next	1.72;

1.72
date	2012.01.15.14.16.16;	author espie;	state Exp;
branches;
next	1.71;

1.71
date	2011.08.26.09.02.30;	author espie;	state Exp;
branches;
next	1.70;

1.70
date	2011.07.06.13.05.52;	author espie;	state Exp;
branches;
next	1.69;

1.69
date	2011.06.23.22.46.12;	author schwarze;	state Exp;
branches;
next	1.68;

1.68
date	2010.07.04.18.30.28;	author espie;	state Exp;
branches;
next	1.67;

1.67
date	2010.06.25.12.03.54;	author espie;	state Exp;
branches;
next	1.66;

1.66
date	2010.06.15.08.26.39;	author espie;	state Exp;
branches;
next	1.65;

1.65
date	2010.06.09.07.26.01;	author espie;	state Exp;
branches;
next	1.64;

1.64
date	2010.06.05.17.15.32;	author espie;	state Exp;
branches;
next	1.63;

1.63
date	2010.06.05.12.30.36;	author espie;	state Exp;
branches;
next	1.62;

1.62
date	2010.06.04.13.19.39;	author espie;	state Exp;
branches;
next	1.61;

1.61
date	2010.04.24.14.33.12;	author espie;	state Exp;
branches;
next	1.60;

1.60
date	2010.03.22.20.38.44;	author espie;	state Exp;
branches;
next	1.59;

1.59
date	2010.01.19.14.26.24;	author espie;	state Exp;
branches;
next	1.58;

1.58
date	2010.01.11.12.25.38;	author espie;	state Exp;
branches;
next	1.57;

1.57
date	2010.01.10.11.31.08;	author espie;	state Exp;
branches;
next	1.56;

1.56
date	2009.12.26.17.00.49;	author espie;	state Exp;
branches;
next	1.55;

1.55
date	2009.11.16.12.20.32;	author espie;	state Exp;
branches;
next	1.54;

1.54
date	2009.10.15.18.17.18;	author espie;	state Exp;
branches;
next	1.53;

1.53
date	2009.10.14.22.59.34;	author espie;	state Exp;
branches;
next	1.52;

1.52
date	2009.04.14.17.53.58;	author espie;	state Exp;
branches;
next	1.51;

1.51
date	2008.09.11.04.15.37;	author drahn;	state Exp;
branches;
next	1.50;

1.50
date	2008.09.02.04.19.46;	author drahn;	state Exp;
branches;
next	1.49;

1.49
date	2008.04.07.11.02.24;	author espie;	state Exp;
branches;
next	1.48;

1.48
date	2008.02.04.12.15.03;	author espie;	state Exp;
branches;
next	1.47;

1.47
date	2007.12.31.14.55.10;	author espie;	state Exp;
branches;
next	1.46;

1.46
date	2007.06.25.12.21.08;	author espie;	state Exp;
branches;
next	1.45;

1.45
date	2007.06.10.16.59.30;	author espie;	state Exp;
branches;
next	1.44;

1.44
date	2007.05.18.13.22.06;	author espie;	state Exp;
branches;
next	1.43;

1.43
date	2007.05.14.13.15.28;	author espie;	state Exp;
branches;
next	1.42;

1.42
date	2007.05.14.11.02.14;	author espie;	state Exp;
branches;
next	1.41;

1.41
date	2007.05.14.10.12.24;	author espie;	state Exp;
branches;
next	1.40;

1.40
date	2007.05.01.18.29.36;	author espie;	state Exp;
branches;
next	1.39;

1.39
date	2007.02.04.18.26.16;	author espie;	state Exp;
branches;
next	1.38;

1.38
date	2007.02.04.12.46.54;	author espie;	state Exp;
branches;
next	1.37;

1.37
date	2006.11.29.11.10.42;	author espie;	state Exp;
branches;
next	1.36;

1.36
date	2006.03.06.10.40.31;	author espie;	state Exp;
branches;
next	1.35;

1.35
date	2006.03.04.13.13.05;	author espie;	state Exp;
branches;
next	1.34;

1.34
date	2006.03.04.11.31.18;	author espie;	state Exp;
branches;
next	1.33;

1.33
date	2005.09.18.02.56.12;	author deraadt;	state Exp;
branches;
next	1.32;

1.32
date	2005.09.18.00.54.28;	author espie;	state Exp;
branches;
next	1.31;

1.31
date	2005.09.17.09.30.34;	author espie;	state Exp;
branches;
next	1.30;

1.30
date	2005.09.04.22.47.56;	author espie;	state Exp;
branches;
next	1.29;

1.29
date	2005.08.17.09.45.45;	author espie;	state Exp;
branches;
next	1.28;

1.28
date	2005.08.17.08.32.28;	author espie;	state Exp;
branches;
next	1.27;

1.27
date	2005.08.17.08.17.44;	author espie;	state Exp;
branches;
next	1.26;

1.26
date	2005.08.07.16.25.35;	author espie;	state Exp;
branches;
next	1.25;

1.25
date	2005.08.07.14.18.04;	author espie;	state Exp;
branches;
next	1.24;

1.24
date	2005.06.28.20.34.55;	author espie;	state Exp;
branches;
next	1.23;

1.23
date	2005.03.07.21.46.59;	author espie;	state Exp;
branches;
next	1.22;

1.22
date	2005.03.01.21.47.19;	author espie;	state Exp;
branches;
next	1.21;

1.21
date	2005.02.28.13.44.19;	author espie;	state Exp;
branches;
next	1.20;

1.20
date	2005.02.28.13.08.41;	author espie;	state Exp;
branches;
next	1.19;

1.19
date	2005.02.15.09.13.05;	author espie;	state Exp;
branches;
next	1.18;

1.18
date	2004.11.21.15.36.17;	author espie;	state Exp;
branches;
next	1.17;

1.17
date	2004.11.11.12.29.58;	author espie;	state Exp;
branches;
next	1.16;

1.16
date	2004.11.09.11.11.01;	author espie;	state Exp;
branches;
next	1.15;

1.15
date	2004.11.01.11.27.50;	author espie;	state Exp;
branches;
next	1.14;

1.14
date	2004.10.31.10.26.17;	author espie;	state Exp;
branches;
next	1.13;

1.13
date	2004.10.26.17.23.15;	author espie;	state Exp;
branches;
next	1.12;

1.12
date	2004.10.18.12.03.19;	author espie;	state Exp;
branches;
next	1.11;

1.11
date	2004.10.11.09.44.06;	author espie;	state Exp;
branches;
next	1.10;

1.10
date	2004.09.15.18.51.43;	author espie;	state Exp;
branches;
next	1.9;

1.9
date	2004.09.14.22.43.09;	author espie;	state Exp;
branches;
next	1.8;

1.8
date	2004.09.14.22.37.39;	author espie;	state Exp;
branches;
next	1.7;

1.7
date	2004.09.14.22.35.23;	author espie;	state Exp;
branches;
next	1.6;

1.6
date	2004.06.21.16.33.45;	author espie;	state Exp;
branches;
next	1.5;

1.5
date	2003.12.21.18.41.23;	author espie;	state Exp;
branches;
next	1.4;

1.4
date	2003.12.11.15.03.48;	author espie;	state Exp;
branches;
next	1.3;

1.3
date	2003.11.04.17.54.21;	author espie;	state Exp;
branches;
next	1.2;

1.2
date	2003.10.28.17.16.06;	author espie;	state Exp;
branches;
next	1.1;

1.1
date	2003.10.28.17.12.57;	author espie;	state Exp;
branches;
next	;


desc
@@


1.87
log
@Remove support for pkg.conf in light of the consolidation towards
a single configuration file for the OpenBSD repository location.

The pkg_* tools now use installurl(5) to find the package repository.

NOTE:
/etc/installurl only contains a single URL pointing to a mirror.
Use the PKG_PATH environment variable to specify more than one
package repository.

prodded by and OK deraadt@@ aja@@
@
text
@# $OpenBSD: Makefile,v 1.86 2016/10/04 14:27:25 espie Exp $

.include <bsd.own.mk>

MAN1=fw_update.1 pkg_add.1 pkg_info.1 pkg_create.1 pkg_delete.1 \
	pkg_mklocatedb.1 pkg_sign.1
MAN5=package.5
MAN8=pkg_check.8
MAN=${MAN1} ${MAN5} ${MAN8}
NOPROG= 
POD2MAN=/usr/bin/pod2man

PACKAGES= \
    OpenBSD/Add.pm \
    OpenBSD/AddCreateDelete.pm \
    OpenBSD/AddDelete.pm \
    OpenBSD/ArcCheck.pm \
    OpenBSD/CollisionReport.pm \
    OpenBSD/Delete.pm \
    OpenBSD/Dependencies.pm \
    OpenBSD/Error.pm \
    OpenBSD/ForwardDependencies.pm \
    OpenBSD/Getopt.pm \
    OpenBSD/Handle.pm \
    OpenBSD/IdCache.pm \
    OpenBSD/Interactive.pm \
    OpenBSD/LibSpec.pm \
    OpenBSD/LibSpec/Build.pm \
    OpenBSD/Log.pm \
    OpenBSD/Mtree.pm \
    OpenBSD/OldLibs.pm \
    OpenBSD/PackageInfo.pm \
    OpenBSD/PackageLocation.pm \
    OpenBSD/PackageLocator.pm \
    OpenBSD/PackageName.pm \
    OpenBSD/PackageRepository.pm \
    OpenBSD/PackageRepository/HTTP.pm \
    OpenBSD/PackageRepository/Installed.pm \
    OpenBSD/PackageRepository/Persistent.pm \
    OpenBSD/PackageRepository/SCP.pm \
    OpenBSD/PackageRepositoryList.pm \
    OpenBSD/PackingElement.pm \
    OpenBSD/PackingList.pm \
    OpenBSD/Paths.pm \
    OpenBSD/PkgAdd.pm \
    OpenBSD/PkgCfl.pm \
    OpenBSD/PkgCheck.pm \
    OpenBSD/PkgCreate.pm \
    OpenBSD/PkgDelete.pm \
    OpenBSD/PkgInfo.pm \
    OpenBSD/PkgSign.pm \
    OpenBSD/PkgSpec.pm \
    OpenBSD/ProgressMeter/Term.pm \
    OpenBSD/ProgressMeter.pm \
    OpenBSD/Replace.pm \
    OpenBSD/RequiredBy.pm \
    OpenBSD/Search.pm \
    OpenBSD/Signature.pm \
    OpenBSD/Signer.pm \
    OpenBSD/SharedItems.pm \
    OpenBSD/SharedLibs.pm \
    OpenBSD/State.pm \
    OpenBSD/Subst.pm \
    OpenBSD/Temp.pm \
    OpenBSD/Tracker.pm \
    OpenBSD/Update.pm \
    OpenBSD/UpdateSet.pm \
    OpenBSD/Ustar.pm \
    OpenBSD/Vstat.pm \
    OpenBSD/FwUpdate.pm \
    OpenBSD/md5.pm

PACKAGEDIRS=OpenBSD  OpenBSD/PackageRepository OpenBSD/ProgressMeter \
    OpenBSD/LibSpec

SCRIPTS= pkg_add \
    pkg_mklocatedb

SCRIPTS_LNK = \
    pkg_add pkg_check \
    pkg_add pkg_create \
    pkg_add pkg_delete \
    pkg_add pkg_info \
    pkg_add pkg_sign \
    pkg_add fw_update

LIBBASE=/usr/libdata/perl5

PODS= \
    OpenBSD::md5 \
    OpenBSD::Getopt \
    OpenBSD::IdCache \
    OpenBSD::Intro \
    OpenBSD::Mtree \
    OpenBSD::PackageName \
    OpenBSD::PackingElement \
    OpenBSD::PackingList \
    OpenBSD::PkgCfl \
    OpenBSD::PkgSpec \
    OpenBSD::RequiredBy \
    OpenBSD::Search \
    OpenBSD::State \
    OpenBSD::Ustar \
    OpenBSD::Vstat

MAN3=
_quick3p=

.for p in ${PODS}
.  ifndef NOMAN
MAN3 += $p.3p
MANSRC_COOKIE=stamp-mansrc.build
_quick3p+=$p.pod ${.OBJDIR}/$p.3p
.  else
MANSRC_COOKIE=
.  endif

$p.3p: pod/$p.pod
	${POD2MAN} --section=3p --official --name=$p ${.ALLSRC} $@@
.endfor

mansrc.build:
.if !empty(_quick3p)
	cd ${.CURDIR}/pod && ${POD2MAN} --section=3p --official ${_quick3p}
.endif

all: ${MANSRC_COOKIE}

stamp-mansrc.build:
	@@cd ${.CURDIR} && exec ${MAKE} mansrc.build
	@@touch $@@

MAN += ${MAN3}

CLEANFILES= ${MAN3} stamp-mansrc.build

realinstall: 
.for i in ${PACKAGEDIRS}
	${INSTALL} -d -o ${LIBOWN} -g ${LIBGRP} -m ${DIRMODE} \
		${DESTDIR}${LIBBASE}/$i
.endfor
.for i in ${PACKAGES}
	${INSTALL} ${INSTALL_COPY} -o ${LIBOWN} -g ${LIBGRP} -m ${LIBMODE} \
		${.CURDIR}/$i ${DESTDIR}${LIBBASE}/$i
.endfor
.for i in ${SCRIPTS}
	${INSTALL} ${INSTALL_COPY} -o ${BINOWN} -g ${BINGRP} -m ${BINMODE} \
		${.CURDIR}/$i ${DESTDIR}${BINDIR}/$i
.endfor
.for i j in ${SCRIPTS_LNK}
	cd ${DESTDIR}${BINDIR} && ln -f $i $j
.endfor

.include <bsd.prog.mk>
.PHONY: mansrc.build
@


1.86
log
@no longer needed
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.85 2015/01/11 22:34:08 espie Exp $
d7 1
a7 1
MAN5=package.5 pkg.conf.5
@


1.85
log
@replace fw_update (shell script) with a specialized version of pkg_add.
This has numerous advantages, in terms of speed and control.
Initial version should be (mostly) identical to the old one.

thanks to rpe@@ and sthen@@ for tests.
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.84 2014/12/27 23:59:44 espie Exp $
d71 1
a71 3
    OpenBSD/md5.pm \
    OpenBSD/signify.pm \
    OpenBSD/x509.pm
@


1.84
log
@prepare things slightly further, FwUpdate still not active...
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.83 2014/08/27 18:39:57 kspillner Exp $
d5 2
a6 1
MAN1=pkg_add.1 pkg_info.1 pkg_create.1 pkg_delete.1 pkg_mklocatedb.1 pkg_sign.1
d86 2
a87 1
    pkg_add pkg_sign
@


1.83
log
@Rename Persistant to Persistent.

sure espie@@
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.82 2014/07/13 17:24:06 espie Exp $
d69 1
@


1.82
log
@bye bye src url. Never amounted to much, we went another road a while ago
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.81 2014/07/13 15:58:40 espie Exp $
d38 1
a38 1
    OpenBSD/PackageRepository/Persistant.pm \
@


1.81
log
@tedu setlist support, superseded by the new locate dbs.
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.80 2014/04/14 10:56:11 espie Exp $
a39 1
    OpenBSD/PackageRepository/Source.pm \
@


1.80
log
@extract the code that walks setlist, to be able to use it in pkg_check
(waiting for theo to synch sets to commit the rest)
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.79 2014/01/23 12:21:44 espie Exp $
a57 1
    OpenBSD/SetList.pm \
@


1.79
log
@separate pkg_sign documentation. Option description becomes MUCH saner.
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.78 2014/01/23 11:45:22 espie Exp $
d58 1
@


1.78
log
@reorg code: make "signing only" a separate command, as it has nothing in
common with pkg_create.

Move the signing part in its own module, so that PkgCreate can reuse it
for "signing while we build" mode.

naddy@@ agrees
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.77 2013/12/31 11:21:10 espie Exp $
d5 1
a5 1
MAN1=pkg_add.1 pkg_info.1 pkg_create.1 pkg_delete.1 pkg_mklocatedb.1
@


1.77
log
@signify support
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.76 2012/08/06 00:00:28 fgsch Exp $
d51 1
d59 1
d84 2
a85 1
    pkg_add pkg_info
@


1.76
log
@kill pkg(1) for good. with help from espie.
espie@@ ok.
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.75 2012/07/13 23:54:24 deraadt Exp $
d69 1
@


1.75
log
@install the correct file; from schwarze, ok krw
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.74 2012/07/13 16:45:10 deraadt Exp $
d5 1
a5 2
MAN1=pkg_add.1 pkg_info.1 pkg_create.1 pkg_delete.1 \
	pkg.1 pkg_mklocatedb.1
@


1.74
log
@do not install the pkg(1) front-end stub in /usr/sbin anymore, everyone
uses the '_' variants
ok espie
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.73 2012/06/11 10:16:46 espie Exp $
d75 2
a76 2
SCRIPTS= \
    pkg_mklocatedb \
@


1.73
log
@move PkgConfig.pm where it belongs
as requested by matthieu@@, ok jasper@@, miod@@, matthieu@@
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.72 2012/01/15 14:16:16 espie Exp $
a76 1
    pkg
d79 4
a82 5
    pkg pkg_add \
    pkg pkg_check \
    pkg pkg_create \
    pkg pkg_delete \
    pkg pkg_info
@


1.72
log
@document OpenBSD::md5
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.71 2011/08/26 09:02:30 espie Exp $
a48 1
    OpenBSD/PkgConfig.pm \
@


1.71
log
@zap it from there too
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.70 2011/07/06 13:05:52 espie Exp $
d90 1
@


1.70
log
@future code to handle HTTP 1.1 connection: need to establish a somewhat
persistant connection, will use the same client code for scp and http.
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.69 2011/06/23 22:46:12 schwarze Exp $
d5 1
a5 1
MAN1=pkg_add.1 pkg_info.1 pkg_create.1 pkg_delete.1 pkg_merge.1 \
a76 1
    pkg_merge \
@


1.69
log
@switch to installing source manuals (base part)
discussed with lots of people, tested by naddy@@,
"move fast" deraadt@@
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.68 2010/07/04 18:30:28 espie Exp $
d10 1
a10 2
NOPROG=

d37 1
d39 1
@


1.68
log
@initial documentation for pkg.conf, after nits from jmc@@, and straightening
up by Theo about what should be in there...
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.67 2010/06/25 12:03:54 espie Exp $
d105 1
d110 1
a110 2
MANALL+= $p.cat3p
MANSRCALL += $p.3p
a112 3
.    ifdef MANPS
PSALL+= $p.ps3p
.    endif
a119 10
.ifndef NOMAN
MANALL+=${MAN1:S/.1$/.cat1/}
MANALL+=${MAN5:S/.5$/.cat5/}
MANALL+=${MAN8:S/.8$/.cat8/}
.  ifdef MANPS
PSALL+= ${MAN1:S/.1$/.ps1/}
PSALL+= ${MAN5:S/.5$/.ps5/}
PSALL+= ${MAN8:S/.8$/.ps8/}
.  endif
.endif
d126 1
a126 1
all: ${MANSRC_COOKIE} .WAIT ${MANALL} ${PSALL}
d132 3
a134 1
CLEANFILES= ${MANSRCALL} ${MANALL} stamp-mansrc.build
@


1.67
log
@document ::State a bit
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.66 2010/06/15 08:26:39 espie Exp $
d7 1
a7 1
MAN5=package.5
@


1.66
log
@more printing changes.

move log operations into their own file, since they're used outside of
pkg_add/pkg_delete by pkg_check.

move all system stuff to State, so that printing can be localized/controlled.
Create primitives _print, _errprint, _fatal for overriding output, without
localization.

Accordingly, move a lot of code out of Error. We should also move Unlink and
Copy eventually.
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.65 2010/06/09 07:26:01 espie Exp $
d101 1
@


1.65
log
@ui changes: go thru a state object for most printouts
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.64 2010/06/05 17:15:32 espie Exp $
d30 1
@


1.64
log
@move files after a discussion with Theo.
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.63 2010/06/05 12:30:36 espie Exp $
d60 1
@


1.63
log
@new command pkg_fsck, very incomplete for now. Runs only very basic checks.
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.62 2010/06/04 13:19:39 espie Exp $
d8 1
a8 1
MAN8=pkg_fsck.8
d46 1
a49 1
    OpenBSD/PkgFsck.pm \
d80 1
a82 1
    pkg pkg_fsck \
@


1.62
log
@move code around, so that commands can be used as modules.
pkg becomes the start hub, which does nothing except require the
correct module.
Saner code wrt Add/Delete, and more sharing.
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.61 2010/04/24 14:33:12 espie Exp $
d8 2
a9 1
MAN=${MAN1} ${MAN5}
d49 1
d82 1
d123 1
d127 1
@


1.61
log
@pieces required for resolve-lib (reuse code for consistency)
@
text
@d1 1
a1 1
# $OpenBSD$
d15 1
d43 1
d46 3
a71 4
    pkg_add \
    pkg_info \
    pkg_create \
    pkg_delete \
d76 6
d152 3
a154 1

@


1.60
log
@clean up the ProgressMeter code, create a specific class if a Term
is around.
start using stuff from termcap, specifically, cleareol, and move to hp.
use the full line when we can, cram 100% if we can.
(this should flicker much less on slow terminals).

clean-up the install-and-progress bits to be in progressmeter, this removes
some code.

have pkg_create follow the same pattern as the others, with a state.
This allows us to unify error messages a bit.
@
text
@d27 1
d63 2
a64 1
PACKAGEDIRS=OpenBSD  OpenBSD/PackageRepository OpenBSD/ProgressMeter
@


1.59
log
@move generic code to handle libspec in a new file, to clean up stuff
@
text
@d44 1
d62 1
a62 1
PACKAGEDIRS=OpenBSD  OpenBSD/PackageRepository
@


1.58
log
@move the oldlibs code into its separate file, prior to fixing it.
allow replacement if it only touches partial or libs
@
text
@d26 1
@


1.57
log
@pull the signature comparison code into its own file.
add comparison functions to Packagenames that return undef when it matters.
@
text
@d27 1
@


1.56
log
@Better, more global way of dealing with forward dependencies, and to
ask just once per-set for exec/unexec.

Todo: forward-deps could be merged, but this might lead to dependency
loops, we have to detect them and act first

Todo: rewrite the other part of forward dependency handling (dep adjustment)
@
text
@d46 1
@


1.55
log
@start pulling all the code that's the same between pkg_add and pkg_delete
into a common AddDelete package... lots of identical options and handling,
actually...
@
text
@d21 1
@


1.54
log
@pkg_add will need to track installation progress globally, so that we don't
solve dependencies with stuff that we want to update later...
create that information, to be used...
@
text
@d15 1
@


1.53
log
@move OpenBSD::Handle into its own file. I guess I need to disentangle this
code before I go further....
@
text
@d48 1
@


1.52
log
@initial implementation of package signatures, based on x509 certificates and
smime detached signatures.
@
text
@d21 1
@


1.51
log
@Do not clean ${PACKAGES} as this is the source files, if run without obj dir
present, it will delete the source files. Found by Steven Roberts.
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.50 2008/09/02 04:19:46 drahn Exp $
d52 1
@


1.50
log
@Install in the correct directory with NOMAN set. Based on makewhatis
with additional CLEANFILES from theo.
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.49 2008/04/07 11:02:24 espie Exp $
d119 1
a119 1
CLEANFILES= ${PACKAGES} ${MANSRCALL} ${MANALL} stamp-mansrc.build
@


1.49
log
@put Subst stuff into its own library file, to reuse elsewhere.
@
text
@d1 1
a1 1
# $OpenBSD$
d9 1
a112 2
# Nothing to build
depend:
d119 3
a121 1
install: 
a134 6
clean:

.if !defined(NOMAN)
install: maninstall
.include <bsd.man.mk>
.endif
d136 1
a136 2
.include <bsd.obj.mk>
.include <bsd.subdir.mk>
@


1.48
log
@a somewhat long introduction to how the package tools really work,
so that people finally get a jump-start at figuring out code that's still
evolving,..
@
text
@d44 1
@


1.47
log
@use the same trick as for perl to make sure manpages get built later
@
text
@d67 1
@


1.46
log
@placeholder to split off the code that handles UpdateSets, as it's
currently scattered all over the place.
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.45 2007/06/10 16:59:30 espie Exp $
d112 1
a112 1
all: ${MANSRC_COOKIE}
@


1.45
log
@Add Paths.pm, to centralize all system dependent paths all over the place.
okay millert@@, deraadt@@
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.44 2007/05/18 13:22:06 espie Exp $
d46 1
@


1.44
log
@Add pkgpath hints to pkgspec. Make PackageRepository/Source functional:
if a pkgpath is hinted at, then we build that package, and we delegate
to the corresponding File: repository.

Some XXX: we need to unlock the database temporarily, as the build
*requires* shared access to stuff that is going on (and possibly write
access for installing subpackages, so this cannot work 100% yet).

Still, this allows the transparent build of one single package, at least.
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.43 2007/05/14 13:15:28 espie Exp $
d34 1
@


1.43
log
@document search objects. Adjust PkgSpec documentation
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.42 2007/05/14 11:02:14 espie Exp $
d30 1
@


1.42
log
@put Search objects into their own file, finally
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.41 2007/05/14 10:12:24 espie Exp $
d71 1
@


1.41
log
@move code around to allow OO access to installed packages always.
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.40 2007/05/01 18:29:36 espie Exp $
d39 1
@


1.40
log
@remove PackingOld entirely
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.39 2007/02/04 18:26:16 espie Exp $
d28 1
@


1.39
log
@back-out extra commit
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.38 2007/02/04 12:46:54 espie Exp $
a31 1
    OpenBSD/PackingOld.pm \
@


1.38
log
@protect `normal' installs against archive burps.
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.37 2006/11/29 11:10:42 espie Exp $
a38 1
    OpenBSD/ScanBinary.pm \
@


1.37
log
@+OpenBSD::PkgConfig
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.36 2006/03/06 10:40:31 espie Exp $
d39 1
@


1.36
log
@take some infrequently used code completely out of the way.
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.35 2006/03/04 13:13:05 espie Exp $
d34 1
@


1.35
log
@cut down the Locator code into maintainable chunks.
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.34 2006/03/04 11:31:18 espie Exp $
d28 1
d46 1
a46 1
PACKAGEDIRS=OpenBSD
@


1.34
log
@reorganize code a little bit: Update.pm becomes Replace.pm (since it matches
the -r option), and the find_update code moves to Update.pm, so that it doesn't
get parsed if -u is not used.

Also make the has_new_sig and uses_old_libs local methods of PackingList,
as it is their natural API.

Reorg a few more routines so that they can be found by pkg_add and by
Update.pm.

May need to split off more stuff to avoid parsing everything...
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.33 2005/09/18 02:56:12 deraadt Exp $
d24 1
d27 2
@


1.33
log
@unbreak tree.  please build before commiting espie
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.32 2005/09/18 00:54:28 espie Exp $
d32 1
@


1.32
log
@document the package(5) format.
Some tweaks by jmc@@
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.31 2005/09/17 09:30:34 espie Exp $
d5 4
a8 2
MAN=pkg_add.1 pkg_info.1 pkg_create.1 pkg_delete.1 pkg_merge.1 \
	pkg.1 pkg_mklocatedb.1 package.5
d86 2
a87 1
MANALL+=${MAN:S/.1$/.cat1/}
d89 2
a90 1
PSALL+= ${MAN:S/.1$/.ps1/}
@


1.31
log
@slightly simpler install.
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.30 2005/09/04 22:47:56 espie Exp $
d6 2
a7 1
	pkg.1 pkg_mklocatedb.1
@


1.30
log
@* New -i interactive option, that can ask obnoxious questions.
* move the signature code to a packing-list method, prepend the pkgname.
* depend on distant listings, cache these systematically.
* cut the PKG_PATH at :/ systematically, much simpler than parsing URLs.
People should get used to trailing /s.
* let pkg_add -u actually run the update.
* check for signature in more places, for instance, let pkg_add installed_stuff
be a void operation.
* grab enough stuff during updates to check signatures, so that pkg_add -u
can report updates that are not needed right away, instead of waiting
for the more confusing `trying to update'
* beginning of @@module support.
* @@pkgpath support, including updates.
* systematically expand stems when applicable.
* use visitors systematically in pkg_info.
* pkg_info -S reports signature.
* remove hardcoding of categories in PackingList, so that future modules
will be able to expand them.
* add @@updateset and @@incompatibility keywords.
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.29 2005/08/17 09:45:45 espie Exp $
d38 1
d103 4
a107 2
	${INSTALL} -d -o ${LIBOWN} -g ${LIBGRP} -m ${DIRMODE} \
		${DESTDIR}${LIBBASE}/${i:H}
@


1.29
log
@document RequiredBy module.
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.28 2005/08/17 08:32:28 espie Exp $
d18 1
@


1.28
log
@document Getopt.
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.27 2005/08/17 08:17:44 espie Exp $
d58 1
@


1.27
log
@document OpenBSD::PackageName
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.26 2005/08/07 16:25:35 espie Exp $
d50 1
@


1.26
log
@split off the code that handles dependencies proper, so that we can (later)
reuse it in pkg_info or lib-depends-check.
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.25 2005/08/07 14:18:04 espie Exp $
d52 1
@


1.25
log
@wrapper around Ustar that replaces long names/links with LongName#/LongLink#.

The archive will unpack correctly with tar, except that those names won't
be preserved.

The wrapper checks names against the packing-list to restore the correct names
on the fly.

Put into a separate file, as it is an extension of Ustar proper, and we're
going to do more archive checking in the future.

Lots of tests by Bernd Ahlers. Comments by Tom Cosgrove.
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.24 2005/06/28 20:34:55 espie Exp $
d14 1
@


1.24
log
@Add pkg_merge and doc.
okay naddy@@, jmc@@
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.23 2005/03/07 21:46:59 espie Exp $
d11 1
@


1.23
log
@strip down path from generated manpages.
problem noticed by sturm@@
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.22 2005/03/01 21:47:19 espie Exp $
d5 2
a6 1
MAN=pkg_add.1 pkg_info.1 pkg_create.1 pkg_delete.1 pkg.1 pkg_mklocatedb.1
d41 1
@


1.22
log
@make sure _quick3p is always defined. Thanks dale!
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.21 2005/02/28 13:44:19 espie Exp $
d62 1
a62 1
_quick3p+=${.CURDIR}/pod/$p.pod $p
d71 1
a71 1
	${POD2MAN} --section=3p --official ${.ALLSRC} $@@
d82 1
a82 1
	cd ${.OBJDIR} && ${POD2MAN} --section=3p --official ${_quick3p}
@


1.21
log
@oops, since we override MANALL, we need to complete it.
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.20 2005/02/28 13:08:41 espie Exp $
d54 2
@


1.20
log
@basic API documentation, not yet finished.
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.19 2005/02/15 09:13:05 espie Exp $
d71 6
@


1.19
log
@New command: pkg_mklocatedb, that can be used to create locate(1)-style
databases for packages (duh, isn't that obvious from the name ?)

Tweaks based on comments from naddy/jmc.
@
text
@d1 3
a3 1
# $OpenBSD: Makefile,v 1.18 2004/11/21 15:36:17 espie Exp $
d6 1
d45 32
d79 1
a79 1
all:
d81 3
a98 2
.include <bsd.own.mk>

d106 1
@


1.18
log
@pull the code that handles shared libraries (ldconfig for now) aside.
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.17 2004/11/11 12:29:58 espie Exp $
d3 1
a3 1
MAN=pkg_add.1 pkg_info.1 pkg_create.1 pkg_delete.1 pkg.1
d37 1
@


1.17
log
@move collision reporter to a separate file, so that it doesn't get loaded
all the time.
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.16 2004/11/09 11:11:01 espie Exp $
d24 1
@


1.16
log
@kill old Logger interface, use $state->print() to report problems at
end exclusively now.
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.15 2004/11/01 11:27:50 espie Exp $
d7 1
@


1.15
log
@reorg pkg_add slightly, put all options into state so that we don't need
to use local variables.
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.14 2004/10/31 10:26:17 espie Exp $
a10 1
    OpenBSD/Logger.pm \
@


1.14
log
@Move most of the code of pkg_delete into a separate module so that it will
be usable by pkg_add -r.
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.13 2004/10/26 17:23:15 espie Exp $
d6 1
@


1.13
log
@move the code that handles shared items into a separate Module.

- It will be used after deletion/adding during updates.
- We might avoid loading it if a package contains no new directories.
Actually a lot of packages don't use it.
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.12 2004/10/18 12:03:19 espie Exp $
d6 1
d26 1
d28 1
a28 1
    OpenBSD/Vstat.pm
@


1.12
log
@experimental progress meter.
not active unless you specify -x for pkg_add/pkg_delete.
(option is bound to change)
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.11 2004/10/11 09:44:06 espie Exp $
d21 1
d23 1
@


1.11
log
@split PackageName handling into PackageName stuff/PkgSpec matching.
Kill new method that isn't really used.

Name explicit splitstem() to get the stem of a packagename.

Adjust calls to the interface.
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.10 2004/09/15 18:51:43 espie Exp $
d19 1
@


1.10
log
@new getopt module, that allows for option-specific processing, so that
for instance, pkg_create -Dvar=value -Dvar2=value2 will work.
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.6 2004/06/21 16:33:45 espie Exp $
d18 1
@


1.9
log
@basic error wrapper for system and such.
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.8 2004/09/14 22:37:39 espie Exp $
d7 1
@


1.8
log
@IdCache module, that deals with uid/gid caches.
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.7 2004/09/14 22:35:23 espie Exp $
d6 1
@


1.7
log
@install mtree.
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.6 2004/06/21 16:33:45 espie Exp $
d6 1
@


1.6
log
@support for old stuff in pkg_info/pkg_delete, e.g., @@src
prompted by miod@@, okay miod@@ millert@@.
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.5 2003/12/21 18:41:23 espie Exp $
d7 1
@


1.5
log
@Add virtual file system, so that pkg_add and pkg_delete can check for
read-only status, or size concerns, before even beginning to add/remove
files.

Allows pkg_add -n and pkg_delete -n to be more thorough as well.

Some testing by Todd Millert, comments by Greg Steuck and Sam Smith.
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.4 2003/12/11 15:03:48 espie Exp $
d12 1
@


1.4
log
@NOMAN building works, fix NOMAN installation.
Noticed by jmc@@
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.3 2003/11/04 17:54:21 espie Exp $
d16 2
a17 1
    OpenBSD/md5.pm
@


1.3
log
@Add logging facilities (temp module exposes its temporary directory)
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.2 2003/10/28 17:16:06 espie Exp $
d32 1
a32 1
install: maninstall
d49 1
@


1.2
log
@oops
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.1 2003/10/28 17:12:57 espie Exp $
d6 1
@


1.1
log
@OpenBSD-specific Makefile. We keep Makefile.PL around for portability to
other OSes.

A bit more maintenance, since each module will need to be added, but there
are too many fun things that can happen with depend/clean/whatever.

Should please that Theo guy who sometimes sends me spam.

okay millert@@
@
text
@d1 1
a1 1
# $OpenBSD$
d51 1
a52 2
.include <bsd.obj.mk>

@

