head	1.31;
access;
symbols
	OPENBSD_4_1:1.30.0.2
	OPENBSD_4_1_BASE:1.30
	OPENBSD_4_0:1.26.0.2
	OPENBSD_4_0_BASE:1.26
	OPENBSD_3_9:1.23.0.2
	OPENBSD_3_9_BASE:1.23
	OPENBSD_3_8:1.21.0.6
	OPENBSD_3_8_BASE:1.21
	OPENBSD_3_7:1.21.0.4
	OPENBSD_3_7_BASE:1.21
	OPENBSD_3_6:1.21.0.2
	OPENBSD_3_6_BASE:1.21
	OPENBSD_3_5:1.19.0.4
	OPENBSD_3_5_BASE:1.19
	OPENBSD_3_4:1.19.0.2
	OPENBSD_3_4_BASE:1.19
	OPENBSD_3_3:1.17.0.2
	OPENBSD_3_3_BASE:1.17
	OPENBSD_3_2:1.16.0.4
	OPENBSD_3_2_BASE:1.16
	OPENBSD_3_1:1.16.0.2
	OPENBSD_3_1_BASE:1.16
	OPENBSD_3_0:1.15.0.4
	OPENBSD_3_0_BASE:1.15
	OPENBSD_2_9_BASE:1.15
	OPENBSD_2_9:1.15.0.2
	OPENBSD_2_8:1.14.0.2
	OPENBSD_2_8_BASE:1.14
	OPENBSD_2_7:1.13.0.2
	OPENBSD_2_7_BASE:1.13
	OPENBSD_2_6:1.8.0.2
	OPENBSD_2_6_BASE:1.8
	OPENBSD_2_5:1.5.0.4
	OPENBSD_2_5_BASE:1.5
	OPENBSD_2_4:1.5.0.2
	OPENBSD_2_4_BASE:1.5
	OPENBSD_2_3:1.4.0.6
	OPENBSD_2_3_BASE:1.4
	OPENBSD_2_2:1.4.0.4
	OPENBSD_2_2_BASE:1.4
	OPENBSD_2_1:1.4.0.2
	OPENBSD_2_1_BASE:1.4
	OPENBSD_2_0:1.2.0.2
	OPENBSD_2_0_BASE:1.2
	netbsd_1_1:1.1.1.1;
locks; strict;
comment	@.\" @;


1.31
date	2007.05.26.21.39.46;	author grunk;	state dead;
branches;
next	1.30;

1.30
date	2007.01.27.10.34.46;	author grunk;	state Exp;
branches;
next	1.29;

1.29
date	2007.01.23.08.15.23;	author grunk;	state Exp;
branches;
next	1.28;

1.28
date	2007.01.22.07.52.08;	author grunk;	state Exp;
branches;
next	1.27;

1.27
date	2007.01.14.21.45.01;	author grunk;	state Exp;
branches;
next	1.26;

1.26
date	2006.07.01.07.47.49;	author jmc;	state Exp;
branches;
next	1.25;

1.25
date	2006.07.01.07.36.27;	author jmc;	state Exp;
branches;
next	1.24;

1.24
date	2006.06.30.16.09.27;	author tedu;	state Exp;
branches;
next	1.23;

1.23
date	2005.11.27.13.12.00;	author jmc;	state Exp;
branches;
next	1.22;

1.22
date	2005.11.27.10.49.57;	author jmc;	state Exp;
branches;
next	1.21;

1.21
date	2004.09.10.15.37.53;	author pedro;	state Exp;
branches;
next	1.20;

1.20
date	2004.06.20.19.16.37;	author pedro;	state Exp;
branches;
next	1.19;

1.19
date	2003.06.12.12.59.54;	author jmc;	state Exp;
branches;
next	1.18;

1.18
date	2003.06.02.23.36.55;	author millert;	state Exp;
branches;
next	1.17;

1.17
date	2002.11.14.02.57.28;	author deraadt;	state Exp;
branches;
next	1.16;

1.16
date	2001.11.08.11.20.47;	author mpech;	state Exp;
branches;
next	1.15;

1.15
date	2000.11.09.17.53.26;	author aaron;	state Exp;
branches;
next	1.14;

1.14
date	2000.06.20.21.29.20;	author provos;	state Exp;
branches;
next	1.13;

1.13
date	2000.04.16.17.44.33;	author aaron;	state Exp;
branches;
next	1.12;

1.12
date	2000.03.19.17.57.17;	author aaron;	state Exp;
branches;
next	1.11;

1.11
date	2000.02.13.01.04.54;	author aaron;	state Exp;
branches;
next	1.10;

1.10
date	2000.01.22.13.39.29;	author aaron;	state Exp;
branches;
next	1.9;

1.9
date	2000.01.22.02.17.51;	author aaron;	state Exp;
branches;
next	1.8;

1.8
date	99.06.05.22.18.21;	author aaron;	state Exp;
branches;
next	1.7;

1.7
date	99.05.23.14.11.39;	author aaron;	state Exp;
branches;
next	1.6;

1.6
date	99.05.16.19.58.17;	author alex;	state Exp;
branches;
next	1.5;

1.5
date	98.09.07.16.44.34;	author aaron;	state Exp;
branches;
next	1.4;

1.4
date	97.05.14.15.58.38;	author niklas;	state Exp;
branches;
next	1.3;

1.3
date	96.12.22.01.46.45;	author deraadt;	state Exp;
branches;
next	1.2;

1.2
date	96.01.01.01.43.15;	author deraadt;	state Exp;
branches;
next	1.1;

1.1
date	95.10.18.08.48.31;	author deraadt;	state Exp;
branches
	1.1.1.1;
next	;

1.1.1.1
date	95.10.18.08.48.31;	author deraadt;	state Exp;
branches;
next	;


desc
@@


1.31
log
@link mount_vnd to the build, and remove usr.sbin/vnconfig, which is now
completely contained at the new place.  provide a legacy link to /usr/sbin
to go away after next release.

ok deraadt@@
@
text
@.\"	$OpenBSD: vnconfig.8,v 1.30 2007/01/27 10:34:46 grunk Exp $
.\"
.\" Copyright (c) 1993 University of Utah.
.\" Copyright (c) 1980, 1989, 1991, 1993
.\"	The Regents of the University of California.  All rights reserved.
.\"
.\" This code is derived from software contributed to Berkeley by
.\" the Systems Programming Group of the University of Utah Computer
.\" Science Department.
.\"
.\" Redistribution and use in source and binary forms, with or without
.\" modification, are permitted provided that the following conditions
.\" are met:
.\" 1. Redistributions of source code must retain the above copyright
.\"    notice, this list of conditions and the following disclaimer.
.\" 2. Redistributions in binary form must reproduce the above copyright
.\"    notice, this list of conditions and the following disclaimer in the
.\"    documentation and/or other materials provided with the distribution.
.\" 3. Neither the name of the University nor the names of its contributors
.\"    may be used to endorse or promote products derived from this software
.\"    without specific prior written permission.
.\"
.\" THIS SOFTWARE IS PROVIDED BY THE REGENTS AND CONTRIBUTORS ``AS IS'' AND
.\" ANY EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT LIMITED TO, THE
.\" IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE
.\" ARE DISCLAIMED.  IN NO EVENT SHALL THE REGENTS OR CONTRIBUTORS BE LIABLE
.\" FOR ANY DIRECT, INDIRECT, INCIDENTAL, SPECIAL, EXEMPLARY, OR CONSEQUENTIAL
.\" DAMAGES (INCLUDING, BUT NOT LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS
.\" OR SERVICES; LOSS OF USE, DATA, OR PROFITS; OR BUSINESS INTERRUPTION)
.\" HOWEVER CAUSED AND ON ANY THEORY OF LIABILITY, WHETHER IN CONTRACT, STRICT
.\" LIABILITY, OR TORT (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY
.\" OUT OF THE USE OF THIS SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF
.\" SUCH DAMAGE.
.\"
.\"     @@(#)vnconfig.8	8.1 (Berkeley) 6/5/93
.\"
.Dd July 8, 1993
.Dt VNCONFIG 8
.Os
.Sh NAME
.Nm vnconfig
.Nd "configure vnode disks for file swapping or pseudo file systems"
.Sh SYNOPSIS
.Nm
.Op Fl ckluv
.Op Fl K Ar rounds
.Op Fl S Ar saltfile
.Ar rawdev
.Ar regular_file
.Sh DESCRIPTION
The
.Nm
command configures vnode pseudo disk devices.
It will associate (or disassociate) the special file
.Ar rawdev
with the regular file
.Ar regular_file ,
allowing the latter to be accessed as though it were a disk.
Hence a regular file within the file system can be used for swapping
or can contain a file system that is mounted in the name space.
.Pp
Both traditional devices,
.Xr vnd 4 ,
and the cache-coherent devices,
.Pa svnd ,
are configured through
.Nm vnconfig .
.Pa svnd
should be mounted with the
.Xr mount 8
option
.Dq sync
if
.Ar regular_file
is being read from,
to ensure consistency in the buffer cache.
For normal operation this is not necessary.
.Pp
The options are as follows:
.Bl -tag -width Ds
.It Fl c
Configures the device.
If successful, references to
.Ar rawdev
will access the contents of
.Ar regular_file .
This is the default operation.
.It Fl K Ar rounds
Associate an encryption key with the device.
All data will be encrypted using the Blowfish cipher before it is
written to the disk.
The user is asked for both a passphrase and the name of a salt file.
The salt file can also be specified on the command line using the
.Fl S
option.
The passphrase and salt are combined according to PKCS #5 PBKDF2 for the
specified number of
rounds to generate the actual key used.
.Ar rounds
is a number between 1000 and
.Dv INT_MAX .
DO NOT LOSE THE SALT FILE.
Encryption only works with
.Pa svnd .
.It Fl k
Associate an encryption key with the device.
All data will be encrypted using the Blowfish cipher before it is
written to the disk.
Encryption only works with
.Pa svnd .
.It Fl l
List the (s)vnd devices and indicate which ones are in use.
If a specific
.Ar rawdev
is given, then only that one will be described.
.It Fl S Ar saltfile
When
.Fl K
is used, specify the
.Pa saltfile .
.It Fl u
Unconfigures a
.Ar rawdev .
.It Fl v
Print messages to stdout describing actions taken.
.El
.Sh FILES
.Bl -tag -width /etc/rvnd?? -compact
.It Pa /dev/{,r}{,s}vnd*
.El
.Sh EXAMPLES
Configure a CD-ROM or DVD image file as vnode disk svnd0
and mount the ISO 9660 file system contained in it:
.Bd -literal -offset indent
# vnconfig svnd0 /tmp/diskimage
# mount -t cd9660 /dev/svnd0c /mnt
.Ed
.Pp
Configure an encrypted image file as vnode disk svnd0 and mount the FFS
file system contained in it.
The encryption key does not echo and must be entered every time
the vnode disk is configured.
.Bd -literal -offset indent
# vnconfig -k svnd0 /tmp/cryptimg
Encryption key:
# mount /dev/svnd0c /mnt
.Ed
.Pp
Same as above, but now configure the vnode using PKCS #5 PBKDF2 and
a salt file with 20000 rounds:
.Bd -literal -offset indent
# vnconfig -K 20000 svnd0 /tmp/cryptimg
Encryption key:
Salt file: /tmp/cryptsalt
# mount /dev/svnd0c /mnt
.Ed
.Pp
Unmount the file system and unconfigure the vnode device:
.Bd -literal -offset indent
# umount /mnt
# vnconfig -u svnd0
.Ed
.Sh SEE ALSO
.Xr vnd 4 ,
.Xr mount 8 ,
.Xr swapon 8 ,
.Xr umount 8
.Sh BUGS
This command should really be named
.Nm vndconfig .
@


1.30
log
@add an option -S for specifying the salt file for -K .  If not given, user
is prompted like before.

ok tedu@@ pedro@@ otto@@
manpage help and ok jmc@@
@
text
@d1 1
a1 1
.\"	$OpenBSD: vnconfig.8,v 1.29 2007/01/23 08:15:23 grunk Exp $
@


1.29
log
@forgot to adjust the number for -K in the introducing text, spotted by david@@
@
text
@d1 1
a1 1
.\"	$OpenBSD: vnconfig.8,v 1.28 2007/01/22 07:52:08 grunk Exp $
d47 1
d93 5
a97 1
These are combined according to PKCS #5 PBKDF2 for the specified number of
d116 5
@


1.28
log
@use a more sensible value for -K example, from tedu@@

ok jmc@@
@
text
@d1 1
a1 1
.\"	$OpenBSD: vnconfig.8,v 1.27 2007/01/14 21:45:01 grunk Exp $
d140 1
a140 1
a salt file with 1000 rounds:
@


1.27
log
@clarify that -K needs an argument >= 1000, and add two examples dealing with
encrypted images.

help from and ok pedro@@ jmc@@
@
text
@d1 1
a1 1
.\"	$OpenBSD: vnconfig.8,v 1.26 2006/07/01 07:47:49 jmc Exp $
d142 1
a142 1
# vnconfig -K 1000 svnd0 /tmp/cryptimg
@


1.26
log
@clean this page up;
@
text
@d1 1
a1 1
.\"	$OpenBSD: vnconfig.8,v 1.25 2006/07/01 07:36:27 jmc Exp $
d94 3
d127 19
@


1.25
log
@simplify synopsis/usage(); ok tedu
@
text
@d1 1
a1 1
.\"	$OpenBSD: vnconfig.8,v 1.24 2006/06/30 16:09:27 tedu Exp $
d56 1
a56 1
.Ar regular_file
d60 1
d62 1
a62 1
.Pa vnd ,
a66 4
.Pp
If you read the regular file while using
.Pa svnd ,
you need to mount the
d68 7
a74 2
with the mount option
.Ar sync
d104 1
a104 1
List the vnd devices and indicate which ones are in use.
a113 4
.Pp
If no action option is given,
.Fl c
is assumed.
@


1.24
log
@add -K option which uses a salt file and pkcs5 pbkdf2 to create a
more secure key.  with feedback from djm and markus
pkcs5 pbkdf2 code from netbsd's cgdconfig
@
text
@d1 1
a1 1
.\"	$OpenBSD: vnconfig.8,v 1.23 2005/11/27 13:12:00 jmc Exp $
d45 2
a46 2
.Op Fl c
.Op Fl vk
a48 7
.Nm
.Fl u
.Op Fl v
.Ar rawdev
.Nm
.Fl l
.Op Ar rawdev
d107 2
a108 1
Unconfigures the device.
@


1.23
log
@ISOXXX/ISO-XXX -> ISO XXX
@
text
@d1 1
a1 1
.\"	$OpenBSD: vnconfig.8,v 1.22 2005/11/27 10:49:57 jmc Exp $
d92 10
@


1.22
log
@make EXAMPLES a little more useful by providing some context;
help/ok steven@@
@
text
@d1 1
a1 1
.\"	$OpenBSD: vnconfig.8,v 1.21 2004/09/10 15:37:53 pedro Exp $
d118 1
a118 1
and mount the ISO-9660 file system contained in it:
@


1.21
log
@mention that the used cipher is Blowfish, from Jonathan Gray, ok tedu@@
@
text
@d1 1
a1 1
.\"	$OpenBSD: vnconfig.8,v 1.20 2004/06/20 19:16:37 pedro Exp $
d65 2
a66 2
Hence a regular file within the filesystem can be used for swapping
or can contain a filesystem that is mounted in the name space.
d117 12
a128 9
Configure the vnode disk
.Pa svnd0
(all of its partitions become usable):
.Pp
.Dl # vnconfig svnd0 /tmp/diskimage
.Pp
Unconfigure the same device:
.Pp
.Dl # vnconfig -u svnd0
@


1.20
log
@mention new -l option, some nitpicks
mdoc tutoring and ok jfb@@
@
text
@d1 1
a1 1
.\"	$OpenBSD: vnconfig.8,v 1.19 2003/06/12 12:59:54 jmc Exp $
d94 2
a95 1
All data will be encrypted before it is written to the disk.
@


1.19
log
@- section reorder
- macro fixes
- kill whitespace at EOL
- new sentence, new line
@
text
@d1 1
a1 1
.\"	$OpenBSD: vnconfig.8,v 1.18 2003/06/02 23:36:55 millert Exp $
d44 1
a44 1
.Nm vnconfig
d49 2
a50 1
.Nm vnconfig Fl u
d53 3
d97 5
@


1.18
log
@Remove the advertising clause in the UCB license which Berkeley
rescinded 22 July 1999.  Proofed by myself and Theo.
@
text
@d1 1
a1 1
.\"	$OpenBSD: vnconfig.8,v 1.17 2002/11/14 02:57:28 deraadt Exp $
d91 1
a91 1
Encryption only works with 
a115 3
.Sh BUGS
This command should really be named
.Nm vndconfig .
d121 3
@


1.17
log
@use $ or # before commands in examples
@
text
@d1 1
a1 1
.\"	$OpenBSD: vnconfig.8,v 1.16 2001/11/08 11:20:47 mpech Exp $
d19 1
a19 5
.\" 3. All advertising materials mentioning features or use of this software
.\"    must display the following acknowledgement:
.\"	This product includes software developed by the University of
.\"	California, Berkeley and its contributors.
.\" 4. Neither the name of the University nor the names of its contributors
@


1.16
log
@-c is defualt. minor mdoc changes.
Spotted by form@@.

millert@@ ok +help
@
text
@d1 1
a1 1
.\"	$OpenBSD: vnconfig.8,v 1.15 2000/11/09 17:53:26 aaron Exp $
d115 1
a115 1
.Dl vnconfig svnd0 /tmp/diskimage
d119 1
a119 1
.Dl vnconfig -u svnd0
@


1.15
log
@Change all option list specifications to ".Bl -tag -width Ds". Most man
pages just needed their -width parameter tweaked to "Ds", which provides
a nice width of 6 constant characters. For consistency more than anything.
@
text
@d1 1
a1 1
.\"	$OpenBSD: vnconfig.8,v 1.14 2000/06/20 21:29:20 provos Exp $
d48 2
a49 1
.Nm vnconfig Fl c
d60 1
a60 1
It will associate the special file
d91 6
a100 5
.It Fl k
Associate an encryption key with the device.  All data will be 
encrypted before it is written to the disk.  Encryption only
works with 
.Pa svnd .
@


1.14
log
@add encryption for svnd's for Erich <hh@@cyberpass.net>.  You can do a
poor man's encrypted file system with this.  Blame the Greek. okay niklas@@
@
text
@d1 1
a1 1
.\"	$OpenBSD: vnconfig.8,v 1.13 2000/04/16 17:44:33 aaron Exp $
d83 1
a83 1
.Bl -tag -width indent
@


1.13
log
@More formatting repairs.
@
text
@d1 1
a1 1
.\"	$OpenBSD: vnconfig.8,v 1.12 2000/03/19 17:57:17 aaron Exp $
d49 1
a49 1
.Op Fl v
d73 9
d94 5
@


1.12
log
@Remove hard sentence breaks. Add $OpenBSD$ tags where appropriate. Some other
cleanup along the way.
@
text
@d1 2
a2 2
.\"	$OpenBSD: vnconfig.8,v 1.11 2000/02/13 01:04:54 aaron Exp $
.\
@


1.11
log
@Clean a bit. More verbose .Nd that will match "apropos swap"; sdb@@ssr.com
@
text
@d1 1
a1 1
.\"	$OpenBSD: vnconfig.8,v 1.10 2000/01/22 13:39:29 aaron Exp $
d65 2
a66 2
or can contain a filesystem that is mounted in the name space.  Both
traditional devices,
@


1.10
log
@Spell it "usable", not "useable", for consistency across the man pages.
@
text
@d1 1
a1 1
.\"	$OpenBSD: vnconfig.8,v 1.9 2000/01/22 02:17:51 aaron Exp $
d46 1
a46 1
.Nd configure vnode disks
d57 1
a57 1
.Nm vnconfig
d67 1
a67 1
.Nm vnd  ,
d69 1
a69 1
.Nm svnd  ,
d71 1
a71 1
.Nm
d73 1
a73 1
Options indicate an action to be performed:
d95 4
d101 1
a101 3
Configures the vnode disk
.Pa svnd0
(i.e., all of its partitions become usable).
a103 2
.Pp
Unconfigures the same device.
@


1.9
log
@ie. -> i.e.,
@
text
@d1 1
a1 1
.\"	$OpenBSD: vnconfig.8,v 1.8 1999/06/05 22:18:21 aaron Exp $
d99 1
a99 1
(i.e., all of its partitions become useable).
@


1.8
log
@remove trailing whitespace, some Nm cleanup
@
text
@d1 1
a1 1
.\"	$OpenBSD: vnconfig.8,v 1.7 1999/05/23 14:11:39 aaron Exp $
d99 1
a99 1
(ie. all of its partitions become useable).
@


1.7
log
@remove argument from .Os macros so value in /usr/share/tmac/mdoc/doc-common
is used instead; kwesterback@@home.com
@
text
@d1 1
a1 1
.\"	$OpenBSD: vnconfig.8,v 1.6 1999/05/16 19:58:17 alex Exp $
d59 1
a59 1
It will associate the special file 
@


1.6
log
@Cleanup xrefs under SEE ALSO.  Specifically:

  - Sort xrefs by section, and then alphabetically.
  - Add missing commas between xref items.
  - Remove commas from the last xref entry.
  - Remove duplicate entries.
@
text
@d1 1
a1 1
.\"	$OpenBSD: vnconfig.8,v 1.5 1998/09/07 16:44:34 aaron Exp $
d43 1
a43 1
.Os BSD 4
a94 1
.Pp
@


1.5
log
@More man page fixes. Particularly fix uses of it's/its, affect/effect,
then/than and such. Other miscellaneous problems fixed across these source
files.
@
text
@d1 1
a1 1
.\"	$OpenBSD: vnconfig.8,v 1.4 1997/05/14 15:58:38 niklas Exp $
d109 2
d112 1
a112 3
.Xr mount 8 ,
.Xr umount 8 ,
.Xr vnd 4
@


1.4
log
@mention svnd
@
text
@d1 1
a1 1
.\"	$OpenBSD$
d67 4
a70 4
.Nm vnd
, and the cache-coherent devices,
.Nm svnd
, are configured through
d100 1
a100 1
(ie. all of it's partitions become useable).
d112 1
a112 1
.Xr vnd 4 .
@


1.3
log
@document that "vnd0" works
@
text
@d1 2
d65 7
a71 1
or can contain a filesystem that is mounted in the name space.
d92 1
a92 2
.It Pa /dev/rvnd??
.It Pa /dev/vnd??
d96 1
a96 1
.Dl vnconfig vnd0 /tmp/diskimage
d99 1
a99 1
.Pa vnd0
d102 1
a102 1
.Dl vnconfig -u vnd0
@


1.2
log
@from netbsd; reference new vnd.4 manpage
@
text
@d48 1
a48 1
.Ar special_file
d52 1
a52 1
.Ar special_file
d58 1
a58 1
.Ar special_file
d70 1
a70 1
.Ar special_file
d89 1
a89 1
.Dl vnconfig /dev/vnd0c /tmp/diskimage
d92 2
a93 1
.Pa vnd0c .
d95 1
a95 1
.Dl vnconfig -u /dev/vnd0c
d97 1
a97 3
Unconfigures the
.Pa vnd0c
device.
@


1.1
log
@Initial revision
@
text
@d105 2
a106 1
.Xr umount 8 .
@


1.1.1.1
log
@initial import of NetBSD tree
@
text
@@
