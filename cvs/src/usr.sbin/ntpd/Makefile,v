head	1.16;
access;
symbols
	OPENBSD_6_1:1.16.0.8
	OPENBSD_6_1_BASE:1.16
	OPENBSD_6_0:1.16.0.4
	OPENBSD_6_0_BASE:1.16
	OPENBSD_5_9:1.16.0.2
	OPENBSD_5_9_BASE:1.16
	OPENBSD_5_8:1.14.0.6
	OPENBSD_5_8_BASE:1.14
	OPENBSD_5_7:1.14.0.2
	OPENBSD_5_7_BASE:1.14
	OPENBSD_5_6:1.12.0.6
	OPENBSD_5_6_BASE:1.12
	OPENBSD_5_5:1.12.0.4
	OPENBSD_5_5_BASE:1.12
	OPENBSD_5_4:1.11.0.14
	OPENBSD_5_4_BASE:1.11
	OPENBSD_5_3:1.11.0.12
	OPENBSD_5_3_BASE:1.11
	OPENBSD_5_2:1.11.0.10
	OPENBSD_5_2_BASE:1.11
	OPENBSD_5_1_BASE:1.11
	OPENBSD_5_1:1.11.0.8
	OPENBSD_5_0:1.11.0.6
	OPENBSD_5_0_BASE:1.11
	OPENBSD_4_9:1.11.0.4
	OPENBSD_4_9_BASE:1.11
	OPENBSD_4_8:1.11.0.2
	OPENBSD_4_8_BASE:1.11
	OPENBSD_4_7:1.10.0.2
	OPENBSD_4_7_BASE:1.10
	OPENBSD_4_6:1.10.0.4
	OPENBSD_4_6_BASE:1.10
	OPENBSD_4_5:1.9.0.2
	OPENBSD_4_5_BASE:1.9
	OPENBSD_4_4:1.8.0.10
	OPENBSD_4_4_BASE:1.8
	OPENBSD_4_3:1.8.0.8
	OPENBSD_4_3_BASE:1.8
	OPENBSD_4_2:1.8.0.6
	OPENBSD_4_2_BASE:1.8
	OPENBSD_4_1:1.8.0.4
	OPENBSD_4_1_BASE:1.8
	OPENBSD_4_0:1.8.0.2
	OPENBSD_4_0_BASE:1.8
	OPENBSD_3_9:1.7.0.8
	OPENBSD_3_9_BASE:1.7
	OPENBSD_3_8:1.7.0.6
	OPENBSD_3_8_BASE:1.7
	OPENBSD_3_7:1.7.0.4
	OPENBSD_3_7_BASE:1.7
	OPENBSD_3_6:1.7.0.2
	OPENBSD_3_6_BASE:1.7;
locks; strict;
comment	@# @;


1.16
date	2015.11.20.18.53.42;	author tedu;	state Exp;
branches;
next	1.15;
commitid	SFNKvezZfDhL1PAj;

1.15
date	2015.10.05.17.26.22;	author deraadt;	state Exp;
branches;
next	1.14;
commitid	QNGwx7jHKZhifSid;

1.14
date	2015.02.17.05.48.18;	author miod;	state Exp;
branches;
next	1.13;
commitid	bHlrPBzRHrFDF09T;

1.13
date	2015.02.10.06.40.08;	author reyk;	state Exp;
branches;
next	1.12;
commitid	pXoTR74Ztt0R3SV0;

1.12
date	2013.10.04.14.28.15;	author phessler;	state Exp;
branches;
next	1.11;

1.11
date	2010.05.26.16.44.32;	author nicm;	state Exp;
branches;
next	1.10;

1.10
date	2009.06.25.14.14.54;	author deraadt;	state Exp;
branches;
next	1.9;

1.9
date	2008.09.12.10.46.09;	author henning;	state Exp;
branches;
next	1.8;

1.8
date	2006.05.26.00.33.16;	author henning;	state Exp;
branches;
next	1.7;

1.7
date	2004.07.04.11.01.49;	author alexander;	state Exp;
branches;
next	1.6;

1.6
date	2004.06.18.04.48.12;	author henning;	state Exp;
branches;
next	1.5;

1.5
date	2004.06.17.19.17.48;	author henning;	state Exp;
branches;
next	1.4;

1.4
date	2004.06.02.10.08.59;	author henning;	state Exp;
branches;
next	1.3;

1.3
date	2004.06.01.21.58.08;	author henning;	state Exp;
branches;
next	1.2;

1.2
date	2004.05.31.13.59.55;	author henning;	state Exp;
branches;
next	1.1;

1.1
date	2004.05.31.13.46.16;	author henning;	state Exp;
branches;
next	;


desc
@@


1.16
log
@use RMS for jitter. we're linking with enough libraries that libm is tiny.
ok deraadt
@
text
@#	$OpenBSD: Makefile,v 1.15 2015/10/05 17:26:22 deraadt Exp $

PROG=	ntpd
SRCS=	ntpd.c log.c ntp.c ntp_msg.c parse.y config.c \
	server.c client.c sensors.c util.c ntp_dns.c \
	control.c constraint.c
CFLAGS+= -Wall -I${.CURDIR}
CFLAGS+= -fstack-protector-all
CFLAGS+= -Wstrict-prototypes -Wmissing-prototypes
CFLAGS+= -Wmissing-declarations
CFLAGS+= -Wshadow -Wpointer-arith -Wcast-qual
CFLAGS+= -Wsign-compare
YFLAGS=
LDADD+=	-lm -lutil -ltls -lssl -lcrypto
DPADD+= ${LIBUTIL} ${LIBCRYPTO} ${LIBSSL} ${LIBTLS}
LINKS=	${BINDIR}/ntpd ${BINDIR}/ntpctl
MAN=	ntpd.8 ntpd.conf.5 ntpctl.8

.include <bsd.prog.mk>
@


1.15
log
@this process deserves -fstack-protector-all
@
text
@d1 1
a1 1
#	$OpenBSD: Makefile,v 1.14 2015/02/17 05:48:18 miod Exp $
d14 1
a14 1
LDADD+=	-lutil -ltls -lssl -lcrypto
@


1.14
log
@Fix library ordering on the link line for the sake of static arches. It's, in
that order, tls, crypto, ssl.
@
text
@d1 1
a1 1
#	$OpenBSD: Makefile,v 1.13 2015/02/10 06:40:08 reyk Exp $
d8 1
@


1.13
log
@Add support for "constraints": when configured, ntpd(8) will query the
time from HTTPS servers, by parsing the Date: header, and use the
median constraint time as a boundary to verify NTP responses.  This
adds some level of authentication and protection against MITM attacks
while preserving the accuracy of the NTP protocol; without relying on
authentication options for NTP that are basically unavailable at
present.  This is an initial implementation and the semantics will be
improved once it is in the tree.

Discussed with deraadt@@ and henning@@
OK henning@@
@
text
@d1 1
a1 1
#	$OpenBSD: Makefile,v 1.12 2013/10/04 14:28:15 phessler Exp $
d13 1
a13 1
LDADD+=	-lutil -lcrypto -lssl -ltls
@


1.12
log
@Add ntpctl(8), which allows us to query the locally running ntpd(8) process

diff from Mike Miller <mmiller mgm51 com> (many thanks!)

OK phessler@@, henning@@, todd@@
@
text
@d1 1
a1 1
#	$OpenBSD: Makefile,v 1.11 2010/05/26 16:44:32 nicm Exp $
d6 1
a6 1
	control.c
d13 2
a14 2
LDADD+=	-lutil
DPADD+= ${LIBUTIL}
@


1.11
log
@Move imsg into libutil and add a man page.

Minor bump for libutil.

Previous versions of this diff and man page looked at by various people.

"you should just commit" deraadt
@
text
@d1 1
a1 1
#	$OpenBSD: Makefile,v 1.10 2009/06/25 14:14:54 deraadt Exp $
d5 2
a6 1
	server.c client.c sensors.c util.c ntp_dns.c
d15 2
a16 1
MAN=	ntpd.8 ntpd.conf.5
@


1.10
log
@incorrect .PATH setting, discovered with nicm
@
text
@d1 1
a1 1
#	$OpenBSD: Makefile,v 1.9 2008/09/12 10:46:09 henning Exp $
d4 1
a4 1
SRCS=	ntpd.c buffer.c log.c imsg.c ntp.c ntp_msg.c parse.y config.c \
d12 2
@


1.9
log
@move dns lookups to its own (privilege revoking, not chrooting) process.
reason: the parent process must never ever block, but the dns routines can.
last not least this fixes ntpd -s 'hanging' for a long time.
tested by a couple of people
@
text
@d1 1
a1 3
#	$OpenBSD: Makefile,v 1.8 2006/05/26 00:33:16 henning Exp $

.PATH:		${.CURDIR}/..
@


1.8
log
@add support for timedelta sensors, which pretty much means udcf(4) right
now. untested due to lack of hardware, and it wouldn't have worked in the
plane anyways. work in progress, currently picks up and uses all sensors
it finds, config file bits to be added soon. theo fine with this going in
@
text
@d1 1
a1 1
#	$OpenBSD: Makefile,v 1.7 2004/07/04 11:01:49 alexander Exp $
d7 1
a7 1
	server.c client.c sensors.c util.c
@


1.7
log
@Compute the local clock offset from the server's response.
ok henning@@
@
text
@d1 1
a1 1
#	$OpenBSD: Makefile,v 1.6 2004/06/18 04:48:12 henning Exp $
d7 1
a7 1
	server.c client.c util.c
@


1.6
log
@ewps, add ntpd.conf.5
@
text
@d1 1
a1 1
#	$OpenBSD: Makefile,v 1.5 2004/06/17 19:17:48 henning Exp $
d7 1
a7 1
	server.c client.c
@


1.5
log
@provide most of the client functionality.
hook the descriptors into the main poll and such.
we're not doing anything with the reply we recive yet, tho.

mostly hacked on the Frankfurt->Montreal flight, as batteries and those
horrible air canada seats permitted...
@
text
@d1 1
a1 1
#	$OpenBSD: Makefile,v 1.4 2004/06/02 10:08:59 henning Exp $
d14 1
a14 1
MAN=	ntpd.8
@


1.4
log
@prepare for client functionality
@
text
@d1 1
a1 1
#	$OpenBSD: Makefile,v 1.3 2004/06/01 21:58:08 henning Exp $
d7 1
a7 1
	server.c
@


1.3
log
@first cut at config file parser
for now, one can set the addresses to listen on
@
text
@d1 1
a1 1
#	$OpenBSD: Makefile,v 1.2 2004/05/31 13:59:55 henning Exp $
d6 2
a7 1
SRCS=	ntpd.c buffer.c log.c imsg.c ntp.c parse.y config.c
@


1.2
log
@initial cut at a manpage
@
text
@d1 1
a1 1
#	$OpenBSD: Makefile,v 1.1 2004/05/31 13:46:16 henning Exp $
d6 1
a6 1
SRCS=	ntpd.c buffer.c log.c imsg.c ntp.c
@


1.1
log
@initial cut at ntpd.
it is just capable of answering (s)ntp4 requests with the local time
for now.
imsg/buffer and logging framework from bgpd, ntp protocol hackery
with Alexander Guy
@
text
@d1 1
a1 1
#	$OpenBSD$
d13 1
a13 1
NOMAN=
@

