head	1.21;
access;
symbols
	OPENBSD_5_6:1.20.0.4
	OPENBSD_5_6_BASE:1.20
	OPENBSD_5_5:1.16.0.4
	OPENBSD_5_5_BASE:1.16
	OPENBSD_5_4:1.14.0.2
	OPENBSD_5_4_BASE:1.14
	OPENBSD_5_3:1.11.0.2
	OPENBSD_5_3_BASE:1.11
	OPENBSD_5_2:1.4.0.2
	OPENBSD_5_2_BASE:1.4
	NGINX_1_0_14:1.1.1.1
	NGINX:1.1.1
	OPENBSD_5_1_BASE:1.1.1.1
	OPENBSD_5_1:1.1.1.1.0.2
	nginx_1_0_6:1.1.1.1
	nginx:1.1.1;
locks; strict;
comment	@# @;


1.21
date	2014.08.26.19.35.32;	author robert;	state dead;
branches;
next	1.20;
commitid	sO1mMs3aGJWmnMM1;

1.20
date	2014.06.12.15.27.08;	author robert;	state Exp;
branches;
next	1.19;
commitid	diSa3BSte1X8Lp04;

1.19
date	2014.04.18.20.22.17;	author tedu;	state Exp;
branches;
next	1.18;

1.18
date	2014.03.27.10.40.42;	author sthen;	state Exp;
branches;
next	1.17;

1.17
date	2014.03.20.12.34.28;	author sthen;	state Exp;
branches;
next	1.16;

1.16
date	2014.01.28.14.48.53;	author stephan;	state Exp;
branches;
next	1.15;

1.15
date	2013.10.09.09.10.08;	author weerd;	state Exp;
branches;
next	1.14;

1.14
date	2013.06.02.14.11.38;	author florian;	state Exp;
branches;
next	1.13;

1.13
date	2013.06.01.14.06.20;	author naddy;	state Exp;
branches;
next	1.12;

1.12
date	2013.05.31.19.40.28;	author naddy;	state Exp;
branches;
next	1.11;

1.11
date	2013.02.09.10.50.26;	author ajacoutot;	state Exp;
branches;
next	1.10;

1.10
date	2012.11.06.20.07.23;	author pascal;	state Exp;
branches;
next	1.9;

1.9
date	2012.10.30.13.00.35;	author ajacoutot;	state Exp;
branches;
next	1.8;

1.8
date	2012.10.28.18.34.53;	author robert;	state Exp;
branches;
next	1.7;

1.7
date	2012.10.28.16.00.55;	author robert;	state Exp;
branches;
next	1.6;

1.6
date	2012.10.25.13.02.46;	author robert;	state Exp;
branches;
next	1.5;

1.5
date	2012.08.28.14.45.28;	author ajacoutot;	state Exp;
branches;
next	1.4;

1.4
date	2012.06.24.03.18.38;	author lteo;	state Exp;
branches;
next	1.3;

1.3
date	2012.03.15.10.11.37;	author robert;	state Exp;
branches;
next	1.2;

1.2
date	2012.02.19.11.29.37;	author robert;	state Exp;
branches;
next	1.1;

1.1
date	2011.09.22.23.32.15;	author robert;	state Exp;
branches
	1.1.1.1;
next	;

1.1.1.1
date	2011.09.22.23.32.15;	author robert;	state Exp;
branches;
next	;


desc
@@


1.21
log
@remove nginx from the base system in favor of OpenBSD's own httpd(8)
@
text
@# $OpenBSD: nginx.conf,v 1.20 2014/06/12 15:27:08 robert Exp $

# Take note of http://wiki.nginx.org/Pitfalls

#user  www;
worker_processes  1;

#error_log  logs/error.log;
#error_log  logs/error.log  notice;
#error_log  logs/error.log  info;
#error_log  syslog:server=unix:/dev/log,severity=notice;

#pid        logs/nginx.pid;

worker_rlimit_nofile 1024;
events {
    worker_connections  800;
}


http {
    include       mime.types;
    default_type  application/octet-stream;
    index         index.html index.htm;

    #log_format  main  '$remote_addr - $remote_user [$time_local] "$request" '
    #                  '$status $body_bytes_sent "$http_referer" '
    #                  '"$http_user_agent" "$http_x_forwarded_for"';

    #access_log  logs/access.log  main;
    #access_log  syslog:server=unix:/dev/log,severity=notice main;

    #tcp_nopush     on;

    #keepalive_timeout  0;
    keepalive_timeout  65;

    #gzip  on;

    server_tokens off;

    server {
        listen       80;
        listen       [::]:80;
        server_name  localhost;
        root         /var/www/htdocs;

        #charset koi8-r;

        #access_log  logs/host.access.log  main;

        #error_page  404              /404.html;

        # redirect server error pages to the static page /50x.html
        #
        error_page   500 502 503 504  /50x.html;
        location = /50x.html {
            root  /var/www/htdocs;
        }

        # FastCGI to CGI wrapper server
        #
        #location /cgi-bin/ {
        #    fastcgi_pass   unix:run/slowcgi.sock;
        #    fastcgi_split_path_info ^(/cgi-bin/[^/]+)(.*);
        #    fastcgi_param  PATH_INFO $fastcgi_path_info;
        #    include        fastcgi_params;
        #}

        # proxy the PHP scripts to Apache listening on 127.0.0.1:80
        #
        #location ~ \.php$ {
        #    proxy_pass   http://127.0.0.1;
        #}

        # pass the PHP scripts to FastCGI server listening on unix socket
        #
        #location ~ \.php$ {
        #    try_files      $uri $uri/ =404;
        #    fastcgi_pass   unix:run/php-fpm.sock;
        #    fastcgi_index  index.php;
        #    fastcgi_param  SCRIPT_FILENAME $document_root$fastcgi_script_name;
        #    include        fastcgi_params;
        #}

        # deny access to .htaccess files, if Apache's document root
        # concurs with nginx's one
        #
        #location ~ /\.ht {
        #    deny  all;
        #}
    }


    # another virtual host using mix of IP-, name-, and port-based configuration
    #
    #server {
    #    listen       8000;
    #    listen       somename:8080;
    #    server_name  somename  alias  another.alias;
    #    root         /var/www/htdocs;
    #}


    # HTTPS server
    #
    #server {
    #    listen       443;
    #    server_name  localhost;
    #    root         /var/www/htdocs;

    #    ssl                  on;
    #    ssl_certificate      /etc/ssl/server.crt;
    #    ssl_certificate_key  /etc/ssl/private/server.key;

    #    ssl_session_timeout  5m;
    #    ssl_session_cache    shared:SSL:1m;

    #    ssl_ciphers  HIGH:!aNULL:!MD5:!RC4;
    #    ssl_prefer_server_ciphers   on;
    #}

}
@


1.20
log
@update to 1.6.0 with official syslog support backported from the 1.7 branch

tested by several, ok sthen@@
@
text
@d1 1
a1 1
# $OpenBSD: nginx.conf,v 1.19 2014/04/18 20:22:17 tedu Exp $
@


1.19
log
@raise file limit to something more web scale, but lower connections so
there are some files to spare for other things.
@
text
@d1 1
a1 1
# $OpenBSD: nginx.conf,v 1.18 2014/03/27 10:40:42 sthen Exp $
a7 2
#syslog     local5          nginx;

d11 1
a11 1
#error_log  syslog:notice|logs/error.log;
d31 1
a31 1
    #access_log  syslog:notice|logs/access.log main;
@


1.18
log
@adjust commented-out sample blocks for PHP and SSL configurations:

- add a small shared SSL session cache
- disable rc4 ciphers in sample config
- switch to a unix socket for php-fpm
- use try_files to avoid passing non-existing files to php
http://wiki.nginx.org/Pitfalls#Passing_Uncontrolled_Requests_to_PHP

ok robert@@
@
text
@d1 1
a1 1
# $OpenBSD: nginx.conf,v 1.17 2014/03/20 12:34:28 sthen Exp $
d17 1
a17 1

d19 1
a19 1
    worker_connections  1024;
@


1.17
log
@- add a comment pointing to http://wiki.nginx.org/Pitfalls, it has important
information for people writing nginx configuration.

- remove commented-out "ssl_protocols SSLv3 TLSv1" line; nginx default is
"SSLv3 TLSv1 TLSv1.1 TLSv1.2", so uncommenting this line removes desirable
protocols

ok robert@@
@
text
@d1 1
a1 1
# $OpenBSD: nginx.conf,v 1.16 2014/01/28 14:48:53 stephan Exp $
d78 1
a78 1
        # pass the PHP scripts to FastCGI server listening on 127.0.0.1:9000
d81 2
a82 2
        #    root           /var/www/htdocs;
        #    fastcgi_pass   127.0.0.1:9000;
d84 1
a84 1
        #    fastcgi_param  SCRIPT_FILENAME  $document_root$fastcgi_script_name;
d119 1
d121 1
a121 1
    #    ssl_ciphers  HIGH:!aNULL:!MD5;
@


1.16
log
@Do not send Nginx version number in error pages and Server header by default. OK robert@@, sthen@@ and jasper@@.
@
text
@d1 3
a3 1
# $OpenBSD: nginx.conf,v 1.15 2013/10/09 09:10:08 weerd Exp $
a119 1
    #    ssl_protocols  SSLv3 TLSv1;
@


1.15
log
@Move the (commented out) syslog directive above the error_log lines.
Prevents "nginx: [emerg] You must set the syslog directive and enable
it first."

OK sthen@@ and ajacoutot@@
@
text
@d1 1
a1 1
# $OpenBSD: nginx.conf,v 1.14 2013/06/02 14:11:38 florian Exp $
d39 2
@


1.14
log
@move bgplg and slowcgi sockets to /var/www/run
input reyk@@, guenther@@
"move fast" deraadt@@
OK naddy@@
@
text
@d1 1
a1 1
# $OpenBSD: nginx.conf,v 1.13 2013/06/01 14:06:20 naddy Exp $
d6 2
a11 2

#syslog     local5          nginx;
@


1.13
log
@hook up slowcgi to the tree, including /etc glue and a sample configuration
snippet; ok florian@@
@
text
@d1 1
a1 1
# $OpenBSD: nginx.conf,v 1.12 2013/05/31 19:40:28 naddy Exp $
d62 1
a62 1
        #    fastcgi_pass   unix:logs/slowcgi.sock;
@


1.12
log
@also listen on v6 by default; ok matthieu@@ deraadt@@
@
text
@d1 1
a1 1
# $OpenBSD: nginx.conf,v 1.11 2013/02/09 10:50:26 ajacoutot Exp $
d58 9
@


1.11
log
@Put index and root directives where they belong according to the nginx
Pitfalls rules.

ok robert@@
@
text
@d1 1
a1 1
# $OpenBSD: nginx.conf,v 1.10 2012/11/06 20:07:23 pascal Exp $
d42 1
@


1.10
log
@Advertising SSLv2 in the example config doesn't make much sense now that it's
disabled.

ok robert@@
@
text
@d1 1
a1 1
# $OpenBSD: nginx.conf,v 1.9 2012/10/30 13:00:35 ajacoutot Exp $
d24 1
d43 1
a48 5
        location / {
            root   /var/www/htdocs;
            index  index.html index.htm;
        }

d89 1
a89 5

    #    location / {
    #        root   /var/www/htdocs;
    #        index  index.html index.htm;
    #    }
d98 1
a108 5

    #    location / {
    #        root   /var/www/htdocs;
    #        index  index.html index.htm;
    #    }
@


1.9
log
@Add RCS ids to the config files.
@
text
@d1 1
a1 1
# $OpenBSD$
d112 1
a112 1
    #    ssl_protocols  SSLv2 SSLv3 TLSv1;
@


1.8
log
@use the default SYSLOG_FACILITY definition which is LOCAL5
noted by ajacoutot@@
@
text
@d1 2
@


1.7
log
@rework the default config a bit to work with php-fpm out of the box
@
text
@d9 1
a9 1
#syslog     local6          nginx;
@


1.6
log
@add syslog support to nginx
@
text
@d1 1
a1 2

#user  nobody;
d46 1
a46 1
            root   /htdocs;
d56 1
a56 1
            root  /htdocs;
d68 1
a68 1
        #    root           /htdocs;
d71 1
a71 1
        #    fastcgi_param  SCRIPT_FILENAME  /htdocs$fastcgi_script_name;
d92 1
a92 1
    #        root   /htdocs;
d115 1
a115 1
    #        root   /htdocs;
@


1.5
log
@Don't enable "sendfile" which does not work on OpenBSD according to robert@@

ok robert@@
@
text
@d8 3
d29 1
@


1.4
log
@Make the default SSL file locations match the ssl(8) man page for
consistency.

ok robert haesbaert henning
@
text
@a26 1
    sendfile        on;
@


1.3
log
@use the correct dir for php in the default config
@
text
@d103 2
a104 2
    #    ssl_certificate      cert.pem;
    #    ssl_certificate_key  cert.key;
@


1.2
log
@add a distribution target to install configuration files
@
text
@d69 1
a69 1
        #    fastcgi_param  SCRIPT_FILENAME  /scripts$fastcgi_script_name;
@


1.1
log
@Initial revision
@
text
@d44 1
a44 1
            root   html;
d54 1
a54 1
            root   html;
d66 1
a66 1
        #    root           html;
d90 1
a90 1
    #        root   html;
d113 1
a113 1
    #        root   html;
@


1.1.1.1
log
@import of nginx 1.0.6 with a bundled libpcre needed for pcre to work
properly.
this is not yet linked to the build but we would like to work on it
in tree to provide an apache replacement for base
@
text
@@
