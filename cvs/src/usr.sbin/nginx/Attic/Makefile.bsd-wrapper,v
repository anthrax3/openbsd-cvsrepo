head	1.18;
access;
symbols
	OPENBSD_5_6:1.17.0.4
	OPENBSD_5_6_BASE:1.17
	OPENBSD_5_5:1.14.0.4
	OPENBSD_5_5_BASE:1.14
	OPENBSD_5_4:1.12.0.2
	OPENBSD_5_4_BASE:1.12
	OPENBSD_5_3:1.10.0.2
	OPENBSD_5_3_BASE:1.10
	OPENBSD_5_2:1.8.0.2
	OPENBSD_5_2_BASE:1.8
	OPENBSD_5_1_BASE:1.3
	OPENBSD_5_1:1.3.0.2
	nginx_1_0_6:1.1.1.1
	nginx:1.1.1;
locks; strict;
comment	@# @;


1.18
date	2014.08.26.19.35.31;	author robert;	state dead;
branches;
next	1.17;
commitid	sO1mMs3aGJWmnMM1;

1.17
date	2014.06.12.15.27.08;	author robert;	state Exp;
branches;
next	1.16;
commitid	diSa3BSte1X8Lp04;

1.16
date	2014.05.18.05.27.49;	author jsg;	state Exp;
branches;
next	1.15;

1.15
date	2014.04.15.20.55.42;	author miod;	state Exp;
branches;
next	1.14;

1.14
date	2013.11.04.14.09.19;	author florian;	state Exp;
branches;
next	1.13;

1.13
date	2013.08.06.19.05.57;	author miod;	state Exp;
branches;
next	1.12;

1.12
date	2013.06.19.16.21.12;	author reyk;	state Exp;
branches;
next	1.11;

1.11
date	2013.06.01.16.12.54;	author robert;	state Exp;
branches;
next	1.10;

1.10
date	2013.02.05.15.01.02;	author ajacoutot;	state Exp;
branches;
next	1.9;

1.9
date	2012.10.25.13.02.46;	author robert;	state Exp;
branches;
next	1.8;

1.8
date	2012.07.12.09.17.40;	author jasper;	state Exp;
branches;
next	1.7;

1.7
date	2012.07.07.16.01.48;	author robert;	state Exp;
branches;
next	1.6;

1.6
date	2012.06.26.10.03.41;	author robert;	state Exp;
branches;
next	1.5;

1.5
date	2012.04.10.15.50.38;	author miod;	state Exp;
branches;
next	1.4;

1.4
date	2012.02.19.11.29.37;	author robert;	state Exp;
branches;
next	1.3;

1.3
date	2011.10.05.18.04.18;	author robert;	state Exp;
branches;
next	1.2;

1.2
date	2011.09.24.20.13.57;	author robert;	state Exp;
branches;
next	1.1;

1.1
date	2011.09.22.23.32.10;	author robert;	state Exp;
branches
	1.1.1.1;
next	;

1.1.1.1
date	2011.09.22.23.32.10;	author robert;	state Exp;
branches;
next	;


desc
@@


1.18
log
@remove nginx from the base system in favor of OpenBSD's own httpd(8)
@
text
@# Build wrapper for Nginx
# $OpenBSD: Makefile.bsd-wrapper,v 1.17 2014/06/12 15:27:08 robert Exp $

LNDIR=	/usr/bin/lndir

.include <bsd.own.mk>

CONFIGURE_ARGS=	--prefix=/var/www \
		--conf-path=/etc/nginx/nginx.conf \
		--sbin-path=/usr/sbin/nginx \
		--pid-path=/var/run/nginx.pid \
		--lock-path=/var/run/nginx.lock \
		--http-log-path=logs/access.log \
		--error-log-path=logs/error.log \
		--http-client-body-temp-path=/var/www/cache/client_body_temp \
		--http-proxy-temp-path=/var/www/cache/proxy_temp \
		--http-fastcgi-temp-path=/var/www/cache/fastcgi_temp \
		--http-scgi-temp-path=/var/www/cache/scgi_temp \
		--http-uwsgi-temp-path=/var/www/cache/uwsgi_temp \
		--user=www \
		--group=www \
		--with-http_gzip_static_module \
		--with-http_ssl_module \
		--with-http_stub_status_module \
		--with-ipv6 \
		--without-mail_pop3_module \
		--without-mail_imap_module \
		--without-mail_smtp_module

MAN+=	${.OBJDIR}/objs/nginx.8 man/nginx.conf.5

all: 	${.OBJDIR}/objs/ngx_auto_config.h
	@@cd ${.OBJDIR} && ${MAKE}

BEFOREMAN=${.OBJDIR}/objs/ngx_auto_config.h

${.OBJDIR}/objs/nginx.8: ${BEFOREMAN}
	cd ${.OBJDIR} && ${MAKE} -f objs/Makefile manpage

${.OBJDIR}/objs/ngx_auto_config.h: ${.OBJDIR}/configure
	@@cd ${.OBJDIR} && CC="${CC}" CORE_LINK="${CORE_LINK}" \
		OPTIM="${CFLAGS} ${COPTS}" \
		PATH="/sbin:/usr/sbin:/bin:/usr/bin" \
			sh configure ${CONFIGURE_ARGS}

.if !exists(${.OBJDIR}/configure)
${.OBJDIR}/configure: ${.CURDIR}/configure
	${LNDIR} -s -e obj -e obj.${MACHINE_ARCH} -e Makefile.bsd-wrapper ${.CURDIR}
.endif

.if ${.OBJDIR} == ${.CURDIR}
clean:
	-@@cd ${.OBJDIR} && ${MAKE} clean
.else
clean:
	@@cd ${.OBJDIR} && find . \! -type d -print0 | xargs -0r rm
.endif

cleandir: clean

prereq:
# nothing left

test:
	# Nothing here so far...

depend:
	# Nothing here so far...

lint:
	# Nothing here so far...

tags:
	# Nothing here so far...

distribution:
	${INSTALL} -C -o root -g wheel -m 0644 \
		${.CURDIR}/conf/fastcgi_params \
		${.CURDIR}/conf/koi-utf \
		${.CURDIR}/conf/koi-win  \
		${.CURDIR}/conf/mime.types \
		${.CURDIR}/conf/nginx.conf \
		${.CURDIR}/conf/scgi_params \
		${.CURDIR}/conf/uwsgi_params \
		${.CURDIR}/conf/win-utf \
			${DESTDIR}/etc/nginx/
	${INSTALL} -C -o ${BINOWN} -g ${BINGRP} -m 0444 \
		${.CURDIR}/html/50x.html \
			${DESTDIR}/var/www/htdocs/

.ifdef NOMAN
maninstall:
	@@echo NOMAN is set
.endif

install: maninstall
	${INSTALL} ${INSTALL_COPY} ${INSTALL_STRIP} -o ${BINOWN} \
		-g ${BINGRP} -m ${BINMODE} objs/nginx ${DESTDIR}/usr/sbin/nginx

.include <bsd.obj.mk>
.include <bsd.subdir.mk>
.ifndef NOMAN
.include <bsd.man.mk>
.endif
@


1.17
log
@update to 1.6.0 with official syslog support backported from the 1.7 branch

tested by several, ok sthen@@
@
text
@d2 1
a2 1
# $OpenBSD: Makefile.bsd-wrapper,v 1.16 2014/05/18 05:27:49 jsg Exp $
@


1.16
log
@There is no need to compile nginx with -O1 on vax anymore.
Since the change in rev 1.5 vax has switched to gcc3,
MAXDSIZ has increased and pcre_exec now builds with -O2.

ok miod@@
@
text
@d2 1
a2 1
# $OpenBSD: Makefile.bsd-wrapper,v 1.15 2014/04/15 20:55:42 miod Exp $
a25 1
		--with-cc-opt="-DNGX_ENABLE_SYSLOG" \
@


1.15
log
@Remove workarounds for ld reaching MAXDSIZ on vax, now that MAXDSIZ is
more comfortable.
Reminded by brad@@
@
text
@d2 1
a2 1
# $OpenBSD: Makefile.bsd-wrapper,v 1.14 2013/11/04 14:09:19 florian Exp $
a6 4

.if (${MACHINE_ARCH} == "vax")
CFLAGS=-O1 ${PIPE} ${DEBUG}
.endif
@


1.14
log
@Hook up nginx.conf(5) to the build.
put it in deraadt@@, OK schwarze@@
@
text
@d2 1
a2 1
# $OpenBSD: Makefile.bsd-wrapper,v 1.13 2013/08/06 19:05:57 miod Exp $
a9 1
CORE_LINK=-Wl,--no-keep-memory
@


1.13
log
@Switch vax to gcc 3.3.6.
@
text
@d2 1
a2 1
# $OpenBSD: Makefile.bsd-wrapper,v 1.12 2013/06/19 16:21:12 reyk Exp $
d36 1
a36 1
MAN+=	${.OBJDIR}/objs/nginx.8
@


1.12
log
@Disable SPDY until we have a better understanding about code and
protocol within OpenBSD.

Discussed with many
ok benno@@ jcs@@
@
text
@d2 1
a2 1
# $OpenBSD: Makefile.bsd-wrapper,v 1.11 2013/06/01 16:12:54 robert Exp $
d10 1
d47 1
a47 1
	@@cd ${.OBJDIR} && CC="${CC}" LD_SHLIB="${CC}" \
@


1.11
log
@update to nginx-1.4.1 and enable the SPDY module by default
@
text
@d2 1
a2 1
# $OpenBSD: Makefile.bsd-wrapper,v 1.10 2013/02/05 15:01:02 ajacoutot Exp $
a28 1
		--with-http_spdy_module \
@


1.10
log
@Install 50x.html which is part of the default nginx configuration.

ok robert@@
@
text
@d2 1
a2 1
# $OpenBSD: Makefile.bsd-wrapper,v 1.9 2012/10/25 13:02:46 robert Exp $
d29 1
@


1.9
log
@add syslog support to nginx
@
text
@d2 1
a2 1
# $OpenBSD: Makefile.bsd-wrapper,v 1.8 2012/07/12 09:17:40 jasper Exp $
d92 3
@


1.8
log
@remove a double .include

ok robert@@
@
text
@d2 1
a2 1
# $OpenBSD: Makefile.bsd-wrapper,v 1.7 2012/07/07 16:01:48 robert Exp $
d30 1
@


1.7
log
@update to 1.2.2 and start using /var/www/cache instead of /var/www/tmp
@
text
@d2 1
a2 1
# $OpenBSD: Makefile.bsd-wrapper,v 1.6 2012/06/26 10:03:41 robert Exp $
a34 2

.include <bsd.own.mk>
@


1.6
log
@use /var/www/tmp/ for the temp directories even if not chrooted
@
text
@d2 1
a2 1
# $OpenBSD: Makefile.bsd-wrapper,v 1.5 2012/04/10 15:50:38 miod Exp $
d19 5
a23 5
		--http-client-body-temp-path=/var/www/tmp/client_body_temp \
		--http-proxy-temp-path=/var/www/tmp/proxy_temp \
		--http-fastcgi-temp-path=/var/www/tmp/fastcgi_temp \
		--http-scgi-temp-path=/var/www/tmp/scgi_temp \
		--http-uwsgi-temp-path=/var/www/tmp/uwsgi_temp \
@


1.5
log
@Build with -O1 on vax for now, pcre_exec can not build with -O2.
@
text
@d2 1
a2 1
# $OpenBSD: Makefile.bsd-wrapper,v 1.4 2012/02/19 11:29:37 robert Exp $
d19 5
a23 5
		--http-client-body-temp-path=/tmp/client_body_temp \
		--http-proxy-temp-path=/tmp/proxy_temp \
		--http-fastcgi-temp-path=/tmp/fastcgi_temp \
		--http-scgi-temp-path=/tmp/scgi_temp \
		--http-uwsgi-temp-path=/tmp/uwsgi_temp \
@


1.4
log
@add a distribution target to install configuration files
@
text
@d2 1
a2 1
# $OpenBSD: Makefile.bsd-wrapper,v 1.3 2011/10/05 18:04:18 robert Exp $
d7 4
@


1.3
log
@Since the worker process of nginx is chrooted on OpenBSD, let's remove
down the prefix of nginx which is /var/www from the file paths when
the worker process tries to reopen files (access.log, error.log, etc.).
This fixes the 'nginx -s reopen' issue which was reported by some users.
@
text
@d2 1
a2 1
# $OpenBSD: Makefile.bsd-wrapper,v 1.2 2011/09/24 20:13:57 robert Exp $
d77 12
@


1.2
log
@generate and install the correct manual page, noted by deraadt@@
@
text
@d2 1
a2 1
# $OpenBSD: Makefile.bsd-wrapper,v 1.1.1.1 2011/09/22 23:32:10 robert Exp $
d8 1
a8 1
CONFIGURE_ARGS=	--prefix=/etc/nginx \
d13 2
a14 2
		--http-log-path=/var/www/logs/access.log \
		--error-log-path=/var/www/logs/error.log \
@


1.1
log
@Initial revision
@
text
@d2 1
a2 1
# $OpenBSD$
d30 1
a30 1
MAN+=	man/nginx.8
d38 3
@


1.1.1.1
log
@import of nginx 1.0.6 with a bundled libpcre needed for pcre to work
properly.
this is not yet linked to the build but we would like to work on it
in tree to provide an apache replacement for base
@
text
@@
