head	1.11;
access;
symbols
	OPENBSD_5_2:1.10.0.24
	OPENBSD_5_2_BASE:1.10
	OPENBSD_5_1_BASE:1.10
	OPENBSD_5_1:1.10.0.22
	OPENBSD_5_0:1.10.0.20
	OPENBSD_5_0_BASE:1.10
	OPENBSD_4_9:1.10.0.18
	OPENBSD_4_9_BASE:1.10
	OPENBSD_4_8:1.10.0.16
	OPENBSD_4_8_BASE:1.10
	OPENBSD_4_7:1.10.0.12
	OPENBSD_4_7_BASE:1.10
	OPENBSD_4_6:1.10.0.14
	OPENBSD_4_6_BASE:1.10
	OPENBSD_4_5:1.10.0.10
	OPENBSD_4_5_BASE:1.10
	OPENBSD_4_4:1.10.0.8
	OPENBSD_4_4_BASE:1.10
	OPENBSD_4_3:1.10.0.6
	OPENBSD_4_3_BASE:1.10
	OPENBSD_4_2:1.10.0.4
	OPENBSD_4_2_BASE:1.10
	OPENBSD_4_1:1.10.0.2
	OPENBSD_4_1_BASE:1.10
	OPENBSD_4_0:1.9.0.12
	OPENBSD_4_0_BASE:1.9
	OPENBSD_3_9:1.9.0.10
	OPENBSD_3_9_BASE:1.9
	OPENBSD_3_8:1.9.0.8
	OPENBSD_3_8_BASE:1.9
	OPENBSD_3_7:1.9.0.6
	OPENBSD_3_7_BASE:1.9
	OPENBSD_3_6:1.9.0.4
	OPENBSD_3_6_BASE:1.9
	OPENBSD_3_5:1.9.0.2
	OPENBSD_3_5_BASE:1.9
	OPENBSD_3_4:1.5.0.2
	OPENBSD_3_4_BASE:1.5
	OPENBSD_3_3:1.3.0.4
	OPENBSD_3_3_BASE:1.3
	OPENBSD_3_2:1.3.0.2
	OPENBSD_3_2_BASE:1.3;
locks; strict;
comment	@# @;


1.11
date	2012.08.23.06.21.46;	author deraadt;	state dead;
branches;
next	1.10;

1.10
date	2006.11.15.00.17.13;	author deraadt;	state Exp;
branches;
next	1.9;

1.9
date	2004.03.02.18.17.49;	author miod;	state Exp;
branches;
next	1.8;

1.8
date	2004.02.27.17.36.17;	author deraadt;	state Exp;
branches;
next	1.7;

1.7
date	2004.02.12.05.14.26;	author drahn;	state Exp;
branches;
next	1.6;

1.6
date	2004.02.09.04.11.19;	author deraadt;	state Exp;
branches;
next	1.5;

1.5
date	2003.08.27.08.10.12;	author hin;	state Exp;
branches;
next	1.4;

1.4
date	2003.08.05.11.09.34;	author hin;	state Exp;
branches;
next	1.3;

1.3
date	2002.06.07.19.25.05;	author hin;	state Exp;
branches;
next	1.2;

1.2
date	2002.06.07.18.49.46;	author hin;	state Exp;
branches;
next	1.1;

1.1
date	2002.06.07.05.02.58;	author hin;	state Exp;
branches;
next	;


desc
@@


1.11
log
@the afs src tree can go away
@
text
@### lwp stuff
SRCS		+= lwp.c lock.c iomgr.c timer.c fasttime.c preempt.c q.c
OBJS		+= process.o
CLEANFILES	+= process.S process.o lwp.c lwp.h
.PATH:	${AFSSRC}/lwp
CFLAGS	+= -DAFS_BSD_ENV -DFD_SPEED_HACK -I${AFSSRC}/lwp
AINC	+= -DUSING_ASM -DHAVE_PIC

# We use the handcoded assembler stuff for context switching, not
# pthreads (because pthreads do not work for now).

beforedepend: lwp.c lwp.h

lwp.h:
	ln -sf ${AFSSRC}/lwp/lwp_asm.h lwp.h
lwp.c:
	ln -sf ${AFSSRC}/lwp/lwp_asm.c lwp.c

process.S:
	HOST_CPU=${MACHINE_ARCH}; \
	case "$$HOST_CPU" in \
		arm)   PROCESS_S="process.arm.S" ;; \
		amd64)   PROCESS_S="process.x86_64.S" ;; \
		sparc64) PROCESS_S="process.sparc.S" ;; \
		sparc)   PROCESS_S="process.sparc.S" ;; \
		i*86*)   PROCESS_S="process.i386.S" ;; \
		m68k)    PROCESS_S="process.m68k.S" ;; \
		m88k)    PROCESS_S="process.m88k.S" ;; \
		mips*)   PROCESS_S="process.mips.S" ;; \
		alpha*)  PROCESS_S="process.alpha.S" ;; \
		hppa*)   PROCESS_S="process.hpux.S" ;; \
		powerpc) PROCESS_S="process.ppc.S" ;; \
		rs6000)  PROCESS_S="process.rios.S" ;; \
		sh)	 PROCESS_S="process.sh.S" ;; \
                vax)     PROCESS_S="process.vax.S" ;; \
		*)  echo "Unknown host_cpu, good luck" ;; \
	esac; \
	ln -s ${AFSSRC}/lwp/$$PROCESS_S process.S

all:	lwp.h
@


1.10
log
@when process.sh.S shows up, have the Makefile grok it
@
text
@@


1.9
log
@Arla lwp support for m88k systems. Slightly abuses the framework to
enforce 8-byte stack alignment.
@
text
@d34 1
@


1.8
log
@change amd64's MACHINE_ARCH from x86_64 to amd64.  There are many many
reasons for this, quite a few of them technical, and not all of them
in response to Intel's broken ia32e crud.  The gcc toolchain stays at
x86_64 for now.
@
text
@d28 1
@


1.7
log
@Recognize the process.arm.S file committed earlier today.
@
text
@d23 1
a23 1
		x86_64)   PROCESS_S="process.x86_64.S" ;; \
@


1.6
log
@use process.x86_64.S
@
text
@d22 1
@


1.5
log
@Build process.S using the rules in bsd.lib.mk, instead of having a specific
target for building it.
This makes the build work for people who build with DEBUGLIBS=Yes.
Tested by brad and jolan.

ok brad@@ jolan@@
@
text
@d22 1
@


1.4
log
@More files to compile, small cleanups and various other changes needed
after arla update.
@
text
@d7 1
d36 1
a36 4
process.o: process.S
	${CC} ${CFLAGS} -DUSING_ASM -DHAVE_PIC -c process.S

all:	lwp.h@


1.3
log
@Engage brain before commiting...

- remove false dependency when creating symlinks into source tree
- add -f flag to ln to force recreation of the symlinks if the target would
  somehow be triggered

ok maja@@
@
text
@d36 1
a36 1
	${CC} ${CFLAGS} -DHAVE_PIC -c process.S
@


1.2
log
@Add an explicit dependency for two symlinked files, to make maja@@'s
problems go away.
@
text
@d13 4
a16 4
lwp.h:	${AFSSRC}/lwp/lwp_asm.h
	ln -s ${AFSSRC}/lwp/lwp_asm.h lwp.h
lwp.c:	lwp.h ${AFSSRC}/lwp/lwp_asm.c
	ln -s ${AFSSRC}/lwp/lwp_asm.c lwp.c
@


1.1
log
@Buildsystem for arla-0.35.7
@
text
@d13 1
a13 1
lwp.h:
d15 1
a15 1
lwp.c:	lwp.h
@

