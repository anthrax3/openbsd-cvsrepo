head	1.8;
access;
symbols
	OPENBSD_6_1:1.8.0.2
	OPENBSD_6_1_BASE:1.8
	OPENBSD_6_0:1.6.0.38
	OPENBSD_6_0_BASE:1.6
	OPENBSD_5_9:1.6.0.32
	OPENBSD_5_9_BASE:1.6
	OPENBSD_5_8:1.6.0.34
	OPENBSD_5_8_BASE:1.6
	OPENBSD_5_7:1.6.0.26
	OPENBSD_5_7_BASE:1.6
	OPENBSD_5_6:1.6.0.30
	OPENBSD_5_6_BASE:1.6
	OPENBSD_5_5:1.6.0.28
	OPENBSD_5_5_BASE:1.6
	OPENBSD_5_4:1.6.0.24
	OPENBSD_5_4_BASE:1.6
	OPENBSD_5_3:1.6.0.22
	OPENBSD_5_3_BASE:1.6
	OPENBSD_5_2:1.6.0.20
	OPENBSD_5_2_BASE:1.6
	OPENBSD_5_1_BASE:1.6
	OPENBSD_5_1:1.6.0.18
	OPENBSD_5_0:1.6.0.16
	OPENBSD_5_0_BASE:1.6
	OPENBSD_4_9:1.6.0.14
	OPENBSD_4_9_BASE:1.6
	OPENBSD_4_8:1.6.0.12
	OPENBSD_4_8_BASE:1.6
	OPENBSD_4_7:1.6.0.8
	OPENBSD_4_7_BASE:1.6
	OPENBSD_4_6:1.6.0.10
	OPENBSD_4_6_BASE:1.6
	OPENBSD_4_5:1.6.0.6
	OPENBSD_4_5_BASE:1.6
	OPENBSD_4_4:1.6.0.4
	OPENBSD_4_4_BASE:1.6
	OPENBSD_4_3:1.6.0.2
	OPENBSD_4_3_BASE:1.6
	OPENBSD_4_2:1.5.0.22
	OPENBSD_4_2_BASE:1.5
	OPENBSD_4_1:1.5.0.20
	OPENBSD_4_1_BASE:1.5
	OPENBSD_4_0:1.5.0.18
	OPENBSD_4_0_BASE:1.5
	OPENBSD_3_9:1.5.0.16
	OPENBSD_3_9_BASE:1.5
	OPENBSD_3_8:1.5.0.14
	OPENBSD_3_8_BASE:1.5
	OPENBSD_3_7:1.5.0.12
	OPENBSD_3_7_BASE:1.5
	OPENBSD_3_6:1.5.0.10
	OPENBSD_3_6_BASE:1.5
	SMP_SYNC_A:1.5
	SMP_SYNC_B:1.5
	OPENBSD_3_5:1.5.0.8
	OPENBSD_3_5_BASE:1.5
	OPENBSD_3_4:1.5.0.6
	OPENBSD_3_4_BASE:1.5
	UBC_SYNC_A:1.5
	OPENBSD_3_3:1.5.0.4
	OPENBSD_3_3_BASE:1.5
	OPENBSD_3_2:1.5.0.2
	OPENBSD_3_2_BASE:1.5
	OPENBSD_3_1:1.4.0.2
	OPENBSD_3_1_BASE:1.4
	UBC_SYNC_B:1.5
	UBC:1.3.0.4
	UBC_BASE:1.3
	OPENBSD_3_0:1.3.0.2
	OPENBSD_3_0_BASE:1.3
	OPENBSD_2_9_BASE:1.2
	OPENBSD_2_9:1.2.0.4
	OPENBSD_2_8:1.2.0.2
	OPENBSD_2_8_BASE:1.2
	OPENBSD_2_7:1.1.0.4
	OPENBSD_2_7_BASE:1.1
	SMP:1.1.0.2
	SMP_BASE:1.1;
locks; strict;
comment	@ * @;


1.8
date	2017.03.10.07.29.25;	author jca;	state Exp;
branches;
next	1.7;
commitid	wuugeUzB7oK5I9QF;

1.7
date	2017.02.20.17.04.25;	author jca;	state Exp;
branches;
next	1.6;
commitid	GZyyhrJ9miKYlIqA;

1.6
date	2007.12.14.18.33.41;	author deraadt;	state Exp;
branches;
next	1.5;

1.5
date	2002.06.09.16.26.10;	author itojun;	state Exp;
branches;
next	1.4;

1.4
date	2002.03.14.01.27.11;	author millert;	state Exp;
branches;
next	1.3;

1.3
date	2001.06.25.05.11.58;	author angelos;	state Exp;
branches
	1.3.4.1;
next	1.2;

1.2
date	2000.09.19.03.20.58;	author angelos;	state Exp;
branches;
next	1.1;

1.1
date	2000.01.21.03.15.05;	author angelos;	state Exp;
branches
	1.1.2.1;
next	;

1.1.2.1
date	2001.05.14.22.40.11;	author niklas;	state Exp;
branches;
next	1.1.2.2;

1.1.2.2
date	2001.07.04.10.54.50;	author niklas;	state Exp;
branches;
next	1.1.2.3;

1.1.2.3
date	2002.03.28.14.56.45;	author niklas;	state Exp;
branches;
next	1.1.2.4;

1.1.2.4
date	2003.03.28.00.06.54;	author niklas;	state Exp;
branches;
next	;

1.3.4.1
date	2002.06.11.03.31.36;	author art;	state Exp;
branches;
next	1.3.4.2;

1.3.4.2
date	2002.10.29.00.36.47;	author art;	state Exp;
branches;
next	;


desc
@@


1.8
log
@percpu counters for ip_ipip.c

ok bluhm@@ dhill@@ mpi@@
@
text
@/*	$OpenBSD: ip_ipip.h,v 1.7 2017/02/20 17:04:25 jca Exp $ */
/*
 * The authors of this code are John Ioannidis (ji@@tla.org),
 * Angelos D. Keromytis (kermit@@csd.uch.gr) and
 * Niels Provos (provos@@physnet.uni-hamburg.de).
 *
 * The original version of this code was written by John Ioannidis
 * for BSD/OS in Athens, Greece, in November 1995.
 *
 * Ported to OpenBSD and NetBSD, with additional transforms, in December 1996,
 * by Angelos D. Keromytis.
 *
 * Additional transforms and features in 1997 and 1998 by Angelos D. Keromytis
 * and Niels Provos.
 *
 * Additional features in 1999 by Angelos D. Keromytis.
 *
 * Copyright (C) 1995, 1996, 1997, 1998, 1999 by John Ioannidis,
 * Angelos D. Keromytis and Niels Provos.
 * Copyright (c) 2001, Angelos D. Keromytis.
 *
 * Permission to use, copy, and modify this software with or without fee
 * is hereby granted, provided that this entire notice is included in
 * all copies of any software which is or includes a copy or
 * modification of this software.
 * You may use this code under the GNU public license if you so wish. Please
 * contribute changes back to the authors under this freer than GPL license
 * so that we may further the use of strong encryption without limitations to
 * all.
 *
 * THIS SOFTWARE IS BEING PROVIDED "AS IS", WITHOUT ANY EXPRESS OR
 * IMPLIED WARRANTY. IN PARTICULAR, NONE OF THE AUTHORS MAKES ANY
 * REPRESENTATION OR WARRANTY OF ANY KIND CONCERNING THE
 * MERCHANTABILITY OF THIS SOFTWARE OR ITS FITNESS FOR ANY PARTICULAR
 * PURPOSE.
 */

#ifndef _NETINET_IPIP_H_
#define _NETINET_IPIP_H_

/*
 * IP-inside-IP processing.
 * Not quite all the functionality of RFC-1853, but the main idea is there.
 */

struct ipipstat {
    u_int64_t	ipips_ipackets;		/* total input packets */
    u_int64_t	ipips_opackets;		/* total output packets */
    u_int64_t	ipips_hdrops;		/* packet shorter than header shows */
    u_int64_t	ipips_qfull;
    u_int64_t	ipips_ibytes;
    u_int64_t	ipips_obytes;
    u_int64_t	ipips_pdrops;		/* packet dropped due to policy */
    u_int64_t	ipips_spoof;		/* IP spoofing attempts */
    u_int64_t	ipips_family;		/* Protocol family mismatch */
    u_int64_t	ipips_unspec;            /* Missing tunnel endpoint address */
};

#define IP4_DEFAULT_TTL    0
#define IP4_SAME_TTL	  -1

/*
 * Names for IPIP sysctl objects
 */
#define	IPIPCTL_ALLOW	1		/* accept incoming IP4 packets */
#define	IPIPCTL_STATS	2		/* IPIP stats */
#define	IPIPCTL_MAXID	3

#define IPIPCTL_NAMES { \
	{ 0, 0 }, \
	{ "allow", CTLTYPE_INT }, \
	{ "stats", CTLTYPE_STRUCT }, \
}

#ifdef _KERNEL

#include <sys/percpu.h>

enum ipipstat_counters {
	ipips_ipackets,
	ipips_opackets,
	ipips_hdrops,
	ipips_qfull,
	ipips_ibytes,
	ipips_obytes,
	ipips_pdrops,
	ipips_spoof,
	ipips_family,
	ipips_unspec,
	ipips_ncounters
};

extern struct cpumem *ipipcounters;

static inline void
ipipstat_inc(enum ipipstat_counters c)
{
	counters_inc(ipipcounters, c);
}

static inline void
ipipstat_add(enum ipipstat_counters c, uint64_t v)
{
	counters_add(ipipcounters, c, v);
}

void	ipip_init(void);
int	ipip_sysctl(int *, u_int, void *, size_t *, void *, size_t);

extern int ipip_allow;
#endif /* _KERNEL */
#endif /* _NETINET_IPIP_H_ */
@


1.7
log
@Crank all members of struct ipipstat to 64 bits

Will make conversion to percpu counters easier.  ok bluhm@@
@
text
@d1 1
a1 1
/*	$OpenBSD: ip_ipip.h,v 1.6 2007/12/14 18:33:41 deraadt Exp $ */
d76 32
a110 1
extern struct ipipstat ipipstat;
@


1.6
log
@add sysctl entry points into various network layers, in particular to
provide netstat(1) with data it needs;  ok claudio reyk
@
text
@d1 1
a1 1
/*	$OpenBSD: ip_ipip.h,v 1.5 2002/06/09 16:26:10 itojun Exp $ */
d46 11
a56 12
struct ipipstat
{
    u_int32_t	ipips_ipackets;		/* total input packets */
    u_int32_t	ipips_opackets;		/* total output packets */
    u_int32_t	ipips_hdrops;		/* packet shorter than header shows */
    u_int32_t	ipips_qfull;
    u_int64_t   ipips_ibytes;
    u_int64_t   ipips_obytes;
    u_int32_t	ipips_pdrops;		/* packet dropped due to policy */
    u_int32_t	ipips_spoof;		/* IP spoofing attempts */
    u_int32_t   ipips_family;		/* Protocol family mismatch */
    u_int32_t   ipips_unspec;            /* Missing tunnel endpoint address */
@


1.5
log
@whitespace
@
text
@d1 1
a1 1
/*	$OpenBSD: ip_ipip.h,v 1.4 2002/03/14 01:27:11 millert Exp $ */
d67 2
a68 1
#define IPIPCTL_MAXID	2
d73 1
@


1.4
log
@First round of __P removal in sys
@
text
@d1 1
a1 1
/*	$OpenBSD: ip_ipip.h,v 1.3 2001/06/25 05:11:58 angelos Exp $ */
d4 1
a4 1
 * Angelos D. Keromytis (kermit@@csd.uch.gr) and 
d25 1
a25 1
 * modification of this software. 
@


1.3
log
@Copyright.
@
text
@d1 1
a1 1
/*	$OpenBSD: ip_ipip.h,v 1.2 2000/09/19 03:20:58 angelos Exp $ */
d75 1
a75 1
int	ipip_sysctl __P((int *, u_int, void *, size_t *, void *, size_t));
@


1.3.4.1
log
@Sync UBC branch to -current
@
text
@d1 1
a1 1
/*	$OpenBSD: ip_ipip.h,v 1.3 2001/06/25 05:11:58 angelos Exp $ */
d75 1
a75 1
int	ipip_sysctl(int *, u_int, void *, size_t *, void *, size_t);
@


1.3.4.2
log
@sync to -current
@
text
@d1 1
a1 1
/*	$OpenBSD: ip_ipip.h,v 1.3.4.1 2002/06/11 03:31:36 art Exp $ */
d4 1
a4 1
 * Angelos D. Keromytis (kermit@@csd.uch.gr) and
d25 1
a25 1
 * modification of this software.
@


1.2
log
@Lots and lots of changes.
@
text
@d1 1
a1 2
/*	$OpenBSD: ip_ipip.h,v 1.1 2000/01/21 03:15:05 angelos Exp $ */

d20 3
a22 2
 *	
 * Permission to use, copy, and modify this software without fee
@


1.1
log
@Rename the ip4_* routines to ipip_*, make it so GIF tunnels are not
affected by net.inet.ipip.allow (the sysctl formerly known as
net.inet.ip4.allow), rename the VIF ipip_input to ipip_mroute_input.
@
text
@d1 1
a1 1
/*	$OpenBSD$ */
d8 2
a9 2
 * This code was written by John Ioannidis for BSD/OS in Athens, Greece, 
 * in November 1995.
@


1.1.2.1
log
@merge in approximately 2.9 into SMP branch
@
text
@d1 1
a1 1
/*	$OpenBSD: ip_ipip.h,v 1.2 2000/09/19 03:20:58 angelos Exp $ */
d8 2
a9 2
 * The original version of this code was written by John Ioannidis
 * for BSD/OS in Athens, Greece, in November 1995.
@


1.1.2.2
log
@Merge in -current from two days ago in the SMP branch.
As usual with merges, they do not indicate progress, so do not hold
your breath for working SMP, and do not mail me and ask about the
state of it.  It has not changed.  There is work ongoing, but very, very
slowly.  The commit is done in parts as to not lock up the tree in too
big chunks at a time.
@
text
@d1 2
a2 1
/*	$OpenBSD$ */
d21 2
a22 3
 * Copyright (c) 2001, Angelos D. Keromytis.
 *
 * Permission to use, copy, and modify this software with or without fee
@


1.1.2.3
log
@Merge in -current from roughly a week ago
@
text
@d75 1
a75 1
int	ipip_sysctl(int *, u_int, void *, size_t *, void *, size_t);
@


1.1.2.4
log
@Sync the SMP branch with 3.3
@
text
@d4 1
a4 1
 * Angelos D. Keromytis (kermit@@csd.uch.gr) and
d25 1
a25 1
 * modification of this software.
@


