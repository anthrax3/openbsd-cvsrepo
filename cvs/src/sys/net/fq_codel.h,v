head	1.3;
access;
symbols
	OPENBSD_6_2:1.3.0.4
	OPENBSD_6_2_BASE:1.3;
locks; strict;
comment	@ * @;


1.3
date	2017.05.12.19.15.22;	author mikeb;	state Exp;
branches;
next	1.2;
commitid	Twrh7IGXo16Xbcpx;

1.2
date	2017.05.11.12.22.26;	author mikeb;	state Exp;
branches;
next	1.1;
commitid	jOkAMKiyrsp3uhhe;

1.1
date	2017.05.04.17.57.56;	author mikeb;	state Exp;
branches;
next	;
commitid	7sbP2yeGdmmDnxgR;


desc
@@


1.3
log
@Export delay statistics instead of bucket information
@
text
@/*
 * Copyright (c) 2017 Mike Belopuhov
 *
 * Permission to use, copy, modify, and distribute this software for any
 * purpose with or without fee is hereby granted, provided that the above
 * copyright notice and this permission notice appear in all copies.
 *
 * THE SOFTWARE IS PROVIDED "AS IS" AND THE AUTHOR DISCLAIMS ALL WARRANTIES
 * WITH REGARD TO THIS SOFTWARE INCLUDING ALL IMPLIED WARRANTIES OF
 * MERCHANTABILITY AND FITNESS. IN NO EVENT SHALL THE AUTHOR BE LIABLE FOR
 * ANY SPECIAL, DIRECT, INDIRECT, OR CONSEQUENTIAL DAMAGES OR ANY DAMAGES
 * WHATSOEVER RESULTING FROM LOSS OF USE, DATA OR PROFITS, WHETHER IN AN
 * ACTION OF CONTRACT, NEGLIGENCE OR OTHER TORTIOUS ACTION, ARISING OUT OF
 * OR IN CONNECTION WITH THE USE OR PERFORMANCE OF THIS SOFTWARE.
 */

#ifndef _NET_FQ_CODEL_H_
#define _NET_FQ_CODEL_H_

/* compatible with hfsc_pktcntr */
struct fqcodel_pktcntr {
	uint64_t		packets;
	uint64_t		bytes;
};

struct fqcodel_stats {
	struct fqcodel_pktcntr 	xmit_cnt;
	struct fqcodel_pktcntr 	drop_cnt;

	uint32_t		qlength;
	uint32_t		qlimit;

	uint32_t		flows;
	uint32_t		_unused;   /* padding */

	uint32_t		target;
	uint32_t		interval;

	/* the values below are used to calculate standard deviation */
	uint64_t		delaysum;  /* sum of delays, us */
	uint64_t		delaysumsq;/* sum of squared delays, us */
};

#ifdef _KERNEL
extern const struct ifq_ops * const ifq_fqcodel_ops;
extern const struct pfq_ops * const pfq_fqcodel_ops;
#endif	/* _KERNEL */

#endif	/* _NET_FQ_CODEL_H_ */
@


1.2
log
@Add pf queue configuration glue for FQ-CoDel
@
text
@a38 3
	uint32_t		minqlen;
	uint32_t		maxqlen;

d40 2
a41 2
	uint64_t		qlensum;   /* sum of queue lenghts */
	uint64_t		qlensumsq; /* sum of squared queue lenghts */
@


1.1
log
@Implementation of the Flow Queue - Controlled Delay (FQ-CoDel)

The purpose of FQ-CoDel is to provide fair sharing of bandwidth
between simultaneous connections and reduce latency differences
among them.

OK mpi, sthen, visa
@
text
@d49 1
@

