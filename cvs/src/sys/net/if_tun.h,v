head	1.15;
access;
symbols
	OPENBSD_6_2_BASE:1.15
	OPENBSD_6_1:1.15.0.44
	OPENBSD_6_1_BASE:1.15
	OPENBSD_6_0:1.15.0.42
	OPENBSD_6_0_BASE:1.15
	OPENBSD_5_9:1.15.0.36
	OPENBSD_5_9_BASE:1.15
	OPENBSD_5_8:1.15.0.38
	OPENBSD_5_8_BASE:1.15
	OPENBSD_5_7:1.15.0.30
	OPENBSD_5_7_BASE:1.15
	OPENBSD_5_6:1.15.0.34
	OPENBSD_5_6_BASE:1.15
	OPENBSD_5_5:1.15.0.32
	OPENBSD_5_5_BASE:1.15
	OPENBSD_5_4:1.15.0.28
	OPENBSD_5_4_BASE:1.15
	OPENBSD_5_3:1.15.0.26
	OPENBSD_5_3_BASE:1.15
	OPENBSD_5_2:1.15.0.24
	OPENBSD_5_2_BASE:1.15
	OPENBSD_5_1_BASE:1.15
	OPENBSD_5_1:1.15.0.22
	OPENBSD_5_0:1.15.0.20
	OPENBSD_5_0_BASE:1.15
	OPENBSD_4_9:1.15.0.18
	OPENBSD_4_9_BASE:1.15
	OPENBSD_4_8:1.15.0.16
	OPENBSD_4_8_BASE:1.15
	OPENBSD_4_7:1.15.0.12
	OPENBSD_4_7_BASE:1.15
	OPENBSD_4_6:1.15.0.14
	OPENBSD_4_6_BASE:1.15
	OPENBSD_4_5:1.15.0.10
	OPENBSD_4_5_BASE:1.15
	OPENBSD_4_4:1.15.0.8
	OPENBSD_4_4_BASE:1.15
	OPENBSD_4_3:1.15.0.6
	OPENBSD_4_3_BASE:1.15
	OPENBSD_4_2:1.15.0.4
	OPENBSD_4_2_BASE:1.15
	OPENBSD_4_1:1.15.0.2
	OPENBSD_4_1_BASE:1.15
	OPENBSD_4_0:1.14.0.2
	OPENBSD_4_0_BASE:1.14
	OPENBSD_3_9:1.13.0.8
	OPENBSD_3_9_BASE:1.13
	OPENBSD_3_8:1.13.0.6
	OPENBSD_3_8_BASE:1.13
	OPENBSD_3_7:1.13.0.4
	OPENBSD_3_7_BASE:1.13
	OPENBSD_3_6:1.13.0.2
	OPENBSD_3_6_BASE:1.13
	SMP_SYNC_A:1.12
	SMP_SYNC_B:1.12
	OPENBSD_3_5:1.12.0.6
	OPENBSD_3_5_BASE:1.12
	OPENBSD_3_4:1.12.0.4
	OPENBSD_3_4_BASE:1.12
	UBC_SYNC_A:1.12
	OPENBSD_3_3:1.12.0.2
	OPENBSD_3_3_BASE:1.12
	OPENBSD_3_2:1.10.0.8
	OPENBSD_3_2_BASE:1.10
	OPENBSD_3_1:1.10.0.6
	OPENBSD_3_1_BASE:1.10
	UBC_SYNC_B:1.10
	UBC:1.10.0.4
	UBC_BASE:1.10
	OPENBSD_3_0:1.10.0.2
	OPENBSD_3_0_BASE:1.10
	OPENBSD_2_9_BASE:1.9
	OPENBSD_2_9:1.9.0.2
	OPENBSD_2_8:1.8.0.12
	OPENBSD_2_8_BASE:1.8
	OPENBSD_2_7:1.8.0.10
	OPENBSD_2_7_BASE:1.8
	SMP:1.8.0.8
	SMP_BASE:1.8
	kame_19991208:1.8
	OPENBSD_2_6:1.8.0.6
	OPENBSD_2_6_BASE:1.8
	OPENBSD_2_5:1.8.0.4
	OPENBSD_2_5_BASE:1.8
	OPENBSD_2_4:1.8.0.2
	OPENBSD_2_4_BASE:1.8
	OPENBSD_2_3:1.6.0.4
	OPENBSD_2_3_BASE:1.6
	OPENBSD_2_2:1.6.0.2
	OPENBSD_2_2_BASE:1.6
	OPENBSD_2_1:1.4.0.4
	OPENBSD_2_1_BASE:1.4
	OPENBSD_2_0:1.4.0.2
	OPENBSD_2_0_BASE:1.4
	netbsd_1_1:1.1.1.1;
locks; strict;
comment	@ * @;


1.15
date	2007.02.06.10.49.40;	author claudio;	state Exp;
branches;
next	1.14;

1.14
date	2006.08.20.16.13.26;	author stevesk;	state Exp;
branches;
next	1.13;

1.13
date	2004.06.25.04.09.03;	author claudio;	state Exp;
branches;
next	1.12;

1.12
date	2002.12.10.21.04.14;	author mickey;	state Exp;
branches;
next	1.11;

1.11
date	2002.12.06.15.58.49;	author nate;	state Exp;
branches;
next	1.10;

1.10
date	2001.06.09.06.16.38;	author angelos;	state Exp;
branches
	1.10.4.1;
next	1.9;

1.9
date	2001.03.05.04.00.37;	author angelos;	state Exp;
branches;
next	1.8;

1.8
date	98.08.02.07.17.44;	author brian;	state Exp;
branches
	1.8.8.1;
next	1.7;

1.7
date	98.06.26.09.14.40;	author deraadt;	state Exp;
branches;
next	1.6;

1.6
date	97.08.02.09.56.28;	author deraadt;	state Exp;
branches;
next	1.5;

1.5
date	97.07.29.05.03.48;	author deraadt;	state Exp;
branches;
next	1.4;

1.4
date	96.05.16.11.52.09;	author mickey;	state Exp;
branches;
next	1.3;

1.3
date	96.04.21.22.28.36;	author deraadt;	state Exp;
branches;
next	1.2;

1.2
date	96.02.20.14.34.01;	author mickey;	state Exp;
branches;
next	1.1;

1.1
date	95.10.18.08.53.06;	author deraadt;	state Exp;
branches
	1.1.1.1;
next	;

1.1.1.1
date	95.10.18.08.53.06;	author deraadt;	state Exp;
branches;
next	;

1.8.8.1
date	2001.05.14.22.40.02;	author niklas;	state Exp;
branches;
next	1.8.8.2;

1.8.8.2
date	2001.07.04.10.54.11;	author niklas;	state Exp;
branches;
next	1.8.8.3;

1.8.8.3
date	2003.03.28.00.41.28;	author niklas;	state Exp;
branches;
next	;

1.10.4.1
date	2003.05.19.22.30.41;	author tedu;	state Exp;
branches;
next	;


desc
@@


1.15
log
@Change the behaviour of tun(4) on close.
 - if the interface was auto-created by opening a /dev/tun* device it will
   auto-destroy on close. This is comparable to ifconfig tun0 destroy and
   will remove all routes and addresses associated with the interface.
 - if the interface was created by ifconfig(8) or hostname.if(5) the interface
   is persistent -- it is just marked as not running. Especially routes are no
   longer removed when the interface is closed. This is useful for static
   setups like the server side of a ssh vpn or static qemu session.
This behaviour is more logic then the half done cleanup that is currently done.
OK mpf@@
@
text
@/*	$OpenBSD: if_tun.h,v 1.14 2006/08/20 16:13:26 stevesk Exp $	*/

/*
 * Copyright (c) 1988, Julian Onions <Julian.Onions@@nexor.co.uk>
 * Nottingham University 1987.
 * All rights reserved.
 *
 * Redistribution and use in source and binary forms, with or without
 * modification, are permitted provided that the following conditions
 * are met:
 * 1. Redistributions of source code must retain the above copyright
 *    notice, this list of conditions and the following disclaimer.
 * 2. Redistributions in binary form must reproduce the above copyright
 *    notice, this list of conditions and the following disclaimer in the
 *    documentation and/or other materials provided with the distribution.
 *
 * THIS SOFTWARE IS PROVIDED BY THE AUTHOR ``AS IS'' AND ANY EXPRESS OR
 * IMPLIED WARRANTIES, INCLUDING, BUT NOT LIMITED TO, THE IMPLIED WARRANTIES
 * OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE ARE DISCLAIMED.
 * IN NO EVENT SHALL THE AUTHOR BE LIABLE FOR ANY DIRECT, INDIRECT,
 * INCIDENTAL, SPECIAL, EXEMPLARY, OR CONSEQUENTIAL DAMAGES (INCLUDING, BUT
 * NOT LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES; LOSS OF USE,
 * DATA, OR PROFITS; OR BUSINESS INTERRUPTION) HOWEVER CAUSED AND ON ANY
 * THEORY OF LIABILITY, WHETHER IN CONTRACT, STRICT LIABILITY, OR TORT
 * (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE USE OF
 * THIS SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.
 */

#ifndef _NET_IF_TUN_H_
#define _NET_IF_TUN_H_

#include <sys/ioccom.h>

#define	TUN_OPEN	0x0001
#define	TUN_INITED	0x0002
#define	TUN_RCOLL	0x0004	/* unused */
#define	TUN_IASET	0x0008
#define	TUN_DSTADDR	0x0010
#define	TUN_RWAIT	0x0040
#define	TUN_ASYNC	0x0080
#define	TUN_NBIO	0x0100
#define TUN_BRDADDR	0x0200
#define TUN_STAYUP	0x0400
#define TUN_LAYER2	0x0800

#define	TUN_READY	(TUN_OPEN | TUN_INITED)

/* Maximum packet size */
#define	TUNMTU		3000

/* Maximum receive packet size (hard limit) */
#define TUNMRU          16384

/* iface info */
struct tuninfo {
	u_int	mtu;
	u_short	type;
	u_short	flags;
	u_int	baudrate;
};
#define TUNSIFINFO	_IOW('t', 91, struct tuninfo)
#define TUNGIFINFO	_IOR('t', 92, struct tuninfo)

/* ioctl for changing the broadcast/point-to-point status */
#define TUNSIFMODE      _IOW('t', 93, int)

/* ioctl's for get/set debug */
#define	TUNSDEBUG	_IOW('t', 94, int)
#define	TUNGDEBUG	_IOR('t', 95, int)

#endif /* _NET_IF_TUN_H_ */
@


1.14
log
@if_tun.c also has this comment so remove duplicate; ok jmc@@ krw@@
@
text
@d1 1
a1 1
/*	$OpenBSD: if_tun.h,v 1.13 2004/06/25 04:09:03 claudio Exp $	*/
d36 1
a36 1
#define	TUN_RCOLL	0x0004
@


1.13
log
@Add tap aka layer 2 tunneling support to tun(4). It can be enabled by setting
the link0 flag via ifconfig(8). OK markus@@, canacar@@ also tested by ish@@
@
text
@d1 1
a1 1
/*	$OpenBSD: if_tun.h,v 1.12 2002/12/10 21:04:14 mickey Exp $	*/
a26 8
 */

/*
 * This driver takes packets off the IP i/f and hands them up to a
 * user process to have it's wicked way with. This driver has it's
 * roots in a similar driver written by Phil Cockcroft (formerly) at
 * UCL. This driver is based much more on read/write/select mode of
 * operation though.
@


1.12
log
@renumber the get/set debug ioctls for they conflict w/ ppp, we do not keep the O versions since these are debugging only and should not affect normal functionality; deraadt@@ ok
@
text
@d1 1
a1 1
/*	$OpenBSD: if_tun.h,v 1.11 2002/12/06 15:58:49 nate Exp $	*/
d52 1
d54 1
a54 1
#define	TUN_READY	(TUN_OPEN | TUN_INITED | TUN_IASET)
@


1.11
log
@Replace license with something that's actually free.
Approved by original author.  Julian.Onions@@nexor.co.uk
@
text
@d1 1
a1 1
/*	$OpenBSD: if_tun.h,v 1.10 2001/06/09 06:16:38 angelos Exp $	*/
a60 4
/* ioctl's for get/set debug */
#define	TUNSDEBUG	_IOW('t', 89, int)
#define	TUNGDEBUG	_IOR('t', 90, int)

d73 5
@


1.10
log
@By popular demand, protect from multiple inclusion, and fix to use the
same naming style.
@
text
@d1 1
a1 1
/*	$OpenBSD: if_tun.h,v 1.9 2001/03/05 04:00:37 angelos Exp $	*/
d4 1
a4 1
 * Copyright (c) 1988, Julian Onions <jpo@@cs.nott.ac.uk>
d6 1
d8 8
a15 2
 * This source may be freely distributed, however I would be interested
 * in any changes that are made.
d17 13
a34 2
 * 
 * from: @@Header: if_tnreg.h,v 1.1.2.1 1992/07/16 22:39:16 friedl Exp
@


1.10.4.1
log
@sync
@
text
@d1 1
a1 1
/*	$OpenBSD$	*/
d4 1
a4 1
 * Copyright (c) 1988, Julian Onions <Julian.Onions@@nexor.co.uk>
a5 1
 * All rights reserved.
d7 2
a8 8
 * Redistribution and use in source and binary forms, with or without
 * modification, are permitted provided that the following conditions
 * are met:
 * 1. Redistributions of source code must retain the above copyright
 *    notice, this list of conditions and the following disclaimer.
 * 2. Redistributions in binary form must reproduce the above copyright
 *    notice, this list of conditions and the following disclaimer in the
 *    documentation and/or other materials provided with the distribution.
a9 13
 * THIS SOFTWARE IS PROVIDED BY THE AUTHOR ``AS IS'' AND ANY EXPRESS OR
 * IMPLIED WARRANTIES, INCLUDING, BUT NOT LIMITED TO, THE IMPLIED WARRANTIES
 * OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE ARE DISCLAIMED.
 * IN NO EVENT SHALL THE AUTHOR BE LIABLE FOR ANY DIRECT, INDIRECT,
 * INCIDENTAL, SPECIAL, EXEMPLARY, OR CONSEQUENTIAL DAMAGES (INCLUDING, BUT
 * NOT LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES; LOSS OF USE,
 * DATA, OR PROFITS; OR BUSINESS INTERRUPTION) HOWEVER CAUSED AND ON ANY
 * THEORY OF LIABILITY, WHETHER IN CONTRACT, STRICT LIABILITY, OR TORT
 * (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE USE OF
 * THIS SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.
 */

/*
d15 2
d43 4
a58 5

/* ioctl's for get/set debug */
#define	TUNSDEBUG	_IOW('t', 94, int)
#define	TUNGDEBUG	_IOR('t', 95, int)

@


1.9
log
@TUNSIFMODE ioctl (from NetBSD)
@
text
@d1 1
a1 1
/*	$OpenBSD: if_tun.h,v 1.8 1998/08/02 07:17:44 brian Exp $	*/
d59 1
a59 1
#endif /* !_NET_IF_TUN_H_ */
@


1.8
log
@#define TUNMRU as 16384 and allow incoming packets
of up to this size rather than restricting them based
on our MTU.
@
text
@d1 1
a1 1
/*	$OpenBSD: if_tun.h,v 1.7 1998/06/26 09:14:40 deraadt Exp $	*/
d57 2
@


1.8.8.1
log
@merge in approximately 2.9 into SMP branch
@
text
@d1 1
a1 1
/*	$OpenBSD: if_tun.h,v 1.9 2001/03/05 04:00:37 angelos Exp $	*/
a56 2
/* ioctl for changing the broadcast/point-to-point status */
#define TUNSIFMODE      _IOW('t', 93, int)
@


1.8.8.2
log
@Merge in -current from two days ago in the SMP branch.
As usual with merges, they do not indicate progress, so do not hold
your breath for working SMP, and do not mail me and ask about the
state of it.  It has not changed.  There is work ongoing, but very, very
slowly.  The commit is done in parts as to not lock up the tree in too
big chunks at a time.
@
text
@d1 1
a1 1
/*	$OpenBSD: if_tun.h,v 1.8.8.1 2001/05/14 22:40:02 niklas Exp $	*/
d59 1
a59 1
#endif /* _NET_IF_TUN_H_ */
@


1.8.8.3
log
@Sync the SMP branch with 3.3
@
text
@d1 1
a1 1
/*	$OpenBSD$	*/
d4 1
a4 1
 * Copyright (c) 1988, Julian Onions <Julian.Onions@@nexor.co.uk>
a5 1
 * All rights reserved.
d7 2
a8 8
 * Redistribution and use in source and binary forms, with or without
 * modification, are permitted provided that the following conditions
 * are met:
 * 1. Redistributions of source code must retain the above copyright
 *    notice, this list of conditions and the following disclaimer.
 * 2. Redistributions in binary form must reproduce the above copyright
 *    notice, this list of conditions and the following disclaimer in the
 *    documentation and/or other materials provided with the distribution.
a9 13
 * THIS SOFTWARE IS PROVIDED BY THE AUTHOR ``AS IS'' AND ANY EXPRESS OR
 * IMPLIED WARRANTIES, INCLUDING, BUT NOT LIMITED TO, THE IMPLIED WARRANTIES
 * OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE ARE DISCLAIMED.
 * IN NO EVENT SHALL THE AUTHOR BE LIABLE FOR ANY DIRECT, INDIRECT,
 * INCIDENTAL, SPECIAL, EXEMPLARY, OR CONSEQUENTIAL DAMAGES (INCLUDING, BUT
 * NOT LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES; LOSS OF USE,
 * DATA, OR PROFITS; OR BUSINESS INTERRUPTION) HOWEVER CAUSED AND ON ANY
 * THEORY OF LIABILITY, WHETHER IN CONTRACT, STRICT LIABILITY, OR TORT
 * (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE USE OF
 * THIS SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.
 */

/*
d15 2
d43 4
a58 5

/* ioctl's for get/set debug */
#define	TUNSDEBUG	_IOW('t', 94, int)
#define	TUNGDEBUG	_IOR('t', 95, int)

@


1.7
log
@convert DLT_LOOP header to network-order u_int32_t
@
text
@d1 1
a1 1
/*	$OpenBSD: if_tun.h,v 1.6 1997/08/02 09:56:28 deraadt Exp $	*/
d39 3
@


1.6
log
@pass address family as host-byte-order u_int32_t. this fixes bpf.  add a
note to the bottom of tun.4 to indicate that this is a binary
incompatibility with older versions, and describe all 3 revisions this
has gone through. everyone -- recompile your code that uses tun.
@
text
@d1 1
a1 1
/*	$OpenBSD: if_tun.h,v 1.5 1997/07/29 05:03:48 deraadt Exp $	*/
a35 4

struct tunnel_header {
	u_int32_t	tun_af;		/* adress family */
};
@


1.5
log
@indent
@
text
@d1 1
a1 1
/*	$OpenBSD: if_tun.h,v 1.4 1996/05/16 11:52:09 mickey Exp $	*/
d38 1
a38 1
	u_char	tun_af;		/* adress family */
@


1.4
log
@drom NetBSD PR#2411:
add bcast support, do if_flags setable, minor cleanup.
@
text
@d1 1
a1 1
/*	$OpenBSD: if_tun.h,v 1.3 1996/04/21 22:28:36 deraadt Exp $	*/
d37 1
a37 2
struct tunnel_header
{
d49 1
a49 2
struct tuninfo
{
@


1.3
log
@partial sync with netbsd 960418, more to come
@
text
@d1 1
a1 1
/*	$OpenBSD: if_tun.h,v 1.5 1994/06/29 06:36:27 cgd Exp $	*/
d22 2
a23 2
struct tun_softc {
	u_short	tun_flags;		/* misc flags */
d32 2
a36 9
	struct	ifnet tun_if;		/* the interface */
	int	tun_pgrp;		/* the process group - if any */
	struct	selinfo	tun_rsel;	/* read select */
	struct	selinfo	tun_wsel;	/* write select (not used) */
#if NBPFILTER > 0
	caddr_t		tun_bpf;
#endif
};

d54 1
@


1.2
log
@bug fixes, speedups. multiple AFs support.
bpf fixes.
@
text
@@


1.1
log
@Initial revision
@
text
@d1 1
a1 1
/*	$NetBSD: if_tun.h,v 1.5 1994/06/29 06:36:27 cgd Exp $	*/
d16 1
a16 1
 * : $Header: if_tnreg.h,v 1.1.2.1 1992/07/16 22:39:16 friedl Exp
d44 5
d50 1
a50 1
#define	TUNMTU		1500
d53 12
a64 2
#define	TUNSDEBUG	_IOW('t', 90, int)
#define	TUNGDEBUG	_IOR('t', 89, int)
@


1.1.1.1
log
@initial import of NetBSD tree
@
text
@@
