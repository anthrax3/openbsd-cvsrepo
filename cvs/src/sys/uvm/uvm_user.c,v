head	1.14;
access;
symbols
	OPENBSD_6_0:1.14.0.8
	OPENBSD_6_0_BASE:1.14
	OPENBSD_5_9:1.14.0.4
	OPENBSD_5_9_BASE:1.14
	OPENBSD_5_8:1.14.0.6
	OPENBSD_5_8_BASE:1.14
	OPENBSD_5_7:1.14.0.2
	OPENBSD_5_7_BASE:1.14
	OPENBSD_5_6:1.13.0.4
	OPENBSD_5_6_BASE:1.13
	OPENBSD_5_5:1.11.0.30
	OPENBSD_5_5_BASE:1.11
	OPENBSD_5_4:1.11.0.26
	OPENBSD_5_4_BASE:1.11
	OPENBSD_5_3:1.11.0.24
	OPENBSD_5_3_BASE:1.11
	OPENBSD_5_2:1.11.0.22
	OPENBSD_5_2_BASE:1.11
	OPENBSD_5_1_BASE:1.11
	OPENBSD_5_1:1.11.0.20
	OPENBSD_5_0:1.11.0.18
	OPENBSD_5_0_BASE:1.11
	OPENBSD_4_9:1.11.0.16
	OPENBSD_4_9_BASE:1.11
	OPENBSD_4_8:1.11.0.14
	OPENBSD_4_8_BASE:1.11
	OPENBSD_4_7:1.11.0.10
	OPENBSD_4_7_BASE:1.11
	OPENBSD_4_6:1.11.0.12
	OPENBSD_4_6_BASE:1.11
	OPENBSD_4_5:1.11.0.8
	OPENBSD_4_5_BASE:1.11
	OPENBSD_4_4:1.11.0.6
	OPENBSD_4_4_BASE:1.11
	OPENBSD_4_3:1.11.0.4
	OPENBSD_4_3_BASE:1.11
	OPENBSD_4_2:1.11.0.2
	OPENBSD_4_2_BASE:1.11
	OPENBSD_4_1:1.10.0.18
	OPENBSD_4_1_BASE:1.10
	OPENBSD_4_0:1.10.0.16
	OPENBSD_4_0_BASE:1.10
	OPENBSD_3_9:1.10.0.14
	OPENBSD_3_9_BASE:1.10
	OPENBSD_3_8:1.10.0.12
	OPENBSD_3_8_BASE:1.10
	OPENBSD_3_7:1.10.0.10
	OPENBSD_3_7_BASE:1.10
	OPENBSD_3_6:1.10.0.8
	OPENBSD_3_6_BASE:1.10
	SMP_SYNC_A:1.10
	SMP_SYNC_B:1.10
	OPENBSD_3_5:1.10.0.6
	OPENBSD_3_5_BASE:1.10
	OPENBSD_3_4:1.10.0.4
	OPENBSD_3_4_BASE:1.10
	UBC_SYNC_A:1.10
	OPENBSD_3_3:1.10.0.2
	OPENBSD_3_3_BASE:1.10
	OPENBSD_3_2:1.9.0.4
	OPENBSD_3_2_BASE:1.9
	OPENBSD_3_1:1.9.0.2
	OPENBSD_3_1_BASE:1.9
	UBC_SYNC_B:1.9
	UBC:1.8.0.2
	UBC_BASE:1.8
	OPENBSD_3_0:1.5.0.4
	OPENBSD_3_0_BASE:1.5
	OPENBSD_2_9_BASE:1.5
	OPENBSD_2_9:1.5.0.2
	OPENBSD_2_8:1.4.0.4
	OPENBSD_2_8_BASE:1.4
	OPENBSD_2_7:1.4.0.2
	OPENBSD_2_7_BASE:1.4
	SMP:1.3.0.4
	SMP_BASE:1.3
	kame_19991208:1.3
	OPENBSD_2_6:1.3.0.2
	OPENBSD_2_6_BASE:1.3
	OPENBSD_2_5:1.2.0.2
	OPENBSD_2_5_BASE:1.2;
locks; strict;
comment	@ * @;


1.14
date	2014.09.14.14.17.27;	author jsg;	state Exp;
branches;
next	1.13;
commitid	uzzBR7hz9ncd4O6G;

1.13
date	2014.07.11.16.35.40;	author jsg;	state Exp;
branches;
next	1.12;
commitid	7NtJNW9udCOFtDNM;

1.12
date	2014.04.13.23.14.15;	author tedu;	state Exp;
branches;
next	1.11;

1.11
date	2007.04.27.17.01.54;	author art;	state Exp;
branches;
next	1.10;

1.10
date	2002.10.29.18.30.21;	author art;	state Exp;
branches;
next	1.9;

1.9
date	2001.12.19.08.58.07;	author art;	state Exp;
branches;
next	1.8;

1.8
date	2001.11.28.19.28.15;	author art;	state Exp;
branches
	1.8.2.1;
next	1.7;

1.7
date	2001.11.28.13.47.40;	author art;	state Exp;
branches;
next	1.6;

1.6
date	2001.11.06.01.35.04;	author art;	state Exp;
branches;
next	1.5;

1.5
date	2001.01.29.02.07.50;	author niklas;	state Exp;
branches;
next	1.4;

1.4
date	2000.03.15.15.50.21;	author art;	state Exp;
branches;
next	1.3;

1.3
date	99.08.23.08.13.25;	author art;	state Exp;
branches
	1.3.4.1;
next	1.2;

1.2
date	99.02.26.05.32.08;	author art;	state Exp;
branches;
next	1.1;

1.1
date	99.02.26.01.30.18;	author art;	state Exp;
branches;
next	;

1.3.4.1
date	2000.03.24.09.09.52;	author niklas;	state Exp;
branches;
next	1.3.4.2;

1.3.4.2
date	2001.05.14.22.47.49;	author niklas;	state Exp;
branches;
next	1.3.4.3;

1.3.4.3
date	2001.11.13.23.02.31;	author niklas;	state Exp;
branches;
next	1.3.4.4;

1.3.4.4
date	2001.12.05.01.23.58;	author niklas;	state Exp;
branches;
next	1.3.4.5;

1.3.4.5
date	2002.03.06.02.17.14;	author niklas;	state Exp;
branches;
next	1.3.4.6;

1.3.4.6
date	2003.03.28.00.08.48;	author niklas;	state Exp;
branches;
next	;

1.8.2.1
date	2002.02.02.03.28.27;	author art;	state Exp;
branches;
next	;


desc
@@


1.14
log
@remove uneeded proc.h includes
ok mpi@@ kspillner@@
@
text
@/*	$OpenBSD: uvm_user.c,v 1.13 2014/07/11 16:35:40 jsg Exp $	*/
/*	$NetBSD: uvm_user.c,v 1.8 2000/06/27 17:29:37 mrg Exp $	*/

/*
 * Copyright (c) 1997 Charles D. Cranor and Washington University.
 * All rights reserved.
 *
 * Redistribution and use in source and binary forms, with or without
 * modification, are permitted provided that the following conditions
 * are met:
 * 1. Redistributions of source code must retain the above copyright
 *    notice, this list of conditions and the following disclaimer.
 * 2. Redistributions in binary form must reproduce the above copyright
 *    notice, this list of conditions and the following disclaimer in the
 *    documentation and/or other materials provided with the distribution.
 *
 * THIS SOFTWARE IS PROVIDED BY THE AUTHOR ``AS IS'' AND ANY EXPRESS OR
 * IMPLIED WARRANTIES, INCLUDING, BUT NOT LIMITED TO, THE IMPLIED WARRANTIES
 * OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE ARE DISCLAIMED.
 * IN NO EVENT SHALL THE AUTHOR BE LIABLE FOR ANY DIRECT, INDIRECT,
 * INCIDENTAL, SPECIAL, EXEMPLARY, OR CONSEQUENTIAL DAMAGES (INCLUDING, BUT
 * NOT LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES; LOSS OF USE,
 * DATA, OR PROFITS; OR BUSINESS INTERRUPTION) HOWEVER CAUSED AND ON ANY
 * THEORY OF LIABILITY, WHETHER IN CONTRACT, STRICT LIABILITY, OR TORT
 * (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE USE OF
 * THIS SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.
 *
 * from: Id: uvm_user.c,v 1.1.2.1 1997/08/14 19:10:41 chuck Exp
 */

/*
 * uvm_user.c: high level uvm_allocate/uvm_deallocate interface into vm.
 */


#include <sys/param.h>
#include <sys/systm.h>

#include <uvm/uvm.h>

/*
 * uvm_deallocate: deallocate memory (unmap)
 */
void
uvm_deallocate(struct vm_map *map, vaddr_t start, vsize_t size)
{

	if (map == NULL)
		panic("uvm_deallocate with null map");

	if (size == 0)
		return;

	uvm_unmap(map, trunc_page(start), round_page(start+size));
}
@


1.13
log
@Chuck Cranor rescinded clauses in his license
on the 2nd of February 2011 in NetBSD.

http://marc.info/?l=netbsd-source-changes&m=129658899212732&w=2
http://marc.info/?l=netbsd-source-changes&m=129659095515558&w=2
http://marc.info/?l=netbsd-source-changes&m=129659157916514&w=2
http://marc.info/?l=netbsd-source-changes&m=129665962324372&w=2
http://marc.info/?l=netbsd-source-changes&m=129666033625342&w=2
http://marc.info/?l=netbsd-source-changes&m=129666052825545&w=2
http://marc.info/?l=netbsd-source-changes&m=129666922906480&w=2
http://marc.info/?l=netbsd-source-changes&m=129667725518082&w=2
@
text
@d1 1
a1 1
/*	$OpenBSD: uvm_user.c,v 1.12 2014/04/13 23:14:15 tedu Exp $	*/
a37 1
#include <sys/proc.h>
@


1.12
log
@compress code by turning four line comments into one line comments.
emphatic ok usual suspects, grudging ok miod
@
text
@d1 1
a1 1
/*	$OpenBSD: uvm_user.c,v 1.11 2007/04/27 17:01:54 art Exp $	*/
a4 1
 *
a15 6
 * 3. All advertising materials mentioning features or use of this software
 *    must display the following acknowledgement:
 *      This product includes software developed by Charles D. Cranor and
 *      Washington University.
 * 4. The name of the author may not be used to endorse or promote products
 *    derived from this software without specific prior written permission.
@


1.11
log
@Another indentation cleanup without binary changes.
(I'm reading code, that's where this comes from).
@
text
@d1 1
a1 1
/*	$OpenBSD: uvm_user.c,v 1.10 2002/10/29 18:30:21 art Exp $	*/
a51 1

@


1.10
log
@Since memory deallocation can't fail, remove the error return from
uvm_unmap, uvm_deallocate and a few other functions.
Simplifies some code and reduces diff to the UBC branch.
@
text
@d1 1
a1 1
/*	$OpenBSD: uvm_user.c,v 1.9 2001/12/19 08:58:07 art Exp $	*/
d54 1
a54 4
uvm_deallocate(map, start, size)
	vm_map_t map;
	vaddr_t start;
	vsize_t size;
@


1.9
log
@UBC was a disaster. It worked very good when it worked, but on some
machines or some configurations or in some phase of the moon (we actually
don't know when or why) files disappeared. Since we've not been able to
track down the problem in two weeks intense debugging and we need -current
to be stable, back out everything to a state it had before UBC.

We apologise for the inconvenience.
@
text
@d1 1
a1 1
/*	$OpenBSD: uvm_user.c,v 1.6 2001/11/06 01:35:04 art Exp $	*/
d53 1
a53 1
int
d63 2
a64 4
	if (size == (vaddr_t) 0)
		return (KERN_SUCCESS);

	return(uvm_unmap(map, trunc_page(start), round_page(start+size)));
d66 1
@


1.8
log
@Sync in more uvm from NetBSD. Mostly just cosmetic stuff.
Contains also support for page coloring.
@
text
@d1 2
a2 2
/*	$OpenBSD: uvm_user.c,v 1.7 2001/11/28 13:47:40 art Exp $	*/
/*	$NetBSD: uvm_user.c,v 1.10 2001/06/02 18:09:27 chs Exp $	*/
d53 1
a53 1
void
d55 1
a55 1
	struct vm_map *map;
d60 7
a66 2
	if (size == 0)
		return;
a67 1
	uvm_unmap(map, trunc_page(start), round_page(start + size));
@


1.8.2.1
log
@Merge in UBC performance changes from NetBSD.
Fix a bunch of merge errors from yesterday.
@
text
@d1 2
a2 2
/*	$OpenBSD: uvm_user.c,v 1.8 2001/11/28 19:28:15 art Exp $	*/
/*	$NetBSD: uvm_user.c,v 1.11 2001/11/10 07:37:01 lukem Exp $	*/
@


1.7
log
@Sync in more uvm changes from NetBSD.
This time we're getting rid of KERN_* and VM_PAGER_* error codes and
use errnos instead.
@
text
@d1 2
a2 2
/*	$OpenBSD: uvm_user.c,v 1.6 2001/11/06 01:35:04 art Exp $	*/
/*	$NetBSD: uvm_user.c,v 1.9 2001/03/15 06:10:58 chs Exp $	*/
d55 1
a55 1
	vm_map_t map;
@


1.6
log
@Move the last content from vm/ to uvm/
The only thing left in vm/ are just dumb wrappers.
vm/vm.h includes uvm/uvm_extern.h
vm/pmap.h includes uvm/uvm_pmap.h
vm/vm_page.h includes uvm/uvm_page.h
@
text
@d1 2
a2 2
/*	$OpenBSD: uvm_user.c,v 1.5 2001/01/29 02:07:50 niklas Exp $	*/
/*	$NetBSD: uvm_user.c,v 1.8 2000/06/27 17:29:37 mrg Exp $	*/
d53 1
a53 1
int
d60 2
a61 7
	if (map == NULL)
		panic("uvm_deallocate with null map");

	if (size == (vaddr_t) 0)
		return (KERN_SUCCESS);

	return(uvm_unmap(map, trunc_page(start), round_page(start+size)));
d63 1
@


1.5
log
@$OpenBSD$
@
text
@d1 2
a2 2
/*	$OpenBSD: uvm_user.c,v 1.7 1999/03/25 18:48:56 mrg Exp $	*/
/*	$NetBSD: uvm_user.c,v 1.7 1999/03/25 18:48:56 mrg Exp $	*/
a46 1
#include <vm/vm.h>
@


1.4
log
@Fix the NetBSD id strings.
@
text
@d1 1
@


1.3
log
@sync with NetBSD from 1999.05.24 (there is a reason for this date)
 Mostly cleanups, but also a few improvements to pagedaemon for better
 handling of low memory and/or low swap conditions.
@
text
@d1 1
a1 1
/*	$NetBSD: uvm_user.c,v 1.6 1998/10/11 23:18:21 chuck Exp $	*/
@


1.3.4.1
log
@Sync with -current
@
text
@d1 1
a1 1
/*	$NetBSD: uvm_user.c,v 1.7 1999/03/25 18:48:56 mrg Exp $	*/
@


1.3.4.2
log
@merge in approximately 2.9 into SMP branch
@
text
@a0 1
/*	$OpenBSD: uvm_user.c,v 1.5 2001/01/29 02:07:50 niklas Exp $	*/
@


1.3.4.3
log
@merge in -current
@
text
@d1 2
a2 2
/*	$OpenBSD$	*/
/*	$NetBSD: uvm_user.c,v 1.8 2000/06/27 17:29:37 mrg Exp $	*/
d47 1
@


1.3.4.4
log
@Merge in -current
@
text
@d2 1
a2 1
/*	$NetBSD: uvm_user.c,v 1.10 2001/06/02 18:09:27 chs Exp $	*/
d53 1
a53 1
void
d55 1
a55 1
	struct vm_map *map;
d60 7
a66 2
	if (size == 0)
		return;
a67 1
	uvm_unmap(map, trunc_page(start), round_page(start + size));
@


1.3.4.5
log
@Merge in trunk
@
text
@d2 1
a2 1
/*	$NetBSD: uvm_user.c,v 1.8 2000/06/27 17:29:37 mrg Exp $	*/
d53 1
a53 1
int
d55 1
a55 1
	vm_map_t map;
d60 2
a61 7
	if (map == NULL)
		panic("uvm_deallocate with null map");

	if (size == (vaddr_t) 0)
		return (KERN_SUCCESS);

	return(uvm_unmap(map, trunc_page(start), round_page(start+size)));
d63 1
@


1.3.4.6
log
@Sync the SMP branch with 3.3
@
text
@d53 1
a53 1
void
d63 4
a66 2
	if (size == 0)
		return;
a67 1
	uvm_unmap(map, trunc_page(start), round_page(start+size));
@


1.2
log
@add OpenBSD tags
@
text
@a0 1
/*	$OpenBSD$	*/
a2 4
/*
 * XXXCDC: "ROUGH DRAFT" QUALITY UVM PRE-RELEASE FILE!   
 *	   >>>USE AT YOUR OWN RISK, WORK IS NOT FINISHED<<<
 */
@


1.1
log
@Import of uvm from NetBSD. Some local changes, some code disabled
@
text
@d1 1
@

