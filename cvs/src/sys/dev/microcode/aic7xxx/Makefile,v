head	1.12;
access;
symbols
	OPENBSD_6_2:1.12.0.4
	OPENBSD_6_2_BASE:1.12
	OPENBSD_6_1:1.11.0.42
	OPENBSD_6_1_BASE:1.11
	OPENBSD_6_0:1.11.0.38
	OPENBSD_6_0_BASE:1.11
	OPENBSD_5_9:1.11.0.28
	OPENBSD_5_9_BASE:1.11
	OPENBSD_5_8:1.11.0.36
	OPENBSD_5_8_BASE:1.11
	OPENBSD_5_7:1.11.0.34
	OPENBSD_5_7_BASE:1.11
	OPENBSD_5_6:1.11.0.32
	OPENBSD_5_6_BASE:1.11
	OPENBSD_5_5:1.11.0.30
	OPENBSD_5_5_BASE:1.11
	OPENBSD_5_4:1.11.0.26
	OPENBSD_5_4_BASE:1.11
	OPENBSD_5_3:1.11.0.24
	OPENBSD_5_3_BASE:1.11
	OPENBSD_5_2:1.11.0.22
	OPENBSD_5_2_BASE:1.11
	OPENBSD_5_1_BASE:1.11
	OPENBSD_5_1:1.11.0.20
	OPENBSD_5_0:1.11.0.18
	OPENBSD_5_0_BASE:1.11
	OPENBSD_4_9:1.11.0.16
	OPENBSD_4_9_BASE:1.11
	OPENBSD_4_8:1.11.0.14
	OPENBSD_4_8_BASE:1.11
	OPENBSD_4_7:1.11.0.10
	OPENBSD_4_7_BASE:1.11
	OPENBSD_4_6:1.11.0.12
	OPENBSD_4_6_BASE:1.11
	OPENBSD_4_5:1.11.0.8
	OPENBSD_4_5_BASE:1.11
	OPENBSD_4_4:1.11.0.6
	OPENBSD_4_4_BASE:1.11
	OPENBSD_4_3:1.11.0.4
	OPENBSD_4_3_BASE:1.11
	OPENBSD_4_2:1.11.0.2
	OPENBSD_4_2_BASE:1.11
	OPENBSD_4_1:1.9.0.10
	OPENBSD_4_1_BASE:1.9
	OPENBSD_4_0:1.9.0.8
	OPENBSD_4_0_BASE:1.9
	OPENBSD_3_9:1.9.0.6
	OPENBSD_3_9_BASE:1.9
	OPENBSD_3_8:1.9.0.4
	OPENBSD_3_8_BASE:1.9
	OPENBSD_3_7:1.9.0.2
	OPENBSD_3_7_BASE:1.9
	OPENBSD_3_6:1.8.0.2
	OPENBSD_3_6_BASE:1.8
	SMP_SYNC_A:1.8
	SMP_SYNC_B:1.8
	OPENBSD_3_5:1.7.0.2
	OPENBSD_3_5_BASE:1.7
	OPENBSD_3_4:1.5.0.6
	OPENBSD_3_4_BASE:1.5
	UBC_SYNC_A:1.5
	OPENBSD_3_3:1.5.0.4
	OPENBSD_3_3_BASE:1.5
	OPENBSD_3_2:1.5.0.2
	OPENBSD_3_2_BASE:1.5
	OPENBSD_3_1:1.3.0.2
	OPENBSD_3_1_BASE:1.3
	UBC_SYNC_B:1.5
	UBC:1.1.0.12
	UBC_BASE:1.1
	OPENBSD_3_0:1.1.0.10
	OPENBSD_3_0_BASE:1.1
	OPENBSD_2_9_BASE:1.1
	OPENBSD_2_9:1.1.0.8
	OPENBSD_2_8:1.1.0.6
	OPENBSD_2_8_BASE:1.1
	OPENBSD_2_7:1.1.0.4
	OPENBSD_2_7_BASE:1.1
	SMP:1.1.0.2;
locks; strict;
comment	@# @;


1.12
date	2017.07.19.12.50.32;	author espie;	state Exp;
branches;
next	1.11;
commitid	JSAFUy3u4ukEoD6z;

1.11
date	2007.07.08.00.17.21;	author krw;	state Exp;
branches;
next	1.10;

1.10
date	2007.04.05.23.41.20;	author drahn;	state Exp;
branches;
next	1.9;

1.9
date	2004.09.18.19.51.53;	author mickey;	state Exp;
branches;
next	1.8;

1.8
date	2004.05.19.00.35.18;	author krw;	state Exp;
branches;
next	1.7;

1.7
date	2003.12.24.23.27.55;	author krw;	state Exp;
branches;
next	1.6;

1.6
date	2003.12.24.22.40.16;	author krw;	state Exp;
branches;
next	1.5;

1.5
date	2002.06.30.18.25.58;	author smurph;	state Exp;
branches;
next	1.4;

1.4
date	2002.06.28.00.34.54;	author smurph;	state Exp;
branches;
next	1.3;

1.3
date	2002.03.19.02.49.20;	author millert;	state Exp;
branches;
next	1.2;

1.2
date	2002.02.16.04.36.33;	author smurph;	state Exp;
branches;
next	1.1;

1.1
date	2000.03.22.02.50.49;	author smurph;	state Exp;
branches
	1.1.2.1
	1.1.12.1;
next	;

1.1.2.1
date	2000.03.24.09.09.13;	author niklas;	state Exp;
branches;
next	1.1.2.2;

1.1.2.2
date	2002.03.06.02.11.44;	author niklas;	state Exp;
branches;
next	1.1.2.3;

1.1.2.3
date	2002.03.28.12.29.45;	author niklas;	state Exp;
branches;
next	1.1.2.4;

1.1.2.4
date	2003.03.28.00.38.16;	author niklas;	state Exp;
branches;
next	1.1.2.5;

1.1.2.5
date	2004.02.19.10.56.23;	author niklas;	state Exp;
branches;
next	1.1.2.6;

1.1.2.6
date	2004.06.05.23.12.46;	author niklas;	state Exp;
branches;
next	;

1.1.12.1
date	2002.06.11.03.42.22;	author art;	state Exp;
branches;
next	1.1.12.2;

1.1.12.2
date	2002.10.29.00.33.26;	author art;	state Exp;
branches;
next	;


desc
@@


1.12
log
@more depends gc / yacc rules overhaul

okay millert@@
@
text
@# $OpenBSD: Makefile,v 1.11 2007/07/08 00:17:21 krw Exp $
# $FreeBSD: src/sys/dev/aic7xxx/Makefile,v 1.6 1999/08/28 00:41:22 peter Exp $

PROG=	aicasm

CSRCS=	aicasm.c aicasm_symbol.c
GENSRCS= aicasm_gram.c aicasm_scan.c aicasm_macro_gram.c aicasm_macro_scan.c

GENHDRS=	aicasm_gram.h aicasm_macro_gram.h

SRCS=	${GENSRCS} ${CSRCS}
CLEANFILES+= ${GENSRCS} ${GENHDRS} y.output
DPADD+=	${LIBL}
LDADD+=	-ll
CC=${HOSTCC}

# Correct path for kernel builds
# Don't rely on the kernel's .depend file
.ifdef MAKESRCPATH
.PATH: ${MAKESRCPATH}
DEPENDFILE=
.endif

CFLAGS+= -I. -I${.CURDIR}
YFLAGS= -d
LFLAGS+= ${.TARGET:M*macro*:S/$(.TARGET)/-olex.yy.c/} ${.TARGET:M*macro*:S/$(.TARGET)/-Pmm/}
NOMAN=	noman

.ifdef DEBUG
CFLAGS+= -DDEBUG -g
YFLAGS+= -t
LFLAGS+= -d
SEQFLAGS= -l seq.lst
.endif

microcode:	7xxx_headers 79xx_headers

aicasm_gram.c aicasm_gram.h: aicasm_gram.y
	${YACC} ${YFLAGS} -o aicasm_gram.c $<

aicasm_macro_gram.c aicasm_macro_gram.h: aicasm_macro_gram.y
	${YACC} -pmm ${YFLAGS} -o aicams_macro_gram.c $<

7xxx_headers:	aicasm aic7xxx.seq aic7xxx.reg
	${OBJDIR}./aicasm -I/sys ${SEQFLAGS} -r tempreg.h -o tempseq.h ${.CURDIR}/aic7xxx.seq
	grep OpenBSD: ${.CURDIR}/aic7xxx.seq | cat - tempseq.h > aic7xxx_seq.h
	grep OpenBSD: ${.CURDIR}/aic7xxx.reg | cat - tempreg.h > aic7xxx_reg.h
	mv aic7xxx_seq.h /sys/dev/microcode/aic7xxx/
	mv aic7xxx_reg.h /sys/dev/microcode/aic7xxx/
.ifdef DEBUG
	mv seq.lst /sys/dev/microcode/aic7xxx/seq7xxx.lst
.endif
	rm -f tempseq.h tempreg.h

79xx_headers:	aicasm aic79xx.seq aic79xx.reg
	${OBJDIR}./aicasm -I/sys ${SEQFLAGS} -r tempreg.h -o tempseq.h ${.CURDIR}/aic79xx.seq
	grep OpenBSD: ${.CURDIR}/aic79xx.seq | cat - tempseq.h > aic79xx_seq.h
	grep OpenBSD: ${.CURDIR}/aic79xx.reg | cat - tempreg.h > aic79xx_reg.h
	mv aic79xx_seq.h /sys/dev/microcode/aic7xxx/
	mv aic79xx_reg.h /sys/dev/microcode/aic7xxx/
.ifdef DEBUG
	mv seq.lst /sys/dev/microcode/aic7xxx/seq79xx.lst
.endif
	rm -f tempseq.h tempreg.h

.include <bsd.prog.mk>
@


1.11
log
@As pointed out by Mickey, "-I/usr/includes" is not required for
successful compilation of assembler or generating microcode.
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.10 2007/04/05 23:41:20 drahn Exp $
d39 1
a39 3
	${YACC} ${YFLAGS} $<
	@@mv y.tab.c aicasm_gram.c
	@@mv y.tab.h aicasm_gram.h
d42 1
a42 3
	${YACC} -pmm ${YFLAGS} $<
	@@mv y.tab.c aicasm_macro_gram.c
	@@mv y.tab.h aicasm_macro_gram.h
@


1.10
log
@Allow usb microcode to be built in a cross environment.  System endian has been
factored out of the result binaries already. Still need to address non usb.
ok deraadt.
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.9 2004/09/18 19:51:53 mickey Exp $
d24 1
a24 1
CFLAGS+= -I/usr/include -I. -I${.CURDIR}
@


1.9
log
@repair build that reused y.tab.h for two different parsers
thus failing a build every other time.
make generated arrays const and repair rcsid generation for output.
allow one-step build; from krw@@
krw@@ ok
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.8 2004/05/19 00:35:18 krw Exp $
d15 1
@


1.8
log
@Add missing aic79xx_reg.h file. Update aic79xx* files to latest
FreeBSD versions in preparation for ahd. Update Makefile to generate
aic79xx* files.

ok marco@@, tested by Milos Urbanek.
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.7 2003/12/24 23:27:55 krw Exp $
d9 1
a9 1
GENHDRS=	y.tab.h
d23 2
a24 2
CFLAGS+= -I/usr/include -I.
YFLAGS= ${.TARGET:M*macro*:S/$(.TARGET)/-p mm/} -d
d37 11
a47 1
7xxx_headers:	aic7xxx.seq aic7xxx.reg
d58 1
a58 1
79xx_headers:	aic79xx.seq aic79xx.reg
@


1.7
log
@Sync ahc with NetBSD, which was in turn updated from FreeBSD by Pascal
Renauld of Network Storage Solutions, Inc. Many fixes, wider device
support. In particular, the notorious 'Target 0' problem seems to be
fixed.

Does *not* include any updates to isa or eisa code beyond what was
necessary to compile.

Known issues:

1) Tagged Queuing is probably not optimal.

2) PPR negotiation may not be fully functional.

3) No support yet for freezing devices or channels.

4) The mechanism for preventing 'A' and 'B' channel confusion during probe
can fail if scsibus > 254 found.

5) Requeuing I/O's not working. A workaround will be committed almost
immediately. At the moment timeouts, SCSI message rejects, aborting
SCB's and trying to freeze a device may cause incomplete i/o's to be
reported as complete.

6) Verbosity and probe messages need work.

7) Last disk on bus seems to go through an extra re-negotiation.

8) >16 devices on an adapter will trigger the usual problems of total
openings exceeding available SCB's under heavy load.

Tested by deraadt@@, beck@@, miod@@, naddy@@, drahn@@, marc@@ amoung
others.

ok deraadt@@.
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.5 2002/06/30 18:25:58 smurph Exp $
d35 3
a37 1
microcode aic7xxx_reg.h aic7xxx_seq.h: aic7xxx.seq aic7xxx.reg
d42 12
d55 1
a55 1
	mv seq.lst /sys/dev/microcode/aic7xxx/
a56 1
	mv aic7xxx_reg.h /sys/dev/microcode/aic7xxx/
@


1.6
log
@Sync ahc with NetBSD, which was in turn updated from FreeBSD by Pascal
Renauld of Network Storage Solutions, Inc. Many fixes, wider device
support. In particular, the notorious 'Target 0' problem seems to be
fixed.

Does *not* include any updates to isa or eisa code beyond what was
necessary to compile.

Known issues:

1) Tagged Queuing is probably not optimal.

2) PPR negotiation may not be fully functional.

3) No support yet for freezing devices or channels.

4) The mechanism for preventing 'A' and 'B' channel confusion during probe
can fail if scsibus > 254 found.

5) Requeuing I/O's not working. A workaround will be committed almost
immediately. At the moment timeouts, SCSI message rejects, aborting
SCB's and trying to freeze a device may cause incomplete i/o's to be
reported as complete.

6) Verbosity and probe messages need work.

7) Last disk on bus seems to go through an extra re-negotiation.

8) >16 devices on an adapter will trigger the usual problems of total
openings exceeding available SCB's under heavy load.

Tested by deraadt@@, beck@@, miod@@, naddy@@, drahn@@, marc@@ amoung
others.

ok deraadt@@.
@
text
@@


1.5
log
@New aicasm synced with FreeBSD.
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.4 2002/06/28 00:34:54 smurph Exp $
d12 1
a12 1
CLEANFILES+= ${GENSRCS} ${GENHDRS} y.output aic7xxxreg.h
d35 1
a35 1
microcode aic7xxxreg.h aic7xxx_seq.h: aic7xxx.seq aic7xxx.reg
d38 1
a38 1
	grep OpenBSD: ${.CURDIR}/aic7xxx.reg | cat - tempreg.h > aic7xxxreg.h
d43 1
a43 1
	cp aic7xxxreg.h /sys/dev/ic/
@


1.4
log
@Return of new ahc
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.3 2002/03/19 02:49:20 millert Exp $
d7 1
a7 1
GENSRCS= aicasm_gram.c aicasm_scan.c
d12 1
a12 1
CLEANFILES+= ${GENSRCS} ${GENHDRS} y.output
d24 2
@


1.3
log
@revert to older ahc driver until the new one's bugs are fixed
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.1 2000/03/22 02:50:49 smurph Exp $
d30 1
a30 1
MFLAGS= -l seq.lst
d34 1
a34 1
	./aicasm -I/sys ${MFLAGS} -r tempreg.h -o tempseq.h ${.CURDIR}/aic7xxx.seq
@


1.2
log
@New port of FreeBSD's ahc driver
@
text
@d30 1
a30 1
SEQFLAGS= -l seq.lst
d34 1
a34 1
	${OBJDIR}./aicasm -I/sys ${SEQFLAGS} -r tempreg.h -o tempseq.h ${.CURDIR}/aic7xxx.seq
@


1.1
log
@new ahc driver.  Adds support for newer Adaptec controllers.  This represents two months of work.
@
text
@d1 1
a1 1
# $OpenBSD$
d30 1
a30 1
MFLAGS= -l seq.lst
d34 1
a34 1
	./aicasm -I/sys ${MFLAGS} -r tempreg.h -o tempseq.h ${.CURDIR}/aic7xxx.seq
@


1.1.12.1
log
@Sync UBC branch to -current
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.1 2000/03/22 02:50:49 smurph Exp $
@


1.1.12.2
log
@sync to -current
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.1.12.1 2002/06/11 03:42:22 art Exp $
d7 1
a7 1
GENSRCS= aicasm_gram.c aicasm_scan.c aicasm_macro_gram.c aicasm_macro_scan.c
d12 1
a12 1
CLEANFILES+= ${GENSRCS} ${GENHDRS} y.output aic7xxxreg.h
a23 2
YFLAGS= ${.TARGET:M*macro*:S/$(.TARGET)/-p mm/} -d
LFLAGS+= ${.TARGET:M*macro*:S/$(.TARGET)/-olex.yy.c/} ${.TARGET:M*macro*:S/$(.TARGET)/-Pmm/}
d30 1
a30 1
SEQFLAGS= -l seq.lst
d34 1
a34 1
	${OBJDIR}./aicasm -I/sys ${SEQFLAGS} -r tempreg.h -o tempseq.h ${.CURDIR}/aic7xxx.seq
@


1.1.2.1
log
@Sync with -current
@
text
@@


1.1.2.2
log
@Merge in trunk
@
text
@d30 1
a30 1
SEQFLAGS= -l seq.lst
d34 1
a34 1
	${OBJDIR}./aicasm -I/sys ${SEQFLAGS} -r tempreg.h -o tempseq.h ${.CURDIR}/aic7xxx.seq
@


1.1.2.3
log
@Merge in -current from about a week ago
@
text
@d30 1
a30 1
MFLAGS= -l seq.lst
d34 1
a34 1
	./aicasm -I/sys ${MFLAGS} -r tempreg.h -o tempseq.h ${.CURDIR}/aic7xxx.seq
@


1.1.2.4
log
@Sync the SMP branch with 3.3
@
text
@d7 1
a7 1
GENSRCS= aicasm_gram.c aicasm_scan.c aicasm_macro_gram.c aicasm_macro_scan.c
d12 1
a12 1
CLEANFILES+= ${GENSRCS} ${GENHDRS} y.output aic7xxxreg.h
a23 2
YFLAGS= ${.TARGET:M*macro*:S/$(.TARGET)/-p mm/} -d
LFLAGS+= ${.TARGET:M*macro*:S/$(.TARGET)/-olex.yy.c/} ${.TARGET:M*macro*:S/$(.TARGET)/-Pmm/}
d30 1
a30 1
SEQFLAGS= -l seq.lst
d34 1
a34 1
	${OBJDIR}./aicasm -I/sys ${SEQFLAGS} -r tempreg.h -o tempseq.h ${.CURDIR}/aic7xxx.seq
@


1.1.2.5
log
@Merge of current from two weeks agointo the SMP branch
@
text
@d12 1
a12 1
CLEANFILES+= ${GENSRCS} ${GENHDRS} y.output
d35 1
a35 1
microcode aic7xxx_reg.h aic7xxx_seq.h: aic7xxx.seq aic7xxx.reg
d38 1
a38 1
	grep OpenBSD: ${.CURDIR}/aic7xxx.reg | cat - tempreg.h > aic7xxx_reg.h
d43 1
a43 1
	mv aic7xxx_reg.h /sys/dev/microcode/aic7xxx/
@


1.1.2.6
log
@Merge with the trunk
@
text
@d35 1
a35 3
microcode:	7xxx_headers 79xx_headers

7xxx_headers:	aic7xxx.seq aic7xxx.reg
a39 1
	mv aic7xxx_reg.h /sys/dev/microcode/aic7xxx/
d41 1
a41 12
	mv seq.lst /sys/dev/microcode/aic7xxx/seq7xxx.lst
.endif
	rm -f tempseq.h tempreg.h

79xx_headers:	aic79xx.seq aic79xx.reg
	${OBJDIR}./aicasm -I/sys ${SEQFLAGS} -r tempreg.h -o tempseq.h ${.CURDIR}/aic79xx.seq
	grep OpenBSD: ${.CURDIR}/aic79xx.seq | cat - tempseq.h > aic79xx_seq.h
	grep OpenBSD: ${.CURDIR}/aic79xx.reg | cat - tempreg.h > aic79xx_reg.h
	mv aic79xx_seq.h /sys/dev/microcode/aic7xxx/
	mv aic79xx_reg.h /sys/dev/microcode/aic7xxx/
.ifdef DEBUG
	mv seq.lst /sys/dev/microcode/aic7xxx/seq79xx.lst
d43 1
@


