head	1.15;
access;
symbols
	OPENBSD_6_2:1.15.0.42
	OPENBSD_6_2_BASE:1.15
	OPENBSD_6_1:1.15.0.40
	OPENBSD_6_1_BASE:1.15
	OPENBSD_6_0:1.15.0.36
	OPENBSD_6_0_BASE:1.15
	OPENBSD_5_9:1.15.0.26
	OPENBSD_5_9_BASE:1.15
	OPENBSD_5_8:1.15.0.34
	OPENBSD_5_8_BASE:1.15
	OPENBSD_5_7:1.15.0.32
	OPENBSD_5_7_BASE:1.15
	OPENBSD_5_6:1.15.0.30
	OPENBSD_5_6_BASE:1.15
	OPENBSD_5_5:1.15.0.28
	OPENBSD_5_5_BASE:1.15
	OPENBSD_5_4:1.15.0.24
	OPENBSD_5_4_BASE:1.15
	OPENBSD_5_3:1.15.0.22
	OPENBSD_5_3_BASE:1.15
	OPENBSD_5_2:1.15.0.20
	OPENBSD_5_2_BASE:1.15
	OPENBSD_5_1_BASE:1.15
	OPENBSD_5_1:1.15.0.18
	OPENBSD_5_0:1.15.0.16
	OPENBSD_5_0_BASE:1.15
	OPENBSD_4_9:1.15.0.14
	OPENBSD_4_9_BASE:1.15
	OPENBSD_4_8:1.15.0.12
	OPENBSD_4_8_BASE:1.15
	OPENBSD_4_7:1.15.0.8
	OPENBSD_4_7_BASE:1.15
	OPENBSD_4_6:1.15.0.10
	OPENBSD_4_6_BASE:1.15
	OPENBSD_4_5:1.15.0.6
	OPENBSD_4_5_BASE:1.15
	OPENBSD_4_4:1.15.0.4
	OPENBSD_4_4_BASE:1.15
	OPENBSD_4_3:1.15.0.2
	OPENBSD_4_3_BASE:1.15
	OPENBSD_4_2:1.14.0.2
	OPENBSD_4_2_BASE:1.14;
locks; strict;
comment	@ * @;


1.15
date	2007.10.08.22.08.12;	author mglocker;	state Exp;
branches;
next	1.14;

1.14
date	2007.08.09.14.50.06;	author mglocker;	state Exp;
branches;
next	1.13;

1.13
date	2007.08.09.09.40.01;	author mglocker;	state Exp;
branches;
next	1.12;

1.12
date	2007.08.09.08.53.22;	author mglocker;	state Exp;
branches;
next	1.11;

1.11
date	2007.08.05.10.05.57;	author mglocker;	state Exp;
branches;
next	1.10;

1.10
date	2007.06.30.12.08.57;	author mglocker;	state Exp;
branches;
next	1.9;

1.9
date	2007.06.17.20.00.30;	author mglocker;	state Exp;
branches;
next	1.8;

1.8
date	2007.06.17.10.18.28;	author mglocker;	state Exp;
branches;
next	1.7;

1.7
date	2007.06.16.19.45.24;	author mglocker;	state Exp;
branches;
next	1.6;

1.6
date	2007.06.08.22.08.21;	author mglocker;	state Exp;
branches;
next	1.5;

1.5
date	2007.06.01.23.43.32;	author mglocker;	state Exp;
branches;
next	1.4;

1.4
date	2007.05.28.13.51.09;	author mglocker;	state Exp;
branches;
next	1.3;

1.3
date	2007.05.26.11.11.54;	author mglocker;	state Exp;
branches;
next	1.2;

1.2
date	2007.05.25.21.32.02;	author mglocker;	state Exp;
branches;
next	1.1;

1.1
date	2007.05.25.05.33.51;	author mglocker;	state Exp;
branches;
next	;


desc
@@


1.15
log
@Make pcmcia malo(4) work with trunk(4) by:
Setting interface ethernet address from link level address.
Adding firmware command to set ethernet address.
@
text
@/*	$OpenBSD: if_maloreg.h,v 1.14 2007/08/09 14:50:06 mglocker Exp $ */

/*
 * Copyright (c) 2007 Marcus Glocker <mglocker@@openbsd.org>
 *
 * Permission to use, copy, modify, and distribute this software for any
 * purpose with or without fee is hereby granted, provided that the above
 * copyright notice and this permission notice appear in all copies.
 *
 * THE SOFTWARE IS PROVIDED "AS IS" AND THE AUTHOR DISCLAIMS ALL WARRANTIES
 * WITH REGARD TO THIS SOFTWARE INCLUDING ALL IMPLIED WARRANTIES OF
 * MERCHANTABILITY AND FITNESS. IN NO EVENT SHALL THE AUTHOR BE LIABLE FOR
 * ANY SPECIAL, DIRECT, INDIRECT, OR CONSEQUENTIAL DAMAGES OR ANY DAMAGES
 * WHATSOEVER RESULTING FROM LOSS OF USE, DATA OR PROFITS, WHETHER IN AN
 * ACTION OF CONTRACT, NEGLIGENCE OR OTHER TORTIOUS ACTION, ARISING OUT OF
 * OR IN CONNECTION WITH THE USE OR PERFORMANCE OF THIS SOFTWARE.
 */

/* registers */
#define MALO_REG_HOST_STATUS		0x00
#define MALO_REG_CARD_INTR_CAUSE	0x02
#define MALO_REG_HOST_INTR_MASK		0x04
#define MALO_REG_DATA_READ		0x10
#define MALO_REG_CMD_READ		0x12
#define MALO_REG_DATA_WRITE_LEN		0x14
#define MALO_REG_DATA_WRITE		0x16
#define MALO_REG_CMD_WRITE_LEN		0x18
#define MALO_REG_CMD_WRITE		0x1a
#define MALO_REG_CARD_STATUS		0x20
#define MALO_REG_HOST_INTR_CAUSE	0x22
#define MALO_REG_DATA_READ_LEN		0x24
#define MALO_REG_RBAL			0x28
#define MALO_REG_CMD_READ_LEN		0x30
#define MALO_REG_SCRATCH		0x3f
#define MALO_REG_CARD_INTR_MASK		0x44

/* register values */
#define MALO_VAL_SCRATCH_READY		0x00
#define MALO_VAL_TX_DL_OVER		0x01
#define MALO_VAL_RX_DL_OVER		0x02
#define MALO_VAL_CMD_DL_OVER		0x04
#define MALO_VAL_SCRATCH_FW_LOADED	0x5a
#define MALO_VAL_HOST_INTR_MASK_ON	0x001f
#define MALO_VAL_CARD_STATUS_MASK	0x7f00

/* interrupt reasons */
#define MALO_VAL_HOST_INTR_TX		(1 << 0)
#define MALO_VAL_HOST_INTR_RX		(1 << 1)
#define MALO_VAL_HOST_INTR_CMD		(1 << 3)
#define MALO_VAL_HOST_INTR_EVENT	(1 << 4)

/* FW commands */
#define MALO_CMD_RESP			0x8000
#define MALO_CMD_HWSPEC			0x0003
#define MALO_CMD_RESET			0x0005
#define MALO_CMD_SCAN			0x0006
#define MALO_CMD_AUTH			0x0011
#define MALO_CMD_WEP			0x0013
#define MALO_CMD_SNMP			0x0016
#define MALO_CMD_RADIO			0x001c
#define MALO_CMD_CHANNEL		0x001d
#define MALO_CMD_TXPOWER		0x001e
#define MALO_CMD_ANTENNA		0x0020
#define MALO_CMD_MACCTRL		0x0028
#define MALO_CMD_MACADDR		0x004d
#define MALO_CMD_ASSOC			0x0050
#define MALO_CMD_80211D			0x005b
#define MALO_CMD_BGSCAN_CONFIG		0x006b
#define MALO_CMD_BGSCAN_QUERY		0x006c
#define MALO_CMD_RATE			0x0076

/* FW command values */
#define MALO_CMD_RADIO_OFF		0x0000
#define MALO_CMD_RADIO_ON		0x0001
#define MALO_CMD_RADIO_LONG_P		0x0000
#define MALO_CMD_RADIO_SHORT_P		0x0002
#define MALO_CMD_RADIO_AUTO_P		0x0004
#define MALO_CMD_MACCTRL_RX_ON		0x0001
#define MALO_CMD_MACCTRL_TX_ON		0x0002
#define MALO_CMD_MACCTRL_PROMISC_ON	0x0080

/* events */
#define MALO_EVENT_DEAUTH		0x0008
#define MALO_EVENT_DISASSOC		0x0009
@


1.14
log
@o Add a mechanism to execute single commands even if are are not context
  save.  Protects cmalo_cmd_set_assoc() for now.
o In case of deauthentication or disassociation, try to reassociate.
@
text
@d1 1
a1 1
/*	$OpenBSD: if_maloreg.h,v 1.13 2007/08/09 09:40:01 mglocker Exp $ */
d65 1
@


1.13
log
@Comment.  Sort some register values.
@
text
@d1 1
a1 1
/*	$OpenBSD: if_maloreg.h,v 1.12 2007/08/09 08:53:22 mglocker Exp $ */
d82 2
a83 1
#define MALO_EVENT_DISSASOC		0x0009
@


1.12
log
@Add event handler.  Events notify us about things like when a
disassociation frame has arrived.

Nice side effect;  As we acknowledge the event reason after receiving
a disassociation frame (which happens pretty often by wi(4) hostap) now,
the FW issues an automatic reassociation, and we do not loose network
connectivity anymore.
@
text
@d1 1
a1 1
/*	$OpenBSD: if_maloreg.h,v 1.11 2007/08/05 10:05:57 mglocker Exp $ */
a38 2
#define MALO_VAL_SCRATCH_FW_LOADED	0x5a
#define MALO_VAL_HOST_INTR_MASK_ON	0x001f
d42 2
@


1.11
log
@Add WEP support, which is done fully by the FW.
@
text
@d1 1
a1 1
/*	$OpenBSD: if_maloreg.h,v 1.10 2007/06/30 12:08:57 mglocker Exp $ */
d44 1
d50 1
d80 3
@


1.10
log
@Add 802.11d (domain info) command.
@
text
@d1 1
a1 1
/*	$OpenBSD: if_maloreg.h,v 1.9 2007/06/17 20:00:30 mglocker Exp $ */
d56 1
@


1.9
log
@Add background SCAN command.
@
text
@d1 1
a1 1
/*	$OpenBSD: if_maloreg.h,v 1.8 2007/06/17 10:18:28 mglocker Exp $ */
d63 1
@


1.8
log
@Add first shoot of SCAN command.
@
text
@d1 1
a1 1
/*	$OpenBSD: if_maloreg.h,v 1.7 2007/06/16 19:45:24 mglocker Exp $ */
d63 2
@


1.7
log
@Add three new firmware commands to set authentication, set rate adaption,
and tune several 802.11 parameters.
@
text
@d1 1
a1 1
/*	$OpenBSD: if_maloreg.h,v 1.6 2007/06/08 22:08:21 mglocker Exp $ */
d54 1
@


1.6
log
@Add TX path which enables some first (unreliable yet) packet transfers.
@
text
@d1 1
a1 1
/*	$OpenBSD: if_maloreg.h,v 1.5 2007/06/01 23:43:32 mglocker Exp $ */
d54 2
d62 1
@


1.5
log
@Add RX path and enable monitor mode.
@
text
@d1 1
a1 1
/*	$OpenBSD: if_maloreg.h,v 1.4 2007/05/28 13:51:09 mglocker Exp $ */
d25 2
d41 2
a42 1
#define MALO_VAL_DATA_DL_OVER		0x02
d46 1
a53 1
#define MALO_CMD_STATUS			0x000a
d59 1
a59 1
#define MALO_CMD_MACADDR		0x004d
@


1.4
log
@Add a bunch of new firmware commands to configure MAC/PHY/RF, and do so.
Simplify command interface.
@
text
@d1 1
a1 1
/*	$OpenBSD: if_maloreg.h,v 1.3 2007/05/26 11:11:54 mglocker Exp $ */
d19 1
a19 1
/* I/O registers */
d23 1
d29 1
d35 1
a35 1
/* I/O register values */
d39 2
a40 1
#define MALO_VAL_DNLD_OVER		(1 << 2)
d43 1
a43 1
#define MALO_VAL_HOST_INTR_RX		(1 << 0)
d66 1
@


1.3
log
@Tune command interface.
@
text
@d1 1
a1 1
/*	$OpenBSD: if_maloreg.h,v 1.2 2007/05/25 21:32:02 mglocker Exp $ */
d33 1
a33 1
/* register values */
d44 19
a62 4
#define MALO_VAL_CMD_RESP		0x8000
#define MALO_VAL_CMD_HWSPEC		0x0003
#define MALO_VAL_CMD_RESET		0x0005
#define MALO_VAL_CMD_CHANNEL		0x001d
@


1.2
log
@Make FW commands save in the way that requests/responses must be done
serialized.  Establish initial device up/down dance.
@
text
@d1 1
a1 1
/*	$OpenBSD: if_maloreg.h,v 1.1 2007/05/25 05:33:51 mglocker Exp $ */
d40 1
d47 1
@


1.1
log
@Initial driver stub for the Marvell 88W8385 PCMCIA (CF) device.

Loads firmware, sends first FW command, establish interrupts.
@
text
@d1 1
a1 1
/*	$OpenBSD$ */
d45 1
@

