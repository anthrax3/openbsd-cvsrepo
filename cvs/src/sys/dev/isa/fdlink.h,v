head	1.9;
access;
symbols
	OPENBSD_6_2_BASE:1.9
	OPENBSD_6_1:1.9.0.42
	OPENBSD_6_1_BASE:1.9
	OPENBSD_6_0:1.9.0.38
	OPENBSD_6_0_BASE:1.9
	OPENBSD_5_9:1.9.0.28
	OPENBSD_5_9_BASE:1.9
	OPENBSD_5_8:1.9.0.36
	OPENBSD_5_8_BASE:1.9
	OPENBSD_5_7:1.9.0.34
	OPENBSD_5_7_BASE:1.9
	OPENBSD_5_6:1.9.0.32
	OPENBSD_5_6_BASE:1.9
	OPENBSD_5_5:1.9.0.30
	OPENBSD_5_5_BASE:1.9
	OPENBSD_5_4:1.9.0.26
	OPENBSD_5_4_BASE:1.9
	OPENBSD_5_3:1.9.0.24
	OPENBSD_5_3_BASE:1.9
	OPENBSD_5_2:1.9.0.22
	OPENBSD_5_2_BASE:1.9
	OPENBSD_5_1_BASE:1.9
	OPENBSD_5_1:1.9.0.20
	OPENBSD_5_0:1.9.0.18
	OPENBSD_5_0_BASE:1.9
	OPENBSD_4_9:1.9.0.16
	OPENBSD_4_9_BASE:1.9
	OPENBSD_4_8:1.9.0.14
	OPENBSD_4_8_BASE:1.9
	OPENBSD_4_7:1.9.0.10
	OPENBSD_4_7_BASE:1.9
	OPENBSD_4_6:1.9.0.12
	OPENBSD_4_6_BASE:1.9
	OPENBSD_4_5:1.9.0.8
	OPENBSD_4_5_BASE:1.9
	OPENBSD_4_4:1.9.0.6
	OPENBSD_4_4_BASE:1.9
	OPENBSD_4_3:1.9.0.4
	OPENBSD_4_3_BASE:1.9
	OPENBSD_4_2:1.9.0.2
	OPENBSD_4_2_BASE:1.9
	OPENBSD_4_1:1.8.0.16
	OPENBSD_4_1_BASE:1.8
	OPENBSD_4_0:1.8.0.14
	OPENBSD_4_0_BASE:1.8
	OPENBSD_3_9:1.8.0.12
	OPENBSD_3_9_BASE:1.8
	OPENBSD_3_8:1.8.0.10
	OPENBSD_3_8_BASE:1.8
	OPENBSD_3_7:1.8.0.8
	OPENBSD_3_7_BASE:1.8
	OPENBSD_3_6:1.8.0.6
	OPENBSD_3_6_BASE:1.8
	SMP_SYNC_A:1.8
	SMP_SYNC_B:1.8
	OPENBSD_3_5:1.8.0.4
	OPENBSD_3_5_BASE:1.8
	OPENBSD_3_4:1.8.0.2
	OPENBSD_3_4_BASE:1.8
	UBC_SYNC_A:1.7
	OPENBSD_3_3:1.7.0.4
	OPENBSD_3_3_BASE:1.7
	OPENBSD_3_2:1.7.0.2
	OPENBSD_3_2_BASE:1.7
	OPENBSD_3_1:1.6.0.2
	OPENBSD_3_1_BASE:1.6
	UBC_SYNC_B:1.7
	UBC:1.5.0.6
	UBC_BASE:1.5
	OPENBSD_3_0:1.5.0.4
	OPENBSD_3_0_BASE:1.5
	OPENBSD_2_9_BASE:1.5
	OPENBSD_2_9:1.5.0.2
	OPENBSD_2_8:1.4.0.12
	OPENBSD_2_8_BASE:1.4
	OPENBSD_2_7:1.4.0.10
	OPENBSD_2_7_BASE:1.4
	SMP:1.4.0.8
	SMP_BASE:1.4
	kame_19991208:1.4
	OPENBSD_2_6:1.4.0.6
	OPENBSD_2_6_BASE:1.4
	OPENBSD_2_5:1.4.0.4
	OPENBSD_2_5_BASE:1.4
	OPENBSD_2_4:1.4.0.2
	OPENBSD_2_4_BASE:1.4
	OPENBSD_2_3:1.3.0.6
	OPENBSD_2_3_BASE:1.3
	OPENBSD_2_2:1.3.0.4
	OPENBSD_2_2_BASE:1.3
	OPENBSD_2_1:1.3.0.2
	OPENBSD_2_1_BASE:1.3;
locks; strict;
comment	@ * @;


1.9
date	2007.04.10.17.47.55;	author miod;	state Exp;
branches;
next	1.8;

1.8
date	2003.06.02.23.28.02;	author millert;	state Exp;
branches;
next	1.7;

1.7
date	2002.09.08.01.09.07;	author deraadt;	state Exp;
branches;
next	1.6;

1.6
date	2002.03.14.01.26.56;	author millert;	state Exp;
branches;
next	1.5;

1.5
date	2001.03.06.13.55.02;	author ho;	state Exp;
branches
	1.5.6.1;
next	1.4;

1.4
date	98.08.08.23.01.16;	author downsj;	state Exp;
branches
	1.4.8.1;
next	1.3;

1.3
date	96.11.29.22.54.56;	author niklas;	state Exp;
branches;
next	1.2;

1.2
date	96.10.28.00.06.22;	author downsj;	state Exp;
branches;
next	1.1;

1.1
date	96.09.01.20.58.27;	author downsj;	state Exp;
branches;
next	;

1.4.8.1
date	2001.05.14.22.24.33;	author niklas;	state Exp;
branches;
next	1.4.8.2;

1.4.8.2
date	2002.03.28.12.11.35;	author niklas;	state Exp;
branches;
next	1.4.8.3;

1.4.8.3
date	2003.03.28.00.38.15;	author niklas;	state Exp;
branches;
next	1.4.8.4;

1.4.8.4
date	2003.06.07.11.02.29;	author ho;	state Exp;
branches;
next	;

1.5.6.1
date	2002.06.11.03.42.21;	author art;	state Exp;
branches;
next	1.5.6.2;

1.5.6.2
date	2002.10.29.00.33.26;	author art;	state Exp;
branches;
next	;


desc
@@


1.9
log
@``it's'' -> ``its'' when the grammar gods require this change.
@
text
@/*	$OpenBSD: fdlink.h,v 1.8 2003/06/02 23:28:02 millert Exp $	*/

/*-
 * Copyright (c) 1993, 1994, 1995 Charles Hannum.
 * Copyright (c) 1990 The Regents of the University of California.
 * All rights reserved.
 *
 * This code is derived from software contributed to Berkeley by
 * Don Ahn.
 *
 * Portions Copyright (c) 1993, 1994 by
 *  jc@@irbs.UUCP (John Capo)
 *  vak@@zebub.msk.su (Serge Vakulenko)
 *  ache@@astral.msk.su (Andrew A. Chernov)
 *  joerg_wunsch@@uriah.sax.de (Joerg Wunsch)
 *
 * Redistribution and use in source and binary forms, with or without
 * modification, are permitted provided that the following conditions
 * are met:
 * 1. Redistributions of source code must retain the above copyright
 *    notice, this list of conditions and the following disclaimer.
 * 2. Redistributions in binary form must reproduce the above copyright
 *    notice, this list of conditions and the following disclaimer in the
 *    documentation and/or other materials provided with the distribution.
 * 3. Neither the name of the University nor the names of its contributors
 *    may be used to endorse or promote products derived from this software
 *    without specific prior written permission.
 *
 * THIS SOFTWARE IS PROVIDED BY THE REGENTS AND CONTRIBUTORS ``AS IS'' AND
 * ANY EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT LIMITED TO, THE
 * IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE
 * ARE DISCLAIMED.  IN NO EVENT SHALL THE REGENTS OR CONTRIBUTORS BE LIABLE
 * FOR ANY DIRECT, INDIRECT, INCIDENTAL, SPECIAL, EXEMPLARY, OR CONSEQUENTIAL
 * DAMAGES (INCLUDING, BUT NOT LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS
 * OR SERVICES; LOSS OF USE, DATA, OR PROFITS; OR BUSINESS INTERRUPTION)
 * HOWEVER CAUSED AND ON ANY THEORY OF LIABILITY, WHETHER IN CONTRACT, STRICT
 * LIABILITY, OR TORT (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY
 * OUT OF THE USE OF THIS SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF
 * SUCH DAMAGE.
 *
 */

/*
 * The goo that binds the floppy controller to its devices.
 */

enum fdc_state {
	DEVIDLE = 0,
	MOTORWAIT,
	DOSEEK,
	SEEKWAIT,
	SEEKTIMEDOUT,
	SEEKCOMPLETE,
	DOIO,
	IOCOMPLETE,
	IOTIMEDOUT,
	DORESET,
	RESETCOMPLETE,
	RESETTIMEDOUT,
	DORECAL,
	RECALWAIT,
	RECALTIMEDOUT,
	RECALCOMPLETE
};

enum fdc_type {
	FDC_TYPE_TAPE,
	FDC_TYPE_DISK
};


/* software state, per controller */
struct fd_softc;
struct fdc_fdlink {
	struct fd_softc *sc_fd[4];	/* pointers to children */
	TAILQ_HEAD(drivehead, fd_softc) sc_drives;
};

struct ft_softc;
struct fdc_ftlink {
	struct ft_softc *sc_ft[4];	/* pointers to children */
};

struct fdc_softc {
	struct device sc_dev;		/* boilerplate */
	struct isadev sc_id;
	void *sc_ih;

	bus_space_tag_t sc_iot;		/* ISA chipset identifier */
	bus_space_handle_t sc_ioh;	/* ISA io handle */
	bus_space_handle_t sc_ioh_ctl;	/* ISA io handle */

	int sc_drq;

	enum fdc_type sc_type[4];	/* type of device */
	union {
		struct fdc_fdlink fdlink;
		struct fdc_ftlink ftlink;
	} sc_link;
	enum fdc_state sc_state;
	int sc_errors;			/* number of retries so far */
	struct timeout fdcpseudointr_to;
	u_char sc_status[7];		/* copy of registers */
};

/*
 * Arguments passed between fdcattach and f[dt]probe.
 */
struct fdc_attach_args {
	int fa_drive;
	int fa_flags;
	int fa_type;			/* tape drive type */
	struct fd_type *fa_deftype;
};

/* Functions from fdc.c. */
int fdcresult(struct fdc_softc *);
int out_fdc(bus_space_tag_t, bus_space_handle_t, u_char);
void fdcstart(struct fdc_softc *);
void fdcstatus(struct device *, int, char *);
void fdcpseudointr(void *);

/* Functions from fd.c. */
struct fd_type *fd_nvtotype(char *, int, int);
@


1.8
log
@Remove the advertising clause in the UCB license which Berkeley
rescinded 22 July 1999.  Proofed by myself and Theo.
@
text
@d1 1
a1 1
/*	$OpenBSD: fdlink.h,v 1.7 2002/09/08 01:09:07 deraadt Exp $	*/
d44 1
a44 1
 * The goo that binds the floppy controller to it's devices.
@


1.7
log
@no , after last element in a enum
@
text
@d1 1
a1 1
/*	$OpenBSD: fdlink.h,v 1.6 2002/03/14 01:26:56 millert Exp $	*/
d25 1
a25 5
 * 3. All advertising materials mentioning features or use of this software
 *    must display the following acknowledgement:
 *	This product includes software developed by the University of
 *	California, Berkeley and its contributors.
 * 4. Neither the name of the University nor the names of its contributors
@


1.6
log
@First round of __P removal in sys
@
text
@d1 1
a1 1
/*	$OpenBSD: fdlink.h,v 1.5 2001/03/06 13:55:02 ho Exp $	*/
d67 1
a67 1
	RECALCOMPLETE,
@


1.5
log
@Convert to new timeout API. mickey@@ ok.
@
text
@d1 1
a1 1
/*	$OpenBSD: fdlink.h,v 1.4 1998/08/08 23:01:16 downsj Exp $	*/
d121 5
a125 5
int fdcresult __P((struct fdc_softc *));
int out_fdc __P((bus_space_tag_t, bus_space_handle_t, u_char));
void fdcstart __P((struct fdc_softc *));
void fdcstatus __P((struct device *, int, char *));
void fdcpseudointr __P((void *));
d128 1
a128 1
struct fd_type *fd_nvtotype __P((char *, int, int));
@


1.5.6.1
log
@Sync UBC branch to -current
@
text
@d1 1
a1 1
/*	$OpenBSD: fdlink.h,v 1.5 2001/03/06 13:55:02 ho Exp $	*/
d121 5
a125 5
int fdcresult(struct fdc_softc *);
int out_fdc(bus_space_tag_t, bus_space_handle_t, u_char);
void fdcstart(struct fdc_softc *);
void fdcstatus(struct device *, int, char *);
void fdcpseudointr(void *);
d128 1
a128 1
struct fd_type *fd_nvtotype(char *, int, int);
@


1.5.6.2
log
@sync to -current
@
text
@d1 1
a1 1
/*	$OpenBSD: fdlink.h,v 1.5.6.1 2002/06/11 03:42:21 art Exp $	*/
d67 1
a67 1
	RECALCOMPLETE
@


1.4
log
@Split ioh allocations so that the devices no longer overlap.
Also disable the diag return check in wdc.c for now.
@
text
@d1 1
a1 1
/*	$OpenBSD: fdlink.h,v 1.3 1996/11/29 22:54:56 niklas Exp $	*/
d106 1
@


1.4.8.1
log
@merge in approximately 2.9 into SMP branch
@
text
@d1 1
a1 1
/*	$OpenBSD: fdlink.h,v 1.5 2001/03/06 13:55:02 ho Exp $	*/
a105 1
	struct timeout fdcpseudointr_to;
@


1.4.8.2
log
@Merge in -current from about a week ago
@
text
@d1 1
a1 1
/*	$OpenBSD$	*/
d121 5
a125 5
int fdcresult(struct fdc_softc *);
int out_fdc(bus_space_tag_t, bus_space_handle_t, u_char);
void fdcstart(struct fdc_softc *);
void fdcstatus(struct device *, int, char *);
void fdcpseudointr(void *);
d128 1
a128 1
struct fd_type *fd_nvtotype(char *, int, int);
@


1.4.8.3
log
@Sync the SMP branch with 3.3
@
text
@d67 1
a67 1
	RECALCOMPLETE
@


1.4.8.4
log
@Sync SMP branch to -current
@
text
@d1 1
a1 1
/*	$OpenBSD: fdlink.h,v 1.4.8.3 2003/03/28 00:38:15 niklas Exp $	*/
d25 5
a29 1
 * 3. Neither the name of the University nor the names of its contributors
@


1.3
log
@Missing pieces of new bus.h that CVS lost behind my back
@
text
@d1 1
a1 1
/*	$OpenBSD: fdlink.h,v 1.2 1996/10/28 00:06:22 downsj Exp $	*/
d95 1
@


1.2
log
@Merge in old/latest code.  Untested support for 2.88mb floppy drives.
@
text
@d1 1
a1 1
/*	$OpenBSD: fdlink.h,v 1.1 1996/09/01 20:58:27 downsj Exp $	*/
d93 2
a94 2
	bus_chipset_tag_t sc_bc;	/* ISA chipset identifier */
	bus_io_handle_t   sc_ioh;	/* ISA io handle */
d119 5
a123 5
int fdcresult __P((struct fdc_softc *fdc));
int out_fdc __P((bus_chipset_tag_t bc, bus_io_handle_t ioh, u_char x));
void fdcstart __P((struct fdc_softc *fdc));
void fdcstatus __P((struct device *dv, int n, char *s));
void fdcpseudointr __P((void *arg));
@


1.1
log
@initial commit of split fdc/fd drivers
@
text
@d1 1
a1 1
/*	$OpenBSD$	*/
d70 6
d77 11
d98 5
a102 2
	struct fd_softc *sc_fd[4];	/* pointers to children */
	TAILQ_HEAD(drivehead, fd_softc) sc_drives;
d114 1
@
