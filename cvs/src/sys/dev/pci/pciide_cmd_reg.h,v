head	1.11;
access;
symbols
	OPENBSD_6_1_BASE:1.11
	OPENBSD_6_0:1.11.0.28
	OPENBSD_6_0_BASE:1.11
	OPENBSD_5_9:1.11.0.16
	OPENBSD_5_9_BASE:1.11
	OPENBSD_5_8:1.11.0.24
	OPENBSD_5_8_BASE:1.11
	OPENBSD_5_7:1.11.0.22
	OPENBSD_5_7_BASE:1.11
	OPENBSD_5_6:1.11.0.20
	OPENBSD_5_6_BASE:1.11
	OPENBSD_5_5:1.11.0.18
	OPENBSD_5_5_BASE:1.11
	OPENBSD_5_4:1.11.0.14
	OPENBSD_5_4_BASE:1.11
	OPENBSD_5_3:1.11.0.12
	OPENBSD_5_3_BASE:1.11
	OPENBSD_5_2:1.11.0.10
	OPENBSD_5_2_BASE:1.11
	OPENBSD_5_1_BASE:1.11
	OPENBSD_5_1:1.11.0.8
	OPENBSD_5_0:1.11.0.6
	OPENBSD_5_0_BASE:1.11
	OPENBSD_4_9:1.11.0.4
	OPENBSD_4_9_BASE:1.11
	OPENBSD_4_8:1.11.0.2
	OPENBSD_4_8_BASE:1.11
	OPENBSD_4_7:1.10.0.4
	OPENBSD_4_7_BASE:1.10
	OPENBSD_4_6:1.10.0.6
	OPENBSD_4_6_BASE:1.10
	OPENBSD_4_5:1.10.0.2
	OPENBSD_4_5_BASE:1.10
	OPENBSD_4_4:1.9.0.16
	OPENBSD_4_4_BASE:1.9
	OPENBSD_4_3:1.9.0.14
	OPENBSD_4_3_BASE:1.9
	OPENBSD_4_2:1.9.0.12
	OPENBSD_4_2_BASE:1.9
	OPENBSD_4_1:1.9.0.10
	OPENBSD_4_1_BASE:1.9
	OPENBSD_4_0:1.9.0.8
	OPENBSD_4_0_BASE:1.9
	OPENBSD_3_9:1.9.0.6
	OPENBSD_3_9_BASE:1.9
	OPENBSD_3_8:1.9.0.4
	OPENBSD_3_8_BASE:1.9
	OPENBSD_3_7:1.9.0.2
	OPENBSD_3_7_BASE:1.9
	OPENBSD_3_6:1.8.0.4
	OPENBSD_3_6_BASE:1.8
	SMP_SYNC_A:1.8
	SMP_SYNC_B:1.8
	OPENBSD_3_5:1.8.0.2
	OPENBSD_3_5_BASE:1.8
	OPENBSD_3_4:1.7.0.2
	OPENBSD_3_4_BASE:1.7
	UBC_SYNC_A:1.6
	OPENBSD_3_3:1.6.0.2
	OPENBSD_3_3_BASE:1.6
	OPENBSD_3_2:1.5.0.10
	OPENBSD_3_2_BASE:1.5
	OPENBSD_3_1:1.5.0.8
	OPENBSD_3_1_BASE:1.5
	UBC_SYNC_B:1.5
	UBC:1.5.0.6
	UBC_BASE:1.5
	OPENBSD_3_0:1.5.0.4
	OPENBSD_3_0_BASE:1.5
	OPENBSD_2_9_BASE:1.5
	OPENBSD_2_9:1.5.0.2
	OPENBSD_2_8:1.3.0.2
	OPENBSD_2_8_BASE:1.3
	OPENBSD_2_7:1.2.0.6
	OPENBSD_2_7_BASE:1.2
	SMP:1.2.0.4
	SMP_BASE:1.2
	kame_19991208:1.2
	OPENBSD_2_6:1.2.0.2
	OPENBSD_2_6_BASE:1.2;
locks; strict;
comment	@ * @;


1.11
date	2010.07.23.07.47.13;	author jsg;	state Exp;
branches;
next	1.10;

1.10
date	2008.08.31.09.50.12;	author jsg;	state Exp;
branches;
next	1.9;

1.9
date	2004.09.24.07.38.38;	author grange;	state Exp;
branches;
next	1.8;

1.8
date	2003.09.28.21.01.43;	author grange;	state Exp;
branches;
next	1.7;

1.7
date	2003.07.05.08.42.45;	author grange;	state Exp;
branches;
next	1.6;

1.6
date	2003.02.21.20.10.33;	author grange;	state Exp;
branches;
next	1.5;

1.5
date	2001.04.04.07.02.54;	author csapuntz;	state Exp;
branches
	1.5.6.1;
next	1.4;

1.4
date	2001.03.25.13.11.55;	author csapuntz;	state Exp;
branches;
next	1.3;

1.3
date	2000.06.26.17.51.17;	author chris;	state Exp;
branches;
next	1.2;

1.2
date	99.10.04.22.54.18;	author deraadt;	state Exp;
branches
	1.2.4.1;
next	1.1;

1.1
date	99.07.18.21.25.19;	author csapuntz;	state Exp;
branches;
next	;

1.2.4.1
date	2001.05.14.22.25.55;	author niklas;	state Exp;
branches;
next	1.2.4.2;

1.2.4.2
date	2003.03.28.00.38.24;	author niklas;	state Exp;
branches;
next	1.2.4.3;

1.2.4.3
date	2004.02.19.10.56.29;	author niklas;	state Exp;
branches;
next	;

1.5.6.1
date	2003.05.19.22.18.02;	author tedu;	state Exp;
branches;
next	;


desc
@@


1.11
log
@Manuel Bouyer rescinded clauses 3 and 4 of his license text.
@
text
@/*	$OpenBSD: pciide_cmd_reg.h,v 1.10 2008/08/31 09:50:12 jsg Exp $	*/
/*	$NetBSD: pciide_cmd_reg.h,v 1.9 2000/08/02 20:23:46 bouyer Exp $	*/

/*
 * Copyright (c) 1998 Manuel Bouyer.
 *
 * Redistribution and use in source and binary forms, with or without
 * modification, are permitted provided that the following conditions
 * are met:
 * 1. Redistributions of source code must retain the above copyright
 *    notice, this list of conditions and the following disclaimer.
 * 2. Redistributions in binary form must reproduce the above copyright
 *    notice, this list of conditions and the following disclaimer in the
 *    documentation and/or other materials provided with the distribution.
 *
 * THIS SOFTWARE IS PROVIDED BY THE AUTHOR ``AS IS'' AND ANY EXPRESS OR
 * IMPLIED WARRANTIES, INCLUDING, BUT NOT LIMITED TO, THE IMPLIED WARRANTIES
 * OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE ARE DISCLAIMED.
 * IN NO EVENT SHALL THE AUTHOR BE LIABLE FOR ANY DIRECT, INDIRECT,
 * INCIDENTAL, SPECIAL, EXEMPLARY, OR CONSEQUENTIAL DAMAGES (INCLUDING, BUT
 * NOT LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES; LOSS OF USE,
 * DATA, OR PROFITS; OR BUSINESS INTERRUPTION) HOWEVER CAUSED AND ON ANY
 * THEORY OF LIABILITY, WHETHER IN CONTRACT, STRICT LIABILITY, OR TORT
 * (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE USE OF
 * THIS SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.
 *
 */

#ifndef _DEV_PCI_PCIIDE_CMD_REG_H_
#define _DEV_PCI_PCIIDE_CMD_REG_H_

/*
 * Registers definitions for CMD Technologies's PCI 064x IDE controllers.
 */

/* Interesting revision of the 0646 */
#define CMD0646U2_REV 0x05
#define CMD0646U_REV 0x03

/* Configuration (RO) */
#define CMD_CONF 0x50
#define CMD_CONF_REV_MASK	0x03 /* 0640/3/6 only */
#define CMD_CONF_DRV0_INTR	0x04
#define CMD_CONF_DEVID		0x18 /* 0640/3/6 only */
#define CMD_CONF_VESAPRT	0x20 /* 0640/3/6 only */
#define CMD_CONF_DSA1		0x40
#define CMD_CONF_DSA0		0x80 /* 0640/3/6 only */

/* Control register (RW) */
#define CMD_CTRL 0x51
#define CMD_CTRL_HR_FIFO		0x01 /* 0640/3/6 only */
#define CMD_CTRL_HW_FIFO		0x02 /* 0640/3/6 only */
#define CMD_CTRL_DEVSEL			0x04
#define CMD_CTRL_2PORT			0x08
#define CMD_CTRL_PAR			0x10 /* 0640/3/6 only */
#define CMD_CTRL_HW_HLD			0x20 /* 0640/3/6 only */
#define CMD_CTRL_DRV0_RAHEAD		0x40
#define CMD_CTRL_DRV1_RAHEAD		0x80

/*
 * data read/write timing registers . 0640 uses the same for drive 0 and 1
 * on the secondary channel
 */
#define CMD_DATA_TIM(chan, drive) \
	(((chan) == 0) ? \
		((drive) == 0) ? 0x54: 0x56 \
		: \
		((drive) == 0) ? 0x58 : 0x5b)

/* secondary channel status and addr timings */
#define CMD_ARTTIM23	0x57
#define CMD_ARTTIM23_IRQ	0x10
#define CMD_ARTTIM23_RHAEAD(d)	((0x4) << (d))

/* DMA master read mode select */
#define CMD_DMA_MODE 0x71
#define CMD_DMA_MASK		0x03
#define CMD_DMA			0x00
#define CMD_DMA_MULTIPLE	0x01
#define CMD_DMA_LINE		0x03
/* the followings bits are only for 0646U/646U2/648/649 */
#define CMD_DMA_IRQ(chan) 	(0x4 << (chan))
#define CMD_DMA_IRQ_DIS(chan) 	(0x10 << (chan))
#define CMD_DMA_RST		0x40

/* the followings are only for 0646U/646U2/648/649 */
/* busmaster control/status register */
#define CMD_BICSR	0x79
#define CMD_BICSR_80(chan)	(0x01 << (chan))
/* Ultra/DMA timings reg */
#define CMD_UDMATIM(channel)	(0x73 + (8 * (channel)))
#define CMD_UDMATIM_UDMA(drive)	(0x01 << (drive))
#define CMD_UDMATIM_UDMA33(drive) (0x04 << (drive))
#define CMD_UDMATIM_TIM_MASK	0x3
#define CMD_UDMATIM_TIM_OFF(drive) (4 + ((drive) * 2))
static int8_t cmd0646_9_tim_udma[] = {0x03, 0x02, 0x01, 0x02, 0x01, 0x00};

/*
 * timings values for the 0643/6/8/9
 * for all dma_mode we have to have
 * DMA_timings(dma_mode) >= PIO_timings(dma_mode + 2)
 */
static int8_t cmd0643_9_data_tim_pio[] = {0xA9, 0x57, 0x44, 0x32, 0x3F};
static int8_t cmd0643_9_data_tim_dma[] = {0x87, 0x32, 0x3F};

#endif	/* !_DEV_PCI_PCIIDE_CMD_REG_H_ */
@


1.10
log
@remove http links to dead/changed domains.
@
text
@d1 1
a1 1
/*	$OpenBSD: pciide_cmd_reg.h,v 1.9 2004/09/24 07:38:38 grange Exp $	*/
a14 6
 * 3. All advertising materials mentioning features or use of this software
 *    must display the following acknowledgement:
 *	This product includes software developed by Manuel Bouyer.
 * 4. Neither the name of the University nor the names of its contributors
 *    may be used to endorse or promote products derived from this software
 *    without specific prior written permission.
@


1.9
log
@Multiple inclusion protection.
@
text
@d1 1
a1 1
/*	$OpenBSD: pciide_cmd_reg.h,v 1.8 2003/09/28 21:01:43 grange Exp $	*/
a39 1
 * Available from http://www.cmd.com/
@


1.8
log
@kill trailing spaces, no functional changes
@
text
@d1 1
a1 1
/*	$OpenBSD: pciide_cmd_reg.h,v 1.7 2003/07/05 08:42:45 grange Exp $	*/
d35 3
d112 2
@


1.7
log
@Add missing timing value for CMD649 UDMA 5 mode.
Found by G Onufer <gonufer@@yahoo.com>.

ok gluk@@
@
text
@d1 1
a1 1
/*	$OpenBSD: pciide_cmd_reg.h,v 1.6 2003/02/21 20:10:33 grange Exp $	*/
d25 1
a25 1
 * IN NO EVENT SHALL THE AUTHOR BE LIABLE FOR ANY DIRECT, INDIRECT,     
@


1.6
log
@Fix Manuel Bouyer's copyright, from NetBSD
ok deraadt@@
@
text
@d1 1
a1 1
/*	$OpenBSD: pciide_cmd_reg.h,v 1.5 2001/04/04 07:02:54 csapuntz Exp $	*/
d100 1
a100 1
static int8_t cmd0646_9_tim_udma[] = {0x03, 0x02, 0x01, 0x02, 0x01};
@


1.5
log
@

Minor cleanup to minimize diffs with NetBSD
@
text
@d1 1
a1 1
/*	$OpenBSD: pciide_cmd_reg.h,v 1.4 2001/03/25 13:11:55 csapuntz Exp $	*/
d17 1
a17 2
 *	This product includes software developed by the University of
 *	California, Berkeley and its contributors.
@


1.5.6.1
log
@sync
@
text
@d1 1
a1 1
/*	$OpenBSD$	*/
d17 2
a18 1
 *	This product includes software developed by Manuel Bouyer.
@


1.4
log
@Minor mods to DMA interface - get rid of unnecessary args. Allow DMA functions to return status flags.

Note: Changing code to have DMA interface indicate when I/O is done (a la NetBSD) was considered. It was rejected due to questionable backward compatability
with ISA DMA and MAC obio DMA

Added irqack from NetBSD (though this feature should really be in the
PCI interrupt handlers)

Use pool
@
text
@d1 2
a2 2
/*	$OpenBSD: pciide_cmd_reg.h,v 1.3 2000/06/26 17:51:17 chris Exp $	*/
/*	$NetBSD: pciide_cmd_reg.h,v 1.7 2000/06/26 10:07:52 bouyer Exp $	*/
d82 1
d85 5
a89 1
#define CMD_DMA_LINE		0x10
d91 1
a91 1
/* the followings are only for 0648/9 */
d101 1
a101 1
static int8_t cmd0648_9_tim_udma[] = {0x03, 0x02, 0x01, 0x02, 0x01};
@


1.3
log
@from NetBSD
support CMD 648/649 UDMA66 controllers
fix promise UDMA66 cable check
@
text
@d1 1
a1 1
/*	$OpenBSD$	*/
d40 4
@


1.2
log
@promise support; chris@@ took it from netbsd
@
text
@d1 2
a2 2
/*	$OpenBSD: pciide_cmd_reg.h,v 1.1 1999/07/18 21:25:19 csapuntz Exp $	*/
/*	$NetBSD: pciide_cmd_reg.h,v 1.4 1998/12/02 10:52:25 bouyer Exp $	*/
d23 10
a32 11
 * THIS SOFTWARE IS PROVIDED BY THE REGENTS AND CONTRIBUTORS ``AS IS'' AND
 * ANY EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT LIMITED TO, THE
 * IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE
 * ARE DISCLAIMED.  IN NO EVENT SHALL THE REGENTS OR CONTRIBUTORS BE LIABLE
 * FOR ANY DIRECT, INDIRECT, INCIDENTAL, SPECIAL, EXEMPLARY, OR CONSEQUENTIAL
 * DAMAGES (INCLUDING, BUT NOT LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS
 * OR SERVICES; LOSS OF USE, DATA, OR PROFITS; OR BUSINESS INTERRUPTION)
 * HOWEVER CAUSED AND ON ANY THEORY OF LIABILITY, WHETHER IN CONTRACT, STRICT
 * LIABILITY, OR TORT (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY
 * OUT OF THE USE OF THIS SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF
 * SUCH DAMAGE.
d43 1
a43 1
#define CMD_CONF_REV_MASK	0x03
d45 2
a46 2
#define CMD_CONF_DEVID		0x18
#define CMD_CONF_VESAPRT	0x20
d48 1
a48 1
#define CMD_CONF_DSA0		0x80
d52 2
a53 2
#define CMD_CTRL_HR_FIFO		0x01
#define CMD_CTRL_HW_FIFO		0x02
d56 2
a57 2
#define CMD_CTRL_PAR			0x10
#define CMD_CTRL_HW_HLD			0x20
d72 1
a72 1
#define CMD_ARTTIM23		0x57
d81 12
a92 1
		
d95 1
a95 1
 * timings values for the 0643 and 0x646
d99 2
a100 2
static int8_t cmd0643_6_data_tim_pio[] = {0xA9, 0x57, 0x44, 0x32, 0x3F};
static int8_t cmd0643_6_data_tim_dma[] = {0x87, 0x32, 0x3F};
@


1.2.4.1
log
@merge in approximately 2.9 into SMP branch
@
text
@d1 2
a2 2
/*	$OpenBSD: pciide_cmd_reg.h,v 1.5 2001/04/04 07:02:54 csapuntz Exp $	*/
/*	$NetBSD: pciide_cmd_reg.h,v 1.9 2000/08/02 20:23:46 bouyer Exp $	*/
d23 11
a33 10
 * THIS SOFTWARE IS PROVIDED BY THE AUTHOR ``AS IS'' AND ANY EXPRESS OR
 * IMPLIED WARRANTIES, INCLUDING, BUT NOT LIMITED TO, THE IMPLIED WARRANTIES
 * OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE ARE DISCLAIMED.
 * IN NO EVENT SHALL THE AUTHOR BE LIABLE FOR ANY DIRECT, INDIRECT,     
 * INCIDENTAL, SPECIAL, EXEMPLARY, OR CONSEQUENTIAL DAMAGES (INCLUDING, BUT
 * NOT LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES; LOSS OF USE,
 * DATA, OR PROFITS; OR BUSINESS INTERRUPTION) HOWEVER CAUSED AND ON ANY
 * THEORY OF LIABILITY, WHETHER IN CONTRACT, STRICT LIABILITY, OR TORT
 * (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE USE OF
 * THIS SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.
a41 4
/* Interesting revision of the 0646 */
#define CMD0646U2_REV 0x05
#define CMD0646U_REV 0x03

d44 1
a44 1
#define CMD_CONF_REV_MASK	0x03 /* 0640/3/6 only */
d46 2
a47 2
#define CMD_CONF_DEVID		0x18 /* 0640/3/6 only */
#define CMD_CONF_VESAPRT	0x20 /* 0640/3/6 only */
d49 1
a49 1
#define CMD_CONF_DSA0		0x80 /* 0640/3/6 only */
d53 2
a54 2
#define CMD_CTRL_HR_FIFO		0x01 /* 0640/3/6 only */
#define CMD_CTRL_HW_FIFO		0x02 /* 0640/3/6 only */
d57 2
a58 2
#define CMD_CTRL_PAR			0x10 /* 0640/3/6 only */
#define CMD_CTRL_HW_HLD			0x20 /* 0640/3/6 only */
d73 1
a73 1
#define CMD_ARTTIM23	0x57
a78 1
#define CMD_DMA_MASK		0x03
d81 2
a82 17
#define CMD_DMA_LINE		0x03
/* the followings bits are only for 0646U/646U2/648/649 */
#define CMD_DMA_IRQ(chan) 	(0x4 << (chan))
#define CMD_DMA_IRQ_DIS(chan) 	(0x10 << (chan))
#define CMD_DMA_RST		0x40

/* the followings are only for 0646U/646U2/648/649 */
/* busmaster control/status register */
#define CMD_BICSR	0x79
#define CMD_BICSR_80(chan)	(0x01 << (chan))
/* Ultra/DMA timings reg */
#define CMD_UDMATIM(channel)	(0x73 + (8 * (channel)))
#define CMD_UDMATIM_UDMA(drive)	(0x01 << (drive))
#define CMD_UDMATIM_UDMA33(drive) (0x04 << (drive))
#define CMD_UDMATIM_TIM_MASK	0x3
#define CMD_UDMATIM_TIM_OFF(drive) (4 + ((drive) * 2))
static int8_t cmd0646_9_tim_udma[] = {0x03, 0x02, 0x01, 0x02, 0x01};
d85 1
a85 1
 * timings values for the 0643/6/8/9
d89 2
a90 2
static int8_t cmd0643_9_data_tim_pio[] = {0xA9, 0x57, 0x44, 0x32, 0x3F};
static int8_t cmd0643_9_data_tim_dma[] = {0x87, 0x32, 0x3F};
@


1.2.4.2
log
@Sync the SMP branch with 3.3
@
text
@d1 1
a1 1
/*	$OpenBSD$	*/
d17 2
a18 1
 *	This product includes software developed by Manuel Bouyer.
@


1.2.4.3
log
@Merge of current from two weeks agointo the SMP branch
@
text
@d25 1
a25 1
 * IN NO EVENT SHALL THE AUTHOR BE LIABLE FOR ANY DIRECT, INDIRECT,
d100 1
a100 1
static int8_t cmd0646_9_tim_udma[] = {0x03, 0x02, 0x01, 0x02, 0x01, 0x00};
@


1.1
log
@

Import of NetBSD ATA/IDE stuff.

Introduction of home-grown

To enable this stuff in your configuration, look at the NEWATA conf file
and go through

dev/isa/files.isa
dev/pci/files.pci
conf/files
arch/i386/conf/files.i386

and follow the instructions on commenting/uncommenting stuff
@
text
@d1 1
a1 1
/*	$OpenBSD: pciide_cmd_reg.h,v 1.4 1998/12/02 10:52:25 bouyer Exp $	*/
d71 5
@

