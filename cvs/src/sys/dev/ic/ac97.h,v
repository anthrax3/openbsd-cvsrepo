head	1.26;
access;
symbols
	OPENBSD_6_2_BASE:1.26
	OPENBSD_6_1:1.26.0.4
	OPENBSD_6_1_BASE:1.26
	OPENBSD_6_0:1.25.0.26
	OPENBSD_6_0_BASE:1.25
	OPENBSD_5_9:1.25.0.20
	OPENBSD_5_9_BASE:1.25
	OPENBSD_5_8:1.25.0.22
	OPENBSD_5_8_BASE:1.25
	OPENBSD_5_7:1.25.0.14
	OPENBSD_5_7_BASE:1.25
	OPENBSD_5_6:1.25.0.18
	OPENBSD_5_6_BASE:1.25
	OPENBSD_5_5:1.25.0.16
	OPENBSD_5_5_BASE:1.25
	OPENBSD_5_4:1.25.0.12
	OPENBSD_5_4_BASE:1.25
	OPENBSD_5_3:1.25.0.10
	OPENBSD_5_3_BASE:1.25
	OPENBSD_5_2:1.25.0.6
	OPENBSD_5_2_BASE:1.25
	OPENBSD_5_1_BASE:1.25
	OPENBSD_5_1:1.25.0.8
	OPENBSD_5_0:1.25.0.4
	OPENBSD_5_0_BASE:1.25
	OPENBSD_4_9:1.25.0.2
	OPENBSD_4_9_BASE:1.25
	OPENBSD_4_8:1.24.0.2
	OPENBSD_4_8_BASE:1.24
	OPENBSD_4_7:1.23.0.4
	OPENBSD_4_7_BASE:1.23
	OPENBSD_4_6:1.23.0.6
	OPENBSD_4_6_BASE:1.23
	OPENBSD_4_5:1.23.0.2
	OPENBSD_4_5_BASE:1.23
	OPENBSD_4_4:1.22.0.2
	OPENBSD_4_4_BASE:1.22
	OPENBSD_4_3:1.21.0.2
	OPENBSD_4_3_BASE:1.21
	OPENBSD_4_2:1.19.0.6
	OPENBSD_4_2_BASE:1.19
	OPENBSD_4_1:1.19.0.4
	OPENBSD_4_1_BASE:1.19
	OPENBSD_4_0:1.19.0.2
	OPENBSD_4_0_BASE:1.19
	OPENBSD_3_9:1.18.0.4
	OPENBSD_3_9_BASE:1.18
	OPENBSD_3_8:1.18.0.2
	OPENBSD_3_8_BASE:1.18
	OPENBSD_3_7:1.17.0.2
	OPENBSD_3_7_BASE:1.17
	OPENBSD_3_6:1.16.0.2
	OPENBSD_3_6_BASE:1.16
	SMP_SYNC_A:1.16
	SMP_SYNC_B:1.16
	OPENBSD_3_5:1.15.0.4
	OPENBSD_3_5_BASE:1.15
	OPENBSD_3_4:1.15.0.2
	OPENBSD_3_4_BASE:1.15
	UBC_SYNC_A:1.14
	OPENBSD_3_3:1.14.0.4
	OPENBSD_3_3_BASE:1.14
	OPENBSD_3_2:1.14.0.2
	OPENBSD_3_2_BASE:1.14
	OPENBSD_3_1:1.12.0.2
	OPENBSD_3_1_BASE:1.12
	UBC_SYNC_B:1.14
	UBC:1.10.0.2
	UBC_BASE:1.10
	OPENBSD_3_0:1.8.0.2
	OPENBSD_3_0_BASE:1.8
	OPENBSD_2_9_BASE:1.5
	OPENBSD_2_9:1.5.0.2
	OPENBSD_2_8:1.4.0.2
	OPENBSD_2_8_BASE:1.4
	OPENBSD_2_7:1.2.0.6
	OPENBSD_2_7_BASE:1.2
	SMP:1.2.0.4
	SMP_BASE:1.2
	kame_19991208:1.2
	OPENBSD_2_6:1.2.0.2
	OPENBSD_2_6_BASE:1.2;
locks; strict;
comment	@ * @;


1.26
date	2016.09.14.06.12.19;	author ratchov;	state Exp;
branches;
next	1.25;
commitid	pi1a9KN0itEngOc4;

1.25
date	2010.12.22.09.54.27;	author jakemsr;	state Exp;
branches;
next	1.24;

1.24
date	2010.08.08.20.37.33;	author jakemsr;	state Exp;
branches;
next	1.23;

1.23
date	2008.10.23.21.50.01;	author jakemsr;	state Exp;
branches;
next	1.22;

1.22
date	2008.05.25.23.52.30;	author jakemsr;	state Exp;
branches;
next	1.21;

1.21
date	2008.02.12.13.02.21;	author jakemsr;	state Exp;
branches;
next	1.20;

1.20
date	2008.01.15.02.52.50;	author jakemsr;	state Exp;
branches;
next	1.19;

1.19
date	2006.04.27.21.40.00;	author matthieu;	state Exp;
branches;
next	1.18;

1.18
date	2005.06.06.21.12.44;	author mjc;	state Exp;
branches;
next	1.17;

1.17
date	2004.10.04.20.03.04;	author mickey;	state Exp;
branches;
next	1.16;

1.16
date	2004.04.23.09.26.15;	author mickey;	state Exp;
branches;
next	1.15;

1.15
date	2003.07.15.13.20.31;	author couderc;	state Exp;
branches;
next	1.14;

1.14
date	2002.07.28.06.27.07;	author fgsch;	state Exp;
branches;
next	1.13;

1.13
date	2002.05.21.08.42.03;	author espie;	state Exp;
branches;
next	1.12;

1.12
date	2002.04.08.01.43.13;	author frantzen;	state Exp;
branches;
next	1.11;

1.11
date	2002.03.14.01.26.53;	author millert;	state Exp;
branches;
next	1.10;

1.10
date	2001.10.28.19.07.24;	author mickey;	state Exp;
branches
	1.10.2.1;
next	1.9;

1.9
date	2001.10.28.18.58.12;	author mickey;	state Exp;
branches;
next	1.8;

1.8
date	2001.05.16.23.34.53;	author mickey;	state Exp;
branches;
next	1.7;

1.7
date	2001.05.16.23.20.19;	author mickey;	state Exp;
branches;
next	1.6;

1.6
date	2001.05.16.05.05.19;	author mickey;	state Exp;
branches;
next	1.5;

1.5
date	2001.03.03.21.28.28;	author deraadt;	state Exp;
branches;
next	1.4;

1.4
date	2000.07.19.09.01.35;	author csapuntz;	state Exp;
branches;
next	1.3;

1.3
date	2000.06.27.20.49.31;	author art;	state Exp;
branches;
next	1.2;

1.2
date	99.09.21.16.06.28;	author csapuntz;	state Exp;
branches
	1.2.4.1;
next	1.1;

1.1
date	99.09.19.06.45.12;	author csapuntz;	state Exp;
branches;
next	;

1.2.4.1
date	2001.05.14.22.23.20;	author niklas;	state Exp;
branches;
next	1.2.4.2;

1.2.4.2
date	2001.07.04.10.40.23;	author niklas;	state Exp;
branches;
next	1.2.4.3;

1.2.4.3
date	2001.11.13.21.10.00;	author niklas;	state Exp;
branches;
next	1.2.4.4;

1.2.4.4
date	2002.03.28.11.50.59;	author niklas;	state Exp;
branches;
next	1.2.4.5;

1.2.4.5
date	2003.03.28.00.38.11;	author niklas;	state Exp;
branches;
next	1.2.4.6;

1.2.4.6
date	2004.02.19.10.56.15;	author niklas;	state Exp;
branches;
next	1.2.4.7;

1.2.4.7
date	2004.06.05.23.12.39;	author niklas;	state Exp;
branches;
next	;

1.10.2.1
date	2002.06.11.03.42.16;	author art;	state Exp;
branches;
next	1.10.2.2;

1.10.2.2
date	2002.10.29.00.33.23;	author art;	state Exp;
branches;
next	;


desc
@@


1.26
log
@Remove drain(), query_encoding(), mappage() and get_default_params()
methods from all audio drivers and from the audio_if structure as they
are never called.
@
text
@/*	$OpenBSD: ac97.h,v 1.24 2010/08/08 20:37:33 jakemsr Exp $	*/

/*
 * Copyright (c) 1999 Constantine Sapuntzakis
 *
 * Author:	Constantine Sapuntzakis <csapuntz@@stanford.edu>
 *
 * Redistribution and use in source and binary forms, with or without
 * modification, are permitted provided that the following conditions
 * are met:
 * 1. Redistributions of source code must retain the above copyright
 *    notice, this list of conditions and the following disclaimer.
 * 2. Redistributions in binary form must reproduce the above copyright
 *    notice, this list of conditions and the following disclaimer in the
 *    documentation and/or other materials provided with the distribution.
 *
 * THIS SOFTWARE IS PROVIDED BY CONSTANTINE SAPUNTZAKIS AND CONTRIBUTORS
 * ``AS IS'' AND ANY EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT LIMITED
 * TO, THE IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR
 * PURPOSE ARE DISCLAIMED.  IN NO EVENT SHALL THE AUTHOR OR CONTRIBUTORS
 * BE LIABLE FOR ANY DIRECT, INDIRECT, INCIDENTAL, SPECIAL, EXEMPLARY, OR
 * CONSEQUENTIAL DAMAGES (INCLUDING, BUT NOT LIMITED TO, PROCUREMENT OF
 * SUBSTITUTE GOODS OR SERVICES; LOSS OF USE, DATA, OR PROFITS; OR BUSINESS
 * INTERRUPTION) HOWEVER CAUSED AND ON ANY THEORY OF LIABILITY, WHETHER IN
 * CONTRACT, STRICT LIABILITY, OR TORT (INCLUDING NEGLIGENCE OR OTHERWISE)
 * ARISING IN ANY WAY OUT OF THE USE OF THIS SOFTWARE, EVEN IF ADVISED OF THE
 * POSSIBILITY OF SUCH DAMAGE.
 */

struct ac97_codec_if;

/*
 * This is the interface used to attach the AC97 compliant CODEC.
 */
enum ac97_host_flags {
	AC97_HOST_DONT_READ = 0x1,
	AC97_HOST_DONT_READANY = 0x2,
	AC97_HOST_SWAPPED_CHANNELS = 0x4,
	AC97_HOST_ALC650_PIN47_IS_EAPD = 0x8,
	AC97_HOST_VT1616_DYNEX = 0x10
};

struct ac97_host_if {
	void  *arg;

	int (*attach)(void *arg, struct ac97_codec_if *codecif);
	int (*read)(void *arg, u_int8_t reg, u_int16_t *val);
	int (*write)(void *arg, u_int8_t reg, u_int16_t val);
	void (*reset)(void *arg);

	enum ac97_host_flags (*flags)(void *arg);
	void (*spdif_event)(void *arg, int);
};

/*
 * This is the interface exported by the AC97 compliant CODEC
 */

struct ac97_codec_if_vtbl {
	int (*mixer_get_port)(struct ac97_codec_if *addr, mixer_ctrl_t *cp);
	int (*mixer_set_port)(struct ac97_codec_if *addr, mixer_ctrl_t *cp);
	int (*query_devinfo)(struct ac97_codec_if *addr, mixer_devinfo_t *cp);
	int (*get_portnum_by_name)(struct ac97_codec_if *addr, char *class,
	    char *device, char *qualifier);

	/*
	 *     The AC97 codec driver records the various port settings.
	 * This function can be used to restore the port settings, e.g.
	 * after resume from a laptop suspend to disk.
	 */
	void (*restore_ports)(struct ac97_codec_if *addr);

	u_int16_t (*get_caps)(struct ac97_codec_if *codec_if);
	int (*set_rate)(struct ac97_codec_if *codec_if, int target,
	    u_long *rate);
	void (*set_clock)(struct ac97_codec_if *codec_if,
	    unsigned int clock);
	void (*lock)(struct ac97_codec_if *codec_if);
	void (*unlock)(struct ac97_codec_if *codec_if);
};

struct ac97_codec_if {
	struct ac97_softc *as;
	void (*initfunc)(struct ac97_softc *, int);
	struct ac97_codec_if_vtbl *vtbl;
};

int ac97_attach(struct ac97_host_if *);
int ac97_resume(struct ac97_host_if *, struct ac97_codec_if *);
int ac97_set_rate(struct ac97_codec_if *, int, u_long *);

#define	AC97_REG_RESET			0x00
#define	AC97_CAPS_MICIN			0x0001
#define	AC97_CAPS_TONECTRL		0x0004
#define	AC97_CAPS_SIMSTEREO		0x0008
#define	AC97_CAPS_HEADPHONES		0x0010
#define	AC97_CAPS_LOUDNESS		0x0020
#define	AC97_CAPS_DAC18			0x0040
#define	AC97_CAPS_DAC20			0x0080
#define	AC97_CAPS_ADC18			0x0100
#define	AC97_CAPS_ADC20			0x0200
#define	AC97_CAPS_ENHANCEMENT_MASK	0xfc00
#define	AC97_CAPS_ENHANCEMENT_SHIFT	10
#define	AC97_CAPS_ENHANCEMENT(reg)	(((reg) >> 10) & 0x1f)
#define	AC97_REG_MASTER_VOLUME		0x02
#define	AC97_REG_HEADPHONE_VOLUME	0x04
#define	AC97_REG_MASTER_VOLUME_MONO	0x06
#define	AC97_REG_MASTER_TONE		0x08
#define	AC97_REG_PCBEEP_VOLUME		0x0a
#define	AC97_REG_PHONE_VOLUME		0x0c
#define	AC97_REG_MIC_VOLUME		0x0e
#define	AC97_REG_LINEIN_VOLUME		0x10
#define	AC97_REG_CD_VOLUME		0x12
#define	AC97_REG_VIDEO_VOLUME		0x14
#define	AC97_REG_AUX_VOLUME		0x16
#define	AC97_REG_PCMOUT_VOLUME		0x18
#define	AC97_REG_RECORD_SELECT		0x1a
#define	AC97_REG_RECORD_GAIN		0x1c
#define	AC97_REG_RECORD_GAIN_MIC	0x1e
#define	AC97_REG_GP			0x20
#define	AC97_REG_3D_CONTROL		0x22
#define	AC97_REG_MODEM_SAMPLE_RATE	0x24
#define	AC97_REG_POWER			0x26
#define	AC97_POWER_ADC			0x0001
#define	AC97_POWER_DAC			0x0002
#define	AC97_POWER_ANL			0x0004
#define	AC97_POWER_REF			0x0008
#define	AC97_POWER_IN			0x0100
#define	AC97_POWER_OUT			0x0200
#define	AC97_POWER_MIXER		0x0400
#define	AC97_POWER_MIXER_VREF		0x0800
#define	AC97_POWER_ACLINK		0x1000
#define	AC97_POWER_CLK			0x2000
#define	AC97_POWER_AUX			0x4000
#define	AC97_POWER_EAMP			0x8000
	/* Extended Audio Register Set */
#define	AC97_REG_EXT_AUDIO_ID		0x28
#define	AC97_REG_EXT_AUDIO_CTRL		0x2a
#define	AC97_EXT_AUDIO_VRA		0x0001
#define	AC97_EXT_AUDIO_DRA		0x0002
#define	AC97_EXT_AUDIO_SPDIF		0x0004
#define	AC97_EXT_AUDIO_VRM		0x0008
#define	AC97_EXT_AUDIO_DSA_MASK		0x0030
#define	AC97_EXT_AUDIO_DSA00		0x0000
#define	AC97_EXT_AUDIO_DSA01		0x0010
#define	AC97_EXT_AUDIO_DSA10		0x0020
#define	AC97_EXT_AUDIO_DSA11		0x0030
#define	AC97_EXT_AUDIO_SPSA_MASK	0x0030
#define	AC97_EXT_AUDIO_SPSA34		0x0000
#define	AC97_EXT_AUDIO_SPSA78		0x0010
#define	AC97_EXT_AUDIO_SPSA69		0x0020
#define	AC97_EXT_AUDIO_SPSAAB		0x0030
#define	AC97_EXT_AUDIO_CDAC		0x0040
#define	AC97_EXT_AUDIO_SDAC		0x0080
#define	AC97_EXT_AUDIO_LDAC		0x0100
#define	AC97_EXT_AUDIO_AMAP		0x0200
#define AC97_EXT_AUDIO_SPCV		0x0400
#define	AC97_EXT_AUDIO_REV_11		0x0000
#define	AC97_EXT_AUDIO_REV_22		0x0400
#define	AC97_EXT_AUDIO_REV_23		0x0800
#define	AC97_EXT_AUDIO_REV_MASK		0x0c00
#define	AC97_EXT_AUDIO_ID		0xc000
#define	AC97_EXT_AUDIO_BITS		"\020\01vra\02dra\03spdif\04vrm\05dsa0\06dsa1\07cdac\010sdac\011ldac\012amap\013rev0\014rev1\017id0\020id1"
#define AC97_SINGLE_RATE		48000
#define AC97_REG_PCM_FRONT_DAC_RATE	0x2c
#define AC97_REG_PCM_SURR_DAC_RATE	0x2e
#define AC97_REG_PCM_LFE_DAC_RATE	0x30
#define AC97_REG_PCM_LR_ADC_RATE	0x32
#define AC97_REG_PCM_MIC_ADC_RATE	0x34
#define AC97_REG_CENTER_LFE_MASTER	0x36
#define AC97_REG_SURR_MASTER		0x38
#define	AC97_REG_SPDIF_CTRL		0x3a
#define	AC97_REG_SPDIF_CTRL_BITS	"\02\01pro\02/audio\03copy\04pre\014l\017drs\020valid"
#define	AC97_SPDIF_V			0x8000
#define	AC97_SPDIF_DRS			0x4000
#define	AC97_SPDIF_SPSR_MASK		0x3000
#define	AC97_SPDIF_SPSR_44K		0x0000
#define	AC97_SPDIF_SPSR_48K		0x2000
#define	AC97_SPDIF_SPSR_32K		0x1000
#define	AC97_SPDIF_L			0x0800
#define	AC97_SPDIF_CC_MASK		0x07f0
#define	AC97_SPDIF_PRE			0x0008
#define	AC97_SPDIF_COPY			0x0004
#define	AC97_SPDIF_NOAUDIO		0x0002
#define	AC97_SPDIF_PRO			0x0001

#define	AC97_REG_VENDOR_ID1		0x7c
#define	AC97_REG_VENDOR_ID2		0x7e
#define	AC97_VENDOR_ID_MASK		0xffffff00


/* Analog Devices codec specific data */
#define AC97_AD_REG_MISC	0x76
#define AC97_AD_MISC_MBG0	0x0001	/* 0 */
#define AC97_AD_MISC_MBG1	0x0002	/* 1 */
#define AC97_AD_MISC_VREFD	0x0004	/* 2 */
#define AC97_AD_MISC_VREFH	0x0008	/* 3 */
#define AC97_AD_MISC_SRU	0x0010	/* 4 */
#define AC97_AD_MISC_LOSEL	0x0020	/* 5 */
#define AC97_AD_MISC_2CMIC	0x0040	/* 6 */
#define AC97_AD_MISC_SPRD	0x0080	/* 7 */
#define AC97_AD_MISC_DMIX0	0x0100	/* 8 */
#define AC97_AD_MISC_DMIX1	0x0200	/* 9 */
#define AC97_AD_MISC_HPSEL	0x0400	/*10 */
#define AC97_AD_MISC_CLDIS	0x0800	/*11 */
#define AC97_AD_MISC_LODIS	0x1000	/*12 */
#define AC97_AD_MISC_MSPLT	0x2000	/*13 */
#define AC97_AD_MISC_AC97NC	0x4000	/*14 */
#define AC97_AD_MISC_DACZ	0x8000	/*15 */

/* Avance Logic codec specific data*/
#define AC97_ALC650_REG_MULTI_CHANNEL_CONTROL		0x6a
#define	AC97_ALC650_MCC_SLOT_MODIFY_MASK		0xc000
#define	AC97_ALC650_MCC_FRONTDAC_FROM_SPDIFIN		0x2000
#define	AC97_ALC650_MCC_SPDIFOUT_FROM_ADC		0x1000
#define	AC97_ALC650_MCC_PCM_FROM_SPDIFIN		0x0800
#define	AC97_ALC650_MCC_MIC_OR_CENTERLFE		0x0400
#define	AC97_ALC650_MCC_LINEIN_OR_SURROUND		0x0200
#define	AC97_ALC650_MCC_INDEPENDENT_MASTER_L		0x0080
#define	AC97_ALC650_MCC_INDEPENDENT_MASTER_R		0x0040
#define	AC97_ALC650_MCC_ANALOG_TO_CENTERLFE		0x0020
#define	AC97_ALC650_MCC_ANALOG_TO_SURROUND		0x0010
#define	AC97_ALC650_MCC_EXCHANGE_CENTERLFE		0x0008
#define	AC97_ALC650_MCC_CENTERLFE_DOWNMIX		0x0004
#define	AC97_ALC650_MCC_SURROUND_DOWNMIX		0x0002
#define	AC97_ALC650_MCC_LINEOUT_TO_SURROUND		0x0001
#define AC97_ALC650_REG_MISC				0x7a
#define	AC97_ALC650_MISC_PIN47				0x0002
#define	AC97_ALC650_MISC_VREFDIS			0x1000


/* Conexant codec specific data */
#define AC97_CX_REG_MISC	0x5c
#define AC97_CX_PCM		0x00
#define AC97_CX_AC3		0x02
#define AC97_CX_MASK		0x03
#define AC97_CX_COPYRIGHT	0x04
#define AC97_CX_SPDIFEN		0x08


/* VIA codec specific data */
#define AC97_VT_REG_TEST	0x5a
#define AC97_VT_LVL		0x8000	/* hp controls rear */
#define AC97_VT_LCTF		0x1000	/* lfe/center to front downmix */
#define AC97_VT_STF		0x0800	/* surround to front downmix */
#define AC97_VT_BPDC		0x0400	/* enable DC-offset cancellation */
#define AC97_VT_DC		0x0200	/* DC offset cancellation capable */

#define AC97_IS_FIXED_RATE(codec)	!((codec)->vtbl->get_caps(codec) & \
    AC97_EXT_AUDIO_VRA)
#define AC97_BITS_6CH	(AC97_EXT_AUDIO_SDAC | AC97_EXT_AUDIO_CDAC | \
    AC97_EXT_AUDIO_LDAC)
@


1.25
log
@* recognize/support the Dynex DX-SC51 in envy(4)
* allow ac97(4) flags to be set in envy(4), if there is an ac97 codec
* configure the vt1616 codec on the Dynex DX-SC51 for multi-channel
  operation

ok ratchov
@
text
@a90 1
void ac97_get_default_params(struct audio_params *);
@


1.24
log
@suspend/resume support for auich, and some infrastructure in ac97
"commit" deraadt
@
text
@d1 1
a1 1
/*	$OpenBSD: ac97.h,v 1.23 2008/10/23 21:50:01 jakemsr Exp $	*/
d39 2
a40 1
	AC97_HOST_ALC650_PIN47_IS_EAPD = 0x8
d240 9
@


1.23
log
@
S/PDIF output support in ac97(4), auich(4) and auvia(4)

from NetBSD

tested by a few with no regressions.  optical works for jsg@@.

ok ratchov@@
@
text
@d1 1
a1 1
/*	$OpenBSD: ac97.h,v 1.22 2008/05/25 23:52:30 jakemsr Exp $	*/
d82 2
d88 1
@


1.22
log
@
add a function to get default parameters for ac97 codecs.  all ac97
codecs support 16-bit stereo slinear_le @@ 48kHz.

ok ratchov@@
@
text
@d1 1
a1 1
/*	$OpenBSD: ac97.h,v 1.21 2008/02/12 13:02:21 jakemsr Exp $	*/
d51 1
d77 2
d140 10
a149 2
#define	AC97_EXT_AUDIO_DSA0		0x0010
#define	AC97_EXT_AUDIO_DSA1		0x0020
d154 1
d171 12
@


1.21
log
@
pin 47 on ALC65{0,5,8} ac97 codecs can be used for either eapd or
spdif-in.  usually the deault of spdif-in is used, but some
ATI devices use pin 47 for eapd.

add a list of subsystem ids (from ALSA) for these devices, and set
bit 1 of register 7a to select the correct function of pin 47 for
these devices.

there was code here to do this prior to the ac97 update, but it
was accidentally removed.  rename the flag and bit to more accurately
reflect what this does and hopefully avoid future confusion.

problem noticed and fix tested/ok'd by matthieu@@, thanks

also some discussion with and pointers from brad@@, thanks
@
text
@d1 1
a1 1
/*	$OpenBSD: ac97.h,v 1.20 2008/01/15 02:52:50 jakemsr Exp $	*/
d84 1
@


1.20
log
@bring in lots of ac97(4) and auvia(4) updates from NetBSD

user visible changes:
- when setting up ac97(4) mixer items, for some features like surround
  sound, check if the feature if supported by the codec and only add
  items for that feature if it is
- auvia(4) now supports multichannel playback with at least some
  multichannel ac97(4) codecs

fixes problems for me and ajacoutot with different auvia(4)
devices/codecs.  no regressions reported by testers.

if you have an ac97(4) audio device and are using mixerctl.conf(5),
you may want/need to update it.

ok ratchov
@
text
@d1 1
a1 1
/*	$OpenBSD: ac97.h,v 1.19 2006/04/27 21:40:00 matthieu Exp $	*/
d39 1
a39 1
	AC97_HOST_DONT_ENABLE_SPDIF = 0x8
d199 4
@


1.19
log
@Quirk for MSI Megabook S270 audio output. Ok deraadt@@.
@
text
@d1 1
a1 1
/*	$OpenBSD: ac97.h,v 1.18 2005/06/06 21:12:44 mjc Exp $	*/
d70 6
d83 1
a83 1
int ac97_set_rate(struct ac97_codec_if *, struct audio_params *, int);
d148 8
a155 8
#define	AC97_SINGLERATE			48000
#define	AC97_REG_FRONT_DAC_RATE		0x2c
#define	AC97_REG_SURROUND_DAC_RATE	0x2e
#define	AC97_REG_PCM_DAC_RATE		0x30
#define	AC97_REG_PCM_ADC_RATE		0x32
#define	AC97_REG_MIC_ADC_RATE		0x34
#define	AC97_REG_CENTER_LFE_VOLUME	0x36
#define	AC97_REG_SURROUND_VOLUME	0x38
d163 1
d184 15
a198 5
#define	AC97_AV_REG_MULTICH	0x6a
#define	AC97_AV_MULTICH_MAGIC	0x8000
#define	AC97_AV_REG_MISC	0x7a
#define	AC97_AV_MISC_SPDIFEN	0x0002
#define	AC97_AV_MISC_VREFDIS	0x1000
d207 5
@


1.18
log
@correct names for miscellaneous control bit register
ok mickey@@
@
text
@d1 1
a1 1
/*	$OpenBSD: ac97.h,v 1.17 2004/10/04 20:03:04 mickey Exp $	*/
d38 2
a39 1
	AC97_HOST_SWAPPED_CHANNELS = 0x4
@


1.17
log
@a whole bunch of avance logic codecs and also patch for some
@
text
@d1 1
a1 1
/*	$OpenBSD: ac97.h,v 1.16 2004/04/23 09:26:15 mickey Exp $	*/
d158 16
a173 9
#define AC97_AD_MISC_MBG	0x0001	/* 0 */
#define AC97_AD_MISC_VREFD	0x0002	/* 1 */
#define AC97_AD_MISC_VREFH	0x0004	/* 2 */
#define AC97_AD_MISC_MADST	0x0008	/* 3 */
#define AC97_AD_MISC_MADPD	0x0020	/* 5 */
#define AC97_AD_MISC_FMXE	0x0100	/* 8 */
#define AC97_AD_MISC_DAM	0x0400	/*10 */
#define AC97_AD_MISC_MSPLT	0x1000	/*12 */
#define AC97_AD_MISC_DACZ	0x4000	/*14 */
@


1.16
log
@properly id CX20468 and patch it too, also one more _cx codec; made possible by fries@@
@
text
@d1 1
a1 1
/*	$OpenBSD: ac97.h,v 1.15 2003/07/15 13:20:31 couderc Exp $	*/
d167 7
@


1.15
log
@Add support for AD1985, deraadt@@ ok
@
text
@d1 1
a1 1
/*	$OpenBSD: ac97.h,v 1.14 2002/07/28 06:27:07 fgsch Exp $	*/
d157 18
a174 10
#define AC97_AD_REG_MISC        0x76
#define AC97_AD_MISC_MBG        0x0001  /* 0 */
#define AC97_AD_MISC_VREFD      0x0002  /* 1 */
#define AC97_AD_MISC_VREFH      0x0004  /* 2 */
#define AC97_AD_MISC_MADST      0x0008  /* 3 */
#define AC97_AD_MISC_MADPD      0x0020  /* 5 */
#define AC97_AD_MISC_FMXE       0x0100  /* 8 */
#define AC97_AD_MISC_DAM        0x0400  /*10 */
#define AC97_AD_MISC_MSPLT      0x1000  /*12 */
#define AC97_AD_MISC_DACZ       0x4000  /*14 */
@


1.14
log
@minor things from ac97 rev 2.3; mickey@@ ok
@
text
@d1 1
a1 1
/*	$OpenBSD: ac97.h,v 1.13 2002/05/21 08:42:03 espie Exp $	*/
d156 11
@


1.13
log
@Move enum definitions to global scope. Local scope is meaningless, and
interferes with C99's anonymous stuff.

ok millert@@
@
text
@d1 1
a1 1
/*	$OpenBSD: ac97.h,v 1.12 2002/04/08 01:43:13 frantzen Exp $	*/
d129 2
a130 1
#define	AC97_EXT_AUDIO_DSA		0x0030
d137 1
@


1.12
log
@add flag to swap channels.  from netbsd.
ok deraadt@@
@
text
@d1 1
a1 1
/*	$OpenBSD: ac97.h,v 1.11 2002/03/14 01:26:53 millert Exp $	*/
d35 6
a47 6

	enum ac97_host_flags {
		AC97_HOST_DONT_READ = 0x1,
		AC97_HOST_DONT_READANY = 0x2,
		AC97_HOST_SWAPPED_CHANNELS = 0x4
	};
@


1.11
log
@First round of __P removal in sys
@
text
@d1 1
a1 1
/*	$OpenBSD: ac97.h,v 1.10 2001/10/28 19:07:24 mickey Exp $	*/
d45 2
a46 1
		AC97_HOST_DONT_READANY = 0x2
@


1.10
log
@define caps bits, for later use
@
text
@d1 1
a1 1
/*	$OpenBSD: ac97.h,v 1.9 2001/10/28 18:58:12 mickey Exp $	*/
d74 2
a75 2
int ac97_attach __P((struct ac97_host_if *));
int ac97_set_rate __P((struct ac97_codec_if *, struct audio_params *, int));
@


1.10.2.1
log
@Sync UBC branch to -current
@
text
@d1 1
a1 1
/*	$OpenBSD: ac97.h,v 1.10 2001/10/28 19:07:24 mickey Exp $	*/
a34 6
enum ac97_host_flags {
	AC97_HOST_DONT_READ = 0x1,
	AC97_HOST_DONT_READANY = 0x2,
	AC97_HOST_SWAPPED_CHANNELS = 0x4
};

d43 5
d74 2
a75 2
int ac97_attach(struct ac97_host_if *);
int ac97_set_rate(struct ac97_codec_if *, struct audio_params *, int);
@


1.10.2.2
log
@sync to -current
@
text
@d1 1
a1 1
/*	$OpenBSD: ac97.h,v 1.10.2.1 2002/06/11 03:42:16 art Exp $	*/
d129 1
a129 2
#define	AC97_EXT_AUDIO_DSA0		0x0010
#define	AC97_EXT_AUDIO_DSA1		0x0020
a135 1
#define	AC97_EXT_AUDIO_REV_23		0x0800
@


1.9
log
@it appears that some non-vra compatible codecs implement part
of vra protocol by rounding all rates to 48kHz, but some
return 0. fix this by reporting 48kHz for all codecs w/o vra.
problem (finally) identified by hunter@@dg.net.ua, diff by me.
also, while here a/AC97_SOUND_ENHANCEMENT/AC97_CAPS_ENHANCEMENT/ .
@
text
@d1 1
a1 1
/*	$OpenBSD: ac97.h,v 1.8 2001/05/16 23:34:53 mickey Exp $	*/
d78 11
@


1.8
log
@add surrond, center and lfe ports (per 2.2 spec).
provide set_rate function, per 2.2 spec.
@
text
@d1 1
a1 1
/*	$OpenBSD: ac97.h,v 1.6 2001/05/16 05:05:19 mickey Exp $	*/
d78 1
a78 1
#define	AC97_SOUND_ENHANCEMENT(reg)	(((reg) >> 10) & 0x1f)
d127 1
@


1.7
log
@define power register bits
@
text
@d75 1
@


1.6
log
@more regs from 2.2 version of specs
@
text
@d1 1
a1 1
/*	$OpenBSD: ac97.h,v 1.5 2001/03/03 21:28:28 deraadt Exp $	*/
d97 12
@


1.5
log
@new AC97_HOST_DONT_READANY flag for ac97 chipsets that are _really_ on drugs
@
text
@d1 1
a1 1
/*      $OpenBSD: ac97.h,v 1.4 2000/07/19 09:01:35 csapuntz Exp $ */
d6 1
a6 1
 * Author:        Constantine Sapuntzakis <csapuntz@@stanford.edu>
d32 1
a32 1
/* 
d59 7
a65 7
	int (*get_portnum_by_name)(struct ac97_codec_if *addr,
				      char *class, char *device,
				      char *qualifier);

	/* The AC97 codec driver records the various port settings. This
	   function can be used to restore the port settings, e.g.
	   after resume from a laptop suspend to disk.
d76 52
a127 22
#define AC97_REG_RESET                0x00
#define AC97_SOUND_ENHANCEMENT(reg)   (((reg) >> 10) & 0x1f)
#define AC97_REG_MASTER_VOLUME        0x02
#define AC97_REG_HEADPHONE_VOLUME     0x04
#define AC97_REG_MASTER_VOLUME_MONO   0x06
#define AC97_REG_MASTER_TONE          0x08
#define AC97_REG_PCBEEP_VOLUME        0x0a
#define AC97_REG_PHONE_VOLUME         0x0c
#define AC97_REG_MIC_VOLUME           0x0e
#define AC97_REG_LINEIN_VOLUME        0x10
#define AC97_REG_CD_VOLUME            0x12
#define AC97_REG_VIDEO_VOLUME         0x14
#define AC97_REG_AUX_VOLUME           0x16
#define AC97_REG_PCMOUT_VOLUME        0x18
#define AC97_REG_RECORD_SELECT        0x1a
#define AC97_REG_RECORD_GAIN          0x1c
#define AC97_REG_RECORD_GAIN_MIC      0x1e
#define AC97_REG_GP                   0x20
#define AC97_REG_3D_CONTROL           0x22
#define AC97_REG_POWER                0x26
#define AC97_REG_VENDOR_ID1           0x7c
#define AC97_REG_VENDOR_ID2           0x7e
@


1.4
log
@

Added shadow registers. This adds two capabilities:

- support devices that crash when reading CODEC registers
        - a flags interface was added to the host interface
          and one flags AC97_HOST_DONT_READ defined.

- new API restore_ports restores the user's settings. This can
  be useful for resume after suspend to disk
@
text
@d1 1
a1 1
/*      $OpenBSD: ac97.h,v 1.3 2000/06/27 20:49:31 art Exp $ */
d44 2
a45 1
		AC97_HOST_DONT_READ = 0x1
@


1.3
log
@Move ac97 register defines into ac97.h
@
text
@d1 1
a1 1
/*      $OpenBSD: ac97.h,v 1.2 1999/09/21 16:06:28 csapuntz Exp $ */
d42 6
d61 6
@


1.2
log
@

Add get_portnum_by_name to ac97 vtbl.

get_portnum_by_name returns the mixer port # given a (class, device,
qualifier) tuple.
@
text
@d1 1
a1 1
/*      $OpenBSD: ac97.h,v 1.1 1999/09/19 06:45:12 csapuntz Exp $ */
d62 23
@


1.2.4.1
log
@merge in approximately 2.9 into SMP branch
@
text
@d1 1
a1 1
/*      $OpenBSD: ac97.h,v 1.5 2001/03/03 21:28:28 deraadt Exp $ */
a41 7

	enum ac97_host_flags {
		AC97_HOST_DONT_READ = 0x1,
		AC97_HOST_DONT_READANY = 0x2
	};

	enum ac97_host_flags (*flags)(void *arg);
a54 6

	/* The AC97 codec driver records the various port settings. This
	   function can be used to restore the port settings, e.g.
	   after resume from a laptop suspend to disk.
	 */
	void (*restore_ports)(struct ac97_codec_if *addr);
a61 23

#define AC97_REG_RESET                0x00
#define AC97_SOUND_ENHANCEMENT(reg)   (((reg) >> 10) & 0x1f)
#define AC97_REG_MASTER_VOLUME        0x02
#define AC97_REG_HEADPHONE_VOLUME     0x04
#define AC97_REG_MASTER_VOLUME_MONO   0x06
#define AC97_REG_MASTER_TONE          0x08
#define AC97_REG_PCBEEP_VOLUME        0x0a
#define AC97_REG_PHONE_VOLUME         0x0c
#define AC97_REG_MIC_VOLUME           0x0e
#define AC97_REG_LINEIN_VOLUME        0x10
#define AC97_REG_CD_VOLUME            0x12
#define AC97_REG_VIDEO_VOLUME         0x14
#define AC97_REG_AUX_VOLUME           0x16
#define AC97_REG_PCMOUT_VOLUME        0x18
#define AC97_REG_RECORD_SELECT        0x1a
#define AC97_REG_RECORD_GAIN          0x1c
#define AC97_REG_RECORD_GAIN_MIC      0x1e
#define AC97_REG_GP                   0x20
#define AC97_REG_3D_CONTROL           0x22
#define AC97_REG_POWER                0x26
#define AC97_REG_VENDOR_ID1           0x7c
#define AC97_REG_VENDOR_ID2           0x7e
@


1.2.4.2
log
@Merge in -current from two days ago in the SMP branch.
As usual with merges, they do not indicate progress, so do not hold
your breath for working SMP, and do not mail me and ask about the
state of it.  It has not changed.  There is work ongoing, but very, very
slowly.  The commit is done in parts as to not lock up the tree in too
big chunks at a time.
@
text
@d1 1
a1 1
/*	$OpenBSD$	*/
d6 1
a6 1
 * Author:	Constantine Sapuntzakis <csapuntz@@stanford.edu>
d32 1
a32 1
/*
d59 7
a65 7
	int (*get_portnum_by_name)(struct ac97_codec_if *addr, char *class,
	    char *device, char *qualifier);

	/*
	 *     The AC97 codec driver records the various port settings.
	 * This function can be used to restore the port settings, e.g.
	 * after resume from a laptop suspend to disk.
a74 65
int ac97_set_rate __P((struct ac97_codec_if *, struct audio_params *, int));

#define	AC97_REG_RESET			0x00
#define	AC97_SOUND_ENHANCEMENT(reg)	(((reg) >> 10) & 0x1f)
#define	AC97_REG_MASTER_VOLUME		0x02
#define	AC97_REG_HEADPHONE_VOLUME	0x04
#define	AC97_REG_MASTER_VOLUME_MONO	0x06
#define	AC97_REG_MASTER_TONE		0x08
#define	AC97_REG_PCBEEP_VOLUME		0x0a
#define	AC97_REG_PHONE_VOLUME		0x0c
#define	AC97_REG_MIC_VOLUME		0x0e
#define	AC97_REG_LINEIN_VOLUME		0x10
#define	AC97_REG_CD_VOLUME		0x12
#define	AC97_REG_VIDEO_VOLUME		0x14
#define	AC97_REG_AUX_VOLUME		0x16
#define	AC97_REG_PCMOUT_VOLUME		0x18
#define	AC97_REG_RECORD_SELECT		0x1a
#define	AC97_REG_RECORD_GAIN		0x1c
#define	AC97_REG_RECORD_GAIN_MIC	0x1e
#define	AC97_REG_GP			0x20
#define	AC97_REG_3D_CONTROL		0x22
#define	AC97_REG_MODEM_SAMPLE_RATE	0x24
#define	AC97_REG_POWER			0x26
#define	AC97_POWER_ADC			0x0001
#define	AC97_POWER_DAC			0x0002
#define	AC97_POWER_ANL			0x0004
#define	AC97_POWER_REF			0x0008
#define	AC97_POWER_IN			0x0100
#define	AC97_POWER_OUT			0x0200
#define	AC97_POWER_MIXER		0x0400
#define	AC97_POWER_MIXER_VREF		0x0800
#define	AC97_POWER_ACLINK		0x1000
#define	AC97_POWER_CLK			0x2000
#define	AC97_POWER_AUX			0x4000
#define	AC97_POWER_EAMP			0x8000
	/* Extended Audio Register Set */
#define	AC97_REG_EXT_AUDIO_ID		0x28
#define	AC97_REG_EXT_AUDIO_CTRL		0x2a
#define	AC97_EXT_AUDIO_VRA		0x0001
#define	AC97_EXT_AUDIO_DRA		0x0002
#define	AC97_EXT_AUDIO_SPDIF		0x0004
#define	AC97_EXT_AUDIO_VRM		0x0008
#define	AC97_EXT_AUDIO_DSA		0x0030
#define	AC97_EXT_AUDIO_CDAC		0x0040
#define	AC97_EXT_AUDIO_SDAC		0x0080
#define	AC97_EXT_AUDIO_LDAC		0x0100
#define	AC97_EXT_AUDIO_AMAP		0x0200
#define	AC97_EXT_AUDIO_REV_11		0x0000
#define	AC97_EXT_AUDIO_REV_22		0x0400
#define	AC97_EXT_AUDIO_REV_MASK		0x0c00
#define	AC97_EXT_AUDIO_ID		0xc000
#define	AC97_EXT_AUDIO_BITS		"\020\01vra\02dra\03spdif\04vrm\05dsa0\06dsa1\07cdac\010sdac\011ldac\012amap\013rev0\014rev1\017id0\020id1"
#define	AC97_REG_FRONT_DAC_RATE		0x2c
#define	AC97_REG_SURROUND_DAC_RATE	0x2e
#define	AC97_REG_PCM_DAC_RATE		0x30
#define	AC97_REG_PCM_ADC_RATE		0x32
#define	AC97_REG_MIC_ADC_RATE		0x34
#define	AC97_REG_CENTER_LFE_VOLUME	0x36
#define	AC97_REG_SURROUND_VOLUME	0x38
#define	AC97_REG_SPDIF_CTRL		0x3a
#define	AC97_REG_SPDIF_CTRL_BITS	"\02\01pro\02/audio\03copy\04pre\014l\017drs\020valid"

#define	AC97_REG_VENDOR_ID1		0x7c
#define	AC97_REG_VENDOR_ID2		0x7e
#define	AC97_VENDOR_ID_MASK		0xffffff00
d76 22
@


1.2.4.3
log
@Merge in -current
@
text
@d78 1
a78 12
#define	AC97_CAPS_MICIN			0x0001
#define	AC97_CAPS_TONECTRL		0x0004
#define	AC97_CAPS_SIMSTEREO		0x0008
#define	AC97_CAPS_HEADPHONES		0x0010
#define	AC97_CAPS_LOUDNESS		0x0020
#define	AC97_CAPS_DAC18			0x0040
#define	AC97_CAPS_DAC20			0x0080
#define	AC97_CAPS_ADC18			0x0100
#define	AC97_CAPS_ADC20			0x0200
#define	AC97_CAPS_ENHANCEMENT_MASK	0xfc00
#define	AC97_CAPS_ENHANCEMENT_SHIFT	10
#define	AC97_CAPS_ENHANCEMENT(reg)	(((reg) >> 10) & 0x1f)
a126 1
#define	AC97_SINGLERATE			48000
@


1.2.4.4
log
@Merge in -current from about a week ago
@
text
@d74 2
a75 2
int ac97_attach(struct ac97_host_if *);
int ac97_set_rate(struct ac97_codec_if *, struct audio_params *, int);
@


1.2.4.5
log
@Sync the SMP branch with 3.3
@
text
@a34 6
enum ac97_host_flags {
	AC97_HOST_DONT_READ = 0x1,
	AC97_HOST_DONT_READANY = 0x2,
	AC97_HOST_SWAPPED_CHANNELS = 0x4
};

d43 5
d128 1
a128 2
#define	AC97_EXT_AUDIO_DSA0		0x0010
#define	AC97_EXT_AUDIO_DSA1		0x0020
a134 1
#define	AC97_EXT_AUDIO_REV_23		0x0800
@


1.2.4.6
log
@Merge of current from two weeks agointo the SMP branch
@
text
@a155 11
/* Analog Devices codec specific data */
#define AC97_AD_REG_MISC        0x76
#define AC97_AD_MISC_MBG        0x0001  /* 0 */
#define AC97_AD_MISC_VREFD      0x0002  /* 1 */
#define AC97_AD_MISC_VREFH      0x0004  /* 2 */
#define AC97_AD_MISC_MADST      0x0008  /* 3 */
#define AC97_AD_MISC_MADPD      0x0020  /* 5 */
#define AC97_AD_MISC_FMXE       0x0100  /* 8 */
#define AC97_AD_MISC_DAM        0x0400  /*10 */
#define AC97_AD_MISC_MSPLT      0x1000  /*12 */
#define AC97_AD_MISC_DACZ       0x4000  /*14 */
@


1.2.4.7
log
@Merge with the trunk
@
text
@d157 10
a166 18
#define AC97_AD_REG_MISC	0x76
#define AC97_AD_MISC_MBG	0x0001	/* 0 */
#define AC97_AD_MISC_VREFD	0x0002	/* 1 */
#define AC97_AD_MISC_VREFH	0x0004	/* 2 */
#define AC97_AD_MISC_MADST	0x0008	/* 3 */
#define AC97_AD_MISC_MADPD	0x0020	/* 5 */
#define AC97_AD_MISC_FMXE	0x0100	/* 8 */
#define AC97_AD_MISC_DAM	0x0400	/*10 */
#define AC97_AD_MISC_MSPLT	0x1000	/*12 */
#define AC97_AD_MISC_DACZ	0x4000	/*14 */

/* Conexant codec specific data */
#define AC97_CX_REG_MISC	0x5c
#define AC97_CX_PCM		0x00
#define AC97_CX_AC3		0x02
#define AC97_CX_MASK		0x03
#define AC97_CX_COPYRIGHT	0x04
#define AC97_CX_SPDIFEN		0x08
@


1.1
log
@

AC-97 CODEC support. Some help from FreeBSD, esp. on nice printing of
features.
@
text
@d1 1
a1 1
/*      $OpenBSD: $ */
d52 3
@

