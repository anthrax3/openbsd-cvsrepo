head	1.5;
access;
symbols
	OPENBSD_6_2:1.5.0.14
	OPENBSD_6_2_BASE:1.5
	OPENBSD_6_1:1.5.0.16
	OPENBSD_6_1_BASE:1.5
	OPENBSD_6_0:1.5.0.12
	OPENBSD_6_0_BASE:1.5
	OPENBSD_5_9:1.5.0.8
	OPENBSD_5_9_BASE:1.5
	OPENBSD_5_8:1.5.0.10
	OPENBSD_5_8_BASE:1.5
	OPENBSD_5_7:1.5.0.2
	OPENBSD_5_7_BASE:1.5
	OPENBSD_5_6:1.5.0.6
	OPENBSD_5_6_BASE:1.5
	OPENBSD_5_5:1.5.0.4
	OPENBSD_5_5_BASE:1.5
	OPENBSD_5_4:1.3.0.2
	OPENBSD_5_4_BASE:1.3;
locks; strict;
comment	@ * @;


1.5
date	2013.12.25.14.04.50;	author espie;	state Exp;
branches;
next	1.4;

1.4
date	2013.12.14.18.01.52;	author espie;	state Exp;
branches;
next	1.3;

1.3
date	2013.06.04.09.11.40;	author espie;	state Exp;
branches;
next	1.2;

1.2
date	2013.06.03.10.37.02;	author espie;	state Exp;
branches;
next	1.1;

1.1
date	2013.06.01.14.37.32;	author espie;	state Exp;
branches;
next	;


desc
@@


1.5
log
@zap defines that don't make any sense for us
okay tedu@@
@
text
@/*	$OpenBSD: tmpfs_vnops.h,v 1.4 2013/12/14 18:01:52 espie Exp $	*/
/*	$NetBSD: tmpfs_vnops.h,v 1.13 2011/05/24 20:17:49 rmind Exp $	*/

/*
 * Copyright (c) 2005, 2006 The NetBSD Foundation, Inc.
 * All rights reserved.
 *
 * This code is derived from software contributed to The NetBSD Foundation
 * by Julio M. Merino Vidal, developed as part of Google's Summer of Code
 * 2005 program.
 *
 * Redistribution and use in source and binary forms, with or without
 * modification, are permitted provided that the following conditions
 * are met:
 * 1. Redistributions of source code must retain the above copyright
 *    notice, this list of conditions and the following disclaimer.
 * 2. Redistributions in binary form must reproduce the above copyright
 *    notice, this list of conditions and the following disclaimer in the
 *    documentation and/or other materials provided with the distribution.
 *
 * THIS SOFTWARE IS PROVIDED BY THE NETBSD FOUNDATION, INC. AND CONTRIBUTORS
 * ``AS IS'' AND ANY EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT LIMITED
 * TO, THE IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR
 * PURPOSE ARE DISCLAIMED.  IN NO EVENT SHALL THE FOUNDATION OR CONTRIBUTORS
 * BE LIABLE FOR ANY DIRECT, INDIRECT, INCIDENTAL, SPECIAL, EXEMPLARY, OR
 * CONSEQUENTIAL DAMAGES (INCLUDING, BUT NOT LIMITED TO, PROCUREMENT OF
 * SUBSTITUTE GOODS OR SERVICES; LOSS OF USE, DATA, OR PROFITS; OR BUSINESS
 * INTERRUPTION) HOWEVER CAUSED AND ON ANY THEORY OF LIABILITY, WHETHER IN
 * CONTRACT, STRICT LIABILITY, OR TORT (INCLUDING NEGLIGENCE OR OTHERWISE)
 * ARISING IN ANY WAY OUT OF THE USE OF THIS SOFTWARE, EVEN IF ADVISED OF THE
 * POSSIBILITY OF SUCH DAMAGE.
 */

#ifndef _TMPFS_TMPFS_VNOPS_H_
#define _TMPFS_TMPFS_VNOPS_H_

#if !defined(_KERNEL)
#error not supposed to be exposed to userland.
#endif

/*
 * Declarations for tmpfs_vnops.c.
 */

extern struct vops tmpfs_vops, tmpfs_fifovops, tmpfs_specvops;

int	tmpfs_lookup		(void *);
int	tmpfs_create		(void *);
int	tmpfs_mknod		(void *);
int	tmpfs_open		(void *);
int	tmpfs_close		(void *);
int	tmpfs_access		(void *);
int	tmpfs_getattr		(void *);
int	tmpfs_setattr		(void *);
int	tmpfs_read		(void *);
int	tmpfs_write		(void *);
int	tmpfs_ioctl		(void *);
int	tmpfs_poll		(void *);
int	tmpfs_fsync		(void *);
int	tmpfs_remove		(void *);
int	tmpfs_link		(void *);
int	tmpfs_rename		(void *);
int	tmpfs_mkdir		(void *);
int	tmpfs_rmdir		(void *);
int	tmpfs_symlink		(void *);
int	tmpfs_readdir		(void *);
int	tmpfs_readlink		(void *);
int	tmpfs_inactive		(void *);
int	tmpfs_reclaim		(void *);
int	tmpfs_lock		(void *);
int	tmpfs_unlock		(void *);
int	tmpfs_islocked		(void *);
int	tmpfs_strategy		(void *);
int	tmpfs_print		(void *);
int	tmpfs_pathconf		(void *);
int	tmpfs_advlock		(void *);
int	tmpfs_bwrite		(void *);

#endif /* _TMPFS_TMPFS_VNOPS_H_ */
@


1.4
log
@bring in a few improvements from pedro, guenther, me...

thanks to krw@@ for the original cherry-picking, millert@@ for useful comment.

so:
- no longer expose internal kernel addresses, uses seq numbers instead
- make sure the numbers don't overflow (millert@@ UINT64_MAX)... a
conservative estimate is that tmpfs will run out of seqs in >600 years...
- don't malloc dents, put them on the stack and zero them
- gc whiteout code
- gc getpage/putpage code (shrink uvm instead)

okay krw@@, millert@@
@
text
@d1 1
a1 1
/*	$OpenBSD: tmpfs_vnops.h,v 1.3 2013/06/04 09:11:40 espie Exp $	*/
a56 1
#define	tmpfs_fcntl		genfs_fcntl
a58 1
#define	tmpfs_mmap		genfs_mmap
a59 1
#define	tmpfs_seek		genfs_seek
@


1.3
log
@fix include guard locations (from pedro)
@
text
@d1 1
a1 1
/*	$OpenBSD: tmpfs_vnops.h,v 1.2 2013/06/03 10:37:02 espie Exp $	*/
a80 3
int	tmpfs_getpages		(void *);
int	tmpfs_putpages		(void *);
int	tmpfs_whiteout		(void *);
@


1.2
log
@sprinkle $OpenBSD$, pointed out by pedro
@
text
@d1 1
a1 1
/*	$OpenBSD$	*/
d34 2
a35 2
#ifndef _FS_TMPFS_TMPFS_VNOPS_H_
#define _FS_TMPFS_TMPFS_VNOPS_H_
d85 1
a85 1
#endif /* _FS_TMPFS_TMPFS_VNOPS_H_ */
@


1.1
log
@import tmpfs code, originally from netbsd.
heavy lifting by Pedro Martelletto, timestamp fixes by me.

THIS IS NOT ENABLED YET, AND REQUIRES UVM CHANGES AND REVIEW.
Imported, so that working on it can be mostly done in tree with less painful
diff exchanges, and that we have history of further changes.

okay tedu@@, deraadt@@
@
text
@d1 1
@

