head	1.37;
access;
symbols
	OPENBSD_6_2:1.37.0.4
	OPENBSD_6_2_BASE:1.37
	OPENBSD_6_1:1.37.0.6
	OPENBSD_6_1_BASE:1.37
	OPENBSD_6_0:1.37.0.2
	OPENBSD_6_0_BASE:1.37
	OPENBSD_5_9:1.35.0.4
	OPENBSD_5_9_BASE:1.35
	OPENBSD_5_8:1.35.0.6
	OPENBSD_5_8_BASE:1.35
	OPENBSD_5_7:1.35.0.2
	OPENBSD_5_7_BASE:1.35
	OPENBSD_5_6:1.34.0.12
	OPENBSD_5_6_BASE:1.34
	OPENBSD_5_5:1.34.0.10
	OPENBSD_5_5_BASE:1.34
	OPENBSD_5_4:1.34.0.6
	OPENBSD_5_4_BASE:1.34
	OPENBSD_5_3:1.34.0.4
	OPENBSD_5_3_BASE:1.34
	OPENBSD_5_2:1.34.0.2
	OPENBSD_5_2_BASE:1.34
	OPENBSD_5_1_BASE:1.33
	OPENBSD_5_1:1.33.0.4
	OPENBSD_5_0:1.33.0.2
	OPENBSD_5_0_BASE:1.33
	OPENBSD_4_9:1.31.0.6
	OPENBSD_4_9_BASE:1.31
	OPENBSD_4_8:1.31.0.4
	OPENBSD_4_8_BASE:1.31
	OPENBSD_4_7:1.31.0.2
	OPENBSD_4_7_BASE:1.31
	OPENBSD_4_6:1.29.0.8
	OPENBSD_4_6_BASE:1.29
	OPENBSD_4_5:1.29.0.4
	OPENBSD_4_5_BASE:1.29
	OPENBSD_4_4:1.29.0.2
	OPENBSD_4_4_BASE:1.29
	OPENBSD_4_3:1.28.0.2
	OPENBSD_4_3_BASE:1.28
	OPENBSD_4_2:1.27.0.2
	OPENBSD_4_2_BASE:1.27
	OPENBSD_4_1:1.24.0.2
	OPENBSD_4_1_BASE:1.24
	OPENBSD_4_0:1.23.0.12
	OPENBSD_4_0_BASE:1.23
	OPENBSD_3_9:1.23.0.10
	OPENBSD_3_9_BASE:1.23
	OPENBSD_3_8:1.23.0.8
	OPENBSD_3_8_BASE:1.23
	OPENBSD_3_7:1.23.0.6
	OPENBSD_3_7_BASE:1.23
	OPENBSD_3_6:1.23.0.4
	OPENBSD_3_6_BASE:1.23
	SMP_SYNC_A:1.23
	SMP_SYNC_B:1.23
	OPENBSD_3_5:1.23.0.2
	OPENBSD_3_5_BASE:1.23
	OPENBSD_3_4:1.22.0.2
	OPENBSD_3_4_BASE:1.22
	UBC_SYNC_A:1.20
	OPENBSD_3_3:1.20.0.2
	OPENBSD_3_3_BASE:1.20
	OPENBSD_3_2:1.19.0.4
	OPENBSD_3_2_BASE:1.19
	OPENBSD_3_1:1.19.0.2
	OPENBSD_3_1_BASE:1.19
	UBC_SYNC_B:1.20
	UBC:1.17.0.2
	UBC_BASE:1.17
	OPENBSD_3_0:1.16.0.2
	OPENBSD_3_0_BASE:1.16
	OPENBSD_2_9_BASE:1.10
	OPENBSD_2_9:1.10.0.6
	OPENBSD_2_8:1.10.0.4
	OPENBSD_2_8_BASE:1.10
	OPENBSD_2_7:1.10.0.2
	OPENBSD_2_7_BASE:1.10
	SMP:1.7.0.2
	SMP_BASE:1.7
	kame_19991208:1.7
	OPENBSD_2_6:1.6.0.6
	OPENBSD_2_6_BASE:1.6
	OPENBSD_2_5:1.6.0.4
	OPENBSD_2_5_BASE:1.6
	OPENBSD_2_4:1.6.0.2
	OPENBSD_2_4_BASE:1.6
	OPENBSD_2_3:1.3.0.4
	OPENBSD_2_3_BASE:1.3
	OPENBSD_2_2:1.3.0.2
	OPENBSD_2_2_BASE:1.3
	OPENBSD_2_1:1.2.0.4
	OPENBSD_2_1_BASE:1.2
	OPENBSD_2_0:1.2.0.2
	OPENBSD_2_0_BASE:1.2
	netbsd_1_1:1.1.1.1;
locks; strict;
comment	@ * @;


1.37
date	2016.05.06.19.45.35;	author kettenis;	state Exp;
branches;
next	1.36;
commitid	K2ngZVENkbXEjHeW;

1.36
date	2016.04.18.15.25.08;	author beck;	state Exp;
branches;
next	1.35;
commitid	K1soNw9ej5A4DSS8;

1.35
date	2015.01.09.05.01.56;	author tedu;	state Exp;
branches;
next	1.34;
commitid	KWogeIYA2sxG3IjB;

1.34
date	2012.04.10.15.50.52;	author guenther;	state Exp;
branches;
next	1.33;

1.33
date	2011.08.08.19.34.25;	author deraadt;	state Exp;
branches;
next	1.32;

1.32
date	2011.06.05.19.41.09;	author deraadt;	state Exp;
branches;
next	1.31;

1.31
date	2009.12.08.22.12.06;	author miod;	state Exp;
branches;
next	1.30;

1.30
date	2009.08.09.10.40.17;	author blambert;	state Exp;
branches;
next	1.29;

1.29
date	2008.03.20.22.25.29;	author deraadt;	state Exp;
branches;
next	1.28;

1.28
date	2007.11.02.21.01.13;	author millert;	state Exp;
branches;
next	1.27;

1.27
date	2007.05.31.05.12.41;	author pedro;	state Exp;
branches;
next	1.26;

1.26
date	2007.05.26.20.26.51;	author pedro;	state Exp;
branches;
next	1.25;

1.25
date	2007.03.12.19.25.58;	author mickey;	state Exp;
branches;
next	1.24;

1.24
date	2007.02.14.16.47.04;	author mickey;	state Exp;
branches;
next	1.23;

1.23
date	2004.01.01.20.17.34;	author millert;	state Exp;
branches;
next	1.22;

1.22
date	2003.07.24.04.02.20;	author deraadt;	state Exp;
branches;
next	1.21;

1.21
date	2003.06.02.23.28.01;	author millert;	state Exp;
branches;
next	1.20;

1.20
date	2002.10.06.20.19.53;	author art;	state Exp;
branches;
next	1.19;

1.19
date	2002.03.23.13.28.34;	author espie;	state Exp;
branches;
next	1.18;

1.18
date	2002.02.17.22.59.53;	author maja;	state Exp;
branches;
next	1.17;

1.17
date	2001.11.09.15.25.55;	author art;	state Exp;
branches
	1.17.2.1;
next	1.16;

1.16
date	2001.08.23.12.02.04;	author art;	state Exp;
branches;
next	1.15;

1.15
date	2001.08.12.23.58.34;	author millert;	state Exp;
branches;
next	1.14;

1.14
date	2001.07.05.10.12.22;	author art;	state Exp;
branches;
next	1.13;

1.13
date	2001.06.27.04.58.42;	author art;	state Exp;
branches;
next	1.12;

1.12
date	2001.05.17.18.41.47;	author provos;	state Exp;
branches;
next	1.11;

1.11
date	2001.05.05.20.56.57;	author art;	state Exp;
branches;
next	1.10;

1.10
date	2000.03.27.13.56.10;	author mickey;	state Exp;
branches;
next	1.9;

1.9
date	2000.03.23.09.59.56;	author art;	state Exp;
branches;
next	1.8;

1.8
date	2000.03.21.14.55.52;	author deraadt;	state Exp;
branches;
next	1.7;

1.7
date	99.11.26.16.22.03;	author art;	state Exp;
branches
	1.7.2.1;
next	1.6;

1.6
date	98.08.27.05.00.11;	author deraadt;	state Exp;
branches;
next	1.5;

1.5
date	98.08.27.00.46.29;	author mickey;	state Exp;
branches;
next	1.4;

1.4
date	98.05.20.22.29.08;	author downsj;	state Exp;
branches;
next	1.3;

1.3
date	97.05.28.22.39.59;	author mickey;	state Exp;
branches;
next	1.2;

1.2
date	96.04.19.07.31.24;	author mickey;	state Exp;
branches;
next	1.1;

1.1
date	95.10.18.08.52.27;	author deraadt;	state Exp;
branches
	1.1.1.1;
next	;

1.1.1.1
date	95.10.18.08.52.27;	author deraadt;	state Exp;
branches;
next	;

1.7.2.1
date	2000.03.24.09.09.04;	author niklas;	state Exp;
branches;
next	1.7.2.2;

1.7.2.2
date	2001.05.14.22.06.49;	author niklas;	state Exp;
branches;
next	1.7.2.3;

1.7.2.3
date	2001.07.04.10.39.56;	author niklas;	state Exp;
branches;
next	1.7.2.4;

1.7.2.4
date	2001.10.31.03.11.47;	author nate;	state Exp;
branches;
next	1.7.2.5;

1.7.2.5
date	2001.11.13.21.05.48;	author niklas;	state Exp;
branches;
next	1.7.2.6;

1.7.2.6
date	2002.03.06.02.07.09;	author niklas;	state Exp;
branches;
next	1.7.2.7;

1.7.2.7
date	2003.03.27.23.53.48;	author niklas;	state Exp;
branches;
next	1.7.2.8;

1.7.2.8
date	2003.06.07.11.00.37;	author ho;	state Exp;
branches;
next	1.7.2.9;

1.7.2.9
date	2004.02.19.10.51.30;	author niklas;	state Exp;
branches;
next	;

1.17.2.1
date	2002.06.11.03.28.26;	author art;	state Exp;
branches;
next	1.17.2.2;

1.17.2.2
date	2002.10.29.00.30.52;	author art;	state Exp;
branches;
next	;


desc
@@


1.37
log
@Revert the previous commit.  There still are bad interactions between the
pagedaemon and the buffer cache.

requested by deraadt@@
@
text
@/*	$OpenBSD: param.c,v 1.36 2016/04/18 15:25:08 beck Exp $	*/
/*	$NetBSD: param.c,v 1.16 1996/03/12 03:08:40 mrg Exp $	*/

/*
 * Copyright (c) 1980, 1986, 1989 Regents of the University of California.
 * All rights reserved.
 * (c) UNIX System Laboratories, Inc.
 * All or some portions of this file are derived from material licensed
 * to the University of California by American Telephone and Telegraph
 * Co. or Unix System Laboratories, Inc. and are reproduced herein with
 * the permission of UNIX System Laboratories, Inc.
 *
 * Redistribution and use in source and binary forms, with or without
 * modification, are permitted provided that the following conditions
 * are met:
 * 1. Redistributions of source code must retain the above copyright
 *    notice, this list of conditions and the following disclaimer.
 * 2. Redistributions in binary form must reproduce the above copyright
 *    notice, this list of conditions and the following disclaimer in the
 *    documentation and/or other materials provided with the distribution.
 * 3. Neither the name of the University nor the names of its contributors
 *    may be used to endorse or promote products derived from this software
 *    without specific prior written permission.
 *
 * THIS SOFTWARE IS PROVIDED BY THE REGENTS AND CONTRIBUTORS ``AS IS'' AND
 * ANY EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT LIMITED TO, THE
 * IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE
 * ARE DISCLAIMED.  IN NO EVENT SHALL THE REGENTS OR CONTRIBUTORS BE LIABLE
 * FOR ANY DIRECT, INDIRECT, INCIDENTAL, SPECIAL, EXEMPLARY, OR CONSEQUENTIAL
 * DAMAGES (INCLUDING, BUT NOT LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS
 * OR SERVICES; LOSS OF USE, DATA, OR PROFITS; OR BUSINESS INTERRUPTION)
 * HOWEVER CAUSED AND ON ANY THEORY OF LIABILITY, WHETHER IN CONTRACT, STRICT
 * LIABILITY, OR TORT (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY
 * OUT OF THE USE OF THIS SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF
 * SUCH DAMAGE.
 *
 *	@@(#)param.c	7.20 (Berkeley) 6/27/91
 */

#include <sys/param.h>
#include <sys/systm.h>
#include <sys/socket.h>
#include <sys/proc.h>
#include <sys/vnode.h>
#include <sys/file.h>
#include <sys/timeout.h>
#include <sys/mbuf.h>
#include <ufs/ufs/quota.h>
#include <sys/kernel.h>
#include <sys/utsname.h>
#ifdef SYSVSHM
#include <machine/vmparam.h>
#include <sys/shm.h>
#endif
#ifdef SYSVSEM
#include <sys/sem.h>
#endif
#ifdef SYSVMSG
#include <sys/msg.h>
#endif

/*
 * System parameter formulae.
 *
 * This file is copied into each directory where we compile
 * the kernel; it should be modified there to suit local taste
 * if necessary.
 *
 * Compiled with -DHZ=xx -DTIMEZONE=x -DDST=x -DMAXUSERS=xx
 */

#ifndef TIMEZONE
# define TIMEZONE 0
#endif
#ifndef DST
# define DST 0
#endif
#ifndef HZ
#define	HZ 100
#endif
int	hz = HZ;
int	tick = 1000000 / HZ;
int	tickadj = 240000 / (60 * HZ);		/* can adjust 240ms in 60s */
struct	timezone tz = { TIMEZONE, DST };
#define	NPROCESS (30 + 16 * MAXUSERS)
#define	NTEXT (80 + NPROCESS / 8)		/* actually the object cache */
#define	NVNODE (NPROCESS * 2 + NTEXT + 100)	 
int	initialvnodes = NVNODE;
int	maxprocess = NPROCESS;
int	maxthread = NPROCESS + 8 * MAXUSERS;
int	maxfiles = 5 * (NPROCESS + MAXUSERS) + 80;
int	nmbclust = NMBCLUSTERS;

#ifndef MBLOWAT
#define MBLOWAT		16
#endif
int	mblowat = MBLOWAT;

#ifndef MCLLOWAT
#define MCLLOWAT	8
#endif
int	mcllowat = MCLLOWAT;

#ifndef BUFCACHEPERCENT
#define BUFCACHEPERCENT	20
#endif
int     bufcachepercent = BUFCACHEPERCENT;

#ifndef  BUFPAGES
#define BUFPAGES	0
#endif
long     bufpages = BUFPAGES;

int	fscale = FSCALE;	/* kernel uses `FSCALE', user uses `fscale' */

/*
 * Values in support of System V compatible shared memory.	XXX
 */
#ifdef SYSVSHM
#define	SHMMAX	SHMMAXPGS	/* shminit() performs a `*= PAGE_SIZE' */
#define	SHMMIN	1
#define	SHMMNI	128		/* <64k, see IPCID_TO_IX in ipc.h */
#define	SHMSEG	128
#define	SHMALL	(SHMMAXPGS)

struct	shminfo shminfo = {
	SHMMAX,
	SHMMIN,
	SHMMNI,
	SHMSEG,
	SHMALL
};
#endif

/*
 * Values in support of System V compatible semaphores.
 */
#ifdef SYSVSEM
struct	seminfo seminfo = {
	SEMMNI,		/* # of semaphore identifiers */
	SEMMNS,		/* # of semaphores in system */
	SEMMNU,		/* # of undo structures in system */
	SEMMSL,		/* max # of semaphores per id */
	SEMOPM,		/* max # of operations per semop call */
	SEMUME,		/* max # of undo entries per process */
	SEMUSZ,		/* size in bytes of undo structure */
	SEMVMX,		/* semaphore maximum value */
	SEMAEM		/* adjust on exit max value */
};
#endif

/*
 * This has to be allocated somewhere; allocating
 * them here forces loader errors if this file is omitted
 * (if they've been externed everywhere else; hah!).
 */
struct	utsname utsname;
@


1.36
log
@Bump the default of cachepercent to 90 to see if we can find problems before
we try to remove it entirely
ok deraadt@@
@
text
@d1 1
a1 1
/*	$OpenBSD: param.c,v 1.35 2015/01/09 05:01:56 tedu Exp $	*/
d105 1
a105 1
#define BUFCACHEPERCENT	90
@


1.35
log
@rename desiredvnodes to initialvnodes. less of a lie. ok beck deraadt
@
text
@d1 1
a1 1
/*	$OpenBSD: param.c,v 1.34 2012/04/10 15:50:52 guenther Exp $	*/
d105 1
a105 1
#define BUFCACHEPERCENT	20
@


1.34
log
@Make the KERN_NPROCS and KERN_MAXPROC sysctl()s and the RLIMIT_NPROC rlimit
count processes instead of threads.  New sysctl()s KERN_NTHREADS and
KERN_MAXTHREAD count and limit threads.  The nprocs and maxproc kernel
variables are replaced by nprocess, maxprocess, nthreads, and maxthread.

ok tedu@@ mikeb@@
@
text
@d1 1
a1 1
/*	$OpenBSD: param.c,v 1.33 2011/08/08 19:34:25 deraadt Exp $	*/
d88 1
a88 1
int	desiredvnodes = NVNODE;
@


1.33
log
@Ship 5.0 with bufcachepercent=20
@
text
@d1 1
a1 1
/*	$OpenBSD: param.c,v 1.32 2011/06/05 19:41:09 deraadt Exp $	*/
d85 3
a87 3
#define	NPROC (30 + 16 * MAXUSERS)
#define	NTEXT (80 + NPROC / 8)			/* actually the object cache */
#define	NVNODE (NPROC * 2 + NTEXT + 100)	 
d89 3
a91 2
int	maxproc = NPROC;
int	maxfiles = 5 * (NPROC + MAXUSERS) + 80;
@


1.32
log
@Move the bufcachepercent setting code to MI locations -- set it to 42%
for now; that is unlikely to hit some of the remaining starvation bugs.
Repair the bufpages calculation too; i386 was doing it ahead of time
(incorrectly) and then re-calculating it.
ok thib
@
text
@d1 1
a1 1
/*	$OpenBSD: param.c,v 1.31 2009/12/08 22:12:06 miod Exp $	*/
d104 1
a104 1
#define BUFCACHEPERCENT	42
@


1.31
log
@Remove old SysV SHM size limits global variables, they are no longer needed
since blambert@@ rewrote the allocation code.
@
text
@d1 1
a1 1
/*	$OpenBSD: param.c,v 1.30 2009/08/09 10:40:17 blambert Exp $	*/
d103 9
@


1.30
log
@Rototill system V message queues.

No longer allocate a static amount of memory for messages in MD
boot path; message queues, message metadata, and message data now
all use dynamic memory, which means that runtime sysctls should now
be trivial to implement.

Since I'm going to be around all week to fix any breakage, this should
probably just go in now.
@
text
@d1 1
a1 1
/*	$OpenBSD: param.c,v 1.29 2008/03/20 22:25:29 deraadt Exp $	*/
a105 2
int	shmseg = 8;
int	shmmaxpgs = SHMMAXPGS;
@


1.29
log
@we now have a higher count of kernel threads on many machines, so crank
the base amount in NPROC to 30; ok miod
@
text
@d1 1
a1 1
/*	$OpenBSD: param.c,v 1.28 2007/11/02 21:01:13 millert Exp $	*/
a140 15
};
#endif

/*
 * Values in support of System V compatible messages.
 */
#ifdef SYSVMSG
struct	msginfo msginfo = {
	MSGMAX,		/* max chars in a message */
	MSGMNI,		/* # of message queue identifiers */
	MSGMNB,		/* max chars in a queue */
	MSGTQL,		/* max messages in system */
	MSGSSZ,		/* size of a message segment */
			/* (must be small power of 2 greater than 4) */
	MSGSEG		/* number of message segments */
@


1.28
log
@crank maxfiles; OK deraadt@@
@
text
@d1 1
a1 1
/*	$OpenBSD: param.c,v 1.27 2007/05/31 05:12:41 pedro Exp $	*/
d85 1
a85 1
#define	NPROC (20 + 16 * MAXUSERS)
@


1.27
log
@NFSv2 cannot cope with a big number of vnodes, so revert to NPROC-based
calculation until the problem is fixed, okay beck@@ art@@
@
text
@d1 1
a1 1
/*	$OpenBSD: param.c,v 1.26 2007/05/26 20:26:51 pedro Exp $	*/
d90 1
a90 1
int	maxfiles = 3 * (NPROC + MAXUSERS) + 80;
@


1.26
log
@Dynamic buffer cache. Initial diff from mickey@@, okay art@@ beck@@ toby@@
deraadt@@ dlg@@.
@
text
@d1 1
a1 1
/*	$OpenBSD: param.c,v 1.25 2007/03/12 19:25:58 mickey Exp $	*/
d86 3
@


1.25
log
@better desiredvnodes not based on maxusers; pedro@@ deraadt@@ ok
@
text
@d1 1
a1 1
/*	$OpenBSD: param.c,v 1.24 2007/02/14 16:47:04 mickey Exp $	*/
d157 1
a157 1
 * These have to be allocated somewhere; allocating
a160 3
struct	buf *buf;
char	*buffers;

@


1.24
log
@recycle swbuf that had been long gone (w/ old vm)
(this is in preparation for approaching GBC work)
@
text
@d1 1
a1 1
/*	$OpenBSD: param.c,v 1.23 2004/01/01 20:17:34 millert Exp $	*/
a86 3
#define	NTEXT (80 + NPROC / 8)	/* actually the object cache */
#define	NVNODE (NPROC * 2 + NTEXT + 100)
int	desiredvnodes = NVNODE;
@


1.23
log
@Crank SHMMNI from 32 -> 128 and SHMSEG from 8 -> 128.  OK deraadt@@
@
text
@d1 1
a1 1
/*	$OpenBSD: param.c,v 1.22 2003/07/24 04:02:20 deraadt Exp $	*/
d164 1
a164 1
struct	buf *buf, *swbuf;
@


1.22
log
@knf
@
text
@d1 1
a1 1
/*	$OpenBSD: param.c,v 1.21 2003/06/02 23:28:01 millert Exp $	*/
d114 2
a115 2
#define	SHMMNI	32			/* <= SHMMMNI in shm.h */
#define	SHMSEG	8
@


1.21
log
@Remove the advertising clause in the UCB license which Berkeley
rescinded 22 July 1999.  Proofed by myself and Theo.
@
text
@d1 1
a1 1
/*	$OpenBSD: param.c,v 1.20 2002/10/06 20:19:53 art Exp $	*/
d107 1
a107 1
int 	shmmaxpgs = SHMMAXPGS;
@


1.20
log
@nbuf doesn't belong here. It's declared on all architectures instead.
And here it goes into the bss, while it's initialized in MD code.
@
text
@d1 1
a1 1
/*	$OpenBSD: param.c,v 1.19 2002/03/23 13:28:34 espie Exp $	*/
d21 1
a21 5
 * 3. All advertising materials mentioning features or use of this software
 *    must display the following acknowledgement:
 *	This product includes software developed by the University of
 *	California, Berkeley and its contributors.
 * 4. Neither the name of the University nor the names of its contributors
@


1.19
log
@Add variables for config(8) -e time tweak of systemV shared memory
parameters.

Ok millert@@, miod@@, maja@@
@
text
@d1 1
a1 1
/*	$OpenBSD: param.c,v 1.18 2002/02/17 22:59:53 maja Exp $	*/
a161 6

/*
 * These are initialized at bootstrap time
 * to values dependent on memory size
 */
int	nbuf;
@


1.18
log
@Patch from Daniel Lucq <daniel@@lucq.org>

The patch allows you to change the value of NMBCLUSTERS, BUFCACHEPERCENT
and NKMEMPAGES using the config command, instead of recompiling the kernel.

This is the kernel part of the patch. I have compiled it on i386, sparc64,
alpha and macppc. -moj ok art@@ maja@@
@
text
@d1 1
a1 1
/*	$OpenBSD: param.c,v 1.17 2001/11/09 15:25:55 art Exp $	*/
d110 2
@


1.17
log
@nswbuf hasn't been used for ages. gc.
@
text
@d1 1
a1 1
/*	$OpenBSD: param.c,v 1.16 2001/08/23 12:02:04 art Exp $	*/
d95 1
a95 1
int	nmbclusters = NMBCLUSTERS;
@


1.17.2.1
log
@Sync UBC branch to -current
@
text
@d1 1
a1 1
/*	$OpenBSD: param.c,v 1.17 2001/11/09 15:25:55 art Exp $	*/
d95 1
a95 1
int	nmbclust = NMBCLUSTERS;
a109 2
int	shmseg = 8;
int 	shmmaxpgs = SHMMAXPGS;
@


1.17.2.2
log
@sync to -current
@
text
@d1 1
a1 1
/*	$OpenBSD: param.c,v 1.17.2.1 2002/06/11 03:28:26 art Exp $	*/
d162 6
@


1.16
log
@Remove even more old timeout tentacles.
@
text
@d1 1
a1 1
/*	$OpenBSD: param.c,v 1.15 2001/08/12 23:58:34 millert Exp $	*/
d165 1
a165 1
int	nbuf, nswbuf;
@


1.15
log
@seminfo.semmap and SEMMAP are not used; kill them
Solaris doesn't have these either...
@
text
@d1 1
a1 1
/*	$OpenBSD: param.c,v 1.14 2001/07/05 10:12:22 art Exp $	*/
a94 1
int	ntimeout = (16 + NPROC) * 2;
a171 1
struct 	timeout *timeouts;
@


1.14
log
@Get rid of REAL_CLISTS. It was never implemented and the tentacles are
everywhhere.
@
text
@d1 1
a1 1
/*	$OpenBSD: param.c,v 1.13 2001/06/27 04:58:42 art Exp $	*/
a134 1
	SEMMAP,		/* # of entries in semaphore map */
@


1.13
log
@Remove old vm.
@
text
@d1 1
a1 1
/*	$OpenBSD: param.c,v 1.12 2001/05/17 18:41:47 provos Exp $	*/
a50 3
#ifdef REAL_CLISTS
#include <sys/clist.h>
#endif
a95 3
#ifdef REAL_CLISTS
int	nclist = 60 + 12 * MAXUSERS;
#endif
a174 1
struct	cblock *cfree;
@


1.12
log
@convert mbuf and cluster allocation to pool, mostly from NetBSD
okay art@@ miod@@
@
text
@d1 1
a1 1
/*	$OpenBSD: param.c,v 1.11 2001/05/05 20:56:57 art Exp $	*/
a94 3
#ifndef UVM
int	vm_cache_max = NTEXT;	/* XXX these probably needs some measurements */
#endif
@


1.11
log
@Get rid of CLSIZE and all related stuff.
CLSIZE -> 1
CLBYTES -> PAGE_SIZE
OLOFSET -> PAGE_MASK
etc.
At the same time some archs needed some cleaning in vmparam.h so that
goes in at the same time.
@
text
@d1 1
a1 1
/*	$OpenBSD: param.c,v 1.10 2000/03/27 13:56:10 mickey Exp $	*/
d106 12
@


1.10
log
@no vm_cache_max in uvm; ok art@@
@
text
@d1 1
a1 1
/*	$OpenBSD: param.c,v 1.9 2000/03/23 09:59:56 art Exp $	*/
d116 1
a116 1
#define	SHMALL	(SHMMAXPGS/CLSIZE)
@


1.9
log
@New API for timeouts. Replaces the old timeout()/untimeout() API and
makes it the callers responsibility to allocate resources for the
timeouts.

This is a KISS implementation and does _not_ solve the problems of slow
handling of a large number of pending timeouts (this will be solved in
future work) (although hardclock is now guarateed to take constant time
for handling of timeouts).

Old timeout() and untimeout() are implemented as wrappers around the new
API and kept for compatibility. They will be removed as soon as all
subsystems are converted to use the new API.
@
text
@d1 1
a1 1
/*	$OpenBSD: param.c,v 1.8 2000/03/21 14:55:52 deraadt Exp $	*/
d95 1
d97 1
@


1.8
log
@double ncallout, until art fixes this further
@
text
@d1 1
a1 1
/*	$OpenBSD: param.c,v 1.7 1999/11/26 16:22:03 art Exp $	*/
d50 1
a50 1
#include <sys/callout.h>
d99 1
a99 1
int	ncallout = (16 + NPROC) * 2;
d169 1
a169 1
struct 	callout *callout;
@


1.7
log
@Update comment to reflect reality.
@
text
@d1 1
a1 1
/*	$OpenBSD: param.c,v 1.6 1998/08/27 05:00:11 deraadt Exp $	*/
d99 1
a99 1
int	ncallout = 16 + NPROC;
@


1.7.2.1
log
@Sync with -current
@
text
@d1 1
a1 1
/*	$OpenBSD$	*/
d50 1
a50 1
#include <sys/timeout.h>
d99 1
a99 1
int	ntimeout = (16 + NPROC) * 2;
d169 1
a169 1
struct 	timeout *timeouts;
@


1.7.2.2
log
@merge in approximately 2.9 into SMP branch
@
text
@d1 1
a1 1
/*	$OpenBSD: param.c,v 1.10 2000/03/27 13:56:10 mickey Exp $	*/
a94 1
#ifndef UVM
a95 1
#endif
@


1.7.2.3
log
@Merge in -current from two days ago in the SMP branch.
As usual with merges, they do not indicate progress, so do not hold
your breath for working SMP, and do not mail me and ask about the
state of it.  It has not changed.  There is work ongoing, but very, very
slowly.  The commit is done in parts as to not lock up the tree in too
big chunks at a time.
@
text
@d1 1
a1 1
/*	$OpenBSD: param.c,v 1.7.2.2 2001/05/14 22:06:49 niklas Exp $	*/
d95 3
a105 12

#ifndef MBLOWAT
#define MBLOWAT		16
#endif
int	mblowat = MBLOWAT;

#ifndef MCLLOWAT
#define MCLLOWAT	8
#endif
int	mcllowat = MCLLOWAT;


d116 1
a116 1
#define	SHMALL	(SHMMAXPGS)
@


1.7.2.4
log
@Sync the SMP branch to something just after 3.0
@
text
@d1 1
a1 1
/*	$OpenBSD: param.c,v 1.7.2.3 2001/07/04 10:39:56 niklas Exp $	*/
d51 3
d98 4
d141 1
d180 2
@


1.7.2.5
log
@Merge in -current
@
text
@d1 1
a1 1
/*	$OpenBSD$	*/
d165 1
a165 1
int	nbuf;
@


1.7.2.6
log
@Merge in trunk
@
text
@d95 1
a95 1
int	nmbclust = NMBCLUSTERS;
@


1.7.2.7
log
@Sync the SMP branch with 3.3
@
text
@a109 2
int	shmseg = 8;
int 	shmmaxpgs = SHMMAXPGS;
d160 6
@


1.7.2.8
log
@Sync SMP branch to -current
@
text
@d1 1
a1 1
/*	$OpenBSD: param.c,v 1.7.2.7 2003/03/27 23:53:48 niklas Exp $	*/
d21 5
a25 1
 * 3. Neither the name of the University nor the names of its contributors
@


1.7.2.9
log
@Merge of current from two weeks agointo the SMP branch
@
text
@d1 1
a1 1
/*	$OpenBSD$	*/
d107 1
a107 1
int	shmmaxpgs = SHMMAXPGS;
d114 2
a115 2
#define	SHMMNI	128		/* <64k, see IPCID_TO_IX in ipc.h */
#define	SHMSEG	128
@


1.6
log
@Undo changes which were not discussed.
@
text
@d1 1
a1 1
/*	$OpenBSD: param.c,v 1.4 1998/05/20 22:29:08 downsj Exp $	*/
d110 1
a110 1
#define	SHMMAX	SHMMAXPGS	/* shminit() performs a `*= NBPG' */
@


1.5
log
@defopt TIMEZONE
@
text
@a43 2
#include "opt_timezone.h"

@


1.4
log
@Increase NVNODE.
@
text
@d1 1
a1 1
/*	$OpenBSD: param.c,v 1.3 1997/05/28 22:39:59 mickey Exp $	*/
d43 2
@


1.3
log
@move vm_cache_max into param.c
make it maxusers adaptive
note, that NTEXT approximation is probably not the best idea
@
text
@d1 1
a1 1
/*	$OpenBSD: param.c,v 1.2 1996/04/19 07:31:24 mickey Exp $	*/
d96 1
a96 1
#define	NVNODE (NPROC + NTEXT + 100)
@


1.2
log
@Make kernel config again.
at least isa,eisa,pci ocnfigs were affected.
@
text
@d1 1
a1 1
/*	$OpenBSD$	*/
d94 2
a95 1
#define	NTEXT (80 + NPROC / 8)			/* actually the object cache */
@


1.1
log
@Initial revision
@
text
@d1 2
a2 1
/*	$NetBSD: param.c,v 1.15 1995/03/08 00:54:44 cgd Exp $	*/
d79 6
@


1.1.1.1
log
@initial import of NetBSD tree
@
text
@@
