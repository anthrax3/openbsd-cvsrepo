head	1.15;
access;
symbols
	OPENBSD_6_0:1.14.0.18
	OPENBSD_6_0_BASE:1.14
	OPENBSD_5_9:1.14.0.14
	OPENBSD_5_9_BASE:1.14
	OPENBSD_5_8:1.14.0.16
	OPENBSD_5_8_BASE:1.14
	OPENBSD_5_7:1.14.0.8
	OPENBSD_5_7_BASE:1.14
	OPENBSD_5_6:1.14.0.12
	OPENBSD_5_6_BASE:1.14
	OPENBSD_5_5:1.14.0.10
	OPENBSD_5_5_BASE:1.14
	OPENBSD_5_4:1.14.0.6
	OPENBSD_5_4_BASE:1.14
	OPENBSD_5_3:1.14.0.4
	OPENBSD_5_3_BASE:1.14
	OPENBSD_5_2:1.14.0.2
	OPENBSD_5_2_BASE:1.14
	OPENBSD_5_1_BASE:1.12
	OPENBSD_5_1:1.12.0.36
	OPENBSD_5_0:1.12.0.34
	OPENBSD_5_0_BASE:1.12
	OPENBSD_4_9:1.12.0.32
	OPENBSD_4_9_BASE:1.12
	OPENBSD_4_8:1.12.0.30
	OPENBSD_4_8_BASE:1.12
	OPENBSD_4_7:1.12.0.26
	OPENBSD_4_7_BASE:1.12
	OPENBSD_4_6:1.12.0.28
	OPENBSD_4_6_BASE:1.12
	OPENBSD_4_5:1.12.0.24
	OPENBSD_4_5_BASE:1.12
	OPENBSD_4_4:1.12.0.22
	OPENBSD_4_4_BASE:1.12
	OPENBSD_4_3:1.12.0.20
	OPENBSD_4_3_BASE:1.12
	OPENBSD_4_2:1.12.0.18
	OPENBSD_4_2_BASE:1.12
	OPENBSD_4_1:1.12.0.16
	OPENBSD_4_1_BASE:1.12
	OPENBSD_4_0:1.12.0.14
	OPENBSD_4_0_BASE:1.12
	OPENBSD_3_9:1.12.0.12
	OPENBSD_3_9_BASE:1.12
	OPENBSD_3_8:1.12.0.10
	OPENBSD_3_8_BASE:1.12
	OPENBSD_3_7:1.12.0.8
	OPENBSD_3_7_BASE:1.12
	OPENBSD_3_6:1.12.0.6
	OPENBSD_3_6_BASE:1.12
	SMP_SYNC_A:1.12
	SMP_SYNC_B:1.12
	OPENBSD_3_5:1.12.0.4
	OPENBSD_3_5_BASE:1.12
	OPENBSD_3_4:1.12.0.2
	OPENBSD_3_4_BASE:1.12
	UBC_SYNC_A:1.11
	OPENBSD_3_3:1.11.0.10
	OPENBSD_3_3_BASE:1.11
	OPENBSD_3_2:1.11.0.8
	OPENBSD_3_2_BASE:1.11
	OPENBSD_3_1:1.11.0.6
	OPENBSD_3_1_BASE:1.11
	UBC_SYNC_B:1.11
	UBC:1.11.0.4
	UBC_BASE:1.11
	OPENBSD_3_0:1.11.0.2
	OPENBSD_3_0_BASE:1.11
	OPENBSD_2_9_BASE:1.9
	OPENBSD_2_9:1.9.0.4
	OPENBSD_2_8:1.9.0.2
	OPENBSD_2_8_BASE:1.9
	OPENBSD_2_7:1.8.0.2
	OPENBSD_2_7_BASE:1.8
	SMP:1.6.0.6
	SMP_BASE:1.6
	kame_19991208:1.6
	OPENBSD_2_6:1.6.0.4
	OPENBSD_2_6_BASE:1.6
	OPENBSD_2_5:1.6.0.2
	OPENBSD_2_5_BASE:1.6
	OPENBSD_2_4:1.5.0.4
	OPENBSD_2_4_BASE:1.5
	OPENBSD_2_3:1.5.0.2
	OPENBSD_2_3_BASE:1.5
	OPENBSD_2_2:1.4.0.6
	OPENBSD_2_2_BASE:1.4
	OPENBSD_2_1:1.4.0.4
	OPENBSD_2_1_BASE:1.4
	OPENBSD_2_0:1.4.0.2
	OPENBSD_2_0_BASE:1.4
	netbsd_1_1:1.1.1.1;
locks; strict;
comment	@ * @;


1.15
date	2016.07.27.14.44.59;	author tedu;	state Exp;
branches;
next	1.14;
commitid	XAdC1jj6KiTyzPFD;

1.14
date	2012.04.12.14.25.57;	author deraadt;	state Exp;
branches;
next	1.13;

1.13
date	2012.04.12.12.33.03;	author deraadt;	state Exp;
branches;
next	1.12;

1.12
date	2003.06.02.23.28.22;	author millert;	state Exp;
branches;
next	1.11;

1.11
date	2001.06.27.04.51.49;	author art;	state Exp;
branches;
next	1.10;

1.10
date	2001.05.11.06.36.59;	author angelos;	state Exp;
branches;
next	1.9;

1.9
date	2000.06.18.17.59.55;	author niklas;	state Exp;
branches;
next	1.8;

1.8
date	2000.02.21.20.00.08;	author art;	state Exp;
branches;
next	1.7;

1.7
date	2000.02.21.19.22.52;	author art;	state Exp;
branches;
next	1.6;

1.6
date	99.02.26.02.47.02;	author art;	state Exp;
branches
	1.6.6.1;
next	1.5;

1.5
date	97.11.09.22.12.22;	author millert;	state Exp;
branches;
next	1.4;

1.4
date	96.07.07.18.06.43;	author mickey;	state Exp;
branches;
next	1.3;

1.3
date	96.03.03.12.12.47;	author niklas;	state Exp;
branches;
next	1.2;

1.2
date	96.02.19.22.24.18;	author tholo;	state Exp;
branches;
next	1.1;

1.1
date	95.10.18.08.53.31;	author deraadt;	state Exp;
branches
	1.1.1.1;
next	;

1.1.1.1
date	95.10.18.08.53.31;	author deraadt;	state Exp;
branches;
next	;

1.6.6.1
date	2000.02.21.22.29.15;	author niklas;	state Exp;
branches;
next	1.6.6.2;

1.6.6.2
date	2001.05.14.22.45.05;	author niklas;	state Exp;
branches;
next	1.6.6.3;

1.6.6.3
date	2001.07.04.11.00.38;	author niklas;	state Exp;
branches;
next	1.6.6.4;

1.6.6.4
date	2003.06.07.11.09.08;	author ho;	state Exp;
branches;
next	;


desc
@@


1.15
log
@increase the size of forkstat fields to accomodate large values
@
text
@/*	$OpenBSD: vmmeter.h,v 1.14 2012/04/12 14:25:57 deraadt Exp $	*/
/*	$NetBSD: vmmeter.h,v 1.9 1995/03/26 20:25:04 jtc Exp $	*/

/*-
 * Copyright (c) 1982, 1986, 1993
 *	The Regents of the University of California.  All rights reserved.
 *
 * Redistribution and use in source and binary forms, with or without
 * modification, are permitted provided that the following conditions
 * are met:
 * 1. Redistributions of source code must retain the above copyright
 *    notice, this list of conditions and the following disclaimer.
 * 2. Redistributions in binary form must reproduce the above copyright
 *    notice, this list of conditions and the following disclaimer in the
 *    documentation and/or other materials provided with the distribution.
 * 3. Neither the name of the University nor the names of its contributors
 *    may be used to endorse or promote products derived from this software
 *    without specific prior written permission.
 *
 * THIS SOFTWARE IS PROVIDED BY THE REGENTS AND CONTRIBUTORS ``AS IS'' AND
 * ANY EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT LIMITED TO, THE
 * IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE
 * ARE DISCLAIMED.  IN NO EVENT SHALL THE REGENTS OR CONTRIBUTORS BE LIABLE
 * FOR ANY DIRECT, INDIRECT, INCIDENTAL, SPECIAL, EXEMPLARY, OR CONSEQUENTIAL
 * DAMAGES (INCLUDING, BUT NOT LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS
 * OR SERVICES; LOSS OF USE, DATA, OR PROFITS; OR BUSINESS INTERRUPTION)
 * HOWEVER CAUSED AND ON ANY THEORY OF LIABILITY, WHETHER IN CONTRACT, STRICT
 * LIABILITY, OR TORT (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY
 * OUT OF THE USE OF THIS SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF
 * SUCH DAMAGE.
 *
 *	@@(#)vmmeter.h	8.2 (Berkeley) 7/10/94
 */

#ifndef	__VMMETER_H__
#define	__VMMETER_H__

/*
 * System wide statistics counters.  Look in <uvm/uvm_extern.h> for the
 * UVM equivalent.
 */

/* systemwide totals computed every five seconds */
struct vmtotal {
	u_int16_t t_rq;		/* length of the run queue */
	u_int16_t t_dw;		/* jobs in ``disk wait'' (neg priority) */
	u_int16_t t_pw;		/* jobs in page wait */
	u_int16_t t_sl;		/* jobs sleeping in core */
	u_int16_t t_sw;		/* swapped out runnable/short block jobs */
	u_int32_t t_vm;		/* total virtual memory */
	u_int32_t t_avm;	/* active virtual memory */
	u_int32_t t_rm;		/* total real memory in use */
	u_int32_t t_arm;	/* active real memory */
	u_int32_t t_vmshr;	/* shared virtual memory */
	u_int32_t t_avmshr;	/* active shared virtual memory */
	u_int32_t t_rmshr;	/* shared real memory */
	u_int32_t t_armshr;	/* active shared real memory */
	u_int32_t t_free;	/* free memory pages */
};

/*
 * Fork/vfork/__tfork accounting.
 */
struct  forkstat {
	uint32_t	cntfork;	/* number of fork() calls */
	uint32_t	cntvfork;	/* number of vfork() calls */
	uint32_t	cnttfork;	/* number of __tfork() calls */
	uint32_t	cntkthread;	/* number of kernel threads created */
	uint64_t	sizfork;	/* VM pages affected by fork() */
	uint64_t	sizvfork;	/* VM pages affected by vfork() */
	uint64_t	siztfork;	/* VM pages affected by __tfork() */
	uint64_t	sizkthread;	/* VM pages affected by kernel threads */
};

/* These sysctl names are only really used by sysctl(8) */
#define KERN_FORKSTAT_FORK		1
#define KERN_FORKSTAT_VFORK		2
#define KERN_FORKSTAT_TFORK		3
#define KERN_FORKSTAT_KTHREAD		4
#define KERN_FORKSTAT_SIZFORK		5
#define KERN_FORKSTAT_SIZVFORK		6
#define KERN_FORKSTAT_SIZTFORK		7
#define KERN_FORKSTAT_SIZKTHREAD	8
#define KERN_FORKSTAT_MAXID		9

#define CTL_KERN_FORKSTAT_NAMES { \
	{ 0, 0 }, \
	{ "forks", CTLTYPE_INT }, \
	{ "vforks", CTLTYPE_INT }, \
	{ "tforks", CTLTYPE_INT }, \
	{ "kthreads", CTLTYPE_INT }, \
	{ "fork_pages", CTLTYPE_INT }, \
	{ "vfork_pages", CTLTYPE_INT }, \
	{ "tfork_pages", CTLTYPE_INT }, \
	{ "kthread_pages", CTLTYPE_INT }, \
}
#endif /* __VMMETER_H__ */
@


1.14
log
@more rfork mop-up
@
text
@d1 1
a1 1
/*	$OpenBSD: vmmeter.h,v 1.13 2012/04/12 12:33:03 deraadt Exp $	*/
d65 8
a72 8
	int	cntfork;	/* number of fork() calls */
	int	cntvfork;	/* number of vfork() calls */
	int	cnttfork;	/* number of __tfork() calls */
	int	cntkthread;	/* number of kernel threads created */
	int	sizfork;	/* VM pages affected by fork() */
	int	sizvfork;	/* VM pages affected by vfork() */
	int	siztfork;	/* VM pages affected by __tfork() */
	int	sizkthread;	/* VM pages affected by kernel threads */
@


1.13
log
@remove rfork(); ok guenther miod
@
text
@d1 1
a1 1
/*	$OpenBSD: vmmeter.h,v 1.12 2003/06/02 23:28:22 millert Exp $	*/
d62 1
a62 1
 * Fork/vfork/rfork accounting.
d67 1
a67 1
	int	cnttfork;	/* number of rfork() calls */
d71 1
a71 1
	int	siztfork;	/* VM pages affected by rfork() */
@


1.12
log
@Remove the advertising clause in the UCB license which Berkeley
rescinded 22 July 1999.  Proofed by myself and Theo.
@
text
@d1 1
a1 1
/*	$OpenBSD: vmmeter.h,v 1.11 2001/06/27 04:51:49 art Exp $	*/
d44 1
a44 2
struct vmtotal
{
d64 1
a64 2
struct  forkstat
{
d67 1
a67 1
	int	cntrfork;	/* number of rfork() calls */
d71 1
a71 1
	int	sizrfork;	/* VM pages affected by rfork() */
d78 1
a78 1
#define KERN_FORKSTAT_RFORK		3
d82 1
a82 1
#define KERN_FORKSTAT_SIZRFORK		7
d90 1
a90 1
	{ "rforks", CTLTYPE_INT }, \
d94 1
a94 1
	{ "rfork_pages", CTLTYPE_INT }, \
@


1.11
log
@kill old vm
@
text
@d1 1
a1 1
/*	$OpenBSD: vmmeter.h,v 1.10 2001/05/11 06:36:59 angelos Exp $	*/
d16 1
a16 5
 * 3. All advertising materials mentioning features or use of this software
 *    must display the following acknowledgement:
 *	This product includes software developed by the University of
 *	California, Berkeley and its contributors.
 * 4. Neither the name of the University nor the names of its contributors
@


1.10
log
@sysctl entries for kmemstats, nselcoll, nchstats, and forkstat.
@
text
@d1 1
a1 1
/*	$OpenBSD: vmmeter.h,v 1.9 2000/06/18 17:59:55 niklas Exp $	*/
a45 51
#if !defined(UVM)
struct vmmeter {
	/*
	 * General system activity.
	 */
	u_int v_swtch;		/* context switches */
	u_int v_trap;		/* calls to trap */
	u_int v_syscall;	/* calls to syscall() */
	u_int v_intr;		/* device interrupts */
	u_int v_soft;		/* software interrupts */
	u_int v_faults;		/* total faults taken */
	/*
	 * Virtual memory activity.
	 */
	u_int v_lookups;	/* object cache lookups */
	u_int v_hits;		/* object cache hits */
	u_int v_vm_faults;	/* number of address memory faults */
	u_int v_cow_faults;	/* number of copy-on-writes */
	u_int v_swpin;		/* swapins */
	u_int v_swpout;		/* swapouts */
	u_int v_pswpin;		/* pages swapped in */
	u_int v_pswpout;	/* pages swapped out */
	u_int v_pageins;	/* number of pageins */
	u_int v_pageouts;	/* number of pageouts */
	u_int v_pgpgin;		/* pages paged in */
	u_int v_pgpgout;	/* pages paged out */
	u_int v_intrans;	/* intransit blocking page faults */
	u_int v_reactivated;	/* number of pages reactivated from free list */
	u_int v_rev;		/* revolutions of the hand */
	u_int v_scan;		/* scans in page out daemon */
	u_int v_dfree;		/* pages freed by daemon */
	u_int v_pfree;		/* pages freed by exiting processes */
	u_int v_zfod;		/* pages zero filled on demand */
	u_int v_nzfod;		/* number of zfod's created */
	/*
	 * Distribution of page usages.
	 */
	u_int v_page_size;	/* page size in bytes */
	u_int v_kernel_pages;	/* number of pages in use by kernel */
	u_int v_free_target;	/* number of pages desired free */
	u_int v_free_min;	/* minimum number of pages desired free */
	u_int v_free_count;	/* number of pages free */
	u_int v_wire_count;	/* number of pages wired down */
	u_int v_active_count;	/* number of pages active */
	u_int v_inactive_target; /* number of pages desired inactive */
	u_int v_inactive_count;  /* number of pages inactive */
};
#ifdef _KERNEL
struct	vmmeter cnt;
#endif
#endif
@


1.9
log
@Mark kernel threads as system processes.  Make ps hide them by default,
show them with -k.  Do not try to show RSS based values for them as they
mess up column alignment.  vmstat -f now shows kernel threads separately
from rforks too.
@
text
@d1 1
a1 1
/*	$OpenBSD: vmmeter.h,v 1.8 2000/02/21 20:00:08 art Exp $	*/
d132 22
@


1.8
log
@dead code and symbol pollution.
@
text
@d1 1
a1 1
/*	$OpenBSD: vmmeter.h,v 1.6 1999/02/26 02:47:02 art Exp $	*/
d125 1
d129 1
@


1.7
log
@zap unused polluting variable.
@
text
@a129 42
#ifdef _KERNEL
struct forkstat forkstat;
#endif

/*
 * Optional instrumentation.
 */
#ifdef PGINPROF

#define	NDMON	128
#define	NSMON	128

#define	DRES	20
#define	SRES	5

#define	PMONMIN	20
#define	PRES	50
#define	NPMON	64

#define	RMONMIN	130
#define	RRES	5
#define	NRMON	64

/* data and stack size distribution counters */
u_int	dmon[NDMON+1];
u_int	smon[NSMON+1];

/* page in time distribution counters */
u_int	pmon[NPMON+2];

/* reclaim time distribution counters */
u_int	rmon[NRMON+2];

int	pmonmin;
int	pres;
int	rmonmin;
int	rres;

u_int rectime;		/* accumulator for reclaim times */
u_int pgintime;		/* accumulator for page in times */
#endif

@


1.6
log
@uvm doesn't use struct vmmeter
@
text
@d1 1
a1 1
/*	$OpenBSD: vmmeter.h,v 1.5 1997/11/09 22:12:22 millert Exp $	*/
a115 3
#ifdef _KERNEL
struct	vmtotal total;
#endif
@


1.6.6.1
log
@sync with -current
@
text
@d1 1
a1 1
/*	$OpenBSD: vmmeter.h,v 1.8 2000/02/21 20:00:08 art Exp $	*/
d116 3
d132 42
@


1.6.6.2
log
@merge in approximately 2.9 into SMP branch
@
text
@d1 1
a1 1
/*	$OpenBSD: vmmeter.h,v 1.9 2000/06/18 17:59:55 niklas Exp $	*/
a124 1
	int	cntkthread;	/* number of kernel threads created */
a127 1
	int	sizkthread;	/* VM pages affected by kernel threads */
@


1.6.6.3
log
@Merge in -current from two days ago in the SMP branch.
As usual with merges, they do not indicate progress, so do not hold
your breath for working SMP, and do not mail me and ask about the
state of it.  It has not changed.  There is work ongoing, but very, very
slowly.  The commit is done in parts as to not lock up the tree in too
big chunks at a time.
@
text
@d1 1
a1 1
/*	$OpenBSD: vmmeter.h,v 1.6.6.2 2001/05/14 22:45:05 niklas Exp $	*/
d46 51
a131 22
/* These sysctl names are only really used by sysctl(8) */
#define KERN_FORKSTAT_FORK		1
#define KERN_FORKSTAT_VFORK		2
#define KERN_FORKSTAT_RFORK		3
#define KERN_FORKSTAT_KTHREAD		4
#define KERN_FORKSTAT_SIZFORK		5
#define KERN_FORKSTAT_SIZVFORK		6
#define KERN_FORKSTAT_SIZRFORK		7
#define KERN_FORKSTAT_SIZKTHREAD	8
#define KERN_FORKSTAT_MAXID		9

#define CTL_KERN_FORKSTAT_NAMES { \
	{ 0, 0 }, \
	{ "forks", CTLTYPE_INT }, \
	{ "vforks", CTLTYPE_INT }, \
	{ "rforks", CTLTYPE_INT }, \
	{ "kthreads", CTLTYPE_INT }, \
	{ "fork_pages", CTLTYPE_INT }, \
	{ "vfork_pages", CTLTYPE_INT }, \
	{ "rfork_pages", CTLTYPE_INT }, \
	{ "kthread_pages", CTLTYPE_INT }, \
}
@


1.6.6.4
log
@Sync SMP branch to -current
@
text
@d1 1
a1 1
/*	$OpenBSD: vmmeter.h,v 1.6.6.3 2001/07/04 11:00:38 niklas Exp $	*/
d16 5
a20 1
 * 3. Neither the name of the University nor the names of its contributors
@


1.5
log
@Make contents of struct vmtotal unsigned.
@
text
@d1 1
a1 1
/*	$OpenBSD: vmmeter.h,v 1.4 1996/07/07 18:06:43 mickey Exp $	*/
d43 2
a44 1
 * System wide statistics counters.
d46 1
d95 1
@


1.4
log
@do multi-include protection.
@
text
@d1 1
a1 1
/*	$OpenBSD: vmmeter.h,v 1.3 1996/03/03 12:12:47 niklas Exp $	*/
d98 14
a111 14
	int16_t	t_rq;		/* length of the run queue */
	int16_t	t_dw;		/* jobs in ``disk wait'' (neg priority) */
	int16_t	t_pw;		/* jobs in page wait */
	int16_t	t_sl;		/* jobs sleeping in core */
	int16_t	t_sw;		/* swapped out runnable/short block jobs */
	int32_t	t_vm;		/* total virtual memory */
	int32_t	t_avm;		/* active virtual memory */
	int32_t	t_rm;		/* total real memory in use */
	int32_t	t_arm;		/* active real memory */
	int32_t	t_vmshr;	/* shared virtual memory */
	int32_t	t_avmshr;	/* active shared virtual memory */
	int32_t	t_rmshr;	/* shared real memory */
	int32_t	t_armshr;	/* active shared real memory */
	int32_t	t_free;		/* free memory pages */
@


1.3
log
@From NetBSD: 960217 merge
@
text
@d1 1
a1 1
/*	$OpenBSD$	*/
d39 3
d171 2
@


1.2
log
@Add support for fork accounting
@
text
@d1 1
@


1.1
log
@Initial revision
@
text
@d114 17
@


1.1.1.1
log
@initial import of NetBSD tree
@
text
@@
