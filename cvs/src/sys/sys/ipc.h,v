head	1.13;
access;
symbols
	OPENBSD_6_2:1.13.0.14
	OPENBSD_6_2_BASE:1.13
	OPENBSD_6_1:1.13.0.12
	OPENBSD_6_1_BASE:1.13
	OPENBSD_6_0:1.13.0.8
	OPENBSD_6_0_BASE:1.13
	OPENBSD_5_9:1.13.0.4
	OPENBSD_5_9_BASE:1.13
	OPENBSD_5_8:1.13.0.6
	OPENBSD_5_8_BASE:1.13
	OPENBSD_5_7:1.13.0.2
	OPENBSD_5_7_BASE:1.13
	OPENBSD_5_6:1.12.0.4
	OPENBSD_5_6_BASE:1.12
	OPENBSD_5_5:1.11.0.16
	OPENBSD_5_5_BASE:1.11
	OPENBSD_5_4:1.11.0.12
	OPENBSD_5_4_BASE:1.11
	OPENBSD_5_3:1.11.0.10
	OPENBSD_5_3_BASE:1.11
	OPENBSD_5_2:1.11.0.8
	OPENBSD_5_2_BASE:1.11
	OPENBSD_5_1_BASE:1.11
	OPENBSD_5_1:1.11.0.6
	OPENBSD_5_0:1.11.0.4
	OPENBSD_5_0_BASE:1.11
	OPENBSD_4_9:1.11.0.2
	OPENBSD_4_9_BASE:1.11
	OPENBSD_4_8:1.10.0.26
	OPENBSD_4_8_BASE:1.10
	OPENBSD_4_7:1.10.0.22
	OPENBSD_4_7_BASE:1.10
	OPENBSD_4_6:1.10.0.24
	OPENBSD_4_6_BASE:1.10
	OPENBSD_4_5:1.10.0.20
	OPENBSD_4_5_BASE:1.10
	OPENBSD_4_4:1.10.0.18
	OPENBSD_4_4_BASE:1.10
	OPENBSD_4_3:1.10.0.16
	OPENBSD_4_3_BASE:1.10
	OPENBSD_4_2:1.10.0.14
	OPENBSD_4_2_BASE:1.10
	OPENBSD_4_1:1.10.0.12
	OPENBSD_4_1_BASE:1.10
	OPENBSD_4_0:1.10.0.10
	OPENBSD_4_0_BASE:1.10
	OPENBSD_3_9:1.10.0.8
	OPENBSD_3_9_BASE:1.10
	OPENBSD_3_8:1.10.0.6
	OPENBSD_3_8_BASE:1.10
	OPENBSD_3_7:1.10.0.4
	OPENBSD_3_7_BASE:1.10
	OPENBSD_3_6:1.10.0.2
	OPENBSD_3_6_BASE:1.10
	SMP_SYNC_A:1.8
	SMP_SYNC_B:1.8
	OPENBSD_3_5:1.8.0.4
	OPENBSD_3_5_BASE:1.8
	OPENBSD_3_4:1.8.0.2
	OPENBSD_3_4_BASE:1.8
	UBC_SYNC_A:1.7
	OPENBSD_3_3:1.7.0.6
	OPENBSD_3_3_BASE:1.7
	OPENBSD_3_2:1.7.0.4
	OPENBSD_3_2_BASE:1.7
	OPENBSD_3_1:1.7.0.2
	OPENBSD_3_1_BASE:1.7
	UBC_SYNC_B:1.7
	UBC:1.6.0.16
	UBC_BASE:1.6
	OPENBSD_3_0:1.6.0.14
	OPENBSD_3_0_BASE:1.6
	OPENBSD_2_9_BASE:1.6
	OPENBSD_2_9:1.6.0.12
	OPENBSD_2_8:1.6.0.10
	OPENBSD_2_8_BASE:1.6
	OPENBSD_2_7:1.6.0.8
	OPENBSD_2_7_BASE:1.6
	SMP:1.6.0.6
	SMP_BASE:1.6
	kame_19991208:1.6
	OPENBSD_2_6:1.6.0.4
	OPENBSD_2_6_BASE:1.6
	OPENBSD_2_5:1.6.0.2
	OPENBSD_2_5_BASE:1.6
	OPENBSD_2_4:1.5.0.2
	OPENBSD_2_4_BASE:1.5
	OPENBSD_2_3:1.2.0.8
	OPENBSD_2_3_BASE:1.2
	OPENBSD_2_2:1.2.0.6
	OPENBSD_2_2_BASE:1.2
	OPENBSD_2_1:1.2.0.4
	OPENBSD_2_1_BASE:1.2
	OPENBSD_2_0:1.2.0.2
	OPENBSD_2_0_BASE:1.2
	netbsd_1_1:1.1.1.1;
locks; strict;
comment	@ * @;


1.13
date	2014.11.15.21.42.50;	author guenther;	state Exp;
branches;
next	1.12;
commitid	PknjUPMLkwQsXjbp;

1.12
date	2014.07.10.14.16.49;	author deraadt;	state Exp;
branches;
next	1.11;
commitid	wdPDDnCznDbPTDLl;

1.11
date	2011.01.03.23.08.07;	author guenther;	state Exp;
branches;
next	1.10;

1.10
date	2004.07.15.11.24.46;	author millert;	state Exp;
branches;
next	1.9;

1.9
date	2004.07.14.23.45.11;	author millert;	state Exp;
branches;
next	1.8;

1.8
date	2003.06.02.23.28.21;	author millert;	state Exp;
branches;
next	1.7;

1.7
date	2002.03.14.01.27.14;	author millert;	state Exp;
branches;
next	1.6;

1.6
date	98.11.15.19.19.53;	author deraadt;	state Exp;
branches
	1.6.6.1
	1.6.16.1;
next	1.5;

1.5
date	98.06.11.21.13.21;	author deraadt;	state Exp;
branches;
next	1.4;

1.4
date	98.06.11.19.21.27;	author deraadt;	state Exp;
branches;
next	1.3;

1.3
date	98.06.11.18.32.19;	author deraadt;	state Exp;
branches;
next	1.2;

1.2
date	96.03.03.12.11.52;	author niklas;	state Exp;
branches;
next	1.1;

1.1
date	95.10.18.08.53.27;	author deraadt;	state Exp;
branches
	1.1.1.1;
next	;

1.1.1.1
date	95.10.18.08.53.27;	author deraadt;	state Exp;
branches;
next	;

1.6.6.1
date	2002.03.28.14.52.01;	author niklas;	state Exp;
branches;
next	1.6.6.2;

1.6.6.2
date	2003.06.07.11.09.07;	author ho;	state Exp;
branches;
next	;

1.6.16.1
date	2002.06.11.03.32.33;	author art;	state Exp;
branches;
next	;


desc
@@


1.13
log
@Pull in sys/types.h for the necessary typedefs

prodded by brad@@, ok deraadt@@
@
text
@/*	$OpenBSD: ipc.h,v 1.12 2014/07/10 14:16:49 deraadt Exp $	*/
/*	$NetBSD: ipc.h,v 1.15 1996/02/09 18:25:12 christos Exp $	*/

/*
 * Copyright (c) 1988 University of Utah.
 * Copyright (c) 1990, 1993
 *	The Regents of the University of California.  All rights reserved.
 * (c) UNIX System Laboratories, Inc.
 * All or some portions of this file are derived from material licensed
 * to the University of California by American Telephone and Telegraph
 * Co. or Unix System Laboratories, Inc. and are reproduced herein with
 * the permission of UNIX System Laboratories, Inc.
 *
 * This code is derived from software contributed to Berkeley by
 * the Systems Programming Group of the University of Utah Computer
 * Science Department.
 *
 * Redistribution and use in source and binary forms, with or without
 * modification, are permitted provided that the following conditions
 * are met:
 * 1. Redistributions of source code must retain the above copyright
 *    notice, this list of conditions and the following disclaimer.
 * 2. Redistributions in binary form must reproduce the above copyright
 *    notice, this list of conditions and the following disclaimer in the
 *    documentation and/or other materials provided with the distribution.
 * 3. Neither the name of the University nor the names of its contributors
 *    may be used to endorse or promote products derived from this software
 *    without specific prior written permission.
 *
 * THIS SOFTWARE IS PROVIDED BY THE REGENTS AND CONTRIBUTORS ``AS IS'' AND
 * ANY EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT LIMITED TO, THE
 * IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE
 * ARE DISCLAIMED.  IN NO EVENT SHALL THE REGENTS OR CONTRIBUTORS BE LIABLE
 * FOR ANY DIRECT, INDIRECT, INCIDENTAL, SPECIAL, EXEMPLARY, OR CONSEQUENTIAL
 * DAMAGES (INCLUDING, BUT NOT LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS
 * OR SERVICES; LOSS OF USE, DATA, OR PROFITS; OR BUSINESS INTERRUPTION)
 * HOWEVER CAUSED AND ON ANY THEORY OF LIABILITY, WHETHER IN CONTRACT, STRICT
 * LIABILITY, OR TORT (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY
 * OUT OF THE USE OF THIS SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF
 * SUCH DAMAGE.
 *
 *	@@(#)ipc.h	8.3 (Berkeley) 1/21/94
 */

/*
 * SVID compatible ipc.h file
 */
#ifndef _SYS_IPC_H_
#define _SYS_IPC_H_

#include <sys/types.h>

struct ipc_perm {
	uid_t		cuid;	/* creator user id */
	gid_t		cgid;	/* creator group id */
	uid_t		uid;	/* user id */
	gid_t		gid;	/* group id */
	mode_t		mode;	/* r/w permission */
	unsigned short	seq;	/* sequence # (to generate unique msg/sem/shm id) */
	key_t		key;	/* user specified msg/sem/shm key */
};

/* common mode bits */
#define	IPC_R		000400	/* read permission */
#define	IPC_W		000200	/* write/alter permission */
#define	IPC_M		010000	/* permission to change control info */

/* SVID required constants (same values as system 5) */
#define	IPC_CREAT	001000	/* create entry if key does not exist */
#define	IPC_EXCL	002000	/* fail if key exists */
#define	IPC_NOWAIT	004000	/* error if request must wait */

#define	IPC_PRIVATE	(key_t)0 /* private key */

#define	IPC_RMID	0	/* remove identifier */
#define	IPC_SET		1	/* set options */
#define	IPC_STAT	2	/* get options */

#ifdef _KERNEL
/* Macros to convert between ipc ids and array indices or sequence ids */
#define	IPCID_TO_IX(id)		((id) & 0xffff)
#define	IPCID_TO_SEQ(id)	(((id) >> 16) & 0xffff)
#define	IXSEQ_TO_IPCID(ix,perm)	(((perm.seq) << 16) | (ix & 0xffff))

struct ucred;

int ipcperm(struct ucred *, struct ipc_perm *, int);

#else /* !_KERNEL */

__BEGIN_DECLS
key_t	ftok(const char *, int);
__END_DECLS
#endif
#endif /* !_SYS_IPC_H_ */
@


1.12
log
@struct proc; and struct ucred; only needed for ipcs in kernel-grovel mode
behind #define _KERNEL (it is what it is)
@
text
@d1 1
a1 1
/*	$OpenBSD: ipc.h,v 1.11 2011/01/03 23:08:07 guenther Exp $	*/
d51 2
a89 2

#include <sys/cdefs.h>
@


1.11
log
@Remove the old COMPAT_23 SysV IPC structures and the never implemented
semconfig() declaration.  Move the COMPAT_35 SysV IPC structures into
the only source files that uses them

ok millert@@, kettenis@@, deraadt@@
@
text
@d1 1
a1 1
/*	$OpenBSD: ipc.h,v 1.10 2004/07/15 11:24:46 millert Exp $	*/
d82 2
@


1.10
log
@Rename structs oipc_perm, omsqid_ds, osemid_ds, oshmid_ds to ipc_perm23,
etc to avoid confusion and for consistency with the *35 ones.
Remove *n2o functions that don't belong outside of compat.
@
text
@d1 1
a1 1
/*	$OpenBSD: ipc.h,v 1.9 2004/07/14 23:45:11 millert Exp $	*/
a59 22

#ifdef _KERNEL
struct ipc_perm23 {
	unsigned short	cuid;	/* creator user id */
	unsigned short	cgid;	/* creator group id */
	unsigned short	uid;	/* user id */
	unsigned short	gid;	/* group id */
	unsigned short	mode;	/* r/w permission */
	unsigned short	seq;	/* sequence # (to generate unique msg/sem/shm id) */
	key_t		key;	/* user specified msg/sem/shm key */
};

struct ipc_perm35 {
	uid_t		cuid;	/* creator user id */
	gid_t		cgid;	/* creator group id */
	uid_t		uid;	/* user id */
	gid_t		gid;	/* group id */
	u_int16_t	mode;	/* r/w permission */
	unsigned short	seq;	/* sequence # (to generate unique msg/sem/shm id) */
	key_t		key;	/* user specified msg/sem/shm key */
};
#endif
@


1.9
log
@Because mode_t is used in struct ipc_perm we need new versions of
the msgctl, semctl, and shmctl system calls.  This moves the old
versions to COMPAT_35 and adds new ones.

WARNING: While this fixes things like shared memory in the X server
for old (pre-mode_t change) binaries, it will break binaries that
use shared memory built between the time of the mode_t change (Jul
13th) and now.  If you rebuild X during that interval you will need
to do it again after updating the rest of userland.
@
text
@d1 1
a1 1
/*	$OpenBSD: ipc.h,v 1.8 2003/06/02 23:28:21 millert Exp $	*/
d62 1
a62 1
struct oipc_perm {
a105 3
void ipc_n2o(struct ipc_perm *, struct oipc_perm *);
void ipc_o2n(struct oipc_perm *, struct ipc_perm *);
#endif /* _KERNEL */
d107 2
a108 1
#ifndef _KERNEL
@


1.8
log
@Remove the advertising clause in the UCB license which Berkeley
rescinded 22 July 1999.  Proofed by myself and Theo.
@
text
@d1 1
a1 1
/*	$OpenBSD: ipc.h,v 1.7 2002/03/14 01:27:14 millert Exp $	*/
d68 10
@


1.7
log
@First round of __P removal in sys
@
text
@d1 1
a1 1
/*	$OpenBSD: ipc.h,v 1.6 1998/11/15 19:19:53 deraadt Exp $	*/
d26 1
a26 5
 * 3. All advertising materials mentioning features or use of this software
 *    must display the following acknowledgement:
 *	This product includes software developed by the University of
 *	California, Berkeley and its contributors.
 * 4. Neither the name of the University nor the names of its contributors
@


1.6
log
@ftok() takes int id; xpg
@
text
@d1 1
a1 1
/*	$OpenBSD: ipc.h,v 1.5 1998/06/11 21:13:21 deraadt Exp $	*/
d99 3
a101 3
int ipcperm __P((struct ucred *, struct ipc_perm *, int));
void ipc_n2o __P((struct ipc_perm *, struct oipc_perm *));
void ipc_o2n __P((struct oipc_perm *, struct ipc_perm *));
d108 1
a108 1
key_t	ftok __P((const char *, int));
@


1.6.16.1
log
@Sync UBC branch to -current
@
text
@d1 1
a1 1
/*	$OpenBSD: ipc.h,v 1.6 1998/11/15 19:19:53 deraadt Exp $	*/
d99 3
a101 3
int ipcperm(struct ucred *, struct ipc_perm *, int);
void ipc_n2o(struct ipc_perm *, struct oipc_perm *);
void ipc_o2n(struct oipc_perm *, struct ipc_perm *);
d108 1
a108 1
key_t	ftok(const char *, int);
@


1.6.6.1
log
@Merge in -current from roughly a week ago
@
text
@d1 1
a1 1
/*	$OpenBSD$	*/
d99 3
a101 3
int ipcperm(struct ucred *, struct ipc_perm *, int);
void ipc_n2o(struct ipc_perm *, struct oipc_perm *);
void ipc_o2n(struct oipc_perm *, struct ipc_perm *);
d108 1
a108 1
key_t	ftok(const char *, int);
@


1.6.6.2
log
@Sync SMP branch to -current
@
text
@d1 1
a1 1
/*	$OpenBSD: ipc.h,v 1.6.6.1 2002/03/28 14:52:01 niklas Exp $	*/
d26 5
a30 1
 * 3. Neither the name of the University nor the names of its contributors
@


1.5
log
@kill ushort
@
text
@d1 1
a1 1
/*	$OpenBSD: ipc.h,v 1.4 1998/06/11 19:21:27 deraadt Exp $	*/
d108 1
a108 1
key_t	ftok __P((const char *, char));
@


1.4
log
@do not export old structures to userland
@
text
@d1 1
a1 1
/*	$OpenBSD: ipc.h,v 1.3 1998/06/11 18:32:19 deraadt Exp $	*/
d56 7
a62 7
	uid_t	cuid;	/* creator user id */
	gid_t	cgid;	/* creator group id */
	uid_t	uid;	/* user id */
	gid_t	gid;	/* group id */
	mode_t	mode;	/* r/w permission */
	ushort	seq;	/* sequence # (to generate unique msg/sem/shm id) */
	key_t	key;	/* user specified msg/sem/shm key */
d67 7
a73 7
	ushort	cuid;	/* creator user id */
	ushort	cgid;	/* creator group id */
	ushort	uid;	/* user id */
	ushort	gid;	/* group id */
	ushort	mode;	/* r/w permission */
	ushort	seq;	/* sequence # (to generate unique msg/sem/shm id) */
	key_t	key;	/* user specified msg/sem/shm key */
@


1.3
log
@change ipc.h to use uid_t and friends, and then build compat system calls for the old ushort based ipc.h
@
text
@d1 1
a1 1
/*	$OpenBSD: ipc.h,v 1.2 1996/03/03 12:11:52 niklas Exp $	*/
d65 1
d75 1
@


1.2
log
@From NetBSD: 960217 merge
@
text
@d1 1
a1 1
/*	$OpenBSD$	*/
d56 10
d98 2
@


1.1
log
@Initial revision
@
text
@d1 2
a2 1
/*	$NetBSD: ipc.h,v 1.14 1995/03/26 20:24:17 jtc Exp $	*/
d86 2
@


1.1.1.1
log
@initial import of NetBSD tree
@
text
@@
