head	1.15;
access;
symbols
	OPENBSD_6_2:1.15.0.8
	OPENBSD_6_2_BASE:1.15
	OPENBSD_6_1:1.15.0.6
	OPENBSD_6_1_BASE:1.15
	OPENBSD_6_0:1.15.0.2
	OPENBSD_6_0_BASE:1.15
	OPENBSD_5_9:1.14.0.2
	OPENBSD_5_9_BASE:1.14
	OPENBSD_5_8:1.14.0.4
	OPENBSD_5_8_BASE:1.14
	OPENBSD_5_7:1.13.0.4
	OPENBSD_5_7_BASE:1.13
	OPENBSD_5_6:1.13.0.8
	OPENBSD_5_6_BASE:1.13
	OPENBSD_5_5:1.13.0.6
	OPENBSD_5_5_BASE:1.13
	OPENBSD_5_4:1.13.0.2
	OPENBSD_5_4_BASE:1.13
	OPENBSD_5_3:1.11.0.38
	OPENBSD_5_3_BASE:1.11
	OPENBSD_5_2:1.11.0.36
	OPENBSD_5_2_BASE:1.11
	OPENBSD_5_1_BASE:1.11
	OPENBSD_5_1:1.11.0.34
	OPENBSD_5_0:1.11.0.32
	OPENBSD_5_0_BASE:1.11
	OPENBSD_4_9:1.11.0.30
	OPENBSD_4_9_BASE:1.11
	OPENBSD_4_8:1.11.0.28
	OPENBSD_4_8_BASE:1.11
	OPENBSD_4_7:1.11.0.24
	OPENBSD_4_7_BASE:1.11
	OPENBSD_4_6:1.11.0.26
	OPENBSD_4_6_BASE:1.11
	OPENBSD_4_5:1.11.0.22
	OPENBSD_4_5_BASE:1.11
	OPENBSD_4_4:1.11.0.20
	OPENBSD_4_4_BASE:1.11
	OPENBSD_4_3:1.11.0.18
	OPENBSD_4_3_BASE:1.11
	OPENBSD_4_2:1.11.0.16
	OPENBSD_4_2_BASE:1.11
	OPENBSD_4_1:1.11.0.14
	OPENBSD_4_1_BASE:1.11
	OPENBSD_4_0:1.11.0.12
	OPENBSD_4_0_BASE:1.11
	OPENBSD_3_9:1.11.0.10
	OPENBSD_3_9_BASE:1.11
	OPENBSD_3_8:1.11.0.8
	OPENBSD_3_8_BASE:1.11
	OPENBSD_3_7:1.11.0.6
	OPENBSD_3_7_BASE:1.11
	OPENBSD_3_6:1.11.0.4
	OPENBSD_3_6_BASE:1.11
	SMP_SYNC_A:1.11
	SMP_SYNC_B:1.11
	OPENBSD_3_5:1.11.0.2
	OPENBSD_3_5_BASE:1.11
	OPENBSD_3_4:1.10.0.2
	OPENBSD_3_4_BASE:1.10
	UBC_SYNC_A:1.9
	OPENBSD_3_3:1.8.0.4
	OPENBSD_3_3_BASE:1.8
	OPENBSD_3_2:1.8.0.2
	OPENBSD_3_2_BASE:1.8
	OPENBSD_3_1:1.7.0.2
	OPENBSD_3_1_BASE:1.7
	UBC_SYNC_B:1.8
	UBC:1.6.0.4
	UBC_BASE:1.6
	OPENBSD_3_0:1.6.0.2
	OPENBSD_3_0_BASE:1.6
	OPENBSD_2_9_BASE:1.5
	OPENBSD_2_9:1.5.0.2
	OPENBSD_2_8:1.4.0.12
	OPENBSD_2_8_BASE:1.4
	OPENBSD_2_7:1.4.0.10
	OPENBSD_2_7_BASE:1.4
	SMP:1.4.0.8
	SMP_BASE:1.4
	kame_19991208:1.4
	OPENBSD_2_6:1.4.0.6
	OPENBSD_2_6_BASE:1.4
	OPENBSD_2_5:1.4.0.4
	OPENBSD_2_5_BASE:1.4
	OPENBSD_2_4:1.4.0.2
	OPENBSD_2_4_BASE:1.4
	OPENBSD_2_3:1.2.0.4
	OPENBSD_2_3_BASE:1.2
	OPENBSD_2_2:1.2.0.2
	OPENBSD_2_2_BASE:1.2
	OPENBSD_2_1:1.1.0.4
	OPENBSD_2_1_BASE:1.1
	OPENBSD_2_0:1.1.0.2
	OPENBSD_2_0_BASE:1.1;
locks; strict;
comment	@ * @;


1.15
date	2016.06.07.06.12.37;	author deraadt;	state Exp;
branches;
next	1.14;
commitid	3b5aikHetmWeZowP;

1.14
date	2015.05.10.22.35.38;	author millert;	state Exp;
branches;
next	1.13;
commitid	rtX5Mpzd4CgHtDmM;

1.13
date	2013.04.29.18.35.07;	author guenther;	state Exp;
branches;
next	1.12;

1.12
date	2013.04.29.17.06.20;	author matthew;	state Exp;
branches;
next	1.11;

1.11
date	2003.12.10.23.10.08;	author millert;	state Exp;
branches;
next	1.10;

1.10
date	2003.06.02.04.04.54;	author deraadt;	state Exp;
branches;
next	1.9;

1.9
date	2003.04.25.22.13.06;	author tedu;	state Exp;
branches;
next	1.8;

1.8
date	2002.09.13.01.36.07;	author naddy;	state Exp;
branches;
next	1.7;

1.7
date	2002.03.14.01.27.14;	author millert;	state Exp;
branches;
next	1.6;

1.6
date	2001.08.11.08.13.18;	author fgsch;	state Exp;
branches
	1.6.4.1;
next	1.5;

1.5
date	2001.03.01.01.32.50;	author deraadt;	state Exp;
branches;
next	1.4;

1.4
date	98.08.12.17.34.29;	author deraadt;	state Exp;
branches
	1.4.8.1;
next	1.3;

1.3
date	98.08.11.21.18.19;	author deraadt;	state Exp;
branches;
next	1.2;

1.2
date	97.07.11.22.24.31;	author provos;	state Exp;
branches;
next	1.1;

1.1
date	96.05.18.08.53.08;	author deraadt;	state Exp;
branches;
next	;

1.4.8.1
date	2001.05.14.22.45.03;	author niklas;	state Exp;
branches;
next	1.4.8.2;

1.4.8.2
date	2001.10.31.03.30.30;	author nate;	state Exp;
branches;
next	1.4.8.3;

1.4.8.3
date	2002.03.28.14.52.01;	author niklas;	state Exp;
branches;
next	1.4.8.4;

1.4.8.4
date	2003.03.28.00.41.30;	author niklas;	state Exp;
branches;
next	1.4.8.5;

1.4.8.5
date	2003.05.13.19.36.57;	author ho;	state Exp;
branches;
next	1.4.8.6;

1.4.8.6
date	2003.06.07.11.09.07;	author ho;	state Exp;
branches;
next	1.4.8.7;

1.4.8.7
date	2004.02.19.11.01.33;	author niklas;	state Exp;
branches;
next	;

1.6.4.1
date	2002.06.11.03.32.33;	author art;	state Exp;
branches;
next	1.6.4.2;

1.6.4.2
date	2002.10.29.00.36.49;	author art;	state Exp;
branches;
next	1.6.4.3;

1.6.4.3
date	2003.05.19.22.32.19;	author tedu;	state Exp;
branches;
next	;


desc
@@


1.15
log
@ktrace support for pollfd[] arrays
ok guenther
@
text
@/*	$OpenBSD: poll.h,v 1.14 2015/05/10 22:35:38 millert Exp $ */

/*
 * Copyright (c) 1996 Theo de Raadt
 * All rights reserved.
 *
 * Redistribution and use in source and binary forms, with or without
 * modification, are permitted provided that the following conditions
 * are met:
 * 1. Redistributions of source code must retain the above copyright
 *    notice, this list of conditions and the following disclaimer.
 * 2. Redistributions in binary form must reproduce the above copyright
 *    notice, this list of conditions and the following disclaimer in the
 *    documentation and/or other materials provided with the distribution.
 *
 * THIS SOFTWARE IS PROVIDED BY THE AUTHOR ``AS IS'' AND ANY EXPRESS OR
 * IMPLIED WARRANTIES, INCLUDING, BUT NOT LIMITED TO, THE IMPLIED WARRANTIES
 * OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE ARE DISCLAIMED.
 * IN NO EVENT SHALL THE AUTHOR BE LIABLE FOR ANY DIRECT, INDIRECT,
 * INCIDENTAL, SPECIAL, EXEMPLARY, OR CONSEQUENTIAL DAMAGES (INCLUDING, BUT
 * NOT LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES; LOSS OF USE,
 * DATA, OR PROFITS; OR BUSINESS INTERRUPTION) HOWEVER CAUSED AND ON ANY
 * THEORY OF LIABILITY, WHETHER IN CONTRACT, STRICT LIABILITY, OR TORT
 * (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE USE OF
 * THIS SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.
 */

#ifndef	_SYS_POLL_H_
#define	_SYS_POLL_H_

typedef struct pollfd {
	int 	fd;
	short	events;
	short	revents;
} pollfd_t;

typedef unsigned int	nfds_t;

#define	POLLIN		0x0001
#define	POLLPRI		0x0002
#define	POLLOUT		0x0004
#define	POLLERR		0x0008
#define	POLLHUP		0x0010
#define	POLLNVAL	0x0020
#define	POLLRDNORM	0x0040
#define POLLNORM	POLLRDNORM
#define POLLWRNORM      POLLOUT
#define	POLLRDBAND	0x0080
#define	POLLWRBAND	0x0100
#ifdef _KERNEL
#define	POLL_NOHUP	0x1000		/* internal use only */
#endif

#define INFTIM		(-1)

#ifndef _KERNEL
#include <sys/cdefs.h>

#if __BSD_VISIBLE
#include <sys/_types.h>

#ifndef _SIGSET_T_DEFINED_
#define _SIGSET_T_DEFINED_
typedef unsigned int	sigset_t;
#endif

#ifndef _TIME_T_DEFINED_
#define _TIME_T_DEFINED_
typedef __time_t	time_t;
#endif

#ifndef _TIMESPEC_DECLARED
#define _TIMESPEC_DECLARED
struct timespec {
	time_t	tv_sec;		/* seconds */
	long	tv_nsec;	/* and nanoseconds */
};
#endif
#endif /* __BSD_VISIBLE */

__BEGIN_DECLS
int   poll(struct pollfd[], nfds_t, int);
#if __BSD_VISIBLE
int   ppoll(struct pollfd[], nfds_t, const struct timespec *, const sigset_t *);
#endif /* __BSD_VISIBLE */
__END_DECLS
#endif /* _KERNEL */

#endif /* !_SYS_POLL_H_ */
@


1.14
log
@Set POLLHUP even if no valid events were specified as per POSIX.
Since we use the poll backend for select(2), care must be taken not
to set the fd's bit in writefds in this case.  A kernel-only flag,
POLLNOHUP, is used by selscan() to tell the poll backend not to
return POLLHUP on EOF.  This is currently only used by fifo_poll().
The fifofs regress now passes.  OK guenther@@
@
text
@d1 1
a1 1
/*	$OpenBSD: poll.h,v 1.13 2013/04/29 18:35:07 guenther Exp $ */
d51 1
a51 1
#define	POLLNOHUP	0x1000		/* internal use only */
@


1.13
log
@Tweak previous: test __BSD_VISIBLE with #if, not #ifdef

ok matthew@@
@
text
@d1 1
a1 1
/*	$OpenBSD: poll.h,v 1.12 2013/04/29 17:06:20 matthew Exp $ */
d50 3
@


1.12
log
@Extend P_SIGSUSPEND handling in userret() to properly restore the
sigmask even if there are no pending signals under the temporary
sigmask.

Refactor existing select() and poll() system calls to introduce the
pselect() and ppoll() system calls.

Add rthread wrappers for pselect() and ppoll().  While there, update
cancellation point comments to reflect recent fdatasync() addition.

Minor bumps for libc and librthread due to new symbols.

ok guenther, millert, deraadt, jmc
@
text
@d1 1
a1 1
/*	$OpenBSD: poll.h,v 1.11 2003/12/10 23:10:08 millert Exp $ */
d56 1
a56 1
#ifdef __BSD_VISIBLE
d80 1
a80 1
#ifdef __BSD_VISIBLE
@


1.11
log
@Add an nfds_t type as per POSIX and also add pollfd_t like Solaris has.
@
text
@d1 1
a1 1
/*	$OpenBSD: poll.h,v 1.10 2003/06/02 04:04:54 deraadt Exp $ */
d54 23
a76 1
#include <ctype.h>
d80 3
@


1.10
log
@remove terms 3 and 4 of some of my licences
@
text
@d1 1
a1 1
/*	$OpenBSD: poll.h,v 1.9 2003/04/25 22:13:06 tedu Exp $ */
d31 1
a31 1
struct pollfd {
d35 3
a37 1
};
d57 1
a57 1
int   poll(struct pollfd[], int, int);
@


1.9
log
@#define POLLNORM as synonym for POLLRDNORM.  ok millert@@
@
text
@d1 1
a1 1
/*	$OpenBSD: poll.h,v 1.8 2002/09/13 01:36:07 naddy Exp $ */
a14 2
 * 3. The name of the author may not be used to endorse or promote products
 *    derived from this software without specific prior written permission.
@


1.8
log
@allow inclusion from C++; ok deraadt@@
@
text
@d1 1
a1 1
/*	$OpenBSD: poll.h,v 1.7 2002/03/14 01:27:14 millert Exp $ */
d46 1
@


1.7
log
@First round of __P removal in sys
@
text
@d1 1
a1 1
/*	$OpenBSD: poll.h,v 1.6 2001/08/11 08:13:18 fgsch Exp $ */
d55 1
d57 1
@


1.6
log
@Define INFTIM to -1, as appears everywhere. Talk about it in the
manpage; millert@@ ok.
@
text
@d1 1
a1 1
/*	$OpenBSD: poll.h,v 1.5 2001/03/01 01:32:50 deraadt Exp $ */
d55 1
a55 1
int   poll __P((struct pollfd[], int, int));
@


1.6.4.1
log
@Sync UBC branch to -current
@
text
@d1 1
a1 1
/*	$OpenBSD: poll.h,v 1.6 2001/08/11 08:13:18 fgsch Exp $ */
d55 1
a55 1
int   poll(struct pollfd[], int, int);
@


1.6.4.2
log
@sync to -current
@
text
@d1 1
a1 1
/*	$OpenBSD: poll.h,v 1.6.4.1 2002/06/11 03:32:33 art Exp $ */
a54 1
__BEGIN_DECLS
a55 1
__END_DECLS
@


1.6.4.3
log
@sync
@
text
@d1 1
a1 1
/*	$OpenBSD$ */
a45 1
#define POLLNORM	POLLRDNORM
@


1.5
log
@pull in ctype.h, since <poll.h> and <sys/poll.h> have to be useable alone; problem noted by bk@@rt.fm
@
text
@d1 1
a1 1
/*	$OpenBSD: poll.h,v 1.4 1998/08/12 17:34:29 deraadt Exp $ */
d49 2
@


1.4
log
@poll proto only for userland
@
text
@d1 1
a1 1
/*	$OpenBSD: poll.h,v 1.3 1998/08/11 21:18:19 deraadt Exp $ */
d51 2
@


1.4.8.1
log
@merge in approximately 2.9 into SMP branch
@
text
@d1 1
a1 1
/*	$OpenBSD: poll.h,v 1.5 2001/03/01 01:32:50 deraadt Exp $ */
a50 2
#include <ctype.h>

@


1.4.8.2
log
@Sync the SMP branch to something just after 3.0
@
text
@d1 1
a1 1
/*	$OpenBSD: poll.h,v 1.4.8.1 2001/05/14 22:45:03 niklas Exp $ */
a48 2

#define INFTIM		(-1)
@


1.4.8.3
log
@Merge in -current from roughly a week ago
@
text
@d1 1
a1 1
/*	$OpenBSD$ */
d55 1
a55 1
int   poll(struct pollfd[], int, int);
@


1.4.8.4
log
@Sync the SMP branch with 3.3
@
text
@a54 1
__BEGIN_DECLS
a55 1
__END_DECLS
@


1.4.8.5
log
@Sync the SMP branch to -current. This includes moving to ELF.
@
text
@d1 1
a1 1
/*	$OpenBSD: poll.h,v 1.4.8.4 2003/03/28 00:41:30 niklas Exp $ */
a45 1
#define POLLNORM	POLLRDNORM
@


1.4.8.6
log
@Sync SMP branch to -current
@
text
@d1 1
a1 1
/*	$OpenBSD: poll.h,v 1.4.8.5 2003/05/13 19:36:57 ho Exp $ */
d15 2
@


1.4.8.7
log
@Merge of current from two weeks agointo the SMP branch
@
text
@d1 1
a1 1
/*	$OpenBSD$ */
d31 1
a31 1
typedef struct pollfd {
d35 1
a35 3
} pollfd_t;

typedef unsigned int	nfds_t;
d55 1
a55 1
int   poll(struct pollfd[], nfds_t, int);
@


1.3
log
@poll() proto
@
text
@d1 1
a1 1
/*	$OpenBSD: poll.h,v 1.2 1997/07/11 22:24:31 provos Exp $ */
d50 1
d52 1
@


1.2
log
@cosmetic changes; netbsd
@
text
@d1 1
a1 1
/*	$OpenBSD$ */
d49 2
@


1.1
log
@poll() as a system call
@
text
@d46 1
@
