head	1.5;
access;
symbols
	OPENBSD_6_0:1.5.0.8
	OPENBSD_6_0_BASE:1.5
	OPENBSD_5_9:1.5.0.4
	OPENBSD_5_9_BASE:1.5
	OPENBSD_5_8:1.5.0.6
	OPENBSD_5_8_BASE:1.5
	OPENBSD_5_7:1.5.0.2
	OPENBSD_5_7_BASE:1.5
	OPENBSD_5_6:1.4.0.22
	OPENBSD_5_6_BASE:1.4
	OPENBSD_5_5:1.4.0.20
	OPENBSD_5_5_BASE:1.4
	OPENBSD_5_4:1.4.0.16
	OPENBSD_5_4_BASE:1.4
	OPENBSD_5_3:1.4.0.14
	OPENBSD_5_3_BASE:1.4
	OPENBSD_5_2:1.4.0.12
	OPENBSD_5_2_BASE:1.4
	OPENBSD_5_1_BASE:1.4
	OPENBSD_5_1:1.4.0.10
	OPENBSD_5_0:1.4.0.8
	OPENBSD_5_0_BASE:1.4
	OPENBSD_4_9:1.4.0.6
	OPENBSD_4_9_BASE:1.4
	OPENBSD_4_8:1.4.0.4
	OPENBSD_4_8_BASE:1.4
	OPENBSD_4_7:1.4.0.2
	OPENBSD_4_7_BASE:1.4
	OPENBSD_4_6:1.3.0.4
	OPENBSD_4_6_BASE:1.3
	OPENBSD_4_5:1.2.0.2
	OPENBSD_4_5_BASE:1.2;
locks; strict;
comment	@ * @;


1.5
date	2015.01.25.21.42.13;	author kettenis;	state Exp;
branches;
next	1.4;
commitid	ZoO3iubG0jt8mq0g;

1.4
date	2009.12.14.16.06.35;	author kettenis;	state Exp;
branches;
next	1.3;

1.3
date	2009.05.10.12.48.24;	author kettenis;	state Exp;
branches;
next	1.2;

1.2
date	2009.01.01.23.24.59;	author kettenis;	state Exp;
branches;
next	1.1;

1.1
date	2008.12.30.21.34.07;	author kettenis;	state Exp;
branches;
next	;


desc
@@


1.5
log
@Rework cbus(4) interrupt support a bit.  Instead of merging devhandle and
devino into a pseudo-sysino, directly use the devino as the ihandle.  The
devhandle is stored in the cbus softc, and accessed through the bus space
tag.  This allows us to have more than 256 interrupts on a single cbus, and
avoids relying on the lower bits of the devhandle being zero.
@
text
@/*	$OpenBSD: cbusvar.h,v 1.4 2009/12/14 16:06:35 kettenis Exp $	*/
/*
 * Copyright (c) 2008 Mark Kettenis
 *
 * Permission to use, copy, modify, and distribute this software for any
 * purpose with or without fee is hereby granted, provided that the above
 * copyright notice and this permission notice appear in all copies.
 *
 * THE SOFTWARE IS PROVIDED "AS IS" AND THE AUTHOR DISCLAIMS ALL WARRANTIES
 * WITH REGARD TO THIS SOFTWARE INCLUDING ALL IMPLIED WARRANTIES OF
 * MERCHANTABILITY AND FITNESS. IN NO EVENT SHALL THE AUTHOR BE LIABLE FOR
 * ANY SPECIAL, DIRECT, INDIRECT, OR CONSEQUENTIAL DAMAGES OR ANY DAMAGES
 * WHATSOEVER RESULTING FROM LOSS OF USE, DATA OR PROFITS, WHETHER IN AN
 * ACTION OF CONTRACT, NEGLIGENCE OR OTHER TORTIOUS ACTION, ARISING OUT OF
 * OR IN CONNECTION WITH THE USE OR PERFORMANCE OF THIS SOFTWARE.
 */

#ifndef _SPARC64_DEV_CBUSVAR_H_
#define _SPARC64_DEV_CBUSVAR_H_

struct cbus_attach_args {
	const char	*ca_name;
	int		ca_node;
	int		ca_idx;

	bus_space_tag_t	ca_bustag;
	bus_dma_tag_t	ca_dmatag;

	u_int32_t	*ca_reg;
	int		ca_nreg;

	u_int64_t	ca_id;
	u_int64_t	ca_tx_ino;
	u_int64_t	ca_rx_ino;
};

int	cbus_print(void *, const char *);
int	cbus_intr_setstate(bus_space_tag_t, uint64_t, uint64_t);
int	cbus_intr_setenabled(bus_space_tag_t, uint64_t, uint64_t);

#endif
@


1.4
log
@Add wrapper functions to enable/disable interrupts and manipulate their state.
@
text
@d1 1
a1 1
/*	$OpenBSD: cbusvar.h,v 1.3 2009/05/10 12:48:24 kettenis Exp $	*/
d38 2
a39 3
int	cbus_intr_map(int, int, uint64_t *);
int	cbus_intr_setstate(uint64_t, uint64_t);
int	cbus_intr_setenabled(uint64_t, uint64_t);
@


1.3
log
@Handle devices with multiple ports.
@
text
@d1 1
a1 1
/*	$OpenBSD: cbusvar.h,v 1.2 2009/01/01 23:24:59 kettenis Exp $	*/
d39 2
@


1.2
log
@Add code to handle virtual interrupt for channel devices.
@
text
@d1 1
a1 1
/*	$OpenBSD: cbusvar.h,v 1.1 2008/12/30 21:34:07 kettenis Exp $	*/
d22 1
a22 1
	char		*ca_name;
d24 1
d37 2
a38 1
int cbus_intr_map(int, int, uint64_t *);
@


1.1
log
@Add cbus(4), a virtual bus for devices that use logical domain channels as
found on sun4v systems with multiple domains configured.
@
text
@d1 1
a1 1
/*	$OpenBSD$	*/
d35 2
@

