head	1.36;
access;
symbols
	OPENBSD_6_1_BASE:1.36
	OPENBSD_6_0:1.35.0.10
	OPENBSD_6_0_BASE:1.35
	OPENBSD_5_9:1.35.0.6
	OPENBSD_5_9_BASE:1.35
	OPENBSD_5_8:1.35.0.8
	OPENBSD_5_8_BASE:1.35
	OPENBSD_5_7:1.35.0.2
	OPENBSD_5_7_BASE:1.35
	OPENBSD_5_6:1.35.0.4
	OPENBSD_5_6_BASE:1.35
	OPENBSD_5_5:1.34.0.16
	OPENBSD_5_5_BASE:1.34
	OPENBSD_5_4:1.34.0.12
	OPENBSD_5_4_BASE:1.34
	OPENBSD_5_3:1.34.0.10
	OPENBSD_5_3_BASE:1.34
	OPENBSD_5_2:1.34.0.8
	OPENBSD_5_2_BASE:1.34
	OPENBSD_5_1_BASE:1.34
	OPENBSD_5_1:1.34.0.6
	OPENBSD_5_0:1.34.0.4
	OPENBSD_5_0_BASE:1.34
	OPENBSD_4_9:1.34.0.2
	OPENBSD_4_9_BASE:1.34
	OPENBSD_4_8:1.33.0.8
	OPENBSD_4_8_BASE:1.33
	OPENBSD_4_7:1.33.0.4
	OPENBSD_4_7_BASE:1.33
	OPENBSD_4_6:1.33.0.6
	OPENBSD_4_6_BASE:1.33
	OPENBSD_4_5:1.33.0.2
	OPENBSD_4_5_BASE:1.33
	OPENBSD_4_4:1.32.0.2
	OPENBSD_4_4_BASE:1.32
	OPENBSD_4_3:1.26.0.2
	OPENBSD_4_3_BASE:1.26
	OPENBSD_4_2:1.16.0.2
	OPENBSD_4_2_BASE:1.16
	OPENBSD_4_1:1.14.0.8
	OPENBSD_4_1_BASE:1.14
	OPENBSD_4_0:1.14.0.6
	OPENBSD_4_0_BASE:1.14
	OPENBSD_3_9:1.14.0.4
	OPENBSD_3_9_BASE:1.14
	OPENBSD_3_8:1.14.0.2
	OPENBSD_3_8_BASE:1.14
	OPENBSD_3_7:1.13.0.2
	OPENBSD_3_7_BASE:1.13
	OPENBSD_3_6:1.12.0.2
	OPENBSD_3_6_BASE:1.12
	SMP_SYNC_A:1.9
	SMP_SYNC_B:1.9
	OPENBSD_3_5:1.9.0.2
	OPENBSD_3_5_BASE:1.9
	OPENBSD_3_4:1.8.0.2
	OPENBSD_3_4_BASE:1.8
	UBC_SYNC_A:1.6
	OPENBSD_3_3:1.6.0.2
	OPENBSD_3_3_BASE:1.6
	OPENBSD_3_2:1.5.0.4
	OPENBSD_3_2_BASE:1.5
	OPENBSD_3_1:1.5.0.2
	OPENBSD_3_1_BASE:1.5
	UBC_SYNC_B:1.5
	UBC:1.4.0.6
	UBC_BASE:1.4
	SMP:1.4.0.4
	OPENBSD_3_0:1.4.0.2
	OPENBSD_3_0_BASE:1.4;
locks; strict;
comment	@# @;


1.36
date	2016.10.08.05.42.38;	author guenther;	state Exp;
branches;
next	1.35;
commitid	zppWqGalk1e6Rb6C;

1.35
date	2014.04.03.09.15.06;	author mpi;	state Exp;
branches;
next	1.34;

1.34
date	2010.09.28.20.27.55;	author miod;	state Exp;
branches;
next	1.33;

1.33
date	2008.08.07.18.46.04;	author kettenis;	state Exp;
branches;
next	1.32;

1.32
date	2008.06.26.05.42.13;	author ray;	state Exp;
branches;
next	1.31;

1.31
date	2008.04.20.09.18.52;	author kettenis;	state Exp;
branches;
next	1.30;

1.30
date	2008.03.30.12.30.01;	author kettenis;	state Exp;
branches;
next	1.29;

1.29
date	2008.03.23.21.49.48;	author kettenis;	state Exp;
branches;
next	1.28;

1.28
date	2008.03.22.21.10.29;	author kettenis;	state Exp;
branches;
next	1.27;

1.27
date	2008.03.12.20.52.36;	author kettenis;	state Exp;
branches;
next	1.26;

1.26
date	2008.02.14.19.07.56;	author kettenis;	state Exp;
branches;
next	1.25;

1.25
date	2008.01.16.20.55.36;	author kettenis;	state Exp;
branches;
next	1.24;

1.24
date	2007.11.13.13.50.10;	author kettenis;	state Exp;
branches;
next	1.23;

1.23
date	2007.10.16.21.44.25;	author kettenis;	state Exp;
branches;
next	1.22;

1.22
date	2007.09.30.21.34.20;	author kettenis;	state Exp;
branches;
next	1.21;

1.21
date	2007.09.09.14.59.37;	author kettenis;	state Exp;
branches;
next	1.20;

1.20
date	2007.09.09.10.17.33;	author kettenis;	state Exp;
branches;
next	1.19;

1.19
date	2007.09.09.08.55.27;	author kettenis;	state Exp;
branches;
next	1.18;

1.18
date	2007.09.08.17.13.18;	author kettenis;	state Exp;
branches;
next	1.17;

1.17
date	2007.08.25.22.09.03;	author kettenis;	state Exp;
branches;
next	1.16;

1.16
date	2007.05.28.23.10.10;	author beck;	state Exp;
branches;
next	1.15;

1.15
date	2007.05.14.21.38.08;	author kettenis;	state Exp;
branches;
next	1.14;

1.14
date	2005.03.29.19.34.07;	author kettenis;	state Exp;
branches;
next	1.13;

1.13
date	2004.12.01.14.31.25;	author miod;	state Exp;
branches;
next	1.12;

1.12
date	2004.06.28.01.47.41;	author aaron;	state Exp;
branches;
next	1.11;

1.11
date	2004.06.23.00.52.54;	author aaron;	state Exp;
branches;
next	1.10;

1.10
date	2004.06.13.21.49.21;	author niklas;	state Exp;
branches;
next	1.9;

1.9
date	2004.01.07.07.59.20;	author pvalchev;	state Exp;
branches;
next	1.8;

1.8
date	2003.06.02.23.27.56;	author millert;	state Exp;
branches;
next	1.7;

1.7
date	2003.05.17.19.30.55;	author art;	state Exp;
branches;
next	1.6;

1.6
date	2003.03.20.23.05.30;	author henric;	state Exp;
branches;
next	1.5;

1.5
date	2002.01.16.20.50.17;	author miod;	state Exp;
branches;
next	1.4;

1.4
date	2001.09.18.15.05.47;	author drahn;	state Exp;
branches
	1.4.4.1
	1.4.6.1;
next	1.3;

1.3
date	2001.09.16.14.28.04;	author miod;	state Exp;
branches;
next	1.2;

1.2
date	2001.09.06.10.45.41;	author art;	state Exp;
branches;
next	1.1;

1.1
date	2001.08.19.05.21.37;	author jason;	state Exp;
branches;
next	;

1.4.4.1
date	2001.10.31.03.07.59;	author nate;	state Exp;
branches;
next	1.4.4.2;

1.4.4.2
date	2002.03.06.02.04.47;	author niklas;	state Exp;
branches;
next	1.4.4.3;

1.4.4.3
date	2003.03.27.23.42.37;	author niklas;	state Exp;
branches;
next	1.4.4.4;

1.4.4.4
date	2003.06.07.11.14.45;	author ho;	state Exp;
branches;
next	1.4.4.5;

1.4.4.5
date	2004.02.19.10.50.00;	author niklas;	state Exp;
branches;
next	1.4.4.6;

1.4.4.6
date	2004.06.07.01.00.12;	author tedu;	state Exp;
branches;
next	;

1.4.6.1
date	2002.01.31.22.55.24;	author niklas;	state Exp;
branches;
next	1.4.6.2;

1.4.6.2
date	2003.05.19.21.46.57;	author tedu;	state Exp;
branches;
next	;


desc
@@


1.36
log
@p_wchan and p_pid aren't used from asm (anymore?)
@
text
@#	$OpenBSD: genassym.cf,v 1.35 2014/04/03 09:15:06 mpi Exp $
#	$NetBSD: genassym.cf,v 1.23 2001/08/08 00:09:30 eeh Exp $

#
# Copyright (c) 1997 The NetBSD Foundation, Inc.
# All rights reserved.
#
# This code is derived from software contributed to The NetBSD Foundation
# by Christos Zoulas.
#
# Redistribution and use in source and binary forms, with or without
# modification, are permitted provided that the following conditions
# are met:
# 1. Redistributions of source code must retain the above copyright
#    notice, this list of conditions and the following disclaimer.
# 2. Redistributions in binary form must reproduce the above copyright
#    notice, this list of conditions and the following disclaimer in the
#    documentation and/or other materials provided with the distribution.
#
# THIS SOFTWARE IS PROVIDED BY THE NETBSD FOUNDATION, INC. AND CONTRIBUTORS
# ``AS IS'' AND ANY EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT LIMITED
# TO, THE IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR
# PURPOSE ARE DISCLAIMED.  IN NO EVENT SHALL THE FOUNDATION OR CONTRIBUTORS
# BE LIABLE FOR ANY DIRECT, INDIRECT, INCIDENTAL, SPECIAL, EXEMPLARY, OR
# CONSEQUENTIAL DAMAGES (INCLUDING, BUT NOT LIMITED TO, PROCUREMENT OF
# SUBSTITUTE GOODS OR SERVICES; LOSS OF USE, DATA, OR PROFITS; OR BUSINESS
# INTERRUPTION) HOWEVER CAUSED AND ON ANY THEORY OF LIABILITY, WHETHER IN
# CONTRACT, STRICT LIABILITY, OR TORT (INCLUDING NEGLIGENCE OR OTHERWISE)
# ARISING IN ANY WAY OUT OF THE USE OF THIS SOFTWARE, EVEN IF ADVISED OF THE
# POSSIBILITY OF SUCH DAMAGE.
#
# Copyright (c) 1992, 1993
#	The Regents of the University of California.  All rights reserved.
#
# This software was developed by the Computer Systems Engineering group
# at Lawrence Berkeley Laboratory under DARPA contract BG 91-66 and
# contributed to Berkeley.
#
# All advertising materials mentioning features or use of this software
# must display the following acknowledgement:
#	This product includes software developed by the University of
#	California, Lawrence Berkeley Laboratory.
#
# Redistribution and use in source and binary forms, with or without
# modification, are permitted provided that the following conditions
# are met:
# 1. Redistributions of source code must retain the above copyright
#    notice, this list of conditions and the following disclaimer.
# 2. Redistributions in binary form must reproduce the above copyright
#    notice, this list of conditions and the following disclaimer in the
#    documentation and/or other materials provided with the distribution.
# 3. Neither the name of the University nor the names of its contributors
#    may be used to endorse or promote products derived from this software
#    without specific prior written permission.
#
# THIS SOFTWARE IS PROVIDED BY THE REGENTS AND CONTRIBUTORS ``AS IS'' AND
# ANY EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT LIMITED TO, THE
# IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE
# ARE DISCLAIMED.  IN NO EVENT SHALL THE REGENTS OR CONTRIBUTORS BE LIABLE
# FOR ANY DIRECT, INDIRECT, INCIDENTAL, SPECIAL, EXEMPLARY, OR CONSEQUENTIAL
# DAMAGES (INCLUDING, BUT NOT LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS
# OR SERVICES; LOSS OF USE, DATA, OR PROFITS; OR BUSINESS INTERRUPTION)
# HOWEVER CAUSED AND ON ANY THEORY OF LIABILITY, WHETHER IN CONTRACT, STRICT
# LIABILITY, OR TORT (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY
# OUT OF THE USE OF THIS SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF
# SUCH DAMAGE.
#
#	@@(#)genassym.c	8.1 (Berkeley) 6/11/93
#

include <sys/param.h>
include <sys/buf.h>
include <sys/proc.h>
include <sys/mbuf.h>
include <sys/msgbuf.h>
include <sys/syscall.h>
include <sys/user.h>
include <sys/device.h>
include <sys/disklabel.h>
include <sys/disk.h>

include <uvm/uvm_extern.h>

ifdef DDB
include <machine/db_machdep.h>
endif
include <machine/pmap.h>
include <machine/cpu.h>
include <machine/mutex.h>

include <machine/reg.h>

ifdef notyet
include <sparc64/dev/zsreg.h>
include <sparc64/dev/zsvar.h>
endif

ifdef notyet
include <dev/ic/am7930reg.h>
include <dev/ic/am7930var.h>
endif

# proc fields and values
struct	proc
member	p_addr
member	p_stat
member	p_vmspace
member	p_cpu
member	P_FPSTATE	p_md.md_fpstate
member	P_MD_ASTPENDING	p_md.md_astpending

export	SRUN
export	SONPROC

# user structure fields
define	USIZ		sizeof(struct user)

# VM structure fields
define	VM_PMAP		offsetof(struct vmspace, vm_map.pmap)

# pmap structure fields
struct	pmap
member	pm_ctx
member	pm_segs
member	PM_PHYS		pm_physaddr

# interrupt/fault metering
struct	uvmexp		V_
member	swtch
member	INTR		intrs
member	faults

# CPU info structure
struct	cpu_info
member	ci_self
member	ci_curproc
member	ci_cpcb
member	ci_next
member	ci_fpproc
member	ci_number
member	ci_upaid
member	ci_want_resched
member	ci_handled_intr_level
member	ci_intrpending
member	ci_tickintr
member	ci_spinup
member	ci_initstack
member	ci_paddr
ifdef SUN4V
member	ci_rw
member	ci_rwsp
member	ci_mmfsa
member	ci_cpumq
member	ci_devmq
endif
ifdef DIAGNOSTIC
member	ci_mutex_level
endif

# FPU state
struct	fpstate64
member	fs_regs
member	fs_fsr
member	fs_gsr
member	fs_qsize
member	fs_queue
define	FS_SIZE		sizeof(struct fpstate64)
export	FSR_QNE
export	FPRS_FEF
export	FPRS_DU
export	FPRS_DL

# system calls
export	SYS_sigreturn
export	SYS_execve
export	SYS_exit

# errno
export	EFAULT
export	ENAMETOOLONG

# PCB fields
struct	pcb
member	pcb_nsaved
member	pcb_onfault
member	pcb_pstate
member	pcb_cwp
member	pcb_pil
member	pcb_rw
member	pcb_rwsp
member	pcb_sp
member	pcb_wcookie
member	pcb_pc
member	PCB_LASTCALL	lastcall
define	PCB_SIZE	sizeof(struct pcb)

# trapframe64 fields
struct	trapframe64
member	tf_tstate
member	tf_pc
member	tf_npc
member	tf_fault
member	tf_kstack
member	tf_y
member	tf_pil
member	tf_oldpil
member	tf_tt
member	tf_global
member	tf_out
member	tf_local
member	tf_in
# shortened versions
member	TF_G		tf_global
member	TF_O		tf_out
member	TF_L		tf_local
member	TF_I		tf_in
define	TF_SIZE		sizeof(struct trapframe64)

ifdef notyet
# clockframe fields 
struct	clockframe	CF_
member	tstate
member	pc
member	npc
member	pil
member	oldpil
member	fp
endif

# interrupt handler fields
struct	intrhand
member	ih_fun
member	ih_arg
member	ih_number
member	ih_pil
member	IH_PEND		ih_pending
member	ih_next
member	ih_ack
member	IH_COUNT	ih_count.ec_count

# mbuf fields of import
struct	mbuf
member	m_next
member	m_data
member	m_len

ifdef notyet
# db_regs structure so we can save all registers
struct	db_regs
member	dbr_traps
member	dbr_y
member	dbr_tl
member	dbr_canrestore
member	dbr_cansave
member	dbr_cleanwin
member	dbr_cwp
member	dbr_wstate
member	dbr_g
member	dbr_ag
member	dbr_ig
member	dbr_mg
member	dbr_out
member	dbr_local
member	dbr_in
endif

export	TSB_TAG_LOCKED

export	SUN4U_TLB_ACCESS
export	SUN4U_TLB_MODIFY
export	SUN4U_TLB_REAL_W
export	SUN4U_TLB_EXEC
export	SUN4U_TLB_W

export	SUN4V_TLB_ACCESS
export	SUN4V_TLB_MODIFY
export	SUN4V_TLB_REAL_W
export	SUN4V_TLB_EXEC
export	SUN4V_TLB_W

struct	mutex
member	mtx_wantipl
member	mtx_oldipl
member	mtx_owner

export	CPU_SUN4U
export	CPU_SUN4V
@


1.35
log
@Use <uvm/uvm_extern.h> if it's enough.
@
text
@d1 1
a1 1
#	$OpenBSD: genassym.cf,v 1.34 2010/09/28 20:27:55 miod Exp $
a106 1
member	p_wchan
a107 1
member	p_pid
@


1.34
log
@Implement a per-cpu held mutex counter if DIAGNOSTIC on all non-x86 platforms,
to complete matthew@@'s commit of a few days ago, and drop __HAVE_CPU_MUTEX_LEVEL
define. With help from, and ok deraadt@@.
@
text
@d1 1
a1 1
#	$OpenBSD: genassym.cf,v 1.33 2008/08/07 18:46:04 kettenis Exp $
d82 1
a82 1
include <uvm/uvm.h>
a121 3

# UVM structure fields
define	UVM_PAGE_IDLE_ZERO	offsetof(struct uvm, page_idle_zero)
@


1.33
log
@Give each CPU its own `struct intrhand' for %tick interrupts.  Fixes a
problem where the clock would stop ticking on some CPUs because of lost
ticks.
@
text
@d1 1
a1 1
#	$OpenBSD: genassym.cf,v 1.32 2008/06/26 05:42:13 ray Exp $
d160 3
@


1.32
log
@First pass at removing clauses 3 and 4 from NetBSD licenses.

Not sure what's more surprising: how long it took for NetBSD to
catch up to the rest of the BSDs (including UCB), or the amount of
code that NetBSD has claimed for itself without attributing to the
actual authors.

OK deraadt@@
@
text
@d1 1
a1 1
#	$OpenBSD: genassym.cf,v 1.31 2008/04/20 09:18:52 kettenis Exp $
d150 1
@


1.31
log
@Implement locking of sun4u TSB entries for MULTIPROCESSOR kernels.
Make sun4v code use the new TSB_TAG_LOCKED define.
@
text
@d1 1
a1 1
#	$OpenBSD: genassym.cf,v 1.30 2008/03/30 12:30:01 kettenis Exp $
a18 7
# 3. All advertising materials mentioning features or use of this software
#    must display the following acknowledgement:
#        This product includes software developed by the NetBSD
#        Foundation, Inc. and its contributors.
# 4. Neither the name of The NetBSD Foundation nor the names of its
#    contributors may be used to endorse or promote products derived
#    from this software without specific prior written permission.
@


1.30
log
@More sun4v support.  GENERIC and RAMDISK kernels will now boot on both
sun4u and sun4v.  GENERIC.MP won't work yet though.
@
text
@d1 1
a1 1
#	$OpenBSD: genassym.cf,v 1.29 2008/03/23 21:49:48 kettenis Exp $
d274 2
@


1.29
log
@Sigh!  The sun4v TTEs have a different layout than sun4u TTEs.  Rename the
existing sun4u defines and add sun4v.  For now, decide which set to use
at compile time.  Change the sun4u-specific code in locore.s to use the sun4u
defines.
@
text
@d1 1
a1 1
#	$OpenBSD: genassym.cf,v 1.28 2008/03/22 21:10:29 kettenis Exp $
d160 7
d280 6
@


1.28
log
@Reintroduce the cputyp variable, and use it to distinguish between sun4u and
sun4v.
@
text
@d1 1
a1 1
#	$OpenBSD: genassym.cf,v 1.27 2008/03/12 20:52:36 kettenis Exp $
d268 5
a272 14
export	TLB_ACCESS
export	TLB_MODIFY
export	TLB_REAL_W
export	TLB_TSB_LOCK
export	TLB_EXEC
export	TLB_EXEC_ONLY
export	TLB_L
export	TLB_CACHE_MASK
export	TLB_CP
export	TLB_CV
export	TLB_E
export	TLB_P
export	TLB_W
export	TLB_G
@


1.27
log
@Introduce a per-handler interrupt acknowledgement function.
@
text
@d1 1
a1 1
#	$OpenBSD: genassym.cf,v 1.26 2008/02/14 19:07:56 kettenis Exp $
d287 3
@


1.26
log
@Make sure an interrupt handler does not get on the per-cpu list of pending
interrupts twice, with one exception: interrupt handlers are allowed to be on
the tail of said lists (needed for clock interrupts on MP kernels).
Prevents losing interrupts.  Makes usb keyboard as console work on Sun Blade
1000/2000 with MP kernels.
@
text
@d1 1
a1 1
#	$OpenBSD: genassym.cf,v 1.25 2008/01/16 20:55:36 kettenis Exp $
d239 1
a239 2
member	ih_map
member	ih_clr
d241 1
a241 1
	
@


1.25
log
@Simplify spilling register windows into the pcb by storing the stack pointer
seperately from the window and copying out data back to the stack by using the
T_RWRET softtrap and rwindow_save().
@
text
@d1 1
a1 1
#	$OpenBSD: genassym.cf,v 1.24 2007/11/13 13:50:10 kettenis Exp $
a236 1
member	ih_busy
@


1.24
log
@Remove bsd_openprom.h.
@
text
@d1 1
a1 1
#	$OpenBSD: genassym.cf,v 1.23 2007/10/16 21:44:25 kettenis Exp $
d191 1
@


1.23
log
@For MULTIPROCESSOR kernels, make cpu_switchto() set p->p_cpu.
@
text
@d1 1
a1 1
#	$OpenBSD: genassym.cf,v 1.22 2007/09/30 21:34:20 kettenis Exp $
a97 1
include <machine/bsd_openprom.h>
@


1.22
log
@Move intrpending array into 'struct cpu_info'.
@
text
@d1 1
a1 1
#	$OpenBSD: genassym.cf,v 1.21 2007/09/09 14:59:37 kettenis Exp $
d118 1
@


1.21
log
@Add a few missing bits to include/cpu.h required for MULTIPROCESSOR kernels.
@
text
@d1 1
a1 1
#	$OpenBSD: genassym.cf,v 1.20 2007/09/09 10:17:33 kettenis Exp $
d156 1
@


1.20
log
@Remove some more goo left over from sparc.
@
text
@d1 1
a1 1
#	$OpenBSD: genassym.cf,v 1.19 2007/09/09 08:55:27 kettenis Exp $
d147 1
@


1.19
log
@Make handled_intr_level per-cpu.
@
text
@d1 1
a1 1
#	$OpenBSD: genassym.cf,v 1.18 2007/09/08 17:13:18 kettenis Exp $
a99 2

#include <sparc64/sparc64/cpuvar.h>
@


1.18
log
@Make the ast on sparc64 per-process instead of global.  Necessary to make
signal delivery more reliable once we go smp (although the code for that
is still missing).

"in principle, this looks good" art@@
@
text
@d1 1
a1 1
#	$OpenBSD: genassym.cf,v 1.17 2007/08/25 22:09:03 kettenis Exp $
d156 1
@


1.17
log
@Real mutexes for sparc64.  Some comments from henric@@ and claudio@@.
Tested by fkr@@, claudio@@, nick@@.
@
text
@d1 1
a1 1
#	$OpenBSD: genassym.cf,v 1.16 2007/05/28 23:10:10 beck Exp $
d121 1
@


1.16
log
@Maintaining a broken compatibility layer for a broken OS is not a productive
activity for anyone. Bye bye COMPAT_NETBSD. ok tedu@@, deraadt@@, and many others
in the hackathon room.
@
text
@d1 1
a1 1
#	$OpenBSD: genassym.cf,v 1.15 2007/05/14 21:38:08 kettenis Exp $
d96 1
d281 5
@


1.15
log
@Move want_resched into struct cpu_info.
@
text
@d1 1
a1 1
#	$OpenBSD: genassym.cf,v 1.14 2005/03/29 19:34:07 kettenis Exp $
a101 4
ifdef COMPAT_NETBSD
include <compat/netbsd/netbsd_syscall.h>
endif

a263 5
endif

ifdef COMPAT_NETBSD
export	NETBSD_SYS___sigreturn14
export	NETBSD_SYS_exit
@


1.14
log
@sparc64 StackGhost.
ok deraadt@@
@
text
@d1 1
a1 1
#	$OpenBSD: genassym.cf,v 1.13 2004/12/01 14:31:25 miod Exp $
d157 1
@


1.13
log
@Remove unused constants.
@
text
@d1 1
a1 1
#	$OpenBSD$
d192 1
@


1.12
log
@Use new event counter API for interrupt counting on sparc64.  deraadt@@ tholo@@
drahn@@ millert@@ ok
@
text
@d1 1
a114 5

# general constants
export	BSD
export	USRSTACK
define	PADDRT		sizeof(paddr_t)
@


1.11
log
@Remove some ifdef notyet symbols for non-existent floppy driver. art@@ ok
@
text
@d244 1
@


1.10
log
@debranch SMP, have fun
@
text
@a114 5
ifdef notyet
include <sparc64/dev/fdreg.h>
include <sparc64/dev/fdvar.h>
endif

a249 13

ifdef notyet
# floppy trap handler fields
struct	fdcio
member	FDC_REG_MSR	fdcio_reg_msr
member	FDC_REG_FIFO	fdcio_reg_fifo
member	FDC_ISTATE	fdcio_istate
member	FDC_STATUS	fdcio_status
member	FDC_NSTAT	fdcio_nstat
member	FDC_DATA	fdcio_data
member	FDC_TC		fdcio_tc
member	FDC_EVCNT	fdcio_intrcnt.ev_count
endif
@


1.9
log
@do not include proc.h twice; ok miod
@
text
@d135 1
@


1.8
log
@Remove the advertising clause in the UCB license which Berkeley
rescinded 22 July 1999.  Proofed by myself and Theo.
@
text
@a79 1
include <sys/proc.h>
@


1.7
log
@No need to duplicate TLB_ defines manually with TTE_ defines.
assym.h can do that for us.

mdw@@ henric@@ ok
@
text
@d58 1
a58 5
# 3. All advertising materials mentioning features or use of this software
#    must display the following acknowledgement:
#	This product includes software developed by the University of
#	California, Berkeley and its contributors.
# 4. Neither the name of the University nor the names of its contributors
@


1.6
log
@The current code tries to use the same field in the interrupt handler as
both a "next" pointer for a singly-linked list and as an in-use flag.
This obviously does not work all that well.  This change adds a separate
ih_busy flag to mark the handler as in-use, leaving ih_pending for use by
the list code.

Testing by *many* (thanks).

ok miod jason
@
text
@d297 15
@


1.5
log
@Don't include <sys/map.h> when you don't need what's in it.
@
text
@d248 1
@


1.4
log
@uvmexp not uwmexp, these changes should be tested...
@
text
@a83 1
include <sys/map.h>
@


1.4.6.1
log
@Merge in -current, builds on i386, otherwise untested
@
text
@d84 1
@


1.4.6.2
log
@sync
@
text
@a247 1
member	ih_busy
@


1.4.4.1
log
@Sync the SMP branch to something just after 3.0
@
text
@@


1.4.4.2
log
@Merge in trunk
@
text
@d84 1
@


1.4.4.3
log
@Sync the SMP branch with 3.3
@
text
@a247 1
member	ih_busy
@


1.4.4.4
log
@Sync SMP branch to -current
@
text
@d58 5
a62 1
# 3. Neither the name of the University nor the names of its contributors
a296 15

export	TLB_ACCESS
export	TLB_MODIFY
export	TLB_REAL_W
export	TLB_TSB_LOCK
export	TLB_EXEC
export	TLB_EXEC_ONLY
export	TLB_L
export	TLB_CACHE_MASK
export	TLB_CP
export	TLB_CV
export	TLB_E
export	TLB_P
export	TLB_W
export	TLB_G
@


1.4.4.5
log
@Merge of current from two weeks agointo the SMP branch
@
text
@d80 1
@


1.4.4.6
log
@p_pstat = SONPROC
@
text
@a134 1
export	SONPROC
@


1.3
log
@Make use of "export", "struct" and "member" keywords to be easier to read
and simpler.
@
text
@d158 1
a158 1
struct	uwmexp		V_
@


1.2
log
@Some glue for COMPAT_NETBSD
@
text
@d127 2
a128 2
define	BSD		BSD
define	USRSTACK	USRSTACK
d132 9
a140 7
define	P_ADDR		offsetof(struct proc, p_addr)
define	P_STAT		offsetof(struct proc, p_stat)
define	P_WCHAN		offsetof(struct proc, p_wchan)
define	P_VMSPACE	offsetof(struct proc, p_vmspace)
define	P_PID		offsetof(struct proc, p_pid)
define	P_FPSTATE	offsetof(struct proc, p_md.md_fpstate)
define	SRUN		SRUN
d152 4
a155 4
define	PM_CTX		offsetof(struct pmap, pm_ctx)
define	PM_SEGS		offsetof(struct pmap, pm_segs)
define	PM_PHYS		offsetof(struct pmap, pm_physaddr)

d158 4
a161 3
define	V_SWTCH		offsetof(struct uvmexp, swtch)
define	V_INTR		offsetof(struct uvmexp, intrs)
define	V_FAULTS	offsetof(struct uvmexp, faults)
d164 10
a173 9
define	CI_CURPROC	offsetof(struct cpu_info, ci_curproc)
define	CI_CPCB		offsetof(struct cpu_info, ci_cpcb)
define	CI_NEXT		offsetof(struct cpu_info, ci_next)
define	CI_FPPROC	offsetof(struct cpu_info, ci_fpproc)
define	CI_NUMBER	offsetof(struct cpu_info, ci_number)
define	CI_UPAID	offsetof(struct cpu_info, ci_upaid)
define	CI_SPINUP	offsetof(struct cpu_info, ci_spinup)
define	CI_INITSTACK	offsetof(struct cpu_info, ci_initstack)
define	CI_PADDR	offsetof(struct cpu_info, ci_paddr)
d176 6
a181 5
define	FS_REGS		offsetof(struct fpstate64, fs_regs)
define	FS_FSR		offsetof(struct fpstate64, fs_fsr)
define	FS_GSR		offsetof(struct fpstate64, fs_gsr)
define	FS_QSIZE	offsetof(struct fpstate64, fs_qsize)
define	FS_QUEUE	offsetof(struct fpstate64, fs_queue)
d183 4
a186 4
define	FSR_QNE		FSR_QNE
define	FPRS_FEF	FPRS_FEF
define	FPRS_DU		FPRS_DU
define	FPRS_DL		FPRS_DL
d189 3
a191 3
define	SYS_sigreturn SYS_sigreturn
define	SYS_execve	SYS_execve
define	SYS_exit	SYS_exit
d194 2
a195 2
define	EFAULT		EFAULT
define	ENAMETOOLONG	ENAMETOOLONG
d198 10
a207 9
define	PCB_NSAVED	offsetof(struct pcb, pcb_nsaved)
define	PCB_ONFAULT	offsetof(struct pcb, pcb_onfault)
define	PCB_PSTATE	offsetof(struct pcb, pcb_pstate)
define	PCB_CWP		offsetof(struct pcb, pcb_cwp)
define	PCB_PIL		offsetof(struct pcb, pcb_pil)
define	PCB_RW		offsetof(struct pcb, pcb_rw)
define	PCB_SP		offsetof(struct pcb, pcb_sp)
define	PCB_PC		offsetof(struct pcb, pcb_pc)
define  PCB_LASTCALL	offsetof(struct pcb, lastcall)
a209 1

d211 14
a224 13
define	TF_TSTATE	offsetof(struct trapframe64, tf_tstate)
define	TF_PC		offsetof(struct trapframe64, tf_pc)
define	TF_NPC		offsetof(struct trapframe64, tf_npc)
define	TF_FAULT	offsetof(struct trapframe64, tf_fault)
define	TF_KSTACK	offsetof(struct trapframe64, tf_kstack)
define	TF_Y		offsetof(struct trapframe64, tf_y)
define	TF_PIL		offsetof(struct trapframe64, tf_pil)
define	TF_OLDPIL	offsetof(struct trapframe64, tf_oldpil)
define	TF_TT		offsetof(struct trapframe64, tf_tt)
define	TF_GLOBAL	offsetof(struct trapframe64, tf_global)
define	TF_OUT		offsetof(struct trapframe64, tf_out)
define	TF_LOCAL	offsetof(struct trapframe64, tf_local)
define	TF_IN		offsetof(struct trapframe64, tf_in)
d226 4
a229 4
define	TF_G		offsetof(struct trapframe64, tf_global)
define	TF_O		offsetof(struct trapframe64, tf_out)
define	TF_L		offsetof(struct trapframe64, tf_local)
define	TF_I		offsetof(struct trapframe64, tf_in)
d234 7
a240 6
define	CF_TSTATE	offsetof(struct clockframe, tstate)
define	CF_PC		offsetof(struct clockframe, pc)
define	CF_NPC		offsetof(struct clockframe, npc)
define	CF_PIL		offsetof(struct clockframe, pil)
define	CF_OLDPIL	offsetof(struct clockframe, oldpil)
define	CF_FP		offsetof(struct clockframe, fp)
d244 9
a252 8
define	IH_FUN		offsetof(struct intrhand, ih_fun)
define	IH_ARG		offsetof(struct intrhand, ih_arg)
define	IH_NUMBER	offsetof(struct intrhand, ih_number)
define	IH_PIL		offsetof(struct intrhand, ih_pil)
define	IH_PEND		offsetof(struct intrhand, ih_pending)
define	IH_NEXT		offsetof(struct intrhand, ih_next)
define	IH_MAP		offsetof(struct intrhand, ih_map)
define	IH_CLR		offsetof(struct intrhand, ih_clr)
d255 4
a258 3
define	M_NEXT		offsetof(struct mbuf, m_next)
define	M_DATA		offsetof(struct mbuf, m_data)
define	M_LEN		offsetof(struct mbuf, m_len)
d262 9
a270 8
define	FDC_REG_MSR	offsetof(struct fdcio, fdcio_reg_msr)
define	FDC_REG_FIFO	offsetof(struct fdcio, fdcio_reg_fifo)
define	FDC_ISTATE	offsetof(struct fdcio, fdcio_istate)
define	FDC_STATUS	offsetof(struct fdcio, fdcio_status)
define	FDC_NSTAT	offsetof(struct fdcio, fdcio_nstat)
define	FDC_DATA	offsetof(struct fdcio, fdcio_data)
define	FDC_TC		offsetof(struct fdcio, fdcio_tc)
define	FDC_EVCNT	offsetof(struct fdcio, fdcio_intrcnt.ev_count)
d275 16
a290 15
define	DBR_TRAPS	offsetof(struct db_regs, dbr_traps)
define	DBR_Y		offsetof(struct db_regs, dbr_y)
define	DBR_TL		offsetof(struct db_regs, dbr_tl)
define	DBR_CANRESTORE	offsetof(struct db_regs, dbr_canrestore)
define	DBR_CANSAVE	offsetof(struct db_regs, dbr_cansave)
define	DBR_CLEANWIN	offsetof(struct db_regs, dbr_cleanwin)
define	DBR_CWP		offsetof(struct db_regs, dbr_cwp)
define	DBR_WSTATE	offsetof(struct db_regs, dbr_wstate)
define	DBR_G		offsetof(struct db_regs, dbr_g)
define	DBR_AG		offsetof(struct db_regs, dbr_ag)
define	DBR_IG		offsetof(struct db_regs, dbr_ig)
define	DBR_MG		offsetof(struct db_regs, dbr_mg)
define	DBR_OUT		offsetof(struct db_regs, dbr_out)
define	DBR_LOCAL	offsetof(struct db_regs, dbr_local)
define	DBR_IN		offsetof(struct db_regs, dbr_in)
d294 2
a295 2
define	NETBSD_SYS___sigreturn14	NETBSD_SYS___sigreturn14
define	NETBSD_SYS_exit			NETBSD_SYS_exit
a296 1

@


1.1
log
@Lot of stuff... Some from NetBSD, some from OpenBSD, minor modifications
@
text
@d107 4
d281 6
@

