head	1.15;
access;
symbols
	OPENBSD_6_1:1.15.0.16
	OPENBSD_6_1_BASE:1.15
	OPENBSD_6_0:1.15.0.12
	OPENBSD_6_0_BASE:1.15
	OPENBSD_5_9:1.15.0.8
	OPENBSD_5_9_BASE:1.15
	OPENBSD_5_8:1.15.0.10
	OPENBSD_5_8_BASE:1.15
	OPENBSD_5_7:1.15.0.2
	OPENBSD_5_7_BASE:1.15
	OPENBSD_5_6:1.15.0.6
	OPENBSD_5_6_BASE:1.15
	OPENBSD_5_5:1.15.0.4
	OPENBSD_5_5_BASE:1.15
	OPENBSD_5_4:1.14.0.14
	OPENBSD_5_4_BASE:1.14
	OPENBSD_5_3:1.14.0.12
	OPENBSD_5_3_BASE:1.14
	OPENBSD_5_2:1.14.0.10
	OPENBSD_5_2_BASE:1.14
	OPENBSD_5_1_BASE:1.14
	OPENBSD_5_1:1.14.0.8
	OPENBSD_5_0:1.14.0.6
	OPENBSD_5_0_BASE:1.14
	OPENBSD_4_9:1.14.0.4
	OPENBSD_4_9_BASE:1.14
	OPENBSD_4_8:1.14.0.2
	OPENBSD_4_8_BASE:1.14
	OPENBSD_4_7:1.13.0.2
	OPENBSD_4_7_BASE:1.13
	OPENBSD_4_6:1.12.0.24
	OPENBSD_4_6_BASE:1.12
	OPENBSD_4_5:1.12.0.20
	OPENBSD_4_5_BASE:1.12
	OPENBSD_4_4:1.12.0.18
	OPENBSD_4_4_BASE:1.12
	OPENBSD_4_3:1.12.0.16
	OPENBSD_4_3_BASE:1.12
	OPENBSD_4_2:1.12.0.14
	OPENBSD_4_2_BASE:1.12
	OPENBSD_4_1:1.12.0.12
	OPENBSD_4_1_BASE:1.12
	OPENBSD_4_0:1.12.0.10
	OPENBSD_4_0_BASE:1.12
	OPENBSD_3_9:1.12.0.8
	OPENBSD_3_9_BASE:1.12
	OPENBSD_3_8:1.12.0.6
	OPENBSD_3_8_BASE:1.12
	OPENBSD_3_7:1.12.0.4
	OPENBSD_3_7_BASE:1.12
	OPENBSD_3_6:1.12.0.2
	OPENBSD_3_6_BASE:1.12
	SMP_SYNC_A:1.11
	SMP_SYNC_B:1.11
	OPENBSD_3_5:1.11.0.10
	OPENBSD_3_5_BASE:1.11
	OPENBSD_3_4:1.11.0.8
	OPENBSD_3_4_BASE:1.11
	UBC_SYNC_A:1.11
	OPENBSD_3_3:1.11.0.6
	OPENBSD_3_3_BASE:1.11
	OPENBSD_3_2:1.11.0.4
	OPENBSD_3_2_BASE:1.11
	OPENBSD_3_1:1.11.0.2
	OPENBSD_3_1_BASE:1.11
	UBC_SYNC_B:1.11
	UBC:1.9.0.4
	UBC_BASE:1.9
	OPENBSD_3_0:1.9.0.2
	OPENBSD_3_0_BASE:1.9
	OPENBSD_2_9:1.8.0.2
	OPENBSD_2_9_BASE:1.8
	OPENBSD_2_8:1.7.0.12
	OPENBSD_2_8_BASE:1.7
	OPENBSD_2_7:1.7.0.10
	OPENBSD_2_7_BASE:1.7
	SMP:1.7.0.8
	SMP_BASE:1.7
	kame_19991208:1.7
	OPENBSD_2_6:1.7.0.6
	OPENBSD_2_6_BASE:1.7
	OPENBSD_2_5:1.7.0.4
	OPENBSD_2_5_BASE:1.7
	OPENBSD_2_4:1.7.0.2
	OPENBSD_2_4_BASE:1.7
	OPENBSD_2_3:1.5.0.6
	OPENBSD_2_3_BASE:1.5
	OPENBSD_2_2:1.5.0.4
	OPENBSD_2_2_BASE:1.5
	OPENBSD_2_1:1.5.0.2
	OPENBSD_2_1_BASE:1.5
	OPENBSD_2_0:1.3.0.2
	OPENBSD_2_0_BASE:1.3;
locks; strict;
comment	@ * @;


1.15
date	2014.02.18.19.37.33;	author miod;	state Exp;
branches;
next	1.14;

1.14
date	2010.06.06.11.26.11;	author miod;	state Exp;
branches;
next	1.13;

1.13
date	2009.08.22.02.54.50;	author mk;	state Exp;
branches;
next	1.12;

1.12
date	2004.06.28.02.28.43;	author aaron;	state Exp;
branches;
next	1.11;

1.11
date	2002.03.14.03.15.50;	author millert;	state Exp;
branches;
next	1.10;

1.10
date	2002.03.14.01.26.27;	author millert;	state Exp;
branches;
next	1.9;

1.9
date	2001.08.17.22.26.58;	author mickey;	state Exp;
branches
	1.9.4.1;
next	1.8;

1.8
date	2000.11.08.16.01.22;	author art;	state Exp;
branches;
next	1.7;

1.7
date	98.07.01.05.32.43;	author angelos;	state Exp;
branches
	1.7.8.1;
next	1.6;

1.6
date	98.06.29.05.32.57;	author downsj;	state Exp;
branches;
next	1.5;

1.5
date	96.12.08.00.20.50;	author niklas;	state Exp;
branches;
next	1.4;

1.4
date	96.10.30.22.40.17;	author niklas;	state Exp;
branches;
next	1.3;

1.3
date	96.07.29.23.00.58;	author niklas;	state Exp;
branches;
next	1.2;

1.2
date	96.06.18.09.44.41;	author deraadt;	state Exp;
branches;
next	1.1;

1.1
date	95.12.14.03.53.37;	author deraadt;	state Exp;
branches;
next	;

1.7.8.1
date	2001.04.18.16.01.30;	author niklas;	state Exp;
branches;
next	1.7.8.2;

1.7.8.2
date	2001.10.31.02.52.45;	author nate;	state Exp;
branches;
next	1.7.8.3;

1.7.8.3
date	2002.03.28.10.06.13;	author niklas;	state Exp;
branches;
next	;

1.9.4.1
date	2002.06.11.03.33.40;	author art;	state Exp;
branches;
next	;


desc
@@


1.15
log
@sio_intr_shutdown() used to be a shutdown hook, and eventually became an
unconditional call in machdep.c!boot(). Except that the cpp conditional
enabling its use was not in machdep.c's scope, so this function was never
called. Ouch.

Remove it from boot() and grow a ca_activate method to the sio(4/alpha) device,
which will take care of invoking sio_intr_shutdown() if DVACT_POWERDOWN.
@
text
@/*	$OpenBSD: siovar.h,v 1.14 2010/06/06 11:26:11 miod Exp $	*/
/*	$NetBSD: siovar.h,v 1.5 1996/10/23 04:12:34 cgd Exp $	*/

/*
 * Copyright (c) 1995, 1996 Carnegie-Mellon University.
 * All rights reserved.
 *
 * Author: Chris G. Demetriou
 *
 * Permission to use, copy, modify and distribute this software and
 * its documentation is hereby granted, provided that both the copyright
 * notice and this permission notice appear in all copies of the
 * software, derivative works or modified versions, and any portions
 * thereof, and that both notices appear in supporting documentation.
 *
 * CARNEGIE MELLON ALLOWS FREE USE OF THIS SOFTWARE IN ITS "AS IS"
 * CONDITION.  CARNEGIE MELLON DISCLAIMS ANY LIABILITY OF ANY KIND
 * FOR ANY DAMAGES WHATSOEVER RESULTING FROM THE USE OF THIS SOFTWARE.
 *
 * Carnegie Mellon requests users of this software to return to
 *
 *  Software Distribution Coordinator  or  Software.Distribution@@CS.CMU.EDU
 *  School of Computer Science
 *  Carnegie Mellon University
 *  Pittsburgh PA 15213-3890
 *
 * any improvements or extensions that they make and grant Carnegie the
 * rights to redistribute these changes.
 */

#include <sys/evcount.h>

void	sio_intr_setup(pci_chipset_tag_t, bus_space_tag_t);
void	sio_intr_shutdown(void);
void	sio_iointr(void *framep, unsigned long vec);

const char *sio_intr_string(void *, int);
int	sio_intr_line(void *, int);
void	*sio_intr_establish(void *, int, int, int, int (*)(void *),
	    void *, const char *);
void	sio_intr_disestablish(void *, void *);
@


1.14
log
@Kill unused sio_intr_count.
@
text
@d1 1
a1 1
/*	$OpenBSD: siovar.h,v 1.13 2009/08/22 02:54:50 mk Exp $	*/
d34 1
@


1.13
log
@Constify the what/name parameter of pci_intr_establish().

Tested by myself, sthen, oga, kettenis, and jasper.
Input from sthen and jasper.

ok kettenis

(Manpage follows shortly.)
@
text
@d1 1
a1 1
/*	$OpenBSD: siovar.h,v 1.12 2004/06/28 02:28:43 aaron Exp $	*/
a40 2

struct evcount sio_intr_count;
@


1.12
log
@Use new event counter API for interrupt counting on alpha.  By me, with some
edits by Theo.  deraadt@@ ok
@
text
@d1 1
a1 1
/*	$OpenBSD: siovar.h,v 1.11 2002/03/14 03:15:50 millert Exp $	*/
d39 1
a39 1
	    void *, char *);
@


1.11
log
@Final __P removal plus some cosmetic fixups
@
text
@d1 1
a1 1
/*	$OpenBSD: siovar.h,v 1.10 2002/03/14 01:26:27 millert Exp $	*/
d31 2
d42 1
a42 3
#ifdef EVCNT_COUNTERS
extern struct evcnt sio_intr_evcnt;
#endif
@


1.10
log
@First round of __P removal in sys
@
text
@d1 1
a1 1
/*	$OpenBSD: siovar.h,v 1.9 2001/08/17 22:26:58 mickey Exp $	*/
d36 2
a37 2
void	*sio_intr_establish __P((void *, int, int, int, int (*)(void *),
	    void *, char *));
@


1.9
log
@provide a way to get the number used for irq line, not only a string
representation, this is needed for devices like cbb which pass
the interrupt line down to the cardbus attachment and not
getting the right line before pci_intr_map() has done it's
dirty deed.
tested on i386 by jason@@, compiles on alpha by art@@.
ppc and mveppc are to be test-compiled, but should work (;
@
text
@d1 1
a1 1
/*	$OpenBSD: siovar.h,v 1.8 2000/11/08 16:01:22 art Exp $	*/
d31 2
a32 2
void	sio_intr_setup __P((pci_chipset_tag_t, bus_space_tag_t));
void	sio_iointr __P((void *framep, unsigned long vec));
d34 2
a35 2
const char *sio_intr_string __P((void *, int));
int	sio_intr_line __P((void *, int));
d38 1
a38 1
void	sio_intr_disestablish __P((void *, void *));
@


1.9.4.1
log
@Sync UBC branch to -current
@
text
@d1 1
a1 1
/*	$OpenBSD: siovar.h,v 1.9 2001/08/17 22:26:58 mickey Exp $	*/
d31 2
a32 2
void	sio_intr_setup(pci_chipset_tag_t, bus_space_tag_t);
void	sio_iointr(void *framep, unsigned long vec);
d34 5
a38 5
const char *sio_intr_string(void *, int);
int	sio_intr_line(void *, int);
void	*sio_intr_establish(void *, int, int, int, int (*)(void *),
	    void *, char *);
void	sio_intr_disestablish(void *, void *);
@


1.8
log
@Merge in big portions of the improvements NetBSD did to their alpha port.
Highlights: UVM, PMAP_NEW, bus_dma (only on some buses for now), new hardware
support, possiblity for ELF, etc, etc. Too much to mention.

This is still work in progress. video consoles might be broken, otherwise
we have basically the same functionality as before plus more.
@
text
@d1 1
a1 1
/*	$OpenBSD: siovar.h,v 1.7 1998/07/01 05:32:43 angelos Exp $	*/
d35 1
@


1.7
log
@First shot for EB164SX/LX support; kernels for those should be much
more stable now, but by no means production-strong. A lot of code from
NetBSD.
@
text
@d1 1
a1 1
/*	$OpenBSD: siovar.h,v 1.6 1998/06/29 05:32:57 downsj Exp $	*/
a34 1
int	sio_intr_check __P((void *, int, int));
@


1.7.8.1
log
@Update the SMP branch to -current, this breaks the SMP branch though.
But it will be fixed soonish.  Note, nothing new has happened, this is just
a merge of the trunk into this branch.
@
text
@d1 1
a1 1
/*	$OpenBSD: siovar.h,v 1.8 2000/11/08 16:01:22 art Exp $	*/
d35 1
@


1.7.8.2
log
@Sync the SMP branch to something just after 3.0
@
text
@d1 1
a1 1
/*	$OpenBSD: siovar.h,v 1.7.8.1 2001/04/18 16:01:30 niklas Exp $	*/
a34 1
int	sio_intr_line __P((void *, int));
@


1.7.8.3
log
@Merge in -current from about a week ago
@
text
@d1 1
a1 1
/*	$OpenBSD$	*/
d31 2
a32 2
void	sio_intr_setup(pci_chipset_tag_t, bus_space_tag_t);
void	sio_iointr(void *framep, unsigned long vec);
d34 5
a38 5
const char *sio_intr_string(void *, int);
int	sio_intr_line(void *, int);
void	*sio_intr_establish(void *, int, int, int, int (*)(void *),
	    void *, char *);
void	sio_intr_disestablish(void *, void *);
@


1.6
log
@isa_intr_check(), alpha style.
@
text
@d1 1
a1 1
/*	$OpenBSD: siovar.h,v 1.5 1996/12/08 00:20:50 niklas Exp $	*/
d31 1
a31 1
void	sio_intr_setup __P((bus_space_tag_t));
@


1.5
log
@Merge to NetBSD 961107, i.e. mostly new bus.h
@
text
@d1 1
a1 1
/*	$OpenBSD: siovar.h,v 1.4 1996/10/30 22:40:17 niklas Exp $	*/
d35 1
@


1.4
log
@Merge to NetBSD 961020.  Retained our kernel APIs where NetBSD has changed.
-Wall -Wstrict-prototypes -Wmissing-prototypes too.
@
text
@d1 2
a2 2
/*	$OpenBSD: siovar.h,v 1.4 1996/07/14 04:08:42 cgd Exp $	*/
/*	$NetBSD: siovar.h,v 1.4 1996/07/14 04:08:42 cgd Exp $	*/
d31 1
a31 1
void	sio_intr_setup __P((bus_chipset_tag_t));
@


1.3
log
@Add OpenBSD tags.  Adapt to OpenBSD *_intr_establish calling convention
@
text
@d1 2
a2 2
/*	$OpenBSD: siovar.h,v 1.3 1996/04/12 06:09:06 cgd Exp $	*/
/*	$NetBSD: siovar.h,v 1.3 1996/04/12 06:09:06 cgd Exp $	*/
d32 1
a32 1
void	sio_iointr __P((void *framep, int vec));
@


1.2
log
@sync to 0616, retaining local diffs
@
text
@d1 1
d36 1
a36 1
	    void *));
@


1.1
log
@update to netbsd
@
text
@d1 1
a1 1
/*	$NetBSD: siovar.h,v 1.1 1995/11/23 02:38:22 cgd Exp $	*/
d4 1
a4 1
 * Copyright (c) 1995 Carnegie-Mellon University.
d30 1
a30 1
void	sio_intr_setup __P((__const struct isa_pio_fns *, void *));
d33 5
a40 1
extern __const struct isa_intr_fns sio_isa_intr_fns;
@
