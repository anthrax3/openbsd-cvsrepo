head	1.8;
access;
symbols
	OPENBSD_6_2_BASE:1.8
	OPENBSD_6_1:1.8.0.8
	OPENBSD_6_1_BASE:1.8
	OPENBSD_6_0:1.8.0.4
	OPENBSD_6_0_BASE:1.8
	OPENBSD_5_9:1.8.0.2
	OPENBSD_5_9_BASE:1.8
	OPENBSD_5_8:1.7.0.26
	OPENBSD_5_8_BASE:1.7
	OPENBSD_5_7:1.7.0.18
	OPENBSD_5_7_BASE:1.7
	OPENBSD_5_6:1.7.0.22
	OPENBSD_5_6_BASE:1.7
	OPENBSD_5_5:1.7.0.20
	OPENBSD_5_5_BASE:1.7
	OPENBSD_5_4:1.7.0.16
	OPENBSD_5_4_BASE:1.7
	OPENBSD_5_3:1.7.0.14
	OPENBSD_5_3_BASE:1.7
	OPENBSD_5_2:1.7.0.12
	OPENBSD_5_2_BASE:1.7
	OPENBSD_5_1_BASE:1.7
	OPENBSD_5_1:1.7.0.10
	OPENBSD_5_0:1.7.0.8
	OPENBSD_5_0_BASE:1.7
	OPENBSD_4_9:1.7.0.6
	OPENBSD_4_9_BASE:1.7
	OPENBSD_4_8:1.7.0.4
	OPENBSD_4_8_BASE:1.7
	OPENBSD_4_7:1.7.0.2
	OPENBSD_4_7_BASE:1.7
	OPENBSD_4_6:1.6.0.16
	OPENBSD_4_6_BASE:1.6
	OPENBSD_4_5:1.6.0.12
	OPENBSD_4_5_BASE:1.6
	OPENBSD_4_4:1.6.0.10
	OPENBSD_4_4_BASE:1.6
	OPENBSD_4_3:1.6.0.8
	OPENBSD_4_3_BASE:1.6
	OPENBSD_4_2:1.6.0.6
	OPENBSD_4_2_BASE:1.6
	OPENBSD_4_1:1.6.0.4
	OPENBSD_4_1_BASE:1.6
	OPENBSD_4_0:1.6.0.2
	OPENBSD_4_0_BASE:1.6
	OPENBSD_3_9:1.5.0.12
	OPENBSD_3_9_BASE:1.5
	OPENBSD_3_8:1.5.0.10
	OPENBSD_3_8_BASE:1.5
	OPENBSD_3_7:1.5.0.8
	OPENBSD_3_7_BASE:1.5
	OPENBSD_3_6:1.5.0.6
	OPENBSD_3_6_BASE:1.5
	SMP_SYNC_A:1.5
	SMP_SYNC_B:1.5
	OPENBSD_3_5:1.5.0.4
	OPENBSD_3_5_BASE:1.5
	OPENBSD_3_4:1.5.0.2
	OPENBSD_3_4_BASE:1.5
	UBC_SYNC_A:1.4
	OPENBSD_3_3:1.4.0.6
	OPENBSD_3_3_BASE:1.4
	OPENBSD_3_2:1.4.0.4
	OPENBSD_3_2_BASE:1.4
	OPENBSD_3_1:1.4.0.2
	OPENBSD_3_1_BASE:1.4
	UBC_SYNC_B:1.4
	UBC:1.3.0.2
	UBC_BASE:1.3
	OPENBSD_3_0:1.2.0.6
	OPENBSD_3_0_BASE:1.2
	OPENBSD_2_9:1.2.0.4
	OPENBSD_2_9_BASE:1.2
	SMP:1.2.0.2;
locks; strict;
comment	@ * @;


1.8
date	2016.01.12.17.20.02;	author deraadt;	state Exp;
branches;
next	1.7;
commitid	MVyF3MoXycoPTTWi;

1.7
date	2009.10.02.18.01.47;	author miod;	state Exp;
branches;
next	1.6;

1.6
date	2006.03.16.22.32.44;	author miod;	state Exp;
branches;
next	1.5;

1.5
date	2003.09.02.17.25.21;	author miod;	state Exp;
branches;
next	1.4;

1.4
date	2002.03.14.01.26.27;	author millert;	state Exp;
branches;
next	1.3;

1.3
date	2001.12.14.00.44.59;	author nate;	state Exp;
branches
	1.3.2.1;
next	1.2;

1.2
date	2001.04.15.01.33.00;	author mjacob;	state Exp;
branches
	1.2.2.1;
next	1.1;

1.1
date	2000.11.16.04.50.18;	author ericj;	state Exp;
branches;
next	;

1.2.2.1
date	2001.04.18.16.01.37;	author niklas;	state Exp;
branches;
next	1.2.2.2;

1.2.2.2
date	2002.03.06.00.55.15;	author niklas;	state Exp;
branches;
next	1.2.2.3;

1.2.2.3
date	2002.03.28.10.06.13;	author niklas;	state Exp;
branches;
next	1.2.2.4;

1.2.2.4
date	2004.02.19.09.59.34;	author niklas;	state Exp;
branches;
next	;

1.3.2.1
date	2002.06.11.03.33.40;	author art;	state Exp;
branches;
next	;


desc
@@


1.8
log
@dev/isa/isavar.h does not appear to be needed by any of consumers.
(noticed because of another issue: one consumer is a high level busdriver,
but also contains i2c support, so the isa #define for ia_irq clashes
against i2c)
@
text
@/* $OpenBSD: tsvar.h,v 1.7 2009/10/02 18:01:47 miod Exp $ */
/* $NetBSD: tsvar.h,v 1.1 1999/06/29 06:46:47 ross Exp $ */

/*-
 * Copyright (c) 1999 by Ross Harvey.  All rights reserved.
 *
 * Redistribution and use in source and binary forms, with or without
 * modification, are permitted provided that the following conditions
 * are met:
 * 1. Redistributions of source code must retain the above copyright
 *    notice, this list of conditions and the following disclaimer.
 * 2. Redistributions in binary form must reproduce the above copyright
 *    notice, this list of conditions and the following disclaimer in the
 *    documentation and/or other materials provided with the distribution.
 * 3. All advertising materials mentioning features or use of this software
 *    must display the following acknowledgement:
 *	This product includes software developed by Ross Harvey.
 * 4. The name of Ross Harvey may not be used to endorse or promote products
 *    derived from this software without specific prior written permission.
 *
 * THIS SOFTWARE IS PROVIDED BY ROSS HARVEY ``AS IS'' AND ANY EXPRESS
 * OR IMPLIED WARRANTIES, INCLUDING, BUT NOT LIMITED TO, THE IMPLIED
 * WARRANTIES OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURP0SE
 * ARE DISCLAIMED.  IN NO EVENT SHALL ROSS HARVEY BE LIABLE FOR ANY
 * DIRECT, INDIRECT, INCIDENTAL, SPECIAL, EXEMPLARY, OR CONSEQUENTIAL
 * DAMAGES (INCLUDING, BUT NOT LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS
 * OR SERVICES; LOSS OF USE, DATA, OR PROFITS; OR BUSINESS INTERRUPTION)
 * HOWEVER CAUSED AND ON ANY THEORY OF LIABILITY, WHETHER IN CONTRACT, STRICT
 * LIABILITY, OR TORT (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY
 * OUT OF THE USE OF THIS SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF
 * SUCH DAMAGE.
 *
 */

#include <dev/pci/pcivar.h>
#include <alpha/pci/pci_sgmap_pte64.h>

#define	tsvar() { Generate ctags(1) key. }

struct tsp_config {
	int	pc_pslot;		/* Pchip 0 or 1 */
	int	pc_initted;		/* Initialized */
	u_int64_t pc_iobase;		/* All Pchip space starts here */
	struct	ts_pchip *pc_csr;	/* Pchip CSR space starts here */
	volatile u_int64_t *pc_tlbia;	/* Pchip TLBIA register address */

	struct	alpha_bus_space pc_iot, pc_memt;
	struct	alpha_pci_chipset pc_pc;

	struct	alpha_bus_dma_tag pc_dmat_direct;
	struct	alpha_bus_dma_tag pc_dmat_sgmap;

	struct alpha_sgmap pc_sgmap;

	u_int32_t pc_hae_mem;
	u_int32_t pc_hae_io;

	struct	extent *pc_io_ex, *pc_mem_ex;
	char	pc_io_ex_name[16], pc_mem_ex_name[16];
	long	pc_io_ex_storage[EXTENT_FIXED_STORAGE_SIZE(8) / sizeof(long)];
	long	pc_mem_ex_storage[EXTENT_FIXED_STORAGE_SIZE(8) / sizeof(long)];
	int	pc_mallocsafe;
};

struct tsp_softc {
	struct	device sc_dev;
	struct	tsp_config *sc_ccp;
};

struct tsp_attach_args {
	char	*tsp_name;
	int	tsp_slot;
};

extern int tsp_console_hose;

struct	tsp_config *tsp_init(int, int);
void	tsp_pci_init(pci_chipset_tag_t, void *);
void	tsp_dma_init(struct device *, struct tsp_config *);

void	tsp_bus_io_init(bus_space_tag_t, void *);
void	tsp_bus_mem_init(bus_space_tag_t, void *);

void tsp_bus_mem_init2(void *);
@


1.7
log
@Support for DS15/DS25/ES45 (Titan) alpha models (rpb family 38). These systems
are very close to the Tsunami systems (rpb family 34) and share the existing
Tsunami code; the tsc(4) Tsunami controller code is extended to handle the
Titan differences, except for the Titan AGP GART which is left unsupported
for now.

Tested to not cause regressions on DS20 (deraadt@@) and ES40 (miod@@).
Titan support tested by Sergey Prysiazhnyi on DS25, many thanks for your time!
@
text
@d1 1
a1 1
/* $OpenBSD: tsvar.h,v 1.6 2006/03/16 22:32:44 miod Exp $ */
a34 1
#include <dev/isa/isavar.h>
@


1.6
log
@Get rid of specific softc structure for pci host bridges, as it is never
used. No functional change.
@
text
@d1 1
a1 1
/* $OpenBSD: tsvar.h,v 1.5 2003/09/02 17:25:21 miod Exp $ */
d46 1
d80 1
a80 1
void	tsp_dma_init(struct tsp_config *);
@


1.5
log
@Our extent implementation relies on the fact that extents all have distinct
names.

However, the tsp code uses one global extent, which both device instances
want to reinitialize and use for themselves (whether this is a genuine bug
or not is left to the reader).

Solve the problem by putting the extents into the tsp softc, and change the
pci_bwx_bus code to handle variable extent names.

This makes DS20 systems with tsp0 and tsp1 work again.

ok deraadt@@
@
text
@d1 1
a1 1
/* $OpenBSD: tsvar.h,v 1.4 2002/03/14 01:26:27 millert Exp $ */
a39 4

struct tsc_softc {
	struct	device tsc_dev;
};
@


1.4
log
@First round of __P removal in sys
@
text
@d1 1
a1 1
/* $OpenBSD: tsvar.h,v 1.3 2001/12/14 00:44:59 nate Exp $ */
d63 3
@


1.3
log
@Don't use a single static struct alpha_bus_space since there are machines
that can have more than one system bus attached to mainbus
@
text
@d1 1
a1 1
/* $OpenBSD: tsvar.h,v 1.2 2001/04/15 01:33:00 mjacob Exp $ */
d78 3
a80 3
struct	tsp_config *tsp_init __P((int, int));
void	tsp_pci_init __P((pci_chipset_tag_t, void *));
void	tsp_dma_init __P((struct tsp_config *));
d82 2
a83 2
void	tsp_bus_io_init __P((bus_space_tag_t, void *));
void	tsp_bus_mem_init __P((bus_space_tag_t, void *));
d85 1
a85 1
void tsp_bus_mem_init2 __P((void *));
@


1.3.2.1
log
@Sync UBC branch to -current
@
text
@d1 1
a1 1
/* $OpenBSD: tsvar.h,v 1.3 2001/12/14 00:44:59 nate Exp $ */
d78 3
a80 3
struct	tsp_config *tsp_init(int, int);
void	tsp_pci_init(pci_chipset_tag_t, void *);
void	tsp_dma_init(struct tsp_config *);
d82 2
a83 2
void	tsp_bus_io_init(bus_space_tag_t, void *);
void	tsp_bus_mem_init(bus_space_tag_t, void *);
d85 1
a85 1
void tsp_bus_mem_init2(void *);
@


1.2
log
@oops, commit protos
@
text
@d1 1
a1 1
/* $OpenBSD: tsvar.h,v 1.1 2000/11/16 04:50:18 ericj Exp $ */
d51 1
a51 1
	bus_space_tag_t pc_iot, pc_memt;
d82 2
a83 2
bus_space_tag_t tsp_bus_io_init __P((void *));
bus_space_tag_t tsp_bus_mem_init __P((void *));
@


1.2.2.1
log
@Update the SMP branch to -current, this breaks the SMP branch though.
But it will be fixed soonish.  Note, nothing new has happened, this is just
a merge of the trunk into this branch.
@
text
@d1 1
a1 1
/* $OpenBSD: tsvar.h,v 1.2 2001/04/15 01:33:00 mjacob Exp $ */
@


1.2.2.2
log
@Merge in trunk
@
text
@d1 1
a1 1
/* $OpenBSD$ */
d51 1
a51 1
	struct	alpha_bus_space pc_iot, pc_memt;
d82 2
a83 2
void	tsp_bus_io_init __P((bus_space_tag_t, void *));
void	tsp_bus_mem_init __P((bus_space_tag_t, void *));
@


1.2.2.3
log
@Merge in -current from about a week ago
@
text
@d78 3
a80 3
struct	tsp_config *tsp_init(int, int);
void	tsp_pci_init(pci_chipset_tag_t, void *);
void	tsp_dma_init(struct tsp_config *);
d82 2
a83 2
void	tsp_bus_io_init(bus_space_tag_t, void *);
void	tsp_bus_mem_init(bus_space_tag_t, void *);
d85 1
a85 1
void tsp_bus_mem_init2(void *);
@


1.2.2.4
log
@Merge of -current from two weeks ago into the SMP branch
@
text
@a62 3
	char	pc_io_ex_name[16], pc_mem_ex_name[16];
	long	pc_io_ex_storage[EXTENT_FIXED_STORAGE_SIZE(8) / sizeof(long)];
	long	pc_mem_ex_storage[EXTENT_FIXED_STORAGE_SIZE(8) / sizeof(long)];
@


1.1
log
@
initial support for 21264 systems.
from NetBSD.
@
text
@d1 1
a1 1
/* $OpenBSD: tsvar.h,v 1.1 1999/06/29 06:46:47 ross Exp $ */
d82 4
a85 2
bus_space_tag_t	tsp_bus_io_init __P((void *));
bus_space_tag_t	tsp_bus_mem_init __P((void *));
@

