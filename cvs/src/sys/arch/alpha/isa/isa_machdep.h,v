head	1.15;
access;
symbols
	OPENBSD_6_2:1.15.0.10
	OPENBSD_6_2_BASE:1.15
	OPENBSD_6_1:1.15.0.8
	OPENBSD_6_1_BASE:1.15
	OPENBSD_6_0:1.15.0.4
	OPENBSD_6_0_BASE:1.15
	OPENBSD_5_9:1.15.0.2
	OPENBSD_5_9_BASE:1.15
	OPENBSD_5_8:1.14.0.12
	OPENBSD_5_8_BASE:1.14
	OPENBSD_5_7:1.14.0.4
	OPENBSD_5_7_BASE:1.14
	OPENBSD_5_6:1.14.0.8
	OPENBSD_5_6_BASE:1.14
	OPENBSD_5_5:1.14.0.6
	OPENBSD_5_5_BASE:1.14
	OPENBSD_5_4:1.14.0.2
	OPENBSD_5_4_BASE:1.14
	OPENBSD_5_3:1.13.0.14
	OPENBSD_5_3_BASE:1.13
	OPENBSD_5_2:1.13.0.12
	OPENBSD_5_2_BASE:1.13
	OPENBSD_5_1_BASE:1.13
	OPENBSD_5_1:1.13.0.10
	OPENBSD_5_0:1.13.0.8
	OPENBSD_5_0_BASE:1.13
	OPENBSD_4_9:1.13.0.6
	OPENBSD_4_9_BASE:1.13
	OPENBSD_4_8:1.13.0.4
	OPENBSD_4_8_BASE:1.13
	OPENBSD_4_7:1.13.0.2
	OPENBSD_4_7_BASE:1.13
	OPENBSD_4_6:1.12.0.34
	OPENBSD_4_6_BASE:1.12
	OPENBSD_4_5:1.12.0.30
	OPENBSD_4_5_BASE:1.12
	OPENBSD_4_4:1.12.0.28
	OPENBSD_4_4_BASE:1.12
	OPENBSD_4_3:1.12.0.26
	OPENBSD_4_3_BASE:1.12
	OPENBSD_4_2:1.12.0.24
	OPENBSD_4_2_BASE:1.12
	OPENBSD_4_1:1.12.0.22
	OPENBSD_4_1_BASE:1.12
	OPENBSD_4_0:1.12.0.20
	OPENBSD_4_0_BASE:1.12
	OPENBSD_3_9:1.12.0.18
	OPENBSD_3_9_BASE:1.12
	OPENBSD_3_8:1.12.0.16
	OPENBSD_3_8_BASE:1.12
	OPENBSD_3_7:1.12.0.14
	OPENBSD_3_7_BASE:1.12
	OPENBSD_3_6:1.12.0.12
	OPENBSD_3_6_BASE:1.12
	SMP_SYNC_A:1.12
	SMP_SYNC_B:1.12
	OPENBSD_3_5:1.12.0.10
	OPENBSD_3_5_BASE:1.12
	OPENBSD_3_4:1.12.0.8
	OPENBSD_3_4_BASE:1.12
	UBC_SYNC_A:1.12
	OPENBSD_3_3:1.12.0.6
	OPENBSD_3_3_BASE:1.12
	OPENBSD_3_2:1.12.0.4
	OPENBSD_3_2_BASE:1.12
	OPENBSD_3_1:1.12.0.2
	OPENBSD_3_1_BASE:1.12
	UBC_SYNC_B:1.12
	UBC:1.10.0.2
	UBC_BASE:1.10
	OPENBSD_3_0:1.7.0.4
	OPENBSD_3_0_BASE:1.7
	OPENBSD_2_9:1.7.0.2
	OPENBSD_2_9_BASE:1.7
	OPENBSD_2_8:1.5.0.12
	OPENBSD_2_8_BASE:1.5
	OPENBSD_2_7:1.5.0.10
	OPENBSD_2_7_BASE:1.5
	SMP:1.5.0.8
	SMP_BASE:1.5
	kame_19991208:1.5
	OPENBSD_2_6:1.5.0.6
	OPENBSD_2_6_BASE:1.5
	OPENBSD_2_5:1.5.0.4
	OPENBSD_2_5_BASE:1.5
	OPENBSD_2_4:1.5.0.2
	OPENBSD_2_4_BASE:1.5
	OPENBSD_2_3:1.4.0.6
	OPENBSD_2_3_BASE:1.4
	OPENBSD_2_2:1.4.0.4
	OPENBSD_2_2_BASE:1.4
	OPENBSD_2_1:1.4.0.2
	OPENBSD_2_1_BASE:1.4
	OPENBSD_2_0:1.2.0.2
	OPENBSD_2_0_BASE:1.2;
locks; strict;
comment	@ * @;


1.15
date	2015.08.15.19.15.18;	author miod;	state Exp;
branches;
next	1.14;
commitid	smtnaO3aYbvHjDlk;

1.14
date	2013.03.08.18.29.33;	author miod;	state Exp;
branches;
next	1.13;

1.13
date	2009.08.22.02.54.50;	author mk;	state Exp;
branches;
next	1.12;

1.12
date	2002.03.14.03.15.50;	author millert;	state Exp;
branches;
next	1.11;

1.11
date	2002.03.14.01.26.27;	author millert;	state Exp;
branches;
next	1.10;

1.10
date	2001.11.05.17.25.57;	author art;	state Exp;
branches
	1.10.2.1;
next	1.9;

1.9
date	2001.11.05.02.39.57;	author art;	state Exp;
branches;
next	1.8;

1.8
date	2001.10.26.01.28.06;	author nate;	state Exp;
branches;
next	1.7;

1.7
date	2000.11.16.04.33.47;	author ericj;	state Exp;
branches;
next	1.6;

1.6
date	2000.11.08.16.01.15;	author art;	state Exp;
branches;
next	1.5;

1.5
date	98.06.29.05.32.53;	author downsj;	state Exp;
branches
	1.5.8.1;
next	1.4;

1.4
date	97.01.24.19.57.24;	author niklas;	state Exp;
branches;
next	1.3;

1.3
date	96.10.30.22.39.37;	author niklas;	state Exp;
branches;
next	1.2;

1.2
date	96.07.29.22.59.44;	author niklas;	state Exp;
branches;
next	1.1;

1.1
date	96.06.18.09.43.42;	author deraadt;	state Exp;
branches;
next	;

1.5.8.1
date	2001.04.18.16.01.01;	author niklas;	state Exp;
branches;
next	1.5.8.2;

1.5.8.2
date	2001.10.31.02.52.44;	author nate;	state Exp;
branches;
next	1.5.8.3;

1.5.8.3
date	2001.11.13.21.00.49;	author niklas;	state Exp;
branches;
next	1.5.8.4;

1.5.8.4
date	2002.03.28.10.06.13;	author niklas;	state Exp;
branches;
next	;

1.10.2.1
date	2002.06.11.03.33.40;	author art;	state Exp;
branches;
next	;


desc
@@


1.15
log
@Fix isa_chipset_t ic_intr_{alloc,check} prototype: these take an
isa_chipset_tag_t, not an isa_chipset_tag_t *, as isa_chipset_tag_t is already
a pointer.
@
text
@/*	$OpenBSD: isa_machdep.h,v 1.14 2013/03/08 18:29:33 miod Exp $	*/
/*	$NetBSD: isa_machdep.h,v 1.3 1996/11/19 04:53:07 cgd Exp $	*/

/*
 * Copyright (c) 1996 Carnegie-Mellon University.
 * All rights reserved.
 *
 * Author: Chris G. Demetriou
 *
 * Permission to use, copy, modify and distribute this software and
 * its documentation is hereby granted, provided that both the copyright
 * notice and this permission notice appear in all copies of the
 * software, derivative works or modified versions, and any portions
 * thereof, and that both notices appear in supporting documentation.
 *
 * CARNEGIE MELLON ALLOWS FREE USE OF THIS SOFTWARE IN ITS "AS IS"
 * CONDITION.  CARNEGIE MELLON DISCLAIMS ANY LIABILITY OF ANY KIND
 * FOR ANY DAMAGES WHATSOEVER RESULTING FROM THE USE OF THIS SOFTWARE.
 *
 * Carnegie Mellon requests users of this software to return to
 *
 *  Software Distribution Coordinator  or  Software.Distribution@@CS.CMU.EDU
 *  School of Computer Science
 *  Carnegie Mellon University
 *  Pittsburgh PA 15213-3890
 *
 * any improvements or extensions that they make and grant Carnegie the
 * rights to redistribute these changes.
 */

/*
 * Types provided to machine-independent ISA code.
 */
typedef struct alpha_isa_chipset *isa_chipset_tag_t;

struct alpha_isa_chipset {
	void	*ic_v;

	void	(*ic_attach_hook)(struct device *, struct device *,
		    struct isabus_attach_args *);
	void	*(*ic_intr_establish)(void *, int, int, int,
		    int (*)(void *), void *, const char *);
	void	(*ic_intr_disestablish)(void *, void *);
	int	(*ic_intr_alloc)(isa_chipset_tag_t, int, int, int *);
	int	(*ic_intr_check)(isa_chipset_tag_t, int, int);
};

/*
 * Functions provided to machine-independent ISA code.
 */
#define	isa_attach_hook(p, s, a)					\
    (*(a)->iba_ic->ic_attach_hook)((p), (s), (a))
#define	isa_intr_establish(c, i, t, l, f, a, nm)			\
    (*(c)->ic_intr_establish)((c)->ic_v, (i), (t), (l), (f), (a), (nm))
#define	isa_intr_disestablish(c, h)					\
    (*(c)->ic_intr_disestablish)((c)->ic_v, (h))
#define isa_intr_alloc(c, m, t, i)					\
    (*(c)->ic_intr_alloc)((c)->ic_v, (m), (t), (i))
#define isa_intr_check(c, i, t)						\
    (*(c)->ic_intr_check)((c)->ic_v, (i), (t))

/*
 * alpha-specific ISA functions.
 * NOT TO BE USED DIRECTLY BY MACHINE INDEPENDENT CODE.
 */ 
int	isa_display_console(bus_space_tag_t, bus_space_tag_t);

#ifdef _ALPHA_BUS_DMA_PRIVATE
int	isadma_bounce_dmamap_create(bus_dma_tag_t, bus_size_t, int,
	    bus_size_t, bus_size_t, int, bus_dmamap_t *);
void	isadma_bounce_dmamap_destroy(bus_dma_tag_t, bus_dmamap_t);
int	isadma_bounce_dmamap_load(bus_dma_tag_t, bus_dmamap_t, void *,
	    bus_size_t, struct proc *, int);
int	isadma_bounce_dmamap_load_mbuf(bus_dma_tag_t, bus_dmamap_t,
	    struct mbuf *, int);
int	isadma_bounce_dmamap_load_uio(bus_dma_tag_t, bus_dmamap_t,
	    struct uio *, int);
int	isadma_bounce_dmamap_load_raw(bus_dma_tag_t, bus_dmamap_t,
	    bus_dma_segment_t *, int, bus_size_t, int);
void	isadma_bounce_dmamap_unload(bus_dma_tag_t, bus_dmamap_t);
void	isadma_bounce_dmamap_sync(bus_dma_tag_t, bus_dmamap_t, bus_addr_t,
	    bus_size_t, int);
int	isadma_bounce_dmamem_alloc(bus_dma_tag_t, bus_size_t, bus_size_t,
	    bus_size_t, bus_dma_segment_t *, int, int *, int);
#endif /* _ALPHA_BUS_DMA_PRIVATE */
@


1.14
log
@Stop defining __NO_ISA_INTR_CHECK and add a real isa_intr_check() function.
Allows pcic to attach and correctly pick a suitable interrupt on Multia.
@
text
@d1 1
a1 1
/*	$OpenBSD: isa_machdep.h,v 1.13 2009/08/22 02:54:50 mk Exp $	*/
d44 2
a45 2
	int	(*ic_intr_alloc)(isa_chipset_tag_t *, int, int, int *);
	int	(*ic_intr_check)(isa_chipset_tag_t *, int, int);
@


1.13
log
@Constify the what/name parameter of pci_intr_establish().

Tested by myself, sthen, oga, kettenis, and jasper.
Input from sthen and jasper.

ok kettenis

(Manpage follows shortly.)
@
text
@d1 1
a1 1
/*	$OpenBSD: isa_machdep.h,v 1.12 2002/03/14 03:15:50 millert Exp $	*/
d45 1
d59 2
a60 2

#define __NO_ISA_INTR_CHECK
@


1.12
log
@Final __P removal plus some cosmetic fixups
@
text
@d1 1
a1 1
/*	$OpenBSD: isa_machdep.h,v 1.11 2002/03/14 01:26:27 millert Exp $	*/
d42 1
a42 1
		    int (*)(void *), void *, char *);
@


1.11
log
@First round of __P removal in sys
@
text
@d1 1
a1 1
/*	$OpenBSD: isa_machdep.h,v 1.10 2001/11/05 17:25:57 art Exp $	*/
d41 2
a42 2
	void	*(*ic_intr_establish) __P((void *, int, int, int,
		    int (*)(void *), void *, char *));
@


1.10
log
@Switch everything to the new bus_dmamap_sync API.
Most work by Wilbern Cobb <vedge@@csoft.org> with some fixes from me, mickey@@
and drahn@@.
@
text
@d1 1
a1 1
/*	$OpenBSD: isa_machdep.h,v 1.9 2001/11/05 02:39:57 art Exp $	*/
d39 2
a40 2
	void	(*ic_attach_hook) __P((struct device *, struct device *,
		    struct isabus_attach_args *));
d43 2
a44 2
	void	(*ic_intr_disestablish) __P((void *, void *));
	int	(*ic_intr_alloc) __P((isa_chipset_tag_t *, int, int, int *));
d65 1
a65 1
int	isa_display_console __P((bus_space_tag_t, bus_space_tag_t));
@


1.10.2.1
log
@Sync UBC branch to -current
@
text
@d1 1
a1 1
/*	$OpenBSD: isa_machdep.h,v 1.10 2001/11/05 17:25:57 art Exp $	*/
d39 6
a44 6
	void	(*ic_attach_hook)(struct device *, struct device *,
		    struct isabus_attach_args *);
	void	*(*ic_intr_establish)(void *, int, int, int,
		    int (*)(void *), void *, char *);
	void	(*ic_intr_disestablish)(void *, void *);
	int	(*ic_intr_alloc)(isa_chipset_tag_t *, int, int, int *);
d65 1
a65 1
int	isa_display_console(bus_space_tag_t, bus_space_tag_t);
@


1.9
log
@Code for isadma bouncing.
From NetBSD.
@
text
@d1 1
a1 1
/*	$OpenBSD: isa_machdep.h,v 1.8 2001/10/26 01:28:06 nate Exp $	*/
d80 2
a81 2
void	isadma_bounce_dmamap_sync(bus_dma_tag_t, bus_dmamap_t,
	    bus_dmasync_op_t);
@


1.8
log
@First cut at a port of isadma and floppy driver.  ok art@@
From NetBSD via jay@@rootaction.net
@
text
@d1 1
a1 1
/*	$OpenBSD: isa_machdep.h,v 1.7 2000/11/16 04:33:47 ericj Exp $	*/
d66 19
@


1.7
log
@
configure vga, mouse and keyboard's once again. Currently only on eb164.
others soon. Some of this from NetBSD.
@
text
@d1 1
a1 1
/*	$OpenBSD: isa_machdep.h,v 1.6 2000/11/08 16:01:15 art Exp $	*/
d44 1
d56 2
@


1.6
log
@Merge in big portions of the improvements NetBSD did to their alpha port.
Highlights: UVM, PMAP_NEW, bus_dma (only on some buses for now), new hardware
support, possiblity for ELF, etc, etc. Too much to mention.

This is still work in progress. video consoles might be broken, otherwise
we have basically the same functionality as before plus more.
@
text
@d1 1
a1 1
/*	$OpenBSD: isa_machdep.h,v 1.5 1998/06/29 05:32:53 downsj Exp $	*/
d62 1
a62 1
void    isa_display_console __P((bus_space_tag_t, bus_space_tag_t));
@


1.5
log
@isa_intr_check(), alpha style.
@
text
@d1 1
a1 1
/*	$OpenBSD: isa_machdep.h,v 1.4 1997/01/24 19:57:24 niklas Exp $	*/
a43 1
	int	(*ic_intr_check) __P((void *, int, int));
d55 2
a56 2
#define isa_intr_check(c, i, t)						\
    (*(c)->ic_intr_check)((c)->ic_v, (i), (t))
@


1.5.8.1
log
@Update the SMP branch to -current, this breaks the SMP branch though.
But it will be fixed soonish.  Note, nothing new has happened, this is just
a merge of the trunk into this branch.
@
text
@d1 1
a1 1
/*	$OpenBSD: isa_machdep.h,v 1.7 2000/11/16 04:33:47 ericj Exp $	*/
d44 1
d56 2
a57 2

#define __NO_ISA_INTR_CHECK
d63 1
a63 1
int	isa_display_console __P((bus_space_tag_t, bus_space_tag_t));
@


1.5.8.2
log
@Sync the SMP branch to something just after 3.0
@
text
@d1 1
a1 1
/*	$OpenBSD: isa_machdep.h,v 1.5.8.1 2001/04/18 16:01:01 niklas Exp $	*/
a43 1
	int	(*ic_intr_alloc) __P((isa_chipset_tag_t *, int, int, int *));
a54 2
#define isa_intr_alloc(c, m, t, i)					\
    (*(c)->ic_intr_alloc)((c)->ic_v, (m), (t), (i))
@


1.5.8.3
log
@Merge in -current
@
text
@d1 1
a1 1
/*	$OpenBSD$	*/
a65 19

#ifdef _ALPHA_BUS_DMA_PRIVATE
int	isadma_bounce_dmamap_create(bus_dma_tag_t, bus_size_t, int,
	    bus_size_t, bus_size_t, int, bus_dmamap_t *);
void	isadma_bounce_dmamap_destroy(bus_dma_tag_t, bus_dmamap_t);
int	isadma_bounce_dmamap_load(bus_dma_tag_t, bus_dmamap_t, void *,
	    bus_size_t, struct proc *, int);
int	isadma_bounce_dmamap_load_mbuf(bus_dma_tag_t, bus_dmamap_t,
	    struct mbuf *, int);
int	isadma_bounce_dmamap_load_uio(bus_dma_tag_t, bus_dmamap_t,
	    struct uio *, int);
int	isadma_bounce_dmamap_load_raw(bus_dma_tag_t, bus_dmamap_t,
	    bus_dma_segment_t *, int, bus_size_t, int);
void	isadma_bounce_dmamap_unload(bus_dma_tag_t, bus_dmamap_t);
void	isadma_bounce_dmamap_sync(bus_dma_tag_t, bus_dmamap_t, bus_addr_t,
	    bus_size_t, int);
int	isadma_bounce_dmamem_alloc(bus_dma_tag_t, bus_size_t, bus_size_t,
	    bus_size_t, bus_dma_segment_t *, int, int *, int);
#endif /* _ALPHA_BUS_DMA_PRIVATE */
@


1.5.8.4
log
@Merge in -current from about a week ago
@
text
@d39 6
a44 6
	void	(*ic_attach_hook)(struct device *, struct device *,
		    struct isabus_attach_args *);
	void	*(*ic_intr_establish)(void *, int, int, int,
		    int (*)(void *), void *, char *);
	void	(*ic_intr_disestablish)(void *, void *);
	int	(*ic_intr_alloc)(isa_chipset_tag_t *, int, int, int *);
d65 1
a65 1
int	isa_display_console(bus_space_tag_t, bus_space_tag_t);
@


1.4
log
@Sync with NetBSD 961207
@
text
@d1 1
a1 1
/*	$OpenBSD: isa_machdep.h,v 1.3 1996/10/30 22:39:37 niklas Exp $	*/
d44 1
d56 2
@


1.3
log
@Merge to NetBSD 961020.  Retained our kernel APIs where NetBSD has changed.
-Wall -Wstrict-prototypes -Wmissing-prototypes too.
@
text
@d1 2
a2 2
/*	$OpenBSD: isa_machdep.h,v 1.2 1996/04/12 05:39:02 cgd Exp $	*/
/*	$NetBSD: isa_machdep.h,v 1.2 1996/04/12 05:39:02 cgd Exp $	*/
d55 6
@


1.2
log
@Add OpenBSD tags.  Adapt to OpenBSD *_intr_establish calling convention
@
text
@@


1.1
log
@sync to 0616, retaining local diffs
@
text
@d1 1
d42 1
a42 1
		    int (*)(void *), void *));
d51 2
a52 2
#define	isa_intr_establish(c, i, t, l, f, a)				\
    (*(c)->ic_intr_establish)((c)->ic_v, (i), (t), (l), (f), (a))
@
