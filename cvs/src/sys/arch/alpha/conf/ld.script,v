head	1.3;
access;
symbols
	OPENBSD_6_1:1.3.0.18
	OPENBSD_6_1_BASE:1.3
	OPENBSD_6_0:1.3.0.16
	OPENBSD_6_0_BASE:1.3
	OPENBSD_5_9:1.3.0.12
	OPENBSD_5_9_BASE:1.3
	OPENBSD_5_8:1.3.0.14
	OPENBSD_5_8_BASE:1.3
	OPENBSD_5_7:1.3.0.6
	OPENBSD_5_7_BASE:1.3
	OPENBSD_5_6:1.3.0.10
	OPENBSD_5_6_BASE:1.3
	OPENBSD_5_5:1.3.0.8
	OPENBSD_5_5_BASE:1.3
	OPENBSD_5_4:1.3.0.4
	OPENBSD_5_4_BASE:1.3
	OPENBSD_5_3:1.3.0.2
	OPENBSD_5_3_BASE:1.3
	OPENBSD_5_2:1.2.0.12
	OPENBSD_5_2_BASE:1.2
	OPENBSD_5_1_BASE:1.2
	OPENBSD_5_1:1.2.0.10
	OPENBSD_5_0:1.2.0.8
	OPENBSD_5_0_BASE:1.2
	OPENBSD_4_9:1.2.0.6
	OPENBSD_4_9_BASE:1.2
	OPENBSD_4_8:1.2.0.4
	OPENBSD_4_8_BASE:1.2
	OPENBSD_4_7:1.2.0.2
	OPENBSD_4_7_BASE:1.2;
locks; strict;
comment	@# @;


1.3
date	2012.12.17.20.31.26;	author miod;	state Exp;
branches;
next	1.2;

1.2
date	2009.10.02.17.57.20;	author miod;	state Exp;
branches;
next	1.1;

1.1
date	2009.09.24.19.51.32;	author miod;	state Exp;
branches;
next	;


desc
@@


1.3
log
@Add a list of alpha systems and their SRM footprint in the linker script
comments, in the discussion about the kernel load address, for reference
purpose. While there, admit the current value will not let the kernel boot
on a GS160. If you are the happy owner of a GS160, can afford the electricity
bill, and want to run OpenBSD on it, please contact alpha@@
@
text
@/*	$OpenBSD: ld.script,v 1.2 2009/10/02 17:57:20 miod Exp $	*/

/*
 * Copyright (c) 2009 Miodrag Vallat.
 *
 * Permission to use, copy, modify, and distribute this software for any
 * purpose with or without fee is hereby granted, provided that the above
 * copyright notice and this permission notice appear in all copies.
 *
 * THE SOFTWARE IS PROVIDED "AS IS" AND THE AUTHOR DISCLAIMS ALL WARRANTIES
 * WITH REGARD TO THIS SOFTWARE INCLUDING ALL IMPLIED WARRANTIES OF
 * MERCHANTABILITY AND FITNESS. IN NO EVENT SHALL THE AUTHOR BE LIABLE FOR
 * ANY SPECIAL, DIRECT, INDIRECT, OR CONSEQUENTIAL DAMAGES OR ANY DAMAGES
 * WHATSOEVER RESULTING FROM LOSS OF USE, DATA OR PROFITS, WHETHER IN AN
 * ACTION OF CONTRACT, NEGLIGENCE OR OTHER TORTIOUS ACTION, ARISING OUT OF
 * OR IN CONNECTION WITH THE USE OR PERFORMANCE OF THIS SOFTWARE.
 */

/*
 * Linker script for an alpha static ELF binary, without any C++ code
 * (ctor/dtor/eh_frame).
 */

OUTPUT_FORMAT("elf64-alpha")
OUTPUT_ARCH(alpha)
ENTRY(__start)
SECTIONS
{
	/*
	 * The start address needs to be a physical address allowing for
	 * enough room for the console firmware, and the boot loader.
	 * On most alpha machines, the console fits in no more than
	 * 2MB, to which we need to add 256KB of boot blocks and the
	 * initial kernel stack.
	 * However, some of the last alpha models (*5 D and E series,
	 * *7, and G series) have much larger console sizes.
	 *
	 * For reference, here is a list of systems and their console
	 * sizes:
	 *
	 *	AXPpci33		10e000, 110000
	 *	EB164			11c000
	 *	AS400 (Avanti)		11e000
	 *	2100/A50 (Avanti)	11e500
	 *	AS1000			12e000
	 *	AS200, AS255		13a000, 1f2000
	 *	AS250			148000
	 *	AS500			14a000
	 *	AS500/600		14c000
	 *	Multia			154000, 158000, 166000
	 *	DS20			156000
	 *	PC164			180000
	 *	PWS			1d6000, 1d8000, 1f2000
	 *	3305 (AS1000A)		1da000
	 *	164SX			1de000
	 *	AS1200			1f0000
	 *	XP1000, AS2100, AS4100	200000
	 *	ES40, CS20, DS10	200000
	 *	AS8400			200000
	 *	ES45			32c000
	 *	DS25			51c000
	 *	GS160			5f2000
	 *
	 * If you change this value, make sure to update KERNBASE in
	 * <machine/param.h> as well.
	 *
	 * Note that the current setting will not work on a GS160.  If you
	 * are the lucky owner of such a system and want to run OpenBSD on
	 * it, please contact <alpha@@openbsd.org>
	 */
	. = 0xfffffc0000580000;

	.text :		{ *(.text .text.* .gnu.linkonce.t.*) }
	PROVIDE(etext = .);
	.rodata :	{ *(.rodata .rodata.* .gnu.linkonce.r.*) }
	.data :		{ *(.data .data.* .gnu.linkonce.d.*) }
	.got :		{ *(.got) }
	.sdata :	{ *(.sdata .sdata.* .gnu.linkonce.s.*) }
	.lit8 :		{ *(.lit8) }
	.lita :		{ *(.lita) }
	.sdata :	{ *(.sdata .sdata*) }
	PROVIDE(edata = .);
	.sbss :		{ *(.sbss .sbss.* .gnu.linkonce.sb.* .scommon) }
	.bss :		{ *(.bss .bss.* .gnu.linkonce.b.* COMMON) }
	PROVIDE(_end = .);
	PROVIDE(end = .);
	/DISCARD/ :
	{
		*(.comment)
		*(.eh_frame)
	}
}
@


1.2
log
@Link the kernel at a higher physical address, in order to accomodate SRM
with larger footprint than the usual 2MB, as encountered on some of the
most recent alpha systems.
Tested on many models (DEC 3000, PC164, AS500, ES40, and more)
@
text
@d1 1
a1 1
/*	$OpenBSD: ld.script,v 1.1 2009/09/24 19:51:32 miod Exp $	*/
d37 26
a62 2
	 * The largest console encountered so far is 0x51c000 bytes long
	 * (on DS25).
d66 4
@


1.1
log
@Link alpha kernels with an ld.script to discard unwanted sections; this
allows us to no longer need to compile with -finhibit-size-directive, which
in turns allows the (future) use of !samegp relocations by as(1).
ok kettenis@@
@
text
@d1 1
a1 1
/*	$OpenBSD$	*/
d29 16
a44 1
	. = 0xfffffc0000230000;
@

