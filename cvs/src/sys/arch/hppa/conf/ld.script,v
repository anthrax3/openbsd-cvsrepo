head	1.19;
access;
symbols
	OPENBSD_6_2:1.19.0.4
	OPENBSD_6_2_BASE:1.19
	OPENBSD_6_1:1.17.0.26
	OPENBSD_6_1_BASE:1.17
	OPENBSD_6_0:1.17.0.22
	OPENBSD_6_0_BASE:1.17
	OPENBSD_5_9:1.17.0.18
	OPENBSD_5_9_BASE:1.17
	OPENBSD_5_8:1.17.0.20
	OPENBSD_5_8_BASE:1.17
	OPENBSD_5_7:1.17.0.12
	OPENBSD_5_7_BASE:1.17
	OPENBSD_5_6:1.17.0.16
	OPENBSD_5_6_BASE:1.17
	OPENBSD_5_5:1.17.0.14
	OPENBSD_5_5_BASE:1.17
	OPENBSD_5_4:1.17.0.10
	OPENBSD_5_4_BASE:1.17
	OPENBSD_5_3:1.17.0.8
	OPENBSD_5_3_BASE:1.17
	OPENBSD_5_2:1.17.0.6
	OPENBSD_5_2_BASE:1.17
	OPENBSD_5_1_BASE:1.17
	OPENBSD_5_1:1.17.0.4
	OPENBSD_5_0:1.17.0.2
	OPENBSD_5_0_BASE:1.17
	OPENBSD_4_9:1.16.0.12
	OPENBSD_4_9_BASE:1.16
	OPENBSD_4_8:1.16.0.10
	OPENBSD_4_8_BASE:1.16
	OPENBSD_4_7:1.16.0.6
	OPENBSD_4_7_BASE:1.16
	OPENBSD_4_6:1.16.0.8
	OPENBSD_4_6_BASE:1.16
	OPENBSD_4_5:1.16.0.4
	OPENBSD_4_5_BASE:1.16
	OPENBSD_4_4:1.16.0.2
	OPENBSD_4_4_BASE:1.16
	OPENBSD_4_3:1.15.0.12
	OPENBSD_4_3_BASE:1.15
	OPENBSD_4_2:1.15.0.10
	OPENBSD_4_2_BASE:1.15
	OPENBSD_4_1:1.15.0.8
	OPENBSD_4_1_BASE:1.15
	OPENBSD_4_0:1.15.0.6
	OPENBSD_4_0_BASE:1.15
	OPENBSD_3_9:1.15.0.4
	OPENBSD_3_9_BASE:1.15
	OPENBSD_3_8:1.15.0.2
	OPENBSD_3_8_BASE:1.15
	OPENBSD_3_7:1.13.0.4
	OPENBSD_3_7_BASE:1.13
	OPENBSD_3_6:1.13.0.2
	OPENBSD_3_6_BASE:1.13
	SMP_SYNC_A:1.13
	SMP_SYNC_B:1.13
	OPENBSD_3_5:1.12.0.6
	OPENBSD_3_5_BASE:1.12
	OPENBSD_3_4:1.12.0.4
	OPENBSD_3_4_BASE:1.12
	UBC_SYNC_A:1.12
	OPENBSD_3_3:1.12.0.2
	OPENBSD_3_3_BASE:1.12
	OPENBSD_3_2:1.10.0.4
	OPENBSD_3_2_BASE:1.10
	OPENBSD_3_1:1.10.0.2
	OPENBSD_3_1_BASE:1.10
	UBC_SYNC_B:1.10
	UBC:1.8.0.2
	UBC_BASE:1.8
	OPENBSD_3_0:1.7.0.10
	OPENBSD_3_0_BASE:1.7
	OPENBSD_2_9:1.7.0.8
	OPENBSD_2_9_BASE:1.7
	OPENBSD_2_8:1.7.0.6
	OPENBSD_2_8_BASE:1.7
	OPENBSD_2_7:1.7.0.4
	OPENBSD_2_7_BASE:1.7
	SMP:1.7.0.2
	SMP_BASE:1.7
	kame_19991208:1.6
	OPENBSD_2_6:1.6.0.2
	OPENBSD_2_6_BASE:1.6
	OPENBSD_2_5:1.2.0.2
	OPENBSD_2_5_BASE:1.2;
locks; strict;
comment	@# @;


1.19
date	2017.06.21.23.21.35;	author deraadt;	state Exp;
branches;
next	1.18;
commitid	0uD2GnXEDYWkb589;

1.18
date	2017.06.05.18.56.30;	author deraadt;	state Exp;
branches;
next	1.17;
commitid	TReKoNF98HnKfwdS;

1.17
date	2011.04.25.20.43.40;	author kettenis;	state Exp;
branches;
next	1.16;

1.16
date	2008.06.25.22.05.21;	author miod;	state Exp;
branches;
next	1.15;

1.15
date	2005.06.21.15.56.54;	author mickey;	state Exp;
branches;
next	1.14;

1.14
date	2005.05.10.11.31.21;	author mickey;	state Exp;
branches;
next	1.13;

1.13
date	2004.04.07.18.24.19;	author mickey;	state Exp;
branches;
next	1.12;

1.12
date	2003.02.14.22.01.15;	author mickey;	state Exp;
branches;
next	1.11;

1.11
date	2003.01.31.23.42.28;	author mickey;	state Exp;
branches;
next	1.10;

1.10
date	2002.03.19.23.08.55;	author mickey;	state Exp;
branches;
next	1.9;

1.9
date	2002.03.15.21.44.14;	author mickey;	state Exp;
branches;
next	1.8;

1.8
date	2001.11.29.17.28.09;	author mickey;	state Exp;
branches
	1.8.2.1;
next	1.7;

1.7
date	99.12.17.07.02.38;	author mickey;	state Exp;
branches
	1.7.2.1;
next	1.6;

1.6
date	99.08.14.04.56.28;	author todd;	state Exp;
branches;
next	1.5;

1.5
date	99.06.22.17.46.37;	author mickey;	state Exp;
branches;
next	1.4;

1.4
date	99.05.05.02.48.12;	author mickey;	state Exp;
branches;
next	1.3;

1.3
date	99.04.20.20.34.21;	author mickey;	state Exp;
branches;
next	1.2;

1.2
date	99.02.25.16.42.42;	author mickey;	state Exp;
branches;
next	1.1;

1.1
date	98.10.30.19.44.09;	author mickey;	state Exp;
branches;
next	;

1.7.2.1
date	2001.12.05.00.39.10;	author niklas;	state Exp;
branches;
next	1.7.2.2;

1.7.2.2
date	2002.03.28.10.07.19;	author niklas;	state Exp;
branches;
next	1.7.2.3;

1.7.2.3
date	2003.03.27.23.26.53;	author niklas;	state Exp;
branches;
next	1.7.2.4;

1.7.2.4
date	2004.06.05.23.10.47;	author niklas;	state Exp;
branches;
next	;

1.8.2.1
date	2002.06.11.03.35.36;	author art;	state Exp;
branches;
next	1.8.2.2;

1.8.2.2
date	2003.05.19.21.49.41;	author tedu;	state Exp;
branches;
next	;


desc
@@


1.19
log
@Better off padding with 0x0.  0x0 = "break 0,0".

(BTW, the binutils disasm cannot handle that instruction with those
parameters, because the decoder logic is wrong..)
@
text
@/* 	$OpenBSD: ld.script,v 1.18 2017/06/05 18:56:30 deraadt Exp $	*/

/*
 * Copyright (c) 2003 Michael Shalayeff
 * All rights reserved.
 *
 * Redistribution and use in source and binary forms, with or without
 * modification, are permitted provided that the following conditions
 * are met:
 * 1. Redistributions of source code must retain the above copyright
 *    notice, this list of conditions and the following disclaimer.
 * 2. Redistributions in binary form must reproduce the above copyright
 *    notice, this list of conditions and the following disclaimer in the
 *    documentation and/or other materials provided with the distribution.
 *
 * THIS SOFTWARE IS PROVIDED BY THE AUTHOR ``AS IS'' AND ANY EXPRESS OR
 * IMPLIED WARRANTIES, INCLUDING, BUT NOT LIMITED TO, THE IMPLIED WARRANTIES
 * OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE ARE DISCLAIMED.
 * IN NO EVENT SHALL THE AUTHOR OR HIS RELATIVES BE LIABLE FOR ANY DIRECT,
 * INDIRECT, INCIDENTAL, SPECIAL, EXEMPLARY, OR CONSEQUENTIAL DAMAGES
 * (INCLUDING, BUT NOT LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR
 * SERVICES; LOSS OF MIND, USE, DATA, OR PROFITS; OR BUSINESS INTERRUPTION)
 * HOWEVER CAUSED AND ON ANY THEORY OF LIABILITY, WHETHER IN CONTRACT,
 * STRICT LIABILITY, OR TORT (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING
 * IN ANY WAY OUT OF THE USE OF THIS SOFTWARE, EVEN IF ADVISED OF
 * THE POSSIBILITY OF SUCH DAMAGE.
 */


OUTPUT_FORMAT("elf32-hppa")
OUTPUT_ARCH(hppa)
ENTRY($start)
SECTIONS
{
	. = + SIZEOF_HEADERS;
	.text :
	{
		kernel_text = . ;
		*(.text) *(.text.*)
		*(.reginfo)
		*(.init)
		*(.stub)
		/* .gnu.warning sections are handled specially by elf32.em.  */
		*(.gnu.warning)
		. = ALIGN(4096);
		etext = ABSOLUTE(.);
	} =0x00000000

	. = 0x600000;

	.rodata :
	{
		__rodata_start = .;
		*(.rodata) *(.rodata1)
		. = ALIGN(8);
		__unwind_start = .;
		*(.PARISC.unwind)
		__unwind_end = .;
		. = ALIGN(4096);
		__rodata_end = .;
	} =0x00000000
	__data_start = ABSOLUTE(.);

	.data  :
	{
		$global$ = . ;
		. += 4;
		*(.data)
		CONSTRUCTORS
		. = ALIGN(4096);
		edata = ABSOLUTE(.);
	} =0x00000000
	.ctors	: { *(.ctors) }
	.dtors	: { *(.dtors) }

	__bss_start = .;
	/* .sbss	: { *(.sbss) *(.scommon) } */
	.bss :
	{
		*(.dynbss) *(.bss)
		*(COMMON) *($COMMON$)
		. = ALIGN(4096);
	}
	end = ABSOLUTE(.);
}
@


1.18
log
@Increase kernel size, by pushing rodata 1MB forward, from 5MB to 6MB.
This seems to satisfy the BTLB granularity.  Good enough for now.
ok kettenis
@
text
@d1 1
a1 1
/* 	$OpenBSD: ld.script,v 1.17 2011/04/25 20:43:40 kettenis Exp $	*/
d47 1
a47 1
	} = 0x08000240	/* nop filled */
d61 1
a61 1
	} = 0
d72 1
a72 1
	} = 0
@


1.17
log
@Move .rodata 512KB further once more.

ok deraadt@@
@
text
@d1 1
a1 1
/* 	$OpenBSD: ld.script,v 1.16 2008/06/25 22:05:21 miod Exp $	*/
d49 1
a49 1
	. = 0x500000;
@


1.16
log
@Move .rodata 512KB further, since kernels will soon reach the address .rodata
is currently linked at. This should eventually be replaced with a proper
alignment construct in the ld script, but it's too hot and too late to
do this correctly and I need a kernel that links (containing stuff to
reach a cvs tree near you reasonably soon).
@
text
@d1 1
a1 1
/* 	$OpenBSD: ld.script,v 1.15 2005/06/21 15:56:54 mickey Exp $	*/
d49 1
a49 1
	. = 0x480000;
@


1.15
log
@move .rodata out of .text to make more space
@
text
@d1 1
a1 1
/* 	$OpenBSD: ld.script,v 1.14 2005/05/10 11:31:21 mickey Exp $	*/
d49 1
a49 1
	. = 0x400000;
@


1.14
log
@explicitly align unwind data to 8 bytes; from chs
@
text
@d1 1
a1 1
/* 	$OpenBSD: ld.script,v 1.13 2004/04/07 18:24:19 mickey Exp $	*/
d48 3
d59 1
a61 1
	. = 0x400000;
@


1.13
log
@update copyright; miod@@ is fine w/ files where he holds it too
@
text
@d1 1
a1 1
/* 	$OpenBSD: ld.script,v 1.12 2003/02/14 22:01:15 mickey Exp $	*/
d52 1
@


1.12
log
@put a copyright
@
text
@d1 2
a2 1
/* 	$OpenBSD: ld.script,v 1.11 2003/01/31 23:42:28 mickey Exp $	*/
@


1.11
log
@do not merge the rodata sections into the .text . they could be moved above 4m later should there be too much code
@
text
@d1 27
a27 1
/* 	$OpenBSD: ld.script,v 1.10 2002/03/19 23:08:55 mickey Exp $	*/
@


1.10
log
@track the gap in text
@
text
@d1 1
a1 1
/* 	$OpenBSD: ld.script,v 1.9 2002/03/15 21:44:14 mickey Exp $	*/
a7 1
	/* Read-only sections, merged into text segment: */
a12 1
		*(.rodata) *(.rodata1)
d18 7
d28 2
a29 3
		. = ALIGN(4096);
		etext = ABSOLUTE(.);
	} = 0 /* 0x08000240 nop filled, does not work cause of rodata */
d31 1
a31 1
	etext1 = ABSOLUTE(.);
a37 2
		/* [a-ps-z]*(.data) r[a-ce-z]*(.data) *libkern.o(.data) */
		/* rd_root.o(.data)	* there is an overflow bug in ld */
a54 1

@


1.9
log
@rewrite a pmap to use multilevel page tables.
lower 12 bits contain the perms, no unused bits left,
but a couple for off-tlb use (as the ref implemented now).
do not use the hvt, which might get some use later
if proven to speed thigs up, tlb handlers would po
another dozen of insns though, but if that's worth its...
move on the data seg and map kernel text rdonly (idea form fredette),
since all of the page0 mods done before that we are all fine
except for some viper fluff, but later w/ that.
this also picks up a bit more of ddb magic for bpt and ss.
tlb handlers can use a little bit more of attention,
but things, visually, seem to be much faster already, --
sorry, no benchmarks for now.

* effort sponsored in part by the `henry st. old ale house'
* and mr.pete and mr.lee in particular in thier generous entrirety.
* the proj took a little more that 72man*h as it was expected,
* but within murhy's law estimations.
@
text
@d1 1
a1 1
/* 	$OpenBSD: ld.script,v 1.8 2001/11/29 17:28:09 mickey Exp $	*/
d24 2
a25 1
	} = 0 /* 0x08000240 nop filled, does not work */
d27 1
a27 1
	etext = ABSOLUTE(.);
@


1.8
log
@ld -r generates some funky .text.N names
@
text
@d1 1
a1 1
/* 	$OpenBSD: ld.script,v 1.7 1999/12/17 07:02:38 mickey Exp $	*/
d25 1
@


1.8.2.1
log
@Sync UBC branch to -current
@
text
@d1 1
a1 1
/* 	$OpenBSD: ld.script,v 1.8 2001/11/29 17:28:09 mickey Exp $	*/
d24 2
a25 4
		etext = ABSOLUTE(.);
	} = 0 /* 0x08000240 nop filled, does not work cause of rodata */
	. = 0x400000;
	etext1 = ABSOLUTE(.);
@


1.8.2.2
log
@sync
@
text
@d1 1
a1 27
/* 	$OpenBSD$	*/
/*
 * Copyright (c) 2003 Michael Shalayeff
 * All rights reserved.
 *
 * Redistribution and use in source and binary forms, with or without
 * modification, are permitted provided that the following conditions
 * are met:
 * 1. Redistributions of source code must retain the above copyright
 *    notice, this list of conditions and the following disclaimer.
 * 2. Redistributions in binary form must reproduce the above copyright
 *    notice, this list of conditions and the following disclaimer in the
 *    documentation and/or other materials provided with the distribution.
 *
 * THIS SOFTWARE IS PROVIDED BY THE AUTHOR ``AS IS'' AND ANY EXPRESS OR
 * IMPLIED WARRANTIES, INCLUDING, BUT NOT LIMITED TO, THE IMPLIED WARRANTIES
 * OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE ARE DISCLAIMED.
 * IN NO EVENT SHALL THE AUTHOR OR HIS RELATIVES BE LIABLE FOR ANY DIRECT,
 * INDIRECT, INCIDENTAL, SPECIAL, EXEMPLARY, OR CONSEQUENTIAL DAMAGES
 * (INCLUDING, BUT NOT LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR
 * SERVICES; LOSS OF MIND, USE, DATA, OR PROFITS; OR BUSINESS INTERRUPTION)
 * HOWEVER CAUSED AND ON ANY THEORY OF LIABILITY, WHETHER IN CONTRACT,
 * STRICT LIABILITY, OR TORT (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING
 * IN ANY WAY OUT OF THE USE OF THIS SOFTWARE, EVEN IF ADVISED OF
 * THE POSSIBILITY OF SUCH DAMAGE.
 */

d8 1
d14 1
a19 7
		. = ALIGN(4096);
		etext = ABSOLUTE(.);
	} = 0x08000240	/* nop filled */
	.rodata :
	{
		__rodata_start = .;
		*(.rodata) *(.rodata1)
d23 3
a25 2
		__rodata_end = .;
	} = 0
d27 1
a27 1
	__data_start = ABSOLUTE(.);
d34 2
d53 1
@


1.7
log
@remove dirty rd_root hack once we have root on nfs working
@
text
@d1 1
a1 1
/* 	$OpenBSD: ld.script,v 1.6 1999/08/14 04:56:28 todd Exp $	*/
d13 1
a13 1
		*(.text)
@


1.7.2.1
log
@Merge in -current
@
text
@d1 1
a1 1
/* 	$OpenBSD: ld.script,v 1.7 1999/12/17 07:02:38 mickey Exp $	*/
d13 1
a13 1
		*(.text) *(.text.*)
@


1.7.2.2
log
@Merge in -current from about a week ago
@
text
@d1 1
a1 1
/* 	$OpenBSD$	*/
d24 2
a25 4
		etext = ABSOLUTE(.);
	} = 0 /* 0x08000240 nop filled, does not work cause of rodata */
	. = 0x400000;
	etext1 = ABSOLUTE(.);
@


1.7.2.3
log
@Sync the SMP branch with 3.3
@
text
@a1 26
/*
 * Copyright (c) 2003 Michael Shalayeff
 * All rights reserved.
 *
 * Redistribution and use in source and binary forms, with or without
 * modification, are permitted provided that the following conditions
 * are met:
 * 1. Redistributions of source code must retain the above copyright
 *    notice, this list of conditions and the following disclaimer.
 * 2. Redistributions in binary form must reproduce the above copyright
 *    notice, this list of conditions and the following disclaimer in the
 *    documentation and/or other materials provided with the distribution.
 *
 * THIS SOFTWARE IS PROVIDED BY THE AUTHOR ``AS IS'' AND ANY EXPRESS OR
 * IMPLIED WARRANTIES, INCLUDING, BUT NOT LIMITED TO, THE IMPLIED WARRANTIES
 * OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE ARE DISCLAIMED.
 * IN NO EVENT SHALL THE AUTHOR OR HIS RELATIVES BE LIABLE FOR ANY DIRECT,
 * INDIRECT, INCIDENTAL, SPECIAL, EXEMPLARY, OR CONSEQUENTIAL DAMAGES
 * (INCLUDING, BUT NOT LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR
 * SERVICES; LOSS OF MIND, USE, DATA, OR PROFITS; OR BUSINESS INTERRUPTION)
 * HOWEVER CAUSED AND ON ANY THEORY OF LIABILITY, WHETHER IN CONTRACT,
 * STRICT LIABILITY, OR TORT (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING
 * IN ANY WAY OUT OF THE USE OF THIS SOFTWARE, EVEN IF ADVISED OF
 * THE POSSIBILITY OF SUCH DAMAGE.
 */

d8 1
d14 1
a19 7
		. = ALIGN(4096);
		etext = ABSOLUTE(.);
	} = 0x08000240	/* nop filled */
	.rodata :
	{
		__rodata_start = .;
		*(.rodata) *(.rodata1)
d23 3
a25 2
		__rodata_end = .;
	} = 0
d27 1
a27 1
	__data_start = ABSOLUTE(.);
d34 2
d53 1
@


1.7.2.4
log
@Merge with the trunk
@
text
@a1 1

@


1.6
log
@dynamic chunks, snake style
@
text
@d1 1
a1 1
/* 	$OpenBSD: ld.script,v 1.5 1999/06/22 17:46:37 mickey Exp $	*/
d30 4
a33 3
		kernel_data = . ;
		[a-ps-z]*(.data) r[a-ce-z]*(.data) *libkern.o(.data)
		rd_root.o(.data)	/* there is an overflow bug in ld */
d36 1
a39 1
	edata = ABSOLUTE(.);
d42 1
a42 1
	.sbss	: { *(.sbss) *(.scommon) }
@


1.5
log
@why underscore if we have dollars
@
text
@d1 1
a1 1
/* 	$OpenBSD: ld.script,v 1.4 1999/05/05 02:48:12 mickey Exp $	*/
d10 1
a10 1
	.text BLOCK(4096) :
d23 1
d27 1
a27 1
	.data BLOCK(4096) :
d42 1
a42 1
	.bss BLOCK(4096) :
d50 1
@


1.4
log
@define gp in here, cleanup
@
text
@d1 1
a1 1
/* 	$OpenBSD: ld.script,v 1.3 1999/04/20 20:34:21 mickey Exp $	*/
d5 1
a5 1
ENTRY(__start)
@


1.3
log
@workaroun ld overflow bug; general cleanup, alignments, pads, and needed sections/symbols
@
text
@d1 1
a1 1
/* 	$OpenBSD: ld.script,v 1.2 1999/02/25 16:42:42 mickey Exp $	*/
d13 1
a13 1
		*(.text) *($text$)
d28 1
@


1.2
log
@specify text start through the -Ttext, fix ld.script accordingly
@
text
@d1 1
a1 1
/* 	$OpenBSD: ld.script,v 1.1 1998/10/30 19:44:09 mickey Exp $	*/
d10 1
a10 1
	.text	:
d13 2
a14 4
		*(.text)
		*($CODE$)
		*(.rodata)
		*(.rodata1)
d20 5
a24 2
	} = 0
	etext = .;
d26 1
a26 1
	.data	:
d29 2
a30 1
		*(.data)
d32 5
a36 4
	}
	.ctors	: { *(.ctors)   }
	.dtors	: { *(.dtors)   }
	edata = .;
d40 1
a40 1
	.bss	:
d42 3
a44 4
		*(.dynbss)
		*(.bss)
		*(COMMON)
		*($COMMON$)
d46 1
a46 1
	end = .;
@


1.1
log
@add ld script
@
text
@d1 1
a1 1
/* 	$OpenBSD$	*/
d9 1
a9 1
	. = 0x12000;
@

