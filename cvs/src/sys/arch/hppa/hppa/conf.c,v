head	1.66;
access;
symbols
	OPENBSD_6_2_BASE:1.66
	OPENBSD_6_1:1.66.0.4
	OPENBSD_6_1_BASE:1.66
	OPENBSD_6_0:1.64.0.2
	OPENBSD_6_0_BASE:1.64
	OPENBSD_5_9:1.63.0.2
	OPENBSD_5_9_BASE:1.63
	OPENBSD_5_8:1.62.0.6
	OPENBSD_5_8_BASE:1.62
	OPENBSD_5_7:1.62.0.2
	OPENBSD_5_7_BASE:1.62
	OPENBSD_5_6:1.58.0.6
	OPENBSD_5_6_BASE:1.58
	OPENBSD_5_5:1.58.0.4
	OPENBSD_5_5_BASE:1.58
	OPENBSD_5_4:1.56.0.2
	OPENBSD_5_4_BASE:1.56
	OPENBSD_5_3:1.55.0.2
	OPENBSD_5_3_BASE:1.55
	OPENBSD_5_2:1.54.0.4
	OPENBSD_5_2_BASE:1.54
	OPENBSD_5_1_BASE:1.54
	OPENBSD_5_1:1.54.0.2
	OPENBSD_5_0:1.53.0.4
	OPENBSD_5_0_BASE:1.53
	OPENBSD_4_9:1.53.0.2
	OPENBSD_4_9_BASE:1.53
	OPENBSD_4_8:1.51.0.2
	OPENBSD_4_8_BASE:1.51
	OPENBSD_4_7:1.48.0.2
	OPENBSD_4_7_BASE:1.48
	OPENBSD_4_6:1.46.0.4
	OPENBSD_4_6_BASE:1.46
	OPENBSD_4_5:1.45.0.2
	OPENBSD_4_5_BASE:1.45
	OPENBSD_4_4:1.44.0.2
	OPENBSD_4_4_BASE:1.44
	OPENBSD_4_3:1.41.0.4
	OPENBSD_4_3_BASE:1.41
	OPENBSD_4_2:1.41.0.2
	OPENBSD_4_2_BASE:1.41
	OPENBSD_4_1:1.36.0.6
	OPENBSD_4_1_BASE:1.36
	OPENBSD_4_0:1.36.0.4
	OPENBSD_4_0_BASE:1.36
	OPENBSD_3_9:1.36.0.2
	OPENBSD_3_9_BASE:1.36
	OPENBSD_3_8:1.34.0.2
	OPENBSD_3_8_BASE:1.34
	OPENBSD_3_7:1.32.0.4
	OPENBSD_3_7_BASE:1.32
	OPENBSD_3_6:1.32.0.2
	OPENBSD_3_6_BASE:1.32
	SMP_SYNC_A:1.30
	SMP_SYNC_B:1.30
	OPENBSD_3_5:1.30.0.2
	OPENBSD_3_5_BASE:1.30
	OPENBSD_3_4:1.27.0.2
	OPENBSD_3_4_BASE:1.27
	UBC_SYNC_A:1.26
	OPENBSD_3_3:1.25.0.2
	OPENBSD_3_3_BASE:1.25
	OPENBSD_3_2:1.22.0.2
	OPENBSD_3_2_BASE:1.22
	OPENBSD_3_1:1.17.0.2
	OPENBSD_3_1_BASE:1.17
	UBC_SYNC_B:1.22
	UBC:1.15.0.4
	UBC_BASE:1.15
	OPENBSD_3_0:1.15.0.2
	OPENBSD_3_0_BASE:1.15
	OPENBSD_2_9:1.9.0.2
	OPENBSD_2_9_BASE:1.9
	OPENBSD_2_8:1.8.0.2
	OPENBSD_2_8_BASE:1.8
	OPENBSD_2_7:1.7.0.4
	OPENBSD_2_7_BASE:1.7
	SMP:1.7.0.2
	SMP_BASE:1.7
	kame_19991208:1.6
	OPENBSD_2_6:1.5.0.2
	OPENBSD_2_6_BASE:1.5
	OPENBSD_2_5:1.2.0.2
	OPENBSD_2_5_BASE:1.2;
locks; strict;
comment	@ * @;


1.66
date	2016.09.04.10.51.23;	author naddy;	state Exp;
branches;
next	1.65;
commitid	4OWaAfwqMvhOCLOI;

1.65
date	2016.09.02.17.06.12;	author goda;	state Exp;
branches;
next	1.64;
commitid	J1JzeTsS8K8zyH3c;

1.64
date	2016.04.25.20.09.14;	author tedu;	state Exp;
branches;
next	1.63;
commitid	43yo2G4zZOY9ab4i;

1.63
date	2015.10.23.15.10.52;	author claudio;	state Exp;
branches;
next	1.62;
commitid	g17gxjQh9N9egLbB;

1.62
date	2014.12.11.19.44.17;	author tedu;	state Exp;
branches;
next	1.61;
commitid	jUSAZlQ30WF1ESM9;

1.61
date	2014.10.09.04.10.03;	author tedu;	state Exp;
branches;
next	1.60;
commitid	Db8IHIncfKM3SDX9;

1.60
date	2014.10.09.03.59.58;	author tedu;	state Exp;
branches;
next	1.59;
commitid	I0KLtD9aVxAdm6aW;

1.59
date	2014.08.20.06.14.42;	author mikeb;	state Exp;
branches;
next	1.58;
commitid	qXFkosC6o9cv78HT;

1.58
date	2013.11.04.14.11.29;	author deraadt;	state Exp;
branches;
next	1.57;

1.57
date	2013.08.20.14.27.27;	author ajacoutot;	state Exp;
branches;
next	1.56;

1.56
date	2013.06.03.15.54.47;	author tedu;	state Exp;
branches;
next	1.55;

1.55
date	2012.08.23.06.12.49;	author deraadt;	state Exp;
branches;
next	1.54;

1.54
date	2011.10.06.20.49.28;	author deraadt;	state Exp;
branches;
next	1.53;

1.53
date	2011.01.14.19.04.08;	author jasper;	state Exp;
branches;
next	1.52;

1.52
date	2010.09.23.05.02.14;	author claudio;	state Exp;
branches;
next	1.51;

1.51
date	2010.07.03.03.59.16;	author krw;	state Exp;
branches;
next	1.50;

1.50
date	2010.06.09.15.25.32;	author jsing;	state Exp;
branches;
next	1.49;

1.49
date	2010.03.30.19.16.09;	author matthieu;	state Exp;
branches;
next	1.48;

1.48
date	2009.08.13.15.10.26;	author dlg;	state Exp;
branches;
next	1.47;

1.47
date	2009.08.13.15.04.20;	author dlg;	state Exp;
branches;
next	1.46;

1.46
date	2009.06.03.14.45.51;	author jj;	state Exp;
branches;
next	1.45;

1.45
date	2009.01.25.17.30.48;	author miod;	state Exp;
branches;
next	1.44;

1.44
date	2008.06.12.20.03.48;	author mglocker;	state Exp;
branches;
next	1.43;

1.43
date	2008.05.14.20.49.48;	author miod;	state Exp;
branches;
next	1.42;

1.42
date	2008.04.08.14.31.54;	author claudio;	state Exp;
branches;
next	1.41;

1.41
date	2007.07.15.19.25.49;	author kettenis;	state Exp;
branches;
next	1.40;

1.40
date	2007.05.28.22.26.03;	author todd;	state Exp;
branches;
next	1.39;

1.39
date	2007.05.27.01.50.36;	author todd;	state Exp;
branches;
next	1.38;

1.38
date	2007.05.26.19.54.24;	author todd;	state Exp;
branches;
next	1.37;

1.37
date	2007.04.18.19.49.53;	author todd;	state Exp;
branches;
next	1.36;

1.36
date	2006.01.11.21.57.53;	author martin;	state Exp;
branches;
next	1.35;

1.35
date	2005.12.31.22.41.36;	author miod;	state Exp;
branches;
next	1.34;

1.34
date	2005.07.31.06.39.06;	author dlg;	state Exp;
branches;
next	1.33;

1.33
date	2005.06.21.17.43.34;	author martin;	state Exp;
branches;
next	1.32;

1.32
date	2004.08.06.20.29.47;	author mickey;	state Exp;
branches;
next	1.31;

1.31
date	2004.06.17.11.27.48;	author mickey;	state Exp;
branches;
next	1.30;

1.30
date	2004.02.10.01.31.21;	author millert;	state Exp;
branches;
next	1.29;

1.29
date	2003.12.09.04.25.56;	author mickey;	state Exp;
branches;
next	1.28;

1.28
date	2003.09.23.16.51.11;	author millert;	state Exp;
branches;
next	1.27;

1.27
date	2003.06.02.23.27.46;	author millert;	state Exp;
branches;
next	1.26;

1.26
date	2003.05.14.00.20.37;	author tedu;	state Exp;
branches;
next	1.25;

1.25
date	2003.02.08.12.34.27;	author todd;	state Exp;
branches;
next	1.24;

1.24
date	2003.01.25.19.46.02;	author jason;	state Exp;
branches;
next	1.23;

1.23
date	2002.12.05.02.49.55;	author kjc;	state Exp;
branches;
next	1.22;

1.22
date	2002.10.01.21.03.30;	author mickey;	state Exp;
branches;
next	1.21;

1.21
date	2002.07.10.22.08.47;	author mickey;	state Exp;
branches;
next	1.20;

1.20
date	2002.06.11.05.15.18;	author miod;	state Exp;
branches;
next	1.19;

1.19
date	2002.05.16.21.40.12;	author mickey;	state Exp;
branches;
next	1.18;

1.18
date	2002.05.16.21.11.14;	author miod;	state Exp;
branches;
next	1.17;

1.17
date	2002.03.16.00.34.56;	author mickey;	state Exp;
branches;
next	1.16;

1.16
date	2002.03.15.22.50.05;	author mickey;	state Exp;
branches;
next	1.15;

1.15
date	2001.09.28.02.53.13;	author mickey;	state Exp;
branches
	1.15.4.1;
next	1.14;

1.14
date	2001.08.12.20.20.42;	author mickey;	state Exp;
branches;
next	1.13;

1.13
date	2001.08.06.22.34.43;	author mickey;	state Exp;
branches;
next	1.12;

1.12
date	2001.08.01.20.30.58;	author miod;	state Exp;
branches;
next	1.11;

1.11
date	2001.06.27.06.56.28;	author kjc;	state Exp;
branches;
next	1.10;

1.10
date	2001.06.25.03.19.55;	author kjell;	state Exp;
branches;
next	1.9;

1.9
date	2001.04.01.06.25.33;	author mickey;	state Exp;
branches;
next	1.8;

1.8
date	2000.09.26.14.03.52;	author art;	state Exp;
branches;
next	1.7;

1.7
date	2000.01.17.06.59.34;	author mickey;	state Exp;
branches
	1.7.2.1;
next	1.6;

1.6
date	99.11.16.17.02.16;	author mickey;	state Exp;
branches;
next	1.5;

1.5
date	99.05.05.02.43.17;	author mickey;	state Exp;
branches;
next	1.4;

1.4
date	99.05.05.02.40.34;	author mickey;	state Exp;
branches;
next	1.3;

1.3
date	99.04.20.20.38.11;	author mickey;	state Exp;
branches;
next	1.2;

1.2
date	98.12.23.17.55.36;	author mickey;	state Exp;
branches;
next	1.1;

1.1
date	98.11.09.13.00.56;	author mickey;	state Exp;
branches;
next	;

1.7.2.1
date	2001.04.18.16.06.06;	author niklas;	state Exp;
branches;
next	1.7.2.2;

1.7.2.2
date	2001.07.04.10.16.02;	author niklas;	state Exp;
branches;
next	1.7.2.3;

1.7.2.3
date	2001.10.31.02.52.47;	author nate;	state Exp;
branches;
next	1.7.2.4;

1.7.2.4
date	2002.03.28.10.07.19;	author niklas;	state Exp;
branches;
next	1.7.2.5;

1.7.2.5
date	2003.03.27.23.26.53;	author niklas;	state Exp;
branches;
next	1.7.2.6;

1.7.2.6
date	2003.05.16.00.29.38;	author niklas;	state Exp;
branches;
next	1.7.2.7;

1.7.2.7
date	2003.06.07.11.11.36;	author ho;	state Exp;
branches;
next	1.7.2.8;

1.7.2.8
date	2004.02.19.10.48.40;	author niklas;	state Exp;
branches;
next	1.7.2.9;

1.7.2.9
date	2004.06.05.23.10.48;	author niklas;	state Exp;
branches;
next	;

1.15.4.1
date	2002.06.11.03.35.36;	author art;	state Exp;
branches;
next	1.15.4.2;

1.15.4.2
date	2002.10.29.00.28.02;	author art;	state Exp;
branches;
next	1.15.4.3;

1.15.4.3
date	2003.05.19.21.49.41;	author tedu;	state Exp;
branches;
next	;


desc
@@


1.66
log
@Remove support for tape block devices. Nobody mount(8)s tapes any longer.
ok deraadt@@ guenther@@
@
text
@/*	$OpenBSD: conf.c,v 1.65 2016/09/02 17:06:12 goda Exp $	*/

/*-
 * Copyright (c) 1991 The Regents of the University of California.
 * All rights reserved.
 *
 * Redistribution and use in source and binary forms, with or without
 * modification, are permitted provided that the following conditions
 * are met:
 * 1. Redistributions of source code must retain the above copyright
 *    notice, this list of conditions and the following disclaimer.
 * 2. Redistributions in binary form must reproduce the above copyright
 *    notice, this list of conditions and the following disclaimer in the
 *    documentation and/or other materials provided with the distribution.
 * 3. Neither the name of the University nor the names of its contributors
 *    may be used to endorse or promote products derived from this software
 *    without specific prior written permission.
 *
 * THIS SOFTWARE IS PROVIDED BY THE REGENTS AND CONTRIBUTORS ``AS IS'' AND
 * ANY EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT LIMITED TO, THE
 * IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE
 * ARE DISCLAIMED.  IN NO EVENT SHALL THE REGENTS OR CONTRIBUTORS BE LIABLE
 * FOR ANY DIRECT, INDIRECT, INCIDENTAL, SPECIAL, EXEMPLARY, OR CONSEQUENTIAL
 * DAMAGES (INCLUDING, BUT NOT LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS
 * OR SERVICES; LOSS OF USE, DATA, OR PROFITS; OR BUSINESS INTERRUPTION)
 * HOWEVER CAUSED AND ON ANY THEORY OF LIABILITY, WHETHER IN CONTRACT, STRICT
 * LIABILITY, OR TORT (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY
 * OUT OF THE USE OF THIS SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF
 * SUCH DAMAGE.
 *
 *     @@(#)conf.c	7.9 (Berkeley) 5/28/91
 */

#include <sys/param.h>
#include <sys/systm.h>
#include <sys/buf.h>
#include <sys/ioctl.h>
#include <sys/tty.h>
#include <sys/vnode.h>

#include <machine/conf.h>

#include "vnd.h"
#include "rd.h"
#include "sd.h"
#include "st.h"
#include "cd.h"
#include "ch.h"
#include "uk.h"
#include "wd.h"
bdev_decl(wd);
cdev_decl(wd);
#if 0
#include "fd.h"
#else
#define NFD 0
#endif
bdev_decl(fd);
cdev_decl(fd);

struct bdevsw   bdevsw[] =
{
	bdev_swap_init(1,sw),		/*  0: swap pseudo-device */
	bdev_notdef(),			/*  1: was: concatenated disk driver */
	bdev_disk_init(NVND,vnd),	/*  2: vnode disk driver */
	bdev_disk_init(NRD,rd),		/*  3: RAM disk */
	bdev_disk_init(NSD,sd),		/*  4: SCSI disk */
	bdev_notdef(),			/*  5: was: SCSI tape */
	bdev_disk_init(NCD,cd),		/*  6: SCSI CD-ROM */
	bdev_disk_init(NFD,fd),		/*  7: floppy drive */
	bdev_disk_init(NWD,wd),		/*  8: ST506 drive */
	bdev_notdef(),			/*  9: */
	bdev_notdef(),			/* 10: */
	bdev_notdef(),			/* 11: */
	bdev_notdef(),			/* 12: */
	bdev_notdef(),			/* 13: */
	bdev_notdef(),			/* 14: */
};
int	nblkdev = nitems(bdevsw);

#include "audio.h"
#include "video.h"
#include "bio.h"
#include "pty.h"
#include "wsdisplay.h"
#include "wskbd.h"
#include "wsmouse.h"
#include "wsmux.h"

#include "bpfilter.h"
#include "tun.h"

#include "ksyms.h"

#include "lpt.h"
cdev_decl(lpt);

#include "com.h"
cdev_decl(com);

#include "pf.h"

#include "hotplug.h"
#include "vscsi.h"
#include "pppx.h"

#ifdef USER_PCICONF
#include "pci.h"
cdev_decl(pci);
#endif

#include "usb.h"
#include "uhid.h"
#include "ugen.h"
#include "ulpt.h"
#include "ucom.h"

#include "fuse.h"
#include "switch.h"

struct cdevsw   cdevsw[] =
{
	cdev_cn_init(1,cn),		/*  0: virtual console */
	cdev_ctty_init(1,ctty),		/*  1: controlling terminal */
	cdev_mm_init(1,mm),		/*  2: /dev/{null,mem,kmem,...} */
	cdev_notdef(),			/*  3 was /dev/drum */
	cdev_tty_init(NPTY,pts),	/*  4: pseudo-tty slave */
	cdev_ptc_init(NPTY,ptc),	/*  5: pseudo-tty master */
	cdev_log_init(1,log),		/*  6: /dev/klog */
	cdev_notdef(),			/*  7: was: concatenated disk */
	cdev_disk_init(NVND,vnd),	/*  8: vnode disk driver */
	cdev_disk_init(NRD,rd),		/*  9: RAM disk */
	cdev_disk_init(NSD,sd),		/* 10: SCSI disk */
	cdev_tape_init(NST,st),		/* 11: SCSI tape */
	cdev_disk_init(NCD,cd),		/* 12: SCSI cd-rom */
	cdev_ch_init(NCH,ch),		/* 13: SCSI changer */
	cdev_notdef(),			/* 14: */
	cdev_uk_init(NUK,uk),		/* 15: SCSI unknown */
	cdev_fd_init(1,filedesc),	/* 16: file descriptor pseudo-device */
	cdev_bpf_init(NBPFILTER,bpf),	/* 17: Berkeley packet filter */
	cdev_tun_init(NTUN,tun),	/* 18: network tunnel */
	cdev_notdef(),			/* 19: was LKM */
	cdev_random_init(1,random),	/* 20: random generator */
	cdev_pf_init(NPF,pf),		/* 21: packet filter */
	cdev_tty_init(1,pdc),		/* 22: PDC device */
	cdev_tty_init(NCOM,com),	/* 23: RS232 */
	cdev_disk_init(NFD,fd),		/* 24: floppy drive */
	cdev_ksyms_init(NKSYMS,ksyms),	/* 25: Kernel symbols device */
	cdev_lpt_init(NLPT,lpt),	/* 26: parallel printer */
	cdev_wsdisplay_init(NWSDISPLAY,	/* 27: workstation console */
	    wsdisplay),
	cdev_mouse_init(NWSKBD,wskbd),	/* 28: keyboards */
	cdev_mouse_init(NWSMOUSE,wsmouse), /* 29: mice */
	cdev_mouse_init(NWSMUX,wsmux),	/* 30: mux */
#ifdef USER_PCICONF
	cdev_pci_init(NPCI,pci),	/* 31: PCI user */
#else
	cdev_notdef(),			/* 31: */
#endif
	cdev_notdef(),			/* 32 */
	cdev_video_init(NVIDEO,video),	/* 33: generic video I/O */
	cdev_notdef(),			/* 34 */
	cdev_audio_init(NAUDIO,audio),	/* 35: /dev/audio */
	cdev_notdef(),			/* 36: was: /dev/crypto */
	cdev_bio_init(NBIO,bio),	/* 37: ioctl tunnel */
	cdev_ptm_init(NPTY,ptm),	/* 38: pseudo-tty ptm device */
	cdev_disk_init(NWD,wd),		/* 39: ST506 disk */
	cdev_usb_init(NUSB,usb),	/* 40: USB controller */
	cdev_usbdev_init(NUHID,uhid),	/* 41: USB generic HID */
	cdev_usbdev_init(NUGEN,ugen),	/* 42: USB generic driver */
	cdev_ulpt_init(NULPT,ulpt),	/* 43: USB printers */
	cdev_notdef(),			/* 44: was urio */
	cdev_tty_init(NUCOM,ucom),	/* 45: USB tty */
	cdev_notdef(),			/* 46: was USB scanners */
	cdev_hotplug_init(NHOTPLUG,hotplug), /* 47: devices hot plugging */
	cdev_notdef(),			/* 48: */
	cdev_notdef(),			/* 49: */
	cdev_notdef(),			/* 50: */
	cdev_notdef(),			/* 51: */
	cdev_notdef(),			/* 52: */
	cdev_notdef(),			/* 53: */
	cdev_vscsi_init(NVSCSI,vscsi),	/* 54: vscsi */
	cdev_notdef(),
	cdev_disk_init(1,diskmap),	/* 56: disk mapper */
	cdev_pppx_init(NPPPX,pppx),	/* 57: pppx */
	cdev_fuse_init(NFUSE,fuse),	/* 58: fuse */
	cdev_tun_init(NTUN,tap),	/* 59: Ethernet network tunnel */
	cdev_switch_init(NSWITCH,switch), /* 60: switch(4) control interface */
};
int nchrdev = nitems(cdevsw);

int mem_no = 2;		/* major device number of memory special file */

/*
 * Swapdev is a fake device implemented
 * in sw.c used only internally to get to swstrategy.
 * It cannot be provided to the users, because the
 * swstrategy routine munches the b_dev and b_blkno entries
 * before calling the appropriate driver.  This would horribly
 * confuse, e.g. the hashing routines. Instead, /dev/drum is
 * provided as a character (raw) device.
 */
dev_t   swapdev = makedev(0, 0);

int chrtoblktbl[] = {
	/*VCHR*/	/*VBLK*/
	/*  0 */	NODEV,
	/*  1 */	NODEV,
	/*  2 */	NODEV,
	/*  3 */	NODEV,
	/*  4 */	NODEV,
	/*  5 */	NODEV,
	/*  6 */	NODEV,
	/*  7 */	NODEV,
	/*  8 */	2,		/* vnd */
	/*  9 */	3,		/* rd */
	/* 10 */	4,		/* sd */
	/* 11 */	NODEV,
	/* 12 */	6,		/* cd */
	/* 13 */	NODEV,
	/* 14 */	NODEV,
	/* 15 */	NODEV,
	/* 16 */	NODEV,
	/* 17 */	NODEV,
	/* 18 */	NODEV,
	/* 19 */	NODEV,
	/* 20 */	NODEV,
	/* 21 */	NODEV,
	/* 22 */	NODEV,
	/* 23 */	NODEV,
	/* 24 */	7,		/* fd */
	/* 25 */	NODEV,
	/* 26 */	NODEV,
	/* 27 */	NODEV,
	/* 28 */	NODEV,
	/* 29 */	NODEV,
	/* 30 */	NODEV,
	/* 31 */	NODEV,
	/* 32 */	NODEV,
	/* 33 */	NODEV,
	/* 34 */	NODEV,
	/* 35 */	NODEV,
	/* 36 */	NODEV,
	/* 37 */	NODEV,
	/* 38 */	NODEV,
	/* 39 */	8,		/* wd */
};
int nchrtoblktbl = nitems(chrtoblktbl);

/*
 * Returns true if dev is /dev/zero.
 */
int
iszerodev(dev)
	dev_t dev;
{
	return (major(dev) == mem_no && minor(dev) == 12);
}

dev_t
getnulldev()
{
	return makedev(mem_no, 2);
}

/*
 * Returns true if dev is /dev/mem or /dev/kmem.
 */
int
iskmemdev(dev)
	dev_t dev;
{
	return (major(dev) == mem_no && minor(dev) < 2);
}
@


1.65
log
@Add switch(4) cdev entry

ok deraadt@@ yasuoka@@ reyk@@
@
text
@d1 1
a1 1
/*	$OpenBSD: conf.c,v 1.64 2016/04/25 20:09:14 tedu Exp $	*/
d68 1
a68 1
	bdev_tape_init(NST,st),		/*  5: SCSI tape */
d218 1
a218 1
	/* 11 */	5,		/* st */
@


1.64
log
@remove systrace
@
text
@d1 1
a1 1
/*	$OpenBSD: conf.c,v 1.63 2015/10/23 15:10:52 claudio Exp $	*/
d119 1
d188 1
@


1.63
log
@Allocate a new major for tap(4) also note that pseudo-device tun is for tap
as well. OK dlg@@ mpi@@
@
text
@d1 1
a1 1
/*	$OpenBSD: conf.c,v 1.62 2014/12/11 19:44:17 tedu Exp $	*/
a102 1
#include "systrace.h"
d159 1
a159 1
	cdev_notdef(),
d161 1
a161 1
	cdev_systrace_init(NSYSTRACE,systrace),	/* 34: system call tracing */
@


1.62
log
@dragonflybsd has added a urio driver. conservation of urios requires
that we delete ours, which isn't actually useful.
ok mpi sthen
@
text
@d1 1
a1 1
/*	$OpenBSD: conf.c,v 1.61 2014/10/09 04:10:03 tedu Exp $	*/
d187 1
@


1.61
log
@mechanical translation of dev_lkm_dummy() to dev_notdef()
@
text
@d1 1
a1 1
/*	$OpenBSD: conf.c,v 1.60 2014/10/09 03:59:58 tedu Exp $	*/
a116 1
#include "urio.h"
d172 1
a172 1
	cdev_urio_init(NURIO,urio),	/* 44: USB Diamond Rio 500 */
@


1.60
log
@remove LKM devices
@
text
@d1 1
a1 1
/*	$OpenBSD: conf.c,v 1.59 2014/08/20 06:14:42 mikeb Exp $	*/
d72 6
a77 6
	bdev_lkm_dummy(),		/*  9: */
	bdev_lkm_dummy(),		/* 10: */
	bdev_lkm_dummy(),		/* 11: */
	bdev_lkm_dummy(),		/* 12: */
	bdev_lkm_dummy(),		/* 13: */
	bdev_lkm_dummy(),		/* 14: */
d177 6
a182 6
	cdev_lkm_dummy(),		/* 48: */
	cdev_lkm_dummy(),		/* 49: */
	cdev_lkm_dummy(),		/* 50: */
	cdev_lkm_dummy(),		/* 51: */
	cdev_lkm_dummy(),		/* 52: */
	cdev_lkm_dummy(),		/* 53: */
@


1.59
log
@unlink crypto(4) pseudo device from the architecture dependant character
device tables and kernel config files.  ok deraadt
@
text
@d1 1
a1 1
/*	$OpenBSD: conf.c,v 1.58 2013/11/04 14:11:29 deraadt Exp $	*/
d143 1
a143 1
	cdev_lkm_init(NLKM,lkm),	/* 19: loadable module driver */
a204 1
	/* XXXX This needs to be dynamic for LKMs. */
@


1.58
log
@remove iop(4) driver.  it is entirely unmaintained and supports something
which basically doesn't exist at all.
reminded about it by brad
@
text
@d1 1
a1 1
/*	$OpenBSD: conf.c,v 1.57 2013/08/20 14:27:27 ajacoutot Exp $	*/
a89 1
#include "inet.h"
d165 1
a165 1
	cdev_crypto_init(NCRYPTO,crypto), /* 36: /dev/crypto */
@


1.57
log
@Remove uscanner(4). It was disabled in GENERIC more than 2.5 years ago.
No regression has been reported since libusb became the prefered
solution to work with USB scanners.

req. by mpi@@
ok ian@@ mpi@@ miod@@
@
text
@d1 1
a1 1
/*	$OpenBSD: conf.c,v 1.56 2013/06/03 15:54:47 tedu Exp $	*/
a120 1
#include "bthub.h"
d185 1
a185 1
	cdev_bthub_init(NBTHUB,bthub),	/* 55: bthub */
@


1.56
log
@changes for isc fuse support. not enabled. ok beck deraadt.
from Sylvestre Gallon ccna.syl gmail.com
@
text
@d1 1
a1 1
/*	$OpenBSD: conf.c,v 1.55 2012/08/23 06:12:49 deraadt Exp $	*/
a119 1
#include "uscanner.h"
d177 1
a177 1
	cdev_usbdev_init(NUSCANNER,uscanner), /* 46: USB scanners */
@


1.55
log
@kill nnpfs dead
@
text
@d1 1
a1 1
/*	$OpenBSD: conf.c,v 1.54 2011/10/06 20:49:28 deraadt Exp $	*/
d123 1
d190 1
@


1.54
log
@ccd goes to the attic
discussed with jsing and millert
@
text
@d1 1
a1 1
/*	$OpenBSD: conf.c,v 1.53 2011/01/14 19:04:08 jasper Exp $	*/
a88 4
#ifdef NNPFS
#include <nnpfs/nnnpfs.h>
cdev_decl(nnpfs_dev);
#endif
a162 3
#ifdef NNPFS
	cdev_nnpfs_init(NNNPFS,nnpfs_dev),	/* 32: nnpfs communication device */
#else
a163 1
#endif
@


1.53
log
@- use nitems()

"doesn't hurt" deraadt@@
@
text
@d1 1
a1 1
/*	$OpenBSD: conf.c,v 1.52 2010/09/23 05:02:14 claudio Exp $	*/
a42 1
#include "ccd.h"
d64 1
a64 1
	bdev_disk_init(NCCD,ccd),	/*  1: concatenated disk driver */
d137 1
a137 1
	cdev_disk_init(NCCD,ccd),	/*  7: concatenated disk */
d223 1
a223 1
	/*  7 */	1,		/* ccd */
@


1.52
log
@Add pppx(4) to the cdevs of the remaining archs.
OK dlg@@
@
text
@d1 1
a1 1
/*	$OpenBSD: conf.c,v 1.51 2010/07/03 03:59:16 krw Exp $	*/
d80 1
a80 1
int	nblkdev = sizeof(bdevsw) / sizeof(bdevsw[0]);
d199 1
a199 1
int nchrdev = sizeof(cdevsw) / sizeof(cdevsw[0]);
d258 1
a258 1
int nchrtoblktbl = sizeof(chrtoblktbl) / sizeof(chrtoblktbl[0]);
@


1.51
log
@No more ss(4) or usscanner(4). Unused, unloved and unmaintained.
General huzzahs.

"go for it" deraadt@@
@
text
@d1 1
a1 1
/*	$OpenBSD: conf.c,v 1.50 2010/06/09 15:25:32 jsing Exp $	*/
d112 1
d197 1
@


1.50
log
@Wire up device nodes for disk mapper.

ok deraadt@@
@
text
@d1 1
a1 1
/*	$OpenBSD: conf.c,v 1.48 2009/08/13 15:10:26 dlg Exp $	*/
a49 1
#include "ss.h"
d144 1
a144 1
	cdev_ss_init(NSS,ss),		/* 14: SCSI scanner */
@


1.49
log
@Add missing bthub device entries on arches that support bluetooth.
ok miod@@, deraadt@@, todd@@.
@
text
@d196 1
@


1.48
log
@i forgot a comment
@
text
@d1 1
a1 1
/*	$OpenBSD: conf.c,v 1.47 2009/08/13 15:04:20 dlg Exp $	*/
d127 2
d195 1
@


1.47
log
@wire vscsi up to a cdev

for claudio@@ ok deraadt@@
@
text
@d1 1
a1 1
/*	$OpenBSD: conf.c,v 1.46 2009/06/03 14:45:51 jj Exp $	*/
d192 1
a192 1
	cdev_vscsi_init(NVSCSI,vscsi),	/* 54: */
@


1.46
log
@Arla client rename from xfs to nnpfs for later upgrades. Tested on various arches. ok todd@@ beck@@
@
text
@d1 1
a1 1
/*	$OpenBSD: conf.c,v 1.45 2009/01/25 17:30:48 miod Exp $	*/
d112 1
d192 1
@


1.45
log
@Remove /dev/drum and related code.
@
text
@d1 1
a1 1
/*	$OpenBSD: conf.c,v 1.44 2008/06/12 20:03:48 mglocker Exp $	*/
d91 3
a93 3
#ifdef XFS
#include <xfs/nxfs.h>
cdev_decl(xfs_dev);
d165 2
a166 2
#ifdef XFS
	cdev_xfs_init(NXFS,xfs_dev),	/* 32: xfs communication device */
@


1.44
log
@Enable /dev/video* for all USB capable archs.  MAKEDEV bits will follow
shortly.

OK todd@@
@
text
@d1 1
a1 1
/*	$OpenBSD: conf.c,v 1.43 2008/05/14 20:49:48 miod Exp $	*/
d131 1
a131 1
	cdev_swap_init(1,sw),		/*  3: /dev/drum (swap pseudo-device) */
@


1.43
log
@Fix more chrtoblktbl[] sloppyness, and add proper block st nodes to *ppc and
sgi.
@
text
@d1 1
a1 1
/*	$OpenBSD: conf.c,v 1.42 2008/04/08 14:31:54 claudio Exp $	*/
d84 1
d170 1
a170 1
	cdev_notdef(),			/* 33: ALTQ (deprecated) */
@


1.42
log
@Split the cdev makro for bpftun into two seperate definitions. tun(4) and
bpf(4) are different enough so that the split makes sense -- this is necessary
to make bpf(4) cloneable.
requested deraadt@@, OK thib@@
@
text
@d1 1
a1 1
/*	$OpenBSD: conf.c,v 1.41 2007/07/15 19:25:49 kettenis Exp $	*/
d216 6
a221 6
	/*  7 */	1,
	/*  8 */	2,
	/*  9 */	3,
	/* 10 */	4,
	/* 11 */	5,
	/* 12 */	6,
d233 1
a233 1
	/* 24 */	7,
d248 1
a248 8
	/* 39 */	NODEV,
	/* 40 */	NODEV,
	/* 41 */	NODEV,
	/* 42 */	NODEV,
	/* 43 */	NODEV,
	/* 44 */	NODEV,
	/* 45 */	NODEV,
	/* 46 */	NODEV
@


1.41
log
@Delay switching to the real serial console until we attach the serial device.
The variety of different serial devices is just too big to make a decision up
front.  This should make the second serial port on four-digit B/C/J-class
workstation work as a serial console too.

ok miod@@
@
text
@d1 1
a1 1
/*	$OpenBSD: conf.c,v 1.40 2007/05/28 22:26:03 todd Exp $	*/
d144 2
a145 2
	cdev_bpftun_init(NBPFILTER,bpf),/* 17: Berkeley packet filter */
	cdev_bpftun_init(NTUN,tun),	/* 18: network tunnel */
@


1.40
log
@bio for all archs, ok krw@@ kettenis@@ sounds good marco@@ go for it deraadt@@
@
text
@d1 1
a1 1
/*	$OpenBSD: conf.c,v 1.39 2007/05/27 01:50:36 todd Exp $	*/
a283 18

#include <dev/cons.h>

cons_decl(pdc);
cons_decl(ws);
cons_decl(com);

struct  consdev constab[] = {
	cons_init(pdc),		/* XXX you'd better leave it here for pdc.c */
#if NWSDISPLAY > 0
	cons_init(ws),
#endif
#if NCOM > 0
	cons_init(com),
#endif
	{ 0 }
};

@


1.39
log
@back out bio, breaks dlg's sparc64 v215
prompted by/ok dlg@@ deraadt@@
@
text
@d1 1
a1 1
/*	$OpenBSD: conf.c,v 1.38 2007/05/26 19:54:24 todd Exp $	*/
d84 1
d173 1
a173 1
	cdev_notdef(),			/* 37: */
@


1.38
log
@prodded by marco, enable bio everywhere
grudgingly ok deraadt@@
@
text
@d1 1
a1 1
/*	$OpenBSD: conf.c,v 1.37 2007/04/18 19:49:53 todd Exp $	*/
a83 1
#include "bio.h"
d172 1
a172 1
	cdev_bio_init(NBIO,bio),	/* 37: ioctl tunnel */
@


1.37
log
@tidy - number unused cdev_/bdev_ slots
ok miod@@ kettenis@@
@
text
@d1 1
a1 1
/*	$OpenBSD: conf.c,v 1.36 2006/01/11 21:57:53 martin Exp $	*/
d84 1
d173 1
a173 1
	cdev_notdef(),			/* 37: */
@


1.36
log
@hotplug(4) and hotplugd(8) here
@
text
@d1 1
a1 1
/*	$OpenBSD: conf.c,v 1.35 2005/12/31 22:41:36 miod Exp $	*/
d74 6
a79 7
					/*  9: */
	bdev_lkm_dummy(),
	bdev_lkm_dummy(),
	bdev_lkm_dummy(),
	bdev_lkm_dummy(),
	bdev_lkm_dummy(),
	bdev_lkm_dummy(),
d161 1
a161 1
	cdev_notdef(),
d172 1
a172 1
	cdev_notdef(),			/* 37 */
d183 6
a188 6
	cdev_lkm_dummy(),
	cdev_lkm_dummy(),
	cdev_lkm_dummy(),
	cdev_lkm_dummy(),
	cdev_lkm_dummy(),
	cdev_lkm_dummy(),
@


1.35
log
@Nuke unused cdev_wscons_init() macro.
@
text
@d1 1
a1 1
/*	$OpenBSD: conf.c,v 1.34 2005/07/31 06:39:06 dlg Exp $	*/
d110 1
d183 1
@


1.34
log
@remove the config glue between the /dev entry for ses and its driver

sure deraadt@@
@
text
@d1 1
a1 1
/*	$OpenBSD: conf.c,v 1.33 2005/06/21 17:43:34 martin Exp $	*/
a82 6

/* open, close, read, write, ioctl, tty, mmap */
#define cdev_wscons_init(c,n) { \
	dev_init(c,n,open), dev_init(c,n,close), dev_init(c,n,read), \
	dev_init(c,n,write), dev_init(c,n,ioctl), dev_init(c,n,stop), \
	dev_init(c,n,tty), ttpoll, dev_init(c,n,mmap) }
@


1.33
log
@USB support

ok mickey@@
@
text
@d1 1
a1 1
/*	$OpenBSD: conf.c,v 1.32 2004/08/06 20:29:47 mickey Exp $	*/
a50 1
#include "ses.h"
d178 1
a178 1
	cdev_ses_init(NSES,ses),	/* 37: SCSI SES/SAF-TE */
@


1.32
log
@support cardbus bridges and a few pcmcia devices i have working
@
text
@d1 1
a1 1
/*	$OpenBSD: conf.c,v 1.31 2004/06/17 11:27:48 mickey Exp $	*/
d123 8
d182 7
d254 7
@


1.31
log
@betterer swapdev
@
text
@d1 1
a1 1
/*	$OpenBSD: conf.c,v 1.30 2004/02/10 01:31:21 millert Exp $	*/
d53 3
d74 2
a75 1
					/*  8: */
d165 1
a165 1
	cdev_notdef(),			/* 32 */
d173 1
d223 16
a238 3
	/* 24 */	NODEV,
	/* 25 */	7,
	/* 25 */	8,
@


1.30
log
@Add the ptm device to pty(4).  By opening /dev/ptm and using the PTMGET
ioctl(2), an unprivileged process may allocate a pty and have its owner
and mode set appropriately.  This means that programs such as xterm and
screen no longer need to be setuid.  Programs using the openpty()
function require zero changes and will "just work".

Designed by beck@@ and deraadt@@; changes by beck@@ with cleanup (and
a rewrite of the vnode bits) by art@@ and tweaks/bugfixes by me.
Tested by many.
@
text
@d1 1
a1 1
/*	$OpenBSD: conf.c,v 1.29 2003/12/09 04:25:56 mickey Exp $	*/
d189 1
a189 1
dev_t   swapdev = makedev(1, 0);
@


1.29
log
@allow for user pci conf
@
text
@d1 1
a1 1
/*	$OpenBSD: conf.c,v 1.28 2003/09/23 16:51:11 millert Exp $	*/
d168 1
@


1.28
log
@Replace select backends with poll backends.  selscan() and pollscan()
now call the poll backend.  With this change we implement greater
poll(2) functionality instead of emulating it via the select backend.
Adapted from NetBSD and including some changes from FreeBSD.
Tested by many, deraadt@@ OK
@
text
@d1 1
a1 1
/*	$OpenBSD: conf.c,v 1.27 2003/06/02 23:27:46 millert Exp $	*/
d114 5
d153 5
a157 2
	cdev_notdef(),			/* 31 */

@


1.27
log
@Remove the advertising clause in the UCB license which Berkeley
rescinded 22 July 1999.  Proofed by myself and Theo.
@
text
@d1 1
a1 1
/*	$OpenBSD: conf.c,v 1.26 2003/05/14 00:20:37 tedu Exp $	*/
d85 1
a85 1
	dev_init(c,n,tty), ttselect /* ttpoll */, dev_init(c,n,mmap) }
@


1.26
log
@add {b,c}devsw_lookup convenience functions.
move chrtoblk and blktochr into MI code.
tested on several archs and ok deraadt@@
@
text
@d1 1
a1 1
/*	$OpenBSD: conf.c,v 1.25 2003/02/08 12:34:27 todd Exp $	*/
d15 1
a15 5
 * 3. All advertising materials mentioning features or use of this software
 *    must display the following acknowledgement:
 *	This product includes software developed by the University of
 *	California, Berkeley and its contributors.
 * 4. Neither the name of the University nor the names of its contributors
@


1.25
log
@allow for xfs; ok miod
@
text
@d1 1
a1 1
/*	$OpenBSD: conf.c,v 1.24 2003/01/25 19:46:02 jason Exp $	*/
d186 1
a186 1
static int chrtoblktbl[] = {
d217 1
a217 33

/*
 * Convert a character device number to a block device number.
 */
dev_t
chrtoblk(dev)
	dev_t dev;
{
	int blkmaj;
	if (major(dev) >= nchrdev)
		return (NODEV);
	blkmaj = chrtoblktbl[major(dev)];
	if (blkmaj == NODEV)
		return (NODEV);
	return (makedev(blkmaj, minor(dev)));
}

/*
 * Convert a block device number to a character device number.
 */
dev_t
blktochr(dev)
	dev_t dev;
{
	int blkmaj = major(dev);
	int i;
	if (blkmaj >= nblkdev)
		return (NODEV);
	for (i = 0; i < sizeof(chrtoblktbl)/sizeof(chrtoblktbl[0]); i++)
		if (blkmaj == chrtoblktbl[i])
			return (makedev(i, minor(dev)));
	return (NODEV);
}
@


1.24
log
@Grr.. add a missing cdev_notdef() so that 35 really is the audio device
@
text
@d1 1
a1 1
/*	$OpenBSD: conf.c,v 1.23 2002/12/05 02:49:55 kjc Exp $	*/
d97 4
@


1.23
log
@remove altq entries.
altq is merged into pf and handled through pf.
@
text
@d1 1
a1 1
/*	$OpenBSD: conf.c,v 1.22 2002/10/01 21:03:30 mickey Exp $	*/
d148 2
a149 1
					/* 31 */
@


1.22
log
@a few missing generic devices
@
text
@d1 1
a1 1
/*	$OpenBSD: conf.c,v 1.21 2002/07/10 22:08:47 mickey Exp $	*/
a111 2
#include <altq/altqconf.h>

d154 1
a154 1
	cdev_altq_init(NALTQ,altq),	/* 33: ALTQ control interface */
@


1.21
log
@proper cdev_decl(ksyms), fix ksyms's broken functions
@
text
@d1 1
a1 1
/*	$OpenBSD: conf.c,v 1.20 2002/06/11 05:15:18 miod Exp $	*/
d55 1
d91 1
d98 1
d158 9
a166 6
	cdev_lkm_dummy(),		/* 35 */
	cdev_lkm_dummy(),		/* 36 */
	cdev_lkm_dummy(),		/* 37 */
	cdev_lkm_dummy(),		/* 38 */
	cdev_lkm_dummy(),		/* 39 */
	cdev_lkm_dummy(),		/* 40 */
@


1.20
log
@Move cdev_lpt_init() to a common location.
@
text
@d1 1
a1 1
/*	$OpenBSD: conf.c,v 1.19 2002/05/16 21:40:12 mickey Exp $	*/
a99 1
cdev_decl(ksyms);
@


1.19
log
@miod missed a comma
@
text
@d1 1
a1 1
/*	$OpenBSD: conf.c,v 1.18 2002/05/16 21:11:14 miod Exp $	*/
a88 5

#define	cdev_lpt_init(c,n) { \
	dev_init(c,n,open), dev_init(c,n,close), (dev_type_read((*))) enodev, \
	dev_init(c,n,write), dev_init(c,n,ioctl),(dev_type_stop((*))) enodev, \
	0, seltrue, (dev_type_mmap((*))) enodev }
@


1.18
log
@Add systrace support to all the remaining architectures.

Tested by various people on various platforms, I'm willing to fix any
breakage this causes.

ok niels@@ deraadt@@ and mickey@@ (after his comments were applied)
@
text
@d1 1
a1 1
/*	$OpenBSD: conf.c,v 1.17 2002/03/16 00:34:56 mickey Exp $	*/
d160 1
a160 1
	cdev_systrace_init(NSYSTRACE,systrace)	/* 34: system call tracing */
@


1.17
log
@move cdev_decl out and kill some ugly print and some spaces
@
text
@d1 1
a1 1
/*	$OpenBSD: conf.c,v 1.16 2002/03/15 22:50:05 mickey Exp $	*/
d117 2
d160 7
a166 6
	cdev_lkm_dummy(),
	cdev_lkm_dummy(),
	cdev_lkm_dummy(),
	cdev_lkm_dummy(),
	cdev_lkm_dummy(),
	cdev_lkm_dummy(),
@


1.16
log
@here will be a wscons-garden
@
text
@d1 1
a1 1
/*	$OpenBSD: conf.c,v 1.15 2001/09/28 02:53:13 mickey Exp $	*/
a94 3
#define mmread  mmrw
#define mmwrite mmrw
cdev_decl(mm);
@


1.15
log
@move cdev_decl(pf) into it's proper place, kill cdev_decl(ipl) at the same time
@
text
@d1 1
a1 1
/*	$OpenBSD: conf.c,v 1.14 2001/08/12 20:20:42 mickey Exp $	*/
d277 1
a277 1
/*cons_decl(wscons);*/
d282 2
a283 2
#if NWSCONS1 > 0
	cons_init(wscons),
@


1.15.4.1
log
@Sync UBC branch to -current
@
text
@d1 1
a1 1
/*	$OpenBSD: conf.c,v 1.15 2001/09/28 02:53:13 mickey Exp $	*/
d95 3
a119 2
#include "systrace.h"

d161 6
a166 7
	cdev_systrace_init(NSYSTRACE,systrace),	/* 34: system call tracing */
	cdev_lkm_dummy(),		/* 35 */
	cdev_lkm_dummy(),		/* 36 */
	cdev_lkm_dummy(),		/* 37 */
	cdev_lkm_dummy(),		/* 38 */
	cdev_lkm_dummy(),		/* 39 */
	cdev_lkm_dummy(),		/* 40 */
d277 1
a277 1
cons_decl(ws);
d282 2
a283 2
#if NWSDISPLAY > 0
	cons_init(ws),
@


1.15.4.2
log
@sync to -current
@
text
@d1 1
a1 1
/*	$OpenBSD: conf.c,v 1.15.4.1 2002/06/11 03:35:36 art Exp $	*/
a54 1
#include "ses.h"
d90 5
a94 1
#include "audio.h"
a100 1
#include "inet.h"
d105 1
d161 6
a166 9
	cdev_audio_init(NAUDIO,audio),	/* 35: /dev/audio */
	cdev_crypto_init(NCRYPTO,crypto), /* 36: /dev/crypto */
	cdev_ses_init(NSES,ses),	/* 37: SCSI SES/SAF-TE */
	cdev_lkm_dummy(),
	cdev_lkm_dummy(),
	cdev_lkm_dummy(),
	cdev_lkm_dummy(),
	cdev_lkm_dummy(),
	cdev_lkm_dummy(),
@


1.15.4.3
log
@sync
@
text
@d1 1
a1 1
/*	$OpenBSD$	*/
a96 4
#ifdef XFS
#include <xfs/nxfs.h>
cdev_decl(xfs_dev);
#endif
d112 2
d150 1
a150 2
	cdev_notdef(),			/* 31 */

d156 1
a156 1
	cdev_notdef(),			/* 33: ALTQ (deprecated) */
d183 1
a183 1
int chrtoblktbl[] = {
d214 33
a246 1
int nchrtoblktbl = sizeof(chrtoblktbl) / sizeof(chrtoblktbl[0]);
@


1.14
log
@wsmux does not need to be cdev_decl'ed here
@
text
@d1 1
a1 1
/*	$OpenBSD: conf.c,v 1.13 2001/08/06 22:34:43 mickey Exp $	*/
a116 1
cdev_decl(pf);
@


1.13
log
@remove vm_conf.h; art@@ ok
@
text
@d1 1
a1 1
/*	$OpenBSD: conf.c,v 1.12 2001/08/01 20:30:58 miod Exp $	*/
a102 1
cdev_decl(wsmux);
@


1.12
log
@wsmux needs to be cdev_decl'ed.
@
text
@d1 1
a1 1
/*	$OpenBSD: conf.c,v 1.11 2001/06/27 06:56:28 kjc Exp $	*/
a46 1
bdev_decl(sw);
a97 1
cdev_decl(sw);
@


1.11
log
@add the ALTQ device to the rest of the architectures.
@
text
@d1 1
a1 1
/*	$OpenBSD: conf.c,v 1.10 2001/06/25 03:19:55 kjell Exp $	*/
d105 2
@


1.10
log
@add pf device on all architectures.
fix my previously bogus MAKEDEVs.
If you used pf on a non-i386. the major device number has changed,
and you'll need to recreate /dev/pf
ok theo
@
text
@d1 1
a1 1
/*	$OpenBSD: conf.c,v 1.9 2001/04/01 06:25:33 mickey Exp $	*/
d120 2
d162 1
@


1.9
log
@cleanup a little
@
text
@d1 1
a1 1
/*	$OpenBSD: conf.c,v 1.8 2000/09/26 14:03:52 art Exp $	*/
d117 2
a118 5
#ifdef IPFILTER
#define NIPF 1
#else
#define NIPF 0
#endif
d143 1
a143 1
	cdev_gen_ipf(NIPF,ipl),		/* 21: ip filtering */
@


1.8
log
@Implement getnulldev that returns the dev_t for "/dev/null".
@
text
@d1 1
a1 1
/*	$OpenBSD: conf.c,v 1.7 2000/01/17 06:59:34 mickey Exp $	*/
a58 1
#include "ft.h"
a60 1
#define NFT 0
a63 2
bdev_decl(ft);
cdev_decl(ft);
d75 1
a75 2
	bdev_tape_init(NFT,ft),		/*  8: floppy tape */
					/*  9: */
a100 1
#if 0
d104 1
a104 5
#else
#define	NWSKBD 0
#define	NWSDISPLAY 0
#define	NWSMOUSE 0
#endif
d150 8
a157 3
	cdev_tape_init(NFT,ft),		/* 25: floppy tape */
	cdev_ksyms_init(NKSYMS,ksyms),	/* 26: Kernel symbols device */
	cdev_lpt_init(NLPT,lpt),	/* 27: parallel printer */
d159 1
a159 1
	cdev_xfs_init(NXFS,xfs_dev),	/* 28: xfs communication device */
d161 1
a161 7
	cdev_notdef(),			/* 28 */
#endif
					/* 29 */
#if 0
	cdev_wsdisplay_init(NWSDISPLAY,wsdisplay), /* : workstation console */
	cdev_mouse_init(NWSKBD,wskbd),	/* : keyboards */
	cdev_mouse_init(NWSMOUSE,wsmouse), /* : mice */
@


1.7
log
@spaces everywhere
@
text
@d1 1
a1 1
/*	$OpenBSD: conf.c,v 1.6 1999/11/16 17:02:16 mickey Exp $	*/
d269 6
@


1.7.2.1
log
@Update the SMP branch to -current, this breaks the SMP branch though.
But it will be fixed soonish.  Note, nothing new has happened, this is just
a merge of the trunk into this branch.
@
text
@d1 1
a1 1
/*	$OpenBSD: conf.c,v 1.9 2001/04/01 06:25:33 mickey Exp $	*/
d59 1
d62 1
d66 2
d79 2
a80 1
					/*  8: */
d106 1
d110 5
a114 1
#include "wsmux.h"
d160 3
a162 8
	cdev_ksyms_init(NKSYMS,ksyms),	/* 25: Kernel symbols device */
	cdev_lpt_init(NLPT,lpt),	/* 26: parallel printer */
	cdev_wsdisplay_init(NWSDISPLAY,	/* 27: workstation console */
	    wsdisplay),
	cdev_mouse_init(NWSKBD,wskbd),	/* 28: keyboards */
	cdev_mouse_init(NWSMOUSE,wsmouse), /* 29: mice */
	cdev_mouse_init(NWSMUX,wsmux),	/* 30: mux */
					/* 31 */
d164 1
a164 1
	cdev_xfs_init(NXFS,xfs_dev),	/* 32: xfs communication device */
d166 7
a172 1
	cdev_notdef(),			/* 32 */
a268 6
}

dev_t
getnulldev()
{
	return makedev(mem_no, 2);
@


1.7.2.2
log
@Merge in -current from two days ago in the SMP branch.
As usual with merges, they do not indicate progress, so do not hold
your breath for working SMP, and do not mail me and ask about the
state of it.  It has not changed.  There is work ongoing, but very, very
slowly.  The commit is done in parts as to not lock up the tree in too
big chunks at a time.
@
text
@d1 1
a1 1
/*	$OpenBSD: conf.c,v 1.7.2.1 2001/04/18 16:06:06 niklas Exp $	*/
d117 5
a121 4
#include "pf.h"
cdev_decl(pf);

#include <altq/altqconf.h>
d146 1
a146 1
	cdev_pf_init(NPF,pf),		/* 21: packet filter */
a162 1
	cdev_altq_init(NALTQ,altq),	/* 33: ALTQ control interface */
@


1.7.2.3
log
@Sync the SMP branch to something just after 3.0
@
text
@d1 1
a1 1
/*	$OpenBSD: conf.c,v 1.7.2.2 2001/07/04 10:16:02 niklas Exp $	*/
d47 1
d99 1
a104 1

d118 1
@


1.7.2.4
log
@Merge in -current from about a week ago
@
text
@d1 1
a1 1
/*	$OpenBSD$	*/
d95 3
d277 1
a277 1
cons_decl(ws);
d282 2
a283 2
#if NWSDISPLAY > 0
	cons_init(ws),
@


1.7.2.5
log
@Sync the SMP branch with 3.3
@
text
@a54 1
#include "ses.h"
d90 5
a94 1
#include "audio.h"
a99 4
#ifdef XFS
#include <xfs/nxfs.h>
cdev_decl(xfs_dev);
#endif
a100 1
#include "inet.h"
d105 1
d115 1
a115 1
#include "systrace.h"
d151 1
a151 2
	cdev_notdef(),			/* 31 */

d157 1
a157 5
	cdev_notdef(),			/* 33: ALTQ (deprecated) */
	cdev_systrace_init(NSYSTRACE,systrace),	/* 34: system call tracing */
	cdev_audio_init(NAUDIO,audio),	/* 35: /dev/audio */
	cdev_crypto_init(NCRYPTO,crypto), /* 36: /dev/crypto */
	cdev_ses_init(NSES,ses),	/* 37: SCSI SES/SAF-TE */
@


1.7.2.6
log
@merge the trunk so we will get the genfs and locking fixes
@
text
@d186 1
a186 1
int chrtoblktbl[] = {
d217 33
a249 1
int nchrtoblktbl = sizeof(chrtoblktbl) / sizeof(chrtoblktbl[0]);
@


1.7.2.7
log
@Sync SMP branch to -current
@
text
@d1 1
a1 1
/*	$OpenBSD: conf.c,v 1.7.2.6 2003/05/16 00:29:38 niklas Exp $	*/
d15 5
a19 1
 * 3. Neither the name of the University nor the names of its contributors
@


1.7.2.8
log
@Merge of current from two weeks agointo the SMP branch
@
text
@d1 1
a1 1
/*	$OpenBSD$	*/
d85 1
a85 1
	dev_init(c,n,tty), ttpoll, dev_init(c,n,mmap) }
a113 5
#ifdef USER_PCICONF
#include "pci.h"
cdev_decl(pci);
#endif

d148 2
a149 5
#ifdef USER_PCICONF
	cdev_pci_init(NPCI,pci),	/* 31: PCI user */
#else
	cdev_notdef(),
#endif
@


1.7.2.9
log
@Merge with the trunk
@
text
@a167 1
	cdev_ptm_init(NPTY,ptm),	/* 38: pseudo-tty ptm device */
@


1.6
log
@tabs vs spaces
@
text
@d1 1
a1 1
/*	$OpenBSD: conf.c,v 1.5 1999/05/05 02:43:17 mickey Exp $	*/
d35 1
a35 1
 *      @@(#)conf.c	7.9 (Berkeley) 5/28/91
d71 9
a79 9
	bdev_swap_init(1,sw),           /*  0: swap pseudo-device */
	bdev_disk_init(NCCD,ccd),       /*  1: concatenated disk driver */
	bdev_disk_init(NVND,vnd),       /*  2: vnode disk driver */
	bdev_disk_init(NRD,rd),         /*  3: RAM disk */
	bdev_disk_init(NSD,sd),         /*  4: SCSI disk */
	bdev_tape_init(NST,st),         /*  5: SCSI tape */
	bdev_disk_init(NCD,cd),         /*  6: SCSI CD-ROM */
	bdev_disk_init(NFD,fd),         /*  7: floppy drive */
	bdev_tape_init(NFT,ft),         /*  8: floppy tape */
d115 1
a115 1
#include "bpfilter.h"   
d128 1
a128 1
#define NIPF 1 
d181 1
a181 1
int	nchrdev = sizeof(cdevsw) / sizeof(cdevsw[0]);
d183 1
a183 1
int     mem_no = 2;     /* major device number of memory special file */
d230 1
a230 1
 */  
d239 1
a239 1
	if (blkmaj == NODEV)   
d242 1
a242 1
} 
@


1.5
log
@secure the plug
@
text
@d1 1
a1 1
/*	$OpenBSD: conf.c,v 1.4 1999/05/05 02:40:34 mickey Exp $	*/
d135 17
a151 17
	cdev_cn_init(1,cn),             /*  0: virtual console */
	cdev_ctty_init(1,ctty),         /*  1: controlling terminal */
	cdev_mm_init(1,mm),             /*  2: /dev/{null,mem,kmem,...} */
	cdev_swap_init(1,sw),           /*  3: /dev/drum (swap pseudo-device) */
	cdev_tty_init(NPTY,pts),        /*  4: pseudo-tty slave */
	cdev_ptc_init(NPTY,ptc),        /*  5: pseudo-tty master */
	cdev_log_init(1,log),           /*  6: /dev/klog */
	cdev_disk_init(NCCD,ccd),       /*  7: concatenated disk */
	cdev_disk_init(NVND,vnd),       /*  8: vnode disk driver */
	cdev_disk_init(NRD,rd),         /*  9: RAM disk */
	cdev_disk_init(NSD,sd),         /* 10: SCSI disk */
	cdev_tape_init(NST,st),         /* 11: SCSI tape */
	cdev_disk_init(NCD,cd),         /* 12: SCSI cd-rom */
	cdev_ch_init(NCH,ch),         /* 13: SCSI changer */
	cdev_ss_init(NSS,ss),         /* 14: SCSI scanner */
	cdev_uk_init(NUK,uk),         /* 15: SCSI unknown */
	cdev_fd_init(1,filedesc),       /* 16: file descriptor pseudo-device */
d153 4
a156 4
	cdev_bpftun_init(NTUN,tun),     /* 18: network tunnel */
	cdev_lkm_init(NLKM,lkm),        /* 19: loadable module driver */
	cdev_random_init(1,random),     /* 20: random generator */
	cdev_gen_ipf(NIPF,ipl),         /* 21: ip filtering */
@


1.4
log
@plug unused parts
@
text
@d1 1
a1 1
/*	$OpenBSD: conf.c,v 1.3 1999/04/20 20:38:11 mickey Exp $	*/
d161 2
a162 5
	cdev_wsdisplay_init(NWSDISPLAY,wsdisplay), /* 26: workstation console */
	cdev_mouse_init(NWSKBD,wskbd),	/* 27: keyboards */
	cdev_mouse_init(NWSMOUSE,wsmouse), /* 28: mice */
	cdev_ksyms_init(NKSYMS,ksyms),	/* 29: Kernel symbols device */
	cdev_lpt_init(NLPT,lpt),	/* 30: parallel printer */
d164 1
a164 1
	cdev_xfs_init(NXFS,xfs_dev),	/* 31: xfs communication device */
d166 7
a172 1
	cdev_notdef(),			/* 31 */
a173 1
					/* 32 */
@


1.3
log
@more devices
@
text
@d1 1
a1 1
/*	$OpenBSD: conf.c,v 1.2 1998/12/23 17:55:36 mickey Exp $	*/
d57 1
d59 5
a65 1
#include "ft.h"
d106 1
d110 5
@


1.2
log
@remove bogus gkd.h
@
text
@d1 1
a1 1
/*	$OpenBSD: conf.c,v 1.1 1998/11/09 13:00:56 mickey Exp $	*/
d89 6
a94 1
	dev_init(c,n,tty), ttselect /* ttpoll */, dev_init(c,n,mmap), D_TTY }
d101 3
a103 2
#include "wscons.h"
cdev_decl(wscons);
d107 6
d146 15
a160 6
	cdev_wscons_init(NWSCONS,wscons), /* 22: workstation console */
	cdev_tty_init(1,pdc),		/* 23: PDC device */
	cdev_tty_init(NCOM,com),	/* 24: RS232 */
	cdev_disk_init(NFD,fd),		/* 25: floppy drive */
	cdev_tape_init(NFT,ft),		/* 26: floppy tape */
					/* 27 */
d271 1
a271 1
cons_decl(wscons);
d276 1
a276 1
#if NWSCONS > 0
@


1.1
log
@some conf for devs
@
text
@d1 1
a1 1
/*	$OpenBSD$	*/
a102 1
#include "gkd.h"
@

