head	1.14;
access;
symbols
	OPENBSD_6_0:1.13.0.4
	OPENBSD_6_0_BASE:1.13
	OPENBSD_5_9:1.13.0.2
	OPENBSD_5_9_BASE:1.13
	OPENBSD_5_8:1.12.0.14
	OPENBSD_5_8_BASE:1.12
	OPENBSD_5_7:1.12.0.6
	OPENBSD_5_7_BASE:1.12
	OPENBSD_5_6:1.12.0.10
	OPENBSD_5_6_BASE:1.12
	OPENBSD_5_5:1.12.0.8
	OPENBSD_5_5_BASE:1.12
	OPENBSD_5_4:1.12.0.4
	OPENBSD_5_4_BASE:1.12
	OPENBSD_5_3:1.12.0.2
	OPENBSD_5_3_BASE:1.12
	OPENBSD_5_2:1.10.0.18
	OPENBSD_5_2_BASE:1.10
	OPENBSD_5_1_BASE:1.10
	OPENBSD_5_1:1.10.0.16
	OPENBSD_5_0:1.10.0.14
	OPENBSD_5_0_BASE:1.10
	OPENBSD_4_9:1.10.0.12
	OPENBSD_4_9_BASE:1.10
	OPENBSD_4_8:1.10.0.10
	OPENBSD_4_8_BASE:1.10
	OPENBSD_4_7:1.10.0.6
	OPENBSD_4_7_BASE:1.10
	OPENBSD_4_6:1.10.0.8
	OPENBSD_4_6_BASE:1.10
	OPENBSD_4_5:1.10.0.4
	OPENBSD_4_5_BASE:1.10
	OPENBSD_4_4:1.10.0.2
	OPENBSD_4_4_BASE:1.10
	OPENBSD_4_3:1.9.0.18
	OPENBSD_4_3_BASE:1.9
	OPENBSD_4_2:1.9.0.16
	OPENBSD_4_2_BASE:1.9
	OPENBSD_4_1:1.9.0.14
	OPENBSD_4_1_BASE:1.9
	OPENBSD_4_0:1.9.0.12
	OPENBSD_4_0_BASE:1.9
	OPENBSD_3_9:1.9.0.10
	OPENBSD_3_9_BASE:1.9
	OPENBSD_3_8:1.9.0.8
	OPENBSD_3_8_BASE:1.9
	OPENBSD_3_7:1.9.0.6
	OPENBSD_3_7_BASE:1.9
	OPENBSD_3_6:1.9.0.4
	OPENBSD_3_6_BASE:1.9
	SMP_SYNC_A:1.9
	SMP_SYNC_B:1.9
	OPENBSD_3_5:1.9.0.2
	OPENBSD_3_5_BASE:1.9
	OPENBSD_3_4:1.8.0.4
	OPENBSD_3_4_BASE:1.8
	UBC_SYNC_A:1.8
	OPENBSD_3_3:1.8.0.2
	OPENBSD_3_3_BASE:1.8
	OPENBSD_3_2:1.7.0.2
	OPENBSD_3_2_BASE:1.7
	OPENBSD_3_1:1.6.0.8
	OPENBSD_3_1_BASE:1.6
	UBC_SYNC_B:1.8
	UBC:1.6.0.6
	UBC_BASE:1.6
	OPENBSD_3_0:1.6.0.4
	OPENBSD_3_0_BASE:1.6
	OPENBSD_2_9:1.6.0.2
	OPENBSD_2_9_BASE:1.6
	OPENBSD_2_8:1.5.0.6
	OPENBSD_2_8_BASE:1.5
	OPENBSD_2_7:1.5.0.4
	OPENBSD_2_7_BASE:1.5
	SMP:1.5.0.2
	SMP_BASE:1.5
	kame_19991208:1.5
	OPENBSD_2_6:1.4.0.4
	OPENBSD_2_6_BASE:1.4
	OPENBSD_2_5:1.4.0.2
	OPENBSD_2_5_BASE:1.4
	OPENBSD_2_4:1.1.0.2
	OPENBSD_2_4_BASE:1.1;
locks; strict;
comment	@ * @;


1.14
date	2017.02.08.05.09.25;	author guenther;	state Exp;
branches;
next	1.13;
commitid	V3fgN8BO1mri8xSU;

1.13
date	2015.08.29.01.58.39;	author guenther;	state Exp;
branches;
next	1.12;
commitid	tXJb6vLxru5vPZNh;

1.12
date	2013.02.09.19.20.39;	author miod;	state Exp;
branches;
next	1.11;

1.11
date	2012.09.11.15.44.17;	author deraadt;	state Exp;
branches;
next	1.10;

1.10
date	2008.06.14.14.42.55;	author miod;	state Exp;
branches;
next	1.9;

1.9
date	2003.11.07.16.41.01;	author mickey;	state Exp;
branches;
next	1.8;

1.8
date	2002.10.24.19.28.20;	author mickey;	state Exp;
branches;
next	1.7;

1.7
date	2002.09.05.18.34.47;	author mickey;	state Exp;
branches;
next	1.6;

1.6
date	2001.01.22.14.51.03;	author art;	state Exp;
branches
	1.6.6.1;
next	1.5;

1.5
date	99.11.16.16.44.04;	author mickey;	state Exp;
branches
	1.5.2.1;
next	1.4;

1.4
date	99.02.17.22.58.05;	author mickey;	state Exp;
branches;
next	1.3;

1.3
date	99.02.17.22.13.37;	author mickey;	state Exp;
branches;
next	1.2;

1.2
date	98.12.05.17.35.38;	author mickey;	state Exp;
branches;
next	1.1;

1.1
date	98.06.23.19.45.21;	author mickey;	state Exp;
branches;
next	;

1.5.2.1
date	2001.04.18.16.06.24;	author niklas;	state Exp;
branches;
next	1.5.2.2;

1.5.2.2
date	2003.03.27.23.26.54;	author niklas;	state Exp;
branches;
next	1.5.2.3;

1.5.2.3
date	2004.02.19.10.48.40;	author niklas;	state Exp;
branches;
next	;

1.6.6.1
date	2002.10.29.00.28.03;	author art;	state Exp;
branches;
next	;


desc
@@


1.14
log
@In exec_elf.c: expand ELFNAME(), ELFNAME2(), and ELFNAMEEND() except
leaving out the size, so that
	ELFNAME2(exec,makecmds)
becomes
	exec_elf_makecmds
instead of
	exec_elf{32,64}_makecmds
and then delete the ELFNAME2() and ELFNAMEEND() macros.

Move the prototypes for functions local to exec_elf.c to there from
exec_elf.h.

Simplify the SMALL_KERNEL conditionals around the ELF coredump code.

Change exec_conf.c to use the size-generic names and macros

Remove exec_elf{32,64}.c and just build exec_elf.c; delete the
_KERN_DO_ELF and _KERN_DO_ELF64 #defines.

ok jca@@, encouragement from deraadt@@ and tom@@
@
text
@/*	$OpenBSD: exec.h,v 1.13 2015/08/29 01:58:39 guenther Exp $	*/

/* 
 * Copyright (c) 1994, The University of Utah and
 * the Computer Systems Laboratory at the University of Utah (CSL).
 * All rights reserved.
 *
 * Permission to use, copy, modify and distribute this software is hereby
 * granted provided that (1) source code retains these copyright, permission,
 * and disclaimer notices, and (2) redistributions including binaries
 * reproduce the notices in supporting documentation, and (3) all advertising
 * materials mentioning features or use of this software display the following
 * acknowledgement: ``This product includes software developed by the
 * Computer Systems Laboratory at the University of Utah.''
 *
 * THE UNIVERSITY OF UTAH AND CSL ALLOW FREE USE OF THIS SOFTWARE IN ITS "AS
 * IS" CONDITION.  THE UNIVERSITY OF UTAH AND CSL DISCLAIM ANY LIABILITY OF
 * ANY KIND FOR ANY DAMAGES WHATSOEVER RESULTING FROM THE USE OF THIS SOFTWARE.
 *
 * CSL requests users of this software to return to csl-dist@@cs.utah.edu any
 * improvements that they make and grant CSL redistribution rights.
 *
 * 	Utah $Hdr: exec.h 1.3 94/12/16$
 */

#ifndef	_MACHINE_EXEC_H_
#define	_MACHINE_EXEC_H_

/* Size of a page in an object file. */
#define	__LDPGSZ	4096

#define ARCH_ELFSIZE		32

#define ELF_TARG_CLASS          ELFCLASS32
#define ELF_TARG_DATA           ELFDATA2MSB
#define ELF_TARG_MACH           EM_PARISC   

/*
 * the following MD ELF values definitions are from the:
 * "Processor-Specific ELF Supplement for PA-RISC.
 *  Including HP and HP-UX Extensions. Version 1.43. October 6, 1997"
 *	http://devrsrc1.external.hp.com/STK/partner/elf-pa.pdf
 *
 */

/* parisc-specific elf flags */
#define	EF_PARISC_TRAPNIL	0x00010000	/* trap on NULL derefs */
#define	EF_PARISC_EXT		0x00020000	/* program uses arch exts */
#define	EF_PARISC_LSB		0x00040000	/* program expects LSB mode */
#define	EF_PARISC_WIDE		0x00080000	/* program expects wide mode */
#define	EF_PARISC_NO_KABP	0x00100000	/* don't allow kernel assisted
						   branch prediction */
#define	EF_PARISC_LAZYSWAP	0x00200000	/* allow lazy swap allocation
						   for dynamically allocated
						   program segments */
#define	EF_PARISC_ARCH		0x0000ffff	/* architecture version */
#define		EFA_PARISC_1_0	0x020B
#define		EFA_PARISC_1_1	0x0210
#define		EFA_PARISC_2_0	0x0214

/* legend: 0 - pa7000, 1 - pa7100, 2 - pa7200, 3 - pa7100LC, 4 - pa8000 */
#define	PARISC_AE_QWSI	0x00000001	/* 0  : enable quadword stores */
#define	PARISC_AE_FPLSU	0x00000002	/*   1: fp load/store to I/O space */
#define	PARISC_AE_RSQRT	0x00000004	/* 0  : reciprocal sqrt */
#define	PARISC_AE_FDCG	0x00000008	/* 0,1: fdc includes graph flushes */
#define	PARISC_AE_HPAR	0x00000010	/* 3,4: half-word add/sub/av */
#define	PARISC_AE_BSW	0x00000020	/* 3,4: half-word shift-add */
#define	PARISC_AE_HPSA	0x00000040	/* 3  : byte-swapping stores */
#define	PARISC_AE_DPR0	0x00000080	/* 2,4: data prefetch via ld to r0 */

#define	SHN_PARISC_ANSI_COMMON	0xff00
#define	SHN_PARISC_HUGE_COMMON	0xff01

/* sh_type */
#define	SHT_PARISC_EXT		0x70000000	/* contains product-specific
						   extension bits */
#define	SHT_PARISC_UNWIND	0x70000001	/* contains unwind table enries
						   sh_info contains index of
						   the code section to which
						   unwind entries apply */
#define	SHT_PARISC_DOC		0x70000002	/* contains debug info for -O */
#define	SHT_PARISC_ANNOT	0x70000003	/* contains code annotations */

/* sh_flags */
#define	SHF_PARISC_SBP	0x80000000	/* contains code compiled for
					   static branch prediction */
#define	SHF_PARISC_HUGE	0x40000000	/* should be allocated far from gp */
#define	SHF_PARISC_SHORT 0x20000000	/* should be allocated near from gp */

#define	ELF_PARISC_ARCHEXT	".PARISC.archext"
#define	ELF_PARISC_MILLI	".PARISC.milli"
#define	ELF_PARISC_UNWIND	".PARISC.unwind"
#define	ELF_PARISC_UNWIND_INFO	".PARISC.unwind_info"
#define	ELF_PARISC_SDATA	".sdata"
#define	ELF_PARISC_NOBITS	".sbss"

#define	STT_PARISC_MILLI	13	/* entry point of a millicode routine */

#define	PT_PARISC_ARCHEXT	0x70000000	/* segment contains
						   .PARISC.archext section */
#define	PT_PARISC_UNWIND	0x70000001	/* segment contains
						   .unwind section */

#define	PF_PARISC_SBP		0x08000000	/* segment contains code
					compiled for static branch prediction */

#endif	/* _MACHINE_EXEC_H_ */
@


1.13
log
@_NLIST_DO_ELF is no longer needed: it's the only option

ok deraadt@@
@
text
@d1 1
a1 1
/*	$OpenBSD: exec.h,v 1.12 2013/02/09 19:20:39 miod Exp $	*/
a36 2

#define	_KERN_DO_ELF
@


1.12
log
@Do not bother defining cpu_exec_aout_makecmds() on platforms where we no longer
(or never did) support a.out binaries (i.e. where _KERN_DO_AOUT is not defined).
@
text
@d1 1
a1 1
/*	$OpenBSD: exec.h,v 1.11 2012/09/11 15:44:17 deraadt Exp $	*/
a37 1
#define _NLIST_DO_ELF
@


1.11
log
@Remove the 'OLF method' used for the transition from a.out to ELF and
for all the compat layers which are now gone.  Linux compat still works
because it always used another method in any case, and nothing looks at
p_os anymore.
ok jsing
@
text
@d1 1
a1 1
/*	$OpenBSD: exec.h,v 1.10 2008/06/14 14:42:55 miod Exp $	*/
a28 2
#define cpu_exec_aout_makecmds(p, epp)  ENOEXEC

d42 1
a42 1
 * the following MD ELF values defenitions are from the:
@


1.10
log
@defininig NATIVE_EXEC_ELF is mandatory on ELF platforms.
@
text
@d1 1
a1 1
/*	$OpenBSD: exec.h,v 1.9 2003/11/07 16:41:01 mickey Exp $	*/
a39 1
#define	NATIVE_EXEC_ELF
@


1.9
log
@fix the ref to hpux elf extensions; from Jared Yanovich <jjy2+@@pitt.edu>
@
text
@d1 1
a1 1
/*	$OpenBSD: exec.h,v 1.8 2002/10/24 19:28:20 mickey Exp $	*/
d40 1
@


1.8
log
@nlist does no aout no more, fuget about som too
@
text
@d1 1
a1 1
/*	$OpenBSD: exec.h,v 1.7 2002/09/05 18:34:47 mickey Exp $	*/
d46 2
a47 2
 *  Including HP and HP-UX Extensions. Version 1.43. October 6, 1998"
 *	http://www.software.hp.com/STK/partner/elf-pa.pdf
@


1.7
log
@sort out the nlist and do defines
@
text
@d1 1
a1 1
/*	$OpenBSD: exec.h,v 1.6 2001/01/22 14:51:03 art Exp $	*/
a39 1
#define _NLIST_DO_AOUT
a40 2
#define _NLIST_DO_SOM

a41 1
#define	_KERN_DO_SOM
@


1.6
log
@Define ARCH_ELFSIZE that is the default elf size on this arch.
@
text
@d1 1
a1 1
/*	$OpenBSD: exec.h,v 1.5 1999/11/16 16:44:04 mickey Exp $	*/
d40 1
a40 2
/* #define _NLIST_DO_AOUT */
/* #define _NLIST_DO_ECOFF */
a43 2
/* #define	_KERN_DO_AOUT */
/* #define	_KERN_DO_ECOFF */
@


1.6.6.1
log
@sync to -current
@
text
@d1 1
a1 1
/*	$OpenBSD: exec.h,v 1.6 2001/01/22 14:51:03 art Exp $	*/
d40 2
d43 4
d48 1
@


1.5
log
@openbsd/hppa is ELFDATA2MSB
@
text
@d1 1
a1 1
/*	$OpenBSD: exec.h,v 1.4 1999/02/17 22:58:05 mickey Exp $	*/
d33 2
@


1.5.2.1
log
@Update the SMP branch to -current, this breaks the SMP branch though.
But it will be fixed soonish.  Note, nothing new has happened, this is just
a merge of the trunk into this branch.
@
text
@d1 1
a1 1
/*	$OpenBSD: exec.h,v 1.6 2001/01/22 14:51:03 art Exp $	*/
a32 2

#define ARCH_ELFSIZE		32
@


1.5.2.2
log
@Sync the SMP branch with 3.3
@
text
@d1 1
a1 1
/*	$OpenBSD$	*/
d40 2
d43 4
d48 1
@


1.5.2.3
log
@Merge of current from two weeks agointo the SMP branch
@
text
@d46 2
a47 2
 *  Including HP and HP-UX Extensions. Version 1.43. October 6, 1997"
 *	http://devrsrc1.external.hp.com/STK/partner/elf-pa.pdf
@


1.4
log
@add document url
@
text
@d1 1
a1 1
/*	$OpenBSD: exec.h,v 1.3 1999/02/17 22:13:37 mickey Exp $	*/
d35 1
a35 1
#define ELF_TARG_DATA           ELFDATA2LSB
@


1.3
log
@pa-risc elf definitions, including hp and hp-ux extensions. multi-include protection
@
text
@d1 1
a1 1
/*	$OpenBSD: exec.h,v 1.2 1998/12/05 17:35:38 mickey Exp $	*/
d52 1
@


1.2
log
@do elf and som, no a.out and ecoff
@
text
@d1 1
a1 1
/*	$OpenBSD: exec.h,v 1.1 1998/06/23 19:45:21 mickey Exp $	*/
d26 3
d34 1
a34 1
#define ELF_TARG_CLASS          ELFCLASS64
d48 69
@


1.1
log
@some includes
@
text
@d1 1
a1 1
/*	$OpenBSD$	*/
d35 9
a43 2
#define _NLIST_DO_AOUT
#define _NLIST_DO_ECOFF
@

