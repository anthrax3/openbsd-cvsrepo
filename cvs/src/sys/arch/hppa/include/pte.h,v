head	1.13;
access;
symbols
	OPENBSD_6_2:1.13.0.16
	OPENBSD_6_2_BASE:1.13
	OPENBSD_6_1:1.13.0.18
	OPENBSD_6_1_BASE:1.13
	OPENBSD_6_0:1.13.0.14
	OPENBSD_6_0_BASE:1.13
	OPENBSD_5_9:1.13.0.10
	OPENBSD_5_9_BASE:1.13
	OPENBSD_5_8:1.13.0.12
	OPENBSD_5_8_BASE:1.13
	OPENBSD_5_7:1.13.0.4
	OPENBSD_5_7_BASE:1.13
	OPENBSD_5_6:1.13.0.8
	OPENBSD_5_6_BASE:1.13
	OPENBSD_5_5:1.13.0.6
	OPENBSD_5_5_BASE:1.13
	OPENBSD_5_4:1.13.0.2
	OPENBSD_5_4_BASE:1.13
	OPENBSD_5_3:1.12.0.6
	OPENBSD_5_3_BASE:1.12
	OPENBSD_5_2:1.12.0.4
	OPENBSD_5_2_BASE:1.12
	OPENBSD_5_1_BASE:1.12
	OPENBSD_5_1:1.12.0.2
	OPENBSD_5_0:1.11.0.38
	OPENBSD_5_0_BASE:1.11
	OPENBSD_4_9:1.11.0.36
	OPENBSD_4_9_BASE:1.11
	OPENBSD_4_8:1.11.0.34
	OPENBSD_4_8_BASE:1.11
	OPENBSD_4_7:1.11.0.30
	OPENBSD_4_7_BASE:1.11
	OPENBSD_4_6:1.11.0.32
	OPENBSD_4_6_BASE:1.11
	OPENBSD_4_5:1.11.0.28
	OPENBSD_4_5_BASE:1.11
	OPENBSD_4_4:1.11.0.26
	OPENBSD_4_4_BASE:1.11
	OPENBSD_4_3:1.11.0.24
	OPENBSD_4_3_BASE:1.11
	OPENBSD_4_2:1.11.0.22
	OPENBSD_4_2_BASE:1.11
	OPENBSD_4_1:1.11.0.20
	OPENBSD_4_1_BASE:1.11
	OPENBSD_4_0:1.11.0.18
	OPENBSD_4_0_BASE:1.11
	OPENBSD_3_9:1.11.0.16
	OPENBSD_3_9_BASE:1.11
	OPENBSD_3_8:1.11.0.14
	OPENBSD_3_8_BASE:1.11
	OPENBSD_3_7:1.11.0.12
	OPENBSD_3_7_BASE:1.11
	OPENBSD_3_6:1.11.0.10
	OPENBSD_3_6_BASE:1.11
	SMP_SYNC_A:1.11
	SMP_SYNC_B:1.11
	OPENBSD_3_5:1.11.0.8
	OPENBSD_3_5_BASE:1.11
	OPENBSD_3_4:1.11.0.6
	OPENBSD_3_4_BASE:1.11
	UBC_SYNC_A:1.11
	OPENBSD_3_3:1.11.0.4
	OPENBSD_3_3_BASE:1.11
	OPENBSD_3_2:1.11.0.2
	OPENBSD_3_2_BASE:1.11
	OPENBSD_3_1:1.10.0.2
	OPENBSD_3_1_BASE:1.10
	UBC_SYNC_B:1.11
	UBC:1.8.0.6
	UBC_BASE:1.8
	OPENBSD_3_0:1.8.0.4
	OPENBSD_3_0_BASE:1.8
	OPENBSD_2_9:1.8.0.2
	OPENBSD_2_9_BASE:1.8
	OPENBSD_2_8:1.7.0.6
	OPENBSD_2_8_BASE:1.7
	OPENBSD_2_7:1.7.0.4
	OPENBSD_2_7_BASE:1.7
	SMP:1.7.0.2
	SMP_BASE:1.7
	kame_19991208:1.7
	OPENBSD_2_6:1.6.0.2
	OPENBSD_2_6_BASE:1.6
	OPENBSD_2_5:1.4.0.2
	OPENBSD_2_5_BASE:1.4
	OPENBSD_2_4:1.2.0.2
	OPENBSD_2_4_BASE:1.2;
locks; strict;
comment	@ * @;


1.13
date	2013.03.25.20.14.30;	author deraadt;	state Exp;
branches;
next	1.12;

1.12
date	2011.11.10.22.48.13;	author deraadt;	state Exp;
branches;
next	1.11;

1.11
date	2002.09.05.18.41.19;	author mickey;	state Exp;
branches;
next	1.10;

1.10
date	2002.04.01.16.23.01;	author mickey;	state Exp;
branches;
next	1.9;

1.9
date	2002.03.15.21.44.18;	author mickey;	state Exp;
branches;
next	1.8;

1.8
date	2001.01.12.23.37.49;	author mickey;	state Exp;
branches
	1.8.6.1;
next	1.7;

1.7
date	99.11.16.16.47.38;	author mickey;	state Exp;
branches
	1.7.2.1;
next	1.6;

1.6
date	99.09.02.06.16.58;	author mickey;	state Exp;
branches;
next	1.5;

1.5
date	99.09.02.05.43.38;	author mickey;	state Exp;
branches;
next	1.4;

1.4
date	99.02.25.17.26.06;	author mickey;	state Exp;
branches;
next	1.3;

1.3
date	98.11.23.03.28.23;	author mickey;	state Exp;
branches;
next	1.2;

1.2
date	98.08.29.01.27.35;	author mickey;	state Exp;
branches;
next	1.1;

1.1
date	98.07.07.21.32.44;	author mickey;	state Exp;
branches;
next	;

1.7.2.1
date	2001.04.18.16.06.28;	author niklas;	state Exp;
branches;
next	1.7.2.2;

1.7.2.2
date	2002.03.28.10.29.05;	author niklas;	state Exp;
branches;
next	1.7.2.3;

1.7.2.3
date	2003.03.27.23.26.54;	author niklas;	state Exp;
branches;
next	;

1.8.6.1
date	2002.06.11.03.35.37;	author art;	state Exp;
branches;
next	1.8.6.2;

1.8.6.2
date	2002.10.29.00.28.03;	author art;	state Exp;
branches;
next	;


desc
@@


1.13
log
@PGOFSET -> PAGE_MASK
@
text
@/*	$OpenBSD: pte.h,v 1.12 2011/11/10 22:48:13 deraadt Exp $	*/

/* 
 * Copyright (c) 1990,1993,1994 The University of Utah and
 * the Computer Systems Laboratory at the University of Utah (CSL).
 * All rights reserved.
 *
 * Permission to use, copy, modify and distribute this software is hereby
 * granted provided that (1) source code retains these copyright, permission,
 * and disclaimer notices, and (2) redistributions including binaries
 * reproduce the notices in supporting documentation, and (3) all advertising
 * materials mentioning features or use of this software display the following
 * acknowledgement: ``This product includes software developed by the
 * Computer Systems Laboratory at the University of Utah.''
 *
 * THE UNIVERSITY OF UTAH AND CSL ALLOW FREE USE OF THIS SOFTWARE IN ITS "AS
 * IS" CONDITION.  THE UNIVERSITY OF UTAH AND CSL DISCLAIM ANY LIABILITY OF
 * ANY KIND FOR ANY DAMAGES WHATSOEVER RESULTING FROM THE USE OF THIS SOFTWARE.
 *
 * CSL requests users of this software to return to csl-dist@@cs.utah.edu any
 * improvements that they make and grant CSL redistribution rights.
 *
 * 	Utah $Hdr: pmap.h 1.24 94/12/14$
 *	Author: Mike Hibler, Bob Wheeler, University of Utah CSL, 9/90
 */

#ifndef	_MACHINE_PTE_H_
#define	_MACHINE_PTE_H_

#define	PTE_PROT_SHIFT	19
#define	PTE_PROT(tlb)	((tlb) >> PTE_PROT_SHIFT)
#define	TLB_PROT(pte)	((pte) << PTE_PROT_SHIFT)
#define	PDE_MASK	(0xffc00000)
#define	PDE_SIZE	(0x00400000)
#define	PTE_MASK	(0x003ff000)
#define	PTE_PAGE(pte)	((pte) & ~PAGE_MASK)

/* TLB access/protection values */
#define TLB_WIRED	0x40000000	/* software only */
#define TLB_REFTRAP	0x20000000
#define TLB_DIRTY	0x10000000
#define TLB_BREAK	0x08000000
#define TLB_AR_MASK	0x07f00000
#define	TLB_READ	0x00000000
#define	TLB_WRITE	0x01000000
#define	TLB_EXECUTE	0x02000000
#define	TLB_GATEWAY	0x04000000
#define	TLB_USER	0x00f00000
#define		TLB_AR_NA	0x07300000
#define		TLB_AR_R	TLB_READ
#define		TLB_AR_RW	TLB_READ|TLB_WRITE
#define		TLB_AR_RX	TLB_READ|TLB_EXECUTE
#define		TLB_AR_RWX	TLB_READ|TLB_WRITE|TLB_EXECUTE
#define TLB_UNCACHABLE	0x00080000
#define TLB_PID_MASK	0x0000fffe

#define	TLB_BITS	"\020\024U\031W\032X\033N\034B\035D\036R\037H"

/* protection for a gateway page */
#define TLB_GATE_PROT	0x04c00000

/* protection for break page */
#define TLB_BREAK_PROT	0x02c00000

#ifndef	_LOCORE
typedef	u_int32_t	pt_entry_t;
#endif

#endif	/* _MACHINE_PTE_H_ */
@


1.12
log
@mindless unification with hppa64; remove meaningless differences before
attacking the complicated stuff
@
text
@d1 1
a1 1
/*	$OpenBSD: pte.h,v 1.11 2002/09/05 18:41:19 mickey Exp $	*/
d36 1
a36 1
#define	PTE_PAGE(pte)	((pte) & ~PGOFSET)
@


1.11
log
@move the kernel virtual away from the physical addresses
and equivalently map the whole physical.
this allows a lot of simplification in how kernel
deals w/ page tables and physical pages.
avoid series of bugs related to that.
check for aliased mappings (none found so far),
and properly flush/purge pages on zero/copy.
@
text
@d1 1
a1 1
/*	$OpenBSD: pte.h,v 1.10 2002/04/01 16:23:01 mickey Exp $	*/
a29 2
typedef	u_int32_t	pt_entry_t;

d64 4
@


1.10
log
@modern tlb bits
@
text
@d1 1
a1 1
/*	$OpenBSD: pte.h,v 1.9 2002/03/15 21:44:18 mickey Exp $	*/
d36 1
@


1.9
log
@rewrite a pmap to use multilevel page tables.
lower 12 bits contain the perms, no unused bits left,
but a couple for off-tlb use (as the ref implemented now).
do not use the hvt, which might get some use later
if proven to speed thigs up, tlb handlers would po
another dozen of insns though, but if that's worth its...
move on the data seg and map kernel text rdonly (idea form fredette),
since all of the page0 mods done before that we are all fine
except for some viper fluff, but later w/ that.
this also picks up a bit more of ddb magic for bpt and ss.
tlb handlers can use a little bit more of attention,
but things, visually, seem to be much faster already, --
sorry, no benchmarks for now.

* effort sponsored in part by the `henry st. old ale house'
* and mr.pete and mr.lee in particular in thier generous entrirety.
* the proj took a little more that 72man*h as it was expected,
* but within murhy's law estimations.
@
text
@d1 1
a1 1
/*	$OpenBSD: pte.h,v 1.8 2001/01/12 23:37:49 mickey Exp $	*/
d58 1
a58 1
#define	TLB_BITS	"\020\024U\031W\032X\033N\034B\035D\036T\037A\040R"
@


1.8
log
@fix PTE_BITS
@
text
@d1 1
a1 1
/*	$OpenBSD: pte.h,v 1.7 1999/11/16 16:47:38 mickey Exp $	*/
d30 9
d40 2
a41 3
#define TLB_REF		0x80000000	/* software only */
#define	TLB_ALIGNED	0x40000000	/* software only */
#define TLB_TRAP	0x20000000
d45 5
d51 5
a55 12
#define		TLB_AR_KR	0x00000000
#define		TLB_AR_KRW	0x01000000
#define		TLB_AR_KRX	0x02000000
#define		TLB_AR_KRWX	0x03000000
#define		TLB_AR_UR	0x00f00000
#define		TLB_AR_URW	0x01f00000
#define		TLB_AR_URX	0x02f00000
#define		TLB_AR_URWX	0x03f00000
#define TLB_UNCACHEABLE	0x00080000
#define TLB_ICACHE	0x00040000	/* software only */
#define TLB_NOTUSED	0x00020000      /* software only */
#define TLB_DCACHE	0x00010000      /* software only */
a56 1
#define TLB_WIRED	0x00000001	/* software only */
a58 11

#define TLB_REF_POS	0
#define TLB_ALIGNED_POS	1
#define TLB_TRAP_POS	2
#define TLB_DIRTY_POS	3
#define TLB_BREAK_POS	4
#define TLB_ITLB_POS    12
#define TLB_ICACHE_POS  13
#define TLB_DTLB_POS    14
#define TLB_DCACHE_POS  15
#define TLB_WIRED_POS	31
@


1.8.6.1
log
@Sync UBC branch to -current
@
text
@d1 1
a1 1
/*	$OpenBSD: pte.h,v 1.8 2001/01/12 23:37:49 mickey Exp $	*/
a29 9
typedef	u_int32_t	pt_entry_t;

#define	PTE_PROT_SHIFT	19
#define	PTE_PROT(tlb)	((tlb) >> PTE_PROT_SHIFT)
#define	TLB_PROT(pte)	((pte) << PTE_PROT_SHIFT)
#define	PDE_MASK	(0xffc00000)
#define	PTE_MASK	(0x003ff000)
#define	PTE_PAGE(pte)	((pte) & ~PGOFSET)

d31 3
a33 2
#define TLB_WIRED	0x40000000	/* software only */
#define TLB_REFTRAP	0x20000000
a36 5
#define	TLB_READ	0x00000000
#define	TLB_WRITE	0x01000000
#define	TLB_EXECUTE	0x02000000
#define	TLB_GATEWAY	0x04000000
#define	TLB_USER	0x00f00000
d38 12
a49 5
#define		TLB_AR_R	TLB_READ
#define		TLB_AR_RW	TLB_READ|TLB_WRITE
#define		TLB_AR_RX	TLB_READ|TLB_EXECUTE
#define		TLB_AR_RWX	TLB_READ|TLB_WRITE|TLB_EXECUTE
#define TLB_UNCACHABLE	0x00080000
d51 3
d55 10
a64 1
#define	TLB_BITS	"\020\024U\031W\032X\033N\034B\035D\036R\037H"
@


1.8.6.2
log
@sync to -current
@
text
@d1 1
a1 1
/*	$OpenBSD: pte.h,v 1.8.6.1 2002/06/11 03:35:37 art Exp $	*/
a35 1
#define	PDE_SIZE	(0x00400000)
@


1.7
log
@define TLB_BITS for %b
@
text
@d1 1
a1 1
/*	$OpenBSD: pte.h,v 1.6 1999/09/02 06:16:58 mickey Exp $	*/
d53 1
a53 1
#define	TLB_BITS	"\020\024C\025U\031W\032X\033N\034B\035D\036T\037A\040R"
@


1.7.2.1
log
@Update the SMP branch to -current, this breaks the SMP branch though.
But it will be fixed soonish.  Note, nothing new has happened, this is just
a merge of the trunk into this branch.
@
text
@d1 1
a1 1
/*	$OpenBSD: pte.h,v 1.8 2001/01/12 23:37:49 mickey Exp $	*/
d53 1
a53 1
#define	TLB_BITS	"\020\024U\031W\032X\033N\034B\035D\036T\037A\040R"
@


1.7.2.2
log
@Merge in -current from about a week ago
@
text
@d1 1
a1 1
/*	$OpenBSD$	*/
a29 9
typedef	u_int32_t	pt_entry_t;

#define	PTE_PROT_SHIFT	19
#define	PTE_PROT(tlb)	((tlb) >> PTE_PROT_SHIFT)
#define	TLB_PROT(pte)	((pte) << PTE_PROT_SHIFT)
#define	PDE_MASK	(0xffc00000)
#define	PTE_MASK	(0x003ff000)
#define	PTE_PAGE(pte)	((pte) & ~PGOFSET)

d31 3
a33 2
#define TLB_WIRED	0x40000000	/* software only */
#define TLB_REFTRAP	0x20000000
a36 5
#define	TLB_READ	0x00000000
#define	TLB_WRITE	0x01000000
#define	TLB_EXECUTE	0x02000000
#define	TLB_GATEWAY	0x04000000
#define	TLB_USER	0x00f00000
d38 12
a49 5
#define		TLB_AR_R	TLB_READ
#define		TLB_AR_RW	TLB_READ|TLB_WRITE
#define		TLB_AR_RX	TLB_READ|TLB_EXECUTE
#define		TLB_AR_RWX	TLB_READ|TLB_WRITE|TLB_EXECUTE
#define TLB_UNCACHABLE	0x00080000
d51 1
d54 11
@


1.7.2.3
log
@Sync the SMP branch with 3.3
@
text
@a35 1
#define	PDE_SIZE	(0x00400000)
d58 1
a58 1
#define	TLB_BITS	"\020\024U\031W\032X\033N\034B\035D\036R\037H"
@


1.6
log
@add uncaceable, per pa1.1 manual
@
text
@d1 1
a1 1
/*	$OpenBSD: pte.h,v 1.5 1999/09/02 05:43:38 mickey Exp $	*/
d52 2
@


1.5
log
@replace w/ one derived from Lites-parisc, UofUtah
@
text
@d1 1
a1 1
/*	$OpenBSD$	*/
d46 1
a46 1
#define TLB_ZERO	0x00080000	/* software only */
@


1.4
log
@remove unused software bits
@
text
@d1 1
a1 1
/*	$OpenBSD: pte.h,v 1.3 1998/11/23 03:28:23 mickey Exp $	*/
d3 22
a24 22
/*
 * Copyright 1996 1995 by Open Software Foundation, Inc.   
 *              All Rights Reserved 
 *  
 * Permission to use, copy, modify, and distribute this software and 
 * its documentation for any purpose and without fee is hereby granted, 
 * provided that the above copyright notice appears in all copies and 
 * that both the copyright notice and this permission notice appear in 
 * supporting documentation. 
 *  
 * OSF DISCLAIMS ALL WARRANTIES WITH REGARD TO THIS SOFTWARE 
 * INCLUDING ALL IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS 
 * FOR A PARTICULAR PURPOSE. 
 *  
 * IN NO EVENT SHALL OSF BE LIABLE FOR ANY SPECIAL, INDIRECT, OR 
 * CONSEQUENTIAL DAMAGES OR ANY DAMAGES WHATSOEVER RESULTING FROM 
 * LOSS OF USE, DATA OR PROFITS, WHETHER IN ACTION OF CONTRACT, 
 * NEGLIGENCE, OR OTHER TORTIOUS ACTION, ARISING OUT OF OR IN CONNECTION 
 * WITH THE USE OR PERFORMANCE OF THIS SOFTWARE. 
 */
/*
 * pmk1.1
a29 1

d46 2
a47 1
#define TLB_UNCACHEABLE	0x00080000
d49 1
d59 1
d61 1
d70 1
a70 39
#if defined(TLB_STATS) && !defined(_LOCORE)
struct dtlb_stats {
	u_int	dtlb_misses;
	u_int	dtlb_io;
	u_int	dtlb_misstime;
	u_int	dtlb_missflts;
	u_int	dtlb_missinsns;
	u_int	dtlb_cached;
	u_int	dtlb_tmp[2];
};

struct itlb_stats {
	u_int	itlb_misses;
	u_int	itlb_gateway;
	u_int	itlb_misstime;
	u_int	itlb_missflts;
	u_int	itlb_missinsns;
	u_int	itlb_cached;
	u_int	itlb_dummy[2];
};

struct	tlbd_stats {
	u_int	tlbd_dirty;
	u_int	tlbd_flushes;
	u_int	tlbd_misstime;
	u_int	tlbd_missflts;
	u_int	tlbd_missinsns;
	u_int	tlbd_dummy[3];
};

#ifdef _KERNEL
extern struct dtlb_stats dtlb_stats;
extern struct itlb_stats dtlb_stats;
extern struct tlbd_stats dtlb_stats;
#endif /* _KERNEL */

#endif	/* TLB_STATS && !_LOCORE */

#endif /* _MACHINE_PTE_H_ */
@


1.3
log
@proper m-include protection, some minor cleanups
@
text
@d1 1
a1 1
/*	$OpenBSD: pte.h,v 1.2 1998/08/29 01:27:35 mickey Exp $	*/
a47 1
#define TLB_ICACHE	0x00040000	/* software only */
a48 1
#define TLB_DCACHE	0x00010000      /* software only */
a57 1
#define TLB_ICACHE_POS  13
a58 1
#define TLB_DCACHE_POS  15
@


1.2
log
@TLB stats definitions
@
text
@d1 1
a1 1
/*	$OpenBSD: pte.h,v 1.1 1998/07/07 21:32:44 mickey Exp $	*/
d27 2
a28 2
#ifndef	_HPPA_PTE_H_
#define	_HPPA_PTE_H_
d109 1
a109 1
#endif /* _HPPA_PTE_H_ */
@


1.1
log
@more includes
@
text
@d1 1
a1 1
/*	$OpenBSD$	*/
d70 38
@

