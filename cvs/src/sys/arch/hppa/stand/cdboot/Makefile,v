head	1.10;
access;
symbols
	OPENBSD_6_1_BASE:1.10
	OPENBSD_6_0:1.9.0.10
	OPENBSD_6_0_BASE:1.9
	OPENBSD_5_9:1.9.0.6
	OPENBSD_5_9_BASE:1.9
	OPENBSD_5_8:1.9.0.8
	OPENBSD_5_8_BASE:1.9
	OPENBSD_5_7:1.9.0.2
	OPENBSD_5_7_BASE:1.9
	OPENBSD_5_6:1.9.0.4
	OPENBSD_5_6_BASE:1.9
	OPENBSD_5_5:1.8.0.4
	OPENBSD_5_5_BASE:1.8
	OPENBSD_5_4:1.7.0.4
	OPENBSD_5_4_BASE:1.7
	OPENBSD_5_3:1.7.0.2
	OPENBSD_5_3_BASE:1.7
	OPENBSD_5_2:1.5.0.20
	OPENBSD_5_2_BASE:1.5
	OPENBSD_5_1_BASE:1.5
	OPENBSD_5_1:1.5.0.18
	OPENBSD_5_0:1.5.0.16
	OPENBSD_5_0_BASE:1.5
	OPENBSD_4_9:1.5.0.14
	OPENBSD_4_9_BASE:1.5
	OPENBSD_4_8:1.5.0.12
	OPENBSD_4_8_BASE:1.5
	OPENBSD_4_7:1.5.0.8
	OPENBSD_4_7_BASE:1.5
	OPENBSD_4_6:1.5.0.10
	OPENBSD_4_6_BASE:1.5
	OPENBSD_4_5:1.5.0.6
	OPENBSD_4_5_BASE:1.5
	OPENBSD_4_4:1.5.0.4
	OPENBSD_4_4_BASE:1.5
	OPENBSD_4_3:1.5.0.2
	OPENBSD_4_3_BASE:1.5
	OPENBSD_4_2:1.3.0.22
	OPENBSD_4_2_BASE:1.3
	OPENBSD_4_1:1.3.0.20
	OPENBSD_4_1_BASE:1.3
	OPENBSD_4_0:1.3.0.18
	OPENBSD_4_0_BASE:1.3
	OPENBSD_3_9:1.3.0.16
	OPENBSD_3_9_BASE:1.3
	OPENBSD_3_8:1.3.0.14
	OPENBSD_3_8_BASE:1.3
	OPENBSD_3_7:1.3.0.12
	OPENBSD_3_7_BASE:1.3
	OPENBSD_3_6:1.3.0.10
	OPENBSD_3_6_BASE:1.3
	SMP_SYNC_A:1.3
	SMP_SYNC_B:1.3
	OPENBSD_3_5:1.3.0.8
	OPENBSD_3_5_BASE:1.3
	OPENBSD_3_4:1.3.0.6
	OPENBSD_3_4_BASE:1.3
	UBC:1.3.0.4
	UBC_SYNC_A:1.3
	SMP:1.3.0.2;
locks; strict;
comment	@# @;


1.10
date	2016.07.30.03.25.48;	author guenther;	state Exp;
branches;
next	1.9;
commitid	HVbAtwruDlJazNH2;

1.9
date	2014.07.13.21.18.26;	author miod;	state Exp;
branches;
next	1.8;
commitid	OASH8tyUPaUS4lQ8;

1.8
date	2013.10.15.22.49.03;	author deraadt;	state Exp;
branches;
next	1.7;

1.7
date	2012.08.31.16.13.20;	author pascal;	state Exp;
branches;
next	1.6;

1.6
date	2012.08.21.14.46.18;	author pascal;	state Exp;
branches;
next	1.5;

1.5
date	2007.12.26.18.52.59;	author kettenis;	state Exp;
branches;
next	1.4;

1.4
date	2007.11.26.08.36.49;	author deraadt;	state Exp;
branches;
next	1.3;

1.3
date	2003.04.17.12.15.51;	author mickey;	state Exp;
branches
	1.3.2.1;
next	1.2;

1.2
date	2003.04.15.18.07.32;	author mickey;	state Exp;
branches;
next	1.1;

1.1
date	2003.03.28.22.42.26;	author mickey;	state Exp;
branches;
next	;

1.3.2.1
date	2003.05.12.19.53.59;	author ho;	state Exp;
branches;
next	;


desc
@@


1.10
log
@Prep for relro: make sure it's off for any non-PIE stand/ program

ok millert@@ kettenis@@
@
text
@#	$OpenBSD: Makefile,v 1.9 2014/07/13 21:18:26 miod Exp $

NOMAN=	no man
S	=${.CURDIR}/../../../..
CLEANFILES+=	cdboot.gdb cdboot.map

.if ${MACHINE} == "hppa"

PROG=	cdboot

.PATH:	${.CURDIR}/../boot
SRCS+=	srt0.S

SRCS=	srt0.S cdboot.c

.PATH:	${.CURDIR}/../libsa
SRCS+=	pdc.c itecons.c dev_hppa.c dk.c elf32.c elf64.c
CPPFLAGS+=-DCONSPEED=9600

.PATH:	${S}/lib/libkern/arch/hppa ${S}/lib/libkern
SRCS+=	milli.S strlen.c strlcpy.c

LD?=	ld
LDFLAGS+=-Bstatic -nostartfiles -nostdlib -N -Ttext $(LINKADDR) -nopie -znorelro
LDFLAGS+=-T ${.CURDIR}/ld.script -Map cdboot.map
SIZE?=	size
STRIP?=	strip
STANDIR=${.CURDIR}/..
CRTBEGIN=
CRTEND=

SAREL=
USE_LOADFILE=yes
.include "${S}/lib/libsa/Makefile.inc"
DPADD+= $(SALIB)
LDADD+=	$(SALIB)

all:	${PROG}

clean::
	rm -f a.out [Ee]rrs mklog *.core \
	    ${PROG} ${OBJS} ${LOBJS} ${CLEANFILES}

realinstall:
	${INSTALL} ${INSTALL_COPY} -o ${BINOWN} -g ${BINGRP} -m ${BINMODE} \
	    ${PROG} ${DESTDIR}${BINDIR}

# TODO check for <=32k
${PROG}: $(OBJS) $(DPADD)
	$(LD) $(LDFLAGS) -o $(PROG) $(OBJS) $(LDADD)
	@@cp ${PROG} ${PROG}.gdb
	${STRIP} ${PROG}
	@@${SIZE} $(PROG)
	@@${MKBOOT} -v ${PROG} ${PROG}.lif
	@@mv ${PROG}.lif ${PROG}
.else
NOPROG=
.endif

.include <bsd.prog.mk>

CPPFLAGS+=-DRELOC=${LOADADDR} -DHEAP_LIMIT=${HEAP_LIMIT}
CFLAGS+=$(SACFLAGS) -I../.. -I${.CURDIR}/../libsa -I${S}/stand/boot
CFLAGS+=-fno-pie
AFLAGS+=-fno-pie
@


1.9
log
@#$%#@@$# CONSPEED
@
text
@d1 1
a1 1
#	$OpenBSD: Makefile,v 1.8 2013/10/15 22:49:03 deraadt Exp $
d24 1
a24 1
LDFLAGS+=-Bstatic -nostartfiles -nostdlib -N -Ttext $(LINKADDR) -nopie
@


1.8
log
@We do not produce "core" files, so they do not need to be deleted.  they
have been *.core files for a very long time.  That's a lot of unlink()
calls saved.
@
text
@d1 1
a1 1
#	$OpenBSD: Makefile,v 1.7 2012/08/31 16:13:20 pascal Exp $
d18 1
@


1.7
log
@Kill NOPIE and NOPIE_FLAGS in hppa/stand.

ok deraadt@@
@
text
@d1 1
a1 1
#	$OpenBSD: Makefile,v 1.6 2012/08/21 14:46:18 pascal Exp $
d40 1
a40 1
	rm -f a.out [Ee]rrs mklog core *.core \
@


1.6
log
@Add NOPIE= bits for sys/arch/*/stand to ensure that bootblocks will always be
built with -fno-pie.  This gets the hairiest part of PIE out of the way ...

ok deraadt@@
@
text
@d1 1
a1 1
#	$OpenBSD: Makefile,v 1.5 2007/12/26 18:52:59 kettenis Exp $
d23 1
a23 1
LDFLAGS+=-Bstatic -nostartfiles -nostdlib -N -Ttext $(LINKADDR)
d63 2
a64 2
CFLAGS+=${NOPIE_FLAGS}
AFLAGS+=${NOPIE_FLAGS}
@


1.5
log
@Teach the hppa bootloader how to boot 64-bit kernels.

ok miod@@, deraadt@@
@
text
@d1 1
a1 1
#	$OpenBSD: Makefile,v 1.4 2007/11/26 08:36:49 deraadt Exp $
d63 2
@


1.4
log
@adjust to libkern changes (and pretty .PATH logic); parts from maja
@
text
@d1 1
a1 1
#	$OpenBSD: Makefile,v 1.3 2003/04/17 12:15:51 mickey Exp $
d17 1
a17 1
SRCS+=	pdc.c itecons.c dev_hppa.c dk.c 
@


1.3
log
@new boots
@
text
@d1 1
a1 1
#	$OpenBSD: Makefile,v 1.2 2003/04/15 18:07:32 mickey Exp $
d10 12
a21 1
SRCS=	srt0.S cdboot.c pdc.c itecons.c dev_hppa.c dk.c
d34 2
a35 6
DPADD+= $(SALIB) $(LIBKERN)
LDADD+=	$(SALIB) $(LIBKERN)

.PATH:	${S}/stand/boot
.PATH:	${.CURDIR}/../boot
.PATH:	${.CURDIR}/../libsa
@


1.3.2.1
log
@Add new file to SMP branch
@
text
@d1 1
a1 1
#	$OpenBSD$
@


1.2
log
@rearrange devsw to place dk in the beginning. necessary glue hookups in cdboot
@
text
@d1 1
a1 1
#	$OpenBSD: Makefile,v 1.1 2003/03/28 22:42:26 mickey Exp $
d10 1
a10 1
SRCS=	srt0.S exec.c cdboot.c pdc.c itecons.c dev_hppa.c dk.c
@


1.1
log
@a small boot for a cd
@
text
@d1 1
a1 1
#	$OpenBSD$
d10 1
a10 2
SRCS=	srt0.S exec.c cdboot.c conf.c \
	machdep.c pdc.c itecons.c dev_hppa.c dk.c
@

