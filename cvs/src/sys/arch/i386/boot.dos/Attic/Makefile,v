head	1.6;
access;
symbols
	SMP_SYNC_A:1.6
	SMP_SYNC_B:1.6
	UBC_SYNC_A:1.6
	UBC_SYNC_B:1.6
	SMP:1.6.0.2
	OPENBSD_2_2:1.5.0.4
	OPENBSD_2_2_BASE:1.5
	OPENBSD_2_1:1.5.0.2
	OPENBSD_2_1_BASE:1.5
	OPENBSD_2_0:1.1.0.2
	OPENBSD_2_0_BASE:1.1;
locks; strict;
comment	@# @;


1.6
date	97.11.05.02.47.08;	author mickey;	state dead;
branches;
next	1.5;

1.5
date	97.04.27.20.56.26;	author millert;	state Exp;
branches;
next	1.4;

1.4
date	97.01.02.16.37.53;	author etheisen;	state Exp;
branches;
next	1.3;

1.3
date	96.12.29.19.44.49;	author graichen;	state Exp;
branches;
next	1.2;

1.2
date	96.12.26.10.50.47;	author mickey;	state Exp;
branches;
next	1.1;

1.1
date	96.05.19.15.31.14;	author mickey;	state Exp;
branches;
next	;


desc
@@


1.6
log
@who needs that junk (;
@
text
@#	$OpenBSD: Makefile,v 1.5 1997/04/27 20:56:26 millert Exp $
#	$NetBSD: Makefile,v 1.18 1995/03/23 19:46:45 jtc Exp $
#
# Ported to boot 386BSD by Julian Elischer (julian@@tfs.com)
# September 1992
#
# Permission to use, copy, modify and distribute this software and its
# documentation is hereby granted, provided that both the copyright
# notice and this permission notice appear in all copies of the
# software, derivative works or modified versions, and any portions
# thereof, and that both notices appear in supporting documentation.
#
# CARNEGIE MELLON ALLOWS FREE USE OF THIS SOFTWARE IN ITS "AS IS"
# CONDITION.  CARNEGIE MELLON DISCLAIMS ANY LIABILITY OF ANY KIND FOR
# ANY DAMAGES WHATSOEVER RESULTING FROM THE USE OF THIS SOFTWARE.
#
# Carnegie Mellon requests users of this software to return to
#
#  Software Distribution Coordinator  or  Software.Distribution@@CS.CMU.EDU
#  School of Computer Science
#  Carnegie Mellon University
#  Pittsburgh PA 15213-3890
#
# any improvements or extensions that they make and grant Carnegie Mellon
# the rights to redistribute these changes.
#

PROG=	boot.com
NOMAN=	noman
INSTALL_STRIP=

S=	${.CURDIR}/../../..

CFLAGS+=-O2 -D_KERNEL -I${.CURDIR}/../stand/libsa -I${S}/lib/libsa
CFLAGS+=-DDO_BAD144 -I. -I$S -I${.CURDIR}/../.. -I${.CURDIR}/../boot
LDFLAGS=-Bstatic -e start -Wl,-N,-T100

# Uncomment this to make the boot block talk to a serial port.
#CPPFLAGS+=-DSERIAL
# Uncomment this to make boot blocks read DOS files
CPPFLAGS+= -DDOSREAD -DDEBUG

# start.o should be first
SRCS+= start.S table.c boot.c disk.c io.c serial.S sys.c bios.S asm.S
SRCS+= dossys.c version.c
BINDIR=	/usr/mdec

.PATH: ${.CURDIR}/../boot

all: machine-links

machine-links:
	-rm -f machine && ln -s ${.CURDIR}/../include machine
	-rm -f ${MACHINE_ARCH} && ln -s ${.CURDIR}/../include ${MACHINE_ARCH}

boot.com: ${OBJS}
	${LD} -Bstatic -e start -N -T 0x100 -o dosboot ${OBJS}
	cp dosboot dosboot.sym
	@@strip dosboot
	@@sh ${.CURDIR}/../boot/rmaouthdr dosboot dosboot.tmp
	@@mv -f dosboot.tmp boot.com
	@@ls -l boot.com

CLEANFILES+=dosboot dosboot.sym machine ${MACHINE_ARCH}

.include <bsd.prog.mk>
@


1.5
log
@COPY -> INSTALL_COPY and STRIP -> INSTALL_STRIP
This fixes namespace problems where STRIP is sometimes used as
the name of the strip(1) to use and other times used as
the flag to send install(1) when stripping (or not).
COPY doesn't have this problem (yet) but was poorly named.
@
text
@d1 1
a1 1
#	$OpenBSD: Makefile,v 1.4 1997/01/02 16:37:53 etheisen Exp $
@


1.4
log
@DESTDIR already set.
@
text
@d1 1
a1 1
#	$OpenBSD: Makefile,v 1.3 1996/12/29 19:44:49 graichen Exp $
d30 1
a30 1
STRIP=
@


1.3
log
@don't strip boot.com on install
@
text
@d1 1
a1 1
#	$OpenBSD: Makefile,v 1.2 1996/12/26 10:50:47 mickey Exp $
d46 1
a46 1
BINDIR=	${DESTDIR}/usr/mdec
@


1.2
log
@compile, Makefile rebuild
@
text
@d1 1
a1 1
#	$OpenBSD$
d30 1
@


1.1
log
@initial commit of dos boot loader.
@
text
@d1 2
a2 1
#     $NetBSD: Makefile,v 1.18 1995/03/23 19:46:45 jtc Exp $
d28 2
a29 1
S=    ${.CURDIR}/../../..
d31 1
a31 5
machine-links:
	-rm -f machine && ln -s ${.CURDIR}/../include machine
	-rm -f ${MACHINE_ARCH} && ln -s ${.CURDIR}/../include ${MACHINE_ARCH}

all: machine-links boot.com
d33 3
a35 5
NOPROG=       noprog
NOMAN=        noman

CFLAGS=	-O6 -DKERNEL -D_KERNEL -DI386_CPU -DI486_CPU -DI586_CPU
CFLAGS+=-DDO_BAD144 -I. -I${.CURDIR} -I$S -I${.CURDIR}/../.. -I${.CURDIR}/../boot
d43 11
a53 2
OBJS= start.o table.o boot.o asm.o bios.o dossys.o io.o disk.o sys.o version.o
VPATH=        ${.CURDIR}/../boot
d63 1
a63 5
install: boot.com
	cp boot.com ${DESTDIR}/usr/mdec/boot.com


CLEANFILES+=boot.com dosboot dosboot.sym machine ${MACHINE_ARCH}
@
