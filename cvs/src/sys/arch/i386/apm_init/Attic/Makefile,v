head	1.3;
access;
symbols
	SMP_SYNC_A:1.3
	SMP_SYNC_B:1.3
	UBC_SYNC_A:1.3
	UBC_SYNC_B:1.3
	SMP:1.3.0.2
	OPENBSD_2_1:1.1.0.4
	OPENBSD_2_1_BASE:1.1
	OPENBSD_2_0:1.1.0.2
	OPENBSD_2_0_BASE:1.1;
locks; strict;
comment	@# @;


1.3
date	97.09.21.04.33.19;	author mickey;	state dead;
branches;
next	1.2;

1.2
date	97.05.30.08.05.53;	author niklas;	state Exp;
branches;
next	1.1;

1.1
date	96.04.29.14.14.11;	author hvozda;	state Exp;
branches;
next	;


desc
@@


1.3
log
@no this ugly hack, no more!
@
text
@#
# LP (Laptop Package)
#
# (C) 1994 by HOSOKAWA, Tatsumi <hosokawa@@mt.cs.keio.ac.jp>
#
# This software may be used, modified, copied, and distributed in
# both source and binary form provided that the above copyright and
# these terms are retained. Under no circumstances is the author 
# responsible for the proper functioning of this software, nor does 
# the author assume any responsibility for damages incurred with its 
# use.
#
# Sep., 1994	Implemented on FreeBSD 1.1.5.1R (Toshiba AVS001WD)
# Oct., 1994	NetBSD port (1.0 BETA 10/2) by ukai
# Dec., 1995	NetBSD 1.1 kernel build retrofit, jtk@@netbsd.org
#

.if exists (${APMDIR}/arch/${MACHINE_ARCH}/Makefile.inc)
.PATH:	${APMDIR}/arch/${MACHINE_ARCH}
.include "${APMDIR}/arch/${MACHINE_ARCH}/Makefile.inc"
.endif

.PATH: ${APMDIR}

CC = ${APMCC}
CFLAGS += -DINITIALIZER	-I${APMDIR} -DKERNEL \
	${APMCFLAGS:S@@-I.@@-I${KERNREL}.@@g}

OBJS = apm_init.o real_prot.o table.o

#.SUFFIXES: .c .S .o
#
#.c.o:
#	$(CC)  $(CFLAGS) $(OPTFLAGS) $(INC) -c $<
#
.S.o:
	$(CC)  $(CFLAGS) $(INC) -c $<

apm_init.inc: apm_init
	sh ${APMDIR}/bin2asm.sh apm_init > apm_init.inc

apm_init: $(OBJS)
	$(LD) -Bstatic -N -T 0 -o apm_init $(OBJS)
	cp apm_init apm_init.sym
	@@strip apm_init
	@@sh ${APMDIR}/rmaouthdr apm_init apm_init.tmp
	@@mv -f apm_init.tmp apm_init

#allclean: clean
#	@@rm -f apm_init.inc
clean:
	rm -f *.o apm_init apm_init.sym apm_init.inc

#.include <bsd.prog.mk>
@


1.2
log
@Fix APM building with absolute $S path
@
text
@@


1.1
log
@Pull in John Kohl's [jtk@@netbsd.org] most recent (15Apr96) APM and PCMCIA work
(original PCMCIA framework  by Stefan Grefen [grefen@@convex.com]).
@
text
@d18 3
a20 5
DIR=${APMREL}${APMDIR}

.if exists (${DIR}/arch/${MACHINE_ARCH}/Makefile.inc)
.PATH:	${DIR}/arch/${MACHINE_ARCH}
.include "${DIR}/arch/${MACHINE_ARCH}/Makefile.inc"
d23 1
a23 1
.PATH: ${DIR}
d26 1
a26 1
CFLAGS += -DINITIALIZER	-I${DIR} -DKERNEL \
d40 1
a40 1
	sh ${DIR}/bin2asm.sh apm_init > apm_init.inc
d46 1
a46 1
	@@sh ${DIR}/rmaouthdr apm_init apm_init.tmp
@
