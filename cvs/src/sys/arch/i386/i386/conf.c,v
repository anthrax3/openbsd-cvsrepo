head	1.158;
access;
symbols
	OPENBSD_6_1:1.158.0.2
	OPENBSD_6_1_BASE:1.158
	OPENBSD_6_0:1.155.0.2
	OPENBSD_6_0_BASE:1.155
	OPENBSD_5_9:1.153.0.2
	OPENBSD_5_9_BASE:1.153
	OPENBSD_5_8:1.150.0.6
	OPENBSD_5_8_BASE:1.150
	OPENBSD_5_7:1.150.0.2
	OPENBSD_5_7_BASE:1.150
	OPENBSD_5_6:1.146.0.4
	OPENBSD_5_6_BASE:1.146
	OPENBSD_5_5:1.145.0.4
	OPENBSD_5_5_BASE:1.145
	OPENBSD_5_4:1.143.0.2
	OPENBSD_5_4_BASE:1.143
	OPENBSD_5_3:1.141.0.2
	OPENBSD_5_3_BASE:1.141
	OPENBSD_5_2:1.140.0.2
	OPENBSD_5_2_BASE:1.140
	OPENBSD_5_1_BASE:1.139
	OPENBSD_5_1:1.139.0.2
	OPENBSD_5_0:1.138.0.2
	OPENBSD_5_0_BASE:1.138
	OPENBSD_4_9:1.136.0.2
	OPENBSD_4_9_BASE:1.136
	OPENBSD_4_8:1.134.0.2
	OPENBSD_4_8_BASE:1.134
	OPENBSD_4_7:1.132.0.2
	OPENBSD_4_7_BASE:1.132
	OPENBSD_4_6:1.131.0.4
	OPENBSD_4_6_BASE:1.131
	OPENBSD_4_5:1.130.0.2
	OPENBSD_4_5_BASE:1.130
	OPENBSD_4_4:1.127.0.2
	OPENBSD_4_4_BASE:1.127
	OPENBSD_4_3:1.122.0.2
	OPENBSD_4_3_BASE:1.122
	OPENBSD_4_2:1.118.0.2
	OPENBSD_4_2_BASE:1.118
	OPENBSD_4_1:1.115.0.2
	OPENBSD_4_1_BASE:1.115
	OPENBSD_4_0:1.113.0.2
	OPENBSD_4_0_BASE:1.113
	OPENBSD_3_9:1.112.0.2
	OPENBSD_3_9_BASE:1.112
	OPENBSD_3_8:1.111.0.2
	OPENBSD_3_8_BASE:1.111
	OPENBSD_3_7:1.109.0.2
	OPENBSD_3_7_BASE:1.109
	OPENBSD_3_6:1.108.0.2
	OPENBSD_3_6_BASE:1.108
	SMP_SYNC_A:1.108
	SMP_SYNC_B:1.108
	OPENBSD_3_5:1.106.0.2
	OPENBSD_3_5_BASE:1.106
	OPENBSD_3_4:1.103.0.2
	OPENBSD_3_4_BASE:1.103
	UBC_SYNC_A:1.102
	OPENBSD_3_3:1.101.0.2
	OPENBSD_3_3_BASE:1.101
	OPENBSD_3_2:1.99.0.2
	OPENBSD_3_2_BASE:1.99
	OPENBSD_3_1:1.88.0.2
	OPENBSD_3_1_BASE:1.88
	UBC_SYNC_B:1.99
	UBC:1.84.0.2
	UBC_BASE:1.84
	OPENBSD_3_0:1.81.0.2
	OPENBSD_3_0_BASE:1.81
	OPENBSD_2_9:1.67.0.2
	OPENBSD_2_9_BASE:1.67
	OPENBSD_2_8:1.62.0.2
	OPENBSD_2_8_BASE:1.62
	OPENBSD_2_7:1.60.0.2
	OPENBSD_2_7_BASE:1.60
	SMP:1.57.0.4
	SMP_BASE:1.57
	kame_19991208:1.57
	OPENBSD_2_6:1.57.0.2
	OPENBSD_2_6_BASE:1.57
	OPENBSD_2_5:1.51.0.2
	OPENBSD_2_5_BASE:1.51
	OPENBSD_2_4:1.49.0.2
	OPENBSD_2_4_BASE:1.49
	OPENBSD_2_3:1.43.0.2
	OPENBSD_2_3_BASE:1.43
	OPENBSD_2_2:1.41.0.2
	OPENBSD_2_2_BASE:1.41
	OPENBSD_2_1:1.32.0.2
	OPENBSD_2_1_BASE:1.32
	OPENBSD_2_0:1.23.0.2
	OPENBSD_2_0_BASE:1.23
	netbsd_1_1:1.1.1.1;
locks; strict;
comment	@ * @;


1.158
date	2016.10.21.06.20.58;	author mlarkin;	state Exp;
branches;
next	1.157;
commitid	szRuKZ9HgqvwYLcM;

1.157
date	2016.09.04.10.51.23;	author naddy;	state Exp;
branches;
next	1.156;
commitid	4OWaAfwqMvhOCLOI;

1.156
date	2016.09.02.17.06.12;	author goda;	state Exp;
branches;
next	1.155;
commitid	J1JzeTsS8K8zyH3c;

1.155
date	2016.04.25.20.09.14;	author tedu;	state Exp;
branches;
next	1.154;
commitid	43yo2G4zZOY9ab4i;

1.154
date	2016.02.26.09.10.04;	author natano;	state Exp;
branches;
next	1.153;
commitid	NHDvdrxPpwDqGtpK;

1.153
date	2016.02.05.06.29.01;	author uebayasi;	state Exp;
branches;
next	1.152;
commitid	3lmLbhQAi8VhAKnD;

1.152
date	2016.01.27.09.04.19;	author reyk;	state Exp;
branches;
next	1.151;
commitid	xjeRSSQ0SXSd3nFz;

1.151
date	2015.10.23.15.10.52;	author claudio;	state Exp;
branches;
next	1.150;
commitid	g17gxjQh9N9egLbB;

1.150
date	2014.12.11.19.44.17;	author tedu;	state Exp;
branches;
next	1.149;
commitid	jUSAZlQ30WF1ESM9;

1.149
date	2014.10.09.04.10.03;	author tedu;	state Exp;
branches;
next	1.148;
commitid	Db8IHIncfKM3SDX9;

1.148
date	2014.10.09.03.59.59;	author tedu;	state Exp;
branches;
next	1.147;
commitid	I0KLtD9aVxAdm6aW;

1.147
date	2014.08.20.06.14.42;	author mikeb;	state Exp;
branches;
next	1.146;
commitid	qXFkosC6o9cv78HT;

1.146
date	2014.03.14.23.42.40;	author kettenis;	state Exp;
branches;
next	1.145;

1.145
date	2013.11.04.14.11.29;	author deraadt;	state Exp;
branches;
next	1.144;

1.144
date	2013.08.20.14.27.28;	author ajacoutot;	state Exp;
branches;
next	1.143;

1.143
date	2013.06.03.15.54.47;	author tedu;	state Exp;
branches;
next	1.142;

1.142
date	2013.03.15.09.10.52;	author ratchov;	state Exp;
branches;
next	1.141;

1.141
date	2012.08.23.06.12.49;	author deraadt;	state Exp;
branches;
next	1.140;

1.140
date	2012.04.06.15.10.39;	author jsing;	state Exp;
branches;
next	1.139;

1.139
date	2011.10.06.20.49.28;	author deraadt;	state Exp;
branches;
next	1.138;

1.138
date	2011.07.04.22.53.53;	author tedu;	state Exp;
branches;
next	1.137;

1.137
date	2011.06.26.23.19.11;	author tedu;	state Exp;
branches;
next	1.136;

1.136
date	2011.01.14.19.04.08;	author jasper;	state Exp;
branches;
next	1.135;

1.135
date	2010.09.22.13.03.47;	author claudio;	state Exp;
branches;
next	1.134;

1.134
date	2010.07.03.03.59.16;	author krw;	state Exp;
branches;
next	1.133;

1.133
date	2010.06.09.15.25.32;	author jsing;	state Exp;
branches;
next	1.132;

1.132
date	2009.08.13.15.04.20;	author dlg;	state Exp;
branches;
next	1.131;

1.131
date	2009.06.03.14.45.51;	author jj;	state Exp;
branches;
next	1.130;

1.130
date	2009.01.25.17.30.48;	author miod;	state Exp;
branches;
next	1.129;

1.129
date	2008.11.23.18.19.02;	author deraadt;	state Exp;
branches;
next	1.128;

1.128
date	2008.11.22.21.26.48;	author oga;	state Exp;
branches;
next	1.127;

1.127
date	2008.06.14.21.31.46;	author mbalmer;	state Exp;
branches;
next	1.126;

1.126
date	2008.06.12.20.03.48;	author mglocker;	state Exp;
branches;
next	1.125;

1.125
date	2008.05.21.18.49.47;	author kettenis;	state Exp;
branches;
next	1.124;

1.124
date	2008.05.14.20.49.48;	author miod;	state Exp;
branches;
next	1.123;

1.123
date	2008.04.08.14.31.54;	author claudio;	state Exp;
branches;
next	1.122;

1.122
date	2007.11.28.23.37.34;	author oga;	state Exp;
branches;
next	1.121;

1.121
date	2007.11.25.17.11.12;	author oga;	state Exp;
branches;
next	1.120;

1.120
date	2007.11.25.15.42.15;	author tedu;	state Exp;
branches;
next	1.119;

1.119
date	2007.09.18.18.13.06;	author mk;	state Exp;
branches;
next	1.118;

1.118
date	2007.07.23.13.30.21;	author mk;	state Exp;
branches;
next	1.117;

1.117
date	2007.05.29.19.03.35;	author krw;	state Exp;
branches;
next	1.116;

1.116
date	2007.05.28.02.13.44;	author krw;	state Exp;
branches;
next	1.115;

1.115
date	2007.02.06.22.39.13;	author dlg;	state Exp;
branches;
next	1.114;

1.114
date	2006.09.19.11.06.33;	author jsg;	state Exp;
branches;
next	1.113;

1.113
date	2006.06.11.10.56.39;	author mk;	state Exp;
branches;
next	1.112;

1.112
date	2005.12.31.22.40.37;	author miod;	state Exp;
branches;
next	1.111;

1.111
date	2005.07.31.06.39.07;	author dlg;	state Exp;
branches;
next	1.110;

1.110
date	2005.06.02.20.09.39;	author tholo;	state Exp;
branches;
next	1.109;

1.109
date	2004.10.03.21.28.34;	author jcs;	state Exp;
branches;
next	1.108;

1.108
date	2004.06.03.18.13.13;	author grange;	state Exp;
branches;
next	1.107;

1.107
date	2004.05.30.08.11.26;	author grange;	state Exp;
branches;
next	1.106;

1.106
date	2004.02.10.01.31.21;	author millert;	state Exp;
branches;
next	1.105;

1.105
date	2003.11.03.03.35.40;	author tedu;	state Exp;
branches;
next	1.104;

1.104
date	2003.09.23.16.51.11;	author millert;	state Exp;
branches;
next	1.103;

1.103
date	2003.06.27.16.57.14;	author nate;	state Exp;
branches;
next	1.102;

1.102
date	2003.05.14.00.20.37;	author tedu;	state Exp;
branches;
next	1.101;

1.101
date	2002.12.05.02.49.55;	author kjc;	state Exp;
branches;
next	1.100;

1.100
date	2002.11.08.19.00.37;	author mickey;	state Exp;
branches;
next	1.99;

1.99
date	2002.07.10.22.21.30;	author mickey;	state Exp;
branches;
next	1.98;

1.98
date	2002.07.10.22.08.47;	author mickey;	state Exp;
branches;
next	1.97;

1.97
date	2002.07.10.21.53.26;	author mickey;	state Exp;
branches;
next	1.96;

1.96
date	2002.06.24.19.00.33;	author mickey;	state Exp;
branches;
next	1.95;

1.95
date	2002.06.19.02.52.23;	author mickey;	state Exp;
branches;
next	1.94;

1.94
date	2002.06.18.23.16.50;	author fgsch;	state Exp;
branches;
next	1.93;

1.93
date	2002.06.18.12.50.55;	author nate;	state Exp;
branches;
next	1.92;

1.92
date	2002.06.11.05.15.19;	author miod;	state Exp;
branches;
next	1.91;

1.91
date	2002.06.09.22.03.43;	author niklas;	state Exp;
branches;
next	1.90;

1.90
date	2002.05.16.21.11.14;	author miod;	state Exp;
branches;
next	1.89;

1.89
date	2002.05.16.16.16.52;	author provos;	state Exp;
branches;
next	1.88;

1.88
date	2002.03.14.01.26.32;	author millert;	state Exp;
branches;
next	1.87;

1.87
date	2002.01.23.04.48.02;	author ericj;	state Exp;
branches;
next	1.86;

1.86
date	2002.01.04.16.17.09;	author jason;	state Exp;
branches;
next	1.85;

1.85
date	2002.01.02.20.35.40;	author deraadt;	state Exp;
branches;
next	1.84;

1.84
date	2001.12.11.23.19.02;	author miod;	state Exp;
branches
	1.84.2.1;
next	1.83;

1.83
date	2001.12.05.23.58.41;	author tdeval;	state Exp;
branches;
next	1.82;

1.82
date	2001.11.06.23.46.05;	author drahn;	state Exp;
branches;
next	1.81;

1.81
date	2001.10.04.21.46.03;	author gluk;	state Exp;
branches;
next	1.80;

1.80
date	2001.09.28.02.53.13;	author mickey;	state Exp;
branches;
next	1.79;

1.79
date	2001.08.18.06.08.08;	author mickey;	state Exp;
branches;
next	1.78;

1.78
date	2001.08.06.22.34.43;	author mickey;	state Exp;
branches;
next	1.77;

1.77
date	2001.07.05.02.35.34;	author mickey;	state Exp;
branches;
next	1.76;

1.76
date	2001.07.03.22.49.05;	author niklas;	state Exp;
branches;
next	1.75;

1.75
date	2001.06.27.05.50.04;	author kjc;	state Exp;
branches;
next	1.74;

1.74
date	2001.06.25.03.19.59;	author kjell;	state Exp;
branches;
next	1.73;

1.73
date	2001.06.24.19.48.57;	author kjell;	state Exp;
branches;
next	1.72;

1.72
date	2001.06.23.03.47.16;	author mickey;	state Exp;
branches;
next	1.71;

1.71
date	2001.06.23.03.30.37;	author matthieu;	state Exp;
branches;
next	1.70;

1.70
date	2001.06.21.13.21.46;	author nate;	state Exp;
branches;
next	1.69;

1.69
date	2001.05.13.15.39.26;	author deraadt;	state Exp;
branches;
next	1.68;

1.68
date	2001.05.01.19.15.16;	author aaron;	state Exp;
branches;
next	1.67;

1.67
date	2001.03.14.06.18.47;	author millert;	state Exp;
branches;
next	1.66;

1.66
date	2001.03.05.22.16.42;	author millert;	state Exp;
branches;
next	1.65;

1.65
date	2001.02.25.23.24.18;	author aaron;	state Exp;
branches;
next	1.64;

1.64
date	2001.02.20.23.53.26;	author jbm;	state Exp;
branches;
next	1.63;

1.63
date	2001.01.30.00.00.31;	author aaron;	state Exp;
branches;
next	1.62;

1.62
date	2000.09.26.14.03.53;	author art;	state Exp;
branches;
next	1.61;

1.61
date	2000.07.06.21.51.57;	author fgsch;	state Exp;
branches;
next	1.60;

1.60
date	2000.04.15.17.36.29;	author jakob;	state Exp;
branches;
next	1.59;

1.59
date	2000.04.09.21.07.46;	author matthieu;	state Exp;
branches;
next	1.58;

1.58
date	2000.02.21.08.15.32;	author mjacob;	state Exp;
branches;
next	1.57;

1.57
date	99.08.13.05.38.05;	author fgsch;	state Exp;
branches
	1.57.4.1;
next	1.56;

1.56
date	99.08.08.01.51.43;	author niklas;	state Exp;
branches;
next	1.55;

1.55
date	99.07.30.19.13.48;	author deraadt;	state Exp;
branches;
next	1.54;

1.54
date	99.07.30.19.05.09;	author deraadt;	state Exp;
branches;
next	1.53;

1.53
date	99.07.18.22.40.53;	author csapuntz;	state Exp;
branches;
next	1.52;

1.52
date	99.04.28.23.20.59;	author alex;	state Exp;
branches;
next	1.51;

1.51
date	99.01.11.14.28.57;	author niklas;	state Exp;
branches;
next	1.50;

1.50
date	99.01.02.00.02.56;	author niklas;	state Exp;
branches;
next	1.49;

1.49
date	98.09.11.09.45.14;	author fgsch;	state Exp;
branches;
next	1.48;

1.48
date	98.08.31.05.16.53;	author art;	state Exp;
branches;
next	1.47;

1.47
date	98.08.24.05.29.55;	author millert;	state Exp;
branches;
next	1.46;

1.46
date	98.07.23.08.38.24;	author deraadt;	state Exp;
branches;
next	1.45;

1.45
date	98.07.07.06.56.03;	author deraadt;	state Exp;
branches;
next	1.44;

1.44
date	98.07.07.03.02.38;	author deraadt;	state Exp;
branches;
next	1.43;

1.43
date	98.04.01.20.16.41;	author matthieu;	state Exp;
branches;
next	1.42;

1.42
date	97.11.23.05.17.58;	author mickey;	state Exp;
branches;
next	1.41;

1.41
date	97.10.28.10.19.12;	author niklas;	state Exp;
branches;
next	1.40;

1.40
date	97.10.27.14.42.02;	author niklas;	state Exp;
branches;
next	1.39;

1.39
date	97.10.27.08.06.31;	author niklas;	state Exp;
branches;
next	1.38;

1.38
date	97.10.25.08.30.05;	author mickey;	state Exp;
branches;
next	1.37;

1.37
date	97.09.24.23.00.02;	author mickey;	state Exp;
branches;
next	1.36;

1.36
date	97.09.24.22.52.57;	author mickey;	state Exp;
branches;
next	1.35;

1.35
date	97.09.24.22.18.13;	author mickey;	state Exp;
branches;
next	1.34;

1.34
date	97.09.21.04.27.54;	author mickey;	state Exp;
branches;
next	1.33;

1.33
date	97.07.04.17.01.07;	author downsj;	state Exp;
branches;
next	1.32;

1.32
date	97.04.03.21.01.07;	author deraadt;	state Exp;
branches;
next	1.31;

1.31
date	97.02.06.10.02.54;	author deraadt;	state Exp;
branches;
next	1.30;

1.30
date	96.11.23.21.45.48;	author kstailey;	state Exp;
branches;
next	1.29;

1.29
date	96.11.11.20.47.24;	author kstailey;	state Exp;
branches;
next	1.28;

1.28
date	96.11.10.21.31.52;	author downsj;	state Exp;
branches;
next	1.27;

1.27
date	96.11.06.02.30.57;	author deraadt;	state Exp;
branches;
next	1.26;

1.26
date	96.11.06.01.35.25;	author deraadt;	state Exp;
branches;
next	1.25;

1.25
date	96.11.06.01.35.06;	author deraadt;	state Exp;
branches;
next	1.24;

1.24
date	96.10.19.13.26.08;	author mickey;	state Exp;
branches;
next	1.23;

1.23
date	96.09.01.20.55.20;	author downsj;	state Exp;
branches;
next	1.22;

1.22
date	96.08.29.09.26.04;	author deraadt;	state Exp;
branches;
next	1.21;

1.21
date	96.08.08.18.47.10;	author dm;	state Exp;
branches;
next	1.20;

1.20
date	96.07.28.05.07.05;	author downsj;	state Exp;
branches;
next	1.19;

1.19
date	96.07.15.14.57.02;	author mickey;	state Exp;
branches;
next	1.18;

1.18
date	96.07.15.07.35.13;	author mickey;	state Exp;
branches;
next	1.17;

1.17
date	96.07.06.23.59.36;	author downsj;	state Exp;
branches;
next	1.16;

1.16
date	96.06.08.09.12.39;	author downsj;	state Exp;
branches;
next	1.15;

1.15
date	96.05.07.07.21.31;	author deraadt;	state Exp;
branches;
next	1.14;

1.14
date	96.05.04.18.50.44;	author mickey;	state Exp;
branches;
next	1.13;

1.13
date	96.04.29.14.12.41;	author hvozda;	state Exp;
branches;
next	1.12;

1.12
date	96.04.21.22.16.23;	author deraadt;	state Exp;
branches;
next	1.11;

1.11
date	96.04.18.19.18.06;	author niklas;	state Exp;
branches;
next	1.10;

1.10
date	96.03.29.12.05.34;	author mickey;	state Exp;
branches;
next	1.9;

1.9
date	96.03.19.21.09.12;	author mickey;	state Exp;
branches;
next	1.8;

1.8
date	96.02.28.14.38.38;	author mickey;	state Exp;
branches;
next	1.7;

1.7
date	96.02.26.10.26.48;	author mickey;	state Exp;
branches;
next	1.6;

1.6
date	96.02.21.12.53.46;	author mickey;	state Exp;
branches;
next	1.5;

1.5
date	96.01.16.08.25.08;	author deraadt;	state Exp;
branches;
next	1.4;

1.4
date	96.01.15.01.55.05;	author hvozda;	state Exp;
branches;
next	1.3;

1.3
date	96.01.07.02.33.48;	author dm;	state Exp;
branches;
next	1.2;

1.2
date	95.12.14.06.05.20;	author deraadt;	state Exp;
branches;
next	1.1;

1.1
date	95.10.18.08.50.32;	author deraadt;	state Exp;
branches
	1.1.1.1;
next	;

1.1.1.1
date	95.10.18.08.50.32;	author deraadt;	state Exp;
branches;
next	;

1.57.4.1
date	2000.02.21.22.29.01;	author niklas;	state Exp;
branches;
next	1.57.4.2;

1.57.4.2
date	2001.04.18.16.07.13;	author niklas;	state Exp;
branches;
next	1.57.4.3;

1.57.4.3
date	2001.07.04.10.16.33;	author niklas;	state Exp;
branches;
next	1.57.4.4;

1.57.4.4
date	2001.10.31.03.01.12;	author nate;	state Exp;
branches;
next	1.57.4.5;

1.57.4.5
date	2001.11.13.21.00.51;	author niklas;	state Exp;
branches;
next	1.57.4.6;

1.57.4.6
date	2002.03.06.01.01.00;	author niklas;	state Exp;
branches;
next	1.57.4.7;

1.57.4.7
date	2002.03.28.10.31.04;	author niklas;	state Exp;
branches;
next	1.57.4.8;

1.57.4.8
date	2003.03.27.23.26.55;	author niklas;	state Exp;
branches;
next	1.57.4.9;

1.57.4.9
date	2003.05.16.00.29.39;	author niklas;	state Exp;
branches;
next	1.57.4.10;

1.57.4.10
date	2004.02.19.10.48.41;	author niklas;	state Exp;
branches;
next	1.57.4.11;

1.57.4.11
date	2004.06.05.23.08.59;	author niklas;	state Exp;
branches;
next	;

1.84.2.1
date	2002.01.31.22.55.11;	author niklas;	state Exp;
branches;
next	1.84.2.2;

1.84.2.2
date	2002.06.11.03.35.53;	author art;	state Exp;
branches;
next	1.84.2.3;

1.84.2.3
date	2002.10.29.00.28.03;	author art;	state Exp;
branches;
next	1.84.2.4;

1.84.2.4
date	2003.05.19.21.45.11;	author tedu;	state Exp;
branches;
next	;


desc
@@


1.158
log
@
vmm(4) for i386. Userland changes forthcoming. Note that for the time being,
i386 hosts are limited to running only i386 guests, even if the underlying
hardware supports amd64. This is a restriction I hope to lift moving forward,
but for now please don't report problems running amd64 guests on i386 hosts.

This was a straightforward port of the in-tree amd64 code plus the old rotted
tree I had from last year for i386 support. Changes included converting 64-bit
VMREAD/VMWRITE ops to 2x32-bit ops, and fixing treatment of the TSS, which
differs on i386.

ok deraadt@@
@
text
@/*	$OpenBSD: conf.c,v 1.157 2016/09/04 10:51:23 naddy Exp $	*/
/*	$NetBSD: conf.c,v 1.75 1996/05/03 19:40:20 christos Exp $	*/

/*
 * Copyright (c) 1994, 1995 Charles M. Hannum.  All rights reserved.
 *
 * Redistribution and use in source and binary forms, with or without
 * modification, are permitted provided that the following conditions
 * are met:
 * 1. Redistributions of source code must retain the above copyright
 *    notice, this list of conditions and the following disclaimer.
 * 2. Redistributions in binary form must reproduce the above copyright
 *    notice, this list of conditions and the following disclaimer in the
 *    documentation and/or other materials provided with the distribution.
 * 3. All advertising materials mentioning features or use of this software
 *    must display the following acknowledgement:
 *	This product includes software developed by Charles Hannum.
 * 4. The name of the author may not be used to endorse or promote products
 *    derived from this software without specific prior written permission.
 *
 * THIS SOFTWARE IS PROVIDED BY THE AUTHOR ``AS IS'' AND ANY EXPRESS OR
 * IMPLIED WARRANTIES, INCLUDING, BUT NOT LIMITED TO, THE IMPLIED WARRANTIES
 * OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE ARE DISCLAIMED.
 * IN NO EVENT SHALL THE AUTHOR BE LIABLE FOR ANY DIRECT, INDIRECT,
 * INCIDENTAL, SPECIAL, EXEMPLARY, OR CONSEQUENTIAL DAMAGES (INCLUDING, BUT
 * NOT LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES; LOSS OF USE,
 * DATA, OR PROFITS; OR BUSINESS INTERRUPTION) HOWEVER CAUSED AND ON ANY
 * THEORY OF LIABILITY, WHETHER IN CONTRACT, STRICT LIABILITY, OR TORT
 * (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE USE OF
 * THIS SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.
 */

#include <sys/param.h>
#include <sys/systm.h>
#include <sys/buf.h>
#include <sys/device.h>
#include <sys/disklabel.h>
#include <sys/ioctl.h>
#include <sys/tty.h>
#include <sys/vnode.h>

#include <machine/conf.h>

#include "wd.h"
bdev_decl(wd);
#include "fdc.h"
#include "fd.h"
bdev_decl(fd);
#include "sd.h"
#include "st.h"
#include "cd.h"
#include "uk.h"
#include "vnd.h"
#include "rd.h"

struct bdevsw	bdevsw[] =
{
	bdev_disk_init(NWD,wd),		/* 0: ST506/ESDI/IDE disk */
	bdev_swap_init(1,sw),		/* 1: swap pseudo-device */
	bdev_disk_init(NFD,fd),		/* 2: floppy diskette */
	bdev_notdef(),			/* 3 */
	bdev_disk_init(NSD,sd),		/* 4: SCSI disk */
	bdev_notdef(),			/* 5: was: SCSI tape */
	bdev_disk_init(NCD,cd),		/* 6: SCSI CD-ROM */
	bdev_notdef(),			/* 7 */
	bdev_notdef(),			/* 8 */
	bdev_notdef(),			/* 9 */
	bdev_notdef(),			/* 10 */
	bdev_notdef(),			/* 11 */
	bdev_notdef(),			/* 12 */
	bdev_notdef(),			/* 13 */
	bdev_disk_init(NVND,vnd),	/* 14: vnode disk driver */
	bdev_notdef(),			/* 15 */
	bdev_notdef(),			/* 16: was: concatenated disk driver */
	bdev_disk_init(NRD,rd),		/* 17: ram disk driver */
	bdev_notdef(),			/* 18 */
	bdev_notdef(),			/* 19 was: RAIDframe disk driver */
};
int	nblkdev = nitems(bdevsw);

/* open, close, read, write, ioctl, tty, mmap */
#define cdev_pc_init(c,n) { \
	dev_init(c,n,open), dev_init(c,n,close), dev_init(c,n,read), \
	dev_init(c,n,write), dev_init(c,n,ioctl), dev_init(c,n,stop), \
	dev_init(c,n,tty), ttpoll, dev_init(c,n,mmap), D_TTY }

/* open, close, read, ioctl */
#define cdev_joy_init(c,n) { \
	dev_init(c,n,open), dev_init(c,n,close), dev_init(c,n,read), \
	(dev_type_write((*))) enodev, dev_init(c,n,ioctl), \
	(dev_type_stop((*))) enodev, 0, seltrue, \
	(dev_type_mmap((*))) enodev }

/* open, close, ioctl, poll -- XXX should be a generic device */
#define cdev_ocis_init(c,n) { \
        dev_init(c,n,open), dev_init(c,n,close), (dev_type_read((*))) enodev, \
        (dev_type_write((*))) enodev, dev_init(c,n,ioctl), \
        (dev_type_stop((*))) enodev, 0,  dev_init(c,n,poll), \
        (dev_type_mmap((*))) enodev, 0 }

/* open, close, read */
#define cdev_nvram_init(c,n) { \
	dev_init(c,n,open), dev_init(c,n,close), dev_init(c,n,read), \
	(dev_type_write((*))) enodev, (dev_type_ioctl((*))) enodev, \
	(dev_type_stop((*))) enodev, 0, seltrue, \
	(dev_type_mmap((*))) enodev, 0 }

/* open, close, ioctl */
#define cdev_vmm_init(c,n) { \
	dev_init(c,n,open), dev_init(c,n,close), \
	(dev_type_read((*))) enodev, \
	(dev_type_write((*))) enodev, \
	dev_init(c,n,ioctl), \
	(dev_type_stop((*))) enodev, 0, seltrue, \
	(dev_type_mmap((*))) enodev }

#define	mmread	mmrw
#define	mmwrite	mmrw
cdev_decl(mm);
cdev_decl(wd);
#include "bio.h"
#include "pty.h"
#include "com.h"
cdev_decl(com);
cdev_decl(fd);
#include "lpt.h"
cdev_decl(lpt);
#include "ch.h"
#include "bpfilter.h"
#if 0
#include "pcmcia.h"
cdev_decl(pcmcia);
#endif
#include "spkr.h"
cdev_decl(spkr);
#if 0 /* old (non-wsmouse) drivers */
#include "mms.h"
cdev_decl(mms);
#include "lms.h"
cdev_decl(lms);
#include "opms.h"
cdev_decl(pms);
#endif
#include "cy.h"
cdev_decl(cy);
#include "tun.h"
#include "audio.h"
#include "video.h"
#include "midi.h"
#include "joy.h"
#include "pctr.h"
#include "bios.h"
#include "bktr.h"
#include "ksyms.h"
#include "usb.h"
#include "uhid.h"
#include "ugen.h"
#include "ulpt.h"
#include "ucom.h"
#include "cz.h"
cdev_decl(cztty);
#include "radio.h"
#include "gpr.h"
#include "nvram.h"
cdev_decl(nvram);
#include "drm.h"
cdev_decl(drm);

#include "wsdisplay.h"
#include "wskbd.h"
#include "wsmouse.h"
#include "wsmux.h"

#ifdef USER_PCICONF
#include "pci.h"
cdev_decl(pci);
#endif

#include "pf.h"
#include "hotplug.h"
#include "gpio.h"
#include "amdmsr.h"
#include "vscsi.h"
#include "pppx.h"
#include "fuse.h"
#include "pvbus.h"
#include "ipmi.h"
#include "switch.h"
#include "vmm.h"
cdev_decl(vmm);

struct cdevsw	cdevsw[] =
{
	cdev_cn_init(1,cn),		/* 0: virtual console */
	cdev_ctty_init(1,ctty),		/* 1: controlling terminal */
	cdev_mm_init(1,mm),		/* 2: /dev/{null,mem,kmem,...} */
	cdev_disk_init(NWD,wd),		/* 3: ST506/ESDI/IDE disk */
	cdev_notdef(),			/* 4 was /dev/drum */
	cdev_tty_init(NPTY,pts),	/* 5: pseudo-tty slave */
	cdev_ptc_init(NPTY,ptc),	/* 6: pseudo-tty master */
	cdev_log_init(1,log),		/* 7: /dev/klog */
	cdev_tty_init(NCOM,com),	/* 8: serial port */
	cdev_disk_init(NFD,fd),		/* 9: floppy disk */
	cdev_vmm_init(NVMM,vmm),	/* 10: vmm */
	cdev_notdef(),			/* 11 */
	cdev_wsdisplay_init(NWSDISPLAY,	/* 12: frame buffers, etc. */
	    wsdisplay),
	cdev_disk_init(NSD,sd),		/* 13: SCSI disk */
	cdev_tape_init(NST,st),		/* 14: SCSI tape */
	cdev_disk_init(NCD,cd),		/* 15: SCSI CD-ROM */
	cdev_lpt_init(NLPT,lpt),	/* 16: parallel printer */
	cdev_ch_init(NCH,ch),		/* 17: SCSI autochanger */
	cdev_notdef(),			/* 18: was: concatenated disk driver */
	cdev_notdef(),			/* 19 */
	cdev_uk_init(NUK,uk),		/* 20: unknown SCSI */
	cdev_acpiapm_init(1,acpiapm),	/* 21: Power Management stuff */
	cdev_fd_init(1,filedesc),	/* 22: file descriptor pseudo-device */
	cdev_bpf_init(NBPFILTER,bpf),	/* 23: Berkeley packet filter */
	cdev_notdef(),			/* 24 */
#if 0
	cdev_ocis_init(NPCMCIA,pcmcia), /* 25: PCMCIA Bus */
#else
	cdev_notdef(),			/* 25 */
#endif
	cdev_joy_init(NJOY,joy),        /* 26: joystick */
	cdev_spkr_init(NSPKR,spkr),	/* 27: PC speaker */
	cdev_notdef(),			/* 28: was LKM */
	cdev_notdef(),			/* 29 */
	cdev_notdef(),			/* 30 */
	cdev_notdef(),			/* 31 */
	cdev_notdef(),			/* 32 */
	cdev_notdef(),			/* 33 */
	cdev_notdef(),			/* 34 */
	cdev_notdef(),			/* 35: Microsoft mouse */
	cdev_notdef(),			/* 36: Logitech mouse */
	cdev_notdef(),			/* 37: Extended PS/2 mouse */
	cdev_tty_init(NCY,cy),		/* 38: Cyclom serial port */
	cdev_notdef(),			/* 39: Mitsumi CD-ROM */
	cdev_tun_init(NTUN,tun),	/* 40: network tunnel */
	cdev_disk_init(NVND,vnd),	/* 41: vnode disk driver */
	cdev_audio_init(NAUDIO,audio),	/* 42: generic audio I/O */
	cdev_notdef(),			/* 43 */
	cdev_video_init(NVIDEO,video),	/* 44: generic video I/O */
	cdev_random_init(1,random),	/* 45: random data source */
	cdev_ocis_init(NPCTR,pctr),	/* 46: pentium performance counters */
	cdev_disk_init(NRD,rd),		/* 47: ram disk driver */
	cdev_ocis_init(NBIOS,bios),	/* 48: onboard BIOS PROM */
	cdev_bktr_init(NBKTR,bktr),     /* 49: Bt848 video capture device */
	cdev_ksyms_init(NKSYMS,ksyms),	/* 50: Kernel symbols device */
	cdev_notdef(),			/* 51 */
	cdev_midi_init(NMIDI,midi),	/* 52: MIDI I/O */
	cdev_notdef(),			/* 53 was: sequencer I/O */
	cdev_notdef(),			/* 54 was: RAIDframe disk driver */
	cdev_notdef(),			/* 55: */
	/* The following slots are reserved for isdn4bsd. */
	cdev_notdef(),			/* 56: i4b main device */
	cdev_notdef(),			/* 57: i4b control device */
	cdev_notdef(),			/* 58: i4b raw b-channel access */
	cdev_notdef(),			/* 59: i4b trace device */
	cdev_notdef(),			/* 60: i4b phone device */
	/* End of reserved slots for isdn4bsd. */
	cdev_usb_init(NUSB,usb),	/* 61: USB controller */
	cdev_usbdev_init(NUHID,uhid),	/* 62: USB generic HID */
	cdev_usbdev_init(NUGEN,ugen),	/* 63: USB generic driver */
	cdev_ulpt_init(NULPT,ulpt), 	/* 64: USB printers */
	cdev_notdef(),			/* 65: was urio */
	cdev_tty_init(NUCOM,ucom),	/* 66: USB tty */
	cdev_mouse_init(NWSKBD, wskbd),	/* 67: keyboards */
	cdev_mouse_init(NWSMOUSE,	/* 68: mice */
	    wsmouse),
	cdev_mouse_init(NWSMUX, wsmux),	/* 69: ws multiplexor */
	cdev_notdef(),			/* 70: was: /dev/crypto */
	cdev_tty_init(NCZ,cztty),	/* 71: Cyclades-Z serial port */
#ifdef USER_PCICONF
	cdev_pci_init(NPCI,pci),        /* 72: PCI user */
#else
	cdev_notdef(),
#endif
	cdev_pf_init(NPF,pf),		/* 73: packet filter */
	cdev_notdef(),			/* 74: ALTQ (deprecated) */
	cdev_notdef(),
	cdev_radio_init(NRADIO, radio), /* 76: generic radio I/O */
	cdev_notdef(),			/* 77: was USB scanners */
	cdev_notdef(),			/* 78: */
 	cdev_bio_init(NBIO,bio),	/* 79: ioctl tunnel */
	cdev_ch_init(NGPR,gpr),		/* 80: GPR400 SmartCard reader */
	cdev_ptm_init(NPTY,ptm),	/* 81: pseudo-tty ptm device */
	cdev_hotplug_init(NHOTPLUG,hotplug), /* 82: devices hot plugging */
	cdev_gpio_init(NGPIO,gpio),	/* 83: GPIO interface */
	cdev_nvram_init(NNVRAM,nvram),	/* 84: NVRAM interface */
	cdev_notdef(),			/* 85: ACPI (deprecated) */
	cdev_notdef(),
	cdev_notdef(),			/* 87 */
	cdev_drm_init(NDRM,drm),	/* 88: drm */
	cdev_amdmsr_init(NAMDMSR,amdmsr),	/* 89: amdmsr */
	cdev_vscsi_init(NVSCSI,vscsi),	/* 90: vscsi */
	cdev_disk_init(1,diskmap),	/* 91: disk mapper */
	cdev_pppx_init(NPPPX,pppx),     /* 92: pppx */
	cdev_fuse_init(NFUSE,fuse),	/* 93: fuse */ 
	cdev_tun_init(NTUN,tap),	/* 94: Ethernet network tunnel */
	cdev_pvbus_init(NPVBUS,pvbus),	/* 95: pvbus(4) control interface */
	cdev_ipmi_init(NIPMI,ipmi),	/* 96: ipmi */
	cdev_switch_init(NSWITCH,switch), /* 97: switch(4) control interface */
};
int	nchrdev = nitems(cdevsw);

int	mem_no = 2; 	/* major device number of memory special file */

/*
 * Swapdev is a fake device implemented
 * in sw.c used only internally to get to swstrategy.
 * It cannot be provided to the users, because the
 * swstrategy routine munches the b_dev and b_blkno entries
 * before calling the appropriate driver.  This would horribly
 * confuse, e.g. the hashing routines. Instead, /dev/drum is
 * provided as a character (raw) device.
 */
dev_t	swapdev = makedev(1, 0);

/*
 * Returns true if dev is /dev/mem or /dev/kmem.
 */
int
iskmemdev(dev_t dev)
{
	return (major(dev) == mem_no && (minor(dev) < 2 || minor(dev) == 14));
}

/*
 * Returns true if dev is /dev/zero.
 */
int
iszerodev(dev_t dev)
{
	return (major(dev) == mem_no && minor(dev) == 12);
}

dev_t
getnulldev(void)
{
	return makedev(mem_no, 2);
}

int chrtoblktbl[] = {
	/*VCHR*/	/*VBLK*/
	/*  0 */	NODEV,
	/*  1 */	NODEV,
	/*  2 */	NODEV,
	/*  3 */	0,		/* wd */
	/*  4 */	NODEV,
	/*  5 */	NODEV,
	/*  6 */	NODEV,
	/*  7 */	NODEV,
	/*  8 */	NODEV,
	/*  9 */	2,		/* fd */
	/* 10 */	3,
	/* 11 */	NODEV,
	/* 12 */	NODEV,
	/* 13 */	4,		/* sd */
	/* 14 */	NODEV,
	/* 15 */	6,		/* cd */
	/* 16 */	NODEV,
	/* 17 */	NODEV,
	/* 18 */	NODEV,
	/* 19 */	NODEV,
	/* 20 */	NODEV,
	/* 21 */	NODEV,
	/* 22 */	NODEV,
	/* 23 */	NODEV,
	/* 24 */	NODEV,
	/* 25 */	NODEV,
	/* 26 */	NODEV,
	/* 27 */	NODEV,
	/* 28 */	NODEV,
	/* 29 */	NODEV,
	/* 30 */	NODEV,
	/* 31 */	NODEV,
	/* 32 */	NODEV,
	/* 33 */	NODEV,
	/* 34 */	NODEV,
	/* 35 */	NODEV,
	/* 36 */	NODEV,
	/* 37 */	NODEV,
	/* 38 */	NODEV,
	/* 39 */	NODEV,
	/* 40 */	NODEV,
	/* 41 */	14,		/* vnd */
	/* 42 */	NODEV,
	/* 43 */	NODEV,
	/* 44 */	NODEV,
	/* 45 */	NODEV,
	/* 46 */	NODEV,
	/* 47 */	17,		/* rd */
};
int nchrtoblktbl = nitems(chrtoblktbl);

/*
 * In order to map BSD bdev numbers of disks to their BIOS equivalents
 * we use several heuristics, one being using checksums of the first
 * few blocks of a disk to get a signature we can match with /boot's
 * computed signatures.  To know where from to read, we must provide a
 * disk driver name -> bdev major number table, which follows.
 * Note: floppies are not included as those are differentiated by the BIOS.
 */
int findblkmajor(struct device *dv);
dev_t dev_rawpart(struct device *);	/* XXX */

dev_t
dev_rawpart(struct device *dv)
{
	int majdev;

	majdev = findblkmajor(dv);

	switch (majdev) {
	/* add here any device you want to be checksummed on boot */
	case 0:		/* wd */
	case 4:		/* sd */
		return (MAKEDISKDEV(majdev, dv->dv_unit, RAW_PART));
		break;
	default:
		;
	}

	return (NODEV);
}

/*
 * This entire table could be autoconfig()ed but that would mean that
 * the kernel's idea of the console would be out of sync with that of
 * the standalone boot.  I think it best that they both use the same
 * known algorithm unless we see a pressing need otherwise.
 */
#include <dev/cons.h>

cons_decl(com);
cons_decl(ws);

struct	consdev constab[] = {
#if NWSDISPLAY > 0
	cons_init(ws),
#endif
#if NCOM
	cons_init(com),
#endif
	{ 0 },
};
@


1.157
log
@Remove support for tape block devices. Nobody mount(8)s tapes any longer.
ok deraadt@@ guenther@@
@
text
@d1 1
a1 1
/*	$OpenBSD: conf.c,v 1.156 2016/09/02 17:06:12 goda Exp $	*/
d108 8
d189 2
d204 1
a204 1
	cdev_notdef(),			/* 10 */
@


1.156
log
@Add switch(4) cdev entry

ok deraadt@@ yasuoka@@ reyk@@
@
text
@d1 1
a1 1
/*	$OpenBSD: conf.c,v 1.155 2016/04/25 20:09:14 tedu Exp $	*/
d63 1
a63 1
	bdev_tape_init(NST,st),		/* 5: SCSI tape */
d350 1
a350 1
	/* 14 */	5,		/* st */
@


1.155
log
@remove systrace
@
text
@d1 1
a1 1
/*	$OpenBSD: conf.c,v 1.154 2016/02/26 09:10:04 natano Exp $	*/
d180 1
d293 1
@


1.154
log
@Remove stale RAIDframe entries from chrtoblktbl.

While there truncate the tables to the minimum required size; chrtoblk()
and blktochr() are designed to handle a table shorter than cdevsw.

"Looks good to me" deraadt@@
@
text
@d1 1
a1 1
/*	$OpenBSD: conf.c,v 1.153 2016/02/05 06:29:01 uebayasi Exp $	*/
a112 1
#include "systrace.h"
d273 1
a273 1
	cdev_systrace_init(NSYSTRACE,systrace),	/* 78: system call tracing */
@


1.153
log
@Implement FreeBSD-compatible IOCTL to access BMC in ipmi(4)

Initial help & testing by jmatthew@@
Code review & input by mpi@@
Final review & OK by jsg@@
@
text
@d1 1
a1 1
/*	$OpenBSD: conf.c,v 1.152 2016/01/27 09:04:19 reyk Exp $	*/
a382 7
	/* 48 */	NODEV,
	/* 49 */	NODEV,
	/* 50 */	NODEV,
	/* 51 */	NODEV,
	/* 52 */	NODEV,
	/* 53 */	NODEV,
	/* 54 */	19,		/* raid */
@


1.152
log
@Add a key-value interface to pvbus(4) that allows to get or set values
in the underlying information store of the host from the OpenBSD-VM's
userspace.  OpenBSD did not provide access to these stores before,
mostly because we did not want to add a custom tool and interface for
each hypervisor.  The pvbus(4) interface provides backends for
xen(4)'s XenStore and vmt(4)'s VMware Tools "guestinfo".  These
information stores are fairly different, XenStore is a "filesystem"
while vmt is a RPC, and the key-value abstraction limits them a bit
but provides the most wanted functionality.

Discussed with many
OK mikeb@@
@
text
@d1 1
a1 1
/*	$OpenBSD: conf.c,v 1.151 2015/10/23 15:10:52 claudio Exp $	*/
d180 1
d292 1
@


1.151
log
@Allocate a new major for tap(4) also note that pseudo-device tun is for tap
as well. OK dlg@@ mpi@@
@
text
@d1 1
a1 1
/*	$OpenBSD: conf.c,v 1.150 2014/12/11 19:44:17 tedu Exp $	*/
d179 1
d290 1
@


1.150
log
@dragonflybsd has added a urio driver. conservation of urios requires
that we delete ours, which isn't actually useful.
ok mpi sthen
@
text
@d1 1
a1 1
/*	$OpenBSD: conf.c,v 1.149 2014/10/09 04:10:03 tedu Exp $	*/
d288 1
@


1.149
log
@mechanical translation of dev_lkm_dummy() to dev_notdef()
@
text
@d1 1
a1 1
/*	$OpenBSD: conf.c,v 1.148 2014/10/09 03:59:59 tedu Exp $	*/
a151 1
#include "urio.h"
d254 1
a254 1
	cdev_urio_init(NURIO,urio),	/* 65: USB Diamond Rio 500 */
@


1.148
log
@remove LKM devices
@
text
@d1 1
a1 1
/*	$OpenBSD: conf.c,v 1.147 2014/08/20 06:14:42 mikeb Exp $	*/
d66 6
a71 6
	bdev_lkm_dummy(),		/* 8 */
	bdev_lkm_dummy(),		/* 9 */
	bdev_lkm_dummy(),		/* 10 */
	bdev_lkm_dummy(),		/* 11 */
	bdev_lkm_dummy(),		/* 12 */
	bdev_lkm_dummy(),		/* 13 */
d217 6
a222 6
	cdev_lkm_dummy(),		/* 29 */
	cdev_lkm_dummy(),		/* 30 */
	cdev_lkm_dummy(),		/* 31 */
	cdev_lkm_dummy(),		/* 32 */
	cdev_lkm_dummy(),		/* 33 */
	cdev_lkm_dummy(),		/* 34 */
@


1.147
log
@unlink crypto(4) pseudo device from the architecture dependant character
device tables and kernel config files.  ok deraadt
@
text
@d1 1
a1 1
/*	$OpenBSD: conf.c,v 1.146 2014/03/14 23:42:40 kettenis Exp $	*/
d216 1
a216 1
	cdev_lkm_init(NLKM,lkm),	/* 28: loadable module driver */
a329 1
	/* XXXX This needs to be dynamic for LKMs. */
@


1.146
log
@Remove the userland AGP interface.  Now that we have KMS, it is no longer
used by any of the remaining xenocara drivers.  Except perhaps for the
legacy i810 support in the xf86-video-intel driver.  But i810 support has
almost certainly been broken for more than a year now, and any remaining
users are probably better off using the xf86-video-vesa driver ever since
XAA support was removed from the X server.

ok deraadt@@, jsg@@, mpi@@
@
text
@d1 1
a1 1
/*	$OpenBSD: conf.c,v 1.145 2013/11/04 14:11:29 deraadt Exp $	*/
a43 2
#include "inet.h"

d261 1
a261 1
	cdev_crypto_init(NCRYPTO,crypto), /* 70: /dev/crypto */
@


1.145
log
@remove iop(4) driver.  it is entirely unmaintained and supports something
which basically doesn't exist at all.
reminded about it by brad
@
text
@d1 1
a1 1
/*	$OpenBSD: conf.c,v 1.144 2013/08/20 14:27:28 ajacoutot Exp $	*/
a161 2
#include "agp.h"
cdev_decl(agp);
d284 1
a284 1
	cdev_agp_init(NAGP,agp),	/* 87: agp */
@


1.144
log
@Remove uscanner(4). It was disabled in GENERIC more than 2.5 years ago.
No regression has been reported since libusb became the prefered
solution to work with USB scanners.

req. by mpi@@
ok ian@@ mpi@@ miod@@
@
text
@d1 1
a1 1
/*	$OpenBSD: conf.c,v 1.143 2013/06/03 15:54:47 tedu Exp $	*/
a145 1
#include "bthub.h"
a147 1
#include "iop.h"
d274 1
a274 1
	cdev_iop_init(NIOP,iop),	/* 75: I2O IOP control interface */
d285 1
a285 1
	cdev_bthub_init(NBTHUB,bthub),	/* 86: bthub */
@


1.143
log
@changes for isc fuse support. not enabled. ok beck deraadt.
from Sylvestre Gallon ccna.syl gmail.com
@
text
@d1 1
a1 1
/*	$OpenBSD: conf.c,v 1.142 2013/03/15 09:10:52 ratchov Exp $	*/
a157 1
#include "uscanner.h"
d278 1
a278 1
	cdev_usbdev_init(NUSCANNER,uscanner),	/* 77: USB scanners */
@


1.142
log
@Delete the sequencer(4) driver, since its not used any longer. Diff
mostly from armani.
ok miod, mpi, jsg and help from sthen
@
text
@d1 1
a1 1
/*	$OpenBSD: conf.c,v 1.141 2012/08/23 06:12:49 deraadt Exp $	*/
d186 1
d295 1
@


1.141
log
@kill nnpfs dead
@
text
@d1 1
a1 1
/*	$OpenBSD: conf.c,v 1.140 2012/04/06 15:10:39 jsing Exp $	*/
a144 2
#include "sequencer.h"
cdev_decl(music);
d247 1
a247 1
	cdev_midi_init(NSEQUENCER,sequencer),	/* 53: sequencer I/O */
@


1.140
log
@tedu the raidframe.

ok deraadt@@
@
text
@d1 1
a1 1
/*	$OpenBSD: conf.c,v 1.138 2011/07/04 22:53:53 tedu Exp $	*/
a151 4
#ifdef NNPFS
#include <nnpfs/nnnpfs.h>
cdev_decl(nnpfs_dev);
#endif
a246 3
#ifdef NNPFS
	cdev_nnpfs_init(NNNPFS,nnpfs_dev),	/* 51: nnpfs communication device */
#else
a247 1
#endif
@


1.139
log
@ccd goes to the attic
discussed with jsing and millert
@
text
@a55 1
#include "raid.h"
d79 1
a79 1
	bdev_disk_init(NRAID,raid),	/* 19: RAIDframe disk driver */
d258 1
a258 1
	cdev_disk_init(NRAID,raid),	/* 54: RAIDframe disk driver */
@


1.138
log
@remove compat_svr4 support.  ok deraadt
@
text
@d1 1
a1 1
/*	$OpenBSD: conf.c,v 1.137 2011/06/26 23:19:11 tedu Exp $	*/
a55 1
#include "ccd.h"
d77 1
a77 1
	bdev_disk_init(NCCD,ccd),	/* 16: concatenated disk driver */
d215 1
a215 1
	cdev_disk_init(NCCD,ccd),	/* 18: concatenated disk driver */
d366 1
a366 1
	/* 18 */	16,		/* ccd */
@


1.137
log
@kill mcd dead.  ok krw matthew millert thib
@
text
@d1 1
a1 1
/*	$OpenBSD: conf.c,v 1.136 2011/01/14 19:04:08 jasper Exp $	*/
a244 3
#ifdef COMPAT_SVR4
	cdev_svr4_net_init(1,svr4_net),	/* 43: svr4 net pseudo-device */
#else
a245 1
#endif
@


1.136
log
@- use nitems()

"doesn't hurt" deraadt@@
@
text
@d1 1
a1 1
/*	$OpenBSD: conf.c,v 1.135 2010/09/22 13:03:47 claudio Exp $	*/
a54 2
#include "mcd.h"
bdev_decl(mcd);
d69 1
a69 1
	bdev_disk_init(NMCD,mcd),	/* 7: Mitsumi CD-ROM */
a142 1
cdev_decl(mcd);
d241 1
a241 1
	cdev_disk_init(NMCD,mcd),	/* 39: Mitsumi CD-ROM */
d392 1
a392 1
	/* 39 */	7,		/* mcd */
@


1.135
log
@Add a new interface pppx(4) -- the ppp multiplexer to be used with npppd
and pipex. pppx(4) creates an interface whenever a session is created
so that altq and pf can work on these.
Started by dlg@@ debugged and made usable by myself
OK dlg@@ yasuoka@@ deraadt@@
@
text
@d1 1
a1 1
/*	$OpenBSD: conf.c,v 1.134 2010/07/03 03:59:16 krw Exp $	*/
d85 1
a85 1
int	nblkdev = sizeof(bdevsw) / sizeof(bdevsw[0]);
d314 1
a314 1
int	nchrdev = sizeof(cdevsw) / sizeof(cdevsw[0]);
d412 1
a412 1
int nchrtoblktbl = sizeof(chrtoblktbl) / sizeof(chrtoblktbl[0]);
@


1.134
log
@No more ss(4) or usscanner(4). Unused, unloved and unmaintained.
General huzzahs.

"go for it" deraadt@@
@
text
@d1 1
a1 1
/*	$OpenBSD: conf.c,v 1.133 2010/06/09 15:25:32 jsing Exp $	*/
d196 1
d312 1
@


1.133
log
@Wire up device nodes for disk mapper.

ok deraadt@@
@
text
@d1 1
a1 1
/*	$OpenBSD: conf.c,v 1.131 2009/06/03 14:45:51 jj Exp $	*/
a124 1
#include "ss.h"
d219 1
a219 1
	cdev_ss_init(NSS,ss),           /* 19: SCSI scanner */
@


1.132
log
@wire vscsi up to a cdev

for claudio@@ ok deraadt@@
@
text
@d311 1
@


1.131
log
@Arla client rename from xfs to nnpfs for later upgrades. Tested on various arches. ok todd@@ beck@@
@
text
@d1 1
a1 1
/*	$OpenBSD: conf.c,v 1.130 2009/01/25 17:30:48 miod Exp $	*/
d196 1
d309 2
a310 1
	cdev_amdmsr_init(NAMDMSR,amdmsr)	/* 89: amdmsr */
@


1.130
log
@Remove /dev/drum and related code.
@
text
@d1 1
a1 1
/*	$OpenBSD: conf.c,v 1.129 2008/11/23 18:19:02 deraadt Exp $	*/
d158 3
a160 3
#ifdef XFS
#include <xfs/nxfs.h>
cdev_decl(xfs_dev);
d259 2
a260 2
#ifdef XFS
	cdev_xfs_init(NXFS,xfs_dev),	/* 51: xfs communication device */
@


1.129
log
@no more need to cope with pccom
@
text
@d1 1
a1 1
/*	$OpenBSD: conf.c,v 1.128 2008/11/22 21:26:48 oga Exp $	*/
d203 1
a203 1
	cdev_swap_init(1,sw),		/* 4: /dev/drum (swap pseudo-device) */
@


1.128
log
@Move the drm drivers over from:

vga1 at pci0
inteldrm0 at vga1

to

vga1 at pci0
inteldrm0 at vga1
drm0 at inteldrm0

i.e. a similar scheme to audio(4) where the interface attaches on top of
the wildly different drivers. This helps to clean up the code a lot
(more is coming) and help me start to move drm to being essentially bus
independent, which will help in the future.
@
text
@d1 1
a1 1
/*	$OpenBSD: conf.c,v 1.127 2008/06/14 21:31:46 mbalmer Exp $	*/
a181 5
/* XXX -- this needs to be supported by config(8)! */
#if (NCOM > 0) && (NPCCOM > 0)
#error com and pccom are mutually exclusive.  Sorry.
#endif

a206 3
#if NPCCOM > 0
	cdev_tty_init(NPCCOM,com),	/* 8: serial port */
#else
a207 1
#endif
d456 1
a456 1
#if NCOM + NPCCOM > 0
@


1.127
log
@Add amdmsr(4), a driver to access model specific registers on AMD CPUs.
Needed for the upcoming AMD Geode LX graphics processor X11 driver.

discussed with, feedback, and ok matthieu and deraadt.
@
text
@d1 1
a1 1
/*	$OpenBSD: conf.c,v 1.126 2008/06/12 20:03:48 mglocker Exp $	*/
d179 1
a179 1
#include "drmbase.h"
d316 1
a316 1
	cdev_drm_init(NDRMBASE,drm),	/* 88: drm */
@


1.126
log
@Enable /dev/video* for all USB capable archs.  MAKEDEV bits will follow
shortly.

OK todd@@
@
text
@d1 1
a1 1
/*	$OpenBSD: conf.c,v 1.125 2008/05/21 18:49:47 kettenis Exp $	*/
d200 1
d316 2
a317 1
	cdev_drm_init(NDRMBASE,drm)	/* 88: drm */
@


1.125
log
@Switch i386 from pccom to com.  Welcomed by many.

ok dlg@@, jsing@@, deraadt@@
@
text
@d1 1
a1 1
/*	$OpenBSD: conf.c,v 1.124 2008/05/14 20:49:48 miod Exp $	*/
d149 1
d260 1
a260 1
	cdev_notdef(),			/* 44 */
@


1.124
log
@Fix more chrtoblktbl[] sloppyness, and add proper block st nodes to *ppc and
sgi.
@
text
@d1 1
a1 1
/*	$OpenBSD: conf.c,v 1.123 2008/04/08 14:31:54 claudio Exp $	*/
a122 1
#include "pccom.h"
@


1.123
log
@Split the cdev makro for bpftun into two seperate definitions. tun(4) and
bpf(4) are different enough so that the split makes sense -- this is necessary
to make bpf(4) cloneable.
requested deraadt@@, OK thib@@
@
text
@d1 1
a1 1
/*	$OpenBSD: conf.c,v 1.122 2007/11/28 23:37:34 oga Exp $	*/
d362 1
a362 1
	/*  3 */	0,
d368 1
a368 1
	/*  9 */	2,
d370 1
a370 1
	/* 11 */	15,
d372 3
a374 3
	/* 13 */	4,
	/* 14 */	5,
	/* 15 */	6,
d377 1
a377 1
	/* 18 */	16,
d383 1
a383 1
	/* 24 */	18,
d398 1
a398 1
	/* 39 */	7,
d400 1
a400 1
	/* 41 */	14,
d406 1
a406 1
	/* 47 */	17,
d413 1
a413 1
	/* 54 */	19,
@


1.122
log
@Initial import of the DRM (direct rendering manager).

This is the kernel part necessary for DRI support in X. Disabled for now
because it still has a few bugs, but now I can work on it in tree. Also
requires the requisite bits in X, which are currently under discussion
on how to deal with them with privsep. ported from a combination of the
free and netbsd implementations.

Known bugs:
1) only the first occurence of X in any session will have dri, after
that something prevents it working.
2) if the machine does not have a dri capable card, the kernel panics.
Something's up in one of the probe functions. I haven't been able to
find it though.
3) radeon cards need to be forced to use PCI mode otherwise they get
into an infinite loop.

This is known to at least kinda work with SiS, radeons in pci mode and
intel cards.

ok deraadt, kinda ok art, a few other people had a quick look.
@
text
@d1 1
a1 1
/*	$OpenBSD: conf.c,v 1.121 2007/11/25 17:11:12 oga Exp $	*/
d231 1
a231 1
	cdev_bpftun_init(NBPFILTER,bpf),/* 23: Berkeley packet filter */
d252 1
a252 1
	cdev_bpftun_init(NTUN,tun),	/* 40: network tunnel */
@


1.121
log
@Make agp attach as a device. This means that many more agp bridges
actually get detected and attached. Also adds a kernel api for
manipulating agp.

Enable this on i386 and amd64.

"I think you should commit it" deraadt@@, ok matthieu. Looked over by
several others.
@
text
@d1 1
a1 1
/*	$OpenBSD: conf.c,v 1.120 2007/11/25 15:42:15 tedu Exp $	*/
d179 2
d315 1
@


1.120
log
@fake out the apm device to switch between apm and acpi on i386.  now
a single device node will talk to the right kernel code automatically.
ok deraadt
@
text
@d1 1
a1 1
/*	$OpenBSD: conf.c,v 1.119 2007/09/18 18:13:06 mk Exp $	*/
d177 2
d312 1
@


1.119
log
@Fix typo (`Advancded').
@
text
@d1 1
a1 1
/*	$OpenBSD: conf.c,v 1.118 2007/07/23 13:30:21 mk Exp $	*/
a153 2
#include "acpi.h"
#include "apm.h"
d225 1
a225 1
	cdev_apm_init(NAPM,apm),	/* 21: Advanced Power Management */
d308 1
a308 1
	cdev_acpi_init(NACPI,acpi),	/* 85: ACPI */
@


1.118
log
@Add glue for a control device for bthub(4).  Will be used to configure
device inquiry/discovery parameters, pairings, and what else might be
needed.

From discussion with gwk.  MAKEDEV goo follows later.

ok and lots of input from miod.
@
text
@d1 1
a1 1
/*	$OpenBSD: conf.c,v 1.117 2007/05/29 19:03:35 krw Exp $	*/
d227 1
a227 1
	cdev_apm_init(NAPM,apm),	/* 21: Advancded Power Management */
@


1.117
log
@Die Die Die wt.
@
text
@d1 1
a1 1
/*	$OpenBSD: conf.c,v 1.116 2007/05/28 02:13:44 krw Exp $	*/
d156 1
d311 1
@


1.116
log
@Remove the Archive/Wangtek cartidge tape driver, wt(4). All tapes are
st(4).

ok tom@@ deraadt@@ jason@@
@
text
@d1 1
a1 1
/*	$OpenBSD: conf.c,v 1.115 2007/02/06 22:39:13 dlg Exp $	*/
a125 1
cdev_decl(wt);
@


1.115
log
@define the bio(4) cdev stuff in conf.h, rather than having a per machine
definition. switch amd64 and i386 to the conf.h version, and add it to
macppc.

original diff ok gwk@@ tweaks and ok miod@@
@
text
@d1 1
a1 1
/*	$OpenBSD: conf.c,v 1.114 2006/09/19 11:06:33 jsg Exp $	*/
a50 2
#include "wt.h"
bdev_decl(wt);
d67 1
a67 1
	bdev_tape_init(NWT,wt),		/* 3: QIC-02/QIC-36 tape */
d215 1
a215 1
	cdev_tape_init(NWT,wt),		/* 10: QIC-02/QIC-36 tape */
@


1.114
log
@ansi/deregister
@
text
@d1 1
a1 1
/*	$OpenBSD: conf.c,v 1.113 2006/06/11 10:56:39 mk Exp $	*/
a101 7
/* open, close, ioctl -- XXX should be a generic device */
#define cdev_oci_init(c,n) { \
        dev_init(c,n,open), dev_init(c,n,close), (dev_type_read((*))) enodev, \
        (dev_type_write((*))) enodev, dev_init(c,n,ioctl), \
        (dev_type_stop((*))) enodev, 0,  seltrue, \
        (dev_type_mmap((*))) enodev, 0 }

d306 1
a306 1
 	cdev_oci_init(NBIO,bio),	/* 79: ioctl tunnel */
@


1.113
log
@Get rid of the wdt(4) char device.  We have watchdog(4) and
watchdogd(4), so there's no point in supporting old, unused,
non-generic interfaces.

Tested by < jg , rilk - com>.

The sensors available on the WDT501 model will be supported later using
the sensors framework.

ok mickey markus
@
text
@d1 1
a1 1
/*	$OpenBSD: conf.c,v 1.112 2005/12/31 22:40:37 miod Exp $	*/
d340 1
a340 2
iskmemdev(dev)
	dev_t dev;
a341 1

d349 1
a349 2
iszerodev(dev)
	dev_t dev;
a350 1

d355 1
a355 1
getnulldev()
d433 1
a433 2
dev_rawpart(dv)
	struct device *dv;
@


1.112
log
@Kill a pcvt leftover.
@
text
@d1 1
a1 1
/*	$OpenBSD: conf.c,v 1.111 2005/07/31 06:39:07 dlg Exp $	*/
a115 6
/* open, close, read, ioctl */
#define	cdev_wdt_init(c, n) { \
	dev_init(c,n,open), dev_init(c,n,close), (dev_type_read((*))) enodev, \
	(dev_type_write((*))) enodev, dev_init(c,n,ioctl), \
	(dev_type_stop((*))) enodev, 0, seltrue, (dev_type_mmap((*))) enodev }

a173 2
#include "wdt.h"
cdev_decl(wdt);
d282 1
a282 1
	cdev_wdt_init(NWDT,wdt),	/* 55: WDT50x watchdog timer */
@


1.111
log
@remove the config glue between the /dev entry for ses and its driver

sure deraadt@@
@
text
@d1 1
a1 1
/*	$OpenBSD: conf.c,v 1.110 2005/06/02 20:09:39 tholo Exp $	*/
a472 1
cons_decl(pc);
@


1.110
log
@Start on a basic ACPI framework -- does not do much more than read out the
ACPI tables into kernel memory and attach ACPI and HPET timers currently.

In order to test this code, enabling the devices in GENERIC as well as
the ACPI_ENABLE option is needed.  This code does not do any thermal
control yet, so this should be done with care depending on the platform.

In the tree so more people can contribute to making this more fully
featured.

Ok niklas@@ grange@@ tedu@@
@
text
@d1 1
a1 1
/*	$OpenBSD: conf.c,v 1.109 2004/10/03 21:28:34 jcs Exp $	*/
a53 1
#include "ses.h"
d247 1
a247 1
	cdev_ses_init(NSES,ses),	/* 24: SES/SAF-TE SCSI */
@


1.109
log
@nvram driver for i386 through /dev/nvram
currently read-only

ok grange@@, marius@@
@
text
@d1 1
a1 1
/*	$OpenBSD: conf.c,v 1.108 2004/06/03 18:13:13 grange Exp $	*/
d171 1
d328 1
@


1.108
log
@Enable GPIO for i386 port.

ok deraadt@@
@
text
@d1 1
a1 1
/*	$OpenBSD: conf.c,v 1.107 2004/05/30 08:11:26 grange Exp $	*/
d123 7
d194 2
d326 1
@


1.107
log
@Devices hot plugging support.
The hotplug pseudo-device passes device attachment and detachment events
to userland.  When a device attaches or detaches, the corresponding event
is queued.  The events can then be obtained from the queue through the
read(2) call on the /dev/hotplug device file. Each event consists of
event type (attach/detach), device class (DV_*) and device name (sd1 e.g.).

We have hotplug pseudo-device on alpha, amd64, i386, macppc and sparc64.
Since it was tested only on i386 other archs has it commented out
in GENERIC until tested.

The idea liked peter@@ tedu@@ drahn@@ millert@@ marco@@ henning@@.
Ok deraadt@@.
@
text
@d1 1
a1 1
/*	$OpenBSD: conf.c,v 1.106 2004/02/10 01:31:21 millert Exp $	*/
d205 1
d316 1
@


1.106
log
@Add the ptm device to pty(4).  By opening /dev/ptm and using the PTMGET
ioctl(2), an unprivileged process may allocate a pty and have its owner
and mode set appropriately.  This means that programs such as xterm and
screen no longer need to be setuid.  Programs using the openpty()
function require zero changes and will "just work".

Designed by beck@@ and deraadt@@; changes by beck@@ with cleanup (and
a rewrite of the vnode bits) by art@@ and tweaks/bugfixes by me.
Tested by many.
@
text
@d1 1
a1 1
/*	$OpenBSD: conf.c,v 1.105 2003/11/03 03:35:40 tedu Exp $	*/
d204 1
d314 1
@


1.105
log
@remove support for non-existent scd and pcd drivers. ok deraadt millert
@
text
@d1 1
a1 1
/*	$OpenBSD: conf.c,v 1.104 2003/09/23 16:51:11 millert Exp $	*/
d311 2
a312 1
	cdev_ch_init(NGPR,gpr)		/* 80: GPR400 SmartCard reader */
@


1.104
log
@Replace select backends with poll backends.  selscan() and pollscan()
now call the poll backend.  With this change we implement greater
poll(2) functionality instead of emulating it via the select backend.
Adapted from NetBSD and including some changes from FreeBSD.
Tested by many, deraadt@@ OK
@
text
@d1 1
a1 1
/*	$OpenBSD: conf.c,v 1.103 2003/06/27 16:57:14 nate Exp $	*/
a60 2
#include "scd.h"
bdev_decl(scd);
d82 1
a82 1
	bdev_disk_init(NSCD,scd),	/* 15: Sony CD-ROM */
a135 1
cdev_decl(scd);
d222 1
a222 1
	cdev_disk_init(NSCD,scd),	/* 11: Sony CD-ROM */
@


1.103
log
@kqueue support for various usb devices including: usb, uhid, ugen,
and uscanner
From NetBSD
@
text
@d1 1
a1 1
/*	$OpenBSD: conf.c,v 1.102 2003/05/14 00:20:37 tedu Exp $	*/
d96 1
a96 1
	dev_init(c,n,tty), ttselect, dev_init(c,n,mmap), D_TTY }
d112 1
a112 1
/* open, close, ioctl, select -- XXX should be a generic device */
d116 1
a116 1
        (dev_type_stop((*))) enodev, 0,  dev_init(c,n,select), \
@


1.102
log
@add {b,c}devsw_lookup convenience functions.
move chrtoblk and blktochr into MI code.
tested on several archs and ok deraadt@@
@
text
@d1 1
a1 1
/*	$OpenBSD: conf.c,v 1.101 2002/12/05 02:49:55 kjc Exp $	*/
d294 1
a294 1
	cdev_usbdev_init(NURIO,urio),	/* 65: USB Diamond Rio 500 */
@


1.101
log
@remove altq entries.
altq is merged into pf and handled through pf.
@
text
@d1 1
a1 1
/*	$OpenBSD: conf.c,v 1.100 2002/11/08 19:00:37 mickey Exp $	*/
d359 1
a359 1
static int chrtoblktbl[] = {
d418 1
a418 36

/*
 * Convert a character device number to a block device number.
 */
dev_t
chrtoblk(dev)
	dev_t dev;
{
	int blkmaj;

	if (major(dev) >= nchrdev ||
	    major(dev) > sizeof(chrtoblktbl)/sizeof(chrtoblktbl[0]))
		return (NODEV);
	blkmaj = chrtoblktbl[major(dev)];
	if (blkmaj == NODEV)
		return (NODEV);
	return (makedev(blkmaj, minor(dev)));
}

/*
 * Convert a block device number to a character device number.
 */
dev_t
blktochr(dev)
	dev_t dev;
{
	int blkmaj = major(dev);
	int i;

	if (blkmaj >= nblkdev)
		return (NODEV);
	for (i = 0; i < sizeof(chrtoblktbl)/sizeof(chrtoblktbl[0]); i++)
		if (blkmaj == chrtoblktbl[i])
			return (makedev(i, minor(dev)));
	return (NODEV);
}
@


1.100
log
@prepare for bktr on macppc (commented out in generic for now); drahn@@ ok
@
text
@d1 1
a1 1
/*	$OpenBSD: conf.c,v 1.99 2002/07/10 22:21:30 mickey Exp $	*/
a207 2
#include <altq/altqconf.h>

d308 1
a308 1
	cdev_altq_init(NALTQ,altq),	/* 74: ALTQ control interface */
@


1.99
log
@proper cdev_decl(crypto) and no private protos
@
text
@d1 1
a1 1
/*	$OpenBSD: conf.c,v 1.98 2002/07/10 22:08:47 mickey Exp $	*/
a118 7
/* open, close, read, ioctl, mmap */
#define	cdev_bktr_init(c, n) { \
        dev_init(c,n,open), dev_init(c,n,close), dev_init(c,n,read), \
        (dev_type_write((*))) enodev, dev_init(c,n,ioctl), \
	(dev_type_stop((*))) enodev, 0, seltrue, \
        dev_init(c,n,mmap) }

a175 1
cdev_decl(bktr);
@


1.98
log
@proper cdev_decl(ksyms), fix ksyms's broken functions
@
text
@d1 1
a1 1
/*	$OpenBSD: conf.c,v 1.97 2002/07/10 21:53:26 mickey Exp $	*/
a136 1
cdev_decl(crypto);
@


1.97
log
@proper cdev_decl(gpr)
@
text
@d1 1
a1 1
/*	$OpenBSD: conf.c,v 1.96 2002/06/24 19:00:33 mickey Exp $	*/
a187 1
cdev_decl(ksyms);   
@


1.96
log
@move cdev_decl() for usb devices into one place.
usage of cdev_decl() in the driver code is more tricky since i have
kqueue mods here and there and will fix that on that way through.
@
text
@d1 1
a1 1
/*	$OpenBSD: conf.c,v 1.95 2002/06/19 02:52:23 mickey Exp $	*/
a198 1
cdev_decl(gpr);
@


1.95
log
@using cdev_ugen_init for all sorts of usb devices is just one pint less wrong than using cdev_decl_random for the same purpose
@
text
@d1 1
a1 1
/*	$OpenBSD: conf.c,v 1.94 2002/06/18 23:16:50 fgsch Exp $	*/
a189 1
cdev_decl(usb);
a190 1
cdev_decl(uhid);
a191 1
cdev_decl(ugen);
a192 1
cdev_decl(ulpt);
a193 1
cdev_decl(urio);
a194 1
cdev_decl(ucom);
a195 1
cdev_decl(uscanner);
@


1.94
log
@oops, forgot to commit this when gpr was added.
@
text
@d1 1
a1 1
/*	$OpenBSD: conf.c,v 1.93 2002/06/18 12:50:55 nate Exp $	*/
d312 1
a312 1
	cdev_ugen_init(NUGEN,ugen),	/* 63: USB generic driver */
d331 1
a331 1
	cdev_ugen_init(NUSCANNER,uscanner),	/* 77: USB scanners */
@


1.93
log
@Remove all traces of the PCCONS stuff.  (Remove pc.h and references to NPC
and NPCCONSKBD)
ok matthieu
@
text
@d1 1
a1 1
/*	$OpenBSD: conf.c,v 1.92 2002/06/11 05:15:19 miod Exp $	*/
d206 2
d334 1
@


1.92
log
@Move cdev_lpt_init() to a common location.
@
text
@d1 1
a1 1
/*	$OpenBSD: conf.c,v 1.91 2002/06/09 22:03:43 niklas Exp $	*/
a146 2
#include "pc.h"
cdev_decl(pc);
a243 3
#if NPC > 0
	cdev_pc_init(NPC,pc),		/* 12: PC console */
#else
a245 1
#endif
a518 3
#endif
#if NPC > 0
	cons_init(pc),
@


1.91
log
@bio is a driver that can delegate ioctls to other drivers which
otherwise do not deserve a /dev-node of their own.  Will be used for RAID
mgmt among other things.  Initially only i386 gets the device, but other
platforms will follow in a few hours.  MAKEDEV stuff coming soon too.
@
text
@d1 1
a1 1
/*	$OpenBSD: conf.c,v 1.90 2002/05/16 21:11:14 miod Exp $	*/
a96 6

/* open, close, write, ioctl */
#define	cdev_lpt_init(c,n) { \
	dev_init(c,n,open), dev_init(c,n,close), (dev_type_read((*))) enodev, \
	dev_init(c,n,write), dev_init(c,n,ioctl), (dev_type_stop((*))) enodev, \
	0, seltrue, (dev_type_mmap((*))) enodev }
@


1.90
log
@Add systrace support to all the remaining architectures.

Tested by various people on various platforms, I'm willing to fix any
breakage this causes.

ok niels@@ deraadt@@ and mickey@@ (after his comments were applied)
@
text
@d1 1
a1 1
/*	$OpenBSD: conf.c,v 1.89 2002/05/16 16:16:52 provos Exp $	*/
d145 1
d343 1
@


1.89
log
@systrace facility, used to enforce and generate policies for system calls
okay deraadt@@
@
text
@d1 1
a1 1
/*	$OpenBSD: conf.c,v 1.88 2002/03/14 01:26:32 millert Exp $	*/
a144 1
cdev_decl(systrace);
@


1.88
log
@First round of __P removal in sys
@
text
@d1 1
a1 1
/*	$OpenBSD: conf.c,v 1.87 2002/01/23 04:48:02 ericj Exp $	*/
d144 2
d342 1
@


1.87
log
@
move cdev_spkr_init() to conf.h for use by other arch's
@
text
@d1 1
a1 1
/*	$OpenBSD: conf.c,v 1.86 2002/01/04 16:17:09 jason Exp $	*/
d488 2
a489 2
int findblkmajor __P((struct device *dv));
dev_t dev_rawpart __P((struct device *));	/* XXX */
@


1.86
log
@correct comment: USB scanners aren't generic devices
@
text
@d1 1
a1 1
/*	$OpenBSD: conf.c,v 1.85 2002/01/02 20:35:40 deraadt Exp $	*/
a99 6
	dev_init(c,n,open), dev_init(c,n,close), (dev_type_read((*))) enodev, \
	dev_init(c,n,write), dev_init(c,n,ioctl), (dev_type_stop((*))) enodev, \
	0, seltrue, (dev_type_mmap((*))) enodev }

/* open, close, write, ioctl */
#define	cdev_spkr_init(c,n) { \
@


1.85
log
@at least ; required after label or case; openbsd@@davidkrause.com
@
text
@d1 1
a1 1
/*	$OpenBSD: conf.c,v 1.84 2001/12/11 23:19:02 miod Exp $	*/
d345 1
a345 1
	cdev_ugen_init(NUSCANNER,uscanner),	/* 77: USB generic driver */
@


1.84
log
@Remove declarations that already exist in <sys/conf.h>
@
text
@d1 1
a1 1
/*	$OpenBSD: conf.c,v 1.83 2001/12/05 23:58:41 tdeval Exp $	*/
d512 1
@


1.84.2.1
log
@Merge in -current, builds on i386, otherwise untested
@
text
@d1 1
a1 1
/*	$OpenBSD: conf.c,v 1.87 2002/01/23 04:48:02 ericj Exp $	*/
d104 6
d345 1
a345 1
	cdev_ugen_init(NUSCANNER,uscanner),	/* 77: USB scanners */
a511 1
		;
@


1.84.2.2
log
@Sync UBC branch to -current
@
text
@d1 1
a1 1
/*	$OpenBSD: conf.c,v 1.84.2.1 2002/01/31 22:55:11 niklas Exp $	*/
a143 1
#include "systrace.h"
a339 1
	cdev_systrace_init(NSYSTRACE,systrace),	/* 78: system call tracing */
d488 2
a489 2
int findblkmajor(struct device *dv);
dev_t dev_rawpart(struct device *);	/* XXX */
@


1.84.2.3
log
@sync to -current
@
text
@d1 1
a1 1
/*	$OpenBSD: conf.c,v 1.84.2.2 2002/06/11 03:35:53 art Exp $	*/
d98 6
d143 1
a144 1
#include "bio.h"
d152 2
d195 1
d197 1
d199 1
d201 1
d203 1
d205 1
d207 1
d209 1
a212 1
#include "gpr.h"
d251 3
d256 1
d321 1
a321 1
	cdev_usbdev_init(NUGEN,ugen),	/* 63: USB generic driver */
d340 1
a340 1
	cdev_usbdev_init(NUSCANNER,uscanner),	/* 77: USB scanners */
a341 2
 	cdev_oci_init(NBIO,bio),	/* 79: ioctl tunnel */
	cdev_ch_init(NGPR,gpr)		/* 80: GPR400 SmartCard reader */
d529 3
@


1.84.2.4
log
@sync
@
text
@d1 1
a1 1
/*	$OpenBSD$	*/
d119 7
d183 1
d216 2
d318 1
a318 1
	cdev_notdef(),			/* 74: ALTQ (deprecated) */
d369 1
a369 1
int chrtoblktbl[] = {
d428 36
a463 1
int nchrtoblktbl = sizeof(chrtoblktbl) / sizeof(chrtoblktbl[0]);
@


1.83
log
@Enable rootdev auto-configuration by device drivers during boot.
Add support for "raid" devices (prepare future raidframe changes).

OK deraadt@@, Reviewed by drahn@@, jason@@, mickey@@ and miod@@
@
text
@d1 1
a1 1
/*	$OpenBSD: conf.c,v 1.82 2001/11/06 23:46:05 drahn Exp $	*/
a65 2
bdev_decl(rd);
cdev_decl(rd);
a162 1
dev_decl(filedesc,open);
a182 1
cdev_decl(audio);
a183 1
cdev_decl(midi);
a185 1
cdev_decl(svr4_net);
a217 1
cdev_decl(radio);
a227 1
cdev_decl(wsmux);
@


1.82
log
@Add USB scanner device node to macppc and i386, both of these had the
uscanner compiled into the kernel, but no device node, or even entry
in the character device switch table.
ok todd@@
@
text
@d1 1
a1 1
/*	$OpenBSD: conf.c,v 1.81 2001/10/04 21:46:03 gluk Exp $	*/
d449 7
d502 1
a502 14
static struct {
	char *name;
	int maj;
} disk_maj[] = {
	{ "wd", 0 },
	{ "sd", 4 },
#if 0
	/* XXX It's not clear at all that recognizing these will help us */
	{ "cd", 6 },
	{ "mcd", 7 },		/* XXX I wonder if any BIOSes support this */
	{ "scd", 15 }		/* 	-	   "		-	   */
#endif
};

d509 12
a520 1
	int i;
a521 5
	for (i = 0; i < sizeof disk_maj / sizeof disk_maj[0]; i++)
		if (strcmp(dv->dv_cfdata->cf_driver->cd_name,
		    disk_maj[i].name) == 0)
			return (MAKEDISKDEV(disk_maj[i].maj, dv->dv_unit,
			    RAW_PART));
@


1.81
log
@radio hooks
@
text
@d1 1
a1 1
/*	$OpenBSD: conf.c,v 1.80 2001/09/28 02:53:13 mickey Exp $	*/
d219 2
d353 1
@


1.80
log
@move cdev_decl(pf) into it's proper place, kill cdev_decl(ipl) at the same time
@
text
@d1 1
a1 1
/*	$OpenBSD: conf.c,v 1.79 2001/08/18 06:08:08 mickey Exp $	*/
d221 2
d350 1
@


1.79
log
@make apm use kqueue for transferring events to luse listener.
apparently i thought i comitted this already before apmd.
tested by me, art@@ and jason@@ .
@
text
@d1 1
a1 1
/*	$OpenBSD: conf.c,v 1.78 2001/08/06 22:34:43 mickey Exp $	*/
a238 1
cdev_decl(pf);
@


1.78
log
@remove vm_conf.h; art@@ ok
@
text
@d1 1
a1 1
/*	$OpenBSD: conf.c,v 1.77 2001/07/05 02:35:34 mickey Exp $	*/
d275 1
a275 1
	cdev_ocis_init(NAPM,apm),	/* 21: Advancded Power Management */
@


1.77
log
@move cdev_decl(iop) into sys/conf.h
@
text
@d1 1
a1 1
/*	$OpenBSD: conf.c,v 1.76 2001/07/03 22:49:05 niklas Exp $	*/
a47 1
bdev_decl(sw);
a150 1
cdev_decl(sw);
@


1.76
log
@Add the I2O device
@
text
@d1 1
a1 1
/*	$OpenBSD: conf.c,v 1.75 2001/06/27 05:50:04 kjc Exp $	*/
d198 1
a222 2
#include "iop.h"
cdev_decl(iop);
d350 1
a350 1
	cdev_oci_init(NIOP,iop),	/* 75: I2O controller */
@


1.75
log
@ALTQ base modifications to the kernel.
 - ALTQ introduces a set of new queue macros that coexist with the
   traditional IF_XXX macros.
 - "struct ifaltq" replaces "struct ifqueue" in "struct ifnet".
 - assign cdev major 74 for i386 and 54 for alpha as ALTQ control interface.
@
text
@d1 1
a1 1
/*	$OpenBSD: conf.c,v 1.74 2001/06/25 03:19:59 kjell Exp $	*/
d120 7
d222 2
d351 1
@


1.74
log
@add pf device on all architectures.
fix my previously bogus MAKEDEVs.
If you used pf on a non-i386. the major device number has changed,
and you'll need to recreate /dev/pf
ok theo
@
text
@d1 1
a1 1
/*	$OpenBSD: conf.c,v 1.73 2001/06/24 19:48:57 kjell Exp $	*/
d235 2
d341 1
@


1.73
log
@Initial import of pf, an all-new ipf-compatable packet filter.
Insane amounts of work done my dhartmei. Great work!
@
text
@d1 1
a1 1
/*	$OpenBSD: conf.c,v 1.72 2001/06/23 03:47:16 mickey Exp $	*/
a215 6
#ifdef IPFILTER
#define NIPF 1
#else
#define NIPF 0
#endif

d298 1
a298 1
	cdev_gen_ipf(NIPF,ipl),         /* 44: ip filtering */
@


1.72
log
@fix comment
@
text
@d1 1
a1 1
/*	$OpenBSD: conf.c,v 1.71 2001/06/23 03:30:37 matthieu Exp $	*/
d238 3
d344 1
@


1.71
log
@PCI bus configuration userland access from FreeBSD.
Will be used by XFree86 on powerpc (works on i386 too, but its not currently
used).
@
text
@d1 1
a1 1
/*	$OpenBSD: conf.c,v 1.70 2001/06/21 13:21:46 nate Exp $	*/
d337 1
a337 1
	cdev_pci_init(NPCI,pci),        /* 71: PCI user */
@


1.70
log
@Add support for the Cyclades-Z multiport serial cards.
This has not been thoroughly tested yet, so it's not going into GENERIC now.
From NetBSD.
@
text
@d1 1
a1 1
/*	$OpenBSD: conf.c,v 1.69 2001/05/13 15:39:26 deraadt Exp $	*/
d233 5
d336 5
@


1.69
log
@initial cut at /dev/crypto support.  takes original mbuf "try, and discard
if we fail" semantics and extends to two varients of data movement: mbuf,
or an iovec style block.
@
text
@d1 1
a1 1
/*	$OpenBSD: conf.c,v 1.68 2001/05/01 19:15:16 aaron Exp $	*/
d213 2
d330 1
@


1.68
log
@Remove PCVT cruft.
@
text
@d1 1
a1 1
/*	$OpenBSD: conf.c,v 1.67 2001/03/14 06:18:47 millert Exp $	*/
d44 2
d146 1
d327 1
@


1.67
log
@Back out order change in conf.c and priority change in wscons_machdep.c
Add kludge to prevent wscons on i386 from stealing the console from
another source. wscons should really be fixed to not touch cn_tab...
@
text
@d1 1
a1 1
/*	$OpenBSD: conf.c,v 1.66 2001/03/05 22:16:42 millert Exp $	*/
a151 1
#include "vt.h"
a220 3
#if (NVT > 0) && (NPC > 0)
#error vt and pc are mutually exclusive.  Sorry.
#endif
d246 3
a248 3
#if 0
	cdev_pc_init(NPC + NVT,pc),	/* 12: PC console */
#endif
d251 1
d511 1
a511 1
#if NPC + NVT > 0
@


1.66
log
@Backs out changes to wsdisplay.c so alpha (and presumably others)
is happy again.  It also makes i386 serial console work by changing
the console priority in wscons_machdep.c from CN_INTERNAL to CN_NORMAL
and moves the com/pccom console attach routine for i386 to be the
first so it will be matched (consinit takes the first highest match).
@
text
@d1 1
a1 1
/*	$OpenBSD: conf.c,v 1.65 2001/02/25 23:24:18 aaron Exp $	*/
a510 3
#if NCOM + NPCCOM > 0
	cons_init(com),
#endif
d516 3
@


1.65
log
@Add wscons_machdep.c which is a constab-style wrapper driver for wscons on
i386. This fixes serial console. millert@@, mickey@@ ok
@
text
@d1 1
a1 1
/*	$OpenBSD: conf.c,v 1.64 2001/02/20 23:53:26 jbm Exp $	*/
d511 3
a518 3
#endif
#if NCOM + NPCCOM > 0
	cons_init(com),
@


1.64
log
@Import of wsmouse-compatible lms and mms drivers from NetBSD.
Remove creation of non-wsmouse device in MAKEDEV (/dev/lms{0,1}, /dev/mms{0,1}
/dev/psm0, /dev/pms0).
Remove cdevsw[] entries for the devices above, as new mouse protocols are only
accessible trough /dev/wsmouse. aaron@@ ok.
@
text
@d1 1
a1 1
/*	$OpenBSD: conf.c,v 1.63 2001/01/30 00:00:31 aaron Exp $	*/
d508 1
d511 3
@


1.63
log
@Support for the wscons machine-independent console driver on the i386. To
become default in a few moments once deraadt commits new kernel config files.

IMPORTANT NOTE: A few important pieces are still required to be worked out
over the next few days. Users (and developers) relying on X should probably
stay away from -current until further notice. This should not take long, but
here is your first heads up. If you decide to upgrade your kernel anyway,
be sure to update your /etc/ttys file to use vt100 instead of vt220. The
rest of the fallout from this should be minor.
@
text
@d1 1
a1 1
/*	$OpenBSD: conf.c,v 1.62 2000/09/26 14:03:53 art Exp $	*/
d166 1
d173 1
d281 3
a283 3
	cdev_mouse_init(NMMS,mms),	/* 35: Microsoft mouse */
	cdev_mouse_init(NLMS,lms),	/* 36: Logitech mouse */
	cdev_mousewr_init(NOPMS,pms),	/* 37: Extended PS/2 mouse */
@


1.62
log
@Implement getnulldev that returns the dev_t for "/dev/null".
@
text
@d1 1
a1 1
/*	$OpenBSD: conf.c,v 1.61 2000/07/06 21:51:57 fgsch Exp $	*/
d170 1
a170 1
#include "pms.h"
d224 5
d248 1
d250 3
d281 1
a281 1
	cdev_mousewr_init(NPMS,pms),    /* 37: Extended PS/2 mouse */
d321 4
@


1.61
log
@Add ucom to char. device list and change XX_UNITMASK's to match OpenBSD;
from dugsong@@
@
text
@d1 1
a1 1
/*	$OpenBSD: conf.c,v 1.60 2000/04/15 17:36:29 jakob Exp $	*/
d348 6
@


1.60
log
@urio(4) - Diamond Multimedia RIO 500 (from NetBSD)

This driver will eventually go away as it really should be implemented
using ugen(4) instead.
@
text
@d1 1
a1 1
/*	$OpenBSD: conf.c,v 1.59 2000/04/09 21:07:46 matthieu Exp $	*/
d207 2
d311 1
@


1.59
log
@fix ulpt major # allocation
@
text
@d1 1
a1 1
/*	$OpenBSD: conf.c,v 1.58 2000/02/21 08:15:32 mjacob Exp $	*/
d205 2
d308 1
@


1.58
log
@recycle unused char 24 to be SES device
@
text
@d1 1
a1 1
/*	$OpenBSD: conf.c,v 1.57 1999/08/13 05:38:05 fgsch Exp $	*/
d203 2
d305 1
@


1.57
log
@Add USB devices support.
@
text
@d1 1
a1 1
/*	$OpenBSD: conf.c,v 1.56 1999/08/08 01:51:43 niklas Exp $	*/
d53 1
d249 1
a249 1
	cdev_notdef(),			/* 24 */
@


1.57.4.1
log
@sync with -current
@
text
@d1 1
a1 1
/*	$OpenBSD: conf.c,v 1.58 2000/02/21 08:15:32 mjacob Exp $	*/
a52 1
#include "ses.h"
d248 1
a248 1
	cdev_ses_init(NSES,ses),	/* 24: SES/SAF-TE SCSI */
@


1.57.4.2
log
@Update the SMP branch to -current, this breaks the SMP branch though.
But it will be fixed soonish.  Note, nothing new has happened, this is just
a merge of the trunk into this branch.
@
text
@d1 1
a1 1
/*	$OpenBSD: conf.c,v 1.67 2001/03/14 06:18:47 millert Exp $	*/
a165 1
#if 0 /* old (non-wsmouse) drivers */
d170 1
a170 1
#include "opms.h"
a171 1
#endif
a202 6
#include "ulpt.h"
cdev_decl(ulpt);
#include "urio.h"
cdev_decl(urio);
#include "ucom.h"
cdev_decl(ucom);
a217 5
#include "wsdisplay.h"
#include "wskbd.h"
#include "wsmouse.h"
#include "wsmux.h"
cdev_decl(wsmux);
a236 1
#if 0
a237 3
#endif
	cdev_wsdisplay_init(NWSDISPLAY,	/* 12: frame buffers, etc. */
	    wsdisplay),
d264 3
a266 3
	cdev_notdef(),			/* 35: Microsoft mouse */
	cdev_notdef(),			/* 36: Logitech mouse */
	cdev_notdef(),			/* 37: Extended PS/2 mouse */
a302 7
	cdev_ulpt_init(NULPT,ulpt), 	/* 64: USB printers */
	cdev_usbdev_init(NURIO,urio),	/* 65: USB Diamond Rio 500 */
	cdev_tty_init(NUCOM,ucom),	/* 66: USB tty */
	cdev_mouse_init(NWSKBD, wskbd),	/* 67: keyboards */
	cdev_mouse_init(NWSMOUSE,	/* 68: mice */
	    wsmouse),
	cdev_mouse_init(NWSMUX, wsmux),	/* 69: ws multiplexor */
a340 6
dev_t
getnulldev()
{
	return makedev(mem_no, 2);
}

a477 1
cons_decl(ws);
a479 3
#if NWSDISPLAY > 0
	cons_init(ws),
#endif
@


1.57.4.3
log
@Merge in -current from two days ago in the SMP branch.
As usual with merges, they do not indicate progress, so do not hold
your breath for working SMP, and do not mail me and ask about the
state of it.  It has not changed.  There is work ongoing, but very, very
slowly.  The commit is done in parts as to not lock up the tree in too
big chunks at a time.
@
text
@d1 1
a1 1
/*	$OpenBSD: conf.c,v 1.57.4.2 2001/04/18 16:07:13 niklas Exp $	*/
a43 2
#include "inet.h"

a143 1
cdev_decl(crypto);
d152 1
d211 6
a216 2
#include "cz.h"
cdev_decl(cztty);
d222 3
a231 10
#ifdef USER_PCICONF
#include "pci.h"
cdev_decl(pci);
#endif

#include "pf.h"
cdev_decl(pf);

#include <altq/altqconf.h>

d250 3
a252 3
#if NPC > 0
	cdev_pc_init(NPC,pc),		/* 12: PC console */
#else
a254 1
#endif
d294 1
a294 1
	cdev_notdef(),			/* 44 */
a326 9
	cdev_crypto_init(NCRYPTO,crypto), /* 70: /dev/crypto */
	cdev_tty_init(NCZ,cztty),	/* 71: Cyclades-Z serial port */
#ifdef USER_PCICONF
	cdev_pci_init(NPCI,pci),        /* 72: PCI user */
#else
	cdev_notdef(),
#endif
	cdev_pf_init(NPF,pf),		/* 73: packet filter */
	cdev_altq_init(NALTQ,altq),	/* 74: ALTQ control interface */
d514 1
a514 1
#if NPC > 0
@


1.57.4.4
log
@Sync the SMP branch to something just after 3.0
@
text
@d1 1
a1 1
/*	$OpenBSD: conf.c,v 1.57.4.3 2001/07/04 10:16:33 niklas Exp $	*/
d48 1
a119 7
/* open, close, ioctl -- XXX should be a generic device */
#define cdev_oci_init(c,n) { \
        dev_init(c,n,open), dev_init(c,n,close), (dev_type_read((*))) enodev, \
        (dev_type_write((*))) enodev, dev_init(c,n,ioctl), \
        (dev_type_stop((*))) enodev, 0,  seltrue, \
        (dev_type_mmap((*))) enodev, 0 }

d145 1
a190 1
#include "iop.h"
a214 2
#include "radio.h"
cdev_decl(radio);
d233 1
d269 1
a269 1
	cdev_apm_init(NAPM,apm),	/* 21: Advancded Power Management */
a341 2
	cdev_iop_init(NIOP,iop),	/* 75: I2O IOP control interface */
	cdev_radio_init(NRADIO, radio), /* 76: generic radio I/O */
@


1.57.4.5
log
@Merge in -current
@
text
@d1 1
a1 1
/*	$OpenBSD$	*/
a218 2
#include "uscanner.h"
cdev_decl(uscanner);
a350 1
	cdev_ugen_init(NUSCANNER,uscanner),	/* 77: USB generic driver */
@


1.57.4.6
log
@Merge in trunk
@
text
@d66 2
d106 6
d165 1
d186 1
d188 1
d191 1
d224 1
d235 1
d353 1
a353 1
	cdev_ugen_init(NUSCANNER,uscanner),	/* 77: USB scanners */
a448 7
	/* 48 */	NODEV,
	/* 49 */	NODEV,
	/* 50 */	NODEV,
	/* 51 */	NODEV,
	/* 52 */	NODEV,
	/* 53 */	NODEV,
	/* 54 */	19,
d495 14
a508 1
int findblkmajor __P((struct device *dv));
d515 1
a515 13
	int majdev;

	majdev = findblkmajor(dv);

	switch (majdev) {
	/* add here any device you want to be checksummed on boot */
	case 0:		/* wd */
	case 4:		/* sd */
		return (MAKEDISKDEV(majdev, dv->dv_unit, RAW_PART));
		break;
	default:
		;
	}
d517 5
@


1.57.4.7
log
@Merge in -current from about a week ago
@
text
@d488 2
a489 2
int findblkmajor(struct device *dv);
dev_t dev_rawpart(struct device *);	/* XXX */
@


1.57.4.8
log
@Sync the SMP branch with 3.3
@
text
@d98 6
d125 7
d143 1
a143 2
#include "systrace.h"
#include "bio.h"
d151 2
d190 1
d194 1
d196 1
d198 1
d200 1
d202 1
d204 1
d206 1
d208 1
a211 1
#include "gpr.h"
d230 2
d250 3
d255 1
d320 1
a320 1
	cdev_usbdev_init(NUGEN,ugen),	/* 63: USB generic driver */
d336 1
a336 1
	cdev_notdef(),			/* 74: ALTQ (deprecated) */
d339 1
a339 4
	cdev_usbdev_init(NUSCANNER,uscanner),	/* 77: USB scanners */
	cdev_systrace_init(NSYSTRACE,systrace),	/* 78: system call tracing */
 	cdev_oci_init(NBIO,bio),	/* 79: ioctl tunnel */
	cdev_ch_init(NGPR,gpr)		/* 80: GPR400 SmartCard reader */
d527 3
@


1.57.4.9
log
@merge the trunk so we will get the genfs and locking fixes
@
text
@d359 1
a359 1
int chrtoblktbl[] = {
d418 36
a453 1
int nchrtoblktbl = sizeof(chrtoblktbl) / sizeof(chrtoblktbl[0]);
@


1.57.4.10
log
@Merge of current from two weeks agointo the SMP branch
@
text
@d61 2
d84 1
a84 1
	bdev_notdef(),			/* 15 */
d96 1
a96 1
	dev_init(c,n,tty), ttpoll, dev_init(c,n,mmap), D_TTY }
d112 1
a112 1
/* open, close, ioctl, poll -- XXX should be a generic device */
d116 1
a116 1
        (dev_type_stop((*))) enodev, 0,  dev_init(c,n,poll), \
d138 1
d225 1
a225 1
	cdev_notdef(),			/* 11 */
d294 1
a294 1
	cdev_urio_init(NURIO,urio),	/* 65: USB Diamond Rio 500 */
@


1.57.4.11
log
@Merge with the trunk
@
text
@a203 2
#include "hotplug.h"
#include "gpio.h"
d311 1
a311 4
	cdev_ch_init(NGPR,gpr),		/* 80: GPR400 SmartCard reader */
	cdev_ptm_init(NPTY,ptm),	/* 81: pseudo-tty ptm device */
	cdev_hotplug_init(NHOTPLUG,hotplug), /* 82: devices hot plugging */
	cdev_gpio_init(NGPIO,gpio),	/* 83: GPIO interface */
@


1.56
log
@reserve majors for isdn4bsd
@
text
@d1 1
a1 1
/*	$OpenBSD: conf.c,v 1.55 1999/07/30 19:13:48 deraadt Exp $	*/
d196 6
d299 3
@


1.55
log
@fix
@
text
@d1 1
a1 1
/*	$OpenBSD: conf.c,v 1.54 1999/07/30 19:05:09 deraadt Exp $	*/
d286 7
@


1.54
log
@acd goes away
@
text
@d1 1
a1 1
/*	$OpenBSD: conf.c,v 1.53 1999/07/18 22:40:53 csapuntz Exp $	*/
d87 1
a87 1
	bdev_notdef,			/* 18 */
@


1.53
log
@

Get rid of useless #include's of wdc.h
@
text
@d1 1
a1 1
/*	$OpenBSD: conf.c,v 1.52 1999/04/28 23:20:59 alex Exp $	*/
a55 2
#include "acd.h"
bdev_decl(acd);
d87 1
a87 1
	bdev_disk_init(NACD,acd),	/* 18: ATAPI CD-ROM */
a153 1
cdev_decl(acd);
d242 1
a242 1
	cdev_disk_init(NACD,acd),	/* 24: ATAPI CD-ROM */
a428 1
	{ "acd", 18 },
@


1.52
log
@Added wdt driver for the Industrial Computer Source PCI-WDT50x watchdog
timers.
@
text
@d1 1
a1 1
/*	$OpenBSD: conf.c,v 1.51 1999/01/11 14:28:57 niklas Exp $	*/
a43 1
#include "wdc.h"
@


1.51
log
@Import of CMU's RAIDframe via NetBSD.
@
text
@d1 1
a1 1
/*	$OpenBSD: conf.c,v 1.50 1999/01/02 00:02:56 niklas Exp $	*/
d134 6
d196 2
d289 1
@


1.50
log
@Midi & sequencer support from NetBSD, mostly by Lennart Augustsson
@
text
@d1 1
a1 1
/*	$OpenBSD: conf.c,v 1.49 1998/09/11 09:45:14 fgsch Exp $	*/
d65 1
d91 1
d280 1
@


1.49
log
@Comment the pcmcia cdev entry because the new framework
doesn't use devices (yet).
@
text
@d1 1
a1 1
/*	$OpenBSD: conf.c,v 1.48 1998/08/31 05:16:53 art Exp $	*/
d173 4
d276 2
@


1.48
log
@glue in xfs
@
text
@d1 1
a1 1
/*	$OpenBSD: conf.c,v 1.47 1998/08/24 05:29:55 millert Exp $	*/
d155 1
d158 1
d233 1
d235 3
@


1.47
log
@Add support for /dev/ksyms to arch-specific files
@
text
@d1 1
a1 1
/*	$OpenBSD: conf.c,v 1.46 1998/07/23 08:38:24 deraadt Exp $	*/
d176 4
d261 5
@


1.46
log
@brooktree driver, hacked by matthieu. This needs cleaning now that it is in the tree
@
text
@d178 2
d256 1
@


1.45
log
@oops, i did not handle nchrdev correctly
@
text
@d1 1
a1 1
/*	$OpenBSD: conf.c,v 1.44 1998/07/07 03:02:38 deraadt Exp $	*/
d125 8
d176 2
d253 1
@


1.44
log
@fix chrtoblk() so that it returne ENODEV for entries beyond the end of the table
@
text
@d1 1
a1 1
/*	$OpenBSD: conf.c,v 1.43 1998/04/01 20:16:41 matthieu Exp $	*/
d343 1
a343 1
	if (major(dev) >= MAXDEV ||
@


1.43
log
@PS/2 mouse is read/write
@
text
@d1 1
a1 1
/*	$OpenBSD: conf.c,v 1.42 1997/11/23 05:17:58 mickey Exp $	*/
a331 2
	/* 48 */	NODEV,
	/* 49 */	NODEV,
d343 2
a344 1
	if (major(dev) >= nchrdev)
@


1.42
log
@ok. add cdev_decl(ipl)
@
text
@d1 1
a1 1
/*	$OpenBSD: conf.c,v 1.41 1997/10/28 10:19:12 niklas Exp $	*/
d227 1
a227 1
	cdev_mouse_init(NPMS,pms),	/* 37: PS/2 mouse */
@


1.41
log
@Do not checksum CD devices
@
text
@d1 1
a1 1
/*	$OpenBSD: conf.c,v 1.40 1997/10/27 14:42:02 niklas Exp $	*/
a168 1
cdev_decl(ipl);
@


1.40
log
@Mandatory disk signature BIOS->BSD mapping enabled
@
text
@d1 1
a1 1
/*	$OpenBSD: conf.c,v 1.39 1997/10/27 08:06:31 niklas Exp $	*/
d386 2
d392 1
@


1.39
log
@Kernel side of disk signature based BIOS->BSD disk number mapping
(a.k.a checksumming).  This is a solution for the otherwise hard problem
of knowing what disk a certain BIOS geometry is for.  PC BIOSes does not
tell anything about where a certain disk is physically attached, and
the ordering of drives in the BIOS area is not deterministic.  for the
moment it is not enabled in any kernel config file, but that will come RSN.
@
text
@d1 1
a1 1
/*	$OpenBSD: conf.c,v 1.38 1997/10/25 08:30:05 mickey Exp $	*/
a43 1
#include "dkcsum.h"
a371 1
#if NDKCSUM > 0
a406 1
#endif
@


1.38
log
@fix comment
@
text
@d1 1
a1 1
/*	$OpenBSD: conf.c,v 1.37 1997/09/24 23:00:02 mickey Exp $	*/
d36 2
d41 1
d44 1
d372 38
@


1.37
log
@bios and pctr are both ocis w/ seltrue
@
text
@d1 1
a1 1
/*	$OpenBSD: conf.c,v 1.36 1997/09/24 22:52:57 mickey Exp $	*/
d352 1
a352 1
 * Convert a character device number to a block device number.
@


1.36
log
@bios device is ocis from now
@
text
@d1 1
a1 1
/*	$OpenBSD: conf.c,v 1.35 1997/09/24 22:18:13 mickey Exp $	*/
a163 1
cdev_decl(pctr);
d238 1
a238 1
	cdev_uk_init(NPCTR,pctr),	/* 46: pentium performance counters */
@


1.35
log
@cdev_decl(apm) in machine/conf.h
@
text
@d1 1
a1 1
/*	$OpenBSD: conf.c,v 1.34 1997/09/21 04:27:54 mickey Exp $	*/
d241 1
a241 1
	cdev_bios_init(NBIOS,bios),	/* 48: onboard BIOS PROM */
@


1.34
log
@support new boots
add to your config:
bios0 at mainbus0
apm0 at mainbus0	# (if you are using APM)
@
text
@d1 1
a1 1
/*	$OpenBSD: conf.c,v 1.33 1997/07/04 17:01:07 downsj Exp $	*/
a162 1
cdev_decl(apm);
@


1.33
log
@NWD for wd devices, include wd.h
@
text
@d1 1
a1 1
/*	$OpenBSD: conf.c,v 1.32 1997/04/03 21:01:07 deraadt Exp $	*/
a37 1
#include <sys/conf.h>
d39 1
a161 1
cdev_decl(joy);
d166 1
d242 1
@


1.32
log
@pretty
@
text
@d1 1
a1 1
/*	$OpenBSD: conf.c,v 1.31 1997/02/06 10:02:54 deraadt Exp $	*/
d42 1
d68 1
a68 1
	bdev_disk_init(NWDC,wd),	/* 0: ST506/ESDI/IDE disk */
d189 1
a189 1
	cdev_disk_init(NWDC,wd),	/* 3: ST506/ESDI/IDE disk */
@


1.31
log
@cdev for rd
@
text
@d1 1
a1 1
/*	$OpenBSD: conf.c,v 1.30 1996/11/23 21:45:48 kstailey Exp $	*/
d237 2
a238 2
	cdev_gen_ipf(NIPF,ipl),         /* 44 ip filtering */
	cdev_random_init(1,random),	/* 45 random data source */
@


1.30
log
@added const to second parameter of cfprint_t routines
@
text
@d1 1
a1 1
/*	$OpenBSD: conf.c,v 1.29 1996/11/11 20:47:24 kstailey Exp $	*/
d63 1
a63 1
/* no cdev for rd */
d240 1
d329 1
a329 1
	/* 47 */	NODEV,
@


1.29
log
@Updates for SCSI scanner and SCSI unknown devices.
Removed MI *dev_decl() stuff that is now in sys/conf.h
@
text
@d1 1
a1 1
/*	$OpenBSD: conf.c,v 1.28 1996/11/10 21:31:52 downsj Exp $	*/
a140 1
cdev_decl(ch);
@


1.28
log
@Move fd back.
@
text
@d1 1
a1 1
/*	$OpenBSD: conf.c,v 1.27 1996/11/06 02:30:57 deraadt Exp $	*/
a49 1
bdev_decl(sd);
a50 1
bdev_decl(st);
a51 1
bdev_decl(cd);
a52 1
cdev_decl(uk);
a57 1
bdev_decl(vnd);
a60 1
bdev_decl(ccd);
a120 2
cdev_decl(cn);
cdev_decl(ctty);
a126 7
#define	ptstty		ptytty
#define	ptsioctl	ptyioctl
cdev_decl(pts);
#define	ptctty		ptytty
#define	ptcioctl	ptyioctl
cdev_decl(ptc);
cdev_decl(log);
a135 2
cdev_decl(sd);
cdev_decl(st);
a136 2
cdev_decl(ss);
cdev_decl(cd);
a143 1
cdev_decl(bpf);
a147 1
cdev_decl(lkm);
a157 2
cdev_decl(tun);
cdev_decl(vnd);
a160 1
cdev_decl(ccd);
a164 1
cdev_decl(random);
d179 4
@


1.27
log
@fix for acd
@
text
@d1 1
a1 1
/*	$OpenBSD: conf.c,v 1.26 1996/11/06 01:35:25 deraadt Exp $	*/
d75 1
a75 1
	bdev_notdef(),
a91 3
	bdev_notdef(),
	bdev_disk_init(NFD,fd),		/* 20: floppy diskette */
	bdev_disk_init((NFD>2?NFD-2:0),fd),/* 21: floppy diskette */
d220 1
a220 1
	cdev_notdef(),
d232 1
a232 1
	cdev_ocis_init(NAPM,apm),	/* 21: Advanced Power Management */
a261 3
	cdev_notdef(),
	cdev_disk_init(NFD,fd),		/* 48: floppy disk */
	cdev_disk_init((NFD>2?NFD-2:0),fd),	/* 49: floppy disk */
d312 1
a312 1
	/*  9 */	NODEV,
d351 2
a352 2
	/* 48 */	20,
	/* 49 */	21,
@


1.26
log
@add blktochr()
@
text
@d1 1
a1 1
/*	$OpenBSD: conf.c,v 1.25 1996/11/06 01:35:06 deraadt Exp $	*/
d333 1
a333 1
	/* 24 */	NODEV,
@


1.25
log
@move floppy to split-major for 4 units
@
text
@d1 1
a1 1
/*	$OpenBSD: conf.c,v 1.23 1996/09/01 20:55:20 downsj Exp $	*/
d376 18
@


1.24
log
@random device is permanent now.
@
text
@d75 1
a75 1
	bdev_disk_init(NFD,fd),		/* 2: floppy diskette */
d92 3
d223 1
a223 1
	cdev_disk_init(NFD,fd),		/* 9: floppy disk */
d235 1
a235 1
	cdev_ocis_init(NAPM,apm),	/* 21: Advancded Power Management */
d265 3
d318 1
a318 1
	/*  9 */	2,
d357 2
a358 2
	/* 48 */	NODEV,
	/* 49 */	NODEV,
@


1.23
log
@initial commit of split fdc/fd drivers
@
text
@d1 1
a1 1
/*	$OpenBSD: conf.c,v 1.22 1996/08/29 09:26:04 deraadt Exp $	*/
a188 1
#include "random.h"
d260 1
a260 1
	cdev_random_init(NRANDOM,random), /* 45 random data source */
@


1.22
log
@rnd -> random
@
text
@d1 1
a1 1
/*	$OpenBSD: conf.c,v 1.21 1996/08/08 18:47:10 dm Exp $	*/
d45 1
d75 1
a75 1
	bdev_disk_init(NFDC,fd),	/* 2: floppy diskette */
d221 1
a221 1
	cdev_disk_init(NFDC,fd),	/* 9: floppy disk */
@


1.21
log
@Added a pctr pseudo-device for accessing the Pentium performance counters,
and a program pctrctl to set the counter functions.
@
text
@d1 1
a1 1
/*	$OpenBSD: conf.c,v 1.20 1996/07/28 05:07:05 downsj Exp $	*/
d188 2
a189 2
#include "rnd.h"
cdev_decl(rnd);
d260 1
a260 1
	cdev_rnd_init(NRND,rnd),	/* 45 random data source */
@


1.20
log
@pccom and com are now mutually exclusive; pccom moves to major 8, the
same as com.

Also various function renaming and such so that multiport drivers should
now be able to link with pccom.  pccomvar.h is no longer needed.
@
text
@d1 1
a1 1
/*	$OpenBSD: conf.c,v 1.19 1996/07/15 14:57:02 mickey Exp $	*/
d190 2
d261 1
@


1.19
log
@add rnd driver
@
text
@d1 1
a1 1
/*	$OpenBSD: conf.c,v 1.18 1996/07/15 07:35:13 mickey Exp $	*/
d142 1
a189 2
#include "pccom.h"
cdev_decl(pccom);
d198 5
d213 3
d217 1
a258 1
	cdev_tty_init(NPCCOM,pccom),	/* 46: serial port */
a378 1
cons_decl(pccom);
d384 1
a384 1
#if NCOM > 0
a385 3
#endif
#if NPCCOM > 0
	cons_init(pccom),
@


1.18
log
@add "unknown SCSI"
@
text
@d1 1
a1 1
/*	$OpenBSD: conf.c,v 1.17 1996/07/06 23:59:36 downsj Exp $	*/
d113 1
a113 1
#define cdev_ss_init(c,n) { \
a117 1
#define cdev_joy_init cdev_ss_init
@


1.17
log
@add pccom, character device 46.
@
text
@d1 1
a1 1
/*	$OpenBSD: conf.c,v 1.16 1996/06/08 09:12:39 downsj Exp $	*/
d54 2
d222 1
a222 1
	cdev_notdef(),			/* 20 */
@


1.16
log
@Initial support ATAPI CD-ROMs.

Based on Manuel Bouyer's drivers.
@
text
@d1 1
a1 1
/*	$OpenBSD: conf.c,v 1.12 1996/04/21 22:16:23 deraadt Exp $	*/
d188 2
d250 1
d371 1
d379 3
@


1.15
log
@sync with 0504; prototype changes
@
text
@d54 2
d88 1
d153 1
d222 1
a222 1
	cdev_notdef(),			/* 24 */
@


1.14
log
@remove #ifndef LKM, since that stuff already in sys/conf.h,
add lkmenodev prototype.
@
text
@d2 1
a2 1
/*	$NetBSD: conf.c,v 1.74 1996/03/30 07:30:33 mycroft Exp $	*/
a40 2
int	ttselect	__P((dev_t, int, struct proc *));

a44 1
#define	fdopen	Fdopen	/* conflicts with fdopen() in kern_descrip.c */
a45 1
#undef	fdopen
a69 1
#define	fdopen	Fdopen
a70 1
#undef	fdopen
a138 1
#define	fdopen	Fdopen
a139 1
#undef	fdopen
a202 1
#define	fdopen	Fdopen
a203 1
#undef	fdopen
@


1.13
log
@Pull in John Kohl's [jtk@@netbsd.org] most recent (15Apr96) APM and PCMCIA work
(original PCMCIA framework  by Stefan Grefen [grefen@@convex.com]).
@
text
@a42 6
#ifndef LKM
#define	lkmenodev	enodev
#else
int	lkmenodev();
#endif

a168 5
#ifdef LKM
#define	NLKM	1
#else
#define	NLKM	0
#endif
@


1.12
log
@partial sync with netbsd 960418, more to come
@
text
@d1 1
a1 1
/*	$OpenBSD: conf.c,v 1.11 1996/04/18 19:18:06 niklas Exp $	*/
d127 7
d171 2
d199 2
d236 1
a236 1
	cdev_notdef(),			/* 21 */
d240 1
a240 1
	cdev_notdef(),			/* 25 */
@


1.11
log
@Merge of NetBSD 960317
@
text
@d1 2
a2 2
/*	$OpenBSD$	*/
/*	$NetBSD: conf.c,v 1.71 1996/03/14 21:27:33 christos Exp $	*/
d72 3
d97 1
a118 13
/* open, close, ioctl, select -- XXX should be a generic device */
#define cdev_ocis_init(c,n) { \
        dev_init(c,n,open), dev_init(c,n,close), (dev_type_read((*))) enodev, \
        (dev_type_write((*))) enodev, dev_init(c,n,ioctl), \
        (dev_type_stop((*))) enodev, 0,  dev_init(c,n,select), \
        (dev_type_mmap((*))) enodev, 0 }

/* open, close, read, ioctl */
#define cdev_joy_init(c,n) { \
	dev_init(c,n,open), dev_init(c,n,close), dev_init(c,n,read), \
	(dev_type_write((*))) enodev, dev_init(c,n,ioctl), \
	(dev_type_stop((*))) enodev, 0, seltrue, (dev_type_mmap((*))) enodev }
		 
d125 1
a163 2
#include "pcmciabus.h"
cdev_decl(pcmciabus);
d229 2
a230 2
	cdev_joy_init(NJOY,joy),	/* 25: Game adapter */
	cdev_ocis_init(NPCMCIABUS,pcmciabus), /* 26: PCMCIA Bus */
d273 1
d284 1
d350 1
@


1.10
log
@Initial commit of random source driver.
@
text
@d1 2
a2 1
/*	$NetBSD: conf.c,v 1.68 1995/12/09 05:53:00 mycroft Exp $	*/
d130 1
a130 1
        dev_init(c,n,open), dev_init(c,n,close), dev_init(c,n,read), \
a134 1

d169 1
a169 1
dev_decl(fd,open);
d236 1
a236 1
	cdev_fd_init(1,fd),		/* 22: file descriptor pseudo-device */
@


1.9
log
@Merging w/ NetBSD 021796.
speaker upgraded to the current.
some changes to the VM stuff (ie kern_thread.c added and so).
@
text
@d200 2
d262 2
a263 1
	cdev_gen_ipf(NIPF,ipl),         /* 44 */
@


1.8
log
@Small changes from NetBSD (including /usr/include dependencies, and so).
@
text
@d1 1
a1 1
/*	$OpenBSD: conf.c,v 1.7 1996/02/26 10:26:48 mickey Exp $	*/
@


1.7
log
@From NetBSD
Move the speaker to the 'new' config.
@
text
@d1 1
a1 1
/*	$OpenBSD: conf.c,v 1.68 1995/12/09 05:53:00 mycroft Exp $	*/
a60 2
#include "ss.h"
cdev_decl(ss);
d162 2
@


1.6
log
@move cdev_gen_ipf() macro to the <sys/conf.h>, so the lkm
for ipl is possible and also, why it is in <machine/conf.c> while
it (ipl) is in <net/*> ???
@
text
@d61 2
d129 8
d174 1
a174 1
#include "speaker.h"
d231 1
a231 1
	cdev_notdef(),			/* 19 */
d239 1
a239 1
	cdev_spkr_init(NSPEAKER,spkr),	/* 27: PC speaker */
@


1.5
log
@add the freebsd joystick driver; converted by matthieu@@abel.laas.fr;
netbsd pr#1916
@
text
@d1 1
a1 1
/*	$NetBSD: conf.c,v 1.68 1995/12/09 05:53:00 mycroft Exp $	*/
a190 1
/* open, close, read, ioctl */
a191 5
#define	cdev_gen_ipf(c,n) { \
	dev_init(c,n,open), dev_init(c,n,close), dev_init(c,n,read), \
	(dev_type_write((*))) enodev, dev_init(c,n,ioctl), \
	(dev_type_stop((*))) nullop, 0, (dev_type_select((*))) enodev, \
	(dev_type_mmap((*))) enodev, 0 }
@


1.4
log
@define pcmciabus for PCMCIA support
@
text
@d121 6
d188 2
d233 1
a233 1
	cdev_notdef(),			/* 25 */
@


1.3
log
@from beurton@@fnet.fr:  Darren Reed's IP filter
@
text
@d114 7
d156 2
d226 1
a226 1
	cdev_notdef(),			/* 26 */
@


1.2
log
@from netbsd: include /dev/io as one of the `kmem' devices
@
text
@d174 13
d239 1
@


1.1
log
@Initial revision
@
text
@d1 1
a1 1
/*	$NetBSD: conf.c,v 1.67 1995/08/17 17:40:50 thorpej Exp $	*/
d249 1
a249 1
	return (major(dev) == mem_no && minor(dev) < 2);
@


1.1.1.1
log
@initial import of NetBSD tree
@
text
@@
