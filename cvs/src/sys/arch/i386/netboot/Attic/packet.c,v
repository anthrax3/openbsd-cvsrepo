head	1.4;
access;
symbols
	SMP_SYNC_A:1.4
	SMP_SYNC_B:1.4
	UBC_SYNC_A:1.4
	UBC_SYNC_B:1.4
	SMP:1.4.0.2
	OPENBSD_2_2:1.3.0.6
	OPENBSD_2_2_BASE:1.3
	OPENBSD_2_1:1.3.0.4
	OPENBSD_2_1_BASE:1.3
	OPENBSD_2_0:1.3.0.2
	OPENBSD_2_0_BASE:1.3
	netbsd_1_1:1.1.1.1;
locks; strict;
comment	@ * @;


1.4
date	97.11.05.02.47.19;	author mickey;	state dead;
branches;
next	1.3;

1.3
date	96.04.26.18.23.07;	author mickey;	state Exp;
branches;
next	1.2;

1.2
date	96.03.19.21.09.56;	author mickey;	state Exp;
branches;
next	1.1;

1.1
date	95.10.18.08.50.51;	author deraadt;	state Exp;
branches
	1.1.1.1;
next	;

1.1.1.1
date	95.10.18.08.50.51;	author deraadt;	state Exp;
branches;
next	;


desc
@@


1.4
log
@who needs that junk (;
@
text
@/*	$OpenBSD: packet.c,v 1.3 1996/04/26 18:23:07 mickey Exp $	*/
/*	$NetBSD: packet.c,v 1.4 1996/02/02 18:06:21 mycroft Exp $	*/

/*
 * source in this file came from
 * the Mach ethernet boot written by Leendert van Doorn.
 *
 * Packet allocation and deallocation routines.
 *
 * Copyright (c) 1992 by Leendert van Doorn
 */

#include "proto.h"
#include "assert.h"
#include "param.h"
#include "packet.h"

static packet_t *pool = (packet_t *)0;
static packet_t *last;

void
PktInit(void) {
  static packet_t s_pool[PKT_POOLSIZE];
  pool = s_pool;
  bzero((char *)pool, PKT_POOLSIZE * sizeof(packet_t));
  last = pool;
}

packet_t *
PktAlloc(u_long offset) {
  int i;

  for (i = 0; i < PKT_POOLSIZE; i++) {
    if (last->pkt_used == FALSE) {
      bzero((char *)last->pkt_data, PKT_DATASIZE);
      last->pkt_used = TRUE;
      last->pkt_len = 0;
      last->pkt_offset = last->pkt_data + offset;
#if 0
printf("PktAlloc: used %x\n", last);
#endif
      return last;
    }
    if (++last == &pool[PKT_POOLSIZE])
      last = pool;
  }
  printf("Pool out of free packets\n");
  exit(1);
  return 0; /* silence warnings */
}

void
PktRelease(packet_t *pkt) {
#if 0
printf("PktAlloc: freed %x\n", pkt);
#endif
    assert(pkt >= &pool[0]);
    assert(pkt < &pool[PKT_POOLSIZE]);
    (last = pkt)->pkt_used = FALSE;
}
@


1.3
log
@Fix the code, so it compiles now.
@
text
@d1 1
a1 1
/*	$OpenBSD$	*/
@


1.2
log
@Merging w/ NetBSD 021796.
speaker upgraded to the current.
some changes to the VM stuff (ie kern_thread.c added and so).
@
text
@d1 1
d15 1
a15 1
#include <sys/param.h>
@


1.1
log
@Initial revision
@
text
@d1 1
a1 1
/*	$NetBSD: packet.c,v 1.3 1994/10/27 04:21:21 cgd Exp $	*/
d14 1
a14 1
#include "param.h"
@


1.1.1.1
log
@initial import of NetBSD tree
@
text
@@
