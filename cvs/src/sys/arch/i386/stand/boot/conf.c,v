head	1.62;
access;
symbols
	OPENBSD_6_2_BASE:1.62
	OPENBSD_6_1:1.61.0.4
	OPENBSD_6_1_BASE:1.61
	OPENBSD_6_0:1.59.0.2
	OPENBSD_6_0_BASE:1.59
	OPENBSD_5_9:1.58.0.2
	OPENBSD_5_9_BASE:1.58
	OPENBSD_5_8:1.55.0.10
	OPENBSD_5_8_BASE:1.55
	OPENBSD_5_7:1.55.0.2
	OPENBSD_5_7_BASE:1.55
	OPENBSD_5_6:1.55.0.6
	OPENBSD_5_6_BASE:1.55
	OPENBSD_5_5:1.55.0.4
	OPENBSD_5_5_BASE:1.55
	OPENBSD_5_4:1.50.0.4
	OPENBSD_5_4_BASE:1.50
	OPENBSD_5_3:1.50.0.2
	OPENBSD_5_3_BASE:1.50
	OPENBSD_5_2:1.47.0.2
	OPENBSD_5_2_BASE:1.47
	OPENBSD_5_1_BASE:1.46
	OPENBSD_5_1:1.46.0.4
	OPENBSD_5_0:1.46.0.2
	OPENBSD_5_0_BASE:1.46
	OPENBSD_4_9:1.44.0.2
	OPENBSD_4_9_BASE:1.44
	OPENBSD_4_8:1.41.0.2
	OPENBSD_4_8_BASE:1.41
	OPENBSD_4_7:1.39.0.6
	OPENBSD_4_7_BASE:1.39
	OPENBSD_4_6:1.39.0.8
	OPENBSD_4_6_BASE:1.39
	OPENBSD_4_5:1.39.0.4
	OPENBSD_4_5_BASE:1.39
	OPENBSD_4_4:1.39.0.2
	OPENBSD_4_4_BASE:1.39
	OPENBSD_4_3:1.38.0.4
	OPENBSD_4_3_BASE:1.38
	OPENBSD_4_2:1.38.0.2
	OPENBSD_4_2_BASE:1.38
	OPENBSD_4_1:1.35.0.2
	OPENBSD_4_1_BASE:1.35
	OPENBSD_4_0:1.32.0.6
	OPENBSD_4_0_BASE:1.32
	OPENBSD_3_9:1.32.0.4
	OPENBSD_3_9_BASE:1.32
	OPENBSD_3_8:1.32.0.2
	OPENBSD_3_8_BASE:1.32
	OPENBSD_3_7:1.28.0.6
	OPENBSD_3_7_BASE:1.28
	OPENBSD_3_6:1.28.0.4
	OPENBSD_3_6_BASE:1.28
	SMP_SYNC_A:1.28
	SMP_SYNC_B:1.28
	OPENBSD_3_5:1.28.0.2
	OPENBSD_3_5_BASE:1.28
	OPENBSD_3_4:1.24.0.2
	OPENBSD_3_4_BASE:1.24
	UBC_SYNC_A:1.20
	OPENBSD_3_3:1.19.0.4
	OPENBSD_3_3_BASE:1.19
	OPENBSD_3_2:1.19.0.2
	OPENBSD_3_2_BASE:1.19
	OPENBSD_3_1:1.18.0.6
	OPENBSD_3_1_BASE:1.18
	UBC_SYNC_B:1.19
	UBC:1.18.0.4
	UBC_BASE:1.18
	OPENBSD_3_0:1.18.0.2
	OPENBSD_3_0_BASE:1.18
	OPENBSD_2_9:1.16.0.4
	OPENBSD_2_9_BASE:1.16
	OPENBSD_2_8:1.16.0.2
	OPENBSD_2_8_BASE:1.16
	OPENBSD_2_7:1.13.0.10
	OPENBSD_2_7_BASE:1.13
	SMP:1.13.0.8
	SMP_BASE:1.13
	kame_19991208:1.13
	OPENBSD_2_6:1.13.0.6
	OPENBSD_2_6_BASE:1.13
	OPENBSD_2_5:1.13.0.4
	OPENBSD_2_5_BASE:1.13
	OPENBSD_2_4:1.13.0.2
	OPENBSD_2_4_BASE:1.13
	OPENBSD_2_3:1.12.0.2
	OPENBSD_2_3_BASE:1.12
	OPENBSD_2_2:1.10.0.2
	OPENBSD_2_2_BASE:1.10
	OPENBSD_2_1:1.3.0.2
	OPENBSD_2_1_BASE:1.3;
locks; strict;
comment	@ * @;


1.62
date	2017.09.08.05.36.51;	author deraadt;	state Exp;
branches;
next	1.61;
commitid	uRv5pa9QDlZaYgwD;

1.61
date	2016.09.18.16.36.09;	author jsing;	state Exp;
branches;
next	1.60;
commitid	WkSscQaY8qKWlKae;

1.60
date	2016.09.13.18.27.49;	author jasper;	state Exp;
branches;
next	1.59;
commitid	PHzGPdVfpKxkA6ei;

1.59
date	2016.05.28.15.53.39;	author sthen;	state Exp;
branches;
next	1.58;
commitid	FG665gYSEoDAcq6f;

1.58
date	2016.02.19.21.30.06;	author naddy;	state Exp;
branches;
next	1.57;
commitid	xYBoDj8fiMmLqnCC;

1.57
date	2015.09.18.13.30.56;	author miod;	state Exp;
branches;
next	1.56;
commitid	1BEcCDYd9p5DIl0g;

1.56
date	2015.09.02.04.09.24;	author yasuoka;	state Exp;
branches;
next	1.55;
commitid	1T0xGkKNIiRZnTmz;

1.55
date	2014.02.18.13.56.02;	author jsing;	state Exp;
branches;
next	1.54;

1.54
date	2014.01.02.23.27.36;	author deraadt;	state Exp;
branches;
next	1.53;

1.53
date	2013.12.28.02.53.04;	author deraadt;	state Exp;
branches;
next	1.52;

1.52
date	2013.10.23.06.12.50;	author mlarkin;	state Exp;
branches;
next	1.51;

1.51
date	2013.10.20.13.25.21;	author stsp;	state Exp;
branches;
next	1.50;

1.50
date	2012.10.31.13.57.59;	author jsing;	state Exp;
branches;
next	1.49;

1.49
date	2012.10.12.15.00.33;	author jsing;	state Exp;
branches;
next	1.48;

1.48
date	2012.10.09.14.01.36;	author jsing;	state Exp;
branches;
next	1.47;

1.47
date	2012.06.03.13.17.47;	author kettenis;	state Exp;
branches;
next	1.46;

1.46
date	2011.04.26.17.33.17;	author jsing;	state Exp;
branches;
next	1.45;

1.45
date	2011.03.08.17.24.31;	author krw;	state Exp;
branches;
next	1.44;

1.44
date	2010.12.06.22.51.45;	author jasper;	state Exp;
branches;
next	1.43;

1.43
date	2010.12.06.22.11.01;	author jasper;	state Exp;
branches;
next	1.42;

1.42
date	2010.12.06.18.44.49;	author jasper;	state Exp;
branches;
next	1.41;

1.41
date	2010.08.11.14.18.52;	author deraadt;	state Exp;
branches;
next	1.40;

1.40
date	2010.07.02.00.36.52;	author weingart;	state Exp;
branches;
next	1.39;

1.39
date	2008.04.19.23.20.22;	author weingart;	state Exp;
branches;
next	1.38;

1.38
date	2007.05.31.21.43.57;	author tom;	state Exp;
branches;
next	1.37;

1.37
date	2007.05.30.01.25.43;	author tom;	state Exp;
branches;
next	1.36;

1.36
date	2007.04.27.10.08.34;	author tom;	state Exp;
branches;
next	1.35;

1.35
date	2007.01.02.16.29.27;	author tom;	state Exp;
branches;
next	1.34;

1.34
date	2006.10.12.15.49.58;	author krw;	state Exp;
branches;
next	1.33;

1.33
date	2006.09.18.21.14.15;	author mpf;	state Exp;
branches;
next	1.32;

1.32
date	2005.05.03.13.18.05;	author tom;	state Exp;
branches;
next	1.31;

1.31
date	2005.05.03.13.02.44;	author tom;	state Exp;
branches;
next	1.30;

1.30
date	2005.04.30.16.14.35;	author tom;	state Exp;
branches;
next	1.29;

1.29
date	2005.04.25.23.09.04;	author tom;	state Exp;
branches;
next	1.28;

1.28
date	2004.03.19.13.48.19;	author tom;	state Exp;
branches;
next	1.27;

1.27
date	2003.10.23.18.33.45;	author fgsch;	state Exp;
branches;
next	1.26;

1.26
date	2003.09.19.05.25.12;	author fgsch;	state Exp;
branches;
next	1.25;

1.25
date	2003.09.18.08.24.10;	author fgsch;	state Exp;
branches;
next	1.24;

1.24
date	2003.09.11.17.39.33;	author deraadt;	state Exp;
branches;
next	1.23;

1.23
date	2003.06.03.20.22.11;	author mickey;	state Exp;
branches;
next	1.22;

1.22
date	2003.06.03.00.38.08;	author deraadt;	state Exp;
branches;
next	1.21;

1.21
date	2003.05.31.00.15.28;	author weingart;	state Exp;
branches;
next	1.20;

1.20
date	2003.04.17.03.43.18;	author drahn;	state Exp;
branches;
next	1.19;

1.19
date	2002.06.21.21.02.57;	author weingart;	state Exp;
branches;
next	1.18;

1.18
date	2001.08.20.20.44.49;	author mickey;	state Exp;
branches
	1.18.4.1;
next	1.17;

1.17
date	2001.05.06.17.45.08;	author mickey;	state Exp;
branches;
next	1.16;

1.16
date	2000.10.25.17.11.58;	author mickey;	state Exp;
branches;
next	1.15;

1.15
date	2000.10.19.17.15.26;	author fgsch;	state Exp;
branches;
next	1.14;

1.14
date	2000.05.30.22.00.24;	author mickey;	state Exp;
branches;
next	1.13;

1.13
date	98.07.20.18.14.52;	author mickey;	state Exp;
branches
	1.13.8.1;
next	1.12;

1.12
date	98.04.18.07.39.37;	author deraadt;	state Exp;
branches;
next	1.11;

1.11
date	98.02.24.22.06.40;	author weingart;	state Exp;
branches;
next	1.10;

1.10
date	97.10.26.23.22.09;	author mickey;	state Exp;
branches;
next	1.9;

1.9
date	97.10.17.15.03.18;	author weingart;	state Exp;
branches;
next	1.8;

1.8
date	97.09.29.22.59.03;	author mickey;	state Exp;
branches;
next	1.7;

1.7
date	97.09.02.21.18.13;	author mickey;	state Exp;
branches;
next	1.6;

1.6
date	97.08.13.14.24.00;	author niklas;	state Exp;
branches;
next	1.5;

1.5
date	97.08.12.21.46.52;	author mickey;	state Exp;
branches;
next	1.4;

1.4
date	97.07.17.23.11.19;	author mickey;	state Exp;
branches;
next	1.3;

1.3
date	97.03.31.23.06.22;	author mickey;	state Exp;
branches;
next	1.2;

1.2
date	97.03.31.03.12.04;	author weingart;	state Exp;
branches;
next	1.1;

1.1
date	96.12.03.13.17.00;	author mickey;	state dead;
branches
	1.1.2.1;
next	;

1.1.2.1
date	96.12.03.13.17.00;	author mickey;	state Exp;
branches;
next	1.1.2.2;

1.1.2.2
date	96.12.15.15.49.36;	author mickey;	state Exp;
branches;
next	1.1.2.3;

1.1.2.3
date	97.02.15.23.27.50;	author mickey;	state Exp;
branches;
next	;

1.13.8.1
date	2001.04.18.16.08.40;	author niklas;	state Exp;
branches;
next	1.13.8.2;

1.13.8.2
date	2001.07.04.10.18.11;	author niklas;	state Exp;
branches;
next	1.13.8.3;

1.13.8.3
date	2001.10.31.03.01.13;	author nate;	state Exp;
branches;
next	1.13.8.4;

1.13.8.4
date	2003.03.27.23.26.56;	author niklas;	state Exp;
branches;
next	1.13.8.5;

1.13.8.5
date	2003.05.13.19.42.09;	author ho;	state Exp;
branches;
next	1.13.8.6;

1.13.8.6
date	2003.06.07.11.11.38;	author ho;	state Exp;
branches;
next	1.13.8.7;

1.13.8.7
date	2004.02.19.10.48.42;	author niklas;	state Exp;
branches;
next	1.13.8.8;

1.13.8.8
date	2004.06.05.23.09.00;	author niklas;	state Exp;
branches;
next	;

1.18.4.1
date	2002.10.29.00.28.04;	author art;	state Exp;
branches;
next	1.18.4.2;

1.18.4.2
date	2003.05.19.21.45.12;	author tedu;	state Exp;
branches;
next	;


desc
@@


1.62
log
@If you use sys/param.h, you don't need sys/types.h
@
text
@/*	$OpenBSD: conf.c,v 1.61 2016/09/18 16:36:09 jsing Exp $	*/

/*
 * Copyright (c) 1996 Michael Shalayeff
 * All rights reserved.
 *
 * Redistribution and use in source and binary forms, with or without
 * modification, are permitted provided that the following conditions
 * are met:
 * 1. Redistributions of source code must retain the above copyright
 *    notice, this list of conditions and the following disclaimer.
 * 2. Redistributions in binary form must reproduce the above copyright
 *    notice, this list of conditions and the following disclaimer in the
 *    documentation and/or other materials provided with the distribution.
 *
 * THIS SOFTWARE IS PROVIDED BY THE AUTHOR ``AS IS'' AND ANY EXPRESS OR 
 * IMPLIED WARRANTIES, INCLUDING, BUT NOT LIMITED TO, THE IMPLIED 
 * WARRANTIES OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE
 * ARE DISCLAIMED.  IN NO EVENT SHALL THE REGENTS OR CONTRIBUTORS BE LIABLE
 * FOR ANY DIRECT, INDIRECT, INCIDENTAL, SPECIAL, EXEMPLARY, OR CONSEQUENTIAL
 * DAMAGES (INCLUDING, BUT NOT LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS
 * OR SERVICES; LOSS OF USE, DATA, OR PROFITS; OR BUSINESS INTERRUPTION)
 * HOWEVER CAUSED AND ON ANY THEORY OF LIABILITY, WHETHER IN CONTRACT, STRICT
 * LIABILITY, OR TORT (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY
 * OUT OF THE USE OF THIS SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF
 * SUCH DAMAGE.
 */

#include <sys/param.h>
#include <netinet/in.h>
#include <libsa.h>
#include <lib/libsa/ufs.h>
#ifdef notdef
#include <lib/libsa/cd9660.h>
#include <lib/libsa/fat.h>
#include <lib/libsa/nfs.h>
#include <lib/libsa/tftp.h>
#include <lib/libsa/netif.h>
#endif
#include <biosdev.h>
#include <dev/cons.h>
#include "debug.h"

const char version[] = "3.31";
int	debug = 1;


void (*sa_cleanup)(void) = NULL;


void (*i386_probe1[])(void) = {
	ps2probe, gateA20on, debug_init, cninit,
	apmprobe, pciprobe, /* smpprobe, */ memprobe
};
void (*i386_probe2[])(void) = {
 	diskprobe
};

struct i386_boot_probes probe_list[] = {
	{ "probing", i386_probe1, nitems(i386_probe1) },
	{ "disk",    i386_probe2, nitems(i386_probe2) }
};
int nibprobes = nitems(probe_list);


struct fs_ops file_system[] = {
	{ ufs_open,    ufs_close,    ufs_read,    ufs_write,    ufs_seek,
	  ufs_stat,    ufs_readdir    },
#ifdef notdef
	{ fat_open,    fat_close,    fat_read,    fat_write,    fat_seek,
	  fat_stat,    fat_readdir    },
	{ nfs_open,    nfs_close,    nfs_read,    nfs_write,    nfs_seek,
	  nfs_stat,    nfs_readdir    },
	{ cd9660_open, cd9660_close, cd9660_read, cd9660_write, cd9660_seek,
	  cd9660_stat, cd9660_readdir },
#endif
};
int nfsys = nitems(file_system);

struct devsw	devsw[] = {
	{ "BIOS", biosstrategy, biosopen, biosclose, biosioctl },
#if 0
	{ "TFTP", tftpstrategy, tftpopen, tftpclose, tftpioctl },
#endif
};
int ndevs = nitems(devsw);

#ifdef notdef
struct netif_driver	*netif_drivers[] = {
	NULL
};
int n_netif_drivers = nitems(netif_drivers);
#endif

struct consdev constab[] = {
	{ pc_probe, pc_init, pc_getc, pc_putc },
	{ com_probe, com_init, com_getc, com_putc },
	{ NULL }
};
struct consdev *cn_tab = constab;
@


1.61
log
@Bump boot loader versions due to bcrypt pbkdf support.
@
text
@d1 1
a1 1
/*	$OpenBSD: conf.c,v 1.60 2016/09/13 18:27:49 jasper Exp $	*/
a29 1
#include <sys/types.h>
@


1.60
log
@crank bootloader version after .SUNW_ctf change

as discussed with jsing@@ it's easier this way to ensure people have
bootblocks capable of loading the section
@
text
@d1 1
a1 1
/*	$OpenBSD: conf.c,v 1.59 2016/05/28 15:53:39 sthen Exp $	*/
d45 1
a45 1
const char version[] = "3.30";
@


1.59
log
@crank version numbers of those bootloaders that have been changed by
the com_init fix.  ok beck deraadt
@
text
@d1 1
a1 1
/*	$OpenBSD: conf.c,v 1.58 2016/02/19 21:30:06 naddy Exp $	*/
d45 1
a45 1
const char version[] = "3.29";
@


1.58
log
@belatedly bump bootstrap version after mdrandom() changes; ok deraadt@@
@
text
@d1 1
a1 1
/*	$OpenBSD: conf.c,v 1.57 2015/09/18 13:30:56 miod Exp $	*/
d45 1
a45 1
const char version[] = "3.28";
@


1.57
log
@Remove support for building the boot blocks with DEBUGFLAGS=-D_TEST, which is
supposed to create a userland binary in order to test non-boot related
functionality. This feature has been bitrotting in a non-compiling state
for years, and causes a too-many-ifdefs disease now that there are intrusive
EFI changes.

No functional change.
@
text
@d1 1
a1 1
/*	$OpenBSD: conf.c,v 1.56 2015/09/02 04:09:24 yasuoka Exp $	*/
d45 1
a45 1
const char version[] = "3.27";
@


1.56
log
@Bring the boot changes on amd64 to i386.  alloca is deleted.
Also fix the boot from BIOS and bump the version.

input and ok deraadt
@
text
@d1 1
a1 1
/*	$OpenBSD: conf.c,v 1.55 2014/02/18 13:56:02 jsing Exp $	*/
a40 1
#include <lib/libsa/unixdev.h>
a77 4
#ifdef _TEST
	{ null_open,   null_close,   null_read,   null_write,   null_seek,
	  null_stat,   null_readdir   }
#endif
a81 3
#ifdef _TEST
	{ "UNIX", unixstrategy, unixopen, unixclose, unixioctl },
#else
a82 1
#endif
a96 3
#ifdef _TEST
	{ unix_probe, unix_init, unix_getc, unix_putc },
#else
a98 1
#endif
@


1.55
log
@Bump version numbers.
@
text
@d1 1
a1 1
/*	$OpenBSD: conf.c,v 1.54 2014/01/02 23:27:36 deraadt Exp $	*/
d46 1
a46 1
const char version[] = "3.26";
@


1.54
log
@crank version after random instruction fix from jsing
@
text
@d1 1
a1 1
/*	$OpenBSD: conf.c,v 1.53 2013/12/28 02:53:04 deraadt Exp $	*/
d46 1
a46 1
const char version[] = "3.25";
@


1.53
log
@crank the version
@
text
@d1 1
a1 1
/*	$OpenBSD: conf.c,v 1.52 2013/10/23 06:12:50 mlarkin Exp $	*/
d46 1
a46 1
const char version[] = "3.24";
@


1.52
log
@

Crank bootblock versions after last commit
@
text
@d1 1
a1 1
/*	$OpenBSD: conf.c,v 1.51 2013/10/20 13:25:21 stsp Exp $	*/
d46 1
a46 1
const char version[] = "3.23";
@


1.51
log
@Add i386/amd64 boot(8) support for keydisk-based softraid crypto volumes.

So far, only passphrase-based crypto volumes were bootable. Full disk
encryption with keydisks required a non-crypto partition to load the kernel.

The bootloader now scans all BIOS-visible disks for RAID partitions and
automatically associates keydisk partitions with their crypto volume.
Attempting to boot from a volume without its keydisk currently results
in a passphrase prompt (this might be changed in the future).

There is no need to re-create existing volumes. Moving the root partition
onto the crypto disk and running installboot(8) is all that's needed.

help & ok jsing
@
text
@d1 1
a1 1
/*	$OpenBSD: conf.c,v 1.50 2012/10/31 13:57:59 jsing Exp $	*/
d46 1
a46 1
const char version[] = "3.22";
@


1.50
log
@Bump i386 boot(8) version.
@
text
@d1 1
a1 1
/*	$OpenBSD: conf.c,v 1.49 2012/10/12 15:00:33 jsing Exp $	*/
d46 1
a46 1
const char version[] = "3.21";
@


1.49
log
@Force 16 byte alignment in boot(8) srt0.S, since this is more likely to get
the required file offset (0x120) for the .text segment.
@
text
@d1 1
a1 1
/*	$OpenBSD: conf.c,v 1.48 2012/10/09 14:01:36 jsing Exp $	*/
d46 1
a46 1
const char version[] = "3.20";
@


1.48
log
@Bump boot versions due to recent changes.
@
text
@d1 1
a1 1
/*	$OpenBSD: conf.c,v 1.47 2012/06/03 13:17:47 kettenis Exp $	*/
d46 1
a46 1
const char version[] = "3.19";
@


1.47
log
@Add support for serial consoles at non-standard addresses.  This implements
a new "machine comaddr" command that makes it possible to configure the
io port used to access the serial port.  This can be used to use serial ports
on a puc(4) device as serial console.
@
text
@d1 1
a1 1
/*	$OpenBSD: conf.c,v 1.46 2011/04/26 17:33:17 jsing Exp $	*/
d46 1
a46 1
const char version[] = "3.18";
@


1.46
log
@Make amd64/i386 boot(8) pass the DUID of the selected boot device to the
kernel so that it can use it to identify the root disk. This will be
needed in order to correctly boot from a softraid volume.

ok deraadt@@ marco@@ krw@@
@
text
@d1 1
a1 1
/*	$OpenBSD: conf.c,v 1.44 2010/12/06 22:51:45 jasper Exp $	*/
d46 1
a46 1
const char version[] = "3.17";
@


1.45
log
@Fix extended partition searching so we don't get lost. The offset
of the next EBR is relative to the start of the extended partition
described in the first MBR, not relative to the EBR specifying the
offset in its extended partition entry.

Clean up installboot -v output. Use daddr64_t for all sector numbers.

Not a complete fix, but better than what we had. More tweaks to
come.

Inspired by a diff and cluebat from uscav on tech@@ a few weeks
ago.

Feedback from matthew@@, weingart@@.

ok deraadt@@
@
text
@d46 1
a46 1
const char version[] = "3.16";
@


1.44
log
@- properly remove NENTS now after fixing the fallout.

ok deraadt@@
@
text
@d1 1
a1 1
/*	$OpenBSD: conf.c,v 1.43 2010/12/06 22:11:01 jasper Exp $	*/
d46 1
a46 1
const char version[] = "3.15";
@


1.43
log
@- partially revert previous NENTS removal for arches which got busted.
@
text
@d1 1
a1 1
/*	$OpenBSD: conf.c,v 1.42 2010/12/06 18:44:49 jasper Exp $	*/
d29 1
d62 2
a63 2
	{ "probing", i386_probe1, NENTS(i386_probe1) },
	{ "disk",    i386_probe2, NENTS(i386_probe2) }
d65 1
a65 1
int nibprobes = NENTS(probe_list);
d84 1
a84 1
int nfsys = NENTS(file_system);
d96 1
a96 1
int ndevs = NENTS(devsw);
d102 1
a102 1
int n_netif_drivers = NENTS(netif_drivers);
@


1.42
log
@- drop NENTS(), which was yet another copy of nitems().
no binary change


ok deraadt@@
@
text
@d1 1
a1 1
/*	$OpenBSD: conf.c,v 1.41 2010/08/11 14:18:52 deraadt Exp $	*/
d61 2
a62 2
	{ "probing", i386_probe1, nitems(i386_probe1) },
	{ "disk",    i386_probe2, nitems(i386_probe2) }
d64 1
a64 1
int nibprobes = nitems(probe_list);
d83 1
a83 1
int nfsys = nitems(file_system);
d95 1
a95 1
int ndevs = nitems(devsw);
d101 1
a101 1
int n_netif_drivers = nitems(netif_drivers);
@


1.41
log
@crank version
@
text
@d1 1
a1 1
/*	$OpenBSD: conf.c,v 1.40 2010/07/02 00:36:52 weingart Exp $	*/
d61 2
a62 2
	{ "probing", i386_probe1, NENTS(i386_probe1) },
	{ "disk",    i386_probe2, NENTS(i386_probe2) }
d64 1
a64 1
int nibprobes = NENTS(probe_list);
d83 1
a83 1
int nfsys = NENTS(file_system);
d95 1
a95 1
int ndevs = NENTS(devsw);
d101 1
a101 1
int n_netif_drivers = NENTS(netif_drivers);
@


1.40
log
@Add ability to limit memory presented to kernel with
'machine memory =128M' style commands.  Thanks to
phessler for finding a small man page niggle.  Bumped
version strings to a nice round fraction, and make them
the same across the board.  Easier to identify boot
binary versions that way.

ok thib@@, tedu@@, phessler@@
@
text
@d1 1
a1 1
/*	$OpenBSD: conf.c,v 1.39 2008/04/19 23:20:22 weingart Exp $	*/
d45 1
a45 1
const char version[] = "3.14";
@


1.39
log
@Change ELF loader to use the LMA as the load address for the
various segments.  Hopefully this will help remove various
hacks in the boot loader in the future.  This should have no
effect on most architectures (as we tend to have LMA == VMA).

ok drahn@@, soft ok's various others.
@
text
@d1 1
a1 1
/*	$OpenBSD: conf.c,v 1.38 2007/05/31 21:43:57 tom Exp $	*/
d45 1
a45 1
const char version[] = "3.02";
@


1.38
log
@Forgot to commit the changes to this file with the rest of the ELF32+64
pieces.  Since this is where the "boot both ELF32 and ELF64" behaviour
is turned on for i386, it is quite important.

Bump version numbers too.

Found by ckuethe@@; thanks.
@
text
@d1 1
a1 1
/*	$OpenBSD: conf.c,v 1.37 2007/05/30 01:25:43 tom Exp $	*/
d45 1
a45 1
const char version[] = "3.01";
@


1.37
log
@Pull out the ELF loadfile pieces from the standalone libraries, so that
both 32- and 64-bit versions can be created (previously only one or the
other could be built for a given boot loader).

Use this to allow the i386 and amd64 boot blocks to boot both ELF32 and
ELF64 kernels (i.e. amd64 boot blocks can now load i386 kernels, and
vice versa).  Obviously the system must support LONG mode in order to
successfully run the amd64 kernel once it is loaded.

Advice and discussions from/with dale@@ (going back three years).  Much
testing nick@@ and todd@@; thanks.
@
text
@d1 1
a1 1
/*	$OpenBSD: conf.c,v 1.36 2007/04/27 10:08:34 tom Exp $	*/
d45 1
a45 1
const char version[] = "3.00";
@


1.36
log
@Check for Control key held down when starting, and don't read boot.conf
if it is.  This gives a way to recover from "switching to com0" when
there's no serial cable handy.

Bump version numbers.

A similar change will be made to amd64 boot soon.

ok toby@@ deraadt@@
@
text
@d1 1
a1 1
/*	$OpenBSD: conf.c,v 1.35 2007/01/02 16:29:27 tom Exp $	*/
a26 1
 *
d45 1
a45 1
const char version[] = "2.14";
@


1.35
log
@Fix the keyboard problem seen on Intel Macs, where only the first
keypress is seen by boot.

It appears that on the Intel Mac, we have to issue the "check for
keystroke" BIOS call before the "get keystroke" call will get it
(unlike any other BIOS I have seen in over 20 years).

It would not have been possible to fix this problem without the
donation from Steven N. Fettig (steve (at) anywheretechnology.com);
many thanks.

Bump versions of boot, cdboot and pxeboot accordingly.

Testing kettenis@@, otto@@, and others; ok weingart@@.
@
text
@d1 1
a1 1
/*	$OpenBSD: conf.c,v 1.34 2006/10/12 15:49:58 krw Exp $	*/
d46 1
a46 1
const char version[] = "2.13";
@


1.34
log
@Bump versions to note behaviour change of no longer trying
to boot from NetBSD partitions. Requested by tom@@.
@
text
@d1 1
a1 1
/*	$OpenBSD: conf.c,v 1.33 2006/09/18 21:14:15 mpf Exp $	*/
d46 1
a46 1
const char version[] = "2.12";
@


1.33
log
@boot(8) ``machine memory'' support for > 4G.
Convert parser to strtoll(3) and use 64bit printf.
With help from mickey@@
i386 and amd64 tests by me, alpha test by mickey@@
OK mickey@@, miod@@, deraadt@@
@
text
@d1 1
a1 1
/*	$OpenBSD: conf.c,v 1.32 2005/05/03 13:18:05 tom Exp $	*/
d46 1
a46 1
const char version[] = "2.11";
@


1.32
log
@The return value from getEBDAaddr() (info) is not used in bios_E820(),
so nuke it.  amd64 no longer needs biosprobe.c listed in SRCS.  Trims
100 bytes from the boot blocks.

Bump versions on boot, cdboot and pxeboot, as I'm getting cautious in
my old age.

ok weingart@@
@
text
@d1 1
a1 1
/*	$OpenBSD: conf.c,v 1.31 2005/05/03 13:02:44 tom Exp $	*/
d46 1
a46 1
const char version[] = "2.10";
@


1.31
log
@Convert the size of a memory chunk from bytes to megabytes before
casting to a 32-bit value, not after.  Corrects the display of large
memory chunks in the probing: line (mem[615K 3518M 0M a20=on] becomes
mem[615K 3518M 12288M a20=on]).

Bump version on boot, cdboot and pxeboot accordingly.

"looks ok to me" weingart@@
@
text
@d1 1
a1 1
/*	$OpenBSD: conf.c,v 1.30 2005/04/30 16:14:35 tom Exp $	*/
d46 1
a46 1
const char version[] = "2.09";
@


1.30
log
@Ensure we save the %ebx register returned from the BIOS call, not just
%bx.  Fixes problem introduced in gidt.S r1.29, which could lead to an
incomplete memory map, and "too little memory available; running in
degraded mode", as found by Roy Morris rmorris (at) internetsecure (dot)
com.  (Thanks for the report, and for testing the fix.)

Bump version on boot, cdboot and pxeboot accordingly.

ok weingart@@
@
text
@d1 1
a1 1
/*	$OpenBSD: conf.c,v 1.29 2005/04/25 23:09:04 tom Exp $	*/
d46 1
a46 1
const char version[] = "2.08";
@


1.29
log
@[OpenBSD]

Make boot code use real mode with 64K segments instead of 1M
segments.  Improves stability with some disk controller cards.
Also explicitly state operand size on some moves.

Bump version on boot, cdboot and pxeboot accordingly.

"just get them in" beck@@ ok weingart@@
@
text
@d1 1
a1 1
/*	$OpenBSD: conf.c,v 1.28 2004/03/19 13:48:19 tom Exp $	*/
d46 1
a46 1
const char version[] = "2.07";
@


1.28
log
@Enter pxeboot, derived from the NetBSD implementation.  Initially
intended to support network installs using bsd.rd over TFTP.

Thanks to the many who tested, including Diana Eichert.

ok deraadt@@
@
text
@d1 1
a1 1
/*	$OpenBSD: conf.c,v 1.27 2003/10/23 18:33:45 fgsch Exp $	*/
d46 1
a46 1
const char version[] = "2.06";
@


1.27
log
@- delay reading the disklabel for floppies until after we're sure it's
the boot device. this fixes a delay (sometimes very long) if the bios
correctly reports a floppy but it's unplugged.
- bump version.

original idea from mdw@@,  tested by nick@@, toby@@ ok.
@
text
@d1 1
a1 1
/*	$OpenBSD: conf.c,v 1.26 2003/09/19 05:25:12 fgsch Exp $	*/
d44 1
d46 1
a46 1
const char version[] = "2.05";
d50 18
a114 1

@


1.26
log
@- some bios return a valid geometry for inexistent hd's so before
  getting the geometry check the number of attached drives from
  the bios area at 40:75.
- bump version.

from toby@@. we want people to test this, specially those with ghost
drives showing up.
@
text
@d1 1
a1 1
/*	$OpenBSD: conf.c,v 1.25 2003/09/18 08:24:10 fgsch Exp $	*/
d45 1
a45 1
const char version[] = "2.04";
@


1.25
log
@- move checks earlier to catch inexistent devices before testing for edd.
- bump version.
toby@@ ok.
@
text
@d1 1
a1 1
/*	$OpenBSD: conf.c,v 1.23 2003/06/03 20:22:11 mickey Exp $	*/
d45 1
a45 1
const char version[] = "2.03";
@


1.24
log
@handle case where bios EDD support only supports a subset; from fgsch,
ok toby, and now tested for lots of machines
@
text
@d45 1
a45 1
const char version[] = "2.02";
@


1.23
log
@three four kills
@
text
@d1 1
a1 1
/*	$OpenBSD: conf.c,v 1.22 2003/06/03 00:38:08 deraadt Exp $	*/
d45 1
a45 1
const char version[] = "2.01";
@


1.22
log
@fix tree after mickey breakage
@
text
@d1 1
a1 1
/*	$OpenBSD: conf.c,v 1.21 2003/05/31 00:15:28 weingart Exp $	*/
a14 5
 * 3. All advertising materials mentioning features or use of this software
 *    must display the following acknowledgement:
 *	This product includes software developed by Michael Shalayeff.
 * 4. The name of the author may not be used to endorse or promote products
 *    derived from this software without specific prior written permission.
@


1.21
log
@First lba support in /boot.  Not complete lba boot support, but it's the
first step on the way there.  Ok deraadt@@, espie@@, todd@@, and others.
@
text
@d1 1
a1 1
/*	$OpenBSD: conf.c,v 1.20 2003/04/17 03:43:18 drahn Exp $	*/
a48 1
#include <lib/libsa/exec.h>
@


1.20
log
@i386 ELF bootloader. developed with weingart@@
@
text
@d1 1
a1 1
/*	$OpenBSD: conf.c,v 1.19 2002/06/21 21:02:57 weingart Exp $	*/
d51 1
a51 1
const char version[] = "2.00";
@


1.19
log
@Bump version to help distinquish new memory probe and fixes.
@
text
@d1 1
a1 1
/*	$OpenBSD: conf.c,v 1.18 2001/08/20 20:44:49 mickey Exp $	*/
d51 1
a51 1
const char version[] = "1.29";
a53 4
const struct x_sw execsw[] = {
	{ "aout", aout_probe, aout_load, aout_ldsym },
	{ "",     NULL,       NULL,      NULL       },
};
@


1.18
log
@bump the version for new kbd probe; 10x for a reminder from fgsch@@
@
text
@d1 1
a1 1
/*	$OpenBSD: conf.c,v 1.17 2001/05/06 17:45:08 mickey Exp $	*/
d51 1
a51 1
const char version[] = "1.28";
@


1.18.4.1
log
@sync to -current
@
text
@d1 1
a1 1
/*	$OpenBSD: conf.c,v 1.18 2001/08/20 20:44:49 mickey Exp $	*/
d51 1
a51 1
const char version[] = "1.29";
@


1.18.4.2
log
@sync
@
text
@d1 1
a1 1
/*	$OpenBSD$	*/
d51 1
a51 1
const char version[] = "2.00";
d54 4
@


1.17
log
@increase version since we've removed -b; per fgsch@@'s suggestion
@
text
@d1 1
a1 1
/*	$OpenBSD: conf.c,v 1.16 2000/10/25 17:11:58 mickey Exp $	*/
d51 1
a51 1
const char version[] = "1.27";
@


1.16
log
@add pciprobe back into /boot.
it appears there are machines only equipped w/ real-mode pci bios.
int time, we will benefit from this the other way around, --
we'll elliminate pci bios _calls_ in kernel instead.
@
text
@d1 1
a1 1
/*	$OpenBSD: conf.c,v 1.15 2000/10/19 17:15:26 fgsch Exp $	*/
d51 1
a51 1
const char version[] = "1.26";
@


1.15
log
@Increment version; deraadt@@ ok.
@
text
@d1 1
a1 1
/*	$OpenBSD: conf.c,v 1.14 2000/05/30 22:00:24 mickey Exp $	*/
d51 1
a51 1
const char version[] = "1.25";
@


1.14
log
@aout_ldsym, increase boot minor version
@
text
@d1 1
a1 1
/*	$OpenBSD: conf.c,v 1.13 1998/07/20 18:14:52 mickey Exp $	*/
d51 1
a51 1
const char version[] = "1.24";
@


1.13
log
@new exec framework
@
text
@d1 1
a1 1
/*	$OpenBSD: conf.c,v 1.12 1998/04/18 07:39:37 deraadt Exp $	*/
d51 2
a52 2
const char version[] = "1.23";
int	debug;
d55 2
a56 2
	{ "aout", aout_probe,	aout_load },
	{ "",     NULL,		NULL },
@


1.13.8.1
log
@Update the SMP branch to -current, this breaks the SMP branch though.
But it will be fixed soonish.  Note, nothing new has happened, this is just
a merge of the trunk into this branch.
@
text
@d1 1
a1 1
/*	$OpenBSD: conf.c,v 1.16 2000/10/25 17:11:58 mickey Exp $	*/
d51 2
a52 2
const char version[] = "1.26";
int	debug = 1;
d55 2
a56 2
	{ "aout", aout_probe, aout_load, aout_ldsym },
	{ "",     NULL,       NULL,      NULL       },
@


1.13.8.2
log
@Merge in -current from two days ago in the SMP branch.
As usual with merges, they do not indicate progress, so do not hold
your breath for working SMP, and do not mail me and ask about the
state of it.  It has not changed.  There is work ongoing, but very, very
slowly.  The commit is done in parts as to not lock up the tree in too
big chunks at a time.
@
text
@d1 1
a1 1
/*	$OpenBSD: conf.c,v 1.13.8.1 2001/04/18 16:08:40 niklas Exp $	*/
d51 1
a51 1
const char version[] = "1.27";
@


1.13.8.3
log
@Sync the SMP branch to something just after 3.0
@
text
@d1 1
a1 1
/*	$OpenBSD: conf.c,v 1.13.8.2 2001/07/04 10:18:11 niklas Exp $	*/
d51 1
a51 1
const char version[] = "1.28";
@


1.13.8.4
log
@Sync the SMP branch with 3.3
@
text
@d1 1
a1 1
/*	$OpenBSD$	*/
d51 1
a51 1
const char version[] = "1.29";
@


1.13.8.5
log
@Sync the SMP branch to -current, plus some ELF-related fixes.
@
text
@d1 1
a1 1
/*	$OpenBSD: conf.c,v 1.13.8.4 2003/03/27 23:26:56 niklas Exp $	*/
d51 1
a51 1
const char version[] = "2.00";
d54 4
@


1.13.8.6
log
@Sync SMP branch to -current
@
text
@d1 1
a1 1
/*	$OpenBSD: conf.c,v 1.13.8.5 2003/05/13 19:42:09 ho Exp $	*/
d15 5
d49 1
d51 1
a51 1
const char version[] = "2.01";
@


1.13.8.7
log
@Merge of current from two weeks agointo the SMP branch
@
text
@d1 1
a1 1
/*	$OpenBSD$	*/
d45 1
a45 1
const char version[] = "2.05";
@


1.13.8.8
log
@Merge with the trunk
@
text
@a43 1
#include "debug.h"
d45 1
a45 1
const char version[] = "2.06";
a48 18
void (*sa_cleanup)(void) = NULL;


void (*i386_probe1[])(void) = {
	ps2probe, gateA20on, debug_init, cninit,
	apmprobe, pciprobe, /* smpprobe, */ memprobe
};
void (*i386_probe2[])(void) = {
 	diskprobe
};

struct i386_boot_probes probe_list[] = {
	{ "probing", i386_probe1, NENTS(i386_probe1) },
	{ "disk",    i386_probe2, NENTS(i386_probe2) }
};
int nibprobes = NENTS(probe_list);


d96 1
@


1.12
log
@i386 bootblocks that work for 2.3. A tale too long to tell
@
text
@d1 1
a1 1
/*	$OpenBSD: conf.c,v 1.11 1998/02/24 22:06:40 weingart Exp $	*/
d49 1
d54 5
d65 2
a68 2
	{ nfs_open,    nfs_close,    nfs_read,    nfs_write,    nfs_seek,
	  nfs_stat,    nfs_readdir    },
a95 1
struct consdev *cn_tab = &constab[0];
d105 1
@


1.11
log
@Changes/updates to /boot stuff.  More to come.
Fixes many divide by zero and pointer bugs.
@
text
@d1 1
a1 1
/*	$OpenBSD: conf.c,v 1.10 1997/10/26 23:22:09 mickey Exp $	*/
d50 1
a50 1
const char version[] = "1.20";
@


1.10
log
@we have new features, bump boot version
@
text
@d1 1
a1 1
/*	$OpenBSD: conf.c,v 1.9 1997/10/17 15:03:18 weingart Exp $	*/
d50 1
a50 1
const char version[] = "1.06";
@


1.9
log
@Use BIOS to probe for memory map.
Probe for BIOS supported disks.
Use BIOS to get geometry for supported disks.

All in preparation to passing the whole thing
to the kernel.
@
text
@d1 1
a1 1
/*	$OpenBSD: conf.c,v 1.8 1997/09/29 22:59:03 mickey Exp $	*/
d50 1
a50 1
const char version[] = "1.05";
@


1.8
log
@bump the version number
@
text
@d1 1
a1 1
/*	$OpenBSD: conf.c,v 1.7 1997/09/02 21:18:13 mickey Exp $	*/
d50 1
a50 1
const char version[] = "1.01";
@


1.7
log
@completely disable network support
@
text
@d1 1
a1 1
/*	$OpenBSD: conf.c,v 1.6 1997/08/13 14:24:00 niklas Exp $	*/
d50 1
a50 1
const char version[] = "0.99a";
@


1.6
log
@s/kbd/pc/ for consistency with kernel.  Do even better __asms for BIOS calls.
Adapt to new console probing and setting API.  Do not try to probe pc0 via
the NVRAM.  Fix some other buglets.
@
text
@d1 1
a1 1
/*	$OpenBSD: conf.c,v 1.5 1997/08/12 21:46:52 mickey Exp $	*/
d39 1
a39 1
#include <lib/libsa/nfs.h>
a40 1
#ifdef notdef
d42 1
d44 1
a45 1
#include <lib/libsa/netif.h>
a60 2
#endif
#ifndef NO_NET
d83 1
a83 1
#ifndef NO_NET
@


1.5
log
@new cons
@
text
@d1 1
a1 1
/*	$OpenBSD: conf.c,v 1.4 1997/07/17 23:11:19 mickey Exp $	*/
d97 1
a97 1
	{ kbd_probe, kbd_init, kbd_getc, kbd_putc  },
@


1.4
log
@proper includes
add const for consw declarations
@
text
@d1 1
a1 1
/*	$OpenBSD: conf.c,v 1.3 1997/03/31 23:06:22 mickey Exp $	*/
d48 1
d51 1
a51 1
int	debug = 1;
d92 2
a93 1
const struct consw	consw[] = {
d95 1
a95 1
	{ "unix",unix_probe,unix_putc,unix_getc,unix_ischar},
d97 2
a98 5
	{ "kbd",  kbd_probe,  kbd_putc,  kbd_getc,  kbd_ischar  },
	{ "com0", com0_probe, com0_putc, com0_getc, com0_ischar },
	{ "com1", com1_probe, com1_putc, com1_getc, com1_ischar },
	{ "com2", com2_probe, com2_putc, com2_getc, com2_ischar },
	{ "com3", com3_probe, com3_putc, com3_getc, com3_ischar },
d100 1
a101 1
const int ncons = NENTS(consw);
@


1.3
log
@commit all my mods to the last imported libsa stuff....
including:
- disklabel support;
- better boot cmd line
- smaller size (using some compilation switches ;)
- no more relocations in /boot, it's loaded in the place;
- better disk performance (maybe were already in there)
- installboot -n does not require write perms for device
- more debugs
- missing parts in libsa (such as cd9660 and so)
- i don't like 2 files for exec_i386 (sorry, toby, let's discuss maybe?)
tricks and tails:
- joined .text and .data (saves you a page)
- prot mode switching still in biosboot (it's freezed for awhile)
- biosdisk internals changed
- biosdev is not passed propery to the kernel (i'll fix it soon)
- sure i missed smth here to note (use the source, Luke!)
@
text
@d1 1
a1 1
/*	$OpenBSD: conf.c,v 1.1.2.3 1997/02/15 23:27:50 mickey Exp $	*/
d38 3
a40 3
#include <ufs.h>
#include <nfs.h>
#include <cd9660.h>
d42 2
a43 2
#include <fat.h>
#include <tftp.h>
d45 3
a47 3
#include <netif.h>
#include "biosdev.h"
#include "unixdev.h"
d82 1
a82 1
int	ndevs = NENTS(devsw);
d91 1
a91 1
struct consw	consw[] = {
d95 5
a99 4
	{ "kbd", kbd_probe, kbd_putc, kbd_getc, kbd_ischar },
#if 0
	{ "com", com_probe, com_putc, com_getc, com_ischar },
#endif
d102 1
a102 1
int	ncons = NENTS(consw);
@


1.2
log
@Initial /boot stuff (from Mickey)
@
text
@d41 4
d49 1
d78 3
d96 1
d98 1
@


1.1
log
@file conf.c was initially added on branch new.
@
text
@d1 92
@


1.1.2.1
log
@new hierarchy. raw /boot loading, just 1(one) boot stage.
@
text
@a0 72
/*	$OpenBSD: conf.c,v 1.1.2.2 1996/10/29 10:27:38 mickey Exp $	*/

/*
 * Copyright (c) 1996 Michael Shalayeff
 * All rights reserved.
 *
 * Redistribution and use in source and binary forms, with or without
 * modification, are permitted provided that the following conditions
 * are met:
 * 1. Redistributions of source code must retain the above copyright
 *    notice, this list of conditions and the following disclaimer.
 * 2. Redistributions in binary form must reproduce the above copyright
 *    notice, this list of conditions and the following disclaimer in the
 *    documentation and/or other materials provided with the distribution.
 * 3. All advertising materials mentioning features or use of this software
 *    must display the following acknowledgement:
 *	This product includes software developed by Michael Shalayeff.
 * 4. The name of the author may not be used to endorse or promote products
 *    derived from this software without specific prior written permission.
 *
 * THIS SOFTWARE IS PROVIDED BY THE AUTHOR ``AS IS'' AND ANY EXPRESS OR 
 * IMPLIED WARRANTIES, INCLUDING, BUT NOT LIMITED TO, THE IMPLIED 
 * WARRANTIES OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE
 * ARE DISCLAIMED.  IN NO EVENT SHALL THE REGENTS OR CONTRIBUTORS BE LIABLE
 * FOR ANY DIRECT, INDIRECT, INCIDENTAL, SPECIAL, EXEMPLARY, OR CONSEQUENTIAL
 * DAMAGES (INCLUDING, BUT NOT LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS
 * OR SERVICES; LOSS OF USE, DATA, OR PROFITS; OR BUSINESS INTERRUPTION)
 * HOWEVER CAUSED AND ON ANY THEORY OF LIABILITY, WHETHER IN CONTRACT, STRICT
 * LIABILITY, OR TORT (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY
 * OUT OF THE USE OF THIS SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF
 * SUCH DAMAGE.
 *
 */

#include <sys/types.h>
#include <netinet/in.h>
#include <libsa.h>
#include <ufs.h>
#include <nfs.h>
#include <netif.h>
#include "biosdev.h"

int	debug = 1;

struct fs_ops file_system[] = {
	{ ufs_open,  ufs_close,  ufs_read,  ufs_write,  ufs_seek,
	  ufs_stat,  ufs_readdir  },
	{ nfs_open,  nfs_close,  nfs_read,  nfs_write,  nfs_seek,
	  nfs_stat,  nfs_readdir  },
	{ null_open, null_close, null_read, null_write, null_seek,
	  null_stat, null_readdir }
};
int nfsys = NENTS(file_system);

struct devsw	devsw[] = {
	{ "BIOS", biosstrategy, biosopen, biosclose, biosioctl },
	{ NULL, NULL, NULL, NULL, NULL }
};
int	ndevsw = NENTS(devsw);

struct netif_driver	*netif_drivers[] = {
	NULL
};
int n_netif_drivers = NENTS(netif_drivers);


struct consw	consw[] = {
	{ "kbd", kbd_probe, kbd_putc, kbd_getc, kbd_ischar },
	{ "com", com_probe, com_putc, com_getc, com_ischar }
};
int	ncons = NENTS(consw);

@


1.1.2.2
log
@protected mode problems fixed for biosboot (now it works!!!)
libsa.a(cd9660.o) requires libkern.a -- removed from conf.c
installboot changed according to the biosboot changes.
-Wall in libsa/Makefile, cleanup!
@
text
@d1 1
a1 1
/*	$OpenBSD: conf.c,v 1.1.2.1 1996/12/03 13:17:00 mickey Exp $	*/
a39 2
#include <cd9660.h>
#include <fat.h>
d46 6
a51 12
	{ ufs_open,    ufs_close,    ufs_read,    ufs_write,    ufs_seek,
	  ufs_stat,    ufs_readdir    },
#ifdef notdef
	{ fat_open,    fat_close,    fat_read,    fat_write,    fat_seek,
	  fat_stat,    fat_readdir    },
	{ cd9660_open, cd9660_close, cd9660_read, cd9660_write, cd9660_seek,
	  cd9660_stat, cd9660_readdir },
#endif
	{ nfs_open,    nfs_close,    nfs_read,    nfs_write,    nfs_seek,
	  nfs_stat,    nfs_readdir    },
	{ null_open,   null_close,   null_read,   null_write,   null_seek,
	  null_stat,   null_readdir   }
@


1.1.2.3
log
@we've got test/debug suite
@
text
@d1 1
a1 1
/*	$OpenBSD: conf.c,v 1.1.2.2 1996/12/15 15:49:36 mickey Exp $	*/
a43 1
#include "unixdev.h"
a52 1
#endif
d55 1
a55 1
#ifndef NO_NET
a57 1
#endif
a63 3
#ifdef _TEST
	{ "UNIX", unixstrategy, unixopen, unixclose, unixioctl },
#else
d65 1
a65 1
#endif
d67 1
a67 1
int	ndevs = NENTS(devsw);
a68 1
#ifndef NO_NET
d73 1
a73 1
#endif
a75 3
#ifdef _TEST
	{ "unix",unix_probe,unix_putc,unix_getc,unix_ischar},
#else
d77 1
a77 2
	{ "com", com_probe, com_putc, com_getc, com_ischar },
#endif
@

