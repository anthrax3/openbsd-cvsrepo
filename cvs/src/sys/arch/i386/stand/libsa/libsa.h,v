head	1.45;
access;
symbols
	OPENBSD_6_2_BASE:1.45
	OPENBSD_6_1:1.45.0.30
	OPENBSD_6_1_BASE:1.45
	OPENBSD_6_0:1.45.0.26
	OPENBSD_6_0_BASE:1.45
	OPENBSD_5_9:1.45.0.22
	OPENBSD_5_9_BASE:1.45
	OPENBSD_5_8:1.45.0.24
	OPENBSD_5_8_BASE:1.45
	OPENBSD_5_7:1.45.0.16
	OPENBSD_5_7_BASE:1.45
	OPENBSD_5_6:1.45.0.20
	OPENBSD_5_6_BASE:1.45
	OPENBSD_5_5:1.45.0.18
	OPENBSD_5_5_BASE:1.45
	OPENBSD_5_4:1.45.0.14
	OPENBSD_5_4_BASE:1.45
	OPENBSD_5_3:1.45.0.12
	OPENBSD_5_3_BASE:1.45
	OPENBSD_5_2:1.45.0.10
	OPENBSD_5_2_BASE:1.45
	OPENBSD_5_1_BASE:1.45
	OPENBSD_5_1:1.45.0.8
	OPENBSD_5_0:1.45.0.6
	OPENBSD_5_0_BASE:1.45
	OPENBSD_4_9:1.45.0.4
	OPENBSD_4_9_BASE:1.45
	OPENBSD_4_8:1.45.0.2
	OPENBSD_4_8_BASE:1.45
	OPENBSD_4_7:1.44.0.10
	OPENBSD_4_7_BASE:1.44
	OPENBSD_4_6:1.44.0.12
	OPENBSD_4_6_BASE:1.44
	OPENBSD_4_5:1.44.0.8
	OPENBSD_4_5_BASE:1.44
	OPENBSD_4_4:1.44.0.6
	OPENBSD_4_4_BASE:1.44
	OPENBSD_4_3:1.44.0.4
	OPENBSD_4_3_BASE:1.44
	OPENBSD_4_2:1.44.0.2
	OPENBSD_4_2_BASE:1.44
	OPENBSD_4_1:1.43.0.2
	OPENBSD_4_1_BASE:1.43
	OPENBSD_4_0:1.42.0.10
	OPENBSD_4_0_BASE:1.42
	OPENBSD_3_9:1.42.0.8
	OPENBSD_3_9_BASE:1.42
	OPENBSD_3_8:1.42.0.6
	OPENBSD_3_8_BASE:1.42
	OPENBSD_3_7:1.42.0.4
	OPENBSD_3_7_BASE:1.42
	OPENBSD_3_6:1.42.0.2
	OPENBSD_3_6_BASE:1.42
	SMP_SYNC_A:1.39
	SMP_SYNC_B:1.39
	OPENBSD_3_5:1.39.0.2
	OPENBSD_3_5_BASE:1.39
	OPENBSD_3_4:1.38.0.2
	OPENBSD_3_4_BASE:1.38
	UBC_SYNC_A:1.37
	OPENBSD_3_3:1.35.0.4
	OPENBSD_3_3_BASE:1.35
	OPENBSD_3_2:1.35.0.2
	OPENBSD_3_2_BASE:1.35
	OPENBSD_3_1:1.34.0.2
	OPENBSD_3_1_BASE:1.34
	UBC_SYNC_B:1.35
	UBC:1.33.0.4
	UBC_BASE:1.33
	OPENBSD_3_0:1.33.0.2
	OPENBSD_3_0_BASE:1.33
	OPENBSD_2_9:1.32.0.4
	OPENBSD_2_9_BASE:1.32
	OPENBSD_2_8:1.32.0.2
	OPENBSD_2_8_BASE:1.32
	OPENBSD_2_7:1.30.0.2
	OPENBSD_2_7_BASE:1.30
	SMP:1.29.0.4
	SMP_BASE:1.29
	kame_19991208:1.29
	OPENBSD_2_6:1.29.0.2
	OPENBSD_2_6_BASE:1.29
	OPENBSD_2_5:1.28.0.4
	OPENBSD_2_5_BASE:1.28
	OPENBSD_2_4:1.28.0.2
	OPENBSD_2_4_BASE:1.28
	OPENBSD_2_3:1.24.0.2
	OPENBSD_2_3_BASE:1.24
	OPENBSD_2_2:1.22.0.2
	OPENBSD_2_2_BASE:1.22
	OPENBSD_2_1:1.7.0.2
	OPENBSD_2_1_BASE:1.7;
locks; strict;
comment	@ * @;


1.45
date	2010.07.02.00.36.52;	author weingart;	state Exp;
branches;
next	1.44;

1.44
date	2007.04.27.10.08.34;	author tom;	state Exp;
branches;
next	1.43;

1.43
date	2006.09.18.21.14.15;	author mpf;	state Exp;
branches;
next	1.42;

1.42
date	2004.08.21.19.09.42;	author tom;	state Exp;
branches;
next	1.41;

1.41
date	2004.06.26.05.19.37;	author tom;	state Exp;
branches;
next	1.40;

1.40
date	2004.06.23.00.21.49;	author tom;	state Exp;
branches;
next	1.39;

1.39
date	2004.03.19.13.48.18;	author tom;	state Exp;
branches;
next	1.38;

1.38
date	2003.06.03.20.22.12;	author mickey;	state Exp;
branches;
next	1.37;

1.37
date	2003.04.17.12.06.06;	author mickey;	state Exp;
branches;
next	1.36;

1.36
date	2003.04.17.03.43.19;	author drahn;	state Exp;
branches;
next	1.35;

1.35
date	2002.06.20.20.22.58;	author weingart;	state Exp;
branches;
next	1.34;

1.34
date	2002.03.14.01.26.34;	author millert;	state Exp;
branches;
next	1.33;

1.33
date	2001.08.18.15.34.17;	author mickey;	state Exp;
branches
	1.33.4.1;
next	1.32;

1.32
date	2000.10.25.18.45.53;	author mickey;	state Exp;
branches;
next	1.31;

1.31
date	2000.10.09.20.37.19;	author mickey;	state Exp;
branches;
next	1.30;

1.30
date	2000.03.05.18.40.59;	author niklas;	state Exp;
branches;
next	1.29;

1.29
date	99.08.25.00.54.19;	author mickey;	state Exp;
branches
	1.29.4.1;
next	1.28;

1.28
date	98.07.20.18.14.57;	author mickey;	state Exp;
branches;
next	1.27;

1.27
date	98.07.13.04.03.26;	author mickey;	state Exp;
branches;
next	1.26;

1.26
date	98.07.08.19.28.53;	author mickey;	state Exp;
branches;
next	1.25;

1.25
date	98.05.25.19.20.56;	author mickey;	state Exp;
branches;
next	1.24;

1.24
date	98.02.24.22.06.54;	author weingart;	state Exp;
branches;
next	1.23;

1.23
date	97.11.30.21.51.44;	author mickey;	state Exp;
branches;
next	1.22;

1.22
date	97.10.24.22.22.57;	author mickey;	state Exp;
branches;
next	1.21;

1.21
date	97.10.22.23.34.39;	author mickey;	state Exp;
branches;
next	1.20;

1.20
date	97.10.18.00.33.16;	author weingart;	state Exp;
branches;
next	1.19;

1.19
date	97.10.17.18.46.57;	author weingart;	state Exp;
branches;
next	1.18;

1.18
date	97.10.17.15.03.26;	author weingart;	state Exp;
branches;
next	1.17;

1.17
date	97.09.17.17.56.10;	author mickey;	state Exp;
branches;
next	1.16;

1.16
date	97.09.02.20.58.16;	author mickey;	state Exp;
branches;
next	1.15;

1.15
date	97.08.22.20.13.43;	author mickey;	state Exp;
branches;
next	1.14;

1.14
date	97.08.21.22.04.33;	author mickey;	state Exp;
branches;
next	1.13;

1.13
date	97.08.13.03.35.08;	author mickey;	state Exp;
branches;
next	1.12;

1.12
date	97.08.13.03.28.12;	author mickey;	state Exp;
branches;
next	1.11;

1.11
date	97.08.05.17.45.56;	author mickey;	state Exp;
branches;
next	1.10;

1.10
date	97.08.04.21.53.35;	author mickey;	state Exp;
branches;
next	1.9;

1.9
date	97.07.21.15.32.13;	author mickey;	state Exp;
branches;
next	1.8;

1.8
date	97.07.17.23.15.49;	author mickey;	state Exp;
branches;
next	1.7;

1.7
date	97.05.01.04.10.39;	author mickey;	state Exp;
branches;
next	1.6;

1.6
date	97.04.30.18.33.12;	author weingart;	state Exp;
branches;
next	1.5;

1.5
date	97.04.15.20.50.36;	author mickey;	state Exp;
branches;
next	1.4;

1.4
date	97.04.06.19.52.46;	author mickey;	state Exp;
branches;
next	1.3;

1.3
date	97.03.31.23.06.29;	author mickey;	state Exp;
branches;
next	1.2;

1.2
date	97.03.31.03.12.14;	author weingart;	state Exp;
branches;
next	1.1;

1.1
date	96.10.29.09.23.09;	author mickey;	state dead;
branches
	1.1.2.1;
next	;

1.1.2.1
date	96.10.29.09.23.10;	author mickey;	state Exp;
branches;
next	;

1.29.4.1
date	2000.03.24.09.07.49;	author niklas;	state Exp;
branches;
next	1.29.4.2;

1.29.4.2
date	2001.04.18.16.08.44;	author niklas;	state Exp;
branches;
next	1.29.4.3;

1.29.4.3
date	2001.10.31.03.01.13;	author nate;	state Exp;
branches;
next	1.29.4.4;

1.29.4.4
date	2002.03.28.10.31.05;	author niklas;	state Exp;
branches;
next	1.29.4.5;

1.29.4.5
date	2003.03.27.23.26.56;	author niklas;	state Exp;
branches;
next	1.29.4.6;

1.29.4.6
date	2003.05.13.19.42.09;	author ho;	state Exp;
branches;
next	1.29.4.7;

1.29.4.7
date	2003.06.07.11.11.38;	author ho;	state Exp;
branches;
next	1.29.4.8;

1.29.4.8
date	2004.06.05.23.09.01;	author niklas;	state Exp;
branches;
next	;

1.33.4.1
date	2002.06.11.03.35.55;	author art;	state Exp;
branches;
next	1.33.4.2;

1.33.4.2
date	2002.10.29.00.28.04;	author art;	state Exp;
branches;
next	1.33.4.3;

1.33.4.3
date	2003.05.19.21.45.12;	author tedu;	state Exp;
branches;
next	;


desc
@@


1.45
log
@Add ability to limit memory presented to kernel with
'machine memory =128M' style commands.  Thanks to
phessler for finding a small man page niggle.  Bumped
version strings to a nice round fraction, and make them
the same across the board.  Easier to identify boot
binary versions that way.

ok thib@@, tedu@@, phessler@@
@
text
@/*	$OpenBSD: libsa.h,v 1.44 2007/04/27 10:08:34 tom Exp $	*/

/*
 * Copyright (c) 1996-1999 Michael Shalayeff
 * All rights reserved.
 *
 * Redistribution and use in source and binary forms, with or without
 * modification, are permitted provided that the following conditions
 * are met:
 * 1. Redistributions of source code must retain the above copyright
 *    notice, this list of conditions and the following disclaimer.
 * 2. Redistributions in binary form must reproduce the above copyright
 *    notice, this list of conditions and the following disclaimer in the
 *    documentation and/or other materials provided with the distribution.
 *
 * THIS SOFTWARE IS PROVIDED BY THE AUTHOR ``AS IS'' AND ANY EXPRESS OR
 * IMPLIED WARRANTIES, INCLUDING, BUT NOT LIMITED TO, THE IMPLIED WARRANTIES
 * OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE ARE DISCLAIMED.
 * IN NO EVENT SHALL THE AUTHOR OR HIS RELATIVES BE LIABLE FOR ANY DIRECT,
 * INDIRECT, INCIDENTAL, SPECIAL, EXEMPLARY, OR CONSEQUENTIAL DAMAGES
 * (INCLUDING, BUT NOT LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR
 * SERVICES; LOSS OF MIND, USE, DATA, OR PROFITS; OR BUSINESS INTERRUPTION)
 * HOWEVER CAUSED AND ON ANY THEORY OF LIABILITY, WHETHER IN CONTRACT,
 * STRICT LIABILITY, OR TORT (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING
 * IN ANY WAY OUT OF THE USE OF THIS SOFTWARE, EVEN IF ADVISED OF
 * THE POSSIBILITY OF SUCH DAMAGE.
 */

#include <lib/libsa/stand.h>
#include <machine/biosvar.h>

#define	EXEC_ELF

#define	DEFAULT_KERNEL_ADDRESS	0

struct i386_boot_probes {
	char *name;
	void (**probes)(void);
	int count;
};

extern void (*sa_cleanup)(void);

void gateA20(int);
void gateA20on(void);

void cpuprobe(void);
void smpprobe(void);
void ps2probe(void);
void pciprobe(void);
void memprobe(void);
void diskprobe(void);
void cdprobe(void);
void apmprobe(void);
void apmfixmem(void);
void dump_biosmem(bios_memmap_t *);
int mem_add(long long, long long);
int mem_delete(long long, long long);
int mem_limit(long long);
void mem_pass(void);

void devboot(dev_t, char *);
void machdep(void);

void *getSYSCONFaddr(void);
void *getEBDAaddr(void);

extern const char bdevs[][4];
extern const int nbdevs;
extern u_int cnvmem, extmem; /* XXX global pass memprobe()->machdep_start() */
extern int ps2model;

extern struct i386_boot_probes probe_list[];
extern int nibprobes;
extern void (*devboot_p)(dev_t, char *);

/* diskprobe.c */
extern bios_diskinfo_t bios_diskinfo[];
extern u_int32_t bios_cksumlen;

#define MACHINE_CMD	cmd_machine /* we have i386-specific commands */

#define CHECK_SKIP_CONF	check_skip_conf	/* we can skip boot.conf with Ctrl */
@


1.44
log
@Check for Control key held down when starting, and don't read boot.conf
if it is.  This gives a way to recover from "switching to com0" when
there's no serial cable handy.

Bump version numbers.

A similar change will be made to amd64 boot soon.

ok toby@@ deraadt@@
@
text
@d1 1
a1 1
/*	$OpenBSD: libsa.h,v 1.43 2006/09/18 21:14:15 mpf Exp $	*/
d59 1
@


1.43
log
@boot(8) ``machine memory'' support for > 4G.
Convert parser to strtoll(3) and use 64bit printf.
With help from mickey@@
i386 and amd64 tests by me, alpha test by mickey@@
OK mickey@@, miod@@, deraadt@@
@
text
@d1 1
a1 1
/*	$OpenBSD: libsa.h,v 1.42 2004/08/21 19:09:42 tom Exp $	*/
d81 2
@


1.42
log
@Fix typo in comment
@
text
@d1 1
a1 1
/*	$OpenBSD: libsa.h,v 1.41 2004/06/26 05:19:37 tom Exp $	*/
d57 2
a58 2
int mem_add(long, long);
int mem_delete(long, long);
@


1.41
log
@Initial stab at CPU identification code for i386 boot programs.  Added
to i386 libsa, but not yet used by boot etc.

ok weingart@@
@
text
@d1 1
a1 1
/*	$OpenBSD: libsa.h,v 1.40 2004/06/23 00:21:49 tom Exp $	*/
d80 1
a80 1
#define MACHINE_CMD	cmd_machine /* we have i386 specific sommands */
@


1.40
log
@Enter cdboot, a CD-specific second-stage bootrap.

Testing krw@@ and todd@@, thanks.

assistance, testing and ok weingart@@
@
text
@d1 1
a1 1
/*	$OpenBSD: libsa.h,v 1.39 2004/03/19 13:48:18 tom Exp $	*/
d47 1
@


1.39
log
@Enter pxeboot, derived from the NetBSD implementation.  Initially
intended to support network installs using bsd.rd over TFTP.

Thanks to the many who tested, including Diana Eichert.

ok deraadt@@
@
text
@d1 1
a1 1
/*	$OpenBSD: libsa.h,v 1.38 2003/06/03 20:22:12 mickey Exp $	*/
d52 1
@


1.38
log
@three four kills
@
text
@d1 1
a1 1
/*	$OpenBSD: libsa.h,v 1.37 2003/04/17 12:06:06 mickey Exp $	*/
d36 8
d45 1
d48 1
d69 4
@


1.37
log
@there is no reason to keep both around. just rename
@
text
@d1 1
a1 1
/*	$OpenBSD: libsa.h,v 1.36 2003/04/17 03:43:19 drahn Exp $	*/
a14 5
 * 3. All advertising materials mentioning features or use of this software
 *    must display the following acknowledgement:
 *      This product includes software developed by Michael Shalayeff.
 * 4. The name of the author may not be used to endorse or promote products
 *    derived from this software without specific prior written permission.
@


1.36
log
@i386 ELF bootloader. developed with weingart@@
@
text
@d1 1
a1 1
/*	$OpenBSD: libsa.h,v 1.35 2002/06/20 20:22:58 weingart Exp $	*/
d39 1
a39 1
#define	DEFAULT_KERNEL_ADDRESS	0x100000
@


1.35
log
@Fix 4GB memory probing and other memory probing issues.
Outstanding issue is with Compaq 16MB detection problem.
ok deraadt@@, and various people from the 'net.
@
text
@d1 1
a1 1
/*	$OpenBSD: libsa.h,v 1.34 2002/03/14 01:26:34 millert Exp $	*/
d37 1
a37 1
#define	EXEC_AOUT
@


1.34
log
@First round of __P removal in sys
@
text
@d1 1
a1 1
/*	$OpenBSD: libsa.h,v 1.33 2001/08/18 15:34:17 mickey Exp $	*/
d48 1
a48 1
void apmcheck(void);
d56 3
@


1.33
log
@probe for ps2 model and check if kbd controller is present
for deciding on a20 method to use.
based on csapuntz@@'s info provided.
@
text
@d1 1
a1 1
/*	$OpenBSD: libsa.h,v 1.32 2000/10/25 18:45:53 mickey Exp $	*/
d41 1
a41 1
void gateA20 __P((int));
d43 10
a52 10
void smpprobe __P((void));
void pciprobe __P((void));
void memprobe __P((void));
void diskprobe __P((void));
void apmprobe __P((void));
void apmcheck __P((void));
void dump_biosmem __P((bios_memmap_t *));
int mem_add __P((long, long));
int mem_delete __P((long, long));
void mem_pass __P((void));
d54 2
a55 2
void devboot __P((dev_t, char *));
void machdep __P((void));
@


1.33.4.1
log
@Sync UBC branch to -current
@
text
@d1 1
a1 1
/*	$OpenBSD: libsa.h,v 1.33 2001/08/18 15:34:17 mickey Exp $	*/
d41 1
a41 1
void gateA20(int);
d43 10
a52 10
void smpprobe(void);
void pciprobe(void);
void memprobe(void);
void diskprobe(void);
void apmprobe(void);
void apmcheck(void);
void dump_biosmem(bios_memmap_t *);
int mem_add(long, long);
int mem_delete(long, long);
void mem_pass(void);
d54 2
a55 2
void devboot(dev_t, char *);
void machdep(void);
@


1.33.4.2
log
@sync to -current
@
text
@d1 1
a1 1
/*	$OpenBSD: libsa.h,v 1.33.4.1 2002/06/11 03:35:55 art Exp $	*/
d48 1
a48 1
void apmfixmem(void);
a55 3

void *getSYSCONFaddr(void);
void *getEBDAaddr(void);
@


1.33.4.3
log
@sync
@
text
@d1 1
a1 1
/*	$OpenBSD$	*/
d37 1
a37 1
#define	EXEC_ELF
d39 1
a39 1
#define	DEFAULT_KERNEL_ADDRESS	0
@


1.32
log
@some people may say that i suck
@
text
@d1 1
a1 1
/*	$OpenBSD: libsa.h,v 1.31 2000/10/09 20:37:19 mickey Exp $	*/
d60 1
@


1.31
log
@pcibios kernel device is now doing this job
@
text
@d1 1
a1 1
/*	$OpenBSD: libsa.h,v 1.30 2000/03/05 18:40:59 niklas Exp $	*/
d44 1
@


1.30
log
@D not forget our memmap changes, ok mickey@@
@
text
@d1 1
a1 1
/*	$OpenBSD: libsa.h,v 1.29 1999/08/25 00:54:19 mickey Exp $	*/
a47 1
void pciprobe __P((void));
@


1.29
log
@give better support to the bios memory maps.
provide memory maps editing through the machine memory command.
rearrange probing in machdep, so it provides less output,
also giving a shot for apm to fix the memory maps.
changes to kernel are minimal, only that is required due
to the api version bits addition and such cosmetic changes.
tested on all critical kernel,boot combinations; niklas@@ ok
@
text
@d1 1
a1 1
/*	$OpenBSD: libsa.h,v 1.28 1998/07/20 18:14:57 mickey Exp $	*/
d50 1
d52 1
a52 1
int mem_add __P((long, long));
@


1.29.4.1
log
@Sync with -current
@
text
@d1 1
a1 1
/*	$OpenBSD$	*/
d50 1
a51 2
int mem_delete __P((long, long));
void mem_pass __P((void));
@


1.29.4.2
log
@Update the SMP branch to -current, this breaks the SMP branch though.
But it will be fixed soonish.  Note, nothing new has happened, this is just
a merge of the trunk into this branch.
@
text
@d1 1
a1 1
/*	$OpenBSD: libsa.h,v 1.32 2000/10/25 18:45:53 mickey Exp $	*/
a43 1
void pciprobe __P((void));
d48 1
@


1.29.4.3
log
@Sync the SMP branch to something just after 3.0
@
text
@d1 1
a1 1
/*	$OpenBSD: libsa.h,v 1.29.4.2 2001/04/18 16:08:44 niklas Exp $	*/
a59 1
extern int ps2model;
@


1.29.4.4
log
@Merge in -current from about a week ago
@
text
@d1 1
a1 1
/*	$OpenBSD$	*/
d41 1
a41 1
void gateA20(int);
d43 10
a52 10
void smpprobe(void);
void pciprobe(void);
void memprobe(void);
void diskprobe(void);
void apmprobe(void);
void apmcheck(void);
void dump_biosmem(bios_memmap_t *);
int mem_add(long, long);
int mem_delete(long, long);
void mem_pass(void);
d54 2
a55 2
void devboot(dev_t, char *);
void machdep(void);
@


1.29.4.5
log
@Sync the SMP branch with 3.3
@
text
@d48 1
a48 1
void apmfixmem(void);
a55 3

void *getSYSCONFaddr(void);
void *getEBDAaddr(void);
@


1.29.4.6
log
@Sync the SMP branch to -current, plus some ELF-related fixes.
@
text
@d1 1
a1 1
/*	$OpenBSD: libsa.h,v 1.29.4.5 2003/03/27 23:26:56 niklas Exp $	*/
d37 1
a37 1
#define	EXEC_ELF
d39 1
a39 1
#define	DEFAULT_KERNEL_ADDRESS	0
@


1.29.4.7
log
@Sync SMP branch to -current
@
text
@d1 1
a1 1
/*	$OpenBSD: libsa.h,v 1.29.4.6 2003/05/13 19:42:09 ho Exp $	*/
d15 5
@


1.29.4.8
log
@Merge with the trunk
@
text
@d1 1
a1 1
/*	$OpenBSD$	*/
a35 8
struct i386_boot_probes {
	char *name;
	void (**probes)(void);
	int count;
};

extern void (*sa_cleanup)(void);

a36 1
void gateA20on(void);
a38 1
void ps2probe(void);
a58 4

extern struct i386_boot_probes probe_list[];
extern int nibprobes;
extern void (*devboot_p)(dev_t, char *);
@


1.28
log
@new exec framework
@
text
@d1 1
a1 1
/*	$OpenBSD: libsa.h,v 1.27 1998/07/13 04:03:26 mickey Exp $	*/
d4 1
a4 1
 * Copyright (c) 1996 Michael Shalayeff
d17 1
a17 1
 *	This product includes software developed by Michael Shalayeff.
d21 11
a31 12
 * THIS SOFTWARE IS PROVIDED BY THE AUTHOR ``AS IS'' AND ANY EXPRESS OR 
 * IMPLIED WARRANTIES, INCLUDING, BUT NOT LIMITED TO, THE IMPLIED 
 * WARRANTIES OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE
 * ARE DISCLAIMED.  IN NO EVENT SHALL THE REGENTS OR CONTRIBUTORS BE LIABLE
 * FOR ANY DIRECT, INDIRECT, INCIDENTAL, SPECIAL, EXEMPLARY, OR CONSEQUENTIAL
 * DAMAGES (INCLUDING, BUT NOT LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS
 * OR SERVICES; LOSS OF USE, DATA, OR PROFITS; OR BUSINESS INTERRUPTION)
 * HOWEVER CAUSED AND ON ANY THEORY OF LIABILITY, WHETHER IN CONTRACT, STRICT
 * LIABILITY, OR TORT (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY
 * OUT OF THE USE OF THIS SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF
 * SUCH DAMAGE.
 *
d47 1
d49 3
a63 4
/* memprobe.c */
extern bios_memmap_t *memory_map;

#ifndef _TEST
a64 1
#endif
@


1.27
log
@alloca() is in stand.h no
@
text
@d1 1
a1 1
/*	$OpenBSD: libsa.h,v 1.26 1998/07/08 19:28:53 mickey Exp $	*/
d37 2
@


1.26
log
@reflect MI boot changes; remove dead time_print() prototype
@
text
@d1 1
a1 1
/*	$OpenBSD: libsa.h,v 1.25 1998/05/25 19:20:56 mickey Exp $	*/
a48 1
void *alloca __P((size_t));
@


1.25
log
@put support for test /boot environment back; some CLEANFILES and spaces
@
text
@d1 1
a1 1
/*	$OpenBSD: libsa.h,v 1.24 1998/02/24 22:06:54 weingart Exp $	*/
d38 2
a50 1
void time_print __P((void));
@


1.24
log
@Changes/updates to /boot stuff.  More to come.
Fixes many divide by zero and pointer bugs.
@
text
@d1 1
a1 1
/*	$OpenBSD: libsa.h,v 1.23 1997/11/30 21:51:44 mickey Exp $	*/
d62 1
d64 1
@


1.23
log
@big diskinfo changes from toby@@
@
text
@d1 1
a1 1
/*	$OpenBSD: libsa.h,v 1.22 1997/10/24 22:22:57 mickey Exp $	*/
d44 1
@


1.22
log
@checksumming stuff from niklas
@
text
@d1 1
a1 1
/*	$OpenBSD: libsa.h,v 1.21 1997/10/22 23:34:39 mickey Exp $	*/
a51 1
extern int bootdev; /* XXX pass through the global to exec_i386 */
@


1.21
log
@newer, better stuff; some parts by toby@@
@
text
@d1 1
a1 1
/*	$OpenBSD: libsa.h,v 1.20 1997/10/18 00:33:16 weingart Exp $	*/
d57 1
@


1.20
log
@Copy in bios_diskinfo array from /boot space.
Add length field for checksum to same.
Start of making /boot deduce bsd dev_t for
all BIOS drives.
@
text
@d1 1
a1 1
/*	$OpenBSD: libsa.h,v 1.19 1997/10/17 18:46:57 weingart Exp $	*/
a49 3
bios_diskinfo_t *diskfind __P((int));


d54 6
@


1.19
log
@Cleanup, make it all compile.
Move APM stuff to apmprobe.c
@
text
@d1 1
a1 1
/*	$OpenBSD: libsa.h,v 1.18 1997/10/17 15:03:26 weingart Exp $	*/
d36 1
d39 1
d44 1
d49 3
@


1.18
log
@Use BIOS to probe for memory map.
Probe for BIOS supported disks.
Use BIOS to get geometry for supported disks.

All in preparation to passing the whole thing
to the kernel.
@
text
@d1 1
a1 1
/*	$OpenBSD: libsa.h,v 1.17 1997/09/17 17:56:10 mickey Exp $	*/
d41 1
a48 1
extern struct BIOS_MAP *memory_map;
@


1.17
log
@pass cnvmem,extmem the old way they were....
don't put 'em in biosvars
@
text
@d1 1
a1 1
/*	$OpenBSD: libsa.h,v 1.16 1997/09/02 20:58:16 mickey Exp $	*/
d38 1
d40 1
d48 1
@


1.16
log
@machine diskinfo command, toby is filling w/ meat at the moment
@
text
@d1 1
a1 1
/*	$OpenBSD: libsa.h,v 1.15 1997/08/22 20:13:43 mickey Exp $	*/
d47 1
@


1.15
log
@put values into BIOS_vars so kernel will get 'em soon
@
text
@d1 1
a1 1
/*	$OpenBSD: libsa.h,v 1.14 1997/08/21 22:04:33 mickey Exp $	*/
d48 1
@


1.14
log
@boothowto is local to boot
@
text
@d1 1
a1 1
/*	$OpenBSD: libsa.h,v 1.13 1997/08/13 03:35:08 mickey Exp $	*/
a41 1
int kentry __P((u_int, u_int));
a43 4
		/* XXX filled in assumption that last file opened is kernel */
extern int	bootdev, bootdev_geometry;
extern u_int	cnvmem, extmem;
extern struct apm_connect_info apminfo;
d46 2
@


1.13
log
@getsecs() is in stand.h
move time_print() into libsa.h
@
text
@d1 1
a1 1
/*	$OpenBSD: libsa.h,v 1.12 1997/08/13 03:28:12 mickey Exp $	*/
a44 1
extern int	boothowto;
@


1.12
log
@inline apm calls
@
text
@d1 1
a1 1
/*	$OpenBSD: libsa.h,v 1.11 1997/08/05 17:45:56 mickey Exp $	*/
d43 1
@


1.11
log
@kentry proto is in the libsa.h
change var name
@
text
@d1 1
a1 1
/*	$OpenBSD: libsa.h,v 1.10 1997/08/04 21:53:35 mickey Exp $	*/
a41 1
u_int apm_init __P((void));
@


1.10
log
@remember boot device geometry
@
text
@d1 1
a1 1
/*	$OpenBSD: libsa.h,v 1.9 1997/07/21 15:32:13 mickey Exp $	*/
d43 2
a44 1
 
@


1.9
log
@add nbdevs for the size of table of block devises' names
remove bogus codeseg
@
text
@d1 1
a1 1
/*	$OpenBSD: libsa.h,v 1.8 1997/07/17 23:15:49 mickey Exp $	*/
d43 1
a43 1

d46 1
a46 1
extern int	bootdev;
@


1.8
log
@proper includes
apm prototypes/declarations
some prototypes
@
text
@d1 1
a1 1
/*	$OpenBSD: libsa.h,v 1.7 1997/05/01 04:10:39 mickey Exp $	*/
a43 1
extern u_long	codeseg;
d49 2
a50 1
extern const char bdevs[19][4];
@


1.7
log
@alloca(size_t)
not int
@
text
@d1 1
a1 1
/*	$OpenBSD: libsa.h,v 1.6 1997/04/30 18:33:12 weingart Exp $	*/
d35 1
a35 1
#include <stand.h>
d41 2
d49 1
@


1.6
log
@Add missing prototype: alloca()
@
text
@d1 1
a1 1
/*	$OpenBSD: libsa.h,v 1.5 1997/04/15 20:50:36 mickey Exp $	*/
d40 1
a40 1
void *alloca __P((int));
@


1.5
log
@pass bootdev to kernel...
all the future devices have to copy it into global var...
in the current state i can boot any kernel i have....
testers?
@
text
@d1 1
a1 1
/*	$OpenBSD: libsa.h,v 1.4 1997/04/06 19:52:46 mickey Exp $	*/
d40 1
@


1.4
log
@devboot proto
@
text
@d1 1
a1 1
/*	$OpenBSD: libsa.h,v 1.3 1997/03/31 23:06:29 mickey Exp $	*/
d43 2
@


1.3
log
@commit all my mods to the last imported libsa stuff....
including:
- disklabel support;
- better boot cmd line
- smaller size (using some compilation switches ;)
- no more relocations in /boot, it's loaded in the place;
- better disk performance (maybe were already in there)
- installboot -n does not require write perms for device
- more debugs
- missing parts in libsa (such as cd9660 and so)
- i don't like 2 files for exec_i386 (sorry, toby, let's discuss maybe?)
tricks and tails:
- joined .text and .data (saves you a page)
- prot mode switching still in biosboot (it's freezed for awhile)
- biosdisk internals changed
- biosdev is not passed propery to the kernel (i'll fix it soon)
- sure i missed smth here to note (use the source, Luke!)
@
text
@d1 1
a1 1
/*	$OpenBSD: libsa.h,v 1.1.2.1 1996/10/29 09:23:10 mickey Exp $	*/
d39 1
@


1.2
log
@Initial /boot stuff (from Mickey)
@
text
@d37 2
a38 4
void startprog __P((char *addr, int argv[]));
void gateA20 __P((int on));
int memsize __P((int which));
int memprobe __P((void));
d40 1
a40 3
extern dev_t	bootdev, maj, unit, part;
extern u_long	cyloffset;
extern u_long	ourseg, esym;
d42 2
@


1.1
log
@file libsa.h was initially added on branch new.
@
text
@d1 45
@


1.1.2.1
log
@support libsa
@
text
@a0 42
/*	$OpenBSD$	*/

/*
 * Copyright (c) 1996 Michael Shalayeff
 * All rights reserved.
 *
 * Redistribution and use in source and binary forms, with or without
 * modification, are permitted provided that the following conditions
 * are met:
 * 1. Redistributions of source code must retain the above copyright
 *    notice, this list of conditions and the following disclaimer.
 * 2. Redistributions in binary form must reproduce the above copyright
 *    notice, this list of conditions and the following disclaimer in the
 *    documentation and/or other materials provided with the distribution.
 * 3. All advertising materials mentioning features or use of this software
 *    must display the following acknowledgement:
 *	This product includes software developed by Michael Shalayeff.
 * 4. The name of the author may not be used to endorse or promote products
 *    derived from this software without specific prior written permission.
 *
 * THIS SOFTWARE IS PROVIDED BY THE AUTHOR ``AS IS'' AND ANY EXPRESS OR 
 * IMPLIED WARRANTIES, INCLUDING, BUT NOT LIMITED TO, THE IMPLIED 
 * WARRANTIES OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE
 * ARE DISCLAIMED.  IN NO EVENT SHALL THE REGENTS OR CONTRIBUTORS BE LIABLE
 * FOR ANY DIRECT, INDIRECT, INCIDENTAL, SPECIAL, EXEMPLARY, OR CONSEQUENTIAL
 * DAMAGES (INCLUDING, BUT NOT LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS
 * OR SERVICES; LOSS OF USE, DATA, OR PROFITS; OR BUSINESS INTERRUPTION)
 * HOWEVER CAUSED AND ON ANY THEORY OF LIABILITY, WHETHER IN CONTRACT, STRICT
 * LIABILITY, OR TORT (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY
 * OUT OF THE USE OF THIS SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF
 * SUCH DAMAGE.
 *
 */

#include <stand.h>

void gateA20 __P((int on));

extern dev_t	bootdev, maj, unit, part;
extern u_long	cyloffset;
extern u_long	ourseg, esym;
extern int	boothowto;
@

