head	1.34;
access;
symbols
	OPENBSD_6_2:1.34.0.6
	OPENBSD_6_2_BASE:1.34
	OPENBSD_6_1:1.34.0.8
	OPENBSD_6_1_BASE:1.34
	OPENBSD_6_0:1.34.0.4
	OPENBSD_6_0_BASE:1.34
	OPENBSD_5_9:1.34.0.2
	OPENBSD_5_9_BASE:1.34
	OPENBSD_5_8:1.33.0.20
	OPENBSD_5_8_BASE:1.33
	OPENBSD_5_7:1.33.0.12
	OPENBSD_5_7_BASE:1.33
	OPENBSD_5_6:1.33.0.16
	OPENBSD_5_6_BASE:1.33
	OPENBSD_5_5:1.33.0.14
	OPENBSD_5_5_BASE:1.33
	OPENBSD_5_4:1.33.0.10
	OPENBSD_5_4_BASE:1.33
	OPENBSD_5_3:1.33.0.8
	OPENBSD_5_3_BASE:1.33
	OPENBSD_5_2:1.33.0.6
	OPENBSD_5_2_BASE:1.33
	OPENBSD_5_1_BASE:1.33
	OPENBSD_5_1:1.33.0.4
	OPENBSD_5_0:1.33.0.2
	OPENBSD_5_0_BASE:1.33
	OPENBSD_4_9:1.31.0.16
	OPENBSD_4_9_BASE:1.31
	OPENBSD_4_8:1.31.0.14
	OPENBSD_4_8_BASE:1.31
	OPENBSD_4_7:1.31.0.10
	OPENBSD_4_7_BASE:1.31
	OPENBSD_4_6:1.31.0.12
	OPENBSD_4_6_BASE:1.31
	OPENBSD_4_5:1.31.0.8
	OPENBSD_4_5_BASE:1.31
	OPENBSD_4_4:1.31.0.6
	OPENBSD_4_4_BASE:1.31
	OPENBSD_4_3:1.31.0.4
	OPENBSD_4_3_BASE:1.31
	OPENBSD_4_2:1.31.0.2
	OPENBSD_4_2_BASE:1.31
	OPENBSD_4_1:1.30.0.14
	OPENBSD_4_1_BASE:1.30
	OPENBSD_4_0:1.30.0.12
	OPENBSD_4_0_BASE:1.30
	OPENBSD_3_9:1.30.0.10
	OPENBSD_3_9_BASE:1.30
	OPENBSD_3_8:1.30.0.8
	OPENBSD_3_8_BASE:1.30
	OPENBSD_3_7:1.30.0.6
	OPENBSD_3_7_BASE:1.30
	OPENBSD_3_6:1.30.0.4
	OPENBSD_3_6_BASE:1.30
	SMP_SYNC_A:1.30
	SMP_SYNC_B:1.30
	OPENBSD_3_5:1.30.0.2
	OPENBSD_3_5_BASE:1.30
	OPENBSD_3_4:1.29.0.2
	OPENBSD_3_4_BASE:1.29
	UBC_SYNC_A:1.27
	OPENBSD_3_3:1.27.0.6
	OPENBSD_3_3_BASE:1.27
	OPENBSD_3_2:1.27.0.4
	OPENBSD_3_2_BASE:1.27
	OPENBSD_3_1:1.27.0.2
	OPENBSD_3_1_BASE:1.27
	UBC_SYNC_B:1.27
	UBC:1.25.0.8
	UBC_BASE:1.25
	OPENBSD_3_0:1.25.0.6
	OPENBSD_3_0_BASE:1.25
	OPENBSD_2_9:1.25.0.4
	OPENBSD_2_9_BASE:1.25
	OPENBSD_2_8:1.25.0.2
	OPENBSD_2_8_BASE:1.25
	OPENBSD_2_7:1.24.0.12
	OPENBSD_2_7_BASE:1.24
	SMP:1.24.0.10
	SMP_BASE:1.24
	kame_19991208:1.24
	OPENBSD_2_6:1.24.0.8
	OPENBSD_2_6_BASE:1.24
	OPENBSD_2_5:1.24.0.6
	OPENBSD_2_5_BASE:1.24
	OPENBSD_2_4:1.24.0.4
	OPENBSD_2_4_BASE:1.24
	OPENBSD_2_3:1.24.0.2
	OPENBSD_2_3_BASE:1.24
	OPENBSD_2_2:1.23.0.2
	OPENBSD_2_2_BASE:1.23
	OPENBSD_2_1:1.8.0.2
	OPENBSD_2_1_BASE:1.8;
locks; strict;
comment	@ * @;


1.34
date	2015.09.02.04.09.24;	author yasuoka;	state Exp;
branches;
next	1.33;
commitid	1T0xGkKNIiRZnTmz;

1.33
date	2011.03.14.22.14.40;	author krw;	state Exp;
branches;
next	1.32;

1.32
date	2011.03.13.00.13.53;	author deraadt;	state Exp;
branches;
next	1.31;

1.31
date	2007.04.27.10.08.34;	author tom;	state Exp;
branches;
next	1.30;

1.30
date	2003.09.16.03.43.11;	author fgsch;	state Exp;
branches;
next	1.29;

1.29
date	2003.06.03.20.22.11;	author mickey;	state Exp;
branches;
next	1.28;

1.28
date	2003.05.31.00.15.29;	author weingart;	state Exp;
branches;
next	1.27;

1.27
date	2002.03.14.03.15.54;	author millert;	state Exp;
branches;
next	1.26;

1.26
date	2002.03.14.01.26.34;	author millert;	state Exp;
branches;
next	1.25;

1.25
date	2000.06.08.01.51.33;	author mickey;	state Exp;
branches
	1.25.8.1;
next	1.24;

1.24
date	97.11.30.21.51.40;	author mickey;	state Exp;
branches
	1.24.10.1;
next	1.23;

1.23
date	97.10.22.23.34.37;	author mickey;	state Exp;
branches;
next	1.22;

1.22
date	97.10.17.15.03.22;	author weingart;	state Exp;
branches;
next	1.21;

1.21
date	97.09.20.22.40.44;	author flipk;	state Exp;
branches;
next	1.20;

1.20
date	97.09.03.04.32.43;	author weingart;	state Exp;
branches;
next	1.19;

1.19
date	97.09.02.22.42.26;	author weingart;	state Exp;
branches;
next	1.18;

1.18
date	97.08.13.14.24.01;	author niklas;	state Exp;
branches;
next	1.17;

1.17
date	97.08.13.03.35.08;	author mickey;	state Exp;
branches;
next	1.16;

1.16
date	97.08.12.21.40.50;	author mickey;	state Exp;
branches;
next	1.15;

1.15
date	97.08.12.21.39.01;	author mickey;	state Exp;
branches;
next	1.14;

1.14
date	97.08.12.19.24.58;	author mickey;	state Exp;
branches;
next	1.13;

1.13
date	97.08.12.19.16.37;	author mickey;	state Exp;
branches;
next	1.12;

1.12
date	97.08.12.19.05.56;	author mickey;	state Exp;
branches;
next	1.11;

1.11
date	97.07.18.00.49.43;	author mickey;	state Exp;
branches;
next	1.10;

1.10
date	97.05.30.23.06.29;	author mickey;	state Exp;
branches;
next	1.9;

1.9
date	97.05.30.02.21.52;	author mickey;	state Exp;
branches;
next	1.8;

1.8
date	97.04.28.07.39.01;	author weingart;	state Exp;
branches;
next	1.7;

1.7
date	97.04.23.14.49.23;	author weingart;	state Exp;
branches;
next	1.6;

1.6
date	97.04.21.20.20.27;	author mickey;	state Exp;
branches;
next	1.5;

1.5
date	97.04.18.06.54.42;	author weingart;	state Exp;
branches;
next	1.4;

1.4
date	97.04.09.08.39.17;	author mickey;	state Exp;
branches;
next	1.3;

1.3
date	97.03.31.23.06.27;	author mickey;	state Exp;
branches;
next	1.2;

1.2
date	97.03.31.03.12.10;	author weingart;	state Exp;
branches;
next	1.1;

1.1
date	96.10.29.09.22.52;	author mickey;	state dead;
branches
	1.1.2.1;
next	;

1.1.2.1
date	96.10.29.09.22.53;	author mickey;	state Exp;
branches;
next	;

1.24.10.1
date	2001.04.18.16.08.42;	author niklas;	state Exp;
branches;
next	1.24.10.2;

1.24.10.2
date	2002.03.28.10.31.05;	author niklas;	state Exp;
branches;
next	1.24.10.3;

1.24.10.3
date	2003.06.07.11.11.38;	author ho;	state Exp;
branches;
next	1.24.10.4;

1.24.10.4
date	2004.02.19.10.48.43;	author niklas;	state Exp;
branches;
next	;

1.25.8.1
date	2002.06.11.03.35.55;	author art;	state Exp;
branches;
next	;


desc
@@


1.34
log
@Bring the boot changes on amd64 to i386.  alloca is deleted.
Also fix the boot from BIOS and bump the version.

input and ok deraadt
@
text
@/*	$OpenBSD: biosdev.h,v 1.5 2015/09/02 01:52:26 yasuoka Exp $	*/

/*
 * Copyright (c) 1996 Michael Shalayeff
 * All rights reserved.
 *
 * Redistribution and use in source and binary forms, with or without
 * modification, are permitted provided that the following conditions
 * are met:
 * 1. Redistributions of source code must retain the above copyright
 *    notice, this list of conditions and the following disclaimer.
 * 2. Redistributions in binary form must reproduce the above copyright
 *    notice, this list of conditions and the following disclaimer in the
 *    documentation and/or other materials provided with the distribution.
 *
 * THIS SOFTWARE IS PROVIDED BY THE AUTHOR ``AS IS'' AND ANY EXPRESS OR 
 * IMPLIED WARRANTIES, INCLUDING, BUT NOT LIMITED TO, THE IMPLIED 
 * WARRANTIES OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE
 * ARE DISCLAIMED.  IN NO EVENT SHALL THE REGENTS OR CONTRIBUTORS BE LIABLE
 * FOR ANY DIRECT, INDIRECT, INCIDENTAL, SPECIAL, EXEMPLARY, OR CONSEQUENTIAL
 * DAMAGES (INCLUDING, BUT NOT LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS
 * OR SERVICES; LOSS OF USE, DATA, OR PROFITS; OR BUSINESS INTERRUPTION)
 * HOWEVER CAUSED AND ON ANY THEORY OF LIABILITY, WHETHER IN CONTRACT, STRICT
 * LIABILITY, OR TORT (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY
 * OUT OF THE USE OF THIS SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF
 * SUCH DAMAGE.
 *
 */

/*
 * Extension support bitmap definition (returned by 41h)
 */
#define EXT_BM_EDA	0x01	/* Extended disk access functions	*/
				/*  (42h-44h, 47h and 48h) supported.	*/
#define EXT_BM_RDC	0x02	/* Removable drive controller functions	*/
				/*  (45h, 46h, 48h, 49h and INT 15 52h)	*/
				/*  supported.				*/
#define EXT_BM_EDD	0x04	/* Enhanced disk drive functions	*/
				/*  (48h and 4eh) supported.		*/
#define EXT_BM_RSV	0xf8	/* Reserved (0)				*/

struct consdev;
struct open_file;
struct diskinfo;

/* biosdev.c */
extern const char *biosdevs[];
int biosstrategy(void *, int, daddr32_t, size_t, void *, size_t *);
int biosopen(struct open_file *, ...);
int biosclose(struct open_file *);
int biosioctl(struct open_file *, u_long, void *);
int bios_getdiskinfo(int, bios_diskinfo_t *);
int biosd_diskio(int, struct diskinfo *, u_int, int, void *);
const char * bios_getdisklabel(bios_diskinfo_t *, struct disklabel *);

/* diskprobe.c */
struct diskinfo *dklookup(int);
bios_diskinfo_t *bios_dklookup(int);

/* bioscons.c */
void pc_probe(struct consdev *);
void pc_init(struct consdev *);
int pc_getc(dev_t);
int pc_getshifts(dev_t);
void pc_putc(dev_t, int);
void pc_pollc(dev_t, int);
void com_probe(struct consdev *);
void com_init(struct consdev *);
int comspeed(dev_t, int);
int com_getc(dev_t);
void com_putc(dev_t, int);
void com_pollc(dev_t, int);
@


1.33
log
@Clamp BIOS io attempts to < 2 ^28 - 1 sectors (a.k.a. 128GB for
512-byte sectors) as some BIOSen get confused when we ask for sectors
higher up.

Uss u_int throughout the boot code to calculate sector addresses,
since 32 bits is enough to do 28  ^ 1 - 1 arithmetic. Add checks
for wraparound.

I can now install and boot from the 7th extended partition below
128GB.

Much feedback & guidance from deraadt@@. Also from weingart@@ on
BIOS io.

ok deraadt@@ (less a couple of minor tweaks found in testing)
@
text
@d1 1
a1 1
/*	$OpenBSD: biosdev.h,v 1.32 2011/03/13 00:13:53 deraadt Exp $	*/
d44 1
d53 1
a53 1
int biosd_io(int, bios_diskinfo_t *, u_int, int, void *);
@


1.32
log
@Change daddr_t to daddr32_t.  The bootblocks on our architectures only
do 32-bit block spanning.  If later on we get some that can/should do
64-bit, that can be done now using daddr64_t (but of course, we are taking
this step to finalize the daddr_t 64-bit conversion).
ok miod krw
@
text
@d1 1
a1 1
/*	$OpenBSD: biosdev.h,v 1.31 2007/04/27 10:08:34 tom Exp $	*/
d52 1
a52 1
int biosd_io(int, bios_diskinfo_t *, daddr32_t, int, void *);
@


1.31
log
@Check for Control key held down when starting, and don't read boot.conf
if it is.  This gives a way to recover from "switching to com0" when
there's no serial cable handy.

Bump version numbers.

A similar change will be made to amd64 boot soon.

ok toby@@ deraadt@@
@
text
@d1 1
a1 1
/*	$OpenBSD: biosdev.h,v 1.30 2003/09/16 03:43:11 fgsch Exp $	*/
d47 1
a47 1
int biosstrategy(void *, int, daddr_t, size_t, void *, size_t *);
d52 1
a52 1
int biosd_io(int, bios_diskinfo_t *, daddr_t, int, void *);
@


1.30
log
@document extension support bitmap definition; requested by deraadt@@.
toby@@ ok.
@
text
@d1 1
a1 1
/*	$OpenBSD: biosdev.h,v 1.28 2003/05/31 00:15:29 weingart Exp $	*/
d63 1
@


1.29
log
@three four kills
@
text
@d30 12
@


1.28
log
@First lba support in /boot.  Not complete lba boot support, but it's the
first step on the way there.  Ok deraadt@@, espie@@, todd@@, and others.
@
text
@d1 1
a1 1
/*	$OpenBSD: biosdev.h,v 1.27 2002/03/14 03:15:54 millert Exp $	*/
a14 5
 * 3. All advertising materials mentioning features or use of this software
 *    must display the following acknowledgement:
 *	This product includes software developed by Michael Shalayeff.
 * 4. The name of the author may not be used to endorse or promote products
 *    derived from this software without specific prior written permission.
@


1.27
log
@Final __P removal plus some cosmetic fixups
@
text
@d1 1
a1 1
/*	$OpenBSD: biosdev.h,v 1.26 2002/03/14 01:26:34 millert Exp $	*/
d45 1
a45 1
int biosd_io(int, int, int, int, int, int, void *);
@


1.26
log
@First round of __P removal in sys
@
text
@d1 1
a1 1
/*	$OpenBSD: biosdev.h,v 1.25 2000/06/08 01:51:33 mickey Exp $	*/
d45 1
a45 1
int biosd_io(int, int, int, int, int, int, void*);
@


1.25
log
@move cnspeed func and comspeed proto in places
@
text
@d1 1
a1 1
/*	$OpenBSD: biosdev.h,v 1.24 1997/11/30 21:51:40 mickey Exp $	*/
d40 7
a46 7
int biosstrategy __P((void *, int, daddr_t, size_t, void *, size_t *));
int biosopen __P((struct open_file *, ...));
int biosclose __P((struct open_file *));
int biosioctl __P((struct open_file *, u_long, void *));
int bios_getdiskinfo __P((int, bios_diskinfo_t *));
int biosd_io __P((int, int, int, int, int, int, void*));
const char * bios_getdisklabel __P((bios_diskinfo_t *, struct disklabel *));
d49 2
a50 2
struct diskinfo *dklookup __P((int));
bios_diskinfo_t *bios_dklookup __P((int));
d53 11
a63 11
void pc_probe __P((struct consdev *));
void pc_init __P((struct consdev *));
int pc_getc __P((dev_t));
void pc_putc __P((dev_t, int));
void pc_pollc __P((dev_t, int));
void com_probe __P((struct consdev *));
void com_init __P((struct consdev *));
int comspeed __P((dev_t, int));
int com_getc __P((dev_t));
void com_putc __P((dev_t, int));
void com_pollc __P((dev_t, int));
@


1.25.8.1
log
@Sync UBC branch to -current
@
text
@d1 1
a1 1
/*	$OpenBSD: biosdev.h,v 1.25 2000/06/08 01:51:33 mickey Exp $	*/
d40 7
a46 7
int biosstrategy(void *, int, daddr_t, size_t, void *, size_t *);
int biosopen(struct open_file *, ...);
int biosclose(struct open_file *);
int biosioctl(struct open_file *, u_long, void *);
int bios_getdiskinfo(int, bios_diskinfo_t *);
int biosd_io(int, int, int, int, int, int, void *);
const char * bios_getdisklabel(bios_diskinfo_t *, struct disklabel *);
d49 2
a50 2
struct diskinfo *dklookup(int);
bios_diskinfo_t *bios_dklookup(int);
d53 11
a63 11
void pc_probe(struct consdev *);
void pc_init(struct consdev *);
int pc_getc(dev_t);
void pc_putc(dev_t, int);
void pc_pollc(dev_t, int);
void com_probe(struct consdev *);
void com_init(struct consdev *);
int comspeed(dev_t, int);
int com_getc(dev_t);
void com_putc(dev_t, int);
void com_pollc(dev_t, int);
@


1.24
log
@big diskinfo changes from toby@@
@
text
@d1 1
a1 1
/*	$OpenBSD: biosdev.h,v 1.23 1997/10/22 23:34:37 mickey Exp $	*/
d60 1
a60 1
int com_setsp __P((int));
@


1.24.10.1
log
@Update the SMP branch to -current, this breaks the SMP branch though.
But it will be fixed soonish.  Note, nothing new has happened, this is just
a merge of the trunk into this branch.
@
text
@d1 1
a1 1
/*	$OpenBSD: biosdev.h,v 1.25 2000/06/08 01:51:33 mickey Exp $	*/
d60 1
a60 1
int comspeed __P((dev_t, int));
@


1.24.10.2
log
@Merge in -current from about a week ago
@
text
@d1 1
a1 1
/*	$OpenBSD$	*/
d40 7
a46 7
int biosstrategy(void *, int, daddr_t, size_t, void *, size_t *);
int biosopen(struct open_file *, ...);
int biosclose(struct open_file *);
int biosioctl(struct open_file *, u_long, void *);
int bios_getdiskinfo(int, bios_diskinfo_t *);
int biosd_io(int, int, int, int, int, int, void *);
const char * bios_getdisklabel(bios_diskinfo_t *, struct disklabel *);
d49 2
a50 2
struct diskinfo *dklookup(int);
bios_diskinfo_t *bios_dklookup(int);
d53 11
a63 11
void pc_probe(struct consdev *);
void pc_init(struct consdev *);
int pc_getc(dev_t);
void pc_putc(dev_t, int);
void pc_pollc(dev_t, int);
void com_probe(struct consdev *);
void com_init(struct consdev *);
int comspeed(dev_t, int);
int com_getc(dev_t);
void com_putc(dev_t, int);
void com_pollc(dev_t, int);
@


1.24.10.3
log
@Sync SMP branch to -current
@
text
@d1 1
a1 1
/*	$OpenBSD: biosdev.h,v 1.24.10.2 2002/03/28 10:31:05 niklas Exp $	*/
d15 5
d45 1
a45 1
int biosd_io(int, bios_diskinfo_t *, daddr_t, int, void *);
@


1.24.10.4
log
@Merge of current from two weeks agointo the SMP branch
@
text
@d1 1
a1 1
/*	$OpenBSD$	*/
a28 12

/*
 * Extension support bitmap definition (returned by 41h)
 */
#define EXT_BM_EDA	0x01	/* Extended disk access functions	*/
				/*  (42h-44h, 47h and 48h) supported.	*/
#define EXT_BM_RDC	0x02	/* Removable drive controller functions	*/
				/*  (45h, 46h, 48h, 49h and INT 15 52h)	*/
				/*  supported.				*/
#define EXT_BM_EDD	0x04	/* Enhanced disk drive functions	*/
				/*  (48h and 4eh) supported.		*/
#define EXT_BM_RSV	0xf8	/* Reserved (0)				*/
@


1.23
log
@newer, better stuff; some parts by toby@@
@
text
@d1 1
a1 1
/*	$OpenBSD: biosdev.h,v 1.22 1997/10/17 15:03:22 weingart Exp $	*/
d44 1
a44 1
int bios_getinfo __P((int, bios_diskinfo_t *));
d46 1
a46 1
const char * bios_getdisklabel __P((int, struct disklabel *));
d49 1
@


1.22
log
@Use BIOS to probe for memory map.
Probe for BIOS supported disks.
Use BIOS to get geometry for supported disks.

All in preparation to passing the whole thing
to the kernel.
@
text
@d1 1
a1 1
/*	$OpenBSD: biosdev.h,v 1.21 1997/09/20 22:40:44 flipk Exp $	*/
d44 3
a46 3
u_int32_t biosdinfo __P((int));
u_int32_t biosdprobe __P((int));
int biosd_rw __P((int, int, int, int, int, int, void*));
d48 2
@


1.21
log
@- add 'stty [baudrate]' command to /boot, for serial consoles
- switch baud rates using i/o instead of bios, since bios commands
have only a limited bitwidth for baudrate, and max out at 9600
- when switching console devices, print msg to both old device and new
- fix timeout bug in com_getc() (dev | 0x80 was reading gobbledygook)
- document 'stty' command in boot(8)
- wording and cleanup in man pages
@
text
@d1 1
a1 1
/*	$OpenBSD: biosdev.h,v 1.20 1997/09/03 04:32:43 weingart Exp $	*/
d44 3
a46 1
u_int32_t biosdinfo(int);
@


1.20
log
@1st part of pretty "machine diskinfo" stuff
@
text
@d1 1
a1 1
/*	$OpenBSD: biosdev.h,v 1.19 1997/09/02 22:42:26 weingart Exp $	*/
d55 1
@


1.19
log
@Add "machine diskinfo" command.  Needs work.
@
text
@d1 1
a1 1
/*	$OpenBSD: biosdev.h,v 1.18 1997/08/13 14:24:01 niklas Exp $	*/
d44 1
a44 1
u_int16_t biosdinfo(int);
@


1.18
log
@s/kbd/pc/ for consistency with kernel.  Do even better __asms for BIOS calls.
Adapt to new console probing and setting API.  Do not try to probe pc0 via
the NVRAM.  Fix some other buglets.
@
text
@d1 1
a1 1
/*	$OpenBSD: biosdev.h,v 1.17 1997/08/13 03:35:08 mickey Exp $	*/
d44 2
@


1.17
log
@getsecs() is in stand.h
move time_print() into libsa.h
@
text
@d1 1
a1 1
/*	$OpenBSD: biosdev.h,v 1.16 1997/08/12 21:40:50 mickey Exp $	*/
d46 5
a50 5
void kbd_probe __P((struct consdev *));
void kbd_init __P((struct consdev *));
int kbd_getc __P((dev_t));
void kbd_putc __P((dev_t, int));
void kbd_pollc __P((dev_t, int));
@


1.16
log
@protos
@
text
@d1 1
a1 1
/*	$OpenBSD: biosdev.h,v 1.15 1997/08/12 21:39:01 mickey Exp $	*/
a55 4

/* time.c */
void time_print __P((void));
time_t getsecs __P((void));
@


1.15
log
@new cons
do inline BIOS calls
@
text
@d1 1
a1 1
/*	$OpenBSD: biosdev.h,v 1.14 1997/08/12 19:24:58 mickey Exp $	*/
d35 2
d44 12
@


1.14
log
@call BIOS inline (add struct EDD_cb into biosvar.h)
@
text
@d1 1
a1 1
/*	$OpenBSD: biosdev.h,v 1.13 1997/08/12 19:16:37 mickey Exp $	*/
a41 18

/* bioskbd.S */
int kbd_probe __P((void));
void kbd_putc __P((int c));
int kbd_getc __P((void));
int kbd_ischar __P((void));

/* bioscom.S */
#define COM_PROTO(n) \
int com##n##_probe __P((void)); \
void com##n##_putc __P((int c)); \
int com##n##_getc __P((void)); \
int com##n##_ischar __P((void));
COM_PROTO(0)
COM_PROTO(1)
COM_PROTO(2)
COM_PROTO(3)
#undef COM_PROTO
@


1.13
log
@no more biosmem.S
@
text
@d1 1
a1 1
/*	$OpenBSD: biosdev.h,v 1.12 1997/08/12 19:05:56 mickey Exp $	*/
a41 9

/* biosdisk.S */
u_int16_t biosdinfo __P((int dev));
int biosdreset __P((int dev));
int biosread  __P((int dev, int cyl, int hd, int sect, int nsect, void *));
int bioswrite __P((int dev, int cyl, int hd, int sect, int nsect, void *));
int EDDcheck __P((dev_t));
int EDDread __P((dev_t, u_int64_t, u_int32_t, void *));
int EDDwrite __P((dev_t, u_int64_t, u_int32_t, void *));
@


1.12
log
@move that inline
@
text
@d1 1
a1 1
/*	$OpenBSD: biosdev.h,v 1.11 1997/07/18 00:49:43 mickey Exp $	*/
a68 3

/* biosmem.S */
u_int biosmem __P((void));
@


1.11
log
@this is now in machine/biosvar.h
@
text
@d1 1
a1 1
/*	$OpenBSD: biosdev.h,v 1.10 1997/05/30 23:06:29 mickey Exp $	*/
a75 4

/* biostime.S */
int biostime __P((char *));
int biosdate __P((char *));
@


1.10
log
@sleep/usleep prototypes (others may need 'em too, btw
strncmp prototype in stand.h
@
text
@d1 1
a1 1
/*	$OpenBSD: biosdev.h,v 1.9 1997/05/30 02:21:52 mickey Exp $	*/
a35 8
#define	BIOSNHEADS(d)	(((d)>>8)+1)
#define	BIOSNSECTS(d)	((d)&0xff)	/* sectors are 1-based */

#ifdef _LOCORE
#define	BIOSINT(n)	int	$0x20+(n)
#else
#define	BIOSINT(n)	__asm ((int $0x20+(n)))

a79 1
#endif
@


1.9
log
@EDD support functions, EDD detection code.
com prototypes changes
some indentation
@
text
@d1 1
a1 1
/*	$OpenBSD: biosdev.h,v 1.8 1997/04/28 07:39:01 weingart Exp $	*/
a85 1
int usleep __P((u_long));
@


1.8
log
@Add getsecs().  Use biostime & biosdate routines.
Parse and convert to seconds since epoch.  Please
test, there is a new command "time", which should
print the current time (according to the BIOS) on
the console.
@
text
@d1 1
a1 1
/*	$OpenBSD: biosdev.h,v 1.7 1997/04/23 14:49:23 weingart Exp $	*/
d53 6
a58 3
int		biosdreset __P((int dev));
int     biosread  __P((int dev, int cyl, int hd, int sect, int nsect, void *));
int     bioswrite __P((int dev, int cyl, int hd, int sect, int nsect, void *));
d61 4
a64 4
int	kbd_probe __P((void));
void	kbd_putc __P((int c));
int	kbd_getc __P((void));
int	kbd_ischar __P((void));
d67 10
a76 4
int	com_probe __P((void));
void	com_putc __P((int c));
int	com_getc __P((void));
int	com_ischar __P((void));
d79 1
a79 1
u_int	biosmem __P((void));
d86 1
a86 1
int	usleep __P((u_long));
@


1.7
log
@Clean up disk reset code
@
text
@d1 1
a1 1
/*	$OpenBSD: biosdev.h,v 1.6 1997/04/21 20:20:27 mickey Exp $	*/
d72 4
d78 2
@


1.6
log
@usleep testing code
@
text
@d1 1
a1 1
/*	$OpenBSD: biosdev.h,v 1.5 1997/04/18 06:54:42 weingart Exp $	*/
d53 1
a53 1
int	biosdreset __P((void));
@


1.5
log
@Clean up error handling a little.  There is a small
problem with marginal disks.  This code does not
like them at all.  I'm too frazzled right now to
figure this out.  This should give better error
messages...
@
text
@d1 1
a1 1
/*	$OpenBSD: biosdev.h,v 1.4 1997/04/09 08:39:17 mickey Exp $	*/
d53 1
a53 1
int		biosdreset __P((void));
d73 1
a73 1
void	usleep __P((u_long));
@


1.4
log
@emulate bios calls. more debugging stuff. some fixes.
@
text
@d1 1
a1 1
/*	$OpenBSD: biosdev.h,v 1.3 1997/03/31 23:06:27 mickey Exp $	*/
d53 1
@


1.3
log
@commit all my mods to the last imported libsa stuff....
including:
- disklabel support;
- better boot cmd line
- smaller size (using some compilation switches ;)
- no more relocations in /boot, it's loaded in the place;
- better disk performance (maybe were already in there)
- installboot -n does not require write perms for device
- more debugs
- missing parts in libsa (such as cd9660 and so)
- i don't like 2 files for exec_i386 (sorry, toby, let's discuss maybe?)
tricks and tails:
- joined .text and .data (saves you a page)
- prot mode switching still in biosboot (it's freezed for awhile)
- biosdisk internals changed
- biosdev is not passed propery to the kernel (i'll fix it soon)
- sure i missed smth here to note (use the source, Luke!)
@
text
@d1 1
a1 1
/*	$OpenBSD: biosdev.h,v 1.1.2.1 1996/10/29 09:22:53 mickey Exp $	*/
d39 5
d52 1
a52 1
u_int	biosdinfo __P((int dev));
d69 1
a69 1
u_int	biosmem __P((int));
d73 1
@


1.2
log
@Initial /boot stuff (from Mickey)
@
text
@d63 3
@


1.1
log
@file biosdev.h was initially added on branch new.
@
text
@d1 64
@


1.1.2.1
log
@support libsa
@
text
@a0 64
/*	$OpenBSD$	*/

/*
 * Copyright (c) 1996 Michael Shalayeff
 * All rights reserved.
 *
 * Redistribution and use in source and binary forms, with or without
 * modification, are permitted provided that the following conditions
 * are met:
 * 1. Redistributions of source code must retain the above copyright
 *    notice, this list of conditions and the following disclaimer.
 * 2. Redistributions in binary form must reproduce the above copyright
 *    notice, this list of conditions and the following disclaimer in the
 *    documentation and/or other materials provided with the distribution.
 * 3. All advertising materials mentioning features or use of this software
 *    must display the following acknowledgement:
 *	This product includes software developed by Michael Shalayeff.
 * 4. The name of the author may not be used to endorse or promote products
 *    derived from this software without specific prior written permission.
 *
 * THIS SOFTWARE IS PROVIDED BY THE AUTHOR ``AS IS'' AND ANY EXPRESS OR 
 * IMPLIED WARRANTIES, INCLUDING, BUT NOT LIMITED TO, THE IMPLIED 
 * WARRANTIES OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE
 * ARE DISCLAIMED.  IN NO EVENT SHALL THE REGENTS OR CONTRIBUTORS BE LIABLE
 * FOR ANY DIRECT, INDIRECT, INCIDENTAL, SPECIAL, EXEMPLARY, OR CONSEQUENTIAL
 * DAMAGES (INCLUDING, BUT NOT LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS
 * OR SERVICES; LOSS OF USE, DATA, OR PROFITS; OR BUSINESS INTERRUPTION)
 * HOWEVER CAUSED AND ON ANY THEORY OF LIABILITY, WHETHER IN CONTRACT, STRICT
 * LIABILITY, OR TORT (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY
 * OUT OF THE USE OF THIS SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF
 * SUCH DAMAGE.
 *
 */


#define	BIOSNHEADS(d)	(((d)>>8)+1)
#define	BIOSNSECTS(d)	((d)&0xff)	/* sectors are 1-based */

/* biosdev.c */
extern const char *devs[];
int biosstrategy __P((void *, int, daddr_t, size_t, void *, size_t *));
int biosopen __P((struct open_file *, ...));
int biosclose __P((struct open_file *));
int biosioctl __P((struct open_file *, u_long, void *));

/* biosdisk.S */
u_int	biosdinfo __P((int dev));
int     biosread  __P((int dev, int cyl, int hd, int sect, int nsect, void *));
int     bioswrite __P((int dev, int cyl, int hd, int sect, int nsect, void *));

/* bioskbd.S */
int	kbd_probe __P((void));
void	kbd_putc __P((int c));
int	kbd_getc __P((void));
int	kbd_ischar __P((void));

/* bioscom.S */
int	com_probe __P((void));
void	com_putc __P((int c));
int	com_getc __P((void));
int	com_ischar __P((void));

/* biostime.S */
void	usleep __P((u_long));
@
