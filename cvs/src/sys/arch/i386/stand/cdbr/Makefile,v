head	1.7;
access;
symbols
	OPENBSD_6_0:1.6.0.10
	OPENBSD_6_0_BASE:1.6
	OPENBSD_5_9:1.6.0.6
	OPENBSD_5_9_BASE:1.6
	OPENBSD_5_8:1.6.0.8
	OPENBSD_5_8_BASE:1.6
	OPENBSD_5_7:1.6.0.2
	OPENBSD_5_7_BASE:1.6
	OPENBSD_5_6:1.6.0.4
	OPENBSD_5_6_BASE:1.6
	OPENBSD_5_5:1.5.0.8
	OPENBSD_5_5_BASE:1.5
	OPENBSD_5_4:1.5.0.4
	OPENBSD_5_4_BASE:1.5
	OPENBSD_5_3:1.5.0.2
	OPENBSD_5_3_BASE:1.5
	OPENBSD_5_2:1.2.0.34
	OPENBSD_5_2_BASE:1.2
	OPENBSD_5_1_BASE:1.2
	OPENBSD_5_1:1.2.0.32
	OPENBSD_5_0:1.2.0.30
	OPENBSD_5_0_BASE:1.2
	OPENBSD_4_9:1.2.0.28
	OPENBSD_4_9_BASE:1.2
	OPENBSD_4_8:1.2.0.26
	OPENBSD_4_8_BASE:1.2
	OPENBSD_4_7:1.2.0.22
	OPENBSD_4_7_BASE:1.2
	OPENBSD_4_6:1.2.0.24
	OPENBSD_4_6_BASE:1.2
	OPENBSD_4_5:1.2.0.20
	OPENBSD_4_5_BASE:1.2
	OPENBSD_4_4:1.2.0.18
	OPENBSD_4_4_BASE:1.2
	OPENBSD_4_3:1.2.0.16
	OPENBSD_4_3_BASE:1.2
	OPENBSD_4_2:1.2.0.14
	OPENBSD_4_2_BASE:1.2
	OPENBSD_4_1:1.2.0.12
	OPENBSD_4_1_BASE:1.2
	OPENBSD_4_0:1.2.0.10
	OPENBSD_4_0_BASE:1.2
	OPENBSD_3_9:1.2.0.8
	OPENBSD_3_9_BASE:1.2
	OPENBSD_3_8:1.2.0.6
	OPENBSD_3_8_BASE:1.2
	OPENBSD_3_7:1.2.0.4
	OPENBSD_3_7_BASE:1.2
	OPENBSD_3_6:1.2.0.2
	OPENBSD_3_6_BASE:1.2;
locks; strict;
comment	@# @;


1.7
date	2016.07.30.03.25.48;	author guenther;	state Exp;
branches;
next	1.6;
commitid	HVbAtwruDlJazNH2;

1.6
date	2014.07.15.22.14.37;	author deraadt;	state Exp;
branches;
next	1.5;
commitid	NR8siXEkpaNp3MWn;

1.5
date	2013.01.18.03.45.23;	author jsing;	state Exp;
branches;
next	1.4;

1.4
date	2012.08.29.22.23.08;	author pascal;	state Exp;
branches;
next	1.3;

1.3
date	2012.08.21.14.46.18;	author pascal;	state Exp;
branches;
next	1.2;

1.2
date	2004.08.24.15.24.05;	author tom;	state Exp;
branches;
next	1.1;

1.1
date	2004.06.22.23.12.18;	author tom;	state Exp;
branches;
next	;


desc
@@


1.7
log
@Prep for relro: make sure it's off for any non-PIE stand/ program

ok millert@@ kettenis@@
@
text
@#	$OpenBSD: Makefile,v 1.6 2014/07/15 22:14:37 deraadt Exp $
#

S=	${.CURDIR}/../../../..
SADIR=	${.CURDIR}/..

PROG=	cdbr
SRCS=	cdbr.S
AFLAGS+=-I${.CURDIR} -I${.CURDIR}/../../.. #-Wa,-a
AFLAGS+=-DOSREV=\"${OSREV}\"
AFLAGS+=-DMACH=\"${MACHINE}\" -DMACH_U=\"${MACHINE:U}\"
AFLAGS+=-fno-pie
LD=ld
ORG=	0x0000
LDFLAGS=-nostdlib -Ttext ${ORG} -x -N -s -Bstatic -e start -nopie -znorelro

NOMAN=
#MAN+=	cdbr.8

INSTALL_STRIP=
BINMODE=644

${PROG}: $(OBJS)
	$(LD) $(LDFLAGS) -o $(PROG) $(OBJS)
	@@size $(PROG)
	@@if [ -x ${.OBJDIR}/${PROG} ]; then \
		objcopy -O binary ${PROG} ${.OBJDIR}/.tmp;\
		mv -f ${.OBJDIR}/.tmp ${.OBJDIR}/${PROG}; \
		ls -l ${.OBJDIR}/${PROG}; \
	fi

.include <bsd.prog.mk>
@


1.6
log
@mode 644 for installing these files
@
text
@d1 1
a1 1
#	$OpenBSD: Makefile,v 1.5 2013/01/18 03:45:23 jsing Exp $
d15 1
a15 1
LDFLAGS=-nostdlib -Ttext ${ORG} -x -N -s -Bstatic -e start -nopie
@


1.5
log
@Clean up/standardise makefiles for i386/stand.
@
text
@d1 1
a1 1
#	$OpenBSD: Makefile,v 1.3 2012/08/21 14:46:18 pascal Exp $
d21 1
@


1.4
log
@Kill all NOPIE and NOPIE_FLAGS in i386/stand, replacing them with -fno-pie
and -nopie directly.  Binaries from a PIE system are identical to those from
a recent snapshot.

ok deraadt@@
@
text
@d4 3
a20 2
SADIR=${.CURDIR}/..
S=	${.CURDIR}/../../../..
d22 2
a23 2
${PROG}: $(OBJS) $(DPADD)
	$(LD) $(LDFLAGS) -o $(PROG) $(OBJS) $(LDADD)
@


1.3
log
@Add NOPIE= bits for sys/arch/*/stand to ensure that bootblocks will always be
built with -fno-pie.  This gets the hairiest part of PIE out of the way ...

ok deraadt@@
@
text
@d1 1
a1 1
#	$OpenBSD: Makefile,v 1.2 2004/08/24 15:24:05 tom Exp $
d9 1
a9 1
AFLAGS+=${NOPIE_FLAGS}
d12 1
a12 1
LDFLAGS=-nostdlib -Ttext ${ORG} -x -N -s -Bstatic -e start
@


1.2
log
@Have cdbr look for cdboot at /3.6/i386/cdboot as well as at /cdboot.

"go for it" deraadt@@; part of diff reviewed and ok weingart@@.
@
text
@d1 1
a1 1
#	$OpenBSD: Makefile,v 1.1 2004/06/22 23:12:18 tom Exp $
d9 1
@


1.1
log
@Enter cdbr, an El Torito no-emulation CD boot sector that fits
comfortably in a single CD sector of 2,048.  Not currently hooked into
the build.

Based on the FreeBSD equivalent by John Baldwin, jhb (at) FreeBSD
(dot) org, who agreed to change to a 3-clause BSD licence.  Thanks.

assistance, testing and ok weingart@@
@
text
@d1 1
a1 1
#	$OpenBSD: Makefile,v 1.14 2003/04/17 03:43:19 drahn Exp $
d7 2
@

