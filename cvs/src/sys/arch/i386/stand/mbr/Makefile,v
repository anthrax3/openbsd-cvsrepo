head	1.20;
access;
symbols
	OPENBSD_6_2:1.20.0.2
	OPENBSD_6_2_BASE:1.20
	OPENBSD_6_1:1.20.0.4
	OPENBSD_6_1_BASE:1.20
	OPENBSD_6_0:1.19.0.16
	OPENBSD_6_0_BASE:1.19
	OPENBSD_5_9:1.19.0.12
	OPENBSD_5_9_BASE:1.19
	OPENBSD_5_8:1.19.0.14
	OPENBSD_5_8_BASE:1.19
	OPENBSD_5_7:1.19.0.6
	OPENBSD_5_7_BASE:1.19
	OPENBSD_5_6:1.19.0.10
	OPENBSD_5_6_BASE:1.19
	OPENBSD_5_5:1.19.0.8
	OPENBSD_5_5_BASE:1.19
	OPENBSD_5_4:1.19.0.4
	OPENBSD_5_4_BASE:1.19
	OPENBSD_5_3:1.19.0.2
	OPENBSD_5_3_BASE:1.19
	OPENBSD_5_2:1.14.0.38
	OPENBSD_5_2_BASE:1.14
	OPENBSD_5_1_BASE:1.14
	OPENBSD_5_1:1.14.0.36
	OPENBSD_5_0:1.14.0.34
	OPENBSD_5_0_BASE:1.14
	OPENBSD_4_9:1.14.0.32
	OPENBSD_4_9_BASE:1.14
	OPENBSD_4_8:1.14.0.30
	OPENBSD_4_8_BASE:1.14
	OPENBSD_4_7:1.14.0.26
	OPENBSD_4_7_BASE:1.14
	OPENBSD_4_6:1.14.0.28
	OPENBSD_4_6_BASE:1.14
	OPENBSD_4_5:1.14.0.24
	OPENBSD_4_5_BASE:1.14
	OPENBSD_4_4:1.14.0.22
	OPENBSD_4_4_BASE:1.14
	OPENBSD_4_3:1.14.0.20
	OPENBSD_4_3_BASE:1.14
	OPENBSD_4_2:1.14.0.18
	OPENBSD_4_2_BASE:1.14
	OPENBSD_4_1:1.14.0.16
	OPENBSD_4_1_BASE:1.14
	OPENBSD_4_0:1.14.0.14
	OPENBSD_4_0_BASE:1.14
	OPENBSD_3_9:1.14.0.12
	OPENBSD_3_9_BASE:1.14
	OPENBSD_3_8:1.14.0.10
	OPENBSD_3_8_BASE:1.14
	OPENBSD_3_7:1.14.0.8
	OPENBSD_3_7_BASE:1.14
	OPENBSD_3_6:1.14.0.6
	OPENBSD_3_6_BASE:1.14
	SMP_SYNC_A:1.14
	SMP_SYNC_B:1.14
	OPENBSD_3_5:1.14.0.4
	OPENBSD_3_5_BASE:1.14
	OPENBSD_3_4:1.14.0.2
	OPENBSD_3_4_BASE:1.14
	UBC_SYNC_A:1.14
	OPENBSD_3_3:1.13.0.14
	OPENBSD_3_3_BASE:1.13
	OPENBSD_3_2:1.13.0.12
	OPENBSD_3_2_BASE:1.13
	OPENBSD_3_1:1.13.0.10
	OPENBSD_3_1_BASE:1.13
	UBC_SYNC_B:1.13
	UBC:1.13.0.8
	UBC_BASE:1.13
	OPENBSD_3_0:1.13.0.6
	OPENBSD_3_0_BASE:1.13
	OPENBSD_2_9:1.13.0.4
	OPENBSD_2_9_BASE:1.13
	OPENBSD_2_8:1.13.0.2
	OPENBSD_2_8_BASE:1.13
	OPENBSD_2_7:1.10.0.6
	OPENBSD_2_7_BASE:1.10
	SMP:1.10.0.4
	SMP_BASE:1.10
	kame_19991208:1.10
	OPENBSD_2_6:1.10.0.2
	OPENBSD_2_6_BASE:1.10
	OPENBSD_2_5:1.8.0.4
	OPENBSD_2_5_BASE:1.8
	OPENBSD_2_4:1.8.0.2
	OPENBSD_2_4_BASE:1.8
	OPENBSD_2_3:1.6.0.4
	OPENBSD_2_3_BASE:1.6
	OPENBSD_2_2:1.6.0.2
	OPENBSD_2_2_BASE:1.6
	OPENBSD_2_1:1.4.0.2
	OPENBSD_2_1_BASE:1.4;
locks; strict;
comment	@# @;


1.20
date	2016.07.30.03.25.48;	author guenther;	state Exp;
branches;
next	1.19;
commitid	HVbAtwruDlJazNH2;

1.19
date	2013.01.18.21.09.04;	author espie;	state Exp;
branches;
next	1.18;

1.18
date	2013.01.18.04.10.16;	author jsing;	state Exp;
branches;
next	1.17;

1.17
date	2013.01.18.03.45.23;	author jsing;	state Exp;
branches;
next	1.16;

1.16
date	2012.08.29.22.23.08;	author pascal;	state Exp;
branches;
next	1.15;

1.15
date	2012.08.21.14.46.18;	author pascal;	state Exp;
branches;
next	1.14;

1.14
date	2003.04.17.03.43.19;	author drahn;	state Exp;
branches;
next	1.13;

1.13
date	2000.06.08.00.56.08;	author mickey;	state Exp;
branches
	1.13.8.1;
next	1.12;

1.12
date	2000.05.25.21.55.01;	author deraadt;	state Exp;
branches;
next	1.11;

1.11
date	2000.05.25.20.32.57;	author deraadt;	state Exp;
branches;
next	1.10;

1.10
date	99.07.08.22.49.25;	author deraadt;	state Exp;
branches
	1.10.4.1;
next	1.9;

1.9
date	99.07.08.20.11.53;	author deraadt;	state Exp;
branches;
next	1.8;

1.8
date	98.05.28.20.52.42;	author mickey;	state Exp;
branches;
next	1.7;

1.7
date	98.05.25.19.06.41;	author mickey;	state Exp;
branches;
next	1.6;

1.6
date	97.08.29.19.48.25;	author mickey;	state Exp;
branches;
next	1.5;

1.5
date	97.06.23.23.45.18;	author kstailey;	state Exp;
branches;
next	1.4;

1.4
date	97.04.27.20.56.29;	author millert;	state Exp;
branches;
next	1.3;

1.3
date	97.04.21.20.31.00;	author mickey;	state Exp;
branches;
next	1.2;

1.2
date	97.04.07.09.00.10;	author deraadt;	state Exp;
branches;
next	1.1;

1.1
date	97.03.31.03.12.19;	author weingart;	state Exp;
branches;
next	;

1.10.4.1
date	2001.04.18.16.08.46;	author niklas;	state Exp;
branches;
next	1.10.4.2;

1.10.4.2
date	2003.05.13.19.42.09;	author ho;	state Exp;
branches;
next	;

1.13.8.1
date	2003.05.19.21.45.12;	author tedu;	state Exp;
branches;
next	;


desc
@@


1.20
log
@Prep for relro: make sure it's off for any non-PIE stand/ program

ok millert@@ kettenis@@
@
text
@#	$OpenBSD: Makefile,v 1.19 2013/01/18 21:09:04 espie Exp $
#

S=	${.CURDIR}/../../../..
SADIR=	${.CURDIR}/..

PROG=	mbr
SRCS=	mbr.S
AFLAGS+=-I${.CURDIR} -I${.CURDIR}/../../.. #-Wa,-a
AFLAGS+=-fno-pie
LD=ld
LDFLAGS=-nostdlib -Ttext 0 -x -N -s -Bstatic -e start -nopie -znorelro

NOMAN=
#MAN+=	mbr.8

INSTALL_STRIP=

# Uncomment this to make mbr talk to a serial port.
#CPPFLAGS+=-DSERIAL=0

.depend mbr.o: assym.h

${PROG}: $(OBJS)
	$(LD) $(LDFLAGS) -o $(PROG) $(OBJS)
	@@size $(PROG)
	@@if [ -x ${.OBJDIR}/${PROG} ]; then \
		objcopy -O binary ${PROG} ${.OBJDIR}/.tmp;\
		mv -f ${.OBJDIR}/.tmp ${.OBJDIR}/${PROG}; \
		ls -l ${.OBJDIR}/${PROG}; \
	fi

.include <bsd.prog.mk>
@


1.19
log
@fix bogus dependencies, and allow mkdep to run
checked on amd64 by rpe@@
okay jsing@@
@
text
@d1 1
a1 1
#	$OpenBSD: Makefile,v 1.18 2013/01/18 04:10:16 jsing Exp $
d12 1
a12 1
LDFLAGS=-nostdlib -Ttext 0 -x -N -s -Bstatic -e start -nopie
@


1.18
log
@Generate assym.h where we need it, instead of reaching around into other
object directories.
@
text
@d1 1
a1 1
#	$OpenBSD: Makefile,v 1.17 2013/01/18 03:45:23 jsing Exp $
d22 1
a22 1
${.CURDIR}/mbr.S: assym.h
@


1.17
log
@Clean up/standardise makefiles for i386/stand.
@
text
@d1 1
a1 1
#	$OpenBSD: Makefile,v 1.16 2012/08/29 22:23:08 pascal Exp $
d21 2
@


1.16
log
@Kill all NOPIE and NOPIE_FLAGS in i386/stand, replacing them with -fno-pie
and -nopie directly.  Binaries from a PIE system are identical to those from
a recent snapshot.

ok deraadt@@
@
text
@d1 1
a1 1
#	$OpenBSD: Makefile,v 1.15 2012/08/21 14:46:18 pascal Exp $
d4 3
a17 2
SADIR=${.CURDIR}/..
S=	${.CURDIR}/../../../..
d22 2
a23 2
${PROG}: $(OBJS) $(DPADD)
	$(LD) $(LDFLAGS) -o $(PROG) $(OBJS) $(LDADD)
@


1.15
log
@Add NOPIE= bits for sys/arch/*/stand to ensure that bootblocks will always be
built with -fno-pie.  This gets the hairiest part of PIE out of the way ...

ok deraadt@@
@
text
@d1 1
a1 1
#	$OpenBSD: Makefile,v 1.14 2003/04/17 03:43:19 drahn Exp $
d7 1
a7 1
AFLAGS+=${NOPIE_FLAGS}
d9 1
a9 1
LDFLAGS=-nostdlib -Ttext 0 -x -N -s -Bstatic -e start
@


1.14
log
@i386 ELF bootloader. developed with weingart@@
@
text
@d1 1
a1 1
#	$OpenBSD: Makefile,v 1.13 2000/06/08 00:56:08 mickey Exp $
d7 1
@


1.13
log
@MANSUBDIR is common for this whole dir
@
text
@d1 1
a1 1
#	$OpenBSD: Makefile,v 1.12 2000/05/25 21:55:01 deraadt Exp $
d8 1
a8 1
LDFLAGS=-nostdlib -Ttext 0 -x -N -s -Bstatic
d24 1
a24 1
		dd if=${.OBJDIR}/${PROG} of=${.OBJDIR}/.tmp ibs=32 skip=1 2>/dev/null; \
@


1.13.8.1
log
@sync
@
text
@d1 1
a1 1
#	$OpenBSD$
d8 1
a8 1
LDFLAGS=-nostdlib -Ttext 0 -x -N -s -Bstatic -e start
d24 1
a24 1
		objcopy -O binary ${PROG} ${.OBJDIR}/.tmp;\
@


1.12
log
@cause traversal into arch & subdirectories for the purposes of manual page install...
@
text
@d1 1
a1 1
#	$OpenBSD: Makefile,v 1.11 2000/05/25 20:32:57 deraadt Exp $
a11 1
#MANSUBDIR=/i386
@


1.11
log
@man subdir
@
text
@d1 1
a1 1
#	$OpenBSD: Makefile,v 1.10 1999/07/08 22:49:25 deraadt Exp $
d12 1
a12 1
#MANSUBDIR=i386
@


1.10
log
@no man page!
@
text
@d1 1
a1 1
#	$OpenBSD: Makefile,v 1.9 1999/07/08 20:11:53 deraadt Exp $
d12 1
a12 1
#MANSUBDIR=/i386
@


1.10.4.1
log
@Update the SMP branch to -current, this breaks the SMP branch though.
But it will be fixed soonish.  Note, nothing new has happened, this is just
a merge of the trunk into this branch.
@
text
@d1 1
a1 1
#	$OpenBSD: Makefile,v 1.13 2000/06/08 00:56:08 mickey Exp $
d12 1
@


1.10.4.2
log
@Sync the SMP branch to -current, plus some ELF-related fixes.
@
text
@d1 1
a1 1
#	$OpenBSD: Makefile,v 1.10.4.1 2001/04/18 16:08:46 niklas Exp $
d8 1
a8 1
LDFLAGS=-nostdlib -Ttext 0 -x -N -s -Bstatic -e start
d24 1
a24 1
		objcopy -O binary ${PROG} ${.OBJDIR}/.tmp;\
@


1.9
log
@install into man8/arch subdirs
@
text
@d1 1
a1 1
#	$OpenBSD: Makefile,v 1.8 1998/05/28 20:52:42 mickey Exp $
d10 3
a12 2
MAN+=	mbr.8
MANSUBDIR=/i386
@


1.8
log
@cleanup the Makefiles a bit.
make machine link in a smart way, remove unused bits.
@
text
@d1 1
a1 1
#	$OpenBSD: Makefile,v 1.7 1998/05/25 19:06:41 mickey Exp $
d9 1
d11 2
@


1.7
log
@more CLEANFILES; oops
@
text
@d1 1
a1 1
#	$OpenBSD: Makefile,v 1.6 1997/08/29 19:48:25 mickey Exp $
d12 1
a12 1
CLEANFILES=	i386 machine
a15 7

all:	machine-links

machine-links:
	@@rm -f machine i386
	@@ln -fs ${.CURDIR}/../.. i386
	@@ln -fs ${.CURDIR}/../../include machine
@


1.6
log
@hide dd's messages
@
text
@d1 1
a1 1
#	$OpenBSD: Makefile,v 1.5 1997/06/23 23:45:18 kstailey Exp $
d12 1
@


1.5
log
@remove @@obj dependency
@
text
@d1 1
a1 1
#	$OpenBSD: Makefile,v 1.4 1997/04/27 20:56:29 millert Exp $
d27 1
a27 1
		dd if=${.OBJDIR}/${PROG} of=${.OBJDIR}/.tmp ibs=32 skip=1; \
@


1.4
log
@COPY -> INSTALL_COPY and STRIP -> INSTALL_STRIP
This fixes namespace problems where STRIP is sometimes used as
the name of the strip(1) to use and other times used as
the flag to send install(1) when stripping (or not).
COPY doesn't have this problem (yet) but was poorly named.
@
text
@d1 1
a1 1
#	$OpenBSD: Makefile,v 1.3 1997/04/21 20:31:00 mickey Exp $
d11 1
@


1.3
log
@don't use cc for ld, bad things happens w/ DESTDIR defined; by dm@@
@
text
@d1 1
a1 1
#	$OpenBSD: Makefile,v 1.2 1997/04/07 09:00:10 deraadt Exp $
d10 1
a10 1
STRIP=
@


1.2
log
@that is right
@
text
@d1 1
a1 1
#	$OpenBSD: Makefile,v 1.1 1997/03/31 03:12:19 weingart Exp $
d7 2
a8 1
LDFLAGS=-s -Wl,-T0,-N,-x -nostdlib
d15 10
a24 1
all:
@


1.1
log
@Initial /boot stuff (from Mickey)
@
text
@d1 1
a1 1
#	$OpenBSD: Makefile,v 1.3.2.4 1996/10/28 12:14:24 mickey Exp $
a14 1
	# XXX access(2) says X_OK to root even w/o the x bit set !!!
@
