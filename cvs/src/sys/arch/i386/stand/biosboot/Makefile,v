head	1.27;
access;
symbols
	OPENBSD_6_1:1.27.0.4
	OPENBSD_6_1_BASE:1.27
	OPENBSD_6_0:1.26.0.16
	OPENBSD_6_0_BASE:1.26
	OPENBSD_5_9:1.26.0.12
	OPENBSD_5_9_BASE:1.26
	OPENBSD_5_8:1.26.0.14
	OPENBSD_5_8_BASE:1.26
	OPENBSD_5_7:1.26.0.6
	OPENBSD_5_7_BASE:1.26
	OPENBSD_5_6:1.26.0.10
	OPENBSD_5_6_BASE:1.26
	OPENBSD_5_5:1.26.0.8
	OPENBSD_5_5_BASE:1.26
	OPENBSD_5_4:1.26.0.4
	OPENBSD_5_4_BASE:1.26
	OPENBSD_5_3:1.26.0.2
	OPENBSD_5_3_BASE:1.26
	OPENBSD_5_2:1.21.0.38
	OPENBSD_5_2_BASE:1.21
	OPENBSD_5_1_BASE:1.21
	OPENBSD_5_1:1.21.0.36
	OPENBSD_5_0:1.21.0.34
	OPENBSD_5_0_BASE:1.21
	OPENBSD_4_9:1.21.0.32
	OPENBSD_4_9_BASE:1.21
	OPENBSD_4_8:1.21.0.30
	OPENBSD_4_8_BASE:1.21
	OPENBSD_4_7:1.21.0.26
	OPENBSD_4_7_BASE:1.21
	OPENBSD_4_6:1.21.0.28
	OPENBSD_4_6_BASE:1.21
	OPENBSD_4_5:1.21.0.24
	OPENBSD_4_5_BASE:1.21
	OPENBSD_4_4:1.21.0.22
	OPENBSD_4_4_BASE:1.21
	OPENBSD_4_3:1.21.0.20
	OPENBSD_4_3_BASE:1.21
	OPENBSD_4_2:1.21.0.18
	OPENBSD_4_2_BASE:1.21
	OPENBSD_4_1:1.21.0.16
	OPENBSD_4_1_BASE:1.21
	OPENBSD_4_0:1.21.0.14
	OPENBSD_4_0_BASE:1.21
	OPENBSD_3_9:1.21.0.12
	OPENBSD_3_9_BASE:1.21
	OPENBSD_3_8:1.21.0.10
	OPENBSD_3_8_BASE:1.21
	OPENBSD_3_7:1.21.0.8
	OPENBSD_3_7_BASE:1.21
	OPENBSD_3_6:1.21.0.6
	OPENBSD_3_6_BASE:1.21
	SMP_SYNC_A:1.21
	SMP_SYNC_B:1.21
	OPENBSD_3_5:1.21.0.4
	OPENBSD_3_5_BASE:1.21
	OPENBSD_3_4:1.21.0.2
	OPENBSD_3_4_BASE:1.21
	UBC_SYNC_A:1.21
	OPENBSD_3_3:1.20.0.14
	OPENBSD_3_3_BASE:1.20
	OPENBSD_3_2:1.20.0.12
	OPENBSD_3_2_BASE:1.20
	OPENBSD_3_1:1.20.0.10
	OPENBSD_3_1_BASE:1.20
	UBC_SYNC_B:1.20
	UBC:1.20.0.8
	UBC_BASE:1.20
	OPENBSD_3_0:1.20.0.6
	OPENBSD_3_0_BASE:1.20
	OPENBSD_2_9:1.20.0.4
	OPENBSD_2_9_BASE:1.20
	OPENBSD_2_8:1.20.0.2
	OPENBSD_2_8_BASE:1.20
	OPENBSD_2_7:1.18.0.6
	OPENBSD_2_7_BASE:1.18
	SMP:1.18.0.4
	SMP_BASE:1.18
	kame_19991208:1.18
	OPENBSD_2_6:1.18.0.2
	OPENBSD_2_6_BASE:1.18
	OPENBSD_2_5:1.17.0.4
	OPENBSD_2_5_BASE:1.17
	OPENBSD_2_4:1.17.0.2
	OPENBSD_2_4_BASE:1.17
	OPENBSD_2_3:1.15.0.2
	OPENBSD_2_3_BASE:1.15
	OPENBSD_2_2:1.11.0.2
	OPENBSD_2_2_BASE:1.11
	OPENBSD_2_1:1.7.0.2
	OPENBSD_2_1_BASE:1.7;
locks; strict;
comment	@# @;


1.27
date	2016.07.30.03.25.48;	author guenther;	state Exp;
branches;
next	1.26;
commitid	HVbAtwruDlJazNH2;

1.26
date	2013.01.18.21.09.04;	author espie;	state Exp;
branches;
next	1.25;

1.25
date	2013.01.18.04.10.16;	author jsing;	state Exp;
branches;
next	1.24;

1.24
date	2013.01.18.03.45.23;	author jsing;	state Exp;
branches;
next	1.23;

1.23
date	2012.08.29.22.23.07;	author pascal;	state Exp;
branches;
next	1.22;

1.22
date	2012.08.21.14.46.18;	author pascal;	state Exp;
branches;
next	1.21;

1.21
date	2003.04.17.03.43.18;	author drahn;	state Exp;
branches;
next	1.20;

1.20
date	2000.06.08.00.56.07;	author mickey;	state Exp;
branches
	1.20.8.1;
next	1.19;

1.19
date	2000.05.26.11.50.46;	author deraadt;	state Exp;
branches;
next	1.18;

1.18
date	99.07.09.21.13.39;	author deraadt;	state Exp;
branches
	1.18.4.1;
next	1.17;

1.17
date	98.05.28.20.52.34;	author mickey;	state Exp;
branches;
next	1.16;

1.16
date	98.05.25.19.04.50;	author mickey;	state Exp;
branches;
next	1.15;

1.15
date	98.04.13.00.37.40;	author deraadt;	state Exp;
branches;
next	1.14;

1.14
date	98.04.11.22.48.47;	author deraadt;	state Exp;
branches;
next	1.13;

1.13
date	98.04.03.19.09.16;	author deraadt;	state Exp;
branches;
next	1.12;

1.12
date	98.03.30.07.00.28;	author deraadt;	state Exp;
branches;
next	1.11;

1.11
date	97.10.22.23.25.37;	author mickey;	state Exp;
branches;
next	1.10;

1.10
date	97.08.29.22.26.59;	author mickey;	state Exp;
branches;
next	1.9;

1.9
date	97.08.13.04.03.28;	author mickey;	state Exp;
branches;
next	1.8;

1.8
date	97.06.23.23.45.15;	author kstailey;	state Exp;
branches;
next	1.7;

1.7
date	97.04.29.00.10.05;	author mickey;	state Exp;
branches;
next	1.6;

1.6
date	97.04.27.20.56.27;	author millert;	state Exp;
branches;
next	1.5;

1.5
date	97.04.21.20.31.00;	author mickey;	state Exp;
branches;
next	1.4;

1.4
date	97.04.14.11.06.46;	author deraadt;	state Exp;
branches;
next	1.3;

1.3
date	97.03.31.23.06.19;	author mickey;	state Exp;
branches;
next	1.2;

1.2
date	97.03.31.03.12.00;	author weingart;	state Exp;
branches;
next	1.1;

1.1
date	96.12.03.13.16.48;	author mickey;	state dead;
branches
	1.1.2.1;
next	;

1.1.2.1
date	96.12.03.13.16.50;	author mickey;	state Exp;
branches;
next	1.1.2.2;

1.1.2.2
date	97.02.07.07.10.59;	author mickey;	state Exp;
branches;
next	;

1.18.4.1
date	2001.04.18.16.08.38;	author niklas;	state Exp;
branches;
next	1.18.4.2;

1.18.4.2
date	2003.05.13.19.42.09;	author ho;	state Exp;
branches;
next	;

1.20.8.1
date	2003.05.19.21.45.12;	author tedu;	state Exp;
branches;
next	;


desc
@@


1.27
log
@Prep for relro: make sure it's off for any non-PIE stand/ program

ok millert@@ kettenis@@
@
text
@#	$OpenBSD: Makefile,v 1.26 2013/01/18 21:09:04 espie Exp $

MAN=	biosboot.8

.if ${MACHINE} == "i386"
S=	${.CURDIR}/../../../..
SADIR=	${.CURDIR}/..

PROG=	biosboot
SRCS=	biosboot.S
LD=ld
LDFLAGS=-nostdlib -Ttext 0 -N -x -Bstatic -nopie -znorelro
INSTALL_STRIP=

.depend biosboot.o: assym.h

${PROG}: $(OBJS)
	@@rm -f $(PROG)
	$(LD) $(LDFLAGS) -o $(PROG) $(OBJS)
	@@size $(PROG)

CPPFLAGS+=-DLOADADDR=$(LOADADDR) -DLINKADDR=$(LINKADDR) -DBOOTMAGIC=$(BOOTMAGIC)
CPPFLAGS+=${DEBUGFLAGS}
CFLAGS+=-fno-pie
#AFLAGS+=-Wa,-a
AFLAGS+=-fno-pie
.else
NOPROG=
.endif

.include <bsd.prog.mk>
@


1.26
log
@fix bogus dependencies, and allow mkdep to run
checked on amd64 by rpe@@
okay jsing@@
@
text
@d1 1
a1 1
#	$OpenBSD: Makefile,v 1.25 2013/01/18 04:10:16 jsing Exp $
d12 1
a12 1
LDFLAGS=-nostdlib -Ttext 0 -N -x -Bstatic -nopie
@


1.25
log
@Generate assym.h where we need it, instead of reaching around into other
object directories.
@
text
@d1 1
a1 1
#	$OpenBSD: Makefile,v 1.24 2013/01/18 03:45:23 jsing Exp $
d15 1
a15 1
${.CURDIR}/biosboot.S: assym.h
@


1.24
log
@Clean up/standardise makefiles for i386/stand.
@
text
@d1 1
a1 1
#	$OpenBSD: Makefile,v 1.23 2012/08/29 22:23:07 pascal Exp $
d14 2
@


1.23
log
@Kill all NOPIE and NOPIE_FLAGS in i386/stand, replacing them with -fno-pie
and -nopie directly.  Binaries from a PIE system are identical to those from
a recent snapshot.

ok deraadt@@
@
text
@d1 1
a1 1
#	$OpenBSD: Makefile,v 1.22 2012/08/21 14:46:18 pascal Exp $
d6 3
a13 1
SADIR=	${.CURDIR}/..
d15 1
a15 1
${PROG}: $(OBJS) $(DPADD)
d17 1
a17 1
	$(LD) $(LDFLAGS) -o $(PROG) $(OBJS) $(LDADD)
a29 1

@


1.22
log
@Add NOPIE= bits for sys/arch/*/stand to ensure that bootblocks will always be
built with -fno-pie.  This gets the hairiest part of PIE out of the way ...

ok deraadt@@
@
text
@d1 1
a1 1
#	$OpenBSD: Makefile,v 1.21 2003/04/17 03:43:18 drahn Exp $
d9 1
a9 1
LDFLAGS=-nostdlib -Ttext 0 -N -x -Bstatic
d20 1
a20 1
CFLAGS+=${NOPIE_FLAGS}
d22 1
a22 1
AFLAGS+=${NOPIE_FLAGS}
@


1.21
log
@i386 ELF bootloader. developed with weingart@@
@
text
@d1 1
a1 1
#	$OpenBSD: Makefile,v 1.20 2000/06/08 00:56:07 mickey Exp $
d20 1
d22 1
@


1.20
log
@MANSUBDIR is common for this whole dir
@
text
@d1 1
a1 1
#	$OpenBSD: Makefile,v 1.19 2000/05/26 11:50:46 deraadt Exp $
d18 1
a18 1
CPPFLAGS+=-DLOADADDR=$(LOADADDR) -DBOOTMAGIC=$(BOOTMAGIC)
@


1.20.8.1
log
@sync
@
text
@d1 1
a1 1
#	$OpenBSD$
d18 1
a18 1
CPPFLAGS+=-DLOADADDR=$(LOADADDR) -DLINKADDR=$(LINKADDR) -DBOOTMAGIC=$(BOOTMAGIC)
@


1.19
log
@more portable manual pages
@
text
@d1 1
a1 1
#	$OpenBSD: Makefile,v 1.18 1999/07/09 21:13:39 deraadt Exp $
a3 1
MANSUBDIR=/i386
@


1.18
log
@MANSUBDIR
@
text
@d1 1
a1 1
#	$OpenBSD: Makefile,v 1.17 1998/05/28 20:52:34 mickey Exp $
d3 4
a11 2
MAN=	biosboot.8
MANSUBDIR=/i386
a18 2
.include <bsd.prog.mk>

d22 6
@


1.18.4.1
log
@Update the SMP branch to -current, this breaks the SMP branch though.
But it will be fixed soonish.  Note, nothing new has happened, this is just
a merge of the trunk into this branch.
@
text
@d1 1
a1 1
#	$OpenBSD: Makefile,v 1.20 2000/06/08 00:56:07 mickey Exp $
a2 3
MAN=	biosboot.8

.if ${MACHINE} == "i386"
d8 2
d17 2
a21 6
.else
NOPROG=
.endif

.include <bsd.prog.mk>

@


1.18.4.2
log
@Sync the SMP branch to -current, plus some ELF-related fixes.
@
text
@d1 1
a1 1
#	$OpenBSD: Makefile,v 1.18.4.1 2001/04/18 16:08:38 niklas Exp $
d18 1
a18 1
CPPFLAGS+=-DLOADADDR=$(LOADADDR) -DLINKADDR=$(LINKADDR) -DBOOTMAGIC=$(BOOTMAGIC)
@


1.17
log
@cleanup the Makefiles a bit.
make machine link in a smart way, remove unused bits.
@
text
@d1 1
a1 1
#	$OpenBSD: Makefile,v 1.16 1998/05/25 19:04:50 mickey Exp $
d9 1
@


1.16
log
@more CLEANFILES
@
text
@d1 1
a1 1
#	$OpenBSD: Makefile,v 1.15 1998/04/13 00:37:40 deraadt Exp $
a9 8
CLEANFILES=	i386 machine

all:	machine-links

machine-links:
	@@rm -f i386 machine
	@@ln -fs ${.CURDIR}/../.. i386
	@@ln -fs ${.CURDIR}/../../include machine
d18 2
a19 2
CPPFLAGS+=-DLOADADDR=$(LOADADDR) -DBOOTMAGIC=$(BOOTMAGIC) -DBOOTREL=$(BOOTREL)
CPPFLAGS+=${DEBUGFLAGS} -DBEMBR
@


1.15
log
@the problem is in /boot, not in biosboot
@
text
@d1 1
a1 1
#	$OpenBSD: Makefile,v 1.13 1998/04/03 19:09:16 deraadt Exp $
d10 1
@


1.14
log
@Well, the changes make do not work
@
text
@d1 1
a1 1
#	$OpenBSD: Makefile,v 1.12 1998/03/30 07:00:28 deraadt Exp $
d26 1
a26 1
CPPFLAGS+=${DEBUGFLAGS} -DBEMBR -DDEBUG
@


1.13
log
@new changes from weingart: -DDEBUG not needed anymore
@
text
@d26 1
a26 1
CPPFLAGS+=${DEBUGFLAGS} -DBEMBR
@


1.12
log
@temporary fixes to the bootblocks
@
text
@d1 1
a1 1
#	$OpenBSD: Makefile,v 1.11 1997/10/22 23:25:37 mickey Exp $
d26 1
a26 1
CPPFLAGS+=${DEBUGFLAGS} -DBEMBR -DDEBUG
@


1.11
log
@honour DEBUGFLAGS, rm before ld
@
text
@d1 1
a1 1
#	$OpenBSD: Makefile,v 1.10 1997/08/29 22:26:59 mickey Exp $
d26 1
a26 1
CPPFLAGS+=${DEBUGFLAGS} -DBEMBR
@


1.10
log
@ifdef partition table and NT s# w/ BEMBR
@
text
@d1 1
a1 1
#	$OpenBSD: Makefile,v 1.9 1997/08/13 04:03:28 mickey Exp $
d19 1
d26 1
a26 1
CPPFLAGS+=-DBEMBR
@


1.9
log
@split off START into LINKADDR and LOADADDR (we will need reloctable boot)
BOOTREL as a linear address, not segment one
more heap (;
@
text
@d1 1
a1 1
#	$OpenBSD: Makefile,v 1.8 1997/06/23 23:45:15 kstailey Exp $
d25 1
@


1.8
log
@remove @@obj dependency
@
text
@d1 1
a1 1
#	$OpenBSD: Makefile,v 1.7 1997/04/29 00:10:05 mickey Exp $
d24 2
a25 2
CPPFLAGS+=-DSTART=$(START) -DBOOTMAGIC=$(BOOTMAGIC) -DBOOTREL=$(BOOTREL)
# AFLAGS+=-Wa,-a
@


1.7
log
@.mk changes faster then i type....
@
text
@d1 1
a1 1
#	$OpenBSD: Makefile,v 1.6 1997/04/27 20:56:27 millert Exp $
d9 1
@


1.6
log
@COPY -> INSTALL_COPY and STRIP -> INSTALL_STRIP
This fixes namespace problems where STRIP is sometimes used as
the name of the strip(1) to use and other times used as
the flag to send install(1) when stripping (or not).
COPY doesn't have this problem (yet) but was poorly named.
@
text
@d1 1
a1 1
#	$OpenBSD: Makefile,v 1.5 1997/04/21 20:31:00 mickey Exp $
a4 2
# AFLAGS+=-Wa,-a
CPPFLAGS+=-DSTART=$(START) -DBOOTMAGIC=$(BOOTMAGIC) -DBOOTREL=$(BOOTREL)
d23 2
@


1.5
log
@don't use cc for ld, bad things happens w/ DESTDIR defined; by dm@@
@
text
@d1 1
a1 1
#	$OpenBSD: Makefile,v 1.4 1997/04/14 11:06:46 deraadt Exp $
d9 1
a9 1
STRIP=
@


1.4
log
@let stand & boot co-exist
@
text
@d1 1
a1 1
#	$OpenBSD: Makefile,v 1.3 1997/03/31 23:06:19 mickey Exp $
d7 2
a8 1
LDFLAGS=-Wl,-T0,-N,-x -nostdlib
d18 4
@


1.3
log
@commit all my mods to the last imported libsa stuff....
including:
- disklabel support;
- better boot cmd line
- smaller size (using some compilation switches ;)
- no more relocations in /boot, it's loaded in the place;
- better disk performance (maybe were already in there)
- installboot -n does not require write perms for device
- more debugs
- missing parts in libsa (such as cd9660 and so)
- i don't like 2 files for exec_i386 (sorry, toby, let's discuss maybe?)
tricks and tails:
- joined .text and .data (saves you a page)
- prot mode switching still in biosboot (it's freezed for awhile)
- biosdisk internals changed
- biosdev is not passed propery to the kernel (i'll fix it soon)
- sure i missed smth here to note (use the source, Luke!)
@
text
@d1 1
a1 1
#	$OpenBSD: Makefile,v 1.1.2.2 1997/02/07 07:10:59 mickey Exp $
a9 3
LINKS=	${BINDIR}/biosboot ${BINDIR}/fdboot \
	${BINDIR}/biosboot ${BINDIR}/wdboot \
	${BINDIR}/biosboot ${BINDIR}/sdboot \
@


1.2
log
@Initial /boot stuff (from Mickey)
@
text
@d5 2
a6 1
AFLAGS+=-DREL=$(REL) #-Wa,-a
d14 6
a19 7
# XXX - Toby
# These should not output anything, once /boot is loaded, let
# it figure out who to talk to (probe the keyboard).  That way
# we will not need two different types of bootblocks...
#
# Uncomment this to make the boot block talk to a serial port.
# CPPFLAGS+=-DSERIAL=0
d22 1
@


1.1
log
@file Makefile was initially added on branch new.
@
text
@d1 21
@


1.1.2.1
log
@new hierarchy. raw /boot loading, just 1(one) boot stage.
@
text
@a0 17
#	$OpenBSD$

PROG=	biosboot
SRCS=	biosboot.S
AFLAGS=	-DDEBUG -Wa,-a
LDFLAGS=-Wl,-T0,-N,-x -nostdlib -e start
STRIP=
MAN=	biosboot.8
BINDIR=/usr/mdec
LINKS=	${BINDIR}/biosboot ${BINDIR}/fdboot \
	${BINDIR}/biosboot ${BINDIR}/wdboot \
	${BINDIR}/biosboot ${BINDIR}/sdboot \

# Uncomment this to make the boot block talk to a serial port.
# CPPFLAGS+=-DSERIAL=0

.include <bsd.prog.mk>
@


1.1.2.2
log
@latest changes and fixes
@
text
@d1 1
a1 1
#	$OpenBSD: Makefile,v 1.1.2.1 1996/12/03 13:16:50 mickey Exp $
d5 1
a5 1
AFLAGS+=-DDEBUG -Wa,-a
d9 1
@
