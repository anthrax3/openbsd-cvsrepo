head	1.12;
access;
symbols
	OPENBSD_5_5:1.11.0.18
	OPENBSD_5_5_BASE:1.11
	OPENBSD_5_4:1.11.0.14
	OPENBSD_5_4_BASE:1.11
	OPENBSD_5_3:1.11.0.12
	OPENBSD_5_3_BASE:1.11
	OPENBSD_5_2:1.11.0.10
	OPENBSD_5_2_BASE:1.11
	OPENBSD_5_1_BASE:1.11
	OPENBSD_5_1:1.11.0.8
	OPENBSD_5_0:1.11.0.6
	OPENBSD_5_0_BASE:1.11
	OPENBSD_4_9:1.11.0.4
	OPENBSD_4_9_BASE:1.11
	OPENBSD_4_8:1.11.0.2
	OPENBSD_4_8_BASE:1.11
	OPENBSD_4_7:1.10.0.22
	OPENBSD_4_7_BASE:1.10
	OPENBSD_4_6:1.10.0.24
	OPENBSD_4_6_BASE:1.10
	OPENBSD_4_5:1.10.0.20
	OPENBSD_4_5_BASE:1.10
	OPENBSD_4_4:1.10.0.18
	OPENBSD_4_4_BASE:1.10
	OPENBSD_4_3:1.10.0.16
	OPENBSD_4_3_BASE:1.10
	OPENBSD_4_2:1.10.0.14
	OPENBSD_4_2_BASE:1.10
	OPENBSD_4_1:1.10.0.12
	OPENBSD_4_1_BASE:1.10
	OPENBSD_4_0:1.10.0.10
	OPENBSD_4_0_BASE:1.10
	OPENBSD_3_9:1.10.0.8
	OPENBSD_3_9_BASE:1.10
	OPENBSD_3_8:1.10.0.6
	OPENBSD_3_8_BASE:1.10
	OPENBSD_3_7:1.10.0.4
	OPENBSD_3_7_BASE:1.10
	OPENBSD_3_6:1.10.0.2
	OPENBSD_3_6_BASE:1.10
	SMP_SYNC_A:1.8
	SMP_SYNC_B:1.8
	OPENBSD_3_5:1.8.0.2
	OPENBSD_3_5_BASE:1.8
	OPENBSD_3_4:1.7.0.2
	OPENBSD_3_4_BASE:1.7
	UBC_SYNC_A:1.6
	OPENBSD_3_3:1.6.0.4
	OPENBSD_3_3_BASE:1.6
	OPENBSD_3_2:1.6.0.2
	OPENBSD_3_2_BASE:1.6
	OPENBSD_3_1:1.5.0.2
	OPENBSD_3_1_BASE:1.5
	UBC_SYNC_B:1.6
	UBC:1.4.0.10
	UBC_BASE:1.4
	OPENBSD_3_0:1.4.0.8
	OPENBSD_3_0_BASE:1.4
	OPENBSD_2_9:1.4.0.6
	OPENBSD_2_9_BASE:1.4
	OPENBSD_2_8:1.4.0.4
	OPENBSD_2_8_BASE:1.4
	OPENBSD_2_7:1.4.0.2
	OPENBSD_2_7_BASE:1.4
	SMP:1.3.0.16
	SMP_BASE:1.3
	kame_19991208:1.3
	OPENBSD_2_6:1.3.0.14
	OPENBSD_2_6_BASE:1.3
	OPENBSD_2_5:1.3.0.12
	OPENBSD_2_5_BASE:1.3
	OPENBSD_2_4:1.3.0.10
	OPENBSD_2_4_BASE:1.3
	OPENBSD_2_3:1.3.0.8
	OPENBSD_2_3_BASE:1.3
	OPENBSD_2_2:1.3.0.6
	OPENBSD_2_2_BASE:1.3
	OPENBSD_2_1:1.3.0.4
	OPENBSD_2_1_BASE:1.3
	OPENBSD_2_0:1.3.0.2
	OPENBSD_2_0_BASE:1.3
	theo-1:1.1.1.1;
locks; strict;
comment	@ * @;


1.12
date	2014.03.18.22.36.34;	author miod;	state dead;
branches;
next	1.11;

1.11
date	2010.06.26.23.24.43;	author guenther;	state Exp;
branches;
next	1.10;

1.10
date	2004.07.30.22.29.45;	author miod;	state Exp;
branches;
next	1.9;

1.9
date	2004.07.02.17.57.29;	author miod;	state Exp;
branches;
next	1.8;

1.8
date	2004.01.14.20.50.48;	author miod;	state Exp;
branches;
next	1.7;

1.7
date	2003.06.02.05.09.14;	author deraadt;	state Exp;
branches;
next	1.6;

1.6
date	2002.04.27.23.21.05;	author miod;	state Exp;
branches;
next	1.5;

1.5
date	2002.03.14.01.26.37;	author millert;	state Exp;
branches;
next	1.4;

1.4
date	2000.03.26.23.31.59;	author deraadt;	state Exp;
branches
	1.4.10.1;
next	1.3;

1.3
date	96.04.28.11.06.07;	author deraadt;	state Exp;
branches
	1.3.16.1;
next	1.2;

1.2
date	95.11.07.08.49.08;	author deraadt;	state Exp;
branches;
next	1.1;

1.1
date	95.10.18.10.43.06;	author deraadt;	state Exp;
branches
	1.1.1.1;
next	;

1.1.1.1
date	95.10.18.10.43.06;	author deraadt;	state Exp;
branches;
next	;

1.3.16.1
date	2001.04.18.16.10.23;	author niklas;	state Exp;
branches;
next	1.3.16.2;

1.3.16.2
date	2002.03.28.10.34.05;	author niklas;	state Exp;
branches;
next	1.3.16.3;

1.3.16.3
date	2003.03.27.23.32.16;	author niklas;	state Exp;
branches;
next	1.3.16.4;

1.3.16.4
date	2003.06.07.11.13.15;	author ho;	state Exp;
branches;
next	1.3.16.5;

1.3.16.5
date	2004.02.19.10.49.04;	author niklas;	state Exp;
branches;
next	;

1.4.10.1
date	2002.06.11.03.36.49;	author art;	state Exp;
branches;
next	;


desc
@@


1.12
log
@Retire hp300, mvme68k and mvme88k ports. These ports have no users, keeping
this hardware alive is becoming increasingly difficult, and I should heed the
message sent by the three disks which have died on me over the last few days.

Noone sane will mourn these ports anyway. So long, and thanks for the fish.
@
text
@/*	$OpenBSD: lp.c,v 1.11 2010/06/26 23:24:43 guenther Exp $ */

/*
 * Copyright (c) 1995 Theo de Raadt
 * All rights reserved.
 *
 * Redistribution and use in source and binary forms, with or without
 * modification, are permitted provided that the following conditions
 * are met:
 * 1. Redistributions of source code must retain the above copyright
 *    notice, this list of conditions and the following disclaimer.
 * 2. Redistributions in binary form must reproduce the above copyright
 *    notice, this list of conditions and the following disclaimer in the
 *    documentation and/or other materials provided with the distribution.
 *
 * THIS SOFTWARE IS PROVIDED BY THE AUTHOR ``AS IS'' AND ANY EXPRESS OR
 * IMPLIED WARRANTIES, INCLUDING, BUT NOT LIMITED TO, THE IMPLIED WARRANTIES
 * OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE ARE DISCLAIMED.
 * IN NO EVENT SHALL THE AUTHOR BE LIABLE FOR ANY DIRECT, INDIRECT,
 * INCIDENTAL, SPECIAL, EXEMPLARY, OR CONSEQUENTIAL DAMAGES (INCLUDING, BUT
 * NOT LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES; LOSS OF USE,
 * DATA, OR PROFITS; OR BUSINESS INTERRUPTION) HOWEVER CAUSED AND ON ANY
 * THEORY OF LIABILITY, WHETHER IN CONTRACT, STRICT LIABILITY, OR TORT
 * (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE USE OF
 * THIS SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.
 */

#include <sys/param.h>
#include <sys/ioctl.h>
#include <sys/proc.h>
#include <sys/tty.h>
#include <sys/uio.h>
#include <sys/systm.h>
#include <sys/kernel.h>
#include <sys/syslog.h>
#include <sys/fcntl.h>
#include <sys/device.h>

#include <machine/autoconf.h>
#include <machine/conf.h>
#include <machine/cpu.h>

#include <mvme68k/dev/pccreg.h>

struct lpsoftc {
	struct device	sc_dev;
	struct intrhand	sc_ih;
};

void lpattach(struct device *, struct device *, void *);
int  lpmatch(struct device *, void *, void *);

struct cfattach lp_ca = {
	sizeof(struct lpsoftc), lpmatch, lpattach
};

struct cfdriver lp_cd = {
	NULL, "lp", DV_DULL
};

int lpintr(void *);

/*
 * a PCC chip always has an lp attached to it.
 */
int
lpmatch(parent, cf, args)
	struct device *parent;
	void *cf;
	void *args;
{
	return (1);
}

void
lpattach(parent, self, args)
	struct device *parent, *self;
	void *args;
{
	struct lpsoftc *sc = (struct lpsoftc *)self;
	struct confargs *ca = args;

	printf(": unsupported\n");

	sc->sc_ih.ih_fn = lpintr;
	sc->sc_ih.ih_arg = sc;
	sc->sc_ih.ih_ipl = ca->ca_ipl;
	pccintr_establish(PCCV_PRINTER, &sc->sc_ih, self->dv_xname);

	sys_pcc->pcc_lpirq = ca->ca_ipl | PCC_IRQ_IEN | PCC_LPIRQ_ACK;
}

int
lpintr(dev)
	void *dev;
{
	return (0);
}

/*ARGSUSED*/
int
lpopen(dev, flag, mode, p)
	dev_t dev;
	int flag, mode;
	struct proc *p;
{

	return (0);
}

/*ARGSUSED*/
int
lpclose(dev, flag, mode, p)
	dev_t dev;
	int flag, mode;
	struct proc *p;
{

	return (0);
}

/*ARGSUSED*/
int
lpwrite(dev, uio, flags)
	dev_t dev;
	struct uio *uio;
	int flags;
{
	return (EOPNOTSUPP);
}

int
lpioctl(dev, cmd, data, flag, p)
	dev_t dev;
	u_long cmd;
	caddr_t data;
	int flag;
	struct proc *p;
{
	return (EOPNOTSUPP);
}

@


1.11
log
@Don't #include <sys/user.h> into files that don't need the stuff
it defines.  In some cases, this means pulling in uvm.h or pcb.h
instead, but most of the inclusions were just noise.  Tested on
alpha, amd64, armish, hppa, i386, macpcc, sgi, sparc64, and vax,
mostly by krw and naddy.
ok krw@@
@
text
@d1 1
a1 1
/*	$OpenBSD: lp.c,v 1.10 2004/07/30 22:29:45 miod Exp $ */
@


1.10
log
@Move struct evcount inside struct intrhand, and modernize intrhand
usage; similar to (and from) mvme88k.

Also remove unused haltvec structures and related code.
@
text
@d1 1
a1 1
/*	$OpenBSD: lp.c,v 1.9 2004/07/02 17:57:29 miod Exp $ */
a30 1
#include <sys/user.h>
@


1.9
log
@Kill ca_master in autoconf structures. Drivers either only attach to one
specific bus (mc/pcc/pcctwo), or they know it from the ca_bustype value,
and can use the globals sys_busname variables.

This also allows for some code simplifications.
@
text
@d1 1
a1 1
/*	$OpenBSD: lp.c,v 1.8 2004/01/14 20:50:48 miod Exp $ */
d89 1
a89 1
	pccintr_establish(PCCV_PRINTER, &sc->sc_ih);
@


1.8
log
@Do not fill more than the first three fields of cfdriver structures unless
necessary. No functional change.
@
text
@d1 1
a1 1
/*	$OpenBSD: lp.c,v 1.7 2003/06/02 05:09:14 deraadt Exp $ */
a48 1
	struct pccreg	*sc_pcc;
a83 2
	sc->sc_pcc = (struct pccreg *)ca->ca_master;

d91 1
a91 1
	sc->sc_pcc->pcc_lpirq = ca->ca_ipl | PCC_IRQ_IEN | PCC_LPIRQ_ACK;
@


1.7
log
@license cleanup of my files
@
text
@d1 1
a1 1
/*	$OpenBSD: lp.c,v 1.6 2002/04/27 23:21:05 miod Exp $ */
d60 1
a60 1
	NULL, "lp", DV_DULL, 0
@


1.6
log
@Jumbo commit to fix all compilation warnings on mvme68k (add prototypes,
add casts, fix a few errors and typos in the process, etc)
@
text
@d1 1
a1 1
/*	$OpenBSD: lp.c,v 1.5 2002/03/14 01:26:37 millert Exp $ */
a14 6
 * 3. All advertising materials mentioning features or use of this software
 *    must display the following acknowledgement:
 *      This product includes software developed under OpenBSD by
 *	Theo de Raadt for Willowglen Singapore.
 * 4. The name of the author may not be used to endorse or promote products
 *    derived from this software without specific prior written permission.
@


1.5
log
@First round of __P removal in sys
@
text
@d1 1
a1 1
/*	$OpenBSD: lp.c,v 1.4 2000/03/26 23:31:59 deraadt Exp $ */
a34 1
#include <sys/conf.h>
d45 1
d47 1
d49 1
a106 2
	struct lpsoftc *sc = dev; 

d112 1
a112 1
lpopen(dev, flag, mode)
d115 1
d123 1
a123 1
lpclose(dev, flag, mode)
d126 1
d139 1
d142 1
d150 1
@


1.4
log
@callout.h is gone
@
text
@d1 1
a1 1
/*	$OpenBSD: lp.c,v 1.3 1996/04/28 11:06:07 deraadt Exp $ */
d56 2
a57 2
void lpattach __P((struct device *, struct device *, void *));
int  lpmatch __P((struct device *, void *, void *));
d67 1
a67 1
int lpintr __P((void *));
@


1.4.10.1
log
@Sync UBC branch to -current
@
text
@d1 1
a1 1
/*	$OpenBSD: lp.c,v 1.4 2000/03/26 23:31:59 deraadt Exp $ */
d35 1
a45 1

a46 1
#include <machine/conf.h>
a47 1

d56 2
a57 2
void lpattach(struct device *, struct device *, void *);
int  lpmatch(struct device *, void *, void *);
d67 1
a67 1
int lpintr(void *);
d105 2
d112 1
a112 1
lpopen(dev, flag, mode, p)
a114 1
	struct proc *p;
d122 1
a122 1
lpclose(dev, flag, mode, p)
a124 1
	struct proc *p;
a136 1
	return (EOPNOTSUPP);
a138 1
int
a145 1
	return (EOPNOTSUPP);
@


1.3
log
@cfattach/cfdriver split
@
text
@d1 1
a1 1
/*	$OpenBSD$ */
a40 1
#include <sys/callout.h>
@


1.3.16.1
log
@Update the SMP branch to -current, this breaks the SMP branch though.
But it will be fixed soonish.  Note, nothing new has happened, this is just
a merge of the trunk into this branch.
@
text
@d1 1
a1 1
/*	$OpenBSD: lp.c,v 1.4 2000/03/26 23:31:59 deraadt Exp $ */
d41 1
@


1.3.16.2
log
@Merge in -current from about a week ago
@
text
@d1 1
a1 1
/*	$OpenBSD$ */
d56 2
a57 2
void lpattach(struct device *, struct device *, void *);
int  lpmatch(struct device *, void *, void *);
d67 1
a67 1
int lpintr(void *);
@


1.3.16.3
log
@Sync the SMP branch with 3.3
@
text
@d35 1
a45 1

a46 1
#include <machine/conf.h>
a47 1

d105 2
d112 1
a112 1
lpopen(dev, flag, mode, p)
a114 1
	struct proc *p;
d122 1
a122 1
lpclose(dev, flag, mode, p)
a124 1
	struct proc *p;
a136 1
	return (EOPNOTSUPP);
a138 1
int
a145 1
	return (EOPNOTSUPP);
@


1.3.16.4
log
@Sync SMP branch to -current
@
text
@d1 1
a1 1
/*	$OpenBSD: lp.c,v 1.3.16.3 2003/03/27 23:32:16 niklas Exp $ */
d15 6
@


1.3.16.5
log
@Merge of current from two weeks agointo the SMP branch
@
text
@d1 1
a1 1
/*	$OpenBSD$ */
d60 1
a60 1
	NULL, "lp", DV_DULL
@


1.2
log
@$Id$ throughout
update many copyrights
@
text
@d1 1
a1 1
/*	$Id$ */
d60 6
a65 3
struct cfdriver lpcd = {
	NULL, "lp", lpmatch, lpattach,
	DV_DULL, sizeof(struct lpsoftc), 0
@


1.1
log
@Initial revision
@
text
@d1 1
a1 1
/*	$NetBSD$ */
d17 2
a18 1
 *      This product includes software developed by Theo de Raadt
@


1.1.1.1
log
@mvme68k port by me. some parts by dale rahn.
@
text
@@
