head	1.37;
access;
symbols
	OPENBSD_6_1:1.33.0.4
	OPENBSD_6_1_BASE:1.33
	OPENBSD_6_0:1.31.0.2
	OPENBSD_6_0_BASE:1.31
	OPENBSD_5_9:1.28.0.2
	OPENBSD_5_9_BASE:1.28
	OPENBSD_5_8:1.24.0.4
	OPENBSD_5_8_BASE:1.24
	OPENBSD_5_7:1.20.0.2
	OPENBSD_5_7_BASE:1.20
	OPENBSD_5_6:1.19.0.4
	OPENBSD_5_6_BASE:1.19
	OPENBSD_5_5:1.17.0.4
	OPENBSD_5_5_BASE:1.17
	OPENBSD_5_4:1.13.0.2
	OPENBSD_5_4_BASE:1.13
	OPENBSD_5_3:1.12.0.2
	OPENBSD_5_3_BASE:1.12
	OPENBSD_5_2:1.11.0.6
	OPENBSD_5_2_BASE:1.11
	OPENBSD_5_1_BASE:1.11
	OPENBSD_5_1:1.11.0.4
	OPENBSD_5_0:1.11.0.2
	OPENBSD_5_0_BASE:1.11
	OPENBSD_4_9:1.6.0.2
	OPENBSD_4_9_BASE:1.6;
locks; strict;
comment	@# @;


1.37
date	2017.06.18.13.58.44;	author visa;	state Exp;
branches;
next	1.36;
commitid	dEB6EZ6sWrUWvyR2;

1.36
date	2017.06.05.15.23.11;	author visa;	state Exp;
branches;
next	1.35;
commitid	iUFbc1kKgMfuS7an;

1.35
date	2017.05.02.13.26.49;	author visa;	state Exp;
branches;
next	1.34;
commitid	RNCOX3BHktrY156Z;

1.34
date	2017.04.24.13.54.28;	author visa;	state Exp;
branches;
next	1.33;
commitid	g9vgEuGpyvXOjUXp;

1.33
date	2016.12.21.13.59.57;	author visa;	state Exp;
branches;
next	1.32;
commitid	p6zUhTuh4cX1l0nl;

1.32
date	2016.12.08.16.24.51;	author visa;	state Exp;
branches;
next	1.31;
commitid	a5qzHlIr7njfoVqO;

1.31
date	2016.07.05.12.53.40;	author visa;	state Exp;
branches;
next	1.30;
commitid	V7rhXg2XswiwjQlB;

1.30
date	2016.07.01.15.12.37;	author visa;	state Exp;
branches;
next	1.29;
commitid	OBMBIbYFQmMsJKTC;

1.29
date	2016.03.18.05.38.10;	author jmatthew;	state Exp;
branches;
next	1.28;
commitid	jF5raQOhBtwKW5eh;

1.28
date	2016.01.14.17.20.34;	author visa;	state Exp;
branches;
next	1.27;
commitid	35peyKf2ATuNUm6r;

1.27
date	2016.01.08.15.54.13;	author jcs;	state Exp;
branches;
next	1.26;
commitid	kI4H556ZKYkRQGw5;

1.26
date	2015.09.09.15.48.52;	author visa;	state Exp;
branches;
next	1.25;
commitid	LCIA9B8f4l6PgPcB;

1.25
date	2015.08.18.12.49.41;	author visa;	state Exp;
branches;
next	1.24;
commitid	k0erlGYWoqot9msb;

1.24
date	2015.07.20.19.44.32;	author pirofti;	state Exp;
branches;
next	1.23;
commitid	8BQ1mX3eNLtSDODb;

1.23
date	2015.07.19.23.46.50;	author jasper;	state Exp;
branches;
next	1.22;
commitid	srHxICmjHBgmnrAl;

1.22
date	2015.07.13.19.05.23;	author miod;	state Exp;
branches;
next	1.21;
commitid	Zz1PviK9rGK25Fmx;

1.21
date	2015.07.08.13.37.31;	author dlg;	state Exp;
branches;
next	1.20;
commitid	Ds9kNjjKbF4CbIsT;

1.20
date	2015.02.11.00.15.41;	author uebayasi;	state Exp;
branches;
next	1.19;
commitid	wPaMk1TOUMG2AZZI;

1.19
date	2014.07.11.21.54.38;	author tedu;	state Exp;
branches;
next	1.18;
commitid	0n9cIGBISFAEt4b1;

1.18
date	2014.07.09.23.03.22;	author pirofti;	state Exp;
branches;
next	1.17;
commitid	14P6M4E3tXc8O5vd;

1.17
date	2014.01.15.10.36.10;	author pirofti;	state Exp;
branches;
next	1.16;

1.16
date	2013.11.04.14.07.16;	author deraadt;	state Exp;
branches;
next	1.15;

1.15
date	2013.10.24.20.47.08;	author pirofti;	state Exp;
branches;
next	1.14;

1.14
date	2013.08.15.06.54.35;	author kettenis;	state Exp;
branches;
next	1.13;

1.13
date	2013.03.26.18.46.55;	author jasper;	state Exp;
branches;
next	1.12;

1.12
date	2013.02.03.22.35.52;	author bcallah;	state Exp;
branches;
next	1.11;

1.11
date	2011.07.03.20.40.17;	author yasuoka;	state Exp;
branches;
next	1.10;

1.10
date	2011.06.16.11.22.30;	author syuu;	state Exp;
branches;
next	1.9;

1.9
date	2011.05.15.08.52.48;	author matthieu;	state Exp;
branches;
next	1.8;

1.8
date	2011.05.08.13.39.30;	author syuu;	state Exp;
branches;
next	1.7;

1.7
date	2011.05.08.13.24.55;	author syuu;	state Exp;
branches;
next	1.6;

1.6
date	2010.10.28.22.50.49;	author syuu;	state Exp;
branches;
next	1.5;

1.5
date	2010.10.26.00.02.01;	author syuu;	state Exp;
branches;
next	1.4;

1.4
date	2010.10.10.16.38.55;	author syuu;	state Exp;
branches;
next	1.3;

1.3
date	2010.10.01.16.13.59;	author syuu;	state Exp;
branches;
next	1.2;

1.2
date	2010.09.21.06.21.00;	author syuu;	state Exp;
branches;
next	1.1;

1.1
date	2010.09.20.06.32.30;	author syuu;	state Exp;
branches;
next	;


desc
@@


1.37
log
@Split octeon interrupt code into a glue layer and a CIU driver.
This makes possible to add drivers for other interrupt controllers
on the platform.

The glue layer has been derived from arm64/armv7.
@
text
@#	$OpenBSD: files.octeon,v 1.36 2017/06/05 15:23:11 visa Exp $

# Standard stanzas config(8) can't run without
maxpartitions 16
maxusers 2 8 64

# Major number for block devices, for ``root on'' lines
major	{ sd = 0 }
major	{ cd = 3 }
major	{ wd = 4 }
major	{ rd = 8 }
major	{ octcf = 15 }
major	{ amdcf = 19 }

file	dev/cninit.c
file	dev/ofw/fdt.c
file	arch/octeon/octeon/autoconf.c
file	arch/octeon/octeon/bus_dma.c
file	arch/octeon/octeon/conf.c
file	arch/octeon/octeon/disksubr.c		disk
file	arch/octeon/octeon/machdep.c
file	arch/octeon/octeon/cn3xxx_dts.S
file	arch/octeon/octeon/locore.S

include "dev/ata/files.ata"
include "dev/atapiscsi/files.atapiscsi"
include	"dev/hid/files.hid"
include	"dev/i2c/files.i2c"
include	"dev/gpio/files.gpio"
include	"dev/isa/files.isa"
include	"dev/isa/files.isapnp"
include	"dev/mii/files.mii"
include	"dev/onewire/files.onewire"
include	"dev/pci/files.pci"
include	"dev/pckbc/files.pckbc"
include	"dev/sdmmc/files.sdmmc"
include	"dev/usb/files.usb"
include	"dev/usb/dwc2/files.dwc2"
include "dev/rasops/files.rasops"
include "dev/wscons/files.wscons"
include "dev/wsfont/files.wsfont"
include	"scsi/files.scsi"

define	mainbus {}
device	mainbus
attach	mainbus at root
file	arch/octeon/dev/mainbus.c			mainbus

device	cpu
attach	cpu at mainbus

device	clock
attach	clock at mainbus

# TOD clock
device	octrtc
attach	octrtc at mainbus
file	arch/octeon/dev/octrtc.c			octrtc

define	iobus {[base = -1], [irq = 0]}
device	iobus
attach	iobus at mainbus
file	arch/octeon/dev/octeon_iobus.c			iobus
file	arch/octeon/dev/octeon_intr.c			iobus
file	arch/octeon/dev/cn30xxfpa.c			iobus
file	arch/octeon/dev/cn30xxpow.c			iobus
file	arch/octeon/dev/cn30xxfau.c			iobus
file	arch/octeon/dev/cn30xxpip.c			iobus
file	arch/octeon/dev/cn30xxipd.c			iobus
file	arch/octeon/dev/cn30xxpko.c			iobus
file	arch/octeon/dev/cn30xxasx.c			iobus

define	fdt {[early = 0]}

device	simplebus: fdt
attach	simplebus at fdt, iobus
file	arch/octeon/dev/simplebus.c			simplebus

# On-board USB
attach	dwctwo at iobus with octdwctwo
file	arch/octeon/dev/octdwctwo.c			octdwctwo	needs-flag

device	octuctl {}
attach	octuctl at iobus
file	arch/octeon/dev/octuctl.c			octuctl		needs-flag
attach	ehci at octuctl with octehci
file	arch/octeon/dev/octehci.c			octehci
attach	ohci at octuctl with octohci
file	arch/octeon/dev/octohci.c			octohci

# On-board CF
device	octcf: disk
attach	octcf at iobus
file	arch/octeon/dev/octcf.c				octcf

device	amdcf: disk
attach	amdcf at iobus
file	arch/octeon/dev/amdcf.c				amdcf


# On-board RNG
device	octrng
attach	octrng at iobus
file	arch/octeon/dev/octrng.c			octrng

device	cn30xxsmi {}
attach	cn30xxsmi at fdt
file	arch/octeon/dev/cn30xxsmi.c			cn30xxsmi

device	cn30xxgmx {}
attach	cn30xxgmx at iobus
file	arch/octeon/dev/cn30xxgmx.c			cn30xxgmx

device	cnmac: ether, ifnet, mii, ifmedia
attach	cnmac at cn30xxgmx
file	arch/octeon/dev/if_cnmac.c			cnmac

define	uartbus {[base = -1]}
device	uartbus
attach	uartbus at mainbus
file	arch/octeon/dev/octeon_uartbus.c		uartbus

attach	com at uartbus with cn30xxuart
file	arch/octeon/dev/cn30xxuart.c			cn30xxuart

device	pcibus
attach	pcibus at iobus
file	arch/octeon/dev/octeon_pcibus.c			pcibus
file	arch/octeon/dev/octeon_bus_space.c

file	arch/octeon/octeon/pciide_machdep.c		pciide

device	octciu
attach	octciu at fdt
file	arch/octeon/dev/octciu.c			octciu

device	octmmc: sdmmcbus
attach	octmmc at fdt
file	arch/octeon/dev/octmmc.c			octmmc

pseudo-device	openprom
file	arch/octeon/octeon/openprom.c			openprom needs-flag
@


1.36
log
@Randomize the link order of .o files in the kernel on octeon.
Unlike on some other architectures, it is not possible to unmap
the early boot code. Instead, the code is smashed during boot.

Input from deraadt@@
@
text
@d1 1
a1 1
#	$OpenBSD: files.octeon,v 1.35 2017/05/02 13:26:49 visa Exp $
d132 4
@


1.35
log
@Revise MDIO driver code so that device instances can be attached
using fdt. This lets the system utilize multiple MDIO controllers.

This patch enables all RJ45 Ethernet ports on EdgeRouter Pro.
The SFP module slots do not work yet.

OK kettenis@@, jmatthew@@
@
text
@d1 1
a1 1
#	$OpenBSD: files.octeon,v 1.34 2017/04/24 13:54:28 visa Exp $
d23 1
@


1.34
log
@Add an fdt blob for octeon systems whose firmware does not provide
a device-tree. It will be needed later when more device drivers
are attached using fdt.

OK kettenis@@
@
text
@d1 1
a1 1
#	$OpenBSD: files.octeon,v 1.33 2016/12/21 13:59:57 visa Exp $
a70 1
file	arch/octeon/dev/cn30xxsmi.c			iobus
d104 4
@


1.33
log
@Add a driver for OCTEON MMC host controller.

Tested on EdgeRouter Pro, and Shasta.

OK mpi@@
@
text
@d1 1
a1 1
#	$OpenBSD: files.octeon,v 1.32 2016/12/08 16:24:51 visa Exp $
d22 1
@


1.32
log
@Add fdt_attach_args and simplebus for implementing fdt-capable
drivers on octeon. Adapted from armv7.

ok kettenis@@
@
text
@d1 1
a1 1
#	$OpenBSD: files.octeon,v 1.31 2016/07/05 12:53:40 visa Exp $
d34 1
d77 1
a77 1
 
d127 4
@


1.31
log
@Add openprom(4) for octeon.

ok kettenis@@ deraadt@@ jasper@@
@
text
@d1 1
a1 1
#	$OpenBSD: files.octeon,v 1.30 2016/07/01 15:12:37 visa Exp $
d70 6
@


1.30
log
@Add fdt init for octeon.
@
text
@d1 1
a1 1
#	$OpenBSD: files.octeon,v 1.29 2016/03/18 05:38:10 jmatthew Exp $
d120 3
@


1.29
log
@add octuctl, a driver for the Octeon II usb controller interface, and
attachments for ehci and ohci.

ok uebayasi@@ jasper@@ visa@@ mpi@@
@
text
@d1 1
a1 1
#	$OpenBSD: files.octeon,v 1.28 2016/01/14 17:20:34 visa Exp $
d16 1
@


1.28
log
@Add support for a variety of USB devices.

Initial diff from Artturi Alm, ok jasper@@
@
text
@d1 1
a1 1
#	$OpenBSD: files.octeon,v 1.27 2016/01/08 15:54:13 jcs Exp $
d73 8
@


1.27
log
@Move HID support files out of dev/usb into new dev/hid directory

These files aren't USB-specific and were used by the previous
Bluetooth implementation, and will be used by the upcoming
HID-over-i2C implementation

ok deraadt
previous version ok kettenis and mpi
@
text
@d1 1
a1 1
#	$OpenBSD: files.octeon,v 1.26 2015/09/09 15:48:52 visa Exp $
d30 1
@


1.26
log
@The mplock implementations on MP-enabled mips64 platforms, octeon and
sgi, are identical. Put one implementation in mips64 and drop the
platform-specific copies, to remove duplicated code.

ok miod@@
@
text
@d1 1
a1 1
#	$OpenBSD: files.octeon,v 1.25 2015/08/18 12:49:41 visa Exp $
d24 1
@


1.25
log
@Unbreak Octeon kernel config after r1.25 of files.mips64.

Feedback and ok miod@@
@
text
@d1 1
a1 1
#	$OpenBSD: files.octeon,v 1.24 2015/07/20 19:44:32 pirofti Exp $
a19 1
file	arch/octeon/octeon/lock_machdep.c	multiprocessor
@


1.24
log
@Add a new flash driver for Octeon that allows access to the internal
memory on (at least) D-Link DSR500 machines.

This follows the CFI specification with code borrowed from zrouter
(FreeBSD). The idea, once the current driver is thoroughly tested, would
be to move it to MI land.

The prerequisites to MI are width, shift and row detection and handling.
In the long run I hope to be able to also add wdc support.

For now write support is disabled.

Okay miod@@, deraadt@@.
@
text
@d1 1
a1 1
#	$OpenBSD: files.octeon,v 1.23 2015/07/19 23:46:50 jasper Exp $
a21 1
file	arch/mips64/mips64/mips64r2.S
@


1.23
log
@rework how iobus(4) finds and attaches devices.

this allows us to get rid of the static list of children devices, using only
a lookup table for address hints where needed. as a bonus this removes the
'octcf0: [..] not configured' mesage on machines w/o octcf(4).

tested by pirofti@@ on DSR-500 and ERL by me
ok miod@@
@
text
@d1 1
a1 1
#	$OpenBSD: files.octeon,v 1.22 2015/07/13 19:05:23 miod Exp $
d13 1
d78 5
@


1.22
log
@Do not attempt to configure octhci, superseded by dwc2
@
text
@d1 1
a1 1
#	$OpenBSD: files.octeon,v 1.21 2015/07/08 13:37:31 dlg Exp $
d55 1
a55 1
define	iobus {[base = -1]}
@


1.21
log
@unify the mutex implementations on all the mips64 platforms.

this basically copies the sgi implementation to mips64 and removes
it from the rest. this way they get an optimised UP mutex implementation
and correct asserts on all platforms.

ok miod@@ jmatthew@@
@
text
@d1 1
a1 1
#	$OpenBSD: files.octeon,v 1.20 2015/02/11 00:15:41 uebayasi Exp $
d69 1
a104 5

# On-board USB
device	octhci: usbus
attach	octhci at iobus
file	arch/octeon/dev/octhci.c			octhci
@


1.20
log
@Minimal attachment to build-test dwc2(4).
@
text
@d1 1
a1 1
#	$OpenBSD$
a21 1
file	arch/octeon/octeon/mutex.c
@


1.19
log
@"It's not the years, honey; it's the mileage."

bluetooth support doesn't work and isn't going anywhere. the current
design is a dead end, and should not be the basis for any future support.
general consensus says to whack it so as to not mislead the unwary.
@
text
@d1 1
a1 1
#	$OpenBSD: files.octeon,v 1.18 2014/07/09 23:03:22 pirofti Exp $
d34 1
d69 3
@


1.18
log
@Add work-in-progress octeon USB host controller support.

Not enabled for now. It's easier for me to work on it in-tree.

Discussed with and okay miod@@
@
text
@d1 1
a1 1
#	$OpenBSD: files.octeon,v 1.17 2014/01/15 10:36:10 pirofti Exp $
a33 1
include "dev/bluetooth/files.bluetooth"
@


1.17
log
@Enable by default the DS1337 TOD clock.
@
text
@d1 1
a1 1
#	$OpenBSD: files.octeon,v 1.16 2013/11/04 14:07:16 deraadt Exp $
d102 5
@


1.16
log
@remove iop(4) driver.  it is entirely unmaintained and supports something
which basically doesn't exist at all.
reminded about it by brad
@
text
@d1 1
a1 1
#	$OpenBSD: files.octeon,v 1.15 2013/10/24 20:47:08 pirofti Exp $
d50 5
@


1.15
log
@Enable octrng(4).
@
text
@d1 1
a1 1
#	$OpenBSD: files.octeon,v 1.14 2013/08/15 06:54:35 kettenis Exp $
a27 1
include	"dev/i2o/files.i2o"
@


1.14
log
@Include files.agp and files.drm from files.pci.  Makes sure "drm.h" gets
generated on all architectures that support pci, making alpha and loongson
compile again.

ok todd@@, miod@@ seemed to agree with the idea
@
text
@d1 1
a1 1
#	$OpenBSD: files.octeon,v 1.13 2013/03/26 18:46:55 jasper Exp $
d70 5
@


1.13
log
@move octcf bits together
@
text
@d1 1
a1 1
#	$OpenBSD: files.octeon,v 1.12 2013/02/03 22:35:52 bcallah Exp $
a32 1
include	"dev/pci/files.agp"
@


1.12
log
@Let the octeon kernel link properly.

ok miod@@
@
text
@d1 1
a1 1
#	$OpenBSD: files.octeon,v 1.11 2011/07/03 20:40:17 yasuoka Exp $
d69 2
a78 3

attach	octcf at iobus
file	arch/octeon/dev/octcf.c				octcf
@


1.11
log
@Add blank line to keep consistent spacing.  From brad@@
@
text
@d1 1
a1 1
#	$OpenBSD: files.octeon,v 1.10 2011/06/16 11:22:30 syuu Exp $
d21 1
@


1.10
log
@Ethernet driver merged from IIJ's contribution code.
@
text
@d1 1
a1 1
#	$OpenBSD: files.octeon,v 1.9 2011/05/15 08:52:48 matthieu Exp $
d76 1
@


1.9
log
@Remove unused include of file.pckbdc. Those arches do not have
a PC/AT or PS/2 keyboard/mouse controller. ok miod@@
@
text
@d1 1
a1 1
#	$OpenBSD: files.octeon,v 1.8 2011/05/08 13:39:30 syuu Exp $
d33 1
d57 8
d68 8
@


1.8
log
@combus renamed uartbus, com_oct renamed cn30xxuart
@
text
@d1 1
a1 1
#	$OpenBSD: files.octeon,v 1.7 2011/05/08 13:24:55 syuu Exp $
a32 1
include	"dev/pckbc/files.pckbc"
@


1.7
log
@obio renamed iobus, moved interrupt handler code to dev/octeon_intr.c
@
text
@d1 1
a1 1
#	$OpenBSD: files.octeon,v 1.6 2010/10/28 22:50:49 syuu Exp $
d63 4
a66 4
define	combus {[base = -1]}
device	combus
attach	combus at mainbus
file	arch/octeon/dev/combus.c			combus
d68 2
a69 2
attach	com at combus with com_oct
file	arch/octeon/dev/com_oct.c			com_oct
@


1.6
log
@Inital commit of PCI and SATA support for OCTEON
@
text
@d1 1
a1 1
#	$OpenBSD: files.octeon,v 1.5 2010/10/26 00:02:01 syuu Exp $
d52 5
a56 4
define	obio {[base = -1]}
device	obio
attach	obio at mainbus
file	arch/octeon/dev/obio.c				mainbus
d60 1
a60 1
attach	octcf at obio
d72 1
a72 1
attach	pcibus at obio
@


1.5
log
@Replace broken CF driver with new one, fixed bus_space base address.
@
text
@d1 1
a1 1
#	$OpenBSD: files.octeon,v 1.4 2010/10/10 16:38:55 syuu Exp $
d69 7
@


1.4
log
@Compact Flash support for OCTEON
@
text
@d1 1
a1 1
#	$OpenBSD: files.octeon,v 1.3 2010/10/01 16:13:59 syuu Exp $
d12 1
d58 3
a60 2
attach	wdc at obio with wdc_obio
file	arch/octeon/dev/wdc_obio.c
@


1.3
log
@Implemented combus to support com device on OCTEON without modifing dev/ic/com.c ok deraadt@@
@
text
@d1 1
a1 1
#	$OpenBSD: files.octeon,v 1.2 2010/09/21 06:21:00 syuu Exp $
d55 4
@


1.2
log
@Remove bootinfo.c which has license issue. ok deraadt@@
@
text
@d1 1
a1 1
#	$OpenBSD: files.octeon,v 1.1 2010/09/20 06:32:30 syuu Exp $
d56 6
a61 1
attach	com at obio with com_oct
@


1.1
log
@Initial revision
@
text
@d1 1
a1 1
#	$OpenBSD: files.loongson,v 1.11 2010/05/08 21:59:53 miod Exp $
a20 1
file	arch/octeon/octeon/bootinfo.c
@

