head	1.32;
access;
symbols
	OPENBSD_6_1:1.28.0.4
	OPENBSD_6_1_BASE:1.28
	OPENBSD_6_0:1.26.0.2
	OPENBSD_6_0_BASE:1.26
	OPENBSD_5_9:1.23.0.2
	OPENBSD_5_9_BASE:1.23
	OPENBSD_5_8:1.21.0.4
	OPENBSD_5_8_BASE:1.21
	OPENBSD_5_7:1.16.0.2
	OPENBSD_5_7_BASE:1.16
	OPENBSD_5_6:1.14.0.4
	OPENBSD_5_6_BASE:1.14
	OPENBSD_5_5:1.12.0.4
	OPENBSD_5_5_BASE:1.12
	OPENBSD_5_4:1.11.0.2
	OPENBSD_5_4_BASE:1.11
	OPENBSD_5_3:1.10.0.8
	OPENBSD_5_3_BASE:1.10
	OPENBSD_5_2:1.10.0.6
	OPENBSD_5_2_BASE:1.10
	OPENBSD_5_1_BASE:1.10
	OPENBSD_5_1:1.10.0.4
	OPENBSD_5_0:1.10.0.2
	OPENBSD_5_0_BASE:1.10
	OPENBSD_4_9:1.5.0.2
	OPENBSD_4_9_BASE:1.5;
locks; strict;
comment	@# @;


1.32
date	2017.07.03.08.17.20;	author visa;	state Exp;
branches;
next	1.31;
commitid	T2rMffEZFZhGPIZu;

1.31
date	2017.06.18.13.58.44;	author visa;	state Exp;
branches;
next	1.30;
commitid	dEB6EZ6sWrUWvyR2;

1.30
date	2017.05.04.21.24.19;	author jmatthew;	state Exp;
branches;
next	1.29;
commitid	XsZVlnAXQFjKT5ZY;

1.29
date	2017.05.02.13.26.49;	author visa;	state Exp;
branches;
next	1.28;
commitid	RNCOX3BHktrY156Z;

1.28
date	2016.12.21.13.59.57;	author visa;	state Exp;
branches;
next	1.27;
commitid	p6zUhTuh4cX1l0nl;

1.27
date	2016.12.08.16.24.51;	author visa;	state Exp;
branches;
next	1.26;
commitid	a5qzHlIr7njfoVqO;

1.26
date	2016.07.05.12.53.40;	author visa;	state Exp;
branches;
next	1.25;
commitid	V7rhXg2XswiwjQlB;

1.25
date	2016.06.28.04.41.37;	author jmatthew;	state Exp;
branches;
next	1.24;
commitid	YZhKLotIHp83F5gq;

1.24
date	2016.03.18.05.38.10;	author jmatthew;	state Exp;
branches;
next	1.23;
commitid	jF5raQOhBtwKW5eh;

1.23
date	2016.01.14.17.20.34;	author visa;	state Exp;
branches;
next	1.22;
commitid	35peyKf2ATuNUm6r;

1.22
date	2015.08.18.12.49.41;	author visa;	state Exp;
branches;
next	1.21;
commitid	k0erlGYWoqot9msb;

1.21
date	2015.08.05.12.07.11;	author pirofti;	state Exp;
branches;
next	1.20;
commitid	fcVAIQUIORO97R3z;

1.20
date	2015.08.03.10.56.14;	author jasper;	state Exp;
branches;
next	1.19;
commitid	qdGuiFgw7wcWyErt;

1.19
date	2015.07.19.23.46.50;	author jasper;	state Exp;
branches;
next	1.18;
commitid	srHxICmjHBgmnrAl;

1.18
date	2015.07.17.22.52.29;	author tedu;	state Exp;
branches;
next	1.17;
commitid	OOrGfFHYAn65M2qc;

1.17
date	2015.06.28.11.52.57;	author jmatthew;	state Exp;
branches;
next	1.16;
commitid	OofwKM2pnc1yitBD;

1.16
date	2015.01.12.23.39.57;	author tedu;	state Exp;
branches;
next	1.15;
commitid	nYLNAP04RTBOzMTx;

1.15
date	2014.10.10.05.43.35;	author deraadt;	state Exp;
branches;
next	1.14;
commitid	eyBTAcDp3o260Uyq;

1.14
date	2014.07.12.22.03.16;	author brad;	state Exp;
branches;
next	1.13;
commitid	wjusDVT3QiIrpHjq;

1.13
date	2014.06.10.12.41.10;	author jasper;	state Exp;
branches;
next	1.12;
commitid	AS9qiDEWvqy3oU2u;

1.12
date	2013.09.19.00.15.59;	author jmatthew;	state Exp;
branches;
next	1.11;

1.11
date	2013.03.26.14.23.19;	author jasper;	state Exp;
branches;
next	1.10;

1.10
date	2011.06.24.02.18.17;	author yasuoka;	state Exp;
branches;
next	1.9;

1.9
date	2011.06.16.11.22.30;	author syuu;	state Exp;
branches;
next	1.8;

1.8
date	2011.05.08.13.39.30;	author syuu;	state Exp;
branches;
next	1.7;

1.7
date	2011.05.08.13.24.55;	author syuu;	state Exp;
branches;
next	1.6;

1.6
date	2011.04.25.22.23.10;	author syuu;	state Exp;
branches;
next	1.5;

1.5
date	2010.10.28.22.50.49;	author syuu;	state Exp;
branches;
next	1.4;

1.4
date	2010.10.26.00.02.01;	author syuu;	state Exp;
branches;
next	1.3;

1.3
date	2010.10.10.16.38.55;	author syuu;	state Exp;
branches;
next	1.2;

1.2
date	2010.10.01.16.13.59;	author syuu;	state Exp;
branches;
next	1.1;

1.1
date	2010.09.20.06.32.30;	author syuu;	state Exp;
branches;
next	;


desc
@@


1.32
log
@Attach com(4) using fdt on octeon.

The relevant part of uartbus(4) is made part of the com(4) glue
to avoid extra maneuvers in the code.
@
text
@#	$OpenBSD: RAMDISK,v 1.31 2017/06/18 13:58:44 visa Exp $

machine		octeon mips64
maxusers	4

option		TIMEZONE=0
option		DST=0
option		SMALL_KERNEL
option		NO_PROPOLICE
option		BOOT_CONFIG

option		RAMDISK_HOOKS
option		MINIROOTSIZE=10240

option		PCIVERBOSE
option		USBVERBOSE

option		FFS
option		FFS2
option		CD9660
option		UDF
option		EXT2FS
option		MSDOSFS
option		NFSCLIENT
option		INET6

option		CPU_MIPS64R2
option		CPU_OCTEON
option		FPUEMUL
makeoption	LINK_ADDRESS="0xffffffff81000000"

config		bsd root on rd0a swap on rd0b

mainbus0	at root
cpu0		at mainbus0
clock0		at mainbus0
iobus0		at mainbus0
octcf0		at iobus0
amdcf0		at iobus0

simplebus*	at fdt?
simplebus*	at iobus?

octrtc0		at mainbus0

pcibus*		at iobus0
pci*		at pcibus?
ppb*		at pci?
pci*		at ppb?

cn30xxsmi*	at fdt?		# MDIO controller
com*		at fdt?
octciu*		at fdt?		# Interrupt controller v1
octmmc*		at fdt?		# MMC host controller
sdmmc*		at octmmc?	# SD/MMC bus

cn30xxgmx*	at iobus? irq 48
cnmac*		at cn30xxgmx?

pciide*		at pci? flags 0x0000
wd*		at pciide? flags 0x0000

dwctwo0		at iobus0 irq 56
octuctl0	at iobus0 irq 56
ehci0		at octuctl?
ohci0		at octuctl?

usb*		at dwctwo?
usb*		at ehci?
usb*		at ohci?

uhub*		at usb?
uhub*		at uhub?
umass*		at uhub?
aue*		at uhub?	# ADMtek AN986 Pegasus Ethernet
atu*		at uhub?	# Atmel AT76c50x based 802.11b
axe*		at uhub?	# ASIX Electronics AX88172 USB Ethernet
axen*		at uhub?	# ASIX Electronics AX88179 USB Ethernet
cue*		at uhub?	# CATC USB-EL1201A based Ethernet
kue*		at uhub?	# Kawasaki KL5KUSB101B based Ethernet
smsc*		at uhub?	# SMSC LAN95xx Ethernet
cdce*		at uhub?	# CDC Ethernet
upl*		at uhub?	# Prolific PL2301/PL2302 host-to-host `network'
ugl*		at uhub?	# Genesys Logic GL620USB-A host-to-host `network'
udav*		at uhub?	# Davicom DM9601 based Ethernet
mos*		at uhub?	# MOSCHIP MCS7730/7830 10/100 Ethernet
url*		at uhub?	# Realtek RTL8150L based adapters
ure*		at uhub?	# Realtek RTL8152 based adapters
wi*		at uhub?	# WaveLAN IEEE 802.11DS
uath*		at uhub?	# Atheros AR5005UG/AR5005UX
ural*		at uhub?	# Ralink RT2500USB
rum*		at uhub?	# Ralink RT2501USB/RT2601USB
run*		at uhub?	# Ralink RT2700U/RT2800U/RT3000U
otus*		at uhub?	# Atheros AR9001U
athn*		at uhub?	# Atheros AR9002U
zyd*		at uhub?	# Zydas ZD1211
upgt*		at uhub?	# Conexant/Intersil PrismGT SoftMAC USB
urtw*		at uhub?	# Realtek 8187
rsu*		at uhub?	# Realtek RTL8188SU/RTL8191SU/RTL8192SU
urtwn*		at uhub?	# Realtek RTL8188CU/RTL8192CU

scsibus*	at scsi?
sd*		at scsibus?

rgephy*		at mii?
ukphy*		at mii?
atphy*		at mii?
brswphy*	at mii?
brgphy*		at mii?

pseudo-device	openprom
pseudo-device	loop 1
pseudo-device	bpfilter 1
pseudo-device	rd 1
pseudo-device	wsmux 2
@


1.31
log
@Split octeon interrupt code into a glue layer and a CIU driver.
This makes possible to add drivers for other interrupt controllers
on the platform.

The glue layer has been derived from arm64/armv7.
@
text
@d1 1
a1 1
#	$OpenBSD: RAMDISK,v 1.30 2017/05/04 21:24:19 jmatthew Exp $
a39 3
uartbus0	at mainbus0
com0		at uartbus0
com1		at uartbus0
d52 1
@


1.30
log
@enable brgphy, which appears in the edgerouter pro
@
text
@d1 1
a1 1
#	$OpenBSD: RAMDISK,v 1.29 2017/05/02 13:26:49 visa Exp $
d55 1
@


1.29
log
@Revise MDIO driver code so that device instances can be attached
using fdt. This lets the system utilize multiple MDIO controllers.

This patch enables all RJ45 Ethernet ports on EdgeRouter Pro.
The SFP module slots do not work yet.

OK kettenis@@, jmatthew@@
@
text
@d1 1
a1 1
#	$OpenBSD: RAMDISK,v 1.28 2016/12/21 13:59:57 visa Exp $
d110 1
@


1.28
log
@Add a driver for OCTEON MMC host controller.

Tested on EdgeRouter Pro, and Shasta.

OK mpi@@
@
text
@d1 1
a1 1
#	$OpenBSD: RAMDISK,v 1.27 2016/12/08 16:24:51 visa Exp $
d54 1
@


1.27
log
@Add fdt_attach_args and simplebus for implementing fdt-capable
drivers on octeon. Adapted from armv7.

ok kettenis@@
@
text
@d1 1
a1 1
#	$OpenBSD: RAMDISK,v 1.26 2016/07/05 12:53:40 visa Exp $
d53 3
@


1.26
log
@Add openprom(4) for octeon.

ok kettenis@@ deraadt@@ jasper@@
@
text
@d1 1
a1 1
#	$OpenBSD: RAMDISK,v 1.25 2016/06/28 04:41:37 jmatthew Exp $
d43 3
@


1.25
log
@enable ure(4) where we already have url(4)
@
text
@d1 1
a1 1
#	$OpenBSD: RAMDISK,v 1.24 2016/03/18 05:38:10 jmatthew Exp $
d104 1
@


1.24
log
@add octuctl, a driver for the Octeon II usb controller interface, and
attachments for ehci and ohci.

ok uebayasi@@ jasper@@ visa@@ mpi@@
@
text
@d1 1
a1 1
#	$OpenBSD: RAMDISK,v 1.23 2016/01/14 17:20:34 visa Exp $
d82 1
@


1.23
log
@Add support for a variety of USB devices.

Initial diff from Artturi Alm, ok jasper@@
@
text
@d1 1
a1 1
#	$OpenBSD: RAMDISK,v 1.22 2015/08/18 12:49:41 visa Exp $
d58 4
d63 3
@


1.22
log
@Unbreak Octeon kernel config after r1.25 of files.mips64.

Feedback and ok miod@@
@
text
@d1 1
a1 1
#	$OpenBSD: RAMDISK,v 1.21 2015/08/05 12:07:11 pirofti Exp $
d60 1
d62 25
@


1.21
log
@Add octrtc(4) to RAMDISK.

Okay deraadt@@, jasper@@.
@
text
@d1 1
a1 1
#	$OpenBSD: RAMDISK,v 1.20 2015/08/03 10:56:14 jasper Exp $
d27 1
@


1.20
log
@add amdcf(4) here too; unbreaks RAMDISK

ok pirofti@@
@
text
@d1 1
a1 1
#	$OpenBSD: RAMDISK,v 1.19 2015/07/19 23:46:50 jasper Exp $
d42 2
@


1.19
log
@rework how iobus(4) finds and attaches devices.

this allows us to get rid of the static list of children devices, using only
a lookup table for address hints where needed. as a bonus this removes the
'octcf0: [..] not configured' mesage on machines w/o octcf(4).

tested by pirofti@@ on DSR-500 and ERL by me
ok miod@@
@
text
@d1 1
a1 1
#	$OpenBSD: RAMDISK,v 1.18 2015/07/17 22:52:29 tedu Exp $
d38 1
@


1.18
log
@remove obsolete INET kernel option
@
text
@d1 1
a1 1
#	$OpenBSD: RAMDISK,v 1.17 2015/06/28 11:52:57 jmatthew Exp $
d47 1
a47 1
cn30xxgmx*	at iobus?
d53 1
a53 1
dwctwo0		at iobus0
@


1.17
log
@enable octdwctwo and add umass
@
text
@d1 1
a1 1
#	$OpenBSD: RAMDISK,v 1.16 2015/01/12 23:39:57 tedu Exp $
a24 1
option		INET
@


1.16
log
@include NFSCLIENT. ok deraadt
@
text
@d1 1
a1 1
#	$OpenBSD: RAMDISK,v 1.15 2014/10/10 05:43:35 deraadt Exp $
d54 7
a60 3
#octhci*	at iobus0
#usb*		at octhci?
#uhub*		at usb?
@


1.15
log
@Significant unification of RAMDISK* config files, making them diffable.
This makes it easier to remove components not required to do an install,
and subsequently add other desireable components ...
In snapshots (in various forks) for about a week.
Do some upgrades and installs, please.
@
text
@d1 1
a1 1
#	$OpenBSD: RAMDISK,v 1.14 2014/07/12 22:03:16 brad Exp $
d24 1
@


1.14
log
@Add in missing brswphy(4) and the commented out USB entries.

ok pirofti@@
@
text
@d1 1
a1 10
#	$OpenBSD: RAMDISK,v 1.13 2014/06/10 12:41:10 jasper Exp $
#
# For further information on compiling OpenBSD kernels, see the config(8)
# man page.
#
# For further information on hardware support for this architecture, see
# the intro(4) man page.  For further information about kernel options
# for this architecture, see the options(4) man page.  For an explanation
# of each device driver in this file see the section 4 man page for the
# device.
d4 1
a4 1
maxusers	8
d6 8
a13 3
option		CPU_OCTEON
option		FPUEMUL
makeoption	LINK_ADDRESS="0xffffffff81000000"
d18 8
a25 11
# Filesystem options
option		FFS		# UFS
option		FFS2		# UFS2
#option		NFSCLIENT	# Network File System client
option		CD9660		# ISO 9660 + Rock Ridge file system
option		UDF		# UDF (DVD) file system
option		EXT2FS		# Second Extended Filesystem
option		MSDOSFS		# MS-DOS file system
option		INET		# IP + ICMP + TCP + UDP
option		INET6		# IPv6 (needs INET)
option		DDB		# kernel debugger
d27 3
a29 2
option		MINIROOTSIZE=10240
option		RAMDISK_HOOKS
d31 1
a31 1
config	bsd	root on rd0a swap on rd0b
a32 3
#
# Definition of system
#
d37 1
a38 3

octcf0		at iobus0

d44 2
d47 2
a48 2
ppb*		at pci?		# PCI-PCI bridges
pci*		at ppb?
a49 1
# IDE Controller
a50 2

# IDE hard drives
d53 1
a53 4
# USB Controllers
#octhci*		at iobus0

# USB bus support
d55 1
a55 6

# USB devices
#uhub*		at usb?		# USB Hubs

cn30xxgmx*	at iobus?
cnmac*		at cn30xxgmx?
d62 4
a65 6
pseudo-device	loop		1	# network loopback
pseudo-device	bpfilter	1	# packet filter
pseudo-device	rd		1	# ram disk
pseudo-device	wsmux		2	# mouse & keyboard multiplexor

option		BOOT_CONFIG	# boot-time kernel config
@


1.13
log
@add ppb to the configs as suggested by kettenis@@

tested by jj@@
@
text
@d1 1
a1 1
#	$OpenBSD: RAMDISK,v 1.12 2013/09/19 00:15:59 jmatthew Exp $
d65 9
d80 1
@


1.12
log
@get ethernet working on the edgerouter lite

- add atphy(4) to configs
- allow separate rx and tx clock settings
- add phy mapping for the erl
- add tx/rx clock settings for erl

ok miod@@ bcallah@@
@
text
@d1 1
a1 1
#	$OpenBSD: RAMDISK,v 1.11 2013/03/26 14:23:19 jasper Exp $
d55 3
@


1.11
log
@- increase MINIROOTSIZE so a ramdisk can fit.
@
text
@d1 1
a1 1
#	$OpenBSD: RAMDISK,v 1.10 2011/06/24 02:18:17 yasuoka Exp $
d67 1
@


1.10
log
@Should always include ukphy(4) in the kernel configs if using any devices
using MII.

This diff from brad@@
Build test and ok yasuoka@@
@
text
@d1 1
a1 1
#	$OpenBSD: RAMDISK,v 1.9 2011/06/16 11:22:30 syuu Exp $
d34 1
a34 1
option		MINIROOTSIZE=8192
@


1.9
log
@Ethernet driver merged from IIJ's contribution code.
@
text
@d1 1
a1 1
#	$OpenBSD: RAMDISK,v 1.8 2011/05/08 13:39:30 syuu Exp $
d66 1
@


1.8
log
@combus renamed uartbus, com_oct renamed cn30xxuart
@
text
@d1 1
a1 1
#	$OpenBSD: RAMDISK,v 1.7 2011/05/08 13:24:55 syuu Exp $
d61 5
@


1.7
log
@obio renamed iobus, moved interrupt handler code to dev/octeon_intr.c
@
text
@d1 1
a1 1
#	$OpenBSD: RAMDISK,v 1.6 2011/04/25 22:23:10 syuu Exp $
d46 1
a46 1
combus0		at mainbus0
d50 2
a51 2
com0		at combus0
com1		at combus0
@


1.6
log
@FPU emulation option added
@
text
@d1 1
a1 1
#	$OpenBSD: RAMDISK,v 1.5 2010/10/28 22:50:49 syuu Exp $
d45 1
a45 1
obio0		at mainbus0
d48 1
a48 1
octcf0		at obio0
d53 1
a53 1
pcibus*		at obio0
@


1.5
log
@Inital commit of PCI and SATA support for OCTEON
@
text
@d1 1
a1 1
#	$OpenBSD: RAMDISK,v 1.4 2010/10/26 00:02:01 syuu Exp $
d16 1
@


1.4
log
@Replace broken CF driver with new one, fixed bus_space base address.
@
text
@d1 1
a1 1
#	$OpenBSD: RAMDISK,v 1.3 2010/10/10 16:38:55 syuu Exp $
d51 9
@


1.3
log
@Compact Flash support for OCTEON
@
text
@d1 1
a1 1
#	$OpenBSD: RAMDISK,v 1.2 2010/10/01 16:13:59 syuu Exp $
d47 1
a47 2
wdc0		at obio0
wd*		at wdc? flags 0x0000
@


1.2
log
@Implemented combus to support com device on OCTEON without modifing dev/ic/com.c ok deraadt@@
@
text
@d1 1
a1 1
#	$OpenBSD: RAMDISK,v 1.1 2010/09/20 06:32:30 syuu Exp $
d47 3
a58 1
option		COM_OCTEON
@


1.1
log
@Initial revision
@
text
@d1 1
a1 1
#	$OpenBSD: GENERIC,v 1.22 2010/05/08 21:59:53 miod Exp $
d45 1
d47 2
a48 2
com0		at obio0
com1		at obio0
@

