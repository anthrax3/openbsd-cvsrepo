head	1.9;
access;
symbols
	OPENBSD_6_2_BASE:1.9
	OPENBSD_6_1:1.2.0.4
	OPENBSD_6_1_BASE:1.2;
locks; strict;
comment	@ * @;


1.9
date	2017.09.08.05.36.51;	author deraadt;	state Exp;
branches;
next	1.8;
commitid	uRv5pa9QDlZaYgwD;

1.8
date	2017.08.23.18.03.54;	author kettenis;	state Exp;
branches;
next	1.7;
commitid	2wIKEa5dHVLhjcux;

1.7
date	2017.08.07.19.34.53;	author kettenis;	state Exp;
branches;
next	1.6;
commitid	9gJdvyH7ZN4Nyv48;

1.6
date	2017.07.31.14.06.29;	author kettenis;	state Exp;
branches;
next	1.5;
commitid	QqR3CEbSXXwoQ8F7;

1.5
date	2017.07.29.19.51.50;	author kettenis;	state Exp;
branches;
next	1.4;
commitid	WpXyuOCnHHogGX4n;

1.4
date	2017.07.24.12.12.09;	author patrick;	state Exp;
branches;
next	1.3;
commitid	58yX8QpUh6nXcm7x;

1.3
date	2017.05.07.11.07.48;	author kettenis;	state Exp;
branches;
next	1.2;
commitid	YMeGkMIyZpsclaDF;

1.2
date	2017.02.08.09.18.24;	author patrick;	state Exp;
branches;
next	1.1;
commitid	Qs36oCn0rzyBLZSt;

1.1
date	2016.12.17.23.38.33;	author patrick;	state Exp;
branches;
next	;
commitid	uicSPzuCfsvjSNQ4;


desc
@@


1.9
log
@If you use sys/param.h, you don't need sys/types.h
@
text
@/*	$OpenBSD: conf.c,v 1.8 2017/08/23 18:03:54 kettenis Exp $	*/

/*
 * Copyright (c) 1996 Michael Shalayeff
 * All rights reserved.
 *
 * Redistribution and use in source and binary forms, with or without
 * modification, are permitted provided that the following conditions
 * are met:
 * 1. Redistributions of source code must retain the above copyright
 *    notice, this list of conditions and the following disclaimer.
 * 2. Redistributions in binary form must reproduce the above copyright
 *    notice, this list of conditions and the following disclaimer in the
 *    documentation and/or other materials provided with the distribution.
 *
 * THIS SOFTWARE IS PROVIDED BY THE AUTHOR ``AS IS'' AND ANY EXPRESS OR
 * IMPLIED WARRANTIES, INCLUDING, BUT NOT LIMITED TO, THE IMPLIED
 * WARRANTIES OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE
 * ARE DISCLAIMED.  IN NO EVENT SHALL THE REGENTS OR CONTRIBUTORS BE LIABLE
 * FOR ANY DIRECT, INDIRECT, INCIDENTAL, SPECIAL, EXEMPLARY, OR CONSEQUENTIAL
 * DAMAGES (INCLUDING, BUT NOT LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS
 * OR SERVICES; LOSS OF USE, DATA, OR PROFITS; OR BUSINESS INTERRUPTION)
 * HOWEVER CAUSED AND ON ANY THEORY OF LIABILITY, WHETHER IN CONTRACT, STRICT
 * LIABILITY, OR TORT (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY
 * OUT OF THE USE OF THIS SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF
 * SUCH DAMAGE.
 */

#include <sys/param.h>
#include <lib/libsa/stand.h>
#include <lib/libsa/ufs.h>
#include <dev/cons.h>

#include "efiboot.h"
#include "efidev.h"

const char version[] = "0.8";
int	debug = 0;

struct fs_ops file_system[] = {
	{ ufs_open,    ufs_close,    ufs_read,    ufs_write,    ufs_seek,
	  ufs_stat,    ufs_readdir    },
};
int nfsys = nitems(file_system);

struct devsw	devsw[] = {
	{ "sd", efistrategy, efiopen, eficlose, efiioctl },
};
int ndevs = nitems(devsw);

struct consdev constab[] = {
	{ efi_cons_probe, efi_cons_init, efi_cons_getc, efi_cons_putc },
	{ NULL }
};
struct consdev *cn_tab;
@


1.8
log
@If the firmware provides a framebuffer through the Graphics Output Protocol,
create a "simple-framebuffer" node such that the kernel can attach the
simplefb(4) driver.  Only do this if such a "simple-framebuffer" node
doesn't exist already.

ok patrick@@, jsg@@
@
text
@d1 1
a1 1
/*	$OpenBSD: conf.c,v 1.7 2017/08/07 19:34:53 kettenis Exp $	*/
a29 1
#include <sys/types.h>
@


1.7
log
@Add "machine exit" and "machine poweroff" commands to the arm64 and armv7
bootloaders.  Replace while (1) { } with for (;;) continue; per request
from tom@@.

ok tom@@, jsg@@
@
text
@d1 1
a1 1
/*	$OpenBSD: conf.c,v 1.6 2017/07/31 14:06:29 kettenis Exp $	*/
d38 1
a38 1
const char version[] = "0.7";
@


1.6
log
@Back out previous commit but handle the case where the device path consists
of a single MEDIA_DEVICE_PATH component specially to cater for U-Boot's
somewhat broken device path handling.  Add comments to prevent confusion
in the future.  Bump the version number once again.

ok brynet@@
@
text
@d1 1
a1 1
/*	$OpenBSD: conf.c,v 1.5 2017/07/29 19:51:50 kettenis Exp $	*/
d38 1
a38 1
const char version[] = "0.6";
@


1.5
log
@Fix off-by-one in return value of efi_device_path_depth().

ok patrick@@
@
text
@d1 1
a1 1
/*	$OpenBSD: conf.c,v 1.4 2017/07/24 12:12:09 patrick Exp $	*/
d38 1
a38 1
const char version[] = "0.5";
@


1.4
log
@Port amd64's updates to the device path comparison to arm64 as well.
@
text
@d1 1
a1 1
/*	$OpenBSD: conf.c,v 1.3 2017/05/07 11:07:48 kettenis Exp $	*/
d38 1
a38 1
const char version[] = "0.4";
@


1.3
log
@Pass the address of the EFI system table and the EFI memory map through
properties in the /chosen node of the FDT.  The properties match the ones
used by Linux (see Documentation/arm/uefi.txt in the Linux kernel source
tree) but with the "linux," prefix replaced by "openbsd,".

ok jmatthew@@, tom@@
@
text
@d1 1
a1 1
/*	$OpenBSD: conf.c,v 1.2 2017/02/08 09:18:24 patrick Exp $	*/
d38 1
a38 1
const char version[] = "0.3";
@


1.2
log
@Pass the physical address to the end of symbols to the kernel.  From
armv7 we inherited the mechanism to manually modify the kernel symbol
table to change the value of esym.  We don't use this, but instead use
the virtual address that is passed to the kernel.  This change makes us
only work on and hand out physical addresses.  Bump the efiboot version
to make this ABI change more visible.
@
text
@d1 1
a1 1
/*	$OpenBSD: conf.c,v 1.1 2016/12/17 23:38:33 patrick Exp $	*/
d38 1
a38 1
const char version[] = "0.2";
@


1.1
log
@Import of OpenBSD/arm64

This commit contains all the kernel files related to the OpenBSD/arm64
port.  It is based on the PowerPC pmap, loongson, arm/armv7 code and
FreeBSD aarch64 code.  Hard work done by Dale Rahn.
@
text
@d1 1
a1 1
/*	$OpenBSD: conf.c,v 1.6 2016/10/23 19:06:08 kettenis Exp $	*/
d38 1
a38 1
const char version[] = "0.1";
@

