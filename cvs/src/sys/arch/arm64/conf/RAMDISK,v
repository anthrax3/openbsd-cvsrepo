head	1.21;
access;
symbols
	OPENBSD_6_1:1.19.0.4
	OPENBSD_6_1_BASE:1.19;
locks; strict;
comment	@# @;


1.21
date	2017.04.29.17.24.41;	author kettenis;	state Exp;
branches;
next	1.20;
commitid	UF3j8lco6zOKg9Iy;

1.20
date	2017.04.27.10.23.19;	author kettenis;	state Exp;
branches;
next	1.19;
commitid	1OdRkvdhr84s63Do;

1.19
date	2017.03.10.03.27.50;	author jsg;	state Exp;
branches;
next	1.18;
commitid	8VDfWKjuC21ICAl5;

1.18
date	2017.03.08.11.47.07;	author patrick;	state Exp;
branches;
next	1.17;
commitid	R6AcZD639F8zWaEy;

1.17
date	2017.03.08.11.45.23;	author patrick;	state Exp;
branches;
next	1.16;
commitid	O3OU8K8uTjOp2pzY;

1.16
date	2017.03.08.11.41.11;	author patrick;	state Exp;
branches;
next	1.15;
commitid	blirTTuBWzlxcb3k;

1.15
date	2017.03.08.09.23.06;	author jsg;	state Exp;
branches;
next	1.14;
commitid	xhyHqBfwFzW4LZif;

1.14
date	2017.03.08.08.57.16;	author patrick;	state Exp;
branches;
next	1.13;
commitid	XduaX9RCBhfCieyc;

1.13
date	2017.03.07.03.07.12;	author jsg;	state Exp;
branches;
next	1.12;
commitid	29aH3hTRIX9oHFNL;

1.12
date	2017.03.03.01.53.04;	author jsg;	state Exp;
branches;
next	1.11;
commitid	eZDrKW3nXTOZrx9V;

1.11
date	2017.03.01.01.24.34;	author jsg;	state Exp;
branches;
next	1.10;
commitid	RK1lT9fYts9ctM11;

1.10
date	2017.02.25.17.05.43;	author patrick;	state Exp;
branches;
next	1.9;
commitid	KHYH6nqEmfbzZKTL;

1.9
date	2017.02.24.10.13.13;	author patrick;	state Exp;
branches;
next	1.8;
commitid	BmmI7qP1ZsMJEgAk;

1.8
date	2017.02.22.23.03.12;	author patrick;	state Exp;
branches;
next	1.7;
commitid	YBZm1CaxOYK8gOTJ;

1.7
date	2017.02.05.00.29.30;	author patrick;	state Exp;
branches;
next	1.6;
commitid	IzeQxYkpaEWshZjR;

1.6
date	2017.01.25.10.19.15;	author jsg;	state Exp;
branches;
next	1.5;
commitid	oOwMF9ErOXIxv9Di;

1.5
date	2017.01.23.14.29.12;	author jsg;	state Exp;
branches;
next	1.4;
commitid	nmh8BSyiRPROocrg;

1.4
date	2017.01.23.14.00.22;	author patrick;	state Exp;
branches;
next	1.3;
commitid	Om9jYcC712snZ4s9;

1.3
date	2017.01.23.13.58.11;	author patrick;	state Exp;
branches;
next	1.2;
commitid	S0O91Ahg8IDRMV9Y;

1.2
date	2017.01.23.09.02.57;	author jsg;	state Exp;
branches;
next	1.1;
commitid	RzTWdprz9gZN6Dog;

1.1
date	2017.01.23.00.17.25;	author patrick;	state Exp;
branches;
next	;
commitid	qFCPrwlKG8EI4GF8;


desc
@@


1.21
log
@Add agintc(4), a driver for interrupt controllers conforming to ARM's
generic interrupt controller architecture specification v3/4.

The hard work was done by drahn@@, I just cleaned it up a bit and fixed
a couple of bugs.

ok patrick@@, drahn@@
@
text
@# $OpenBSD: RAMDISK,v 1.20 2017/04/27 10:23:19 kettenis Exp $
#
# GENERIC machine description file
#
# This machine description file is used to generate the default OpenBSD
# kernel.  The generic kernel does not include all options, subsystems
# and device drivers, but should be useful for most applications.
#
# The machine description file can be customised for your specific
# machine to reduce the kernel size and improve its performance.
#
# For further information on compiling OpenBSD kernels, see the config(8)
# man page.
#
# For further information on hardware support for this architecture, see
# the intro(4) man page.  For further information about kernel options
# for this architecture, see the options(4) man page.  For an explanation
# of each device driver in this file see the section 4 man page for the
# device.

machine		arm64
maxusers	4

option		TIMEZONE=0	# time zone to adjust RTC time by
option		DST=0		# daylight saving time used by RTC
option		PCIVERBOSE
option		USBVERBOSE
option		SMALL_KERNEL
option		NO_PROPOLICE
option		BOOT_CONFIG

option		RAMDISK_HOOKS
option		MINIROOTSIZE=15360

option		FFS
option		FFS2
option		MSDOSFS
option		INET6
option		EXT2FS

makeoptions	KERNEL_BASE_PHYS="0x00200000"
makeoptions	KERNEL_BASE_VIRT="0xffffff8000200000"

config		bsd	root on rd0a swap on rd0b

# The main bus device
mainbus0	at root
cpu0		at mainbus?
simplebus*	at fdt?

scsibus*	at scsi?
sd*		at scsibus?
st*		at scsibus?
cd*		at scsibus?
ch*		at scsibus?
uk*		at scsibus?

ampintc*	at fdt?
ampintcmsi*	at fdt?
agintc*		at fdt?
agtimer*	at fdt?
ahci*		at fdt?
pciecam*	at fdt?
pci*		at pciecam?

# NS16550 compatible serial ports
com*		at fdt?

# Virt on-chip devices
pluart*		at fdt?		# onboard uarts
plrtc*		at fdt?
psci*		at fdt?

virtio*		at fdt?
virtio*		at pci?
vio*		at virtio?
vioblk*		at virtio?
viomb*		at virtio?
viornd*		at virtio?
vioscsi*	at virtio?

# Raspberry Pi 3
bcmintc*	at fdt?
bcmdog*		at fdt?
dwctwo*		at fdt?
usb*		at dwctwo?

# Sunxi SoCs
sxipio*		at fdt? early 1	# GPIO pins for leds & PHYs
gpio*		at sxipio?
sxiccmu*	at fdt? early 1	# Clock Control Module/Unit
sxirtc*		at fdt?		# Real Time Clock
sximmc*		at fdt?		# SD/MMC card controller
sdmmc*		at sximmc?	# SD/MMC bus
ehci*		at fdt?		# EHCI (shim)

# PCI
ppb*		at pci?			# PCI-PCI bridges
pci*		at ppb?

# PCI Ethernet
em*		at pci?			# Intel Pro/1000 Ethernet
ix*		at pci?			# Intel 82598EB 10Gb Ethernet
mskc*		at pci?			# Marvell Yukon-2
msk*		at mskc?		#  each port of above
re*		at pci?			# Realtek 8169/8169S/8110S

# PCI SCSI
ahci*		at pci? flags 0x0000	# AHCI SATA controllers
					# flags 0x0001 to force SATA 1 (1.5Gb/s)
nvme*		at pci?			# NVMe controllers

# USB Controllers
ohci*		at pci?			# Open Host Controller
uhci*		at pci?			# Universal Host Controller (Intel)
ehci*		at pci?			# Enhanced Host Controller
xhci*		at pci?			# eXtensible Host Controller

# USB bus support
usb*		at ohci?
usb*		at uhci?
usb*		at ehci?
usb*		at xhci?

# USB devices
uhub*		at usb?			# USB Hubs
uhub*		at uhub?		# USB Hubs
umass*		at uhub?		# USB Mass Storage devices
uhidev*		at uhub?		# Human Interface Devices
ukbd*		at uhidev?		# USB keyboard
wskbd*		at ukbd? mux 1
aue*		at uhub?		# ADMtek AN986 Pegasus Ethernet
atu*		at uhub?		# Atmel AT76c50x based 802.11b
axe*		at uhub?		# ASIX Electronics AX88172 USB Ethernet
axen*		at uhub?		# ASIX Electronics AX88179 USB Ethernet
cue*		at uhub?		# CATC USB-EL1201A based Ethernet
kue*		at uhub?		# Kawasaki KL5KUSB101B based Ethernet
smsc*		at uhub?		# SMSC LAN95xx Ethernet
cdce*		at uhub?		# CDC Ethernet
urndis*		at uhub?		# Remote NDIS Ethernet
upl*		at uhub?		# Prolific PL2301/PL2302 host-to-host `network'
ugl*		at uhub?		# Genesys Logic GL620USB-A host-to-host `network'
udav*		at uhub?		# Davicom DM9601 based Ethernet
mos*		at uhub?		# MOSCHIP MCS7730/7830 10/100 Ethernet
url*		at uhub?		# Realtek RTL8150L based adapters
ure*		at uhub?		# Realtek RTL8152 based adapters
wi*		at uhub?		# WaveLAN IEEE 802.11DS
uath*		at uhub?		# Atheros AR5005UG/AR5005UX
ural*		at uhub?		# Ralink RT2500USB
rum*		at uhub?		# Ralink RT2501USB/RT2601USB
run*		at uhub?		# Ralink RT2700U/RT2800U/RT3000U
otus*		at uhub?		# Atheros AR9001U
athn*		at uhub?		# Atheros AR9002U
zyd*		at uhub?		# Zydas ZD1211
upgt*		at uhub?		# Conexant/Intersil PrismGT SoftMAC USB
urtw*		at uhub?		# Realtek 8187
rsu*		at uhub?		# Realtek RTL8188SU/RTL8191SU/RTL8192SU
urtwn*		at uhub?		# Realtek RTL8188CU/RTL8192CU

amphy*		at mii?			# AMD 79C873 PHYs
atphy*		at mii?			# Attansic F1 PHYs
eephy*		at mii?			# Marvell 88E1000 series PHY
rgephy*		at mii?			# Realtek 8169S/8110S PHY
rlphy*		at mii?			# Realtek 8139 internal PHYs
ukphy*		at mii?			# "unknown" PHYs
urlphy*		at mii?			# Realtek RTL8150L internal PHY

scsibus*	at scsi?
sd*		at scsibus?
cd*		at scsibus?
st*		at scsibus?
ch*		at scsibus?
uk*		at scsibus?

pseudo-device	loop 1
pseudo-device	bpfilter 1
pseudo-device	rd 1
@


1.20
log
@Add code to identify the CPUs on arm64 systems.  The primary CPU is attached
and identified early on.  For the secondary CPUs this happens late, such that
the drivers we need to spin up CPUs, such as psci(4), will be available.

This also fixes some code in simplebus(4) where the return value of
OF_getprop() was not properly checked.

Heavily based on an earlier diff from drahn@@.

ok drahn@@, jsg@@
@
text
@d1 1
a1 1
# $OpenBSD: RAMDISK,v 1.19 2017/03/10 03:27:50 jsg Exp $
d60 1
@


1.19
log
@enable amphy(4) for udav(4) and urlphy(4) for url(4)
@
text
@d1 1
a1 1
# $OpenBSD: RAMDISK,v 1.18 2017/03/08 11:47:07 patrick Exp $
d48 1
@


1.18
log
@Enable msk(4).
@
text
@d1 1
a1 1
# $OpenBSD: RAMDISK,v 1.17 2017/03/08 11:45:23 patrick Exp $
d158 1
d164 1
@


1.17
log
@Enable eephy(4).
@
text
@d1 1
a1 1
# $OpenBSD: RAMDISK,v 1.16 2017/03/08 11:41:11 patrick Exp $
d102 2
@


1.16
log
@Enable re(4).
@
text
@d1 1
a1 1
# $OpenBSD: RAMDISK,v 1.15 2017/03/08 09:23:06 jsg Exp $
d157 1
@


1.15
log
@Enable ix(4).  Requested by deraadt@@
@
text
@d1 1
a1 1
# $OpenBSD: RAMDISK,v 1.14 2017/03/08 08:57:16 patrick Exp $
d102 1
@


1.14
log
@Enable em(4), ahci(4), nvme(4) and USB controllers attached to pci(4).
@
text
@d1 1
a1 1
# $OpenBSD: RAMDISK,v 1.13 2017/03/07 03:07:12 jsg Exp $
d100 2
a101 1
em*		at pci?			# Intel Pro/1000 ethernet
@


1.13
log
@enable vioscsi(4)
@
text
@d1 1
a1 1
# $OpenBSD: RAMDISK,v 1.12 2017/03/03 01:53:04 jsg Exp $
d94 22
d117 1
a157 4

# PCI
ppb*		at pci?			# PCI-PCI bridges
pci*		at ppb?
@


1.12
log
@enable FFS2 on armv7 and arm64 ramdisks
@
text
@d1 1
a1 1
# $OpenBSD: RAMDISK,v 1.11 2017/03/01 01:24:34 jsg Exp $
d78 1
@


1.11
log
@Remove SYSCALL_DEBUG arm64 has been multiuser for a while now.
ok patrick@@
@
text
@d1 1
a1 1
# $OpenBSD: RAMDISK,v 1.10 2017/02/25 17:05:43 patrick Exp $
d36 1
@


1.10
log
@Enable ampintcmsi(4), pciecam(4), ppb(4) and virtio(4).
@
text
@d1 1
a1 1
# $OpenBSD: RAMDISK,v 1.9 2017/02/24 10:13:13 patrick Exp $
a38 2

option		SYSCALL_DEBUG
@


1.9
log
@Hook up pciecam(4), but don't compile it yet.
@
text
@d1 1
a1 1
# $OpenBSD: RAMDISK,v 1.8 2017/02/22 23:03:12 patrick Exp $
d59 1
d62 2
a63 2
#pciecam*	at fdt?
#pci*		at pciecam?
d74 1
a74 1
#virtio*		at pci?
d137 2
a138 2
#ppb*		at pci?			# PCI-PCI bridges
#pci*		at ppb?
@


1.8
log
@Enable ahci(4).

ok kettenis@@
@
text
@d1 1
a1 1
# $OpenBSD: RAMDISK,v 1.7 2017/02/05 00:29:30 patrick Exp $
d61 2
d73 1
d134 4
@


1.7
log
@Add option PCIVERBOSE.

Prompted by jsg@@
@
text
@d1 1
a1 1
# $OpenBSD: RAMDISK,v 1.6 2017/01/25 10:19:15 jsg Exp $
d60 1
@


1.6
log
@enable plrtc(4) and psci(4)
ok patrick@@
@
text
@d1 1
a1 1
# $OpenBSD: RAMDISK,v 1.5 2017/01/23 14:29:12 jsg Exp $
d26 1
@


1.5
log
@Enable bcmdog on RAMDISK as well so it can reboot.

ok kettenis@@ patrick@@
@
text
@d1 1
a1 1
# $OpenBSD: RAMDISK,v 1.4 2017/01/23 14:00:22 patrick Exp $
d65 3
@


1.4
log
@Enable USBVERBOSE on both the GENERIC and RAMDISK kernel.
@
text
@d1 1
a1 1
# $OpenBSD: RAMDISK,v 1.3 2017/01/23 13:58:11 patrick Exp $
d73 1
@


1.3
log
@Make the RAMDISK kernel actually try to boot the ramdisk.
@
text
@d1 1
a1 1
# $OpenBSD: RAMDISK,v 1.2 2017/01/23 09:02:57 jsg Exp $
d26 1
@


1.2
log
@Add Raspberry Pi 3 drivers to RAMDISK as well.

ok kettenis@@
@
text
@d1 1
a1 1
# $OpenBSD: RAMDISK,v 1.1 2017/01/23 00:17:25 patrick Exp $
d43 1
a43 1
config		bsd	swap generic
@


1.1
log
@Add RAMDISK config for arm64.  While there, clean up spaces in
the GENERIC config.
@
text
@d1 1
a1 1
# $OpenBSD: GENERIC,v 1.2 2017/01/21 08:54:24 patrick Exp $
d69 5
@

