head	1.22;
access;
symbols
	OPENBSD_5_5:1.21.0.4
	OPENBSD_5_5_BASE:1.21
	OPENBSD_5_4:1.20.0.2
	OPENBSD_5_4_BASE:1.20
	OPENBSD_5_3:1.19.0.2
	OPENBSD_5_3_BASE:1.19
	OPENBSD_5_2:1.15.0.18
	OPENBSD_5_2_BASE:1.15
	OPENBSD_5_1_BASE:1.15
	OPENBSD_5_1:1.15.0.16
	OPENBSD_5_0:1.15.0.14
	OPENBSD_5_0_BASE:1.15
	OPENBSD_4_9:1.15.0.12
	OPENBSD_4_9_BASE:1.15
	OPENBSD_4_8:1.15.0.10
	OPENBSD_4_8_BASE:1.15
	OPENBSD_4_7:1.15.0.6
	OPENBSD_4_7_BASE:1.15
	OPENBSD_4_6:1.15.0.8
	OPENBSD_4_6_BASE:1.15
	OPENBSD_4_5:1.15.0.4
	OPENBSD_4_5_BASE:1.15
	OPENBSD_4_4:1.15.0.2
	OPENBSD_4_4_BASE:1.15
	OPENBSD_4_3:1.14.0.8
	OPENBSD_4_3_BASE:1.14
	OPENBSD_4_2:1.14.0.6
	OPENBSD_4_2_BASE:1.14
	OPENBSD_4_1:1.14.0.4
	OPENBSD_4_1_BASE:1.14
	OPENBSD_4_0:1.14.0.2
	OPENBSD_4_0_BASE:1.14
	OPENBSD_3_9:1.13.0.2
	OPENBSD_3_9_BASE:1.13
	OPENBSD_3_8:1.12.0.8
	OPENBSD_3_8_BASE:1.12
	OPENBSD_3_7:1.12.0.6
	OPENBSD_3_7_BASE:1.12
	OPENBSD_3_6:1.12.0.4
	OPENBSD_3_6_BASE:1.12
	SMP_SYNC_A:1.12
	SMP_SYNC_B:1.12
	OPENBSD_3_5:1.12.0.2
	OPENBSD_3_5_BASE:1.12
	OPENBSD_3_4:1.10.0.2
	OPENBSD_3_4_BASE:1.10
	UBC_SYNC_A:1.9
	OPENBSD_3_3:1.8.0.12
	OPENBSD_3_3_BASE:1.8
	OPENBSD_3_2:1.8.0.10
	OPENBSD_3_2_BASE:1.8
	OPENBSD_3_1:1.8.0.8
	OPENBSD_3_1_BASE:1.8
	UBC_SYNC_B:1.8
	UBC:1.8.0.6
	UBC_BASE:1.8
	OPENBSD_3_0:1.8.0.4
	OPENBSD_3_0_BASE:1.8
	OPENBSD_2_9:1.8.0.2
	OPENBSD_2_9_BASE:1.8
	OPENBSD_2_8:1.7.0.8
	OPENBSD_2_8_BASE:1.7
	OPENBSD_2_7:1.7.0.6
	OPENBSD_2_7_BASE:1.7
	SMP:1.7.0.4
	SMP_BASE:1.7
	kame_19991208:1.7
	OPENBSD_2_6:1.7.0.2
	OPENBSD_2_6_BASE:1.7
	OPENBSD_2_5:1.5.0.2
	OPENBSD_2_5_BASE:1.5
	OPENBSD_2_4:1.4.0.2
	OPENBSD_2_4_BASE:1.4
	OPENBSD_2_3:1.2.0.6
	OPENBSD_2_3_BASE:1.2
	OPENBSD_2_2:1.2.0.4
	OPENBSD_2_2_BASE:1.2
	OPENBSD_2_1:1.2.0.2
	OPENBSD_2_1_BASE:1.2
	mvme88kport:1.1.1.1;
locks; strict;
comment	@# @;


1.22
date	2014.03.18.22.36.37;	author miod;	state dead;
branches;
next	1.21;

1.21
date	2013.11.06.19.37.06;	author miod;	state Exp;
branches;
next	1.20;

1.20
date	2013.05.12.10.43.45;	author miod;	state Exp;
branches;
next	1.19;

1.19
date	2013.01.16.20.45.09;	author miod;	state Exp;
branches;
next	1.18;

1.18
date	2013.01.05.11.20.56;	author miod;	state Exp;
branches;
next	1.17;

1.17
date	2012.12.01.21.08.50;	author miod;	state Exp;
branches;
next	1.16;

1.16
date	2012.08.21.14.46.19;	author pascal;	state Exp;
branches;
next	1.15;

1.15
date	2008.04.02.21.53.18;	author miod;	state Exp;
branches;
next	1.14;

1.14
date	2006.05.16.22.51.30;	author miod;	state Exp;
branches;
next	1.13;

1.13
date	2005.09.11.13.36.00;	author deraadt;	state Exp;
branches;
next	1.12;

1.12
date	2003.10.01.22.50.29;	author miod;	state Exp;
branches;
next	1.11;

1.11
date	2003.10.01.20.39.41;	author miod;	state Exp;
branches;
next	1.10;

1.10
date	2003.08.01.07.42.33;	author miod;	state Exp;
branches;
next	1.9;

1.9
date	2003.04.10.22.42.29;	author millert;	state Exp;
branches;
next	1.8;

1.8
date	2001.01.13.05.19.01;	author smurph;	state Exp;
branches
	1.8.6.1;
next	1.7;

1.7
date	99.09.27.19.30.01;	author smurph;	state Exp;
branches
	1.7.4.1;
next	1.6;

1.6
date	99.05.29.04.41.48;	author smurph;	state Exp;
branches;
next	1.5;

1.5
date	98.12.15.06.32.35;	author smurph;	state Exp;
branches;
next	1.4;

1.4
date	98.08.22.09.25.10;	author smurph;	state Exp;
branches;
next	1.3;

1.3
date	98.08.22.08.37.52;	author smurph;	state Exp;
branches;
next	1.2;

1.2
date	97.04.27.20.56.32;	author millert;	state Exp;
branches;
next	1.1;

1.1
date	97.03.03.19.30.39;	author rahnds;	state Exp;
branches
	1.1.1.1;
next	;

1.1.1.1
date	97.03.03.19.30.39;	author rahnds;	state Exp;
branches;
next	;

1.7.4.1
date	2001.04.18.16.11.51;	author niklas;	state Exp;
branches;
next	1.7.4.2;

1.7.4.2
date	2003.05.13.19.41.07;	author ho;	state Exp;
branches;
next	1.7.4.3;

1.7.4.3
date	2004.02.19.10.49.09;	author niklas;	state Exp;
branches;
next	;

1.8.6.1
date	2003.05.19.21.45.53;	author tedu;	state Exp;
branches;
next	;


desc
@@


1.22
log
@Retire hp300, mvme68k and mvme88k ports. These ports have no users, keeping
this hardware alive is becoming increasingly difficult, and I should heed the
message sent by the three disks which have died on me over the last few days.

Noone sane will mourn these ports anyway. So long, and thanks for the fish.
@
text
@#	$OpenBSD: Makefile,v 1.21 2013/11/06 19:37:06 miod Exp $

STRIP?= strip

S=	${.CURDIR}/../../../..
DEFS= -DSUN_BOOTPARAMS
#-DNETIF_DEBUG
INCPATH=-I${.CURDIR} -I${.CURDIR}/../libsa -I${.CURDIR}/../libbug \
	-I${S} -I${S}/lib/libsa
CFLAGS+=${DEFS} ${INCPATH} ${COPTS}
CLEANFILES+=netboot netboot.bin

.include "${S}/arch/mvme88k/stand/bugcrt/Makefile.inc"
.include "${S}/arch/mvme88k/stand/libbug/Makefile.inc"
.include "${S}/arch/mvme88k/stand/libsa/Makefile.inc"
.include "${S}/arch/mvme88k/stand/libz/Makefile.inc"

SRCS=	boot.c devices.c version.c
SRCS+=	conf.c dev_net.c devopen.c netif.c
SRCS+=	if_ie.c
SRCS+=	if_le.c
OBJS=  ${SRCS:S/.c/.o/g}
LIBS= ${LIBSA} ${LIBBUG} ${LIBZ}
LDFLAGS=-N -T ${S}/arch/mvme88k/stand/ld.script -Ttext ${STAGE2_RELOC}
LDFLAGS+= -warn-common
NOPIE=

all:	netboot.bin

netboot: ${NETBOOT_CRT} ${OBJS} ${LIBS}
	${LD} ${LDFLAGS} -o $@@ \
	    ${NETBOOT_CRT} ${OBJS} ${LIBS} `${CC} -print-libgcc-file-name`

netboot.bin: netboot
	${STRIP} netboot
	dd ibs=32 skip=1 if=netboot of=$@@

install:
	${INSTALL} ${INSTALL_COPY} -o ${LIBOWN} -g ${LIBGRP} -m ${LIBMODE} \
	  netboot.bin ${DESTDIR}${MDEC_DIR}/netboot

.include <bsd.prog.mk>
@


1.21
log
@Don't cargo-cult copy the invocation of size(1) on compiled bootblocks,
when 1) they aren't in ELF format, and 2) the result does not EVEN REMOTELY
matter on these architectures.
@
text
@d1 1
a1 1
#	$OpenBSD: Makefile,v 1.20 2013/05/12 10:43:45 miod Exp $
@


1.20
log
@S-Records boot code for mvme88k, finally. Allows a kernel to be loaded from
network, using either the on-board interface (on MVME187 and MVME197) or
any MVME376.

While there, add MVME376 support to netboot.
@
text
@d1 1
a1 1
#	$OpenBSD: Makefile,v 1.19 2013/01/16 20:45:09 miod Exp $
a2 1
SIZE?=	size
@


1.19
log
@Nuke commons with libsa and add --warn-common to the ld command lines.
No functional change.
@
text
@d1 1
a1 1
#	$OpenBSD: Makefile,v 1.18 2013/01/05 11:20:56 miod Exp $
d19 2
a20 1
SRCS=   boot.c conf.c version.c devopen.c dev_net.c
d22 1
a22 1
#SRCS+=  if_le.c
@


1.18
log
@Switch m88k ports to ELF.
@
text
@d1 1
a1 1
#	$OpenBSD: Makefile,v 1.17 2012/12/01 21:08:50 miod Exp $
d25 1
@


1.17
log
@Crank boot blocks version because of the compiler change.
@
text
@d1 1
a1 1
#	$OpenBSD: Makefile,v 1.16 2012/08/21 14:46:19 pascal Exp $
d24 1
a24 1
LDFLAGS+= -s -N -T ${STAGE2_RELOC}
d29 1
a29 1
netboot: ${OBJS} ${NETBOOT_CRT} ${LIBS}
d31 1
a31 2
		${NETBOOT_CRT} ${OBJS} ${LIBS} `${CC} -print-libgcc-file-name`
#	@@${SIZE} $@@
@


1.16
log
@Add NOPIE= bits for sys/arch/*/stand to ensure that bootblocks will always be
built with -fno-pie.  This gets the hairiest part of PIE out of the way ...

ok deraadt@@
@
text
@d1 1
a1 1
#	$OpenBSD: Makefile,v 1.15 2008/04/02 21:53:18 miod Exp $
d31 1
a31 1
		${NETBOOT_CRT} ${OBJS} ${LIBS} `cc -print-libgcc-file-name`
@


1.15
log
@Rewrite the startup code for the mvme88k bootblocks, once again. Some of
them (especially the netboot ones) will now self-relocate, which makes
BUG configuration much simpler.

WARNING: for disk-based systems, you need to update bootxx and bootsd at the
same time. New bootsd will not run when loaded from an older bootxx.
This doesn't matter much since you need both with installboot.
@
text
@d1 1
a1 1
#	$OpenBSD: Makefile,v 1.14 2006/05/16 22:51:30 miod Exp $
d25 1
@


1.14
log
@Cleanup of mvme88k standalone code, with rewritten startup code with
fewer assembly statements and much less magic, a few display artefacts
removed, and private definitions moved out of the main prom.h.
@
text
@d1 1
a1 1
#	$OpenBSD: Makefile,v 1.13 2005/09/11 13:36:00 deraadt Exp $
d28 1
a28 1
netboot: ${OBJS} ${SINGLE} ${LIBS}
d30 1
a30 1
		${SINGLE} ${OBJS} ${LIBS} `cc -print-libgcc-file-name`
a35 1
#	dd ibs=38 skip=1 if=netboot of=$@@
@


1.13
log
@cope with the ___moddi3 issue, same as mvme68k
@
text
@d1 1
a1 1
#	$OpenBSD: Makefile,v 1.12 2003/10/01 22:50:29 miod Exp $
d7 1
a7 1
DEFS= -DSUN_BOOTPARAMS 
d20 1
a20 1
SRCS+=	if_ie.c 
d24 1
a24 2
LDFLAGS+= -s -N -T ${STAGE2_RELOC} 
#LDFLAGS+= -nostdlib -s -N -Ttext ${RELOC}
@


1.12
log
@There is no point in chown/chmod outside the install target.
@
text
@d1 1
a1 1
#	$OpenBSD: Makefile,v 1.11 2003/10/01 20:39:41 miod Exp $
d31 1
a31 1
		${SINGLE} ${OBJS} ${LIBS}
@


1.11
log
@Compile kernel and bootblocks with -mmemcpy, to get rid of libgcc dependancy.
Also, honor default compilation options in stand/ whenever possible.

This requires an up-to-date compiler, but it's not exactly like many people
are going to be affected by this change...
@
text
@d1 1
a1 1
#	$OpenBSD: Makefile,v 1.10 2003/08/01 07:42:33 miod Exp $
a37 2
	chown ${LIBOWN}:${LIBGRP} netboot.bin
	chmod ${LIBMODE} netboot.bin
@


1.10
log
@${LIBGCC} is useless, since libgcc.a does not live in /usr/lib; instead,
use gcc to get the correct location.
@
text
@d1 1
a1 1
#	$OpenBSD: Makefile,v 1.9 2003/04/10 22:42:29 millert Exp $
d11 1
a11 1
CFLAGS=-O2 ${DEFS} ${INCPATH} ${COPTS}
d31 1
a31 1
		${SINGLE} ${OBJS} ${LIBS} `${CC} -print-libgcc-file-name`
@


1.9
log
@more POSIX chown
@
text
@d1 1
a1 1
#	$OpenBSD: Makefile,v 1.8 2001/01/13 05:19:01 smurph Exp $
d23 1
a23 1
LIBS= ${LIBSA} ${LIBBUG} ${LIBZ} ${LIBGCC}
d30 2
a31 2
	${LD} ${LDFLAGS} \
		${SINGLE} ${OBJS} ${LIBS} -o $@@
@


1.8
log
@Booting kernel with MACHINE_NEW_NONCONTIG.  UVM code added but not working.
New stand config.  Lots of header fixes.  Can now cross-compile i386->m88k.
@
text
@d1 1
a1 1
#	$OpenBSD: Makefile,v 1.7 1999/09/27 19:30:01 smurph Exp $
d38 1
a38 1
	chown ${LIBOWN}.${LIBGRP} netboot.bin
@


1.8.6.1
log
@sync
@
text
@d1 1
a1 1
#	$OpenBSD$
d38 1
a38 1
	chown ${LIBOWN}:${LIBGRP} netboot.bin
@


1.7
log
@changed loader load address.
@
text
@d1 1
a2 4
#	$OpenBSD: Makefile,v 1.6 1999/05/29 04:41:48 smurph Exp $

# 8Meg - 64K
RELOC=0x7F0000
d24 1
a24 1
LDFLAGS+= -s -N -T ${RELOC} 
d29 1
a29 1
netboot: ${OBJS} ${BUGCRT} ${LIBS}
d31 1
a31 1
		${BUGCRT} ${OBJS} ${LIBS} -o $@@
@


1.7.4.1
log
@Update the SMP branch to -current, this breaks the SMP branch though.
But it will be fixed soonish.  Note, nothing new has happened, this is just
a merge of the trunk into this branch.
@
text
@a0 1
#	$OpenBSD: Makefile,v 1.8 2001/01/13 05:19:01 smurph Exp $
d2 4
d27 1
a27 1
LDFLAGS+= -s -N -T ${STAGE2_RELOC} 
d32 1
a32 1
netboot: ${OBJS} ${SINGLE} ${LIBS}
d34 1
a34 1
		${SINGLE} ${OBJS} ${LIBS} -o $@@
@


1.7.4.2
log
@Sync the SMP branch to -current.
@
text
@d1 1
a1 1
#	$OpenBSD: Makefile,v 1.7.4.1 2001/04/18 16:11:51 niklas Exp $
d38 1
a38 1
	chown ${LIBOWN}:${LIBGRP} netboot.bin
@


1.7.4.3
log
@Merge of current from two weeks agointo the SMP branch
@
text
@d1 1
a1 1
#	$OpenBSD$
d11 1
a11 1
CFLAGS+=${DEFS} ${INCPATH} ${COPTS}
d23 1
a23 1
LIBS= ${LIBSA} ${LIBBUG} ${LIBZ}
d30 2
a31 2
	${LD} ${LDFLAGS} -o $@@ \
		${SINGLE} ${OBJS} ${LIBS}
d38 2
@


1.6
log
@Added vme bus device drivers. MVME328, MVME376, MVME332
@
text
@d2 1
a2 1
#	$OpenBSD: Makefile,v 1.5 1998/12/15 06:32:35 smurph Exp $
d4 2
a5 1
RELOC=0xAF0000
d14 1
a14 1
CFLAGS=	-O2 ${DEFS} ${INCPATH} ${COPTS}
d23 2
a24 1
SRCS+=	if_ie.c if_le.c
@


1.5
log
@This fixed a number of things.  A serious bug in bugcrt.c's initial stack
among other things.
@
text
@d2 1
a2 1
#	$OpenBSD: Makefile,v 1.4 1998/08/22 09:25:10 smurph Exp $
d24 1
a24 1
LIBS= ${LIBSA} ${LIBBUG} ${LIBZ} -lgcc -lc -lgcc
@


1.4
log
@fixed Makefiles.  Removed reference to libgcc.a
@
text
@a0 1
#	$OpenBSD: Makefile,v 1.3 1998/08/22 08:37:52 smurph Exp $
d2 3
a4 1
RELOC=0x3F0000
d6 1
d9 2
a10 1
DEFS= -DSUN_BOOTPARAMS #-DNETIF_DEBUG
d24 3
a26 2
LIBS= ${LIBSA} ${LIBBUG} ${LIBZ}
LDFLAGS+= -nostdlib -s -N -T ${RELOC}
d31 3
a33 3
	${LD} ${LDFLAGS} -o $@@ \
		${BUGCRT} ${OBJS} ${LIBS}
	@@${SIZE} $@@
d38 1
@


1.3
log
@working netboot.
@
text
@d1 1
a1 1
#	$OpenBSD: Makefile,v 1.8 1997/10/20 00:33:48 deraadt Exp $
d13 4
a16 4
.include "${S}/arch/${MACHINE}/stand/bugcrt/Makefile.inc"
.include "${S}/arch/${MACHINE}/stand/libbug/Makefile.inc"
.include "${S}/arch/${MACHINE}/stand/libsa/Makefile.inc"
.include "${S}/arch/${MACHINE}/stand/libz/Makefile.inc"
@


1.2
log
@COPY -> INSTALL_COPY and STRIP -> INSTALL_STRIP
This fixes namespace problems where STRIP is sometimes used as
the name of the strip(1) to use and other times used as
the flag to send install(1) when stripping (or not).
COPY doesn't have this problem (yet) but was poorly named.
@
text
@d1 1
a1 1
#	$Id: Makefile,v 1.1.1.1 1997/03/03 19:30:39 rahnds Exp $
d4 1
d7 5
a11 3
DEFS= -DSTANDALONE -DSUN_BOOTPARAMS
INCPATH=-I${.CURDIR} -I${.CURDIR}/../libsa -I${S} -I${S}/lib/libsa
CFLAGS=	-O2 ${INCPATH} ${DEFS} ${COPTS}
d13 2
d16 1
a16 2
.PATH: ${S}/arch/${MACHINE}/stand/libsa
SRTOBJ= SRT0.o SRT1.o
d18 1
a18 1
SRCS=   boot.c conf.c version.c dev_net.c
d20 3
a22 1
OBJS=  ${SRTOBJ} ${SRCS:S/.c/.o/g}
d26 4
a29 3
netboot: ${OBJS} ${LIBSA}
	${LD} -s -N -T ${RELOC} -e start -o $@@ ${OBJS} ${LIBSA}
	@@size $@@
d32 1
d34 2
@


1.1
log
@Initial revision
@
text
@d1 1
a1 1
#	$Id: Makefile,v 1.2 1995/11/07 08:50:55 deraadt Exp $
d28 1
a28 1
	install ${COPY} -o ${LIBOWN} -g ${LIBGRP} -m ${LIBMODE} \
@


1.1.1.1
log
@Third try at importing the mvme88k port. This is a working kernel
from nivas.
Userland and compiler still need to be worked on.
Make certain what directory the import is done from.
@
text
@@
