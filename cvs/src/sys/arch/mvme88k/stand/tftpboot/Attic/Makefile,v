head	1.10;
access;
symbols
	OPENBSD_5_5:1.9.0.4
	OPENBSD_5_5_BASE:1.9
	OPENBSD_5_4:1.8.0.4
	OPENBSD_5_4_BASE:1.8
	OPENBSD_5_3:1.8.0.2
	OPENBSD_5_3_BASE:1.8
	OPENBSD_5_2:1.4.0.18
	OPENBSD_5_2_BASE:1.4
	OPENBSD_5_1_BASE:1.4
	OPENBSD_5_1:1.4.0.16
	OPENBSD_5_0:1.4.0.14
	OPENBSD_5_0_BASE:1.4
	OPENBSD_4_9:1.4.0.12
	OPENBSD_4_9_BASE:1.4
	OPENBSD_4_8:1.4.0.10
	OPENBSD_4_8_BASE:1.4
	OPENBSD_4_7:1.4.0.6
	OPENBSD_4_7_BASE:1.4
	OPENBSD_4_6:1.4.0.8
	OPENBSD_4_6_BASE:1.4
	OPENBSD_4_5:1.4.0.4
	OPENBSD_4_5_BASE:1.4
	OPENBSD_4_4:1.4.0.2
	OPENBSD_4_4_BASE:1.4
	OPENBSD_4_3:1.3.0.8
	OPENBSD_4_3_BASE:1.3
	OPENBSD_4_2:1.3.0.6
	OPENBSD_4_2_BASE:1.3
	OPENBSD_4_1:1.3.0.4
	OPENBSD_4_1_BASE:1.3
	OPENBSD_4_0:1.3.0.2
	OPENBSD_4_0_BASE:1.3
	OPENBSD_3_9:1.2.0.2
	OPENBSD_3_9_BASE:1.2
	OPENBSD_3_8:1.1.0.10
	OPENBSD_3_8_BASE:1.1
	OPENBSD_3_7:1.1.0.8
	OPENBSD_3_7_BASE:1.1
	OPENBSD_3_6:1.1.0.6
	OPENBSD_3_6_BASE:1.1
	SMP_SYNC_A:1.1
	SMP_SYNC_B:1.1
	OPENBSD_3_5:1.1.0.4
	OPENBSD_3_5_BASE:1.1
	SMP:1.1.0.2;
locks; strict;
comment	@# @;


1.10
date	2014.03.18.22.36.37;	author miod;	state dead;
branches;
next	1.9;

1.9
date	2013.11.06.19.37.06;	author miod;	state Exp;
branches;
next	1.8;

1.8
date	2013.01.16.20.45.09;	author miod;	state Exp;
branches;
next	1.7;

1.7
date	2013.01.05.11.20.56;	author miod;	state Exp;
branches;
next	1.6;

1.6
date	2012.12.01.21.08.50;	author miod;	state Exp;
branches;
next	1.5;

1.5
date	2012.08.21.14.46.19;	author pascal;	state Exp;
branches;
next	1.4;

1.4
date	2008.04.02.21.53.18;	author miod;	state Exp;
branches;
next	1.3;

1.3
date	2006.05.16.22.51.30;	author miod;	state Exp;
branches;
next	1.2;

1.2
date	2005.09.11.13.36.00;	author deraadt;	state Exp;
branches;
next	1.1;

1.1
date	2004.01.26.19.48.34;	author miod;	state Exp;
branches;
next	;


desc
@@


1.10
log
@Retire hp300, mvme68k and mvme88k ports. These ports have no users, keeping
this hardware alive is becoming increasingly difficult, and I should heed the
message sent by the three disks which have died on me over the last few days.

Noone sane will mourn these ports anyway. So long, and thanks for the fish.
@
text
@#	$OpenBSD: Makefile,v 1.9 2013/11/06 19:37:06 miod Exp $

STRIP?= strip

S=	${.CURDIR}/../../../..
DEFS=
#DEFS+=-DNETIF_DEBUG
INCPATH=-I${.CURDIR} -I${.CURDIR}/../libsa -I${.CURDIR}/../libbug \
	-I${S} -I${S}/lib/libsa
CFLAGS+=${DEFS} ${INCPATH} ${COPTS}
CLEANFILES+=tftpboot tftpboot.bin

.include "${S}/arch/mvme88k/stand/bugcrt/Makefile.inc"
.include "${S}/arch/mvme88k/stand/libbug/Makefile.inc"
.include "${S}/arch/mvme88k/stand/libsa/Makefile.inc"
.include "${S}/arch/mvme88k/stand/libz/Makefile.inc"

SRCS=   boot.c conf.c version.c tftpfs.c netdev.c
OBJS=  ${SRCS:S/.c/.o/g}
LIBS= ${LIBSA} ${LIBBUG} ${LIBZ}
LDFLAGS=-N -T ${S}/arch/mvme88k/stand/ld.script -Ttext ${STAGE2_RELOC}
LDFLAGS+= -warn-common
NOPIE=

all:	tftpboot.bin

tftpboot: ${NETBOOT_CRT} ${OBJS} ${LIBS}
	${LD} ${LDFLAGS} -o $@@ \
	     ${NETBOOT_CRT} ${OBJS} ${LIBS} `${CC} -print-libgcc-file-name`

tftpboot.bin: tftpboot
	${STRIP} tftpboot
	dd ibs=32 skip=1 if=tftpboot of=$@@

install:
	${INSTALL} ${INSTALL_COPY} -o ${LIBOWN} -g ${LIBGRP} -m ${LIBMODE} \
	  tftpboot.bin ${DESTDIR}${MDEC_DIR}/tftpboot

.include <bsd.prog.mk>
@


1.9
log
@Don't cargo-cult copy the invocation of size(1) on compiled bootblocks,
when 1) they aren't in ELF format, and 2) the result does not EVEN REMOTELY
matter on these architectures.
@
text
@d1 1
a1 1
#	$OpenBSD: Makefile,v 1.8 2013/01/16 20:45:09 miod Exp $
@


1.8
log
@Nuke commons with libsa and add --warn-common to the ld command lines.
No functional change.
@
text
@d1 1
a1 1
#	$OpenBSD: Makefile,v 1.7 2013/01/05 11:20:56 miod Exp $
a2 1
SIZE?=	size
@


1.7
log
@Switch m88k ports to ELF.
@
text
@d1 1
a1 1
#	$OpenBSD: Makefile,v 1.6 2012/12/01 21:08:50 miod Exp $
d23 1
@


1.6
log
@Crank boot blocks version because of the compiler change.
@
text
@d1 1
a1 1
#	$OpenBSD: Makefile,v 1.5 2012/08/21 14:46:19 pascal Exp $
d22 1
a22 1
LDFLAGS+= -s -N -T ${STAGE2_RELOC}
d27 1
a27 1
tftpboot: ${OBJS} ${NETBOOT_CRT} ${LIBS}
d29 1
a29 1
		${NETBOOT_CRT} ${OBJS} ${LIBS} `${CC} -print-libgcc-file-name`
@


1.5
log
@Add NOPIE= bits for sys/arch/*/stand to ensure that bootblocks will always be
built with -fno-pie.  This gets the hairiest part of PIE out of the way ...

ok deraadt@@
@
text
@d1 1
a1 1
#	$OpenBSD: Makefile,v 1.4 2008/04/02 21:53:18 miod Exp $
d29 1
a29 1
		${NETBOOT_CRT} ${OBJS} ${LIBS} `cc -print-libgcc-file-name`
@


1.4
log
@Rewrite the startup code for the mvme88k bootblocks, once again. Some of
them (especially the netboot ones) will now self-relocate, which makes
BUG configuration much simpler.

WARNING: for disk-based systems, you need to update bootxx and bootsd at the
same time. New bootsd will not run when loaded from an older bootxx.
This doesn't matter much since you need both with installboot.
@
text
@d1 1
a1 1
#	$OpenBSD: Makefile,v 1.3 2006/05/16 22:51:30 miod Exp $
d23 1
@


1.3
log
@Cleanup of mvme88k standalone code, with rewritten startup code with
fewer assembly statements and much less magic, a few display artefacts
removed, and private definitions moved out of the main prom.h.
@
text
@d1 1
a1 1
#	$OpenBSD: Makefile,v 1.2 2005/09/11 13:36:00 deraadt Exp $
d26 1
a26 1
tftpboot: ${OBJS} ${SINGLE} ${LIBS}
d28 1
a28 2
		${SINGLE} ${OBJS} ${LIBS} `cc -print-libgcc-file-name`
#	@@${SIZE} $@@
a32 1
#	dd ibs=38 skip=1 if=tftpboot of=$@@
@


1.2
log
@cope with the ___moddi3 issue, same as mvme68k
@
text
@d1 1
a1 1
#	$OpenBSD: Makefile,v 1.1 2004/01/26 19:48:34 miod Exp $
d7 2
a8 2
DEFS= -DSUN_BOOTPARAMS 
#-DNETIF_DEBUG
d22 1
a22 2
LDFLAGS+= -s -N -T ${STAGE2_RELOC} 
#LDFLAGS+= -nostdlib -s -N -Ttext ${RELOC}
@


1.1
log
@tftp-only netboot code, inspired from mvmeppc, and stripped down; it will
become necessary to boot from unsupported (as far as mvme88k/stand/ is
concerned) network cards, such as the MVME374 and the MVME376.

Not enabled in the build yet, because there are a few issues left, but
it is nonetheless usable...
@
text
@d1 1
a1 1
#	$OpenBSD: Makefile,v 1.12 2003/10/01 22:50:29 miod Exp $
d29 1
a29 1
		${SINGLE} ${OBJS} ${LIBS}
@

