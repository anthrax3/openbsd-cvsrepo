head	1.52;
access;
symbols
	OPENBSD_5_5:1.51.0.4
	OPENBSD_5_5_BASE:1.51
	OPENBSD_5_4:1.50.0.2
	OPENBSD_5_4_BASE:1.50
	OPENBSD_5_3:1.45.0.10
	OPENBSD_5_3_BASE:1.45
	OPENBSD_5_2:1.45.0.8
	OPENBSD_5_2_BASE:1.45
	OPENBSD_5_1_BASE:1.45
	OPENBSD_5_1:1.45.0.6
	OPENBSD_5_0:1.45.0.4
	OPENBSD_5_0_BASE:1.45
	OPENBSD_4_9:1.45.0.2
	OPENBSD_4_9_BASE:1.45
	OPENBSD_4_8:1.43.0.8
	OPENBSD_4_8_BASE:1.43
	OPENBSD_4_7:1.43.0.4
	OPENBSD_4_7_BASE:1.43
	OPENBSD_4_6:1.43.0.6
	OPENBSD_4_6_BASE:1.43
	OPENBSD_4_5:1.43.0.2
	OPENBSD_4_5_BASE:1.43
	OPENBSD_4_4:1.41.0.10
	OPENBSD_4_4_BASE:1.41
	OPENBSD_4_3:1.41.0.8
	OPENBSD_4_3_BASE:1.41
	OPENBSD_4_2:1.41.0.6
	OPENBSD_4_2_BASE:1.41
	OPENBSD_4_1:1.41.0.4
	OPENBSD_4_1_BASE:1.41
	OPENBSD_4_0:1.41.0.2
	OPENBSD_4_0_BASE:1.41
	OPENBSD_3_9:1.39.0.2
	OPENBSD_3_9_BASE:1.39
	OPENBSD_3_8:1.36.0.2
	OPENBSD_3_8_BASE:1.36
	OPENBSD_3_7:1.35.0.2
	OPENBSD_3_7_BASE:1.35
	OPENBSD_3_6:1.32.0.2
	OPENBSD_3_6_BASE:1.32
	SMP_SYNC_A:1.29
	SMP_SYNC_B:1.29
	OPENBSD_3_5:1.25.0.2
	OPENBSD_3_5_BASE:1.25
	OPENBSD_3_4:1.20.0.4
	OPENBSD_3_4_BASE:1.20
	UBC_SYNC_A:1.20
	OPENBSD_3_3:1.20.0.2
	OPENBSD_3_3_BASE:1.20
	OPENBSD_3_2:1.19.0.4
	OPENBSD_3_2_BASE:1.19
	OPENBSD_3_1:1.19.0.2
	OPENBSD_3_1_BASE:1.19
	UBC_SYNC_B:1.19
	UBC:1.18.0.2
	UBC_BASE:1.18
	OPENBSD_3_0:1.13.0.2
	OPENBSD_3_0_BASE:1.13
	OPENBSD_2_9:1.8.0.2
	OPENBSD_2_9_BASE:1.8
	OPENBSD_2_8:1.7.0.6
	OPENBSD_2_8_BASE:1.7
	OPENBSD_2_7:1.7.0.4
	OPENBSD_2_7_BASE:1.7
	SMP:1.7.0.2
	SMP_BASE:1.7
	kame_19991208:1.7
	OPENBSD_2_6:1.6.0.2
	OPENBSD_2_6_BASE:1.6
	OPENBSD_2_5:1.3.0.2
	OPENBSD_2_5_BASE:1.3
	OPENBSD_2_4:1.1.1.1.0.8
	OPENBSD_2_4_BASE:1.1.1.1
	OPENBSD_2_3:1.1.1.1.0.6
	OPENBSD_2_3_BASE:1.1.1.1
	OPENBSD_2_2:1.1.1.1.0.4
	OPENBSD_2_2_BASE:1.1.1.1
	OPENBSD_2_1:1.1.1.1.0.2
	OPENBSD_2_1_BASE:1.1.1.1
	mvme88kport:1.1.1.1;
locks; strict;
comment	@# @;


1.52
date	2014.03.18.22.36.35;	author miod;	state dead;
branches;
next	1.51;

1.51
date	2013.09.24.20.10.47;	author miod;	state Exp;
branches;
next	1.50;

1.50
date	2013.06.11.21.06.31;	author miod;	state Exp;
branches;
next	1.49;

1.49
date	2013.05.23.21.20.12;	author miod;	state Exp;
branches;
next	1.48;

1.48
date	2013.05.17.22.51.59;	author miod;	state Exp;
branches;
next	1.47;

1.47
date	2013.05.17.22.46.27;	author miod;	state Exp;
branches;
next	1.46;

1.46
date	2013.05.17.22.38.25;	author miod;	state Exp;
branches;
next	1.45;

1.45
date	2010.12.31.21.38.08;	author miod;	state Exp;
branches;
next	1.44;

1.44
date	2010.12.06.20.10.18;	author jasper;	state Exp;
branches;
next	1.43;

1.43
date	2009.02.13.23.26.50;	author miod;	state Exp;
branches;
next	1.42;

1.42
date	2009.02.12.22.03.46;	author miod;	state Exp;
branches;
next	1.41;

1.41
date	2006.05.02.21.43.07;	author miod;	state Exp;
branches;
next	1.40;

1.40
date	2006.04.19.22.09.38;	author miod;	state Exp;
branches;
next	1.39;

1.39
date	2005.12.12.20.36.30;	author miod;	state Exp;
branches;
next	1.38;

1.38
date	2005.10.24.19.28.29;	author miod;	state Exp;
branches;
next	1.37;

1.37
date	2005.09.21.21.08.34;	author miod;	state Exp;
branches;
next	1.36;

1.36
date	2005.05.01.21.36.56;	author brad;	state Exp;
branches;
next	1.35;

1.35
date	2005.03.08.20.00.23;	author tdeval;	state Exp;
branches;
next	1.34;

1.34
date	2004.10.08.13.04.36;	author grange;	state Exp;
branches;
next	1.33;

1.33
date	2004.10.01.19.00.51;	author miod;	state Exp;
branches;
next	1.32;

1.32
date	2004.07.25.11.06.42;	author miod;	state Exp;
branches;
next	1.31;

1.31
date	2004.07.23.15.34.03;	author miod;	state Exp;
branches;
next	1.30;

1.30
date	2004.06.19.18.28.37;	author miod;	state Exp;
branches;
next	1.29;

1.29
date	2004.05.07.18.12.55;	author miod;	state Exp;
branches;
next	1.28;

1.28
date	2004.05.07.18.10.26;	author miod;	state Exp;
branches;
next	1.27;

1.27
date	2004.04.29.14.33.27;	author miod;	state Exp;
branches;
next	1.26;

1.26
date	2004.04.24.19.51.44;	author miod;	state Exp;
branches;
next	1.25;

1.25
date	2004.01.13.21.29.21;	author miod;	state Exp;
branches;
next	1.24;

1.24
date	2004.01.02.23.35.00;	author miod;	state Exp;
branches;
next	1.23;

1.23
date	2003.12.27.23.58.08;	author miod;	state Exp;
branches;
next	1.22;

1.22
date	2003.12.26.10.41.41;	author miod;	state Exp;
branches;
next	1.21;

1.21
date	2003.10.11.22.06.48;	author miod;	state Exp;
branches;
next	1.20;

1.20
date	2003.01.14.03.20.12;	author miod;	state Exp;
branches;
next	1.19;

1.19
date	2001.12.22.09.49.38;	author smurph;	state Exp;
branches;
next	1.18;

1.18
date	2001.12.19.04.02.25;	author smurph;	state Exp;
branches
	1.18.2.1;
next	1.17;

1.17
date	2001.12.16.23.49.43;	author miod;	state Exp;
branches;
next	1.16;

1.16
date	2001.12.13.08.55.51;	author smurph;	state Exp;
branches;
next	1.15;

1.15
date	2001.11.23.00.39.41;	author miod;	state Exp;
branches;
next	1.14;

1.14
date	2001.10.28.00.55.30;	author miod;	state Exp;
branches;
next	1.13;

1.13
date	2001.08.30.18.52.07;	author miod;	state Exp;
branches;
next	1.12;

1.12
date	2001.08.11.01.56.40;	author miod;	state Exp;
branches;
next	1.11;

1.11
date	2001.08.07.22.12.27;	author miod;	state Exp;
branches;
next	1.10;

1.10
date	2001.05.11.07.13.15;	author deraadt;	state Exp;
branches;
next	1.9;

1.9
date	2001.05.11.06.41.45;	author deraadt;	state Exp;
branches;
next	1.8;

1.8
date	2001.03.07.01.58.19;	author miod;	state Exp;
branches;
next	1.7;

1.7
date	99.11.08.15.36.10;	author mickey;	state Exp;
branches
	1.7.2.1;
next	1.6;

1.6
date	99.09.27.21.21.16;	author smurph;	state Exp;
branches;
next	1.5;

1.5
date	99.08.17.22.47.15;	author mickey;	state Exp;
branches;
next	1.4;

1.4
date	99.05.29.04.41.42;	author smurph;	state Exp;
branches;
next	1.3;

1.3
date	99.02.09.06.36.24;	author smurph;	state Exp;
branches;
next	1.2;

1.2
date	98.12.15.06.02.55;	author smurph;	state Exp;
branches;
next	1.1;

1.1
date	97.03.03.19.31.52;	author rahnds;	state Exp;
branches
	1.1.1.1;
next	;

1.1.1.1
date	97.03.03.19.31.52;	author rahnds;	state Exp;
branches;
next	;

1.7.2.1
date	2001.04.18.16.10.50;	author niklas;	state Exp;
branches;
next	1.7.2.2;

1.7.2.2
date	2001.07.04.10.19.51;	author niklas;	state Exp;
branches;
next	1.7.2.3;

1.7.2.3
date	2001.10.31.03.01.18;	author nate;	state Exp;
branches;
next	1.7.2.4;

1.7.2.4
date	2001.11.13.21.04.14;	author niklas;	state Exp;
branches;
next	1.7.2.5;

1.7.2.5
date	2001.12.05.00.39.12;	author niklas;	state Exp;
branches;
next	1.7.2.6;

1.7.2.6
date	2002.03.06.01.08.05;	author niklas;	state Exp;
branches;
next	1.7.2.7;

1.7.2.7
date	2003.03.27.23.32.17;	author niklas;	state Exp;
branches;
next	1.7.2.8;

1.7.2.8
date	2004.02.19.10.49.06;	author niklas;	state Exp;
branches;
next	1.7.2.9;

1.7.2.9
date	2004.06.05.23.09.48;	author niklas;	state Exp;
branches;
next	;

1.18.2.1
date	2002.01.31.22.55.17;	author niklas;	state Exp;
branches;
next	1.18.2.2;

1.18.2.2
date	2003.05.19.21.45.52;	author tedu;	state Exp;
branches;
next	;


desc
@@


1.52
log
@Retire hp300, mvme68k and mvme88k ports. These ports have no users, keeping
this hardware alive is becoming increasingly difficult, and I should heed the
message sent by the three disks which have died on me over the last few days.

Noone sane will mourn these ports anyway. So long, and thanks for the fish.
@
text
@#	$OpenBSD: files.mvme88k,v 1.51 2013/09/24 20:10:47 miod Exp $
#
maxpartitions 16

device	mainbus {[addr = -1]}
attach	mainbus at root

# MVME180/181 base logic
device	angelfire {[offset = -1], [ipl = 0]}
attach	angelfire at mainbus
file	arch/mvme88k/dev/angelfire.c			angelfire

# MVME197 BusSwitch system bus
device	bussw {[offset = -1], [ipl = 0]}
attach	bussw at mainbus
file	arch/mvme88k/dev/bussw.c			bussw needs-count

# MVME187 PCC2 system bus
device	pcctwo {[offset = -1], [ipl = 0]}
attach	pcctwo at bussw, mainbus
file	arch/mvme88k/dev/pcctwo.c			pcctwo

# MVME188 base logic
device	syscon {[offset = -1], [ipl = 0]}
attach	syscon at mainbus
file	arch/mvme88k/dev/syscon.c			syscon

device	memc
attach	memc at pcctwo
file	arch/mvme88k/dev/memc.c				memc

device	sram
attach	sram at mainbus
file	arch/mvme88k/dev/sram.c				sram needs-count

device	nvram
attach	nvram at pcctwo, syscon
file	arch/mvme88k/dev/nvram.c			nvram needs-count

device	dsrtc
attach	dsrtc at angelfire
file	arch/mvme88k/dev/ds1216.c			dsrtc

device	cl: tty
attach	cl at pcctwo
file	arch/mvme88k/dev/cl.c				cl needs-count

device	dart: tty
file	dev/ic/mc68681.c				dart
attach	dart at angelfire, syscon
file	arch/mvme88k/dev/dart.c				dart needs-count

include	"scsi/files.scsi"

major	{sd = 4}
major	{st = 5}
major	{cd = 6}
major	{rd = 7}
major	{vnd = 8}

attach	osiop at pcctwo with osiop_pcctwo
file	arch/mvme88k/dev/osiop_pcctwo.c			osiop_pcctwo

device	vme {}
attach	vme at angelfire, pcctwo, syscon
device	vmes {[addr = -1], [vec = -1], [ipl = 0]}
attach	vmes at vme
device	vmel {[addr = -1], [vec = -1], [ipl = 0]}
attach	vmel at vme
file	arch/mvme88k/dev/vme.c				vme | vmes | vmel
file	arch/mvme88k/dev/vmes.c				vmes needs-count
file	arch/mvme88k/dev/vmel.c				vmel needs-count

# list of standard files
file	dev/cninit.c

file	arch/mvme88k/mvme88k/autoconf.c
file	arch/mvme88k/mvme88k/bus_dma.c
file	arch/mvme88k/mvme88k/clock.c
file	arch/mvme88k/mvme88k/conf.c
file	arch/mvme88k/mvme88k/db_machdep.c		ddb
file	arch/mvme88k/mvme88k/disksubr.c
file	arch/mvme88k/mvme88k/eh.S
file	arch/mvme88k/mvme88k/machdep.c
file	arch/mvme88k/mvme88k/m181_machdep.c		mvme181
file	arch/mvme88k/mvme88k/m187_machdep.c		mvme187
file	arch/mvme88k/mvme88k/m188_machdep.c		mvme188
file	arch/mvme88k/mvme88k/m197_machdep.c		mvme197
file	arch/mvme88k/mvme88k/m1x7_machdep.c		mvme187 | mvme197
file	arch/mvme88k/mvme88k/m88110.c			m88110
file	arch/mvme88k/mvme88k/m8820x.c			m88100
file	arch/mvme88k/mvme88k/m88410.c			m88110
file	arch/mvme88k/mvme88k/pmap_table.c
file	arch/mvme88k/dev/bugio.c
file	arch/mvme88k/dev/mainbus.c
file	arch/mvme88k/dev/memdevs.c			nvram | sram

define	bpp
file	arch/mvme88k/dev/bpp.c				bpp

attach	ie at pcctwo: ifnet, ether
file	arch/mvme88k/dev/if_ie.c			ie

# MVME376
attach	le at vmes: le24
file	arch/mvme88k/dev/if_le.c			le

# MVME374
#device	vp: ether, ifnet, ifmedia
#attach	vp at vmes
#file	arch/mvme88k/dev/if_vp.c			vp

# MVME332
device	vx: tty
attach	vx at vmes
file	arch/mvme88k/dev/vx.c				vx needs-count

# MVME328
device	vs: scsi
attach	vs at vmes
file	arch/mvme88k/dev/vs.c				vs

# MVME327
device	vsbic: bpp, scsi
attach	vsbic at vmes
file	arch/mvme88k/dev/vsbic.c			vsbic
@


1.51
log
@Sync the MI LANCE code ( le(4) ) with NetBSD, except for the following:
- the am7990_get() - now lance_get() - is unchanged.
- the interrupt acknowledge logic is unchanged, and will disable interrupts,
  then acknowledge all interrupt conditions.

Add ILACC (79900) support (from NetBSD).

Both LANCE (am7990.c) and ILACC (am79900.c) code share as much common code
(lance.c) as possible. This affects all le(4) attachments, but the changes
are mostly mechanical, to split am7990-specific parts from lance-agnostic
parts.

Compile tested on all affected platforms. Tested on alpha, hp300, luna88k,
mvme88k, sparc, sparc64 and vax.
@
text
@d1 1
a1 1
#	$OpenBSD: files.mvme88k,v 1.50 2013/06/11 21:06:31 miod Exp $
@


1.50
log
@switch mvme88k to the MI dart(4) code. Tested on MVME181 and MVME188.
@
text
@d1 1
a1 1
#	$OpenBSD: files.mvme88k,v 1.49 2013/05/23 21:20:12 miod Exp $
d105 1
a105 1
attach	le at vmes
@


1.49
log
@TOD clock support for AngelFire boards
@
text
@d1 1
a1 1
#	$OpenBSD: files.mvme88k,v 1.48 2013/05/17 22:51:59 miod Exp $
d49 1
@


1.48
log
@Preliminary support for MVME180 and MVME181 boards. On-board serial ports
and VME controller are supported; tod chip isn't supported yet (coming soon).
MVME236 memory boards are not supported and won't likely be (unless I get my
hands on one).

MVME181-1 boots multiuser (slowly) with MVME328 SCSI and MVME376 Ethernet
despite only having 8MB of memory onboard.

MVME180 untested; might need tweaking to get MVME SCSI and Ethernet boards
supported.

Many thanks to Matti Nummi for lending me an MVME181 board.
@
text
@d1 1
a1 1
#	$OpenBSD: files.mvme88k,v 1.47 2013/05/17 22:46:27 miod Exp $
d39 4
@


1.47
log
@Replace the bunch of md_* function pointers with a `struct board' containing
function pointers for all the board-specific code.

Add a bunch of `struct board' methods to cover most, if not all, of the
`per-board' logic. This allows most of the md drivers to be cleaned up and
no longer need to embed board-specific knowledge.
@
text
@d1 1
a1 1
#	$OpenBSD: files.mvme88k,v 1.46 2013/05/17 22:38:25 miod Exp $
d8 6
d18 1
d23 1
d45 1
a45 1
attach	dart at syscon
d60 1
a60 1
attach	vme at pcctwo, syscon
d80 1
@


1.46
log
@Split inittodr/resettodr code from actual tod routines, to allow for
multiple tod routines in the near future.

Use the mi clock_ymdhms_to_secs and clock_secs_to_ymdhms routines.
@
text
@d1 1
a1 1
#	$OpenBSD: files.mvme88k,v 1.45 2010/12/31 21:38:08 miod Exp $
d14 1
a14 1
file	arch/mvme88k/dev/pcctwo.c			pcctwo needs-count
d18 1
a18 1
file	arch/mvme88k/dev/syscon.c			syscon needs-count
@


1.45
log
@Massive overhauling of the m88k pmap, though I can't pretend it's a new pmap
since a large part of the structures and logic remains.

Since m88k has separate supervisor/user spaces, we can map physical memory 1:1
in supervisor space, and have the kernel virtual address space start from the
end of physical memory.

This allows us to switch to __HAVE_PMAP_DIRECT. And to get rid of the double
mapped sdt, since now their virtual and physical addresses will always match.

The upper bound of the kernel virtual memory space is now platform dependent,
until the code which relies upon some hardware devices being mapped 1:1 in
supervisor mode is updated to no longer require this (this is mainly a PITA on
luna88k, where onboard devices start at 0x40000000, leaving only 1GB of KVA at
the moment - still much better than the previous 512MB).

Tested on mvme88k only (187, 188, 197LE, 197DP). Other platforms ought to
work, aviion will be checked shortly and fixed if necessary. No known
OpenBSD/luna88k system in working condition at the moment.
@
text
@d1 1
a1 1
#	$OpenBSD: files.mvme88k,v 1.44 2010/12/06 20:10:18 jasper Exp $
d66 1
@


1.44
log
@- use consistent 'include' rules without a full relative path.
tested on a GENERIC config from all arches.

ok deraadt@@ miod@@
@
text
@d1 1
a1 1
#	$OpenBSD: files.mvme88k,v 1.43 2009/02/13 23:26:50 miod Exp $
a77 2
file	arch/mvme88k/mvme88k/mem.c
file	arch/mvme88k/mvme88k/pmap_bootstrap.c
@


1.43
log
@Make delay() a per-board function pointer.
@
text
@d1 1
a1 1
#	$OpenBSD: files.mvme88k,v 1.42 2009/02/12 22:03:46 miod Exp $
d40 1
a40 1
include	"../../../scsi/files.scsi"
@


1.42
log
@BPP routines for ``intelligent'' Motorola MVME boards. Currently not used
by anything, will eventually be used by the vx(4) MVME332 driver (once I
take the time to fix it) and the vsbic(4) MVME327 driver being worked on.
@
text
@d1 1
a1 1
#	$OpenBSD: files.mvme88k,v 1.41 2006/05/02 21:43:07 miod Exp $
a65 1
file	arch/mvme88k/mvme88k/clock.c
@


1.41
log
@Wave goodbye to bugtty on mvme88k as well.
@
text
@d1 1
a1 1
#	$OpenBSD: files.mvme88k,v 1.40 2006/04/19 22:09:38 miod Exp $
d86 3
d92 1
d96 1
d101 1
d106 1
d110 5
@


1.40
log
@Get rid of the clock device attachment - since the clock is not something
we can live without, move it into the board-dependent code. This even makes
the code slightly smaller.

clock.c is moved from dev/ to mvme88k/ and only keeps common variables and
delay().
@
text
@d1 1
a1 1
#	$OpenBSD: files.mvme88k,v 1.39 2005/12/12 20:36:30 miod Exp $
a38 5

# fallback console, only if no cl or dart is available
device	bugtty: tty
attach	bugtty at mainbus
file	arch/mvme88k/dev/bugtty.c			bugtty needs-count
@


1.39
log
@Move the MC88410 support code to a specific .c function instead of heavy
(and large) inlines.

While there, provide correct register clobbering information to the
__asm__ statements, and fix mc88410_flush_page() evil typo.

Finally, rework mc88410_inval() busy-wait logic to behave correctly in all
cases.
@
text
@d1 1
a1 1
#	$OpenBSD: files.mvme88k,v 1.38 2005/10/24 19:28:29 miod Exp $
a19 4
device	clock
attach	clock at pcctwo, syscon
file	arch/mvme88k/dev/clock.c			clock

d71 1
d80 1
@


1.38
log
@Factorize db_interface code between luna88k and mvme88k, removing dead code
in the process; the arch-agnostic code keeps the ability for a specific
machine to define its own machine commands, such as "machine prom" for
mvme88k, in addition to the ``regular'' m88k machine commands.
@
text
@d1 1
a1 1
#	$OpenBSD: files.mvme88k,v 1.37 2005/09/21 21:08:34 miod Exp $
d85 1
@


1.37
log
@isbad() is only used on SMD disks on sparc; remove it on other platforms.
@
text
@d1 1
a1 1
#	$OpenBSD: files.mvme88k,v 1.36 2005/05/01 21:36:56 brad Exp $
d76 1
a76 2
file	arch/mvme88k/mvme88k/m8820x.c			m88100
file	arch/mvme88k/mvme88k/m88110.c			m88110
d83 2
a87 1
file	arch/mvme88k/ddb/db_interface.c			ddb
@


1.36
log
@To allow for MD override of in4_cksum()...

ok deraadt@@
@
text
@d1 1
a1 1
#	$OpenBSD: files.mvme88k,v 1.35 2005/03/08 20:00:23 tdeval Exp $
a78 1
file	arch/mvme88k/mvme88k/dkbad.c
@


1.35
log
@Cosmetics...
Mainly remove space between locators parens, replace spaces with tabs
where appropriate and consistently align dependencies.
@
text
@d1 1
a1 1
#	$OpenBSD: files.mvme88k,v 1.34 2004/10/08 13:04:36 grange Exp $
a71 3

file	netinet/in_cksum.c
file	netns/ns_cksum.c				ns
@


1.34
log
@Move dev/cons.c to MI conf/files.

ok miod@@
@
text
@d1 1
a1 1
#	$OpenBSD: files.mvme88k,v 1.33 2004/10/01 19:00:51 miod Exp $
d5 2
a6 2
device 	mainbus { [addr = -1 ] }
attach 	mainbus at root
d8 2
a9 2
device bussw { [offset = -1], [ ipl = 0 ] }
attach bussw at mainbus
d12 2
a13 2
device pcctwo { [offset = -1], [ ipl = 0 ] }
attach pcctwo at bussw, mainbus
d16 2
a17 2
device syscon { [offset = -1], [ ipl = 0 ] }
attach syscon at mainbus
d20 2
a21 2
device clock
attach clock at pcctwo, syscon
d24 2
a25 2
device memc
attach memc at pcctwo
d28 2
a29 2
device sram
attach sram at mainbus
d32 2
a33 2
device nvram
attach nvram at pcctwo, syscon
d36 2
a37 2
device cl: tty
attach cl at pcctwo
d40 2
a41 2
device dart: tty
attach dart at syscon
d45 2
a46 2
device bugtty: tty
attach bugtty at mainbus
d49 1
a49 1
include "../../../scsi/files.scsi"
d51 5
a55 5
major { sd = 4 }
major { st = 5 }
major { cd = 6 }
major { rd = 7 }
major { vnd = 8 }
d57 1
a57 1
attach osiop at pcctwo with osiop_pcctwo
d60 6
a65 6
device vme { }
attach vme at pcctwo, syscon
device vmes { [addr = -1], [vec = -1], [ipl = 0] }
attach vmes at vme
device vmel { [addr = -1], [vec = -1], [ipl = 0] }
attach vmel at vme
d96 2
a97 2
attach ie at pcctwo: ifnet, ether
file    arch/mvme88k/dev/if_ie.c			ie
d99 2
a100 2
attach le at vmes
file    arch/mvme88k/dev/if_le.c			le
d102 3
a104 3
#device vp: ether, ifnet, ifmedia
#attach vp at vmes
#file    arch/mvme88k/dev/if_vp.c			vp
d106 2
a107 2
device vx: tty
attach vx at vmes
d110 2
a111 2
device vs: scsi
attach vs at vmes
@


1.33
log
@More mvme88k code cleaning:
- merge locore_c_routines.c into machdep.c
- split machdep.c into really machdep.c content, and board-specific routines
  (memory sizing, early initialization, etc).

No functionnal change.
@
text
@d1 1
a1 1
#	$OpenBSD: files.mvme88k,v 1.32 2004/07/25 11:06:42 miod Exp $
a70 1
file	dev/cons.c
@


1.32
log
@Merge luna88k and mvme88k pmap. The pmap will now assume that the memory
below the kernel text is reserved for the PROM, instead of using fixed
(but different) values between luna88k and mvme88k.

Tested on mvme88k by myself, on luna88k by aoyama@@
@
text
@d1 1
a1 1
#	$OpenBSD: files.mvme88k,v 1.31 2004/07/23 15:34:03 miod Exp $
d66 3
a68 3
file	arch/mvme88k/dev/vme.c			vme | vmes | vmel
file	arch/mvme88k/dev/vmes.c			vmes needs-count
file	arch/mvme88k/dev/vmel.c			vmel needs-count
a84 1
file	arch/mvme88k/mvme88k/locore_c_routines.c
d86 3
@


1.31
log
@Move luna88k and mvme88k vm_machdep to m88k-agnostic code area.
@
text
@d1 1
a1 1
#	$OpenBSD: files.mvme88k,v 1.30 2004/06/19 18:28:37 miod Exp $
d88 1
a88 1
file	arch/mvme88k/mvme88k/pmap.c
@


1.30
log
@Share common ddb files accross m88k platforms.
@
text
@d1 1
a1 1
#	$OpenBSD: files.mvme88k,v 1.29 2004/05/07 18:12:55 miod Exp $
a89 1
file	arch/mvme88k/mvme88k/vm_machdep.c
@


1.29
log
@Replace the old ssh(4) NCR53C710 scsi driver with a pcctwo attachment for
the MI osiop(4) driver.

This improves performance very slighly and should also improve reliability.

Tested on 25MHz (50MHz osiop) and 33MHz (66MHz osiop) MVME187 boards.
@
text
@d1 1
a1 1
#	$OpenBSD: files.mvme88k,v 1.27 2004/04/29 14:33:27 miod Exp $
a90 1
file	arch/mvme88k/ddb/db_disasm.c			ddb
a91 2
file	arch/mvme88k/ddb/db_sstep.c			ddb
file	arch/mvme88k/ddb/db_trace.c			ddb
@


1.28
log
@bus_dma(9) implementation for mvme88k, mostly based upon powerpc.
@
text
@d57 2
a58 3
device ssh: scsi
attach ssh at pcctwo
file	arch/mvme88k/dev/ssh.c				ssh
@


1.27
log
@Continue factorizing m88k common code, this time files in <arch>/<arch>
which were copied verbatim from mvme88k to luna88k.

This requires backing out syntactic sugar in mvme88k kernel configuration
files which would deduct the required processor types from the board models,
as the common code only depends upon the M88100 and M88110 defines.
@
text
@d1 1
a1 1
#	$OpenBSD: files.mvme88k,v 1.26 2004/04/24 19:51:44 miod Exp $
d79 1
@


1.26
log
@Preliminary switch to an mvme88k bus_space world. Not all drivers have been
converted yet, and they rely upon some linear mappings provided by bus_space.

In order to not impact performance, almost all the bus_space accesses go
through macros and inline functions. This currently restricts us to D16 and
D32 access modes, which are selected at compilation time. Since there are no
plans to support D8 vme devices in the future, this is acceptable for now.

This makes the "len" locator for vme devices go away, and allows to simplify
some code which was using the pcctwo device, and will now directly access
hardware which is known to exist, rather than wait until the device is
attached.

While there, try to enforce more interrupt vector number checks, since these
changes pointed out that dart(4) had been working correctly so far by sheer
luck only.
@
text
@d1 1
a1 1
#	$OpenBSD: files.mvme88k,v 1.25 2004/01/13 21:29:21 miod Exp $
d80 2
a81 3
file	arch/mvme88k/mvme88k/cmmu.c
file	arch/mvme88k/mvme88k/m8820x.c			mvme187 | mvme188
file	arch/mvme88k/mvme88k/m88110.c			mvme197
a84 1
file	arch/mvme88k/mvme88k/locore_asm_routines.S
a85 3
file	arch/mvme88k/mvme88k/m88100_fp.S		mvme187 | mvme188
file	arch/mvme88k/mvme88k/m88110_fp.S		mvme197
file	arch/mvme88k/mvme88k/m88110_mmu.S		mvme197
a89 5
file	arch/mvme88k/mvme88k/process.S
file	arch/mvme88k/mvme88k/process_machdep.c
file	arch/mvme88k/mvme88k/trap.c
file	arch/mvme88k/mvme88k/vectors_88100.S		mvme187 | mvme188
file	arch/mvme88k/mvme88k/vectors_88110.S		mvme197
@


1.25
log
@Take advantage of the way config(8) works to probe for bugtty last during
autoconf. Bugtty will then not attach if either cl or dart has attached.

Note that, if you boot -c and disable the real console driver for your
board, you lose, because of the early console initialization. This is not
supported anyway.
@
text
@d1 1
a1 1
#	$OpenBSD: files.mvme88k,v 1.24 2004/01/02 23:35:00 miod Exp $
d30 1
a33 1
file	arch/mvme88k/dev/sram.c				sram needs-count
a34 1
file	arch/mvme88k/dev/memdevs.c			nvram | sram
d63 1
a63 1
device vmes { [addr = -1], [len = -1], [vec = -1], [ipl = 0] }
d65 1
a65 1
device vmel { [addr = -1], [len = -1], [vec = -1], [ipl = 0] }
d105 1
d107 1
a107 1
file	arch/mvme88k/dev/bugio.c
@


1.24
log
@There is no such thing as ``device cpu'' for now.
@
text
@d1 1
a1 1
#	$OpenBSD: files.mvme88k,v 1.23 2003/12/27 23:58:08 miod Exp $
a7 6
# this should be removed after bringup

device bugtty: tty
attach bugtty at mainbus
file	arch/mvme88k/dev/bugtty.c			bugtty needs-count

d44 5
@


1.23
log
@Replace the MVME376 driver from a homemade and dusty if_ve driver to
a ``regular'' if_le driver, sharing the common am7990 code.
@
text
@d1 1
a1 1
#	$OpenBSD: files.mvme88k,v 1.22 2003/12/26 10:41:41 miod Exp $
a12 3

device cpu
attach cpu at mainbus
@


1.22
log
@Merge the attachment part and the real work part of the SCSI drivers in
one file per driver.
@
text
@d1 1
a1 1
#	$OpenBSD: files.mvme88k,v 1.21 2003/10/11 22:06:48 miod Exp $
d116 2
a117 3
device ve: ether, ifnet, ifmedia
attach ve at vmes
file    arch/mvme88k/dev/if_ve.c			ve
@


1.21
log
@Merge sclock and clock pseudo-devices.
@
text
@d1 1
a1 1
#	$OpenBSD: files.mvme88k,v 1.20 2003/01/14 03:20:12 miod Exp $
a64 1
file	arch/mvme88k/dev/sshdma.c			ssh
a130 2
file	arch/mvme88k/dev/vsdma.c			vs

@


1.20
log
@Define exception vector tables as assembly source, with the appropriate
macros, rather than include files - no need to pollute <machine/> area...
@
text
@d1 2
a2 2
#	$OpenBSD: files.mvme88k,v 1.19 2001/12/22 09:49:38 smurph Exp $
#	
a31 4

device sclock
attach sclock at pcctwo, syscon
file	arch/mvme88k/dev/sclock.c			sclock
@


1.19
log
@masive cmmu overhaul.  function pointers now control cmmu functionality
instead of case statements based on cpu type.
@
text
@d1 1
a1 1
#	$OpenBSD: files.mvme88k,v 1.18 2001/12/19 04:02:25 smurph Exp $
d108 2
@


1.18
log
@bus switch name shortened.  Added register definitons and functionality.
@
text
@d1 1
a1 1
#	$OpenBSD: files.mvme88k,v 1.17 2001/12/16 23:49:43 miod Exp $
d91 2
a92 2
file	arch/mvme88k/mvme88k/m18x_cmmu.c		mvme187 | mvme188
file	arch/mvme88k/mvme88k/m197_cmmu.c		mvme197
@


1.18.2.1
log
@Merge in -current, builds on i386, otherwise untested
@
text
@d1 1
a1 1
#	$OpenBSD: files.mvme88k,v 1.19 2001/12/22 09:49:38 smurph Exp $
d91 2
a92 2
file	arch/mvme88k/mvme88k/m8820x.c			mvme187 | mvme188
file	arch/mvme88k/mvme88k/m88110.c			mvme197
@


1.18.2.2
log
@sync
@
text
@d1 1
a1 1
#	$OpenBSD$
a107 2
file	arch/mvme88k/mvme88k/vectors_88100.S		mvme187 | mvme188
file	arch/mvme88k/mvme88k/vectors_88110.S		mvme197
@


1.17
log
@Revert the mvme88k to 20011212. Recent changes had not been merged correctly,
and I am fed up with dissecting diffs to put back code that disappeared.
This will likely be fixed shortly.
@
text
@d1 1
a1 1
#	$OpenBSD: files.mvme88k,v 1.15 2001/11/23 00:39:41 miod Exp $
d17 3
a19 3
device busswitch { [offset = -1], [ ipl = 0 ] }
attach busswitch at mainbus
file	arch/mvme88k/dev/busswitch.c			busswitch needs-count
d22 1
a22 1
attach pcctwo at busswitch, mainbus
@


1.16
log
@Support for MVME197 completed.  Fix SPL defs.
@
text
@d17 3
a19 3
device bussw { [offset = -1], [ ipl = 0 ] }
attach bussw at mainbus
file	arch/mvme88k/dev/bussw.c			bussw needs-count
d22 1
a22 1
attach pcctwo at bussw, mainbus
d91 2
a92 2
file	arch/mvme88k/mvme88k/m8820x.c			mvme187 | mvme188
file	arch/mvme88k/mvme88k/m88110.c			mvme197
@


1.15
log
@dev{cons,cninit.c} are mandatory.
@
text
@d1 1
a1 1
#	$OpenBSD: files.mvme88k,v 1.14 2001/10/28 00:55:30 miod Exp $
d17 3
a19 3
device busswitch { [offset = -1], [ ipl = 0 ] }
attach busswitch at mainbus
file	arch/mvme88k/dev/busswitch.c			busswitch needs-count
d22 1
a22 1
attach pcctwo at busswitch, mainbus
d91 2
a92 2
file	arch/mvme88k/mvme88k/m18x_cmmu.c		mvme187 | mvme188
file	arch/mvme88k/mvme88k/m197_cmmu.c		mvme197
@


1.14
log
@Prune more old stuff
@
text
@d1 1
a1 1
#	$OpenBSD: files.mvme88k,v 1.13 2001/08/30 18:52:07 miod Exp $
d82 1
a82 1
file	dev/cons.c					ite | ser | tty
@


1.13
log
@Let non ddb kernels compile.
@
text
@d1 1
a1 1
#	$OpenBSD: files.mvme88k,v 1.12 2001/08/11 01:56:40 miod Exp $
a83 3
#file	scsi/scsi_base.c				scsi
#file	scsi/scsi_ioctl.c				scsi
#file	scsi/scsiconf.c					scsi
@


1.12
log
@Make m18x_cmmu.c only compiled if support for 187 or 188 is required.
@
text
@d1 1
a1 1
#	$OpenBSD: files.mvme88k,v 1.11 2001/08/07 22:12:27 miod Exp $
d112 4
a115 4
file	arch/mvme88k/ddb/db_disasm.c
file	arch/mvme88k/ddb/db_interface.c
file	arch/mvme88k/ddb/db_sstep.c
file	arch/mvme88k/ddb/db_trace.c
@


1.11
log
@Make config(8) choose which source files to exclude, from the kernel
configuration file options, rather than putting ugly preprocessor
statements and compile empty files.
@
text
@d1 1
a1 1
#	$OpenBSD: files.mvme88k,v 1.10 2001/05/11 07:13:15 deraadt Exp $
d94 1
a94 1
file	arch/mvme88k/mvme88k/m18x_cmmu.c
@


1.10
log
@unify rd(4) even more
@
text
@d1 1
a1 1
#	$OpenBSD: files.mvme88k,v 1.9 2001/05/11 06:41:45 deraadt Exp $
d95 1
a95 1
file	arch/mvme88k/mvme88k/m197_cmmu.c
d101 3
a103 3
file	arch/mvme88k/mvme88k/m88100_fp.S
file	arch/mvme88k/mvme88k/m88110_fp.S
file	arch/mvme88k/mvme88k/m88110_mmu.S
@


1.9
log
@unify
@
text
@d1 1
a1 1
#	$OpenBSD: files.mvme88k,v 1.8 2001/03/07 01:58:19 miod Exp $
a79 3

#ramdisk support
file 	dev/rd.c				ramdisk_hooks
@


1.8
log
@Bye-bye siop, enter ssh
@
text
@d1 1
a1 1
#	$OpenBSD: files.mvme88k,v 1.7 1999/11/08 15:36:10 mickey Exp $
d82 1
a82 1
file 	arch/mvme88k/dev/rd_root.c			ramdisk_hooks
@


1.7
log
@move MI definition of rd into it's MI place also fixing
attributes, allowing kernels to exist w/ rd as the only disk device.
tested on a few archs; niels@@ & millert@@ ok
@
text
@d1 1
a1 1
#	$OpenBSD: files.mvme88k,v 1.6 1999/09/27 21:21:16 smurph Exp $
d66 4
a69 4
device siop: scsi
attach siop at pcctwo
file	arch/mvme88k/dev/siop.c				siop
file	arch/mvme88k/dev/siopdma.c			siop
@


1.7.2.1
log
@Update the SMP branch to -current, this breaks the SMP branch though.
But it will be fixed soonish.  Note, nothing new has happened, this is just
a merge of the trunk into this branch.
@
text
@d1 1
a1 1
#	$OpenBSD: files.mvme88k,v 1.8 2001/03/07 01:58:19 miod Exp $
d66 4
a69 4
device ssh: scsi
attach ssh at pcctwo
file	arch/mvme88k/dev/ssh.c				ssh
file	arch/mvme88k/dev/sshdma.c			ssh
@


1.7.2.2
log
@Merge in -current from two days ago in the SMP branch.
As usual with merges, they do not indicate progress, so do not hold
your breath for working SMP, and do not mail me and ask about the
state of it.  It has not changed.  There is work ongoing, but very, very
slowly.  The commit is done in parts as to not lock up the tree in too
big chunks at a time.
@
text
@d1 1
a1 1
#	$OpenBSD: files.mvme88k,v 1.7.2.1 2001/04/18 16:10:50 niklas Exp $
d80 3
@


1.7.2.3
log
@Sync the SMP branch to something just after 3.0
@
text
@d1 1
a1 1
#	$OpenBSD: files.mvme88k,v 1.7.2.2 2001/07/04 10:19:51 niklas Exp $
d94 2
a95 2
file	arch/mvme88k/mvme88k/m18x_cmmu.c		mvme187 | mvme188
file	arch/mvme88k/mvme88k/m197_cmmu.c		mvme197
d101 3
a103 3
file	arch/mvme88k/mvme88k/m88100_fp.S		mvme187 | mvme188
file	arch/mvme88k/mvme88k/m88110_fp.S		mvme197
file	arch/mvme88k/mvme88k/m88110_mmu.S		mvme197
d112 4
a115 4
file	arch/mvme88k/ddb/db_disasm.c			ddb
file	arch/mvme88k/ddb/db_interface.c			ddb
file	arch/mvme88k/ddb/db_sstep.c			ddb
file	arch/mvme88k/ddb/db_trace.c			ddb
@


1.7.2.4
log
@Merge in -current
@
text
@d1 1
a1 1
#	$OpenBSD$
d84 3
@


1.7.2.5
log
@Merge in -current
@
text
@d1 1
a1 1
#	$OpenBSD: files.mvme88k,v 1.7.2.4 2001/11/13 21:04:14 niklas Exp $
d82 1
a82 1
file	dev/cons.c
@


1.7.2.6
log
@Merge in trunk
@
text
@d1 1
a1 1
#	$OpenBSD$
d17 3
a19 3
device bussw { [offset = -1], [ ipl = 0 ] }
attach bussw at mainbus
file	arch/mvme88k/dev/bussw.c			bussw needs-count
d22 1
a22 1
attach pcctwo at bussw, mainbus
d91 2
a92 2
file	arch/mvme88k/mvme88k/m8820x.c			mvme187 | mvme188
file	arch/mvme88k/mvme88k/m88110.c			mvme197
@


1.7.2.7
log
@Sync the SMP branch with 3.3
@
text
@a107 2
file	arch/mvme88k/mvme88k/vectors_88100.S		mvme187 | mvme188
file	arch/mvme88k/mvme88k/vectors_88110.S		mvme197
@


1.7.2.8
log
@Merge of current from two weeks agointo the SMP branch
@
text
@d2 1
a2 1
#
d8 9
d33 4
a57 5
# fallback console, only if no cl or dart is available
device bugtty: tty
attach bugtty at mainbus
file	arch/mvme88k/dev/bugtty.c			bugtty needs-count

d69 1
d121 3
a123 2
attach le at vmes
file    arch/mvme88k/dev/if_le.c			le
d136 2
@


1.7.2.9
log
@Merge with the trunk
@
text
@a29 1
file	arch/mvme88k/dev/sram.c				sram needs-count
d33 1
d35 1
d58 3
a60 2
attach osiop at pcctwo with osiop_pcctwo
file	arch/mvme88k/dev/osiop_pcctwo.c			osiop_pcctwo
d64 1
a64 1
device vmes { [addr = -1], [vec = -1], [ipl = 0] }
d66 1
a66 1
device vmel { [addr = -1], [vec = -1], [ipl = 0] }
a79 1
file	arch/mvme88k/mvme88k/bus_dma.c
d81 3
a83 2
file	arch/mvme88k/mvme88k/m8820x.c			m88100
file	arch/mvme88k/mvme88k/m88110.c			m88110
d87 1
d89 3
d96 5
d106 1
a107 2
file	arch/mvme88k/dev/mainbus.c
file	arch/mvme88k/dev/memdevs.c			nvram | sram
@


1.6
log
@Some cleaning...
@
text
@d1 1
a1 1
#	$OpenBSD: files.mvme88k,v 1.5 1999/08/17 22:47:15 mickey Exp $
a81 2
pseudo-device rd
file 	dev/ramdisk.c					rd needs-flag
@


1.5
log
@factor out ie device definition; niklas@@ ok
@
text
@d1 1
a1 1
#	$OpenBSD: files.mvme88k,v 1.4 1999/05/29 04:41:42 smurph Exp $
d13 1
d17 4
a20 1
#device pcctwo { [addr = -1], [size = 4096], [ipl = 0] }
d22 2
d25 3
a27 2
attach pcctwo at mainbus
file	arch/mvme88k/dev/pcctwo.c			pcctwo needs-count
d30 1
a30 1
attach clock at pcctwo
d33 4
d39 1
a39 1
file	arch/mvme88k/dev/memc.c			memc
d43 1
d45 1
a45 1
attach nvram at pcctwo
d54 4
d72 1
a72 1
attach vme at pcctwo
d99 2
d107 2
d112 1
d130 4
@


1.4
log
@Added vme bus device drivers. MVME328, MVME376, MVME332
@
text
@d1 1
a1 1
#	$OpenBSD: files.mvme88k,v 1.3 1999/02/09 06:36:24 smurph Exp $
a102 1
device ie: ifnet, ether
@


1.3
log
@Added kernel support for user debugging.  Fixed file ID's
@
text
@d1 1
a1 1
#	$OpenBSD: files.mvme88k,v 1.1 1998/12/15 06:02:55 smurph Exp $
d106 13
@


1.2
log
@Commint for the first real mvme88k OpendBSD
@
text
@d1 2
@


1.1
log
@Initial revision
@
text
@d13 4
a16 3
device vme { [addr = -1], [size = -1], [ipl = 0], [vec = -1] }
attach vme at mainbus
device pcctwo { [addr = -1], [size = 4096], [ipl = 0] }
d19 1
d23 7
d32 4
a35 1
file	arch/mvme88k/dev/nvram.c			nvram
a38 1
#device ether at pcctwo
d45 1
d53 3
a55 1
device vmes
d57 1
a57 1
device vmel
d59 8
a66 8

#device vme at mainbus { }
#device vmes at vme { [addr = -1], [len = -1], [vec = -1], [ipl = 0] }
#device vmel at vme { [addr = -1], [len = -1], [vec = -1], [ipl = 0] }

file	arch/mvme88k/dev/vme.c				vme | vmes | vmel
file	arch/mvme88k/dev/vmes.c				vmes needs-count
file	arch/mvme88k/dev/vmel.c				vmel needs-count
a93 1

a97 1

a99 1

@


1.1.1.1
log
@Third try at importing the mvme88k port. This is a working kernel
from nivas.
Userland and compiler still need to be worked on.
Make certain what directory the import is done from.
@
text
@@
