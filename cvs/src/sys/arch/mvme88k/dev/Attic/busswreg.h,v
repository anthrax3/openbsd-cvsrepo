head	1.14;
access;
symbols
	OPENBSD_5_5:1.13.0.24
	OPENBSD_5_5_BASE:1.13
	OPENBSD_5_4:1.13.0.20
	OPENBSD_5_4_BASE:1.13
	OPENBSD_5_3:1.13.0.18
	OPENBSD_5_3_BASE:1.13
	OPENBSD_5_2:1.13.0.16
	OPENBSD_5_2_BASE:1.13
	OPENBSD_5_1_BASE:1.13
	OPENBSD_5_1:1.13.0.14
	OPENBSD_5_0:1.13.0.12
	OPENBSD_5_0_BASE:1.13
	OPENBSD_4_9:1.13.0.10
	OPENBSD_4_9_BASE:1.13
	OPENBSD_4_8:1.13.0.8
	OPENBSD_4_8_BASE:1.13
	OPENBSD_4_7:1.13.0.4
	OPENBSD_4_7_BASE:1.13
	OPENBSD_4_6:1.13.0.6
	OPENBSD_4_6_BASE:1.13
	OPENBSD_4_5:1.13.0.2
	OPENBSD_4_5_BASE:1.13
	OPENBSD_4_4:1.11.0.4
	OPENBSD_4_4_BASE:1.11
	OPENBSD_4_3:1.11.0.2
	OPENBSD_4_3_BASE:1.11
	OPENBSD_4_2:1.7.0.8
	OPENBSD_4_2_BASE:1.7
	OPENBSD_4_1:1.7.0.6
	OPENBSD_4_1_BASE:1.7
	OPENBSD_4_0:1.7.0.4
	OPENBSD_4_0_BASE:1.7
	OPENBSD_3_9:1.7.0.2
	OPENBSD_3_9_BASE:1.7
	OPENBSD_3_8:1.6.0.6
	OPENBSD_3_8_BASE:1.6
	OPENBSD_3_7:1.6.0.4
	OPENBSD_3_7_BASE:1.6
	OPENBSD_3_6:1.6.0.2
	OPENBSD_3_6_BASE:1.6
	SMP_SYNC_A:1.6
	SMP_SYNC_B:1.6
	OPENBSD_3_5:1.4.0.2
	OPENBSD_3_5_BASE:1.4
	OPENBSD_3_4:1.3.0.12
	OPENBSD_3_4_BASE:1.3
	UBC_SYNC_A:1.3
	OPENBSD_3_3:1.3.0.10
	OPENBSD_3_3_BASE:1.3
	OPENBSD_3_2:1.3.0.8
	OPENBSD_3_2_BASE:1.3
	OPENBSD_3_1:1.3.0.6
	OPENBSD_3_1_BASE:1.3
	SMP:1.3.0.4
	UBC_SYNC_B:1.3
	UBC:1.3.0.2
	UBC_BASE:1.3;
locks; strict;
comment	@ * @;


1.14
date	2014.03.18.22.36.35;	author miod;	state dead;
branches;
next	1.13;

1.13
date	2009.02.14.17.39.51;	author miod;	state Exp;
branches;
next	1.12;

1.12
date	2009.02.13.23.28.05;	author miod;	state Exp;
branches;
next	1.11;

1.11
date	2007.12.25.20.23.02;	author miod;	state Exp;
branches;
next	1.10;

1.10
date	2007.12.13.18.50.10;	author miod;	state Exp;
branches;
next	1.9;

1.9
date	2007.12.04.23.45.52;	author miod;	state Exp;
branches;
next	1.8;

1.8
date	2007.11.22.05.53.57;	author miod;	state Exp;
branches;
next	1.7;

1.7
date	2005.12.11.21.31.36;	author miod;	state Exp;
branches;
next	1.6;

1.6
date	2004.04.24.19.51.47;	author miod;	state Exp;
branches;
next	1.5;

1.5
date	2004.04.14.20.17.21;	author miod;	state Exp;
branches;
next	1.4;

1.4
date	2003.10.11.22.08.57;	author miod;	state Exp;
branches;
next	1.3;

1.3
date	2001.12.19.04.02.25;	author smurph;	state Exp;
branches
	1.3.4.1;
next	1.2;

1.2
date	2001.12.16.23.49.46;	author miod;	state dead;
branches;
next	1.1;

1.1
date	2001.12.13.08.59.38;	author smurph;	state Exp;
branches;
next	;

1.3.4.1
date	2004.02.19.10.49.06;	author niklas;	state Exp;
branches;
next	1.3.4.2;

1.3.4.2
date	2004.06.05.23.09.48;	author niklas;	state Exp;
branches;
next	;


desc
@@


1.14
log
@Retire hp300, mvme68k and mvme88k ports. These ports have no users, keeping
this hardware alive is becoming increasingly difficult, and I should heed the
message sent by the three disks which have died on me over the last few days.

Noone sane will mourn these ports anyway. So long, and thanks for the fish.
@
text
@/*	$OpenBSD: busswreg.h,v 1.13 2009/02/14 17:39:51 miod Exp $ */

/*
 * Memory map for BusSwitch chip found in mvme197 boards.
 */
#ifndef	BUSSWREG_H
#define	BUSSWREG_H

#define BS_BASE		0xfff00000
#define	BS_SIZE		0x00000120

#define	BS_CHIPID	0x0000
#define	BS_CHIPREV	0x0001
#define	BS_GCSR		0x0002
#define	BS_IODATA	0x0004
#define	BS_IODIR	0x0006
#define	BS_PSAR1	0x0008
#define	BS_PEAR1	0x000a
#define	BS_PSAR2	0x000c
#define	BS_PEAR2	0x000e
#define	BS_PSAR3	0x0010
#define	BS_PEAR3	0x0012
#define	BS_PSAR4	0x0014
#define	BS_PEAR4	0x0016
#define	BS_PTR1		0x0018
#define	BS_PTSR1	0x001a
#define	BS_PTR2		0x001c
#define	BS_PTSR2	0x001e
#define	BS_PTR3		0x0020
#define	BS_PTSR3	0x0022
#define	BS_PTR4		0x0024
#define	BS_PTSR4	0x0026
#define	BS_SSAR1	0x0028
#define	BS_SEAR1	0x002a
#define	BS_SSAR2	0x002c
#define	BS_SEAR2	0x002e
#define	BS_SSAR3	0x0030
#define	BS_SEAR3	0x0032
#define	BS_SSAR4	0x0034
#define	BS_SEAR4	0x0036
#define	BS_STR1		0x0038
#define	BS_STSR1	0x003a
#define	BS_STR2		0x003c
#define	BS_STSR2	0x003e
#define	BS_STR3		0x0040
#define	BS_STSR3	0x0042
#define	BS_STR4		0x0044
#define	BS_STSR4	0x0046
#define	BS_PAR		0x0048
#define	BS_SAR		0x004c
#define	BS_BTIMER	0x0051
#define	BS_PADJUST	0x0052
#define	BS_PCOUNT	0x0053
#define	BS_PAL		0x0054
#define	BS_WPPA		0x0058
#define	BS_WPTPA	0x005c
#define	BS_WPPAT	0x005e
#define	BS_ROMCR	0x0060
#define	BS_TCTRL1	0x0062
#define	BS_TCTRL2	0x0063
#define	BS_LEVEL	0x0064
#define	BS_MASK		0x0065
#define	BS_ISEL0	0x0066	/* do not access on 197LE!!! */
#define	BS_ISEL1	0x0067	/* do not access on 197LE!!! */
#define	BS_ABORT	0x0068
#define	BS_CPINT	0x0069
#define	BS_TINT1	0x006a
#define	BS_TINT2	0x006b
#define	BS_WPINT	0x006c
#define	BS_PALINT	0x006d
#define	BS_XINT		0x006e
#define	BS_VBASE	0x006f
#define	BS_TCOMP1	0x0070
#define	BS_TCOUNT1	0x0074
#define	BS_TCOMP2	0x0078
#define	BS_TCOUNT2	0x007c
#define	BS_GPR		0x0080
#define	BS_XCTAGS	0x0090
#define	BS_XCCR		0x0100
#define	BS_VEC		0x0104

#define	BUSSWITCH_ID	0x21	/* value at CHIPID */

/* GCSR bit definitions */
#define BS_GCSR_APRI0	0x0001	/* Bus Request 0 Priority indicator (CPU0)*/
#define BS_GCSR_APRI1	0x0002	/* Bus Request 1 Priority indicator (CPU1)*/
#define BS_GCSR_APRI2	0x0003	/* Bus Request 2 Priority indicator (mc88410)*/
#define BS_GCSR_AMOD	0x0004	/* Arbitration Mode */
#define BS_GCSR_BREN	0x0008	/* Bus Request Enable */
#define BS_GCSR_CPUID	0x0010	/* CPU ID */
#define BS_GCSR_B410	0x0020	/* BUS410 indicator */
#define BS_GCSR_INVD	0x0040	/* Invalidate Decoder */
#define BS_GCSR_USR	0x0080	/* User Access Enable */
#define BS_GCSR_XIPL	0x0100	/* External IPL Enable */
#define BS_GCSR_TCPU1	0x0200	/* Test CPU 1 Registers */
#define BS_GCSR_XCC	0x0400	/* External Cache Controller */
#define BS_GCSR_INCB	0x0800	/* Increment On Burst */
#define BS_GCSR_TDPR	0x2000	/* Test Dual Processor Registers */
#define BS_GCSR_TBB	0x4000	/* Test Bus Busy */
#define BS_GCSR_POR	0x8000	/* Power On Reset */

/* Processor Attribute Registers bit definitions */
#define BS_PAR_DEN	0x01	/* Decode Enable */
#define BS_PAR_WPEN	0x02	/* Write Post Enable */

/* System Attribute Registers bit definitions */
#define BS_SAR_DEN	0x01	/* Decode Enable */
#define BS_SAR_INVR	0x04	/* Invalidate On Reads */
#define BS_SAR_GBL	0x08	/* Global Access */

/* Bus Timer Register bit definitions */
#define BS_BTIMER_PBT8		0x00	/* Processor Bus Timout, 8 usec */
#define BS_BTIMER_PBT64		0x01	/* Processor Bus Timout, 64 usec */
#define BS_BTIMER_PBT256	0x02	/* Processor Bus Timout, 256 usec */
#define BS_BTIMER_PBTD		0x03	/* Processor Bus Timout, disable */
#define	BS_BTIMER_PBT_MASK	0x03
#define BS_BTIMER_SBT8		0x00	/* System Bus Timout, 8 usec */
#define BS_BTIMER_SBT64		0x04	/* System Bus Timout, 64 usec */
#define BS_BTIMER_SBT256	0x08	/* System Bus Timout, 256 usec */
#define BS_BTIMER_SBTD		0x0c	/* System Bus Timout, disable */
#define	BS_BTIMER_SBT_MASK	0x0c

/* ROM Control Register bit definitions */
#define BS_ROMCR_WEN0	0x0100
#define BS_ROMCR_WEN1   0x0200
#define BS_ROMCR_SGLB	0x0400
#define BS_ROMCR_ROM0	0x8000

/* External Cache Control Register bit definitions */
#define BS_XCC_F0	0x00000001
#define BS_XCC_F1	0x00000002
#define BS_XCC_FBSY	0x00000004
#define BS_XCC_DIAG	0x00000008

/* Abort Control Register */
#define BS_ABORT_ICLR	0x08	/* abort interrupt clear */
#define BS_ABORT_IEN	0x10	/* abort interrupt enable */
#define BS_ABORT_INT	0x20	/* abort interrupt received */
#define BS_ABORT_ABT	0x40	/* abort interrupt asserted */

/* Cross Processor Interrupt Register */
#define BS_CPI_ICLR	0x08	/* cpi interrupt clear */
#define BS_CPI_IEN	0x10	/* cpi interrupt enable */
#define BS_CPI_INT	0x20	/* cpi interrupt received */
#define BS_CPI_STAT	0x40	/* cpi interrupt status */
#define BS_CPI_SCPI	0x80	/* send cross proc interrupt */

/* Timer Control Register */
#define BS_TCTRL_CEN	0x01	/* counter enable */
#define BS_TCTRL_COC	0x02	/* clear on compare */
#define BS_TCTRL_COVF	0x04	/* clear overflow counter */
#define BS_TCTRL_OVF(x)		((x) >> 4)	/* overflow counter */

/* Timer Interrupt Register */
#define BS_TINT_ICLR	0x08	/* timer interrupt clear */
#define BS_TINT_IEN	0x10	/* timer interrupt enable */
#define BS_TINT_INT	0x20	/* timer interrupt received */
#define BS_TINT_LM	0x07	/* timer level mask */
#define BS_TINT_LEVEL(x)	(x & BS_TINT_LM)

/* Write Post Control Register */
#define BS_WPINT_ICLR	0x08	/* WPINT interrupt clear */
#define BS_WPINT_IEN	0x10	/* WPINT interrupt enable */
#define BS_WPINT_INT	0x20	/* WPINT interrupt received */
#define BS_WPINT_LM	0x07	/* WPINT level mask */
#define BS_WPINT_LEVEL(x)	(x & BS_WPINT_LM)

/* Processor Address Log Interrupt Register */
#define BS_PALINT_ICLR	0x08	/* PALINT interrupt clear */
#define BS_PALINT_IEN	0x10	/* PALINT interrupt enable */
#define BS_PALINT_INT	0x20	/* PALINT interrupt received */
#define BS_PALINT_PLTY	0x80	/* PALINT polarity */
#define BS_PALINT_LM	0x07	/* PALINT level mask */
#define BS_PALINT_LEVEL(x)	(x & BS_PALINT_LM)

/* External Interrupt Register */
#define BS_XINT_ICLR	0x08	/* XINT interrupt clear */
#define BS_XINT_IEN	0x10	/* XINT interrupt enable */
#define BS_XINT_INT	0x20	/* XINT interrupt received */
#define BS_XINT_EL	0x40	/* XINT edge/level */
#define BS_XINT_PLTY	0x80	/* XINT polarity */
#define BS_XINT_LM	0x07	/* XINT level mask */
#define BS_XINT_LEVEL(x)	(x & BS_XINT_LM)

/* Vector Base Register (A read upon an interrupt reveals the source) */
#define BS_VBASE_SRC_TMR1	0x0
#define BS_VBASE_SRC_TMR2	0x1
#define BS_VBASE_SRC_WPE	0x2
#define BS_VBASE_SRC_PAL	0x3
#define BS_VBASE_SRC_EXT	0x4	/* external interrupt */
#define BS_VBASE_SRC_SPUR	0x7	/* spurious interrupt */

/*
 * BusSwitch wired interrupt vectors
 */

#define BS_VECBASE	0x40		/* vector base */
#define BS_NVEC		0x10

#define BS_TMR1IRQ	0x00		/* timer1 */
#define BS_TMR2IRQ	0x01		/* timer2 */
#define	BS_WPEIRQ	0x02		/* write post error */
#define	BS_PALIRQ	0x03		/* processor address log interrupt */
#define	BS_EXTIRQ	0x04		/* external interrupt */
#define	BS_SPURIRQ	0x07		/* spurious interrupt */

#endif	/* BUSSWREG_H */
@


1.13
log
@Fix a few defines.
@
text
@d1 1
a1 1
/*	$OpenBSD: busswreg.h,v 1.12 2009/02/13 23:28:05 miod Exp $ */
@


1.12
log
@Provide a specific delay() routine using separate timers for the two cpus
on MVME197DP boards running the MP kernel.
@
text
@d1 1
a1 1
/*	$OpenBSD: busswreg.h,v 1.11 2007/12/25 20:23:02 miod Exp $ */
d169 1
a169 1
#define BS_PALINT_ICLR	0x00	/* PALINT interrupt clear */
d177 1
a177 1
#define BS_XINT_ICLR	0x00	/* XINT interrupt clear */
@


1.11
log
@Increase timeout on the processor bus when running without snooping enabled.
This lets 40MHz MVME197LE boards run with instruction cache enabled, and also
fixes random instruction faults occuring on the early 50MHz models.
@
text
@d1 1
a1 1
/*	$OpenBSD: busswreg.h,v 1.10 2007/12/13 18:50:10 miod Exp $ */
d148 12
a159 13
/* Timer Interrupt 1 Register */
#define BS_TINT1_ICLR	0x08	/* timer 1 interrupt clear */
#define BS_TINT1_IEN	0x10	/* timer 1 interrupt enable */
#define BS_TINT1_INT	0x20	/* timer 1 interrupt received */
#define BS_TINT1_LM	0x07	/* timer 1 level mask */
#define BS_TINT1_LEVEL(x)	(x & BS_TINT1_LM)

/* Timer Interrupt 2 Register */
#define BS_TINT2_ICLR	0x08	/* timer 1 interrupt clear */
#define BS_TINT2_IEN	0x10	/* timer 1 interrupt enable */
#define BS_TINT2_INT	0x20	/* timer 1 interrupt received */
#define BS_TINT2_LM	0x07	/* timer 1 level mask */
#define BS_TINT2_LEVEL(x)	(x & BS_TINT2_LM)
@


1.10
log
@Disable write posting, this does not work on BusSwitch revision #1. The BUG
should do this for us, but better play safe.
@
text
@d1 1
a1 1
/*	$OpenBSD: busswreg.h,v 1.9 2007/12/04 23:45:52 miod Exp $ */
d116 6
a121 10
#define BS_BTIMER_SBT8		(0x00 << 2)	/* System Bus Timout, 8 usec */
#define BS_BTIMER_SBT64		(0x01 << 2)	/* System Bus Timout, 64 usec */
#define BS_BTIMER_SBT256	(0x02 << 2)	/* System Bus Timout, 256 usec */
#define BS_BTIMER_SBTD		(0x03 << 2)	/* System Bus Timout, disable */

/* Prescaler Adjust values */
#define BS_PADJUST_50	0xce	/* 50 MHz clock */
#define BS_PADJUST_40	0xd8	/* 40 MHz clock */
#define BS_PADJUST_33	0xdf	/* 33 MHz clock */
#define BS_PADJUST_25	0xe7	/* 25 MHz clock */
@


1.9
log
@Work in progress SMP code for 88110 processor using the BusSwitch chip as
an IPI facility, for MVME197DP.

It's still missing a few remote cache IPIs and IPI do not seem to be reliably
triggered on remote processors at the moment (but this could be a problem
on the board I am currently testing on), at least it will boot multiuser
using only cpu0 to schedule processes.
@
text
@d1 1
a1 1
/*	$OpenBSD: busswreg.h,v 1.8 2007/11/22 05:53:57 miod Exp $ */
d101 4
@


1.8
log
@Quote a few errata to explain why odd things are done in oddly ways on 88110.
@
text
@d1 1
a1 1
/*	$OpenBSD: busswreg.h,v 1.7 2005/12/11 21:31:36 miod Exp $ */
d194 5
a198 2
/* We lock off BusSwitch vectors at 0x40 */
#define BS_VECBASE	0x40
d201 6
a206 7
/* Bottom 4 bits of the vector returned during IACK cycle */
#define BS_TMR1IRQ	0x01	/* lowest */
#define BS_TMR2IRQ	0x02
#define BS_ABORTIRQ	0x03

/* Define the Abort vector */
#define BS_ABORTVEC  	(BS_VECBASE | BS_ABORTIRQ)
@


1.7
log
@Fix ROMCR defines.
@
text
@d1 1
a1 1
/*	$OpenBSD: busswreg.h,v 1.6 2004/04/24 19:51:47 miod Exp $ */
d63 2
a64 2
#define	BS_ISEL0	0x0066
#define	BS_ISEL1	0x0067
@


1.6
log
@Preliminary switch to an mvme88k bus_space world. Not all drivers have been
converted yet, and they rely upon some linear mappings provided by bus_space.

In order to not impact performance, almost all the bus_space accesses go
through macros and inline functions. This currently restricts us to D16 and
D32 access modes, which are selected at compilation time. Since there are no
plans to support D8 vme devices in the future, this is acceptable for now.

This makes the "len" locator for vme devices go away, and allows to simplify
some code which was using the pcctwo device, and will now directly access
hardware which is known to exist, rather than wait until the device is
attached.

While there, try to enforce more interrupt vector number checks, since these
changes pointed out that dart(4) had been working correctly so far by sheer
luck only.
@
text
@d1 1
a1 1
/*	$OpenBSD: busswreg.h,v 1.5 2004/04/14 20:17:21 miod Exp $ */
d85 16
a100 16
#define BS_GCSR_APRI0	0x00000001	/* Bus Request 0 Priority indicator (CPU0)*/
#define BS_GCSR_APRI1	0x00000002	/* Bus Request 1 Priority indicator (CPU1)*/
#define BS_GCSR_APRI2	0x00000003	/* Bus Request 2 Priority indicator (mc88410)*/
#define BS_GCSR_AMOD	0x00000004	/* Arbitration Mode */
#define BS_GCSR_BREN	0x00000008	/* Bus Request Enable */
#define BS_GCSR_CPUID	0x00000010	/* CPU ID */
#define BS_GCSR_B410	0x00000020	/* BUS410 indicator */
#define BS_GCSR_INVD	0x00000040	/* Invalidate Decoder */
#define BS_GCSR_USR	0x00000080	/* User Access Enable */
#define BS_GCSR_XIPL	0x00000100	/* External IPL Enable */
#define BS_GCSR_TCPU1	0x00000200	/* Test CPU 1 Registers */
#define BS_GCSR_XCC	0x00000400	/* External Cache Controller */
#define BS_GCSR_INCB	0x00000800	/* Increment On Burst */
#define BS_GCSR_TDPR	0x00002000	/* Test Dual Processor Registers */
#define BS_GCSR_TBB	0x00004000	/* Test Bus Busy */
#define BS_GCSR_POR	0x00008000	/* Power On Reset */
d124 4
a127 4
#define BS_ROMCR_WEN0	0x01000000
#define BS_ROMCR_WEN1   0x02000000
#define BS_ROMCR_SGLB	0x04000000
#define BS_ROMCR_ROM0	0x80000000
@


1.5
log
@Get the right address for the BusSwitch external cache control register.
@
text
@d1 1
a1 1
/*	$OpenBSD: busswreg.h,v 1.4 2003/10/11 22:08:57 miod Exp $ */
d6 77
a82 69
#ifndef BUSSWREG_H
#define BUSSWREG_H
#define BS_BASE	0xFFF00000

struct bussw_reg {
	volatile u_long		bs_gcsr;
	volatile u_short	bs_iodata;
	volatile u_short	bs_iodir;
	volatile u_short	bs_psar1;
	volatile u_short	bs_pear1;
	volatile u_short	bs_psar2;
	volatile u_short	bs_pear2;
	volatile u_short	bs_psar3;
	volatile u_short	bs_pear3;
	volatile u_short	bs_psar4;
	volatile u_short	bs_pear4;
	volatile u_short	bs_ptr1;
	volatile u_short	bs_ptsr1;
	volatile u_short	bs_ptr2;
	volatile u_short	bs_ptsr2;
	volatile u_short	bs_ptr3;
	volatile u_short	bs_ptsr3;
	volatile u_short	bs_ptr4;
	volatile u_short	bs_ptsr4;
	volatile u_short	bs_ssar1;
	volatile u_short	bs_sear1;
	volatile u_short	bs_ssar2;
	volatile u_short	bs_sear2;
	volatile u_short	bs_ssar3;
	volatile u_short	bs_sear3;
	volatile u_short	bs_ssar4;
	volatile u_short	bs_sear4;
	volatile u_short	bs_str1;
	volatile u_short	bs_stsr1;
	volatile u_short	bs_str2;
	volatile u_short	bs_stsr2;
	volatile u_short	bs_str3;
	volatile u_short	bs_stsr3;
	volatile u_short	bs_str4;
	volatile u_short	bs_stsr4;
	volatile u_long		bs_par;
	volatile u_long		bs_sar;
	volatile u_long		bs_btimer;
	volatile u_long		bs_pal;
	volatile u_long		bs_wppa;
	volatile u_long		bs_wp;
	volatile u_long		bs_romcr;
	volatile u_long		bs_lmi;
	volatile u_long		bs_intr1;
	volatile u_long		bs_intr2;
	volatile u_long		bs_tcomp1;
	volatile u_long		bs_tcount1;
	volatile u_long		bs_tcomp2;
	volatile u_long		bs_tcount2;
	volatile u_long		bs_gpr1;
	volatile u_long		bs_gpr2;
	volatile u_long		bs_gpr3;
	volatile u_long		bs_gpr4;
	volatile u_long		bs_xctags;
	volatile u_int8_t	bs_res[(0x100 - 0x94)];
	volatile u_long		bs_xccr;
	volatile u_long		bs_vec1;
	volatile u_long		bs_vec2;
	volatile u_long		bs_vec3;
	volatile u_long		bs_vec4;
	volatile u_long		bs_vec5;
	volatile u_long		bs_vec6;
	volatile u_long		bs_vec7;
};
a84 2
#define BS_CHIPID(x)	(((x)->bs_gcsr & 0xFF000000) >> 16)
#define BS_CHIPREV(x)	(((x)->bs_gcsr & 0x00FF0000) >> 16)
d118 4
a121 4
#define BS_PADJUST_50	0xCE	/* 50 MHz clock */
#define BS_PADJUST_40	0xD8	/* 40 MHz clock */
#define BS_PADJUST_33	0xDF	/* 33 MHz clock */
#define BS_PADJUST_25	0xE7	/* 25 MHz clock */
d135 50
a184 28
/*
 * INTR1 - Abort Control Register
 * Cross Processor Interrupt Register
 * Timer Interrupt 1 Register
 * Timer Interrupt 2 Register
 */
#define BS_INTR1_ABORT_ICLR	0x08000000	/* abort interrupt clear */
#define BS_INTR1_ABORT_IEN	0x10000000	/* abort interrupt enable */
#define BS_INTR1_ABORT_INT	0x20000000	/* abort interrupt received */
#define BS_INTR1_ABORT_ABT	0x40000000	/* abort interrupt asserted */

#define BS_INTR1_CPI_ICLR	0x00080000	/* cpi interrupt clear */
#define BS_INTR1_CPI_IEN	0x00100000	/* cpi interrupt enable */
#define BS_INTR1_CPI_INT	0x00200000	/* cpi interrupt received */
#define BS_INTR1_CPI_STAT	0x00400000	/* cpi interrupt status */
#define BS_INTR1_CPI_SCPI	0x00800000	/* send cross proc interrupt */

#define BS_INTR1_TINT1_ICLR	0x00000800	/* timer 1 interrupt clear */
#define BS_INTR1_TINT1_IEN	0x00001000	/* timer 1 interrupt enable */
#define BS_INTR1_TINT1_INT	0x00002000	/* timer 1 interrupt received */
#define BS_INTR1_TINT1_LM	0x00000700	/* timer 1 level mask */
#define BS_INTR1_TINT1_LEVEL(x)	((x << 8) & BS_INTR1_TINT1_LM)

#define BS_INTR1_TINT2_ICLR	0x00000008	/* timer 1 interrupt clear */
#define BS_INTR1_TINT2_IEN	0x00000010	/* timer 1 interrupt enable */
#define BS_INTR1_TINT2_INT	0x00000020	/* timer 1 interrupt received */
#define BS_INTR1_TINT2_LM	0x00000007	/* timer 1 level mask */
#define BS_INTR1_TINT2_LEVEL(x)	(x & BS_INTR1_TINT2_LM)
a193 27
/*
 * INTR2 - Write Post Control Register
 * Processor Address Log Interrupt Register
 * External Interrupt Register
 * Vector Base
 */
#define BS_INTR2_WPINT_ICLR	0x08000000	/* WPINT interrupt clear */
#define BS_INTR2_WPINT_IEN	0x10000000	/* WPINT interrupt enable */
#define BS_INTR2_WPINT_INT	0x20000000	/* WPINT interrupt received */
#define BS_INTR2_WPINT_LM	0x07000000	/* WPINT level mask */
#define BS_INTR2_WPINT_LEVEL(x)	((x << 24) & BS_INTR2_WPINT_LM)

#define BS_INTR2_PALINT_ICLR	0x00080000	/* PALINT interrupt clear */
#define BS_INTR2_PALINT_IEN	0x00100000	/* PALINT interrupt enable */
#define BS_INTR2_PALINT_INT	0x00200000	/* PALINT interrupt received */
#define BS_INTR2_PALINT_PLTY	0x00800000	/* PALINT polarity */
#define BS_INTR2_PALINT_LM	0x00070000	/* PALINT level mask */
#define BS_INTR2_PALINT_LEVEL(x)	((x << 16) & BS_INTR2_PALINT_LM)

#define BS_INTR2_XINT_ICLR	0x00000800	/* XINT interrupt clear */
#define BS_INTR2_XINT_IEN	0x00001000	/* XINT interrupt enable */
#define BS_INTR2_XINT_INT	0x00002000	/* XINT interrupt received */
#define BS_INTR2_XINT_EL	0x00004000	/* XINT edge/level */
#define BS_INTR2_XINT_PLTY	0x00008000	/* XINT polarity */
#define BS_INTR2_XINT_LM	0x00000700	/* XINT level mask */
#define BS_INTR2_XINT_LEVEL(x)	((x << 24) & BS_INTR2_XINT_LM)

d196 1
a196 1
#define BS_NVEC		16
d206 1
a206 1
#endif /* BUSSWREG_H */
@


1.4
log
@Nuke trailing whitespace.
@
text
@d1 1
a1 1
/*	$OpenBSD: busswreg.h,v 1.3 2001/12/19 04:02:25 smurph Exp $ */
d65 1
a65 1
	volatile u_long		bs_res3;
@


1.3
log
@bus switch name shortened.  Added register definitons and functionality.
@
text
@d1 1
a1 1
/*	$OpenBSD: busswitchreg.h,v 1.3 2001/12/16 23:49:46 miod Exp $ */
d129 5
a133 5
/* 
 * INTR1 - Abort Control Register 
 * Cross Processor Interrupt Register 
 * Timer Interrupt 1 Register 
 * Timer Interrupt 2 Register 
d166 5
a170 5
/* 
 * INTR2 - Write Post Control Register 
 * Processor Address Log Interrupt Register 
 * External Interrupt Register 
 * Vector Base 
@


1.3.4.1
log
@Merge of current from two weeks agointo the SMP branch
@
text
@d1 1
a1 1
/*	$OpenBSD$ */
d129 5
a133 5
/*
 * INTR1 - Abort Control Register
 * Cross Processor Interrupt Register
 * Timer Interrupt 1 Register
 * Timer Interrupt 2 Register
d166 5
a170 5
/*
 * INTR2 - Write Post Control Register
 * Processor Address Log Interrupt Register
 * External Interrupt Register
 * Vector Base
@


1.3.4.2
log
@Merge with the trunk
@
text
@d6 69
a74 77
#ifndef	BUSSWREG_H
#define	BUSSWREG_H

#define BS_BASE		0xfff00000
#define	BS_SIZE		0x00000120

#define	BS_CHIPID	0x0000
#define	BS_CHIPREV	0x0001
#define	BS_GCSR		0x0002
#define	BS_IODATA	0x0004
#define	BS_IODIR	0x0006
#define	BS_PSAR1	0x0008
#define	BS_PEAR1	0x000a
#define	BS_PSAR2	0x000c
#define	BS_PEAR2	0x000e
#define	BS_PSAR3	0x0010
#define	BS_PEAR3	0x0012
#define	BS_PSAR4	0x0014
#define	BS_PEAR4	0x0016
#define	BS_PTR1		0x0018
#define	BS_PTSR1	0x001a
#define	BS_PTR2		0x001c
#define	BS_PTSR2	0x001e
#define	BS_PTR3		0x0020
#define	BS_PTSR3	0x0022
#define	BS_PTR4		0x0024
#define	BS_PTSR4	0x0026
#define	BS_SSAR1	0x0028
#define	BS_SEAR1	0x002a
#define	BS_SSAR2	0x002c
#define	BS_SEAR2	0x002e
#define	BS_SSAR3	0x0030
#define	BS_SEAR3	0x0032
#define	BS_SSAR4	0x0034
#define	BS_SEAR4	0x0036
#define	BS_STR1		0x0038
#define	BS_STSR1	0x003a
#define	BS_STR2		0x003c
#define	BS_STSR2	0x003e
#define	BS_STR3		0x0040
#define	BS_STSR3	0x0042
#define	BS_STR4		0x0044
#define	BS_STSR4	0x0046
#define	BS_PAR		0x0048
#define	BS_SAR		0x004c
#define	BS_BTIMER	0x0051
#define	BS_PADJUST	0x0052
#define	BS_PCOUNT	0x0053
#define	BS_PAL		0x0054
#define	BS_WPPA		0x0058
#define	BS_WPTPA	0x005c
#define	BS_WPPAT	0x005e
#define	BS_ROMCR	0x0060
#define	BS_TCTRL1	0x0062
#define	BS_TCTRL2	0x0063
#define	BS_LEVEL	0x0064
#define	BS_MASK		0x0065
#define	BS_ISEL0	0x0066
#define	BS_ISEL1	0x0067
#define	BS_ABORT	0x0068
#define	BS_CPINT	0x0069
#define	BS_TINT1	0x006a
#define	BS_TINT2	0x006b
#define	BS_WPINT	0x006c
#define	BS_PALINT	0x006d
#define	BS_XINT		0x006e
#define	BS_VBASE	0x006f
#define	BS_TCOMP1	0x0070
#define	BS_TCOUNT1	0x0074
#define	BS_TCOMP2	0x0078
#define	BS_TCOUNT2	0x007c
#define	BS_GPR		0x0080
#define	BS_XCTAGS	0x0090
#define	BS_XCCR		0x0100
#define	BS_VEC		0x0104

#define	BUSSWITCH_ID	0x21	/* value at CHIPID */
d77 2
d112 4
a115 4
#define BS_PADJUST_50	0xce	/* 50 MHz clock */
#define BS_PADJUST_40	0xd8	/* 40 MHz clock */
#define BS_PADJUST_33	0xdf	/* 33 MHz clock */
#define BS_PADJUST_25	0xe7	/* 25 MHz clock */
d129 28
a156 50
/* Abort Control Register */
#define BS_ABORT_ICLR	0x08	/* abort interrupt clear */
#define BS_ABORT_IEN	0x10	/* abort interrupt enable */
#define BS_ABORT_INT	0x20	/* abort interrupt received */
#define BS_ABORT_ABT	0x40	/* abort interrupt asserted */

/* Cross Processor Interrupt Register */
#define BS_CPI_ICLR	0x08	/* cpi interrupt clear */
#define BS_CPI_IEN	0x10	/* cpi interrupt enable */
#define BS_CPI_INT	0x20	/* cpi interrupt received */
#define BS_CPI_STAT	0x40	/* cpi interrupt status */
#define BS_CPI_SCPI	0x80	/* send cross proc interrupt */

/* Timer Interrupt 1 Register */
#define BS_TINT1_ICLR	0x08	/* timer 1 interrupt clear */
#define BS_TINT1_IEN	0x10	/* timer 1 interrupt enable */
#define BS_TINT1_INT	0x20	/* timer 1 interrupt received */
#define BS_TINT1_LM	0x07	/* timer 1 level mask */
#define BS_TINT1_LEVEL(x)	(x & BS_TINT1_LM)

/* Timer Interrupt 2 Register */
#define BS_TINT2_ICLR	0x08	/* timer 1 interrupt clear */
#define BS_TINT2_IEN	0x10	/* timer 1 interrupt enable */
#define BS_TINT2_INT	0x20	/* timer 1 interrupt received */
#define BS_TINT2_LM	0x07	/* timer 1 level mask */
#define BS_TINT2_LEVEL(x)	(x & BS_TINT2_LM)

/* Write Post Control Register */
#define BS_WPINT_ICLR	0x08	/* WPINT interrupt clear */
#define BS_WPINT_IEN	0x10	/* WPINT interrupt enable */
#define BS_WPINT_INT	0x20	/* WPINT interrupt received */
#define BS_WPINT_LM	0x07	/* WPINT level mask */
#define BS_WPINT_LEVEL(x)	(x & BS_WPINT_LM)

/* Processor Address Log Interrupt Register */
#define BS_PALINT_ICLR	0x00	/* PALINT interrupt clear */
#define BS_PALINT_IEN	0x10	/* PALINT interrupt enable */
#define BS_PALINT_INT	0x20	/* PALINT interrupt received */
#define BS_PALINT_PLTY	0x80	/* PALINT polarity */
#define BS_PALINT_LM	0x07	/* PALINT level mask */
#define BS_PALINT_LEVEL(x)	(x & BS_PALINT_LM)

/* External Interrupt Register */
#define BS_XINT_ICLR	0x00	/* XINT interrupt clear */
#define BS_XINT_IEN	0x10	/* XINT interrupt enable */
#define BS_XINT_INT	0x20	/* XINT interrupt received */
#define BS_XINT_EL	0x40	/* XINT edge/level */
#define BS_XINT_PLTY	0x80	/* XINT polarity */
#define BS_XINT_LM	0x07	/* XINT level mask */
#define BS_XINT_LEVEL(x)	(x & BS_XINT_LM)
d166 27
d195 1
a195 1
#define BS_NVEC		0x10
d205 1
a205 1
#endif	/* BUSSWREG_H */
@


1.2
log
@Revert the mvme88k to 20011212. Recent changes had not been merged correctly,
and I am fed up with dissecting diffs to put back code that disappeared.
This will likely be fixed shortly.
@
text
@d1 1
a1 1
/*	$OpenBSD: busswreg.h,v 1.1 2001/12/13 08:59:38 smurph Exp $ */
@


1.1
log
@Support for MVME917 complete.
@
text
@d1 1
a1 1
/*	$OpenBSD: busswitchreg.h,v 1.1 1999/09/27 18:43:22 smurph Exp $ */
@

