head	1.5;
access;
symbols
	OPENBSD_6_1:1.5.0.2
	OPENBSD_6_1_BASE:1.5
	OPENBSD_6_0:1.4.0.12
	OPENBSD_6_0_BASE:1.4
	OPENBSD_5_9:1.4.0.8
	OPENBSD_5_9_BASE:1.4
	OPENBSD_5_8:1.4.0.10
	OPENBSD_5_8_BASE:1.4
	OPENBSD_5_7:1.4.0.2
	OPENBSD_5_7_BASE:1.4
	OPENBSD_5_6:1.4.0.6
	OPENBSD_5_6_BASE:1.4
	OPENBSD_5_5:1.4.0.4
	OPENBSD_5_5_BASE:1.4
	OPENBSD_5_4:1.1.0.4
	OPENBSD_5_4_BASE:1.1
	OPENBSD_5_3:1.1.0.2
	OPENBSD_5_3_BASE:1.1;
locks; strict;
comment	@# @;


1.5
date	2017.03.16.18.08.58;	author miod;	state Exp;
branches;
next	1.4;
commitid	G8Owr7HwSA0X9pAf;

1.4
date	2013.11.03.09.42.55;	author miod;	state Exp;
branches;
next	1.3;

1.3
date	2013.11.02.23.42.12;	author miod;	state Exp;
branches;
next	1.2;

1.2
date	2013.10.30.18.20.59;	author miod;	state dead;
branches;
next	1.1;

1.1
date	2013.01.05.11.20.55;	author miod;	state Exp;
branches;
next	;


desc
@@


1.5
log
@Fix passing entropy from boot loader to the kernel:
- make sure the kernel has a PT_OPENBSD_RANDOMIZE phdr.
- load /etc/random.conf in all cases, not only manual boot (oops).

ok aoyama@@
@
text
@/*	$OpenBSD: ld.script,v 1.4 2013/11/03 09:42:55 miod Exp $	*/

/*
 * Copyright (c) 2012 Miodrag Vallat.
 *
 * Permission to use, copy, modify, and distribute this software for any
 * purpose with or without fee is hereby granted, provided that the above
 * copyright notice and this permission notice appear in all copies.
 *
 * THE SOFTWARE IS PROVIDED "AS IS" AND THE AUTHOR DISCLAIMS ALL WARRANTIES
 * WITH REGARD TO THIS SOFTWARE INCLUDING ALL IMPLIED WARRANTIES OF
 * MERCHANTABILITY AND FITNESS. IN NO EVENT SHALL THE AUTHOR BE LIABLE FOR
 * ANY SPECIAL, DIRECT, INDIRECT, OR CONSEQUENTIAL DAMAGES OR ANY DAMAGES
 * WHATSOEVER RESULTING FROM LOSS OF USE, DATA OR PROFITS, WHETHER IN AN
 * ACTION OF CONTRACT, NEGLIGENCE OR OTHER TORTIOUS ACTION, ARISING OUT OF
 * OR IN CONNECTION WITH THE USE OR PERFORMANCE OF THIS SOFTWARE.
 */

OUTPUT_FORMAT("elf32-m88k")
OUTPUT_ARCH(m88k)
ENTRY(__start)

PHDRS
{
	text			PT_LOAD;
	data			PT_LOAD;
	openbsd_randomize	PT_OPENBSD_RANDOMIZE;
}

SECTIONS
{
	.text :
	{
		*(.text)
		PROVIDE(etext = ABSOLUTE(.));
	}
	. = ALIGN(0x80000);
	.rodata :
	{
		*(.rodata*)
		PROVIDE(erodata = ABSOLUTE(.));
	}
	. = ALIGN(0x80000);
	.data :
	{
		*(.data)
	} :data
	.openbsd.randomdata :
	{
		*(.openbsd.randomdata)
	} :data :openbsd_randomize
	PROVIDE(edata = ABSOLUTE(.));
	.bss :
	{
		*(.bss)
	} :data
	PROVIDE(end = ABSOLUTE(.));
	/DISCARD/ :
	{
		*(.comment)
	}
}
@


1.4
log
@Even saner kernel layout, so that .rodata can be batc mapped by a read-only
dbatc. Add batc mapping support for 88110 systems as well.
@
text
@d1 1
a1 1
/*	$OpenBSD: ld.script,v 1.1 2013/11/02 23:42:12 miod Exp $	*/
d22 8
d47 6
a52 2
		PROVIDE(edata = ABSOLUTE(.));
	}
d56 1
a56 1
	}
@


1.3
log
@Use a linker script to align .data to a BATC boundary as well, so that no
DBATC may span over parts of .rodata.
@
text
@d1 1
a1 1
/*	$OpenBSD$	*/
a18 5
/*
 * This linker script is used to merge .rodata into .text and pad .text to
 * a page size. This allows objcopy to correctly be able to convert it to
 * an OMAGIC binary, suitable to be booted from the PROM.
 */
d27 5
d33 1
a33 3
		PROVIDE(etext = ABSOLUTE(.));
		FILL(0)
		. = ALIGN(0x80000);
d35 1
@


1.2
log
@No longer build luna88k kernels as a.out binaries, now that we have a native
bootloader for ELF kernels.
@
text
@d1 1
a1 1
/*	$OpenBSD: ld.script,v 1.1 2013/01/05 11:20:55 miod Exp $	*/
d34 2
a35 2
		FILL(0xf4005800)
		. = ALIGN(0x1000);
@


1.1
log
@Switch m88k ports to ELF.
@
text
@d1 1
a1 1
/*	$OpenBSD$	*/
@

