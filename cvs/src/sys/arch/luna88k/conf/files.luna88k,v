head	1.29;
access;
symbols
	OPENBSD_6_1:1.28.0.4
	OPENBSD_6_1_BASE:1.28
	OPENBSD_6_0:1.27.0.6
	OPENBSD_6_0_BASE:1.27
	OPENBSD_5_9:1.27.0.2
	OPENBSD_5_9_BASE:1.27
	OPENBSD_5_8:1.27.0.4
	OPENBSD_5_8_BASE:1.27
	OPENBSD_5_7:1.26.0.2
	OPENBSD_5_7_BASE:1.26
	OPENBSD_5_6:1.20.0.4
	OPENBSD_5_6_BASE:1.20
	OPENBSD_5_5:1.19.0.4
	OPENBSD_5_5_BASE:1.19
	OPENBSD_5_4:1.17.0.2
	OPENBSD_5_4_BASE:1.17
	OPENBSD_5_3:1.16.0.10
	OPENBSD_5_3_BASE:1.16
	OPENBSD_5_2:1.16.0.8
	OPENBSD_5_2_BASE:1.16
	OPENBSD_5_1_BASE:1.16
	OPENBSD_5_1:1.16.0.6
	OPENBSD_5_0:1.16.0.4
	OPENBSD_5_0_BASE:1.16
	OPENBSD_4_9:1.16.0.2
	OPENBSD_4_9_BASE:1.16
	OPENBSD_4_8:1.14.0.16
	OPENBSD_4_8_BASE:1.14
	OPENBSD_4_7:1.14.0.12
	OPENBSD_4_7_BASE:1.14
	OPENBSD_4_6:1.14.0.14
	OPENBSD_4_6_BASE:1.14
	OPENBSD_4_5:1.14.0.10
	OPENBSD_4_5_BASE:1.14
	OPENBSD_4_4:1.14.0.8
	OPENBSD_4_4_BASE:1.14
	OPENBSD_4_3:1.14.0.6
	OPENBSD_4_3_BASE:1.14
	OPENBSD_4_2:1.14.0.4
	OPENBSD_4_2_BASE:1.14
	OPENBSD_4_1:1.14.0.2
	OPENBSD_4_1_BASE:1.14
	OPENBSD_4_0:1.13.0.2
	OPENBSD_4_0_BASE:1.13
	OPENBSD_3_9:1.11.0.2
	OPENBSD_3_9_BASE:1.11
	OPENBSD_3_8:1.10.0.2
	OPENBSD_3_8_BASE:1.10
	OPENBSD_3_7:1.9.0.2
	OPENBSD_3_7_BASE:1.9
	OPENBSD_3_6:1.6.0.2
	OPENBSD_3_6_BASE:1.6
	SMP_SYNC_A:1.3
	SMP_SYNC_B:1.3
	SMP:1.3.0.2
	LUNA88K_INIT:1.1.1.1
	AOYAMA:1.1.1;
locks; strict;
comment	@# @;


1.29
date	2017.07.23.09.17.17;	author aoyama;	state Exp;
branches;
next	1.28;
commitid	Xso53vaHdfOSocCV;

1.28
date	2016.12.17.05.22.34;	author aoyama;	state Exp;
branches;
next	1.27;
commitid	W72IaIdGRxWfqGM0;

1.27
date	2015.05.11.06.46.21;	author ratchov;	state Exp;
branches;
next	1.26;
commitid	RaOGL5SyOGOZylwx;

1.26
date	2015.03.03.23.50.37;	author aoyama;	state Exp;
branches;
next	1.25;
commitid	rOCVWqdqaeULSp8N;

1.25
date	2015.01.17.08.26.10;	author aoyama;	state Exp;
branches;
next	1.24;
commitid	0nonYwDfGynisfi6;

1.24
date	2014.12.28.13.03.18;	author aoyama;	state Exp;
branches;
next	1.23;
commitid	aLavKPgF3JbRlmVF;

1.23
date	2014.12.19.13.17.35;	author aoyama;	state Exp;
branches;
next	1.22;
commitid	IpU9SvwyHLVnnHwt;

1.22
date	2014.12.08.13.24.04;	author aoyama;	state Exp;
branches;
next	1.21;
commitid	8mGnZAAHoBrwOFWt;

1.21
date	2014.11.08.21.18.42;	author aoyama;	state Exp;
branches;
next	1.20;
commitid	3AErQav99gINh4rk;

1.20
date	2014.04.16.12.01.33;	author aoyama;	state Exp;
branches;
next	1.19;

1.19
date	2013.11.16.22.45.37;	author aoyama;	state Exp;
branches;
next	1.18;

1.18
date	2013.09.24.20.10.44;	author miod;	state Exp;
branches;
next	1.17;

1.17
date	2013.05.22.11.35.02;	author aoyama;	state Exp;
branches;
next	1.16;

1.16
date	2010.12.31.21.38.08;	author miod;	state Exp;
branches;
next	1.15;

1.15
date	2010.12.06.20.10.18;	author jasper;	state Exp;
branches;
next	1.14;

1.14
date	2007.02.09.14.26.09;	author aoyama;	state Exp;
branches;
next	1.13;

1.13
date	2006.08.06.13.04.31;	author miod;	state Exp;
branches;
next	1.12;

1.12
date	2006.06.19.15.13.35;	author deraadt;	state Exp;
branches;
next	1.11;

1.11
date	2005.10.24.19.28.25;	author miod;	state Exp;
branches;
next	1.10;

1.10
date	2005.05.01.21.36.56;	author brad;	state Exp;
branches;
next	1.9;

1.9
date	2005.03.08.20.00.23;	author tdeval;	state Exp;
branches;
next	1.8;

1.8
date	2004.10.08.13.04.36;	author grange;	state Exp;
branches;
next	1.7;

1.7
date	2004.10.03.19.47.23;	author miod;	state Exp;
branches;
next	1.6;

1.6
date	2004.07.25.11.06.39;	author miod;	state Exp;
branches;
next	1.5;

1.5
date	2004.07.23.15.34.02;	author miod;	state Exp;
branches;
next	1.4;

1.4
date	2004.06.19.18.28.33;	author miod;	state Exp;
branches;
next	1.3;

1.3
date	2004.05.07.15.08.25;	author aoyama;	state Exp;
branches
	1.3.2.1;
next	1.2;

1.2
date	2004.04.29.14.33.24;	author miod;	state Exp;
branches;
next	1.1;

1.1
date	2004.04.21.15.23.47;	author aoyama;	state Exp;
branches
	1.1.1.1;
next	;

1.1.1.1
date	2004.04.21.15.23.47;	author aoyama;	state Exp;
branches;
next	;

1.3.2.1
date	2004.06.05.23.09.45;	author niklas;	state Exp;
branches;
next	;


desc
@@


1.29
log
@Splitting early startup code out of locore.S into locore0.S, like other
architectures.

"Looking good" deraadt@@
@
text
@#	$OpenBSD: files.luna88k,v 1.28 2016/12/17 05:22:34 aoyama Exp $
#
maxpartitions 16

device 	mainbus {}
attach 	mainbus at root
file	arch/luna88k/luna88k/mainbus.c

device clock
attach clock at mainbus
file	arch/luna88k/dev/timekeeper.c			clock

device lcd
attach lcd at mainbus
file	arch/luna88k/dev/lcd.c				lcd needs-flag

attach le at mainbus: le24
file	arch/luna88k/dev/if_le.c			le

device sio {[channel = -1]}
attach sio at mainbus
file	arch/luna88k/dev/sio.c				sio

device siotty: tty
attach siotty at sio
file	arch/luna88k/dev/siotty.c			siotty needs-flag

device xp
attach xp at mainbus
file	arch/luna88k/dev/xp.c				xp needs-flag

device ws: wskbddev,wsmousedev
attach ws at sio
file arch/luna88k/dev/lunaws.c				ws
file arch/luna88k/dev/omkbdmap.c			ws

device fb: wsemuldisplaydev, rasops1
attach fb at mainbus
file arch/luna88k/dev/lunafb.c				fb
file arch/luna88k/dev/omrasops.c			fb
file arch/luna88k/dev/omrasops1.c			fb

# Raster operations
include "dev/rasops/files.rasops"
include "dev/wsfont/files.wsfont"
# "Workstation Console" glue.
include "dev/wscons/files.wscons"

device cpu
attach cpu at mainbus

include "scsi/files.scsi"

major {sd = 4}
major {st = 5}
major {cd = 6}
major {rd = 7}
major {vnd = 8}
major {wd = 9}

device spc: scsi
attach spc at mainbus
file arch/luna88k/dev/spc.c				spc
file arch/luna88k/dev/mb89352.c				spc

device cbus {}
attach	cbus at mainbus
file	arch/luna88k/cbus/cbus.c

device pcex
attach	pcex at cbus
file	arch/luna88k/cbus/pcex.c			pcex needs-flag

# NEC PC-9801-86 sound board
device	necsb: audio
attach	necsb at cbus
file	arch/luna88k/cbus/necsb.c			necsb needs-flag
file	arch/luna88k/cbus/nec86.c			necsb needs-flag
file	arch/luna88k/cbus/nec86hw.c			necsb needs-flag

# PCMCIA devices via NEC PC-9801-102 / PC-9821X[AE]-E01
device	pcic: pcmciabus
attach	pcic at cbus with pcic_cbus
file	dev/ic/i82365.c					pcic needs-flag
file	arch/luna88k/cbus/i82365_cbus.c			pcic needs-flag
include "dev/pcmcia/files.pcmcia"

# Media Independent Interface (mii), used with PCMCIA
include "dev/mii/files.mii"

# Machine-independent ATAPI drivers, used with PCMCIA
include "dev/atapiscsi/files.atapiscsi"
include "dev/ata/files.ata"

# list of standard files
file	arch/luna88k/luna88k/clock.c

file	arch/luna88k/luna88k/autoconf.c
file	arch/luna88k/luna88k/conf.c
file	arch/luna88k/luna88k/m8820x.c
file	arch/luna88k/luna88k/disksubr.c
file	arch/luna88k/luna88k/eh.S
file	arch/luna88k/luna88k/isr.c
file	arch/luna88k/luna88k/locore.S
file	arch/luna88k/luna88k/machdep.c
file	arch/luna88k/luna88k/pmap_table.c
@


1.28
log
@Add new device xp(4), preliminary support for LUNA's I/O processor.

This is a straightforward port of NetBSD/luna68k by Izumi Tsutsui(*),
and makes LUNA's I/O auxiliary processor (called XP, actually
HD647180) possible to load and run programs.

(*): http://mail-index.netbsd.org/source-changes/2016/12/03/msg079493.html
@
text
@d1 1
a1 1
#	$OpenBSD: files.luna88k,v 1.27 2015/05/11 06:46:21 ratchov Exp $
d104 1
@


1.27
log
@Remove all audio format conversion code from the kernel (btw holding
the kernel_lock), as we already do better conversions in
user-mode. Yet, no need for every single driver to fiddle with the
conversion code as they are done transparently by common MI code. With
help from armani and miod, support from mpi

ok armani@@
@
text
@d1 1
a1 1
#	$OpenBSD: files.luna88k,v 1.26 2015/03/03 23:50:37 aoyama Exp $
d27 4
@


1.26
log
@Add pcic(4) support on luna88k.

This is basically glue codes attaching pcic(4) at cbus(4/luna88k),
based on src/sys/dev/isa/i82365_isa{,subr}.c.

Tested on some ne(4) network interface cards, wdc(4) with a CF memory
card, and com(4) with an old XJACK modem card.  Currently wi(4) does
not work yet.

suggestions and ok miod@@
@
text
@d1 1
a1 1
#	$OpenBSD: files.luna88k,v 1.25 2015/01/17 08:26:10 aoyama Exp $
d71 1
a71 1
device	necsb: audio, auconv, mulaw
@


1.25
log
@Delete an extra tab.
@
text
@d1 1
a1 1
#	$OpenBSD: files.luna88k,v 1.24 2014/12/28 13:03:18 aoyama Exp $
d55 1
d71 19
a89 5
device necsb: audio, auconv, mulaw
attach necsb at cbus
file arch/luna88k/cbus/necsb.c				necsb needs-flag
file arch/luna88k/cbus/nec86.c				necsb needs-flag
file arch/luna88k/cbus/nec86hw.c			necsb needs-flag
@


1.24
log
@Add an audio driver, necsb(4), for NEC PC-9801-86 sound board on
cbus(4).

This work is based on the source code of NetBSD/pc98, an unofficial
NetBSD port for NEC PC-9801 series, written about 16 years ago.
Thanks to NetBSD/pc98 porting staff for their work, especially NAGAO
Tadaaki and N. Honda who wrote the original driver.

ok miod@@
@
text
@d1 1
a1 1
#	$OpenBSD: files.luna88k,v 1.23 2014/12/19 13:17:35 aoyama Exp $
d67 1
a67 1
file	arch/luna88k/cbus/pcex.c				pcex needs-flag
@


1.23
log
@Move cbus.c, cbusvar.h, and pcex.c to new 'cbus' directory, to gather
'C-bus' device drivers in it.

More devices on cbus(4) will be added, hopefully :-)

ok miod@@
@
text
@d1 1
a1 1
#	$OpenBSD: files.luna88k,v 1.22 2014/12/08 13:24:04 aoyama Exp $
a60 7
# XXX: now testing
#device pcm: audio, auconv, mulaw
#attach pcm at mainbus
#file arch/luna88k/dev/nec86.c				pcm needs-flag
#file arch/luna88k/dev/nec86hw.c			pcm needs-flag
#file arch/luna88k/dev/nec86_luna88k.c			pcm needs-flag

d68 7
@


1.22
log
@Add an intermediate layer driver, cbus(4), to manage its own
interrupts of PC-9801 extension board slot bus (so-called 'C-bus') on
LUNA-88K2.

Existing pcex(4) is now attached at cbus(4), i.e.

cbus0 at mainbus0
pcex0 at cbus0

With this driver, some other PC-9801 boards might be supported on luna88k
in the (near?) future:-)

ok miod@@
@
text
@d1 1
a1 1
#	$OpenBSD: files.luna88k,v 1.21 2014/11/08 21:18:42 aoyama Exp $
d70 1
a70 1
file	arch/luna88k/dev/cbus.c
d74 1
a74 1
file	arch/luna88k/dev/pcex.c				pcex needs-flag
@


1.21
log
@Delete commented out 'romtty' device configuration.

This had been used in the early years of poring OpenBSD to LUNA-88K,
but no longer used.
@
text
@d1 1
a1 1
#	$OpenBSD: files.luna88k,v 1.20 2014/04/16 12:01:33 aoyama Exp $
d68 4
d73 1
a73 1
attach	pcex at mainbus
@


1.20
log
@Add generic driver for "NEC PC-9801(*) extension board slot" on
LUNA-88K.

LUNA-88K{,2} has one or two slot(s) that can attach the extension
board designed for PC-9801.  This driver provides dedicated mmap(2)
and capability for waiting specified interrupt on that slot so that we
can use the extension board from userland program.

(*)PC-9801 is a Japanese popular personal computer, mainly used in
   1980-90's. (see http://en.wikipedia.org/wiki/NEC_PC-9801)

ok miod@@, and man pages jmc@@
@
text
@d1 1
a1 1
#	$OpenBSD: files.luna88k,v 1.19 2013/11/16 22:45:37 aoyama Exp $
a22 5

# this should be removed after bringup
#device romtty: tty
#attach romtty at mainbus
#file	arch/luna88k/dev/romtty.c			romtty needs-flag
@


1.19
log
@Re-organize luna88k rasops om_{copy,erase}{cols,rows} by using one
generic function, based on hp300/dev/diofb_mono.c.

This also fixes `screen is not updated when delete a character if it
is on the middle of a 32-bit word of the frame buffer' problem.

"Go for it!" miod@@
@
text
@d1 1
a1 1
#	$OpenBSD: files.luna88k,v 1.18 2013/09/24 20:10:44 miod Exp $
d72 4
@


1.18
log
@Sync the MI LANCE code ( le(4) ) with NetBSD, except for the following:
- the am7990_get() - now lance_get() - is unchanged.
- the interrupt acknowledge logic is unchanged, and will disable interrupts,
  then acknowledge all interrupt conditions.

Add ILACC (79900) support (from NetBSD).

Both LANCE (am7990.c) and ILACC (am79900.c) code share as much common code
(lance.c) as possible. This affects all le(4) attachments, but the changes
are mostly mechanical, to split am7990-specific parts from lance-agnostic
parts.

Compile tested on all affected platforms. Tested on alpha, hp300, luna88k,
mvme88k, sparc, sparc64 and vax.
@
text
@d1 1
a1 1
#	$OpenBSD: files.luna88k,v 1.17 2013/05/22 11:35:02 aoyama Exp $
d42 1
@


1.17
log
@Split keyboard mapping definitions to new files, luna88k/dev/omkbdmap.[ch].
Also modify RAWKEY_XXX values, to input the right characters on Japanese
keyboard.

ok miod@@
@
text
@d1 1
a1 1
#	$OpenBSD: files.luna88k,v 1.16 2010/12/31 21:38:08 miod Exp $
d17 1
a17 1
attach le at mainbus
@


1.16
log
@Massive overhauling of the m88k pmap, though I can't pretend it's a new pmap
since a large part of the structures and logic remains.

Since m88k has separate supervisor/user spaces, we can map physical memory 1:1
in supervisor space, and have the kernel virtual address space start from the
end of physical memory.

This allows us to switch to __HAVE_PMAP_DIRECT. And to get rid of the double
mapped sdt, since now their virtual and physical addresses will always match.

The upper bound of the kernel virtual memory space is now platform dependent,
until the code which relies upon some hardware devices being mapped 1:1 in
supervisor mode is updated to no longer require this (this is mainly a PITA on
luna88k, where onboard devices start at 0x40000000, leaving only 1GB of KVA at
the moment - still much better than the previous 512MB).

Tested on mvme88k only (187, 188, 197LE, 197DP). Other platforms ought to
work, aviion will be checked shortly and fixed if necessary. No known
OpenBSD/luna88k system in working condition at the moment.
@
text
@d1 1
a1 1
#	$OpenBSD: files.luna88k,v 1.15 2010/12/06 20:10:18 jasper Exp $
d36 1
@


1.15
log
@- use consistent 'include' rules without a full relative path.
tested on a GENERIC config from all arches.

ok deraadt@@ miod@@
@
text
@d1 1
a1 1
#	$OpenBSD: files.luna88k,v 1.14 2007/02/09 14:26:09 aoyama Exp $
a80 1
file	arch/luna88k/luna88k/mem.c
@


1.14
log
@LCD device driver, second step.  Now the driver works with autoconf.

ok miod@@
@
text
@d1 1
a1 1
#	$OpenBSD: files.luna88k,v 1.13 2006/08/06 13:04:31 miod Exp $
d51 1
a51 1
include "../../../scsi/files.scsi"
@


1.13
log
@Switch luna88k from rcons to rasops. Tested by aoyama@@
@
text
@d1 1
a1 1
#	$OpenBSD: files.luna88k,v 1.12 2006/06/19 15:13:35 deraadt Exp $
d13 4
a82 1
file	arch/luna88k/dev/lcd.c
@


1.12
log
@move clock_subr.c to a better place, and now it is always in the kernel
so that things can use it; tested on all architectures; ok kettenis
@
text
@d1 2
a2 2
#	$OpenBSD: files.luna88k,v 1.11 2005/10/24 19:28:25 miod Exp $
#	
d33 1
a33 1
device fb: wsemuldisplaydev,wsrasteremulops
@


1.11
log
@Factorize db_interface code between luna88k and mvme88k, removing dead code
in the process; the arch-agnostic code keeps the ability for a specific
machine to define its own machine commands, such as "machine prom" for
mvme88k, in addition to the ``regular'' m88k machine commands.
@
text
@d1 1
a1 1
#	$OpenBSD: files.luna88k,v 1.10 2005/05/01 21:36:56 brad Exp $
a67 2
file	dev/clock_subr.c

@


1.10
log
@To allow for MD override of in4_cksum()...

ok deraadt@@
@
text
@d1 1
a1 1
#	$OpenBSD: files.luna88k,v 1.9 2005/03/08 20:00:23 tdeval Exp $
a80 1
file	arch/luna88k/ddb/db_interface.c			ddb
@


1.9
log
@Cosmetics...
Mainly remove space between locators parens, replace spaces with tabs
where appropriate and consistently align dependencies.
@
text
@d1 1
a1 1
#	$OpenBSD: files.luna88k,v 1.8 2004/10/08 13:04:36 grange Exp $
a68 3

file	netinet/in_cksum.c
file	netns/ns_cksum.c				ns
@


1.8
log
@Move dev/cons.c to MI conf/files.

ok miod@@
@
text
@d1 1
a1 1
#	$OpenBSD: files.luna88k,v 1.7 2004/10/03 19:47:23 miod Exp $
d16 1
a16 1
device sio { [channel = -1] }
d49 5
a53 5
major { sd = 4 }
major { st = 5 }
major { cd = 6 }
major { rd = 7 }
major { vnd = 8 }
d64 1
a64 1
#file arch/luna88k/dev/nec86hw.c				pcm needs-flag
@


1.7
log
@Merge locore_c_routines.c into machdep.c, and clear <machine/locore.h> as
done on mvme88k. <machine/locore.h> is about to die very soon...
@
text
@d1 1
a1 1
#	$OpenBSD: files.luna88k,v 1.6 2004/07/25 11:06:39 miod Exp $
a67 1
file	dev/cons.c
@


1.6
log
@Merge luna88k and mvme88k pmap. The pmap will now assume that the memory
below the kernel text is reserved for the PROM, instead of using fixed
(but different) values between luna88k and mvme88k.

Tested on mvme88k by myself, on luna88k by aoyama@@
@
text
@d1 1
a1 1
#	$OpenBSD: files.luna88k,v 1.5 2004/07/23 15:34:02 miod Exp $
a81 1
file	arch/luna88k/luna88k/locore_c_routines.c
@


1.5
log
@Move luna88k and mvme88k vm_machdep to m88k-agnostic code area.
@
text
@d1 1
a1 1
#	$OpenBSD: files.luna88k,v 1.4 2004/06/19 18:28:33 miod Exp $
a84 1
file	arch/luna88k/luna88k/pmap.c
@


1.4
log
@Share common ddb files accross m88k platforms.
@
text
@d1 1
a1 1
#	$OpenBSD: files.luna88k,v 1.3 2004/05/07 15:08:25 aoyama Exp $
a86 1
file	arch/luna88k/luna88k/vm_machdep.c
@


1.3
log
@Add new file <machine/conf.h> and clean up console code and structures.
From miod@@
@
text
@d1 1
a1 1
#	$OpenBSD: files.luna88k,v 1.2 2004/04/29 14:33:24 miod Exp $
a87 1
file	arch/luna88k/ddb/db_disasm.c			ddb
a88 2
file	arch/luna88k/ddb/db_sstep.c			ddb
file	arch/luna88k/ddb/db_trace.c			ddb
@


1.3.2.1
log
@Merge with the trunk
@
text
@d1 1
a1 1
#	$OpenBSD$
@


1.2
log
@Continue factorizing m88k common code, this time files in <arch>/<arch>
which were copied verbatim from mvme88k to luna88k.

This requires backing out syntactic sugar in mvme88k kernel configuration
files which would deduct the required processor types from the board models,
as the common code only depends upon the M88100 and M88110 defines.
@
text
@d1 1
a1 1
#	$OpenBSD: files.luna88k,v 1.1.1.1 2004/04/21 15:23:47 aoyama Exp $
a68 1
file	dev/cninit.c
a79 1
#file	arch/luna88k/luna88k/dkbad.c
@


1.1
log
@Initial revision
@
text
@d1 1
a1 1
#	$OpenBSD: files.mvme88k,v 1.19 2001/12/22 09:49:38 smurph Exp $
a78 1
file	arch/luna88k/luna88k/cmmu.c
a83 1
file	arch/luna88k/luna88k/locore_asm_routines.S
a84 1
file	arch/luna88k/luna88k/m88100_fp.S
a88 4
file	arch/luna88k/luna88k/process.S
file	arch/luna88k/luna88k/process_machdep.c
file	arch/luna88k/luna88k/trap.c
file	arch/luna88k/luna88k/vectors_88100.S
@


1.1.1.1
log
@Initial commit for OpenBSD/luna88k, based on OpenBSD/mvme88k, NetBSD/luna68k and CMU Mach.
@
text
@@
