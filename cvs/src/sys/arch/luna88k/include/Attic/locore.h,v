head	1.9;
access;
symbols
	OPENBSD_3_9:1.7.0.2
	OPENBSD_3_9_BASE:1.7
	OPENBSD_3_8:1.5.0.2
	OPENBSD_3_8_BASE:1.5
	OPENBSD_3_7:1.4.0.2
	OPENBSD_3_7_BASE:1.4
	OPENBSD_3_6:1.3.0.2
	OPENBSD_3_6_BASE:1.3
	SMP_SYNC_A:1.1
	SMP_SYNC_B:1.1
	SMP:1.1.0.2
	LUNA88K_INIT:1.1.1.1
	AOYAMA:1.1.1;
locks; strict;
comment	@ * @;


1.9
date	2006.05.08.14.36.09;	author miod;	state dead;
branches;
next	1.8;

1.8
date	2006.05.08.14.03.34;	author miod;	state Exp;
branches;
next	1.7;

1.7
date	2005.12.03.16.52.14;	author miod;	state Exp;
branches;
next	1.6;

1.6
date	2005.12.03.14.30.02;	author miod;	state Exp;
branches;
next	1.5;

1.5
date	2005.04.27.14.09.45;	author miod;	state Exp;
branches;
next	1.4;

1.4
date	2004.10.03.19.47.25;	author miod;	state Exp;
branches;
next	1.3;

1.3
date	2004.08.01.17.18.02;	author miod;	state Exp;
branches;
next	1.2;

1.2
date	2004.07.28.12.28.48;	author miod;	state Exp;
branches;
next	1.1;

1.1
date	2004.04.21.15.23.57;	author aoyama;	state Exp;
branches
	1.1.1.1
	1.1.2.1;
next	;

1.1.1.1
date	2004.04.21.15.23.57;	author aoyama;	state Exp;
branches;
next	;

1.1.2.1
date	2004.06.05.23.09.46;	author niklas;	state Exp;
branches;
next	;


desc
@@


1.9
log
@Replace gazillions of badvaddr() or badwordaddr() calls with badaddr() calls.
With a few prototype declarations shuffling, this finally allows
<machine/locore.h> to die.
@
text
@/*	$OpenBSD: locore.h,v 1.8 2006/05/08 14:03:34 miod Exp $	*/

#ifndef _MACHINE_LOCORE_H_
#define _MACHINE_LOCORE_H_

/*
 * C prototypes for various routines defined in locore_* and friends
 */

/* subr.S */

int badaddr(vaddr_t addr, int size);
#define badwordaddr(x) badaddr(x, 4)
void doboot(void);

/* machdep.c */

unsigned getipl(void);
void set_cpu_number(cpuid_t);

/* eh.S */

void sigsys(void);
void stepbpt(void);
void userbpt(void);
void syscall_handler(void);
void cache_flush_handler(void);

#endif /* _MACHINE_LOCORE_H_ */
@


1.8
log
@Clean the internal m88k trap type codes; while there, simplify and
factorize the build of the VBR page betweem luna88k and mvme88k.

Tested by aoyama@@ and I.
@
text
@d1 1
a1 1
/*	$OpenBSD: locore.h,v 1.7 2005/12/03 16:52:14 miod Exp $	*/
@


1.7
log
@Turn read_processor_identification_register() into a simple macro with a
much, much, much shorter name. It is only used to print cpu revision anyway...
@
text
@d1 1
a1 1
/*	$OpenBSD: locore.h,v 1.6 2005/12/03 14:30:02 miod Exp $	*/
a23 1
void sigtrap(void);
@


1.6
log
@Switch m88k ports to __HAVE_CPUINFO. Current cpu pointer is held in SR0
on all running processors.
Tested aoyama@@ and I
@
text
@d1 1
a1 1
/*	$OpenBSD: locore.h,v 1.5 2005/04/27 14:09:45 miod Exp $	*/
a11 1
unsigned read_processor_identification_register(void);
@


1.5
log
@Allow userland to cause the data cache to be flushed for any arbitrary address
range in the current process, using trap #451.

This is necessary for proper gcc trampolines operation, and, later, ld.so...
@
text
@d1 1
a1 1
/*	$OpenBSD: locore.h,v 1.4 2004/10/03 19:47:25 miod Exp $	*/
a14 1
void set_cpu_number(unsigned number);
d17 1
a17 1
/* locore_c_routines.c */
d20 1
@


1.4
log
@Merge locore_c_routines.c into machdep.c, and clear <machine/locore.h> as
done on mvme88k. <machine/locore.h> is about to die very soon...
@
text
@d1 1
a1 1
/*	$OpenBSD: locore.h,v 1.3 2004/08/01 17:18:02 miod Exp $	*/
d29 1
@


1.3
log
@Move 88100 DAE code to its own file, shared between luna88k and mvme88k.
@
text
@d1 1
a1 1
/*	$OpenBSD: locore.h,v 1.2 2004/07/28 12:28:48 miod Exp $	*/
a5 2
#include <uvm/uvm_param.h>

a17 3
int guarded_access(unsigned char *volatile address,
    unsigned len, u_char *vec);

a21 14
/* machdep.c */

void _doboot(void);
vaddr_t get_slave_stack(void);
void slave_pre_main(void);
int slave_main(void);
int intr_findvec(int start, int end);
void bugsyscall(void);
void myetheraddr(u_char *cp);
void dosoftint(void);
void luna88k_bootstrap(void);
void luna88k_ext_int(u_int v, struct trapframe *eframe);
unsigned int safe_level(unsigned mask, unsigned curlevel);

a23 2
struct proc;
void proc_do_uret(struct proc *);
a28 9
void m88110_sigsys(void);
void m88110_sigtrap(void);
void m88110_stepbpt(void);
void m88110_userbpt(void);
void m88110_syscall_handler(void);

/* process.S */
void savectx(struct pcb *);
void switch_exit(struct proc *);
@


1.2
log
@Remove EH_DEBUG code.
@
text
@d1 1
a1 1
/*	$OpenBSD: locore.h,v 1.1 2004/04/21 15:23:57 aoyama Exp $	*/
d12 1
a12 20
/* locore_asm_routines.S */

unsigned int do_load_word(vaddr_t address,
    boolean_t supervisor_mode);
unsigned int do_load_half(vaddr_t address,
    boolean_t supervisor_mode);
unsigned int do_load_byte(vaddr_t address,
    boolean_t supervisor_mode);

void do_store_word(vaddr_t address, unsigned int data,
    boolean_t supervisor_mode);
void do_store_half(vaddr_t address, unsigned int data,
    boolean_t supervisor_mode);
void do_store_byte(vaddr_t address, unsigned int data,
    boolean_t supervisor_mode);

unsigned do_xmem_word(vaddr_t address, unsigned int data,
    boolean_t supervisor_mode);
unsigned do_xmem_byte(vaddr_t address, unsigned int data,
    boolean_t supervisor_mode);
a23 3

void dae_print(unsigned *eframe);
void data_access_emulation(unsigned *eframe);
@


1.1
log
@Initial revision
@
text
@d1 1
a1 1
/*	$OpenBSD: locore.h,v 1.21 2004/01/23 17:26:05 miod Exp $	*/
a58 2
void MY_info(struct trapframe *f, caddr_t p, int flags, char *s);
void MY_info_done(struct trapframe *f, int flags);
@


1.1.2.1
log
@Merge with the trunk
@
text
@d1 1
a1 1
/*	$OpenBSD$	*/
@


1.1.1.1
log
@Initial commit for OpenBSD/luna88k, based on OpenBSD/mvme88k, NetBSD/luna68k and CMU Mach.
@
text
@@
