head	1.32;
access;
symbols
	OPENBSD_5_5:1.31.0.6
	OPENBSD_5_5_BASE:1.31
	OPENBSD_5_4:1.31.0.2
	OPENBSD_5_4_BASE:1.31
	OPENBSD_5_3:1.27.0.2
	OPENBSD_5_3_BASE:1.27
	OPENBSD_5_2:1.26.0.4
	OPENBSD_5_2_BASE:1.26
	OPENBSD_5_1_BASE:1.26
	OPENBSD_5_1:1.26.0.2
	OPENBSD_5_0:1.25.0.2
	OPENBSD_5_0_BASE:1.25
	OPENBSD_4_9:1.24.0.4
	OPENBSD_4_9_BASE:1.24
	OPENBSD_4_8:1.24.0.2
	OPENBSD_4_8_BASE:1.24
	OPENBSD_4_7:1.23.0.8
	OPENBSD_4_7_BASE:1.23
	OPENBSD_4_6:1.23.0.10
	OPENBSD_4_6_BASE:1.23
	OPENBSD_4_5:1.23.0.6
	OPENBSD_4_5_BASE:1.23
	OPENBSD_4_4:1.23.0.4
	OPENBSD_4_4_BASE:1.23
	OPENBSD_4_3:1.23.0.2
	OPENBSD_4_3_BASE:1.23
	OPENBSD_4_2:1.22.0.2
	OPENBSD_4_2_BASE:1.22
	OPENBSD_4_1:1.20.0.4
	OPENBSD_4_1_BASE:1.20
	OPENBSD_4_0:1.20.0.2
	OPENBSD_4_0_BASE:1.20
	OPENBSD_3_9:1.17.0.2
	OPENBSD_3_9_BASE:1.17
	OPENBSD_3_8:1.11.0.2
	OPENBSD_3_8_BASE:1.11
	OPENBSD_3_7:1.10.0.4
	OPENBSD_3_7_BASE:1.10
	OPENBSD_3_6:1.10.0.2
	OPENBSD_3_6_BASE:1.10
	SMP_SYNC_A:1.9
	SMP_SYNC_B:1.9
	OPENBSD_3_5:1.8.0.4
	OPENBSD_3_5_BASE:1.8
	OPENBSD_3_4:1.8.0.2
	OPENBSD_3_4_BASE:1.8
	UBC_SYNC_A:1.7
	OPENBSD_3_3:1.7.0.6
	OPENBSD_3_3_BASE:1.7
	OPENBSD_3_2:1.7.0.4
	OPENBSD_3_2_BASE:1.7
	OPENBSD_3_1:1.7.0.2
	OPENBSD_3_1_BASE:1.7
	UBC_SYNC_B:1.7
	UBC:1.5.0.2
	UBC_BASE:1.5
	OPENBSD_3_0:1.4.0.2
	OPENBSD_3_0_BASE:1.4
	OPENBSD_2_9:1.2.0.18
	OPENBSD_2_9_BASE:1.2
	OPENBSD_2_8:1.2.0.16
	OPENBSD_2_8_BASE:1.2
	OPENBSD_2_7:1.2.0.14
	OPENBSD_2_7_BASE:1.2
	SMP:1.2.0.12
	SMP_BASE:1.2
	kame_19991208:1.2
	OPENBSD_2_6:1.2.0.10
	OPENBSD_2_6_BASE:1.2
	OPENBSD_2_5:1.2.0.8
	OPENBSD_2_5_BASE:1.2
	OPENBSD_2_4:1.2.0.6
	OPENBSD_2_4_BASE:1.2
	OPENBSD_2_3:1.2.0.4
	OPENBSD_2_3_BASE:1.2
	OPENBSD_2_2:1.2.0.2
	OPENBSD_2_2_BASE:1.2;
locks; strict;
comment	@ * @;


1.32
date	2014.03.18.22.36.34;	author miod;	state dead;
branches;
next	1.31;

1.31
date	2013.03.26.05.04.10;	author deraadt;	state Exp;
branches;
next	1.30;

1.30
date	2013.03.25.18.17.22;	author miod;	state Exp;
branches;
next	1.29;

1.29
date	2013.03.25.17.46.24;	author deraadt;	state Exp;
branches;
next	1.28;

1.28
date	2013.03.23.16.12.24;	author deraadt;	state Exp;
branches;
next	1.27;

1.27
date	2013.01.01.01.02.19;	author miod;	state Exp;
branches;
next	1.26;

1.26
date	2011.09.08.03.40.32;	author guenther;	state Exp;
branches;
next	1.25;

1.25
date	2011.04.07.15.45.17;	author miod;	state Exp;
branches;
next	1.24;

1.24
date	2010.06.29.20.30.32;	author guenther;	state Exp;
branches;
next	1.23;

1.23
date	2007.11.02.19.18.54;	author martin;	state Exp;
branches;
next	1.22;

1.22
date	2007.05.28.21.02.49;	author thib;	state Exp;
branches;
next	1.21;

1.21
date	2007.05.15.13.46.22;	author martin;	state Exp;
branches;
next	1.20;

1.20
date	2006.06.12.17.58.24;	author miod;	state Exp;
branches;
next	1.19;

1.19
date	2006.06.11.20.48.13;	author miod;	state Exp;
branches;
next	1.18;

1.18
date	2006.03.19.01.47.24;	author martin;	state Exp;
branches;
next	1.17;

1.17
date	2005.12.13.01.56.43;	author martin;	state Exp;
branches;
next	1.16;

1.16
date	2005.11.12.23.14.03;	author miod;	state Exp;
branches;
next	1.15;

1.15
date	2005.10.23.19.00.25;	author martin;	state Exp;
branches;
next	1.14;

1.14
date	2005.09.15.18.52.43;	author martin;	state Exp;
branches;
next	1.13;

1.13
date	2005.09.12.23.05.05;	author miod;	state Exp;
branches;
next	1.12;

1.12
date	2005.09.12.09.59.51;	author martin;	state Exp;
branches;
next	1.11;

1.11
date	2005.07.31.15.31.14;	author miod;	state Exp;
branches;
next	1.10;

1.10
date	2004.08.06.22.31.31;	author mickey;	state Exp;
branches;
next	1.9;

1.9
date	2004.04.19.23.29.03;	author deraadt;	state Exp;
branches;
next	1.8;

1.8
date	2003.06.02.23.27.48;	author millert;	state Exp;
branches;
next	1.7;

1.7
date	2002.01.10.21.08.41;	author miod;	state Exp;
branches;
next	1.6;

1.6
date	2001.12.20.19.02.28;	author miod;	state Exp;
branches;
next	1.5;

1.5
date	2001.11.30.20.57.52;	author miod;	state Exp;
branches
	1.5.2.1;
next	1.4;

1.4
date	2001.07.06.02.07.42;	author provos;	state Exp;
branches;
next	1.3;

1.3
date	2001.05.05.20.56.40;	author art;	state Exp;
branches;
next	1.2;

1.2
date	97.09.17.17.45.20;	author downsj;	state Exp;
branches
	1.2.12.1;
next	1.1;

1.1
date	97.07.06.07.46.26;	author downsj;	state Exp;
branches;
next	;

1.2.12.1
date	2001.07.04.10.18.15;	author niklas;	state Exp;
branches;
next	1.2.12.2;

1.2.12.2
date	2001.10.31.03.01.14;	author nate;	state Exp;
branches;
next	1.2.12.3;

1.2.12.3
date	2001.12.05.00.39.11;	author niklas;	state Exp;
branches;
next	1.2.12.4;

1.2.12.4
date	2003.06.07.11.11.38;	author ho;	state Exp;
branches;
next	1.2.12.5;

1.2.12.5
date	2004.06.05.23.10.50;	author niklas;	state Exp;
branches;
next	;

1.5.2.1
date	2002.01.31.22.55.13;	author niklas;	state Exp;
branches;
next	;


desc
@@


1.32
log
@Retire hp300, mvme68k and mvme88k ports. These ports have no users, keeping
this hardware alive is becoming increasingly difficult, and I should heed the
message sent by the three disks which have died on me over the last few days.

Noone sane will mourn these ports anyway. So long, and thanks for the fish.
@
text
@/*	$OpenBSD: param.h,v 1.31 2013/03/26 05:04:10 deraadt Exp $	*/

/*
 * Copyright (c) 1988 University of Utah.
 * Copyright (c) 1982, 1986, 1990 The Regents of the University of California.
 * All rights reserved.
 *
 * This code is derived from software contributed to Berkeley by
 * the Systems Programming Group of the University of Utah Computer
 * Science Department.
 *
 * Redistribution and use in source and binary forms, with or without
 * modification, are permitted provided that the following conditions
 * are met:
 * 1. Redistributions of source code must retain the above copyright
 *    notice, this list of conditions and the following disclaimer.
 * 2. Redistributions in binary form must reproduce the above copyright
 *    notice, this list of conditions and the following disclaimer in the
 *    documentation and/or other materials provided with the distribution.
 * 3. Neither the name of the University nor the names of its contributors
 *    may be used to endorse or promote products derived from this software
 *    without specific prior written permission.
 *
 * THIS SOFTWARE IS PROVIDED BY THE REGENTS AND CONTRIBUTORS ``AS IS'' AND
 * ANY EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT LIMITED TO, THE
 * IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE
 * ARE DISCLAIMED.  IN NO EVENT SHALL THE REGENTS OR CONTRIBUTORS BE LIABLE
 * FOR ANY DIRECT, INDIRECT, INCIDENTAL, SPECIAL, EXEMPLARY, OR CONSEQUENTIAL
 * DAMAGES (INCLUDING, BUT NOT LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS
 * OR SERVICES; LOSS OF USE, DATA, OR PROFITS; OR BUSINESS INTERRUPTION)
 * HOWEVER CAUSED AND ON ANY THEORY OF LIABILITY, WHETHER IN CONTRACT, STRICT
 * LIABILITY, OR TORT (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY
 * OUT OF THE USE OF THIS SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF
 * SUCH DAMAGE.
 */

#ifndef	_M68K_PARAM_H_
#define	_M68K_PARAM_H_

#define	_MACHINE_ARCH	m68k
#define	MACHINE_ARCH	"m68k"
#define	MID_MACHINE	MID_M68K

#define	PAGE_SIZE	(1 << PAGE_SHIFT)
#define	PAGE_MASK	(PAGE_SIZE - 1)

#ifdef _KERNEL

#define	NPTEPG		(PAGE_SIZE / (sizeof(pt_entry_t)))

#define	BTOPKERNBASE	((u_long)KERNBASE >> PAGE_SHIFT)

#define	NBPG		PAGE_SIZE
#define	PGSHIFT		PAGE_SHIFT
#define	PGOFSET		PAGE_MASK

#define	UPAGES		2			/* pages of u-area */
#define	USPACE		(UPAGES * PAGE_SIZE)	/* total size of u-area */
#define	USPACE_ALIGN	0			/* u-area alignment 0-none */

#define	NMBCLUSTERS	4096		/* map size, max cluster allocation */

/*
 * Maximum size of the kernel malloc arena in PAGE_SIZE-sized
 * logical pages.
 */
#define	NKMEMPAGES_MAX_DEFAULT	((64 * 1024 * 1024) >> PAGE_SHIFT)

#include <machine/cpu.h>

#endif /* _KERNEL */

#endif /* _M68K_PARAM_H_ */
@


1.31
log
@PGSHIFT and PGOFSET are now contained inside the kernel namespace.
@
text
@d1 1
a1 1
/*	$OpenBSD: param.h,v 1.30 2013/03/25 18:17:22 miod Exp $	*/
@


1.30
log
@Move SEGSHIFT-related definitions and macros to <m68k/pte_motorola.h>, as they
only matter to pmap-related code. Fixes libkvm build on m68k.
@
text
@d1 1
a1 1
/*	$OpenBSD: param.h,v 1.29 2013/03/25 17:46:24 deraadt Exp $	*/
a45 2
#define	PGSHIFT		PAGE_SHIFT
#define	PGOFSET		PAGE_MASK
d54 2
@


1.29
log
@ALIGNBYTES/ALIGN/ALIGNED_POINTER can move to the MI file.
@
text
@d1 1
a1 1
/*	$OpenBSD: param.h,v 1.28 2013/03/23 16:12:24 deraadt Exp $	*/
a56 16
#define	SEGSHIFT020	(34 - PAGE_SHIFT)
#define	SEGSHIFT040	(18)
#ifndef	SEGSHIFT
#if defined(M68040) || defined(M68060)
#if defined(M68020) || defined(M68030)
#define	SEGSHIFT	((mmutype <= MMU_68040) ? SEGSHIFT040 : SEGSHIFT020)
#else
#define	SEGSHIFT	SEGSHIFT040
#endif
#else
#define	SEGSHIFT	SEGSHIFT020
#endif
#define	NBSEG		(1 << SEGSHIFT)
#define	SEGOFSET	(NBSEG - 1)
#endif

a67 7

/*
 * Mach derived conversion macros
 */
#define	m68k_round_seg(x)	((((unsigned)(x)) + SEGOFSET) & ~SEGOFSET)
#define	m68k_trunc_seg(x)	((unsigned)(x) & ~SEGOFSET)
#define	m68k_page_offset(x)	((unsigned)(x) & PGOFSET)
@


1.28
log
@refactor sys/param.h and machine/param.h.  A lot of #ifdef _KERNEL is added
to keep definitions our of user space.  The MD files now follow a consistant
order -- all namespace intrusion is at the tail can be cleaned up
independently.  locore, bootblocks, and libkvm still see enough visibility to
build.  Checked on 90% of platforms...
@
text
@d1 1
a1 1
/*	$OpenBSD: param.h,v 1.27 2013/01/01 01:02:19 miod Exp $	*/
a42 4

#define	ALIGNBYTES		_ALIGNBYTES
#define	ALIGN(p)		_ALIGN(p)
#define	ALIGNED_POINTER(p,t)	_ALIGNED_POINTER(p,t)
@


1.27
log
@Crank NMBCLUSTERS to 4096 to match other 32-bit platforms.
@
text
@d1 1
a1 2
/*	$OpenBSD: param.h,v 1.26 2011/09/08 03:40:32 guenther Exp $	*/
/*	$NetBSD: param.h,v 1.2 1997/06/10 18:21:23 veego Exp $	*/
a34 4
 *
 * from: Utah $Hdr: machparam.h 1.16 92/12/20$
 *
 *	@@(#)param.h	8.1 (Berkeley) 6/10/93
a35 2
#ifndef _M68K_PARAM_H_
#define _M68K_PARAM_H_
d37 3
a39 3
/*
 * Machine independent constants for m68k
 */
d50 2
d53 1
a53 3
#define	PGSHIFT		PAGE_SHIFT
#define	NBPG		(1 << PGSHIFT)	/* bytes/page */
#define	PGOFSET		(NBPG-1)	/* byte offset into page */
d59 1
a59 4
#define	DEV_BSHIFT	9		/* log2(DEV_BSIZE) */
#define	DEV_BSIZE	(1 << DEV_BSHIFT)
#define BLKDEV_IOSIZE	2048
#define	MAXPHYS		(64 * 1024)	/* max raw I/O transfer size */
d77 5
a81 6
/* mac68k use 3 pages of u-area */
#ifndef	UPAGES
#define UPAGES		2		/* pages of u-area */
#endif
#define	USPACE		(UPAGES * PAGE_SIZE)
#define	USPACE_ALIGN	(0)		/* u-area alignment 0-none */
d84 1
a84 1
 * Minimum and maximum sizes of the kernel malloc arena in PAGE_SIZE-sized
a86 1
#define	NKMEMPAGES_MIN_DEFAULT	((4 * 1024 * 1024) >> PAGE_SHIFT)
a89 13
 * Constants related to network buffer management.
 */
#define	NMBCLUSTERS	4096		/* map size, max cluster allocation */

/* pages ("clicks") to disk blocks */
#define	ctod(x)		((x) << (PAGE_SHIFT - DEV_BSHIFT))
#define	dtoc(x)		((x) >> (PAGE_SHIFT - DEV_BSHIFT))

/* bytes to disk blocks */
#define	btodb(x)	((x) >> DEV_BSHIFT)
#define	dbtob(x)	((x) << DEV_BSHIFT)

/*
d98 3
a100 1
#endif	/* !_M68K_PARAM_H_ */
@


1.26
log
@Provide namespace-safe alignment macros in <machine/_types.h>, with
compat names kept in <machine/param.h>.  In <sys/socket.h>, pull
in <sys/_types.h> instead of the namespace polluting <machine/param.h>
and completely eliminate __CMSG_ALIGN, replaced by _ALIGN

ok deraadt@@
@
text
@d1 1
a1 1
/*	$OpenBSD: param.h,v 1.25 2011/04/07 15:45:17 miod Exp $	*/
d104 1
a104 1
#define	NMBCLUSTERS	1024		/* map size, max cluster allocation */
@


1.25
log
@Make sure the ALIGN() macro uses u_long on all platforms for consistency, and
update the comment block accordingly.
@
text
@d1 1
a1 1
/*	$OpenBSD: param.h,v 1.24 2010/06/29 20:30:32 guenther Exp $	*/
d51 3
a53 14
/*
 * Round p (pointer or byte index) up to a correctly-aligned value for all
 * data types (int, long, ...).   The result is u_long and must be cast to
 * any desired pointer type.
 *
 * ALIGNED_POINTER is a boolean macro that checks whether an address
 * is valid to fetch data elements of type t from on this architecture.
 * This does not reflect the optimal alignment, just the possibility
 * (within reasonable limits). 
 *
 */
#define ALIGNBYTES		(sizeof(int) - 1)
#define	ALIGN(p)		(((u_long)(p) + ALIGNBYTES) &~ ALIGNBYTES)
#define ALIGNED_POINTER(p,t)	((((u_long)(p)) & (sizeof(t) - 1)) == 0)
@


1.24
log
@Remove COMPAT_HPUX.  No one wanted to support it and its fewmets were
blocking other cleanups
ok miod@@
@
text
@d1 1
a1 1
/*	$OpenBSD: param.h,v 1.23 2007/11/02 19:18:54 martin Exp $	*/
d53 1
a53 1
 * data types (int, long, ...).   The result is u_int and must be cast to
d63 1
a63 1
#define	ALIGN(p)		(((u_int)(p) + ALIGNBYTES) &~ ALIGNBYTES)
@


1.23
log
@replace ctob/btoc with ptoa/atop (plus the usual round_page() where needed)
@
text
@d1 1
a1 1
/*	$OpenBSD: param.h,v 1.22 2007/05/28 21:02:49 thib Exp $	*/
a130 14

#ifdef COMPAT_HPUX
/*
 * Constants/macros for HPUX multiple mapping of user address space.
 * Pages in the first 256Mb are mapped in at every 256Mb segment.
 */
#define HPMMMASK	0xF0000000
#define ISHPMMADDR(p, v) \
	(((p)->p_md.md_flags & MDP_HPUXMMAP) && \
	 ((unsigned)(v) & HPMMMASK) && \
	 ((unsigned)(v) & HPMMMASK) != HPMMMASK)
#define HPMMBASEADDR(v) \
	((unsigned)(v) & ~HPMMMASK)
#endif	/* COMPAT_HPUX */
@


1.22
log
@Move the MSIZE, MCLSHIFT, MCLBYTES and the MCLOFSET
mbuf constants from MD param.h to MI param.h.
Besides being the same on every arch, things will
most probly break if any arch has different values
then the others.

The NMBCLUSTERS constants needs to be MD though;

ok miod@@,krw@@,claudio@@
@
text
@d1 1
a1 1
/*	$OpenBSD: param.h,v 1.21 2007/05/15 13:46:22 martin Exp $	*/
a119 4

/* pages to bytes */
#define	ctob(x)		((x) << PAGE_SHIFT)
#define	btoc(x)		(((x) + PAGE_MASK) >> PAGE_SHIFT)
@


1.21
log
@switch m68k to __HAVE_CPUINFO

help miod@@, art@@
ok deraadt@@
@
text
@d1 1
a1 1
/*	$OpenBSD: param.h,v 1.20 2006/06/12 17:58:24 miod Exp $	*/
a113 4
 * MCLBYTES must be no larger than CLBYTES (the software page size), and,
 * on machines that exchange pages of input or output buffers with mbuf
 * clusters (MAPPED_MBUFS), MCLBYTES must also be an integral multiple
 * of the hardware page size.
a114 8
#define	MSIZE		256		/* size of an mbuf */

#ifndef	MCLSHIFT
#define	MCLSHIFT	11		/* convert bytes to m_buf clusters */
#endif	/* MCLSHIFT */

#define	MCLBYTES	(1 << MCLSHIFT)
#define	MCLOFSET	(MCLBYTES - 1)
@


1.20
log
@Oops, typo
@
text
@d1 1
a1 1
/*	$OpenBSD: param.h,v 1.18 2006/03/19 01:47:24 martin Exp $	*/
d162 1
a162 1
#include <machine/intr.h>	/* splXXX() */
@


1.19
log
@Move common prototypes to <m68k/{cpu,param}.h> instead of incomplete
declarations in <machine/{cpu,param}.h> and elsewhere.
@
text
@d92 1
a92 1
#define	SEGSHIFT	SEGSHOFT020
@


1.18
log
@remove unused bdbtofsb(bn) macro

found by drahn@@
@
text
@d1 1
a1 1
/*	$OpenBSD: param.h,v 1.17 2005/12/13 01:56:43 martin Exp $	*/
d64 1
a64 1
#define ALIGNED_POINTER(p,t)	((((u_long)(p)) & (sizeof(t)-1)) == 0)
d66 4
d72 4
a75 1
#define	NPTEPG		(NBPG/(sizeof (pt_entry_t)))
d82 2
d86 2
a87 1
#define	SEGSHIFT	((mmutype <= MMU_68040) ? 18 : (34 - PGSHIFT))
d89 4
a92 1
#define	SEGSHIFT	(34 - PGSHIFT)
d102 1
a102 1
#define	USPACE		(UPAGES * NBPG)
d130 2
a131 2
#define	ctod(x)		((x) << (PGSHIFT - DEV_BSHIFT))
#define	dtoc(x)		((x) >> (PGSHIFT - DEV_BSHIFT))
d134 2
a135 2
#define	ctob(x)		((x) << PGSHIFT)
#define	btoc(x)		(((x) + PGOFSET) >> PGSHIFT)
d161 2
@


1.17
log
@nuke unused BTOPKERNBASE define

pointed out by miod@@
@
text
@d1 1
a1 1
/*	$OpenBSD: param.h,v 1.16 2005/11/12 23:14:03 miod Exp $	*/
a126 8

/*
 * Map a ``block device block'' to a file system block.
 * This should be device dependent, and should use the bsize
 * field from the disk label.
 * For now though just use DEV_BSIZE.
 */
#define	bdbtofsb(bn)	((bn) / (BLKDEV_IOSIZE/DEV_BSIZE))
@


1.16
log
@Pass a struct proc * to ISHPMMADDR instead of abusing curproc in it.
@
text
@d1 1
a1 1
/*	$OpenBSD: param.h,v 1.15 2005/10/23 19:00:25 martin Exp $	*/
a68 2

#define	BTOPKERNBASE	((u_long)KERNBASE >> PGSHIFT)
@


1.15
log
@m68k_btop() and m68k_ptob() were mostly used by mac68k only and can
be replaced by the MI versions atop() and ptoa()
@
text
@d1 1
a1 1
/*	$OpenBSD: param.h,v 1.14 2005/09/15 18:52:43 martin Exp $	*/
d151 2
a152 2
#define ISHPMMADDR(v) \
	((curproc->p_md.md_flags & MDP_HPUXMMAP) && \
@


1.14
log
@get rid of MD m68k_trunc_page and m68k_round_page and replace by MI
trunc_page and round_page

go go go! miod@@
@
text
@d1 1
a1 1
/*	$OpenBSD: param.h,v 1.13 2005/09/12 23:05:05 miod Exp $	*/
a143 2
#define	m68k_btop(x)		((unsigned)(x) >> PGSHIFT)
#define	m68k_ptob(x)		((unsigned)(x) << PGSHIFT)
@


1.13
log
@Change the NKMEMPAGES range to 4-64MB for 32bit arches, and 8-128MB for 64bit
arches; except on sparc where the range is 4-8 for !sun4m and 4-64 for sun4m,
selected at runtime.
@
text
@d1 1
a1 1
/*	$OpenBSD: param.h,v 1.12 2005/09/12 09:59:51 martin Exp $	*/
a142 2
#define	m68k_round_page(x)	((((unsigned)(x)) + PGOFSET) & ~PGOFSET)
#define	m68k_trunc_page(x)	((unsigned)(x) & ~PGOFSET)
@


1.12
log
@provide m68k_page_offset()
@
text
@d1 1
a1 1
/*	$OpenBSD: param.h,v 1.11 2005/07/31 15:31:14 miod Exp $	*/
d93 7
@


1.11
log
@Get rid of unused SINCR and SSIZE constants.
@
text
@d1 1
a1 1
/*	$OpenBSD: param.h,v 1.10 2004/08/06 22:31:31 mickey Exp $	*/
d138 1
@


1.10
log
@provide md USPACE_ALIGN zero on all but mips; deradat@@ pefo@@ ok
@
text
@d1 1
a1 1
/*	$OpenBSD: param.h,v 1.9 2004/04/19 23:29:03 deraadt Exp $	*/
a75 3

#define	SSIZE		1		/* initial stack size/NBPG */
#define	SINCR		1		/* increment of stack/NBPG */
@


1.9
log
@remove the GATEWAY junk thingy; at the same time, select a new fat
cluster value that noone will really need to crank.
@
text
@d1 1
a1 1
/*	$OpenBSD: param.h,v 1.8 2003/06/02 23:27:48 millert Exp $	*/
d95 1
@


1.8
log
@Remove the advertising clause in the UCB license which Berkeley
rescinded 22 July 1999.  Proofed by myself and Theo.
@
text
@d1 1
a1 1
/*	$OpenBSD: param.h,v 1.7 2002/01/10 21:08:41 miod Exp $	*/
d111 1
a111 7
#ifndef NMBCLUSTERS
#ifdef GATEWAY
# define	NMBCLUSTERS	1024	/* map size, max cluster allocation */
#else
# define	NMBCLUSTERS	512	/* map size, max cluster allocation */
#endif
#endif
@


1.7
log
@Reintroduce the pmap_motorola framework.
@
text
@d1 1
a1 1
/*	$OpenBSD: param.h,v 1.6 2001/12/20 19:02:28 miod Exp $	*/
d21 1
a21 5
 * 3. All advertising materials mentioning features or use of this software
 *    must display the following acknowledgement:
 *	This product includes software developed by the University of
 *	California, Berkeley and its contributors.
 * 4. Neither the name of the University nor the names of its contributors
@


1.6
log
@Temporarily revert the pmap_motorola changes, as they may account for
some problems as well.
Requested by deraadt@@
@
text
@d1 1
a1 1
/*	$OpenBSD: param.h,v 1.5 2001/11/30 20:57:52 miod Exp $	*/
d84 10
d152 14
@


1.5
log
@Factorize more definitions to enable the use of pmap_motorola.
@
text
@d1 1
a1 1
/*	$OpenBSD: param.h,v 1.4 2001/07/06 02:07:42 provos Exp $	*/
a83 10
#ifndef	SEGSHIFT
#if defined(M68040) || defined(M68060)
#define	SEGSHIFT	((mmutype <= MMU_68040) ? 18 : (34 - PGSHIFT))
#else
#define	SEGSHIFT	(34 - PGSHIFT)
#endif
#define	NBSEG		(1 << SEGSHIFT)
#define	SEGOFSET	(NBSEG - 1)
#endif

a141 14

#ifdef COMPAT_HPUX
/*
 * Constants/macros for HPUX multiple mapping of user address space.
 * Pages in the first 256Mb are mapped in at every 256Mb segment.
 */
#define HPMMMASK	0xF0000000
#define ISHPMMADDR(v) \
	((curproc->p_md.md_flags & MDP_HPUXMMAP) && \
	 ((unsigned)(v) & HPMMMASK) && \
	 ((unsigned)(v) & HPMMMASK) != HPMMMASK)
#define HPMMBASEADDR(v) \
	((unsigned)(v) & ~HPMMMASK)
#endif	/* COMPAT_HPUX */
@


1.5.2.1
log
@Merge in -current, builds on i386, otherwise untested
@
text
@d1 1
a1 1
/*	$OpenBSD: param.h,v 1.7 2002/01/10 21:08:41 miod Exp $	*/
@


1.4
log
@change MSIZE to 256, okay @@deraadt
@
text
@d1 1
a1 1
/*	$OpenBSD: param.h,v 1.3 2001/05/05 20:56:40 art Exp $	*/
d84 11
a94 1
/* mac68k, mvme68k and x68k 3 pages of  u-area */
d96 1
a96 1
# define UPAGES		2		/* pages of u-area */
d110 1
a110 1
# define	MCLSHIFT	11	/* convert bytes to m_buf clusters */
d152 14
@


1.3
log
@Get rid of CLSIZE and all related stuff.
CLSIZE -> 1
CLBYTES -> PAGE_SIZE
OLOFSET -> PAGE_MASK
etc.
At the same time some archs needed some cleaning in vmparam.h so that
goes in at the same time.
@
text
@d1 1
a1 1
/*	$OpenBSD: param.h,v 1.2 1997/09/17 17:45:20 downsj Exp $	*/
d97 1
a97 1
#define	MSIZE		128		/* size of an mbuf */
@


1.2
log
@Double default NMBCLUSTERS settings.
@
text
@d1 1
a1 1
/*	$OpenBSD: param.h,v 1.1 1997/07/06 07:46:26 downsj Exp $	*/
a80 4
#define	CLSIZELOG2	0
#define	CLSIZE		(1 << CLSIZELOG2)

/* NOTE: SSIZE, SINCR and UPAGES must be multiples of CLSIZE */
@


1.2.12.1
log
@Merge in -current from two days ago in the SMP branch.
As usual with merges, they do not indicate progress, so do not hold
your breath for working SMP, and do not mail me and ask about the
state of it.  It has not changed.  There is work ongoing, but very, very
slowly.  The commit is done in parts as to not lock up the tree in too
big chunks at a time.
@
text
@d1 1
a1 1
/*	$OpenBSD: param.h,v 1.2 1997/09/17 17:45:20 downsj Exp $	*/
d81 4
@


1.2.12.2
log
@Sync the SMP branch to something just after 3.0
@
text
@d1 1
a1 1
/*	$OpenBSD: param.h,v 1.2.12.1 2001/07/04 10:18:15 niklas Exp $	*/
d97 1
a97 1
#define	MSIZE		256		/* size of an mbuf */
@


1.2.12.3
log
@Merge in -current
@
text
@d1 1
a1 1
/*	$OpenBSD: param.h,v 1.2.12.2 2001/10/31 03:01:14 nate Exp $	*/
d84 1
a84 11
#ifndef	SEGSHIFT
#if defined(M68040) || defined(M68060)
#define	SEGSHIFT	((mmutype <= MMU_68040) ? 18 : (34 - PGSHIFT))
#else
#define	SEGSHIFT	(34 - PGSHIFT)
#endif
#define	NBSEG		(1 << SEGSHIFT)
#define	SEGOFSET	(NBSEG - 1)
#endif

/* mac68k use 3 pages of u-area */
d86 1
a86 1
#define UPAGES		2		/* pages of u-area */
d100 1
a100 1
#define	MCLSHIFT	11		/* convert bytes to m_buf clusters */
a141 14

#ifdef COMPAT_HPUX
/*
 * Constants/macros for HPUX multiple mapping of user address space.
 * Pages in the first 256Mb are mapped in at every 256Mb segment.
 */
#define HPMMMASK	0xF0000000
#define ISHPMMADDR(v) \
	((curproc->p_md.md_flags & MDP_HPUXMMAP) && \
	 ((unsigned)(v) & HPMMMASK) && \
	 ((unsigned)(v) & HPMMMASK) != HPMMMASK)
#define HPMMBASEADDR(v) \
	((unsigned)(v) & ~HPMMMASK)
#endif	/* COMPAT_HPUX */
@


1.2.12.4
log
@Sync SMP branch to -current
@
text
@d1 1
a1 1
/*	$OpenBSD: param.h,v 1.2.12.3 2001/12/05 00:39:11 niklas Exp $	*/
d21 5
a25 1
 * 3. Neither the name of the University nor the names of its contributors
@


1.2.12.5
log
@Merge with the trunk
@
text
@d1 1
a1 1
/*	$OpenBSD$	*/
d111 7
a117 1
#define	NMBCLUSTERS	1024		/* map size, max cluster allocation */
@


1.1
log
@Sync with NetBSD changes, 970415 - 970705.

This includes a new asm.h, as well as even more code abstracted from hp300.
These changes are likely to break ports that don't know about them; hp300
runs at the moment.
@
text
@d1 1
a1 1
/*	$OpenBSD$	*/
d111 2
a113 2
#else
# define	NMBCLUSTERS	256	/* map size, max cluster allocation */
@
