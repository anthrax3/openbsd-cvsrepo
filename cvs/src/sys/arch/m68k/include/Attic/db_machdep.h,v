head	1.14;
access;
symbols
	OPENBSD_5_5:1.12.0.8
	OPENBSD_5_5_BASE:1.12
	OPENBSD_5_4:1.12.0.4
	OPENBSD_5_4_BASE:1.12
	OPENBSD_5_3:1.12.0.2
	OPENBSD_5_3_BASE:1.12
	OPENBSD_5_2:1.11.0.8
	OPENBSD_5_2_BASE:1.11
	OPENBSD_5_1_BASE:1.11
	OPENBSD_5_1:1.11.0.6
	OPENBSD_5_0:1.11.0.4
	OPENBSD_5_0_BASE:1.11
	OPENBSD_4_9:1.11.0.2
	OPENBSD_4_9_BASE:1.11
	OPENBSD_4_8:1.10.0.20
	OPENBSD_4_8_BASE:1.10
	OPENBSD_4_7:1.10.0.16
	OPENBSD_4_7_BASE:1.10
	OPENBSD_4_6:1.10.0.18
	OPENBSD_4_6_BASE:1.10
	OPENBSD_4_5:1.10.0.14
	OPENBSD_4_5_BASE:1.10
	OPENBSD_4_4:1.10.0.12
	OPENBSD_4_4_BASE:1.10
	OPENBSD_4_3:1.10.0.10
	OPENBSD_4_3_BASE:1.10
	OPENBSD_4_2:1.10.0.8
	OPENBSD_4_2_BASE:1.10
	OPENBSD_4_1:1.10.0.6
	OPENBSD_4_1_BASE:1.10
	OPENBSD_4_0:1.10.0.4
	OPENBSD_4_0_BASE:1.10
	OPENBSD_3_9:1.10.0.2
	OPENBSD_3_9_BASE:1.10
	OPENBSD_3_8:1.9.0.4
	OPENBSD_3_8_BASE:1.9
	OPENBSD_3_7:1.9.0.2
	OPENBSD_3_7_BASE:1.9
	OPENBSD_3_6:1.8.0.12
	OPENBSD_3_6_BASE:1.8
	SMP_SYNC_A:1.8
	SMP_SYNC_B:1.8
	OPENBSD_3_5:1.8.0.10
	OPENBSD_3_5_BASE:1.8
	OPENBSD_3_4:1.8.0.8
	OPENBSD_3_4_BASE:1.8
	UBC_SYNC_A:1.8
	OPENBSD_3_3:1.8.0.6
	OPENBSD_3_3_BASE:1.8
	OPENBSD_3_2:1.8.0.4
	OPENBSD_3_2_BASE:1.8
	OPENBSD_3_1:1.8.0.2
	OPENBSD_3_1_BASE:1.8
	UBC_SYNC_B:1.8
	UBC:1.7.0.2
	UBC_BASE:1.7
	OPENBSD_3_0:1.6.0.2
	OPENBSD_3_0_BASE:1.6
	OPENBSD_2_9:1.5.0.18
	OPENBSD_2_9_BASE:1.5
	OPENBSD_2_8:1.5.0.16
	OPENBSD_2_8_BASE:1.5
	OPENBSD_2_7:1.5.0.14
	OPENBSD_2_7_BASE:1.5
	SMP:1.5.0.12
	SMP_BASE:1.5
	kame_19991208:1.5
	OPENBSD_2_6:1.5.0.10
	OPENBSD_2_6_BASE:1.5
	OPENBSD_2_5:1.5.0.8
	OPENBSD_2_5_BASE:1.5
	OPENBSD_2_4:1.5.0.6
	OPENBSD_2_4_BASE:1.5
	OPENBSD_2_3:1.5.0.4
	OPENBSD_2_3_BASE:1.5
	OPENBSD_2_2:1.5.0.2
	OPENBSD_2_2_BASE:1.5
	OPENBSD_2_1:1.4.0.2
	OPENBSD_2_1_BASE:1.4
	OPENBSD_2_0:1.2.0.2
	OPENBSD_2_0_BASE:1.2
	netbsd_1_1:1.1.1.1;
locks; strict;
comment	@ * @;


1.14
date	2014.03.18.22.36.33;	author miod;	state dead;
branches;
next	1.13;

1.13
date	2014.03.16.20.31.46;	author guenther;	state Exp;
branches;
next	1.12;

1.12
date	2013.02.02.13.32.06;	author miod;	state Exp;
branches;
next	1.11;

1.11
date	2010.11.27.19.57.23;	author miod;	state Exp;
branches;
next	1.10;

1.10
date	2005.11.13.17.50.44;	author fgsch;	state Exp;
branches;
next	1.9;

1.9
date	2005.01.04.21.14.35;	author espie;	state Exp;
branches;
next	1.8;

1.8
date	2002.03.14.01.26.34;	author millert;	state Exp;
branches;
next	1.7;

1.7
date	2001.11.06.00.30.38;	author art;	state Exp;
branches
	1.7.2.1;
next	1.6;

1.6
date	2001.05.15.01.43.14;	author millert;	state Exp;
branches;
next	1.5;

1.5
date	97.07.06.07.46.25;	author downsj;	state Exp;
branches
	1.5.12.1;
next	1.4;

1.4
date	97.03.21.00.36.36;	author niklas;	state Exp;
branches;
next	1.3;

1.3
date	97.01.19.13.53.09;	author niklas;	state Exp;
branches;
next	1.2;

1.2
date	96.05.09.22.25.15;	author niklas;	state Exp;
branches;
next	1.1;

1.1
date	95.10.18.08.50.59;	author deraadt;	state Exp;
branches
	1.1.1.1;
next	;

1.1.1.1
date	95.10.18.08.50.59;	author deraadt;	state Exp;
branches;
next	;

1.5.12.1
date	2001.07.04.10.18.14;	author niklas;	state Exp;
branches;
next	1.5.12.2;

1.5.12.2
date	2001.11.13.21.00.52;	author niklas;	state Exp;
branches;
next	1.5.12.3;

1.5.12.3
date	2002.03.28.10.34.04;	author niklas;	state Exp;
branches;
next	;

1.7.2.1
date	2002.06.11.03.36.06;	author art;	state Exp;
branches;
next	;


desc
@@


1.14
log
@Retire hp300, mvme68k and mvme88k ports. These ports have no users, keeping
this hardware alive is becoming increasingly difficult, and I should heed the
message sent by the three disks which have died on me over the last few days.

Noone sane will mourn these ports anyway. So long, and thanks for the fish.
@
text
@/*	$OpenBSD: db_machdep.h,v 1.13 2014/03/16 20:31:46 guenther Exp $	*/
/*	$NetBSD: db_machdep.h,v 1.20 1997/06/26 01:26:58 thorpej Exp $	*/

/* 
 * Mach Operating System
 * Copyright (c) 1992 Carnegie Mellon University
 * All Rights Reserved.
 * 
 * Permission to use, copy, modify and distribute this software and its
 * documentation is hereby granted, provided that both the copyright
 * notice and this permission notice appear in all copies of the
 * software, derivative works or modified versions, and any portions
 * thereof, and that both notices appear in supporting documentation.
 * 
 * CARNEGIE MELLON ALLOWS FREE USE OF THIS SOFTWARE IN ITS "AS IS"
 * CONDITION.  CARNEGIE MELLON DISCLAIMS ANY LIABILITY OF ANY KIND FOR
 * ANY DAMAGES WHATSOEVER RESULTING FROM THE USE OF THIS SOFTWARE.
 * 
 * Carnegie Mellon requests users of this software to return to
 * 
 *  Software Distribution Coordinator  or  Software.Distribution@@CS.CMU.EDU
 *  School of Computer Science
 *  Carnegie Mellon University
 *  Pittsburgh PA 15213-3890
 * 
 * any improvements or extensions that they make and grant Carnegie Mellon 
 * the rights to redistribute these changes.
 */

/*
 * Machine-dependent defines for new kernel debugger.
 */
#ifndef	_M68K_DB_MACHDEP_H_
#define	_M68K_DB_MACHDEP_H_

#include <sys/types.h>

/*
 * XXX - Would rather not pull in vm headers, but need boolean_t,
 * at least until boolean_t moves to <sys/types.h> or someplace.
 */
#include <uvm/uvm_param.h>

#include <machine/frame.h>
#include <machine/psl.h>
#include <machine/trap.h>

typedef	vaddr_t		db_addr_t;	/* address - unsigned */
typedef	long		db_expr_t;	/* expression - signed */
typedef struct trapframe db_regs_t;

extern db_regs_t	ddb_regs;	/* register state */
#define DDB_REGS	(&ddb_regs)

#define	PC_REGS(regs)	((db_addr_t)(regs)->tf_pc)
#define	SET_PC_REGS(regs, value)	(regs)->tf_pc = (unsigned int)(value)

#define	BKPT_INST	0x4e4f		/* breakpoint instruction */
#define	BKPT_SIZE	(2)		/* size of breakpoint inst */
#define	BKPT_SET(inst)	(BKPT_INST)

#define	FIXUP_PC_AFTER_BREAK(regs)	((regs)->tf_pc -= BKPT_SIZE)

#define	db_clear_single_step(regs)	((regs)->tf_sr &= ~PSL_T)
#define	db_set_single_step(regs)	((regs)->tf_sr |=  PSL_T)

#define	IS_BREAKPOINT_TRAP(type, code)	((type) == T_BREAKPOINT)
#ifdef T_WATCHPOINT
#define	IS_WATCHPOINT_TRAP(type, code)	((type) == T_WATCHPOINT)
#else
#define	IS_WATCHPOINT_TRAP(type, code)	0
#endif

#define	M_RTS		0xffff0000
#define I_RTS		0x4e750000
#define M_JSR		0xffc00000
#define I_JSR		0x4e800000
#define M_BSR		0xff000000
#define I_BSR		0x61000000
#define	M_RTE		0xffff0000
#define	I_RTE		0x4e730000

#define	inst_trap_return(ins)	(((ins)&M_RTE) == I_RTE)
#define	inst_return(ins)	(((ins)&M_RTS) == I_RTS)
#define	inst_call(ins)		(((ins)&M_JSR) == I_JSR || \
				 ((ins)&M_BSR) == I_BSR)

/*
 * Things needed by kgdb:
 */
typedef long kgdb_reg_t;
#define KGDB_NUMREGS	(16+2)
#define KGDB_BUFLEN	512

#ifdef _KERNEL

#define KGDB_ENTER	__asm __volatile("trap  #15")

void	Debugger(void);	/* XXX */
void	kdb_kintr(db_regs_t *);
int 	kdb_trap(int, db_regs_t *);

#endif /* _KERNEL */

#endif	/* _M68K_DB_MACHDEP_H_ */
@


1.13
log
@DDB supports ELF symbols are all archs, and it's always the same as the
native size, so eliminate the #defines.

ok miod@@
@
text
@d1 1
a1 1
/*	$OpenBSD: db_machdep.h,v 1.12 2013/02/02 13:32:06 miod Exp $	*/
@


1.12
log
@Kernel bits for m68k/ELF, mostly from NetBSD. In addition, the `pmod' symbel
in fpsp has to be renamed due to a clash with other parts of the kernel.
@
text
@d1 1
a1 1
/*	$OpenBSD: db_machdep.h,v 1.11 2010/11/27 19:57:23 miod Exp $	*/
a103 3

#define	DB_ELF_SYMBOLS
#define	DB_ELFSIZE	32
@


1.11
log
@Remove ddb single-step load and store counters. Most platforms do not
implement them, and they are of questionable usefulness.
@
text
@d1 1
a1 1
/*	$OpenBSD: db_machdep.h,v 1.10 2005/11/13 17:50:44 fgsch Exp $	*/
d105 2
a106 4
/*
 * We use a.out symbols in DDB.
 */
#define	DB_AOUT_SYMBOLS
@


1.10
log
@move kgdb_connect and kgdb_panic into MI. looked by miod@@ and kettenis@@
@
text
@d1 1
a1 1
/*	$OpenBSD: db_machdep.h,v 1.9 2005/01/04 21:14:35 espie Exp $	*/
a86 2
#define inst_load(ins)		0
#define inst_store(ins)		0
@


1.9
log
@SET_PC_REGS, arches tested between me and miod.
@
text
@d1 1
a1 1
/*	$OpenBSD: db_machdep.h,v 1.8 2002/03/14 01:26:34 millert Exp $	*/
d97 1
d99 1
a99 1
#ifdef _KERNEL
@


1.8
log
@First round of __P removal in sys
@
text
@d1 1
a1 1
/*	$OpenBSD: db_machdep.h,v 1.7 2001/11/06 00:30:38 art Exp $	*/
d56 1
@


1.7
log
@Kill vm/vm_param.h, move it to uvm/uvm_param.h
@
text
@d1 1
a1 1
/*	$OpenBSD: db_machdep.h,v 1.6 2001/05/15 01:43:14 millert Exp $	*/
d99 3
a101 3
void	Debugger __P((void));	/* XXX */
void	kdb_kintr __P((db_regs_t *));
int 	kdb_trap __P((int, db_regs_t *));
@


1.7.2.1
log
@Sync UBC branch to -current
@
text
@d1 1
a1 1
/*	$OpenBSD: db_machdep.h,v 1.7 2001/11/06 00:30:38 art Exp $	*/
d99 3
a101 3
void	Debugger(void);	/* XXX */
void	kdb_kintr(db_regs_t *);
int 	kdb_trap(int, db_regs_t *);
@


1.6
log
@Replace vm_offset_t with vaddr_t and paddr_t as appropriate.
NetBSD used as a guide.
@
text
@d1 1
a1 1
/*	$OpenBSD: db_machdep.h,v 1.5 1997/07/06 07:46:25 downsj Exp $	*/
d42 1
a42 1
#include <vm/vm_param.h>
@


1.5
log
@Sync with NetBSD changes, 970415 - 970705.

This includes a new asm.h, as well as even more code abstracted from hp300.
These changes are likely to break ports that don't know about them; hp300
runs at the moment.
@
text
@d1 1
a1 1
/*	$OpenBSD: db_machdep.h,v 1.4 1997/03/21 00:36:36 niklas Exp $	*/
d48 1
a48 1
typedef	vm_offset_t	db_addr_t;	/* address - unsigned */
@


1.5.12.1
log
@Merge in -current from two days ago in the SMP branch.
As usual with merges, they do not indicate progress, so do not hold
your breath for working SMP, and do not mail me and ask about the
state of it.  It has not changed.  There is work ongoing, but very, very
slowly.  The commit is done in parts as to not lock up the tree in too
big chunks at a time.
@
text
@d1 1
a1 1
/*	$OpenBSD: db_machdep.h,v 1.5 1997/07/06 07:46:25 downsj Exp $	*/
d48 1
a48 1
typedef	vaddr_t		db_addr_t;	/* address - unsigned */
@


1.5.12.2
log
@Merge in -current
@
text
@d1 1
a1 1
/*	$OpenBSD$	*/
d42 1
a42 1
#include <uvm/uvm_param.h>
@


1.5.12.3
log
@Merge in -current from about a week ago
@
text
@d99 3
a101 3
void	Debugger(void);	/* XXX */
void	kdb_kintr(db_regs_t *);
int 	kdb_trap(int, db_regs_t *);
@


1.4
log
@NetBSD sync to sth like 970218
@
text
@d1 2
a2 2
/*	$OpenBSD: db_machdep.h,v 1.3 1997/01/19 13:53:09 niklas Exp $	*/
/*	$NetBSD: db_machdep.h,v 1.19 1997/02/18 22:29:58 gwr Exp $	*/
d104 5
@


1.3
log
@From Gordon W Ross (NetBSD):
Use db_regs_t instead of struct mc68020_saved_state
@
text
@d1 2
a2 2
/*	$OpenBSD$	*/
/*	$NetBSD: db_machdep.h,v 1.14 1997/01/15 23:11:46 gwr Exp $	*/
d36 6
a41 1
#include <vm/vm_prot.h>
d43 2
a44 2
#include <vm/vm_inherit.h>
#include <vm/lock.h>
d49 4
a52 27
typedef	int		db_expr_t;	/* expression - signed */
struct mc68020_saved_state {
	int		d0;		/* data registers */
	int		d1;
	int		d2;
	int		d3;
	int		d4;
	int		d5;
	int		d6;
	int		d7;
	int		a0;		/* address registers */
	int		a1;
	int		a2;
	int		a3;
	int		a4;
	int		a5;
	int		a6;
	int		sp;		/* stack pointer */
	short		empty;
	short		stackadj;
	unsigned short	sr;		/* status register */
	unsigned int	pc;		/* program counter - UNALIGNED!!! */
	unsigned short	stkfmt	: 4;	/* rte stack frame format */
	unsigned short	vector	: 12;	/* vector number */
};
typedef struct mc68020_saved_state db_regs_t;
db_regs_t	ddb_regs;		/* register state */
d55 1
a55 1
#define	PC_REGS(regs)	((db_addr_t)(regs)->pc)
d61 1
a61 1
#define	FIXUP_PC_AFTER_BREAK	ddb_regs.pc -= 2;
d63 2
a64 3
#define SR_T1 0x8000
#define	db_clear_single_step(regs)	((regs)->sr &= ~SR_T1)
#define	db_set_single_step(regs)	((regs)->sr |=  SR_T1)
d89 8
d99 1
d101 1
a101 1
int	kdb_trap __P((int, db_regs_t *));
@


1.2
log
@From NetBSD:
Prototype + -Wall fixes.
Clean up a few printf format strings.
Added an include for the sunos_sendsig prototype
Fix "prototype disagrees about inline" error.
@
text
@d2 1
a2 1
/*	$NetBSD: db_machdep.h,v 1.13 1996/04/29 20:50:08 leo Exp $	*/
d110 2
a111 2
void	kdb_kintr __P((struct mc68020_saved_state *));
int	kdb_trap __P((int, struct mc68020_saved_state *));
@


1.1
log
@Initial revision
@
text
@d1 2
a2 1
/*	$NetBSD: db_machdep.h,v 1.12 1994/10/26 07:50:44 cgd Exp $	*/
d107 7
@


1.1.1.1
log
@initial import of NetBSD tree
@
text
@@
