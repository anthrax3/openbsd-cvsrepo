head	1.9;
access;
symbols
	OPENBSD_5_4:1.7.0.4
	OPENBSD_5_4_BASE:1.7
	OPENBSD_5_3:1.7.0.2
	OPENBSD_5_3_BASE:1.7
	OPENBSD_5_2:1.6.0.2
	OPENBSD_5_2_BASE:1.6
	OPENBSD_5_1_BASE:1.5
	OPENBSD_5_1:1.5.0.18
	OPENBSD_5_0:1.5.0.16
	OPENBSD_5_0_BASE:1.5
	OPENBSD_4_9:1.5.0.14
	OPENBSD_4_9_BASE:1.5
	OPENBSD_4_8:1.5.0.12
	OPENBSD_4_8_BASE:1.5
	OPENBSD_4_7:1.5.0.8
	OPENBSD_4_7_BASE:1.5
	OPENBSD_4_6:1.5.0.10
	OPENBSD_4_6_BASE:1.5
	OPENBSD_4_5:1.5.0.6
	OPENBSD_4_5_BASE:1.5
	OPENBSD_4_4:1.5.0.4
	OPENBSD_4_4_BASE:1.5
	OPENBSD_4_3:1.5.0.2
	OPENBSD_4_3_BASE:1.5
	OPENBSD_4_2:1.4.0.22
	OPENBSD_4_2_BASE:1.4
	OPENBSD_4_1:1.4.0.20
	OPENBSD_4_1_BASE:1.4
	OPENBSD_4_0:1.4.0.18
	OPENBSD_4_0_BASE:1.4
	OPENBSD_3_9:1.4.0.16
	OPENBSD_3_9_BASE:1.4
	OPENBSD_3_8:1.4.0.14
	OPENBSD_3_8_BASE:1.4
	OPENBSD_3_7:1.4.0.12
	OPENBSD_3_7_BASE:1.4
	OPENBSD_3_6:1.4.0.10
	OPENBSD_3_6_BASE:1.4
	SMP_SYNC_A:1.4
	SMP_SYNC_B:1.4
	OPENBSD_3_5:1.4.0.8
	OPENBSD_3_5_BASE:1.4
	OPENBSD_3_4:1.4.0.6
	OPENBSD_3_4_BASE:1.4
	UBC_SYNC_A:1.4
	OPENBSD_3_3:1.4.0.4
	OPENBSD_3_3_BASE:1.4
	OPENBSD_3_2:1.4.0.2
	OPENBSD_3_2_BASE:1.4
	OPENBSD_3_1:1.2.0.2
	OPENBSD_3_1_BASE:1.2
	UBC_SYNC_B:1.4
	UBC:1.1.0.6
	UBC_BASE:1.1
	SMP:1.1.0.4
	OPENBSD_3_0:1.1.0.2
	OPENBSD_3_0_BASE:1.1;
locks; strict;
comment	@ * @;


1.9
date	2013.08.27.21.00.53;	author mpi;	state dead;
branches;
next	1.8;

1.8
date	2013.08.12.08.03.56;	author mpi;	state Exp;
branches;
next	1.7;

1.7
date	2012.12.13.13.55.18;	author mpi;	state Exp;
branches;
next	1.6;

1.6
date	2012.06.21.10.08.16;	author mpi;	state Exp;
branches;
next	1.5;

1.5
date	2007.11.05.19.24.31;	author martin;	state Exp;
branches;
next	1.4;

1.4
date	2002.09.15.09.01.59;	author deraadt;	state Exp;
branches;
next	1.3;

1.3
date	2002.09.15.02.02.44;	author deraadt;	state Exp;
branches;
next	1.2;

1.2
date	2002.03.14.01.26.37;	author millert;	state Exp;
branches;
next	1.1;

1.1
date	2001.09.01.15.55.18;	author drahn;	state Exp;
branches
	1.1.4.1
	1.1.6.1;
next	;

1.1.4.1
date	2001.10.31.03.01.16;	author nate;	state Exp;
branches;
next	1.1.4.2;

1.1.4.2
date	2002.03.28.10.36.01;	author niklas;	state Exp;
branches;
next	;

1.1.6.1
date	2002.06.11.03.36.34;	author art;	state Exp;
branches;
next	1.1.6.2;

1.1.6.2
date	2002.10.29.00.28.06;	author art;	state Exp;
branches;
next	;


desc
@@


1.9
log
@Since we are no longer attaching radeondrm(4) to this driver there is
no reason to pretend being compatible with the MI vga layer.  So stop
using the vga_pci_bar interface and reduce the differences with the
sparc64 driver.
@
text
@/*	$OpenBSD: vgafb_pcivar.h,v 1.8 2013/08/12 08:03:56 mpi Exp $	*/
/*	$NetBSD: vga_pcivar.h,v 1.1 1996/11/19 04:38:36 cgd Exp $	*/

/*
 * Copyright (c) 1995, 1996 Carnegie-Mellon University.
 * All rights reserved.
 *
 * Author: Chris G. Demetriou
 * 
 * Permission to use, copy, modify and distribute this software and
 * its documentation is hereby granted, provided that both the copyright
 * notice and this permission notice appear in all copies of the
 * software, derivative works or modified versions, and any portions
 * thereof, and that both notices appear in supporting documentation.
 * 
 * CARNEGIE MELLON ALLOWS FREE USE OF THIS SOFTWARE IN ITS "AS IS" 
 * CONDITION.  CARNEGIE MELLON DISCLAIMS ANY LIABILITY OF ANY KIND 
 * FOR ANY DAMAGES WHATSOEVER RESULTING FROM THE USE OF THIS SOFTWARE.
 * 
 * Carnegie Mellon requests users of this software to return to
 *
 *  Software Distribution Coordinator  or  Software.Distribution@@CS.CMU.EDU
 *  School of Computer Science
 *  Carnegie Mellon University
 *  Pittsburgh PA 15213-3890
 *
 * any improvements or extensions that they make and grant Carnegie the
 * rights to redistribute these changes.
 */

/* XXX */
int	vgafb_cnattach(bus_space_tag_t, bus_space_tag_t, int, int);
@


1.8
log
@Match the framebuffer device against its OpenFirmware node in order
to share the console detection logic with sparc64 in radeondrm(4).

ok miod@@
@
text
@d1 1
a1 1
/*	$OpenBSD: vgafb_pcivar.h,v 1.7 2012/12/13 13:55:18 mpi Exp $	*/
@


1.7
log
@iMac G3 grahic cards have a ``misc'' pci subclass that's why they weren't
attached to vgafb(4) since the use of the generic DEVICE_IS_VGA_PCI macro
in r1.26. Correct this and document why we should attach devices with such
subclass.

Fix a regression introduced in august when adding the glue to attach drm(4)
on macppc, reported by brynet@@ and nick@@ on bugs@@, thanks and sorry for the
delay!
@
text
@d1 1
a1 1
/*	$OpenBSD: vgafb_pcivar.h,v 1.6 2012/06/21 10:08:16 mpi Exp $	*/
a29 2

extern pcitag_t vgafb_pci_console_tag;
@


1.6
log
@Only allow the memory and mmio regions to be mmap()'ed at their real
addresses, remove the magic value to uniformize access to the mmio and
doesn't map the unused pseudo-vga registers.

While here simplify the console attachement logic and removed some
unused global variables. Tested by matthieu@@ and myself on various
different G3 and G4 models.

ok kettenis@@
@
text
@d1 1
a1 1
/*	$OpenBSD: vgafb_pcivar.h,v 1.5 2007/11/05 19:24:31 martin Exp $	*/
a29 8

#define	DEVICE_IS_VGA_PCI(class)					\
	    (((PCI_CLASS(class) == PCI_CLASS_DISPLAY &&			\
	      PCI_SUBCLASS(class) == PCI_SUBCLASS_DISPLAY_VGA) ||	\
	     (PCI_CLASS(class) == PCI_CLASS_DISPLAY &&			\
	      PCI_SUBCLASS(class) == PCI_SUBCLASS_DISPLAY_MISC) ||	\
	     (PCI_CLASS(class) == PCI_CLASS_PREHISTORIC &&		\
	      PCI_SUBCLASS(class) == PCI_SUBCLASS_PREHISTORIC_VGA)) ? 1 : 0)
@


1.5
log
@fix and use DEVICE_IS_VGA_PCI, makes vgafb_pci_match() much simpler

ok oga@@ brad@@
@
text
@d1 1
a1 1
/*	$OpenBSD: vgafb_pcivar.h,v 1.4 2002/09/15 09:01:59 deraadt Exp $	*/
d39 4
a42 5
void    vgafb_pci_console(bus_space_tag_t,
		u_int32_t ioaddr, u_int32_t iosize,
		bus_space_tag_t,
		u_int32_t memaddr, u_int32_t memsize,
		pci_chipset_tag_t, int, int, int);
@


1.4
log
@backout premature
@
text
@d1 1
a1 1
/*	$OpenBSD: vgafb_pcivar.h,v 1.2 2002/03/14 01:26:37 millert Exp $	*/
d31 1
a31 1
#define	DEVICE_IS_VGA_PCI(class, id)					\
d34 1
a34 1
	    (((PCI_CLASS(class) == PCI_CLASS_DISPLAY &&			\
@


1.3
log
@KNF
@
text
@d33 1
a33 1
	    PCI_SUBCLASS(class) == PCI_SUBCLASS_DISPLAY_VGA) ||	\
d35 3
a37 3
	    PCI_SUBCLASS(class) == PCI_SUBCLASS_DISPLAY_MISC) ||	\
	    (PCI_CLASS(class) == PCI_CLASS_PREHISTORIC &&		\
	    PCI_SUBCLASS(class) == PCI_SUBCLASS_PREHISTORIC_VGA)) ? 1 : 0)
@


1.2
log
@First round of __P removal in sys
@
text
@d1 1
a1 1
/*	$OpenBSD: vgafb_pcivar.h,v 1.1 2001/09/01 15:55:18 drahn Exp $	*/
d33 1
a33 1
	      PCI_SUBCLASS(class) == PCI_SUBCLASS_DISPLAY_VGA) ||	\
d35 3
a37 3
	      PCI_SUBCLASS(class) == PCI_SUBCLASS_DISPLAY_MISC) ||	\
	     (PCI_CLASS(class) == PCI_CLASS_PREHISTORIC &&		\
	      PCI_SUBCLASS(class) == PCI_SUBCLASS_PREHISTORIC_VGA)) ? 1 : 0)
@


1.1
log
@The "powerpc" port which has supported the newer Apple Macintosh powerpc based
is being renamed to macppc. This is to allow sharing of common code
between different powerpc base platforms.

Most of the work involved in the renaming process was performed by miod@@

Files moved from powerpc/pci to macppc/pci

The file pci_machdep.h was not moved in this conversion.
It needs to be check if it is correct that should be the only shared
powerpc/pci file. Or if that file too should be MD, or more files MI.
@
text
@d1 1
a1 1
/*	$OpenBSD: vgafb_pcivar.h,v 1.2 2000/11/21 02:03:45 deraadt Exp $	*/
d39 1
a39 1
void    vgafb_pci_console __P((bus_space_tag_t,
d43 1
a43 1
		pci_chipset_tag_t, int, int, int));
@


1.1.6.1
log
@Sync UBC branch to -current
@
text
@d1 1
a1 1
/*	$OpenBSD: vgafb_pcivar.h,v 1.1 2001/09/01 15:55:18 drahn Exp $	*/
d39 1
a39 1
void    vgafb_pci_console(bus_space_tag_t,
d43 1
a43 1
		pci_chipset_tag_t, int, int, int);
@


1.1.6.2
log
@sync to -current
@
text
@d1 1
a1 1
/*	$OpenBSD: vgafb_pcivar.h,v 1.1.6.1 2002/06/11 03:36:34 art Exp $	*/
@


1.1.4.1
log
@Sync the SMP branch to something just after 3.0
@
text
@d1 1
a1 1
/*	$OpenBSD$	*/
@


1.1.4.2
log
@Merge in -current from about a week ago
@
text
@d39 1
a39 1
void    vgafb_pci_console(bus_space_tag_t,
d43 1
a43 1
		pci_chipset_tag_t, int, int, int);
@


