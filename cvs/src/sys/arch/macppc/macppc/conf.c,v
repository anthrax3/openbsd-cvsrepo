head	1.67;
access;
symbols
	OPENBSD_6_1_BASE:1.67
	OPENBSD_6_0:1.65.0.2
	OPENBSD_6_0_BASE:1.65
	OPENBSD_5_9:1.63.0.2
	OPENBSD_5_9_BASE:1.63
	OPENBSD_5_8:1.62.0.6
	OPENBSD_5_8_BASE:1.62
	OPENBSD_5_7:1.62.0.2
	OPENBSD_5_7_BASE:1.62
	OPENBSD_5_6:1.58.0.4
	OPENBSD_5_6_BASE:1.58
	OPENBSD_5_5:1.56.0.4
	OPENBSD_5_5_BASE:1.56
	OPENBSD_5_4:1.52.0.2
	OPENBSD_5_4_BASE:1.52
	OPENBSD_5_3:1.50.0.2
	OPENBSD_5_3_BASE:1.50
	OPENBSD_5_2:1.47.0.2
	OPENBSD_5_2_BASE:1.47
	OPENBSD_5_1_BASE:1.46
	OPENBSD_5_1:1.46.0.2
	OPENBSD_5_0:1.45.0.2
	OPENBSD_5_0_BASE:1.45
	OPENBSD_4_9:1.44.0.2
	OPENBSD_4_9_BASE:1.44
	OPENBSD_4_8:1.42.0.2
	OPENBSD_4_8_BASE:1.42
	OPENBSD_4_7:1.40.0.2
	OPENBSD_4_7_BASE:1.40
	OPENBSD_4_6:1.39.0.4
	OPENBSD_4_6_BASE:1.39
	OPENBSD_4_5:1.38.0.2
	OPENBSD_4_5_BASE:1.38
	OPENBSD_4_4:1.37.0.2
	OPENBSD_4_4_BASE:1.37
	OPENBSD_4_3:1.33.0.2
	OPENBSD_4_3_BASE:1.33
	OPENBSD_4_2:1.32.0.2
	OPENBSD_4_2_BASE:1.32
	OPENBSD_4_1:1.29.0.2
	OPENBSD_4_1_BASE:1.29
	OPENBSD_4_0:1.28.0.2
	OPENBSD_4_0_BASE:1.28
	OPENBSD_3_9:1.27.0.2
	OPENBSD_3_9_BASE:1.27
	OPENBSD_3_8:1.26.0.6
	OPENBSD_3_8_BASE:1.26
	OPENBSD_3_7:1.26.0.4
	OPENBSD_3_7_BASE:1.26
	OPENBSD_3_6:1.26.0.2
	OPENBSD_3_6_BASE:1.26
	SMP_SYNC_A:1.26
	SMP_SYNC_B:1.26
	OPENBSD_3_5:1.25.0.2
	OPENBSD_3_5_BASE:1.25
	OPENBSD_3_4:1.23.0.2
	OPENBSD_3_4_BASE:1.23
	UBC_SYNC_A:1.22
	OPENBSD_3_3:1.21.0.2
	OPENBSD_3_3_BASE:1.21
	OPENBSD_3_2:1.19.0.2
	OPENBSD_3_2_BASE:1.19
	OPENBSD_3_1:1.9.0.4
	OPENBSD_3_1_BASE:1.9
	UBC_SYNC_B:1.19
	UBC:1.9.0.2
	UBC_BASE:1.9
	SMP:1.5.0.4
	OPENBSD_3_0:1.5.0.2
	OPENBSD_3_0_BASE:1.5;
locks; strict;
comment	@ * @;


1.67
date	2016.09.04.10.51.24;	author naddy;	state Exp;
branches;
next	1.66;
commitid	4OWaAfwqMvhOCLOI;

1.66
date	2016.09.02.17.06.12;	author goda;	state Exp;
branches;
next	1.65;
commitid	J1JzeTsS8K8zyH3c;

1.65
date	2016.04.25.20.09.14;	author tedu;	state Exp;
branches;
next	1.64;
commitid	43yo2G4zZOY9ab4i;

1.64
date	2016.02.26.09.10.05;	author natano;	state Exp;
branches;
next	1.63;
commitid	NHDvdrxPpwDqGtpK;

1.63
date	2015.10.23.15.10.52;	author claudio;	state Exp;
branches;
next	1.62;
commitid	g17gxjQh9N9egLbB;

1.62
date	2014.12.11.19.44.17;	author tedu;	state Exp;
branches;
next	1.61;
commitid	jUSAZlQ30WF1ESM9;

1.61
date	2014.10.09.04.10.03;	author tedu;	state Exp;
branches;
next	1.60;
commitid	Db8IHIncfKM3SDX9;

1.60
date	2014.10.09.03.59.59;	author tedu;	state Exp;
branches;
next	1.59;
commitid	I0KLtD9aVxAdm6aW;

1.59
date	2014.08.20.06.14.42;	author mikeb;	state Exp;
branches;
next	1.58;
commitid	qXFkosC6o9cv78HT;

1.58
date	2014.03.16.17.46.22;	author kettenis;	state Exp;
branches;
next	1.57;

1.57
date	2014.03.14.23.42.40;	author kettenis;	state Exp;
branches;
next	1.56;

1.56
date	2013.11.04.17.14.26;	author deraadt;	state Exp;
branches;
next	1.55;

1.55
date	2013.11.04.14.11.29;	author deraadt;	state Exp;
branches;
next	1.54;

1.54
date	2013.08.27.21.02.53;	author mpi;	state Exp;
branches;
next	1.53;

1.53
date	2013.08.20.14.27.29;	author ajacoutot;	state Exp;
branches;
next	1.52;

1.52
date	2013.06.03.17.33.58;	author tedu;	state Exp;
branches;
next	1.51;

1.51
date	2013.03.15.09.10.52;	author ratchov;	state Exp;
branches;
next	1.50;

1.50
date	2012.12.04.10.42.04;	author mpi;	state Exp;
branches;
next	1.49;

1.49
date	2012.08.30.21.54.13;	author mpi;	state Exp;
branches;
next	1.48;

1.48
date	2012.08.23.06.12.49;	author deraadt;	state Exp;
branches;
next	1.47;

1.47
date	2012.04.06.15.10.40;	author jsing;	state Exp;
branches;
next	1.46;

1.46
date	2011.10.06.20.49.28;	author deraadt;	state Exp;
branches;
next	1.45;

1.45
date	2011.04.19.23.07.54;	author todd;	state Exp;
branches;
next	1.44;

1.44
date	2011.01.14.19.04.08;	author jasper;	state Exp;
branches;
next	1.43;

1.43
date	2010.09.23.05.02.14;	author claudio;	state Exp;
branches;
next	1.42;

1.42
date	2010.07.03.03.59.16;	author krw;	state Exp;
branches;
next	1.41;

1.41
date	2010.06.09.15.25.33;	author jsing;	state Exp;
branches;
next	1.40;

1.40
date	2009.08.13.15.04.20;	author dlg;	state Exp;
branches;
next	1.39;

1.39
date	2009.06.03.14.45.52;	author jj;	state Exp;
branches;
next	1.38;

1.38
date	2009.01.25.17.30.49;	author miod;	state Exp;
branches;
next	1.37;

1.37
date	2008.06.12.20.03.48;	author mglocker;	state Exp;
branches;
next	1.36;

1.36
date	2008.05.14.20.49.48;	author miod;	state Exp;
branches;
next	1.35;

1.35
date	2008.05.13.21.55.16;	author miod;	state Exp;
branches;
next	1.34;

1.34
date	2008.04.08.14.31.54;	author claudio;	state Exp;
branches;
next	1.33;

1.33
date	2007.11.12.19.23.26;	author kettenis;	state Exp;
branches;
next	1.32;

1.32
date	2007.07.24.10.18.24;	author mk;	state Exp;
branches;
next	1.31;

1.31
date	2007.06.04.10.23.51;	author otto;	state Exp;
branches;
next	1.30;

1.30
date	2007.06.01.23.14.06;	author deraadt;	state Exp;
branches;
next	1.29;

1.29
date	2007.02.06.22.39.13;	author dlg;	state Exp;
branches;
next	1.28;

1.28
date	2006.03.27.06.15.24;	author deraadt;	state Exp;
branches;
next	1.27;

1.27
date	2005.11.16.03.43.40;	author deraadt;	state Exp;
branches;
next	1.26;

1.26
date	2004.05.30.08.11.26;	author grange;	state Exp;
branches;
next	1.25;

1.25
date	2004.02.10.01.31.21;	author millert;	state Exp;
branches;
next	1.24;

1.24
date	2003.10.15.17.50.16;	author drahn;	state Exp;
branches;
next	1.23;

1.23
date	2003.06.27.16.57.14;	author nate;	state Exp;
branches;
next	1.22;

1.22
date	2003.05.14.00.20.37;	author tedu;	state Exp;
branches;
next	1.21;

1.21
date	2002.12.05.02.49.55;	author kjc;	state Exp;
branches;
next	1.20;

1.20
date	2002.11.08.19.00.37;	author mickey;	state Exp;
branches;
next	1.19;

1.19
date	2002.09.15.09.01.58;	author deraadt;	state Exp;
branches;
next	1.18;

1.18
date	2002.09.15.02.02.43;	author deraadt;	state Exp;
branches;
next	1.17;

1.17
date	2002.09.06.13.56.51;	author drahn;	state Exp;
branches;
next	1.16;

1.16
date	2002.07.10.22.08.47;	author mickey;	state Exp;
branches;
next	1.15;

1.15
date	2002.06.24.19.00.33;	author mickey;	state Exp;
branches;
next	1.14;

1.14
date	2002.06.19.02.52.23;	author mickey;	state Exp;
branches;
next	1.13;

1.13
date	2002.06.11.03.43.46;	author miod;	state Exp;
branches;
next	1.12;

1.12
date	2002.06.11.03.39.50;	author miod;	state Exp;
branches;
next	1.11;

1.11
date	2002.06.07.07.13.31;	author miod;	state Exp;
branches;
next	1.10;

1.10
date	2002.05.16.21.11.15;	author miod;	state Exp;
branches;
next	1.9;

1.9
date	2001.12.12.19.19.17;	author jason;	state Exp;
branches
	1.9.2.1;
next	1.8;

1.8
date	2001.12.11.23.19.02;	author miod;	state Exp;
branches;
next	1.7;

1.7
date	2001.12.05.23.58.41;	author tdeval;	state Exp;
branches;
next	1.6;

1.6
date	2001.11.06.23.46.05;	author drahn;	state Exp;
branches;
next	1.5;

1.5
date	2001.10.03.14.45.37;	author drahn;	state Exp;
branches
	1.5.4.1;
next	1.4;

1.4
date	2001.09.28.03.14.20;	author mickey;	state Exp;
branches;
next	1.3;

1.3
date	2001.09.28.02.53.13;	author mickey;	state Exp;
branches;
next	1.2;

1.2
date	2001.09.27.17.30.56;	author drahn;	state Exp;
branches;
next	1.1;

1.1
date	2001.09.01.15.44.20;	author drahn;	state Exp;
branches;
next	;

1.5.4.1
date	2001.10.31.03.01.16;	author nate;	state Exp;
branches;
next	1.5.4.2;

1.5.4.2
date	2001.11.13.21.00.53;	author niklas;	state Exp;
branches;
next	1.5.4.3;

1.5.4.3
date	2002.03.06.01.06.11;	author niklas;	state Exp;
branches;
next	1.5.4.4;

1.5.4.4
date	2003.03.27.23.29.46;	author niklas;	state Exp;
branches;
next	1.5.4.5;

1.5.4.5
date	2003.05.16.00.29.39;	author niklas;	state Exp;
branches;
next	1.5.4.6;

1.5.4.6
date	2004.02.19.10.49.03;	author niklas;	state Exp;
branches;
next	1.5.4.7;

1.5.4.7
date	2004.06.05.23.10.52;	author niklas;	state Exp;
branches;
next	;

1.9.2.1
date	2002.06.11.03.36.34;	author art;	state Exp;
branches;
next	1.9.2.2;

1.9.2.2
date	2002.10.29.00.28.06;	author art;	state Exp;
branches;
next	1.9.2.3;

1.9.2.3
date	2003.05.19.21.49.43;	author tedu;	state Exp;
branches;
next	;


desc
@@


1.67
log
@Remove support for tape block devices. Nobody mount(8)s tapes any longer.
ok deraadt@@ guenther@@
@
text
@/*	$OpenBSD: conf.c,v 1.66 2016/09/02 17:06:12 goda Exp $ */

/*
 * Copyright (c) 1997 Per Fogelstrom
 * Copyright (c) 1997 RTMX Inc, North Carolina
 *
 * Redistribution and use in source and binary forms, with or without
 * modification, are permitted provided that the following conditions
 * are met:
 * 1. Redistributions of source code must retain the above copyright
 *    notice, this list of conditions and the following disclaimer.
 * 2. Redistributions in binary form must reproduce the above copyright
 *    notice, this list of conditions and the following disclaimer in the
 *    documentation and/or other materials provided with the distribution.
 * 3. All advertising materials mentioning features or use of this software
 *    must display the following acknowledgement:
 *	This product includes software developed under OpenBSD for RTMX Inc,
 *	North Carolina, USA, by Per Fogelstrom, Opsycon AB, Sweden.
 * 4. The name of the author may not be used to endorse or promote products
 *    derived from this software without specific prior written permission.
 *
 * THIS SOFTWARE IS PROVIDED BY THE AUTHOR ``AS IS'' AND ANY EXPRESS
 * OR IMPLIED WARRANTIES, INCLUDING, BUT NOT LIMITED TO, THE IMPLIED
 * WARRANTIES OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE
 * ARE DISCLAIMED.  IN NO EVENT SHALL THE AUTHOR BE LIABLE FOR ANY
 * DIRECT, INDIRECT, INCIDENTAL, SPECIAL, EXEMPLARY, OR CONSEQUENTIAL
 * DAMAGES (INCLUDING, BUT NOT LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS
 * OR SERVICES; LOSS OF USE, DATA, OR PROFITS; OR BUSINESS INTERRUPTION)
 * HOWEVER CAUSED AND ON ANY THEORY OF LIABILITY, WHETHER IN CONTRACT, STRICT
 * LIABILITY, OR TORT (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY
 * OUT OF THE USE OF THIS SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF
 * SUCH DAMAGE.
 *
 */
#include <sys/param.h>
#include <sys/buf.h>
#include <sys/ioctl.h>
#include <sys/systm.h>
#include <sys/tty.h>
#include <sys/vnode.h>

#include <machine/conf.h>

#include "sd.h"
#include "st.h"
#include "cd.h"
#include "uk.h"
#include "rd.h"
#include "wd.h"
bdev_decl(wd);
cdev_decl(wd);

#include "vnd.h"

struct bdevsw bdevsw[] = {
	bdev_disk_init(NWD,wd),		/* 0: ST506/ESDI/IDE disk */
	bdev_swap_init(1,sw),		/* 1 swap pseudo device */
	bdev_disk_init(NSD,sd),		/* 2 SCSI Disk */
	bdev_disk_init(NCD,cd),		/* 3 SCSI CD-ROM */
	bdev_notdef(),			/* 4 unknown*/
	bdev_notdef(),			/* 5 was: SCSI tape */
	bdev_notdef(),			/* 6 unknown*/
	bdev_notdef(),			/* 7 unknown*/
	bdev_notdef(),			/* 8 */
	bdev_notdef(),			/* 9 */
	bdev_notdef(),			/* 10 */
	bdev_notdef(),			/* 11 */
	bdev_notdef(),			/* 12 */
	bdev_notdef(),			/* 13 */
	bdev_disk_init(NVND,vnd),	/* 14 vnode disk driver*/
	bdev_notdef(),			/* 15 unknown*/
	bdev_notdef(),			/* 16 was: concatenated disk driver*/
	bdev_disk_init(NRD,rd),		/* 17 ram disk driver*/
	bdev_notdef(),			/* 18 unknown*/
	bdev_notdef(),			/* 19 was: RAIDframe disk driver */
};
int nblkdev = nitems(bdevsw);

#include "pty.h"
#include "zstty.h"

cdev_decl(kbd);
cdev_decl(ms);

#include "com.h"
cdev_decl(com);

#include "wsdisplay.h"
#include "wskbd.h"
#include "wsmouse.h"

#include "bpfilter.h"

#include "tun.h"

#include "ksyms.h"
#include "usb.h"
#include "uhid.h"
#include "ugen.h"
#include "ulpt.h"
#include "ucom.h"

#include "apm.h"
#include "drm.h"
cdev_decl(drm);

#include "wsmux.h"

#ifdef USER_PCICONF
#include "pci.h"
cdev_decl(pci);
#endif

#include "audio.h"
#include "video.h"
#include "midi.h"

#include "pf.h"

#include "radio.h"
#include "bktr.h"
#include "hotplug.h"
#include "gpio.h"
#include "bio.h"
#include "vscsi.h"
#include "pppx.h"
#include "fuse.h"
#include "switch.h"

struct cdevsw cdevsw[] = {
	cdev_cn_init(1,cn),		/* 0: virtual console */
	cdev_ctty_init(1,ctty),		/* 1: controlling terminal */
	cdev_mm_init(1,mm),		/* 2: /dev/{null,mem,kmem,...} */
	cdev_notdef(),			/* 3 was /dev/drum */
	cdev_tty_init(NPTY,pts),	/* 4: pseudo-tty slave */
	cdev_ptc_init(NPTY,ptc),	/* 5: pseudo-tty master */
	cdev_log_init(1,log),		/* 6: /dev/klog */
	cdev_tty_init(NZSTTY,zs),	/* 7: Serial ports */
	cdev_disk_init(NSD,sd),		/* 8: SCSI disk */
	cdev_disk_init(NCD,cd),		/* 9: SCSI CD-ROM */
	cdev_notdef(),			/* 10: SCSI changer */
	cdev_disk_init(NWD,wd),		/* 11: ST506/ESDI/IDE disk */
	cdev_notdef(),			/* 12 */
	cdev_notdef(),			/* 13 */
	cdev_notdef(),			/* 14 */
	cdev_notdef(),			/* 15 */
	cdev_notdef(),			/* 16 */
	cdev_disk_init(NRD,rd),		/* 17 ram disk driver*/
	cdev_notdef(),			/* 18 was: concatenated disk driver */
	cdev_disk_init(NVND,vnd),	/* 19: vnode disk */
	cdev_tape_init(NST,st),		/* 20: SCSI tape */
	cdev_fd_init(1,filedesc),	/* 21: file descriptor pseudo-dev */
	cdev_bpf_init(NBPFILTER,bpf),	/* 22: berkeley packet filter */
	cdev_tun_init(NTUN,tun),	/* 23: network tunnel */
	cdev_notdef(),			/* 24 was LKM */
	cdev_apm_init(NAPM,apm),	/* 25: APM interface */
	cdev_tty_init(NCOM,com),        /* 26: Serial Ports via com(4) */
	cdev_notdef(),			/* 27 */
	cdev_notdef(),			/* 28 */
	cdev_notdef(),			/* 29 */
	cdev_notdef(),			/* 30 */
	cdev_notdef(),			/* 31 */
	cdev_notdef(),			/* 32 */
	cdev_notdef(),			/* 33 */
	cdev_notdef(),			/* 34 */
	cdev_notdef(),			/* 35 */
	cdev_notdef(),			/* 36 */
	cdev_notdef(),			/* 37 */
	cdev_notdef(),			/* 38 */
	cdev_pf_init(NPF,pf),		/* 39: packet filter */
	cdev_random_init(1,random),	/* 40: random data source */
	cdev_uk_init(NUK,uk),		/* 41: unknown SCSI */
	cdev_notdef(),			/* 42 */
	cdev_ksyms_init(NKSYMS,ksyms),	/* 43: Kernel symbols device */
	cdev_audio_init(NAUDIO,audio),	/* 44: generic audio I/O */
	cdev_video_init(NVIDEO,video),	/* 45: generic video I/O */
	cdev_notdef(),			/* 46 */
	cdev_notdef(),			/* 47: was: /dev/crypto */
	cdev_notdef(),			/* 48 */
	cdev_notdef(),			/* 49 */
	cdev_notdef(),			/* 50 */
	cdev_notdef(),			/* 51 */
	cdev_midi_init(NMIDI,midi),	/* 52: MIDI I/O */
	cdev_notdef(),			/* 53 was: sequencer I/O */
	cdev_notdef(),			/* 54 was: RAIDframe disk driver */
	cdev_notdef(),			/* 55 */
	/* The following slots are reserved for isdn4bsd. */
	cdev_notdef(),			/* 56: i4b main device */
	cdev_notdef(),			/* 57: i4b control device */
	cdev_notdef(),			/* 58: i4b raw b-channel access */
	cdev_notdef(),			/* 59: i4b trace device */
	cdev_notdef(),			/* 60: i4b phone device */
	/* End of reserved slots for isdn4bsd. */
	cdev_usb_init(NUSB,usb),	/* 61: USB controller */
	cdev_usbdev_init(NUHID,uhid),	/* 62: USB generic HID */
	cdev_usbdev_init(NUGEN,ugen),	/* 63: USB generic driver */
	cdev_ulpt_init(NULPT,ulpt),	/* 64: USB printers */
	cdev_notdef(),			/* 65: was urio */
	cdev_tty_init(NUCOM,ucom),	/* 66: USB tty */
	cdev_wsdisplay_init(NWSDISPLAY,	/* 67: frame buffers, etc. */
		wsdisplay),
	cdev_mouse_init(NWSKBD, wskbd),	/* 68: keyboards */
	cdev_mouse_init(NWSMOUSE,	/* 69: mice */
		wsmouse),
	cdev_mouse_init(NWSMUX, wsmux),	/* 70: ws multiplexor */
#ifdef USER_PCICONF
	cdev_pci_init(NPCI,pci),	/* 71: PCI user */
#else
	cdev_notdef(),
#endif
	cdev_notdef(),			/* 72: ALTQ (deprecated) */
	cdev_notdef(),
	cdev_notdef(),			/* 74: was USB scanners */
	cdev_bktr_init(NBKTR,bktr),	/* 75: Bt848 video capture device */
	cdev_radio_init(NRADIO, radio),	/* 76: generic radio I/O */
	cdev_ptm_init(NPTY,ptm),	/* 77: pseudo-tty ptm device */
	cdev_hotplug_init(NHOTPLUG,hotplug), /* 78: devices hot plugging */
	cdev_gpio_init(NGPIO,gpio),	/* 79: GPIO interface */
	cdev_bio_init(NBIO,bio),	/* 80: ioctl tunnel */
	cdev_notdef(),
	cdev_openprom_init(1,openprom),	/* 82: /dev/openprom */
	cdev_vscsi_init(NVSCSI,vscsi),	/* 83: vscsi */
	cdev_disk_init(1,diskmap),	/* 84: disk mapper */
	cdev_pppx_init(NPPPX,pppx),	/* 85: pppx */
	cdev_tun_init(NTUN,tap),	/* 86: Ethernet network tunnel */
	cdev_drm_init(NDRM,drm),	/* 87: drm */
	cdev_fuse_init(NFUSE,fuse),	/* 88: fuse */
	cdev_switch_init(NSWITCH,switch), /* 89: switch(4) control interface */
};
int nchrdev = nitems(cdevsw);

int mem_no = 2;				/* major number of /dev/mem */

/*
 * Swapdev is a fake device implemented in sw.c.
 * It is used only internally to get to swstrategy.
 */
dev_t swapdev = makedev(1, 0);

/*
 * Check whether dev is /dev/mem or /dev/kmem.
 */
int
iskmemdev(dev_t dev)
{
	return major(dev) == mem_no && minor(dev) < 2;
}

/*
 * Check whether dev is /dev/zero.
 */
int
iszerodev(dev_t dev)
{
	return major(dev) == mem_no && minor(dev) == 12;
}

dev_t
getnulldev()
{
	return makedev(mem_no, 2);
}

int chrtoblktbl[] = {
	/*VCHR*/	/*VBLK*/
	/*  0 */	NODEV,
	/*  1 */	NODEV,
	/*  2 */	NODEV,
	/*  3 */	NODEV,
	/*  4 */	NODEV,
	/*  5 */	NODEV,
	/*  6 */	NODEV,
	/*  7 */	NODEV,
	/*  8 */	2,		/* sd */
	/*  9 */	3,		/* cd */
	/* 10 */	NODEV,
	/* 11 */	0,		/* wd */
	/* 12 */	NODEV,
	/* 13 */	NODEV,
	/* 14 */	NODEV,
	/* 15 */	NODEV,
	/* 16 */	NODEV,
	/* 17 */	17,		/* rd */
	/* 18 */	NODEV,
	/* 19 */	14,		/* vnd */
};
int nchrtoblktbl = nitems(chrtoblktbl);

#include <dev/cons.h>

cons_decl(ws);
cons_decl(zs);

struct consdev constab[] = {
#if NWSDISPLAY > 0
	cons_init(ws),
#endif
#if NZSTTY > 0
	cons_init(zs),
#endif
	{ 0 },
};
@


1.66
log
@Add switch(4) cdev entry

ok deraadt@@ yasuoka@@ reyk@@
@
text
@d1 1
a1 1
/*	$OpenBSD: conf.c,v 1.65 2016/04/25 20:09:14 tedu Exp $ */
d61 1
a61 1
	bdev_tape_init(NST,st),		/* 5 SCSI tape */
a285 1
	/* 20 */	5,		/* st */
@


1.65
log
@remove systrace
@
text
@d1 1
a1 1
/*	$OpenBSD: conf.c,v 1.64 2016/02/26 09:10:05 natano Exp $ */
d128 1
d228 1
@


1.64
log
@Remove stale RAIDframe entries from chrtoblktbl.

While there truncate the tables to the minimum required size; chrtoblk()
and blktochr() are designed to handle a table shorter than cdevsw.

"Looks good to me" deraadt@@
@
text
@d1 1
a1 1
/*	$OpenBSD: conf.c,v 1.63 2015/10/23 15:10:52 claudio Exp $ */
a119 2
#include "systrace.h"

d180 1
a180 1
	cdev_systrace_init(NSYSTRACE,systrace),	/* 50 system call tracing */
@


1.63
log
@Allocate a new major for tap(4) also note that pseudo-device tun is for tap
as well. OK dlg@@ mpi@@
@
text
@d1 1
a1 1
/*	$OpenBSD: conf.c,v 1.62 2014/12/11 19:44:17 tedu Exp $ */
a286 34
	/* 21 */	NODEV,
	/* 22 */	NODEV,
	/* 23 */	NODEV,
	/* 24 */	NODEV,
	/* 25 */	NODEV,
	/* 26 */	NODEV,
	/* 27 */	NODEV,
	/* 28 */	NODEV,
	/* 29 */	NODEV,
	/* 30 */	NODEV,
	/* 31 */	NODEV,
	/* 32 */	NODEV,
	/* 33 */	NODEV,
	/* 34 */	NODEV,
	/* 35 */	NODEV,
	/* 36 */	NODEV,
	/* 37 */	NODEV,
	/* 38 */	NODEV,
	/* 39 */	NODEV,
	/* 40 */	NODEV,
	/* 41 */	NODEV,
	/* 42 */	NODEV,
	/* 43 */	NODEV,
	/* 44 */	NODEV,
	/* 45 */	NODEV,
	/* 46 */	NODEV,
	/* 47 */	NODEV,
	/* 48 */	NODEV,
	/* 49 */	NODEV,
	/* 50 */	NODEV,
	/* 51 */	NODEV,
	/* 52 */	NODEV,
	/* 53 */	NODEV,
	/* 54 */	19,		/* raid */
@


1.62
log
@dragonflybsd has added a urio driver. conservation of urios requires
that we delete ours, which isn't actually useful.
ok mpi sthen
@
text
@d1 1
a1 1
/*	$OpenBSD: conf.c,v 1.61 2014/10/09 04:10:03 tedu Exp $ */
d226 1
a226 1
	cdev_notdef(),			/* 86 */
@


1.61
log
@mechanical translation of dev_lkm_dummy() to dev_notdef()
@
text
@d1 1
a1 1
/*	$OpenBSD: conf.c,v 1.60 2014/10/09 03:59:59 tedu Exp $ */
a100 1
#include "urio.h"
d199 1
a199 1
	cdev_urio_init(NURIO,urio),	/* 65: USB Diamond Rio 500 */
@


1.60
log
@remove LKM devices
@
text
@d1 1
a1 1
/*	$OpenBSD: conf.c,v 1.59 2014/08/20 06:14:42 mikeb Exp $ */
d64 6
a69 6
	bdev_lkm_dummy(),		/* 8 */
	bdev_lkm_dummy(),		/* 9 */
	bdev_lkm_dummy(),		/* 10 */
	bdev_lkm_dummy(),		/* 11 */
	bdev_lkm_dummy(),		/* 12 */
	bdev_lkm_dummy(),		/* 13 */
d166 6
a171 6
	cdev_lkm_dummy(),		/* 33 */
	cdev_lkm_dummy(),		/* 34 */
	cdev_lkm_dummy(),		/* 35 */
	cdev_lkm_dummy(),		/* 36 */
	cdev_lkm_dummy(),		/* 37 */
	cdev_lkm_dummy(),		/* 38 */
@


1.59
log
@unlink crypto(4) pseudo device from the architecture dependant character
device tables and kernel config files.  ok deraadt
@
text
@d1 1
a1 1
/*	$OpenBSD: conf.c,v 1.58 2014/03/16 17:46:22 kettenis Exp $ */
a95 6
#ifdef LKM
#define NLKM 1
#else
#define NLKM 0
#endif

d157 1
a157 1
	cdev_lkm_init(NLKM,lkm),	/* 24: loadable module driver */
@


1.58
log
@fix typo; unbreak build
@
text
@d1 1
a1 1
/*	$OpenBSD: conf.c,v 1.57 2014/03/14 23:42:40 kettenis Exp $ */
a109 2
#include "inet.h"

d186 1
a186 1
	cdev_crypto_init(NCRYPTO,crypto), /* 47: /dev/crypto */
@


1.57
log
@Remove the userland AGP interface.  Now that we have KMS, it is no longer
used by any of the remaining xenocara drivers.  Except perhaps for the
legacy i810 support in the xf86-video-intel driver.  But i810 support has
almost certainly been broken for more than a year now, and any remaining
users are probably better off using the xf86-video-vesa driver ever since
XAA support was removed from the X server.

ok deraadt@@, jsg@@, mpi@@
@
text
@d1 1
a1 1
/*	$OpenBSD: conf.c,v 1.56 2013/11/04 17:14:26 deraadt Exp $ */
d235 1
a235 1
	cdev_notdef,			/* 86 */
@


1.56
log
@more iop.h left; Mark Patruck
@
text
@d1 1
a1 1
/*	$OpenBSD: conf.c,v 1.55 2013/11/04 14:11:29 deraadt Exp $ */
a112 2
#include "agp.h"
cdev_decl(agp);
d235 1
a235 1
	cdev_agp_init(NAGP,agp),	/* 86: agp */
@


1.55
log
@remove iop(4) driver.  it is entirely unmaintained and supports something
which basically doesn't exist at all.
reminded about it by brad
@
text
@d1 1
a1 1
/*	$OpenBSD: conf.c,v 1.54 2013/08/27 21:02:53 mpi Exp $ */
a90 2

#include "iop.h"
@


1.54
log
@Remove definitions of nonexistent consdevs.
@
text
@d1 1
a1 1
/*	$OpenBSD: conf.c,v 1.53 2013/08/20 14:27:29 ajacoutot Exp $ */
a114 1
#include "bthub.h"
d226 1
a226 1
	cdev_iop_init(NIOP,iop),	/* 73: I2O IOP control interface */
d234 1
a234 1
	cdev_bthub_init(NBTHUB,bthub),	/* 81: bthub */
@


1.53
log
@Remove uscanner(4). It was disabled in GENERIC more than 2.5 years ago.
No regression has been reported since libusb became the prefered
solution to work with USB scanners.

req. by mpi@@
ok ian@@ mpi@@ miod@@
@
text
@d1 1
a1 1
/*	$OpenBSD: conf.c,v 1.52 2013/06/03 17:33:58 tedu Exp $ */
a338 1
#include "vgafb_pci.h"
a341 2
cons_decl(ofc);
cons_decl(com);
a348 3
#endif
#if NOFCONS > 0
	cons_init(ofc),
@


1.52
log
@more fuse in more places. credit: miod
@
text
@d1 1
a1 1
/*	$OpenBSD: conf.c,v 1.51 2013/03/15 09:10:52 ratchov Exp $ */
a110 1
#include "uscanner.h"
d228 1
a228 1
	cdev_usbdev_init(NUSCANNER,uscanner), /* 74: usb scanner */
@


1.51
log
@Delete the sequencer(4) driver, since its not used any longer. Diff
mostly from armani.
ok miod, mpi, jsg and help from sthen
@
text
@d1 1
a1 1
/*	$OpenBSD: conf.c,v 1.50 2012/12/04 10:42:04 mpi Exp $ */
d144 1
d243 1
@


1.50
log
@Add support for Uninorth AGP bridges found in most if not all the macppc
machines with a G3 or G4 microprocessor. It would not be difficult to add
support for U3 bridges found in G5 powered macppc to this driver but I
don't have such hardware.
@
text
@d1 1
a1 1
/*	$OpenBSD: conf.c,v 1.49 2012/08/30 21:54:13 mpi Exp $ */
a131 1
#include "sequencer.h"
d199 1
a199 1
	cdev_midi_init(NSEQUENCER,sequencer),	/* 53: sequencer I/O */
@


1.49
log
@Determine the memory and mmio regions based on previously initialzed BAR
structures and add the necessary glue to attach drm(4).

ok kettenis@@
@
text
@d1 1
a1 1
/*	$OpenBSD: conf.c,v 1.48 2012/08/23 06:12:49 deraadt Exp $ */
d117 2
d241 1
a241 1
	cdev_notdef(),			/* 86: agp */
@


1.48
log
@kill nnpfs dead
@
text
@d1 1
a1 1
/*	$OpenBSD: conf.c,v 1.47 2012/04/06 15:10:40 jsing Exp $ */
d117 2
d239 2
@


1.47
log
@tedu the raidframe.

ok deraadt@@
@
text
@d1 1
a1 1
/*	$OpenBSD: conf.c,v 1.45 2011/04/19 23:07:54 todd Exp $ */
a97 5
#ifdef NNPFS
#include <nnpfs/nnnpfs.h>
cdev_decl(nnpfs_dev);
#endif

a193 3
#ifdef NNPFS
	cdev_nnpfs_init(NNNPFS,nnpfs_dev),	/* 51: nnpfs communication device */
#else
a194 1
#endif
@


1.46
log
@ccd goes to the attic
discussed with jsing and millert
@
text
@a53 1
#include "raid.h"
d75 1
a75 1
	bdev_disk_init(NRAID,raid),	/* 19: RAIDframe disk driver */
d206 1
a206 1
	cdev_disk_init(NRAID,raid),	/* 54: RAIDframe disk driver */
@


1.45
log
@as confirmed by my 11mo old son, this makes midi keyboards work with macppc
"no objection" drahn@@
@
text
@d1 1
a1 1
/*	$OpenBSD: conf.c,v 1.44 2011/01/14 19:04:08 jasper Exp $ */
a53 1
#include "ccd.h"
d73 1
a73 1
	bdev_disk_init(NCCD,ccd),	/* 16 concatenated disk driver*/
d167 1
a167 1
	cdev_disk_init(NCCD,ccd),	/* 18 concatenated disk driver */
d302 1
a302 1
	/* 18 */	16,		/* ccd */
@


1.44
log
@- use nitems()

"doesn't hurt" deraadt@@
@
text
@d1 1
a1 1
/*	$OpenBSD: conf.c,v 1.43 2010/09/23 05:02:14 claudio Exp $ */
d134 2
d206 2
a207 2
	cdev_notdef(),			/* 52 */
	cdev_notdef(),			/* 53 */
@


1.43
log
@Add pppx(4) to the cdevs of the remaining archs.
OK dlg@@
@
text
@d1 1
a1 1
/*	$OpenBSD: conf.c,v 1.42 2010/07/03 03:59:16 krw Exp $ */
d79 1
a79 1
int nblkdev = sizeof bdevsw / sizeof bdevsw[0];
d247 1
a247 1
int nchrdev = sizeof cdevsw / sizeof cdevsw[0];
d339 1
a339 1
int nchrtoblktbl = sizeof(chrtoblktbl) / sizeof(chrtoblktbl[0]);
@


1.42
log
@No more ss(4) or usscanner(4). Unused, unloved and unmaintained.
General huzzahs.

"go for it" deraadt@@
@
text
@d1 1
a1 1
/*	$OpenBSD: conf.c,v 1.41 2010/06/09 15:25:33 jsing Exp $ */
d145 1
d245 1
@


1.41
log
@Wire up device nodes for disk mapper.

ok deraadt@@
@
text
@d1 1
a1 1
/*	$OpenBSD: conf.c,v 1.39 2009/06/03 14:45:52 jj Exp $ */
a46 1
#include "ss.h"
d189 1
a189 1
	cdev_ss_init(NSS,ss),		/* 42: SCSI scanner */
@


1.40
log
@wire vscsi up to a cdev

for claudio@@ ok deraadt@@
@
text
@d244 1
@


1.39
log
@Arla client rename from xfs to nnpfs for later upgrades. Tested on various arches. ok todd@@ beck@@
@
text
@d1 1
a1 1
/*	$OpenBSD: conf.c,v 1.38 2009/01/25 17:30:49 miod Exp $ */
d145 1
d243 1
@


1.38
log
@Remove /dev/drum and related code.
@
text
@d1 1
a1 1
/*	$OpenBSD: conf.c,v 1.37 2008/06/12 20:03:48 mglocker Exp $ */
d101 3
a103 3
#ifdef XFS
#include <xfs/nxfs.h>
cdev_decl(xfs_dev);
d198 2
a199 2
#ifdef XFS
	cdev_xfs_init(NXFS,xfs_dev),	/* 51: xfs communication device */
@


1.37
log
@Enable /dev/video* for all USB capable archs.  MAKEDEV bits will follow
shortly.

OK todd@@
@
text
@d1 1
a1 1
/*	$OpenBSD: conf.c,v 1.36 2008/05/14 20:49:48 miod Exp $ */
d150 1
a150 1
	cdev_swap_init(1,sw),		/* 3: /dev/drum (swap pseudo-device) */
@


1.36
log
@Fix more chrtoblktbl[] sloppyness, and add proper block st nodes to *ppc and
sgi.
@
text
@d1 1
a1 1
/*	$OpenBSD: conf.c,v 1.35 2008/05/13 21:55:16 miod Exp $ */
d134 1
d192 1
a192 1
	cdev_notdef(),			/* 45 */
@


1.35
log
@Fix chrtoblktbl[] entries.
@
text
@d1 1
a1 1
/*	$OpenBSD: conf.c,v 1.34 2008/04/08 14:31:54 claudio Exp $ */
d64 1
a64 1
	bdev_notdef(),			/* 5 unknown*/
d286 2
a287 2
	/*  8 */	2,
	/*  9 */	3,
d289 1
a289 1
	/* 11 */	0,
d295 4
a298 4
	/* 17 */	17,
	/* 18 */	16,
	/* 19 */	14,
	/* 20 */	NODEV,
d332 1
a332 1
	/* 54 */	19,
@


1.34
log
@Split the cdev makro for bpftun into two seperate definitions. tun(4) and
bpf(4) are different enough so that the split makes sense -- this is necessary
to make bpf(4) cloneable.
requested deraadt@@, OK thib@@
@
text
@d1 1
a1 1
/*	$OpenBSD: conf.c,v 1.33 2007/11/12 19:23:26 kettenis Exp $ */
d287 1
a287 1
	/*  9 */	NODEV,
d291 1
a291 1
	/* 13 */	4,
d296 2
a297 2
	/* 18 */	NODEV,
	/* 19 */	NODEV,
@


1.33
log
@/dev/openprom

ok miod@@, deraadt@@
@
text
@d1 1
a1 1
/*	$OpenBSD: conf.c,v 1.32 2007/07/24 10:18:24 mk Exp $ */
d168 2
a169 2
	cdev_bpftun_init(NBPFILTER,bpf),/* 22: berkeley packet filter */
	cdev_bpftun_init(NTUN,tun),	/* 23: network tunnel */
@


1.32
log
@bthub for macppc to make xsa happy.

todd will commit the MAKEDEV bits later.
@
text
@d1 1
a1 1
/*	$OpenBSD: conf.c,v 1.31 2007/06/04 10:23:51 otto Exp $ */
d240 1
@


1.31
log
@do not shuffle dev 4 under the carpet; make svnd work again; uncookie
for deraadt@@ ok irc@@
@
text
@d1 1
a1 1
/*	$OpenBSD: conf.c,v 1.30 2007/06/01 23:14:06 deraadt Exp $ */
d124 1
d239 1
@


1.30
log
@remove ofw devices which we don't use; that way of mixing devices is crazy
(means i also don not have to fix the daddr_t problems)
ok miod
@
text
@d1 1
a1 1
/*	$OpenBSD: conf.c,v 1.29 2007/02/06 22:39:13 dlg Exp $ */
d63 1
@


1.29
log
@define the bio(4) cdev stuff in conf.h, rather than having a per machine
definition. switch amd64 and i386 to the conf.h version, and add it to
macppc.

original diff ok gwk@@ tweaks and ok miod@@
@
text
@d1 1
a1 1
/*	$OpenBSD: conf.c,v 1.28 2006/03/27 06:15:24 deraadt Exp $ */
a53 3
#include "ofdisk.h"
bdev_decl(ofd);

a62 1
	bdev_disk_init(NOFDISK,ofd),	/* 4 Openfirmware disk */
a83 7
#include "ofcons.h"
cdev_decl(ofc);
cdev_decl(ofd);

#include "ofrtc.h"
cdev_decl(ofrtc);

d157 2
a158 2
	cdev_disk_init(NOFDISK,ofd),	/* 13 Openfirmware disk */
	cdev_tty_init(NOFCONS,ofc),	/* 14 Openfirmware console */
@


1.28
log
@put com(4) at cdevsw 26
@
text
@d1 1
a1 1
/*	$OpenBSD: conf.c,v 1.27 2005/11/16 03:43:40 deraadt Exp $ */
d152 1
d247 1
@


1.27
log
@macppc can have gpio
@
text
@d1 1
a1 1
/*	$OpenBSD: conf.c,v 1.26 2004/05/30 08:11:26 grange Exp $ */
d98 3
d179 2
a180 2
        cdev_apm_init(NAPM,apm),	/* 25: APM interface */
	cdev_notdef(),			/* 26 */
d347 1
@


1.26
log
@Devices hot plugging support.
The hotplug pseudo-device passes device attachment and detachment events
to userland.  When a device attaches or detaches, the corresponding event
is queued.  The events can then be obtained from the queue through the
read(2) call on the /dev/hotplug device file. Each event consists of
event type (attach/detach), device class (DV_*) and device name (sd1 e.g.).

We have hotplug pseudo-device on alpha, amd64, i386, macppc and sparc64.
Since it was tested only on i386 other archs has it commented out
in GENERIC until tested.

The idea liked peter@@ tedu@@ drahn@@ millert@@ marco@@ henning@@.
Ok deraadt@@.
@
text
@d1 1
a1 1
/*	$OpenBSD: conf.c,v 1.25 2004/02/10 01:31:21 millert Exp $ */
d148 1
d242 1
@


1.25
log
@Add the ptm device to pty(4).  By opening /dev/ptm and using the PTMGET
ioctl(2), an unprivileged process may allocate a pty and have its owner
and mode set appropriately.  This means that programs such as xterm and
screen no longer need to be setuid.  Programs using the openpty()
function require zero changes and will "just work".

Designed by beck@@ and deraadt@@; changes by beck@@ with cleanup (and
a rewrite of the vnode bits) by art@@ and tweaks/bugfixes by me.
Tested by many.
@
text
@d1 1
a1 1
/*	$OpenBSD: conf.c,v 1.24 2003/10/15 17:50:16 drahn Exp $ */
d147 1
d240 1
@


1.24
log
@The ANSI/KNF trail continues. No binary differences.
@
text
@d1 1
a1 1
/*	$OpenBSD: conf.c,v 1.23 2003/06/27 16:57:14 nate Exp $ */
d238 1
@


1.23
log
@kqueue support for various usb devices including: usb, uhid, ugen,
and uscanner
From NetBSD
@
text
@d1 1
a1 1
/*	$OpenBSD: conf.c,v 1.22 2003/05/14 00:20:37 tedu Exp $ */
d253 1
a253 2
iskmemdev(dev)
	dev_t dev;
d262 1
a262 2
iszerodev(dev)
	dev_t dev;
@


1.22
log
@add {b,c}devsw_lookup convenience functions.
move chrtoblk and blktochr into MI code.
tested on several archs and ok deraadt@@
@
text
@d1 1
a1 1
/*	$OpenBSD: conf.c,v 1.21 2002/12/05 02:49:55 kjc Exp $ */
d220 1
a220 1
	cdev_usbdev_init(NURIO,urio),	/* 65: USB Diamond Rio 500 */
@


1.21
log
@remove altq entries.
altq is merged into pf and handled through pf.
@
text
@d1 1
a1 1
/*	$OpenBSD: conf.c,v 1.20 2002/11/08 19:00:37 mickey Exp $ */
d275 1
a275 1
static int chrtoblktbl[] = {
d333 1
a333 36

/*
 * Return accompanying block dev for a char dev.
 */
int
chrtoblk(dev)
	dev_t dev;
{
	int blkmaj;

	if (major(dev) >= nchrdev ||
	    major(dev) > sizeof(chrtoblktbl)/sizeof(chrtoblktbl[0]))
		return (NODEV);
	blkmaj = chrtoblktbl[major(dev)];
	if (blkmaj == NODEV)
		return (NODEV);
	return (makedev(blkmaj, minor(dev)));
}

/*
 * Convert a character device number to a block device number.
 */
dev_t
blktochr(dev)
	dev_t dev;
{
	int blkmaj = major(dev);
	int i;

	if (blkmaj >= nblkdev)
		return (NODEV);
	for (i = 0; i < sizeof(chrtoblktbl)/sizeof(chrtoblktbl[0]); i++)
		if (blkmaj == chrtoblktbl[i])
			return (makedev(i, minor(dev)));
	return (NODEV);
}
@


1.20
log
@prepare for bktr on macppc (commented out in generic for now); drahn@@ ok
@
text
@d1 1
a1 1
/*	$OpenBSD: conf.c,v 1.19 2002/09/15 09:01:58 deraadt Exp $ */
a142 2
#include <altq/altqconf.h>

d233 1
a233 1
	cdev_altq_init(NALTQ,altq),	/* 72: ALTQ control interface */
@


1.19
log
@backout premature
@
text
@d1 1
a1 1
/*	$OpenBSD: conf.c,v 1.17 2002/09/06 13:56:51 drahn Exp $ */
d147 3
d238 2
@


1.18
log
@KNF
@
text
@d173 1
a173 1
	cdev_apm_init(NAPM,apm),	/* 25: APM interface */
@


1.17
log
@Serial console support for macppc. Serial console will work if the modem
has been replaced with a serial port adapter on any machine that has
a real serial port internally. This will also power on the internal modem
for keylargo based machines (tested on original PBG4) when the serial port
is open. ok miod@@
@
text
@d1 1
a1 1
/*	$OpenBSD: conf.c,v 1.16 2002/07/10 22:08:47 mickey Exp $ */
d173 1
a173 1
        cdev_apm_init(NAPM,apm),	/* 25: APM interface */
@


1.16
log
@proper cdev_decl(ksyms), fix ksyms's broken functions
@
text
@d1 1
a1 1
/*	$OpenBSD: conf.c,v 1.15 2002/06/24 19:00:33 mickey Exp $ */
d371 1
d377 3
@


1.15
log
@move cdev_decl() for usb devices into one place.
usage of cdev_decl() in the driver code is more tricky since i have
kqueue mods here and there and will fix that on that way through.
@
text
@d1 1
a1 1
/*	$OpenBSD: conf.c,v 1.14 2002/06/19 02:52:23 mickey Exp $ */
a119 1
cdev_decl(ksyms);
@


1.14
log
@using cdev_ugen_init for all sorts of usb devices is just one pint less wrong than using cdev_decl_random for the same purpose
@
text
@d1 1
a1 1
/*	$OpenBSD: conf.c,v 1.13 2002/06/11 03:43:46 miod Exp $ */
a121 1
cdev_decl(usb);
a122 1
cdev_decl(uhid);
a123 1
cdev_decl(ugen);
a124 1
cdev_decl(ulpt);
a125 1
cdev_decl(urio);
a126 1
cdev_decl(ucom);
a127 1
cdev_decl(uscanner);
@


1.13
log
@... but ucom can not be used as a console, oops. Me needs more booze.
@
text
@d1 1
a1 1
/*	$OpenBSD: conf.c,v 1.12 2002/06/11 03:39:50 miod Exp $ */
d225 1
a225 1
	cdev_ugen_init(NUGEN,ugen),	/* 63: USB generic driver */
d242 1
a242 1
	cdev_ugen_init(NUSCANNER,uscanner), /* 74: usb scanner */
@


1.12
log
@Correct com vs ucom cut-n-paste thinko.
@
text
@d1 1
a1 1
/*	$OpenBSD: conf.c,v 1.11 2002/06/07 07:13:31 miod Exp $ */
a378 1
cons_decl(ucom);
a386 3
#endif
#if NUCOM > 0
	cons_init(ucom),
@


1.11
log
@Move more function prototypes to <machine/conf.h> as cdev_decl(foo)
for safety.
@
text
@d1 1
a1 1
/*	$OpenBSD: conf.c,v 1.10 2002/05/16 21:11:15 miod Exp $ */
d379 1
a379 1
cons_decl(com);
d389 2
a390 2
#if NCOM > 0
	cons_init(com),
@


1.10
log
@Add systrace support to all the remaining architectures.

Tested by various people on various platforms, I'm willing to fix any
breakage this causes.

ok niels@@ deraadt@@ and mickey@@ (after his comments were applied)
@
text
@d1 1
a1 1
/*	$OpenBSD: conf.c,v 1.9 2001/12/12 19:19:17 jason Exp $ */
a138 1
cdev_decl(apm);
@


1.9
log
@add /dev/crypto support
@
text
@d1 1
a1 1
/*	$OpenBSD: conf.c,v 1.8 2001/12/11 23:19:02 miod Exp $ */
d154 2
d207 1
a207 1
	cdev_notdef(),			/* 50 */
@


1.9.2.1
log
@Sync UBC branch to -current
@
text
@d1 1
a1 1
/*	$OpenBSD: conf.c,v 1.9 2001/12/12 19:19:17 jason Exp $ */
d139 1
a153 2
#include "systrace.h"

d205 1
a205 1
	cdev_systrace_init(NSYSTRACE,systrace),	/* 50 system call tracing */
@


1.9.2.2
log
@sync to -current
@
text
@d1 1
a1 1
/*	$OpenBSD: conf.c,v 1.9.2.1 2002/06/11 03:36:34 art Exp $ */
d120 1
d122 1
d124 1
d126 1
d128 1
d130 1
d132 1
d134 1
d225 1
a225 1
	cdev_usbdev_init(NUGEN,ugen),	/* 63: USB generic driver */
d242 1
a242 1
	cdev_usbdev_init(NUSCANNER,uscanner), /* 74: usb scanner */
d379 1
a379 1
cons_decl(zs);
a385 3
#if NZSTTY > 0
	cons_init(zs),
#endif
d388 3
@


1.9.2.3
log
@sync
@
text
@d1 1
a1 1
/*	$OpenBSD$ */
d143 2
a146 3
#include "radio.h"
#include "bktr.h"

d232 1
a232 1
	cdev_notdef(),			/* 72: ALTQ (deprecated) */
a234 2
	cdev_bktr_init(NBKTR,bktr),	/* 75: Bt848 video capture device */
	cdev_radio_init(NRADIO, radio),	/* 76: generic radio I/O */
d272 1
a272 1
int chrtoblktbl[] = {
d330 36
a365 1
int nchrtoblktbl = sizeof(chrtoblktbl) / sizeof(chrtoblktbl[0]);
@


1.8
log
@Remove declarations that already exist in <sys/conf.h>
@
text
@d1 1
a1 1
/*	$OpenBSD: conf.c,v 1.7 2001/12/05 23:58:41 tdeval Exp $ */
d136 2
d202 1
a202 1
	cdev_notdef(),			/* 47 */
@


1.7
log
@Enable rootdev auto-configuration by device drivers during boot.
Add support for "raid" devices (prepare future raidframe changes).

OK deraadt@@, Reviewed by drahn@@, jason@@, mickey@@ and miod@@
@
text
@d1 1
a1 1
/*	$OpenBSD: conf.c,v 1.6 2001/11/06 23:46:05 drahn Exp $ */
a117 2

cdev_decl(lkm);
@


1.6
log
@Add USB scanner device node to macppc and i386, both of these had the
uscanner compiled into the kernel, but no device node, or even entry
in the character device switch table.
ok todd@@
@
text
@d1 1
a1 1
/*	$OpenBSD: conf.c,v 1.5 2001/10/03 14:45:37 drahn Exp $ */
d299 37
@


1.5
log
@apm support for macppc. This is not fully implemented, sleep modes
and power event are not handled, however it is enough support
to poll the battery/AC/charging states of the system.
Code by Alexander Guy.
@
text
@d1 1
a1 1
/*	$OpenBSD: conf.c,v 1.4 2001/09/28 03:14:20 mickey Exp $ */
d135 2
d241 1
@


1.5.4.1
log
@Sync the SMP branch to something just after 3.0
@
text
@d1 1
a1 1
/*	$OpenBSD$ */
@


1.5.4.2
log
@Merge in -current
@
text
@a134 2
#include "uscanner.h"
cdev_decl(uscanner);
a238 1
	cdev_ugen_init(NUSCANNER,uscanner), /* 74: usb scanner */
@


1.5.4.3
log
@Merge in trunk
@
text
@d119 2
a137 2
#include "inet.h"

d202 1
a202 1
	cdev_crypto_init(NCRYPTO,crypto), /* 47: /dev/crypto */
a298 37
	/* 18 */	NODEV,
	/* 19 */	NODEV,
	/* 20 */	NODEV,
	/* 21 */	NODEV,
	/* 22 */	NODEV,
	/* 23 */	NODEV,
	/* 24 */	NODEV,
	/* 25 */	NODEV,
	/* 26 */	NODEV,
	/* 27 */	NODEV,
	/* 28 */	NODEV,
	/* 29 */	NODEV,
	/* 30 */	NODEV,
	/* 31 */	NODEV,
	/* 32 */	NODEV,
	/* 33 */	NODEV,
	/* 34 */	NODEV,
	/* 35 */	NODEV,
	/* 36 */	NODEV,
	/* 37 */	NODEV,
	/* 38 */	NODEV,
	/* 39 */	NODEV,
	/* 40 */	NODEV,
	/* 41 */	NODEV,
	/* 42 */	NODEV,
	/* 43 */	NODEV,
	/* 44 */	NODEV,
	/* 45 */	NODEV,
	/* 46 */	NODEV,
	/* 47 */	NODEV,
	/* 48 */	NODEV,
	/* 49 */	NODEV,
	/* 50 */	NODEV,
	/* 51 */	NODEV,
	/* 52 */	NODEV,
	/* 53 */	NODEV,
	/* 54 */	19,
@


1.5.4.4
log
@Sync the SMP branch with 3.3
@
text
@d120 1
d122 1
d124 1
d126 1
d128 1
d130 1
d132 1
d134 1
d139 1
d152 1
a152 4
#include "systrace.h"

#include "radio.h"
#include "bktr.h"
d205 1
a205 1
	cdev_systrace_init(NSYSTRACE,systrace),	/* 50 system call tracing */
d224 1
a224 1
	cdev_usbdev_init(NUGEN,ugen),	/* 63: USB generic driver */
d239 1
a239 1
	cdev_notdef(),			/* 72: ALTQ (deprecated) */
d241 1
a241 3
	cdev_usbdev_init(NUSCANNER,uscanner), /* 74: usb scanner */
	cdev_bktr_init(NBKTR,bktr),	/* 75: Bt848 video capture device */
	cdev_radio_init(NRADIO, radio),	/* 76: generic radio I/O */
d378 1
a378 1
cons_decl(zs);
a384 3
#if NZSTTY > 0
	cons_init(zs),
#endif
d387 3
@


1.5.4.5
log
@merge the trunk so we will get the genfs and locking fixes
@
text
@d275 1
a275 1
int chrtoblktbl[] = {
d333 36
a368 1
int nchrtoblktbl = sizeof(chrtoblktbl) / sizeof(chrtoblktbl[0]);
@


1.5.4.6
log
@Merge of current from two weeks agointo the SMP branch
@
text
@d220 1
a220 1
	cdev_urio_init(NURIO,urio),	/* 65: USB Diamond Rio 500 */
d253 2
a254 1
iskmemdev(dev_t dev)
d263 2
a264 1
iszerodev(dev_t dev)
@


1.5.4.7
log
@Merge with the trunk
@
text
@a146 1
#include "hotplug.h"
a237 2
	cdev_ptm_init(NPTY,ptm),	/* 77: pseudo-tty ptm device */
	cdev_hotplug_init(NHOTPLUG,hotplug), /* 78: devices hot plugging */
@


1.4
log
@remove dups w/ conf.h
@
text
@d1 1
a1 1
/*	$OpenBSD: conf.c,v 1.3 2001/09/28 02:53:13 mickey Exp $ */
d136 3
d178 1
a178 1
	cdev_notdef(),			/* 25 */
@


1.3
log
@move cdev_decl(pf) into it's proper place, kill cdev_decl(ipl) at the same time
@
text
@d1 1
a1 1
/*	$OpenBSD: conf.c,v 1.2 2001/09/27 17:30:56 drahn Exp $ */
d6 1
a6 1
 * 
a36 1
#include <sys/conf.h>
d42 8
d52 1
a52 4
#include "sd.h"
bdev_decl(sd);
#include "cd.h"
bdev_decl(cd);
a56 3
#include "rd.h"
bdev_decl(rd);

a57 1
bdev_decl(vnd);
a58 1
bdev_decl(ccd);
a59 1
bdev_decl(raid);
d67 3
a69 3
	bdev_notdef(),                  /* 5 unknown*/
	bdev_notdef(),                  /* 6 unknown*/
	bdev_notdef(),                  /* 7 unknown*/
d77 1
a77 1
	bdev_notdef(),                  /* 15 unknown*/
d80 1
a80 1
	bdev_notdef(),                  /* 18 unknown*/
a84 5
cdev_decl(cn);
cdev_decl(ctty);
#define mmread	mmrw
#define	mmwrite	mmrw
cdev_decl(mm);
a85 8
#define	ptstty		ptytty
#define	ptsioctl	ptyioctl
cdev_decl(pts);
#define	ptctty		ptytty
#define	ptcioctl	ptyioctl
cdev_decl(ptc);
cdev_decl(log);

a86 1
cdev_decl(zs);
a94 1

a101 16
cdev_decl(wsdisplay);
cdev_decl(wskbd);
cdev_decl(wsmouse);

#include <sd.h>
#include <st.h>
#include <cd.h>
#include <uk.h>
#include <ss.h>
cdev_decl(st);  
cdev_decl(sd);
cdev_decl(cd);
cdev_decl(vnd);
cdev_decl(ccd);
cdev_decl(rd);  
#include "raid.h"
a103 5
#include <wd.h>
cdev_decl(wd);

dev_decl(filedesc,open);

a104 1
cdev_decl(bpf); 
a106 2
cdev_decl(tun);
cdev_decl(random); 
d117 2
a118 2
#endif  
 
a136 1
cdev_decl(wsmux);
a143 1
cdev_decl(audio);
d150 11
a160 11
        cdev_cn_init(1,cn),             /* 0: virtual console */
        cdev_ctty_init(1,ctty),         /* 1: controlling terminal */
        cdev_mm_init(1,mm),             /* 2: /dev/{null,mem,kmem,...} */
        cdev_swap_init(1,sw),           /* 3: /dev/drum (swap pseudo-device) */
        cdev_tty_init(NPTY,pts),        /* 4: pseudo-tty slave */
        cdev_ptc_init(NPTY,ptc),        /* 5: pseudo-tty master */
        cdev_log_init(1,log),           /* 6: /dev/klog */
        cdev_tty_init(NZSTTY,zs),    /* 7: mac onboard serial ports */ 
        cdev_disk_init(NSD,sd),         /* 8: SCSI disk */
        cdev_disk_init(NCD,cd),         /* 9: SCSI CD-ROM */
        cdev_notdef(),                  /* 10: SCSI changer */
d162 1
a162 1
        cdev_notdef(),                  /* 12 */
d164 3
a166 3
        cdev_tty_init(NOFCONS,ofc),	/* 14 Openfirmware console */
        cdev_notdef(),                  /* 15 */
        cdev_notdef(),                  /* 16 */
d169 22
a190 22
        cdev_disk_init(NVND,vnd),       /* 19: vnode disk */
        cdev_tape_init(NST,st),         /* 20: SCSI tape */
        cdev_fd_init(1,filedesc),       /* 21: file descriptor pseudo-dev */
        cdev_bpftun_init(NBPFILTER,bpf),/* 22: berkeley packet filter */
        cdev_bpftun_init(NTUN,tun),     /* 23: network tunnel */
        cdev_lkm_init(NLKM,lkm),        /* 24: loadable module driver */
        cdev_notdef(),                  /* 25 */
        cdev_notdef(),                  /* 26 */
        cdev_notdef(),                  /* 27 */
        cdev_notdef(),                  /* 28 */
        cdev_notdef(),                  /* 29 */
        cdev_notdef(),                  /* 30 */
        cdev_notdef(),                  /* 31 */
        cdev_notdef(),                  /* 32 */
        cdev_lkm_dummy(),               /* 33 */
        cdev_lkm_dummy(),               /* 34 */
        cdev_lkm_dummy(),               /* 35 */
        cdev_lkm_dummy(),               /* 36 */
        cdev_lkm_dummy(),               /* 37 */
        cdev_lkm_dummy(),               /* 38 */
        cdev_pf_init(NPF,pf),		/* 39: packet filter */
        cdev_random_init(1,random),     /* 40: random data source */
d192 1
a192 1
	cdev_ss_init(NSS,ss),           /* 42: SCSI scanner */
d194 7
a200 7
	cdev_audio_init(NAUDIO,audio),  /* 44: generic audio I/O */
        cdev_notdef(),                  /* 45 */
        cdev_notdef(),                  /* 46 */
        cdev_notdef(),                  /* 47 */
        cdev_notdef(),                  /* 48 */
        cdev_notdef(),                  /* 49 */ 
        cdev_notdef(),                  /* 50 */ 
d204 1
a204 1
        cdev_notdef(),                  /* 51 */
d206 2
a207 2
        cdev_notdef(),                  /* 52 */ 
        cdev_notdef(),                  /* 53 */ 
d209 1
a209 1
        cdev_notdef(),                  /* 55 */ 
d220 1
a220 1
	cdev_ulpt_init(NULPT,ulpt), 	/* 64: USB printers */
d230 1
a230 1
	cdev_pci_init(NPCI,pci),        /* 71: PCI user */
d303 1
a303 1
	
@


1.2
log
@When zs is fully working, it should be tty00 for macppc.
@
text
@d1 1
a1 1
/*	$OpenBSD: conf.c,v 1.1 2001/09/01 15:44:20 drahn Exp $ */
a188 1
cdev_decl(pf);
@


1.1
log
@The "powerpc" port which has supported the newer Apple Macintosh powerpc based
is being renamed to macppc. This is to allow sharing of common code
between different powerpc base platforms.

Most of the work involved in the renaming process was performed by miod@@

Files moved from powerpc/powerpc to macppc/macppc

This moves hardware specific files from the common directory to the
platform specific directory. This leaves common files.
With this change all of the debugger (db_) files have been moved to
the platform specific directory. The debugger should be reconsidered
and commonized.
@
text
@d1 1
a1 1
/*	$OpenBSD: conf.c,v 1.26 2001/08/06 22:34:44 mickey Exp $ */
d100 3
a102 2
#include "com.h"
cdev_decl(com);
d201 1
a201 1
	cdev_tty_init(NCOM,com),	/* 7: Serial ports */
@

