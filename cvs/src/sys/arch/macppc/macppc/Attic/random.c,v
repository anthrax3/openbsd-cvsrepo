head	1.3;
access;
symbols
	OPENBSD_3_9:1.2.0.10
	OPENBSD_3_9_BASE:1.2
	OPENBSD_3_8:1.2.0.8
	OPENBSD_3_8_BASE:1.2
	OPENBSD_3_7:1.2.0.6
	OPENBSD_3_7_BASE:1.2
	OPENBSD_3_6:1.2.0.4
	OPENBSD_3_6_BASE:1.2
	SMP_SYNC_A:1.2
	SMP_SYNC_B:1.2
	OPENBSD_3_5:1.2.0.2
	OPENBSD_3_5_BASE:1.2
	OPENBSD_3_4:1.1.0.14
	OPENBSD_3_4_BASE:1.1
	UBC_SYNC_A:1.1
	OPENBSD_3_3:1.1.0.12
	OPENBSD_3_3_BASE:1.1
	OPENBSD_3_2:1.1.0.10
	OPENBSD_3_2_BASE:1.1
	OPENBSD_3_1:1.1.0.8
	OPENBSD_3_1_BASE:1.1
	UBC_SYNC_B:1.1
	UBC:1.1.0.6
	UBC_BASE:1.1
	SMP:1.1.0.4
	OPENBSD_3_0:1.1.0.2
	OPENBSD_3_0_BASE:1.1;
locks; strict;
comment	@ * @;


1.3
date	2006.03.04.12.26.47;	author miod;	state dead;
branches;
next	1.2;

1.2
date	2003.10.15.17.50.16;	author drahn;	state Exp;
branches;
next	1.1;

1.1
date	2001.09.01.15.44.20;	author drahn;	state Exp;
branches
	1.1.4.1;
next	;

1.1.4.1
date	2001.10.31.03.01.16;	author nate;	state Exp;
branches;
next	1.1.4.2;

1.1.4.2
date	2004.02.19.10.49.04;	author niklas;	state Exp;
branches;
next	;


desc
@@


1.3
log
@Dead meat.
@
text
@/*	$OpenBSD: random.c,v 1.2 2003/10/15 17:50:16 drahn Exp $	*/

/*
 * Copyright (c) 1990,1993 The Regents of the University of California.
 * All rights reserved.
 *
 * Redistribution and use in source and binary forms, with or without
 * modification, are permitted provided that: (1) source code distributions
 * retain the above copyright notice and this paragraph in its entirety, (2)
 * distributions including binary code include the above copyright notice and
 * this paragraph in its entirety in the documentation or other materials
 * provided with the distribution, and (3) all advertising materials mentioning
 * features or use of this software display the following acknowledgement:
 * ``This product includes software developed by the University of California,
 * Lawrence Berkeley Laboratory and its contributors.'' Neither the name of
 * the University nor the names of its contributors may be used to endorse
 * or promote products derived from this software without specific prior
 * written permission.
 * THIS SOFTWARE IS PROVIDED ``AS IS'' AND WITHOUT ANY EXPRESS OR IMPLIED
 * WARRANTIES, INCLUDING, WITHOUT LIMITATION, THE IMPLIED WARRANTIES OF
 * MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE.
 *
 * Here is a very good random number generator.  This implementation is
 * based on ``Two Fast Implementations of the "Minimal Standard" Random
 * Number Generator'', David G. Carta, Communications of the ACM, Jan 1990,
 * Vol 33 No 1.  Do NOT modify this code unless you have a very thorough
 * understanding of the algorithm.  It's trickier than you think.  If
 * you do change it, make sure that its 10,000'th invocation returns
 * 1043618065.
 *
 * Here is easier-to-decipher pseudocode:
 *
 * p = (16807*seed)<30:0>	# e.g., the low 31 bits of the product
 * q = (16807*seed)<62:31>	# e.g., the high 31 bits starting at bit 32
 * if (p + q < 2^31)
 * 	seed = p + q
 * else
 *	seed = ((p + q) & (2^31 - 1)) + 1
 * return (seed);
 *
 * The result is in (0,2^31), e.g., it's always positive.
 */
#if 0
#include <machine/asm.h>

	.data
	.globl	_C_SYMBOL(_randseed)
_C_SYMBOL(_randseed):
	.long	1
	.text
ENTRY(random)
#	movl	#16807, d0
	lis	r5, 1
	ori	r5, r5, 0x6807
	lis	r4, _C_SYMBOL(_randseed)@@h
	lwz	r6, _C_SYMBOL(_randseed)@@l(r4)
#	mulsl	__randseed, d1:d0
	mulhw	r7, r6, r5
	mulhw	r8, r6, r5

#	lsll	#1, d0
#	roxll	#2, d1
#	addl	d1, d0
#	moveql	#1, d1
#	addxl	d1, d0
#	lsrl	#1, d0
	lis	r4, _C_SYMBOL(_randseed)@@h
	stw	r6, _C_SYMBOL(_randseed)@@l(r4)
#	movl	d0, __randseed
#	rts
#endif

extern int _randseed;
int
random()
{
	long long value;
	int p, q;
	value = 16807 * _randseed;
	p = value & (long long) (0xffffffff);
	q = (value >> 32) & (long long) (0xffffffff);
	if (((long long) p + q) < 0x3fffffff)
		_randseed = p + q;
	else
		_randseed = (int)(((long long)p + q ) & 0x3ffffffe) +1;
	return _randseed;
}
@


1.2
log
@The ANSI/KNF trail continues. No binary differences.
@
text
@d1 1
a1 1
/*	$OpenBSD: random.c,v 1.1 2001/09/01 15:44:20 drahn Exp $	*/
@


1.1
log
@The "powerpc" port which has supported the newer Apple Macintosh powerpc based
is being renamed to macppc. This is to allow sharing of common code
between different powerpc base platforms.

Most of the work involved in the renaming process was performed by miod@@

Files moved from powerpc/powerpc to macppc/macppc

This moves hardware specific files from the common directory to the
platform specific directory. This leaves common files.
With this change all of the debugger (db_) files have been moved to
the platform specific directory. The debugger should be reconsidered
and commonized.
@
text
@d1 1
a1 1
/*	$OpenBSD: random.c,v 1.2 1997/10/13 13:43:00 pefo Exp $	*/
d82 1
a82 1
	if (((long long) p + q) < 0x3fffffff) {
d84 1
a84 1
	} else {
a85 1
	}
@


1.1.4.1
log
@Sync the SMP branch to something just after 3.0
@
text
@d1 1
a1 1
/*	$OpenBSD$	*/
@


1.1.4.2
log
@Merge of current from two weeks agointo the SMP branch
@
text
@d82 1
a82 1
	if (((long long) p + q) < 0x3fffffff)
d84 1
a84 1
	else
d86 1
@


