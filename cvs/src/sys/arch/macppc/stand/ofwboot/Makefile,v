head	1.15;
access;
symbols
	OPENBSD_6_2:1.15.0.2
	OPENBSD_6_2_BASE:1.15
	OPENBSD_6_1:1.15.0.4
	OPENBSD_6_1_BASE:1.15
	OPENBSD_6_0:1.14.0.4
	OPENBSD_6_0_BASE:1.14
	OPENBSD_5_9:1.14.0.2
	OPENBSD_5_9_BASE:1.14
	OPENBSD_5_8:1.13.0.6
	OPENBSD_5_8_BASE:1.13
	OPENBSD_5_7:1.13.0.2
	OPENBSD_5_7_BASE:1.13
	OPENBSD_5_6:1.12.0.4
	OPENBSD_5_6_BASE:1.12
	OPENBSD_5_5:1.8.0.8
	OPENBSD_5_5_BASE:1.8
	OPENBSD_5_4:1.8.0.4
	OPENBSD_5_4_BASE:1.8
	OPENBSD_5_3:1.8.0.2
	OPENBSD_5_3_BASE:1.8
	OPENBSD_5_2:1.6.0.6
	OPENBSD_5_2_BASE:1.6
	OPENBSD_5_1_BASE:1.6
	OPENBSD_5_1:1.6.0.4
	OPENBSD_5_0:1.6.0.2
	OPENBSD_5_0_BASE:1.6
	OPENBSD_4_9:1.5.0.14
	OPENBSD_4_9_BASE:1.5
	OPENBSD_4_8:1.5.0.12
	OPENBSD_4_8_BASE:1.5
	OPENBSD_4_7:1.5.0.8
	OPENBSD_4_7_BASE:1.5
	OPENBSD_4_6:1.5.0.10
	OPENBSD_4_6_BASE:1.5
	OPENBSD_4_5:1.5.0.6
	OPENBSD_4_5_BASE:1.5
	OPENBSD_4_4:1.5.0.4
	OPENBSD_4_4_BASE:1.5
	OPENBSD_4_3:1.5.0.2
	OPENBSD_4_3_BASE:1.5
	OPENBSD_4_2:1.4.0.2
	OPENBSD_4_2_BASE:1.4
	OPENBSD_4_1:1.3.0.2
	OPENBSD_4_1_BASE:1.3
	OPENBSD_4_0:1.2.0.16
	OPENBSD_4_0_BASE:1.2
	OPENBSD_3_9:1.2.0.14
	OPENBSD_3_9_BASE:1.2
	OPENBSD_3_8:1.2.0.12
	OPENBSD_3_8_BASE:1.2
	OPENBSD_3_7:1.2.0.10
	OPENBSD_3_7_BASE:1.2
	OPENBSD_3_6:1.2.0.8
	OPENBSD_3_6_BASE:1.2
	SMP_SYNC_A:1.2
	SMP_SYNC_B:1.2
	OPENBSD_3_5:1.2.0.6
	OPENBSD_3_5_BASE:1.2
	OPENBSD_3_4:1.2.0.4
	OPENBSD_3_4_BASE:1.2
	UBC_SYNC_A:1.2
	OPENBSD_3_3:1.2.0.2
	OPENBSD_3_3_BASE:1.2
	OPENBSD_3_2:1.1.0.10
	OPENBSD_3_2_BASE:1.1
	OPENBSD_3_1:1.1.0.8
	OPENBSD_3_1_BASE:1.1
	UBC_SYNC_B:1.1
	UBC:1.1.0.6
	UBC_BASE:1.1
	SMP:1.1.0.4
	OPENBSD_3_0:1.1.0.2
	OPENBSD_3_0_BASE:1.1;
locks; strict;
comment	@# @;


1.15
date	2016.07.30.03.25.49;	author guenther;	state Exp;
branches;
next	1.14;
commitid	HVbAtwruDlJazNH2;

1.14
date	2015.09.11.17.46.59;	author miod;	state Exp;
branches;
next	1.13;
commitid	fdrgl1YuFtIXTSU4;

1.13
date	2014.11.19.20.02.50;	author miod;	state Exp;
branches;
next	1.12;
commitid	qjwuT3sbEm4uQclC;

1.12
date	2014.07.13.21.13.30;	author jasper;	state Exp;
branches;
next	1.11;
commitid	XVPxlsOLlre2AbHp;

1.11
date	2014.07.13.20.53.35;	author miod;	state Exp;
branches;
next	1.10;
commitid	COX1WMAllGSCPe6y;

1.10
date	2014.07.13.09.26.08;	author jasper;	state Exp;
branches;
next	1.9;
commitid	Cnjup0HpCIRrcQ6o;

1.9
date	2014.07.12.21.54.58;	author jasper;	state Exp;
branches;
next	1.8;
commitid	3HeD4LaLGiS22I3y;

1.8
date	2012.09.02.23.07.26;	author deraadt;	state Exp;
branches;
next	1.7;

1.7
date	2012.08.21.14.46.19;	author pascal;	state Exp;
branches;
next	1.6;

1.6
date	2011.07.08.08.49.53;	author drahn;	state Exp;
branches;
next	1.5;

1.5
date	2007.11.25.18.25.32;	author deraadt;	state Exp;
branches;
next	1.4;

1.4
date	2007.06.13.02.17.32;	author drahn;	state Exp;
branches;
next	1.3;

1.3
date	2006.12.05.20.30.27;	author gwk;	state Exp;
branches;
next	1.2;

1.2
date	2003.01.31.20.06.32;	author drahn;	state Exp;
branches;
next	1.1;

1.1
date	2001.09.01.15.34.13;	author drahn;	state Exp;
branches
	1.1.4.1
	1.1.6.1;
next	;

1.1.4.1
date	2001.10.31.03.01.17;	author nate;	state Exp;
branches;
next	1.1.4.2;

1.1.4.2
date	2003.03.27.23.29.46;	author niklas;	state Exp;
branches;
next	;

1.1.6.1
date	2003.05.19.21.49.43;	author tedu;	state Exp;
branches;
next	;


desc
@@


1.15
log
@Prep for relro: make sure it's off for any non-PIE stand/ program

ok millert@@ kettenis@@
@
text
@#	$OpenBSD: Makefile,v 1.14 2015/09/11 17:46:59 miod Exp $
#	$NetBSD: Makefile,v 1.2 1997/04/17 07:46:24 thorpej Exp $

S=	${.CURDIR}/../../../..
R=../

PROG=		ofwboot
CFLAGS+=	-D_STANDALONE
SRCS=		Locore.c main.c ofdev.c net.c netif_of.c netudp.c
SRCS+=		alloc.c cache.c hfs.c
SRCS+=		boot.c conf.c cmd.c vars.c ctime.c strtol.c
.PATH:		${S}/arch/macppc/stand
SRCS+=		ofwmagic.S
#CFLAGS+=	-DDEBUG -DNETIF_DEBUG
CFLAGS+=	-fno-pie
NOMAN=
STRIPFLAG=
BINMODE=	444
OBJCOPY?=	objcopy
SAREL=
BINDIR=         /usr/mdec

.PATH:          ${S}/stand/boot
.PATH:          ${S}/lib/libsa

.PATH:		${S}/lib/libkern/arch/powerpc ${S}/lib/libkern
SRCS+=		getchar.c strlcpy.c memcpy.c strlen.c strrchr.c \
		strlcat.c ashrdi3.c
SRCS+=		moddi3.c

NEWVERSWHAT=	"OpenFirmware Boot"

# For now...
RELOC=		20000

ENTRY=		_start

CPPFLAGS+=	-I. -I${.CURDIR}/../../.. -I${.CURDIR}/../../../..
CPPFLAGS+=	-DRELOC=0x${RELOC} -DCONSPEED=57600

LIBS!=          cd $(.CURDIR)/$(R); $(MAKE) libdep

${PROG}: ${OBJS} ${LIBSA} ${LIBZ}
	${LD} -nopie -znorelro -N -X -Ttext ${RELOC} -e ${ENTRY} -o ${PROG} \
	    ${OBJS} ${LIBS}

.include <bsd.prog.mk>
@


1.14
log
@Build actual boot code with -D_STANDALONE so that we do not include userland
headers by mistake.
@
text
@d1 1
a1 1
#	$OpenBSD: Makefile,v 1.13 2014/11/19 20:02:50 miod Exp $
d44 1
a44 1
	${LD} -nopie -N -X -Ttext ${RELOC} -e ${ENTRY} -o ${PROG} \
@


1.13
log
@Add netudp.c here too for consistency, even though this code ends up not being
referenced by the bootblocks.
@
text
@d1 1
a1 1
#	$OpenBSD: Makefile,v 1.12 2014/07/13 21:13:30 jasper Exp $
d8 1
@


1.12
log
@more hanging tabs
@
text
@d1 1
a1 1
#	$OpenBSD: Makefile,v 1.11 2014/07/13 20:53:35 miod Exp $
d8 2
a9 1
SRCS=		Locore.c main.c ofdev.c net.c netif_of.c alloc.c cache.c hfs.c
@


1.11
log
@No libsa putchar wanted here actually
@
text
@d1 1
a1 1
#	$OpenBSD: Makefile,v 1.10 2014/07/13 09:26:08 jasper Exp $
d26 1
a26 1
		strlcat.c ashrdi3.c 
@


1.10
log
@move putchar() into libsa

"sure" miod@@
@
text
@d1 1
a1 1
#	$OpenBSD: Makefile,v 1.9 2014/07/12 21:54:58 jasper Exp $
d25 1
a25 1
SRCS+=		getchar.c putchar.c strlcpy.c memcpy.c strlen.c strrchr.c \
@


1.9
log
@move getchar() into libsa where applicable

ok miod@@
@
text
@d1 1
a1 1
#	$OpenBSD: Makefile,v 1.8 2012/09/02 23:07:26 deraadt Exp $
d25 2
a26 1
SRCS+=		getchar.c strlcpy.c memcpy.c strlen.c strrchr.c strlcat.c ashrdi3.c
@


1.8
log
@Allow bootblocks to build in PIE; joint effort with pascal
boot.mac might still have a problem since it did change size...
looking for a testing report.
@
text
@d1 1
a1 1
#	$OpenBSD: Makefile,v 1.7 2012/08/21 14:46:19 pascal Exp $
d25 1
a25 1
SRCS+=		strlcpy.c memcpy.c strlen.c strrchr.c strlcat.c ashrdi3.c
@


1.7
log
@Add NOPIE= bits for sys/arch/*/stand to ensure that bootblocks will always be
built with -fno-pie.  This gets the hairiest part of PIE out of the way ...

ok deraadt@@
@
text
@d1 1
a1 1
#	$OpenBSD: Makefile,v 1.6 2011/07/08 08:49:53 drahn Exp $
d13 1
a14 1
NOPIE=
d41 1
a41 1
	${LD} -N -X -Ttext ${RELOC} -e ${ENTRY} -o ${PROG} \
@


1.6
log
@Unbreak macppc bootloader due to libz changes.
@
text
@d1 1
a1 1
#	$OpenBSD: Makefile,v 1.5 2007/11/25 18:25:32 deraadt Exp $
d14 1
@


1.5
log
@libkern, begone.  Move to a new mechanism where config(8)'s "file"
directive can select between MI and MD versions of these files.  At
the same time, adjust the boot programs to pick exactly what they need,
instead of the 7 or 8 mechanisms previously used.

There will be some fallout from this, but testing it all by myself is a
ridiculously slow process; it will be finished in-tree.

Various developers were very nice and avoided making fun of me when I
was gibbering in the corner..
@
text
@d1 1
a1 1
#	$OpenBSD: Makefile,v 1.4 2007/06/13 02:17:32 drahn Exp $
d25 1
@


1.4
log
@Switch macppc to the interactive bootloader in stand/boot.
Much more useable on serial console systems.
@
text
@d1 1
a1 1
#	$OpenBSD: Makefile,v 1.3 2006/12/05 20:30:27 gwk Exp $
d23 3
d38 1
a38 1
${PROG}: ${OBJS} ${LIBSA} ${LIBZ} ${LIBKERN}
@


1.3
log
@Import fixcoff from NetBSD and make some changes to boot.mac Makefile and
ofwboot including loosing some meanigless defines and repurposing
XCOFF_GLUE to my own ends. These changes make it possible to boot the
OpenBSD kernel on at least the Power Macintosh 9500 and 9600. No binary
change in stripped ofwboot.
ok drahn@@, martin@@
@
text
@d1 1
a1 1
#	$OpenBSD: Makefile,v 1.2 2003/01/31 20:06:32 drahn Exp $
d8 2
a9 1
SRCS=		Locore.c boot.c ofdev.c net.c netif_of.c alloc.c cache.c hfs.c
d20 3
d31 1
a31 1
CPPFLAGS+=	-DRELOC=0x${RELOC}
@


1.2
log
@Change how the bootloader links to get around size/start address issues
introduced by W^X. exe size goes back to  60640 from 126456.
@
text
@d1 1
a1 1
#	$OpenBSD: Makefile,v 1.1 2001/09/01 15:34:13 drahn Exp $
a27 3
CPPFLAGS+=	-DFIRMWORKSBUGS
CPPFLAGS+=	-DPOWERPC_BOOT_ELF
CPPFLAGS+=	-DXCOFF_GLUE		# for booting PCI Powermacs
@


1.1
log
@The "powerpc" port which has supported the newer Apple Macintosh powerpc based
is being renamed to macppc. This is to allow sharing of common code
between different powerpc base platforms.

Most of the work involved in the renaming process was performed by miod@@

Files moved from powerpc/stand/ofwboot to macppc/stand/ofwboot
@
text
@d1 1
a1 1
#	$OpenBSD: Makefile,v 1.4 2001/02/09 05:20:52 drahn Exp $
d22 1
a22 1
RELOC=		20074
d35 1
a35 1
	${LD} -X -Ttext ${RELOC} -e ${ENTRY} -o ${PROG} \
@


1.1.6.1
log
@sync
@
text
@d1 1
a1 1
#	$OpenBSD$
d22 1
a22 1
RELOC=		20000
d35 1
a35 1
	${LD} -N -X -Ttext ${RELOC} -e ${ENTRY} -o ${PROG} \
@


1.1.4.1
log
@Sync the SMP branch to something just after 3.0
@
text
@d1 1
a1 1
#	$OpenBSD$
@


1.1.4.2
log
@Sync the SMP branch with 3.3
@
text
@d22 1
a22 1
RELOC=		20000
d35 1
a35 1
	${LD} -N -X -Ttext ${RELOC} -e ${ENTRY} -o ${PROG} \
@


