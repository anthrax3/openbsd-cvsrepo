head	1.13;
access;
symbols
	OPENBSD_6_2:1.13.0.2
	OPENBSD_6_2_BASE:1.13
	OPENBSD_6_1:1.13.0.4
	OPENBSD_6_1_BASE:1.13
	OPENBSD_6_0:1.12.0.12
	OPENBSD_6_0_BASE:1.12
	OPENBSD_5_9:1.12.0.8
	OPENBSD_5_9_BASE:1.12
	OPENBSD_5_8:1.12.0.10
	OPENBSD_5_8_BASE:1.12
	OPENBSD_5_7:1.12.0.2
	OPENBSD_5_7_BASE:1.12
	OPENBSD_5_6:1.12.0.6
	OPENBSD_5_6_BASE:1.12
	OPENBSD_5_5:1.12.0.4
	OPENBSD_5_5_BASE:1.12
	OPENBSD_5_4:1.10.0.4
	OPENBSD_5_4_BASE:1.10
	OPENBSD_5_3:1.10.0.2
	OPENBSD_5_3_BASE:1.10
	OPENBSD_5_2:1.9.0.10
	OPENBSD_5_2_BASE:1.9
	OPENBSD_5_1_BASE:1.9
	OPENBSD_5_1:1.9.0.8
	OPENBSD_5_0:1.9.0.6
	OPENBSD_5_0_BASE:1.9
	OPENBSD_4_9:1.9.0.4
	OPENBSD_4_9_BASE:1.9
	OPENBSD_4_8:1.9.0.2
	OPENBSD_4_8_BASE:1.9
	OPENBSD_4_7:1.8.0.8
	OPENBSD_4_7_BASE:1.8
	OPENBSD_4_6:1.8.0.10
	OPENBSD_4_6_BASE:1.8
	OPENBSD_4_5:1.8.0.6
	OPENBSD_4_5_BASE:1.8
	OPENBSD_4_4:1.8.0.4
	OPENBSD_4_4_BASE:1.8
	OPENBSD_4_3:1.8.0.2
	OPENBSD_4_3_BASE:1.8
	OPENBSD_4_2:1.7.0.8
	OPENBSD_4_2_BASE:1.7
	OPENBSD_4_1:1.7.0.6
	OPENBSD_4_1_BASE:1.7
	OPENBSD_4_0:1.7.0.4
	OPENBSD_4_0_BASE:1.7
	OPENBSD_3_9:1.7.0.2
	OPENBSD_3_9_BASE:1.7
	OPENBSD_3_8:1.6.0.2
	OPENBSD_3_8_BASE:1.6
	OPENBSD_3_7:1.5.0.4
	OPENBSD_3_7_BASE:1.5
	OPENBSD_3_6:1.5.0.2
	OPENBSD_3_6_BASE:1.5
	SMP_SYNC_A:1.4
	SMP_SYNC_B:1.4
	OPENBSD_3_5:1.4.0.2
	OPENBSD_3_5_BASE:1.4
	OPENBSD_3_4:1.3.0.4
	OPENBSD_3_4_BASE:1.3
	UBC_SYNC_A:1.3
	OPENBSD_3_3:1.3.0.2
	OPENBSD_3_3_BASE:1.3
	OPENBSD_3_2:1.2.0.10
	OPENBSD_3_2_BASE:1.2
	OPENBSD_3_1:1.2.0.8
	OPENBSD_3_1_BASE:1.2
	UBC_SYNC_B:1.2
	UBC:1.2.0.6
	UBC_BASE:1.2
	SMP:1.2.0.4
	OPENBSD_3_0:1.2.0.2
	OPENBSD_3_0_BASE:1.2;
locks; strict;
comment	@# @;


1.13
date	2016.11.06.16.04.20;	author tb;	state Exp;
branches;
next	1.12;
commitid	tupV2UpHQlnB6RWH;

1.12
date	2013.10.27.04.49.52;	author deraadt;	state Exp;
branches;
next	1.11;

1.11
date	2013.10.18.13.59.00;	author miod;	state Exp;
branches;
next	1.10;

1.10
date	2012.09.02.23.07.24;	author deraadt;	state Exp;
branches;
next	1.9;

1.9
date	2010.05.14.19.50.00;	author drahn;	state Exp;
branches;
next	1.8;

1.8
date	2007.11.26.10.26.02;	author deraadt;	state Exp;
branches;
next	1.7;

1.7
date	2005.12.30.02.03.49;	author millert;	state Exp;
branches;
next	1.6;

1.6
date	2005.05.14.16.40.27;	author drahn;	state Exp;
branches;
next	1.5;

1.5
date	2004.07.13.21.03.38;	author marc;	state Exp;
branches;
next	1.4;

1.4
date	2004.01.09.16.50.30;	author drahn;	state Exp;
branches;
next	1.3;

1.3
date	2002.12.02.09.00.24;	author miod;	state Exp;
branches;
next	1.2;

1.2
date	2001.10.03.17.10.06;	author drahn;	state Exp;
branches
	1.2.4.1
	1.2.6.1;
next	1.1;

1.1
date	2001.09.01.15.39.02;	author drahn;	state Exp;
branches;
next	;

1.2.4.1
date	2001.10.31.03.01.16;	author nate;	state Exp;
branches;
next	1.2.4.2;

1.2.4.2
date	2003.03.27.23.29.46;	author niklas;	state Exp;
branches;
next	1.2.4.3;

1.2.4.3
date	2004.02.19.10.49.04;	author niklas;	state Exp;
branches;
next	;

1.2.6.1
date	2003.05.19.21.49.43;	author tedu;	state Exp;
branches;
next	;


desc
@@


1.13
log
@Do not create machine@@ symlinks in obj as root during includes:, but
defer their creation to later, so that they are owned by BUILDUSER.
This eliminates the last root-owned files in obj/ from 'make build'.
In addition, place a MACHINE == hppa test in hppa/stand/Makefile.inc
to avoid creating bogus symlinks on all other archs.

joint work with & ok natano, "let's try it" deraadt
@
text
@#	$OpenBSD: Makefile.inc,v 1.12 2013/10/27 04:49:52 deraadt Exp $
#	$NetBSD: Makefile.inc,v 1.1 1996/09/30 16:34:59 ws Exp $

.if !defined(__stand_makefile_inc)
__stand_makefile_inc=1

KERN_AS=	library

S=$(.CURDIR)/../../../$(R)

.if !make(clean) && !make(cleandir) && !make(includes) && !make(libdep) && \
    !make(sadep) && !make(salibdir) && !make(obj) && !defined(NOMACHINE)
.BEGIN:
	@@([ -h machine ] || ln -s $(S)/arch/$(MACHINE)/include machine)
.endif

#
EXTRACFLAGS=	-msoft-float
REAL_VIRT?=	-v
ENTRY?=	_start

INCLUDES+=	-I. -I$(.OBJDIR) -I$(.CURDIR)/.. -I$(S)/arch -I$(S)
INCLUDES+=	-I$(S)/lib/libsa
DEFS+=		-DSTANDALONE
CFLAGS+=	$(INCLUDES) $(DEFS) $(EXTRACFLAGS)
CFLAGS+=	-fno-stack-protector
CFLAGS+=	-fno-builtin -fno-pie
AFLAGS+=	-fno-pie
LDFLAGS?=	-X -N -Ttext $(RELOC) -e $(ENTRY)

cleandir:
	rm -rf lib machine

.endif
@


1.12
log
@build the manual pages on all architectures
@
text
@d1 1
a1 1
#	$OpenBSD: Makefile.inc,v 1.11 2013/10/18 13:59:00 miod Exp $
d11 2
a12 1
.if !make(libdep) && !make(sadep) && !make(salibdir) && !make(obj) && !defined(NOMACHINE)
@


1.11
log
@Add a proper MANSUBDIR, to have manpages install in the proper directory.
@
text
@d1 1
a1 1
#	$OpenBSD: Makefile.inc,v 1.10 2012/09/02 23:07:24 deraadt Exp $
a33 2

MANSUBDIR=macppc
@


1.10
log
@Allow bootblocks to build in PIE; joint effort with pascal
boot.mac might still have a problem since it did change size...
looking for a testing report.
@
text
@d1 1
a1 1
#	$OpenBSD: Makefile.inc,v 1.9 2010/05/14 19:50:00 drahn Exp $
d34 2
@


1.9
log
@avoid builtins completely, so avoid possible issues with gcc4.
@
text
@d1 1
a1 1
#	$OpenBSD: Makefile.inc,v 1.8 2007/11/26 10:26:02 deraadt Exp $
d26 2
a27 1
CFLAGS+=	-fno-builtin
@


1.8
log
@few more dribbles of LIBKERN cleanup
@
text
@d1 1
a1 1
#	$OpenBSD: Makefile.inc,v 1.7 2005/12/30 02:03:49 millert Exp $
d26 1
a26 1
CFLAGS+=	-fno-builtin-vprintf -fno-builtin-printf -fno-builtin-putchar
@


1.7
log
@Now that errno.h and sys/errno.h are separate header files there is no
need to use the -Derrno=errno workaround added when __errno() was
introduced.  OK deraadt@@
@
text
@d1 1
a1 1
#	$OpenBSD: Makefile.inc,v 1.6 2005/05/14 16:40:27 drahn Exp $
d11 1
a11 1
.if !make(libdep) && !make(sadep) && !make(salibdir) && !make(kernlibdir) && !make(obj) && !defined(NOMACHINE)
@


1.6
log
@Remove bogus #define, no binary difference.
@
text
@d1 1
a1 1
#	$OpenBSD: Makefile.inc,v 1.5 2004/07/13 21:03:38 marc Exp $
d23 1
a23 1
DEFS+=		-DSTANDALONE -Derrno=errno
@


1.5
log
@errno changes, lib major version bumps, and general flag day
To build you must:
cd /usr/src && make obj && make includes
cd lib/libc && make depend && make && NOMAN=1 sudo make install
cd /usr/src && make build
@
text
@d1 1
a1 1
#	$OpenBSD: Makefile.inc,v 1.4 2004/01/09 16:50:30 drahn Exp $
d23 1
a23 1
DEFS+=		-DSTANDALONE -DFIREPOWERBUGS -Derrno=errno
@


1.4
log
@fix build for gcc3.
@
text
@d1 1
a1 1
#	$OpenBSD: Makefile.inc,v 1.3 2002/12/02 09:00:24 miod Exp $
d23 1
a23 1
DEFS+=		-DSTANDALONE -DFIREPOWERBUGS
@


1.3
log
@Import propolice (http://www.trl.ibm.com/projects/security/ssp), a stack
attack protection scheme, into gcc.

This protection is enabled by default. It can be turned off by using the
-fno-stack-protector flag.

Code by Hiroaki Etoh (etoh at jp dot ibm dot com); work on openbsd-specific
integration by fgsch@@, deraadt@@ and myself; tests by fgsch@@, naddy@@ and
myself; beer drinking by myself.

Please note that system upgrades with this new code will require a new
libc and ld.so to be build and installed before the propolice-enabled
compiler can be installed.
@
text
@d1 1
a1 1
#	$OpenBSD: Makefile.inc,v 1.2 2001/10/03 17:10:06 drahn Exp $
d26 1
@


1.2
log
@Install the bsd.tbxi data file. millert@@ ok.
@
text
@d1 1
a1 1
#	$OpenBSD: Makefile.inc,v 1.1 2001/09/01 15:39:02 drahn Exp $
d25 1
@


1.2.6.1
log
@sync
@
text
@d1 1
a1 1
#	$OpenBSD$
a24 1
CFLAGS+=	-fno-stack-protector
@


1.2.4.1
log
@Sync the SMP branch to something just after 3.0
@
text
@d1 1
a1 1
#	$OpenBSD$
@


1.2.4.2
log
@Sync the SMP branch with 3.3
@
text
@a24 1
CFLAGS+=	-fno-stack-protector
@


1.2.4.3
log
@Merge of current from two weeks agointo the SMP branch
@
text
@a25 1
CFLAGS+=	-fno-builtin-vprintf -fno-builtin-printf -fno-builtin-putchar
@


1.1
log
@The "powerpc" port which has supported the newer Apple Macintosh powerpc based
is being renamed to macppc. This is to allow sharing of common code
between different powerpc base platforms.

Most of the work involved in the renaming process was performed by miod@@

Files moved from powerpc/stand to macppc/stand
@
text
@d1 1
a1 1
#	$OpenBSD: Makefile.inc,v 1.4 2001/06/23 01:53:01 drahn Exp $
d11 1
a11 1
.if !make(libdep) && !make(sadep) && !make(salibdir) && !make(kernlibdir) && !make(obj)
@

