head	1.14;
access;
symbols
	OPENBSD_6_1:1.14.0.4
	OPENBSD_6_1_BASE:1.14
	OPENBSD_6_0:1.13.0.4
	OPENBSD_6_0_BASE:1.13
	OPENBSD_5_9:1.13.0.2
	OPENBSD_5_9_BASE:1.13
	OPENBSD_5_8:1.12.0.6
	OPENBSD_5_8_BASE:1.12
	OPENBSD_5_7:1.12.0.2
	OPENBSD_5_7_BASE:1.12
	OPENBSD_5_6:1.11.0.4
	OPENBSD_5_6_BASE:1.11
	OPENBSD_5_5:1.9.0.4
	OPENBSD_5_5_BASE:1.9
	OPENBSD_5_4:1.7.0.4
	OPENBSD_5_4_BASE:1.7
	OPENBSD_5_3:1.7.0.2
	OPENBSD_5_3_BASE:1.7
	OPENBSD_5_2:1.5.0.6
	OPENBSD_5_2_BASE:1.5
	OPENBSD_5_1_BASE:1.5
	OPENBSD_5_1:1.5.0.4
	OPENBSD_5_0:1.5.0.2
	OPENBSD_5_0_BASE:1.5
	OPENBSD_4_9:1.4.0.14
	OPENBSD_4_9_BASE:1.4
	OPENBSD_4_8:1.4.0.12
	OPENBSD_4_8_BASE:1.4
	OPENBSD_4_7:1.4.0.8
	OPENBSD_4_7_BASE:1.4
	OPENBSD_4_6:1.4.0.10
	OPENBSD_4_6_BASE:1.4
	OPENBSD_4_5:1.4.0.6
	OPENBSD_4_5_BASE:1.4
	OPENBSD_4_4:1.4.0.4
	OPENBSD_4_4_BASE:1.4
	OPENBSD_4_3:1.4.0.2
	OPENBSD_4_3_BASE:1.4
	OPENBSD_4_2:1.3.0.2
	OPENBSD_4_2_BASE:1.3
	OPENBSD_4_1:1.2.0.2
	OPENBSD_4_1_BASE:1.2
	OPENBSD_4_0:1.1.0.26
	OPENBSD_4_0_BASE:1.1
	OPENBSD_3_9:1.1.0.24
	OPENBSD_3_9_BASE:1.1
	OPENBSD_3_8:1.1.0.22
	OPENBSD_3_8_BASE:1.1
	OPENBSD_3_7:1.1.0.20
	OPENBSD_3_7_BASE:1.1
	OPENBSD_3_6:1.1.0.18
	OPENBSD_3_6_BASE:1.1
	SMP_SYNC_A:1.1
	SMP_SYNC_B:1.1
	OPENBSD_3_5:1.1.0.16
	OPENBSD_3_5_BASE:1.1
	OPENBSD_3_4:1.1.0.14
	OPENBSD_3_4_BASE:1.1
	UBC_SYNC_A:1.1
	OPENBSD_3_3:1.1.0.12
	OPENBSD_3_3_BASE:1.1
	OPENBSD_3_2:1.1.0.10
	OPENBSD_3_2_BASE:1.1
	OPENBSD_3_1:1.1.0.8
	OPENBSD_3_1_BASE:1.1
	UBC_SYNC_B:1.1
	UBC:1.1.0.6
	UBC_BASE:1.1
	SMP:1.1.0.4
	OPENBSD_3_0:1.1.0.2
	OPENBSD_3_0_BASE:1.1;
locks; strict;
comment	@# @;


1.14
date	2016.07.30.03.25.49;	author guenther;	state Exp;
branches;
next	1.13;
commitid	HVbAtwruDlJazNH2;

1.13
date	2015.09.11.17.46.59;	author miod;	state Exp;
branches;
next	1.12;
commitid	fdrgl1YuFtIXTSU4;

1.12
date	2014.11.19.20.02.46;	author miod;	state Exp;
branches;
next	1.11;
commitid	qjwuT3sbEm4uQclC;

1.11
date	2014.07.13.21.11.40;	author deraadt;	state Exp;
branches;
next	1.10;
commitid	r42sAnOnafSeUTju;

1.10
date	2014.07.13.13.07.30;	author miod;	state Exp;
branches;
next	1.9;
commitid	0yrol5UtJmkfpLCv;

1.9
date	2013.10.27.04.49.54;	author deraadt;	state Exp;
branches;
next	1.8;

1.8
date	2013.10.14.11.51.09;	author mpi;	state Exp;
branches;
next	1.7;

1.7
date	2012.09.02.23.07.26;	author deraadt;	state Exp;
branches;
next	1.6;

1.6
date	2012.08.21.14.46.19;	author pascal;	state Exp;
branches;
next	1.5;

1.5
date	2011.07.08.08.49.53;	author drahn;	state Exp;
branches;
next	1.4;

1.4
date	2007.11.25.18.25.32;	author deraadt;	state Exp;
branches;
next	1.3;

1.3
date	2007.06.13.02.17.32;	author drahn;	state Exp;
branches;
next	1.2;

1.2
date	2006.12.05.20.30.26;	author gwk;	state Exp;
branches;
next	1.1;

1.1
date	2001.09.01.15.36.37;	author drahn;	state Exp;
branches
	1.1.4.1;
next	;

1.1.4.1
date	2001.10.31.03.01.16;	author nate;	state Exp;
branches;
next	;


desc
@@


1.14
log
@Prep for relro: make sure it's off for any non-PIE stand/ program

ok millert@@ kettenis@@
@
text
@#	$OpenBSD: Makefile,v 1.13 2015/09/11 17:46:59 miod Exp $
#       $NetBSD: Makefile,v 1.1 1996/09/30 16:35:05 ws Exp $

S=      ${.CURDIR}/../../../..
R=              ..
.PATH:          $(.CURDIR)/$(R)
RELOC=		E00000
ENTRY=		_entry
NOMAN=
PROG=           boot.mac
CFLAGS+=	-D_STANDALONE
SRCS=           Locore.c main.c ofdev.c net.c netif_of.c netudp.c
SRCS+=		alloc.c cache.c hfs.c
SRCS+=          boot.c conf.c cmd.c vars.c ctime.c strtol.c

INSTALL_STRIP=
BINDIR=         /usr/mdec
OBJCOPY?=	objcopy
OBJCOPY_ARGS=	-O aixcoff-rs6000 -R .comment -R .note
LDFLAGS=	-nopie -znorelro -X -Ttext ${RELOC} -e $(ENTRY)
LDFLAGS+=	-T ${.CURDIR}/elf32_powerpc_merge.x -Bstatic

.PATH:          ${S}/stand/boot
.PATH:          ${S}/lib/libsa
SRCS+=		getchar.c

.PATH:		${S}/lib/libkern/arch/powerpc ${S}/lib/libkern
SRCS+=		strlcpy.c memcpy.c strlen.c strrchr.c strlcat.c ashrdi3.c
SRCS+=		moddi3.c

CPPFLAGS+=	-I. -I${.CURDIR}/../../.. -I${.CURDIR}/../../../..
CPPFLAGS+=	-DRELOC=0x${RELOC} -DCONSPEED=57600
# for booting PCI Powermacs
CPPFLAGS+=	-DXCOFF_GLUE
CFLAGS+=	-fno-pie

LIBS!=          cd $(.CURDIR)/$(R); $(MAKE) libdep
CLEANFILES=	fixcoff

$(PROG):        $(OBJS) $(LIBS) fixcoff 
	$(LD) $(LDFLAGS) $(OBJS) $(LIBS) -o ${.TARGET}
	${OBJCOPY} ${OBJCOPY_ARGS} ${.TARGET}
	${.OBJDIR}/fixcoff ${.TARGET}

fixcoff:	fixcoff.c
	${HOSTCC} -I${.CURDIR} -o fixcoff ${.CURDIR}/fixcoff.c

.include <bsd.prog.mk>
@


1.13
log
@Build actual boot code with -D_STANDALONE so that we do not include userland
headers by mistake.
@
text
@d1 1
a1 1
#	$OpenBSD: Makefile,v 1.12 2014/11/19 20:02:46 miod Exp $
d20 1
a20 1
LDFLAGS=	-nopie -X -Ttext ${RELOC} -e $(ENTRY)
@


1.12
log
@Add netudp.c here too for consistency, even though this code ends up not being
referenced by the bootblocks.
@
text
@d1 1
a1 1
#	$OpenBSD: Makefile,v 1.11 2014/07/13 21:11:40 deraadt Exp $
d11 1
@


1.11
log
@ugly hanging tabs; ok jasper
@
text
@d1 1
a1 1
#	$OpenBSD: Makefile,v 1.10 2014/07/13 13:07:30 miod Exp $
d11 2
a12 1
SRCS=           Locore.c main.c ofdev.c net.c netif_of.c alloc.c cache.c hfs.c
@


1.10
log
@Needs getchar.c now
@
text
@d1 1
a1 1
#	$OpenBSD: Makefile,v 1.9 2013/10/27 04:49:54 deraadt Exp $
d7 1
a7 1
RELOC=		E00000				
d31 2
a32 1
CPPFLAGS+=	-DXCOFF_GLUE		# for booting PCI Powermacs
@


1.9
log
@build the manual pages on all architectures
@
text
@d1 1
a1 1
#	$OpenBSD: Makefile,v 1.8 2013/10/14 11:51:09 mpi Exp $
d23 1
@


1.8
log
@Add a boot(8) manual, issue reported by landry@@

ok jmc@@
@
text
@d1 1
a1 1
#	$OpenBSD: Makefile,v 1.7 2012/09/02 23:07:26 deraadt Exp $
d9 1
a13 2
MAN?=   	boot.8
MLINKS?=	boot.8 boot.conf.5
@


1.7
log
@Allow bootblocks to build in PIE; joint effort with pascal
boot.mac might still have a problem since it did change size...
looking for a testing report.
@
text
@d1 1
a1 1
#	$OpenBSD: Makefile,v 1.6 2012/08/21 14:46:19 pascal Exp $
d13 2
a14 1
NOMAN=
@


1.6
log
@Add NOPIE= bits for sys/arch/*/stand to ensure that bootblocks will always be
built with -fno-pie.  This gets the hairiest part of PIE out of the way ...

ok deraadt@@
@
text
@d1 1
a1 1
#	$OpenBSD: Makefile,v 1.5 2011/07/08 08:49:53 drahn Exp $
d18 2
a19 2
LDFLAGS=	-X -Ttext ${RELOC} -e $(ENTRY) -T ${.CURDIR}/elf32_powerpc_merge.x -Bstatic
NOPIE=
d31 1
@


1.5
log
@Unbreak macppc bootloader due to libz changes.
@
text
@d1 1
a1 1
#	$OpenBSD: Makefile,v 1.4 2007/11/25 18:25:32 deraadt Exp $
d19 1
@


1.4
log
@libkern, begone.  Move to a new mechanism where config(8)'s "file"
directive can select between MI and MD versions of these files.  At
the same time, adjust the boot programs to pick exactly what they need,
instead of the 7 or 8 mechanisms previously used.

There will be some fallout from this, but testing it all by myself is a
ridiculously slow process; it will be finished in-tree.

Various developers were very nice and avoided making fun of me when I
was gibbering in the corner..
@
text
@d1 1
a1 1
#	$OpenBSD: Makefile,v 1.3 2007/06/13 02:17:32 drahn Exp $
d25 1
@


1.3
log
@Switch macppc to the interactive bootloader in stand/boot.
Much more useable on serial console systems.
@
text
@d1 1
a1 1
#	$OpenBSD: Makefile,v 1.2 2006/12/05 20:30:26 gwk Exp $
d22 3
@


1.2
log
@Import fixcoff from NetBSD and make some changes to boot.mac Makefile and
ofwboot including loosing some meanigless defines and repurposing
XCOFF_GLUE to my own ends. These changes make it possible to boot the
OpenBSD kernel on at least the Power Macintosh 9500 and 9600. No binary
change in stripped ofwboot.
ok drahn@@, martin@@
@
text
@d1 1
a1 1
#	$OpenBSD: Makefile,v 1.1 2001/09/01 15:36:37 drahn Exp $
d4 1
d10 3
a12 1
SRCS=           Locore.c boot.c ofdev.c net.c netif_of.c alloc.c cache.c hfs.c
d20 3
d24 1
a24 1
CPPFLAGS+=	-DRELOC=0x${RELOC}
@


1.1
log
@The "powerpc" port which has supported the newer Apple Macintosh powerpc based
is being renamed to macppc. This is to allow sharing of common code
between different powerpc base platforms.

Most of the work involved in the renaming process was performed by miod@@

Files moved from powerpc/stand/boot.mac to macppc/stand/boot.mac
These files are the bootloader for the older Openfirmware, not currently
supported.
@
text
@d1 1
a1 1
#	$OpenBSD: Makefile,v 1.8 2001/06/23 01:53:02 drahn Exp $
d6 1
a6 1
RELOC=		6c0000
a9 1
CFLAGS+=        -DDEBUG -DNETIF_DEBUG
d14 2
a15 2
OBJCOPY_ARGS=	-O aixcoff-rs6000 -R .stab -R .stabstr -R .comment
LDFLAGS=	-X -Ttext ${RELOC} -e $(ENTRY) -T ${.CURDIR}/ld.script
a18 2
CPPFLAGS+=	-DFIRMWORKSBUGS
CPPFLAGS+=	-DPOWERPC_BOOT_ELF
a20 1

d22 1
a22 1
CLEANFILES=	hack-coff
d24 1
a24 1
$(PROG):        $(OBJS) $(LIBS) hack-coff
d27 1
a27 1
	${.OBJDIR}/hack-coff ${.TARGET}
d29 2
a30 2
hack-coff:	hack-coff.c
	${HOSTCC} -I${.CURDIR} -o hack-coff ${.CURDIR}/hack-coff.c
@


1.1.4.1
log
@Sync the SMP branch to something just after 3.0
@
text
@d1 1
a1 1
#	$OpenBSD$
@

