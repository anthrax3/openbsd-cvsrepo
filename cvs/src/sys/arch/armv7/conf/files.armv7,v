head	1.32;
access;
symbols
	OPENBSD_6_1:1.32.0.4
	OPENBSD_6_1_BASE:1.32
	OPENBSD_6_0:1.19.0.2
	OPENBSD_6_0_BASE:1.19
	OPENBSD_5_9:1.14.0.2
	OPENBSD_5_9_BASE:1.14
	OPENBSD_5_8:1.13.0.4
	OPENBSD_5_8_BASE:1.13
	OPENBSD_5_7:1.10.0.2
	OPENBSD_5_7_BASE:1.10
	OPENBSD_5_6:1.10.0.4
	OPENBSD_5_6_BASE:1.10
	OPENBSD_5_5:1.9.0.4
	OPENBSD_5_5_BASE:1.9;
locks; strict;
comment	@# @;


1.32
date	2017.03.09.20.13.12;	author kettenis;	state Exp;
branches;
next	1.31;
commitid	CkEwCKLYncBrvKsS;

1.31
date	2017.01.25.10.14.40;	author jsg;	state Exp;
branches;
next	1.30;
commitid	W3BvAHxrMCafa4lm;

1.30
date	2017.01.21.10.58.15;	author reyk;	state Exp;
branches;
next	1.29;
commitid	swIiw8mtZ7Pk0W3t;

1.29
date	2017.01.03.19.57.01;	author kettenis;	state Exp;
branches;
next	1.28;
commitid	fs9AbY79UEfLzZyj;

1.28
date	2016.10.09.23.46.23;	author jsg;	state Exp;
branches;
next	1.27;
commitid	81NzNvE8jnVEgl5T;

1.27
date	2016.10.07.07.24.21;	author patrick;	state Exp;
branches;
next	1.26;
commitid	eJsivTm30QlTa4mh;

1.26
date	2016.08.31.16.19.40;	author jsg;	state Exp;
branches;
next	1.25;
commitid	hkMa4gzwtj49TUef;

1.25
date	2016.08.21.21.38.05;	author kettenis;	state Exp;
branches;
next	1.24;
commitid	m5uJ5zANvBBfdHRi;

1.24
date	2016.08.15.13.42.49;	author patrick;	state Exp;
branches;
next	1.23;
commitid	8OAWl0pWWtbE7YFk;

1.23
date	2016.08.13.10.58.45;	author kettenis;	state Exp;
branches;
next	1.22;
commitid	JypjBQNbThVyA5ra;

1.22
date	2016.08.07.17.46.36;	author kettenis;	state Exp;
branches;
next	1.21;
commitid	LdQbmNEKiIg0u5Hd;

1.21
date	2016.08.06.17.16.13;	author kettenis;	state Exp;
branches;
next	1.20;
commitid	f8M9x4OMN0qpsCVL;

1.20
date	2016.07.30.08.07.01;	author kettenis;	state Exp;
branches;
next	1.19;
commitid	teUDtJsNAbvKtKTN;

1.19
date	2016.05.23.00.05.35;	author deraadt;	state Exp;
branches;
next	1.18;
commitid	Lca4at0KuB1ho5Xb;

1.18
date	2016.05.21.21.24.36;	author kettenis;	state Exp;
branches;
next	1.17;
commitid	JypHiPUuFFLvJ1DT;

1.17
date	2016.05.02.08.15.55;	author patrick;	state Exp;
branches;
next	1.16;
commitid	SxPSz6lxaCE62Tnc;

1.16
date	2016.04.24.00.57.23;	author patrick;	state Exp;
branches;
next	1.15;
commitid	LnsUZ9pocLJscsAz;

1.15
date	2016.04.03.12.44.37;	author patrick;	state Exp;
branches;
next	1.14;
commitid	Ced5UDHDtOXkTk5C;

1.14
date	2016.01.08.15.54.13;	author jcs;	state Exp;
branches;
next	1.13;
commitid	kI4H556ZKYkRQGw5;

1.13
date	2015.06.08.06.33.16;	author jsg;	state Exp;
branches;
next	1.12;
commitid	TKnNVNES86I6ApFq;

1.12
date	2015.05.27.00.06.14;	author jsg;	state Exp;
branches;
next	1.11;
commitid	G6QP18Ap4gF8hOTp;

1.11
date	2015.05.19.03.30.54;	author jsg;	state Exp;
branches;
next	1.10;
commitid	l6xI4SC4UUe6il2U;

1.10
date	2014.07.11.21.54.37;	author tedu;	state Exp;
branches;
next	1.9;
commitid	0n9cIGBISFAEt4b1;

1.9
date	2013.11.06.19.03.07;	author syl;	state Exp;
branches;
next	1.8;

1.8
date	2013.11.04.14.07.16;	author deraadt;	state Exp;
branches;
next	1.7;

1.7
date	2013.10.30.20.20.23;	author syl;	state Exp;
branches;
next	1.6;

1.6
date	2013.10.27.03.06.25;	author aalm;	state Exp;
branches;
next	1.5;

1.5
date	2013.10.23.17.08.47;	author jasper;	state Exp;
branches;
next	1.4;

1.4
date	2013.10.22.13.22.20;	author jasper;	state Exp;
branches;
next	1.3;

1.3
date	2013.09.06.20.45.53;	author patrick;	state Exp;
branches;
next	1.2;

1.2
date	2013.09.05.11.48.42;	author patrick;	state Exp;
branches;
next	1.1;

1.1
date	2013.09.04.14.38.25;	author patrick;	state Exp;
branches;
next	;


desc
@@


1.32
log
@Provide access to our registers through the regmap interface.

ok patrick@@
@
text
@#	$OpenBSD: files.armv7,v 1.31 2017/01/25 10:14:40 jsg Exp $

maxpartitions	16
maxusers	2 8 64

major	{wd = 16}
major	{sd = 24}
major	{cd = 26}
major	{rd = 18}

file	arch/arm/arm/conf.c

#interrupt API layer
file	arch/armv7/armv7/intr.c

# CPU support and integrated peripherals
file	arch/arm/arm/irq_dispatch.S
file	arch/arm/arm/softintr.c

# Generic MD files
file	arch/armv7/armv7/armv7.c
file	arch/armv7/armv7/armv7_machdep.c
file	arch/armv7/armv7/autoconf.c
file	arch/armv7/armv7/platform.c
file	arch/arm/arm/disksubr.c			disk

# FDT support
file	dev/ofw/ofw_clock.c
file	dev/ofw/ofw_gpio.c
file	dev/ofw/ofw_misc.c
file	dev/ofw/ofw_pinctrl.c
file	dev/ofw/ofw_regulator.c

include "dev/sdmmc/files.sdmmc"

# Media Independent Interface (mii)
include "dev/mii/files.mii"

# Machine-independent HID support
include "dev/hid/files.hid"

# Machine-independent I2C drivers
include "dev/i2c/files.i2c"

# Machine-independent SCSI drivers
include "scsi/files.scsi"
include "dev/atapiscsi/files.atapiscsi"

# Machine-independent ATA drivers
include "dev/ata/files.ata"

# Include WSCONS stuff
include "dev/wscons/files.wscons"
include "dev/rasops/files.rasops"
include "dev/wsfont/files.wsfont"

# Include USB stuff
include "dev/usb/files.usb"

# Paravirtual device bus and virtio
include "dev/pv/files.pv"

# PCI bus
include "dev/pci/files.pci"

# Machine-independent GPIO drivers
include "dev/gpio/files.gpio"

# Machine-independent 1-Wire drivers
include "dev/onewire/files.onewire"

# Machine-independent FDT drivers
include "dev/fdt/files.fdt"

# SoC includes
include "arch/armv7/imx/files.imx"
include "arch/armv7/omap/files.omap"
include "arch/armv7/sunxi/files.sunxi"
include "arch/armv7/exynos/files.exynos"
include "arch/armv7/vexpress/files.vexpress"
include "arch/armv7/broadcom/files.broadcom"
include "arch/armv7/marvell/files.marvell"

# Console related stuff
attach	com at fdt with com_fdt
file	arch/armv7/dev/com_fdt.c		com_fdt

# ARM PrimeCell PL011 UART
device	pluart
attach	pluart at fdt
file	arch/armv7/dev/pluart.c			pluart
@


1.31
log
@Move psci(4) and plrtc(4) so arm64 can use them.
Tested by and ok patrick@@
@
text
@d1 1
a1 1
#	$OpenBSD: files.armv7,v 1.30 2017/01/21 10:58:15 reyk Exp $
d30 1
@


1.30
log
@Move virtio config from files.pci to files.pci

virtio itself is not PCI, it is a paravirtual bus on top of either PCI
or MMIO (arm).  This is the first step of moving the virtio files to
dev/pv.  No functional change.

arm kernel changes tested by jsg@@ and patrick@@
no objections from sf@@ mlarkin@@
@
text
@d1 1
a1 1
#	$OpenBSD: files.armv7,v 1.29 2017/01/03 19:57:01 kettenis Exp $
a90 9

# ARM PrimeCell PL031 Real-time clock
device	plrtc
attach	plrtc at fdt
file	arch/armv7/dev/plrtc.c			plrtc

device	psci
attach	psci at fdt
file	arch/armv7/dev/psci.c			psci
@


1.29
log
@Add simplefb(4), a driver to support the framebuffer set up by the firmware
on some platforms that use device trees.  Works on Allwinner (sunxi) and
should also work on Raspberry Pi (broadcom) armv7 platforms.

ok jsg@@, visa@@
@
text
@d1 1
a1 1
#	$OpenBSD: files.armv7,v 1.28 2016/10/09 23:46:23 jsg Exp $
d59 4
a62 1
# PCI and virtio
@


1.28
log
@Add psci(4) a driver for the reset and power down portion of the
ARM Power State Coordination Interface (PSCI) specification.

Tested with qemu-system-arm -M virt.

Feedback from patrick@@, ok kettenis@@ tom@@
@
text
@d1 1
a1 1
#	$OpenBSD: files.armv7,v 1.27 2016/10/07 07:24:21 patrick Exp $
d67 3
@


1.27
log
@Add a driver for the Marvell Armada 380 core clock.  This driver
provides information about the four big clocks that are part of
this SoC.  Attach it early as the serial console needs it and the
core clock is after the console in the device tree.

ok kettenis@@
@
text
@d1 1
a1 1
#	$OpenBSD: files.armv7,v 1.26 2016/08/31 16:19:40 jsg Exp $
d90 4
@


1.26
log
@pl011 and pl031 are licenseable peripherals from arm present in multiple socs.
Move the pluart and plrtc drivers for them out of the vexpress directory
and into dev to reflect this and rename the files to match the driver names.

discussed with patrick and kettenis
@
text
@d1 1
a1 1
#	$OpenBSD: files.armv7,v 1.25 2016/08/21 21:38:05 kettenis Exp $
d75 1
@


1.25
log
@Add a minimal clock "framework".  Build it on armv7.

ok patrick@@
@
text
@d1 1
a1 1
#	$OpenBSD: files.armv7,v 1.24 2016/08/15 13:42:49 patrick Exp $
d79 10
@


1.24
log
@Move the com(4) fdt attachment driver to a more generic location and
rename it to fit the typical scheme of such an attachment driver.

ok kettenis@@ jsg@@
@
text
@d1 1
a1 1
#	$OpenBSD: files.armv7,v 1.23 2016/08/13 10:58:45 kettenis Exp $
d28 1
@


1.23
log
@Build ofw_regulator.o.
@
text
@d1 1
a1 1
#	$OpenBSD: files.armv7,v 1.22 2016/08/07 17:46:36 kettenis Exp $
d74 4
@


1.22
log
@Initial support for Raspberry Pi 2/3.  All the hard work done by patrick@@, I
just cleaned things up a bit.  Any bugs introduced in that process are
entirely mine.

This doesn't work yet.  But when it does, you'll need recent firmware from
the Raspberry Pi Foundation git repository at

  https://github.com/raspberrypi/firmware

The device tree for the Raspberry Pi is somewhat in flux as bits and pieces
to support the Raspberry Pi 2 and 3 are committed to the mainline Linux
kernel.
@
text
@d1 1
a1 1
#	$OpenBSD: files.armv7,v 1.21 2016/08/06 17:16:13 kettenis Exp $
d30 1
@


1.21
log
@Build ofw_pinctrl.o and ofw_gpio.o on armv7.  The latters here from the
generic arm files list.  There is no point in building it on armish or
zaurus.

ok patrick@@
@
text
@d1 1
a1 1
#	$OpenBSD: files.armv7,v 1.20 2016/07/30 08:07:01 kettenis Exp $
d72 1
@


1.20
log
@Stop pretending we can still boot without an FDT.  Remove the code paths
handling ATAGS and cleanup the early boot code.

ok patrick@@, tom@@, jsg@@
@
text
@d1 1
a1 1
#	$OpenBSD: files.armv7,v 1.19 2016/05/23 00:05:35 deraadt Exp $
d26 4
@


1.19
log
@Change openprom into a pseudo-device, because not all arm platforms
will have it.  This is a bit of a hack.  Maybe it should attach off
mainbus as a proper fake device, but that would have more tendrils..
checked by jsg
@
text
@d1 1
a1 1
#	$OpenBSD: files.armv7,v 1.18 2016/05/21 21:24:36 kettenis Exp $
a14 3

# u-boot argument support
file	arch/armv7/armv7/uboot_tags.c
@


1.18
log
@Implement openprom(4) for armv7.

ok deraadt@@
@
text
@d1 1
a1 1
#	$OpenBSD: files.armv7,v 1.17 2016/05/02 08:15:55 patrick Exp $
a28 1
file	arch/arm/arm/openprom.c
@


1.17
log
@Rework mainbus and implement simplebus to be able to span a tree-like
topology based on device tree information.  Introduce a common attach
args structure to be used for all fdt-capable bus devices.

ok jsg@@ kettenis@@
@
text
@d1 1
a1 1
#	$OpenBSD: files.armv7,v 1.16 2016/04/24 00:57:23 patrick Exp $
d29 1
@


1.16
log
@New FDT-enabled busses will use a new "fdt" attribute.  Unfortunately
this attribute is currently already defined.  This define is only used
to disable the unused FDT functionality in the exynos and virtio code.
As the FDT code will be developed in a different manner than the way
those drivers are written today and the functionality has never been
enabled, simply remove the attribute and its users.

ok jsg@@
@
text
@d1 1
a1 1
#	$OpenBSD: files.armv7,v 1.15 2016/04/03 12:44:37 patrick Exp $
a9 3

define	fdt {}
file	dev/ofw/fdt.c
@


1.15
log
@Map the bootconfig/FDT area passed by u-boot and try to init FDT on it.
If we were passed an FDT, we can completely map the tree and later on
copy it somewhere in our control, so it's not overwritten by anything.

If we are passed a device tree, we need to grab the information we
otherwise would get from the bootinfo struct in another way.  We can use
the /memory node to parse the machine's memory information.  Bootargs are
stored in /chosen's bootargs property.

This allows us to boot up like before using the board id, but now also
allows us to make use of device tree information.

ok jsg@@
@
text
@d1 1
a1 1
#	$OpenBSD: files.armv7,v 1.14 2016/01/08 15:54:13 jcs Exp $
a11 1
file	arch/armv7/fdt/fdt_machdep.c	fdt	needs-flag
@


1.14
log
@Move HID support files out of dev/usb into new dev/hid directory

These files aren't USB-specific and were used by the previous
Bluetooth implementation, and will be used by the upcoming
HID-over-i2C implementation

ok deraadt
previous version ok kettenis and mpi
@
text
@d1 1
a1 1
#	$OpenBSD: files.armv7,v 1.13 2015/06/08 06:33:16 jsg Exp $
d13 1
@


1.13
log
@Add initial support for the ARM Versatile Express boards as emulated by
qemu with virtio memory ranges.

Unfortunately the vexpress-a9 and vexpress-a15 boards/targets have
different load addresses and memory maps.

Code for the PL011 UART and mmio virtio attachment from Patrick Wildt
in bitrig.
@
text
@d1 1
a1 1
#	$OpenBSD: files.armv7,v 1.12 2015/05/27 00:06:14 jsg Exp $
d37 3
@


1.12
log
@make the exynos code compile without fdt
ok bmercer@@
@
text
@d1 1
a1 1
#	$OpenBSD: files.armv7,v 1.11 2015/05/19 03:30:54 jsg Exp $
d56 3
d70 1
@


1.11
log
@Abstract the soc_machdep.c functions to allow a kernel to be built for
multiple socs.

From Patrick Wildt in bitrig with some additional changes.
@
text
@d1 1
a1 1
#	$OpenBSD: files.armv7,v 1.10 2014/07/11 21:54:37 tedu Exp $
d11 3
d66 1
@


1.10
log
@"It's not the years, honey; it's the mileage."

bluetooth support doesn't work and isn't going anywhere. the current
design is a dead end, and should not be the basis for any future support.
general consensus says to whack it so as to not mislead the unwary.
@
text
@d1 1
a1 1
#	$OpenBSD: files.armv7,v 1.9 2013/11/06 19:03:07 syl Exp $
d27 1
@


1.9
log
@After factorizing armv7_machdep code here is an effort to factorize all
the code present in omap/omap.c imx/imx.c and sunxi/sunxi.c

All this code looks quite the same, so we move it in a generic armv7/armv7.c

This is a step closer to only one kernel for all armv7 boards.

ok patrick@@, rapha@@
@
text
@d1 1
a1 1
#	$OpenBSD: files.armv7,v 1.8 2013/11/04 14:07:16 deraadt Exp $
a50 3

# Bluetooth
include "dev/bluetooth/files.bluetooth"
@


1.8
log
@remove iop(4) driver.  it is entirely unmaintained and supports something
which basically doesn't exist at all.
reminded about it by brad
@
text
@d1 1
a1 1
#	$OpenBSD: files.armv7,v 1.7 2013/10/30 20:20:23 syl Exp $
d24 1
@


1.7
log
@Put all the generic machdep code in armv7_machedep.c

Cleanup the machdep code removing:
- useless includes
- useless globals and prototypes
- useless #if 0 and #if 1
- some style(9) issues

This commit will make the bringup of new SoC easier.

ok patrick@@ jasper@@ rapha@@
@
text
@d1 1
a1 1
#	$OpenBSD: files.armv7,v 1.6 2013/10/27 03:06:25 aalm Exp $
a41 3

# Machine-independent I2O drivers.
include "dev/i2o/files.i2o"
@


1.6
log
@enable gpioctl(8) for armv7, and add associated devices on armv7/sunxi.

ok jasper@@, patrick@@, rapha@@
@
text
@d1 1
a1 1
#	$OpenBSD: files.armv7,v 1.5 2013/10/23 17:08:47 jasper Exp $
d24 1
@


1.5
log
@rename 'allwinner' to 'sunxi' to actually match the SoC name instead of using
the vendor to follow our naming convention.

ok aalm@@ patrick@@
@
text
@d1 1
a1 1
#	$OpenBSD: files.armv7,v 1.4 2013/10/22 13:22:20 jasper Exp $
d58 3
@


1.4
log
@add support for allwinner-based devices (A1x/A20), such as the cubieboard;
any rough edges will be polished intree.

hard work done by Artturi Alm w/ feedback/input from Markus Hennecke,
patrick@@ and various others.
@
text
@d1 1
a1 1
#	$OpenBSD: files.armv7,v 1.3 2013/09/06 20:45:53 patrick Exp $
a59 1
include "arch/armv7/allwinner/files.allwinner"
d62 1
@


1.3
log
@Support for FreeScale's i.MX6 SoC.
@
text
@d1 1
a1 1
#	$OpenBSD: files.armv7,v 1.2 2013/09/05 11:48:42 patrick Exp $
d60 1
@


1.2
log
@Split the files file into a generic one for armv7, and soc-specific ones.
Also, rename the bus omap devices attach to to a soc-specific one,
so that we can have more than one soc.
In the future there should be only one generic bus where soc drivers
attach.
@
text
@d1 1
a1 1
#	$OpenBSD: files.armv7,v 1.1 2013/09/04 14:38:25 patrick Exp $
d60 1
@


1.1
log
@In the future, we shouldn't have one port port ARM SoC, that's just
ridiculous.  This is the first step for a common and generic ARM port
for ARMv7 SoCs.
@
text
@d1 1
a1 4
#	$OpenBSD: files.beagle,v 1.19 2013/06/11 19:19:43 rapha Exp $
#
# First try for arm-specific configuration info
#
a12 2
file	arch/armv7/omap/beagle_machdep.c

d19 3
a21 2
# note that the order of the devices in _this_ file
# affects the order that the devices will configure.
d23 3
a25 8
# XXX arch/arm/omap
define soc {}
device omap: soc
attach omap at mainbus
file	arch/armv7/omap/omap.c			omap
file	arch/armv7/omap/omap3.c			omap
file	arch/armv7/omap/omap4.c			omap
file	arch/armv7/omap/am335x.c		omap
a28 4
device ommmc: sdmmcbus
attach ommmc at soc
file	arch/armv7/omap/ommmc.c			ommmc

d32 2
a33 59
device cpsw: ether, ifnet, mii, ifmedia
attach cpsw at soc
file	arch/armv7/omap/if_cpsw.c		cpsw

device prcm
attach prcm at soc
file	arch/armv7/omap/prcm.c			prcm

device sitaracm
attach sitaracm at soc
file	arch/armv7/omap/am335x_cm_padconf.c	sitaracm
file	arch/armv7/omap/sitara_cm.c		sitaracm

device omgpio
attach omgpio at soc
file   arch/armv7/omap/omgpio.c			omgpio

device intc
attach intc at soc
file	arch/armv7/omap/intc.c			intc

device gptimer
attach gptimer at soc
file	arch/armv7/omap/gptimer.c		gptimer

device dmtimer
attach dmtimer at soc
file	arch/armv7/omap/dmtimer.c		dmtimer

device omapid
attach omapid at soc
file	arch/armv7/omap/omapid.c		omapid

device omdog
attach omdog at soc
file	arch/armv7/omap/omdog.c			omdog

attach ohci at soc with omohci
file	arch/armv7/omap/omohci.c		omohci

attach ehci at soc with omehci
file	arch/armv7/omap/omehci.c		omehci

# NS16550 compatible serial ports
attach	com at soc with com_omap
file	arch/armv7/omap/omap_com.c		com_omap

device omusbtll
attach omusbtll at soc
file arch/armv7/omap/omusbtll.c			omusbtll

device omkbd: wskbddev
attach omkbd at soc
file	arch/armv7/omap/omkbd.c			omkbd

# LCD frame buffer
device omdisplay: wsemuldisplaydev, rasops16
attach omdisplay at soc
file arch/armv7/omap/omdisplay.c		omdisplay
a34 1
#
a35 1
#
a38 15
# CPU support and integrated peripherals
file	arch/arm/arm/irq_dispatch.S
file	arch/arm/arm/softintr.c

# MCSPI - spi 
device mcspi 
attach mcspi at soc
file	arch/armv7/omap/mcspi.c			mcspi

# pseudo-Audio Device Driver
device oaudio: audio
attach oaudio at soc				# configure after Atlas Driver
file arch/armv7/omap/beagle_audio.c		oaudio

#
a39 1
#
a41 12
# Generic MD files
file	arch/armv7/armv7/autoconf.c

file	arch/arm/arm/disksubr.c			disk


# ARM FPE
file	arch/arm/fpe-arm/armfpe_glue.S		armfpe
file	arch/arm/fpe-arm/armfpe_init.c		armfpe
file	arch/arm/fpe-arm/armfpe.s		armfpe


a55 1
#
a56 1
#
d58 3
@

