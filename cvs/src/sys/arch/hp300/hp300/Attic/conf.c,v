head	1.56;
access;
symbols
	OPENBSD_5_5:1.55.0.6
	OPENBSD_5_5_BASE:1.55
	OPENBSD_5_4:1.55.0.2
	OPENBSD_5_4_BASE:1.55
	OPENBSD_5_3:1.54.0.2
	OPENBSD_5_3_BASE:1.54
	OPENBSD_5_2:1.53.0.4
	OPENBSD_5_2_BASE:1.53
	OPENBSD_5_1_BASE:1.53
	OPENBSD_5_1:1.53.0.2
	OPENBSD_5_0:1.51.0.4
	OPENBSD_5_0_BASE:1.51
	OPENBSD_4_9:1.51.0.2
	OPENBSD_4_9_BASE:1.51
	OPENBSD_4_8:1.48.0.2
	OPENBSD_4_8_BASE:1.48
	OPENBSD_4_7:1.46.0.2
	OPENBSD_4_7_BASE:1.46
	OPENBSD_4_6:1.45.0.4
	OPENBSD_4_6_BASE:1.45
	OPENBSD_4_5:1.44.0.2
	OPENBSD_4_5_BASE:1.44
	OPENBSD_4_4:1.43.0.2
	OPENBSD_4_4_BASE:1.43
	OPENBSD_4_3:1.41.0.4
	OPENBSD_4_3_BASE:1.41
	OPENBSD_4_2:1.41.0.2
	OPENBSD_4_2_BASE:1.41
	OPENBSD_4_1:1.38.0.6
	OPENBSD_4_1_BASE:1.38
	OPENBSD_4_0:1.38.0.4
	OPENBSD_4_0_BASE:1.38
	OPENBSD_3_9:1.38.0.2
	OPENBSD_3_9_BASE:1.38
	OPENBSD_3_8:1.37.0.4
	OPENBSD_3_8_BASE:1.37
	OPENBSD_3_7:1.37.0.2
	OPENBSD_3_7_BASE:1.37
	OPENBSD_3_6:1.36.0.2
	OPENBSD_3_6_BASE:1.36
	SMP_SYNC_A:1.35
	SMP_SYNC_B:1.35
	OPENBSD_3_5:1.35.0.2
	OPENBSD_3_5_BASE:1.35
	OPENBSD_3_4:1.33.0.2
	OPENBSD_3_4_BASE:1.33
	UBC_SYNC_A:1.32
	OPENBSD_3_3:1.31.0.2
	OPENBSD_3_3_BASE:1.31
	OPENBSD_3_2:1.30.0.2
	OPENBSD_3_2_BASE:1.30
	OPENBSD_3_1:1.28.0.4
	OPENBSD_3_1_BASE:1.28
	UBC_SYNC_B:1.30
	UBC:1.28.0.2
	UBC_BASE:1.28
	OPENBSD_3_0:1.27.0.2
	OPENBSD_3_0_BASE:1.27
	OPENBSD_2_9:1.23.0.4
	OPENBSD_2_9_BASE:1.23
	OPENBSD_2_8:1.23.0.2
	OPENBSD_2_8_BASE:1.23
	OPENBSD_2_7:1.22.0.10
	OPENBSD_2_7_BASE:1.22
	SMP:1.22.0.8
	SMP_BASE:1.22
	kame_19991208:1.22
	OPENBSD_2_6:1.22.0.6
	OPENBSD_2_6_BASE:1.22
	OPENBSD_2_5:1.22.0.4
	OPENBSD_2_5_BASE:1.22
	OPENBSD_2_4:1.22.0.2
	OPENBSD_2_4_BASE:1.22
	OPENBSD_2_3:1.18.0.2
	OPENBSD_2_3_BASE:1.18
	OPENBSD_2_2:1.17.0.2
	OPENBSD_2_2_BASE:1.17
	OPENBSD_2_1:1.15.0.2
	OPENBSD_2_1_BASE:1.15
	OPENBSD_2_0:1.7.0.2
	OPENBSD_2_0_BASE:1.7
	netbsd_1_1:1.1.1.1;
locks; strict;
comment	@ * @;


1.56
date	2014.03.18.22.36.32;	author miod;	state dead;
branches;
next	1.55;

1.55
date	2013.06.03.15.54.47;	author tedu;	state Exp;
branches;
next	1.54;

1.54
date	2012.08.23.06.12.49;	author deraadt;	state Exp;
branches;
next	1.53;

1.53
date	2011.12.21.23.12.03;	author miod;	state Exp;
branches;
next	1.52;

1.52
date	2011.10.06.20.49.27;	author deraadt;	state Exp;
branches;
next	1.51;

1.51
date	2011.01.14.19.04.08;	author jasper;	state Exp;
branches;
next	1.50;

1.50
date	2010.11.19.20.55.48;	author miod;	state Exp;
branches;
next	1.49;

1.49
date	2010.09.23.05.02.14;	author claudio;	state Exp;
branches;
next	1.48;

1.48
date	2010.07.03.03.59.16;	author krw;	state Exp;
branches;
next	1.47;

1.47
date	2010.06.09.15.25.32;	author jsing;	state Exp;
branches;
next	1.46;

1.46
date	2009.08.13.15.04.20;	author dlg;	state Exp;
branches;
next	1.45;

1.45
date	2009.06.03.14.45.51;	author jj;	state Exp;
branches;
next	1.44;

1.44
date	2009.01.25.17.30.48;	author miod;	state Exp;
branches;
next	1.43;

1.43
date	2008.05.14.20.49.48;	author miod;	state Exp;
branches;
next	1.42;

1.42
date	2008.04.08.14.31.54;	author claudio;	state Exp;
branches;
next	1.41;

1.41
date	2007.05.28.22.26.03;	author todd;	state Exp;
branches;
next	1.40;

1.40
date	2007.05.27.01.50.36;	author todd;	state Exp;
branches;
next	1.39;

1.39
date	2007.05.26.19.54.24;	author todd;	state Exp;
branches;
next	1.38;

1.38
date	2005.12.31.18.13.44;	author miod;	state Exp;
branches;
next	1.37;

1.37
date	2005.01.14.22.39.27;	author miod;	state Exp;
branches;
next	1.36;

1.36
date	2004.08.03.21.46.58;	author miod;	state Exp;
branches;
next	1.35;

1.35
date	2004.02.10.01.31.21;	author millert;	state Exp;
branches;
next	1.34;

1.34
date	2003.09.23.16.51.11;	author millert;	state Exp;
branches;
next	1.33;

1.33
date	2003.06.02.23.27.45;	author millert;	state Exp;
branches;
next	1.32;

1.32
date	2003.05.14.00.20.37;	author tedu;	state Exp;
branches;
next	1.31;

1.31
date	2002.12.05.02.49.55;	author kjc;	state Exp;
branches;
next	1.30;

1.30
date	2002.07.10.22.08.47;	author mickey;	state Exp;
branches;
next	1.29;

1.29
date	2002.05.16.21.11.13;	author miod;	state Exp;
branches;
next	1.28;

1.28
date	2001.12.11.23.19.02;	author miod;	state Exp;
branches
	1.28.2.1;
next	1.27;

1.27
date	2001.09.28.02.53.13;	author mickey;	state Exp;
branches;
next	1.26;

1.26
date	2001.08.06.22.34.43;	author mickey;	state Exp;
branches;
next	1.25;

1.25
date	2001.06.27.06.56.28;	author kjc;	state Exp;
branches;
next	1.24;

1.24
date	2001.06.25.03.19.50;	author kjell;	state Exp;
branches;
next	1.23;

1.23
date	2000.09.26.14.03.52;	author art;	state Exp;
branches;
next	1.22;

1.22
date	98.09.25.09.20.53;	author todd;	state Exp;
branches
	1.22.8.1;
next	1.21;

1.21
date	98.08.24.05.29.52;	author millert;	state Exp;
branches;
next	1.20;

1.20
date	98.07.07.06.56.02;	author deraadt;	state Exp;
branches;
next	1.19;

1.19
date	98.07.07.03.02.36;	author deraadt;	state Exp;
branches;
next	1.18;

1.18
date	97.11.23.05.22.53;	author mickey;	state Exp;
branches;
next	1.17;

1.17
date	97.08.04.07.34.20;	author downsj;	state Exp;
branches;
next	1.16;

1.16
date	97.07.06.08.01.58;	author downsj;	state Exp;
branches;
next	1.15;

1.15
date	97.04.16.11.56.21;	author downsj;	state Exp;
branches;
next	1.14;

1.14
date	97.02.16.14.37.11;	author downsj;	state Exp;
branches;
next	1.13;

1.13
date	97.02.16.10.42.22;	author downsj;	state Exp;
branches;
next	1.12;

1.12
date	97.02.03.08.12.00;	author downsj;	state Exp;
branches;
next	1.11;

1.11
date	97.02.03.04.47.55;	author downsj;	state Exp;
branches;
next	1.10;

1.10
date	97.01.18.08.17.46;	author downsj;	state Exp;
branches;
next	1.9;

1.9
date	97.01.12.15.13.13;	author downsj;	state Exp;
branches;
next	1.8;

1.8
date	96.10.19.13.26.07;	author mickey;	state Exp;
branches;
next	1.7;

1.7
date	96.08.29.09.26.01;	author deraadt;	state Exp;
branches;
next	1.6;

1.6
date	96.06.23.11.47.14;	author deraadt;	state Exp;
branches;
next	1.5;

1.5
date	96.05.04.18.50.41;	author mickey;	state Exp;
branches;
next	1.4;

1.4
date	96.04.25.06.37.02;	author mickey;	state Exp;
branches;
next	1.3;

1.3
date	96.02.21.12.53.44;	author mickey;	state Exp;
branches;
next	1.2;

1.2
date	96.01.07.07.41.02;	author dm;	state Exp;
branches;
next	1.1;

1.1
date	95.10.18.08.50.22;	author deraadt;	state Exp;
branches
	1.1.1.1;
next	;

1.1.1.1
date	95.10.18.08.50.22;	author deraadt;	state Exp;
branches;
next	;

1.22.8.1
date	2001.04.18.16.05.37;	author niklas;	state Exp;
branches;
next	1.22.8.2;

1.22.8.2
date	2001.07.04.10.15.38;	author niklas;	state Exp;
branches;
next	1.22.8.3;

1.22.8.3
date	2001.10.31.02.52.46;	author nate;	state Exp;
branches;
next	1.22.8.4;

1.22.8.4
date	2002.03.06.00.57.22;	author niklas;	state Exp;
branches;
next	1.22.8.5;

1.22.8.5
date	2003.03.27.23.19.21;	author niklas;	state Exp;
branches;
next	1.22.8.6;

1.22.8.6
date	2003.05.16.00.29.38;	author niklas;	state Exp;
branches;
next	1.22.8.7;

1.22.8.7
date	2003.06.07.11.11.35;	author ho;	state Exp;
branches;
next	1.22.8.8;

1.22.8.8
date	2004.02.19.10.48.39;	author niklas;	state Exp;
branches;
next	1.22.8.9;

1.22.8.9
date	2004.06.05.23.10.46;	author niklas;	state Exp;
branches;
next	;

1.28.2.1
date	2002.06.11.03.35.20;	author art;	state Exp;
branches;
next	1.28.2.2;

1.28.2.2
date	2002.10.29.00.28.02;	author art;	state Exp;
branches;
next	1.28.2.3;

1.28.2.3
date	2003.05.19.21.39.16;	author tedu;	state Exp;
branches;
next	;


desc
@@


1.56
log
@Retire hp300, mvme68k and mvme88k ports. These ports have no users, keeping
this hardware alive is becoming increasingly difficult, and I should heed the
message sent by the three disks which have died on me over the last few days.

Noone sane will mourn these ports anyway. So long, and thanks for the fish.
@
text
@/*	$OpenBSD: conf.c,v 1.55 2013/06/03 15:54:47 tedu Exp $	*/
/*	$NetBSD: conf.c,v 1.39 1997/05/12 08:17:53 thorpej Exp $	*/

/*-
 * Copyright (c) 1991 The Regents of the University of California.
 * All rights reserved.
 *
 * Redistribution and use in source and binary forms, with or without
 * modification, are permitted provided that the following conditions
 * are met:
 * 1. Redistributions of source code must retain the above copyright
 *    notice, this list of conditions and the following disclaimer.
 * 2. Redistributions in binary form must reproduce the above copyright
 *    notice, this list of conditions and the following disclaimer in the
 *    documentation and/or other materials provided with the distribution.
 * 3. Neither the name of the University nor the names of its contributors
 *    may be used to endorse or promote products derived from this software
 *    without specific prior written permission.
 *
 * THIS SOFTWARE IS PROVIDED BY THE REGENTS AND CONTRIBUTORS ``AS IS'' AND
 * ANY EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT LIMITED TO, THE
 * IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE
 * ARE DISCLAIMED.  IN NO EVENT SHALL THE REGENTS OR CONTRIBUTORS BE LIABLE
 * FOR ANY DIRECT, INDIRECT, INCIDENTAL, SPECIAL, EXEMPLARY, OR CONSEQUENTIAL
 * DAMAGES (INCLUDING, BUT NOT LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS
 * OR SERVICES; LOSS OF USE, DATA, OR PROFITS; OR BUSINESS INTERRUPTION)
 * HOWEVER CAUSED AND ON ANY THEORY OF LIABILITY, WHETHER IN CONTRACT, STRICT
 * LIABILITY, OR TORT (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY
 * OUT OF THE USE OF THIS SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF
 * SUCH DAMAGE.
 *
 *      @@(#)conf.c	7.9 (Berkeley) 5/28/91
 */

#include <sys/param.h>
#include <sys/systm.h>
#include <sys/buf.h>
#include <sys/ioctl.h>
#include <sys/tty.h>
#include <sys/conf.h>
#include <sys/vnode.h>

#include "cd.h"
#include "ch.h"
#include "ct.h"
bdev_decl(ct);
#include "mt.h"
bdev_decl(mt);
#include "hd.h"
bdev_decl(hd);
#include "rd.h"
#include "sd.h"
#include "st.h"
#include "uk.h"
#include "vnd.h"

struct bdevsw	bdevsw[] =
{
	bdev_tape_init(NCT,ct),		/* 0: cs80 cartridge tape */
	bdev_tape_init(NMT,mt),		/* 1: magnetic reel tape */
	bdev_disk_init(NHD,hd),		/* 2: HPIB disk */
	bdev_swap_init(1,sw),		/* 3: swap pseudo-device */
	bdev_disk_init(NSD,sd),		/* 4: SCSI disk */
	bdev_notdef(),			/* 5: was: concatenated disk driver */
	bdev_disk_init(NVND,vnd),	/* 6: vnode disk driver */
	bdev_tape_init(NST,st),		/* 7: SCSI tape */
	bdev_disk_init(NRD,rd),		/* 8: RAM disk */
	bdev_disk_init(NCD,cd),		/* 9: SCSI CD-ROM */
	bdev_lkm_dummy(),		/* 10 */
	bdev_lkm_dummy(),		/* 11 */
	bdev_lkm_dummy(),		/* 12 */
	bdev_lkm_dummy(),		/* 13 */
	bdev_lkm_dummy(),		/* 14 */
	bdev_lkm_dummy(),		/* 15 */
};
int	nblkdev = nitems(bdevsw);

/* open, close, read, write, ioctl -- XXX should be a generic device */
#define	cdev_ppi_init(c,n) { \
	dev_init(c,n,open), dev_init(c,n,close), dev_init(c,n,read), \
	dev_init(c,n,write), dev_init(c,n,ioctl), (dev_type_stop((*))) nullop, \
	0, (dev_type_poll((*))) enodev, (dev_type_mmap((*))) enodev }

#include "audio.h"
#include "bio.h"
#define	mmread	mmrw
#define	mmwrite	mmrw
cdev_decl(mm);
#include "pty.h"
cdev_decl(ct);
cdev_decl(hd);
#include "ppi.h"
cdev_decl(ppi);
#include "dca.h"
cdev_decl(dca);
#include "apci.h"
cdev_decl(apci);
#include "dcm.h"
cdev_decl(dcm);
cdev_decl(mt);
cdev_decl(fd);
#include "bpfilter.h"
#include "tun.h"
#include "ksyms.h"
#include "wsdisplay.h"
#include "wskbd.h"
#include "wsmouse.h"
#include "wsmux.h"
#include "pf.h"
#include "systrace.h"
#include "vscsi.h"
#include "pppx.h"
#include "hotplug.h"
#include "fuse.h"

struct cdevsw	cdevsw[] =
{
	cdev_cn_init(1,cn),		/* 0: virtual console */
	cdev_ctty_init(1,ctty),		/* 1: controlling terminal */
	cdev_mm_init(1,mm),		/* 2: /dev/{null,mem,kmem,...} */
	cdev_notdef(),			/* 3 was /dev/drum */
	cdev_tty_init(NPTY,pts),	/* 4: pseudo-tty slave */
	cdev_ptc_init(NPTY,ptc),	/* 5: pseudo-tty master */
	cdev_log_init(1,log),		/* 6: /dev/klog */
	cdev_tape_init(NCT,ct),		/* 7: cs80 cartridge tape */
	cdev_disk_init(NSD,sd),		/* 8: SCSI disk */
	cdev_disk_init(NHD,hd),		/* 9: HPIB disk */
	cdev_notdef(),			/* 10 */
	cdev_ppi_init(NPPI,ppi),	/* 11: printer/plotter interface */
	cdev_tty_init(NDCA,dca),	/* 12: built-in single-port serial */
	cdev_notdef(),			/* 13: was console terminal emulator */
	cdev_notdef(),			/* 14: was human interface loop */
	cdev_tty_init(NDCM,dcm),	/* 15: 4-port serial */
	cdev_tape_init(NMT,mt),		/* 16: magnetic reel tape */
	cdev_notdef(),			/* 17: was: concatenated disk */
	cdev_disk_init(NCD,cd),		/* 18: SCSI CD-ROM */
	cdev_disk_init(NVND,vnd),	/* 19: vnode disk driver */
	cdev_tape_init(NST,st),		/* 20: SCSI tape */
	cdev_fd_init(1,filedesc),	/* 21: file descriptor pseudo-device */
	cdev_bpf_init(NBPFILTER,bpf),	/* 22: Berkeley packet filter */
	cdev_tun_init(NTUN,tun),	/* 23: network tunnel */
	cdev_lkm_init(NLKM,lkm),	/* 24: loadable module driver */
	cdev_lkm_dummy(),		/* 25 */
	cdev_lkm_dummy(),		/* 26 */
	cdev_lkm_dummy(),		/* 27 */
	cdev_lkm_dummy(),		/* 28 */
	cdev_lkm_dummy(),		/* 29 */
	cdev_lkm_dummy(),		/* 30 */
	cdev_lkm_dummy(),		/* 31 */
	cdev_random_init(1,random),	/* 32: random generator */
	cdev_pf_init(NPF,pf),		/* 33: packet filter */
	cdev_disk_init(NRD,rd),		/* 34: RAM disk */
	cdev_tty_init(NAPCI,apci),	/* 35: Apollo APCI UARTs */
	cdev_ksyms_init(NKSYMS,ksyms),	/* 36: Kernel symbols device */
	cdev_uk_init(NUK,uk),		/* 37 */
	cdev_notdef(),			/* 38 */
	cdev_ch_init(NCH,ch),		/* 39 */
	cdev_wsdisplay_init(NWSDISPLAY,wsdisplay), /* 40: frame buffers */
	cdev_mouse_init(NWSKBD,wskbd),	/* 41: keyboards */
	cdev_mouse_init(NWSMOUSE,wsmouse), /* 42: mice */
	cdev_mouse_init(NWSMUX,wsmux),	/* 43: ws multiplexor */
	cdev_audio_init(NAUDIO,audio),	/* 44: audio */
	cdev_notdef(),			/* 45 */
	cdev_notdef(),			/* 46 */
	cdev_notdef(),			/* 47 */
	cdev_notdef(),			/* 48 */
	cdev_bio_init(NBIO,bio),	/* 49: ioctl tunnel */
	cdev_systrace_init(NSYSTRACE,systrace),	/* 50 system call tracing */
	cdev_notdef(),			/* 51 */
	cdev_ptm_init(NPTY,ptm),	/* 52: pseudo-tty ptm device */
	cdev_vscsi_init(NVSCSI,vscsi),	/* 53: vscsi */
	cdev_disk_init(1,diskmap),	/* 54: disk mapper */
	cdev_pppx_init(NPPPX,pppx),	/* 55: pppx */
	cdev_hotplug_init(NHOTPLUG,hotplug),	/* 56: devices hot plugging */
	cdev_fuse_init(NFUSE,fuse),	/* 57: fuse */
};
int	nchrdev = nitems(cdevsw);

int	mem_no = 2; 	/* major device number of memory special file */

/*
 * Swapdev is a fake device implemented
 * in sw.c used only internally to get to swstrategy.
 * It cannot be provided to the users, because the
 * swstrategy routine munches the b_dev and b_blkno entries
 * before calling the appropriate driver.  This would horribly
 * confuse, e.g. the hashing routines. Instead, /dev/drum is
 * provided as a character (raw) device.
 */
dev_t	swapdev = makedev(3, 0);

/*
 * Returns true if dev is /dev/mem or /dev/kmem.
 */
int
iskmemdev(dev)
	dev_t dev;
{

	return (major(dev) == mem_no && minor(dev) < 2);
}

/*
 * Returns true if dev is /dev/zero.
 */
int
iszerodev(dev)
	dev_t dev;
{

	return (major(dev) == mem_no && minor(dev) == 12);
}

dev_t
getnulldev()
{
	return makedev(mem_no, 2);
}

int chrtoblktbl[] = {
	/* XXXX This needs to be dynamic for LKMs. */
	/*VCHR*/	/*VBLK*/
	/*  0 */	NODEV,
	/*  1 */	NODEV,
	/*  2 */	NODEV,
	/*  3 */	NODEV,
	/*  4 */	NODEV,
	/*  5 */	NODEV,
	/*  6 */	NODEV,
	/*  7 */	0,		/* ct */
	/*  8 */	4,		/* sd */
	/*  9 */	2,		/* hd */
	/* 10 */	NODEV,
	/* 11 */	NODEV,
	/* 12 */	NODEV,
	/* 13 */	NODEV,
	/* 14 */	NODEV,
	/* 15 */	NODEV,
	/* 16 */	1,		/* mt */
	/* 17 */	NODEV,
	/* 18 */	9,		/* cd */
	/* 19 */	6,		/* vnd */
	/* 20 */	7,		/* st */
	/* 21 */	NODEV,
	/* 22 */	NODEV,
	/* 23 */	NODEV,
	/* 24 */	NODEV,
	/* 25 */	NODEV,
	/* 26 */	NODEV,
	/* 27 */	NODEV,
	/* 28 */	NODEV,
	/* 29 */	NODEV,
	/* 30 */	NODEV,
	/* 31 */	NODEV,
	/* 32 */	NODEV,
	/* 33 */	NODEV,
	/* 34 */	8,		/* rd */
};
int nchrtoblktbl = nitems(chrtoblktbl);

/*
 * This entire table could be autoconfig()ed but that would mean that
 * the kernel's idea of the console would be out of sync with that of
 * the standalone boot.  I think it best that they both use the same
 * known algorithm unless we see a pressing need otherwise.
 */
#include <dev/cons.h>

cons_decl(ws);

#define dcacnpollc		nullcnpollc
cons_decl(dca);

#define	apcicnpollc		nullcnpollc
cons_decl(apci);

#define dcmcnpollc		nullcnpollc
cons_decl(dcm);

struct	consdev constab[] = {
#if NWSDISPLAY > 0
	cons_init(ws),
#endif
#if NDCA > 0
	cons_init(dca),
#endif
#if NAPCI > 0
	cons_init(apci),
#endif
#if NDCM > 0
	cons_init(dcm),
#endif
	{ 0 },
};
@


1.55
log
@changes for isc fuse support. not enabled. ok beck deraadt.
from Sylvestre Gallon ccna.syl gmail.com
@
text
@d1 1
a1 1
/*	$OpenBSD: conf.c,v 1.54 2012/08/23 06:12:49 deraadt Exp $	*/
@


1.54
log
@kill nnpfs dead
@
text
@d1 1
a1 1
/*	$OpenBSD: conf.c,v 1.53 2011/12/21 23:12:03 miod Exp $	*/
d114 1
d175 1
@


1.53
log
@Work-in-progress driver for the HP ``Audio1'' device found on the HP 9000/425e
(hp300) and the HP9000/705 and 9000/710 (hppa). 8-bit mono, 8KHz, no surprise
since it is based upon a digital phone chip.
Tested on 425e only so far, and playback only; configured in, but disabled,
on hppa kernels until there are positive test reports (I am not sure the
interrupt assignment on hppa is correct).
And now people no longer can joke about audio on hp300.
@
text
@d1 1
a1 1
/*	$OpenBSD: conf.c,v 1.52 2011/10/06 20:49:27 deraadt Exp $	*/
a104 4
#ifdef NNPFS
#include <nnpfs/nnnpfs.h>
cdev_decl(nnpfs_dev);
#endif
a167 3
#ifdef NNPFS
	cdev_nnpfs_init(NNNPFS,nnpfs_dev),	/* 51: nnpfs communication device */
#else
a168 1
#endif
@


1.52
log
@ccd goes to the attic
discussed with jsing and millert
@
text
@d1 1
a1 1
/*	$OpenBSD: conf.c,v 1.51 2011/01/14 19:04:08 jasper Exp $	*/
d84 1
d165 1
a165 1
	cdev_notdef(),			/* 44 */
@


1.51
log
@- use nitems()

"doesn't hurt" deraadt@@
@
text
@d1 1
a1 1
/*	$OpenBSD: conf.c,v 1.50 2010/11/19 20:55:48 miod Exp $	*/
a42 1
#include "ccd.h"
d64 1
a64 1
	bdev_disk_init(NCCD,ccd),	/* 5: concatenated disk driver */
d137 1
a137 1
	cdev_disk_init(NCCD,ccd),	/* 17: concatenated disk */
d245 1
a245 1
	/* 17 */	5,		/* ccd */
@


1.50
log
@Sync MAKEDEV against conf.c, and both against GENERIC.
@
text
@d1 1
a1 1
/*	$OpenBSD: conf.c,v 1.49 2010/09/23 05:02:14 claudio Exp $	*/
d77 1
a77 1
int	nblkdev = sizeof(bdevsw) / sizeof(bdevsw[0]);
d183 1
a183 1
int	nchrdev = sizeof(cdevsw) / sizeof(cdevsw[0]);
d265 1
a265 1
int nchrtoblktbl = sizeof(chrtoblktbl) / sizeof(chrtoblktbl[0]);
@


1.49
log
@Add pppx(4) to the cdevs of the remaining archs.
OK dlg@@
@
text
@d1 1
a1 1
/*	$OpenBSD: conf.c,v 1.48 2010/07/03 03:59:16 krw Exp $	*/
d117 1
d181 1
@


1.48
log
@No more ss(4) or usscanner(4). Unused, unloved and unmaintained.
General huzzahs.

"go for it" deraadt@@
@
text
@d1 1
a1 1
/*	$OpenBSD: conf.c,v 1.47 2010/06/09 15:25:32 jsing Exp $	*/
d116 1
d179 1
@


1.47
log
@Wire up device nodes for disk mapper.

ok deraadt@@
@
text
@d1 1
a1 1
/*	$OpenBSD: conf.c,v 1.45 2009/06/03 14:45:51 jj Exp $	*/
a53 1
#include "ss.h"
d157 1
a157 1
	cdev_ss_init(NSS,ss),		/* 38 */
@


1.46
log
@wire vscsi up to a cdev

for claudio@@ ok deraadt@@
@
text
@d178 1
a178 1

@


1.45
log
@Arla client rename from xfs to nnpfs for later upgrades. Tested on various arches. ok todd@@ beck@@
@
text
@d1 1
a1 1
/*	$OpenBSD: conf.c,v 1.44 2009/01/25 17:30:48 miod Exp $	*/
d116 1
d177 1
@


1.44
log
@Remove /dev/drum and related code.
@
text
@d1 1
a1 1
/*	$OpenBSD: conf.c,v 1.43 2008/05/14 20:49:48 miod Exp $	*/
d106 3
a108 3
#ifdef XFS
#include <xfs/nxfs.h>
cdev_decl(xfs_dev);
d170 2
a171 2
#ifdef XFS
	cdev_xfs_init(NXFS,xfs_dev),	/* 51: xfs communication device */
@


1.43
log
@Fix more chrtoblktbl[] sloppyness, and add proper block st nodes to *ppc and
sgi.
@
text
@d1 1
a1 1
/*	$OpenBSD: conf.c,v 1.42 2008/04/08 14:31:54 claudio Exp $	*/
d122 1
a122 1
	cdev_swap_init(1,sw),		/* 3: /dev/drum (swap pseudo-device) */
@


1.42
log
@Split the cdev makro for bpftun into two seperate definitions. tun(4) and
bpf(4) are different enough so that the split makes sense -- this is necessary
to make bpf(4) cloneable.
requested deraadt@@, OK thib@@
@
text
@d1 1
a1 1
/*	$OpenBSD: conf.c,v 1.41 2007/05/28 22:26:03 todd Exp $	*/
d231 3
a233 3
	/*  7 */	0,
	/*  8 */	4,
	/*  9 */	2,
d240 5
a244 5
	/* 16 */	NODEV,
	/* 17 */	5,
	/* 18 */	9,
	/* 19 */	6,
	/* 20 */	7,
d258 1
a258 1
	/* 34 */	8,
@


1.41
log
@bio for all archs, ok krw@@ kettenis@@ sounds good marco@@ go for it deraadt@@
@
text
@d1 1
a1 1
/*	$OpenBSD: conf.c,v 1.40 2007/05/27 01:50:36 todd Exp $	*/
d141 2
a142 2
	cdev_bpftun_init(NBPFILTER,bpf),/* 22: Berkeley packet filter */
	cdev_bpftun_init(NTUN,tun),	/* 23: network tunnel */
@


1.40
log
@back out bio, breaks dlg's sparc64 v215
prompted by/ok dlg@@ deraadt@@
@
text
@d1 1
a1 1
/*	$OpenBSD: conf.c,v 1.39 2007/05/26 19:54:24 todd Exp $	*/
d86 1
d129 1
a129 1
	cdev_notdef(),			/* 10: vas frame buffer */
d168 1
a168 1
	cdev_notdef(),			/* 49 */
@


1.39
log
@prodded by marco, enable bio everywhere
grudgingly ok deraadt@@
@
text
@d1 1
a1 1
/*	$OpenBSD: conf.c,v 1.38 2005/12/31 18:13:44 miod Exp $	*/
a85 1
#include "bio.h"
d128 1
a128 1
	cdev_bio_init(NBIO,bio),	/* 10: ioctl tunnel */
@


1.38
log
@Rework (once again) the console code, in order to match the PROM's logic better.
When not running on serial console, the PROM will pick the ``internal''
graphics device, and if it does not exist, the DIO device with the lowest
select code, and will resort to SGC devices if no internal or DIO device
was found.

However, the current logic would search for a certain frame buffer type first,
then for its best hardware location, following the order they are listed
in conf.c.

By replacing gazillions of almost-exactly-duplicated frame buffer code with
one single instance, which is device type-agnostic, we can match the PROM
(and the bootblocks) logic again. Plus this saves a few KB of code!
@
text
@d1 1
a1 1
/*	$OpenBSD: conf.c,v 1.37 2005/01/14 22:39:27 miod Exp $	*/
d86 1
d129 1
a129 1
	cdev_notdef(),			/* 10: vas frame buffer */
@


1.37
log
@Switch OpenBSD/hp300 to wscons, still using on-board ROM fonts for now.

Main features:
- MI hil drivers, allowing live plug/unplug of devices, and the keyboard
  does not need to be at id 1 anymore.
- SGC bus support on 4xx models. SGC frame buffers are supported too, but
  not as console, though you can use them as a regular glass terminal if
  you run a getty on ttyC0. Currently not compiled-in, awaiting for an sti(4)
  fix to be commited.
- HP-UX compatibility interfaces are removed. grfinfo and hilinfo are removed.

X11 support is currently broken by these changes; X.org X11R6 support will
be available very soon.

Tested on hyperion and 4 different flavours of catseye/topcat/kathmandu; other,
older frame buffers (davinci, gatorbox and renaissance) could not been tested
but should work; please report any regression.
@
text
@d1 1
a1 1
/*	$OpenBSD: conf.c,v 1.36 2004/08/03 21:46:58 miod Exp $	*/
d269 1
a269 29
#define dvboxcngetc		wscngetc
#define dvboxcnputc		wscnputc
#define dvboxcnpollc		wscnpollc
cons_decl(dvbox);

#define gboxcngetc		wscngetc
#define gboxcnputc		wscnputc
#define gboxcnpollc		wscnpollc
cons_decl(gbox);

#define hypercngetc		wscngetc
#define hypercnputc		wscnputc
#define hypercnpollc		wscnpollc
cons_decl(hyper);

#define rboxcngetc		wscngetc
#define rboxcnputc		wscnputc
#define rboxcnpollc		wscnpollc
cons_decl(rbox);

#define sticngetc		wscngetc
#define sticnputc		wscnputc
#define sticnpollc		wscnpollc
cons_decl(sti);

#define topcatcngetc		wscngetc
#define topcatcnputc		wscnputc
#define topcatcnpollc		wscnpollc
cons_decl(topcat);
a279 7
#include "dvbox.h"
#include "gbox.h"
#include "hyper.h"
#include "rbox.h"
#include "sti.h"
#include "topcat.h"

d282 1
a282 17
#if NDVBOX > 0
	cons_init(dvbox),
#endif
#if NGBOX > 0
	cons_init(gbox),
#endif
#if NHYPER > 0
	cons_init(hyper),
#endif
#if NRBOX > 0
	cons_init(rbox),
#endif
#if NSTI > 0
	cons_init(sti),
#endif
#if NTOPCAT > 0
	cons_init(topcat),
a283 1
#endif /* NWSDISPLAY > 0 */
@


1.36
log
@Replace the old 4.4BSD scsi code used on hp300 with a ``real'' driver
interfaced with the MI scsi code.

Adapted from NetBSD with some changes (especially to get tape and old
cd-rom drives to not cause the driver to spin during probe).

Tested by millert@@ and I, ok millert@@
@
text
@d1 1
a1 1
/*	$OpenBSD: conf.c,v 1.35 2004/02/10 01:31:21 millert Exp $	*/
a79 7
/* open, close, ioctl, poll, mmap -- XXX should be a map device */
#define	cdev_grf_init(c,n) { \
	dev_init(c,n,open), dev_init(c,n,close), (dev_type_read((*))) nullop, \
	(dev_type_write((*))) nullop, dev_init(c,n,ioctl), \
	(dev_type_stop((*))) enodev, 0, dev_init(c,n,poll), \
	dev_init(c,n,mmap) }

a85 7
/* open, close, read, ioctl, poll, mmap -- XXX should be a map device */
#define	cdev_hil_init(c,n) { \
	dev_init(c,n,open), dev_init(c,n,close), dev_init(c,n,read), \
	(dev_type_write((*))) nullop, dev_init(c,n,ioctl), \
	(dev_type_stop((*))) enodev, 0, dev_init(c,n,poll), \
	dev_init(c,n,mmap) }

a91 2
#include "grf.h"
cdev_decl(grf);
a97 4
#include "ite.h"
cdev_decl(ite);
/* XXX shouldn't this be optional? */
cdev_decl(hil);
d109 4
a112 1

a113 1

d128 1
a128 1
	cdev_grf_init(NGRF,grf),	/* 10: frame buffer */
d131 2
a132 2
	cdev_tty_init(NITE,ite),	/* 13: console terminal emulator */
	cdev_hil_init(1,hil),		/* 14: human interface loop */
d158 4
a161 4
	cdev_notdef(),			/* 40 */
	cdev_notdef(),			/* 41 */
	cdev_notdef(),			/* 42 */
	cdev_notdef(),			/* 43 */
a171 1
	
d269 3
a271 3
#define dvboxcngetc		itecngetc
#define dvboxcnputc		itecnputc
#define dvboxcnpollc		nullcnpollc
d274 3
a276 3
#define gboxcngetc		itecngetc
#define gboxcnputc		itecnputc
#define gboxcnpollc		nullcnpollc
d279 3
a281 3
#define hypercngetc		itecngetc
#define hypercnputc		itecnputc
#define hypercnpollc		nullcnpollc
d284 3
a286 3
#define rboxcngetc		itecngetc
#define rboxcnputc		itecnputc
#define rboxcnpollc		nullcnpollc
d289 8
a296 3
#define topcatcngetc		itecngetc
#define topcatcnputc		itecnputc
#define topcatcnpollc		nullcnpollc
d312 1
d316 1
a316 1
#if NITE > 0
d329 3
d335 1
a335 1
#endif /* NITE > 0 */
@


1.35
log
@Add the ptm device to pty(4).  By opening /dev/ptm and using the PTMGET
ioctl(2), an unprivileged process may allocate a pty and have its owner
and mode set appropriately.  This means that programs such as xterm and
screen no longer need to be setuid.  Programs using the openpty()
function require zero changes and will "just work".

Designed by beck@@ and deraadt@@; changes by beck@@ with cleanup (and
a rewrite of the vnode bits) by art@@ and tweaks/bugfixes by me.
Tested by many.
@
text
@d1 1
a1 1
/*	$OpenBSD: conf.c,v 1.34 2003/09/23 16:51:11 millert Exp $	*/
d43 3
d52 1
d54 3
a56 1
#include "ccd.h"
a57 2
#include "st.h"
#include "rd.h"
d70 1
a70 1
	bdev_lkm_dummy(),		/* 9 */
d76 1
d154 1
a154 1
	cdev_notdef(),			/* 18 */
d173 3
a175 3
	cdev_notdef(),			/* 37 */
	cdev_notdef(),			/* 38 */
	cdev_notdef(),			/* 39 */
d260 1
a260 1
	/* 18 */	NODEV,
@


1.34
log
@Replace select backends with poll backends.  selscan() and pollscan()
now call the poll backend.  With this change we implement greater
poll(2) functionality instead of emulating it via the select backend.
Adapted from NetBSD and including some changes from FreeBSD.
Tested by many, deraadt@@ OK
@
text
@d1 1
a1 1
/*	$OpenBSD: conf.c,v 1.33 2003/06/02 23:27:45 millert Exp $	*/
d188 2
@


1.33
log
@Remove the advertising clause in the UCB license which Berkeley
rescinded 22 July 1999.  Proofed by myself and Theo.
@
text
@d1 1
a1 1
/*	$OpenBSD: conf.c,v 1.32 2003/05/14 00:20:37 tedu Exp $	*/
d75 1
a75 1
/* open, close, ioctl, select, mmap -- XXX should be a map device */
d79 1
a79 1
	(dev_type_stop((*))) enodev, 0, dev_init(c,n,select), \
d86 1
a86 1
	0, (dev_type_select((*))) enodev, (dev_type_mmap((*))) enodev }
d88 1
a88 1
/* open, close, read, ioctl, select, mmap -- XXX should be a map device */
d92 1
a92 1
	(dev_type_stop((*))) enodev, 0, dev_init(c,n,select), \
@


1.32
log
@add {b,c}devsw_lookup convenience functions.
move chrtoblk and blktochr into MI code.
tested on several archs and ok deraadt@@
@
text
@d1 1
a1 1
/*	$OpenBSD: conf.c,v 1.31 2002/12/05 02:49:55 kjc Exp $	*/
d16 1
a16 5
 * 3. All advertising materials mentioning features or use of this software
 *    must display the following acknowledgement:
 *	This product includes software developed by the University of
 *	California, Berkeley and its contributors.
 * 4. Neither the name of the University nor the names of its contributors
@


1.31
log
@remove altq entries.
altq is merged into pf and handled through pf.
@
text
@d1 1
a1 1
/*	$OpenBSD: conf.c,v 1.30 2002/07/10 22:08:47 mickey Exp $	*/
d236 1
a236 1
static int chrtoblktbl[] = {
d275 1
a275 36

/*
 * Convert a character device number to a block device number.
 */
dev_t
chrtoblk(dev)
	dev_t dev;
{
	int blkmaj;

	if (major(dev) >= nchrdev ||
	    major(dev) > sizeof(chrtoblktbl)/sizeof(chrtoblktbl[0]))
		return (NODEV);
	blkmaj = chrtoblktbl[major(dev)];
	if (blkmaj == NODEV)
		return (NODEV);
	return (makedev(blkmaj, minor(dev)));
}

/*
 * Convert a block device number to a character device number.
 */
dev_t
blktochr(dev)
	dev_t dev;
{
	int blkmaj = major(dev);
	int i;

	if (blkmaj >= nblkdev)
		return (NODEV);
	for (i = 0; i < sizeof(chrtoblktbl)/sizeof(chrtoblktbl[0]); i++)
		if (blkmaj == chrtoblktbl[i])
			return (makedev(i, minor(dev)));
	return (NODEV);
}
@


1.30
log
@proper cdev_decl(ksyms), fix ksyms's broken functions
@
text
@d1 1
a1 1
/*	$OpenBSD: conf.c,v 1.29 2002/05/16 21:11:13 miod Exp $	*/
a130 2
#include <altq/altqconf.h>

a191 1
	cdev_altq_init(NALTQ,altq),	/* 52: ALTQ control interface */
@


1.29
log
@Add systrace support to all the remaining architectures.

Tested by various people on various platforms, I'm willing to fix any
breakage this causes.

ok niels@@ deraadt@@ and mickey@@ (after his comments were applied)
@
text
@d1 1
a1 1
/*	$OpenBSD: conf.c,v 1.28 2001/12/11 23:19:02 miod Exp $	*/
a123 1
cdev_decl(ksyms);   
@


1.28
log
@Remove declarations that already exist in <sys/conf.h>
@
text
@d1 1
a1 1
/*	$OpenBSD: conf.c,v 1.27 2001/09/28 02:53:13 mickey Exp $	*/
d134 2
d188 1
a188 1
	cdev_notdef(),			/* 50 */
@


1.28.2.1
log
@Sync UBC branch to -current
@
text
@d1 1
a1 1
/*	$OpenBSD: conf.c,v 1.28 2001/12/11 23:19:02 miod Exp $	*/
a133 2
#include "systrace.h"

d186 1
a186 1
	cdev_systrace_init(NSYSTRACE,systrace),	/* 50 system call tracing */
@


1.28.2.2
log
@sync to -current
@
text
@d1 1
a1 1
/*	$OpenBSD: conf.c,v 1.28.2.1 2002/06/11 03:35:20 art Exp $	*/
d124 1
@


1.28.2.3
log
@sync
@
text
@d1 1
a1 1
/*	$OpenBSD$	*/
d131 2
d194 1
d239 1
a239 1
int chrtoblktbl[] = {
d278 36
a313 1
int nchrtoblktbl = sizeof(chrtoblktbl) / sizeof(chrtoblktbl[0]);
@


1.27
log
@move cdev_decl(pf) into it's proper place, kill cdev_decl(ipl) at the same time
@
text
@d1 1
a1 1
/*	$OpenBSD: conf.c,v 1.26 2001/08/06 22:34:43 mickey Exp $	*/
a53 1
bdev_decl(sd);
a54 1
bdev_decl(ccd);
a55 1
bdev_decl(vnd);
a56 1
bdev_decl(st);
a57 1
bdev_decl(rd);
a98 2
cdev_decl(cn);
cdev_decl(ctty);
a102 7
#define	ptstty		ptytty
#define	ptsioctl	ptyioctl
cdev_decl(pts);
#define	ptctty		ptytty
#define	ptcioctl	ptyioctl
cdev_decl(ptc);
cdev_decl(log);
a103 1
cdev_decl(sd);
a119 3
cdev_decl(ccd);
cdev_decl(vnd);
cdev_decl(st);
a120 1
dev_decl(filedesc,open);
a121 1
cdev_decl(bpf);
a122 3
cdev_decl(tun);
cdev_decl(random);
cdev_decl(rd);
@


1.26
log
@remove vm_conf.h; art@@ ok
@
text
@d1 1
a1 1
/*	$OpenBSD: conf.c,v 1.25 2001/06/27 06:56:28 kjc Exp $	*/
a153 1
cdev_decl(pf);
@


1.25
log
@add the ALTQ device to the rest of the architectures.
@
text
@d1 1
a1 1
/*	$OpenBSD: conf.c,v 1.24 2001/06/25 03:19:50 kjell Exp $	*/
a52 1
bdev_decl(sw);
a108 1
cdev_decl(sw);
@


1.24
log
@add pf device on all architectures.
fix my previously bogus MAKEDEVs.
If you used pf on a non-i386. the major device number has changed,
and you'll need to recreate /dev/pf
ok theo
@
text
@d1 1
a1 1
/*	$OpenBSD: conf.c,v 1.23 2000/09/26 14:03:52 art Exp $	*/
d158 2
d219 1
@


1.23
log
@Implement getnulldev that returns the dev_t for "/dev/null".
@
text
@d1 1
a1 1
/*	$OpenBSD: conf.c,v 1.22 1998/09/25 09:20:53 todd Exp $	*/
d155 2
a156 5
#ifdef IPFILTER
#define NIPF 1
#else
#define NIPF 0
#endif
d193 1
a193 1
	cdev_gen_ipf(NIPF,ipl),		/* 33: ip filtering */
d214 1
@


1.22
log
@o xfs is in the house (thanks art, for getting me started)
o all but vax are major 51
@
text
@d1 1
a1 1
/*	$OpenBSD: conf.c,v 1.21 1998/08/24 05:29:52 millert Exp $	*/
d255 6
@


1.22.8.1
log
@Update the SMP branch to -current, this breaks the SMP branch though.
But it will be fixed soonish.  Note, nothing new has happened, this is just
a merge of the trunk into this branch.
@
text
@d1 1
a1 1
/*	$OpenBSD: conf.c,v 1.23 2000/09/26 14:03:52 art Exp $	*/
a254 6
}

dev_t
getnulldev()
{
	return makedev(mem_no, 2);
@


1.22.8.2
log
@Merge in -current from two days ago in the SMP branch.
As usual with merges, they do not indicate progress, so do not hold
your breath for working SMP, and do not mail me and ask about the
state of it.  It has not changed.  There is work ongoing, but very, very
slowly.  The commit is done in parts as to not lock up the tree in too
big chunks at a time.
@
text
@d1 1
a1 1
/*	$OpenBSD: conf.c,v 1.22.8.1 2001/04/18 16:05:37 niklas Exp $	*/
d155 5
a159 4
#include "pf.h"
cdev_decl(pf);

#include <altq/altqconf.h>
d196 1
a196 1
	cdev_pf_init(NPF,pf),		/* 33: packet filter */
a216 1
	
a218 1
	cdev_altq_init(NALTQ,altq),	/* 52: ALTQ control interface */
@


1.22.8.3
log
@Sync the SMP branch to something just after 3.0
@
text
@d1 1
a1 1
/*	$OpenBSD: conf.c,v 1.22.8.2 2001/07/04 10:15:38 niklas Exp $	*/
d53 1
d110 1
d156 1
@


1.22.8.4
log
@Merge in trunk
@
text
@d1 1
a1 1
/*	$OpenBSD$	*/
d54 1
d56 1
d58 1
d60 1
d62 1
d104 2
d110 7
d118 1
d135 3
d139 1
d141 1
d143 3
@


1.22.8.5
log
@Sync the SMP branch with 3.3
@
text
@d124 1
d132 1
a132 1
#include "systrace.h"
d186 1
a186 1
	cdev_systrace_init(NSYSTRACE,systrace),	/* 50 system call tracing */
d193 1
@


1.22.8.6
log
@merge the trunk so we will get the genfs and locking fixes
@
text
@d236 1
a236 1
int chrtoblktbl[] = {
d275 36
a310 1
int nchrtoblktbl = sizeof(chrtoblktbl) / sizeof(chrtoblktbl[0]);
@


1.22.8.7
log
@Sync SMP branch to -current
@
text
@d1 1
a1 1
/*	$OpenBSD: conf.c,v 1.22.8.6 2003/05/16 00:29:38 niklas Exp $	*/
d16 5
a20 1
 * 3. Neither the name of the University nor the names of its contributors
@


1.22.8.8
log
@Merge of current from two weeks agointo the SMP branch
@
text
@d1 1
a1 1
/*	$OpenBSD$	*/
d75 1
a75 1
/* open, close, ioctl, poll, mmap -- XXX should be a map device */
d79 1
a79 1
	(dev_type_stop((*))) enodev, 0, dev_init(c,n,poll), \
d86 1
a86 1
	0, (dev_type_poll((*))) enodev, (dev_type_mmap((*))) enodev }
d88 1
a88 1
/* open, close, read, ioctl, poll, mmap -- XXX should be a map device */
d92 1
a92 1
	(dev_type_stop((*))) enodev, 0, dev_init(c,n,poll), \
@


1.22.8.9
log
@Merge with the trunk
@
text
@a187 2
	cdev_ptm_init(NPTY,ptm),	/* 52: pseudo-tty ptm device */

@


1.21
log
@Add support for /dev/ksyms to arch-specific files
@
text
@d1 1
a1 1
/*	$OpenBSD: conf.c,v 1.20 1998/07/07 06:56:02 deraadt Exp $	*/
d150 4
d200 19
@


1.20
log
@oops, i did not handle nchrdev correctly
@
text
@d1 1
a1 1
/*	$OpenBSD: conf.c,v 1.19 1998/07/07 03:02:36 deraadt Exp $	*/
d148 2
d195 1
@


1.19
log
@fix chrtoblk() so that it returne ENODEV for entries beyond the end of the table
@
text
@d1 1
a1 1
/*	$OpenBSD: conf.c,v 1.18 1997/11/23 05:22:53 mickey Exp $	*/
d280 1
a280 1
	if (major(dev) >= MAXDEV ||
@


1.18
log
@use MI cdev_decl(ipl)
@
text
@d1 1
a1 1
/*	$OpenBSD: conf.c,v 1.17 1997/08/04 07:34:20 downsj Exp $	*/
a268 1
	/* 35 */	NODEV,
d280 2
a281 1
	if (major(dev) >= nchrdev)
@


1.17
log
@Add 35 to the chrtoblktb.
@
text
@d1 1
a1 1
/*	$OpenBSD: conf.c,v 1.16 1997/07/06 08:01:58 downsj Exp $	*/
a148 1
cdev_decl(ipl);
@


1.16
log
@Sync with changes from NetBSD, up to 970705.

This includes all of the new frodo drivers, from Michael Smith, hacked up
by Jason R. Thorpe; other changes, mostly configuration and/or m68k
abstraction related, from Thorpe.  A few others of my own.

This compiles and runs, have not yet tested Domain kbd or apci ports.
@
text
@d1 1
a1 1
/*	$OpenBSD: conf.c,v 1.15 1997/04/16 11:56:21 downsj Exp $	*/
d270 1
@


1.15
log
@Merge portions of NetBSD up to 970415.

This includes:
	* All of the prototyping and KNF changes.
	* The new interrupt system.
	* Portions of the Domain Keyboard support from Mike Smith.

This does not include:
	* m68k changes, namely generic dumps.

Various sundry changes and fixes by me.
@
text
@d1 2
a2 2
/*	$OpenBSD: conf.c,v 1.14 1997/02/16 14:37:11 downsj Exp $	*/
/*	$NetBSD: conf.c,v 1.38 1997/04/01 03:12:10 scottr Exp $	*/
d128 2
d193 1
d343 3
d375 3
@


1.14
log
@More rd changes that were missed...  Still not working.
@
text
@d1 2
a2 2
/*	$OpenBSD: conf.c,v 1.13 1997/02/16 10:42:22 downsj Exp $	*/
/*	$NetBSD: conf.c,v 1.34 1996/12/17 08:41:20 thorpej Exp $	*/
d210 1
d221 1
d272 1
@


1.13
log
@Add initial ram disk support.
@
text
@d1 1
a1 1
/*	$OpenBSD: conf.c,v 1.12 1997/02/03 08:12:00 downsj Exp $	*/
d261 4
d284 1
a284 1
 * Convert a character device number to a block device number.
@


1.12
log
@rd -> hd
@
text
@d1 1
a1 1
/*	$OpenBSD: conf.c,v 1.11 1997/02/03 04:47:55 downsj Exp $	*/
d62 2
d75 1
a75 1
	bdev_lkm_dummy(),		/* 8 */
d81 1
d145 1
d190 1
@


1.11
log
@Merge new config(8) support from NetBSD, by Jason Thorpe.
Also add siginfo glue, BOOT_CONFIG, and various other changes.
@
text
@d1 1
a1 1
/*	$OpenBSD: conf.c,v 1.10 1997/01/18 08:17:46 downsj Exp $	*/
d51 2
a52 2
#include "rd.h"
bdev_decl(rd);
d67 1
a67 1
	bdev_disk_init(NRD,rd),		/* 2: HPIB disk */
d118 1
a118 1
cdev_decl(rd);
d161 1
a161 1
	cdev_disk_init(NRD,rd),		/* 9: HPIB disk */
@


1.10
log
@move random, add ipl.
@
text
@d1 1
a1 1
/*	$OpenBSD: conf.c,v 1.9 1997/01/12 15:13:13 downsj Exp $	*/
a330 1
#ifdef NEWCONFIG
a335 9
#else /* ! NEWCONFIG */
#if NGRF > 0
#define	NDVBOX	1
#define	NGBOX	1
#define	NHYPER	1
#define	NRBOX	1
#define	NTOPCAT	1
#endif /* NGRF > 0 */
#endif /* NEWCONFIG */
@


1.9
log
@Mostly sync to NetBSD-current of 011196.  Compiles, links, boots to single
user.

KNOWN NOT WORKING:
	* DIO-II devices
	* Dynamic executables

NOT EVEN TRIED:
	* New config support
@
text
@d1 1
a1 1
/*	$OpenBSD$	*/
d143 7
d177 1
a177 1
	cdev_random_init(1,random),	/* 25: random generator */
d184 2
@


1.8
log
@random device is permanent now.
@
text
@d1 2
a2 1
/*	$NetBSD: conf.c,v 1.31 1996/03/14 21:26:28 christos Exp $	*/
a46 8
int	ttselect	__P((dev_t, int, struct proc *));

#ifndef LKM
#define	lkmenodev	enodev
#else
int	lkmenodev();
#endif

a140 6
#ifdef LKM
#define	NLKM	1
#else
#define	NLKM	0
#endif
cdev_decl(lkm);
d266 18
d316 1
a316 1
#define	dcacnpollc		nullcnpollc
d319 1
a319 1
#define	dcmcnpollc		nullcnpollc
d322 16
d340 1
a340 1
#if NGRF > 0			/* XXX */
d342 2
d345 2
d348 2
d351 2
d355 1
a355 1
#endif
@


1.7
log
@rnd -> random
@
text
@a153 1
#include "random.h"
d183 1
a183 1
	cdev_random_init(NRANDOM,random), /* 25: random generator */
@


1.6
log
@sync to 0622
@
text
@d154 2
d184 1
a184 1
	cdev_lkm_dummy(),		/* 25 */
d190 1
@


1.5
log
@remove #ifndef LKM, since that stuff already in sys/conf.h,
add lkmenodev prototype.
@
text
@d48 6
a154 8
/* open, close, read, ioctl */
cdev_decl(ipl);
#ifdef IPFILTER
#define NIPF 1
#else
#define NIPF 0
#endif

a187 1
	cdev_gen_ipf(NIPF,ipl),         /* 31: IP filter log */
@


1.4
log
@sync w/ Net 960424
@
text
@a47 6
#ifndef LKM
#define	lkmenodev	enodev
#else
int	lkmenodev();
#endif

@


1.3
log
@move cdev_gen_ipf() macro to the <sys/conf.h>, so the lkm
for ipl is possible and also, why it is in <machine/conf.c> while
it (ipl) is in <net/*> ???
@
text
@d1 1
a1 1
/*	$OpenBSD: conf.c,v 1.29 1995/07/04 07:16:04 mycroft Exp $	*/
d143 1
d186 1
a186 1
	cdev_fd_init(1,fd),		/* 21: file descriptor pseudo-device */
d293 26
a318 3
#define	itecnpollc	nullcnpollc
cons_decl(ite);
#define	dcacnpollc	nullcnpollc
d320 2
a321 1
#define	dcmcnpollc	nullcnpollc
d326 7
a332 1
	cons_init(ite),
@


1.2
log
@created devices for the IP filter log on all architectures
@
text
@d1 1
a1 1
/*	$NetBSD: conf.c,v 1.29 1995/07/04 07:16:04 mycroft Exp $	*/
a155 5
#define	cdev_gen_ipf(c,n) { \
	dev_init(c,n,open), dev_init(c,n,close), dev_init(c,n,read), \
	(dev_type_write((*))) enodev, dev_init(c,n,ioctl), \
	(dev_type_stop((*))) nullop, 0, (dev_type_select((*))) enodev, \
	(dev_type_mmap((*))) enodev, 0 }
@


1.1
log
@Initial revision
@
text
@d154 13
d200 1
@


1.1.1.1
log
@initial import of NetBSD tree
@
text
@@
