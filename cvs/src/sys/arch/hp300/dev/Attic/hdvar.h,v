head	1.13;
access;
symbols
	OPENBSD_5_5:1.12.0.4
	OPENBSD_5_5_BASE:1.12
	OPENBSD_5_4:1.11.0.10
	OPENBSD_5_4_BASE:1.11
	OPENBSD_5_3:1.11.0.8
	OPENBSD_5_3_BASE:1.11
	OPENBSD_5_2:1.11.0.6
	OPENBSD_5_2_BASE:1.11
	OPENBSD_5_1_BASE:1.11
	OPENBSD_5_1:1.11.0.4
	OPENBSD_5_0:1.11.0.2
	OPENBSD_5_0_BASE:1.11
	OPENBSD_4_9:1.10.0.18
	OPENBSD_4_9_BASE:1.10
	OPENBSD_4_8:1.10.0.16
	OPENBSD_4_8_BASE:1.10
	OPENBSD_4_7:1.10.0.12
	OPENBSD_4_7_BASE:1.10
	OPENBSD_4_6:1.10.0.14
	OPENBSD_4_6_BASE:1.10
	OPENBSD_4_5:1.10.0.10
	OPENBSD_4_5_BASE:1.10
	OPENBSD_4_4:1.10.0.8
	OPENBSD_4_4_BASE:1.10
	OPENBSD_4_3:1.10.0.6
	OPENBSD_4_3_BASE:1.10
	OPENBSD_4_2:1.10.0.4
	OPENBSD_4_2_BASE:1.10
	OPENBSD_4_1:1.10.0.2
	OPENBSD_4_1_BASE:1.10
	OPENBSD_4_0:1.8.0.4
	OPENBSD_4_0_BASE:1.8
	OPENBSD_3_9:1.8.0.2
	OPENBSD_3_9_BASE:1.8
	OPENBSD_3_8:1.5.0.10
	OPENBSD_3_8_BASE:1.5
	OPENBSD_3_7:1.5.0.8
	OPENBSD_3_7_BASE:1.5
	OPENBSD_3_6:1.5.0.6
	OPENBSD_3_6_BASE:1.5
	SMP_SYNC_A:1.5
	SMP_SYNC_B:1.5
	OPENBSD_3_5:1.5.0.4
	OPENBSD_3_5_BASE:1.5
	OPENBSD_3_4:1.5.0.2
	OPENBSD_3_4_BASE:1.5
	UBC_SYNC_A:1.4
	OPENBSD_3_3:1.4.0.2
	OPENBSD_3_3_BASE:1.4
	OPENBSD_3_2:1.3.0.8
	OPENBSD_3_2_BASE:1.3
	OPENBSD_3_1:1.3.0.6
	OPENBSD_3_1_BASE:1.3
	UBC_SYNC_B:1.3
	UBC:1.3.0.4
	UBC_BASE:1.3
	OPENBSD_3_0:1.3.0.2
	OPENBSD_3_0_BASE:1.3
	OPENBSD_2_9:1.2.0.20
	OPENBSD_2_9_BASE:1.2
	OPENBSD_2_8:1.2.0.18
	OPENBSD_2_8_BASE:1.2
	OPENBSD_2_7:1.2.0.16
	OPENBSD_2_7_BASE:1.2
	SMP:1.2.0.14
	SMP_BASE:1.2
	kame_19991208:1.2
	OPENBSD_2_6:1.2.0.12
	OPENBSD_2_6_BASE:1.2
	OPENBSD_2_5:1.2.0.10
	OPENBSD_2_5_BASE:1.2
	OPENBSD_2_4:1.2.0.8
	OPENBSD_2_4_BASE:1.2
	OPENBSD_2_3:1.2.0.6
	OPENBSD_2_3_BASE:1.2
	OPENBSD_2_2:1.2.0.4
	OPENBSD_2_2_BASE:1.2
	OPENBSD_2_1:1.2.0.2
	OPENBSD_2_1_BASE:1.2;
locks; strict;
comment	@ * @;


1.13
date	2014.03.18.22.36.32;	author miod;	state dead;
branches;
next	1.12;

1.12
date	2013.11.20.00.12.37;	author dlg;	state Exp;
branches;
next	1.11;

1.11
date	2011.06.05.18.40.33;	author matthew;	state Exp;
branches;
next	1.10;

1.10
date	2007.02.21.22.32.05;	author miod;	state Exp;
branches;
next	1.9;

1.9
date	2007.02.21.11.01.10;	author mickey;	state Exp;
branches;
next	1.8;

1.8
date	2005.11.18.00.09.15;	author miod;	state Exp;
branches;
next	1.7;

1.7
date	2005.11.14.20.20.30;	author miod;	state Exp;
branches;
next	1.6;

1.6
date	2005.11.12.23.10.04;	author miod;	state Exp;
branches;
next	1.5;

1.5
date	2003.06.02.23.27.44;	author millert;	state Exp;
branches;
next	1.4;

1.4
date	2002.12.25.20.56.59;	author miod;	state Exp;
branches;
next	1.3;

1.3
date	2001.05.01.16.51.09;	author millert;	state Exp;
branches
	1.3.4.1;
next	1.2;

1.2
date	97.02.10.01.33.56;	author downsj;	state Exp;
branches
	1.2.14.1;
next	1.1;

1.1
date	97.02.03.08.11.55;	author downsj;	state Exp;
branches;
next	;

1.2.14.1
date	2001.07.04.10.15.29;	author niklas;	state Exp;
branches;
next	1.2.14.2;

1.2.14.2
date	2003.03.27.23.19.19;	author niklas;	state Exp;
branches;
next	1.2.14.3;

1.2.14.3
date	2003.06.07.11.11.34;	author ho;	state Exp;
branches;
next	;

1.3.4.1
date	2003.05.19.21.39.16;	author tedu;	state Exp;
branches;
next	;


desc
@@


1.13
log
@Retire hp300, mvme68k and mvme88k ports. These ports have no users, keeping
this hardware alive is becoming increasingly difficult, and I should heed the
message sent by the three disks which have died on me over the last few days.

Noone sane will mourn these ports anyway. So long, and thanks for the fish.
@
text
@/*	$OpenBSD: hdvar.h,v 1.12 2013/11/20 00:12:37 dlg Exp $	*/
/*	$NetBSD: rdvar.h,v 1.6 1997/01/30 09:14:19 thorpej Exp $	*/

/*
 * Copyright (c) 1988 University of Utah.
 * Copyright (c) 1982, 1990, 1993
 *	The Regents of the University of California.  All rights reserved.
 *
 * This code is derived from software contributed to Berkeley by
 * the Systems Programming Group of the University of Utah Computer
 * Science Department.
 *
 * Redistribution and use in source and binary forms, with or without
 * modification, are permitted provided that the following conditions
 * are met:
 * 1. Redistributions of source code must retain the above copyright
 *    notice, this list of conditions and the following disclaimer.
 * 2. Redistributions in binary form must reproduce the above copyright
 *    notice, this list of conditions and the following disclaimer in the
 *    documentation and/or other materials provided with the distribution.
 * 3. Neither the name of the University nor the names of its contributors
 *    may be used to endorse or promote products derived from this software
 *    without specific prior written permission.
 *
 * THIS SOFTWARE IS PROVIDED BY THE REGENTS AND CONTRIBUTORS ``AS IS'' AND
 * ANY EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT LIMITED TO, THE
 * IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE
 * ARE DISCLAIMED.  IN NO EVENT SHALL THE REGENTS OR CONTRIBUTORS BE LIABLE
 * FOR ANY DIRECT, INDIRECT, INCIDENTAL, SPECIAL, EXEMPLARY, OR CONSEQUENTIAL
 * DAMAGES (INCLUDING, BUT NOT LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS
 * OR SERVICES; LOSS OF USE, DATA, OR PROFITS; OR BUSINESS INTERRUPTION)
 * HOWEVER CAUSED AND ON ANY THEORY OF LIABILITY, WHETHER IN CONTRACT, STRICT
 * LIABILITY, OR TORT (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY
 * OUT OF THE USE OF THIS SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF
 * SUCH DAMAGE.
 *
 * from: Utah $Hdr: rdvar.h 1.1 92/12/21$
 *
 *	@@(#)rdvar.h	8.1 (Berkeley) 6/10/93
 */

struct	hdidentinfo {
	short	ri_hwid;		/* 2 byte HW id */
	short	ri_maxunum;		/* maximum allowed unit number */
	char	*ri_desc;		/* drive type description */
	int	ri_nbpt;		/* DEV_BSIZE blocks per track */
	int	ri_ntpc;		/* tracks per cylinder */
	int	ri_ncyl;		/* cylinders per unit */
	int	ri_nblocks;		/* DEV_BSIZE blocks on disk */
};

struct hdstats {
	long	hdretries;
	long	hdtimeouts;
	long	hdpolltries;
	long	hdpollwaits;
};

struct	hd_softc {
	struct	device sc_dev;
	struct	disk sc_dkdev;
	int	sc_slave;		/* HP-IB slave */
	int	sc_punit;		/* physical unit on slave */
	int	sc_flags;
	short	sc_type;
	char	*sc_addr;
	int	sc_resid;
	int	sc_errcnt;
	struct	hpibqueue sc_hq;	/* hpib job queue entry */
	struct	hd_iocmd sc_ioc;
	struct	hd_rscmd sc_rsc;
	struct	hd_stat sc_stat;
	struct	bufq sc_bufq;		/* buffer queue */
	struct	buf *sc_bp;
#ifdef DEBUG
	struct	hdstats sc_stats;
#endif
	struct	timeout sc_timeout;
};

/* sc_flags values */
#define	HDF_SEEK	0x01
#define HDF_SWAIT	0x02
#define HDF_OPENING	0x04
#define HDF_CLOSING	0x08
#define HDF_WANTED	0x10

#ifdef _KERNEL
extern	const struct hdidentinfo hdidentinfo[];
#endif
@


1.12
log
@replace bare use of disksort with bufqs.

uebayashi@@ made sure it compiled
go ahead miod@@
@
text
@d1 1
a1 1
/*	$OpenBSD: hdvar.h,v 1.11 2011/06/05 18:40:33 matthew Exp $	*/
@


1.11
log
@Drop kernel support for the useless DIOCWLABEL ioctl and prune a lot
of silly flag twiddling code in various disk drivers.

ok deraadt@@, miod@@

N.B., users will need a -current disklabel(8) to be able to write new
disklabels to disk now.
@
text
@d1 1
a1 1
/*	$OpenBSD: hdvar.h,v 1.10 2007/02/21 22:32:05 miod Exp $	*/
d73 2
a74 1
	struct	buf sc_tab;		/* buffer queue */
@


1.10
log
@Long awaiting modernization:
- reset the drive and fetch its identification strings during probe, and do
  not attach if they don't look good.
- do not store synchronous command blocks (used by hdreset) in the softc,
  since they are not processed asynchronously. The stack will do.
- cleanup the disklabel retrieval code.
- use disk_{,un}lock instead of rolling our own equivalent.
- use bounds_check_with_label() in hdstrategy() instead of a stripped-down
  inline version of it.
Tested on 7957A.
@
text
@d1 1
a1 1
/*	$OpenBSD: hdvar.h,v 1.9 2007/02/21 11:01:10 mickey Exp $	*/
a85 1
#define HDF_WLABEL	0x20
@


1.9
log
@remove part of buf abuse and store errcnt in softc (instead of b_errcnt); more work can be done to lower buf abuse even more; miod@@ testing and ok
@
text
@d1 1
a1 1
/*	$OpenBSD: hdvar.h,v 1.8 2005/11/18 00:09:15 miod Exp $	*/
a53 1
	long	hdresets;
a72 3
	struct	hd_ssmcmd sc_ssmc;
	struct	hd_srcmd sc_src;
	struct	hd_clearcmd sc_clear;
d74 1
d76 1
d81 6
a86 7
#define	HDF_ALIVE	0x01
#define	HDF_SEEK	0x02
#define HDF_SWAIT	0x04
#define HDF_OPENING	0x08
#define HDF_CLOSING	0x10
#define HDF_WANTED	0x20
#define HDF_WLABEL	0x40
@


1.8
log
@Define the CS/80 identify structure only once and correctly, instead of
duplicating it in every CS/80 driver and using an hardcoded number for its size.
No functional change.
@
text
@d1 1
a1 1
/*	$OpenBSD: hdvar.h,v 1.7 2005/11/14 20:20:30 miod Exp $	*/
d69 1
@


1.7
log
@Make HDWAITC and HDRETRY overridable in the kernel configuration file;
while there, constify option DEBUG message tables.
@
text
@d1 1
a1 1
/*	$OpenBSD: hdvar.h,v 1.6 2005/11/12 23:10:04 miod Exp $	*/
a68 1
	struct	hd_describe sc_hddesc;
@


1.6
log
@Constify, and simplify hdgetinfo() which only gets called for known disks.
@
text
@d1 1
a1 1
/*	$OpenBSD: hdvar.h,v 1.5 2003/06/02 23:27:44 millert Exp $	*/
a89 9

#define	HDUNIT(x)	DISKUNIT(x)
#define HDPART(x)	DISKPART(x)
#define HDLABELDEV(d)	MAKEDISKDEV(major(d), HDUNIT(d), RAW_PART)

#define	b_cylin		b_resid

#define	HDRETRY		5
#define HDWAITC		1	/* min time for timeout in seconds */
@


1.5
log
@Remove the advertising clause in the UCB license which Berkeley
rescinded 22 July 1999.  Proofed by myself and Theo.
@
text
@d1 1
a1 1
/*	$OpenBSD: hdvar.h,v 1.4 2002/12/25 20:56:59 miod Exp $	*/
d101 1
a101 1
extern	struct hdidentinfo hdidentinfo[];
@


1.4
log
@Turn xxUNIT, xxPARt, xxLABELDEV macro names into uppercase.
@
text
@d1 1
a1 1
/*	$OpenBSD: hdvar.h,v 1.3 2001/05/01 16:51:09 millert Exp $	*/
d21 1
a21 5
 * 3. All advertising materials mentioning features or use of this software
 *    must display the following acknowledgement:
 *	This product includes software developed by the University of
 *	California, Berkeley and its contributors.
 * 4. Neither the name of the University nor the names of its contributors
@


1.3
log
@convert to new timeouts
@
text
@d1 1
a1 1
/*	$OpenBSD: hdvar.h,v 1.2 1997/02/10 01:33:56 downsj Exp $	*/
d95 3
a97 3
#define	hdunit(x)	DISKUNIT(x)
#define hdpart(x)	DISKPART(x)
#define hdlabdev(d)	MAKEDISKDEV(major(d), hdunit(d), RAW_PART)
@


1.3.4.1
log
@sync
@
text
@d1 1
a1 1
/*	$OpenBSD$	*/
d95 3
a97 3
#define	HDUNIT(x)	DISKUNIT(x)
#define HDPART(x)	DISKPART(x)
#define HDLABELDEV(d)	MAKEDISKDEV(major(d), HDUNIT(d), RAW_PART)
@


1.2
log
@Support 16 partitions.
@
text
@d1 1
a1 1
/*	$OpenBSD: hdvar.h,v 1.1 1997/02/03 08:11:55 downsj Exp $	*/
d83 1
@


1.2.14.1
log
@Merge in -current from two days ago in the SMP branch.
As usual with merges, they do not indicate progress, so do not hold
your breath for working SMP, and do not mail me and ask about the
state of it.  It has not changed.  There is work ongoing, but very, very
slowly.  The commit is done in parts as to not lock up the tree in too
big chunks at a time.
@
text
@d1 1
a1 1
/*	$OpenBSD: hdvar.h,v 1.2 1997/02/10 01:33:56 downsj Exp $	*/
a82 1
	struct	timeout sc_timeout;
@


1.2.14.2
log
@Sync the SMP branch with 3.3
@
text
@d1 1
a1 1
/*	$OpenBSD$	*/
d95 3
a97 3
#define	HDUNIT(x)	DISKUNIT(x)
#define HDPART(x)	DISKPART(x)
#define HDLABELDEV(d)	MAKEDISKDEV(major(d), HDUNIT(d), RAW_PART)
@


1.2.14.3
log
@Sync SMP branch to -current
@
text
@d1 1
a1 1
/*	$OpenBSD: hdvar.h,v 1.2.14.2 2003/03/27 23:19:19 niklas Exp $	*/
d21 5
a25 1
 * 3. Neither the name of the University nor the names of its contributors
@


1.1
log
@rd -> hd
@
text
@d1 1
a1 1
/*	$OpenBSD: rdvar.h,v 1.6 1997/02/03 04:47:43 downsj Exp $	*/
d94 3
a96 4
#define	hdunit(x)	(minor(x) >> 3)
#define hdpart(x)	(minor(x) & 0x7)
#define	hdpunit(x)	((x) & 7)
#define hdlabdev(d)	(dev_t)(((int)(d)&~7)|2)	/* hd?c */
@
