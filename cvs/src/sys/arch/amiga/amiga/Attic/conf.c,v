head	1.38;
access;
symbols
	SMP_SYNC_A:1.38
	SMP_SYNC_B:1.38
	UBC_SYNC_A:1.38
	OPENBSD_3_2:1.36.0.2
	OPENBSD_3_2_BASE:1.36
	OPENBSD_3_1:1.34.0.2
	OPENBSD_3_1_BASE:1.34
	UBC_SYNC_B:1.36
	UBC:1.33.0.2
	UBC_BASE:1.33
	OPENBSD_3_0:1.32.0.2
	OPENBSD_3_0_BASE:1.32
	OPENBSD_2_9:1.29.0.4
	OPENBSD_2_9_BASE:1.29
	OPENBSD_2_8:1.29.0.2
	OPENBSD_2_8_BASE:1.29
	OPENBSD_2_7:1.26.0.6
	OPENBSD_2_7_BASE:1.26
	SMP:1.26.0.4
	SMP_BASE:1.26
	kame_19991208:1.26
	OPENBSD_2_6:1.26.0.2
	OPENBSD_2_6_BASE:1.26
	OPENBSD_2_5:1.25.0.4
	OPENBSD_2_5_BASE:1.25
	OPENBSD_2_4:1.25.0.2
	OPENBSD_2_4_BASE:1.25
	OPENBSD_2_3:1.19.0.4
	OPENBSD_2_3_BASE:1.19
	OPENBSD_2_2:1.19.0.2
	OPENBSD_2_2_BASE:1.19
	OPENBSD_2_1:1.17.0.2
	OPENBSD_2_1_BASE:1.17
	OPENBSD_2_0:1.13.0.2
	OPENBSD_2_0_BASE:1.13
	netbsd_1_1:1.1.1.1;
locks; strict;
comment	@ * @;


1.38
date	2002.12.31.16.35.36;	author miod;	state dead;
branches;
next	1.37;

1.37
date	2002.12.05.02.49.55;	author kjc;	state Exp;
branches;
next	1.36;

1.36
date	2002.06.11.03.25.30;	author miod;	state Exp;
branches;
next	1.35;

1.35
date	2002.05.16.21.11.13;	author miod;	state Exp;
branches;
next	1.34;

1.34
date	2002.03.14.01.26.28;	author millert;	state Exp;
branches;
next	1.33;

1.33
date	2001.12.11.23.19.02;	author miod;	state Exp;
branches
	1.33.2.1;
next	1.32;

1.32
date	2001.09.28.02.53.13;	author mickey;	state Exp;
branches;
next	1.31;

1.31
date	2001.06.27.06.56.27;	author kjc;	state Exp;
branches;
next	1.30;

1.30
date	2001.06.25.03.19.44;	author kjell;	state Exp;
branches;
next	1.29;

1.29
date	2000.10.12.19.36.51;	author espie;	state Exp;
branches;
next	1.28;

1.28
date	2000.09.26.14.03.51;	author art;	state Exp;
branches;
next	1.27;

1.27
date	2000.09.02.13.45.38;	author espie;	state Exp;
branches;
next	1.26;

1.26
date	99.07.30.19.41.29;	author deraadt;	state Exp;
branches
	1.26.4.1;
next	1.25;

1.25
date	98.09.25.09.20.52;	author todd;	state Exp;
branches;
next	1.24;

1.24
date	98.08.24.05.30.06;	author millert;	state Exp;
branches;
next	1.23;

1.23
date	98.07.20.00.49.23;	author espie;	state Exp;
branches;
next	1.22;

1.22
date	98.07.07.06.55.56;	author deraadt;	state Exp;
branches;
next	1.21;

1.21
date	98.07.07.03.02.30;	author deraadt;	state Exp;
branches;
next	1.20;

1.20
date	98.04.26.22.30.57;	author niklas;	state Exp;
branches;
next	1.19;

1.19
date	97.10.16.06.48.12;	author niklas;	state Exp;
branches;
next	1.18;

1.18
date	97.09.18.13.39.34;	author niklas;	state Exp;
branches;
next	1.17;

1.17
date	97.05.13.13.24.46;	author niklas;	state Exp;
branches;
next	1.16;

1.16
date	97.01.16.09.23.16;	author niklas;	state Exp;
branches;
next	1.15;

1.15
date	96.11.28.23.33.02;	author niklas;	state Exp;
branches;
next	1.14;

1.14
date	96.10.19.13.26.03;	author mickey;	state Exp;
branches;
next	1.13;

1.13
date	96.10.05.15.47.50;	author niklas;	state Exp;
branches;
next	1.12;

1.12
date	96.08.29.09.25.51;	author deraadt;	state Exp;
branches;
next	1.11;

1.11
date	96.08.19.00.02.29;	author niklas;	state Exp;
branches;
next	1.10;

1.10
date	96.07.15.14.57.00;	author mickey;	state Exp;
branches;
next	1.9;

1.9
date	96.05.29.10.14.22;	author niklas;	state Exp;
branches;
next	1.8;

1.8
date	96.05.07.10.02.51;	author niklas;	state Exp;
branches;
next	1.7;

1.7
date	96.05.04.09.16.04;	author niklas;	state Exp;
branches;
next	1.6;

1.6
date	96.05.02.06.43.13;	author niklas;	state Exp;
branches;
next	1.5;

1.5
date	96.04.27.18.38.45;	author niklas;	state Exp;
branches;
next	1.4;

1.4
date	96.03.30.22.18.06;	author niklas;	state Exp;
branches;
next	1.3;

1.3
date	96.02.21.12.53.41;	author mickey;	state Exp;
branches;
next	1.2;

1.2
date	96.01.07.07.40.59;	author dm;	state Exp;
branches;
next	1.1;

1.1
date	95.10.18.08.49.52;	author deraadt;	state Exp;
branches
	1.1.1.1;
next	;

1.1.1.1
date	95.10.18.08.49.52;	author deraadt;	state Exp;
branches;
next	;

1.26.4.1
date	2001.04.18.16.01.55;	author niklas;	state Exp;
branches;
next	1.26.4.2;

1.26.4.2
date	2001.07.04.10.14.55;	author niklas;	state Exp;
branches;
next	1.26.4.3;

1.26.4.3
date	2001.10.31.02.52.45;	author nate;	state Exp;
branches;
next	1.26.4.4;

1.26.4.4
date	2002.03.06.00.56.18;	author niklas;	state Exp;
branches;
next	1.26.4.5;

1.26.4.5
date	2002.03.28.10.06.14;	author niklas;	state Exp;
branches;
next	1.26.4.6;

1.26.4.6
date	2003.03.27.23.19.16;	author niklas;	state dead;
branches;
next	;

1.33.2.1
date	2002.06.11.03.34.57;	author art;	state Exp;
branches;
next	1.33.2.2;

1.33.2.2
date	2002.10.29.00.28.01;	author art;	state Exp;
branches;
next	1.33.2.3;

1.33.2.3
date	2003.05.19.21.49.37;	author tedu;	state dead;
branches;
next	;


desc
@@


1.38
log
@amiga and sun3 turned out to not be y2k+3 compliant here. Remove them, as
well as the few userland tools which were only used on these platforms.
@
text
@/*	$OpenBSD: conf.c,v 1.37 2002/12/05 02:49:55 kjc Exp $	*/
/*	$NetBSD: conf.c,v 1.42 1997/01/07 11:35:03 mrg Exp $	*/

/*-
 * Copyright (c) 1991 The Regents of the University of California.
 * All rights reserved.
 *
 * Redistribution and use in source and binary forms, with or without
 * modification, are permitted provided that the following conditions
 * are met:
 * 1. Redistributions of source code must retain the above copyright
 *    notice, this list of conditions and the following disclaimer.
 * 2. Redistributions in binary form must reproduce the above copyright
 *    notice, this list of conditions and the following disclaimer in the
 *    documentation and/or other materials provided with the distribution.
 * 3. All advertising materials mentioning features or use of this software
 *    must display the following acknowledgement:
 *	This product includes software developed by the University of
 *	California, Berkeley and its contributors.
 * 4. Neither the name of the University nor the names of its contributors
 *    may be used to endorse or promote products derived from this software
 *    without specific prior written permission.
 *
 * THIS SOFTWARE IS PROVIDED BY THE REGENTS AND CONTRIBUTORS ``AS IS'' AND
 * ANY EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT LIMITED TO, THE
 * IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE
 * ARE DISCLAIMED.  IN NO EVENT SHALL THE REGENTS OR CONTRIBUTORS BE LIABLE
 * FOR ANY DIRECT, INDIRECT, INCIDENTAL, SPECIAL, EXEMPLARY, OR CONSEQUENTIAL
 * DAMAGES (INCLUDING, BUT NOT LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS
 * OR SERVICES; LOSS OF USE, DATA, OR PROFITS; OR BUSINESS INTERRUPTION)
 * HOWEVER CAUSED AND ON ANY THEORY OF LIABILITY, WHETHER IN CONTRACT, STRICT
 * LIABILITY, OR TORT (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY
 * OUT OF THE USE OF THIS SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF
 * SUCH DAMAGE.
 *
 *      @@(#)conf.c	7.9 (Berkeley) 5/28/91
 */

#include <sys/param.h>
#include <sys/systm.h>
#include <sys/buf.h>
#include <sys/ioctl.h>
#include <sys/tty.h>
#include <sys/vnode.h>
#include <dev/cons.h>

#include <machine/conf.h>

#ifdef BANKEDDEVPAGER
#include <sys/bankeddev.h>
#endif

#include "vnd.h"
#include "sd.h"
#include "cd.h"
#include "st.h"
#include "fd.h"
#include "ccd.h"
#include "ss.h"
#include "wd.h"
#include "rd.h"
#include "ch.h"
#ifdef XFS
#include <xfs/nxfs.h>
cdev_decl(xfs_dev);
#endif
#include "ksyms.h"

struct bdevsw	bdevsw[] =
{
	bdev_disk_init(NWD,wd),	/* 0: ST506/ESDI/IDE disk */
	bdev_notdef(),			/* 1 */
	bdev_disk_init(NFD,fd),		/* 2: floppy disk */
	bdev_swap_init(1,sw),		/* 3: swap pseudo-device */
	bdev_disk_init(NSD,sd),		/* 4: SCSI disk */
	bdev_tape_init(NST,st),		/* 5: SCSI tape */
	bdev_disk_init(NVND,vnd),	/* 6: vnode disk driver */
	bdev_disk_init(NCD,cd),		/* 7: SCSI CD-ROM */
	bdev_disk_init(NCCD,ccd),	/* 8: concatenated disk driver */
	bdev_lkm_dummy(),		/* 9 */
	bdev_lkm_dummy(),		/* 10 */
	bdev_lkm_dummy(),		/* 11 */
	bdev_lkm_dummy(),		/* 12 */
	bdev_lkm_dummy(),		/* 13 */
	bdev_lkm_dummy(),		/* 14 */
	bdev_notdef(),			/* 15 */
	bdev_disk_init(NRD,rd),		/* 16: ram disk driver */
};
int	nblkdev = sizeof(bdevsw) / sizeof(bdevsw[0]);

#include "pty.h"
#include "grf.h"
#include "par.h"
#include "ser.h"
#include "msc.h"
#include "ite.h"
#include "joy.h"
#include "kbd.h"
#include "ms.h"
#include "view.h"
#include "mfcs.h"
#include "bpfilter.h"
#include "tun.h"
#include "com.h"
#include "lpt.h"
#include "uk.h"
#include "audio.h"

/* open, close, read */
#define cdev_joy_init(c,n) { \
	dev_init(c,n,open), dev_init(c,n,close), dev_init(c,n,read), \
	(dev_type_write((*)))enodev, (dev_type_ioctl((*)))enodev, \
	(dev_type_stop((*)))enodev, 0, seltrue, \
	(dev_type_mmap((*)))enodev }

#include "pf.h"

#include "systrace.h"

struct cdevsw	cdevsw[] =
{
	cdev_cn_init(1,cn),		/* 0: virtual console */
	cdev_ctty_init(1,ctty),		/* 1: controlling terminal */
	cdev_mm_init(1,mm),		/* 2: /dev/{null,mem,kmem,...} */
	cdev_swap_init(1,sw),		/* 3: /dev/drum (swap pseudo-device) */
	cdev_tty_init(NPTY,pts),	/* 4: pseudo-tty slave */
	cdev_ptc_init(NPTY,ptc),	/* 5: pseudo-tty master */
	cdev_log_init(1,log),		/* 6: /dev/klog */
	cdev_disk_init(NCCD,ccd),	/* 7: concatenated disk driver */
	cdev_disk_init(NSD,sd),		/* 8: SCSI disk */
	cdev_disk_init(NCD,cd),		/* 9: SCSI CD-ROM */
	cdev_grf_init(NGRF,grf),	/* 10: frame buffer */
	cdev_par_init(NPAR,par),	/* 11: parallel interface */
	cdev_tty_init(NSER,ser),	/* 12: built-in single-port serial */
	cdev_tty_init(NITE,ite),	/* 13: console terminal emulator */
	cdev_mouse_init(NKBD,kbd),	/* 14: /dev/kbd */
	cdev_mouse_init(NMS,ms),	/* 15: /dev/mouse0 /dev/mouse1 */
	cdev_view_init(NVIEW,view),	/* 16: /dev/view00 /dev/view01 ... */
	cdev_tty_init(NMFCS,mfcs),	/* 17: MultiFaceCard III serial */
	cdev_disk_init(NFD,fd),		/* 18: floppy disk */
	cdev_disk_init(NVND,vnd),	/* 19: vnode disk driver */
	cdev_tape_init(NST,st),		/* 20: SCSI tape */
	cdev_fd_init(1,filedesc),	/* 21: file descriptor pseudo-dev */
	cdev_bpftun_init(NBPFILTER,bpf),/* 22: Berkeley packet filter */
	cdev_bpftun_init(NTUN,tun),	/* 23: network tunnel */
	cdev_lkm_init(NLKM,lkm),	/* 24: loadable module driver */
	cdev_scanner_init(NSS,ss),	/* 25: SCSI scanner */
	cdev_lkm_dummy(),		/* 26 */
	cdev_lkm_dummy(),		/* 27 */
	cdev_lkm_dummy(),		/* 28 */
	cdev_lkm_dummy(),		/* 29 */
	cdev_lkm_dummy(),		/* 30 */
 	cdev_tty_init(NMSC,msc),	/* 31: A2232 MSC Multiport serial */
	cdev_tty_init(NCOM,com),	/* 32: ISA serial port */
	cdev_lpt_init(NLPT,lpt),	/* 33: ISA parallel printer */
	cdev_pf_init(NPF,pf),		/* 34: packet filter */
	cdev_random_init(1,random),	/* 35: random data source */
	cdev_uk_init(NUK,uk),		/* 36: unknown SCSI */
	cdev_disk_init(NWD,wd),		/* 37: ST506/ESDI/IDE disk */
	cdev_notdef(),			/* 38 */
	cdev_audio_init(NAUDIO,audio),	/* 39: cc audio interface */
	cdev_ch_init(NCH,ch),		/* 40: SCSI autochanger */
	cdev_disk_init(NRD,rd),		/* 41: RAM disk */
	cdev_ksyms_init(NKSYMS,ksyms),	/* 42: Kernel symbols device */
	cdev_joy_init(NJOY,joy),	/* 43: Joystick */
	cdev_notdef(),			/* 44 */
	cdev_notdef(),			/* 45 */
	cdev_notdef(),			/* 46 */
	cdev_notdef(),			/* 46 */
	cdev_notdef(),			/* 47 */
	cdev_notdef(),			/* 48 */
	cdev_notdef(),			/* 49 */
	cdev_systrace_init(NSYSTRACE,systrace),	/* 50 system call tracing */
#ifdef XFS
	cdev_xfs_init(NXFS,xfs_dev),	/* 51: xfs communication device */
#else
	cdev_notdef(),			/* 51 */
#endif
};
int	nchrdev = sizeof(cdevsw) / sizeof(cdevsw[0]);

#ifdef BANKEDDEVPAGER
extern int grfbanked_get(int, int, int);
extern int grfbanked_set(int, int);
extern int grfbanked_cur(int);

struct bankeddevsw bankeddevsw[sizeof (cdevsw) / sizeof (cdevsw[0])] = {
  { 0, 0, 0 },						/* 0 */
  { 0, 0, 0 },						/* 1 */
  { 0, 0, 0 },						/* 2 */
  { 0, 0, 0 },						/* 3 */
  { 0, 0, 0 },						/* 4 */
  { 0, 0, 0 },						/* 5 */
  { 0, 0, 0 },						/* 6 */
  { 0, 0, 0 },						/* 7 */
  { 0, 0, 0 },						/* 8 */
  { 0, 0, 0 },						/* 9 */
  { grfbanked_get, grfbanked_cur, grfbanked_set },	/* 10 */
  /* rest { 0, 0, 0 } */
};
#endif

int	mem_no = 2; 	/* major device number of memory special file */

/*
 * Swapdev is a fake device implemented
 * in sw.c used only internally to get to swstrategy.
 * It cannot be provided to the users, because the
 * swstrategy routine munches the b_dev and b_blkno entries
 * before calling the appropriate driver.  This would horribly
 * confuse, e.g. the hashing routines. Instead, /dev/drum is
 * provided as a character (raw) device.
 */
dev_t	swapdev = makedev(3, 0);

/*
 * Returns true if dev is /dev/mem or /dev/kmem.
 */
int
iskmemdev(dev)
	dev_t dev;
{

	return (major(dev) == mem_no && minor(dev) < 2);
}

/*
 * Returns true if dev is /dev/zero.
 */
int
iszerodev(dev)
	dev_t dev;
{

	return (major(dev) == mem_no && minor(dev) == 12);
}

dev_t
getnulldev()
{
	return makedev(mem_no, 2);
}

static int chrtoblktab[] = {
	/* XXXX This needs to be dynamic for LKMs. */
	/*VCHR*/	/*VBLK*/
	/*  0 */	NODEV,
	/*  1 */	NODEV,
	/*  2 */	NODEV,
	/*  3 */	NODEV,
	/*  4 */	NODEV,
	/*  5 */	NODEV,
	/*  6 */	NODEV,
	/*  7 */	8,		/* ccd */
	/*  8 */	4,		/* sd */
	/*  9 */	7,		/* cd */
	/* 10 */	NODEV,
	/* 11 */	NODEV,
	/* 12 */	NODEV,
	/* 13 */	NODEV,
	/* 14 */	NODEV,
	/* 15 */	NODEV,
	/* 16 */	NODEV,
	/* 17 */	NODEV,
	/* 18 */	2,		/* fd */
	/* 19 */	6,		/* vnd */
	/* 20 */	5,		/* st */
	/* 21 */	NODEV,
	/* 22 */	NODEV,
	/* 23 */	NODEV,
	/* 24 */	NODEV,
	/* 25 */	NODEV,
	/* 26 */	NODEV,
	/* 27 */	NODEV,
	/* 28 */	NODEV,
	/* 29 */	NODEV,
	/* 30 */	NODEV,
	/* 31 */	NODEV,
	/* 32 */	NODEV,
	/* 33 */	NODEV,
	/* 34 */	NODEV,
	/* 35 */	NODEV,
	/* 36 */	NODEV,
	/* 37 */	0,		/* wd */
	/* 38 */	NODEV,
	/* 39 */	NODEV,
	/* 40 */	NODEV,
	/* 41 */	16,		/* rd */
};

/*
 * Convert a character device number to a block device number.
 */
int
chrtoblk(dev)
	dev_t dev;
{
	int blkmaj;

	if (major(dev) >= nchrdev ||
	    major(dev) > sizeof(chrtoblktab)/sizeof(chrtoblktab[0]))
		return (NODEV);
	blkmaj = chrtoblktab[major(dev)];
	if (blkmaj == NODEV)
		return (NODEV);
	return (makedev(blkmaj, minor(dev)));
}

/*
 * Convert a character device number to a block device number.
 */
dev_t
blktochr(dev)
	dev_t dev;
{
	int blkmaj = major(dev);
	int i;

	if (blkmaj >= nblkdev)
		return (NODEV);
	for (i = 0; i < sizeof(chrtoblktab)/sizeof(chrtoblktab[0]); i++)
		if (blkmaj == chrtoblktab[i])
			return (makedev(i, minor(dev)));
	return (NODEV);
}

/*
 * This entire table could be autoconfig()ed but that would mean that
 * the kernel's idea of the console would be out of sync with that of
 * the standalone boot.  I think it best that they both use the same
 * known algorithm unless we see a pressing need otherwise.
 */
cons_decl(com);
cons_decl(ite);
cons_decl(ser);

struct	consdev constab[] = {
#if NSER > 0
	cons_init(ser),
#endif
#if NITE > 0
	cons_init(ite),
#endif
#ifdef notyet
#if NCOM > 0
	cons_init(com),
#endif
#endif
	{ 0 },
};
@


1.37
log
@remove altq entries.
altq is merged into pf and handled through pf.
@
text
@d1 1
a1 1
/*	$OpenBSD: conf.c,v 1.36 2002/06/11 03:25:30 miod Exp $	*/
@


1.36
log
@Include <sys/conf.h> from <machine/conf.h> like in other arches.  Changes
to come soon depend on this.
@
text
@d1 1
a1 1
/*	$OpenBSD: conf.c,v 1.35 2002/05/16 21:11:13 miod Exp $	*/
a117 2
#include <altq/altqconf.h>

a178 1
	cdev_altq_init(NALTQ,altq),	/* 52: ALTQ control interface */
@


1.35
log
@Add systrace support to all the remaining architectures.

Tested by various people on various platforms, I'm willing to fix any
breakage this causes.

ok niels@@ deraadt@@ and mickey@@ (after his comments were applied)
@
text
@d1 1
a1 1
/*	$OpenBSD: conf.c,v 1.34 2002/03/14 01:26:28 millert Exp $	*/
a43 1
#include <sys/conf.h>
@


1.34
log
@First round of __P removal in sys
@
text
@d1 1
a1 1
/*	$OpenBSD: conf.c,v 1.33 2001/12/11 23:19:02 miod Exp $	*/
d121 2
d176 1
a176 1
	cdev_notdef(),			/* 50 */
@


1.33
log
@Remove declarations that already exist in <sys/conf.h>
@
text
@d1 1
a1 1
/*	$OpenBSD: conf.c,v 1.32 2001/09/28 02:53:13 mickey Exp $	*/
d185 3
a187 3
extern int grfbanked_get __P((int, int, int));
extern int grfbanked_set __P((int, int));
extern int grfbanked_cur __P((int));
@


1.33.2.1
log
@Sync UBC branch to -current
@
text
@d1 1
a1 1
/*	$OpenBSD: conf.c,v 1.33 2001/12/11 23:19:02 miod Exp $	*/
a120 2
#include "systrace.h"

d174 1
a174 1
	cdev_systrace_init(NSYSTRACE,systrace),	/* 50 system call tracing */
d185 3
a187 3
extern int grfbanked_get(int, int, int);
extern int grfbanked_set(int, int);
extern int grfbanked_cur(int);
@


1.33.2.2
log
@sync to -current
@
text
@d1 1
a1 1
/*	$OpenBSD: conf.c,v 1.33.2.1 2002/06/11 03:34:57 art Exp $	*/
d44 1
@


1.33.2.3
log
@sync
@
text
@d1 1
a1 1
/*	$OpenBSD: conf.c,v 1.33.2.2 2002/10/29 00:28:01 art Exp $	*/
@


1.32
log
@move cdev_decl(pf) into it's proper place, kill cdev_decl(ipl) at the same time
@
text
@d1 1
a1 1
/*	$OpenBSD: conf.c,v 1.31 2001/06/27 06:56:27 kjc Exp $	*/
a102 1
dev_decl(filedesc,open);
a108 1
cdev_decl(audio);
@


1.31
log
@add the ALTQ device to the rest of the architectures.
@
text
@d1 1
a1 1
/*	$OpenBSD: conf.c,v 1.30 2001/06/25 03:19:44 kjell Exp $	*/
a119 1
cdev_decl(pf);
@


1.30
log
@add pf device on all architectures.
fix my previously bogus MAKEDEVs.
If you used pf on a non-i386. the major device number has changed,
and you'll need to recreate /dev/pf
ok theo
@
text
@d1 1
a1 1
/*	$OpenBSD: conf.c,v 1.29 2000/10/12 19:36:51 espie Exp $	*/
d122 2
d183 1
@


1.29
log
@Repair RAMDISK, which has no joystick.
Thanks jj for testing, and miod for explanations.
@
text
@d1 1
a1 1
/*	$OpenBSD: conf.c,v 1.28 2000/09/26 14:03:51 art Exp $	*/
d119 2
d158 1
a158 1
	cdev_gen_ipf(NIPF,ipl),		/* 34: IP filter log */
@


1.28
log
@Implement getnulldev that returns the dev_t for "/dev/null".
@
text
@d1 1
a1 1
/*	$OpenBSD: conf.c,v 1.27 2000/09/02 13:45:38 espie Exp $	*/
d98 1
d165 1
a165 1
	cdev_joy_init(1,joy),		/* 43: Joystick */
@


1.27
log
@Amiga joystick driver. Stylistic comments by Niklas.
Missing documentation yet.
@
text
@d1 1
a1 1
/*	$OpenBSD: conf.c,v 1.26 1999/07/30 19:41:29 deraadt Exp $	*/
d235 6
@


1.26
log
@acd goes away
@
text
@d1 1
a1 1
/*	$OpenBSD: conf.c,v 1.25 1998/09/25 09:20:52 todd Exp $	*/
d111 8
d164 1
a164 1
	cdev_notdef(),			/* 43 */
@


1.26.4.1
log
@Update the SMP branch to -current, this breaks the SMP branch though.
But it will be fixed soonish.  Note, nothing new has happened, this is just
a merge of the trunk into this branch.
@
text
@d1 1
a1 1
/*	$OpenBSD: conf.c,v 1.29 2000/10/12 19:36:51 espie Exp $	*/
a97 1
#include "joy.h"
a110 8
/* open, close, read */
#define cdev_joy_init(c,n) { \
	dev_init(c,n,open), dev_init(c,n,close), dev_init(c,n,read), \
	(dev_type_write((*)))enodev, (dev_type_ioctl((*)))enodev, \
	(dev_type_stop((*)))enodev, 0, seltrue, \
	(dev_type_mmap((*)))enodev }


d156 1
a156 1
	cdev_joy_init(NJOY,joy),	/* 43: Joystick */
a226 6
}

dev_t
getnulldev()
{
	return makedev(mem_no, 2);
@


1.26.4.2
log
@Merge in -current from two days ago in the SMP branch.
As usual with merges, they do not indicate progress, so do not hold
your breath for working SMP, and do not mail me and ask about the
state of it.  It has not changed.  There is work ongoing, but very, very
slowly.  The commit is done in parts as to not lock up the tree in too
big chunks at a time.
@
text
@d1 1
a1 1
/*	$OpenBSD: conf.c,v 1.26.4.1 2001/04/18 16:01:55 niklas Exp $	*/
a118 4
#include "pf.h"
cdev_decl(pf);

#include <altq/altqconf.h>
d156 1
a156 1
	cdev_pf_init(NPF,pf),		/* 34: packet filter */
a178 1
	cdev_altq_init(NALTQ,altq),	/* 52: ALTQ control interface */
@


1.26.4.3
log
@Sync the SMP branch to something just after 3.0
@
text
@d1 1
a1 1
/*	$OpenBSD: conf.c,v 1.26.4.2 2001/07/04 10:14:55 niklas Exp $	*/
d120 1
@


1.26.4.4
log
@Merge in trunk
@
text
@d1 1
a1 1
/*	$OpenBSD$	*/
d103 1
d110 1
@


1.26.4.5
log
@Merge in -current from about a week ago
@
text
@d185 3
a187 3
extern int grfbanked_get(int, int, int);
extern int grfbanked_set(int, int);
extern int grfbanked_cur(int);
@


1.26.4.6
log
@Sync the SMP branch with 3.3
@
text
@d1 1
a1 1
/*	$OpenBSD: conf.c,v 1.26.4.5 2002/03/28 10:06:14 niklas Exp $	*/
@


1.25
log
@o xfs is in the house (thanks art, for getting me started)
o all but vax are major 51
@
text
@d1 1
a1 1
/*	$OpenBSD: conf.c,v 1.24 1998/08/24 05:30:06 millert Exp $	*/
a61 1
#include "acd.h"
d87 1
a87 1
	bdev_disk_init(NACD,acd),	/* 15: ATAPI CD-ROM */
d151 1
a151 1
	cdev_disk_init(NACD,acd),	/* 38: ATAPI CD-ROM */
d270 1
a270 1
	/* 38 */	15,		/* acd */
@


1.24
log
@Add support for /dev/ksyms to arch-specific files
@
text
@d1 1
a1 1
/*	$OpenBSD: conf.c,v 1.23 1998/07/20 00:49:23 espie Exp $	*/
d65 4
d157 14
@


1.23
log
@
typo & warnings make gcc unhappy.
@
text
@d1 1
a1 1
/*	$OpenBSD: conf.c,v 1.22 1998/07/07 06:55:56 deraadt Exp $	*/
d65 1
d152 1
@


1.22
log
@oops, i did not handle nchrdev correctly
@
text
@d1 1
a1 1
/*	$OpenBSD: conf.c,v 1.21 1998/07/07 03:02:30 deraadt Exp $	*/
d267 1
a267 1
	    major(dev) > sizeof(chrtoblktbl)/sizeof(chrtoblktbl[0]))
d269 1
a269 1
	blkmaj = chrtoblktbl[major(dev)];
@


1.21
log
@fix chrtoblk() so that it returne ENODEV for entries beyond the end of the table
@
text
@d1 1
a1 1
/*	$OpenBSD: conf.c,v 1.20 1998/04/26 22:30:57 niklas Exp $	*/
d266 1
a266 1
	if (major(dev) >= MAXDEV ||
@


1.20
log
@Get audio framework from MI-land, scrap the local variant. Some NetBSD merging
@
text
@d1 1
a1 1
/*	$OpenBSD: conf.c,v 1.19 1997/10/16 06:48:12 niklas Exp $	*/
d266 4
a269 3
	if (major(dev) >= nchrdev)
		return(NODEV);
	blkmaj = chrtoblktab[major(dev)];
d271 1
a271 1
		return(NODEV);
@


1.19
log
@DOH! audio was broken because I moved MI files to MD places.
@
text
@d1 1
a1 1
/*	$OpenBSD: conf.c,v 1.18 1997/09/18 13:39:34 niklas Exp $	*/
d104 1
a104 1
#include "new_audio.h"
d148 1
a148 1
	cdev_audio_init(NNEW_AUDIO,audio),	/* 39: cc audio interface */
@


1.18
log
@Merge of NetBSD changes upto last week or so, with the exception of stand/
@
text
@d1 1
a1 1
/*	$OpenBSD: conf.c,v 1.17 1997/05/13 13:24:46 niklas Exp $	*/
d104 1
a104 1
#include "audio.h"
d148 1
a148 1
	cdev_audio_init(NAUDIO,audio),	/* 39: cc audio interface */
@


1.17
log
@Add ramdisk devices + some cleanup
@
text
@d1 1
a1 1
/*	$OpenBSD: conf.c,v 1.16 1997/01/16 09:23:16 niklas Exp $	*/
a97 1
#include "drcom.h"
d104 2
d148 1
a148 1
	cdev_tty_init(NDRCOM,drcom),	/* 39: DraCo com ports */
@


1.16
log
@Sync to NetBSD 970110
@
text
@d1 1
a1 1
/*	$OpenBSD: conf.c,v 1.15 1996/11/28 23:33:02 niklas Exp $	*/
a62 1
#if 0
a63 1
#endif
a83 1
#if 0
a84 1
#endif
a101 5
#ifdef IPFILTER
#define NIPF 1
#else
#define NIPF 0
#endif
d143 1
a143 1
	cdev_random_init(1,random), /* 35: random data source */
d149 1
d253 1
@


1.15
log
@Adaption to new bus.h from NetBSD.  Various driver has been updated to
NetBSD 961107 state.  Other has not, partly because sometimes the bus.h
changes was coupled with other changes.
@
text
@d1 2
a2 2
/*	$OpenBSD: conf.c,v 1.14 1996/10/19 13:26:03 mickey Exp $	*/
/*	$NetBSD: conf.c,v 1.36 1996/05/19 21:04:18 veego Exp $	*/
a53 2
int	ttselect	__P((dev_t, int, struct proc *));

d66 1
d102 1
d156 2
d227 3
a229 3
	/*  7 */	8,
	/*  8 */	4,
	/*  9 */	7,
d238 3
a240 3
	/* 18 */	2,
	/* 19 */	6,
	/* 20 */	5,
d257 4
a260 2
	/* 37 */	0,
	/* 38 */	15,
@


1.14
log
@random device is permanent now.
@
text
@d1 1
a1 1
/*	$OpenBSD: conf.c,v 1.13 1996/10/05 15:47:50 niklas Exp $	*/
d274 18
@


1.13
log
@use wd.h not wdc.h.  Teach booting logic about wd and acd
@
text
@d1 1
a1 1
/*	$OpenBSD: conf.c,v 1.12 1996/08/29 09:25:51 deraadt Exp $	*/
a112 1
#include "random.h"
d152 1
a152 1
	cdev_random_init(NRANDOM,random), /* 35: random data source */
@


1.12
log
@rnd -> random
@
text
@d1 1
a1 1
/*	$OpenBSD: conf.c,v 1.11 1996/08/19 00:02:29 niklas Exp $	*/
d63 1
a63 1
#include "wdc.h"
d71 1
a71 1
	bdev_disk_init(NWDC,wd),	/* 0: ST506/ESDI/IDE disk */
d155 1
a155 1
	cdev_disk_init(NWDC,wd),	/* 37: ST506/ESDI/IDE disk */
@


1.11
log
@Addition of IDE WD&ATAPI CD config (Ram disk too, but out-commented)
@
text
@d1 1
a1 1
/*	$OpenBSD: conf.c,v 1.10 1996/07/15 14:57:00 mickey Exp $	*/
d113 1
a113 1
#include "rnd.h"
d153 1
a153 1
	cdev_rnd_init(NRND,rnd),	/* 35: random data source */
@


1.10
log
@add rnd driver
@
text
@d1 1
a1 1
/*	$OpenBSD: conf.c,v 1.9 1996/05/29 10:14:22 niklas Exp $	*/
d63 5
d71 1
a71 1
	bdev_notdef(),			/* 0 */
d86 4
d155 2
d250 8
a257 1
+ 	/* 31 */	NODEV,
@


1.9
log
@Merge of 960526 NetBSD
@
text
@d1 1
a1 1
/*	$OpenBSD: conf.c,v 1.4 1996/03/30 22:18:06 niklas Exp $	*/
d104 2
d144 2
@


1.8
log
@Use MI cdev_scanner_init macro.  Fix tabs.
@
text
@d2 1
a2 1
/*	$NetBSD: conf.c,v 1.35 1996/04/27 20:48:50 veego Exp $	*/
d132 1
a132 1
	cdev_lkm_dummy(),		/* 25 */
a141 1
	cdev_scanner_init(NSS,ss),	/* 35: SCSI scanner */
@


1.7
log
@Add a SCSI scanner cdev entry
@
text
@d141 2
a142 2
	cdev_gen_ipf(NIPF,ipl),         /* 34: IP filter log */
	cdev_ss_init(NSS,ss),           /* 35: SCSI scanner */
@


1.6
log
@Sync with NetBSD 9600430.  The port has gone over a major -Wall treat
@
text
@d142 1
d262 2
a264 2
cons_decl(ite);
cons_decl(com);
@


1.5
log
@Bring forward the Amiga ISA support, and resolve a conflict with if_ed
@
text
@d2 1
a2 1
/*	$NetBSD: conf.c,v 1.33 1996/03/14 21:22:23 christos Exp $	*/
d48 2
a55 7
#ifndef LKM
#define	lkmenodev	enodev
#else
int	lkmenodev();
#endif

bdev_decl(sw);
a56 1
bdev_decl(vnd);
a57 1
bdev_decl(sd);
a58 1
bdev_decl(cd);
a59 1
bdev_decl(st);
a60 3
#define	fdopen	Fdopen	/* conflicts with fdopen() in kern_descrip.c */
bdev_decl(fd);
#undef	fdopen
d62 1
a62 1
bdev_decl(ccd);
a67 1
#define	fdopen	Fdopen	/* conflicts with fdopen() in kern_descrip.c */
a68 1
#undef	fdopen
a83 32
/* open, close, ioctl, select, mmap -- XXX should be a map device */
#define	cdev_grf_init(c,n) { \
	dev_init(c,n,open), dev_init(c,n,close), (dev_type_read((*))) nullop, \
	(dev_type_write((*))) nullop, dev_init(c,n,ioctl), \
	(dev_type_stop((*))) enodev, 0, dev_init(c,n,select), \
	dev_init(c,n,mmap) }

/* open, close, ioctl, select, mmap -- XXX should be a map device */
#define	cdev_view_init(c,n) { \
	dev_init(c,n,open), dev_init(c,n,close), (dev_type_read((*))) nullop, \
	(dev_type_write((*))) nullop, dev_init(c,n,ioctl), \
	(dev_type_stop((*))) enodev, 0, dev_init(c,n,select), \
	dev_init(c,n,mmap) }

/* open, close, read, write, ioctl -- XXX should be a generic device */
#define	cdev_par_init(c,n) { \
	dev_init(c,n,open), dev_init(c,n,close), dev_init(c,n,read), \
	dev_init(c,n,write), dev_init(c,n,ioctl), (dev_type_stop((*))) enodev, \
	0, (dev_type_select((*))) enodev, (dev_type_mmap((*))) enodev }

/* open, close, write, ioctl */
#define	cdev_lpt_init(c,n) { \
	dev_init(c,n,open), dev_init(c,n,close), (dev_type_read((*))) enodev, \
	dev_init(c,n,write), dev_init(c,n,ioctl), (dev_type_stop((*))) enodev, \
	0, seltrue, (dev_type_mmap((*))) enodev }

cdev_decl(cn);
cdev_decl(ctty);
#define	mmread	mmrw
#define	mmwrite	mmrw
cdev_decl(mm);
cdev_decl(sw);
a84 9
#define	ptstty		ptytty
#define	ptsioctl	ptyioctl
cdev_decl(pts);
#define	ptctty		ptytty
#define	ptcioctl	ptyioctl
cdev_decl(ptc);
cdev_decl(log);
cdev_decl(sd);
cdev_decl(cd);
a85 1
cdev_decl(grf);
a86 1
cdev_decl(par);
a87 1
cdev_decl(ser);
a88 1
cdev_decl(msc);
a89 1
cdev_decl(ite);
d91 1
a91 3
cdev_decl(kbd);
#include "mouse.h"
cdev_decl(ms);
a92 1
cdev_decl(view);
a93 7
cdev_decl(mfcs);
#define	fdopen	Fdopen	/* conflicts with fdopen() in kern_descrip.c */
cdev_decl(fd);
#undef	fdopen
cdev_decl(vnd);
cdev_decl(ccd);
cdev_decl(st);
a95 1
cdev_decl(bpf);
a96 10
cdev_decl(tun);
#ifdef LKM
#define NLKM 1
#else
#define NLKM 0
#endif
cdev_decl(lkm);

/* open, close, read, ioctl */
cdev_decl(ipl);
a101 1

a102 1
cdev_decl(com);
a103 1
cdev_decl(lpt);
d122 1
a122 1
	cdev_mouse_init(NMOUSE,ms),	/* 15: /dev/mouse0 /dev/mouse1 */
a124 1
#define	fdopen	Fdopen	/* conflicts with fdopen() in kern_descrip.c */
a125 1
#undef	fdopen
d182 1
d241 1
@


1.4
log
@From NetBSD: merge of 960317
@
text
@d1 1
a1 1
/*	$OpenBSD$	*/
d118 6
d184 5
d225 3
a227 1
	cdev_gen_ipf(NIPF,ipl),         /* 32: IP filter log */
d347 1
d355 5
@


1.3
log
@move cdev_gen_ipf() macro to the <sys/conf.h>, so the lkm
for ipl is possible and also, why it is in <machine/conf.c> while
it (ipl) is in <net/*> ???
@
text
@d1 2
a2 1
/*	$OpenBSD: conf.c,v 1.32 1995/09/30 01:52:37 chopps Exp $	*/
d158 1
a158 1
dev_decl(fd,open);
d203 1
a203 1
	cdev_fd_init(1,fd),		/* 21: file descriptor pseudo-dev */
@


1.2
log
@created devices for the IP filter log on all architectures
@
text
@d1 1
a1 1
/*	$NetBSD: conf.c,v 1.32 1995/09/30 01:52:37 chopps Exp $	*/
a170 5
#define	cdev_gen_ipf(c,n) { \
	dev_init(c,n,open), dev_init(c,n,close), dev_init(c,n,read), \
	(dev_type_write((*))) enodev, dev_init(c,n,ioctl), \
	(dev_type_stop((*))) nullop, 0, (dev_type_select((*))) enodev, \
	(dev_type_mmap((*))) enodev, 0 }
@


1.1
log
@Initial revision
@
text
@d169 13
d218 1
@


1.1.1.1
log
@initial import of NetBSD tree
@
text
@@
