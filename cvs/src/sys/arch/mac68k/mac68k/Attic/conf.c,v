head	1.50;
access;
symbols
	OPENBSD_5_1_BASE:1.49
	OPENBSD_5_1:1.49.0.2
	OPENBSD_5_0:1.48.0.4
	OPENBSD_5_0_BASE:1.48
	OPENBSD_4_9:1.48.0.2
	OPENBSD_4_9_BASE:1.48
	OPENBSD_4_8:1.46.0.2
	OPENBSD_4_8_BASE:1.46
	OPENBSD_4_7:1.44.0.2
	OPENBSD_4_7_BASE:1.44
	OPENBSD_4_6:1.43.0.4
	OPENBSD_4_6_BASE:1.43
	OPENBSD_4_5:1.42.0.2
	OPENBSD_4_5_BASE:1.42
	OPENBSD_4_4:1.41.0.2
	OPENBSD_4_4_BASE:1.41
	OPENBSD_4_3:1.39.0.4
	OPENBSD_4_3_BASE:1.39
	OPENBSD_4_2:1.39.0.2
	OPENBSD_4_2_BASE:1.39
	OPENBSD_4_1:1.36.0.6
	OPENBSD_4_1_BASE:1.36
	OPENBSD_4_0:1.36.0.4
	OPENBSD_4_0_BASE:1.36
	OPENBSD_3_9:1.36.0.2
	OPENBSD_3_9_BASE:1.36
	OPENBSD_3_8:1.35.0.8
	OPENBSD_3_8_BASE:1.35
	OPENBSD_3_7:1.35.0.6
	OPENBSD_3_7_BASE:1.35
	OPENBSD_3_6:1.35.0.4
	OPENBSD_3_6_BASE:1.35
	SMP_SYNC_A:1.35
	SMP_SYNC_B:1.35
	OPENBSD_3_5:1.35.0.2
	OPENBSD_3_5_BASE:1.35
	OPENBSD_3_4:1.34.0.2
	OPENBSD_3_4_BASE:1.34
	UBC_SYNC_A:1.33
	OPENBSD_3_3:1.31.0.2
	OPENBSD_3_3_BASE:1.31
	OPENBSD_3_2:1.30.0.2
	OPENBSD_3_2_BASE:1.30
	OPENBSD_3_1:1.27.0.4
	OPENBSD_3_1_BASE:1.27
	UBC_SYNC_B:1.30
	UBC:1.27.0.2
	UBC_BASE:1.27
	OPENBSD_3_0:1.26.0.2
	OPENBSD_3_0_BASE:1.26
	OPENBSD_2_9:1.22.0.6
	OPENBSD_2_9_BASE:1.22
	NIKLAS_UNDEAD:1.22.0.4
	OPENBSD_2_8:1.22.0.2
	OPENBSD_2_8_BASE:1.22
	OPENBSD_2_7:1.21.0.6
	OPENBSD_2_7_BASE:1.21
	SMP:1.21.0.4
	SMP_BASE:1.21
	kame_19991208:1.21
	OPENBSD_2_6:1.21.0.2
	OPENBSD_2_6_BASE:1.21
	OPENBSD_2_5:1.20.0.4
	OPENBSD_2_5_BASE:1.20
	OPENBSD_2_4:1.20.0.2
	OPENBSD_2_4_BASE:1.20
	OPENBSD_2_3:1.16.0.2
	OPENBSD_2_3_BASE:1.16
	OPENBSD_2_2:1.15.0.4
	OPENBSD_2_2_BASE:1.15
	OPENBSD_2_1:1.15.0.2
	OPENBSD_2_1_BASE:1.15
	OPENBSD_2_0:1.10.0.2
	OPENBSD_2_0_BASE:1.10
	netbsd_1_1:1.1.1.1;
locks; strict;
comment	@ * @;


1.50
date	2012.06.20.18.23.52;	author matthew;	state dead;
branches;
next	1.49;

1.49
date	2011.10.06.20.49.28;	author deraadt;	state Exp;
branches;
next	1.48;

1.48
date	2011.01.14.19.04.08;	author jasper;	state Exp;
branches;
next	1.47;

1.47
date	2010.09.23.05.02.14;	author claudio;	state Exp;
branches;
next	1.46;

1.46
date	2010.07.03.03.59.16;	author krw;	state Exp;
branches;
next	1.45;

1.45
date	2010.06.09.15.25.32;	author jsing;	state Exp;
branches;
next	1.44;

1.44
date	2009.08.13.15.04.20;	author dlg;	state Exp;
branches;
next	1.43;

1.43
date	2009.06.03.14.45.52;	author jj;	state Exp;
branches;
next	1.42;

1.42
date	2009.01.25.17.30.48;	author miod;	state Exp;
branches;
next	1.41;

1.41
date	2008.05.14.20.49.48;	author miod;	state Exp;
branches;
next	1.40;

1.40
date	2008.04.08.14.31.54;	author claudio;	state Exp;
branches;
next	1.39;

1.39
date	2007.05.28.22.26.03;	author todd;	state Exp;
branches;
next	1.38;

1.38
date	2007.05.27.01.50.36;	author todd;	state Exp;
branches;
next	1.37;

1.37
date	2007.05.26.19.54.24;	author todd;	state Exp;
branches;
next	1.36;

1.36
date	2006.01.04.20.39.05;	author miod;	state Exp;
branches;
next	1.35;

1.35
date	2004.02.10.01.31.21;	author millert;	state Exp;
branches;
next	1.34;

1.34
date	2003.06.02.23.27.49;	author millert;	state Exp;
branches;
next	1.33;

1.33
date	2003.05.16.01.40.24;	author miod;	state Exp;
branches;
next	1.32;

1.32
date	2003.05.14.00.20.37;	author tedu;	state Exp;
branches;
next	1.31;

1.31
date	2002.12.05.02.49.55;	author kjc;	state Exp;
branches;
next	1.30;

1.30
date	2002.07.10.22.08.47;	author mickey;	state Exp;
branches;
next	1.29;

1.29
date	2002.05.16.21.11.15;	author miod;	state Exp;
branches;
next	1.28;

1.28
date	2002.04.21.23.35.52;	author miod;	state Exp;
branches;
next	1.27;

1.27
date	2001.12.11.23.19.02;	author miod;	state Exp;
branches
	1.27.2.1;
next	1.26;

1.26
date	2001.09.28.02.53.13;	author mickey;	state Exp;
branches;
next	1.25;

1.25
date	2001.08.06.22.34.44;	author mickey;	state Exp;
branches;
next	1.24;

1.24
date	2001.06.27.06.56.28;	author kjc;	state Exp;
branches;
next	1.23;

1.23
date	2001.06.25.03.20.01;	author kjell;	state Exp;
branches;
next	1.22;

1.22
date	2000.09.26.14.03.53;	author art;	state Exp;
branches;
next	1.21;

1.21
date	99.05.01.06.28.20;	author downsj;	state Exp;
branches
	1.21.4.1;
next	1.20;

1.20
date	98.09.25.09.20.53;	author todd;	state Exp;
branches;
next	1.19;

1.19
date	98.08.18.15.03.26;	author ryker;	state Exp;
branches;
next	1.18;

1.18
date	98.07.07.06.56.06;	author deraadt;	state Exp;
branches;
next	1.17;

1.17
date	98.07.07.03.02.41;	author deraadt;	state Exp;
branches;
next	1.16;

1.16
date	97.11.23.05.21.55;	author mickey;	state Exp;
branches;
next	1.15;

1.15
date	97.03.08.16.17.02;	author briggs;	state Exp;
branches;
next	1.14;

1.14
date	97.01.24.01.35.45;	author briggs;	state Exp;
branches;
next	1.13;

1.13
date	97.01.01.15.54.21;	author briggs;	state Exp;
branches;
next	1.12;

1.12
date	96.11.11.22.55.57;	author kstailey;	state Exp;
branches;
next	1.11;

1.11
date	96.10.19.13.26.08;	author mickey;	state Exp;
branches;
next	1.10;

1.10
date	96.08.29.09.26.14;	author deraadt;	state Exp;
branches;
next	1.9;

1.9
date	96.07.15.14.57.03;	author mickey;	state Exp;
branches;
next	1.8;

1.8
date	96.06.23.15.57.59;	author briggs;	state Exp;
branches;
next	1.7;

1.7
date	96.05.26.18.36.15;	author briggs;	state Exp;
branches;
next	1.6;

1.6
date	96.05.26.18.14.21;	author briggs;	state Exp;
branches;
next	1.5;

1.5
date	96.05.04.18.50.46;	author mickey;	state Exp;
branches;
next	1.4;

1.4
date	96.02.21.12.53.47;	author mickey;	state Exp;
branches;
next	1.3;

1.3
date	96.01.07.07.41.03;	author dm;	state Exp;
branches;
next	1.2;

1.2
date	95.12.14.11.36.05;	author deraadt;	state Exp;
branches;
next	1.1;

1.1
date	95.10.18.08.51.07;	author deraadt;	state Exp;
branches
	1.1.1.1;
next	;

1.1.1.1
date	95.10.18.08.51.07;	author deraadt;	state Exp;
branches;
next	;

1.21.4.1
date	2001.04.18.16.10.08;	author niklas;	state Exp;
branches;
next	1.21.4.2;

1.21.4.2
date	2001.07.04.10.18.36;	author niklas;	state Exp;
branches;
next	1.21.4.3;

1.21.4.3
date	2001.10.31.03.01.14;	author nate;	state Exp;
branches;
next	1.21.4.4;

1.21.4.4
date	2002.03.06.01.05.35;	author niklas;	state Exp;
branches;
next	1.21.4.5;

1.21.4.5
date	2003.03.27.23.28.44;	author niklas;	state Exp;
branches;
next	1.21.4.6;

1.21.4.6
date	2003.05.16.00.29.39;	author niklas;	state Exp;
branches;
next	1.21.4.7;

1.21.4.7
date	2003.06.07.11.13.14;	author ho;	state Exp;
branches;
next	1.21.4.8;

1.21.4.8
date	2004.06.05.23.10.51;	author niklas;	state Exp;
branches;
next	;

1.27.2.1
date	2002.06.11.03.36.19;	author art;	state Exp;
branches;
next	1.27.2.2;

1.27.2.2
date	2002.10.29.00.28.05;	author art;	state Exp;
branches;
next	1.27.2.3;

1.27.2.3
date	2003.05.19.21.49.43;	author tedu;	state Exp;
branches;
next	;


desc
@@


1.50
log
@RIP mac68k.  No one loves you anymore.
@
text
@/*	$OpenBSD: conf.c,v 1.49 2011/10/06 20:49:28 deraadt Exp $	*/
/*	$NetBSD: conf.c,v 1.41 1997/02/11 07:35:49 scottr Exp $	*/

/*
 * Copyright (c) 1990 The Regents of the University of California.
 * All rights reserved.
 *
 * Redistribution and use in source and binary forms, with or without
 * modification, are permitted provided that the following conditions
 * are met:
 * 1. Redistributions of source code must retain the above copyright
 *    notice, this list of conditions and the following disclaimer.
 * 2. Redistributions in binary form must reproduce the above copyright
 *    notice, this list of conditions and the following disclaimer in the
 *    documentation and/or other materials provided with the distribution.
 * 3. Neither the name of the University nor the names of its contributors
 *    may be used to endorse or promote products derived from this software
 *    without specific prior written permission.
 *
 * THIS SOFTWARE IS PROVIDED BY THE REGENTS AND CONTRIBUTORS ``AS IS'' AND
 * ANY EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT LIMITED TO, THE
 * IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE
 * ARE DISCLAIMED.  IN NO EVENT SHALL THE REGENTS OR CONTRIBUTORS BE LIABLE
 * FOR ANY DIRECT, INDIRECT, INCIDENTAL, SPECIAL, EXEMPLARY, OR CONSEQUENTIAL
 * DAMAGES (INCLUDING, BUT NOT LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS
 * OR SERVICES; LOSS OF USE, DATA, OR PROFITS; OR BUSINESS INTERRUPTION)
 * HOWEVER CAUSED AND ON ANY THEORY OF LIABILITY, WHETHER IN CONTRACT, STRICT
 * LIABILITY, OR TORT (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY
 * OUT OF THE USE OF THIS SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF
 * SUCH DAMAGE.
 */
/*-
 * Derived a long time ago from
 *      @@(#)conf.c	7.9 (Berkeley) 5/28/91
 */

#include <sys/param.h>
#include <sys/systm.h>
#include <sys/buf.h>
#include <sys/ioctl.h>
#include <sys/tty.h>
#include <sys/conf.h>
#include <sys/vnode.h>
#include <dev/cons.h>

#include "st.h"
#include "sd.h"
#include "cd.h"
#include "ch.h"
#include "vnd.h"
#include "rd.h"

struct bdevsw	bdevsw[] =
{
	bdev_notdef(),         		/* 0 */
	bdev_notdef(),			/* 1 */
	bdev_notdef(),         		/* 2 */
	bdev_swap_init(1,sw),		/* 3: swap pseudo-device */
	bdev_disk_init(NSD,sd),		/* 4: SCSI disk */
	bdev_tape_init(NST,st),		/* 5: SCSI tape */
	bdev_disk_init(NCD,cd),		/* 6: SCSI CD-ROM */
	bdev_notdef(),        	 	/* 7 */
	bdev_disk_init(NVND,vnd),	/* 8: vnode disk driver */
	bdev_notdef(),			/* 9: was: concatenated disk driver */
	bdev_notdef(),        	 	/* 10 */
	bdev_notdef(),        	 	/* 11 */
	bdev_notdef(),        	 	/* 12 */
	bdev_disk_init(NRD,rd),	 	/* 13: RAM disk -- for install */
	bdev_lkm_dummy(),		/* 14 */
	bdev_lkm_dummy(),		/* 15 */
	bdev_lkm_dummy(),		/* 16 */
	bdev_lkm_dummy(),		/* 17 */
	bdev_lkm_dummy(),		/* 18 */
	bdev_lkm_dummy(),		/* 19 */
};
int	nblkdev = nitems(bdevsw);

#define mmread	mmrw
#define mmwrite	mmrw
cdev_decl(mm);
#include "bio.h"
#include "pty.h"
#include "uk.h"
cdev_decl(fd);
#include "zsc.h"
cdev_decl(zsc);
#include "zstty.h"
cdev_decl(zs);
#include "bpfilter.h"
#include "tun.h"
#include "asc.h"
cdev_decl(asc);
#include "ksyms.h"
#ifdef NNPFS
#include <nnpfs/nnnpfs.h>
cdev_decl(nnpfs_dev);
#endif
#include "wsdisplay.h"
#include "wskbd.h"
#include "wsmouse.h"
#include "wsmux.h"

#include "pf.h"

#include "systrace.h"

#include "vscsi.h"
#include "pppx.h"

struct cdevsw	cdevsw[] =
{
	cdev_cn_init(1,cn),		/* 0: virtual console */
	cdev_ctty_init(1,ctty),		/* 1: controlling terminal */
	cdev_mm_init(1,mm),		/* 2: /dev/{null,mem,kmem,...} */
	cdev_notdef(),			/* 3 was /dev/drum */
	cdev_tty_init(NPTY,pts),	/* 4: pseudo-tty slave */
	cdev_ptc_init(NPTY,ptc),	/* 5: pseudo-tty master */
	cdev_log_init(1,log),		/* 6: /dev/klog */
	cdev_notdef(),			/* 7 */
	cdev_notdef(),			/* 8 */
	cdev_notdef(),			/* 9 */
	cdev_notdef(),			/* 10 was GRF */
	cdev_notdef(),			/* 11 was ITE */
	cdev_tty_init(NZSTTY,zs),	/* 12: 2 mac serial ports -- BG*/
	cdev_disk_init(NSD,sd),		/* 13: SCSI disk */
	cdev_tape_init(NST,st),		/* 14: SCSI tape */
	cdev_disk_init(NCD,cd),		/* 15: SCSI CD-ROM */
	cdev_notdef(),			/* 16 */
	cdev_ch_init(NCH,ch),		/* 17: SCSI autochanger */
        cdev_disk_init(NRD,rd),         /* 18: ramdisk device */
	cdev_disk_init(NVND,vnd),	/* 19: vnode disk driver */
	cdev_notdef(),			/* 20: was: concatenated disk driver */
	cdev_fd_init(1,filedesc),	/* 21: file descriptor pseudo-device */
	cdev_bpf_init(NBPFILTER,bpf),	/* 22: Berkeley packet filter */
	cdev_notdef(),			/* 23 was ADB */
	cdev_tun_init(NTUN,tun),	/* 24: network tunnel */
	cdev_lkm_init(NLKM,lkm),	/* 25: loadable module driver */
	cdev_lkm_dummy(),		/* 26 */
	cdev_lkm_dummy(),		/* 27 */
	cdev_lkm_dummy(),		/* 28 */
	cdev_lkm_dummy(),		/* 29 */
	cdev_lkm_dummy(),		/* 30 */
	cdev_lkm_dummy(),		/* 31 */
	cdev_random_init(1,random),	/* 32: random data source */
	cdev_notdef(),			/* 33 */
	cdev_uk_init(NUK,uk),		/* 34: SCSI unknown */
	cdev_pf_init(NPF,pf),		/* 35: packet filter */
	cdev_audio_init(NASC,asc),      /* 36: ASC audio device */
	cdev_ksyms_init(NKSYMS,ksyms),	/* 37: Kernel symbols device */
	cdev_wsdisplay_init(NWSDISPLAY, wsdisplay), /* 38: displays */
	cdev_mouse_init(NWSKBD, wskbd),	/* 39: keyboards */
	cdev_mouse_init(NWSMOUSE, wsmouse), /* 40: mice */
	cdev_mouse_init(NWSMUX, wsmux),	/* 41: ws multiplexor */
	cdev_notdef(),			/* 42 */
	cdev_notdef(),			/* 43 */
	cdev_notdef(),			/* 44 */
	cdev_notdef(),			/* 45 */
	cdev_notdef(),			/* 46 */
	cdev_notdef(),			/* 47 */
	cdev_notdef(),			/* 48 */
	cdev_bio_init(NBIO,bio),	/* 49: ioctl tunnel */
	cdev_systrace_init(NSYSTRACE,systrace),	/* 50 system call tracing */
#ifdef NNPFS
	cdev_nnpfs_init(NNNPFS,nnpfs_dev),	/* 51: nnpfs communication device */
#else
	cdev_notdef(),			/* 51 */
#endif
	cdev_ptm_init(NPTY,ptm),	/* 52: pseudo-tty ptm device */
	cdev_vscsi_init(NVSCSI,vscsi),	/* 53: vscsi */
	cdev_disk_init(1,diskmap),	/* 54: disk mapper */
	cdev_pppx_init(NPPPX,pppx),	/* 55: pppx */
};
int	nchrdev = nitems(cdevsw);

int	mem_no = 2; 	/* major device number of memory special file */

/*
 * Swapdev is a fake device implemented
 * in sw.c used only internally to get to swstrategy.
 * It cannot be provided to the users, because the
 * swstrategy routine munches the b_dev and b_blkno entries
 * before calling the appropriate driver.  This would horribly
 * confuse, e.g. the hashing routines. Instead, /dev/drum is
 * provided as a character (raw) device.
 */
dev_t	swapdev = makedev(3, 0);

/*
 * Returns true if dev is /dev/mem or /dev/kmem.
 */
int
iskmemdev(dev)
	dev_t	dev;
{

	return (major(dev) == mem_no && minor(dev) < 2);
}

/*
 * Returns true if dev is /dev/zero.
 */
int
iszerodev(dev)
	dev_t	dev;
{

	return (major(dev) == mem_no && minor(dev) == 12);
}

dev_t
getnulldev()
{
	return makedev(mem_no, 2);
}

int chrtoblktbl[] = {
	/* XXXX This needs to be dynamic for LKMs. */
	/*VCHR*/	/*VBLK*/
	/*  0 */	NODEV,
	/*  1 */	NODEV,
	/*  2 */	NODEV,
	/*  3 */	NODEV,
	/*  4 */	NODEV,
	/*  5 */	NODEV,
	/*  6 */	NODEV,
	/*  7 */	NODEV,
	/*  8 */	NODEV,
	/*  9 */	NODEV,
	/* 10 */	NODEV,
	/* 11 */	NODEV,
	/* 12 */	NODEV,
	/* 13 */	4,		/* sd */
	/* 14 */	5,		/* st */
	/* 15 */	6,		/* cd */
	/* 16 */	NODEV,
	/* 17 */	NODEV,
	/* 18 */	13,		/* rd */
	/* 19 */	8		/* vnd */
};
int nchrtoblktbl = nitems(chrtoblktbl);

cons_decl(ws);
#define zscnpollc	nullcnpollc
cons_decl(zs);

struct	consdev constab[] = {
#if NWSDISPLAY > 0
	cons_init(ws),
#endif
#if NZSTTY > 0
	cons_init(zs),
#endif
	{ 0 },
};
@


1.49
log
@ccd goes to the attic
discussed with jsing and millert
@
text
@d1 1
a1 1
/*	$OpenBSD: conf.c,v 1.48 2011/01/14 19:04:08 jasper Exp $	*/
@


1.48
log
@- use nitems()

"doesn't hurt" deraadt@@
@
text
@d1 1
a1 1
/*	$OpenBSD: conf.c,v 1.47 2010/09/23 05:02:14 claudio Exp $	*/
a50 1
#include "ccd.h"
d64 1
a64 1
	bdev_disk_init(NCCD,ccd),	/* 9: concatenated disk driver */
d132 1
a132 1
	cdev_disk_init(NCCD,ccd),	/* 20: concatenated disk driver */
d238 1
a238 2
	/* 19 */	8,		/* vnd */
	/* 20 */	9,		/* ccd */
@


1.47
log
@Add pppx(4) to the cdevs of the remaining archs.
OK dlg@@
@
text
@d1 1
a1 1
/*	$OpenBSD: conf.c,v 1.46 2010/07/03 03:59:16 krw Exp $	*/
d77 1
a77 1
int	nblkdev = sizeof(bdevsw) / sizeof(bdevsw[0]);
d174 1
a174 1
int	nchrdev = sizeof(cdevsw) / sizeof(cdevsw[0]);
d242 1
a242 1
int nchrtoblktbl = sizeof(chrtoblktbl) / sizeof(chrtoblktbl[0]);
@


1.46
log
@No more ss(4) or usscanner(4). Unused, unloved and unmaintained.
General huzzahs.

"go for it" deraadt@@
@
text
@d1 1
a1 1
/*	$OpenBSD: conf.c,v 1.45 2010/06/09 15:25:32 jsing Exp $	*/
d109 1
d172 1
@


1.45
log
@Wire up device nodes for disk mapper.

ok deraadt@@
@
text
@d1 1
a1 1
/*	$OpenBSD: conf.c,v 1.43 2009/06/03 14:45:52 jj Exp $	*/
a83 1
#include "ss.h"
d145 1
a145 1
	cdev_ss_init(NSS,ss),           /* 33: SCSI scanner */
@


1.44
log
@wire vscsi up to a cdev

for claudio@@ ok deraadt@@
@
text
@d171 1
@


1.43
log
@Arla client rename from xfs to nnpfs for later upgrades. Tested on various arches. ok todd@@ beck@@
@
text
@d1 1
a1 1
/*	$OpenBSD: conf.c,v 1.42 2009/01/25 17:30:48 miod Exp $	*/
d109 2
d170 1
@


1.42
log
@Remove /dev/drum and related code.
@
text
@d1 1
a1 1
/*	$OpenBSD: conf.c,v 1.41 2008/05/14 20:49:48 miod Exp $	*/
d96 3
a98 3
#ifdef XFS
#include <xfs/nxfs.h>
cdev_decl(xfs_dev);
d162 2
a163 2
#ifdef XFS
	cdev_xfs_init(NXFS,xfs_dev),	/* 51: xfs communication device */
@


1.41
log
@Fix more chrtoblktbl[] sloppyness, and add proper block st nodes to *ppc and
sgi.
@
text
@d1 1
a1 1
/*	$OpenBSD: conf.c,v 1.40 2008/04/08 14:31:54 claudio Exp $	*/
d114 1
a114 1
	cdev_swap_init(1,sw),		/* 3: /dev/drum (swap pseudo-device) */
@


1.40
log
@Split the cdev makro for bpftun into two seperate definitions. tun(4) and
bpf(4) are different enough so that the split makes sense -- this is necessary
to make bpf(4) cloneable.
requested deraadt@@, OK thib@@
@
text
@d1 1
a1 1
/*	$OpenBSD: conf.c,v 1.39 2007/05/28 22:26:03 todd Exp $	*/
d218 1
a218 1
	/*  3 */	3,
d228 3
a230 3
	/* 13 */	4,
	/* 14 */	5,
	/* 15 */	6,
d233 3
a235 3
	/* 18 */	13,
	/* 19 */	8,
	/* 20 */	9,
@


1.39
log
@bio for all archs, ok krw@@ kettenis@@ sounds good marco@@ go for it deraadt@@
@
text
@d1 1
a1 1
/*	$OpenBSD: conf.c,v 1.38 2007/05/27 01:50:36 todd Exp $	*/
d133 1
a133 1
	cdev_bpftun_init(NBPFILTER,bpf),/* 22: Berkeley packet filter */
d135 1
a135 1
	cdev_bpftun_init(NTUN,tun),	/* 24: network tunnel */
@


1.38
log
@back out bio, breaks dlg's sparc64 v215
prompted by/ok dlg@@ deraadt@@
@
text
@d1 1
a1 1
/*	$OpenBSD: conf.c,v 1.37 2007/05/26 19:54:24 todd Exp $	*/
d82 1
d160 1
a160 1
	cdev_notdef(),			/* 49 */
@


1.37
log
@prodded by marco, enable bio everywhere
grudgingly ok deraadt@@
@
text
@d1 1
a1 1
/*	$OpenBSD: conf.c,v 1.36 2006/01/04 20:39:05 miod Exp $	*/
a81 1
#include "bio.h"
d117 1
a117 1
	cdev_bio_init(NBIO,bio),	/* 7: ioctl tunnel */
@


1.36
log
@Import NetBSD's direct adb code on mac68k, switching to real keyboard and mouse
drivers, and to wscons as the console; a few parts borrowed from OpenBSD/macppc
as well.

Currently only working with displays configured in 1bpp or 8bpp modes; this
limitation will be worked on ASAP.

Tested by claudio@@ kettenis@@ martin@@ nick@@ and I on various models. X11 changes
coming soon.
@
text
@d1 1
a1 1
/*	$OpenBSD: conf.c,v 1.35 2004/02/10 01:31:21 millert Exp $	*/
d82 1
d118 1
a118 1
	cdev_notdef(),			/* 7 */
@


1.35
log
@Add the ptm device to pty(4).  By opening /dev/ptm and using the PTMGET
ioctl(2), an unprivileged process may allocate a pty and have its owner
and mode set appropriately.  This means that programs such as xterm and
screen no longer need to be setuid.  Programs using the openpty()
function require zero changes and will "just work".

Designed by beck@@ and deraadt@@; changes by beck@@ with cleanup (and
a rewrite of the vnode bits) by art@@ and tweaks/bugfixes by me.
Tested by many.
@
text
@d1 1
a1 1
/*	$OpenBSD: conf.c,v 1.34 2003/06/02 23:27:49 millert Exp $	*/
a78 2
#include "ite.h"
cdev_decl(ite);
a85 4
#include "grf.h"
cdev_decl(grf);
#define NADB 1 /* #include "adb.h" */
cdev_decl(adb);
a89 1
#include "ch.h"
d99 4
d120 2
a121 2
	cdev_fb_init(NGRF,grf),		/* 10: frame buffer */
	cdev_tty_init(NITE,ite),	/* 11: console terminal emulator */
d133 1
a133 1
	cdev_mouse_init(NADB,adb),	/* 23: ADB event interface */
d148 4
a151 4
	cdev_notdef(),			/* 38 */
	cdev_notdef(),			/* 39 */
	cdev_notdef(),			/* 40 */
	cdev_notdef(),			/* 41 */
d238 1
a238 2
#define itecnpollc	nullcnpollc
cons_decl(ite);
d243 2
a244 2
#if NITE > 0
	cons_init(ite),
@


1.34
log
@Remove the advertising clause in the UCB license which Berkeley
rescinded 22 July 1999.  Proofed by myself and Theo.
@
text
@d1 1
a1 1
/*	$OpenBSD: conf.c,v 1.33 2003/05/16 01:40:24 miod Exp $	*/
d169 1
@


1.33
log
@Unbrek mac68k, bad tedu; spotted by nick@@
@
text
@d1 1
a1 1
/*	$OpenBSD: conf.c,v 1.32 2003/05/14 00:20:37 tedu Exp $	*/
d16 1
a16 5
 * 3. All advertising materials mentioning features or use of this software
 *    must display the following acknowledgement:
 *	This product includes software developed by the University of
 *	California, Berkeley and its contributors.
 * 4. Neither the name of the University nor the names of its contributors
@


1.32
log
@add {b,c}devsw_lookup convenience functions.
move chrtoblk and blktochr into MI code.
tested on several archs and ok deraadt@@
@
text
@d1 1
a1 1
/*	$OpenBSD: conf.c,v 1.31 2002/12/05 02:49:55 kjc Exp $	*/
d217 1
a217 1
int chrtoblktab[] = {
@


1.31
log
@remove altq entries.
altq is merged into pf and handled through pf.
@
text
@d1 1
a1 1
/*	$OpenBSD: conf.c,v 1.30 2002/07/10 22:08:47 mickey Exp $	*/
d217 1
a217 1
static int chrtoblktab[] = {
d242 1
a242 33

dev_t
chrtoblk(dev)
	dev_t	dev;
{
	int	blkmaj;

	if (major(dev) >= nchrdev ||
	    major(dev) > sizeof(chrtoblktab)/sizeof(chrtoblktab[0]))
		return (NODEV);
	blkmaj = chrtoblktab[major(dev)];
	if (blkmaj == NODEV)
		return (NODEV);
	return (makedev(blkmaj, minor(dev)));
}

/*
 * Convert a character device number to a block device number.
 */
dev_t
blktochr(dev)
	dev_t dev;
{
	int blkmaj = major(dev);
	int i;

	if (blkmaj >= nblkdev)
		return (NODEV);
	for (i = 0; i < sizeof(chrtoblktab)/sizeof(chrtoblktab[0]); i++)
		if (blkmaj == chrtoblktab[i])
			return (makedev(i, minor(dev)));
	return (NODEV);
}
@


1.30
log
@proper cdev_decl(ksyms), fix ksyms's broken functions
@
text
@d1 1
a1 1
/*	$OpenBSD: conf.c,v 1.29 2002/05/16 21:11:15 miod Exp $	*/
a112 2
#include <altq/altqconf.h>

a172 1
	cdev_altq_init(NALTQ,altq),	/* 52: ALTQ control interface */
@


1.29
log
@Add systrace support to all the remaining architectures.

Tested by various people on various platforms, I'm willing to fix any
breakage this causes.

ok niels@@ deraadt@@ and mickey@@ (after his comments were applied)
@
text
@d1 1
a1 1
/*	$OpenBSD: conf.c,v 1.28 2002/04/21 23:35:52 miod Exp $	*/
a105 1
cdev_decl(ksyms);
@


1.28
log
@Add ramdisk support.
@
text
@d1 1
a1 1
/*	$OpenBSD: conf.c,v 1.27 2001/12/11 23:19:02 miod Exp $	*/
d116 2
d170 1
a170 1
	cdev_notdef(),			/* 50 */
@


1.27
log
@Remove declarations that already exist in <sys/conf.h>
@
text
@d1 1
a1 1
/*	$OpenBSD: conf.c,v 1.26 2001/09/28 02:53:13 mickey Exp $	*/
d136 1
a136 1
	cdev_notdef(),			/* 18 */
d240 1
a240 1
	/* 18 */	NODEV,
@


1.27.2.1
log
@Sync UBC branch to -current
@
text
@d1 1
a1 1
/*	$OpenBSD: conf.c,v 1.27 2001/12/11 23:19:02 miod Exp $	*/
a115 2
#include "systrace.h"

d136 1
a136 1
        cdev_disk_init(NRD,rd),         /* 18: ramdisk device */
d168 1
a168 1
	cdev_systrace_init(NSYSTRACE,systrace),	/* 50 system call tracing */
d240 1
a240 1
	/* 18 */	13,
@


1.27.2.2
log
@sync to -current
@
text
@d1 1
a1 1
/*	$OpenBSD: conf.c,v 1.27.2.1 2002/06/11 03:36:19 art Exp $	*/
d106 1
@


1.27.2.3
log
@sync
@
text
@d1 1
a1 1
/*	$OpenBSD$	*/
d113 2
d175 1
d220 1
a220 1
int chrtoblktbl[] = {
d245 33
a277 1
int nchrtoblktbl = sizeof(chrtoblktbl) / sizeof(chrtoblktbl[0]);
@


1.26
log
@move cdev_decl(pf) into it's proper place, kill cdev_decl(ipl) at the same time
@
text
@d1 1
a1 1
/*	$OpenBSD: conf.c,v 1.25 2001/08/06 22:34:44 mickey Exp $	*/
a49 2
int	ttselect	__P((dev_t, int, struct proc *));

a56 2
bdev_decl(rd);
/* No cdev for rd */
a89 1
cdev_decl(ss);
a90 1
cdev_decl(uk);
a100 1
cdev_decl(ch);
a102 1
dev_decl(filedesc,open);
@


1.25
log
@remove vm_conf.h; art@@ ok
@
text
@d1 1
a1 1
/*	$OpenBSD: conf.c,v 1.24 2001/06/27 06:56:28 kjc Exp $	*/
a120 1
cdev_decl(pf);
@


1.24
log
@add the ALTQ device to the rest of the architectures.
@
text
@d1 1
a1 1
/*	$OpenBSD: conf.c,v 1.23 2001/06/25 03:20:01 kjell Exp $	*/
a51 1
bdev_decl(sw);
a91 1
cdev_decl(sw);
@


1.23
log
@add pf device on all architectures.
fix my previously bogus MAKEDEVs.
If you used pf on a non-i386. the major device number has changed,
and you'll need to recreate /dev/pf
ok theo
@
text
@d1 1
a1 1
/*	$OpenBSD: conf.c,v 1.22 2000/09/26 14:03:53 art Exp $	*/
d125 2
d185 1
@


1.22
log
@Implement getnulldev that returns the dev_t for "/dev/null".
@
text
@d1 1
a1 1
/*	$OpenBSD: conf.c,v 1.21 1999/05/01 06:28:20 downsj Exp $	*/
d122 2
a123 5
#ifdef IPFILTER
#define NIPF 1
#else
#define NIPF 0
#endif
d162 1
a162 1
	cdev_gen_ipf(NIPF,ipl),         /* 35: IP filter log */
@


1.21
log
@Add ksyms.
@
text
@d1 1
a1 1
/*	$OpenBSD: conf.c,v 1.20 1998/09/25 09:20:53 todd Exp $	*/
d222 6
@


1.21.4.1
log
@Update the SMP branch to -current, this breaks the SMP branch though.
But it will be fixed soonish.  Note, nothing new has happened, this is just
a merge of the trunk into this branch.
@
text
@d1 1
a1 1
/*	$OpenBSD: conf.c,v 1.22 2000/09/26 14:03:53 art Exp $	*/
a221 6
}

dev_t
getnulldev()
{
	return makedev(mem_no, 2);
@


1.21.4.2
log
@Merge in -current from two days ago in the SMP branch.
As usual with merges, they do not indicate progress, so do not hold
your breath for working SMP, and do not mail me and ask about the
state of it.  It has not changed.  There is work ongoing, but very, very
slowly.  The commit is done in parts as to not lock up the tree in too
big chunks at a time.
@
text
@d1 1
a1 1
/*	$OpenBSD: conf.c,v 1.21.4.1 2001/04/18 16:10:08 niklas Exp $	*/
d122 5
a126 4
#include "pf.h"
cdev_decl(pf);

#include <altq/altqconf.h>
d165 1
a165 1
	cdev_pf_init(NPF,pf),		/* 35: packet filter */
a185 1
	cdev_altq_init(NALTQ,altq),	/* 52: ALTQ control interface */
@


1.21.4.3
log
@Sync the SMP branch to something just after 3.0
@
text
@d1 1
a1 1
/*	$OpenBSD: conf.c,v 1.21.4.2 2001/07/04 10:18:36 niklas Exp $	*/
d52 1
d93 1
d123 1
@


1.21.4.4
log
@Merge in trunk
@
text
@d1 1
a1 1
/*	$OpenBSD$	*/
d50 2
d59 2
d94 1
d96 1
d107 1
d110 1
@


1.21.4.5
log
@Sync the SMP branch with 3.3
@
text
@d106 1
d114 1
a114 1
#include "systrace.h"
d136 1
a136 1
        cdev_disk_init(NRD,rd),         /* 18: ramdisk device */
d168 1
a168 1
	cdev_systrace_init(NSYSTRACE,systrace),	/* 50 system call tracing */
d174 1
d240 1
a240 1
	/* 18 */	13,
@


1.21.4.6
log
@merge the trunk so we will get the genfs and locking fixes
@
text
@d217 1
a217 1
int chrtoblktab[] = {
d242 33
a274 1
int nchrtoblktbl = sizeof(chrtoblktbl) / sizeof(chrtoblktbl[0]);
@


1.21.4.7
log
@Sync SMP branch to -current
@
text
@d1 1
a1 1
/*	$OpenBSD: conf.c,v 1.21.4.6 2003/05/16 00:29:39 niklas Exp $	*/
d16 5
a20 1
 * 3. Neither the name of the University nor the names of its contributors
d217 1
a217 1
int chrtoblktbl[] = {
@


1.21.4.8
log
@Merge with the trunk
@
text
@d1 1
a1 1
/*	$OpenBSD$	*/
a168 1
	cdev_ptm_init(NPTY,ptm),	/* 52: pseudo-tty ptm device */
@


1.20
log
@o xfs is in the house (thanks art, for getting me started)
o all but vax are major 51
@
text
@d1 1
a1 1
/*	$OpenBSD: conf.c,v 1.19 1998/08/18 15:03:26 ryker Exp $	*/
d115 2
d167 1
a167 1
	cdev_notdef(),			/* 37 */
@


1.19
log
@Make mac68k sys compile.
@
text
@d1 1
a1 1
/*	$OpenBSD: conf.c,v 1.18 1998/07/07 06:56:06 deraadt Exp $	*/
d115 4
d165 19
@


1.18
log
@oops, i did not handle nchrdev correctly
@
text
@d1 1
a1 1
/*	$OpenBSD: conf.c,v 1.17 1998/07/07 03:02:41 deraadt Exp $	*/
d232 1
a232 1
	    major(dev) > sizeof(chrtoblktbl)/sizeof(chrtoblktbl[0]))
d234 1
a234 1
	blkmaj = chrtoblktbl[major(dev)];
@


1.17
log
@fix chrtoblk() so that it returne ENODEV for entries beyond the end of the table
@
text
@d1 1
a1 1
/*	$OpenBSD: conf.c,v 1.16 1997/11/23 05:21:55 mickey Exp $	*/
d231 1
a231 1
	if (major(dev) >= MAXDEV ||
@


1.16
log
@use MI cdev_decl(ipl)
@
text
@d1 1
a1 1
/*	$OpenBSD: conf.c,v 1.15 1997/03/08 16:17:02 briggs Exp $	*/
a222 11
	/* 21 */	NODEV,
	/* 22 */	NODEV,
	/* 23 */	NODEV,
	/* 24 */	NODEV,
	/* 25 */	NODEV,
	/* 26 */	NODEV,
	/* 27 */	NODEV,
	/* 28 */	NODEV,
	/* 29 */	NODEV,
	/* 30 */	NODEV,
	/* 31 */	NODEV,
d231 4
a234 3
	if (major(dev) >= nchrdev)
		return NODEV;
	blkmaj = chrtoblktab[major(dev)];
d236 1
a236 1
		return NODEV;
@


1.15
log
@Sync with NetBSD of about 4 March.
@
text
@d1 1
a1 1
/*	$OpenBSD: conf.c,v 1.14 1997/01/24 01:35:45 briggs Exp $	*/
a115 2
/* open, close, read, ioctl */
cdev_decl(ipl);
@


1.14
log
@Sync w/ NETBSD_CURRENT_971122.
@
text
@d1 2
a2 2
/*	$OpenBSD: conf.c,v 1.13 1997/01/01 15:54:21 briggs Exp $	*/
/*	$NetBSD: conf.c,v 1.34 1996/06/19 02:20:54 briggs Exp $	*/
a87 7
/* open, close, ioctl, select, mmap -- XXX should be a map device */
#define	cdev_grf_init(c,n) { \
	dev_init(c,n,open), dev_init(c,n,close), (dev_type_read((*))) nullop, \
	(dev_type_write((*))) nullop, dev_init(c,n,ioctl), \
	(dev_type_stop((*))) enodev, 0, dev_init(c,n,select), \
	dev_init(c,n,mmap) }

d113 2
d136 1
a136 1
	cdev_grf_init(1,grf),		/* 10: frame buffer */
d162 1
@


1.13
log
@Get blktochr() from sun3/sun3/conf.c
@
text
@d1 1
a1 1
/*	$OpenBSD: conf.c,v 1.12 1996/11/11 22:55:57 kstailey Exp $	*/
d103 1
d105 1
d115 2
d148 1
a148 2
/*	cdev_disk_init(NCH,ch),		 17: SCSI autochanger */
	cdev_notdef(),			/* 17: until we find chstrategy... */
d163 4
a166 4
	cdev_gen_ipf(NIPF,ipl),         /* 32: IP filter log */
	cdev_random_init(1,random),	/* 33: random data source */
	cdev_uk_init(NUK,uk),		/* 34: unknown SCSI */
	cdev_ss_init(NSS,ss),           /* 35: SCSI scanner */
@


1.12
log
@Updates for SCSI scanner and SCSI unknown devices.
Removed MI *dev_decl() stuff that is now in sys/conf.h
@
text
@d1 1
a1 1
/*	$OpenBSD: conf.c,v 1.11 1996/10/19 13:26:08 mickey Exp $	*/
d251 18
@


1.11
log
@random device is permanent now.
@
text
@d1 1
a1 1
/*	$OpenBSD: conf.c,v 1.10 1996/08/29 09:26:14 deraadt Exp $	*/
a53 1
bdev_decl(st);
a54 1
bdev_decl(sd);
a55 1
bdev_decl(cd);
a56 1
bdev_decl(ch);
a57 1
bdev_decl(vnd);
a58 1
bdev_decl(ccd);
a94 3
cdev_decl(cn);
cdev_decl(ctty);

d102 2
a103 10
#define	ptstty		ptytty
#define	ptsioctl	ptyioctl
cdev_decl(pts);
#define	ptctty		ptytty
#define	ptcioctl	ptyioctl
cdev_decl(ptc);
cdev_decl(log);
cdev_decl(st);
cdev_decl(sd);
cdev_decl(cd);
a112 2
cdev_decl(vnd);
cdev_decl(ccd);
a113 1
cdev_decl(bpf);
a114 1
cdev_decl(tun);
a115 9
cdev_decl(random);

#ifdef LKM
#define NLKM	1
#else
#define NLKM	0
#endif

cdev_decl(lkm);
d162 2
@


1.10
log
@rnd -> random
@
text
@d1 1
a1 1
/*	$OpenBSD: conf.c,v 1.9 1996/07/15 14:57:03 mickey Exp $	*/
a136 1
#include "random.h"
d191 1
a191 1
	cdev_random_init(NRANDOM,random), /* 33: random data source */
@


1.9
log
@add rnd driver
@
text
@d1 1
a1 1
/*	$OpenBSD: conf.c,v 1.8 1996/06/23 15:57:59 briggs Exp $	*/
d137 2
a138 2
#include "rnd.h"
cdev_decl(rnd);
d192 1
a192 1
	cdev_rnd_init(NRND,rnd),	/* 33: random data source */
@


1.8
log
@Copyright foo.
@
text
@d1 1
a1 1
/*	$OpenBSD: conf.c,v 1.7 1996/05/26 18:36:15 briggs Exp $	*/
d137 2
d192 1
@


1.7
log
@Add OpenBSD Id string.
@
text
@d1 2
a2 2
/*	$OpenBSD$	*/
/*	$NetBSD: conf.c,v 1.33 1996/05/18 18:54:49 briggs Exp $	*/
a34 33
*/
/*-
 * Copyright (C) 1993	Allen K. Briggs, Chris P. Caputo,
 *			Michael L. Finch, Bradley A. Grantham, and
 *			Lawrence A. Kesteloot
 * All rights reserved.
 *
 * Redistribution and use in source and binary forms, with or without
 * modification, are permitted provided that the following conditions
 * are met:
 * 1. Redistributions of source code must retain the above copyright
 *    notice, this list of conditions and the following disclaimer.
 * 2. Redistributions in binary form must reproduce the above copyright
 *    notice, this list of conditions and the following disclaimer in the
 *    documentation and/or other materials provided with the distribution.
 * 3. All advertising materials mentioning features or use of this software
 *    must display the following acknowledgement:
 *	This product includes software developed by the Alice Group.
 * 4. The names of the Alice Group or any of its members may not be used
 *    to endorse or promote products derived from this software without
 *    specific prior written permission.
 *
 * THIS SOFTWARE IS PROVIDED BY THE ALICE GROUP ``AS IS'' AND ANY EXPRESS OR
 * IMPLIED WARRANTIES, INCLUDING, BUT NOT LIMITED TO, THE IMPLIED WARRANTIES
 * OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE ARE DISCLAIMED.
 * IN NO EVENT SHALL THE ALICE GROUP BE LIABLE FOR ANY DIRECT, INDIRECT,
 * INCIDENTAL, SPECIAL, EXEMPLARY, OR CONSEQUENTIAL DAMAGES (INCLUDING, BUT
 * NOT LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES; LOSS OF USE,
 * DATA, OR PROFITS; OR BUSINESS INTERRUPTION) HOWEVER CAUSED AND ON ANY
 * THEORY OF LIABILITY, WHETHER IN CONTRACT, STRICT LIABILITY, OR TORT
 * (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE USE
 * OF THIS SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.
 *
@


1.6
log
@Sync with NetBSD-current.
@
text
@d1 1
@


1.5
log
@remove #ifndef LKM, since that stuff already in sys/conf.h,
add lkmenodev prototype.
@
text
@d1 1
a1 1
/*	$OpenBSD: conf.c,v 1.4 1996/02/21 12:53:47 mickey Exp $	*/
d152 1
d158 4
a161 3
#include "ser.h"
cdev_decl(ser);
cdev_decl(cd);
d168 1
d200 1
a200 1
	cdev_tty_init(NSER,ser),	/* 12: 2 mac serial ports -- BG*/
d210 1
a210 1
	cdev_fd_init(1,fd),		/* 21: file descriptor pseudo-device */
d252 1
d297 1
d313 2
a314 2
#define sercnpollc	nullcnpollc
cons_decl(ser);
d320 2
a321 2
#if NSER > 0
	cons_init(ser),
@


1.4
log
@move cdev_gen_ipf() macro to the <sys/conf.h>, so the lkm
for ipl is possible and also, why it is in <machine/conf.c> while
it (ipl) is in <net/*> ???
@
text
@d1 1
a1 1
/*	$OpenBSD: conf.c,v 1.29 1995/11/21 03:39:45 briggs Exp $	*/
a99 6

#ifdef LKM
int	lkmenodev();
#else
#define lkmenodev	enodev
#endif
@


1.3
log
@created devices for the IP filter log on all architectures
@
text
@d1 1
a1 1
/*	$NetBSD: conf.c,v 1.29 1995/11/21 03:39:45 briggs Exp $	*/
a182 5
#define	cdev_gen_ipf(c,n) { \
	dev_init(c,n,open), dev_init(c,n,close), dev_init(c,n,read), \
	(dev_type_write((*))) enodev, dev_init(c,n,ioctl), \
	(dev_type_stop((*))) nullop, 0, (dev_type_select((*))) enodev, \
	(dev_type_mmap((*))) enodev, 0 }
@


1.2
log
@update from netbsd (without losing local changes)
@
text
@d181 13
d229 1
@


1.1
log
@Initial revision
@
text
@d1 1
a1 1
/*	$NetBSD: conf.c,v 1.28 1995/08/17 17:40:52 thorpej Exp $	*/
d97 3
d119 4
a122 4
	bdev_lkm_dummy(),		/* 10 */
	bdev_lkm_dummy(),		/* 11 */
	bdev_lkm_dummy(),		/* 12 */
	bdev_lkm_dummy(),		/* 13 */
d125 4
@


1.1.1.1
log
@initial import of NetBSD tree
@
text
@@
