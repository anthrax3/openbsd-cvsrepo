head	1.9;
access;
symbols
	SMP_SYNC_A:1.9
	SMP_SYNC_B:1.9
	UBC_SYNC_A:1.9
	UBC_SYNC_B:1.9
	OPENBSD_2_9_BASE:1.7
	OPENBSD_2_9:1.7.0.2
	OPENBSD_2_8:1.6.0.4
	OPENBSD_2_8_BASE:1.6
	OPENBSD_2_7:1.6.0.2
	OPENBSD_2_7_BASE:1.6
	SMP:1.5.0.2
	SMP_BASE:1.5
	kame_19991208:1.5
	OPENBSD_2_6:1.4.0.6
	OPENBSD_2_6_BASE:1.4
	OPENBSD_2_5:1.4.0.4
	OPENBSD_2_5_BASE:1.4
	OPENBSD_2_4:1.4.0.2
	OPENBSD_2_4_BASE:1.4
	OPENBSD_2_3:1.3.0.6
	OPENBSD_2_3_BASE:1.3
	OPENBSD_2_2:1.3.0.4
	OPENBSD_2_2_BASE:1.3
	OPENBSD_2_1:1.3.0.2
	OPENBSD_2_1_BASE:1.3;
locks; strict;
comment	@# @;


1.9
date	2001.09.01.15.36.37;	author drahn;	state dead;
branches;
next	1.8;

1.8
date	2001.06.23.01.53.02;	author drahn;	state Exp;
branches;
next	1.7;

1.7
date	2001.02.09.05.20.51;	author drahn;	state Exp;
branches;
next	1.6;

1.6
date	2000.04.27.12.36.29;	author rahnds;	state Exp;
branches;
next	1.5;

1.5
date	99.11.09.06.30.15;	author rahnds;	state Exp;
branches
	1.5.2.1;
next	1.4;

1.4
date	98.05.29.04.15.56;	author rahnds;	state Exp;
branches;
next	1.3;

1.3
date	97.04.27.20.56.35;	author millert;	state Exp;
branches;
next	1.2;

1.2
date	97.04.01.21.01.48;	author rahnds;	state Exp;
branches;
next	1.1;

1.1
date	97.02.18.22.36.41;	author rahnds;	state Exp;
branches;
next	;

1.5.2.1
date	2001.05.14.21.37.00;	author niklas;	state Exp;
branches;
next	1.5.2.2;

1.5.2.2
date	2001.07.04.10.23.10;	author niklas;	state Exp;
branches;
next	1.5.2.3;

1.5.2.3
date	2001.10.31.03.07.56;	author nate;	state dead;
branches;
next	;


desc
@@


1.9
log
@The "powerpc" port which has supported the newer Apple Macintosh powerpc based
is being renamed to macppc. This is to allow sharing of common code
between different powerpc base platforms.

Most of the work involved in the renaming process was performed by miod@@

Files moved from powerpc/stand/boot.mac to macppc/stand/boot.mac
These files are the bootloader for the older Openfirmware, not currently
supported.
@
text
@#	$OpenBSD: Makefile,v 1.8 2001/06/23 01:53:02 drahn Exp $
#       $NetBSD: Makefile,v 1.1 1996/09/30 16:35:05 ws Exp $

R=              ..
.PATH:          $(.CURDIR)/$(R)
RELOC=		6c0000
ENTRY=		_entry
PROG=           boot.mac
SRCS=           Locore.c boot.c ofdev.c net.c netif_of.c alloc.c cache.c hfs.c
CFLAGS+=        -DDEBUG -DNETIF_DEBUG
NOMAN=
INSTALL_STRIP=
BINDIR=         /usr/mdec
OBJCOPY?=	objcopy
OBJCOPY_ARGS=	-O aixcoff-rs6000 -R .stab -R .stabstr -R .comment
LDFLAGS=	-X -Ttext ${RELOC} -e $(ENTRY) -T ${.CURDIR}/ld.script

CPPFLAGS+=	-I. -I${.CURDIR}/../../.. -I${.CURDIR}/../../../..
CPPFLAGS+=	-DRELOC=0x${RELOC}
CPPFLAGS+=	-DFIRMWORKSBUGS
CPPFLAGS+=	-DPOWERPC_BOOT_ELF
CPPFLAGS+=	-DXCOFF_GLUE		# for booting PCI Powermacs


LIBS!=          cd $(.CURDIR)/$(R); $(MAKE) libdep
CLEANFILES=	hack-coff

$(PROG):        $(OBJS) $(LIBS) hack-coff
	$(LD) $(LDFLAGS) $(OBJS) $(LIBS) -o ${.TARGET}
	${OBJCOPY} ${OBJCOPY_ARGS} ${.TARGET}
	${.OBJDIR}/hack-coff ${.TARGET}

hack-coff:	hack-coff.c
	${HOSTCC} -I${.CURDIR} -o hack-coff ${.CURDIR}/hack-coff.c

.include <bsd.prog.mk>
@


1.8
log
@Support for powerpc to load symbols, uses new libsa loadfile.
@
text
@d1 1
a1 1
#	$OpenBSD: Makefile,v 1.7 2001/02/09 05:20:51 drahn Exp $
@


1.7
log
@Add support for loading the bootloader and kernel from an HFS filesystem,
using firmware. Mostly from NetBSD. This allows kernels to be booted directly
from an HFS hard drive.
@
text
@d1 1
a1 1
#	$OpenBSD: Makefile,v 1.7 2001/02/09 05:09:15 drahn Exp $
d9 1
a9 1
SRCS=           Locore.c boot.c ofdev.c net.c netif_of.c alloc.c hfs.c
a10 1
CFLAGS+=	-DXCOFF_GLUE
d17 4
d22 1
@


1.6
log
@Fixes to xcoff bootloader to allow it to execute and load kernels for OpenBSD.
@
text
@d1 1
a1 1
#	$OpenBSD: Makefile,v 1.5 1999/11/09 06:30:15 rahnds Exp $
d9 1
a9 1
SRCS=           Locore.c boot.c ofdev.c net.c netif_of.c alloc.c
@


1.5
log
@Add OpenBSD tags.
changes to boot on Apple iMac G3 (333). ethernet address changes
Locore.c
	OpenBSD tag
	hack to delay decrementer exception until after bootload,
	apple OFW enables interrupts during "system calls"
	add OF_call_method, to make ofw call by name.
	Apple OFW can return unexpected values from getchar calls.
alloc.c
	OpenBSD tag
boot.c
	OpenBSD tag
	updated (but still unused load symbol code).
	Code cleanup for egcs.
cache.c
	OpenBSD tag
	use dcbst, not dcbf
	icbi has both arguments as registers, not constant and register.
net.c
	OpenBSD tag
netif_of.c
	OpenBSD tag
	add "local-mac-address" to methods of fetching mac address,
	it can be stored in that variable or in mac-address.
	support dma buffers,
	add additional return value for OF_read for network timeout purposes.
ofdev.c
	OpenBSD tag
	support dma buffers,
ofdev.h
	OpenBSD tag
	add dmabuf
	remove MAC default kernel def.
ofwmagic.S
	OpenBSD tag
openfirm.h
	OpenBSD tag
boot.mac/Makefile
	Build debug, - not used for version 3 apple openfirmware, ie imacs.
@
text
@d1 1
a1 1
#	$OpenBSD: Makefile,v 1.4 1998/05/29 04:15:56 rahnds Exp $
d6 1
a6 1
RELOC=		20000
a7 1
LOADADDR=	20000
d10 2
a11 2
CFLAGS+=       -DDEBUG -DNETIF_DEBUG
CFLAGS+=	-DEXEC_ELF -DXCOFF_GLUE -DMAC
a13 1
MAKEELF=        makeelf
d17 3
a19 1
LDFLAGS=	-X -Ttext $(RELOC) -e $(ENTRY) -T ${.CURDIR}/ld.script
a27 1
#	${MAKEELF} $(REAL_VIRT) a.out $(.TARGET)
@


1.5.2.1
log
@Continue the aborted merge of current just before 2.9 was cut into the
SMP branch.  Note that this will not make any progress of SMP functionality,
it is just merging of new code from the trunk into the old branch.
Please do not ask me questions about SMP status because of this mail,
instead go read the archives of smp@@openbsd.org, where I mailed about
these commits some week ago.  Another note: I am doing this in chunks now,
so as to not lock too much of the tree for long times
@
text
@d1 1
a1 1
#	$OpenBSD: Makefile,v 1.7 2001/02/09 05:20:51 drahn Exp $
d6 1
a6 1
RELOC=		6c0000
d8 1
d10 3
a12 3
SRCS=           Locore.c boot.c ofdev.c net.c netif_of.c alloc.c hfs.c
CFLAGS+=        -DDEBUG -DNETIF_DEBUG
CFLAGS+=	-DXCOFF_GLUE
d15 1
d19 1
a19 3
LDFLAGS=	-X -Ttext ${RELOC} -e $(ENTRY) -T ${.CURDIR}/ld.script
CPPFLAGS+=	-DPOWERPC_BOOT_ELF

d28 1
@


1.5.2.2
log
@Merge in -current from two days ago in the SMP branch.
As usual with merges, they do not indicate progress, so do not hold
your breath for working SMP, and do not mail me and ask about the
state of it.  It has not changed.  There is work ongoing, but very, very
slowly.  The commit is done in parts as to not lock up the tree in too
big chunks at a time.
@
text
@d1 1
a1 1
#	$OpenBSD: Makefile,v 1.5.2.1 2001/05/14 21:37:00 niklas Exp $
d9 1
a9 1
SRCS=           Locore.c boot.c ofdev.c net.c netif_of.c alloc.c cache.c hfs.c
d11 1
a17 4

CPPFLAGS+=	-I. -I${.CURDIR}/../../.. -I${.CURDIR}/../../../..
CPPFLAGS+=	-DRELOC=0x${RELOC}
CPPFLAGS+=	-DFIRMWORKSBUGS
a18 1
CPPFLAGS+=	-DXCOFF_GLUE		# for booting PCI Powermacs
@


1.5.2.3
log
@Sync the SMP branch to something just after 3.0
@
text
@d1 1
a1 1
#	$OpenBSD: Makefile,v 1.5.2.2 2001/07/04 10:23:10 niklas Exp $
@


1.4
log
@Major changes here and there, tweaks elsewhere.
Support for Openfirmware drivers was reintroduced so that more systems
were supported. This should work with the real driver configurations
as well.

Bootloader files were deleted/replaced with the newer versions in the
subdirectory. Some effort has been made to be closer to support booting
(at least the bootloader) on the Mac.

Config files that end with OFW are the openfirmware versions of the kernels
without have native drivers.

Native driver support has not been changed, presumably it still works.
I couldn't test that.
@
text
@d1 1
a1 1
#	$OpenBSD: Makefile,v 1.3 1997/04/27 20:56:35 millert Exp $
d11 1
a11 1
#CFLAGS+=       -DDEBUG -DNETIF_DEBUG
@


1.3
log
@COPY -> INSTALL_COPY and STRIP -> INSTALL_STRIP
This fixes namespace problems where STRIP is sometimes used as
the name of the strip(1) to use and other times used as
the flag to send install(1) when stripping (or not).
COPY doesn't have this problem (yet) but was poorly named.
@
text
@d1 1
a1 1
#	$OpenBSD: Makefile,v 1.2 1997/04/01 21:01:48 rahnds Exp $
d6 3
a8 3
RELOC=		4000
ENTRY=		__start
LOADADDR=	4000
d12 1
a12 1
CFLAGS+=	-DEXEC_ELF
d22 1
d31 1
a31 1
	${HOSTCC} -o hack-coff ${.CURDIR}/hack-coff.c
@


1.2
log
@Check in some changes hiding in my tree.
Now that ramdisk is used, booting from floppy does not wait for floppy change.
Do not force real mode for booting, this disables caches on certain machines.
use the freshly build hack-obj, do not require "." in the current path.
@
text
@d1 1
a1 1
#	$OpenBSD: Makefile,v 1.1 1997/02/18 22:36:41 rahnds Exp $
d14 1
a14 1
STRIP=
@


1.1
log
@Add the necessary pieces to boot on a PowerMAC, does not currently work,
Debugging in progress.
@
text
@d1 1
a1 1
#	$OpenBSD: Makefile,v 1.2 1996/12/28 06:31:21 rahnds Exp $
d26 1
a26 1
	hack-coff ${.TARGET}
@
