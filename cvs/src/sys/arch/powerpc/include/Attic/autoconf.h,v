head	1.11;
access;
symbols
	SMP_SYNC_A:1.11
	SMP_SYNC_B:1.11
	UBC_SYNC_A:1.11
	UBC_SYNC_B:1.11
	OPENBSD_2_9:1.6.0.8
	OPENBSD_2_9_BASE:1.6
	OPENBSD_2_8:1.6.0.6
	OPENBSD_2_8_BASE:1.6
	OPENBSD_2_7:1.6.0.4
	OPENBSD_2_7_BASE:1.6
	SMP:1.6.0.2
	SMP_BASE:1.6
	kame_19991208:1.6
	OPENBSD_2_6:1.5.0.2
	OPENBSD_2_6_BASE:1.5
	OPENBSD_2_5:1.4.0.4
	OPENBSD_2_5_BASE:1.4
	OPENBSD_2_4:1.4.0.2
	OPENBSD_2_4_BASE:1.4
	OPENBSD_2_3:1.1.0.4
	OPENBSD_2_3_BASE:1.1
	OPENBSD_2_2:1.1.0.2
	OPENBSD_2_2_BASE:1.1;
locks; strict;
comment	@ * @;


1.11
date	2001.09.01.15.49.05;	author drahn;	state dead;
branches;
next	1.10;

1.10
date	2001.07.09.02.14.05;	author mickey;	state Exp;
branches;
next	1.9;

1.9
date	2001.06.26.18.19.43;	author drahn;	state Exp;
branches;
next	1.8;

1.8
date	2001.06.24.23.26.28;	author drahn;	state Exp;
branches;
next	1.7;

1.7
date	2001.06.24.04.55.11;	author drahn;	state Exp;
branches;
next	1.6;

1.6
date	99.11.09.04.13.54;	author rahnds;	state Exp;
branches
	1.6.2.1;
next	1.5;

1.5
date	99.07.05.21.01.19;	author rahnds;	state Exp;
branches;
next	1.4;

1.4
date	98.08.25.07.42.29;	author pefo;	state Exp;
branches;
next	1.3;

1.3
date	98.08.22.18.31.44;	author rahnds;	state Exp;
branches;
next	1.2;

1.2
date	98.05.29.04.15.32;	author rahnds;	state Exp;
branches;
next	1.1;

1.1
date	97.10.13.10.53.41;	author pefo;	state Exp;
branches;
next	;

1.6.2.1
date	2001.07.04.10.22.19;	author niklas;	state Exp;
branches;
next	1.6.2.2;

1.6.2.2
date	2001.10.31.03.07.55;	author nate;	state dead;
branches;
next	1.6.2.3;

1.6.2.3
date	2001.11.13.21.04.16;	author niklas;	state Exp;
branches;
next	1.6.2.4;

1.6.2.4
date	2001.11.13.22.14.34;	author niklas;	state dead;
branches;
next	;


desc
@@


1.11
log
@The "powerpc" port which has supported the newer Apple Macintosh powerpc based
is being renamed to macppc. This is to allow sharing of common code
between different powerpc base platforms.

Most of the work involved in the renaming process was performed by miod@@

Files moved from powerpc/include to macppc/include
Some files were not "moved" but wrapper files were created which include
the powerpc/include version.

Several of the powerpc/include files where changed to reflect that they
are POWERPC_* not MACHINE_*.
@
text
@/*	$OpenBSD: autoconf.h,v 1.10 2001/07/09 02:14:05 mickey Exp $ */

/*
 * Copyright (c) 1997 Per Fogelstrom
 * 
 * Redistribution and use in source and binary forms, with or without
 * modification, are permitted provided that the following conditions
 * are met:
 * 1. Redistributions of source code must retain the above copyright
 *    notice, this list of conditions and the following disclaimer.
 * 2. Redistributions in binary form must reproduce the above copyright
 *    notice, this list of conditions and the following disclaimer in the
 *    documentation and/or other materials provided with the distribution.
 * 3. All advertising materials mentioning features or use of this software
 *    must display the following acknowledgement:
 *	This product includes software developed under OpenBSD for RTMX inc
 *      by Per Fogelstrom, Opsycon AB.
 * 4. The name of the author may not be used to endorse or promote products
 *    derived from this software without specific prior written permission.
 *
 * THIS SOFTWARE IS PROVIDED BY THE AUTHOR ``AS IS'' AND ANY EXPRESS
 * OR IMPLIED WARRANTIES, INCLUDING, BUT NOT LIMITED TO, THE IMPLIED
 * WARRANTIES OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE
 * ARE DISCLAIMED.  IN NO EVENT SHALL THE AUTHOR BE LIABLE FOR ANY
 * DIRECT, INDIRECT, INCIDENTAL, SPECIAL, EXEMPLARY, OR CONSEQUENTIAL
 * DAMAGES (INCLUDING, BUT NOT LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS
 * OR SERVICES; LOSS OF USE, DATA, OR PROFITS; OR BUSINESS INTERRUPTION)
 * HOWEVER CAUSED AND ON ANY THEORY OF LIABILITY, WHETHER IN CONTRACT, STRICT
 * LIABILITY, OR TORT (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY
 * OUT OF THE USE OF THIS SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF
 * SUCH DAMAGE.
 *
 */
/*
 * Machine-dependent structures of autoconfiguration
 */

#ifndef _MACHINE_AUTOCONF_H_
#define _MACHINE_AUTOCONF_H_

#include <machine/bus.h>

/*
 *   System types.
 */
#define OFWMACH         0       /* Openfirmware drivers */
#define	POWER4e		1	/* V.I Power.4e board */
#define	PWRSTK		2	/* Motorola Powerstack series */
#define	APPL		3	/* Apple PowerMac machines (OFW?) */

extern int system_type;

/**/
struct confargs;

typedef int (*intr_handler_t) __P((void *));

typedef struct bushook {
	struct	device *bh_dv;
	int	bh_type;
	void	(*bh_intr_establish)
		    __P((struct confargs *, intr_handler_t, void *));
	void	(*bh_intr_disestablish)
		    __P((struct confargs *));
	int	(*bh_matchname)	
		    __P((struct confargs *, char *));
} bushook_t;

#define	BUS_MAIN	1		/* mainbus */
#define	BUS_ISABR	2		/* ISA Bridge Bus */
#define	BUS_PCIBR	3		/* PCI bridge */
#define	BUS_VMEBR	4		/* VME bridge */

#define	BUS_INTR_ESTABLISH(ca, handler, val)				\
	    (*(ca)->ca_bus->bh_intr_establish)((ca), (handler), (val))
#define	BUS_INTR_DISESTABLISH(ca)					\
	    (*(ca)->ca_bus->bh_intr_establish)(ca)
#define	BUS_CVTADDR(ca)							\
	    (*(ca)->ca_bus->bh_cvtaddr)(ca)
#define	BUS_MATCHNAME(ca, name)						\
	    (*(ca)->ca_bus->bh_matchname)((ca), (name))

struct confargs {
	char	*ca_name;		/* Device name. */
	bushook_t *ca_bus;		/* bus device resides on. */
	/* macobio hooks ?? */
	bus_space_tag_t ca_iot;
	bus_space_tag_t ca_memt; /* XXX */
	u_int32_t ca_node;
	int ca_nreg;
	u_int32_t *ca_reg;
	int ca_nintr;
	int32_t *ca_intr;
	u_int ca_baseaddr;

};

void	set_clockintr __P((void (*)(struct clockframe *)));
void	set_iointr __P((void (*)(void *, int)));
int	badaddr	__P((void *, u_int32_t));
void calc_delayconst(void);
void ofrootfound(void);

typedef int mac_intr_handle_t;
typedef void     *(intr_establish_t) __P((void *, mac_intr_handle_t,
    int, int, int (*func)(void *), void *, char *));
typedef void     (intr_disestablish_t) __P((void *, void *));

intr_establish_t mac_intr_establish;
intr_disestablish_t mac_intr_disestablish;
extern intr_establish_t *intr_establish_func;
extern intr_disestablish_t *intr_disestablish_func;

#endif /* _MACHINE_AUTOCONF_H_ */
@


1.10
log
@more spacees, includes, protos
@
text
@d1 1
a1 1
/*	$OpenBSD: autoconf.h,v 1.9 2001/06/26 18:19:43 drahn Exp $ */
@


1.9
log
@Cleanup of interrupt configuration, move prototypes to header file,
not in each file.
@
text
@d1 1
a1 1
/*	$OpenBSD: autoconf.h,v 1.8 2001/06/24 23:26:28 drahn Exp $ */
d106 1
a106 1
            int, int, int (*func)(void *), void *, char *));
@


1.8
log
@Add prototypes for softnet, ofrootfound.
Code cleanup for pmap headers.
@
text
@d1 1
a1 1
/*	$OpenBSD: autoconf.h,v 1.7 2001/06/24 04:55:11 drahn Exp $ */
d103 10
@


1.7
log
@include prototype for calc_delayconst()
@
text
@d1 1
a1 1
/*	$OpenBSD: autoconf.h,v 1.6 1999/11/09 04:13:54 rahnds Exp $ */
d102 1
@


1.6
log
@autoconf.h
	add mac hooks to the powerpc config structure, probably
	a hack, and certainly needs to be cleaned up.
bus.h
	p4e_ -> ppc_X
	add write_multi and prototypes for bus_space_X_raw_multi functions.
intr.h
	add structure for interrupt handler.
pio.h
	remove the unnecessary and slowing "sync" instruction from
	each pio access.
	remove unnecessary newline characters from the generated asm.
	eieio after writes, but before reads.
types.h
	formatting change
vmparam.h
	change powerpc kernel virtual memory sizing from a fixed segment
	to a variable, initialized with a segment size, this is
	so that the pmap allocator can steal virtual memory, if vm
	is not yet set up. Necessary for mapping devices before the
	kernel vm structures are initialized.
@
text
@d1 1
a1 1
/*	$OpenBSD: autoconf.h,v 1.5 1999/07/05 21:01:19 rahnds Exp $ */
d101 1
@


1.6.2.1
log
@Merge in -current from two days ago in the SMP branch.
As usual with merges, they do not indicate progress, so do not hold
your breath for working SMP, and do not mail me and ask about the
state of it.  It has not changed.  There is work ongoing, but very, very
slowly.  The commit is done in parts as to not lock up the tree in too
big chunks at a time.
@
text
@d1 1
a1 1
/*	$OpenBSD: autoconf.h,v 1.6 1999/11/09 04:13:54 rahnds Exp $ */
a100 12
void calc_delayconst(void);
void ofrootfound(void);

typedef int mac_intr_handle_t;
typedef void     *(intr_establish_t) __P((void *, mac_intr_handle_t,
            int, int, int (*func)(void *), void *, char *));
typedef void     (intr_disestablish_t) __P((void *, void *));

intr_establish_t mac_intr_establish;
intr_disestablish_t mac_intr_disestablish;
extern intr_establish_t *intr_establish_func;
extern intr_disestablish_t *intr_disestablish_func;
@


1.6.2.2
log
@Sync the SMP branch to something just after 3.0
@
text
@d1 1
a1 1
/*	$OpenBSD: autoconf.h,v 1.6.2.1 2001/07/04 10:22:19 niklas Exp $ */
@


1.6.2.3
log
@Merge in -current
@
text
@d1 1
a1 1
/*	$OpenBSD$ */
@


1.6.2.4
log
@repair
@
text
@d1 1
a1 1
/*	$OpenBSD: autoconf.h,v 1.6.2.3 2001/11/13 21:04:16 niklas Exp $ */
@


1.5
log
@header file changes for recent powerpc changes.
@
text
@d1 1
a1 1
/*	$OpenBSD: autoconf.h,v 1.4 1998/08/25 07:42:29 pefo Exp $ */
d41 2
d86 10
@


1.4
log
@Cleanup
@
text
@d1 1
a1 1
/*	$OpenBSD: autoconf.h,v 1.3 1998/08/22 18:31:44 rahnds Exp $ */
d47 1
@


1.3
log
@Various changes to allow mixing of ofw drivers and real drivers.
NCR driver seems to work.
Major changes are isa can be child of pci or mainbus.
ofroot is child of mainbus not root.
ofw bus configured before pci bus
Note that if a pci device configures accessing of driver will crash
the system. they need to be exclusive.
@
text
@d1 1
a1 1
/*	$OpenBSD: autoconf.h,v 1.2 1998/05/29 04:15:32 rahnds Exp $ */
d68 2
a69 1
#define	BUS_PCIBR	3		/* Algorithmics PCI bridge */
d87 1
a87 1
int	badaddr			__P((void *, u_int64_t));
@


1.2
log
@Major changes here and there, tweaks elsewhere.
Support for Openfirmware drivers was reintroduced so that more systems
were supported. This should work with the real driver configurations
as well.

Bootloader files were deleted/replaced with the newer versions in the
subdirectory. Some effort has been made to be closer to support booting
(at least the bootloader) on the Mac.

Config files that end with OFW are the openfirmware versions of the kernels
without have native drivers.

Native driver support has not been changed, presumably it still works.
I couldn't test that.
@
text
@d1 1
a1 1
/*	$OpenBSD: autoconf.h,v 1.1 1997/10/13 10:53:41 pefo Exp $ */
d44 1
a44 1
#define       OFWMACH         0       /* Openfirmware drivers */
d46 1
@


1.1
log
@Monolithic PowerPC kernel, new include
@
text
@d1 1
a1 1
/*	$OpenBSD$ */
d44 1
@

