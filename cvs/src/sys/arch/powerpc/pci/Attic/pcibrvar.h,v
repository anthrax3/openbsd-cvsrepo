head	1.9;
access;
symbols
	SMP_SYNC_A:1.9
	SMP_SYNC_B:1.9
	UBC_SYNC_A:1.9
	UBC_SYNC_B:1.9
	OPENBSD_2_9_BASE:1.7
	OPENBSD_2_9:1.7.0.2
	OPENBSD_2_8:1.6.0.2
	OPENBSD_2_8_BASE:1.6
	OPENBSD_2_7:1.5.0.2
	OPENBSD_2_7_BASE:1.5
	SMP:1.4.0.2
	SMP_BASE:1.4
	kame_19991208:1.3
	OPENBSD_2_6:1.2.0.6
	OPENBSD_2_6_BASE:1.2
	OPENBSD_2_5:1.2.0.4
	OPENBSD_2_5_BASE:1.2
	OPENBSD_2_4:1.2.0.2
	OPENBSD_2_4_BASE:1.2
	OPENBSD_2_3:1.1.0.4
	OPENBSD_2_3_BASE:1.1
	OPENBSD_2_2:1.1.0.2
	OPENBSD_2_2_BASE:1.1;
locks; strict;
comment	@ * @;


1.9
date	2001.09.01.15.55.17;	author drahn;	state dead;
branches;
next	1.8;

1.8
date	2001.06.25.23.30.00;	author drahn;	state Exp;
branches;
next	1.7;

1.7
date	2001.03.29.20.00.49;	author drahn;	state Exp;
branches;
next	1.6;

1.6
date	2000.10.19.04.53.06;	author drahn;	state Exp;
branches;
next	1.5;

1.5
date	2000.03.20.07.10.51;	author rahnds;	state Exp;
branches;
next	1.4;

1.4
date	2000.01.22.03.55.40;	author rahnds;	state Exp;
branches
	1.4.2.1;
next	1.3;

1.3
date	99.11.08.23.49.00;	author rahnds;	state Exp;
branches;
next	1.2;

1.2
date	98.08.06.15.04.03;	author pefo;	state Exp;
branches;
next	1.1;

1.1
date	97.10.11.11.29.32;	author pefo;	state Exp;
branches;
next	;

1.4.2.1
date	2000.03.24.09.08.42;	author niklas;	state Exp;
branches;
next	1.4.2.2;

1.4.2.2
date	2001.05.14.21.36.52;	author niklas;	state Exp;
branches;
next	1.4.2.3;

1.4.2.3
date	2001.07.04.10.22.43;	author niklas;	state Exp;
branches;
next	1.4.2.4;

1.4.2.4
date	2001.10.31.03.07.55;	author nate;	state dead;
branches;
next	1.4.2.5;

1.4.2.5
date	2001.11.13.21.04.16;	author niklas;	state Exp;
branches;
next	1.4.2.6;

1.4.2.6
date	2001.11.13.22.14.34;	author niklas;	state dead;
branches;
next	;


desc
@@


1.9
log
@The "powerpc" port which has supported the newer Apple Macintosh powerpc based
is being renamed to macppc. This is to allow sharing of common code
between different powerpc base platforms.

Most of the work involved in the renaming process was performed by miod@@

Files moved from powerpc/pci to macppc/pci

The file pci_machdep.h was not moved in this conversion.
It needs to be check if it is correct that should be the only shared
powerpc/pci file. Or if that file too should be MD, or more files MI.
@
text
@/*	$OpenBSD: pcibrvar.h,v 1.8 2001/06/25 23:30:00 drahn Exp $ */

/*
 * Copyright (c) 1997 Per Fogelstrom
 * 
 * Redistribution and use in source and binary forms, with or without
 * modification, are permitted provided that the following conditions
 * are met:
 * 1. Redistributions of source code must retain the above copyright
 *    notice, this list of conditions and the following disclaimer.
 * 2. Redistributions in binary form must reproduce the above copyright
 *    notice, this list of conditions and the following disclaimer in the
 *    documentation and/or other materials provided with the distribution.
 * 3. All advertising materials mentioning features or use of this software
 *    must display the following acknowledgement:
 *	This product includes software developed under OpenBSD by
 *	Per Fogelstrom.
 * 4. The name of the author may not be used to endorse or promote products
 *    derived from this software without specific prior written permission.
 *
 * THIS SOFTWARE IS PROVIDED BY THE AUTHOR ``AS IS'' AND ANY EXPRESS
 * OR IMPLIED WARRANTIES, INCLUDING, BUT NOT LIMITED TO, THE IMPLIED
 * WARRANTIES OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE
 * ARE DISCLAIMED.  IN NO EVENT SHALL THE AUTHOR BE LIABLE FOR ANY
 * DIRECT, INDIRECT, INCIDENTAL, SPECIAL, EXEMPLARY, OR CONSEQUENTIAL
 * DAMAGES (INCLUDING, BUT NOT LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS
 * OR SERVICES; LOSS OF USE, DATA, OR PROFITS; OR BUSINESS INTERRUPTION)
 * HOWEVER CAUSED AND ON ANY THEORY OF LIABILITY, WHETHER IN CONTRACT, STRICT
 * LIABILITY, OR TORT (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY
 * OUT OF THE USE OF THIS SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF
 * SUCH DAMAGE.
 *
 */

#include <dev/pci/pcireg.h>
#include <dev/pci/pcivar.h>
#include <dev/pci/pcidevs.h>

struct pcibr_config {
	bus_space_tag_t lc_memt;
	bus_space_tag_t lc_iot;
	bus_space_handle_t	ioh_cf8;
	bus_space_handle_t	ioh_cfc;
	struct ppc_pci_chipset lc_pc;
	int	config_type;
	int	bus;
	int	pci_init_done;
	int     node;
};

struct pcibr_softc {
	struct device	sc_dev;
	struct pcibr_config *sc_pcibr;
	struct ppc_bus_space sc_membus_space;
	struct ppc_bus_space sc_iobus_space;
	struct powerpc_bus_dma_tag sc_dmatag;
	struct pcibr_config	pcibr_config;
	struct extent *extent_mem;
	struct extent *extent_port;
	u_int32_t mem_alloc_start;
	u_int32_t port_alloc_start;
	int nbogus;
};

struct pci_reserve_mem {
	bus_addr_t start;
	bus_size_t size;
	char *name;
};

void pci_addr_fixup __P((struct pcibr_softc *, pci_chipset_tag_t, int,
	struct pci_reserve_mem *));

#define PCIADDR_SEARCH_IO  0
#define PCIADDR_SEARCH_MEM 1
struct extent *pciaddr_search __P((struct device *, int, bus_addr_t *, bus_size_t));

@


1.8
log
@closer to building with -Wno-uninitialized
@
text
@d1 1
a1 1
/*	$OpenBSD: pcibrvar.h,v 1.7 2001/03/29 20:00:49 drahn Exp $ */
@


1.7
log
@Add support structures for bus space detection/allocation (pci_addr_fixup).
@
text
@d1 1
a1 1
/*	$OpenBSD: pcibrvar.h,v 1.6 2000/10/19 04:53:06 drahn Exp $ */
d35 4
d73 4
@


1.6
log
@Changes to pci and if_gm to support obtaining the ethernet hardware address
from the pci bus. This is in preference to adding openfirmware code to
the device drivers. If there was a known way of obtaining the ethernet
hardware address from a eeprom or other methods that would be used, but
the only known way to get this information for the Apple machines with
if_gm is via openfirmware.

This modifies a previous mechanism that was used to obtain similar information
from different openfirmware systems, however the old mechanism would create
information such as media type. This information was hardcoded into
that code. Now the code only returns the actual address which is the
only informatin that openfirmware provides.
@
text
@d1 1
a1 1
/*	$OpenBSD: pcibrvar.h,v 1.5 2000/03/20 07:10:51 rahnds Exp $ */
d54 5
d61 8
@


1.5
log
@Changes to support uninorth bridge (probably a bit of a hack for now).
cleaned up the previous support for the macobio that was there previously.

Now registers real interupt handler devices instead of the pseudo configed
ones before.

The G4 systems are not yet working, the onboard ide configures properly
and interrupts seem to work, but the system hangs before mounting
the root drive (even ramdisks). Maybe someone will point out something
bogus in the code, so it is being checked in.
@
text
@d1 1
a1 1
/*	$OpenBSD: pcibrvar.h,v 1.4 2000/01/22 03:55:40 rahnds Exp $ */
d44 1
@


1.4
log
@Fix pci probing for the powerpc port, it was previously only probing a
portion of the pci devices, 1,2,4,8,... instead of 1,2,3,4,5,6,7,8,...

Updated to use indirect PCI configuration, so that pci-pci buses could
be probed. And that devices > 11 on the pci bus could be detected.
@
text
@d1 1
a1 1
/*	$OpenBSD: pcibrvar.h,v 1.3 1999/11/08 23:49:00 rahnds Exp $ */
d36 1
d38 2
a39 1
	bus_space_tag_t lc_memt;
d41 2
d51 2
a52 3
	bus_space_handle_t	ioh_cf8;
	bus_space_handle_t	ioh_cfc;

@


1.4.2.1
log
@Sync with -current
@
text
@d1 1
a1 1
/*	$OpenBSD$ */
d36 1
a37 3
	bus_space_tag_t lc_iot;
	bus_space_handle_t	ioh_cf8;
	bus_space_handle_t	ioh_cfc;
a38 2
	int	config_type;
	int	bus;
d47 3
a49 2
	struct powerpc_bus_dma_tag sc_dmatag;
	struct pcibr_config	pcibr_config;
@


1.4.2.2
log
@Continue the aborted merge of current just before 2.9 was cut into the
SMP branch.  Note that this will not make any progress of SMP functionality,
it is just merging of new code from the trunk into the old branch.
Please do not ask me questions about SMP status because of this mail,
instead go read the archives of smp@@openbsd.org, where I mailed about
these commits some week ago.  Another note: I am doing this in chunks now,
so as to not lock too much of the tree for long times
@
text
@d1 1
a1 1
/*	$OpenBSD: pcibrvar.h,v 1.7 2001/03/29 20:00:49 drahn Exp $ */
a43 1
	int     node;
a52 5
	struct extent *extent_mem;
	struct extent *extent_port;
	u_int32_t mem_alloc_start;
	u_int32_t port_alloc_start;
	int nbogus;
a54 8
struct pci_reserve_mem {
	bus_addr_t start;
	bus_size_t size;
	char *name;
};

void pci_addr_fixup __P((struct pcibr_softc *, pci_chipset_tag_t, int,
	struct pci_reserve_mem *));
@


1.4.2.3
log
@Merge in -current from two days ago in the SMP branch.
As usual with merges, they do not indicate progress, so do not hold
your breath for working SMP, and do not mail me and ask about the
state of it.  It has not changed.  There is work ongoing, but very, very
slowly.  The commit is done in parts as to not lock up the tree in too
big chunks at a time.
@
text
@d1 1
a1 1
/*	$OpenBSD: pcibrvar.h,v 1.4.2.2 2001/05/14 21:36:52 niklas Exp $ */
a34 4
#include <dev/pci/pcireg.h>
#include <dev/pci/pcivar.h>
#include <dev/pci/pcidevs.h>

a68 4

#define PCIADDR_SEARCH_IO  0
#define PCIADDR_SEARCH_MEM 1
struct extent *pciaddr_search __P((struct device *, int, bus_addr_t *, bus_size_t));
@


1.4.2.4
log
@Sync the SMP branch to something just after 3.0
@
text
@d1 1
a1 1
/*	$OpenBSD: pcibrvar.h,v 1.4.2.3 2001/07/04 10:22:43 niklas Exp $ */
@


1.4.2.5
log
@Merge in -current
@
text
@d1 1
a1 1
/*	$OpenBSD$ */
@


1.4.2.6
log
@repair
@
text
@d1 1
a1 1
/*	$OpenBSD: pcibrvar.h,v 1.4.2.5 2001/11/13 21:04:16 niklas Exp $ */
@


1.3
log
@Changes for imac support. support for VI computers and MCG Powerstack
will need to be merged back in. Both are currently untested.
mac interrupt support is currently a big hack and needs to be redesigned
as part of the system, several of the mac drivers need busified also.
@
text
@d1 1
a1 1
/*	$OpenBSD: pcibrvar.h,v 1.2 1998/08/06 15:04:03 pefo Exp $ */
d47 2
a48 1
	bus_space_handle_t	ioh;
@


1.2
log
@Some small fixes for non ofw systems
@
text
@d1 1
a1 1
/*	$OpenBSD: pcibrvar.h,v 1.1 1997/10/11 11:29:32 pefo Exp $ */
d38 1
a38 1
	struct p4e_pci_chipset lc_pc;
d45 4
a48 2
	struct p4e_bus_space sc_membus_space;
	struct p4e_bus_space sc_iobus_space;
@


1.1
log
@PCI bus code for monolithic PowerPC kernels.
@
text
@d1 1
a1 1
/*	$OpenBSD: pcibrvar.h,v 1.2 1997/04/10 16:29:32 pefo Exp $ */
d45 2
a46 1
	struct p4e_bus_space sc_bus_space;	/* Same for I/O and Mem */
@

