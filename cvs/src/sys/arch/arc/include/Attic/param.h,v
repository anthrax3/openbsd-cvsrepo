head	1.13;
access;
symbols
	SMP_SYNC_A:1.13
	SMP_SYNC_B:1.13
	UBC_SYNC_A:1.13
	UBC_SYNC_B:1.13
	NIKLAS_UNDEAD:1.12.0.10
	OPENBSD_2_8:1.12.0.8
	OPENBSD_2_8_BASE:1.12
	OPENBSD_2_7:1.12.0.6
	OPENBSD_2_7_BASE:1.12
	SMP:1.12.0.4
	SMP_BASE:1.12
	kame_19991208:1.12
	OPENBSD_2_6:1.12.0.2
	OPENBSD_2_6_BASE:1.12
	OPENBSD_2_5:1.11.0.4
	OPENBSD_2_5_BASE:1.11
	OPENBSD_2_4:1.11.0.2
	OPENBSD_2_4_BASE:1.11
	OPENBSD_2_3:1.10.0.2
	OPENBSD_2_3_BASE:1.10
	OPENBSD_2_2:1.9.0.4
	OPENBSD_2_2_BASE:1.9
	OPENBSD_2_1:1.9.0.2
	OPENBSD_2_1_BASE:1.9
	OPENBSD_2_0:1.5.0.2
	OPENBSD_2_0_BASE:1.5
	PEFO_960624:1.1.1.1
	PEFO:1.1.1;
locks; strict;
comment	@ * @;


1.13
date	2001.02.07.07.45.09;	author art;	state dead;
branches;
next	1.12;

1.12
date	99.08.11.22.14.17;	author niklas;	state Exp;
branches
	1.12.4.1;
next	1.11;

1.11
date	98.08.30.22.05.35;	author millert;	state Exp;
branches;
next	1.10;

1.10
date	98.01.28.13.46.20;	author pefo;	state Exp;
branches;
next	1.9;

1.9
date	97.04.30.09.54.15;	author niklas;	state Exp;
branches;
next	1.8;

1.8
date	97.04.19.17.19.57;	author pefo;	state Exp;
branches;
next	1.7;

1.7
date	97.02.28.22.57.34;	author niklas;	state Exp;
branches;
next	1.6;

1.6
date	96.12.11.11.12.54;	author deraadt;	state Exp;
branches;
next	1.5;

1.5
date	96.09.20.18.18.46;	author pefo;	state Exp;
branches;
next	1.4;

1.4
date	96.08.26.11.12.03;	author pefo;	state Exp;
branches;
next	1.3;

1.3
date	96.08.24.18.10.37;	author imp;	state Exp;
branches;
next	1.2;

1.2
date	96.07.16.07.46.17;	author pefo;	state Exp;
branches;
next	1.1;

1.1
date	96.06.24.09.07.17;	author pefo;	state Exp;
branches
	1.1.1.1;
next	;

1.1.1.1
date	96.06.24.09.07.17;	author pefo;	state Exp;
branches;
next	;

1.12.4.1
date	2001.04.18.16.02.51;	author niklas;	state dead;
branches;
next	;


desc
@@


1.13
log
@We need to loose some weight.
If someone feels very opposed to this, the code is left in the Attic.
Just revive and _make_it_work_.
@
text
@/*      $OpenBSD: param.h,v 1.12 1999/08/11 22:14:17 niklas Exp $ */

/*
 * Copyright (c) 1988 University of Utah.
 * Copyright (c) 1992, 1993
 *	The Regents of the University of California.  All rights reserved.
 *
 * This code is derived from software contributed to Berkeley by
 * the Systems Programming Group of the University of Utah Computer
 * Science Department and Ralph Campbell.
 *
 * Redistribution and use in source and binary forms, with or without
 * modification, are permitted provided that the following conditions
 * are met:
 * 1. Redistributions of source code must retain the above copyright
 *    notice, this list of conditions and the following disclaimer.
 * 2. Redistributions in binary form must reproduce the above copyright
 *    notice, this list of conditions and the following disclaimer in the
 *    documentation and/or other materials provided with the distribution.
 * 3. All advertising materials mentioning features or use of this software
 *    must display the following acknowledgement:
 *	This product includes software developed by the University of
 *	California, Berkeley and its contributors.
 * 4. Neither the name of the University nor the names of its contributors
 *    may be used to endorse or promote products derived from this software
 *    without specific prior written permission.
 *
 * THIS SOFTWARE IS PROVIDED BY THE REGENTS AND CONTRIBUTORS ``AS IS'' AND
 * ANY EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT LIMITED TO, THE
 * IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE
 * ARE DISCLAIMED.  IN NO EVENT SHALL THE REGENTS OR CONTRIBUTORS BE LIABLE
 * FOR ANY DIRECT, INDIRECT, INCIDENTAL, SPECIAL, EXEMPLARY, OR CONSEQUENTIAL
 * DAMAGES (INCLUDING, BUT NOT LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS
 * OR SERVICES; LOSS OF USE, DATA, OR PROFITS; OR BUSINESS INTERRUPTION)
 * HOWEVER CAUSED AND ON ANY THEORY OF LIABILITY, WHETHER IN CONTRACT, STRICT
 * LIABILITY, OR TORT (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY
 * OUT OF THE USE OF THIS SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF
 * SUCH DAMAGE.
 *
 *	from: Utah Hdr: machparam.h 1.11 89/08/14
 *	from: @@(#)param.h	8.1 (Berkeley) 6/10/93
 */

#ifndef _MACHINE_PARAM_H_
#define _MACHINE_PARAM_H_

#ifdef _KERNEL    
#ifdef _LOCORE
#include <machine/psl.h>                                             
#else                                                                
#include <machine/cpu.h>
#endif                                                              
#endif                                                             

/*
 * Machine dependent constants for ARC BIOS MIPS machines:
 *	Acer Labs PICA_61
 *	Deskstation rPC44
 *	Deskstation Tyne
 *	Etc
 */
#define	MACHINE		"arc"
#define	_MACHINE	arc
#define MACHINE_ARCH	"mips"
#define _MACHINE_ARCH	mips

#define MID_MACHINE	0	/* None but has to be defined */

/*
 * Round p (pointer or byte index) up to a correctly-aligned value for all
 * data types (int, long, ...).   The result is u_int and must be cast to
 * any desired pointer type.
 */
#define	ALIGNBYTES	7
#define	ALIGN(p)	(((u_int)(p) + ALIGNBYTES) &~ ALIGNBYTES)
#define ALIGNED_POINTER(p, t)  ((((u_int32_t)(p)) & (sizeof (t) - 1)) == 0)

#define	NBPG		4096		/* bytes/page */
#define	PGOFSET		(NBPG-1)	/* byte offset into page */
#define	PGSHIFT		12		/* LOG2(NBPG) */
#define	NPTEPG		(NBPG/4)

#define NBSEG		0x400000	/* bytes/segment */
#define	SEGOFSET	(NBSEG-1)	/* byte offset into segment */
#define	SEGSHIFT	22		/* LOG2(NBSEG) */

#define	KERNBASE	0x80000000	/* start of kernel virtual */
#define	BTOPKERNBASE	((u_long)KERNBASE >> PGSHIFT)

#define	DEV_BSIZE	512
#define	DEV_BSHIFT	9		/* log2(DEV_BSIZE) */
#define BLKDEV_IOSIZE	2048
/* XXX Maxphys temporary changed to 32K while SCSI driver is fixed. */
#define	MAXPHYS		(32 * 1024)	/* max raw I/O transfer size */

#define	CLSIZE		1
#define	CLSIZELOG2	0

/* NOTE: SSIZE, SINCR and UPAGES must be multiples of CLSIZE */
#define	SSIZE		1		/* initial stack size/NBPG */
#define	SINCR		1		/* increment of stack/NBPG */

#define	UPAGES		2		/* pages of u-area */
#if defined(_LOCORE) && defined(notyet)
#define	UADDR		0xffffffffffffc000	/* address of u */
#else
#define	UADDR		0xffffc000	/* address of u */
#endif
#define USPACE		(UPAGES*NBPG)	/* size of u-area in bytes */
#define	UVPN		(UADDR>>PGSHIFT)/* virtual page number of u */
#define	KERNELSTACK	(UADDR+UPAGES*NBPG)	/* top of kernel stack */

/*
 * Constants related to network buffer management.
 * MCLBYTES must be no larger than CLBYTES (the software page size), and,
 * on machines that exchange pages of input or output buffers with mbuf
 * clusters (MAPPED_MBUFS), MCLBYTES must also be an integral multiple
 * of the hardware page size.
 */
#define	MSIZE		128		/* size of an mbuf */
#define	MCLSHIFT	11
#define	MCLBYTES	(1 << MCLSHIFT)	/* enough for whole Ethernet packet */
#define	MCLOFSET	(MCLBYTES - 1)
#ifndef NMBCLUSTERS
#ifdef GATEWAY
#define	NMBCLUSTERS	2048		/* map size, max cluster allocation */
#else
#define	NMBCLUSTERS	1024		/* map size, max cluster allocation */
#endif
#endif

/*
 * Size of kernel malloc arena in CLBYTES-sized logical pages
 */ 
#ifndef NKMEMCLUSTERS
#define	NKMEMCLUSTERS	(4096*1024/CLBYTES)
#endif

/* pages ("clicks") (4096 bytes) to disk blocks */
#define	ctod(x)	((x) << (PGSHIFT - DEV_BSHIFT))
#define	dtoc(x)	((x) >> (PGSHIFT - DEV_BSHIFT))

/* pages to bytes */
#define	ctob(x)	((x) << PGSHIFT)
#define btoc(x) (((x) + PGOFSET) >> PGSHIFT)

/* bytes to disk blocks */
#define	btodb(x)	((x) >> DEV_BSHIFT)
#define dbtob(x)	((x) << DEV_BSHIFT)

/*
 * Map a ``block device block'' to a file system block.
 * This should be device dependent, and should use the bsize
 * field from the disk label.
 * For now though just use DEV_BSIZE.
 */
#define	bdbtofsb(bn)	((bn) / (BLKDEV_IOSIZE/DEV_BSIZE))

/*
 * Conversion macros
 */
#define mips_round_page(x)	((((unsigned)(x)) + NBPG - 1) & ~(NBPG-1))
#define mips_trunc_page(x)	((unsigned)(x) & ~(NBPG-1))
#define mips_btop(x)		((unsigned)(x) >> PGSHIFT)
#define mips_ptob(x)		((unsigned)(x) << PGSHIFT)

#ifdef _KERNEL
#ifndef _LOCORE
extern int (*Mips_splnet)(void), (*Mips_splbio)(void), (*Mips_splimp)(void),
	   (*Mips_spltty)(void), (*Mips_splclock)(void), (*Mips_splstatclock)(void);
#define	splnet()	((*Mips_splnet)())
#define	splbio()	((*Mips_splbio)())
#define	splimp()	((*Mips_splimp)())
#define	spltty()	((*Mips_spltty)())
#define	splclock()	((*Mips_splclock)())
#define	splstatclock()	((*Mips_splstatclock)())

int splhigh __P((void));
int splx __P((int));
int spl0 __P((void));

/*
 *   Delay is based on an assumtion that each time in the loop
 *   takes 3 clocks. Three is for branch and subtract in the delay slot.
 */
extern	int cpuspeed;
#define	DELAY(n)	{ register int N = cpuspeed * (n); while ((N -= 3) > 0); }
void delay __P((int));
#endif

#else /* !_KERNEL */
#define	DELAY(n)	{ register int N = (n); while (--N > 0); }
#endif /* !_KERNEL */

#endif /* _MACHINE_PARAM_H_ */
@


1.12
log
@define ALIGNED_POINTER
@
text
@d1 1
a1 1
/*      $OpenBSD: param.h,v 1.11 1998/08/30 22:05:35 millert Exp $ */
@


1.12.4.1
log
@Update the SMP branch to -current, this breaks the SMP branch though.
But it will be fixed soonish.  Note, nothing new has happened, this is just
a merge of the trunk into this branch.
@
text
@d1 1
a1 1
/*      $OpenBSD: param.h,v 1.12 1999/08/11 22:14:17 niklas Exp $ */
@


1.11
log
@Add definition of MID_MACHINE.  Set to 0 (MID_ZERO) because it needs to be *something*
@
text
@d1 1
a1 1
/*      $OpenBSD: param.h,v 1.10 1998/01/28 13:46:20 pefo Exp $ */
d76 1
@


1.10
log
@Moving around files for new mips arch layout
@
text
@d1 1
a1 1
/*      $OpenBSD: param.h,v 1.9 1997/04/30 09:54:15 niklas Exp $ */
d66 2
@


1.9
log
@Our gas isn't ready for 64 bit constants used in expressions
@
text
@d1 1
a1 1
/*      $OpenBSD: param.h,v 1.8 1997/04/19 17:19:57 pefo Exp $ */
d44 2
a45 2
#ifndef _ARC_PARAM_H_
#define _ARC_PARAM_H_
d47 7
a53 1
#include <machine/intr.h>
a65 1
#define MID_MACHINE	MID_PMAX	/* XXX Bogus, but needed for now... */
d157 1
a157 1
 * Mach derived conversion macros
d166 8
a173 8
extern int (*Mach_splnet)(void), (*Mach_splbio)(void), (*Mach_splimp)(void),
	   (*Mach_spltty)(void), (*Mach_splclock)(void), (*Mach_splstatclock)(void);
#define	splnet()	((*Mach_splnet)())
#define	splbio()	((*Mach_splbio)())
#define	splimp()	((*Mach_splimp)())
#define	spltty()	((*Mach_spltty)())
#define	splclock()	((*Mach_splclock)())
#define	splstatclock()	((*Mach_splstatclock)())
d192 1
a192 1
#endif /* _ARC_PARAM_H_ */
@


1.8
log
@-Wall cleanup.
Change to new MI assym.h file generation. (genassym.cf)
@
text
@d1 1
a1 1
/*      $OpenBSD: param.h,v 1.7 1997/02/28 22:57:34 niklas Exp $ */
d96 1
a96 1
#ifdef _LOCORE
@


1.7
log
@Add missing _MACHINE & _MACHINE_ARCH defines + some RCS Ids
@
text
@d1 1
a1 1
/*      $OpenBSD: param.h,v 1.6 1996/12/11 11:12:54 deraadt Exp $ */
d44 5
d96 3
d100 1
d161 2
a162 2
extern int (*Mach_splnet)(), (*Mach_splbio)(), (*Mach_splimp)(),
	   (*Mach_spltty)(), (*Mach_splclock)(), (*Mach_splstatclock)();
d170 4
d180 1
d186 2
@


1.6
log
@MCLSHIFT=11, and calc MCLBYTES in such terms. found by pefo
@
text
@d1 1
a1 1
/*      $OpenBSD: param.h,v 1.5 1996/09/20 18:18:46 pefo Exp $ */
d51 5
a55 3
#define	MACHINE	     "arc"
#define MACHINE_ARCH "mips"
#define MID_MACHINE  MID_PMAX	/* XXX Bogus, but we need it for now... */
@


1.5
log
@temp kludge until generic scsi is fixed
@
text
@d1 1
a1 1
/*      $OpenBSD: param.h,v 1.4 1996/08/26 11:12:03 pefo Exp $ */
d102 2
a103 2
#define	MCLBYTES	2048		/* enough for whole Ethernet packet */
#define	MCLSHIFT	10
@


1.4
log
@Changes and bugfixes in memory handling system.
Sysmap too small.
Alloc map page failure.
Support for discontigous memory. Needs testing.
Name changes. "Mach" removal.
Kernel memory size increased.
@
text
@d1 1
a1 1
/*      $OpenBSD: param.h,v 1.3 1996/08/24 18:10:37 imp Exp $ */
a72 3
#if 0
#define	KERNTEXTOFF	0x80080000	/* start of kernel text for kvm_mkdb */
#endif
d78 2
a79 1
#define	MAXPHYS		(64 * 1024)	/* max raw I/O transfer size */
@


1.3
log
@Clarify comment
@
text
@d1 1
a1 1
/*      $OpenBSD: param.h,v 1.2 1996/07/16 07:46:17 pefo Exp $ */
d53 1
a53 2
#define MID_PICA MID_PMAX /* For the moment */
#define MID_MACHINE  MID_PICA
d73 1
d75 1
d119 1
a119 1
#define	NKMEMCLUSTERS	(512*1024/CLBYTES)
@


1.2
log
@Rename some 'pica' names to 'mips'.
@
text
@d1 1
a1 1
/*      $OpenBSD: param.h,v 1.1.1.1 1996/06/24 09:07:17 pefo Exp $ */
d45 5
a49 1
 * Machine dependent constants for Acer Labs PICA_61.
@


1.1
log
@Initial revision
@
text
@d1 1
a1 1
/*      $OpenBSD: param.h,v 1.4 1996/06/06 23:06:53 deraadt Exp $ */
d140 4
a143 4
#define pica_round_page(x)	((((unsigned)(x)) + NBPG - 1) & ~(NBPG-1))
#define pica_trunc_page(x)	((unsigned)(x) & ~(NBPG-1))
#define pica_btop(x)		((unsigned)(x) >> PGSHIFT)
#define pica_ptob(x)		((unsigned)(x) << PGSHIFT)
@


1.1.1.1
log
@Next try. ARC tree import. "New" Mips (spim) ARC compliant systems tree.
This tree will eventually suport viritualy all ARC compliant Mips systems,
that is all we can lay our hands on for porting/testing. It will supersede
the pica tree which will be removed shortly when this tree is functioning.
@
text
@@
