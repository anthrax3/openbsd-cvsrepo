head	1.26;
access;
symbols
	OPENBSD_6_0:1.25.0.6
	OPENBSD_6_0_BASE:1.25
	OPENBSD_5_9:1.25.0.2
	OPENBSD_5_9_BASE:1.25
	OPENBSD_5_8:1.25.0.4
	OPENBSD_5_8_BASE:1.25
	OPENBSD_5_7:1.24.0.2
	OPENBSD_5_7_BASE:1.24
	OPENBSD_5_6:1.23.0.14
	OPENBSD_5_6_BASE:1.23
	OPENBSD_5_5:1.23.0.12
	OPENBSD_5_5_BASE:1.23
	OPENBSD_5_4:1.23.0.8
	OPENBSD_5_4_BASE:1.23
	OPENBSD_5_3:1.23.0.6
	OPENBSD_5_3_BASE:1.23
	OPENBSD_5_2:1.23.0.4
	OPENBSD_5_2_BASE:1.23
	OPENBSD_5_1_BASE:1.23
	OPENBSD_5_1:1.23.0.2
	OPENBSD_5_0:1.22.0.4
	OPENBSD_5_0_BASE:1.22
	OPENBSD_4_9:1.22.0.2
	OPENBSD_4_9_BASE:1.22
	OPENBSD_4_8:1.21.0.6
	OPENBSD_4_8_BASE:1.21
	OPENBSD_4_7:1.21.0.2
	OPENBSD_4_7_BASE:1.21
	OPENBSD_4_6:1.21.0.4
	OPENBSD_4_6_BASE:1.21
	OPENBSD_4_5:1.20.0.8
	OPENBSD_4_5_BASE:1.20
	OPENBSD_4_4:1.20.0.6
	OPENBSD_4_4_BASE:1.20
	OPENBSD_4_3:1.20.0.4
	OPENBSD_4_3_BASE:1.20
	OPENBSD_4_2:1.20.0.2
	OPENBSD_4_2_BASE:1.20
	OPENBSD_4_1:1.19.0.8
	OPENBSD_4_1_BASE:1.19
	OPENBSD_4_0:1.19.0.6
	OPENBSD_4_0_BASE:1.19
	OPENBSD_3_9:1.19.0.4
	OPENBSD_3_9_BASE:1.19
	OPENBSD_3_8:1.19.0.2
	OPENBSD_3_8_BASE:1.19
	OPENBSD_3_7:1.17.0.2
	OPENBSD_3_7_BASE:1.17
	OPENBSD_3_6:1.15.0.2
	OPENBSD_3_6_BASE:1.15
	SMP_SYNC_A:1.14
	SMP_SYNC_B:1.14
	OPENBSD_3_5:1.14.0.4
	OPENBSD_3_5_BASE:1.14
	OPENBSD_3_4:1.14.0.2
	OPENBSD_3_4_BASE:1.14
	UBC_SYNC_A:1.13
	OPENBSD_3_3:1.12.0.4
	OPENBSD_3_3_BASE:1.12
	OPENBSD_3_2:1.12.0.2
	OPENBSD_3_2_BASE:1.12
	OPENBSD_3_1:1.10.0.2
	OPENBSD_3_1_BASE:1.10
	UBC_SYNC_B:1.12
	UBC:1.8.0.4
	UBC_BASE:1.8
	OPENBSD_3_0:1.8.0.2
	OPENBSD_3_0_BASE:1.8
	OPENBSD_2_9_BASE:1.6
	OPENBSD_2_9:1.6.0.6
	OPENBSD_2_8:1.6.0.4
	OPENBSD_2_8_BASE:1.6
	OPENBSD_2_7:1.6.0.2
	OPENBSD_2_7_BASE:1.6
	SMP:1.4.0.2
	SMP_BASE:1.4
	kame_19991208:1.3
	OPENBSD_2_6:1.3.0.2
	OPENBSD_2_6_BASE:1.3
	OPENBSD_2_5:1.2.0.8
	OPENBSD_2_5_BASE:1.2
	OPENBSD_2_4:1.2.0.6
	OPENBSD_2_4_BASE:1.2
	OPENBSD_2_3:1.2.0.4
	OPENBSD_2_3_BASE:1.2
	OPENBSD_2_2:1.2.0.2
	OPENBSD_2_2_BASE:1.2;
locks; strict;
comment	@# @;


1.26
date	2016.09.01.09.23.42;	author tedu;	state dead;
branches;
next	1.25;
commitid	Q2PxaFNhqAe0Wmla;

1.25
date	2015.03.18.20.49.40;	author miod;	state Exp;
branches;
next	1.24;
commitid	L6hoLZci9pFouDHc;

1.24
date	2015.02.09.09.21.30;	author miod;	state Exp;
branches;
next	1.23;
commitid	yX211148OePJhQ1v;

1.23
date	2011.09.03.20.04.04;	author miod;	state Exp;
branches;
next	1.22;

1.22
date	2010.08.17.20.05.08;	author miod;	state Exp;
branches;
next	1.21;

1.21
date	2009.04.10.20.53.54;	author miod;	state Exp;
branches;
next	1.20;

1.20
date	2007.05.08.07.23.18;	author art;	state Exp;
branches;
next	1.19;

1.19
date	2005.04.17.18.47.50;	author miod;	state Exp;
branches;
next	1.18;

1.18
date	2005.04.16.15.07.29;	author miod;	state Exp;
branches;
next	1.17;

1.17
date	2004.09.29.07.35.13;	author miod;	state Exp;
branches;
next	1.16;

1.16
date	2004.09.22.22.12.59;	author miod;	state Exp;
branches;
next	1.15;

1.15
date	2004.06.13.21.49.20;	author niklas;	state Exp;
branches;
next	1.14;

1.14
date	2003.06.02.23.27.55;	author millert;	state Exp;
branches;
next	1.13;

1.13
date	2003.05.15.02.39.16;	author miod;	state Exp;
branches;
next	1.12;

1.12
date	2002.04.30.01.12.28;	author art;	state Exp;
branches;
next	1.11;

1.11
date	2002.04.28.21.48.08;	author art;	state Exp;
branches;
next	1.10;

1.10
date	2002.02.20.22.28.23;	author deraadt;	state Exp;
branches;
next	1.9;

1.9
date	2002.01.16.20.50.17;	author miod;	state Exp;
branches;
next	1.8;

1.8
date	2001.09.16.14.28.04;	author miod;	state Exp;
branches
	1.8.4.1;
next	1.7;

1.7
date	2001.05.10.10.34.45;	author art;	state Exp;
branches;
next	1.6;

1.6
date	2000.02.21.17.08.36;	author art;	state Exp;
branches;
next	1.5;

1.5
date	2000.02.19.22.00.34;	author art;	state Exp;
branches;
next	1.4;

1.4
date	2000.01.31.16.06.58;	author art;	state Exp;
branches
	1.4.2.1;
next	1.3;

1.3
date	99.04.22.18.28.26;	author art;	state Exp;
branches;
next	1.2;

1.2
date	97.08.08.08.27.14;	author downsj;	state Exp;
branches;
next	1.1;

1.1
date	97.06.25.14.47.12;	author downsj;	state Exp;
branches;
next	;

1.4.2.1
date	2000.02.20.11.56.52;	author niklas;	state Exp;
branches;
next	1.4.2.2;

1.4.2.2
date	2000.02.21.22.29.03;	author niklas;	state Exp;
branches;
next	1.4.2.3;

1.4.2.3
date	2001.07.04.10.23.41;	author niklas;	state Exp;
branches;
next	1.4.2.4;

1.4.2.4
date	2001.10.31.03.07.57;	author nate;	state Exp;
branches;
next	1.4.2.5;

1.4.2.5
date	2002.03.06.02.04.46;	author niklas;	state Exp;
branches;
next	1.4.2.6;

1.4.2.6
date	2003.03.27.23.49.26;	author niklas;	state Exp;
branches;
next	1.4.2.7;

1.4.2.7
date	2003.05.16.00.29.40;	author niklas;	state Exp;
branches;
next	1.4.2.8;

1.4.2.8
date	2003.06.07.11.14.44;	author ho;	state Exp;
branches;
next	1.4.2.9;

1.4.2.9
date	2004.06.07.18.47.43;	author tedu;	state Exp;
branches;
next	;

1.8.4.1
date	2002.01.31.22.55.22;	author niklas;	state Exp;
branches;
next	1.8.4.2;

1.8.4.2
date	2002.06.11.03.38.16;	author art;	state Exp;
branches;
next	1.8.4.3;

1.8.4.3
date	2003.05.19.21.46.32;	author tedu;	state Exp;
branches;
next	;


desc
@@


1.26
log
@Celebrate OpenBSD 6.0 release by retiring the sparc port.
You've served us well, good friend, but now it's time to rest.
ok deraadt
@
text
@#	$OpenBSD: genassym.cf,v 1.25 2015/03/18 20:49:40 miod Exp $
#	$NetBSD: genassym.cf,v 1.2 1997/06/28 19:59:04 pk Exp $

#
# Copyright (c) 1997 Christos Zoulas.  All rights reserved.
# Copyright (c) 1992, 1993
#	The Regents of the University of California.  All rights reserved.
#
# This software was developed by the Computer Systems Engineering group
# at Lawrence Berkeley Laboratory under DARPA contract BG 91-66 and
# contributed to Berkeley.
#
# All advertising materials mentioning features or use of this software
# must display the following acknowledgement:
#	This product includes software developed by the University of
#	California, Lawrence Berkeley Laboratory.
#
# Redistribution and use in source and binary forms, with or without
# modification, are permitted provided that the following conditions
# are met:
# 1. Redistributions of source code must retain the above copyright
#    notice, this list of conditions and the following disclaimer.
# 2. Redistributions in binary form must reproduce the above copyright
#    notice, this list of conditions and the following disclaimer in the
#    documentation and/or other materials provided with the distribution.
# 3. Neither the name of the University nor the names of its contributors
#    may be used to endorse or promote products derived from this software
#    without specific prior written permission.
#
# THIS SOFTWARE IS PROVIDED BY THE REGENTS AND CONTRIBUTORS ``AS IS'' AND
# ANY EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT LIMITED TO, THE
# IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE
# ARE DISCLAIMED.  IN NO EVENT SHALL THE REGENTS OR CONTRIBUTORS BE LIABLE
# FOR ANY DIRECT, INDIRECT, INCIDENTAL, SPECIAL, EXEMPLARY, OR CONSEQUENTIAL
# DAMAGES (INCLUDING, BUT NOT LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS
# OR SERVICES; LOSS OF USE, DATA, OR PROFITS; OR BUSINESS INTERRUPTION)
# HOWEVER CAUSED AND ON ANY THEORY OF LIABILITY, WHETHER IN CONTRACT, STRICT
# LIABILITY, OR TORT (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY
# OUT OF THE USE OF THIS SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF
# SUCH DAMAGE.
#
#	@@(#)genassym.c	8.1 (Berkeley) 6/11/93
#

include <sys/param.h>
include <sys/buf.h>
include <sys/proc.h>
include <sys/mbuf.h>
include <sys/msgbuf.h>
include <sys/syscall.h>
include <sys/user.h>
include <sys/device.h>
include <sys/disklabel.h>
include <sys/disk.h>

include <uvm/uvm_extern.h>

include <machine/pmap.h>
include <machine/cpu.h>
include <machine/intr.h>

include <machine/oldmon.h>
include <machine/bsd_openprom.h>

include <sparc/sparc/cpuvar.h>

include <sparc/dev/audioamdvar.h>

include <sparc/dev/fdreg.h>
include <sparc/dev/fdvar.h>

# general constants
export	SUN4_PGSHIFT
export	SUN4CM_PGSHIFT
export	IOSPACE_BASE
if defined(VM_MIN_KERNEL_ADDRESS)
export	VM_MIN_KERNEL_ADDRESS
endif

# proc fields and values
struct	proc
member	p_addr
member	p_stat
member	p_wchan
member	p_vmspace

export	SRUN
export	SONPROC

# VM structure fields
define	VM_PMAP		offsetof(struct vmspace, vm_map.pmap)
struct	pmap
member	PMAP_CTX	pm_ctx
member	PMAP_CTXNUM	pm_ctxnum

# interrupt/fault metering
struct	uvmexp		V_
member	swtch
member	INTR		intrs
member	faults
member	softs

# CPU info structure
struct	cpu_softc
member  CPUINFO_GETSYNCFLT      get_syncflt
member  CPUINFO_GETASYNCFLT     get_asyncflt
member  CPUINFO_SYNCFLTDUMP     syncfltdump
member	CPUINFO_PURE_VCACHE_FLS	pure_vcache_flush
member	CPUINFO_CURPROC		ci.ci_curproc

# PTE bits and related information
export	PG_W
export	PG_VSHIFT
export	PG_PROTSHIFT
export	PG_PROTUREAD
export	PG_PROTUWRITE
if defined(SUN4M)
export	SRMMU_TETYPE
export	SRMMU_TEPTE
export	SRMMU_PROT_MASK
export	PPROT_R_RW
export	PPROT_RX_RX
export	PPROT_RWX_RWX
export	PPROT_WRITE
endif

# FPU state
struct	fpstate
member	fs_regs
member	fs_fsr
member	fs_qsize
member	fs_queue
export	FSR_QNE

# system calls
export	SYS_sigreturn
export	SYS_execve
export	SYS_exit

# errno
export	EFAULT
export	ENAMETOOLONG

# PCB fields
struct	pcb
member	pcb_nsaved
member	pcb_onfault
member	pcb_psr
member	pcb_rw
member	pcb_sp
member	pcb_pc
member	pcb_uw
member	pcb_wim
member	pcb_wcookie

# interrupt enable register PTE
define	IE_REG_PTE_PG	(PG_V | PG_W | PG_S | PG_NC | PG_OBIO)

# intrhand fields.
struct	intrhand
member	ih_fun
member	ih_arg
member	ih_ipl
member	ih_next
member	IH_COUNT	ih_count.ec_count

# sintrhand fields.
struct	sintrhand
member	sih_pending

ifdef notyet
# ZSCC interrupt fields
struct	zs_softc	Z
member	sc_a
member	sc_b
struct	zs_line
member	zl_wreg
member	zl_tbc
member	zl_tba
member	zl_rbput
member	zl_rbuf
define	ZSRR1_DO_bit	ffs(ZSRR1_DO) - 1
endif

# audio trap handler fields
struct	auio
member	au_amd
member	au_rdata
member	au_rend
member	au_pdata
member	au_pend
member	AU_COUNT	au_ih.ih_count.ec_count
member	au_swih

export	PROM_BASE

struct	promvec
member	pv_nodeops
member	pv_halt
member	PV_EVAL		pv_fortheval.v0_eval
member	pv_romvec_vers

struct	nodeops
member	no_nextnode
member	no_getprop

struct	om_vector	OLDMON_
member	printf
member	HALT		exitToMon

# floppy trap handler fields
struct	fdcio
member	FDC_REG_MSR	fdcio_reg_msr
member	FDC_REG_FIFO	fdcio_reg_fifo
member	FDC_ITASK	fdcio_itask
member	FDC_ISTATUS	fdcio_istatus
member	FDC_STATUS	fdcio_status
member	FDC_NSTAT	fdcio_nstat
member	FDC_DATA	fdcio_data
member	FDC_TC		fdcio_tc
member	FDC_COUNT	fdcio_ih.ih_count.ec_count
member	FDC_SIH		fdcio_sih
@


1.25
log
@Allow for VM_MIN_KERNEL_ADDRESS to not be a constant.
@
text
@d1 1
a1 1
#	$OpenBSD: genassym.cf,v 1.24 2015/02/09 09:21:30 miod Exp $
@


1.24
log
@Do not use USRSTACK when VM_MIN_KERNEL_ADDRESS is what you really mean.
@
text
@d1 1
a1 1
#	$OpenBSD: genassym.cf,v 1.23 2011/09/03 20:04:04 miod Exp $
d76 1
d78 1
@


1.23
log
@Switch the sparc audioamd(4) code to the MI driver; tested on SPARCclassic
with and without option AUDIO_C_HANDLER.
@
text
@d1 1
a1 1
#	$OpenBSD: genassym.cf,v 1.22 2010/08/17 20:05:08 miod Exp $
a74 1
export	USRSTACK
@


1.22
log
@Make sure fast trap handlers correctly invoke soft interrupts by marking
them explicitely pending before triggering the softintr; I am ashamed I did
not notice this when changing the soft interrupt code 18 months ago.
Noticed by claudio@@ and beck@@
@
text
@d1 1
a1 1
#	$OpenBSD: genassym.cf,v 1.21 2009/04/10 20:53:54 miod Exp $
d67 1
a67 2
include <dev/ic/am7930reg.h>
include <sparc/dev/amd7930var.h>
a192 5

struct	amd7930		AMD_
member	ir
member	bbrb
member	bbtb
@


1.21
log
@generic soft interrupts support for sparc. Soft interrupt handlers are now
kept in a separate intrhand array, with their own enable bits so that
soft interrupts sharing the same level only get invoked if really triggered.
Inspired by NetBSD with significant changes.

ok kettenis@@
@
text
@d1 1
a1 1
#	$OpenBSD: genassym.cf,v 1.20 2007/05/08 07:23:18 art Exp $
d193 1
d227 1
@


1.20
log
@Switch sparc to __HAVE_CPUINFO.

miod@@ tested (since I hacked it up blindly) and ok.
@
text
@d1 1
a1 1
#	$OpenBSD: genassym.cf,v 1.19 2005/04/17 18:47:50 miod Exp $
d60 1
d101 1
d166 4
@


1.19
log
@Do not use KERNBASE when VM_MIN_KERNEL_ADDRESS or VM_MAXUSER_ADDRESS are
implied; this currently does not change anything (yet).

Also, define the I/O space range in <machine/vmparam.h> rather than in
<sparc/sparc/vaddrs.h>.

ok deraadt@@ mickey@@
@
text
@d1 1
a1 1
#	$OpenBSD: genassym.cf,v 1.18 2005/04/16 15:07:29 miod Exp $
d107 1
@


1.18
log
@Duplicate include file.
@
text
@d1 1
a1 1
#	$OpenBSD: genassym.cf,v 1.17 2004/09/29 07:35:13 miod Exp $
a72 1
export	BSD
d76 2
@


1.17
log
@Switch sparc to evcount; ok deraadt@@
@
text
@d1 1
a1 1
#	$OpenBSD: genassym.cf,v 1.16 2004/09/22 22:12:59 miod Exp $
a46 1
include <sys/proc.h>
@


1.16
log
@Bring some enhancements and fixes to fdc(4) from NetBSD:
- better state machine, will prevent "eject fd0" with an empty drive to
  spin.
- will not attach fd children to fdc if no floppy drive is present (though
  the PROM usually finds this for us).
- use biowait() in fdformat() instead of rolling our own.
- drop 5"1/4 formats table.
- cope with non 512 bytes per sector formats.
@
text
@d1 1
a1 1
#	$OpenBSD: genassym.cf,v 1.15 2004/06/13 21:49:20 niklas Exp $
d162 1
d185 1
a185 1
define	AU_EVCNT	offsetof(struct auio, au_intrcnt.ev_count)
d218 1
a218 1
member	FDC_EVCNT	fdcio_intrcnt.ev_count
@


1.15
log
@debranch SMP, have fun
@
text
@d1 1
a1 1
#	$OpenBSD$
d211 2
a212 1
member	FDC_ISTATE	fdcio_istate
@


1.14
log
@Remove the advertising clause in the UCB license which Berkeley
rescinded 22 July 1999.  Proofed by myself and Theo.
@
text
@d1 1
a1 1
#	$OpenBSD: genassym.cf,v 1.13 2003/05/15 02:39:16 miod Exp $
d87 1
@


1.13
log
@Remove relics of an ancient past
@
text
@d1 1
a1 1
#	$OpenBSD: genassym.cf,v 1.12 2002/04/30 01:12:28 art Exp $
d26 1
a26 5
# 3. All advertising materials mentioning features or use of this software
#    must display the following acknowledgement:
#	This product includes software developed by the University of
#	California, Berkeley and its contributors.
# 4. Neither the name of the University nor the names of its contributors
@


1.12
log
@Fix an ancient problem in how sparc interrupts are handled.

There are many interrupt handlers that assume that they don't need to do
any spl protection in their code because the interrupt of some level can't
be interrupted by an interrupt of the same level. The problem is that some
interrupt handlers have hardware levels that are lower then their "software"
levels.

Fix this by adding an additional field to struct intrhand that specifies which
"software" level an interrupt handler has and blocks that level while handling
the interrupt. This new field is initialized in intr_establish which gets
an additional argument (which can be -1 meaning that the interrupt handler
doesn't need to block any additional level).

ok deraadt@@
@
text
@d1 1
a1 1
#	$OpenBSD: genassym.cf,v 1.11 2002/04/28 21:48:08 art Exp $
a69 5

ifdef notyet
include <sparc/dev/zsreg.h>
include <sparc/dev/zsvar.h>
endif
@


1.11
log
@Use assym.h for intrhand fields.
ok deraadt@@
@
text
@d1 1
a1 1
#	$OpenBSD: genassym.cf,v 1.10 2002/02/20 22:28:23 deraadt Exp $
d168 1
@


1.10
log
@frantzen's stackghost code.  wcookie is set at 0 right now, until debugger
support added (i mean, written)
@
text
@d1 1
a1 1
#	$OpenBSD: genassym.cf,v 1.9 2002/01/16 20:50:17 miod Exp $
d163 6
@


1.9
log
@Don't include <sys/map.h> when you don't need what's in it.
@
text
@d1 1
a1 1
#	$OpenBSD: genassym.cf,v 1.8 2001/09/16 14:28:04 miod Exp $
d159 1
@


1.8
log
@Make use of "export", "struct" and "member" keywords to be easier to read
and simpler.
@
text
@d1 1
a1 1
#	$OpenBSD: genassym.cf,v 1.7 2001/05/10 10:34:45 art Exp $
a51 1
include <sys/map.h>
@


1.8.4.1
log
@Merge in -current, builds on i386, otherwise untested
@
text
@d1 1
a1 1
#	$OpenBSD: genassym.cf,v 1.9 2002/01/16 20:50:17 miod Exp $
d52 1
@


1.8.4.2
log
@Sync UBC branch to -current
@
text
@d1 1
a1 1
#	$OpenBSD: genassym.cf,v 1.8.4.1 2002/01/31 22:55:22 niklas Exp $
a158 1
member	pcb_wcookie
a161 7

# intrhand fields.
struct	intrhand
member	ih_fun
member	ih_arg
member	ih_ipl
member	ih_next
@


1.8.4.3
log
@sync
@
text
@d1 1
a1 1
#	$OpenBSD$
d70 5
@


1.7
log
@UVM is no longer optional on sparc.
@
text
@d1 1
a1 1
#	$OpenBSD: genassym.cf,v 1.6 2000/02/21 17:08:36 art Exp $
d84 4
a87 4
define	BSD		BSD
define	SUN4_PGSHIFT	SUN4_PGSHIFT
define	SUN4CM_PGSHIFT	SUN4CM_PGSHIFT
define	USRSTACK	USRSTACK
d90 7
a96 5
define	P_ADDR		offsetof(struct proc, p_addr)
define	P_STAT		offsetof(struct proc, p_stat)
define	P_WCHAN		offsetof(struct proc, p_wchan)
define	P_VMSPACE	offsetof(struct proc, p_vmspace)
define	SRUN		SRUN
d100 3
a102 2
define	PMAP_CTX	offsetof(struct pmap, pm_ctx)
define	PMAP_CTXNUM	offsetof(struct pmap, pm_ctxnum)
d105 4
a108 3
define  V_SWTCH		offsetof(struct uvmexp, swtch)
define  V_INTR		offsetof(struct uvmexp, intrs)
define  V_FAULTS	offsetof(struct uvmexp, faults)
d111 5
a115 4
define  CPUINFO_GETSYNCFLT      offsetof(struct cpu_softc, get_syncflt)
define  CPUINFO_GETASYNCFLT     offsetof(struct cpu_softc, get_asyncflt)
define  CPUINFO_SYNCFLTDUMP     offsetof(struct cpu_softc, syncfltdump)
define	CPUINFO_PURE_VCACHE_FLS	offsetof(struct cpu_softc, pure_vcache_flush)
d118 5
a122 5
define	PG_W		PG_W
define	PG_VSHIFT	PG_VSHIFT
define	PG_PROTSHIFT	PG_PROTSHIFT
define	PG_PROTUREAD	PG_PROTUREAD
define	PG_PROTUWRITE	PG_PROTUWRITE
d124 7
a130 7
define	SRMMU_TETYPE	SRMMU_TETYPE
define	SRMMU_TEPTE	SRMMU_TEPTE
define	SRMMU_PROT_MASK	SRMMU_PROT_MASK
define	PPROT_R_RW	PPROT_R_RW
define	PPROT_RX_RX	PPROT_RX_RX
define	PPROT_RWX_RWX	PPROT_RWX_RWX
define	PPROT_WRITE	PPROT_WRITE
d134 6
a139 5
define	FS_REGS		offsetof(struct fpstate, fs_regs)
define	FS_FSR		offsetof(struct fpstate, fs_fsr)
define	FS_QSIZE	offsetof(struct fpstate, fs_qsize)
define	FS_QUEUE	offsetof(struct fpstate, fs_queue)
define	FSR_QNE		FSR_QNE
d142 3
a144 3
define	SYS_sigreturn	SYS_sigreturn
define	SYS_execve	SYS_execve
define	SYS_exit	SYS_exit
d147 2
a148 2
define	EFAULT		EFAULT
define	ENAMETOOLONG	ENAMETOOLONG
d151 9
a159 8
define	PCB_NSAVED	offsetof(struct pcb, pcb_nsaved)
define	PCB_ONFAULT	offsetof(struct pcb, pcb_onfault)
define	PCB_PSR		offsetof(struct pcb, pcb_psr)
define	PCB_RW		offsetof(struct pcb, pcb_rw)
define	PCB_SP		offsetof(struct pcb, pcb_sp)
define	PCB_PC		offsetof(struct pcb, pcb_pc)
define	PCB_UW		offsetof(struct pcb, pcb_uw)
define	PCB_WIM		offsetof(struct pcb, pcb_wim)
d166 9
a174 7
define	ZSC_A		offsetof(struct zs_softc, sc_a)
define	ZSC_B		offsetof(struct zs_softc, sc_b)
define	ZL_WREG		offsetof(struct zs_line, zl_wreg)
define	ZL_TBC		offsetof(struct zs_line, zl_tbc)
define	ZL_TBA		offsetof(struct zs_line, zl_tba)
define	ZL_RBPUT	offsetof(struct zs_line, zl_rbput)
define	ZL_RBUF		offsetof(struct zs_line, zl_rbuf)
d179 6
a184 5
define	AU_AMD		offsetof(struct auio, au_amd)
define	AU_RDATA	offsetof(struct auio, au_rdata)
define	AU_REND		offsetof(struct auio, au_rend)
define	AU_PDATA	offsetof(struct auio, au_pdata)
define	AU_PEND		offsetof(struct auio, au_pend)
d187 20
a206 16
define	AMD_IR		offsetof(struct amd7930, ir)
define	AMD_BBRB	offsetof(struct amd7930, bbrb)
define	AMD_BBTB	offsetof(struct amd7930, bbtb)

define	PROM_BASE	PROM_BASE

define	PV_NODEOPS	offsetof(struct promvec, pv_nodeops)
define	PV_HALT		offsetof(struct promvec, pv_halt)
define	PV_EVAL		offsetof(struct promvec, pv_fortheval.v0_eval)
define	PV_ROMVEC_VERS	offsetof(struct promvec, pv_romvec_vers)

define	NO_NEXTNODE	offsetof(struct nodeops, no_nextnode)
define	NO_GETPROP	offsetof(struct nodeops, no_getprop)

define	OLDMON_PRINTF	offsetof(struct om_vector, printf)
define	OLDMON_HALT	offsetof(struct om_vector, exitToMon)
d209 9
a217 8
define	FDC_REG_MSR	offsetof(struct fdcio, fdcio_reg_msr)
define	FDC_REG_FIFO	offsetof(struct fdcio, fdcio_reg_fifo)
define	FDC_ISTATE	offsetof(struct fdcio, fdcio_istate)
define	FDC_STATUS	offsetof(struct fdcio, fdcio_status)
define	FDC_NSTAT	offsetof(struct fdcio, fdcio_nstat)
define	FDC_DATA	offsetof(struct fdcio, fdcio_data)
define	FDC_TC		offsetof(struct fdcio, fdcio_tc)
define	FDC_EVCNT	offsetof(struct fdcio, fdcio_intrcnt.ev_count)
@


1.6
log
@The last pieces of hypersparc support.
 - Split get_faultstatus into get_syncflt and get_asyncflt.
 - Get the syncflt status before setting up the trap frame and put the
   results in cpuinfo.syncfltdump (related to the next change).
 - unlock the sfsr/sfva after reading from ASI_SRMMUFP (it gets locked if
   the translation fails).
 - + other interface changes and cleanups.
 (most work from NetBSD).
@
text
@d1 1
a1 1
#	$OpenBSD: genassym.cf,v 1.5 2000/02/19 22:00:34 art Exp $
a61 1
ifdef UVM
a62 1
endif
a101 1
ifdef UVM
a104 5
else
define	V_SWTCH		offsetof(struct vmmeter, v_swtch)
define	V_INTR		offsetof(struct vmmeter, v_intr)
define	V_FAULTS	offsetof(struct vmmeter, v_faults)
endif
@


1.5
log
@get a symbol for pure_vcache_flush
@
text
@d1 1
a1 1
#	$OpenBSD: genassym.cf,v 1.4 2000/01/31 16:06:58 art Exp $
d115 3
a117 2
define	CPUINFO_FAULTSTATUS	offsetof(struct cpu_softc, get_faultstatus)
define	CPUINFO_MEMERR		offsetof(struct cpu_softc, memerr)
@


1.4
log
@Clean up memerr*. (from NetBSD)
@
text
@d1 1
a1 1
#	$OpenBSD: genassym.cf,v 1.3 1999/04/22 18:28:26 art Exp $
d116 2
a117 1
define CPUINFO_MEMERR		offsetof(struct cpu_softc, memerr)
@


1.4.2.1
log
@Merge in recent code from the trunk
@
text
@d1 1
a1 1
#	$OpenBSD: genassym.cf,v 1.5 2000/02/19 22:00:34 art Exp $
d116 1
a116 2
define	CPUINFO_MEMERR		offsetof(struct cpu_softc, memerr)
define	CPUINFO_PURE_VCACHE_FLS	offsetof(struct cpu_softc, pure_vcache_flush)
@


1.4.2.2
log
@sync with -current
@
text
@d1 1
a1 1
#	$OpenBSD: genassym.cf,v 1.6 2000/02/21 17:08:36 art Exp $
d115 2
a116 3
define  CPUINFO_GETSYNCFLT      offsetof(struct cpu_softc, get_syncflt)
define  CPUINFO_GETASYNCFLT     offsetof(struct cpu_softc, get_asyncflt)
define  CPUINFO_SYNCFLTDUMP     offsetof(struct cpu_softc, syncfltdump)
@


1.4.2.3
log
@Merge in -current from two days ago in the SMP branch.
As usual with merges, they do not indicate progress, so do not hold
your breath for working SMP, and do not mail me and ask about the
state of it.  It has not changed.  There is work ongoing, but very, very
slowly.  The commit is done in parts as to not lock up the tree in too
big chunks at a time.
@
text
@d1 1
a1 1
#	$OpenBSD: genassym.cf,v 1.4.2.2 2000/02/21 22:29:03 niklas Exp $
d62 1
d64 1
d104 1
d108 5
@


1.4.2.4
log
@Sync the SMP branch to something just after 3.0
@
text
@d1 1
a1 1
#	$OpenBSD: genassym.cf,v 1.4.2.3 2001/07/04 10:23:41 niklas Exp $
d84 4
a87 4
export	BSD
export	SUN4_PGSHIFT
export	SUN4CM_PGSHIFT
export	USRSTACK
d90 5
a94 7
struct	proc
member	p_addr
member	p_stat
member	p_wchan
member	p_vmspace

export	SRUN
d98 2
a99 3
struct	pmap
member	PMAP_CTX	pm_ctx
member	PMAP_CTXNUM	pm_ctxnum
d102 3
a104 4
struct	uvmexp		V_
member	swtch
member	INTR		intrs
member	faults
d107 4
a110 5
struct	cpu_softc
member  CPUINFO_GETSYNCFLT      get_syncflt
member  CPUINFO_GETASYNCFLT     get_asyncflt
member  CPUINFO_SYNCFLTDUMP     syncfltdump
member	CPUINFO_PURE_VCACHE_FLS	pure_vcache_flush
d113 5
a117 5
export	PG_W
export	PG_VSHIFT
export	PG_PROTSHIFT
export	PG_PROTUREAD
export	PG_PROTUWRITE
d119 7
a125 7
export	SRMMU_TETYPE
export	SRMMU_TEPTE
export	SRMMU_PROT_MASK
export	PPROT_R_RW
export	PPROT_RX_RX
export	PPROT_RWX_RWX
export	PPROT_WRITE
d129 5
a133 6
struct	fpstate
member	fs_regs
member	fs_fsr
member	fs_qsize
member	fs_queue
export	FSR_QNE
d136 3
a138 3
export	SYS_sigreturn
export	SYS_execve
export	SYS_exit
d141 2
a142 2
export	EFAULT
export	ENAMETOOLONG
d145 8
a152 9
struct	pcb
member	pcb_nsaved
member	pcb_onfault
member	pcb_psr
member	pcb_rw
member	pcb_sp
member	pcb_pc
member	pcb_uw
member	pcb_wim
d159 7
a165 9
struct	zs_softc	Z
member	sc_a
member	sc_b
struct	zs_line
member	zl_wreg
member	zl_tbc
member	zl_tba
member	zl_rbput
member	zl_rbuf
d170 5
a174 6
struct	auio
member	au_amd
member	au_rdata
member	au_rend
member	au_pdata
member	au_pend
d177 16
a192 20
struct	amd7930		AMD_
member	ir
member	bbrb
member	bbtb

export	PROM_BASE

struct	promvec
member	pv_nodeops
member	pv_halt
member	PV_EVAL		pv_fortheval.v0_eval
member	pv_romvec_vers

struct	nodeops
member	no_nextnode
member	no_getprop

struct	om_vector	OLDMON_
member	printf
member	HALT		exitToMon
d195 8
a202 9
struct	fdcio
member	FDC_REG_MSR	fdcio_reg_msr
member	FDC_REG_FIFO	fdcio_reg_fifo
member	FDC_ISTATE	fdcio_istate
member	FDC_STATUS	fdcio_status
member	FDC_NSTAT	fdcio_nstat
member	FDC_DATA	fdcio_data
member	FDC_TC		fdcio_tc
member	FDC_EVCNT	fdcio_intrcnt.ev_count
@


1.4.2.5
log
@Merge in trunk
@
text
@d1 1
a1 1
#	$OpenBSD$
d52 1
a159 1
member	pcb_wcookie
@


1.4.2.6
log
@Sync the SMP branch with 3.3
@
text
@a163 7
# intrhand fields.
struct	intrhand
member	ih_fun
member	ih_arg
member	ih_ipl
member	ih_next

@


1.4.2.7
log
@merge the trunk so we will get the genfs and locking fixes
@
text
@d71 5
@


1.4.2.8
log
@Sync SMP branch to -current
@
text
@d1 1
a1 1
#	$OpenBSD: genassym.cf,v 1.4.2.7 2003/05/16 00:29:40 niklas Exp $
d26 5
a30 1
# 3. Neither the name of the University nor the names of its contributors
@


1.4.2.9
log
@set SONPROC
@
text
@d1 1
a1 1
#	$OpenBSD: genassym.cf,v 1.4.2.8 2003/06/07 11:14:44 ho Exp $
a86 1
export	SONPROC
@


1.3
log
@constants for UVM
@
text
@d1 1
a1 1
#	$OpenBSD: genassym.cf,v 1.2 1997/08/08 08:27:14 downsj Exp $
d116 1
@


1.2
log
@Mostly sync to NetBSD-current 970804.

GENERIC currently compiles and runs; some devices (isp) are not complete and
not yet enabled.
@
text
@d1 1
a1 1
#	$OpenBSD$
d62 4
d104 5
d112 1
@


1.1
log
@Switch to genassym.cf and sync Makefile with other ports.
@
text
@d2 2
d5 1
d68 2
d74 1
d95 3
a97 3
define	VM_PMAP		offsetof(struct vmspace, vm_pmap)
define	VM_PMAP_CTX	offsetof(struct vmspace, vm_pmap.pm_ctx)
define	VM_PMAP_CTXNUM	offsetof(struct vmspace, vm_pmap.pm_ctxnum)
d104 3
d113 1
a113 1
ifdef SUN4M
d150 1
a150 1
define	IE_REG_PTE_PG	PG_V | PG_W | PG_S | PG_NC | PG_OBIO
d156 1
a156 1
# define	ZL_WREG		offsetof(struct zs_line, zl_wreg)
@
