head	1.67;
access;
symbols
	OPENBSD_6_0:1.67.0.2
	OPENBSD_6_0_BASE:1.67
	OPENBSD_5_9:1.65.0.2
	OPENBSD_5_9_BASE:1.65
	OPENBSD_5_8:1.64.0.6
	OPENBSD_5_8_BASE:1.64
	OPENBSD_5_7:1.64.0.2
	OPENBSD_5_7_BASE:1.64
	OPENBSD_5_6:1.62.0.8
	OPENBSD_5_6_BASE:1.62
	OPENBSD_5_5:1.62.0.6
	OPENBSD_5_5_BASE:1.62
	OPENBSD_5_4:1.62.0.2
	OPENBSD_5_4_BASE:1.62
	OPENBSD_5_3:1.61.0.2
	OPENBSD_5_3_BASE:1.61
	OPENBSD_5_2:1.60.0.2
	OPENBSD_5_2_BASE:1.60
	OPENBSD_5_1_BASE:1.59
	OPENBSD_5_1:1.59.0.2
	OPENBSD_5_0:1.58.0.2
	OPENBSD_5_0_BASE:1.58
	OPENBSD_4_9:1.56.0.2
	OPENBSD_4_9_BASE:1.56
	OPENBSD_4_8:1.53.0.2
	OPENBSD_4_8_BASE:1.53
	OPENBSD_4_7:1.50.0.2
	OPENBSD_4_7_BASE:1.50
	OPENBSD_4_6:1.49.0.4
	OPENBSD_4_6_BASE:1.49
	OPENBSD_4_5:1.48.0.2
	OPENBSD_4_5_BASE:1.48
	OPENBSD_4_4:1.47.0.2
	OPENBSD_4_4_BASE:1.47
	OPENBSD_4_3:1.46.0.4
	OPENBSD_4_3_BASE:1.46
	OPENBSD_4_2:1.46.0.2
	OPENBSD_4_2_BASE:1.46
	OPENBSD_4_1:1.43.0.8
	OPENBSD_4_1_BASE:1.43
	OPENBSD_4_0:1.43.0.6
	OPENBSD_4_0_BASE:1.43
	OPENBSD_3_9:1.43.0.4
	OPENBSD_3_9_BASE:1.43
	OPENBSD_3_8:1.43.0.2
	OPENBSD_3_8_BASE:1.43
	OPENBSD_3_7:1.39.0.6
	OPENBSD_3_7_BASE:1.39
	OPENBSD_3_6:1.39.0.4
	OPENBSD_3_6_BASE:1.39
	SMP_SYNC_A:1.39
	SMP_SYNC_B:1.39
	OPENBSD_3_5:1.39.0.2
	OPENBSD_3_5_BASE:1.39
	OPENBSD_3_4:1.38.0.2
	OPENBSD_3_4_BASE:1.38
	UBC_SYNC_A:1.37
	OPENBSD_3_3:1.35.0.2
	OPENBSD_3_3_BASE:1.35
	OPENBSD_3_2:1.34.0.2
	OPENBSD_3_2_BASE:1.34
	OPENBSD_3_1:1.31.0.4
	OPENBSD_3_1_BASE:1.31
	UBC_SYNC_B:1.34
	UBC:1.31.0.2
	UBC_BASE:1.31
	OPENBSD_3_0:1.29.0.2
	OPENBSD_3_0_BASE:1.29
	OPENBSD_2_9_BASE:1.26
	OPENBSD_2_9:1.26.0.4
	OPENBSD_2_8:1.26.0.2
	OPENBSD_2_8_BASE:1.26
	OPENBSD_2_7:1.24.0.2
	OPENBSD_2_7_BASE:1.24
	SMP:1.23.0.4
	SMP_BASE:1.23
	kame_19991208:1.23
	OPENBSD_2_6:1.23.0.2
	OPENBSD_2_6_BASE:1.23
	OPENBSD_2_5:1.21.0.2
	OPENBSD_2_5_BASE:1.21
	OPENBSD_2_4:1.19.0.2
	OPENBSD_2_4_BASE:1.19
	OPENBSD_2_3:1.14.0.4
	OPENBSD_2_3_BASE:1.14
	OPENBSD_2_2:1.14.0.2
	OPENBSD_2_2_BASE:1.14
	OPENBSD_2_1:1.13.0.2
	OPENBSD_2_1_BASE:1.13
	OPENBSD_2_0:1.8.0.2
	OPENBSD_2_0_BASE:1.8
	netbsd_1_1:1.1.1.1;
locks; strict;
comment	@ * @;


1.67
date	2016.04.25.20.09.14;	author tedu;	state Exp;
branches;
next	1.66;
commitid	43yo2G4zZOY9ab4i;

1.66
date	2016.02.26.09.10.05;	author natano;	state Exp;
branches;
next	1.65;
commitid	NHDvdrxPpwDqGtpK;

1.65
date	2015.10.23.15.10.53;	author claudio;	state Exp;
branches;
next	1.64;
commitid	g17gxjQh9N9egLbB;

1.64
date	2014.10.09.04.10.03;	author tedu;	state Exp;
branches;
next	1.63;
commitid	Db8IHIncfKM3SDX9;

1.63
date	2014.10.09.03.59.59;	author tedu;	state Exp;
branches;
next	1.62;
commitid	I0KLtD9aVxAdm6aW;

1.62
date	2013.06.03.15.54.47;	author tedu;	state Exp;
branches;
next	1.61;

1.61
date	2012.08.23.06.12.49;	author deraadt;	state Exp;
branches;
next	1.60;

1.60
date	2012.04.06.15.10.40;	author jsing;	state Exp;
branches;
next	1.59;

1.59
date	2011.10.06.20.49.28;	author deraadt;	state Exp;
branches;
next	1.58;

1.58
date	2011.07.04.22.53.53;	author tedu;	state Exp;
branches;
next	1.57;

1.57
date	2011.04.30.15.24.07;	author miod;	state Exp;
branches;
next	1.56;

1.56
date	2011.01.14.19.04.08;	author jasper;	state Exp;
branches;
next	1.55;

1.55
date	2010.11.19.20.55.48;	author miod;	state Exp;
branches;
next	1.54;

1.54
date	2010.09.23.05.02.14;	author claudio;	state Exp;
branches;
next	1.53;

1.53
date	2010.07.10.19.32.24;	author miod;	state Exp;
branches;
next	1.52;

1.52
date	2010.07.03.03.59.17;	author krw;	state Exp;
branches;
next	1.51;

1.51
date	2010.06.09.15.25.33;	author jsing;	state Exp;
branches;
next	1.50;

1.50
date	2009.08.13.15.04.20;	author dlg;	state Exp;
branches;
next	1.49;

1.49
date	2009.06.03.14.45.53;	author jj;	state Exp;
branches;
next	1.48;

1.48
date	2009.01.25.17.30.49;	author miod;	state Exp;
branches;
next	1.47;

1.47
date	2008.04.08.14.31.54;	author claudio;	state Exp;
branches;
next	1.46;

1.46
date	2007.05.28.22.26.03;	author todd;	state Exp;
branches;
next	1.45;

1.45
date	2007.05.27.01.50.36;	author todd;	state Exp;
branches;
next	1.44;

1.44
date	2007.05.26.19.54.24;	author todd;	state Exp;
branches;
next	1.43;

1.43
date	2005.07.31.06.39.07;	author dlg;	state Exp;
branches;
next	1.42;

1.42
date	2005.07.17.12.21.28;	author miod;	state Exp;
branches;
next	1.41;

1.41
date	2005.04.19.21.30.20;	author miod;	state Exp;
branches;
next	1.40;

1.40
date	2005.03.29.16.26.45;	author miod;	state Exp;
branches;
next	1.39;

1.39
date	2004.02.10.01.31.21;	author millert;	state Exp;
branches;
next	1.38;

1.38
date	2003.06.02.23.27.55;	author millert;	state Exp;
branches;
next	1.37;

1.37
date	2003.05.14.00.20.37;	author tedu;	state Exp;
branches;
next	1.36;

1.36
date	2003.04.13.22.55.52;	author miod;	state Exp;
branches;
next	1.35;

1.35
date	2002.12.05.02.49.55;	author kjc;	state Exp;
branches;
next	1.34;

1.34
date	2002.08.12.10.44.04;	author miod;	state Exp;
branches;
next	1.33;

1.33
date	2002.07.09.15.27.59;	author jason;	state Exp;
branches;
next	1.32;

1.32
date	2002.05.16.21.11.17;	author miod;	state Exp;
branches;
next	1.31;

1.31
date	2001.12.11.23.19.02;	author miod;	state Exp;
branches
	1.31.2.1;
next	1.30;

1.30
date	2001.12.05.23.58.41;	author tdeval;	state Exp;
branches;
next	1.29;

1.29
date	2001.09.28.02.53.13;	author mickey;	state Exp;
branches;
next	1.28;

1.28
date	2001.06.27.06.56.29;	author kjc;	state Exp;
branches;
next	1.27;

1.27
date	2001.06.25.03.20.15;	author kjell;	state Exp;
branches;
next	1.26;

1.26
date	2000.09.26.14.03.55;	author art;	state Exp;
branches;
next	1.25;

1.25
date	2000.06.28.20.22.15;	author mjacob;	state Exp;
branches;
next	1.24;

1.24
date	2000.02.21.08.16.36;	author mjacob;	state Exp;
branches;
next	1.23;

1.23
date	99.07.23.19.11.27;	author jason;	state Exp;
branches
	1.23.4.1;
next	1.22;

1.22
date	99.07.18.17.07.49;	author deraadt;	state Exp;
branches;
next	1.21;

1.21
date	99.02.01.00.30.43;	author jason;	state Exp;
branches;
next	1.20;

1.20
date	98.12.29.09.33.36;	author deraadt;	state Exp;
branches;
next	1.19;

1.19
date	98.09.25.09.20.54;	author todd;	state Exp;
branches;
next	1.18;

1.18
date	98.08.24.05.30.02;	author millert;	state Exp;
branches;
next	1.17;

1.17
date	98.07.07.06.56.11;	author deraadt;	state Exp;
branches;
next	1.16;

1.16
date	98.07.07.03.02.47;	author deraadt;	state Exp;
branches;
next	1.15;

1.15
date	98.05.20.19.29.21;	author deraadt;	state Exp;
branches;
next	1.14;

1.14
date	97.08.08.08.27.08;	author downsj;	state Exp;
branches;
next	1.13;

1.13
date	97.05.14.00.12.14;	author deraadt;	state Exp;
branches;
next	1.12;

1.12
date	97.05.06.19.07.38;	author kstailey;	state Exp;
branches;
next	1.11;

1.11
date	96.11.11.23.30.26;	author kstailey;	state Exp;
branches;
next	1.10;

1.10
date	96.11.06.01.35.44;	author deraadt;	state Exp;
branches;
next	1.9;

1.9
date	96.10.19.13.26.14;	author mickey;	state Exp;
branches;
next	1.8;

1.8
date	96.08.29.09.26.27;	author deraadt;	state Exp;
branches;
next	1.7;

1.7
date	96.08.11.05.35.06;	author deraadt;	state Exp;
branches;
next	1.6;

1.6
date	96.07.15.14.57.07;	author mickey;	state Exp;
branches;
next	1.5;

1.5
date	96.05.04.18.50.55;	author mickey;	state Exp;
branches;
next	1.4;

1.4
date	96.02.21.12.53.53;	author mickey;	state Exp;
branches;
next	1.3;

1.3
date	96.01.07.07.41.11;	author dm;	state Exp;
branches;
next	1.2;

1.2
date	95.10.19.13.26.31;	author deraadt;	state Exp;
branches;
next	1.1;

1.1
date	95.10.18.08.51.46;	author deraadt;	state Exp;
branches
	1.1.1.1;
next	;

1.1.1.1
date	95.10.18.08.51.46;	author deraadt;	state Exp;
branches;
next	;

1.23.4.1
date	2000.02.21.22.29.02;	author niklas;	state Exp;
branches;
next	1.23.4.2;

1.23.4.2
date	2001.05.14.21.37.15;	author niklas;	state Exp;
branches;
next	1.23.4.3;

1.23.4.3
date	2001.07.04.10.23.39;	author niklas;	state Exp;
branches;
next	1.23.4.4;

1.23.4.4
date	2001.10.31.03.07.57;	author nate;	state Exp;
branches;
next	1.23.4.5;

1.23.4.5
date	2002.03.06.02.04.46;	author niklas;	state Exp;
branches;
next	1.23.4.6;

1.23.4.6
date	2003.03.27.23.49.26;	author niklas;	state Exp;
branches;
next	1.23.4.7;

1.23.4.7
date	2003.05.13.19.41.08;	author ho;	state Exp;
branches;
next	1.23.4.8;

1.23.4.8
date	2003.05.16.00.29.40;	author niklas;	state Exp;
branches;
next	1.23.4.9;

1.23.4.9
date	2003.06.07.11.14.44;	author ho;	state Exp;
branches;
next	1.23.4.10;

1.23.4.10
date	2004.06.05.23.10.58;	author niklas;	state Exp;
branches;
next	;

1.31.2.1
date	2002.06.11.03.38.16;	author art;	state Exp;
branches;
next	1.31.2.2;

1.31.2.2
date	2002.10.29.00.28.10;	author art;	state Exp;
branches;
next	1.31.2.3;

1.31.2.3
date	2003.05.19.21.46.32;	author tedu;	state Exp;
branches;
next	;


desc
@@


1.67
log
@remove systrace
@
text
@/*	$OpenBSD: conf.c,v 1.66 2016/02/26 09:10:05 natano Exp $	*/
/*	$NetBSD: conf.c,v 1.40 1996/04/11 19:20:03 thorpej Exp $ */

/*
 * Copyright (c) 1992, 1993
 *	The Regents of the University of California.  All rights reserved.
 *
 * This software was developed by the Computer Systems Engineering group
 * at Lawrence Berkeley Laboratory under DARPA contract BG 91-66 and
 * contributed to Berkeley.
 *
 * All advertising materials mentioning features or use of this software
 * must display the following acknowledgement:
 *	This product includes software developed by the University of
 *	California, Lawrence Berkeley Laboratory.
 *
 * Redistribution and use in source and binary forms, with or without
 * modification, are permitted provided that the following conditions
 * are met:
 * 1. Redistributions of source code must retain the above copyright
 *    notice, this list of conditions and the following disclaimer.
 * 2. Redistributions in binary form must reproduce the above copyright
 *    notice, this list of conditions and the following disclaimer in the
 *    documentation and/or other materials provided with the distribution.
 * 3. Neither the name of the University nor the names of its contributors
 *    may be used to endorse or promote products derived from this software
 *    without specific prior written permission.
 *
 * THIS SOFTWARE IS PROVIDED BY THE REGENTS AND CONTRIBUTORS ``AS IS'' AND
 * ANY EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT LIMITED TO, THE
 * IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE
 * ARE DISCLAIMED.  IN NO EVENT SHALL THE REGENTS OR CONTRIBUTORS BE LIABLE
 * FOR ANY DIRECT, INDIRECT, INCIDENTAL, SPECIAL, EXEMPLARY, OR CONSEQUENTIAL
 * DAMAGES (INCLUDING, BUT NOT LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS
 * OR SERVICES; LOSS OF USE, DATA, OR PROFITS; OR BUSINESS INTERRUPTION)
 * HOWEVER CAUSED AND ON ANY THEORY OF LIABILITY, WHETHER IN CONTRACT, STRICT
 * LIABILITY, OR TORT (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY
 * OUT OF THE USE OF THIS SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF
 * SUCH DAMAGE.
 *
 *	@@(#)conf.c	8.3 (Berkeley) 11/14/93
 */

#include <sys/param.h>
#include <sys/systm.h>
#include <sys/buf.h>
#include <sys/ioctl.h>
#include <sys/vnode.h>
#include <sys/tty.h>
#include <sys/conf.h>

#include <machine/conf.h>

#include "bio.h"
#include "pty.h"
#include "bpfilter.h"
#include "tun.h"
#include "audio.h"
#include "vnd.h"
#include "ch.h"
#include "uk.h"
#include "sd.h"
#include "st.h"
#include "cd.h"
#include "rd.h"
#include "presto.h"

#include "zstty.h"

#include "fdc.h"		/* has NFDC and NFD; see files.sparc */
#include "xd.h"
#include "xy.h"
#include "bpp.h"
#include "magma.h"		/* has NMTTY and NMBPP */
#include "spif.h"		/* has NSTTY and NSBPP */
#include "scf.h"
#include "flash.h"
#include "fga.h"
#include "daadio.h"
#include "com.h"

#include "wsdisplay.h"
#include "wskbd.h"
#include "wsmouse.h"
#include "wsmux.h"

#include "ksyms.h"

struct bdevsw	bdevsw[] =
{
	bdev_notdef(),			/* 0 */
	bdev_notdef(),			/* 1 */
	bdev_notdef(),			/* 2 */
	bdev_disk_init(NXY,xy),		/* 3: SMD disk */
	bdev_swap_init(1,sw),		/* 4 swap pseudo-device */
	bdev_notdef(),			/* 5 */
	bdev_notdef(),			/* 6 */
	bdev_disk_init(NSD,sd),		/* 7: SCSI disk */
	bdev_disk_init(NVND,vnd),	/* 8: vnode disk driver */
	bdev_notdef(),			/* 9: was: concatenated disk driver */
	bdev_disk_init(NXD,xd),		/* 10: SMD disk */
	bdev_tape_init(NST,st),		/* 11: SCSI tape */
	bdev_notdef(),			/* 12 */
	bdev_notdef(),			/* 13 */
	bdev_notdef(),			/* 14 */
	bdev_notdef(),			/* 15 */
	bdev_disk_init(NFD,fd),		/* 16: floppy disk */
	bdev_disk_init(NRD,rd),		/* 17: ram disk driver */
	bdev_disk_init(NCD,cd),		/* 18: SCSI CD-ROM */
	bdev_notdef(),			/* 19 */
	bdev_notdef(),			/* 20 */
	bdev_notdef(),			/* 21 */
	bdev_notdef(),			/* 22 */
	bdev_notdef(),			/* 23 */
	bdev_notdef(),			/* 24 */
	bdev_notdef(),			/* 25 was: RAIDframe disk driver */
	bdev_disk_init(NPRESTO,presto),	/* 26: Prestoserve NVRAM */
};
int	nblkdev = nitems(bdevsw);

#include "pf.h"
#include "tctrl.h"
#include "vscsi.h"
#include "pppx.h"
#include "hotplug.h"
#include "fuse.h"

struct cdevsw	cdevsw[] =
{
	cdev_cn_init(1,cn),		/* 0: virtual console */
	cdev_notdef(),			/* 1 */
	cdev_ctty_init(1,ctty),		/* 2: controlling terminal */
	cdev_mm_init(1,mm),		/* 3: /dev/{null,mem,kmem,...} */
	cdev_notdef(),			/* 4 */
	cdev_notdef(),			/* 5 */
	cdev_notdef(),			/* 6 */
	cdev_notdef(),			/* 7 was /dev/drum */
	cdev_notdef(),			/* 8 */
	cdev_disk_init(NXY,xy),		/* 9: SMD disk */
	cdev_notdef(),			/* 10 */
	cdev_notdef(),			/* 11 */
	cdev_tty_init(NZSTTY,zs),	/* 12: zs serial */
	cdev_notdef(),			/* 13: was /dev/mouse */
	cdev_notdef(),			/* 14 */
	cdev_notdef(),			/* 15: sun /dev/winNNN */
	cdev_log_init(1,log),		/* 16: /dev/klog */
	cdev_disk_init(NSD,sd),		/* 17: SCSI disk */
	cdev_tape_init(NST,st),		/* 18: SCSI tape */
	cdev_ch_init(NCH,ch),		/* 19: SCSI autochanger */
	cdev_tty_init(NPTY,pts),	/* 20: pseudo-tty slave */
	cdev_ptc_init(NPTY,ptc),	/* 21: pseudo-tty master */
	cdev_notdef(),			/* 22: was /dev/fb */
	cdev_notdef(),			/* 23: was: concatenated disk driver */
	cdev_fd_init(1,filedesc),	/* 24: file descriptor pseudo-device */
	cdev_disk_init(NPRESTO,presto),	/* 25: Prestoserve NVRAM */
	cdev_notdef(),			/* 26 */
	cdev_notdef(),			/* 27: was /dev/bwtwo */
	cdev_notdef(),			/* 28 */
	cdev_notdef(),			/* 29: was /dev/kbd */
	cdev_apm_init(NTCTRL,apm),	/* 30: tctrl APM interface */
	cdev_notdef(),			/* 31: was /dev/cgtwo */
	cdev_notdef(),			/* 32: should be /dev/gpone */
	cdev_notdef(),			/* 33 */
	cdev_notdef(),			/* 34 */
	cdev_notdef(),			/* 35 */
	cdev_tty_init(NCOM,com),	/* 36: SPARCbook modem */
	cdev_notdef(),			/* 37 */
	cdev_notdef(),			/* 38 */
	cdev_notdef(),			/* 39: was /dev/cgfour */
	cdev_notdef(),			/* 40 */
	cdev_notdef(),			/* 41 */
	cdev_disk_init(NXD,xd),		/* 42: SMD disk */
	cdev_notdef(),			/* 43 */
	cdev_notdef(),			/* 44 */
	cdev_notdef(),			/* 45 */
	cdev_notdef(),			/* 46 */
	cdev_notdef(),			/* 47 */
	cdev_notdef(),			/* 48 */
	cdev_notdef(),			/* 49 */
	cdev_notdef(),			/* 50 */
	cdev_notdef(),			/* 51 */
	cdev_notdef(),			/* 52 */
	cdev_notdef(),			/* 53 */
	cdev_disk_init(NFD,fd),		/* 54: floppy disk */
	cdev_notdef(),			/* 55: was /dev/cgthree */
	cdev_notdef(),			/* 56 */
	cdev_notdef(),			/* 57 */
	cdev_disk_init(NCD,cd),		/* 58: SCSI CD-ROM */
	cdev_pf_init(NPF,pf),		/* 59: packet filter */
	cdev_notdef(),			/* 60 */
	cdev_notdef(),			/* 61 */
	cdev_notdef(),			/* 62 */
	cdev_notdef(),			/* 63 */
	cdev_notdef(),			/* 64: was /dev/cgeight */
	cdev_notdef(),			/* 65 */
	cdev_notdef(),			/* 66 */
	cdev_notdef(),			/* 67: was /dev/cgsix */
	cdev_notdef(),			/* 68 */
	cdev_gen_init(NAUDIO,audio),	/* 69: /dev/audio */
#if defined(SUN4) || defined(SUN4C) || defined(SUN4D) || defined(SUN4E) || defined(SUN4M)
	cdev_openprom_init(1,openprom),	/* 70: /dev/openprom */
#else
	cdev_notdef(),			/* 70 */
#endif
	cdev_notdef(),			/* 71 */
	cdev_notdef(),			/* 72 */
	cdev_notdef(),			/* 73 */
	cdev_notdef(),			/* 74 */
	cdev_notdef(),			/* 75 */
	cdev_notdef(),			/* 76 */
	cdev_notdef(),			/* 77 */
	cdev_wsdisplay_init(NWSDISPLAY,	/* 78: frame buffers, etc. */
	    wsdisplay),
	cdev_mouse_init(NWSKBD, wskbd),	/* 79: keyboards */
	cdev_mouse_init(NWSMOUSE, wsmouse), /* 80: mice */
	cdev_mouse_init(NWSMUX, wsmux),	/* 81: ws multiplexer */
	cdev_fuse_init(NFUSE, fuse),	/* 82: fuse */
	cdev_notdef(),			/* 83 */
	cdev_notdef(),			/* 84 */
	cdev_notdef(),			/* 85 */
	cdev_notdef(),			/* 86 */
	cdev_notdef(),			/* 87 */
	cdev_notdef(),			/* 88 */
	cdev_notdef(),			/* 89 */
	cdev_notdef(),			/* 90 */
	cdev_notdef(),			/* 91 */
	cdev_notdef(),			/* 92 */
	cdev_notdef(),			/* 93 */
	cdev_notdef(),			/* 94 */
	cdev_notdef(),			/* 95 */
	cdev_notdef(),			/* 96 */
	cdev_daadio_init(NDAADIO,daadio), /* 97: daadio */
	cdev_fga_init(NFGA,fga),	/* 98: fga */
	cdev_notdef(),			/* 99: was /dev/cgfourteen */
	cdev_tty_init(NMTTY,mtty),	/* 100: magma */
	cdev_gen_init(NMBPP,mbpp),	/* 101: magma */
	cdev_tty_init(NSTTY,stty),	/* 102: spif */
	cdev_gen_init(NSBPP,sbpp),	/* 103: spif */
	cdev_bpp_init(NBPP,bpp),	/* 104: bpp */
	cdev_bpf_init(NBPFILTER,bpf),	/* 105: packet filter */
	cdev_disk_init(NRD,rd),		/* 106: ram disk driver */
	cdev_scf_init(NSCF,scf),	/* 107: sysconfig regs */
	cdev_flash_init(NFLASH,flash),	/* 108: flash memory */
	cdev_notdef(),			/* 109: was /dev/tcx */
	cdev_disk_init(NVND,vnd),	/* 110: vnode disk driver */
	cdev_tun_init(NTUN,tun),	/* 111: network tunnel */
	cdev_notdef(),			/* 112: was LKM */
	cdev_notdef(),			/* 113 */
	cdev_notdef(),			/* 114 */
	cdev_notdef(),			/* 115 */
	cdev_notdef(),			/* 116 */
	cdev_notdef(),			/* 117 */
	cdev_notdef(),			/* 118 */
	cdev_random_init(1,random),	/* 119: random generator */
	cdev_uk_init(NUK,uk),		/* 120: unknown SCSI */
	cdev_notdef(),			/* 121 */
	cdev_ksyms_init(NKSYMS,ksyms),	/* 122: Kernel symbols device */
	cdev_notdef(),			/* 123 was: RAIDframe disk driver */
	cdev_bio_init(NBIO,bio),	/* 124: ioctl tunnel */
	cdev_ptm_init(NPTY,ptm),	/* 125: pseudo-tty ptm device */
	cdev_notdef(),			/* 126 */
	cdev_notdef(),			/* 127 */
	cdev_vscsi_init(NVSCSI,vscsi),	/* 128: vscsi */
	cdev_disk_init(1,diskmap),	/* 129: disk mapper */
	cdev_pppx_init(NPPPX,pppx),	/* 130: pppx */
	cdev_hotplug_init(NHOTPLUG,hotplug),	/* 131: devices hot plugging */
	cdev_tun_init(NTUN,tap),	/* 132: Ethernet network tunnel */
};
int	nchrdev = nitems(cdevsw);

int	mem_no = 3; 	/* major device number of memory special file */

/*
 * Swapdev is a fake device implemented
 * in sw.c used only internally to get to swstrategy.
 * It cannot be provided to the users, because the
 * swstrategy routine munches the b_dev and b_blkno entries
 * before calling the appropriate driver.  This would horribly
 * confuse, e.g. the hashing routines. Instead, /dev/drum is
 * provided as a character (raw) device.
 */
dev_t	swapdev = makedev(4, 0);

/*
 * Routine that identifies /dev/mem and /dev/kmem.
 *
 * A minimal stub routine can always return 0.
 */
int
iskmemdev(dev)
	dev_t dev;
{

	return (major(dev) == mem_no && minor(dev) < 2);
}

int
iszerodev(dev)
	dev_t dev;
{
	return (major(dev) == mem_no && minor(dev) == 12);
}

dev_t
getnulldev()
{
	return makedev(mem_no, 2);
}

int chrtoblktbl[] = {
	/*VCHR*/	/*VBLK*/
	/*  0 */	NODEV,
	/*  1 */	NODEV,
	/*  2 */	NODEV,
	/*  3 */	NODEV,
	/*  4 */	NODEV,
	/*  5 */	NODEV,
	/*  6 */	NODEV,
	/*  7 */	NODEV,
	/*  8 */	NODEV,
	/*  9 */	3,
	/* 10 */	NODEV,
	/* 11 */	NODEV,
	/* 12 */	NODEV,
	/* 13 */	NODEV,
	/* 14 */	NODEV,
	/* 15 */	NODEV,
	/* 16 */	NODEV,
	/* 17 */	7,
	/* 18 */	11,
	/* 19 */	NODEV,
	/* 20 */	NODEV,
	/* 21 */	NODEV,
	/* 22 */	NODEV,
	/* 23 */	9,
	/* 24 */	NODEV,
	/* 25 */	26,
	/* 26 */	NODEV,
	/* 27 */	NODEV,
	/* 28 */	NODEV,
	/* 29 */	NODEV,
	/* 30 */	NODEV,
	/* 31 */	NODEV,
	/* 32 */	NODEV,
	/* 33 */	NODEV,
	/* 34 */	NODEV,
	/* 35 */	NODEV,
	/* 36 */	NODEV,
	/* 37 */	NODEV,
	/* 38 */	NODEV,
	/* 39 */	NODEV,
	/* 40 */	NODEV,
	/* 41 */	NODEV,
	/* 42 */	10,
	/* 43 */	NODEV,
	/* 44 */	NODEV,
	/* 45 */	NODEV,
	/* 46 */	NODEV,
	/* 47 */	NODEV,
	/* 48 */	NODEV,
	/* 49 */	NODEV,
	/* 50 */	NODEV,
	/* 51 */	NODEV,
	/* 52 */	NODEV,
	/* 53 */	NODEV,
	/* 54 */	16,
	/* 55 */	NODEV,
	/* 56 */	NODEV,
	/* 57 */	NODEV,
	/* 58 */	18,
	/* 59 */	NODEV,
	/* 60 */	NODEV,
	/* 61 */	NODEV,
	/* 62 */	NODEV,
	/* 63 */	NODEV,
	/* 64 */	NODEV,
	/* 65 */	NODEV,
	/* 66 */	NODEV,
	/* 67 */	NODEV,
	/* 68 */	NODEV,
	/* 69 */	NODEV,
	/* 70 */	NODEV,
	/* 71 */	NODEV,
	/* 72 */	NODEV,
	/* 73 */	NODEV,
	/* 74 */	NODEV,
	/* 75 */	NODEV,
	/* 76 */	NODEV,
	/* 77 */	NODEV,
	/* 78 */	NODEV,
	/* 79 */	NODEV,
	/* 80 */	NODEV,
	/* 81 */	NODEV,
	/* 82 */	NODEV,
	/* 83 */	NODEV,
	/* 84 */	NODEV,
	/* 85 */	NODEV,
	/* 86 */	NODEV,
	/* 87 */	NODEV,
	/* 88 */	NODEV,
	/* 89 */	NODEV,
	/* 90 */	NODEV,
	/* 91 */	NODEV,
	/* 92 */	NODEV,
	/* 93 */	NODEV,
	/* 94 */	NODEV,
	/* 95 */	NODEV,
	/* 96 */	NODEV,
	/* 97 */	NODEV,
	/* 98 */	NODEV,
	/* 99 */	NODEV,
	/*100 */	NODEV,
	/*101 */	NODEV,
	/*102 */	NODEV,
	/*103 */	NODEV,
	/*104 */	NODEV,
	/*105 */	NODEV,
	/*106 */	17,
	/*107 */	NODEV,
	/*108 */	NODEV,
	/*109 */	NODEV,
	/*110 */	8,
};
int nchrtoblktbl = nitems(chrtoblktbl);
@


1.66
log
@Remove stale RAIDframe entries from chrtoblktbl.

While there truncate the tables to the minimum required size; chrtoblk()
and blktochr() are designed to handle a table shorter than cdevsw.

"Looks good to me" deraadt@@
@
text
@d1 1
a1 1
/*	$OpenBSD: conf.c,v 1.65 2015/10/23 15:10:53 claudio Exp $	*/
a121 1
#include "systrace.h"
d180 1
a180 1
	cdev_systrace_init(NSYSTRACE,systrace),	/* 50 system call tracing */
@


1.65
log
@Allocate a new major for tap(4) also note that pseudo-device tun is for tap
as well. OK dlg@@ mpi@@
@
text
@d1 1
a1 1
/*	$OpenBSD: conf.c,v 1.64 2014/10/09 04:10:03 tedu Exp $	*/
a423 13
	/*111 */	NODEV,
	/*112 */	NODEV,
	/*113 */	NODEV,
	/*114 */	NODEV,
	/*115 */	NODEV,
	/*116 */	NODEV,
	/*117 */	NODEV,
	/*118 */	NODEV,
	/*119 */	NODEV,
	/*120 */	NODEV,
	/*121 */	NODEV,
	/*122 */	NODEV,
	/*123 */	25,
@


1.64
log
@mechanical translation of dev_lkm_dummy() to dev_notdef()
@
text
@d1 1
a1 1
/*	$OpenBSD: conf.c,v 1.63 2014/10/09 03:59:59 tedu Exp $	*/
d268 1
@


1.63
log
@remove LKM devices
@
text
@d1 1
a1 1
/*	$OpenBSD: conf.c,v 1.62 2013/06/03 15:54:47 tedu Exp $	*/
d110 6
a115 6
	bdev_lkm_dummy(),		/* 19 */
	bdev_lkm_dummy(),		/* 20 */
	bdev_lkm_dummy(),		/* 21 */
	bdev_lkm_dummy(),		/* 22 */
	bdev_lkm_dummy(),		/* 23 */
	bdev_lkm_dummy(),		/* 24 */
d249 6
a254 6
	cdev_lkm_dummy(),		/* 113 */
	cdev_lkm_dummy(),		/* 114 */
	cdev_lkm_dummy(),		/* 115 */
	cdev_lkm_dummy(),		/* 116 */
	cdev_lkm_dummy(),		/* 117 */
	cdev_lkm_dummy(),		/* 118 */
@


1.62
log
@changes for isc fuse support. not enabled. ok beck deraadt.
from Sylvestre Gallon ccna.syl gmail.com
@
text
@d1 1
a1 1
/*	$OpenBSD: conf.c,v 1.61 2012/08/23 06:12:49 deraadt Exp $	*/
d248 1
a248 1
	cdev_lkm_init(NLKM,lkm),	/* 112: loadable module driver */
a310 1
	/* XXXX This needs to be dynamic for LKMs. */
@


1.61
log
@kill nnpfs dead
@
text
@d1 1
a1 1
/*	$OpenBSD: conf.c,v 1.60 2012/04/06 15:10:40 jsing Exp $	*/
d127 1
d218 1
a218 1
	cdev_notdef(),			/* 82 */
@


1.60
log
@tedu the raidframe.

ok deraadt@@
@
text
@d1 1
a1 1
/*	$OpenBSD: conf.c,v 1.58 2011/07/04 22:53:53 tedu Exp $	*/
a86 4
#ifdef NNPFS
#include <nnpfs/nnnpfs.h>
cdev_decl(nnpfs_dev);
#endif
a180 3
#ifdef NNPFS
	cdev_nnpfs_init(NNNPFS,nnpfs_dev),	/* 51: nnpfs communication device */
#else
a181 1
#endif
@


1.59
log
@ccd goes to the attic
discussed with jsing and millert
@
text
@a59 1
#include "raid.h"
d120 1
a120 1
	bdev_disk_init(NRAID,raid),	/* 25: RAIDframe disk driver */
d266 1
a266 1
	cdev_disk_init(NRAID,raid),     /* 123: RAIDframe disk driver */
@


1.58
log
@remove compat_svr4 support.  ok deraadt
@
text
@d1 1
a1 1
/*	$OpenBSD: conf.c,v 1.57 2011/04/30 15:24:07 miod Exp $	*/
a59 1
#include "ccd.h"
d105 1
a105 1
	bdev_disk_init(NCCD,ccd),	/* 9: concatenated disk driver */
d158 1
a158 1
	cdev_disk_init(NCCD,ccd),	/* 23: concatenated disk driver */
@


1.57
log
@Plug holes in cdevsw[] to make vscsi, diskmap and pppx entries match the
numbers in comments and the MAKEDEV majors.
@
text
@d1 1
a1 1
/*	$OpenBSD: conf.c,v 1.56 2011/01/14 19:04:08 jasper Exp $	*/
d179 1
a179 1
	cdev_svr4_net_init(NSVR4_NET,svr4_net),	/* 43: svr4 net pseudo-device */
@


1.56
log
@- use nitems()

"doesn't hurt" deraadt@@
@
text
@d1 1
a1 1
/*	$OpenBSD: conf.c,v 1.55 2010/11/19 20:55:48 miod Exp $	*/
d271 2
@


1.55
log
@Sync MAKEDEV against conf.c, and both against GENERIC.
@
text
@d1 1
a1 1
/*	$OpenBSD: conf.c,v 1.54 2010/09/23 05:02:14 claudio Exp $	*/
d125 1
a125 1
int	nblkdev = sizeof(bdevsw) / sizeof(bdevsw[0]);
d276 1
a276 1
int	nchrdev = sizeof(cdevsw) / sizeof(cdevsw[0]);
d445 1
a445 1
int nchrtoblktbl = sizeof(chrtoblktbl) / sizeof(chrtoblktbl[0]);
@


1.54
log
@Add pppx(4) to the cdevs of the remaining archs.
OK dlg@@
@
text
@d1 1
a1 1
/*	$OpenBSD: conf.c,v 1.53 2010/07/10 19:32:24 miod Exp $	*/
d132 1
d274 1
@


1.53
log
@sun4e (i.e. SPARCengine 1e) support. This platform is a mix between sun4 and
sun4c, as it has a sun4c OpenPROM but a sun4 8KB pagesize. VME devices are
not supported yet.
ok deraadt@@
@
text
@d1 1
a1 1
/*	$OpenBSD: conf.c,v 1.52 2010/07/03 03:59:17 krw Exp $	*/
d131 1
d272 1
@


1.52
log
@No more ss(4) or usscanner(4). Unused, unloved and unmaintained.
General huzzahs.

"go for it" deraadt@@
@
text
@d1 1
a1 1
/*	$OpenBSD: conf.c,v 1.51 2010/06/09 15:25:33 jsing Exp $	*/
d208 1
a208 1
#if defined(SUN4) || defined(SUN4C) || defined(SUN4M)
@


1.51
log
@Wire up device nodes for disk mapper.

ok deraadt@@
@
text
@d1 1
a1 1
/*	$OpenBSD: conf.c,v 1.49 2009/06/03 14:45:53 jj Exp $	*/
a62 1
#include "ss.h"
d264 1
a264 1
	cdev_ss_init(NSS,ss),           /* 121: SCSI scanner */
@


1.50
log
@wire vscsi up to a cdev

for claudio@@ ok deraadt@@
@
text
@d271 1
@


1.49
log
@Arla client rename from xfs to nnpfs for later upgrades. Tested on various arches. ok todd@@ beck@@
@
text
@d1 1
a1 1
/*	$OpenBSD: conf.c,v 1.48 2009/01/25 17:30:49 miod Exp $	*/
d131 1
d270 1
@


1.48
log
@Remove /dev/drum and related code.
@
text
@d1 1
a1 1
/*	$OpenBSD: conf.c,v 1.47 2008/04/08 14:31:54 claudio Exp $	*/
d90 3
a92 3
#ifdef XFS
#include <xfs/nxfs.h>
cdev_decl(xfs_dev);
d185 2
a186 2
#ifdef XFS
	cdev_xfs_init(NXFS,xfs_dev),	/* 51: xfs communication device */
@


1.47
log
@Split the cdev makro for bpftun into two seperate definitions. tun(4) and
bpf(4) are different enough so that the split makes sense -- this is necessary
to make bpf(4) cloneable.
requested deraadt@@, OK thib@@
@
text
@d1 1
a1 1
/*	$OpenBSD: conf.c,v 1.46 2007/05/28 22:26:03 todd Exp $	*/
d141 1
a141 1
	cdev_swap_init(1,sw),		/* 7: /dev/drum (swap pseudo-device) */
@


1.46
log
@bio for all archs, ok krw@@ kettenis@@ sounds good marco@@ go for it deraadt@@
@
text
@d1 1
a1 1
/*	$OpenBSD: conf.c,v 1.45 2007/05/27 01:50:36 todd Exp $	*/
d248 1
a248 1
	cdev_bpftun_init(NBPFILTER,bpf),/* 105: packet filter */
d254 1
a254 1
	cdev_bpftun_init(NTUN,tun),	/* 111: network tunnel */
@


1.45
log
@back out bio, breaks dlg's sparc64 v215
prompted by/ok dlg@@ deraadt@@
@
text
@d1 1
a1 1
/*	$OpenBSD: conf.c,v 1.44 2007/05/26 19:54:24 todd Exp $	*/
d54 1
d267 1
a267 1
	cdev_notdef(),			/* 124 */
@


1.44
log
@prodded by marco, enable bio everywhere
grudgingly ok deraadt@@
@
text
@d1 1
a1 1
/*	$OpenBSD: conf.c,v 1.43 2005/07/31 06:39:07 dlg Exp $	*/
a53 1
#include "bio.h"
d137 1
a137 1
	cdev_bio_init(NBIO,bio),	/* 4: ioctl tunnel */
@


1.43
log
@remove the config glue between the /dev entry for ses and its driver

sure deraadt@@
@
text
@d1 1
a1 1
/*	$OpenBSD: conf.c,v 1.42 2005/07/17 12:21:28 miod Exp $	*/
d54 1
d138 1
a138 1
	cdev_notdef(),			/* 4 */
@


1.42
log
@Attach com(4) to the built-in modem found on Tadpole SPARCbooks.
@
text
@d1 1
a1 1
/*	$OpenBSD: conf.c,v 1.41 2005/04/19 21:30:20 miod Exp $	*/
a61 1
#include "ses.h"
d266 1
a266 1
	cdev_ses_init(NSES,ses),	/* 124: SCSI SES or SAF-TE device */
@


1.41
log
@As a late birthday present, a preliminary port to the Solbourne IDT systems
(S3000, S4000 and S4000DX).

Currently limited to diskless and serial console, and userland has issues.
Things will get better in the near future.
@
text
@d1 1
a1 1
/*	$OpenBSD: conf.c,v 1.40 2005/03/29 16:26:45 miod Exp $	*/
d83 1
d170 1
a170 1
	cdev_notdef(),			/* 36 */
@


1.40
log
@Add an apm interface to the tctrl(4) device found on SPARCbooks; currently
limited to power change events and battery status retrieval.

ok deraadt@@ mickey@@
@
text
@d1 1
a1 1
/*	$OpenBSD: conf.c,v 1.39 2004/02/10 01:31:21 millert Exp $	*/
d207 1
d209 3
@


1.39
log
@Add the ptm device to pty(4).  By opening /dev/ptm and using the PTMGET
ioctl(2), an unprivileged process may allocate a pty and have its owner
and mode set appropriately.  This means that programs such as xterm and
screen no longer need to be setuid.  Programs using the openpty()
function require zero changes and will "just work".

Designed by beck@@ and deraadt@@; changes by beck@@ with cleanup (and
a rewrite of the vnode bits) by art@@ and tweaks/bugfixes by me.
Tested by many.
@
text
@d1 1
a1 1
/*	$OpenBSD: conf.c,v 1.38 2003/06/02 23:27:55 millert Exp $	*/
a127 1

d129 1
d163 1
a163 1
	cdev_notdef(),			/* 30 */
@


1.38
log
@Remove the advertising clause in the UCB license which Berkeley
rescinded 22 July 1999.  Proofed by myself and Theo.
@
text
@d1 1
a1 1
/*	$OpenBSD: conf.c,v 1.37 2003/05/14 00:20:37 tedu Exp $	*/
d263 1
@


1.37
log
@add {b,c}devsw_lookup convenience functions.
move chrtoblk and blktochr into MI code.
tested on several archs and ok deraadt@@
@
text
@d1 1
a1 1
/*	$OpenBSD: conf.c,v 1.36 2003/04/13 22:55:52 miod Exp $	*/
d25 1
a25 5
 * 3. All advertising materials mentioning features or use of this software
 *    must display the following acknowledgement:
 *	This product includes software developed by the University of
 *	California, Berkeley and its contributors.
 * 4. Neither the name of the University nor the names of its contributors
@


1.36
log
@Add a simple driver for the SBus ``Prestoserve'' NVRAM cards.

The Legato Prestoserve NFS accelerator used to be very popular, back when
NFSv3 did not exist, and disks and network speeds were not as good as they
are now...

This driver does not attempt to play any game with filesystems, but will only
provide access to the cards NVRAM, as a block device.

If you have bright ideas on ``what to do with a few MB of battery-backed
memory'', I am interested in realistic suggestions!
@
text
@d1 1
a1 1
/*	$OpenBSD: conf.c,v 1.35 2002/12/05 02:49:55 kjc Exp $	*/
d309 1
a309 1
static int chrtoblktbl[] = {
d437 1
a437 36

/*
 * Routine to convert from character to block device number.
 */
int
chrtoblk(dev)
	dev_t dev;
{
	int blkmaj;

	if (major(dev) >= nchrdev ||
	    major(dev) > sizeof(chrtoblktbl)/sizeof(chrtoblktbl[0]))
		return (NODEV);
	blkmaj = chrtoblktbl[major(dev)];
	if (blkmaj == NODEV)
		return (NODEV);
	return (makedev(blkmaj, minor(dev)));
}

/*
 * Convert a character device number to a block device number.
 */
dev_t
blktochr(dev)
	dev_t dev;
{
	int blkmaj = major(dev);
	int i;

	if (blkmaj >= nblkdev)
		return (NODEV);
	for (i = 0; i < sizeof(chrtoblktbl)/sizeof(chrtoblktbl[0]); i++)
		if (blkmaj == chrtoblktbl[i])
			return (makedev(i, minor(dev)));
	return (NODEV);
}
@


1.35
log
@remove altq entries.
altq is merged into pf and handled through pf.
@
text
@d1 1
a1 1
/*	$OpenBSD: conf.c,v 1.34 2002/08/12 10:44:04 miod Exp $	*/
d73 1
d127 1
d162 1
a162 1
	cdev_notdef(),			/* 25 */
d337 1
a337 1
	/* 25 */	NODEV,
@


1.34
log
@Convert sparc console code from rcons and pseudo-devices to rasops and wscons.
For most framebuffers it is faster.

Other changes include:
o 24 bit support in tcx(4) for the S24 framebuffer
o accelerated cgsix(4) text console
o new cgtwelve(4) driver for the GS framebuffer
o improved serial driver code
o better keyboard support

The following framebuffers have not been tested but should work: cgfour,
cgeight and cgfourteen

These changes will require XF4 changes, to use Xwsfb instead of Xsun*, to be
commited later today.

Most of the work by me during the LSM and the week after, with code borrowed
from jason@@, NetBSD (new serial code), and feedback from mickey@@. Work on
pnozz(4) done by millert@@
@
text
@d1 1
a1 1
/*	$OpenBSD: conf.c,v 1.33 2002/07/09 15:27:59 jason Exp $	*/
a130 2
#include <altq/altqconf.h>

a264 1
	cdev_altq_init(NALTQ,altq),	/* 125: ALTQ control interface */
@


1.33
log
@allow getting and setting of the ADC, DAC, and PIO ports on the daadio (this has been sitting in my tree for awhile)
@
text
@d1 1
a1 1
/*	$OpenBSD: conf.c,v 1.32 2002/05/16 21:11:17 miod Exp $	*/
d74 2
a75 2
#include "zs.h"
#include "kbd.h"
a76 8
#include "bwtwo.h"
#include "cgtwo.h"
#include "cgthree.h"
#include "cgfour.h"
#include "cgsix.h"
#include "cgeight.h"
#include "tcx.h"
#include "cgfourteen.h"
d87 5
d149 2
a150 2
	cdev_tty_init(NZS,zs),		/* 12: zs serial */
	cdev_gen_init(1,ms),		/* 13: /dev/mouse */
d159 1
a159 1
	cdev_fb_init(1,fb),		/* 22: /dev/fb indirect driver */
d164 1
a164 1
	cdev_fb_init(NBWTWO,bwtwo),	/* 27: /dev/bwtwo */
d166 1
a166 5
#if	NKBD > 0
	cdev_gen_init(1,kbd),		/* 29: /dev/kbd */
#else
	cdev_notdef(),			/* 29 */
#endif
d168 1
a168 1
	cdev_fb_init(NCGTWO,cgtwo),	/* 31: /dev/cgtwo */
d176 1
a176 1
	cdev_fb_init(NCGFOUR,cgfour),	/* 39: /dev/cgfour */
d196 1
a196 1
	cdev_fb_init(NCGTHREE,cgthree),	/* 55: /dev/cgthree */
d205 1
a205 1
	cdev_fb_init(NCGEIGHT,cgeight),	/* 64: /dev/cgeight */
d208 1
a208 1
	cdev_fb_init(NCGSIX,cgsix),	/* 67: /dev/cgsix */
d219 5
a223 4
	cdev_notdef(),			/* 78 */
	cdev_notdef(),			/* 79 */
	cdev_notdef(),			/* 80 */
	cdev_notdef(),			/* 81 */
d241 1
a241 1
	cdev_fb_init(NCGFOURTEEN,cgfourteen), /* 99: /dev/cgfourteen */
d251 1
a251 1
	cdev_fb_init(NTCX,tcx),		/* 109: /dev/tcx */
@


1.32
log
@Add systrace support to all the remaining architectures.

Tested by various people on various platforms, I'm willing to fix any
breakage this causes.

ok niels@@ deraadt@@ and mickey@@ (after his comments were applied)
@
text
@d1 1
a1 1
/*	$OpenBSD: conf.c,v 1.31 2001/12/11 23:19:02 miod Exp $	*/
d93 1
d245 2
a246 2
	cdev_notdef(),			/* 97 */
	cdev_fga_init(NFGA,fga),	/* 98 */
@


1.31
log
@Remove declarations that already exist in <sys/conf.h>
@
text
@d1 1
a1 1
/*	$OpenBSD: conf.c,v 1.30 2001/12/05 23:58:41 tdeval Exp $	*/
d135 2
d193 1
a193 1
	cdev_notdef(),			/* 50 */
@


1.31.2.1
log
@Sync UBC branch to -current
@
text
@d1 1
a1 1
/*	$OpenBSD: conf.c,v 1.31 2001/12/11 23:19:02 miod Exp $	*/
a134 2
#include "systrace.h"

d191 1
a191 1
	cdev_systrace_init(NSYSTRACE,systrace),	/* 50 system call tracing */
@


1.31.2.2
log
@sync to -current
@
text
@d1 1
a1 1
/*	$OpenBSD: conf.c,v 1.31.2.1 2002/06/11 03:38:16 art Exp $	*/
d74 2
a75 2
#include "zstty.h"

d77 8
a92 6
#include "daadio.h"

#include "wsdisplay.h"
#include "wskbd.h"
#include "wsmouse.h"
#include "wsmux.h"
d151 2
a152 2
	cdev_tty_init(NZSTTY,zs),	/* 12: zs serial */
	cdev_notdef(),			/* 13: was /dev/mouse */
d161 1
a161 1
	cdev_notdef(),			/* 22: was /dev/fb */
d166 1
a166 1
	cdev_notdef(),			/* 27: was /dev/bwtwo */
d168 5
a172 1
	cdev_notdef(),			/* 29: was /dev/kbd */
d174 1
a174 1
	cdev_notdef(),			/* 31: was /dev/cgtwo */
d182 1
a182 1
	cdev_notdef(),			/* 39: was /dev/cgfour */
d202 1
a202 1
	cdev_notdef(),			/* 55: was /dev/cgthree */
d211 1
a211 1
	cdev_notdef(),			/* 64: was /dev/cgeight */
d214 1
a214 1
	cdev_notdef(),			/* 67: was /dev/cgsix */
d225 4
a228 5
	cdev_wsdisplay_init(NWSDISPLAY,	/* 78: frame buffers, etc. */
	    wsdisplay),
	cdev_mouse_init(NWSKBD, wskbd),	/* 79: keyboards */
	cdev_mouse_init(NWSMOUSE, wsmouse), /* 80: mice */
	cdev_mouse_init(NWSMUX, wsmux),	/* 81: ws multiplexer */
d244 3
a246 3
	cdev_daadio_init(NDAADIO,daadio), /* 97: daadio */
	cdev_fga_init(NFGA,fga),	/* 98: fga */
	cdev_notdef(),			/* 99: was /dev/cgfourteen */
d256 1
a256 1
	cdev_notdef(),			/* 109: was /dev/tcx */
@


1.31.2.3
log
@sync
@
text
@d1 1
a1 1
/*	$OpenBSD$	*/
a72 1
#include "presto.h"
a125 1
	bdev_disk_init(NPRESTO,presto),	/* 26: Prestoserve NVRAM */
d131 2
d162 1
a162 1
	cdev_disk_init(NPRESTO,presto),	/* 25: Prestoserve NVRAM */
d267 1
d310 1
a310 1
int chrtoblktbl[] = {
d338 1
a338 1
	/* 25 */	26,
d438 36
a473 1
int nchrtoblktbl = sizeof(chrtoblktbl) / sizeof(chrtoblktbl[0]);
@


1.30
log
@Enable rootdev auto-configuration by device drivers during boot.
Add support for "raid" devices (prepare future raidframe changes).

OK deraadt@@, Reviewed by drahn@@, jason@@, mickey@@ and miod@@
@
text
@d1 1
a1 1
/*	$OpenBSD: conf.c,v 1.29 2001/09/28 02:53:13 mickey Exp $	*/
d106 1
a106 1
	bdev_swap_init(1,sw),		/* 4 */
@


1.29
log
@move cdev_decl(pf) into it's proper place, kill cdev_decl(ipl) at the same time
@
text
@d1 1
a1 1
/*	$OpenBSD: conf.c,v 1.28 2001/06/27 06:56:29 kjc Exp $	*/
d427 13
@


1.28
log
@add the ALTQ device to the rest of the architectures.
@
text
@d1 1
a1 1
/*	$OpenBSD: conf.c,v 1.27 2001/06/25 03:20:15 kjell Exp $	*/
a131 1
cdev_decl(pf);
@


1.27
log
@add pf device on all architectures.
fix my previously bogus MAKEDEVs.
If you used pf on a non-i386. the major device number has changed,
and you'll need to recreate /dev/pf
ok theo
@
text
@d1 1
a1 1
/*	$OpenBSD: conf.c,v 1.26 2000/09/26 14:03:55 art Exp $	*/
d134 2
d271 1
@


1.26
log
@Implement getnulldev that returns the dev_t for "/dev/null".
@
text
@d1 1
a1 1
/*	$OpenBSD: conf.c,v 1.25 2000/06/28 20:22:15 mjacob Exp $	*/
d131 3
d203 1
a203 1
	cdev_gen_ipf(NIPF,ipl),		/* 59: ip filtering log */
@


1.25
log
@look in kbd.h to see whether we have configured a keyboard
@
text
@d1 1
a1 1
/*	$OpenBSD: conf.c,v 1.24 2000/02/21 08:16:36 mjacob Exp $	*/
d300 6
@


1.24
log
@add char 124 to be SES device
@
text
@d1 1
a1 1
/*	$OpenBSD: conf.c,v 1.23 1999/07/23 19:11:27 jason Exp $	*/
d75 1
d162 1
d164 3
@


1.23
log
@Drivers for the FORCE CPU-5V:
o fga5000 vme-sbus bridge
o system config registers
o flash memory
and daadio VME board driver
@
text
@d1 1
a1 1
/*	$OpenBSD: conf.c,v 1.22 1999/07/18 17:07:49 deraadt Exp $	*/
d66 1
d260 1
@


1.23.4.1
log
@sync with -current
@
text
@d1 1
a1 1
/*	$OpenBSD: conf.c,v 1.24 2000/02/21 08:16:36 mjacob Exp $	*/
a65 1
#include "ses.h"
a258 1
	cdev_ses_init(NSES,ses),	/* 124: SCSI SES or SAF-TE device */
@


1.23.4.2
log
@Continue the aborted merge of current just before 2.9 was cut into the
SMP branch.  Note that this will not make any progress of SMP functionality,
it is just merging of new code from the trunk into the old branch.
Please do not ask me questions about SMP status because of this mail,
instead go read the archives of smp@@openbsd.org, where I mailed about
these commits some week ago.  Another note: I am doing this in chunks now,
so as to not lock too much of the tree for long times
@
text
@d1 1
a1 1
/*	$OpenBSD: conf.c,v 1.26 2000/09/26 14:03:55 art Exp $	*/
a74 1
#include "kbd.h"
a160 1
#if	NKBD > 0
a161 3
#else
	cdev_notdef(),			/* 29 */
#endif
a294 6
}

dev_t
getnulldev()
{
	return makedev(mem_no, 2);
@


1.23.4.3
log
@Merge in -current from two days ago in the SMP branch.
As usual with merges, they do not indicate progress, so do not hold
your breath for working SMP, and do not mail me and ask about the
state of it.  It has not changed.  There is work ongoing, but very, very
slowly.  The commit is done in parts as to not lock up the tree in too
big chunks at a time.
@
text
@d1 1
a1 1
/*	$OpenBSD: conf.c,v 1.23.4.2 2001/05/14 21:37:15 niklas Exp $	*/
a130 5
#include "pf.h"
cdev_decl(pf);

#include <altq/altqconf.h>

d200 1
a200 1
	cdev_pf_init(NPF,pf),		/* 59: packet filter */
a265 1
	cdev_altq_init(NALTQ,altq),	/* 125: ALTQ control interface */
@


1.23.4.4
log
@Sync the SMP branch to something just after 3.0
@
text
@d1 1
a1 1
/*	$OpenBSD: conf.c,v 1.23.4.3 2001/07/04 10:23:39 niklas Exp $	*/
d132 1
@


1.23.4.5
log
@Merge in trunk
@
text
@d1 1
a1 1
/*	$OpenBSD$	*/
d106 1
a106 1
	bdev_swap_init(1,sw),		/* 4 swap pseudo-device */
a426 13
	/*111 */	NODEV,
	/*112 */	NODEV,
	/*113 */	NODEV,
	/*114 */	NODEV,
	/*115 */	NODEV,
	/*116 */	NODEV,
	/*117 */	NODEV,
	/*118 */	NODEV,
	/*119 */	NODEV,
	/*120 */	NODEV,
	/*121 */	NODEV,
	/*122 */	NODEV,
	/*123 */	25,
@


1.23.4.6
log
@Sync the SMP branch with 3.3
@
text
@d74 2
a75 2
#include "zstty.h"

d77 8
a92 6
#include "daadio.h"

#include "wsdisplay.h"
#include "wskbd.h"
#include "wsmouse.h"
#include "wsmux.h"
d133 1
a133 1
#include "systrace.h"
d149 2
a150 2
	cdev_tty_init(NZSTTY,zs),	/* 12: zs serial */
	cdev_notdef(),			/* 13: was /dev/mouse */
d159 1
a159 1
	cdev_notdef(),			/* 22: was /dev/fb */
d164 1
a164 1
	cdev_notdef(),			/* 27: was /dev/bwtwo */
d166 5
a170 1
	cdev_notdef(),			/* 29: was /dev/kbd */
d172 1
a172 1
	cdev_notdef(),			/* 31: was /dev/cgtwo */
d180 1
a180 1
	cdev_notdef(),			/* 39: was /dev/cgfour */
d191 1
a191 1
	cdev_systrace_init(NSYSTRACE,systrace),	/* 50 system call tracing */
d200 1
a200 1
	cdev_notdef(),			/* 55: was /dev/cgthree */
d209 1
a209 1
	cdev_notdef(),			/* 64: was /dev/cgeight */
d212 1
a212 1
	cdev_notdef(),			/* 67: was /dev/cgsix */
d223 4
a226 5
	cdev_wsdisplay_init(NWSDISPLAY,	/* 78: frame buffers, etc. */
	    wsdisplay),
	cdev_mouse_init(NWSKBD, wskbd),	/* 79: keyboards */
	cdev_mouse_init(NWSMOUSE, wsmouse), /* 80: mice */
	cdev_mouse_init(NWSMUX, wsmux),	/* 81: ws multiplexer */
d242 3
a244 3
	cdev_daadio_init(NDAADIO,daadio), /* 97: daadio */
	cdev_fga_init(NFGA,fga),	/* 98: fga */
	cdev_notdef(),			/* 99: was /dev/cgfourteen */
d254 1
a254 1
	cdev_notdef(),			/* 109: was /dev/tcx */
d270 1
@


1.23.4.7
log
@Sync the SMP branch to -current.
@
text
@d1 1
a1 1
/*	$OpenBSD: conf.c,v 1.23.4.6 2003/03/27 23:49:26 niklas Exp $	*/
a72 1
#include "presto.h"
a125 1
	bdev_disk_init(NPRESTO,presto),	/* 26: Prestoserve NVRAM */
d160 1
a160 1
	cdev_disk_init(NPRESTO,presto),	/* 25: Prestoserve NVRAM */
d335 1
a335 1
	/* 25 */	26,
@


1.23.4.8
log
@merge the trunk so we will get the genfs and locking fixes
@
text
@d1 1
a1 1
/*	$OpenBSD$	*/
d309 1
a309 1
int chrtoblktbl[] = {
d437 36
a472 1
int nchrtoblktbl = sizeof(chrtoblktbl) / sizeof(chrtoblktbl[0]);
@


1.23.4.9
log
@Sync SMP branch to -current
@
text
@d1 1
a1 1
/*	$OpenBSD: conf.c,v 1.23.4.8 2003/05/16 00:29:40 niklas Exp $	*/
d25 5
a29 1
 * 3. Neither the name of the University nor the names of its contributors
@


1.23.4.10
log
@Merge with the trunk
@
text
@d1 1
a1 1
/*	$OpenBSD$	*/
a262 1
	cdev_ptm_init(NPTY,ptm),	/* 125: pseudo-tty ptm device */
@


1.22
log
@rf support; m4@@umn.edu
@
text
@d1 1
a1 1
/*	$OpenBSD: conf.c,v 1.21 1999/02/01 00:30:43 jason Exp $	*/
d88 3
d233 1
a233 1
	cdev_notdef(),			/* 98 */
d235 4
a238 4
	cdev_tty_init(NMTTY,mtty),	/* 100 */
	cdev_gen_init(NMBPP,mbpp),	/* 101 */
	cdev_tty_init(NSTTY,stty),	/* 102 */
	cdev_gen_init(NSBPP,sbpp),	/* 103 */
d242 2
a243 2
	cdev_notdef(),			/* 107 */
	cdev_notdef(),			/* 108 */
@


1.21
log
@driver for the 8 serial 1 parallel SUNW,spif board:
o heavily based on magma driver
o no support for the parallel port yet
@
text
@d1 1
a1 1
/*	$OpenBSD: conf.c,v 1.20 1998/12/29 09:33:36 deraadt Exp $	*/
d64 1
d122 1
d255 1
@


1.20
log
@first cut at a bpp driver; mailed to me by downsj eons ago
@
text
@d1 1
a1 1
/*	$OpenBSD: conf.c,v 1.19 1998/09/25 09:20:54 todd Exp $	*/
d86 2
d232 2
a233 2
	cdev_notdef(),			/* 102 */
	cdev_notdef(),			/* 103 */
@


1.19
log
@o xfs is in the house (thanks art, for getting me started)
o all but vax are major 51
@
text
@d1 1
a1 1
/*	$OpenBSD: conf.c,v 1.18 1998/08/24 05:30:02 millert Exp $	*/
d84 1
d232 1
a232 1
	cdev_notdef(),			/* 104 */
@


1.18
log
@Add support for /dev/ksyms to arch-specific files
@
text
@d1 1
a1 1
/*	$OpenBSD: conf.c,v 1.17 1998/07/07 06:56:11 deraadt Exp $	*/
d85 4
d174 3
d178 1
@


1.17
log
@oops, i did not handle nchrdev correctly
@
text
@d1 1
a1 1
/*	$OpenBSD: conf.c,v 1.16 1998/07/07 03:02:47 deraadt Exp $	*/
d85 1
d241 1
@


1.16
log
@fix chrtoblk() so that it returne ENODEV for entries beyond the end of the table
@
text
@d1 1
a1 1
/*	$OpenBSD: conf.c,v 1.15 1998/05/20 19:29:21 deraadt Exp $	*/
d401 1
a401 1
	if (major(dev) >= MAXDEV ||
@


1.15
log
@magma serial driver; plunky@@skate.demon.co.uk
@
text
@d1 1
a1 1
/*	$OpenBSD: conf.c,v 1.14 1997/08/08 08:27:08 downsj Exp $	*/
a389 8
	/*111 */	NODEV,
	/*112 */	NODEV,
	/*113 */	NODEV,
	/*114 */	NODEV,
	/*115 */	NODEV,
	/*116 */	NODEV,
	/*117 */	NODEV,
	/*118 */	NODEV,
d401 2
a402 1
	if (major(dev) >= nchrdev)
@


1.14
log
@Mostly sync to NetBSD-current 970804.

GENERIC currently compiles and runs; some devices (isp) are not complete and
not yet enabled.
@
text
@d1 1
a1 1
/*	$OpenBSD$	*/
d84 1
d218 2
a219 2
	cdev_notdef(),			/* 100 */
	cdev_notdef(),			/* 101 */
@


1.13
log
@add rd support
@
text
@d1 1
d75 1
d80 2
d148 1
a148 1
	cdev_notdef(),			/* 31: should be /dev/cgtwo */
d216 1
a216 1
	cdev_notdef(),			/* 99 */
d226 1
a226 1
	cdev_notdef(),			/* 109 */
@


1.12
log
@add ipl device
@
text
@d69 1
d100 1
a100 1
	bdev_notdef(),			/* 17 */
d219 1
a219 1
	cdev_notdef(),			/* 106 */
d380 1
a380 1
	/*106 */	NODEV,
@


1.11
log
@Updates for SCSI scanner and SCSI unknown devices.
Removed MI *dev_decl() stuff that is now in sys/conf.h
@
text
@d170 2
a171 2
	cdev_disk_init(NCD,cd),		/* 58 SCSI CD-ROM */
	cdev_notdef(),			/* 59 */
@


1.10
log
@add blktochr()
@
text
@d65 1
d232 2
@


1.9
log
@random device is permanent now.
@
text
@d407 18
@


1.8
log
@rnd -> random
@
text
@a59 1
#include "random.h"
d230 1
a230 1
	cdev_random_init(NRANDOM,random),/* 119: random generator */
@


1.7
log
@netbsd port, now we merge our changes back in
@
text
@d60 1
d231 1
@


1.6
log
@add rnd driver
@
text
@d1 1
a1 1
/*	$OpenBSD: conf.c,v 1.4 1996/02/21 12:53:53 mickey Exp $ */
d55 1
a55 1
int	ttselect	__P((dev_t, int, struct proc *));
d57 8
a64 1
bdev_decl(sw);
d66 10
a75 1
bdev_decl(sd);
a76 1
bdev_decl(xd);
a77 13
bdev_decl(xy);
#include "st.h"
bdev_decl(st);
#include "cd.h"
bdev_decl(cd);
#include "vnd.h"
bdev_decl(vnd);
#define fdopen  Fdopen	/* conflicts with fdopen() in kern_descrip.c */
#include "fd.h"
bdev_decl(fd);
#undef  fdopen
#include "ccd.h"
bdev_decl(ccd);
d84 1
a84 1
	bdev_disk_init(NXY,xy),		/* 3: XY SMD disk */
d91 1
a91 1
	bdev_disk_init(NXD,xd),		/* 10: XD SMD disk */
a96 1
#define fdopen  Fdopen	/* conflicts with fdopen() in kern_descrip.c */
a97 1
#undef  fdopen
a108 80
/* open, close, read, write, ioctl, select */
#define	cdev_gen_init(c,n) { \
	dev_init(c,n,open), dev_init(c,n,close), dev_init(c,n,read), \
	dev_init(c,n,write), dev_init(c,n,ioctl), (dev_type_stop((*))) nullop, \
	0, dev_init(c,n,select), (dev_type_mmap((*))) enodev }

/* open, close, ioctl */
#define	cdev_openprom_init(c,n) { \
	dev_init(c,n,open), dev_init(c,n,close), (dev_type_read((*))) enodev, \
	(dev_type_write((*))) enodev, dev_init(c,n,ioctl), \
	(dev_type_stop((*))) nullop, 0, (dev_type_select((*))) enodev, \
	(dev_type_mmap((*))) enodev }

cdev_decl(cn);
cdev_decl(ctty);
#define	mmread	mmrw
#define	mmwrite	mmrw
cdev_decl(mm);
cdev_decl(sw);
#include "zs.h"
cdev_decl(zs);
cdev_decl(ms);
cdev_decl(log);
cdev_decl(sd);
cdev_decl(st);
cdev_decl(xd);
cdev_decl(xy);
#include "ch.h"
cdev_decl(ch);
#include "pty.h"
#define	ptstty		ptytty
#define	ptsioctl	ptyioctl
cdev_decl(pts);
#define	ptctty		ptytty
#define	ptcioctl	ptyioctl
cdev_decl(ptc);
cdev_decl(fb);
dev_decl(fd,open);
#include "bwtwo.h"
cdev_decl(bwtwo);
cdev_decl(kbd);
#define	fdopen	Fdopen
cdev_decl(fd);
#undef	fdopen
#include "cgthree.h"
cdev_decl(cgthree);
#include "cgfour.h"
cdev_decl(cgfour);
cdev_decl(cd);
#include "cgsix.h"
cdev_decl(cgsix);
#include "cgeight.h"
cdev_decl(cgeight);
#include "audio.h"
cdev_decl(audio);
cdev_decl(openprom);
#include "bpfilter.h"
cdev_decl(bpf);
cdev_decl(vnd);
cdev_decl(ccd);
#include "tun.h"
cdev_decl(tun);
cdev_decl(svr4_net);
#ifdef LKM
#define NLKM 1
#else
#define NLKM 0
#endif
cdev_decl(lkm);
#include "rnd.h"
cdev_decl(rnd);

/* open, close, read, ioctl */
cdev_decl(ipl);
#ifdef IPFILTER
#define NIPF 1
#else
#define NIPF 0
#endif

d120 1
a120 1
	cdev_disk_init(NXY,xy),		/* 9: XY SMD disk */
d135 1
a135 1
	cdev_fd_init(1,fd),		/* 24: file descriptor pseudo-device */
d153 2
a154 6
	cdev_disk_init(NXD,xd),		/* 42: XD SMD disk */
#ifdef COMPAT_SVR4
	cdev_svr4_net_init(1,svr4_net),	/* 43: svr4 net pseudo-device */
#else
	cdev_notdef(),			/* 43 */
#endif
a164 1
#define fdopen  Fdopen	/* conflicts with fdopen() in kern_descrip.c */
a165 1
#undef  fdopen
d170 1
a170 1
	cdev_gen_ipf(NIPF,ipl),		/* 59 */
a229 1
	cdev_rnd_init(NRND,rnd),	/* 119: random data source */
d251 1
d259 1
d393 1
@


1.5
log
@remove #ifndef LKM, since that stuff already in sys/conf.h,
add lkmenodev prototype.
@
text
@d178 2
d316 1
@


1.4
log
@move cdev_gen_ipf() macro to the <sys/conf.h>, so the lkm
for ipl is possible and also, why it is in <machine/conf.c> while
it (ipl) is in <net/*> ???
@
text
@d1 1
a1 1
/*	$OpenBSD: conf.c,v 1.36 1995/09/25 20:27:32 chuck Exp $ */
a55 6

#ifdef LKM
int	lkmenodev();
#else
#define	lkmenodev	enodev
#endif
@


1.3
log
@created devices for the IP filter log on all architectures
@
text
@d1 1
a1 1
/*	$NetBSD: conf.c,v 1.36 1995/09/25 20:27:32 chuck Exp $ */
a186 5
#define	cdev_gen_ipf(c,n) { \
	dev_init(c,n,open), dev_init(c,n,close), dev_init(c,n,read), \
	(dev_type_write((*))) enodev, dev_init(c,n,ioctl), \
	(dev_type_stop((*))) nullop, 0, (dev_type_select((*))) enodev, \
	(dev_type_mmap((*))) enodev, 0 }
@


1.2
log
@add cgfour, cgeight
@
text
@d185 13
d265 1
a265 1
	cdev_notdef(),			/* 59 */
@


1.1
log
@Initial revision
@
text
@d88 1
a88 1
	bdev_disk_init(NXY,xy),		/* 3: SMD disk */
d95 1
a95 1
	bdev_disk_init(NXD,xd),		/* 10: SMD disk */
d161 2
d166 2
d196 1
a196 1
	cdev_disk_init(NXY,xy),		/* 9: SMD disk */
d226 1
a226 1
	cdev_notdef(),			/* 39 */
d229 1
a229 1
	cdev_disk_init(NXD,xd),		/* 42: SMD disk */
d257 1
a257 1
	cdev_notdef(),			/* 64 */
@


1.1.1.1
log
@initial import of NetBSD tree
@
text
@@
