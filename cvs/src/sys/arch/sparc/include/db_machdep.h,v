head	1.18;
access;
symbols
	OPENBSD_6_0:1.18.0.2
	OPENBSD_6_0_BASE:1.18
	OPENBSD_5_9:1.16.0.6
	OPENBSD_5_9_BASE:1.16
	OPENBSD_5_8:1.16.0.8
	OPENBSD_5_8_BASE:1.16
	OPENBSD_5_7:1.16.0.2
	OPENBSD_5_7_BASE:1.16
	OPENBSD_5_6:1.16.0.4
	OPENBSD_5_6_BASE:1.16
	OPENBSD_5_5:1.15.0.14
	OPENBSD_5_5_BASE:1.15
	OPENBSD_5_4:1.15.0.10
	OPENBSD_5_4_BASE:1.15
	OPENBSD_5_3:1.15.0.8
	OPENBSD_5_3_BASE:1.15
	OPENBSD_5_2:1.15.0.6
	OPENBSD_5_2_BASE:1.15
	OPENBSD_5_1_BASE:1.15
	OPENBSD_5_1:1.15.0.4
	OPENBSD_5_0:1.15.0.2
	OPENBSD_5_0_BASE:1.15
	OPENBSD_4_9:1.14.0.2
	OPENBSD_4_9_BASE:1.14
	OPENBSD_4_8:1.13.0.20
	OPENBSD_4_8_BASE:1.13
	OPENBSD_4_7:1.13.0.16
	OPENBSD_4_7_BASE:1.13
	OPENBSD_4_6:1.13.0.18
	OPENBSD_4_6_BASE:1.13
	OPENBSD_4_5:1.13.0.14
	OPENBSD_4_5_BASE:1.13
	OPENBSD_4_4:1.13.0.12
	OPENBSD_4_4_BASE:1.13
	OPENBSD_4_3:1.13.0.10
	OPENBSD_4_3_BASE:1.13
	OPENBSD_4_2:1.13.0.8
	OPENBSD_4_2_BASE:1.13
	OPENBSD_4_1:1.13.0.6
	OPENBSD_4_1_BASE:1.13
	OPENBSD_4_0:1.13.0.4
	OPENBSD_4_0_BASE:1.13
	OPENBSD_3_9:1.13.0.2
	OPENBSD_3_9_BASE:1.13
	OPENBSD_3_8:1.12.0.2
	OPENBSD_3_8_BASE:1.12
	OPENBSD_3_7:1.11.0.2
	OPENBSD_3_7_BASE:1.11
	OPENBSD_3_6:1.10.0.6
	OPENBSD_3_6_BASE:1.10
	SMP_SYNC_A:1.10
	SMP_SYNC_B:1.10
	OPENBSD_3_5:1.10.0.4
	OPENBSD_3_5_BASE:1.10
	OPENBSD_3_4:1.10.0.2
	OPENBSD_3_4_BASE:1.10
	UBC_SYNC_A:1.10
	OPENBSD_3_3:1.9.0.4
	OPENBSD_3_3_BASE:1.9
	OPENBSD_3_2:1.9.0.2
	OPENBSD_3_2_BASE:1.9
	OPENBSD_3_1:1.8.0.2
	OPENBSD_3_1_BASE:1.8
	UBC_SYNC_B:1.9
	UBC:1.7.0.2
	UBC_BASE:1.7
	OPENBSD_3_0:1.6.0.12
	OPENBSD_3_0_BASE:1.6
	OPENBSD_2_9_BASE:1.6
	OPENBSD_2_9:1.6.0.10
	OPENBSD_2_8:1.6.0.8
	OPENBSD_2_8_BASE:1.6
	OPENBSD_2_7:1.6.0.6
	OPENBSD_2_7_BASE:1.6
	SMP:1.6.0.4
	SMP_BASE:1.6
	kame_19991208:1.6
	OPENBSD_2_6:1.6.0.2
	OPENBSD_2_6_BASE:1.6
	OPENBSD_2_5:1.5.0.8
	OPENBSD_2_5_BASE:1.5
	OPENBSD_2_4:1.5.0.6
	OPENBSD_2_4_BASE:1.5
	OPENBSD_2_3:1.5.0.4
	OPENBSD_2_3_BASE:1.5
	OPENBSD_2_2:1.5.0.2
	OPENBSD_2_2_BASE:1.5
	OPENBSD_2_1:1.3.0.4
	OPENBSD_2_1_BASE:1.3
	OPENBSD_2_0:1.3.0.2
	OPENBSD_2_0_BASE:1.3
	netbsd_1_1:1.1.1.1;
locks; strict;
comment	@ * @;


1.18
date	2016.04.27.11.10.48;	author mpi;	state Exp;
branches;
next	1.17;
commitid	57btDderNGPG4fjG;

1.17
date	2016.02.27.13.08.07;	author mpi;	state Exp;
branches;
next	1.16;
commitid	hnv9KfQtxhCytAnd;

1.16
date	2014.03.16.20.31.46;	author guenther;	state Exp;
branches;
next	1.15;

1.15
date	2011.03.23.16.54.37;	author pirofti;	state Exp;
branches;
next	1.14;

1.14
date	2010.11.27.19.57.23;	author miod;	state Exp;
branches;
next	1.13;

1.13
date	2005.11.13.17.50.44;	author fgsch;	state Exp;
branches;
next	1.12;

1.12
date	2005.04.19.15.23.08;	author miod;	state Exp;
branches;
next	1.11;

1.11
date	2005.01.04.21.14.35;	author espie;	state Exp;
branches;
next	1.10;

1.10
date	2003.05.13.22.25.33;	author miod;	state Exp;
branches;
next	1.9;

1.9
date	2002.08.11.23.05.20;	author art;	state Exp;
branches;
next	1.8;

1.8
date	2002.03.14.01.26.43;	author millert;	state Exp;
branches;
next	1.7;

1.7
date	2001.11.06.19.53.16;	author miod;	state Exp;
branches
	1.7.2.1;
next	1.6;

1.6
date	99.07.09.21.33.37;	author art;	state Exp;
branches
	1.6.4.1;
next	1.5;

1.5
date	97.09.17.06.47.13;	author downsj;	state Exp;
branches;
next	1.4;

1.4
date	97.08.08.08.26.13;	author downsj;	state Exp;
branches;
next	1.3;

1.3
date	96.08.11.05.34.47;	author deraadt;	state Exp;
branches;
next	1.2;

1.2
date	95.12.15.13.52.37;	author deraadt;	state Exp;
branches;
next	1.1;

1.1
date	95.10.18.08.51.43;	author deraadt;	state Exp;
branches
	1.1.1.1;
next	;

1.1.1.1
date	95.10.18.08.51.43;	author deraadt;	state Exp;
branches;
next	;

1.6.4.1
date	2001.11.13.21.04.17;	author niklas;	state Exp;
branches;
next	1.6.4.2;

1.6.4.2
date	2002.03.28.10.57.10;	author niklas;	state Exp;
branches;
next	1.6.4.3;

1.6.4.3
date	2003.03.27.23.49.25;	author niklas;	state Exp;
branches;
next	1.6.4.4;

1.6.4.4
date	2003.05.16.00.29.40;	author niklas;	state Exp;
branches;
next	;

1.7.2.1
date	2002.06.11.03.38.16;	author art;	state Exp;
branches;
next	1.7.2.2;

1.7.2.2
date	2002.10.29.00.28.10;	author art;	state Exp;
branches;
next	1.7.2.3;

1.7.2.3
date	2003.05.19.21.46.32;	author tedu;	state Exp;
branches;
next	;


desc
@@


1.18
log
@G/C DDB_REGS.
@
text
@/*	$OpenBSD: db_machdep.h,v 1.17 2016/02/27 13:08:07 mpi Exp $	*/
/*	$NetBSD: db_machdep.h,v 1.10 1997/08/31 21:23:40 pk Exp $ */

/*
 * Mach Operating System
 * Copyright (c) 1991,1990 Carnegie Mellon University
 * All Rights Reserved.
 *
 * Permission to use, copy, modify and distribute this software and its
 * documentation is hereby granted, provided that both the copyright
 * notice and this permission notice appear in all copies of the
 * software, derivative works or modified versions, and any portions
 * thereof, and that both notices appear in supporting documentation.
 *
 * CARNEGIE MELLON ALLOWS FREE USE OF THIS SOFTWARE IN ITS "AS IS"
 * CONDITION.  CARNEGIE MELLON DISCLAIMS ANY LIABILITY OF ANY KIND FOR
 * ANY DAMAGES WHATSOEVER RESULTING FROM THE USE OF THIS SOFTWARE.
 *
 * Carnegie Mellon requests users of this software to return to
 *
 *  Software Distribution Coordinator  or  Software.Distribution@@CS.CMU.EDU
 *  School of Computer Science
 *  Carnegie Mellon University
 *  Pittsburgh PA 15213-3890
 *
 * any improvements or extensions that they make and grant Carnegie Mellon
 * the rights to redistribute these changes.
 */

#ifndef	_MACHINE_DB_MACHDEP_H_
#define	_MACHINE_DB_MACHDEP_H_

/*
 * Machine-dependent defines for new kernel debugger.
 */


#include <uvm/uvm_extern.h>
#include <machine/frame.h>
#include <machine/psl.h>
#include <machine/trap.h>
#include <machine/reg.h>

/* end of mangling */

typedef	vaddr_t		db_addr_t;	/* address - unsigned */
typedef	long		db_expr_t;	/* expression - signed */

typedef struct {
	struct trapframe db_tf;
	struct frame	 db_fr;
} db_regs_t;

extern db_regs_t	ddb_regs;	/* register state */
#define	DDB_TF		(&ddb_regs.db_tf)
#define	DDB_FR		(&ddb_regs.db_fr)

#define	PC_REGS(regs)	((db_addr_t)(regs)->db_tf.tf_pc)
#define	SET_PC_REGS(regs, value)	(regs)->db_tf.tf_pc = (int)(value)
#define	PC_ADVANCE(regs) do {				\
	int n = (regs)->db_tf.tf_npc;			\
	(regs)->db_tf.tf_pc = n;			\
	(regs)->db_tf.tf_npc = n + 4;			\
} while(0)

#define	BKPT_INST	0x91d02001	/* breakpoint instruction */
#define	BKPT_SIZE	(4)		/* size of breakpoint inst */
#define	BKPT_SET(inst)	(BKPT_INST)

#define	db_clear_single_step(regs)	(void) (0)
#define	db_set_single_step(regs)	(void) (0)

#define	IS_BREAKPOINT_TRAP(type, code)	\
	((type) == T_BREAKPOINT || (type) == T_KGDB_EXEC)
#define IS_WATCHPOINT_TRAP(type, code)	(0)

#define	inst_trap_return(ins)	((ins)&0)
#define	inst_return(ins)	((ins)&0)
#define	inst_call(ins)		((ins)&0)

#define DB_MACHINE_COMMANDS

void db_machine_init(void);
int db_ktrap(int, struct trapframe *);

/*
 * KGDB definitions
 */
typedef u_long		kgdb_reg_t;
#define KGDB_NUMREGS	72
#define KGDB_BUFLEN	1024

#define KGDB_PREPARE	fb_unblank()
#define KGDB_ENTER	__asm("ta %0" :: "n" (T_KGDB_EXEC))

#endif	/* _MACHINE_DB_MACHDEP_H_ */
@


1.17
log
@Rename kdb_trap() into db_ktrap().

The goal is to include it in the list of functions that must not be
instrumented.  All ddb(8) functions should be in this list and have
their names start with 'db_'.

ok visa@@, deraadt@@
@
text
@d1 1
a1 1
/*	$OpenBSD: db_machdep.h,v 1.16 2014/03/16 20:31:46 guenther Exp $	*/
a54 1
#define	DDB_REGS	(&ddb_regs)
@


1.16
log
@DDB supports ELF symbols are all archs, and it's always the same as the
native size, so eliminate the #defines.

ok miod@@
@
text
@d1 1
a1 1
/*	$OpenBSD: db_machdep.h,v 1.15 2011/03/23 16:54:37 pirofti Exp $	*/
d85 1
a85 1
int kdb_trap(int, struct trapframe *);
@


1.15
log
@Normalize sentinel. Use _MACHINE_*_H_ and _<ARCH>_*_H_ properly and consitently.

Discussed and okay drahn@@. Okay deraadt@@.
@
text
@d1 1
a1 1
/*	$OpenBSD: db_machdep.h,v 1.14 2010/11/27 19:57:23 miod Exp $	*/
a85 4

#define DB_ELF_SYMBOLS
#define DB_ELFSIZE	32

@


1.14
log
@Remove ddb single-step load and store counters. Most platforms do not
implement them, and they are of questionable usefulness.
@
text
@d1 1
a1 1
/*	$OpenBSD: db_machdep.h,v 1.13 2005/11/13 17:50:44 fgsch Exp $	*/
d30 2
a31 2
#ifndef	_SPARC_DB_MACHDEP_H_
#define	_SPARC_DB_MACHDEP_H_
d101 1
a101 1
#endif	/* _SPARC_DB_MACHDEP_H_ */
@


1.13
log
@move kgdb_connect and kgdb_panic into MI. looked by miod@@ and kettenis@@
@
text
@d1 1
a1 1
/*	$OpenBSD: db_machdep.h,v 1.12 2005/04/19 15:23:08 miod Exp $	*/
a80 2
#define inst_load(ins)		0
#define inst_store(ins)		0
@


1.12
log
@No more a.out symbols support in ddb.
@
text
@d1 1
a1 1
/*	$OpenBSD: db_machdep.h,v 1.11 2005/01/04 21:14:35 espie Exp $	*/
d99 3
@


1.11
log
@SET_PC_REGS, arches tested between me and miod.
@
text
@d1 1
a1 1
/*	$OpenBSD: db_machdep.h,v 1.10 2003/05/13 22:25:33 miod Exp $	*/
a88 4
/*
 * We use a.out symbols in DDB.
 */
#define	DB_AOUT_SYMBOLS
@


1.10
log
@Nuke a few simple commons.
@
text
@d1 1
a1 1
/*	$OpenBSD: db_machdep.h,v 1.9 2002/08/11 23:05:20 art Exp $	*/
a58 3
#if defined(lint)
#define	PC_REGS(regs)	((regs)->db_tf.tf_pc)
#else
d60 1
a60 1
#endif
@


1.9
log
@ELF support for DDB.
@
text
@d1 1
a1 1
/*	$OpenBSD: db_machdep.h,v 1.8 2002/03/14 01:26:43 millert Exp $	*/
d54 1
a54 1
db_regs_t		ddb_regs;	/* register state */
@


1.8
log
@First round of __P removal in sys
@
text
@d1 1
a1 1
/*	$OpenBSD: db_machdep.h,v 1.7 2001/11/06 19:53:16 miod Exp $	*/
d96 2
@


1.7
log
@Replace inclusion of <vm/foo.h> with the correct <uvm/bar.h> when necessary.
(Look ma, I might have broken the tree)
@
text
@d1 1
a1 1
/*	$OpenBSD: db_machdep.h,v 1.6 1999/07/09 21:33:37 art Exp $	*/
d89 2
a90 2
void db_machine_init __P((void));
int kdb_trap __P((int, struct trapframe *));
@


1.7.2.1
log
@Sync UBC branch to -current
@
text
@d1 1
a1 1
/*	$OpenBSD: db_machdep.h,v 1.7 2001/11/06 19:53:16 miod Exp $	*/
d89 2
a90 2
void db_machine_init(void);
int kdb_trap(int, struct trapframe *);
@


1.7.2.2
log
@sync to -current
@
text
@d1 1
a1 1
/*	$OpenBSD: db_machdep.h,v 1.7.2.1 2002/06/11 03:38:16 art Exp $	*/
a95 2
#define DB_ELF_SYMBOLS
#define DB_ELFSIZE	32
@


1.7.2.3
log
@sync
@
text
@d1 1
a1 1
/*	$OpenBSD$	*/
d54 1
a54 1
extern db_regs_t	ddb_regs;	/* register state */
@


1.6
log
@vm_offset_t -> {v,p}addr_t and vm_size_t -> {v,p}size_t
remove "register" keywords
Various cleanups.
@
text
@d1 1
a1 1
/*	$OpenBSD: db_machdep.h,v 1.5 1997/09/17 06:47:13 downsj Exp $	*/
d38 1
a38 1
#include <vm/vm.h>
@


1.6.4.1
log
@Merge in -current
@
text
@d1 1
a1 1
/*	$OpenBSD$	*/
d38 1
a38 1
#include <uvm/uvm_extern.h>
@


1.6.4.2
log
@Merge in -current from about a week ago
@
text
@d89 2
a90 2
void db_machine_init(void);
int kdb_trap(int, struct trapframe *);
@


1.6.4.3
log
@Sync the SMP branch with 3.3
@
text
@a95 2
#define DB_ELF_SYMBOLS
#define DB_ELFSIZE	32
@


1.6.4.4
log
@merge the trunk so we will get the genfs and locking fixes
@
text
@d54 1
a54 1
extern db_regs_t	ddb_regs;	/* register state */
@


1.5
log
@NETBSD_CURRENT_970916.  Lot's just ID changes, since changes don't apply to
us.  Includes some pmap changes, for which I don't have the original commit
message(s) handy.
@
text
@d1 1
a1 1
/*	$OpenBSD: db_machdep.h,v 1.4 1997/08/08 08:26:13 downsj Exp $	*/
d46 1
a46 1
typedef	vm_offset_t	db_addr_t;	/* address - unsigned */
@


1.4
log
@Mostly sync to NetBSD-current 970804.

GENERIC currently compiles and runs; some devices (isp) are not complete and
not yet enabled.
@
text
@d1 2
a2 2
/*	$OpenBSD$	*/
/*	$NetBSD: db_machdep.h,v 1.9 1997/06/26 01:27:00 thorpej Exp $ */
d50 2
a51 2
	struct trapframe ddb_tf;
	struct frame	 ddb_fr;
d56 2
a57 2
#define	DDB_TF		(&ddb_regs.ddb_tf)
#define	DDB_FR		(&ddb_regs.ddb_fr)
d60 1
a60 1
#define	PC_REGS(regs)	((regs)->ddb_tf.tf_pc)
d62 1
a62 1
#define	PC_REGS(regs)	((db_addr_t)(regs)->ddb_tf.tf_pc)
d64 5
d77 2
a78 1
#define	IS_BREAKPOINT_TRAP(type, code)	((type) == T_BREAKPOINT)
d96 8
@


1.3
log
@netbsd port, now we merge our changes back in
@
text
@d1 2
a2 1
/*	$NetBSD: db_machdep.h,v 1.7 1996/03/31 22:21:28 pk Exp $ */
d47 1
a47 1
typedef	int		db_expr_t;	/* expression - signed */
d59 3
d63 1
d86 4
@


1.2
log
@simplify vm inclusions
@
text
@d1 1
a1 1
/*	$NetBSD: db_machdep.h,v 1.3 1995/02/09 10:34:21 pk Exp $ */
d3 1
a3 1
/* 
d7 1
a7 1
 * 
d13 1
a13 1
 * 
d17 1
a17 1
 * 
d19 1
a19 1
 * 
d24 1
a24 1
 * 
d64 2
a65 2
#define	db_clear_single_step(regs)	(0)
#define	db_set_single_step(regs)	(0)
d77 4
@


1.1
log
@Initial revision
@
text
@d37 1
a37 4
#include <vm/vm_prot.h>
#include <vm/vm_param.h>
#include <vm/vm_inherit.h>
#include <vm/lock.h>
@


1.1.1.1
log
@initial import of NetBSD tree
@
text
@@
