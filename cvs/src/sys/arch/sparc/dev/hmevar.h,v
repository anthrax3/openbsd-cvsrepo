head	1.14;
access;
symbols
	OPENBSD_6_0:1.14.0.28
	OPENBSD_6_0_BASE:1.14
	OPENBSD_5_9:1.14.0.24
	OPENBSD_5_9_BASE:1.14
	OPENBSD_5_8:1.14.0.26
	OPENBSD_5_8_BASE:1.14
	OPENBSD_5_7:1.14.0.18
	OPENBSD_5_7_BASE:1.14
	OPENBSD_5_6:1.14.0.22
	OPENBSD_5_6_BASE:1.14
	OPENBSD_5_5:1.14.0.20
	OPENBSD_5_5_BASE:1.14
	OPENBSD_5_4:1.14.0.16
	OPENBSD_5_4_BASE:1.14
	OPENBSD_5_3:1.14.0.14
	OPENBSD_5_3_BASE:1.14
	OPENBSD_5_2:1.14.0.12
	OPENBSD_5_2_BASE:1.14
	OPENBSD_5_1_BASE:1.14
	OPENBSD_5_1:1.14.0.10
	OPENBSD_5_0:1.14.0.8
	OPENBSD_5_0_BASE:1.14
	OPENBSD_4_9:1.14.0.6
	OPENBSD_4_9_BASE:1.14
	OPENBSD_4_8:1.14.0.4
	OPENBSD_4_8_BASE:1.14
	OPENBSD_4_7:1.14.0.2
	OPENBSD_4_7_BASE:1.14
	OPENBSD_4_6:1.13.0.4
	OPENBSD_4_6_BASE:1.13
	OPENBSD_4_5:1.12.0.12
	OPENBSD_4_5_BASE:1.12
	OPENBSD_4_4:1.12.0.10
	OPENBSD_4_4_BASE:1.12
	OPENBSD_4_3:1.12.0.8
	OPENBSD_4_3_BASE:1.12
	OPENBSD_4_2:1.12.0.6
	OPENBSD_4_2_BASE:1.12
	OPENBSD_4_1:1.12.0.4
	OPENBSD_4_1_BASE:1.12
	OPENBSD_4_0:1.12.0.2
	OPENBSD_4_0_BASE:1.12
	OPENBSD_3_9:1.11.0.6
	OPENBSD_3_9_BASE:1.11
	OPENBSD_3_8:1.11.0.4
	OPENBSD_3_8_BASE:1.11
	OPENBSD_3_7:1.11.0.2
	OPENBSD_3_7_BASE:1.11
	OPENBSD_3_6:1.10.0.2
	OPENBSD_3_6_BASE:1.10
	SMP_SYNC_A:1.9
	SMP_SYNC_B:1.9
	OPENBSD_3_5:1.9.0.4
	OPENBSD_3_5_BASE:1.9
	OPENBSD_3_4:1.9.0.2
	OPENBSD_3_4_BASE:1.9
	UBC_SYNC_A:1.7
	OPENBSD_3_3:1.7.0.14
	OPENBSD_3_3_BASE:1.7
	OPENBSD_3_2:1.7.0.12
	OPENBSD_3_2_BASE:1.7
	OPENBSD_3_1:1.7.0.10
	OPENBSD_3_1_BASE:1.7
	UBC_SYNC_B:1.7
	UBC:1.7.0.8
	UBC_BASE:1.7
	OPENBSD_3_0:1.7.0.6
	OPENBSD_3_0_BASE:1.7
	OPENBSD_2_9_BASE:1.7
	OPENBSD_2_9:1.7.0.4
	OPENBSD_2_8:1.7.0.2
	OPENBSD_2_8_BASE:1.7
	OPENBSD_2_7:1.6.0.8
	OPENBSD_2_7_BASE:1.6
	SMP:1.6.0.6
	SMP_BASE:1.6
	kame_19991208:1.6
	OPENBSD_2_6:1.6.0.4
	OPENBSD_2_6_BASE:1.6
	OPENBSD_2_5:1.6.0.2
	OPENBSD_2_5_BASE:1.6
	OPENBSD_2_4:1.5.0.2
	OPENBSD_2_4_BASE:1.5;
locks; strict;
comment	@ * @;


1.14
date	2009.07.16.07.18.47;	author sthen;	state Exp;
branches;
next	1.13;

1.13
date	2009.06.24.07.42.03;	author sthen;	state Exp;
branches;
next	1.12;

1.12
date	2006.06.02.20.00.54;	author miod;	state Exp;
branches;
next	1.11;

1.11
date	2004.09.28.00.21.23;	author brad;	state Exp;
branches;
next	1.10;

1.10
date	2004.08.08.19.01.20;	author brad;	state Exp;
branches;
next	1.9;

1.9
date	2003.06.18.19.13.01;	author jason;	state Exp;
branches;
next	1.8;

1.8
date	2003.06.02.18.40.59;	author jason;	state Exp;
branches;
next	1.7;

1.7
date	2000.06.18.17.39.17;	author jason;	state Exp;
branches;
next	1.6;

1.6
date	99.02.23.23.44.49;	author jason;	state Exp;
branches
	1.6.6.1;
next	1.5;

1.5
date	98.09.10.17.34.32;	author jason;	state Exp;
branches;
next	1.4;

1.4
date	98.09.08.04.48.38;	author jason;	state Exp;
branches;
next	1.3;

1.3
date	98.09.01.17.36.59;	author jason;	state Exp;
branches;
next	1.2;

1.2
date	98.07.17.21.33.10;	author jason;	state Exp;
branches;
next	1.1;

1.1
date	98.07.10.19.09.12;	author jason;	state Exp;
branches;
next	;

1.6.6.1
date	2001.05.14.21.37.06;	author niklas;	state Exp;
branches;
next	1.6.6.2;

1.6.6.2
date	2003.06.07.11.14.43;	author ho;	state Exp;
branches;
next	1.6.6.3;

1.6.6.3
date	2004.02.19.10.49.57;	author niklas;	state Exp;
branches;
next	;


desc
@@


1.14
log
@- Add missing tick handler calling mii_tick().
- Stop hmestop() from fiddling with the flags directly and
  calls mii_down() instead.

From Brad, tested by nick@@.
@
text
@/*	$OpenBSD: hmevar.h,v 1.13 2009/06/24 07:42:03 sthen Exp $	*/

/*
 * Copyright (c) 1998 Jason L. Wright (jason@@thought.net)
 * All rights reserved.
 *
 * Redistribution and use in source and binary forms, with or without
 * modification, are permitted provided that the following conditions
 * are met:
 * 1. Redistributions of source code must retain the above copyright
 *    notice, this list of conditions and the following disclaimer.
 * 2. Redistributions in binary form must reproduce the above copyright
 *    notice, this list of conditions and the following disclaimer in the
 *    documentation and/or other materials provided with the distribution.
 *
 * THIS SOFTWARE IS PROVIDED BY THE AUTHOR ``AS IS'' AND ANY EXPRESS OR
 * IMPLIED WARRANTIES, INCLUDING, BUT NOT LIMITED TO, THE IMPLIED
 * WARRANTIES OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE ARE
 * DISCLAIMED.  IN NO EVENT SHALL THE AUTHOR BE LIABLE FOR ANY DIRECT,
 * INDIRECT, INCIDENTAL, SPECIAL, EXEMPLARY, OR CONSEQUENTIAL DAMAGES
 * (INCLUDING, BUT NOT LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR
 * SERVICES; LOSS OF USE, DATA, OR PROFITS; OR BUSINESS INTERRUPTION)
 * HOWEVER CAUSED AND ON ANY THEORY OF LIABILITY, WHETHER IN CONTRACT,
 * STRICT LIABILITY, OR TORT (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN
 * ANY WAY OUT OF THE USE OF THIS SOFTWARE, EVEN IF ADVISED OF THE
 * POSSIBILITY OF SUCH DAMAGE.
 */

struct hme_softc {
	struct	device sc_dev;		/* base device */
	struct	intrhand sc_ih;		/* interrupt vectoring */
	int	sc_node;		/* which sbus node */

	mii_data_t	sc_mii;		/* mii bus */
	struct timeout	sc_tick;	/* tick timeout */

	struct	arpcom sc_arpcom;	/* ethernet common */

	/*
	 * Register sets
	 */
	struct	hme_gr *sc_gr;		/* global registers */
	struct	hme_txr *sc_txr;	/* transmitter regs */
	struct	hme_rxr *sc_rxr;	/* receiver registers */
	struct	hme_cr *sc_cr;		/* configuration registers */
	struct	hme_tcvr *sc_tcvr;	/* MIF registers */

	int	sc_burst;		/* DMA burst size in effect */
	int	sc_rev;			/* Card revision */

	u_int32_t	sc_flags;	/* status flags	*/

	/*
	 * RX/TX ring buffers, descriptors, and counters
	 */
	struct	hme_desc *sc_desc, *sc_desc_dva;	/* ring descriptors */
	struct	hme_bufs *sc_bufs, *sc_bufs_dva;	/* packet buffers */
	int	sc_first_td, sc_last_td, sc_no_td;	/* tx counters */
	int	sc_last_rd;				/* rx counters */
};
@


1.13
log
@Simplify the ioctl handling code. From Brad.
Tested by nick@@
@
text
@d1 1
a1 1
/*	$OpenBSD: hmevar.h,v 1.12 2006/06/02 20:00:54 miod Exp $	*/
d35 1
@


1.12
log
@sbus_establish() and the associated linked list in the sbus softc is now only
used to store a per-device reset callback, for use in sbusreset(). Except
sbusreset() has never, ever, been used since Torek's sbus code went in.
Time to recycle those wasted bits.
@
text
@d1 1
a1 1
/*	$OpenBSD: hmevar.h,v 1.11 2004/09/28 00:21:23 brad Exp $	*/
a50 2

	short		sc_if_flags;
@


1.11
log
@- Use ETHER_MAX_LEN + ETHER_VLAN_ENCAP_LEN instead of HME_MTU
- Use ETHER_CRC_POLY_LE instead of MC_POLY_LE from hmereg.h
@
text
@d1 1
a1 1
/*	$OpenBSD: hmevar.h,v 1.10 2004/08/08 19:01:20 brad Exp $	*/
a30 1
	struct	sbusdev sc_sd;		/* sbus device */
@


1.10
log
@do not reset the chip (and subsequently the phy) when unnecessary; that is,
for address changes, multicast filter changes, or adjusting promiscuous mode.
Fixes resetting the phy for things like start/stopping tcpdump.

From NetBSD
tested by me, miod@@, otto@@ and a few others.

ok deraadt@@
@
text
@d1 1
a1 1
/*	$OpenBSD: hmevar.h,v 1.9 2003/06/18 19:13:01 jason Exp $	*/
a62 7

#ifndef	EVL_ENCAPLEN	/* defined if NVLAN > 0 */
#define	EVL_ENCAPLEN	0
#endif
 
#define	HME_MTU		\
    (ETHERMTU + EVL_ENCAPLEN + sizeof(u_int32_t) + sizeof(struct ether_header))
@


1.9
log
@oops, missed this part of the hme vlan stuff
@
text
@d1 1
a1 1
/*	$OpenBSD: hmevar.h,v 1.8 2003/06/02 18:40:59 jason Exp $	*/
d52 2
@


1.8
log
@nuke my clause 3 & 4 (and a couple jointly (c) with Theo).
@
text
@d1 1
a1 1
/*	$OpenBSD: hmevar.h,v 1.7 2000/06/18 17:39:17 jason Exp $	*/
d61 7
@


1.7
log
@remove unused junk
@
text
@d1 1
a1 1
/*	$OpenBSD: hmevar.h,v 1.6 1999/02/23 23:44:49 jason Exp $	*/
a14 5
 * 3. All advertising materials mentioning features or use of this software
 *    must display the following acknowledgement:
 *	This product includes software developed by Jason L. Wright
 * 4. The name of the author may not be used to endorse or promote products
 *    derived from this software without specific prior written permission.
@


1.6
log
@better promisc and allmulti handling
@
text
@d1 1
a1 1
/*	$OpenBSD: hmevar.h,v 1.5 1998/09/10 17:34:32 jason Exp $	*/
a52 1
	struct	hme_swr sc_sw;		/* software copy registers */
@


1.6.6.1
log
@Continue the aborted merge of current just before 2.9 was cut into the
SMP branch.  Note that this will not make any progress of SMP functionality,
it is just merging of new code from the trunk into the old branch.
Please do not ask me questions about SMP status because of this mail,
instead go read the archives of smp@@openbsd.org, where I mailed about
these commits some week ago.  Another note: I am doing this in chunks now,
so as to not lock too much of the tree for long times
@
text
@d1 1
a1 1
/*	$OpenBSD: hmevar.h,v 1.7 2000/06/18 17:39:17 jason Exp $	*/
d53 1
@


1.6.6.2
log
@Sync SMP branch to -current
@
text
@d1 1
a1 1
/*	$OpenBSD: hmevar.h,v 1.6.6.1 2001/05/14 21:37:06 niklas Exp $	*/
d15 5
@


1.6.6.3
log
@Merge of current from two weeks agointo the SMP branch
@
text
@d1 1
a1 1
/*	$OpenBSD$	*/
a60 7

#ifndef	EVL_ENCAPLEN	/* defined if NVLAN > 0 */
#define	EVL_ENCAPLEN	0
#endif
 
#define	HME_MTU		\
    (ETHERMTU + EVL_ENCAPLEN + sizeof(u_int32_t) + sizeof(struct ether_header))
@


1.5
log
@Modified to use mii layer for hme
@
text
@d1 1
a1 1
/*	$OpenBSD: hmevar.h,v 1.4 1998/09/08 04:48:38 jason Exp $	*/
a57 1
	u_int32_t	sc_promisc;	/* are we promiscuous? */
@


1.4
log
@o hme get ifmedia support
o nuked manual negotiatie that wasn't finished anyway in favor of if_media
@
text
@d1 1
a1 1
/*	$OpenBSD: hmevar.h,v 1.3 1998/09/01 17:36:59 jason Exp $	*/
d39 3
a41 1
	struct	ifmedia sc_ifmedia;	/* interface media */
a58 4
	u_int32_t	sc_phyaddr;	/* PHY addr */
	int		sc_an_state;	/* state of negotiation */
	int		sc_an_ticks;	/* how long has passed? */
	int		sc_tcvr_type;	/* transceiver type */
@


1.3
log
@o Removed dependence on stp2002 (not sharable with qec+be)
o Added collision counters
o Should work on sun4c
@
text
@d1 1
a1 1
/*	$OpenBSD: hmevar.h,v 1.2 1998/07/17 21:33:10 jason Exp $	*/
d39 2
a40 1
	struct	arpcom sc_arpcom;
@


1.2
log
@Moved most of the DMA functions to a chipset driver so that
'hme' and 'be' can share the same logic.
@
text
@d1 1
a1 1
/*	$OpenBSD: hmevar.h,v 1.1 1998/07/10 19:09:12 jason Exp $	*/
d39 1
d64 4
a67 1
	struct	stp_base sc_stp;
@


1.1
log
@hme (Happy Meal) ethernet driver.
@
text
@d1 1
a1 1
/*	$OpenBSD$	*/
a35 1
	struct	arpcom sc_arpcom;	/* ethernet common */
d63 1
a63 4
	struct	hme_desc *sc_desc, *sc_desc_dva;	/* descriptors */
	struct	hme_bufs *sc_bufs, *sc_bufs_dva;	/* buffers */
	int	sc_first_td, sc_last_td, sc_no_td;	/* tx counters */
	int	sc_last_rd;				/* rx counter */
@

