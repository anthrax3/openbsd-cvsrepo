head	1.10;
access;
symbols
	OPENBSD_6_0:1.9.0.24
	OPENBSD_6_0_BASE:1.9
	OPENBSD_5_9:1.9.0.20
	OPENBSD_5_9_BASE:1.9
	OPENBSD_5_8:1.9.0.22
	OPENBSD_5_8_BASE:1.9
	OPENBSD_5_7:1.9.0.14
	OPENBSD_5_7_BASE:1.9
	OPENBSD_5_6:1.9.0.18
	OPENBSD_5_6_BASE:1.9
	OPENBSD_5_5:1.9.0.16
	OPENBSD_5_5_BASE:1.9
	OPENBSD_5_4:1.9.0.12
	OPENBSD_5_4_BASE:1.9
	OPENBSD_5_3:1.9.0.10
	OPENBSD_5_3_BASE:1.9
	OPENBSD_5_2:1.9.0.8
	OPENBSD_5_2_BASE:1.9
	OPENBSD_5_1_BASE:1.9
	OPENBSD_5_1:1.9.0.6
	OPENBSD_5_0:1.9.0.4
	OPENBSD_5_0_BASE:1.9
	OPENBSD_4_9:1.9.0.2
	OPENBSD_4_9_BASE:1.9
	OPENBSD_4_8:1.8.0.18
	OPENBSD_4_8_BASE:1.8
	OPENBSD_4_7:1.8.0.14
	OPENBSD_4_7_BASE:1.8
	OPENBSD_4_6:1.8.0.16
	OPENBSD_4_6_BASE:1.8
	OPENBSD_4_5:1.8.0.12
	OPENBSD_4_5_BASE:1.8
	OPENBSD_4_4:1.8.0.10
	OPENBSD_4_4_BASE:1.8
	OPENBSD_4_3:1.8.0.8
	OPENBSD_4_3_BASE:1.8
	OPENBSD_4_2:1.8.0.6
	OPENBSD_4_2_BASE:1.8
	OPENBSD_4_1:1.8.0.4
	OPENBSD_4_1_BASE:1.8
	OPENBSD_4_0:1.8.0.2
	OPENBSD_4_0_BASE:1.8
	OPENBSD_3_9:1.7.0.6
	OPENBSD_3_9_BASE:1.7
	OPENBSD_3_8:1.7.0.4
	OPENBSD_3_8_BASE:1.7
	OPENBSD_3_7:1.7.0.2
	OPENBSD_3_7_BASE:1.7
	OPENBSD_3_6:1.5.0.34
	OPENBSD_3_6_BASE:1.5
	SMP_SYNC_A:1.5
	SMP_SYNC_B:1.5
	OPENBSD_3_5:1.5.0.32
	OPENBSD_3_5_BASE:1.5
	OPENBSD_3_4:1.5.0.30
	OPENBSD_3_4_BASE:1.5
	UBC_SYNC_A:1.5
	OPENBSD_3_3:1.5.0.28
	OPENBSD_3_3_BASE:1.5
	OPENBSD_3_2:1.5.0.26
	OPENBSD_3_2_BASE:1.5
	OPENBSD_3_1:1.5.0.24
	OPENBSD_3_1_BASE:1.5
	UBC_SYNC_B:1.5
	UBC:1.5.0.22
	UBC_BASE:1.5
	OPENBSD_3_0:1.5.0.20
	OPENBSD_3_0_BASE:1.5
	OPENBSD_2_9_BASE:1.5
	OPENBSD_2_9:1.5.0.18
	OPENBSD_2_8:1.5.0.16
	OPENBSD_2_8_BASE:1.5
	OPENBSD_2_7:1.5.0.14
	OPENBSD_2_7_BASE:1.5
	SMP:1.5.0.12
	SMP_BASE:1.5
	kame_19991208:1.5
	OPENBSD_2_6:1.5.0.10
	OPENBSD_2_6_BASE:1.5
	OPENBSD_2_5:1.5.0.8
	OPENBSD_2_5_BASE:1.5
	OPENBSD_2_4:1.5.0.6
	OPENBSD_2_4_BASE:1.5
	OPENBSD_2_3:1.5.0.4
	OPENBSD_2_3_BASE:1.5
	OPENBSD_2_2:1.5.0.2
	OPENBSD_2_2_BASE:1.5
	OPENBSD_2_1:1.4.0.4
	OPENBSD_2_1_BASE:1.4
	OPENBSD_2_0:1.4.0.2
	OPENBSD_2_0_BASE:1.4
	netbsd_1_1:1.1.1.1;
locks; strict;
comment	@ * @;


1.10
date	2016.09.01.09.23.42;	author tedu;	state dead;
branches;
next	1.9;
commitid	Q2PxaFNhqAe0Wmla;

1.9
date	2010.08.17.20.05.06;	author miod;	state Exp;
branches;
next	1.8;

1.8
date	2006.08.17.01.37.41;	author krw;	state Exp;
branches;
next	1.7;

1.7
date	2004.09.29.07.35.11;	author miod;	state Exp;
branches;
next	1.6;

1.6
date	2004.09.22.22.12.58;	author miod;	state Exp;
branches;
next	1.5;

1.5
date	97.06.24.09.50.57;	author downsj;	state Exp;
branches;
next	1.4;

1.4
date	96.08.11.23.16.36;	author downsj;	state Exp;
branches;
next	1.3;

1.3
date	96.08.11.05.34.19;	author deraadt;	state Exp;
branches;
next	1.2;

1.2
date	95.10.19.11.23.14;	author deraadt;	state Exp;
branches;
next	1.1;

1.1
date	95.10.18.08.51.39;	author deraadt;	state Exp;
branches
	1.1.1.1;
next	;

1.1.1.1
date	95.10.18.08.51.39;	author deraadt;	state Exp;
branches;
next	;


desc
@@


1.10
log
@Celebrate OpenBSD 6.0 release by retiring the sparc port.
You've served us well, good friend, but now it's time to rest.
ok deraadt
@
text
@/*	$OpenBSD: fdvar.h,v 1.9 2010/08/17 20:05:06 miod Exp $	*/
/*
 *	$NetBSD: fdvar.h,v 1.5 1996/12/08 23:40:34 pk Exp $
 *
 * Copyright (c) 1995 Paul Kranenburg
 * All rights reserved.
 *
 * Redistribution and use in source and binary forms, with or without
 * modification, are permitted provided that the following conditions
 * are met:
 * 1. Redistributions of source code must retain the above copyright
 *    notice, this list of conditions and the following disclaimer.
 * 2. Redistributions in binary form must reproduce the above copyright
 *    notice, this list of conditions and the following disclaimer in the
 *    documentation and/or other materials provided with the distribution.
 * 3. All advertising materials mentioning features or use of this software
 *    must display the following acknowledgement:
 *      This product includes software developed by Paul Kranenburg.
 * 4. The name of the author may not be used to endorse or promote products
 *    derived from this software without specific prior written permission
 *
 * THIS SOFTWARE IS PROVIDED BY THE AUTHOR ``AS IS'' AND ANY EXPRESS OR
 * IMPLIED WARRANTIES, INCLUDING, BUT NOT LIMITED TO, THE IMPLIED WARRANTIES
 * OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE ARE DISCLAIMED.
 * IN NO EVENT SHALL THE AUTHOR BE LIABLE FOR ANY DIRECT, INDIRECT,
 * INCIDENTAL, SPECIAL, EXEMPLARY, OR CONSEQUENTIAL DAMAGES (INCLUDING, BUT
 * NOT LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES; LOSS OF USE,
 * DATA, OR PROFITS; OR BUSINESS INTERRUPTION) HOWEVER CAUSED AND ON ANY
 * THEORY OF LIABILITY, WHETHER IN CONTRACT, STRICT LIABILITY, OR TORT
 * (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE USE OF
 * THIS SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.
 *
 */

#define	FD_BSIZE(fd)	(128 << fd->sc_type->secsize)
#define	FDC_MAXIOSIZE	NBPG	/* XXX should be MAXBSIZE */

#define FDC_NSTATUS	10

#ifndef _LOCORE
struct fdcio {
	/*
	 * 82072 (sun4c) and 82077 (sun4m) controllers have different
	 * register layout; so we cache some here.
	 */
	volatile u_int8_t	*fdcio_reg_msr;
	volatile u_int8_t	*fdcio_reg_fifo;
	volatile u_int8_t	*fdcio_reg_dor;	/* 82077 only */

	/*
	 * Interrupt state.
	 */
	int	fdcio_itask;
	int	fdcio_istatus;

	/*
	 * IO state.
	 */
	char	*fdcio_data;		/* pseudo-dma data */
	int	fdcio_tc;		/* pseudo-dma Terminal Count */
	u_char	fdcio_status[FDC_NSTATUS];	/* copy of registers */
	int	fdcio_nstat;		/* # of valid status bytes */

	struct	intrhand fdcio_ih;
	void		*fdcio_sih;	/* softintr cookie */
};
#endif /* _LOCORE */

/* itask values */
#define FDC_ITASK_NONE		0	/* No HW interrupt expected */
#define FDC_ITASK_SENSEI	1	/* Do SENSEI on next HW interrupt */
#define FDC_ITASK_DMA		2	/* Do Pseudo-DMA */
#define FDC_ITASK_RESULT	3	/* Pick up command results */

/* istatus values */
#define FDC_ISTATUS_NONE	0	/* No status available */
#define FDC_ISTATUS_SPURIOUS	1	/* Spurious HW interrupt detected */
#define FDC_ISTATUS_ERROR	2	/* Operation completed abnormally */
#define FDC_ISTATUS_DONE	3	/* Operation completed normally */

#define SUNOS_FDIOCEJECT	_IO('f', 24)
@


1.9
log
@Make sure fast trap handlers correctly invoke soft interrupts by marking
them explicitely pending before triggering the softintr; I am ashamed I did
not notice this when changing the soft interrupt code 18 months ago.
Noticed by claudio@@ and beck@@
@
text
@d1 1
a1 1
/*	$OpenBSD: fdvar.h,v 1.8 2006/08/17 01:37:41 krw Exp $	*/
@


1.8
log
@(128 << fd->sc_type->secsize) instead of (128 * (1 << fd->sc_type->secsize)).

Makes all FD_BSIZE() defines the same. No object code change.
@
text
@d1 1
a1 1
/*	$OpenBSD: fdvar.h,v 1.7 2004/09/29 07:35:11 miod Exp $	*/
d65 1
@


1.7
log
@Switch sparc to evcount; ok deraadt@@
@
text
@d1 1
a1 1
/*	$OpenBSD: fdvar.h,v 1.6 2004/09/22 22:12:58 miod Exp $	*/
d35 1
a35 1
#define	FD_BSIZE(fd)	(128 * (1 << fd->sc_type->secsize))
@


1.6
log
@Bring some enhancements and fixes to fdc(4) from NetBSD:
- better state machine, will prevent "eject fd0" with an empty drive to
  spin.
- will not attach fd children to fdc if no floppy drive is present (though
  the PROM usually finds this for us).
- use biowait() in fdformat() instead of rolling our own.
- drop 5"1/4 formats table.
- cope with non 512 bytes per sector formats.
@
text
@d1 1
a1 1
/*	$OpenBSD: fdvar.h,v 1.5 1997/06/24 09:50:57 downsj Exp $	*/
d64 1
a64 4
	/*
	 * Statictics.
	 */
	struct	evcnt fdcio_intrcnt;
@


1.5
log
@New floppy and auxreg drivers, from NetBSD.  fd.c has many changes preserved,
and uses our fdformat interface (same code base as NetBSD, with differently
named ioctls, but we have always preserved the names of the original code's
authors, unlike NetBSD...)
@
text
@d1 1
a1 1
/*	$OpenBSD$	*/
d35 1
a35 1
#define	FDC_BSIZE	512
d53 2
a54 1
	int	fdcio_istate;
d71 11
a81 6
/* istate values */
#define ISTATE_IDLE		0	/* No HW interrupt expected */
#define ISTATE_SPURIOUS		1	/* Spurious HW interrupt detected */
#define ISTATE_SENSEI		2	/* Do SENSEI on next HW interrupt */
#define ISTATE_DMA		3	/* Pseudo-DMA in progress */
#define ISTATE_DONE		4	/* Interrupt processing complete */
a83 1

@


1.4
log
@Merge back revision 1.2.
@
text
@d3 1
a3 1
 *	$NetBSD: fdvar.h,v 1.4 1996/02/01 22:32:29 mycroft Exp $
d75 1
@


1.3
log
@netbsd port, now we merge our changes back in
@
text
@d1 1
d66 1
a66 1
	struct	evcnt	fdcio_intrcnt;
d76 1
a76 1
#define FDIOCEJECT	_IO('f', 24)
@


1.2
log
@intr counter; mtio offline
@
text
@d2 1
a2 1
 *	$NetBSD: fdvar.h,v 1.3 1995/04/07 19:46:15 pk Exp $
d39 1
a39 1
#if !defined(LOCORE)
d65 1
a65 1
	struct	evcnt fdcio_intrcnt;
d67 1
a67 1
#endif /* LOCORE */
d75 1
a75 1
#define SUNOS_FDIOCEJECT	_IO('f', 24)
@


1.1
log
@Initial revision
@
text
@d65 1
a65 1
	struct	evcnt	fdcio_intrcnt;
d75 1
a75 1
#define FDIOCEJECT	_IO('f', 24)
@


1.1.1.1
log
@initial import of NetBSD tree
@
text
@@
