head	1.14;
access;
symbols
	SMP_SYNC_A:1.14
	SMP_SYNC_B:1.14
	UBC_SYNC_A:1.14
	OPENBSD_3_2:1.13.0.4
	OPENBSD_3_2_BASE:1.13
	OPENBSD_3_1:1.13.0.2
	OPENBSD_3_1_BASE:1.13
	UBC_SYNC_B:1.13
	UBC:1.12.0.2
	UBC_BASE:1.12
	OPENBSD_3_0:1.9.0.2
	OPENBSD_3_0_BASE:1.9
	OPENBSD_2_9_BASE:1.7
	OPENBSD_2_9:1.7.0.20
	OPENBSD_2_8:1.7.0.18
	OPENBSD_2_8_BASE:1.7
	OPENBSD_2_7:1.7.0.16
	OPENBSD_2_7_BASE:1.7
	SMP:1.7.0.14
	SMP_BASE:1.7
	kame_19991208:1.7
	OPENBSD_2_6:1.7.0.12
	OPENBSD_2_6_BASE:1.7
	OPENBSD_2_5:1.7.0.10
	OPENBSD_2_5_BASE:1.7
	OPENBSD_2_4:1.7.0.8
	OPENBSD_2_4_BASE:1.7
	OPENBSD_2_3:1.7.0.6
	OPENBSD_2_3_BASE:1.7
	OPENBSD_2_2:1.7.0.4
	OPENBSD_2_2_BASE:1.7
	OPENBSD_2_1:1.7.0.2
	OPENBSD_2_1_BASE:1.7
	OPENBSD_2_0:1.2.0.2
	OPENBSD_2_0_BASE:1.2
	netbsd_1_1:1.1.1.1;
locks; strict;
comment	@ * @;


1.14
date	2002.12.31.16.35.40;	author miod;	state dead;
branches;
next	1.13;

1.13
date	2002.03.14.01.26.46;	author millert;	state Exp;
branches;
next	1.12;

1.12
date	2001.12.05.00.11.51;	author millert;	state Exp;
branches
	1.12.2.1;
next	1.11;

1.11
date	2001.11.28.16.13.29;	author art;	state Exp;
branches;
next	1.10;

1.10
date	2001.11.28.15.34.17;	author art;	state Exp;
branches;
next	1.9;

1.9
date	2001.08.18.20.50.18;	author art;	state Exp;
branches;
next	1.8;

1.8
date	2001.05.30.20.39.59;	author miod;	state Exp;
branches;
next	1.7;

1.7
date	97.02.19.00.03.34;	author kstailey;	state Exp;
branches
	1.7.14.1;
next	1.6;

1.6
date	97.01.16.04.04.09;	author kstailey;	state Exp;
branches;
next	1.5;

1.5
date	97.01.07.23.36.20;	author kstailey;	state Exp;
branches;
next	1.4;

1.4
date	96.12.31.06.13.18;	author kstailey;	state Exp;
branches;
next	1.3;

1.3
date	96.11.23.08.25.58;	author kstailey;	state Exp;
branches;
next	1.2;

1.2
date	96.05.03.16.03.53;	author mickey;	state Exp;
branches;
next	1.1;

1.1
date	95.10.18.08.51.55;	author deraadt;	state Exp;
branches
	1.1.1.1;
next	;

1.1.1.1
date	95.10.18.08.51.55;	author deraadt;	state Exp;
branches;
next	;

1.7.14.1
date	2001.07.04.10.24.03;	author niklas;	state Exp;
branches;
next	1.7.14.2;

1.7.14.2
date	2001.10.31.03.08.00;	author nate;	state Exp;
branches;
next	1.7.14.3;

1.7.14.3
date	2001.12.05.00.39.14;	author niklas;	state Exp;
branches;
next	1.7.14.4;

1.7.14.4
date	2002.03.06.02.04.47;	author niklas;	state Exp;
branches;
next	1.7.14.5;

1.7.14.5
date	2002.03.28.11.26.45;	author niklas;	state Exp;
branches;
next	1.7.14.6;

1.7.14.6
date	2003.03.27.23.52.18;	author niklas;	state dead;
branches;
next	;

1.12.2.1
date	2002.06.11.03.39.01;	author art;	state Exp;
branches;
next	1.12.2.2;

1.12.2.2
date	2003.05.19.21.49.45;	author tedu;	state dead;
branches;
next	;


desc
@@


1.14
log
@amiga and sun3 turned out to not be y2k+3 compliant here. Remove them, as
well as the few userland tools which were only used on these platforms.
@
text
@/*	$OpenBSD: pmap.h,v 1.13 2002/03/14 01:26:46 millert Exp $	*/
/*	$NetBSD: pmap.h,v 1.18 1997/01/27 19:41:06 gwr Exp $	*/

/*-
 * Copyright (c) 1996 The NetBSD Foundation, Inc.
 * All rights reserved.
 *
 * This code is derived from software contributed to The NetBSD Foundation
 * by Adam Glass and Gordon W. Ross.
 *
 * Redistribution and use in source and binary forms, with or without
 * modification, are permitted provided that the following conditions
 * are met:
 * 1. Redistributions of source code must retain the above copyright
 *    notice, this list of conditions and the following disclaimer.
 * 2. Redistributions in binary form must reproduce the above copyright
 *    notice, this list of conditions and the following disclaimer in the
 *    documentation and/or other materials provided with the distribution.
 * 3. All advertising materials mentioning features or use of this software
 *    must display the following acknowledgement:
 *        This product includes software developed by the NetBSD
 *        Foundation, Inc. and its contributors.
 * 4. Neither the name of The NetBSD Foundation nor the names of its
 *    contributors may be used to endorse or promote products derived
 *    from this software without specific prior written permission.
 *
 * THIS SOFTWARE IS PROVIDED BY THE NETBSD FOUNDATION, INC. AND CONTRIBUTORS
 * ``AS IS'' AND ANY EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT LIMITED
 * TO, THE IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR
 * PURPOSE ARE DISCLAIMED.  IN NO EVENT SHALL THE FOUNDATION OR CONTRIBUTORS
 * BE LIABLE FOR ANY DIRECT, INDIRECT, INCIDENTAL, SPECIAL, EXEMPLARY, OR
 * CONSEQUENTIAL DAMAGES (INCLUDING, BUT NOT LIMITED TO, PROCUREMENT OF
 * SUBSTITUTE GOODS OR SERVICES; LOSS OF USE, DATA, OR PROFITS; OR BUSINESS
 * INTERRUPTION) HOWEVER CAUSED AND ON ANY THEORY OF LIABILITY, WHETHER IN
 * CONTRACT, STRICT LIABILITY, OR TORT (INCLUDING NEGLIGENCE OR OTHERWISE)
 * ARISING IN ANY WAY OUT OF THE USE OF THIS SOFTWARE, EVEN IF ADVISED OF THE
 * POSSIBILITY OF SUCH DAMAGE.
 */

#ifndef	_MACHINE_PMAP_
#define	_MACHINE_PMAP_

/*
 * Physical map structures exported to the VM code.
 */

struct pmap {
	int	                pm_refcount;	/* pmap reference count */
	struct simplelock	pm_lock;	/* lock on pmap */
	struct pmap_statistics	pm_stats;	/* pmap statistics */
	int                     pm_version;
	int                     pm_ctxnum;
	unsigned char           *pm_segmap;
};

typedef struct pmap *pmap_t;

#ifdef _KERNEL
extern struct pmap	kernel_pmap_store;
#define	pmap_kernel()			(&kernel_pmap_store)

/* This is called from locore.s:cpu_switch() */
void pmap_switch(pmap_t pmap);

/* This lets us have some say in choosing VA locations. */
extern void pmap_prefer(vm_offset_t, vm_offset_t *);
#define PMAP_PREFER(fo, ap) pmap_prefer((fo), (ap))

/* This needs to be a macro to get code in kern_sysctl.c */
extern segsz_t pmap_resident_pages(pmap_t);
#define	pmap_resident_count(pmap)	pmap_resident_pages(pmap)

#define pmap_update(pmap)	/* nothing (yet) */

/*
 * Since PTEs also contain type bits, we have to have some way
 * to tell pmap_enter `this is an IO page' or `this is not to
 * be cached'.  Since physical addresses are always aligned, we
 * can do this with the low order bits.
 *
 * The values below must agree with pte.h such that:
 *	(PMAP_OBIO << PG_MOD_SHIFT) == PGT_OBIO
 */
#define	PMAP_OBIO	0x04		/* tells pmap_enter to use PG_OBIO */
#define	PMAP_VME16	0x08		/* etc */
#define	PMAP_VME32	0x0C		/* etc */
#define	PMAP_NC		0x10		/* tells pmap_enter to set PG_NC */
#define	PMAP_SPEC	0x1C		/* mask to get all above. */

#endif	/* _KERNEL */
#endif	/* _MACHINE_PMAP_ */
@


1.13
log
@First round of __P removal in sys
@
text
@d1 1
a1 1
/*	$OpenBSD: pmap.h,v 1.12 2001/12/05 00:11:51 millert Exp $	*/
@


1.12
log
@Update pmap_update macro for arches Art missed.  Still just a noop.
@
text
@d1 1
a1 1
/*	$OpenBSD: pmap.h,v 1.11 2001/11/28 16:13:29 art Exp $	*/
d63 1
a63 1
void pmap_switch __P((pmap_t pmap));
@


1.12.2.1
log
@Sync UBC branch to -current
@
text
@d1 1
a1 1
/*	$OpenBSD: pmap.h,v 1.12 2001/12/05 00:11:51 millert Exp $	*/
d63 1
a63 1
void pmap_switch(pmap_t pmap);
@


1.12.2.2
log
@sync
@
text
@d1 1
a1 1
/*	$OpenBSD: pmap.h,v 1.12.2.1 2002/06/11 03:39:01 art Exp $	*/
@


1.11
log
@zap some typedefs.
vm_map_t -> struct vm_map *
vm_map_entry_t -> struct vm_map_entry *
simple_lock_data_t -> struct simplelock

(uvm not done yet, coming in the next commit)
@
text
@d1 1
a1 1
/*	$OpenBSD: pmap.h,v 1.10 2001/11/28 15:34:17 art Exp $	*/
d73 1
a73 1
#define pmap_update()		/* nothing */
@


1.10
log
@Make pmap_update functions into nops so that we can have a consistent
pmap_update API (right now it's nop).
@
text
@d1 1
a1 1
/*	$OpenBSD: pmap.h,v 1.9 2001/08/18 20:50:18 art Exp $	*/
d49 1
a49 1
	simple_lock_data_t      pm_lock;	/* lock on pmap */
@


1.9
log
@Move pmap_{de,}activate to vm/pmap.h, it's same on all archs.
@
text
@d1 1
a1 1
/*	$OpenBSD: pmap.h,v 1.8 2001/05/30 20:39:59 miod Exp $	*/
d72 2
@


1.8
log
@Preliminary UVM support. UVM kernels don't work for the moment, though.
@
text
@d1 1
a1 1
/*	$OpenBSD: pmap.h,v 1.7 1997/02/19 00:03:34 kstailey Exp $	*/
a63 3

void pmap_activate __P((struct proc *));
void pmap_deactivate __P((struct proc *));
@


1.7
log
@merge in some NetBSD pmap code
@
text
@d1 1
a1 1
/*	$OpenBSD: pmap.h,v 1.6 1997/01/16 04:04:09 kstailey Exp $	*/
d63 4
a66 1
void pmap_activate   __P((pmap_t pmap));
@


1.7.14.1
log
@Merge in -current from two days ago in the SMP branch.
As usual with merges, they do not indicate progress, so do not hold
your breath for working SMP, and do not mail me and ask about the
state of it.  It has not changed.  There is work ongoing, but very, very
slowly.  The commit is done in parts as to not lock up the tree in too
big chunks at a time.
@
text
@d1 1
a1 1
/*	$OpenBSD: pmap.h,v 1.7 1997/02/19 00:03:34 kstailey Exp $	*/
d63 1
a63 4
void pmap_switch __P((pmap_t pmap));

void pmap_activate __P((struct proc *));
void pmap_deactivate __P((struct proc *));
@


1.7.14.2
log
@Sync the SMP branch to something just after 3.0
@
text
@d1 1
a1 1
/*	$OpenBSD: pmap.h,v 1.7.14.1 2001/07/04 10:24:03 niklas Exp $	*/
d64 3
@


1.7.14.3
log
@Merge in -current
@
text
@d1 1
a1 1
/*	$OpenBSD: pmap.h,v 1.7.14.2 2001/10/31 03:08:00 nate Exp $	*/
d49 1
a49 1
	struct simplelock	pm_lock;	/* lock on pmap */
a71 2

#define pmap_update()		/* nothing */
@


1.7.14.4
log
@Merge in trunk
@
text
@d1 1
a1 1
/*	$OpenBSD$	*/
d73 1
a73 1
#define pmap_update(pmap)	/* nothing (yet) */
@


1.7.14.5
log
@Merge in -current from about a week ago
@
text
@d63 1
a63 1
void pmap_switch(pmap_t pmap);
@


1.7.14.6
log
@Sync the SMP branch with 3.3
@
text
@d1 1
a1 1
/*	$OpenBSD: pmap.h,v 1.7.14.5 2002/03/28 11:26:45 niklas Exp $	*/
@


1.6
log
@all modified code can now compile with -Werror -Wall -Wstrict-prototypes
CAVEAT: turning off -O2 produces warnings about "defined but not used"
        functions from libkern.h

removed internal copy of gets() replaced with call to getsn()

fixed #ifdef ... #endif mismatch in swapgeneric.c

fixed printf() in if_ie.c that was missing an argument

fixed si.c so that it compiles

added tags to all edited files
@
text
@d1 2
a2 2
/*	$OpenBSD$	*/
/*	$NetBSD: pmap.h,v 1.15 1996/11/20 18:57:16 gwr Exp $	*/
d30 2
a31 2
 * PURPOSE ARE DISCLAIMED.  IN NO EVENT SHALL THE REGENTS OR CONTRIBUTORS BE
 * LIABLE FOR ANY DIRECT, INDIRECT, INCIDENTAL, SPECIAL, EXEMPLARY, OR
d59 1
a59 5
struct pmap	kernel_pmap_store;
struct pcb;
void pmap_activate   __P((pmap_t pmap, struct pcb *pcbp));
void pmap_deactivate __P((pmap_t pmap, struct pcb *pcbp));

d62 2
a63 4
#define PMAP_ACTIVATE(pmap, pcbp, iscurproc) \
	pmap_activate(pmap, pcbp)
#define PMAP_DEACTIVATE(pmap, pcbp) \
	pmap_deactivate(pmap, pcbp)
d65 1
d69 1
a69 1
/* XXX - Need a (silly) #define get code in kern_sysctl.c */
@


1.5
log
@backed out prev. netbsd merge except for smaller proc table
@
text
@d1 1
d60 3
@


1.4
log
@sync with 17-Dec-1996
@
text
@d1 1
a1 1
/*	$NetBSD: pmap.h,v 1.16 1996/12/17 21:11:10 gwr Exp $	*/
a58 3
struct pcb;
void   pmap_activate __P((pmap_t pmap, struct pcb *pcbp));
void pmap_deactivate __P((pmap_t pmap, struct pcb *pcbp));
@


1.3
log
@sync with NetBSD -- copyright changes only
@
text
@d1 1
a1 1
/*	$NetBSD: pmap.h,v 1.15 1996/11/20 18:57:16 gwr Exp $	*/
d59 3
@


1.2
log
@sync with 0430.
@
text
@d1 1
a1 1
/*	$NetBSD: pmap.h,v 1.14 1996/02/28 22:50:43 gwr Exp $	*/
d3 2
a4 3
/*
 * Copyright (c) 1994 Gordon W. Ross
 * Copyright (c) 1993 Adam Glass
d7 3
d20 5
a24 3
 *	This product includes software developed by Adam Glass.
 * 4. The name of the Authors may not be used to endorse or promote products
 *    derived from this software without specific prior written permission.
d26 11
a36 10
 * THIS SOFTWARE IS PROVIDED BY THE AUTHORS ``AS IS'' AND ANY EXPRESS OR
 * IMPLIED WARRANTIES, INCLUDING, BUT NOT LIMITED TO, THE IMPLIED WARRANTIES
 * OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE ARE DISCLAIMED.
 * IN NO EVENT SHALL THE AUTHORS BE LIABLE FOR ANY DIRECT, INDIRECT,
 * INCIDENTAL, SPECIAL, EXEMPLARY, OR CONSEQUENTIAL DAMAGES (INCLUDING, BUT
 * NOT LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES; LOSS OF USE,
 * DATA, OR PROFITS; OR BUSINESS INTERRUPTION) HOWEVER CAUSED AND ON ANY
 * THEORY OF LIABILITY, WHETHER IN CONTRACT, STRICT LIABILITY, OR TORT
 * (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE USE OF
 * THIS SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.
@


1.1
log
@Initial revision
@
text
@d1 1
a1 1
/*	$NetBSD: pmap.h,v 1.13 1995/04/10 12:42:29 mycroft Exp $	*/
d61 3
@


1.1.1.1
log
@initial import of NetBSD tree
@
text
@@
