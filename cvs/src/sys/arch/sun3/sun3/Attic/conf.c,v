head	1.34;
access;
symbols
	SMP_SYNC_A:1.34
	SMP_SYNC_B:1.34
	UBC_SYNC_A:1.34
	OPENBSD_3_2:1.32.0.2
	OPENBSD_3_2_BASE:1.32
	OPENBSD_3_1:1.31.0.4
	OPENBSD_3_1_BASE:1.31
	UBC_SYNC_B:1.32
	UBC:1.31.0.2
	UBC_BASE:1.31
	OPENBSD_3_0:1.30.0.2
	OPENBSD_3_0_BASE:1.30
	OPENBSD_2_9_BASE:1.27
	OPENBSD_2_9:1.27.0.4
	OPENBSD_2_8:1.27.0.2
	OPENBSD_2_8_BASE:1.27
	OPENBSD_2_7:1.24.0.2
	OPENBSD_2_7_BASE:1.24
	SMP:1.23.0.8
	SMP_BASE:1.23
	kame_19991208:1.23
	OPENBSD_2_6:1.23.0.6
	OPENBSD_2_6_BASE:1.23
	OPENBSD_2_5:1.23.0.4
	OPENBSD_2_5_BASE:1.23
	OPENBSD_2_4:1.23.0.2
	OPENBSD_2_4_BASE:1.23
	OPENBSD_2_3:1.20.0.6
	OPENBSD_2_3_BASE:1.20
	OPENBSD_2_2:1.20.0.4
	OPENBSD_2_2_BASE:1.20
	OPENBSD_2_1:1.20.0.2
	OPENBSD_2_1_BASE:1.20
	OPENBSD_2_0:1.8.0.2
	OPENBSD_2_0_BASE:1.8
	netbsd_1_1:1.1.1.1;
locks; strict;
comment	@ * @;


1.34
date	2002.12.31.16.35.41;	author miod;	state dead;
branches;
next	1.33;

1.33
date	2002.12.05.02.49.55;	author kjc;	state Exp;
branches;
next	1.32;

1.32
date	2002.05.16.21.11.18;	author miod;	state Exp;
branches;
next	1.31;

1.31
date	2001.12.11.23.19.02;	author miod;	state Exp;
branches
	1.31.2.1;
next	1.30;

1.30
date	2001.09.28.02.53.14;	author mickey;	state Exp;
branches;
next	1.29;

1.29
date	2001.06.27.06.56.30;	author kjc;	state Exp;
branches;
next	1.28;

1.28
date	2001.06.25.03.20.19;	author kjell;	state Exp;
branches;
next	1.27;

1.27
date	2000.09.26.14.03.55;	author art;	state Exp;
branches;
next	1.26;

1.26
date	2000.08.28.22.04.53;	author miod;	state Exp;
branches;
next	1.25;

1.25
date	2000.06.21.21.17.49;	author miod;	state Exp;
branches;
next	1.24;

1.24
date	2000.03.02.23.02.14;	author todd;	state Exp;
branches;
next	1.23;

1.23
date	98.09.25.09.20.54;	author todd;	state Exp;
branches
	1.23.8.1;
next	1.22;

1.22
date	98.07.07.06.56.12;	author deraadt;	state Exp;
branches;
next	1.21;

1.21
date	98.07.07.03.02.48;	author deraadt;	state Exp;
branches;
next	1.20;

1.20
date	97.02.22.21.09.15;	author kstailey;	state Exp;
branches;
next	1.19;

1.19
date	97.02.04.23.25.03;	author kstailey;	state Exp;
branches;
next	1.18;

1.18
date	97.01.16.04.04.14;	author kstailey;	state Exp;
branches;
next	1.17;

1.17
date	97.01.07.23.36.24;	author kstailey;	state Exp;
branches;
next	1.16;

1.16
date	96.12.31.06.13.34;	author kstailey;	state Exp;
branches;
next	1.15;

1.15
date	96.11.23.21.46.24;	author kstailey;	state Exp;
branches;
next	1.14;

1.14
date	96.11.23.07.55.06;	author kstailey;	state Exp;
branches;
next	1.13;

1.13
date	96.11.12.01.21.28;	author kstailey;	state Exp;
branches;
next	1.12;

1.12
date	96.11.11.23.51.39;	author kstailey;	state Exp;
branches;
next	1.11;

1.11
date	96.11.06.01.59.33;	author deraadt;	state Exp;
branches;
next	1.10;

1.10
date	96.10.19.12.51.20;	author mickey;	state Exp;
branches;
next	1.9;

1.9
date	96.10.11.23.07.02;	author deraadt;	state Exp;
branches;
next	1.8;

1.8
date	96.08.29.09.26.30;	author deraadt;	state Exp;
branches;
next	1.7;

1.7
date	96.07.15.14.57.08;	author mickey;	state Exp;
branches;
next	1.6;

1.6
date	96.05.03.16.04.26;	author mickey;	state Exp;
branches;
next	1.5;

1.5
date	96.01.31.06.41.20;	author deraadt;	state Exp;
branches;
next	1.4;

1.4
date	96.01.07.07.41.12;	author dm;	state Exp;
branches;
next	1.3;

1.3
date	95.12.14.05.27.04;	author deraadt;	state Exp;
branches;
next	1.2;

1.2
date	95.11.01.17.20.21;	author deraadt;	state Exp;
branches;
next	1.1;

1.1
date	95.10.18.08.52.00;	author deraadt;	state Exp;
branches
	1.1.1.1;
next	;

1.1.1.1
date	95.10.18.08.52.00;	author deraadt;	state Exp;
branches;
next	;

1.23.8.1
date	2000.03.24.09.08.55;	author niklas;	state Exp;
branches;
next	1.23.8.2;

1.23.8.2
date	2001.05.14.21.37.34;	author niklas;	state Exp;
branches;
next	1.23.8.3;

1.23.8.3
date	2001.07.04.10.24.07;	author niklas;	state Exp;
branches;
next	1.23.8.4;

1.23.8.4
date	2001.10.31.03.08.00;	author nate;	state Exp;
branches;
next	1.23.8.5;

1.23.8.5
date	2002.03.06.02.04.47;	author niklas;	state Exp;
branches;
next	1.23.8.6;

1.23.8.6
date	2003.03.27.23.52.18;	author niklas;	state dead;
branches;
next	;

1.31.2.1
date	2002.06.11.03.39.01;	author art;	state Exp;
branches;
next	1.31.2.2;

1.31.2.2
date	2003.05.19.21.49.46;	author tedu;	state dead;
branches;
next	;


desc
@@


1.34
log
@amiga and sun3 turned out to not be y2k+3 compliant here. Remove them, as
well as the few userland tools which were only used on these platforms.
@
text
@/*	$OpenBSD: conf.c,v 1.33 2002/12/05 02:49:55 kjc Exp $	*/
/*	$NetBSD: conf.c,v 1.51 1996/11/04 16:16:09 gwr Exp $	*/

/*-
 * Copyright (c) 1994 Adam Glass, Gordon W. Ross
 * Copyright (c) 1991, 1993
 *	The Regents of the University of California.  All rights reserved.
 *
 * Redistribution and use in source and binary forms, with or without
 * modification, are permitted provided that the following conditions
 * are met:
 * 1. Redistributions of source code must retain the above copyright
 *    notice, this list of conditions and the following disclaimer.
 * 2. Redistributions in binary form must reproduce the above copyright
 *    notice, this list of conditions and the following disclaimer in the
 *    documentation and/or other materials provided with the distribution.
 * 3. All advertising materials mentioning features or use of this software
 *    must display the following acknowledgement:
 *	This product includes software developed by the University of
 *	California, Berkeley and its contributors.
 * 4. Neither the name of the University nor the names of its contributors
 *    may be used to endorse or promote products derived from this software
 *    without specific prior written permission.
 *
 * THIS SOFTWARE IS PROVIDED BY THE REGENTS AND CONTRIBUTORS ``AS IS'' AND
 * ANY EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT LIMITED TO, THE
 * IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE
 * ARE DISCLAIMED.  IN NO EVENT SHALL THE REGENTS OR CONTRIBUTORS BE LIABLE
 * FOR ANY DIRECT, INDIRECT, INCIDENTAL, SPECIAL, EXEMPLARY, OR CONSEQUENTIAL
 * DAMAGES (INCLUDING, BUT NOT LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS
 * OR SERVICES; LOSS OF USE, DATA, OR PROFITS; OR BUSINESS INTERRUPTION)
 * HOWEVER CAUSED AND ON ANY THEORY OF LIABILITY, WHETHER IN CONTRACT, STRICT
 * LIABILITY, OR TORT (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY
 * OUT OF THE USE OF THIS SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF
 * SUCH DAMAGE.
 *
 *	@@(#)conf.c	8.2 (Berkeley) 11/14/93
 */

#include <sys/param.h>
#include <sys/systm.h>
#include <sys/buf.h>
#include <sys/ioctl.h>
#include <sys/tty.h>
#include <sys/conf.h>
#include <sys/vnode.h>

#include <machine/conf.h>

#include "bpfilter.h"
#include "bwtwo.h"
#include "ccd.h"
#include "cd.h"
#include "cgtwo.h"
#include "cgfour.h"
#include "ch.h"
#include "kbd.h"
#include "ksyms.h"
#include "ms.h"
#include "pty.h"
#include "rd.h"
#include "sd.h"
#include "ses.h"
#include "ss.h"
#include "st.h"
#include "tun.h"
#include "uk.h"
#include "vnd.h"
#include "xd.h"
#include "xy.h"
#include "zstty.h"
#ifdef XFS
#include <xfs/nxfs.h>
cdev_decl(xfs_dev);
#endif

struct bdevsw	bdevsw[] =
{
	bdev_notdef(),			/* 0 */
	bdev_notdef(),			/* 1: tapemaster tape */
	bdev_notdef(),			/* 2 */
	bdev_disk_init(NXY,xy),		/* 3: SMD disk on Xylogics 450/451 */
	bdev_swap_init(1,sw),		/* 4: swap pseudo-device */
	bdev_disk_init(NVND,vnd),	/* 5: vnode disk driver */
	bdev_notdef(),			/* 6 */
	bdev_disk_init(NSD,sd),		/* 7: SCSI disk */
	bdev_tape_init(NXT,xt),		/* 8: Xylogics tape */
	bdev_disk_init(NCCD,ccd),	/* 9: concatenated disk driver */
	bdev_disk_init(NXD,xd),		/* 10: SMD disk on Xylogics 7053 */
	bdev_tape_init(NST,st),		/* 11: SCSI tape */
	bdev_notdef(),			/* 12: Sun ns? */
	bdev_disk_init(NRD,rd),		/* 13: RAM disk - for install tape */
	bdev_notdef(),			/* 14: Sun ft? */
	bdev_notdef(),			/* 15: Sun hd? */
	bdev_notdef(),			/* 16: Sun fd? */
	bdev_notdef(),			/* 17: Sun vd_unused */
	bdev_disk_init(NCD,cd),		/* 18: SCSI CD-ROM */
	bdev_notdef(),			/* 19: Sun vd_unused */
	bdev_notdef(),			/* 20: Sun vd_unused */
	bdev_notdef(),			/* 21: Sun vd_unused */
	bdev_notdef(),			/* 22: Sun IPI disks... */
	bdev_notdef(),			/* 23: Sun IPI disks... */
	bdev_lkm_dummy(),		/* 24 */
	bdev_lkm_dummy(),		/* 25 */
	bdev_lkm_dummy(),		/* 26 */
	bdev_lkm_dummy(),		/* 27 */
	bdev_lkm_dummy(),		/* 28 */
	bdev_lkm_dummy(),		/* 29 */
};
int	nblkdev = sizeof(bdevsw) / sizeof(bdevsw[0]);

#include "pf.h"

#include "systrace.h"

struct cdevsw	cdevsw[] =
{
	cdev_cn_init(1,cn),		/* 0: virtual console */
	cdev_tty_init(NKBD,kd),		/* 1: Sun keyboard/display */
	cdev_ctty_init(1,ctty),		/* 2: controlling terminal */
	cdev_mm_init(1,mm),		/* 3: /dev/{null,mem,kmem,...} */
	cdev_notdef(),			/* 4: was PROM console */
	cdev_notdef(),			/* 5: tapemaster tape */
	cdev_notdef(),			/* 6: systech/versatec */
	cdev_swap_init(1,sw),		/* 7: /dev/drum {swap pseudo-device) */
	cdev_notdef(),			/* 8: Archive QIC-11 tape */
	cdev_disk_init(NXY,xy),		/* 9: SMD disk on Xylogics 450/451 */
	cdev_notdef(),			/* 10: systech multi-terminal board */
	cdev_notdef(),			/* 11: DES encryption chip */
	cdev_tty_init(NZSTTY,zs),	/* 12: Zilog 8350 serial port */
	cdev_mouse_init(NMS,ms),	/* 13: Sun mouse */
	cdev_notdef(),			/* 14: cgone */
	cdev_notdef(),			/* 15: /dev/winXXX */
	cdev_log_init(1,log),		/* 16: /dev/klog */
	cdev_disk_init(NSD,sd),		/* 17: SCSI disk */
	cdev_tape_init(NST,st),		/* 18: SCSI tape */
	cdev_disk_init(NVND,vnd),	/* 19: vnode disk driver */
	cdev_tty_init(NPTY,pts),	/* 20: pseudo-tty slave */
	cdev_ptc_init(NPTY,ptc),	/* 21: pseudo-tty master */
	cdev_fb_init(1,fb),		/* 22: /dev/fb indirect driver */
	cdev_fd_init(1,filedesc),	/* 23: file descriptor pseudo-device */
	cdev_bpftun_init(NTUN,tun),	/* 24: network tunnel */
	cdev_notdef(),			/* 25: sun pi? */
	cdev_notdef(),			/* 26: bwone */
	cdev_fb_init(NBWTWO,bw2),	/* 27: bwtwo */
	cdev_notdef(),			/* 28: Systech VPC-2200 versatec/centronics */
	cdev_mouse_init(NKBD,kbd),	/* 29: Sun keyboard */
	cdev_tape_init(NXT,xt),		/* 30: Xylogics tape */
	cdev_fb_init(NCGTWO,cg2),	/* 31: cgtwo */
	cdev_notdef(),			/* 32: /dev/gpone */
	cdev_disk_init(NCCD,ccd),	/* 33: concatenated disk driver */
	cdev_notdef(),			/* 34: floating point accelerator */
	cdev_notdef(),			/* 35 */
	cdev_bpftun_init(NBPFILTER,bpf),/* 36: Berkeley packet filter */
	cdev_ksyms_init(NKSYMS,ksyms),	/* 37: Kernel symbols device */
	cdev_notdef(),			/* 38 */
	cdev_fb_init(NCGFOUR,cg4),	/* 39: cgfour */
	cdev_notdef(),			/* 40: (sni) */
	cdev_notdef(),			/* 41: (sun dump) */
	cdev_disk_init(NXD,xd),		/* 42: SMD disk on Xylogics 7053 */
	cdev_notdef(),			/* 43: (sun hrc) */
	cdev_notdef(),			/* 44: (mcp) */
	cdev_notdef(),			/* 45: (sun ifd) */
	cdev_notdef(),			/* 46: (dcp) */
	cdev_notdef(),			/* 47: (dna) */
	cdev_notdef(),			/* 48: (tbi) */
	cdev_notdef(),			/* 49: (chat) */
	cdev_notdef(),			/* 50: (chut) */
#ifdef XFS
	cdev_xfs_init(NXFS,xfs_dev),	/* 51: xfs communication device */
#else
	cdev_notdef(),			/* 51: (chut) */
#endif
	cdev_disk_init(NRD,rd),		/* 52: RAM disk - for install tape */
	cdev_notdef(),			/* 53: (hd - N/A) */
	cdev_notdef(),			/* 54: (fd - N/A) */
	cdev_notdef(),			/* 55: cgthree */
	cdev_notdef(),			/* 56: (pp) */
	cdev_notdef(),			/* 57: (vd) Loadable Module control */
	cdev_disk_init(NCD,cd),		/* 58: SCSI CD-ROM */
	cdev_notdef(),			/* 59: (vd) Loadable Module stub */
	cdev_notdef(),			/* 60:  ||     ||      ||    ||  */
	cdev_notdef(),			/* 61:  ||     ||      ||    ||  */
	cdev_notdef(),			/* 62: (taac) */
	cdev_notdef(),			/* 63: (tcp/tli) */
	cdev_notdef(),			/* 64: cgeight */
	cdev_notdef(),			/* 65: old IPI */
	cdev_notdef(),			/* 66: (mcp) parallel printer */
	cdev_notdef(),			/* 67: cgsix */
	cdev_notdef(),			/* 68: cgnine */
	cdev_notdef(),			/* 69: /dev/audio */
	cdev_notdef(),			/* 70: open prom */
	cdev_notdef(),			/* 71: (sg?) */
	cdev_random_init(1,random),	/* 72: randomness source */
	cdev_uk_init(NUK,uk),		/* 73: unknown SCSI */
	cdev_ss_init(NSS,ss),           /* 74: SCSI scanner */
	cdev_pf_init(NPF,pf),		/* 75: packet filter */
	cdev_lkm_init(NLKM,lkm),	/* 76: loadable module driver */
	cdev_lkm_dummy(),		/* 77 */
	cdev_lkm_dummy(),		/* 78 */
	cdev_lkm_dummy(),		/* 79 */
	cdev_lkm_dummy(),		/* 80 */
	cdev_lkm_dummy(),		/* 81 */
	cdev_lkm_dummy(),		/* 82 */
	cdev_ch_init(NCH,ch),		/* 83: SCSI autochanger */
	cdev_ses_init(NSES,ses),	/* 84: SCSI SES or SAF-TE device */
	cdev_notdef(),			/* 85: ALTQ (deprecated) */
	cdev_systrace_init(NSYSTRACE,systrace),	/* 86: system call tracing */
};
int	nchrdev = sizeof(cdevsw) / sizeof(cdevsw[0]);

int	mem_no = 3;	/* major device number of memory special file */

/*
 * Swapdev is a fake device implemented
 * in sw.c used only internally to get to swstrategy.
 * It cannot be provided to the users, because the
 * swstrategy routine munches the b_dev and b_blkno entries
 * before calling the appropriate driver.  This would horribly
 * confuse, e.g. the hashing routines. Instead, /dev/drum is
 * provided as a character (raw) device.
 */
dev_t	swapdev = makedev(4, 0);

/*
 * Returns true if dev is /dev/mem or /dev/kmem.
 */
int
iskmemdev(dev)
	dev_t dev;
{

	return (major(dev) == mem_no && minor(dev) < 2);
}

/*
 * Returns true if dev is /dev/zero.
 */
int
iszerodev(dev)
	dev_t dev;
{

	return (major(dev) == mem_no && minor(dev) == 12);
}

dev_t
getnulldev()
{
	return makedev(mem_no, 2);
}

static int chrtoblktbl[] = {
        /* XXXX This needs to be dynamic for LKMs. */
        /*VCHR*/        /*VBLK*/
	/*  0 */	NODEV,
	/*  1 */	NODEV,
	/*  2 */	NODEV,
	/*  3 */	NODEV,
	/*  4 */	NODEV,
	/*  5 */	1,
	/*  6 */	NODEV,
	/*  7 */	NODEV,
	/*  8 */	NODEV,
	/*  9 */	3,
	/* 10 */	NODEV,
	/* 11 */	NODEV,
	/* 12 */	NODEV,
	/* 13 */	NODEV,
	/* 14 */	NODEV,
	/* 15 */	NODEV,
	/* 16 */	NODEV,
	/* 17 */	7,
	/* 18 */	11,
	/* 19 */	5,
	/* 20 */	NODEV,
	/* 21 */	NODEV,
	/* 22 */	NODEV,
	/* 23 */	NODEV,
	/* 24 */	NODEV,
	/* 25 */	NODEV,
	/* 26 */	NODEV,
	/* 27 */	NODEV,
	/* 28 */	NODEV,
	/* 29 */	NODEV,
	/* 30 */	8,
	/* 31 */	NODEV,
	/* 32 */	NODEV,
	/* 33 */	9,
	/* 34 */	NODEV,
	/* 35 */	NODEV,
	/* 36 */	NODEV,
	/* 37 */	NODEV,
	/* 38 */	NODEV,
	/* 39 */	NODEV,
	/* 40 */	NODEV,
	/* 41 */	NODEV,
	/* 42 */	10,
	/* 43 */	NODEV,
	/* 44 */	NODEV,
	/* 45 */	NODEV,
	/* 46 */	NODEV,
	/* 47 */	NODEV,
	/* 48 */	NODEV,
	/* 49 */	NODEV,
	/* 50 */	NODEV,
	/* 51 */	NODEV,
	/* 52 */	13,
	/* 53 */	NODEV,
	/* 54 */	NODEV,
	/* 55 */	NODEV,
	/* 56 */	NODEV,
	/* 57 */	NODEV,
	/* 58 */	18,
};

/*
 * Convert a character device number to a block device number.
 */
int
chrtoblk(dev)
	dev_t dev;
{
	int blkmaj;

	if (major(dev) >= nchrdev ||
	    major(dev) > sizeof(chrtoblktbl)/sizeof(chrtoblktbl[0]))
		return (NODEV);
	blkmaj = chrtoblktbl[major(dev)];
	if (blkmaj == NODEV)
		return (NODEV);
	return (makedev(blkmaj, minor(dev)));
}

/*
 * Convert a character device number to a block device number.
 */
dev_t
blktochr(dev)
	dev_t dev;
{
	int blkmaj = major(dev);
	int i;

	if (blkmaj >= nblkdev)
		return (NODEV);
	for (i = 0; i < sizeof(chrtoblktbl)/sizeof(chrtoblktbl[0]); i++)
		if (blkmaj == chrtoblktbl[i])
			return (makedev(i, minor(dev)));
	return (NODEV);
}
@


1.33
log
@remove altq entries.
altq is merged into pf and handled through pf.
@
text
@d1 1
a1 1
/*	$OpenBSD: conf.c,v 1.32 2002/05/16 21:11:18 miod Exp $	*/
@


1.32
log
@Add systrace support to all the remaining architectures.

Tested by various people on various platforms, I'm willing to fix any
breakage this causes.

ok niels@@ deraadt@@ and mickey@@ (after his comments were applied)
@
text
@d1 1
a1 1
/*	$OpenBSD: conf.c,v 1.31 2001/12/11 23:19:02 miod Exp $	*/
a113 2
#include <altq/altqconf.h>

d207 1
a207 1
	cdev_altq_init(NALTQ,altq),	/* 85: ALTQ control interface */
@


1.31
log
@Remove declarations that already exist in <sys/conf.h>
@
text
@d1 1
a1 1
/*	$OpenBSD: conf.c,v 1.30 2001/09/28 02:53:14 mickey Exp $	*/
d116 2
d210 1
@


1.31.2.1
log
@Sync UBC branch to -current
@
text
@d1 1
a1 1
/*	$OpenBSD: conf.c,v 1.31 2001/12/11 23:19:02 miod Exp $	*/
a115 2
#include "systrace.h"

a207 1
	cdev_systrace_init(NSYSTRACE,systrace),	/* 86: system call tracing */
@


1.31.2.2
log
@sync
@
text
@d1 1
a1 1
/*	$OpenBSD: conf.c,v 1.31.2.1 2002/06/11 03:39:01 art Exp $	*/
@


1.30
log
@move cdev_decl(pf) into it's proper place, kill cdev_decl(ipl) at the same time
@
text
@d1 1
a1 1
/*	$OpenBSD: conf.c,v 1.29 2001/06/27 06:56:30 kjc Exp $	*/
a48 2

int	ttselect	__P((dev_t, int, struct proc *));
@


1.29
log
@add the ALTQ device to the rest of the architectures.
@
text
@d1 1
a1 1
/*	$OpenBSD: conf.c,v 1.28 2001/06/25 03:20:19 kjell Exp $	*/
a114 1
cdev_decl(pf);
@


1.28
log
@add pf device on all architectures.
fix my previously bogus MAKEDEVs.
If you used pf on a non-i386. the major device number has changed,
and you'll need to recreate /dev/pf
ok theo
@
text
@d1 1
a1 1
/*	$OpenBSD: conf.c,v 1.27 2000/09/26 14:03:55 art Exp $	*/
d117 2
d210 1
@


1.27
log
@Implement getnulldev that returns the dev_t for "/dev/null".
@
text
@d1 1
a1 1
/*	$OpenBSD: conf.c,v 1.26 2000/08/28 22:04:53 miod Exp $	*/
d114 3
d198 1
a198 1
	cdev_gen_ipf(NIPF,ipl),		/* 75: ip filter log */
@


1.26
log
@Add lkm, ch and ses support
@
text
@d1 1
a1 1
/*	$OpenBSD: conf.c,v 1.25 2000/06/21 21:17:49 miod Exp $	*/
d241 6
@


1.25
log
@Fix xd entry in chrtoblktbl
@
text
@d1 1
a1 1
/*	$OpenBSD: conf.c,v 1.24 2000/03/02 23:02:14 todd Exp $	*/
d53 1
d56 3
d60 1
d65 1
a77 1
#include "ksyms.h"
d105 6
d196 9
@


1.24
log
@sun3 is alive, thanks to Miod Vallat <miodrag@@ifrance.com>
add ksyms, proto fix, msgbuf
@
text
@d1 1
a1 1
/*	$OpenBSD: conf.c,v 1.23 1998/09/25 09:20:54 todd Exp $	*/
d268 2
a269 2
	/* 42 */	NODEV,
	/* 43 */	10,
@


1.23
log
@o xfs is in the house (thanks art, for getting me started)
o all but vax are major 51
@
text
@d1 1
a1 1
/*	$OpenBSD: conf.c,v 1.22 1998/07/07 06:56:12 deraadt Exp $	*/
d72 1
d142 1
a142 1
	cdev_notdef(),			/* 37 */
@


1.23.8.1
log
@Sync with -current
@
text
@d1 1
a1 1
/*	$OpenBSD$	*/
a71 1
#include "ksyms.h"
d141 1
a141 1
	cdev_ksyms_init(NKSYMS,ksyms),	/* 37: Kernel symbols device */
@


1.23.8.2
log
@Continue the aborted merge of current just before 2.9 was cut into the
SMP branch.  Note that this will not make any progress of SMP functionality,
it is just merging of new code from the trunk into the old branch.
Please do not ask me questions about SMP status because of this mail,
instead go read the archives of smp@@openbsd.org, where I mailed about
these commits some week ago.  Another note: I am doing this in chunks now,
so as to not lock too much of the tree for long times
@
text
@d1 1
a1 1
/*	$OpenBSD: conf.c,v 1.27 2000/09/26 14:03:55 art Exp $	*/
a52 1
#include "bwtwo.h"
a54 3
#include "cgtwo.h"
#include "cgfour.h"
#include "ch.h"
a55 1
#include "ksyms.h"
a59 1
#include "ses.h"
d72 1
a99 6
	bdev_lkm_dummy(),		/* 24 */
	bdev_lkm_dummy(),		/* 25 */
	bdev_lkm_dummy(),		/* 26 */
	bdev_lkm_dummy(),		/* 27 */
	bdev_lkm_dummy(),		/* 28 */
	bdev_lkm_dummy(),		/* 29 */
a184 9
	cdev_lkm_init(NLKM,lkm),	/* 76: loadable module driver */
	cdev_lkm_dummy(),		/* 77 */
	cdev_lkm_dummy(),		/* 78 */
	cdev_lkm_dummy(),		/* 79 */
	cdev_lkm_dummy(),		/* 80 */
	cdev_lkm_dummy(),		/* 81 */
	cdev_lkm_dummy(),		/* 82 */
	cdev_ch_init(NCH,ch),		/* 83: SCSI autochanger */
	cdev_ses_init(NSES,ses),	/* 84: SCSI SES or SAF-TE device */
a222 6
dev_t
getnulldev()
{
	return makedev(mem_no, 2);
}

d268 2
a269 2
	/* 42 */	10,
	/* 43 */	NODEV,
@


1.23.8.3
log
@Merge in -current from two days ago in the SMP branch.
As usual with merges, they do not indicate progress, so do not hold
your breath for working SMP, and do not mail me and ask about the
state of it.  It has not changed.  There is work ongoing, but very, very
slowly.  The commit is done in parts as to not lock up the tree in too
big chunks at a time.
@
text
@d1 1
a1 1
/*	$OpenBSD: conf.c,v 1.23.8.2 2001/05/14 21:37:34 niklas Exp $	*/
a113 5
#include "pf.h"
cdev_decl(pf);

#include <altq/altqconf.h>

d195 1
a195 1
	cdev_pf_init(NPF,pf),		/* 75: packet filter */
a204 1
	cdev_altq_init(NALTQ,altq),	/* 85: ALTQ control interface */
@


1.23.8.4
log
@Sync the SMP branch to something just after 3.0
@
text
@d1 1
a1 1
/*	$OpenBSD: conf.c,v 1.23.8.3 2001/07/04 10:24:07 niklas Exp $	*/
d115 1
@


1.23.8.5
log
@Merge in trunk
@
text
@d1 1
a1 1
/*	$OpenBSD$	*/
d49 2
@


1.23.8.6
log
@Sync the SMP branch with 3.3
@
text
@d1 1
a1 1
/*	$OpenBSD: conf.c,v 1.23.8.5 2002/03/06 02:04:47 niklas Exp $	*/
@


1.22
log
@oops, i did not handle nchrdev correctly
@
text
@d1 1
a1 1
/*	$OpenBSD: conf.c,v 1.21 1998/07/07 03:02:48 deraadt Exp $	*/
d68 4
d155 3
d159 1
@


1.21
log
@fix chrtoblk() so that it returne ENODEV for entries beyond the end of the table
@
text
@d1 1
a1 1
/*	$OpenBSD: conf.c,v 1.20 1997/02/22 21:09:15 kstailey Exp $	*/
d287 1
a287 1
	if (major(dev) >= MAXDEV ||
@


1.20
log
@ramdisk now has raw version, disklabels
@
text
@d1 1
a1 1
/*	$OpenBSD: conf.c,v 1.19 1997/02/04 23:25:03 kstailey Exp $	*/
a275 13
	/* 59 */	NODEV,
	/* 60 */	NODEV,
	/* 61 */	NODEV,
	/* 62 */	NODEV,
	/* 63 */	NODEV,
	/* 64 */	NODEV,
	/* 65 */	NODEV,
	/* 66 */	NODEV,
	/* 67 */	NODEV,
	/* 68 */	NODEV,
	/* 69 */	NODEV,
	/* 70 */	NODEV,
	/* 71 */	NODEV,
d287 2
a288 1
	if (major(dev) >= nchrdev)
@


1.19
log
@ipfiltering
@
text
@d1 1
a1 1
/*	$OpenBSD: conf.c,v 1.18 1997/01/16 04:04:14 kstailey Exp $	*/
d152 1
a152 1
	cdev_notdef(),			/* 52: RAM disk - for install tape */
@


1.18
log
@all modified code can now compile with -Werror -Wall -Wstrict-prototypes
CAVEAT: turning off -O2 produces warnings about "defined but not used"
        functions from libkern.h

removed internal copy of gets() replaced with call to getsn()

fixed #ifdef ... #endif mismatch in swapgeneric.c

fixed printf() in if_ie.c that was missing an argument

fixed si.c so that it compiles

added tags to all edited files
@
text
@d1 1
a1 1
/*	$OpenBSD$	*/
d175 1
@


1.17
log
@backed out prev. netbsd merge except for smaller proc table
@
text
@d1 1
d101 1
a101 1
	cdev_tty_init(NKBD,kd),	/* 1: Sun keyboard/display */
d194 1
d205 1
d293 1
@


1.16
log
@sync with 17-Dec-1996
@
text
@d1 1
a1 1
/*	$NetBSD: conf.c,v 1.52 1996/12/17 21:11:18 gwr Exp $	*/
d49 2
a192 1
int
a202 1
int
a289 1
int
@


1.15
log
@added const to second parameter of cfprint_t routines
@
text
@d1 1
a1 1
/*	$NetBSD: conf.c,v 1.51 1996/11/04 16:16:09 gwr Exp $	*/
a48 2
int	ttselect	__P((dev_t, int, struct proc *));

d191 1
d202 1
d290 1
@


1.14
log
@sync with NetBSD
@
text
@d55 1
@


1.13
log
@cdev_init_random -> cdev_random_init
@
text
@d1 1
a1 1
/*	$NetBSD: conf.c,v 1.48 1996/03/14 21:35:47 christos Exp $	*/
d54 1
d63 3
d99 1
a99 1
	cdev_tty_init(NKD,kd),	/* 1: Sun keyboard/display */
d110 2
a111 2
	cdev_tty_init(NZS,zs),		/* 12: Zilog 8350 serial port */
	cdev_mouse_init(NKD,ms),	/* 13: Sun mouse */
d127 1
a127 1
	cdev_mouse_init(NKD,kbd),	/* 29: Sun keyboard */
@


1.12
log
@Updates for SCSI scanner and SCSI unknown devices.
Removed MI *dev_decl() stuff that is now in sys/conf.h
@
text
@d166 1
a166 1
	cdev_init_random(1,random),	/* 72: randomness source */
@


1.11
log
@add blktochr()
@
text
@d47 2
d51 2
d54 1
a54 7
bdev_decl(cd);
cdev_decl(cd);

#include "ccd.h"
bdev_decl(ccd);
cdev_decl(ccd);

a55 3
bdev_decl(rd);
/* no cdev for rd */

d57 1
a57 3
bdev_decl(sd);
cdev_decl(sd);

d59 2
a60 7
bdev_decl(st);
cdev_decl(st);

/* swap device (required) */
bdev_decl(sw);
cdev_decl(sw);

a61 14
bdev_decl(vnd);
cdev_decl(vnd);

#include "xd.h"
bdev_decl(xd);
cdev_decl(xd);

#define	NXT 0	/* XXX */
bdev_decl(xt);
cdev_decl(xt);

#include "xy.h"
bdev_decl(xy);
cdev_decl(xy);
a91 53
/*
 * Devices that have only CHR nodes are declared below.
 */

cdev_decl(cn);
cdev_decl(ctty);
#define	mmread	mmrw
#define	mmwrite	mmrw
cdev_decl(mm);

#define NZS 2 /* XXX: temporary hack */
cdev_decl(zs);
cdev_decl(kd);
cdev_decl(ms);
cdev_decl(kbd);

/* XXX - Should make keyboard/mouse real children of zs. */
#if NZS > 1
#define NKD 1
#else
#define NKD 0
#endif

#include "pty.h"
#define	ptstty		ptytty
#define	ptsioctl	ptyioctl
cdev_decl(pts);
#define	ptctty		ptytty
#define	ptcioctl	ptyioctl
cdev_decl(ptc);

/* frame-buffer devices */
cdev_decl(fb);
#include "bwtwo.h"
cdev_decl(bw2);
#include "cgtwo.h"
cdev_decl(cg2);
#include "cgfour.h"
cdev_decl(cg4);

cdev_decl(log);
cdev_decl(fd);

#include "bpfilter.h"
cdev_decl(bpf);

#include "tun.h"
cdev_decl(tun);

dev_decl(filedesc,open);
cdev_decl(random);


d167 2
@


1.10
log
@add random device
@
text
@d375 17
@


1.9
log
@sync + our changes
@
text
@d168 1
d245 1
@


1.8
log
@rnd -> random
@
text
@a166 3
#include "random.h"
cdev_decl(random);

a243 1
	cdev_random_init(NRANDOM,random), /* 72: random data source */
@


1.7
log
@add rnd driver
@
text
@d167 2
a168 2
#include "rnd.h"
cdev_decl(rnd);
d247 1
a247 1
	cdev_rnd_init(NRND,rnd),	/* 72: random data source */
@


1.6
log
@sync with 0430.
@
text
@d167 3
d247 1
@


1.5
log
@sync with netbsd
@
text
@d1 1
a1 1
/*	$NetBSD: conf.c,v 1.46 1996/01/24 22:40:58 gwr Exp $	*/
d128 1
a128 1
#include "zs.h"
d167 2
d195 1
a195 1
	cdev_fd_init(1,fd),		/* 23: file descriptor pseudo-device */
@


1.4
log
@created devices for the IP filter log on all architectures
@
text
@d1 1
a1 1
/*	$NetBSD: conf.c,v 1.45 1995/10/29 04:15:59 gwr Exp $	*/
a167 13
/* open, close, read, ioctl */
cdev_decl(ipl);
#define	cdev_gen_ipf(c,n) { \
	dev_init(c,n,open), dev_init(c,n,close), dev_init(c,n,read), \
	(dev_type_write((*))) enodev, dev_init(c,n,ioctl), \
	(dev_type_stop((*))) nullop, 0, (dev_type_select((*))) enodev, \
	(dev_type_mmap((*))) enodev, 0 }
#ifdef IPFILTER
#define NIPF 1
#else
#define NIPF 0
#endif

a241 1
	cdev_gen_ipf(NIPF,ipl),         /* 72: IP filter log */
a370 25
/*
 * This entire table could be autoconfig()ed but that would mean that
 * the kernel's idea of the console could be out of sync with that of
 * the standalone boot.  I think it best that they both use the same
 * known algorithm unless we see a pressing need otherwise.
 */
#include <dev/cons.h>

cons_decl(kd);
#define	zscnpollc	nullcnpollc

cons_decl(zs);
dev_type_cnprobe(zscnprobe_a);
dev_type_cnprobe(zscnprobe_b);

struct	consdev constab[] = {
#if NZS > 0
	{ zscnprobe_a, zscninit, zscngetc, zscnputc, zscnpollc },
	{ zscnprobe_b, zscninit, zscngetc, zscnputc, zscnpollc },
#endif
#if NKD > 0
	cons_init(kd),
#endif
	{ 0 },	/* REQIURED! */
};
@


1.3
log
@update from netbsd (verbatim)
@
text
@d168 13
d255 1
@


1.2
log
@Fix previous change that broke kd console
@
text
@d1 1
a1 1
/*	$NetBSD: conf.c,v 1.44.2.1 1995/10/29 04:22:44 gwr Exp $	*/
@


1.1
log
@Initial revision
@
text
@d1 1
a1 1
/*	$NetBSD: conf.c,v 1.44 1995/10/08 23:46:27 gwr Exp $	*/
d183 1
a183 1
	cdev_mouse_init(NZS-1,ms),	/* 13: Sun mouse */
d199 1
a199 1
	cdev_mouse_init(NZS-1,kbd),	/* 29: Sun keyboard */
d391 1
a391 1
#if NKD > 1
@


1.1.1.1
log
@initial import of NetBSD tree
@
text
@@
