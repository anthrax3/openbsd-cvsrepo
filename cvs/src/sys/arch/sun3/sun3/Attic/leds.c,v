head	1.6;
access;
symbols
	SMP_SYNC_A:1.6
	SMP_SYNC_B:1.6
	UBC_SYNC_A:1.6
	OPENBSD_3_2:1.5.0.28
	OPENBSD_3_2_BASE:1.5
	OPENBSD_3_1:1.5.0.26
	OPENBSD_3_1_BASE:1.5
	UBC_SYNC_B:1.5
	UBC:1.5.0.24
	UBC_BASE:1.5
	OPENBSD_3_0:1.5.0.22
	OPENBSD_3_0_BASE:1.5
	OPENBSD_2_9_BASE:1.5
	OPENBSD_2_9:1.5.0.20
	OPENBSD_2_8:1.5.0.18
	OPENBSD_2_8_BASE:1.5
	OPENBSD_2_7:1.5.0.16
	OPENBSD_2_7_BASE:1.5
	SMP:1.5.0.14
	SMP_BASE:1.5
	kame_19991208:1.5
	OPENBSD_2_6:1.5.0.12
	OPENBSD_2_6_BASE:1.5
	OPENBSD_2_5:1.5.0.10
	OPENBSD_2_5_BASE:1.5
	OPENBSD_2_4:1.5.0.8
	OPENBSD_2_4_BASE:1.5
	OPENBSD_2_3:1.5.0.6
	OPENBSD_2_3_BASE:1.5
	OPENBSD_2_2:1.5.0.4
	OPENBSD_2_2_BASE:1.5
	OPENBSD_2_1:1.5.0.2
	OPENBSD_2_1_BASE:1.5;
locks; strict;
comment	@ * @;


1.6
date	2002.12.31.16.35.41;	author miod;	state dead;
branches;
next	1.5;

1.5
date	97.02.14.20.35.02;	author kstailey;	state Exp;
branches
	1.5.14.1
	1.5.24.1;
next	1.4;

1.4
date	97.01.16.04.04.26;	author kstailey;	state Exp;
branches;
next	1.3;

1.3
date	97.01.13.21.28.24;	author kstailey;	state Exp;
branches;
next	1.2;

1.2
date	97.01.13.02.53.50;	author kstailey;	state Exp;
branches;
next	1.1;

1.1
date	97.01.13.00.29.24;	author kstailey;	state Exp;
branches;
next	;

1.5.14.1
date	2003.03.27.23.52.18;	author niklas;	state dead;
branches;
next	;

1.5.24.1
date	2003.05.19.21.49.46;	author tedu;	state dead;
branches;
next	;


desc
@@


1.6
log
@amiga and sun3 turned out to not be y2k+3 compliant here. Remove them, as
well as the few userland tools which were only used on these platforms.
@
text
@/*	$OpenBSD: leds.c,v 1.5 1997/02/14 20:35:02 kstailey Exp $	*/

#include <sys/param.h>
#include <sys/systm.h>
#include <sys/errno.h>
#include <sys/uio.h>

#include <machine/psl.h>

#include "ledsvar.h"

#define MAXPVLEN 10240
#define MAXCDOWN 128

static volatile unsigned char pattern[MAXPVLEN] = {
	0xff, 0xfe, 0xfc, 0xf8, 0xf0, 0xe0, 0xc0, 0x80,
	0x00, 0x01, 0x03, 0x07, 0x0f, 0x1f, 0x3f, 0x7f
};

volatile unsigned int led_n_patterns = 16;
volatile const unsigned char * volatile led_patterns = &pattern[0];
volatile unsigned int led_countmax = 5;
volatile unsigned int led_countdown = 0;
volatile unsigned int led_px = 0;

int
ledrw(uio)
	struct uio *uio;
{
	unsigned int v[2];
	int s;
	unsigned int o;
	int err;

	if (uio->uio_offset > MAXPVLEN+sizeof(v))
		return(0);
	s = splhigh();
	v[0] = led_countmax;
	v[1] = led_n_patterns;
	splx(s);
	o = uio->uio_offset;
	if (o < sizeof(v)) {
		err = uiomove(((caddr_t)&v[0])+o, sizeof(v)-o, uio);
		if (err)
			return(err);
		o = sizeof(v);
		if (uio->uio_rw == UIO_WRITE) {
			if ((v[0] > MAXCDOWN) ||
			    (v[1] < 1) || (v[1] > MAXPVLEN))
				return(EIO);
			s = splhigh();
			led_countmax = v[0];
			led_n_patterns = v[1];
			led_countdown = 0;
			led_px = 0;
			splx(s);
		}
	}
	o -= sizeof(v);
	if (o >= v[1])
		return(0);
	if (uio->uio_resid > 0) {
		err = uiomove((caddr_t)&pattern[o], v[1]-o, uio);
		if (err)
			return(err);
	}
	return(0);
}
@


1.5
log
@switch from <sys/types.h> to <sys/param.h>
@
text
@d1 1
a1 1
/*	$OpenBSD: leds.c,v 1.4 1997/01/16 04:04:26 kstailey Exp $	*/
@


1.5.24.1
log
@sync
@
text
@d1 1
a1 1
/*	$OpenBSD: leds.c,v 1.5 1997/02/14 20:35:02 kstailey Exp $	*/
@


1.5.14.1
log
@Sync the SMP branch with 3.3
@
text
@d1 1
a1 1
/*	$OpenBSD: leds.c,v 1.5 1997/02/14 20:35:02 kstailey Exp $	*/
@


1.4
log
@all modified code can now compile with -Werror -Wall -Wstrict-prototypes
CAVEAT: turning off -O2 produces warnings about "defined but not used"
        functions from libkern.h

removed internal copy of gets() replaced with call to getsn()

fixed #ifdef ... #endif mismatch in swapgeneric.c

fixed printf() in if_ie.c that was missing an argument

fixed si.c so that it compiles

added tags to all edited files
@
text
@d1 1
a1 1
/*	$OpenBSD: leds.c,v 1.3 1997/01/13 21:28:24 kstailey Exp $	*/
d3 1
a3 1
#include <sys/types.h>
@


1.3
log
@reformatted ala KNF
@
text
@d1 1
a1 1
/*	$OpenBSD: leds.c,v 1.2 1997/01/13 02:53:50 kstailey Exp $	*/
a3 1
#include <sys/uio.h>
d6 2
d28 1
a28 1
     struct uio *uio;
d44 2
a45 1
		if (err) return(err);
d64 2
a65 1
		if (err) return(err);
@


1.2
log
@leds-extern.h -> ledsvar.h
@
text
@d1 1
a1 1
/*	$OpenBSD: leds.c,v 1.1 1997/01/13 00:29:24 kstailey Exp $	*/
d14 4
a17 4
static volatile unsigned char pattern[MAXPVLEN] =
	{ 0xff, 0xfe, 0xfc, 0xf8, 0xf0, 0xe0, 0xc0, 0x80,
	  0x00, 0x01, 0x03, 0x07, 0x0f, 0x1f, 0x3f, 0x7f
	};
d25 3
a27 1
int ledrw(struct uio *uio)
d29 36
a64 32
 unsigned int v[2];
 int s;
 unsigned int o;
 int err;

 if (uio->uio_offset > MAXPVLEN+sizeof(v)) return(0);
 s = splhigh();
 v[0] = led_countmax;
 v[1] = led_n_patterns;
 splx(s);
 o = uio->uio_offset;
 if (o < sizeof(v))
  { err = uiomove(((caddr_t)&v[0])+o,sizeof(v)-o,uio);
    if (err) return(err);
    o = sizeof(v);
    if (uio->uio_rw == UIO_WRITE)
     { if ((v[0] > MAXCDOWN) || (v[1] < 1) || (v[1] > MAXPVLEN)) return(EIO);
       s = splhigh();
       led_countmax = v[0];
       led_n_patterns = v[1];
       led_countdown = 0;
       led_px = 0;
       splx(s);
     }
  }
 o -= sizeof(v);
 if (o >= v[1]) return(0);
 if (uio->uio_resid > 0)
  { err = uiomove((caddr_t)&pattern[o],v[1]-o,uio);
    if (err) return(err);
  }
 return(0);
@


1.1
log
@back-panel LED control device derived from code by der Mouse
@
text
@d1 1
a1 1
/*	$OpenBSD$	*/
d9 1
a9 1
#include "leds-extern.h"
@
