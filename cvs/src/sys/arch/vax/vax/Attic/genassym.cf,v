head	1.13;
access;
symbols
	OPENBSD_5_9:1.12.0.8
	OPENBSD_5_9_BASE:1.12
	OPENBSD_5_8:1.12.0.10
	OPENBSD_5_8_BASE:1.12
	OPENBSD_5_7:1.12.0.2
	OPENBSD_5_7_BASE:1.12
	OPENBSD_5_6:1.12.0.6
	OPENBSD_5_6_BASE:1.12
	OPENBSD_5_5:1.12.0.4
	OPENBSD_5_5_BASE:1.12
	OPENBSD_5_4:1.11.0.8
	OPENBSD_5_4_BASE:1.11
	OPENBSD_5_3:1.11.0.6
	OPENBSD_5_3_BASE:1.11
	OPENBSD_5_2:1.11.0.4
	OPENBSD_5_2_BASE:1.11
	OPENBSD_5_1_BASE:1.11
	OPENBSD_5_1:1.11.0.2
	OPENBSD_5_0:1.10.0.12
	OPENBSD_5_0_BASE:1.10
	OPENBSD_4_9:1.10.0.10
	OPENBSD_4_9_BASE:1.10
	OPENBSD_4_8:1.10.0.8
	OPENBSD_4_8_BASE:1.10
	OPENBSD_4_7:1.10.0.4
	OPENBSD_4_7_BASE:1.10
	OPENBSD_4_6:1.10.0.6
	OPENBSD_4_6_BASE:1.10
	OPENBSD_4_5:1.10.0.2
	OPENBSD_4_5_BASE:1.10
	OPENBSD_4_4:1.9.0.6
	OPENBSD_4_4_BASE:1.9
	OPENBSD_4_3:1.9.0.4
	OPENBSD_4_3_BASE:1.9
	OPENBSD_4_2:1.9.0.2
	OPENBSD_4_2_BASE:1.9
	OPENBSD_4_1:1.8.0.8
	OPENBSD_4_1_BASE:1.8
	OPENBSD_4_0:1.8.0.6
	OPENBSD_4_0_BASE:1.8
	OPENBSD_3_9:1.8.0.4
	OPENBSD_3_9_BASE:1.8
	OPENBSD_3_8:1.8.0.2
	OPENBSD_3_8_BASE:1.8
	OPENBSD_3_7:1.6.0.4
	OPENBSD_3_7_BASE:1.6
	OPENBSD_3_6:1.6.0.2
	OPENBSD_3_6_BASE:1.6
	SMP_SYNC_A:1.4
	SMP_SYNC_B:1.4
	OPENBSD_3_5:1.4.0.10
	OPENBSD_3_5_BASE:1.4
	OPENBSD_3_4:1.4.0.8
	OPENBSD_3_4_BASE:1.4
	UBC_SYNC_A:1.4
	OPENBSD_3_3:1.4.0.6
	OPENBSD_3_3_BASE:1.4
	OPENBSD_3_2:1.4.0.4
	OPENBSD_3_2_BASE:1.4
	OPENBSD_3_1:1.4.0.2
	OPENBSD_3_1_BASE:1.4
	UBC_SYNC_B:1.4
	UBC:1.3.0.4
	UBC_BASE:1.3
	OPENBSD_3_0:1.3.0.2
	OPENBSD_3_0_BASE:1.3
	SMP:1.1.0.8
	OPENBSD_2_9_BASE:1.1
	OPENBSD_2_9:1.1.0.6
	OPENBSD_2_8:1.1.0.4
	OPENBSD_2_8_BASE:1.1
	OPENBSD_2_7:1.1.0.2
	OPENBSD_2_7_BASE:1.1;
locks; strict;
comment	@# @;


1.13
date	2016.03.09.16.28.49;	author deraadt;	state dead;
branches;
next	1.12;
commitid	OSDG2O3Cgeifnf1W;

1.12
date	2013.11.24.22.08.25;	author miod;	state Exp;
branches;
next	1.11;

1.11
date	2011.09.27.15.15.35;	author miod;	state Exp;
branches;
next	1.10;

1.10
date	2008.08.18.23.05.38;	author miod;	state Exp;
branches;
next	1.9;

1.9
date	2007.05.16.05.19.15;	author miod;	state Exp;
branches;
next	1.8;

1.8
date	2005.06.08.07.06.02;	author miod;	state Exp;
branches;
next	1.7;

1.7
date	2005.06.07.21.32.43;	author martin;	state Exp;
branches;
next	1.6;

1.6
date	2004.07.07.23.10.46;	author deraadt;	state Exp;
branches;
next	1.5;

1.5
date	2004.06.13.21.49.22;	author niklas;	state Exp;
branches;
next	1.4;

1.4
date	2002.01.23.23.24.40;	author miod;	state Exp;
branches;
next	1.3;

1.3
date	2001.09.16.14.28.04;	author miod;	state Exp;
branches
	1.3.4.1;
next	1.2;

1.2
date	2001.08.25.13.33.37;	author hugh;	state Exp;
branches;
next	1.1;

1.1
date	2000.04.27.01.10.11;	author bjc;	state Exp;
branches
	1.1.8.1;
next	;

1.1.8.1
date	2001.05.14.21.38.51;	author niklas;	state Exp;
branches;
next	1.1.8.2;

1.1.8.2
date	2001.10.31.03.08.01;	author nate;	state Exp;
branches;
next	1.1.8.3;

1.1.8.3
date	2002.03.06.02.04.48;	author niklas;	state Exp;
branches;
next	1.1.8.4;

1.1.8.4
date	2004.06.07.15.58.33;	author tedu;	state Exp;
branches;
next	;

1.3.4.1
date	2002.01.31.22.55.27;	author niklas;	state Exp;
branches;
next	;


desc
@@


1.13
log
@We are done providing support for the vax.
lots of agreement.
@
text
@#	$OpenBSD: genassym.cf,v 1.12 2013/11/24 22:08:25 miod Exp $
#	$NetBSD: genassym.cf,v 1.10 1999/11/19 22:09:55 ragge Exp $
#
# Copyright (c) 1997 Ludd, University of Lule}, Sweden.
# All rights reserved.
#
# Redistribution and use in source and binary forms, with or without
# modification, are permitted provided that the following conditions
# are met:
# 1. Redistributions of source code must retain the above copyright
#    notice, this list of conditions and the following disclaimer.
# 2. Redistributions in binary form must reproduce the above copyright
#    notice, this list of conditions and the following disclaimer in the
#    documentation and/or other materials provided with the distribution.
# 3. All advertising materials mentioning features or use of this software
#    must display the following acknowledgement:
#      This product includes software developed at Ludd, University of 
#      Lule}, Sweden and its contributors.
# 4. The name of the author may not be used to endorse or promote products
#    derived from this software without specific prior written permission
#
# THIS SOFTWARE IS PROVIDED BY THE AUTHOR ``AS IS'' AND ANY EXPRESS OR
# IMPLIED WARRANTIES, INCLUDING, BUT NOT LIMITED TO, THE IMPLIED WARRANTIES
# OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE ARE DISCLAIMED.
# IN NO EVENT SHALL THE AUTHOR BE LIABLE FOR ANY DIRECT, INDIRECT,
# INCIDENTAL, SPECIAL, EXEMPLARY, OR CONSEQUENTIAL DAMAGES (INCLUDING, BUT
# NOT LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES; LOSS OF USE,
# DATA, OR PROFITS; OR BUSINESS INTERRUPTION) HOWEVER CAUSED AND ON ANY
# THEORY OF LIABILITY, WHETHER IN CONTRACT, STRICT LIABILITY, OR TORT
# (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE USE OF
# THIS SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.
#

include	<sys/param.h>
include	<sys/proc.h>
include	<sys/errno.h>
include	<sys/syscall.h>
include	<sys/evcount.h>

include	<machine/mtpr.h>
include	<machine/pcb.h>
include	<machine/sid.h>
include	<machine/trap.h>
include	<machine/cpu.h>

struct	proc
member	p_priority
member	p_addr
member	p_vmspace
member	p_stat

export	SONPROC

struct	pcb
member	P0BR
member	P0LR
member	P1BR
member	P1LR
member	iftrap
member	pcb_paddr

struct	cpu_dep
member	MCHK		cpu_mchk
member	MEMERR		cpu_memerr
member	HARDCLOCK	cpu_hardclock

struct	cpu_info
member	ci_curproc

export	KERNBASE

# mtpr register numbers
export	PR_KSP
export	PR_USP
export	PR_ICCS
export	PR_PCBB
export	PR_IPL
export	PR_SBIFS
export	PR_EHSR
export	PR_MCESR
export	PR_P0BR
export	PR_P1BR
export	PR_P0LR
export	PR_P1LR
export	PR_SCBB

# trap numbering
export	T_KSPNOTVAL
export	T_PRIVINFLT
export	T_XFCFLT
export	T_RESOPFLT
export	T_RESADFLT
export	T_TRANSFLT
export	T_PTEFETCH
export	T_WRITE	
export	T_ACCFLT
export	T_PTELEN
export	T_TRCTRAP
export	T_BPTFLT
export	T_ARITHFLT
export	T_SYSCALL
export	T_ASTFLT
export	T_KDBTRAP

export	USPACE	

export	EFAULT
export	ENAMETOOLONG

struct	evcount
member	ec_count

export	SYS_sigreturn
export	SYS_exit

export	VAX_TYP_SOC
export	VAX_TYP_UV2
@


1.12
log
@Rework pmap to use dynamic P0 and P1 region allocation, instead of allocating
the largest possible page table for every pmap; from NetBSD. This allows the
kernel to use much less memory for page tables.

Significant differences against the NetBSD code are:
- allocation of page table pages is done with a pool instead of allocating
  whole logical pages from uvm and managing the freelist within pmap, never
  releasing allocated pages.
- try to use pt_entry_t * rather than int * whenever possible.
- growth of P0 and P1 regions is allowed to fail, if invoked from
  pmap_enter with the PMAP_CANFAIL flag. This will stall processes until
  memory for the page tables can be obtained, rather than panicing, in
  most cases.
- keep management of mappings for managed pages using pv lists tied to the
  vm_page (using __HAVE_VM_PAGE_MD), rather than a global pv_list head.
- bound check against Sysmap[] in pmap_extract() when asked for a kernel
  address.

As a result of this, bsd.rd can now install a working system on a 12MB machine
without needing to enable swap.
@
text
@d1 1
a1 1
#	$OpenBSD: genassym.cf,v 1.11 2011/09/27 15:15:35 miod Exp $
@


1.11
log
@Try to put more sanity in the machine check handling:
- only handle a machine check as caused by badaddr() if the local `memtest'
  variable is nonzero, instead of abusing `cold'. And be sure to clear
  `memtest' upon returning from badaddr, of course.
- do not write to the MCESR register on microVAX II and SOC processors, as
  this register is not implemented on those models.
- get rid of the `write the SBIFS and EHSR registers depending upon the
  cpu model' chunk, since these only matter on true 11/780 and 86x0 models,
  support for which has been removed recently.
@
text
@d1 1
a1 1
#	$OpenBSD: genassym.cf,v 1.10 2008/08/18 23:05:38 miod Exp $
d60 1
@


1.10
log
@Make hardclock() a cpu_dep member. Most machines will use the generic
hardclock() here, except for KA46 which needs to reset the diagnostic
timer.

This gives us working clock interrupt counters for vmstat -i in the process.
@
text
@d1 1
a1 1
#	$OpenBSD: genassym.cf,v 1.9 2007/05/16 05:19:15 miod Exp $
d115 1
@


1.9
log
@Switch vax to __HAVE_CPUINFO, based on an incomplete diff from art.
@
text
@d1 1
a1 1
#	$OpenBSD: genassym.cf,v 1.8 2005/06/08 07:06:02 miod Exp $
d64 1
a115 3
export	VAX_TYP_8SS
export	VAX_BTYP_46
export	VAX_BTYP_48
@


1.8
log
@No need to export NETISR fields explicitely for intvec.s, as <net/netisr.h>
can be (and is) included by assembly source.
@
text
@d1 1
a1 1
#	$OpenBSD: genassym.cf,v 1.7 2005/06/07 21:32:43 martin Exp $
d64 3
@


1.7
log
@remove NETISR_ISO and NETISR_CCITT

ok henning@@
@
text
@d1 1
a1 1
#	$OpenBSD: genassym.cf,v 1.6 2004/07/07 23:10:46 deraadt Exp $
a39 2
include	<net/netisr.h>

a98 9

# software net interrupts
export	NETISR_IP
export	NETISR_ARP
export	NETISR_NS
export	NETISR_ATALK
export	NETISR_PPP
export	NETISR_IPV6
export 	NETISR_BRIDGE
@


1.6
log
@new-style interrupt counters.  based on initial work by hugh.  ok miod
@
text
@d1 1
a1 1
#	$OpenBSD: genassym.cf,v 1.5 2004/06/13 21:49:22 niklas Exp $
a106 2
export	NETISR_ISO
export	NETISR_CCITT
@


1.5
log
@debranch SMP, have fun
@
text
@d1 1
a1 1
#	$OpenBSD$
d38 1
d118 2
a119 2
struct	evcnt
member	ev_count
@


1.4
log
@copy*str() fixes for vax. Also includes some fixes from NetBSD PR #7838.
@
text
@d1 1
a1 1
#	$OpenBSD: genassym.cf,v 1.3 2001/09/16 14:28:04 miod Exp $
d51 3
@


1.3
log
@Make use of "export", "struct" and "member" keywords to be easier to read
and simpler.
@
text
@d1 1
a1 1
#	$OpenBSD: genassym.cf,v 1.2 2001/08/25 13:33:37 hugh Exp $
d111 1
@


1.3.4.1
log
@Merge in -current, builds on i386, otherwise untested
@
text
@d1 1
a1 1
#	$OpenBSD: genassym.cf,v 1.4 2002/01/23 23:24:40 miod Exp $
a110 1
export	EFAULT
@


1.2
log
@Bring in some useful stuff from NetBSD. Mostly work by Matt Thomas,
and concerned with intvec counting. Also some ANSIfication.
@
text
@d1 1
a1 1
#	$OpenBSD: genassym.cf,v 1.1 2000/04/27 01:10:11 bjc Exp $
a33 1

d47 15
a61 12
define	P_PRIORITY	offsetof(struct proc, p_priority)
define	P_ADDR		offsetof(struct proc, p_addr)
define	P_VMSPACE	offsetof(struct proc, p_vmspace)

define	P0BR		offsetof(struct pcb, P0BR)
define	P0LR		offsetof(struct pcb, P0LR)
define	P1BR		offsetof(struct pcb, P1BR)
define	P1LR		offsetof(struct pcb, P1LR)
define	IFTRAP		offsetof(struct pcb, iftrap)

define	MCHK		offsetof(struct cpu_dep, cpu_mchk)
define	MEMERR		offsetof(struct cpu_dep, cpu_memerr)
d63 1
a63 1
define	KERNBASE	KERNBASE
d66 13
a78 13
define	PR_KSP		PR_KSP
define	PR_USP		PR_USP
define	PR_ICCS		PR_ICCS
define	PR_PCBB		PR_PCBB
define	PR_IPL		PR_IPL
define	PR_SBIFS	PR_SBIFS
define	PR_EHSR		PR_EHSR
define	PR_MCESR	PR_MCESR
define	PR_P0BR		PR_P0BR
define	PR_P1BR		PR_P1BR
define	PR_P0LR		PR_P0LR
define	PR_P1LR		PR_P1LR
define	PR_SCBB		PR_SCBB
d81 16
a96 16
define	T_KSPNOTVAL	T_KSPNOTVAL
define	T_PRIVINFLT	T_PRIVINFLT
define	T_XFCFLT	T_XFCFLT
define	T_RESOPFLT	T_RESOPFLT
define	T_RESADFLT	T_RESADFLT
define	T_TRANSFLT	T_TRANSFLT
define	T_PTEFETCH	T_PTEFETCH
define	T_WRITE		T_WRITE
define	T_ACCFLT	T_ACCFLT
define	T_PTELEN	T_PTELEN
define	T_TRCTRAP	T_TRCTRAP
define	T_BPTFLT	T_BPTFLT
define	T_ARITHFLT	T_ARITHFLT
define	T_SYSCALL	T_SYSCALL
define	T_ASTFLT	T_ASTFLT
define	T_KDBTRAP	T_KDBTRAP
d99 24
a122 23
define	NETISR_IP	NETISR_IP
define	NETISR_ARP	NETISR_ARP
define	NETISR_NS	NETISR_NS
define	NETISR_ATALK	NETISR_ATALK
define	NETISR_ISO	NETISR_ISO
define	NETISR_CCITT	NETISR_CCITT
define	NETISR_PPP	NETISR_PPP
define	NETISR_IPV6	NETISR_IPV6
define 	NETISR_BRIDGE	NETISR_BRIDGE

define	USPACE		USPACE

define	ENAMETOOLONG	ENAMETOOLONG

define	EV_COUNT	offsetof(struct evcnt, ev_count)

define	SYS_sigreturn	SYS_sigreturn	
define	SYS_exit	SYS_exit

define	VAX_TYP_UV2	VAX_TYP_UV2
define	VAX_TYP_8SS	VAX_TYP_8SS
define	VAX_BTYP_46	VAX_BTYP_46
define	VAX_BTYP_48	VAX_BTYP_48
@


1.1
log
@sync with netbsd of early april; some archs still untested
@
text
@d1 1
a1 1
#	$OpenBSD$
d110 2
@


1.1.8.1
log
@Continue the aborted merge of current just before 2.9 was cut into the
SMP branch.  Note that this will not make any progress of SMP functionality,
it is just merging of new code from the trunk into the old branch.
Please do not ask me questions about SMP status because of this mail,
instead go read the archives of smp@@openbsd.org, where I mailed about
these commits some week ago.  Another note: I am doing this in chunks now,
so as to not lock too much of the tree for long times
@
text
@d1 1
a1 1
#	$OpenBSD: genassym.cf,v 1.1 2000/04/27 01:10:11 bjc Exp $
@


1.1.8.2
log
@Sync the SMP branch to something just after 3.0
@
text
@d1 1
a1 1
#	$OpenBSD: genassym.cf,v 1.1.8.1 2001/05/14 21:38:51 niklas Exp $
d34 1
d48 12
a59 15
struct	proc
member	p_priority
member	p_addr
member	p_vmspace

struct	pcb
member	P0BR
member	P0LR
member	P1BR
member	P1LR
member	iftrap

struct	cpu_dep
member	MCHK		cpu_mchk
member	MEMERR		cpu_memerr
d61 1
a61 1
export	KERNBASE
d64 13
a76 13
export	PR_KSP
export	PR_USP
export	PR_ICCS
export	PR_PCBB
export	PR_IPL
export	PR_SBIFS
export	PR_EHSR
export	PR_MCESR
export	PR_P0BR
export	PR_P1BR
export	PR_P0LR
export	PR_P1LR
export	PR_SCBB
d79 16
a94 16
export	T_KSPNOTVAL
export	T_PRIVINFLT
export	T_XFCFLT
export	T_RESOPFLT
export	T_RESADFLT
export	T_TRANSFLT
export	T_PTEFETCH
export	T_WRITE	
export	T_ACCFLT
export	T_PTELEN
export	T_TRCTRAP
export	T_BPTFLT
export	T_ARITHFLT
export	T_SYSCALL
export	T_ASTFLT
export	T_KDBTRAP
d97 21
a117 24
export	NETISR_IP
export	NETISR_ARP
export	NETISR_NS
export	NETISR_ATALK
export	NETISR_ISO
export	NETISR_CCITT
export	NETISR_PPP
export	NETISR_IPV6
export 	NETISR_BRIDGE

export	USPACE	

export	ENAMETOOLONG

struct	evcnt
member	ev_count

export	SYS_sigreturn
export	SYS_exit

export	VAX_TYP_UV2
export	VAX_TYP_8SS
export	VAX_BTYP_46
export	VAX_BTYP_48
@


1.1.8.3
log
@Merge in trunk
@
text
@d1 1
a1 1
#	$OpenBSD$
a110 1
export	EFAULT
@


1.1.8.4
log
@set SONPROC. tested millert@@
@
text
@d1 1
a1 1
#	$OpenBSD: genassym.cf,v 1.1.8.3 2002/03/06 02:04:48 niklas Exp $
a50 3
member	p_stat

export	SONPROC
@


