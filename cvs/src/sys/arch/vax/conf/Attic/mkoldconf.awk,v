head	1.4;
access;
symbols
	SMP_SYNC_A:1.4
	SMP_SYNC_B:1.4
	UBC_SYNC_A:1.4
	UBC_SYNC_B:1.4
	SMP:1.4.0.2
	OPENBSD_2_0:1.3.0.2
	OPENBSD_2_0_BASE:1.3
	netbsd_1_1:1.1.1.1;
locks; strict;
comment	@# @;


1.4
date	97.01.15.23.24.31;	author maja;	state dead;
branches;
next	1.3;

1.3
date	96.05.03.09.09.10;	author mickey;	state Exp;
branches;
next	1.2;

1.2
date	95.12.18.16.43.26;	author deraadt;	state Exp;
branches;
next	1.1;

1.1
date	95.10.18.08.52.04;	author deraadt;	state Exp;
branches
	1.1.1.1;
next	;

1.1.1.1
date	95.10.18.08.52.04;	author deraadt;	state Exp;
branches;
next	;


desc
@@


1.4
log
@sync with NetBSD 970112 -moj
@
text
@#!/usr/bin/awk -f
#
# $NetBSD: mkoldconf.awk,v 1.7 1996/03/17 22:56:31 ragge Exp $
#

/tms_cd/{
	tmsplats[ntms]=$3;
	tmsaddr[ntms]=$6;
	ntms++;
}

/ts_cd/{
	tsplats[nts]=$3;
	tsaddr[nts]=$6;
	nts++;
}

/ra_cd/{
	raplats[nra]=$3;
	raaddr[nra]=$6;
	nra++;
}

{
	if(savenext==1){
		l=sprintf("%d",$3)
		udanummer[l-1]=nuda-1
		savenext=0;
	}
}


{
	if(tmssavenext==1){
		l=sprintf("%d",$3)
		tmsnummer[l-1]=ntmscp-1
		tmssavenext=0;
	}
	if(tssavenext==1){
		l=sprintf("%d",$3)
		tsnummer[l-1]=nts-1
		tssavenext=0;
	}
}

/tmscp_cd/{
	tmscpplats[ntmscp]=$3;
	tmscpaddr[ntmscp]=$6;
	ntmscp++;
	tmssavenext=1;
}
		
/uda_cd/{
	udaplats[nuda]=$3;
	udaddr[nuda]=$6;
	nuda++;
	savenext=1;
}
		

/};/{
	k=0;
	m=0;
}

{
	if (k==1){
		for(i=1;i<NF+1;i++){
			loc[loccnt+i]=$i;
		}
		loccnt+=NF;
	}
}

/static int loc/{
	k=1;
	loccnt=0;
}

{
	if(m==1){
		for(i=1;i<NF+1;i++){
			pv[i]=$i;
		}
	}
}

/static short pv/{
	m=1;
}

END{

printf "#include <sys/param.h>\n"
printf "#include <machine/pte.h>\n"
printf "#include <sys/buf.h>\n"
printf "#include <sys/map.h>\n"

printf "#include <vax/uba/ubavar.h>\n"

printf "int antal_ra=%d;\n",nra-1
printf "int antal_uda=%d;\n",nuda-1
printf "int antal_ts=%d;\n",nts-1
printf "int antal_tms=%d;\n",ntms-1
printf "int antal_tmscp=%d;\n",ntmscp-1

printf "extern struct uba_driver udadriver;\n"
if(nts) printf "extern struct uba_driver tsdriver;\n"
if(nts) printf "void tsintr();\n"
if(ntms) printf "extern struct uba_driver tmscpdriver;\n"
if(ntms) printf "void tmscpintr();\n"
printf "void udaintr();\n"
printf "int ra_cd=0, ra_ca=0, tms_cd=0, tms_ca=0;\n"
printf "#define C (caddr_t)\n"

printf "struct uba_ctlr ubminit[]={\n"
for(i=1;i<nuda;i++){
	k=sprintf("%d",udaddr[i])
	printf "	{ &udadriver, %d,'?',0,udaintr,C %s},\n",
		udaplats[i],loc[k+1]
}
for(i=1;i<nts;i++){
	k=sprintf("%d",tsaddr[i])
if(nts)printf "        { &tsdriver, %d,'?',0,tsintr,C %s},\n",
	tsplats[i],loc[k+1]
}
for(i=1;i<ntmscp;i++){
	k=sprintf("%d",tmscpaddr[i])
if(ntms)printf "        { &tmscpdriver, %d,'?',0,tmscpintr,C %s},\n",
	tmscpplats[i],loc[k+1]
}
printf "0};\n"

printf "struct uba_device ubdinit[]={\n"
for(i=1;i<nra;i++){
	k=sprintf("%d",raaddr[i])
	printf "	{ &udadriver,%d,%d,'?',%d,0,0,1,0},\n",raplats[i],
		rr++/4,loc[k+1]
}
for(i=1;i<nts;i++){
	k=sprintf("%d",tsaddr[i])
	printf "	{&tsdriver,%d,0,'?',0,0,C 0,1,0},\n",tsplats[i]
}
for(i=1;i<ntms;i++){
	k=sprintf("%d",tmsaddr[i])
	printf "	{&tmscpdriver,%d,0,'?',0,0,C 0,1,0},\n",tmsplats[i]
}
printf "0};\n"

}

@


1.3
log
@sync w/ 0430
@
text
@@


1.2
log
@update from netbsd
@
text
@d3 1
a3 1
# $NetBSD: mkoldconf.awk,v 1.4 1995/12/16 15:05:03 ragge Exp $
d6 3
a8 3
/tmscd/{
	tmsplats[ntms]=$2;
	tmsaddr[ntms]=$5;
d12 3
a14 3
/tscd/{
	tsplats[nts]=$2;
	tsaddr[nts]=$5;
d18 3
a20 3
/racd/{
	raplats[nra]=$2;
	raaddr[nra]=$5;
d26 1
a26 1
		l=sprintf("%d",$2)
d35 1
a35 1
		l=sprintf("%d",$2)
d40 1
a40 1
		l=sprintf("%d",$2)
d46 3
a48 3
/tmscpcd/{
	tmscpplats[ntmscp]=$2;
	tmscpaddr[ntmscp]=$5;
d53 3
a55 3
/udacd/{
	udaplats[nuda]=$2;
	udaddr[nuda]=$5;
d94 4
a97 4
printf "#include \"sys/param.h\"\n"
printf "#include \"machine/pte.h\"\n"
printf "#include \"sys/buf.h\"\n"
printf "#include \"sys/map.h\"\n"
d99 1
a99 1
printf "#include \"vax/uba/ubavar.h\"\n"
d113 1
a113 1
printf "int racd=0, tmscd=0;\n"
d119 1
a119 1
	printf "	{ &udadriver, %d,0,0,udaintr,C %s},\n",
d137 1
a137 1
	printf "	{ &udadriver,%d,%d,0,%d,0,0,1,0},\n",raplats[i],
@


1.1
log
@Initial revision
@
text
@d3 1
a3 1
# $NetBSD: mkoldconf.awk,v 1.3 1995/03/29 22:50:51 ragge Exp $
d12 6
a23 12
/decd/{
	deplats[nde]=$2;
	deaddr[nde]=$5;
	nde++;
}

/qecd/{
	qeplats[nqe]=$2;
	qeaddr[nqe]=$5;
	nqe++;
}

d39 5
a101 1
printf "int antal_de=%d;\n",nde-1
d103 1
d108 2
a109 2
printf "extern struct uba_driver dedriver;\n"
printf "extern struct uba_driver qedriver;\n"
d111 3
a113 5
if(ntms) printf "int tmscpintr();\n"
printf "int deintr();\n"
printf "int qeintr();\n"
printf "int udaintr();\n"
printf "int udacd=0, racd=0, tmscpcd=0, tmscd=0;\n"
d122 5
d140 3
a142 9
for(i=1;i<nde;i++){
	k=sprintf("%d",deaddr[i])
	printf "	{&dedriver,%d,-1,0,-1,deintr,C %s0,0},\n",deplats[i],
		loc[k+1]
}
for(i=1;i<nqe;i++){
	k=sprintf("%d",qeaddr[i])
	printf "	{&qedriver,%d,-1,0,-1,qeintr,C %s0,0},\n",qeplats[i],
		loc[k+1]
@


1.1.1.1
log
@initial import of NetBSD tree
@
text
@@
