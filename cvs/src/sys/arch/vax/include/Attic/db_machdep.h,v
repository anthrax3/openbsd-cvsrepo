head	1.19;
access;
symbols
	OPENBSD_5_9:1.17.0.6
	OPENBSD_5_9_BASE:1.17
	OPENBSD_5_8:1.17.0.8
	OPENBSD_5_8_BASE:1.17
	OPENBSD_5_7:1.17.0.2
	OPENBSD_5_7_BASE:1.17
	OPENBSD_5_6:1.17.0.4
	OPENBSD_5_6_BASE:1.17
	OPENBSD_5_5:1.16.0.4
	OPENBSD_5_5_BASE:1.16
	OPENBSD_5_4:1.15.0.2
	OPENBSD_5_4_BASE:1.15
	OPENBSD_5_3:1.14.0.8
	OPENBSD_5_3_BASE:1.14
	OPENBSD_5_2:1.14.0.6
	OPENBSD_5_2_BASE:1.14
	OPENBSD_5_1_BASE:1.14
	OPENBSD_5_1:1.14.0.4
	OPENBSD_5_0:1.14.0.2
	OPENBSD_5_0_BASE:1.14
	OPENBSD_4_9:1.13.0.2
	OPENBSD_4_9_BASE:1.13
	OPENBSD_4_8:1.12.0.10
	OPENBSD_4_8_BASE:1.12
	OPENBSD_4_7:1.12.0.6
	OPENBSD_4_7_BASE:1.12
	OPENBSD_4_6:1.12.0.8
	OPENBSD_4_6_BASE:1.12
	OPENBSD_4_5:1.12.0.4
	OPENBSD_4_5_BASE:1.12
	OPENBSD_4_4:1.12.0.2
	OPENBSD_4_4_BASE:1.12
	OPENBSD_4_3:1.11.0.10
	OPENBSD_4_3_BASE:1.11
	OPENBSD_4_2:1.11.0.8
	OPENBSD_4_2_BASE:1.11
	OPENBSD_4_1:1.11.0.6
	OPENBSD_4_1_BASE:1.11
	OPENBSD_4_0:1.11.0.4
	OPENBSD_4_0_BASE:1.11
	OPENBSD_3_9:1.11.0.2
	OPENBSD_3_9_BASE:1.11
	OPENBSD_3_8:1.10.0.4
	OPENBSD_3_8_BASE:1.10
	OPENBSD_3_7:1.10.0.2
	OPENBSD_3_7_BASE:1.10
	OPENBSD_3_6:1.9.0.12
	OPENBSD_3_6_BASE:1.9
	SMP_SYNC_A:1.9
	SMP_SYNC_B:1.9
	OPENBSD_3_5:1.9.0.10
	OPENBSD_3_5_BASE:1.9
	OPENBSD_3_4:1.9.0.8
	OPENBSD_3_4_BASE:1.9
	UBC_SYNC_A:1.9
	OPENBSD_3_3:1.9.0.6
	OPENBSD_3_3_BASE:1.9
	OPENBSD_3_2:1.9.0.4
	OPENBSD_3_2_BASE:1.9
	OPENBSD_3_1:1.9.0.2
	OPENBSD_3_1_BASE:1.9
	UBC_SYNC_B:1.9
	UBC:1.8.0.2
	UBC_BASE:1.8
	OPENBSD_3_0:1.7.0.8
	OPENBSD_3_0_BASE:1.7
	OPENBSD_2_9_BASE:1.7
	OPENBSD_2_9:1.7.0.6
	OPENBSD_2_8:1.7.0.4
	OPENBSD_2_8_BASE:1.7
	OPENBSD_2_7:1.7.0.2
	OPENBSD_2_7_BASE:1.7
	SMP:1.6.0.12
	SMP_BASE:1.6
	kame_19991208:1.6
	OPENBSD_2_6:1.6.0.10
	OPENBSD_2_6_BASE:1.6
	OPENBSD_2_5:1.6.0.8
	OPENBSD_2_5_BASE:1.6
	OPENBSD_2_4:1.6.0.6
	OPENBSD_2_4_BASE:1.6
	OPENBSD_2_3:1.6.0.4
	OPENBSD_2_3_BASE:1.6
	OPENBSD_2_2:1.6.0.2
	OPENBSD_2_2_BASE:1.6
	OPENBSD_2_1:1.3.0.2
	OPENBSD_2_1_BASE:1.3
	OPENBSD_2_0:1.2.0.2
	OPENBSD_2_0_BASE:1.2
	netbsd_1_1:1.1.1.1;
locks; strict;
comment	@ * @;


1.19
date	2016.03.09.16.28.48;	author deraadt;	state dead;
branches;
next	1.18;
commitid	OSDG2O3Cgeifnf1W;

1.18
date	2016.02.27.13.08.07;	author mpi;	state Exp;
branches;
next	1.17;
commitid	hnv9KfQtxhCytAnd;

1.17
date	2014.03.16.20.31.46;	author guenther;	state Exp;
branches;
next	1.16;

1.16
date	2013.10.17.08.02.17;	author deraadt;	state Exp;
branches;
next	1.15;

1.15
date	2013.07.05.21.10.50;	author miod;	state Exp;
branches;
next	1.14;

1.14
date	2011.03.23.16.54.37;	author pirofti;	state Exp;
branches;
next	1.13;

1.13
date	2010.11.27.19.57.23;	author miod;	state Exp;
branches;
next	1.12;

1.12
date	2008.03.30.18.24.02;	author miod;	state Exp;
branches;
next	1.11;

1.11
date	2005.11.06.22.21.30;	author miod;	state Exp;
branches;
next	1.10;

1.10
date	2005.01.04.21.14.35;	author espie;	state Exp;
branches;
next	1.9;

1.9
date	2002.03.14.01.26.48;	author millert;	state Exp;
branches;
next	1.8;

1.8
date	2001.11.06.19.53.17;	author miod;	state Exp;
branches
	1.8.2.1;
next	1.7;

1.7
date	2000.04.26.03.08.41;	author bjc;	state Exp;
branches;
next	1.6;

1.6
date	97.09.12.09.21.19;	author maja;	state Exp;
branches
	1.6.12.1;
next	1.5;

1.5
date	97.09.10.11.47.05;	author maja;	state Exp;
branches;
next	1.4;

1.4
date	97.05.29.00.04.37;	author niklas;	state Exp;
branches;
next	1.3;

1.3
date	97.03.21.00.48.50;	author niklas;	state Exp;
branches;
next	1.2;

1.2
date	96.05.03.09.09.36;	author mickey;	state Exp;
branches;
next	1.1;

1.1
date	95.10.18.08.52.06;	author deraadt;	state Exp;
branches
	1.1.1.1;
next	;

1.1.1.1
date	95.10.18.08.52.06;	author deraadt;	state Exp;
branches;
next	;

1.6.12.1
date	2001.05.14.21.37.59;	author niklas;	state Exp;
branches;
next	1.6.12.2;

1.6.12.2
date	2001.11.13.21.04.18;	author niklas;	state Exp;
branches;
next	1.6.12.3;

1.6.12.3
date	2002.03.28.11.26.46;	author niklas;	state Exp;
branches;
next	;

1.8.2.1
date	2002.06.11.03.39.19;	author art;	state Exp;
branches;
next	;


desc
@@


1.19
log
@We are done providing support for the vax.
lots of agreement.
@
text
@/*	$OpenBSD: db_machdep.h,v 1.18 2016/02/27 13:08:07 mpi Exp $	*/
/*	$NetBSD: db_machdep.h,v 1.6 1998/08/10 14:33:33 ragge Exp $	*/

/* 
 * Mach Operating System
 * Copyright (c) 1991,1990 Carnegie Mellon University
 * All Rights Reserved.
 * 
 * Permission to use, copy, modify and distribute this software and its
 * documentation is hereby granted, provided that both the copyright
 * notice and this permission notice appear in all copies of the
 * software, derivative works or modified versions, and any portions
 * thereof, and that both notices appear in supporting documentation.
 * 
 * CARNEGIE MELLON ALLOWS FREE USE OF THIS SOFTWARE IN ITS "AS IS"
 * CONDITION.  CARNEGIE MELLON DISCLAIMS ANY LIABILITY OF ANY KIND FOR
 * ANY DAMAGES WHATSOEVER RESULTING FROM THE USE OF THIS SOFTWARE.
 * 
 * Carnegie Mellon requests users of this software to return to
 * 
 *  Software Distribution Coordinator  or  Software.Distribution@@CS.CMU.EDU
 *  School of Computer Science
 *  Carnegie Mellon University
 *  Pittsburgh PA 15213-3890
 * 
 * any improvements or extensions that they make and grant Carnegie Mellon
 * the rights to redistribute these changes.
 */

#ifndef	_MACHINE_DB_MACHDEP_H_
#define	_MACHINE_DB_MACHDEP_H_

/*
 * Machine-dependent defines for new kernel debugger.
 * Modified for vax out of i386 code.
 */

#include <sys/param.h>
#include <uvm/uvm_extern.h>
#include <machine/trap.h>
#include <machine/psl.h>

typedef	vaddr_t	db_addr_t;		/* address - unsigned */
typedef	long		db_expr_t;	/* expression - signed */

typedef struct trapframe db_regs_t;
extern db_regs_t	ddb_regs;	/* register state */
#define	DDB_REGS	(&ddb_regs)

#define	PC_REGS(regs)	((db_addr_t)(regs)->pc)
#define	SET_PC_REGS(regs, value)	(regs)->pc = (long)(value)

#define	BKPT_INST	0x03		/* breakpoint instruction */
#define	BKPT_SIZE	(1)		/* size of breakpoint inst */
#define	BKPT_SET(inst)	(BKPT_INST)

#define	FIXUP_PC_AFTER_BREAK(regs)	((regs)->pc -= BKPT_SIZE)

#define	db_clear_single_step(regs)	((regs)->psl &= ~PSL_T)
#define	db_set_single_step(regs)	((regs)->psl |=  PSL_T)

#define	IS_BREAKPOINT_TRAP(type, code)	((type) == T_BPTFLT)
#define IS_WATCHPOINT_TRAP(type, code)	((type) == T_TRCTRAP)

#define	I_CALL		0xfb
#define	I_RET		0x04
#define	I_IRET		0x02

#define	inst_trap_return(ins)	(((ins)&0xff) == I_IRET)
#define	inst_return(ins)	(((ins)&0xff) == I_RET)
#define	inst_call(ins)		(((ins)&0xff) == I_CALL)

/* Prototypes */
void	db_ktrap(struct trapframe *);

#endif	/* _MACHINE_DB_MACHDEP_H_ */
@


1.18
log
@Rename kdb_trap() into db_ktrap().

The goal is to include it in the list of functions that must not be
instrumented.  All ddb(8) functions should be in this list and have
their names start with 'db_'.

ok visa@@, deraadt@@
@
text
@d1 1
a1 1
/*	$OpenBSD: db_machdep.h,v 1.17 2014/03/16 20:31:46 guenther Exp $	*/
@


1.17
log
@DDB supports ELF symbols are all archs, and it's always the same as the
native size, so eliminate the #defines.

ok miod@@
@
text
@d1 1
a1 1
/*	$OpenBSD: db_machdep.h,v 1.16 2013/10/17 08:02:17 deraadt Exp $	*/
d74 1
a74 1
void	kdb_trap(struct trapframe *);
@


1.16
log
@Remove support for a.out and ecoff.  We only do elf now.
ok miod
@
text
@d1 1
a1 1
/*	$OpenBSD: db_machdep.h,v 1.15 2013/07/05 21:10:50 miod Exp $	*/
a74 3

#define	DB_ELF_SYMBOLS
#define	DB_ELFSIZE	32
@


1.15
log
@VAX ELF userland bits. Consists mostly of register prefix additions.
@
text
@d1 1
a1 1
/*	$OpenBSD: db_machdep.h,v 1.14 2011/03/23 16:54:37 pirofti Exp $	*/
a75 1
#ifdef __ELF__
a77 3
#else
#define	DB_AOUT_SYMBOLS
#endif
@


1.14
log
@Normalize sentinel. Use _MACHINE_*_H_ and _<ARCH>_*_H_ properly and consitently.

Discussed and okay drahn@@. Okay deraadt@@.
@
text
@d1 1
a1 1
/*	$OpenBSD: db_machdep.h,v 1.13 2010/11/27 19:57:23 miod Exp $	*/
d76 4
a79 3
/*
 * We use a.out symbols in DDB.
 */
d81 1
@


1.13
log
@Remove ddb single-step load and store counters. Most platforms do not
implement them, and they are of questionable usefulness.
@
text
@d1 1
a1 1
/*	$OpenBSD: db_machdep.h,v 1.12 2008/03/30 18:24:02 miod Exp $	*/
d30 2
a31 2
#ifndef	_VAX_DB_MACHDEP_H_
#define	_VAX_DB_MACHDEP_H_
d81 1
a81 1
#endif	/* _VAX_DB_MACHDEP_H_ */
@


1.12
log
@Nuke common.
@
text
@d1 1
a1 1
/*	$OpenBSD: db_machdep.h,v 1.11 2005/11/06 22:21:30 miod Exp $	*/
a71 3

#define inst_load(ins)		0
#define inst_store(ins)		0
@


1.11
log
@Kill deprecated vm_offset_t and vm_size_t types on vax.
@
text
@d1 1
a1 1
/*	$OpenBSD: db_machdep.h,v 1.10 2005/01/04 21:14:35 espie Exp $	*/
d47 1
a47 1
db_regs_t	ddb_regs;	/* register state */
@


1.10
log
@SET_PC_REGS, arches tested between me and miod.
@
text
@d1 1
a1 1
/*	$OpenBSD: db_machdep.h,v 1.9 2002/03/14 01:26:48 millert Exp $	*/
d43 1
a43 1
typedef	vm_offset_t	db_addr_t;	/* address - unsigned */
@


1.9
log
@First round of __P removal in sys
@
text
@d1 1
a1 1
/*	$OpenBSD: db_machdep.h,v 1.8 2001/11/06 19:53:17 miod Exp $	*/
d51 1
@


1.8
log
@Replace inclusion of <vm/foo.h> with the correct <uvm/bar.h> when necessary.
(Look ma, I might have broken the tree)
@
text
@d1 1
a1 1
/*	$OpenBSD: db_machdep.h,v 1.7 2000/04/26 03:08:41 bjc Exp $	*/
d76 1
a76 1
void	kdb_trap __P((struct trapframe *));
@


1.8.2.1
log
@Sync UBC branch to -current
@
text
@d1 1
a1 1
/*	$OpenBSD: db_machdep.h,v 1.8 2001/11/06 19:53:17 miod Exp $	*/
d76 1
a76 1
void	kdb_trap(struct trapframe *);
@


1.7
log
@vax resurrection, part 1: sync with early-april netbsd

many changes here, notable:  uvm, ansi.h, more (and cleaner) vsbus support
@
text
@d1 1
a1 1
/*	$OpenBSD: db_machdep.h,v 1.6 1997/09/12 09:21:19 maja Exp $	*/
d39 1
a39 1
#include <vm/vm.h>
@


1.6
log
@Sync with NetBSD 970827. -moj
@
text
@d1 2
a2 2
/*	$OpenBSD: db_machdep.h,v 1.5 1997/09/10 11:47:05 maja Exp $	*/
/*	$NetBSD: db_machdep.h,v 1.4 1997/06/26 01:27:01 thorpej Exp $	*/
d41 1
d44 1
a44 1
typedef	int		db_expr_t;	/* expression - signed */
d77 6
@


1.6.12.1
log
@Continue the aborted merge of current just before 2.9 was cut into the
SMP branch.  Note that this will not make any progress of SMP functionality,
it is just merging of new code from the trunk into the old branch.
Please do not ask me questions about SMP status because of this mail,
instead go read the archives of smp@@openbsd.org, where I mailed about
these commits some week ago.  Another note: I am doing this in chunks now,
so as to not lock too much of the tree for long times
@
text
@d1 2
a2 2
/*	$OpenBSD: db_machdep.h,v 1.7 2000/04/26 03:08:41 bjc Exp $	*/
/*	$NetBSD: db_machdep.h,v 1.6 1998/08/10 14:33:33 ragge Exp $	*/
a40 1
#include <machine/psl.h>
d43 1
a43 1
typedef	long		db_expr_t;	/* expression - signed */
a75 6

/*
 * We use a.out symbols in DDB.
 */
#define	DB_AOUT_SYMBOLS

@


1.6.12.2
log
@Merge in -current
@
text
@d1 1
a1 1
/*	$OpenBSD$	*/
d39 1
a39 1
#include <uvm/uvm_extern.h>
@


1.6.12.3
log
@Merge in -current from about a week ago
@
text
@d76 1
a76 1
void	kdb_trap(struct trapframe *);
@


1.5
log
@Sync with NetBSD 970516. -moj
@
text
@d1 2
a2 2
/*	$OpenBSD: db_machdep.h,v 1.4 1997/05/29 00:04:37 niklas Exp $	*/
/*	$NetBSD: db_machdep.h,v 1.3 1997/02/06 21:17:05 gwr Exp $	*/
@


1.4
log
@RCS tagging
@
text
@d1 2
a2 2
/*	$OpenBSD: db_machdep.h,v 1.2 1996/04/08 18:35:47 ragge Exp $	*/
/*	$NetBSD: db_machdep.h,v 1.2 1996/04/08 18:35:47 ragge Exp $	*/
@


1.3
log
@New FIXUP_PC_AFTER_BREAK convention from NetBSD
@
text
@d1 1
@


1.2
log
@sync w/ 0430
@
text
@d54 1
a54 1
#define	FIXUP_PC_AFTER_BREAK		ddb_regs.pc -= BKPT_SIZE;
@


1.1
log
@Initial revision
@
text
@d1 1
a1 1
/*	$NetBSD: db_machdep.h,v 1.1 1995/06/16 15:17:27 ragge Exp $	*/
d73 2
@


1.1.1.1
log
@initial import of NetBSD tree
@
text
@@
