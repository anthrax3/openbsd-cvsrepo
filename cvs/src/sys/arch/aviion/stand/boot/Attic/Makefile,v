head	1.8;
access;
symbols
	OPENBSD_5_8:1.7.0.4
	OPENBSD_5_8_BASE:1.7
	OPENBSD_5_7:1.6.0.2
	OPENBSD_5_7_BASE:1.6
	OPENBSD_5_6:1.6.0.4
	OPENBSD_5_6_BASE:1.6
	OPENBSD_5_5:1.5.0.4
	OPENBSD_5_5_BASE:1.5;
locks; strict;
comment	@# @;


1.8
date	2015.12.01.07.50.04;	author deraadt;	state dead;
branches;
next	1.7;
commitid	Rh8AZFtVMVCiwPts;

1.7
date	2015.06.14.19.37.11;	author miod;	state Exp;
branches;
next	1.6;
commitid	D6jTKm551T4M70FH;

1.6
date	2014.07.13.21.18.44;	author jasper;	state Exp;
branches;
next	1.5;
commitid	Y3LcLObEiHDZvy27;

1.5
date	2013.10.17.16.44.22;	author miod;	state Exp;
branches;
next	1.4;

1.4
date	2013.10.17.16.30.07;	author miod;	state Exp;
branches;
next	1.3;

1.3
date	2013.10.16.16.59.33;	author miod;	state Exp;
branches;
next	1.2;

1.2
date	2013.10.10.21.22.06;	author miod;	state Exp;
branches;
next	1.1;

1.1
date	2013.10.08.21.55.20;	author miod;	state Exp;
branches;
next	;


desc
@@


1.8
log
@Send Aviion to same place as Nova II
discussed with jsg
@
text
@#	$OpenBSD: Makefile,v 1.7 2015/06/14 19:37:11 miod Exp $

SIZE?=	size

S=	${.CURDIR}/../../../..
DEFS=	-DSUN_BOOTPARAMS
#DEFS+=	-DNETIF_DEBUG
INCPATH=-I${.CURDIR} -I${.CURDIR}/../libsa -I${.CURDIR}/../libprom \
	-I${S} -I${S}/lib/libsa
CFLAGS+=${DEFS} ${INCPATH} ${COPTS} -DSTAGE1_RELOC=${STAGE1_RELOC}
CLEANFILES+=boot boot.ELF

.include "${S}/arch/aviion/stand/Makefile.inc"
.include "${S}/arch/aviion/stand/libprom/Makefile.inc"
.include "${S}/arch/aviion/stand/libsa/Makefile.inc"
.include "${S}/arch/aviion/stand/libz/Makefile.inc"

# Keep crt.c first in the object list for ld's sake.
SRCS=	crt.c boot.c conf.c devopen.c version.c
SRCS+=	oaic.c oosiop.c scsi.c sd.c
SRCS+=	dev_net.c if_le.c
.PATH:	${S}/lib/libkern
SRCS+=	moddi3.c muldi3.c negdi2.c qdivrem.c
OBJS=  ${SRCS:S/.c/.o/g}
LIBS=	${LIBSA} ${LIBPROM} ${LIBZ}
LDFLAGS+= -N -Ttext ${STAGE2_RELOC} -e start
NOPIE=

all:	boot

boot: boot.ELF
	${MDEC_DIR}/a2coff boot.ELF boot

boot.ELF: ${OBJS} ${LIBS}
	${LD} ${LDFLAGS} -o $@@ ${OBJS} ${LIBS}
	@@${SIZE} $@@

install: boot
	${INSTALL} ${INSTALL_COPY} -o ${LIBOWN} -g ${LIBGRP} -m ${LIBMODE} \
	  boot ${DESTDIR}${MDEC_DIR}/boot

.include <bsd.prog.mk>
@


1.7
log
@Bring a few routines from libkern in order to avoid linking against libgcc.
@
text
@d1 1
a1 1
#	$OpenBSD: Makefile,v 1.6 2014/07/13 21:18:44 jasper Exp $
@


1.6
log
@fix even more trailing tabs
@
text
@d1 1
a1 1
#	$OpenBSD: Makefile,v 1.5 2013/10/17 16:44:22 miod Exp $
d22 2
d35 1
a35 1
	${LD} ${LDFLAGS} -o $@@ ${OBJS} ${LIBS} `${CC} -print-libgcc-file-name`
@


1.5
log
@... and do not set up lance buffers at 3MB. Oh the irony.
@
text
@d1 1
a1 1
#	$OpenBSD: Makefile,v 1.4 2013/10/17 16:30:07 miod Exp $
d6 1
a6 1
DEFS=	-DSUN_BOOTPARAMS 
d20 1
a20 1
SRCS+=	oaic.c oosiop.c scsi.c sd.c 
@


1.4
log
@Merge old netboot le(4) code into new boot, to allow for a kernel to be loaded
from the network, with symbols. This will be useful to load bsd.rd on systems
with the 3MB bootfile limit in the stupid PROM. Crank version to 0.4.
@
text
@d1 1
a1 1
#	$OpenBSD: Makefile,v 1.3 2013/10/16 16:59:33 miod Exp $
d10 1
a10 1
CFLAGS+=${DEFS} ${INCPATH} ${COPTS}
@


1.3
log
@Support for oaic in the boot blocks. Cope with older prom putting a \r at
the end of the commandline. Clean up a few stale comments. Crank boot blocks
version to 0.3.
@
text
@d1 1
a1 1
#	$OpenBSD: Makefile,v 1.2 2013/10/10 21:22:06 miod Exp $
d19 3
a21 1
SRCS=   crt.c boot.c conf.c devopen.c oaic.c oosiop.c scsi.c sd.c version.c
d27 1
a27 1
all:	boot.ELF
d29 2
a30 2
boot: boot.ELF a2coff
	${DESTDIR}${MDEC_DIR}/a2coff boot.ELF boot
a34 3

a2coff:	${DESTDIR}${MDEC_DIR}/a2coff
	cd ${S}/arch/aviion/stand/a2coff && ${MAKE} && ${MAKE} install
@


1.2
log
@Misc cleanups and small fixes. Boot controller/unit/lun information passed
to the kernel will now match the device the kernel is loaded from, not the
device the boot blocks are loaded from (this allows one to netboot the
boot blocks to boot a kernel from a local disk).
@
text
@d1 1
a1 1
#	$OpenBSD: Makefile,v 1.1 2013/10/08 21:55:20 miod Exp $
d19 1
a19 1
SRCS=   crt.c boot.c conf.c devopen.c oosiop.c scsi.c sd.c version.c
@


1.1
log
@Early stages of a working disk bootloader for OpenBSD/aviion.
Currently limited to oosiop(4) controllers, and thus models 4600 and 530.
There are some rough edges to polish to avoid manual interaction (kernel
currently can't figure its boot device when booted from disk), but the hard
(and hair-pulling) work is over.
And we can have kernel symbols again!
@
text
@d1 1
a1 1
#	$OpenBSD: Makefile,v 1.3 2013/09/28 21:59:39 miod Exp $
d19 1
a19 1
SRCS=   crt.c boot.c conf.c devopen.c oosiop.c sd.c version.c
@

