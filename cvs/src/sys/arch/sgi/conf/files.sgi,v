head	1.55;
access;
symbols
	OPENBSD_6_1_BASE:1.55
	OPENBSD_6_0:1.55.0.4
	OPENBSD_6_0_BASE:1.55
	OPENBSD_5_9:1.55.0.2
	OPENBSD_5_9_BASE:1.55
	OPENBSD_5_8:1.53.0.4
	OPENBSD_5_8_BASE:1.53
	OPENBSD_5_7:1.52.0.2
	OPENBSD_5_7_BASE:1.52
	OPENBSD_5_6:1.52.0.6
	OPENBSD_5_6_BASE:1.52
	OPENBSD_5_5:1.52.0.4
	OPENBSD_5_5_BASE:1.52
	OPENBSD_5_4:1.51.0.4
	OPENBSD_5_4_BASE:1.51
	OPENBSD_5_3:1.51.0.2
	OPENBSD_5_3_BASE:1.51
	OPENBSD_5_2:1.50.0.2
	OPENBSD_5_2_BASE:1.50
	OPENBSD_5_1_BASE:1.46
	OPENBSD_5_1:1.46.0.2
	OPENBSD_5_0:1.45.0.6
	OPENBSD_5_0_BASE:1.45
	OPENBSD_4_9:1.45.0.4
	OPENBSD_4_9_BASE:1.45
	OPENBSD_4_8:1.45.0.2
	OPENBSD_4_8_BASE:1.45
	OPENBSD_4_7:1.44.0.2
	OPENBSD_4_7_BASE:1.44
	OPENBSD_4_6:1.27.0.2
	OPENBSD_4_6_BASE:1.27
	OPENBSD_4_5:1.22.0.4
	OPENBSD_4_5_BASE:1.22
	OPENBSD_4_4:1.22.0.2
	OPENBSD_4_4_BASE:1.22
	OPENBSD_4_3:1.20.0.2
	OPENBSD_4_3_BASE:1.20
	OPENBSD_4_2:1.13.0.2
	OPENBSD_4_2_BASE:1.13
	OPENBSD_4_1:1.10.0.8
	OPENBSD_4_1_BASE:1.10
	OPENBSD_4_0:1.10.0.6
	OPENBSD_4_0_BASE:1.10
	OPENBSD_3_9:1.10.0.4
	OPENBSD_3_9_BASE:1.10
	OPENBSD_3_8:1.10.0.2
	OPENBSD_3_8_BASE:1.10
	OPENBSD_3_7:1.9.0.2
	OPENBSD_3_7_BASE:1.9
	OPENBSD_3_6:1.4.0.2
	OPENBSD_3_6_BASE:1.4;
locks; strict;
comment	@# @;


1.55
date	2016.01.08.15.54.13;	author jcs;	state Exp;
branches;
next	1.54;
commitid	kI4H556ZKYkRQGw5;

1.54
date	2015.09.09.15.48.53;	author visa;	state Exp;
branches;
next	1.53;
commitid	LCIA9B8f4l6PgPcB;

1.53
date	2015.07.08.13.37.31;	author dlg;	state Exp;
branches;
next	1.52;
commitid	Ds9kNjjKbF4CbIsT;

1.52
date	2013.11.04.14.07.16;	author deraadt;	state Exp;
branches;
next	1.51;

1.51
date	2012.09.29.21.46.02;	author miod;	state Exp;
branches;
next	1.50;

1.50
date	2012.05.10.21.30.05;	author miod;	state Exp;
branches;
next	1.49;

1.49
date	2012.04.18.17.28.24;	author miod;	state Exp;
branches;
next	1.48;

1.48
date	2012.04.16.22.31.34;	author miod;	state Exp;
branches;
next	1.47;

1.47
date	2012.03.28.20.44.23;	author miod;	state Exp;
branches;
next	1.46;

1.46
date	2011.11.15.22.27.53;	author deraadt;	state Exp;
branches;
next	1.45;

1.45
date	2010.03.22.21.22.08;	author miod;	state Exp;
branches;
next	1.44;

1.44
date	2010.02.01.22.06.27;	author jasper;	state Exp;
branches;
next	1.43;

1.43
date	2010.01.13.22.57.28;	author miod;	state Exp;
branches;
next	1.42;

1.42
date	2009.11.21.23.28.14;	author syuu;	state Exp;
branches;
next	1.41;

1.41
date	2009.11.18.19.03.25;	author miod;	state Exp;
branches;
next	1.40;

1.40
date	2009.11.10.15.50.09;	author jsing;	state Exp;
branches;
next	1.39;

1.39
date	2009.11.08.22.44.14;	author miod;	state Exp;
branches;
next	1.38;

1.38
date	2009.11.07.18.56.55;	author miod;	state Exp;
branches;
next	1.37;

1.37
date	2009.11.01.19.17.56;	author miod;	state Exp;
branches;
next	1.36;

1.36
date	2009.10.26.18.13.31;	author miod;	state Exp;
branches;
next	1.35;

1.35
date	2009.10.26.18.00.04;	author miod;	state Exp;
branches;
next	1.34;

1.34
date	2009.10.21.20.48.45;	author miod;	state Exp;
branches;
next	1.33;

1.33
date	2009.10.07.20.39.43;	author miod;	state Exp;
branches;
next	1.32;

1.32
date	2009.08.18.19.34.14;	author miod;	state Exp;
branches;
next	1.31;

1.31
date	2009.08.13.15.13.11;	author jasper;	state Exp;
branches;
next	1.30;

1.30
date	2009.07.21.21.25.17;	author miod;	state Exp;
branches;
next	1.29;

1.29
date	2009.07.19.19.02.03;	author kettenis;	state Exp;
branches;
next	1.28;

1.28
date	2009.07.13.21.19.22;	author miod;	state Exp;
branches;
next	1.27;

1.27
date	2009.06.24.17.27.40;	author miod;	state Exp;
branches;
next	1.26;

1.26
date	2009.06.13.21.48.03;	author miod;	state Exp;
branches;
next	1.25;

1.25
date	2009.05.02.21.31.17;	author miod;	state Exp;
branches;
next	1.24;

1.24
date	2009.04.13.21.17.52;	author miod;	state Exp;
branches;
next	1.23;

1.23
date	2009.04.12.17.56.56;	author miod;	state Exp;
branches;
next	1.22;

1.22
date	2008.04.07.22.36.26;	author miod;	state Exp;
branches;
next	1.21;

1.21
date	2008.04.07.22.32.44;	author miod;	state Exp;
branches;
next	1.20;

1.20
date	2008.02.20.18.46.20;	author miod;	state Exp;
branches;
next	1.19;

1.19
date	2007.12.31.12.46.14;	author jsing;	state Exp;
branches;
next	1.18;

1.18
date	2007.12.31.11.42.43;	author jsing;	state Exp;
branches;
next	1.17;

1.17
date	2007.12.18.08.29.02;	author jasper;	state Exp;
branches;
next	1.16;

1.16
date	2007.12.14.16.16.28;	author jsing;	state Exp;
branches;
next	1.15;

1.15
date	2007.11.27.15.31.00;	author jsing;	state Exp;
branches;
next	1.14;

1.14
date	2007.10.18.18.59.29;	author jsing;	state Exp;
branches;
next	1.13;

1.13
date	2007.06.21.20.17.12;	author miod;	state Exp;
branches;
next	1.12;

1.12
date	2007.06.18.21.46.41;	author deraadt;	state Exp;
branches;
next	1.11;

1.11
date	2007.05.01.18.59.40;	author miod;	state Exp;
branches;
next	1.10;

1.10
date	2005.05.01.21.36.57;	author brad;	state Exp;
branches;
next	1.9;

1.9
date	2005.03.08.20.00.24;	author tdeval;	state Exp;
branches;
next	1.8;

1.8
date	2005.03.05.23.58.43;	author tdeval;	state Exp;
branches;
next	1.7;

1.7
date	2005.01.02.19.50.30;	author kettenis;	state Exp;
branches;
next	1.6;

1.6
date	2004.10.20.12.49.15;	author pefo;	state Exp;
branches;
next	1.5;

1.5
date	2004.10.08.13.04.36;	author grange;	state Exp;
branches;
next	1.4;

1.4
date	2004.09.09.22.11.39;	author pefo;	state Exp;
branches;
next	1.3;

1.3
date	2004.08.10.19.08.18;	author deraadt;	state Exp;
branches;
next	1.2;

1.2
date	2004.08.10.07.30.56;	author mickey;	state Exp;
branches;
next	1.1;

1.1
date	2004.08.06.21.12.18;	author pefo;	state Exp;
branches;
next	;


desc
@@


1.55
log
@Move HID support files out of dev/usb into new dev/hid directory

These files aren't USB-specific and were used by the previous
Bluetooth implementation, and will be used by the upcoming
HID-over-i2C implementation

ok deraadt
previous version ok kettenis and mpi
@
text
@#	$OpenBSD: files.sgi,v 1.54 2015/09/09 15:48:53 visa Exp $
#
# maxpartitions must be first item in files.${ARCH}
#
maxpartitions 16

maxusers 2 8 64

#	Required files

file	dev/cninit.c
file	arch/sgi/sgi/autoconf.c
file	arch/sgi/sgi/bus_dma.c
file	arch/sgi/sgi/conf.c
file	arch/sgi/sgi/disksubr.c			disk
file	arch/sgi/sgi/ip22_machdep.c		tgt_indigo | tgt_indigo2 |
						tgt_indy
file	arch/sgi/sgi/ip27_machdep.c		tgt_origin
file	arch/sgi/sgi/ip30_machdep.c		tgt_octane
file	arch/sgi/sgi/ip30_nmi.S			tgt_octane & ddb
file	arch/sgi/sgi/ip32_machdep.c		tgt_o2
file	arch/sgi/sgi/l1.c			tgt_origin
file	arch/sgi/sgi/machdep.c
file	arch/sgi/sgi/mainbus.c
file	arch/sgi/sgi/sginode.c			tgt_origin
file	arch/sgi/sgi/wscons_machdep.c		wsdisplay

# RAM disk for boot
major	{rd = 8}

#
# Media Indepedent Interface (mii)
#
include	"dev/mii/files.mii"

#
#	Machine-independent ATAPI drivers
#

include	"dev/atapiscsi/files.atapiscsi"
include	"dev/ata/files.ata"

include	"dev/pckbc/files.pckbc"

#
#	System BUS types
#
define	mainbus {[nasid = -1]}
device	mainbus
attach	mainbus at root

#	Our CPU configurator
device	cpu
attach	cpu at mainbus

#	Clock device
device	clock
attach	clock at mainbus

# Impact/ImpactSR common code
device	impact: wsemuldisplaydev, rasops32
file	arch/sgi/dev/impact.c			impact |
						impact_gio |
						impact_xbow	needs-flag

#
#	IP20/22/24/26/28 specific devices
#
define	giobus {}
device	imc: giobus, eisabus
attach	imc at mainbus
file	arch/sgi/localbus/imc.c			imc

device	int
attach	int at mainbus
file	arch/sgi/localbus/int.c			int

device	tcc
attach	tcc at mainbus
file	arch/sgi/localbus/tcc.c			tcc	needs-flag

include "arch/sgi/gio/files.gio"
include "arch/sgi/hpc/files.hpc"

#
#	O2 MACE localbus autoconfiguration devices
#
define	macebus {[base = -1]}
device	macebus
attach	macebus at mainbus
file	arch/sgi/localbus/macebus.c		macebus

#
#	Origin200/Origin2000 node configuration enumerator, and
#	Octane XBOW mux bridge
#
include "arch/sgi/xbow/files.xbow"

include "dev/onewire/files.onewire"

#
#	PCI Bus bridges
#

device	macepcibr {} : pcibus
attach	macepcibr at macebus
file	arch/sgi/pci/macepcibridge.c		macepcibr

#	Use machine independent SCSI driver routines
include	"scsi/files.scsi"
major	{sd = 0}
major	{cd = 3}

#
#	EISA Bus support
#

include	"dev/eisa/files.eisa"
file	arch/sgi/sgi/eisa_machdep.c		eisa

#
#	PCI Bus support
#

include	"dev/pci/files.pci"
file	arch/sgi/pci/pci_machdep.c		pci

# Sun HME Ethernet controllers
device	hme: ether, ifnet, mii, ifmedia
file	dev/ic/hme.c				hme
attach	hme at pci with hme_pci
file	dev/pci/if_hme_pci.c			hme_pci

# IOC3
define	ioc {[base = -1]}
device	ioc: onewirebus
attach	ioc at pci
file	arch/sgi/pci/ioc.c			ioc

# IOC4
define	iof {[base = -1]}
device	iof
attach	iof at pci
file	arch/sgi/pci/iof.c			iof

# IOC3/4 serial ports
attach	com at ioc with com_ioc
file	arch/sgi/dev/com_ioc.c			com_ioc
attach	com at iof with com_iof
file	arch/sgi/dev/com_iof.c			com_iof

# IOC3 onboard Ethernet
device	iec: ether, ifnet, ifmedia, mii
attach	iec at ioc
file	arch/sgi/dev/if_iec.c			iec

# IOC3/4 PS/2 controller
device	iockbc: pckbcslot
attach	iockbc at ioc with iockbc_ioc
attach	iockbc at iof with iockbc_iof
file	arch/sgi/dev/iockbc.c			iockbc |
						iockbc_ioc | iockbc_iof
							needs-flag

# DS1687 Time-Of-Day calendar device
device	dsrtc
attach	dsrtc at ioc with dsrtc_ioc
attach	dsrtc at iof with dsrtc_iof
attach	dsrtc at macebus with dsrtc_macebus
file	arch/sgi/dev/dsrtc.c			dsrtc

# GBE framebuffer
device	gbe: wsemuldisplaydev, rasops8, rasops16, rasops32
attach	gbe at mainbus
file	arch/sgi/dev/gbe.c			gbe	needs-flag

# 16[45]50-based "com" ports on localbus
attach	com at macebus with com_macebus
file	arch/sgi/localbus/com_lbus.c		com_macebus

# MACE MAC-110 ethernet
device	mec: ether, ifnet, ifmedia, mii
attach	mec at macebus
file	arch/sgi/dev/if_mec.c			mec

# Moosehead A/V Board audio
device	mavb: audio
attach	mavb at macebus
file	arch/sgi/dev/mavb.c			mavb

# MACE PS/2 Controller
device	mkbc: pckbcslot
attach	mkbc at macebus
file	arch/sgi/dev/mkbc.c			mkbc	needs-flag

# Power button
device	power
attach	power at macebus with power_macebus
attach	power at mainbus with power_mainbus
file 	arch/sgi/dev/power.c			power |
						power_macebus | power_mainbus
							needs-flag

# Raster operations
include	"dev/rasops/files.rasops"
include	"dev/wsfont/files.wsfont"

#
# wscons console
#
include	"dev/wscons/files.wscons"

#
# CardBus and PCMCIA bus support
#
include	"dev/cardbus/files.cardbus"
include	"dev/pcmcia/files.pcmcia"

#
# Machine-independent HID support
#
include	"dev/hid/files.hid"

#
# Machine-independent USB drivers
#
include	"dev/usb/files.usb"

#
# Number-In-a-Can containers
#
# Ethernet address
device	owmac
attach	owmac at onewire
file	arch/sgi/dev/owmac.c			owmac

# Serial numbers
device	owserial
attach	owserial at onewire
file	arch/sgi/dev/owserial.c			owserial
file	arch/sgi/dev/owmem_subr.c		owmac | owserial

# IP35 SPD memory information
attach	spdmem at mainbus with spdmem_mainbus
file	arch/sgi/dev/spdmem_mainbus.c		spdmem_mainbus
@


1.54
log
@The mplock implementations on MP-enabled mips64 platforms, octeon and
sgi, are identical. Put one implementation in mips64 and drop the
platform-specific copies, to remove duplicated code.

ok miod@@
@
text
@d1 1
a1 1
#	$OpenBSD: files.sgi,v 1.53 2015/07/08 13:37:31 dlg Exp $
d218 5
@


1.53
log
@unify the mutex implementations on all the mips64 platforms.

this basically copies the sgi implementation to mips64 and removes
it from the rest. this way they get an optimised UP mutex implementation
and correct asserts on all platforms.

ok miod@@ jmatthew@@
@
text
@d1 1
a1 1
#	$OpenBSD: files.sgi,v 1.52 2013/11/04 14:07:16 deraadt Exp $
a15 1
file	arch/sgi/sgi/lock_machdep.c		multiprocessor
@


1.52
log
@remove iop(4) driver.  it is entirely unmaintained and supports something
which basically doesn't exist at all.
reminded about it by brad
@
text
@d1 1
a1 1
#	$OpenBSD: files.sgi,v 1.51 2012/09/29 21:46:02 miod Exp $
a25 1
file	arch/sgi/sgi/mutex.c
@


1.51
log
@Work in progress support for the Power Indigo2 R8000 system (IP26). This is
basically an IP22 system (R4000 Indigo2) with the ECC memory board of IP28,
and a so-called ``streaming'' L2 cache.

IP26 kernels currently boot single-user, but don't live long; I am suspecting
a bug in the tcc cache routines, but am currently not able to find it (come
to think of it, my understanding of how this cache works could be wrong, and
of course there is no documentation for it but what can be gathered from
IRIX' <sys/IP26.h> comments and defines).

Hopefully this situation will improve in the near future; in the meantime I
am commiting this as `work in progress' to make sure this code doesn't get
lost.
@
text
@d1 1
a1 1
#	$OpenBSD: files.sgi,v 1.50 2012/05/10 21:30:05 miod Exp $
a114 2

include	"dev/i2o/files.i2o"
@


1.50
log
@Fix impact(4) header file generation to correctly output NIMPACT_GIO on
IP22 kernels. Oops.
@
text
@d1 1
a1 1
#	$OpenBSD: files.sgi,v 1.49 2012/04/18 17:28:24 miod Exp $
d69 1
a69 1
#	IP20/22/24 specific devices
d79 4
@


1.49
log
@Split the existing impact@@xbow attachment into generic impact routines, and
bus-specific attachment; impactreg.h and impactvar.h move from sgi/xbow/ to
sgi/dev/.

Teach the generic impact code how to code with pre-ImpactSR boards, which have
a slightly different register layout (information obtained from Peter Fuerst's
Linux IP28 patches).

Add an impact@@gio attachment (unfortunately untested, no Impact GIO boards
here). All Indigo 2 graphics options should be supported now (assuming the
Extreme/Ultra will actually work with grtwo(4) out of the box).

Tested not to disturb operation on IP30.

** ATTENTION! If you are building IP27 or IP30 kernels, be sure to rm impact.d
** before building a new kernel.
@
text
@d1 1
a1 1
#	$OpenBSD: files.sgi,v 1.48 2012/04/16 22:31:34 miod Exp $
d64 3
a66 1
file	arch/sgi/dev/impact.c			impact		needs-flag
@


1.48
log
@Drivers for the Indy and Indigo 2 PS/2 keyboard ports, and the ``Newport''
(NG1, XL, XGE) frame buffer.
Adapted from NetBSD; newport extended to support underline and fonts wider than
8 pixels, such as the default 12x22 Gallant font. Framebuffer depth computation
seems to be wrong on Indy models, to be investigated later (but doesn't prevent
text console from working).
@
text
@d1 1
a1 1
#	$OpenBSD: files.sgi,v 1.47 2012/03/28 20:44:23 miod Exp $
d61 4
@


1.47
log
@Work in progress support for the SGI Indigo, Indigo 2 and Indy systems
(IP20, IP22, IP24) in 64-bit mode, adapated from NetBSD. Currently limited
to headless operation, input and video drivers will get ported soon.

Should work on all R4000, R4440 and R5000 based systems. L2 cache on R5000SC
Indy not supported yet (coming soon), R4600 not supported yet either (coming
soon as well).

Tested to boot multiuser on: Indigo2 R4000SC, Indy R4000PC, Indy R4000SC,
Indy R5000SC, Indigo2 R4400SC. There are still glitches in the Ethernet driver
which are being looked at.

Expansion support is limited to the GIO E++ board; GIO boards with PCI-GIO
bridges not ported yet due to the lack of hardware, and this kind of driver
does not port blindly.

Most of this work comes from NetBSD, polishing and integration work, as well
as putting as many ``R4x00 in 64-bit mode'' erratas as necessary, by yours
truly.

More work is coming, as well as trying to get some easy way to boot install
kernels (as older PROM can only boot ECOFF binaries, which won't do for the
kernel).
@
text
@d1 1
a1 1
#	$OpenBSD: files.sgi,v 1.46 2011/11/15 22:27:53 deraadt Exp $
d45 2
a185 1
include	"dev/pckbc/files.pckbc"
@


1.46
log
@Simplify various parts of the puc(4) attachment code.  Tested lightly
by krw and myself.
@
text
@d1 1
a1 1
#	$OpenBSD: files.sgi,v 1.45 2010/03/22 21:22:08 miod Exp $
d17 2
d61 15
d107 7
a158 1
attach	dsrtc at macebus with dsrtc_macebus
d161 1
a233 1

@


1.45
log
@On SGI IP35 systems, get SPD memory records from L1 and attach spdmem to
decode them when available; tested on Fuel and Origin 350.
@
text
@d1 1
a1 1
#	$OpenBSD: files.sgi,v 1.44 2010/02/01 22:06:27 jasper Exp $
a94 2

include	"dev/puc/files.puc"
@


1.44
log
@- add and enable puc(4) (only com, i didn't test lpt)

ok miod@@
@
text
@d1 1
a1 1
#	$OpenBSD: files.sgi,v 1.43 2010/01/13 22:57:28 miod Exp $
d208 5
@


1.43
log
@Crude handler for the Octane NMI button, for kernels compiled with
option DDB.
@
text
@d1 1
a1 1
#	$OpenBSD: files.sgi,v 1.42 2009/11/21 23:28:14 syuu Exp $
d95 2
@


1.42
log
@mplock, rw_cas implemented
ok miod@@
@
text
@d1 1
a1 1
#	$OpenBSD: files.sgi,v 1.41 2009/11/18 19:03:25 miod Exp $
d19 1
@


1.41
log
@Add glue to attach iockbc(4) to iof(4) as well. Tested by deraadt@@
@
text
@d1 1
a1 1
#	$OpenBSD: files.sgi,v 1.40 2009/11/10 15:50:09 jsing Exp $
d16 1
@


1.40
log
@Add iockbc(4), a driver for the PS/2 keyboard and mouse interface found on
ioc(4) devices. Joint work with miod@@.

Committed from the glass console on an SGI Fuel.
@
text
@d1 1
a1 1
#	$OpenBSD: files.sgi,v 1.39 2009/11/08 22:44:14 miod Exp $
d123 1
a123 1
# IOC3 PS/2 controller
d125 5
a129 2
attach	iockbc at ioc
file	arch/sgi/dev/iockbc.c			iockbc	needs-flag
@


1.39
log
@Add code to send L1 commands and parse command results; use it to add a way
for IP35 systems with IOC3 onboard Ethernet to get their Ethernet address
since it's no longer stored as an owmac(4) device on the IOC3 device itself.
@
text
@d1 1
a1 1
#	$OpenBSD: files.sgi,v 1.38 2009/11/07 18:56:55 miod Exp $
d122 5
@


1.38
log
@Replace option TGT_ORIGIN200 and TGT_ORIGIN2000 with a single option,
TGT_ORIGIN, which enables support for all IP27 and IP35 systems. The original
two options have always been used together, and go back to when pefo thought
supporting multiple nodes would be significant work. Since an Origin 200
can be a dual-node system, making a distinction between single node and
multiple node systems is a moot point anyway.

Be sure to rerun config(8) before rebuilding a kernel.
@
text
@d1 1
a1 1
#	$OpenBSD: files.sgi,v 1.37 2009/11/01 19:17:56 miod Exp $
d19 1
@


1.37
log
@Driver for the sgi IOC3 onboard Ethernet interface. Tested on Octane only so
far, and needs help to figure out its Ethernet address on IP35 systems.

Heavily derived from mec(4) written by Izumi Tsutsui and Christopher Sekiya,
although it required many changes to fit the IOC3 chip.
@
text
@d1 1
a1 1
#	$OpenBSD: files.sgi,v 1.36 2009/10/26 18:13:31 miod Exp $
d16 1
a16 1
file	arch/sgi/sgi/ip27_machdep.c		tgt_origin200 | tgt_origin2000
d22 1
a22 1
file	arch/sgi/sgi/sginode.c			tgt_origin200 | tgt_origin2000
@


1.36
log
@Add support for the Octane power button to power(4). Took me a while to
figure out how the interrupt was routed from xbridge to xheart... (it bypasses
the regular `have xbridge send a xio interrupt packet' mechanism)
@
text
@d1 1
a1 1
#	$OpenBSD: files.sgi,v 1.35 2009/10/26 18:00:04 miod Exp $
d116 5
@


1.35
log
@Better crime/mace interrupt handling; interrupt information is no longer
specified in the kernel configuration file, but is provided by macebus(4)
as part of the  child device attachment args, and provide both crime and
mace interrupt bitmasks; this allows us to only really enable interrupt
sources we care about, and to avoid invoking interrupt handler we don't need
to for the few mace interrupts multiplexed at the crime level.
@
text
@d1 1
a1 1
#	$OpenBSD: files.sgi,v 1.34 2009/10/21 20:48:45 miod Exp $
d151 5
a155 2
attach	power at macebus
file 	arch/sgi/dev/power.c			power
@


1.34
log
@Replace IP32 hw_setintrmask() .S routine with a two line C routine.
@
text
@d1 1
a1 1
#	$OpenBSD: files.sgi,v 1.33 2009/10/07 20:39:43 miod Exp $
d58 1
a58 1
define	macebus {[base = -1], [irq = -1]}
@


1.33
log
@Attach DS1742 style dsrtc to iof (IOC4) too.
@
text
@d1 1
a1 1
#	$OpenBSD: files.sgi,v 1.32 2009/08/18 19:34:14 miod Exp $
a61 1
file	arch/sgi/localbus/macectrl.S		macebus
@


1.32
log
@Blind partial support for IOC4 chip, found on IO8 and IO9 base I/O boards on
Origin 350 and Tezro systems. While this chip provides serial ports, an ATAPI
interface and a PS/2 keyboard and mouse interface, this code currently only
attempts to support the serial ports.
@
text
@d1 1
a1 1
#	$OpenBSD: files.sgi,v 1.31 2009/08/13 15:13:11 jasper Exp $
d122 1
@


1.31
log
@- remove the ef(4) chunk, it's unused now and the ioc ethernet driver
won't be called ef(4) anyway.

ok miod@@
@
text
@d1 1
a1 1
#	$OpenBSD: files.sgi,v 1.30 2009/07/21 21:25:17 miod Exp $
d106 7
a112 1
# IOC3 serial ports
d115 2
@


1.30
log
@PCI-Cardbus bridge support for both O2 (macepcibr) and Octane/Origin (xbridge)
class systems. Tested on O2 and Origin 200 with wi@@pcmcia and xl@@cardbus,
using a Ricoh 5C475-based cbb(4) board.

acx@@cardbus doesn't work reliably yet, so your mileage may vary until more
bugs are fixed.

Thanks to matthieu@@ for lending me some cardbus devices for testing.
@
text
@d1 1
a1 1
#	$OpenBSD: files.sgi,v 1.29 2009/07/19 19:02:03 kettenis Exp $
a123 5

# IOC Ethernet
device	ef: ether, ifnet, ifmedia, mii
attach	ef at ioc
file	arch/sgi/dev/if_ef.c			ef
@


1.29
log
@Simplify code that sanitizes pci resources on the O2's mace PCI bridge.
The firmware messes up I/O BARs, so whack those back to 0, such that the MI
PCI code initializes on an as-needed basis.

ok miod@@
@
text
@d1 1
a1 1
#	$OpenBSD: files.sgi,v 1.28 2009/07/13 21:19:22 miod Exp $
d159 6
@


1.28
log
@Extend xbridge to support shared interrupt handlers, and perform PCI-PCI
bridge initialization if necessary; enable ppb on IP27 and IP30 kernels.
With feedback from kettenis@@; macepcibr to gain the same functionality soon.
@
text
@d1 1
a1 1
#	$OpenBSD: files.sgi,v 1.27 2009/06/24 17:27:40 miod Exp $
d78 1
a78 2
file	arch/sgi/pci/macepcibridge.c		macepcibr needs-flag
file	arch/sgi/pci/macepcimap.c		macepcibr
@


1.27
log
@Even more pci ethernet devices, based on a diff from Brad.
@
text
@d1 1
a1 1
#	$OpenBSD: files.sgi,v 1.26 2009/06/13 21:48:03 miod Exp $
d75 1
d93 1
@


1.26
log
@Enumerate all available nodes for hardware on IP27/IP35 systems; works to some
extent, but isp(4) on other nodes do not work correctly yet.
@
text
@d1 1
a1 1
#	$OpenBSD: files.sgi,v 1.25 2009/05/02 21:31:17 miod Exp $
d11 1
d25 3
d87 4
d93 6
a159 4
#	PCI Bus support
#

#
a176 12

#
# Specials.
#
# RAM disk for boot
major	{rd = 8}

#
#	Common files
#

file	dev/cninit.c
@


1.25
log
@Let ioc(4) decide which child devices to attach depending on its identification
information, instead of trying to attach whatever is defined in the
kernel configuration file.
@
text
@d1 1
a1 1
#	$OpenBSD: files.sgi,v 1.24 2009/04/13 21:17:52 miod Exp $
a10 1
file	arch/sgi/sgi/disksubr.c			disk
d14 1
d19 1
d39 1
a39 1
define	mainbus {}
a104 5

# Impact graphics
device	impact: wsemuldisplaydev, rasops8, rasops16, rasops32
attach	impact at xbow
file	arch/sgi/xbow/impact.c			impact	needs-flag
@


1.24
log
@The start of Origin 200 support. Based on some code contributed by pefo@@
some years ago for KL enumeration, building on the existing XBow support
to limit ourselves to a single node for now.

This is a work-in-progress; it currently lacks complete interrupt code,
as well as PCI resource management. And there are likely bugs creeping
inside.
@
text
@d1 1
a1 1
#	$OpenBSD: files.sgi,v 1.23 2009/04/12 17:56:56 miod Exp $
d85 1
a85 1
define	ioc {[base = -1], [dev = -1]}
@


1.23
log
@Interrupt support for IOC3 and its subdevices (currently limited to the
SuperIO part, the Ethernet part needs a whole driver); kernel now boot
single user (or bsd.rd). Joint work with jsing@@
@
text
@d1 1
a1 1
#	$OpenBSD: files.sgi,v 1.22 2008/04/07 22:36:26 miod Exp $
d60 2
a61 1
#	Origin200/Origin2000 XBOW mux bridge
a62 5
define	xbow {[vendor = -1], [product = -1]}
device	xbow
attach	xbow at mainbus
file	arch/sgi/xbow/xbow.c			xbow

@


1.22
log
@Split clock attachment in two parts: a timecounter attachment (at mainbus),
and a time-of-day chip (wherever it gets found).
@
text
@d1 1
a1 1
#	$OpenBSD: files.sgi,v 1.21 2008/04/07 22:32:44 miod Exp $
d67 2
a70 2
include "arch/sgi/xbow/files.xbow"

d89 1
a89 1
define	ioc {[base = -1], [irq = -1]}
d109 5
d118 5
d169 1
@


1.21
log
@Unclutter machdep.c by moving the IP32-specific initialization code to its
own file. While there, more dead beef removal in struct sys_rec.
@
text
@d1 1
a1 1
#	$OpenBSD: files.sgi,v 1.20 2008/02/20 18:46:20 miod Exp $
d46 4
d62 8
a69 4
define	xbowmux {[sys = - 1], [base = -1], [irq = -1]}
device	xbowmux
attach	xbowmux at mainbus
file	arch/sgi/localbus/xbowmux.c		xbowmux
a78 4
device	xiopcibr {} : pcibus
attach	xiopcibr at xbowmux
file	arch/sgi/pci/xiopcibridge.c		xiopcibr needs-flag

d88 15
a102 4
# Clock device
device	clock
attach	clock at macebus
file	arch/sgi/sgi/clock_md.c			clock
d151 13
@


1.20
log
@Completely overhault attachment rules on sgi. No more indirect configuration
inherited from OpenBSD/arc machines with ISA bus; mainbus children match on
device name and other hierarchies match on simplified locators.
As a bonus, attachment lines in dmesg will now print their locators.

ok jsing@@
@
text
@d1 1
a1 1
#	$OpenBSD: files.sgi,v 1.19 2007/12/31 12:46:14 jsing Exp $
d15 1
d17 1
@


1.19
log
@Significantly improve the gbe(4) driver, including:

- Internal restructure to separate code paths.

- Add support for early console. This allows for gbe(4) to takeover were
the ARCBios leaves off (if we should do so).

- Add support for 8bpp and 16bpp colour depths. As a result, we also have
support for colourmaps. We now use 8bpp as the default.

- Add mmap() support, enabling wsfb to operate correctly.

- Correct initial origin problem that occurred occasionally.

ok miod@@. tested by jasper@@.
@
text
@d1 1
a1 1
#	$OpenBSD: files.sgi,v 1.17 2007/12/18 08:29:02 jasper Exp $
d15 1
d47 1
a47 1
define	macebus {[sys = - 1], [base = -1], [irq = -1]}
d84 1
a84 2
attach	clock at macebus with clock_macebus
attach	clock at xbowmux with clock_xbowmux
d93 2
a94 7
attach	com at xbowmux with com_xbow
attach	com at macebus with com_localbus
file	arch/sgi/localbus/com_lbus.c		com_localbus | com_xbow

# PC parallel ports (XXX what chip?)
attach	lpt at macebus with lpt_localbus
file	arch/sgi/dev/lpt_lbus.c			lpt_localbus
@


1.18
log
@Move wscons_machdep.c to it's rightful location. This brings OpenBSD/sgi
inline with all other architectures.

ok miod@@
@
text
@d90 1
a90 1
file	arch/sgi/dev/gbe.c			gbe
@


1.17
log
@add power(4), a driver for the power button found on SGI O2's.
when machdep.kbdreset is set, and the correct interrupt is fired,
the machine gets shut down.

with help from and ok jsing@@, ok miod@@
@
text
@d1 1
a1 1
#	$OpenBSD: files.sgi,v 1.16 2007/12/14 16:16:28 jsing Exp $
d18 1
a18 1
file	arch/sgi/dev/wscons_machdep.c		wsdisplay
@


1.16
log
@Enable console support for SGI O2 workstations. Switch between the serial
and graphical console based on the selection made in the ARCBIOS.

Early attachment of gbe(4) is still required, otherwise we have a working
graphical console.

ok miod@@
@
text
@d1 1
a1 1
#	$OpenBSD: files.sgi,v 1.15 2007/11/27 15:31:00 jsing Exp $
d116 5
@


1.15
log
@Initial support for the SGI Graphics Back End (GBE) frame buffer found in
SGI O2 machines. We currently rely on the video hardware being initialised
by the ARCS firmware and can only use the initial resolution with a colour
depth of 32 bits. This driver is disabled by default.

ok miod@@
@
text
@d1 1
a1 1
#	$OpenBSD: files.sgi,v 1.14 2007/10/18 18:59:29 jsing Exp $
d115 1
a115 1
file	arch/sgi/dev/mkbc.c			mkbc
d122 1
a122 1
#  wscons console
@


1.14
log
@Add support for the Moosehead PS/2 controller as found on SGI O2 workstations.

ok miod@@ deraadt@@
@
text
@d1 1
a1 1
#	$OpenBSD: files.sgi,v 1.13 2007/06/21 20:17:12 miod Exp $
d86 5
@


1.13
log
@Extent sgi bus_dma to cope with different views of memory: non-contiguous
for the cpu, contiguous from different bases for devices. This allows
memory above 256MB to be used with bus_dma (and we had really been lucky
with the first few large-memory builds).
Information about memory accesses taken from Linux.
@
text
@d1 1
a1 1
#	$OpenBSD: files.sgi,v 1.12 2007/06/18 21:46:41 deraadt Exp $
d105 6
@


1.12
log
@this is the sgi disksubr, not some mythical "all mips64 architectures can use it" balony
@
text
@d1 1
a1 1
#	$OpenBSD: files.sgi,v 1.11 2007/05/01 18:59:40 miod Exp $
d13 1
@


1.11
log
@Simple monoprocessor mutex implementation, faster than the MI code, four left
to go.
@
text
@d1 1
a1 1
#	$OpenBSD: files.sgi,v 1.10 2005/05/01 21:36:57 brad Exp $
d11 1
@


1.10
log
@To allow for MD override of in4_cksum()...

ok deraadt@@
@
text
@d1 1
a1 1
#	$OpenBSD: files.sgi,v 1.9 2005/03/08 20:00:24 tdeval Exp $
d14 1
@


1.9
log
@Cosmetics...
Mainly remove space between locators parens, replace spaces with tabs
where appropriate and consistently align dependencies.
@
text
@d1 1
a1 1
#	$OpenBSD: files.sgi,v 1.8 2005/03/05 23:58:43 tdeval Exp $
a131 2
file	netinet/in_cksum.c
file	netns/ns_cksum.c			ns
@


1.8
log
@Clean up the tree from incomplete, unreliable and unsupported IEEE1394 code.
Ok deraadt@@, miod@@
@
text
@d1 1
a1 1
#	$OpenBSD: files.sgi,v 1.7 2005/01/02 19:50:30 kettenis Exp $
d14 2
a15 2
file	arch/sgi/sgi/sginode.c		tgt_origin200 | tgt_origin2000
file	arch/sgi/dev/wscons_machdep.c	wsdisplay
d20 1
a20 1
include "dev/mii/files.mii"
d26 2
a27 2
include "dev/atapiscsi/files.atapiscsi"
include "dev/ata/files.ata"
d43 1
a43 1
define	macebus { [sys = - 1], [base = -1 ], [irq = -1] }
d52 1
a52 1
define	xbowmux { [sys = - 1], [base = -1 ], [irq = -1] }
d74 1
a74 1
include "dev/i2o/files.i2o"
d76 1
a76 1
include "dev/pci/files.pci"
d99 1
a99 1
device  mavb: audio
d104 2
a105 2
include "dev/rasops/files.rasops"
include "dev/wsfont/files.wsfont"
d110 1
a110 1
include "dev/wscons/files.wscons"
d119 1
a119 1
include "dev/usb/files.usb"
d125 1
a125 1
major {rd = 8}
a133 1

@


1.7
log
@Hookup mavb driver (but leave it commented out in GENERIC).
@
text
@d1 1
a1 1
#	$OpenBSD: files.sgi,v 1.6 2004/10/20 12:49:15 pefo Exp $
a119 5

#
# Machine-independent IEEE1394 drivers
#
include "dev/ieee1394/files.ieee1394"
@


1.6
log
@Fix some 64 bit address problems.
Some function names made more unique.
Other changes for the upcoming Origin 200 support.
@
text
@d1 1
a1 1
#	$OpenBSD: files.sgi,v 1.5 2004/10/08 13:04:36 grange Exp $
d97 5
@


1.5
log
@Move dev/cons.c to MI conf/files.

ok miod@@
@
text
@d1 1
a1 1
#	$OpenBSD: files.sgi,v 1.4 2004/09/09 22:11:39 pefo Exp $
d14 1
d41 1
a41 1
#	MACE localbus autoconfiguration devices
d50 8
d65 4
d80 2
a81 1
attach	clock at macebus
d85 1
d87 1
a87 1
file	arch/sgi/localbus/com_lbus.c		com_localbus
@


1.4
log
@Kernel moves to 64 bit. A few more tweaks when binutils is updated.
@
text
@d1 1
a1 1
#	$OpenBSD: files.sgi,v 1.3 2004/08/10 19:08:18 deraadt Exp $
a115 1
file	dev/cons.c
@


1.3
log
@spacing
@
text
@d1 1
a1 1
#	$OpenBSD: files.sgi,v 1.2 2004/08/10 07:30:56 mickey Exp $
a119 5

#
# mips o32 ABI compat.
#
#include "compat/mipso32/files.mipso32"
@


1.2
log
@mac-110 on mace from netbsd
@
text
@d1 1
a1 1
#	$OpenBSD: files.sgi,v 1.1 2004/08/06 21:12:18 pefo Exp $
d22 1
a22 1
#	Machine-independent ATAPI drivers 
@


1.1
log
@initial sgi import
@
text
@d1 1
a1 1
#	$OpenBSD: files.sgi,v 1.19 1998/05/05 05:44:41 imp Exp $
d77 5
@

