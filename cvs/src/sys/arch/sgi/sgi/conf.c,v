head	1.39;
access;
symbols
	OPENBSD_6_2:1.39.0.2
	OPENBSD_6_2_BASE:1.39
	OPENBSD_6_1:1.39.0.4
	OPENBSD_6_1_BASE:1.39
	OPENBSD_6_0:1.37.0.2
	OPENBSD_6_0_BASE:1.37
	OPENBSD_5_9:1.36.0.2
	OPENBSD_5_9_BASE:1.36
	OPENBSD_5_8:1.35.0.6
	OPENBSD_5_8_BASE:1.35
	OPENBSD_5_7:1.35.0.2
	OPENBSD_5_7_BASE:1.35
	OPENBSD_5_6:1.33.0.6
	OPENBSD_5_6_BASE:1.33
	OPENBSD_5_5:1.33.0.4
	OPENBSD_5_5_BASE:1.33
	OPENBSD_5_4:1.32.0.2
	OPENBSD_5_4_BASE:1.32
	OPENBSD_5_3:1.31.0.2
	OPENBSD_5_3_BASE:1.31
	OPENBSD_5_2:1.30.0.2
	OPENBSD_5_2_BASE:1.30
	OPENBSD_5_1_BASE:1.29
	OPENBSD_5_1:1.29.0.2
	OPENBSD_5_0:1.28.0.4
	OPENBSD_5_0_BASE:1.28
	OPENBSD_4_9:1.28.0.2
	OPENBSD_4_9_BASE:1.28
	OPENBSD_4_8:1.24.0.2
	OPENBSD_4_8_BASE:1.24
	OPENBSD_4_7:1.22.0.2
	OPENBSD_4_7_BASE:1.22
	OPENBSD_4_6:1.20.0.2
	OPENBSD_4_6_BASE:1.20
	OPENBSD_4_5:1.18.0.2
	OPENBSD_4_5_BASE:1.18
	OPENBSD_4_4:1.16.0.2
	OPENBSD_4_4_BASE:1.16
	OPENBSD_4_3:1.13.0.4
	OPENBSD_4_3_BASE:1.13
	OPENBSD_4_2:1.13.0.2
	OPENBSD_4_2_BASE:1.13
	OPENBSD_4_1:1.9.0.8
	OPENBSD_4_1_BASE:1.9
	OPENBSD_4_0:1.9.0.6
	OPENBSD_4_0_BASE:1.9
	OPENBSD_3_9:1.9.0.4
	OPENBSD_3_9_BASE:1.9
	OPENBSD_3_8:1.9.0.2
	OPENBSD_3_8_BASE:1.9
	OPENBSD_3_7:1.8.0.2
	OPENBSD_3_7_BASE:1.8
	OPENBSD_3_6:1.3.0.2
	OPENBSD_3_6_BASE:1.3;
locks; strict;
comment	@ * @;


1.39
date	2016.09.04.10.51.24;	author naddy;	state Exp;
branches;
next	1.38;
commitid	4OWaAfwqMvhOCLOI;

1.38
date	2016.09.02.17.06.13;	author goda;	state Exp;
branches;
next	1.37;
commitid	J1JzeTsS8K8zyH3c;

1.37
date	2016.04.25.20.09.14;	author tedu;	state Exp;
branches;
next	1.36;
commitid	43yo2G4zZOY9ab4i;

1.36
date	2015.10.23.15.10.52;	author claudio;	state Exp;
branches;
next	1.35;
commitid	g17gxjQh9N9egLbB;

1.35
date	2014.12.11.19.44.17;	author tedu;	state Exp;
branches;
next	1.34;
commitid	jUSAZlQ30WF1ESM9;

1.34
date	2014.08.20.06.14.42;	author mikeb;	state Exp;
branches;
next	1.33;
commitid	qXFkosC6o9cv78HT;

1.33
date	2013.08.20.14.27.30;	author ajacoutot;	state Exp;
branches;
next	1.32;

1.32
date	2013.06.03.15.54.47;	author tedu;	state Exp;
branches;
next	1.31;

1.31
date	2012.08.23.06.12.49;	author deraadt;	state Exp;
branches;
next	1.30;

1.30
date	2012.03.28.20.44.23;	author miod;	state Exp;
branches;
next	1.29;

1.29
date	2011.10.06.20.49.28;	author deraadt;	state Exp;
branches;
next	1.28;

1.28
date	2011.01.14.19.04.08;	author jasper;	state Exp;
branches;
next	1.27;

1.27
date	2010.11.22.21.10.45;	author miod;	state Exp;
branches;
next	1.26;

1.26
date	2010.11.19.20.55.48;	author miod;	state Exp;
branches;
next	1.25;

1.25
date	2010.09.23.05.02.14;	author claudio;	state Exp;
branches;
next	1.24;

1.24
date	2010.07.03.03.59.17;	author krw;	state Exp;
branches;
next	1.23;

1.23
date	2010.06.09.15.25.33;	author jsing;	state Exp;
branches;
next	1.22;

1.22
date	2009.08.13.15.04.20;	author dlg;	state Exp;
branches;
next	1.21;

1.21
date	2009.08.09.21.07.25;	author miod;	state Exp;
branches;
next	1.20;

1.20
date	2009.06.03.18.32.24;	author jasper;	state Exp;
branches;
next	1.19;

1.19
date	2009.06.03.14.45.53;	author jj;	state Exp;
branches;
next	1.18;

1.18
date	2009.01.25.17.30.49;	author miod;	state Exp;
branches;
next	1.17;

1.17
date	2008.08.25.13.51.12;	author jsing;	state Exp;
branches;
next	1.16;

1.16
date	2008.06.12.20.03.48;	author mglocker;	state Exp;
branches;
next	1.15;

1.15
date	2008.05.14.20.49.48;	author miod;	state Exp;
branches;
next	1.14;

1.14
date	2008.04.08.14.31.54;	author claudio;	state Exp;
branches;
next	1.13;

1.13
date	2007.05.29.07.23.20;	author deraadt;	state Exp;
branches;
next	1.12;

1.12
date	2007.05.28.22.26.03;	author todd;	state Exp;
branches;
next	1.11;

1.11
date	2007.05.27.01.50.36;	author todd;	state Exp;
branches;
next	1.10;

1.10
date	2007.05.26.19.54.24;	author todd;	state Exp;
branches;
next	1.9;

1.9
date	2005.08.01.15.43.51;	author miod;	state Exp;
branches;
next	1.8;

1.8
date	2005.01.02.19.50.30;	author kettenis;	state Exp;
branches;
next	1.7;

1.7
date	2004.12.13.16.18.02;	author miod;	state Exp;
branches;
next	1.6;

1.6
date	2004.10.08.17.52.08;	author mcbride;	state Exp;
branches;
next	1.5;

1.5
date	2004.09.22.14.39.45;	author miod;	state Exp;
branches;
next	1.4;

1.4
date	2004.09.21.07.55.50;	author miod;	state Exp;
branches;
next	1.3;

1.3
date	2004.08.11.15.13.35;	author deraadt;	state Exp;
branches;
next	1.2;

1.2
date	2004.08.10.18.47.22;	author deraadt;	state Exp;
branches;
next	1.1;

1.1
date	2004.08.06.21.12.19;	author pefo;	state Exp;
branches;
next	;


desc
@@


1.39
log
@Remove support for tape block devices. Nobody mount(8)s tapes any longer.
ok deraadt@@ guenther@@
@
text
@/*	$OpenBSD: conf.c,v 1.38 2016/09/02 17:06:13 goda Exp $ */

/*
 * Copyright (c) 1992, 1993
 *	The Regents of the University of California.  All rights reserved.
 *
 * This code is derived from software contributed to Berkeley by
 * Ralph Campbell.
 *
 * Redistribution and use in source and binary forms, with or without
 * modification, are permitted provided that the following conditions
 * are met:
 * 1. Redistributions of source code must retain the above copyright
 *    notice, this list of conditions and the following disclaimer.
 * 2. Redistributions in binary form must reproduce the above copyright
 *    notice, this list of conditions and the following disclaimer in the
 *    documentation and/or other materials provided with the distribution.
 * 3. All advertising materials mentioning features or use of this software
 *    must display the following acknowledgement:
 *	This product includes software developed by the University of
 *	California, Berkeley and its contributors.
 * 4. Neither the name of the University nor the names of its contributors
 *    may be used to endorse or promote products derived from this software
 *    without specific prior written permission.
 *
 * THIS SOFTWARE IS PROVIDED BY THE REGENTS AND CONTRIBUTORS ``AS IS'' AND
 * ANY EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT LIMITED TO, THE
 * IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE
 * ARE DISCLAIMED.  IN NO EVENT SHALL THE REGENTS OR CONTRIBUTORS BE LIABLE
 * FOR ANY DIRECT, INDIRECT, INCIDENTAL, SPECIAL, EXEMPLARY, OR CONSEQUENTIAL
 * DAMAGES (INCLUDING, BUT NOT LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS
 * OR SERVICES; LOSS OF USE, DATA, OR PROFITS; OR BUSINESS INTERRUPTION)
 * HOWEVER CAUSED AND ON ANY THEORY OF LIABILITY, WHETHER IN CONTRACT, STRICT
 * LIABILITY, OR TORT (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY
 * OUT OF THE USE OF THIS SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF
 * SUCH DAMAGE.
 */

#include <sys/param.h>
#include <sys/systm.h>
#include <sys/buf.h>
#include <sys/ioctl.h>
#include <sys/proc.h>
#include <sys/vnode.h>
#include <sys/tty.h>

#include <machine/conf.h>

/*
 *	Block devices.
 */

#include "vnd.h"
#include "sd.h"
#include "cd.h"
#include "st.h"
#include "wd.h"
bdev_decl(wd);
#include "rd.h"
#include "hotplug.h"

struct bdevsw	bdevsw[] =
{
	bdev_disk_init(NSD,sd),		/* 0: SCSI disk */
	bdev_swap_init(1,sw),		/* 1: should be here swap pseudo-dev */
	bdev_disk_init(NVND,vnd),	/* 2: vnode disk driver */
	bdev_disk_init(NCD,cd),		/* 3: SCSI CD-ROM */
	bdev_disk_init(NWD,wd),		/* 4: ST506/ESDI/IDE disk */
	bdev_notdef(),			/* 5:  */
	bdev_notdef(),			/* 6: was: concatenated disk driver */
	bdev_notdef(),			/* 7:  */
	bdev_disk_init(NRD,rd),		/* 8: RAM disk (for install) */
	bdev_notdef(),			/* 9:  */
	bdev_notdef(),			/* 10: was: SCSI tape */
	bdev_notdef(),			/* 11:  */
	bdev_notdef(),			/* 12:  */
	bdev_notdef(),			/* 13:  */
	bdev_notdef(),			/* 14:  */
	bdev_notdef(),			/* 15:  */
};

int	nblkdev = nitems(bdevsw);

/*
 *	Character devices.
 */

#define mmread mmrw
#define mmwrite mmrw
dev_type_read(mmrw);
cdev_decl(mm);
#include "bio.h"
#include "pty.h"
cdev_decl(fd);
#include "st.h"
#include "bpfilter.h"
#include "tun.h"
#include "com.h"
cdev_decl(com);
#include "zs.h"
cdev_decl(zs);
#include "lpt.h"
cdev_decl(lpt);
#include "ch.h"
#include "uk.h"
cdev_decl(wd);
#include "audio.h"
#include "video.h"
#include "ksyms.h"

#include "wsdisplay.h"
#include "wskbd.h"
#include "wsmouse.h"
#include "wsmux.h"
#include "pci.h"
cdev_decl(pci);

#include "pf.h"

#include "usb.h"
#include "uhid.h"
#include "ugen.h"
#include "ulpt.h"
#include "ucom.h"

#include "vscsi.h"
#include "pppx.h"
#include "fuse.h"
#include "switch.h"

struct cdevsw	cdevsw[] =
{
	cdev_cn_init(1,cn),		/* 0: virtual console */
	cdev_notdef(),			/* 1 was /dev/drum */
	cdev_ctty_init(1,ctty),		/* 2: controlling terminal */
	cdev_mm_init(1,mm),		/* 3: /dev/{null,mem,kmem,...} */
	cdev_tty_init(NPTY,pts),	/* 4: pseudo-tty slave */
	cdev_ptc_init(NPTY,ptc),	/* 5: pseudo-tty master */
	cdev_log_init(1,log),		/* 6: /dev/klog */
	cdev_fd_init(1,filedesc),	/* 7: file descriptor pseudo-dev */
	cdev_disk_init(NCD,cd),		/* 8: SCSI CD */
	cdev_disk_init(NSD,sd),		/* 9: SCSI disk */
	cdev_tape_init(NST,st),		/* 10: SCSI tape */
	cdev_disk_init(NVND,vnd),	/* 11: vnode disk */
	cdev_bpf_init(NBPFILTER,bpf),	/* 12: berkeley packet filter */
	cdev_tun_init(NTUN,tun),	/* 13: network tunnel */
	cdev_notdef(),			/* 14 */
	cdev_notdef(),			/* 15: */
	cdev_lpt_init(NLPT,lpt),	/* 16: Parallel printer interface */
	cdev_tty_init(NCOM,com),	/* 17: 16C450 serial interface */
	cdev_disk_init(NWD,wd),		/* 18: ST506/ESDI/IDE disk */
	cdev_tty_init(NZS,zs),		/* 19: Z8530 serial interface */
	cdev_notdef(),			/* 20: */
	cdev_notdef(),			/* 21: */
	cdev_disk_init(NRD,rd),		/* 22: ramdisk device */
	cdev_notdef(),			/* 23: was: concatenated disk driver */
	cdev_notdef(),			/* 24: */
	cdev_wsdisplay_init(NWSDISPLAY, wsdisplay),	/* 25: */
	cdev_mouse_init(NWSKBD, wskbd),	/* 26: */
	cdev_mouse_init(NWSMOUSE, wsmouse),	/* 27: */
	cdev_mouse_init(NWSMUX, wsmux),	/* 28: */
#ifdef USER_PCICONF
	cdev_pci_init(NPCI,pci),	/* 29: PCI user */
#else
	cdev_notdef(),			/* 29 */
#endif
	cdev_notdef(),			/* 30: */
	cdev_pf_init(NPF,pf),		/* 31: packet filter */
	cdev_uk_init(NUK,uk),		/* 32: unknown SCSI */
	cdev_random_init(1,random),	/* 33: random data source */
	cdev_notdef(),			/* 34: */
	cdev_ksyms_init(NKSYMS,ksyms),	/* 35: Kernel symbols device */
	cdev_ch_init(NCH,ch),		/* 36: SCSI autochanger */
	cdev_notdef(),			/* 37: */
	cdev_notdef(),			/* 38: */
	cdev_notdef(),			/* 39: */
	cdev_notdef(),			/* 40: */
	cdev_notdef(),			/* 41: */
	cdev_notdef(),			/* 42: */
	cdev_notdef(),			/* 33: */
	cdev_audio_init(NAUDIO,audio),	/* 44: /dev/audio */
	cdev_video_init(NVIDEO,video),	/* 45: generic video I/O */
	cdev_notdef(),			/* 46: */
	cdev_notdef(),			/* 47: was: /dev/crypto */
	cdev_notdef(),			/* 48: */
	cdev_bio_init(NBIO,bio),	/* 49: ioctl tunnel */
	cdev_notdef(),			/* 50: */
	cdev_notdef(),			/* 51: */
	cdev_ptm_init(NPTY,ptm),	/* 52: pseudo-tty ptm device */
	cdev_notdef(),			/* 53: */
	cdev_notdef(),			/* 54: */
	cdev_notdef(),			/* 55: */
	cdev_notdef(),			/* 56: */
	cdev_notdef(),			/* 57: */
	cdev_notdef(),			/* 58: */
	cdev_notdef(),			/* 59: */
	cdev_notdef(),			/* 60: */
	cdev_usb_init(NUSB,usb),	/* 61: USB controller */
	cdev_usbdev_init(NUHID,uhid),	/* 62: USB generic HID */
	cdev_usbdev_init(NUGEN,ugen),	/* 63: USB generic driver */
	cdev_ulpt_init(NULPT,ulpt),	/* 64: USB printers */
	cdev_notdef(),			/* 65: was urio */
	cdev_tty_init(NUCOM,ucom),	/* 66: USB tty */
	cdev_hotplug_init(NHOTPLUG,hotplug), /* 67: devices hotplugging */
	cdev_vscsi_init(NVSCSI,vscsi),	/* 68: vscsi */
	cdev_disk_init(1,diskmap),	/* 69: disk mapper */
	cdev_pppx_init(NPPPX,pppx),	/* 70: pppx */
	cdev_notdef(),			/* 71: */
	cdev_notdef(),			/* 72: was USB scanners */
	cdev_fuse_init(NFUSE,fuse),	/* 73: fuse */
	cdev_tun_init(NTUN,tap),	/* 74: Ethernet network tunnel */
	cdev_switch_init(NSWITCH,switch), /* 75: switch(4) control interface */
};

int	nchrdev = nitems(cdevsw);

/*
 * Swapdev is a fake device implemented
 * in sw.c used only internally to get to swstrategy.
 * It cannot be provided to the users, because the
 * swstrategy routine munches the b_dev and b_blkno entries
 * before calling the appropriate driver.  This would horribly
 * confuse, e.g. the hashing routines. Instead, /dev/drum is
 * provided as a character (raw) device.
 */
dev_t	swapdev = makedev(1, 0);

/*
 * Routine that identifies /dev/mem and /dev/kmem.
 *
 * A minimal stub routine can always return 0.
 */
int
iskmemdev(dev)
	dev_t dev;
{

	if (major(dev) == 3 && (minor(dev) == 0 || minor(dev) == 1))
		return (1);
	return (0);
}

/*
 * Returns true if def is /dev/zero
 */
int
iszerodev(dev)
	dev_t dev;
{
	return (major(dev) == 3 && minor(dev) == 12);
}

dev_t
getnulldev()
{
	return(makedev(3, 2));
}


int chrtoblktbl[] =  {
	/* VCHR         VBLK */
	/* 0 */		NODEV,
	/* 1 */		NODEV,
	/* 2 */		NODEV,
	/* 3 */		NODEV,
	/* 4 */		NODEV,
	/* 5 */		NODEV,
	/* 6 */		NODEV,
	/* 7 */		NODEV,
	/* 8 */		3,		/* cd */
	/* 9 */		0,		/* sd */
	/* 10 */	NODEV,
	/* 11 */	2,		/* vnd */
	/* 12 */	NODEV,
	/* 13 */	NODEV,
	/* 14 */	NODEV,
	/* 15 */	NODEV,
	/* 16 */	NODEV,
	/* 17 */	NODEV,
	/* 18 */	4,		/* wd */
	/* 19 */	NODEV,
	/* 20 */	NODEV,
	/* 21 */	NODEV,
	/* 22 */	8		/* rd */
};

int nchrtoblktbl = nitems(chrtoblktbl);

#include <dev/cons.h>

cons_decl(com);
cons_decl(ws);
cons_decl(zs);

struct	consdev constab[] = {
#if NWSDISPLAY > 0
	cons_init(ws),
#endif
#if NCOM > 0
	cons_init(com),
#endif
#if NZS > 0
	cons_init(zs),
#endif
	{ 0 },
};
@


1.38
log
@Add switch(4) cdev entry

ok deraadt@@ yasuoka@@ reyk@@
@
text
@d1 1
a1 1
/*	$OpenBSD: conf.c,v 1.37 2016/04/25 20:09:14 tedu Exp $ */
d74 1
a74 1
	bdev_tape_init(NST,st),		/* 10: SCSI tape */
d272 1
a272 1
	/* 10 */	10,		/* st */
@


1.37
log
@remove systrace
@
text
@d1 1
a1 1
/*	$OpenBSD: conf.c,v 1.36 2015/10/23 15:10:52 claudio Exp $ */
d129 1
d212 1
@


1.36
log
@Allocate a new major for tap(4) also note that pseudo-device tun is for tap
as well. OK dlg@@ mpi@@
@
text
@d1 1
a1 1
/*	$OpenBSD: conf.c,v 1.35 2014/12/11 19:44:17 tedu Exp $ */
a118 1
#include "systrace.h"
d186 1
a186 1
	cdev_systrace_init(NSYSTRACE,systrace),	/* 50: system call tracing */
@


1.35
log
@dragonflybsd has added a urio driver. conservation of urios requires
that we delete ours, which isn't actually useful.
ok mpi sthen
@
text
@d1 1
a1 1
/*	$OpenBSD: conf.c,v 1.34 2014/08/20 06:14:42 mikeb Exp $ */
d211 1
@


1.34
log
@unlink crypto(4) pseudo device from the architecture dependant character
device tables and kernel config files.  ok deraadt
@
text
@d1 1
a1 1
/*	$OpenBSD: conf.c,v 1.33 2013/08/20 14:27:30 ajacoutot Exp $ */
a124 1
#include "urio.h"
d202 1
a202 1
	cdev_urio_init(NURIO,urio),	/* 65: USB Diamond Rio 500 */
@


1.33
log
@Remove uscanner(4). It was disabled in GENERIC more than 2.5 years ago.
No regression has been reported since libusb became the prefered
solution to work with USB scanners.

req. by mpi@@
ok ian@@ mpi@@ miod@@
@
text
@d1 1
a1 1
/*	$OpenBSD: conf.c,v 1.32 2013/06/03 15:54:47 tedu Exp $ */
a117 2
#include "inet.h"

d185 1
a185 1
	cdev_crypto_init(NCRYPTO,crypto),	/* 47: /dev/crypto */
@


1.32
log
@changes for isc fuse support. not enabled. ok beck deraadt.
from Sylvestre Gallon ccna.syl gmail.com
@
text
@d1 1
a1 1
/*	$OpenBSD: conf.c,v 1.31 2012/08/23 06:12:49 deraadt Exp $ */
a128 1
#include "uscanner.h"
d212 1
a212 1
	cdev_usbdev_init(NUSCANNER,uscanner),	/* 72: USB scanners */
@


1.31
log
@kill nnpfs dead
@
text
@d1 1
a1 1
/*	$OpenBSD: conf.c,v 1.30 2012/03/28 20:44:23 miod Exp $ */
d133 1
d214 1
@


1.30
log
@Work in progress support for the SGI Indigo, Indigo 2 and Indy systems
(IP20, IP22, IP24) in 64-bit mode, adapated from NetBSD. Currently limited
to headless operation, input and video drivers will get ported soon.

Should work on all R4000, R4440 and R5000 based systems. L2 cache on R5000SC
Indy not supported yet (coming soon), R4600 not supported yet either (coming
soon as well).

Tested to boot multiuser on: Indigo2 R4000SC, Indy R4000PC, Indy R4000SC,
Indy R5000SC, Indigo2 R4400SC. There are still glitches in the Ethernet driver
which are being looked at.

Expansion support is limited to the GIO E++ board; GIO boards with PCI-GIO
bridges not ported yet due to the lack of hardware, and this kind of driver
does not port blindly.

Most of this work comes from NetBSD, polishing and integration work, as well
as putting as many ``R4x00 in 64-bit mode'' erratas as necessary, by yours
truly.

More work is coming, as well as trying to get some easy way to boot install
kernels (as older PROM can only boot ECOFF binaries, which won't do for the
kernel).
@
text
@d1 1
a1 1
/*	$OpenBSD: conf.c,v 1.29 2011/10/06 20:49:28 deraadt Exp $ */
a108 4
#ifdef NNPFS
#include <nnpfs/nnnpfs.h>
cdev_decl(nnpfs_dev);
#endif
a190 3
#ifdef NNPFS
	cdev_nnpfs_init(NNNPFS,nnpfs_dev),	/* 51: nnpfs communication device */
#else
a191 1
#endif
@


1.29
log
@ccd goes to the attic
discussed with jsing and millert
@
text
@d1 1
a1 1
/*	$OpenBSD: conf.c,v 1.28 2011/01/14 19:04:08 jasper Exp $ */
d100 2
d159 1
a159 1
	cdev_notdef(),			/* 19: */
d299 1
d301 1
a301 1
cons_decl(com);
d309 3
@


1.28
log
@- use nitems()

"doesn't hurt" deraadt@@
@
text
@d1 1
a1 1
/*	$OpenBSD: conf.c,v 1.27 2010/11/22 21:10:45 miod Exp $ */
a58 1
#include "ccd.h"
d70 1
a70 1
	bdev_disk_init(NCCD,ccd),	/* 6: concatenated disk driver */
d161 1
a161 1
	cdev_disk_init(NCCD,ccd),	/* 23: concatenated disk driver */
d290 1
a290 2
	/* 22 */	8,		/* rd */
	/* 23 */	6		/* ccd */
@


1.27
log
@Remove old comment about constab[] being eventually generated by config(8).
This has never happened and this wouldn't make much sense on anything but
hp300, if at all, nowadays.
@
text
@d1 1
a1 1
/*	$OpenBSD: conf.c,v 1.26 2010/11/19 20:55:48 miod Exp $ */
d83 1
a83 1
int	nblkdev = sizeof (bdevsw) / sizeof (bdevsw[0]);
d222 1
a222 1
int	nchrdev = sizeof (cdevsw) / sizeof (cdevsw[0]);
d295 1
a295 1
int nchrtoblktbl = sizeof(chrtoblktbl) / sizeof(int);
@


1.26
log
@Sync MAKEDEV against conf.c, and both against GENERIC.
@
text
@d1 1
a1 1
/*	$OpenBSD: conf.c,v 1.25 2010/09/23 05:02:14 claudio Exp $ */
a296 6
/*
 * This entire table could be autoconfig()ed but that would mean that
 * the kernel's idea of the console would be out of sync with that of
 * the standalone boot.  I think it best that they both use the same
 * known algorithm unless we see a pressing need otherwise.
 */
@


1.25
log
@Add pppx(4) to the cdevs of the remaining archs.
OK dlg@@
@
text
@d1 1
a1 1
/*	$OpenBSD: conf.c,v 1.24 2010/07/03 03:59:17 krw Exp $ */
d132 2
d218 2
@


1.24
log
@No more ss(4) or usscanner(4). Unused, unloved and unmaintained.
General huzzahs.

"go for it" deraadt@@
@
text
@d1 1
a1 1
/*	$OpenBSD: conf.c,v 1.23 2010/06/09 15:25:33 jsing Exp $ */
d133 1
d215 1
@


1.23
log
@Wire up device nodes for disk mapper.

ok deraadt@@
@
text
@d1 1
a1 1
/*	$OpenBSD: conf.c,v 1.21 2009/08/09 21:07:25 miod Exp $ */
a103 1
#include "ss.h"
d174 1
a174 1
	cdev_ss_init(NSS,ss),		/* 34: SCSI scanner */
@


1.22
log
@wire vscsi up to a cdev

for claudio@@ ok deraadt@@
@
text
@d214 1
@


1.21
log
@Add a dummy <machine/conf.h> so that MI code can rely upon its existence.
@
text
@d1 1
a1 1
/*	$OpenBSD: conf.c,v 1.20 2009/06/03 18:32:24 jasper Exp $ */
d133 1
d212 2
a213 1
	cdev_hotplug_init(NHOTPLUG,hotplug) /* 67: devices hotplugging */
@


1.20
log
@- add hotplug device

ok miod@@
@
text
@d1 1
a1 1
/*	$OpenBSD: conf.c,v 1.19 2009/06/03 14:45:53 jj Exp $ */
d46 2
a47 1
#include <sys/conf.h>
a87 6

/* open, close, write, ioctl */
#define	cdev_lpt_init(c,n) { \
	dev_init(c,n,open), dev_init(c,n,close), (dev_type_read((*))) enodev, \
	dev_init(c,n,write), dev_init(c,n,ioctl), (dev_type_stop((*))) enodev, \
	0, seltrue, (dev_type_mmap((*))) enodev }
@


1.19
log
@Arla client rename from xfs to nnpfs for later upgrades. Tested on various arches. ok todd@@ beck@@
@
text
@d1 1
a1 1
/*	$OpenBSD: conf.c,v 1.18 2009/01/25 17:30:49 miod Exp $ */
d60 1
d215 2
a216 1
	cdev_tty_init(NUCOM,ucom)	/* 66: USB tty */
@


1.18
log
@Remove /dev/drum and related code.
@
text
@d1 1
a1 1
/*	$OpenBSD: conf.c,v 1.17 2008/08/25 13:51:12 jsing Exp $ */
d113 3
a115 3
#ifdef XFS
#include <xfs/nxfs.h>
cdev_decl(xfs_dev);
d195 2
a196 2
#ifdef XFS
	cdev_xfs_init(NXFS,xfs_dev),	/* 51: xfs communication device */
@


1.17
log
@Add device majors for USB character devices in OpenBSD/sgi.

ok miod@@ jasper@@
@
text
@d1 1
a1 1
/*	$OpenBSD: conf.c,v 1.15 2008/05/14 20:49:48 miod Exp $ */
d141 1
a141 1
	cdev_swap_init(1,sw),		/* 1: /dev/drum (swap pseudo-device) */
@


1.16
log
@Enable /dev/video* for all USB capable archs.  MAKEDEV bits will follow
shortly.

OK todd@@
@
text
@d131 7
d165 1
a165 1
cdev_wsdisplay_init(NWSDISPLAY, wsdisplay),	/* 25: */
d201 14
@


1.15
log
@Fix more chrtoblktbl[] sloppyness, and add proper block st nodes to *ppc and
sgi.
@
text
@d1 1
a1 1
/*	$OpenBSD: conf.c,v 1.14 2008/04/08 14:31:54 claudio Exp $ */
d112 1
d182 1
a182 1
	cdev_notdef(),			/* 45: */
@


1.14
log
@Split the cdev makro for bpftun into two seperate definitions. tun(4) and
bpf(4) are different enough so that the split makes sense -- this is necessary
to make bpf(4) cloneable.
requested deraadt@@, OK thib@@
@
text
@d1 1
a1 1
/*	$OpenBSD: conf.c,v 1.13 2007/05/29 07:23:20 deraadt Exp $ */
d55 1
d73 1
a73 1
	bdev_notdef(),			/* 10:  */
d250 4
a253 4
	/* 8 */		3,
	/* 9 */		0,
	/* 10 */	NODEV,
	/* 11 */	2,
d260 1
a260 1
	/* 18 */	4,
d264 2
a265 2
	/* 22 */	8,
	/* 23 */	6
@


1.13
log
@code typo
@
text
@d1 1
a1 1
/*	$OpenBSD: conf.c,v 1.12 2007/05/28 22:26:03 todd Exp $ */
d143 2
a144 2
	cdev_bpftun_init(NBPFILTER,bpf),/* 12: berkeley packet filter */
	cdev_bpftun_init(NTUN,tun),	/* 13: network tunnel */
@


1.12
log
@bio for all archs, ok krw@@ kettenis@@ sounds good marco@@ go for it deraadt@@
@
text
@d1 1
a1 1
/*	$OpenBSD: conf.c,v 1.11 2007/05/27 01:50:36 todd Exp $ */
d184 1
a184 1
	cdev_bio_init(NDEV,bio),	/* 49: ioctl tunnel */
@


1.11
log
@back out bio, breaks dlg's sparc64 v215
prompted by/ok dlg@@ deraadt@@
@
text
@d1 1
a1 1
/*	$OpenBSD: conf.c,v 1.10 2007/05/26 19:54:24 todd Exp $ */
d96 1
d145 1
a145 1
	cdev_notdef(),			/* 14: */
d184 1
a184 1
	cdev_notdef(),			/* 49: */
@


1.10
log
@prodded by marco, enable bio everywhere
grudgingly ok deraadt@@
@
text
@d1 1
a1 1
/*	$OpenBSD: conf.c,v 1.9 2005/08/01 15:43:51 miod Exp $ */
a95 1
#include "bio.h"
d144 1
a144 1
	cdev_bio_init(NBIO,bio),	/* 14: ioctl tunnel */
@


1.9
log
@More entries in chrtoblktbl[]. ok deraadt@@
@
text
@d1 1
a1 1
/*	$OpenBSD: conf.c,v 1.8 2005/01/02 19:50:30 kettenis Exp $ */
d96 1
d145 1
a145 1
	cdev_notdef(),			/* 14: */
@


1.8
log
@Hookup mavb driver (but leave it commented out in GENERIC).
@
text
@d1 1
a1 1
/*	$OpenBSD: conf.c,v 1.7 2004/12/13 16:18:02 miod Exp $ */
d248 1
a248 1
	/* 8 */		NODEV,
d263 1
@


1.7
log
@Remove duplicate declarations already in <sys/conf.h>, as well as duplicate
pts/ptc declaration on majors 20 and 21.
No functional change.
@
text
@d1 1
a1 1
/*	$OpenBSD: conf.c,v 1.6 2004/10/08 17:52:08 mcbride Exp $ */
d109 1
d178 1
a178 1
	cdev_notdef(),			/* 44: */
@


1.6
log
@Enable crypto(4), hifn(4) and create /dev/crypto

ok miod@@
@
text
@d1 1
a1 1
/*	$OpenBSD: conf.c,v 1.5 2004/09/22 14:39:45 miod Exp $ */
a52 2
bdev_decl(vnd);
bdev_decl(sw);
a53 1
bdev_decl(sd);
a54 1
bdev_decl(cd);
a58 1
bdev_decl(rd);
a91 10
/* open, close, write, ioctl */
#define	cdev_spkr_init(c,n) { \
	dev_init(c,n,open), dev_init(c,n,close), (dev_type_read((*))) enodev, \
	dev_init(c,n,write), dev_init(c,n,ioctl), (dev_type_stop((*))) enodev, \
	0, seltrue, (dev_type_mmap((*))) enodev }

cdev_decl(cn);
cdev_decl(sw);
cdev_decl(ctty);
cdev_decl(random);
a96 7
#define	ptstty		ptytty
#define	ptsioctl	ptyioctl
cdev_decl(pts);
#define	ptctty		ptytty
#define	ptcioctl	ptyioctl
cdev_decl(ptc);
cdev_decl(log);
a98 3
cdev_decl(st);
cdev_decl(vnd);
cdev_decl(rd);
d100 1
a100 1
cdev_decl(bpf);
a104 2
cdev_decl(sd);
cdev_decl(cd);
a107 1
cdev_decl(uk);
a108 1
cdev_decl(acd);
a113 1
cdev_decl(ksyms);
d142 1
a142 1
	cdev_notdef(),			/* 13: */
d149 2
a150 2
	cdev_tty_init(NPTY,pts),	/* 20: pseudo-tty slave */
	cdev_ptc_init(NPTY,ptc),	/* 21: pseudo-tty master */
@


1.5
log
@Add systrace support.
@
text
@d1 1
a1 1
/*	$OpenBSD: conf.c,v 1.4 2004/09/21 07:55:50 miod Exp $ */
d152 2
d210 1
a210 1
	cdev_notdef(),			/* 47: */
@


1.4
log
@/dev/ptm support for sgi.
@
text
@d1 1
a1 1
/*	$OpenBSD: conf.c,v 1.3 2004/08/11 15:13:35 deraadt Exp $ */
a47 2
int	ttselect	__P((dev_t, int, struct proc *));

d152 2
a153 1
#include <pf.h>
d211 1
a211 1
	cdev_notdef(),			/* 50: */
@


1.3
log
@various ansi and spacing issues; pefo ok
@
text
@d1 1
a1 1
/*	$OpenBSD: conf.c,v 1.2 2004/08/10 18:47:22 deraadt Exp $ */
d218 1
@


1.2
log
@spacing
@
text
@d1 1
a1 1
/*	$OpenBSD: conf.c,v 1.1 2004/08/06 21:12:19 pefo Exp $ */
a36 3
 *
 *	from: @@(#)conf.c	8.2 (Berkeley) 11/14/93
 *      $Id: conf.c,v 1.1 2004/08/06 21:12:19 pefo Exp $
@


1.1
log
@initial sgi import
@
text
@d1 1
a1 1
/*	$OpenBSD: conf.c,v 1.25 1998/09/25 09:20:52 todd Exp $ */
d39 1
a39 1
 *      $Id: conf.c,v 1.25 1998/09/25 09:20:52 todd Exp $
d184 1
a184 1
	cdev_disk_init(NCCD,ccd),       /* 23: concatenated disk driver */
d191 1
a191 1
        cdev_pci_init(NPCI,pci),        /* 29: PCI user */
d193 1
a193 1
        cdev_notdef(),			/* 29 */
d269 1
a269 1
      /* VCHR */      /* VBLK */
@

