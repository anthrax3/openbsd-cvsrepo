head	1.24;
access;
symbols
	OPENBSD_6_1:1.24.0.4
	OPENBSD_6_1_BASE:1.24
	OPENBSD_6_0:1.22.0.4
	OPENBSD_6_0_BASE:1.22
	OPENBSD_5_9:1.22.0.2
	OPENBSD_5_9_BASE:1.22
	OPENBSD_5_8:1.19.0.4
	OPENBSD_5_8_BASE:1.19
	OPENBSD_5_7:1.18.0.2
	OPENBSD_5_7_BASE:1.18
	OPENBSD_5_6:1.18.0.4
	OPENBSD_5_6_BASE:1.18
	OPENBSD_5_5:1.17.0.4
	OPENBSD_5_5_BASE:1.17
	OPENBSD_5_4:1.15.0.2
	OPENBSD_5_4_BASE:1.15
	OPENBSD_5_3:1.14.0.2
	OPENBSD_5_3_BASE:1.14
	OPENBSD_5_2:1.13.0.8
	OPENBSD_5_2_BASE:1.13
	OPENBSD_5_1_BASE:1.13
	OPENBSD_5_1:1.13.0.6
	OPENBSD_5_0:1.13.0.4
	OPENBSD_5_0_BASE:1.13
	OPENBSD_4_9:1.13.0.2
	OPENBSD_4_9_BASE:1.13
	OPENBSD_4_8:1.11.0.2
	OPENBSD_4_8_BASE:1.11
	OPENBSD_4_7:1.10.0.2
	OPENBSD_4_7_BASE:1.10
	xmas_lemote:1.1.1.1
	miod:1.1.1;
locks; strict;
comment	@# @;


1.24
date	2016.11.17.14.41.21;	author visa;	state Exp;
branches;
next	1.23;
commitid	zpQpluEsJrBQDh6U;

1.23
date	2016.11.06.10.20.33;	author visa;	state Exp;
branches;
next	1.22;
commitid	RRYR9PGvmSKrXqUU;

1.22
date	2016.01.12.17.17.33;	author deraadt;	state Exp;
branches;
next	1.21;
commitid	FWSy1ekKBMPOnpaC;

1.21
date	2016.01.08.15.54.13;	author jcs;	state Exp;
branches;
next	1.20;
commitid	kI4H556ZKYkRQGw5;

1.20
date	2015.08.15.22.31.38;	author miod;	state Exp;
branches;
next	1.19;
commitid	yF3Npu6AQ8EgYJml;

1.19
date	2015.07.08.13.37.31;	author dlg;	state Exp;
branches;
next	1.18;
commitid	Ds9kNjjKbF4CbIsT;

1.18
date	2014.07.11.21.54.37;	author tedu;	state Exp;
branches;
next	1.17;
commitid	0n9cIGBISFAEt4b1;

1.17
date	2013.11.04.14.07.16;	author deraadt;	state Exp;
branches;
next	1.16;

1.16
date	2013.08.15.06.54.35;	author kettenis;	state Exp;
branches;
next	1.15;

1.15
date	2013.06.02.21.46.04;	author pirofti;	state Exp;
branches;
next	1.14;

1.14
date	2013.01.14.21.18.47;	author pirofti;	state Exp;
branches;
next	1.13;

1.13
date	2010.10.14.21.23.04;	author pirofti;	state Exp;
branches;
next	1.12;

1.12
date	2010.09.01.04.52.41;	author miod;	state Exp;
branches;
next	1.11;

1.11
date	2010.05.08.21.59.53;	author miod;	state Exp;
branches;
next	1.10;

1.10
date	2010.03.03.13.33.27;	author jasper;	state Exp;
branches;
next	1.9;

1.9
date	2010.02.28.22.32.50;	author miod;	state Exp;
branches;
next	1.8;

1.8
date	2010.02.28.08.30.27;	author otto;	state Exp;
branches;
next	1.7;

1.7
date	2010.02.26.14.53.11;	author miod;	state Exp;
branches;
next	1.6;

1.6
date	2010.02.24.22.16.18;	author miod;	state Exp;
branches;
next	1.5;

1.5
date	2010.02.23.21.04.16;	author otto;	state Exp;
branches;
next	1.4;

1.4
date	2010.02.19.00.21.43;	author miod;	state Exp;
branches;
next	1.3;

1.3
date	2010.02.18.22.45.26;	author miod;	state Exp;
branches;
next	1.2;

1.2
date	2010.02.05.20.51.20;	author miod;	state Exp;
branches;
next	1.1;

1.1
date	2009.12.25.21.09.57;	author miod;	state Exp;
branches
	1.1.1.1;
next	;

1.1.1.1
date	2009.12.25.21.09.57;	author miod;	state Exp;
branches;
next	;


desc
@@


1.24
log
@Add drivers for PCI host bridge and built-in UARTs on Loongson 3A,
and put the pieces together by platform glue.

Feedback from miod@@
@
text
@#	$OpenBSD: files.loongson,v 1.23 2016/11/06 10:20:33 visa Exp $

# Standard stanzas config(8) can't run without
maxpartitions 16
maxusers 2 8 64

# Major number for block devices, for ``root on'' lines
major	{ sd = 0 }
major	{ cd = 3 }
major	{ wd = 4 }
major	{ rd = 8 }

file	dev/cninit.c

file	arch/loongson/loongson/autoconf.c
file	arch/loongson/loongson/bus_dma.c
file	arch/loongson/loongson/bus_space.c
file	arch/loongson/loongson/conf.c
file	arch/loongson/loongson/disksubr.c		disk
file	arch/loongson/loongson/gdium_machdep.c		cpu_loongson2
file	arch/loongson/loongson/generic2e_machdep.c	cpu_loongson2
file	arch/loongson/loongson/generic3a_machdep.c	cpu_loongson3
file	arch/loongson/loongson/isa_machdep.c		isa
file	arch/loongson/loongson/loongson2_machdep.c
file	arch/loongson/loongson/loongson3_intr.c		cpu_loongson3
file	arch/loongson/loongson/loongson3_machdep.c	cpu_loongson3
file	arch/loongson/loongson/machdep.c
file	arch/loongson/loongson/hibernate_machdep.c	hibernate
file	arch/loongson/loongson/pciide_machdep.c		pciide
file	arch/loongson/loongson/pmon.c
file	arch/loongson/loongson/pmon32.S
file	arch/loongson/loongson/wscons_machdep.c		wsdisplay
file	arch/loongson/loongson/yeeloong_machdep.c	cpu_loongson2

include "dev/ata/files.ata"
include "dev/atapiscsi/files.atapiscsi"
include	"dev/hid/files.hid"
include	"dev/i2c/files.i2c"
include	"dev/gpio/files.gpio"
include	"dev/isa/files.isa"
include	"dev/isa/files.isapnp"
include	"dev/mii/files.mii"
include	"dev/pci/files.pci"
include	"dev/pckbc/files.pckbc"
include	"dev/usb/files.usb"
include "dev/rasops/files.rasops"
include "dev/wscons/files.wscons"
include "dev/wsfont/files.wsfont"
include	"scsi/files.scsi"

define	mainbus {}
device	mainbus
attach	mainbus at root
file	arch/loongson/dev/mainbus.c			mainbus

device	cpu
attach	cpu at mainbus

device	clock
attach	clock at mainbus

device	bonito {}: pcibus
attach	bonito at mainbus
file	arch/loongson/dev/bonito.c			bonito

device	htb {}: pcibus
attach	htb at mainbus
file	arch/loongson/dev/htb.c				htb

# AMD Geode CS5536 companion chip
file	arch/loongson/dev/glx.c				bonito & pci

# Other PCI-ISA bridges
device	pcib: isabus
attach	pcib at pci
file	arch/loongson/dev/pcib.c			pcib | glxpcib

# Lemote Yeeloong RTC
device	mcclock
attach	mcclock at isa with mcclock_isa
file	arch/loongson/dev/mcclock.c			mcclock
file	arch/loongson/dev/mcclock_isa.c			mcclock_isa

# Lemote Yeeloong KB3310B Embedded Controller
device	ykbec
attach	ykbec at isa
file	arch/loongson/dev/kb3310.c			ykbec needs-flag

# Silicon Motion SM502 master device
device	voyager {}: gpiobus
attach	voyager at pci
file	arch/loongson/dev/voyager.c			voyager

# SM502 specific I2C bus bit-banging
device	gdiumiic: i2cbus, i2c_bitbang
attach	gdiumiic at gpio
file	arch/loongson/dev/gdiumiic.c			gdiumiic

# Gdium ST7 controller
device	stsec
attach	stsec at i2c
file	arch/loongson/dev/stsec.c			stsec

# Gdium M41T8x RTC
device	mfokclock
attach	mfokclock at i2c
file	arch/loongson/dev/m41t8xclock.c			mfokclock

# SM502 OHCI
attach	ohci at voyager with ohci_voyager
file	arch/loongson/dev/ohci_voyager.c		ohci_voyager

# Silicon Motion SM502/SM712 frame buffer
device	smfb: wsemuldisplaydev, rasops16
attach	smfb at pci with smfb_pci
attach	smfb at voyager with smfb_voyager
file	arch/loongson/dev/smfb.c			smfb	needs-flag

# SIS 315 Pro frame buffer
device	sisfb: wsemuldisplaydev, rasops8, rasops15, rasops16, rasops32
attach	sisfb at pci
file	arch/loongson/dev/sisfb.c			sisfb	needs-flag

# Radeon frame buffer
device	radeonfb: wsemuldisplaydev, rasops16
attach	radeonfb at pci
file	arch/loongson/dev/radeonfb.c			radeonfb needs-flag

device	apm
attach	apm at mainbus
file	arch/loongson/dev/apm.c				apm	needs-flag

device	glxclk
attach	glxclk at glxpcib
file	arch/loongson/dev/glxclk.c			glxclk

define	leiobus {}

device	leioc: leiobus
attach	leioc at mainbus
file	arch/loongson/dev/leioc.c			leioc

attach	com at leiobus with com_leioc
file	arch/loongson/dev/com_leioc.c			com_leioc
@


1.23
log
@Add interrupt handling routines for Loongson 3A.

Feedback from miod@@
@
text
@d1 1
a1 1
#	$OpenBSD: files.loongson,v 1.22 2016/01/12 17:17:33 deraadt Exp $
d22 1
a23 1
file	arch/loongson/loongson/lemote3a_machdep.c	cpu_loongson3
d66 4
d136 9
@


1.22
log
@include files.hid before files.i2c
@
text
@d1 1
a1 1
#	$OpenBSD: files.loongson,v 1.21 2016/01/08 15:54:13 jcs Exp $
d25 1
@


1.21
log
@Move HID support files out of dev/usb into new dev/hid directory

These files aren't USB-specific and were used by the previous
Bluetooth implementation, and will be used by the upcoming
HID-over-i2C implementation

ok deraadt
previous version ok kettenis and mpi
@
text
@d1 1
a1 1
#	$OpenBSD: files.loongson,v 1.20 2015/08/15 22:31:38 miod Exp $
d36 1
a38 1
include	"dev/hid/files.hid"
@


1.20
log
@Some bits for Loongson 3A support.
@
text
@d1 1
a1 1
#	$OpenBSD: files.loongson,v 1.19 2015/07/08 13:37:31 dlg Exp $
d38 1
@


1.19
log
@unify the mutex implementations on all the mips64 platforms.

this basically copies the sgi implementation to mips64 and removes
it from the rest. this way they get an optimised UP mutex implementation
and correct asserts on all platforms.

ok miod@@ jmatthew@@
@
text
@d1 1
a1 1
#	$OpenBSD: files.loongson,v 1.18 2014/07/11 21:54:37 tedu Exp $
d20 2
a21 2
file	arch/loongson/loongson/gdium_machdep.c
file	arch/loongson/loongson/generic2e_machdep.c
d23 1
d25 1
d32 1
a32 1
file	arch/loongson/loongson/yeeloong_machdep.c
d117 5
@


1.18
log
@"It's not the years, honey; it's the mileage."

bluetooth support doesn't work and isn't going anywhere. the current
design is a dead end, and should not be the basis for any future support.
general consensus says to whack it so as to not mislead the unwary.
@
text
@d1 1
a1 1
#	$OpenBSD: files.loongson,v 1.17 2013/11/04 14:07:16 deraadt Exp $
a25 1
file	arch/loongson/loongson/mutex.c
@


1.17
log
@remove iop(4) driver.  it is entirely unmaintained and supports something
which basically doesn't exist at all.
reminded about it by brad
@
text
@d1 1
a1 1
#	$OpenBSD: files.loongson,v 1.16 2013/08/15 06:54:35 kettenis Exp $
a42 1
include "dev/bluetooth/files.bluetooth"
@


1.16
log
@Include files.agp and files.drm from files.pci.  Makes sure "drm.h" gets
generated on all architectures that support pci, making alpha and loongson
compile again.

ok todd@@, miod@@ seemed to agree with the idea
@
text
@d1 1
a1 1
#	$OpenBSD: files.loongson,v 1.15 2013/06/02 21:46:04 pirofti Exp $
a36 1
include	"dev/i2o/files.i2o"
@


1.15
log
@Start working on hibernate support for Loongson

This is work in progress. Nothing to test or play with for now.
Commiting it now so that I can work on it in-tree.

Okay miod@@
@
text
@d1 1
a1 1
#	$OpenBSD: files.loongson,v 1.14 2013/01/14 21:18:47 pirofti Exp $
a41 1
include	"dev/pci/files.agp"
@


1.14
log
@Loongson: Replace the system clock provided by the CPU with a GLX MFGPT.

CPU throttling was not possible due to the fact that the system clock
was the CPU clock. So slowing down the CPU would also slow down the
passing of time.

This commit adds a driver for the MFGPT1 clock from the AMD companion
chip found on lemote and hooks it up as the system clock.

It also changes the frequency value of hz from the default, which was
100, to 128. That's because the scaling on MFGPT clocks is represented
by powers of two.

Okay miod@@.
@
text
@d1 1
a1 1
#	$OpenBSD: files.loongson,v 1.13 2010/10/14 21:23:04 pirofti Exp $
d25 1
@


1.13
log
@Move glxpcib(4) to MI land unifying the two MD drivers.

Specific features of the companion chip will be handled in MD land.

Okay deraadt@@.
@
text
@d1 1
a1 1
#	$OpenBSD: files.loongson,v 1.12 2010/09/01 04:52:41 miod Exp $
d122 4
@


1.12
log
@Let non-ykbec kernels link again.
@
text
@d1 1
a1 1
#	$OpenBSD: files.loongson,v 1.11 2010/05/08 21:59:53 miod Exp $
a66 5

# AMD Geode CS5536 PCI-ISA bridge
device	glxpcib: isabus, gpiobus
attach	glxpcib at pci
file	arch/loongson/dev/glxpcib.c			glxpcib
@


1.11
log
@Huge work-in-progress commit to support Loongson 2E-based evaluation boards
with a VIA 686 southbridge.

Features:
- 686 setup code (no thanks to PMON for not initializing the beast).
- work in progress ISA interrupt handling code.
- support for vga(4) compatible devices as console, in PC-compatible text mode.
- move legacy (ISA) support code out of bonito(4) to make things clearer.
- support more than 256MB on 2E-based systems.

Tested on a generic 2E-based evaluation board by someone who wishes to remain
anonymous; you know who you are, thank you very much for testing.
@
text
@d1 1
a1 1
#	$OpenBSD: files.loongson,v 1.10 2010/03/03 13:33:27 jasper Exp $
d87 1
a87 1
file	arch/loongson/dev/kb3310.c			ykbec
@


1.10
log
@- add and enable bluetooth

ok miod@@ otto@@
@
text
@d1 1
a1 1
#	$OpenBSD: files.loongson,v 1.9 2010/02/28 22:32:50 miod Exp $
d21 2
d41 1
d72 5
a76 1
file	arch/loongson/dev/pcib.c			glxpcib
@


1.9
log
@Minimal frame buffer driver for the SiS 315 found on Lemote Fuloong systems.
Currently unable to change video modes or provide any form of acceleration,
so you are stuck in a 640x400x8 mode, but at least people scared of serial
consoles will get a chance to use their Fuloongs now.

Tested by otto@@ (early developments) and jasper@@ (final version)
@
text
@d1 1
a1 1
#	$OpenBSD: files.loongson,v 1.8 2010/02/28 08:30:27 otto Exp $
d41 1
@


1.8
log
@Basic apm(4), providing battery/power status and events. apm(4) is the
generic part, ykbec(4) provides the device specific parts. Other
battery/power status drivers can easily hook to adb(4). With help
from miod@@; ok matthieu@@ miod@@ jasper@@
@
text
@d1 1
a1 1
#	$OpenBSD: files.loongson,v 1.7 2010/02/26 14:53:11 miod Exp $
d110 5
@


1.7
log
@Subdevice interrupt dispatcher for voyager(4) and ohci@@voyager device, only
allowed to match on old gdium artwork, as newer artwork have nothing
connected to the usb pins, and this causes the empty bus probe to stall the
boot a few seconds.
@
text
@d1 1
a1 1
#	$OpenBSD: files.loongson,v 1.6 2010/02/24 22:16:18 miod Exp $
d110 4
@


1.6
log
@Minimal support for the ST7 chip found on Gdium Liberty, brings us battery
information and a few other things not yet wired.
@
text
@d1 1
a1 1
#	$OpenBSD: files.loongson,v 1.5 2010/02/23 21:04:16 otto Exp $
d100 4
@


1.5
log
@ykbec(4), a driver to read fan, temperature and battery status using
the kb3310b embedded controller chip on the yeeloong. With help & ok miod@@
@
text
@d1 1
a1 1
#	$OpenBSD: files.loongson,v 1.4 2010/02/19 00:21:43 miod Exp $
d90 5
@


1.4
log
@Add a driver for the M41T8x time-of-day clock chips, such as the M41T83
found on the Gdium Liberty. These machines finally no longer complain about
a missing todclock.
@
text
@d1 1
a1 1
#	$OpenBSD: files.loongson,v 1.3 2010/02/18 22:45:26 miod Exp $
d75 5
@


1.3
log
@Add a master driver for the VoyagerGX SM502 chip found on the Gdium, which is
not only a framebuffer. Allow smfb to attach either at pci or at voyager.

Add gpio@@voyager and gdiumiic@@gpio, a derivative of the MI gpioiic driver.
This allows us to get lmtemp@@iic on the Lemote; the next step being to
write a driver for the i2c todclock chip found on the same bus.
@
text
@d1 1
a1 1
#	$OpenBSD: files.loongson,v 1.2 2010/02/05 20:51:20 miod Exp $
d85 5
@


1.2
log
@Blind support for the EMTEC Gdium Liberty netbook. Per-platform configuration
is moved to specific files, and a pointer to the key configuration structure
is now kept in struct sys_config.
bonito(4) interrupt handling is split, to allow PCI+Legacy interrupt systems
(Lemote Yeelong) and PCI-only Legacy-free systems (Gdium) to coexist
peacefully.
@
text
@d1 1
a1 1
#	$OpenBSD: files.loongson,v 1.1.1.1 2009/12/25 21:09:57 miod Exp $
d76 11
a86 1
# Silicon Motion SM712 frame buffer
d88 2
a89 1
attach	smfb at pci
@


1.1
log
@Initial revision
@
text
@d1 1
a1 1
#	$OpenBSD$
d20 1
d28 1
d70 1
a70 1
# RTC
@


1.1.1.1
log
@By popular demand and peer pressure, check-in work in progress work to support
the Yeelong Lemote mips-based netbook. Kernel bits only for now, needs
polishing; most of this work done during h2k9 last month, although the
porting effort started earlier this year.
@
text
@@
