head	1.3;
access;
symbols
	SMP_SYNC_A:1.3
	SMP_SYNC_B:1.3
	UBC_SYNC_A:1.3
	UBC_SYNC_B:1.3
	OPENBSD_2_9:1.2.0.14
	OPENBSD_2_9_BASE:1.2
	OPENBSD_2_8:1.2.0.12
	OPENBSD_2_8_BASE:1.2
	OPENBSD_2_7:1.2.0.10
	OPENBSD_2_7_BASE:1.2
	SMP:1.2.0.8
	SMP_BASE:1.2
	kame_19991208:1.2
	OPENBSD_2_6:1.2.0.6
	OPENBSD_2_6_BASE:1.2
	OPENBSD_2_5:1.2.0.4
	OPENBSD_2_5_BASE:1.2
	OPENBSD_2_4:1.2.0.2
	OPENBSD_2_4_BASE:1.2
	OPENBSD_2_3:1.1.0.6
	OPENBSD_2_3_BASE:1.1
	OPENBSD_2_2:1.1.0.4
	OPENBSD_2_2_BASE:1.1
	OPENBSD_2_1:1.1.0.2
	OPENBSD_2_1_BASE:1.1;
locks; strict;
comment	@ * @;


1.3
date	2001.06.24.23.47.54;	author deraadt;	state dead;
branches;
next	1.2;

1.2
date	98.05.18.00.28.09;	author millert;	state Exp;
branches
	1.2.8.1;
next	1.1;

1.1
date	96.12.22.15.17.42;	author graichen;	state Exp;
branches;
next	;

1.2.8.1
date	2001.07.04.10.21.03;	author niklas;	state dead;
branches;
next	;


desc
@@


1.3
log
@bye bye, with prejudice
@
text
@/*	$NetBSD: sii_ds.c,v 1.2 1996/10/13 16:59:15 christos Exp $	*/

/*
 * Copyright 1996 The Board of Trustees of The Leland Stanford
 * Junior University. All Rights Reserved.
 *
 * Permission to use, copy, modify, and distribute this
 * software and its documentation for any purpose and without
 * fee is hereby granted, provided that the above copyright
 * notice appear in all copies.  Stanford University
 * makes no representations about the suitability of this
 * software for any purpose.  It is provided "as is" without
 * express or implied warranty.
 *
 * this driver contributed by Jonathan Stone
 */

#include <sys/param.h>
#include <sys/systm.h>
#include <sys/types.h>
#include <sys/device.h>
#include <sys/tty.h>
#include <machine/autoconf.h>
#include <pmax/dev/device.h>		/* XXX old pmax SCSI drivers */
#include <pmax/dev/siireg.h>
#include <pmax/dev/siivar.h>

#include <pmax/pmax/kn01.h>		/* kn01 (ds3100) address constants */

extern struct cfdriver mainbus_cd;	/* XXX */

/*
 * Autoconfig definition of driver front-end
 */
int	sii_ds_match  __P((struct device * parent, void *cfdata, void *aux));
void	sii_ds_attach __P((struct device *parent, struct device *self, void *aux));


extern struct cfattach sii_ds_ca;
struct cfattach sii_ds_ca = {
	sizeof(struct siisoftc), sii_ds_match, sii_ds_attach
};


/* define a safe address in the SCSI buffer for doing status & message DMA */
#define SII_BUF_ADDR	(MIPS_PHYS_TO_KSEG1(KN01_SYS_SII_B_START) \
		+ SII_MAX_DMA_XFER_LENGTH * 14)

/*
 * Match driver on Decstation (2100, 3100, 5100) based on name and probe.
 */
int
sii_ds_match(parent, match, aux)
	struct device *parent;
	void *match;
	void *aux;
{
	struct confargs *ca = aux;
	register void * siiaddr;

	if (strcmp(ca->ca_name, "sii") != 0 &&
	    strncmp(ca->ca_name, "PMAZ-AA ", 8) != 0) /*XXX*/
		return (0);

	/* XXX check for bad address, untested */
	siiaddr = (void *)ca->ca_addr;
	if (siiaddr != (void *)MIPS_PHYS_TO_KSEG1(KN01_SYS_SII)) {
		printf("(siimatch: bad addr %x, substituting %x\n",
			ca->ca_addr, MIPS_PHYS_TO_KSEG1(KN01_SYS_SII));
		siiaddr = (void *)MIPS_PHYS_TO_KSEG1(KN01_SYS_SII);
	}
	if (badaddr(siiaddr, 4))
		return (0);
	return (1);
}

void
sii_ds_attach(parent, self, aux)
	struct device *parent;
	struct device *self;
	void *aux;
{
	register struct confargs *ca = aux;
	register struct siisoftc *sc = (struct siisoftc *) self;

	sc->sc_regs = (SIIRegs *)MIPS_PHYS_TO_KSEG1(ca->ca_addr);

	/* set up scsi buffer.  XXX Why statically allocated? */
	sc->sc_buf = (void*)(MIPS_PHYS_TO_KSEG1(KN01_SYS_SII_B_START));

siiattach(sc);

	/* tie pseudo-slot to device */
	BUS_INTR_ESTABLISH(ca, siiintr, sc);
	printf("\n");
}
@


1.2
log
@new cpureg.h from NetBSD plus modifications to use the changed macro names
@
text
@@


1.2.8.1
log
@Merge in -current from two days ago in the SMP branch.
As usual with merges, they do not indicate progress, so do not hold
your breath for working SMP, and do not mail me and ask about the
state of it.  It has not changed.  There is work ongoing, but very, very
slowly.  The commit is done in parts as to not lock up the tree in too
big chunks at a time.
@
text
@@


1.1
log
@update the pmax stuff to NetBSD 961107 - this version i got somehow
compiled on my decstation 2100 (PLUTO) - but it will not fully work
out of the box - but i want to bring it into the tree because i get
my own pmax on 961228 - so that i have a good startpoint then :-)

all the OpenBSD changes to the pmax tree will follow in the next commit
@
text
@d46 1
a46 1
#define SII_BUF_ADDR	(MACH_PHYS_TO_UNCACHED(KN01_SYS_SII_B_START) \
d67 1
a67 1
	if (siiaddr != (void *)MACH_PHYS_TO_UNCACHED(KN01_SYS_SII)) {
d69 2
a70 2
			ca->ca_addr, MACH_PHYS_TO_UNCACHED(KN01_SYS_SII));
		siiaddr = (void *)MACH_PHYS_TO_UNCACHED(KN01_SYS_SII);
d86 1
a86 1
	sc->sc_regs = (SIIRegs *)MACH_PHYS_TO_UNCACHED(ca->ca_addr);
d89 1
a89 1
	sc->sc_buf = (void*)(MACH_PHYS_TO_UNCACHED(KN01_SYS_SII_B_START));
@

