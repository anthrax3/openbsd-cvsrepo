head	1.8;
access;
symbols
	OPENBSD_6_1:1.8.0.22
	OPENBSD_6_1_BASE:1.8
	OPENBSD_6_0:1.8.0.20
	OPENBSD_6_0_BASE:1.8
	OPENBSD_5_9:1.8.0.16
	OPENBSD_5_9_BASE:1.8
	OPENBSD_5_8:1.8.0.18
	OPENBSD_5_8_BASE:1.8
	OPENBSD_5_7:1.8.0.10
	OPENBSD_5_7_BASE:1.8
	OPENBSD_5_6:1.8.0.14
	OPENBSD_5_6_BASE:1.8
	OPENBSD_5_5:1.8.0.12
	OPENBSD_5_5_BASE:1.8
	OPENBSD_5_4:1.8.0.8
	OPENBSD_5_4_BASE:1.8
	OPENBSD_5_3:1.8.0.6
	OPENBSD_5_3_BASE:1.8
	OPENBSD_5_2:1.8.0.4
	OPENBSD_5_2_BASE:1.8
	OPENBSD_5_1_BASE:1.8
	OPENBSD_5_1:1.8.0.2
	OPENBSD_5_0:1.7.0.2
	OPENBSD_5_0_BASE:1.7
	OPENBSD_4_9:1.6.0.14
	OPENBSD_4_9_BASE:1.6
	OPENBSD_4_8:1.6.0.12
	OPENBSD_4_8_BASE:1.6
	OPENBSD_4_7:1.6.0.8
	OPENBSD_4_7_BASE:1.6
	OPENBSD_4_6:1.6.0.10
	OPENBSD_4_6_BASE:1.6
	OPENBSD_4_5:1.6.0.6
	OPENBSD_4_5_BASE:1.6
	OPENBSD_4_4:1.6.0.4
	OPENBSD_4_4_BASE:1.6
	OPENBSD_4_3:1.6.0.2
	OPENBSD_4_3_BASE:1.6
	OPENBSD_4_2:1.4.0.4
	OPENBSD_4_2_BASE:1.4
	OPENBSD_4_1:1.4.0.2
	OPENBSD_4_1_BASE:1.4
	OPENBSD_4_0:1.3.0.2
	OPENBSD_4_0_BASE:1.3
	OPENBSD_3_9:1.2.0.10
	OPENBSD_3_9_BASE:1.2
	OPENBSD_3_8:1.2.0.6
	OPENBSD_3_8_BASE:1.2
	OPENBSD_3_7:1.2.0.4
	OPENBSD_3_7_BASE:1.2
	OPENBSD_3_6:1.2.0.2
	OPENBSD_3_6_BASE:1.2
	SMP_SYNC_A:1.1
	SMP_SYNC_B:1.1
	OPENBSD_3_5:1.1.0.4
	OPENBSD_3_5_BASE:1.1
	SMP:1.1.0.2;
locks; strict;
comment	@ * @;


1.8
date	2011.10.21.20.48.11;	author kettenis;	state Exp;
branches;
next	1.7;

1.7
date	2011.03.06.22.40.05;	author deraadt;	state Exp;
branches;
next	1.6;

1.6
date	2008.01.15.19.30.32;	author kettenis;	state Exp;
branches;
next	1.5;

1.5
date	2007.11.16.16.16.07;	author deraadt;	state Exp;
branches;
next	1.4;

1.4
date	2006.11.25.16.59.31;	author niklas;	state Exp;
branches;
next	1.3;

1.3
date	2006.05.10.01.39.04;	author krw;	state Exp;
branches;
next	1.2;

1.2
date	2004.06.25.11.03.28;	author art;	state Exp;
branches;
next	1.1;

1.1
date	2004.01.28.01.39.39;	author mickey;	state Exp;
branches;
next	;


desc
@@


1.8
log
@Add bounds checks for access to mp_busses.
@
text
@/*	$OpenBSD: mpconfig.h,v 1.7 2011/03/06 22:40:05 deraadt Exp $	*/
/*	$NetBSD: mpconfig.h,v 1.2 2003/05/11 00:05:52 fvdl Exp $	*/

/*
 * Definitions originally from the mpbios code, but now used for ACPI
 * MP config as well.
 */

#ifndef _AMD64_MPCONFIG_H
#define _AMD64_MPCONFIG_H

#ifndef _LOCORE

struct mpbios_int;

struct mp_bus {
	char *mb_name;		/* XXX bus name */
	int mb_idx;		/* XXX bus index */
	void (*mb_intr_print)(int);
	void (*mb_intr_cfg)(const struct mpbios_int *, u_int32_t *);
	struct mp_intr_map *mb_intrs;
	u_int32_t mb_data;	/* random bus-specific datum. */
};

struct mp_intr_map {
	struct mp_intr_map *next;
	struct mp_bus *bus;
	int bus_pin;
	struct ioapic_softc *ioapic;
	int ioapic_pin;
	int ioapic_ih;		/* int handle, for apic_intr_est */
	int type;		/* from mp spec intr record */
 	int flags;		/* from mp spec intr record */
	u_int32_t redir;
	int cpu_id;
};

#if defined(_KERNEL)
extern int mp_verbose;
extern struct mp_bus *mp_busses;
extern int mp_nbusses;
extern struct mp_intr_map *mp_intrs;
extern int mp_nintrs;
extern struct mp_bus *mp_isa_bus;
extern struct mp_bus *mp_eisa_bus;
#endif
#endif

#endif /* _AMD64_MPCONFIG_H */
@


1.7
log
@The global_int information acpi collects is not used by amd64.
ok ketttenis
@
text
@d1 1
a1 1
/*	$OpenBSD: mpconfig.h,v 1.6 2008/01/15 19:30:32 kettenis Exp $	*/
d41 1
a45 1
extern int mp_nbus;
@


1.6
log
@Move some definitions from mpconfig.h to mpbiosreg.h (where they are on i396).

ok marco@@, miod@@
@
text
@d1 1
a1 1
/*	$OpenBSD: mpconfig.h,v 1.5 2007/11/16 16:16:07 deraadt Exp $	*/
a35 1
	int global_int;		/* ACPI global interrupt number */
@


1.5
log
@fix the bus_space #define nightmare, so that amd64 and i386 are much more
uniform. as a result shared code like acpi needs less #ifdef's
ok marco kettenis
@
text
@d1 1
a1 1
/*	$OpenBSD: mpconfig.h,v 1.4 2006/11/25 16:59:31 niklas Exp $	*/
a10 16

/* 
 * Interrupt typess
 */
#define MPS_INTTYPE_INT         0
#define MPS_INTTYPE_NMI         1
#define MPS_INTTYPE_SMI         2
#define MPS_INTTYPE_ExtINT      3
 
#define MPS_INTPO_DEF           0
#define MPS_INTPO_ACTHI         1
#define MPS_INTPO_ACTLO         3
 
#define MPS_INTTR_DEF           0 
#define MPS_INTTR_EDGE          1
#define MPS_INTTR_LEVEL         3
@


1.4
log
@sync amd64 to i386 w.r.t. acpi support. Also fix interrupt routing for multi-ioapic systems.
ok kettenis
@
text
@d1 1
a1 1
/*	$OpenBSD: mpconfig.h,v 1.3 2006/05/10 01:39:04 krw Exp $	*/
d9 2
a10 2
#ifndef _X86_MPCONFIG_H
#define _X86_MPCONFIG_H
d32 1
a32 2
struct mp_bus
{
d41 1
a41 2
struct mp_intr_map
{
d59 1
a59 1
extern int mp_nintr;
d66 1
a66 1
#endif /* _X86_MPCONFIG_H */
@


1.3
log
@Missing $OpenBSD$ tags.
@
text
@d1 1
a1 1
/*	$OpenBSD$	*/
d62 2
a63 1
extern int mp_isa_bus, mp_eisa_bus;
@


1.2
log
@SMP support. Big parts from NetBSD, but with some really serious debugging
done by me, niklas and others. Especially wrt. NXE support.

Still needs some polishing, especially in dmesg messages, but we're now
building kernel faster than ever.
@
text
@d1 1
@


1.1
log
@an amd64 arch support.
hacked by art@@ from netbsd sources and then later debugged
by me into the shape where it can host itself.
no bootloader yet as needs redoing from the
recent advanced i386 sources (anyone? ;)
@
text
@d1 1
a1 1
/*	$NetBSD: mpconfig.h,v 1.1 2003/02/26 21:26:11 fvdl Exp $	*/
d53 1
@

