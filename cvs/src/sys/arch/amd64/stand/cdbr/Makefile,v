head	1.11;
access;
symbols
	OPENBSD_6_1:1.11.0.2
	OPENBSD_6_1_BASE:1.11
	OPENBSD_6_0:1.10.0.8
	OPENBSD_6_0_BASE:1.10
	OPENBSD_5_9:1.10.0.4
	OPENBSD_5_9_BASE:1.10
	OPENBSD_5_8:1.10.0.6
	OPENBSD_5_8_BASE:1.10
	OPENBSD_5_7:1.10.0.2
	OPENBSD_5_7_BASE:1.10
	OPENBSD_5_6:1.9.0.4
	OPENBSD_5_6_BASE:1.9
	OPENBSD_5_5:1.7.0.8
	OPENBSD_5_5_BASE:1.7
	OPENBSD_5_4:1.7.0.4
	OPENBSD_5_4_BASE:1.7
	OPENBSD_5_3:1.7.0.2
	OPENBSD_5_3_BASE:1.7
	OPENBSD_5_2:1.3.0.32
	OPENBSD_5_2_BASE:1.3
	OPENBSD_5_1_BASE:1.3
	OPENBSD_5_1:1.3.0.30
	OPENBSD_5_0:1.3.0.28
	OPENBSD_5_0_BASE:1.3
	OPENBSD_4_9:1.3.0.26
	OPENBSD_4_9_BASE:1.3
	OPENBSD_4_8:1.3.0.24
	OPENBSD_4_8_BASE:1.3
	OPENBSD_4_7:1.3.0.20
	OPENBSD_4_7_BASE:1.3
	OPENBSD_4_6:1.3.0.22
	OPENBSD_4_6_BASE:1.3
	OPENBSD_4_5:1.3.0.18
	OPENBSD_4_5_BASE:1.3
	OPENBSD_4_4:1.3.0.16
	OPENBSD_4_4_BASE:1.3
	OPENBSD_4_3:1.3.0.14
	OPENBSD_4_3_BASE:1.3
	OPENBSD_4_2:1.3.0.12
	OPENBSD_4_2_BASE:1.3
	OPENBSD_4_1:1.3.0.10
	OPENBSD_4_1_BASE:1.3
	OPENBSD_4_0:1.3.0.6
	OPENBSD_4_0_BASE:1.3
	OPENBSD_3_9:1.3.0.8
	OPENBSD_3_9_BASE:1.3
	OPENBSD_3_8:1.3.0.4
	OPENBSD_3_8_BASE:1.3
	OPENBSD_3_7:1.3.0.2
	OPENBSD_3_7_BASE:1.3
	OPENBSD_3_6:1.2.0.2
	OPENBSD_3_6_BASE:1.2;
locks; strict;
comment	@# @;


1.11
date	2016.07.30.03.25.48;	author guenther;	state Exp;
branches;
next	1.10;
commitid	HVbAtwruDlJazNH2;

1.10
date	2015.02.07.23.23.03;	author miod;	state Exp;
branches;
next	1.9;
commitid	CVKmPQIsBhOS2vg8;

1.9
date	2014.07.15.22.14.37;	author deraadt;	state Exp;
branches;
next	1.8;
commitid	NR8siXEkpaNp3MWn;

1.8
date	2014.07.13.21.18.44;	author jasper;	state Exp;
branches;
next	1.7;
commitid	Y3LcLObEiHDZvy27;

1.7
date	2013.01.17.12.25.11;	author jsing;	state Exp;
branches;
next	1.6;

1.6
date	2012.09.25.09.01.03;	author pascal;	state Exp;
branches;
next	1.5;

1.5
date	2012.08.29.17.45.00;	author pascal;	state Exp;
branches;
next	1.4;

1.4
date	2012.08.21.14.46.18;	author pascal;	state Exp;
branches;
next	1.3;

1.3
date	2004.10.09.21.15.21;	author mickey;	state Exp;
branches;
next	1.2;

1.2
date	2004.08.24.15.33.25;	author tom;	state Exp;
branches;
next	1.1;

1.1
date	2004.08.21.18.48.37;	author tom;	state Exp;
branches;
next	;


desc
@@


1.11
log
@Prep for relro: make sure it's off for any non-PIE stand/ program

ok millert@@ kettenis@@
@
text
@#	$OpenBSD: Makefile,v 1.10 2015/02/07 23:23:03 miod Exp $
#

S=	${.CURDIR}/../../../..
SADIR=	${.CURDIR}/..

PROG=	cdbr
SRCS=	cdbr.S
AFLAGS+=-m32
AFLAGS+=-I${.CURDIR} -I${.CURDIR}/../../.. #-Wa,-a
AFLAGS+=-DOSREV=\"${OSREV}\"
AFLAGS+=-DMACH=\"${MACHINE}\" -DMACH_U=\"${MACHINE:U}\"
AFLAGS+=-fno-pie
LD=ld
ORG=	0x0000
LDFLAGS=-nostdlib -Ttext ${ORG} -x -N -s -Bstatic -e start -nopie -znorelro
LDFLAGS+=-melf_i386 -L/usr/libdata
INSTALL_STRIP=
BINMODE=644

NOMAN=
#MAN+=	cdbr.8
CLEANFILES+=	${PROG}.orig

${PROG}: $(OBJS) $(DPADD)
	$(LD) $(LDFLAGS) -o $(PROG) $(OBJS) $(LDADD)
	@@size $(PROG)
	@@if [ -x ${.OBJDIR}/${PROG} ]; then \
		cp ${PROG} ${PROG}.orig; \
		objcopy -O binary ${PROG} ${.OBJDIR}/.tmp;\
		mv -f ${.OBJDIR}/.tmp ${.OBJDIR}/${PROG}; \
		ls -l ${.OBJDIR}/${PROG}; \
	fi

.include <bsd.prog.mk>
@


1.10
log
@Add the .orig file to CLEANFILES
@
text
@d1 1
a1 1
#	$OpenBSD: Makefile,v 1.9 2014/07/15 22:14:37 deraadt Exp $
d16 1
a16 1
LDFLAGS=-nostdlib -Ttext ${ORG} -x -N -s -Bstatic -e start -nopie
@


1.9
log
@mode 644 for installing these files
@
text
@d1 1
a1 1
#	$OpenBSD: Makefile,v 1.8 2014/07/13 21:18:44 jasper Exp $
d23 1
@


1.8
log
@fix even more trailing tabs
@
text
@d1 1
a1 1
#	$OpenBSD: Makefile,v 1.7 2013/01/17 12:25:11 jsing Exp $
d19 1
@


1.7
log
@Clean up/standardise makefiles for amd64/stand.
@
text
@d1 1
a1 1
#	$OpenBSD: Makefile,v 1.5 2012/08/29 17:45:00 pascal Exp $
d17 1
a17 1
LDFLAGS+=-melf_i386 -L/usr/libdata 
@


1.6
log
@Reduce the diff between amd64/stand and i386/stand, requested by deraadt@@.
These create essentially the same bootblocks, so the build system should not be
diverging too much, or at least easily diffable.
There is still a lot of work to be done here, but this is the low-hanging fruit.

ok jsing@@
@
text
@d4 3
d18 1
a22 4
INSTALL_STRIP=
SADIR=${.CURDIR}/..
S=	${.CURDIR}/../../../..

d27 1
@


1.5
log
@Get rid of all NOPIE and NOPIE_FLAGS in amd64/stand and use -fno-pie and -nopie
directly instead.  This will be the approach taken by every other arch too
in the near future.  It is easier than relying on bsd.own.mk to set these
correctly.

discussed with and ok deraadt@@
@
text
@d1 1
a1 1
#	$OpenBSD: Makefile,v 1.4 2012/08/21 14:46:18 pascal Exp $
d6 2
a7 1
AFLAGS+=-m32 -I${.CURDIR} -I${.CURDIR}/../../.. #-Wa,-a
d13 2
a14 2
LDFLAGS=-melf_i386 -nostdlib -Ttext ${ORG} -x -N -s -Bstatic -e start
LDFLAGS+=-nopie -L/usr/libdata 
@


1.4
log
@Add NOPIE= bits for sys/arch/*/stand to ensure that bootblocks will always be
built with -fno-pie.  This gets the hairiest part of PIE out of the way ...

ok deraadt@@
@
text
@d1 1
a1 1
#	$OpenBSD: Makefile,v 1.3 2004/10/09 21:15:21 mickey Exp $
d9 1
a9 1
AFLAGS+=${NOPIE_FLAGS}
d13 1
a13 1
LDFLAGS+=-L/usr/libdata 
@


1.3
log
@size works now on cross-size .o files
@
text
@d1 1
a1 1
#	$OpenBSD: Makefile,v 1.2 2004/08/24 15:33:25 tom Exp $
d9 1
@


1.2
log
@Have cdbr look for cdboot at /3.6/amd64/cdboot as well as at /cdboot.

"go for it" deraadt@@
@
text
@d1 1
a1 1
#	$OpenBSD: Makefile,v 1.1 2004/08/21 18:48:37 tom Exp $
d23 1
a23 1
	#@@size $(PROG)
@


1.1
log
@Enter cdbr, an El Torito no-emulation CD boot sector that fits
comfortably in a single CD sector of 2,048.

Based on the OpenBSD/i386 code that Toby and I put together at the
hackathon, which was in turn based on the FreeBSD equivalent by
John Baldwin, jhb (at) FreeBSD (dot) org.

"go for it" deraadt@@
@
text
@d1 1
a1 1
#	$OpenBSD: Makefile,v 1.1 2004/06/22 23:12:18 tom Exp $
d7 2
@

