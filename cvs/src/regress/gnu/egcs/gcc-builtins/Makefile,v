head	1.3;
access;
symbols
	OPENBSD_6_1:1.3.0.4
	OPENBSD_6_1_BASE:1.3
	OPENBSD_6_0:1.2.0.12
	OPENBSD_6_0_BASE:1.2
	OPENBSD_5_9:1.2.0.2
	OPENBSD_5_9_BASE:1.2
	OPENBSD_5_8:1.2.0.10
	OPENBSD_5_8_BASE:1.2
	OPENBSD_5_7:1.2.0.8
	OPENBSD_5_7_BASE:1.2
	OPENBSD_5_6:1.2.0.6
	OPENBSD_5_6_BASE:1.2
	OPENBSD_5_5:1.2.0.4
	OPENBSD_5_5_BASE:1.2;
locks; strict;
comment	@# @;


1.3
date	2016.09.25.21.35.12;	author bluhm;	state Exp;
branches;
next	1.2;
commitid	Ng7pnKonlZp9gAE2;

1.2
date	2013.12.28.03.19.02;	author martynas;	state Exp;
branches;
next	1.1;

1.1
date	2013.12.28.02.14.32;	author martynas;	state Exp;
branches;
next	;


desc
@@


1.3
log
@Adapt more places where binutils-2.17 has changed the format of the
linker warning massages.
@
text
@# $OpenBSD: Makefile,v 1.2 2013/12/28 03:19:02 martynas Exp $

GCC_BUILTINS=	sprintf-1 sprintf-2 sprintf-3 stpcpy-1 stpcpy-2 strcat-1 \
		strcat-2 strcpy-1 strcpy-2 strncat-1 vsprintf-1 vsprintf-2 \
		vsprintf-3

TCC=		gcc
TCFLAGS=	-O2
TCXXFLAGS=	${TCFLAGS}

.for i in ${GCC_BUILTINS}
REGRESS_TARGETS+= c-${i}
c-${i}:
	${TCC} ${TCFLAGS} -o /dev/null ${i}.c 2>&1 | sed '/^\/tmp\//d;s/(\.text+0x[0-9a-f]*)//' | diff -u - ${.CURDIR}/${i}.c.exp
.endfor

generate:
.for i in ${REGRESS_TARGETS}
	-${TCC} ${TCFLAGS} -o /dev/null ${i:C/^c-//g}.c 2>&1 | sed '/^\/tmp\//d;s/(\.text+0x[0-9a-f]*)//' >${i:C/^c-//g}.c.exp
.endfor

.PHONY:	${REGRESS_TARGETS} generate regress

NOOBJ= Yes

.include <bsd.regress.mk>
@


1.2
log
@- adjust getcwd-1.c.exp.gcc{3,4} after the getwd linker warning got added
- adjust gcc-builtins to use the same approach as gcc-bounds
- enable gcc-bounds and gcc-builtins in the default regression suite
now that everything passes
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.1 2013/12/28 02:14:32 martynas Exp $
d14 1
a14 1
	${TCC} ${TCFLAGS} -o /dev/null ${i}.c 2>&1 | sed '/^\/tmp\//d' | diff -u - ${.CURDIR}/${i}.c.exp
d19 1
a19 1
	-${TCC} ${TCFLAGS} -o /dev/null ${i:C/^c-//g}.c 2>&1 | sed '/^\/tmp\//d' >${i:C/^c-//g}.c.exp
@


1.1
log
@Add regression tests to check whether GCC folds unsafe builtins and
actually shows the security warning.  Also add some other cases
where GCC used to yield the warning but shouldn't (e.g. strncat
simplified into strcat).
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.13 2013/08/06 19:11:53 miod Exp $
d14 1
a14 1
	${TCC} ${TCFLAGS} -o /dev/null ${i}.c 2>&1 | cut -d: -f2- | diff -u - ${.CURDIR}/${i}.c.exp
d19 1
a19 1
	-${TCC} ${TCFLAGS} -o /dev/null ${i:C/^c-//g}.c 2>&1 | cut -d: -f2- >${i:C/^c-//g}.c.exp
@

