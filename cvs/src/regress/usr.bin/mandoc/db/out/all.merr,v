head	1.2;
access;
symbols
	OPENBSD_6_2_BASE:1.2
	OPENBSD_6_1:1.1.0.4
	OPENBSD_6_1_BASE:1.1;
locks; strict;
comment	@# @;


1.2
date	2017.08.23.12.25.02;	author schwarze;	state Exp;
branches;
next	1.1;
commitid	nCNJdJGiqbVuA3Fb;

1.1
date	2016.08.30.22.20.03;	author schwarze;	state Exp;
branches;
next	;
commitid	7v8nWmf1zaSbUjAK;


desc
@@


1.2
log
@Catch up with mansearch.c rev. 1.60: When finding a bogus database
entry, print a meaningful warning and skip the entry.

The tests now require the actual manual pages to be around in
addition to the database, they find more results and print more
warnings.
@
text
@
>>> empty
man: nothing appropriate

>>> badname0
man: dbm_get: Database corrupt: offset -1
man: outdated mandoc.db lacks empty(1) entry, run makewhatis /usr/obj/regress/usr.bin/mandoc/db/run/man

>>> badname
man: dbm_get: Database corrupt: offset -1

>>> badsect0
man: dbm_get: Database corrupt: offset -1
man: outdated mandoc.db lacks empty(1) entry, run makewhatis /usr/obj/regress/usr.bin/mandoc/db/run/man

>>> badsect
man: dbm_get: Database corrupt: offset -1

>>> badarch0
man: dbm_get: Database corrupt: offset -1

>>> badarch
man: dbm_get: Database corrupt: offset -1

>>> baddesc0
man: dbm_get: Database corrupt: offset -1
man: dbm_get: Database corrupt: offset -1

>>> baddesc
man: dbm_get: Database corrupt: offset -1

>>> badfile0
man: dbm_get: Database corrupt: offset -1
man: /usr/obj/regress/usr.bin/mandoc/db/run/man/(NULL): No such file or directory
man: outdated mandoc.db contains bogus (NULL) entry, run makewhatis /usr/obj/regress/usr.bin/mandoc/db/run/man
man: outdated mandoc.db lacks empty(1) entry, run makewhatis /usr/obj/regress/usr.bin/mandoc/db/run/man

>>> badfile
man: dbm_get: Database corrupt: offset -1
man: /usr/obj/regress/usr.bin/mandoc/db/run/man/(NULL): No such file or directory
man: outdated mandoc.db contains bogus (NULL) entry, run makewhatis /usr/obj/regress/usr.bin/mandoc/db/run/man
@


1.1
log
@Test handling of invalid pointers in the pages table.
In such cases, do not access NULL pointers in dbm_dump.
Make the setup in the run/Makefile a bit more systematic.
Output starts getting too long, so make everything silent;
you can always use "make -dl" to debug specific tests.
@
text
@d7 1
a7 1
man: No entry for empty in the manual.
d14 1
a14 1
man: No entry for empty in the manual.
d34 3
d40 2
@

