head	1.7;
access;
symbols
	OPENBSD_6_0:1.6.0.8
	OPENBSD_6_0_BASE:1.6
	OPENBSD_5_9:1.6.0.2
	OPENBSD_5_9_BASE:1.6
	OPENBSD_5_8:1.6.0.6
	OPENBSD_5_8_BASE:1.6
	OPENBSD_5_7:1.6.0.4
	OPENBSD_5_7_BASE:1.6
	OPENBSD_5_6:1.1.0.10
	OPENBSD_5_6_BASE:1.1
	OPENBSD_5_5:1.1.0.8
	OPENBSD_5_5_BASE:1.1
	OPENBSD_5_4:1.1.0.4
	OPENBSD_5_4_BASE:1.1
	OPENBSD_5_3:1.1.0.2
	OPENBSD_5_3_BASE:1.1;
locks; strict;
comment	@# @;


1.7
date	2016.08.20.15.58.16;	author schwarze;	state Exp;
branches;
next	1.6;
commitid	g44rlhr1yUH2kxKq;

1.6
date	2015.02.12.13.00.27;	author schwarze;	state Exp;
branches;
next	1.5;
commitid	iMgtO2LMSIEj6vCq;

1.5
date	2014.12.18.19.22.47;	author schwarze;	state Exp;
branches;
next	1.4;
commitid	gEOgPFvFGEiQs5LO;

1.4
date	2014.12.18.03.09.42;	author schwarze;	state Exp;
branches;
next	1.3;
commitid	gf4J2ZJoC3QosoVG;

1.3
date	2014.08.26.11.32.54;	author schwarze;	state Exp;
branches;
next	1.2;
commitid	QJnN8iCFzEXgbRZx;

1.2
date	2014.08.17.18.42.07;	author schwarze;	state Exp;
branches;
next	1.1;
commitid	sx8BHByh8NPOG90r;

1.1
date	2012.11.16.13.25.34;	author schwarze;	state Exp;
branches;
next	;


desc
@@


1.7
log
@When scanning upwards for a column list to put a .Ta macro in,
ignore body end markers of lists breaking other blocks.
Fixing a logical error that caused a NULL deref found by tb@@ with afl(1).
@
text
@BL-BREAK(1)                 General Commands Manual                BL-BREAK(1)

NNAAMMEE
     BBll--bbrreeaakk - list breaking another block

DDEESSCCRRIIPPTTIIOONN
     before both

           1.   before bracket [inside both after list]
     in between

           1.   before bracket [inside both
                stray item]
     after both

EEXXAAMMPPLLEESS
           1.   before display

                      inside both after display
     in between

           1.   before display

                      inside both
                      stray item
     after both

           1.   before table

                column

                      inside display first line after table second line after
                      table after list


DDIIAAGGNNOOSSTTIICCSS
     column

           inside display after stray tab

     after display

CCAAVVEEAATTSS
     before broken block [inside both after list]

BBUUGGSS
     1.

OpenBSD                         August 20, 2016                        OpenBSD
@


1.6
log
@Do not confuse .Bl -column lists that just broken another block
with newly opened .Bl -column lists;
fixing an assertion failure jsg@@ found with afl:
test case #481, Bl It Bl -column It Bd El text text El
@
text
@d36 7
d49 1
a49 1
OpenBSD                        December 18, 2014                       OpenBSD
@


1.5
log
@When the head of a list item is extended with a partial explicit
macro (for example .Xo) and never closed again, the item ends up
without a body block.  This can even happen for list types that
usually don't have heads in the first place.  So even in this
case, check for the existence of the body before accessing it.
NULL pointer access found by jsg@@ with afl.
@
text
@d28 8
@


1.4
log
@The code is already careful to not add items to lists that were
already closed.  In this respect, also consider lists closed
that have broken another block, their closure pending until the
end of the broken block.  This avoids syntax tree corruption
leading to a NULL pointer access found by jsg@@ with afl.
@
text
@d31 3
@


1.3
log
@inevitable churn caused by the section title change
@
text
@d10 4
d20 6
d31 1
a31 1
OpenBSD                        November 16, 2012                       OpenBSD
@


1.2
log
@Segfault fixes from kristaps@@.
Note that .It and .Nm blocks without bodies cannot be generated by
valid mdoc(7) syntax but are a adequate representations of invalid
mdoc(7) constructs like Bl -hang It Bo Sh and Sh SYNOPSIS Nm Bo Sh.
@
text
@d1 1
a1 1
BL-BREAK(1)                OpenBSD Reference Manual                BL-BREAK(1)
@


1.1
log
@Fix a crash triggered by .Bl -tag .It Xo .El .Sh found by florian@@.

* When allocating a body end marker, copy the pointer to the normalized
block information from the body block, avoiding the risk of subsequent
null pointer derefence.
* When inserting the body end marker into the syntax tree, do not try to
copy that pointer from the parent block, because not being a direkt child
of the block it belongs to is the whole point of a body end marker.
* Even non-callable blocks (like Bd and Bl) can break other blocks;
when this happens, postpone closing them out in the usual way.
@
text
@d18 3
@

