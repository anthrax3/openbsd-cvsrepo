head	1.32;
access;
symbols
	OPENBSD_6_2:1.32.0.2
	OPENBSD_6_2_BASE:1.32
	OPENBSD_6_1:1.32.0.4
	OPENBSD_6_1_BASE:1.32
	OPENBSD_6_0:1.31.0.8
	OPENBSD_6_0_BASE:1.31
	OPENBSD_5_9:1.31.0.2
	OPENBSD_5_9_BASE:1.31
	OPENBSD_5_8:1.31.0.6
	OPENBSD_5_8_BASE:1.31
	OPENBSD_5_7:1.31.0.4
	OPENBSD_5_7_BASE:1.31
	OPENBSD_5_6:1.28.0.4
	OPENBSD_5_6_BASE:1.28
	OPENBSD_5_5:1.25.0.10
	OPENBSD_5_5_BASE:1.25
	OPENBSD_5_4:1.25.0.6
	OPENBSD_5_4_BASE:1.25
	OPENBSD_5_3:1.25.0.4
	OPENBSD_5_3_BASE:1.25
	OPENBSD_5_2:1.25.0.2
	OPENBSD_5_2_BASE:1.25
	OPENBSD_5_1_BASE:1.17
	OPENBSD_5_1:1.17.0.2
	OPENBSD_5_0:1.15.0.2
	OPENBSD_5_0_BASE:1.15
	OPENBSD_4_9:1.14.0.2
	OPENBSD_4_9_BASE:1.14
	OPENBSD_4_8:1.8.0.2
	OPENBSD_4_8_BASE:1.8
	OPENBSD_4_7:1.5.0.2
	OPENBSD_4_7_BASE:1.5;
locks; strict;
comment	@# @;


1.32
date	2017.01.11.17.39.45;	author schwarze;	state Exp;
branches;
next	1.31;
commitid	2X81lVBLl8eAHRVh;

1.31
date	2014.12.22.23.26.20;	author schwarze;	state Exp;
branches;
next	1.30;
commitid	7lnT7ht5X6HoJfAt;

1.30
date	2014.11.27.16.20.27;	author schwarze;	state Exp;
branches;
next	1.29;
commitid	snF2JxsotuPud6ts;

1.29
date	2014.08.14.02.00.52;	author schwarze;	state Exp;
branches;
next	1.28;
commitid	pqgg86JpQ4OXDxJ3;

1.28
date	2014.07.01.22.36.35;	author schwarze;	state Exp;
branches;
next	1.27;
commitid	6SNWblzmBTWk9YRA;

1.27
date	2014.06.20.18.32.51;	author schwarze;	state Exp;
branches;
next	1.26;
commitid	jjzTl6WbjEdf57ey;

1.26
date	2014.06.20.18.27.51;	author schwarze;	state Exp;
branches;
next	1.25;
commitid	mLT3bl90uvOuwvq2;

1.25
date	2012.07.18.16.55.54;	author schwarze;	state Exp;
branches;
next	1.24;

1.24
date	2012.07.09.23.52.47;	author schwarze;	state Exp;
branches;
next	1.23;

1.23
date	2012.07.09.22.36.04;	author schwarze;	state Exp;
branches;
next	1.22;

1.22
date	2012.07.09.17.52.09;	author schwarze;	state Exp;
branches;
next	1.21;

1.21
date	2012.07.08.22.48.38;	author schwarze;	state Exp;
branches;
next	1.20;

1.20
date	2012.07.08.18.38.07;	author schwarze;	state Exp;
branches;
next	1.19;

1.19
date	2012.07.08.16.50.36;	author schwarze;	state Exp;
branches;
next	1.18;

1.18
date	2012.07.07.14.10.55;	author schwarze;	state Exp;
branches;
next	1.17;

1.17
date	2011.12.04.03.12.35;	author schwarze;	state Exp;
branches;
next	1.16;

1.16
date	2011.11.17.16.28.45;	author schwarze;	state Exp;
branches;
next	1.15;

1.15
date	2011.07.24.20.26.52;	author schwarze;	state Exp;
branches;
next	1.14;

1.14
date	2011.02.06.22.56.45;	author schwarze;	state Exp;
branches;
next	1.13;

1.13
date	2011.02.06.00.18.58;	author schwarze;	state Exp;
branches;
next	1.12;

1.12
date	2011.02.05.18.19.11;	author schwarze;	state Exp;
branches;
next	1.11;

1.11
date	2011.01.30.18.28.02;	author schwarze;	state Exp;
branches;
next	1.10;

1.10
date	2010.12.19.12.10.33;	author schwarze;	state Exp;
branches;
next	1.9;

1.9
date	2010.12.04.14.49.40;	author schwarze;	state Exp;
branches;
next	1.8;

1.8
date	2010.07.01.05.29.57;	author schwarze;	state Exp;
branches;
next	1.7;

1.7
date	2010.04.12.23.02.03;	author schwarze;	state Exp;
branches;
next	1.6;

1.6
date	2010.04.08.00.29.28;	author schwarze;	state Exp;
branches;
next	1.5;

1.5
date	2010.02.17.22.35.17;	author schwarze;	state Exp;
branches;
next	1.4;

1.4
date	2010.01.02.02.35.53;	author schwarze;	state Exp;
branches;
next	1.3;

1.3
date	2009.12.25.02.00.46;	author schwarze;	state Exp;
branches;
next	1.2;

1.2
date	2009.12.24.23.21.14;	author schwarze;	state Exp;
branches;
next	1.1;

1.1
date	2009.10.28.03.20.42;	author schwarze;	state Exp;
branches;
next	;


desc
@@


1.32
log
@Do text production for .Bt, .Ex, .Rv, .Ud at the validation stage
rather than in the formatters.  Use NODE_NOSRC flag for .Lb and
NODE_NOSRC and NODE_NOPRT for .St.  Results in a more rigorous
syntax tree and in 135 lines less code.

This work was triggered by a question from Abhinav Upadhyay <er dot
abhinav dot upadhyay at gmail dot com> (NetBSD) on discuss@@.
@
text
@# $OpenBSD: Makefile,v 1.31 2014/12/22 23:26:20 schwarze Exp $

SUBDIR  = Ad An Ap Aq Ar At Bd Bf Bk Bl Brq Bx Cd Cm
SUBDIR += D1 Db Dd Dl Dq Dt Dv Em Eo Er Ev Ex Fd Fl Fo Ft Ic In Lb Li Lk
SUBDIR += Ms Mt Nd Nm No Ns Oo Op Os Ox Pa Pf Pp Qq Rs Rv
SUBDIR += Sh Sm Sq St Sx Sy Tn Ud Ux Va Vt Xr blank break

.include "../Makefile.sub"
.include <bsd.subdir.mk>
@


1.31
log
@The code already pays attention not to close the same block twice.
Similarly, avoid having the same block break two other blocks.
In some situations, this could lead to an endless loop in rew_sub()
found by jsg@@ with afl.
Minimal example:  .Po Ao Pc Bo Pc Ac Bc
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.30 2014/11/27 16:20:27 schwarze Exp $
d6 1
a6 1
SUBDIR += Sh Sm Sq St Sx Sy Tn Ux Va Vt Xr blank break
@


1.30
log
@Fix the obsolete .Db (toggle debug mode) macro to ignore its arguments
and not trigger an assertion when there is more than one argument;
the latter found by jsg@@ with afl.
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.29 2014/08/14 02:00:52 schwarze Exp $
d6 1
a6 1
SUBDIR += Sh Sm Sq St Sx Sy Tn Ux Va Vt Xr blank
@


1.29
log
@new regression tests collected during recent work
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.28 2014/07/01 22:36:35 schwarze Exp $
d4 1
a4 1
SUBDIR += D1 Dd Dl Dq Dt Dv Em Eo Er Ev Ex Fd Fl Fo Ft Ic In Lb Li Lk
@


1.28
log
@Clean up the warnings related to document structure.
* Hierarchical naming of the related enum mandocerr items.
* Mention the offending macro, section title, or string.
While here, improve some wordings:
* Descriptive instead of imperative style.
* Uniform style for "missing" and "skipping".
* Where applicable, mention the fallback used.
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.27 2014/06/20 18:32:51 schwarze Exp $
d4 2
a5 2
SUBDIR += D1 Dl Dq Dt Dv Em Eo Er Ev Fd Fl Fo Ft Ic In Lb Li Lk
SUBDIR += Ms Mt Nd Nm No Ns Oo Op Ox Pa Pf Pp Qq Rs
@


1.27
log
@regression tests for prologue warnings
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.26 2014/06/20 18:27:51 schwarze Exp $
d6 1
a6 1
SUBDIR += Sm Sq St Sx Sy Tn Ux Va Vt Xr blank
@


1.26
log
@Infrastructure for regression tests of mandoc messages.
Even though messages are not going to be as stable as formatted output,
that is, even though the *.out_lint files are expected to change now and then,
from now on, i want to be able to catch unintended changes in messages.
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.25 2012/07/18 16:55:54 schwarze Exp $
d4 1
a4 1
SUBDIR += D1 Dl Dq Dv Em Eo Er Ev Fd Fl Fo Ft Ic In Lb Li Lk
@


1.25
log
@enable more tests, some were forgotten along the way
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.24 2012/07/09 23:52:47 schwarze Exp $
d8 1
a8 2
ascii groff groff-clean obj-clean tman: _SUBDIRUSE

@


1.24
log
@fix -Tascii .Fd line breaking
and implement -Tman .Fd
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.23 2012/07/09 22:36:04 schwarze Exp $
d3 2
a4 2
SUBDIR += Ad An Ap Aq Ar At Bd Bk Bl Brq Bx Cd Cm
SUBDIR += D1 Dl Dq Dv Eo Er Ev Fd Fl Fo Ic In Lb Lk Li
@


1.23
log
@implement -Tman .Eo and .Ec
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.22 2012/07/09 17:52:09 schwarze Exp $
d3 3
a5 2
SUBDIR += Ad An Ap Aq Ar At Bd Bk Bl Brq Bx Cd Cm D1 Dl Dq Dv Eo Er Ev Fl Fo
SUBDIR += Ic In Lb Lk Li Ms Mt Nd Nm No Ns Oo Op Ox Pa Pf Pp Qq Rs
@


1.22
log
@fix -Tman font handling for:
.Ad .Ar .Cd .Cm .Dv .Em .Er .Ev .Fa .Fl .Fn .Fo .Ft
.Ic .In .Lk .Li .Ms .Mt .Nm .Pa .Sx .Sy .Tn .Va .Vt
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.21 2012/07/08 22:48:38 schwarze Exp $
d3 1
a3 1
SUBDIR += Ad An Ap Aq Ar At Bd Bk Bl Brq Bx Cd Cm D1 Dl Dq Dv Er Ev Fl Fo
@


1.21
log
@fix .Lk for -Tascii and implement it for -Tman
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.20 2012/07/08 18:38:07 schwarze Exp $
d4 1
a4 1
SUBDIR += Ic In Lb Lk Li Ms Mt Nd Nm No Ns Oo Op Ox Pf Pp Qq Rs
a5 3

# disabled, mandoc must be fixed:
# Pa
@


1.20
log
@fix vertical spacing for -Tman SYNOPSIS .Fn .Fo .Ft .In .Nm .Va .Vt
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.19 2012/07/08 16:50:36 schwarze Exp $
d4 1
a4 1
SUBDIR += Ic In Lb Li Ms Mt Nd Nm No Ns Oo Op Ox Pf Pp Qq Rs
@


1.19
log
@implement -Tman .An
also reset -[no]split mode at .Sh AUTHORS in -Tascii
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.18 2012/07/07 14:10:55 schwarze Exp $
d5 1
a5 1
SUBDIR += Sm Sq St Sx Sy Tn Ux Vt Xr blank
@


1.18
log
@after several improvements to -Tman went in,
enable lots of related regression tests
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.17 2011/12/04 03:12:35 schwarze Exp $
d3 1
a3 1
SUBDIR += Ad Ap Aq Ar At Bd Bk Bl Brq Bx Cd Cm D1 Dl Dq Dv Er Ev Fl Fo
@


1.17
log
@link new tests to the build: Ap Aq Brq Dq Dv Ev Qq Sq Ux
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.16 2011/11/17 16:28:45 schwarze Exp $
d3 3
a5 3
SUBDIR+= Ad Ap Aq Ar At Bd Bk Bl Brq Bx Cd Dq Dv Er Ev Fl Fo Ic In
SUBDIR+= Lb Li Ms Mt Nd Nm No Ns Op Ox Pf Pp Qq Rs Sm Sq St Sx Sy Tn Ux Vt Xr
SUBDIR+= blank
@


1.16
log
@Complete overhaul of the mandoc(1) test suite.
* Test the recently introduced -Tman output mode, too.
* Specify date and OS arguments in all tests.
* Remove the kludge of sed(1)ing away the page footer lines.
* New make(1) variables SKIP_TMAN, SKIP_GROFF.
* Drop obsolete, clumsy make(1) variable GROFF_TARGETS.
* Delete obsolete mdoc/Bl/E*.sh error reporting tests.
* Silence char/N/basic.
* New targets:
- ascii, ascii-clean - to run -Tascii tests only
- tman, tman-clean - to run the new -Tman tests only
- obj-clean - maintainer only, needed before groff-clean and groff
- groff-clean - maintainer only, affects checked-in files
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.15 2011/07/24 20:26:52 schwarze Exp $
d3 2
a4 2
SUBDIR+= Ad Ar At Bd Bk Bl Bx Cd Er Fl Fo Ic In
SUBDIR+= Lb Li Ms Mt Nd Nm No Ns Op Ox Pf Pp Rs Sm St Sx Sy Tn Vt Xr
@


1.15
log
@Theo reported that make cleandir deleted too much, triggering this cleanup:

Since quite some time, the groff output files are checked into CVS.
* thus, no longer provide a "groff-clean" target to delete them
* from official targets, no longer call the "groff" target generating them
* do not reimplement "clean" and "cleandir", simply use the official targets
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.14 2011/02/06 22:56:45 schwarze Exp $
d10 1
a10 1
groff: _SUBDIRUSE
@


1.14
log
@Do not break the line between the arguments of .Bsx .Dx .Fx .Nx .Ox .Ux.
Original patch from kristaps@@, but i fixed a regression regarding .Bk.
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.13 2011/02/06 00:18:58 schwarze Exp $
d10 1
a10 1
groff groff-clean: _SUBDIRUSE
@


1.13
log
@more tests found in my other tree
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.12 2011/02/05 18:19:11 schwarze Exp $
d4 1
a4 1
SUBDIR+= Lb Li Ms Mt Nd Nm No Ns Op Pf Pp Rs Sm St Sx Sy Tn Vt Xr
@


1.12
log
@some more tests found in my tree
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.11 2011/01/30 18:28:02 schwarze Exp $
d4 1
a4 1
SUBDIR+= Lb Li Ms Mt Nd Nm Op Rs Sm St Sx Sy Tn Vt Xr
@


1.11
log
@Make .Bx accept not more than two arguments.
Convert the first character of the second argument to uppercase.
Append the second argument with a hyphen.
Improves chpass(1), column(1), fstat(1), ...
from kristaps@@
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.10 2010/12/19 12:10:33 schwarze Exp $
d3 2
a4 1
SUBDIR+= Ar At Bd Bk Bl Bx Fl Fo In Lb Li Mt Nm Op Rs Sm Xr
@


1.10
log
@Handle .Bk the same way as groff 1.20.1:
.Bk without arguments defaults to -words.
.Bk with invalid arguments (including -lines) has no effect.
ok kristaps@@
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.9 2010/12/04 14:49:40 schwarze Exp $
d3 1
a3 1
SUBDIR+= Ar At Bd Bk Bl Fl Fo In Lb Li Mt Nm Op Rs Sm Xr
@


1.9
log
@add a few simple tests found in my tree
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.8 2010/07/01 05:29:57 schwarze Exp $
d3 1
a3 1
SUBDIR+= Ar At Bd Bl Fl Fo In Lb Li Mt Nm Op Rs Sm Xr
@


1.8
log
@major update of the mandoc test suite:
* add various new and extend a few existing tests
* stop using Mdocdate to ease syncing with NetBSD
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.7 2010/04/12 23:02:03 schwarze Exp $
d3 1
a3 1
SUBDIR+= Ar Bd Bl Fl Fo In Li Op Rs Sm Xr
@


1.7
log
@check handling of blank lines in literal context;
thanks to jmc@@ for noticing that this can break;
related to term.c rev. 1.28
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.6 2010/04/08 00:29:28 schwarze Exp $
d3 5
a7 1
SUBDIR+= Bd Bl Fl In Li Pa Rs Sm Xr
@


1.6
log
@Check the behaviour of quoted and unquoted punctuation
after the mdoc(7) literal macro, .Li.
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.5 2010/02/17 22:35:17 schwarze Exp $
d3 1
a3 1
SUBDIR+= Bl Fl In Li Pa Rs Sm Xr
@


1.5
log
@regression test for .Xr argument handling;
related code fix coming tomorrow

kristaps@@ agrees this is the behaviour we want
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.4 2010/01/02 02:35:53 schwarze Exp $
d3 1
a3 1
SUBDIR+= Bl Fl In Pa Rs Sm Xr
@


1.4
log
@Check that end of .It does not restore .Sm state
to the value it had before entering .It;
fixed by kristaps@@ in release 1.9.15.
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.3 2009/12/25 02:00:46 schwarze Exp $
d3 1
a3 1
SUBDIR+= Bl Fl In Pa Rs Sm
@


1.3
log
@Regression test for .Pa below .Bl in the FILES section;
still broken in mandoc 1.9.14, fix being sent to kristaps@@.

Path names (.Pa) are usually underlined, except below .Bl -inset, -hang,
-ohang, -tag or -column in the FILES section (yuck).

Note that .Bl -bullet is subtly broken in an urelated way:
That will need fixing as well before this test can fully succeed.
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.2 2009/12/24 23:21:14 schwarze Exp $
d3 1
a3 1
SUBDIR+= Bl Fl In Pa Rs
@


1.2
log
@activate mdoc/Fl tests (duh.)
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.1 2009/10/28 03:20:42 schwarze Exp $
d3 1
a3 1
SUBDIR+= Bl Fl In Rs
@


1.1
log
@Add the first batch of mandoc(1) regression tests, testing for a few bugs
fixed in 1.9.9 and some older, rather subtle issues in list displays.

Directory layout and naming scheme was chosen such that later inclusion
of tests for -man and -Thtml will not force us to rename everything,
even though the layout might still seem a bit sparse right now.
More tests will slowly be added while investigating and fixing issues.
@
text
@d1 1
a1 1
# $OpenBSD$
d3 1
a3 1
SUBDIR+= Bl In Rs
@

