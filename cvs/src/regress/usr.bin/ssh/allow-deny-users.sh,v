head	1.3;
access;
symbols;
locks; strict;
comment	@# @;


1.3
date	2016.12.19.22.35.23;	author djm;	state Exp;
branches;
next	1.2;
commitid	qo6YwbsWcc4N5WEP;

1.2
date	2016.12.19.03.32.57;	author dtucker;	state Exp;
branches;
next	1.1;
commitid	XgJRicXsBfYBuuml;

1.1
date	2016.12.16.03.51.19;	author dtucker;	state Exp;
branches;
next	;
commitid	IZ4x7JZqiJJQw9fs;


desc
@@


1.3
log
@use standard /bin/sh equality test; from Mike Frysinger
@
text
@# Public Domain
# Zev Weiss, 2016

tid="AllowUsers/DenyUsers"

me="$LOGNAME"
if [ "x$me" = "x" ]; then
	me=`whoami`
fi
other="nobody"

test_auth()
{
	deny="$1"
	allow="$2"
	should_succeed="$3"
	failmsg="$4"

	start_sshd -oDenyUsers="$deny" -oAllowUsers="$allow"

	${SSH} -F $OBJ/ssh_config "$me@@somehost" true
	status=$?

	if (test $status -eq 0 && ! $should_succeed) \
	    || (test $status -ne 0 && $should_succeed); then
		fail "$failmsg"
	fi

	stop_sshd
}

#         DenyUsers     AllowUsers    should_succeed  failure_message
test_auth ""            ""            true            "user in neither DenyUsers nor AllowUsers denied"
test_auth "$other $me"  ""            false           "user in DenyUsers allowed"
test_auth "$me $other"  ""            false           "user in DenyUsers allowed"
test_auth ""            "$other"      false           "user not in AllowUsers allowed"
test_auth ""            "$other $me"  true            "user in AllowUsers denied"
test_auth ""            "$me $other"  true            "user in AllowUsers denied"
test_auth "$me $other"  "$me $other"  false           "user in both DenyUsers and AllowUsers allowed"
test_auth "$other $me"  "$other $me"  false           "user in both DenyUsers and AllowUsers allowed"
@


1.2
log
@Use LOGNAME to get current user and fall back to whoami if not set.
Mainly to benefit -portable since some platforms don't have whoami.
@
text
@d7 1
a7 1
if [ "x$me" == "x" ]; then
@


1.1
log
@Add regression test for AllowUsers and DenyUsers.  Patch from Zev Weiss
<zev at bewilderbeest.net>
@
text
@d6 4
a9 1
me=`whoami`
@

