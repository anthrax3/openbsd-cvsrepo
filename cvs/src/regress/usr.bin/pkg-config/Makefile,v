head	1.53;
access;
symbols
	OPENBSD_6_0:1.53.0.4
	OPENBSD_6_0_BASE:1.53
	OPENBSD_5_9:1.53.0.2
	OPENBSD_5_9_BASE:1.53
	OPENBSD_5_8:1.49.0.6
	OPENBSD_5_8_BASE:1.49
	OPENBSD_5_7:1.49.0.4
	OPENBSD_5_7_BASE:1.49
	OPENBSD_5_6:1.46.0.4
	OPENBSD_5_6_BASE:1.46
	OPENBSD_5_5:1.39.0.6
	OPENBSD_5_5_BASE:1.39
	OPENBSD_5_4:1.39.0.2
	OPENBSD_5_4_BASE:1.39
	OPENBSD_5_3:1.36.0.2
	OPENBSD_5_3_BASE:1.36
	OPENBSD_5_2:1.32.0.2
	OPENBSD_5_2_BASE:1.32
	OPENBSD_5_1_BASE:1.27
	OPENBSD_5_1:1.27.0.2
	OPENBSD_5_0:1.22.0.2
	OPENBSD_5_0_BASE:1.22;
locks; strict;
comment	@# @;


1.53
date	2015.10.26.18.09.32;	author jasper;	state Exp;
branches;
next	1.52;
commitid	ZMIjSSJcPFfqV3hw;

1.52
date	2015.10.11.11.47.21;	author jasper;	state Exp;
branches;
next	1.51;
commitid	hr2Wi0nfzc4gdclj;

1.51
date	2015.10.10.12.20.10;	author jasper;	state Exp;
branches;
next	1.50;
commitid	eyDqZdoIYdzUClJ8;

1.50
date	2015.08.14.06.38.16;	author jasper;	state Exp;
branches;
next	1.49;
commitid	MhzbjujQtkUvAQjc;

1.49
date	2014.11.02.10.34.52;	author jca;	state Exp;
branches;
next	1.48;
commitid	kXikS7j4orRomQNW;

1.48
date	2014.11.02.01.09.54;	author jca;	state Exp;
branches;
next	1.47;
commitid	ONeJuEBaXMNnnfkJ;

1.47
date	2014.11.02.01.04.53;	author jca;	state Exp;
branches;
next	1.46;
commitid	3dfWK5Z2aB4KdjfP;

1.46
date	2014.07.09.22.50.12;	author jasper;	state Exp;
branches;
next	1.45;
commitid	BUcvykDSJ6RBpr14;

1.45
date	2014.04.14.13.20.46;	author jasper;	state Exp;
branches;
next	1.44;

1.44
date	2014.03.31.06.44.23;	author jasper;	state Exp;
branches;
next	1.43;

1.43
date	2014.03.29.11.37.05;	author jasper;	state Exp;
branches;
next	1.42;

1.42
date	2014.03.29.09.25.39;	author jasper;	state Exp;
branches;
next	1.41;

1.41
date	2014.03.29.09.20.30;	author jasper;	state Exp;
branches;
next	1.40;

1.40
date	2014.03.29.08.56.21;	author jasper;	state Exp;
branches;
next	1.39;

1.39
date	2013.06.02.16.12.27;	author jasper;	state Exp;
branches;
next	1.38;

1.38
date	2013.05.30.00.02.36;	author jasper;	state Exp;
branches;
next	1.37;

1.37
date	2013.03.27.09.46.55;	author jasper;	state Exp;
branches;
next	1.36;

1.36
date	2012.12.10.10.23.27;	author jasper;	state Exp;
branches;
next	1.35;

1.35
date	2012.10.09.09.56.58;	author jasper;	state Exp;
branches;
next	1.34;

1.34
date	2012.10.09.07.47.39;	author jasper;	state Exp;
branches;
next	1.33;

1.33
date	2012.10.09.07.01.05;	author jasper;	state Exp;
branches;
next	1.32;

1.32
date	2012.07.08.07.45.37;	author espie;	state Exp;
branches;
next	1.31;

1.31
date	2012.07.08.06.52.00;	author espie;	state Exp;
branches;
next	1.30;

1.30
date	2012.07.08.06.24.13;	author espie;	state Exp;
branches;
next	1.29;

1.29
date	2012.07.03.21.48.04;	author jasper;	state Exp;
branches;
next	1.28;

1.28
date	2012.07.03.21.28.26;	author matthieu;	state Exp;
branches;
next	1.27;

1.27
date	2011.11.17.11.38.13;	author jasper;	state Exp;
branches;
next	1.26;

1.26
date	2011.09.20.16.26.15;	author jasper;	state Exp;
branches;
next	1.25;

1.25
date	2011.09.20.14.08.17;	author jasper;	state Exp;
branches;
next	1.24;

1.24
date	2011.09.17.18.07.17;	author jasper;	state Exp;
branches;
next	1.23;

1.23
date	2011.09.17.17.46.03;	author jasper;	state Exp;
branches;
next	1.22;

1.22
date	2011.07.27.12.30.58;	author jasper;	state Exp;
branches;
next	1.21;

1.21
date	2011.06.20.14.31.46;	author jasper;	state Exp;
branches;
next	1.20;

1.20
date	2011.06.16.09.16.18;	author jasper;	state Exp;
branches;
next	1.19;

1.19
date	2011.06.16.08.34.59;	author jasper;	state Exp;
branches;
next	1.18;

1.18
date	2011.06.15.11.54.32;	author jasper;	state Exp;
branches;
next	1.17;

1.17
date	2011.06.15.10.48.39;	author jasper;	state Exp;
branches;
next	1.16;

1.16
date	2011.06.13.09.07.28;	author jasper;	state Exp;
branches;
next	1.15;

1.15
date	2011.06.12.18.16.39;	author jasper;	state Exp;
branches;
next	1.14;

1.14
date	2011.06.11.12.04.44;	author jasper;	state Exp;
branches;
next	1.13;

1.13
date	2011.06.11.11.53.57;	author jasper;	state Exp;
branches;
next	1.12;

1.12
date	2011.06.07.13.05.37;	author jasper;	state Exp;
branches;
next	1.11;

1.11
date	2011.06.07.12.18.22;	author jasper;	state Exp;
branches;
next	1.10;

1.10
date	2011.06.07.06.42.47;	author jasper;	state Exp;
branches;
next	1.9;

1.9
date	2011.06.06.21.21.42;	author jasper;	state Exp;
branches;
next	1.8;

1.8
date	2011.06.06.20.49.26;	author jasper;	state Exp;
branches;
next	1.7;

1.7
date	2011.06.06.18.59.44;	author jasper;	state Exp;
branches;
next	1.6;

1.6
date	2011.06.06.17.58.07;	author jasper;	state Exp;
branches;
next	1.5;

1.5
date	2011.06.06.17.49.23;	author jasper;	state Exp;
branches;
next	1.4;

1.4
date	2011.06.06.17.45.53;	author jasper;	state Exp;
branches;
next	1.3;

1.3
date	2011.06.06.17.35.33;	author jasper;	state Exp;
branches;
next	1.2;

1.2
date	2011.06.06.14.31.15;	author jasper;	state Exp;
branches;
next	1.1;

1.1
date	2011.06.06.13.58.03;	author jasper;	state Exp;
branches;
next	;


desc
@@


1.53
log
@add tests for whitespace surrounding properties
@
text
@#	$OpenBSD: Makefile,v 1.52 2015/10/11 11:47:21 jasper Exp $

REGRESS_TARGETS=cmp-vers1-1 \
		cmp-vers1-2 \
		cmp-vers1-3 \
		cmp-vers2-1 \
		cmp-vers2-2 \
		cmp-vers2-3 \
		cmp-vers2-4 \
		cmp-vers2-5 \
		cmp-vers2-6 \
		cmp-vers2-7 \
		cmp-vers2-8 \
		cmp-vers2-9 \
		cmp-vers2-10 \
		cmp-vers2-11 \
		cmp-vers2-12 \
		cmp-vers3 \
		cmp-vers4-1 \
		cmp-vers4-2 \
		cmp-vers4-3 \
		cmp-vers4-4 \
		cmp-vers4-5 \
		cmp-vers4-6 \
		cmp-vers4-7 \
		cmp-vers4-8 \
		cmp-vers4-9 \
		cmp-vers5-1 \
		cmp-vers5-2 \
		cmp-vers5-3 \
		cmp-vers5-4 \
		cmp-vers5-5 \
		cmp-vers5-6 \
		cmp-vers5-7 \
		cmp-vers6-1 \
		cmp-vers6-2 \
		cmp-vers7-1 \
		cmp-vers7-2 \
		cmp-vers7-3 \
		cmp-vers7-4 \
		cmp-vers8-1 \
		corrupt1 \
		corrupt2 \
		corrupt3 \
		print-provides \
		print-req \
		print-req-priv \
		logfile \
		sysroot-cflags \
		sysroot-libs \
		static-cflags1 \
		static-cflags2 \
		static-libs1 \
		static-libs2 \
		static-libs3 \
		static-libs4 \
		static-order \
		missing-req-1 \
		missing-req-2 \
		missing-req-3 \
		missing-req-4 \
		whitespace-cflags \
		whitespace-libs \
		whitespace-linebreak \
		whitespace-name \
		whitespace-property-1 \
		whitespace-property-2 \
		quoting \
		broken-require-1 \
		broken-require-2 \
		min-version-1 \
		min-version-2 \
		exact-version-1 \
		exact-version-2 \
		max-version-1 \
		max-version-2 \
		find-config-1 \
		find-config-2 \
		find-config-3 \
		find-config-4 \
		find-config-5 \
		variable-get-1 \
		variable-set \
		variables-1 \
		variables-2 \
		variables-3 \
		variables-4 \
		variables-5

PKG_CONFIG?=	pkg-config
PCONFIG =	PKG_CONFIG_PATH=${.CURDIR}/pcdir/ ${PKG_CONFIG}
VPCONFIG =	${PCONFIG} --errors-to-stdout --print-errors > ${GOT}
WANT=		${.OBJDIR}/$@@.want
GOT=		${.OBJDIR}/$@@.got

# Tests for corrupt pkg-config files.
corrupt1:
	# Test for missing variables/fields
	@@echo "Package '$@@' has no Version: field" > ${WANT}
	@@if ${VPCONFIG} --exists $@@; then false; fi
	@@diff -u ${WANT} ${GOT}

corrupt2:
	# Test for missing variables/fields
	@@echo "Package '$@@' has no Name: field" > ${WANT}
	@@if ${VPCONFIG} --exists $@@; then false; fi
	@@diff -u ${WANT} ${GOT}

corrupt3:
	# Test for empty file
	@@echo "Package file '${.CURDIR}/pcdir//$@@.pc' appears to be empty" > ${WANT}
	@@echo "Package '$@@' has no Name: field" >> ${WANT}
	@@if ${VPCONFIG} --libs $@@; then false; fi
	@@diff -u ${WANT} ${GOT}

# Tests for various printing features
print-provides:
	# Test --print-provides
	@@echo "print-provides = 0.0.0" > ${WANT}
	@@${PCONFIG} --print-provides $@@ > ${GOT}
	@@diff -u ${WANT} ${GOT}

print-req:
	# Test --print-requires
	@@echo "print-req2>=0.0.1" > ${WANT}
	@@${PCONFIG} --print-requires $@@ > ${GOT}
	@@diff -u ${WANT} ${GOT}

print-req-priv:
	# Test --print-requires-private
	@@echo "print-req-priv2>=0.0.0" > ${WANT}
	@@${PCONFIG} --print-requires-private $@@ > ${GOT}
	@@diff -u ${WANT} ${GOT}

# Tests for version comparison
cmp-vers1-1:
	# Test regular versions (a <= b)
	@@if ${PCONFIG} --exists "vers1 <= 0.0.2"; then false; fi

cmp-vers1-2:
	# Test regular versions (a <= b)
	@@${PCONFIG} --exists "vers1 <= 0.1.0"

cmp-vers1-3:
	# Test regular versions (a < b)
	@@${PCONFIG} --exists "vers1 < 0.2"

cmp-vers2-1:
	# Test regular versions (a >= b)
	@@${PCONFIG} --exists "vers2 >= 0.0.1"

cmp-vers2-2:
	# Test regular versions (a >= b)
	@@${PCONFIG} --exists "vers2 >= 0.0.0"

cmp-vers2-3:
	# Test regular versions (a >= b)
	@@${PCONFIG} --exists "vers2 >= 0.1.0"

cmp-vers2-4:
	# Test regular versions (a >= b)
	@@if ${PCONFIG} --exists "vers2 > 0.2.0.0"; then false; fi

cmp-vers2-5:
	# Test regular versions (a != b)
	@@${PCONFIG} --exists "vers2 != 0.1.0"

cmp-vers2-6:
	# Test regular versions (a != b)
	@@if ${PCONFIG} --exists "vers2 != 0.2.0"; then false; fi

cmp-vers2-7:
	# Test regular versions (a >= b a != c)
	@@${PCONFIG} --exists "vers2 >= 0.1.0 vers2 != 0.3.0"

cmp-vers2-8:
	# Test regular versions (a >= b a != c)
	@@${PCONFIG} --exists "vers2 >= 0.2.0 vers2 != 0.3.0"

cmp-vers2-9:
	# Test regular versions (a >= b a != c)
	@@if ${PCONFIG} --exists "vers2 >= 0.1.0 vers2 != 0.2.0"; then false; fi

cmp-vers2-10:
	# Test regular versions (a >= b a < c)
	@@if ${PCONFIG} --exists "vers2 >= 0.2.0 vers2 < 0.1.0"; then false; fi

cmp-vers2-11:
	# Test regular versions (a >= b a < c)
	@@if ${PCONFIG} --exists "vers2 >= 0.2.0 vers2 < 0.2.0"; then false; fi

cmp-vers2-12:
	# Test regular versions (a >= b a < c)
	@@${PCONFIG} --exists "vers2 >= 0.2.0 vers2 < 0.3.0"

cmp-vers3:
	# Test regular versions (a = b)
	@@${PCONFIG} --exists "vers2 = 0.2.0"

cmp-vers4-1:
	# Test suffixed versions (alpha >)
	@@touch ${WANT}
	@@${VPCONFIG} "alpha > 0.1.0"
	@@diff -u ${WANT} ${GOT}

cmp-vers4-2:
	# Test suffixed versions (alpha >)
	@@touch ${WANT}
	@@${VPCONFIG} "alpha > 0.1.0alpha1"
	@@diff -u ${WANT} ${GOT}

cmp-vers4-3:
	# Test suffixed versions (alpha >=)
	@@touch ${WANT}
	@@${VPCONFIG}  "alpha >= 0.1.0"
	@@diff -u ${WANT} ${GOT}

cmp-vers4-4:
	# Test suffixed versions (alpha >=)
	@@touch ${WANT}
	@@${VPCONFIG}  "alpha >= 0.1.0alpha2"
	@@diff -u ${WANT} ${GOT}

cmp-vers4-5:
	# Test suffixed versions (alpha <)
	@@touch ${WANT}
	@@${VPCONFIG} "alpha < 0.1.1"
	@@diff -u ${WANT} ${GOT}

cmp-vers4-6:
	# Test suffixed versions (alpha <)
	@@touch ${WANT}
	@@${VPCONFIG} "alpha < 0.1.0alpha3"
	@@diff -u ${WANT} ${GOT}

cmp-vers4-7:
	# Test suffixed versions (alpha <=)
	@@touch ${WANT}
	@@${VPCONFIG}  "alpha < 0.1.1"
	@@diff -u ${WANT} ${GOT}

cmp-vers4-8:
	# Test suffixed versions (alpha <=)
	@@touch ${WANT}
	@@${VPCONFIG} "alpha <= 0.1.0alpha2"
	@@diff -u ${WANT} ${GOT}

cmp-vers4-9:
	# Test suffixed versions (alpha =)
	@@touch ${WANT}
	@@${VPCONFIG} "alpha = 0.1.0alpha2"
	@@diff -u ${WANT} ${GOT}

cmp-vers5-1:
	# Test suffixed versions (beta > alpha)
	@@touch ${WANT}
	@@${VPCONFIG} "beta > 0.1.0alpha1"
	@@diff -u ${WANT} ${GOT}

cmp-vers5-2:
	# Test suffixed versions (beta >= alpha)
	@@touch ${WANT}
	@@${VPCONFIG} "beta >= 0.1.0beta1"
	@@diff -u ${WANT} ${GOT}

cmp-vers5-3:
	# Test suffixed versions (alpha < rc)
	@@touch ${WANT}
	@@${VPCONFIG}  "alpha < 0.1.0rc2"
	@@diff -u ${WANT} ${GOT}

cmp-vers5-4:
	# Test suffixed versions (beta < rc)
	@@touch ${WANT}
	@@${VPCONFIG} "beta < 0.1.0rc2"
	@@diff -u ${WANT} ${GOT}

cmp-vers5-5:
	# Test suffixed versions (alpha < beta)
	@@touch ${WANT}
	@@${VPCONFIG}  "alpha < 0.1.0beta2"
	@@diff -u ${WANT} ${GOT}

cmp-vers5-6:
	# Test suffixed versions (rc > alpha)
	@@touch ${WANT}
	@@${VPCONFIG} "rc > 0.1.0alpha2"
	@@diff -u ${WANT} ${GOT}

cmp-vers5-7:
	# Test suffixed versions (rc > beta)
	@@touch ${WANT}
	@@${VPCONFIG} "rc > 0.1.0beta2"
	@@diff -u ${WANT} ${GOT}

# These tests also fail with fd.o pkg-config, so keep them for later
# to decide how our pkg-config should behave.
cmp-vers5-8:
	# Test suffixed versions (' ' > alpha)
	@@touch ${WANT}
	@@${VPCONFIG} "vers1 > 0.1.0alpha2"
	@@diff -u ${WANT} ${GOT}

cmp-vers5-9:
	# Test suffixed versions (' ' > beta)
	@@touch ${WANT}
	@@${VPCONFIG} "beta <= 0.1.0beta2"
	@@diff -u ${WANT} ${GOT}

cmp-vers5-10:
	# Test suffixed versions (' ' > rc)
	@@touch ${WANT}
	@@${VPCONFIG} "beta <= 0.1.0rc2"
	@@diff -u ${WANT} ${GOT}

cmp-vers6-1:
	# Test suffixed versions in Requires
	@@echo " -lalpha2" > ${WANT}
	@@${VPCONFIG} --libs requires-test2
	@@diff -u ${WANT} ${GOT}

cmp-vers6-2:
	# Test suffixed versions in Requires.private
	@@echo "Requested 'alpha >= 0.1.0alpha3' but version of alpha suffix test is 0.1.0alpha2" > ${WANT}
	@@if ${VPCONFIG} --libs --static requires-test2; then false; fi
	@@diff -u ${WANT} ${GOT}

cmp-vers7-1:
	# Test suffixed version (vers3 > 1.0.1g)
	@@touch ${WANT}
	@@${VPCONFIG} "vers3 > 1.0.1g"
	@@diff -u ${WANT} ${GOT}

cmp-vers7-2:
	# Test suffixed version (vers3 < 1.0.1i)
	@@touch ${WANT}
	@@${VPCONFIG} "vers3 < 1.0.1i"
	@@diff -u ${WANT} ${GOT}

cmp-vers7-3:
	# Test suffixed version (vers3 < 1.0.1i)
	@@touch ${WANT}
	@@${VPCONFIG} "vers3 < 1.0.1i"
	@@diff -u ${WANT} ${GOT}

cmp-vers7-4:
	# Test suffixed version (vers3 > 1.0.1)
	@@touch ${WANT}
	@@${VPCONFIG} "vers3 > 1.0.1"
	@@diff -u ${WANT} ${GOT}

cmp-vers8-1:
	# Test Version: x.y.z-stable w/compare()
	@@touch ${WANT}
	@@${VPCONFIG} --atleast-version=2.0.1 vers4
	@@diff -u ${WANT} ${GOT}

# Tests for various environment variables
builddir:
	# Test PKG_CONFIG_TOP_BUILD_DIR

logfile:
	# Test PKG_CONFIG_LOG
	@@echo "[/usr/bin/pkg-config] [--exists] [sysroot >= 0.0.0]" > ${WANT}
	@@rm -f ${GOT}
	@@PKG_CONFIG_LOG=${GOT} ${PCONFIG} --exists "sysroot >= 0.0.0"
	@@diff -u ${WANT} ${GOT}

sysroot-cflags:
	# Test PKG_CONFIG_SYSROOT_DIR (cflags)
	@@echo "-I/altroot/tmp/include -I/altroot/tmp/include/foo" > ${WANT}
	@@PKG_CONFIG_SYSROOT_DIR=/altroot ${PCONFIG} --cflags sysroot > ${GOT}
	@@diff -u ${WANT} ${GOT}

sysroot-libs:
	# Test PKG_CONFIG_SYSROOT_DIR (libs)
	@@echo "-L/altroot/tmp/lib -L/altroot/tmp/lib/foo -lc" > ${WANT}
	@@PKG_CONFIG_SYSROOT_DIR=/altroot ${PCONFIG} --libs sysroot > ${GOT}
	@@diff -u ${WANT} ${GOT}

# Tests for static linking
static-cflags1:
	# Test grabbing Cflags (without Requires.private)
	@@echo "-I/usr/local/include/foo" > ${WANT}
	@@${VPCONFIG} --cflags --static static
	@@diff -u ${WANT} ${GOT}

static-cflags2:
	# Test grabbing Cflags (with Requires.private)
	@@echo "-I/usr/local/include/foo -I/usr/local/include" > ${WANT}
	@@${VPCONFIG} --cflags --static static2
	@@diff -u ${WANT} ${GOT}

static-libs1:
	# Test grabbing Libs.private from this package
	@@echo "-L/usr/local/lib -lc -lm -ll" > ${WANT}
	@@${VPCONFIG} --libs --static static
	@@diff -u ${WANT} ${GOT}

static-libs2:
	# Test grabbing Libs.private from Requires in order
	@@echo "-L/usr/local/lib -lc -lm -ll -lutil -lz" > ${WANT}
	@@${VPCONFIG} --libs --static static2
	@@diff -u ${WANT} ${GOT}

static-libs3:
	# Test grabbing Libs.private from Requires.private in order
	@@echo "-L/tmp/lib -L/tmp/lib/foo -L/usr/local/lib -lbaz\ quux -lc -lm -ll -lutil -lz" > ${WANT}
	@@${VPCONFIG} --libs --static static3
	@@diff -u ${WANT} ${GOT}

static-libs4:
	# Test Requires.private
	@@echo "-L/public-dep/lib -L/private-dep/lib -L/requires-test/lib -lpublic-dep -lprivate-dep -lrequires-test" > ${WANT}
	@@${VPCONFIG} --libs --static requires-test
	@@diff -u ${WANT} ${GOT}

static-order:
	# Test Requires.private order
	@@echo "-L/usr/X11R6/lib -lstatic-order1 -lstatic-order2 -lstatic-order3" > ${WANT}
	@@${VPCONFIG} --static --libs static-order1
	@@diff -u ${WANT} ${GOT}

# This fails as we read and check Requires as well as Requires.private where
# only Requires needs to be checked here as we ask for Libs and not Cflags.
missing-req-1:
	# Test for missing packages in Requires (libs)
	@@echo "Package nonexisting was not found in the pkg-config search path" > ${WANT}
	@@if ${VPCONFIG} --libs missing-req ; then false; fi
	@@diff -u ${WANT} ${GOT}

missing-req-2:
	# Test for missing packages in Requires (cflags)
	@@echo "Package nonexisting was not found in the pkg-config search path" > ${WANT}
	@@if ${VPCONFIG} --cflags missing-req; then false; fi
	@@diff -u ${WANT} ${GOT}

missing-req-3:
	# Test for missing packages in Requires (version)
	@@echo "0.0.0" > ${WANT}
	@@${VPCONFIG} --modversion missing-req
	@@diff -u ${WANT} ${GOT}

missing-req-4:
	# Test for missing Requires.private with --exists
	@@echo "Package nonexisting was not found in the pkg-config search path" > ${WANT}
	@@if ${VPCONFIG} --exists missing-req2 ; then false; fi
	@@diff -u ${WANT} ${GOT}

whitespace-cflags:
	# Test whitespace on various positions in Cflags
	@@echo "-I/tmp/include -I/tmp/include/include\ dir" > ${WANT}
	@@${VPCONFIG} --cflags whitespace
	@@diff -u ${WANT} ${GOT}

whitespace-libs:
	# Test whitespace on various positions in Libs
	@@echo "-L/tmp/lib -L/tmp/lib/foo -lbaz\ quux" > ${WANT}
	@@${VPCONFIG} --libs whitespace
	@@diff -u ${WANT} ${GOT}

whitespace-linebreak:
	# Test linebreak in Description field
	@@echo " -lc" > ${WANT}
	@@${VPCONFIG} --libs linebreak
	@@diff -u ${WANT} ${GOT}

whitespace-name:
	# Test whitespace in Name
	@@echo "Requested 'whitespace > 0.2.0' but version of Whitespace test is 0.0.0" > ${WANT}
	@@if ${VPCONFIG} "whitespace > 0.2.0"; then false; fi
	@@diff -u ${WANT} ${GOT}

whitespace-property-1:
	# Test lack of whitespace after property name
	@@echo "-I/usr/local/include" > ${WANT}
	@@${VPCONFIG} --cflags whitespace-prop-1
	@@diff -u ${WANT} ${GOT}

whitespace-property-2:
	# Test whitespace after property name
	@@echo "0.0.0" > ${WANT}
	@@${VPCONFIG} --modversion whitespace-prop-3
	@@diff -u ${WANT} ${GOT}

quoting:
	# Test for stripping out quotes from variables
	@@echo "-I/usr/X11R6/include/freetype2" > ${WANT}
	@@${VPCONFIG} --cflags quotes
	@@diff -u ${WANT} ${GOT}

broken-require-1:
	# Test expanded variables with special parsing requirements
	@@${PCONFIG} requires-test3

broken-require-2:
	# Test expanded variables with special parsing requirements
	@@${PCONFIG} requires-test4

min-version-1:
	# Test --atleast-version (matches)
	@@${PCONFIG} --atleast-version=0.0.9 vers1

min-version-2:
	# Test --atleast-version (doesn't match)
	@@if ${PCONFIG} --atleast-version=0.1.1 vers1 ; then false; fi

exact-version-1:
	# Test --exact-version (matches)
	@@${PCONFIG} --exact-version=0.1.0 vers1

exact-version-2:
	# Test --exact-version (doesn't match)
	@@if ${PCONFIG} --exact-version=0.1.1 vers1 ; then false; fi

max-version-1:
	# Test --max-version (matches)
	@@${PCONFIG} --max-version=0.1.0 vers1

max-version-2:
	# Test --max-version (doesn't match)
	@@if ${PCONFIG} --max-version=0.0.9 vers1 ; then false; fi

find-config-1:
	# Test a regular module name being resolved
	@@echo "1.0.0" > ${WANT}
	@@${VPCONFIG} --modversion public-dep
	@@diff -u ${WANT} ${GOT}

# Need to use ${PKG_CONFIG} instead of ${VPCONFIG} as the latter sets PKG_CONFIG_PATH,
# which is exactly what we don't want for this test.
find-config-2:
	# Test a full path to a .pc file
	@@echo "1.0.0" > ${WANT}
	@@${PKG_CONFIG} --errors-to-stdout --print-errors --modversion \
		${.CURDIR}/pcdir/public-dep.pc > ${GOT}
	@@diff -u ${WANT} ${GOT}

find-config-3:
	# Simple existential test
	@@${VPCONFIG} --exists vers1

find-config-4:
	# Multiple existential tests combined (with comma)
	@@${VPCONFIG} --exists vers1,vers2

find-config-5:
	# Multiple existential tests combined (with space)
	@@${VPCONFIG} --exists vers1 vers2

variable-get-1:
	# Test --variable
	@@echo "/tmp" > ${WANT}
	@@${VPCONFIG} --variable prefix sysroot
	@@diff -u ${WANT} ${GOT}

variable-set:
	# Test --define-variable
	@@echo "-I/usr/local2/include -I/usr/local2/include/foo" > ${WANT}
	@@${VPCONFIG} --define-variable=prefix=/usr/local2 \
		--cflags sysroot
	@@diff -u ${WANT} ${GOT}

variables-1:
	# Test --variable without any options
	@@echo "/usr/local/lib/pkgconfig-plugins.0" > ${WANT}
	@@${VPCONFIG} --variable=plugindir variables
	@@diff -u ${WANT} ${GOT}

variables-2:
	# Test --variable + --define-variable
	@@echo "/chroot/lib/pkgconfig-plugins.0" > ${WANT}
	@@${VPCONFIG} --define-variable=libdir='/chroot/lib' --variable=plugindir variables
	@@diff -u ${WANT} ${GOT}

variables-3:
	# Test --variable + --define-variable
	@@echo '$${foodir}/pkgconfig-plugins.0' > ${WANT}
	@@${VPCONFIG} --define-variable=libdir='$${foodir}' --variable=plugindir variables
	@@diff -u ${WANT} ${GOT}

variables-4:
	# Test --variable + --define-variable
	@@echo '$${libdir}/pkgconfig-plugins.0' > ${WANT}
	@@${VPCONFIG} --define-variable=libdir='$${libdir}' --variable=plugindir variables
	@@diff -u ${WANT} ${GOT}

variables-5:
	# Test --variable
	@@echo ' -lfoo-1' > ${WANT}
	@@${VPCONFIG} --libs variables
	@@diff -u ${WANT} ${GOT}

clean:
	rm -f *.want *.got

.PHONY: ${REGRESS_TARGETS}

.include <bsd.regress.mk>
@


1.52
log
@add variation on existing --exists tests; separated by spaces
@
text
@d1 1
a1 1
#	$OpenBSD: Makefile,v 1.51 2015/10/10 12:20:10 jasper Exp $
d66 2
d472 12
@


1.51
log
@add (currently failing) test for --exists foo,bar.

spotted by aja@@
@
text
@d1 1
a1 1
#	$OpenBSD: Makefile,v 1.50 2015/08/14 06:38:16 jasper Exp $
d79 1
d527 1
a527 1
	${VPCONFIG} --exists vers1
d530 6
a535 2
	# Multiple existential tests combined
	${VPCONFIG} --exists vers1,vers2
@


1.50
log
@add (currently failing) test for version comparison against "22-stable"

from attila@@stalphonsos.com
@
text
@d1 1
a1 1
#	$OpenBSD: Makefile,v 1.49 2014/11/02 10:34:52 jca Exp $
d77 2
d523 8
@


1.49
log
@Tests for constructs such as 'foo >= a.version foo != another.version'.
@
text
@d1 1
a1 1
#	$OpenBSD: Makefile,v 1.48 2014/11/02 01:09:54 jca Exp $
d41 1
d345 6
@


1.48
log
@Consistency.
@
text
@d1 1
a1 1
#	$OpenBSD: Makefile,v 1.47 2014/11/02 01:04:53 jca Exp $
d12 6
d165 24
@


1.47
log
@Tests for pkg-config 'foo != some.version'
@
text
@d1 1
a1 1
#	$OpenBSD: Makefile,v 1.46 2014/07/09 22:50:12 jasper Exp $
d158 1
a158 1
	@@! ${PCONFIG} --exists "vers2 != 0.2.0"
@


1.46
log
@add some (currently failing) tests for openssl-like version number (1.0.1g) comparisons
@
text
@d1 1
a1 1
#	$OpenBSD: Makefile,v 1.45 2014/04/14 13:20:46 jasper Exp $
d10 2
d151 8
@


1.45
log
@fix test regarding false positives
@
text
@d1 1
a1 1
#	$OpenBSD: Makefile,v 1.45 2014/04/14 13:18:38 jasper Exp $
d29 4
a207 1

d280 24
@


1.44
log
@add test where Libs contains a variable reference
@
text
@d1 1
a1 1
#	$OpenBSD: Makefile,v 1.43 2014/03/29 11:37:05 jasper Exp $
d487 1
a487 1
	@@echo ' -lfoo-0' > ${WANT}
@


1.43
log
@don't spam the console
@
text
@d1 1
a1 1
#	$OpenBSD: Makefile,v 1.42 2014/03/29 09:25:39 jasper Exp $
d69 2
a70 1
		variables-4
d483 6
@


1.42
log
@tweak the non-hanging but failing earlier test.
@
text
@d1 1
a1 1
#	$OpenBSD: Makefile,v 1.41 2014/03/29 09:20:30 jasper Exp $
d475 1
a475 1
	${VPCONFIG} --define-variable=libdir='$${foodir}' --variable=plugindir variables
@


1.41
log
@add currently failing (rather, hanging) test taken from empathy's
configure script.
@
text
@d1 1
a1 1
#	$OpenBSD: Makefile,v 1.40 2014/03/29 08:56:21 jasper Exp $
d474 2
a475 2
	@@echo '${foodir}/pkgconfig-plugins.0' > ${WANT}
	@@${VPCONFIG} --define-variable=libdir='${foodir}' --variable=plugindir variables
@


1.40
log
@shuffle --variable related tests together and add a few more which are known to pass
@
text
@d1 1
a1 1
#	$OpenBSD: Makefile,v 1.39 2013/06/02 16:12:27 jasper Exp $
d67 3
a69 1
		variables-2
d476 6
@


1.39
log
@add (currently failing) regress test for quotes in variable lines, as encountered
by matthieu@@ in new freetype2.pc.
@
text
@d1 1
a1 1
#	$OpenBSD: Makefile,v 1.38 2013/05/30 00:02:36 jasper Exp $
a44 2
		variable-get-1 \
		variable-set \
d63 5
a67 1
		find-config-2
a341 14
# Misc. tests
variable-get-1:
	# Test --variable
	@@echo "/tmp" > ${WANT}
	@@${VPCONFIG} --variable prefix sysroot
	@@diff -u ${WANT} ${GOT}

variable-set:
	# Test --define-variable
	@@echo "-I/usr/local2/include -I/usr/local2/include/foo" > ${WANT}
	@@${VPCONFIG} --define-variable=prefix=/usr/local2 \
		--cflags sysroot
	@@diff -u ${WANT} ${GOT}

d443 31
@


1.38
log
@sync with pkg-config -r1.80 wrt to the output for empty files.
@
text
@d1 1
a1 1
#	$OpenBSD: Makefile,v 1.37 2013/03/27 09:46:55 jasper Exp $
d55 1
d402 6
@


1.37
log
@add two tests for resolving a regular module (passes) and the full path
to a pkgconfig file (currently fails).

the fix for pkg-config will be committed shortly
@
text
@d1 1
a1 1
#	$OpenBSD: Makefile,v 1.36 2012/12/10 10:23:27 jasper Exp $
d87 1
a87 1
	@@echo "Package file '$@@.pc' appears to be empty" > ${WANT}
@


1.36
log
@- add tests for --{atleast,min,max}-version
@
text
@d1 1
a1 1
#	$OpenBSD: Makefile,v 1.35 2012/10/09 09:56:58 jasper Exp $
d62 3
a64 1
		max-version-2
d434 15
@


1.35
log
@- adjust missing-req-4 test to properly fail
@
text
@d1 1
a1 1
#	$OpenBSD: Makefile,v 1.34 2012/10/09 07:47:39 jasper Exp $
d56 7
a62 1
		broken-require-2
d403 1
a403 1
	${PCONFIG} requires-test3
d407 25
a431 1
	${PCONFIG} requires-test4
@


1.34
log
@- add a (currently failing) test for nonexistant modules in Requires.private.
@
text
@d1 1
a1 1
#	$OpenBSD: Makefile,v 1.33 2012/10/09 07:01:05 jasper Exp $
d368 1
a368 1
	@@${VPCONFIG} --exists missing-req2
@


1.33
log
@- allow PKG_CONFIG to be overriden and remove the commented fd.o PKG_CONFIG variable.
@
text
@d1 1
a1 1
#	$OpenBSD: Makefile,v 1.32 2012/07/08 07:45:37 espie Exp $
d50 1
d363 6
@


1.32
log
@nasty real test, create a Requires that depends on a variable in such a
way that a reparse is needed
@
text
@d1 1
a1 1
#	$OpenBSD: Makefile,v 1.31 2012/07/08 06:52:00 espie Exp $
d57 1
a57 1
PKG_CONFIG=	pkg-config
a59 1
#PKG_CONFIG=	/usr/obj/ports/pkgconfig-0.26/fake-i386/usr/local/bin/pkg-config
@


1.31
log
@simplify some more
@
text
@d1 1
a1 1
#	$OpenBSD: Makefile,v 1.30 2012/07/08 06:24:13 espie Exp $
d53 3
a55 1
		whitespace-name
d388 8
@


1.30
log
@simplify, make sure everything uses ${PKG_CONFIG}
@
text
@d1 1
a1 1
#	$OpenBSD: Makefile,v 1.29 2012/07/03 21:48:04 jasper Exp $
d57 1
d66 1
a66 2
	@@if ${PCONFIG} \
                --errors-to-stdout --print-errors --exists $@@ > ${GOT}; then false; fi
d72 1
a72 2
	@@if ${PCONFIG} \
		--errors-to-stdout --print-errors --exists $@@ > ${GOT}; then false; fi
d79 1
a79 2
	@@if ${PCONFIG} \
		--errors-to-stdout --print-errors --libs $@@ > ${GOT}; then false; fi
d86 1
a86 2
	@@${PCONFIG} \
		--print-provides $@@ > ${GOT}
d92 1
a92 2
	@@${PCONFIG} \
		--print-requires $@@ > ${GOT}
d98 1
a98 2
	@@${PCONFIG} \
		--print-requires-private $@@ > ${GOT}
d104 1
a104 2
	@@if ${PCONFIG} --exists \
		"vers1 <= 0.0.2"; then false; fi
d128 1
a128 2
	@@if ${PCONFIG} --exists \
		"vers2 > 0.2.0.0"; then false; fi
d137 1
a137 2
	@@${PCONFIG}  \
		--errors-to-stdout --print-errors "alpha > 0.1.0" > ${GOT}
d143 1
a143 2
	@@${PCONFIG}  \
		--errors-to-stdout --print-errors "alpha > 0.1.0alpha1" > ${GOT}
d149 1
a149 2
	@@${PCONFIG}  \
		--errors-to-stdout --print-errors "alpha >= 0.1.0" > ${GOT}
d155 1
a155 2
	@@${PCONFIG}  \
		--errors-to-stdout --print-errors "alpha >= 0.1.0alpha2" > ${GOT}
d161 1
a161 2
	@@${PCONFIG}  \
		--errors-to-stdout --print-errors "alpha < 0.1.1" > ${GOT}
d167 1
a167 2
	@@${PCONFIG}  \
		--errors-to-stdout --print-errors "alpha < 0.1.0alpha3" > ${GOT}
d173 1
a173 2
	@@${PCONFIG}  \
		--errors-to-stdout --print-errors "alpha < 0.1.1" > ${GOT}
d179 1
a179 2
	@@${PCONFIG}  \
		--errors-to-stdout --print-errors "alpha <= 0.1.0alpha2" > ${GOT}
d185 1
a185 2
	@@${PCONFIG}  \
		--errors-to-stdout --print-errors "alpha = 0.1.0alpha2" > ${GOT}
d192 1
a192 2
	@@${PCONFIG}  \
		--errors-to-stdout --print-errors "beta > 0.1.0alpha1" > ${GOT}
d198 1
a198 2
	@@${PCONFIG}  \
		--errors-to-stdout --print-errors "beta >= 0.1.0beta1" > ${GOT}
d204 1
a204 2
	@@${PCONFIG}  \
		--errors-to-stdout --print-errors "alpha < 0.1.0rc2" > ${GOT}
d210 1
a210 2
	@@${PCONFIG}  \
		--errors-to-stdout --print-errors "beta < 0.1.0rc2" > ${GOT}
d216 1
a216 2
	@@${PCONFIG}  \
		--errors-to-stdout --print-errors "alpha < 0.1.0beta2" > ${GOT}
d222 1
a222 2
	@@${PCONFIG}  \
		--errors-to-stdout --print-errors "rc > 0.1.0alpha2" > ${GOT}
d228 1
a228 2
	@@${PCONFIG}  \
		--errors-to-stdout --print-errors "rc > 0.1.0beta2" > ${GOT}
d236 1
a236 2
	@@${PCONFIG}  \
		--errors-to-stdout --print-errors "vers1 > 0.1.0alpha2" > ${GOT}
d242 1
a242 2
	@@${PCONFIG}  \
		--errors-to-stdout --print-errors "beta <= 0.1.0beta2" > ${GOT}
d248 1
a248 2
	@@${PCONFIG}  \
		--errors-to-stdout --print-errors "beta <= 0.1.0rc2" > ${GOT}
d254 1
a254 2
	@@${PCONFIG} --errors-to-stdout \
		--print-errors --libs requires-test2 > ${GOT}
d260 1
a260 3
	@@if ${PCONFIG} --errors-to-stdout \
		--print-errors --libs --static requires-test2 > ${GOT}; then \
		false; fi
d277 1
a277 2
	@@PKG_CONFIG_SYSROOT_DIR=/altroot ${PCONFIG} \
		--cflags sysroot > ${GOT}
d283 1
a283 2
	@@PKG_CONFIG_SYSROOT_DIR=/altroot ${PCONFIG} \
		--libs sysroot > ${GOT}
d290 1
a290 2
	@@${PCONFIG} --print-errors \
		--errors-to-stdout --cflags --static static > ${GOT}
d296 1
a296 2
	@@${PCONFIG} --print-errors \
		--errors-to-stdout --cflags --static static2 > ${GOT}
d302 1
a302 2
	@@${PCONFIG} --print-errors \
		--errors-to-stdout --libs --static static > ${GOT}
d308 1
a308 2
	@@${PCONFIG} --print-errors \
		--errors-to-stdout --libs --static static2 > ${GOT}
d314 1
a314 2
	@@${PCONFIG} --print-errors \
		--errors-to-stdout --libs --static static3 > ${GOT}
d320 1
a320 2
	@@${PCONFIG} --print-errors \
		--errors-to-stdout --libs --static requires-test > ${GOT}
d326 1
a326 2
	@@${PCONFIG} --print-errors \
		--errors-to-stdout --static --libs static-order1 > ${GOT}
d333 1
a333 2
	@@${PCONFIG} --errors-to-stdout \
		--print-errors --variable prefix sysroot > ${GOT}
d339 2
a340 3
	@@${PCONFIG} --errors-to-stdout \
		--print-errors --define-variable=prefix=/usr/local2 \
		--cflags sysroot > ${GOT}
d348 1
a348 2
	@@if ${PCONFIG} --libs \
		--errors-to-stdout --print-errors missing-req > ${GOT}; then false; fi
d354 1
a354 2
	@@if ${PCONFIG} --cflags \
		--errors-to-stdout --print-errors missing-req > ${GOT}; then false; fi
d360 1
a360 2
	@@${PCONFIG} --modversion \
		--errors-to-stdout --print-errors missing-req > ${GOT}
d366 1
a366 2
	@@${PCONFIG} --cflags \
		--errors-to-stdout --print-errors whitespace > ${GOT}
d372 1
a372 2
	@@${PCONFIG} --libs \
		--errors-to-stdout --print-errors whitespace > ${GOT}
d378 1
a378 2
	@@${PCONFIG} --errors-to-stdout \
		--print-errors --libs linebreak > ${GOT}
d384 1
a384 2
	@@if ${PCONFIG} --errors-to-stdout \
		--print-errors "whitespace > 0.2.0" > ${GOT}; then false; fi
@


1.29
log
@hookup previously added static-order test
@
text
@d1 1
a1 1
#	$OpenBSD: Makefile,v 1.28 2012/07/03 21:28:26 matthieu Exp $
d56 1
d65 1
a65 1
	@@if PKG_CONFIG_PATH=${.CURDIR}/pcdir/ ${PKG_CONFIG} \
d72 1
a72 1
	@@if PKG_CONFIG_PATH=${.CURDIR}/pcdir/ ${PKG_CONFIG} \
d80 1
a80 1
	@@if PKG_CONFIG_PATH=${.CURDIR}/pcdir/ ${PKG_CONFIG} \
d88 1
a88 1
	@@PKG_CONFIG_PATH=${.CURDIR}/pcdir/ ${PKG_CONFIG} \
d95 1
a95 1
	@@PKG_CONFIG_PATH=${.CURDIR}/pcdir/ ${PKG_CONFIG} \
d102 1
a102 1
	@@PKG_CONFIG_PATH=${.CURDIR}/pcdir/ ${PKG_CONFIG} \
d109 1
a109 1
	@@if PKG_CONFIG_PATH=${.CURDIR}/pcdir/ ${PKG_CONFIG} --exists \
d114 1
a114 1
	@@PKG_CONFIG_PATH=${.CURDIR}/pcdir/ ${PKG_CONFIG} --exists "vers1 <= 0.1.0"
d118 1
a118 1
	@@PKG_CONFIG_PATH=${.CURDIR}/pcdir/ ${PKG_CONFIG} --exists "vers1 < 0.2"
d122 1
a122 1
	@@PKG_CONFIG_PATH=${.CURDIR}/pcdir/ ${PKG_CONFIG} --exists "vers2 >= 0.0.1"
d126 1
a126 1
	@@PKG_CONFIG_PATH=${.CURDIR}/pcdir/ ${PKG_CONFIG} --exists "vers2 >= 0.0.0"
d130 1
a130 1
	@@PKG_CONFIG_PATH=${.CURDIR}/pcdir/ ${PKG_CONFIG} --exists "vers2 >= 0.1.0"
d134 1
a134 1
	@@if PKG_CONFIG_PATH=${.CURDIR}/pcdir/ ${PKG_CONFIG} --exists \
d139 1
a139 1
	@@PKG_CONFIG_PATH=${.CURDIR}/pcdir/ ${PKG_CONFIG} --exists "vers2 = 0.2.0"
d144 1
a144 1
	@@PKG_CONFIG_PATH=${.CURDIR}/pcdir/ ${PKG_CONFIG}  \
d151 1
a151 1
	@@PKG_CONFIG_PATH=${.CURDIR}/pcdir/ ${PKG_CONFIG}  \
d158 1
a158 1
	@@PKG_CONFIG_PATH=${.CURDIR}/pcdir/ ${PKG_CONFIG}  \
d165 1
a165 1
	@@PKG_CONFIG_PATH=${.CURDIR}/pcdir/ ${PKG_CONFIG}  \
d172 1
a172 1
	@@PKG_CONFIG_PATH=${.CURDIR}/pcdir/ ${PKG_CONFIG}  \
d179 1
a179 1
	@@PKG_CONFIG_PATH=${.CURDIR}/pcdir/ ${PKG_CONFIG}  \
d186 1
a186 1
	@@PKG_CONFIG_PATH=${.CURDIR}/pcdir/ ${PKG_CONFIG}  \
d193 1
a193 1
	@@PKG_CONFIG_PATH=${.CURDIR}/pcdir/ ${PKG_CONFIG}  \
d200 1
a200 1
	@@PKG_CONFIG_PATH=${.CURDIR}/pcdir/ ${PKG_CONFIG}  \
d208 1
a208 1
	@@PKG_CONFIG_PATH=${.CURDIR}/pcdir/ ${PKG_CONFIG}  \
d215 1
a215 1
	@@PKG_CONFIG_PATH=${.CURDIR}/pcdir/ ${PKG_CONFIG}  \
d222 1
a222 1
	@@PKG_CONFIG_PATH=${.CURDIR}/pcdir/ ${PKG_CONFIG}  \
d229 1
a229 1
	@@PKG_CONFIG_PATH=${.CURDIR}/pcdir/ ${PKG_CONFIG}  \
d236 1
a236 1
	@@PKG_CONFIG_PATH=${.CURDIR}/pcdir/ ${PKG_CONFIG}  \
d243 1
a243 1
	@@PKG_CONFIG_PATH=${.CURDIR}/pcdir/ ${PKG_CONFIG}  \
d250 1
a250 1
	@@PKG_CONFIG_PATH=${.CURDIR}/pcdir/ ${PKG_CONFIG}  \
d259 1
a259 1
	@@PKG_CONFIG_PATH=${.CURDIR}/pcdir/ ${PKG_CONFIG}  \
d266 1
a266 1
	@@PKG_CONFIG_PATH=${.CURDIR}/pcdir/ ${PKG_CONFIG}  \
d273 1
a273 1
	@@PKG_CONFIG_PATH=${.CURDIR}/pcdir/ ${PKG_CONFIG}  \
d280 1
a280 1
	@@PKG_CONFIG_PATH=${.CURDIR}/pcdir/ ${PKG_CONFIG} --errors-to-stdout \
d287 1
a287 1
	@@if PKG_CONFIG_PATH=${.CURDIR}/pcdir/ ${PKG_CONFIG} --errors-to-stdout \
d300 1
a300 2
	@@PKG_CONFIG_PATH=${.CURDIR}/pcdir/ PKG_CONFIG_LOG=${GOT} \
		${PKG_CONFIG} --exists "sysroot >= 0.0.0"
d306 2
a307 2
	@@PKG_CONFIG_PATH=${.CURDIR}/pcdir/ PKG_CONFIG_SYSROOT_DIR=/altroot \
		${PKG_CONFIG} --cflags sysroot > ${GOT}
d313 2
a314 2
	@@PKG_CONFIG_PATH=${.CURDIR}/pcdir/ PKG_CONFIG_SYSROOT_DIR=/altroot \
		${PKG_CONFIG} --libs sysroot > ${GOT}
d321 1
a321 1
	@@PKG_CONFIG_PATH=${.CURDIR}/pcdir/ ${PKG_CONFIG} --print-errors \
d328 1
a328 1
	@@PKG_CONFIG_PATH=${.CURDIR}/pcdir/ ${PKG_CONFIG} --print-errors \
d335 1
a335 1
	@@PKG_CONFIG_PATH=${.CURDIR}/pcdir/ ${PKG_CONFIG} --print-errors \
d342 1
a342 1
	@@PKG_CONFIG_PATH=${.CURDIR}/pcdir/ ${PKG_CONFIG} --print-errors \
d349 1
a349 1
	@@PKG_CONFIG_PATH=${.CURDIR}/pcdir/ ${PKG_CONFIG} --print-errors \
d356 1
a356 1
	@@PKG_CONFIG_PATH=${.CURDIR}/pcdir/ ${PKG_CONFIG} --print-errors \
d363 1
a363 1
	@@PKG_CONFIG_PATH=${.CURDIR}/pcdir/ ${PKG_CONFIG} --print-errors \
d371 1
a371 1
	@@PKG_CONFIG_PATH=${.CURDIR}/pcdir/ ${PKG_CONFIG} --errors-to-stdout \
d378 1
a378 1
	@@PKG_CONFIG_PATH=${.CURDIR}/pcdir/ ${PKG_CONFIG} --errors-to-stdout \
d388 1
a388 1
	@@if PKG_CONFIG_PATH=${.CURDIR}/pcdir/ pkg-config --libs \
d395 1
a395 1
	@@if PKG_CONFIG_PATH=${.CURDIR}/pcdir/ pkg-config --cflags \
d402 1
a402 1
	@@PKG_CONFIG_PATH=${.CURDIR}/pcdir/ ${PKG_CONFIG} --modversion \
d409 1
a409 1
	@@PKG_CONFIG_PATH=${.CURDIR}/pcdir/ ${PKG_CONFIG} --cflags \
d416 1
a416 1
	@@PKG_CONFIG_PATH=${.CURDIR}/pcdir/ ${PKG_CONFIG} --libs \
d423 1
a423 1
	@@PKG_CONFIG_PATH=${.CURDIR}/pcdir/ ${PKG_CONFIG} --errors-to-stdout \
d430 1
a430 1
	@@if PKG_CONFIG_PATH=${.CURDIR}/pcdir/ ${PKG_CONFIG} --errors-to-stdout \
@


1.28
log
@Add a regression test for the static libraries ordering issue
exposed by Xenocara on vax.
Worked with src/usr.bin/pkg-config/pkg-config rev 1.27 found
in OpenBSD 4.9. Fails since.
@
text
@d1 1
a1 1
#	$OpenBSD: Makefile,v 1.27 2011/11/17 11:38:13 jasper Exp $
d44 1
@


1.27
log
@- adjust after recent pkg-config commit
@
text
@d1 1
a1 1
#	$OpenBSD: Makefile,v 1.26 2011/09/20 16:26:15 jasper Exp $
d357 7
@


1.26
log
@we do properly support linebreaks, so adjust the test
@
text
@d1 1
a1 1
#	$OpenBSD: Makefile,v 1.25 2011/09/20 14:08:17 jasper Exp $
d326 1
a326 1
	@@echo "-I/usr/local/include -I/usr/local/include/foo" > ${WANT}
d340 1
a340 1
	@@echo "-L/usr/local/lib -lutil -lz -lc -lm -ll" > ${WANT}
d347 1
a347 1
	@@echo "-L/usr/local/lib -L/tmp/lib -L/tmp/lib/foo -lutil -lz -lc -lm -ll -lbaz\ quux" > ${WANT}
d354 1
a354 1
	@@echo "-L/requires-test/lib -L/private-dep/lib -L/public-dep/lib -lrequires-test -lprivate-dep -lpublic-dep" > ${WANT}
@


1.25
log
@- stop pretending to care about variable expansion to multiple values
in a field. the only reason this is "allowed" by fd.o pkg-config is because
their parser is sloppy.
@
text
@d1 1
a1 1
#	$OpenBSD: Makefile,v 1.24 2011/09/17 18:07:17 jasper Exp $
d414 1
a414 1
	@@echo "-lc  " > ${WANT}
@


1.24
log
@add (failing) test for a corner case discovered by aja@@: linebreaks inside fields
@
text
@d1 1
a1 1
#	$OpenBSD: Makefile,v 1.23 2011/09/17 17:46:03 jasper Exp $
a44 1
		variable-get-2 \
a45 1
		variable-requires \
a366 7
variable-get-2:
	# Test --variable (expansion to multiple values)
	@@echo "alpha beta" > ${WANT}
	@@PKG_CONFIG_PATH=${.CURDIR}/pcdir/ ${PKG_CONFIG} --errors-to-stdout \
		--print-errors --variable requires requires-test3 > ${GOT}
	@@diff -u ${WANT} ${GOT}

a372 7
	@@diff -u ${WANT} ${GOT}

variable-requires:
	# Test variable expansion in non-variable fields, to multiple values
	@@echo " -lalpha2" > ${WANT}
	@@PKG_CONFIG_PATH=${.CURDIR}/pcdir/ ${PKG_CONFIG} --errors-to-stdout \
		--print-errors --libs requires-test3 > ${GOT}
@


1.23
log
@add a test --variable (expansion to multiple values), currently failing.
@
text
@d1 1
a1 1
#	$OpenBSD: Makefile,v 1.22 2011/07/27 12:30:58 jasper Exp $
d53 1
d57 1
d426 7
@


1.22
log
@- add a failing test, to be addressed later.

reminded by oga@@
@
text
@d1 1
a1 1
#	$OpenBSD: Makefile,v 1.21 2011/06/20 14:31:46 jasper Exp $
d44 2
a45 1
		variable-get \
d360 1
a360 1
variable-get:
d365 7
@


1.21
log
@- add tests for suffixes in Requires(.private)
@
text
@d1 1
a1 1
#	$OpenBSD: Makefile,v 1.20 2011/06/16 09:16:18 jasper Exp $
d46 1
d372 7
@


1.20
log
@- slightly expand test for --static. it works in my local tree but needs some more testing.
@
text
@d1 1
a1 1
#	$OpenBSD: Makefile,v 1.19 2011/06/16 08:34:59 jasper Exp $
d27 2
d271 15
@


1.19
log
@- adjust a test which was succeeding while it shouldn't (after the last
pkg-config commit it does again)
@
text
@d1 1
a1 1
#	$OpenBSD: Makefile,v 1.18 2011/06/15 11:54:32 jasper Exp $
d314 1
a314 1
	@@echo "-L/usr/local/lib -lc -lm" > ${WANT}
d328 1
a328 1
	@@echo "-L/usr/local/lib -L/tmp/lib -L/tmp/lib/foo -lutil -lz -lc -lm -lbaz\ quux" > ${WANT}
@


1.18
log
@more tests
@
text
@d1 1
a1 1
#	$OpenBSD: Makefile,v 1.17 2011/06/15 10:48:39 jasper Exp $
d95 1
a95 1
	@@echo "print-req-priv2>=0.0.1" > ${WANT}
@


1.17
log
@- add tests for --static (failing right now)
- fix another test which should fail now
@
text
@d1 1
a1 1
#	$OpenBSD: Makefile,v 1.16 2011/06/13 09:07:28 jasper Exp $
d41 1
d321 1
a321 1
	@@echo "-L/usr/local/lib -lutil -lz -lc -lm" > ${WANT}
d331 7
@


1.16
log
@fill in tests for getting/setting variables
@
text
@d1 1
a1 1
#	$OpenBSD: Makefile,v 1.15 2011/06/12 18:16:39 jasper Exp $
d36 5
d89 1
a89 1
		--print-requires $@@ > $@@.got
d95 2
a96 2
	@@if PKG_CONFIG_PATH=${.CURDIR}/pcdir/ ${PKG_CONFIG} \
		--print-requires-private $@@ > ${GOT}; then false; fi
d297 14
d313 4
d319 12
a330 1
	# Test grabbing Libs.private from other packages in order
a349 1
# XXX: Test Requires.private too.
@


1.15
log
@- cleanup now --errors-to-stdout is honored
- zap --short-errors which isn't helping us
@
text
@d1 1
a1 1
#	$OpenBSD: Makefile,v 1.14 2011/06/11 12:04:44 jasper Exp $
d36 2
d299 8
a306 1
define-variable:
d308 5
@


1.14
log
@- add missing comment for missing-req-3
@
text
@d1 1
a1 1
#	$OpenBSD: Makefile,v 1.13 2011/06/11 11:53:57 jasper Exp $
d51 2
a52 2
	@@if PKG_CONFIG_PATH=${.CURDIR}/pcdir/ ${PKG_CONFIG}  --short-errors \
                --errors-to-stdout --print-errors --exists $@@ 2> ${GOT}; then false; fi
d58 2
a59 2
	@@if PKG_CONFIG_PATH=${.CURDIR}/pcdir/ ${PKG_CONFIG} --short-errors \
		--errors-to-stdout --print-errors --exists $@@ 2> ${GOT}; then false; fi
d66 2
a67 2
	@@if PKG_CONFIG_PATH=${.CURDIR}/pcdir/ ${PKG_CONFIG} --short-errors \
		--errors-to-stdout --print-errors --libs $@@ 2> ${GOT}; then false; fi
d130 1
a130 1
	@@PKG_CONFIG_PATH=${.CURDIR}/pcdir/ ${PKG_CONFIG}  --short-errors \
d137 1
a137 1
	@@PKG_CONFIG_PATH=${.CURDIR}/pcdir/ ${PKG_CONFIG}  --short-errors \
d144 1
a144 1
	@@PKG_CONFIG_PATH=${.CURDIR}/pcdir/ ${PKG_CONFIG}  --short-errors \
d151 1
a151 1
	@@PKG_CONFIG_PATH=${.CURDIR}/pcdir/ ${PKG_CONFIG}  --short-errors \
d158 1
a158 1
	@@PKG_CONFIG_PATH=${.CURDIR}/pcdir/ ${PKG_CONFIG}  --short-errors \
d165 1
a165 1
	@@PKG_CONFIG_PATH=${.CURDIR}/pcdir/ ${PKG_CONFIG}  --short-errors \
d172 1
a172 1
	@@PKG_CONFIG_PATH=${.CURDIR}/pcdir/ ${PKG_CONFIG}  --short-errors \
d179 1
a179 1
	@@PKG_CONFIG_PATH=${.CURDIR}/pcdir/ ${PKG_CONFIG}  --short-errors \
d186 1
a186 1
	@@PKG_CONFIG_PATH=${.CURDIR}/pcdir/ ${PKG_CONFIG}  --short-errors \
d194 1
a194 1
	@@PKG_CONFIG_PATH=${.CURDIR}/pcdir/ ${PKG_CONFIG}  --short-errors \
d201 1
a201 1
	@@PKG_CONFIG_PATH=${.CURDIR}/pcdir/ ${PKG_CONFIG}  --short-errors \
d208 1
a208 1
	@@PKG_CONFIG_PATH=${.CURDIR}/pcdir/ ${PKG_CONFIG}  --short-errors \
d215 1
a215 1
	@@PKG_CONFIG_PATH=${.CURDIR}/pcdir/ ${PKG_CONFIG}  --short-errors \
d222 1
a222 1
	@@PKG_CONFIG_PATH=${.CURDIR}/pcdir/ ${PKG_CONFIG}  --short-errors \
d229 1
a229 1
	@@PKG_CONFIG_PATH=${.CURDIR}/pcdir/ ${PKG_CONFIG}  --short-errors \
d236 1
a236 1
	@@PKG_CONFIG_PATH=${.CURDIR}/pcdir/ ${PKG_CONFIG}  --short-errors \
d245 1
a245 1
	@@PKG_CONFIG_PATH=${.CURDIR}/pcdir/ ${PKG_CONFIG}  --short-errors \
d252 1
a252 1
	@@PKG_CONFIG_PATH=${.CURDIR}/pcdir/ ${PKG_CONFIG}  --short-errors \
d259 1
a259 1
	@@PKG_CONFIG_PATH=${.CURDIR}/pcdir/ ${PKG_CONFIG}  --short-errors \
d307 1
a307 1
		missing-req 2> ${GOT}; then false; fi
d314 1
a314 1
		missing-req 2> ${GOT}; then false; fi
d321 1
a321 1
		missing-req > ${GOT}
d328 1
a328 1
		whitespace > ${GOT}
d335 1
a335 1
		whitespace > ${GOT}
d341 2
a342 2
	@@if PKG_CONFIG_PATH=${.CURDIR}/pcdir/ ${PKG_CONFIG} --print-errors \
		"whitespace > 0.2.0" 2> ${GOT}; then false; fi
@


1.13
log
@- add test for empty .pc-files
- tweak other corruption tests
- add reminder to add tests for --static
@
text
@d1 1
a1 1
#	$OpenBSD: Makefile,v 1.12 2011/06/07 13:05:37 jasper Exp $
d318 1
@


1.12
log
@- add extensive testing for various versioned suffix combinations
- put pkg-config in a variable so it's easier to test with fd.o pkg-config too
@
text
@d1 1
a1 1
#	$OpenBSD: Makefile,v 1.11 2011/06/07 12:18:22 jasper Exp $
d29 1
d50 3
a52 3
	@@echo "Package 'corrupt1' has no Version: field" > ${WANT}
	@@if PKG_CONFIG_PATH=${.CURDIR}/pcdir/ ${PKG_CONFIG} \
		--exists $@@ 2> ${GOT}; then false; fi
d57 11
a67 3
	@@echo "Package 'corrupt2' has no Name: field" > ${WANT}
	@@if PKG_CONFIG_PATH=${.CURDIR}/pcdir/ ${PKG_CONFIG} \
		--exists $@@ 2> ${GOT}; then false; fi
d84 1
a84 1
	
d289 7
d301 1
a301 1
# only Requires needs to be checked here.
@


1.11
log
@add test for spaces in the Name field which currently get mangled
@
text
@d1 1
a1 1
#	$OpenBSD: Makefile,v 1.10 2011/06/07 06:42:47 jasper Exp $
d11 16
d42 1
d50 1
a50 1
	@@if PKG_CONFIG_PATH=${.CURDIR}/pcdir/ pkg-config \
d57 1
a57 1
	@@if PKG_CONFIG_PATH=${.CURDIR}/pcdir/ pkg-config \
d65 1
a65 1
	@@PKG_CONFIG_PATH=${.CURDIR}/pcdir/ pkg-config \
d72 1
a72 1
	@@PKG_CONFIG_PATH=${.CURDIR}/pcdir/ pkg-config \
d79 1
a79 1
	@@if PKG_CONFIG_PATH=${.CURDIR}/pcdir/ pkg-config \
d86 1
a86 1
	@@if PKG_CONFIG_PATH=${.CURDIR}/pcdir/ pkg-config --exists \
d91 1
a91 1
	@@PKG_CONFIG_PATH=${.CURDIR}/pcdir/ pkg-config --exists "vers1 <= 0.1.0"
d95 1
a95 1
	@@PKG_CONFIG_PATH=${.CURDIR}/pcdir/ pkg-config --exists "vers1 < 0.2"
d99 1
a99 1
	@@PKG_CONFIG_PATH=${.CURDIR}/pcdir/ pkg-config --exists "vers2 >= 0.0.1"
d103 1
a103 1
	@@PKG_CONFIG_PATH=${.CURDIR}/pcdir/ pkg-config --exists "vers2 >= 0.0.0"
d107 1
a107 1
	@@PKG_CONFIG_PATH=${.CURDIR}/pcdir/ pkg-config --exists "vers2 >= 0.1.0"
d111 1
a111 1
	@@if PKG_CONFIG_PATH=${.CURDIR}/pcdir/ pkg-config --exists \
d116 64
a179 1
	@@PKG_CONFIG_PATH=${.CURDIR}/pcdir/ pkg-config --exists "vers2 = 0.2.0"
a180 2
cmp-vers4:
	# Test suffixed versions (alpha)
d182 34
a215 2
cmp-vers5:
	# Test suffixed versions (beta)
d217 36
a252 2
cmp-vers6:
	# Test suffixed versions (rc)
d263 1
a263 1
		pkg-config --exists "sysroot >= 0.0.0"
d270 1
a270 1
		pkg-config --cflags sysroot > ${GOT}
d277 1
a277 1
		pkg-config --libs sysroot > ${GOT}
d303 1
a303 1
	@@PKG_CONFIG_PATH=${.CURDIR}/pcdir/ pkg-config --modversion \
d310 1
a310 1
	@@PKG_CONFIG_PATH=${.CURDIR}/pcdir/ pkg-config --cflags \
d317 1
a317 1
	@@PKG_CONFIG_PATH=${.CURDIR}/pcdir/ pkg-config --libs \
d324 1
a324 1
	@@if PKG_CONFIG_PATH=${.CURDIR}/pcdir/ pkg-config --print-errors \
@


1.10
log
@Remove comment, this test passes now.
@
text
@d1 1
a1 1
#	$OpenBSD: Makefile,v 1.9 2011/06/06 21:21:42 jasper Exp $
d24 1
d175 7
@


1.9
log
@hookup the previously added (and failing) tests; it's better to know
what fails instead of silently skipping them
@
text
@d1 1
a1 1
#	$OpenBSD: Makefile,v 1.8 2011/06/06 20:49:26 jasper Exp $
a155 2
# This currently fails, because eventhough we only request the version
# '1' is still being set as return value
@


1.8
log
@add failing tests for whitespace and Requires abuse
@
text
@d1 1
a1 1
#	$OpenBSD: Makefile,v 1.7 2011/06/06 18:59:44 jasper Exp $
d18 6
a23 1
		sysroot-libs
d157 1
a157 1
# '1' is still being set as return value 
@


1.7
log
@first set of version comparison tests
@
text
@d1 1
a1 1
#	$OpenBSD: Makefile,v 1.6 2011/06/06 17:58:07 jasper Exp $
d133 39
@


1.6
log
@tidy
@
text
@d1 1
a1 1
#	$OpenBSD: Makefile,v 1.5 2011/06/06 17:49:23 jasper Exp $
d3 9
a11 1
REGRESS_TARGETS=corrupt1 \
d61 10
a70 1
cmp-vers1:
d72 1
d74 16
a89 2
cmp-vers2:
	# Test regular versions (a > b)
d93 1
d111 1
@


1.5
log
@use ${.OBJDIR} instead of poluting ${.CURDIR}
@
text
@d1 1
a1 1
#	$OpenBSD: Makefile,v 1.4 2011/06/06 17:45:53 jasper Exp $
d3 8
a10 8
REGRESS_TARGETS=	corrupt1 \
			corrupt2 \
			print-provides \
			print-req \
			print-req-priv \
			logfile \
			sysroot-cflags \
			sysroot-libs
d12 4
a15 1
# Checks for corrupt pkg-config files.
d18 1
a18 1
	@@echo "Package 'corrupt1' has no Version: field" > ${.OBJDIR}/$@@.want
d20 2
a21 2
		--exists $@@ 2> ${.OBJDIR}/$@@.got; then false; fi
	@@diff -u ${.OBJDIR}/$@@.want ${.OBJDIR}/$@@.got
d25 1
a25 1
	@@echo "Package 'corrupt2' has no Name: field" > ${.OBJDIR}/$@@.want
d27 2
a28 2
		--exists $@@ 2> ${.OBJDIR}/$@@.got; then false; fi
	@@diff -u ${.OBJDIR}/$@@.want ${.OBJDIR}/$@@.got
d30 1
a30 1
# Checks for various printing features
d33 1
a33 1
	@@echo "print-provides = 0.0.0" > ${.OBJDIR}/$@@.want
d35 2
a36 2
		--print-provides $@@ > ${.OBJDIR}/$@@.got
	@@diff -u ${.OBJDIR}/$@@.want ${.OBJDIR}/$@@.got
d40 1
a40 1
	@@echo "print-req2>=0.0.1" > ${.OBJDIR}/$@@.want
d43 1
a43 1
	@@diff -u ${.OBJDIR}/$@@.want ${.OBJDIR}/$@@.got
d47 1
a47 1
	@@echo "print-req-priv2>=0.0.1" > ${.OBJDIR}/$@@.want
d49 2
a50 2
		--print-requires-private $@@ > ${.OBJDIR}/$@@.got; then false; fi
	@@diff -u ${.OBJDIR}/$@@.want ${.OBJDIR}/$@@.got
d77 2
a78 2
	@@echo "[/usr/bin/pkg-config] [--exists] [sysroot >= 0.0.0]" > ${.OBJDIR}/$@@.want
	@@PKG_CONFIG_PATH=${.CURDIR}/pcdir/ PKG_CONFIG_LOG=${.OBJDIR}/$@@.got \
d80 1
a80 1
	@@diff -u ${.OBJDIR}/$@@.want ${.OBJDIR}/$@@.got
d84 1
a84 1
	@@echo "-I/altroot/tmp/include -I/altroot/tmp/include/foo" > ${.OBJDIR}/$@@.want
d86 2
a87 2
		pkg-config --cflags sysroot > ${.OBJDIR}/$@@.got
	@@diff -u ${.OBJDIR}/$@@.want ${.OBJDIR}/$@@.got
d91 1
a91 1
	@@echo "-L/altroot/tmp/lib -L/altroot/tmp/lib/foo -lc" > ${.OBJDIR}/$@@.want
d93 2
a94 2
		pkg-config --libs sysroot > ${.OBJDIR}/$@@.got
	@@diff -u ${.OBJDIR}/$@@.want ${.OBJDIR}/$@@.got
@


1.4
log
@add currently failing test for PKG_CONFIG_LOG
@
text
@d1 1
a1 1
#	$OpenBSD: Makefile,v 1.3 2011/06/06 17:35:33 jasper Exp $
d15 1
a15 1
	@@echo "Package 'corrupt1' has no Version: field" > $@@.want
d17 2
a18 2
		--exists $@@ 2> $@@.got; then false; fi
	@@diff -u $@@.want $@@.got
d22 1
a22 1
	@@echo "Package 'corrupt2' has no Name: field" > $@@.want
d24 2
a25 2
		--exists $@@ 2> $@@.got; then false; fi
	@@diff -u $@@.want $@@.got
d30 1
a30 1
	@@echo "print-provides = 0.0.0" > $@@.want
d32 2
a33 2
		--print-provides $@@ > $@@.got
	@@diff -u $@@.want $@@.got
d37 1
a37 1
	@@echo "print-req2>=0.0.1" > $@@.want
d40 1
a40 1
	@@diff -u $@@.want $@@.got
d44 1
a44 1
	@@echo "print-req-priv2>=0.0.1" > $@@.want
d46 2
a47 2
		--print-requires-private $@@ > $@@.got; then false; fi
	@@diff -u $@@.want $@@.got
d74 2
a75 2
	@@echo "[/usr/bin/pkg-config] [--exists] [sysroot >= 0.0.0]" > $@@.want
	@@PKG_CONFIG_PATH=${.CURDIR}/pcdir/ PKG_CONFIG_LOG=$@@.got \
d77 1
a77 1
	@@diff -u $@@.want $@@.got
d81 1
a81 1
	@@echo "-I/altroot/tmp/include -I/altroot/tmp/include/foo" > $@@.want
d83 2
a84 2
		pkg-config --cflags sysroot > $@@.got
	@@diff -u $@@.want $@@.got
d88 1
a88 1
	@@echo "-L/altroot/tmp/lib -L/altroot/tmp/lib/foo -lc" > $@@.want
d90 2
a91 2
		pkg-config --libs sysroot > $@@.got
	@@diff -u $@@.want $@@.got
@


1.3
log
@add tests for PKG_CONFIG_SYSROOT
@
text
@d1 1
a1 1
#	$OpenBSD: Makefile,v 1.2 2011/06/06 14:31:15 jasper Exp $
a2 2
#REGRESS_TARGETS=cmp-vers1 cmp-vers2 cmp-vers3 cmp-vers4 cmp-vers5 cmp-vers6 \
#	builddir define-variable
d8 1
d71 7
@


1.2
log
@- add some more tests for printing stuff about the pkgconfig files
- tidy Makefile
@
text
@d1 1
a1 1
#	$OpenBSD: Makefile,v 1.1 2011/06/06 13:58:03 jasper Exp $
d4 1
a4 1
#	sysroot builddir define-variable
d9 3
a11 1
			print-req-priv
a69 3
sysroot:
	# Test PKG_CONFIG_SYSROOT_DIR

d72 14
@


1.1
log
@initial batch of tests for pkg-config(1), which are loong overdue.
this is far from complete, so tests will be added along the way.

ok sthen@@
@
text
@d1 1
a1 1
#	$OpenBSD$
d4 6
a9 3
#	sysroot builddir define-variable print-provides print-req \
#	print-req-priv corrupt1 corrupt2
REGRESS_TARGETS=corrupt1 corrupt2 print-req-priv
d11 38
d67 1
d74 1
a76 27

print-provides:
	# Test --print-provides

print-req:
	# Test --print-requires
	
print-req-priv:
	# Test --print-requires-private
	@@echo "print-req-priv2>=0.0.1" > $@@.want
	@@if PKG_CONFIG_PATH=${.CURDIR}/pcdir/ pkg-config \
		--print-requires-private $@@ > $@@.got; then false; fi
	@@diff -u $@@.want $@@.got

corrupt1:
	# Test for missing variables/fields
	@@echo "Package 'corrupt1' has no Version: field" > $@@.want
	@@if PKG_CONFIG_PATH=${.CURDIR}/pcdir/ pkg-config \
		--exists $@@ 2> $@@.got; then false; fi
	@@diff -u $@@.want $@@.got

corrupt2:
	# Test for missing variables/fields
	@@echo "Package 'corrupt2' has no Name: field" > $@@.want
	@@if PKG_CONFIG_PATH=${.CURDIR}/pcdir/ pkg-config \
		--exists $@@ 2> $@@.got; then false; fi
	@@diff -u $@@.want $@@.got
@

