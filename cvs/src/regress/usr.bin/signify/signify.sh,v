head	1.8;
access;
symbols
	OPENBSD_6_2_BASE:1.8
	OPENBSD_6_1:1.8.0.4
	OPENBSD_6_1_BASE:1.8
	OPENBSD_6_0:1.7.0.10
	OPENBSD_6_0_BASE:1.7
	OPENBSD_5_9:1.7.0.2
	OPENBSD_5_9_BASE:1.7
	OPENBSD_5_8:1.7.0.8
	OPENBSD_5_8_BASE:1.7
	OPENBSD_5_7:1.7.0.6
	OPENBSD_5_7_BASE:1.7
	OPENBSD_5_6:1.7.0.4
	OPENBSD_5_6_BASE:1.7
	OPENBSD_5_5:1.4.0.4
	OPENBSD_5_5_BASE:1.4;
locks; strict;
comment	@# @;


1.8
date	2016.09.03.12.23.02;	author espie;	state Exp;
branches;
next	1.7;
commitid	6jdKlhhZcr3mkord;

1.7
date	2014.03.17.15.18.55;	author tedu;	state Exp;
branches;
next	1.6;

1.6
date	2014.03.17.02.49.02;	author tedu;	state Exp;
branches;
next	1.5;

1.5
date	2014.03.17.02.43.15;	author tedu;	state Exp;
branches;
next	1.4;

1.4
date	2014.01.13.22.29.32;	author tedu;	state Exp;
branches;
next	1.3;

1.3
date	2014.01.09.18.59.56;	author tedu;	state Exp;
branches;
next	1.2;

1.2
date	2014.01.09.16.22.04;	author tedu;	state Exp;
branches;
next	1.1;

1.1
date	2014.01.09.16.13.44;	author tedu;	state Exp;
branches;
next	;


desc
@@


1.8
log
@check -z mode, just by creating an archive and checking it's still proper
gzip.
@
text
@#!/bin/sh
#
# $OpenBSD: signify.sh,v 1.7 2014/03/17 15:18:55 tedu Exp $

srcdir=$1

pubkey="$srcdir/regresskey.pub"
seckey="$srcdir/regresskey.sec"
orders="$srcdir/orders.txt"
forgery="$srcdir/forgery.txt"

set -e

cat $seckey | signify -S -s - -x test.sig -m $orders 
diff -u "$orders.sig" test.sig

signify -V -q -p $pubkey -m $orders

signify -V -q -p $pubkey -m $forgery 2> /dev/null && exit 1

signify -S -s $seckey -x confirmorders.sig -e -m $orders 
signify -V -q -p $pubkey -e -m confirmorders
diff -u $orders confirmorders

sha256 $pubkey $seckey > HASH
sha512 $orders $forgery >> HASH
signify -S -e -s $seckey -m HASH
rm HASH
signify -C -q -p $pubkey -x HASH.sig

tar zcPf archive.tgz $srcdir 
signify -zS -s $seckey -m archive.tgz -x signed.tgz
# check it's still valid gzip
gunzip -t signed.tgz
# verify it
signify -zV -p $pubkey <signed.tgz|gunzip -t
true
@


1.7
log
@use quiet signify
@
text
@d3 1
a3 1
# $OpenBSD: signify.sh,v 1.6 2014/03/17 02:49:02 tedu Exp $
d31 6
@


1.6
log
@test -C
@
text
@d3 1
a3 1
# $OpenBSD: signify.sh,v 1.5 2014/03/17 02:43:15 tedu Exp $
d17 1
a17 1
signify -V -p $pubkey -m $orders
d19 1
a19 1
signify -V -p $pubkey -m $forgery 2> /dev/null && exit 1
d22 1
a22 1
signify -V -p $pubkey -e -m confirmorders
d29 1
a29 1
signify -q -C -p $pubkey -x HASH.sig
@


1.5
log
@fix for new sig header by testing pipe code too ;)
@
text
@d3 1
a3 1
# $OpenBSD: signify.sh,v 1.4 2014/01/13 22:29:32 tedu Exp $
d24 6
@


1.4
log
@update for new options and clarify
@
text
@d3 1
a3 1
# $OpenBSD: signify.sh,v 1.3 2014/01/09 18:59:56 tedu Exp $
d14 1
a14 1
signify -S -s $seckey -x test.sig -m $orders 
@


1.3
log
@update for sig comments
@
text
@d3 1
a3 1
# $OpenBSD: signify.sh,v 1.2 2014/01/09 16:22:04 tedu Exp $
d14 2
a15 3
signify -s $seckey -o test.sig -S $orders 
diff -u test.sig "$orders.sig"
rm test.sig
d17 1
a17 1
signify -p $pubkey -V $orders > /dev/null
d19 5
a23 1
signify -p $pubkey -V $forgery 2> /dev/null && exit 1
@


1.2
log
@test signing too
@
text
@d3 1
a3 1
# $OpenBSD: signify.sh,v 1.1 2014/01/09 16:13:44 tedu Exp $
d15 1
a15 1
cmp test.sig "$orders.sig"
@


1.1
log
@regress signify
@
text
@d3 1
a3 1
# $OpenBSD: basename.sh,v 1.2 2005/04/12 06:45:03 otto Exp $
d14 4
d19 1
@

