head	1.1;
access;
symbols
	OPENBSD_6_0:1.1.0.2
	OPENBSD_6_0_BASE:1.1;
locks; strict;
comment	@ * @;


1.1
date	2016.03.20.05.13.22;	author guenther;	state Exp;
branches;
next	;
commitid	i4JvbPVpAyREGhYo;


desc
@@


1.1
log
@Add regress for environ and __progname vs load-time .init functions
@
text
@/*
 * Public Domain 2016 Philip Guenther <guenther@@openbsd.org>
 *
 * $OpenBSD$
 */

#include <iostream>
#include <cstdlib>

extern char *__progname;

class AA {
public:
	AA(const char *);
};

AA::AA(const char *arg)
{
	int fail = 0;

	if (getenv("PATH") != NULL)
		std::cout << "OK: PATH is set\n";
	else {
		std::cout << "FAILED: PATH not set\n";
		fail = 1;
	}
	if (__progname != NULL && __progname[0] != '\0')
		std::cout << "OK: __progname is set\n";
	else {
		std::cout << "FAILED: __progname not set\n";
		fail = 1;
	}
	setenv(arg, "foo", 1);
//	if (fail)
//		exit(1);
}

AA foo("INIT_ENV_REGRESS_TEST");

@
