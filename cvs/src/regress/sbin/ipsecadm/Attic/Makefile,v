head	1.4;
access;
symbols
	OPENBSD_3_9:1.3.0.6
	OPENBSD_3_9_BASE:1.3
	OPENBSD_3_8:1.3.0.4
	OPENBSD_3_8_BASE:1.3
	OPENBSD_3_7:1.3.0.2
	OPENBSD_3_7_BASE:1.3
	OPENBSD_3_6:1.2.0.2
	OPENBSD_3_6_BASE:1.2;
locks; strict;
comment	@# @;


1.4
date	2006.05.26.04.02.59;	author deraadt;	state dead;
branches;
next	1.3;

1.3
date	2004.12.29.04.39.17;	author david;	state Exp;
branches;
next	1.2;

1.2
date	2004.05.31.13.03.59;	author sturm;	state Exp;
branches;
next	1.1;

1.1
date	2004.05.23.16.04.18;	author markus;	state Exp;
branches;
next	;


desc
@@


1.4
log
@let us not talk about ipsecadm and vpn anymore; ok reyk
@
text
@# $OpenBSD: Makefile,v 1.3 2004/12/29 04:39:17 david Exp $

SRC=192.0.2.0
DST=192.0.2.1
SPI=1000
EK=eeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeee
AK=aaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaa

IPCOMP_ENABLE!=	sysctl -n net.inet.ipcomp.enable
ESP_ENABLE!=	sysctl -n net.inet.esp.enable
AH_ENABLE!=	sysctl -n net.inet.ah.enable

.ifmake !obj && !clean && !cleandir && !depend && !regress
.INTERRUPT:
	-@@${SUDO} sysctl -q net.inet.ipcomp.enable=${IPCOMP_ENABLE}
	-@@${SUDO} sysctl -q net.inet.esp.enable=${ESP_ENABLE}
	-@@${SUDO} sysctl -q net.inet.ah.enable=${AH_ENABLE}

.END:
	-@@${SUDO} sysctl -q net.inet.ipcomp.enable=${IPCOMP_ENABLE}
	-@@${SUDO} sysctl -q net.inet.esp.enable=${ESP_ENABLE}
	-@@${SUDO} sysctl -q net.inet.ah.enable=${AH_ENABLE}
.endif

ipcomp:
	@@${SUDO} sysctl -q net.inet.ipcomp.enable=1
	${SUDO} ipsecadm ipcomp -cpi ${SPI} -dst ${DST} -comp deflate 
	${SUDO} ipsecadm delspi -spi ${SPI} -dst ${DST} -proto ipcomp

tcpmd5:
	${SUDO} ipsecadm tcpmd5 -spi ${SPI} -src ${SRC} -dst ${DST} -key deadbeef
	${SUDO} ipsecadm delspi -spi ${SPI} -dst ${DST} -proto tcpmd5

esp:
	@@${SUDO} sysctl -q net.inet.esp.enable=1
	${SUDO} ipsecadm new esp -spi ${SPI} -src ${SRC} -dst ${DST} \
		-enc aes -key ${EK} -auth sha1 -authkey ${AK}
	${SUDO} ipsecadm delspi -spi ${SPI} -dst ${DST} -proto esp

ah:
	@@${SUDO} sysctl -q net.inet.ah.enable=1
	${SUDO} ipsecadm new ah -spi ${SPI} -src ${SRC} -dst ${DST} \
		-key ${AK} -auth sha1
	${SUDO} ipsecadm delspi -spi ${SPI} -dst ${DST} -proto ah

REGRESS_TARGETS=ipcomp tcpmd5 esp ah
REGRESS_ROOT_TARGETS=${REGRESS_TARGETS}
.PHONY: ${REGRESS_TARGETS}

.include <bsd.regress.mk>
@


1.3
log
@define REGRESS_ROOT_TARGETS for tests that require root privileges
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.2 2004/05/31 13:03:59 sturm Exp $
@


1.2
log
@reset sysctls only when necessary

ok markus@@
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.1 2004/05/23 16:04:18 markus Exp $
d47 1
@


1.1
log
@support deletion of tcpmd5 SAs and add regress tests; ok hshoexer, deraadt
@
text
@d1 1
a1 1
# $OpenBSD: $
d13 1
d23 1
@

