head	1.8;
access;
symbols
	OPENBSD_6_2_BASE:1.8
	OPENBSD_6_1:1.8.0.24
	OPENBSD_6_1_BASE:1.8
	OPENBSD_6_0:1.8.0.20
	OPENBSD_6_0_BASE:1.8
	OPENBSD_5_9:1.8.0.10
	OPENBSD_5_9_BASE:1.8
	OPENBSD_5_8:1.8.0.18
	OPENBSD_5_8_BASE:1.8
	OPENBSD_5_7:1.8.0.16
	OPENBSD_5_7_BASE:1.8
	OPENBSD_5_6:1.8.0.14
	OPENBSD_5_6_BASE:1.8
	OPENBSD_5_5:1.8.0.12
	OPENBSD_5_5_BASE:1.8
	OPENBSD_5_4:1.8.0.8
	OPENBSD_5_4_BASE:1.8
	OPENBSD_5_3:1.8.0.6
	OPENBSD_5_3_BASE:1.8
	OPENBSD_5_2:1.8.0.4
	OPENBSD_5_2_BASE:1.8
	OPENBSD_5_1_BASE:1.8
	OPENBSD_5_1:1.8.0.2
	OPENBSD_5_0:1.7.0.8
	OPENBSD_5_0_BASE:1.7
	OPENBSD_4_9:1.7.0.6
	OPENBSD_4_9_BASE:1.7
	OPENBSD_4_8:1.7.0.4
	OPENBSD_4_8_BASE:1.7
	OPENBSD_4_7:1.7.0.2
	OPENBSD_4_7_BASE:1.7
	OPENBSD_4_6:1.6.0.26
	OPENBSD_4_6_BASE:1.6
	OPENBSD_4_5:1.6.0.22
	OPENBSD_4_5_BASE:1.6
	OPENBSD_4_4:1.6.0.20
	OPENBSD_4_4_BASE:1.6
	OPENBSD_4_3:1.6.0.18
	OPENBSD_4_3_BASE:1.6
	OPENBSD_4_2:1.6.0.16
	OPENBSD_4_2_BASE:1.6
	OPENBSD_4_1:1.6.0.14
	OPENBSD_4_1_BASE:1.6
	OPENBSD_4_0:1.6.0.12
	OPENBSD_4_0_BASE:1.6
	OPENBSD_3_9:1.6.0.10
	OPENBSD_3_9_BASE:1.6
	OPENBSD_3_8:1.6.0.8
	OPENBSD_3_8_BASE:1.6
	OPENBSD_3_7:1.6.0.6
	OPENBSD_3_7_BASE:1.6
	OPENBSD_3_6:1.6.0.4
	OPENBSD_3_6_BASE:1.6
	OPENBSD_3_5:1.6.0.2
	OPENBSD_3_5_BASE:1.6
	OPENBSD_3_4:1.5.0.4
	OPENBSD_3_4_BASE:1.5
	OPENBSD_3_3:1.5.0.2
	OPENBSD_3_3_BASE:1.5
	OPENBSD_3_2:1.1.0.2
	OPENBSD_3_2_BASE:1.1;
locks; strict;
comment	@# @;


1.8
date	2011.11.27.10.33.37;	author henning;	state Exp;
branches;
next	1.7;

1.7
date	2009.09.23.14.08.33;	author jsg;	state Exp;
branches;
next	1.6;

1.6
date	2003.12.05.16.55.40;	author henning;	state Exp;
branches;
next	1.5;

1.5
date	2003.02.12.12.52.48;	author mcbride;	state Exp;
branches;
next	1.4;

1.4
date	2002.12.05.13.09.32;	author henning;	state Exp;
branches;
next	1.3;

1.3
date	2002.10.22.07.10.33;	author camield;	state Exp;
branches;
next	1.2;

1.2
date	2002.10.05.22.25.33;	author dhartmei;	state Exp;
branches;
next	1.1;

1.1
date	2002.06.11.02.16.30;	author kjell;	state Exp;
branches;
next	;


desc
@@


1.8
log
@adjust for port numbers instead of names by default
From: Lawrence Teo <lteo at devio at us>
@
text
@EVIL = "lo0"
GOOD = "{ lo0, lo1000000 }"
GOOD_NET = "{ 127.0.0.0/24, 10.0.1.0/24 }"
DEST_NET = "{ 1.2.3.4/25, 2.4.6.8/30 }"
match in on lo0 inet proto tcp from any to 1.2.3.4 port = 2222 rdr-to 10.0.0.10 port 22
match in on lo0 inet proto tcp from 127.0.0.0/24 to 1.2.3.0/25 port = 21 rdr-to 127.0.0.1 port 8021
match in on lo0 inet proto tcp from 127.0.0.0/24 to 2.4.6.8/30 port = 21 rdr-to 127.0.0.1 port 8021
match in on lo0 inet proto tcp from 10.0.1.0/24 to 1.2.3.0/25 port = 21 rdr-to 127.0.0.1 port 8021
match in on lo0 inet proto tcp from 10.0.1.0/24 to 2.4.6.8/30 port = 21 rdr-to 127.0.0.1 port 8021
match in on lo1000000 inet proto tcp from 127.0.0.0/24 to 1.2.3.0/25 port = 21 rdr-to 127.0.0.1 port 8021
match in on lo1000000 inet proto tcp from 127.0.0.0/24 to 2.4.6.8/30 port = 21 rdr-to 127.0.0.1 port 8021
match in on lo1000000 inet proto tcp from 10.0.1.0/24 to 1.2.3.0/25 port = 21 rdr-to 127.0.0.1 port 8021
match in on lo1000000 inet proto tcp from 10.0.1.0/24 to 2.4.6.8/30 port = 21 rdr-to 127.0.0.1 port 8021
@


1.7
log
@More tweaks to try to catchup to recent pf changes.
pfopt5 part from sthen@@

ok henning@@ sthen@@
@
text
@d6 8
a13 8
match in on lo0 inet proto tcp from 127.0.0.0/24 to 1.2.3.0/25 port = ftp rdr-to 127.0.0.1 port 8021
match in on lo0 inet proto tcp from 127.0.0.0/24 to 2.4.6.8/30 port = ftp rdr-to 127.0.0.1 port 8021
match in on lo0 inet proto tcp from 10.0.1.0/24 to 1.2.3.0/25 port = ftp rdr-to 127.0.0.1 port 8021
match in on lo0 inet proto tcp from 10.0.1.0/24 to 2.4.6.8/30 port = ftp rdr-to 127.0.0.1 port 8021
match in on lo1000000 inet proto tcp from 127.0.0.0/24 to 1.2.3.0/25 port = ftp rdr-to 127.0.0.1 port 8021
match in on lo1000000 inet proto tcp from 127.0.0.0/24 to 2.4.6.8/30 port = ftp rdr-to 127.0.0.1 port 8021
match in on lo1000000 inet proto tcp from 10.0.1.0/24 to 1.2.3.0/25 port = ftp rdr-to 127.0.0.1 port 8021
match in on lo1000000 inet proto tcp from 10.0.1.0/24 to 2.4.6.8/30 port = ftp rdr-to 127.0.0.1 port 8021
@


1.6
log
@lo1, tun0, tun1 don't exist any more. thus, create the interfaces we need for
regress purposes before starting and destroy them afterwards.
lo1 -> lo1000000
tun0 -> tun1000000
tun1 -> tun1000001

ok markus@@
@
text
@d5 9
a13 9
rdr on lo0 inet proto tcp from any to 1.2.3.4 port = 2222 -> 10.0.0.10 port 22
rdr on lo0 inet proto tcp from 127.0.0.0/24 to 1.2.3.0/25 port = ftp -> 127.0.0.1 port 8021
rdr on lo0 inet proto tcp from 127.0.0.0/24 to 2.4.6.8/30 port = ftp -> 127.0.0.1 port 8021
rdr on lo0 inet proto tcp from 10.0.1.0/24 to 1.2.3.0/25 port = ftp -> 127.0.0.1 port 8021
rdr on lo0 inet proto tcp from 10.0.1.0/24 to 2.4.6.8/30 port = ftp -> 127.0.0.1 port 8021
rdr on lo1000000 inet proto tcp from 127.0.0.0/24 to 1.2.3.0/25 port = ftp -> 127.0.0.1 port 8021
rdr on lo1000000 inet proto tcp from 127.0.0.0/24 to 2.4.6.8/30 port = ftp -> 127.0.0.1 port 8021
rdr on lo1000000 inet proto tcp from 10.0.1.0/24 to 1.2.3.0/25 port = ftp -> 127.0.0.1 port 8021
rdr on lo1000000 inet proto tcp from 10.0.1.0/24 to 2.4.6.8/30 port = ftp -> 127.0.0.1 port 8021
@


1.5
log
@Match changes in pfctl which make rdr behave more like the other rule types.

ok dhartmei@@
@
text
@d2 1
a2 1
GOOD = "{ lo0, lo1 }"
d10 4
a13 4
rdr on lo1 inet proto tcp from 127.0.0.0/24 to 1.2.3.0/25 port = ftp -> 127.0.0.1 port 8021
rdr on lo1 inet proto tcp from 127.0.0.0/24 to 2.4.6.8/30 port = ftp -> 127.0.0.1 port 8021
rdr on lo1 inet proto tcp from 10.0.1.0/24 to 1.2.3.0/25 port = ftp -> 127.0.0.1 port 8021
rdr on lo1 inet proto tcp from 10.0.1.0/24 to 2.4.6.8/30 port = ftp -> 127.0.0.1 port 8021
@


1.4
log
@adjust after pfctl output changes
@
text
@d5 9
a13 9
rdr on lo0 inet proto tcp from any to 1.2.3.4 port 2222 -> 10.0.0.10 port 22
rdr on lo0 inet proto tcp from 127.0.0.0/24 to 1.2.3.0/25 port 21 -> 127.0.0.1 port 8021
rdr on lo0 inet proto tcp from 127.0.0.0/24 to 2.4.6.8/30 port 21 -> 127.0.0.1 port 8021
rdr on lo0 inet proto tcp from 10.0.1.0/24 to 1.2.3.0/25 port 21 -> 127.0.0.1 port 8021
rdr on lo0 inet proto tcp from 10.0.1.0/24 to 2.4.6.8/30 port 21 -> 127.0.0.1 port 8021
rdr on lo1 inet proto tcp from 127.0.0.0/24 to 1.2.3.0/25 port 21 -> 127.0.0.1 port 8021
rdr on lo1 inet proto tcp from 127.0.0.0/24 to 2.4.6.8/30 port 21 -> 127.0.0.1 port 8021
rdr on lo1 inet proto tcp from 10.0.1.0/24 to 1.2.3.0/25 port 21 -> 127.0.0.1 port 8021
rdr on lo1 inet proto tcp from 10.0.1.0/24 to 2.4.6.8/30 port 21 -> 127.0.0.1 port 8021
@


1.3
log
@Update for new semantics of set_ipmask (netmask is applied immediately
to an address by pfctl).
@
text
@d1 4
a4 4
EVIL = lo0
GOOD = { lo0, lo1 }
GOOD_NET = { 127.0.0.0/24, 10.0.1.0/24 }
DEST_NET = { 1.2.3.4/25, 2.4.6.8/30 }
@


1.2
log
@Expand {} lists from left to right, so 'pass in from { a, b } to any'
becomes '@@0 pass in from a to any @@1 pass in from b to any' instead of
the other way around. Patch from Camiel Dobbelaar.
@
text
@d6 1
a6 1
rdr on lo0 inet proto tcp from 127.0.0.0/24 to 1.2.3.4/25 port 21 -> 127.0.0.1 port 8021
d8 1
a8 1
rdr on lo0 inet proto tcp from 10.0.1.0/24 to 1.2.3.4/25 port 21 -> 127.0.0.1 port 8021
d10 1
a10 1
rdr on lo1 inet proto tcp from 127.0.0.0/24 to 1.2.3.4/25 port 21 -> 127.0.0.1 port 8021
d12 1
a12 1
rdr on lo1 inet proto tcp from 10.0.1.0/24 to 1.2.3.4/25 port 21 -> 127.0.0.1 port 8021
@


1.1
log
@Use merged config file format. The separate NAT loop can go away,
since all files are now loaded the same way. Add regress tests for
invalid ordering of scrub, nat, filter rules
@
text
@d6 7
a13 7
rdr on lo1 inet proto tcp from 10.0.1.0/24 to 1.2.3.4/25 port 21 -> 127.0.0.1 port 8021
rdr on lo1 inet proto tcp from 127.0.0.0/24 to 2.4.6.8/30 port 21 -> 127.0.0.1 port 8021
rdr on lo1 inet proto tcp from 127.0.0.0/24 to 1.2.3.4/25 port 21 -> 127.0.0.1 port 8021
rdr on lo0 inet proto tcp from 10.0.1.0/24 to 2.4.6.8/30 port 21 -> 127.0.0.1 port 8021
rdr on lo0 inet proto tcp from 10.0.1.0/24 to 1.2.3.4/25 port 21 -> 127.0.0.1 port 8021
rdr on lo0 inet proto tcp from 127.0.0.0/24 to 2.4.6.8/30 port 21 -> 127.0.0.1 port 8021
rdr on lo0 inet proto tcp from 127.0.0.0/24 to 1.2.3.4/25 port 21 -> 127.0.0.1 port 8021
@

