head	1.10;
access;
symbols
	OPENBSD_6_1_BASE:1.10
	OPENBSD_6_0:1.10.0.22
	OPENBSD_6_0_BASE:1.10
	OPENBSD_5_9:1.10.0.12
	OPENBSD_5_9_BASE:1.10
	OPENBSD_5_8:1.10.0.20
	OPENBSD_5_8_BASE:1.10
	OPENBSD_5_7:1.10.0.18
	OPENBSD_5_7_BASE:1.10
	OPENBSD_5_6:1.10.0.16
	OPENBSD_5_6_BASE:1.10
	OPENBSD_5_5:1.10.0.14
	OPENBSD_5_5_BASE:1.10
	OPENBSD_5_4:1.10.0.10
	OPENBSD_5_4_BASE:1.10
	OPENBSD_5_3:1.10.0.8
	OPENBSD_5_3_BASE:1.10
	OPENBSD_5_2:1.10.0.6
	OPENBSD_5_2_BASE:1.10
	OPENBSD_5_1_BASE:1.10
	OPENBSD_5_1:1.10.0.4
	OPENBSD_5_0:1.10.0.2
	OPENBSD_5_0_BASE:1.10
	OPENBSD_4_9:1.8.0.30
	OPENBSD_4_9_BASE:1.8
	OPENBSD_4_8:1.8.0.28
	OPENBSD_4_8_BASE:1.8
	OPENBSD_4_7:1.8.0.24
	OPENBSD_4_7_BASE:1.8
	OPENBSD_4_6:1.8.0.26
	OPENBSD_4_6_BASE:1.8
	OPENBSD_4_5:1.8.0.22
	OPENBSD_4_5_BASE:1.8
	OPENBSD_4_4:1.8.0.20
	OPENBSD_4_4_BASE:1.8
	OPENBSD_4_3:1.8.0.18
	OPENBSD_4_3_BASE:1.8
	OPENBSD_4_2:1.8.0.16
	OPENBSD_4_2_BASE:1.8
	OPENBSD_4_1:1.8.0.14
	OPENBSD_4_1_BASE:1.8
	OPENBSD_4_0:1.8.0.12
	OPENBSD_4_0_BASE:1.8
	OPENBSD_3_9:1.8.0.10
	OPENBSD_3_9_BASE:1.8
	OPENBSD_3_8:1.8.0.8
	OPENBSD_3_8_BASE:1.8
	OPENBSD_3_7:1.8.0.6
	OPENBSD_3_7_BASE:1.8
	OPENBSD_3_6:1.8.0.4
	OPENBSD_3_6_BASE:1.8
	OPENBSD_3_5:1.8.0.2
	OPENBSD_3_5_BASE:1.8
	OPENBSD_3_4:1.7.0.2
	OPENBSD_3_4_BASE:1.7
	OPENBSD_3_3:1.6.0.2
	OPENBSD_3_3_BASE:1.6;
locks; strict;
comment	@# @;


1.10
date	2011.07.24.02.22.52;	author mcbride;	state Exp;
branches;
next	1.9;

1.9
date	2011.07.24.01.22.11;	author mcbride;	state Exp;
branches;
next	1.8;

1.8
date	2004.03.07.20.50.49;	author henning;	state Exp;
branches;
next	1.7;

1.7
date	2003.06.08.10.39.02;	author cedric;	state Exp;
branches;
next	1.6;

1.6
date	2003.02.14.17.33.54;	author henning;	state Exp;
branches;
next	1.5;

1.5
date	2003.01.24.23.44.41;	author cedric;	state Exp;
branches;
next	1.4;

1.4
date	2003.01.17.17.59.23;	author cedric;	state Exp;
branches;
next	1.3;

1.3
date	2003.01.15.17.08.16;	author cedric;	state Exp;
branches;
next	1.2;

1.2
date	2003.01.15.10.11.54;	author cedric;	state Exp;
branches;
next	1.1;

1.1
date	2003.01.14.14.43.31;	author cedric;	state Exp;
branches;
next	;


desc
@@


1.10
log
@Handle 'show' specially to prepare for regress tests on pfrke_route
and pfrke_cost entries. Output becomes sorted in table order.
@
text
@# create
# pass add -n 1.1.1.1 !1.1.1.2 10.10/16 !10.11/16 ::1 !::2
6/6 addresses added (dummy).
# pass add -nf-
6/6 addresses added (dummy).
# pass add -nqv 1.1.1.1 !1.1.1.2 10.10/16 !10.11/16 ::1 !::2
A  1.1.1.1
A  10.10.0.0/16
A  ::1
A !1.1.1.2
A !10.11.0.0/16
A !::2
# pass add -nqvv 1.1.1.1 !1.1.1.2 10.10/16 !10.11/16 ::1 !::2
A  1.1.1.1
A  10.10.0.0/16
A  ::1
A !1.1.1.2
A !10.11.0.0/16
A !::2
# pass add 1.1.1.1 !1.1.1.2 10.10/16 !10.11/16 ::1 !::2
6/6 addresses added.
# pass show 
   1.1.1.1
  !1.1.1.2
   10.10.0.0/16
  !10.11.0.0/16
   ::1
  !::2
# pass replace -n 1.1.1.1 !1.1.1.2 !!1.1.1.3 !!!1.1.1.4
2 addresses added (dummy).
4 addresses deleted (dummy).
# pass replace -nf-
2 addresses added (dummy).
4 addresses deleted (dummy).
# pass replace -nqv 1.1.1.1 !1.1.1.2 !!1.1.1.3 !!!1.1.1.4
A  1.1.1.3
A !1.1.1.4
D  10.10.0.0/16
D  ::1
D !10.11.0.0/16
D !::2
# pass replace -nqvv 1.1.1.1 !1.1.1.2 !!1.1.1.3 !!!1.1.1.4
   1.1.1.1
  !1.1.1.2
A  1.1.1.3
A !1.1.1.4
D  10.10.0.0/16
D  ::1
D !10.11.0.0/16
D !::2
# pass replace 1.1.1.1 !1.1.1.2 !!1.1.1.3 !!!1.1.1.4
2 addresses added.
4 addresses deleted.
# pass show 
   1.1.1.1
  !1.1.1.2
   1.1.1.3
  !1.1.1.4
# pass replace -n fe80::/16 !fe81::/16 !!fe82::/16 !!!fe83::/16
4 addresses added (dummy).
4 addresses deleted (dummy).
# pass replace -nf-
4 addresses added (dummy).
4 addresses deleted (dummy).
# pass replace -nqv fe80::/16 !fe81::/16 !!fe82::/16 !!!fe83::/16
A  fe80::/16
A  fe82::/16
A !fe81::/16
A !fe83::/16
D  1.1.1.1
D  1.1.1.3
D !1.1.1.2
D !1.1.1.4
# pass replace -nqvv fe80::/16 !fe81::/16 !!fe82::/16 !!!fe83::/16
A  fe80::/16
A  fe82::/16
A !fe81::/16
A !fe83::/16
D  1.1.1.1
D  1.1.1.3
D !1.1.1.2
D !1.1.1.4
# pass replace fe80::/16 !fe81::/16 !!fe82::/16 !!!fe83::/16
4 addresses added.
4 addresses deleted.
# pass show 
   fe80::/16
  !fe81::/16
   fe82::/16
  !fe83::/16
# pass replace -n 10/8 !10.10/16 10.10.10/24 !10.10.10.10
4 addresses added (dummy).
4 addresses deleted (dummy).
# pass replace -nf-
4 addresses added (dummy).
4 addresses deleted (dummy).
# pass replace -nqv 10/8 !10.10/16 10.10.10/24 !10.10.10.10
A  10.0.0.0/8
A  10.10.10.0/24
A !10.10.0.0/16
A !10.10.10.10
D  fe80::/16
D  fe82::/16
D !fe81::/16
D !fe83::/16
# pass replace -nqvv 10/8 !10.10/16 10.10.10/24 !10.10.10.10
A  10.0.0.0/8
A  10.10.10.0/24
A !10.10.0.0/16
A !10.10.10.10
D  fe80::/16
D  fe82::/16
D !fe81::/16
D !fe83::/16
# pass replace 10/8 !10.10/16 10.10.10/24 !10.10.10.10
4 addresses added.
4 addresses deleted.
# pass add -n fe80::/16 !fe80:fe80::/32 fe80:fe80:fe80::/48
3/3 addresses added (dummy).
# pass add -nf-
3/3 addresses added (dummy).
# pass add -nqv fe80::/16 !fe80:fe80::/32 fe80:fe80:fe80::/48
A  fe80::/16
A  fe80:fe80:fe80::/48
A !fe80:fe80::/32
# pass add -nqvv fe80::/16 !fe80:fe80::/32 fe80:fe80:fe80::/48
A  fe80::/16
A  fe80:fe80:fe80::/48
A !fe80:fe80::/32
# pass add fe80::/16 !fe80:fe80::/32 fe80:fe80:fe80::/48
3/3 addresses added.
# pass show 
   10.0.0.0/8
  !10.10.0.0/16
   10.10.10.0/24
  !10.10.10.10
   fe80::/16
  !fe80:fe80::/32
   fe80:fe80:fe80::/48
# pass test 10.1.1.1 10.10.10.1
2/2 addresses match.
# fail test 11.1.1.1 10.10.1.1 10.10.10.10
0/3 addresses match.
# fail test 10.1.1.1 11.1.1.1
1/2 addresses match.
# kill
1 tables deleted.
rules cleared
ktable: 28 allocated, 28 released, 0 leaked.
pfrke_plain: 95 allocated, 95 released, 0 leaked.
pfrke_route: 0 allocated, 0 released, 0 leaked.
pfrke_cost: 0 allocated, 0 released, 0 leaked.
@


1.9
log
@Update PF table regress tests to work with -current.
@
text
@d24 1
d26 1
a27 2
  !1.1.1.2
  !10.11.0.0/16
d56 1
a57 1
  !1.1.1.2
d88 1
a89 1
  !fe81::/16
d134 1
d136 1
d138 1
a139 3
  !10.10.0.0/16
  !10.10.10.10
  !fe80:fe80::/32
@


1.8
log
@syn with reality, ryan ok
@
text
@a148 1
nat cleared
d150 3
a152 1
kentry: 95 allocated, 95 released, 0 leaked.
@


1.7
log
@Sync with recent anchor changes.
Execute all table regress tests inside 'regress:regress' ruleset.
@
text
@d2 1
a2 1
# pass add -n 1.1.1.1 !1.1.1.2 10.10 !10.11 ::1 !::2
d6 1
a6 1
# pass add -nqv 1.1.1.1 !1.1.1.2 10.10 !10.11 ::1 !::2
d13 1
a13 1
# pass add -nqvv 1.1.1.1 !1.1.1.2 10.10 !10.11 ::1 !::2
d20 1
a20 1
# pass add 1.1.1.1 !1.1.1.2 10.10 !10.11 ::1 !::2
d91 1
a91 1
# pass replace -n 10 !10.10 10.10.10 !10.10.10.10
d97 1
a97 1
# pass replace -nqv 10 !10.10 10.10.10 !10.10.10.10
d106 1
a106 1
# pass replace -nqvv 10 !10.10 10.10.10 !10.10.10.10
d115 1
a115 1
# pass replace 10 !10.10 10.10.10 !10.10.10.10
@


1.6
log
@adjust after pfctl changes
@
text
@d147 4
a150 2
1 table deleted.
ktable: 27 allocated, 27 released, 0 leaked.
@


1.5
log
@Make table tests less sensitive to environmental conditions.
Work started with revision 1.4
ok dhartmei@@
@
text
@a1 1
1 table added.
d148 1
a148 1
ktable: 26 allocated, 26 released, 0 leaked.
@


1.4
log
@Make table tests less sensitive to environmental conditions.
ok dhartmei@@
@
text
@d9 2
a11 1
A  10.10.0.0/16
a12 1
A  ::1
d16 2
a18 1
A  10.10.0.0/16
a19 1
A  ::1
d39 1
a39 1
D !::2
d42 1
a42 1
D  10.10.0.0/16
d48 1
a48 1
D !::2
d51 1
a51 1
D  10.10.0.0/16
d68 1
a69 1
A  fe82::/16
d71 1
a71 1
D !1.1.1.4
d74 1
a74 1
D  1.1.1.1
d77 1
a78 1
A  fe82::/16
d80 1
a80 1
D !1.1.1.4
d83 1
a83 1
D  1.1.1.1
d100 1
a101 1
A  10.10.10.0/24
d103 1
a103 1
D !fe83::/16
d106 1
a106 1
D  fe80::/16
d109 1
a110 1
A  10.10.10.0/24
d112 1
a112 1
D !fe83::/16
d115 1
a115 1
D  fe80::/16
d125 1
a126 1
A  fe80:fe80:fe80::/48
d129 1
a130 1
A  fe80:fe80:fe80::/48
@


1.3
log
@Bunch of new regression tests. The only missing thing now is tests
for the <table> syntax in rules.
@
text
@d25 2
a27 1
   10.10.0.0/16
a28 1
   ::1
d57 1
a58 1
   1.1.1.3
d89 1
a90 1
   fe82::/16
d135 3
a138 1
   10.10.10.0/24
a139 1
   fe80::/16
a140 1
   fe80:fe80:fe80::/48
@


1.2
log
@Add memory allocation checks + leak detection in regress tests.
@
text
@d3 1
a3 1
# add -n  1.1.1.1 !1.1.1.2 10.10 !10.11 ::1 !::2
d5 1
a5 1
# add -nf-
d7 1
a7 1
# add -nqv
d14 1
a14 1
# add -nqvv
d21 1
a21 1
# add
d23 1
a23 1
# show
d30 1
a30 1
# replace -n  1.1.1.1 !1.1.1.2 !!1.1.1.3 !!!1.1.1.4
d33 1
a33 1
# replace -nf-
d36 1
a36 1
# replace -nqv
d43 1
a43 1
# replace -nqvv
d52 1
a52 1
# replace
d55 1
a55 1
# show
d60 1
a60 1
# replace -n  fe80::/16 !fe81::/16 !!fe82::/16 !!!fe83::/16
d63 1
a63 1
# replace -nf-
d66 1
a66 1
# replace -nqv
d75 1
a75 1
# replace -nqvv
d84 1
a84 1
# replace
d87 1
a87 1
# show
d92 1
a92 1
# replace -n  10 !10.10 10.10.10 !10.10.10.10
d95 1
a95 1
# replace -nf-
d98 1
a98 1
# replace -nqv
d107 1
a107 1
# replace -nqvv
d116 1
a116 1
# replace
d119 1
a119 1
# add -n  fe80::/16 !fe80:fe80::/32 fe80:fe80:fe80::/48
d121 1
a121 1
# add -nf-
d123 1
a123 1
# add -nqv
d127 1
a127 1
# add -nqvv
d131 1
a131 1
# add
d133 1
a133 1
# show
d141 1
a141 1
# test
d143 1
a143 1
# test
d145 1
a145 1
# test
a146 4
# table
regress
# table -v
-pa--	regress
@


1.1
log
@Add regression tests for radix table address manipulations.
ok dhartmei@@
@
text
@d153 2
@

