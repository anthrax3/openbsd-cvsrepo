head	1.11;
access;
symbols
	OPENBSD_6_2:1.11.0.34
	OPENBSD_6_2_BASE:1.11
	OPENBSD_6_1:1.11.0.32
	OPENBSD_6_1_BASE:1.11
	OPENBSD_6_0:1.11.0.28
	OPENBSD_6_0_BASE:1.11
	OPENBSD_5_9:1.11.0.18
	OPENBSD_5_9_BASE:1.11
	OPENBSD_5_8:1.11.0.26
	OPENBSD_5_8_BASE:1.11
	OPENBSD_5_7:1.11.0.24
	OPENBSD_5_7_BASE:1.11
	OPENBSD_5_6:1.11.0.22
	OPENBSD_5_6_BASE:1.11
	OPENBSD_5_5:1.11.0.20
	OPENBSD_5_5_BASE:1.11
	OPENBSD_5_4:1.11.0.16
	OPENBSD_5_4_BASE:1.11
	OPENBSD_5_3:1.11.0.14
	OPENBSD_5_3_BASE:1.11
	OPENBSD_5_2:1.11.0.12
	OPENBSD_5_2_BASE:1.11
	OPENBSD_5_1_BASE:1.11
	OPENBSD_5_1:1.11.0.10
	OPENBSD_5_0:1.11.0.8
	OPENBSD_5_0_BASE:1.11
	OPENBSD_4_9:1.11.0.6
	OPENBSD_4_9_BASE:1.11
	OPENBSD_4_8:1.11.0.4
	OPENBSD_4_8_BASE:1.11
	OPENBSD_4_7:1.11.0.2
	OPENBSD_4_7_BASE:1.11
	OPENBSD_4_6:1.10.0.26
	OPENBSD_4_6_BASE:1.10
	OPENBSD_4_5:1.10.0.22
	OPENBSD_4_5_BASE:1.10
	OPENBSD_4_4:1.10.0.20
	OPENBSD_4_4_BASE:1.10
	OPENBSD_4_3:1.10.0.18
	OPENBSD_4_3_BASE:1.10
	OPENBSD_4_2:1.10.0.16
	OPENBSD_4_2_BASE:1.10
	OPENBSD_4_1:1.10.0.14
	OPENBSD_4_1_BASE:1.10
	OPENBSD_4_0:1.10.0.12
	OPENBSD_4_0_BASE:1.10
	OPENBSD_3_9:1.10.0.10
	OPENBSD_3_9_BASE:1.10
	OPENBSD_3_8:1.10.0.8
	OPENBSD_3_8_BASE:1.10
	OPENBSD_3_7:1.10.0.6
	OPENBSD_3_7_BASE:1.10
	OPENBSD_3_6:1.10.0.4
	OPENBSD_3_6_BASE:1.10
	OPENBSD_3_5:1.10.0.2
	OPENBSD_3_5_BASE:1.10
	OPENBSD_3_4:1.8.0.2
	OPENBSD_3_4_BASE:1.8
	OPENBSD_3_3:1.7.0.2
	OPENBSD_3_3_BASE:1.7
	OPENBSD_3_2:1.3.0.2
	OPENBSD_3_2_BASE:1.3;
locks; strict;
comment	@# @;


1.11
date	2009.09.23.14.08.33;	author jsg;	state Exp;
branches;
next	1.10;

1.10
date	2003.12.31.11.55.04;	author cedric;	state Exp;
branches;
next	1.9;

1.9
date	2003.12.05.16.55.40;	author henning;	state Exp;
branches;
next	1.8;

1.8
date	2003.07.29.20.28.34;	author cedric;	state Exp;
branches;
next	1.7;

1.7
date	2003.01.18.05.16.43;	author mcbride;	state Exp;
branches;
next	1.6;

1.6
date	2002.12.05.13.09.32;	author henning;	state Exp;
branches;
next	1.5;

1.5
date	2002.10.22.07.10.33;	author camield;	state Exp;
branches;
next	1.4;

1.4
date	2002.10.05.22.25.33;	author dhartmei;	state Exp;
branches;
next	1.3;

1.3
date	2002.07.13.18.37.09;	author henning;	state Exp;
branches;
next	1.2;

1.2
date	2002.06.11.05.11.27;	author henning;	state Exp;
branches;
next	1.1;

1.1
date	2002.06.11.02.16.30;	author kjell;	state Exp;
branches;
next	;


desc
@@


1.11
log
@More tweaks to try to catchup to recent pf changes.
pfopt5 part from sthen@@

ok henning@@ sthen@@
@
text
@TEST_LIST1 = "{ 192.168.1.5, 192.168.1.6, 192.168.1.7 }"
TEST_LIST2 = "{ 172.6.1.1, 172.14.1.2/32, 172.16.2.0/24 }"
match out on lo0 inet from 192.168.1.1 to any nat-to 10.0.0.1
match out on lo0 inet proto tcp from 192.168.1.2 to any nat-to 10.0.0.2
match out on lo0 inet proto udp from 192.168.1.3 to any nat-to 10.0.0.3
match out on lo0 inet proto icmp from 192.168.1.4 to any nat-to 10.0.0.4
match out on lo0 inet from 192.168.1.5 to 172.6.1.1 nat-to 127.0.0.1
match out on lo0 inet from 192.168.1.5 to 172.14.1.2 nat-to 127.0.0.1
match out on lo0 inet from 192.168.1.5 to 172.16.2.0/24 nat-to 127.0.0.1
match out on lo0 inet from 192.168.1.6 to 172.6.1.1 nat-to 127.0.0.1
match out on lo0 inet from 192.168.1.6 to 172.14.1.2 nat-to 127.0.0.1
match out on lo0 inet from 192.168.1.6 to 172.16.2.0/24 nat-to 127.0.0.1
match out on lo0 inet from 192.168.1.7 to 172.6.1.1 nat-to 127.0.0.1
match out on lo0 inet from 192.168.1.7 to 172.14.1.2 nat-to 127.0.0.1
match out on lo0 inet from 192.168.1.7 to 172.16.2.0/24 nat-to 127.0.0.1
match out on lo0 inet from 192.168.0.0/24 to any nat-to (lo0) round-robin
match out on lo0 inet from 192.168.1.8 to ! 172.17.0.0/16 nat-to 10.0.0.8
match out on ! lo0 inet proto udp all nat-to 10.0.0.8 static-port
match out on ! lo0 inet proto tcp all nat-to 10.0.0.8 static-port
match out on lo0 inet all nat-to 10.0.0.8
match out on tun1000000 inet all nat-to 10.0.0.8
@


1.10
log
@Sync after interface improvements.
@
text
@d3 19
a21 20
no nat on lo0 inet from 192.168.1.1 to 10.1.2.3
nat on lo0 inet from 192.168.1.1 to any -> 10.0.0.1
nat on lo0 inet proto tcp from 192.168.1.2 to any -> 10.0.0.2
nat on lo0 inet proto udp from 192.168.1.3 to any -> 10.0.0.3
nat on lo0 inet proto icmp from 192.168.1.4 to any -> 10.0.0.4
nat on lo0 inet from 192.168.1.5 to 172.6.1.1 -> 127.0.0.1
nat on lo0 inet from 192.168.1.5 to 172.14.1.2 -> 127.0.0.1
nat on lo0 inet from 192.168.1.5 to 172.16.2.0/24 -> 127.0.0.1
nat on lo0 inet from 192.168.1.6 to 172.6.1.1 -> 127.0.0.1
nat on lo0 inet from 192.168.1.6 to 172.14.1.2 -> 127.0.0.1
nat on lo0 inet from 192.168.1.6 to 172.16.2.0/24 -> 127.0.0.1
nat on lo0 inet from 192.168.1.7 to 172.6.1.1 -> 127.0.0.1
nat on lo0 inet from 192.168.1.7 to 172.14.1.2 -> 127.0.0.1
nat on lo0 inet from 192.168.1.7 to 172.16.2.0/24 -> 127.0.0.1
nat on lo0 inet from 192.168.0.0/24 to any -> (lo0) round-robin
nat on lo0 inet from 192.168.1.8 to ! 172.17.0.0/16 -> 10.0.0.8
nat on ! lo0 inet proto udp all -> 10.0.0.8 static-port
nat on ! lo0 inet proto tcp all -> 10.0.0.8 static-port
nat on lo0 inet all -> 10.0.0.8
nat on tun1000000 inet all -> 10.0.0.8
@


1.9
log
@lo1, tun0, tun1 don't exist any more. thus, create the interfaces we need for
regress purposes before starting and destroy them afterwards.
lo1 -> lo1000000
tun0 -> tun1000000
tun1 -> tun1000001

ok markus@@
@
text
@d17 1
a17 1
nat on lo0 inet from 192.168.0.0/24 to any -> (lo0)
@


1.8
log
@Big Sync
@
text
@d22 1
a22 1
nat on tun0 inet all -> 10.0.0.8
@


1.7
log
@Add "static-port" to some of the nat rule tests.
@
text
@d3 1
a3 1
no nat on lo0 inet from 192.168.1.1 to 10.1.2.3 
@


1.6
log
@adjust after pfctl output changes
@
text
@d19 2
a20 2
nat on ! lo0 inet proto udp all -> 10.0.0.8
nat on ! lo0 inet proto tcp all -> 10.0.0.8
@


1.5
log
@Update for new semantics of set_ipmask (netmask is applied immediately
to an address by pfctl).
@
text
@d1 2
a2 2
TEST_LIST1 = { 192.168.1.5, 192.168.1.6, 192.168.1.7 }
TEST_LIST2 = { 172.6.1.1, 172.14.1.2/32, 172.16.2.0/24 }
@


1.4
log
@Expand {} lists from left to right, so 'pass in from { a, b } to any'
becomes '@@0 pass in from a to any @@1 pass in from b to any' instead of
the other way around. Patch from Camiel Dobbelaar.
@
text
@d17 1
a17 1
nat on lo0 inet from 192.168.0.1/24 to any -> (lo0)
@


1.3
log
@regression test for interface and proto list expansion in nat rules
@
text
@d8 8
a16 8
nat on lo0 inet from 192.168.1.7 to 172.14.1.2 -> 127.0.0.1
nat on lo0 inet from 192.168.1.7 to 172.6.1.1 -> 127.0.0.1
nat on lo0 inet from 192.168.1.6 to 172.16.2.0/24 -> 127.0.0.1
nat on lo0 inet from 192.168.1.6 to 172.14.1.2 -> 127.0.0.1
nat on lo0 inet from 192.168.1.6 to 172.6.1.1 -> 127.0.0.1
nat on lo0 inet from 192.168.1.5 to 172.16.2.0/24 -> 127.0.0.1
nat on lo0 inet from 192.168.1.5 to 172.14.1.2 -> 127.0.0.1
nat on lo0 inet from 192.168.1.5 to 172.6.1.1 -> 127.0.0.1
d19 1
d21 1
a21 1
nat on ! lo0 inet proto udp all -> 10.0.0.8
a22 1
nat on lo0 inet all -> 10.0.0.8
@


1.2
log
@regression test for NATing to dynamic addresses ( nat ... -> (if) )
ok dhartmei@@
@
text
@d19 4
@


1.1
log
@Use merged config file format. The separate NAT loop can go away,
since all files are now loaded the same way. Add regress tests for
invalid ordering of scrub, nat, filter rules
@
text
@d17 1
@

