head	1.12;
access;
symbols
	OPENBSD_6_2_BASE:1.12
	OPENBSD_6_1:1.12.0.4
	OPENBSD_6_1_BASE:1.12
	OPENBSD_6_0:1.9.0.2
	OPENBSD_6_0_BASE:1.9
	OPENBSD_5_9:1.8.0.2
	OPENBSD_5_9_BASE:1.8
	OPENBSD_5_8:1.4.0.4
	OPENBSD_5_8_BASE:1.4
	OPENBSD_5_7:1.2.0.4
	OPENBSD_5_7_BASE:1.2;
locks; strict;
comment	@# @;


1.12
date	2016.12.06.13.44.43;	author mpi;	state Exp;
branches;
next	1.11;
commitid	cSvgLlc8mXMP6TUn;

1.11
date	2016.09.01.11.36.15;	author bluhm;	state Exp;
branches;
next	1.10;
commitid	rHFpjLaRGad0GCRL;

1.10
date	2016.08.22.16.55.14;	author mpi;	state Exp;
branches;
next	1.9;
commitid	dkTZ6kk6d0ogYX88;

1.9
date	2016.07.19.10.47.39;	author mpi;	state Exp;
branches;
next	1.8;
commitid	0sWOCExGb92OBGf2;

1.8
date	2015.11.09.10.49.36;	author mpi;	state Exp;
branches;
next	1.7;
commitid	X0vWRjkoOCde8R5q;

1.7
date	2015.09.23.09.00.04;	author mpi;	state Exp;
branches;
next	1.6;
commitid	rdqUHuR3XgPi3cjy;

1.6
date	2015.09.07.19.48.50;	author mpi;	state Exp;
branches;
next	1.5;
commitid	t3lBEPCb3p8ehEei;

1.5
date	2015.08.31.08.34.46;	author mpi;	state Exp;
branches;
next	1.4;
commitid	bDuBRYQpFQ7YID6z;

1.4
date	2015.04.17.08.20.24;	author mpi;	state Exp;
branches;
next	1.3;
commitid	8Q9cpmSu2CXDDBwq;

1.3
date	2015.04.17.07.46.10;	author mpi;	state Exp;
branches;
next	1.2;
commitid	HIRzwnxdZPUcpYzW;

1.2
date	2015.01.27.10.16.22;	author mpi;	state Exp;
branches;
next	1.1;
commitid	eCcftfyY7LekTtme;

1.1
date	2014.11.26.11.55.08;	author mpi;	state Exp;
branches;
next	;
commitid	xB0RjjmJRYn2KAJc;


desc
@@


1.12
log
@Update to match recent changes.

IPv6 multicast "All Nodes Address" and "All Routers Address" routes are
now attached to the corresponding interface.

ok bluhm@@
@
text
@Routing tables

Internet6:
Destination                        Gateway                        Flags   Refs      Use   Mtu  Prio Iface
::1                                ::1                            UHl        0        2 32768     1 lo10001
fd88::1                            fd88::1                        UHl        0        0 32768     1 lo10002
fd88::666                          fd99::1                        UGHS       0        0  1500     8 lo10003
fd99::1                            fd99::1                        UHhl       1        2 32768     1 lo10003
fe80::1%lo10001                    fe80::1%lo10001                UHl        0        0 32768     1 lo10001
fe80::1%lo10002                    fe80::1%lo10002                UHl        0        0 32768     1 lo10002
fe80::1%lo10003                    fe80::1%lo10003                UHl        0        0 32768     1 lo10003
ff01::%lo10001/32                  ::1                            Um         0        1 32768     4 lo10001
ff01::%lo10002/32                  ::1                            Um         0        2 32768     4 lo10002
ff01::%lo10003/32                  ::1                            Um         0        2 32768     4 lo10003
ff02::%lo10001/32                  ::1                            Um         0        1 32768     4 lo10001
ff02::%lo10002/32                  ::1                            Um         0        2 32768     4 lo10002
ff02::%lo10003/32                  ::1                            Um         0        2 32768     4 lo10003
@


1.11
log
@Now the cached route flag appears in "route show".  Adapt test.
OK mpi@@
@
text
@d13 2
a14 2
ff01::%lo10002/32                  ::1                            Um         0        2 32768     4 lo10001
ff01::%lo10003/32                  ::1                            Um         0        2 32768     4 lo10001
d16 2
a17 2
ff02::%lo10002/32                  ::1                            Um         0        2 32768     4 lo10001
ff02::%lo10003/32                  ::1                            Um         0        2 32768     4 lo10001
@


1.10
log
@Sync counters now that ifa_ifwithroute() no longer uses ifa_ifwithnet().
@
text
@d8 1
a8 1
fd99::1                            fd99::1                        UHl        1        2 32768     1 lo10003
@


1.9
log
@Update counters & unbreak now that rtrequest(RTM_ADD, ...) caches the
gateway.
@
text
@d8 1
a8 1
fd99::1                            fd99::1                        UHl        1        1 32768     1 lo10003
@


1.8
log
@Match recent rtalloc(9) rewrite.

Gateway routes are now cached the first time they are used and no longer
when they are added.  This allows to track down which multipath route is
being selected as next-hop.
@
text
@d8 1
a8 1
fd99::1                            fd99::1                        UHl        0        0 32768     1 lo10003
d12 6
a17 6
ff01::%lo10001/32                  ::1                            UC         0        1 32768     4 lo10001
ff01::%lo10002/32                  ::1                            UC         0        2 32768     4 lo10001
ff01::%lo10003/32                  ::1                            UC         0        2 32768     4 lo10001
ff02::%lo10001/32                  ::1                            UC         0        1 32768     4 lo10001
ff02::%lo10002/32                  ::1                            UC         0        2 32768     4 lo10001
ff02::%lo10003/32                  ::1                            UC         0        2 32768     4 lo10001
@


1.7
log
@Sync with recent rt_use change.
@
text
@d8 1
a8 1
fd99::1                            fd99::1                        UHl        1        1 32768     1 lo10003
@


1.6
log
@Sync output with recent IPv6 loopback changes to ensure ::1 is the
first configured address.

Yes, IPv6 address configuration code is fragile and selecting the
first address of an interface to use it in a route entry might not
be the best choice.

Breakage reported by daniel@@
@
text
@d5 1
a5 1
::1                                ::1                            UHl        0        0 32768     1 lo10001
d8 1
a8 1
fd99::1                            fd99::1                        UHl        1        0 32768     1 lo10003
d12 6
a17 6
ff01::%lo10001/32                  ::1                            UC         0        0 32768     4 lo10001
ff01::%lo10002/32                  ::1                            UC         0        0 32768     4 lo10001
ff01::%lo10003/32                  ::1                            UC         0        0 32768     4 lo10001
ff02::%lo10001/32                  ::1                            UC         0        0 32768     4 lo10001
ff02::%lo10002/32                  ::1                            UC         0        0 32768     4 lo10001
ff02::%lo10003/32                  ::1                            UC         0        0 32768     4 lo10001
@


1.5
log
@No more connected routes on loopback interfaces.

Those tests now pass even if you have an AUTOCONF'd address on your machine.

Note that the global list of prefixes is *still* not rtable ID aware.
@
text
@d12 6
a17 6
ff01::%lo10001/32                  fe80::1%lo10001                UC         0        0 32768     4 lo10001
ff01::%lo10002/32                  fe80::1%lo10002                UC         0        0 32768     4 lo10002
ff01::%lo10003/32                  fe80::1%lo10003                UC         0        0 32768     4 lo10003
ff02::%lo10001/32                  fe80::1%lo10001                UC         0        0 32768     4 lo10001
ff02::%lo10002/32                  fe80::1%lo10002                UC         0        0 32768     4 lo10002
ff02::%lo10003/32                  fe80::1%lo10003                UC         0        0 32768     4 lo10003
@


1.4
log
@Remove superflous "::1" route, test currently failing but a fix is
in its way.
@
text
@a8 1
fe80::%lo10001/64                  fe80::1%lo10001                U          0        0 32768     4 lo10001
a9 1
fe80::%lo10002/64                  fe80::1%lo10002                U          0        0 32768     4 lo10002
a10 1
fe80::%lo10003/64                  fe80::1%lo10003                U          0        0 32768     4 lo10003
@


1.3
log
@Match -current output.  Every configured address should have a local route
and remove redundant loopback cloning route.

Note that tests using IPv6 still contain two routes to "::1" this should
cause no harm but is being investigated.
@
text
@a5 1
::1                                ::1                            UH         0        0 32768     4 lo10001
@


1.2
log
@Specify the default MTU size for routes to loopback.

Tests are currently failing, to be fixed soon.
@
text
@a6 1
fd88::/64                          fe80::1%lo10002                U          0        0 32768     4 lo10002
a8 1
fd99::/64                          fe80::1%lo10003                U          0        0 32768     4 lo10003
@


1.1
log
@Add 3 regression tests for "route change" dealing with -ifp, -ifa and
-mtu.  Triggered by a report from Florian Riehm on tech@@.

Note that two of these tests are using IPv6 addresses and expose another
bug with ::1.  I'll deal with this afterward unless someone else(tm)
fixes it.
@
text
@d7 2
a8 2
fd88::/64                          fe80::1%lo10002                U          0        0     -     4 lo10002
fd88::1                            fd88::1                        UHl        0        0     -     1 lo10002
d10 14
a23 14
fd99::/64                          fe80::1%lo10003                U          0        0     -     4 lo10003
fd99::1                            fd99::1                        UHl        1        0     -     1 lo10003
fe80::%lo10001/64                  fe80::1%lo10001                U          0        0     -     4 lo10001
fe80::1%lo10001                    fe80::1%lo10001                UHl        0        0     -     1 lo10001
fe80::%lo10002/64                  fe80::1%lo10002                U          0        0     -     4 lo10002
fe80::1%lo10002                    fe80::1%lo10002                UHl        0        0     -     1 lo10002
fe80::%lo10003/64                  fe80::1%lo10003                U          0        0     -     4 lo10003
fe80::1%lo10003                    fe80::1%lo10003                UHl        0        0     -     1 lo10003
ff01::%lo10001/32                  fe80::1%lo10001                UC         0        0     -     4 lo10001
ff01::%lo10002/32                  fe80::1%lo10002                UC         0        0     -     4 lo10002
ff01::%lo10003/32                  fe80::1%lo10003                UC         0        0     -     4 lo10003
ff02::%lo10001/32                  fe80::1%lo10001                UC         0        0     -     4 lo10001
ff02::%lo10002/32                  fe80::1%lo10002                UC         0        0     -     4 lo10002
ff02::%lo10003/32                  fe80::1%lo10003                UC         0        0     -     4 lo10003
@

