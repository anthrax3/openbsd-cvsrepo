head	1.2;
access;
symbols
	OPENBSD_6_2_BASE:1.2;
locks; strict;
comment	@# @;


1.2
date	2017.09.12.08.43.14;	author mpi;	state Exp;
branches;
next	1.1;
commitid	auQWekx6XOJfksKS;

1.1
date	2017.09.05.10.53.02;	author mpi;	state Exp;
branches;
next	;
commitid	ZhOjkaYy5aNOMehx;


desc
@@


1.2
log
@Sleep for some time to avoid race reporting a different number of reference
count.

Iterating over the routing table implies using SRP which bump the refcount
of routes for a short period of time.  Depending on how work is schedule
the second ifconfig(8) command might run before the timer dereference the
route.

Should fix races on bluhm@@'s test setup.
@
text
@Routing tables

Internet:
Destination        Gateway            Flags   Refs      Use   Mtu  Prio Iface
10.0/14            10.1.254.56        UCPn       0        3     -     4 vether99
10.0/14            10.1.255.1         CPn        0        0     -     4 vlan99
10.0/14            10.1.255.2         CPn        0        0     -     4 vlan99
10.0/14            10.1.255.3         CPn        0        0     -     4 vlan99
10.1.254.56        fe:e1:ba:d4:c8:1d  UHLl       0        0     -     1 vether99
10.1.255.1         fe:e1:ba:d4:c8:1d  UHLl       0        0     -     1 vlan99
10.1.255.2         fe:e1:ba:d4:c8:1d  UHLl       0        0     -     1 vlan99
10.1.255.3         fe:e1:ba:d4:c8:1d  UHLl       0        0     -     1 vlan99
10.3.255.255       10.1.254.56        UHPb       0        0     -     1 vether99
10.3.255.255       10.1.255.1         HPb        0        0     -     1 vlan99
10.3.255.255       10.1.255.2         HPb        0        0     -     1 vlan99
10.3.255.255       10.1.255.3         HPb        0        0     -     1 vlan99
192.0.2.1          192.0.2.1          UHl        0        0 32768     1 lo10001
192.0.2.2          192.0.2.2          UHl        0        0 32768     1 lo10002
192.0.2.3          192.0.2.3          UHl        0        0 32768     1 lo10003
192.0.2.4          192.0.2.4          UHl        0        0 32768     1 lo10004
@


1.1
log
@Test that all MPATH routes attached to an interface are taken down when
the link state change.

Issue reported by gerhard@@
@
text
@d6 3
a8 3
10.0/14            10.1.255.1         CPn        1        0     -     4 vlan99
10.0/14            10.1.255.2         CPn        1        0     -     4 vlan99
10.0/14            10.1.255.3         CPn        1        0     -     4 vlan99
d14 3
a16 3
10.3.255.255       10.1.255.1         HPb        1        0     -     1 vlan99
10.3.255.255       10.1.255.2         HPb        1        0     -     1 vlan99
10.3.255.255       10.1.255.3         HPb        1        0     -     1 vlan99
@

