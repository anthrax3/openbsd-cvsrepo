head	1.5;
access;
symbols
	OPENBSD_6_0:1.4.0.2
	OPENBSD_6_0_BASE:1.4
	OPENBSD_5_9:1.1.0.2
	OPENBSD_5_9_BASE:1.1;
locks; strict;
comment	@# @;


1.5
date	2016.09.18.21.06.46;	author bluhm;	state Exp;
branches;
next	1.4;
commitid	a8gtJciEMSKdUYV5;

1.4
date	2016.04.11.21.15.11;	author schwarze;	state Exp;
branches;
next	1.3;
commitid	jyYExBZQe6kHacko;

1.3
date	2016.03.20.17.19.48;	author schwarze;	state Exp;
branches;
next	1.2;
commitid	i7dvYVQoanOIP2WU;

1.2
date	2016.03.01.16.12.11;	author schwarze;	state Exp;
branches;
next	1.1;
commitid	WpEedg9ROj05L4FI;

1.1
date	2016.02.11.15.37.20;	author schwarze;	state Exp;
branches;
next	;
commitid	HXxulMOT7085CpbX;


desc
@@


1.5
log
@The libedit regress tests require header files generated during the
build.  Add a dependency to run make depend in /usr/src/lib/libedit.
Problem found by otto@@; OK schwarze@@
@
text
@#	$OpenBSD: Makefile,v 1.4 2016/04/11 21:15:11 schwarze Exp $
#
# Author: Ingo Schwarze <schwarze@@openbsd.org>, 2016.  Public Domain.

REGRESS_TARGETS = getcmd read_char

CPPFLAGS +=	-I${.CURDIR}/../../../../lib/libedit
CPPFLAGS +=	-I${.OBJDIR}/../../../../lib/libedit
CLEANFILES +=	test_read_char test_getcmd out_getcmd.txt

depend:
	cd ${.CURDIR}/../../../../lib/libedit && make depend

read_char: depend test_read_char
	sh ${.CURDIR}/test_read_char.sh

getcmd: depend test_getcmd
	echo -n s | ./test_getcmd > out_getcmd.txt
	diff -u ${.CURDIR}/exp_getcmd.txt out_getcmd.txt

.include <bsd.regress.mk>
@


1.4
log
@drop -DWIDECHAR, it's no longer needed
@
text
@d1 1
a1 1
#	$OpenBSD: Makefile,v 1.3 2016/03/20 17:19:48 schwarze Exp $
a3 2
#
# Run "cd /usr/src/lib/libedit && make obj && make depend" first.
d11 4
a14 1
read_char: test_read_char
d17 1
a17 1
getcmd: test_getcmd
@


1.3
log
@Fix the CHARSET_IS_UTF8 case in read_char().
For now, this mainly help programs explicitly using
wide-character functions like el_wgetc(3) and el_wgets(3).

1. After reading an invalid byte sequence, do not throw away additional
valid bytes; fix by me using mbrtowc(3), obsoleting utf8_islead().
2. When read(2) returns EOF, return that information to the caller,
do not prod on and potentially access garbage data in the buffer;
from Linas Vepstas via NetBSD read.c rev. 1.70 2013/05/27.
3. After read__fixio() failure, restore errno to the one set by read();
from Steffen Nurpmeso via NetBSD read.c rev. 1.68 2012/09/10.
4. After read__fixio() success, restore errno to the initial state
upon function entry; fix by me.

OK czarkoff@@.  Also committed to NetBSD.
@
text
@d1 1
a1 1
#	$OpenBSD: Makefile,v 1.2 2016/03/01 16:12:11 schwarze Exp $
a8 1
CPPFLAGS +=	-DWIDECHAR
@


1.2
log
@More unit tests for libedit.
Those that still fail are commented out in the Makefiles for now;
i have patches for them.
@
text
@d1 1
a1 1
#	$OpenBSD: Makefile,v 1.1 2016/02/11 15:37:20 schwarze Exp $
d7 1
a7 2
REGRESS_TARGETS = getcmd
#REGRESS_TARGETS += read_char
@


1.1
log
@Slowly start a unit test suite for libedit; Christos is right that
fiddling with the internals of that code is dangerous without it.
Intentionally not linked to the build yet, because many of the tests
still fail: The related bugfixes are too intrusive right now and will
go in after unlock.
@
text
@d1 1
a1 1
#	$OpenBSD$
d7 2
a8 1
REGRESS_TARGETS = check
a9 1
PROG =		test_read_char
d13 1
a13 1
MAN =
d15 1
a15 1
check:
d17 4
@

