head	1.1;
access;
symbols
	OPENBSD_6_0:1.1.0.8
	OPENBSD_6_0_BASE:1.1
	OPENBSD_5_9:1.1.0.2
	OPENBSD_5_9_BASE:1.1
	OPENBSD_5_8:1.1.0.6
	OPENBSD_5_8_BASE:1.1
	OPENBSD_5_7:1.1.0.4
	OPENBSD_5_7_BASE:1.1;
locks; strict;
comment	@# @;


1.1
date	2014.11.23.08.46.49;	author guenther;	state Exp;
branches;
next	;
commitid	liKRzPtz82V0rCuw;


desc
@@


1.1
log
@Add regress for atexit() vs DSO unloading and start on a similar test
for pthread_atfork()
@
text
@# $OpenBSD: Makefile,v 1.1.1.1 2007/07/31 20:31:42 kurt Exp $

.include <bsd.obj.mk>

AA_DIR=${.CURDIR}/../libaa
AA_OBJDIR!=    if [ -d $(AA_DIR)/${__objdir} ]; then \
                        echo "$(AA_DIR)/${__objdir}"; \
                else \
                        echo "$(AA_DIR)"; \
                fi

AB_DIR=${.CURDIR}/../libab
AB_OBJDIR!=    if [ -d $(AB_DIR)/${__objdir} ]; then \
                        echo "$(AB_DIR)/${__objdir}"; \
                else \
                        echo "$(AB_DIR)"; \
                fi

PROG=		atexit_test

SRCS=		atexit_test.c

CFLAGS+=	-DLIBAA="\"$(AA_OBJDIR)/libaa.so\""
CFLAGS+=	-DLIBAB="\"$(AB_OBJDIR)/libab.so\""
LDFLAGS+=	-Wl,-E

NOMAN=

regress-atexit: ${PROG}
	for i in 0 1 2 3; do \
		./${PROG} $$i || exit; \
		printf "finished $$i\n\n"; \
	done | cmp -s - ${.CURDIR}/expected.out

REGRESS_TARGETS=regress-atexit

install:

.include <bsd.regress.mk>
@
