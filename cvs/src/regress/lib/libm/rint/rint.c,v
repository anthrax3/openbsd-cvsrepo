head	1.10;
access;
symbols
	OPENBSD_6_2_BASE:1.10
	OPENBSD_6_1:1.10.0.26
	OPENBSD_6_1_BASE:1.10
	OPENBSD_6_0:1.10.0.22
	OPENBSD_6_0_BASE:1.10
	OPENBSD_5_9:1.10.0.12
	OPENBSD_5_9_BASE:1.10
	OPENBSD_5_8:1.10.0.20
	OPENBSD_5_8_BASE:1.10
	OPENBSD_5_7:1.10.0.18
	OPENBSD_5_7_BASE:1.10
	OPENBSD_5_6:1.10.0.16
	OPENBSD_5_6_BASE:1.10
	OPENBSD_5_5:1.10.0.14
	OPENBSD_5_5_BASE:1.10
	OPENBSD_5_4:1.10.0.10
	OPENBSD_5_4_BASE:1.10
	OPENBSD_5_3:1.10.0.8
	OPENBSD_5_3_BASE:1.10
	OPENBSD_5_2:1.10.0.6
	OPENBSD_5_2_BASE:1.10
	OPENBSD_5_1_BASE:1.10
	OPENBSD_5_1:1.10.0.4
	OPENBSD_5_0:1.10.0.2
	OPENBSD_5_0_BASE:1.10
	OPENBSD_4_9:1.7.0.10
	OPENBSD_4_9_BASE:1.7
	OPENBSD_4_8:1.7.0.8
	OPENBSD_4_8_BASE:1.7
	OPENBSD_4_7:1.7.0.4
	OPENBSD_4_7_BASE:1.7
	OPENBSD_4_6:1.7.0.6
	OPENBSD_4_6_BASE:1.7
	OPENBSD_4_5:1.7.0.2
	OPENBSD_4_5_BASE:1.7
	OPENBSD_4_4:1.6.0.12
	OPENBSD_4_4_BASE:1.6
	OPENBSD_4_3:1.6.0.10
	OPENBSD_4_3_BASE:1.6
	OPENBSD_4_2:1.6.0.8
	OPENBSD_4_2_BASE:1.6
	OPENBSD_4_1:1.6.0.6
	OPENBSD_4_1_BASE:1.6
	OPENBSD_4_0:1.6.0.4
	OPENBSD_4_0_BASE:1.6
	OPENBSD_3_9:1.6.0.2
	OPENBSD_3_9_BASE:1.6
	OPENBSD_3_8:1.4.0.10
	OPENBSD_3_8_BASE:1.4
	OPENBSD_3_7:1.4.0.8
	OPENBSD_3_7_BASE:1.4
	OPENBSD_3_6:1.4.0.6
	OPENBSD_3_6_BASE:1.4
	OPENBSD_3_5:1.4.0.4
	OPENBSD_3_5_BASE:1.4
	OPENBSD_3_4:1.4.0.2
	OPENBSD_3_4_BASE:1.4
	OPENBSD_3_3:1.1.0.2
	OPENBSD_3_3_BASE:1.1;
locks; strict;
comment	@ * @;


1.10
date	2011.04.10.17.06.44;	author martynas;	state Exp;
branches;
next	1.9;

1.9
date	2011.04.10.16.29.42;	author martynas;	state Exp;
branches;
next	1.8;

1.8
date	2011.04.10.11.10.09;	author martynas;	state Exp;
branches;
next	1.7;

1.7
date	2008.12.09.20.35.13;	author martynas;	state Exp;
branches;
next	1.6;

1.6
date	2005.11.17.20.16.26;	author otto;	state Exp;
branches;
next	1.5;

1.5
date	2005.11.17.20.09.59;	author otto;	state Exp;
branches;
next	1.4;

1.4
date	2003.09.02.23.52.17;	author david;	state Exp;
branches;
next	1.3;

1.3
date	2003.07.31.21.48.04;	author deraadt;	state Exp;
branches;
next	1.2;

1.2
date	2003.07.31.03.23.41;	author mickey;	state Exp;
branches;
next	1.1;

1.1
date	2003.02.12.07.05.34;	author mickey;	state Exp;
branches;
next	;


desc
@@


1.10
log
@tsk, float version of lrint is affected by a different bug, where
the corner cases would return zero--add some more tests.  assembly
versions on amd64 and i386 are fine.
@
text
@/*	$OpenBSD: rint.c,v 1.9 2011/04/10 16:29:42 martynas Exp $	*/

/*	Written by Michael Shalayeff, 2003,  Public domain.	*/

#include <assert.h>
#include <stdio.h>
#include <stdlib.h>
#include <string.h>
#include <signal.h>
#include <unistd.h>
#include <math.h>
#include <ieeefp.h>

static void
sigfpe(int sig, siginfo_t *si, void *v)
{
	char buf[132];

	if (si) {
		snprintf(buf, sizeof(buf), "sigfpe: addr=%p, code=%d\n",
		    si->si_addr, si->si_code);
		write(1, buf, strlen(buf));
	}
	_exit(1);
}

int
main(int argc, char *argv[])
{
	struct sigaction sa;

	memset(&sa, 0, sizeof(sa));
	sa.sa_sigaction = sigfpe;
	sa.sa_flags = SA_SIGINFO;
	sigaction(SIGFPE, &sa, NULL);

	assert(rint(8.6) == 9.);
	assert(rintf(8.6F) == 9);
	assert(rintl(8.6L) == 9);
 	assert(lrint(8.6) == 9L);
 	assert(lrintf(8.6F) == 9L);
 	assert(llrint(8.6) == 9LL);
 	assert(llrintf(8.6F) == 9LL);

	assert(lrint(0.0) == 0L);
	assert(lrintf(0.0) == 0L);
	assert(lrint(-0.0) == 0L);
	assert(lrintf(-0.0) == 0L);

	assert(llrint(4503599627370496.0) == 4503599627370496LL);
	assert(llrintf(4503599627370496.0F) == 4503599627370496LL);
	assert(llrint(-4503599627370496.0) == -4503599627370496LL);
	assert(llrintf(-4503599627370496.0F) == -4503599627370496LL);

	assert(llrint(0x7ffffffffffffc00.0p0) == 0x7ffffffffffffc00LL);
	assert(llrintf(0x7fffff8000000000.0p0F) == 0x7fffff8000000000LL);
	assert(llrint(-0x8000000000000000.0p0) == -0x8000000000000000LL);
	assert(llrintf(-0x8000000000000000.0p0F) == -0x8000000000000000LL);

	fpsetround(FP_RM);
	assert(lrint(-0.1) == -1L);
	assert(lrintf(-0.1) == -1L);

	fpsetround(FP_RP);
	assert(lrint(0.1) == 1L);
	assert(lrintf(0.1) == 1L);

	exit(0);
}
@


1.9
log
@add tests for yet-another bug of netbsd implementation of lrint.
i've added only couple of values, however the whole exponent range
of 52 is broken.
luckily amd64 and i386 aren't affected, since they use the assembly
versions which do the right thing.
@
text
@d1 1
a1 1
/*	$OpenBSD: rint.c,v 1.8 2011/04/10 11:10:09 martynas Exp $	*/
d50 9
a58 2
	assert(llrint(4503599627370496.0) == 4503599627370496L);
	assert(llrint(-4503599627370496.0) == -4503599627370496L);
@


1.8
log
@add tests for values zero, -zero;  and values close to zero with
-inf/+inf rounding modes.
@
text
@d1 1
a1 1
/*	$OpenBSD: rint.c,v 1.7 2008/12/09 20:35:13 martynas Exp $	*/
d49 3
@


1.7
log
@also test rintl
@
text
@d1 1
a1 1
/*	$OpenBSD: rint.c,v 1.6 2005/11/17 20:16:26 otto Exp $	*/
d5 1
a5 1
#include <err.h>
d12 1
d37 20
a56 14
	if (rint(8.6) != 9.)
		errx(1, "rint");
	if (rintf(8.6F) != 9)
		errx(1, "rintf");
	if (rintl(8.6L) != 9)
		errx(1, "rintl");
 	if (lrint(8.6) != 9L)
 		errx(1, "lrint");
 	if (lrintf(8.6F) != 9L)
 		errx(1, "lrintf");
 	if (llrint(8.6) != 9LL)
 		errx(1, "llrint");
 	if (llrintf(8.6F) != 9LL)
 		errx(1, "llrintf");
@


1.6
log
@errx is better here
@
text
@d1 1
a1 1
/*	$OpenBSD: rint.c,v 1.5 2005/11/17 20:09:59 otto Exp $	*/
d40 2
@


1.5
log
@Test a few more rint functions.
@
text
@d1 1
a1 1
/*	$OpenBSD: rint.c,v 1.4 2003/09/02 23:52:17 david Exp $	*/
d37 1
a37 1
		err(1, "rint");
d39 1
a39 1
		err(1, "rintf");
d41 1
a41 1
 		err(1, "lrint");
d43 1
a43 1
 		err(1, "lrintf");
d45 1
a45 1
 		err(1, "llrint");
d47 1
a47 1
 		err(1, "llrintf");
@


1.4
log
@add missing includes
ok deraadt@@ tedu@@ dhartmei@@ krw@@
@
text
@d1 1
a1 1
/*	$OpenBSD: rint.c,v 1.3 2003/07/31 21:48:04 deraadt Exp $	*/
d5 1
d37 11
a47 1
		exit(1);
@


1.3
log
@various cleanups; david says results are same
@
text
@d1 1
a1 1
/*	$OpenBSD: rint.c,v 1.2 2003/07/31 03:23:41 mickey Exp $	*/
d6 2
@


1.2
log
@fix the license
@
text
@d1 1
a1 1
/*	$OpenBSD: rint.c,v 1.1 2003/02/12 07:05:34 mickey Exp $	*/
d10 1
a10 1
void
d24 1
a24 1
main()
@


1.1
log
@a very simple rint() test. helped figure out fpu emulation probs on hppa
@
text
@d1 1
a1 1
/*	$OpenBSD$	*/
d3 1
a3 1
/*	Copyright (c) 2003 Michael Shalayeff. Public domain.	*/
@

