head	1.1;
access;
symbols
	OPENBSD_6_1_BASE:1.1;
locks; strict;
comment	@# @;


1.1
date	2016.09.13.18.54.08;	author florian;	state Exp;
branches;
next	;
commitid	nbvjKynz2o7ncaUj;


desc
@@


1.1
log
@First stab at acme-client regress test.
Someone who actually knows how this works please improve it :)
@
text
@REGRESS_TARGETS=acme

acme: start_httpd
	/usr/sbin/acme-client \
	    -C ${.OBJDIR}/www/acme \
	    -c ${.OBJDIR}/etc/ssl/acme \
	    -f ${.OBJDIR}/etc/acme/privkey.pem \
	    -k ${.OBJDIR}/etc/ssl/acme/private/privkey.pem \
	    -nNv -s letsencrypt-staging `hostname`
	/usr/sbin/acme-client \
	    -C ${.OBJDIR}/www/acme \
	    -c ${.OBJDIR}/etc/ssl/acme \
	    -f ${.OBJDIR}/etc/acme/privkey.pem \
	    -k ${.OBJDIR}/etc/ssl/acme/private/privkey.pem \
	    -rv -s letsencrypt-staging `hostname`
	pkill -xf "/usr/sbin/httpd -f ${.OBJDIR}/etc/httpd.conf"

start_httpd:
	sh ${.CURDIR}/create-httpd-env.sh ${.OBJDIR}
	/bin/echo `/bin/hostname`
	/usr/sbin/httpd -f ${.OBJDIR}/etc/httpd.conf
	sleep .1 # give httpd some time to spin up
	pgrep -xf "/usr/sbin/httpd -f ${.OBJDIR}/etc/httpd.conf"

.PHONY: ${REGRESS_TARGETS} start_httpd

.include <bsd.regress.mk>
@
