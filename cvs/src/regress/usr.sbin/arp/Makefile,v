head	1.3;
access;
symbols
	OPENBSD_6_2:1.3.0.4
	OPENBSD_6_2_BASE:1.3
	OPENBSD_6_1:1.2.0.6
	OPENBSD_6_1_BASE:1.2
	OPENBSD_6_0:1.2.0.2
	OPENBSD_6_0_BASE:1.2;
locks; strict;
comment	@# @;


1.3
date	2017.07.07.23.55.21;	author bluhm;	state Exp;
branches;
next	1.2;
commitid	HPFM3FepOktcWNt0;

1.2
date	2016.03.24.15.15.41;	author mpi;	state Exp;
branches;
next	1.1;
commitid	uRWqTchfbzeYOZbM;

1.1
date	2016.03.23.08.58.32;	author mpi;	state Exp;
branches;
next	;
commitid	ydpYAFF2gcmEZ8XA;


desc
@@


1.3
log
@Remove all references to "make depend" from regress.
@
text
@# $OpenBSD: Makefile,v 1.2 2016/03/24 15:15:41 mpi Exp $

RDOMAIN?=	5
VETHER_MAC=	fe:e1:ba:d2:a3:18
PRIV_MAC=	00:90:27:bb:cc:dd
PUB_MAC=	fe:88:33:11:bb:aa
OTHER_MAC=	cc:77:55:22:aa:66

.MAIN: all

.ifmake !obj && !clean && !cleandir && !regress
.if (${.TARGET} != all && ! make(all)) || (${.TARGET} == all)

.SILENT: .BEGIN .END .INTERRUPT

.BEGIN:
	-${SUDO} ifconfig vether10001 up lladdr ${VETHER_MAC} \
		rdomain ${RDOMAIN} 192.0.2.1/24

.END:
	-${SUDO} ifconfig vether10001 destroy

.INTERRUPT:
	-${SUDO} ifconfig vether10001 destroy

.endif
.endif

ARP=		${SUDO} arp -n -V ${RDOMAIN}

# Two entries to the same destination are ok if one is "pub"
n=	1
RTTEST_TARGETS+:=arptest${n}
arptest${n}:
	${ARP} -s 192.0.2.42 ${PRIV_MAC}
	${ARP} -s 192.0.2.42 ${PUB_MAC} pub
	${ARP} -a 2>&1| \
		diff -u ${.CURDIR}/${.TARGET}.ok /dev/stdin

# Insert the "pub" entry first, it should not matter
n=	2
RTTEST_TARGETS+:=arptest${n}
arptest${n}:
	${ARP} -s 192.0.2.42 ${PUB_MAC} pub
	${ARP} -s 192.0.2.42 ${PRIV_MAC}
	${ARP} -a 2>&1| \
		diff -u ${.CURDIR}/${.TARGET}.ok /dev/stdin

# Not specifying "pub" should generate an error
n=	3
RTTEST_TARGETS+:=arptest${n}
arptest${n}:
	${ARP} -s 192.0.2.42 ${PRIV_MAC}
	${ARP} -s 192.0.2.42 ${PUB_MAC} && exit 1 || exit 0
	${ARP} -a 2>&1| \
		diff -u ${.CURDIR}/${.TARGET}.ok /dev/stdin

# Not specifying "pub" works only if "-F" is specified
n=	4
RTTEST_TARGETS+:=arptest${n}
arptest${n}:
	${ARP} -s 192.0.2.42 ${PRIV_MAC}
	${ARP} -Fs 192.0.2.42 ${PUB_MAC}
	${ARP} -a 2>&1 | \
		diff -u ${.CURDIR}/${.TARGET}.ok /dev/stdin

# Test that "permanent" entries are correctly created
n=	5
RTTEST_TARGETS+:=arptest${n}
arptest${n}:
	${ARP} -s 192.0.2.42 ${PRIV_MAC} "permanent"
	${ARP} -a 2>&1 | \
		diff -u ${.CURDIR}/${.TARGET}.ok /dev/stdin

# Tryin to add two "pub" entries should generate and error
n=	6
RTTEST_TARGETS+:=arptest${n}
arptest${n}:
	${ARP} -s 192.0.2.42 ${PRIV_MAC}
	${ARP} -s 192.0.2.42 ${PUB_MAC} pub
	${ARP} -s 192.0.2.42 ${OTHER_MAC} pub && exit 1 || exit 0
	${ARP} -a 2>&1| \
		diff -u ${.CURDIR}/${.TARGET}.ok /dev/stdin

REGRESS_TARGETS=${RTTEST_TARGETS}
REGRESS_ROOT_TARGETS=${REGRESS_TARGETS}
.PHONY: ${REGRESS_TARGETS}

.include <bsd.regress.mk>
@


1.2
log
@Check that only one published entry can be added.
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.1 2016/03/23 08:58:32 mpi Exp $
d11 1
a11 1
.ifmake !obj && !clean && !cleandir && !depend && !regress
@


1.1
log
@arp(8) regression tests, some of which are currently failing with ART.
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.10 2015/12/02 11:05:35 mpi Exp $
d7 1
d73 10
@

