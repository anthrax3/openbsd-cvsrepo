head	1.3;
access;
symbols
	OPENBSD_6_2:1.3.0.18
	OPENBSD_6_2_BASE:1.3
	OPENBSD_6_1:1.3.0.16
	OPENBSD_6_1_BASE:1.3
	OPENBSD_6_0:1.3.0.12
	OPENBSD_6_0_BASE:1.3
	OPENBSD_5_9:1.3.0.2
	OPENBSD_5_9_BASE:1.3
	OPENBSD_5_8:1.3.0.10
	OPENBSD_5_8_BASE:1.3
	OPENBSD_5_7:1.3.0.8
	OPENBSD_5_7_BASE:1.3
	OPENBSD_5_6:1.3.0.6
	OPENBSD_5_6_BASE:1.3
	OPENBSD_5_5:1.3.0.4
	OPENBSD_5_5_BASE:1.3;
locks; strict;
comment	@# @;


1.3
date	2014.01.31.10.28.18;	author espie;	state Exp;
branches;
next	1.2;

1.2
date	2014.01.31.10.18.35;	author espie;	state Exp;
branches;
next	1.1;

1.1
date	2014.01.31.10.13.13;	author espie;	state Exp;
branches;
next	;


desc
@@


1.3
log
@fix number of tests
@
text
@#! /usr/bin/perl
# $OpenBSD: check-cfl,v 1.2 2014/01/31 10:18:35 espie Exp $
# Written by Marc Espie
# Public domain

use strict;
use warnings;
use Test::Simple tests => 4;

use OpenBSD::PkgCfl;
use OpenBSD::PackingList;
use OpenBSD::PackingElement;

sub check_list
{
	my $expected = shift;
	my @@r = sort(@@$expected);
	@@_ = sort(@@_);
	if (@@r != @@_) {
		print STDERR "length: ", scalar(@@r)," vs. ", 
		    scalar(@@_), "\n";
		    print STDERR "Expected: ", join(',', @@r), "\n";
		    print STDERR "Result: ", join(',', @@_), "\n";
		return 0;
	}
	for my $i (0 .. @@_ -1) {
		if ($r[$i] ne $_[$i]) {
			print STDERR "$r[$i] vs. $_[$i]\n";
			return 0;
		}
	}
	return 1;
}

sub check_conflict
{
	my ($plist, @@list) = @@_;
	my $cfl = OpenBSD::PkgCfl->make_conflict_list($plist);
	return $cfl->conflicts_with(@@list);
}


my $p1 = OpenBSD::PackingList->new;
OpenBSD::PackingElement::Name->add($p1, "foo-1.0");

my @@l1 = qw(foo-2.0 partial-foo-2.5 bar-2.0 bar-1.5 buz-1.0 .libs-buz-0.0);
my @@r1 = qw(foo-2.0 partial-foo-2.5);
ok(check_list(\@@r1, check_conflict($p1, @@l1)));

my $p2 = OpenBSD::PackingList->new;
OpenBSD::PackingElement::Name->add($p2, "bar-2.0");
OpenBSD::PackingElement::NoDefaultConflict->add($p2);
my @@r2 = qw(bar-2.0);
ok(check_list(\@@r2, check_conflict($p2, @@l1)));

my $p3 = OpenBSD::PackingList->new;
OpenBSD::PackingElement::Name->add($p3, "buz-2.5");
OpenBSD::PackingElement::Conflict->add($p3, "bar->=2");

my @@r3 = qw(bar-2.0 buz-1.0 .libs-buz-0.0);
ok(check_list(\@@r3, check_conflict($p3, @@l1)));

my @@l2 = qw(partial-foo-2.5 partial-partial-foo-2.10 bar-2.0 bar-1.5 buz-1.0 .libs-buz-0.0);
my @@r4 = qw(partial-foo-2.5 partial-partial-foo-2.10);
ok(check_list(\@@r4, check_conflict($p1, @@l2)));
@


1.2
log
@partial-partial-* stuff not yet working
@
text
@d2 1
a2 1
# $OpenBSD: check-cfl,v 1.1 2014/01/31 10:13:13 espie Exp $
d8 1
a8 1
use Test::Simple tests => 3;
d22 2
a23 2
		    print STDERR join(',', @@r), "\n";
		    print STDERR join(',', @@_), "\n";
@


1.1
log
@basic check for pkg names conflicts, to be augmented
@
text
@d2 1
a2 1
# $OpenBSD$
d8 1
a8 1
use Test::Simple tests => 2;
d17 1
d19 2
a20 2
	if (@@$expected != @@_) {
		print STDERR "length: ", scalar(@@$expected)," vs. ", 
d22 1
a22 1
		    print STDERR join(',', @@$expected), "\n";
d27 2
a28 2
		if ($expected->[$i] ne $_[$i]) {
			print STDERR "$expected->[$i] vs. $_[$i]\n";
d46 1
a46 1
my @@l1 = qw(foo-2.0 partial-foo-2.5 bar-2.0 bar-1.5);
d55 11
@

