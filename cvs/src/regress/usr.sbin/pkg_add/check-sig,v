head	1.3;
access;
symbols
	OPENBSD_6_1_BASE:1.3
	OPENBSD_6_0:1.3.0.8
	OPENBSD_6_0_BASE:1.3
	OPENBSD_5_9:1.3.0.2
	OPENBSD_5_9_BASE:1.3
	OPENBSD_5_8:1.3.0.6
	OPENBSD_5_8_BASE:1.3
	OPENBSD_5_7:1.3.0.4
	OPENBSD_5_7_BASE:1.3
	OPENBSD_5_6:1.2.0.22
	OPENBSD_5_6_BASE:1.2
	OPENBSD_5_5:1.2.0.20
	OPENBSD_5_5_BASE:1.2
	OPENBSD_5_4:1.2.0.16
	OPENBSD_5_4_BASE:1.2
	OPENBSD_5_3:1.2.0.14
	OPENBSD_5_3_BASE:1.2
	OPENBSD_5_2:1.2.0.12
	OPENBSD_5_2_BASE:1.2
	OPENBSD_5_1_BASE:1.2
	OPENBSD_5_1:1.2.0.10
	OPENBSD_5_0:1.2.0.8
	OPENBSD_5_0_BASE:1.2
	OPENBSD_4_9:1.2.0.6
	OPENBSD_4_9_BASE:1.2
	OPENBSD_4_8:1.2.0.4
	OPENBSD_4_8_BASE:1.2
	OPENBSD_4_7:1.2.0.2
	OPENBSD_4_7_BASE:1.2;
locks; strict;
comment	@# @;


1.3
date	2014.08.27.18.45.57;	author kspillner;	state Exp;
branches;
next	1.2;
commitid	QuvJCRno8Tquo0Qa;

1.2
date	2010.01.10.12.41.20;	author espie;	state Exp;
branches;
next	1.1;

1.1
date	2010.01.10.11.49.56;	author espie;	state Exp;
branches;
next	;


desc
@@


1.3
log
@Remove $_ usage that warns under Perl 5.18.

Yep espie@@
@
text
@#! /usr/bin/perl
# $OpenBSD: check-sig,v 1.2 2010/01/10 12:41:20 espie Exp $
# Written by Marc Espie
# Public domain

use Test::Simple tests => 11;
use OpenBSD::PackingList;
sub mycode
{
	my ($fh, $cont) = @@_;
	while (<$fh>) {
		return if m/^__END__/;
		&$cont($_);
	}
}

my @@sig;
my $fh = \*DATA;
for my $i (1..7) {
	push(@@sig, OpenBSD::PackingList->read($fh, \&mycode)->signature);
}

ok($sig[0]->compare($sig[0]) == 0, "self compare");
ok($sig[3]->compare($sig[3]) == 0, "self compare");
ok($sig[5]->compare($sig[5]) == 0, "self compare");
ok(!defined($sig[0]->compare($sig[3])), "non comparable");
ok($sig[0]->compare($sig[1]) < 0, "depend");
ok($sig[0]->compare($sig[2]) < 0, "pkgname");
ok($sig[1]->compare($sig[0]) > 0, "other way");
ok($sig[3]->compare($sig[4]) < 0, "lib");
ok($sig[3]->compare($sig[5]) < 0, "depend");
ok(!defined($sig[0]->compare($sig[6])), "non comparable");
ok(!defined($sig[6]->compare($sig[0])), "non comparable");

__DATA__
@@name foo-1.0
@@depend test/x:x-*:x-1.0
file
__END__ #1
@@name foo-1.0
@@depend test/x:x-*:x-2.0
file
__END__ #2
@@name foo-2.0
@@depend test/x:x-*:x-2.0
file
__END__ #3
@@name bar-1.0
@@depend test/x:x-*:x-1.0
@@wantlib a.1.5
__END__ #4
@@name bar-1.0
@@depend test/x:x-*:x-1.0
@@wantlib a.2.0
__END__ #5
@@name bar-1.0
@@depend test/x:x-*:x-2.0
@@wantlib a.1.5
__END__ #6
@@name foo-1.0
@@depend test/x:x-*:x-1.0
@@depend test/y:y-*:y-2.0
@


1.2
log
@more signatures checks
@
text
@d2 1
a2 1
# $OpenBSD: check-sig,v 1.1 2010/01/10 11:49:56 espie Exp $
a10 1
	my $_;
@


1.1
log
@add REGRESSION_TESTING markers so tests still run.
new test for signature comparison checks
@
text
@d2 1
a2 1
# $OpenBSD$
d6 1
a6 1
use Test::Simple tests => 9;
d20 1
a20 1
for my $i (1..6) {
d33 2
d60 4
a63 1
__END__
@

