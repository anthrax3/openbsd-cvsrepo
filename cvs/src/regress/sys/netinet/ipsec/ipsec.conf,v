head	1.6;
access;
symbols
	OPENBSD_6_1:1.4.0.4
	OPENBSD_6_1_BASE:1.4
	bluhm_20170206:1.1.1.1
	bluhm:1.1.1;
locks; strict;
comment	@# @;


1.6
date	2017.05.04.22.10.39;	author bluhm;	state Exp;
branches;
next	1.5;
commitid	B9GXpSlYYH57oEqj;

1.5
date	2017.04.14.19.03.50;	author bluhm;	state Exp;
branches;
next	1.4;
commitid	jXheFZtkXlZaAz76;

1.4
date	2017.02.27.16.53.59;	author bluhm;	state Exp;
branches;
next	1.3;
commitid	1etDVlj4DY6lAghO;

1.3
date	2017.02.13.17.54.27;	author bluhm;	state Exp;
branches;
next	1.2;
commitid	QdZDDgO8zyidhhiV;

1.2
date	2017.02.08.17.58.59;	author bluhm;	state Exp;
branches;
next	1.1;
commitid	EEeNxU6pA9OS6i77;

1.1
date	2017.02.06.21.54.05;	author bluhm;	state Exp;
branches
	1.1.1.1;
next	;
commitid	ymImhD4qA3SEDVJy;

1.1.1.1
date	2017.02.06.21.54.05;	author bluhm;	state Exp;
branches;
next	;
commitid	ymImhD4qA3SEDVJy;


desc
@@


1.6
log
@Add IPsec test for manually configured SA bundles.  That does ipcomp,
and esp, and ah with one flow and three SAs in one step.  Test
transport mode, locally terminated tunnel and forwarding packets
from and to tunnel.
@
text
@#	$OpenBSD: ipsec.conf,v 1.5 2017/04/14 19:03:50 bluhm Exp $
### regress ipsec ipsec.conf

# Install symmetric config by exchanging local and peer keywords.
FROM="from"
TO="to"
LOCAL="local"
PEER="peer"

## ESP

# ESP TRANSP

flow esp \
	$FROM	$SRC_ESP_TRANSP_IPV4	$TO	$IPS_ESP_TRANSP_IPV4 \
	$LOCAL	$SRC_ESP_TRANSP_IPV4	$PEER	$IPS_ESP_TRANSP_IPV4 \
	type	dontacq
flow esp \
	$FROM	$SRC_ESP_TRANSP_IPV6	$TO	$IPS_ESP_TRANSP_IPV6 \
	$LOCAL	$SRC_ESP_TRANSP_IPV6	$PEER	$IPS_ESP_TRANSP_IPV6 \
	type	dontacq

# ESP TRANSP SA

esp transport \
	from	$SRC_ESP_TRANSP_IPV4	to	$IPS_ESP_TRANSP_IPV4 \
	spi	0x10000441:0x10000442 \
	authkey	0x0123456789abcdef0123456789abcdef0123456789abcdef0123456789abcdef:0x0123456789abcdef0123456789abcdef0123456789abcdef0123456789abcdef \
	enckey	0x0123456789abcdef0123456789abcdef0123456789abcdef0123456789abcdef:0x0123456789abcdef0123456789abcdef0123456789abcdef0123456789abcdef

esp transport \
	from	$SRC_ESP_TRANSP_IPV6	to	$IPS_ESP_TRANSP_IPV6 \
	spi	0x10000461:0x10000462 \
	authkey	0x0123456789abcdef0123456789abcdef0123456789abcdef0123456789abcdef:0x0123456789abcdef0123456789abcdef0123456789abcdef0123456789abcdef \
	enckey	0x0123456789abcdef0123456789abcdef0123456789abcdef0123456789abcdef:0x0123456789abcdef0123456789abcdef0123456789abcdef0123456789abcdef

# ESP TUNNEL IPS

flow esp \
	$FROM	$SRC_ESP_TUNNEL_IPV4/24	$TO	$IPS_ESP_TUNNEL4_IPV4/24 \
	$LOCAL	$SRC_OUT_IPV4		$PEER	$IPS_IN_IPV4 \
	type	dontacq
flow esp \
	$FROM	$SRC_ESP_TUNNEL_IPV6/64	$TO	$IPS_ESP_TUNNEL4_IPV6/64 \
	$LOCAL	$SRC_OUT_IPV4		$PEER	$IPS_IN_IPV4 \
	type	dontacq

flow esp \
	$FROM	$SRC_ESP_TUNNEL_IPV4/24	$TO	$IPS_ESP_TUNNEL6_IPV4/24 \
	$LOCAL	$SRC_OUT_IPV6		$PEER	$IPS_IN_IPV6 \
	type	dontacq
flow esp \
	$FROM	$SRC_ESP_TUNNEL_IPV6/64	$TO	$IPS_ESP_TUNNEL6_IPV6/64 \
	$LOCAL	$SRC_OUT_IPV6		$PEER	$IPS_IN_IPV6 \
	type	dontacq

# ESP TUNNEL ECO

flow esp \
	$FROM	$SRC_ESP_TUNNEL_IPV4/24	$TO	$ECO_ESP_TUNNEL4_IPV4/24 \
	$LOCAL	$SRC_OUT_IPV4		$PEER	$IPS_IN_IPV4 \
	type	dontacq
flow esp \
	$FROM	$SRC_ESP_TUNNEL_IPV6/64	$TO	$ECO_ESP_TUNNEL4_IPV6/64 \
	$LOCAL	$SRC_OUT_IPV4		$PEER	$IPS_IN_IPV4 \
	type	dontacq

flow esp \
	$FROM	$SRC_ESP_TUNNEL_IPV4/24	$TO	$ECO_ESP_TUNNEL6_IPV4/24 \
	$LOCAL	$SRC_OUT_IPV6		$PEER	$IPS_IN_IPV6 \
	type	dontacq
flow esp \
	$FROM	$SRC_ESP_TUNNEL_IPV6/64	$TO	$ECO_ESP_TUNNEL6_IPV6/64 \
	$LOCAL	$SRC_OUT_IPV6		$PEER	$IPS_IN_IPV6 \
	type	dontacq

# ESP TUNNEL SA

esp tunnel \
	from	$SRC_OUT_IPV4	to	$IPS_IN_IPV4 \
	spi	0x10000841:0x10000842 \
	authkey	0x0123456789abcdef0123456789abcdef0123456789abcdef0123456789abcdef:0x0123456789abcdef0123456789abcdef0123456789abcdef0123456789abcdef \
	enckey	0x0123456789abcdef0123456789abcdef0123456789abcdef0123456789abcdef:0x0123456789abcdef0123456789abcdef0123456789abcdef0123456789abcdef

esp tunnel \
	from	$SRC_OUT_IPV6	to	$IPS_IN_IPV6 \
	spi	0x10000861:0x10000862 \
	authkey	0x0123456789abcdef0123456789abcdef0123456789abcdef0123456789abcdef:0x0123456789abcdef0123456789abcdef0123456789abcdef0123456789abcdef \
	enckey	0x0123456789abcdef0123456789abcdef0123456789abcdef0123456789abcdef:0x0123456789abcdef0123456789abcdef0123456789abcdef0123456789abcdef

## AH

# AH TRANSP

flow ah \
	$FROM	$SRC_AH_TRANSP_IPV4	$TO	$IPS_AH_TRANSP_IPV4 \
	$LOCAL	$SRC_AH_TRANSP_IPV4	$PEER	$IPS_AH_TRANSP_IPV4 \
	type	dontacq
flow ah \
	$FROM	$SRC_AH_TRANSP_IPV6	$TO	$IPS_AH_TRANSP_IPV6 \
	$LOCAL	$SRC_AH_TRANSP_IPV6	$PEER	$IPS_AH_TRANSP_IPV6 \
	type	dontacq

# AH TRANSP SA

ah transport \
	from	$SRC_AH_TRANSP_IPV4	to	$IPS_AH_TRANSP_IPV4 \
	spi	0x10002441:0x10002442 \
	authkey	0x0123456789abcdef0123456789abcdef0123456789abcdef0123456789abcdef:0x0123456789abcdef0123456789abcdef0123456789abcdef0123456789abcdef \
	enckey	0x0123456789abcdef0123456789abcdef0123456789abcdef0123456789abcdef:0x0123456789abcdef0123456789abcdef0123456789abcdef0123456789abcdef

ah transport \
	from	$SRC_AH_TRANSP_IPV6	to	$IPS_AH_TRANSP_IPV6 \
	spi	0x10002461:0x10002462 \
	authkey	0x0123456789abcdef0123456789abcdef0123456789abcdef0123456789abcdef:0x0123456789abcdef0123456789abcdef0123456789abcdef0123456789abcdef \
	enckey	0x0123456789abcdef0123456789abcdef0123456789abcdef0123456789abcdef:0x0123456789abcdef0123456789abcdef0123456789abcdef0123456789abcdef

# AH TUNNEL IPS

flow ah \
	$FROM	$SRC_AH_TUNNEL_IPV4/24	$TO	$IPS_AH_TUNNEL4_IPV4/24 \
	$LOCAL	$SRC_OUT_IPV4		$PEER	$IPS_IN_IPV4 \
	type	dontacq
flow ah \
	$FROM	$SRC_AH_TUNNEL_IPV6/64	$TO	$IPS_AH_TUNNEL4_IPV6/64 \
	$LOCAL	$SRC_OUT_IPV4		$PEER	$IPS_IN_IPV4 \
	type	dontacq

flow ah \
	$FROM	$SRC_AH_TUNNEL_IPV4/24	$TO	$IPS_AH_TUNNEL6_IPV4/24 \
	$LOCAL	$SRC_OUT_IPV6		$PEER	$IPS_IN_IPV6 \
	type	dontacq
flow ah \
	$FROM	$SRC_AH_TUNNEL_IPV6/64	$TO	$IPS_AH_TUNNEL6_IPV6/64 \
	$LOCAL	$SRC_OUT_IPV6		$PEER	$IPS_IN_IPV6 \
	type	dontacq

# AH TUNNEL ECO

flow ah \
	$FROM	$SRC_AH_TUNNEL_IPV4/24	$TO	$ECO_AH_TUNNEL4_IPV4/24 \
	$LOCAL	$SRC_OUT_IPV4		$PEER	$IPS_IN_IPV4 \
	type	dontacq
flow ah \
	$FROM	$SRC_AH_TUNNEL_IPV6/64	$TO	$ECO_AH_TUNNEL4_IPV6/64 \
	$LOCAL	$SRC_OUT_IPV4		$PEER	$IPS_IN_IPV4 \
	type	dontacq

flow ah \
	$FROM	$SRC_AH_TUNNEL_IPV4/24	$TO	$ECO_AH_TUNNEL6_IPV4/24 \
	$LOCAL	$SRC_OUT_IPV6		$PEER	$IPS_IN_IPV6 \
	type	dontacq
flow ah \
	$FROM	$SRC_AH_TUNNEL_IPV6/64	$TO	$ECO_AH_TUNNEL6_IPV6/64 \
	$LOCAL	$SRC_OUT_IPV6		$PEER	$IPS_IN_IPV6 \
	type	dontacq

# AH TUNNEL SA

ah tunnel \
	from	$SRC_OUT_IPV4	to	$IPS_IN_IPV4 \
	spi	0x10002841:0x10002842 \
	authkey	0x0123456789abcdef0123456789abcdef0123456789abcdef0123456789abcdef:0x0123456789abcdef0123456789abcdef0123456789abcdef0123456789abcdef \
	enckey	0x0123456789abcdef0123456789abcdef0123456789abcdef0123456789abcdef:0x0123456789abcdef0123456789abcdef0123456789abcdef0123456789abcdef

ah tunnel \
	from	$SRC_OUT_IPV6	to	$IPS_IN_IPV6 \
	spi	0x10002861:0x10002862 \
	authkey	0x0123456789abcdef0123456789abcdef0123456789abcdef0123456789abcdef:0x0123456789abcdef0123456789abcdef0123456789abcdef0123456789abcdef \
	enckey	0x0123456789abcdef0123456789abcdef0123456789abcdef0123456789abcdef:0x0123456789abcdef0123456789abcdef0123456789abcdef0123456789abcdef

## IPIP

# IPIP TRANSP

flow ipip \
	$FROM	$SRC_IPIP_TRANSP_IPV4	$TO	$IPS_IPIP_TRANSP_IPV4 \
	$LOCAL	$SRC_IPIP_TRANSP_IPV4	$PEER	$IPS_IPIP_TRANSP_IPV4 \
	type	use
flow ipip \
	$FROM	$SRC_IPIP_TRANSP_IPV6	$TO	$IPS_IPIP_TRANSP_IPV6 \
	$LOCAL	$SRC_IPIP_TRANSP_IPV6	$PEER	$IPS_IPIP_TRANSP_IPV6 \
	type	use

# IPIP TRANSP SA

ipip transport \
	from	$SRC_IPIP_TRANSP_IPV4	to	$IPS_IPIP_TRANSP_IPV4 \
	spi	0x10004441:0x10004442

ipip transport \
	from	$SRC_IPIP_TRANSP_IPV6	to	$IPS_IPIP_TRANSP_IPV6 \
	spi	0x10004461:0x10004462

# IPIP TUNNEL IPS

flow ipip \
	$FROM	$SRC_IPIP_TUNNEL_IPV4/24	$TO	$IPS_IPIP_TUNNEL4_IPV4/24 \
	$LOCAL	$SRC_OUT_IPV4		$PEER	$IPS_IN_IPV4 \
	type	use
flow ipip \
	$FROM	$SRC_IPIP_TUNNEL_IPV6/64	$TO	$IPS_IPIP_TUNNEL4_IPV6/64 \
	$LOCAL	$SRC_OUT_IPV4		$PEER	$IPS_IN_IPV4 \
	type	use

flow ipip \
	$FROM	$SRC_IPIP_TUNNEL_IPV4/24	$TO	$IPS_IPIP_TUNNEL6_IPV4/24 \
	$LOCAL	$SRC_OUT_IPV6		$PEER	$IPS_IN_IPV6 \
	type	use
flow ipip \
	$FROM	$SRC_IPIP_TUNNEL_IPV6/64	$TO	$IPS_IPIP_TUNNEL6_IPV6/64 \
	$LOCAL	$SRC_OUT_IPV6		$PEER	$IPS_IN_IPV6 \
	type	use

# IPIP TUNNEL ECO

flow ipip \
	$FROM	$SRC_IPIP_TUNNEL_IPV4/24	$TO	$ECO_IPIP_TUNNEL4_IPV4/24 \
	$LOCAL	$SRC_OUT_IPV4		$PEER	$IPS_IN_IPV4 \
	type	use
flow ipip \
	$FROM	$SRC_IPIP_TUNNEL_IPV6/64	$TO	$ECO_IPIP_TUNNEL4_IPV6/64 \
	$LOCAL	$SRC_OUT_IPV4		$PEER	$IPS_IN_IPV4 \
	type	use

flow ipip \
	$FROM	$SRC_IPIP_TUNNEL_IPV4/24	$TO	$ECO_IPIP_TUNNEL6_IPV4/24 \
	$LOCAL	$SRC_OUT_IPV6		$PEER	$IPS_IN_IPV6 \
	type	use
flow ipip \
	$FROM	$SRC_IPIP_TUNNEL_IPV6/64	$TO	$ECO_IPIP_TUNNEL6_IPV6/64 \
	$LOCAL	$SRC_OUT_IPV6		$PEER	$IPS_IN_IPV6 \
	type	use

# IPIP TUNNEL SA

ipip tunnel \
	from	$SRC_OUT_IPV4	to	$IPS_IN_IPV4 \
	spi	0x10004841:0x10004842

ipip tunnel \
	from	$SRC_OUT_IPV6	to	$IPS_IN_IPV6 \
	spi	0x10004861:0x10004862

## IPCOMP

# IPCOMP TRANSP

flow ipcomp \
	$FROM	$SRC_IPCOMP_TRANSP_IPV4	$TO	$IPS_IPCOMP_TRANSP_IPV4 \
	$LOCAL	$SRC_IPCOMP_TRANSP_IPV4	$PEER	$IPS_IPCOMP_TRANSP_IPV4 \
	type	use
flow ipcomp \
	$FROM	$SRC_IPCOMP_TRANSP_IPV6	$TO	$IPS_IPCOMP_TRANSP_IPV6 \
	$LOCAL	$SRC_IPCOMP_TRANSP_IPV6	$PEER	$IPS_IPCOMP_TRANSP_IPV6 \
	type	use

# IPCOMP TRANSP SA

ipcomp transport \
	from	$SRC_IPCOMP_TRANSP_IPV4	to	$IPS_IPCOMP_TRANSP_IPV4 \
	spi	0x6441:0x6442

ipcomp transport \
	from	$SRC_IPCOMP_TRANSP_IPV6	to	$IPS_IPCOMP_TRANSP_IPV6 \
	spi	0x6461:0x6462

# IPCOMP TUNNEL IPS

flow ipcomp \
	$FROM	$SRC_IPCOMP_TUNNEL_IPV4/24	$TO	$IPS_IPCOMP_TUNNEL4_IPV4/24 \
	$LOCAL	$SRC_OUT_IPV4		$PEER	$IPS_IN_IPV4 \
	type	use
flow ipcomp \
	$FROM	$SRC_IPCOMP_TUNNEL_IPV6/64	$TO	$IPS_IPCOMP_TUNNEL4_IPV6/64 \
	$LOCAL	$SRC_OUT_IPV4		$PEER	$IPS_IN_IPV4 \
	type	use

flow ipcomp \
	$FROM	$SRC_IPCOMP_TUNNEL_IPV4/24	$TO	$IPS_IPCOMP_TUNNEL6_IPV4/24 \
	$LOCAL	$SRC_OUT_IPV6		$PEER	$IPS_IN_IPV6 \
	type	use
flow ipcomp \
	$FROM	$SRC_IPCOMP_TUNNEL_IPV6/64	$TO	$IPS_IPCOMP_TUNNEL6_IPV6/64 \
	$LOCAL	$SRC_OUT_IPV6		$PEER	$IPS_IN_IPV6 \
	type	use

# IPCOMP TUNNEL ECO

flow ipcomp \
	$FROM	$SRC_IPCOMP_TUNNEL_IPV4/24	$TO	$ECO_IPCOMP_TUNNEL4_IPV4/24 \
	$LOCAL	$SRC_OUT_IPV4		$PEER	$IPS_IN_IPV4 \
	type	use
flow ipcomp \
	$FROM	$SRC_IPCOMP_TUNNEL_IPV6/64	$TO	$ECO_IPCOMP_TUNNEL4_IPV6/64 \
	$LOCAL	$SRC_OUT_IPV4		$PEER	$IPS_IN_IPV4 \
	type	use

flow ipcomp \
	$FROM	$SRC_IPCOMP_TUNNEL_IPV4/24	$TO	$ECO_IPCOMP_TUNNEL6_IPV4/24 \
	$LOCAL	$SRC_OUT_IPV6		$PEER	$IPS_IN_IPV6 \
	type	use
flow ipcomp \
	$FROM	$SRC_IPCOMP_TUNNEL_IPV6/64	$TO	$ECO_IPCOMP_TUNNEL6_IPV6/64 \
	$LOCAL	$SRC_OUT_IPV6		$PEER	$IPS_IN_IPV6 \
	type	use

# IPCOMP TUNNEL SA

ipcomp tunnel \
	from	$SRC_OUT_IPV4	to	$IPS_IN_IPV4 \
	spi	0x6841:0x6842

ipcomp tunnel \
	from	$SRC_OUT_IPV6	to	$IPS_IN_IPV6 \
	spi	0x6861:0x6862

## BUNDLE

# BUNDLE TRANSP

flow ipcomp \
	$FROM	$SRC_BUNDLE_TRANSP_IPV4	$TO	$IPS_BUNDLE_TRANSP_IPV4 \
	$LOCAL	$SRC_BUNDLE_TRANSP_IPV4	$PEER	$IPS_BUNDLE_TRANSP_IPV4 \
	type	use
flow ipcomp \
	$FROM	$SRC_BUNDLE_TRANSP_IPV6	$TO	$IPS_BUNDLE_TRANSP_IPV6 \
	$LOCAL	$SRC_BUNDLE_TRANSP_IPV6	$PEER	$IPS_BUNDLE_TRANSP_IPV6 \
	type	use

# BUNDLE TRANSP SA

ipcomp transport \
	from	$SRC_BUNDLE_TRANSP_IPV4	to	$IPS_BUNDLE_TRANSP_IPV4 \
	spi	0x8441:0x8442 \
	bundle	identifier
esp transport \
	from	$SRC_BUNDLE_TRANSP_IPV4	to	$IPS_BUNDLE_TRANSP_IPV4 \
	spi	0x10018441:0x10018442 \
	authkey	0x0123456789abcdef0123456789abcdef0123456789abcdef0123456789abcdef:0x0123456789abcdef0123456789abcdef0123456789abcdef0123456789abcdef \
	enckey	0x0123456789abcdef0123456789abcdef0123456789abcdef0123456789abcdef:0x0123456789abcdef0123456789abcdef0123456789abcdef0123456789abcdef \
	bundle	identifier
ah transport \
	from	$SRC_BUNDLE_TRANSP_IPV4	to	$IPS_BUNDLE_TRANSP_IPV4 \
	spi	0x10028441:0x10028442 \
	authkey	0x0123456789abcdef0123456789abcdef0123456789abcdef0123456789abcdef:0x0123456789abcdef0123456789abcdef0123456789abcdef0123456789abcdef \
	enckey	0x0123456789abcdef0123456789abcdef0123456789abcdef0123456789abcdef:0x0123456789abcdef0123456789abcdef0123456789abcdef0123456789abcdef \
	bundle	identifier

ipcomp transport \
	from	$SRC_BUNDLE_TRANSP_IPV6	to	$IPS_BUNDLE_TRANSP_IPV6 \
	spi	0x8461:0x8462 \
	bundle	identifier
esp transport \
	from	$SRC_BUNDLE_TRANSP_IPV6	to	$IPS_BUNDLE_TRANSP_IPV6 \
	spi	0x10018461:0x10018462 \
	authkey	0x0123456789abcdef0123456789abcdef0123456789abcdef0123456789abcdef:0x0123456789abcdef0123456789abcdef0123456789abcdef0123456789abcdef \
	enckey	0x0123456789abcdef0123456789abcdef0123456789abcdef0123456789abcdef:0x0123456789abcdef0123456789abcdef0123456789abcdef0123456789abcdef \
	bundle	identifier
ah transport \
	from	$SRC_BUNDLE_TRANSP_IPV6	to	$IPS_BUNDLE_TRANSP_IPV6 \
	spi	0x10028461:0x10028462 \
	authkey	0x0123456789abcdef0123456789abcdef0123456789abcdef0123456789abcdef:0x0123456789abcdef0123456789abcdef0123456789abcdef0123456789abcdef \
	enckey	0x0123456789abcdef0123456789abcdef0123456789abcdef0123456789abcdef:0x0123456789abcdef0123456789abcdef0123456789abcdef0123456789abcdef \
	bundle	identifier

# BUNDLE TUNNEL IPS

flow ipcomp \
	$FROM	$SRC_BUNDLE_TUNNEL_IPV4/24	$TO	$IPS_BUNDLE_TUNNEL4_IPV4/24 \
	$LOCAL	$SRC_BUNDLE_IPV4		$PEER	$IPS_BUNDLE_IPV4 \
	type	use
flow ipcomp \
	$FROM	$SRC_BUNDLE_TUNNEL_IPV6/64	$TO	$IPS_BUNDLE_TUNNEL4_IPV6/64 \
	$LOCAL	$SRC_BUNDLE_IPV4		$PEER	$IPS_BUNDLE_IPV4 \
	type	use

flow ipcomp \
	$FROM	$SRC_BUNDLE_TUNNEL_IPV4/24	$TO	$IPS_BUNDLE_TUNNEL6_IPV4/24 \
	$LOCAL	$SRC_BUNDLE_IPV6		$PEER	$IPS_BUNDLE_IPV6 \
	type	use
flow ipcomp \
	$FROM	$SRC_BUNDLE_TUNNEL_IPV6/64	$TO	$IPS_BUNDLE_TUNNEL6_IPV6/64 \
	$LOCAL	$SRC_BUNDLE_IPV6		$PEER	$IPS_BUNDLE_IPV6 \
	type	use

# BUNDLE TUNNEL ECO

flow ipcomp \
	$FROM	$SRC_BUNDLE_TUNNEL_IPV4/24	$TO	$ECO_BUNDLE_TUNNEL4_IPV4/24 \
	$LOCAL	$SRC_BUNDLE_IPV4		$PEER	$IPS_BUNDLE_IPV4 \
	type	use
flow ipcomp \
	$FROM	$SRC_BUNDLE_TUNNEL_IPV6/64	$TO	$ECO_BUNDLE_TUNNEL4_IPV6/64 \
	$LOCAL	$SRC_BUNDLE_IPV4		$PEER	$IPS_BUNDLE_IPV4 \
	type	use

flow ipcomp \
	$FROM	$SRC_BUNDLE_TUNNEL_IPV4/24	$TO	$ECO_BUNDLE_TUNNEL6_IPV4/24 \
	$LOCAL	$SRC_BUNDLE_IPV6		$PEER	$IPS_BUNDLE_IPV6 \
	type	use
flow ipcomp \
	$FROM	$SRC_BUNDLE_TUNNEL_IPV6/64	$TO	$ECO_BUNDLE_TUNNEL6_IPV6/64 \
	$LOCAL	$SRC_BUNDLE_IPV6		$PEER	$IPS_BUNDLE_IPV6 \
	type	use

# BUNDLE TUNNEL SA

ipcomp tunnel \
	from	$SRC_BUNDLE_IPV4	to	$IPS_BUNDLE_IPV4 \
	spi	0x8841:0x8842 \
	bundle	identifier
esp tunnel \
	from	$SRC_BUNDLE_IPV4	to	$IPS_BUNDLE_IPV4 \
	spi	0x10018841:0x10018842 \
	authkey	0x0123456789abcdef0123456789abcdef0123456789abcdef0123456789abcdef:0x0123456789abcdef0123456789abcdef0123456789abcdef0123456789abcdef \
	enckey	0x0123456789abcdef0123456789abcdef0123456789abcdef0123456789abcdef:0x0123456789abcdef0123456789abcdef0123456789abcdef0123456789abcdef \
	bundle	identifier
ah tunnel \
	from	$SRC_BUNDLE_IPV4	to	$IPS_BUNDLE_IPV4 \
	spi	0x10028841:0x10028842 \
	authkey	0x0123456789abcdef0123456789abcdef0123456789abcdef0123456789abcdef:0x0123456789abcdef0123456789abcdef0123456789abcdef0123456789abcdef \
	enckey	0x0123456789abcdef0123456789abcdef0123456789abcdef0123456789abcdef:0x0123456789abcdef0123456789abcdef0123456789abcdef0123456789abcdef \
	bundle	identifier

ipcomp tunnel \
	from	$SRC_BUNDLE_IPV6	to	$IPS_BUNDLE_IPV6 \
	spi	0x8861:0x8862 \
	bundle	identifier
esp tunnel \
	from	$SRC_BUNDLE_IPV6	to	$IPS_BUNDLE_IPV6 \
	spi	0x10018861:0x10018862 \
	authkey	0x0123456789abcdef0123456789abcdef0123456789abcdef0123456789abcdef:0x0123456789abcdef0123456789abcdef0123456789abcdef0123456789abcdef \
	enckey	0x0123456789abcdef0123456789abcdef0123456789abcdef0123456789abcdef:0x0123456789abcdef0123456789abcdef0123456789abcdef0123456789abcdef \
	bundle	identifier
ah tunnel \
	from	$SRC_BUNDLE_IPV6	to	$IPS_BUNDLE_IPV6 \
	spi	0x10028861:0x10028862 \
	authkey	0x0123456789abcdef0123456789abcdef0123456789abcdef0123456789abcdef:0x0123456789abcdef0123456789abcdef0123456789abcdef0123456789abcdef \
	enckey	0x0123456789abcdef0123456789abcdef0123456789abcdef0123456789abcdef:0x0123456789abcdef0123456789abcdef0123456789abcdef0123456789abcdef \
	bundle	identifier
@


1.5
log
@Add test for IP payload compression.  It is sending small and big
ping packets as only the latter get actually compressed.
@
text
@d1 1
a1 1
#	$OpenBSD: ipsec.conf,v 1.4 2017/02/27 16:53:59 bluhm Exp $
d189 1
a189 1
	spi	0x10006441:0x10006442
d193 1
a193 1
	spi	0x10006461:0x10006462
d239 1
a239 1
	spi	0x10006841:0x10006842
d243 1
a243 1
	spi	0x10006861:0x10006862
d262 1
a262 1
	spi	0x4441:0x4442
d266 1
a266 1
	spi	0x4461:0x4462
d312 1
a312 1
	spi	0x4841:0x4842
d316 126
a441 1
	spi	0x4861:0x4862
@


1.4
log
@Add IPsec tests for ipip encapsulation.
@
text
@d1 1
a1 1
#	$OpenBSD: ipsec.conf,v 1.3 2017/02/13 17:54:27 bluhm Exp $
d244 73
@


1.3
log
@Test IPsec with AH the same way it is already done for ESP.
@
text
@d1 1
a1 1
#	$OpenBSD: ipsec.conf,v 1.2 2017/02/08 17:58:59 bluhm Exp $
d171 73
@


1.2
log
@Encrypt UDP and TCP packets in test.  Use a sane transport config.
@
text
@d1 1
a1 1
#	$OpenBSD: ipsec.conf,v 1.1.1.1 2017/02/06 21:54:05 bluhm Exp $
d10 3
a12 1
# TRANSP
d15 2
a16 2
	$FROM	$SRC_TRANSP_IPV4	$TO	$IPS_TRANSP_IPV4 \
	$LOCAL	$SRC_TRANSP_IPV4	$PEER	$IPS_TRANSP_IPV4 \
d19 2
a20 2
	$FROM	$SRC_TRANSP_IPV6	$TO	$IPS_TRANSP_IPV6 \
	$LOCAL	$SRC_TRANSP_IPV6	$PEER	$IPS_TRANSP_IPV6 \
d23 1
a23 1
# TRANSP SA
d26 1
a26 1
	from	$SRC_TRANSP_IPV4	to	$IPS_TRANSP_IPV4 \
d32 1
a32 1
	from	$SRC_TRANSP_IPV6	to	$IPS_TRANSP_IPV6 \
d37 1
a37 1
# TUNNEL IPS
d40 1
a40 1
	$FROM	$SRC_TUNNEL_IPV4/24	$TO	$IPS_TUNNEL4_IPV4/24 \
d44 1
a44 1
	$FROM	$SRC_TUNNEL_IPV6/64	$TO	$IPS_TUNNEL4_IPV6/64 \
d49 1
a49 1
	$FROM	$SRC_TUNNEL_IPV4/24	$TO	$IPS_TUNNEL6_IPV4/24 \
d53 1
a53 1
	$FROM	$SRC_TUNNEL_IPV6/64	$TO	$IPS_TUNNEL6_IPV6/64 \
d57 1
a57 1
# TUNNEL ECO
d60 1
a60 1
	$FROM	$SRC_TUNNEL_IPV4/24	$TO	$ECO_TUNNEL4_IPV4/24 \
d64 1
a64 1
	$FROM	$SRC_TUNNEL_IPV6/64	$TO	$ECO_TUNNEL4_IPV6/64 \
d69 1
a69 1
	$FROM	$SRC_TUNNEL_IPV4/24	$TO	$ECO_TUNNEL6_IPV4/24 \
d73 1
a73 1
	$FROM	$SRC_TUNNEL_IPV6/64	$TO	$ECO_TUNNEL6_IPV6/64 \
d77 1
a77 1
# TUNNEL SA
d88 81
@


1.1
log
@Initial revision
@
text
@d1 1
a1 1
#	$OpenBSD$
d13 1
a13 1
	$FROM	$SRC_TRANSP_IPV4/24	$TO	$IPS_TRANSP_IPV4/24 \
d17 1
a17 1
	$FROM	$SRC_TRANSP_IPV6/64	$TO	$IPS_TRANSP_IPV6/64 \
@


1.1.1.1
log
@Test combinations of IPsec tunnel and transport mode on several
machines.  For now only ESP encrypted IPv4 and IPv6 ICMP ping packets
are generated.
@
text
@@
