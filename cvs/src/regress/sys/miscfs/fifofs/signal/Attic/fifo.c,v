head	1.3;
access;
symbols
	OPENBSD_3_1:1.2.0.2
	OPENBSD_3_1_BASE:1.2;
locks; strict;
comment	@ * @;


1.3
date	2002.06.08.06.50.28;	author fgsch;	state dead;
branches;
next	1.2;

1.2
date	2002.03.13.15.00.37;	author fgsch;	state Exp;
branches;
next	1.1;

1.1
date	2002.03.10.23.37.47;	author fgsch;	state Exp;
branches;
next	;


desc
@@


1.3
log
@you too, out.
@
text
@/*	$OpenBSD: fifo.c,v 1.2 2002/03/13 15:00:37 fgsch Exp $	*/

#include <sys/types.h>
#include <sys/time.h>
#include <sys/stat.h>
#include <err.h>
#include <errno.h>
#include <fcntl.h>
#include <signal.h>
#include <stdio.h>
#include <unistd.h>

#define	FIFO_PATH	"file-fifo"

void	handler(int);

void
handler(int s)
{
	write(2, ".", 1);
}

int
main(int argc, char **argv)
{
	struct itimerval it;
	struct sigaction act;

	unlink(FIFO_PATH);

	if (mkfifo(FIFO_PATH, 0600) < 0)
		err(1, "mkfifo");

	act.sa_handler = handler;
	act.sa_flags = SA_RESTART;
	if (sigaction(SIGALRM, &act, NULL) < 0)
		err(1, "sigaction");

	it.it_interval.tv_sec = 2;
	it.it_interval.tv_usec = 0;
	it.it_value = it.it_interval;
	if (setitimer(ITIMER_REAL, &it, NULL) < 0)
		err(1, "setitimer");

	if (open(FIFO_PATH, O_RDONLY) < 0) {
		if (errno == EINTR)
			errx(1, "open not restarted");
		else
			err(1, "open");
	}

	exit(0);
}
@


1.2
log
@replace alarm(3) with setitimer(2).
@
text
@d1 1
a1 1
/*	$OpenBSD: fifo.c,v 1.1 2002/03/10 23:37:47 fgsch Exp $	*/
@


1.1
log
@regression for signal restart during open(2).
@
text
@d1 1
a1 1
/*	$OpenBSD$	*/
d4 1
d26 1
d39 5
a43 1
	alarm(2);
@

