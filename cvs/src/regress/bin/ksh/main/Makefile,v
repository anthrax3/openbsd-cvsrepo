head	1.1;
access;
symbols
	OPENBSD_6_1:1.1.0.2
	OPENBSD_6_1_BASE:1.1;
locks; strict;
comment	@# @;


1.1
date	2016.09.29.11.04.45;	author schwarze;	state Exp;
branches;
next	;
commitid	NsdblodFVWBNfIZD;


desc
@@


1.1
log
@If a Makefile both defines SUBDIR and includes <bsd.regress.mk>,
the "all" target will depend on the "regress" target, so running
"make all" will recurse into the subdirectories for "regress", and
then recurse a second time into the same subdirectories for "all",
running all the tests twice.

Fix this by moving the Makefile to run the main-level tests into
a subdirectory "main" and only including <bsd.subdir.mk> from the
top level Makefile.

Issue reported by otto@@; patch OK'ed by otto@@ and bluhm@@.
@
text
@# $OpenBSD: Makefile,v 1.9 2016/01/12 09:00:39 schwarze Exp $

REGRESS_TARGETS=check
KSH=/bin/ksh
PERL=/usr/bin/perl
CATEGORIES=pdksh,sh,ksh,posix,posix-upu

# Avoid /tmp for test temp files if we have an obj dir
.if ${.CURDIR} != ${.OBJDIR}
TEMPDIR=${.OBJDIR}
.else
TEMPDIR=/tmp
.endif

check test:
	${PERL} ${.CURDIR}/../th -s ${.CURDIR}/.. -p ${KSH} \
		-C ${CATEGORIES} -T ${TEMPDIR}

.PHONY: ${REGRESS_TARGETS}

.include <bsd.regress.mk>
@
