head	1.25;
access;
symbols
	OPENBSD_6_2_BASE:1.25
	OPENBSD_6_1:1.25.0.4
	OPENBSD_6_1_BASE:1.25
	OPENBSD_6_0:1.24.0.4
	OPENBSD_6_0_BASE:1.24
	OPENBSD_5_9:1.24.0.2
	OPENBSD_5_9_BASE:1.24
	OPENBSD_5_8:1.23.0.8
	OPENBSD_5_8_BASE:1.23
	OPENBSD_5_7:1.23.0.2
	OPENBSD_5_7_BASE:1.23
	OPENBSD_5_6:1.23.0.4
	OPENBSD_5_6_BASE:1.23
	OPENBSD_5_5:1.21.0.8
	OPENBSD_5_5_BASE:1.21
	OPENBSD_5_4:1.21.0.4
	OPENBSD_5_4_BASE:1.21
	OPENBSD_5_3:1.21.0.2
	OPENBSD_5_3_BASE:1.21
	OPENBSD_5_2:1.20.0.18
	OPENBSD_5_2_BASE:1.20
	OPENBSD_5_1_BASE:1.20
	OPENBSD_5_1:1.20.0.16
	OPENBSD_5_0:1.20.0.14
	OPENBSD_5_0_BASE:1.20
	OPENBSD_4_9:1.20.0.12
	OPENBSD_4_9_BASE:1.20
	OPENBSD_4_8:1.20.0.10
	OPENBSD_4_8_BASE:1.20
	OPENBSD_4_7:1.20.0.6
	OPENBSD_4_7_BASE:1.20
	OPENBSD_4_6:1.20.0.8
	OPENBSD_4_6_BASE:1.20
	OPENBSD_4_5:1.20.0.4
	OPENBSD_4_5_BASE:1.20
	OPENBSD_4_4:1.20.0.2
	OPENBSD_4_4_BASE:1.20
	OPENBSD_4_3:1.18.0.10
	OPENBSD_4_3_BASE:1.18
	OPENBSD_4_2:1.18.0.8
	OPENBSD_4_2_BASE:1.18
	OPENBSD_4_1:1.18.0.6
	OPENBSD_4_1_BASE:1.18
	OPENBSD_4_0:1.18.0.4
	OPENBSD_4_0_BASE:1.18
	OPENBSD_3_9:1.18.0.2
	OPENBSD_3_9_BASE:1.18
	OPENBSD_3_8:1.17.0.6
	OPENBSD_3_8_BASE:1.17
	OPENBSD_3_7:1.17.0.4
	OPENBSD_3_7_BASE:1.17
	OPENBSD_3_6:1.17.0.2
	OPENBSD_3_6_BASE:1.17
	OPENBSD_3_5:1.15.0.4
	OPENBSD_3_5_BASE:1.15
	OPENBSD_3_4:1.15.0.2
	OPENBSD_3_4_BASE:1.15
	OPENBSD_3_3:1.14.0.4
	OPENBSD_3_3_BASE:1.14
	OPENBSD_3_2:1.14.0.2
	OPENBSD_3_2_BASE:1.14
	OPENBSD_3_1:1.13.0.2
	OPENBSD_3_1_BASE:1.13
	OPENBSD_3_0:1.12.0.2
	OPENBSD_3_0_BASE:1.12
	OPENBSD_2_9:1.11.0.2
	OPENBSD_2_9_BASE:1.11
	OPENBSD_2_8:1.8.0.6
	OPENBSD_2_8_BASE:1.8
	OPENBSD_2_7:1.8.0.4
	OPENBSD_2_7_BASE:1.8
	OPENBSD_2_6:1.8.0.2
	OPENBSD_2_6_BASE:1.8
	OPENBSD_2_5:1.6.0.4
	OPENBSD_2_5_BASE:1.6
	OPENBSD_2_4:1.6.0.2
	OPENBSD_2_4_BASE:1.6
	OPENBSD_2_3:1.5.0.6
	OPENBSD_2_3_BASE:1.5
	OPENBSD_2_2:1.5.0.4
	OPENBSD_2_2_BASE:1.5
	OPENBSD_2_1:1.5.0.2
	OPENBSD_2_1_BASE:1.5
	OPENBSD_2_0:1.2.0.2
	OPENBSD_2_0_BASE:1.2
	netbsd_1_1:1.1.1.1;
locks; strict;
comment	@ * @;


1.25
date	2017.03.09.10.13.03;	author fcambus;	state Exp;
branches;
next	1.24;
commitid	OBRyBosIbFCvAKYB;

1.24
date	2015.11.18.16.44.46;	author tedu;	state Exp;
branches;
next	1.23;
commitid	QVmzbQxv343IGoRu;

1.23
date	2014.05.16.21.28.15;	author tedu;	state Exp;
branches;
next	1.22;

1.22
date	2014.05.12.19.13.51;	author tedu;	state Exp;
branches;
next	1.21;

1.21
date	2012.12.05.23.19.57;	author deraadt;	state Exp;
branches;
next	1.20;

1.20
date	2008.06.25.14.51.27;	author millert;	state Exp;
branches;
next	1.19;

1.19
date	2008.06.24.14.31.59;	author deraadt;	state Exp;
branches;
next	1.18;

1.18
date	2005.12.13.00.35.22;	author millert;	state Exp;
branches;
next	1.17;

1.17
date	2004.07.13.21.09.47;	author millert;	state Exp;
branches;
next	1.16;

1.16
date	2004.04.06.10.59.18;	author djm;	state Exp;
branches;
next	1.15;

1.15
date	2003.06.02.19.34.12;	author millert;	state Exp;
branches;
next	1.14;

1.14
date	2002.04.22.21.28.49;	author millert;	state Exp;
branches;
next	1.13;

1.13
date	2002.02.16.21.27.17;	author millert;	state Exp;
branches;
next	1.12;

1.12
date	2001.08.26.03.28.30;	author millert;	state Exp;
branches;
next	1.11;

1.11
date	2001.02.13.14.48.40;	author pjanzen;	state Exp;
branches;
next	1.10;

1.10
date	2001.01.31.17.42.25;	author deraadt;	state Exp;
branches;
next	1.9;

1.9
date	2000.11.21.00.49.59;	author millert;	state Exp;
branches;
next	1.8;

1.8
date	99.09.03.18.13.37;	author deraadt;	state Exp;
branches;
next	1.7;

1.7
date	99.09.01.20.47.58;	author deraadt;	state Exp;
branches;
next	1.6;

1.6
date	98.07.15.00.50.40;	author millert;	state Exp;
branches;
next	1.5;

1.5
date	97.02.16.20.54.28;	author provos;	state Exp;
branches;
next	1.4;

1.4
date	97.02.14.23.28.47;	author provos;	state Exp;
branches;
next	1.3;

1.3
date	96.10.16.09.08.27;	author downsj;	state Exp;
branches;
next	1.2;

1.2
date	96.05.22.11.34.44;	author deraadt;	state Exp;
branches;
next	1.1;

1.1
date	95.10.18.08.41.13;	author deraadt;	state Exp;
branches
	1.1.1.1;
next	;

1.1.1.1
date	95.10.18.08.41.13;	author deraadt;	state Exp;
branches;
next	;


desc
@@


1.25
log
@As per style.9, prototypes should not have variable names associated
with the types.

OK jca@@
@
text
@/*	$OpenBSD: pwd.h,v 1.24 2015/11/18 16:44:46 tedu Exp $	*/
/*	$NetBSD: pwd.h,v 1.9 1996/05/15 21:36:45 jtc Exp $	*/

/*-
 * Copyright (c) 1989, 1993
 *	The Regents of the University of California.  All rights reserved.
 * (c) UNIX System Laboratories, Inc.
 * All or some portions of this file are derived from material licensed
 * to the University of California by American Telephone and Telegraph
 * Co. or Unix System Laboratories, Inc. and are reproduced herein with
 * the permission of UNIX System Laboratories, Inc.
 * Portions Copyright(C) 1995, 1996, Jason Downs.  All rights reserved.
 *
 * Redistribution and use in source and binary forms, with or without
 * modification, are permitted provided that the following conditions
 * are met:
 * 1. Redistributions of source code must retain the above copyright
 *    notice, this list of conditions and the following disclaimer.
 * 2. Redistributions in binary form must reproduce the above copyright
 *    notice, this list of conditions and the following disclaimer in the
 *    documentation and/or other materials provided with the distribution.
 * 3. Neither the name of the University nor the names of its contributors
 *    may be used to endorse or promote products derived from this software
 *    without specific prior written permission.
 *
 * THIS SOFTWARE IS PROVIDED BY THE REGENTS AND CONTRIBUTORS ``AS IS'' AND
 * ANY EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT LIMITED TO, THE
 * IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE
 * ARE DISCLAIMED.  IN NO EVENT SHALL THE REGENTS OR CONTRIBUTORS BE LIABLE
 * FOR ANY DIRECT, INDIRECT, INCIDENTAL, SPECIAL, EXEMPLARY, OR CONSEQUENTIAL
 * DAMAGES (INCLUDING, BUT NOT LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS
 * OR SERVICES; LOSS OF USE, DATA, OR PROFITS; OR BUSINESS INTERRUPTION)
 * HOWEVER CAUSED AND ON ANY THEORY OF LIABILITY, WHETHER IN CONTRACT, STRICT
 * LIABILITY, OR TORT (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY
 * OUT OF THE USE OF THIS SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF
 * SUCH DAMAGE.
 *
 *	@@(#)pwd.h	8.2 (Berkeley) 1/21/94
 */

#ifndef _PWD_H_
#define	_PWD_H_

#include <sys/types.h>

#if __BSD_VISIBLE
#define	_PATH_PASSWD		"/etc/passwd"
#define	_PATH_MASTERPASSWD	"/etc/master.passwd"
#define	_PATH_MASTERPASSWD_LOCK	"/etc/ptmp"

#define	_PATH_MP_DB		"/etc/pwd.db"
#define	_PATH_SMP_DB		"/etc/spwd.db"

#define	_PATH_PWD_MKDB		"/usr/sbin/pwd_mkdb"

#define	_PW_KEYBYNAME		'1'	/* stored by name */
#define	_PW_KEYBYNUM		'2'	/* stored by entry in the "file" */
#define	_PW_KEYBYUID		'3'	/* stored by uid */

#define _PW_YPTOKEN		"__YP!"

#define	_PASSWORD_EFMT1		'_'	/* extended encryption format */

#define	_PASSWORD_LEN		128	/* max length, not counting NUL */
#define	_PW_NAME_LEN		31	/* max length, not counting NUL */
					/* Should be MAXLOGNAME - 1 */
#define _PW_BUF_LEN		1024	/* length of getpw*_r buffer */

#define _PASSWORD_NOUID		0x01	/* flag for no specified uid. */
#define _PASSWORD_NOGID		0x02	/* flag for no specified gid. */
#define _PASSWORD_NOCHG		0x04	/* flag for no specified change. */
#define _PASSWORD_NOEXP		0x08	/* flag for no specified expire. */

/* Flags for pw_mkdb(3) */
#define	_PASSWORD_SECUREONLY	0x01	/* only generate spwd.db file */
#define	_PASSWORD_OMITV7	0x02	/* don't generate v7 passwd file */

#endif

struct passwd {
	char	*pw_name;		/* user name */
	char	*pw_passwd;		/* encrypted password */
	uid_t	pw_uid;			/* user uid */
	gid_t	pw_gid;			/* user gid */
	time_t	pw_change;		/* password change time */
	char	*pw_class;		/* user access class */
	char	*pw_gecos;		/* Honeywell login info */
	char	*pw_dir;		/* home directory */
	char	*pw_shell;		/* default shell */
	time_t	pw_expire;		/* account expiration */
};

__BEGIN_DECLS
struct passwd	*getpwuid(uid_t);
struct passwd	*getpwnam(const char *);
struct passwd	*getpwuid_shadow(uid_t);
struct passwd	*getpwnam_shadow(const char *);
int		getpwnam_r(const char *, struct passwd *, char *, size_t,
		    struct passwd **);
int		getpwuid_r(uid_t, struct passwd *, char *, size_t,
		    struct passwd **);
#if __BSD_VISIBLE || __XPG_VISIBLE
struct passwd	*getpwent(void);
void		 setpwent(void);
void		 endpwent(void);
#endif
#if __BSD_VISIBLE
int		 setpassent(int);
char		*user_from_uid(uid_t, int);
char		*bcrypt_gensalt(u_int8_t);
char		*bcrypt(const char *, const char *);
int		bcrypt_newhash(const char *, int, char *, size_t);
int		bcrypt_checkpass(const char *, const char *);
struct passwd	*pw_dup(const struct passwd *);
#endif
__END_DECLS

#endif /* !_PWD_H_ */
@


1.24
log
@Add _shadow variants to the two popular getpw functions (uid and nam).
This version of the function will always open the secure/shadow/master
password files. Soon, the regular variants of these functions will not.
(Intermixing shadow and regular gets a little weird; don't do that.)
Not using struct spwd and getspwnam functions to reduce churn in callers.
Should just be a one line diff in most places.
ok deraadt
@
text
@d1 1
a1 1
/*	$OpenBSD: pwd.h,v 1.23 2014/05/16 21:28:15 tedu Exp $	*/
d99 3
a101 3
		    struct passwd **result);
int		getpwuid_r(uid_t uid, struct passwd *, char *buf, size_t buflen,
		    struct passwd **result);
@


1.23
log
@add prototypes for new crypt functions
@
text
@d1 1
a1 1
/*	$OpenBSD: pwd.h,v 1.22 2014/05/12 19:13:51 tedu Exp $	*/
d96 2
@


1.22
log
@no md5crypt
@
text
@d1 1
a1 1
/*	$OpenBSD: pwd.h,v 1.21 2012/12/05 23:19:57 deraadt Exp $	*/
d110 2
@


1.21
log
@Remove excessive sys/cdefs.h inclusion
ok guenther millert kettenis
@
text
@d1 1
a1 1
/*	$OpenBSD: pwd.h,v 1.20 2008/06/25 14:51:27 millert Exp $	*/
a109 1
char		*md5crypt(const char *, const char *);
@


1.20
log
@Add _PW_BUF_LEN define and use it instead of hard-coding 1024 for
the buffer size.  OK deraadt@@
@
text
@d1 1
a1 1
/*	$OpenBSD: pwd.h,v 1.19 2008/06/24 14:31:59 deraadt Exp $	*/
a43 1
#include <sys/cdefs.h>
@


1.19
log
@prototypes for getpwnam_r() and getpwuid_r()
@
text
@d1 1
a1 1
/*	$OpenBSD: pwd.h,v 1.18 2005/12/13 00:35:22 millert Exp $	*/
d68 1
@


1.18
log
@First step in include files overhaul.  Use __FOO_VISIBLE (as defined
in sys/cdefs.h) instead of _FOO_SOURCE.  Also fix several namespace
pollution issues, including the byte order defines.  OK deraadt@@
@
text
@d1 1
a1 1
/*	$OpenBSD: pwd.h,v 1.17 2004/07/13 21:09:47 millert Exp $	*/
d96 4
@


1.17
log
@passwd.conf has been deprecated since login.conf was imported.
Today it finally dies.  Based on a diff from Gabriel Kihlman.
@
text
@d1 1
a1 1
/*	$OpenBSD: pwd.h,v 1.16 2004/04/06 10:59:18 djm Exp $	*/
d44 1
d47 1
a47 1
#ifndef _POSIX_SOURCE
a92 2
#include <sys/cdefs.h>

d96 1
a96 1
#ifndef _POSIX_SOURCE
d98 4
a101 1
#ifndef _XOPEN_SOURCE
a107 3
#endif
void		 setpwent(void);
void		 endpwent(void);
@


1.16
log
@prototypes for bcrypt and md5crypt, as described in manpage; ok deraadt@@
@
text
@d1 1
a1 1
/*	$OpenBSD: pwd.h,v 1.15 2003/06/02 19:34:12 millert Exp $	*/
a47 1
#define _PATH_PASSWDCONF	"/etc/passwd.conf"
@


1.15
log
@Remove the advertising clause in the UCB license which Berkeley
rescinded 22 July 1999.  Proofed by myself and Theo.
@
text
@d1 1
a1 1
/*	$OpenBSD: pwd.h,v 1.14 2002/04/22 21:28:49 millert Exp $	*/
d104 2
@


1.14
log
@Fix 2 things that should be gid_t.  One from Oleg Safiullin, one from me...
@
text
@d1 1
a1 1
/*	$OpenBSD: pwd.h,v 1.13 2002/02/16 21:27:17 millert Exp $	*/
d22 1
a22 5
 * 3. All advertising materials mentioning features or use of this software
 *    must display the following acknowledgement:
 *	This product includes software developed by the University of
 *	California, Berkeley and its contributors.
 * 4. Neither the name of the University nor the names of its contributors
@


1.13
log
@Part one of userland __P removal.  Done with a simple regexp with some minor hand editing to make comments line up correctly.  Another pass is forthcoming that handles the cases that could not be done automatically.
@
text
@d1 1
a1 1
/*	$OpenBSD: pwd.h,v 1.12 2001/08/26 03:28:30 millert Exp $	*/
d88 1
a88 1
	uid_t	pw_gid;			/* user gid */
@


1.12
log
@Change the second arg to pw_mkdb() from a boolean flag to a set of
bit flags ORed together.  Currently the only flags defined are
_PASSWORD_SECUREONLY and _PASSWORD_OMITV7 but this is enough to
cause pw_mkdb() to run pwd_mkdb with the options we want.

With this change we no longer generate the old V7 passwd file when
only the extra fields in master.passwd (or the encrypted password)
have changed.  There are other programs that could probably use
the _PASSWORD_OMITV7 flag; they will be converted at a future date.
@
text
@d1 1
a1 1
/*	$OpenBSD: pwd.h,v 1.11 2001/02/13 14:48:40 pjanzen Exp $	*/
d100 2
a101 2
struct passwd	*getpwuid __P((uid_t));
struct passwd	*getpwnam __P((const char *));
d103 1
a103 1
struct passwd	*getpwent __P((void));
d105 4
a108 4
int		 setpassent __P((int));
char		*user_from_uid __P((uid_t, int));
char		*bcrypt_gensalt __P((u_int8_t));
struct passwd	*pw_dup __P((const struct passwd *));
d110 2
a111 2
void		 setpwent __P((void));
void		 endpwent __P((void));
@


1.11
log
@_PW_NAME_LEN doesn't include the NUL, MAXLOGNAME does.
@
text
@d1 1
a1 1
/*	$OpenBSD: pwd.h,v 1.10 2001/01/31 17:42:25 deraadt Exp $	*/
d77 4
@


1.10
log
@move utmp to large format, usernames to 32 chars; downsj
@
text
@d1 1
a1 1
/*	$OpenBSD: pwd.h,v 1.9 2000/11/21 00:49:59 millert Exp $	*/
d69 3
a71 2
#define	_PASSWORD_LEN		128	/* max length, not counting NULL */
#define	_PW_NAME_LEN		32	/* max length, not counting NULL */
@


1.9
log
@Add pw_dup(3), a function to copy 'struct passwd'.  It is allocated as
a single chunk with the strings pointing elsewhere in the buffer so
a simple free() of the struct passwd * is all that is needed to decallocate.
@
text
@d1 1
a1 1
/*	$OpenBSD: pwd.h,v 1.8 1999/09/03 18:13:37 deraadt Exp $	*/
d70 1
@


1.8
log
@proto bcrypt_gensalt()
@
text
@d1 1
a1 1
/*	$OpenBSD: pwd.h,v 1.7 1999/09/01 20:47:58 deraadt Exp $	*/
d102 1
@


1.7
log
@proto bcrypt_gensalt()
@
text
@d1 1
a1 1
/*	$OpenBSD: pwd.h,v 1.6 1998/07/15 00:50:40 millert Exp $	*/
d101 1
a101 1
char		*bcrypt_gensalt __P((int));
@


1.6
log
@pw_uid is uid_t, pw_gid is gid_t
@
text
@d1 1
a1 1
/*	$OpenBSD: pwd.h,v 1.5 1997/02/16 20:54:28 provos Exp $	*/
d101 1
@


1.5
log
@small cleanup
@
text
@d1 1
a1 1
/*	$OpenBSD: pwd.h,v 1.4 1997/02/14 23:28:47 provos Exp $	*/
d81 2
a82 2
	int	pw_uid;			/* user uid */
	int	pw_gid;			/* user gid */
@


1.4
log
@passwd.conf define.
@
text
@d1 1
a1 1
/*	$OpenBSD: pwd.h,v 1.3 1996/10/16 09:08:27 downsj Exp $	*/
a74 4

#define _PASSWORD_OLD		1	/* Old Unix style passwords */
#define _PASSWORD_NSALT		2	/* Use extended salt + DES */
#define _PASSWORD_BLF		3	/* Adaptable Blowfish hash */
@


1.3
log
@_PW_YPTOKEN
@
text
@d1 1
a1 1
/*	$OpenBSD$	*/
d52 1
d75 4
@


1.2
log
@libutil
@
text
@d1 1
d12 1
a12 1
 * Portions Copyright(C) 1995, Jason Downs.  All rights reserved.
d63 2
@


1.1
log
@Initial revision
@
text
@d1 1
a1 1
/*	$NetBSD: pwd.h,v 1.8 1995/07/28 05:30:52 phil Exp $	*/
d52 1
@


1.1.1.1
log
@initial import of NetBSD tree
@
text
@@
