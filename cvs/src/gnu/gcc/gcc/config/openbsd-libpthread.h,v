head	1.5;
access;
symbols
	OPENBSD_6_1:1.5.0.18
	OPENBSD_6_1_BASE:1.5
	OPENBSD_6_0:1.5.0.16
	OPENBSD_6_0_BASE:1.5
	OPENBSD_5_9:1.5.0.12
	OPENBSD_5_9_BASE:1.5
	OPENBSD_5_8:1.5.0.14
	OPENBSD_5_8_BASE:1.5
	OPENBSD_5_7:1.5.0.6
	OPENBSD_5_7_BASE:1.5
	OPENBSD_5_6:1.5.0.10
	OPENBSD_5_6_BASE:1.5
	OPENBSD_5_5:1.5.0.8
	OPENBSD_5_5_BASE:1.5
	OPENBSD_5_4:1.5.0.4
	OPENBSD_5_4_BASE:1.5
	OPENBSD_5_3:1.5.0.2
	OPENBSD_5_3_BASE:1.5
	OPENBSD_5_2:1.2.0.10
	OPENBSD_5_2_BASE:1.2
	OPENBSD_5_1_BASE:1.2
	OPENBSD_5_1:1.2.0.8
	OPENBSD_5_0:1.2.0.6
	OPENBSD_5_0_BASE:1.2
	OPENBSD_4_9:1.2.0.4
	OPENBSD_4_9_BASE:1.2
	OPENBSD_4_8:1.2.0.2
	OPENBSD_4_8_BASE:1.2
	OPENBSD_4_7:1.1.0.2
	OPENBSD_4_7_BASE:1.1;
locks; strict;
comment	@ * @;


1.5
date	2013.01.15.23.38.06;	author brad;	state Exp;
branches;
next	1.4;

1.4
date	2012.08.24.18.51.41;	author kettenis;	state Exp;
branches;
next	1.3;

1.3
date	2012.08.15.18.08.22;	author matthew;	state Exp;
branches;
next	1.2;

1.2
date	2010.05.24.11.12.02;	author kettenis;	state Exp;
branches;
next	1.1;

1.1
date	2009.10.15.21.16.33;	author robert;	state Exp;
branches;
next	;


desc
@@


1.5
log
@Simplify OBSD_LIB_SPEC a bit for gcc3/4.

ok miod@@
@
text
@/* LIB_SPEC appropriate for OpenBSD.  Include -lpthread if -pthread is
   specified on the command line. */
/*   Copyright (C) 2004 Free Software Foundation, Inc.

This file is part of GNU CC.

GNU CC is free software; you can redistribute it and/or modify
it under the terms of the GNU General Public License as published by
the Free Software Foundation; either version 2, or (at your option)
any later version.

GNU CC is distributed in the hope that it will be useful,
but WITHOUT ANY WARRANTY; without even the implied warranty of
MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
GNU General Public License for more details.

You should have received a copy of the GNU General Public License
along with GNU CC; see the file COPYING.  If not, write to
the Free Software Foundation, 59 Temple Place - Suite 330,
Boston, MA 02111-1307, USA.  */

#define OBSD_LIB_SPEC "%{pthread:-lpthread%{!shared:%{p|pg:_p}}} %{!shared:-lc%{p|pg:_p}}"

@


1.4
log
@Back out the bit that links all shared libraries against -lc from the previous
commit.  It breaks make build on arm and generally causes more grief than the
the (small) benefit it is supposed to bring.

ok matthew@@
@
text
@d22 1
a22 1
#define OBSD_LIB_SPEC "%{pthread:-lpthread%{!shared:%{p|pg:_p}}} %{!shared:-lc%{p:_p}%{!p:%{pg:_p}}}"
@


1.3
log
@A couple small but long anticipated changes:

  - Link libpthread.so with -znodlopen.  Because libpthread overrides
    the weak symbols in libc, we can't allow it to be dynamically
    loaded or else libc's weak symbols might have already been
    resolved by ld.so.  (Also, major bump because this is technically
    a backwards incompat change in behavior, although dlopen()ing
    libpthread never really worked.)

  - Link libc.so with -nodefaultlibs -lgcc.  This ensures that libc
    doesn't try to link against itself (which ld.so wouldn't like).

  - Change GCC 4 to link shared objects with -lpthread and -lc as
    appropriate, now that there's no issues with doing so.  This means
    that it's no longer necessary to patch software to use -pthread
    instead of -lpthread.  (Ports tree rejoice!)

Also, to preemptively answer this question: No, this does not
eliminate the need for LD_PRELOAD=libpthread.so.  That's a separate
issue that won't be resolved until we eliminate libc's weak symbols.

Discussed extensively on email and icb over the past few months.
ok deraadt
@
text
@d22 1
a22 1
#define OBSD_LIB_SPEC "%{pthread:-lpthread%{!shared:%{p|pg:_p}}} -lc%{!shared:%{p|pg:_p}}"
@


1.2
log
@Link against libc_p and libpthread_p when -p or -pg is specified, like we did
for gcc3.

ok espie@@
@
text
@d22 1
a22 1
#define OBSD_LIB_SPEC "%{!shared:%{pthread:-lpthread%{p:_p}%{!p:%{pg:_p}}}} %{!shared:-lc%{p:_p}%{!p:%{pg:_p}}}"
@


1.1
log
@add target configuration for openbsd
@
text
@d22 2
a23 1
#define OBSD_LIB_SPEC "%{!shared:%{pthread:-lpthread} -lc}"
@

