head	1.7;
access;
symbols
	OPENBSD_5_4:1.6.0.4
	OPENBSD_5_4_BASE:1.6
	OPENBSD_5_3:1.6.0.2
	OPENBSD_5_3_BASE:1.6
	OPENBSD_5_2:1.5.0.50
	OPENBSD_5_2_BASE:1.5
	OPENBSD_5_1_BASE:1.5
	OPENBSD_5_1:1.5.0.48
	OPENBSD_5_0:1.5.0.46
	OPENBSD_5_0_BASE:1.5
	OPENBSD_4_9:1.5.0.44
	OPENBSD_4_9_BASE:1.5
	OPENBSD_4_8:1.5.0.42
	OPENBSD_4_8_BASE:1.5
	OPENBSD_4_7:1.5.0.38
	OPENBSD_4_7_BASE:1.5
	OPENBSD_4_6:1.5.0.40
	OPENBSD_4_6_BASE:1.5
	OPENBSD_4_5:1.5.0.36
	OPENBSD_4_5_BASE:1.5
	OPENBSD_4_4:1.5.0.34
	OPENBSD_4_4_BASE:1.5
	OPENBSD_4_3:1.5.0.32
	OPENBSD_4_3_BASE:1.5
	OPENBSD_4_2:1.5.0.30
	OPENBSD_4_2_BASE:1.5
	OPENBSD_4_1:1.5.0.28
	OPENBSD_4_1_BASE:1.5
	OPENBSD_4_0:1.5.0.26
	OPENBSD_4_0_BASE:1.5
	OPENBSD_3_9:1.5.0.24
	OPENBSD_3_9_BASE:1.5
	OPENBSD_3_8:1.5.0.22
	OPENBSD_3_8_BASE:1.5
	OPENBSD_3_7:1.5.0.20
	OPENBSD_3_7_BASE:1.5
	OPENBSD_3_6:1.5.0.18
	OPENBSD_3_6_BASE:1.5
	OPENBSD_3_5:1.5.0.16
	OPENBSD_3_5_BASE:1.5
	OPENBSD_3_4:1.5.0.14
	OPENBSD_3_4_BASE:1.5
	OPENBSD_3_3:1.5.0.12
	OPENBSD_3_3_BASE:1.5
	OPENBSD_3_2:1.5.0.10
	OPENBSD_3_2_BASE:1.5
	OPENBSD_3_1:1.5.0.8
	OPENBSD_3_1_BASE:1.5
	OPENBSD_3_0:1.5.0.6
	OPENBSD_3_0_BASE:1.5
	OPENBSD_2_9:1.5.0.4
	OPENBSD_2_9_BASE:1.5
	OPENBSD_2_8:1.5.0.2
	OPENBSD_2_8_BASE:1.5
	OPENBSD_2_7:1.3.0.4
	OPENBSD_2_7_BASE:1.3
	OPENBSD_2_6:1.3.0.2
	OPENBSD_2_6_BASE:1.3;
locks; strict;
comment	@# @;


1.7
date	2013.08.06.19.17.11;	author miod;	state dead;
branches;
next	1.6;

1.6
date	2012.08.31.00.11.27;	author deraadt;	state Exp;
branches;
next	1.5;

1.5
date	2000.08.25.14.36.39;	author maja;	state Exp;
branches;
next	1.4;

1.4
date	2000.05.15.06.10.20;	author niklas;	state Exp;
branches;
next	1.3;

1.3
date	99.05.28.21.53.16;	author espie;	state Exp;
branches;
next	1.2;

1.2
date	99.05.28.14.28.17;	author espie;	state Exp;
branches;
next	1.1;

1.1
date	99.05.26.15.47.01;	author espie;	state Exp;
branches;
next	;


desc
@@


1.7
log
@Remove gcc 2.95 from the tree. One of the least bogus compiler we had (although
it had required some generous bandaid), but unfortunately not able to compile
most of the Real World (tm) software.
@
text
@#	$OpenBSD: Makefile.bsd-wrapper,v 1.6 2012/08/31 00:11:27 deraadt Exp $

.if (${MACHINE_ARCH} == "mips")
MAKE+= -DNOPIC
NOPIC=
.endif

LIBIO=		io
LIBIOSTREAM=	iostream
LIB=		$(LIBIO)
CXXFLAGS+=	-fno-implicit-templates
CPPFLAGS+=	-I$(.CURDIR) -I$(.OBJDIR)
VERSION=	2.9.0

IO_SRCS=	filedoalloc.c floatconv.c genops.c fileops.c iovfprintf.c \
		iovfscanf.c ioignore.c iopadn.c iofgetpos.c iofread.c \
		iofscanf.c iofsetpos.c iogetdelim.c iogetline.c ioprintf.c \
		ioseekoff.c ioseekpos.c outfloat.c strops.c iofclose.c \
		iopopen.c ioungetc.c peekc.c iogetc.c ioputc.c iofeof.c \
		ioferror.c
STDIO_SRCS=	stdfiles.c
STDIO_WRAP_SRCS=iofdopen.c iofflush.c iofgets.c iofopen.c iofprintf.c \
		iofputs.c iofwrite.c iogets.c ioperror.c ioputs.c ioscanf.c \
		iosetbuffer.c iosetvbuf.c  iosprintf.c iosscanf.c ioftell.c \
		iovsscanf.c iovsprintf.c
IOSTREAM_SRCS=	builtinbuf.cc filebuf.cc fstream.cc indstream.cc ioassign.cc \
		ioextend.cc iomanip.cc iostream.cc isgetline.cc isgetsb.cc \
		isscan.cc osform.cc procbuf.cc sbform.cc sbgetline.cc \
		sbscan.cc stdiostream.cc stdstrbufs.cc stdstreams.cc \
		stream.cc streambuf.cc strstream.cc PlotFile.cc SFile.cc \
		parsestream.cc pfstream.cc editbuf.cc
OSPRIM_SRCS=	ioprims.c iostrerror.c cleanup.c
LIBIO_SRCS=	$(IO_SRCS) $(STDIO_WRAP_SRCS) $(OSPRIM_SRCS) $(STDIO_SRCS)
LIBIOSTREAM_SRCS= $(IO_SRCS) $(IOSTREAM_SRCS) $(OSPRIM_SRCS)

SRCS=		$(LIBIO_SRCS)

CLEANFILES+=	_G_config.h iostream.list dummy.h

all: _G_config.h iostream.list $(LIBIOSTREAM)

beforedepend:	_G_config.h

$(LIBIOSTREAM):
	@@if [ -z "$(MAKE_IOSTREAM)" ] ; then \
		cd $(.CURDIR); $(MAKE) -f $(.CURDIR)/Makefile.bsd-wrapper LIB=$(LIBIOSTREAM) SRCS='$$(LIBIOSTREAM_SRCS)' MAKE_IOSTREAM=true ; \
		exit ; \
	fi

_G_config.h: gen-params
	@@echo Building $(.TARGET)
	@@rootme=`pwd`/ ; export rootme; \
	CC="$(CC)"; export CC; \
	CXX="$(CXX) $(CXXFLAGS)"; export CXX; \
	CONFIG_NM="nm"; export CONFIG_NM; \
	sh $(.CURDIR)/gen-params LIB_VERSION=$(VERSION) $(G_CONFIG_ARGS) >tmp-params.h
	@@mv tmp-params.h _G_config.h

iostream.list: _G_config.h
	@@echo Generating $(.TARGET)
	@@echo "$(LIBIOSTREAM_SRCS:N*.h:R:S/$/.o/g)" > iostream.list
clean:
	rm -f a.out [Ee]rrs mklog core *.core $(CLEANFILES)
	rm -f lib$(LIBIO).a $(LIBIO_SRCS:.c=.o)
	rm -f lib$(LIBIO)_g.a $(LIBIO_SRCS:.c=.go)
	rm -f lib$(LIBIO)_p.a $(LIBIO_SRCS:.c=.po)
	rm -f lib$(LIBIO).so.*.* $(LIBIO_SRCS:.c=.so)
	rm -f llib-lib$(LIBIO).ln $(LIBIO_SRCS:.c=.ln)
	rm -f lib$(LIBIOSTREAM).a $(IOSTREAM_SRCS:.cc=.o)
	rm -f lib$(LIBIOSTREAM)_g.a $(IOSTREAM_SRCS:.cc=.go)
	rm -f lib$(LIBIOSTREAM)_p.a $(IOSTREAM_SRCS:.cc=.po)
	rm -f lib$(LIBIOSTREAM).so.*.* \
		 $(IOSTREAM_SRCS:.cc=.so)
	rm -f llib-lib$(LIBIOSTREAM).ln $(IOSTREAM_SRCS:.cc=.ln)

includes: _G_config.h
	@@install -d -m 755 -o $(BINOWN) -g $(BINGRP) $(DESTDIR)/usr/include/g++
	@@-cd $(.CURDIR); for i in *.h; do \
		if [ -e $$i ]; then \
			cmp -s $$i $(DESTDIR)/usr/include/g++/$$i || \
			install -c -o $(BINOWN) -g $(BINGRP) -m $(NONBINMODE) \
			    $$i $(DESTDIR)/usr/include/g++/$$i; \
		fi \
	done
	@@cmp -s _G_config.h $(DESTDIR)/usr/include/g++/_G_config.h || \
			install -c -o $(BINOWN) -g $(BINGRP) -m $(NONBINMODE) \
			    _G_config.h $(DESTDIR)/usr/include/g++/_G_config.h

install:
	@@echo "done"
#	@@-cd $(.CURDIR); for i in iostream.info* ; do \
#		cmp -s $$i $(DESTDIR)/usr/share/info/$$i || \
#	install -c -o $(BINOWN) -g $(BINGRP) -m $(NONBINMODE) \
#		 $$i $(DESTDIR)/usr/share/info/$$i; \
#	done

.include <bsd.lib.mk>
@


1.6
log
@No longer create lib*_pic.a files.  Nothing uses them anymore.
grep help from sthen; discussion with brad
ok guenther pascal
@
text
@d1 1
a1 1
#	$OpenBSD: Makefile.bsd-wrapper,v 1.5 2000/08/25 14:36:39 maja Exp $
@


1.5
log
@Move NOPIC for mips from toplevel to the libraries that have problems
with shared libraries. This will allow libiberty.so to be created by
default. -moj
@
text
@d1 1
a1 1
#	$OpenBSD: Makefile.bsd-wrapper,v 1.4 2000/05/15 06:10:20 niklas Exp $
d67 1
a67 1
	rm -f lib$(LIBIO)_pic.a lib$(LIBIO).so.*.* $(LIBIO_SRCS:.c=.so)
d72 1
a72 1
	rm -f lib$(LIBIOSTREAM)_pic.a lib$(LIBIOSTREAM).so.*.* \
@


1.4
log
@Add support for building libraries with debugging information in them.
Enable by setting DEBUGLIBS=yes in /etc/mk.conf, then -g libraries will get
installed in /usr/lib/debug.  This directory will be searched first if
gcc is given the -g flag during the link stage.
@
text
@d1 6
a6 1
#	$OpenBSD: Makefile.bsd-wrapper,v 1.3 1999/05/28 21:53:16 espie Exp $
@


1.3
log
@forgot to install _G_config.h, somehow...
@
text
@d1 1
a1 1
#	$OpenBSD: Makefile.bsd-wrapper,v 1.2 1999/05/28 14:28:17 espie Exp $
d60 1
d65 1
@


1.2
log
@Kill senseless duplication
@
text
@d1 1
a1 1
#	$OpenBSD: Makefile.bsd-wrapper,v 1.1 1999/05/26 15:47:01 espie Exp $
d69 2
a70 2
includes:
	install -d -m 755 -o $(BINOWN) -g $(BINGRP) $(DESTDIR)/usr/include/g++
d78 3
@


1.1
log
@Wrappers + lib versions
@
text
@d1 1
a1 1
#	$OpenBSD: Makefile.bsd-wrapper,v 1.7 1998/03/19 17:13:20 niklas Exp $
a34 2
FILES=		*.h

d71 1
a71 8
	@@-cd $(.CURDIR); for i in $(FILES); do \
		if [ -e $$i ]; then \
			cmp -s $$i $(DESTDIR)/usr/include/g++/$$i || \
			install -c -o $(BINOWN) -g $(BINGRP) -m $(NONBINMODE) \
			    $$i $(DESTDIR)/usr/include/g++/$$i; \
		fi \
	done
	@@-for i in $(FILES); do \
@

