head	1.9;
access;
symbols
	OPENBSD_3_7:1.8.0.2
	OPENBSD_3_7_BASE:1.8
	OPENBSD_3_6:1.6.0.4
	OPENBSD_3_6_BASE:1.6
	OPENBSD_3_5:1.6.0.2
	OPENBSD_3_5_BASE:1.6
	OPENBSD_3_4:1.5.0.8
	OPENBSD_3_4_BASE:1.5
	OPENBSD_3_3:1.5.0.6
	OPENBSD_3_3_BASE:1.5
	OPENBSD_3_2:1.5.0.4
	OPENBSD_3_2_BASE:1.5
	OPENBSD_3_1:1.5.0.2
	OPENBSD_3_1_BASE:1.5
	OPENBSD_3_0:1.4.0.6
	OPENBSD_3_0_BASE:1.4
	OPENBSD_2_9:1.4.0.4
	OPENBSD_2_9_BASE:1.4
	OPENBSD_2_8:1.4.0.2
	OPENBSD_2_8_BASE:1.4
	OPENBSD_2_7:1.3.0.4
	OPENBSD_2_7_BASE:1.3
	OPENBSD_2_6:1.3.0.2
	OPENBSD_2_6_BASE:1.3;
locks; strict;
comment	@# @;


1.9
date	2005.05.01.17.42.48;	author espie;	state dead;
branches;
next	1.8;

1.8
date	2005.01.09.22.27.07;	author espie;	state Exp;
branches;
next	1.7;

1.7
date	2004.09.18.20.54.45;	author deraadt;	state Exp;
branches;
next	1.6;

1.6
date	2003.11.24.17.12.55;	author espie;	state Exp;
branches;
next	1.5;

1.5
date	2001.11.22.20.37.18;	author espie;	state Exp;
branches;
next	1.4;

1.4
date	2000.05.15.06.10.21;	author niklas;	state Exp;
branches;
next	1.3;

1.3
date	99.09.24.08.25.14;	author espie;	state Exp;
branches;
next	1.2;

1.2
date	99.06.18.00.20.22;	author espie;	state Exp;
branches;
next	1.1;

1.1
date	99.05.26.15.47.01;	author espie;	state Exp;
branches;
next	;


desc
@@


1.9
log
@bye, bye.
miod@@ checked this does not impact builds on old arches.
@
text
@#	$OpenBSD: Makefile.bsd-wrapper,v 1.8 2005/01/09 22:27:07 espie Exp $

NOLINT=

LIB=		objc

LIBIBERTY_INCLUDES=${.CURDIR}/../../lib/libiberty/include
#LDADD+=		-lm

EGCS_DIR= $(.CURDIR)/..
.if defined(MAKEOBJDIR)
OBJDIR=${MAKEOBJDIR}
.elif defined(OBJMACHINE)
OBJDIR=	obj.${MACHINE}
.else
OBJDIR=	obj
.endif
EGCS_OBJDIR!=	if [ -d $(EGCS_DIR)/$(OBJDIR) ]; then \
			echo $(EGCS_DIR)/$(OBJDIR); \
		else \
			echo $(EGCS_DIR); \
		fi

CPPFLAGS+= -I. -I$(.CURDIR) -I$(.CURDIR)/objc  -I$(.CURDIR)/../gcc \
-I$(.CURDIR)/../gcc/config  -I$(EGCS_OBJDIR)/gcc -I$(LIBIBERTY_INCLUDES) \
-DIN_GCC

SRCS=archive.c class.c encoding.c gc.c hash.c init.c linking.m misc.c \
nil_method.c NXConstStr.m Object.m objects.c Protocol.m sarray.c  \
selector.c sendmsg.c thr.c thr-single.c

CLEANFILES= config.cache config.status config.log Makefile runtime-info.h
#CFLAGS+=-save-temps


includes:
	install -d -m 755 -o $(BINOWN) -g $(BINGRP) \
		$(DESTDIR)/usr/include/objc
	@@-cd $(.CURDIR)/objc; for i in *.h; do \
		[ $$i = "runtime.h" ] || install -C -o $(BINOWN) -g $(BINGRP) -m $(NONBINMODE) \
				$$i $(DESTDIR)/usr/include/objc/$$i; \
	done
	

all: config.status

depend: 
	cd ${.CURDIR}/../gcc && make -f Makefile.bsd-wrapper config.status target_path

sendmsg.o sendmsg.go sendmsg.po sendmsg.so: runtime-info.h

runtime-info.h:
		echo "" > tmp-runtime
		echo "/* This file is automatically generated */" > $@@
		`$(CC) -print-prog-name=cc1obj` -print-objc-runtime-info tmp-runtime >> $@@
		rm -f tmp-runtime

config.status: Makefile.in configure 
	cd $(EGCS_OBJDIR)/gcc && touch cc1obj
	PATH="/bin:/usr/bin:/sbin:/usr/sbin" \
	INSTALL_PROGRAM="${INSTALL} ${INSTALL_COPY} ${INSTALL_STRIP}" \
	GNUSYSTEM_AUX_DIR=${GNUSYSTEM_AUX_DIR} \
	r=$(EGCS_OBJDIR) \
	/bin/sh ${.CURDIR}/configure \
		--prefix=/usr --with-local-prefix=/usr ${CF} \
		&& touch config.status

.include <bsd.lib.mk>
COMPILE.m=${COMPILE.c} -fgnu-runtime

gc.o: gc.c
	@@echo "${COMPILE.m} ${.ALLSRC} -o ${.TARGET}"
	@@${COMPILE.m} ${.ALLSRC}  -o ${.TARGET}.o
	@@${LD} -x -r ${.TARGET}.o -o ${.TARGET}
	@@rm -f ${.TARGET}.o
	
gc.go: gc.c
	@@echo "${COMPILE.m} -g ${.ALLSRC} -o ${.TARGET}"
	@@${COMPILE.m} -g ${.ALLSRC} -o ${.TARGET}.o
	@@${LD} -X -r ${.TARGET}.o -o ${.TARGET}
	@@rm -f ${.TARGET}.o

gc.po: gc.c
	@@echo "${COMPILE.m} -p ${.ALLSRC} -o ${.TARGET}"
	@@${COMPILE.m} -p ${.ALLSRC} -o ${.TARGET}.o
	@@${LD} -X -r ${.TARGET}.o -o ${.TARGET}
	@@rm -f ${.TARGET}.o

gc.so: gc.c
	@@echo "${COMPILE.m} ${PICFLAG} -DPIC ${.ALLSRC} -o ${.TARGET}"
	@@${COMPILE.m} ${PICFLAG} -DPIC ${.ALLSRC} -o ${.TARGET}.o
	@@${LD} -x -r ${.TARGET}.o -o ${.TARGET}
	@@rm -f ${.TARGET}.o

.m.o:
	@@echo "${COMPILE.m} ${.IMPSRC} -o ${.TARGET}"
	@@${COMPILE.m} ${.IMPSRC}  -o ${.TARGET}.o
	@@${LD} -x -r ${.TARGET}.o -o ${.TARGET}
	@@rm -f ${.TARGET}.o

.m.go:
	@@echo "${COMPILE.m} -g ${.IMPSRC} -o ${.TARGET}"
	@@${COMPILE.m} -g ${.IMPSRC} -o ${.TARGET}.o
	@@${LD} -X -r ${.TARGET}.o -o ${.TARGET}
	@@rm -f ${.TARGET}.o

.m.po:
	@@echo "${COMPILE.m} -p ${.IMPSRC} -o ${.TARGET}"
	@@${COMPILE.m} -p ${.IMPSRC} -o ${.TARGET}.o
	@@${LD} -X -r ${.TARGET}.o -o ${.TARGET}
	@@rm -f ${.TARGET}.o

.m.so:
	@@echo "${COMPILE.m} ${PICFLAG} -DPIC ${.IMPSRC} -o ${.TARGET}"
	@@${COMPILE.m} ${PICFLAG} -DPIC ${.IMPSRC} -o ${.TARGET}.o
	@@${LD} -x -r ${.TARGET}.o -o ${.TARGET}
	@@rm -f ${.TARGET}.o

@


1.8
log
@go look in MAKEOBJDIR if defined, ensuring cross-pieces have a chance
to find each other.

okay niklas@@ (`deja-vu')
@
text
@d1 1
a1 1
#	$OpenBSD: Makefile.bsd-wrapper,v 1.7 2004/09/18 20:54:45 deraadt Exp $
@


1.7
log
@gnu code will never, ever, EVER, get close to passing lint
@
text
@d1 1
a1 1
#	$OpenBSD: Makefile.bsd-wrapper,v 1.6 2003/11/24 17:12:55 espie Exp $
d11 3
a13 1
.if defined(OBJMACHINE)
@


1.6
log
@Switch to using libiberty in new location.
Disable building of cxxfilt in gcc, build it from its own directory.
@
text
@d1 3
a3 1
#	$OpenBSD: Makefile.bsd-wrapper,v 1.5 2001/11/22 20:37:18 espie Exp $
@


1.5
log
@Bad .IMPSRC.
@
text
@d1 1
a1 1
#	$OpenBSD: Makefile.bsd-wrapper,v 1.4 2000/05/15 06:10:21 niklas Exp $
d5 1
a5 2
#CXXFLAGS+=	-fno-implicit-templates
#CPPFLAGS+=	-I$(.CURDIR) -I$(.CURDIR)/stl -I$(.CURDIR)/../libio -I$(IO_OBJDIR)
d21 1
a21 1
-I$(.CURDIR)/../gcc/config  -I$(EGCS_OBJDIR)/gcc -I$(.CURDIR)/../include \
@


1.4
log
@Add support for building libraries with debugging information in them.
Enable by setting DEBUGLIBS=yes in /etc/mk.conf, then -g libraries will get
installed in /usr/lib/debug.  This directory will be searched first if
gcc is given the -g flag during the link stage.
@
text
@d1 1
a1 1
#	$OpenBSD: Makefile.bsd-wrapper,v 1.3 1999/09/24 08:25:14 espie Exp $
d59 1
d69 2
a70 2
	@@echo "${COMPILE.m} ${.IMPSRC} -o ${.TARGET}"
	@@${COMPILE.m} ${.IMPSRC}  -o ${.TARGET}.o
d75 2
a76 2
	@@echo "${COMPILE.m} -g ${.IMPSRC} -o ${.TARGET}"
	@@${COMPILE.m} -g ${.IMPSRC} -o ${.TARGET}.o
d81 2
a82 2
	@@echo "${COMPILE.m} -p ${.IMPSRC} -o ${.TARGET}"
	@@${COMPILE.m} -p ${.IMPSRC} -o ${.TARGET}.o
d87 2
a88 2
	@@echo "${COMPILE.m} ${PICFLAG} -DPIC ${.IMPSRC} -o ${.TARGET}"
	@@${COMPILE.m} ${PICFLAG} -DPIC ${.IMPSRC} -o ${.TARGET}.o
@


1.3
log
@Fix 2.5->2.6 problem, by propagating Makefile.in recent change to the
wrapper.
@
text
@d1 1
a1 1
#	$OpenBSD: Makefile.bsd-wrapper,v 1.2 1999/06/18 00:20:22 espie Exp $
d47 1
a47 1
sendmsg.o sengmsg.po sendmsg.so: runtime-info.h
d73 6
d95 6
@


1.2
log
@Help stupid cvs which would tend to bring back old stuff from the dead...
@
text
@d1 1
a1 1
#	$OpenBSD: Makefile.bsd-wrapper,v 1.1 1999/05/26 15:47:01 espie Exp $
d52 1
a52 1
		`cat $(EGCS_OBJDIR)/gcc/target_path`/cc1obj -print-objc-runtime-info tmp-runtime >> $@@
@


1.1
log
@Wrappers + lib versions
@
text
@d1 1
a1 1
#	$OpenBSD: Makefile.bsd-wrapper,v 1.9 1998/09/20 03:27:18 millert Exp $
a64 1
.SUFFIXES: .m
@

