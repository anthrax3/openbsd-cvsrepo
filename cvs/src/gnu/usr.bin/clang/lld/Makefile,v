head	1.10;
access;
symbols
	OPENBSD_6_2_BASE:1.10
	OPENBSD_6_1:1.7.0.4
	OPENBSD_6_1_BASE:1.7;
locks; strict;
comment	@# @;


1.10
date	2017.07.27.10.23.25;	author espie;	state Exp;
branches;
next	1.9;
commitid	udhzooW49eQt6GGp;

1.9
date	2017.07.09.15.28.36;	author espie;	state Exp;
branches;
next	1.8;
commitid	AZstanCImDR1vYEO;

1.8
date	2017.04.17.19.58.53;	author pascal;	state Exp;
branches;
next	1.7;
commitid	udpseXCgFSyxKnkj;

1.7
date	2017.03.27.15.32.38;	author kettenis;	state Exp;
branches;
next	1.6;
commitid	Egec5yAzKmYIwmzS;

1.6
date	2017.01.24.08.44.47;	author patrick;	state Exp;
branches;
next	1.5;
commitid	nAFx1y3cdFPkOgnP;

1.5
date	2017.01.22.07.16.36;	author patrick;	state Exp;
branches;
next	1.4;
commitid	tdgosXE0zTP9WsIu;

1.4
date	2017.01.22.06.07.21;	author patrick;	state Exp;
branches;
next	1.3;
commitid	Mc2ACRXnOpgZLC4u;

1.3
date	2017.01.22.06.00.14;	author patrick;	state Exp;
branches;
next	1.2;
commitid	jqG9weJJTkAGxCJz;

1.2
date	2017.01.22.03.56.33;	author jsg;	state Exp;
branches;
next	1.1;
commitid	TxnimS7C0HXYAyJh;

1.1
date	2017.01.22.03.13.07;	author patrick;	state Exp;
branches;
next	;
commitid	2ASnr5EjM0FoVttJ;


desc
@@


1.10
log
@don't double install ld, some people have already been lost trying
to get out of these makefiles!

okay kettenis@@
@
text
@# $OpenBSD: Makefile,v 1.9 2017/07/09 15:28:36 espie Exp $

.include <bsd.own.mk>

PROG=	ld.lld
BINDIR=	/usr/bin
SRCS=	lld.cpp
NOMAN=

TARGET_ARCH?=	${MACHINE_ARCH}
.if ${TARGET_ARCH} == "aarch64"
LINKS=	${BINDIR}/ld.lld ${BINDIR}/ld
.endif

CPPFLAGS+=	${CLANG_INCLUDES}
CPPFLAGS+=	-I${.CURDIR}/../../../llvm/tools/lld/include

.PATH:	${.CURDIR}/../../../llvm/tools/lld/tools/lld

LLVM_LIBDEPS=	lldELF \
		lldConfig \
		lldCore \
		LLVMLTO \
		LLVMPasses \
		LLVMOption \
		LLVMObjCARCOpts \
		LLVMipo \
		LLVMVectorize \
		LLVMLinker \
		LLVMIRReader \
		LLVMAsmParser \
		${BACKEND_ASMPARSER} \
		${BACKEND_CODEGEN} \
		LLVMSelectionDAG \
		LLVMAsmPrinter \
		LLVMCodeGen \
		LLVMTarget \
		LLVMScalarOpts \
		LLVMInstCombine \
		LLVMInstrumentation \
		LLVMProfileData \
		LLVMCoverage \
		LLVMDebugInfoCodeView \
		LLVMDebugInfoDWARF \
		LLVMDebugInfoMSF \
		LLVMGlobalISel \
		LLVMTransformUtils \
		LLVMCoroutines \
		LLVMDemangle \
		LLVMBitWriter \
		LLVMAnalysis \
		${BACKEND_DESC} \
		LLVMObject \
		LLVMMCParser \
		LLVMBitReader \
		LLVMMCDisassembler \
		${BACKEND_INFO} \
		${BACKEND_ASMPRINTER} \
		LLVMMC \
		${BACKEND_UTILS} \
		LLVMCore \
		LLVMSupport

.include <bsd.prog.mk>
@


1.9
log
@zap empty depends/silence empty installs.
okay millert@@
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.8 2017/04/17 19:58:53 pascal Exp $
d10 2
a11 1
.if ${COMPILER_VERSION:L} == "clang"
@


1.8
log
@Take a more radical approach to disabling colours: pretend we don't
HAVE_TERMINFO in our local config.h.  Some of the lower levels of LLVM
don't seem to respect our default setting.

As a result, delete the -ltermlib dependency.

Note that this breaks -fcolor-diagnostics=auto.  However, fixing the whole
codebase is out of scope for now ...

Prompted by an instance found in the AsmParser by deraadt@@

ok kettenis@@ patrick@@
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.7 2017/03/27 15:32:38 kettenis Exp $
a17 3

depend:
	# Nothing here so far ...
@


1.7
log
@Do not clobber the default compiler/linker links unless COMPILER_VERSION is
set to clang.

ok jsg@@
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.6 2017/01/24 08:44:47 patrick Exp $
a8 3

LDADD+=	-ltermlib
DPADD+=	${LIBTERMLIB}
@


1.6
log
@Update clang build infrastructure for LLVM 4.0.0

Discussed with kettenis@@
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.5 2017/01/22 07:16:36 patrick Exp $
d13 1
d15 1
@


1.5
log
@Always provide clang as cc, c++ and cpp, and lld as ld.

Per discussion with deraadt@@
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.4 2017/01/22 06:07:21 patrick Exp $
d23 1
a23 2
LLVM_LIBDEPS=	lldCore \
		lldELF \
d25 1
d47 2
d51 2
@


1.4
log
@On clang architectures cc, c++ and cpp are provided by clang.  Also,
ld is provided by lld.
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.3 2017/01/22 06:00:14 patrick Exp $
a12 1
.if ${COMPILER_VERSION:L} == "clang"
a13 1
.endif
@


1.3
log
@Compile and install lld as ld.lld, since that's what the ecosystem
is expecting.

Prompted and ok by kettenis@@
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.2 2017/01/22 03:56:33 jsg Exp $
d12 4
@


1.2
log
@Include bsd.own.mk in a few more places to pick up mk.conf overrides.
ok patrick@@ tb@@ kettenis@@ phessler@@
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.1 2017/01/22 03:13:07 patrick Exp $
d5 1
a5 1
PROG=	lld
@


1.1
log
@Add build infrastructure for lld.

ok kettenis@@
@
text
@d1 3
a3 1
# $OpenBSD: Makefile,v 1.2 2017/01/14 20:12:41 patrick Exp $
@

