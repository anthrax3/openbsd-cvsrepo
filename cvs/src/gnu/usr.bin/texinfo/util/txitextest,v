head	1.1;
branch	1.1.1;
access;
symbols
	OPENBSD_6_1:1.1.1.1.0.46
	OPENBSD_6_1_BASE:1.1.1.1
	OPENBSD_6_0:1.1.1.1.0.42
	OPENBSD_6_0_BASE:1.1.1.1
	OPENBSD_5_9:1.1.1.1.0.38
	OPENBSD_5_9_BASE:1.1.1.1
	OPENBSD_5_8:1.1.1.1.0.40
	OPENBSD_5_8_BASE:1.1.1.1
	OPENBSD_5_7:1.1.1.1.0.32
	OPENBSD_5_7_BASE:1.1.1.1
	OPENBSD_5_6:1.1.1.1.0.36
	OPENBSD_5_6_BASE:1.1.1.1
	OPENBSD_5_5:1.1.1.1.0.34
	OPENBSD_5_5_BASE:1.1.1.1
	OPENBSD_5_4:1.1.1.1.0.30
	OPENBSD_5_4_BASE:1.1.1.1
	OPENBSD_5_3:1.1.1.1.0.28
	OPENBSD_5_3_BASE:1.1.1.1
	OPENBSD_5_2:1.1.1.1.0.26
	OPENBSD_5_2_BASE:1.1.1.1
	OPENBSD_5_1_BASE:1.1.1.1
	OPENBSD_5_1:1.1.1.1.0.24
	OPENBSD_5_0:1.1.1.1.0.22
	OPENBSD_5_0_BASE:1.1.1.1
	OPENBSD_4_9:1.1.1.1.0.20
	OPENBSD_4_9_BASE:1.1.1.1
	OPENBSD_4_8:1.1.1.1.0.18
	OPENBSD_4_8_BASE:1.1.1.1
	OPENBSD_4_7:1.1.1.1.0.14
	OPENBSD_4_7_BASE:1.1.1.1
	OPENBSD_4_6:1.1.1.1.0.16
	OPENBSD_4_6_BASE:1.1.1.1
	OPENBSD_4_5:1.1.1.1.0.12
	OPENBSD_4_5_BASE:1.1.1.1
	OPENBSD_4_4:1.1.1.1.0.10
	OPENBSD_4_4_BASE:1.1.1.1
	OPENBSD_4_3:1.1.1.1.0.8
	OPENBSD_4_3_BASE:1.1.1.1
	OPENBSD_4_2:1.1.1.1.0.6
	OPENBSD_4_2_BASE:1.1.1.1
	OPENBSD_4_1:1.1.1.1.0.4
	OPENBSD_4_1_BASE:1.1.1.1
	OPENBSD_4_0:1.1.1.1.0.2
	OPENBSD_4_0_BASE:1.1.1.1
	TEXINFO_4_8:1.1.1.1
	FSF:1.1.1;
locks; strict;
comment	@# @;


1.1
date	2006.07.17.16.03.51;	author espie;	state Exp;
branches
	1.1.1.1;
next	;

1.1.1.1
date	2006.07.17.16.03.51;	author espie;	state Exp;
branches;
next	;


desc
@@



1.1
log
@Initial revision
@
text
@#!/bin/sh
# $Id: txitextest,v 1.5 2004/04/11 17:56:47 karl Exp $
# Test texinfo.tex changes by running various manuals through with an
# old version, saving the .ps result from dvips, doing the same with a
# new version, and comparing.  Idea from Stepan Kasal.
# 
# Another option is to run the manuals all the way through using
# texi2dvi, which tests in another way.

tsrc=/u/texinfo/src
PATH=$tsrc/util:$PATH

tdoc=$tsrc/doc
default_manuals="$tdoc/texinfo.txi $tdoc/info.texi $tdoc/info-stnd.texi"

olddir=$HOME/gnu/src/gnulib/config
newdir=$tdoc
tempdir=/u/texinfo/@@tests/testdir
full=false
manuals=

while test $# -gt 0; do
  case $1 in
  --f*) full=true;;
  --o*) shift; olddir="$1";;
  --n*) shift; newdir="$1";;
  --t*) shift; tempdir="$1";;
  -*) echo "$0: unknown option \`$1'." >&2; exit 1;;
  *) manuals="$manuals $1";;
  esac
  shift
done

test -z "$manuals" && manuals=$default_manuals
initial_dir=`pwd`

cd $tempdir || exit 1
rm -f *

run_tex() \
{
  TEXINPUTS=.:$mandir: tex $manual \
  || { echo "tex $manual failed." >&2; exit 1; }
}

for manual in $manuals; do
  mandir=`dirname $manual`
  test $mandir = . && mandir=$initial_dir
  manual_base=`basename "$manual" | sed 's/\.[^.]*$//'`
  
  rm -f $manual_base.* texinfo.tex
  ln -s $newdir/texinfo.tex texinfo.tex

  if $full; then
    # instead of comparing, do full test of just the new texinfo.tex.
    echo "$0: testing $manual_base... (tex)"
    texi2dvi $manual || { echo "texi2dvi $manual failed." >&2; exit 1; }
    echo "$0: testing $manual_base... (pdf)"
    texi2dvi --pdf $manual \
    || { echo "texi2dvi --pdf $manual failed." >&2; exit 1; }
   
  else
    echo "$0: testing $manual_base... (new)"
    run_tex
    dvips $manual_base -o || exit 1
    mv $manual_base.ps new.$manual_base.ps

    echo "$0: testing $manual_base... (old)"
    rm -f $manual_base.* texinfo.tex
    ln -s $olddir/texinfo.tex texinfo.tex
    run_tex
    dvips $manual_base -o || exit 1
    mv $manual_base.ps old.$manual_base.ps

    diff -U0 old.$manual_base.ps new.$manual_base.ps
  fi
done
@


1.1.1.1
log
@import texinfo 4.8 into the tree.
(okay theo, kettenis)
@
text
@@
