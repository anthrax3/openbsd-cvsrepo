head	1.19;
access;
symbols
	OPENBSD_6_0:1.18.0.8
	OPENBSD_6_0_BASE:1.18
	OPENBSD_5_9:1.18.0.2
	OPENBSD_5_9_BASE:1.18
	OPENBSD_5_8:1.18.0.4
	OPENBSD_5_8_BASE:1.18
	PERL_5_20_2:1.1.1.17
	OPENBSD_5_7:1.17.0.2
	OPENBSD_5_7_BASE:1.17
	PERL_5_20_1:1.1.1.16
	OPENBSD_5_6:1.16.0.4
	OPENBSD_5_6_BASE:1.16
	PERL_5_18_2:1.1.1.15
	PERL:1.1.1
	OPENBSD_5_5:1.15.0.6
	OPENBSD_5_5_BASE:1.15
	OPENBSD_5_4:1.15.0.2
	OPENBSD_5_4_BASE:1.15
	PERL_5_16_3:1.1.1.14
	OPENBSD_5_3:1.14.0.10
	OPENBSD_5_3_BASE:1.14
	OPENBSD_5_2:1.14.0.8
	OPENBSD_5_2_BASE:1.14
	OPENBSD_5_1_BASE:1.14
	OPENBSD_5_1:1.14.0.6
	OPENBSD_5_0:1.14.0.4
	OPENBSD_5_0_BASE:1.14
	OPENBSD_4_9:1.14.0.2
	OPENBSD_4_9_BASE:1.14
	PERL_5_12_2:1.1.1.13
	OPENBSD_4_8:1.13.0.4
	OPENBSD_4_8_BASE:1.13
	OPENBSD_4_7:1.13.0.2
	OPENBSD_4_7_BASE:1.13
	PERL_5_10_1:1.1.1.12
	OPENBSD_4_6:1.12.0.6
	OPENBSD_4_6_BASE:1.12
	OPENBSD_4_5:1.12.0.2
	OPENBSD_4_5_BASE:1.12
	PERL_5_10_0:1.1.1.11
	OPENBSD_4_4:1.11.0.10
	OPENBSD_4_4_BASE:1.11
	OPENBSD_4_3:1.11.0.8
	OPENBSD_4_3_BASE:1.11
	OPENBSD_4_2:1.11.0.6
	OPENBSD_4_2_BASE:1.11
	OPENBSD_4_1:1.11.0.4
	OPENBSD_4_1_BASE:1.11
	OPENBSD_4_0:1.11.0.2
	OPENBSD_4_0_BASE:1.11
	PERL_5_8_8:1.1.1.10
	OPENBSD_3_9:1.10.0.6
	OPENBSD_3_9_BASE:1.10
	OPENBSD_3_8:1.10.0.4
	OPENBSD_3_8_BASE:1.10
	OPENBSD_3_7:1.10.0.2
	OPENBSD_3_7_BASE:1.10
	PERL_5_8_6:1.1.1.9
	OPENBSD_3_6:1.9.0.2
	OPENBSD_3_6_BASE:1.9
	PERL_5_8_5:1.1.1.8
	PERL_5_8_3:1.1.1.7
	OPENBSD_3_5:1.7.0.2
	OPENBSD_3_5_BASE:1.7
	PERL_5_8_2:1.1.1.6
	OPENBSD_3_4:1.6.0.4
	OPENBSD_3_4_BASE:1.6
	OPENBSD_3_3:1.6.0.2
	OPENBSD_3_3_BASE:1.6
	PERL_5_8_0:1.1.1.5
	OPENBSD_3_2:1.5.0.6
	OPENBSD_3_2_BASE:1.5
	OPENBSD_3_1:1.5.0.4
	OPENBSD_3_1_BASE:1.5
	OPENBSD_3_0:1.5.0.2
	OPENBSD_3_0_BASE:1.5
	PERL_5_6_1:1.1.1.4
	OPENBSD_2_9:1.4.0.6
	OPENBSD_2_9_BASE:1.4
	OPENBSD_2_8:1.4.0.4
	OPENBSD_2_8_BASE:1.4
	OPENBSD_2_7:1.4.0.2
	OPENBSD_2_7_BASE:1.4
	PERL_5_6_0:1.1.1.3
	OPENBSD_2_6:1.3.0.2
	OPENBSD_2_6_BASE:1.3
	PERL_500503:1.1.1.2
	CPAN:1.1.1
	OPENBSD_2_5:1.2.0.6
	OPENBSD_2_5_BASE:1.2
	OPENBSD_2_4:1.2.0.4
	OPENBSD_2_4_BASE:1.2
	OPENBSD_2_3:1.2.0.2
	OPENBSD_2_3_BASE:1.2
	OPENBSD_2_2:1.1.1.1.0.6
	OPENBSD_2_2_BASE:1.1.1.1
	OPENBSD_2_1:1.1.1.1.0.4
	OPENBSD_2_1_BASE:1.1.1.1
	OPENBSD_2_0:1.1.1.1.0.2
	OPENBSD_2_0_BASE:1.1.1.1
	perl5003:1.1.1.1
	lwall:1.1.1;
locks; strict;
comment	@# @;
expand	@o@;


1.19
date	2017.02.05.00.32.19;	author afresh1;	state Exp;
branches;
next	1.18;
commitid	cxJ08BvJA9Pt2PTM;

1.18
date	2015.04.25.19.14.48;	author afresh1;	state Exp;
branches;
next	1.17;
commitid	XRK22kO4se3v2i2I;

1.17
date	2014.11.17.20.57.07;	author afresh1;	state Exp;
branches;
next	1.16;
commitid	QP75iYx42Uo7mMxO;

1.16
date	2014.03.24.15.05.33;	author afresh1;	state Exp;
branches;
next	1.15;

1.15
date	2013.03.25.20.40.59;	author sthen;	state Exp;
branches;
next	1.14;

1.14
date	2010.09.24.15.07.04;	author millert;	state Exp;
branches;
next	1.13;

1.13
date	2009.10.12.18.24.47;	author millert;	state Exp;
branches;
next	1.12;

1.12
date	2008.09.29.17.36.17;	author millert;	state Exp;
branches;
next	1.11;

1.11
date	2006.03.28.19.23.11;	author millert;	state Exp;
branches;
next	1.10;

1.10
date	2005.01.15.21.30.37;	author millert;	state Exp;
branches;
next	1.9;

1.9
date	2004.08.09.18.10.16;	author millert;	state Exp;
branches;
next	1.8;

1.8
date	2004.04.07.21.33.09;	author millert;	state Exp;
branches;
next	1.7;

1.7
date	2003.12.03.03.02.46;	author millert;	state Exp;
branches;
next	1.6;

1.6
date	2002.10.27.22.25.34;	author millert;	state Exp;
branches;
next	1.5;

1.5
date	2001.05.24.18.35.59;	author millert;	state Exp;
branches;
next	1.4;

1.4
date	2000.04.06.17.07.39;	author millert;	state Exp;
branches;
next	1.3;

1.3
date	99.04.29.22.52.19;	author millert;	state Exp;
branches;
next	1.2;

1.2
date	97.11.30.07.59.29;	author millert;	state Exp;
branches;
next	1.1;

1.1
date	96.08.19.10.13.04;	author downsj;	state Exp;
branches
	1.1.1.1;
next	;

1.1.1.1
date	96.08.19.10.13.04;	author downsj;	state Exp;
branches;
next	1.1.1.2;

1.1.1.2
date	99.04.29.22.40.59;	author millert;	state Exp;
branches;
next	1.1.1.3;

1.1.1.3
date	2000.04.06.16.10.30;	author millert;	state Exp;
branches;
next	1.1.1.4;

1.1.1.4
date	2001.05.24.18.24.47;	author millert;	state Exp;
branches;
next	1.1.1.5;

1.1.1.5
date	2002.10.27.22.15.06;	author millert;	state Exp;
branches;
next	1.1.1.6;

1.1.1.6
date	2003.12.03.02.44.24;	author millert;	state Exp;
branches;
next	1.1.1.7;

1.1.1.7
date	2004.04.07.21.13.35;	author millert;	state Exp;
branches;
next	1.1.1.8;

1.1.1.8
date	2004.08.09.17.48.22;	author millert;	state Exp;
branches;
next	1.1.1.9;

1.1.1.9
date	2005.01.15.21.18.01;	author millert;	state Exp;
branches;
next	1.1.1.10;

1.1.1.10
date	2006.03.28.18.49.24;	author millert;	state Exp;
branches;
next	1.1.1.11;

1.1.1.11
date	2008.09.29.17.18.53;	author millert;	state Exp;
branches;
next	1.1.1.12;

1.1.1.12
date	2009.10.12.18.10.39;	author millert;	state Exp;
branches;
next	1.1.1.13;

1.1.1.13
date	2010.09.24.14.49.10;	author millert;	state Exp;
branches;
next	1.1.1.14;

1.1.1.14
date	2013.03.25.20.09.26;	author sthen;	state Exp;
branches;
next	1.1.1.15;

1.1.1.15
date	2014.03.24.14.59.08;	author afresh1;	state Exp;
branches;
next	1.1.1.16;

1.1.1.16
date	2014.11.17.20.53.15;	author afresh1;	state Exp;
branches;
next	1.1.1.17;
commitid	B31cAbBIXiCqnL97;

1.1.1.17
date	2015.04.25.19.10.44;	author afresh1;	state Exp;
branches;
next	;
commitid	Wpcs5S8qILgEZC7F;


desc
@@


1.19
log
@Fix merge issues, remove excess files - match perl-5.24.1 dist
@
text
@=head1 NAME
X<subroutine> X<function>

perlsub - Perl subroutines

=head1 SYNOPSIS

To declare subroutines:
X<subroutine, declaration> X<sub>

    sub NAME;			  # A "forward" declaration.
    sub NAME(PROTO);		  #  ditto, but with prototypes
    sub NAME : ATTRS;		  #  with attributes
    sub NAME(PROTO) : ATTRS;	  #  with attributes and prototypes

    sub NAME BLOCK		  # A declaration and a definition.
    sub NAME(PROTO) BLOCK	  #  ditto, but with prototypes
    sub NAME(SIG) BLOCK           #  with a signature instead
    sub NAME : ATTRS BLOCK	  #  with attributes
    sub NAME(PROTO) : ATTRS BLOCK #  with prototypes and attributes
    sub NAME(SIG) : ATTRS BLOCK   #  with a signature and attributes

To define an anonymous subroutine at runtime:
X<subroutine, anonymous>

    $subref = sub BLOCK;		 # no proto
    $subref = sub (PROTO) BLOCK;	 # with proto
    $subref = sub (SIG) BLOCK;           # with signature
    $subref = sub : ATTRS BLOCK;	 # with attributes
    $subref = sub (PROTO) : ATTRS BLOCK; # with proto and attributes
    $subref = sub (SIG) : ATTRS BLOCK;   # with signature and attributes

To import subroutines:
X<import>

    use MODULE qw(NAME1 NAME2 NAME3);

To call subroutines:
X<subroutine, call> X<call>

    NAME(LIST);	   # & is optional with parentheses.
    NAME LIST;	   # Parentheses optional if predeclared/imported.
    &NAME(LIST);   # Circumvent prototypes.
    &NAME;	   # Makes current @@_ visible to called subroutine.

=head1 DESCRIPTION

Like many languages, Perl provides for user-defined subroutines.
These may be located anywhere in the main program, loaded in from
other files via the C<do>, C<require>, or C<use> keywords, or
generated on the fly using C<eval> or anonymous subroutines.
You can even call a function indirectly using a variable containing
its name or a CODE reference.

The Perl model for function call and return values is simple: all
functions are passed as parameters one single flat list of scalars, and
all functions likewise return to their caller one single flat list of
scalars.  Any arrays or hashes in these call and return lists will
collapse, losing their identities--but you may always use
pass-by-reference instead to avoid this.  Both call and return lists may
contain as many or as few scalar elements as you'd like.  (Often a
function without an explicit return statement is called a subroutine, but
there's really no difference from Perl's perspective.)
X<subroutine, parameter> X<parameter>

Any arguments passed in show up in the array C<@@_>.
(They may also show up in lexical variables introduced by a signature;
see L</Signatures> below.)  Therefore, if
you called a function with two arguments, those would be stored in
C<$_[0]> and C<$_[1]>.  The array C<@@_> is a local array, but its
elements are aliases for the actual scalar parameters.  In particular,
if an element C<$_[0]> is updated, the corresponding argument is
updated (or an error occurs if it is not updatable).  If an argument
is an array or hash element which did not exist when the function
was called, that element is created only when (and if) it is modified
or a reference to it is taken.  (Some earlier versions of Perl
created the element whether or not the element was assigned to.)
Assigning to the whole array C<@@_> removes that aliasing, and does
not update any arguments.
X<subroutine, argument> X<argument> X<@@_>

A C<return> statement may be used to exit a subroutine, optionally
specifying the returned value, which will be evaluated in the
appropriate context (list, scalar, or void) depending on the context of
the subroutine call.  If you specify no return value, the subroutine
returns an empty list in list context, the undefined value in scalar
context, or nothing in void context.  If you return one or more
aggregates (arrays and hashes), these will be flattened together into
one large indistinguishable list.

If no C<return> is found and if the last statement is an expression, its
value is returned.  If the last statement is a loop control structure
like a C<foreach> or a C<while>, the returned value is unspecified.  The
empty sub returns the empty list.
X<subroutine, return value> X<return value> X<return>

Aside from an experimental facility (see L</Signatures> below),
Perl does not have named formal parameters.  In practice all you
do is assign to a C<my()> list of these.  Variables that aren't
declared to be private are global variables.  For gory details
on creating private variables, see L<"Private Variables via my()">
and L<"Temporary Values via local()">.  To create protected
environments for a set of functions in a separate package (and
probably a separate file), see L<perlmod/"Packages">.
X<formal parameter> X<parameter, formal>

Example:

    sub max {
	my $max = shift(@@_);
	foreach $foo (@@_) {
	    $max = $foo if $max < $foo;
	}
	return $max;
    }
    $bestday = max($mon,$tue,$wed,$thu,$fri);

Example:

    # get a line, combining continuation lines
    #  that start with whitespace

    sub get_line {
	$thisline = $lookahead;  # global variables!
	LINE: while (defined($lookahead = <STDIN>)) {
	    if ($lookahead =~ /^[ \t]/) {
		$thisline .= $lookahead;
	    }
	    else {
		last LINE;
	    }
	}
	return $thisline;
    }

    $lookahead = <STDIN>;	# get first line
    while (defined($line = get_line())) {
	...
    }

Assigning to a list of private variables to name your arguments:

    sub maybeset {
	my($key, $value) = @@_;
	$Foo{$key} = $value unless $Foo{$key};
    }

Because the assignment copies the values, this also has the effect
of turning call-by-reference into call-by-value.  Otherwise a
function is free to do in-place modifications of C<@@_> and change
its caller's values.
X<call-by-reference> X<call-by-value>

    upcase_in($v1, $v2);  # this changes $v1 and $v2
    sub upcase_in {
	for (@@_) { tr/a-z/A-Z/ }
    }

You aren't allowed to modify constants in this way, of course.  If an
argument were actually literal and you tried to change it, you'd take a
(presumably fatal) exception.   For example, this won't work:
X<call-by-reference> X<call-by-value>

    upcase_in("frederick");

It would be much safer if the C<upcase_in()> function
were written to return a copy of its parameters instead
of changing them in place:

    ($v3, $v4) = upcase($v1, $v2);  # this doesn't change $v1 and $v2
    sub upcase {
	return unless defined wantarray;  # void context, do nothing
	my @@parms = @@_;
	for (@@parms) { tr/a-z/A-Z/ }
  	return wantarray ? @@parms : $parms[0];
    }

Notice how this (unprototyped) function doesn't care whether it was
passed real scalars or arrays.  Perl sees all arguments as one big,
long, flat parameter list in C<@@_>.  This is one area where
Perl's simple argument-passing style shines.  The C<upcase()>
function would work perfectly well without changing the C<upcase()>
definition even if we fed it things like this:

    @@newlist   = upcase(@@list1, @@list2);
    @@newlist   = upcase( split /:/, $var );

Do not, however, be tempted to do this:

    (@@a, @@b)   = upcase(@@list1, @@list2);

Like the flattened incoming parameter list, the return list is also
flattened on return.  So all you have managed to do here is stored
everything in C<@@a> and made C<@@b> empty.  See 
L<Pass by Reference> for alternatives.

A subroutine may be called using an explicit C<&> prefix.  The
C<&> is optional in modern Perl, as are parentheses if the
subroutine has been predeclared.  The C<&> is I<not> optional
when just naming the subroutine, such as when it's used as
an argument to defined() or undef().  Nor is it optional when you
want to do an indirect subroutine call with a subroutine name or
reference using the C<&$subref()> or C<&{$subref}()> constructs,
although the C<< $subref->() >> notation solves that problem.
See L<perlref> for more about all that.
X<&>

Subroutines may be called recursively.  If a subroutine is called
using the C<&> form, the argument list is optional, and if omitted,
no C<@@_> array is set up for the subroutine: the C<@@_> array at the
time of the call is visible to subroutine instead.  This is an
efficiency mechanism that new users may wish to avoid.
X<recursion>

    &foo(1,2,3);	# pass three arguments
    foo(1,2,3);		# the same

    foo();		# pass a null list
    &foo();		# the same

    &foo;		# foo() get current args, like foo(@@_) !!
    foo;		# like foo() IFF sub foo predeclared, else "foo"

Not only does the C<&> form make the argument list optional, it also
disables any prototype checking on arguments you do provide.  This
is partly for historical reasons, and partly for having a convenient way
to cheat if you know what you're doing.  See L</Prototypes> below.
X<&>

Since Perl 5.16.0, the C<__SUB__> token is available under C<use feature
'current_sub'> and C<use 5.16.0>.  It will evaluate to a reference to the
currently-running sub, which allows for recursive calls without knowing
your subroutine's name.

    use 5.16.0;
    my $factorial = sub {
      my ($x) = @@_;
      return 1 if $x == 1;
      return($x * __SUB__->( $x - 1 ) );
    };

The behavior of C<__SUB__> within a regex code block (such as C</(?{...})/>)
is subject to change.

Subroutines whose names are in all upper case are reserved to the Perl
core, as are modules whose names are in all lower case.  A subroutine in
all capitals is a loosely-held convention meaning it will be called
indirectly by the run-time system itself, usually due to a triggered event.
Subroutines whose name start with a left parenthesis are also reserved the 
same way.  The following is a list of some subroutines that currently do 
special, pre-defined things.

=over

=item documented later in this document

C<AUTOLOAD>

=item documented in L<perlmod>

C<CLONE>, C<CLONE_SKIP>

=item documented in L<perlobj>

C<DESTROY>, C<DOES>

=item documented in L<perltie>

C<BINMODE>, C<CLEAR>, C<CLOSE>, C<DELETE>, C<DESTROY>, C<EOF>, C<EXISTS>, 
C<EXTEND>, C<FETCH>, C<FETCHSIZE>, C<FILENO>, C<FIRSTKEY>, C<GETC>, 
C<NEXTKEY>, C<OPEN>, C<POP>, C<PRINT>, C<PRINTF>, C<PUSH>, C<READ>, 
C<READLINE>, C<SCALAR>, C<SEEK>, C<SHIFT>, C<SPLICE>, C<STORE>, 
C<STORESIZE>, C<TELL>, C<TIEARRAY>, C<TIEHANDLE>, C<TIEHASH>, 
C<TIESCALAR>, C<UNSHIFT>, C<UNTIE>, C<WRITE>

=item documented in L<PerlIO::via>

C<BINMODE>, C<CLEARERR>, C<CLOSE>, C<EOF>, C<ERROR>, C<FDOPEN>, C<FILENO>, 
C<FILL>, C<FLUSH>, C<OPEN>, C<POPPED>, C<PUSHED>, C<READ>, C<SEEK>, 
C<SETLINEBUF>, C<SYSOPEN>, C<TELL>, C<UNREAD>, C<UTF8>, C<WRITE>

=item documented in L<perlfunc>

L<< C<import> | perlfunc/use >>, L<< C<unimport> | perlfunc/use >>,
L<< C<INC> | perlfunc/require >>

=item documented in L<UNIVERSAL>

C<VERSION>

=item documented in L<perldebguts>

C<DB::DB>, C<DB::sub>, C<DB::lsub>, C<DB::goto>, C<DB::postponed>

=item undocumented, used internally by the L<overload> feature

any starting with C<(>

=back

The C<BEGIN>, C<UNITCHECK>, C<CHECK>, C<INIT> and C<END> subroutines
are not so much subroutines as named special code blocks, of which you
can have more than one in a package, and which you can B<not> call
explicitly.  See L<perlmod/"BEGIN, UNITCHECK, CHECK, INIT and END">

=head2 Signatures

B<WARNING>: Subroutine signatures are experimental.  The feature may be
modified or removed in future versions of Perl.

Perl has an experimental facility to allow a subroutine's formal
parameters to be introduced by special syntax, separate from the
procedural code of the subroutine body.  The formal parameter list
is known as a I<signature>.  The facility must be enabled first by a
pragmatic declaration, C<use feature 'signatures'>, and it will produce
a warning unless the "experimental::signatures" warnings category is
disabled.

The signature is part of a subroutine's body.  Normally the body of a
subroutine is simply a braced block of code.  When using a signature,
the signature is a parenthesised list that goes immediately after
the subroutine name (or, for anonymous subroutines, immediately after
the C<sub> keyword).  The signature declares lexical variables that are
in scope for the block.  When the subroutine is called, the signature
takes control first.  It populates the signature variables from the
list of arguments that were passed.  If the argument list doesn't meet
the requirements of the signature, then it will throw an exception.
When the signature processing is complete, control passes to the block.

Positional parameters are handled by simply naming scalar variables in
the signature.  For example,

    sub foo ($left, $right) {
	return $left + $right;
    }

takes two positional parameters, which must be filled at runtime by
two arguments.  By default the parameters are mandatory, and it is
not permitted to pass more arguments than expected.  So the above is
equivalent to

    sub foo {
	die "Too many arguments for subroutine" unless @@_ <= 2;
	die "Too few arguments for subroutine" unless @@_ >= 2;
	my $left = $_[0];
	my $right = $_[1];
	return $left + $right;
    }

An argument can be ignored by omitting the main part of the name from
a parameter declaration, leaving just a bare C<$> sigil.  For example,

    sub foo ($first, $, $third) {
	return "first=$first, third=$third";
    }

Although the ignored argument doesn't go into a variable, it is still
mandatory for the caller to pass it.

A positional parameter is made optional by giving a default value,
separated from the parameter name by C<=>:

    sub foo ($left, $right = 0) {
	return $left + $right;
    }

The above subroutine may be called with either one or two arguments.
The default value expression is evaluated when the subroutine is called,
so it may provide different default values for different calls.  It is
only evaluated if the argument was actually omitted from the call.
For example,

    my $auto_id = 0;
    sub foo ($thing, $id = $auto_id++) {
	print "$thing has ID $id";
    }

automatically assigns distinct sequential IDs to things for which no
ID was supplied by the caller.  A default value expression may also
refer to parameters earlier in the signature, making the default for
one parameter vary according to the earlier parameters.  For example,

    sub foo ($first_name, $surname, $nickname = $first_name) {
	print "$first_name $surname is known as \"$nickname\"";
    }

An optional parameter can be nameless just like a mandatory parameter.
For example,

    sub foo ($thing, $ = 1) {
	print $thing;
    }

The parameter's default value will still be evaluated if the corresponding
argument isn't supplied, even though the value won't be stored anywhere.
This is in case evaluating it has important side effects.  However, it
will be evaluated in void context, so if it doesn't have side effects
and is not trivial it will generate a warning if the "void" warning
category is enabled.  If a nameless optional parameter's default value
is not important, it may be omitted just as the parameter's name was:

    sub foo ($thing, $=) {
	print $thing;
    }

Optional positional parameters must come after all mandatory positional
parameters.  (If there are no mandatory positional parameters then an
optional positional parameters can be the first thing in the signature.)
If there are multiple optional positional parameters and not enough
arguments are supplied to fill them all, they will be filled from left
to right.

After positional parameters, additional arguments may be captured in a
slurpy parameter.  The simplest form of this is just an array variable:

    sub foo ($filter, @@inputs) {
	print $filter->($_) foreach @@inputs;
    }

With a slurpy parameter in the signature, there is no upper limit on how
many arguments may be passed.  A slurpy array parameter may be nameless
just like a positional parameter, in which case its only effect is to
turn off the argument limit that would otherwise apply:

    sub foo ($thing, @@) {
	print $thing;
    }

A slurpy parameter may instead be a hash, in which case the arguments
available to it are interpreted as alternating keys and values.
There must be as many keys as values: if there is an odd argument then
an exception will be thrown.  Keys will be stringified, and if there are
duplicates then the later instance takes precedence over the earlier,
as with standard hash construction.

    sub foo ($filter, %inputs) {
	print $filter->($_, $inputs{$_}) foreach sort keys %inputs;
    }

A slurpy hash parameter may be nameless just like other kinds of
parameter.  It still insists that the number of arguments available to
it be even, even though they're not being put into a variable.

    sub foo ($thing, %) {
	print $thing;
    }

A slurpy parameter, either array or hash, must be the last thing in the
signature.  It may follow mandatory and optional positional parameters;
it may also be the only thing in the signature.  Slurpy parameters cannot
have default values: if no arguments are supplied for them then you get
an empty array or empty hash.

A signature may be entirely empty, in which case all it does is check
that the caller passed no arguments:

    sub foo () {
	return 123;
    }

When using a signature, the arguments are still available in the special
array variable C<@@_>, in addition to the lexical variables of the
signature.  There is a difference between the two ways of accessing the
arguments: C<@@_> I<aliases> the arguments, but the signature variables
get I<copies> of the arguments.  So writing to a signature variable
only changes that variable, and has no effect on the caller's variables,
but writing to an element of C<@@_> modifies whatever the caller used to
supply that argument.

There is a potential syntactic ambiguity between signatures and prototypes
(see L</Prototypes>), because both start with an opening parenthesis and
both can appear in some of the same places, such as just after the name
in a subroutine declaration.  For historical reasons, when signatures
are not enabled, any opening parenthesis in such a context will trigger
very forgiving prototype parsing.  Most signatures will be interpreted
as prototypes in those circumstances, but won't be valid prototypes.
(A valid prototype cannot contain any alphabetic character.)  This will
lead to somewhat confusing error messages.

To avoid ambiguity, when signatures are enabled the special syntax
for prototypes is disabled.  There is no attempt to guess whether a
parenthesised group was intended to be a prototype or a signature.
To give a subroutine a prototype under these circumstances, use a
L<prototype attribute|attributes/Built-in Attributes>.  For example,

    sub foo :prototype($) { $_[0] }

It is entirely possible for a subroutine to have both a prototype and
a signature.  They do different jobs: the prototype affects compilation
of calls to the subroutine, and the signature puts argument values into
lexical variables at runtime.  You can therefore write

    sub foo ($left, $right) : prototype($$) {
	return $left + $right;
    }

The prototype attribute, and any other attributes, come after 
the signature.

=head2 Private Variables via my()
X<my> X<variable, lexical> X<lexical> X<lexical variable> X<scope, lexical>
X<lexical scope> X<attributes, my>

Synopsis:

    my $foo;	    	# declare $foo lexically local
    my (@@wid, %get); 	# declare list of variables local
    my $foo = "flurp";	# declare $foo lexical, and init it
    my @@oof = @@bar;	# declare @@oof lexical, and init it
    my $x : Foo = $y;	# similar, with an attribute applied

B<WARNING>: The use of attribute lists on C<my> declarations is still
evolving.  The current semantics and interface are subject to change.
See L<attributes> and L<Attribute::Handlers>.

The C<my> operator declares the listed variables to be lexically
confined to the enclosing block, conditional
(C<if>/C<unless>/C<elsif>/C<else>), loop
(C<for>/C<foreach>/C<while>/C<until>/C<continue>), subroutine, C<eval>,
or C<do>/C<require>/C<use>'d file.  If more than one value is listed, the
list must be placed in parentheses.  All listed elements must be
legal lvalues.  Only alphanumeric identifiers may be lexically
scoped--magical built-ins like C<$/> must currently be C<local>ized
with C<local> instead.

Unlike dynamic variables created by the C<local> operator, lexical
variables declared with C<my> are totally hidden from the outside
world, including any called subroutines.  This is true if it's the
same subroutine called from itself or elsewhere--every call gets
its own copy.
X<local>

This doesn't mean that a C<my> variable declared in a statically
enclosing lexical scope would be invisible.  Only dynamic scopes
are cut off.   For example, the C<bumpx()> function below has access
to the lexical $x variable because both the C<my> and the C<sub>
occurred at the same scope, presumably file scope.

    my $x = 10;
    sub bumpx { $x++ } 

An C<eval()>, however, can see lexical variables of the scope it is
being evaluated in, so long as the names aren't hidden by declarations within
the C<eval()> itself.  See L<perlref>.
X<eval, scope of>

The parameter list to my() may be assigned to if desired, which allows you
to initialize your variables.  (If no initializer is given for a
particular variable, it is created with the undefined value.)  Commonly
this is used to name input parameters to a subroutine.  Examples:

    $arg = "fred";	  # "global" variable
    $n = cube_root(27);
    print "$arg thinks the root is $n\n";
 fred thinks the root is 3

    sub cube_root {
	my $arg = shift;  # name doesn't matter
	$arg **= 1/3;
	return $arg;
    }

The C<my> is simply a modifier on something you might assign to.  So when
you do assign to variables in its argument list, C<my> doesn't
change whether those variables are viewed as a scalar or an array.  So

    my ($foo) = <STDIN>;		# WRONG?
    my @@FOO = <STDIN>;

both supply a list context to the right-hand side, while

    my $foo = <STDIN>;

supplies a scalar context.  But the following declares only one variable:

    my $foo, $bar = 1;			# WRONG

That has the same effect as

    my $foo;
    $bar = 1;

The declared variable is not introduced (is not visible) until after
the current statement.  Thus,

    my $x = $x;

can be used to initialize a new $x with the value of the old $x, and
the expression

    my $x = 123 and $x == 123

is false unless the old $x happened to have the value C<123>.

Lexical scopes of control structures are not bounded precisely by the
braces that delimit their controlled blocks; control expressions are
part of that scope, too.  Thus in the loop

    while (my $line = <>) {
        $line = lc $line;
    } continue {
        print $line;
    }

the scope of $line extends from its declaration throughout the rest of
the loop construct (including the C<continue> clause), but not beyond
it.  Similarly, in the conditional

    if ((my $answer = <STDIN>) =~ /^yes$/i) {
        user_agrees();
    } elsif ($answer =~ /^no$/i) {
        user_disagrees();
    } else {
	chomp $answer;
        die "'$answer' is neither 'yes' nor 'no'";
    }

the scope of $answer extends from its declaration through the rest
of that conditional, including any C<elsif> and C<else> clauses, 
but not beyond it.  See L<perlsyn/"Simple Statements"> for information
on the scope of variables in statements with modifiers.

The C<foreach> loop defaults to scoping its index variable dynamically
in the manner of C<local>.  However, if the index variable is
prefixed with the keyword C<my>, or if there is already a lexical
by that name in scope, then a new lexical is created instead.  Thus
in the loop
X<foreach> X<for>

    for my $i (1, 2, 3) {
        some_function();
    }

the scope of $i extends to the end of the loop, but not beyond it,
rendering the value of $i inaccessible within C<some_function()>.
X<foreach> X<for>

Some users may wish to encourage the use of lexically scoped variables.
As an aid to catching implicit uses to package variables,
which are always global, if you say

    use strict 'vars';

then any variable mentioned from there to the end of the enclosing
block must either refer to a lexical variable, be predeclared via
C<our> or C<use vars>, or else must be fully qualified with the package name.
A compilation error results otherwise.  An inner block may countermand
this with C<no strict 'vars'>.

A C<my> has both a compile-time and a run-time effect.  At compile
time, the compiler takes notice of it.  The principal usefulness
of this is to quiet C<use strict 'vars'>, but it is also essential
for generation of closures as detailed in L<perlref>.  Actual
initialization is delayed until run time, though, so it gets executed
at the appropriate time, such as each time through a loop, for
example.

Variables declared with C<my> are not part of any package and are therefore
never fully qualified with the package name.  In particular, you're not
allowed to try to make a package variable (or other global) lexical:

    my $pack::var;	# ERROR!  Illegal syntax

In fact, a dynamic variable (also known as package or global variables)
are still accessible using the fully qualified C<::> notation even while a
lexical of the same name is also visible:

    package main;
    local $x = 10;
    my    $x = 20;
    print "$x and $::x\n";

That will print out C<20> and C<10>.

You may declare C<my> variables at the outermost scope of a file
to hide any such identifiers from the world outside that file.  This
is similar in spirit to C's static variables when they are used at
the file level.  To do this with a subroutine requires the use of
a closure (an anonymous function that accesses enclosing lexicals).
If you want to create a private subroutine that cannot be called
from outside that block, it can declare a lexical variable containing
an anonymous sub reference:

    my $secret_version = '1.001-beta';
    my $secret_sub = sub { print $secret_version };
    &$secret_sub();

As long as the reference is never returned by any function within the
module, no outside module can see the subroutine, because its name is not in
any package's symbol table.  Remember that it's not I<REALLY> called
C<$some_pack::secret_version> or anything; it's just $secret_version,
unqualified and unqualifiable.

This does not work with object methods, however; all object methods
have to be in the symbol table of some package to be found.  See
L<perlref/"Function Templates"> for something of a work-around to
this.

=head2 Persistent Private Variables
X<state> X<state variable> X<static> X<variable, persistent> X<variable, static> X<closure>

There are two ways to build persistent private variables in Perl 5.10.
First, you can simply use the C<state> feature.  Or, you can use closures,
if you want to stay compatible with releases older than 5.10.

=head3 Persistent variables via state()

Beginning with Perl 5.10.0, you can declare variables with the C<state>
keyword in place of C<my>.  For that to work, though, you must have
enabled that feature beforehand, either by using the C<feature> pragma, or
by using C<-E> on one-liners (see L<feature>).  Beginning with Perl 5.16,
the C<CORE::state> form does not require the
C<feature> pragma.

The C<state> keyword creates a lexical variable (following the same scoping
rules as C<my>) that persists from one subroutine call to the next.  If a
state variable resides inside an anonymous subroutine, then each copy of
the subroutine has its own copy of the state variable.  However, the value
of the state variable will still persist between calls to the same copy of
the anonymous subroutine.  (Don't forget that C<sub { ... }> creates a new
subroutine each time it is executed.)

For example, the following code maintains a private counter, incremented
each time the gimme_another() function is called:

    use feature 'state';
    sub gimme_another { state $x; return ++$x }

And this example uses anonymous subroutines to create separate counters:

    use feature 'state';
    sub create_counter {
	return sub { state $x; return ++$x }
    }

Also, since C<$x> is lexical, it can't be reached or modified by any Perl
code outside.

When combined with variable declaration, simple scalar assignment to C<state>
variables (as in C<state $x = 42>) is executed only the first time.  When such
statements are evaluated subsequent times, the assignment is ignored.  The
behavior of this sort of assignment to non-scalar variables is undefined.

=head3 Persistent variables with closures

Just because a lexical variable is lexically (also called statically)
scoped to its enclosing block, C<eval>, or C<do> FILE, this doesn't mean that
within a function it works like a C static.  It normally works more
like a C auto, but with implicit garbage collection.  

Unlike local variables in C or C++, Perl's lexical variables don't
necessarily get recycled just because their scope has exited.
If something more permanent is still aware of the lexical, it will
stick around.  So long as something else references a lexical, that
lexical won't be freed--which is as it should be.  You wouldn't want
memory being free until you were done using it, or kept around once you
were done.  Automatic garbage collection takes care of this for you.

This means that you can pass back or save away references to lexical
variables, whereas to return a pointer to a C auto is a grave error.
It also gives us a way to simulate C's function statics.  Here's a
mechanism for giving a function private variables with both lexical
scoping and a static lifetime.  If you do want to create something like
C's static variables, just enclose the whole function in an extra block,
and put the static variable outside the function but in the block.

    {
	my $secret_val = 0;
	sub gimme_another {
	    return ++$secret_val;
	}
    }
    # $secret_val now becomes unreachable by the outside
    # world, but retains its value between calls to gimme_another

If this function is being sourced in from a separate file
via C<require> or C<use>, then this is probably just fine.  If it's
all in the main program, you'll need to arrange for the C<my>
to be executed early, either by putting the whole block above
your main program, or more likely, placing merely a C<BEGIN>
code block around it to make sure it gets executed before your program
starts to run:

    BEGIN {
	my $secret_val = 0;
	sub gimme_another {
	    return ++$secret_val;
	}
    }

See L<perlmod/"BEGIN, UNITCHECK, CHECK, INIT and END"> about the
special triggered code blocks, C<BEGIN>, C<UNITCHECK>, C<CHECK>,
C<INIT> and C<END>.

If declared at the outermost scope (the file scope), then lexicals
work somewhat like C's file statics.  They are available to all
functions in that same file declared below them, but are inaccessible
from outside that file.  This strategy is sometimes used in modules
to create private variables that the whole module can see.

=head2 Temporary Values via local()
X<local> X<scope, dynamic> X<dynamic scope> X<variable, local>
X<variable, temporary>

B<WARNING>: In general, you should be using C<my> instead of C<local>, because
it's faster and safer.  Exceptions to this include the global punctuation
variables, global filehandles and formats, and direct manipulation of the
Perl symbol table itself.  C<local> is mostly used when the current value
of a variable must be visible to called subroutines.

Synopsis:

    # localization of values

    local $foo;		       # make $foo dynamically local
    local (@@wid, %get);	       # make list of variables local
    local $foo = "flurp";      # make $foo dynamic, and init it
    local @@oof = @@bar;	       # make @@oof dynamic, and init it

    local $hash{key} = "val";  # sets a local value for this hash entry
    delete local $hash{key};   # delete this entry for the current block
    local ($cond ? $v1 : $v2); # several types of lvalues support
			       # localization

    # localization of symbols

    local *FH;		       # localize $FH, @@FH, %FH, &FH  ...
    local *merlyn = *randal;   # now $merlyn is really $randal, plus
                               #     @@merlyn is really @@randal, etc
    local *merlyn = 'randal';  # SAME THING: promote 'randal' to *randal
    local *merlyn = \$randal;  # just alias $merlyn, not @@merlyn etc

A C<local> modifies its listed variables to be "local" to the
enclosing block, C<eval>, or C<do FILE>--and to I<any subroutine
called from within that block>.  A C<local> just gives temporary
values to global (meaning package) variables.  It does I<not> create
a local variable.  This is known as dynamic scoping.  Lexical scoping
is done with C<my>, which works more like C's auto declarations.

Some types of lvalues can be localized as well: hash and array elements
and slices, conditionals (provided that their result is always
localizable), and symbolic references.  As for simple variables, this
creates new, dynamically scoped values.

If more than one variable or expression is given to C<local>, they must be
placed in parentheses.  This operator works
by saving the current values of those variables in its argument list on a
hidden stack and restoring them upon exiting the block, subroutine, or
eval.  This means that called subroutines can also reference the local
variable, but not the global one.  The argument list may be assigned to if
desired, which allows you to initialize your local variables.  (If no
initializer is given for a particular variable, it is created with an
undefined value.)

Because C<local> is a run-time operator, it gets executed each time
through a loop.  Consequently, it's more efficient to localize your
variables outside the loop.

=head3 Grammatical note on local()
X<local, context>

A C<local> is simply a modifier on an lvalue expression.  When you assign to
a C<local>ized variable, the C<local> doesn't change whether its list is viewed
as a scalar or an array.  So

    local($foo) = <STDIN>;
    local @@FOO = <STDIN>;

both supply a list context to the right-hand side, while

    local $foo = <STDIN>;

supplies a scalar context.

=head3 Localization of special variables
X<local, special variable>

If you localize a special variable, you'll be giving a new value to it,
but its magic won't go away.  That means that all side-effects related
to this magic still work with the localized value.

This feature allows code like this to work :

    # Read the whole contents of FILE in $slurp
    { local $/ = undef; $slurp = <FILE>; }

Note, however, that this restricts localization of some values ; for
example, the following statement dies, as of perl 5.10.0, with an error
I<Modification of a read-only value attempted>, because the $1 variable is
magical and read-only :

    local $1 = 2;

One exception is the default scalar variable: starting with perl 5.14
C<local($_)> will always strip all magic from $_, to make it possible
to safely reuse $_ in a subroutine.

B<WARNING>: Localization of tied arrays and hashes does not currently
work as described.
This will be fixed in a future release of Perl; in the meantime, avoid
code that relies on any particular behavior of localising tied arrays
or hashes (localising individual elements is still okay).
See L<perl58delta/"Localising Tied Arrays and Hashes Is Broken"> for more
details.
X<local, tie>

=head3 Localization of globs
X<local, glob> X<glob>

The construct

    local *name;

creates a whole new symbol table entry for the glob C<name> in the
current package.  That means that all variables in its glob slot ($name,
@@name, %name, &name, and the C<name> filehandle) are dynamically reset.

This implies, among other things, that any magic eventually carried by
those variables is locally lost.  In other words, saying C<local */>
will not have any effect on the internal value of the input record
separator.

=head3 Localization of elements of composite types
X<local, composite type element> X<local, array element> X<local, hash element>

It's also worth taking a moment to explain what happens when you
C<local>ize a member of a composite type (i.e. an array or hash element).
In this case, the element is C<local>ized I<by name>.  This means that
when the scope of the C<local()> ends, the saved value will be
restored to the hash element whose key was named in the C<local()>, or
the array element whose index was named in the C<local()>.  If that
element was deleted while the C<local()> was in effect (e.g. by a
C<delete()> from a hash or a C<shift()> of an array), it will spring
back into existence, possibly extending an array and filling in the
skipped elements with C<undef>.  For instance, if you say

    %hash = ( 'This' => 'is', 'a' => 'test' );
    @@ary  = ( 0..5 );
    {
         local($ary[5]) = 6;
         local($hash{'a'}) = 'drill';
         while (my $e = pop(@@ary)) {
             print "$e . . .\n";
             last unless $e > 3;
         }
         if (@@ary) {
             $hash{'only a'} = 'test';
             delete $hash{'a'};
         }
    }
    print join(' ', map { "$_ $hash{$_}" } sort keys %hash),".\n";
    print "The array has ",scalar(@@ary)," elements: ",
          join(', ', map { defined $_ ? $_ : 'undef' } @@ary),"\n";

Perl will print

    6 . . .
    4 . . .
    3 . . .
    This is a test only a test.
    The array has 6 elements: 0, 1, 2, undef, undef, 5

The behavior of local() on non-existent members of composite
types is subject to change in future.

=head3 Localized deletion of elements of composite types
X<delete> X<local, composite type element> X<local, array element> X<local, hash element>

You can use the C<delete local $array[$idx]> and C<delete local $hash{key}>
constructs to delete a composite type entry for the current block and restore
it when it ends.  They return the array/hash value before the localization,
which means that they are respectively equivalent to

    do {
        my $val = $array[$idx];
        local  $array[$idx];
        delete $array[$idx];
        $val
    }

and

    do {
        my $val = $hash{key};
        local  $hash{key};
        delete $hash{key};
        $val
    }

except that for those the C<local> is
scoped to the C<do> block.  Slices are
also accepted.

    my %hash = (
     a => [ 7, 8, 9 ],
     b => 1,
    )

    {
     my $a = delete local $hash{a};
     # $a is [ 7, 8, 9 ]
     # %hash is (b => 1)

     {
      my @@nums = delete local @@$a[0, 2]
      # @@nums is (7, 9)
      # $a is [ undef, 8 ]

      $a[0] = 999; # will be erased when the scope ends
     }
     # $a is back to [ 7, 8, 9 ]

    }
    # %hash is back to its original state

=head2 Lvalue subroutines
X<lvalue> X<subroutine, lvalue>

It is possible to return a modifiable value from a subroutine.
To do this, you have to declare the subroutine to return an lvalue.

    my $val;
    sub canmod : lvalue {
	$val;  # or:  return $val;
    }
    sub nomod {
	$val;
    }

    canmod() = 5;   # assigns to $val
    nomod()  = 5;   # ERROR

The scalar/list context for the subroutine and for the right-hand
side of assignment is determined as if the subroutine call is replaced
by a scalar.  For example, consider:

    data(2,3) = get_data(3,4);

Both subroutines here are called in a scalar context, while in:

    (data(2,3)) = get_data(3,4);

and in:

    (data(2),data(3)) = get_data(3,4);

all the subroutines are called in a list context.

Lvalue subroutines are convenient, but you have to keep in mind that,
when used with objects, they may violate encapsulation.  A normal
mutator can check the supplied argument before setting the attribute
it is protecting, an lvalue subroutine cannot.  If you require any
special processing when storing and retrieving the values, consider
using the CPAN module Sentinel or something similar.

=head2 Lexical Subroutines
X<my sub> X<state sub> X<our sub> X<subroutine, lexical>

B<WARNING>: Lexical subroutines are still experimental.  The feature may be
modified or removed in future versions of Perl.

Lexical subroutines are only available under the C<use feature
'lexical_subs'> pragma, which produces a warning unless the
"experimental::lexical_subs" warnings category is disabled.

Beginning with Perl 5.18, you can declare a private subroutine with C<my>
or C<state>.  As with state variables, the C<state> keyword is only
available under C<use feature 'state'> or C<use 5.010> or higher.

These subroutines are only visible within the block in which they are
declared, and only after that declaration:

    no warnings "experimental::lexical_subs";
    use feature 'lexical_subs';

    foo();		# calls the package/global subroutine
    state sub foo {
	foo();		# also calls the package subroutine
    }
    foo();		# calls "state" sub
    my $ref = \&foo;	# take a reference to "state" sub

    my sub bar { ... }
    bar();		# calls "my" sub

To use a lexical subroutine from inside the subroutine itself, you must
predeclare it.  The C<sub foo {...}> subroutine definition syntax respects
any previous C<my sub;> or C<state sub;> declaration.

    my sub baz;		# predeclaration
    sub baz {		# define the "my" sub
	baz();		# recursive call
    }

=head3 C<state sub> vs C<my sub>

What is the difference between "state" subs and "my" subs?  Each time that
execution enters a block when "my" subs are declared, a new copy of each
sub is created.  "State" subroutines persist from one execution of the
containing block to the next.

So, in general, "state" subroutines are faster.  But "my" subs are
necessary if you want to create closures:

    no warnings "experimental::lexical_subs";
    use feature 'lexical_subs';

    sub whatever {
	my $x = shift;
	my sub inner {
	    ... do something with $x ...
	}
	inner();
    }

In this example, a new C<$x> is created when C<whatever> is called, and
also a new C<inner>, which can see the new C<$x>.  A "state" sub will only
see the C<$x> from the first call to C<whatever>.

=head3 C<our> subroutines

Like C<our $variable>, C<our sub> creates a lexical alias to the package
subroutine of the same name.

The two main uses for this are to switch back to using the package sub
inside an inner scope:

    no warnings "experimental::lexical_subs";
    use feature 'lexical_subs';

    sub foo { ... }

    sub bar {
	my sub foo { ... }
	{
	    # need to use the outer foo here
	    our sub foo;
	    foo();
	}
    }

and to make a subroutine visible to other packages in the same scope:

    package MySneakyModule;

    no warnings "experimental::lexical_subs";
    use feature 'lexical_subs';

    our sub do_something { ... }

    sub do_something_with_caller {
	package DB;
	() = caller 1;		# sets @@DB::args
	do_something(@@args);	# uses MySneakyModule::do_something
    }

=head2 Passing Symbol Table Entries (typeglobs)
X<typeglob> X<*>

B<WARNING>: The mechanism described in this section was originally
the only way to simulate pass-by-reference in older versions of
Perl.  While it still works fine in modern versions, the new reference
mechanism is generally easier to work with.  See below.

Sometimes you don't want to pass the value of an array to a subroutine
but rather the name of it, so that the subroutine can modify the global
copy of it rather than working with a local copy.  In perl you can
refer to all objects of a particular name by prefixing the name
with a star: C<*foo>.  This is often known as a "typeglob", because the
star on the front can be thought of as a wildcard match for all the
funny prefix characters on variables and subroutines and such.

When evaluated, the typeglob produces a scalar value that represents
all the objects of that name, including any filehandle, format, or
subroutine.  When assigned to, it causes the name mentioned to refer to
whatever C<*> value was assigned to it.  Example:

    sub doubleary {
	local(*someary) = @@_;
	foreach $elem (@@someary) {
	    $elem *= 2;
	}
    }
    doubleary(*foo);
    doubleary(*bar);

Scalars are already passed by reference, so you can modify
scalar arguments without using this mechanism by referring explicitly
to C<$_[0]> etc.  You can modify all the elements of an array by passing
all the elements as scalars, but you have to use the C<*> mechanism (or
the equivalent reference mechanism) to C<push>, C<pop>, or change the size of
an array.  It will certainly be faster to pass the typeglob (or reference).

Even if you don't want to modify an array, this mechanism is useful for
passing multiple arrays in a single LIST, because normally the LIST
mechanism will merge all the array values so that you can't extract out
the individual arrays.  For more on typeglobs, see
L<perldata/"Typeglobs and Filehandles">.

=head2 When to Still Use local()
X<local> X<variable, local>

Despite the existence of C<my>, there are still three places where the
C<local> operator still shines.  In fact, in these three places, you
I<must> use C<local> instead of C<my>.

=over 4

=item 1.

You need to give a global variable a temporary value, especially $_.

The global variables, like C<@@ARGV> or the punctuation variables, must be 
C<local>ized with C<local()>.  This block reads in F</etc/motd>, and splits
it up into chunks separated by lines of equal signs, which are placed
in C<@@Fields>.

    {
	local @@ARGV = ("/etc/motd");
        local $/ = undef;
        local $_ = <>;	
	@@Fields = split /^\s*=+\s*$/;
    } 

It particular, it's important to C<local>ize $_ in any routine that assigns
to it.  Look out for implicit assignments in C<while> conditionals.

=item 2.

You need to create a local file or directory handle or a local function.

A function that needs a filehandle of its own must use
C<local()> on a complete typeglob.   This can be used to create new symbol
table entries:

    sub ioqueue {
        local  (*READER, *WRITER);    # not my!
        pipe    (READER,  WRITER)     or die "pipe: $!";
        return (*READER, *WRITER);
    }
    ($head, $tail) = ioqueue();

See the Symbol module for a way to create anonymous symbol table
entries.

Because assignment of a reference to a typeglob creates an alias, this
can be used to create what is effectively a local function, or at least,
a local alias.

    {
        local *grow = \&shrink; # only until this block exits
        grow();                # really calls shrink()
	move();		       # if move() grow()s, it shrink()s too
    }
    grow();		       # get the real grow() again

See L<perlref/"Function Templates"> for more about manipulating
functions by name in this way.

=item 3.

You want to temporarily change just one element of an array or hash.

You can C<local>ize just one element of an aggregate.  Usually this
is done on dynamics:

    {
	local $SIG{INT} = 'IGNORE';
	funct();			    # uninterruptible
    } 
    # interruptibility automatically restored here

But it also works on lexically declared aggregates.

=back

=head2 Pass by Reference
X<pass by reference> X<pass-by-reference> X<reference>

If you want to pass more than one array or hash into a function--or
return them from it--and have them maintain their integrity, then
you're going to have to use an explicit pass-by-reference.  Before you
do that, you need to understand references as detailed in L<perlref>.
This section may not make much sense to you otherwise.

Here are a few simple examples.  First, let's pass in several arrays
to a function and have it C<pop> all of then, returning a new list
of all their former last elements:

    @@tailings = popmany ( \@@a, \@@b, \@@c, \@@d );

    sub popmany {
	my $aref;
	my @@retlist;
	foreach $aref ( @@_ ) {
	    push @@retlist, pop @@$aref;
	}
	return @@retlist;
    }

Here's how you might write a function that returns a
list of keys occurring in all the hashes passed to it:

    @@common = inter( \%foo, \%bar, \%joe );
    sub inter {
	my ($k, $href, %seen); # locals
	foreach $href (@@_) {
	    while ( $k = each %$href ) {
		$seen{$k}++;
	    }
	}
	return grep { $seen{$_} == @@_ } keys %seen;
    }

So far, we're using just the normal list return mechanism.
What happens if you want to pass or return a hash?  Well,
if you're using only one of them, or you don't mind them
concatenating, then the normal calling convention is ok, although
a little expensive.

Where people get into trouble is here:

    (@@a, @@b) = func(@@c, @@d);
or
    (%a, %b) = func(%c, %d);

That syntax simply won't work.  It sets just C<@@a> or C<%a> and
clears the C<@@b> or C<%b>.  Plus the function didn't get passed
into two separate arrays or hashes: it got one long list in C<@@_>,
as always.

If you can arrange for everyone to deal with this through references, it's
cleaner code, although not so nice to look at.  Here's a function that
takes two array references as arguments, returning the two array elements
in order of how many elements they have in them:

    ($aref, $bref) = func(\@@c, \@@d);
    print "@@$aref has more than @@$bref\n";
    sub func {
	my ($cref, $dref) = @@_;
	if (@@$cref > @@$dref) {
	    return ($cref, $dref);
	} else {
	    return ($dref, $cref);
	}
    }

It turns out that you can actually do this also:

    (*a, *b) = func(\@@c, \@@d);
    print "@@a has more than @@b\n";
    sub func {
	local (*c, *d) = @@_;
	if (@@c > @@d) {
	    return (\@@c, \@@d);
	} else {
	    return (\@@d, \@@c);
	}
    }

Here we're using the typeglobs to do symbol table aliasing.  It's
a tad subtle, though, and also won't work if you're using C<my>
variables, because only globals (even in disguise as C<local>s)
are in the symbol table.

If you're passing around filehandles, you could usually just use the bare
typeglob, like C<*STDOUT>, but typeglobs references work, too.
For example:

    splutter(\*STDOUT);
    sub splutter {
	my $fh = shift;
	print $fh "her um well a hmmm\n";
    }

    $rec = get_rec(\*STDIN);
    sub get_rec {
	my $fh = shift;
	return scalar <$fh>;
    }

If you're planning on generating new filehandles, you could do this.
Notice to pass back just the bare *FH, not its reference.

    sub openit {
	my $path = shift;
	local *FH;
	return open (FH, $path) ? *FH : undef;
    }

=head2 Prototypes
X<prototype> X<subroutine, prototype>

Perl supports a very limited kind of compile-time argument checking
using function prototyping.  This can be declared in either the PROTO
section or with a L<prototype attribute|attributes/Built-in Attributes>.
If you declare either of

    sub mypush (\@@@@)
    sub mypush :prototype(\@@@@)

then C<mypush()> takes arguments exactly like C<push()> does.

If subroutine signatures are enabled (see L</Signatures>), then
the shorter PROTO syntax is unavailable, because it would clash with
signatures.  In that case, a prototype can only be declared in the form
of an attribute.

The
function declaration must be visible at compile time.  The prototype
affects only interpretation of new-style calls to the function,
where new-style is defined as not using the C<&> character.  In
other words, if you call it like a built-in function, then it behaves
like a built-in function.  If you call it like an old-fashioned
subroutine, then it behaves like an old-fashioned subroutine.  It
naturally falls out from this rule that prototypes have no influence
on subroutine references like C<\&foo> or on indirect subroutine
calls like C<&{$subref}> or C<< $subref->() >>.

Method calls are not influenced by prototypes either, because the
function to be called is indeterminate at compile time, since
the exact code called depends on inheritance.

Because the intent of this feature is primarily to let you define
subroutines that work like built-in functions, here are prototypes
for some other functions that parse almost exactly like the
corresponding built-in.

   Declared as		   Called as

   sub mylink ($$)	   mylink $old, $new
   sub myvec ($$$)	   myvec $var, $offset, 1
   sub myindex ($$;$)	   myindex &getstring, "substr"
   sub mysyswrite ($$$;$)  mysyswrite $buf, 0, length($buf) - $off, $off
   sub myreverse (@@)	   myreverse $a, $b, $c
   sub myjoin ($@@)	   myjoin ":", $a, $b, $c
   sub mypop (\@@)	   mypop @@array
   sub mysplice (\@@$$@@)	   mysplice @@array, 0, 2, @@pushme
   sub mykeys (\[%@@])	   mykeys %{$hashref}
   sub myopen (*;$)	   myopen HANDLE, $name
   sub mypipe (**)	   mypipe READHANDLE, WRITEHANDLE
   sub mygrep (&@@)	   mygrep { /foo/ } $a, $b, $c
   sub myrand (;$)	   myrand 42
   sub mytime ()	   mytime

Any backslashed prototype character represents an actual argument
that must start with that character (optionally preceded by C<my>,
C<our> or C<local>), with the exception of C<$>, which will
accept any scalar lvalue expression, such as C<$foo = 7> or
C<< my_function()->[0] >>.  The value passed as part of C<@@_> will be a
reference to the actual argument given in the subroutine call,
obtained by applying C<\> to that argument.

You can use the C<\[]> backslash group notation to specify more than one
allowed argument type.  For example:

    sub myref (\[$@@%&*])

will allow calling myref() as

    myref $var
    myref @@array
    myref %hash
    myref &sub
    myref *glob

and the first argument of myref() will be a reference to
a scalar, an array, a hash, a code, or a glob.

Unbackslashed prototype characters have special meanings.  Any
unbackslashed C<@@> or C<%> eats all remaining arguments, and forces
list context.  An argument represented by C<$> forces scalar context.  An
C<&> requires an anonymous subroutine, which, if passed as the first
argument, does not require the C<sub> keyword or a subsequent comma.

A C<*> allows the subroutine to accept a bareword, constant, scalar expression,
typeglob, or a reference to a typeglob in that slot.  The value will be
available to the subroutine either as a simple scalar, or (in the latter
two cases) as a reference to the typeglob.  If you wish to always convert
such arguments to a typeglob reference, use Symbol::qualify_to_ref() as
follows:

    use Symbol 'qualify_to_ref';

    sub foo (*) {
	my $fh = qualify_to_ref(shift, caller);
	...
    }

The C<+> prototype is a special alternative to C<$> that will act like
C<\[@@%]> when given a literal array or hash variable, but will otherwise
force scalar context on the argument.  This is useful for functions which
should accept either a literal array or an array reference as the argument:

    sub mypush (+@@) {
        my $aref = shift;
        die "Not an array or arrayref" unless ref $aref eq 'ARRAY';
        push @@$aref, @@_;
    }

When using the C<+> prototype, your function must check that the argument
is of an acceptable type.

A semicolon (C<;>) separates mandatory arguments from optional arguments.
It is redundant before C<@@> or C<%>, which gobble up everything else.

As the last character of a prototype, or just before a semicolon, a C<@@>
or a C<%>, you can use C<_> in place of C<$>: if this argument is not
provided, C<$_> will be used instead.

Note how the last three examples in the table above are treated
specially by the parser.  C<mygrep()> is parsed as a true list
operator, C<myrand()> is parsed as a true unary operator with unary
precedence the same as C<rand()>, and C<mytime()> is truly without
arguments, just like C<time()>.  That is, if you say

    mytime +2;

you'll get C<mytime() + 2>, not C<mytime(2)>, which is how it would be parsed
without a prototype.  If you want to force a unary function to have the
same precedence as a list operator, add C<;> to the end of the prototype:

    sub mygetprotobynumber($;);
    mygetprotobynumber $a > $b; # parsed as mygetprotobynumber($a > $b)

The interesting thing about C<&> is that you can generate new syntax with it,
provided it's in the initial position:
X<&>

    sub try (&@@) {
	my($try,$catch) = @@_;
	eval { &$try };
	if ($@@) {
	    local $_ = $@@;
	    &$catch;
	}
    }
    sub catch (&) { $_[0] }

    try {
	die "phooey";
    } catch {
	/phooey/ and print "unphooey\n";
    };

That prints C<"unphooey">.  (Yes, there are still unresolved
issues having to do with visibility of C<@@_>.  I'm ignoring that
question for the moment.  (But note that if we make C<@@_> lexically
scoped, those anonymous subroutines can act like closures... (Gee,
is this sounding a little Lispish?  (Never mind.))))

And here's a reimplementation of the Perl C<grep> operator:
X<grep>

    sub mygrep (&@@) {
	my $code = shift;
	my @@result;
	foreach $_ (@@_) {
	    push(@@result, $_) if &$code;
	}
	@@result;
    }

Some folks would prefer full alphanumeric prototypes.  Alphanumerics have
been intentionally left out of prototypes for the express purpose of
someday in the future adding named, formal parameters.  The current
mechanism's main goal is to let module writers provide better diagnostics
for module users.  Larry feels the notation quite understandable to Perl
programmers, and that it will not intrude greatly upon the meat of the
module, nor make it harder to read.  The line noise is visually
encapsulated into a small pill that's easy to swallow.

If you try to use an alphanumeric sequence in a prototype you will
generate an optional warning - "Illegal character in prototype...".
Unfortunately earlier versions of Perl allowed the prototype to be
used as long as its prefix was a valid prototype.  The warning may be
upgraded to a fatal error in a future version of Perl once the
majority of offending code is fixed.

It's probably best to prototype new functions, not retrofit prototyping
into older ones.  That's because you must be especially careful about
silent impositions of differing list versus scalar contexts.  For example,
if you decide that a function should take just one parameter, like this:

    sub func ($) {
	my $n = shift;
	print "you gave me $n\n";
    }

and someone has been calling it with an array or expression
returning a list:

    func(@@foo);
    func( split /:/ );

Then you've just supplied an automatic C<scalar> in front of their
argument, which can be more than a bit surprising.  The old C<@@foo>
which used to hold one thing doesn't get passed in.  Instead,
C<func()> now gets passed in a C<1>; that is, the number of elements
in C<@@foo>.  And the C<split> gets called in scalar context so it
starts scribbling on your C<@@_> parameter list.  Ouch!

If a sub has both a PROTO and a BLOCK, the prototype is not applied
until after the BLOCK is completely defined.  This means that a recursive
function with a prototype has to be predeclared for the prototype to take
effect, like so:

	sub foo($$);
	sub foo($$) {
		foo 1, 2;
	}

This is all very powerful, of course, and should be used only in moderation
to make the world a better place.

=head2 Constant Functions
X<constant>

Functions with a prototype of C<()> are potential candidates for
inlining.  If the result after optimization and constant folding
is either a constant or a lexically-scoped scalar which has no other
references, then it will be used in place of function calls made
without C<&>.  Calls made using C<&> are never inlined.  (See
F<constant.pm> for an easy way to declare most constants.)

The following functions would all be inlined:

    sub pi ()		{ 3.14159 }		# Not exact, but close.
    sub PI ()		{ 4 * atan2 1, 1 }	# As good as it gets,
						# and it's inlined, too!
    sub ST_DEV ()	{ 0 }
    sub ST_INO ()	{ 1 }

    sub FLAG_FOO ()	{ 1 << 8 }
    sub FLAG_BAR ()	{ 1 << 9 }
    sub FLAG_MASK ()	{ FLAG_FOO | FLAG_BAR }

    sub OPT_BAZ ()	{ not (0x1B58 & FLAG_MASK) }

    sub N () { int(OPT_BAZ) / 3 }

    sub FOO_SET () { 1 if FLAG_MASK & FLAG_FOO }
    sub FOO_SET2 () { if (FLAG_MASK & FLAG_FOO) { 1 } }

(Be aware that the last example was not always inlined in Perl 5.20 and
earlier, which did not behave consistently with subroutines containing
inner scopes.)  You can countermand inlining by using an explicit
C<return>:

    sub baz_val () {
	if (OPT_BAZ) {
	    return 23;
	}
	else {
	    return 42;
	}
    }
    sub bonk_val () { return 12345 }

As alluded to earlier you can also declare inlined subs dynamically at
BEGIN time if their body consists of a lexically-scoped scalar which
has no other references.  Only the first example here will be inlined:

    BEGIN {
        my $var = 1;
        no strict 'refs';
        *INLINED = sub () { $var };
    }

    BEGIN {
        my $var = 1;
        my $ref = \$var;
        no strict 'refs';
        *NOT_INLINED = sub () { $var };
    }

A not so obvious caveat with this (see [RT #79908]) is that the
variable will be immediately inlined, and will stop behaving like a
normal lexical variable, e.g. this will print C<79907>, not C<79908>:

    BEGIN {
        my $x = 79907;
        *RT_79908 = sub () { $x };
        $x++;
    }
    print RT_79908(); # prints 79907

As of Perl 5.22, this buggy behavior, while preserved for backward
compatibility, is detected and emits a deprecation warning.  If you want
the subroutine to be inlined (with no warning), make sure the variable is
not used in a context where it could be modified aside from where it is
declared.

    # Fine, no warning
    BEGIN {
        my $x = 54321;
        *INLINED = sub () { $x };
    }
    # Warns.  Future Perl versions will stop inlining it.
    BEGIN {
        my $x;
        $x = 54321;
        *ALSO_INLINED = sub () { $x };
    }

Perl 5.22 also introduces the experimental "const" attribute as an
alternative.  (Disable the "experimental::const_attr" warnings if you want
to use it.)  When applied to an anonymous subroutine, it forces the sub to
be called when the C<sub> expression is evaluated.  The return value is
captured and turned into a constant subroutine:

    my $x = 54321;
    *INLINED = sub : const { $x };
    $x++;

The return value of C<INLINED> in this example will always be 54321,
regardless of later modifications to $x.  You can also put any arbitrary
code inside the sub, at it will be executed immediately and its return
value captured the same way.

If you really want a subroutine with a C<()> prototype that returns a
lexical variable you can easily force it to not be inlined by adding
an explicit C<return>:

    BEGIN {
        my $x = 79907;
        *RT_79908 = sub () { return $x };
        $x++;
    }
    print RT_79908(); # prints 79908

The easiest way to tell if a subroutine was inlined is by using
L<B::Deparse>.  Consider this example of two subroutines returning
C<1>, one with a C<()> prototype causing it to be inlined, and one
without (with deparse output truncated for clarity):

 $ perl -MO=Deparse -le 'sub ONE { 1 } if (ONE) { print ONE if ONE }'
 sub ONE {
     1;
 }
 if (ONE ) {
     print ONE() if ONE ;
 }
 $ perl -MO=Deparse -le 'sub ONE () { 1 } if (ONE) { print ONE if ONE }'
 sub ONE () { 1 }
 do {
     print 1
 };

If you redefine a subroutine that was eligible for inlining, you'll
get a warning by default.  You can use this warning to tell whether or
not a particular subroutine is considered inlinable, since it's
different than the warning for overriding non-inlined subroutines:

    $ perl -e 'sub one () {1} sub one () {2}'
    Constant subroutine one redefined at -e line 1.
    $ perl -we 'sub one {1} sub one {2}'
    Subroutine one redefined at -e line 1.

The warning is considered severe enough not to be affected by the
B<-w> switch (or its absence) because previously compiled invocations
of the function will still be using the old value of the function.  If
you need to be able to redefine the subroutine, you need to ensure
that it isn't inlined, either by dropping the C<()> prototype (which
changes calling semantics, so beware) or by thwarting the inlining
mechanism in some other way, e.g. by adding an explicit C<return>, as
mentioned above:

    sub not_inlined () { return 23 }

=head2 Overriding Built-in Functions
X<built-in> X<override> X<CORE> X<CORE::GLOBAL>

Many built-in functions may be overridden, though this should be tried
only occasionally and for good reason.  Typically this might be
done by a package attempting to emulate missing built-in functionality
on a non-Unix system.

Overriding may be done only by importing the name from a module at
compile time--ordinary predeclaration isn't good enough.  However, the
C<use subs> pragma lets you, in effect, predeclare subs
via the import syntax, and these names may then override built-in ones:

    use subs 'chdir', 'chroot', 'chmod', 'chown';
    chdir $somewhere;
    sub chdir { ... }

To unambiguously refer to the built-in form, precede the
built-in name with the special package qualifier C<CORE::>.  For example,
saying C<CORE::open()> always refers to the built-in C<open()>, even
if the current package has imported some other subroutine called
C<&open()> from elsewhere.  Even though it looks like a regular
function call, it isn't: the CORE:: prefix in that case is part of Perl's
syntax, and works for any keyword, regardless of what is in the CORE
package.  Taking a reference to it, that is, C<\&CORE::open>, only works
for some keywords.  See L<CORE>.

Library modules should not in general export built-in names like C<open>
or C<chdir> as part of their default C<@@EXPORT> list, because these may
sneak into someone else's namespace and change the semantics unexpectedly.
Instead, if the module adds that name to C<@@EXPORT_OK>, then it's
possible for a user to import the name explicitly, but not implicitly.
That is, they could say

    use Module 'open';

and it would import the C<open> override.  But if they said

    use Module;

they would get the default imports without overrides.

The foregoing mechanism for overriding built-in is restricted, quite
deliberately, to the package that requests the import.  There is a second
method that is sometimes applicable when you wish to override a built-in
everywhere, without regard to namespace boundaries.  This is achieved by
importing a sub into the special namespace C<CORE::GLOBAL::>.  Here is an
example that quite brazenly replaces the C<glob> operator with something
that understands regular expressions.

    package REGlob;
    require Exporter;
    @@ISA = 'Exporter';
    @@EXPORT_OK = 'glob';

    sub import {
	my $pkg = shift;
	return unless @@_;
	my $sym = shift;
	my $where = ($sym =~ s/^GLOBAL_// ? 'CORE::GLOBAL' : caller(0));
	$pkg->export($where, $sym, @@_);
    }

    sub glob {
	my $pat = shift;
	my @@got;
	if (opendir my $d, '.') { 
	    @@got = grep /$pat/, readdir $d; 
	    closedir $d;   
	}
	return @@got;
    }
    1;

And here's how it could be (ab)used:

    #use REGlob 'GLOBAL_glob';	    # override glob() in ALL namespaces
    package Foo;
    use REGlob 'glob';		    # override glob() in Foo:: only
    print for <^[a-z_]+\.pm\$>;	    # show all pragmatic modules

The initial comment shows a contrived, even dangerous example.
By overriding C<glob> globally, you would be forcing the new (and
subversive) behavior for the C<glob> operator for I<every> namespace,
without the complete cognizance or cooperation of the modules that own
those namespaces.  Naturally, this should be done with extreme caution--if
it must be done at all.

The C<REGlob> example above does not implement all the support needed to
cleanly override perl's C<glob> operator.  The built-in C<glob> has
different behaviors depending on whether it appears in a scalar or list
context, but our C<REGlob> doesn't.  Indeed, many perl built-in have such
context sensitive behaviors, and these must be adequately supported by
a properly written override.  For a fully functional example of overriding
C<glob>, study the implementation of C<File::DosGlob> in the standard
library.

When you override a built-in, your replacement should be consistent (if
possible) with the built-in native syntax.  You can achieve this by using
a suitable prototype.  To get the prototype of an overridable built-in,
use the C<prototype> function with an argument of C<"CORE::builtin_name">
(see L<perlfunc/prototype>).

Note however that some built-ins can't have their syntax expressed by a
prototype (such as C<system> or C<chomp>).  If you override them you won't
be able to fully mimic their original syntax.

The built-ins C<do>, C<require> and C<glob> can also be overridden, but due
to special magic, their original syntax is preserved, and you don't have
to define a prototype for their replacements.  (You can't override the
C<do BLOCK> syntax, though).

C<require> has special additional dark magic: if you invoke your
C<require> replacement as C<require Foo::Bar>, it will actually receive
the argument C<"Foo/Bar.pm"> in @@_.  See L<perlfunc/require>.

And, as you'll have noticed from the previous example, if you override
C<glob>, the C<< <*> >> glob operator is overridden as well.

In a similar fashion, overriding the C<readline> function also overrides
the equivalent I/O operator C<< <FILEHANDLE> >>.  Also, overriding
C<readpipe> also overrides the operators C<``> and C<qx//>.

Finally, some built-ins (e.g. C<exists> or C<grep>) can't be overridden.

=head2 Autoloading
X<autoloading> X<AUTOLOAD>

If you call a subroutine that is undefined, you would ordinarily
get an immediate, fatal error complaining that the subroutine doesn't
exist.  (Likewise for subroutines being used as methods, when the
method doesn't exist in any base class of the class's package.)
However, if an C<AUTOLOAD> subroutine is defined in the package or
packages used to locate the original subroutine, then that
C<AUTOLOAD> subroutine is called with the arguments that would have
been passed to the original subroutine.  The fully qualified name
of the original subroutine magically appears in the global $AUTOLOAD
variable of the same package as the C<AUTOLOAD> routine.  The name
is not passed as an ordinary argument because, er, well, just
because, that's why.  (As an exception, a method call to a nonexistent
C<import> or C<unimport> method is just skipped instead.  Also, if
the AUTOLOAD subroutine is an XSUB, there are other ways to retrieve the
subroutine name.  See L<perlguts/Autoloading with XSUBs> for details.)


Many C<AUTOLOAD> routines load in a definition for the requested
subroutine using eval(), then execute that subroutine using a special
form of goto() that erases the stack frame of the C<AUTOLOAD> routine
without a trace.  (See the source to the standard module documented
in L<AutoLoader>, for example.)  But an C<AUTOLOAD> routine can
also just emulate the routine and never define it.   For example,
let's pretend that a function that wasn't defined should just invoke
C<system> with those arguments.  All you'd do is:

    sub AUTOLOAD {
	my $program = $AUTOLOAD;
	$program =~ s/.*:://;
	system($program, @@_);
    }
    date();
    who('am', 'i');
    ls('-l');

In fact, if you predeclare functions you want to call that way, you don't
even need parentheses:

    use subs qw(date who ls);
    date;
    who "am", "i";
    ls '-l';

A more complete example of this is the Shell module on CPAN, which
can treat undefined subroutine calls as calls to external programs.

Mechanisms are available to help modules writers split their modules
into autoloadable files.  See the standard AutoLoader module
described in L<AutoLoader> and in L<AutoSplit>, the standard
SelfLoader modules in L<SelfLoader>, and the document on adding C
functions to Perl code in L<perlxs>.

=head2 Subroutine Attributes
X<attribute> X<subroutine, attribute> X<attrs>

A subroutine declaration or definition may have a list of attributes
associated with it.  If such an attribute list is present, it is
broken up at space or colon boundaries and treated as though a
C<use attributes> had been seen.  See L<attributes> for details
about what attributes are currently supported.
Unlike the limitation with the obsolescent C<use attrs>, the
C<sub : ATTRLIST> syntax works to associate the attributes with
a pre-declaration, and not just with a subroutine definition.

The attributes must be valid as simple identifier names (without any
punctuation other than the '_' character).  They may have a parameter
list appended, which is only checked for whether its parentheses ('(',')')
nest properly.

Examples of valid syntax (even though the attributes are unknown):

    sub fnord (&\%) : switch(10,foo(7,3))  :  expensive;
    sub plugh () : Ugly('\(") :Bad;
    sub xyzzy : _5x5 { ... }

Examples of invalid syntax:

    sub fnord : switch(10,foo(); # ()-string not balanced
    sub snoid : Ugly('(');	  # ()-string not balanced
    sub xyzzy : 5x5;		  # "5x5" not a valid identifier
    sub plugh : Y2::north;	  # "Y2::north" not a simple identifier
    sub snurt : foo + bar;	  # "+" not a colon or space

The attribute list is passed as a list of constant strings to the code
which associates them with the subroutine.  In particular, the second example
of valid syntax above currently looks like this in terms of how it's
parsed and invoked:

    use attributes __PACKAGE__, \&plugh, q[Ugly('\(")], 'Bad';

For further details on attribute lists and their manipulation,
see L<attributes> and L<Attribute::Handlers>.

=head1 SEE ALSO

See L<perlref/"Function Templates"> for more about references and closures.
See L<perlxs> if you'd like to learn about calling C subroutines from Perl.  
See L<perlembed> if you'd like to learn about calling Perl subroutines from C.  
See L<perlmod> to learn about bundling up your functions in separate files.
See L<perlmodlib> to learn what library modules come standard on your system.
See L<perlootut> to learn how to make object method calls.
@


1.18
log
@Fix merge issues, remove excess files - match perl-5.20.2 dist
@
text
@d18 1
a18 1
    sub NAME SIG BLOCK            #  with signature
d21 1
a21 1
    sub NAME : ATTRS SIG BLOCK    #  with attributes and signature
d28 1
a28 1
    $subref = sub SIG BLOCK;             # with signature
d31 1
a31 1
    $subref = sub : ATTRS SIG BLOCK;     # with attribs and signature
d242 1
a242 1
The behaviour of C<__SUB__> within a regex code block (such as C</(?{...})/>)
d261 1
a261 1
C<CLONE>, C<CLONE_SKIP>, 
d265 1
a265 1
C<DESTROY>
d321 3
a323 2
the signature is a parenthesised list that goes immediately before
the braced block.  The signature declares lexical variables that are
d493 1
a493 1
    sub foo :prototype($$) ($left, $right) {
d497 2
a498 3
The prototype attribute, and any other attributes, must come before
the signature.  The signature always immediately precedes the block of
the subroutine's body.
d517 4
a520 3
confined to the enclosing block, conditional (C<if/unless/elsif/else>),
loop (C<for/foreach/while/until/continue>), subroutine, C<eval>,
or C<do/require/use>'d file.  If more than one value is listed, the
d901 1
a901 1
code that relies on any particular behaviour of localising tied arrays
a1094 3
It is a known bug that lexical subroutines cannot be used as the C<SUBNAME>
argument to C<sort>.  This will be fixed in a future version of Perl.

d1294 1
a1294 1
	my @@retlist = ();
d1399 2
a1400 2
    sub mypush (+@@)
    sub mypush :prototype(+@@)
d1437 3
a1439 3
   sub mypop (+)	   mypop @@array
   sub mysplice (+$$@@)	   mysplice @@array, 0, 2, @@pushme
   sub mykeys (+)	   mykeys %{$hashref}
d1643 1
d1645 4
a1648 4
Be aware that these will not be inlined; as they contain inner scopes,
the constant folding doesn't reduce them to a single constant:

    sub foo_set () { if (FLAG_MASK & FLAG_FOO) { 1 } }
d1658 1
d1688 33
d1733 1
a1733 1
L<B::Deparse>, consider this example of two subroutines returning
d1766 2
a1767 1
mechanism in some other way, e.g. by adding an explicit C<return>:
@


1.17
log
@Fix merge conflicts, remove extra files, match upstream perl-5.20.1

ok deraadt@@ sthen@@ espie@@ miod@@
@
text
@d92 2
a93 2
value is returned. If the last statement is a loop control structure
like a C<foreach> or a C<while>, the returned value is unspecified. The
d250 1
a250 1
same way. The following is a list of some subroutines that currently do 
d702 1
a702 1
First, you can simply use the C<state> feature. Or, you can use closures,
d927 1
a927 1
In this case, the element is C<local>ized I<by name>. This means that
d970 1
a970 1
it when it ends. They return the array/hash value before the localization,
d989 2
a990 1
except that for those the C<local> is scoped to the C<do> block. Slices are
d1034 1
a1034 1
by a scalar. For example, consider:
d1049 1
a1049 1
when used with objects, they may violate encapsulation. A normal
d1051 1
a1051 1
it is protecting, an lvalue subroutine cannot. If you require any
d1094 3
d1452 1
a1452 1
C<< my_function()->[0] >>. The value passed as part of C<@@_> will be a
d1457 1
a1457 1
allowed argument type. For example:
d1662 1
a1662 1
has no other references. Only the first example here will be inlined:
d1718 1
a1718 1
get a warning by default. You can use this warning to tell whether or
d1857 1
a1857 1
the equivalent I/O operator C<< <FILEHANDLE> >>. Also, overriding
@


1.16
log
@Merge perl-5.18.2 plus local patches, remove old files

OK espie@@ sthen@@ deraadt@@
@
text
@d18 1
d21 1
d28 1
d31 1
d66 3
a68 1
Any arguments passed in show up in the array C<@@_>.  Therefore, if
d97 1
d249 51
a299 2
Subroutines that do special, pre-defined things include C<AUTOLOAD>, C<CLONE>,
C<DESTROY> plus all functions mentioned in L<perltie> and L<PerlIO::via>.
d306 194
d814 9
a822 9
    local $foo;			# make $foo dynamically local
    local (@@wid, %get);		# make list of variables local
    local $foo = "flurp";	# make $foo dynamic, and init it
    local @@oof = @@bar;		# make @@oof dynamic, and init it

    local $hash{key} = "val";	# sets a local value for this hash entry
    delete local $hash{key};    # delete this entry for the current block
    local ($cond ? $v1 : $v2);	# several types of lvalues support
				# localization
d826 5
a830 5
    local *FH;			# localize $FH, @@FH, %FH, &FH  ...
    local *merlyn = *randal;	# now $merlyn is really $randal, plus
                                #     @@merlyn is really @@randal, etc
    local *merlyn = 'randal';	# SAME THING: promote 'randal' to *randal
    local *merlyn = \$randal;   # just alias $merlyn, not @@merlyn etc
a1016 3
B<WARNING>: Lvalue subroutines are still experimental and the
implementation may change in future versions of Perl.

d1047 6
a1052 27
=over 4

=item Lvalue subroutines are EXPERIMENTAL

They appear to be convenient, but there is at least one reason to be
circumspect.

They violate encapsulation.  A normal mutator can check the supplied
argument before setting the attribute it is protecting, an lvalue
subroutine never gets that chance.  Consider;

    my $some_array_ref = [];	# protected by mutators ??

    sub set_arr { 		# normal mutator
	my $val = shift;
	die("expected array, you supplied ", ref $val)
	   unless ref $val eq 'ARRAY';
	$some_array_ref = $val;
    }
    sub set_arr_lv : lvalue {	# lvalue mutator
	$some_array_ref;
    }

    # set_arr_lv cannot stop this !
    set_arr_lv() = { a => 1 };

=back
d1250 2
a1251 2
        grow();                 # really calls shrink()
	move();			# if move() grow()s, it shrink()s too
d1253 1
a1253 1
    grow();			# get the real grow() again
d1393 3
a1395 1
using function prototyping.  If you declare
d1398 8
d1407 1
a1407 1
then C<mypush()> takes arguments exactly like C<push()> does.  The
d1427 1
a1427 1
    Declared as			Called as
d1429 14
a1442 14
    sub mylink ($$)	     mylink $old, $new
    sub myvec ($$$)	     myvec $var, $offset, 1
    sub myindex ($$;$)	     myindex &getstring, "substr"
    sub mysyswrite ($$$;$)   mysyswrite $buf, 0, length($buf) - $off, $off
    sub myreverse (@@)	     myreverse $a, $b, $c
    sub myjoin ($@@)	     myjoin ":", $a, $b, $c
    sub mypop (+)	     mypop @@array
    sub mysplice (+$$@@)	     mysplice @@array, 0, 2, @@pushme
    sub mykeys (+)	     mykeys %{$hashref}
    sub myopen (*;$)	     myopen HANDLE, $name
    sub mypipe (**)	     mypipe READHANDLE, WRITEHANDLE
    sub mygrep (&@@)	     mygrep { /foo/ } $a, $b, $c
    sub myrand (;$)	     myrand 42
    sub mytime ()	     mytime
d1601 10
d1656 9
a1664 10
If you redefine a subroutine that was eligible for inlining, you'll get
a warning by default.  (You can use this warning to tell whether or not a
particular subroutine is considered constant.)  The warning is
considered severe enough not to be affected by the B<-w>
switch (or its absence) because previously compiled
invocations of the function will still be using the old value of the
function.  If you need to be able to redefine the subroutine, you need to
ensure that it isn't inlined, either by dropping the C<()> prototype
(which changes calling semantics, so beware) or by thwarting the
inlining mechanism in some other way, such as
d1666 5
a1670 2
    sub not_inlined () {
    	23 if $];
d1672 60
@


1.15
log
@merge/resolve conflicts
(some more to do after this one)
@
text
@d235 3
d457 1
a457 1
Beginning with Perl 5.9.4, you can declare variables with the C<state>
d464 8
d478 7
d637 1
a637 1
example, the following statement dies, as of perl 5.9.0, with an error
d828 101
d1045 1
a1045 2
But it also works on lexically declared aggregates.  Prior to 5.005,
this operation could on occasion misbehave.
@


1.14
log
@merge in perl 5.12.2 plus local changes
@
text
@d220 1
a220 1
to cheat if you know what you're doing.  See L<Prototypes> below.
d223 12
d366 1
a366 1
but not beyond it.  See L<perlsyn/"Simple statements"> for information
d454 2
a455 2
Beginning with perl 5.9.4, you can declare variables with the C<state>
keyword in place of C<my>. For that to work, though, you must have
d457 3
a459 1
by using C<-E> on one-liners. (see L<feature>)
d571 1
a571 1
Some types of lvalues can be localized as well : hash and array elements
d625 3
a627 10
Similarly, but in a way more difficult to spot, the following snippet will
die in perl 5.9.0 :

    sub f { local $_ = "foo"; print }
    for ($1) {
	# now $_ is aliased to $1, thus is magic and readonly
	f();
    }

See next section for an alternative to this situation.
a653 6
Notably, if you want to work with a brand new value of the default scalar
$_, and avoid the potential problem listed above about $_ previously
carrying a magic value, you should use C<local *_> instead of C<local $_>.
As of perl 5.9.1, you can also use the lexical form of C<$_> (declaring it
with C<my $_>), which avoids completely this problem.

d757 1
a757 2
	# return $val; this doesn't work, don't say "return"
	$val;
d786 1
a786 1
They appear to be convenient, but there are several reasons to be
a788 5
You can't use the return keyword, you must pass out the value before
falling out of subroutine scope. (see comment in example above).  This
is usually not a problem, but it disallows an explicit return out of a
deeply nested loop, which is sometimes a nice way out.

d904 1
a904 1
        local *grow = \&shrink; # only until this block exists
d1051 1
a1051 1
    sub mypush (\@@@@)
d1081 3
a1083 3
    sub mypop (\@@)	     mypop @@array
    sub mysplice (\@@$$@@)     mysplice @@array, 0, 2, @@pushme
    sub mykeys (\%)	     mykeys %{$hashref}
d1091 6
a1096 3
that absolutely must start with that character.  The value passed
as part of C<@@_> will be a reference to the actual argument given
in the subroutine call, obtained by applying C<\> to that argument.
d1098 2
a1099 2
You can also backslash several argument types simultaneously by using
the C<\[]> notation:
d1134 14
d1151 3
a1153 3
As the last character of a prototype, or just before a semicolon, you can
use C<_> in place of C<$>: if this argument is not provided, C<$_> will be
used instead.
d1164 5
a1168 1
without a prototype.
d1293 1
a1293 1
a mandatory warning.  (You can use this warning to tell whether or not a
d1295 2
a1296 1
considered severe enough not to be optional because previously compiled
d1329 4
a1332 2
function call, it isn't: you can't take a reference to it, such as
the incorrect C<\&CORE::open> might appear to produce.
d1447 4
a1450 1
C<import> or C<unimport> method is just skipped instead.)
d1478 1
a1478 1
A more complete example of this is the standard Shell module, which
d1535 1
a1535 1
See L<perltoot> to learn how to make object method calls.
@


1.13
log
@Merge in perl 5.10.1
@
text
@d538 1
d695 49
@


1.12
log
@fix conflicts and merge in local changes to perl 5.10.0
@
text
@d1037 1
a1037 1
    sub mysplice (\@@$$@@)     mysplice @@array, @@array, 0, @@pushme
@


1.11
log
@merge in perl 5.8.8
@
text
@d230 4
a233 4
The C<BEGIN>, C<CHECK>, C<INIT> and C<END> subroutines are not so much
subroutines as named special code blocks, of which you can have more
than one in a package, and which you can B<not> call explicitly.  See
L<perlmod/"BEGIN, CHECK, INIT and END">
a396 1
    my $_;		# also illegal (currently)
d434 28
a461 1
X<static> X<variable, persistent> X<variable, static> X<closure>
d508 3
a510 2
See L<perlmod/"BEGIN, CHECK, INIT and END"> about the
special triggered code blocks, C<BEGIN>, C<CHECK>, C<INIT> and C<END>.
d649 2
d1042 1
a1042 1
    sub myrand ($)	     myrand 42
d1086 1
a1086 1
A semicolon separates mandatory arguments from optional arguments.
d1089 4
d1304 3
a1306 4
	local *D;
	if (opendir D, '.') { 
	    @@got = grep /$pat/, readdir D; 
	    closedir D;   
d1355 1
a1355 1
C<glob>, the C<E<lt>*E<gt>> glob operator is overridden as well.
d1358 2
a1359 1
the equivalent I/O operator C<< <FILEHANDLE> >>.
d1377 2
a1378 1
because, that's why...
d1404 1
a1404 1
    ls -l;
@


1.10
log
@sync in-tree perl with 5.8.6
@
text
@d2 1
d9 1
d22 1
d30 1
d35 1
d60 1
d74 1
d76 14
a89 10
The return value of a subroutine is the value of the last expression
evaluated by that sub, or the empty list in the case of an empty sub.
More explicitly, a C<return> statement may be used to exit the
subroutine, optionally specifying the returned value, which will be
evaluated in the appropriate context (list, scalar, or void) depending
on the context of the subroutine call.  If you specify no return value,
the subroutine returns an empty list in list context, the undefined
value in scalar context, or nothing in void context.  If you return
one or more aggregates (arrays and hashes), these will be flattened
together into one large indistinguishable list.
d98 1
d145 1
d155 1
d199 1
d206 1
d221 1
d236 2
d265 1
d279 1
d362 1
d370 1
d435 1
d492 2
d549 1
d565 1
d601 1
d604 1
d624 1
d667 1
d737 1
d780 1
d858 1
d972 1
d1073 1
d1098 1
d1152 1
d1208 1
d1331 1
d1382 1
d1400 2
a1401 2
    sub fnord (&\%) : switch(10,foo(7,3))  :  expensive ;
    sub plugh () : Ugly('\(") :Bad ;
d1406 5
a1410 5
    sub fnord : switch(10,foo() ; # ()-string not balanced
    sub snoid : Ugly('(') ;	  # ()-string not balanced
    sub xyzzy : 5x5 ;		  # "5x5" not a valid identifier
    sub plugh : Y2::north ;	  # "Y2::north" not a simple identifier
    sub snurt : foo + bar ;	  # "+" not a colon or space
@


1.9
log
@merge 5.8.5 into HEAD
remove now-unused files
crank libperl shared library major number
update Makefile.bsd-wrapper
tweak openbsd hints file for arm and m68k
@
text
@d215 1
a215 1
than one in a package, and which you can B<not> call explicitely.  See
@


1.8
log
@merge local changes into perl-5.8.3
@
text
@d70 2
a71 1
evaluated.  More explicitly, a C<return> statement may be used to exit the
d1135 11
a1145 1
    sub BAZ_VAL () {
a1151 7
    }

    sub N () { int(BAZ_VAL) / 3 }
    BEGIN {
	my $prod = 1;
	for (1..N) { $prod *= $_ }
	sub N_FACTORIAL () { $prod }
@


1.7
log
@Resolve conflicts for perl 5.8.2, remove old files, and add OpenBSD-specific scaffolding
@
text
@d205 11
a215 7
Functions whose names are in all upper case are reserved to the Perl
core, as are modules whose names are in all lower case.  A
function in all capitals is a loosely-held convention meaning it
will be called indirectly by the run-time system itself, usually
due to a triggered event.  Functions that do special, pre-defined
things include C<BEGIN>, C<CHECK>, C<INIT>, C<END>, C<AUTOLOAD>,
C<CLONE> and C<DESTROY>--plus all functions mentioned in L<perltie>.
d447 1
a447 1
sub around it to make sure it gets executed before your program
d450 1
a450 1
    sub BEGIN {
d457 2
a458 2
See L<perlmod/"Package Constructors and Destructors"> about the
special triggered functions, C<BEGIN>, C<CHECK>, C<INIT> and C<END>.
@


1.6
log
@Resolve conflicts, remove old files, merge local changes
@
text
@d233 1
a233 1
scoped--magical built-ins like C<$/> must currently be C<local>ize
d328 2
a329 8
but not beyond it.

B<NOTE:> The behaviour of a C<my> statement modified with a statement
modifier conditional or loop construct (e.g. C<my $x if ...>) is
B<undefined>.  The value of the C<my> variable may be C<undef>, any
previously assigned value, or possibly anything else.  Don't rely on
it.  Future versions of perl might do something different from the
version of perl you try it out on.  Here be dragons.
d466 3
a468 4
variables, filehandles and formats, and direct manipulation of the Perl
symbol table itself.  Format variables often use C<local> though, as do
other variables whose current value must be visible to called
subroutines.
d472 12
a483 4
    local $foo;	    		# declare $foo dynamically local
    local (@@wid, %get); 	# declare list of variables local
    local $foo = "flurp";	# declare $foo dynamic, and init it
    local @@oof = @@bar;		# declare @@oof dynamic, and init it
d498 7
a504 2
If more than one variable is given to C<local>, they must be placed in
parentheses.  All listed elements must be legal lvalues.  This operator works
d511 1
a511 2
undefined value.)  Commonly this is used to name the parameters to a
subroutine.  Examples:
d513 3
a515 5
    for $i ( 0 .. 9 ) {
	$digits{$i} = $i;
    }
    # assume this function uses global %digits hash
    parse_num();
d517 1
a517 13
    # now temporarily add to %digits hash
    if ($base12) {
	# (NOTE: not claiming this is efficient!)
	local %digits  = (%digits, 't' => 10, 'e' => 11);
	parse_num();  # parse_num gets this new %digits!
    }
    # old %digits restored here

Because C<local> is a run-time operator, it gets executed each time
through a loop.  In releases of Perl previous to 5.0, this used more stack
storage each time until the loop was exited.  Perl now reclaims the space
each time through, but it's still more efficient to declare your variables
outside the loop.
d532 10
a541 11
A note about C<local()> and composite types is in order.  Something
like C<local(%foo)> works by temporarily placing a brand new hash in
the symbol table.  The old hash is left alone, but is hidden "behind"
the new one.

This means the old variable is completely invisible via the symbol
table (i.e. the hash entry in the C<*foo> typeglob) for the duration
of the dynamic scope within which the C<local()> was seen.  This
has the effect of allowing one to temporarily occlude any magic on
composite types.  For instance, this will briefly alter a tied
hash to some other implementation:
d543 14
a556 10
    tie %ahash, 'APackage';
    [...]
    {
       local %ahash;
       tie %ahash, 'BPackage';
       [..called code will see %ahash tied to 'BPackage'..]
       {
          local %ahash;
          [..%ahash is a normal (untied) hash here..]
       }
a557 1
    [..%ahash back to its initial tied self again..]
d559 4
a562 1
B<WARNING> The code example above does not currently work as described.
d566 1
a566 1
See L<perldelta/"Localising Tied Arrays and Hashes Is Broken"> for more
d569 3
a571 2
As another example, a custom implementation of C<%ENV> might look
like this:
d573 16
a588 6
    {
        local %ENV;
        tie %ENV, 'MyOwnEnv';
        [..do your own fancy %ENV manipulation here..]
    }
    [..normal %ENV behavior here..]
d1167 2
a1168 2
Overriding may be done only by importing the name from a
module--ordinary predeclaration isn't good enough.  However, the
@


1.5
log
@merge in perl 5.6.1 with our local changes
@
text
@d172 1
a172 1
everything in C<@@a> and made C<@@b> an empty list.  See 
d210 2
a211 2
things include C<BEGIN>, C<CHECK>, C<INIT>, C<END>, C<AUTOLOAD>, and
C<DESTROY>--plus all functions mentioned in L<perltie>.
d223 3
a225 3
B<WARNING>: The use of attribute lists on C<my> declarations is
experimental.  This feature should not be relied upon.  It may
change or disappear in future releases of Perl.  See L<attributes>.
d330 6
a335 3
None of the foregoing text applies to C<if/unless> or C<while/until>
modifiers appended to simple statements.  Such modifiers are not
control structures and have no effect on scoping.
d566 7
d625 2
a626 2
B<WARNING>: Lvalue subroutines are still experimental and the implementation
may change in future versions of Perl.
d633 1
d659 33
d771 1
a771 1
        pipe    (READER,  WRITER);    or die "pipe: $!";
d973 16
d1068 7
d1248 27
d1363 1
a1363 1
see L<attributes>.
@


1.4
log
@perl-5.6.0 + local changes
@
text
@d42 1
a42 1
generated on the fly using C<eval> or anonymous subroutines (closures).
d157 1
a157 1
passed real scalars or arrays.  Perl sees all arugments as one big,
d172 2
a173 2
everything in C<@@a> and made C<@@b> an empty list.  See L<Pass by
Reference> for alternatives.
d360 1
a360 1
time, the compiler takes notice of it.  The principle usefulness
a647 4
The current implementation does not allow arrays and hashes to be
returned from lvalue subroutines directly.  You may return a
reference instead.  This restriction may be lifted in future.

d696 3
a698 1
=over
d700 1
a700 1
=item 1. You need to give a global variable a temporary value, especially $_.
d717 3
a719 1
=item 2. You need to create a local file or directory handle or a local function.
d749 3
a751 1
=item 3. You want to temporarily change just one element of an array or hash.
d1275 1
a1275 1
See L<perlembed> if you'd like to learn about calling PErl subroutines from C.  
@


1.3
log
@perl5.005_03 (stock)
@
text
@d9 9
a17 5
    sub NAME;	      	  # A "forward" declaration.
    sub NAME(PROTO);  	  #  ditto, but with prototypes

    sub NAME BLOCK    	  # A declaration and a definition.
    sub NAME(PROTO) BLOCK #  ditto, but with prototypes
d21 4
a24 2
    $subref = sub BLOCK;	    # no proto
    $subref = sub (PROTO) BLOCK;    # with proto
d28 1
a28 1
    use PACKAGE qw(NAME1 NAME2 NAME3);
d34 1
d39 6
a44 6
Like many languages, Perl provides for user-defined subroutines.  These
may be located anywhere in the main program, loaded in from other files
via the C<do>, C<require>, or C<use> keywords, or even generated on the
fly using C<eval> or anonymous subroutines (closures).  You can even call
a function indirectly using a variable containing its name or a CODE reference
to it.
d54 1
a54 1
there's really no difference from the language's perspective.)
d56 12
a67 11
Any arguments passed to the routine come in as the array C<@@_>.  Thus if you
called a function with two arguments, those would be stored in C<$_[0]>
and C<$_[1]>.  The array C<@@_> is a local array, but its elements are
aliases for the actual scalar parameters.  In particular, if an element
C<$_[0]> is updated, the corresponding argument is updated (or an error
occurs if it is not updatable).  If an argument is an array or hash
element which did not exist when the function was called, that element is
created only when (and if) it is modified or if a reference to it is
taken.  (Some earlier versions of Perl created the element whether or not
it was assigned to.)  Note that assigning to the whole array C<@@_> removes
the aliasing, and does not update any arguments.
d69 2
a70 2
The return value of the subroutine is the value of the last expression
evaluated.  Alternatively, a C<return> statement may be used to exit the
d74 12
a85 12
the subroutine will return an empty list in a list context, an undefined
value in a scalar context, or nothing in a void context.  If you return
one or more arrays and/or hashes, these will be flattened together into
one large indistinguishable list.

Perl does not have named formal parameters, but in practice all you do is
assign to a C<my()> list of these.  Any variables you use in the function
that aren't declared private are global variables.  For the gory details
on creating private variables, see
L<"Private Variables via my()"> and L<"Temporary Values via local()">.
To create protected environments for a set of functions in a separate
package (and probably a separate file), see L<perlmod/"Packages">.
d104 1
a104 1
	$thisline = $lookahead;  # GLOBAL VARIABLES!!
d113 1
a113 1
	$thisline;
d117 1
a117 1
    while ($_ = get_line()) {
d121 1
a121 1
Use array assignment to a local list to name your formal arguments:
d128 4
a131 3
This also has the effect of turning call-by-reference into call-by-value,
because the assignment copies the values.  Otherwise a function is free to
do in-place modifications of C<@@_> and change its caller's values.
d148 1
a148 1
    ($v3, $v4) = upcase($v1, $v2);  # this doesn't
d156 6
a161 6
Notice how this (unprototyped) function doesn't care whether it was passed
real scalars or arrays.  Perl will see everything as one big long flat C<@@_>
parameter list.  This is one of the ways where Perl's simple
argument-passing style shines.  The C<upcase()> function would work perfectly
well without changing the C<upcase()> definition even if we fed it things
like this:
d170 20
a189 18
Because like its flat incoming parameter list, the return list is also
flat.  So all you have managed to do here is stored everything in C<@@a> and
made C<@@b> an empty list.  See L<Pass by Reference> for alternatives.

A subroutine may be called using the "C<&>" prefix.  The "C<&>" is optional
in modern Perls, and so are the parentheses if the subroutine has been
predeclared.  (Note, however, that the "C<&>" is I<NOT> optional when
you're just naming the subroutine, such as when it's used as an
argument to C<defined()> or C<undef()>.  Nor is it optional when you want to
do an indirect subroutine call with a subroutine name or reference
using the C<&$subref()> or C<&{$subref}()> constructs.  See L<perlref>
for more on that.)

Subroutines may be called recursively.  If a subroutine is called using
the "C<&>" form, the argument list is optional, and if omitted, no C<@@_> array is
set up for the subroutine: the C<@@_> array at the time of the call is
visible to subroutine instead.  This is an efficiency mechanism that
new users may wish to avoid.
d200 2
a201 2
Not only does the "C<&>" form make the argument list optional, but it also
disables any prototype checking on the arguments you do provide.  This
d203 1
a203 1
to cheat if you know what you're doing.  See the section on Prototypes below.
d205 7
a211 7
Function whose names are in all upper case are reserved to the Perl core,
just as are modules whose names are in all lower case.  A function in
all capitals is a loosely-held convention meaning it will be called
indirectly by the run-time system itself.  Functions that do special,
pre-defined things are C<BEGIN>, C<END>, C<AUTOLOAD>, and C<DESTROY>--plus all the
functions mentioned in L<perltie>.  The 5.005 release adds C<INIT>
to this list.
d221 1
d223 24
a246 18
A "C<my>" declares the listed variables to be confined (lexically) to the
enclosing block, conditional (C<if/unless/elsif/else>), loop
(C<for/foreach/while/until/continue>), subroutine, C<eval>, or
C<do/require/use>'d file.  If more than one value is listed, the list
must be placed in parentheses.  All listed elements must be legal lvalues.
Only alphanumeric identifiers may be lexically scoped--magical
builtins like C<$/> must currently be C<local>ize with "C<local>" instead.

Unlike dynamic variables created by the "C<local>" operator, lexical
variables declared with "C<my>" are totally hidden from the outside world,
including any called subroutines (even if it's the same subroutine called
from itself or elsewhere--every call gets its own copy).

This doesn't mean that a C<my()> variable declared in a statically
I<enclosing> lexical scope would be invisible.  Only the dynamic scopes
are cut off.   For example, the C<bumpx()> function below has access to the
lexical C<$x> variable because both the my and the sub occurred at the same
scope, presumably the file scope.
d251 3
a253 3
(An C<eval()>, however, can see the lexical variables of the scope it is
being evaluated in so long as the names aren't hidden by declarations within
the C<eval()> itself.  See L<perlref>.)
d255 1
a255 1
The parameter list to C<my()> may be assigned to if desired, which allows you
d258 1
a258 1
this is used to name the parameters to a subroutine.  Examples:
d271 2
a272 2
The "C<my>" is simply a modifier on something you might assign to.  So when
you do assign to the variables in its argument list, the "C<my>" doesn't
d296 1
a296 1
can be used to initialize the new $x with the value of the old C<$x>, and
d301 1
a301 1
is false unless the old C<$x> happened to have the value C<123>.
d305 1
a305 1
part of the scope, too.  Thus in the loop
d307 1
a307 1
    while (defined(my $line = <>)) {
d313 1
a313 1
the scope of C<$line> extends from its declaration throughout the rest of
d326 2
a327 2
the scope of C<$answer> extends from its declaration throughout the rest
of the conditional (including C<elsif> and C<else> clauses, if any),
d330 1
a330 1
(None of the foregoing applies to C<if/unless> or C<while/until>
d332 1
a332 1
control structures and have no effect on scoping.)
d335 4
a338 3
(in the manner of C<local>; see below).  However, if the index
variable is prefixed with the keyword "C<my>", then it is lexically
scoped instead.  Thus in the loop
d344 2
a345 2
the scope of C<$i> extends to the end of the loop, but not beyond it, and
so the value of C<$i> is unavailable in C<some_function()>.
d348 2
a349 2
As an aid to catching implicit references to package variables,
if you say
d353 13
a365 10
then any variable reference from there to the end of the enclosing
block must either refer to a lexical variable, or must be fully
qualified with the package name.  A compilation error results
otherwise.  An inner block may countermand this with S<"C<no strict 'vars'>">.

A C<my()> has both a compile-time and a run-time effect.  At compile time,
the compiler takes notice of it; the principle usefulness of this is to
quiet S<"C<use strict 'vars'>">.  The actual initialization is delayed until
run time, so it gets executed appropriately; every time through a loop,
for example.
d367 1
a367 1
Variables declared with "C<my>" are not part of any package and are therefore
d385 8
a392 7
You may declare "C<my>" variables at the outermost scope of a file to hide
any such identifiers totally from the outside world.  This is similar
to C's static variables at the file level.  To do this with a subroutine
requires the use of a closure (anonymous function with lexical access).
If a block (such as an C<eval()>, function, or C<package>) wants to create
a private subroutine that cannot be called from outside that block,
it can declare a lexical variable containing an anonymous sub reference:
d401 1
a401 1
C<$some_pack::secret_version> or anything; it's just C<$secret_version>,
d404 4
a407 2
This does not work with object methods, however; all object methods have
to be in the symbol table of some package to be found.
d443 1
a443 1
all in the main program, you'll need to arrange for the C<my()>
d456 2
a457 1
See L<perlmod/"Package Constructors and Destructors"> about the C<BEGIN> function.
d459 5
a463 5
If declared at the outermost scope, the file scope, then lexicals work
someone like C's file statics.  They are available to all functions in
that same file declared below them, but are inaccessible from outside of
the file.  This is sometimes used in modules to create private variables
for the whole module.
d467 1
a467 1
B<NOTE>: In general, you should be using "C<my>" instead of "C<local>", because
d470 1
a470 1
symbol table itself.  Format variables often use "C<local>" though, as do
d487 6
a492 6
A C<local()> modifies its listed variables to be "local" to the enclosing
block, C<eval>, or C<do FILE>--and to I<any subroutine called from within that block>.
A C<local()> just gives temporary values to global (meaning package)
variables.  It does B<not> create a local variable.  This is known as
dynamic scoping.  Lexical scoping is done with "C<my>", which works more
like C's auto declarations.
d494 1
a494 1
If more than one variable is given to C<local()>, they must be placed in
d519 1
a519 1
Because C<local()> is a run-time command, it gets executed every time
d610 4
a613 5
Note also that when you C<local>ize a member of a composite type that
B<does not exist previously>, the value is treated as though it were
in an lvalue context, i.e., it is first created and then C<local>ized.
The consequence of this is that the hash or array is in fact permanently
modified. For instance, if you say
d615 12
a626 5
    %hash = ( 'This' => 'is', 'a' => 'test' );
    @@ary  = ( 0..5 );
    {
    	local($ary[8]) = 0;
    	local($hash{'b'}) = 'whatever';
a627 2
    printf "%%hash has now %d keys, \@@ary %d elements.\n",
        scalar(keys(%hash)), scalar(@@ary);
d629 16
a644 1
Perl will print
d646 1
a646 1
    %hash has now 3 keys, @@ary 9 elements.
d648 3
a650 2
The above behavior of local() on non-existent members of composite
types is subject to change in future.
d654 4
a657 4
[Note:  The mechanism described in this section was originally the only
way to simulate pass-by-reference in older versions of Perl.  While it
still works fine in modern versions, the new reference mechanism is
generally easier to work with.  See below.]
d670 1
a670 1
whatever "C<*>" value was assigned to it.  Example:
d681 1
a681 1
Note that scalars are already passed by reference, so you can modify
d696 2
a697 2
Despite the existence of C<my()>, there are still three places where the
C<local()> operator still shines.  In fact, in these three places, you
d702 1
a702 1
=item 1. You need to give a global variable a temporary value, especially C<$_>.
d716 1
a716 1
It particular, it's important to C<local>ize C<$_> in any routine that assigns
d721 2
a722 2
A function that needs a filehandle of its own must use C<local()> uses
C<local()> on complete typeglob.   This can be used to create new symbol
d773 3
a775 3
Here are a few simple examples.  First, let's pass in several
arrays to a function and have it C<pop> all of then, return a new
list of all their former last elements:
d814 4
a817 3
That syntax simply won't work.  It sets just C<@@a> or C<%a> and clears the C<@@b> or
C<%b>.  Plus the function didn't get passed into two separate arrays or
hashes: it got one long list in C<@@_>, as always.
d849 3
a851 2
a tad subtle, though, and also won't work if you're using C<my()>
variables, because only globals (well, and C<local()>s) are in the symbol table.
d854 2
a855 2
typeglob, like C<*STDOUT>, but typeglobs references would be better because
they'll still work properly under S<C<use strict 'refs'>>.  For example:
d869 2
a870 4
Another way to do this is using C<*HANDLE{IO}>, see L<perlref> for usage
and caveats.

If you're planning on generating new filehandles, you could do this:
d873 1
a873 1
	my $name = shift;
a877 4
Although that will actually produce a small memory leak.  See the bottom
of L<perlfunc/open()> for a somewhat cleaner way using the C<IO::Handle>
package.

d880 2
a881 1
As of the 5.002 release of perl, if you declare
d885 10
a894 10
then C<mypush()> takes arguments exactly like C<push()> does.  The declaration
of the function to be called must be visible at compile time.  The prototype
affects only the interpretation of new-style calls to the function, where
new-style is defined as not using the C<&> character.  In other words,
if you call it like a builtin function, then it behaves like a builtin
function.  If you call it like an old-fashioned subroutine, then it
behaves like an old-fashioned subroutine.  It naturally falls out from
this rule that prototypes have no influence on subroutine references
like C<\&foo> or on indirect subroutine calls like C<&{$subref}> or
C<$subref-E<gt>()>. 
d897 2
a898 2
function to be called is indeterminate at compile time, because it depends
on inheritance.
d900 4
a903 3
Because the intent is primarily to let you define subroutines that work
like builtin commands, here are the prototypes for some other functions
that parse almost exactly like the corresponding builtins.
d924 2
a925 3
to the subroutine (as part of C<@@_>) will be a reference to the
actual argument given in the subroutine call, obtained by applying
C<\> to that argument.
d928 1
a928 1
unbackslashed C<@@> or C<%> eats all the rest of the arguments, and forces
d931 3
a933 2
argument, does not require the "C<sub>" keyword or a subsequent comma.  A
C<*> allows the subroutine to accept a bareword, constant, scalar expression,
d936 10
a945 1
two cases) as a reference to the typeglob.
d948 1
a948 1
(It is redundant before C<@@> or C<%>.)
d950 5
a954 5
Note how the last three examples above are treated specially by the parser.
C<mygrep()> is parsed as a true list operator, C<myrand()> is parsed as a
true unary operator with unary precedence the same as C<rand()>, and
C<mytime()> is truly without arguments, just like C<time()>.  That is, if you
say
d959 1
a959 1
without the prototype.
d961 2
a962 1
The interesting thing about C<&> is that you can generate new syntax with it:
d981 1
a981 1
issues having to do with the visibility of C<@@_>.  I'm ignoring that
d986 1
a986 1
And here's a reimplementation of C<grep>:
d1022 1
a1022 1
Then you've just supplied an automatic C<scalar()> in front of their
d1025 3
a1027 3
the C<func()> now gets passed in C<1>, that is, the number of elements
in C<@@foo>.  And the C<split()> gets called in a scalar context and
starts scribbling on your C<@@_> parameter list.
d1035 2
a1036 2
inlining.  If the result after optimization and constant folding is
either a constant or a lexically-scoped scalar which has no other
d1038 2
a1039 3
without C<&> or C<do>. Calls made using C<&> or C<do> are never
inlined.  (See F<constant.pm> for an easy way to declare most
constants.)
d1075 1
a1075 1
function.  If you need to be able to redefine the subroutine you need to
d1077 1
a1077 1
(which changes the calling semantics, so beware) or by thwarting the
d1084 1
a1084 1
=head2 Overriding Builtin Functions
d1086 1
a1086 1
Many builtin functions may be overridden, though this should be tried
d1088 1
a1088 1
done by a package attempting to emulate missing builtin functionality
d1093 2
a1094 2
C<subs> pragma (compiler directive) lets you, in effect, predeclare subs
via the import syntax, and these names may then override the builtin ones:
d1100 3
a1102 3
To unambiguously refer to the builtin form, one may precede the
builtin name with the special package qualifier C<CORE::>.  For example,
saying C<CORE::open()> will always refer to the builtin C<open()>, even
d1104 3
a1106 1
C<&open()> from elsewhere.
d1108 2
a1109 2
Library modules should not in general export builtin names like "C<open>"
or "C<chdir>" as part of their default C<@@EXPORT> list, because these may
d1111 1
a1111 1
Instead, if the module adds the name to the C<@@EXPORT_OK> list, then it's
d1117 1
a1117 1
and it would import the C<open> override, but if they said
d1121 1
a1121 1
they would get the default imports without the overrides.
d1123 1
a1123 1
The foregoing mechanism for overriding builtins is restricted, quite
d1125 1
a1125 1
method that is sometimes applicable when you wish to override a builtin
d1147 6
a1152 3
	local(*D);
	if (opendir D, '.') { @@got = grep /$pat/, readdir D; closedir D; }
	@@got;
d1163 1
a1163 1
Note that the initial comment shows a contrived, even dangerous example.
d1165 1
a1165 1
subversive) behavior for the C<glob> operator for B<every> namespace,
d1171 1
a1171 1
cleanly override perl's C<glob> operator.  The builtin C<glob> has
d1173 1
a1173 1
context, but our C<REGlob> doesn't.  Indeed, many perl builtins have such
a1178 1

d1181 21
a1201 19
If you call a subroutine that is undefined, you would ordinarily get an
immediate fatal error complaining that the subroutine doesn't exist.
(Likewise for subroutines being used as methods, when the method
doesn't exist in any base class of the class package.) If,
however, there is an C<AUTOLOAD> subroutine defined in the package or
packages that were searched for the original subroutine, then that
C<AUTOLOAD> subroutine is called with the arguments that would have been
passed to the original subroutine.  The fully qualified name of the
original subroutine magically appears in the C<$AUTOLOAD> variable in the
same package as the C<AUTOLOAD> routine.  The name is not passed as an
ordinary argument because, er, well, just because, that's why...

Most C<AUTOLOAD> routines will load in a definition for the subroutine in
question using eval, and then execute that subroutine using a special
form of "goto" that erases the stack frame of the C<AUTOLOAD> routine
without a trace.  (See the standard C<AutoLoader> module, for example.)
But an C<AUTOLOAD> routine can also just emulate the routine and never
define it.   For example, let's pretend that a function that wasn't defined
should just call C<system()> with those arguments.  All you'd do is this:
d1212 2
a1213 2
In fact, if you predeclare the functions you want to call that way, you don't
even need the parentheses:
d1221 1
a1221 1
can treat undefined subroutine calls as calls to Unix programs.
d1223 2
a1224 2
Mechanisms are available for modules writers to help split the modules
up into autoloadable files.  See the standard AutoLoader module
d1227 41
a1267 1
functions to perl code in L<perlxs>.
d1271 6
a1276 3
See L<perlref> for more about references and closures.  See L<perlxs> if
you'd like to learn about calling C subroutines from perl.  See L<perlmod>
to learn about bundling up your functions in separate files.
@


1.2
log
@perl 5.004_04
@
text
@d17 2
a18 1
    $subref = sub BLOCK;
d28 1
a28 1
    &NAME;	   # Passes current @@_ to subroutine.
d37 1
a37 1
to it, as in C<$var = \&function>.
d49 1
a49 1
Any arguments passed to the routine come in as the array @@_.  Thus if you
d51 1
a51 1
and C<$_[1]>.  The array @@_ is a local array, but its elements are
d58 1
a58 1
it was assigned to.)  Note that assigning to the whole array @@_ removes
d62 1
a62 1
evaluated.  Alternatively, a return statement may be used to exit the
d72 1
a72 1
assign to a my() list of these.  Any variables you use in the function
d122 1
a122 1
do in-place modifications of @@_ and change its caller's values.
d135 1
a135 1
It would be much safer if the upcase_in() function
d148 1
a148 1
real scalars or arrays.  Perl will see everything as one big long flat @@_
d150 2
a151 2
argument-passing style shines.  The upcase() function would work perfectly
well without changing the upcase() definition even if we fed it things
d162 2
a163 2
flat.  So all you have managed to do here is stored everything in @@a and
made @@b an empty list.  See L</"Pass by Reference"> for alternatives.
d165 1
a165 1
A subroutine may be called using the "&" prefix.  The "&" is optional
d167 1
a167 1
predeclared.  (Note, however, that the "&" is I<NOT> optional when
d169 1
a169 1
argument to defined() or undef().  Nor is it optional when you want to
d175 2
a176 2
the "&" form, the argument list is optional, and if omitted, no @@_ array is
set up for the subroutine: the @@_ array at the time of the call is
d189 1
a189 1
Not only does the "&" form make the argument list optional, but it also
d194 8
d211 1
a211 1
A "my" declares the listed variables to be confined (lexically) to the
d217 1
a217 1
builtins like $/ must currently be localized with "local" instead.
d219 2
a220 2
Unlike dynamic variables created by the "local" statement, lexical
variables declared with "my" are totally hidden from the outside world,
d224 10
a233 1
(An eval(), however, can see the lexical variables of the scope it is
d235 1
a235 1
the eval() itself.  See L<perlref>.)
d237 1
a237 1
The parameter list to my() may be assigned to if desired, which allows you
d253 3
a255 3
The "my" is simply a modifier on something you might assign to.  So when
you do assign to the variables in its argument list, the "my" doesn't
change whether those variables is viewed as a scalar or an array.  So
d257 1
a257 1
    my ($foo) = <STDIN>;
d266 1
a266 1
    my $foo, $bar = 1;
d278 1
a278 1
can be used to initialize the new $x with the value of the old $x, and
d283 1
a283 1
is false unless the old $x happened to have the value 123.
d295 1
a295 1
the scope of $line extends from its declaration throughout the rest of
d308 1
a308 1
the scope of $answer extends from its declaration throughout the rest
d318 1
a318 1
variable is prefixed with the keyword "my", then it is lexically
d325 2
a326 2
the scope of $i extends to the end of the loop, but not beyond it, and
so the value of $i is unavailable in some_function().
d337 1
a337 1
otherwise.  An inner block may countermand this with S<"no strict 'vars'">.
d339 1
a339 1
A my() has both a compile-time and a run-time effect.  At compile time,
d341 1
a341 1
quiet C<use strict 'vars'>.  The actual initialization is delayed until
d345 1
a345 1
Variables declared with "my" are not part of any package and are therefore
d353 1
a353 1
are still accessible using the fully qualified :: notation even while a
d361 1
a361 1
That will print out 20 and 10.
d363 2
a364 2
You may declare "my" variables at the outermost scope of a file to
hide any such identifiers totally from the outside world.  This is similar
d366 4
a369 4
requires the use of a closure (anonymous function).  If a block (such as
an eval(), function, or C<package>) wants to create a private subroutine
that cannot be called from outside that block, it can declare a lexical
variable containing an anonymous sub reference:
d378 1
a378 1
$some_pack::secret_version or anything; it's just $secret_version,
d384 22
a405 7
Just because the lexical variable is lexically (also called statically)
scoped doesn't mean that within a function it works like a C static.  It
normally works more like a C auto.  But here's a mechanism for giving a
function private variables with both lexical scoping and a static
lifetime.  If you do want to create something like C's static variables,
just enclose the whole function in an extra block, and put the
static variable outside the function but in the block.
d418 1
a418 1
all in the main program, you'll need to arrange for the my()
d420 1
a420 1
your main program, or more likely, placing merely a BEGIN
d431 7
a437 1
See L<perlrun> about the BEGIN function.
d441 1
a441 1
B<NOTE>: In general, you should be using "my" instead of "local", because
d444 1
a444 1
symbol table itself.  Format variables often use "local" though, as do
d461 6
a466 5
A local() modifies its listed variables to be local to the enclosing
block, (or subroutine, C<eval{}>, or C<do>) and I<any called from
within that block>.  A local() just gives temporary values to global
(meaning package) variables.  This is known as dynamic scoping.  Lexical
scoping is done with "my", which works more like C's auto declarations.
d468 1
a468 1
If more than one variable is given to local(), they must be placed in
d493 1
a493 1
Because local() is a run-time command, it gets executed every time
d499 2
a500 2
A local is simply a modifier on an lvalue expression.  When you assign to
a localized variable, the local doesn't change whether its list is viewed
d547 58
d624 1
a624 1
whatever "*" value was assigned to it.  Example:
d638 2
a639 2
all the elements as scalars, but you have to use the * mechanism (or
the equivalent reference mechanism) to push, pop, or change the size of
d648 71
d728 1
a728 1
arrays to a function and have it pop all of then, return a new
d768 3
a770 3
That syntax simply won't work.  It sets just @@a or %a and clears the @@b or
%b.  Plus the function didn't get passed into two separate arrays or
hashes: it got one long list in @@_, as always.
d802 2
a803 2
a tad subtle, though, and also won't work if you're using my()
variables, because only globals (well, and local()s) are in the symbol table.
d806 2
a807 2
typeglob, like *STDOUT, but typeglobs references would be better because
they'll still work properly under C<use strict 'refs'>.  For example:
d821 1
a821 1
Another way to do this is using *HANDLE{IO}, see L<perlref> for usage
d833 1
a833 1
of L<perlfunc/open()> for a somewhat cleaner way using the IO::Handle
d842 1
a842 1
then mypush() takes arguments exactly like push() does.  The declaration
d850 2
a851 1
like C<\&foo> or on indirect subroutine calls like C<&{$subref}>.
d863 14
a876 14
    sub mylink ($$)		mylink $old, $new
    sub myvec ($$$)		myvec $var, $offset, 1
    sub myindex ($$;$)		myindex &getstring, "substr"
    sub mysyswrite ($$$;$)	mysyswrite $buf, 0, length($buf) - $off, $off
    sub myreverse (@@)		myreverse $a,$b,$c
    sub myjoin ($@@)		myjoin ":",$a,$b,$c
    sub mypop (\@@)		mypop @@array
    sub mysplice (\@@$$@@)	mysplice @@array,@@array,0,@@pushme
    sub mykeys (\%)		mykeys %{$hashref}
    sub myopen (*;$)		myopen HANDLE, $name
    sub mypipe (**)		mypipe READHANDLE, WRITEHANDLE
    sub mygrep (&@@)		mygrep { /foo/ } $a,$b,$c
    sub myrand ($)		myrand 42
    sub mytime ()		mytime
d885 8
a892 6
unbackslashed @@ or % eats all the rest of the arguments, and forces
list context.  An argument represented by $ forces scalar context.  An
& requires an anonymous subroutine, which, if passed as the first
argument, does not require the "sub" keyword or a subsequent comma.  A
* does whatever it has to do to turn the argument into a reference to a
symbol table entry.
d895 1
a895 1
(It is redundant before @@ or %.)
d898 3
a900 3
mygrep() is parsed as a true list operator, myrand() is parsed as a
true unary operator with unary precedence the same as rand(), and
mytime() is truly without arguments, just like time().  That is, if you
d905 1
a905 1
you'll get mytime() + 2, not mytime(2), which is how it would be parsed
d908 1
a908 1
The interesting thing about & is that you can generate new syntax with it:
d926 3
a928 3
That prints "unphooey".  (Yes, there are still unresolved
issues having to do with the visibility of @@_.  I'm ignoring that
question for the moment.  (But note that if we make @@_ lexically
d932 1
a932 1
And here's a reimplementation of grep:
d968 2
a969 2
Then you've just supplied an automatic scalar() in front of their
argument, which can be more than a bit surprising.  The old @@foo
d971 3
a973 3
the func() now gets passed in 1, that is, the number of elements
in @@foo.  And the split() gets called in a scalar context and
starts scribbling on your @@_ parameter list.
d985 1
a985 1
inlined.  (See constant.pm for an easy way to declare most
d988 1
a988 1
All of the following functions would be inlined.
d1017 1
a1017 1
If you redefine a subroutine which was eligible for inlining you'll get
d1053 2
a1054 2
Library modules should not in general export builtin names like "open"
or "chdir" as part of their default @@EXPORT list, because these may
d1056 1
a1056 1
Instead, if the module adds the name to the @@EXPORT_OK list, then it's
d1062 1
a1062 1
and it would import the open override, but if they said
d1068 53
a1120 3
Note that such overriding is restricted to the package that requests
the import.  Some means of "globally" overriding builtins may become
available in future.
d1127 1
a1127 1
doesn't exist in any of the base classes of the class package.) If,
d1132 1
a1132 1
original subroutine magically appears in the $AUTOLOAD variable in the
d1142 1
a1142 1
should just call system() with those arguments.  All you'd do is this:
d1172 3
a1174 4
See L<perlref> for more on references.  See L<perlxs> if you'd
like to learn about calling C subroutines from perl.  See
L<perlmod> to learn about bundling up your functions in
separate files.
@


1.1
log
@Initial revision
@
text
@d25 2
a26 2
    NAME(LIST);	   # & is optional with parens.
    NAME LIST;	   # Parens optional if predeclared/imported.
d50 19
a68 7
and C<$_[1]>.  The array @@_ is a local array, but its values are implicit
references (predating L<perlref>) to the actual scalar parameters.  The
return value of the subroutine is the value of the last expression
evaluated.  Alternatively, a return statement may be used to specify the
returned value and exit the subroutine.  If you return one or more arrays
and/or hashes, these will be flattened together into one large
indistinguishable list.
d73 4
a76 4
on creating private variables, see the sections below on L<"Private
Variables via my()"> and L</"Temporary Values via local()">.  To create
protected environments for a set of functions in a separate package (and
probably a separate file), see L<perlmod/"Packages">.
d96 1
a96 1
	LINE: while ($lookahead = <STDIN>) {
d120 2
a121 2
since the assignment copies the values.  Otherwise a function is free to
do in-place modifications of @@_ and change its callers values.
d125 2
a126 2
	for (@@_) { tr/a-z/A-Z/ } 
    } 
d134 1
a134 1
It would be much safer if the upcase_in() function 
d140 1
d142 1
a142 2
	for (@@parms) { tr/a-z/A-Z/ } 
	# wantarray checks if we were called in list context
d144 1
a144 1
    } 
d164 8
a171 7
A subroutine may be called using the "&" prefix.  The "&" is optional in
Perl 5, and so are the parens if the subroutine has been predeclared.
(Note, however, that the "&" is I<NOT> optional when you're just naming
the subroutine, such as when it's used as an argument to defined() or
undef().  Nor is it optional when you want to do an indirect subroutine
call with a subroutine name or reference using the C<&$subref()> or
C<&{$subref}()> constructs.  See L<perlref> for more on that.)
d186 1
a186 1
    foo;		# like foo() IFF sub foo pre-declared, else "foo"
d203 6
a208 5
enclosing block, subroutine, C<eval>, or C<do/require/use>'d file.  If
more than one value is listed, the list must be placed in parens.  All
listed elements must be legal lvalues.  Only alphanumeric identifiers may
be lexically scoped--magical builtins like $/ must currently be localized with
"local" instead.  
d233 1
a233 1
    } 			
d242 1
a242 1
both supply a list context to the righthand side, while
d246 1
a246 1
supplies a scalar context.  But the following only declares one variable:
d260 1
a260 1
can be used to initialize the new $x with the value of the old $x, and 
d267 43
d323 3
a325 2
quiet C<use strict 'vars'>.  The actual initialization doesn't happen
until run time, so gets executed every time through a loop.
d345 3
a347 3
You may declare "my" variables at the outer most scope of a file to
totally hide any such identifiers from the outside world.  This is similar
to a C's static variables at the file level.  To do this with a subroutine
d358 1
a358 1
module, no outside module can see the subroutine, since its name is not in
d375 1
a375 1
	my $secret_val = 0; 
d378 2
a379 2
	} 
    } 
d383 1
a383 1
If this function is being sourced in from a separate file 
d385 1
a385 1
all in the main program, you'll need to arrange for the my() 
d387 1
a387 1
your pain program, or more likely, merely placing a BEGIN 
d392 1
a392 1
	my $secret_val = 0; 
d395 2
a396 2
	} 
    } 
d403 1
a403 1
it's faster and safer.  Execeptions to this include the global punctuation
d420 1
a420 1
    local *merlyn = \$randal;   # just alias $merlyn, not @@merlyn etc 
d423 1
a423 1
block, (or subroutine, C<eval{}> or C<do>) and I<the any called from
d429 1
a429 1
parens.  All listed elements must be legal lvalues.  This operator works
d431 1
a431 1
hidden stack and restoring them upon exiting the block, subroutine or
d441 1
a441 1
    } 
d443 1
a443 1
    parse_num();  
d453 1
a453 1
Because local() is a run-time command, and so gets executed every time
d466 1
a466 1
both supply a list context to the righthand side, while
d472 36
d519 1
a519 1
with a star: C<*foo>.  This is often known as a "type glob", since the
d523 2
a524 2
When evaluated, the type glob produces a scalar value that represents
all the objects of that name, including any filehandle, format or
d539 1
a539 1
to $_[0] etc.  You can modify all the elements of an array by passing
d541 1
a541 1
the equivalent reference mechanism) to push, pop or change the size of
d545 1
a545 1
passing multiple arrays in a single LIST, since normally the LIST
d547 2
a548 1
the individual arrays.  For more on typeglobs, see L<perldata/"Typeglobs">.
d552 4
a555 4
If you want to pass more than one array or hash into a function--or 
return them from it--and have them maintain their integrity,
then you're going to have to use an explicit pass-by-reference.
Before you do that, you need to understand references as detailed in L<perlref>.
d569 1
a569 1
	} 
d571 1
a571 1
    } 
d573 1
a573 1
Here's how you might write a function that returns a 
d576 1
a576 1
    @@common = inter( \%foo, \%bar, \%joe ); 
d582 2
a583 2
	    } 
	} 
d585 1
a585 1
    } 
d587 3
a589 3
So far, we're just using the normal list return mechanism.
What happens if you want to pass or return a hash?  Well, 
if you're only using one of them, or you don't mind them 
d591 1
a591 1
a little expensive.  
d599 1
a599 1
That syntax simply won't work.  It just sets @@a or %a and clears the @@b or
d616 2
a617 2
	} 
    } 
d629 2
a630 2
	} 
    } 
d634 1
a634 1
variables, since only globals (well, and local()s) are in the symbol table.
d652 3
d660 2
a661 2
	return open (FH, $path) ? \*FH : undef;
    } 
d664 2
a665 2
of L<perlfunc/open()> for a somewhat cleaner way using the FileHandle
functions supplied with the POSIX package.
d675 1
a675 1
only affects the interpretation of new-style calls to the function, where
d684 1
a684 1
function to be called is indeterminate at compile time, since it depends
d687 1
a687 1
Since the intent is primarily to let you define subroutines that work
d728 1
a728 1
mytime() is truly argumentless, just like time().  That is, if you
d738 1
a738 1
    sub try (&$) {
d746 1
a746 1
    sub catch (&) { @@_ }
d758 1
a758 1
is this sounding a little Lispish?  (Nevermind.))))
d788 1
a788 1
    } 
d799 1
a799 1
the func() now gets passed in 1, that is, the number of elments
d803 55
a857 2
This is all very powerful, of course, and should only be used in moderation
to make the world a better place.  
d861 2
a862 2
Many builtin functions may be overridden, though this should only be
tried occasionally and for good reason.  Typically this might be
d866 1
a866 1
Overriding may only be done by importing the name from a
d875 6
d882 1
a882 1
or "chdir" as part of their default @@EXPORT list, since these may
d896 4
d926 1
a926 1
    } 
d928 1
a928 1
    who('am', i');
d931 1
a931 1
In fact, if you preclare the functions you want to call that way, you don't
d943 4
a946 3
up into autoloadable files.  See the standard AutoLoader module described
in L<Autoloader>, the standard SelfLoader modules in L<SelfLoader>, and
the document on adding C functions to perl code in L<perlxs>.
d951 2
a952 2
like to learn about calling C subroutines from perl.  See 
L<perlmod> to learn about bundling up your functions in 
@


1.1.1.1
log
@Import of Perl 5.003 into the tree.  Makefile.bsd-wrapper and
config.sh.OpenBSD are the only local changes.
@
text
@@


1.1.1.2
log
@perl5.005_03
@
text
@d17 1
a17 2
    $subref = sub BLOCK;	    # no proto
    $subref = sub (PROTO) BLOCK;    # with proto
d25 3
a27 3
    NAME(LIST);	   # & is optional with parentheses.
    NAME LIST;	   # Parentheses optional if predeclared/imported.
    &NAME;	   # Makes current @@_ visible to called subroutine.
d36 1
a36 1
to it.
d48 1
a48 1
Any arguments passed to the routine come in as the array C<@@_>.  Thus if you
d50 7
a56 19
and C<$_[1]>.  The array C<@@_> is a local array, but its elements are
aliases for the actual scalar parameters.  In particular, if an element
C<$_[0]> is updated, the corresponding argument is updated (or an error
occurs if it is not updatable).  If an argument is an array or hash
element which did not exist when the function was called, that element is
created only when (and if) it is modified or if a reference to it is
taken.  (Some earlier versions of Perl created the element whether or not
it was assigned to.)  Note that assigning to the whole array C<@@_> removes
the aliasing, and does not update any arguments.

The return value of the subroutine is the value of the last expression
evaluated.  Alternatively, a C<return> statement may be used to exit the
subroutine, optionally specifying the returned value, which will be
evaluated in the appropriate context (list, scalar, or void) depending
on the context of the subroutine call.  If you specify no return value,
the subroutine will return an empty list in a list context, an undefined
value in a scalar context, or nothing in a void context.  If you return
one or more arrays and/or hashes, these will be flattened together into
one large indistinguishable list.
d59 1
a59 1
assign to a C<my()> list of these.  Any variables you use in the function
d61 4
a64 4
on creating private variables, see
L<"Private Variables via my()"> and L<"Temporary Values via local()">.
To create protected environments for a set of functions in a separate
package (and probably a separate file), see L<perlmod/"Packages">.
d84 1
a84 1
	LINE: while (defined($lookahead = <STDIN>)) {
d108 2
a109 2
because the assignment copies the values.  Otherwise a function is free to
do in-place modifications of C<@@_> and change its caller's values.
d113 2
a114 2
	for (@@_) { tr/a-z/A-Z/ }
    }
d122 1
a122 1
It would be much safer if the C<upcase_in()> function
a127 1
	return unless defined wantarray;  # void context, do nothing
d129 2
a130 1
	for (@@parms) { tr/a-z/A-Z/ }
d132 1
a132 1
    }
d135 1
a135 1
real scalars or arrays.  Perl will see everything as one big long flat C<@@_>
d137 2
a138 2
argument-passing style shines.  The C<upcase()> function would work perfectly
well without changing the C<upcase()> definition even if we fed it things
d149 2
a150 2
flat.  So all you have managed to do here is stored everything in C<@@a> and
made C<@@b> an empty list.  See L<Pass by Reference> for alternatives.
d152 7
a158 8
A subroutine may be called using the "C<&>" prefix.  The "C<&>" is optional
in modern Perls, and so are the parentheses if the subroutine has been
predeclared.  (Note, however, that the "C<&>" is I<NOT> optional when
you're just naming the subroutine, such as when it's used as an
argument to C<defined()> or C<undef()>.  Nor is it optional when you want to
do an indirect subroutine call with a subroutine name or reference
using the C<&$subref()> or C<&{$subref}()> constructs.  See L<perlref>
for more on that.)
d161 2
a162 2
the "C<&>" form, the argument list is optional, and if omitted, no C<@@_> array is
set up for the subroutine: the C<@@_> array at the time of the call is
d173 1
a173 1
    foo;		# like foo() IFF sub foo predeclared, else "foo"
d175 1
a175 1
Not only does the "C<&>" form make the argument list optional, but it also
a179 8
Function whose names are in all upper case are reserved to the Perl core,
just as are modules whose names are in all lower case.  A function in
all capitals is a loosely-held convention meaning it will be called
indirectly by the run-time system itself.  Functions that do special,
pre-defined things are C<BEGIN>, C<END>, C<AUTOLOAD>, and C<DESTROY>--plus all the
functions mentioned in L<perltie>.  The 5.005 release adds C<INIT>
to this list.

d189 6
a194 7
A "C<my>" declares the listed variables to be confined (lexically) to the
enclosing block, conditional (C<if/unless/elsif/else>), loop
(C<for/foreach/while/until/continue>), subroutine, C<eval>, or
C<do/require/use>'d file.  If more than one value is listed, the list
must be placed in parentheses.  All listed elements must be legal lvalues.
Only alphanumeric identifiers may be lexically scoped--magical
builtins like C<$/> must currently be C<local>ize with "C<local>" instead.
d196 2
a197 2
Unlike dynamic variables created by the "C<local>" operator, lexical
variables declared with "C<my>" are totally hidden from the outside world,
d201 1
a201 10
This doesn't mean that a C<my()> variable declared in a statically
I<enclosing> lexical scope would be invisible.  Only the dynamic scopes
are cut off.   For example, the C<bumpx()> function below has access to the
lexical C<$x> variable because both the my and the sub occurred at the same
scope, presumably the file scope.

    my $x = 10;
    sub bumpx { $x++ } 

(An C<eval()>, however, can see the lexical variables of the scope it is
d203 1
a203 1
the C<eval()> itself.  See L<perlref>.)
d205 1
a205 1
The parameter list to C<my()> may be assigned to if desired, which allows you
d219 1
a219 1
    }
d221 3
a223 3
The "C<my>" is simply a modifier on something you might assign to.  So when
you do assign to the variables in its argument list, the "C<my>" doesn't
change whether those variables are viewed as a scalar or an array.  So
d225 1
a225 1
    my ($foo) = <STDIN>;		# WRONG?
d228 1
a228 1
both supply a list context to the right-hand side, while
d232 1
a232 1
supplies a scalar context.  But the following declares only one variable:
d234 1
a234 1
    my $foo, $bar = 1;			# WRONG
d246 1
a246 1
can be used to initialize the new $x with the value of the old C<$x>, and
d251 1
a251 44
is false unless the old C<$x> happened to have the value C<123>.

Lexical scopes of control structures are not bounded precisely by the
braces that delimit their controlled blocks; control expressions are
part of the scope, too.  Thus in the loop

    while (defined(my $line = <>)) {
        $line = lc $line;
    } continue {
        print $line;
    }

the scope of C<$line> extends from its declaration throughout the rest of
the loop construct (including the C<continue> clause), but not beyond
it.  Similarly, in the conditional

    if ((my $answer = <STDIN>) =~ /^yes$/i) {
        user_agrees();
    } elsif ($answer =~ /^no$/i) {
        user_disagrees();
    } else {
	chomp $answer;
        die "'$answer' is neither 'yes' nor 'no'";
    }

the scope of C<$answer> extends from its declaration throughout the rest
of the conditional (including C<elsif> and C<else> clauses, if any),
but not beyond it.

(None of the foregoing applies to C<if/unless> or C<while/until>
modifiers appended to simple statements.  Such modifiers are not
control structures and have no effect on scoping.)

The C<foreach> loop defaults to scoping its index variable dynamically
(in the manner of C<local>; see below).  However, if the index
variable is prefixed with the keyword "C<my>", then it is lexically
scoped instead.  Thus in the loop

    for my $i (1, 2, 3) {
        some_function();
    }

the scope of C<$i> extends to the end of the loop, but not beyond it, and
so the value of C<$i> is unavailable in C<some_function()>.
d262 1
a262 1
otherwise.  An inner block may countermand this with S<"C<no strict 'vars'>">.
d264 1
a264 1
A C<my()> has both a compile-time and a run-time effect.  At compile time,
d266 2
a267 3
quiet S<"C<use strict 'vars'>">.  The actual initialization is delayed until
run time, so it gets executed appropriately; every time through a loop,
for example.
d269 1
a269 1
Variables declared with "C<my>" are not part of any package and are therefore
d277 1
a277 1
are still accessible using the fully qualified C<::> notation even while a
d285 1
a285 1
That will print out C<20> and C<10>.
d287 7
a293 7
You may declare "C<my>" variables at the outermost scope of a file to hide
any such identifiers totally from the outside world.  This is similar
to C's static variables at the file level.  To do this with a subroutine
requires the use of a closure (anonymous function with lexical access).
If a block (such as an C<eval()>, function, or C<package>) wants to create
a private subroutine that cannot be called from outside that block,
it can declare a lexical variable containing an anonymous sub reference:
d300 1
a300 1
module, no outside module can see the subroutine, because its name is not in
d302 1
a302 1
C<$some_pack::secret_version> or anything; it's just C<$secret_version>,
d308 7
a314 22
=head2 Persistent Private Variables

Just because a lexical variable is lexically (also called statically)
scoped to its enclosing block, C<eval>, or C<do> FILE, this doesn't mean that
within a function it works like a C static.  It normally works more
like a C auto, but with implicit garbage collection.  

Unlike local variables in C or C++, Perl's lexical variables don't
necessarily get recycled just because their scope has exited.
If something more permanent is still aware of the lexical, it will
stick around.  So long as something else references a lexical, that
lexical won't be freed--which is as it should be.  You wouldn't want
memory being free until you were done using it, or kept around once you
were done.  Automatic garbage collection takes care of this for you.

This means that you can pass back or save away references to lexical
variables, whereas to return a pointer to a C auto is a grave error.
It also gives us a way to simulate C's function statics.  Here's a
mechanism for giving a function private variables with both lexical
scoping and a static lifetime.  If you do want to create something like
C's static variables, just enclose the whole function in an extra block,
and put the static variable outside the function but in the block.
d317 1
a317 1
	my $secret_val = 0;
d320 2
a321 2
	}
    }
d325 1
a325 1
If this function is being sourced in from a separate file
d327 1
a327 1
all in the main program, you'll need to arrange for the C<my()>
d329 1
a329 1
your main program, or more likely, placing merely a C<BEGIN>
d334 1
a334 1
	my $secret_val = 0;
d337 2
a338 4
	}
    }

See L<perlmod/"Package Constructors and Destructors"> about the C<BEGIN> function.
d340 1
a340 5
If declared at the outermost scope, the file scope, then lexicals work
someone like C's file statics.  They are available to all functions in
that same file declared below them, but are inaccessible from outside of
the file.  This is sometimes used in modules to create private variables
for the whole module.
d344 2
a345 2
B<NOTE>: In general, you should be using "C<my>" instead of "C<local>", because
it's faster and safer.  Exceptions to this include the global punctuation
d347 1
a347 1
symbol table itself.  Format variables often use "C<local>" though, as do
d362 1
a362 1
    local *merlyn = \$randal;   # just alias $merlyn, not @@merlyn etc
d364 5
a368 6
A C<local()> modifies its listed variables to be "local" to the enclosing
block, C<eval>, or C<do FILE>--and to I<any subroutine called from within that block>.
A C<local()> just gives temporary values to global (meaning package)
variables.  It does B<not> create a local variable.  This is known as
dynamic scoping.  Lexical scoping is done with "C<my>", which works more
like C's auto declarations.
d370 2
a371 2
If more than one variable is given to C<local()>, they must be placed in
parentheses.  All listed elements must be legal lvalues.  This operator works
d373 1
a373 1
hidden stack and restoring them upon exiting the block, subroutine, or
d383 1
a383 1
    }
d385 1
a385 1
    parse_num();
d395 1
a395 1
Because C<local()> is a run-time command, it gets executed every time
d401 2
a402 2
A C<local> is simply a modifier on an lvalue expression.  When you assign to
a C<local>ized variable, the C<local> doesn't change whether its list is viewed
d408 1
a408 1
both supply a list context to the right-hand side, while
a413 94
A note about C<local()> and composite types is in order.  Something
like C<local(%foo)> works by temporarily placing a brand new hash in
the symbol table.  The old hash is left alone, but is hidden "behind"
the new one.

This means the old variable is completely invisible via the symbol
table (i.e. the hash entry in the C<*foo> typeglob) for the duration
of the dynamic scope within which the C<local()> was seen.  This
has the effect of allowing one to temporarily occlude any magic on
composite types.  For instance, this will briefly alter a tied
hash to some other implementation:

    tie %ahash, 'APackage';
    [...]
    {
       local %ahash;
       tie %ahash, 'BPackage';
       [..called code will see %ahash tied to 'BPackage'..]
       {
          local %ahash;
          [..%ahash is a normal (untied) hash here..]
       }
    }
    [..%ahash back to its initial tied self again..]

As another example, a custom implementation of C<%ENV> might look
like this:

    {
        local %ENV;
        tie %ENV, 'MyOwnEnv';
        [..do your own fancy %ENV manipulation here..]
    }
    [..normal %ENV behavior here..]

It's also worth taking a moment to explain what happens when you
C<local>ize a member of a composite type (i.e. an array or hash element).
In this case, the element is C<local>ized I<by name>. This means that
when the scope of the C<local()> ends, the saved value will be
restored to the hash element whose key was named in the C<local()>, or
the array element whose index was named in the C<local()>.  If that
element was deleted while the C<local()> was in effect (e.g. by a
C<delete()> from a hash or a C<shift()> of an array), it will spring
back into existence, possibly extending an array and filling in the
skipped elements with C<undef>.  For instance, if you say

    %hash = ( 'This' => 'is', 'a' => 'test' );
    @@ary  = ( 0..5 );
    {
         local($ary[5]) = 6;
         local($hash{'a'}) = 'drill';
         while (my $e = pop(@@ary)) {
             print "$e . . .\n";
             last unless $e > 3;
         }
         if (@@ary) {
             $hash{'only a'} = 'test';
             delete $hash{'a'};
         }
    }
    print join(' ', map { "$_ $hash{$_}" } sort keys %hash),".\n";
    print "The array has ",scalar(@@ary)," elements: ",
          join(', ', map { defined $_ ? $_ : 'undef' } @@ary),"\n";

Perl will print

    6 . . .
    4 . . .
    3 . . .
    This is a test only a test.
    The array has 6 elements: 0, 1, 2, undef, undef, 5

Note also that when you C<local>ize a member of a composite type that
B<does not exist previously>, the value is treated as though it were
in an lvalue context, i.e., it is first created and then C<local>ized.
The consequence of this is that the hash or array is in fact permanently
modified. For instance, if you say

    %hash = ( 'This' => 'is', 'a' => 'test' );
    @@ary  = ( 0..5 );
    {
    	local($ary[8]) = 0;
    	local($hash{'b'}) = 'whatever';
    }
    printf "%%hash has now %d keys, \@@ary %d elements.\n",
        scalar(keys(%hash)), scalar(@@ary);

Perl will print

    %hash has now 3 keys, @@ary 9 elements.

The above behavior of local() on non-existent members of composite
types is subject to change in future.

d425 1
a425 1
with a star: C<*foo>.  This is often known as a "typeglob", because the
d429 2
a430 2
When evaluated, the typeglob produces a scalar value that represents
all the objects of that name, including any filehandle, format, or
d432 1
a432 1
whatever "C<*>" value was assigned to it.  Example:
d445 3
a447 3
to C<$_[0]> etc.  You can modify all the elements of an array by passing
all the elements as scalars, but you have to use the C<*> mechanism (or
the equivalent reference mechanism) to C<push>, C<pop>, or change the size of
d451 1
a451 1
passing multiple arrays in a single LIST, because normally the LIST
d453 1
a453 73
the individual arrays.  For more on typeglobs, see
L<perldata/"Typeglobs and Filehandles">.

=head2 When to Still Use local()

Despite the existence of C<my()>, there are still three places where the
C<local()> operator still shines.  In fact, in these three places, you
I<must> use C<local> instead of C<my>.

=over

=item 1. You need to give a global variable a temporary value, especially C<$_>.

The global variables, like C<@@ARGV> or the punctuation variables, must be 
C<local>ized with C<local()>.  This block reads in F</etc/motd>, and splits
it up into chunks separated by lines of equal signs, which are placed
in C<@@Fields>.

    {
	local @@ARGV = ("/etc/motd");
        local $/ = undef;
        local $_ = <>;	
	@@Fields = split /^\s*=+\s*$/;
    } 

It particular, it's important to C<local>ize C<$_> in any routine that assigns
to it.  Look out for implicit assignments in C<while> conditionals.

=item 2. You need to create a local file or directory handle or a local function.

A function that needs a filehandle of its own must use C<local()> uses
C<local()> on complete typeglob.   This can be used to create new symbol
table entries:

    sub ioqueue {
        local  (*READER, *WRITER);    # not my!
        pipe    (READER,  WRITER);    or die "pipe: $!";
        return (*READER, *WRITER);
    }
    ($head, $tail) = ioqueue();

See the Symbol module for a way to create anonymous symbol table
entries.

Because assignment of a reference to a typeglob creates an alias, this
can be used to create what is effectively a local function, or at least,
a local alias.

    {
        local *grow = \&shrink; # only until this block exists
        grow();                 # really calls shrink()
	move();			# if move() grow()s, it shrink()s too
    }
    grow();			# get the real grow() again

See L<perlref/"Function Templates"> for more about manipulating
functions by name in this way.

=item 3. You want to temporarily change just one element of an array or hash.

You can C<local>ize just one element of an aggregate.  Usually this
is done on dynamics:

    {
	local $SIG{INT} = 'IGNORE';
	funct();			    # uninterruptible
    } 
    # interruptibility automatically restored here

But it also works on lexically declared aggregates.  Prior to 5.005,
this operation could on occasion misbehave.

=back
d457 4
a460 4
If you want to pass more than one array or hash into a function--or
return them from it--and have them maintain their integrity, then
you're going to have to use an explicit pass-by-reference.  Before you
do that, you need to understand references as detailed in L<perlref>.
d464 1
a464 1
arrays to a function and have it C<pop> all of then, return a new
d474 1
a474 1
	}
d476 1
a476 1
    }
d478 1
a478 1
Here's how you might write a function that returns a
d481 1
a481 1
    @@common = inter( \%foo, \%bar, \%joe );
d487 2
a488 2
	    }
	}
d490 1
a490 1
    }
d492 3
a494 3
So far, we're using just the normal list return mechanism.
What happens if you want to pass or return a hash?  Well,
if you're using only one of them, or you don't mind them
d496 1
a496 1
a little expensive.
d504 3
a506 3
That syntax simply won't work.  It sets just C<@@a> or C<%a> and clears the C<@@b> or
C<%b>.  Plus the function didn't get passed into two separate arrays or
hashes: it got one long list in C<@@_>, as always.
d521 2
a522 2
	}
    }
d534 2
a535 2
	}
    }
d538 2
a539 2
a tad subtle, though, and also won't work if you're using C<my()>
variables, because only globals (well, and C<local()>s) are in the symbol table.
d542 2
a543 2
typeglob, like C<*STDOUT>, but typeglobs references would be better because
they'll still work properly under S<C<use strict 'refs'>>.  For example:
a556 3
Another way to do this is using C<*HANDLE{IO}>, see L<perlref> for usage
and caveats.

d562 2
a563 2
	return open (FH, $path) ? *FH : undef;
    }
d566 2
a567 2
of L<perlfunc/open()> for a somewhat cleaner way using the C<IO::Handle>
package.
d575 1
a575 1
then C<mypush()> takes arguments exactly like C<push()> does.  The declaration
d577 1
a577 1
affects only the interpretation of new-style calls to the function, where
d583 1
a583 2
like C<\&foo> or on indirect subroutine calls like C<&{$subref}> or
C<$subref-E<gt>()>. 
d586 1
a586 1
function to be called is indeterminate at compile time, because it depends
d589 1
a589 1
Because the intent is primarily to let you define subroutines that work
d595 14
a608 14
    sub mylink ($$)	     mylink $old, $new
    sub myvec ($$$)	     myvec $var, $offset, 1
    sub myindex ($$;$)	     myindex &getstring, "substr"
    sub mysyswrite ($$$;$)   mysyswrite $buf, 0, length($buf) - $off, $off
    sub myreverse (@@)	     myreverse $a, $b, $c
    sub myjoin ($@@)	     myjoin ":", $a, $b, $c
    sub mypop (\@@)	     mypop @@array
    sub mysplice (\@@$$@@)     mysplice @@array, @@array, 0, @@pushme
    sub mykeys (\%)	     mykeys %{$hashref}
    sub myopen (*;$)	     myopen HANDLE, $name
    sub mypipe (**)	     mypipe READHANDLE, WRITEHANDLE
    sub mygrep (&@@)	     mygrep { /foo/ } $a, $b, $c
    sub myrand ($)	     myrand 42
    sub mytime ()	     mytime
d617 6
a622 8
unbackslashed C<@@> or C<%> eats all the rest of the arguments, and forces
list context.  An argument represented by C<$> forces scalar context.  An
C<&> requires an anonymous subroutine, which, if passed as the first
argument, does not require the "C<sub>" keyword or a subsequent comma.  A
C<*> allows the subroutine to accept a bareword, constant, scalar expression,
typeglob, or a reference to a typeglob in that slot.  The value will be
available to the subroutine either as a simple scalar, or (in the latter
two cases) as a reference to the typeglob.
d625 1
a625 1
(It is redundant before C<@@> or C<%>.)
d628 3
a630 3
C<mygrep()> is parsed as a true list operator, C<myrand()> is parsed as a
true unary operator with unary precedence the same as C<rand()>, and
C<mytime()> is truly without arguments, just like C<time()>.  That is, if you
d635 1
a635 1
you'll get C<mytime() + 2>, not C<mytime(2)>, which is how it would be parsed
d638 1
a638 1
The interesting thing about C<&> is that you can generate new syntax with it:
d640 1
a640 1
    sub try (&@@) {
d648 1
a648 1
    sub catch (&) { $_[0] }
d656 3
a658 3
That prints C<"unphooey">.  (Yes, there are still unresolved
issues having to do with the visibility of C<@@_>.  I'm ignoring that
question for the moment.  (But note that if we make C<@@_> lexically
d660 1
a660 1
is this sounding a little Lispish?  (Never mind.))))
d662 1
a662 1
And here's a reimplementation of C<grep>:
d690 1
a690 1
    }
d698 2
a699 2
Then you've just supplied an automatic C<scalar()> in front of their
argument, which can be more than a bit surprising.  The old C<@@foo>
d701 3
a703 55
the C<func()> now gets passed in C<1>, that is, the number of elements
in C<@@foo>.  And the C<split()> gets called in a scalar context and
starts scribbling on your C<@@_> parameter list.

This is all very powerful, of course, and should be used only in moderation
to make the world a better place.

=head2 Constant Functions

Functions with a prototype of C<()> are potential candidates for
inlining.  If the result after optimization and constant folding is
either a constant or a lexically-scoped scalar which has no other
references, then it will be used in place of function calls made
without C<&> or C<do>. Calls made using C<&> or C<do> are never
inlined.  (See F<constant.pm> for an easy way to declare most
constants.)

The following functions would all be inlined:

    sub pi ()		{ 3.14159 }		# Not exact, but close.
    sub PI ()		{ 4 * atan2 1, 1 }	# As good as it gets,
						# and it's inlined, too!
    sub ST_DEV ()	{ 0 }
    sub ST_INO ()	{ 1 }

    sub FLAG_FOO ()	{ 1 << 8 }
    sub FLAG_BAR ()	{ 1 << 9 }
    sub FLAG_MASK ()	{ FLAG_FOO | FLAG_BAR }

    sub OPT_BAZ ()	{ not (0x1B58 & FLAG_MASK) }
    sub BAZ_VAL () {
	if (OPT_BAZ) {
	    return 23;
	}
	else {
	    return 42;
	}
    }

    sub N () { int(BAZ_VAL) / 3 }
    BEGIN {
	my $prod = 1;
	for (1..N) { $prod *= $_ }
	sub N_FACTORIAL () { $prod }
    }

If you redefine a subroutine that was eligible for inlining, you'll get
a mandatory warning.  (You can use this warning to tell whether or not a
particular subroutine is considered constant.)  The warning is
considered severe enough not to be optional because previously compiled
invocations of the function will still be using the old value of the
function.  If you need to be able to redefine the subroutine you need to
ensure that it isn't inlined, either by dropping the C<()> prototype
(which changes the calling semantics, so beware) or by thwarting the
inlining mechanism in some other way, such as
d705 2
a706 3
    sub not_inlined () {
    	23 if $];
    }
d710 2
a711 2
Many builtin functions may be overridden, though this should be tried
only occasionally and for good reason.  Typically this might be
d715 1
a715 1
Overriding may be done only by importing the name from a
d724 2
a725 8
To unambiguously refer to the builtin form, one may precede the
builtin name with the special package qualifier C<CORE::>.  For example,
saying C<CORE::open()> will always refer to the builtin C<open()>, even
if the current package has imported some other subroutine called
C<&open()> from elsewhere.

Library modules should not in general export builtin names like "C<open>"
or "C<chdir>" as part of their default C<@@EXPORT> list, because these may
d727 1
a727 1
Instead, if the module adds the name to the C<@@EXPORT_OK> list, then it's
d733 1
a733 1
and it would import the C<open> override, but if they said
a738 54
The foregoing mechanism for overriding builtins is restricted, quite
deliberately, to the package that requests the import.  There is a second
method that is sometimes applicable when you wish to override a builtin
everywhere, without regard to namespace boundaries.  This is achieved by
importing a sub into the special namespace C<CORE::GLOBAL::>.  Here is an
example that quite brazenly replaces the C<glob> operator with something
that understands regular expressions.

    package REGlob;
    require Exporter;
    @@ISA = 'Exporter';
    @@EXPORT_OK = 'glob';

    sub import {
	my $pkg = shift;
	return unless @@_;
	my $sym = shift;
	my $where = ($sym =~ s/^GLOBAL_// ? 'CORE::GLOBAL' : caller(0));
	$pkg->export($where, $sym, @@_);
    }

    sub glob {
	my $pat = shift;
	my @@got;
	local(*D);
	if (opendir D, '.') { @@got = grep /$pat/, readdir D; closedir D; }
	@@got;
    }
    1;

And here's how it could be (ab)used:

    #use REGlob 'GLOBAL_glob';	    # override glob() in ALL namespaces
    package Foo;
    use REGlob 'glob';		    # override glob() in Foo:: only
    print for <^[a-z_]+\.pm\$>;	    # show all pragmatic modules

Note that the initial comment shows a contrived, even dangerous example.
By overriding C<glob> globally, you would be forcing the new (and
subversive) behavior for the C<glob> operator for B<every> namespace,
without the complete cognizance or cooperation of the modules that own
those namespaces.  Naturally, this should be done with extreme caution--if
it must be done at all.

The C<REGlob> example above does not implement all the support needed to
cleanly override perl's C<glob> operator.  The builtin C<glob> has
different behaviors depending on whether it appears in a scalar or list
context, but our C<REGlob> doesn't.  Indeed, many perl builtins have such
context sensitive behaviors, and these must be adequately supported by
a properly written override.  For a fully functional example of overriding
C<glob>, study the implementation of C<File::DosGlob> in the standard
library.


d744 1
a744 1
doesn't exist in any base class of the class package.) If,
d749 1
a749 1
original subroutine magically appears in the C<$AUTOLOAD> variable in the
d759 1
a759 1
should just call C<system()> with those arguments.  All you'd do is this:
d765 1
a765 1
    }
d767 1
a767 1
    who('am', 'i');
d770 1
a770 1
In fact, if you predeclare the functions you want to call that way, you don't
d782 3
a784 4
up into autoloadable files.  See the standard AutoLoader module
described in L<AutoLoader> and in L<AutoSplit>, the standard
SelfLoader modules in L<SelfLoader>, and the document on adding C
functions to perl code in L<perlxs>.
d788 4
a791 3
See L<perlref> for more about references and closures.  See L<perlxs> if
you'd like to learn about calling C subroutines from perl.  See L<perlmod>
to learn about bundling up your functions in separate files.
@


1.1.1.3
log
@virgin perl 5.6.0
@
text
@d9 5
a13 9
    sub NAME;			  # A "forward" declaration.
    sub NAME(PROTO);		  #  ditto, but with prototypes
    sub NAME : ATTRS;		  #  with attributes
    sub NAME(PROTO) : ATTRS;	  #  with attributes and prototypes

    sub NAME BLOCK		  # A declaration and a definition.
    sub NAME(PROTO) BLOCK	  #  ditto, but with prototypes
    sub NAME : ATTRS BLOCK	  #  with attributes
    sub NAME(PROTO) : ATTRS BLOCK #  with prototypes and attributes
d17 2
a18 4
    $subref = sub BLOCK;		 # no proto
    $subref = sub (PROTO) BLOCK;	 # with proto
    $subref = sub : ATTRS BLOCK;	 # with attributes
    $subref = sub (PROTO) : ATTRS BLOCK; # with proto and attributes
d22 1
a22 1
    use MODULE qw(NAME1 NAME2 NAME3);
a27 1
    &NAME(LIST);   # Circumvent prototypes.
d32 6
a37 6
Like many languages, Perl provides for user-defined subroutines.
These may be located anywhere in the main program, loaded in from
other files via the C<do>, C<require>, or C<use> keywords, or
generated on the fly using C<eval> or anonymous subroutines (closures).
You can even call a function indirectly using a variable containing
its name or a CODE reference.
d47 1
a47 1
there's really no difference from Perl's perspective.)
d49 11
a59 12
Any arguments passed in show up in the array C<@@_>.  Therefore, if
you called a function with two arguments, those would be stored in
C<$_[0]> and C<$_[1]>.  The array C<@@_> is a local array, but its
elements are aliases for the actual scalar parameters.  In particular,
if an element C<$_[0]> is updated, the corresponding argument is
updated (or an error occurs if it is not updatable).  If an argument
is an array or hash element which did not exist when the function
was called, that element is created only when (and if) it is modified
or a reference to it is taken.  (Some earlier versions of Perl
created the element whether or not the element was assigned to.)
Assigning to the whole array C<@@_> removes that aliasing, and does
not update any arguments.
d61 2
a62 2
The return value of a subroutine is the value of the last expression
evaluated.  More explicitly, a C<return> statement may be used to exit the
d66 12
a77 12
the subroutine returns an empty list in list context, the undefined
value in scalar context, or nothing in void context.  If you return
one or more aggregates (arrays and hashes), these will be flattened
together into one large indistinguishable list.

Perl does not have named formal parameters.  In practice all you
do is assign to a C<my()> list of these.  Variables that aren't
declared to be private are global variables.  For gory details
on creating private variables, see L<"Private Variables via my()">
and L<"Temporary Values via local()">.  To create protected
environments for a set of functions in a separate package (and
probably a separate file), see L<perlmod/"Packages">.
d96 1
a96 1
	$thisline = $lookahead;  # global variables!
d105 1
a105 1
	return $thisline;
d109 1
a109 1
    while (defined($line = get_line())) {
d113 1
a113 1
Assigning to a list of private variables to name your arguments:
d120 3
a122 4
Because the assignment copies the values, this also has the effect
of turning call-by-reference into call-by-value.  Otherwise a
function is free to do in-place modifications of C<@@_> and change
its caller's values.
d139 1
a139 1
    ($v3, $v4) = upcase($v1, $v2);  # this doesn't change $v1 and $v2
d147 6
a152 6
Notice how this (unprototyped) function doesn't care whether it was
passed real scalars or arrays.  Perl sees all arugments as one big,
long, flat parameter list in C<@@_>.  This is one area where
Perl's simple argument-passing style shines.  The C<upcase()>
function would work perfectly well without changing the C<upcase()>
definition even if we fed it things like this:
d161 18
a178 20
Like the flattened incoming parameter list, the return list is also
flattened on return.  So all you have managed to do here is stored
everything in C<@@a> and made C<@@b> an empty list.  See L<Pass by
Reference> for alternatives.

A subroutine may be called using an explicit C<&> prefix.  The
C<&> is optional in modern Perl, as are parentheses if the
subroutine has been predeclared.  The C<&> is I<not> optional
when just naming the subroutine, such as when it's used as
an argument to defined() or undef().  Nor is it optional when you
want to do an indirect subroutine call with a subroutine name or
reference using the C<&$subref()> or C<&{$subref}()> constructs,
although the C<< $subref->() >> notation solves that problem.
See L<perlref> for more about all that.

Subroutines may be called recursively.  If a subroutine is called
using the C<&> form, the argument list is optional, and if omitted,
no C<@@_> array is set up for the subroutine: the C<@@_> array at the
time of the call is visible to subroutine instead.  This is an
efficiency mechanism that new users may wish to avoid.
d189 2
a190 2
Not only does the C<&> form make the argument list optional, it also
disables any prototype checking on arguments you do provide.  This
d192 1
a192 1
to cheat if you know what you're doing.  See L<Prototypes> below.
d194 7
a200 7
Functions whose names are in all upper case are reserved to the Perl
core, as are modules whose names are in all lower case.  A
function in all capitals is a loosely-held convention meaning it
will be called indirectly by the run-time system itself, usually
due to a triggered event.  Functions that do special, pre-defined
things include C<BEGIN>, C<CHECK>, C<INIT>, C<END>, C<AUTOLOAD>, and
C<DESTROY>--plus all functions mentioned in L<perltie>.
a209 1
    my $x : Foo = $y;	# similar, with an attribute applied
d211 18
a228 24
B<WARNING>: The use of attribute lists on C<my> declarations is
experimental.  This feature should not be relied upon.  It may
change or disappear in future releases of Perl.  See L<attributes>.

The C<my> operator declares the listed variables to be lexically
confined to the enclosing block, conditional (C<if/unless/elsif/else>),
loop (C<for/foreach/while/until/continue>), subroutine, C<eval>,
or C<do/require/use>'d file.  If more than one value is listed, the
list must be placed in parentheses.  All listed elements must be
legal lvalues.  Only alphanumeric identifiers may be lexically
scoped--magical built-ins like C<$/> must currently be C<local>ize
with C<local> instead.

Unlike dynamic variables created by the C<local> operator, lexical
variables declared with C<my> are totally hidden from the outside
world, including any called subroutines.  This is true if it's the
same subroutine called from itself or elsewhere--every call gets
its own copy.

This doesn't mean that a C<my> variable declared in a statically
enclosing lexical scope would be invisible.  Only dynamic scopes
are cut off.   For example, the C<bumpx()> function below has access
to the lexical $x variable because both the C<my> and the C<sub>
occurred at the same scope, presumably file scope.
d233 3
a235 3
An C<eval()>, however, can see lexical variables of the scope it is
being evaluated in, so long as the names aren't hidden by declarations within
the C<eval()> itself.  See L<perlref>.
d237 1
a237 1
The parameter list to my() may be assigned to if desired, which allows you
d240 1
a240 1
this is used to name input parameters to a subroutine.  Examples:
d253 2
a254 2
The C<my> is simply a modifier on something you might assign to.  So when
you do assign to variables in its argument list, C<my> doesn't
d278 1
a278 1
can be used to initialize a new $x with the value of the old $x, and
d283 1
a283 1
is false unless the old $x happened to have the value C<123>.
d287 1
a287 1
part of that scope, too.  Thus in the loop
d289 1
a289 1
    while (my $line = <>) {
d295 1
a295 1
the scope of $line extends from its declaration throughout the rest of
d308 2
a309 2
the scope of $answer extends from its declaration through the rest
of that conditional, including any C<elsif> and C<else> clauses, 
d312 1
a312 1
None of the foregoing text applies to C<if/unless> or C<while/until>
d314 1
a314 1
control structures and have no effect on scoping.
d317 3
a319 4
in the manner of C<local>.  However, if the index variable is
prefixed with the keyword C<my>, or if there is already a lexical
by that name in scope, then a new lexical is created instead.  Thus
in the loop
d325 2
a326 2
the scope of $i extends to the end of the loop, but not beyond it,
rendering the value of $i inaccessible within C<some_function()>.
d329 2
a330 2
As an aid to catching implicit uses to package variables,
which are always global, if you say
d334 10
a343 13
then any variable mentioned from there to the end of the enclosing
block must either refer to a lexical variable, be predeclared via
C<our> or C<use vars>, or else must be fully qualified with the package name.
A compilation error results otherwise.  An inner block may countermand
this with C<no strict 'vars'>.

A C<my> has both a compile-time and a run-time effect.  At compile
time, the compiler takes notice of it.  The principle usefulness
of this is to quiet C<use strict 'vars'>, but it is also essential
for generation of closures as detailed in L<perlref>.  Actual
initialization is delayed until run time, though, so it gets executed
at the appropriate time, such as each time through a loop, for
example.
d345 1
a345 1
Variables declared with C<my> are not part of any package and are therefore
d363 7
a369 8
You may declare C<my> variables at the outermost scope of a file
to hide any such identifiers from the world outside that file.  This
is similar in spirit to C's static variables when they are used at
the file level.  To do this with a subroutine requires the use of
a closure (an anonymous function that accesses enclosing lexicals).
If you want to create a private subroutine that cannot be called
from outside that block, it can declare a lexical variable containing
an anonymous sub reference:
d378 1
a378 1
C<$some_pack::secret_version> or anything; it's just $secret_version,
d381 2
a382 4
This does not work with object methods, however; all object methods
have to be in the symbol table of some package to be found.  See
L<perlref/"Function Templates"> for something of a work-around to
this.
d418 1
a418 1
all in the main program, you'll need to arrange for the C<my>
d431 1
a431 2
See L<perlmod/"Package Constructors and Destructors"> about the
special triggered functions, C<BEGIN>, C<CHECK>, C<INIT> and C<END>.
d433 5
a437 5
If declared at the outermost scope (the file scope), then lexicals
work somewhat like C's file statics.  They are available to all
functions in that same file declared below them, but are inaccessible
from outside that file.  This strategy is sometimes used in modules
to create private variables that the whole module can see.
d441 1
a441 1
B<WARNING>: In general, you should be using C<my> instead of C<local>, because
d444 1
a444 1
symbol table itself.  Format variables often use C<local> though, as do
d461 6
a466 6
A C<local> modifies its listed variables to be "local" to the
enclosing block, C<eval>, or C<do FILE>--and to I<any subroutine
called from within that block>.  A C<local> just gives temporary
values to global (meaning package) variables.  It does I<not> create
a local variable.  This is known as dynamic scoping.  Lexical scoping
is done with C<my>, which works more like C's auto declarations.
d468 1
a468 1
If more than one variable is given to C<local>, they must be placed in
d493 1
a493 1
Because C<local> is a run-time operator, it gets executed each time
d584 5
a588 2
The behavior of local() on non-existent members of composite
types is subject to change in future.
d590 5
a594 14
=head2 Lvalue subroutines

B<WARNING>: Lvalue subroutines are still experimental and the implementation
may change in future versions of Perl.

It is possible to return a modifiable value from a subroutine.
To do this, you have to declare the subroutine to return an lvalue.

    my $val;
    sub canmod : lvalue {
	$val;
    }
    sub nomod {
	$val;
d596 2
d599 1
a599 2
    canmod() = 5;   # assigns to $val
    nomod()  = 5;   # ERROR
d601 1
a601 3
The scalar/list context for the subroutine and for the right-hand
side of assignment is determined as if the subroutine call is replaced
by a scalar. For example, consider:
d603 2
a604 15
    data(2,3) = get_data(3,4);

Both subroutines here are called in a scalar context, while in:

    (data(2,3)) = get_data(3,4);

and in:

    (data(2),data(3)) = get_data(3,4);

all the subroutines are called in a list context.

The current implementation does not allow arrays and hashes to be
returned from lvalue subroutines directly.  You may return a
reference instead.  This restriction may be lifted in future.
d608 4
a611 4
B<WARNING>: The mechanism described in this section was originally
the only way to simulate pass-by-reference in older versions of
Perl.  While it still works fine in modern versions, the new reference
mechanism is generally easier to work with.  See below.
d624 1
a624 1
whatever C<*> value was assigned to it.  Example:
d635 1
a635 1
Scalars are already passed by reference, so you can modify
d650 2
a651 2
Despite the existence of C<my>, there are still three places where the
C<local> operator still shines.  In fact, in these three places, you
d656 1
a656 1
=item 1. You need to give a global variable a temporary value, especially $_.
d670 1
a670 1
It particular, it's important to C<local>ize $_ in any routine that assigns
d675 2
a676 2
A function that needs a filehandle of its own must use
C<local()> on a complete typeglob.   This can be used to create new symbol
d727 3
a729 3
Here are a few simple examples.  First, let's pass in several arrays
to a function and have it C<pop> all of then, returning a new list
of all their former last elements:
d768 3
a770 4
That syntax simply won't work.  It sets just C<@@a> or C<%a> and
clears the C<@@b> or C<%b>.  Plus the function didn't get passed
into two separate arrays or hashes: it got one long list in C<@@_>,
as always.
d802 2
a803 3
a tad subtle, though, and also won't work if you're using C<my>
variables, because only globals (even in disguise as C<local>s)
are in the symbol table.
d806 2
a807 2
typeglob, like C<*STDOUT>, but typeglobs references work, too.
For example:
d821 4
a824 2
If you're planning on generating new filehandles, you could do this.
Notice to pass back just the bare *FH, not its reference.
d827 1
a827 1
	my $path = shift;
d832 4
d838 1
a838 2
Perl supports a very limited kind of compile-time argument checking
using function prototyping.  If you declare
d842 10
a851 10
then C<mypush()> takes arguments exactly like C<push()> does.  The
function declaration must be visible at compile time.  The prototype
affects only interpretation of new-style calls to the function,
where new-style is defined as not using the C<&> character.  In
other words, if you call it like a built-in function, then it behaves
like a built-in function.  If you call it like an old-fashioned
subroutine, then it behaves like an old-fashioned subroutine.  It
naturally falls out from this rule that prototypes have no influence
on subroutine references like C<\&foo> or on indirect subroutine
calls like C<&{$subref}> or C<< $subref->() >>.
d854 2
a855 2
function to be called is indeterminate at compile time, since
the exact code called depends on inheritance.
d857 3
a859 4
Because the intent of this feature is primarily to let you define
subroutines that work like built-in functions, here are prototypes
for some other functions that parse almost exactly like the
corresponding built-in.
d880 3
a882 2
as part of C<@@_> will be a reference to the actual argument given
in the subroutine call, obtained by applying C<\> to that argument.
d885 1
a885 1
unbackslashed C<@@> or C<%> eats all remaining arguments, and forces
d888 2
a889 3
argument, does not require the C<sub> keyword or a subsequent comma.

A C<*> allows the subroutine to accept a bareword, constant, scalar expression,
d892 1
a892 10
two cases) as a reference to the typeglob.  If you wish to always convert
such arguments to a typeglob reference, use Symbol::qualify_to_ref() as
follows:

    use Symbol 'qualify_to_ref';

    sub foo (*) {
	my $fh = qualify_to_ref(shift, caller);
	...
    }
d895 1
a895 1
It is redundant before C<@@> or C<%>, which gobble up everything else.
d897 5
a901 5
Note how the last three examples in the table above are treated
specially by the parser.  C<mygrep()> is parsed as a true list
operator, C<myrand()> is parsed as a true unary operator with unary
precedence the same as C<rand()>, and C<mytime()> is truly without
arguments, just like C<time()>.  That is, if you say
d906 1
a906 1
without a prototype.
d908 1
a908 2
The interesting thing about C<&> is that you can generate new syntax with it,
provided it's in the initial position:
d927 1
a927 1
issues having to do with visibility of C<@@_>.  I'm ignoring that
d932 1
a932 1
And here's a reimplementation of the Perl C<grep> operator:
d968 1
a968 1
Then you've just supplied an automatic C<scalar> in front of their
d971 3
a973 3
C<func()> now gets passed in a C<1>; that is, the number of elements
in C<@@foo>.  And the C<split> gets called in scalar context so it
starts scribbling on your C<@@_> parameter list.  Ouch!
d981 2
a982 2
inlining.  If the result after optimization and constant folding
is either a constant or a lexically-scoped scalar which has no other
d984 3
a986 2
without C<&>.  Calls made using C<&> are never inlined.  (See
F<constant.pm> for an easy way to declare most constants.)
d1022 1
a1022 1
function.  If you need to be able to redefine the subroutine, you need to
d1024 1
a1024 1
(which changes calling semantics, so beware) or by thwarting the
d1031 1
a1031 1
=head2 Overriding Built-in Functions
d1033 1
a1033 1
Many built-in functions may be overridden, though this should be tried
d1035 1
a1035 1
done by a package attempting to emulate missing built-in functionality
d1040 2
a1041 2
C<use subs> pragma lets you, in effect, predeclare subs
via the import syntax, and these names may then override built-in ones:
d1047 3
a1049 3
To unambiguously refer to the built-in form, precede the
built-in name with the special package qualifier C<CORE::>.  For example,
saying C<CORE::open()> always refers to the built-in C<open()>, even
d1051 1
a1051 3
C<&open()> from elsewhere.  Even though it looks like a regular
function call, it isn't: you can't take a reference to it, such as
the incorrect C<\&CORE::open> might appear to produce.
d1053 2
a1054 2
Library modules should not in general export built-in names like C<open>
or C<chdir> as part of their default C<@@EXPORT> list, because these may
d1056 1
a1056 1
Instead, if the module adds that name to C<@@EXPORT_OK>, then it's
d1062 1
a1062 1
and it would import the C<open> override.  But if they said
d1066 1
a1066 1
they would get the default imports without overrides.
d1068 1
a1068 1
The foregoing mechanism for overriding built-in is restricted, quite
d1070 1
a1070 1
method that is sometimes applicable when you wish to override a built-in
d1092 3
a1094 6
	local *D;
	if (opendir D, '.') { 
	    @@got = grep /$pat/, readdir D; 
	    closedir D;   
	}
	return @@got;
d1105 1
a1105 1
The initial comment shows a contrived, even dangerous example.
d1107 1
a1107 1
subversive) behavior for the C<glob> operator for I<every> namespace,
d1113 1
a1113 1
cleanly override perl's C<glob> operator.  The built-in C<glob> has
d1115 1
a1115 1
context, but our C<REGlob> doesn't.  Indeed, many perl built-in have such
d1121 1
d1124 19
a1142 21
If you call a subroutine that is undefined, you would ordinarily
get an immediate, fatal error complaining that the subroutine doesn't
exist.  (Likewise for subroutines being used as methods, when the
method doesn't exist in any base class of the class's package.)
However, if an C<AUTOLOAD> subroutine is defined in the package or
packages used to locate the original subroutine, then that
C<AUTOLOAD> subroutine is called with the arguments that would have
been passed to the original subroutine.  The fully qualified name
of the original subroutine magically appears in the global $AUTOLOAD
variable of the same package as the C<AUTOLOAD> routine.  The name
is not passed as an ordinary argument because, er, well, just
because, that's why...

Many C<AUTOLOAD> routines load in a definition for the requested
subroutine using eval(), then execute that subroutine using a special
form of goto() that erases the stack frame of the C<AUTOLOAD> routine
without a trace.  (See the source to the standard module documented
in L<AutoLoader>, for example.)  But an C<AUTOLOAD> routine can
also just emulate the routine and never define it.   For example,
let's pretend that a function that wasn't defined should just invoke
C<system> with those arguments.  All you'd do is:
d1153 2
a1154 2
In fact, if you predeclare functions you want to call that way, you don't
even need parentheses:
d1162 1
a1162 1
can treat undefined subroutine calls as calls to external programs.
d1164 2
a1165 2
Mechanisms are available to help modules writers split their modules
into autoloadable files.  See the standard AutoLoader module
d1168 1
a1168 41
functions to Perl code in L<perlxs>.

=head2 Subroutine Attributes

A subroutine declaration or definition may have a list of attributes
associated with it.  If such an attribute list is present, it is
broken up at space or colon boundaries and treated as though a
C<use attributes> had been seen.  See L<attributes> for details
about what attributes are currently supported.
Unlike the limitation with the obsolescent C<use attrs>, the
C<sub : ATTRLIST> syntax works to associate the attributes with
a pre-declaration, and not just with a subroutine definition.

The attributes must be valid as simple identifier names (without any
punctuation other than the '_' character).  They may have a parameter
list appended, which is only checked for whether its parentheses ('(',')')
nest properly.

Examples of valid syntax (even though the attributes are unknown):

    sub fnord (&\%) : switch(10,foo(7,3))  :  expensive ;
    sub plugh () : Ugly('\(") :Bad ;
    sub xyzzy : _5x5 { ... }

Examples of invalid syntax:

    sub fnord : switch(10,foo() ; # ()-string not balanced
    sub snoid : Ugly('(') ;	  # ()-string not balanced
    sub xyzzy : 5x5 ;		  # "5x5" not a valid identifier
    sub plugh : Y2::north ;	  # "Y2::north" not a simple identifier
    sub snurt : foo + bar ;	  # "+" not a colon or space

The attribute list is passed as a list of constant strings to the code
which associates them with the subroutine.  In particular, the second example
of valid syntax above currently looks like this in terms of how it's
parsed and invoked:

    use attributes __PACKAGE__, \&plugh, q[Ugly('\(")], 'Bad';

For further details on attribute lists and their manipulation,
see L<attributes>.
d1172 3
a1174 6
See L<perlref/"Function Templates"> for more about references and closures.
See L<perlxs> if you'd like to learn about calling C subroutines from Perl.  
See L<perlembed> if you'd like to learn about calling PErl subroutines from C.  
See L<perlmod> to learn about bundling up your functions in separate files.
See L<perlmodlib> to learn what library modules come standard on your system.
See L<perltoot> to learn how to make object method calls.
@


1.1.1.4
log
@stock perl 5.6.1
@
text
@d42 1
a42 1
generated on the fly using C<eval> or anonymous subroutines.
d157 1
a157 1
passed real scalars or arrays.  Perl sees all arguments as one big,
d172 2
a173 2
everything in C<@@a> and made C<@@b> an empty list.  See 
L<Pass by Reference> for alternatives.
d360 1
a360 1
time, the compiler takes notice of it.  The principal usefulness
d648 4
d700 1
a700 3
=over 4

=item 1.
d702 1
a702 1
You need to give a global variable a temporary value, especially $_.
d719 1
a719 3
=item 2.

You need to create a local file or directory handle or a local function.
d749 1
a749 3
=item 3.

You want to temporarily change just one element of an array or hash.
d1273 1
a1273 1
See L<perlembed> if you'd like to learn about calling Perl subroutines from C.  
@


1.1.1.5
log
@stock perl 5.8.0 from CPAN
@
text
@d172 1
a172 1
everything in C<@@a> and made C<@@b> empty.  See 
d210 2
a211 2
things include C<BEGIN>, C<CHECK>, C<INIT>, C<END>, C<AUTOLOAD>,
C<CLONE> and C<DESTROY>--plus all functions mentioned in L<perltie>.
d223 3
a225 3
B<WARNING>: The use of attribute lists on C<my> declarations is still
evolving.  The current semantics and interface are subject to change.
See L<attributes> and L<Attribute::Handlers>.
d330 3
a332 6
B<NOTE:> The behaviour of a C<my> statement modified with a statement
modifier conditional or loop construct (e.g. C<my $x if ...>) is
B<undefined>.  The value of the C<my> variable may be C<undef>, any
previously assigned value, or possibly anything else.  Don't rely on
it.  Future versions of perl might do something different from the
version of perl you try it out on.  Here be dragons.
a562 7
B<WARNING> The code example above does not currently work as described.
This will be fixed in a future release of Perl; in the meantime, avoid
code that relies on any particular behaviour of localising tied arrays
or hashes (localising individual elements is still okay).
See L<perldelta/"Localising Tied Arrays and Hashes Is Broken"> for more
details.

d615 2
a616 2
B<WARNING>: Lvalue subroutines are still experimental and the
implementation may change in future versions of Perl.
a622 1
	# return $val; this doesn't work, don't say "return"
a647 33
=over 4

=item Lvalue subroutines are EXPERIMENTAL

They appear to be convenient, but there are several reasons to be
circumspect.

You can't use the return keyword, you must pass out the value before
falling out of subroutine scope. (see comment in example above).  This
is usually not a problem, but it disallows an explicit return out of a
deeply nested loop, which is sometimes a nice way out.

They violate encapsulation.  A normal mutator can check the supplied
argument before setting the attribute it is protecting, an lvalue
subroutine never gets that chance.  Consider;

    my $some_array_ref = [];	# protected by mutators ??

    sub set_arr { 		# normal mutator
	my $val = shift;
	die("expected array, you supplied ", ref $val)
	   unless ref $val eq 'ARRAY';
	$some_array_ref = $val;
    }
    sub set_arr_lv : lvalue {	# lvalue mutator
	$some_array_ref;
    }

    # set_arr_lv cannot stop this !
    set_arr_lv() = { a => 1 };

=back

d727 1
a727 1
        pipe    (READER,  WRITER)     or die "pipe: $!";
a928 16
You can also backslash several argument types simultaneously by using
the C<\[]> notation:

    sub myref (\[$@@%&*])

will allow calling myref() as

    myref $var
    myref @@array
    myref %hash
    myref &sub
    myref *glob

and the first argument of myref() will be a reference to
a scalar, an array, a hash, a code, or a glob.

a1007 7
If you try to use an alphanumeric sequence in a prototype you will
generate an optional warning - "Illegal character in prototype...".
Unfortunately earlier versions of Perl allowed the prototype to be
used as long as its prefix was a valid prototype.  The warning may be
upgraded to a fatal error in a future version of Perl once the
majority of offending code is fixed.

a1180 27
When you override a built-in, your replacement should be consistent (if
possible) with the built-in native syntax.  You can achieve this by using
a suitable prototype.  To get the prototype of an overridable built-in,
use the C<prototype> function with an argument of C<"CORE::builtin_name">
(see L<perlfunc/prototype>).

Note however that some built-ins can't have their syntax expressed by a
prototype (such as C<system> or C<chomp>).  If you override them you won't
be able to fully mimic their original syntax.

The built-ins C<do>, C<require> and C<glob> can also be overridden, but due
to special magic, their original syntax is preserved, and you don't have
to define a prototype for their replacements.  (You can't override the
C<do BLOCK> syntax, though).

C<require> has special additional dark magic: if you invoke your
C<require> replacement as C<require Foo::Bar>, it will actually receive
the argument C<"Foo/Bar.pm"> in @@_.  See L<perlfunc/require>.

And, as you'll have noticed from the previous example, if you override
C<glob>, the C<E<lt>*E<gt>> glob operator is overridden as well.

In a similar fashion, overriding the C<readline> function also overrides
the equivalent I/O operator C<< <FILEHANDLE> >>.

Finally, some built-ins (e.g. C<exists> or C<grep>) can't be overridden.

d1269 1
a1269 1
see L<attributes> and L<Attribute::Handlers>.
@


1.1.1.6
log
@perl 5.8.2 from CPAN
@
text
@d233 1
a233 1
scoped--magical built-ins like C<$/> must currently be C<local>ized
d328 8
a335 2
but not beyond it.  See L<perlsyn/"Simple statements"> for information
on the scope of variables in statements with modifiers.
d472 4
a475 3
variables, global filehandles and formats, and direct manipulation of the
Perl symbol table itself.  C<local> is mostly used when the current value
of a variable must be visible to called subroutines.
d479 4
a482 12
    # localization of values

    local $foo;			# make $foo dynamically local
    local (@@wid, %get);		# make list of variables local
    local $foo = "flurp";	# make $foo dynamic, and init it
    local @@oof = @@bar;		# make @@oof dynamic, and init it

    local $hash{key} = "val";	# sets a local value for this hash entry
    local ($cond ? $v1 : $v2);	# several types of lvalues support
				# localization

    # localization of symbols
d497 2
a498 7
Some types of lvalues can be localized as well : hash and array elements
and slices, conditionals (provided that their result is always
localizable), and symbolic references.  As for simple variables, this
creates new, dynamically scoped values.

If more than one variable or expression is given to C<local>, they must be
placed in parentheses.  This operator works
d505 16
a520 1
undefined value.)
d523 4
a526 4
through a loop.  Consequently, it's more efficient to localize your
variables outside the loop.

=head3 Grammatical note on local()
d541 11
a551 1
=head3 Localization of special variables
d553 10
a562 23
If you localize a special variable, you'll be giving a new value to it,
but its magic won't go away.  That means that all side-effects related
to this magic still work with the localized value.

This feature allows code like this to work :

    # Read the whole contents of FILE in $slurp
    { local $/ = undef; $slurp = <FILE>; }

Note, however, that this restricts localization of some values ; for
example, the following statement dies, as of perl 5.9.0, with an error
I<Modification of a read-only value attempted>, because the $1 variable is
magical and read-only :

    local $1 = 2;

Similarly, but in a way more difficult to spot, the following snippet will
die in perl 5.9.0 :

    sub f { local $_ = "foo"; print }
    for ($1) {
	# now $_ is aliased to $1, thus is magic and readonly
	f();
d564 1
d566 1
a566 4
See next section for an alternative to this situation.

B<WARNING>: Localization of tied arrays and hashes does not currently
work as described.
d570 1
a570 1
See L<perl58delta/"Localising Tied Arrays and Hashes Is Broken"> for more
d573 2
a574 1
=head3 Localization of globs
d576 6
a581 18
The construct

    local *name;

creates a whole new symbol table entry for the glob C<name> in the
current package.  That means that all variables in its glob slot ($name,
@@name, %name, &name, and the C<name> filehandle) are dynamically reset.

This implies, among other things, that any magic eventually carried by
those variables is locally lost.  In other words, saying C<local */>
will not have any effect on the internal value of the input record
separator.

Notably, if you want to work with a brand new value of the default scalar
$_, and avoid the potential problem listed above about $_ previously
carrying a magic value, you should use C<local *_> instead of C<local $_>.

=head3 Localization of elements of composite types
d1160 2
a1161 2
Overriding may be done only by importing the name from a module at
compile time--ordinary predeclaration isn't good enough.  However, the
@


1.1.1.7
log
@perl 5.8.3 from CPAN
@
text
@d205 7
a211 11
Subroutines whose names are in all upper case are reserved to the Perl
core, as are modules whose names are in all lower case.  A subroutine in
all capitals is a loosely-held convention meaning it will be called
indirectly by the run-time system itself, usually due to a triggered event.
Subroutines that do special, pre-defined things include C<AUTOLOAD>, C<CLONE>,
C<DESTROY> plus all functions mentioned in L<perltie> and L<PerlIO::via>.

The C<BEGIN>, C<CHECK>, C<INIT> and C<END> subroutines are not so much
subroutines as named special code blocks, of which you can have more
than one in a package, and which you can B<not> call explicitely.  See
L<perlmod/"BEGIN, CHECK, INIT and END">
d443 1
a443 1
code block around it to make sure it gets executed before your program
d446 1
a446 1
    BEGIN {
d453 2
a454 2
See L<perlmod/"BEGIN, CHECK, INIT and END"> about the
special triggered code blocks, C<BEGIN>, C<CHECK>, C<INIT> and C<END>.
@


1.1.1.8
log
@Import of stock perl 5.8.5
@
text
@d70 1
a70 2
evaluated by that sub, or the empty list in the case of an empty sub.
More explicitly, a C<return> statement may be used to exit the
d1134 1
a1134 11

    sub N () { int(OPT_BAZ) / 3 }

    sub FOO_SET () { 1 if FLAG_MASK & FLAG_FOO }

Be aware that these will not be inlined; as they contain inner scopes,
the constant folding doesn't reduce them to a single constant:

    sub foo_set () { if (FLAG_MASK & FLAG_FOO) { 1 } }

    sub baz_val () {
d1141 7
@


1.1.1.9
log
@perl 5.8.6 from CPAN
@
text
@d215 1
a215 1
than one in a package, and which you can B<not> call explicitly.  See
@


1.1.1.10
log
@perl 5.8.8 import
@
text
@a1 1
X<subroutine> X<function>
a7 1
X<subroutine, declaration> X<sub>
a19 1
X<subroutine, anonymous>
a26 1
X<import>
a30 1
X<subroutine, call> X<call>
a54 1
X<subroutine, parameter> X<parameter>
a67 1
X<subroutine, argument> X<argument> X<@@_>
d69 10
a78 14
A C<return> statement may be used to exit a subroutine, optionally
specifying the returned value, which will be evaluated in the
appropriate context (list, scalar, or void) depending on the context of
the subroutine call.  If you specify no return value, the subroutine
returns an empty list in list context, the undefined value in scalar
context, or nothing in void context.  If you return one or more
aggregates (arrays and hashes), these will be flattened together into
one large indistinguishable list.

If no C<return> is found and if the last statement is an expression, its
value is returned. If the last statement is a loop control structure
like a C<foreach> or a C<while>, the returned value is unspecified. The
empty sub returns the empty list.
X<subroutine, return value> X<return value> X<return>
a86 1
X<formal parameter> X<parameter, formal>
a132 1
X<call-by-reference> X<call-by-value>
a141 1
X<call-by-reference> X<call-by-value>
a184 1
X<&>
a190 1
X<recursion>
a204 1
X<&>
a218 2
X<my> X<variable, lexical> X<lexical> X<lexical variable> X<scope, lexical>
X<lexical scope> X<attributes, my>
a245 1
X<local>
a258 1
X<eval, scope of>
a340 1
X<foreach> X<for>
a347 1
X<foreach> X<for>
a411 1
X<static> X<variable, persistent> X<variable, static> X<closure>
a467 2
X<local> X<scope, dynamic> X<dynamic scope> X<variable, local>
X<variable, temporary>
a522 1
X<local, context>
a537 1
X<local, special variable>
a572 1
X<local, tie>
a574 1
X<local, glob> X<glob>
a593 1
X<local, composite type element> X<local, array element> X<local, hash element>
a635 1
X<lvalue> X<subroutine, lvalue>
a704 1
X<typeglob> X<*>
a746 1
X<local> X<variable, local>
a823 1
X<pass by reference> X<pass-by-reference> X<reference>
a936 1
X<prototype> X<subroutine, prototype>
a1036 1
X<&>
a1060 1
X<grep>
a1113 1
X<constant>
a1168 1
X<built-in> X<override> X<CORE> X<CORE::GLOBAL>
a1290 1
X<autoloading> X<AUTOLOAD>
a1340 1
X<attribute> X<subroutine, attribute> X<attrs>
d1358 2
a1359 2
    sub fnord (&\%) : switch(10,foo(7,3))  :  expensive;
    sub plugh () : Ugly('\(") :Bad;
d1364 5
a1368 5
    sub fnord : switch(10,foo(); # ()-string not balanced
    sub snoid : Ugly('(');	  # ()-string not balanced
    sub xyzzy : 5x5;		  # "5x5" not a valid identifier
    sub plugh : Y2::north;	  # "Y2::north" not a simple identifier
    sub snurt : foo + bar;	  # "+" not a colon or space
@


1.1.1.11
log
@import perl 5.10.0 from CPAN
@
text
@d230 4
a233 4
The C<BEGIN>, C<UNITCHECK>, C<CHECK>, C<INIT> and C<END> subroutines
are not so much subroutines as named special code blocks, of which you
can have more than one in a package, and which you can B<not> call
explicitly.  See L<perlmod/"BEGIN, UNITCHECK, CHECK, INIT and END">
d397 1
d435 1
a435 28
X<state> X<state variable> X<static> X<variable, persistent> X<variable, static> X<closure>

There are two ways to build persistent private variables in Perl 5.10.
First, you can simply use the C<state> feature. Or, you can use closures,
if you want to stay compatible with releases older than 5.10.

=head3 Persistent variables via state()

Beginning with perl 5.9.4, you can declare variables with the C<state>
keyword in place of C<my>. For that to work, though, you must have
enabled that feature beforehand, either by using the C<feature> pragma, or
by using C<-E> on one-liners. (see L<feature>)

For example, the following code maintains a private counter, incremented
each time the gimme_another() function is called:

    use feature 'state';
    sub gimme_another { state $x; return ++$x }

Also, since C<$x> is lexical, it can't be reached or modified by any Perl
code outside.

When combined with variable declaration, simple scalar assignment to C<state>
variables (as in C<state $x = 42>) is executed only the first time.  When such
statements are evaluated subsequent times, the assignment is ignored.  The
behavior of this sort of assignment to non-scalar variables is undefined.

=head3 Persistent variables with closures
d482 2
a483 3
See L<perlmod/"BEGIN, UNITCHECK, CHECK, INIT and END"> about the
special triggered code blocks, C<BEGIN>, C<UNITCHECK>, C<CHECK>,
C<INIT> and C<END>.
a621 2
As of perl 5.9.1, you can also use the lexical form of C<$_> (declaring it
with C<my $_>), which avoids completely this problem.
d1013 1
a1013 1
    sub myrand (;$)	     myrand 42
d1057 1
a1057 1
A semicolon (C<;>) separates mandatory arguments from optional arguments.
a1059 4
As the last character of a prototype, or just before a semicolon, you can
use C<_> in place of C<$>: if this argument is not provided, C<$_> will be
used instead.

d1271 4
a1274 3
	if (opendir my $d, '.') { 
	    @@got = grep /$pat/, readdir $d; 
	    closedir $d;   
d1323 1
a1323 1
C<glob>, the C<< <*> >> glob operator is overridden as well.
d1326 1
a1326 2
the equivalent I/O operator C<< <FILEHANDLE> >>. Also, overriding
C<readpipe> also overrides the operators C<``> and C<qx//>.
d1344 1
a1344 2
because, that's why.  (As an exception, a method call to a nonexistent
C<import> or C<unimport> method is just skipped instead.)
d1370 1
a1370 1
    ls '-l';
@


1.1.1.12
log
@import perl 5.10.1
@
text
@d1037 1
a1037 1
    sub mysplice (\@@$$@@)     mysplice @@array, 0, 2, @@pushme
@


1.1.1.13
log
@Perl 5.12.2 from CPAN
@
text
@a537 1
    delete local $hash{key};    # delete this entry for the current block
a693 49

=head3 Localized deletion of elements of composite types
X<delete> X<local, composite type element> X<local, array element> X<local, hash element>

You can use the C<delete local $array[$idx]> and C<delete local $hash{key}>
constructs to delete a composite type entry for the current block and restore
it when it ends. They return the array/hash value before the localization,
which means that they are respectively equivalent to

    do {
        my $val = $array[$idx];
        local  $array[$idx];
        delete $array[$idx];
        $val
    }

and

    do {
        my $val = $hash{key};
        local  $hash{key};
        delete $hash{key};
        $val
    }

except that for those the C<local> is scoped to the C<do> block. Slices are
also accepted.

    my %hash = (
     a => [ 7, 8, 9 ],
     b => 1,
    )

    {
     my $a = delete local $hash{a};
     # $a is [ 7, 8, 9 ]
     # %hash is (b => 1)

     {
      my @@nums = delete local @@$a[0, 2]
      # @@nums is (7, 9)
      # $a is [ undef, 8 ]

      $a[0] = 999; # will be erased when the scope ends
     }
     # $a is back to [ 7, 8, 9 ]

    }
    # %hash is back to its original state
@


1.1.1.14
log
@import perl 5.16.3 from CPAN - worked on by Andrew Fresh and myself
@
text
@d220 1
a220 1
to cheat if you know what you're doing.  See L</Prototypes> below.
a222 12
Since Perl 5.16.0, the C<__SUB__> token is available under C<use feature
'current_sub'> and C<use 5.16.0>.  It will evaluate to a reference to the
currently-running sub, which allows for recursive calls without knowing
your subroutine's name.

    use 5.16.0;
    my $factorial = sub {
      my ($x) = @@_;
      return 1 if $x == 1;
      return($x * __SUB__->( $x - 1 ) );
    };

d354 1
a354 1
but not beyond it.  See L<perlsyn/"Simple Statements"> for information
d442 2
a443 2
Beginning with Perl 5.9.4, you can declare variables with the C<state>
keyword in place of C<my>.  For that to work, though, you must have
d445 1
a445 3
by using C<-E> on one-liners (see L<feature>).  Beginning with Perl 5.16,
the C<CORE::state> form does not require the
C<feature> pragma.
d557 1
a557 1
Some types of lvalues can be localized as well: hash and array elements
d611 10
a620 3
One exception is the default scalar variable: starting with perl 5.14
C<local($_)> will always strip all magic from $_, to make it possible
to safely reuse $_ in a subroutine.
d647 6
d756 2
a757 1
	$val;  # or:  return $val;
d786 1
a786 1
They appear to be convenient, but there is at least one reason to be
d789 5
d909 1
a909 1
        local *grow = \&shrink; # only until this block exits
d1056 1
a1056 1
    sub mypush (+@@)
d1086 3
a1088 3
    sub mypop (+)	     mypop @@array
    sub mysplice (+$$@@)	     mysplice @@array, 0, 2, @@pushme
    sub mykeys (+)	     mykeys %{$hashref}
d1096 3
a1098 6
that must start with that character (optionally preceded by C<my>,
C<our> or C<local>), with the exception of C<$>, which will
accept any scalar lvalue expression, such as C<$foo = 7> or
C<< my_function()->[0] >>. The value passed as part of C<@@_> will be a
reference to the actual argument given in the subroutine call,
obtained by applying C<\> to that argument.
d1100 2
a1101 2
You can use the C<\[]> backslash group notation to specify more than one
allowed argument type. For example:
a1135 14
The C<+> prototype is a special alternative to C<$> that will act like
C<\[@@%]> when given a literal array or hash variable, but will otherwise
force scalar context on the argument.  This is useful for functions which
should accept either a literal array or an array reference as the argument:

    sub mypush (+@@) {
        my $aref = shift;
        die "Not an array or arrayref" unless ref $aref eq 'ARRAY';
        push @@$aref, @@_;
    }

When using the C<+> prototype, your function must check that the argument
is of an acceptable type.

d1139 3
a1141 3
As the last character of a prototype, or just before a semicolon, a C<@@>
or a C<%>, you can use C<_> in place of C<$>: if this argument is not
provided, C<$_> will be used instead.
d1152 1
a1152 5
without a prototype.  If you want to force a unary function to have the
same precedence as a list operator, add C<;> to the end of the prototype:

    sub mygetprotobynumber($;);
    mygetprotobynumber $a > $b; # parsed as mygetprotobynumber($a > $b)
d1277 1
a1277 1
a warning by default.  (You can use this warning to tell whether or not a
d1279 1
a1279 2
considered severe enough not to be affected by the B<-w>
switch (or its absence) because previously compiled
d1312 2
a1313 4
function call, it isn't: the CORE:: prefix in that case is part of Perl's
syntax, and works for any keyword, regardless of what is in the CORE
package.  Taking a reference to it, that is, C<\&CORE::open>, only works
for some keywords.  See L<CORE>.
d1428 1
a1428 4
C<import> or C<unimport> method is just skipped instead.  Also, if
the AUTOLOAD subroutine is an XSUB, there are other ways to retrieve the
subroutine name.  See L<perlguts/Autoloading with XSUBs> for details.)

d1456 1
a1456 1
A more complete example of this is the Shell module on CPAN, which
d1513 1
a1513 1
See L<perlootut> to learn how to make object method calls.
@


1.1.1.15
log
@Import perl-5.18.2

OK espie@@ sthen@@ deraadt@@
@
text
@a234 3
The behaviour of C<__SUB__> within a regex code block (such as C</(?{...})/>)
is subject to change.

d454 1
a454 1
Beginning with Perl 5.10.0, you can declare variables with the C<state>
a460 8
The C<state> keyword creates a lexical variable (following the same scoping
rules as C<my>) that persists from one subroutine call to the next.  If a
state variable resides inside an anonymous subroutine, then each copy of
the subroutine has its own copy of the state variable.  However, the value
of the state variable will still persist between calls to the same copy of
the anonymous subroutine.  (Don't forget that C<sub { ... }> creates a new
subroutine each time it is executed.)

a466 7
And this example uses anonymous subroutines to create separate counters:

    use feature 'state';
    sub create_counter {
	return sub { state $x; return ++$x }
    }

d619 1
a619 1
example, the following statement dies, as of perl 5.10.0, with an error
a809 101
=head2 Lexical Subroutines
X<my sub> X<state sub> X<our sub> X<subroutine, lexical>

B<WARNING>: Lexical subroutines are still experimental.  The feature may be
modified or removed in future versions of Perl.

Lexical subroutines are only available under the C<use feature
'lexical_subs'> pragma, which produces a warning unless the
"experimental::lexical_subs" warnings category is disabled.

Beginning with Perl 5.18, you can declare a private subroutine with C<my>
or C<state>.  As with state variables, the C<state> keyword is only
available under C<use feature 'state'> or C<use 5.010> or higher.

These subroutines are only visible within the block in which they are
declared, and only after that declaration:

    no warnings "experimental::lexical_subs";
    use feature 'lexical_subs';

    foo();		# calls the package/global subroutine
    state sub foo {
	foo();		# also calls the package subroutine
    }
    foo();		# calls "state" sub
    my $ref = \&foo;	# take a reference to "state" sub

    my sub bar { ... }
    bar();		# calls "my" sub

To use a lexical subroutine from inside the subroutine itself, you must
predeclare it.  The C<sub foo {...}> subroutine definition syntax respects
any previous C<my sub;> or C<state sub;> declaration.

    my sub baz;		# predeclaration
    sub baz {		# define the "my" sub
	baz();		# recursive call
    }

=head3 C<state sub> vs C<my sub>

What is the difference between "state" subs and "my" subs?  Each time that
execution enters a block when "my" subs are declared, a new copy of each
sub is created.  "State" subroutines persist from one execution of the
containing block to the next.

So, in general, "state" subroutines are faster.  But "my" subs are
necessary if you want to create closures:

    no warnings "experimental::lexical_subs";
    use feature 'lexical_subs';

    sub whatever {
	my $x = shift;
	my sub inner {
	    ... do something with $x ...
	}
	inner();
    }

In this example, a new C<$x> is created when C<whatever> is called, and
also a new C<inner>, which can see the new C<$x>.  A "state" sub will only
see the C<$x> from the first call to C<whatever>.

=head3 C<our> subroutines

Like C<our $variable>, C<our sub> creates a lexical alias to the package
subroutine of the same name.

The two main uses for this are to switch back to using the package sub
inside an inner scope:

    no warnings "experimental::lexical_subs";
    use feature 'lexical_subs';

    sub foo { ... }

    sub bar {
	my sub foo { ... }
	{
	    # need to use the outer foo here
	    our sub foo;
	    foo();
	}
    }

and to make a subroutine visible to other packages in the same scope:

    package MySneakyModule;

    no warnings "experimental::lexical_subs";
    use feature 'lexical_subs';

    our sub do_something { ... }

    sub do_something_with_caller {
	package DB;
	() = caller 1;		# sets @@DB::args
	do_something(@@args);	# uses MySneakyModule::do_something
    }

d926 2
a927 1
But it also works on lexically declared aggregates.
@


1.1.1.16
log
@Import perl-5.20.1
@
text
@a17 1
    sub NAME SIG BLOCK            #  with signature
a19 1
    sub NAME : ATTRS SIG BLOCK    #  with attributes and signature
a25 1
    $subref = sub SIG BLOCK;             # with signature
a27 1
    $subref = sub : ATTRS SIG BLOCK;     # with attribs and signature
d62 1
a62 3
Any arguments passed in show up in the array C<@@_>.
(They may also show up in lexical variables introduced by a signature;
see L</Signatures> below.)  Therefore, if
a90 1
Aside from an experimental facility (see L</Signatures> below),
d242 2
a243 51
Subroutines whose name start with a left parenthesis are also reserved the 
same way. The following is a list of some subroutines that currently do 
special, pre-defined things.

=over

=item documented later in this document

C<AUTOLOAD>

=item documented in L<perlmod>

C<CLONE>, C<CLONE_SKIP>, 

=item documented in L<perlobj>

C<DESTROY>

=item documented in L<perltie>

C<BINMODE>, C<CLEAR>, C<CLOSE>, C<DELETE>, C<DESTROY>, C<EOF>, C<EXISTS>, 
C<EXTEND>, C<FETCH>, C<FETCHSIZE>, C<FILENO>, C<FIRSTKEY>, C<GETC>, 
C<NEXTKEY>, C<OPEN>, C<POP>, C<PRINT>, C<PRINTF>, C<PUSH>, C<READ>, 
C<READLINE>, C<SCALAR>, C<SEEK>, C<SHIFT>, C<SPLICE>, C<STORE>, 
C<STORESIZE>, C<TELL>, C<TIEARRAY>, C<TIEHANDLE>, C<TIEHASH>, 
C<TIESCALAR>, C<UNSHIFT>, C<UNTIE>, C<WRITE>

=item documented in L<PerlIO::via>

C<BINMODE>, C<CLEARERR>, C<CLOSE>, C<EOF>, C<ERROR>, C<FDOPEN>, C<FILENO>, 
C<FILL>, C<FLUSH>, C<OPEN>, C<POPPED>, C<PUSHED>, C<READ>, C<SEEK>, 
C<SETLINEBUF>, C<SYSOPEN>, C<TELL>, C<UNREAD>, C<UTF8>, C<WRITE>

=item documented in L<perlfunc>

L<< C<import> | perlfunc/use >>, L<< C<unimport> | perlfunc/use >>,
L<< C<INC> | perlfunc/require >>

=item documented in L<UNIVERSAL>

C<VERSION>

=item documented in L<perldebguts>

C<DB::DB>, C<DB::sub>, C<DB::lsub>, C<DB::goto>, C<DB::postponed>

=item undocumented, used internally by the L<overload> feature

any starting with C<(>

=back
a249 194
=head2 Signatures

B<WARNING>: Subroutine signatures are experimental.  The feature may be
modified or removed in future versions of Perl.

Perl has an experimental facility to allow a subroutine's formal
parameters to be introduced by special syntax, separate from the
procedural code of the subroutine body.  The formal parameter list
is known as a I<signature>.  The facility must be enabled first by a
pragmatic declaration, C<use feature 'signatures'>, and it will produce
a warning unless the "experimental::signatures" warnings category is
disabled.

The signature is part of a subroutine's body.  Normally the body of a
subroutine is simply a braced block of code.  When using a signature,
the signature is a parenthesised list that goes immediately before
the braced block.  The signature declares lexical variables that are
in scope for the block.  When the subroutine is called, the signature
takes control first.  It populates the signature variables from the
list of arguments that were passed.  If the argument list doesn't meet
the requirements of the signature, then it will throw an exception.
When the signature processing is complete, control passes to the block.

Positional parameters are handled by simply naming scalar variables in
the signature.  For example,

    sub foo ($left, $right) {
	return $left + $right;
    }

takes two positional parameters, which must be filled at runtime by
two arguments.  By default the parameters are mandatory, and it is
not permitted to pass more arguments than expected.  So the above is
equivalent to

    sub foo {
	die "Too many arguments for subroutine" unless @@_ <= 2;
	die "Too few arguments for subroutine" unless @@_ >= 2;
	my $left = $_[0];
	my $right = $_[1];
	return $left + $right;
    }

An argument can be ignored by omitting the main part of the name from
a parameter declaration, leaving just a bare C<$> sigil.  For example,

    sub foo ($first, $, $third) {
	return "first=$first, third=$third";
    }

Although the ignored argument doesn't go into a variable, it is still
mandatory for the caller to pass it.

A positional parameter is made optional by giving a default value,
separated from the parameter name by C<=>:

    sub foo ($left, $right = 0) {
	return $left + $right;
    }

The above subroutine may be called with either one or two arguments.
The default value expression is evaluated when the subroutine is called,
so it may provide different default values for different calls.  It is
only evaluated if the argument was actually omitted from the call.
For example,

    my $auto_id = 0;
    sub foo ($thing, $id = $auto_id++) {
	print "$thing has ID $id";
    }

automatically assigns distinct sequential IDs to things for which no
ID was supplied by the caller.  A default value expression may also
refer to parameters earlier in the signature, making the default for
one parameter vary according to the earlier parameters.  For example,

    sub foo ($first_name, $surname, $nickname = $first_name) {
	print "$first_name $surname is known as \"$nickname\"";
    }

An optional parameter can be nameless just like a mandatory parameter.
For example,

    sub foo ($thing, $ = 1) {
	print $thing;
    }

The parameter's default value will still be evaluated if the corresponding
argument isn't supplied, even though the value won't be stored anywhere.
This is in case evaluating it has important side effects.  However, it
will be evaluated in void context, so if it doesn't have side effects
and is not trivial it will generate a warning if the "void" warning
category is enabled.  If a nameless optional parameter's default value
is not important, it may be omitted just as the parameter's name was:

    sub foo ($thing, $=) {
	print $thing;
    }

Optional positional parameters must come after all mandatory positional
parameters.  (If there are no mandatory positional parameters then an
optional positional parameters can be the first thing in the signature.)
If there are multiple optional positional parameters and not enough
arguments are supplied to fill them all, they will be filled from left
to right.

After positional parameters, additional arguments may be captured in a
slurpy parameter.  The simplest form of this is just an array variable:

    sub foo ($filter, @@inputs) {
	print $filter->($_) foreach @@inputs;
    }

With a slurpy parameter in the signature, there is no upper limit on how
many arguments may be passed.  A slurpy array parameter may be nameless
just like a positional parameter, in which case its only effect is to
turn off the argument limit that would otherwise apply:

    sub foo ($thing, @@) {
	print $thing;
    }

A slurpy parameter may instead be a hash, in which case the arguments
available to it are interpreted as alternating keys and values.
There must be as many keys as values: if there is an odd argument then
an exception will be thrown.  Keys will be stringified, and if there are
duplicates then the later instance takes precedence over the earlier,
as with standard hash construction.

    sub foo ($filter, %inputs) {
	print $filter->($_, $inputs{$_}) foreach sort keys %inputs;
    }

A slurpy hash parameter may be nameless just like other kinds of
parameter.  It still insists that the number of arguments available to
it be even, even though they're not being put into a variable.

    sub foo ($thing, %) {
	print $thing;
    }

A slurpy parameter, either array or hash, must be the last thing in the
signature.  It may follow mandatory and optional positional parameters;
it may also be the only thing in the signature.  Slurpy parameters cannot
have default values: if no arguments are supplied for them then you get
an empty array or empty hash.

A signature may be entirely empty, in which case all it does is check
that the caller passed no arguments:

    sub foo () {
	return 123;
    }

When using a signature, the arguments are still available in the special
array variable C<@@_>, in addition to the lexical variables of the
signature.  There is a difference between the two ways of accessing the
arguments: C<@@_> I<aliases> the arguments, but the signature variables
get I<copies> of the arguments.  So writing to a signature variable
only changes that variable, and has no effect on the caller's variables,
but writing to an element of C<@@_> modifies whatever the caller used to
supply that argument.

There is a potential syntactic ambiguity between signatures and prototypes
(see L</Prototypes>), because both start with an opening parenthesis and
both can appear in some of the same places, such as just after the name
in a subroutine declaration.  For historical reasons, when signatures
are not enabled, any opening parenthesis in such a context will trigger
very forgiving prototype parsing.  Most signatures will be interpreted
as prototypes in those circumstances, but won't be valid prototypes.
(A valid prototype cannot contain any alphabetic character.)  This will
lead to somewhat confusing error messages.

To avoid ambiguity, when signatures are enabled the special syntax
for prototypes is disabled.  There is no attempt to guess whether a
parenthesised group was intended to be a prototype or a signature.
To give a subroutine a prototype under these circumstances, use a
L<prototype attribute|attributes/Built-in Attributes>.  For example,

    sub foo :prototype($) { $_[0] }

It is entirely possible for a subroutine to have both a prototype and
a signature.  They do different jobs: the prototype affects compilation
of calls to the subroutine, and the signature puts argument values into
lexical variables at runtime.  You can therefore write

    sub foo :prototype($$) ($left, $right) {
	return $left + $right;
    }

The prototype attribute, and any other attributes, must come before
the signature.  The signature always immediately precedes the block of
the subroutine's body.

d564 9
a572 9
    local $foo;		       # make $foo dynamically local
    local (@@wid, %get);	       # make list of variables local
    local $foo = "flurp";      # make $foo dynamic, and init it
    local @@oof = @@bar;	       # make @@oof dynamic, and init it

    local $hash{key} = "val";  # sets a local value for this hash entry
    delete local $hash{key};   # delete this entry for the current block
    local ($cond ? $v1 : $v2); # several types of lvalues support
			       # localization
d576 5
a580 5
    local *FH;		       # localize $FH, @@FH, %FH, &FH  ...
    local *merlyn = *randal;   # now $merlyn is really $randal, plus
                               #     @@merlyn is really @@randal, etc
    local *merlyn = 'randal';  # SAME THING: promote 'randal' to *randal
    local *merlyn = \$randal;  # just alias $merlyn, not @@merlyn etc
d767 3
d800 27
a826 6
Lvalue subroutines are convenient, but you have to keep in mind that,
when used with objects, they may violate encapsulation. A normal
mutator can check the supplied argument before setting the attribute
it is protecting, an lvalue subroutine cannot. If you require any
special processing when storing and retrieving the values, consider
using the CPAN module Sentinel or something similar.
d1024 2
a1025 2
        grow();                # really calls shrink()
	move();		       # if move() grow()s, it shrink()s too
d1027 1
a1027 1
    grow();		       # get the real grow() again
d1167 1
a1167 3
using function prototyping.  This can be declared in either the PROTO
section or with a L<prototype attribute|attributes/Built-in Attributes>.
If you declare either of
a1169 8
    sub mypush :prototype(+@@)

then C<mypush()> takes arguments exactly like C<push()> does.

If subroutine signatures are enabled (see L</Signatures>), then
the shorter PROTO syntax is unavailable, because it would clash with
signatures.  In that case, a prototype can only be declared in the form
of an attribute.
d1171 1
a1171 1
The
d1191 1
a1191 1
   Declared as		   Called as
d1193 14
a1206 14
   sub mylink ($$)	   mylink $old, $new
   sub myvec ($$$)	   myvec $var, $offset, 1
   sub myindex ($$;$)	   myindex &getstring, "substr"
   sub mysyswrite ($$$;$)  mysyswrite $buf, 0, length($buf) - $off, $off
   sub myreverse (@@)	   myreverse $a, $b, $c
   sub myjoin ($@@)	   myjoin ":", $a, $b, $c
   sub mypop (+)	   mypop @@array
   sub mysplice (+$$@@)	   mysplice @@array, 0, 2, @@pushme
   sub mykeys (+)	   mykeys %{$hashref}
   sub myopen (*;$)	   myopen HANDLE, $name
   sub mypipe (**)	   mypipe READHANDLE, WRITEHANDLE
   sub mygrep (&@@)	   mygrep { /foo/ } $a, $b, $c
   sub myrand (;$)	   myrand 42
   sub mytime ()	   mytime
a1364 10
If a sub has both a PROTO and a BLOCK, the prototype is not applied
until after the BLOCK is completely defined.  This means that a recursive
function with a prototype has to be predeclared for the prototype to take
effect, like so:

	sub foo($$);
	sub foo($$) {
		foo 1, 2;
	}

d1410 10
a1419 9
As alluded to earlier you can also declare inlined subs dynamically at
BEGIN time if their body consists of a lexically-scoped scalar which
has no other references. Only the first example here will be inlined:

    BEGIN {
        my $var = 1;
        no strict 'refs';
        *INLINED = sub () { $var };
    }
d1421 2
a1422 5
    BEGIN {
        my $var = 1;
        my $ref = \$var;
        no strict 'refs';
        *NOT_INLINED = sub () { $var };
a1423 60

A not so obvious caveat with this (see [RT #79908]) is that the
variable will be immediately inlined, and will stop behaving like a
normal lexical variable, e.g. this will print C<79907>, not C<79908>:

    BEGIN {
        my $x = 79907;
        *RT_79908 = sub () { $x };
        $x++;
    }
    print RT_79908(); # prints 79907

If you really want a subroutine with a C<()> prototype that returns a
lexical variable you can easily force it to not be inlined by adding
an explicit C<return>:

    BEGIN {
        my $x = 79907;
        *RT_79908 = sub () { return $x };
        $x++;
    }
    print RT_79908(); # prints 79908

The easiest way to tell if a subroutine was inlined is by using
L<B::Deparse>, consider this example of two subroutines returning
C<1>, one with a C<()> prototype causing it to be inlined, and one
without (with deparse output truncated for clarity):

 $ perl -MO=Deparse -le 'sub ONE { 1 } if (ONE) { print ONE if ONE }'
 sub ONE {
     1;
 }
 if (ONE ) {
     print ONE() if ONE ;
 }
 $ perl -MO=Deparse -le 'sub ONE () { 1 } if (ONE) { print ONE if ONE }'
 sub ONE () { 1 }
 do {
     print 1
 };

If you redefine a subroutine that was eligible for inlining, you'll
get a warning by default. You can use this warning to tell whether or
not a particular subroutine is considered inlinable, since it's
different than the warning for overriding non-inlined subroutines:

    $ perl -e 'sub one () {1} sub one () {2}'
    Constant subroutine one redefined at -e line 1.
    $ perl -we 'sub one {1} sub one {2}'
    Subroutine one redefined at -e line 1.

The warning is considered severe enough not to be affected by the
B<-w> switch (or its absence) because previously compiled invocations
of the function will still be using the old value of the function.  If
you need to be able to redefine the subroutine, you need to ensure
that it isn't inlined, either by dropping the C<()> prototype (which
changes calling semantics, so beware) or by thwarting the inlining
mechanism in some other way, e.g. by adding an explicit C<return>:

    sub not_inlined () { return 23 }
@


1.1.1.17
log
@Import perl-5.20.2
@
text
@d92 2
a93 2
value is returned.  If the last statement is a loop control structure
like a C<foreach> or a C<while>, the returned value is unspecified.  The
d250 1
a250 1
same way.  The following is a list of some subroutines that currently do 
d702 1
a702 1
First, you can simply use the C<state> feature.  Or, you can use closures,
d927 1
a927 1
In this case, the element is C<local>ized I<by name>.  This means that
d970 1
a970 1
it when it ends.  They return the array/hash value before the localization,
d989 1
a989 2
except that for those the C<local> is
scoped to the C<do> block.  Slices are
d1033 1
a1033 1
by a scalar.  For example, consider:
d1048 1
a1048 1
when used with objects, they may violate encapsulation.  A normal
d1050 1
a1050 1
it is protecting, an lvalue subroutine cannot.  If you require any
a1092 3
It is a known bug that lexical subroutines cannot be used as the C<SUBNAME>
argument to C<sort>.  This will be fixed in a future version of Perl.

d1448 1
a1448 1
C<< my_function()->[0] >>.  The value passed as part of C<@@_> will be a
d1453 1
a1453 1
allowed argument type.  For example:
d1658 1
a1658 1
has no other references.  Only the first example here will be inlined:
d1714 1
a1714 1
get a warning by default.  You can use this warning to tell whether or
d1853 1
a1853 1
the equivalent I/O operator C<< <FILEHANDLE> >>.  Also, overriding
@


