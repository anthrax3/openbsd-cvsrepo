head	1.9;
access;
symbols
	OPENBSD_6_1_BASE:1.9
	OPENBSD_6_0:1.9.0.10
	OPENBSD_6_0_BASE:1.9
	OPENBSD_5_9:1.9.0.4
	OPENBSD_5_9_BASE:1.9
	OPENBSD_5_8:1.9.0.6
	OPENBSD_5_8_BASE:1.9
	PERL_5_20_2:1.1.1.8
	OPENBSD_5_7:1.9.0.2
	OPENBSD_5_7_BASE:1.9
	PERL_5_20_1:1.1.1.8
	OPENBSD_5_6:1.8.0.8
	OPENBSD_5_6_BASE:1.8
	PERL_5_18_2:1.1.1.7
	PERL:1.1.1
	OPENBSD_5_5:1.8.0.6
	OPENBSD_5_5_BASE:1.8
	OPENBSD_5_4:1.8.0.2
	OPENBSD_5_4_BASE:1.8
	PERL_5_16_3:1.1.1.7
	OPENBSD_5_3:1.7.0.10
	OPENBSD_5_3_BASE:1.7
	OPENBSD_5_2:1.7.0.8
	OPENBSD_5_2_BASE:1.7
	OPENBSD_5_1_BASE:1.7
	OPENBSD_5_1:1.7.0.6
	OPENBSD_5_0:1.7.0.4
	OPENBSD_5_0_BASE:1.7
	OPENBSD_4_9:1.7.0.2
	OPENBSD_4_9_BASE:1.7
	PERL_5_12_2:1.1.1.6
	OPENBSD_4_8:1.6.0.4
	OPENBSD_4_8_BASE:1.6
	OPENBSD_4_7:1.6.0.2
	OPENBSD_4_7_BASE:1.6
	PERL_5_10_1:1.1.1.5
	OPENBSD_4_6:1.5.0.6
	OPENBSD_4_6_BASE:1.5
	OPENBSD_4_5:1.5.0.2
	OPENBSD_4_5_BASE:1.5
	PERL_5_10_0:1.1.1.4
	OPENBSD_4_4:1.4.0.24
	OPENBSD_4_4_BASE:1.4
	OPENBSD_4_3:1.4.0.22
	OPENBSD_4_3_BASE:1.4
	OPENBSD_4_2:1.4.0.20
	OPENBSD_4_2_BASE:1.4
	OPENBSD_4_1:1.4.0.18
	OPENBSD_4_1_BASE:1.4
	OPENBSD_4_0:1.4.0.16
	OPENBSD_4_0_BASE:1.4
	PERL_5_8_8:1.1.1.3
	OPENBSD_3_9:1.4.0.14
	OPENBSD_3_9_BASE:1.4
	OPENBSD_3_8:1.4.0.12
	OPENBSD_3_8_BASE:1.4
	OPENBSD_3_7:1.4.0.10
	OPENBSD_3_7_BASE:1.4
	PERL_5_8_6:1.1.1.3
	OPENBSD_3_6:1.4.0.8
	OPENBSD_3_6_BASE:1.4
	PERL_5_8_5:1.1.1.3
	PERL_5_8_3:1.1.1.3
	OPENBSD_3_5:1.4.0.6
	OPENBSD_3_5_BASE:1.4
	PERL_5_8_2:1.1.1.3
	OPENBSD_3_4:1.4.0.4
	OPENBSD_3_4_BASE:1.4
	OPENBSD_3_3:1.4.0.2
	OPENBSD_3_3_BASE:1.4
	PERL_5_8_0:1.1.1.3
	OPENBSD_3_2:1.3.0.12
	OPENBSD_3_2_BASE:1.3
	OPENBSD_3_1:1.3.0.10
	OPENBSD_3_1_BASE:1.3
	OPENBSD_3_0:1.3.0.8
	OPENBSD_3_0_BASE:1.3
	PERL_5_6_1:1.1.1.2
	OPENBSD_2_9:1.3.0.6
	OPENBSD_2_9_BASE:1.3
	OPENBSD_2_8:1.3.0.4
	OPENBSD_2_8_BASE:1.3
	OPENBSD_2_7:1.3.0.2
	OPENBSD_2_7_BASE:1.3
	PERL_5_6_0:1.1.1.2
	OPENBSD_2_6:1.2.0.2
	OPENBSD_2_6_BASE:1.2
	PERL_500503:1.1.1.1
	CPAN:1.1.1
	OPENBSD_2_5:1.1.0.6
	OPENBSD_2_5_BASE:1.1
	OPENBSD_2_4:1.1.0.4
	OPENBSD_2_4_BASE:1.1
	OPENBSD_2_3:1.1.0.2
	OPENBSD_2_3_BASE:1.1;
locks; strict;
comment	@# @;
expand	@o@;


1.9
date	2014.11.17.20.57.06;	author afresh1;	state Exp;
branches;
next	1.8;
commitid	QP75iYx42Uo7mMxO;

1.8
date	2013.03.25.20.40.55;	author sthen;	state Exp;
branches;
next	1.7;

1.7
date	2010.09.24.15.06.58;	author millert;	state Exp;
branches;
next	1.6;

1.6
date	2009.10.12.18.24.37;	author millert;	state Exp;
branches;
next	1.5;

1.5
date	2008.09.29.17.36.08;	author millert;	state Exp;
branches;
next	1.4;

1.4
date	2002.10.27.22.25.25;	author millert;	state Exp;
branches;
next	1.3;

1.3
date	2000.04.06.17.05.53;	author millert;	state Exp;
branches;
next	1.2;

1.2
date	99.04.29.22.51.40;	author millert;	state Exp;
branches;
next	1.1;

1.1
date	97.11.30.07.56.25;	author millert;	state Exp;
branches
	1.1.1.1;
next	;

1.1.1.1
date	99.04.29.22.39.35;	author millert;	state Exp;
branches;
next	1.1.1.2;

1.1.1.2
date	2000.04.06.16.09.29;	author millert;	state Exp;
branches;
next	1.1.1.3;

1.1.1.3
date	2002.10.27.22.14.56;	author millert;	state Exp;
branches;
next	1.1.1.4;

1.1.1.4
date	2008.09.29.17.18.28;	author millert;	state Exp;
branches;
next	1.1.1.5;

1.1.1.5
date	2009.10.12.18.10.46;	author millert;	state Exp;
branches;
next	1.1.1.6;

1.1.1.6
date	2010.09.24.14.48.55;	author millert;	state Exp;
branches;
next	1.1.1.7;

1.1.1.7
date	2013.03.25.20.08.48;	author sthen;	state Exp;
branches;
next	1.1.1.8;

1.1.1.8
date	2014.11.17.20.53.07;	author afresh1;	state Exp;
branches;
next	;
commitid	B31cAbBIXiCqnL97;


desc
@perl 5.004_04
@


1.9
log
@Fix merge conflicts, remove extra files, match upstream perl-5.20.1

ok deraadt@@ sthen@@ espie@@ miod@@
@
text
@#----------------------------------------------------------------
# QNX hints
#
# Most of the hints in this file are for QNX4, which needed
# more help. The QNX6 hints are located toward the bottom.
#
# perl-5.7.3 passes all tests under QNX4.24G
#  Watcom 10.6 with Beta/970211.wcc.update.tar.F
#  socket3r.lib Nov21 1996.
# perl-5.7.3 fails 2 known tests under QNX6.1.0
#
# perl-5.10.0-tobe compiles with Watcom C 10.6
#                and QNX 4.25 patch G w/TCPSDK installed
#  Some tests still fail, mostly to do with dynamic/static
#  or unsupported features in QNX.
# 
## As with many unix ports, this one depends on a few "standard"
# unix utilities which are not necessarily standard for QNX4.
#
# /bin/sh  This is used heavily by Configure and then by
#          perl itself. QNX4's version is fine, but Configure
#          will choke on the 16-bit version, so if you are
#          running QNX 4.22, link /bin/sh to /bin32/ksh
# ar       This is the standard unix library builder.
#          We use wlib. With Watcom 10.6, when wlib is
#          linked as "ar", it behaves like ar and all is
#          fine. Under 9.5, a cover is required. One is
#          included in ../qnx
# nm       This is used (optionally) by configure to list
#          the contents of libraries. I will generate
#          a cover function on the fly in the UU directory.
# cpp      Configure and perl need a way to invoke a C
#          preprocessor. I have created a simple cover
#          for cc which does the right thing. Without this,
#          Configure will create its own wrapper which works,
#          but it doesn't handle some of the command line arguments
#          that perl will throw at it.
# make     You really need GNU make to compile this. GNU make
#          ships by default with QNX 4.23, but you can get it
#          from quics for earlier versions.
#----------------------------------------------------------------
# Outstanding Issues for QNX4:
#   There is no support for dynamically linked libraries in
#   QNX4.
#
#   If you wish to compile with the Socket extension, you need
#   to have the TCP/IP toolkit, and you need to make sure that
#   -lsocket locates the correct copy of socket3r.lib. Beware
#   that the Watcom compiler ships with a stub version of
#   socket3r.lib which has very little functionality. Also
#   beware the order in which wlink searches directories for
#   libraries. You may have /usr/lib/socket3r.lib pointing to
#   the correct library, but wlink may pick up
#   /usr/watcom/10.6/usr/lib/socket3r.lib instead. Make sure
#   they both point to the correct library, that is,
#   /usr/tcptk/current/usr/lib/socket3r.lib.
# 
#   dist/Cwd/Cwd.t will complain if `pwd` and cwd don't give
#   the same results. cwd calls `fullpath -t`, so if you
#   cd `fullpath -t` before running the test, it will
#   pass.
#
#   lib/File/Find/taint.t will complain if '.' is in your
#   PATH. The PATH test is triggered because cwd calls
#   `fullpath -t`.
#
#   ext/IO/lib/IO/t/io_sock.t: Subtest 14 is skipped due to
#   the fact that the functionality to read back the non-blocking
#   status of a socket is not implemented in QNX's TCP/IP. This
#   has been reported to QNX and it may work with later versions
#   of TCP/IP.
#
# Older issues:
#   lib/posix.t test failed on test 17 because acos(1) != 0.
#      Resolved in 970211 Beta
#   lib/io_udp.t test hangs because of a bug in getsockname().
#      Fixed in latest BETA socket3r.lib
#----------------------------------------------------------------
# Outstanding Issues for QNX6:
#  The following tests are still failing as of 5.7.3:
#
#   op/sprintf.........................FAILED at test 91
#   lib/Benchmark......................FAILED at test 26
#
# This is due to a bug in the C library's printf routine.
# printf("'%e'", 0. ) produces '0.000000e+0', but ANSI requires
# '0.000000e+00'. QNX has acknowledged the bug and it should be
# fixed in 6.2.0.
#
#----------------------------------------------------------------
# These hints were submitted by:
#   Norton T. Allen
#   Harvard University Atmospheric Research Project
#   allen@@huarp.harvard.edu
#
# If you have suggestions or changes, please let me know.
#----------------------------------------------------------------

echo ""
echo "Some tests may fail. Please read the hints/qnx.sh file."
echo ""

#----------------------------------------------------------------
# At present, all QNX4 systems are equivalent architectures,
# so it is reasonable to call archname=x86-qnx rather than
# making an unnecessary distinction between AT-qnx and PCI-qnx,
# for example. I will use uname's architecture for Neutrino.
#----------------------------------------------------------------
set X `$run uname -a`
shift
[ "$1" != "QNX" ] && echo "uname doesn't look like QNX!"
case $4 in
  42[2-9]) archname='x86-qnx';;
  *) osname='nto'
	 osvers=$3
     archname="$5-nto";;
esac

if [ "$osname" = "qnx" ]; then
  #----------------------------------------------------------------
  # QNX doesn't come with a csh and the ports of tcsh I've used
  # don't work reliably:
  #----------------------------------------------------------------
  csh=''
  d_csh='undef'
  full_csh=''

  #----------------------------------------------------------------
  # setuid scripts are secure under QNX.
  #  (Basically, the same race conditions apply, but assuming
  #  the scripts are located in a secure directory, the methods
  #  for exploiting the race condition are defeated because
  #  the loader expands the script name fully before executing
  #  the interpreter.)
  #----------------------------------------------------------------
  d_suidsafe='define'

  #----------------------------------------------------------------
  # difftime is implemented as a preprocessor macro, so it doesn't show
  # up in the libraries:
  #----------------------------------------------------------------
  d_difftime='define'

  #----------------------------------------------------------------
  # strtod is in the math library, but we can't tell Configure
  # about the math library or it will confuse the linker
  #----------------------------------------------------------------
  d_strtod='define'

  lib_ext='3r.lib'
  libc='/usr/lib/clib3r.lib'

  #----------------------------------------------------------------
  # ccflags:
  # I like to turn the warnings up high, but a few common
  # constructs make a lot of noise, so I turn those warnings off.
  # A few still remain...
  #
  # unix.h is required as a general rule for unixy applications.
  #----------------------------------------------------------------
  ccflags='-mf -w4 -Wc,-wcd=202 -Wc,-wcd=203 -Wc,-wcd=302 -Wc,-fi=unix.h'

  #----------------------------------------------------------------
  # ldflags:
  # If you want debugging information, you must specify -g on the
  # link as well as the compile. If optimize != -g, you should
  # remove this.
  #----------------------------------------------------------------
  ldflags="-g -N1M"

  so='none'
  selecttype='fd_set *'

  #----------------------------------------------------------------
  # Add -lunix to list of libs. This is needed mainly so the nm
  # search will find funcs in the unix lib. Including unix.h should
  # automatically include the library without -l.
  #----------------------------------------------------------------
  libswanted="$libswanted unix"

  if [ -z "`which ar 2>/dev/null`" ]; then
	cat <<-'EOF' >&4
	  I don't see an 'ar', so I'm guessing you are running
	  Watcom 9.5 or earlier. You may want to install the ar
	  cover found in the qnx subdirectory of this distribution.
	  It might reasonably be placed in /usr/local/bin.

	EOF
  fi
  #----------------------------------------------------------------
  # Here is a nm script which fixes up wlib's output to look
  # something like nm's, at least enough so that Configure can
  # use it.
  #----------------------------------------------------------------
  if [ -z "`which nm 2>/dev/null`" ]; then
	cat <<-EOF
	  Creating a quick-and-dirty nm cover for	Configure to use:

	EOF
	cat >./UU/nm <<-'EOF'
	  #! /bin/sh
	  #__USAGE
	  #%C	<lib> [<lib> ...]
	  #	Designed to mimic Unix's nm utility to list
	  #	defined symbols in a library
	  unset WLIB
	  for i in $*; do wlib $i; done |
		awk '
		  /^  / {
			for (i = 1; i <= NF; i++) {
			  sub("_$", "", $i)
			  print "000000  T " $i
			}
		  }'
	EOF
	chmod +x ./UU/nm
  fi

  cppstdin=`which cpp 2>/dev/null`
  if [ -n "$cppstdin" ]; then
	cat <<-EOF >&4
	  I found a cpp at $cppstdin and will assume it is a good
	  thing to use. If this proves to be false, there is a
	  thin cover for cpp in the qnx subdirectory of this
	  distribution which you could move into your path.
	EOF
	cpprun="$cppstdin"
  else
	cat <<-EOF >&4
	
	  There is a cpp cover in the qnx subdirectory of this
	  distribution which works a little better than the
	  Configure default. You may wish to copy it to
	  /usr/local/bin or some other suitable location.
	EOF
  fi

  # includes a matherr() to silence noise from watcom libc
  archobjs="qnx.o"
  test -f qnx.c || cp qnx/qnx.c .

else
  # $^O eq nto

  ccflags="$ccflags -U__STRICT_ANSI__"

  # Options required to get dynamic linking to work
  lddlflags="$lddlflags -shared"
  ccdlflags="$ccdlflags -Wl,-E"

  case "$usecrosscompile" in
  define)
    # TODO this else should probably be an elif on $2 including
    # "Blackberry" or similar
    
    # Configure detects these, but they won't link for some reason:
    d_eaccess="$undef"
    d_dirfd="$undef"
    d_getspnam="$undef"
    d_setlinebuf="$undef"
    
    # Default to USE_SHELL_ALWAYS -- like with Android, Blackberry's
    # shell has several commands built-in, and this works around the
    # issue.
    d_useshellcmds='define'
    
    # By this point, targetarch will be:
    # For x86 builds, 'ntox86' or 'i486-pc-nto-qnx8.0.0-gcc'
    # For arm builds, 'ntoarmv7' 'arm-unknown-nto-qnx8.0.0eabi'
    # This will change those to plain x86 and armle-v7, respectively.
    case "`$run uname -m`" in
        *x86*) targetarch=x86;;
        *) targetarch=armle-v7;;
    esac
    
    libc="$QNX_TARGET/$targetarch/lib/libc.so"
    
    ldflags="$ldflags -L${QNX_TARGET}/$targetarch/lib -L${QNX_TARGET}/$targetarch/usr/lib -L${QNX_TARGET}/$targetarch/lib/gcc/4.6.3"
    
    ldflags="$ldflags -lc -lm -lsocket"
    lddlflags="$lddlflags -lc -lm -lsocket "    
    libpth="$libpth /proc/boot"
    targetenv="export LC_ALL=C; $targetenv"
    ;;
  *)
    # Somewhere in the build, something tries to throw a gcc
    # option to $cc if it knows it invokes gcc. Our cc doesn't
    # recognize that option, so we're better off setting cc=gcc.
    # Of course, only do this when not cross-compiling, for
    # obvious reasons.
    cc='gcc'
    ;;
  esac

  # gcc uses $QNX_TARGET/usr/include as the include directory.
  usrinc="$QNX_TARGET/usr/include"

  # If we use perl's malloc, it dies with an invalid sbrk.
  # This is probably worth tracking down someday.
  usemymalloc='false'
  
  libswanted=`echo " $libswanted "| sed 's/ malloc / /'`

  # Some routines are only in our static libc.
  # eg crypt() getlogin() getlogin_r()
  usenm=false
fi
@


1.8
log
@merge/resolve conflicts
(some more to do after this one)
@
text
@d109 1
a109 1
set X `uname -a`
d245 1
a245 1
  ccflags='-U__STRICT_ANSI__'
d248 2
a249 2
  lddlflags='-shared'
  ccdlflags='-Wl,-E'
d251 43
a293 4
  # Somewhere in the build, something tries to throw a gcc
  # option to $cc if it knows it invokes gcc. Our cc doesn't
  # recognize that option, so we're better off setting cc=gcc.
  cc='gcc'
@


1.7
log
@merge in perl 5.12.2 plus local changes
@
text
@d15 1
a15 1
#  or unsuported features in QNX.
d58 1
a58 1
#   cpan/Cwd/Cwd.t will complain if `pwd` and cwd don't give
@


1.6
log
@Merge in perl 5.10.1
@
text
@d58 1
a58 1
#   ext/Cwd/Cwd.t will complain if `pwd` and cwd don't give
@


1.5
log
@fix conflicts and merge in local changes to perl 5.10.0
@
text
@d245 1
a245 1
  ccflags='-DDLOPEN_WONT_DO_RELATIVE_PATHS'
d262 2
d265 3
a267 2
  # crypt isn't detected in the C library even though it's there.
  d_crypt='define'
@


1.4
log
@Resolve conflicts, remove old files, merge local changes
@
text
@d12 6
a17 1
# As with many unix ports, this one depends on a few "standard"
d237 5
d256 3
d262 3
@


1.3
log
@perl-5.6.0 + local changes
@
text
@d4 4
a7 2
# As of perl5.004_04, all tests pass under:
#  QNX 4.23A
d10 1
d13 1
a13 1
# unix utilities which are not necessarily standard for QNX.
d16 1
a16 1
#          perl itself. QNX's version is fine, but Configure
d30 1
a30 1
#          Configure will create it's own wrapper which works,
d37 33
a69 2
# Outstanding Issues:
#   lib/posix.t test fails on test 17 because acos(1) != 0.
d73 12
a84 2
#   There is currently no support for dynamically linked
#      libraries.
d99 1
a99 1
# At present, all QNX systems are equivalent architectures,
d102 1
a102 31
# for example.
#----------------------------------------------------------------
archname='x86-qnx'

#----------------------------------------------------------------
# QNX doesn't come with a csh and the ports of tcsh I've used
# don't work reliably:
#----------------------------------------------------------------
csh=''
d_csh='undef'
full_csh=''

#----------------------------------------------------------------
# setuid scripts are secure under QNX.
#  (Basically, the same race conditions apply, but assuming
#  the scripts are located in a secure directory, the methods
#  for exploiting the race condition are defeated because
#  the loader expands the script name fully before executing
#  the interpreter.)
#----------------------------------------------------------------
d_suidsafe='define'

#----------------------------------------------------------------
# difftime is implemented as a preprocessor macro, so it doesn't show
# up in the libraries:
#----------------------------------------------------------------
d_difftime='define'

#----------------------------------------------------------------
# strtod is in the math library, but we can't tell Configure
# about the math library or it will confuse the linker
d104 78
a181 39
d_strtod='define'

lib_ext='3r.lib'
libc='/usr/lib/clib3r.lib'

#----------------------------------------------------------------
# ccflags:
# I like to turn the warnings up high, but a few common
# constructs make a lot of noise, so I turn those warnings off.
# A few still remain...
#
# unix.h is required as a general rule for unixy applications.
#----------------------------------------------------------------
ccflags='-mf -w4 -Wc,-wcd=202 -Wc,-wcd=203 -Wc,-wcd=302 -Wc,-fi=unix.h'

#----------------------------------------------------------------
# ldflags:
# If you want debugging information, you must specify -g on the
# link as well as the compile. If optimize != -g, you should
# remove this.
#----------------------------------------------------------------
ldflags="-g -N1M"

so='none'
selecttype='fd_set *'

#----------------------------------------------------------------
# Add -lunix to list of libs. This is needed mainly so the nm
# search will find funcs in the unix lib. Including unix.h should
# automatically include the library without -l.
#----------------------------------------------------------------
libswanted="$libswanted unix"

if [ -z "`which ar 2>/dev/null`" ]; then
  cat <<-'EOF' >&4
	I don't see an 'ar', so I'm guessing you are running
	Watcom 9.5 or earlier. You may want to install the ar
	cover found in the qnx subdirectory of this distribution.
	It might reasonably be placed in /usr/local/bin.
d184 9
a192 9
fi
#----------------------------------------------------------------
# Here is a nm script which fixes up wlib's output to look
# something like nm's, at least enough so that Configure can
# use it.
#----------------------------------------------------------------
if [ -z "`which nm 2>/dev/null`" ]; then
  cat <<-EOF
	Creating a quick-and-dirty nm cover for	Configure to use:
d195 15
a209 15
  cat >./UU/nm <<-'EOF'
	#! /bin/sh
	#__USAGE
	#%C	<lib> [<lib> ...]
	#	Designed to mimic Unix's nm utility to list
	#	defined symbols in a library
	unset WLIB
	for i in $*; do wlib $i; done |
	  awk '
	    /^  / {
	      for (i = 1; i <= NF; i++) {
	        sub("_$", "", $i)
	        print "000000  T " $i
	      }
	    }'
d211 2
a212 2
  chmod +x ./UU/nm
fi
d214 7
a220 7
cppstdin=`which cpp 2>/dev/null`
if [ -n "$cppstdin" ]; then
  cat <<-EOF >&4
	I found a cpp at $cppstdin and will assume it is a good
	thing to use. If this proves to be false, there is a
	thin cover for cpp in the qnx subdirectory of this
	distribution which you could move into your path.
d222 3
a224 3
  cpprun="$cppstdin"
else
  cat <<-EOF >&4
d226 4
a229 4
	There is a cpp cover in the qnx subdirectory of this
	distribution which works a little better than the
	Configure default. You may wish to copy it to
	/usr/local/bin or some other suitable location.
d231 19
a249 1
fi	
@


1.2
log
@perl5.005_03 (stock)
@
text
@a100 4
# HIDEMYMALLOC is necessary if using mymalloc since it is very
# tricky (though not impossible) to totally replace the watcom
# malloc/free set.
#
d103 1
a103 1
ccflags='-DHIDEMYMALLOC -mf -w4 -Wc,-wcd=202 -Wc,-wcd=203 -Wc,-wcd=302 -Wc,-fi=unix.h'
@


1.1
log
@perl 5.004_04
@
text
@a38 2
#   If there is a softlink in your path, Findbin will fail.
#      This is a documented feature of perl's getpwd().
a40 8
#   op/magic.t failure due to a feature of QNX which rewrites script
#      names before they are executed. I think you'll find that if
#      you cd `fullpath -t` before doing the make, the test will pass.
#----------------------------------------------------------------
# At present, all QNX systems are equivalent architectures,
# so it might be reasonable to call archname=qnx rather than
# making an unnecessary distinction between AT-qnx and PCI-qnx,
# for example.
d55 8
d146 1
a146 1
  cat >../UU/nm <<-'EOF'
d162 1
a162 1
  chmod +x ../UU/nm
@


1.1.1.1
log
@perl5.005_03
@
text
@d39 2
d43 8
a64 8
# At present, all QNX systems are equivalent architectures,
# so it is reasonable to call archname=x86-qnx rather than
# making an unnecessary distinction between AT-qnx and PCI-qnx,
# for example.
#----------------------------------------------------------------
archname='x86-qnx'

#----------------------------------------------------------------
d148 1
a148 1
  cat >./UU/nm <<-'EOF'
d164 1
a164 1
  chmod +x ./UU/nm
@


1.1.1.2
log
@virgin perl 5.6.0
@
text
@d101 4
d107 1
a107 1
ccflags='-mf -w4 -Wc,-wcd=202 -Wc,-wcd=203 -Wc,-wcd=302 -Wc,-fi=unix.h'
@


1.1.1.3
log
@stock perl 5.8.0 from CPAN
@
text
@d4 2
a5 4
# Most of the hints in this file are for QNX4, which needed
# more help. The QNX6 hints are located toward the bottom.
#
# perl-5.7.3 passes all tests under QNX4.24G
a7 1
# perl-5.7.3 fails 2 known tests under QNX6.1.0
d10 1
a10 1
# unix utilities which are not necessarily standard for QNX4.
d13 1
a13 1
#          perl itself. QNX4's version is fine, but Configure
d27 1
a27 1
#          Configure will create its own wrapper which works,
d34 2
a35 33
# Outstanding Issues for QNX4:
#   There is no support for dynamically linked libraries in
#   QNX4.
#
#   If you wish to compile with the Socket extension, you need
#   to have the TCP/IP toolkit, and you need to make sure that
#   -lsocket locates the correct copy of socket3r.lib. Beware
#   that the Watcom compiler ships with a stub version of
#   socket3r.lib which has very little functionality. Also
#   beware the order in which wlink searches directories for
#   libraries. You may have /usr/lib/socket3r.lib pointing to
#   the correct library, but wlink may pick up
#   /usr/watcom/10.6/usr/lib/socket3r.lib instead. Make sure
#   they both point to the correct library, that is,
#   /usr/tcptk/current/usr/lib/socket3r.lib.
# 
#   ext/Cwd/Cwd.t will complain if `pwd` and cwd don't give
#   the same results. cwd calls `fullpath -t`, so if you
#   cd `fullpath -t` before running the test, it will
#   pass.
#
#   lib/File/Find/taint.t will complain if '.' is in your
#   PATH. The PATH test is triggered because cwd calls
#   `fullpath -t`.
#
#   ext/IO/lib/IO/t/io_sock.t: Subtest 14 is skipped due to
#   the fact that the functionality to read back the non-blocking
#   status of a socket is not implemented in QNX's TCP/IP. This
#   has been reported to QNX and it may work with later versions
#   of TCP/IP.
#
# Older issues:
#   lib/posix.t test failed on test 17 because acos(1) != 0.
d39 2
a40 12
#----------------------------------------------------------------
# Outstanding Issues for QNX6:
#  The following tests are still failing as of 5.7.3:
#
#   op/sprintf.........................FAILED at test 91
#   lib/Benchmark......................FAILED at test 26
#
# This is due to a bug in the C library's printf routine.
# printf("'%e'", 0. ) produces '0.000000e+0', but ANSI requires
# '0.000000e+00'. QNX has acknowledged the bug and it should be
# fixed in 6.2.0.
#
d55 1
a55 1
# At present, all QNX4 systems are equivalent architectures,
d58 31
a88 1
# for example. I will use uname's architecture for Neutrino.
d90 39
a128 78
set X `uname -a`
shift
[ "$1" != "QNX" ] && echo "uname doesn't look like QNX!"
case $4 in
  42[2-9]) archname='x86-qnx';;
  *) osname='nto'
	 osvers=$3
     archname="$5-nto";;
esac

if [ "$osname" = "qnx" ]; then
  #----------------------------------------------------------------
  # QNX doesn't come with a csh and the ports of tcsh I've used
  # don't work reliably:
  #----------------------------------------------------------------
  csh=''
  d_csh='undef'
  full_csh=''

  #----------------------------------------------------------------
  # setuid scripts are secure under QNX.
  #  (Basically, the same race conditions apply, but assuming
  #  the scripts are located in a secure directory, the methods
  #  for exploiting the race condition are defeated because
  #  the loader expands the script name fully before executing
  #  the interpreter.)
  #----------------------------------------------------------------
  d_suidsafe='define'

  #----------------------------------------------------------------
  # difftime is implemented as a preprocessor macro, so it doesn't show
  # up in the libraries:
  #----------------------------------------------------------------
  d_difftime='define'

  #----------------------------------------------------------------
  # strtod is in the math library, but we can't tell Configure
  # about the math library or it will confuse the linker
  #----------------------------------------------------------------
  d_strtod='define'

  lib_ext='3r.lib'
  libc='/usr/lib/clib3r.lib'

  #----------------------------------------------------------------
  # ccflags:
  # I like to turn the warnings up high, but a few common
  # constructs make a lot of noise, so I turn those warnings off.
  # A few still remain...
  #
  # unix.h is required as a general rule for unixy applications.
  #----------------------------------------------------------------
  ccflags='-mf -w4 -Wc,-wcd=202 -Wc,-wcd=203 -Wc,-wcd=302 -Wc,-fi=unix.h'

  #----------------------------------------------------------------
  # ldflags:
  # If you want debugging information, you must specify -g on the
  # link as well as the compile. If optimize != -g, you should
  # remove this.
  #----------------------------------------------------------------
  ldflags="-g -N1M"

  so='none'
  selecttype='fd_set *'

  #----------------------------------------------------------------
  # Add -lunix to list of libs. This is needed mainly so the nm
  # search will find funcs in the unix lib. Including unix.h should
  # automatically include the library without -l.
  #----------------------------------------------------------------
  libswanted="$libswanted unix"

  if [ -z "`which ar 2>/dev/null`" ]; then
	cat <<-'EOF' >&4
	  I don't see an 'ar', so I'm guessing you are running
	  Watcom 9.5 or earlier. You may want to install the ar
	  cover found in the qnx subdirectory of this distribution.
	  It might reasonably be placed in /usr/local/bin.
d131 9
a139 9
  fi
  #----------------------------------------------------------------
  # Here is a nm script which fixes up wlib's output to look
  # something like nm's, at least enough so that Configure can
  # use it.
  #----------------------------------------------------------------
  if [ -z "`which nm 2>/dev/null`" ]; then
	cat <<-EOF
	  Creating a quick-and-dirty nm cover for	Configure to use:
d142 15
a156 15
	cat >./UU/nm <<-'EOF'
	  #! /bin/sh
	  #__USAGE
	  #%C	<lib> [<lib> ...]
	  #	Designed to mimic Unix's nm utility to list
	  #	defined symbols in a library
	  unset WLIB
	  for i in $*; do wlib $i; done |
		awk '
		  /^  / {
			for (i = 1; i <= NF; i++) {
			  sub("_$", "", $i)
			  print "000000  T " $i
			}
		  }'
d158 2
a159 2
	chmod +x ./UU/nm
  fi
d161 7
a167 7
  cppstdin=`which cpp 2>/dev/null`
  if [ -n "$cppstdin" ]; then
	cat <<-EOF >&4
	  I found a cpp at $cppstdin and will assume it is a good
	  thing to use. If this proves to be false, there is a
	  thin cover for cpp in the qnx subdirectory of this
	  distribution which you could move into your path.
d169 3
a171 3
	cpprun="$cppstdin"
  else
	cat <<-EOF >&4
d173 4
a176 4
	  There is a cpp cover in the qnx subdirectory of this
	  distribution which works a little better than the
	  Configure default. You may wish to copy it to
	  /usr/local/bin or some other suitable location.
d178 1
a178 19
  fi
else
  # $^O eq nto

  ccflags='-DDLOPEN_WONT_DO_RELATIVE_PATHS'

  # Options required to get dynamic linking to work
  lddlflags='-shared'
  ccdlflags='-Wl,-E'

  # Somewhere in the build, something tries to throw a gcc
  # option to $cc if it knows it invokes gcc. Our cc doesn't
  # recognize that option, so we're better off setting cc=gcc.
  cc='gcc'

  # If we use perl's malloc, it dies with an invalid sbrk.
  # This is probably worth tracking down someday.
  usemymalloc='false'
fi
@


1.1.1.4
log
@import perl 5.10.0 from CPAN
@
text
@d12 1
a12 6
# perl-5.10.0-tobe compiles with Watcom C 10.6
#                and QNX 4.25 patch G w/TCPSDK installed
#  Some tests still fail, mostly to do with dynamic/static
#  or unsuported features in QNX.
# 
## As with many unix ports, this one depends on a few "standard"
a231 5

  # includes a matherr() to silence noise from watcom libc
  archobjs="qnx.o"
  test -f qnx.c || cp qnx/qnx.c .

a245 3
  # gcc uses $QNX_TARGET/usr/include as the include directory.
  usrinc="$QNX_TARGET/usr/include"

a248 3

  # crypt isn't detected in the C library even though it's there.
  d_crypt='define'
@


1.1.1.5
log
@import perl 5.10.1
@
text
@d245 1
a245 1
  ccflags='-U__STRICT_ANSI__'
a261 2
  
  libswanted=`echo " $libswanted "| sed 's/ malloc / /'`
d263 2
a264 3
  # Some routines are only in our static libc.
  # eg crypt() getlogin() getlogin_r()
  usenm=false
@


1.1.1.6
log
@Perl 5.12.2 from CPAN
@
text
@d58 1
a58 1
#   cpan/Cwd/Cwd.t will complain if `pwd` and cwd don't give
@


1.1.1.7
log
@import perl 5.16.3 from CPAN - worked on by Andrew Fresh and myself
@
text
@d15 1
a15 1
#  or unsupported features in QNX.
d58 1
a58 1
#   dist/Cwd/Cwd.t will complain if `pwd` and cwd don't give
@


1.1.1.8
log
@Import perl-5.20.1
@
text
@d109 1
a109 1
set X `$run uname -a`
d245 1
a245 1
  ccflags="$ccflags -U__STRICT_ANSI__"
d248 2
a249 2
  lddlflags="$lddlflags -shared"
  ccdlflags="$ccdlflags -Wl,-E"
d251 4
a254 43
  case "$usecrosscompile" in
  define)
    # TODO this else should probably be an elif on $2 including
    # "Blackberry" or similar
    
    # Configure detects these, but they won't link for some reason:
    d_eaccess="$undef"
    d_dirfd="$undef"
    d_getspnam="$undef"
    d_setlinebuf="$undef"
    
    # Default to USE_SHELL_ALWAYS -- like with Android, Blackberry's
    # shell has several commands built-in, and this works around the
    # issue.
    d_useshellcmds='define'
    
    # By this point, targetarch will be:
    # For x86 builds, 'ntox86' or 'i486-pc-nto-qnx8.0.0-gcc'
    # For arm builds, 'ntoarmv7' 'arm-unknown-nto-qnx8.0.0eabi'
    # This will change those to plain x86 and armle-v7, respectively.
    case "`$run uname -m`" in
        *x86*) targetarch=x86;;
        *) targetarch=armle-v7;;
    esac
    
    libc="$QNX_TARGET/$targetarch/lib/libc.so"
    
    ldflags="$ldflags -L${QNX_TARGET}/$targetarch/lib -L${QNX_TARGET}/$targetarch/usr/lib -L${QNX_TARGET}/$targetarch/lib/gcc/4.6.3"
    
    ldflags="$ldflags -lc -lm -lsocket"
    lddlflags="$lddlflags -lc -lm -lsocket "    
    libpth="$libpth /proc/boot"
    targetenv="export LC_ALL=C; $targetenv"
    ;;
  *)
    # Somewhere in the build, something tries to throw a gcc
    # option to $cc if it knows it invokes gcc. Our cc doesn't
    # recognize that option, so we're better off setting cc=gcc.
    # Of course, only do this when not cross-compiling, for
    # obvious reasons.
    cc='gcc'
    ;;
  esac
@


