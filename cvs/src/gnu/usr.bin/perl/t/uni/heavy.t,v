head	1.1;
access;
symbols
	OPENBSD_6_1:1.1.0.4
	OPENBSD_6_1_BASE:1.1;
locks; strict;
comment	@# @;
expand	@o@;


1.1
date	2017.02.05.00.32.21;	author afresh1;	state Exp;
branches;
next	;
commitid	cxJ08BvJA9Pt2PTM;


desc
@@


1.1
log
@Fix merge issues, remove excess files - match perl-5.24.1 dist
@
text
@#!./perl -w
# tests that utf8_heavy.pl doesn't use anything that prevents it loading
BEGIN {
    chdir 't' if -d 't';
    @@INC = '../lib';
    require './test.pl';
}

plan tests => 1;

# see [perl #126593]
fresh_perl_is(<<'EOP', "", { stderr => 1 }, "doesn't break with \${^ENCODING}");
no warnings qw(deprecated);
package Foo;
sub cat_decode {
    # stolen from Encode.pm
    my ( undef, undef, undef, $pos, $trm ) = @@_;
    my ( $rdst, $rsrc, $rpos ) = \@@_[ 1, 2, 3 ];
    use bytes;
    if ( ( my $npos = index( $$rsrc, $trm, $pos ) ) >= 0 ) {
        $$rdst .=
          substr( $$rsrc, $pos, $npos - $pos + length($trm) );
        $$rpos = $npos + length($trm);
        return 1;
    }
    $$rdst .= substr( $$rsrc, $pos );
    $$rpos = length($$rsrc);
    return q();
}

sub decode {
   my (undef, $tmp) = @@_;
   utf8::decode($tmp);
   $tmp;
}

BEGIN { ${^ENCODING} = bless [], q(Foo) };

(my $tmp = q(abc)) =~ tr/abc/123/;
EOP
@
