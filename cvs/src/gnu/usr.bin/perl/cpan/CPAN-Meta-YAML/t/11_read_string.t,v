head	1.2;
access;
symbols
	OPENBSD_6_1:1.2.0.2
	OPENBSD_6_1_BASE:1.2
	OPENBSD_6_0:1.1.1.1.0.10
	OPENBSD_6_0_BASE:1.1.1.1
	OPENBSD_5_9:1.1.1.1.0.4
	OPENBSD_5_9_BASE:1.1.1.1
	OPENBSD_5_8:1.1.1.1.0.6
	OPENBSD_5_8_BASE:1.1.1.1
	PERL_5_20_2:1.1.1.1
	OPENBSD_5_7:1.1.1.1.0.2
	OPENBSD_5_7_BASE:1.1.1.1
	PERL_5_20_1:1.1.1.1
	PERL:1.1.1;
locks; strict;
comment	@# @;
expand	@b@;


1.2
date	2017.02.05.00.31.56;	author afresh1;	state Exp;
branches;
next	1.1;
commitid	cxJ08BvJA9Pt2PTM;

1.1
date	2014.11.17.20.52.43;	author afresh1;	state Exp;
branches
	1.1.1.1;
next	;
commitid	B31cAbBIXiCqnL97;

1.1.1.1
date	2014.11.17.20.52.43;	author afresh1;	state Exp;
branches;
next	;
commitid	B31cAbBIXiCqnL97;


desc
@@


1.2
log
@Fix merge issues, remove excess files - match perl-5.24.1 dist
@
text
@use strict;
use warnings;
use lib 't/lib/';
use Test::More 0.88;
use SubtestCompat;
use TestUtils;
use TestBridge;

use CPAN::Meta::YAML ();

#--------------------------------------------------------------------------#
# Generally, read_string can be tested with .tml files in t/tml-local/*
#
# This file is for error tests that can't be easily tested via .tml
#--------------------------------------------------------------------------#

subtest 'read_string without arg' => sub {
    eval { CPAN::Meta::YAML->read_string(); };
    error_like(qr/Did not provide a string to load/,
        "Got expected error: no string provided to read_string()"
    );
};

subtest 'YAML without newline' => sub {
    my $str = join("\n" => ('---', '- foo', '---', '- bar', '---'));
    my $obj = eval { CPAN::Meta::YAML->read_string($str); };
    is( $@@, '', "YAML without newline is OK");
};

subtest 'read_string as object method' => sub {
    ok( my $obj = CPAN::Meta::YAML->new( { foo => 'bar' } ), "new YAML object" );
    ok( my $obj2 = $obj->read_string( "---\nfoo: bar\n"  ),
        "read_string object method"
    );
    isnt( $obj, $obj2, "objects are different" );
    cmp_deeply( $obj, $obj2, "objects have same content" );
};

subtest 'invalid UTF-8' => sub {
    # get invalid UTF-8 by reading Latin-1 with lax :utf8 layer
    my $string = do {
        local $SIG{__WARN__} = sub {};
        slurp( test_data_file('latin1.yml'), ":utf8" );
    };
    my $obj = eval { CPAN::Meta::YAML->read_string($string); };
    is( $obj, undef, "read_string should return undef" );
    error_like( qr/invalid UTF-8 string/,
        "Got expected error about invalid UTF-8 string"
    );
};

done_testing;
@


1.1
log
@Initial revision
@
text
@d4 2
a5 1
use Test::More 0.99;
@


1.1.1.1
log
@Import perl-5.20.1
@
text
@@
