head	1.2;
access;
symbols
	OPENBSD_6_2_BASE:1.2
	PERL_5_24_2:1.1.1.2
	OPENBSD_6_1:1.2.0.4
	OPENBSD_6_1_BASE:1.2
	OPENBSD_6_0:1.1.1.1.0.26
	OPENBSD_6_0_BASE:1.1.1.1
	OPENBSD_5_9:1.1.1.1.0.20
	OPENBSD_5_9_BASE:1.1.1.1
	OPENBSD_5_8:1.1.1.1.0.22
	OPENBSD_5_8_BASE:1.1.1.1
	PERL_5_20_2:1.1.1.1
	OPENBSD_5_7:1.1.1.1.0.14
	OPENBSD_5_7_BASE:1.1.1.1
	PERL_5_20_1:1.1.1.1
	OPENBSD_5_6:1.1.1.1.0.18
	OPENBSD_5_6_BASE:1.1.1.1
	PERL_5_18_2:1.1.1.1
	PERL:1.1.1
	OPENBSD_5_5:1.1.1.1.0.16
	OPENBSD_5_5_BASE:1.1.1.1
	OPENBSD_5_4:1.1.1.1.0.12
	OPENBSD_5_4_BASE:1.1.1.1
	PERL_5_16_3:1.1.1.1
	OPENBSD_5_3:1.1.1.1.0.10
	OPENBSD_5_3_BASE:1.1.1.1
	OPENBSD_5_2:1.1.1.1.0.8
	OPENBSD_5_2_BASE:1.1.1.1
	OPENBSD_5_1_BASE:1.1.1.1
	OPENBSD_5_1:1.1.1.1.0.6
	OPENBSD_5_0:1.1.1.1.0.4
	OPENBSD_5_0_BASE:1.1.1.1
	OPENBSD_4_9:1.1.1.1.0.2
	OPENBSD_4_9_BASE:1.1.1.1
	PERL_5_12_2:1.1.1.1
	CPAN:1.1.1;
locks; strict;
comment	@# @;
expand	@o@;


1.2
date	2017.02.05.00.32.06;	author afresh1;	state Exp;
branches;
next	1.1;
commitid	cxJ08BvJA9Pt2PTM;

1.1
date	2010.09.24.14.49.05;	author millert;	state Exp;
branches
	1.1.1.1;
next	;

1.1.1.1
date	2010.09.24.14.49.05;	author millert;	state Exp;
branches;
next	1.1.1.2;

1.1.1.2
date	2017.08.14.13.45.32;	author afresh1;	state Exp;
branches;
next	;
commitid	fAzrs78vdW2Yfc6A;


desc
@@


1.2
log
@Fix merge issues, remove excess files - match perl-5.24.1 dist
@
text
@#!/usr/bin/perl -w
use strict;
use Test::More;
use FindBin qw($Bin);
use constant TMPDIR => "$Bin/mkdir_test_delete_me";
use constant ERROR_REGEXP => qr{Can't mkdir\('\Q${\(TMPDIR)}\E', 0777\):};
use constant SINGLE_DIGIT_ERROR_REGEXP => qr{Can't mkdir\('\Q${\(TMPDIR)}\E', 0010\):};

# Delete our directory if it's there
rmdir TMPDIR;

# See if we can create directories and remove them
mkdir TMPDIR or plan skip_all => "Failed to make test directory";

# Test the directory was created
-d TMPDIR or plan skip_all => "Failed to make test directory";

# Try making it a second time (this should fail)
if(mkdir TMPDIR) { plan skip_all => "Attempt to remake a directory succeeded";}

# See if we can remove the directory
rmdir TMPDIR or plan skip_all => "Failed to remove directory";

# Check that the directory was removed
if(-d TMPDIR) { plan skip_all => "Failed to delete test directory"; }

# Try to delete second time
if(rmdir TMPDIR) { plan skip_all => "Able to rmdir directory twice"; }

plan tests => 18;

# Create a directory (this should succeed)
eval {
	use autodie;

	mkdir TMPDIR;
};
is($@@, "", "mkdir returned success");
ok(-d TMPDIR, "Successfully created test directory");

# Try to create it again (this should fail)
eval {
	use autodie;

	mkdir TMPDIR, 0777;
};
ok($@@, "Re-creating directory causes failure.");
isa_ok($@@, "autodie::exception", "... errors are of the correct type");
ok($@@->matches("mkdir"), "... it's also a mkdir object");
ok($@@->matches(":filesys"), "... and a filesys object");
like($@@, ERROR_REGEXP, "Message should include numeric mask in octal form");

eval {
        use autodie;

        mkdir TMPDIR, 8;
};
ok($@@, "Re-creating directory causes failure.");
isa_ok($@@, "autodie::exception", "... errors are of the correct type");
ok($@@->matches("mkdir"), "... it's also a mkdir object");
ok($@@->matches(":filesys"), "... and a filesys object");
like($@@, SINGLE_DIGIT_ERROR_REGEXP, "Message should include numeric mask in octal form");

# Try to delete directory (this should succeed)
eval {
	use autodie;

	rmdir TMPDIR;
};
is($@@, "", "rmdir returned success");
ok(! -d TMPDIR, "Successfully removed test directory");

# Try to delete directory again (this should fail)
eval {
	use autodie;

	rmdir TMPDIR;
};
ok($@@, "Re-deleting directory causes failure.");
isa_ok($@@, "autodie::exception", "... errors are of the correct type");
ok($@@->matches("rmdir"), "... it's also a rmdir object");
ok($@@->matches(":filesys"), "... and a filesys object");

@


1.1
log
@Initial revision
@
text
@d6 2
d30 1
a30 1
plan tests => 12;
d45 12
a56 1
	mkdir TMPDIR;
d62 1
@


1.1.1.1
log
@Perl 5.12.2 from CPAN
@
text
@@


1.1.1.2
log
@Import perl-5.24.2
@
text
@a5 2
use constant ERROR_REGEXP => qr{Can't mkdir\('\Q${\(TMPDIR)}\E', 0777\):};
use constant SINGLE_DIGIT_ERROR_REGEXP => qr{Can't mkdir\('\Q${\(TMPDIR)}\E', 0010\):};
d28 1
a28 1
plan tests => 18;
d43 1
a43 12
	mkdir TMPDIR, 0777;
};
ok($@@, "Re-creating directory causes failure.");
isa_ok($@@, "autodie::exception", "... errors are of the correct type");
ok($@@->matches("mkdir"), "... it's also a mkdir object");
ok($@@->matches(":filesys"), "... and a filesys object");
like($@@, ERROR_REGEXP, "Message should include numeric mask in octal form");

eval {
        use autodie;

        mkdir TMPDIR, 8;
a48 1
like($@@, SINGLE_DIGIT_ERROR_REGEXP, "Message should include numeric mask in octal form");
@

