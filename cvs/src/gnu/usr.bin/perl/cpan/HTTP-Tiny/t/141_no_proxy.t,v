head	1.1;
branch	1.1.1;
access;
symbols
	PERL_5_24_2:1.1.1.1
	OPENBSD_6_1:1.1.1.1.0.12
	OPENBSD_6_1_BASE:1.1.1.1
	OPENBSD_6_0:1.1.1.1.0.10
	OPENBSD_6_0_BASE:1.1.1.1
	OPENBSD_5_9:1.1.1.1.0.4
	OPENBSD_5_9_BASE:1.1.1.1
	OPENBSD_5_8:1.1.1.1.0.6
	OPENBSD_5_8_BASE:1.1.1.1
	PERL_5_20_2:1.1.1.1
	OPENBSD_5_7:1.1.1.1.0.2
	OPENBSD_5_7_BASE:1.1.1.1
	PERL_5_20_1:1.1.1.1
	PERL:1.1.1;
locks; strict;
comment	@# @;
expand	@b@;


1.1
date	2014.11.17.20.52.47;	author afresh1;	state Exp;
branches
	1.1.1.1;
next	;
commitid	B31cAbBIXiCqnL97;

1.1.1.1
date	2014.11.17.20.52.47;	author afresh1;	state Exp;
branches;
next	;
commitid	B31cAbBIXiCqnL97;


desc
@@


1.1
log
@Initial revision
@
text
@#!perl
use strict;
use warnings;

use Test::More 0.88;

use HTTP::Tiny;

# blank slate for testing
delete $ENV{no_proxy};

{
    my $c = HTTP::Tiny->new();
    is_deeply( $c->no_proxy, [], "no no_proxy given" );
}

my @@cases = (
    #<<< No perltidy
    {
        no_proxy => [
            undef,
            [],
        ],
        expect => [],
    },
    {
        no_proxy => [
            "localhost",
            ["localhost"],
        ],
        expect => ["localhost"],
    },
    {
        no_proxy => [
            "localhost,example.com",
            "localhost, example.com",
            [qw/localhost example.com/]
        ],
        expect   => [ "localhost", "example.com" ],
    },
    #>>>
);

for my $c (@@cases) {
    for my $no_proxy ( @@{ $c->{no_proxy} } ) {
        my $label =
           !defined $no_proxy ? 'undef'
          : ref $no_proxy     ? "[qw/@@$no_proxy/]"
          :                     "'$no_proxy'";

        # Can't test environment with array ref (ENV stringifies in new perls)
        if ( ref $no_proxy ) {
            my $ht = HTTP::Tiny->new( no_proxy => $no_proxy );
            is_deeply( $ht->no_proxy, $c->{expect}, "new(no_proxy => $label)" );
        }
        else {
            {
                local $ENV{no_proxy} = $no_proxy;
                my $ht = HTTP::Tiny->new();
                is_deeply( $ht->no_proxy, $c->{expect}, "\$ENV{no_proxy} = $label" );
            }
            {
                local $ENV{no_proxy} = "Shouldnt,see,this";
                my $ht = HTTP::Tiny->new( no_proxy => $no_proxy );
                is_deeply( $ht->no_proxy, $c->{expect},
                    "new(no_proxy => $label) versus other \$ENV{no_proxy}" );
            }
        }
    }
}

done_testing();
@


1.1.1.1
log
@Import perl-5.20.1
@
text
@@
