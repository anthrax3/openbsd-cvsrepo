head	1.1;
branch	1.1.1;
access;
symbols
	OPENBSD_6_2:1.1.1.2.0.8
	OPENBSD_6_2_BASE:1.1.1.2
	PERL_5_24_2:1.1.1.2
	OPENBSD_6_1:1.1.1.2.0.12
	OPENBSD_6_1_BASE:1.1.1.2
	OPENBSD_6_0:1.1.1.2.0.10
	OPENBSD_6_0_BASE:1.1.1.2
	OPENBSD_5_9:1.1.1.2.0.4
	OPENBSD_5_9_BASE:1.1.1.2
	OPENBSD_5_8:1.1.1.2.0.6
	OPENBSD_5_8_BASE:1.1.1.2
	PERL_5_20_2:1.1.1.2
	OPENBSD_5_7:1.1.1.2.0.2
	OPENBSD_5_7_BASE:1.1.1.2
	PERL_5_20_1:1.1.1.2
	OPENBSD_5_6:1.1.1.1.0.18
	OPENBSD_5_6_BASE:1.1.1.1
	PERL_5_18_2:1.1.1.1
	PERL:1.1.1
	OPENBSD_5_5:1.1.1.1.0.16
	OPENBSD_5_5_BASE:1.1.1.1
	OPENBSD_5_4:1.1.1.1.0.12
	OPENBSD_5_4_BASE:1.1.1.1
	PERL_5_16_3:1.1.1.1
	OPENBSD_5_3:1.1.1.1.0.10
	OPENBSD_5_3_BASE:1.1.1.1
	OPENBSD_5_2:1.1.1.1.0.8
	OPENBSD_5_2_BASE:1.1.1.1
	OPENBSD_5_1_BASE:1.1.1.1
	OPENBSD_5_1:1.1.1.1.0.6
	OPENBSD_5_0:1.1.1.1.0.4
	OPENBSD_5_0_BASE:1.1.1.1
	OPENBSD_4_9:1.1.1.1.0.2
	OPENBSD_4_9_BASE:1.1.1.1
	PERL_5_12_2:1.1.1.1
	CPAN:1.1.1;
locks; strict;
comment	@# @;
expand	@o@;


1.1
date	2010.09.24.14.49.00;	author millert;	state Exp;
branches
	1.1.1.1;
next	;

1.1.1.1
date	2010.09.24.14.49.00;	author millert;	state Exp;
branches;
next	1.1.1.2;

1.1.1.2
date	2014.11.17.20.52.59;	author afresh1;	state Exp;
branches;
next	;
commitid	B31cAbBIXiCqnL97;


desc
@@


1.1
log
@Initial revision
@
text
@#!/usr/bin/perl

use strict;
use lib 't/lib';

use Test::More;

use TAP::Parser::YAMLish::Reader;
use TAP::Parser::YAMLish::Writer;

my @@SCHEDULE;

BEGIN {
    @@SCHEDULE = (
        {   name => 'Simple scalar',
            in   => 1,
            out  => [
                '--- 1',
                '...',
            ],
        },
        {   name => 'Undef',
            in   => undef,
            out  => [
                '--- ~',
                '...',
            ],
        },
        {   name => 'Unprintable',
            in   => "\x01\n\t",
            out  => [
                '--- "\x01\n\t"',
                '...',
            ],
        },
        {   name => 'Simple array',
            in   => [ 1, 2, 3 ],
            out  => [
                '---',
                '- 1',
                '- 2',
                '- 3',
                '...',
            ],
        },
        {   name => 'Empty array',
            in   => [],
            out  => [
                '--- []',
                '...'
            ],
        },
        {   name => 'Empty hash',
            in   => {},
            out  => [
                '--- {}',
                '...'
            ],
        },
        {   name => 'Array, two elements, undef',
            in   => [ undef, undef ],
            out  => [
                '---',
                '- ~',
                '- ~',
                '...',
            ],
        },
        {   name => 'Nested array',
            in   => [ 1, 2, [ 3, 4 ], 5 ],
            out  => [
                '---',
                '- 1',
                '- 2',
                '-',
                '  - 3',
                '  - 4',
                '- 5',
                '...',
            ],
        },
        {   name => 'Nested empty',
            in   => [ 1, 2, [], 5 ],
            out  => [
                '---',
                '- 1',
                '- 2',
                '- []',
                '- 5',
                '...',
            ],
        },
        {   name => 'Simple hash',
            in   => { one => '1', two => '2', three => '3' },
            out  => [
                '---',
                'one: 1',
                'three: 3',
                'two: 2',
                '...',
            ],
        },
        {   name => 'Nested hash',
            in   => {
                one => '1', two => '2',
                more => { three => '3', four => '4' }
            },
            out => [
                '---',
                'more:',
                '  four: 4',
                '  three: 3',
                'one: 1',
                'two: 2',
                '...',
            ],
        },
        {   name => 'Nested empty',
            in   => { one => '1', two => '2', more => {} },
            out  => [
                '---',
                'more: {}',
                'one: 1',
                'two: 2',
                '...',
            ],
        },
        {   name => 'Unprintable key',
            in   => { one => '1', "\x02" => '2', three => '3' },
            out  => [
                '---',
                '"\x02": 2',
                'one: 1',
                'three: 3',
                '...',
            ],
        },
        {   name => 'Empty key',
            in   => { '' => 'empty' },
            out  => [
                '---',
                "'': empty",
                '...',
            ],
        },
        {   name => 'Empty value',
            in   => { '' => '' },
            out  => [
                '---',
                "'': ''",
                '...',
            ],
        },
        {   name => 'Funky hash key',
            in   => { './frob' => 'is_frob' },
            out  => [
                '---',
                '"./frob": is_frob',
                '...',
            ]
        },
        {   name => 'Complex',
            in   => {
                'bill-to' => {
                    'given'   => 'Chris',
                    'address' => {
                        'city'   => 'Royal Oak',
                        'postal' => '48046',
                        'lines'  => "458 Walkman Dr.\nSuite #292\n",
                        'state'  => 'MI'
                    },
                    'family' => 'Dumars'
                },
                'invoice' => '34843',
                'date'    => '2001-01-23',
                'tax'     => '251.42',
                'product' => [
                    {   'sku'         => 'BL394D',
                        'quantity'    => '4',
                        'price'       => '450.00',
                        'description' => 'Basketball'
                    },
                    {   'sku'         => 'BL4438H',
                        'quantity'    => '1',
                        'price'       => '2392.00',
                        'description' => 'Super Hoop'
                    }
                ],
                'comments' =>
                  "Late afternoon is best. Backup contact is Nancy Billsmer @@ 338-4338\n",
                'total' => '4443.52'
            },
            out => [
                "---",
                "bill-to:",
                "  address:",
                "    city: \"Royal Oak\"",
                "    lines: \"458 Walkman Dr.\\nSuite #292\\n\"",
                "    postal: 48046",
                "    state: MI",
                "  family: Dumars",
                "  given: Chris",
                "comments: \"Late afternoon is best. Backup contact is Nancy Billsmer \@@ 338-4338\\n\"",
                "date: 2001-01-23",
                "invoice: 34843",
                "product:",
                "  -",
                "    description: Basketball",
                "    price: 450.00",
                "    quantity: 4",
                "    sku: BL394D",
                "  -",
                "    description: \"Super Hoop\"",
                "    price: 2392.00",
                "    quantity: 1",
                "    sku: BL4438H",
                "tax: 251.42",
                "total: 4443.52",
                "...",
            ],
        },
    );

    plan tests => @@SCHEDULE * 6;
}

sub iter {
    my $ar = shift;
    return sub {
        return shift @@$ar;
    };
}

for my $test (@@SCHEDULE) {
    my $name = $test->{name};
    ok my $yaml = TAP::Parser::YAMLish::Writer->new, "$name: Created";
    isa_ok $yaml, 'TAP::Parser::YAMLish::Writer';

    my $got = [];
    my $writer = sub { push @@$got, shift };

    my $data = $test->{in};

    eval { $yaml->write( $data, $writer ) };

    if ( my $err = $test->{error} ) {
        unless ( like $@@, $err, "$name: Error message" ) {
            diag "Error: $@@\n";
        }
        is_deeply $got, [], "$name: No result";
        pass;
    }
    else {
        my $want = $test->{out};
        unless ( ok !$@@, "$name: No error" ) {
            diag "Error: $@@\n";
        }
        unless ( is_deeply $got, $want, "$name: Result matches" ) {
            use Data::Dumper;
            diag Dumper($got);
            diag Dumper($want);
        }

        my $yr = TAP::Parser::YAMLish::Reader->new;

        # Now try parsing it
        my $reader = sub { shift @@$got };
        my $parsed = eval { $yr->read($reader) };
        ok !$@@, "$name: no error" or diag "$@@";

        is_deeply $parsed, $data, "$name: Reparse OK";
    }
}

@


1.1.1.1
log
@Perl 5.12.2 from CPAN
@
text
@@


1.1.1.2
log
@Import perl-5.20.1
@
text
@a3 1
use warnings;
@

