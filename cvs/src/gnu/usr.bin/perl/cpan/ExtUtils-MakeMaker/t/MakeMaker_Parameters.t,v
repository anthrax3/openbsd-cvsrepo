head	1.2;
access;
symbols
	OPENBSD_6_1:1.2.0.2
	OPENBSD_6_1_BASE:1.2
	OPENBSD_6_0:1.1.1.1.0.26
	OPENBSD_6_0_BASE:1.1.1.1
	OPENBSD_5_9:1.1.1.1.0.20
	OPENBSD_5_9_BASE:1.1.1.1
	OPENBSD_5_8:1.1.1.1.0.22
	OPENBSD_5_8_BASE:1.1.1.1
	PERL_5_20_2:1.1.1.1
	OPENBSD_5_7:1.1.1.1.0.14
	OPENBSD_5_7_BASE:1.1.1.1
	PERL_5_20_1:1.1.1.1
	OPENBSD_5_6:1.1.1.1.0.18
	OPENBSD_5_6_BASE:1.1.1.1
	PERL_5_18_2:1.1.1.1
	PERL:1.1.1
	OPENBSD_5_5:1.1.1.1.0.16
	OPENBSD_5_5_BASE:1.1.1.1
	OPENBSD_5_4:1.1.1.1.0.12
	OPENBSD_5_4_BASE:1.1.1.1
	PERL_5_16_3:1.1.1.1
	OPENBSD_5_3:1.1.1.1.0.10
	OPENBSD_5_3_BASE:1.1.1.1
	OPENBSD_5_2:1.1.1.1.0.8
	OPENBSD_5_2_BASE:1.1.1.1
	OPENBSD_5_1_BASE:1.1.1.1
	OPENBSD_5_1:1.1.1.1.0.6
	OPENBSD_5_0:1.1.1.1.0.4
	OPENBSD_5_0_BASE:1.1.1.1
	OPENBSD_4_9:1.1.1.1.0.2
	OPENBSD_4_9_BASE:1.1.1.1
	PERL_5_12_2:1.1.1.1
	CPAN:1.1.1;
locks; strict;
comment	@# @;
expand	@o@;


1.2
date	2017.02.05.00.31.58;	author afresh1;	state Exp;
branches;
next	1.1;
commitid	cxJ08BvJA9Pt2PTM;

1.1
date	2010.09.24.14.48.58;	author millert;	state Exp;
branches
	1.1.1.1;
next	;

1.1.1.1
date	2010.09.24.14.48.58;	author millert;	state Exp;
branches;
next	;


desc
@@


1.2
log
@Fix merge issues, remove excess files - match perl-5.24.1 dist
@
text
@#!/usr/bin/perl -w

# Things like the CPAN shell rely on the "MakeMaker Parameters" section of the
# Makefile to learn a module's dependencies so we'd damn well better test it.

BEGIN {
    unshift @@INC, 't/lib';
}

use strict;
use warnings;

use ExtUtils::MakeMaker;
use Test::More;

my $mm = bless {}, "MM";

sub process_cmp {
  my ($args, $expected, $label) = @@_;
  my $got = join '',
    map "$_\n", $mm->_MakeMaker_Parameters_section($args || ());
  $got =~ s/^#\s*MakeMaker Parameters:\n+//;
  is $got, $expected, $label;
}

process_cmp undef, '', 'nothing';
process_cmp { NAME => "Foo" }, <<'EXPECT', "name only";
#     NAME => q[Foo]
EXPECT
process_cmp
  { NAME => "Foo", PREREQ_PM => { "Foo::Bar" => 0 } }, <<'EXPECT', "PREREQ v0";
#     NAME => q[Foo]
#     PREREQ_PM => { Foo::Bar=>q[0] }
EXPECT
process_cmp
  { NAME => "Foo", PREREQ_PM => { "Foo::Bar" => 1.23 } },
  <<'EXPECT', "PREREQ v-non-0";
#     NAME => q[Foo]
#     PREREQ_PM => { Foo::Bar=>q[1.23] }
EXPECT

process_cmp
  {
    NAME                => "Foo",
    PREREQ_PM           => { "Foo::Bar" => 1.23 },
    BUILD_REQUIRES      => { "Baz"      => 0.12 },
  },
  <<'EXPECT', "BUILD_REQUIRES";
#     BUILD_REQUIRES => { Baz=>q[0.12] }
#     NAME => q[Foo]
#     PREREQ_PM => { Baz=>q[0.12], Foo::Bar=>q[1.23] }
EXPECT

process_cmp
  {
    NAME                => "Foo",
    PREREQ_PM           => { "Foo::Bar" => 1.23, Long => 1.45, Short => 0 },
    BUILD_REQUIRES      => { "Baz"      => 0.12 },
  },
  <<'EXPECT', "ensure sorting";
#     BUILD_REQUIRES => { Baz=>q[0.12] }
#     NAME => q[Foo]
#     PREREQ_PM => { Baz=>q[0.12], Foo::Bar=>q[1.23], Long=>q[1.45], Short=>q[0] }
EXPECT

done_testing();
@


1.1
log
@Initial revision
@
text
@d18 6
a23 9
sub extract_params {
    my $text = join "\n", @@_;

    $text =~ s{^\s* \# \s+ MakeMaker\ Parameters: \s*\n}{}x;
    $text =~ s{^#}{}gms;
    $text =~ s{\n}{,\n}g;

    no strict 'subs';
    return { eval "$text" };
d26 15
a40 3
sub test_round_trip {
    my $args = shift;
    my $want = @@_ ? shift : $args;
d42 11
a52 5
    my $have = extract_params($mm->_MakeMaker_Parameters_section($args));

    local $Test::Builder::Level = $Test::Builder::Level + 1;
    is_deeply $have, $want or diag explain $have, "\n", $want;
}
d54 10
a63 2
is join("", $mm->_MakeMaker_Parameters_section()), <<'EXPECT', "nothing";
#   MakeMaker Parameters:
a65 24
test_round_trip({ NAME => "Foo" });
test_round_trip({ NAME => "Foo", PREREQ_PM => { "Foo::Bar" => 0 } });
test_round_trip({ NAME => "Foo", PREREQ_PM => { "Foo::Bar" => 1.23 } });

# Test the special case for BUILD_REQUIRES
{
    my $have = {
        NAME                => "Foo",
        PREREQ_PM           => { "Foo::Bar" => 1.23 },
        BUILD_REQUIRES      => { "Baz"      => 0.12 },
    };

    my $want = {
        NAME                => "Foo",
        PREREQ_PM           => {
            "Foo::Bar"  => 1.23,
            "Baz"       => 0.12,
        },
        BUILD_REQUIRES      => { "Baz"      => 0.12 },
    };

    test_round_trip( $have, $want );
}

a66 1

@


1.1.1.1
log
@Perl 5.12.2 from CPAN
@
text
@@
