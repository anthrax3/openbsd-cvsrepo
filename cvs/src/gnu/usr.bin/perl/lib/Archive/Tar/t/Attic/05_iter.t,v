head	1.2;
access;
symbols
	OPENBSD_4_8:1.1.1.1.0.4
	OPENBSD_4_8_BASE:1.1.1.1
	OPENBSD_4_7:1.1.1.1.0.2
	OPENBSD_4_7_BASE:1.1.1.1
	PERL_5_10_1:1.1.1.1
	CPAN:1.1.1;
locks; strict;
comment	@# @;


1.2
date	2010.09.24.14.59.34;	author millert;	state dead;
branches;
next	1.1;

1.1
date	2009.10.12.18.11.01;	author millert;	state Exp;
branches
	1.1.1.1;
next	;

1.1.1.1
date	2009.10.12.18.11.01;	author millert;	state Exp;
branches;
next	;


desc
@@


1.2
log
@remove files no longer in perl 5.12.2 (or that have moved)
@
text
@BEGIN {
    if( $ENV{PERL_CORE} ) {
        chdir '../lib/Archive/Tar' if -d '../lib/Archive/Tar';
    }       
    use lib '../../..';
}

BEGIN { chdir 't' if -d 't' }

use Test::More 'no_plan';
use strict;
use lib '../lib';

my $Class   = 'Archive::Tar';
my $FClass  = 'Archive::Tar::File';
my $File    = 'src/long/bar.tar';
my @@Expect = (
    qr|^c$|,
    qr|^d$|,
    qr|^directory/$|,
    qr|^directory/really.*name/$|,
    qr|^directory/.*/myfile$|,
);

use_ok( $Class );

### crazy ref to special case 'all'
for my $index ( \0, 0 .. $#Expect ) {   

    my %opts    = ();
    my @@expect  = ();
    
    ### do a full test vs individual filters
    if( not ref $index ) {
        my $regex       = $Expect[$index];
        $opts{'filter'} = $regex;
        @@expect         = ($regex);
    } else {
        @@expect         = @@Expect;
    }        

    my $next = $Class->iter( $File, 0, \%opts );
    
    my $pp_opts = join " => ", %opts;
    ok( $next,                  "Iterator created from $File ($pp_opts)" );
    isa_ok( $next, "CODE",      "   Iterator" );

    my @@names;
    while( my $f = $next->() ) {
        ok( $f,                 "       File object retrieved" );
        isa_ok( $f, $FClass,    "           Object" );

        push @@names, $f->name;
    }
    
    is( scalar(@@names), scalar(@@expect),
                                "   Found correct number of files" );
    
    my $i = 0;
    for my $name ( @@names ) {
        ok( 1,                  "   Inspecting '$name' " );
        like($name, $expect[$i],"       Matches $Expect[$i]" );
        $i++;
    }        
}
@


1.1
log
@Initial revision
@
text
@@


1.1.1.1
log
@import perl 5.10.1
@
text
@@
