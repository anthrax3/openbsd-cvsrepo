head	1.9;
access;
symbols
	OPENBSD_4_8:1.8.0.4
	OPENBSD_4_8_BASE:1.8
	OPENBSD_4_7:1.8.0.2
	OPENBSD_4_7_BASE:1.8
	PERL_5_10_1:1.1.1.7
	OPENBSD_4_6:1.7.0.6
	OPENBSD_4_6_BASE:1.7
	OPENBSD_4_5:1.7.0.2
	OPENBSD_4_5_BASE:1.7
	PERL_5_10_0:1.1.1.6
	OPENBSD_4_4:1.6.0.24
	OPENBSD_4_4_BASE:1.6
	OPENBSD_4_3:1.6.0.22
	OPENBSD_4_3_BASE:1.6
	OPENBSD_4_2:1.6.0.20
	OPENBSD_4_2_BASE:1.6
	OPENBSD_4_1:1.6.0.18
	OPENBSD_4_1_BASE:1.6
	OPENBSD_4_0:1.6.0.16
	OPENBSD_4_0_BASE:1.6
	PERL_5_8_8:1.1.1.5
	OPENBSD_3_9:1.6.0.14
	OPENBSD_3_9_BASE:1.6
	OPENBSD_3_8:1.6.0.12
	OPENBSD_3_8_BASE:1.6
	OPENBSD_3_7:1.6.0.10
	OPENBSD_3_7_BASE:1.6
	PERL_5_8_6:1.1.1.5
	OPENBSD_3_6:1.6.0.8
	OPENBSD_3_6_BASE:1.6
	PERL_5_8_5:1.1.1.5
	PERL_5_8_3:1.1.1.5
	OPENBSD_3_5:1.6.0.6
	OPENBSD_3_5_BASE:1.6
	PERL_5_8_2:1.1.1.5
	OPENBSD_3_4:1.6.0.4
	OPENBSD_3_4_BASE:1.6
	OPENBSD_3_3:1.6.0.2
	OPENBSD_3_3_BASE:1.6
	PERL_5_8_0:1.1.1.5
	OPENBSD_3_2:1.5.0.6
	OPENBSD_3_2_BASE:1.5
	OPENBSD_3_1:1.5.0.4
	OPENBSD_3_1_BASE:1.5
	OPENBSD_3_0:1.5.0.2
	OPENBSD_3_0_BASE:1.5
	PERL_5_6_1:1.1.1.4
	OPENBSD_2_9:1.4.0.6
	OPENBSD_2_9_BASE:1.4
	OPENBSD_2_8:1.4.0.4
	OPENBSD_2_8_BASE:1.4
	OPENBSD_2_7:1.4.0.2
	OPENBSD_2_7_BASE:1.4
	PERL_5_6_0:1.1.1.3
	OPENBSD_2_6:1.3.0.2
	OPENBSD_2_6_BASE:1.3
	PERL_500503:1.1.1.2
	CPAN:1.1.1
	OPENBSD_2_5:1.2.0.6
	OPENBSD_2_5_BASE:1.2
	OPENBSD_2_4:1.2.0.4
	OPENBSD_2_4_BASE:1.2
	OPENBSD_2_3:1.2.0.2
	OPENBSD_2_3_BASE:1.2
	OPENBSD_2_2:1.1.1.1.0.6
	OPENBSD_2_2_BASE:1.1.1.1
	OPENBSD_2_1:1.1.1.1.0.4
	OPENBSD_2_1_BASE:1.1.1.1
	OPENBSD_2_0:1.1.1.1.0.2
	OPENBSD_2_0_BASE:1.1.1.1
	perl5003:1.1.1.1
	lwall:1.1.1;
locks; strict;
comment	@# @;


1.9
date	2010.09.24.14.59.38;	author millert;	state dead;
branches;
next	1.8;

1.8
date	2009.10.12.18.24.40;	author millert;	state Exp;
branches;
next	1.7;

1.7
date	2008.09.29.17.36.11;	author millert;	state Exp;
branches;
next	1.6;

1.6
date	2002.10.27.22.25.26;	author millert;	state Exp;
branches;
next	1.5;

1.5
date	2001.05.24.18.35.30;	author millert;	state Exp;
branches;
next	1.4;

1.4
date	2000.04.06.17.06.32;	author millert;	state Exp;
branches;
next	1.3;

1.3
date	99.04.29.22.51.53;	author millert;	state Exp;
branches;
next	1.2;

1.2
date	97.11.30.07.57.32;	author millert;	state Exp;
branches;
next	1.1;

1.1
date	96.08.19.10.12.42;	author downsj;	state Exp;
branches
	1.1.1.1;
next	;

1.1.1.1
date	96.08.19.10.12.42;	author downsj;	state Exp;
branches;
next	1.1.1.2;

1.1.1.2
date	99.04.29.22.40.07;	author millert;	state Exp;
branches;
next	1.1.1.3;

1.1.1.3
date	2000.04.06.16.09.43;	author millert;	state Exp;
branches;
next	1.1.1.4;

1.1.1.4
date	2001.05.24.18.23.29;	author millert;	state Exp;
branches;
next	1.1.1.5;

1.1.1.5
date	2002.10.27.22.14.59;	author millert;	state Exp;
branches;
next	1.1.1.6;

1.1.1.6
date	2008.09.29.17.18.33;	author millert;	state Exp;
branches;
next	1.1.1.7;

1.1.1.7
date	2009.10.12.18.10.50;	author millert;	state Exp;
branches;
next	;


desc
@@


1.9
log
@remove files no longer in perl 5.12.2 (or that have moved)
@
text
@package ExtUtils::Mksymlists;

use 5.006;
use strict qw[ subs refs ];
# no strict 'vars';  # until filehandles are exempted

use Carp;
use Exporter;
use Config;

our @@ISA = qw(Exporter);
our @@EXPORT = qw(&Mksymlists);
our $VERSION = '6.55_02';

sub Mksymlists {
    my(%spec) = @@_;
    my($osname) = $^O;

    croak("Insufficient information specified to Mksymlists")
        unless ( $spec{NAME} or
                 ($spec{FILE} and ($spec{DL_FUNCS} or $spec{FUNCLIST})) );

    $spec{DL_VARS} = [] unless $spec{DL_VARS};
    ($spec{FILE} = $spec{NAME}) =~ s/.*::// unless $spec{FILE};
    $spec{FUNCLIST} = [] unless $spec{FUNCLIST};
    $spec{DL_FUNCS} = { $spec{NAME} => [] }
        unless ( ($spec{DL_FUNCS} and keys %{$spec{DL_FUNCS}}) or
                 @@{$spec{FUNCLIST}});
    if (defined $spec{DL_FUNCS}) {
        foreach my $package (keys %{$spec{DL_FUNCS}}) {
            my($packprefix,$bootseen);
            ($packprefix = $package) =~ s/\W/_/g;
            foreach my $sym (@@{$spec{DL_FUNCS}->{$package}}) {
                if ($sym =~ /^boot_/) {
                    push(@@{$spec{FUNCLIST}},$sym);
                    $bootseen++;
                }
                else {
                    push(@@{$spec{FUNCLIST}},"XS_${packprefix}_$sym");
                }
            }
            push(@@{$spec{FUNCLIST}},"boot_$packprefix") unless $bootseen;
        }
    }

#    We'll need this if we ever add any OS which uses mod2fname
#    not as pseudo-builtin.
#    require DynaLoader;
    if (defined &DynaLoader::mod2fname and not $spec{DLBASE}) {
        $spec{DLBASE} = DynaLoader::mod2fname([ split(/::/,$spec{NAME}) ]);
    }

    if    ($osname eq 'aix') { _write_aix(\%spec); }
    elsif ($osname eq 'MacOS'){ _write_aix(\%spec) }
    elsif ($osname eq 'VMS') { _write_vms(\%spec) }
    elsif ($osname eq 'os2') { _write_os2(\%spec) }
    elsif ($osname eq 'MSWin32') { _write_win32(\%spec) }
    else {
        croak("Don't know how to create linker option file for $osname\n");
    }
}


sub _write_aix {
    my($data) = @@_;

    rename "$data->{FILE}.exp", "$data->{FILE}.exp_old";

    open( my $exp, ">", "$data->{FILE}.exp")
        or croak("Can't create $data->{FILE}.exp: $!\n");
    print $exp join("\n",@@{$data->{DL_VARS}}, "\n") if @@{$data->{DL_VARS}};
    print $exp join("\n",@@{$data->{FUNCLIST}}, "\n") if @@{$data->{FUNCLIST}};
    close $exp;
}


sub _write_os2 {
    my($data) = @@_;
    require Config;
    my $threaded = ($Config::Config{archname} =~ /-thread/ ? " threaded" : "");

    if (not $data->{DLBASE}) {
        ($data->{DLBASE} = $data->{NAME}) =~ s/.*:://;
        $data->{DLBASE} = substr($data->{DLBASE},0,7) . '_';
    }
    my $distname = $data->{DISTNAME} || $data->{NAME};
    $distname = "Distribution $distname";
    my $patchlevel = " pl$Config{perl_patchlevel}" || '';
    my $comment = sprintf "Perl (v%s%s%s) module %s", 
      $Config::Config{version}, $threaded, $patchlevel, $data->{NAME};
    chomp $comment;
    if ($data->{INSTALLDIRS} and $data->{INSTALLDIRS} eq 'perl') {
        $distname = 'perl5-porters@@perl.org';
        $comment = "Core $comment";
    }
    $comment = "$comment (Perl-config: $Config{config_args})";
    $comment = substr($comment, 0, 200) . "...)" if length $comment > 203;
    rename "$data->{FILE}.def", "$data->{FILE}_def.old";

    open(my $def, ">", "$data->{FILE}.def")
        or croak("Can't create $data->{FILE}.def: $!\n");
    print $def "LIBRARY '$data->{DLBASE}' INITINSTANCE TERMINSTANCE\n";
    print $def "DESCRIPTION '\@@#$distname:$data->{VERSION}#\@@ $comment'\n";
    print $def "CODE LOADONCALL\n";
    print $def "DATA LOADONCALL NONSHARED MULTIPLE\n";
    print $def "EXPORTS\n  ";
    print $def join("\n  ",@@{$data->{DL_VARS}}, "\n") if @@{$data->{DL_VARS}};
    print $def join("\n  ",@@{$data->{FUNCLIST}}, "\n") if @@{$data->{FUNCLIST}};
    if (%{$data->{IMPORTS}}) {
        print $def "IMPORTS\n";
        my ($name, $exp);
        while (($name, $exp)= each %{$data->{IMPORTS}}) {
            print $def "  $name=$exp\n";
        }
    }
    close $def;
}

sub _write_win32 {
    my($data) = @@_;

    require Config;
    if (not $data->{DLBASE}) {
        ($data->{DLBASE} = $data->{NAME}) =~ s/.*:://;
        $data->{DLBASE} = substr($data->{DLBASE},0,7) . '_';
    }
    rename "$data->{FILE}.def", "$data->{FILE}_def.old";

    open( my $def, ">", "$data->{FILE}.def" )
        or croak("Can't create $data->{FILE}.def: $!\n");
    # put library name in quotes (it could be a keyword, like 'Alias')
    if ($Config::Config{'cc'} !~ /^gcc/i) {
        print $def "LIBRARY \"$data->{DLBASE}\"\n";
    }
    print $def "EXPORTS\n  ";
    my @@syms;
    # Export public symbols both with and without underscores to
    # ensure compatibility between DLLs from different compilers
    # NOTE: DynaLoader itself only uses the names without underscores,
    # so this is only to cover the case when the extension DLL may be
    # linked to directly from C. GSAR 97-07-10
    if ($Config::Config{'cc'} =~ /^bcc/i) {
        for (@@{$data->{DL_VARS}}, @@{$data->{FUNCLIST}}) {
            push @@syms, "_$_", "$_ = _$_";
        }
    }
    else {
        for (@@{$data->{DL_VARS}}, @@{$data->{FUNCLIST}}) {
            push @@syms, "$_", "_$_ = $_";
        }
    }
    print $def join("\n  ",@@syms, "\n") if @@syms;
    if (%{$data->{IMPORTS}}) {
        print $def "IMPORTS\n";
        my ($name, $exp);
        while (($name, $exp)= each %{$data->{IMPORTS}}) {
            print $def "  $name=$exp\n";
        }
    }
    close $def;
}


sub _write_vms {
    my($data) = @@_;

    require Config; # a reminder for once we do $^O
    require ExtUtils::XSSymSet;

    my($isvax) = $Config::Config{'archname'} =~ /VAX/i;
    my($set) = new ExtUtils::XSSymSet;

    rename "$data->{FILE}.opt", "$data->{FILE}.opt_old";

    open(my $opt,">", "$data->{FILE}.opt")
        or croak("Can't create $data->{FILE}.opt: $!\n");

    # Options file declaring universal symbols
    # Used when linking shareable image for dynamic extension,
    # or when linking PerlShr into which we've added this package
    # as a static extension
    # We don't do anything to preserve order, so we won't relax
    # the GSMATCH criteria for a dynamic extension

    print $opt "case_sensitive=yes\n"
        if $Config::Config{d_vms_case_sensitive_symbols};

    foreach my $sym (@@{$data->{FUNCLIST}}) {
        my $safe = $set->addsym($sym);
        if ($isvax) { print $opt "UNIVERSAL=$safe\n" }
        else        { print $opt "SYMBOL_VECTOR=($safe=PROCEDURE)\n"; }
    }

    foreach my $sym (@@{$data->{DL_VARS}}) {
        my $safe = $set->addsym($sym);
        print $opt "PSECT_ATTR=${sym},PIC,OVR,RD,NOEXE,WRT,NOSHR\n";
        if ($isvax) { print $opt "UNIVERSAL=$safe\n" }
        else        { print $opt "SYMBOL_VECTOR=($safe=DATA)\n"; }
    }
    
    close $opt;
}

1;

__END__

=head1 NAME

ExtUtils::Mksymlists - write linker options files for dynamic extension

=head1 SYNOPSIS

    use ExtUtils::Mksymlists;
    Mksymlists({ NAME     => $name ,
                 DL_VARS  => [ $var1, $var2, $var3 ],
                 DL_FUNCS => { $pkg1 => [ $func1, $func2 ],
                               $pkg2 => [ $func3 ] });

=head1 DESCRIPTION

C<ExtUtils::Mksymlists> produces files used by the linker under some OSs
during the creation of shared libraries for dynamic extensions.  It is
normally called from a MakeMaker-generated Makefile when the extension
is built.  The linker option file is generated by calling the function
C<Mksymlists>, which is exported by default from C<ExtUtils::Mksymlists>.
It takes one argument, a list of key-value pairs, in which the following
keys are recognized:

=over 4

=item DLBASE

This item specifies the name by which the linker knows the
extension, which may be different from the name of the
extension itself (for instance, some linkers add an '_' to the
name of the extension).  If it is not specified, it is derived
from the NAME attribute.  It is presently used only by OS2 and Win32.

=item DL_FUNCS

This is identical to the DL_FUNCS attribute available via MakeMaker,
from which it is usually taken.  Its value is a reference to an
associative array, in which each key is the name of a package, and
each value is an a reference to an array of function names which
should be exported by the extension.  For instance, one might say
C<DL_FUNCS =E<gt> { Homer::Iliad =E<gt> [ qw(trojans greeks) ],
Homer::Odyssey =E<gt> [ qw(travellers family suitors) ] }>.  The
function names should be identical to those in the XSUB code;
C<Mksymlists> will alter the names written to the linker option
file to match the changes made by F<xsubpp>.  In addition, if
none of the functions in a list begin with the string B<boot_>,
C<Mksymlists> will add a bootstrap function for that package,
just as xsubpp does.  (If a B<boot_E<lt>pkgE<gt>> function is
present in the list, it is passed through unchanged.)  If
DL_FUNCS is not specified, it defaults to the bootstrap
function for the extension specified in NAME.

=item DL_VARS

This is identical to the DL_VARS attribute available via MakeMaker,
and, like DL_FUNCS, it is usually specified via MakeMaker.  Its
value is a reference to an array of variable names which should
be exported by the extension.

=item FILE

This key can be used to specify the name of the linker option file
(minus the OS-specific extension), if for some reason you do not
want to use the default value, which is the last word of the NAME
attribute (I<e.g.> for C<Tk::Canvas>, FILE defaults to C<Canvas>).

=item FUNCLIST

This provides an alternate means to specify function names to be
exported from the extension.  Its value is a reference to an
array of function names to be exported by the extension.  These
names are passed through unaltered to the linker options file.
Specifying a value for the FUNCLIST attribute suppresses automatic
generation of the bootstrap function for the package. To still create
the bootstrap name you have to specify the package name in the
DL_FUNCS hash:

    Mksymlists({ NAME     => $name ,
		 FUNCLIST => [ $func1, $func2 ],
                 DL_FUNCS => { $pkg => [] } });


=item IMPORTS

This attribute is used to specify names to be imported into the
extension. It is currently only used by OS/2 and Win32.

=item NAME

This gives the name of the extension (I<e.g.> C<Tk::Canvas>) for which
the linker option file will be produced.

=back

When calling C<Mksymlists>, one should always specify the NAME
attribute.  In most cases, this is all that's necessary.  In
the case of unusual extensions, however, the other attributes
can be used to provide additional information to the linker.

=head1 AUTHOR

Charles Bailey I<E<lt>bailey@@newman.upenn.eduE<gt>>

=head1 REVISION

Last revised 14-Feb-1996, for Perl 5.002.
@


1.8
log
@Merge in perl 5.10.1
@
text
@@


1.7
log
@fix conflicts and merge in local changes to perl 5.10.0
@
text
@d3 1
a3 1
use 5.00503;
d11 3
a13 4
use vars qw(@@ISA @@EXPORT $VERSION);
@@ISA = 'Exporter';
@@EXPORT = '&Mksymlists';
$VERSION = '6.42';
d30 2
a31 3
        my($package);
        foreach $package (keys %{$spec{DL_FUNCS}}) {
            my($packprefix,$sym,$bootseen);
d33 1
a33 1
            foreach $sym (@@{$spec{DL_FUNCS}->{$package}}) {
d38 3
a40 1
                else { push(@@{$spec{FUNCLIST}},"XS_${packprefix}_$sym"); }
d58 3
a60 1
    else { croak("Don't know how to create linker option file for $osname\n"); }
d69 1
a69 1
    open(EXP,">$data->{FILE}.exp")
d71 3
a73 3
    print EXP join("\n",@@{$data->{DL_VARS}}, "\n") if @@{$data->{DL_VARS}};
    print EXP join("\n",@@{$data->{FUNCLIST}}, "\n") if @@{$data->{FUNCLIST}};
    close EXP;
d93 2
a94 2
	$distname = 'perl5-porters@@perl.org';
	$comment = "Core $comment";
d100 1
a100 1
    open(DEF,">$data->{FILE}.def")
d102 7
a108 7
    print DEF "LIBRARY '$data->{DLBASE}' INITINSTANCE TERMINSTANCE\n";
    print DEF "DESCRIPTION '\@@#$distname:$data->{VERSION}#\@@ $comment'\n";
    print DEF "CODE LOADONCALL\n";
    print DEF "DATA LOADONCALL NONSHARED MULTIPLE\n";
    print DEF "EXPORTS\n  ";
    print DEF join("\n  ",@@{$data->{DL_VARS}}, "\n") if @@{$data->{DL_VARS}};
    print DEF join("\n  ",@@{$data->{FUNCLIST}}, "\n") if @@{$data->{FUNCLIST}};
d110 5
a114 5
        print DEF "IMPORTS\n";
	my ($name, $exp);
	while (($name, $exp)= each %{$data->{IMPORTS}}) {
	    print DEF "  $name=$exp\n";
	}
d116 1
a116 1
    close DEF;
d129 1
a129 1
    open(DEF,">$data->{FILE}.def")
d133 1
a133 1
      print DEF "LIBRARY \"$data->{DLBASE}\"\n";
d135 1
a135 1
    print DEF "EXPORTS\n  ";
d143 3
a145 3
	for (@@{$data->{DL_VARS}}, @@{$data->{FUNCLIST}}) {
	    push @@syms, "_$_", "$_ = _$_";
	}
d148 3
a150 3
	for (@@{$data->{DL_VARS}}, @@{$data->{FUNCLIST}}) {
	    push @@syms, "$_", "_$_ = $_";
	}
d152 1
a152 1
    print DEF join("\n  ",@@syms, "\n") if @@syms;
d154 1
a154 1
        print DEF "IMPORTS\n";
d157 1
a157 1
            print DEF "  $name=$exp\n";
d160 1
a160 1
    close DEF;
a171 1
    my($sym);
d175 1
a175 1
    open(OPT,">$data->{FILE}.opt")
d185 1
a185 1
    print OPT "case_sensitive=yes\n"
d187 2
a188 1
    foreach $sym (@@{$data->{FUNCLIST}}) {
d190 2
a191 2
        if ($isvax) { print OPT "UNIVERSAL=$safe\n" }
        else        { print OPT "SYMBOL_VECTOR=($safe=PROCEDURE)\n"; }
d193 2
a194 1
    foreach $sym (@@{$data->{DL_VARS}}) {
d196 3
a198 3
        print OPT "PSECT_ATTR=${sym},PIC,OVR,RD,NOEXE,WRT,NOSHR\n";
        if ($isvax) { print OPT "UNIVERSAL=$safe\n" }
        else        { print OPT "SYMBOL_VECTOR=($safe=DATA)\n"; }
d200 2
a201 2
    close OPT;

@


1.6
log
@Resolve conflicts, remove old files, merge local changes
@
text
@d14 1
a14 1
$VERSION = 1.19;
@


1.5
log
@merge in perl 5.6.1 with our local changes
@
text
@d3 1
a3 1
use 5.005_64;
d9 3
a11 1
our(@@ISA, @@EXPORT, $VERSION);
d14 1
a14 1
$VERSION = substr q$Revision: 1.17 $, 10;
d86 4
a89 1
    my $comment = "Perl (v$Config::Config{version}$threaded) module $data->{NAME}";
d94 2
d227 1
a227 1
=over
@


1.4
log
@perl-5.6.0 + local changes
@
text
@d52 1
@


1.3
log
@perl5.005_03 (stock)
@
text
@d2 2
d9 1
a9 1
use vars qw( @@ISA @@EXPORT $VERSION );
d81 7
d93 1
a93 1
    print DEF "DESCRIPTION 'Perl (v$]$threaded) module $data->{NAME} v$data->{VERSION}'\n";
d160 1
a160 1
    my($isvax) = $Config::Config{'arch'} =~ /VAX/i;
d176 2
@


1.2
log
@perl 5.004_04
@
text
@d10 1
a10 1
$VERSION = substr q$Revision: 1.16 $, 10;
d22 1
d25 1
a25 2
                 $spec{FUNCLIST});
    $spec{FUNCLIST} = [] unless $spec{FUNCLIST};
d72 2
d84 1
d92 4
a95 4
my ($name, $exp);
while (($name, $exp)= each %{$data->{IMPORTS}}) {
  print DEF "  $name=$exp\n";
}
d113 3
a115 3
    print DEF "LIBRARY \"$data->{DLBASE}\"\n";
    print DEF "CODE LOADONCALL\n";
    print DEF "DATA LOADONCALL NONSHARED MULTIPLE\n";
a179 7
    # Options file specifying RTLs to which this extension must be linked.
    # Eventually, the list of libraries will be supplied by a working
    # extliblist routine.
    open OPT,'>rtls.opt';
    print OPT "PerlShr/Share\n";
    foreach $rtl (split(/\s+/,$Config::Config{'libs'})) { print OPT "$rtl\n"; }
    close OPT;
d210 1
a210 1
=item NAME
d212 5
a216 2
This gives the name of the extension (I<e.g.> Tk::Canvas) for which
the linker option file will be produced.
d225 1
a225 1
C<DL_FUNCS =E<gt> { Homer::Iliad   =E<gt> [ qw(trojans greeks) ],
d249 1
a249 1
attribute (I<e.g.> for Tk::Canvas, FILE defaults to 'Canvas').
d257 14
d272 1
a272 1
=item DLBASE
d274 2
a275 5
This item specifies the name by which the linker knows the
extension, which may be different from the name of the
extension itself (for instance, some linkers add an '_' to the
name of the extension).  If it is not specified, it is derived
from the NAME attribute.  It is presently used only by OS2.
d286 1
a286 1
Charles Bailey I<E<lt>bailey@@genetics.upenn.eduE<gt>>
@


1.1
log
@Initial revision
@
text
@d10 1
a10 1
$VERSION = '1.03';
d43 1
d51 2
a52 1
    elsif ($osname =~ m|^os/?2$|i) { _write_os2(\%spec) }
d97 44
d146 1
d149 1
d165 3
a167 2
        if ($isvax) { print OPT "UNIVERSAL=$sym\n" }
        else        { print OPT "SYMBOL_VECTOR=($sym=PROCEDURE)\n"; }
d170 1
d172 2
a173 2
        if ($isvax) { print OPT "UNIVERSAL=$sym\n" }
        else        { print OPT "SYMBOL_VECTOR=($sym=DATA)\n"; }
d205 1
a205 1
during the creation of shared libraries for synamic extensions.  It is
d212 2
d266 2
@


1.1.1.1
log
@Import of Perl 5.003 into the tree.  Makefile.bsd-wrapper and
config.sh.OpenBSD are the only local changes.
@
text
@@


1.1.1.2
log
@perl5.005_03
@
text
@d10 1
a10 1
$VERSION = substr q$Revision: 1.17 $, 10;
a21 1
    $spec{FUNCLIST} = [] unless $spec{FUNCLIST};
d24 2
a25 1
                 @@{$spec{FUNCLIST}});
a42 1
#    not as pseudo-builtin.
d50 1
a50 2
    elsif ($osname eq 'os2') { _write_os2(\%spec) }
    elsif ($osname eq 'MSWin32') { _write_win32(\%spec) }
a69 2
    require Config;
    my $threaded = ($Config::Config{archname} =~ /-thread/ ? " threaded" : "");
a79 1
    print DEF "DESCRIPTION 'Perl (v$]$threaded) module $data->{NAME} v$data->{VERSION}'\n";
d87 3
a89 6
	my ($name, $exp);
	while (($name, $exp)= each %{$data->{IMPORTS}}) {
	    print DEF "  $name=$exp\n";
	}
    }
    close DEF;
a90 41

sub _write_win32 {
    my($data) = @@_;

    require Config;
    if (not $data->{DLBASE}) {
        ($data->{DLBASE} = $data->{NAME}) =~ s/.*:://;
        $data->{DLBASE} = substr($data->{DLBASE},0,7) . '_';
    }
    rename "$data->{FILE}.def", "$data->{FILE}_def.old";

    open(DEF,">$data->{FILE}.def")
        or croak("Can't create $data->{FILE}.def: $!\n");
    # put library name in quotes (it could be a keyword, like 'Alias')
    if ($Config::Config{'cc'} !~ /^gcc/i) {
      print DEF "LIBRARY \"$data->{DLBASE}\"\n";
    }
    print DEF "EXPORTS\n  ";
    my @@syms;
    # Export public symbols both with and without underscores to
    # ensure compatibility between DLLs from different compilers
    # NOTE: DynaLoader itself only uses the names without underscores,
    # so this is only to cover the case when the extension DLL may be
    # linked to directly from C. GSAR 97-07-10
    if ($Config::Config{'cc'} =~ /^bcc/i) {
	for (@@{$data->{DL_VARS}}, @@{$data->{FUNCLIST}}) {
	    push @@syms, "_$_", "$_ = _$_";
	}
    }
    else {
	for (@@{$data->{DL_VARS}}, @@{$data->{FUNCLIST}}) {
	    push @@syms, "$_", "_$_ = $_";
	}
    }
    print DEF join("\n  ",@@syms, "\n") if @@syms;
    if (%{$data->{IMPORTS}}) {
        print DEF "IMPORTS\n";
        my ($name, $exp);
        while (($name, $exp)= each %{$data->{IMPORTS}}) {
            print DEF "  $name=$exp\n";
        }
a99 1
    require ExtUtils::XSSymSet;
a101 1
    my($set) = new ExtUtils::XSSymSet;
d117 2
a118 3
        my $safe = $set->addsym($sym);
        if ($isvax) { print OPT "UNIVERSAL=$safe\n" }
        else        { print OPT "SYMBOL_VECTOR=($safe=PROCEDURE)\n"; }
a120 1
        my $safe = $set->addsym($sym);
d122 2
a123 2
        if ($isvax) { print OPT "UNIVERSAL=$safe\n" }
        else        { print OPT "SYMBOL_VECTOR=($safe=DATA)\n"; }
d127 7
d155 1
a155 1
during the creation of shared libraries for dynamic extensions.  It is
d162 1
a162 1
=over
d164 2
a165 7
=item DLBASE

This item specifies the name by which the linker knows the
extension, which may be different from the name of the
extension itself (for instance, some linkers add an '_' to the
name of the extension).  If it is not specified, it is derived
from the NAME attribute.  It is presently used only by OS2 and Win32.
d174 1
a174 1
C<DL_FUNCS =E<gt> { Homer::Iliad =E<gt> [ qw(trojans greeks) ],
d198 1
a198 1
attribute (I<e.g.> for C<Tk::Canvas>, FILE defaults to C<Canvas>).
a205 4
Specifying a value for the FUNCLIST attribute suppresses automatic
generation of the bootstrap function for the package. To still create
the bootstrap name you have to specify the package name in the
DL_FUNCS hash:
d207 1
a207 3
    Mksymlists({ NAME     => $name ,
		 FUNCLIST => [ $func1, $func2 ],
                 DL_FUNCS => { $pkg => [] } });
d209 5
a213 12

=item IMPORTS

This attribute is used to specify names to be imported into the
extension. It is currently only used by OS/2 and Win32.

=item NAME

This gives the name of the extension (I<e.g.> C<Tk::Canvas>) for which
the linker option file will be produced.

=back
d222 1
a222 1
Charles Bailey I<E<lt>bailey@@newman.upenn.eduE<gt>>
@


1.1.1.3
log
@virgin perl 5.6.0
@
text
@a1 2

use 5.005_64;
d7 1
a7 1
our(@@ISA, @@EXPORT, $VERSION);
a78 7
    my $distname = $data->{DISTNAME} || $data->{NAME};
    $distname = "Distribution $distname";
    my $comment = "Perl (v$Config::Config{version}$threaded) module $data->{NAME}";
    if ($data->{INSTALLDIRS} and $data->{INSTALLDIRS} eq 'perl') {
	$distname = 'perl5-porters@@perl.org';
	$comment = "Core $comment";
    }
d84 1
a84 1
    print DEF "DESCRIPTION '\@@#$distname:$data->{VERSION}#\@@ $comment'\n";
d151 1
a151 1
    my($isvax) = $Config::Config{'archname'} =~ /VAX/i;
a166 2
    print OPT "case_sensitive=yes\n"
        if $Config::Config{d_vms_case_sensitive_symbols};
@


1.1.1.4
log
@stock perl 5.6.1
@
text
@a51 1
    elsif ($osname eq 'MacOS'){ _write_aix(\%spec) }
@


1.1.1.5
log
@stock perl 5.8.0 from CPAN
@
text
@d3 1
a3 1
use 5.00503;
d9 1
a9 3
use Config;

use vars qw(@@ISA @@EXPORT $VERSION);
d12 1
a12 1
$VERSION = 1.19;
d84 1
a84 4
    my $patchlevel = " pl$Config{perl_patchlevel}" || '';
    my $comment = sprintf "Perl (v%s%s%s) module %s", 
      $Config::Config{version}, $threaded, $patchlevel, $data->{NAME};
    chomp $comment;
a88 2
    $comment = "$comment (Perl-config: $Config{config_args})";
    $comment = substr($comment, 0, 200) . "...)" if length $comment > 203;
d220 1
a220 1
=over 4
@


1.1.1.6
log
@import perl 5.10.0 from CPAN
@
text
@d14 1
a14 1
$VERSION = '6.42';
@


1.1.1.7
log
@import perl 5.10.1
@
text
@d3 1
a3 1
use 5.006;
d11 4
a14 3
our @@ISA = qw(Exporter);
our @@EXPORT = qw(&Mksymlists);
our $VERSION = '6.55_02';
d31 3
a33 2
        foreach my $package (keys %{$spec{DL_FUNCS}}) {
            my($packprefix,$bootseen);
d35 1
a35 1
            foreach my $sym (@@{$spec{DL_FUNCS}->{$package}}) {
d40 1
a40 3
                else {
                    push(@@{$spec{FUNCLIST}},"XS_${packprefix}_$sym");
                }
d58 1
a58 3
    else {
        croak("Don't know how to create linker option file for $osname\n");
    }
d67 1
a67 1
    open( my $exp, ">", "$data->{FILE}.exp")
d69 3
a71 3
    print $exp join("\n",@@{$data->{DL_VARS}}, "\n") if @@{$data->{DL_VARS}};
    print $exp join("\n",@@{$data->{FUNCLIST}}, "\n") if @@{$data->{FUNCLIST}};
    close $exp;
d91 2
a92 2
        $distname = 'perl5-porters@@perl.org';
        $comment = "Core $comment";
d98 1
a98 1
    open(my $def, ">", "$data->{FILE}.def")
d100 7
a106 7
    print $def "LIBRARY '$data->{DLBASE}' INITINSTANCE TERMINSTANCE\n";
    print $def "DESCRIPTION '\@@#$distname:$data->{VERSION}#\@@ $comment'\n";
    print $def "CODE LOADONCALL\n";
    print $def "DATA LOADONCALL NONSHARED MULTIPLE\n";
    print $def "EXPORTS\n  ";
    print $def join("\n  ",@@{$data->{DL_VARS}}, "\n") if @@{$data->{DL_VARS}};
    print $def join("\n  ",@@{$data->{FUNCLIST}}, "\n") if @@{$data->{FUNCLIST}};
d108 5
a112 5
        print $def "IMPORTS\n";
        my ($name, $exp);
        while (($name, $exp)= each %{$data->{IMPORTS}}) {
            print $def "  $name=$exp\n";
        }
d114 1
a114 1
    close $def;
d127 1
a127 1
    open( my $def, ">", "$data->{FILE}.def" )
d131 1
a131 1
        print $def "LIBRARY \"$data->{DLBASE}\"\n";
d133 1
a133 1
    print $def "EXPORTS\n  ";
d141 3
a143 3
        for (@@{$data->{DL_VARS}}, @@{$data->{FUNCLIST}}) {
            push @@syms, "_$_", "$_ = _$_";
        }
d146 3
a148 3
        for (@@{$data->{DL_VARS}}, @@{$data->{FUNCLIST}}) {
            push @@syms, "$_", "_$_ = $_";
        }
d150 1
a150 1
    print $def join("\n  ",@@syms, "\n") if @@syms;
d152 1
a152 1
        print $def "IMPORTS\n";
d155 1
a155 1
            print $def "  $name=$exp\n";
d158 1
a158 1
    close $def;
d170 1
d174 1
a174 1
    open(my $opt,">", "$data->{FILE}.opt")
d184 1
a184 1
    print $opt "case_sensitive=yes\n"
d186 1
a186 2

    foreach my $sym (@@{$data->{FUNCLIST}}) {
d188 2
a189 2
        if ($isvax) { print $opt "UNIVERSAL=$safe\n" }
        else        { print $opt "SYMBOL_VECTOR=($safe=PROCEDURE)\n"; }
d191 1
a191 2

    foreach my $sym (@@{$data->{DL_VARS}}) {
d193 3
a195 3
        print $opt "PSECT_ATTR=${sym},PIC,OVR,RD,NOEXE,WRT,NOSHR\n";
        if ($isvax) { print $opt "UNIVERSAL=$safe\n" }
        else        { print $opt "SYMBOL_VECTOR=($safe=DATA)\n"; }
d197 2
a198 2
    
    close $opt;
@


