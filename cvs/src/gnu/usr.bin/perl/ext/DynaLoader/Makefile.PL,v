head	1.15;
access;
symbols
	OPENBSD_6_1_BASE:1.15
	OPENBSD_6_0:1.13.0.8
	OPENBSD_6_0_BASE:1.13
	OPENBSD_5_9:1.13.0.2
	OPENBSD_5_9_BASE:1.13
	OPENBSD_5_8:1.13.0.4
	OPENBSD_5_8_BASE:1.13
	PERL_5_20_2:1.1.1.7
	OPENBSD_5_7:1.11.0.2
	OPENBSD_5_7_BASE:1.11
	PERL_5_20_1:1.1.1.7
	OPENBSD_5_6:1.9.0.8
	OPENBSD_5_6_BASE:1.9
	PERL_5_18_2:1.1.1.7
	PERL:1.1.1
	OPENBSD_5_5:1.9.0.6
	OPENBSD_5_5_BASE:1.9
	OPENBSD_5_4:1.9.0.2
	OPENBSD_5_4_BASE:1.9
	PERL_5_16_3:1.1.1.7
	OPENBSD_5_3:1.8.0.10
	OPENBSD_5_3_BASE:1.8
	OPENBSD_5_2:1.8.0.8
	OPENBSD_5_2_BASE:1.8
	OPENBSD_5_1_BASE:1.8
	OPENBSD_5_1:1.8.0.6
	OPENBSD_5_0:1.8.0.4
	OPENBSD_5_0_BASE:1.8
	OPENBSD_4_9:1.8.0.2
	OPENBSD_4_9_BASE:1.8
	PERL_5_12_2:1.1.1.6
	OPENBSD_4_8:1.7.0.4
	OPENBSD_4_8_BASE:1.7
	OPENBSD_4_7:1.7.0.2
	OPENBSD_4_7_BASE:1.7
	PERL_5_10_1:1.1.1.5
	OPENBSD_4_6:1.5.0.6
	OPENBSD_4_6_BASE:1.5
	OPENBSD_4_5:1.5.0.2
	OPENBSD_4_5_BASE:1.5
	PERL_5_10_0:1.1.1.4
	OPENBSD_4_4:1.4.0.36
	OPENBSD_4_4_BASE:1.4
	OPENBSD_4_3:1.4.0.34
	OPENBSD_4_3_BASE:1.4
	OPENBSD_4_2:1.4.0.32
	OPENBSD_4_2_BASE:1.4
	OPENBSD_4_1:1.4.0.30
	OPENBSD_4_1_BASE:1.4
	OPENBSD_4_0:1.4.0.28
	OPENBSD_4_0_BASE:1.4
	PERL_5_8_8:1.1.1.3
	OPENBSD_3_9:1.4.0.26
	OPENBSD_3_9_BASE:1.4
	OPENBSD_3_8:1.4.0.24
	OPENBSD_3_8_BASE:1.4
	OPENBSD_3_7:1.4.0.22
	OPENBSD_3_7_BASE:1.4
	PERL_5_8_6:1.1.1.3
	OPENBSD_3_6:1.4.0.20
	OPENBSD_3_6_BASE:1.4
	PERL_5_8_5:1.1.1.3
	PERL_5_8_3:1.1.1.3
	OPENBSD_3_5:1.4.0.18
	OPENBSD_3_5_BASE:1.4
	PERL_5_8_2:1.1.1.3
	OPENBSD_3_4:1.4.0.16
	OPENBSD_3_4_BASE:1.4
	OPENBSD_3_3:1.4.0.14
	OPENBSD_3_3_BASE:1.4
	PERL_5_8_0:1.1.1.3
	OPENBSD_3_2:1.4.0.12
	OPENBSD_3_2_BASE:1.4
	OPENBSD_3_1:1.4.0.10
	OPENBSD_3_1_BASE:1.4
	OPENBSD_3_0:1.4.0.8
	OPENBSD_3_0_BASE:1.4
	PERL_5_6_1:1.1.1.3
	OPENBSD_2_9:1.4.0.6
	OPENBSD_2_9_BASE:1.4
	OPENBSD_2_8:1.4.0.4
	OPENBSD_2_8_BASE:1.4
	OPENBSD_2_7:1.4.0.2
	OPENBSD_2_7_BASE:1.4
	PERL_5_6_0:1.1.1.3
	OPENBSD_2_6:1.3.0.2
	OPENBSD_2_6_BASE:1.3
	PERL_500503:1.1.1.2
	CPAN:1.1.1
	OPENBSD_2_5:1.2.0.6
	OPENBSD_2_5_BASE:1.2
	OPENBSD_2_4:1.2.0.4
	OPENBSD_2_4_BASE:1.2
	OPENBSD_2_3:1.2.0.2
	OPENBSD_2_3_BASE:1.2
	OPENBSD_2_2:1.1.1.1.0.6
	OPENBSD_2_2_BASE:1.1.1.1
	OPENBSD_2_1:1.1.1.1.0.4
	OPENBSD_2_1_BASE:1.1.1.1
	OPENBSD_2_0:1.1.1.1.0.2
	OPENBSD_2_0_BASE:1.1.1.1
	perl5003:1.1.1.1
	lwall:1.1.1;
locks; strict;
comment	@# @;
expand	@o@;


1.15
date	2017.02.05.00.33.40;	author afresh1;	state Exp;
branches;
next	1.14;
commitid	7JLVNm1wwPgqSqTa;

1.14
date	2017.02.05.00.32.12;	author afresh1;	state Exp;
branches;
next	1.13;
commitid	cxJ08BvJA9Pt2PTM;

1.13
date	2015.04.25.19.26.22;	author afresh1;	state Exp;
branches;
next	1.12;
commitid	3qGYFVvfrExB70FB;

1.12
date	2015.04.25.19.14.45;	author afresh1;	state Exp;
branches;
next	1.11;
commitid	XRK22kO4se3v2i2I;

1.11
date	2014.11.29.21.47.13;	author afresh1;	state Exp;
branches;
next	1.10;
commitid	fVbfZyuP13De5YUW;

1.10
date	2014.11.17.20.57.05;	author afresh1;	state Exp;
branches;
next	1.9;
commitid	QP75iYx42Uo7mMxO;

1.9
date	2013.03.25.20.40.54;	author sthen;	state Exp;
branches;
next	1.8;

1.8
date	2010.09.24.15.06.56;	author millert;	state Exp;
branches;
next	1.7;

1.7
date	2009.10.13.01.25.48;	author millert;	state Exp;
branches;
next	1.6;

1.6
date	2009.10.12.18.24.27;	author millert;	state Exp;
branches;
next	1.5;

1.5
date	2008.09.29.17.36.04;	author millert;	state Exp;
branches;
next	1.4;

1.4
date	2000.04.06.17.05.10;	author millert;	state Exp;
branches;
next	1.3;

1.3
date	99.04.29.22.51.25;	author millert;	state Exp;
branches;
next	1.2;

1.2
date	97.11.30.07.55.08;	author millert;	state Exp;
branches;
next	1.1;

1.1
date	96.08.19.10.12.02;	author downsj;	state Exp;
branches
	1.1.1.1;
next	;

1.1.1.1
date	96.08.19.10.12.02;	author downsj;	state Exp;
branches;
next	1.1.1.2;

1.1.1.2
date	99.04.29.22.38.41;	author millert;	state Exp;
branches;
next	1.1.1.3;

1.1.1.3
date	2000.04.06.16.09.09;	author millert;	state Exp;
branches;
next	1.1.1.4;

1.1.1.4
date	2008.09.29.17.18.16;	author millert;	state Exp;
branches;
next	1.1.1.5;

1.1.1.5
date	2009.10.12.18.11.11;	author millert;	state Exp;
branches;
next	1.1.1.6;

1.1.1.6
date	2010.09.24.14.48.53;	author millert;	state Exp;
branches;
next	1.1.1.7;

1.1.1.7
date	2013.03.25.20.08.44;	author sthen;	state Exp;
branches;
next	;


desc
@@


1.15
log
@Apply local patches - perl-5.24.1
@
text
@use strict;
use ExtUtils::MakeMaker;

my $is_mswin    = $^O eq 'MSWin32';
my $is_netware  = $^O eq 'NetWare';
my $is_vms      = $^O eq 'VMS';

WriteMakefile(
    NAME => 'DynaLoader',
    LINKTYPE	=> 'static',
    DEFINE	=> '-DLIBC="$(LIBC)"',
    SKIP	=> [qw(dynamic dynamic_lib dynamic_bs)],
    XSPROTOARG => '-noprototypes', 		# XXX remove later?
    VERSION_FROM => 'DynaLoader_pm.PL',
    PL_FILES	=> {'DynaLoader_pm.PL'=>'DynaLoader.pm'},
    PM		=> {'DynaLoader.pm' => '$(INST_LIBDIR)/DynaLoader.pm'},
    depend      => {	'DynaLoader$(OBJ_EXT)' => 'dlutils.c',
			'DynaLoader.c' => 'DynaLoader.xs'},
    clean	=> {FILES => 'DynaLoader.c DynaLoader.xs DynaLoader.pm'},
);

sub MY::cflags {
  package MY;
  my $flags = shift->SUPER::cflags(@@_);
  if ($flags =~ /-DUSEIMPORTLIB/m) {
    $flags =~ s/-DUSEIMPORTLIB/-UUSEIMPORTLIB/m;
  }
  $flags;
}

sub MY::postamble {
    my $test_xs;

    if ($is_mswin || $is_netware || $is_vms) {
	$test_xs = '';
    } else {
	$test_xs = <<'EOT';

# Perform very simple tests just to check for major gaffs.
# We can\'t do much more for platforms we are not executing on.
test-xs:
	for i in dl_*xs; \
	    do $(PERL) -I$(PERL_ARCHLIB) -I$(PERL_LIB) $(XSUBPP) $(XSUBPPARGS) $$i > /dev/null; \
	done
EOT
    }

    return '
DynaLoader.xs: $(DLSRC)
	$(RM_F) $@@
	$(CP) $? $@@
' . $test_xs;
}

sub MY::static {
    my $object;
    if ($is_mswin || $is_netware) {
	$object = '$(PERL_SRC)\\$(OBJECT)';
    } elsif ($is_vms) {
	$object = '$(PERL_SRC)$(OBJECT)';
    } else {
	$object = '$(PERL_SRC)/$(OBJECT)';
    }


    return "
$object : \$(FIRST_MAKEFILE) \$(OBJECT)
	#\$(RM_RF) $object
	#\$(CP) \$(OBJECT) $object

static :: $object
";
}
@


1.14
log
@Fix merge issues, remove excess files - match perl-5.24.1 dist
@
text
@d68 2
a69 2
	\$(RM_RF) $object
	\$(CP) \$(OBJECT) $object
@


1.13
log
@Apply local patches, remove excess files - perl-5.20.2
@
text
@d17 2
a18 1
    depend      => {'DynaLoader$(OBJ_EXT)' => 'dlutils.c'},
d68 2
a69 2
	#\$(RM_RF) $object
	#\$(CP) \$(OBJECT) $object
@


1.12
log
@Fix merge issues, remove excess files - match perl-5.20.2 dist
@
text
@d67 2
a68 2
	\$(RM_RF) $object
	\$(CP) \$(OBJECT) $object
@


1.11
log
@Reapply a patch to stop rebuilding libperl with incorrect flags

Help from miod@@ and kettenis@@

OK kettenis@@ millert@@
@
text
@d67 2
a68 2
	#\$(RM_RF) $object
	#\$(CP) \$(OBJECT) $object
@


1.10
log
@Fix merge conflicts, remove extra files, match upstream perl-5.20.1

ok deraadt@@ sthen@@ espie@@ miod@@
@
text
@d67 2
a68 2
	\$(RM_RF) $object
	\$(CP) \$(OBJECT) $object
@


1.9
log
@merge/resolve conflicts
(some more to do after this one)
@
text
@d67 2
a68 2
	#\$(RM_RF) $object
	#\$(CP) \$(OBJECT) $object
@


1.8
log
@merge in perl 5.12.2 plus local changes
@
text
@d21 9
@


1.7
log
@Merge in some local changes that got lost.
@
text
@d1 1
d4 4
d15 2
a16 4
    PL_FILES	=> {'DynaLoader_pm.PL'=>'DynaLoader.pm',
		    'XSLoader_pm.PL'=>'XSLoader.pm'},
    PM		=> {'DynaLoader.pm' => '$(INST_LIBDIR)/DynaLoader.pm',
		    'XSLoader.pm' => '$(INST_LIBDIR)/XSLoader.pm'},
d18 1
a18 2
    clean	=> {FILES => 'DynaLoader.c DynaLoader.xs DynaLoader.pm ' .
			     'XSLoader.pm'},
d22 6
a27 4
	'
DynaLoader.xs: $(DLSRC)
	$(RM_F) $@@
	$(CP) $? $@@
d35 8
a42 1
';
d46 14
a59 4
	'
$(PERL_SRC)/$(OBJECT) : $(FIRST_MAKEFILE) $(OBJECT)
	#$(RM_RF) $(PERL_SRC)/$(OBJECT)
	#$(CP) $(OBJECT) $(PERL_SRC)/$(OBJECT)
d61 2
a62 2
static :: $(PERL_SRC)/$(OBJECT)
';
@


1.6
log
@Merge in perl 5.10.1
@
text
@d37 2
a38 2
	$(RM_RF) $(PERL_SRC)/$(OBJECT)
	$(CP) $(OBJECT) $(PERL_SRC)/$(OBJECT)
@


1.5
log
@fix conflicts and merge in local changes to perl 5.10.0
@
text
@a6 1
    MAN3PODS 	=> {}, 	# Pods will be built by installman.
d37 2
a38 2
	#$(RM_RF) $(PERL_SRC)/$(OBJECT)
	#$(CP) $(OBJECT) $(PERL_SRC)/$(OBJECT)
@


1.4
log
@perl-5.6.0 + local changes
@
text
@d6 1
a6 1
    DEFINE	=> '-DPERL_CORE -DLIBC="$(LIBC)"',
d15 1
a15 1
    depend      => {'DynaLoader.o' => 'dlutils.c'},
d35 9
@


1.3
log
@perl5.005_03 (stock)
@
text
@d11 7
a17 3
    PL_FILES	=> {'DynaLoader_pm.PL'=>'DynaLoader.pm'},
    PM		=> {'DynaLoader.pm' => '$(INST_LIBDIR)/DynaLoader.pm'},
    clean	=> {FILES => 'DynaLoader.c DynaLoader.xs DynaLoader.pm'},
d23 1
@


1.2
log
@perl 5.004_04
@
text
@d7 1
a7 1
    MAN3PODS 	=> ' ', 	# Pods will be built by installman.
d10 4
a13 2
    VERSION_FROM => 'DynaLoader.pm',
    clean	=> {FILES => 'DynaLoader.c DynaLoader.xs'},
a14 1

@


1.1
log
@Initial revision
@
text
@d4 1
a4 1
    NAME	=> 'DynaLoader',
d6 1
a6 1
    DEFINE	=> '-DLIBC="$(LIBC)"',
d11 1
a11 1
    clean	=> {FILES => 'DynaLoader.c'},
d17 2
a18 2
DynaLoader.c: $(DLSRC)
	$(PERL) -I$(PERL_ARCHLIB) -I$(PERL_LIB) $(XSUBPP) $(XSPROTOARG) $(XSUBPPARGS) $(DLSRC) >tmp && mv tmp $@@
@


1.1.1.1
log
@Import of Perl 5.003 into the tree.  Makefile.bsd-wrapper and
config.sh.OpenBSD are the only local changes.
@
text
@@


1.1.1.2
log
@perl5.005_03
@
text
@d4 1
a4 1
    NAME => 'DynaLoader',
d6 2
a7 2
    DEFINE	=> '-DPERL_CORE -DLIBC="$(LIBC)"',
    MAN3PODS 	=> {}, 	# Pods will be built by installman.
d10 2
a11 4
    VERSION_FROM => 'DynaLoader_pm.PL',
    PL_FILES	=> {'DynaLoader_pm.PL'=>'DynaLoader.pm'},
    PM		=> {'DynaLoader.pm' => '$(INST_LIBDIR)/DynaLoader.pm'},
    clean	=> {FILES => 'DynaLoader.c DynaLoader.xs DynaLoader.pm'},
d14 1
d17 2
a18 2
DynaLoader.xs: $(DLSRC)
	$(CP) $? $@@
@


1.1.1.3
log
@virgin perl 5.6.0
@
text
@d11 3
a13 7
    PL_FILES	=> {'DynaLoader_pm.PL'=>'DynaLoader.pm',
		    'XSLoader_pm.PL'=>'XSLoader.pm'},
    PM		=> {'DynaLoader.pm' => '$(INST_LIBDIR)/DynaLoader.pm',
		    'XSLoader.pm' => '$(INST_LIBDIR)/XSLoader.pm'},
    depend      => {'DynaLoader.o' => 'dlutils.c'},
    clean	=> {FILES => 'DynaLoader.c DynaLoader.xs DynaLoader.pm ' .
			     'XSLoader.pm'},
a18 1
	$(RM_F) $@@
@


1.1.1.4
log
@import perl 5.10.0 from CPAN
@
text
@d6 1
a6 1
    DEFINE	=> '-DLIBC="$(LIBC)"',
d15 1
a15 1
    depend      => {'DynaLoader$(OBJ_EXT)' => 'dlutils.c'},
a34 9
sub MY::static {
	'
$(PERL_SRC)/$(OBJECT) : $(FIRST_MAKEFILE) $(OBJECT)
	$(RM_RF) $(PERL_SRC)/$(OBJECT)
	$(CP) $(OBJECT) $(PERL_SRC)/$(OBJECT)

static :: $(PERL_SRC)/$(OBJECT)
';
}
@


1.1.1.5
log
@import perl 5.10.1
@
text
@d7 1
@


1.1.1.6
log
@Perl 5.12.2 from CPAN
@
text
@a0 1
use strict;
a2 4
my $is_mswin    = $^O eq 'MSWin32';
my $is_netware  = $^O eq 'NetWare';
my $is_vms      = $^O eq 'VMS';

d10 4
a13 2
    PL_FILES	=> {'DynaLoader_pm.PL'=>'DynaLoader.pm'},
    PM		=> {'DynaLoader.pm' => '$(INST_LIBDIR)/DynaLoader.pm'},
d15 2
a16 1
    clean	=> {FILES => 'DynaLoader.c DynaLoader.xs DynaLoader.pm'},
d20 4
a23 6
    my $test_xs;

    if ($is_mswin || $is_netware || $is_vms) {
	$test_xs = '';
    } else {
	$test_xs = <<'EOT';
d31 1
a31 8
EOT
    }

    return '
DynaLoader.xs: $(DLSRC)
	$(RM_F) $@@
	$(CP) $? $@@
' . $test_xs;
d35 4
a38 14
    my $object;
    if ($is_mswin || $is_netware) {
	$object = '$(PERL_SRC)\\$(OBJECT)';
    } elsif ($is_vms) {
	$object = '$(PERL_SRC)$(OBJECT)';
    } else {
	$object = '$(PERL_SRC)/$(OBJECT)';
    }


    return "
$object : \$(FIRST_MAKEFILE) \$(OBJECT)
	\$(RM_RF) $object
	\$(CP) \$(OBJECT) $object
d40 2
a41 2
static :: $object
";
@


1.1.1.7
log
@import perl 5.16.3 from CPAN - worked on by Andrew Fresh and myself
@
text
@a20 9
sub MY::cflags {
  package MY;
  my $flags = shift->SUPER::cflags(@@_);
  if ($flags =~ /-DUSEIMPORTLIB/m) {
    $flags =~ s/-DUSEIMPORTLIB/-UUSEIMPORTLIB/m;
  }
  $flags;
}

@


