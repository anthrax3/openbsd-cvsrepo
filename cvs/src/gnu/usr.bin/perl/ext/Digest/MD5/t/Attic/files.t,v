head	1.6;
access;
symbols
	OPENBSD_4_6:1.5.0.6
	OPENBSD_4_6_BASE:1.5
	OPENBSD_4_5:1.5.0.2
	OPENBSD_4_5_BASE:1.5
	PERL_5_10_0:1.1.1.7
	OPENBSD_4_4:1.4.0.10
	OPENBSD_4_4_BASE:1.4
	OPENBSD_4_3:1.4.0.8
	OPENBSD_4_3_BASE:1.4
	OPENBSD_4_2:1.4.0.6
	OPENBSD_4_2_BASE:1.4
	OPENBSD_4_1:1.4.0.4
	OPENBSD_4_1_BASE:1.4
	OPENBSD_4_0:1.4.0.2
	OPENBSD_4_0_BASE:1.4
	PERL_5_8_8:1.1.1.6
	OPENBSD_3_9:1.3.0.8
	OPENBSD_3_9_BASE:1.3
	OPENBSD_3_8:1.3.0.6
	OPENBSD_3_8_BASE:1.3
	OPENBSD_3_7:1.3.0.4
	OPENBSD_3_7_BASE:1.3
	PERL_5_8_6:1.1.1.5
	OPENBSD_3_6:1.3.0.2
	OPENBSD_3_6_BASE:1.3
	PERL_5_8_5:1.1.1.4
	PERL_5_8_3:1.1.1.3
	OPENBSD_3_5:1.2.0.2
	OPENBSD_3_5_BASE:1.2
	PERL_5_8_2:1.1.1.2
	OPENBSD_3_4:1.1.1.1.0.4
	OPENBSD_3_4_BASE:1.1.1.1
	OPENBSD_3_3:1.1.1.1.0.2
	OPENBSD_3_3_BASE:1.1.1.1
	PERL_5_8_0:1.1.1.1
	CPAN:1.1.1;
locks; strict;
comment	@# @;
expand	@o@;


1.6
date	2009.10.12.18.24.27;	author millert;	state dead;
branches;
next	1.5;

1.5
date	2008.09.29.17.36.04;	author millert;	state Exp;
branches;
next	1.4;

1.4
date	2006.03.28.19.23.02;	author millert;	state Exp;
branches;
next	1.3;

1.3
date	2004.04.07.21.33.02;	author millert;	state Exp;
branches;
next	1.2;

1.2
date	2003.12.03.03.02.28;	author millert;	state Exp;
branches;
next	1.1;

1.1
date	2002.10.27.22.14.54;	author millert;	state Exp;
branches
	1.1.1.1;
next	;

1.1.1.1
date	2002.10.27.22.14.54;	author millert;	state Exp;
branches;
next	1.1.1.2;

1.1.1.2
date	2003.12.03.02.43.43;	author millert;	state Exp;
branches;
next	1.1.1.3;

1.1.1.3
date	2004.04.07.21.13.00;	author millert;	state Exp;
branches;
next	1.1.1.4;

1.1.1.4
date	2004.08.09.17.45.57;	author millert;	state Exp;
branches;
next	1.1.1.5;

1.1.1.5
date	2005.01.15.21.16.46;	author millert;	state Exp;
branches;
next	1.1.1.6;

1.1.1.6
date	2006.03.28.18.48.01;	author millert;	state Exp;
branches;
next	1.1.1.7;

1.1.1.7
date	2008.09.29.17.18.16;	author millert;	state Exp;
branches;
next	;


desc
@@


1.6
log
@Merge in perl 5.10.1
@
text
@BEGIN {
	if ($ENV{PERL_CORE}) {
        	chdir 't' if -d 't';
        	@@INC = '../lib';
        }
}

print "1..5\n";

use strict;
use Digest::MD5 qw(md5 md5_hex md5_base64);

# To update the EBCDIC section even on a Latin 1 platform,
# run this script with $ENV{EBCDIC_MD5SUM} set to a true value.
# (You'll need to have Perl 5.7.3 or later, to have the Encode installed.)
# (And remember that under the Perl core distribution you should
#  also have the $ENV{PERL_CORE} set to a true value.)
# Similarly, to update MacOS section, run with $ENV{MAC_MD5SUM} set.

my $EXPECT;
if (ord "A" == 193) { # EBCDIC
    $EXPECT = <<EOT;
c7b68bb806b2d42f4a11511132e94ae8  Changes
11e8028ee426273db6b6db270a8bb38c  README
c5e839f675f682215f913ea73788bc2c  MD5.pm
d4b61fd6f875dcd3e3066a3d6750010e  MD5.xs
276da0aa4e9a08b7fe09430c9c5690aa  rfc1321.txt
EOT
} elsif ("\n" eq "\015") { # MacOS
    $EXPECT = <<EOT;
628699b88b6a803225678802d2470067  Changes
c95549c6c5e1e1c078b27042f1dc850f  README
e78ad7902025d17f140bef176dc4b154  MD5.pm
315f43d139c2ead64060d03b13b39ec5  MD5.xs
754b9db19f79dbc4992f7166eb0f37ce  rfc1321.txt
EOT
} else {
    # This is the output of: 'md5sum Changes README MD5.pm MD5.xs rfc1321.txt'
    $EXPECT = <<EOT;
412c1a5ebd635befbf501531541a8743  Changes
c95549c6c5e1e1c078b27042f1dc850f  README
e78ad7902025d17f140bef176dc4b154  MD5.pm
c132fac095562c8279ec561cf8c2681a  MD5.xs
754b9db19f79dbc4992f7166eb0f37ce  rfc1321.txt
EOT
}

if (!(-f "README") && -f "../README") {
   chdir("..") or die "Can't chdir: $!";
}

my $testno = 0;

my $B64 = 1;
eval { require MIME::Base64; };
if ($@@) {
    print "# $@@: Will not test base64 methods\n";
    $B64 = 0;
}

for (split /^/, $EXPECT) {
     my($md5hex, $file) = split ' ';
     my $base = $file;
#     print "# $base\n";
     if ($ENV{PERL_CORE}) {
         if ($file eq 'rfc1321.txt') { # Don't have it in core.
	     print "ok ", ++$testno, " # Skip: PERL_CORE\n";
	     next;
	 }
         use File::Spec;
	 my @@path = qw(ext Digest MD5);
	 my $path = File::Spec->updir;
	 while (@@path) {
	   $path = File::Spec->catdir($path, shift @@path);
	 }
	 $file = File::Spec->catfile($path, $file);
     }
#     print "# file = $file\n";
     unless (-f $file) {
	warn "No such file: $file\n";
	next;
     }
     if ($ENV{EBCDIC_MD5SUM}) {
         require Encode;
	 my $data = cat_file($file);	
	 Encode::from_to($data, 'latin1', 'cp1047');
	 print md5_hex($data), "  $base\n";
	 next;
     }
     if ($ENV{MAC_MD5SUM}) {
         require Encode;
	 my $data = cat_file($file);	
	 Encode::from_to($data, 'latin1', 'MacRoman');
	 print md5_hex($data), "  $base\n";
	 next;
     }
     my $md5bin = pack("H*", $md5hex);
     my $md5b64;
     if ($B64) {
	 $md5b64 = MIME::Base64::encode($md5bin, "");
	 chop($md5b64); chop($md5b64);   # remove padding
     }
     my $failed;
     my $got;

     if (digest_file($file, 'digest') ne $md5bin) {
	 print "$file: Bad digest\n";
	 $failed++;
     }

     if (($got = digest_file($file, 'hexdigest')) ne $md5hex) {
	 print "$file: Bad hexdigest: got $got expected $md5hex\n";
	 $failed++;
     }

     if ($B64 && digest_file($file, 'b64digest') ne $md5b64) {
	 print "$file: Bad b64digest\n";
	 $failed++;
     }

     my $data = cat_file($file);
     if (md5($data) ne $md5bin) {
	 print "$file: md5() failed\n";
	 $failed++;
     }
     if (md5_hex($data) ne $md5hex) {
	 print "$file: md5_hex() failed\n";
	 $failed++;
     }
     if ($B64 && md5_base64($data) ne $md5b64) {
	 print "$file: md5_base64() failed\n";
	 $failed++;
     }

     if (Digest::MD5->new->add($data)->digest ne $md5bin) {
	 print "$file: MD5->new->add(...)->digest failed\n";
	 $failed++;
     }
     if (Digest::MD5->new->add($data)->hexdigest ne $md5hex) {
	 print "$file: MD5->new->add(...)->hexdigest failed\n";
	 $failed++;
     }
     if ($B64 && Digest::MD5->new->add($data)->b64digest ne $md5b64) {
	 print "$file: MD5->new->add(...)->b64digest failed\n";
	 $failed++;
     }

     my @@data = split //, $data;
     if (md5(@@data) ne $md5bin) {
	 print "$file: md5(\@@data) failed\n";
	 $failed++;
     }
     if (Digest::MD5->new->add(@@data)->digest ne $md5bin) {
	 print "$file: MD5->new->add(\@@data)->digest failed\n";
	 $failed++;
     }
     my $md5 = Digest::MD5->new;
     for (@@data) {
	 $md5->add($_);
     }
     if ($md5->digest ne $md5bin) {
	 print "$file: $md5->add()-loop failed\n";
	 $failed++;
     }

     print "not " if $failed;
     print "ok ", ++$testno, "\n";
}


sub digest_file
{
    my($file, $method) = @@_;
    $method ||= "digest";
    #print "$file $method\n";

    open(FILE, $file) or die "Can't open $file: $!";
    my $digest = Digest::MD5->new->addfile(*FILE)->$method();
    close(FILE);

    $digest;
}

sub cat_file
{
    my($file) = @@_;
    local $/;  # slurp
    open(FILE, $file) or die "Can't open $file: $!";

    # For PerlIO in case of UTF-8 locales.
    eval 'binmode(FILE, ":bytes")' if $] >= 5.008;

    my $tmp = <FILE>;
    close(FILE);
    $tmp;
}

@


1.5
log
@fix conflicts and merge in local changes to perl 5.10.0
@
text
@@


1.4
log
@merge in perl 5.8.8
@
text
@d25 2
a26 2
347d5b9f257eb62eaab60b3d952451f7  MD5.pm
b61eb1bba8cc490040d02f6bf24874f7  MD5.xs
d33 2
a34 2
77503ff007841a671275fdf544dad68e  MD5.pm
716c3278fd80338727c100e5d2a76795  MD5.xs
d42 2
a43 2
77503ff007841a671275fdf544dad68e  MD5.pm
716c3278fd80338727c100e5d2a76795  MD5.xs
@


1.3
log
@merge local changes into perl-5.8.3
@
text
@d23 4
a26 4
15e4c91ad67f5ff238033305376c9140  Changes
0565ec21b15c0f23f4c51fb327c8926d  README
f0f77710cd8d5ba7d9faedec8d02dc2f  MD5.pm
f9848c0ee3b20a9177465eec19361e6c  MD5.xs
d31 4
a34 4
dea016b088ab4d88a5e7cbd9c15a9c88  Changes
6c950a0211a5a28f023bb482037698cd  README
f057c88277ecee875cf6f0352468407a  MD5.pm
5bae62404829e6fd8ad0d4f8d5ccea54  MD5.xs
d40 4
a43 4
0150d5fc16642cb4222e83a1cd7c0a1b  Changes
6c950a0211a5a28f023bb482037698cd  README
f057c88277ecee875cf6f0352468407a  MD5.pm
5bae62404829e6fd8ad0d4f8d5ccea54  MD5.xs
@


1.2
log
@Resolve conflicts for perl 5.8.2, remove old files, and add OpenBSD-specific scaffolding
@
text
@d23 1
a23 1
e1d7df564fad76d2f0ed628c648d5833  Changes
d25 2
a26 2
4d48606863dbc7fd131c2e7b5eefc8c5  MD5.pm
45e5e6785b47fb922f33b4a74c29a148  MD5.xs
d31 1
a31 1
c780484c87b64e32bd55c6be58b623b4  Changes
d33 2
a34 2
546c4e62999c9888d7d46732a21c9dff  MD5.pm
ca3f8cb317c5d088ed9f97204c6b8cda  MD5.xs
d40 1
a40 1
465bf969cb780d0b268dcc6b077a4c21  Changes
d42 2
a43 2
546c4e62999c9888d7d46732a21c9dff  MD5.pm
ca3f8cb317c5d088ed9f97204c6b8cda  MD5.xs
@


1.1
log
@Initial revision
@
text
@a12 5
#
# This is the output of: 'md5sum Changes README MD5.pm MD5.xs rfc1321.txt'
#
my $EXPECT;

d20 1
d23 4
a26 4
b362148b17a451f0d81e0ebb2487756e  Changes
5a591a47e8c40fe4b78c744111511c45  README
3157e2d2e27dacddea7c54efddc32520  MD5.pm
4850753428db9422e8e5f97b401d5a13  MD5.xs
d31 5
a35 5
cc90a85f89b397341f97c9279640fbf5  Changes
127952946201e6afc19eb41250c56871  README
d87ec77c963d27198b7427156167a5b3  MD5.pm
5be7049479ea47d7c257dabcae835720  MD5.xs
f9a35714ee1d1d0c5a3a80f4dbea956a  rfc1321.txt
d38 1
d40 4
a43 4
0106b67df0dbf9f4d65e9fc04907745b  Changes
3519f3d02c7c91158f732f0f00064657  README
88c35ca46c7e8069fb5ae00c091c98d6  MD5.pm
1be293491bba726810f8e87671ee0328  MD5.xs
d64 1
d91 1
d93 1
d190 2
a191 2
    # For PerlIO (Perl 5.8.0 and later) in case of UTF-8 locales.
    eval { binmode(FILE, ":bytes"); };
@


1.1.1.1
log
@stock perl 5.8.0 from CPAN
@
text
@@


1.1.1.2
log
@perl 5.8.2 from CPAN
@
text
@d13 5
a24 1
my $EXPECT;
d27 4
a30 4
e1d7df564fad76d2f0ed628c648d5833  Changes
0565ec21b15c0f23f4c51fb327c8926d  README
4d48606863dbc7fd131c2e7b5eefc8c5  MD5.pm
45e5e6785b47fb922f33b4a74c29a148  MD5.xs
d35 5
a39 5
c780484c87b64e32bd55c6be58b623b4  Changes
6c950a0211a5a28f023bb482037698cd  README
546c4e62999c9888d7d46732a21c9dff  MD5.pm
ca3f8cb317c5d088ed9f97204c6b8cda  MD5.xs
754b9db19f79dbc4992f7166eb0f37ce  rfc1321.txt
a41 1
    # This is the output of: 'md5sum Changes README MD5.pm MD5.xs rfc1321.txt'
d43 4
a46 4
2bdd59aa1e816cd8df05968e70f75cf1  Changes
6c950a0211a5a28f023bb482037698cd  README
546c4e62999c9888d7d46732a21c9dff  MD5.pm
ca3f8cb317c5d088ed9f97204c6b8cda  MD5.xs
a66 1
#     print "# $base\n";
a92 1
         require Encode;
a93 1
	 Encode::from_to($data, 'latin1', 'MacRoman');
d190 2
a191 2
    # For PerlIO in case of UTF-8 locales.
    eval 'binmode(FILE, ":bytes")' if $] >= 5.008;
@


1.1.1.3
log
@perl 5.8.3 from CPAN
@
text
@d23 1
a23 1
15e4c91ad67f5ff238033305376c9140  Changes
d25 2
a26 2
f0f77710cd8d5ba7d9faedec8d02dc2f  MD5.pm
f9848c0ee3b20a9177465eec19361e6c  MD5.xs
d31 1
a31 1
dea016b088ab4d88a5e7cbd9c15a9c88  Changes
d33 2
a34 2
f057c88277ecee875cf6f0352468407a  MD5.pm
5bae62404829e6fd8ad0d4f8d5ccea54  MD5.xs
d40 1
a40 1
0f09886e2c129bdabf57674c6822bd4f  Changes
d42 2
a43 2
f057c88277ecee875cf6f0352468407a  MD5.pm
5bae62404829e6fd8ad0d4f8d5ccea54  MD5.xs
@


1.1.1.4
log
@Import of stock perl 5.8.5
@
text
@d40 1
a40 1
0150d5fc16642cb4222e83a1cd7c0a1b  Changes
@


1.1.1.5
log
@perl 5.8.6 from CPAN
@
text
@d40 1
a40 1
0f09886e2c129bdabf57674c6822bd4f  Changes
@


1.1.1.6
log
@perl 5.8.8 import
@
text
@d23 4
a26 4
c7b68bb806b2d42f4a11511132e94ae8  Changes
11e8028ee426273db6b6db270a8bb38c  README
347d5b9f257eb62eaab60b3d952451f7  MD5.pm
b61eb1bba8cc490040d02f6bf24874f7  MD5.xs
d31 4
a34 4
628699b88b6a803225678802d2470067  Changes
c95549c6c5e1e1c078b27042f1dc850f  README
77503ff007841a671275fdf544dad68e  MD5.pm
716c3278fd80338727c100e5d2a76795  MD5.xs
d40 4
a43 4
2fdc25c326960308f5334c967455d1f5  Changes
c95549c6c5e1e1c078b27042f1dc850f  README
77503ff007841a671275fdf544dad68e  MD5.pm
716c3278fd80338727c100e5d2a76795  MD5.xs
@


1.1.1.7
log
@import perl 5.10.0 from CPAN
@
text
@d25 2
a26 2
c5e839f675f682215f913ea73788bc2c  MD5.pm
d4b61fd6f875dcd3e3066a3d6750010e  MD5.xs
d33 2
a34 2
e78ad7902025d17f140bef176dc4b154  MD5.pm
315f43d139c2ead64060d03b13b39ec5  MD5.xs
d42 2
a43 2
e78ad7902025d17f140bef176dc4b154  MD5.pm
ef3c87d60a88b50c60eb75af81cd244a  MD5.xs
@


