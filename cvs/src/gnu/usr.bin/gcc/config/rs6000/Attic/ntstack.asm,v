head	1.4;
access;
symbols
	OPENBSD_2_5:1.3.0.6
	OPENBSD_2_5_BASE:1.3
	OPENBSD_2_4:1.3.0.4
	OPENBSD_2_4_BASE:1.3
	OPENBSD_2_3:1.3.0.2
	OPENBSD_2_3_BASE:1.3
	FSF_2_8_1:1.1.1.1
	FSF_2_8_0:1.1.1.1
	FSF:1.1.1;
locks; strict;
comment	@;; @;


1.4
date	99.05.26.16.26.58;	author espie;	state dead;
branches;
next	1.3;

1.3
date	98.03.03.21.31.23;	author niklas;	state Exp;
branches;
next	1.2;

1.2
date	98.02.15.07.57.16;	author niklas;	state dead;
branches;
next	1.1;

1.1
date	98.02.14.19.22.23;	author niklas;	state Exp;
branches
	1.1.1.1;
next	;

1.1.1.1
date	98.02.14.19.22.23;	author niklas;	state Exp;
branches;
next	;


desc
@@


1.4
log
@So long, and thanks for all the bugs.
@
text
@# Allocate stack for NT, inserting stack probes every 4k pages

	.file	"ntstack.asm"

#	Setup MS Structured-Exception-Handling
	.pdata
	.align 2
	.ualong ..__allocate_stack,__allocate_stack.e,0,0,__allocate_stack.b

#	Switch to the relocation section
	.reldata
	.globl __allocate_stack
	.globl ..__allocate_stack
__allocate_stack:
	.ualong ..__allocate_stack,.toc

	.text
	.align 2
..__allocate_stack:
	.function	..__allocate_stack
__allocate_stack.b:
	addi	3,3,15			# round up to 16 byte alignment
	lwz	0,0(1)			# old stack link
	rlwinm	3,3,0,0,28
	srawi.	4,3,12			# get # of pages to check
	neg	3,3			# negate so we can use stwux
	bgt-	0,.Lcheck
	stwux	0,1,3			# small request, just decrement and return
	blr

.Lcheck:
	mtctr	4			# number of pages to check
	mr	5,1			# tmp pointer
.Lloop:
	lwzu	6,-4096(5)		# touch the page
	bdnz+	.Lloop			# and loop back

	stwux	0,1,3			# update stack pointer
	blr

__allocate_stack.e:
FE_MOT_RESVD..__allocate_stack:
@


1.3
log
@GCC 2.8.0 merge
@
text
@@


1.2
log
@These files were new in the 2.8 import (into the FSF branch) and cvs is stupid
enough to think my branch import want s the new files to end up in the trunk
as well.  Maybe cvs know how to do what I want, but I could not find it in
the manpage
@
text
@@


1.1
log
@Initial revision
@
text
@@


1.1.1.1
log
@
@
text
@@

