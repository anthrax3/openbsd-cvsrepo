head	1.3;
access;
symbols
	OPENBSD_3_5:1.2.0.32
	OPENBSD_3_5_BASE:1.2
	OPENBSD_3_4:1.2.0.30
	OPENBSD_3_4_BASE:1.2
	OPENBSD_3_3:1.2.0.28
	OPENBSD_3_3_BASE:1.2
	OPENBSD_3_2:1.2.0.26
	OPENBSD_3_2_BASE:1.2
	OPENBSD_3_1:1.2.0.24
	OPENBSD_3_1_BASE:1.2
	OPENBSD_3_0:1.2.0.22
	OPENBSD_3_0_BASE:1.2
	OPENBSD_2_9:1.2.0.20
	OPENBSD_2_9_BASE:1.2
	OPENBSD_2_8:1.2.0.18
	OPENBSD_2_8_BASE:1.2
	OPENBSD_2_7:1.2.0.16
	OPENBSD_2_7_BASE:1.2
	new-binutils:1.2.0.14
	OPENBSD_2_6:1.2.0.12
	OPENBSD_2_6_BASE:1.2
	OPENBSD_2_5:1.2.0.10
	OPENBSD_2_5_BASE:1.2
	OPENBSD_2_4:1.2.0.8
	OPENBSD_2_4_BASE:1.2
	OPENBSD_2_3:1.2.0.6
	OPENBSD_2_3_BASE:1.2
	OPENBSD_2_2:1.2.0.4
	OPENBSD_2_2_BASE:1.2
	OPENBSD_2_1:1.2.0.2
	OPENBSD_2_1_BASE:1.2
	CYGNUS-961112:1.1.2.1
	CYGNUS:1.1.0.2;
locks; strict;
comment	@// @;


1.3
date	2004.05.21.20.23.31;	author kettenis;	state dead;
branches;
next	1.2;

1.2
date	96.11.23.03.46.53;	author niklas;	state Exp;
branches;
next	1.1;

1.1
date	96.11.19.14.30.55;	author niklas;	state dead;
branches
	1.1.2.1;
next	;

1.1.2.1
date	96.11.19.14.30.55;	author niklas;	state Exp;
branches;
next	;


desc
@@


1.3
log
@Resolve conflicts for GDB 6.1.  Add local patches.
ok deraadt@@
@
text
@// regdoc.cpp : implementation file
//

#include "stdafx.h"
#include "regdoc.h"

#ifdef _DEBUG
#undef THIS_FILE
static char BASED_CODE THIS_FILE[] = __FILE__;
#endif

/////////////////////////////////////////////////////////////////////////////
// CRegDoc

IMPLEMENT_DYNCREATE(CRegDoc, CDocument)



static CRegDoc *doclist = 0;

CRegDoc::CRegDoc()
{
  int i;
 
  for (i= 0; i < MAXREGS; i++)
    m_regsinit[i] = 0;

  m_next = doclist;

  doclist = this;
//Sync();	
		m_init=0;
}

BOOL CRegDoc::OnNewDocument()
{

  if (!CDocument::OnNewDocument())
    return FALSE;


  return TRUE;
}

CRegDoc::~CRegDoc()
{

}


BEGIN_MESSAGE_MAP(CRegDoc, CDocument)
	//{{AFX_MSG_MAP(CRegDoc)
	ON_COMMAND(ID_REAL_CMD_BUTTON_SYNC, OnSync)
	//}}AFX_MSG_MAP
END_MESSAGE_MAP()



/////////////////////////////////////////////////////////////////////////////
// CRegDoc serialization

void CRegDoc::Serialize(CArchive& ar)
{

}

void CRegDoc::ChangeReg(int rn, int val)
{
m_regs[rn] = val;
}
/////////////////////////////////////////////////////////////////////////////
// CRegDoc commands



void CRegDoc::Sync()
{
  int rn;
  int hadchange = 0;
  const	int nregs = togdb_maxregs();
  long copy[MAXREGS];
  /* Do a pass to see if anything changed */
  for (rn = 0; rn < nregs; rn++) 
    {
      copy[rn] = togdb_fetchreg(rn);
      if (copy[rn] != m_regs[rn]) 
	hadchange = 1;
      m_regsinit[rn] = 1;	
    }
  
  if (hadchange) 
    {
      for (rn = 0; rn < nregs; rn++) 
	{

	  if (copy[rn] != m_regs[rn])
	    {

	      m_regs[rn] = copy[rn];
	      m_regchanged[rn] = 1;
	    }
	  else 
	    {
	      m_regchanged[rn] = 0;
	    }
	}
    UpdateAllViews(0);
    }
}


void CRegDoc::OnSync() 
{
  // TODO: Add your command handler code here
  Sync();	
}


void CRegDoc::OnCloseDocument() 
{
	// TODO: Add your specialized code here and/or call the base class
	
	m_bModified = FALSE; 
	CDocument::OnCloseDocument();
}


void CRegDoc::prepare()
{
 if (!m_init) {
 	Sync();
	m_init =1 ;
	}


}

BOOL CRegDoc::SaveModified() 
{
	// TODO: Add your specialized code here and/or call the base class
		
	return TRUE; // CDocument::SaveModified();
}
@


1.2
log
@Merge to Cygnus 961112 + add some support (not ready) for shared libs
@
text
@@


1.1
log
@file regdoc.cpp was initially added on branch CYGNUS.
@
text
@d1 143
@


1.1.2.1
log
@Import of 961112 Cygnus binutils+gas+ld+gdb+gprof
@
text
@a0 143
// regdoc.cpp : implementation file
//

#include "stdafx.h"
#include "regdoc.h"

#ifdef _DEBUG
#undef THIS_FILE
static char BASED_CODE THIS_FILE[] = __FILE__;
#endif

/////////////////////////////////////////////////////////////////////////////
// CRegDoc

IMPLEMENT_DYNCREATE(CRegDoc, CDocument)



static CRegDoc *doclist = 0;

CRegDoc::CRegDoc()
{
  int i;
 
  for (i= 0; i < MAXREGS; i++)
    m_regsinit[i] = 0;

  m_next = doclist;

  doclist = this;
//Sync();	
		m_init=0;
}

BOOL CRegDoc::OnNewDocument()
{

  if (!CDocument::OnNewDocument())
    return FALSE;


  return TRUE;
}

CRegDoc::~CRegDoc()
{

}


BEGIN_MESSAGE_MAP(CRegDoc, CDocument)
	//{{AFX_MSG_MAP(CRegDoc)
	ON_COMMAND(ID_REAL_CMD_BUTTON_SYNC, OnSync)
	//}}AFX_MSG_MAP
END_MESSAGE_MAP()



/////////////////////////////////////////////////////////////////////////////
// CRegDoc serialization

void CRegDoc::Serialize(CArchive& ar)
{

}

void CRegDoc::ChangeReg(int rn, int val)
{
m_regs[rn] = val;
}
/////////////////////////////////////////////////////////////////////////////
// CRegDoc commands



void CRegDoc::Sync()
{
  int rn;
  int hadchange = 0;
  const	int nregs = togdb_maxregs();
  long copy[MAXREGS];
  /* Do a pass to see if anything changed */
  for (rn = 0; rn < nregs; rn++) 
    {
      copy[rn] = togdb_fetchreg(rn);
      if (copy[rn] != m_regs[rn]) 
	hadchange = 1;
      m_regsinit[rn] = 1;	
    }
  
  if (hadchange) 
    {
      for (rn = 0; rn < nregs; rn++) 
	{

	  if (copy[rn] != m_regs[rn])
	    {

	      m_regs[rn] = copy[rn];
	      m_regchanged[rn] = 1;
	    }
	  else 
	    {
	      m_regchanged[rn] = 0;
	    }
	}
    UpdateAllViews(0);
    }
}


void CRegDoc::OnSync() 
{
  // TODO: Add your command handler code here
  Sync();	
}


void CRegDoc::OnCloseDocument() 
{
	// TODO: Add your specialized code here and/or call the base class
	
	m_bModified = FALSE; 
	CDocument::OnCloseDocument();
}


void CRegDoc::prepare()
{
 if (!m_init) {
 	Sync();
	m_init =1 ;
	}


}

BOOL CRegDoc::SaveModified() 
{
	// TODO: Add your specialized code here and/or call the base class
		
	return TRUE; // CDocument::SaveModified();
}
@
