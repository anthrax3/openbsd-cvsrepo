head	1.3;
access;
symbols
	OPENBSD_6_2:1.3.0.52
	OPENBSD_6_2_BASE:1.3
	OPENBSD_6_1:1.3.0.54
	OPENBSD_6_1_BASE:1.3
	OPENBSD_6_0:1.3.0.50
	OPENBSD_6_0_BASE:1.3
	OPENBSD_5_9:1.3.0.46
	OPENBSD_5_9_BASE:1.3
	OPENBSD_5_8:1.3.0.48
	OPENBSD_5_8_BASE:1.3
	OPENBSD_5_7:1.3.0.40
	OPENBSD_5_7_BASE:1.3
	OPENBSD_5_6:1.3.0.44
	OPENBSD_5_6_BASE:1.3
	OPENBSD_5_5:1.3.0.42
	OPENBSD_5_5_BASE:1.3
	OPENBSD_5_4:1.3.0.38
	OPENBSD_5_4_BASE:1.3
	OPENBSD_5_3:1.3.0.36
	OPENBSD_5_3_BASE:1.3
	OPENBSD_5_2:1.3.0.34
	OPENBSD_5_2_BASE:1.3
	OPENBSD_5_1_BASE:1.3
	OPENBSD_5_1:1.3.0.32
	OPENBSD_5_0:1.3.0.30
	OPENBSD_5_0_BASE:1.3
	OPENBSD_4_9:1.3.0.28
	OPENBSD_4_9_BASE:1.3
	OPENBSD_4_8:1.3.0.26
	OPENBSD_4_8_BASE:1.3
	OPENBSD_4_7:1.3.0.22
	OPENBSD_4_7_BASE:1.3
	OPENBSD_4_6:1.3.0.24
	OPENBSD_4_6_BASE:1.3
	OPENBSD_4_5:1.3.0.20
	OPENBSD_4_5_BASE:1.3
	OPENBSD_4_4:1.3.0.18
	OPENBSD_4_4_BASE:1.3
	OPENBSD_4_3:1.3.0.16
	OPENBSD_4_3_BASE:1.3
	OPENBSD_4_2:1.3.0.14
	OPENBSD_4_2_BASE:1.3
	OPENBSD_4_1:1.3.0.12
	OPENBSD_4_1_BASE:1.3
	OPENBSD_4_0:1.3.0.10
	OPENBSD_4_0_BASE:1.3
	OPENBSD_3_9:1.3.0.8
	OPENBSD_3_9_BASE:1.3
	OPENBSD_3_8:1.3.0.6
	OPENBSD_3_8_BASE:1.3
	OPENBSD_3_7:1.3.0.4
	OPENBSD_3_7_BASE:1.3
	GDB_6_3:1.1.1.1
	OPENBSD_3_6:1.3.0.2
	OPENBSD_3_6_BASE:1.3
	GDB_6_1:1.1.1.1
	FSF:1.1.1
	OPENBSD_3_5:1.2.0.32
	OPENBSD_3_5_BASE:1.2
	OPENBSD_3_4:1.2.0.30
	OPENBSD_3_4_BASE:1.2
	OPENBSD_3_3:1.2.0.28
	OPENBSD_3_3_BASE:1.2
	OPENBSD_3_2:1.2.0.26
	OPENBSD_3_2_BASE:1.2
	OPENBSD_3_1:1.2.0.24
	OPENBSD_3_1_BASE:1.2
	OPENBSD_3_0:1.2.0.22
	OPENBSD_3_0_BASE:1.2
	OPENBSD_2_9:1.2.0.20
	OPENBSD_2_9_BASE:1.2
	OPENBSD_2_8:1.2.0.18
	OPENBSD_2_8_BASE:1.2
	OPENBSD_2_7:1.2.0.16
	OPENBSD_2_7_BASE:1.2
	new-binutils:1.2.0.14
	OPENBSD_2_6:1.2.0.12
	OPENBSD_2_6_BASE:1.2
	OPENBSD_2_5:1.2.0.10
	OPENBSD_2_5_BASE:1.2
	OPENBSD_2_4:1.2.0.8
	OPENBSD_2_4_BASE:1.2
	OPENBSD_2_3:1.2.0.6
	OPENBSD_2_3_BASE:1.2
	OPENBSD_2_2:1.2.0.4
	OPENBSD_2_2_BASE:1.2
	OPENBSD_2_1:1.2.0.2
	OPENBSD_2_1_BASE:1.2
	CYGNUS-961112:1.1.2.1
	CYGNUS:1.1.0.2;
locks; strict;
comment	@# @;


1.3
date	2004.05.21.20.23.40;	author kettenis;	state Exp;
branches;
next	1.2;

1.2
date	96.11.23.03.50.23;	author niklas;	state Exp;
branches;
next	1.1;

1.1
date	96.11.19.14.35.47;	author niklas;	state dead;
branches
	1.1.1.1
	1.1.2.1;
next	;

1.1.1.1
date	2004.05.21.19.17.00;	author kettenis;	state Exp;
branches;
next	;

1.1.2.1
date	96.11.19.14.35.47;	author niklas;	state Exp;
branches;
next	;


desc
@@


1.3
log
@Resolve conflicts for GDB 6.1.  Add local patches.
ok deraadt@@
@
text
@# This testcase is part of GDB, the GNU debugger.

# Copyright 1988, 1990, 1991, 1992, 1993, 1994, 1995, 1996, 1997,
# 1999, 2000, 2001, 2004 Free Software Foundation, Inc.

# This program is free software; you can redistribute it and/or modify
# it under the terms of the GNU General Public License as published by
# the Free Software Foundation; either version 2 of the License, or
# (at your option) any later version.
# 
# This program is distributed in the hope that it will be useful,
# but WITHOUT ANY WARRANTY; without even the implied warranty of
# MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
# GNU General Public License for more details.
# 
# You should have received a copy of the GNU General Public License
# along with this program; if not, write to the Free Software
# Foundation, Inc., 59 Temple Place - Suite 330, Boston, MA 02111-1307, USA.  

# Please email any bugs, comments, and/or additions to this file to:
# bug-gdb@@gnu.org

# This file was written by Rob Savoye. (rob@@cygnus.com)

if $tracelevel then {
	strace $tracelevel
	}

#
# test running programs
#
set prms_id 0
set bug_id 0

set testfile "setvar"
set srcfile ${testfile}.c
set binfile ${objdir}/${subdir}/${testfile}
if  { [gdb_compile "${srcdir}/${subdir}/${srcfile}" "${binfile}" executable {debug}] != "" } {
     gdb_suppress_entire_file "Testcase compile failed, so all tests in this file will automatically fail."
}

# Create and source the file that provides information about the compiler
# used to compile the test case.
if [get_compiler_info ${binfile}] {
    return -1;
}

gdb_exit
gdb_start
gdb_reinitialize_dir $srcdir/$subdir
gdb_load $binfile

#
# set it up at a breakpoint so we canplay with the variable values
#
send_gdb "set print sevenbit-strings\n" ; gdb_expect -re "$gdb_prompt $"

if ![runto_main] then {
    perror "couldn't run to breakpoint"
    continue
}

# Determine expected output for unsigned long variables,
# the output varies with sizeof (unsigned long).

set ulong_minus_1 4294967295
set ulong_minus_456 4294966840
send_gdb "print sizeof (unsigned long)\n"
gdb_expect {
    -re ".\[0-9\]* = 4.*$gdb_prompt $" {}
    -re ".\[0-9\]* = 8.*$gdb_prompt $" {
	set ulong_minus_1 18446744073709551615
	set ulong_minus_456 18446744073709551160
    }
    -re ".*$gdb_prompt $" {
	 fail "getting sizeof unsigned long"
    }
    default	{ fail "(timeout) getting sizeof unsigned long" }
}

proc test_set { args } {
    global gdb_prompt

    set length [expr [llength $args] - 1];
    set message "[lindex $args $length]";
    set final [expr $length - 2];
    set count 1;

    # Set up the variables.
    for {set x 0;} {$x < $length} {incr x;} {
	if { "[lindex $args $x]" != "" } {
	    set arg [lindex $args $x];
	    if { ($x == $final) || ([string first ".*" [lindex $args [expr $x + 1]]] >= 0) } {
		set match [lindex $args [expr $x + 1]];
		if { $count == 1 } {
		    set mess "$message"
		} else {
		    set mess "$message (#$count)";
		}
		incr count;
		incr x;
	    } else {
		set mess "";
		set match ""
	    }
	    verbose "doing $arg $match"
	    if [gdb_test "$arg" "$match" "$mess"] {
		fail "$message -- $match";
		return 1;
	    }
	}
    }
    return 0;
}

#
# test "set variable" for type "char"
#
# Because bare char types can be either signed or unsigned, we just test the
# range of values that are common to both (0-127).
#    

test_set "set variable v_char=0" "print v_char" ".\[0-9\]* = 0 \'.0\'"        "set variable char=0" 
test_set "set variable v_char=1" "print v_char" ".\[0-9\]* = 1 \'.001\'"        "set variable char=1" 
test_set "set variable v_char=7" "print v_char" ".\[0-9\]* = 7 \'.a\'"        "set variable char=7 (Bel)" 
test_set "set variable v_char=32" "print v_char" ".\[0-9\]* = 32 \' \'"        "set variable char=32 (SPC)" 
test_set "set variable v_char=65" "print v_char" ".\[0-9\]* = 65 \'A\'"        "set variable char=65 ('A')" 
test_set "set variable v_char=97" "print v_char" ".\[0-9\]* = 97 \'a\'"        "set variable char=97 ('a')" 
test_set "set variable v_char=126" "print v_char" ".\[0-9\]* = 126 \'~\'"        "set variable char=126 ('~')" 
test_set "set variable v_char=127" "print v_char" ".\[0-9\]* = 127 \'.177\'"        "set variable char=127 (8-bit)" 
#
# test "set variable" for type "signed char"
#    
test_set "set variable v_char=0" "print v_signed_char" ".\[0-9\]* = 0 \'.0\'"                 "set variable signed char=0" 
test_set "set variable v_signed_char=1" "print v_signed_char" ".\[0-9\]* = 1 \'.001\'"        "set variable signed char=1" 
test_set "set variable v_signed_char=7" "print v_signed_char" ".\[0-9\]* = 7 \'.a\'"        "set variable signed char=7 (Bel)" 
test_set "set variable v_signed_char=32" "print v_signed_char" ".\[0-9\]* = 32 \' \'"        "set variable signed char=32 (SPC)" 
test_set "set variable v_signed_char=65" "print v_signed_char" ".\[0-9\]* = 65 \'A\'"        "set variable signed char=65 ('A')" 
test_set "set variable v_signed_char=97" "print v_signed_char" ".\[0-9\]* = 97 \'a\'"        "set variable signed char=97 ('a')" 
test_set "set variable v_signed_char=126" "print v_signed_char" ".\[0-9\]* = 126 \'~\'"        "set variable signed char=126 ('~')" 
test_set "set variable v_signed_char=127" "print v_signed_char" ".\[0-9\]* = 127 \'.177\'"        "set variable signed char=127 (8-bit)" 
gdb_test "set variable v_signed_char=-1" ""
if {!$gcc_compiled} then { setup_xfail "mips-sgi-irix4*" }
gdb_test "print v_signed_char" ".\[0-9\]* = -1 \'.377\'" \
    "set variable signed char=-1 (-1)"
gdb_test "set variable v_signed_char=0xFF" ""
if {!$gcc_compiled} then { setup_xfail "mips-sgi-irix4*" }
gdb_test "print v_signed_char" ".\[0-9\]* = -1 \'.377\'" \
    "set variable signed char=0xFF (0xFF)"
#
# test "set variable" for type "unsigned char"
#
test_set "set variable v_unsigned_char=0" "print v_unsigned_char" ".\[0-9\]* = 0 \'.0\'"        "set variable unsigned char=0" 
test_set "set variable v_unsigned_char=1" "print v_unsigned_char" ".\[0-9\]* = 1 \'.001\'"        "set variable unsigned char=1" 
test_set "set variable v_unsigned_char=7" "print v_unsigned_char" ".\[0-9\]* = 7 \'.a\'"        "set variable unsigned char=7 (Bel)" 
test_set "set variable v_unsigned_char=32" "print v_unsigned_char" ".\[0-9\]* = 32 \' \'"        "set variable unsigned char=32 (SPC)" 
test_set "set variable v_unsigned_char=65" "print v_unsigned_char" ".\[0-9\]* = 65 \'A\'"        "set variable unsigned char=65 ('A')" 
test_set "set variable v_unsigned_char=97" "print v_unsigned_char" ".\[0-9\]* = 97 \'a\'"        "set variable unsigned char=97 ('a')" 
test_set "set variable v_unsigned_char=126" "print v_unsigned_char" ".\[0-9\]* = 126 \'~\'"        "set variable unsigned char=126 ('~')" 
test_set "set variable v_unsigned_char=~0" "print v_unsigned_char" ".\[0-9\]* = 255 \'.377\'"        "set variable unsigned char=255 (8-bit)" 
#
# test "set variable" for type "short"
#
test_set "set variable v_short=0" "print v_short" ".\[0-9\]* = 0"        "set variable short=0" 
test_set "set variable v_short=1" "print v_short" ".\[0-9\]* = 1"        "set variable short=1" 
test_set "set variable v_short=-1" "print v_short" ".\[0-9\]* = -1"        "set variable short=-1 (minus)" 
#
# test "set variable" for type "signed short"
#
test_set "set variable v_signed_short=0" "print v_signed_short" ".\[0-9\]* = 0"        "set variable signed short=0" 
test_set "set variable v_signed_short=1" "print v_signed_short" ".\[0-9\]* = 1"        "set variable signed short=1" 
test_set "set variable v_signed_short=-1" "print v_signed_short" ".\[0-9\]* = -1"        "set variable signed short=-1 (minus)" 
#
# test "set variable" for type "unsigned short"
#
test_set "set variable v_unsigned_short=0" "print v_unsigned_short" ".\[0-9\]* = 0"        "set variable unsigned short=0" 
test_set "set variable v_unsigned_short=1" "print v_unsigned_short" ".\[0-9\]* = 1"        "set variable unsigned short=1" 
test_set "set variable v_unsigned_short=~0" "print v_unsigned_short" ".\[0-9\]* = 65535"        "set variable unsigned short=~0 (minus)" 
#
# test "set variable" for type "int"
#
test_set "set variable v_int=0" "print v_int" ".\[0-9\]* = 0"        "set variable int=0" 
test_set "set variable v_int=1" "print v_int" ".\[0-9\]* = 1"        "set variable int=1" 
test_set "set variable v_int=-1" "print v_int" ".\[0-9\]* = -1"        "set variable int=-1 (minus)" 
#
# test "set variable" for type "signed int"
#
test_set "set variable v_signed_int=0" "print v_signed_int" ".\[0-9\]* = 0"        "set variable signed int=0" 
test_set "set variable v_signed_int=1" "print v_signed_int" ".\[0-9\]* = 1"        "set variable signed int=1" 
test_set "set variable v_signed_int=-1" "print v_signed_int" ".\[0-9\]* = -1"        "set variable signed int=-1 (minus)" 
#
# test "set variable" for type "unsigned int"
#
test_set "set variable v_unsigned_int=0" "print v_unsigned_int" ".\[0-9\]* = 0"        "set variable unsigned int=0" 
test_set "set variable v_unsigned_int=1" "print v_unsigned_int" ".\[0-9\]* = 1"        "set variable unsigned int=1" 
test_set "set variable v_unsigned_int=~0" "print v_unsigned_int" ".\[0-9\]* = (4294967295|65535)"        "set variable unsigned int=~0 (minus)" 
#test_set ".\[0-9\]* = 65535"        "set variable unsigned int=~0 (minus)" 
#
# test "set variable" for type "long"
#
test_set "set variable v_long=0" "print v_long" ".\[0-9\]* = 0"        "set variable long=0" 
test_set "set variable v_long=1" "print v_long" ".\[0-9\]* = 1"        "set variable long=1" 
test_set "set variable v_long=-1" "print v_long" ".\[0-9\]* = -1"        "set variable long=-1 (minus)" 
#
# test "set variable" for type "signed long"
#
test_set "set variable v_signed_long=0" "print v_signed_long" ".\[0-9\]* = 0"        "set variable signed long=0" 
test_set "set variable v_signed_long=1" "print v_signed_long" ".\[0-9\]* = 1"        "set variable signed long=1" 
test_set "set variable v_signed_long=-1" "print v_signed_long" ".\[0-9\]* = -1"        "set variable signed long=-1 (minus)" 
#
# test "set variable" for type "unsigned long"
#
test_set "set variable v_unsigned_long=0" "print v_unsigned_long" ".\[0-9\]* = 0"        "set variable unsigned long=0" 
test_set "set variable v_unsigned_long=1" "print v_unsigned_long" ".\[0-9\]* = 1"        "set variable unsigned long=1" 
test_set "set variable v_unsigned_long=~0" "print v_unsigned_long" ".\[0-9\]* = $ulong_minus_1"        "set variable unsigned long=~0 (minus)" 
#
# test "set variable" for type "float"
#
test_set "set variable v_float=0.0" "print v_float" ".\[0-9\]* = 0"        "set variable float=0" 
test_set "set variable v_float=1.0" "print v_float" ".\[0-9\]* = 1"        "set variable float=1" 
test_set "set variable v_float=-1.0" "print v_float" ".\[0-9\]* = -1"        "set variable float=-1 (minus)" 
#
# test "set variable" for type "double"
#
test_set "set variable v_double=0.0" "print v_double" ".\[0-9\]* = 0"        "set variable double=0" 
test_set "set variable v_double=1.0" "print v_double" ".\[0-9\]* = 1"        "set variable double=1" 
test_set "set variable v_double=-1.0" "print v_double" ".*.\[0-9\]* = -1"        "set variable double=-1 (minus)" 
#
# test "set variable" for "char array[2]"
#
test_set "set variable v_char_array\[0\]='h'" "set variable v_char_array\[1\]='i'" "print v_char_array" ".*.\[0-9\]* =.*\"hi\""        "set variable char array=\"hi\" (string)" 
#
# test "set variable" for "signed char array[2]"
#
test_set "set variable v_signed_char_array\[0\]='h'" "set variable v_signed_char_array\[1\]='i'" "print v_signed_char_array" ".*.\[0-9\]* =.*\"hi\""        "set variable signed char array=\"hi\" (string)" 
#
# test "set variable" for "unsigned char array[2]"
#
test_set "set variable v_unsigned_char_array\[0\]='h'" "set variable v_unsigned_char_array\[1\]='i'" "print v_unsigned_char_array" ".*.\[0-9\]* =.*\"hi\""        "set variable unsigned char array=\"hi\" (string)" 
#
# test "set variable" for "short array[2]"
#
test_set "set variable v_short_array\[0\]=123" "set variable v_short_array\[1\]=-456" "print v_short_array" ".*.\[0-9\]* =.*\\{123,.*-456\\}"        "set variable short array" 
#
# test "set variable" for "signed short array[2]"
#
test_set "set variable v_signed_short_array\[0\]=123" "set variable v_signed_short_array\[1\]=-456" "print v_signed_short_array" ".*.\[0-9\]* =.*\\{123,.*-456\\}"        "set variable signed short array" 
#
# test "set variable" for "unsigned short array[2]"
#
test_set "set variable v_unsigned_short_array\[0\]=123" "set variable v_unsigned_short_array\[1\]=-456" "print v_unsigned_short_array" ".*.\[0-9\]* =.*\\{123,.*65080\\}"        "set variable unsigned short array" 
#
# test "set variable" for "int array[2]"
#
test_set "set variable v_int_array\[0\]=123" "set variable v_int_array\[1\]=-456" "print v_int_array" ".*.\[0-9\]* =.*\\{123,.*-456\\}"        "set variable int array" 
#
# test "set variable" for "signed int array[2]"
#
test_set "set variable v_signed_int_array\[0\]=123" "set variable v_signed_int_array\[1\]=-456" "print v_signed_int_array" ".*.\[0-9\]* =.*\\{123,.*-456\\}"        "set variable signed int array" 
#
# test "set variable" for "unsigned int array[2]"
#
test_set "set variable v_unsigned_int_array\[0\]=123" "set variable v_unsigned_int_array\[1\]=-456" "print v_unsigned_int_array" ".*.\[0-9\]* =.*\\{123,.*(4294966840|65080)\\}"        "set variable unsigned int array" 
#
# test "set variable" for "long array[2]"
#
test_set "set variable v_long_array\[0\]=123" "set variable v_long_array\[1\]=-456" "print v_long_array" ".*.\[0-9\]* =.*\\{123,.*-456\\}"        "set variable long array" 
#
# test "set variable" for "signed long array[2]"
#
test_set "set variable v_signed_long_array\[0\]=123" "set variable v_signed_long_array\[1\]=-456" "print v_signed_long_array" ".*.\[0-9\]* =.*\\{123,.*-456\\}"        "set variable signed long array" 
#
# test "set variable" for "unsigned long array[2]"
#
test_set "set variable v_unsigned_long_array\[0\]=123" "set variable v_unsigned_long_array\[1\]=-456" "print v_unsigned_long_array" ".*.\[0-9\]* =.*\\{123,.*$ulong_minus_456\\}"        "set variable unsigned long array" 
#
# test "set variable" for "float array[2]"
#
test_set "set variable v_float_array\[0\]=123.0" "set variable v_float_array\[1\]=-456.0" "print v_float_array" ".*.\[0-9\]* =.*\\{123,.*-456\\}"        "set variable float array" 
#
# test "set variable" for "double array[2]"
#
test_set "set variable v_double_array\[0\]=123.0" "set variable v_double_array\[1\]=-456.0" "print v_double_array" ".*.\[0-9\]* =.*\\{123,.*-456\\}"        "set variable double array" 
#
# test "set variable" for type "char *"
#
test_set "set v_char_pointer=v_char_array" "set variable *(v_char_pointer)='h'" "set variable *(v_char_pointer+1)='i'" "print v_char_array" ".*.\[0-9\]* =.*\"hi\""  "print *(v_char_pointer+1)" ".*.\[0-9\]* = 105 \'i\'"     "set variable char pointer=\"hi\" (string)" 
#
# test "set variable" for type "signed char *"
#
test_set "set v_signed_char_pointer=v_signed_char_array" "set variable *(v_signed_char_pointer)='h'" "set variable *(v_signed_char_pointer+1)='i'" "print v_signed_char_array" ".*.\[0-9\]* =.*\"hi\""  "print *(v_signed_char_pointer+1)" ".*.\[0-9\]* = 105 \'i\'"     "set variable signed char pointer=\"hi\" (string)" 
#
# test "set variable" for type "unsigned char *"
#
test_set "set v_unsigned_char_pointer=v_unsigned_char_array" "set variable *(v_unsigned_char_pointer)='h'" "set variable *(v_unsigned_char_pointer+1)='i'" "print v_unsigned_char_array" ".*.\[0-9\]* =.*\"hi\""  "print *(v_unsigned_char_pointer+1)" ".*.\[0-9\]* = 105 \'i\'"     "set variable unsigned char pointer=\"hi\" (string)" 
#
# test "set variable" for type "short *"
#
test_set "set v_short_pointer=v_short_array" "set variable *(v_short_pointer)=123" "set variable *(v_short_pointer+1)=-456" "print v_short_array" ".*.\[0-9\]* =.*\\{123,.*-456\\}"  "print *(v_short_pointer+1)" ".*.\[0-9\]* = -456"     "set variable short pointer" 
#
# test "set variable" for type "signed short *"
#
gdb_test "set v_signed_short_pointer=v_signed_short_array" ""
gdb_test "set variable *(v_signed_short_pointer)=123" ""
gdb_test "set variable *(v_signed_short_pointer+1)=-456" ""
gdb_test "print v_signed_short_array" ".\[0-9\]* =.*\\{123,.*-456\\}" \
    "set variable signed short pointer"
gdb_test "print *(v_signed_short_pointer+1)" ".\[0-9\]*.*=.*-456"
#
# test "set variable" for type "unsigned short *"
#
gdb_test "set v_unsigned_short_pointer=v_unsigned_short_array" ""
gdb_test "set variable *(v_unsigned_short_pointer)=123" ""
gdb_test "set variable *(v_unsigned_short_pointer+1)=-456" ""
gdb_test "print v_unsigned_short_array" ".\[0-9\]* =.*\\{123,.*65080\\}" \
    "set variable unsigned short pointer"
gdb_test "print *(v_unsigned_short_pointer+1)" ".\[0-9\]* = 65080"
#
# test "set variable" for type "int *"
#
test_set "set v_int_pointer=v_int_array" "set variable *(v_int_pointer)=123" "set variable *(v_int_pointer+1)=-456" "print v_int_array" ".*.\[0-9\]* =.*\\{123,.*-456\\}"  "print *(v_int_pointer+1)" ".*.\[0-9\]* = -456"     "set variable int pointer" 
#
# test "set variable" for type "signed int *"
#
test_set "set v_signed_int_pointer=v_signed_int_array" "set variable *(v_signed_int_pointer)=123" "set variable *(v_signed_int_pointer+1)=-456" "print v_signed_int_array" ".*.\[0-9\]* =.*\\{123,.*-456\\}"  "print *(v_signed_int_pointer+1)" ".*.\[0-9\]* = -456"     "set variable signed int pointer" 
#
# test "set variable" for type "unsigned int *"
#
test_set "set v_unsigned_int_pointer=v_unsigned_int_array" "set variable *(v_unsigned_int_pointer)=123" "set variable *(v_unsigned_int_pointer+1)=-456" "print v_unsigned_int_array" ".*.\[0-9\]* =.*\\{123,.*(4294966840|65080)\\}" "set variable unsigned int pointer"
test_set "" "print *(v_unsigned_int_pointer+1)" ".*.\[0-9\]* = (4294966840|65080)"     "print variable unsigned int pointer+1"
#
# test "set variable" for type "long *"
#
test_set "set v_long_pointer=v_long_array" "set variable *(v_long_pointer)=123" "set variable *(v_long_pointer+1)=-456" "print v_long_array" ".*.\[0-9\]* =.*\\{123,.*-456\\}"  "print *(v_long_pointer+1)" ".*.\[0-9\]* = -456"     "set variable long pointer" 
#
# test "set variable" for type "signed long *"
#
test_set "set v_signed_long_pointer=v_signed_long_array" "set variable *(v_signed_long_pointer)=123" "set variable *(v_signed_long_pointer+1)=-456" "print v_signed_long_array" ".*.\[0-9\]* =.*\\{123,.*-456\\}"  "print *(v_signed_long_pointer+1)" ".*.\[0-9\]* = -456"     "set variable signed long pointer" 
#
# test "set variable" for type "unsigned long *"
#
test_set "set v_unsigned_long_pointer=v_unsigned_long_array" "set variable *(v_unsigned_long_pointer)=123" "set variable *(v_unsigned_long_pointer+1)=-456" "print v_unsigned_long_array" ".*.\[0-9\]* =.*\\{123,.*$ulong_minus_456\\}"  "print *(v_unsigned_long_pointer+1)" ".*.\[0-9\]* = $ulong_minus_456"     "set variable unsigned long pointer" 
#
# test "set variable" for type "float *"
#
test_set "set v_float_pointer=v_float_array" "set variable *(v_float_pointer)=123.0" "set variable *(v_float_pointer+1)=-456.0" "print v_float_array" ".*.\[0-9\]* =.*\\{123,.*-456\\}"  "print *(v_float_pointer+1)" ".*.\[0-9\]* = -456"     "set variable float pointer" 
#
# test "set variable" for type "double *"
#
test_set "set v_double_pointer=v_double_array" "set variable *(v_double_pointer)=123.0" "set variable *(v_double_pointer+1)=-456.0" "print v_double_array" ".*.\[0-9\]* =.*\\{123,.*-456\\}"  "print *(v_double_pointer+1)" ".*.\[0-9\]* = -456"     "set variable double pointer" 
#
# test "set variable" for struct members
#
test_set "set variable v_struct1.v_char_member='h'" "print v_struct1.v_char_member" ".*.\[0-9\]* = 104 \'h\'"        "set variable structure char member" 
test_set "set variable v_struct1.v_short_member=1" "print v_struct1.v_short_member" ".*.\[0-9\]* = 1"        "set variable structure short member" 
test_set "set variable v_struct1.v_int_member=2" "print v_struct1.v_int_member" ".*.\[0-9\]* = 2"        "set variable structure int member" 
test_set "set variable v_struct1.v_long_member=3" "print v_struct1.v_long_member" ".*.\[0-9\]* = 3"        "set variable structure long member" 
test_set "set variable v_struct1.v_float_member=4.0" "print v_struct1.v_float_member" ".*.\[0-9\]* = 4"        "set variable structure float member" 
test_set "set variable v_struct1.v_double_member=5.0" "print v_struct1.v_double_member" ".*.\[0-9\]* = 5"        "set variable structure double member" 

gdb_test "print v_struct1" \
  ".*.\[0-9\]* = \{.*v_char_member = 104 \'h\',.*v_short_member = 1,\
.*v_int_member = 2,.*\
v_long_member = 3,.*v_float_member = 4,.*v_double_member = 5.*\}" \
  "set print structure #1"

# Some believe that the following  should be an error.  GCC extensions for
# structure constants require the type of the structure to be specified, as in
# v_struct1 = (struct t_struct) {32, 33, 34, 35, 36, 37}
# The argument is that GDB should do the same if it wants to provide this
# feature, i.e., require the cast.
# We decided that we don't want the debugger to be as picky as a
# compiler and make us type complex casts.

# We need to up this because this can be really slow on some boards.
# (malloc() is called as part of the test).
set timeout 60;

# Change the values
test_set "set variable v_struct1 = {32, 33, 34, 35, 36, 37}" \
  "print v_struct1" \
  ".*.\[0-9\]* = \\{.*v_char_member = 32 \' \',.*v_short_member = 33,\
.*v_int_member = 34,.*\
v_long_member = 35,.*v_float_member = 36,.*v_double_member = 37.*\\}" \
  "set print structure #2"

# Change them back
test_set "set variable v_struct1 = {'h', 1, 2, 3, 4.0, 5.0}" \
  "print v_struct1" \
  ".*.\[0-9\]* = \\{.*v_char_member = 104 \'h\',.*v_short_member = 1,\
.*v_int_member = 2,.*\
v_long_member = 3,.*v_float_member = 4,.*v_double_member = 5.*\\}" \
  "set print structure #3"

# Test printing of enumeration bitfields.
# GNU C supports them, some other compilers don't.

if {$gcc_compiled} then {
    gdb_test "print sef.field=sm1" ".*.\[0-9\]* = sm1"
    gdb_test "print sef.field" ".*.\[0-9\]* = sm1" "print sef.field (sm1)"
    gdb_test "print sef.field=s1" ".*.\[0-9\]* = s1"
    gdb_test "print sef.field" ".*.\[0-9\]* = s1" "print sef.field (s1)"
    gdb_test "print uef.field=u2" ".*.\[0-9\]* = u2"
    gdb_test "print uef.field" ".*.\[0-9\]* = u2" "print uef.field (u2)"
    gdb_test "print uef.field=u1" ".*.\[0-9\]* = u1"
    gdb_test "print uef.field" ".*.\[0-9\]* = u1" "print uef.field (u1)"

    # Test for truncation when assigning invalid values to bitfields.
    gdb_test "print sef.field=7" \
	".*warning: Value does not fit in 2 bits.*\[0-9\]* = sm1"
    gdb_test "print uef.field=6" \
	".*warning: Value does not fit in 2 bits.*\[0-9\]* = u2"
}
@


1.2
log
@Merge to Cygnus 961112 + add some support (not ready) for shared libs
@
text
@d1 4
a4 2
#   Copyright (C) 1988, 1990, 1991, 1992, 1994, 1995
#   Free Software Foundation, Inc.
d18 1
a18 1
# Foundation, Inc., 59 Temple Place - Suite 330, Boston, MA 02111-1307, USA.  */
d21 1
a21 1
# bug-gdb@@prep.ai.mit.edu
d38 2
a39 3
if  { [compile "${srcdir}/${subdir}/${srcfile} -g -o ${binfile}"] != "" } {
    perror "Couldn't compile ${srcfile}"
    return -1
d44 2
a45 4
execute_anywhere "rm -f ${binfile}.ci"
if  { [compile "-E ${srcdir}/${subdir}/compiler.c > ${binfile}.ci"] != "" } {
    perror "Couldn't make ${binfile}.ci file"
    return -1
a46 1
source ${binfile}.ci
d56 1
a56 1
send "set print sevenbit-strings\n" ; expect -re "$prompt $"
d68 4
a71 4
send "print sizeof (unsigned long)\n"
expect {
    -re ".\[0-9\]* = 4.*$prompt $" {}
    -re ".\[0-9\]* = 8.*$prompt $" {
d75 1
a75 1
    -re ".*$prompt $" {
d81 35
a121 127
send "set variable v_char=0\n"
expect {
    -re "$prompt $"\
	{
	send "print v_char\n"
	expect {
	    -re ".\[0-9\]* = 0 \'.000\'.*$prompt $"       { pass "set variable char=0" }
	    -re "$prompt $"                      { fail "set variable char=0" }
	    timeout                              { fail "(timeout) set variable char=0" }
	}
    }
    -re "$prompt $"                              { fail "set variable char=0" }
    timeout                                      { fail "(timeout) set variable char=0" }
}                         


send "set variable v_char=1\n"
expect {
    -re "$prompt $"\
	{
	send "print v_char\n"
	expect {
	    -re ".\[0-9\]* = 1 \'.001\'.*$prompt $"       { pass "set variable char=1" }
	    -re "$prompt $"                      { fail "set variable char=1" }
	    timeout                              { fail "(timeout) set variable char=1" }
	}
    }
    -re "$prompt $"                              { fail "set variable char=1" }
    timeout                                      { fail "(timeout) set variable char=1" }
}                         


send "set variable v_char=27\n"
expect {
    -re "$prompt $"\
	{
	send "print v_char\n"
	expect {
	    -re ".\[0-9\]* = 27 \'.e\'.*$prompt $"       { pass "set variable char=27 (Esc)" }
	    -re "$prompt $"                      { fail "set variable char=27 (Esc)" }
	    timeout                              { fail "(timeout) set variable char=27 (Esc)" }
	}
    }
    -re "$prompt $"                              { fail "set variable char=27 (Esc)" }
    timeout                                      { fail "(timeout) set variable char=27 (Esc)" }
}                         


send "set variable v_char=32\n"
expect {
    -re "$prompt $"\
	{
	send "print v_char\n"
	expect {
	    -re ".\[0-9\]* = 32 \' \'.*$prompt $"       { pass "set variable char=32 (SPC)" }
	    -re "$prompt $"                      { fail "set variable char=32 (SPC)" }
	    timeout                              { fail "(timeout) set variable char=32 (SPC)" }
	}
    }
    -re "$prompt $"                              { fail "set variable char=32 (SPC)" }
    timeout                                      { fail "(timeout) set variable char=32 (SPC)" }
}                         


send "set variable v_char=65\n"
expect {
    -re "$prompt $"\
	{
	send "print v_char\n"
	expect {
	    -re ".\[0-9\]* = 65 \'A\'.*$prompt $"       { pass "set variable char=65 ('A')" }
	    -re "$prompt $"                      { fail "set variable char=65 ('A')" }
	    timeout                              { fail "(timeout) set variable char=65 ('A')" }
	}
    }
    -re "$prompt $"                              { fail "set variable char=65 ('A')" }
    timeout                                      { fail "(timeout) set variable char=65 ('A')" }
}                         


send "set variable v_char=97\n"
expect {
    -re "$prompt $"\
	{
	send "print v_char\n"
	expect {
	    -re ".\[0-9\]* = 97 \'a\'.*$prompt $"       { pass "set variable char=97 ('a')" }
	    -re "$prompt $"                      { fail "set variable char=97 ('a')" }
	    timeout                              { fail "(timeout) set variable char=97 ('a')" }
	}
    }
    -re "$prompt $"                              { fail "set variable char=97 ('a')" }
    timeout                                      { fail "(timeout) set variable char=97 ('a')" }
}                         


send "set variable v_char=126\n"
expect {
    -re "$prompt $"\
	{
	send "print v_char\n"
	expect {
	    -re ".\[0-9\]* = 126 \'~\'.*$prompt $"       { pass "set variable char=126 ('~')" }
	    -re "$prompt $"                      { fail "set variable char=126 ('~')" }
	    timeout                              { fail "(timeout) set variable char=126 ('~')" }
	}
    }
    -re "$prompt $"                              { fail "set variable char=126 ('~')" }
    timeout                                      { fail "(timeout) set variable char=126 ('~')" }
}                         


send "set variable v_char=127\n"
expect {
    -re "$prompt $"\
	{
	send "print v_char\n"
	expect {
	    -re ".\[0-9\]* = 127 \'.177\'.*$prompt $"       { pass "set variable char=127 (8-bit)" }
	    -re "$prompt $"                      { fail "set variable char=127 (8-bit)" }
	    timeout                              { fail "(timeout) set variable char=127 (8-bit)" }
	}
    }
    -re "$prompt $"                              { fail "set variable char=127 (8-bit)" }
    timeout                                      { fail "(timeout) set variable char=127 (8-bit)" }
}                         

d123 8
d134 8
a141 128
send "set variable v_char=0\n"
expect {
    -re "$prompt $"\
	{
	send "print v_signed_char\n"
	expect {
	    -re ".\[0-9\]* = 0 \'.000\'.*$prompt $"       { pass "set variable signed char=0" }
	    -re "$prompt $"                      { fail "set variable signed char=0" }
	    timeout                              { fail "(timeout) set variable signed char=0" }
	}
    }
    -re "$prompt $"                              { fail "set variable signed char=0" }
    timeout                                      { fail "(timeout) set variable signed char=0" }
}                         


send "set variable v_signed_char=1\n"
expect {
    -re "$prompt $"\
	{
	send "print v_signed_char\n"
	expect {
	    -re ".\[0-9\]* = 1 \'.001\'.*$prompt $"       { pass "set variable signed char=1" }
	    -re "$prompt $"                      { fail "set variable signed char=1" }
	    timeout                              { fail "(timeout) set variable signed char=1" }
	}
    }
    -re "$prompt $"                              { fail "set variable signed char=1" }
    timeout                                      { fail "(timeout) set variable signed char=1" }
}                         


send "set variable v_signed_char=27\n"
expect {
    -re "$prompt $"\
	{
	send "print v_signed_char\n"
	expect {
	    -re ".\[0-9\]* = 27 \'.e\'.*$prompt $"       { pass "set variable signed char=27 (Esc)" }
	    -re "$prompt $"                      { fail "set variable signed char=27 (Esc)" }
	    timeout                              { fail "(timeout) set variable signed char=27 (Esc)" }
	}
    }
    -re "$prompt $"                              { fail "set variable signed char=27 (Esc)" }
    timeout                                      { fail "(timeout) set variable signed char=27 (Esc)" }
}                         


send "set variable v_signed_char=32\n"
expect {
    -re "$prompt $"\
	{
	send "print v_signed_char\n"
	expect {
	    -re ".\[0-9\]* = 32 \' \'.*$prompt $"       { pass "set variable signed char=32 (SPC)" }
	    -re "$prompt $"                      { fail "set variable signed char=32 (SPC)" }
	    timeout                              { fail "(timeout) set variable signed char=32 (SPC)" }
	}
    }
    -re "$prompt $"                              { fail "set variable signed char=32 (SPC)" }
    timeout                                      { fail "(timeout) set variable signed char=32 (SPC)" }
}                         


send "set variable v_signed_char=65\n"
expect {
    -re "$prompt $"\
	{
	send "print v_signed_char\n"
	expect {
	    -re ".\[0-9\]* = 65 \'A\'.*$prompt $"       { pass "set variable signed char=65 ('A')" }
	    -re "$prompt $"                      { fail "set variable signed char=65 ('A')" }
	    timeout                              { fail "(timeout) set variable signed char=65 ('A')" }
	}
    }
    -re "$prompt $"                              { fail "set variable signed char=65 ('A')" }
    timeout                                      { fail "(timeout) set variable signed char=65 ('A')" }
}                         


send "set variable v_signed_char=97\n"
expect {
    -re "$prompt $"\
	{
	send "print v_signed_char\n"
	expect {
	    -re ".\[0-9\]* = 97 \'a\'.*$prompt $"       { pass "set variable signed char=97 ('a')" }
	    -re "$prompt $"                      { fail "set variable signed char=97 ('a')" }
	    timeout                              { fail "(timeout) set variable signed char=97 ('a')" }
	}
    }
    -re "$prompt $"                              { fail "set variable signed char=97 ('a')" }
    timeout                                      { fail "(timeout) set variable signed char=97 ('a')" }
}                         


send "set variable v_signed_char=126\n"
expect {
    -re "$prompt $"\
	{
	send "print v_signed_char\n"
	expect {
	    -re ".\[0-9\]* = 126 \'~\'.*$prompt $"       { pass "set variable signed char=126 ('~')" }
	    -re "$prompt $"                      { fail "set variable signed char=126 ('~')" }
	    timeout                              { fail "(timeout) set variable signed char=126 ('~')" }
	}
    }
    -re "$prompt $"                              { fail "set variable signed char=126 ('~')" }
    timeout                                      { fail "(timeout) set variable signed char=126 ('~')" }
}                         


send "set variable v_signed_char=127\n"
expect {
    -re "$prompt $"\
	{
	send "print v_signed_char\n"
	expect {
	    -re ".\[0-9\]* = 127 \'.177\'.*$prompt $"       { pass "set variable signed char=127 (8-bit)" }
	    -re "$prompt $"                      { fail "set variable signed char=127 (8-bit)" }
	    timeout                              { fail "(timeout) set variable signed char=127 (8-bit)" }
	}
    }
    -re "$prompt $"                              { fail "set variable signed char=127 (8-bit)" }
    timeout                                      { fail "(timeout) set variable signed char=127 (8-bit)" }
}                         


a145 1

a149 2


d153 8
a160 128
send "set variable v_unsigned_char=0\n"
expect {
    -re "$prompt $"\
	{
	send "print v_unsigned_char\n"
	expect {
	    -re ".\[0-9\]* = 0 \'.000\'.*$prompt $"       { pass "set variable unsigned char=0" }
	    -re "$prompt $"                      { fail "set variable unsigned char=0" }
	    timeout                              { fail "(timeout) set variable unsigned char=0" }
	}
    }
    -re "$prompt $"                              { fail "set variable unsigned char=0" }
    timeout                                      { fail "(timeout) set variable unsigned char=0" }
}                         


send "set variable v_unsigned_char=1\n"
expect {
    -re "$prompt $"\
	{
	send "print v_unsigned_char\n"
	expect {
	    -re ".\[0-9\]* = 1 \'.001\'.*$prompt $"       { pass "set variable unsigned char=1" }
	    -re "$prompt $"                      { fail "set variable unsigned char=1" }
	    timeout                              { fail "(timeout) set variable unsigned char=1" }
	}
    }
    -re "$prompt $"                              { fail "set variable unsigned char=1" }
    timeout                                      { fail "(timeout) set variable unsigned char=1" }
}                         


send "set variable v_unsigned_char=27\n"
expect {
    -re "$prompt $"\
	{
	send "print v_unsigned_char\n"
	expect {
	    -re ".\[0-9\]* = 27 \'.e\'.*$prompt $"       { pass "set variable unsigned char=27 (Esc)" }
	    -re "$prompt $"                      { fail "set variable unsigned char=27 (Esc)" }
	    timeout                              { fail "(timeout) set variable unsigned char=27 (Esc)" }
	}
    }
    -re "$prompt $"                              { fail "set variable unsigned char=27 (Esc)" }
    timeout                                      { fail "(timeout) set variable unsigned char=27 (Esc)" }
}                         


send "set variable v_unsigned_char=32\n"
expect {
    -re "$prompt $"\
	{
	send "print v_unsigned_char\n"
	expect {
	    -re ".\[0-9\]* = 32 \' \'.*$prompt $"       { pass "set variable unsigned char=32 (SPC)" }
	    -re "$prompt $"                      { fail "set variable unsigned char=32 (SPC)" }
	    timeout                              { fail "(timeout) set variable unsigned char=32 (SPC)" }
	}
    }
    -re "$prompt $"                              { fail "set variable unsigned char=32 (SPC)" }
    timeout                                      { fail "(timeout) set variable unsigned char=32 (SPC)" }
}                         


send "set variable v_unsigned_char=65\n"
expect {
    -re "$prompt $"\
	{
	send "print v_unsigned_char\n"
	expect {
	    -re ".\[0-9\]* = 65 \'A\'.*$prompt $"       { pass "set variable unsigned char=65 ('A')" }
	    -re "$prompt $"                      { fail "set variable unsigned char=65 ('A')" }
	    timeout                              { fail "(timeout) set variable unsigned char=65 ('A')" }
	}
    }
    -re "$prompt $"                              { fail "set variable unsigned char=65 ('A')" }
    timeout                                      { fail "(timeout) set variable unsigned char=65 ('A')" }
}                         


send "set variable v_unsigned_char=97\n"
expect {
    -re "$prompt $"\
	{
	send "print v_unsigned_char\n"
	expect {
	    -re ".\[0-9\]* = 97 \'a\'.*$prompt $"       { pass "set variable unsigned char=97 ('a')" }
	    -re "$prompt $"                      { fail "set variable unsigned char=97 ('a')" }
	    timeout                              { fail "(timeout) set variable unsigned char=97 ('a')" }
	}
    }
    -re "$prompt $"                              { fail "set variable unsigned char=97 ('a')" }
    timeout                                      { fail "(timeout) set variable unsigned char=97 ('a')" }
}                         


send "set variable v_unsigned_char=126\n"
expect {
    -re "$prompt $"\
	{
	send "print v_unsigned_char\n"
	expect {
	    -re ".\[0-9\]* = 126 \'~\'.*$prompt $"       { pass "set variable unsigned char=126 ('~')" }
	    -re "$prompt $"                      { fail "set variable unsigned char=126 ('~')" }
	    timeout                              { fail "(timeout) set variable unsigned char=126 ('~')" }
	}
    }
    -re "$prompt $"                              { fail "set variable unsigned char=126 ('~')" }
    timeout                                      { fail "(timeout) set variable unsigned char=126 ('~')" }
}                         


send "set variable v_unsigned_char=~0\n"
expect {
    -re "$prompt $"\
	{
	send "print v_unsigned_char\n"
	expect {
	    -re ".\[0-9\]* = 255 \'.377\'.*$prompt $"       { pass "set variable unsigned char=255 (8-bit)" }
	    -re "$prompt $"                      { fail "set variable unsigned char=255 (8-bit)" }
	    timeout                              { fail "(timeout) set variable unsigned char=255 (8-bit)" }
	}
    }
    -re "$prompt $"                              { fail "set variable unsigned char=255 (8-bit)" }
    timeout                                      { fail "(timeout) set variable unsigned char=255 (8-bit)" }
}                         


d164 3
a166 48
send "set variable v_short=0\n"
expect {
    -re "$prompt $"\
	{
	send "print v_short\n"
	expect {
	    -re ".\[0-9\]* = 0.*$prompt $"       { pass "set variable short=0" }
	    -re "$prompt $"                      { fail "set variable short=0" }
	    timeout                              { fail "(timeout) set variable short=0" }
	}
    }
    -re "$prompt $"                              { fail "set variable short=0" }
    timeout                                      { fail "(timeout) set variable short=0" }
}                         


send "set variable v_short=1\n"
expect {
    -re "$prompt $"\
	{
	send "print v_short\n"
	expect {
	    -re ".\[0-9\]* = 1.*$prompt $"       { pass "set variable short=1" }
	    -re "$prompt $"                      { fail "set variable short=1" }
	    timeout                              { fail "(timeout) set variable short=1" }
	}
    }
    -re "$prompt $"                              { fail "set variable short=1" }
    timeout                                      { fail "(timeout) set variable short=1" }
}                         


send "set variable v_short=-1\n"
expect {
    -re "$prompt $"\
	{
	send "print v_short\n"
	expect {
	    -re ".\[0-9\]* = -1.*$prompt $"       { pass "set variable short=-1 (minus)" }
	    -re "$prompt $"                      { fail "set variable short=-1 (minus)" }
	    timeout                              { fail "(timeout) set variable signed short=-1 (minus)" }
	}
    }
    -re "$prompt $"                              { fail "set variable short=-1 (minus)" }
    timeout                                      { fail "(timeout) set variable short=-1 (minus)" }
}                         


d170 3
a172 48
send "set variable v_signed_short=0\n"
expect {
    -re "$prompt $"\
	{
	send "print v_signed_short\n"
	expect {
	    -re ".\[0-9\]* = 0.*$prompt $"       { pass "set variable signed short=0" }
	    -re "$prompt $"                      { fail "set variable signed short=0" }
	    timeout                              { fail "(timeout) set variable signed short=0" }
	}
    }
    -re "$prompt $"                              { fail "set variable signed short=0" }
    timeout                                      { fail "(timeout) set variable signed short=0" }
}                         


send "set variable v_signed_short=1\n"
expect {
    -re "$prompt $"\
	{
	send "print v_signed_short\n"
	expect {
	    -re ".\[0-9\]* = 1.*$prompt $"       { pass "set variable signed short=1" }
	    -re "$prompt $"                      { fail "set variable signed short=1" }
	    timeout                              { fail "(timeout) set variable signed short=1" }
	}
    }
    -re "$prompt $"                              { fail "set variable signed short=1" }
    timeout                                      { fail "(timeout) set variable signed short=1" }
}                         


send "set variable v_signed_short=-1\n"
expect {
    -re "$prompt $"\
	{
	send "print v_signed_short\n"
	expect {
	    -re ".\[0-9\]* = -1.*$prompt $"       { pass "set variable signed short=-1 (minus)" }
	    -re "$prompt $"                      { fail "set variable signed short=-1 (minus)" }
	    timeout                              { fail "(timeout) set variable signed short=-1 (minus)" }
	}
    }
    -re "$prompt $"                              { fail "set variable signed short=-1 (minus)" }
    timeout                                      { fail "(timeout) set variable signed short=-1 (minus)" }
}                         


d176 3
a178 48
send "set variable v_unsigned_short=0\n"
expect {
    -re "$prompt $"\
	{
	send "print v_unsigned_short\n"
	expect {
	    -re ".\[0-9\]* = 0.*$prompt $"       { pass "set variable unsigned short=0" }
	    -re "$prompt $"                      { fail "set variable unsigned short=0" }
	    timeout                              { fail "(timeout) set variable unsigned short=0" }
	}
    }
    -re "$prompt $"                              { fail "set variable unsigned short=0" }
    timeout                                      { fail "(timeout) set variable unsigned short=0" }
}                         


send "set variable v_unsigned_short=1\n"
expect {
    -re "$prompt $"\
	{
	send "print v_unsigned_short\n"
	expect {
	    -re ".\[0-9\]* = 1.*$prompt $"       { pass "set variable unsigned short=1" }
	    -re "$prompt $"                      { fail "set variable unsigned short=1" }
	    timeout                              { fail "(timeout) set variable unsigned short=1" }
	}
    }
    -re "$prompt $"                              { fail "set variable unsigned short=1" }
    timeout                                      { fail "(timeout) set variable unsigned short=1" }
}                         


send "set variable v_unsigned_short=~0\n"
expect {
    -re "$prompt $"\
	{
	send "print v_unsigned_short\n"
	expect {
	    -re ".\[0-9\]* = 65535.*$prompt $"       { pass "set variable unsigned short=~0 (minus)" }
	    -re "$prompt $"                      { fail "set variable unsigned short=~0 (minus)" }
	    timeout                              { fail "(timeout)  set variable unsigned short=~0 (minus)" }
	}
    }
    -re "$prompt $"                              { fail "set variable unsigned short=~0 (minus)" }
    timeout                                      { fail "(timeout) set variable unsigned short=~0 (minus)" }
}                         


d182 3
a184 48
send "set variable v_int=0\n"
expect {
    -re "$prompt $"\
	{
	send "print v_int\n"
	expect {
	    -re ".\[0-9\]* = 0.*$prompt $"       { pass "set variable int=0" }
	    -re "$prompt $"                      { fail "set variable int=0" }
	    timeout                              { fail "(timeout) set variable int=0" }
	}
    }
    -re "$prompt $"                              { fail "set variable int=0" }
    timeout                                      { fail "(timeout) set variable int=0" }
}                         


send "set variable v_int=1\n"
expect {
    -re "$prompt $"\
	{
	send "print v_int\n"
	expect {
	    -re ".\[0-9\]* = 1.*$prompt $"       { pass "set variable int=1" }
	    -re "$prompt $"                      { fail "set variable int=1" }
	    timeout                              { fail "(timeout) set variable int=1" }
	}
    }
    -re "$prompt $"                              { fail "set variable int=1" }
    timeout                                      { fail "(timeout) set variable int=1" }
}                         


send "set variable v_int=-1\n"
expect {
    -re "$prompt $"\
	{
	send "print v_int\n"
	expect {
	    -re ".\[0-9\]* = -1.*$prompt $"       { pass "set variable int=-1 (minus)" }
	    -re "$prompt $"                      { fail "set variable int=-1 (minus)" }
	    timeout                              { fail "(timeout) set variable signed int=-1 (minus)" }
	}
    }
    -re "$prompt $"                              { fail "set variable int=-1 (minus)" }
    timeout                                      { fail "(timeout) set variable int=-1 (minus)" }
}                         


d188 3
a190 48
send "set variable v_signed_int=0\n"
expect {
    -re "$prompt $"\
	{
	send "print v_signed_int\n"
	expect {
	    -re ".\[0-9\]* = 0.*$prompt $"       { pass "set variable signed int=0" }
	    -re "$prompt $"                      { fail "set variable signed int=0" }
	    timeout                              { fail "(timeout) set variable signed int=0" }
	}
    }
    -re "$prompt $"                              { fail "set variable signed int=0" }
    timeout                                      { fail "(timeout) set variable signed int=0" }
}                         


send "set variable v_signed_int=1\n"
expect {
    -re "$prompt $"\
	{
	send "print v_signed_int\n"
	expect {
	    -re ".\[0-9\]* = 1.*$prompt $"       { pass "set variable signed int=1" }
	    -re "$prompt $"                      { fail "set variable signed int=1" }
	    timeout                              { fail "(timeout) set variable signed int=1" }
	}
    }
    -re "$prompt $"                              { fail "set variable signed int=1" }
    timeout                                      { fail "(timeout) set variable signed int=1" }
}                         


send "set variable v_signed_int=-1\n"
expect {
    -re "$prompt $"\
	{
	send "print v_signed_int\n"
	expect {
	    -re ".\[0-9\]* = -1.*$prompt $"       { pass "set variable signed int=-1 (minus)" }
	    -re "$prompt $"                      { fail "set variable signed int=-1 (minus)" }
	    timeout                              { fail "(timeout) set variable signed int=-1 (minus)" }
	}
    }
    -re "$prompt $"                              { fail "set variable signed int=-1 (minus)" }
    timeout                                      { fail "(timeout) set variable signed int=-1 (minus)" }
}                         


d194 4
a197 49
send "set variable v_unsigned_int=0\n"
expect {
    -re "$prompt $"\
	{
	send "print v_unsigned_int\n"
	expect {
	    -re ".\[0-9\]* = 0.*$prompt $"       { pass "set variable unsigned int=0" }
	    -re "$prompt $"                      { fail "set variable unsigned int=0" }
	    timeout                              { fail "(timeout) set variable unsigned int=0" }
	}
    }
    -re "$prompt $"                              { fail "set variable unsigned int=0" }
    timeout                                      { fail "(timeout) set variable unsigned int=0" }
}                         


send "set variable v_unsigned_int=1\n"
expect {
    -re "$prompt $"\
	{
	send "print v_unsigned_int\n"
	expect {
	    -re ".\[0-9\]* = 1.*$prompt $"       { pass "set variable unsigned int=1" }
	    -re "$prompt $"                      { fail "set variable unsigned int=1" }
	    timeout                              { fail "(timeout) set variable unsigned int=1" }
	}
    }
    -re "$prompt $"                              { fail "set variable unsigned int=1" }
    timeout                                      { fail "(timeout) set variable unsigned int=1" }
}                         


send "set variable v_unsigned_int=~0\n"
expect {
    -re "$prompt $"\
	{
	send "print v_unsigned_int\n"
	expect {
	    -re ".\[0-9\]* = 4294967295.*$prompt $"       { pass "set variable unsigned int=~0 (minus)" }
	    -re ".\[0-9\]* = 65535.*$prompt $"       { pass "set variable unsigned int=~0 (minus)" }
	    -re "$prompt $"                      { fail "set variable unsigned int=~0 (minus)" }
	    timeout                              { fail "(timeout) set variable unsigned int=~0 (minus)" }
	}
    }
    -re "$prompt $"                              { fail "set variable unsigned int=~0 (minus)" }
    timeout                                      { fail "(timeout) set variable unsigned int=~0 (minus)" }
}                         


d201 3
a203 48
send "set variable v_long=0\n"
expect {
    -re "$prompt $"\
	{
	send "print v_long\n"
	expect {
	    -re ".\[0-9\]* = 0.*$prompt $"       { pass "set variable long=0" }
	    -re "$prompt $"                      { fail "set variable long=0" }
	    timeout                              { fail "(timeout) set variable long=0" }
	}
    }
    -re "$prompt $"                              { fail "set variable long=0" }
    timeout                                      { fail "(timeout) set variable long=0" }
}                         


send "set variable v_long=1\n"
expect {
    -re "$prompt $"\
	{
	send "print v_long\n"
	expect {
	    -re ".\[0-9\]* = 1.*$prompt $"       { pass "set variable long=1" }
	    -re "$prompt $"                      { fail "set variable long=1" }
	    timeout                              { fail "(timeout) set variable long=1" }
	}
    }
    -re "$prompt $"                              { fail "set variable long=1" }
    timeout                                      { fail "(timeout) set variable long=1" }
}                         


send "set variable v_long=-1\n"
expect {
    -re "$prompt $"\
	{
	send "print v_long\n"
	expect {
	    -re ".\[0-9\]* = -1.*$prompt $"       { pass "set variable long=-1 (minus)" }
	    -re "$prompt $"                      { fail "set variable long=-1 (minus)" }
	    timeout                              { fail "(timeout) set variable signed long=-1 (minus)" }
	}
    }
    -re "$prompt $"                              { fail "set variable long=-1 (minus)" }
    timeout                                      { fail "(timeout) set variable long=-1 (minus)" }
}                         


d207 3
a209 48
send "set variable v_signed_long=0\n"
expect {
    -re "$prompt $"\
	{
	send "print v_signed_long\n"
	expect {
	    -re ".\[0-9\]* = 0.*$prompt $"       { pass "set variable signed long=0" }
	    -re "$prompt $"                      { fail "set variable signed long=0" }
	    timeout                              { fail "(timeout) set variable signed long=0" }
	}
    }
    -re "$prompt $"                              { fail "set variable signed long=0" }
    timeout                                      { fail "(timeout) set variable signed long=0" }
}                         


send "set variable v_signed_long=1\n"
expect {
    -re "$prompt $"\
	{
	send "print v_signed_long\n"
	expect {
	    -re ".\[0-9\]* = 1.*$prompt $"       { pass "set variable signed long=1" }
	    -re "$prompt $"                      { fail "set variable signed long=1" }
	    timeout                              { fail "(timeout) set variable signed long=1" }
	}
    }
    -re "$prompt $"                              { fail "set variable signed long=1" }
    timeout                                      { fail "(timeout) set variable signed long=1" }
}                         


send "set variable v_signed_long=-1\n"
expect {
    -re "$prompt $"\
	{
	send "print v_signed_long\n"
	expect {
	    -re ".\[0-9\]* = -1.*$prompt $"       { pass "set variable signed long=-1 (minus)" }
	    -re "$prompt $"                      { fail "set variable signed long=-1 (minus)" }
	    timeout                              { fail "(timeout) set variable signed long=-1 (minus)" }
	}
    }
    -re "$prompt $"                              { fail "set variable signed long=-1 (minus)" }
    timeout                                      { fail "(timeout) set variable signed long=-1 (minus)" }
}                         


d213 3
a215 48
send "set variable v_unsigned_long=0\n"
expect {
    -re "$prompt $"\
	{
	send "print v_unsigned_long\n"
	expect {
	    -re ".\[0-9\]* = 0.*$prompt $"       { pass "set variable unsigned long=0" }
	    -re "$prompt $"                      { fail "set variable unsigned long=0" }
	    timeout                              { fail "(timeout) set variable unsigned long=0" }
	}
    }
    -re "$prompt $"                              { fail "set variable unsigned long=0" }
    timeout                                      { fail "(timeout) set variable unsigned long=0" }
}                         


send "set variable v_unsigned_long=1\n"
expect {
    -re "$prompt $"\
	{
	send "print v_unsigned_long\n"
	expect {
	    -re ".\[0-9\]* = 1.*$prompt $"       { pass "set variable unsigned long=1" }
	    -re "$prompt $"                      { fail "set variable unsigned long=1" }
	    timeout                              { fail "(timeout) set variable unsigned long=1" }
	}
    }
    -re "$prompt $"                              { fail "set variable unsigned long=1" }
    timeout                                      { fail "(timeout) set variable unsigned long=1" }
}                         


send "set variable v_unsigned_long=~0\n"
expect {
    -re "$prompt $"\
	{
	send "print v_unsigned_long\n"
	expect {
	    -re ".\[0-9\]* = $ulong_minus_1.*$prompt $"       { pass "set variable unsigned long=~0 (minus)" }
	    -re "$prompt $"                      { fail "set variable unsigned long=~0 (minus)" }
	    timeout                              { fail "(timeout) set variable unsigned long=~0 (minus)" }
	}
    }
    -re "$prompt $"                              { fail "set variable unsigned long=~0 (minus)" }
    timeout                                      { fail "(timeout) set variable unsigned long=~0 (minus)" }
}                         


d219 3
a221 48
send "set variable v_float=0.0\n"
expect {
    -re "$prompt $"\
	{
	send "print v_float\n"
	expect {
	    -re ".\[0-9\]* = 0.*$prompt $"       { pass "set variable float=0" }
	    -re "$prompt $"                      { fail "set variable float=0" }
	    timeout                              { fail "(timeout) set variable float=0" }
	}
    }
    -re "$prompt $"                              { fail "set variable float=0" }
    timeout                                      { fail "(timeout) set variable float=0" }
}                         


send "set variable v_float=1.0\n"
expect {
    -re "$prompt $"\
	{
	send "print v_float\n"
	expect {
	    -re ".\[0-9\]* = 1.*$prompt $"       { pass "set variable float=1" }
	    -re "$prompt $"                      { fail "set variable float=1" }
	    timeout                              { fail "(timeout) set variable float=1" }
	}
    }
    -re "$prompt $"                              { fail "set variable float=1" }
    timeout                                      { fail "(timeout) set variable float=1" }
}                         


send "set variable v_float=-1.0\n"
expect {
    -re "$prompt $"\
	{
	send "print v_float\n"
	expect {
	    -re ".\[0-9\]* = -1.*$prompt $"       { pass "set variable float=-1 (minus)" }
	    -re "$prompt $"                      { fail "set variable float=-1 (minus)" }
	    timeout                              { fail "(timeout) set variable signed float=-1 (minus)" }
	}
    }
    -re "$prompt $"                              { fail "set variable float=-1 (minus)" }
    timeout                                      { fail "(timeout) set variable float=-1 (minus)" }
}                         


d225 3
a227 48
send "set variable v_double=0.0\n"
expect {
    -re "$prompt $"\
	{
	send "print v_double\n"
	expect {
	    -re ".\[0-9\]* = 0.*$prompt $"       { pass "set variable double=0" }
	    -re "$prompt $"                      { fail "set variable double=0" }
	    timeout                              { fail "(timeout) set variable double=0" }
	}
    }
    -re "$prompt $"                              { fail "set variable double=0" }
    timeout                                      { fail "(timeout) set variable double=0" }
}                         


send "set variable v_double=1.0\n"
expect {
    -re "$prompt $"\
	{
	send "print v_double\n"
	expect {
	    -re ".\[0-9\]* = 1.*$prompt $"       { pass "set variable double=1" }
	    -re "$prompt $"                      { fail "set variable double=1" }
	    timeout                              { fail "(timeout) set variable double=1" }
	}
    }
    -re "$prompt $"                              { fail "set variable double=1" }
    timeout                                      { fail "(timeout) set variable double=1" }
}                         


send "set variable v_double=-1.0\n"
expect {
    -re "set.*$prompt $"\
	{
	send "print v_double\n"
	expect {
	    -re "print.*.\[0-9\]* = -1.*$prompt $"       { pass "set variable double=-1 (minus)" }
	    -re "$prompt $"                      { fail "set variable double=-1 (minus)" }
	    timeout                              { fail "(timeout) set variable double=-1 (minus)" }
	}
    }
    -re "$prompt $"                              { fail "set variable double=-1 (minus)" }
    timeout                                      { fail "(timeout) set variable double=-1 (minus)" }
}                         


d231 1
a231 18
send "set variable v_char_array\[0\]='h'\n"
expect -re "$prompt $"
send "set variable v_char_array\[1\]='i'\n"
expect {
    -re "set.*$prompt $"\
	{
	send "print v_char_array\n"
	expect {
	    -re "print.*.\[0-9\]* =.*\"hi\".*$prompt $"       { pass "set variable char array=\"hi\" (string)" }
	    -re "$prompt $"                      { fail "set variable char array=\"hi\" (string)" }
	    timeout                              { fail "(timeout) set variable char array=\"hi\" (string)" }
	}
    }
    -re "$prompt $"                              { fail "set variable char array=\"hi\" (string)" }
    timeout                                      { fail "(timeout) set variable char array=\"hi\" (string)" }
}                         


d235 1
a235 18
send "set variable v_signed_char_array\[0\]='h'\n"
expect -re "$prompt $"
send "set variable v_signed_char_array\[1\]='i'\n"
expect {
    -re "set.*$prompt $"\
	{
	send "print v_signed_char_array\n"
	expect {
	    -re "print.*.\[0-9\]* =.*\"hi\".*$prompt $"       { pass "set variable signed char array=\"hi\" (string)" }
	    -re "$prompt $"                      { fail "set variable signed char array=\"hi\" (string)" }
	    timeout                              { fail "(timeout) set variable signed char array=\"hi\" (string)" }
	}
    }
    -re "$prompt $"                              { fail "set variable signed char array=\"hi\" (string)" }
    timeout                                      { fail "(timeout) set variable signed char array=\"hi\" (string)" }
}                         


d239 1
a239 18
send "set variable v_unsigned_char_array\[0\]='h'\n"
expect -re "$prompt $"
send "set variable v_unsigned_char_array\[1\]='i'\n"
expect {
    -re "set.*$prompt $"\
	{
	send "print v_unsigned_char_array\n"
	expect {
	    -re "print.*.\[0-9\]* =.*\"hi\".*$prompt $"       { pass "set variable unsigned char array=\"hi\" (string)" }
	    -re "$prompt $"                      { fail "set variable unsigned char array=\"hi\" (string)" }
	    timeout                              { fail "(timeout) set variable unsigned char array=\"hi\" (string)" }
	}
    }
    -re "$prompt $"                              { fail "set variable unsigned char array=\"hi\" (string)" }
    timeout                                      { fail "(timeout) set variable unsigned char array=\"hi\" (string)" }
}                         


d243 1
a243 18
send "set variable v_short_array\[0\]=123\n"
expect -re "$prompt $"
send "set variable v_short_array\[1\]=-456\n"
expect {
    -re "set.*$prompt $"\
	{
	send "print v_short_array\n"
	expect {
	    -re "print.*.\[0-9\]* =.*\{123,.*-456\}.*$prompt $"       { pass "set variable short array" }
	    -re "$prompt $"                      { fail "set variable short array" }
	    timeout                              { fail "(timeout) set variable short array" }
	}
    }
    -re "$prompt $"                              { fail "set variable short array" }
    timeout                                      { fail "(timeout) set variable short array" }
}                         


d247 1
a247 18
send "set variable v_signed_short_array\[0\]=123\n"
expect -re "$prompt $"
send "set variable v_signed_short_array\[1\]=-456\n"
expect {
    -re "set.*$prompt $"\
	{
	send "print v_signed_short_array\n"
	expect {
	    -re "print.*.\[0-9\]* =.*\{123,.*-456\}.*$prompt $"       { pass "set variable signed short array" }
	    -re "$prompt $"                      { fail "set variable signed short array" }
	    timeout                              { fail "(timeout) set variable signed short array" }
	}
    }
    -re "$prompt $"                              { fail "set variable signed short array" }
    timeout                                      { fail "(timeout) set variable signed short array" }
}                         


d251 1
a251 18
send "set variable v_unsigned_short_array\[0\]=123\n"
expect -re "$prompt $"
send "set variable v_unsigned_short_array\[1\]=-456\n"
expect {
    -re "set.*$prompt $"\
	{
	send "print v_unsigned_short_array\n"
	expect {
	    -re "print.*.\[0-9\]* =.*\{123,.*65080\}.*$prompt $"       { pass "set variable unsigned short array" }
	    -re "$prompt $"                      { fail "set variable unsigned short array" }
	    timeout                              { fail "(timeout) set variable unsigned short array" }
	}
    }
    -re "$prompt $"                              { fail "set variable unsigned short array" }
    timeout                                      { fail "(timeout) set variable unsigned short array" }
}                         


d255 1
a255 18
send "set variable v_int_array\[0\]=123\n"
expect -re "$prompt $"
send "set variable v_int_array\[1\]=-456\n"
expect {
    -re "set.*$prompt $"\
	{
	send "print v_int_array\n"
	expect {
	    -re "print.*.\[0-9\]* =.*\{123,.*-456\}.*$prompt $"       { pass "set variable int array" }
	    -re "$prompt $"                      { fail "set variable int array" }
	    timeout                              { fail "(timeout) set variable int array" }
	}
    }
    -re "$prompt $"                              { fail "set variable int array" }
    timeout                                      { fail "(timeout) set variable int array" }
}                         


d259 1
a259 19
send "set variable v_signed_int_array\[0\]=123\n"
expect -re "$prompt $"
send "set variable v_signed_int_array\[1\]=-456\n"
expect {
    -re "set.*$prompt $"\
	{
	send "print v_signed_int_array\n"
	expect {
	    -re "print.*.\[0-9\]* =.*\{123,.*-456\}.*$prompt $"       { pass "set variable signed int array" }
	    -re "$prompt $"                      { fail "set variable signed int array" }
	    timeout                              { fail "(timeout) set variable signed int array" }
	}
    }
    -re "$prompt $"                              { fail "set variable signed int array" }
    timeout                                      { fail "(timeout) set variable signed int array" }
}                         



d263 1
a263 19
send "set variable v_unsigned_int_array\[0\]=123\n"
expect -re "$prompt $"
send "set variable v_unsigned_int_array\[1\]=-456\n"
expect {
    -re "set.*$prompt $"\
	{
	send "print v_unsigned_int_array\n"
	expect {
	    -re "print.*.\[0-9\]* =.*\{123,.*4294966840\}.*$prompt $"       { pass "set variable unsigned int array" }
	    -re "print.*.\[0-9\]* =.*\{123,.*65080\}.*$prompt $"       { pass "set variable unsigned int array" }
	    -re "$prompt $"                      { fail "set variable unsigned int array" }
	    timeout                              { fail "(timeout) set variable unsigned int array" }
	}
    }
    -re "$prompt $"                              { fail "set variable unsigned int array" }
    timeout                                      { fail "(timeout) set variable unsigned int array" }
}                         


d267 1
a267 18
send "set variable v_long_array\[0\]=123\n"
expect -re "$prompt $"
send "set variable v_long_array\[1\]=-456\n"
expect {
    -re "set.*$prompt $"\
	{
	send "print v_long_array\n"
	expect {
	    -re "print.*.\[0-9\]* =.*\{123,.*-456\}.*$prompt $"       { pass "set variable long array" }
	    -re "$prompt $"                      { fail "set variable long array" }
	    timeout                              { fail "(timeout) set variable long array" }
	}
    }
    -re "$prompt $"                              { fail "set variable long array" }
    timeout                                      { fail "(timeout) set variable long array" }
}                         


d271 1
a271 19
send "set variable v_signed_long_array\[0\]=123\n"
expect -re "$prompt $"
send "set variable v_signed_long_array\[1\]=-456\n"
expect {
    -re "set.*$prompt $"\
	{
	send "print v_signed_long_array\n"
	expect {
	    -re "print.*.\[0-9\]* =.*\{123,.*-456\}.*$prompt $"       { pass "set variable signed long array" }
	    -re "$prompt $"                      { fail "set variable signed long array" }
	    timeout                              { fail "(timeout) set variable signed long array" }
	}
    }
    -re "$prompt $"                              { fail "set variable signed long array" }
    timeout                                      { fail "(timeout) set variable signed long array" }
}                         



d275 1
a275 18
send "set variable v_unsigned_long_array\[0\]=123\n"
expect -re "$prompt $"
send "set variable v_unsigned_long_array\[1\]=-456\n"
expect {
    -re "$prompt $"\
	{
	send "print v_unsigned_long_array\n"
	expect {
	    -re "print.*.\[0-9\]* =.*\{123,.*$ulong_minus_456\}.*$prompt $"       { pass "set variable unsigned long array" }
	    -re "$prompt $"                      { fail "set variable unsigned long array" }
	    timeout                              { fail "(timeout) set variable unsigned long array" }
	}
    }
    -re "$prompt $"                              { fail "set variable unsigned long array" }
    timeout                                      { fail "(timeout) set variable unsigned long array" }
}                         


d279 1
a279 18
send "set variable v_float_array\[0\]=123.0\n"
expect -re "$prompt $"
send "set variable v_float_array\[1\]=-456.0\n"
expect {
    -re "$prompt $"\
	{
	send "print v_float_array\n"
	expect {
	    -re "print.*.\[0-9\]* =.*\{123,.*-456\}.*$prompt $"       { pass "set variable float array" }
	    -re "$prompt $"                      { fail "set variable float array" }
	    timeout                              { fail "(timeout) set variable float array" }
	}
    }
    -re "$prompt $"                              { fail "set variable float array" }
    timeout                                      { fail "(timeout) set variable float array" }
}                         


d283 1
a283 18
send "set variable v_double_array\[0\]=123.0\n"
expect -re "$prompt $"
send "set variable v_double_array\[1\]=-456.0\n"
expect {
    -re "$prompt $"\
	{
	send "print v_double_array\n"
	expect {
	    -re "print.*.\[0-9\]* =.*\{123,.*-456\}.*$prompt $"       { pass "set variable double array" }
	    -re "$prompt $"                      { fail "set variable double array" }
	    timeout                              { fail "(timeout) set variable double array" }
	}
    }
    -re "$prompt $"                              { fail "set variable double array" }
    timeout                                      { fail "(timeout) set variable double array" }
}                         


d287 1
a287 27
send "set v_char_pointer=v_char_array\n"
expect -re "set.*$prompt $"
send "set variable *(v_char_pointer)='h'\n"
expect -re "set.*$prompt $"
send "set variable *(v_char_pointer+1)='i'\n"
expect {
    -re "set.*$prompt $" {
	send "print v_char_array\n"
	expect {
	    -re "print.*.\[0-9\]* =.*\"hi\".*$prompt $" {
		send "print *(v_char_pointer+1)\n"
		expect {
		    -re "print.*.\[0-9\]* = 105 \'i\'.*$prompt $"    { pass "set variable char pointer=\"hi\" (string)" }
		    -re "$prompt $"                              { fail "set variable char pointer=\"hi\" (string)" }
		    timeout                              { fail "(timeout) set variable char pointer=\"hi\" (string)" }

		}
	    }
	    -re "$prompt $"                              { fail "set variable char pointer=\"hi\" (string)" }
	    timeout                              { fail "(timeout) set variable char pointer=\"hi\" (string)" }
	}
    }
    -re "$prompt $"                              { fail "set variable char pointer=\"hi\" (string)" }
    timeout                                      { fail "(timeout) set variable char pointer=\"hi\" (string)" }
}                         


d291 1
a291 27
send "set v_signed_char_pointer=v_signed_char_array\n"
expect -re "set.*$prompt $"
send "set variable *(v_signed_char_pointer)='h'\n"
expect -re "set.*$prompt $"
send "set variable *(v_signed_char_pointer+1)='i'\n"
expect {
    -re "set.*$prompt $" {
	send "print v_signed_char_array\n"
	expect {
	    -re "print.*.\[0-9\]* =.*\"hi\".*$prompt $" {
		send "print *(v_signed_char_pointer+1)\n"
		expect {
		    -re "print.*.\[0-9\]* = 105 \'i\'.*$prompt $"    { pass "set variable signed char pointer=\"hi\" (string)" }
		    -re "$prompt $"                { fail "set variable signed char pointer=\"hi\" (string)" }
		    timeout                              { fail "(timeout) set variable signed char pointer=\"hi\" (string)" }

		}
	    }
	    -re "$prompt $"                { fail "set variable signed char pointer=\"hi\" (string)" }
	    timeout                              { fail "(timeout) set variable signed char pointer=\"hi\" (string)" }
	}
    }
    -re "$prompt $"                { fail "set variable signed char pointer=\"hi\" (string)" }
    timeout                                      { fail "(timeout) set variable signed char pointer=\"hi\" (string)" }
}                         


d295 1
a295 27
send "set v_unsigned_char_pointer=v_unsigned_char_array\n"
expect -re "set.*$prompt $"
send "set variable *(v_unsigned_char_pointer)='h'\n"
expect -re "set.*$prompt $"
send "set variable *(v_unsigned_char_pointer+1)='i'\n"
expect {
    -re "set.*$prompt $" {
	send "print v_unsigned_char_array\n"
	expect {
	    -re "print.*.\[0-9\]* =.*\"hi\".*$prompt $" {
		send "print *(v_unsigned_char_pointer+1)\n"
		expect {
		    -re "print.*.\[0-9\]* = 105 \'i\'.*$prompt $"    { pass "set variable unsigned char pointer=\"hi\" (string)" }
		    -re "$prompt $"                { fail "set variable unsigned char pointer=\"hi\" (string)" }
		    timeout                              { fail "(timeout) set variable unsigned char pointer=\"hi\" (string)" }

		}
	    }
	    -re "$prompt $"                { fail "set variable unsigned char pointer=\"hi\" (string)" }
	    timeout                              { fail "(timeout) set variable unsigned char pointer=\"hi\" (string)" }
	}
    }
    -re "$prompt $"                { fail "set variable unsigned char pointer=\"hi\" (string)" }
    timeout                                      { fail "(timeout) set variable unsigned char pointer=\"hi\" (string)" }
}                         


d299 1
a299 27
send "set v_short_pointer=v_short_array\n"
expect -re "set.*$prompt $"
send "set variable *(v_short_pointer)=123\n"
expect -re "set.*$prompt $"
send "set variable *(v_short_pointer+1)=-456\n"
expect {
    -re "set.*$prompt $" {
	send "print v_short_array\n"
	expect {
	    -re "print.*.\[0-9\]* =.*\{123,.*-456\}.*$prompt $" {
		send "print *(v_short_pointer+1)\n"
		expect {
		    -re "print.*.\[0-9\]* = -456.*$prompt $"    { pass "set variable short pointer" }
		    -re "$prompt $"                      { fail "set variable short pointer" }
		    timeout                              { fail "(timeout) set variable short pointer" }

		}
	    }
	    -re "$prompt $"                { fail "set variable short pointer" }
	    timeout                              { fail "(timeout) set variable short pointer" }
	}
    }
    -re "$prompt $"                { fail "set variable short pointer" }
    timeout                                      { fail "(timeout) set variable short pointer" }
}                         


d306 1
a306 1
gdb_test "print v_signed_short_array" ".\[0-9\]* =.*\{123,.*-456\}" \
a308 2


d315 1
a315 1
gdb_test "print v_unsigned_short_array" ".\[0-9\]* =.*\{123,.*65080\}" \
a317 2


d321 1
a321 27
send "set v_int_pointer=v_int_array\n"
expect -re "set.*$prompt $"
send "set variable *(v_int_pointer)=123\n"
expect -re "set.*$prompt $"
send "set variable *(v_int_pointer+1)=-456\n"
expect {
    -re "set.*$prompt $" {
	send "print v_int_array\n"
	expect {
	    -re "print.*.\[0-9\]* =.*\{123,.*-456\}.*$prompt $" {
		send "print *(v_int_pointer+1)\n"
		expect {
		    -re "print.*.\[0-9\]* = -456.*$prompt $"    { pass "set variable int pointer" }
		    -re "$prompt $"                { fail "set variable int pointer" }
		    timeout                              { fail "(timeout) set variable int pointer" }

		}
	    }
	    -re "$prompt $"                { fail "set variable int pointer" }
	    timeout                              { fail "(timeout) set variable int pointer" }
	}
    }
    -re "$prompt $"                { fail "set variable int pointer" }
     timeout                                      { fail "(timeout) set variable int pointer" }
}                         


d325 1
a325 27
send "set v_signed_int_pointer=v_signed_int_array\n"
expect -re "set.*$prompt $"
send "set variable *(v_signed_int_pointer)=123\n"
expect -re "set.*$prompt $"
send "set variable *(v_signed_int_pointer+1)=-456\n"
expect {
    -re "set.*$prompt $" {
	send "print v_signed_int_array\n"
	expect {
	    -re "print.*.\[0-9\]* =.*\{123,.*-456\}.*$prompt $" {
		send "print *(v_signed_int_pointer+1)\n"
		expect {
		    -re "print.*.\[0-9\]* = -456.*$prompt $"    { pass "set variable signed int pointer" }
		    -re "$prompt $"                { fail "set variable signed int pointer" }
		    timeout                              { fail "(timeout) set variable signed int pointer" }

		}
	    }
	    -re "$prompt $"                { fail "set variable signed int pointer" }
	    timeout                              { fail "(timeout) set variable signed int pointer" }
	}
    }
    -re "$prompt $"                { fail "set variable signed int pointer" }
       timeout                                      { fail "(timeout) set variable signed int pointer" }
}                         


d329 2
a330 36
send "set v_unsigned_int_pointer=v_unsigned_int_array\n"
expect -re "set.*$prompt $"
send "set variable *(v_unsigned_int_pointer)=123\n"
expect -re "set.*$prompt $"
send "set variable *(v_unsigned_int_pointer+1)=-456\n"
expect {
    -re "set.*$prompt $" {
	send "print v_unsigned_int_array\n"
	expect {
	    -re "print.*.\[0-9\]* =.*\{123,.*4294966840\}.*$prompt $" {
		send "print *(v_unsigned_int_pointer+1)\n"
		expect {
		    -re "print.*.\[0-9\]* = 4294966840.*$prompt $"    { pass "set variable unsigned int pointer" }
		    -re "$prompt $"                { fail "set variable unsigned int pointer" }
		    timeout                              { fail "(timeout) set variable unsigned int pointer" }

		}
	    }
	    -re "print.*.\[0-9\]* =.*\{123,.*65080\}.*$prompt $" {
		send "print *(v_unsigned_int_pointer+1)\n"
		expect {
		    -re "print.*.\[0-9\]* = 65080.*$prompt $"    { pass "set variable unsigned int pointer" }
		    -re "$prompt $"                { fail "set variable unsigned int pointer" }
		    timeout                              { fail "(timeout) set variable unsigned int pointer" }

		}
	    }
	    -re "$prompt $"                { fail "set variable unsigned int pointer" }
	    timeout                              { fail "(timeout) set variable unsigned int pointer" }
	}
    }
    -re "$prompt $"                { fail "set variable unsigned int pointer" }
    timeout                                      { fail "(timeout) set variable unsigned int pointer" }
}                         


d334 1
a334 27
send "set v_long_pointer=v_long_array\n"
expect -re "set.*$prompt $"
send "set variable *(v_long_pointer)=123\n"
expect -re "set.*$prompt $"
send "set variable *(v_long_pointer+1)=-456\n"
expect {
    -re "set.*$prompt $" {
	send "print v_long_array\n"
	expect {
	    -re "print.*.\[0-9\]* =.*\{123,.*-456\}.*$prompt $" {
		send "print *(v_long_pointer+1)\n"
		expect {
		    -re "print.*.\[0-9\]* = -456.*$prompt $"    { pass "set variable long pointer" }
		    -re "$prompt $"                { fail "set variable long pointer" }
		    timeout                              { fail "(timeout) set variable long pointer" }

		}
	    }
	    -re "$prompt $"                { fail "set variable long pointer" }
	    timeout                              { fail "(timeout) set variable long pointer" }
	}
    }
    -re "$prompt $"                { fail "set variable long pointer" }
     timeout                                      { fail "(timeout) set variable long pointer" }
}                         


d338 1
a338 27
send "set v_signed_long_pointer=v_signed_long_array\n"
expect -re "set.*$prompt $"
send "set variable *(v_signed_long_pointer)=123\n"
expect -re "set.*$prompt $"
send "set variable *(v_signed_long_pointer+1)=-456\n"
expect {
    -re "set.*$prompt $" {
	send "print v_signed_long_array\n"
	expect {
	    -re "print.*.\[0-9\]* =.*\{123,.*-456\}.*$prompt $" {
		send "print *(v_signed_long_pointer+1)\n"
		expect {
		    -re "print.*.\[0-9\]* = -456.*$prompt $"    { pass "set variable signed long pointer" }
		    -re "$prompt $"                { fail "set variable signed long pointer" }
		    timeout                              { fail "(timeout) set variable signed long pointer" }

		}
	    }
	    -re "$prompt $"                { fail "set variable signed long pointer" }
	    timeout                              { fail "(timeout) set variable signed long pointer" }
	}
    }
    -re "$prompt $"                { fail "set variable signed long pointer" }
       timeout                                      { fail "(timeout) set variable signed long pointer" }
}                         


d342 1
a342 27
send "set v_unsigned_long_pointer=v_unsigned_long_array\n"
expect -re "set.*$prompt $"
send "set variable *(v_unsigned_long_pointer)=123\n"
expect -re "set.*$prompt $"
send "set variable *(v_unsigned_long_pointer+1)=-456\n"
expect {
    -re "set.*$prompt $" {
	send "print v_unsigned_long_array\n"
	expect {
	    -re "print.*.\[0-9\]* =.*\{123,.*$ulong_minus_456\}.*$prompt $" {
		send "print *(v_unsigned_long_pointer+1)\n"
		expect {
		    -re "print.*.\[0-9\]* = $ulong_minus_456.*$prompt $"    { pass "set variable unsigned long pointer" }
		    -re "$prompt $"                { fail "set variable unsigned long pointer" }
		    timeout                              { fail "(timeout) set variable unsigned long pointer" }

		}
	    }
	    -re "$prompt $"                { fail "set variable unsigned long pointer" }
	    timeout                              { fail "(timeout) set variable unsigned long pointer" }
	}
    }
    -re "$prompt $"                { fail "set variable unsigned long pointer" }
    timeout                                      { fail "(timeout) set variable unsigned long pointer" }
}                         


d346 1
a346 27
send "set v_float_pointer=v_float_array\n"
expect -re "set.*$prompt $"
send "set variable *(v_float_pointer)=123.0\n"
expect -re "set.*$prompt $"
send "set variable *(v_float_pointer+1)=-456.0\n"
expect {
    -re "set.*$prompt $" {
	send "print v_float_array\n"
	expect {
	    -re "print.*.\[0-9\]* =.*\{123,.*-456\}.*$prompt $" {
		send "print *(v_float_pointer+1)\n"
		expect {
		    -re "print.*.\[0-9\]* = -456.*$prompt $"    { pass "set variable float pointer" }
		    -re "$prompt $"                { fail "set variable float pointer" }
		    timeout                              { fail "(timeout) set variable float pointer" }

		}
	    }
	    -re "$prompt $"                { fail "set variable float pointer" }
	    timeout                              { fail "(timeout) set variable float pointer" }
	}
    }
    -re "$prompt $"                { fail "set variable float pointer" }
     timeout                                      { fail "(timeout) set variable float pointer" }
}                         


d350 1
a350 27
send "set v_double_pointer=v_double_array\n"
expect -re "set.*$prompt $"
send "set variable *(v_double_pointer)=123.0\n"
expect -re "set.*$prompt $"
send "set variable *(v_double_pointer+1)=-456.0\n"
expect {
    -re "set.*$prompt $" {
	send "print v_double_array\n"
	expect {
	    -re "print.*.\[0-9\]* =.*\{123,.*-456\}.*$prompt $" {
		send "print *(v_double_pointer+1)\n"
		expect {
		    -re "print.*.\[0-9\]* = -456.*$prompt $"    { pass "set variable double pointer" }
		    -re "$prompt $"                { fail "set variable double pointer" }
		    timeout                              { fail "(timeout) set variable double pointer" }

		}
	    }
	    -re "$prompt $"                { fail "set variable double pointer" }
	    timeout                              { fail "(timeout) set variable double pointer" }
	}
    }
    -re "$prompt $"                { fail "set variable double pointer" }
     timeout                                      { fail "(timeout) set variable double pointer" }
}                         


d354 6
a359 95
send "set variable v_struct1.v_char_member='h'\n"
expect {
    -re "set.*$prompt $"\
	{
	send "print v_struct1.v_char_member\n"
	expect {
	    -re "print.*.\[0-9\]* = 104 \'h\'.*$prompt $"       { pass "set variable structure char member" }
	    -re "$prompt $"                      { fail "set variable structure char member" }
	    timeout                              { fail "(timeout) set variable structure char member" }
	}
    }
    -re "$prompt $"                              { fail "set variable structure char member" }
    timeout                                      { fail "(timeout) set variable structure char member" }
}                         


send "set variable v_struct1.v_short_member=1\n"
expect {
    -re "set.*$prompt $"\
	{
	send "print v_struct1.v_short_member\n"
	expect {
	    -re "print.*.\[0-9\]* = 1.*$prompt $"       { pass "set variable structure short member" }
	    -re "$prompt $"                      { fail "set variable structure short member" }
	    timeout                              { fail "(timeout) set variable structure short member" }
	}
    }
    -re "$prompt $"                              { fail "set variable structure short member" }
    timeout                                      { fail "(timeout) set variable structure short member" }
}                         


send "set variable v_struct1.v_int_member=2\n"
expect {
    -re "set.*$prompt $"\
	{
	send "print v_struct1.v_int_member\n"
	expect {
	    -re "print.*.\[0-9\]* = 2.*$prompt $"       { pass "set variable structure int member" }
	    -re "$prompt $"                      { fail "set variable structure int member" }
	    timeout                              { fail "(timeout) set variable structure int member" }
	}
    }
    -re "$prompt $"                              { fail "set variable structure int member" }
    timeout                                      { fail "(timeout) set variable structure int member" }
}                         


send "set variable v_struct1.v_long_member=3\n"
expect {
    -re "set.*$prompt $"\
	{
	send "print v_struct1.v_long_member\n"
	expect {
	    -re "print.*.\[0-9\]* = 3.*$prompt $"       { pass "set variable structure long member" }
	    -re "$prompt $"                      { fail "set variable structure long member" }
	    timeout                              { fail "(timeout) set variable structure long member" }
	}
    }
    -re "$prompt $"                              { fail "set variable structure long member" }
    timeout                                      { fail "(timeout) set variable structure long member" }
}                         


send "set variable v_struct1.v_float_member=4.0\n"
expect {
    -re "set.*$prompt $"\
	{
	send "print v_struct1.v_float_member\n"
	expect {
	    -re "print.*.\[0-9\]* = 4.*$prompt $"       { pass "set variable structure float member" }
	    -re "$prompt $"                      { fail "set variable structure float member" }
	    timeout                              { fail "(timeout) set variable structure float member" }
	}
    }
    -re "$prompt $"                              { fail "set variable structure float member" }
    timeout                                      { fail "(timeout) set variable structure float member" }
}                         


send "set variable v_struct1.v_double_member=5.0\n"
expect {
    -re "set.*$prompt $"\
	{
	send "print v_struct1.v_double_member\n"
	expect {
	    -re "print.*.\[0-9\]* = 5.*$prompt $"       { pass "set variable structure double member" }
	    -re "$prompt $"                      { fail "set variable structure double member" }
	    timeout                              { fail "(timeout) set variable structure double member" }
	}
    }
    -re "$prompt $"                              { fail "set variable structure double member" }
    timeout                                      { fail "(timeout) set variable structure double member" }
}                         

d362 1
a362 1
  "print.*.\[0-9\]* = \{.*v_char_member = 104 \'h\',.*v_short_member = 1,\
d367 2
a368 2
# This should be an error.  GCC extensions for structure constants require
# the type of the structure to be specified, as in
d370 16
a385 3
# GDB should do the same if it wants to provide this feature.
setup_xfail "h8300*-*-*"
gdb_test "set variable v_struct1 = {32, 33, 34, 35, 36, 37}" "Invalid.*"
d387 4
a390 3
# And after the error the structure should be unchanged.
gdb_test "print v_struct1" \
  "print.*.\[0-9\]* = \{.*v_char_member = 104 \'h\',.*v_short_member = 1,\
d392 2
a393 2
v_long_member = 3,.*v_float_member = 4,.*v_double_member = 5.*\}" \
  "set print structure #2"
d399 8
a406 8
    gdb_test "print sef.field=sm1" "print.*.\[0-9\]* = sm1"
    gdb_test "print sef.field" "print.*.\[0-9\]* = sm1" "print sef.field (sm1)"
    gdb_test "print sef.field=s1" "print.*.\[0-9\]* = s1"
    gdb_test "print sef.field" "print.*.\[0-9\]* = s1" "print sef.field (s1)"
    gdb_test "print uef.field=u2" "print.*.\[0-9\]* = u2"
    gdb_test "print uef.field" "print.*.\[0-9\]* = u2" "print uef.field (u2)"
    gdb_test "print uef.field=u1" "print.*.\[0-9\]* = u1"
    gdb_test "print uef.field" "print.*.\[0-9\]* = u1" "print uef.field (u1)"
d410 1
a410 1
	"print.*warning: Value does not fit in 2 bits.*\[0-9\]* = sm1"
d412 1
a412 1
	"print.*warning: Value does not fit in 2 bits.*\[0-9\]* = u2"
@


1.1
log
@file setvar.exp was initially added on branch CYGNUS.
@
text
@d1 1877
@


1.1.1.1
log
@GDB 6.1 (excluding .info files)
@
text
@a0 413
# This testcase is part of GDB, the GNU debugger.

# Copyright 1988, 1990, 1991, 1992, 1993, 1994, 1995, 1996, 1997,
# 1999, 2000, 2001, 2004 Free Software Foundation, Inc.

# This program is free software; you can redistribute it and/or modify
# it under the terms of the GNU General Public License as published by
# the Free Software Foundation; either version 2 of the License, or
# (at your option) any later version.
# 
# This program is distributed in the hope that it will be useful,
# but WITHOUT ANY WARRANTY; without even the implied warranty of
# MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
# GNU General Public License for more details.
# 
# You should have received a copy of the GNU General Public License
# along with this program; if not, write to the Free Software
# Foundation, Inc., 59 Temple Place - Suite 330, Boston, MA 02111-1307, USA.  

# Please email any bugs, comments, and/or additions to this file to:
# bug-gdb@@gnu.org

# This file was written by Rob Savoye. (rob@@cygnus.com)

if $tracelevel then {
	strace $tracelevel
	}

#
# test running programs
#
set prms_id 0
set bug_id 0

set testfile "setvar"
set srcfile ${testfile}.c
set binfile ${objdir}/${subdir}/${testfile}
if  { [gdb_compile "${srcdir}/${subdir}/${srcfile}" "${binfile}" executable {debug}] != "" } {
     gdb_suppress_entire_file "Testcase compile failed, so all tests in this file will automatically fail."
}

# Create and source the file that provides information about the compiler
# used to compile the test case.
if [get_compiler_info ${binfile}] {
    return -1;
}

gdb_exit
gdb_start
gdb_reinitialize_dir $srcdir/$subdir
gdb_load $binfile

#
# set it up at a breakpoint so we canplay with the variable values
#
send_gdb "set print sevenbit-strings\n" ; gdb_expect -re "$gdb_prompt $"

if ![runto_main] then {
    perror "couldn't run to breakpoint"
    continue
}

# Determine expected output for unsigned long variables,
# the output varies with sizeof (unsigned long).

set ulong_minus_1 4294967295
set ulong_minus_456 4294966840
send_gdb "print sizeof (unsigned long)\n"
gdb_expect {
    -re ".\[0-9\]* = 4.*$gdb_prompt $" {}
    -re ".\[0-9\]* = 8.*$gdb_prompt $" {
	set ulong_minus_1 18446744073709551615
	set ulong_minus_456 18446744073709551160
    }
    -re ".*$gdb_prompt $" {
	 fail "getting sizeof unsigned long"
    }
    default	{ fail "(timeout) getting sizeof unsigned long" }
}

proc test_set { args } {
    global gdb_prompt

    set length [expr [llength $args] - 1];
    set message "[lindex $args $length]";
    set final [expr $length - 2];
    set count 1;

    # Set up the variables.
    for {set x 0;} {$x < $length} {incr x;} {
	if { "[lindex $args $x]" != "" } {
	    set arg [lindex $args $x];
	    if { ($x == $final) || ([string first ".*" [lindex $args [expr $x + 1]]] >= 0) } {
		set match [lindex $args [expr $x + 1]];
		if { $count == 1 } {
		    set mess "$message"
		} else {
		    set mess "$message (#$count)";
		}
		incr count;
		incr x;
	    } else {
		set mess "";
		set match ""
	    }
	    verbose "doing $arg $match"
	    if [gdb_test "$arg" "$match" "$mess"] {
		fail "$message -- $match";
		return 1;
	    }
	}
    }
    return 0;
}

#
# test "set variable" for type "char"
#
# Because bare char types can be either signed or unsigned, we just test the
# range of values that are common to both (0-127).
#    

test_set "set variable v_char=0" "print v_char" ".\[0-9\]* = 0 \'.0\'"        "set variable char=0" 
test_set "set variable v_char=1" "print v_char" ".\[0-9\]* = 1 \'.001\'"        "set variable char=1" 
test_set "set variable v_char=7" "print v_char" ".\[0-9\]* = 7 \'.a\'"        "set variable char=7 (Bel)" 
test_set "set variable v_char=32" "print v_char" ".\[0-9\]* = 32 \' \'"        "set variable char=32 (SPC)" 
test_set "set variable v_char=65" "print v_char" ".\[0-9\]* = 65 \'A\'"        "set variable char=65 ('A')" 
test_set "set variable v_char=97" "print v_char" ".\[0-9\]* = 97 \'a\'"        "set variable char=97 ('a')" 
test_set "set variable v_char=126" "print v_char" ".\[0-9\]* = 126 \'~\'"        "set variable char=126 ('~')" 
test_set "set variable v_char=127" "print v_char" ".\[0-9\]* = 127 \'.177\'"        "set variable char=127 (8-bit)" 
#
# test "set variable" for type "signed char"
#    
test_set "set variable v_char=0" "print v_signed_char" ".\[0-9\]* = 0 \'.0\'"                 "set variable signed char=0" 
test_set "set variable v_signed_char=1" "print v_signed_char" ".\[0-9\]* = 1 \'.001\'"        "set variable signed char=1" 
test_set "set variable v_signed_char=7" "print v_signed_char" ".\[0-9\]* = 7 \'.a\'"        "set variable signed char=7 (Bel)" 
test_set "set variable v_signed_char=32" "print v_signed_char" ".\[0-9\]* = 32 \' \'"        "set variable signed char=32 (SPC)" 
test_set "set variable v_signed_char=65" "print v_signed_char" ".\[0-9\]* = 65 \'A\'"        "set variable signed char=65 ('A')" 
test_set "set variable v_signed_char=97" "print v_signed_char" ".\[0-9\]* = 97 \'a\'"        "set variable signed char=97 ('a')" 
test_set "set variable v_signed_char=126" "print v_signed_char" ".\[0-9\]* = 126 \'~\'"        "set variable signed char=126 ('~')" 
test_set "set variable v_signed_char=127" "print v_signed_char" ".\[0-9\]* = 127 \'.177\'"        "set variable signed char=127 (8-bit)" 
gdb_test "set variable v_signed_char=-1" ""
if {!$gcc_compiled} then { setup_xfail "mips-sgi-irix4*" }
gdb_test "print v_signed_char" ".\[0-9\]* = -1 \'.377\'" \
    "set variable signed char=-1 (-1)"
gdb_test "set variable v_signed_char=0xFF" ""
if {!$gcc_compiled} then { setup_xfail "mips-sgi-irix4*" }
gdb_test "print v_signed_char" ".\[0-9\]* = -1 \'.377\'" \
    "set variable signed char=0xFF (0xFF)"
#
# test "set variable" for type "unsigned char"
#
test_set "set variable v_unsigned_char=0" "print v_unsigned_char" ".\[0-9\]* = 0 \'.0\'"        "set variable unsigned char=0" 
test_set "set variable v_unsigned_char=1" "print v_unsigned_char" ".\[0-9\]* = 1 \'.001\'"        "set variable unsigned char=1" 
test_set "set variable v_unsigned_char=7" "print v_unsigned_char" ".\[0-9\]* = 7 \'.a\'"        "set variable unsigned char=7 (Bel)" 
test_set "set variable v_unsigned_char=32" "print v_unsigned_char" ".\[0-9\]* = 32 \' \'"        "set variable unsigned char=32 (SPC)" 
test_set "set variable v_unsigned_char=65" "print v_unsigned_char" ".\[0-9\]* = 65 \'A\'"        "set variable unsigned char=65 ('A')" 
test_set "set variable v_unsigned_char=97" "print v_unsigned_char" ".\[0-9\]* = 97 \'a\'"        "set variable unsigned char=97 ('a')" 
test_set "set variable v_unsigned_char=126" "print v_unsigned_char" ".\[0-9\]* = 126 \'~\'"        "set variable unsigned char=126 ('~')" 
test_set "set variable v_unsigned_char=~0" "print v_unsigned_char" ".\[0-9\]* = 255 \'.377\'"        "set variable unsigned char=255 (8-bit)" 
#
# test "set variable" for type "short"
#
test_set "set variable v_short=0" "print v_short" ".\[0-9\]* = 0"        "set variable short=0" 
test_set "set variable v_short=1" "print v_short" ".\[0-9\]* = 1"        "set variable short=1" 
test_set "set variable v_short=-1" "print v_short" ".\[0-9\]* = -1"        "set variable short=-1 (minus)" 
#
# test "set variable" for type "signed short"
#
test_set "set variable v_signed_short=0" "print v_signed_short" ".\[0-9\]* = 0"        "set variable signed short=0" 
test_set "set variable v_signed_short=1" "print v_signed_short" ".\[0-9\]* = 1"        "set variable signed short=1" 
test_set "set variable v_signed_short=-1" "print v_signed_short" ".\[0-9\]* = -1"        "set variable signed short=-1 (minus)" 
#
# test "set variable" for type "unsigned short"
#
test_set "set variable v_unsigned_short=0" "print v_unsigned_short" ".\[0-9\]* = 0"        "set variable unsigned short=0" 
test_set "set variable v_unsigned_short=1" "print v_unsigned_short" ".\[0-9\]* = 1"        "set variable unsigned short=1" 
test_set "set variable v_unsigned_short=~0" "print v_unsigned_short" ".\[0-9\]* = 65535"        "set variable unsigned short=~0 (minus)" 
#
# test "set variable" for type "int"
#
test_set "set variable v_int=0" "print v_int" ".\[0-9\]* = 0"        "set variable int=0" 
test_set "set variable v_int=1" "print v_int" ".\[0-9\]* = 1"        "set variable int=1" 
test_set "set variable v_int=-1" "print v_int" ".\[0-9\]* = -1"        "set variable int=-1 (minus)" 
#
# test "set variable" for type "signed int"
#
test_set "set variable v_signed_int=0" "print v_signed_int" ".\[0-9\]* = 0"        "set variable signed int=0" 
test_set "set variable v_signed_int=1" "print v_signed_int" ".\[0-9\]* = 1"        "set variable signed int=1" 
test_set "set variable v_signed_int=-1" "print v_signed_int" ".\[0-9\]* = -1"        "set variable signed int=-1 (minus)" 
#
# test "set variable" for type "unsigned int"
#
test_set "set variable v_unsigned_int=0" "print v_unsigned_int" ".\[0-9\]* = 0"        "set variable unsigned int=0" 
test_set "set variable v_unsigned_int=1" "print v_unsigned_int" ".\[0-9\]* = 1"        "set variable unsigned int=1" 
test_set "set variable v_unsigned_int=~0" "print v_unsigned_int" ".\[0-9\]* = (4294967295|65535)"        "set variable unsigned int=~0 (minus)" 
#test_set ".\[0-9\]* = 65535"        "set variable unsigned int=~0 (minus)" 
#
# test "set variable" for type "long"
#
test_set "set variable v_long=0" "print v_long" ".\[0-9\]* = 0"        "set variable long=0" 
test_set "set variable v_long=1" "print v_long" ".\[0-9\]* = 1"        "set variable long=1" 
test_set "set variable v_long=-1" "print v_long" ".\[0-9\]* = -1"        "set variable long=-1 (minus)" 
#
# test "set variable" for type "signed long"
#
test_set "set variable v_signed_long=0" "print v_signed_long" ".\[0-9\]* = 0"        "set variable signed long=0" 
test_set "set variable v_signed_long=1" "print v_signed_long" ".\[0-9\]* = 1"        "set variable signed long=1" 
test_set "set variable v_signed_long=-1" "print v_signed_long" ".\[0-9\]* = -1"        "set variable signed long=-1 (minus)" 
#
# test "set variable" for type "unsigned long"
#
test_set "set variable v_unsigned_long=0" "print v_unsigned_long" ".\[0-9\]* = 0"        "set variable unsigned long=0" 
test_set "set variable v_unsigned_long=1" "print v_unsigned_long" ".\[0-9\]* = 1"        "set variable unsigned long=1" 
test_set "set variable v_unsigned_long=~0" "print v_unsigned_long" ".\[0-9\]* = $ulong_minus_1"        "set variable unsigned long=~0 (minus)" 
#
# test "set variable" for type "float"
#
test_set "set variable v_float=0.0" "print v_float" ".\[0-9\]* = 0"        "set variable float=0" 
test_set "set variable v_float=1.0" "print v_float" ".\[0-9\]* = 1"        "set variable float=1" 
test_set "set variable v_float=-1.0" "print v_float" ".\[0-9\]* = -1"        "set variable float=-1 (minus)" 
#
# test "set variable" for type "double"
#
test_set "set variable v_double=0.0" "print v_double" ".\[0-9\]* = 0"        "set variable double=0" 
test_set "set variable v_double=1.0" "print v_double" ".\[0-9\]* = 1"        "set variable double=1" 
test_set "set variable v_double=-1.0" "print v_double" ".*.\[0-9\]* = -1"        "set variable double=-1 (minus)" 
#
# test "set variable" for "char array[2]"
#
test_set "set variable v_char_array\[0\]='h'" "set variable v_char_array\[1\]='i'" "print v_char_array" ".*.\[0-9\]* =.*\"hi\""        "set variable char array=\"hi\" (string)" 
#
# test "set variable" for "signed char array[2]"
#
test_set "set variable v_signed_char_array\[0\]='h'" "set variable v_signed_char_array\[1\]='i'" "print v_signed_char_array" ".*.\[0-9\]* =.*\"hi\""        "set variable signed char array=\"hi\" (string)" 
#
# test "set variable" for "unsigned char array[2]"
#
test_set "set variable v_unsigned_char_array\[0\]='h'" "set variable v_unsigned_char_array\[1\]='i'" "print v_unsigned_char_array" ".*.\[0-9\]* =.*\"hi\""        "set variable unsigned char array=\"hi\" (string)" 
#
# test "set variable" for "short array[2]"
#
test_set "set variable v_short_array\[0\]=123" "set variable v_short_array\[1\]=-456" "print v_short_array" ".*.\[0-9\]* =.*\\{123,.*-456\\}"        "set variable short array" 
#
# test "set variable" for "signed short array[2]"
#
test_set "set variable v_signed_short_array\[0\]=123" "set variable v_signed_short_array\[1\]=-456" "print v_signed_short_array" ".*.\[0-9\]* =.*\\{123,.*-456\\}"        "set variable signed short array" 
#
# test "set variable" for "unsigned short array[2]"
#
test_set "set variable v_unsigned_short_array\[0\]=123" "set variable v_unsigned_short_array\[1\]=-456" "print v_unsigned_short_array" ".*.\[0-9\]* =.*\\{123,.*65080\\}"        "set variable unsigned short array" 
#
# test "set variable" for "int array[2]"
#
test_set "set variable v_int_array\[0\]=123" "set variable v_int_array\[1\]=-456" "print v_int_array" ".*.\[0-9\]* =.*\\{123,.*-456\\}"        "set variable int array" 
#
# test "set variable" for "signed int array[2]"
#
test_set "set variable v_signed_int_array\[0\]=123" "set variable v_signed_int_array\[1\]=-456" "print v_signed_int_array" ".*.\[0-9\]* =.*\\{123,.*-456\\}"        "set variable signed int array" 
#
# test "set variable" for "unsigned int array[2]"
#
test_set "set variable v_unsigned_int_array\[0\]=123" "set variable v_unsigned_int_array\[1\]=-456" "print v_unsigned_int_array" ".*.\[0-9\]* =.*\\{123,.*(4294966840|65080)\\}"        "set variable unsigned int array" 
#
# test "set variable" for "long array[2]"
#
test_set "set variable v_long_array\[0\]=123" "set variable v_long_array\[1\]=-456" "print v_long_array" ".*.\[0-9\]* =.*\\{123,.*-456\\}"        "set variable long array" 
#
# test "set variable" for "signed long array[2]"
#
test_set "set variable v_signed_long_array\[0\]=123" "set variable v_signed_long_array\[1\]=-456" "print v_signed_long_array" ".*.\[0-9\]* =.*\\{123,.*-456\\}"        "set variable signed long array" 
#
# test "set variable" for "unsigned long array[2]"
#
test_set "set variable v_unsigned_long_array\[0\]=123" "set variable v_unsigned_long_array\[1\]=-456" "print v_unsigned_long_array" ".*.\[0-9\]* =.*\\{123,.*$ulong_minus_456\\}"        "set variable unsigned long array" 
#
# test "set variable" for "float array[2]"
#
test_set "set variable v_float_array\[0\]=123.0" "set variable v_float_array\[1\]=-456.0" "print v_float_array" ".*.\[0-9\]* =.*\\{123,.*-456\\}"        "set variable float array" 
#
# test "set variable" for "double array[2]"
#
test_set "set variable v_double_array\[0\]=123.0" "set variable v_double_array\[1\]=-456.0" "print v_double_array" ".*.\[0-9\]* =.*\\{123,.*-456\\}"        "set variable double array" 
#
# test "set variable" for type "char *"
#
test_set "set v_char_pointer=v_char_array" "set variable *(v_char_pointer)='h'" "set variable *(v_char_pointer+1)='i'" "print v_char_array" ".*.\[0-9\]* =.*\"hi\""  "print *(v_char_pointer+1)" ".*.\[0-9\]* = 105 \'i\'"     "set variable char pointer=\"hi\" (string)" 
#
# test "set variable" for type "signed char *"
#
test_set "set v_signed_char_pointer=v_signed_char_array" "set variable *(v_signed_char_pointer)='h'" "set variable *(v_signed_char_pointer+1)='i'" "print v_signed_char_array" ".*.\[0-9\]* =.*\"hi\""  "print *(v_signed_char_pointer+1)" ".*.\[0-9\]* = 105 \'i\'"     "set variable signed char pointer=\"hi\" (string)" 
#
# test "set variable" for type "unsigned char *"
#
test_set "set v_unsigned_char_pointer=v_unsigned_char_array" "set variable *(v_unsigned_char_pointer)='h'" "set variable *(v_unsigned_char_pointer+1)='i'" "print v_unsigned_char_array" ".*.\[0-9\]* =.*\"hi\""  "print *(v_unsigned_char_pointer+1)" ".*.\[0-9\]* = 105 \'i\'"     "set variable unsigned char pointer=\"hi\" (string)" 
#
# test "set variable" for type "short *"
#
test_set "set v_short_pointer=v_short_array" "set variable *(v_short_pointer)=123" "set variable *(v_short_pointer+1)=-456" "print v_short_array" ".*.\[0-9\]* =.*\\{123,.*-456\\}"  "print *(v_short_pointer+1)" ".*.\[0-9\]* = -456"     "set variable short pointer" 
#
# test "set variable" for type "signed short *"
#
gdb_test "set v_signed_short_pointer=v_signed_short_array" ""
gdb_test "set variable *(v_signed_short_pointer)=123" ""
gdb_test "set variable *(v_signed_short_pointer+1)=-456" ""
gdb_test "print v_signed_short_array" ".\[0-9\]* =.*\\{123,.*-456\\}" \
    "set variable signed short pointer"
gdb_test "print *(v_signed_short_pointer+1)" ".\[0-9\]*.*=.*-456"
#
# test "set variable" for type "unsigned short *"
#
gdb_test "set v_unsigned_short_pointer=v_unsigned_short_array" ""
gdb_test "set variable *(v_unsigned_short_pointer)=123" ""
gdb_test "set variable *(v_unsigned_short_pointer+1)=-456" ""
gdb_test "print v_unsigned_short_array" ".\[0-9\]* =.*\\{123,.*65080\\}" \
    "set variable unsigned short pointer"
gdb_test "print *(v_unsigned_short_pointer+1)" ".\[0-9\]* = 65080"
#
# test "set variable" for type "int *"
#
test_set "set v_int_pointer=v_int_array" "set variable *(v_int_pointer)=123" "set variable *(v_int_pointer+1)=-456" "print v_int_array" ".*.\[0-9\]* =.*\\{123,.*-456\\}"  "print *(v_int_pointer+1)" ".*.\[0-9\]* = -456"     "set variable int pointer" 
#
# test "set variable" for type "signed int *"
#
test_set "set v_signed_int_pointer=v_signed_int_array" "set variable *(v_signed_int_pointer)=123" "set variable *(v_signed_int_pointer+1)=-456" "print v_signed_int_array" ".*.\[0-9\]* =.*\\{123,.*-456\\}"  "print *(v_signed_int_pointer+1)" ".*.\[0-9\]* = -456"     "set variable signed int pointer" 
#
# test "set variable" for type "unsigned int *"
#
test_set "set v_unsigned_int_pointer=v_unsigned_int_array" "set variable *(v_unsigned_int_pointer)=123" "set variable *(v_unsigned_int_pointer+1)=-456" "print v_unsigned_int_array" ".*.\[0-9\]* =.*\\{123,.*(4294966840|65080)\\}" "set variable unsigned int pointer"
test_set "" "print *(v_unsigned_int_pointer+1)" ".*.\[0-9\]* = (4294966840|65080)"     "print variable unsigned int pointer+1"
#
# test "set variable" for type "long *"
#
test_set "set v_long_pointer=v_long_array" "set variable *(v_long_pointer)=123" "set variable *(v_long_pointer+1)=-456" "print v_long_array" ".*.\[0-9\]* =.*\\{123,.*-456\\}"  "print *(v_long_pointer+1)" ".*.\[0-9\]* = -456"     "set variable long pointer" 
#
# test "set variable" for type "signed long *"
#
test_set "set v_signed_long_pointer=v_signed_long_array" "set variable *(v_signed_long_pointer)=123" "set variable *(v_signed_long_pointer+1)=-456" "print v_signed_long_array" ".*.\[0-9\]* =.*\\{123,.*-456\\}"  "print *(v_signed_long_pointer+1)" ".*.\[0-9\]* = -456"     "set variable signed long pointer" 
#
# test "set variable" for type "unsigned long *"
#
test_set "set v_unsigned_long_pointer=v_unsigned_long_array" "set variable *(v_unsigned_long_pointer)=123" "set variable *(v_unsigned_long_pointer+1)=-456" "print v_unsigned_long_array" ".*.\[0-9\]* =.*\\{123,.*$ulong_minus_456\\}"  "print *(v_unsigned_long_pointer+1)" ".*.\[0-9\]* = $ulong_minus_456"     "set variable unsigned long pointer" 
#
# test "set variable" for type "float *"
#
test_set "set v_float_pointer=v_float_array" "set variable *(v_float_pointer)=123.0" "set variable *(v_float_pointer+1)=-456.0" "print v_float_array" ".*.\[0-9\]* =.*\\{123,.*-456\\}"  "print *(v_float_pointer+1)" ".*.\[0-9\]* = -456"     "set variable float pointer" 
#
# test "set variable" for type "double *"
#
test_set "set v_double_pointer=v_double_array" "set variable *(v_double_pointer)=123.0" "set variable *(v_double_pointer+1)=-456.0" "print v_double_array" ".*.\[0-9\]* =.*\\{123,.*-456\\}"  "print *(v_double_pointer+1)" ".*.\[0-9\]* = -456"     "set variable double pointer" 
#
# test "set variable" for struct members
#
test_set "set variable v_struct1.v_char_member='h'" "print v_struct1.v_char_member" ".*.\[0-9\]* = 104 \'h\'"        "set variable structure char member" 
test_set "set variable v_struct1.v_short_member=1" "print v_struct1.v_short_member" ".*.\[0-9\]* = 1"        "set variable structure short member" 
test_set "set variable v_struct1.v_int_member=2" "print v_struct1.v_int_member" ".*.\[0-9\]* = 2"        "set variable structure int member" 
test_set "set variable v_struct1.v_long_member=3" "print v_struct1.v_long_member" ".*.\[0-9\]* = 3"        "set variable structure long member" 
test_set "set variable v_struct1.v_float_member=4.0" "print v_struct1.v_float_member" ".*.\[0-9\]* = 4"        "set variable structure float member" 
test_set "set variable v_struct1.v_double_member=5.0" "print v_struct1.v_double_member" ".*.\[0-9\]* = 5"        "set variable structure double member" 

gdb_test "print v_struct1" \
  ".*.\[0-9\]* = \{.*v_char_member = 104 \'h\',.*v_short_member = 1,\
.*v_int_member = 2,.*\
v_long_member = 3,.*v_float_member = 4,.*v_double_member = 5.*\}" \
  "set print structure #1"

# Some believe that the following  should be an error.  GCC extensions for
# structure constants require the type of the structure to be specified, as in
# v_struct1 = (struct t_struct) {32, 33, 34, 35, 36, 37}
# The argument is that GDB should do the same if it wants to provide this
# feature, i.e., require the cast.
# We decided that we don't want the debugger to be as picky as a
# compiler and make us type complex casts.

# We need to up this because this can be really slow on some boards.
# (malloc() is called as part of the test).
set timeout 60;

# Change the values
test_set "set variable v_struct1 = {32, 33, 34, 35, 36, 37}" \
  "print v_struct1" \
  ".*.\[0-9\]* = \\{.*v_char_member = 32 \' \',.*v_short_member = 33,\
.*v_int_member = 34,.*\
v_long_member = 35,.*v_float_member = 36,.*v_double_member = 37.*\\}" \
  "set print structure #2"

# Change them back
test_set "set variable v_struct1 = {'h', 1, 2, 3, 4.0, 5.0}" \
  "print v_struct1" \
  ".*.\[0-9\]* = \\{.*v_char_member = 104 \'h\',.*v_short_member = 1,\
.*v_int_member = 2,.*\
v_long_member = 3,.*v_float_member = 4,.*v_double_member = 5.*\\}" \
  "set print structure #3"

# Test printing of enumeration bitfields.
# GNU C supports them, some other compilers don't.

if {$gcc_compiled} then {
    gdb_test "print sef.field=sm1" ".*.\[0-9\]* = sm1"
    gdb_test "print sef.field" ".*.\[0-9\]* = sm1" "print sef.field (sm1)"
    gdb_test "print sef.field=s1" ".*.\[0-9\]* = s1"
    gdb_test "print sef.field" ".*.\[0-9\]* = s1" "print sef.field (s1)"
    gdb_test "print uef.field=u2" ".*.\[0-9\]* = u2"
    gdb_test "print uef.field" ".*.\[0-9\]* = u2" "print uef.field (u2)"
    gdb_test "print uef.field=u1" ".*.\[0-9\]* = u1"
    gdb_test "print uef.field" ".*.\[0-9\]* = u1" "print uef.field (u1)"

    # Test for truncation when assigning invalid values to bitfields.
    gdb_test "print sef.field=7" \
	".*warning: Value does not fit in 2 bits.*\[0-9\]* = sm1"
    gdb_test "print uef.field=6" \
	".*warning: Value does not fit in 2 bits.*\[0-9\]* = u2"
}
@


1.1.2.1
log
@Import of 961112 Cygnus binutils+gas+ld+gdb+gprof
@
text
@a0 1877
#   Copyright (C) 1988, 1990, 1991, 1992, 1994, 1995
#   Free Software Foundation, Inc.

# This program is free software; you can redistribute it and/or modify
# it under the terms of the GNU General Public License as published by
# the Free Software Foundation; either version 2 of the License, or
# (at your option) any later version.
# 
# This program is distributed in the hope that it will be useful,
# but WITHOUT ANY WARRANTY; without even the implied warranty of
# MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
# GNU General Public License for more details.
# 
# You should have received a copy of the GNU General Public License
# along with this program; if not, write to the Free Software
# Foundation, Inc., 59 Temple Place - Suite 330, Boston, MA 02111-1307, USA.  */

# Please email any bugs, comments, and/or additions to this file to:
# bug-gdb@@prep.ai.mit.edu

# This file was written by Rob Savoye. (rob@@cygnus.com)

if $tracelevel then {
	strace $tracelevel
	}

#
# test running programs
#
set prms_id 0
set bug_id 0

set testfile "setvar"
set srcfile ${testfile}.c
set binfile ${objdir}/${subdir}/${testfile}
if  { [compile "${srcdir}/${subdir}/${srcfile} -g -o ${binfile}"] != "" } {
    perror "Couldn't compile ${srcfile}"
    return -1
}

# Create and source the file that provides information about the compiler
# used to compile the test case.
execute_anywhere "rm -f ${binfile}.ci"
if  { [compile "-E ${srcdir}/${subdir}/compiler.c > ${binfile}.ci"] != "" } {
    perror "Couldn't make ${binfile}.ci file"
    return -1
}
source ${binfile}.ci

gdb_exit
gdb_start
gdb_reinitialize_dir $srcdir/$subdir
gdb_load $binfile

#
# set it up at a breakpoint so we canplay with the variable values
#
send "set print sevenbit-strings\n" ; expect -re "$prompt $"

if ![runto_main] then {
    perror "couldn't run to breakpoint"
    continue
}

# Determine expected output for unsigned long variables,
# the output varies with sizeof (unsigned long).

set ulong_minus_1 4294967295
set ulong_minus_456 4294966840
send "print sizeof (unsigned long)\n"
expect {
    -re ".\[0-9\]* = 4.*$prompt $" {}
    -re ".\[0-9\]* = 8.*$prompt $" {
	set ulong_minus_1 18446744073709551615
	set ulong_minus_456 18446744073709551160
    }
    -re ".*$prompt $" {
	 fail "getting sizeof unsigned long"
    }
    default	{ fail "(timeout) getting sizeof unsigned long" }
}

#
# test "set variable" for type "char"
#
# Because bare char types can be either signed or unsigned, we just test the
# range of values that are common to both (0-127).
#    
send "set variable v_char=0\n"
expect {
    -re "$prompt $"\
	{
	send "print v_char\n"
	expect {
	    -re ".\[0-9\]* = 0 \'.000\'.*$prompt $"       { pass "set variable char=0" }
	    -re "$prompt $"                      { fail "set variable char=0" }
	    timeout                              { fail "(timeout) set variable char=0" }
	}
    }
    -re "$prompt $"                              { fail "set variable char=0" }
    timeout                                      { fail "(timeout) set variable char=0" }
}                         


send "set variable v_char=1\n"
expect {
    -re "$prompt $"\
	{
	send "print v_char\n"
	expect {
	    -re ".\[0-9\]* = 1 \'.001\'.*$prompt $"       { pass "set variable char=1" }
	    -re "$prompt $"                      { fail "set variable char=1" }
	    timeout                              { fail "(timeout) set variable char=1" }
	}
    }
    -re "$prompt $"                              { fail "set variable char=1" }
    timeout                                      { fail "(timeout) set variable char=1" }
}                         


send "set variable v_char=27\n"
expect {
    -re "$prompt $"\
	{
	send "print v_char\n"
	expect {
	    -re ".\[0-9\]* = 27 \'.e\'.*$prompt $"       { pass "set variable char=27 (Esc)" }
	    -re "$prompt $"                      { fail "set variable char=27 (Esc)" }
	    timeout                              { fail "(timeout) set variable char=27 (Esc)" }
	}
    }
    -re "$prompt $"                              { fail "set variable char=27 (Esc)" }
    timeout                                      { fail "(timeout) set variable char=27 (Esc)" }
}                         


send "set variable v_char=32\n"
expect {
    -re "$prompt $"\
	{
	send "print v_char\n"
	expect {
	    -re ".\[0-9\]* = 32 \' \'.*$prompt $"       { pass "set variable char=32 (SPC)" }
	    -re "$prompt $"                      { fail "set variable char=32 (SPC)" }
	    timeout                              { fail "(timeout) set variable char=32 (SPC)" }
	}
    }
    -re "$prompt $"                              { fail "set variable char=32 (SPC)" }
    timeout                                      { fail "(timeout) set variable char=32 (SPC)" }
}                         


send "set variable v_char=65\n"
expect {
    -re "$prompt $"\
	{
	send "print v_char\n"
	expect {
	    -re ".\[0-9\]* = 65 \'A\'.*$prompt $"       { pass "set variable char=65 ('A')" }
	    -re "$prompt $"                      { fail "set variable char=65 ('A')" }
	    timeout                              { fail "(timeout) set variable char=65 ('A')" }
	}
    }
    -re "$prompt $"                              { fail "set variable char=65 ('A')" }
    timeout                                      { fail "(timeout) set variable char=65 ('A')" }
}                         


send "set variable v_char=97\n"
expect {
    -re "$prompt $"\
	{
	send "print v_char\n"
	expect {
	    -re ".\[0-9\]* = 97 \'a\'.*$prompt $"       { pass "set variable char=97 ('a')" }
	    -re "$prompt $"                      { fail "set variable char=97 ('a')" }
	    timeout                              { fail "(timeout) set variable char=97 ('a')" }
	}
    }
    -re "$prompt $"                              { fail "set variable char=97 ('a')" }
    timeout                                      { fail "(timeout) set variable char=97 ('a')" }
}                         


send "set variable v_char=126\n"
expect {
    -re "$prompt $"\
	{
	send "print v_char\n"
	expect {
	    -re ".\[0-9\]* = 126 \'~\'.*$prompt $"       { pass "set variable char=126 ('~')" }
	    -re "$prompt $"                      { fail "set variable char=126 ('~')" }
	    timeout                              { fail "(timeout) set variable char=126 ('~')" }
	}
    }
    -re "$prompt $"                              { fail "set variable char=126 ('~')" }
    timeout                                      { fail "(timeout) set variable char=126 ('~')" }
}                         


send "set variable v_char=127\n"
expect {
    -re "$prompt $"\
	{
	send "print v_char\n"
	expect {
	    -re ".\[0-9\]* = 127 \'.177\'.*$prompt $"       { pass "set variable char=127 (8-bit)" }
	    -re "$prompt $"                      { fail "set variable char=127 (8-bit)" }
	    timeout                              { fail "(timeout) set variable char=127 (8-bit)" }
	}
    }
    -re "$prompt $"                              { fail "set variable char=127 (8-bit)" }
    timeout                                      { fail "(timeout) set variable char=127 (8-bit)" }
}                         


#
# test "set variable" for type "signed char"
#    
send "set variable v_char=0\n"
expect {
    -re "$prompt $"\
	{
	send "print v_signed_char\n"
	expect {
	    -re ".\[0-9\]* = 0 \'.000\'.*$prompt $"       { pass "set variable signed char=0" }
	    -re "$prompt $"                      { fail "set variable signed char=0" }
	    timeout                              { fail "(timeout) set variable signed char=0" }
	}
    }
    -re "$prompt $"                              { fail "set variable signed char=0" }
    timeout                                      { fail "(timeout) set variable signed char=0" }
}                         


send "set variable v_signed_char=1\n"
expect {
    -re "$prompt $"\
	{
	send "print v_signed_char\n"
	expect {
	    -re ".\[0-9\]* = 1 \'.001\'.*$prompt $"       { pass "set variable signed char=1" }
	    -re "$prompt $"                      { fail "set variable signed char=1" }
	    timeout                              { fail "(timeout) set variable signed char=1" }
	}
    }
    -re "$prompt $"                              { fail "set variable signed char=1" }
    timeout                                      { fail "(timeout) set variable signed char=1" }
}                         


send "set variable v_signed_char=27\n"
expect {
    -re "$prompt $"\
	{
	send "print v_signed_char\n"
	expect {
	    -re ".\[0-9\]* = 27 \'.e\'.*$prompt $"       { pass "set variable signed char=27 (Esc)" }
	    -re "$prompt $"                      { fail "set variable signed char=27 (Esc)" }
	    timeout                              { fail "(timeout) set variable signed char=27 (Esc)" }
	}
    }
    -re "$prompt $"                              { fail "set variable signed char=27 (Esc)" }
    timeout                                      { fail "(timeout) set variable signed char=27 (Esc)" }
}                         


send "set variable v_signed_char=32\n"
expect {
    -re "$prompt $"\
	{
	send "print v_signed_char\n"
	expect {
	    -re ".\[0-9\]* = 32 \' \'.*$prompt $"       { pass "set variable signed char=32 (SPC)" }
	    -re "$prompt $"                      { fail "set variable signed char=32 (SPC)" }
	    timeout                              { fail "(timeout) set variable signed char=32 (SPC)" }
	}
    }
    -re "$prompt $"                              { fail "set variable signed char=32 (SPC)" }
    timeout                                      { fail "(timeout) set variable signed char=32 (SPC)" }
}                         


send "set variable v_signed_char=65\n"
expect {
    -re "$prompt $"\
	{
	send "print v_signed_char\n"
	expect {
	    -re ".\[0-9\]* = 65 \'A\'.*$prompt $"       { pass "set variable signed char=65 ('A')" }
	    -re "$prompt $"                      { fail "set variable signed char=65 ('A')" }
	    timeout                              { fail "(timeout) set variable signed char=65 ('A')" }
	}
    }
    -re "$prompt $"                              { fail "set variable signed char=65 ('A')" }
    timeout                                      { fail "(timeout) set variable signed char=65 ('A')" }
}                         


send "set variable v_signed_char=97\n"
expect {
    -re "$prompt $"\
	{
	send "print v_signed_char\n"
	expect {
	    -re ".\[0-9\]* = 97 \'a\'.*$prompt $"       { pass "set variable signed char=97 ('a')" }
	    -re "$prompt $"                      { fail "set variable signed char=97 ('a')" }
	    timeout                              { fail "(timeout) set variable signed char=97 ('a')" }
	}
    }
    -re "$prompt $"                              { fail "set variable signed char=97 ('a')" }
    timeout                                      { fail "(timeout) set variable signed char=97 ('a')" }
}                         


send "set variable v_signed_char=126\n"
expect {
    -re "$prompt $"\
	{
	send "print v_signed_char\n"
	expect {
	    -re ".\[0-9\]* = 126 \'~\'.*$prompt $"       { pass "set variable signed char=126 ('~')" }
	    -re "$prompt $"                      { fail "set variable signed char=126 ('~')" }
	    timeout                              { fail "(timeout) set variable signed char=126 ('~')" }
	}
    }
    -re "$prompt $"                              { fail "set variable signed char=126 ('~')" }
    timeout                                      { fail "(timeout) set variable signed char=126 ('~')" }
}                         


send "set variable v_signed_char=127\n"
expect {
    -re "$prompt $"\
	{
	send "print v_signed_char\n"
	expect {
	    -re ".\[0-9\]* = 127 \'.177\'.*$prompt $"       { pass "set variable signed char=127 (8-bit)" }
	    -re "$prompt $"                      { fail "set variable signed char=127 (8-bit)" }
	    timeout                              { fail "(timeout) set variable signed char=127 (8-bit)" }
	}
    }
    -re "$prompt $"                              { fail "set variable signed char=127 (8-bit)" }
    timeout                                      { fail "(timeout) set variable signed char=127 (8-bit)" }
}                         


gdb_test "set variable v_signed_char=-1" ""
if {!$gcc_compiled} then { setup_xfail "mips-sgi-irix4*" }
gdb_test "print v_signed_char" ".\[0-9\]* = -1 \'.377\'" \
    "set variable signed char=-1 (-1)"

gdb_test "set variable v_signed_char=0xFF" ""
if {!$gcc_compiled} then { setup_xfail "mips-sgi-irix4*" }
gdb_test "print v_signed_char" ".\[0-9\]* = -1 \'.377\'" \
    "set variable signed char=0xFF (0xFF)"


#
# test "set variable" for type "unsigned char"
#
send "set variable v_unsigned_char=0\n"
expect {
    -re "$prompt $"\
	{
	send "print v_unsigned_char\n"
	expect {
	    -re ".\[0-9\]* = 0 \'.000\'.*$prompt $"       { pass "set variable unsigned char=0" }
	    -re "$prompt $"                      { fail "set variable unsigned char=0" }
	    timeout                              { fail "(timeout) set variable unsigned char=0" }
	}
    }
    -re "$prompt $"                              { fail "set variable unsigned char=0" }
    timeout                                      { fail "(timeout) set variable unsigned char=0" }
}                         


send "set variable v_unsigned_char=1\n"
expect {
    -re "$prompt $"\
	{
	send "print v_unsigned_char\n"
	expect {
	    -re ".\[0-9\]* = 1 \'.001\'.*$prompt $"       { pass "set variable unsigned char=1" }
	    -re "$prompt $"                      { fail "set variable unsigned char=1" }
	    timeout                              { fail "(timeout) set variable unsigned char=1" }
	}
    }
    -re "$prompt $"                              { fail "set variable unsigned char=1" }
    timeout                                      { fail "(timeout) set variable unsigned char=1" }
}                         


send "set variable v_unsigned_char=27\n"
expect {
    -re "$prompt $"\
	{
	send "print v_unsigned_char\n"
	expect {
	    -re ".\[0-9\]* = 27 \'.e\'.*$prompt $"       { pass "set variable unsigned char=27 (Esc)" }
	    -re "$prompt $"                      { fail "set variable unsigned char=27 (Esc)" }
	    timeout                              { fail "(timeout) set variable unsigned char=27 (Esc)" }
	}
    }
    -re "$prompt $"                              { fail "set variable unsigned char=27 (Esc)" }
    timeout                                      { fail "(timeout) set variable unsigned char=27 (Esc)" }
}                         


send "set variable v_unsigned_char=32\n"
expect {
    -re "$prompt $"\
	{
	send "print v_unsigned_char\n"
	expect {
	    -re ".\[0-9\]* = 32 \' \'.*$prompt $"       { pass "set variable unsigned char=32 (SPC)" }
	    -re "$prompt $"                      { fail "set variable unsigned char=32 (SPC)" }
	    timeout                              { fail "(timeout) set variable unsigned char=32 (SPC)" }
	}
    }
    -re "$prompt $"                              { fail "set variable unsigned char=32 (SPC)" }
    timeout                                      { fail "(timeout) set variable unsigned char=32 (SPC)" }
}                         


send "set variable v_unsigned_char=65\n"
expect {
    -re "$prompt $"\
	{
	send "print v_unsigned_char\n"
	expect {
	    -re ".\[0-9\]* = 65 \'A\'.*$prompt $"       { pass "set variable unsigned char=65 ('A')" }
	    -re "$prompt $"                      { fail "set variable unsigned char=65 ('A')" }
	    timeout                              { fail "(timeout) set variable unsigned char=65 ('A')" }
	}
    }
    -re "$prompt $"                              { fail "set variable unsigned char=65 ('A')" }
    timeout                                      { fail "(timeout) set variable unsigned char=65 ('A')" }
}                         


send "set variable v_unsigned_char=97\n"
expect {
    -re "$prompt $"\
	{
	send "print v_unsigned_char\n"
	expect {
	    -re ".\[0-9\]* = 97 \'a\'.*$prompt $"       { pass "set variable unsigned char=97 ('a')" }
	    -re "$prompt $"                      { fail "set variable unsigned char=97 ('a')" }
	    timeout                              { fail "(timeout) set variable unsigned char=97 ('a')" }
	}
    }
    -re "$prompt $"                              { fail "set variable unsigned char=97 ('a')" }
    timeout                                      { fail "(timeout) set variable unsigned char=97 ('a')" }
}                         


send "set variable v_unsigned_char=126\n"
expect {
    -re "$prompt $"\
	{
	send "print v_unsigned_char\n"
	expect {
	    -re ".\[0-9\]* = 126 \'~\'.*$prompt $"       { pass "set variable unsigned char=126 ('~')" }
	    -re "$prompt $"                      { fail "set variable unsigned char=126 ('~')" }
	    timeout                              { fail "(timeout) set variable unsigned char=126 ('~')" }
	}
    }
    -re "$prompt $"                              { fail "set variable unsigned char=126 ('~')" }
    timeout                                      { fail "(timeout) set variable unsigned char=126 ('~')" }
}                         


send "set variable v_unsigned_char=~0\n"
expect {
    -re "$prompt $"\
	{
	send "print v_unsigned_char\n"
	expect {
	    -re ".\[0-9\]* = 255 \'.377\'.*$prompt $"       { pass "set variable unsigned char=255 (8-bit)" }
	    -re "$prompt $"                      { fail "set variable unsigned char=255 (8-bit)" }
	    timeout                              { fail "(timeout) set variable unsigned char=255 (8-bit)" }
	}
    }
    -re "$prompt $"                              { fail "set variable unsigned char=255 (8-bit)" }
    timeout                                      { fail "(timeout) set variable unsigned char=255 (8-bit)" }
}                         


#
# test "set variable" for type "short"
#
send "set variable v_short=0\n"
expect {
    -re "$prompt $"\
	{
	send "print v_short\n"
	expect {
	    -re ".\[0-9\]* = 0.*$prompt $"       { pass "set variable short=0" }
	    -re "$prompt $"                      { fail "set variable short=0" }
	    timeout                              { fail "(timeout) set variable short=0" }
	}
    }
    -re "$prompt $"                              { fail "set variable short=0" }
    timeout                                      { fail "(timeout) set variable short=0" }
}                         


send "set variable v_short=1\n"
expect {
    -re "$prompt $"\
	{
	send "print v_short\n"
	expect {
	    -re ".\[0-9\]* = 1.*$prompt $"       { pass "set variable short=1" }
	    -re "$prompt $"                      { fail "set variable short=1" }
	    timeout                              { fail "(timeout) set variable short=1" }
	}
    }
    -re "$prompt $"                              { fail "set variable short=1" }
    timeout                                      { fail "(timeout) set variable short=1" }
}                         


send "set variable v_short=-1\n"
expect {
    -re "$prompt $"\
	{
	send "print v_short\n"
	expect {
	    -re ".\[0-9\]* = -1.*$prompt $"       { pass "set variable short=-1 (minus)" }
	    -re "$prompt $"                      { fail "set variable short=-1 (minus)" }
	    timeout                              { fail "(timeout) set variable signed short=-1 (minus)" }
	}
    }
    -re "$prompt $"                              { fail "set variable short=-1 (minus)" }
    timeout                                      { fail "(timeout) set variable short=-1 (minus)" }
}                         


#
# test "set variable" for type "signed short"
#
send "set variable v_signed_short=0\n"
expect {
    -re "$prompt $"\
	{
	send "print v_signed_short\n"
	expect {
	    -re ".\[0-9\]* = 0.*$prompt $"       { pass "set variable signed short=0" }
	    -re "$prompt $"                      { fail "set variable signed short=0" }
	    timeout                              { fail "(timeout) set variable signed short=0" }
	}
    }
    -re "$prompt $"                              { fail "set variable signed short=0" }
    timeout                                      { fail "(timeout) set variable signed short=0" }
}                         


send "set variable v_signed_short=1\n"
expect {
    -re "$prompt $"\
	{
	send "print v_signed_short\n"
	expect {
	    -re ".\[0-9\]* = 1.*$prompt $"       { pass "set variable signed short=1" }
	    -re "$prompt $"                      { fail "set variable signed short=1" }
	    timeout                              { fail "(timeout) set variable signed short=1" }
	}
    }
    -re "$prompt $"                              { fail "set variable signed short=1" }
    timeout                                      { fail "(timeout) set variable signed short=1" }
}                         


send "set variable v_signed_short=-1\n"
expect {
    -re "$prompt $"\
	{
	send "print v_signed_short\n"
	expect {
	    -re ".\[0-9\]* = -1.*$prompt $"       { pass "set variable signed short=-1 (minus)" }
	    -re "$prompt $"                      { fail "set variable signed short=-1 (minus)" }
	    timeout                              { fail "(timeout) set variable signed short=-1 (minus)" }
	}
    }
    -re "$prompt $"                              { fail "set variable signed short=-1 (minus)" }
    timeout                                      { fail "(timeout) set variable signed short=-1 (minus)" }
}                         


#
# test "set variable" for type "unsigned short"
#
send "set variable v_unsigned_short=0\n"
expect {
    -re "$prompt $"\
	{
	send "print v_unsigned_short\n"
	expect {
	    -re ".\[0-9\]* = 0.*$prompt $"       { pass "set variable unsigned short=0" }
	    -re "$prompt $"                      { fail "set variable unsigned short=0" }
	    timeout                              { fail "(timeout) set variable unsigned short=0" }
	}
    }
    -re "$prompt $"                              { fail "set variable unsigned short=0" }
    timeout                                      { fail "(timeout) set variable unsigned short=0" }
}                         


send "set variable v_unsigned_short=1\n"
expect {
    -re "$prompt $"\
	{
	send "print v_unsigned_short\n"
	expect {
	    -re ".\[0-9\]* = 1.*$prompt $"       { pass "set variable unsigned short=1" }
	    -re "$prompt $"                      { fail "set variable unsigned short=1" }
	    timeout                              { fail "(timeout) set variable unsigned short=1" }
	}
    }
    -re "$prompt $"                              { fail "set variable unsigned short=1" }
    timeout                                      { fail "(timeout) set variable unsigned short=1" }
}                         


send "set variable v_unsigned_short=~0\n"
expect {
    -re "$prompt $"\
	{
	send "print v_unsigned_short\n"
	expect {
	    -re ".\[0-9\]* = 65535.*$prompt $"       { pass "set variable unsigned short=~0 (minus)" }
	    -re "$prompt $"                      { fail "set variable unsigned short=~0 (minus)" }
	    timeout                              { fail "(timeout)  set variable unsigned short=~0 (minus)" }
	}
    }
    -re "$prompt $"                              { fail "set variable unsigned short=~0 (minus)" }
    timeout                                      { fail "(timeout) set variable unsigned short=~0 (minus)" }
}                         


#
# test "set variable" for type "int"
#
send "set variable v_int=0\n"
expect {
    -re "$prompt $"\
	{
	send "print v_int\n"
	expect {
	    -re ".\[0-9\]* = 0.*$prompt $"       { pass "set variable int=0" }
	    -re "$prompt $"                      { fail "set variable int=0" }
	    timeout                              { fail "(timeout) set variable int=0" }
	}
    }
    -re "$prompt $"                              { fail "set variable int=0" }
    timeout                                      { fail "(timeout) set variable int=0" }
}                         


send "set variable v_int=1\n"
expect {
    -re "$prompt $"\
	{
	send "print v_int\n"
	expect {
	    -re ".\[0-9\]* = 1.*$prompt $"       { pass "set variable int=1" }
	    -re "$prompt $"                      { fail "set variable int=1" }
	    timeout                              { fail "(timeout) set variable int=1" }
	}
    }
    -re "$prompt $"                              { fail "set variable int=1" }
    timeout                                      { fail "(timeout) set variable int=1" }
}                         


send "set variable v_int=-1\n"
expect {
    -re "$prompt $"\
	{
	send "print v_int\n"
	expect {
	    -re ".\[0-9\]* = -1.*$prompt $"       { pass "set variable int=-1 (minus)" }
	    -re "$prompt $"                      { fail "set variable int=-1 (minus)" }
	    timeout                              { fail "(timeout) set variable signed int=-1 (minus)" }
	}
    }
    -re "$prompt $"                              { fail "set variable int=-1 (minus)" }
    timeout                                      { fail "(timeout) set variable int=-1 (minus)" }
}                         


#
# test "set variable" for type "signed int"
#
send "set variable v_signed_int=0\n"
expect {
    -re "$prompt $"\
	{
	send "print v_signed_int\n"
	expect {
	    -re ".\[0-9\]* = 0.*$prompt $"       { pass "set variable signed int=0" }
	    -re "$prompt $"                      { fail "set variable signed int=0" }
	    timeout                              { fail "(timeout) set variable signed int=0" }
	}
    }
    -re "$prompt $"                              { fail "set variable signed int=0" }
    timeout                                      { fail "(timeout) set variable signed int=0" }
}                         


send "set variable v_signed_int=1\n"
expect {
    -re "$prompt $"\
	{
	send "print v_signed_int\n"
	expect {
	    -re ".\[0-9\]* = 1.*$prompt $"       { pass "set variable signed int=1" }
	    -re "$prompt $"                      { fail "set variable signed int=1" }
	    timeout                              { fail "(timeout) set variable signed int=1" }
	}
    }
    -re "$prompt $"                              { fail "set variable signed int=1" }
    timeout                                      { fail "(timeout) set variable signed int=1" }
}                         


send "set variable v_signed_int=-1\n"
expect {
    -re "$prompt $"\
	{
	send "print v_signed_int\n"
	expect {
	    -re ".\[0-9\]* = -1.*$prompt $"       { pass "set variable signed int=-1 (minus)" }
	    -re "$prompt $"                      { fail "set variable signed int=-1 (minus)" }
	    timeout                              { fail "(timeout) set variable signed int=-1 (minus)" }
	}
    }
    -re "$prompt $"                              { fail "set variable signed int=-1 (minus)" }
    timeout                                      { fail "(timeout) set variable signed int=-1 (minus)" }
}                         


#
# test "set variable" for type "unsigned int"
#
send "set variable v_unsigned_int=0\n"
expect {
    -re "$prompt $"\
	{
	send "print v_unsigned_int\n"
	expect {
	    -re ".\[0-9\]* = 0.*$prompt $"       { pass "set variable unsigned int=0" }
	    -re "$prompt $"                      { fail "set variable unsigned int=0" }
	    timeout                              { fail "(timeout) set variable unsigned int=0" }
	}
    }
    -re "$prompt $"                              { fail "set variable unsigned int=0" }
    timeout                                      { fail "(timeout) set variable unsigned int=0" }
}                         


send "set variable v_unsigned_int=1\n"
expect {
    -re "$prompt $"\
	{
	send "print v_unsigned_int\n"
	expect {
	    -re ".\[0-9\]* = 1.*$prompt $"       { pass "set variable unsigned int=1" }
	    -re "$prompt $"                      { fail "set variable unsigned int=1" }
	    timeout                              { fail "(timeout) set variable unsigned int=1" }
	}
    }
    -re "$prompt $"                              { fail "set variable unsigned int=1" }
    timeout                                      { fail "(timeout) set variable unsigned int=1" }
}                         


send "set variable v_unsigned_int=~0\n"
expect {
    -re "$prompt $"\
	{
	send "print v_unsigned_int\n"
	expect {
	    -re ".\[0-9\]* = 4294967295.*$prompt $"       { pass "set variable unsigned int=~0 (minus)" }
	    -re ".\[0-9\]* = 65535.*$prompt $"       { pass "set variable unsigned int=~0 (minus)" }
	    -re "$prompt $"                      { fail "set variable unsigned int=~0 (minus)" }
	    timeout                              { fail "(timeout) set variable unsigned int=~0 (minus)" }
	}
    }
    -re "$prompt $"                              { fail "set variable unsigned int=~0 (minus)" }
    timeout                                      { fail "(timeout) set variable unsigned int=~0 (minus)" }
}                         


#
# test "set variable" for type "long"
#
send "set variable v_long=0\n"
expect {
    -re "$prompt $"\
	{
	send "print v_long\n"
	expect {
	    -re ".\[0-9\]* = 0.*$prompt $"       { pass "set variable long=0" }
	    -re "$prompt $"                      { fail "set variable long=0" }
	    timeout                              { fail "(timeout) set variable long=0" }
	}
    }
    -re "$prompt $"                              { fail "set variable long=0" }
    timeout                                      { fail "(timeout) set variable long=0" }
}                         


send "set variable v_long=1\n"
expect {
    -re "$prompt $"\
	{
	send "print v_long\n"
	expect {
	    -re ".\[0-9\]* = 1.*$prompt $"       { pass "set variable long=1" }
	    -re "$prompt $"                      { fail "set variable long=1" }
	    timeout                              { fail "(timeout) set variable long=1" }
	}
    }
    -re "$prompt $"                              { fail "set variable long=1" }
    timeout                                      { fail "(timeout) set variable long=1" }
}                         


send "set variable v_long=-1\n"
expect {
    -re "$prompt $"\
	{
	send "print v_long\n"
	expect {
	    -re ".\[0-9\]* = -1.*$prompt $"       { pass "set variable long=-1 (minus)" }
	    -re "$prompt $"                      { fail "set variable long=-1 (minus)" }
	    timeout                              { fail "(timeout) set variable signed long=-1 (minus)" }
	}
    }
    -re "$prompt $"                              { fail "set variable long=-1 (minus)" }
    timeout                                      { fail "(timeout) set variable long=-1 (minus)" }
}                         


#
# test "set variable" for type "signed long"
#
send "set variable v_signed_long=0\n"
expect {
    -re "$prompt $"\
	{
	send "print v_signed_long\n"
	expect {
	    -re ".\[0-9\]* = 0.*$prompt $"       { pass "set variable signed long=0" }
	    -re "$prompt $"                      { fail "set variable signed long=0" }
	    timeout                              { fail "(timeout) set variable signed long=0" }
	}
    }
    -re "$prompt $"                              { fail "set variable signed long=0" }
    timeout                                      { fail "(timeout) set variable signed long=0" }
}                         


send "set variable v_signed_long=1\n"
expect {
    -re "$prompt $"\
	{
	send "print v_signed_long\n"
	expect {
	    -re ".\[0-9\]* = 1.*$prompt $"       { pass "set variable signed long=1" }
	    -re "$prompt $"                      { fail "set variable signed long=1" }
	    timeout                              { fail "(timeout) set variable signed long=1" }
	}
    }
    -re "$prompt $"                              { fail "set variable signed long=1" }
    timeout                                      { fail "(timeout) set variable signed long=1" }
}                         


send "set variable v_signed_long=-1\n"
expect {
    -re "$prompt $"\
	{
	send "print v_signed_long\n"
	expect {
	    -re ".\[0-9\]* = -1.*$prompt $"       { pass "set variable signed long=-1 (minus)" }
	    -re "$prompt $"                      { fail "set variable signed long=-1 (minus)" }
	    timeout                              { fail "(timeout) set variable signed long=-1 (minus)" }
	}
    }
    -re "$prompt $"                              { fail "set variable signed long=-1 (minus)" }
    timeout                                      { fail "(timeout) set variable signed long=-1 (minus)" }
}                         


#
# test "set variable" for type "unsigned long"
#
send "set variable v_unsigned_long=0\n"
expect {
    -re "$prompt $"\
	{
	send "print v_unsigned_long\n"
	expect {
	    -re ".\[0-9\]* = 0.*$prompt $"       { pass "set variable unsigned long=0" }
	    -re "$prompt $"                      { fail "set variable unsigned long=0" }
	    timeout                              { fail "(timeout) set variable unsigned long=0" }
	}
    }
    -re "$prompt $"                              { fail "set variable unsigned long=0" }
    timeout                                      { fail "(timeout) set variable unsigned long=0" }
}                         


send "set variable v_unsigned_long=1\n"
expect {
    -re "$prompt $"\
	{
	send "print v_unsigned_long\n"
	expect {
	    -re ".\[0-9\]* = 1.*$prompt $"       { pass "set variable unsigned long=1" }
	    -re "$prompt $"                      { fail "set variable unsigned long=1" }
	    timeout                              { fail "(timeout) set variable unsigned long=1" }
	}
    }
    -re "$prompt $"                              { fail "set variable unsigned long=1" }
    timeout                                      { fail "(timeout) set variable unsigned long=1" }
}                         


send "set variable v_unsigned_long=~0\n"
expect {
    -re "$prompt $"\
	{
	send "print v_unsigned_long\n"
	expect {
	    -re ".\[0-9\]* = $ulong_minus_1.*$prompt $"       { pass "set variable unsigned long=~0 (minus)" }
	    -re "$prompt $"                      { fail "set variable unsigned long=~0 (minus)" }
	    timeout                              { fail "(timeout) set variable unsigned long=~0 (minus)" }
	}
    }
    -re "$prompt $"                              { fail "set variable unsigned long=~0 (minus)" }
    timeout                                      { fail "(timeout) set variable unsigned long=~0 (minus)" }
}                         


#
# test "set variable" for type "float"
#
send "set variable v_float=0.0\n"
expect {
    -re "$prompt $"\
	{
	send "print v_float\n"
	expect {
	    -re ".\[0-9\]* = 0.*$prompt $"       { pass "set variable float=0" }
	    -re "$prompt $"                      { fail "set variable float=0" }
	    timeout                              { fail "(timeout) set variable float=0" }
	}
    }
    -re "$prompt $"                              { fail "set variable float=0" }
    timeout                                      { fail "(timeout) set variable float=0" }
}                         


send "set variable v_float=1.0\n"
expect {
    -re "$prompt $"\
	{
	send "print v_float\n"
	expect {
	    -re ".\[0-9\]* = 1.*$prompt $"       { pass "set variable float=1" }
	    -re "$prompt $"                      { fail "set variable float=1" }
	    timeout                              { fail "(timeout) set variable float=1" }
	}
    }
    -re "$prompt $"                              { fail "set variable float=1" }
    timeout                                      { fail "(timeout) set variable float=1" }
}                         


send "set variable v_float=-1.0\n"
expect {
    -re "$prompt $"\
	{
	send "print v_float\n"
	expect {
	    -re ".\[0-9\]* = -1.*$prompt $"       { pass "set variable float=-1 (minus)" }
	    -re "$prompt $"                      { fail "set variable float=-1 (minus)" }
	    timeout                              { fail "(timeout) set variable signed float=-1 (minus)" }
	}
    }
    -re "$prompt $"                              { fail "set variable float=-1 (minus)" }
    timeout                                      { fail "(timeout) set variable float=-1 (minus)" }
}                         


#
# test "set variable" for type "double"
#
send "set variable v_double=0.0\n"
expect {
    -re "$prompt $"\
	{
	send "print v_double\n"
	expect {
	    -re ".\[0-9\]* = 0.*$prompt $"       { pass "set variable double=0" }
	    -re "$prompt $"                      { fail "set variable double=0" }
	    timeout                              { fail "(timeout) set variable double=0" }
	}
    }
    -re "$prompt $"                              { fail "set variable double=0" }
    timeout                                      { fail "(timeout) set variable double=0" }
}                         


send "set variable v_double=1.0\n"
expect {
    -re "$prompt $"\
	{
	send "print v_double\n"
	expect {
	    -re ".\[0-9\]* = 1.*$prompt $"       { pass "set variable double=1" }
	    -re "$prompt $"                      { fail "set variable double=1" }
	    timeout                              { fail "(timeout) set variable double=1" }
	}
    }
    -re "$prompt $"                              { fail "set variable double=1" }
    timeout                                      { fail "(timeout) set variable double=1" }
}                         


send "set variable v_double=-1.0\n"
expect {
    -re "set.*$prompt $"\
	{
	send "print v_double\n"
	expect {
	    -re "print.*.\[0-9\]* = -1.*$prompt $"       { pass "set variable double=-1 (minus)" }
	    -re "$prompt $"                      { fail "set variable double=-1 (minus)" }
	    timeout                              { fail "(timeout) set variable double=-1 (minus)" }
	}
    }
    -re "$prompt $"                              { fail "set variable double=-1 (minus)" }
    timeout                                      { fail "(timeout) set variable double=-1 (minus)" }
}                         


#
# test "set variable" for "char array[2]"
#
send "set variable v_char_array\[0\]='h'\n"
expect -re "$prompt $"
send "set variable v_char_array\[1\]='i'\n"
expect {
    -re "set.*$prompt $"\
	{
	send "print v_char_array\n"
	expect {
	    -re "print.*.\[0-9\]* =.*\"hi\".*$prompt $"       { pass "set variable char array=\"hi\" (string)" }
	    -re "$prompt $"                      { fail "set variable char array=\"hi\" (string)" }
	    timeout                              { fail "(timeout) set variable char array=\"hi\" (string)" }
	}
    }
    -re "$prompt $"                              { fail "set variable char array=\"hi\" (string)" }
    timeout                                      { fail "(timeout) set variable char array=\"hi\" (string)" }
}                         


#
# test "set variable" for "signed char array[2]"
#
send "set variable v_signed_char_array\[0\]='h'\n"
expect -re "$prompt $"
send "set variable v_signed_char_array\[1\]='i'\n"
expect {
    -re "set.*$prompt $"\
	{
	send "print v_signed_char_array\n"
	expect {
	    -re "print.*.\[0-9\]* =.*\"hi\".*$prompt $"       { pass "set variable signed char array=\"hi\" (string)" }
	    -re "$prompt $"                      { fail "set variable signed char array=\"hi\" (string)" }
	    timeout                              { fail "(timeout) set variable signed char array=\"hi\" (string)" }
	}
    }
    -re "$prompt $"                              { fail "set variable signed char array=\"hi\" (string)" }
    timeout                                      { fail "(timeout) set variable signed char array=\"hi\" (string)" }
}                         


#
# test "set variable" for "unsigned char array[2]"
#
send "set variable v_unsigned_char_array\[0\]='h'\n"
expect -re "$prompt $"
send "set variable v_unsigned_char_array\[1\]='i'\n"
expect {
    -re "set.*$prompt $"\
	{
	send "print v_unsigned_char_array\n"
	expect {
	    -re "print.*.\[0-9\]* =.*\"hi\".*$prompt $"       { pass "set variable unsigned char array=\"hi\" (string)" }
	    -re "$prompt $"                      { fail "set variable unsigned char array=\"hi\" (string)" }
	    timeout                              { fail "(timeout) set variable unsigned char array=\"hi\" (string)" }
	}
    }
    -re "$prompt $"                              { fail "set variable unsigned char array=\"hi\" (string)" }
    timeout                                      { fail "(timeout) set variable unsigned char array=\"hi\" (string)" }
}                         


#
# test "set variable" for "short array[2]"
#
send "set variable v_short_array\[0\]=123\n"
expect -re "$prompt $"
send "set variable v_short_array\[1\]=-456\n"
expect {
    -re "set.*$prompt $"\
	{
	send "print v_short_array\n"
	expect {
	    -re "print.*.\[0-9\]* =.*\{123,.*-456\}.*$prompt $"       { pass "set variable short array" }
	    -re "$prompt $"                      { fail "set variable short array" }
	    timeout                              { fail "(timeout) set variable short array" }
	}
    }
    -re "$prompt $"                              { fail "set variable short array" }
    timeout                                      { fail "(timeout) set variable short array" }
}                         


#
# test "set variable" for "signed short array[2]"
#
send "set variable v_signed_short_array\[0\]=123\n"
expect -re "$prompt $"
send "set variable v_signed_short_array\[1\]=-456\n"
expect {
    -re "set.*$prompt $"\
	{
	send "print v_signed_short_array\n"
	expect {
	    -re "print.*.\[0-9\]* =.*\{123,.*-456\}.*$prompt $"       { pass "set variable signed short array" }
	    -re "$prompt $"                      { fail "set variable signed short array" }
	    timeout                              { fail "(timeout) set variable signed short array" }
	}
    }
    -re "$prompt $"                              { fail "set variable signed short array" }
    timeout                                      { fail "(timeout) set variable signed short array" }
}                         


#
# test "set variable" for "unsigned short array[2]"
#
send "set variable v_unsigned_short_array\[0\]=123\n"
expect -re "$prompt $"
send "set variable v_unsigned_short_array\[1\]=-456\n"
expect {
    -re "set.*$prompt $"\
	{
	send "print v_unsigned_short_array\n"
	expect {
	    -re "print.*.\[0-9\]* =.*\{123,.*65080\}.*$prompt $"       { pass "set variable unsigned short array" }
	    -re "$prompt $"                      { fail "set variable unsigned short array" }
	    timeout                              { fail "(timeout) set variable unsigned short array" }
	}
    }
    -re "$prompt $"                              { fail "set variable unsigned short array" }
    timeout                                      { fail "(timeout) set variable unsigned short array" }
}                         


#
# test "set variable" for "int array[2]"
#
send "set variable v_int_array\[0\]=123\n"
expect -re "$prompt $"
send "set variable v_int_array\[1\]=-456\n"
expect {
    -re "set.*$prompt $"\
	{
	send "print v_int_array\n"
	expect {
	    -re "print.*.\[0-9\]* =.*\{123,.*-456\}.*$prompt $"       { pass "set variable int array" }
	    -re "$prompt $"                      { fail "set variable int array" }
	    timeout                              { fail "(timeout) set variable int array" }
	}
    }
    -re "$prompt $"                              { fail "set variable int array" }
    timeout                                      { fail "(timeout) set variable int array" }
}                         


#
# test "set variable" for "signed int array[2]"
#
send "set variable v_signed_int_array\[0\]=123\n"
expect -re "$prompt $"
send "set variable v_signed_int_array\[1\]=-456\n"
expect {
    -re "set.*$prompt $"\
	{
	send "print v_signed_int_array\n"
	expect {
	    -re "print.*.\[0-9\]* =.*\{123,.*-456\}.*$prompt $"       { pass "set variable signed int array" }
	    -re "$prompt $"                      { fail "set variable signed int array" }
	    timeout                              { fail "(timeout) set variable signed int array" }
	}
    }
    -re "$prompt $"                              { fail "set variable signed int array" }
    timeout                                      { fail "(timeout) set variable signed int array" }
}                         



#
# test "set variable" for "unsigned int array[2]"
#
send "set variable v_unsigned_int_array\[0\]=123\n"
expect -re "$prompt $"
send "set variable v_unsigned_int_array\[1\]=-456\n"
expect {
    -re "set.*$prompt $"\
	{
	send "print v_unsigned_int_array\n"
	expect {
	    -re "print.*.\[0-9\]* =.*\{123,.*4294966840\}.*$prompt $"       { pass "set variable unsigned int array" }
	    -re "print.*.\[0-9\]* =.*\{123,.*65080\}.*$prompt $"       { pass "set variable unsigned int array" }
	    -re "$prompt $"                      { fail "set variable unsigned int array" }
	    timeout                              { fail "(timeout) set variable unsigned int array" }
	}
    }
    -re "$prompt $"                              { fail "set variable unsigned int array" }
    timeout                                      { fail "(timeout) set variable unsigned int array" }
}                         


#
# test "set variable" for "long array[2]"
#
send "set variable v_long_array\[0\]=123\n"
expect -re "$prompt $"
send "set variable v_long_array\[1\]=-456\n"
expect {
    -re "set.*$prompt $"\
	{
	send "print v_long_array\n"
	expect {
	    -re "print.*.\[0-9\]* =.*\{123,.*-456\}.*$prompt $"       { pass "set variable long array" }
	    -re "$prompt $"                      { fail "set variable long array" }
	    timeout                              { fail "(timeout) set variable long array" }
	}
    }
    -re "$prompt $"                              { fail "set variable long array" }
    timeout                                      { fail "(timeout) set variable long array" }
}                         


#
# test "set variable" for "signed long array[2]"
#
send "set variable v_signed_long_array\[0\]=123\n"
expect -re "$prompt $"
send "set variable v_signed_long_array\[1\]=-456\n"
expect {
    -re "set.*$prompt $"\
	{
	send "print v_signed_long_array\n"
	expect {
	    -re "print.*.\[0-9\]* =.*\{123,.*-456\}.*$prompt $"       { pass "set variable signed long array" }
	    -re "$prompt $"                      { fail "set variable signed long array" }
	    timeout                              { fail "(timeout) set variable signed long array" }
	}
    }
    -re "$prompt $"                              { fail "set variable signed long array" }
    timeout                                      { fail "(timeout) set variable signed long array" }
}                         



#
# test "set variable" for "unsigned long array[2]"
#
send "set variable v_unsigned_long_array\[0\]=123\n"
expect -re "$prompt $"
send "set variable v_unsigned_long_array\[1\]=-456\n"
expect {
    -re "$prompt $"\
	{
	send "print v_unsigned_long_array\n"
	expect {
	    -re "print.*.\[0-9\]* =.*\{123,.*$ulong_minus_456\}.*$prompt $"       { pass "set variable unsigned long array" }
	    -re "$prompt $"                      { fail "set variable unsigned long array" }
	    timeout                              { fail "(timeout) set variable unsigned long array" }
	}
    }
    -re "$prompt $"                              { fail "set variable unsigned long array" }
    timeout                                      { fail "(timeout) set variable unsigned long array" }
}                         


#
# test "set variable" for "float array[2]"
#
send "set variable v_float_array\[0\]=123.0\n"
expect -re "$prompt $"
send "set variable v_float_array\[1\]=-456.0\n"
expect {
    -re "$prompt $"\
	{
	send "print v_float_array\n"
	expect {
	    -re "print.*.\[0-9\]* =.*\{123,.*-456\}.*$prompt $"       { pass "set variable float array" }
	    -re "$prompt $"                      { fail "set variable float array" }
	    timeout                              { fail "(timeout) set variable float array" }
	}
    }
    -re "$prompt $"                              { fail "set variable float array" }
    timeout                                      { fail "(timeout) set variable float array" }
}                         


#
# test "set variable" for "double array[2]"
#
send "set variable v_double_array\[0\]=123.0\n"
expect -re "$prompt $"
send "set variable v_double_array\[1\]=-456.0\n"
expect {
    -re "$prompt $"\
	{
	send "print v_double_array\n"
	expect {
	    -re "print.*.\[0-9\]* =.*\{123,.*-456\}.*$prompt $"       { pass "set variable double array" }
	    -re "$prompt $"                      { fail "set variable double array" }
	    timeout                              { fail "(timeout) set variable double array" }
	}
    }
    -re "$prompt $"                              { fail "set variable double array" }
    timeout                                      { fail "(timeout) set variable double array" }
}                         


#
# test "set variable" for type "char *"
#
send "set v_char_pointer=v_char_array\n"
expect -re "set.*$prompt $"
send "set variable *(v_char_pointer)='h'\n"
expect -re "set.*$prompt $"
send "set variable *(v_char_pointer+1)='i'\n"
expect {
    -re "set.*$prompt $" {
	send "print v_char_array\n"
	expect {
	    -re "print.*.\[0-9\]* =.*\"hi\".*$prompt $" {
		send "print *(v_char_pointer+1)\n"
		expect {
		    -re "print.*.\[0-9\]* = 105 \'i\'.*$prompt $"    { pass "set variable char pointer=\"hi\" (string)" }
		    -re "$prompt $"                              { fail "set variable char pointer=\"hi\" (string)" }
		    timeout                              { fail "(timeout) set variable char pointer=\"hi\" (string)" }

		}
	    }
	    -re "$prompt $"                              { fail "set variable char pointer=\"hi\" (string)" }
	    timeout                              { fail "(timeout) set variable char pointer=\"hi\" (string)" }
	}
    }
    -re "$prompt $"                              { fail "set variable char pointer=\"hi\" (string)" }
    timeout                                      { fail "(timeout) set variable char pointer=\"hi\" (string)" }
}                         


#
# test "set variable" for type "signed char *"
#
send "set v_signed_char_pointer=v_signed_char_array\n"
expect -re "set.*$prompt $"
send "set variable *(v_signed_char_pointer)='h'\n"
expect -re "set.*$prompt $"
send "set variable *(v_signed_char_pointer+1)='i'\n"
expect {
    -re "set.*$prompt $" {
	send "print v_signed_char_array\n"
	expect {
	    -re "print.*.\[0-9\]* =.*\"hi\".*$prompt $" {
		send "print *(v_signed_char_pointer+1)\n"
		expect {
		    -re "print.*.\[0-9\]* = 105 \'i\'.*$prompt $"    { pass "set variable signed char pointer=\"hi\" (string)" }
		    -re "$prompt $"                { fail "set variable signed char pointer=\"hi\" (string)" }
		    timeout                              { fail "(timeout) set variable signed char pointer=\"hi\" (string)" }

		}
	    }
	    -re "$prompt $"                { fail "set variable signed char pointer=\"hi\" (string)" }
	    timeout                              { fail "(timeout) set variable signed char pointer=\"hi\" (string)" }
	}
    }
    -re "$prompt $"                { fail "set variable signed char pointer=\"hi\" (string)" }
    timeout                                      { fail "(timeout) set variable signed char pointer=\"hi\" (string)" }
}                         


#
# test "set variable" for type "unsigned char *"
#
send "set v_unsigned_char_pointer=v_unsigned_char_array\n"
expect -re "set.*$prompt $"
send "set variable *(v_unsigned_char_pointer)='h'\n"
expect -re "set.*$prompt $"
send "set variable *(v_unsigned_char_pointer+1)='i'\n"
expect {
    -re "set.*$prompt $" {
	send "print v_unsigned_char_array\n"
	expect {
	    -re "print.*.\[0-9\]* =.*\"hi\".*$prompt $" {
		send "print *(v_unsigned_char_pointer+1)\n"
		expect {
		    -re "print.*.\[0-9\]* = 105 \'i\'.*$prompt $"    { pass "set variable unsigned char pointer=\"hi\" (string)" }
		    -re "$prompt $"                { fail "set variable unsigned char pointer=\"hi\" (string)" }
		    timeout                              { fail "(timeout) set variable unsigned char pointer=\"hi\" (string)" }

		}
	    }
	    -re "$prompt $"                { fail "set variable unsigned char pointer=\"hi\" (string)" }
	    timeout                              { fail "(timeout) set variable unsigned char pointer=\"hi\" (string)" }
	}
    }
    -re "$prompt $"                { fail "set variable unsigned char pointer=\"hi\" (string)" }
    timeout                                      { fail "(timeout) set variable unsigned char pointer=\"hi\" (string)" }
}                         


#
# test "set variable" for type "short *"
#
send "set v_short_pointer=v_short_array\n"
expect -re "set.*$prompt $"
send "set variable *(v_short_pointer)=123\n"
expect -re "set.*$prompt $"
send "set variable *(v_short_pointer+1)=-456\n"
expect {
    -re "set.*$prompt $" {
	send "print v_short_array\n"
	expect {
	    -re "print.*.\[0-9\]* =.*\{123,.*-456\}.*$prompt $" {
		send "print *(v_short_pointer+1)\n"
		expect {
		    -re "print.*.\[0-9\]* = -456.*$prompt $"    { pass "set variable short pointer" }
		    -re "$prompt $"                      { fail "set variable short pointer" }
		    timeout                              { fail "(timeout) set variable short pointer" }

		}
	    }
	    -re "$prompt $"                { fail "set variable short pointer" }
	    timeout                              { fail "(timeout) set variable short pointer" }
	}
    }
    -re "$prompt $"                { fail "set variable short pointer" }
    timeout                                      { fail "(timeout) set variable short pointer" }
}                         


#
# test "set variable" for type "signed short *"
#
gdb_test "set v_signed_short_pointer=v_signed_short_array" ""
gdb_test "set variable *(v_signed_short_pointer)=123" ""
gdb_test "set variable *(v_signed_short_pointer+1)=-456" ""
gdb_test "print v_signed_short_array" ".\[0-9\]* =.*\{123,.*-456\}" \
    "set variable signed short pointer"
gdb_test "print *(v_signed_short_pointer+1)" ".\[0-9\]*.*=.*-456"


#
# test "set variable" for type "unsigned short *"
#
gdb_test "set v_unsigned_short_pointer=v_unsigned_short_array" ""
gdb_test "set variable *(v_unsigned_short_pointer)=123" ""
gdb_test "set variable *(v_unsigned_short_pointer+1)=-456" ""
gdb_test "print v_unsigned_short_array" ".\[0-9\]* =.*\{123,.*65080\}" \
    "set variable unsigned short pointer"
gdb_test "print *(v_unsigned_short_pointer+1)" ".\[0-9\]* = 65080"


#
# test "set variable" for type "int *"
#
send "set v_int_pointer=v_int_array\n"
expect -re "set.*$prompt $"
send "set variable *(v_int_pointer)=123\n"
expect -re "set.*$prompt $"
send "set variable *(v_int_pointer+1)=-456\n"
expect {
    -re "set.*$prompt $" {
	send "print v_int_array\n"
	expect {
	    -re "print.*.\[0-9\]* =.*\{123,.*-456\}.*$prompt $" {
		send "print *(v_int_pointer+1)\n"
		expect {
		    -re "print.*.\[0-9\]* = -456.*$prompt $"    { pass "set variable int pointer" }
		    -re "$prompt $"                { fail "set variable int pointer" }
		    timeout                              { fail "(timeout) set variable int pointer" }

		}
	    }
	    -re "$prompt $"                { fail "set variable int pointer" }
	    timeout                              { fail "(timeout) set variable int pointer" }
	}
    }
    -re "$prompt $"                { fail "set variable int pointer" }
     timeout                                      { fail "(timeout) set variable int pointer" }
}                         


#
# test "set variable" for type "signed int *"
#
send "set v_signed_int_pointer=v_signed_int_array\n"
expect -re "set.*$prompt $"
send "set variable *(v_signed_int_pointer)=123\n"
expect -re "set.*$prompt $"
send "set variable *(v_signed_int_pointer+1)=-456\n"
expect {
    -re "set.*$prompt $" {
	send "print v_signed_int_array\n"
	expect {
	    -re "print.*.\[0-9\]* =.*\{123,.*-456\}.*$prompt $" {
		send "print *(v_signed_int_pointer+1)\n"
		expect {
		    -re "print.*.\[0-9\]* = -456.*$prompt $"    { pass "set variable signed int pointer" }
		    -re "$prompt $"                { fail "set variable signed int pointer" }
		    timeout                              { fail "(timeout) set variable signed int pointer" }

		}
	    }
	    -re "$prompt $"                { fail "set variable signed int pointer" }
	    timeout                              { fail "(timeout) set variable signed int pointer" }
	}
    }
    -re "$prompt $"                { fail "set variable signed int pointer" }
       timeout                                      { fail "(timeout) set variable signed int pointer" }
}                         


#
# test "set variable" for type "unsigned int *"
#
send "set v_unsigned_int_pointer=v_unsigned_int_array\n"
expect -re "set.*$prompt $"
send "set variable *(v_unsigned_int_pointer)=123\n"
expect -re "set.*$prompt $"
send "set variable *(v_unsigned_int_pointer+1)=-456\n"
expect {
    -re "set.*$prompt $" {
	send "print v_unsigned_int_array\n"
	expect {
	    -re "print.*.\[0-9\]* =.*\{123,.*4294966840\}.*$prompt $" {
		send "print *(v_unsigned_int_pointer+1)\n"
		expect {
		    -re "print.*.\[0-9\]* = 4294966840.*$prompt $"    { pass "set variable unsigned int pointer" }
		    -re "$prompt $"                { fail "set variable unsigned int pointer" }
		    timeout                              { fail "(timeout) set variable unsigned int pointer" }

		}
	    }
	    -re "print.*.\[0-9\]* =.*\{123,.*65080\}.*$prompt $" {
		send "print *(v_unsigned_int_pointer+1)\n"
		expect {
		    -re "print.*.\[0-9\]* = 65080.*$prompt $"    { pass "set variable unsigned int pointer" }
		    -re "$prompt $"                { fail "set variable unsigned int pointer" }
		    timeout                              { fail "(timeout) set variable unsigned int pointer" }

		}
	    }
	    -re "$prompt $"                { fail "set variable unsigned int pointer" }
	    timeout                              { fail "(timeout) set variable unsigned int pointer" }
	}
    }
    -re "$prompt $"                { fail "set variable unsigned int pointer" }
    timeout                                      { fail "(timeout) set variable unsigned int pointer" }
}                         


#
# test "set variable" for type "long *"
#
send "set v_long_pointer=v_long_array\n"
expect -re "set.*$prompt $"
send "set variable *(v_long_pointer)=123\n"
expect -re "set.*$prompt $"
send "set variable *(v_long_pointer+1)=-456\n"
expect {
    -re "set.*$prompt $" {
	send "print v_long_array\n"
	expect {
	    -re "print.*.\[0-9\]* =.*\{123,.*-456\}.*$prompt $" {
		send "print *(v_long_pointer+1)\n"
		expect {
		    -re "print.*.\[0-9\]* = -456.*$prompt $"    { pass "set variable long pointer" }
		    -re "$prompt $"                { fail "set variable long pointer" }
		    timeout                              { fail "(timeout) set variable long pointer" }

		}
	    }
	    -re "$prompt $"                { fail "set variable long pointer" }
	    timeout                              { fail "(timeout) set variable long pointer" }
	}
    }
    -re "$prompt $"                { fail "set variable long pointer" }
     timeout                                      { fail "(timeout) set variable long pointer" }
}                         


#
# test "set variable" for type "signed long *"
#
send "set v_signed_long_pointer=v_signed_long_array\n"
expect -re "set.*$prompt $"
send "set variable *(v_signed_long_pointer)=123\n"
expect -re "set.*$prompt $"
send "set variable *(v_signed_long_pointer+1)=-456\n"
expect {
    -re "set.*$prompt $" {
	send "print v_signed_long_array\n"
	expect {
	    -re "print.*.\[0-9\]* =.*\{123,.*-456\}.*$prompt $" {
		send "print *(v_signed_long_pointer+1)\n"
		expect {
		    -re "print.*.\[0-9\]* = -456.*$prompt $"    { pass "set variable signed long pointer" }
		    -re "$prompt $"                { fail "set variable signed long pointer" }
		    timeout                              { fail "(timeout) set variable signed long pointer" }

		}
	    }
	    -re "$prompt $"                { fail "set variable signed long pointer" }
	    timeout                              { fail "(timeout) set variable signed long pointer" }
	}
    }
    -re "$prompt $"                { fail "set variable signed long pointer" }
       timeout                                      { fail "(timeout) set variable signed long pointer" }
}                         


#
# test "set variable" for type "unsigned long *"
#
send "set v_unsigned_long_pointer=v_unsigned_long_array\n"
expect -re "set.*$prompt $"
send "set variable *(v_unsigned_long_pointer)=123\n"
expect -re "set.*$prompt $"
send "set variable *(v_unsigned_long_pointer+1)=-456\n"
expect {
    -re "set.*$prompt $" {
	send "print v_unsigned_long_array\n"
	expect {
	    -re "print.*.\[0-9\]* =.*\{123,.*$ulong_minus_456\}.*$prompt $" {
		send "print *(v_unsigned_long_pointer+1)\n"
		expect {
		    -re "print.*.\[0-9\]* = $ulong_minus_456.*$prompt $"    { pass "set variable unsigned long pointer" }
		    -re "$prompt $"                { fail "set variable unsigned long pointer" }
		    timeout                              { fail "(timeout) set variable unsigned long pointer" }

		}
	    }
	    -re "$prompt $"                { fail "set variable unsigned long pointer" }
	    timeout                              { fail "(timeout) set variable unsigned long pointer" }
	}
    }
    -re "$prompt $"                { fail "set variable unsigned long pointer" }
    timeout                                      { fail "(timeout) set variable unsigned long pointer" }
}                         


#
# test "set variable" for type "float *"
#
send "set v_float_pointer=v_float_array\n"
expect -re "set.*$prompt $"
send "set variable *(v_float_pointer)=123.0\n"
expect -re "set.*$prompt $"
send "set variable *(v_float_pointer+1)=-456.0\n"
expect {
    -re "set.*$prompt $" {
	send "print v_float_array\n"
	expect {
	    -re "print.*.\[0-9\]* =.*\{123,.*-456\}.*$prompt $" {
		send "print *(v_float_pointer+1)\n"
		expect {
		    -re "print.*.\[0-9\]* = -456.*$prompt $"    { pass "set variable float pointer" }
		    -re "$prompt $"                { fail "set variable float pointer" }
		    timeout                              { fail "(timeout) set variable float pointer" }

		}
	    }
	    -re "$prompt $"                { fail "set variable float pointer" }
	    timeout                              { fail "(timeout) set variable float pointer" }
	}
    }
    -re "$prompt $"                { fail "set variable float pointer" }
     timeout                                      { fail "(timeout) set variable float pointer" }
}                         


#
# test "set variable" for type "double *"
#
send "set v_double_pointer=v_double_array\n"
expect -re "set.*$prompt $"
send "set variable *(v_double_pointer)=123.0\n"
expect -re "set.*$prompt $"
send "set variable *(v_double_pointer+1)=-456.0\n"
expect {
    -re "set.*$prompt $" {
	send "print v_double_array\n"
	expect {
	    -re "print.*.\[0-9\]* =.*\{123,.*-456\}.*$prompt $" {
		send "print *(v_double_pointer+1)\n"
		expect {
		    -re "print.*.\[0-9\]* = -456.*$prompt $"    { pass "set variable double pointer" }
		    -re "$prompt $"                { fail "set variable double pointer" }
		    timeout                              { fail "(timeout) set variable double pointer" }

		}
	    }
	    -re "$prompt $"                { fail "set variable double pointer" }
	    timeout                              { fail "(timeout) set variable double pointer" }
	}
    }
    -re "$prompt $"                { fail "set variable double pointer" }
     timeout                                      { fail "(timeout) set variable double pointer" }
}                         


#
# test "set variable" for struct members
#
send "set variable v_struct1.v_char_member='h'\n"
expect {
    -re "set.*$prompt $"\
	{
	send "print v_struct1.v_char_member\n"
	expect {
	    -re "print.*.\[0-9\]* = 104 \'h\'.*$prompt $"       { pass "set variable structure char member" }
	    -re "$prompt $"                      { fail "set variable structure char member" }
	    timeout                              { fail "(timeout) set variable structure char member" }
	}
    }
    -re "$prompt $"                              { fail "set variable structure char member" }
    timeout                                      { fail "(timeout) set variable structure char member" }
}                         


send "set variable v_struct1.v_short_member=1\n"
expect {
    -re "set.*$prompt $"\
	{
	send "print v_struct1.v_short_member\n"
	expect {
	    -re "print.*.\[0-9\]* = 1.*$prompt $"       { pass "set variable structure short member" }
	    -re "$prompt $"                      { fail "set variable structure short member" }
	    timeout                              { fail "(timeout) set variable structure short member" }
	}
    }
    -re "$prompt $"                              { fail "set variable structure short member" }
    timeout                                      { fail "(timeout) set variable structure short member" }
}                         


send "set variable v_struct1.v_int_member=2\n"
expect {
    -re "set.*$prompt $"\
	{
	send "print v_struct1.v_int_member\n"
	expect {
	    -re "print.*.\[0-9\]* = 2.*$prompt $"       { pass "set variable structure int member" }
	    -re "$prompt $"                      { fail "set variable structure int member" }
	    timeout                              { fail "(timeout) set variable structure int member" }
	}
    }
    -re "$prompt $"                              { fail "set variable structure int member" }
    timeout                                      { fail "(timeout) set variable structure int member" }
}                         


send "set variable v_struct1.v_long_member=3\n"
expect {
    -re "set.*$prompt $"\
	{
	send "print v_struct1.v_long_member\n"
	expect {
	    -re "print.*.\[0-9\]* = 3.*$prompt $"       { pass "set variable structure long member" }
	    -re "$prompt $"                      { fail "set variable structure long member" }
	    timeout                              { fail "(timeout) set variable structure long member" }
	}
    }
    -re "$prompt $"                              { fail "set variable structure long member" }
    timeout                                      { fail "(timeout) set variable structure long member" }
}                         


send "set variable v_struct1.v_float_member=4.0\n"
expect {
    -re "set.*$prompt $"\
	{
	send "print v_struct1.v_float_member\n"
	expect {
	    -re "print.*.\[0-9\]* = 4.*$prompt $"       { pass "set variable structure float member" }
	    -re "$prompt $"                      { fail "set variable structure float member" }
	    timeout                              { fail "(timeout) set variable structure float member" }
	}
    }
    -re "$prompt $"                              { fail "set variable structure float member" }
    timeout                                      { fail "(timeout) set variable structure float member" }
}                         


send "set variable v_struct1.v_double_member=5.0\n"
expect {
    -re "set.*$prompt $"\
	{
	send "print v_struct1.v_double_member\n"
	expect {
	    -re "print.*.\[0-9\]* = 5.*$prompt $"       { pass "set variable structure double member" }
	    -re "$prompt $"                      { fail "set variable structure double member" }
	    timeout                              { fail "(timeout) set variable structure double member" }
	}
    }
    -re "$prompt $"                              { fail "set variable structure double member" }
    timeout                                      { fail "(timeout) set variable structure double member" }
}                         


gdb_test "print v_struct1" \
  "print.*.\[0-9\]* = \{.*v_char_member = 104 \'h\',.*v_short_member = 1,\
.*v_int_member = 2,.*\
v_long_member = 3,.*v_float_member = 4,.*v_double_member = 5.*\}" \
  "set print structure #1"

# This should be an error.  GCC extensions for structure constants require
# the type of the structure to be specified, as in
# v_struct1 = (struct t_struct) {32, 33, 34, 35, 36, 37}
# GDB should do the same if it wants to provide this feature.
setup_xfail "h8300*-*-*"
gdb_test "set variable v_struct1 = {32, 33, 34, 35, 36, 37}" "Invalid.*"

# And after the error the structure should be unchanged.
gdb_test "print v_struct1" \
  "print.*.\[0-9\]* = \{.*v_char_member = 104 \'h\',.*v_short_member = 1,\
.*v_int_member = 2,.*\
v_long_member = 3,.*v_float_member = 4,.*v_double_member = 5.*\}" \
  "set print structure #2"

# Test printing of enumeration bitfields.
# GNU C supports them, some other compilers don't.

if {$gcc_compiled} then {
    gdb_test "print sef.field=sm1" "print.*.\[0-9\]* = sm1"
    gdb_test "print sef.field" "print.*.\[0-9\]* = sm1" "print sef.field (sm1)"
    gdb_test "print sef.field=s1" "print.*.\[0-9\]* = s1"
    gdb_test "print sef.field" "print.*.\[0-9\]* = s1" "print sef.field (s1)"
    gdb_test "print uef.field=u2" "print.*.\[0-9\]* = u2"
    gdb_test "print uef.field" "print.*.\[0-9\]* = u2" "print uef.field (u2)"
    gdb_test "print uef.field=u1" "print.*.\[0-9\]* = u1"
    gdb_test "print uef.field" "print.*.\[0-9\]* = u1" "print uef.field (u1)"

    # Test for truncation when assigning invalid values to bitfields.
    gdb_test "print sef.field=7" \
	"print.*warning: Value does not fit in 2 bits.*\[0-9\]* = sm1"
    gdb_test "print uef.field=6" \
	"print.*warning: Value does not fit in 2 bits.*\[0-9\]* = u2"
}
@
