head	1.10;
access;
symbols
	OPENBSD_5_5:1.8.0.14
	OPENBSD_5_5_BASE:1.8
	OPENBSD_5_4:1.8.0.10
	OPENBSD_5_4_BASE:1.8
	OPENBSD_5_3:1.8.0.8
	OPENBSD_5_3_BASE:1.8
	OPENBSD_5_2:1.8.0.6
	OPENBSD_5_2_BASE:1.8
	OPENBSD_5_1_BASE:1.8
	OPENBSD_5_1:1.8.0.4
	OPENBSD_5_0:1.8.0.2
	OPENBSD_5_0_BASE:1.8
	OPENBSD_4_9:1.7.0.8
	OPENBSD_4_9_BASE:1.7
	OPENBSD_4_8:1.7.0.6
	OPENBSD_4_8_BASE:1.7
	OPENBSD_4_7:1.7.0.2
	OPENBSD_4_7_BASE:1.7
	OPENBSD_4_6:1.7.0.4
	OPENBSD_4_6_BASE:1.7
	OPENBSD_4_5:1.6.0.20
	OPENBSD_4_5_BASE:1.6
	OPENBSD_4_4:1.6.0.18
	OPENBSD_4_4_BASE:1.6
	OPENBSD_4_3:1.6.0.16
	OPENBSD_4_3_BASE:1.6
	OPENBSD_4_2:1.6.0.14
	OPENBSD_4_2_BASE:1.6
	OPENBSD_4_1:1.6.0.12
	OPENBSD_4_1_BASE:1.6
	OPENBSD_4_0:1.6.0.10
	OPENBSD_4_0_BASE:1.6
	OPENBSD_3_9:1.6.0.8
	OPENBSD_3_9_BASE:1.6
	OPENBSD_3_8:1.6.0.6
	OPENBSD_3_8_BASE:1.6
	OPENBSD_3_7:1.6.0.4
	OPENBSD_3_7_BASE:1.6
	OPENBSD_3_6:1.6.0.2
	OPENBSD_3_6_BASE:1.6
	OPENBSD_3_5:1.5.0.4
	OPENBSD_3_5_BASE:1.5
	OPENBSD_3_4:1.5.0.2
	OPENBSD_3_4_BASE:1.5
	OPENBSD_3_3:1.4.0.10
	OPENBSD_3_3_BASE:1.4
	OPENBSD_3_2:1.4.0.8
	OPENBSD_3_2_BASE:1.4
	OPENBSD_3_1:1.4.0.6
	OPENBSD_3_1_BASE:1.4
	OPENBSD_3_0:1.4.0.4
	OPENBSD_3_0_BASE:1.4
	OPENBSD_2_9:1.4.0.2
	OPENBSD_2_9_BASE:1.4
	OPENBSD_2_8:1.3.0.4
	OPENBSD_2_8_BASE:1.3
	OPENBSD_2_7:1.3.0.2
	OPENBSD_2_7_BASE:1.3
	OPENBSD_2_6:1.1.1.1.0.8
	OPENBSD_2_6_BASE:1.1.1.1
	OPENBSD_2_5:1.1.1.1.0.6
	OPENBSD_2_5_BASE:1.1.1.1
	OPENBSD_2_4:1.1.1.1.0.4
	OPENBSD_2_4_BASE:1.1.1.1
	OPENBSD_2_3:1.1.1.1.0.2
	OPENBSD_2_3_BASE:1.1.1.1
	LYNX_2_8:1.1.1.1
	LYNX:1.1.1;
locks; strict;
comment	@# @;


1.10
date	2014.07.23.19.13.24;	author deraadt;	state dead;
branches;
next	1.9;
commitid	EcR8E7r0stjLUV4p;

1.9
date	2014.07.09.04.11.34;	author daniel;	state Exp;
branches;
next	1.8;
commitid	lGGuvDWEniklWrQe;

1.8
date	2011.07.22.14.10.37;	author avsm;	state Exp;
branches;
next	1.7;

1.7
date	2009.05.31.09.16.51;	author avsm;	state Exp;
branches;
next	1.6;

1.6
date	2004.06.22.04.01.41;	author avsm;	state Exp;
branches;
next	1.5;

1.5
date	2003.05.01.18.59.36;	author avsm;	state Exp;
branches;
next	1.4;

1.4
date	2001.04.09.12.56.34;	author millert;	state Exp;
branches;
next	1.3;

1.3
date	2000.05.01.23.31.46;	author hin;	state Exp;
branches;
next	1.2;

1.2
date	2000.03.25.18.16.43;	author maja;	state Exp;
branches;
next	1.1;

1.1
date	98.03.11.17.47.36;	author maja;	state Exp;
branches
	1.1.1.1;
next	;

1.1.1.1
date	98.03.11.17.47.36;	author maja;	state Exp;
branches;
next	;


desc
@@


1.10
log
@delinked from tree, now it goes to the bit bucket
@
text
@# $LynxId: makefile.in,v 1.144 2014/02/21 01:18:50 tom Exp $
##makefile for lynx

SHELL		= @@CONFIG_SHELL@@
CDPATH		= .

.SUFFIXES:
@@SET_MAKE@@
prefix		= @@prefix@@
exec_prefix	= @@exec_prefix@@
top_srcdir	= @@top_srcdir@@
srcdir		= @@srcdir@@
builddir	= .
VPATH		= $(srcdir)

CC		= @@CC@@
CFLAGS		= @@CFLAGS@@
DEFS		= @@DEFS@@
CPPFLAGS	= @@CPPFLAGS@@
LINT		= @@LINT@@
ETAGS		= @@ETAGS@@

BUILD_CC	= @@BUILD_CC@@
BUILD_CPP	= @@BUILD_CPP@@
BUILD_CFLAGS	= @@BUILD_CFLAGS@@
BUILD_CPPFLAGS	= @@BUILD_CPPFLAGS@@ @@DEFS@@
BUILD_EXEEXT	= @@BUILD_EXEEXT@@
BUILD_LDFLAGS	= @@BUILD_LDFLAGS@@
BUILD_LIBS	= @@BUILD_LIBS@@

x		= @@EXEEXT@@
o		= .@@OBJEXT@@

LDFLAGS		= @@EXTRA_LDFLAGS@@ @@LDFLAGS@@
LIBS		= @@LIBS@@

INSTALL		= @@INSTALL@@
INSTALL_PROGRAM	= @@INSTALL_PROGRAM@@
INSTALL_DATA	= @@INSTALL_DATA@@
transform	= @@program_transform_name@@

LN_S		= @@LN_S@@

TAR		= @@TAR@@
TAR_UP		= $(TAR) @@TAR_UP_OPTIONS@@ @@TAR_PIPE_OPTIONS@@
TAR_DOWN	= $(TAR) @@TAR_DOWN_OPTIONS@@ @@TAR_PIPE_OPTIONS@@

# $Format: "LYNX_VERSION	= $ProjectVersion$"$
LYNX_VERSION	= 2.8.8rel.2

## This is the version which we are developing (or, upon release, make this
## the same).  Use no dots in the name, since it must work on VMS and MS-DOS.
VERSION		= 2-8-8

##this is the name of the directory the lynx source code is in.
##(e.g., lynx2-8-8, not the full path)
lynxdir= lynx$(VERSION)
lynxname= lynx$(VERSION)

## The 'DESTDIR' variable allows you to install the program into a different
## location, e.g., for packaging, without affecting the compiled-in pathnames.
DESTDIR= @@DESTDIR@@

## Where you want lynx installed
bindir= @@bindir@@
BINDIR= $(DESTDIR)$(bindir)

## Where you want the lynx man file installed
mandir= @@mandir@@/man1
MANDIR= $(DESTDIR)$(mandir)

## Where you want the lynx.cfg file installed
sysconfdir= @@sysconfdir@@
SYSCONFDIR= $(DESTDIR)$(sysconfdir)

## Where you want the doc-files installed
datarootdir= @@datarootdir@@
docdir    = @@datadir@@/lynx_doc
DOCDIR    = $(DESTDIR)$(docdir)

## Where you want the help-files installed
helpdir   = @@datadir@@/lynx_help
HELPDIR   = $(DESTDIR)$(helpdir)

##set the relative location of the WWW library Implementation directory,
##from this directory
##do not set this to be an absolute path!!!
WWW_DIR   = $(builddir)/WWW/Library/Implementation

##set the relative location of the message-file directory
##do not set this to be an absolute path!!!
PO_DIR    = $(builddir)/po
PO_SRCDIR = $(srcdir)/po

##set the relative location of the main source-directory
##do not set this to be an absolute path!!!
SRC_DIR   = $(builddir)/src

##set the relative location of the character-translation data directory
##do not set this to be an absolute path!!!
CHR_DIR   = $(SRC_DIR)/chrtrans

## Path to gzip that will compress the help files.
## It will be used when --enable-gzip-help is set by configure.
## Leave *both* empty if you don't want to gzip help files.
COMPRESS_PROG=@@COMPRESS_PROG@@
COMPRESS_EXT=@@COMPRESS_EXT@@

# Path of scripts directory
scripts_dir=$(srcdir)/scripts

MAKE_RECUR = $(MAKE) @@cf_cv_makeflags@@ DESTDIR="$(DESTDIR)" CC="$(CC)"

@@LYNXCFG_MAKE@@CFG2HTML = alphatoc.html body.html cattoc.html

# !!!!!!!!!!! SUN resolv LIBRARY !!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!
# To include resolv in the LIBS="" list for SUN 3, 4 or Solaris OS,
# point RESOLVLIB to that library.  You need this if you get the message
# "Alert!:  Unable to connect to remote host" whenever you try to
# access a host other than localhost and have made Lynx without it.
# See the PROBLEMS file for more information.
#RESOLVLIB= -lresolv

# !!!!!!!!!!!!!  DIRECT WAIS ACCESS !!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!
# If you are adding direct wais access you must fill in the
# location of wais.a, client.a and the standard math library, libm.a.
# You can pick up the most current freeWAIS sources from
#	ftp://ftp.cnidr.org/pub/NIDR.tools/freewais
# If you are using freeWAIS-0.202 or older, include -DDECLARE_WAIS_LOGFILES
# in your SITE_DEFS.
# Please put an ABSOLUTE address here if you want it to work!
#WAISLIB= ../../freeWAIS-0.202/bin/client.a ../../freeWAIS-0.202/bin/wais.a /usr/lib/libm.a

# !!!!!!!!!!!!! SLANG Support (For color version of Lynx). !!!!!!!!!!!!!!!!
# The slang library is an alternative to curses, developed by John E. Davis
# (davis@@space.mit.edu).  Version 0.99-27 or higher is available from
#	ftp://space.mit.edu/pub/davis
# It provides color support for Lynx.

# !!!!!!!!!!!!! NCURSES Support (For color version of Lynx). !!!!!!!!!!!!!!
# If you need ncurses, the latest version can always be found
# in ftp://invisible-island.net/ncurses/
# or ftp://ftp.gnu.org/pub/gnu/

# Also be sure to check out the compilation symbols in userdefs.h
# before building Lynx!

# If you apply patches which require linking to site-specific libraries, set
# SITE_LIBS to those libraries.
SITE_LIBS= # Your libraries here

# Set SITE_LYDEFS to one or more of the defines for the WWW Library:
SITE_LYDEFS = # Your defines here

# Set SITE_DEFS to one or more of the defines for lynx below:
SITE_DEFS = # Your defines here

# defines for which there are no configure options:
# -DHP_TERMINAL    For DIM workaround to REVERSE problems on HP terminals.
# -DIGNORE_CTRL_C  Define if Control-C shouldn't exit lynx.
# -DNO_RULES       Disables CERN-style access rules (see lynx.cfg).
# -DMISC_EXP       Enable some truly experimental stuff
# -DSHORTENED_RBIND  For a SOCKSified lynx with the short version of Rbind.
# -DSLANG_MBCS_HACK prevent cutoff lines when using UTF8 console (slang only)
# -DUSE_VASPRINT   Use vasprintf() function
#
# if you are linking to freeWAIS-0.202 or older, you should define this
# in SITE_DEFS
#
# -DDECLARE_WAIS_LOGFILES
#
# if you have the reverse clear screen problem of some SUN4 systems you
# should define this in SITE_DEFS
#
# -DREVERSE_CLEAR_SCREEN_PROBLEM
#
# if you have an SVR4 system with the "type any key" problem, try defining
# this in LYFLAGS (SITE_LYDEFS) and SITE_DEFS
#
# -DSVR4_BSDSELECT
#
# Old Data General systems may need this in their SITE_LYDEFS
# for their inet_addr(host) calls.
#
# -DDGUX_OLD

# Many other defines have configure options  (see INSTALLATION, Section II-1c.):
#
# for installation of local execution links, please see the file userdefs.h

WWW_CFLAGS = \
	LY_CFLAGS="$(CFLAGS)" \
	CPPFLAGS="$(CPPFLAGS)" \
	LYFLAGS="$(SITE_LYDEFS)"

CHR_CFLAGS = \
	SITE_DEFS="$(SITE_DEFS)" \
	BUILD_CFLAGS="$(BUILD_CFLAGS)" \
	BUILD_CPPFLAGS="$(BUILD_CPPFLAGS)" \
	BUILD_LDFLAGS="$(BUILD_LDFLAGS)" \
	BUILD_LIBS="$(BUILD_LIBS)" \
	BUILD_CC="$(BUILD_CC)"

SRC_CFLAGS = \
	CFLAGS="$(CFLAGS)" \
	CPPFLAGS="$(CPPFLAGS)" \
	LDFLAGS="$(LDFLAGS)" \
	LIBS="$(LIBS) $(RESOLVLIB) $(WAISLIB) $(SITE_LIBS)" \
	SITE_DEFS="$(SITE_DEFS)" \
	WWWINC=$(WWW_DIR) \
	WWWLIB="../$(WWW_DIR)/libwww.a"

actual_PROG  = `echo lynx|    sed '$(transform)'`
binary_PROG  = $(actual_PROG)$x

all lynx$x: cfg_defs.h LYHelp.h
@@MSG_DIR_MAKE@@	$(SHELL) $(scripts_dir)/fixtext.sh $(srcdir)/LYMessages_en.h >LYMessages.c
@@MSG_DIR_MAKE@@	cd $(PO_DIR) && $(MAKE_RECUR)
	cd $(WWW_DIR) && $(MAKE_RECUR) $(WWW_CFLAGS)
	cd $(CHR_DIR) && $(MAKE_RECUR) all $(CHR_CFLAGS)
	cd $(SRC_DIR) && $(MAKE_RECUR) all $(SRC_CFLAGS)

lint:
	cd $(WWW_DIR) && $(MAKE_RECUR) LINT="$(LINT)" $(WWW_CFLAGS) $@@
	cd $(SRC_DIR) && $(MAKE_RECUR) LINT="$(LINT)" $(SRC_CFLAGS) $@@
	cd $(CHR_DIR) && $(MAKE_RECUR) LINT="$(LINT)" $@@

tags:
	cd $(WWW_DIR) && $(MAKE_RECUR) $(WWW_CFLAGS) $@@
	cd $(SRC_DIR) && $(MAKE_RECUR) $(SRC_CFLAGS) $@@
	cd $(CHR_DIR) && $(MAKE_RECUR) $@@

etags:
	$(ETAGS) *.[ch] */*.[ch] */*/*.[ch] */*/*/*.[ch]

help:
	@@echo
	@@echo "Please run make with one of the following arguments"
	@@echo "all        -- to make the executable, put it in this directory"
	@@echo "clean      -- removes all '$o' and 'core' files"
	@@echo "distclean  -- removes all generated files"
	@@echo "depend     -- use makedepend to generate header-dependencies"
	@@echo

##Miscellaneous actions
clean:
	rm -f WWW/Library/*/*.[aoib]
	rm -f WWW/Library/*/.created
	cd $(WWW_DIR) && $(MAKE_RECUR) $@@
	cd $(SRC_DIR) && $(MAKE_RECUR) $@@
@@MSG_DIR_MAKE@@	rm -f LYMessages.c
@@MSG_DIR_MAKE@@	cd $(PO_DIR) && $(MAKE_RECUR) $@@
	rm -f *.b $(SRC_DIR)/lynx$x *.leaks cfg_defs.h LYHelp.h lint.*
@@LYNXCFG_MAKE@@	-rm -f $(CFG2HTML)
	rm -f help_files.sed
	rm -f core *.core

depend: cfg_defs.h LYHelp.h
	cd $(WWW_DIR) && $(MAKE_RECUR) $@@
	cd $(SRC_DIR) && $(MAKE_RECUR) $@@

distclean: clean
	-rm -f WWW/Library/*/*~
	-rm -f WWW/Library/*/*.bak
	-rm -rf $(SRC_DIR)/obsolete
	-cd $(WWW_DIR) && $(MAKE_RECUR) $@@
	-cd $(SRC_DIR) && $(MAKE_RECUR) $@@
	-cd $(CHR_DIR) && $(MAKE_RECUR) $@@
@@MSG_DIR_MAKE@@	cd $(PO_DIR) && $(MAKE_RECUR) $@@
@@MSG_DIR_MAKE@@	-rmdir $(PO_DIR)
	-rm -f *~ *.bak *.sav tags TAGS
	-rm -f $(WWW_DIR)/makefile $(SRC_DIR)/makefile $(CHR_DIR)/makefile
@@SRCDIR_CLEAN@@	-rmdir $(WWW_DIR) && rmdir WWW/Library && rmdir WWW
@@SRCDIR_CLEAN@@	-rmdir $(CHR_DIR) && rmdir $(SRC_DIR)
	-rm -f makefile lynx_cfg.h config.status config.log config.cache
	-rm -f lynx$x

maintainer-clean: distclean
	-find . -type f -name '*.rej' -exec rm -f {} \;
	-find . -type f -name '*.orig' -exec rm -f {} \;
	-rm -rf WWW/Library/*/obsolete
	-rm -f Lynx.prj .*_aux

# Directory containing reference source for patch generation,
#     either absolute or relative to $(top_srcdir)/..
REFDIR=orig/$(lynxdir)

lynx.patch: $(top_srcdir) $(top_srcdir)/CHANGES
	- cd $(top_srcdir)/.. && cd $(REFDIR) && { rm -f \
		config.log \
		config.status \
		lynx_cfg.h \
			; \
		for I in . $(SRC_DIR) $(WWW_DIR); do ( set +e; \
			( set -x; cd $$I && rm -f *.orig *.rej makefile ); : ); \
		done; }
	( cd $(top_srcdir)/..; echo "%%% Created `date` by target $@@. %%%"; \
	   if diff -bru /dev/null /dev/null;		     \
		   then diff -bru $(REFDIR) $(lynxdir);	     \
		   else diff -brc $(REFDIR) $(lynxdir); fi ) \
		| grep -v '^Common' \
		| grep -v '^Binary files ' \
		| grep -v '^Only ' | tee $@@ | egrep '^\-\-\- .*$(lynxdir)'

install: install-bin install-man install-cfg @@INSTALL_LSS@@
	@@echo
	@@echo "Use $(MAKE) install-help to install the help-files"
	@@echo "Use $(MAKE) install-doc to install extra documentation files"
	@@echo

install-full: install install-help install-doc
	@@echo Full installation complete.

install-bin: $(BINDIR) lynx$x
@@MSG_DIR_MAKE@@	cd $(PO_DIR) && $(MAKE_RECUR) install
	@@ECHO_CC@@$(SHELL) -c \
	'if test -f $(BINDIR)/$(binary_PROG) ; then \
	      mv -f $(BINDIR)/$(binary_PROG) $(BINDIR)/lynx.old; fi'
	$(INSTALL_PROGRAM) lynx$x $(BINDIR)/$(binary_PROG)

install-man : $(MANDIR)
	$(INSTALL_DATA) $(srcdir)/lynx.man $(MANDIR)/$(actual_PROG).1

install-doc : $(DOCDIR) $(HELPDIR)
	@@echo Copying sample files
	$(SHELL) -c '\
		( umask 022; \
		  cd $(srcdir) && \
		  $(TAR_UP) C[HO]* PROBLEMS README docs samples test ) | \
		( umask 022; \
		  cd $(DOCDIR) && \
		  chmod -R u+w . && $(TAR_DOWN) )'
	$(SHELL) -c 'if test "$(COMPRESS_PROG)" != "" ; then \
		(cd $(DOCDIR) && $(COMPRESS_PROG) -f docs/CHANGES*.[0-9] docs/*.announce ) \
	fi'
	$(SHELL) -c 'for name in COPYING COPYHEADER; do \
		cd $(HELPDIR) && rm -f $$name ;\
		r= ;\
		test "$(LN_S)" = "ln -s" || r=`echo $(helpdir)|sed -e "s%[^/]\+%..%g" -e "s%^.%%"`; \
		cd $(HELPDIR) && ( $(LN_S) $$r$(docdir)/$$name . || cp $(DOCDIR)/$$name . );\
		done'
	-$(SHELL) -c 'case `id|sed -e "s/(.*//"` in uid=0) chown -R root $(DOCDIR);; esac'

# HPUX 'sed' does not seem to like '=' as pattern delimiter.
# We cannot use '%' because it may appear in a URL.
# Andrew filesystem uses '@@'.
# So we limit sed delimiters to '!' and '%', depending on the expected text.
FIX_SED = tr '=' '"'

LYNX_URL='http://lynx.isc.org/release/breakout'
LYNXDOCS_URL='$(LYNX_URL)/docs/'
LYNXHELP_URL='$(LYNX_URL)/lynx_help/'

@@LYNXCFG_MAKE@@$(CFG2HTML) :
@@LYNXCFG_MAKE@@	@@echo 'Making htmlized lynx.cfg'
@@LYNXCFG_MAKE@@	cd $(SRC_DIR) && $(MAKE_RECUR) LYReadCFG.i
@@LYNXCFG_MAKE@@	@@-rm -f $(CFG2HTML)
@@LYNXCFG_MAKE@@	sed -n -e '/Config_Type  *Config_Table/,/{0, *0, *0}/ p' $(SRC_DIR)/LYReadCFG.i | \
@@LYNXCFG_MAKE@@	sed  -e 's/ *{ *"\([^"]*\)".*/\1/' | \
@@LYNXCFG_MAKE@@	perl $(scripts_dir)/cfg2html.pl -ams $(srcdir)/lynx.cfg
@@LYNXCFG_MAKE@@	-rm -f $(SRC_DIR)/LYReadCFG.i

help_files.sed : makefile $(srcdir)/lynx_help/help_files.txt
	@@echo Constructing sed-script $@@
	@@-rm -f $@@ help_files.tmp
	@@cat $(srcdir)/lynx_help/help_files.txt > help_files.tmp
@@LYNXDOC_MAKE@@	@@ECHO_CC@@echo 's!$(LYNXDOCS_URL)!file://$(docdir)/!g' >> help_files.tmp
@@LYNXCFG_MAKE@@	@@ECHO_CC@@echo 's!$(LYNXHELP_URL)alphatoc.html!alphatoc.html!g' >> help_files.tmp
@@LYNXCFG_MAKE@@	@@ECHO_CC@@echo 's!$(LYNXHELP_URL)cattoc.html!cattoc.html!g' >> help_files.tmp
@@LYNXCFG_MAKE@@	@@ECHO_CC@@echo 's!alphatoc\.html!alphatoc.html$(COMPRESS_EXT)!g' >> help_files.tmp
@@LYNXCFG_MAKE@@	@@ECHO_CC@@echo 's!cattoc\.html!cattoc.html$(COMPRESS_EXT)!g' >> help_files.tmp
@@LYNXCFG_MAKE@@	@@ECHO_CC@@echo 's!body\.html!body.html$(COMPRESS_EXT)!g' >> help_files.tmp
	@@ECHO_CC@@sed	-e '/^#/d' -e '/^$$/d' \
		-e 's%\(.*\)=\(.*\@@.*\)$$%s=@@\1@@=\2=g%' \
		-e 's%\(.*\)=\(http:.*\)$$%s=@@\1@@=\2=g%' \
		-e 's%\(.*\)=\(ftp:.*\)$$%s=@@\1@@=\2=g%' \
		-e 's%\(.*\)=\(.*\.html\)$$%s=@@\1@@=\2$(COMPRESS_EXT)=g%' \
		help_files.tmp | $(FIX_SED) > $@@
	@@echo Appending interim-fix for existing html files to $@@
	@@ECHO_CC@@sed	-e '/^#/d' -e '/[:@@]/d' -e '/^$$/d' \
		-e 's%\(.*\)=\(.*\.html\)$$%s=\2=\2$(COMPRESS_EXT)=g%' \
		-e 's%\.html=%\\.html=%' \
		help_files.tmp | $(FIX_SED) >> $@@
	@@ECHO_CC@@if test -n "$(COMPRESS_EXT)"; then echo "s%\\(\$(COMPRESS_EXT)\\)*\$(COMPRESS_EXT)%$(COMPRESS_EXT)%g" >> $@@; fi
	@@-rm -f help_files.tmp

install-help : $(CFG2HTML) help_files.sed $(HELPDIR) $(SYSCONFDIR)
	-$(SHELL) -c 'if cd "$(HELPDIR)" ; then \
		WD=`pwd` ; \
		TAIL=`basename "$(helpdir)"` ; \
		HEAD=`echo "$$WD"|sed -e "s,/$${TAIL}$$,,"` ; \
		test "x$$WD" != "x$$HEAD" && rm -fr * ; \
		fi'
	test -d $(HELPDIR)/keystrokes || mkdir $(HELPDIR)/keystrokes
	@@echo Translating/copying html files
@@LYNXCFG_MAKE@@	@@$(SHELL) -c 'for f in $(CFG2HTML) ; do \
@@LYNXCFG_MAKE@@		sed -f help_files.sed $$f > $(HELPDIR)/$$f ; \
@@LYNXCFG_MAKE@@		done'
	@@ECHO_CC@@$(SHELL) -c 'sed_prog=`pwd`/help_files.sed && \
		cd $(srcdir)/lynx_help && \
		dirs=keystrokes && \
		files="*.html */*.html" && \
		for f in $$files ; do \
			sed -f $$sed_prog $$f > $(HELPDIR)/$$f ; \
		done && \
		if test "$(COMPRESS_PROG)" != "" ; then \
			(cd $(HELPDIR) && $(COMPRESS_PROG) $$files ) \
		fi'
	@@echo Updating $(sysconfdir)/lynx.cfg
	@@ECHO_CC@@$(SHELL) -c \
	'if test -f $(SYSCONFDIR)/lynx.cfg ; then \
		mv $(SYSCONFDIR)/lynx.cfg $(SYSCONFDIR)/lynx.tmp ; \
	else \
		cp $(srcdir)/lynx.cfg $(SYSCONFDIR)/lynx.tmp ; \
	fi'
	@@echo Updating $(sysconfdir)/lynx.cfg to point to installed help-files
	@@ECHO_CC@@sed	-e '/^HELPFILE:http/s!^!#!' \
		-e '/^#HELPFILE:file/s!#!!' \
		$(SYSCONFDIR)/lynx.tmp | \
	$(SHELL) $(scripts_dir)/cfg_path.sh lynx_help $(helpdir) | \
	$(SHELL) $(scripts_dir)/cfg_path.sh lynx_doc  $(helpdir) | \
	sed	-e '/^HELPFILE:file/s!$$!$(COMPRESS_EXT)!' \
		-e '/^HELPFILE:file/s!$(COMPRESS_EXT)$(COMPRESS_EXT)$$!$(COMPRESS_EXT)!' \
		>$(SYSCONFDIR)/lynx.cfg
	chmod 644 $(SYSCONFDIR)/lynx.cfg
	-rm -f $(SYSCONFDIR)/lynx.tmp

LYHelp.h : help_files.sed $(srcdir)/LYHelp.hin
	@@echo Creating $@@
	@@sed -f help_files.sed $(srcdir)/LYHelp.hin > $@@
	@@echo '**********************************************'
	@@echo
	@@$(SHELL) -c 'if test "$(COMPRESS_PROG)" = "" ; then \
		echo "       Help files will NOT be gzipped."; \
	else \
		echo "       Help links point to compressed files"; \
		echo "       To access them properly you have to type"; \
		echo "                 make install-help"; \
	fi'
	@@echo
	@@echo '**********************************************'

cfg_defs.h : $(scripts_dir)/cfg_defs.sh $(scripts_dir)/cfg_edit.sh config.cache lynx_cfg.h
	@@rm -f $@@
	$(SHELL) -c 'SHELL=$(SHELL) $(SHELL) $(scripts_dir)/cfg_defs.sh $(srcdir)'

install-cfg : $(SYSCONFDIR)
	@@$(SHELL) $(scripts_dir)/install-cfg.sh "$(INSTALL_DATA)" $(srcdir)/lynx.cfg $(SYSCONFDIR)/lynx.cfg

install-lss : $(SYSCONFDIR)
	@@$(SHELL) $(scripts_dir)/install-lss.sh "$(INSTALL_DATA)" $(srcdir)/samples/lynx.lss $(SYSCONFDIR)/lynx.lss

uninstall ::
@@MSG_DIR_MAKE@@	cd $(PO_DIR) && $(MAKE_RECUR) uninstall
	-rm -f $(BINDIR)/$(binary_PROG)
	-rm -f $(MANDIR)/$(actual_PROG).1
	-rm -f $(SYSCONFDIR)/lynx.cfg
	-rm -f $(SYSCONFDIR)/lynx.lss

uninstall \
uninstall-help ::
	-$(SHELL) -c 'if test -d "$(HELPDIR)" ; then \
		WD=`cd "$(HELPDIR)" && pwd` ; \
		TAIL=`basename "$(helpdir)"` ; \
		HEAD=`echo "$$WD"|sed -e "s,/$${TAIL}$$,,"` ; \
		test "x$$WD" != "x$$HEAD" && rm -rf "$(HELPDIR)"; \
		fi'

uninstall \
uninstall-doc ::
	-$(SHELL) -c 'if test -d "$(DOCDIR)" ; then \
		WD=`cd "$(DOCDIR)" && pwd` ; \
		TAIL=`basename "$(docdir)"` ; \
		HEAD=`echo "$$WD"|sed -e "s,/$${TAIL}$$,,"` ; \
		test "x$$WD" != "x$$HEAD" && rm -rf "$(DOCDIR)"; \
		fi'
	-$(SHELL) -c 'if test -d "$(HELPDIR)" ; then \
		WD=`cd "$(HELPDIR)" && pwd` ; \
		TAIL=`basename "$(helpdir)"` ; \
		HEAD=`echo "$$WD"|sed -e "s,/'$${TAIL}'$$,,"` ; \
		test "x$$WD" != "x$$HEAD" ; \
		cd "$(HELPDIR)" && rm -f COPYING COPYHEADER ; \
		fi'

update-po:
	rsync -Lrtvz  translationproject.org::tp/latest/lynx/  $(PO_SRCDIR)
	test -f $(PO_SRCDIR)/makefile && cd $(PO_SRCDIR) && $(MAKE_RECUR) $@@

preinstall :
	@@ echo ''
	@@ echo '** Configuration summary for LYNX $(LYNX_VERSION):'
	@@ echo ''
	@@ echo '       program name: '$(actual_PROG)
	@@ echo ''
	@@ echo '      bin directory: '$(BINDIR)
	@@ echo '   config directory: '$(SYSCONFDIR)
	@@ echo '      man directory: '$(MANDIR)
	@@ echo '     help directory: '$(HELPDIR)
	@@ echo '      doc directory: '$(DOCDIR)

$(BINDIR) \
$(MANDIR) \
$(SYSCONFDIR) \
$(HELPDIR) \
$(DOCDIR) :
	mkdir -p $@@
@


1.9
log
@update to lynx 2.8.8rel2, keeping local changes. primarily to get these
changes from 2.8.8dev.16:

* fix most issues found by clang 3.2 analyze
* fix most issues found by Coverity scan

tested on i386, sparc64, and macppc by myself.
tested on vax by miod@@ (including https)
helpful discussion with avsm@@, sthen@@

ok deraadt@@
@
text
@@


1.8
log
@update to lynx2.8.7rel.2, with local patches:
- restore local lynx.cfg settings [avsm]
- fix makefile races [espie]
- read/write result checking fixes to avoid unsigned comparisons vs -1 [krw]
- initialize all the InputFieldData members correctly [fgsch]
- fix socklen_t test to include <sys/types.h> [miod]
- fgets(3) returns NULL on error, not 0. No functional change [cloder]

ok krw@@, tests by Simon Kuhnle and Martin Pieuchot
@
text
@d1 1
a1 1
# $LynxId: makefile.in,v 1.101 2008/09/10 17:22:01 tom Exp $
d21 9
d34 1
d40 1
a43 2
MKINSTALLDIRS	= @@MKINSTALLDIRS@@

d48 3
d53 1
a53 1
VERSION		= 2-8-7
d56 1
a56 1
##(e.g., lynx2-8-7, not the full path)
d77 1
d112 3
a114 1
MAKE_RECUR = $(MAKE) DESTDIR="$(DESTDIR)" CC="$(CC)"
a158 1
# -DEXP_ASCII_CTYPES use POSIX locale for toupper/tolower/isupper
d196 8
d207 1
d213 3
d220 1
d226 9
d241 1
a242 3
	@@echo "tar        -- runs clean, removes executable, and tars the whole directory"
	@@echo "compress   -- runs tar, then compresses the result"
	@@echo "zip        -- runs clean, removes executable, and zips the whole directory"
d254 1
a254 1
@@LYNXCFG_MAKE@@	-rm -f alphatoc.html body.html cattoc.html tmp007
a283 23
tar:  clean
	rm -f lynx$x
	$(MAKE) save

turnover:	clean
	$(MAKE) save

zipcompress: compress zip
	echo "done!"

zip:  clean
	rm -f $(SRC_DIR)/lynx$x
	rm -f lynx$x
	rm -f $(SRC_DIR)/a.out
	rm -f ../$(lynxname).zip
	cd ..; rm -f $(lynxname).zip; zip -r $(lynxname).zip $(lynxdir)

save:
	cd ..; rm -f $(lynxname).tar; $(TAR_UP) $(lynxdir) > $(lynxname).tar

compress: tar
	cd ..; rm -f $(lynxname).tar.Z; compress -f -v $(lynxname).tar

d317 3
a319 3
	'if test -f $(BINDIR)/lynx$x ; then \
	      mv -f $(BINDIR)/lynx$x $(BINDIR)/lynx.old; fi'
	$(INSTALL_PROGRAM) lynx$x $(BINDIR)/lynx$x
d322 1
a322 1
	$(INSTALL_DATA) $(srcdir)/lynx.man $(MANDIR)/lynx.1
d326 7
a332 2
	(cd $(srcdir) && $(TAR_UP) C[HO]* PROBLEMS README docs samples test ) | \
			       ( cd $(DOCDIR) && chmod -R u+w . && $(TAR_DOWN) )
d338 3
a340 1
		cd $(HELPDIR) && ( $(LN_S) $(DOCDIR)/$$name . || cp $(DOCDIR)/$$name . );\
d350 1
a350 1
LYNX_URL='http://lynx.isc.org/release/lynx2-8-7'
d354 9
d367 6
a372 6
@@LYNXDOC_MAKE@@	@@echo 's!$(LYNXDOCS_URL)!file://$(docdir)!g' >> help_files.tmp
@@LYNXCFG_MAKE@@	@@echo 's!$(LYNXHELP_URL)alphatoc.html!alphatoc.html!g' >> help_files.tmp
@@LYNXCFG_MAKE@@	@@echo 's!$(LYNXHELP_URL)cattoc.html!cattoc.html!g' >> help_files.tmp
@@LYNXCFG_MAKE@@	@@echo 's!alphatoc\.html!alphatoc.html$(COMPRESS_EXT)!g' >> help_files.tmp
@@LYNXCFG_MAKE@@	@@echo 's!cattoc\.html!cattoc.html$(COMPRESS_EXT)!g' >> help_files.tmp
@@LYNXCFG_MAKE@@	@@echo 's!body\.html!body.html$(COMPRESS_EXT)!g' >> help_files.tmp
d384 1
a384 1
	@@ECHO_CC@@if test -n "$(COMPRESS_EXT)"; then echo 's%\$(COMPRESS_EXT)\$(COMPRESS_EXT)%$(COMPRESS_EXT)%g' >> $@@; fi
d387 7
a393 2
install-help : help_files.sed $(HELPDIR)
	- (cd $(HELPDIR) && WD=`pwd` && HEAD=`echo $$WD|sed -e 's!/lynx_help$$!!'` && test $$WD != $$HEAD && rm -fr *)
a394 6
@@LYNXCFG_MAKE@@	@@echo 'Making htmlized lynx.cfg'
@@LYNXCFG_MAKE@@	cd $(SRC_DIR) && $(MAKE_RECUR) LYReadCFG.i
@@LYNXCFG_MAKE@@	@@-rm -f alphatoc.html body.html cattoc.html
@@LYNXCFG_MAKE@@	sed -n -e '/Config_Type  *Config_Table/,/{0, *0, *0}/ p' $(SRC_DIR)/LYReadCFG.i | \
@@LYNXCFG_MAKE@@	sed  -e 's/ *{ *"\([^"]*\)".*/\1/' | \
@@LYNXCFG_MAKE@@	perl $(scripts_dir)/cfg2html.pl -ms $(srcdir)/lynx.cfg
d396 1
a396 1
@@LYNXCFG_MAKE@@	@@$(SHELL) -c 'for f in alphatoc.html body.html cattoc.html ; do \
a398 1
@@LYNXCFG_MAKE@@	-rm -f $(SRC_DIR)/LYReadCFG.i
d455 2
a456 2
	-rm -f $(BINDIR)/lynx$x
	-rm -f $(MANDIR)/lynx.1
d462 6
a467 1
	-test -d $(HELPDIR) && WD=`cd $(HELPDIR) && pwd` && HEAD=`echo $$WD|sed -e 's!/lynx_help$$!!'` && test $$WD != $$HEAD && rm -rf $(HELPDIR)
d471 13
a483 2
	-test -d $(DOCDIR) && WD=`cd $(DOCDIR) && pwd` && HEAD=`echo $$WD|sed -e 's!/lynx_doc$$!!'` && test $$WD != $$HEAD && rm -rf $(DOCDIR)
	-test -d $(HELPDIR) && WD=`cd $(HELPDIR) && pwd` && HEAD=`echo $$WD|sed -e 's!/lynx_help$$!!'` && test $$WD != $$HEAD && cd $(HELPDIR) && rm -f COPYING COPYHEADER
d489 12
d506 1
a506 3
	$(SHELL) $(MKINSTALLDIRS) $@@
etags:
	etags -r "/\(PRIVATE\|PUBLIC\)[ \t]+\([a-zA-Z_][a-zA-Z_0-1]*[ \t*]+\)*\([a-zA-Z_][a-zA-Z_0-1]*\)[ \t]+\(ARGS[0-9]\|NOARGS\)/\3/" *.[ch] */*.[ch] */*/*.[ch] */*/*/*.[ch]
@


1.7
log
@Update to lynx-2.8.6.rel5, with our local patches maintained where relevant.
tests from miod@@ sthen@@ jmc@@ jsing@@
two additional fixes from miod:
- fix uninitialized stack variable use, leading to occasional crash.
- modify the socklen_t test to include <sys/types.h>, fixes gcc2 build failures
@
text
@d1 1
d13 1
d41 1
a41 1
VERSION		= 2-8-6
d44 1
a44 1
##(e.g., lynx2-8-6, not the full path)
d65 2
a66 2
docdir= @@datadir@@/lynx_doc
DOCDIR= $(DESTDIR)$(docdir)
d69 2
a70 2
helpdir= @@datadir@@/lynx_help
HELPDIR= $(DESTDIR)$(helpdir)
d75 14
a88 1
WWWINC= WWW/Library/Implementation
d99 2
d177 13
d192 3
a194 12
@@MSG_DIR_MAKE@@	cd po && $(MAKE) CC="$(CC)"
	cd $(WWWINC) && $(MAKE) CC="$(CC)" \
		LY_CFLAGS="$(CFLAGS)" \
		CPPFLAGS="$(CPPFLAGS)" \
		LYFLAGS="$(SITE_LYDEFS)"
	cd src && $(MAKE) all CC="$(CC)" \
		CFLAGS="$(CFLAGS)" \
		CPPFLAGS="$(CPPFLAGS)" \
		LIBS="$(LIBS) $(RESOLVLIB) $(WAISLIB) $(SITE_LIBS)" \
		SITE_DEFS="$(SITE_DEFS)" \
		WWWINC=$(WWWINC) \
		WWWLIB="../$(WWWINC)/libwww.a"
d197 2
a198 11
	cd $(WWWINC) && $(MAKE) LINT="$(LINT)" CC="$(CC)" \
		LY_CFLAGS="$(CFLAGS)" \
		CPPFLAGS="$(CPPFLAGS)" \
		LYFLAGS="$(SITE_LYDEFS)" lint
	cd src && $(MAKE) all LINT="$(LINT)" CC="$(CC)" \
		CFLAGS="$(CFLAGS)" \
		CPPFLAGS="$(CPPFLAGS)" \
		LIBS="$(LIBS) $(RESOLVLIB) $(WAISLIB) $(SITE_LIBS)" \
		SITE_DEFS="$(SITE_DEFS)" \
		WWWINC=$(WWWINC) \
		WWWLIB="../$(WWWINC)/libwww.a" lint
d215 2
a216 1
	cd src && $(MAKE) clean
d218 2
a219 2
@@MSG_DIR_MAKE@@	cd po && $(MAKE) $@@
	rm -f *.b src/lynx$x *.leaks cfg_defs.h LYHelp.h lint.*
d225 2
a226 2
	cd $(WWWINC) && $(MAKE) $@@
	cd src && $(MAKE) $@@
d231 6
a236 5
	-rm -rf src/obsolete
	-cd src && $(MAKE) $@@
	-cd src/chrtrans && $(MAKE) $@@
@@MSG_DIR_MAKE@@	cd po && $(MAKE) $@@
@@MSG_DIR_MAKE@@	-rmdir po
d238 3
a240 3
	-rm -f $(WWWINC)/makefile src/makefile src/chrtrans/makefile
@@SRCDIR_CLEAN@@	-rmdir $(WWWINC) && rmdir WWW/Library && rmdir WWW
@@SRCDIR_CLEAN@@	-rmdir src/chrtrans && rmdir src
d242 1
a242 1
	-rm -f lynx$x install-*
d261 1
a261 1
	rm -f src/lynx$x
d263 1
a263 1
	rm -f src/a.out
d283 1
a283 1
		for I in . src $(WWWINC); do ( set +e; \
d304 4
a307 2
@@MSG_DIR_MAKE@@	cd po && $(MAKE) CC="$(CC)" install
	-mv -f $(BINDIR)/lynx$x $(BINDIR)/lynx.old
d332 4
d340 3
a342 2
@@LYNXCFG_MAKE@@	@@echo 's!http://www.hippo.ru/%7Ehvv/lynxcfg_toc.html#alphatoc!alphatoc.html!g' >> help_files.tmp
@@LYNXCFG_MAKE@@	@@echo 's!http://www.hippo.ru/%7Ehvv/lynxcfg_toc.html!cattoc.html!g' >> help_files.tmp
d364 1
a364 1
@@LYNXCFG_MAKE@@	cd src && make LYReadCFG.i
d366 1
a366 1
@@LYNXCFG_MAKE@@	sed -n -e '/Config_Type  *Config_Table/,/{0, *0, *0}/ p' src/LYReadCFG.i | \
d373 1
a373 1
@@LYNXCFG_MAKE@@	-rm -f src/LYReadCFG.i
d385 2
a386 1
	@@ECHO_CC@@$(SHELL) -c 'if test -f $(SYSCONFDIR)/lynx.cfg ; then \
d403 1
a403 1
LYHelp.h : help_files.sed LYHelp.hin
d426 1
a426 2
	-mv -f $(SYSCONFDIR)/lynx.lss $(SYSCONFDIR)/lynx.oldlss
	$(INSTALL_DATA) $(srcdir)/samples/lynx.lss $(SYSCONFDIR)/lynx.lss
d429 1
a429 1
@@MSG_DIR_MAKE@@	cd po && $(MAKE) CC="$(CC)" uninstall
d443 4
@


1.6
log
@update to lynx 2.8.5rel.1
tested todd@@,naddy@@. millert@@ deraadt@@ ok
@
text
@d39 1
a39 1
VERSION		= 2-8-5
d42 1
a42 1
##(e.g., lynx2-8-5, not the full path)
d59 2
a60 2
libdir= @@libdir@@
LIBDIR= $(DESTDIR)$(libdir)
d63 1
a63 1
docdir= @@libdir@@/lynx_doc
d67 1
a67 1
helpdir= @@libdir@@/lynx_help
d81 3
d161 1
a161 2
@@MSG_DIR_MAKE@@	$(SHELL) $(srcdir)/fixtext.sh $(srcdir)/LYMessages_en.h >LYMessages.c
@@INTLDIR_MAKE@@	cd intl && $(MAKE) CC="$(CC)"
a204 1
@@INTLDIR_MAKE@@	cd intl && $(MAKE) $@@
a220 3
@@INTLDIR_MAKE@@	cd intl && $(MAKE) $@@
	-rm -f intl/libintl.h
@@MSG_DIR_MAKE@@	-rmdir intl
d336 1
a336 1
	@@ECHO_CC@@if test -n "$(COMPRESS_EXT)"; then echo 's%\(\$(COMPRESS_EXT)\)*\$(COMPRESS_EXT)%$(COMPRESS_EXT)%g' >> $@@; fi
d347 1
a347 1
@@LYNXCFG_MAKE@@	perl $(srcdir)/scripts/cfg2html.pl -ms $(srcdir)/lynx.cfg
d363 3
a365 3
	@@echo Updating $(libdir)/lynx.cfg
	@@ECHO_CC@@$(SHELL) -c 'if test -f $(LIBDIR)/lynx.cfg ; then \
		mv $(LIBDIR)/lynx.cfg $(LIBDIR)/lynx.tmp ; \
d367 1
a367 1
		cp $(srcdir)/lynx.cfg $(LIBDIR)/lynx.tmp ; \
d369 1
a369 1
	@@echo Updating $(libdir)/lynx.cfg to point to installed help-files
d372 4
a375 3
		-e '/^HELPFILE:file/s!/PATH_TO/lynx_help!$(helpdir)!' \
		-e '/^[A-Z_]*:/s!/PATH_TO/lynx_doc!$(docdir)!' \
		-e '/^HELPFILE:file/s!$$!$(COMPRESS_EXT)!' \
d377 3
a379 3
		$(LIBDIR)/lynx.tmp >$(LIBDIR)/lynx.cfg
	chmod 644 $(LIBDIR)/lynx.cfg
	-rm -f $(LIBDIR)/lynx.tmp
d396 1
a396 1
cfg_defs.h : $(srcdir)/cfg_defs.sh $(srcdir)/cfg_edit.sh config.cache lynx_cfg.h
d398 1
a398 1
	$(SHELL) -c 'SHELL=$(SHELL) $(SHELL) $(srcdir)/cfg_defs.sh $(srcdir)'
d400 2
a401 2
install-cfg : $(LIBDIR)
	@@$(SHELL) -c '$(srcdir)/scripts/install-cfg.sh "$(INSTALL_DATA)" $(srcdir)/lynx.cfg $(LIBDIR)/lynx.cfg'
d403 3
a405 3
install-lss : $(LIBDIR)
	-mv -f $(LIBDIR)/lynx.lss $(LIBDIR)/lynx.oldlss
	$(INSTALL_DATA) $(srcdir)/samples/lynx.lss $(LIBDIR)/lynx.lss
d411 2
a412 2
	-rm -f $(LIBDIR)/lynx.cfg
	-rm -f $(LIBDIR)/lynx.lss
d425 1
a425 1
$(LIBDIR) \
@


1.5
log
@Update to lynx-2.8.4-rel1, patchset d, now with IPv6 as well

Local patches we maintain to the distribution are:
- replace unbounded fscanf with fgets (avsm)
- spelling fixes (deraadt)
- hppa -O0 workaround (mickey)
- default to ftp passive (deraadt)
- work with non-exec scripts (deraadt,hin,maja)
- be more careful with rlogin username (art)
- default to our webpage (deraadt)
- install helpfiles locally (maja)
- mkdtemp temp space directory (art)
- install more recent config.guess (avsm)

Tested by beck,millert,grange,fries,miod and others, deraadt@@ ok
@
text
@a5 2
x		= @@PROG_EXT@@

d20 3
d28 1
d31 6
d39 1
a39 1
VERSION		= 2-8-4
d42 1
a42 1
##(e.g., lynx2-8-4, not the full path)
d124 1
a126 1
# -DNO_CPU_LIMIT   Disables Max CPU timeout (includes CLOCKS_PER_SECOND)
d128 1
d131 1
a131 1
# -DUSE_SCROLLBAR  supports scrollbar when built with ncurses
d153 1
a153 34
# defines which have configure options   (see INSTALLATION, Section II-1c.):
# -DARCHIVE_ONLY
# -DDIRED_SUPPORT
# -DDISP_PARTIAL
# -DDONT_TRACK_INTERNAL_LINKS
# -DEXEC_LINKS
# -DEXEC_SCRIPTS
# -DEXP_CHARTRANS_AUTOSWITCH
# -DEXP_PERSISTENT_COOKIES
# -DLONG_LIST
# -DLYNXCGI_LINKS
# -DLY_FIND_LEAKS
# -DNCURSES
# -DNO_CHANGE_EXECUTE_PERMS
# -DNO_EXTENDED_HTMLDTD
# -DNO_PARENT_DIR_REFERENCE
# -DNSL_FORK
# -DOK_GZIP
# -DOK_OVERRIDE
# -DOK_PERMIT
# -DOK_TAR
# -DOK_UUDECODE
# -DOK_ZIP
# -DOPTIONS_FORMS
# -DOPTIONS_MENU
# -DSOCKS
# -DSYSLOG_REQUESTED_URLS
# -DUNDERLINE_LINKS
# -DUSE_COLOR_STYLE
# -DUSE_DEFAULT_COLORS
# -DUSE_EXTERNALS
# -DUSE_SLANG
# -DUSE_SOCKS5
# -DUSE_ZLIB
a156 1
# TESTED: Linux FreeBSD SunOS Solaris IRIX CLIX HP-UX AIX SCO
d190 1
a190 1
	@@echo "clean      -- removes all '.o' and 'core' files"
d256 1
a256 1
	cd ..; rm -f $(lynxname).tar; tar -cf - $(lynxdir) > $(lynxname).tar
d301 5
a305 2
	(cd $(srcdir) && tar cf - C[HO]* PROBLEMS README samples test ) | \
			       ( cd $(DOCDIR) && chmod -R u+w . && tar xf - )
d310 1
d338 1
a338 1
	@@ECHO_CC@@if test -n "$(COMPRESS_EXT)"; then echo 's%\$(COMPRESS_EXT)\$(COMPRESS_EXT)%$(COMPRESS_EXT)%g' >> $@@; fi
d342 2
a343 1
	(cd $(HELPDIR) && WD=`pwd` && HEAD=`echo $$WD|sed -e 's!/lynx_help$$!!'` && test $$WD != $$HEAD && rm -rf *)
a350 1
	@@cat help_files.sed > $(HELPDIR)/help_files.sed
d352 1
a352 1
@@LYNXCFG_MAKE@@		sed -f $(HELPDIR)/help_files.sed $$f > $(HELPDIR)/$$f ; \
d355 4
a358 4
	@@ECHO_CC@@$(SHELL) -c 'cd $(srcdir)/lynx_help && ( \
		dirs=keystrokes; \
		(cd $(HELPDIR) && mkdir $$dirs 2>/dev/null ) ; \
		files="*.html */*.html" ; \
d360 2
a361 2
			sed -f $(HELPDIR)/help_files.sed $$f > $(HELPDIR)/$$f ; \
		done ; \
d364 1
a364 3
		fi ; \
		)'
	@@-rm -f $(HELPDIR)/help_files.sed
d366 1
a366 1
	$(SHELL) -c 'if test -f $(LIBDIR)/lynx.cfg ; then \
d399 1
a399 1
	$(SHELL) -c '/bin/sh $(srcdir)/cfg_defs.sh $(srcdir)'
d402 1
a402 2
	-mv -f $(LIBDIR)/lynx.cfg $(LIBDIR)/lynx.oldcfg
	$(INSTALL_DATA) $(srcdir)/lynx.cfg $(LIBDIR)/lynx.cfg
d424 6
a429 2
$(BINDIR) $(MANDIR) $(LIBDIR) $(HELPDIR) $(DOCDIR) :
	$(srcdir)/mkdirs.sh $@@
@


1.4
log
@Don't use config.cache as a dependency as it breaks GLOBAL_AUTOCONF_CACHE
(and there is no rule to generate it anyway).
@
text
@d4 1
d27 1
d31 1
a31 1
VERSION		= 2-8-2
d34 1
a34 1
##(e.g., lynx2-8-2, not the full path)
d40 1
a40 1
DESTDIR=
d99 1
a99 1
# in ftp://ftp.clark.net/pub/dickey/ncurses/
a117 1
# -DNOPORT         if you must use PASV instead of PORT for FTP
d122 1
a152 1
# -DLINKEDSTYLES
a174 1
# -DUSE_HASH
d231 2
d246 1
d250 1
a250 1
	-rm -f *~ *.bak *.sav
d291 1
a291 1
	cd  $(top_srcdir)/.. && cd $(REFDIR) && { rm -f \
d300 3
a302 1
			diff -brc $(REFDIR) $(lynxdir) ) \
d305 1
a305 1
		| grep -v '^Only ' | tee $@@ | grep '^--- $(lynxdir)'
d307 1
a307 1
install: lynx$x install-bin install-man install-cfg @@INSTALL_LSS@@
d316 1
a316 1
install-bin: $(BINDIR)
d324 1
a324 1
install-doc : $(DOCDIR)
d327 5
a331 1
			       ( cd $(DOCDIR) && tar xf - )
d334 14
a347 6
FIX_SED = tr '=' '%'
#FIX_SED = cat

install-help : $(DOCDIR) $(HELPDIR)
	(cd $(HELPDIR) && rm -rf *)
	@@echo Constructing sed-script
d353 2
a354 3
		$(srcdir)/lynx_help/help_files.txt | $(FIX_SED) > \
		$(HELPDIR)/help_files.sed
	@@echo Appending interim-fix for existing html files
d358 12
a369 4
		$(srcdir)/lynx_help/help_files.txt | $(FIX_SED) >> \
		$(HELPDIR)/help_files.sed
	@@ECHO_CC@@if test -n "$(COMPRESS_EXT)"; then echo 's%\$(COMPRESS_EXT)\$(COMPRESS_EXT)%$(COMPRESS_EXT)%g' >> \
		$(HELPDIR)/help_files.sed; fi
d371 5
d387 1
a387 1
	-rm -f $(HELPDIR)/help_files.sed
d395 6
a400 6
	@@ECHO_CC@@sed	-e '/^HELPFILE:http/s@@^@@#@@' \
		-e '/^#HELPFILE:file/s@@#@@@@' \
		-e '/^HELPFILE:file/s@@/PATH_TO/lynx_help@@$(helpdir)@@' \
		-e '/^[A-Z_]*:/s@@/PATH_TO/lynx_doc@@$(docdir)@@' \
		-e '/^HELPFILE:file/s@@$$@@$(COMPRESS_EXT)@@' \
		-e '/^HELPFILE:file/s@@$(COMPRESS_EXT)$(COMPRESS_EXT)$$@@$(COMPRESS_EXT)@@' \
a403 5
	$(INSTALL_DATA) $(srcdir)/COPYHEADER $(DOCDIR)/COPYHEADER
	$(INSTALL_DATA) $(srcdir)/COPYING    $(DOCDIR)/COPYING
	cd $(HELPDIR) && ( \
		ln $(DOCDIR)/COPYHEADER . || cp $(DOCDIR)/COPYHEADER . ; \
		ln $(DOCDIR)/COPYING    . || cp $(DOCDIR)/COPYING . )
d405 1
a405 9
LYHelp.h : LYHelp.hin
	@@echo Constructing sed-script
	@@ECHO_CC@@sed	-e '/^#/d' -e '/^$$/d' \
		-e 's%\(.*\)=\(.*\@@.*\)$$%s=@@\1@@=\2=g%' \
		-e 's%\(.*\)=\(http:.*\)$$%s=@@\1@@=\2=g%' \
		-e 's%\(.*\)=\(ftp:.*\)$$%s=@@\1@@=\2=g%' \
		-e 's%\(.*\)=\(.*\.html\)$$%s=@@\1@@=\2$(COMPRESS_EXT)=g%' \
		$(srcdir)/lynx_help/help_files.txt | $(FIX_SED) > \
		help_files.sed
a407 1
	-@@rm -f help_files.sed
d420 1
a420 1
cfg_defs.h : $(srcdir)/cfg_defs.sh lynx_cfg.h
d422 1
a422 1
	PATH=$(srcdir):$$PATH; export PATH; $(SHELL) -c '$(SHELL) $(srcdir)/cfg_defs.sh'
d432 1
a432 1
uninstall:
d438 9
a446 2
	-rm -rf $(HELPDIR)
	-rm -rf $(DOCDIR)
d450 2
@


1.3
log
@Make it compile even if exec-permissions are missing on cfg_defs.sh
and cfg_edit.sh.
Work by maja@@, ok deraadt@@
@
text
@d405 1
a405 1
cfg_defs.h : $(srcdir)/cfg_defs.sh config.cache lynx_cfg.h
@


1.2
log
@Upgrade to Lynx 2.8.2. -moj
@
text
@d407 1
a407 1
	PATH=$(srcdir):$$PATH; export PATH; $(SHELL) -c '$(srcdir)/cfg_defs.sh'
@


1.1
log
@Initial revision
@
text
@d3 1
a3 1
SHELL		= /bin/sh
d11 1
d19 1
d27 4
d32 7
a38 3
##(e.g. lynx2-8, not the full path)
lynxdir= lynx2-8
lynxname= lynx2-8
d42 1
d46 1
d50 5
d58 1
a58 3

installbin= @@INSTALL_PROGRAM@@ -s -m 755
installdoc= @@INSTALL_DATA@@
d65 6
a78 14
# !!!!!!!!!!! Alternate socket functions for SOCKS !!!!!!!!!!!!!!!!!!
# To make a SOCKSified lynx, include -DSOCKS in your SITE_LYDEFS and
# SITE_DEFS, below, and point SOCKSLIB to your SOCKS library.  Note
# that you may have problems accessing FTP servers.  Also, instead of
# SOCKSifying lynx for use behind a firewall, you are better off if
# you make it normally, and set it up to use a proxy server.  You can
# SOCKSify the proxy server, and it will handle all clients, not just
# Lynx (see the INSTALLATION file in this distribution).  If your SOCKS
# server was compiled to use the short version of Rbind, also include
# -DSHORTENED_RBIND in your SITE_LYDEFS and SITE_DEFS.  If you do
# SOCKSify lynx, you can turn off SOCKS proxy usage via a -nosocks
# command line switch.
#SOCKSLIB= /usr/local/lib/libsocks.a

d118 1
a120 1
# -DSOCKS          For making a SOCKSified lynx.
a140 5
#
# if you would like logging of client requests via syslog(), you should
# define this in SITE_DEFS
#
# -DSYSLOG_REQUESTED_URLS
d145 4
d150 1
d153 1
d157 1
d166 4
d172 2
d176 1
d182 5
a186 2
all lynx$x:
	cd WWW/Library/unix && $(MAKE) CC="$(CC)" \
d193 14
a206 1
		LIBS="$(LIBS) $(RESOLVLIB) $(WAISLIB) $(SOCKSLIB) $(SITE_LIBS)" \
d209 1
a209 1
		WWWLIB="../WWW/Library/unix/libwww.a"
d224 1
a224 1
	rm -f WWW/Library/*/*.[aob]
d227 5
a231 1
	rm -f *.b src/lynx$x core Lynx.leaks
d233 2
a234 2
depend:
	cd WWW/Library/unix && $(MAKE) $@@
d243 4
d248 3
a250 5
	-rm -f WWW/Library/unix/makefile src/makefile src/chrtrans/makefile
	@@SRCDIR_CLEAN@@-find . -type f -name '*.rej' -exec -rm -f {} \;
	@@SRCDIR_CLEAN@@-find . -type f -name '*.orig' -exec -rm -f {} \;
	@@SRCDIR_CLEAN@@-rmdir WWW/Library/unix && rmdir WWW/Library && rmdir WWW
	@@SRCDIR_CLEAN@@-rmdir src/chrtrans && rmdir src
d255 2
d283 19
d305 1
d308 13
a320 10
install-bin: $(bindir)
	-mv -f $(bindir)/lynx$x $(bindir)/lynx.old
	$(installbin) lynx$x $(bindir)/

install-man : $(mandir) 
	$(installdoc) $(srcdir)/lynx.man $(mandir)/lynx.1

install-help : $(helpdir)
	(cd $(helpdir) && rm -rf *)
	(cd $(srcdir)/lynx_help && tar cf - . ) | ( cd $(helpdir) && tar xf - )
d322 40
a361 4
			       ( cd $(helpdir) && tar xf - )
	-rm -f $(libdir)/lynx.tmp
	sh -c 'if test -f $(libdir)/lynx.cfg ; then \
		mv $(libdir)/lynx.cfg $(libdir)/lynx.tmp ; \
d363 1
a363 1
		cp $(srcdir)/lynx.cfg $(libdir)/lynx.tmp ; \
d365 2
a366 1
	sed	-e '/^HELPFILE:http/s@@^@@#@@' \
d369 47
a415 11
		$(libdir)/lynx.tmp >$(libdir)/lynx.cfg
	chmod 644 $(libdir)/lynx.cfg
	-rm -f $(libdir)/lynx.tmp

install-cfg : $(libdir)
	-mv -f $(libdir)/lynx.cfg $(libdir)/lynx.oldcfg
	$(INSTALL_DATA) $(srcdir)/lynx.cfg $(libdir)/lynx.cfg

install-lss : $(libdir)
	-mv -f $(libdir)/lynx.lss $(libdir)/lynx.oldlss
	$(INSTALL_DATA) $(srcdir)/samples/lynx.lss $(libdir)/lynx.lss
d418 7
a424 5
	-rm -f $(bindir)/lynx$x
	-rm -f $(mandir)/lynx.1
	-rm -f $(libdir)/lynx.cfg
	-rm -f $(libdir)/lynx.lss
	-rm -rf $(libdir)/lynx_help
d426 1
a426 1
$(bindir) $(mandir) $(libdir) $(helpdir) :
@


1.1.1.1
log
@Lynx 2.8
@
text
@@
