head	1.18;
access;
symbols
	OPENBSD_5_6:1.17.0.6
	OPENBSD_5_6_BASE:1.17
	OPENBSD_5_5:1.17.0.4
	OPENBSD_5_5_BASE:1.17
	OPENBSD_5_4:1.16.0.12
	OPENBSD_5_4_BASE:1.16
	OPENBSD_5_3:1.16.0.10
	OPENBSD_5_3_BASE:1.16
	OPENBSD_5_2:1.16.0.8
	OPENBSD_5_2_BASE:1.16
	OPENBSD_5_1_BASE:1.16
	OPENBSD_5_1:1.16.0.6
	OPENBSD_5_0:1.16.0.4
	OPENBSD_5_0_BASE:1.16
	OPENBSD_4_9:1.16.0.2
	OPENBSD_4_9_BASE:1.16
	OPENBSD_4_8:1.15.0.16
	OPENBSD_4_8_BASE:1.15
	OPENBSD_4_7:1.15.0.12
	OPENBSD_4_7_BASE:1.15
	OPENBSD_4_6:1.15.0.14
	OPENBSD_4_6_BASE:1.15
	OPENBSD_4_5:1.15.0.10
	OPENBSD_4_5_BASE:1.15
	OPENBSD_4_4:1.15.0.8
	OPENBSD_4_4_BASE:1.15
	OPENBSD_4_3:1.15.0.6
	OPENBSD_4_3_BASE:1.15
	OPENBSD_4_2:1.15.0.4
	OPENBSD_4_2_BASE:1.15
	OPENBSD_4_1:1.15.0.2
	OPENBSD_4_1_BASE:1.15
	OPENBSD_4_0:1.14.0.8
	OPENBSD_4_0_BASE:1.14
	OPENBSD_3_9:1.14.0.6
	OPENBSD_3_9_BASE:1.14
	OPENBSD_3_8:1.14.0.4
	OPENBSD_3_8_BASE:1.14
	OPENBSD_3_7:1.14.0.2
	OPENBSD_3_7_BASE:1.14
	OPENBSD_3_6:1.13.0.2
	OPENBSD_3_6_BASE:1.13
	OPENBSD_3_5:1.12.0.2
	OPENBSD_3_5_BASE:1.12
	OPENBSD_3_4:1.10.0.2
	OPENBSD_3_4_BASE:1.10
	OPENBSD_3_3:1.9.0.4
	OPENBSD_3_3_BASE:1.9
	OPENBSD_3_2:1.7.0.2
	OPENBSD_3_2_BASE:1.7
	OPENBSD_3_1:1.6.0.4
	OPENBSD_3_1_BASE:1.6
	OPENBSD_3_0:1.6.0.2
	OPENBSD_3_0_BASE:1.6
	SENDMAIL_8_12_0:1.1.1.3
	OPENBSD_2_9:1.5.0.2
	OPENBSD_2_9_BASE:1.5
	SENDMAIL_8_11_2:1.1.1.2
	OPENBSD_2_8:1.2.0.4
	OPENBSD_2_8_BASE:1.2
	OPENBSD_2_7:1.2.0.2
	OPENBSD_2_7_BASE:1.2
	SENDMAIL_8_10_0:1.1.1.1
	SENDMAIL_INC:1.1.1;
locks; strict;
comment	@.\" @;


1.18
date	2014.09.17.18.49.52;	author matthieu;	state dead;
branches;
next	1.17;
commitid	M7i5giHIoz3DMlTU;

1.17
date	2014.02.07.21.25.00;	author millert;	state Exp;
branches;
next	1.16;

1.16
date	2010.09.23.14.51.57;	author jmc;	state Exp;
branches;
next	1.15;

1.15
date	2007.02.06.20.07.15;	author jmc;	state Exp;
branches;
next	1.14;

1.14
date	2004.12.16.00.21.31;	author millert;	state Exp;
branches;
next	1.13;

1.13
date	2004.06.24.03.59.28;	author millert;	state Exp;
branches;
next	1.12;

1.12
date	2004.01.19.01.41.14;	author millert;	state Exp;
branches;
next	1.11;

1.11
date	2003.09.17.17.31.41;	author millert;	state Exp;
branches;
next	1.10;

1.10
date	2003.04.14.06.39.24;	author jmc;	state Exp;
branches;
next	1.9;

1.9
date	2003.03.11.08.11.08;	author jmc;	state Exp;
branches;
next	1.8;

1.8
date	2003.03.07.17.42.26;	author jmc;	state Exp;
branches;
next	1.7;

1.7
date	2002.06.03.17.25.47;	author millert;	state Exp;
branches;
next	1.6;

1.6
date	2001.09.11.19.02.50;	author millert;	state Exp;
branches;
next	1.5;

1.5
date	2001.01.17.05.26.51;	author millert;	state Exp;
branches;
next	1.4;

1.4
date	2001.01.17.04.53.19;	author millert;	state Exp;
branches;
next	1.3;

1.3
date	2001.01.15.21.09.11;	author millert;	state Exp;
branches;
next	1.2;

1.2
date	2000.04.11.07.31.32;	author form;	state Exp;
branches
	1.2.4.1;
next	1.1;

1.1
date	2000.04.02.19.05.42;	author millert;	state Exp;
branches
	1.1.1.1;
next	;

1.1.1.1
date	2000.04.02.19.05.42;	author millert;	state Exp;
branches;
next	1.1.1.2;

1.1.1.2
date	2001.01.15.20.52.09;	author millert;	state Exp;
branches;
next	1.1.1.3;

1.1.1.3
date	2001.09.11.18.55.49;	author millert;	state Exp;
branches;
next	;

1.2.4.1
date	2001.05.31.00.32.01;	author miod;	state Exp;
branches;
next	;


desc
@@


1.18
log
@Bye.
@
text
@.\"	$OpenBSD: smrsh.8,v 1.17 2014/02/07 21:25:00 millert Exp $
.\"
.\" Copyright (c) 1998-2004 Proofpoint, Inc. and its suppliers.
.\"	 All rights reserved.
.\" Copyright (c) 1993 Eric P. Allman.  All rights reserved.
.\" Copyright (c) 1993
.\"     The Regents of the University of California.  All rights reserved.
.\"
.\" By using this file, you agree to the terms and conditions set
.\" forth in the LICENSE file which can be found at the top level of
.\" the sendmail distribution.
.\"
.\"
.\"     $Sendmail: smrsh.8,v 8.23 2013/11/22 20:52:00 ca Exp $
.\"
.Dd $Mdocdate: February 7 2014 $
.Dt SMRSH 8
.Os
.Sh NAME
.Nm smrsh
.Nd restricted shell for sendmail
.Sh SYNOPSIS
.Nm smrsh
.Fl c Ar command
.Sh DESCRIPTION
The
.Nm smrsh
program is intended as a replacement for
.Pa /bin/sh
for use in the
.Dq prog
mailer in
.Xr sendmail 8
configuration files.
It sharply limits the commands that can be run using the
.Dq |program
syntax of
.Xr sendmail 8
in order to improve the overall security of your system.
Briefly, even if a
.Dq bad guy
can get sendmail to run a program
without going through an alias or forward file,
.Nm smrsh
limits the set of programs that he or she can execute.
.Pp
Briefly,
.Nm smrsh
limits programs to be in a single directory, by default
.Pa /usr/libexec/sm.bin ,
allowing the system administrator to choose the set of acceptable commands,
and the shell built-in commands
.Dq exec ,
.Dq exit ,
and
.Dq echo .
It also rejects any commands with the characters
.Sq \e ,
.Sq < ,
.Sq > ,
.So
;
.Sc ,
.Sq $ ,
.So
(
.Sc ,
.So
)
.Sc ,
.Sq \er
(carriage return), or
.Sq \en
(newline) on the command line to prevent
.Dq end run
attacks.
It allows
.Dq ||
and
.Dq &&
to enable commands like:
.Bd -literal -offset indent
.Qq |exec /usr/local/bin/filter || exit 75
.Ed
.Pp
Initial pathnames on programs are stripped,
so forwarding to
.Pa /usr/ucb/vacation ,
.Pa /usr/bin/vacation ,
.Pa /home/server/mydir/bin/vacation ,
and
.Pa vacation
all actually forward to
.Pa /usr/libexec/sm.bin/vacation .
.Pp
System administrators should be conservative about populating
the sm.bin directory.
For example, a reasonable additions is
.Xr vacation 1
and the like.
No matter how brow-beaten you may be,
never include any shell or shell-like program
(such as
.Xr perl 1 )
in the
sm.bin
directory.
Note that this does not restrict the use of shell or perl scripts
in the sm.bin directory (using the
.Dq #!
syntax);
it simply disallows execution of arbitrary programs.
Also, including mail filtering programs such as
.Xr procmail
is a very bad idea.
.Xr procmail
allows users to run arbitrary programs in their
.Xr procmailrc .
.Sh FILES
.Bl -tag -width "/usr/libexec/sm.bin" -compact
.It Pa /usr/libexec/sm.bin
directory for restricted programs
.El
.Sh SEE ALSO
.Xr sendmail 8
@


1.17
log
@Update to sendmail 8.14.8.  This touches a lot of files due to the
Sendmail, Inc -> Proofpoint name change.  See RELEASE_NOTES for
actual changes.
@
text
@d1 1
a1 1
.\"	$OpenBSD: smrsh.8,v 1.16 2010/09/23 14:51:57 jmc Exp $
d16 1
a16 1
.Dd $Mdocdate: September 23 2010 $
@


1.16
log
@add RCSID and Mdocdate to these pages; ok millert
@
text
@d1 1
a1 1
.\"	$OpenBSD$
d3 1
a3 1
.\" Copyright (c) 1998-2004 Sendmail, Inc. and its suppliers.
d14 1
a14 1
.\"     $Sendmail: smrsh.8,v 8.22 2004/08/06 03:55:35 gshapiro Exp $
d16 1
a16 1
.Dd $Mdocdate$
@


1.15
log
@fix some dodgy displays;
@
text
@d1 2
d16 1
a16 1
.Dd August 8, 2004
@


1.14
log
@Update to sendmail-8.13.2
@
text
@d80 2
a81 2
.Bd -literal -compact -offset "XXXX"
.Qq "|exec /usr/local/bin/filter || exit 75"
@


1.13
log
@Update to sendmail.8.13.0
@
text
@d1 1
a1 1
.\" Copyright (c) 1998-2003 Sendmail, Inc. and its suppliers.
d12 1
a12 1
.\"     $Sendmail: smrsh.8,v 8.20 2003/10/07 18:05:12 ca Exp $
d14 1
a14 1
.Dd October 7, 2003
@


1.12
log
@Update to sendmail 8.12.11.  I've been runninga beta version of this for
some time without problems.  See the RELEASE_NOTES for the change log.
@
text
@d1 1
a1 1
.\" Copyright (c) 1998-2000 Sendmail, Inc. and its suppliers.
d12 1
a12 1
.\"     $Sendmail: smrsh.8,v 8.16.2.2 2003/10/07 18:05:37 ca Exp $
@


1.11
log
@Update to sendmail-8.12.10.  This includes a fix for a buffer overflow
in address parsing.  That fix (but not all of sendmail-8.12.10) has
been applied to OpenBSD 3.4 and the 3.2 and 3.2 -stable branches.
@
text
@d12 1
a12 1
.\"     $Sendmail: smrsh.8,v 8.16.2.1 2003/07/08 01:33:03 gshapiro Exp $
d14 1
a14 1
.Dd July 8, 2003
@


1.10
log
@built in -> built-in;

from NetBSD (Igor Sobrado);
smrsh(8) passed on to sendmail people;

ok millert@@
@
text
@d12 1
a12 1
.\"     $Sendmail: smrsh.8,v 8.15 2001/01/24 00:40:47 gshapiro Exp $
d14 1
a14 1
.Dd April 25, 2002
d81 1
a81 1
.Qq "|exec /usr/local/bin/procmail -f- /etc/procmailrcs/user || exit 75"
d96 2
a97 3
Reasonable additions are
.Xr vacation 1 ,
.Xr procmail ,
d111 6
@


1.9
log
@files with dead .Xr's;

left .Xr, but removed man page number
as suggested by mpech@@

more help and ok millert@@
@
text
@d50 1
a50 1
and the shell builtin commands
@


1.8
log
@.Xr typos;

ok millert@@
@
text
@d98 1
a98 1
.Nm procmail ,
@


1.7
log
@Update to sendmail-8.12.4
@
text
@d98 1
a98 1
.Xr procmail 1 ,
@


1.6
log
@merge in sendmail 8.12.0 with BSD Makefiles and mdoc man pages
@
text
@a11 1
.\"     $OpenBSD: smrsh.8,v 1.5 2001/01/17 05:26:51 millert Exp $
d14 1
a14 1
.Dd January 24, 2001
@


1.5
log
@convert to mdoc
@
text
@d12 2
a13 2
.\"     $OpenBSD$
.\"     $Sendmail: smrsh.8,v 8.11.16.2 2000/12/15 19:50:46 gshapiro Exp $
d15 1
a15 1
.Dd December 15, 2000
@


1.4
log
@fix sm.bin path; form@@openbsd.ru
@
text
@d12 1
d15 10
a24 8
.TH SMRSH 8 "$Date: 2001/01/15 21:09:11 $"
.SH NAME
smrsh \- restricted shell for sendmail
.SH SYNOPSIS
.B smrsh
.B \-c
command
.SH DESCRIPTION
d26 1
a26 1
.I smrsh
d28 5
a32 3
.I sh
for use in the ``prog'' mailer in
.IR sendmail (8)
d35 7
a41 4
``|program'' syntax of
.I sendmail
in order to improve the over all security of your system.
Briefly, even if a ``bad guy'' can get sendmail to run a program
d43 1
a43 1
.I smrsh
d45 1
a45 1
.PP
d47 3
a49 4
.I smrsh
limits programs to be in a single directory,
by default
/usr/libexec/sm.bin,
d51 5
a55 1
and to the shell builtin commands ``exec'', ``exit'', and ``echo''.
d57 28
a84 6
`\`', `<', `>', `;', `$', `(', `)', `\er' (carriage return),
or `\en' (newline)
on the command line to prevent ``end run'' attacks.
It allows ``||'' and ``&&'' to enable commands like:
``"|exec /usr/local/bin/procmail -f- /etc/procmailrcs/user || exit 75"''
.PP
d86 4
a89 3
so forwarding to ``/usr/ucb/vacation'',
``/usr/bin/vacation'',
``/home/server/mydir/bin/vacation'',
d91 1
a91 1
``vacation''
d93 2
a94 2
``/usr/libexec/sm.bin/vacation''.
.PP
d98 2
a99 2
.IR vacation (1),
.IR procmail (1),
d104 1
a104 1
.IR perl (1))
d109 3
a111 1
in the sm.bin directory (using the ``#!'' syntax);
d113 7
a119 4
.SH FILES
/usr/libexec/sm.bin \- directory for restricted programs
.SH SEE ALSO
sendmail(8)
@


1.3
log
@sendmail 8.11.2 with BSD Makefiles
@
text
@d14 1
a14 1
.TH SMRSH 8 "$Date: 2000/12/15 19:50:46 $"
d42 1
a42 1
/usr/adm/sm.bin,
d59 1
a59 1
``/usr/adm/sm.bin/vacation''.
a76 8
.SH COMPILATION
Compilation should be trivial on most systems.
You may need to use \-DPATH=\e"\fIpath\fP\e"
to adjust the default search path
(defaults to ``/bin:/usr/bin:/usr/ucb'')
and/or \-DCMDBIN=\e"\fIdir\fP\e"
to change the default program directory
(defaults to ``/usr/adm/sm.bin'').
d78 1
a78 1
/usr/adm/sm.bin \- directory for restricted programs
@


1.2
log
@Once again, /usr/sbin/smrsh -> /usr/libexec
Correct paths in smrsh(8).
@
text
@d1 1
a1 1
.\" Copyright (c) 1998, 1999 Sendmail, Inc. and its suppliers.
d12 1
a12 2
.\"     $Sendmail: smrsh.8,v 8.11 1999/06/09 16:51:07 ca Exp $
.\"	$OpenBSD: $
d14 1
a14 1
.TH SMRSH 8 11/02/93
d40 3
a42 2
limits programs to be in the directory
/usr/libexec/sm.bin,
d59 1
a59 1
``/usr/libexec/sm.bin/vacation''.
d62 1
a62 1
/usr/libexec/sm.bin.
d81 1
a81 1
(defaults to ``/bin:/usr/bin'')
d84 1
a84 1
(defaults to ``/usr/libexec/sm.bin'').
d86 1
a86 1
/usr/libexec/sm.bin \- directory for restricted programs
@


1.2.4.1
log
@Pull in patch from current:
Errata(028):
The signal handlers in sendmail contain code that is unsafe in the
context of a signal handler.  This leads to potentially serious race
conditions.  At the moment this is a theoretical attack only and can
only be exploited on the local host (if at all).
Fix(millert):
Update to sendmail 8.11.4:
8.11.4 revamps signal handling within the MTA in order to reduce
the likelihood of a race condition that can lead to heap
corruption as described in Michal Zalewski's advisory.  The
problems discussed in the advisory are not currently known to
be exploitable but we recommend upgrading to 8.11.4 in case a
method is found to exploit the signal handling race condition.
8.11.4 also fixes other bugs found since the release of 8.11.3.

See the RELEASE_NOTES file for more details.
@
text
@d1 1
a1 1
.\" Copyright (c) 1998-2000 Sendmail, Inc. and its suppliers.
d12 2
a13 2
.\"     $OpenBSD: smrsh.8,v 1.5 2001/01/17 05:26:51 millert Exp $
.\"     $Sendmail: smrsh.8,v 8.11.16.2 2000/12/15 19:50:46 gshapiro Exp $
d15 8
a22 10
.Dd December 15, 2000
.Dt SMRSH 8
.Os
.Sh NAME
.Nm smrsh
.Nd restricted shell for sendmail
.Sh SYNOPSIS
.Nm smrsh
.Fl c Ar command
.Sh DESCRIPTION
d24 1
a24 1
.Nm smrsh
d26 3
a28 5
.Pa /bin/sh
for use in the
.Dq prog
mailer in
.Xr sendmail 8
d31 4
a34 7
.Dq |program
syntax of
.Xr sendmail 8
in order to improve the overall security of your system.
Briefly, even if a
.Dq bad guy
can get sendmail to run a program
d36 1
a36 1
.Nm smrsh
d38 1
a38 1
.Pp
d40 3
a42 3
.Nm smrsh
limits programs to be in a single directory, by default
.Pa /usr/libexec/sm.bin ,
d44 1
a44 5
and the shell builtin commands
.Dq exec ,
.Dq exit ,
and
.Dq echo .
d46 6
a51 28
.Sq \e ,
.Sq < ,
.Sq > ,
.So
;
.Sc ,
.Sq $ ,
.So
(
.Sc ,
.So
)
.Sc ,
.Sq \er
(carriage return), or
.Sq \en
(newline) on the command line to prevent
.Dq end run
attacks.
It allows
.Dq ||
and
.Dq &&
to enable commands like:
.Bd -literal -compact -offset "XXXX"
.Qq "|exec /usr/local/bin/procmail -f- /etc/procmailrcs/user || exit 75"
.Ed
.Pp
d53 3
a55 4
so forwarding to
.Pa /usr/ucb/vacation ,
.Pa /usr/bin/vacation ,
.Pa /home/server/mydir/bin/vacation ,
d57 1
a57 1
.Pa vacation
d59 2
a60 2
.Pa /usr/libexec/sm.bin/vacation .
.Pp
d62 1
a62 1
the sm.bin directory.
d64 2
a65 2
.Xr vacation 1 ,
.Xr procmail 1 ,
d70 1
a70 1
.Xr perl 1 )
d75 1
a75 3
in the sm.bin directory (using the
.Dq #!
syntax);
d77 12
a88 7
.Sh FILES
.Bl -tag -width "/usr/libexec/sm.bin" -compact
.It Pa /usr/libexec/sm.bin
directory for restricted programs
.El
.Sh SEE ALSO
.Xr sendmail 8
@


1.1
log
@Initial revision
@
text
@d13 1
d42 1
a42 1
/usr/adm/sm.bin,
d59 1
a59 1
``/usr/adm/sm.bin/vacation''.
d62 1
a62 1
/usr/adm/sm.bin.
d81 1
a81 1
(defaults to ``/bin:/usr/bin:/usr/ucb'')
d84 1
a84 1
(defaults to ``/usr/adm/sm.bin'').
d86 1
a86 1
/usr/adm/sm.bin \- directory for restricted programs
@


1.1.1.1
log
@stock sendmail 8.10.0 with $Id -> $Sendmail
@
text
@@


1.1.1.2
log
@sendmail 8.11.2
@
text
@d1 1
a1 1
.\" Copyright (c) 1998-2000 Sendmail, Inc. and its suppliers.
d12 1
a12 1
.\"     $Id: smrsh.8,v 8.11.16.2 2000/12/15 19:50:46 gshapiro Exp $
d14 1
a14 1
.TH SMRSH 8 "$Date: 2000/12/15 19:50:46 $"
d40 1
a40 2
limits programs to be in a single directory,
by default
d61 1
a61 1
the sm.bin directory.
@


1.1.1.3
log
@sendmail 8.12.0 with $Id tags converted to $Sendmail
@
text
@d1 1
a1 1
.\" Copyright (c) 1998-2001 Sendmail, Inc. and its suppliers.
d12 1
a12 1
.\"     $Sendmail: smrsh.8,v 8.15 2001/01/24 00:40:47 gshapiro Exp $
d14 1
a14 1
.TH SMRSH 8 "$Date: 2001/01/24 00:40:47 $"
d79 1
a79 1
You may need to use \-DSMRSH_PATH=\e"\fIpath\fP\e"
d82 1
a82 1
and/or \-DSMRSH_CMDBIN=\e"\fIdir\fP\e"
@


