head	1.5;
access;
symbols
	OPENBSD_5_6:1.4.0.28
	OPENBSD_5_6_BASE:1.4
	OPENBSD_5_5:1.4.0.26
	OPENBSD_5_5_BASE:1.4
	OPENBSD_5_4:1.4.0.22
	OPENBSD_5_4_BASE:1.4
	OPENBSD_5_3:1.4.0.20
	OPENBSD_5_3_BASE:1.4
	OPENBSD_5_2:1.4.0.18
	OPENBSD_5_2_BASE:1.4
	OPENBSD_5_1_BASE:1.4
	OPENBSD_5_1:1.4.0.16
	OPENBSD_5_0:1.4.0.14
	OPENBSD_5_0_BASE:1.4
	OPENBSD_4_9:1.4.0.12
	OPENBSD_4_9_BASE:1.4
	OPENBSD_4_8:1.4.0.10
	OPENBSD_4_8_BASE:1.4
	OPENBSD_4_7:1.4.0.6
	OPENBSD_4_7_BASE:1.4
	OPENBSD_4_6:1.4.0.8
	OPENBSD_4_6_BASE:1.4
	OPENBSD_4_5:1.4.0.4
	OPENBSD_4_5_BASE:1.4
	OPENBSD_4_4:1.4.0.2
	OPENBSD_4_4_BASE:1.4
	OPENBSD_4_3:1.2.0.14
	OPENBSD_4_3_BASE:1.2
	OPENBSD_4_2:1.2.0.12
	OPENBSD_4_2_BASE:1.2
	OPENBSD_4_1:1.2.0.10
	OPENBSD_4_1_BASE:1.2
	OPENBSD_4_0:1.2.0.8
	OPENBSD_4_0_BASE:1.2
	OPENBSD_3_9:1.2.0.6
	OPENBSD_3_9_BASE:1.2
	OPENBSD_3_8:1.2.0.4
	OPENBSD_3_8_BASE:1.2
	OPENBSD_3_7:1.2.0.2
	OPENBSD_3_7_BASE:1.2
	OPENBSD_3_6:1.1.0.10
	OPENBSD_3_6_BASE:1.1
	OPENBSD_3_5:1.1.0.8
	OPENBSD_3_5_BASE:1.1
	OPENBSD_3_4:1.1.0.4
	OPENBSD_3_4_BASE:1.1
	OPENBSD_3_3:1.1.0.6
	OPENBSD_3_3_BASE:1.1
	OPENBSD_3_2:1.1.0.2
	OPENBSD_3_2_BASE:1.1;
locks; strict;
comment	@# @;


1.5
date	2014.09.17.18.49.49;	author matthieu;	state dead;
branches;
next	1.4;
commitid	M7i5giHIoz3DMlTU;

1.4
date	2008.06.09.14.47.01;	author millert;	state Exp;
branches;
next	1.3;

1.3
date	2008.04.02.15.03.01;	author millert;	state Exp;
branches;
next	1.2;

1.2
date	2005.01.06.17.21.03;	author millert;	state Exp;
branches;
next	1.1;

1.1
date	2002.07.03.16.06.19;	author millert;	state Exp;
branches;
next	;


desc
@@


1.5
log
@Bye.
@
text
@divert(-1)
#
# Sendmail configuration file for lists.openbsd.org
#
# This config accepts bulk mail from mj2 on port 24 and delivers it.
#

divert(0)dnl
VERSIONID(`$OpenBSD: openbsd-bulk.mc,v 1.4 2008/06/09 14:47:01 millert Exp $')
OSTYPE(openbsd)dnl
dnl
dnl Advertise ourselves as ``openbsd.org''
define(`confSMTP_LOGIN_MSG', `openbsd.org Sendmail $v/$Z/bulk ready willing and able at $b')dnl
dnl
dnl Override some default values
define(`confTRY_NULL_MX_LIST', `True')dnl
define(`confMAX_HOP', `30')dnl
define(`confQUEUE_LA', `25')dnl
define(`confREFUSE_LA', `100')dnl
dnl
dnl Disable ident queries
define(`confTO_IDENT', `0')dnl
dnl
dnl Some alternate paths so we don't conflict with sendmail on port 25
define(`confPID_FILE', `/var/run/bulkmail.pid')dnl
dnl
dnl Wait at least 27 minutes before trying to redeliver a message.
define(`confMIN_QUEUE_AGE', `27m')dnl
dnl
dnl Just queue incoming messages, we have queue runners for actual delivery
define(`confDELIVERY_MODE', `q')dnl
dnl
dnl Don't prioritize a message based on the number of recepients
dnl or Precedence header.  We only care about message size and
dnl number of retries.
define(`confWORK_RECIPIENT_FACTOR', `0')dnl
define(`confWORK_CLASS_FACTOR', `0')dnl
define(`confRETRY_FACTOR', `90000')dnl
dnl
dnl One queue group, many dirs, max 90 runners
define(`confMAX_QUEUE_CHILDREN', `90')
QUEUE_GROUP(`mqueue', `P=/var/spool/mqueue/bulk*, R=5, r=10, F=f I=1')dnl
dnl
dnl Add a prefix to differentiate outgoing bulk messages from incoming ones
define(`confPROCESS_TITLE_PREFIX', `bulk')dnl
dnl
dnl Resolver options:
dnl	WorkAroundBrokenAAAA works around some broken nameservers that
dnl	return SERVFAIL (a temporary failure) on T_AAAA (IPv6) lookups.
dnl	We turn off DNSRCH and DEFNAMES since we are always passed
dnl	qualified hostname (this saves us some DNS traffic).
define(`confBIND_OPTS', `WorkAroundBrokenAAAA -DNSRCH -DEFNAMES')dnl
dnl
dnl Keep host status on disk between sendmail runs in the .hoststat dir
define(`confHOST_STATUS_DIRECTORY', `/var/spool/mqueue/.hoststat')dnl
define(`confTO_HOSTSTATUS', `30m')dnl
dnl
dnl Always use fully qualified domains
FEATURE(always_add_domain)dnl
dnl
dnl Wait a day before sending mail about deferred messages
define(`confTO_QUEUEWARN', `1d')dnl
dnl
dnl Wait 3 days before giving up and bouncing the message
define(`confTO_QUEUERETURN', `3d')dnl
dnl
dnl Shared memory key used to stash disk usage stats so they
dnl don't have to be checked by each sendmail process.
define(`confSHARED_MEMORY_KEY', `696969')dnl
dnl
dnl SSL certificate paths
define(`CERT_DIR', `MAIL_SETTINGS_DIR`'certs')dnl
define(`confCACERT_PATH', `CERT_DIR')dnl
define(`confCACERT', `CERT_DIR/mycert.pem')dnl
define(`confSERVER_CERT', `CERT_DIR/mycert.pem')dnl
define(`confSERVER_KEY', `CERT_DIR/mykey.pem')dnl
define(`confCLIENT_CERT', `CERT_DIR/mycert.pem')dnl
define(`confCLIENT_KEY', `CERT_DIR/mykey.pem')dnl
dnl
dnl List of hostname we treat as local
FEATURE(use_cw_file)dnl
dnl
dnl Make mail appear to be from openbsd.org
MASQUERADE_AS(openbsd.org)dnl
FEATURE(masquerade_envelope)dnl
dnl
dnl Need this so we can deal with user@@openbsd.org
dnl XXX - could deliver to real daemon instead (and kill cw stuff as well)
FEATURE(stickyhost)dnl
FEATURE(virtusertable)dnl
dnl
dnl List the mailers we support
FEATURE(`no_default_msa')dnl
MAILER(local)dnl
MAILER(smtp)dnl
dnl
dnl Only accept connections from localhost on port 24, use ipv6 or ipv4
dnl for delivery and disable canonification.
DAEMON_OPTIONS(`Family=inet6, address=::1, Name=MTA6, Port=24, M=COS')dnl
DAEMON_OPTIONS(`Family=inet, address=127.0.0.1, Name=MTA, Port=24, M=CS')dnl
CLIENT_OPTIONS(`Family=inet6, Address=::')dnl
CLIENT_OPTIONS(`Family=inet, Address=0.0.0.0')dnl
@


1.4
log
@Disable ident queries
Crank max queue children in bulk config
Use the C flag in DAEMON_OPTIONS instead of nocanonify in bulk config
@
text
@d9 1
a9 1
VERSIONID(`$OpenBSD: openbsd-bulk.mc,v 1.3 2008/04/02 15:03:01 millert Exp $')
@


1.3
log
@Update to queue group-based config in use on the list server.
@
text
@d9 1
a9 1
VERSIONID(`$OpenBSD: openbsd-bulk.mc,v 1.2 2005/01/06 17:21:03 millert Exp $')
d21 3
d40 2
a41 2
dnl One queue group, many dirs, max 80 runners
define(`confMAX_QUEUE_CHILDREN', `80')
a42 1
dnl QUEUE_GROUP(`retry', `P=/var/spool/mqueue/fail*, R=5, r=10, F=f I=5 N=4')dnl
a60 3
dnl No need to do DNS lookups on addresses, they've already been done
FEATURE(nocanonify)dnl
dnl
d98 3
a100 3
dnl for delivery.
DAEMON_OPTIONS(`Family=inet6, address=::1, Name=MTA6, Port=24, M=OS')dnl
DAEMON_OPTIONS(`Family=inet, address=127.0.0.1, Name=MTA, Port=24, M=S')dnl
@


1.2
log
@sync with list server
@
text
@d5 1
a5 18
# This config just accepts bulk mail from mj2 on port 24 and delivers it.
# It is a queue-only config--we use persistent queue runners to do the
# actual delivery.
#
# The queue runners are started from rc.local as follows:
#
# set -- q0 50 modification 1s q1 5 host 1m q2 5 host 2m q3 5 host 5m qold 10 host 10m
# _key=8675309
# while test $# -ge 4; do
#	/usr/sbin/sendmail -C/etc/mail/bulk.cf -Lsm-queue -OQueueSortOrder=$3 \
#	    -OMaxQueueChildren=$2 -OQueueDirectory=/var/spool/mqueue/$1 \
#	    -OProcessTitlePrefix=$1 -OPidFile=/var/run/runner-$1.pid \
#	    -OSharedMemoryKey=$_key -q$4
#	_key=$(( $_key + 10 ))
#	shift 4
# done
#
# A cron job moves failed messages progressively from q0 -> qold
d9 1
a9 1
VERSIONID(`$OpenBSD: openbsd-bulk.mc,v 1.1 2002/07/03 16:06:19 millert Exp $')
a15 1
define(`confDELIVERY_MODE', `q')dnl
d23 18
a40 1
define(`QUEUE_DIR', `/var/spool/mqueue/q0')dnl
a54 10
dnl
dnl Wait at least 27 minutes before trying to redeliver a message.
define(`confMIN_QUEUE_AGE', `27m')dnl
dnl
dnl Don't prioritize a message based on the number of recepients.
dnl This prevents retries from having higher priority than new batches.
define(`confWORK_RECIPIENT_FACTOR', `0')dnl
dnl
dnl Reduce ClassFactor
define(`confWORK_CLASS_FACTOR', `1000')dnl
@


1.1
log
@New config for the OpenBSD mailing list server.  Two separate daemons
are used; one for incoming messages on port 25 and a stripped down
queueing-only config on localhost port 24 fed by the mailing list exploder.
Actual delivery is handled by persistent queue runners.
@
text
@d26 1
a26 1
VERSIONID(`$OpenBSD: openbsd-lists.mc,v 1.12 2002/04/18 00:49:26 millert Exp $')
d36 1
a36 1
define(`confQUEUE_LA', `6')dnl
@

