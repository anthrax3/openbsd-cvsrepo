head	1.1;
branch	1.1.1;
access;
symbols
	OPENBSD_6_1:1.1.1.3.0.2
	OPENBSD_6_1_BASE:1.1.1.3
	LLVM_4_0_0:1.1.1.3
	LLVM_4_0_0_RC1:1.1.1.3
	LLVM_3_9_1:1.1.1.2
	LLVM_3_8_1:1.1.1.1
	LLVM:1.1.1;
locks; strict;
comment	@// @;


1.1
date	2016.09.03.22.47.01;	author pascal;	state Exp;
branches
	1.1.1.1;
next	;
commitid	piLU3CHugy63NlaI;

1.1.1.1
date	2016.09.03.22.47.01;	author pascal;	state Exp;
branches;
next	1.1.1.2;
commitid	piLU3CHugy63NlaI;

1.1.1.2
date	2017.01.14.19.56.06;	author patrick;	state Exp;
branches;
next	1.1.1.3;
commitid	qMUxATnKgqN83Oct;

1.1.1.3
date	2017.01.24.08.33.28;	author patrick;	state Exp;
branches;
next	;
commitid	so2WA7LCP6wbxtYl;


desc
@@


1.1
log
@Initial revision
@
text
@//===-- X86InstComments.cpp - Generate verbose-asm comments for instrs ----===//
//
//                     The LLVM Compiler Infrastructure
//
// This file is distributed under the University of Illinois Open Source
// License. See LICENSE.TXT for details.
//
//===----------------------------------------------------------------------===//
//
// This defines functionality used to emit comments about X86 instructions to
// an output stream for -fverbose-asm.
//
//===----------------------------------------------------------------------===//

#include "X86InstComments.h"
#include "MCTargetDesc/X86MCTargetDesc.h"
#include "Utils/X86ShuffleDecode.h"
#include "llvm/MC/MCInst.h"
#include "llvm/CodeGen/MachineValueType.h"
#include "llvm/Support/raw_ostream.h"

using namespace llvm;

static unsigned getVectorRegSize(unsigned RegNo) {
  if (X86::ZMM0 <= RegNo && RegNo <= X86::ZMM31)
    return 512;
  if (X86::YMM0 <= RegNo && RegNo <= X86::YMM31)
    return 256;
  if (X86::XMM0 <= RegNo && RegNo <= X86::XMM31)
    return 128;
  if (X86::MM0 <= RegNo && RegNo <= X86::MM7)
    return 64;

  llvm_unreachable("Unknown vector reg!");
}

static MVT getRegOperandVectorVT(const MCInst *MI, const MVT &ScalarVT,
                                 unsigned OperandIndex) {
  unsigned OpReg = MI->getOperand(OperandIndex).getReg();
  return MVT::getVectorVT(ScalarVT,
                          getVectorRegSize(OpReg)/ScalarVT.getSizeInBits());
}

/// \brief Extracts the src/dst types for a given zero extension instruction.
/// \note While the number of elements in DstVT type correct, the
/// number in the SrcVT type is expanded to fill the src xmm register and the
/// upper elements may not be included in the dst xmm/ymm register.
static void getZeroExtensionTypes(const MCInst *MI, MVT &SrcVT, MVT &DstVT) {
  switch (MI->getOpcode()) {
  default:
    llvm_unreachable("Unknown zero extension instruction");
  // i8 zero extension
  case X86::PMOVZXBWrm:
  case X86::PMOVZXBWrr:
  case X86::VPMOVZXBWrm:
  case X86::VPMOVZXBWrr:
    SrcVT = MVT::v16i8;
    DstVT = MVT::v8i16;
    break;
  case X86::VPMOVZXBWYrm:
  case X86::VPMOVZXBWYrr:
    SrcVT = MVT::v16i8;
    DstVT = MVT::v16i16;
    break;
  case X86::PMOVZXBDrm:
  case X86::PMOVZXBDrr:
  case X86::VPMOVZXBDrm:
  case X86::VPMOVZXBDrr:
    SrcVT = MVT::v16i8;
    DstVT = MVT::v4i32;
    break;
  case X86::VPMOVZXBDYrm:
  case X86::VPMOVZXBDYrr:
    SrcVT = MVT::v16i8;
    DstVT = MVT::v8i32;
    break;
  case X86::PMOVZXBQrm:
  case X86::PMOVZXBQrr:
  case X86::VPMOVZXBQrm:
  case X86::VPMOVZXBQrr:
    SrcVT = MVT::v16i8;
    DstVT = MVT::v2i64;
    break;
  case X86::VPMOVZXBQYrm:
  case X86::VPMOVZXBQYrr:
    SrcVT = MVT::v16i8;
    DstVT = MVT::v4i64;
    break;
  // i16 zero extension
  case X86::PMOVZXWDrm:
  case X86::PMOVZXWDrr:
  case X86::VPMOVZXWDrm:
  case X86::VPMOVZXWDrr:
    SrcVT = MVT::v8i16;
    DstVT = MVT::v4i32;
    break;
  case X86::VPMOVZXWDYrm:
  case X86::VPMOVZXWDYrr:
    SrcVT = MVT::v8i16;
    DstVT = MVT::v8i32;
    break;
  case X86::PMOVZXWQrm:
  case X86::PMOVZXWQrr:
  case X86::VPMOVZXWQrm:
  case X86::VPMOVZXWQrr:
    SrcVT = MVT::v8i16;
    DstVT = MVT::v2i64;
    break;
  case X86::VPMOVZXWQYrm:
  case X86::VPMOVZXWQYrr:
    SrcVT = MVT::v8i16;
    DstVT = MVT::v4i64;
    break;
  // i32 zero extension
  case X86::PMOVZXDQrm:
  case X86::PMOVZXDQrr:
  case X86::VPMOVZXDQrm:
  case X86::VPMOVZXDQrr:
    SrcVT = MVT::v4i32;
    DstVT = MVT::v2i64;
    break;
  case X86::VPMOVZXDQYrm:
  case X86::VPMOVZXDQYrr:
    SrcVT = MVT::v4i32;
    DstVT = MVT::v4i64;
    break;
  }
}

#define CASE_MASK_INS_COMMON(Inst, Suffix, src)  \
  case X86::V##Inst##Suffix##src:                \
  case X86::V##Inst##Suffix##src##k:             \
  case X86::V##Inst##Suffix##src##kz:

#define CASE_SSE_INS_COMMON(Inst, src)           \
  case X86::Inst##src:

#define CASE_AVX_INS_COMMON(Inst, Suffix, src)  \
  case X86::V##Inst##Suffix##src:

#define CASE_MOVDUP(Inst, src)                  \
  CASE_MASK_INS_COMMON(Inst, Z, r##src)         \
  CASE_MASK_INS_COMMON(Inst, Z256, r##src)      \
  CASE_MASK_INS_COMMON(Inst, Z128, r##src)      \
  CASE_AVX_INS_COMMON(Inst, , r##src)           \
  CASE_AVX_INS_COMMON(Inst, Y, r##src)          \
  CASE_SSE_INS_COMMON(Inst, r##src)             \

#define CASE_UNPCK(Inst, src)                   \
  CASE_MASK_INS_COMMON(Inst, Z, r##src)         \
  CASE_MASK_INS_COMMON(Inst, Z256, r##src)      \
  CASE_MASK_INS_COMMON(Inst, Z128, r##src)      \
  CASE_AVX_INS_COMMON(Inst, , r##src)           \
  CASE_AVX_INS_COMMON(Inst, Y, r##src)          \
  CASE_SSE_INS_COMMON(Inst, r##src)             \

#define CASE_SHUF(Inst, src)                    \
  CASE_MASK_INS_COMMON(Inst, Z, r##src##i)      \
  CASE_MASK_INS_COMMON(Inst, Z256, r##src##i)   \
  CASE_MASK_INS_COMMON(Inst, Z128, r##src##i)   \
  CASE_AVX_INS_COMMON(Inst, , r##src##i)        \
  CASE_AVX_INS_COMMON(Inst, Y, r##src##i)       \
  CASE_SSE_INS_COMMON(Inst, r##src##i)          \

#define CASE_VPERM(Inst, src)                   \
  CASE_MASK_INS_COMMON(Inst, Z, src##i)         \
  CASE_MASK_INS_COMMON(Inst, Z256, src##i)      \
  CASE_MASK_INS_COMMON(Inst, Z128, src##i)      \
  CASE_AVX_INS_COMMON(Inst, , src##i)           \
  CASE_AVX_INS_COMMON(Inst, Y, src##i)          \

#define CASE_VSHUF(Inst, src)                          \
  CASE_MASK_INS_COMMON(SHUFF##Inst, Z, r##src##i)      \
  CASE_MASK_INS_COMMON(SHUFI##Inst, Z, r##src##i)      \
  CASE_MASK_INS_COMMON(SHUFF##Inst, Z256, r##src##i)   \
  CASE_MASK_INS_COMMON(SHUFI##Inst, Z256, r##src##i)   \

/// \brief Extracts the types and if it has memory operand for a given
/// (SHUFF32x4/SHUFF64x2/SHUFI32x4/SHUFI64x2) instruction.
static void getVSHUF64x2FamilyInfo(const MCInst *MI, MVT &VT, bool &HasMemOp) {
  HasMemOp = false;
  switch (MI->getOpcode()) {
  default:
    llvm_unreachable("Unknown VSHUF64x2 family instructions.");
    break;
  CASE_VSHUF(64X2, m)
    HasMemOp = true;        // FALL THROUGH.
  CASE_VSHUF(64X2, r)
    VT = getRegOperandVectorVT(MI, MVT::i64, 0);
    break;
  CASE_VSHUF(32X4, m)
    HasMemOp = true;        // FALL THROUGH.
  CASE_VSHUF(32X4, r)
    VT = getRegOperandVectorVT(MI, MVT::i32, 0);
    break;
  }
}

//===----------------------------------------------------------------------===//
// Top Level Entrypoint
//===----------------------------------------------------------------------===//

/// EmitAnyX86InstComments - This function decodes x86 instructions and prints
/// newline terminated strings to the specified string if desired.  This
/// information is shown in disassembly dumps when verbose assembly is enabled.
bool llvm::EmitAnyX86InstComments(const MCInst *MI, raw_ostream &OS,
                                  const char *(*getRegName)(unsigned)) {
  // If this is a shuffle operation, the switch should fill in this state.
  SmallVector<int, 8> ShuffleMask;
  const char *DestName = nullptr, *Src1Name = nullptr, *Src2Name = nullptr;

  switch (MI->getOpcode()) {
  default:
    // Not an instruction for which we can decode comments.
    return false;

  case X86::BLENDPDrri:
  case X86::VBLENDPDrri:
  case X86::VBLENDPDYrri:
    Src2Name = getRegName(MI->getOperand(2).getReg());
    // FALL THROUGH.
  case X86::BLENDPDrmi:
  case X86::VBLENDPDrmi:
  case X86::VBLENDPDYrmi:
    if (MI->getOperand(MI->getNumOperands() - 1).isImm())
      DecodeBLENDMask(getRegOperandVectorVT(MI, MVT::f64, 0),
                      MI->getOperand(MI->getNumOperands() - 1).getImm(),
                      ShuffleMask);
    Src1Name = getRegName(MI->getOperand(1).getReg());
    DestName = getRegName(MI->getOperand(0).getReg());
    break;

  case X86::BLENDPSrri:
  case X86::VBLENDPSrri:
  case X86::VBLENDPSYrri:
    Src2Name = getRegName(MI->getOperand(2).getReg());
    // FALL THROUGH.
  case X86::BLENDPSrmi:
  case X86::VBLENDPSrmi:
  case X86::VBLENDPSYrmi:
    if (MI->getOperand(MI->getNumOperands() - 1).isImm())
      DecodeBLENDMask(getRegOperandVectorVT(MI, MVT::f32, 0),
                      MI->getOperand(MI->getNumOperands() - 1).getImm(),
                      ShuffleMask);
    Src1Name = getRegName(MI->getOperand(1).getReg());
    DestName = getRegName(MI->getOperand(0).getReg());
    break;

  case X86::PBLENDWrri:
  case X86::VPBLENDWrri:
  case X86::VPBLENDWYrri:
    Src2Name = getRegName(MI->getOperand(2).getReg());
    // FALL THROUGH.
  case X86::PBLENDWrmi:
  case X86::VPBLENDWrmi:
  case X86::VPBLENDWYrmi:
    if (MI->getOperand(MI->getNumOperands() - 1).isImm())
      DecodeBLENDMask(getRegOperandVectorVT(MI, MVT::i16, 0),
                      MI->getOperand(MI->getNumOperands() - 1).getImm(),
                      ShuffleMask);
    Src1Name = getRegName(MI->getOperand(1).getReg());
    DestName = getRegName(MI->getOperand(0).getReg());
    break;

  case X86::VPBLENDDrri:
  case X86::VPBLENDDYrri:
    Src2Name = getRegName(MI->getOperand(2).getReg());
    // FALL THROUGH.
  case X86::VPBLENDDrmi:
  case X86::VPBLENDDYrmi:
    if (MI->getOperand(MI->getNumOperands() - 1).isImm())
      DecodeBLENDMask(getRegOperandVectorVT(MI, MVT::i32, 0),
                      MI->getOperand(MI->getNumOperands() - 1).getImm(),
                      ShuffleMask);
    Src1Name = getRegName(MI->getOperand(1).getReg());
    DestName = getRegName(MI->getOperand(0).getReg());
    break;

  case X86::INSERTPSrr:
  case X86::VINSERTPSrr:
    Src2Name = getRegName(MI->getOperand(2).getReg());
    // FALL THROUGH.
  case X86::INSERTPSrm:
  case X86::VINSERTPSrm:
    DestName = getRegName(MI->getOperand(0).getReg());
    Src1Name = getRegName(MI->getOperand(1).getReg());
    if (MI->getOperand(MI->getNumOperands() - 1).isImm())
      DecodeINSERTPSMask(MI->getOperand(MI->getNumOperands() - 1).getImm(),
                         ShuffleMask);
    break;

  case X86::MOVLHPSrr:
  case X86::VMOVLHPSrr:
  case X86::VMOVLHPSZrr:
    Src2Name = getRegName(MI->getOperand(2).getReg());
    Src1Name = getRegName(MI->getOperand(1).getReg());
    DestName = getRegName(MI->getOperand(0).getReg());
    DecodeMOVLHPSMask(2, ShuffleMask);
    break;

  case X86::MOVHLPSrr:
  case X86::VMOVHLPSrr:
  case X86::VMOVHLPSZrr:
    Src2Name = getRegName(MI->getOperand(2).getReg());
    Src1Name = getRegName(MI->getOperand(1).getReg());
    DestName = getRegName(MI->getOperand(0).getReg());
    DecodeMOVHLPSMask(2, ShuffleMask);
    break;

  CASE_MOVDUP(MOVSLDUP, r)
    Src1Name = getRegName(MI->getOperand(MI->getNumOperands() - 1).getReg());
    // FALL THROUGH.
  CASE_MOVDUP(MOVSLDUP, m)
    DestName = getRegName(MI->getOperand(0).getReg());
    DecodeMOVSLDUPMask(getRegOperandVectorVT(MI, MVT::f32, 0), ShuffleMask);
    break;

  CASE_MOVDUP(MOVSHDUP, r)
    Src1Name = getRegName(MI->getOperand(MI->getNumOperands() - 1).getReg());
    // FALL THROUGH.
  CASE_MOVDUP(MOVSHDUP, m)
    DestName = getRegName(MI->getOperand(0).getReg());
    DecodeMOVSHDUPMask(getRegOperandVectorVT(MI, MVT::f32, 0), ShuffleMask);
    break;

  CASE_MOVDUP(MOVDDUP, r)
    Src1Name = getRegName(MI->getOperand(MI->getNumOperands() - 1).getReg());
    // FALL THROUGH.
  CASE_MOVDUP(MOVDDUP, m)
    DestName = getRegName(MI->getOperand(0).getReg());
    DecodeMOVDDUPMask(getRegOperandVectorVT(MI, MVT::f64, 0), ShuffleMask);
    break;

  case X86::PSLLDQri:
  case X86::VPSLLDQri:
  case X86::VPSLLDQYri:
    Src1Name = getRegName(MI->getOperand(1).getReg());
    DestName = getRegName(MI->getOperand(0).getReg());
    if (MI->getOperand(MI->getNumOperands() - 1).isImm())
      DecodePSLLDQMask(getRegOperandVectorVT(MI, MVT::i8, 0),
                       MI->getOperand(MI->getNumOperands() - 1).getImm(),
                       ShuffleMask);
    break;

  case X86::PSRLDQri:
  case X86::VPSRLDQri:
  case X86::VPSRLDQYri:
    Src1Name = getRegName(MI->getOperand(1).getReg());
    DestName = getRegName(MI->getOperand(0).getReg());
    if (MI->getOperand(MI->getNumOperands() - 1).isImm())
      DecodePSRLDQMask(getRegOperandVectorVT(MI, MVT::i8, 0),
                       MI->getOperand(MI->getNumOperands() - 1).getImm(),
                       ShuffleMask);
    break;

  case X86::PALIGNR128rr:
  case X86::VPALIGNR128rr:
  case X86::VPALIGNR256rr:
    Src1Name = getRegName(MI->getOperand(2).getReg());
    // FALL THROUGH.
  case X86::PALIGNR128rm:
  case X86::VPALIGNR128rm:
  case X86::VPALIGNR256rm:
    Src2Name = getRegName(MI->getOperand(1).getReg());
    DestName = getRegName(MI->getOperand(0).getReg());
    if (MI->getOperand(MI->getNumOperands() - 1).isImm())
      DecodePALIGNRMask(getRegOperandVectorVT(MI, MVT::i8, 0),
                        MI->getOperand(MI->getNumOperands() - 1).getImm(),
                        ShuffleMask);
    break;

  case X86::PSHUFDri:
  case X86::VPSHUFDri:
  case X86::VPSHUFDYri:
    Src1Name = getRegName(MI->getOperand(1).getReg());
    // FALL THROUGH.
  case X86::PSHUFDmi:
  case X86::VPSHUFDmi:
  case X86::VPSHUFDYmi:
    DestName = getRegName(MI->getOperand(0).getReg());
    if (MI->getOperand(MI->getNumOperands() - 1).isImm())
      DecodePSHUFMask(getRegOperandVectorVT(MI, MVT::i32, 0),
                      MI->getOperand(MI->getNumOperands() - 1).getImm(),
                      ShuffleMask);
    break;

  case X86::PSHUFHWri:
  case X86::VPSHUFHWri:
  case X86::VPSHUFHWYri:
    Src1Name = getRegName(MI->getOperand(1).getReg());
    // FALL THROUGH.
  case X86::PSHUFHWmi:
  case X86::VPSHUFHWmi:
  case X86::VPSHUFHWYmi:
    DestName = getRegName(MI->getOperand(0).getReg());
    if (MI->getOperand(MI->getNumOperands() - 1).isImm())
      DecodePSHUFHWMask(getRegOperandVectorVT(MI, MVT::i16, 0),
                        MI->getOperand(MI->getNumOperands() - 1).getImm(),
                        ShuffleMask);
    break;

  case X86::PSHUFLWri:
  case X86::VPSHUFLWri:
  case X86::VPSHUFLWYri:
    Src1Name = getRegName(MI->getOperand(1).getReg());
    // FALL THROUGH.
  case X86::PSHUFLWmi:
  case X86::VPSHUFLWmi:
  case X86::VPSHUFLWYmi:
    DestName = getRegName(MI->getOperand(0).getReg());
    if (MI->getOperand(MI->getNumOperands() - 1).isImm())
      DecodePSHUFLWMask(getRegOperandVectorVT(MI, MVT::i16, 0),
                        MI->getOperand(MI->getNumOperands() - 1).getImm(),
                        ShuffleMask);
    break;

  case X86::MMX_PSHUFWri:
    Src1Name = getRegName(MI->getOperand(1).getReg());
    // FALL THROUGH.
  case X86::MMX_PSHUFWmi:
    DestName = getRegName(MI->getOperand(0).getReg());
    if (MI->getOperand(MI->getNumOperands() - 1).isImm())
      DecodePSHUFMask(MVT::v4i16,
                      MI->getOperand(MI->getNumOperands() - 1).getImm(),
                      ShuffleMask);
    break;

  case X86::PSWAPDrr:
    Src1Name = getRegName(MI->getOperand(1).getReg());
    // FALL THROUGH.
  case X86::PSWAPDrm:
    DestName = getRegName(MI->getOperand(0).getReg());
    DecodePSWAPMask(MVT::v2i32, ShuffleMask);
    break;

  CASE_UNPCK(PUNPCKHBW, r)
  case X86::MMX_PUNPCKHBWirr:
    Src2Name = getRegName(MI->getOperand(2).getReg());
    // FALL THROUGH.
  CASE_UNPCK(PUNPCKHBW, m)
  case X86::MMX_PUNPCKHBWirm:
    Src1Name = getRegName(MI->getOperand(1).getReg());
    DestName = getRegName(MI->getOperand(0).getReg());
    DecodeUNPCKHMask(getRegOperandVectorVT(MI, MVT::i8, 0), ShuffleMask);
    break;

  CASE_UNPCK(PUNPCKHWD, r)
  case X86::MMX_PUNPCKHWDirr:
    Src2Name = getRegName(MI->getOperand(2).getReg());
    // FALL THROUGH.
  CASE_UNPCK(PUNPCKHWD, m)
  case X86::MMX_PUNPCKHWDirm:
    Src1Name = getRegName(MI->getOperand(1).getReg());
    DestName = getRegName(MI->getOperand(0).getReg());
    DecodeUNPCKHMask(getRegOperandVectorVT(MI, MVT::i16, 0), ShuffleMask);
    break;

  CASE_UNPCK(PUNPCKHDQ, r)
  case X86::MMX_PUNPCKHDQirr:
    Src2Name = getRegName(MI->getOperand(2).getReg());
    // FALL THROUGH.
  CASE_UNPCK(PUNPCKHDQ, m)
  case X86::MMX_PUNPCKHDQirm:
    Src1Name = getRegName(MI->getOperand(1).getReg());
    DestName = getRegName(MI->getOperand(0).getReg());
    DecodeUNPCKHMask(getRegOperandVectorVT(MI, MVT::i32, 0), ShuffleMask);
    break;

  CASE_UNPCK(PUNPCKHQDQ, r)
    Src2Name = getRegName(MI->getOperand(2).getReg());
    // FALL THROUGH.
  CASE_UNPCK(PUNPCKHQDQ, m)
    Src1Name = getRegName(MI->getOperand(1).getReg());
    DestName = getRegName(MI->getOperand(0).getReg());
    DecodeUNPCKHMask(getRegOperandVectorVT(MI, MVT::i64, 0), ShuffleMask);
    break;

  CASE_UNPCK(PUNPCKLBW, r)
  case X86::MMX_PUNPCKLBWirr:
    Src2Name = getRegName(MI->getOperand(2).getReg());
    // FALL THROUGH.
  CASE_UNPCK(PUNPCKLBW, m)
  case X86::MMX_PUNPCKLBWirm:
    Src1Name = getRegName(MI->getOperand(1).getReg());
    DestName = getRegName(MI->getOperand(0).getReg());
    DecodeUNPCKLMask(getRegOperandVectorVT(MI, MVT::i8, 0), ShuffleMask);
    break;

  CASE_UNPCK(PUNPCKLWD, r)
  case X86::MMX_PUNPCKLWDirr:
    Src2Name = getRegName(MI->getOperand(2).getReg());
    // FALL THROUGH.
  CASE_UNPCK(PUNPCKLWD, m)
  case X86::MMX_PUNPCKLWDirm:
    Src1Name = getRegName(MI->getOperand(1).getReg());
    DestName = getRegName(MI->getOperand(0).getReg());
    DecodeUNPCKLMask(getRegOperandVectorVT(MI, MVT::i16, 0), ShuffleMask);
    break;

  CASE_UNPCK(PUNPCKLDQ, r)
  case X86::MMX_PUNPCKLDQirr:
    Src2Name = getRegName(MI->getOperand(2).getReg());
    // FALL THROUGH.
  CASE_UNPCK(PUNPCKLDQ, m)
  case X86::MMX_PUNPCKLDQirm:
    Src1Name = getRegName(MI->getOperand(1).getReg());
    DestName = getRegName(MI->getOperand(0).getReg());
    DecodeUNPCKLMask(getRegOperandVectorVT(MI, MVT::i32, 0), ShuffleMask);
    break;

  CASE_UNPCK(PUNPCKLQDQ, r)
    Src2Name = getRegName(MI->getOperand(2).getReg());
    // FALL THROUGH.
  CASE_UNPCK(PUNPCKLQDQ, m)
    Src1Name = getRegName(MI->getOperand(1).getReg());
    DestName = getRegName(MI->getOperand(0).getReg());
    DecodeUNPCKLMask(getRegOperandVectorVT(MI, MVT::i64, 0), ShuffleMask);
    break;

  CASE_SHUF(SHUFPD, r)
    Src2Name = getRegName(MI->getOperand(2).getReg());
    // FALL THROUGH.
  CASE_SHUF(SHUFPD, m)
    if (MI->getOperand(MI->getNumOperands() - 1).isImm())
      DecodeSHUFPMask(getRegOperandVectorVT(MI, MVT::f64, 0),
                      MI->getOperand(MI->getNumOperands() - 1).getImm(),
                      ShuffleMask);
    Src1Name = getRegName(MI->getOperand(1).getReg());
    DestName = getRegName(MI->getOperand(0).getReg());
    break;

  CASE_SHUF(SHUFPS, r)
    Src2Name = getRegName(MI->getOperand(2).getReg());
    // FALL THROUGH.
  CASE_SHUF(SHUFPS, m)
    if (MI->getOperand(MI->getNumOperands() - 1).isImm())
      DecodeSHUFPMask(getRegOperandVectorVT(MI, MVT::f32, 0),
                      MI->getOperand(MI->getNumOperands() - 1).getImm(),
                      ShuffleMask);
    Src1Name = getRegName(MI->getOperand(1).getReg());
    DestName = getRegName(MI->getOperand(0).getReg());
    break;

  CASE_VSHUF(64X2, r)
  CASE_VSHUF(64X2, m)
  CASE_VSHUF(32X4, r)
  CASE_VSHUF(32X4, m) {
    MVT VT;
    bool HasMemOp;
    unsigned NumOp = MI->getNumOperands();
    getVSHUF64x2FamilyInfo(MI, VT, HasMemOp);
    decodeVSHUF64x2FamilyMask(VT, MI->getOperand(NumOp - 1).getImm(),
                              ShuffleMask);
    DestName = getRegName(MI->getOperand(0).getReg());
    if (HasMemOp) {
      assert((NumOp >= 8) && "Expected at least 8 operands!");
      Src1Name = getRegName(MI->getOperand(NumOp - 7).getReg());
    } else {
      assert((NumOp >= 4) && "Expected at least 4 operands!");
      Src2Name = getRegName(MI->getOperand(NumOp - 2).getReg());
      Src1Name = getRegName(MI->getOperand(NumOp - 3).getReg());
    }
    break;
  }

  CASE_UNPCK(UNPCKLPD, r)
    Src2Name = getRegName(MI->getOperand(2).getReg());
    // FALL THROUGH.
  CASE_UNPCK(UNPCKLPD, m)
    DecodeUNPCKLMask(getRegOperandVectorVT(MI, MVT::f64, 0), ShuffleMask);
    Src1Name = getRegName(MI->getOperand(1).getReg());
    DestName = getRegName(MI->getOperand(0).getReg());
    break;

  CASE_UNPCK(UNPCKLPS, r)
    Src2Name = getRegName(MI->getOperand(2).getReg());
    // FALL THROUGH.
  CASE_UNPCK(UNPCKLPS, m)
    DecodeUNPCKLMask(getRegOperandVectorVT(MI, MVT::f32, 0), ShuffleMask);
    Src1Name = getRegName(MI->getOperand(1).getReg());
    DestName = getRegName(MI->getOperand(0).getReg());
    break;

  CASE_UNPCK(UNPCKHPD, r)
    Src2Name = getRegName(MI->getOperand(2).getReg());
    // FALL THROUGH.
  CASE_UNPCK(UNPCKHPD, m)
    DecodeUNPCKHMask(getRegOperandVectorVT(MI, MVT::f64, 0), ShuffleMask);
    Src1Name = getRegName(MI->getOperand(1).getReg());
    DestName = getRegName(MI->getOperand(0).getReg());
    break;

  CASE_UNPCK(UNPCKHPS, r)
    Src2Name = getRegName(MI->getOperand(2).getReg());
    // FALL THROUGH.
  CASE_UNPCK(UNPCKHPS, m)
    DecodeUNPCKHMask(getRegOperandVectorVT(MI, MVT::f32, 0), ShuffleMask);
    Src1Name = getRegName(MI->getOperand(1).getReg());
    DestName = getRegName(MI->getOperand(0).getReg());
    break;

  CASE_VPERM(PERMILPS, r)
    Src1Name = getRegName(MI->getOperand(1).getReg());
    // FALL THROUGH.
  CASE_VPERM(PERMILPS, m)
    if (MI->getOperand(MI->getNumOperands() - 1).isImm())
      DecodePSHUFMask(getRegOperandVectorVT(MI, MVT::f32, 0),
                      MI->getOperand(MI->getNumOperands() - 1).getImm(),
                      ShuffleMask);
    DestName = getRegName(MI->getOperand(0).getReg());
    break;

  CASE_VPERM(PERMILPD, r)
    Src1Name = getRegName(MI->getOperand(1).getReg());
    // FALL THROUGH.
  CASE_VPERM(PERMILPD, m)
    if (MI->getOperand(MI->getNumOperands() - 1).isImm())
      DecodePSHUFMask(getRegOperandVectorVT(MI, MVT::f64, 0),
                      MI->getOperand(MI->getNumOperands() - 1).getImm(),
                      ShuffleMask);
    DestName = getRegName(MI->getOperand(0).getReg());
    break;

  case X86::VPERM2F128rr:
  case X86::VPERM2I128rr:
    Src2Name = getRegName(MI->getOperand(2).getReg());
    // FALL THROUGH.
  case X86::VPERM2F128rm:
  case X86::VPERM2I128rm:
    // For instruction comments purpose, assume the 256-bit vector is v4i64.
    if (MI->getOperand(MI->getNumOperands() - 1).isImm())
      DecodeVPERM2X128Mask(MVT::v4i64,
                           MI->getOperand(MI->getNumOperands() - 1).getImm(),
                           ShuffleMask);
    Src1Name = getRegName(MI->getOperand(1).getReg());
    DestName = getRegName(MI->getOperand(0).getReg());
    break;

  case X86::VPERMQYri:
  case X86::VPERMPDYri:
    Src1Name = getRegName(MI->getOperand(1).getReg());
    // FALL THROUGH.
  case X86::VPERMQYmi:
  case X86::VPERMPDYmi:
    if (MI->getOperand(MI->getNumOperands() - 1).isImm())
      DecodeVPERMMask(MI->getOperand(MI->getNumOperands() - 1).getImm(),
                      ShuffleMask);
    DestName = getRegName(MI->getOperand(0).getReg());
    break;

  case X86::MOVSDrr:
  case X86::VMOVSDrr:
    Src2Name = getRegName(MI->getOperand(2).getReg());
    Src1Name = getRegName(MI->getOperand(1).getReg());
    // FALL THROUGH.
  case X86::MOVSDrm:
  case X86::VMOVSDrm:
    DecodeScalarMoveMask(MVT::v2f64, nullptr == Src2Name, ShuffleMask);
    DestName = getRegName(MI->getOperand(0).getReg());
    break;

  case X86::MOVSSrr:
  case X86::VMOVSSrr:
    Src2Name = getRegName(MI->getOperand(2).getReg());
    Src1Name = getRegName(MI->getOperand(1).getReg());
    // FALL THROUGH.
  case X86::MOVSSrm:
  case X86::VMOVSSrm:
    DecodeScalarMoveMask(MVT::v4f32, nullptr == Src2Name, ShuffleMask);
    DestName = getRegName(MI->getOperand(0).getReg());
    break;

  case X86::MOVPQI2QIrr:
  case X86::MOVZPQILo2PQIrr:
  case X86::VMOVPQI2QIrr:
  case X86::VMOVZPQILo2PQIrr:
  case X86::VMOVZPQILo2PQIZrr:
    Src1Name = getRegName(MI->getOperand(1).getReg());
  // FALL THROUGH.
  case X86::MOVQI2PQIrm:
  case X86::MOVZQI2PQIrm:
  case X86::MOVZPQILo2PQIrm:
  case X86::VMOVQI2PQIrm:
  case X86::VMOVZQI2PQIrm:
  case X86::VMOVZPQILo2PQIrm:
  case X86::VMOVZPQILo2PQIZrm:
    DecodeZeroMoveLowMask(MVT::v2i64, ShuffleMask);
    DestName = getRegName(MI->getOperand(0).getReg());
    break;

  case X86::MOVDI2PDIrm:
  case X86::VMOVDI2PDIrm:
    DecodeZeroMoveLowMask(MVT::v4i32, ShuffleMask);
    DestName = getRegName(MI->getOperand(0).getReg());
    break;

  case X86::EXTRQI:
    if (MI->getOperand(2).isImm() &&
        MI->getOperand(3).isImm())
      DecodeEXTRQIMask(MI->getOperand(2).getImm(),
                       MI->getOperand(3).getImm(),
                       ShuffleMask);

    DestName = getRegName(MI->getOperand(0).getReg());
    Src1Name = getRegName(MI->getOperand(1).getReg());
    break;

  case X86::INSERTQI:
    if (MI->getOperand(3).isImm() &&
        MI->getOperand(4).isImm())
      DecodeINSERTQIMask(MI->getOperand(3).getImm(),
                         MI->getOperand(4).getImm(),
                         ShuffleMask);

    DestName = getRegName(MI->getOperand(0).getReg());
    Src1Name = getRegName(MI->getOperand(1).getReg());
    Src2Name = getRegName(MI->getOperand(2).getReg());
    break;

  case X86::PMOVZXBWrr:
  case X86::PMOVZXBDrr:
  case X86::PMOVZXBQrr:
  case X86::PMOVZXWDrr:
  case X86::PMOVZXWQrr:
  case X86::PMOVZXDQrr:
  case X86::VPMOVZXBWrr:
  case X86::VPMOVZXBDrr:
  case X86::VPMOVZXBQrr:
  case X86::VPMOVZXWDrr:
  case X86::VPMOVZXWQrr:
  case X86::VPMOVZXDQrr:
  case X86::VPMOVZXBWYrr:
  case X86::VPMOVZXBDYrr:
  case X86::VPMOVZXBQYrr:
  case X86::VPMOVZXWDYrr:
  case X86::VPMOVZXWQYrr:
  case X86::VPMOVZXDQYrr:
    Src1Name = getRegName(MI->getOperand(1).getReg());
  // FALL THROUGH.
  case X86::PMOVZXBWrm:
  case X86::PMOVZXBDrm:
  case X86::PMOVZXBQrm:
  case X86::PMOVZXWDrm:
  case X86::PMOVZXWQrm:
  case X86::PMOVZXDQrm:
  case X86::VPMOVZXBWrm:
  case X86::VPMOVZXBDrm:
  case X86::VPMOVZXBQrm:
  case X86::VPMOVZXWDrm:
  case X86::VPMOVZXWQrm:
  case X86::VPMOVZXDQrm:
  case X86::VPMOVZXBWYrm:
  case X86::VPMOVZXBDYrm:
  case X86::VPMOVZXBQYrm:
  case X86::VPMOVZXWDYrm:
  case X86::VPMOVZXWQYrm:
  case X86::VPMOVZXDQYrm: {
    MVT SrcVT, DstVT;
    getZeroExtensionTypes(MI, SrcVT, DstVT);
    DecodeZeroExtendMask(SrcVT, DstVT, ShuffleMask);
    DestName = getRegName(MI->getOperand(0).getReg());
  } break;
  }

  // The only comments we decode are shuffles, so give up if we were unable to
  // decode a shuffle mask.
  if (ShuffleMask.empty())
    return false;

  if (!DestName) DestName = Src1Name;
  OS << (DestName ? DestName : "mem") << " = ";

  // If the two sources are the same, canonicalize the input elements to be
  // from the first src so that we get larger element spans.
  if (Src1Name == Src2Name) {
    for (unsigned i = 0, e = ShuffleMask.size(); i != e; ++i) {
      if ((int)ShuffleMask[i] >= 0 && // Not sentinel.
          ShuffleMask[i] >= (int)e)   // From second mask.
        ShuffleMask[i] -= e;
    }
  }

  // The shuffle mask specifies which elements of the src1/src2 fill in the
  // destination, with a few sentinel values.  Loop through and print them
  // out.
  for (unsigned i = 0, e = ShuffleMask.size(); i != e; ++i) {
    if (i != 0)
      OS << ',';
    if (ShuffleMask[i] == SM_SentinelZero) {
      OS << "zero";
      continue;
    }

    // Otherwise, it must come from src1 or src2.  Print the span of elements
    // that comes from this src.
    bool isSrc1 = ShuffleMask[i] < (int)ShuffleMask.size();
    const char *SrcName = isSrc1 ? Src1Name : Src2Name;
    OS << (SrcName ? SrcName : "mem") << '[';
    bool IsFirst = true;
    while (i != e && (int)ShuffleMask[i] != SM_SentinelZero &&
           (ShuffleMask[i] < (int)ShuffleMask.size()) == isSrc1) {
      if (!IsFirst)
        OS << ',';
      else
        IsFirst = false;
      if (ShuffleMask[i] == SM_SentinelUndef)
        OS << "u";
      else
        OS << ShuffleMask[i] % ShuffleMask.size();
      ++i;
    }
    OS << ']';
    --i; // For loop increments element #.
  }
  //MI->print(OS, 0);
  OS << "\n";

  // We successfully added a comment to this instruction.
  return true;
}
@


1.1.1.1
log
@Use the space freed up by sparc and zaurus to import LLVM.

ok hackroom@@
@
text
@@


1.1.1.2
log
@Import LLVM 3.9.1 including clang and lld.
@
text
@a23 137
#define CASE_SSE_INS_COMMON(Inst, src)            \
  case X86::Inst##src:

#define CASE_AVX_INS_COMMON(Inst, Suffix, src)    \
  case X86::V##Inst##Suffix##src:

#define CASE_MASK_INS_COMMON(Inst, Suffix, src)   \
  case X86::V##Inst##Suffix##src##k:

#define CASE_MASKZ_INS_COMMON(Inst, Suffix, src)  \
  case X86::V##Inst##Suffix##src##kz:

#define CASE_AVX512_INS_COMMON(Inst, Suffix, src) \
  CASE_AVX_INS_COMMON(Inst, Suffix, src)          \
  CASE_MASK_INS_COMMON(Inst, Suffix, src)         \
  CASE_MASKZ_INS_COMMON(Inst, Suffix, src)

#define CASE_MOVDUP(Inst, src)                    \
  CASE_AVX512_INS_COMMON(Inst, Z, r##src)         \
  CASE_AVX512_INS_COMMON(Inst, Z256, r##src)      \
  CASE_AVX512_INS_COMMON(Inst, Z128, r##src)      \
  CASE_AVX_INS_COMMON(Inst, , r##src)             \
  CASE_AVX_INS_COMMON(Inst, Y, r##src)            \
  CASE_SSE_INS_COMMON(Inst, r##src)

#define CASE_MASK_MOVDUP(Inst, src)               \
  CASE_MASK_INS_COMMON(Inst, Z, r##src)           \
  CASE_MASK_INS_COMMON(Inst, Z256, r##src)        \
  CASE_MASK_INS_COMMON(Inst, Z128, r##src)

#define CASE_MASKZ_MOVDUP(Inst, src)              \
  CASE_MASKZ_INS_COMMON(Inst, Z, r##src)          \
  CASE_MASKZ_INS_COMMON(Inst, Z256, r##src)       \
  CASE_MASKZ_INS_COMMON(Inst, Z128, r##src)

#define CASE_PMOVZX(Inst, src)                    \
  CASE_AVX512_INS_COMMON(Inst, Z, r##src)         \
  CASE_AVX512_INS_COMMON(Inst, Z256, r##src)      \
  CASE_AVX512_INS_COMMON(Inst, Z128, r##src)      \
  CASE_AVX_INS_COMMON(Inst, , r##src)             \
  CASE_AVX_INS_COMMON(Inst, Y, r##src)            \
  CASE_SSE_INS_COMMON(Inst, r##src)

#define CASE_MASK_PMOVZX(Inst, src)               \
  CASE_MASK_INS_COMMON(Inst, Z, r##src)           \
  CASE_MASK_INS_COMMON(Inst, Z256, r##src)        \
  CASE_MASK_INS_COMMON(Inst, Z128, r##src)

#define CASE_MASKZ_PMOVZX(Inst, src)              \
  CASE_MASKZ_INS_COMMON(Inst, Z, r##src)          \
  CASE_MASKZ_INS_COMMON(Inst, Z256, r##src)       \
  CASE_MASKZ_INS_COMMON(Inst, Z128, r##src)

#define CASE_UNPCK(Inst, src)                     \
  CASE_AVX512_INS_COMMON(Inst, Z, r##src)         \
  CASE_AVX512_INS_COMMON(Inst, Z256, r##src)      \
  CASE_AVX512_INS_COMMON(Inst, Z128, r##src)      \
  CASE_AVX_INS_COMMON(Inst, , r##src)             \
  CASE_AVX_INS_COMMON(Inst, Y, r##src)            \
  CASE_SSE_INS_COMMON(Inst, r##src)

#define CASE_MASK_UNPCK(Inst, src)                \
  CASE_MASK_INS_COMMON(Inst, Z, r##src)           \
  CASE_MASK_INS_COMMON(Inst, Z256, r##src)        \
  CASE_MASK_INS_COMMON(Inst, Z128, r##src)

#define CASE_MASKZ_UNPCK(Inst, src)               \
  CASE_MASKZ_INS_COMMON(Inst, Z, r##src)          \
  CASE_MASKZ_INS_COMMON(Inst, Z256, r##src)       \
  CASE_MASKZ_INS_COMMON(Inst, Z128, r##src)

#define CASE_SHUF(Inst, suf)                      \
  CASE_AVX512_INS_COMMON(Inst, Z, suf)            \
  CASE_AVX512_INS_COMMON(Inst, Z256, suf)         \
  CASE_AVX512_INS_COMMON(Inst, Z128, suf)         \
  CASE_AVX_INS_COMMON(Inst, , suf)                \
  CASE_AVX_INS_COMMON(Inst, Y, suf)               \
  CASE_SSE_INS_COMMON(Inst, suf)

#define CASE_MASK_SHUF(Inst, src)                 \
  CASE_MASK_INS_COMMON(Inst, Z, r##src##i)        \
  CASE_MASK_INS_COMMON(Inst, Z256, r##src##i)     \
  CASE_MASK_INS_COMMON(Inst, Z128, r##src##i)

#define CASE_MASKZ_SHUF(Inst, src)                \
  CASE_MASKZ_INS_COMMON(Inst, Z, r##src##i)       \
  CASE_MASKZ_INS_COMMON(Inst, Z256, r##src##i)    \
  CASE_MASKZ_INS_COMMON(Inst, Z128, r##src##i)

#define CASE_VPERMILPI(Inst, src)                 \
  CASE_AVX512_INS_COMMON(Inst, Z, src##i)         \
  CASE_AVX512_INS_COMMON(Inst, Z256, src##i)      \
  CASE_AVX512_INS_COMMON(Inst, Z128, src##i)      \
  CASE_AVX_INS_COMMON(Inst, , src##i)             \
  CASE_AVX_INS_COMMON(Inst, Y, src##i)

#define CASE_MASK_VPERMILPI(Inst, src)            \
  CASE_MASK_INS_COMMON(Inst, Z, src##i)           \
  CASE_MASK_INS_COMMON(Inst, Z256, src##i)        \
  CASE_MASK_INS_COMMON(Inst, Z128, src##i)

#define CASE_MASKZ_VPERMILPI(Inst, src)           \
  CASE_MASKZ_INS_COMMON(Inst, Z, src##i)          \
  CASE_MASKZ_INS_COMMON(Inst, Z256, src##i)       \
  CASE_MASKZ_INS_COMMON(Inst, Z128, src##i)

#define CASE_VPERM(Inst, src)                     \
  CASE_AVX512_INS_COMMON(Inst, Z, src##i)         \
  CASE_AVX512_INS_COMMON(Inst, Z256, src##i)      \
  CASE_AVX_INS_COMMON(Inst, Y, src##i)

#define CASE_MASK_VPERM(Inst, src)                \
  CASE_MASK_INS_COMMON(Inst, Z, src##i)           \
  CASE_MASK_INS_COMMON(Inst, Z256, src##i)

#define CASE_MASKZ_VPERM(Inst, src)               \
  CASE_MASKZ_INS_COMMON(Inst, Z, src##i)          \
  CASE_MASKZ_INS_COMMON(Inst, Z256, src##i)

#define CASE_VSHUF(Inst, src)                          \
  CASE_AVX512_INS_COMMON(SHUFF##Inst, Z, r##src##i)    \
  CASE_AVX512_INS_COMMON(SHUFI##Inst, Z, r##src##i)    \
  CASE_AVX512_INS_COMMON(SHUFF##Inst, Z256, r##src##i) \
  CASE_AVX512_INS_COMMON(SHUFI##Inst, Z256, r##src##i)

#define CASE_MASK_VSHUF(Inst, src)                    \
  CASE_MASK_INS_COMMON(SHUFF##Inst, Z, r##src##i)     \
  CASE_MASK_INS_COMMON(SHUFI##Inst, Z, r##src##i)     \
  CASE_MASK_INS_COMMON(SHUFF##Inst, Z256, r##src##i)  \
  CASE_MASK_INS_COMMON(SHUFI##Inst, Z256, r##src##i)

#define CASE_MASKZ_VSHUF(Inst, src)                   \
  CASE_MASKZ_INS_COMMON(SHUFF##Inst, Z, r##src##i)    \
  CASE_MASKZ_INS_COMMON(SHUFI##Inst, Z, r##src##i)    \
  CASE_MASKZ_INS_COMMON(SHUFF##Inst, Z256, r##src##i) \
  CASE_MASKZ_INS_COMMON(SHUFI##Inst, Z256, r##src##i)

d44 5
a48 2
/// \brief Extracts the dst type for a given zero extension instruction.
static MVT getZeroExtensionResultType(const MCInst *MI) {
d52 75
a126 18
  // zero extension to i16
  CASE_PMOVZX(PMOVZXBW, m)
  CASE_PMOVZX(PMOVZXBW, r)
    return getRegOperandVectorVT(MI, MVT::i16, 0);
  // zero extension to i32
  CASE_PMOVZX(PMOVZXBD, m)
  CASE_PMOVZX(PMOVZXBD, r)
  CASE_PMOVZX(PMOVZXWD, m)
  CASE_PMOVZX(PMOVZXWD, r)
    return getRegOperandVectorVT(MI, MVT::i32, 0);
  // zero extension to i64
  CASE_PMOVZX(PMOVZXBQ, m)
  CASE_PMOVZX(PMOVZXBQ, r)
  CASE_PMOVZX(PMOVZXWQ, m)
  CASE_PMOVZX(PMOVZXWQ, r)
  CASE_PMOVZX(PMOVZXDQ, m)
  CASE_PMOVZX(PMOVZXDQ, r)
    return getRegOperandVectorVT(MI, MVT::i64, 0);
d130 10
a139 4
/// Wraps the destination register name with AVX512 mask/maskz filtering.
static std::string getMaskName(const MCInst *MI, const char *DestName,
                               const char *(*getRegName)(unsigned)) {
  std::string OpMaskName(DestName);
d141 30
a170 2
  bool MaskWithZero = false;
  const char *MaskRegName = nullptr;
d172 10
d184 11
a194 129
    return OpMaskName;
  CASE_MASKZ_MOVDUP(MOVDDUP, m)
  CASE_MASKZ_MOVDUP(MOVDDUP, r)
  CASE_MASKZ_MOVDUP(MOVSHDUP, m)
  CASE_MASKZ_MOVDUP(MOVSHDUP, r)
  CASE_MASKZ_MOVDUP(MOVSLDUP, m)
  CASE_MASKZ_MOVDUP(MOVSLDUP, r)
  CASE_MASKZ_PMOVZX(PMOVZXBD, m)
  CASE_MASKZ_PMOVZX(PMOVZXBD, r)
  CASE_MASKZ_PMOVZX(PMOVZXBQ, m)
  CASE_MASKZ_PMOVZX(PMOVZXBQ, r)
  CASE_MASKZ_PMOVZX(PMOVZXBW, m)
  CASE_MASKZ_PMOVZX(PMOVZXBW, r)
  CASE_MASKZ_PMOVZX(PMOVZXDQ, m)
  CASE_MASKZ_PMOVZX(PMOVZXDQ, r)
  CASE_MASKZ_PMOVZX(PMOVZXWD, m)
  CASE_MASKZ_PMOVZX(PMOVZXWD, r)
  CASE_MASKZ_PMOVZX(PMOVZXWQ, m)
  CASE_MASKZ_PMOVZX(PMOVZXWQ, r)
  CASE_MASKZ_UNPCK(PUNPCKHBW, m)
  CASE_MASKZ_UNPCK(PUNPCKHBW, r)
  CASE_MASKZ_UNPCK(PUNPCKHWD, m)
  CASE_MASKZ_UNPCK(PUNPCKHWD, r)
  CASE_MASKZ_UNPCK(PUNPCKHDQ, m)
  CASE_MASKZ_UNPCK(PUNPCKHDQ, r)
  CASE_MASKZ_UNPCK(PUNPCKLBW, m)
  CASE_MASKZ_UNPCK(PUNPCKLBW, r)
  CASE_MASKZ_UNPCK(PUNPCKLWD, m)
  CASE_MASKZ_UNPCK(PUNPCKLWD, r)
  CASE_MASKZ_UNPCK(PUNPCKLDQ, m)
  CASE_MASKZ_UNPCK(PUNPCKLDQ, r)
  CASE_MASKZ_UNPCK(UNPCKHPD, m)
  CASE_MASKZ_UNPCK(UNPCKHPD, r)
  CASE_MASKZ_UNPCK(UNPCKHPS, m)
  CASE_MASKZ_UNPCK(UNPCKHPS, r)
  CASE_MASKZ_UNPCK(UNPCKLPD, m)
  CASE_MASKZ_UNPCK(UNPCKLPD, r)
  CASE_MASKZ_UNPCK(UNPCKLPS, m)
  CASE_MASKZ_UNPCK(UNPCKLPS, r)
  CASE_MASKZ_SHUF(PALIGNR, r)
  CASE_MASKZ_SHUF(PALIGNR, m)
  CASE_MASKZ_SHUF(SHUFPD, m)
  CASE_MASKZ_SHUF(SHUFPD, r)
  CASE_MASKZ_SHUF(SHUFPS, m)
  CASE_MASKZ_SHUF(SHUFPS, r)
  CASE_MASKZ_VPERMILPI(PERMILPD, m)
  CASE_MASKZ_VPERMILPI(PERMILPD, r)
  CASE_MASKZ_VPERMILPI(PERMILPS, m)
  CASE_MASKZ_VPERMILPI(PERMILPS, r)
  CASE_MASKZ_VPERMILPI(PSHUFD, m)
  CASE_MASKZ_VPERMILPI(PSHUFD, r)
  CASE_MASKZ_VPERMILPI(PSHUFHW, m)
  CASE_MASKZ_VPERMILPI(PSHUFHW, r)
  CASE_MASKZ_VPERMILPI(PSHUFLW, m)
  CASE_MASKZ_VPERMILPI(PSHUFLW, r)
  CASE_MASKZ_VPERM(PERMPD, m)
  CASE_MASKZ_VPERM(PERMPD, r)
  CASE_MASKZ_VPERM(PERMQ, m)
  CASE_MASKZ_VPERM(PERMQ, r)
  CASE_MASKZ_VSHUF(64X2, m)
  CASE_MASKZ_VSHUF(64X2, r)
  CASE_MASKZ_VSHUF(32X4, m)
  CASE_MASKZ_VSHUF(32X4, r)
    MaskWithZero = true;
    MaskRegName = getRegName(MI->getOperand(1).getReg());
    break;
  CASE_MASK_MOVDUP(MOVDDUP, m)
  CASE_MASK_MOVDUP(MOVDDUP, r)
  CASE_MASK_MOVDUP(MOVSHDUP, m)
  CASE_MASK_MOVDUP(MOVSHDUP, r)
  CASE_MASK_MOVDUP(MOVSLDUP, m)
  CASE_MASK_MOVDUP(MOVSLDUP, r)
  CASE_MASK_PMOVZX(PMOVZXBD, m)
  CASE_MASK_PMOVZX(PMOVZXBD, r)
  CASE_MASK_PMOVZX(PMOVZXBQ, m)
  CASE_MASK_PMOVZX(PMOVZXBQ, r)
  CASE_MASK_PMOVZX(PMOVZXBW, m)
  CASE_MASK_PMOVZX(PMOVZXBW, r)
  CASE_MASK_PMOVZX(PMOVZXDQ, m)
  CASE_MASK_PMOVZX(PMOVZXDQ, r)
  CASE_MASK_PMOVZX(PMOVZXWD, m)
  CASE_MASK_PMOVZX(PMOVZXWD, r)
  CASE_MASK_PMOVZX(PMOVZXWQ, m)
  CASE_MASK_PMOVZX(PMOVZXWQ, r)
  CASE_MASK_UNPCK(PUNPCKHBW, m)
  CASE_MASK_UNPCK(PUNPCKHBW, r)
  CASE_MASK_UNPCK(PUNPCKHWD, m)
  CASE_MASK_UNPCK(PUNPCKHWD, r)
  CASE_MASK_UNPCK(PUNPCKHDQ, m)
  CASE_MASK_UNPCK(PUNPCKHDQ, r)
  CASE_MASK_UNPCK(PUNPCKLBW, m)
  CASE_MASK_UNPCK(PUNPCKLBW, r)
  CASE_MASK_UNPCK(PUNPCKLWD, m)
  CASE_MASK_UNPCK(PUNPCKLWD, r)
  CASE_MASK_UNPCK(PUNPCKLDQ, m)
  CASE_MASK_UNPCK(PUNPCKLDQ, r)
  CASE_MASK_UNPCK(UNPCKHPD, m)
  CASE_MASK_UNPCK(UNPCKHPD, r)
  CASE_MASK_UNPCK(UNPCKHPS, m)
  CASE_MASK_UNPCK(UNPCKHPS, r)
  CASE_MASK_UNPCK(UNPCKLPD, m)
  CASE_MASK_UNPCK(UNPCKLPD, r)
  CASE_MASK_UNPCK(UNPCKLPS, m)
  CASE_MASK_UNPCK(UNPCKLPS, r)
  CASE_MASK_SHUF(PALIGNR, r)
  CASE_MASK_SHUF(PALIGNR, m)
  CASE_MASK_SHUF(SHUFPD, m)
  CASE_MASK_SHUF(SHUFPD, r)
  CASE_MASK_SHUF(SHUFPS, m)
  CASE_MASK_SHUF(SHUFPS, r)
  CASE_MASK_VPERMILPI(PERMILPD, m)
  CASE_MASK_VPERMILPI(PERMILPD, r)
  CASE_MASK_VPERMILPI(PERMILPS, m)
  CASE_MASK_VPERMILPI(PERMILPS, r)
  CASE_MASK_VPERMILPI(PSHUFD, m)
  CASE_MASK_VPERMILPI(PSHUFD, r)
  CASE_MASK_VPERMILPI(PSHUFHW, m)
  CASE_MASK_VPERMILPI(PSHUFHW, r)
  CASE_MASK_VPERMILPI(PSHUFLW, m)
  CASE_MASK_VPERMILPI(PSHUFLW, r)
  CASE_MASK_VPERM(PERMPD, m)
  CASE_MASK_VPERM(PERMPD, r)
  CASE_MASK_VPERM(PERMQ, m)
  CASE_MASK_VPERM(PERMQ, r)
  CASE_MASK_VSHUF(64X2, m)
  CASE_MASK_VSHUF(64X2, r)
  CASE_MASK_VSHUF(32X4, m)
  CASE_MASK_VSHUF(32X4, r)
    MaskRegName = getRegName(MI->getOperand(2).getReg());
a196 11

  // MASK: zmmX {%kY}
  OpMaskName += " {%";
  OpMaskName += MaskRegName;
  OpMaskName += "}";

  // MASKZ: zmmX {%kY} {z}
  if (MaskWithZero)
    OpMaskName += " {z}";

  return OpMaskName;
a210 2
  unsigned NumOperands = MI->getNumOperands();
  bool RegForm = false;
d225 1
a225 1
    if (MI->getOperand(NumOperands - 1).isImm())
d227 1
a227 1
                      MI->getOperand(NumOperands - 1).getImm(),
d241 1
a241 1
    if (MI->getOperand(NumOperands - 1).isImm())
d243 1
a243 1
                      MI->getOperand(NumOperands - 1).getImm(),
d257 1
a257 1
    if (MI->getOperand(NumOperands - 1).isImm())
d259 1
a259 1
                      MI->getOperand(NumOperands - 1).getImm(),
d271 1
a271 1
    if (MI->getOperand(NumOperands - 1).isImm())
d273 1
a273 1
                      MI->getOperand(NumOperands - 1).getImm(),
a280 1
  case X86::VINSERTPSzrr:
a284 1
  case X86::VINSERTPSzrm:
d287 2
a288 2
    if (MI->getOperand(NumOperands - 1).isImm())
      DecodeINSERTPSMask(MI->getOperand(NumOperands - 1).getImm(),
a309 32
  case X86::MOVHPDrm:
  case X86::VMOVHPDrm:
  case X86::VMOVHPDZ128rm:
    Src1Name = getRegName(MI->getOperand(1).getReg());
    DestName = getRegName(MI->getOperand(0).getReg());
    DecodeInsertElementMask(MVT::v2f64, 1, 1, ShuffleMask);
    break;

  case X86::MOVHPSrm:
  case X86::VMOVHPSrm:
  case X86::VMOVHPSZ128rm:
    Src1Name = getRegName(MI->getOperand(1).getReg());
    DestName = getRegName(MI->getOperand(0).getReg());
    DecodeInsertElementMask(MVT::v4f32, 2, 2, ShuffleMask);
    break;

  case X86::MOVLPDrm:
  case X86::VMOVLPDrm:
  case X86::VMOVLPDZ128rm:
    Src1Name = getRegName(MI->getOperand(1).getReg());
    DestName = getRegName(MI->getOperand(0).getReg());
    DecodeInsertElementMask(MVT::v2f64, 0, 1, ShuffleMask);
    break;

  case X86::MOVLPSrm:
  case X86::VMOVLPSrm:
  case X86::VMOVLPSZ128rm:
    Src1Name = getRegName(MI->getOperand(1).getReg());
    DestName = getRegName(MI->getOperand(0).getReg());
    DecodeInsertElementMask(MVT::v4f32, 0, 2, ShuffleMask);
    break;

d311 1
a311 1
    Src1Name = getRegName(MI->getOperand(NumOperands - 1).getReg());
d319 1
a319 1
    Src1Name = getRegName(MI->getOperand(NumOperands - 1).getReg());
d327 1
a327 1
    Src1Name = getRegName(MI->getOperand(NumOperands - 1).getReg());
d337 1
a337 7
  case X86::VPSLLDQZ128rr:
  case X86::VPSLLDQZ256rr:
  case X86::VPSLLDQZ512rr:
    Src1Name = getRegName(MI->getOperand(1).getReg());
  case X86::VPSLLDQZ128rm:
  case X86::VPSLLDQZ256rm:
  case X86::VPSLLDQZ512rm:
d339 1
a339 1
    if (MI->getOperand(NumOperands - 1).isImm())
d341 1
a341 1
                       MI->getOperand(NumOperands - 1).getImm(),
d348 1
a348 7
  case X86::VPSRLDQZ128rr:
  case X86::VPSRLDQZ256rr:
  case X86::VPSRLDQZ512rr:
    Src1Name = getRegName(MI->getOperand(1).getReg());
  case X86::VPSRLDQZ128rm:
  case X86::VPSRLDQZ256rm:
  case X86::VPSRLDQZ512rm:
d350 1
a350 1
    if (MI->getOperand(NumOperands - 1).isImm())
d352 1
a352 1
                       MI->getOperand(NumOperands - 1).getImm(),
d356 9
a364 6
  CASE_SHUF(PALIGNR, rri)
    Src1Name = getRegName(MI->getOperand(NumOperands - 2).getReg());
    RegForm = true;
    // FALL THROUGH.
  CASE_SHUF(PALIGNR, rmi)
    Src2Name = getRegName(MI->getOperand(NumOperands-(RegForm?3:7)).getReg());
d366 1
a366 1
    if (MI->getOperand(NumOperands - 1).isImm())
d368 1
a368 1
                        MI->getOperand(NumOperands - 1).getImm(),
d372 4
a375 2
  CASE_SHUF(PSHUFD, ri)
    Src1Name = getRegName(MI->getOperand(NumOperands - 2).getReg());
d377 3
a379 1
  CASE_SHUF(PSHUFD, mi)
d381 1
a381 1
    if (MI->getOperand(NumOperands - 1).isImm())
d383 1
a383 1
                      MI->getOperand(NumOperands - 1).getImm(),
d387 4
a390 2
  CASE_SHUF(PSHUFHW, ri)
    Src1Name = getRegName(MI->getOperand(NumOperands - 2).getReg());
d392 3
a394 1
  CASE_SHUF(PSHUFHW, mi)
d396 1
a396 1
    if (MI->getOperand(NumOperands - 1).isImm())
d398 1
a398 1
                        MI->getOperand(NumOperands - 1).getImm(),
d402 4
a405 2
  CASE_SHUF(PSHUFLW, ri)
    Src1Name = getRegName(MI->getOperand(NumOperands - 2).getReg());
d407 3
a409 1
  CASE_SHUF(PSHUFLW, mi)
d411 1
a411 1
    if (MI->getOperand(NumOperands - 1).isImm())
d413 1
a413 1
                        MI->getOperand(NumOperands - 1).getImm(),
d422 1
a422 1
    if (MI->getOperand(NumOperands - 1).isImm())
d424 1
a424 1
                      MI->getOperand(NumOperands - 1).getImm(),
d438 1
a438 2
    Src2Name = getRegName(MI->getOperand(NumOperands - 1).getReg());
    RegForm = true;
d442 1
a442 1
    Src1Name = getRegName(MI->getOperand(NumOperands-(RegForm?2:6)).getReg());
d449 1
a449 2
    Src2Name = getRegName(MI->getOperand(NumOperands - 1).getReg());
    RegForm = true;
d453 1
a453 1
    Src1Name = getRegName(MI->getOperand(NumOperands-(RegForm?2:6)).getReg());
d460 1
a460 2
    Src2Name = getRegName(MI->getOperand(NumOperands - 1).getReg());
    RegForm = true;
d464 1
a464 1
    Src1Name = getRegName(MI->getOperand(NumOperands-(RegForm?2:6)).getReg());
d470 1
a470 2
    Src2Name = getRegName(MI->getOperand(NumOperands - 1).getReg());
    RegForm = true;
d473 1
a473 1
    Src1Name = getRegName(MI->getOperand(NumOperands-(RegForm?2:6)).getReg());
d480 1
a480 2
    Src2Name = getRegName(MI->getOperand(NumOperands - 1).getReg());
    RegForm = true;
d484 1
a484 1
    Src1Name = getRegName(MI->getOperand(NumOperands-(RegForm?2:6)).getReg());
d491 1
a491 2
    Src2Name = getRegName(MI->getOperand(NumOperands - 1).getReg());
    RegForm = true;
d495 1
a495 1
    Src1Name = getRegName(MI->getOperand(NumOperands-(RegForm?2:6)).getReg());
d502 1
a502 2
    Src2Name = getRegName(MI->getOperand(NumOperands - 1).getReg());
    RegForm = true;
d506 1
a506 1
    Src1Name = getRegName(MI->getOperand(NumOperands-(RegForm?2:6)).getReg());
d512 1
a512 2
    Src2Name = getRegName(MI->getOperand(NumOperands - 1).getReg());
    RegForm = true;
d515 1
a515 1
    Src1Name = getRegName(MI->getOperand(NumOperands-(RegForm?2:6)).getReg());
d520 2
a521 3
  CASE_SHUF(SHUFPD, rri)
    Src2Name = getRegName(MI->getOperand(NumOperands - 2).getReg());
    RegForm = true;
d523 2
a524 2
  CASE_SHUF(SHUFPD, rmi)
    if (MI->getOperand(NumOperands - 1).isImm())
d526 1
a526 1
                      MI->getOperand(NumOperands - 1).getImm(),
d528 1
a528 1
    Src1Name = getRegName(MI->getOperand(NumOperands-(RegForm?3:7)).getReg());
d532 2
a533 3
  CASE_SHUF(SHUFPS, rri)
    Src2Name = getRegName(MI->getOperand(NumOperands - 2).getReg());
    RegForm = true;
d535 2
a536 2
  CASE_SHUF(SHUFPS, rmi)
    if (MI->getOperand(NumOperands - 1).isImm())
d538 1
a538 1
                      MI->getOperand(NumOperands - 1).getImm(),
d540 1
a540 1
    Src1Name = getRegName(MI->getOperand(NumOperands-(RegForm?3:7)).getReg());
a544 3
    Src2Name = getRegName(MI->getOperand(NumOperands - 2).getReg());
    RegForm = true;
    // FALL THROUGH.
a545 7
    decodeVSHUF64x2FamilyMask(getRegOperandVectorVT(MI, MVT::i64, 0),
                              MI->getOperand(NumOperands - 1).getImm(),
                              ShuffleMask);
    Src1Name = getRegName(MI->getOperand(NumOperands-(RegForm?3:7)).getReg());
    DestName = getRegName(MI->getOperand(0).getReg());
    break;

d547 6
a552 6
    Src2Name = getRegName(MI->getOperand(NumOperands - 2).getReg());
    RegForm = true;
    // FALL THROUGH.
  CASE_VSHUF(32X4, m)
    decodeVSHUF64x2FamilyMask(getRegOperandVectorVT(MI, MVT::i32, 0),
                              MI->getOperand(NumOperands - 1).getImm(),
a553 1
    Src1Name = getRegName(MI->getOperand(NumOperands-(RegForm?3:7)).getReg());
d555 8
d564 1
d567 1
a567 2
    Src2Name = getRegName(MI->getOperand(NumOperands - 1).getReg());
    RegForm = true;
d571 1
a571 1
    Src1Name = getRegName(MI->getOperand(NumOperands-(RegForm?2:6)).getReg());
d576 1
a576 2
    Src2Name = getRegName(MI->getOperand(NumOperands - 1).getReg());
    RegForm = true;
d580 1
a580 1
    Src1Name = getRegName(MI->getOperand(NumOperands-(RegForm?2:6)).getReg());
d585 1
a585 2
    Src2Name = getRegName(MI->getOperand(NumOperands - 1).getReg());
    RegForm = true;
d589 1
a589 1
    Src1Name = getRegName(MI->getOperand(NumOperands-(RegForm?2:6)).getReg());
d594 1
a594 2
    Src2Name = getRegName(MI->getOperand(NumOperands - 1).getReg());
    RegForm = true;
d598 1
a598 1
    Src1Name = getRegName(MI->getOperand(NumOperands-(RegForm?2:6)).getReg());
d602 2
a603 2
  CASE_VPERMILPI(PERMILPS, r)
    Src1Name = getRegName(MI->getOperand(NumOperands - 2).getReg());
d605 2
a606 2
  CASE_VPERMILPI(PERMILPS, m)
    if (MI->getOperand(NumOperands - 1).isImm())
d608 1
a608 1
                      MI->getOperand(NumOperands - 1).getImm(),
d613 2
a614 2
  CASE_VPERMILPI(PERMILPD, r)
    Src1Name = getRegName(MI->getOperand(NumOperands - 2).getReg());
d616 2
a617 2
  CASE_VPERMILPI(PERMILPD, m)
    if (MI->getOperand(NumOperands - 1).isImm())
d619 1
a619 1
                      MI->getOperand(NumOperands - 1).getImm(),
d631 1
a631 1
    if (MI->getOperand(NumOperands - 1).isImm())
d633 1
a633 1
                           MI->getOperand(NumOperands - 1).getImm(),
d639 3
a641 13
  CASE_VPERM(PERMPD, r)
    Src1Name = getRegName(MI->getOperand(NumOperands - 2).getReg());
    // FALL THROUGH.
  CASE_VPERM(PERMPD, m)
    if (MI->getOperand(NumOperands - 1).isImm())
      DecodeVPERMMask(getRegOperandVectorVT(MI, MVT::f64, 0),
                      MI->getOperand(NumOperands - 1).getImm(),
                      ShuffleMask);
    DestName = getRegName(MI->getOperand(0).getReg());
    break;

  CASE_VPERM(PERMQ, r)
    Src1Name = getRegName(MI->getOperand(NumOperands - 2).getReg());
d643 4
a646 4
  CASE_VPERM(PERMQ, m)
    if (MI->getOperand(NumOperands - 1).isImm())
      DecodeVPERMMask(getRegOperandVectorVT(MI, MVT::i64, 0),
                      MI->getOperand(NumOperands - 1).getImm(),
a652 1
  case X86::VMOVSDZrr:
a657 1
  case X86::VMOVSDZrm:
a663 1
  case X86::VMOVSSZrr:
a668 1
  case X86::VMOVSSZrm:
a683 1
  case X86::VMOVQI2PQIZrm:
a692 1
  case X86::VMOVDI2PDIZrm:
d720 19
a738 10
  case X86::VBROADCASTF128:
  case X86::VBROADCASTI128:
    DecodeSubVectorBroadcast(MVT::v4f64, MVT::v2f64, ShuffleMask);
    DestName = getRegName(MI->getOperand(0).getReg());
    break;

  CASE_PMOVZX(PMOVZXBW, r)
  CASE_PMOVZX(PMOVZXBD, r)
  CASE_PMOVZX(PMOVZXBQ, r)
    Src1Name = getRegName(MI->getOperand(NumOperands - 1).getReg());
d740 21
a760 4
  CASE_PMOVZX(PMOVZXBW, m)
  CASE_PMOVZX(PMOVZXBD, m)
  CASE_PMOVZX(PMOVZXBQ, m)
    DecodeZeroExtendMask(MVT::i8, getZeroExtensionResultType(MI), ShuffleMask);
d762 1
a762 19
    break;

  CASE_PMOVZX(PMOVZXWD, r)
  CASE_PMOVZX(PMOVZXWQ, r)
    Src1Name = getRegName(MI->getOperand(NumOperands - 1).getReg());
  // FALL THROUGH.
  CASE_PMOVZX(PMOVZXWD, m)
  CASE_PMOVZX(PMOVZXWQ, m)
    DecodeZeroExtendMask(MVT::i16, getZeroExtensionResultType(MI), ShuffleMask);
    DestName = getRegName(MI->getOperand(0).getReg());
    break;

  CASE_PMOVZX(PMOVZXDQ, r)
    Src1Name = getRegName(MI->getOperand(NumOperands - 1).getReg());
  // FALL THROUGH.
  CASE_PMOVZX(PMOVZXDQ, m)
    DecodeZeroExtendMask(MVT::i32, getZeroExtensionResultType(MI), ShuffleMask);
    DestName = getRegName(MI->getOperand(0).getReg());
    break;
d771 1
a771 1
  OS << (DestName ? getMaskName(MI, DestName, getRegName) : "mem") << " = ";
@


1.1.1.3
log
@Import LLVM 4.0.0 rc1 including clang and lld to help the current
development effort on OpenBSD/arm64.
@
text
@a257 4
  CASE_MASKZ_SHUF(ALIGNQ, r)
  CASE_MASKZ_SHUF(ALIGNQ, m)
  CASE_MASKZ_SHUF(ALIGND, r)
  CASE_MASKZ_SHUF(ALIGND, m)
a279 20
  CASE_MASKZ_INS_COMMON(BROADCASTF64X2, Z128, rm)
  CASE_MASKZ_INS_COMMON(BROADCASTI64X2, Z128, rm)
  CASE_MASKZ_INS_COMMON(BROADCASTF64X2, , rm)
  CASE_MASKZ_INS_COMMON(BROADCASTI64X2, , rm)
  CASE_MASKZ_INS_COMMON(BROADCASTF64X4, , rm)
  CASE_MASKZ_INS_COMMON(BROADCASTI64X4, , rm)
  CASE_MASKZ_INS_COMMON(BROADCASTF32X4, Z256, rm)
  CASE_MASKZ_INS_COMMON(BROADCASTI32X4, Z256, rm)
  CASE_MASKZ_INS_COMMON(BROADCASTF32X4, , rm)
  CASE_MASKZ_INS_COMMON(BROADCASTI32X4, , rm)
  CASE_MASKZ_INS_COMMON(BROADCASTF32X8, , rm)
  CASE_MASKZ_INS_COMMON(BROADCASTI32X8, , rm)
  CASE_MASKZ_INS_COMMON(BROADCASTF32X2, Z256, r)
  CASE_MASKZ_INS_COMMON(BROADCASTI32X2, Z256, r)
  CASE_MASKZ_INS_COMMON(BROADCASTF32X2, Z256, m)
  CASE_MASKZ_INS_COMMON(BROADCASTI32X2, Z256, m)
  CASE_MASKZ_INS_COMMON(BROADCASTF32X2, Z, r)
  CASE_MASKZ_INS_COMMON(BROADCASTI32X2, Z, r)
  CASE_MASKZ_INS_COMMON(BROADCASTF32X2, Z, m)
  CASE_MASKZ_INS_COMMON(BROADCASTI32X2, Z, m)
a322 4
  CASE_MASK_SHUF(ALIGNQ, r)
  CASE_MASK_SHUF(ALIGNQ, m)
  CASE_MASK_SHUF(ALIGND, r)
  CASE_MASK_SHUF(ALIGND, m)
a344 20
  CASE_MASK_INS_COMMON(BROADCASTF64X2, Z128, rm)
  CASE_MASK_INS_COMMON(BROADCASTI64X2, Z128, rm)
  CASE_MASK_INS_COMMON(BROADCASTF64X2, , rm)
  CASE_MASK_INS_COMMON(BROADCASTI64X2, , rm)
  CASE_MASK_INS_COMMON(BROADCASTF64X4, , rm)
  CASE_MASK_INS_COMMON(BROADCASTI64X4, , rm)
  CASE_MASK_INS_COMMON(BROADCASTF32X4, Z256, rm)
  CASE_MASK_INS_COMMON(BROADCASTI32X4, Z256, rm)
  CASE_MASK_INS_COMMON(BROADCASTF32X4, , rm)
  CASE_MASK_INS_COMMON(BROADCASTI32X4, , rm)
  CASE_MASK_INS_COMMON(BROADCASTF32X8, , rm)
  CASE_MASK_INS_COMMON(BROADCASTI32X8, , rm)
  CASE_MASK_INS_COMMON(BROADCASTF32X2, Z256, r)
  CASE_MASK_INS_COMMON(BROADCASTI32X2, Z256, r)
  CASE_MASK_INS_COMMON(BROADCASTF32X2, Z256, m)
  CASE_MASK_INS_COMMON(BROADCASTI32X2, Z256, m)
  CASE_MASK_INS_COMMON(BROADCASTF32X2, Z, r)
  CASE_MASK_INS_COMMON(BROADCASTI32X2, Z, r)
  CASE_MASK_INS_COMMON(BROADCASTF32X2, Z, m)
  CASE_MASK_INS_COMMON(BROADCASTI32X2, Z, m)
d385 1
a385 1
    LLVM_FALLTHROUGH;
d401 1
a401 1
    LLVM_FALLTHROUGH;
d417 1
a417 1
    LLVM_FALLTHROUGH;
d432 1
a432 1
    LLVM_FALLTHROUGH;
d445 1
a445 1
  case X86::VINSERTPSZrr:
d447 1
a447 1
    LLVM_FALLTHROUGH;
d450 1
a450 1
  case X86::VINSERTPSZrm:
d510 1
a510 2
    LLVM_FALLTHROUGH;

d518 1
a518 2
    LLVM_FALLTHROUGH;

d526 1
a526 2
    LLVM_FALLTHROUGH;

d569 1
a569 2
    LLVM_FALLTHROUGH;

a578 36
  CASE_AVX512_INS_COMMON(ALIGNQ, Z, rri)
  CASE_AVX512_INS_COMMON(ALIGNQ, Z256, rri)
  CASE_AVX512_INS_COMMON(ALIGNQ, Z128, rri)
    Src1Name = getRegName(MI->getOperand(NumOperands - 2).getReg());
    RegForm = true;
    LLVM_FALLTHROUGH;

  CASE_AVX512_INS_COMMON(ALIGNQ, Z, rmi)
  CASE_AVX512_INS_COMMON(ALIGNQ, Z256, rmi)
  CASE_AVX512_INS_COMMON(ALIGNQ, Z128, rmi)
    Src2Name = getRegName(MI->getOperand(NumOperands-(RegForm?3:7)).getReg());
    DestName = getRegName(MI->getOperand(0).getReg());
    if (MI->getOperand(NumOperands - 1).isImm())
      DecodeVALIGNMask(getRegOperandVectorVT(MI, MVT::i64, 0),
                       MI->getOperand(NumOperands - 1).getImm(),
                       ShuffleMask);
    break;

  CASE_AVX512_INS_COMMON(ALIGND, Z, rri)
  CASE_AVX512_INS_COMMON(ALIGND, Z256, rri)
  CASE_AVX512_INS_COMMON(ALIGND, Z128, rri)
    Src1Name = getRegName(MI->getOperand(NumOperands - 2).getReg());
    RegForm = true;
    LLVM_FALLTHROUGH;

  CASE_AVX512_INS_COMMON(ALIGND, Z, rmi)
  CASE_AVX512_INS_COMMON(ALIGND, Z256, rmi)
  CASE_AVX512_INS_COMMON(ALIGND, Z128, rmi)
    Src2Name = getRegName(MI->getOperand(NumOperands-(RegForm?3:7)).getReg());
    DestName = getRegName(MI->getOperand(0).getReg());
    if (MI->getOperand(NumOperands - 1).isImm())
      DecodeVALIGNMask(getRegOperandVectorVT(MI, MVT::i32, 0),
                       MI->getOperand(NumOperands - 1).getImm(),
                       ShuffleMask);
    break;

d581 1
a581 2
    LLVM_FALLTHROUGH;

d592 1
a592 2
    LLVM_FALLTHROUGH;

d603 1
a603 2
    LLVM_FALLTHROUGH;

d614 1
a614 2
    LLVM_FALLTHROUGH;

d625 1
a625 2
    LLVM_FALLTHROUGH;

d635 1
a635 2
    LLVM_FALLTHROUGH;

d647 1
a647 2
    LLVM_FALLTHROUGH;

d659 1
a659 2
    LLVM_FALLTHROUGH;

d670 1
a670 2
    LLVM_FALLTHROUGH;

d681 1
a681 2
    LLVM_FALLTHROUGH;

d693 1
a693 2
    LLVM_FALLTHROUGH;

d705 1
a705 2
    LLVM_FALLTHROUGH;

d716 1
a716 2
    LLVM_FALLTHROUGH;

d726 1
a726 2
    LLVM_FALLTHROUGH;

d739 1
a739 2
    LLVM_FALLTHROUGH;

d752 1
a752 2
    LLVM_FALLTHROUGH;

d764 1
a764 2
    LLVM_FALLTHROUGH;

d776 1
a776 2
    LLVM_FALLTHROUGH;

d786 1
a786 2
    LLVM_FALLTHROUGH;

d796 1
a796 2
    LLVM_FALLTHROUGH;

d806 1
a806 2
    LLVM_FALLTHROUGH;

d815 1
a815 2
    LLVM_FALLTHROUGH;

d826 1
a826 2
    LLVM_FALLTHROUGH;

d838 1
a838 2
    LLVM_FALLTHROUGH;

d852 1
a852 2
    LLVM_FALLTHROUGH;

d863 1
a863 2
    LLVM_FALLTHROUGH;

d877 1
a877 2
    LLVM_FALLTHROUGH;

d890 1
a890 2
    LLVM_FALLTHROUGH;

d904 1
a904 2
    LLVM_FALLTHROUGH;

d906 2
d910 3
a948 2
  CASE_AVX512_INS_COMMON(BROADCASTF64X2, Z128, rm)
  CASE_AVX512_INS_COMMON(BROADCASTI64X2, Z128, rm)
a951 41
  CASE_AVX512_INS_COMMON(BROADCASTF64X2, , rm)
  CASE_AVX512_INS_COMMON(BROADCASTI64X2, , rm)
    DecodeSubVectorBroadcast(MVT::v8f64, MVT::v2f64, ShuffleMask);
    DestName = getRegName(MI->getOperand(0).getReg());
    break;
  CASE_AVX512_INS_COMMON(BROADCASTF64X4, , rm)
  CASE_AVX512_INS_COMMON(BROADCASTI64X4, , rm)
    DecodeSubVectorBroadcast(MVT::v8f64, MVT::v4f64, ShuffleMask);
    DestName = getRegName(MI->getOperand(0).getReg());
    break;
  CASE_AVX512_INS_COMMON(BROADCASTF32X4, Z256, rm)
  CASE_AVX512_INS_COMMON(BROADCASTI32X4, Z256, rm)
    DecodeSubVectorBroadcast(MVT::v8f32, MVT::v4f32, ShuffleMask);
    DestName = getRegName(MI->getOperand(0).getReg());
    break;
  CASE_AVX512_INS_COMMON(BROADCASTF32X4, , rm)
  CASE_AVX512_INS_COMMON(BROADCASTI32X4, , rm)
    DecodeSubVectorBroadcast(MVT::v16f32, MVT::v4f32, ShuffleMask);
    DestName = getRegName(MI->getOperand(0).getReg());
    break;
  CASE_AVX512_INS_COMMON(BROADCASTF32X8, , rm)
  CASE_AVX512_INS_COMMON(BROADCASTI32X8, , rm)
    DecodeSubVectorBroadcast(MVT::v16f32, MVT::v8f32, ShuffleMask);
    DestName = getRegName(MI->getOperand(0).getReg());
    break;
  CASE_AVX512_INS_COMMON(BROADCASTF32X2, Z256, r)
  CASE_AVX512_INS_COMMON(BROADCASTI32X2, Z256, r)
    Src1Name = getRegName(MI->getOperand(NumOperands - 1).getReg());
  CASE_AVX512_INS_COMMON(BROADCASTF32X2, Z256, m)
  CASE_AVX512_INS_COMMON(BROADCASTI32X2, Z256, m)
    DecodeSubVectorBroadcast(MVT::v8f32, MVT::v2f32, ShuffleMask);
    DestName = getRegName(MI->getOperand(0).getReg());
    break;
  CASE_AVX512_INS_COMMON(BROADCASTF32X2, Z, r)
  CASE_AVX512_INS_COMMON(BROADCASTI32X2, Z, r)
    Src1Name = getRegName(MI->getOperand(NumOperands - 1).getReg());
  CASE_AVX512_INS_COMMON(BROADCASTF32X2, Z, m)
  CASE_AVX512_INS_COMMON(BROADCASTI32X2, Z, m)
    DecodeSubVectorBroadcast(MVT::v16f32, MVT::v2f32, ShuffleMask);
    DestName = getRegName(MI->getOperand(0).getReg());
    break;
d957 1
a957 2
    LLVM_FALLTHROUGH;

d968 1
a968 2
    LLVM_FALLTHROUGH;

d977 1
a977 2
    LLVM_FALLTHROUGH;

@


