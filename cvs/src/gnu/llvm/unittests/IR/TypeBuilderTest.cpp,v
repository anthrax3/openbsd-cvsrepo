head	1.1;
branch	1.1.1;
access;
symbols
	OPENBSD_6_1:1.1.1.2.0.2
	OPENBSD_6_1_BASE:1.1.1.2
	LLVM_4_0_0:1.1.1.2
	LLVM_4_0_0_RC1:1.1.1.2
	LLVM_3_9_1:1.1.1.2
	LLVM_3_8_1:1.1.1.1
	LLVM:1.1.1;
locks; strict;
comment	@// @;


1.1
date	2016.09.03.22.46.55;	author pascal;	state Exp;
branches
	1.1.1.1;
next	;
commitid	piLU3CHugy63NlaI;

1.1.1.1
date	2016.09.03.22.46.55;	author pascal;	state Exp;
branches;
next	1.1.1.2;
commitid	piLU3CHugy63NlaI;

1.1.1.2
date	2017.01.14.19.55.43;	author patrick;	state Exp;
branches;
next	;
commitid	qMUxATnKgqN83Oct;


desc
@@


1.1
log
@Initial revision
@
text
@//===- llvm/unittest/TypeBuilderTest.cpp - TypeBuilder tests --------------===//
//
//                     The LLVM Compiler Infrastructure
//
// This file is distributed under the University of Illinois Open Source
// License. See LICENSE.TXT for details.
//
//===----------------------------------------------------------------------===//

#include "llvm/IR/TypeBuilder.h"
#include "llvm/ADT/ArrayRef.h"
#include "llvm/IR/LLVMContext.h"
#include "gtest/gtest.h"

using namespace llvm;

namespace {

TEST(TypeBuilderTest, Void) {
  EXPECT_EQ(Type::getVoidTy(getGlobalContext()), (TypeBuilder<void, true>::get(getGlobalContext())));
  EXPECT_EQ(Type::getVoidTy(getGlobalContext()), (TypeBuilder<void, false>::get(getGlobalContext())));
  // Special cases for C compatibility:
  EXPECT_EQ(Type::getInt8PtrTy(getGlobalContext()),
            (TypeBuilder<void*, false>::get(getGlobalContext())));
  EXPECT_EQ(Type::getInt8PtrTy(getGlobalContext()),
            (TypeBuilder<const void*, false>::get(getGlobalContext())));
  EXPECT_EQ(Type::getInt8PtrTy(getGlobalContext()),
            (TypeBuilder<volatile void*, false>::get(getGlobalContext())));
  EXPECT_EQ(Type::getInt8PtrTy(getGlobalContext()),
            (TypeBuilder<const volatile void*, false>::get(
              getGlobalContext())));
}

TEST(TypeBuilderTest, HostIntegers) {
  EXPECT_EQ(Type::getInt8Ty(getGlobalContext()), (TypeBuilder<int8_t, false>::get(getGlobalContext())));
  EXPECT_EQ(Type::getInt8Ty(getGlobalContext()), (TypeBuilder<uint8_t, false>::get(getGlobalContext())));
  EXPECT_EQ(Type::getInt16Ty(getGlobalContext()), (TypeBuilder<int16_t, false>::get(getGlobalContext())));
  EXPECT_EQ(Type::getInt16Ty(getGlobalContext()), (TypeBuilder<uint16_t, false>::get(getGlobalContext())));
  EXPECT_EQ(Type::getInt32Ty(getGlobalContext()), (TypeBuilder<int32_t, false>::get(getGlobalContext())));
  EXPECT_EQ(Type::getInt32Ty(getGlobalContext()), (TypeBuilder<uint32_t, false>::get(getGlobalContext())));
  EXPECT_EQ(Type::getInt64Ty(getGlobalContext()), (TypeBuilder<int64_t, false>::get(getGlobalContext())));
  EXPECT_EQ(Type::getInt64Ty(getGlobalContext()), (TypeBuilder<uint64_t, false>::get(getGlobalContext())));

  EXPECT_EQ(IntegerType::get(getGlobalContext(), sizeof(size_t) * CHAR_BIT),
            (TypeBuilder<size_t, false>::get(getGlobalContext())));
  EXPECT_EQ(IntegerType::get(getGlobalContext(), sizeof(ptrdiff_t) * CHAR_BIT),
            (TypeBuilder<ptrdiff_t, false>::get(getGlobalContext())));
}

TEST(TypeBuilderTest, CrossCompilableIntegers) {
  EXPECT_EQ(IntegerType::get(getGlobalContext(), 1), (TypeBuilder<types::i<1>, true>::get(getGlobalContext())));
  EXPECT_EQ(IntegerType::get(getGlobalContext(), 1), (TypeBuilder<types::i<1>, false>::get(getGlobalContext())));
  EXPECT_EQ(IntegerType::get(getGlobalContext(), 72), (TypeBuilder<types::i<72>, true>::get(getGlobalContext())));
  EXPECT_EQ(IntegerType::get(getGlobalContext(), 72), (TypeBuilder<types::i<72>, false>::get(getGlobalContext())));
}

TEST(TypeBuilderTest, Float) {
  EXPECT_EQ(Type::getFloatTy(getGlobalContext()), (TypeBuilder<float, false>::get(getGlobalContext())));
  EXPECT_EQ(Type::getDoubleTy(getGlobalContext()), (TypeBuilder<double, false>::get(getGlobalContext())));
  // long double isn't supported yet.
  EXPECT_EQ(Type::getFloatTy(getGlobalContext()), (TypeBuilder<types::ieee_float, true>::get(getGlobalContext())));
  EXPECT_EQ(Type::getFloatTy(getGlobalContext()), (TypeBuilder<types::ieee_float, false>::get(getGlobalContext())));
  EXPECT_EQ(Type::getDoubleTy(getGlobalContext()), (TypeBuilder<types::ieee_double, true>::get(getGlobalContext())));
  EXPECT_EQ(Type::getDoubleTy(getGlobalContext()), (TypeBuilder<types::ieee_double, false>::get(getGlobalContext())));
  EXPECT_EQ(Type::getX86_FP80Ty(getGlobalContext()), (TypeBuilder<types::x86_fp80, true>::get(getGlobalContext())));
  EXPECT_EQ(Type::getX86_FP80Ty(getGlobalContext()), (TypeBuilder<types::x86_fp80, false>::get(getGlobalContext())));
  EXPECT_EQ(Type::getFP128Ty(getGlobalContext()), (TypeBuilder<types::fp128, true>::get(getGlobalContext())));
  EXPECT_EQ(Type::getFP128Ty(getGlobalContext()), (TypeBuilder<types::fp128, false>::get(getGlobalContext())));
  EXPECT_EQ(Type::getPPC_FP128Ty(getGlobalContext()), (TypeBuilder<types::ppc_fp128, true>::get(getGlobalContext())));
  EXPECT_EQ(Type::getPPC_FP128Ty(getGlobalContext()), (TypeBuilder<types::ppc_fp128, false>::get(getGlobalContext())));
}

TEST(TypeBuilderTest, Derived) {
  EXPECT_EQ(PointerType::getUnqual(Type::getInt8PtrTy(getGlobalContext())),
            (TypeBuilder<int8_t**, false>::get(getGlobalContext())));
  EXPECT_EQ(ArrayType::get(Type::getInt8Ty(getGlobalContext()), 7),
            (TypeBuilder<int8_t[7], false>::get(getGlobalContext())));
  EXPECT_EQ(ArrayType::get(Type::getInt8Ty(getGlobalContext()), 0),
            (TypeBuilder<int8_t[], false>::get(getGlobalContext())));

  EXPECT_EQ(PointerType::getUnqual(Type::getInt8PtrTy(getGlobalContext())),
            (TypeBuilder<types::i<8>**, false>::get(getGlobalContext())));
  EXPECT_EQ(ArrayType::get(Type::getInt8Ty(getGlobalContext()), 7),
            (TypeBuilder<types::i<8>[7], false>::get(getGlobalContext())));
  EXPECT_EQ(ArrayType::get(Type::getInt8Ty(getGlobalContext()), 0),
            (TypeBuilder<types::i<8>[], false>::get(getGlobalContext())));

  EXPECT_EQ(PointerType::getUnqual(Type::getInt8PtrTy(getGlobalContext())),
            (TypeBuilder<types::i<8>**, true>::get(getGlobalContext())));
  EXPECT_EQ(ArrayType::get(Type::getInt8Ty(getGlobalContext()), 7),
            (TypeBuilder<types::i<8>[7], true>::get(getGlobalContext())));
  EXPECT_EQ(ArrayType::get(Type::getInt8Ty(getGlobalContext()), 0),
            (TypeBuilder<types::i<8>[], true>::get(getGlobalContext())));


  EXPECT_EQ(Type::getInt8Ty(getGlobalContext()),
            (TypeBuilder<const int8_t, false>::get(getGlobalContext())));
  EXPECT_EQ(Type::getInt8Ty(getGlobalContext()),
            (TypeBuilder<volatile int8_t, false>::get(getGlobalContext())));
  EXPECT_EQ(Type::getInt8Ty(getGlobalContext()),
            (TypeBuilder<const volatile int8_t, false>::get(getGlobalContext())));

  EXPECT_EQ(Type::getInt8Ty(getGlobalContext()),
            (TypeBuilder<const types::i<8>, false>::get(getGlobalContext())));
  EXPECT_EQ(Type::getInt8Ty(getGlobalContext()),
            (TypeBuilder<volatile types::i<8>, false>::get(getGlobalContext())));
  EXPECT_EQ(Type::getInt8Ty(getGlobalContext()),
            (TypeBuilder<const volatile types::i<8>, false>::get(getGlobalContext())));

  EXPECT_EQ(Type::getInt8Ty(getGlobalContext()),
            (TypeBuilder<const types::i<8>, true>::get(getGlobalContext())));
  EXPECT_EQ(Type::getInt8Ty(getGlobalContext()),
            (TypeBuilder<volatile types::i<8>, true>::get(getGlobalContext())));
  EXPECT_EQ(Type::getInt8Ty(getGlobalContext()),
            (TypeBuilder<const volatile types::i<8>, true>::get(getGlobalContext())));

  EXPECT_EQ(Type::getInt8PtrTy(getGlobalContext()),
            (TypeBuilder<const volatile int8_t*const volatile, false>::get(getGlobalContext())));
}

TEST(TypeBuilderTest, Functions) {
  std::vector<Type*> params;
  EXPECT_EQ(FunctionType::get(Type::getVoidTy(getGlobalContext()), params, false),
            (TypeBuilder<void(), true>::get(getGlobalContext())));
  EXPECT_EQ(FunctionType::get(Type::getInt8Ty(getGlobalContext()), params, true),
            (TypeBuilder<int8_t(...), false>::get(getGlobalContext())));
  params.push_back(TypeBuilder<int32_t*, false>::get(getGlobalContext()));
  EXPECT_EQ(FunctionType::get(Type::getInt8Ty(getGlobalContext()), params, false),
            (TypeBuilder<int8_t(const int32_t*), false>::get(getGlobalContext())));
  EXPECT_EQ(FunctionType::get(Type::getInt8Ty(getGlobalContext()), params, true),
            (TypeBuilder<int8_t(const int32_t*, ...), false>::get(getGlobalContext())));
  params.push_back(TypeBuilder<char*, false>::get(getGlobalContext()));
  EXPECT_EQ(FunctionType::get(Type::getInt8Ty(getGlobalContext()), params, false),
            (TypeBuilder<int8_t(int32_t*, void*), false>::get(getGlobalContext())));
  EXPECT_EQ(FunctionType::get(Type::getInt8Ty(getGlobalContext()), params, true),
            (TypeBuilder<int8_t(int32_t*, char*, ...), false>::get(getGlobalContext())));
  params.push_back(TypeBuilder<char, false>::get(getGlobalContext()));
  EXPECT_EQ(FunctionType::get(Type::getInt8Ty(getGlobalContext()), params, false),
            (TypeBuilder<int8_t(int32_t*, void*, char), false>::get(getGlobalContext())));
  EXPECT_EQ(FunctionType::get(Type::getInt8Ty(getGlobalContext()), params, true),
            (TypeBuilder<int8_t(int32_t*, char*, char, ...), false>::get(getGlobalContext())));
  params.push_back(TypeBuilder<char, false>::get(getGlobalContext()));
  EXPECT_EQ(FunctionType::get(Type::getInt8Ty(getGlobalContext()), params, false),
            (TypeBuilder<int8_t(int32_t*, void*, char, char), false>::get(getGlobalContext())));
  EXPECT_EQ(FunctionType::get(Type::getInt8Ty(getGlobalContext()), params, true),
            (TypeBuilder<int8_t(int32_t*, char*, char, char, ...),
                         false>::get(getGlobalContext())));
  params.push_back(TypeBuilder<char, false>::get(getGlobalContext()));
  EXPECT_EQ(FunctionType::get(Type::getInt8Ty(getGlobalContext()), params, false),
            (TypeBuilder<int8_t(int32_t*, void*, char, char, char),
                         false>::get(getGlobalContext())));
  EXPECT_EQ(FunctionType::get(Type::getInt8Ty(getGlobalContext()), params, true),
            (TypeBuilder<int8_t(int32_t*, char*, char, char, char, ...),
                         false>::get(getGlobalContext())));
}

TEST(TypeBuilderTest, Context) {
  // We used to cache TypeBuilder results in static local variables.  This
  // produced the same type for different contexts, which of course broke
  // things.
  LLVMContext context1;
  EXPECT_EQ(&context1,
            &(TypeBuilder<types::i<1>, true>::get(context1))->getContext());
  LLVMContext context2;
  EXPECT_EQ(&context2,
            &(TypeBuilder<types::i<1>, true>::get(context2))->getContext());
}

struct MyType {
  int a;
  int *b;
  void *array[1];
};

struct MyPortableType {
  int32_t a;
  int32_t *b;
  void *array[1];
};

}  // anonymous namespace

namespace llvm {
template<bool cross> class TypeBuilder<MyType, cross> {
public:
  static StructType *get(LLVMContext &Context) {
    // Using the static result variable ensures that the type is
    // only looked up once.
    std::vector<Type*> st;
    st.push_back(TypeBuilder<int, cross>::get(Context));
    st.push_back(TypeBuilder<int*, cross>::get(Context));
    st.push_back(TypeBuilder<void*[], cross>::get(Context));
    static StructType *const result = StructType::get(Context, st);
    return result;
  }

  // You may find this a convenient place to put some constants
  // to help with getelementptr.  They don't have any effect on
  // the operation of TypeBuilder.
  enum Fields {
    FIELD_A,
    FIELD_B,
    FIELD_ARRAY
  };
};

template<bool cross> class TypeBuilder<MyPortableType, cross> {
public:
  static StructType *get(LLVMContext &Context) {
    // Using the static result variable ensures that the type is
    // only looked up once.
    std::vector<Type*> st;
    st.push_back(TypeBuilder<types::i<32>, cross>::get(Context));
    st.push_back(TypeBuilder<types::i<32>*, cross>::get(Context));
    st.push_back(TypeBuilder<types::i<8>*[], cross>::get(Context));
    static StructType *const result = StructType::get(Context, st);
    return result;
  }

  // You may find this a convenient place to put some constants
  // to help with getelementptr.  They don't have any effect on
  // the operation of TypeBuilder.
  enum Fields {
    FIELD_A,
    FIELD_B,
    FIELD_ARRAY
  };
};
}  // namespace llvm
namespace {

TEST(TypeBuilderTest, Extensions) {
  EXPECT_EQ(PointerType::getUnqual(StructType::get(
                                     TypeBuilder<int, false>::get(getGlobalContext()),
                                     TypeBuilder<int*, false>::get(getGlobalContext()),
                                     TypeBuilder<void*[], false>::get(getGlobalContext()),
                                     (void*)nullptr)),
            (TypeBuilder<MyType*, false>::get(getGlobalContext())));
  EXPECT_EQ(PointerType::getUnqual(StructType::get(
                                     TypeBuilder<types::i<32>, false>::get(getGlobalContext()),
                                     TypeBuilder<types::i<32>*, false>::get(getGlobalContext()),
                                     TypeBuilder<types::i<8>*[], false>::get(getGlobalContext()),
                                     (void*)nullptr)),
            (TypeBuilder<MyPortableType*, false>::get(getGlobalContext())));
  EXPECT_EQ(PointerType::getUnqual(StructType::get(
                                     TypeBuilder<types::i<32>, false>::get(getGlobalContext()),
                                     TypeBuilder<types::i<32>*, false>::get(getGlobalContext()),
                                     TypeBuilder<types::i<8>*[], false>::get(getGlobalContext()),
                                     (void*)nullptr)),
            (TypeBuilder<MyPortableType*, true>::get(getGlobalContext())));
}

}  // anonymous namespace
@


1.1.1.1
log
@Use the space freed up by sparc and zaurus to import LLVM.

ok hackroom@@
@
text
@@


1.1.1.2
log
@Import LLVM 3.9.1 including clang and lld.
@
text
@d11 1
d20 2
a21 3
  LLVMContext Context;
  EXPECT_EQ(Type::getVoidTy(Context), (TypeBuilder<void, true>::get(Context)));
  EXPECT_EQ(Type::getVoidTy(Context), (TypeBuilder<void, false>::get(Context)));
d23 9
a31 8
  EXPECT_EQ(Type::getInt8PtrTy(Context),
            (TypeBuilder<void *, false>::get(Context)));
  EXPECT_EQ(Type::getInt8PtrTy(Context),
            (TypeBuilder<const void *, false>::get(Context)));
  EXPECT_EQ(Type::getInt8PtrTy(Context),
            (TypeBuilder<volatile void *, false>::get(Context)));
  EXPECT_EQ(Type::getInt8PtrTy(Context),
            (TypeBuilder<const volatile void *, false>::get(Context)));
d35 13
a47 22
  LLVMContext Context;
  EXPECT_EQ(Type::getInt8Ty(Context),
            (TypeBuilder<int8_t, false>::get(Context)));
  EXPECT_EQ(Type::getInt8Ty(Context),
            (TypeBuilder<uint8_t, false>::get(Context)));
  EXPECT_EQ(Type::getInt16Ty(Context),
            (TypeBuilder<int16_t, false>::get(Context)));
  EXPECT_EQ(Type::getInt16Ty(Context),
            (TypeBuilder<uint16_t, false>::get(Context)));
  EXPECT_EQ(Type::getInt32Ty(Context),
            (TypeBuilder<int32_t, false>::get(Context)));
  EXPECT_EQ(Type::getInt32Ty(Context),
            (TypeBuilder<uint32_t, false>::get(Context)));
  EXPECT_EQ(Type::getInt64Ty(Context),
            (TypeBuilder<int64_t, false>::get(Context)));
  EXPECT_EQ(Type::getInt64Ty(Context),
            (TypeBuilder<uint64_t, false>::get(Context)));

  EXPECT_EQ(IntegerType::get(Context, sizeof(size_t) * CHAR_BIT),
            (TypeBuilder<size_t, false>::get(Context)));
  EXPECT_EQ(IntegerType::get(Context, sizeof(ptrdiff_t) * CHAR_BIT),
            (TypeBuilder<ptrdiff_t, false>::get(Context)));
d51 4
a54 9
  LLVMContext Context;
  EXPECT_EQ(IntegerType::get(Context, 1),
            (TypeBuilder<types::i<1>, true>::get(Context)));
  EXPECT_EQ(IntegerType::get(Context, 1),
            (TypeBuilder<types::i<1>, false>::get(Context)));
  EXPECT_EQ(IntegerType::get(Context, 72),
            (TypeBuilder<types::i<72>, true>::get(Context)));
  EXPECT_EQ(IntegerType::get(Context, 72),
            (TypeBuilder<types::i<72>, false>::get(Context)));
d58 2
a59 5
  LLVMContext Context;
  EXPECT_EQ(Type::getFloatTy(Context),
            (TypeBuilder<float, false>::get(Context)));
  EXPECT_EQ(Type::getDoubleTy(Context),
            (TypeBuilder<double, false>::get(Context)));
d61 10
a70 20
  EXPECT_EQ(Type::getFloatTy(Context),
            (TypeBuilder<types::ieee_float, true>::get(Context)));
  EXPECT_EQ(Type::getFloatTy(Context),
            (TypeBuilder<types::ieee_float, false>::get(Context)));
  EXPECT_EQ(Type::getDoubleTy(Context),
            (TypeBuilder<types::ieee_double, true>::get(Context)));
  EXPECT_EQ(Type::getDoubleTy(Context),
            (TypeBuilder<types::ieee_double, false>::get(Context)));
  EXPECT_EQ(Type::getX86_FP80Ty(Context),
            (TypeBuilder<types::x86_fp80, true>::get(Context)));
  EXPECT_EQ(Type::getX86_FP80Ty(Context),
            (TypeBuilder<types::x86_fp80, false>::get(Context)));
  EXPECT_EQ(Type::getFP128Ty(Context),
            (TypeBuilder<types::fp128, true>::get(Context)));
  EXPECT_EQ(Type::getFP128Ty(Context),
            (TypeBuilder<types::fp128, false>::get(Context)));
  EXPECT_EQ(Type::getPPC_FP128Ty(Context),
            (TypeBuilder<types::ppc_fp128, true>::get(Context)));
  EXPECT_EQ(Type::getPPC_FP128Ty(Context),
            (TypeBuilder<types::ppc_fp128, false>::get(Context)));
d74 45
a118 46
  LLVMContext Context;
  EXPECT_EQ(PointerType::getUnqual(Type::getInt8PtrTy(Context)),
            (TypeBuilder<int8_t **, false>::get(Context)));
  EXPECT_EQ(ArrayType::get(Type::getInt8Ty(Context), 7),
            (TypeBuilder<int8_t[7], false>::get(Context)));
  EXPECT_EQ(ArrayType::get(Type::getInt8Ty(Context), 0),
            (TypeBuilder<int8_t[], false>::get(Context)));

  EXPECT_EQ(PointerType::getUnqual(Type::getInt8PtrTy(Context)),
            (TypeBuilder<types::i<8> **, false>::get(Context)));
  EXPECT_EQ(ArrayType::get(Type::getInt8Ty(Context), 7),
            (TypeBuilder<types::i<8>[7], false>::get(Context)));
  EXPECT_EQ(ArrayType::get(Type::getInt8Ty(Context), 0),
            (TypeBuilder<types::i<8>[], false>::get(Context)));

  EXPECT_EQ(PointerType::getUnqual(Type::getInt8PtrTy(Context)),
            (TypeBuilder<types::i<8> **, true>::get(Context)));
  EXPECT_EQ(ArrayType::get(Type::getInt8Ty(Context), 7),
            (TypeBuilder<types::i<8>[7], true>::get(Context)));
  EXPECT_EQ(ArrayType::get(Type::getInt8Ty(Context), 0),
            (TypeBuilder<types::i<8>[], true>::get(Context)));

  EXPECT_EQ(Type::getInt8Ty(Context),
            (TypeBuilder<const int8_t, false>::get(Context)));
  EXPECT_EQ(Type::getInt8Ty(Context),
            (TypeBuilder<volatile int8_t, false>::get(Context)));
  EXPECT_EQ(Type::getInt8Ty(Context),
            (TypeBuilder<const volatile int8_t, false>::get(Context)));

  EXPECT_EQ(Type::getInt8Ty(Context),
            (TypeBuilder<const types::i<8>, false>::get(Context)));
  EXPECT_EQ(Type::getInt8Ty(Context),
            (TypeBuilder<volatile types::i<8>, false>::get(Context)));
  EXPECT_EQ(Type::getInt8Ty(Context),
            (TypeBuilder<const volatile types::i<8>, false>::get(Context)));

  EXPECT_EQ(Type::getInt8Ty(Context),
            (TypeBuilder<const types::i<8>, true>::get(Context)));
  EXPECT_EQ(Type::getInt8Ty(Context),
            (TypeBuilder<volatile types::i<8>, true>::get(Context)));
  EXPECT_EQ(Type::getInt8Ty(Context),
            (TypeBuilder<const volatile types::i<8>, true>::get(Context)));

  EXPECT_EQ(Type::getInt8PtrTy(Context),
            (TypeBuilder<const volatile int8_t *const volatile, false>::get(
                Context)));
a121 1
  LLVMContext Context;
d123 32
a154 37
  EXPECT_EQ(FunctionType::get(Type::getVoidTy(Context), params, false),
            (TypeBuilder<void(), true>::get(Context)));
  EXPECT_EQ(FunctionType::get(Type::getInt8Ty(Context), params, true),
            (TypeBuilder<int8_t(...), false>::get(Context)));
  params.push_back(TypeBuilder<int32_t *, false>::get(Context));
  EXPECT_EQ(FunctionType::get(Type::getInt8Ty(Context), params, false),
            (TypeBuilder<int8_t(const int32_t *), false>::get(Context)));
  EXPECT_EQ(FunctionType::get(Type::getInt8Ty(Context), params, true),
            (TypeBuilder<int8_t(const int32_t *, ...), false>::get(Context)));
  params.push_back(TypeBuilder<char *, false>::get(Context));
  EXPECT_EQ(FunctionType::get(Type::getInt8Ty(Context), params, false),
            (TypeBuilder<int8_t(int32_t *, void *), false>::get(Context)));
  EXPECT_EQ(FunctionType::get(Type::getInt8Ty(Context), params, true),
            (TypeBuilder<int8_t(int32_t *, char *, ...), false>::get(Context)));
  params.push_back(TypeBuilder<char, false>::get(Context));
  EXPECT_EQ(
      FunctionType::get(Type::getInt8Ty(Context), params, false),
      (TypeBuilder<int8_t(int32_t *, void *, char), false>::get(Context)));
  EXPECT_EQ(
      FunctionType::get(Type::getInt8Ty(Context), params, true),
      (TypeBuilder<int8_t(int32_t *, char *, char, ...), false>::get(Context)));
  params.push_back(TypeBuilder<char, false>::get(Context));
  EXPECT_EQ(FunctionType::get(Type::getInt8Ty(Context), params, false),
            (TypeBuilder<int8_t(int32_t *, void *, char, char), false>::get(
                Context)));
  EXPECT_EQ(
      FunctionType::get(Type::getInt8Ty(Context), params, true),
      (TypeBuilder<int8_t(int32_t *, char *, char, char, ...), false>::get(
          Context)));
  params.push_back(TypeBuilder<char, false>::get(Context));
  EXPECT_EQ(
      FunctionType::get(Type::getInt8Ty(Context), params, false),
      (TypeBuilder<int8_t(int32_t *, void *, char, char, char), false>::get(
          Context)));
  EXPECT_EQ(FunctionType::get(Type::getInt8Ty(Context), params, true),
            (TypeBuilder<int8_t(int32_t *, char *, char, char, char, ...),
                         false>::get(Context)));
a232 1
  LLVMContext Context;
d234 17
a250 16
                TypeBuilder<int, false>::get(Context),
                TypeBuilder<int *, false>::get(Context),
                TypeBuilder<void *[], false>::get(Context), (void *)nullptr)),
            (TypeBuilder<MyType *, false>::get(Context)));
  EXPECT_EQ(
      PointerType::getUnqual(StructType::get(
          TypeBuilder<types::i<32>, false>::get(Context),
          TypeBuilder<types::i<32> *, false>::get(Context),
          TypeBuilder<types::i<8> *[], false>::get(Context), (void *)nullptr)),
      (TypeBuilder<MyPortableType *, false>::get(Context)));
  EXPECT_EQ(
      PointerType::getUnqual(StructType::get(
          TypeBuilder<types::i<32>, false>::get(Context),
          TypeBuilder<types::i<32> *, false>::get(Context),
          TypeBuilder<types::i<8> *[], false>::get(Context), (void *)nullptr)),
      (TypeBuilder<MyPortableType *, true>::get(Context)));
@

