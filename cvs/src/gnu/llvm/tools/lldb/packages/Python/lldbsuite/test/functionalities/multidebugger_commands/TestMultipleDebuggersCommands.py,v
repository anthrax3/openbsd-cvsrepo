head     1.1;
branch   1.1.1;
access   ;
symbols  LLVM_5_0_0:1.1.1.1 LLVM:1.1.1;
locks    ; strict;
comment  @# @;
expand   @o@;


1.1
date     2017.10.04.20.27.41;  author patrick;  state Exp;
branches 1.1.1.1;
next     ;
commitid        ufzi3t8MqoilCPqO;

1.1.1.1
date     2017.10.04.20.27.41;  author patrick;  state Exp;
branches ;
next     ;
commitid        ufzi3t8MqoilCPqO;


desc
@@



1.1
log
@Initial revision
@
text
@"""
Test that commands do not try and hold on to stale CommandInterpreters in a multiple debuggers scenario
"""

from __future__ import print_function


import os
import time
import lldb
from lldbsuite.test.decorators import *
from lldbsuite.test.lldbtest import *
from lldbsuite.test import lldbutil


class MultipleDebuggersCommandsTestCase(TestBase):

    mydir = TestBase.compute_mydir(__file__)

    @@no_debug_info_test
    def test_multipledebuggers_commands(self):
        """Test that commands do not try and hold on to stale CommandInterpreters in a multiple debuggers scenario"""
        source_init_files = False
        magic_text = "The following commands may relate to 'env'"

        debugger_1 = lldb.SBDebugger.Create(source_init_files)
        interpreter_1 = debugger_1.GetCommandInterpreter()

        retobj = lldb.SBCommandReturnObject()
        interpreter_1.HandleCommand("apropos env", retobj)
        self.assertTrue(
            magic_text in str(retobj),
            "[interpreter_1]: the output does not contain the correct words")

        if self.TraceOn():
            print(str(retobj))

        lldb.SBDebugger.Destroy(debugger_1)

        # now do this again with a different debugger - we shouldn't crash

        debugger_2 = lldb.SBDebugger.Create(source_init_files)
        interpreter_2 = debugger_2.GetCommandInterpreter()

        retobj = lldb.SBCommandReturnObject()
        interpreter_2.HandleCommand("apropos env", retobj)
        self.assertTrue(
            magic_text in str(retobj),
            "[interpreter_2]: the output does not contain the correct words")

        if self.TraceOn():
            print(str(retobj))

        lldb.SBDebugger.Destroy(debugger_2)
@


1.1.1.1
log
@Import LLVM 5.0.0 release including clang, lld and lldb.
@
text
@@
