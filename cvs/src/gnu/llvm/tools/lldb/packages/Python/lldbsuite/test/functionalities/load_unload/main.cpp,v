head     1.1;
branch   1.1.1;
access   ;
symbols  LLVM_5_0_0:1.1.1.1 LLVM:1.1.1;
locks    ; strict;
comment  @// @;
expand   @o@;


1.1
date     2017.10.04.20.27.41;  author patrick;  state Exp;
branches 1.1.1.1;
next     ;
commitid        ufzi3t8MqoilCPqO;

1.1.1.1
date     2017.10.04.20.27.41;  author patrick;  state Exp;
branches ;
next     ;
commitid        ufzi3t8MqoilCPqO;


desc
@@



1.1
log
@Initial revision
@
text
@//===-- main.c --------------------------------------------------*- C++ -*-===//
//
//                     The LLVM Compiler Infrastructure
//
// This file is distributed under the University of Illinois Open Source
// License. See LICENSE.TXT for details.
//
//===----------------------------------------------------------------------===//
#include <stdio.h>
#include <dlfcn.h>
#include <limits.h>
#include <string.h>
#include <unistd.h>
#include <libgen.h>
#include <stdlib.h>

int
main (int argc, char const *argv[])
{
#if defined (__APPLE__)
    const char *a_name = "@@executable_path/libloadunload_a.dylib";
    const char *c_name = "@@executable_path/libloadunload_c.dylib";
#else
    const char *a_name = "libloadunload_a.so";
    const char *c_name = "libloadunload_c.so";
#endif
    void *a_dylib_handle = NULL;
    void *c_dylib_handle = NULL;
    int (*a_function) (void);

    a_dylib_handle = dlopen (a_name, RTLD_NOW); // Set break point at this line for test_lldb_process_load_and_unload_commands().
    if (a_dylib_handle == NULL)
    {
        fprintf (stderr, "%s\n", dlerror());
        exit (1);
    }

    a_function = (int (*) ()) dlsym (a_dylib_handle, "a_function");
    if (a_function == NULL)
    {
        fprintf (stderr, "%s\n", dlerror());
        exit (2);
    }
    printf ("First time around, got: %d\n", a_function ());
    dlclose (a_dylib_handle);

    c_dylib_handle = dlopen (c_name, RTLD_NOW);
    if (c_dylib_handle == NULL)
    {
        fprintf (stderr, "%s\n", dlerror());
        exit (3);
    }
    a_function = (int (*) ()) dlsym (c_dylib_handle, "c_function");
    if (a_function == NULL)
    {
        fprintf (stderr, "%s\n", dlerror());
        exit (4);
    }

    a_dylib_handle = dlopen (a_name, RTLD_NOW);
    if (a_dylib_handle == NULL)
    {
        fprintf (stderr, "%s\n", dlerror());
        exit (5);
    }

    a_function = (int (*) ()) dlsym (a_dylib_handle, "a_function");
    if (a_function == NULL)
    {
        fprintf (stderr, "%s\n", dlerror());
        exit (6);
    }
    printf ("Second time around, got: %d\n", a_function ());
    dlclose (a_dylib_handle);

    int d_function(void);
    printf ("d_function returns: %d\n", d_function());

    return 0;
}
@


1.1.1.1
log
@Import LLVM 5.0.0 release including clang, lld and lldb.
@
text
@@
