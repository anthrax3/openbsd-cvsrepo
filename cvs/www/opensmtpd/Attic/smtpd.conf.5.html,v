head	1.5;
access;
symbols
	OpenBSD:1.1.1.1 gilles:1.1.1;
locks; strict;
comment	@# @;


1.5
date	2016.04.20.18.03.43;	author tj;	state dead;
branches;
next	1.4;
commitid	9kFrgi0oGAcQGcEB;

1.4
date	2015.06.24.07.23.27;	author gilles;	state Exp;
branches;
next	1.3;
commitid	7MFeR5qji3YyU6J6;

1.3
date	2013.12.06.10.57.39;	author gilles;	state Exp;
branches;
next	1.2;

1.2
date	2013.03.25.09.15.18;	author gilles;	state Exp;
branches;
next	1.1;

1.1
date	2012.10.08.18.31.31;	author gilles;	state Exp;
branches
	1.1.1.1;
next	;

1.1.1.1
date	2012.10.08.18.31.31;	author gilles;	state Exp;
branches;
next	;


desc
@@


1.5
log
@move opensmtpd site to css, link to online manpages instead of duplicates,
remove a couple stray files and fix some wording oddities.

ok jung gilles
@
text
@<!DOCTYPE html>
<html>
<head>
<meta charset="utf-8"/>
<style>
table.head, table.foot { width: 100%; }
td.head-rtitle, td.foot-os { text-align: right; }
td.head-vol { text-align: center; }
table.foot td { width: 50%; }
table.head td { width: 33%; }
div.spacer { margin: 1em 0; }
</style>
<title>
SMTPD.CONF(5)</title>
</head>
<body>
<div class="mandoc">
<div class="section">
<h1 id="x4e414d45">NAME</h1> <b class="name">smtpd.conf</b> &#8212; <span class="desc">Simple Mail Transfer Protocol daemon configuration file</span></div>
<div class="section">
<h1 id="x4445534352495054494f4e">DESCRIPTION</h1> <b class="name">smtpd.conf</b> is the configuration file for the mail daemon <a class="link-man">smtpd(8)</a>.<div class="spacer">
</div>
The current line can be extended over multiple lines using a backslash (&#8216;\&#8217;). Comments can be put anywhere in the file using a hash mark (&#8216;#&#8217;), and extend to the end of the current line. Care should be taken when commenting out multi-line text: the comment is effective until the end of the entire block.<div class="spacer">
</div>
Argument names not beginning with a letter, digit, or underscore must be quoted. Arguments containing whitespace should be surrounded by double quotes (&quot;).<div class="spacer">
</div>
Macros can be defined that will later be expanded in context. Macro names must start with a letter, digit, or underscore, and may contain any of those characters. Macro names may not be reserved words (for example <i class="arg">listen</i>, <i class="arg">accept</i>, <i class="arg">port</i>). Macros are not expanded inside quotes.<div class="spacer">
</div>
For example:<div class="spacer">
</div>
<pre style="margin-left: 5.00ex;" class="lit display">
lan_addr = &quot;192.168.0.1&quot; 
listen on $lan_addr 
listen on $lan_addr tls auth</pre>
<div class="spacer">
</div>
Additional configuration files can be included with the <b class="cmd">include</b> keyword, for example:<div class="spacer">
</div>
<pre style="margin-left: 5.00ex;" class="lit display">
include &quot;/etc/mail/smtpd.conf.local&quot;</pre>
<div class="spacer">
</div>
The syntax of <b class="name">smtpd.conf</b> is described below.<dl style="margin-top: 0.00em;margin-bottom: 0.00em;" class="list list-tag">
<dt class="list-tag" style="margin-top: 1.00em;">
<b class="cmd">accept</b> | <b class="cmd">reject</b></dt>
<dd class="list-tag" style="margin-left: 6.00ex;">
<a class="link-man">smtpd(8)</a> accepts and rejects messages based on information gathered during the SMTP session.<div class="spacer">
</div>
For each message processed by the daemon, the filter rules are evaluated in sequential order, from first to last. The first matching rule decides what action is taken. If no rule matches the message, the default action is to reject the message. An exclamation mark may be specified to perform a reverse match.<div class="spacer">
</div>
Following the accept/reject decision comes the optional tag matching:<dl style="margin-top: 0.00em;margin-bottom: 0.00em;" class="list list-tag">
<dt class="list-tag" style="margin-top: 1.00em;">
<b class="cmd">tagged</b> [<span class="opt"><b class="cmd">!</b></span>] <b class="cmd">tag</b></dt>
<dd class="list-tag" style="margin-left: 6.00ex;">
If specified, the rule will only be matched if the client session was tagged with <i class="arg">tag</i>.</dd>
</dl>
<div class="spacer">
</div>
After that the client's IP address filter is specified:<dl style="margin-top: 0.00em;margin-bottom: 0.00em;" class="list list-tag">
<dt class="list-tag" style="margin-top: 1.00em;">
<b class="cmd">from any</b></dt>
<dd class="list-tag" style="margin-left: 6.00ex;">
Make the rule match regardless of the IP of connecting client.</dd>
<dt class="list-tag" style="margin-top: 1.00em;">
<b class="cmd">from</b> [<span class="opt"><b class="cmd">!</b></span>] <b class="cmd">local</b></dt>
<dd class="list-tag" style="margin-left: 6.00ex;">
The rule matches only locally originating connections. This is the default, and may be omitted.</dd>
<dt class="list-tag" style="margin-top: 1.00em;">
<b class="cmd">from</b> [<span class="opt"><b class="cmd">!</b></span>] <b class="cmd">source</b> &lt;<i class="arg">table</i>&gt;</dt>
<dd class="list-tag" style="margin-left: 6.00ex;">
The rule matches if the connection is made from a client whose address is declared in the table <i class="arg">table</i>.</dd>
</dl>
<div class="spacer">
</div>
In addition, finer filtering may be achieved on the sender if desired:<dl style="margin-top: 0.00em;margin-bottom: 0.00em;" class="list list-tag">
<dt class="list-tag" style="margin-top: 1.00em;">
<b class="cmd">sender</b> [<span class="opt"><b class="cmd">!</b></span>] &lt;<i class="arg">senders</i>&gt;</dt>
<dd class="list-tag" style="margin-left: 6.00ex;">
If specified, the rule will only be matched if the sender email address is found in the table <i class="arg">senders</i>. The table may contain complete email addresses or apply to an entire domain if prefixed with @@.</dd>
</dl>
<div class="spacer">
</div>
Next comes the selection based on the domain the message is sent to:<dl style="margin-top: 0.00em;margin-bottom: 0.00em;" class="list list-tag">
<dt class="list-tag" style="margin-top: 1.00em;">
<b class="cmd">for any</b> [<span class="opt"><b class="cmd">alias</b> <code class="none">&lt;</code><i class="arg">aliases</i>&gt;</span>]</dt>
<dd class="list-tag" style="margin-left: 6.00ex;">
Make the rule match regardless of the domain it is sent to. If specified, the table <i class="arg">aliases</i> is used for looking up alternative destinations for all addresses.</dd>
<dt class="list-tag" style="margin-top: 1.00em;">
<b class="cmd">for any virtual</b> <code class="none">&lt;</code><i class="arg">vmap</i>&gt;</dt>
<dd class="list-tag" style="margin-left: 6.00ex;">
Make the rule match regardless of the domain it is sent to. The <i class="arg">vmap</i> table will be used as the virtual domain mapping.</dd>
<dt class="list-tag" style="margin-top: 1.00em;">
<b class="cmd">for</b> [<span class="opt"><b class="cmd">!</b></span>] <b class="cmd">domain</b> <i class="arg">domain</i> [<span class="opt"><b class="cmd">alias</b> <code class="none">&lt;</code><i class="arg">aliases</i>&gt;</span>]</dt>
<dd class="list-tag" style="margin-left: 6.00ex;">
This rule applies to mail destined for the specified <i class="arg">domain</i>. This parameter supports the &#8216;*&#8217; wildcard, so that a single rule for all sub-domains can be used, for example:<div class="spacer">
</div>
<pre style="margin-left: 5.00ex;" class="lit display">
accept for domain &quot;*.example.com&quot; deliver to mbox</pre>
<div class="spacer">
</div>
If specified, the table <i class="arg">aliases</i> is used for looking up alternative destinations for addresses in this <i class="arg">domain</i>.</dd>
<dt class="list-tag" style="margin-top: 1.00em;">
<b class="cmd">for</b> [<span class="opt"><b class="cmd">!</b></span>] <b class="cmd">domain</b> &lt;<i class="arg">domains</i>&gt; [<span class="opt"><b class="cmd">alias</b> <code class="none">&lt;</code><i class="arg">aliases</i>&gt;</span>]</dt>
<dd class="list-tag" style="margin-left: 6.00ex;">
This rule applies to mail destined to domains which are part of the table <i class="arg">domains</i>.<div class="spacer">
</div>
If specified, the table <i class="arg">aliases</i> is used for looking up alternative destinations for addresses in these <i class="arg">domains</i>.</dd>
<dt class="list-tag" style="margin-top: 1.00em;">
<b class="cmd">for</b> [<span class="opt"><b class="cmd">!</b></span>] <b class="cmd">domain</b> <i class="arg">domain</i> <b class="cmd">virtual</b> <code class="none">&lt;</code><i class="arg">users</i>&gt;</dt>
<dd class="list-tag" style="margin-left: 6.00ex;">
This rule applies to mail destined for the specified virtual <i class="arg">domain</i>. This parameter supports the &#8216;*&#8217; wildcard, so that a single rule for all sub-domains can be used, for example:<div class="spacer">
</div>
<pre style="margin-left: 5.00ex;" class="lit display">
accept for domain &quot;*.example.com&quot; \ 
       virtual &lt;users&gt; deliver to mbox</pre>
<div class="spacer">
</div>
The table <i class="arg">users</i> holds a key-value mapping of virtual to system users. For an example of how to configure the <i class="arg">users</i> table, see <a class="link-man">makemap(8)</a>.</dd>
<dt class="list-tag" style="margin-top: 1.00em;">
<b class="cmd">for</b> [<span class="opt"><b class="cmd">!</b></span>] <b class="cmd">domain</b> &lt;<i class="arg">domains</i>&gt; <b class="cmd">virtual</b> <code class="none">&lt;</code><i class="arg">users</i>&gt;</dt>
<dd class="list-tag" style="margin-left: 6.00ex;">
This rule applies to mail destined for the virtual domains specified in the table <i class="arg">domains</i>.<div class="spacer">
</div>
The table <i class="arg">users</i> holds a key-value mapping of virtual to system users. For an example of how to configure the <i class="arg">users</i> table, see <a class="link-man">makemap(8)</a>.</dd>
<dt class="list-tag" style="margin-top: 1.00em;">
<b class="cmd">for</b> [<span class="opt"><b class="cmd">!</b></span>] <b class="cmd">local</b> [<span class="opt"><b class="cmd">alias</b> <code class="none">&lt;</code><i class="arg">aliases</i>&gt;</span>]</dt>
<dd class="list-tag" style="margin-left: 6.00ex;">
This rule applies to mail destined to &#8220;localhost&#8221; and to the default server name. See the <i class="link-sec"><a class="link-sec" href="#x46494c4553">FILES</a></i> entry for <i class="file">/etc/mail/mailname</i> below for details of how the server name is determined.</dd>
<dt class="list-tag" style="margin-top: 1.00em;">
<b class="cmd">for</b> [<span class="opt"><b class="cmd">!</b></span>] <b class="cmd">local</b> <b class="cmd">virtual</b> <code class="none">&lt;</code><i class="arg">vmap</i>&gt;</dt>
<dd class="list-tag" style="margin-left: 6.00ex;">
This rule applies to mail destined to &#8220;localhost&#8221; and to the default server name. The <i class="arg">vmap</i> table will be used as the virtual domain mapping.</dd>
</dl>
<div class="spacer">
</div>
Further filtering may be achieved on specific recipients if desired:<dl style="margin-top: 0.00em;margin-bottom: 0.00em;" class="list list-tag">
<dt class="list-tag" style="margin-top: 1.00em;">
<b class="cmd">recipient</b> [<span class="opt"><b class="cmd">!</b></span>] &lt;<i class="arg">recipients</i>&gt;</dt>
<dd class="list-tag" style="margin-left: 6.00ex;">
If specified, the rule will only be matched if the recipient email address is found in the table <i class="arg">recipients</i>. The table may contain complete email addresses or apply to an entire domain if prefixed with &#8216;@@&#8217;.</dd>
</dl>
<div class="spacer">
</div>
If the method of delivery is local, a user database may be specified to override the system database:<dl style="margin-top: 0.00em;margin-bottom: 0.00em;" class="list list-tag">
<dt class="list-tag" style="margin-top: 1.00em;">
[<span class="opt"><b class="cmd">userbase</b> <code class="none">&lt;</code><i class="arg">table</i>&gt;</span>]</dt>
<dd class="list-tag" style="margin-left: 6.00ex;">
Look up users in the table <i class="arg">table</i> instead of performing system lookups using the <a class="link-man">getpwnam(3)</a> function.</dd>
</dl>
<div class="spacer">
</div>
You can also accept mail just to have it forwarded elsewhere:<dl style="margin-top: 0.00em;margin-bottom: 0.00em;" class="list list-tag">
<dt class="list-tag" style="margin-top: 1.00em;">
forward-only</dt>
<dd class="list-tag" style="margin-left: 6.00ex;">
Mail is accepted for local recipients ONLY if it is redirected to an external address via an alias or a ~/.forward.<div class="spacer">
</div>
Example:<div class="spacer">
</div>
<pre style="margin-left: 5.00ex;" class="lit display">
accept for domain opensmtpd.org forward-only</pre>
</dd>
</dl>
<div class="spacer">
</div>
Finally, the method of delivery is specified:<dl style="margin-top: 0.00em;margin-bottom: 0.00em;" class="list list-tag">
<dt class="list-tag" style="margin-top: 1.00em;">
<b class="cmd">deliver to lmtp</b> [<span class="opt"><i class="arg">host</i>:<i class="arg">port</i> | <i class="arg">socket</i></span>]</dt>
<dd class="list-tag" style="margin-left: 6.00ex;">
Mail is delivered to <i class="arg">host</i>:<i class="arg">port</i>, or to the <span class="unix">UNIX</span> <i class="arg">socket</i> over LMTP.</dd>
<dt class="list-tag" style="margin-top: 1.00em;">
<b class="cmd">deliver to maildir</b> <i class="arg">path</i></dt>
<dd class="list-tag" style="margin-left: 6.00ex;">
Mail is added to a maildir. Its location, <i class="arg">path</i>, may contain format specifiers that are expanded before use (see <i class="link-sec"><a class="link-sec" href="#x464f524d41542053504543494649455253">FORMAT SPECIFIERS</a></i>). If <i class="arg">path</i> is not provided, then <i class="file">~/Maildir</i> is assumed.</dd>
<dt class="list-tag" style="margin-top: 1.00em;">
<b class="cmd">deliver to mbox</b></dt>
<dd class="list-tag" style="margin-left: 6.00ex;">
Mail is delivered to the local user's system mailbox in <i class="file">/var/mail</i>.</dd>
<dt class="list-tag" style="margin-top: 1.00em;">
<b class="cmd">deliver to mda</b> <i class="arg">program</i></dt>
<dd class="list-tag" style="margin-left: 6.00ex;">
Mail is piped to the specified <i class="arg">program</i>, which is run with the privileges of the user the message is destined to. This parameter may use conversion specifiers that are expanded before use (see <i class="link-sec"><a class="link-sec" href="#x464f524d41542053504543494649455253">FORMAT SPECIFIERS</a></i>).</dd>
<dt class="list-tag" style="margin-top: 1.00em;">
<b class="cmd">relay</b> [<span class="opt"><b class="cmd">backup</b>&#160;[<span class="opt"><i class="arg">mx</i></span>]</span>] [<span class="opt"><b class="cmd">as</b>&#160;<i class="arg">address</i></span>] [<span class="opt"><b class="cmd">source</b>&#160;<code class="none">&lt;</code><i class="arg">source</i>&gt;</span>] [<span class="opt"><b class="cmd">hostname</b>&#160;<i class="arg">name</i></span>] [<span class="opt"><b class="cmd">hostnames</b>&#160;<code class="none">&lt;</code><i class="arg">names</i>&gt;</span>] [<span class="opt"><b class="cmd">pki</b>&#160;<i class="arg">pkiname</i></span>] [<span class="opt"><b class="cmd">tls</b>&#160;[<span class="opt">verify</span>]</span>]</dt>
<dd class="list-tag" style="margin-left: 6.00ex;">
<div class="spacer">
</div>
Mail is relayed. The routing decision is based on the DNS system.<div class="spacer">
</div>
If the <b class="cmd">backup</b> parameter is specified, the current server will act as a backup server for the target domain. Accepted mails are only relayed through servers with a lower preference value in the MX record for the domain than the one specified in <i class="arg">mx</i>. If <i class="arg">mx</i> is not specified, the default server name will be assumed.<div class="spacer">
</div>
If the <b class="cmd">as</b> parameter is specified, <a class="link-man">smtpd(8)</a> will rewrite the sender advertised in the SMTP session. <i class="arg">address</i> may be a user, a domain prefixed with &#8216;@@&#8217;, or an email address, causing smtpd to rewrite the user-part, the domain-part, or the entire address, respectively.<div class="spacer">
</div>
If the <b class="cmd">source</b> parameter is specified, <a class="link-man">smtpd(8)</a> will explicitly bind to an address found in the table referenced by <i class="arg">source</i> when connecting to the relay. If the table contains more than one address, they are picked in turn each time a new connection is opened.<div class="spacer">
</div>
By default, when connecting to a remote server, <a class="link-man">smtpd(8)</a> advertises its default server name. A <b class="cmd">hostname</b> parameter may be specified to advertise the alternate hostname <i class="arg">name</i>. If the <b class="cmd">source</b> parameter is used, the <b class="cmd">hostnames</b> parameter may be specified to advertise a hostname based on the source address. Table <i class="arg">names</i> contains a mapping of IP addresses to hostnames and <a class="link-man">smtpd(8)</a> will automatically select the name that matches its source address when connected to the remote server. The <b class="cmd">hostname</b> and <b class="cmd">hostnames</b> parameters are mutually exclusive.<div class="spacer">
</div>
When relaying, STARTTLS is always attempted if available on remote host and OpenSMTPD will try to present a certificate matching the outgoing hostname if one is registered in the pki. If <b class="cmd">pki</b> is specified, the certificate registered for <i class="arg">pkiname</i> is used instead.<div class="spacer">
</div>
If <b class="cmd">tls</b> is specified, OpenSMTPD will refuse to relay unless the remote host provides STARTTLS.<div class="spacer">
</div>
If the <b class="cmd">verify</b> parameter to <b class="cmd">tls</b> is specified, then OpenSMTPD will refuse to relay unless the certificate presented by the remote host has been verified.</dd>
<dt class="list-tag" style="margin-top: 1.00em;">
<b class="cmd">relay via</b> <i class="arg">host</i> [<span class="opt"><b class="cmd">auth</b> <code class="none">&lt;</code><i class="arg">auth</i>&gt;</span>] [<span class="opt"><b class="cmd">as</b> <i class="arg">address</i></span>] [<span class="opt"><b class="cmd">source</b> <code class="none">&lt;</code><i class="arg">source</i>&gt;</span>] [<span class="opt"><b class="cmd">hostname</b> <i class="arg">name</i></span>] [<span class="opt"><b class="cmd">hostnames</b> <code class="none">&lt;</code><i class="arg">names</i>&gt;</span>] [<span class="opt"><b class="cmd">pki</b> <i class="arg">pkiname</i></span>] [<span class="opt"><b class="cmd">verify</b></span>]</dt>
<dd class="list-tag" style="margin-left: 6.00ex;">
<div class="spacer">
</div>
Mail is relayed through the specified <i class="arg">host</i> expressed as a URL. For example:<div class="spacer">
</div>
<pre style="margin-left: 5.00ex;" class="lit display">
smtp://mx1.example.org		# use SMTP 
smtp://mx1.example.org:4321	# use SMTP \ 
				# with port 4321 
lmtp://localhost:2026		# use LMTP \ 
				# with port 2026</pre>
<div class="spacer">
</div>
The communication channel may be secured using one of the secure schemas. For example:<div class="spacer">
</div>
<pre style="margin-left: 5.00ex;" class="lit display">
tls://mx1.example.org		# use TLS 
smtps://mx1.example.org		# use SMTPS 
secure://mx1.example.org	# try SMTPS and \ 
				# fallback to TLS</pre>
<div class="spacer">
</div>
In addition, credentials for authenticated relaying may be provided when using a secure schema. For example:<div class="spacer">
</div>
<pre style="margin-left: 5.00ex;" class="lit display">
tls+auth://label@@mx.example.org		# over TLS 
smtps+auth://label@@mx.example.org	# over SMTPS 
secure+auth://label@@mx.example.org	# over either \ 
					# SMTPS or TLS</pre>
<div class="spacer">
</div>
If a pki entry exists for the outgoing hostname, or one is provided with <i class="arg">pkiname</i>, the associated certificate will be sent to the remote server.<div class="spacer">
</div>
If an SMTPAUTH session with <i class="arg">host</i> is desired, the <b class="cmd">auth</b> parameter is used to specify the <i class="arg">auth</i> table that holds the credentials. Credentials will be looked up using the label provided in the URL.<div class="spacer">
</div>
If the <b class="cmd">as</b> parameter is specified, <a class="link-man">smtpd(8)</a> will rewrite the sender advertised in the SMTP session. <i class="arg">address</i> may be a user, a domain prefixed with &#8216;@@&#8217;, or an email address, causing smtpd to rewrite the user-part, the domain-part, or the entire address, respectively.<div class="spacer">
</div>
If the <b class="cmd">source</b> parameter is specified, <a class="link-man">smtpd(8)</a> will explicitly bind to an address found in the table referenced by &lt;<i class="arg">source</i>&gt; when connecting to the relay. If the table contains more than one address, they are picked in turn each time a new connection is opened.<div class="spacer">
</div>
By default, when connecting to a remote server, <a class="link-man">smtpd(8)</a> advertises its default server name. A <b class="cmd">hostname</b> parameter may be specified to advertise the alternate hostname <i class="arg">name</i>. If the <b class="cmd">source</b> parameter is used, the <b class="cmd">hostnames</b> parameter may be specified to advertise a hostname based on the source address. Table <i class="arg">names</i> contains a mapping of IP addresses to hostnames and <a class="link-man">smtpd(8)</a> will automatically select the name that matches its source address when connected to the remote server. The <b class="cmd">hostname</b> and <b class="cmd">hostnames</b> parameters are mutually exclusive.</dd>
</dl>
<div class="spacer">
</div>
If <b class="cmd">verify</b> is specified, OpenSMTPD will refuse to relay unless the remote host provides STARTTLS and the certificate it presented has been verified. The relay URL must specify TLS for this option to be valid.<div class="spacer">
</div>
Additional per-rule adjustments available:<dl style="margin-top: 0.00em;margin-bottom: 0.00em;" class="list list-tag">
<dt class="list-tag" style="margin-top: 1.00em;">
<b class="cmd">expire</b> <i class="arg">n</i>{<b class="flag">s</b>|<b class="flag">m</b>|<b class="flag">h</b>|<b class="flag">d</b>}</dt>
<dd class="list-tag" style="margin-left: 6.00ex;">
Specify how long a message that matched this rule can stay in the queue.</dd>
</dl>
</dd>
<dt class="list-tag" style="margin-top: 1.00em;">
<b class="cmd">bounce-warn</b> <i class="arg">n</i>{<b class="flag">s</b>|<b class="flag">m</b>|<b class="flag">h</b>|<b class="flag">d</b>}[<span class="opt">, <i class="arg">...</i></span>]</dt>
<dd class="list-tag" style="margin-left: 6.00ex;">
Specify the delays for which temporary failure reports must be generated when messages are stuck in the queue. For example:<div class="spacer">
</div>
<pre style="margin-left: 5.00ex;" class="lit display">
bounce-warn	1h, 6h, 2d</pre>
<div class="spacer">
</div>
will generate a failure report when an envelope is in the queue for more than one hour, six hours and two days. The default is 4h.</dd>
<dt class="list-tag" style="margin-top: 1.00em;">
<b class="cmd">ca</b> <i class="arg">hostname</i> <b class="cmd">certificate</b> <i class="arg">cafile</i></dt>
<dd class="list-tag" style="margin-left: 6.00ex;">
Associate a custom CA certificate <i class="arg">cafile</i> with <i class="arg">hostname</i>.</dd>
<dt class="list-tag" style="margin-top: 1.00em;">
<b class="cmd">ciphers</b> <i class="arg">cipher-list</i></dt>
<dd class="list-tag" style="margin-left: 6.00ex;">
Specify an alternate ciphers list to use when establishing TLS sessions. It is highly recommanded to avoid making use of this option unless there is a good understanding of the implications.<div class="spacer">
</div>
When not specified, only ciphers considered safe are chosen.</dd>
<dt class="list-tag" style="margin-top: 1.00em;">
<b class="cmd">curve</b> <i class="arg">curve-name</i></dt>
<dd class="list-tag" style="margin-left: 6.00ex;">
Specify an alternate curve for ECDHE-based cipher suites. If no curve is specified, the default curve prime256v1 will be used.</dd>
<dt class="list-tag" style="margin-top: 1.00em;">
<b class="cmd">expire</b> <i class="arg">n</i>{<b class="flag">s</b>|<b class="flag">m</b>|<b class="flag">h</b>|<b class="flag">d</b>}</dt>
<dd class="list-tag" style="margin-left: 6.00ex;">
Specify how long a message can stay in the queue. The default value is 4 days. For example:<div class="spacer">
</div>
<pre style="margin-left: 5.00ex;" class="lit display">
expire 4d	# expire after 4 days 
expire 10h	# expire after 10 hours</pre>
</dd>
<dt class="list-tag" style="margin-top: 1.00em;">
<b class="cmd">limit session</b> {<b class="flag">max-rcpt</b> | <b class="flag">max-mails</b>} <i class="arg">num</i></dt>
<dd class="list-tag" style="margin-left: 6.00ex;">
Instruct <a class="link-man">smtpd(8)</a> to accept a maximum number of recipients or emails at once in the receiving queue. Defaults are 100 for <b class="cmd">max-mails</b> and 1000 for <b class="cmd">max-rcpt</b>.</dd>
<dt class="list-tag" style="margin-top: 1.00em;">
<b class="cmd">limit mta</b> [<span class="opt"><b class="cmd">for</b> <b class="cmd">domain</b> <i class="arg">domain</i></span>] <i class="arg">family</i></dt>
<dd class="list-tag" style="margin-left: 6.00ex;">
Instruct <a class="link-man">smtpd(8)</a> to only use the specified address <i class="arg">family</i> for outgoing connections. Accepted values are <b class="cmd">inet4</b> and <b class="cmd">inet6</b>. If a <i class="arg">domain</i> is specified, the restriction only applies when connecting to MXs for this domain.</dd>
<dt class="list-tag" style="margin-top: 1.00em;">
<b class="cmd">limit scheduler max-inflight</b> <i class="arg">num</i></dt>
<dd class="list-tag" style="margin-left: 6.00ex;">
Suspend the scheduling of envelopes for deliver/relay until the number of inflight envelopes falls below <i class="arg">num</i>. Changing the default value might degrade performances.</dd>
<dt class="list-tag" style="margin-top: 1.00em;">
<b class="cmd">listen on</b>&#160;<i class="arg">interface</i> [<span class="opt"><i class="arg">family</i></span>] [<span class="opt"><b class="cmd">port</b>&#160;<i class="arg">port</i></span>] [<span class="opt"><b class="cmd">tls</b>&#160;|&#160;<b class="cmd">tls-require</b>&#160;|&#160;<b class="cmd">tls-require&#160;verify</b>&#160;|&#160;<b class="cmd">smtps</b>&#160;|&#160;<b class="cmd">secure</b></span>] [<span class="opt"><b class="cmd">pki</b>&#160;<i class="arg">pkiname</i></span>] [<span class="opt"><b class="cmd">auth</b>&#160;|&#160;<b class="cmd">auth-optional</b>&#160;[<span class="opt">&lt;<i class="arg">authtable</i>&gt;</span>]</span>] [<span class="opt"><b class="cmd">tag</b>&#160;<i class="arg">tag</i></span>] [<span class="opt"><b class="cmd">hostname</b>&#160;<i class="arg">hostname</i></span>] [<span class="opt"><b class="cmd">hostnames</b>&#160;<code class="none">&lt;</code><i class="arg">names</i>&gt;</span>] [<span class="opt"><b class="cmd">senders</b>&#160;<code class="none">&lt;</code><i class="arg">users</i>&gt;&#160;[<span class="opt">masquerade</span>]</span>] [<span class="opt"><b class="cmd">mask-source</b></span>] [<span class="opt"><b class="cmd">no-dsn</b></span>] [<span class="opt"><b class="cmd">dsn-notify</b>&#160;<i class="arg">disable</i></span>] [<span class="opt"><b class="cmd">dsn-ret</b>&#160;<i class="arg">headers</i></span>]</dt>
<dd class="list-tag" style="margin-left: 6.00ex;">
<div class="spacer">
</div>
Specify an <i class="arg">interface</i> and <i class="arg">port</i> to listen on. An interface group, an IP address or a domain name may be used in place of <i class="arg">interface</i>. The <i class="arg">family</i> parameter can be used to listen only on specific address family. Accepted values are <b class="cmd">inet4</b> and <b class="cmd">inet6</b>.<div class="spacer">
</div>
Secured connections are provided either using STARTTLS (<b class="cmd">tls</b>), by default on port 25, or SMTPS (<b class="cmd">smtps</b>), by default on port 465. <b class="cmd">tls-require</b> may be used to force clients to establish a secure connection before being allowed to start an SMTP transaction.<div class="spacer">
</div>
If <b class="cmd">tls-require verify</b> is specified, the client must provide a valid certificate to be able to establish an SMTP session.<div class="spacer">
</div>
<b class="cmd">secure</b> may be specified to provide both STARTTLS and SMTPS services. Host certificates may be used for these connections, and must be priorly declared using the pki directive. If <b class="cmd">pki</b> is specified, a certificate matching <b class="cmd">name</b> is searched for.<div class="spacer">
</div>
If the <b class="cmd">auth</b> parameter is used, then a client may only start an SMTP transaction after a successful authentication. Any remote sender that passed SMTPAUTH is treated as if it was the server's local user that was sending the mail. This means that filter rules using <b class="cmd">from local</b> will be matched. If <b class="cmd">auth-optional</b> is specified, then SMTPAUTH is not required to establish an SMTP transaction. This is only useful to let a listener accept incoming mail from untrusted senders and outgoing mail from authenticated users in situations where it is not possible to listen on the submission port.<div class="spacer">
</div>
Both <b class="cmd">auth</b> and <b class="cmd">auth-optional</b> accept an optional table as a parameter. When provided, credentials are looked up in this table. Credentials format is described in <a class="link-man">table(5)</a>.<div class="spacer">
</div>
If the <b class="cmd">tag</b> parameter is used, then clients connecting to the listener will be tagged <i class="arg">tag</i>.<div class="spacer">
</div>
If the <b class="cmd">hostname</b> parameter is used, then it will be used in the greeting banner instead of the default server name.<div class="spacer">
</div>
The <b class="cmd">hostnames</b> parameter overrides the server name for specific addresses. Table <i class="arg">names</i> contains a mapping of IP addresses to hostnames and <a class="link-man">smtpd(8)</a> will use the hostname that matches the address on which the connection arrives if it is found in the mapping.<div class="spacer">
</div>
The <b class="cmd">hostnames</b> parameter overrides the server name for specific addresses. Table <i class="arg">names</i> contains a mapping of IP addresses to hostnames and <a class="link-man">smtpd(8)</a> will use the hostname that matches the address on which the connection arrives if it is found in the mapping.<div class="spacer">
</div>
If the <b class="cmd">senders</b> parameter is used, then <a class="link-man">smtpd(8)</a> will lookup in a mapping of username to email addresses if the authenticated user is allowed to submit mail as the sender that was provided in the SMTP session. In addition, if the masquerade option is provided, the From header will be rewritten to match the sender provided in the SMTP session.<div class="spacer">
</div>
If the <b class="cmd">mask-source</b> parameter is used, then the listener will skip the <b class="cmd">from</b> part when prepending the &#8220;Received&#8221; header.<div class="spacer">
</div>
If the <b class="cmd">no-dsn</b> parameter is used, DSN (Delivery Status Notification) extension will not be enabled. If the <b class="cmd">dsn-notify</b> parameter is used with the <i class="arg">disable</i> argument, the listener will not generate DSN upon delivery failures. If the <b class="cmd">dsn-ret</b> parameter is used with the <i class="arg">headers</i> argument, DSN will be generated without the content of the original message.</dd>
<dt class="list-tag" style="margin-top: 1.00em;">
<b class="cmd">max-message-size</b> <i class="arg">n</i></dt>
<dd class="list-tag" style="margin-left: 6.00ex;">
Specify a maximum message size of <i class="arg">n</i> bytes. The argument may contain a multiplier, as documented in <a class="link-man">scan_scaled(3)</a>. The default maximum message size is 35MB if none is specified.</dd>
<dt class="list-tag" style="margin-top: 1.00em;">
<b class="cmd">pki</b> <i class="arg">hostname</i> <b class="cmd">certificate</b> <i class="arg">certfile</i></dt>
<dd class="list-tag" style="margin-left: 6.00ex;">
Associate the certificate located in <i class="arg">certfile</i> with <i class="arg">hostname</i>.<div class="spacer">
</div>
A certificate chain may be created by appending one or many certificates, including a Certificate Authority certificate, to <i class="arg">certfile</i>.<div class="spacer">
</div>
Creation of certificates is documented in <a class="link-man">starttls(8)</a>.</dd>
<dt class="list-tag" style="margin-top: 1.00em;">
<b class="cmd">pki</b> <i class="arg">hostname</i> <b class="cmd">key</b> <i class="arg">keyfile</i></dt>
<dd class="list-tag" style="margin-left: 6.00ex;">
Associate the key located in <i class="arg">keyfile</i> with <i class="arg">hostname</i>.</dd>
<dt class="list-tag" style="margin-top: 1.00em;">
<b class="cmd">pki</b> <i class="arg">hostname</i> <b class="cmd">dhparams</b> <i class="arg">dhfile</i></dt>
<dd class="list-tag" style="margin-left: 6.00ex;">
Associate the Diffie-Hellman parameters located in <i class="arg">dhfile</i> with <i class="arg">hostname</i>.<div class="spacer">
</div>
The parameters are used for ephemeral key exchange. If not specified, OpenSMTPD will use safely generated builtin parameters.<div class="spacer">
</div>
Creation of Diffie-Hellman parameters is documented in <a class="link-man">openssl(1)</a>.</dd>
<dt class="list-tag" style="margin-top: 1.00em;">
<b class="cmd">queue compression</b></dt>
<dd class="list-tag" style="margin-left: 6.00ex;">
Enable transparent compression of envelopes and messages. The only supported algorithm at the moment is gzip. Envelopes and messages may be inspected using the <a class="link-man">smtpctl(8)</a> or <a class="link-man">gzcat(1)</a> utilities.</dd>
<dt class="list-tag" style="margin-top: 1.00em;">
<b class="cmd">queue encryption</b> [<span class="opt">key <i class="arg">key</i></span>]</dt>
<dd class="list-tag" style="margin-left: 6.00ex;">
Enable transparent encryption of envelopes and messages. <i class="arg">key</i> must be a 16-byte random key in hexadecimal representation. It can be obtained using the <a class="link-man">openssl(1)</a> utility as follow:<div class="spacer">
</div>
<pre style="margin-left: 5.00ex;" class="lit display">
$ openssl rand -hex 16</pre>
<div class="spacer">
</div>
If the <i class="arg">key</i> parameter is not specified, it is read with <a class="link-man">getpass(3)</a> at startup. If <i class="arg">key</i> is <b class="cmd">stdin</b>, then it is read from the standard input at startup.<div class="spacer">
</div>
The only supported algorithm is AES-256 in GCM mode. Envelopes and messages may be inspected using the <a class="link-man">smtpctl(8)</a> utility.<div class="spacer">
</div>
Queue encryption can be used with queue compression and will always perform compression before encryption.</dd>
<dt class="list-tag" style="margin-top: 1.00em;">
<b class="cmd">table</b> <i class="arg">name</i> [<span class="opt"><i class="arg">type</i>:</span>]<i class="arg">config</i></dt>
<dd class="list-tag" style="margin-left: 6.00ex;">
Tables are used to provide additional configuration information for <a class="link-man">smtpd(8)</a> in the form of lists or key-value mappings. The format of the entries depends on what the table is used for. Refer to <a class="link-man">table(5)</a> for the exhaustive documentation.<div class="spacer">
</div>
The table is identified using table name <i class="arg">name</i>; the name itself is arbitrarily chosen.<div class="spacer">
</div>
<i class="arg">type</i> specifies the table backend, and should be one of the following:<div class="spacer">
</div>
<dl style="margin-top: 0.00em;margin-bottom: 0.00em;" class="list list-tag">
<dt class="list-tag" style="margin-top: 0.00em;">
db</dt>
<dd class="list-tag" style="margin-left: 7.00ex;">
Information is stored in a file created using <a class="link-man">makemap(8)</a>.</dd>
<dt class="list-tag" style="margin-top: 0.00em;">
file</dt>
<dd class="list-tag" style="margin-left: 7.00ex;">
Information is stored in a plain text file using the same format as used to generate <a class="link-man">makemap(8)</a> mappings. This is the default.</dd>
</dl>
<div class="spacer">
</div>
<i class="arg">config</i> specifies a configuration file for the table data. It must be an absolute path to a file for the &#8220;file&#8221; and &#8220;db&#8221; table types.</dd>
<dt class="list-tag" style="margin-top: 1.00em;">
<b class="cmd">table</b> <i class="arg">name</i> {<i class="arg">value</i> [<span class="opt">, <i class="arg">...</i></span>]}</dt>
<dd class="list-tag" style="margin-left: 6.00ex;">
Tables containing list of static values may be declared using an inlined notation.<div class="spacer">
</div>
The table is identified using table name <i class="arg">name</i>; the name itself is arbitrarily chosen.<div class="spacer">
</div>
The table must contain at least one value and may declare many values as a list of comma separated strings.</dd>
<dt class="list-tag" style="margin-top: 1.00em;">
<b class="cmd">table</b> <i class="arg">name</i> {<i class="arg">key</i>=<i class="arg">value</i> [<span class="opt">, <i class="arg">...</i></span>]}</dt>
<dd class="list-tag" style="margin-left: 6.00ex;">
Tables containing static key-value mappings may be declared using an inlined notation.<div class="spacer">
</div>
The table is identified using table name <i class="arg">name</i>; the name itself is arbitrarily chosen.<div class="spacer">
</div>
The table must contain at least one key-value mapping and may declare many mappings as a list of comma separated <i class="arg">key</i>=<i class="arg">value</i> descriptions.</dd>
</dl>
<div class="subsection">
<h2 id="x464f524d41542053504543494649455253">FORMAT SPECIFIERS</h2> Some configuration directives support expansion of their parameters at runtime. Such directives (for example <b class="cmd">deliver to maildir</b>, <b class="cmd">deliver to mda</b>) may use format specifiers which will be expanded before delivery or relaying. The following formats are currently supported:<table style="margin-top: 0.00em;margin-bottom: 0.00em;margin-left: 6.00ex;" class="list list-col">
<col style="min-width: 17.00ex;"/>
<tbody>
<tr class="list-col">
<td class="list-col" style="margin-top: 1.00em;">
%{sender}</td>
<td class="list-col" style="margin-top: 1.00em;">
sender email address</td>
</tr>
<tr class="list-col">
<td class="list-col" style="margin-top: 1.00em;">
%{sender.user}</td>
<td class="list-col" style="margin-top: 1.00em;">
user part of the sender email address</td>
</tr>
<tr class="list-col">
<td class="list-col" style="margin-top: 1.00em;">
%{sender.domain}</td>
<td class="list-col" style="margin-top: 1.00em;">
domain part of the sender email address</td>
</tr>
<tr class="list-col">
<td class="list-col" style="margin-top: 1.00em;">
%{rcpt}</td>
<td class="list-col" style="margin-top: 1.00em;">
recipient email address</td>
</tr>
<tr class="list-col">
<td class="list-col" style="margin-top: 1.00em;">
%{rcpt.user}</td>
<td class="list-col" style="margin-top: 1.00em;">
user part of the recipient email address</td>
</tr>
<tr class="list-col">
<td class="list-col" style="margin-top: 1.00em;">
%{rcpt.domain}</td>
<td class="list-col" style="margin-top: 1.00em;">
domain part of the recipient email address</td>
</tr>
<tr class="list-col">
<td class="list-col" style="margin-top: 1.00em;">
%{dest}</td>
<td class="list-col" style="margin-top: 1.00em;">
recipient email address after expansion</td>
</tr>
<tr class="list-col">
<td class="list-col" style="margin-top: 1.00em;">
%{dest.user}</td>
<td class="list-col" style="margin-top: 1.00em;">
user part after expansion</td>
</tr>
<tr class="list-col">
<td class="list-col" style="margin-top: 1.00em;">
%{dest.domain}</td>
<td class="list-col" style="margin-top: 1.00em;">
domain part after expansion</td>
</tr>
<tr class="list-col">
<td class="list-col" style="margin-top: 1.00em;">
%{user.username}</td>
<td class="list-col" style="margin-top: 1.00em;">
local user</td>
</tr>
<tr class="list-col">
<td class="list-col" style="margin-top: 1.00em;">
%{user.directory}</td>
<td class="list-col" style="margin-top: 1.00em;">
home directory of the local user</td>
</tr>
</tbody>
</table>
<div class="spacer">
</div>
Expansion formats also support partial expansion using the optional bracket notations with substring offset. For example, with recipient domain &#8220;example.org&#8221;:<table style="margin-top: 0.00em;margin-bottom: 0.00em;margin-left: 6.00ex;" class="list list-col">
<col style="min-width: 20.00ex;"/>
<tbody>
<tr class="list-col">
<td class="list-col" style="margin-top: 1.00em;">
%{rcpt.domain[0]}</td>
<td class="list-col" style="margin-top: 1.00em;">
expands to &#8220;e&#8221;</td>
</tr>
<tr class="list-col">
<td class="list-col" style="margin-top: 1.00em;">
%{rcpt.domain[1]}</td>
<td class="list-col" style="margin-top: 1.00em;">
expands to &#8220;x&#8221;</td>
</tr>
<tr class="list-col">
<td class="list-col" style="margin-top: 1.00em;">
%{rcpt.domain[8:]}</td>
<td class="list-col" style="margin-top: 1.00em;">
expands to &#8220;org&#8221;</td>
</tr>
<tr class="list-col">
<td class="list-col" style="margin-top: 1.00em;">
%{rcpt.domain[-3:]}</td>
<td class="list-col" style="margin-top: 1.00em;">
expands to &#8220;org&#8221;</td>
</tr>
<tr class="list-col">
<td class="list-col" style="margin-top: 1.00em;">
%{rcpt.domain[0:6]}</td>
<td class="list-col" style="margin-top: 1.00em;">
expands to &#8220;example&#8221;</td>
</tr>
<tr class="list-col">
<td class="list-col" style="margin-top: 1.00em;">
%{rcpt.domain[0:-4]}</td>
<td class="list-col" style="margin-top: 1.00em;">
expands to &#8220;example&#8221;</td>
</tr>
</tbody>
</table>
<div class="spacer">
</div>
In addition, modifiers may be applied to the token. For example, with recipient &#8220;User+Tag@@Example.org&#8221;:<table style="margin-top: 0.00em;margin-bottom: 0.00em;margin-left: 6.00ex;" class="list list-col">
<col style="min-width: 23.00ex;"/>
<tbody>
<tr class="list-col">
<td class="list-col" style="margin-top: 1.00em;">
%{rcpt:lowercase}</td>
<td class="list-col" style="margin-top: 1.00em;">
expands to &#8220;user+tag@@example.org&#8221;</td>
</tr>
<tr class="list-col">
<td class="list-col" style="margin-top: 1.00em;">
%{rcpt:uppercase}</td>
<td class="list-col" style="margin-top: 1.00em;">
expands to &#8220;USER+TAG@@EXAMPLE.ORG&#8221;</td>
</tr>
<tr class="list-col">
<td class="list-col" style="margin-top: 1.00em;">
%{rcpt:strip}</td>
<td class="list-col" style="margin-top: 1.00em;">
expands to &#8220;User@@Example.org&#8221;</td>
</tr>
<tr class="list-col">
<td class="list-col" style="margin-top: 1.00em;">
%{rcpt:lowercase|strip}</td>
<td class="list-col" style="margin-top: 1.00em;">
expands to &#8220;user@@example.org&#8221;</td>
</tr>
</tbody>
</table>
<div class="spacer">
</div>
For security concerns, expanded values are sanitized and potentially dangerous characters are replaced with &#8216;:&#8217;. In situations where they are desirable, the &#8220;raw&#8221; modifier may be applied. For example, with recipient &#8220;user+t?g@@example.org&#8221;:<table style="margin-top: 0.00em;margin-bottom: 0.00em;margin-left: 6.00ex;" class="list list-col">
<col style="min-width: 11.00ex;"/>
<tbody>
<tr class="list-col">
<td class="list-col" style="margin-top: 1.00em;">
%{rcpt}</td>
<td class="list-col" style="margin-top: 1.00em;">
expands to &#8220;user+t:g@@example.org&#8221;</td>
</tr>
<tr class="list-col">
<td class="list-col" style="margin-top: 1.00em;">
%{rcpt:raw}</td>
<td class="list-col" style="margin-top: 1.00em;">
expands to &#8220;user+t?g@@example.org&#8221;</td>
</tr>
</tbody>
</table>
</div>
</div>
<div class="section">
<h1 id="x46494c4553">FILES</h1><dl style="margin-top: 0.00em;margin-bottom: 0.00em;" class="list list-tag">
<dt class="list-tag" style="margin-top: 1.00em;">
<i class="file">/etc/mail/smtpd.conf</i></dt>
<dd class="list-tag" style="margin-left: 23.00ex;">
Default <a class="link-man">smtpd(8)</a> configuration file.</dd>
<dt class="list-tag" style="margin-top: 1.00em;">
<i class="file">/etc/mail/mailname</i></dt>
<dd class="list-tag" style="margin-left: 23.00ex;">
If this file exists, the first line is used as the server name. Otherwise, the server name is derived from the local hostname returned by <a class="link-man">gethostname(3)</a>, either directly if it is a fully qualified domain name, or by retrieving the associated canonical name through <a class="link-man">getaddrinfo(3)</a>.</dd>
<dt class="list-tag" style="margin-top: 1.00em;">
<i class="file">/var/spool/smtpd/</i></dt>
<dd class="list-tag" style="margin-left: 23.00ex;">
Spool directories for mail during processing.</dd>
</dl>
</div>
<div class="section">
<h1 id="x4558414d504c4553">EXAMPLES</h1> The default <b class="name">smtpd.conf</b> file which ships with <span class="unix">OpenBSD</span> listens on the loopback network interface (lo0), and allows for mail from users and daemons on the local machine, as well as permitting email to remote servers. Some more complex configurations are given below.<div class="spacer">
</div>
This first example is the same as the default configuration, but all outgoing mail is forwarded to a remote SMTP server. A secrets file is needed to specify a username and password:<div class="spacer">
</div>
<pre style="margin-left: 5.00ex;" class="lit display">
# touch /etc/mail/secrets 
# chmod 640 /etc/mail/secrets 
# chown root:_smtpd /etc/mail/secrets 
# echo &quot;label username:password&quot; &gt; /etc/mail/secrets 
# makemap /etc/mail/secrets</pre>
<div class="spacer">
</div>
<b class="name">smtpd.conf</b> would look like this:<div class="spacer">
</div>
<pre style="margin-left: 5.00ex;" class="lit display">
listen on lo0 
table aliases db:/etc/mail/aliases.db 
table secrets db:/etc/mail/secrets.db 
accept for local alias &lt;aliases&gt; deliver to mbox 
accept for any relay via tls+auth://label@@smtp.example.com \ 
	auth &lt;secrets&gt;</pre>
<div class="spacer">
</div>
In this second example, the aim is to permit mail relaying for any user that can authenticate using their normal login credentials. An RSA certificate must be provided to prove the server's identity. The mail server listens on all interfaces the default route(s) point to. Mail with a local destination should be sent to an external mda. First, the RSA certificate is created:<div class="spacer">
</div>
<pre style="margin-left: 5.00ex;" class="lit display">
# openssl genrsa -out /etc/ssl/private/mail.example.com.key 4096 
# openssl req -new -x509 -key /etc/ssl/private/mail.example.com.key \ 
	-out /etc/ssl/mail.example.com.crt -days 365 
# chmod 600 /etc/ssl/mail.example.com.crt 
# chmod 600 /etc/ssl/private/mail.example.com.key</pre>
<div class="spacer">
</div>
In the example above, a certificate valid for one year was created. The configuration file would look like this:<div class="spacer">
</div>
<pre style="margin-left: 5.00ex;" class="lit display">
pki mail.example.com certificate &quot;/etc/ssl/mail.example.com.crt&quot; 
pki mail.example.com key &quot;/etc/ssl/private/mail.example.com.key&quot; 
 
listen on lo0 
listen on egress tls pki mail.example.com auth 
 
table aliases db:/etc/mail/aliases.db 
 
accept for local alias &lt;aliases&gt; deliver to mda &quot;/path/to/mda -f -&quot; 
accept from any for domain example.com \ 
	deliver to mda &quot;/path/to/mda -f -&quot; 
accept for any relay</pre>
<div class="spacer">
</div>
For sites that wish to sign messages using DKIM, the <span class="emph">dkimproxy</span> package may be used as a filter. The following example is the same as the default configuration, but all outgoing mail is passed to dkimproxy_out on port 10027 for signing. The signed messages are received on port 10028 and tagged for relaying.<div class="spacer">
</div>
<pre style="margin-left: 5.00ex;" class="lit display">
listen on lo0 
listen on lo0 port 10028 tag DKIM 
 
table aliases db:/etc/mail/aliases.db 
 
accept for local alias &lt;aliases&gt; deliver to mbox 
accept tagged DKIM for any relay 
accept from local for any relay via smtp://127.0.0.1:10027</pre>
<div class="spacer">
</div>
Sites that accept non-local messages may be able to cut down on the volume of spam received by rejecting forged messages that claim to be from the local domain. The table <span class="emph">other-relays</span> can be used to specify the IP addresses of relays that may legitimately originate mail with your domain as the sender.<div class="spacer">
</div>
<pre style="margin-left: 5.00ex;" class="lit display">
listen on lo0 
listen on egress 
 
table aliases	db:/etc/mail/aliases.db 
table other-relays &quot;/etc/mail/other-relays&quot; 
 
accept for local alias &lt;aliases&gt; deliver to mbox 
accept for local for any relay 
reject from ! source &lt;other-relays&gt; sender &quot;@@example.com&quot; for any 
accept from any for domain example.com \ 
	alias &lt;aliases&gt; deliver to mbox</pre>
</div>
<div class="section">
<h1 id="x53454520414c534f">SEE ALSO</h1> <a class="link-man">mailer.conf(5)</a>, <a class="link-man">table(5)</a>, <a class="link-man">makemap(8)</a>, <a class="link-man">smtpd(8)</a></div>
<div class="section">
<h1 id="x484953544f5259">HISTORY</h1> <a class="link-man">smtpd(8)</a> first appeared in <span class="unix">OpenBSD&#160;4.6</span>.</div>
</div>
</body>
</html>

@


1.4
log
@update
@
text
@@


1.3
log
@update man pages
@
text
@d1 1
a1 1
<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01//EN" "http://www.w3.org/TR/html4/strict.dtd">
d4 9
a12 2
<meta http-equiv="Content-Type" content="text/html; charset=utf-8">
<meta name="resource-type" content="document">
a17 15
<table summary="Document Header" class="head" width="100%">
<col width="30%">
<col width="30%">
<col width="30%">
<tbody>
<tr>
<td class="head-ltitle">
SMTPD.CONF(5)</td>
<td class="head-vol" align="center">
OpenBSD Programmer's Manual</td>
<td class="head-rtitle" align="right">
SMTPD.CONF(5)</td>
</tr>
</tbody>
</table>
d21 10
a30 5
<h1 id="x4445534352495054494f4e">DESCRIPTION</h1> <b class="name">smtpd.conf</b> is the configuration file for the mail daemon <a class="link-man">smtpd(8)</a>.<p>
The current line can be extended over multiple lines using a backslash (&#8216;&#92;&#8217;). Comments can be put anywhere in the file using a hash mark (&#8216;#&#8217;), and extend to the end of the current line. Care should be taken when commenting out multi-line text: the comment is effective until the end of the entire block.<p>
Argument names not beginning with a letter, digit, or underscore must be quoted. Arguments containing whitespace should be surrounded by double quotes (").<p>
Macros can be defined that will later be expanded in context. Macro names must start with a letter, digit, or underscore, and may contain any of those characters. Macro names may not be reserved words (for example <i class="arg">listen</i>, <i class="arg">accept</i>, <i class="arg">port</i>). Macros are not expanded inside quotes.<p>
For example:<p>
d32 1
a32 1
lan_addr = "192.168.0.1" 
d35 4
a38 2
<p>
Additional configuration files can be included with the <b class="cmd">include</b> keyword, for example:<p>
d40 3
a42 2
include "/etc/mail/smtpd.conf.local"</pre>
<p>
d47 4
a50 2
<a class="link-man">smtpd(8)</a> accepts and rejects messages based on information gathered during the SMTP session.<p>
For each message processed by the daemon, the filter rules are evaluated in sequential order, from first to last. The first matching rule decides what action is taken. If no rule matches the message, the default action is to reject the message. An exclamation mark may be specified to perform a reverse match.<p>
d53 1
a53 1
<b class="cmd">tagged</b> &#91;<span class="opt"><b class="cmd">!</b></span>&#93; <b class="cmd">tag</b></dt>
d57 2
a58 1
<p>
d65 1
a65 1
<b class="cmd">from</b> &#91;<span class="opt"><b class="cmd">!</b></span>&#93; <b class="cmd">local</b></dt>
d69 1
a69 1
<b class="cmd">from</b> &#91;<span class="opt"><b class="cmd">!</b></span>&#93; <b class="cmd">source</b> <b class="cmd">table</b></dt>
d73 2
a74 1
<p>
d77 1
a77 1
<b class="cmd">sender</b> &#91;<span class="opt"><b class="cmd">!</b></span>&#93; <b class="cmd">senders</b></dt>
d81 2
a82 1
<p>
d85 1
a85 1
<b class="cmd">for any</b> &#91;<span class="opt"><b class="cmd">alias</b> &#60;<i class="arg">aliases</i>&#62;</span>&#93;</dt>
d89 1
a89 1
<b class="cmd">for any virtual</b> &#60;<i class="arg">vmap</i>&#62;</dt>
d93 1
a93 1
<b class="cmd">for</b> &#91;<span class="opt"><b class="cmd">!</b></span>&#93; <b class="cmd">domain</b> <i class="arg">domain</i> &#91;<span class="opt"><b class="cmd">alias</b> &#60;<i class="arg">aliases</i>&#62;</span>&#93;</dt>
d95 2
a96 1
This rule applies to mail destined for the specified <i class="arg">domain</i>. This parameter supports the &#8216;*&#8217; wildcard, so that a single rule for all sub-domains can be used, for example:<p>
d98 3
a100 2
accept for domain "*.example.com" deliver to mbox</pre>
<p>
d103 1
a103 1
<b class="cmd">for</b> &#91;<span class="opt"><b class="cmd">!</b></span>&#93; <b class="cmd">domain</b> &#60;<i class="arg">domains</i>&#62; &#91;<span class="opt"><b class="cmd">alias</b> &#60;<i class="arg">aliases</i>&#62;</span>&#93;</dt>
d105 2
a106 1
This rule applies to mail destined to domains which are part of the table <i class="arg">domains</i>.<p>
d109 1
a109 1
<b class="cmd">for</b> &#91;<span class="opt"><b class="cmd">!</b></span>&#93; <b class="cmd">domain</b> <i class="arg">domain</i> <b class="cmd">virtual</b> &#60;<i class="arg">users</i>&#62;</dt>
d111 2
a112 1
This rule applies to mail destined for the specified virtual <i class="arg">domain</i>. This parameter supports the &#8216;*&#8217; wildcard, so that a single rule for all sub-domains can be used, for example:<p>
d114 1
a114 1
accept for domain "*.example.com" &#92; 
d116 2
a117 1
<p>
d120 1
a120 1
<b class="cmd">for</b> &#91;<span class="opt"><b class="cmd">!</b></span>&#93; <b class="cmd">domain</b> &#60;<i class="arg">domains</i>&#62; <b class="cmd">virtual</b> &#60;<i class="arg">users</i>&#62;</dt>
d122 2
a123 1
This rule applies to mail destined for the virtual domains specified in the table <i class="arg">domains</i>.<p>
d126 1
a126 1
<b class="cmd">for</b> &#91;<span class="opt"><b class="cmd">!</b></span>&#93; <b class="cmd">local</b> &#91;<span class="opt"><b class="cmd">alias</b> &#60;<i class="arg">aliases</i>&#62;</span>&#93;</dt>
d130 1
a130 1
<b class="cmd">for</b> &#91;<span class="opt"><b class="cmd">!</b></span>&#93; <b class="cmd">local</b> <b class="cmd">virtual</b> &#60;<i class="arg">vmap</i>&#62;</dt>
d134 2
a135 1
<p>
d138 1
a138 1
<b class="cmd">recipient</b> &#91;<span class="opt"><b class="cmd">!</b></span>&#93; <i class="arg">recipients</i></dt>
d142 2
a143 1
<p>
d146 1
a146 1
&#91;<span class="opt"><b class="cmd">userbase</b> &#60;<i class="arg">table</i>&#62;</span>&#93;</dt>
d150 16
a165 1
<p>
d168 1
a168 1
<b class="cmd">deliver to lmtp</b> &#91;<span class="opt"><i class="arg">host</i>:<i class="arg">port</i> | <i class="arg">socket</i></span>&#93;</dt>
d174 1
a174 1
Mail is added to a maildir. Its location, <i class="arg">path</i>, may contain format specifiers that are expanded before use (see above). If <i class="arg">path</i> is not provided, then <i class="file">~/Maildir</i> is assumed.</dd>
d182 1
a182 1
Mail is piped to the specified <i class="arg">program</i>, which is run with the privileges of the user the message is destined to. This parameter may use conversion specifiers that are expanded before use (see above).</dd>
d184 1
a184 1
<b class="cmd">relay</b> &#91;<span class="opt"><b class="cmd">backup</b> &#91;<span class="opt"><i class="arg">mx</i></span>&#93;</span>&#93; &#91;<span class="opt"><b class="cmd">as</b> <i class="arg">address</i></span>&#93; &#91;<span class="opt"><b class="cmd">source</b> <i class="arg">source</i></span>&#93; &#91;<span class="opt"><b class="cmd">hostname</b>&#160;<i class="arg">name</i></span>&#93; &#91;<span class="opt"><b class="cmd">hostnames</b>&#160;<i class="arg">names</i></span>&#93; &#91;<span class="opt"><b class="cmd">pki</b> <i class="arg">pkiname</i></span>&#93; &#91;<span class="opt"><b class="cmd">tls</b> | <b class="cmd">verify</b></span>&#93;</dt>
d186 17
a202 9
Mail is relayed. The routing decision is based on the DNS system.<p>
If the <b class="cmd">backup</b> parameter is specified, the current server will act as a backup server for the target domain. Accepted mails are only relayed through servers with a lower preference value in the MX record for the domain than the one specified in <i class="arg">mx</i>. If <i class="arg">mx</i> is not specified, the default server name will be assumed.<p>
If the <b class="cmd">as</b> parameter is specified, <a class="link-man">smtpd(8)</a> will rewrite the sender advertised in the SMTP session. <i class="arg">address</i> may be a user, a domain prefixed with &#8216;@@&#8217;, or an email address, causing smtpd to rewrite the user-part, the domain-part, or the entire address, respectively.<p>
If the <b class="cmd">source</b> parameter is specified, <a class="link-man">smtpd(8)</a> will explicitly bind to an address found in the table referenced by <i class="arg">source</i> when connecting to the relay. If the table contains more than one address, they are picked in turn each time a new connection is opened.<p>
By default, when connecting to a remote server, <a class="link-man">smtpd(8)</a> advertises its default server name. A <b class="cmd">hostname</b> parameter may be specified to advertise the alternate hostname <i class="arg">name</i>. If the <b class="cmd">source</b> parameter is used, the <b class="cmd">hostnames</b> parameter may be specified to advertise a hostname based on the source address. Table <i class="arg">names</i> contains a mapping of IP addresses to hostnames and <a class="link-man">smtpd(8)</a> will automatically select the name that matches its source address when connected to the remote server. The <b class="cmd">hostname</b> and <b class="cmd">hostnames</b> parameters are mutually exclusive.<p>
When relaying, STARTTLS is always attempted if available on remote host and OpenSMTPD will try to present a certificate matching the outgoing hostname if one is registered in the pki. If <b class="cmd">pki</b> is specified, the certificate registered for <i class="arg">pkiname</i> is used instead.<p>
If <b class="cmd">tls</b> is specified, OpenSMTPD will refuse to relay unless the remote host provides STARTTLS.<p>
If <b class="cmd">verify</b> is specified, OpenSMTPD will refuse to relay unless the remote host provides STARTTLS and the certificate it presented has been verified.<p>
Note that the <b class="cmd">tls</b> and <b class="cmd">verify</b> options are mutually exclusive and should only be used in private networks as they will prevent proper relaying on the Internet.</dd>
d204 1
a204 1
<b class="cmd">relay via</b> <i class="arg">host</i> &#91;<span class="opt"><b class="cmd">auth</b> &#60;<i class="arg">auth</i>&#62;</span>&#93; &#91;<span class="opt"><b class="cmd">as</b> <i class="arg">address</i></span>&#93; &#91;<span class="opt"><b class="cmd">source</b> <i class="arg">source</i></span>&#93; &#91;<span class="opt"><b class="cmd">hostname</b> <i class="arg">name</i></span>&#93; &#91;<span class="opt"><b class="cmd">hostnames</b> <i class="arg">names</i></span>&#93; &#91;<span class="opt"><b class="cmd">pki</b> <i class="arg">pkiname</i></span>&#93; &#91;<span class="opt"><b class="cmd">verify</b></span>&#93;</dt>
d206 4
a209 1
Mail is relayed through the specified <i class="arg">host</i> expressed as a URL. For example:<p>
d212 1
a212 1
smtp://mx1.example.org:4321	# use SMTP &#92; 
d214 1
a214 1
lmtp://localhost:2026		# use LMTP &#92; 
d216 4
a219 2
<p>
The communication channel may be secured using one of the secure schemas. For example:<p>
d223 1
a223 1
secure://mx1.example.org	# try SMTPS and &#92; 
d225 4
a228 2
<p>
In addition, credentials for authenticated relaying may be provided when using a secure schema. For example:<p>
d232 1
a232 1
secure+auth://label@@mx.example.org	# over either &#92; 
d234 10
a243 5
<p>
If a pki entry exists for the outgoing hostname, or one is provided with <i class="arg">pkiname</i>, the associated certificate will be sent to the remote server.<p>
If an SMTPAUTH session with <i class="arg">host</i> is desired, the <b class="cmd">auth</b> parameter is used to specify the <i class="arg">auth</i> table that holds the credentials. Credentials will be looked up using the label provided in the URL.<p>
If the <b class="cmd">as</b> parameter is specified, <a class="link-man">smtpd(8)</a> will rewrite the sender advertised in the SMTP session. <i class="arg">address</i> may be a user, a domain prefixed with &#8216;@@&#8217;, or an email address, causing smtpd to rewrite the user-part, the domain-part, or the entire address, respectively.<p>
If the <b class="cmd">source</b> parameter is specified, <a class="link-man">smtpd(8)</a> will explicitly bind to an address found in the table referenced by <i class="arg">table</i> when connecting to the relay. If the table contains more than one address, they are picked in turn each time a new connection is opened.<p>
d246 4
a249 2
<p>
If <b class="cmd">verify</b> is specified, OpenSMTPD will refuse to relay unless the remote host provides STARTTLS and the certificate it presented has been verified. The relay URL must specify TLS for this option to be valid.<p>
d252 1
a252 1
<b class="cmd">expire</b> <i class="arg">n</i> &#123;<i class="arg">s|m|h|d</i>&#125;</dt>
d258 1
a258 1
<b class="cmd">bounce-warn</b> <i class="arg">n</i> &#123;<i class="arg">s|m|h|d</i>&#125; &#91;, <i class="arg">...</i>&#93;</dt>
d260 2
a261 1
Specify the delays for which temporary failure reports must be generated when messages are stuck in the queue. For example:<p>
d264 2
a265 1
<p>
d268 11
a278 1
<b class="cmd">expire</b> <i class="arg">n</i> &#123;<i class="arg">s|m|h|d</i>&#125;</dt>
d280 6
a285 1
Specify how long a message can stay in the queue. The default value is 4 days. For example:<p>
d291 5
a295 1
<b class="cmd">limit mta</b> &#91;<span class="opt"><b class="cmd">for</b> <b class="cmd">domain</b> <i class="arg">domain</i></span>&#93; <i class="arg">family</i></dt>
d303 1
a303 1
<b class="cmd">listen on</b>&#160;<i class="arg">interface</i> &#91;<span class="opt"><i class="arg">family</i></span>&#93; &#91;<span class="opt"><b class="cmd">port</b>&#160;<i class="arg">port</i></span>&#93; &#91;<span class="opt"><b class="cmd">tls</b>&#160;|&#160;<b class="cmd">tls-require</b>&#160;|&#160;<b class="cmd">tls-require&#160;verify</b>&#160;|&#160;<b class="cmd">smtps</b>&#160;|&#160;<b class="cmd">secure</b></span>&#93; &#91;<span class="opt"><b class="cmd">pki</b>&#160;<i class="arg">pkiname</i></span>&#93; &#91;<span class="opt"><b class="cmd">auth</b>&#160;|&#160;<b class="cmd">auth-optional</b>&#160;|&#160;<b class="cmd">auth</b>&#160;<i class="arg">authtable</i>&#160;|&#160;<b class="cmd">auth-optional</b>&#160;<i class="arg">authtable</i></span>&#93; &#91;<span class="opt"><b class="cmd">tag</b>&#160;<i class="arg">tag</i></span>&#93; &#91;<span class="opt"><b class="cmd">hostname</b>&#160;<i class="arg">hostname</i></span>&#93; &#91;<span class="opt"><b class="cmd">hostnames</b>&#160;<i class="arg">names</i></span>&#93; &#91;<span class="opt"><b class="cmd">mask-source</b></span>&#93;</dt>
d305 27
a331 10
Specify an <i class="arg">interface</i> and <i class="arg">port</i> to listen on. An interface group, an IP address or a domain name may be used in place of <i class="arg">interface</i>. The <i class="arg">family</i> parameter can be used to listen only on specific address family. Accepted values are <b class="cmd">inet4</b> and <b class="cmd">inet6</b>.<p>
Secured connections are provided either using STARTTLS (<b class="cmd">tls</b>), by default on port 25, or SMTPS (<b class="cmd">smtps</b>), by default on port 465. <b class="cmd">tls-require</b> may be used to force clients to establish a secure connection before being allowed to start an SMTP transaction.<p>
If <b class="cmd">tls-require verify</b> is specified, the client must provide a valid certificate to be able to establish an SMTP session.<p>
<b class="cmd">secure</b> may be specified to provide both STARTTLS and SMTPS services. Host certificates may be used for these connections, and must be priorly declared using the pki directive. If <b class="cmd">pki</b> is specified, a certificate matching <b class="cmd">name</b> is searched for.<p>
If the <b class="cmd">auth</b> parameter is used, then a client may only start an SMTP transaction after a successful authentication. Any remote sender that passed SMTPAUTH is treated as if it was the server's local user that was sending the mail. This means that filter rules using "from local" will be matched. If <b class="cmd">auth-optional</b> is specified, then SMTPAUTH is not required to establish an SMTP transaction. This is only useful to let a listener accept incoming mail from untrusted senders and outgoing mail from authenticated users in situations where it is not possible to listen on the submission port.<p>
Both <b class="cmd">auth</b> and <b class="cmd">auth-optional</b> accept a table as parameter. When provided, credentials are looked up in this table. Credentials format is described in <a class="link-man">table(5)</a>.<p>
If the <b class="cmd">tag</b> parameter is used, then clients connecting to the listener will be tagged <i class="arg">tag</i>.<p>
If the <b class="cmd">hostname</b> parameter is used, then it will be used in the greeting banner instead of the default server name.<p>
The <b class="cmd">hostnames</b> parameter overrides the server name for specific addresses. Table <i class="arg">names</i> contains a mapping of IP addresses to hostnames and <a class="link-man">smtpd(8)</a> will use the hostname that matches the address on which the connection arrives if it is found in the mapping.<p>
If the <b class="cmd">mask-source</b> parameter is used, then the listener will skip the "from" part when prepending the "Received" header.</dd>
d339 4
a342 2
Associate the certificate located in <i class="arg">certfile</i> with <i class="arg">hostname</i>.<p>
A certificate chain may be created by appending one or many certificates, including a Certificate Authority certificate, to <i class="arg">certfile</i>.<p>
a348 4
<b class="cmd">pki</b> <i class="arg">hostname</i> <b class="cmd">ca</b> <i class="arg">cafile</i></dt>
<dd class="list-tag" style="margin-left: 6.00ex;">
Associate a custom CA certificate <i class="arg">cafile</i> with <i class="arg">hostname</i>.</dd>
<dt class="list-tag" style="margin-top: 1.00em;">
d351 4
a354 2
Associate the Diffie-Hellman parameters located in <i class="arg">dhfile</i> with <i class="arg">hostname</i>.<p>
The parameters are used for ephemeral key exchange. If not specified, OpenSMTPD will use safely generated builtin parameters.<p>
d361 1
a361 1
<b class="cmd">queue encryption</b> &#91;<span class="opt">key <i class="arg">key</i></span>&#93;</dt>
d363 2
a364 1
Enable transparent encryption of envelopes and messages. <i class="arg">key</i> must be a 16-byte random key in hexadecimal representation. It can be obtained using the <a class="link-man">openssl(1)</a> utility as follow:<p>
d367 6
a372 3
<p>
If the <i class="arg">key</i> parameter is not specified, it is read with <a class="link-man">getpass(3)</a> at startup. If <i class="arg">key</i> is "stdin", then it is read from the standard input at startup.<p>
The only supported algorithm is AES-256 in GCM mode. Envelopes and messages may be inspected using the <a class="link-man">smtpctl(8)</a> utility.<p>
d375 1
a375 1
<b class="cmd">table</b> <i class="arg">name</i> &#91;<span class="opt"><i class="arg">type</i>:</span>&#93;<i class="arg">config</i></dt>
d377 6
a382 3
Tables are used to provide additional configuration information for <a class="link-man">smtpd(8)</a> in the form of lists or key-value mappings. The format of the entries depends on what the table is used for. Refer to <a class="link-man">table(5)</a> for the exhaustive documentation.<p>
The table is identified using table name <i class="arg">name</i>; the name itself is arbitrarily chosen.<p>
<i class="arg">type</i> specifies the table backend, and should be one of the following:<p>
d393 2
a394 1
<p>
d397 1
a397 1
<b class="cmd">table</b> <i class="arg">name</i> &#123;<i class="arg">value</i> &#91;<span class="opt">, <i class="arg">...</i></span>&#93;&#125;</dt>
d399 4
a402 2
Tables containing list of static values may be declared using an inlined notation.<p>
The table is identified using table name <i class="arg">name</i>; the name itself is arbitrarily chosen.<p>
d405 1
a405 1
<b class="cmd">table</b> <i class="arg">name</i> &#123;<i class="arg">key</i>=<i class="arg">value</i> &#91;<span class="opt">, <i class="arg">...</i></span>&#93;&#125;</dt>
d407 4
a410 2
Tables containing static key-value mappings may be declared using an inlined notation.<p>
The table is identified using table name <i class="arg">name</i>; the name itself is arbitrarily chosen.<p>
d413 166
a578 35
<p>
Some configuration directives support expansion of their parameters at runtime. Such directives (for example <i class="arg">deliver to maildir</i>, <i class="arg">deliver to mda</i>) may use format specifiers which will be expanded before delivery or relaying. The following formats are currently supported:<p>
<pre style="margin-left: 5.00ex;" class="lit display">
%{sender}	     sender email address 
%{sender.user}	     user part of the sender email address 
%{sender.domain}     domain part of the sender email address 
%{rcpt}              recipient email address 
%{rcpt.user}	     user part of the recipient email address 
%{rcpt.domain}	     domain part of the recipient email address 
%{dest}              recipient email address after expansion 
%{dest.user}	     user part after expansion 
%{dest.domain}	     domain part after expansion 
%{user.username}     local user 
%{user.directory}    home directory of the local user</pre>
<p>
Expansion formats also support partial expansion using the optional bracket notations with substring offset. For example, with recipient domain "example.org":<p>
<pre style="margin-left: 5.00ex;" class="lit display">
%{rcpt.domain[0]}	expands to "e" 
%{rcpt.domain[1]}	expands to "x" 
%{rcpt.domain[8:]}	expands to "org" 
%{rcpt.domain[-3:]}	expands to "org" 
%{rcpt.domain[0:6]}	expands to "example" 
%{rcpt.domain[0:-4]}	expands to "example"</pre>
<p>
In addition, modifiers may be applied to the token. For example, with recipient "User+Tag@@Example.org":<p>
<pre style="margin-left: 5.00ex;" class="lit display">
%{rcpt:lowercase}	expands to "user+tag@@example.org" 
%{rcpt:uppercase}	expands to "USER+TAG@@EXAMPLE.ORG" 
%{rcpt:strip}		expands to "User@@Example.org" 
%{rcpt:lowercase|strip}	expands to "user@@example.org"</pre>
<p>
For security concerns, expanded values are sanitized and potentially dangerous characters are replaced with ":". In situations where they are desirable, the "raw" modifier may be applied. For example, with recipient "user+t?g@@example.org":<p>
<pre style="margin-left: 5.00ex;" class="lit display">
%{rcpt}		expands to "user+t:g@@example.org" 
%{rcpt:raw}	expands to "user+t?g@@example.org"</pre>
d589 1
a589 1
If this file exists, the first line is used as the server name. Otherwise, the server name is derived from the local hostname returned by <a class="link-man">gethostname(3)</a>, either directly if it is a fully qualified domain name, or by retreiving the associated canonical name through <a class="link-man">getaddrinfo(3)</a>.</dd>
d597 4
a600 2
<h1 id="x4558414d504c4553">EXAMPLES</h1> The default <b class="name">smtpd.conf</b> file which ships with <span class="unix">OpenBSD</span> listens on the loopback network interface (lo0), and allows for mail from users and daemons on the local machine, as well as permitting email to remote servers. Some more complex configurations are given below.<p>
This first example is the same as the default configuration, but all outgoing mail is forwarded to a remote SMTP server. A secrets file is needed to specify a username and password:<p>
d605 1
a605 1
# echo "label username:password" &gt; /etc/mail/secrets 
d607 4
a610 2
<p>
<b class="name">smtpd.conf</b> would look like this:<p>
d616 1
a616 1
accept for any relay via tls+auth://label@@smtp.example.com &#92; 
d618 4
a621 2
<p>
In this second example, the aim is to permit mail relaying for any user that can authenticate using their normal login credentials. An RSA certificate must be provided to prove the server's identity. The mail server listens on all interfaces the default route(s) point to. Mail with a local destination should be sent to an external mda. First, the RSA certificate is created:<p>
d624 1
a624 1
# openssl req -new -x509 -key /etc/ssl/private/mail.example.com.key &#92; 
d628 4
a631 2
<p>
In the example above, a certificate valid for one year was created. The configuration file would look like this:<p>
d633 2
a634 2
pki mail.example.com certificate "/etc/ssl/mail.example.com.crt" 
pki mail.example.com key "/etc/ssl/private/mail.example.com.key" 
d641 3
a643 3
accept for local alias &lt;aliases&gt; deliver to mda "/path/to/mda -f -" 
accept from any for domain example.org &#92; 
	deliver to mda "/path/to/mda -f -" 
d645 29
a678 12
<table summary="Document Footer" class="foot" width="100%">
<col width="50%">
<col width="50%">
<tbody>
<tr>
<td class="foot-date">
December 5, 2013</td>
<td class="foot-os" align="right">
OpenBSD 5.4</td>
</tr>
</tbody>
</table>
@


1.2
log
@update documentation
@
text
@d30 1
a30 1
The current line can be extended over multiple lines using a backslash (&#8216;&#92;&#39;). Comments can be put anywhere in the file using a hash mark (&#8216;#&#39;), and extend to the end of the current line. Care should be taken when commenting out multi-line text: the comment is effective until the end of the entire block.<p>
a38 23
Some configuration directives support expansion of their parameters at runtime. Such directives (for example <i class="arg">deliver to maildir</i>, <i class="arg">deliver to mda</i>) may use format specifiers which will be expanded before delivery or relaying. The following formats are currently supported:<p>
<pre style="margin-left: 5.00ex;" class="lit display">
%{sender}	     sender email address 
%{sender.user}	     user part of the sender email address 
%{sender.domain}     domain part of the sender email address 
%{rcpt}              recipient email address 
%{rcpt.user}	     user part of the recipient email address 
%{rcpt.domain}	     domain part of the recipient email address 
%{dest}              recipient email address after expansion 
%{dest.user}	     user part after expansion 
%{dest.domain}	     domain part after expansion 
%{user.username}     local user 
%{user.directory}    home directory of the local user</pre>
<p>
Expansion formats also support partial expansion using the optional bracket notations with substring offset. For example, with recipient domain "example.org":<p>
<pre style="margin-left: 5.00ex;" class="lit display">
%{rcpt.domain[0]}	expands to "e" 
%{rcpt.domain[1]}	expands to "x" 
%{rcpt.domain[8:]}	expands to "org" 
%{rcpt.domain[-3:]}	expands to "org" 
%{rcpt.domain[0:6]}	expands to "example" 
%{rcpt.domain[0:-4]} 	expands to "example"</pre>
<p>
d48 9
a56 2
For each message processed by the daemon, the filter rules are evaluated in sequential order, from first to last. The first matching rule decides what action is taken. If no rule matches the message, the default action is to reject the message.<p>
Following the accept/reject decision comes the client's IP address filter:<dl style="margin-top: 0.00em;margin-bottom: 0.00em;" class="list list-tag">
d62 1
a62 1
<b class="cmd">from local</b></dt>
d66 1
a66 5
<b class="cmd">from</b> <i class="arg">network</i></dt>
<dd class="list-tag" style="margin-left: 6.00ex;">
The rule matches if the connection is made from the specified <i class="arg">network</i>, specified in CIDR notation.</dd>
<dt class="list-tag" style="margin-top: 1.00em;">
<b class="cmd">from</b> &#60;<i class="arg">table</i>&#62;</dt>
a68 4
<dt class="list-tag" style="margin-top: 1.00em;">
<b class="cmd">tagged</b> <i class="arg">tag</i></dt>
<dd class="list-tag" style="margin-left: 6.00ex;">
If specified, the rule will only be matched if the client session was tagged <i class="arg">tag</i>.</dd>
d73 1
a73 1
<b class="cmd">sender</b> <i class="arg">senders</i></dt>
d88 1
a88 1
<b class="cmd">for domain</b> <i class="arg">domain</i> &#91;<span class="opt"><b class="cmd">alias</b> &#60;<i class="arg">aliases</i>&#62;</span>&#93;</dt>
d90 1
a90 1
This rule applies to mail destined for the specified <i class="arg">domain</i>. This parameter supports the &#8216;*&#39; wildcard, so that a single rule for all sub-domains can be used, for example:<p>
d96 1
a96 1
<b class="cmd">for domain</b> &#60;<i class="arg">domains</i> &#91;<span class="opt"><b class="cmd">alias</b> &#60;<i class="arg">aliases</i>&#62;</span>&#93;&#62;</dt>
d101 1
a101 1
<b class="cmd">for domain</b> <i class="arg">domain</i> <b class="cmd">virtual</b> &#60;<i class="arg">users</i>&#62;</dt>
d103 1
a103 1
This rule applies to mail destined for the specified virtual <i class="arg">domain</i>. This parameter supports the &#8216;*&#39; wildcard, so that a single rule for all sub-domains can be used, for example:<p>
d110 1
a110 1
<b class="cmd">for domain</b> &#60;<i class="arg">domains</i>&#62; <b class="cmd">virtual</b> &#60;<i class="arg">users</i>&#62;</dt>
d115 1
a115 1
<b class="cmd">for local</b> &#91;<span class="opt"><b class="cmd">alias</b> &#60;<i class="arg">aliases</i>&#62;</span>&#93;</dt>
d117 1
a117 1
This rule applies to mail destined to &#8220;localhost&#8221; and to the server's fully qualified domain name, as returned by <a class="link-man">hostname(1)</a>.</dd>
d119 1
a119 1
<b class="cmd">for local virtual</b> &#60;<i class="arg">vmap</i>&#62;</dt>
d121 8
a128 1
This rule applies to mail destined to &#8220;localhost&#8221; and to the server's fully qualified domain name, as returned by <a class="link-man">hostname(1)</a>. The <i class="arg">vmap</i> table will be used as the virtual domain mapping.</dd>
d140 1
a140 1
<b class="cmd">deliver to lmtp</b> <i class="arg">host:port</i></dt>
d142 1
a142 1
Mail is delivered to <i class="file">host:port</i> over LMTP.</dd>
d156 1
a156 1
<b class="cmd">relay</b> &#91;<span class="opt"><b class="cmd">backup</b> &#91;<span class="opt"><i class="arg">mx</i></span>&#93;</span>&#93; &#91;<span class="opt"><b class="cmd">as</b> <i class="arg">address</i></span>&#93; &#91;<span class="opt"><b class="cmd">source</b> <i class="arg">source</i></span>&#93; &#91;<span class="opt"><b class="cmd">helo</b> <i class="arg">names</i></span>&#93;</dt>
d159 8
a166 4
If the <b class="cmd">backup</b> parameter is specified, the current server will act as a backup server for the target domain. Accepted mails are only relayed through servers with a lower preference value in the MX record for the domain than the one specified in <i class="arg">mx</i>. If <i class="arg">mx</i> is not specified, local hostname will be assumed.<p>
If the <b class="cmd">as</b> parameter is specified, <a class="link-man">smtpd(8)</a> will rewrite the sender advertised in the SMTP session. <i class="arg">address</i> may be a user, a domain prefixed with &#8216;@@&#39;, or an email address, causing smtpd to rewrite the user-part, the domain-part, or the entire address, respectively.<p>
If the <b class="cmd">source</b> parameter is specified, <a class="link-man">smtpd(8)</a> will explicitly bind to an address found in the table referenced by <i class="arg">table</i> when connecting to the relay. If the table contains more than one address, they are picked in turn each time a new connection is opened.<p>
By default, <a class="link-man">smtpd(8)</a> advertises its local hostname when connecting to a remote server. A <b class="cmd">helo</b> parameter may be specified to advertise an alternate hostname. Table <i class="arg">names</i> contains a mapping of IP addresses to hostnames and <a class="link-man">smtpd(8)</a> will automatically select the name that matches its source address when connected to the remote server.</dd>
d168 1
a168 1
<b class="cmd">relay via</b> <i class="arg">host</i> &#91;<span class="opt"><b class="cmd">certificate</b> <i class="arg">name</i></span>&#93; &#91;<span class="opt"><b class="cmd">auth</b> &#60;<i class="arg">auth</i>&#62;</span>&#93; &#91;<span class="opt"><b class="cmd">as</b> <i class="arg">address</i></span>&#93; &#91;<span class="opt"><b class="cmd">source</b> <i class="arg">source</i></span>&#93; &#91;<span class="opt"><b class="cmd">helo</b> <i class="arg">names</i></span>&#93;</dt>
d182 1
a182 1
ssl://mx1.example.org		# try SMTPS and &#92; 
d187 4
a190 4
tls+auth://label@@mx.example.org	  # over TLS 
smtps+auth://label@@mx.example.org # over SMTPS 
ssl+auth://label@@mx.example.org	  # over either &#92; 
				  # SMTPS or TLS</pre>
d192 1
a192 1
If a certificate <i class="arg">name</i> is specified and exists in the <i class="file">/etc/mail/certs</i> directory with a .crt extension, it will be used if the remote server requests a client certificate. Creation of certificates is documented in <a class="link-man">starttls(8)</a>.<p>
d194 3
a196 2
If the <b class="cmd">as</b> parameter is specified, <a class="link-man">smtpd(8)</a> will rewrite the sender advertised in the SMTP session. <i class="arg">address</i> may be a user, a domain prefixed with &#8216;@@&#39;, or an email address, causing smtpd to rewrite the user-part, the domain-part, or the entire address, respectively.<p>
If the <b class="cmd">source</b> parameter is specified, <a class="link-man">smtpd(8)</a> will explicitly bind to an address found in the table referenced by <i class="arg">table</i> when connecting to the relay. If the table contains more than one address, they are picked in turn each time a new connection is opened. <b class="cmd">helo</b> parameter may be specified to advertise an alternate hostname. Table <i class="arg">names</i> contains a mapping of IP addresses to hostnames and <a class="link-man">smtpd(8)</a> will automatically select the name that matches its source address when connected to the remote server.</dd>
d199 1
d224 5
a228 1
<b class="cmd">listen on</b>&#160;<i class="arg">interface</i> &#91;<span class="opt"><b class="cmd">port</b>&#160;<i class="arg">port</i></span>&#93; &#91;<span class="opt"><b class="cmd">tls</b>&#160;|&#160;<b class="cmd">tls-require</b>&#160;|&#160;<b class="cmd">smtps</b></span>&#93; &#91;<span class="opt"><b class="cmd">certificate</b>&#160;<i class="arg">name</i></span>&#93; &#91;<span class="opt"><b class="cmd">auth</b>&#160;|&#160;<b class="cmd">auth-optional</b></span>&#93; &#91;<span class="opt"><b class="cmd">tag</b>&#160;<i class="arg">tag</i></span>&#93; &#91;<span class="opt"><b class="cmd">hostname</b>&#160;<i class="arg">hostname</i></span>&#93;</dt>
d230 8
a237 2
Specify an <i class="arg">interface</i> and <i class="arg">port</i> to listen on. An interface group, an IP address or a domain name may be used in place of <i class="arg">interface</i>.<p>
Secured connections are provided either using STARTTLS (<b class="cmd">tls</b>), by default on port 25, or SMTPS (<b class="cmd">smtps</b>), by default on port 465. <b class="cmd">tls-require</b> may be used to force clients to establish a secure connection before being allowed to start an SMTP transaction. Host certificates may be used for these connections, and are searched for in the <i class="file">/etc/mail/certs</i> directory. If <b class="cmd">certificate</b> is specified, a certificate &#60;<i class="arg">name</i>&#62;.crt, a key &#60;<i class="arg">name</i>&#62;.key and Diffie-Hellman parameters &#60;<i class="arg">name</i>&#62;.dh are searched for. A certificate authority may be appended to the .crt file to create a certificate chain. If no <b class="cmd">certificate</b> is specified, the default interface name is instead used, for example <i class="file">fxp0.crt</i>, <i class="file">fxp0.key</i>, <i class="file">fxp0.ca</i>, and <i class="file">fxp0.dh</i>. If no DH parameters are provided, smtpd will use built-in parameters. Creation of certificates is documented in <a class="link-man">starttls(8)</a>.<p>
d239 1
d241 3
a243 1
If the <b class="cmd">hostname</b> parameter is used, then it will be used in the greeting banner.</dd>
d249 34
d285 1
a285 1
Tables are used to provide additional configuration information for <a class="link-man">smtpd(8)</a> in the form of lists or key-value mappings.<p>
d313 35
d351 1
a351 1
<dt class="list-tag" style="margin-top: 0.00em;">
d355 5
a359 1
<dt class="list-tag" style="margin-top: 0.00em;">
d366 1
a366 1
<h1 id="x4558414d504c4553">EXAMPLES</h1> The default <b class="name">smtpd.conf</b> file listens on the loopback network interface (lo0), and allows for mail from users and daemons on the local machine, as well as permitting email to remote servers. Some more complex configurations are given below.<p>
d384 1
a384 1
In this second example, the aim is to permit mail relaying for any user that can authenticate using their normal login credentials. An RSA certificate must be provided to prove the server's identity. The mail server has an external interface bnx0. Mail with a local destination should be sent to an external mda. First, the RSA certificate is created:<p>
d386 5
a390 4
# openssl genrsa -out /etc/mail/certs/mail.example.com.key 4096 
# openssl req -new -x509 -key /etc/mail/certs/mail.example.com.key &#92; 
	-out /etc/mail/certs/mail.example.com.crt -days 365 
# chmod 600 /etc/mail/certs/mail.example.com.*</pre>
d394 3
d398 2
a399 1
listen on egress tls certificate mail.example.com auth 
d401 1
d408 1
a408 1
<h1 id="x53454520414c534f">SEE ALSO</h1> <a class="link-man">mailer.conf(5)</a>, <a class="link-man">makemap(8)</a>, <a class="link-man">smtpd(8)</a></div>
d417 1
a417 1
February 17, 2013</td>
d419 1
a419 1
OpenBSD 5.2</td>
@


1.1
log
@Initial revision
@
text
@d31 2
a32 2
Arguments containing whitespace should be surrounded by double quotes (").<p>
Macros can be defined that will later be expanded in context. Macro names must start with a letter, and may contain letters, digits and underscores. Macro names may not be reserved words (for example <i class="arg">listen</i>, <i class="arg">accept</i>, <i class="arg">port</i>). Macros are not expanded inside quotes.<p>
d35 26
a60 3
wan_if = "fxp0" 
listen on $wan_if 
listen on $wan_if tls enable auth</pre>
a61 1
Some configuration directives expect expansion of their parameters at runtime. Such directives (for example <i class="arg">deliver to maildir</i>, <i class="arg">deliver to mda</i>, <i class="arg">relay via</i>) may use format specifiers which will be expanded before delivery or relaying. The following formats are currently supported: %a expands to the user part of the email address prior to the resolution of aliases; %u expands to the user part after aliases resolution and will typically be the system account; %d expands to the domain part of the email address; %U expands to the user part of the sender email address; %D expands to the domain part of the sender email address.<p>
a67 44
<b class="cmd">expire</b> <i class="arg">n {s|m|h|d}</i></dt>
<dd class="list-tag" style="margin-left: 6.00ex;">
Specify how long a message can stay in the queue. The default value is 4 days. For example:<p>
<pre style="margin-left: 5.00ex;" class="lit display">
expire 4d	# expire after 4 days 
expire 10h	# expire after 10 hours</pre>
</dd>
<dt class="list-tag" style="margin-top: 1.00em;">
<b class="cmd">hostname</b> <i class="arg">name</i></dt>
<dd class="list-tag" style="margin-left: 6.00ex;">
Specify the domain name of the server. By default the current host name is used, as returned by <a class="link-man">hostname(1)</a>.</dd>
<dt class="list-tag" style="margin-top: 1.00em;">
<b class="cmd">listen on</b> <i class="arg">interface</i> &#91;<span class="opt"><b class="cmd">port</b> <i class="arg">port</i></span>&#93; &#91;<span class="opt"><b class="cmd">tls</b> | <b class="cmd">smtps</b></span>&#93; &#91;<span class="opt"><b class="cmd">certificate</b> <i class="arg">name</i></span>&#93; &#91;<span class="opt"><b class="cmd">enable auth</b></span>&#93;</dt>
<dd class="list-tag" style="margin-left: 6.00ex;">
Specify an <i class="arg">interface</i> and <i class="arg">port</i> to listen on. An interface group, an IP address or a domain name may be used in place of <i class="arg">interface</i>.<p>
Secured connections are provided either using STARTTLS (<b class="cmd">tls</b>), by default on port 25, or SMTPS (<b class="cmd">smtps</b>), by default on port 465. Host certificates may be used for these connections, and are searched for in the <i class="file">/etc/mail/certs</i> directory. If <b class="cmd">certificate</b> is specified, a certificate &#60;<i class="arg">name</i>&#62;.crt, a key &#60;<i class="arg">name</i>&#62;.key, a certificate authority &#60;<i class="arg">name</i>&#62;.ca and Diffie-Hellman parameters &#60;<i class="arg">name</i>&#62;.dh are searched for. If no <b class="cmd">certificate</b> is specified, the default interface name is instead used, for example <i class="file">fxp0.crt</i>, <i class="file">fxp0.key</i>, <i class="file">fxp0.ca</i>, and <i class="file">fxp0.dh</i>. If no DH parameters are provided, smtpd will use built-in parameters. Creation of certificates is documented in <a class="link-man">starttls(8)</a>.<p>
If the <b class="cmd">enable auth</b> parameter is used, any remote sender that passed SMTPAUTH is treated as if it was the server's local user that was sending the mail. This means that filter rules using "from local" will be matched.</dd>
<dt class="list-tag" style="margin-top: 1.00em;">
<b class="cmd">map</b> <i class="arg">map</i> { <b class="cmd">source</b> <i class="arg">type</i> <i class="arg">source</i> }</dt>
<dd class="list-tag" style="margin-left: 6.00ex;">
Maps are used to provide additional configuration information for <a class="link-man">smtpd(8)</a>.<p>
<i class="arg">map</i> may be named freely.<p>
<i class="arg">type</i> may be one of the following:<p>
<dl style="margin-top: 0.00em;margin-bottom: 0.00em;" class="list list-tag">
<dt class="list-tag" style="margin-top: 0.00em;">
db</dt>
<dd class="list-tag" style="margin-left: 7.00ex;">
Mappings are stored in a file created using <a class="link-man">makemap(8)</a>. This is the default type if none is specified.</dd>
<dt class="list-tag" style="margin-top: 0.00em;">
dns</dt>
<dd class="list-tag" style="margin-left: 7.00ex;">
Not implemented yet.</dd>
<dt class="list-tag" style="margin-top: 0.00em;">
plain</dt>
<dd class="list-tag" style="margin-left: 7.00ex;">
Mappings are stored in a plain text file using the same format as used to generate <a class="link-man">makemap(8)</a> mappings.</dd>
</dl>
<p>
<i class="arg">source</i> specifies the source of the map data. It must be an absolute path to a file for the &#8220;file&#8221; and &#8220;db&#8221; map types, or a domain name for the &#8220;dns&#8221; map type.</dd>
<dt class="list-tag" style="margin-top: 1.00em;">
<b class="cmd">size</b> <i class="arg">n</i></dt>
<dd class="list-tag" style="margin-left: 6.00ex;">
Specify a maximum message size of <i class="arg">n</i> bytes. The argument may contain a multiplier, as documented in <a class="link-man">scan_scaled(3)</a>.</dd>
<dt class="list-tag" style="margin-top: 1.00em;">
d74 1
a74 1
<b class="cmd">from all</b></dt>
d85 15
d104 1
a104 1
<b class="cmd">for all</b></dt>
d106 1
a106 1
Make the rule match regardless of the domain it is sent to.</dd>
d108 5
a112 1
<b class="cmd">for domain</b> <i class="arg">domain</i> &#91;<span class="opt"><b class="cmd">alias</b> <i class="arg">map</i></span>&#93;</dt>
d118 15
a132 1
If specified, <i class="arg">map</i> is used for looking up alternative destinations for addresses in this <i class="arg">domain</i>.</dd>
d134 6
a139 1
<b class="cmd">for local</b> &#91;<span class="opt"><b class="cmd">alias</b> <i class="arg">map</i></span>&#93;</dt>
d143 8
a150 1
<b class="cmd">for virtual</b> <i class="arg">map</i></dt>
d152 1
a152 1
This rule applies to mail destined for the virtual domains specified in the map <i class="arg">map</i>. For an example of how to configure a virtual map, see <a class="link-man">makemap(8)</a>.</dd>
d157 4
d173 1
a173 1
<b class="cmd">relay</b> &#91;<span class="opt"><b class="cmd">as</b> <i class="arg">address</i></span>&#93;</dt>
d176 4
a179 1
If the <b class="cmd">as</b> parameter is specified, <a class="link-man">smtpd(8)</a> will rewrite the sender advertised in the SMTP session. <i class="arg">address</i> may be a user, a domain prefixed with &#8216;@@&#39;, or an email address, causing smtpd to rewrite the user-part, the domain-part, or the entire address, respectively.</dd>
d181 1
a181 1
<b class="cmd">relay via</b> <i class="arg">host</i> &#91;<span class="opt"><b class="cmd">port</b> <i class="arg">port</i></span>&#93; &#91;<span class="opt"><b class="cmd">tls</b> | <b class="cmd">smtps</b> | <b class="cmd">ssl</b></span>&#93; &#91;<span class="opt"><b class="cmd">certificate</b> <i class="arg">name</i></span>&#93; &#91;<span class="opt"><b class="cmd">auth</b> <i class="arg">map</i></span>&#93; &#91;<span class="opt"><b class="cmd">as</b> <i class="arg">address</i></span>&#93;</dt>
d183 29
a211 4
Mail is relayed through the specified <i class="arg">host</i> and <i class="arg">port</i>.<p>
The communication channel may be secured using the <b class="cmd">tls</b> or <b class="cmd">smtps</b> options. The special keyword <b class="cmd">ssl</b> means that any of the two is acceptable: SMTPS is tried first, STARTTLS second. If a certificate <i class="arg">name</i> is specified and exists in the <i class="file">/etc/mail/certs</i> directory with a .crt extension, it will be used if the remote server requests a client certificate. Creation of certificates is documented in <a class="link-man">starttls(8)</a>.<p>
If an SMTPAUTH session with <i class="arg">host</i> is desired, use the <b class="cmd">auth</b> parameter to specify the <i class="arg">map</i> that holds the credentials.<p>
If the <b class="cmd">as</b> parameter is specified, <a class="link-man">smtpd(8)</a> will rewrite the sender advertised in the SMTP session. <i class="arg">address</i> may be a user, a domain prefixed with &#8216;@@&#39;, or an email address, causing smtpd to rewrite the user-part, the domain-part, or the entire address, respectively.</dd>
d213 1
a213 1
<b class="cmd">expire</b> <i class="arg">n {s|m|h|d}</i></dt>
d218 58
d291 1
a291 1
<h1 id="x4558414d504c4553">EXAMPLES</h1> The default <b class="name">smtpd.conf</b> file which ships with <span class="unix">OpenBSD</span> listens on the loopback network interface (lo0), and allows for mail from users and daemons on the local machine, as well as permitting email to remote servers. Some more complex configurations are given below.<p>
d297 1
a297 1
# echo "smtp.example.com  username:password" &gt; /etc/mail/secrets 
d303 5
a307 4
map aliases { source db "/etc/mail/aliases.db" } 
map secrets { source db "/etc/mail/secrets.db" } 
accept for local deliver to mbox 
accept for all relay via smtp.example.com tls auth "secrets"</pre>
d319 6
a324 5
listen on bnx0 tls certificate "mail.example.com" enable auth 
map aliases { source db "/etc/mail/aliases.db" } 
accept for local deliver to mda "/path/to/mda -f -" 
accept from all for domain example.org deliver to mda "/path/to/mda -f -" 
accept for all relay</pre>
d336 1
a336 1
December 13, 2011</td>
d338 1
a338 1
OpenBSD 5.1</td>
@


1.1.1.1
log
@opensmtpd.org website
@
text
@@
