head	1.22;
access;
symbols;
locks; strict;
comment	@# @;


1.22
date	2016.08.15.19.13.06;	author tj;	state dead;
branches;
next	1.21;
commitid	ZZWAR1pMYO2fSF22;

1.21
date	2014.11.10.09.33.26;	author sthen;	state Exp;
branches;
next	1.20;
commitid	Q6Axbb31piLrK703;

1.20
date	2013.12.11.12.09.27;	author sthen;	state Exp;
branches;
next	1.19;

1.19
date	2007.08.16.16.23.22;	author steven;	state Exp;
branches;
next	1.18;

1.18
date	2005.03.14.11.20.15;	author espie;	state Exp;
branches;
next	1.17;

1.17
date	2004.08.11.11.00.23;	author espie;	state Exp;
branches;
next	1.16;

1.16
date	2004.08.10.13.51.28;	author espie;	state Exp;
branches;
next	1.15;

1.15
date	2004.05.07.05.44.52;	author pvalchev;	state Exp;
branches;
next	1.14;

1.14
date	2004.02.16.00.07.26;	author jufi;	state Exp;
branches;
next	1.13;

1.13
date	2004.01.31.18.21.52;	author espie;	state Exp;
branches;
next	1.12;

1.12
date	2002.09.23.06.01.58;	author pvalchev;	state Exp;
branches;
next	1.11;

1.11
date	2001.09.10.19.26.33;	author jufi;	state Exp;
branches;
next	1.10;

1.10
date	2001.07.30.14.50.12;	author espie;	state Exp;
branches;
next	1.9;

1.9
date	2001.06.09.16.39.06;	author pvalchev;	state Exp;
branches;
next	1.8;

1.8
date	2001.05.18.02.25.29;	author brad;	state Exp;
branches;
next	1.7;

1.7
date	2001.03.28.14.57.16;	author espie;	state Exp;
branches;
next	1.6;

1.6
date	2000.08.17.04.10.27;	author brad;	state Exp;
branches;
next	1.5;

1.5
date	2000.06.18.23.52.06;	author naddy;	state Exp;
branches;
next	1.4;

1.4
date	2000.04.14.02.29.41;	author wvdputte;	state Exp;
branches;
next	1.3;

1.3
date	2000.04.08.20.25.52;	author espie;	state Exp;
branches;
next	1.2;

1.2
date	2000.04.08.00.24.47;	author ericj;	state Exp;
branches;
next	1.1;

1.1
date	2000.04.07.22.05.58;	author espie;	state Exp;
branches;
next	;


desc
@@


1.22
log
@remove some more old junk.
@
text
@<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">

<html>
 <head>
  <meta http-equiv="Content-Type"
        content="text/html; charset=iso-8859-1">
  <meta http-equiv="refresh"
        content="8; url=../faq/ports/differences.html">
  <script type="text/javascript">
  <!--
        window.location.href="../faq/ports/differences.html"
  -->
  </script>
  <title>OpenBSD Porter's Handbook</title>
 </head>
 <body text="#000000" bgcolor="#FFFFFF" link="#23238E">
<a href="index.html"><img alt="[OpenBSD]" height="30" width="141" src="../images/smalltitle.gif" border="0"></a>

  <p>
   If you are not redirected automatically, follow the link
   to <a href='../faq/ports/differences.html'>http://www.openbsd.org/faq/ports/differences.html</a>

  <hr>
  <a href="index.html"><img height=24 width=24 src=../back.gif border=0 alt=OpenBSD></a> 
<br><small>$OpenBSD: diffs.html,v 1.21 2014/11/10 09:33:26 sthen Exp $</small>
 </body>
</html>
@


1.21
log
@zap more www@@
@
text
@d25 1
a25 1
<br><small>$OpenBSD: diffs.html,v 1.20 2013/12/11 12:09:27 sthen Exp $</small>
@


1.20
log
@remove duplicate content by replacing old porting pages with redirects
to the maintained pages in faq/ports, from Daniel Dickman
@
text
@a14 1
  <link rev="made" HREF="mailto:www@@openbsd.org">
d25 1
a25 2
  <a href="mailto:www@@openbsd.org">www@@openbsd.org</a>
<br><small>$OpenBSD: diffs.html,v 1.19 2007/08/16 16:23:22 steven Exp $</small>
@


1.19
log
@two small fixes:
s/make install/make fake/
s/make show VARNAME=/make show=/

from Tilo Stritzky <t.stritzky at teles.de>
@
text
@d1 2
a2 1
<!DOCTYPE html PUBLIC "-//W3C//DTD HTML 3.2 Final//EN">
d4 25
a28 395
<head>
<meta name="generator" content="HTML Tidy, see www.w3.org">
<meta http-equiv="Content-Type" content=
"text/html; charset=iso-8859-1">
<meta name="resource-type" content="document">
<meta name="description" content=
"Differences with other BSD porting systems.">
<meta name="keywords" content="openbsd,ports">
<meta name="distribution" content="global">
<meta name="copyright" content="This document copyright 2000 by OpenBSD.">
<title>Differences from other BSD port systems</title>
</head>
<body text="Black" bgcolor="White" link="#23238E">
<img height="30" width="141" src="../images/smalltitle.gif" alt=
"[OpenBSD]"> 

<h1>OpenBSD porting information</h1>

<h2><font color="#e00000">Important differences from other
BSD projects</font></h2>

<p>
NetBSD uses the term <em>ports</em> for architecture-dependent
issues. Their ports structure is called <em>packages</em> instead. 
</p>

<h3>Extra support</h3>
The porting infrastructure includes several scripts that facilitate
the creation of new ports:
<dl>
<dt>build/resolve-lib
    <dd>invoked through <code>make lib-depends-check</code>, to verify
    shared libraries dependencies.
<dt>build/update-patches
    <dd>invoked through <code>make update-patches</code>, which should
    <strong>always be used to regenerate patches.</strong>
<dt>install/make-plist
    <dd>invoked through <code>make update-plist</code>. This takes care
    of most of the finest points of crafting accurate packing-lists.
    OpenBSD packing-lists are significantly different from those of other
    BSD projects, in part because the package tools have been completely
    rewritten.
</dl>

<h3>Generic infrastructure issues</h3>

<p>
OpenBSD's make supports <code>${VAR:U}</code> and
<code>${VAR:L}</code> to transform a variable's value into uppercase or
lowercase. Accordingly, make tests should be coded in a
case-independent way, e.g., 
</p>

<pre>
	.if ${NEED_XXX:L} == "yes"
	do stuff if yes
	.else
	do other stuff
	.endif
</pre>

<p>
In theory, all boolean variables recognized by
<code>bsd.port.mk</code> should always be defined, so that code like
<code>defined(USE_FOO)</code> should not be necessary, and
<code>${USE_FOO:L} != "no"</code> ought to work.
</p>

<p>
The main <code>bsd.port.mk</code> file has been heavily
streamlined and fixed. In particular, it is parallel-make ready.
The <code>scripts/{pre,do,post}-*</code> feature has been lost in
the process. To replace that feature, invoke the script manually
from the Makefile. 
</p>

<h3>Using make properly</h3>

<p>
Note that, if you invoke make as <code>make VAR=value</code>, the
assignment will <em>override</em> whatever value VAR may get from the
Makefile. So, many Makefile patches are not necessary, it is
much better to set MAKE_FLAGS correctly, to decrease the
maintenance burden. 
</p>

<h3>Fetching sources</h3>

<p>
There are two kinds of source archives: DISTFILES and PATCHFILES.
OpenBSD processes them in a uniform way, and retrieves everything
from MASTER_SITES by default. There are <strong>no</strong> 
PATCH_SITES nor PATCH_SITES_SUBDIR.
</p>

<p>
If all files to fetch don't come from the same set of sites,
OpenBSD allows the extension filename:0 to filename:9, in which
case it will use MASTER_SITES0 to MASTER_SITES9 to retrieve the
file.
</p>

<p>
Some architectures may need specific distfiles. In the past, this
has caused trouble where mirroring distfiles was concerned. OpenBSD
supports a third set of files: SUPDISTFILES. Those will be
considered only for creating checksums and mirroring purposes. Note
that SUPDISTFILES may have an overlap with DISTFILES or PATCHFILES.
For instance, 
</p>

<pre>
	DISTFILES=foo-1.0.tgz
	.if ${ARCH} == "i386"
	DISTFILES+=foo-i386.tgz
	.elif ${ARCHI} == "sparc"
	DISTFILES+=foo-sparc.tgz
	.endif
	SUPDISTFILES=foo-i386.tgz foo-sparc.tgz
</pre>

<h3>The <code>WRKDIR</code> infrastructure</h3>

<p>
We don't want ports that use <code>NO_WRKDIR</code>. All OpenBSD
ports must have a work directory. Naming details of those work
directories should not be a porter's concerns. If you need to find
out about such a name, ask the Makefile: <code>cd that_ports_dir
&amp;&amp; make show=WRKDIR</code> will yield that port's
idea of <code>WRKDIR</code>.
</p>

<p>
The main reason behind that prohibition is that OpenBSD's
<code>bsd.port.mk</code> acts like a real Makefile, with dependencies.
The <code>fetch</code> stage depends upon the distfiles and
patchfiles, all other stages depend on real files living in the
working directory (cookies), so they can't exist without a working
directory.
</p>

If the DISTFILES extraction is special, set 
</p>

<pre>
EXTRACT_ONLY=
</pre> 

<p>
and do the extraction in <code>post-extract.</code>
</p>

<dl>
<dt>WRKDIR</dt>

<dd>The port working directory, where it puts its own
cookies.</dd>

<dt>WRKDIST</dt>

<dd>Subdirectory of WRKDIR where the port actually unpacks.
It is also the base directory for patch. Other BSD currently don't
have the WRKDIST/WRKSRC distinction and have only
WRKSRC.</dd>

<dt>WRKSRC</dt>

<dd>Subdirectory of WRKDIST where the actual source
lives.</dd>

<dt>WRKBUILD</dt>

<dd>Subdirectory of WRKDIR where the port configure and build
will occur. Other BSD don't have the WRKBUILD/WRKSRC distinction.
Programs based on autoconf (mostly) can usually set SEPARATE_BUILD
to let the port build happen in a WRKBUILD distinct from
WRKSRC.</dd>

<dt>WRKCONF</dt>

<dd>Subdirectory of WRKDIR where configure scripts should be run.
Defaults to WRKBUILD, which is correct 99% of the time.</dd>

<dt>WRKINST</dt>

<dd>Directory where the port will be installed before being
packaged (see Faking ports below).</dd>
</dl>

<p>
<em>Note that NO_WRKSUBDIR has been removed: its functionality can be
achieved by setting WRKDIST=$(WRKDIR) instead. </em>
</p>

<h3>Faking ports</h3>

<h4>Introduction</h4>

<p>
After a build is complete, other BSDs proceed to install a
port, then build a package from the installed port.
OpenBSD uses faked installation instead. 
</p>

<ul>
<li>An OpenBSD port is configured and built normally (e.g., to
install under <code>PREFIX</code>, usually
<code>/usr/local</code>).</li>

<li>But it's told to install elsewhere, namely under WRKINST, which
is usually a subdirectory of WRKDIR.</li>

<li>Then the false installation is packaged, using the -B option of
pkg_create.</li>

<li>Finally, the resulting package can be installed, using
pkg_add.</li>
</ul>

<h4>Advantages</h4>

<ul>
<li>For a package builder, it means that most ports don't have to
actually be installed, which removes a large number of potential
compromises and general nastiness from badly installed ports. It
also allows building several conflicting packages on the same
machine. Finally, it allows building a new set of untested packages
without hosing a correct installation.</li>

<li>For a port writer, it greatly simplifies the task of finding
problems in packing lists, since the fake area of installation is
empty before the port gets installed. Also, if a port installs too
many files, it is no longer necessary to tweak the port
installation: it is enough not to record the extraneous files in
the packing list.</li>

<li>For the end user, it improves the quality of packages: since
the final port is installed using pkg_add, the end user gets <em>
exactly</em> the same software that was prepared on the porter's
machine.</li>
</ul>

<h4>How to do it</h4>

<p>
The targets invoked for <code>make fake</code> are the usual
install targets, except for a few differences: 
</p>

<ul>
<li>FAKE_FLAGS is used instead of MAKE_FLAGS. By default,
FAKE_FLAGS sets DESTDIR=${WRKINST}.</li>

<li>FAKE_TARGET is used instead of INSTALL_TARGET.</li>

<li>The {pre,do,post}-install fragments are invoked with TRUEPREFIX
set to $(PREFIX), PREFIX set to $(WRKINST)$(PREFIX), and DESTDIR
set to $(WRKINST).</li>
</ul>

<p>
Ports using imake should work as is, since the imake fragments are
configured to use DESTDIR. Similarly, recent GNU configure ports
should need no change.
</p>

<p>
Another good technique is a `late binding' trick: configure the
ports to use a prefix of $(DESTDIR)/usr/local, so that the
resulting Makefile has 
</p>

<pre>
prefix=$(DESTDIR)/usr/local
</pre>

<p>
set. When the port gets built, since DESTDIR is set to nothing,
/usr/local is used. And the fake install will put everything into
WRKINST/usr/local (e.g., for GNU configure, use 
<code>CONFIGURE_STYLE= gnu dest</code>).
</p>

<h4>Pitfalls</h4>

<ul>
<li>Some ports are inconsistent in their DESTDIR processing: most
of the port is happy with DESTDIR set, except for one or two
offenders. Patch the problem away.</li>

<li>Be careful to distinguish between the actual location where the
port is installed, and the location recorded in the configuration
files of the package. This is very easy to overlook, but easy to
fix using TRUEPREFIX.</li>

<li>Absolute symlinks always need to be tweaked. Luckily, 
<code>bsd.port.mk</code> will notice problems in that area.</li>

<li>A few ports don't want to leave $(DESTDIR) alone at the
configure stage. A post-configure fragment that tweaks all
Makefiles to add the DESTDIR is needed.</li>

<li>Very seldom, a port will resist all reasonable attempts to use
FAKE. A brute force approach should work: use pre-fake to link or
copy everything the port wants to find in the WRKINST area, then
perform the install under chroot.</li>
</ul>

<h3>Packaging tools</h3>

<p>
The package tools know about quite a few file types, and can do a lot
of things automatically: in most cases <code>@@exec</code> commands or
<code>INSTALL</code> scripts are unneeded.<br>
<em>Note that all unneeded scripts should be banned, as they have
scalability issues. It is much easier to debug one single package 
infrastructure than to modify hundreds of scripts to handle new problems.
</em><br>
For instance:
</p>

<ul>
<li><code>@@exec ldconfig</code> is not needed, as shared libraries are
annotated with <code>@@lib libfoo.so.1.0</code> and <code>ldconfig</code>
runs only when needed, and handles chroot gracefully.</li>
<li><code>@@exec install-info</code> is not needed, as info documentation
files are annotated with <code>@@info file.info</code>. This also takes
care of multiple info files, and removes the need for 
<code>makeinfo --no-split</code>.</li>
<li>fonts get integrated automatically thanks to <code>@@font</code> and 
<code>@@fontdir</code>.</li>
<li>New users and groups get handled with <code>@@newuser</code> and
<code>@@newgroup</code> instead of installation scripts. They also get
created early enough so that further package extraction can use them.</li>
<li>Configuration files are handled through <code>@@sample</code> instead
of installation scripts.</li>
</ul>

<p>
Refer to 
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=pkg_create&amp;sektion=1&amp;format=html">pkg_create(1)</a>
for more details.  In most cases,
<code>make update-plist</code> will write a very good approximation of
a complete packing-list, and will carry hand-made tweaks from one version 
to the next.
</p>

<h3>Flavors</h3>

<p>
Options have been rationalized as flavors, so that package building
can be consistent. A port with options should set FLAVORS to the
list of all options that make sense for that port (e.g.,
FLAVORS=foo bar zoinx), then use FLAVOR to test what options have
actually been selected (e.g., FLAVOR=zoinx foo).
<code>bsd.port.mk</code> provides some support: 
</p>

<ul>
<li>The PKGNAME is tweaked to include dash separated options (e.g.,
package-foo-zoinx).</li>

<li>The WRKDIR is tweaked so that distinct flavors can be built
concurrently without colliding.</li>

<li>Constructs of the form %%flavor%% will trigger the inclusion of
PFRAG.flavor. The %%SHARED%% construct triggers the inclusion of
PFRAG.shared.</li>

<li>bsd.port.subdir.mk understands the extension
SUBDIR=directory,opt1,opt2 to say `build port in directory with
FLAVOR=opt1 opt2.'</li>
</ul>

<p>
Checking that a given flavor has been selected is as simple as:
</p>

<pre>
.if ${FLAVOR:L:Mzoinx}
</pre>

There is an extra extension, known as MULTI_PACKAGES.
Generally speaking, MULTI_PACKAGES and FLAVORS are orthogonal
mechanisms. Together, they account for OpenBSD ports tree being
somewhat smaller than the other BSD, as they allow one single
port directory to build lots of distinct packages. 
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=bsd.port.mk&amp;sektion=5&amp;format=html">bsd.port.mk(5)</a>
has a full section devoted to FLAVORS AND MULTI_PACKAGES.

<hr>

<small>$OpenBSD: diffs.html,v 1.18 2005/03/14 11:20:15 espie Exp $</small>

</body>
@


1.18
log
@be proud of the new packing-lists. Insist that people use their features
when writing new ports.
@
text
@d131 1
a131 1
&amp;&amp; make show VARNAME=WRKDIR</code> will yield that port's
d395 1
a395 1
<small>$OpenBSD: diffs.html,v 1.17 2004/08/11 11:00:23 espie Exp $</small>
@


1.17
log
@dyslexia
From: Bernd Ahlers <b.ahlers@@ba-net.org>
@
text
@d181 5
d311 39
d395 1
a395 1
<small>$OpenBSD: diffs.html,v 1.16 2004/08/10 13:51:28 espie Exp $</small>
@


1.16
log
@fake always. -S option of pkg_create.
@
text
@d34 1
a34 1
    <dd>invoked through <code>make check-lib-depends</code>, to verify
d351 1
a351 1
<small>$OpenBSD: diffs.html,v 1.15 2004/05/07 05:44:52 pvalchev Exp $</small>
@


1.15
log
@better wording; Ross.Richardson@@utas.edu.au
@
text
@d199 1
a199 2
OpenBSD uses faked installation instead. The ports tree is not
entirely converted to using FAKE, but it is getting there.
d203 1
a203 1
<li>A faked port is configured and built normally (e.g., to
d210 1
a210 1
<li>Then the false installation is packaged, using the -s option of
d351 1
a351 1
<small>$OpenBSD: diffs.html,v 1.14 2004/02/16 00:07:26 jufi Exp $</small>
@


1.14
log
@missing </strong>
@
text
@d42 3
a44 2
    OpenBSD packing-lists are significantly different from OpenBSD,
    in part because the package tools have been completely rewritten.
d352 1
a352 1
<small>$OpenBSD: diffs.html,v 1.13 2004/01/31 18:21:52 espie Exp $</small>
@


1.13
log
@document more stuff.
@
text
@d38 1
a38 1
    <strong>always be used to regenerate patches.
d351 1
a351 1
<small>$OpenBSD: diffs.html,v 1.12 2002/09/23 06:01:58 pvalchev Exp $</small>
@


1.12
log
@NEED_VERSION is now obsolete; from Jim Geovedi
@
text
@d29 17
d64 4
a67 4
There is a move to ensure all variables recognized by
<code>bsd.port.mk</code> are always defined, so that eventually we will
get rid of <code>defined(USE_GMAKE)</code> and use
<code>${USE_GMAKE:L} != "no"</code> instead. 
d123 1
a123 1
<h3>The <code>work</code> infrastructure</h3>
d143 1
a143 6
<p>
Due to historical accident, the <code>do-extract</code> fragment
does create the working directory. Accordingly,
<code>pre-extract</code> and <code>do-extract</code> should <em>
never</em> be overridden. If the DISTFILES extraction is special,
set 
d341 8
d351 1
a351 1
<small>$OpenBSD: diffs.html,v 1.11 2001/09/10 19:26:33 jufi Exp $</small>
@


1.11
log
@
powerpc.html -> macppc.html
copyright notices cleaned up.
All work by David Krause <openbsd@@davidkrause.com>
@
text
@a31 10
You can test if a specific version of <code>bsd.port.mk</code> is
available by setting NEED_VERSION.
</p>

<p>
Always put the NEED_VERSION line right beneath CATEGORIES to
simplify automated processing.
</p>

<p>
d331 1
a331 1
<small>$OpenBSD: diffs.html,v 1.10 2001/07/30 14:50:12 espie Exp $</small>
@


1.10
log
@Use FLAVOR:L:Mfoo   for tests exclusively.
Takes care of possibly hidden flavors.
@
text
@d12 1
a12 2
<meta name="copyright" content=
"This document copyright 2000 by OpenBSD.">
d341 1
a341 1
<small>$OpenBSD: diffs.html,v 1.9 2001/06/09 16:39:06 pvalchev Exp $</small>
@


1.9
log
@typos, spelling and link fixes; dstoikov@@biosgroup.com
@
text
@a336 9
.if ${FLAVOR:L}="zoinx foo"
</pre>

<p>
Checking that a flavor holds a given option is done in a slightly 
different way:
</p>

<pre>
d342 1
a342 1
<small>$OpenBSD: diffs.html,v 1.8 2001/05/18 02:25:29 brad Exp $</small>
@


1.8
log
@checking flavor for given options should not be considered tricky.
@
text
@d141 1
a141 1
never</em> be overriden. If the DISTFILES extraction is special,
d351 1
a351 1
<small>$OpenBSD: diffs.html,v 1.7 2001/03/28 14:57:16 espie Exp $</small>
@


1.7
log
@: -> ,
@
text
@d333 1
a333 1
Checking that a given flavor has been selected is as simple as: 
d341 2
a342 2
Checking that a flavor holds a given option is slightly more
tricky: 
d351 1
a351 1
<small>$OpenBSD: diffs.html,v 1.6 2000/08/17 04:10:27 brad Exp $</small>
@


1.6
log
@- remove mention of the need for FAKE=Yes and the bit about PLIST.sed
- CONFIGURE_ARGS example -> CONFIGURE_STYLE
@
text
@d328 1
a328 1
SUBDIR=directory:opt1,opt2 to say `build port in directory with
d351 1
a351 1
<small>$OpenBSD: diffs.html,v 1.5 2000/06/18 23:52:06 naddy Exp $</small>
@


1.5
log
@fix formatting, improve HTML markup; ok espie@@
fix reference to obsolescent GNU_CONFIGURE; espie@@
@
text
@a241 5
To activate the fake framework, you just need to set FAKE=Yes in
the port Makefile.
</p>

<p>
d259 1
a259 1
configured to use DESTDIR. Similarly, recent gnu-configure ports
d276 2
a277 2
WRKINST/usr/local (e.g., for gnu configure, use 
<code>CONFIGURE_ARGS=--prefix='$$(DESTDIR)$(PREFIX)'</code>).
d323 3
a325 3
<li>If the packing list is named PLIST.sed, constructs of the form
%%flavor%% will trigger the inclusion of PFRAG.flavor. The
%%SHARED%% construct triggers the inclusion of PFRAG.shared.</li>
d351 1
a351 1
<small>$OpenBSD: diffs.html,v 1.4 2000/04/14 02:29:41 wvdputte Exp $</small>
@


1.4
log
@Fix link to ../images/ instead of images/
@
text
@d23 1
a23 1
BSD</font></h2>
d25 1
d28 1
d32 1
d35 1
d37 2
a38 3
<br><br>

 Always put the NEED_VERSION line right beneath CATEGORIES to
d40 1
d42 3
a44 4
<br><br>

OpenBSD's make supports <code>${VAR:U}</code> and <code>
${VAR:L}</code> to transform a variable's value into uppercase or
d47 1
d49 7
a55 14
<ul><pre>
.if ${NEED_XXX:L} == "yes"
do stuff if yes
.else
do other stuff
.endif
</pre></ul>

<br>
<br>
 There is a move to ensure all variables recognized by <code>
bsd.port.mk</code> are always defined, so that eventually we will
get rid of <code>defined(GNU_CONFIGURE)</code> and use <code>
${GNU_CONFIGURE:L} != "no"</code> instead. 
d57 6
a62 1
<br><br>
d64 2
a65 1
 The main <code>bsd.port.mk</code> file has been heavily
d70 1
d74 1
d80 1
d84 1
d89 1
d91 1
a91 2
<br><br>

d96 1
d98 1
a98 2
<br><br>

d105 1
d108 7
a114 7
DISTFILES=foo-1.0.tgz
.if ${ARCH} == "i386"
DISTFILES+=foo-i386.tgz
.elif ${ARCHI} == "sparc"
DISTFILES+=foo-sparc.tgz
.endif
SUPDISTFILES=foo-i386.tgz foo-sparc.tgz
d119 1
d126 1
d128 3
a130 4
<br><br>

The main reason behind that prohibition is that OpenBSD's <code>
bsd.port.mk</code> acts like a real Makefile, with dependencies.
d135 1
d137 1
a137 2
<br><br>

d139 2
a140 2
does create the working directory. Accordingly, <code>
pre-extract</code> and <code>do-extract</code> should <em>
d143 2
d148 2
d151 2
d156 2
a157 2
<dd><code>The port working directory, where it puts its own
cookies.</code></dd>
d161 1
a161 1
<dd><code>Subdirectory of WRKDIR where the port actually unpacks.
d164 1
a164 1
WRKSRC.</code></dd>
d168 2
a169 2
<dd><code>Subdirectory of WRKDIST where the actual source
lives.</code></dd>
d173 1
a173 1
<dd><code>Subdirectory of WRKDIR where the port configure and build
d177 1
a177 1
WRKSRC.</code></dd>
d181 2
a182 2
<dd><code>Directory where the port will be installed before being
packaged (see Faking ports below).</code></dd>
d185 1
d188 1
a188 1
</pre>
d190 1
a190 1
<h3><code>Faking ports</code></h3>
d192 1
a192 1
<h4><code>Introduction</code></h4>
d194 2
a195 1
<code>After a build is complete, other BSDs proceed to install a
a196 1
<br>
d198 2
a199 1
entirely converted to using FAKE, but it is getting there.</code>
d203 2
a204 2
install under <code>PREFIX</code>, usually <code>
/usr/local</code>).</li>
d241 1
d244 1
d246 1
a246 2
<br><br>

d249 1
d262 1
d266 1
d268 1
a268 2
<br><br>

d272 1
d278 1
d282 2
a283 3
<code>CONFIGURE_ARGS=--prefix='$$(DESTDIR)$(PREFIX)'</code>) <br>
<br>
 
d312 1
d317 3
a319 2
actually been selected (e.g., FLAVOR=zoinx foo). <code>
bsd.port.mk</code> provides some support: 
d337 1
d339 1
d345 1
a345 2
<br><br>

d348 1
d354 1
a354 1
<br><hr><br>
d356 1
a356 1
<small>$OpenBSD: diffs.html,v 1.3 2000/04/08 20:25:52 espie Exp $</small>
a359 1

@


1.3
log
@NO_WRKSUBDIR has been removed, since you can get the same functionality
with WRKDIST=${WRKDIR}
@
text
@d17 1
a17 1
<img height="30" width="141" src="images/smalltitle.gif" alt=
d331 1
a331 1
<small>$OpenBSD: diffs.html,v 1.2 2000/04/08 00:24:47 ericj Exp $</small>
@


1.2
log
@fix formatting and some english
@
text
@d170 4
d331 1
a331 1
<small>$OpenBSD$</small>
@


1.1
log
@Document some changes from other BSDs
@
text
@d31 4
a34 2
available by setting NEED_VERSION. <br>
<br>
d36 5
a40 3
simplify automated processing. <br>
<br>
 OpenBSD make support <code>${VAR:U}</code> and <code>
d45 1
a45 1
<pre>
d51 1
a51 1
</pre>
d58 4
a61 2
${GNU_CONFIGURE:L} != "no"</code> instead. <br>
<br>
d71 2
a72 2
assignment <em>override</em> whatever value VAR may get from the
Makefile proper. So, many Makefile patches are not necessary, it is
d80 6
a85 4
from MASTER_SITES by default. There is <strong>no</strong> 
PATCH_SITES nor PATCH_SITES_SUBDIR. <br>
<br>
 If all files to fetch don't come from the same set of sites,
d88 5
a92 3
file. <br>
<br>
 Some architectures may need specific distfiles. In the past, this
d116 5
a120 3
idea of <code>WRKDIR</code>. <br>
<br>
 The main reason behind that prohibition is that OpenBSD's <code>
d125 5
a129 3
directory. <br>
<br>
 Due to historical accident, the <code>do-extract</code> fragment
d175 3
a177 2
port, then build a package from the installed port.<br>
 OpenBSD uses faked installation instead. The ports tree is not
d179 1
d181 1
a181 1
<li><code>A faked port is configured and built normally (e.g., to
d183 1
a183 1
/usr/local</code>).</code></li>
d221 5
a225 3
the port Makefile.<br>
<br>
 The targets invoked for <code>make fake</code> are the usual
d241 5
a245 3
should need no change.<br>
<br>
 Another good technique is a `late binding' trick: configure the
d316 3
a318 3
<br>
<br>
 Checking that a flavor holds a given option is slightly more
d324 5
@

