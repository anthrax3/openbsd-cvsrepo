head	1.9;
access;
symbols;
locks; strict;
comment	@# @;


1.9
date	2017.06.26.17.18.58;	author tb;	state Exp;
branches;
next	1.8;
commitid	jKVBuSx5No9bUpg1;

1.8
date	2016.10.21.20.02.42;	author dtucker;	state Exp;
branches;
next	1.7;
commitid	hWNxOS9HkWI9PaRI;

1.7
date	2016.08.01.07.06.20;	author dtucker;	state Exp;
branches;
next	1.6;
commitid	yoJ6nMkvZJZWTbJf;

1.6
date	2016.08.01.01.44.18;	author dtucker;	state Exp;
branches;
next	1.5;
commitid	Pcawx88VxxZBqTUP;

1.5
date	2016.08.01.01.43.03;	author dtucker;	state Exp;
branches;
next	1.4;
commitid	Z8yPVSFWAzrC9pMp;

1.4
date	2016.07.29.15.38.23;	author tj;	state Exp;
branches;
next	1.3;
commitid	oPuOO3cgGFMkNX7L;

1.3
date	2016.04.21.02.46.25;	author tj;	state Exp;
branches;
next	1.2;
commitid	bPQqPk6C4E62xLJH;

1.2
date	2015.10.07.16.09.34;	author jca;	state Exp;
branches;
next	1.1;
commitid	barzKJu0rTHfwuXZ;

1.1
date	2015.07.30.00.03.44;	author djm;	state Exp;
branches;
next	;
commitid	FNzRJmh5aper4pC4;


desc
@@


1.9
log
@move man.openbsd.org links from http:// to https://
reduces the number of http:// links in www/ from >33k to <7k

thanks to schwarze for doing the work
@
text
@<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<html>
<head>
<title>OpenSSH: Legacy Options</title>
<style>
pre {
	display: inline-block;
	width: auto;
	border: 2px solid #666;
	padding: 0.5em 1em;
	background-color: #E0EBF5;
	margin: 0px auto;
}
</style>
<meta http-equiv="Content-Type" content="text/html; charset=iso-8859-1">
<meta name="description" content="OpenSSH legacy support">
<meta name="copyright" content="This document copyright 2015-2016 by OpenBSD.">
<meta name="viewport" content="width=device-width, initial-scale=1">
<link rel="canonical" href="https://www.openssh.com/legacy.html">
<link rel="stylesheet" type="text/css" href="openbsd.css">
</head>

<body bgcolor="#ffffff" text="#000000" link="#23238e">

<h2>
<a href="index.html">
<font color="#0000ff"><i>Open</i></font><font color="#000084">SSH</font></a>
<font color="#e00000">Legacy Options</font>
</h2>
<hr>

<p>
OpenSSH implements all of the cryptographic algorithms needed for
compatibility with standards-compliant SSH implementations, but since
some of the older algorithms have been found to be weak, not all of them
are enabled by default. This page describes what to do when OpenSSH refuses
to connect with an implementation that only supports legacy algorithms.
</p>

<p>
When a SSH client connects to a server, each side offers lists of connection
parameters to the other. These are, with the corresponding
<a href="https://man.openbsd.org/OpenBSD-current/man5/ssh_config.5"
>ssh_config</a> keyword:
<ul>
<li><tt>KexAlgorithms</tt>: the key exchange methods that are used to generate
per-connection keys</li>
<li><tt>Ciphers</tt>: the ciphers to encrypt the connection</li>
<li><tt>MACs</tt>: the message authentication codes used to detect traffic
modification</li>
<li><tt>PubkeyAcceptedKeyTypes</tt>: the public key algorithms that the server
can use to authenticate itself to the client</li>
</ul></p>

<p>
For a successful connection, there must be at least one
mutually-supported choice for each parameter.
</p>

<p>
If the client and server are unable to agree on a mutual set of parameters
then the connection will fail.  OpenSSH (7.0 and greater) will produce an
error message like this:
</p>

<pre>
Unable to negotiate with legacyhost: no matching key exchange method found.
Their offer: diffie-hellman-group1-sha1
</pre>

<p>
In this case, the client and server were unable to agree on the key
exchange algorithm. The server offered only a single method
<tt>diffie-hellman-group1-sha1</tt>. OpenSSH supports this method,
but does not enable it by default because is weak and within theoretical
range of the so-called Logjam attack.
</p>

<p>
The best resolution for these failures is to upgrade the software at
the other end. OpenSSH only disables algorithms that we actively
recommend against using because they are known to be weak. In
some cases, this might not be immediately possible so you may need to
temporarily re-enable the weak algorithms to retain access.
</p>

<p>
For the case of the above error message, OpenSSH can be configured to enable
the <tt>diffie-hellman-group1-sha1</tt>
key exchange algorithm (or any other that is disabled by default) using
the <tt>KexAlgorithms</tt> option - either on the command-line:
</p>

<pre>
ssh -oKexAlgorithms=+diffie-hellman-group1-sha1 user@@legacyhost
</pre>

<p>
or in the <tt>~/.ssh/config</tt> file:
</p>

<pre>
Host somehost.example.org
	KexAlgorithms +diffie-hellman-group1-sha1
</pre>

<p>
The '+' before the list instructs ssh to <strong>append</strong>
the algorithm to the client's default set rather than replacing the
default. By appending, you will automatically upgrade to the best
supported algorithm when the server starts supporting it.
</p>

<p>
Another example, this time where the client and server fail to agree on
a public key algorithm for host authentication:
</p>

<pre>
Unable to negotiate with legacyhost: no matching host key type found. Their offer: ssh-dss
</pre>

<p>
OpenSSH 7.0 and greater similarly disable the <tt>ssh-dss</tt> (DSA)
public key algorithm. It too is weak and we recommend against its use.
It can be re-enabled using the <tt>HostKeyAlgorithms</tt> configuration
option:
</p>

<pre>
ssh -oHostKeyAlgorithms=+ssh-dss user@@legacyhost
</pre>

<p>
or in the <tt>~/.ssh/config</tt> file:
</p>

<pre>
Host somehost.example.org
	HostKeyAlgorithms +ssh-dss
</pre>

<p>
Depending on the server configuration, it's possible for other connection
parameters to fail to negotiate. You might find the <tt>Ciphers</tt> and/or
<tt>MACs</tt> configuration options useful for enabling these. It's
also possible to query which algorithms ssh supports:
</p>

<pre>
ssh -Q cipher       # List supported ciphers
ssh -Q mac          # List supported MACs
ssh -Q key          # List supported public key types
ssh -Q kex          # List supported key exchange algorithms
</pre>

<p>
Finally, it's also possible to query the configuration that ssh is actually
using when attempting to connect to a specific host, by using the <tt>-G</tt>
option:
</p>

<pre>
ssh -G user@@somehost.example.com
</pre>

<p>
which will list all the configuration options, including the chosen values for
the <tt>Ciphers</tt>, <tt>MACs</tt>, <tt>HostKeyAlgorithms</tt> and
<tt>KexAlgorithms</tt> parameters.
</p>

</body>
</html>
@


1.8
log
@Add rel=canonical links pointing to https://www.openssh.com.  ok tb@@ tj@@
@
text
@d43 1
a43 1
<a href="http://man.openbsd.org/OpenBSD-current/man5/ssh_config.5"
@


1.7
log
@Consistent capitalization of HostKeyAlgorithms to match man page; also from
Ross L Richardson.
@
text
@d19 1
@


1.6
log
@Use "legacyhost" instead of 127.0.0.1 in examples.
@
text
@d125 1
a125 1
It can be re-enabled using the <tt>HostkeyAlgorithms</tt> configuration
d139 1
a139 1
	HostkeyAlgorithms +ssh-dss
d168 1
a168 1
the <tt>Ciphers</tt>, <tt>MACs</tt>, <tt>HostkeyAlgorithms</tt> and
@


1.5
log
@Some error corrections and wording improvements from ross at rlr.id.au with
some changes by me.
@
text
@d66 1
a66 1
Unable to negotiate with 127.0.0.1: no matching key exchange method found.
d94 1
a94 1
ssh -oKexAlgorithms=+diffie-hellman-group1-sha1 user@@127.0.0.1
d119 1
a119 1
Unable to negotiate with 127.0.0.1: no matching host key type found. Their offer: ssh-dss
d130 1
a130 1
ssh -oHostKeyAlgorithms=+ssh-dss user@@127.0.0.1
@


1.4
log
@fix some odd wording; noted by ross richards
@
text
@d41 15
a55 5
parameters to the other. These include the ciphers to encrypt the connection,
the message authentication codes (MACs) used to detect traffic modification,
the public key algorithms that the server can use to authenticate itself
to the client and the key exchange methods that are used to generate
per-connection keys. In a successful connection, there is at least one
d90 1
a90 1
the <tt>KexAlgorithm</tt> option - either on the command-line:
d119 1
a119 2
Unable to negotiate with 127.0.0.1: no matching host key type found.
Their offer: ssh-dss
d123 1
a123 1
OpenSSH 7.0 and greater similarly disables the <tt>ssh-dss</tt> (DSA)
d139 1
a139 1
	HostkeyAlgorithms ssh-dss
d158 2
a159 2
using when it is attempting to connect to a specific host using the <tt>-G</tt>
option. For example:
d167 1
a167 1
Will list all the configuration options, including the chosen values for
@


1.3
log
@move openssh website to css, remove some old files.
@
text
@d34 3
a36 4
some of the older algorithms have been been found weak not all are
algorithms are enabled by default. This page describes what to do when
OpenSSH refuses to connect with an implementation that only supports
legacy algorithms.
@


1.2
log
@Tyop.
@
text
@d4 1
a4 1
<title>Using OpenSSH with legacy software</title>
d17 3
a19 1
<meta name="copyright" content="This document copyright 2015 by OpenBSD.">
d23 6
a28 3
<a href="index.html"><img alt="[OpenSSH]" height="30" width="141" src="images/smalltitle.gif" border="0"></a>
<p>
<h2><font color="#e00000">Using OpenSSH with legacy SSH implementations</font></h2>
@


1.1
log
@documentation for re-enabling legacy crypto in OpenSSH 7.0+

"get it in" deraadt@@
@
text
@d144 1
a144 1
Finally, it's also possible to query the configuration that ssh is acutally
@

