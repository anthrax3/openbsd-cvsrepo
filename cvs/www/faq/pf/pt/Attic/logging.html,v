head	1.22;
access;
symbols;
locks; strict;
comment	@# @;


1.22
date	2014.04.01.17.14.11;	author nick;	state dead;
branches;
next	1.21;

1.21
date	2013.12.06.20.52.46;	author ajacoutot;	state Exp;
branches;
next	1.20;

1.20
date	2013.05.03.05.53.48;	author ajacoutot;	state Exp;
branches;
next	1.19;

1.19
date	2012.11.07.09.26.25;	author ajacoutot;	state Exp;
branches;
next	1.18;

1.18
date	2012.06.15.19.18.59;	author ajacoutot;	state Exp;
branches;
next	1.17;

1.17
date	2010.11.25.16.49.10;	author ajacoutot;	state Exp;
branches;
next	1.16;

1.16
date	2009.11.16.12.38.13;	author ajacoutot;	state Exp;
branches;
next	1.15;

1.15
date	2009.10.19.09.39.59;	author ajacoutot;	state Exp;
branches;
next	1.14;

1.14
date	2009.10.17.15.58.26;	author ajacoutot;	state Exp;
branches;
next	1.13;

1.13
date	2009.05.16.08.59.12;	author ajacoutot;	state Exp;
branches;
next	1.12;

1.12
date	2009.03.16.20.24.23;	author tobias;	state Exp;
branches;
next	1.11;

1.11
date	2007.12.01.10.39.11;	author tobias;	state Exp;
branches;
next	1.10;

1.10
date	2006.12.29.12.56.48;	author jufi;	state Exp;
branches;
next	1.9;

1.9
date	2006.06.26.18.32.12;	author jufi;	state Exp;
branches;
next	1.8;

1.8
date	2006.05.29.11.06.11;	author jufi;	state Exp;
branches;
next	1.7;

1.7
date	2005.12.24.10.04.36;	author saad;	state Exp;
branches;
next	1.6;

1.6
date	2005.12.03.08.02.51;	author saad;	state Exp;
branches;
next	1.5;

1.5
date	2005.11.18.20.48.47;	author jufi;	state Exp;
branches;
next	1.4;

1.4
date	2005.07.03.07.28.34;	author saad;	state Exp;
branches;
next	1.3;

1.3
date	2005.05.30.13.52.07;	author saad;	state Exp;
branches;
next	1.2;

1.2
date	2005.02.12.11.03.21;	author jufi;	state Exp;
branches;
next	1.1;

1.1
date	2005.01.06.20.03.30;	author jufi;	state Exp;
branches;
next	;


desc
@@


1.22
log
@
Abandon translations, per deraadt@@ and ajacoutot@@.
@
text
@<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<html>
<head>
<title>PF: Registro de Dados</title>
<link rev="made" href="mailto:www@@openbsd.org">
<meta http-equiv="Content-Type" content="text/html; charset=ISO-8859-1">
<meta name="resource-type" content="document">
<meta name="description"   content="the OpenBSD FAQ page">
<meta name="keywords"      content="openbsd,faq,pf">
<meta name="distribution"  content="global">
</head>

<!--
Copyright (c) 2003, Nick Holland <nick@@openbsd.org>
Copyright (c) 2003-2007, Joel Knight <enabled@@myrealbox.com>

Permission to use, copy, modify, and distribute this documentation for
any purpose with or without fee is hereby granted, provided that the
above copyright notice and this permission notice appear in all copies.

THE DOCUMENTATION IS PROVIDED "AS IS" AND THE AUTHOR DISCLAIMS ALL
WARRANTIES WITH REGARD TO THIS DOCUMENTATION INCLUDING ALL IMPLIED
WARRANTIES OF MERCHANTABILITY AND FITNESS. IN NO EVENT SHALL THE
AUTHOR BE LIABLE FOR ANY SPECIAL, DIRECT, INDIRECT, OR CONSEQUENTIAL
DAMAGES OR ANY DAMAGES WHATSOEVER RESULTING FROM LOSS OF USE, DATA OR
PROFITS, WHETHER IN AN ACTION OF CONTRACT, NEGLIGENCE OR OTHER
TORTIOUS ACTION, ARISING OUT OF OR IN CONNECTION WITH THE USE OR
PERFORMANCE OF THIS DOCUMENTATION
-->

<body bgcolor="#ffffff" text="#000000">
<!-- Passes validator.w3.org, please keep it this way;
please, use a max of 72 chars per line -->

<a href="../../../pt/index.html">
<img alt="[OpenBSD]" height=30 width=141 src="../../../images/smalltitle.gif" border="0">
</a>
<p>
[<a href="tagging.html">Anterior: Marcação de Pacotes</a>]
[<a href="index.html">Conteúdo</a>]
[<a href="perf.html">Próximo: Desempenho</a>]

<p>
<h1><font color="#e00000">PF: Registro de Dados</font></h1>

<hr>

<h3>Conteúdo</h3>
<ul>
<li><a href="#intro">Introdução</a>
<li><a href="#log">Registro de Pacotes</a>
<li><a href="#logfile">Leitura de um Arquivo de Registro</a>
<li><a href="#filter">Filtragem da Saída de Registro</a>
<li><a href="#syslog">Registro de Pacotes Através do Syslog</a>
</ul>

<hr>

<a name="intro"></a>
<h2>Introdução</h2>
Quando um pacote é registrado pelo PF, uma cópia do cabeçalho do pacote
é enviado para a interface
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=pflog&amp;sektion=4&amp;manpath=OpenBSD+5.4"
>pflog(8)</a> junto com alguns outros dados adicionais como a
interface onde o pacote estava transitando, a ação que o PF tomou
(liberou ou bloqueou), etc.
A interface pflog(4) permite que aplicativos no espaço de usuário
recebam os dados de registro do kernel.
Se o PF é ativado quando o sistema é inicializado, o daemon
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=pflogd&amp;sektion=8&amp;manpath=OpenBSD+5.4"
>pflogd(8)</a> é carregado.
Por padrão, o pflogd(8) escuta na interface <tt>pflog0</tt> e escreve
todos os dados de registro no arquivo <tt>/var/log/pflog</tt>.

<a name="log"></a>
<h2>Registro de Pacotes</h2>
<p>
Para registrar pacotes atravessando o PF, a palavra-chave <tt>log</tt>
deve ser usada.
A palavra-chave <tt>log</tt> faz com que todos os pacotes que
correspondam à regra sejam registrados.
No caso onde a regra <a href="filter.html#state">cria estado</a>, apenas
o primeiro pacote (o que faz com que o estado seja criado) será
registrado.

<p>
As opções que podem ser passadas à palavra-chave
<tt>log</tt> são:

<dl>
<dt><tt>all</tt>
<dd>Faz com que todos os pacotes correspondidos, e não apenas o
primeiro, sejam registrados.
É útil para regras que criam estado.

<dt><tt>to <i>pflogN</i></tt>
<dd>Faz com que todos os pacotes correspondidos sejam registrados na
interface pflog(4) especificada.
Por exemplo, ao usar o
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=spamlogd&amp;sektion=8"
>spamlogd(8)</a>, todo o tráfego SMTP pode ser registrado pelo PF em
uma interface pflog(4) dedicada.
O daemon spamlogd(8) pode então ser ordenado a escutar naquela
interface.
Isso mantém o arquivo de registro principal do PF livre de tráfego SMTP,
o qual, fora isso, não precisaria ser registrado.
Use o
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=ifconfig&amp;sektion=8"
>ifconfig(8)</a>
para criar interfaces pflog(4).
A interface de registro padrão <tt>pflog0</tt> é criada automaticamente.

<dt><tt>user</tt>
<dd>Faz com que além da informação padrão de registro, o ID de usuário
e o ID de grupo Unix do proprietário do soquete de origem/destino do
pacote (independente do soquete ser local) sejam registrados também.
</dl>

<p>
As opções devem ser informadas entre parêntesis após a palavra-chave
<tt>log</tt>; várias opções podem ser informadas separando-as com
vírgula ou espaço.

<blockquote>
<tt>
pass in log (all, to pflog1) on $ext_if inet proto tcp to $ext_if port 22 keep state
</tt>
</blockquote>


<a name="logfile"></a>
<h2>Leitura de um Arquivo de Registro</h2>
O arquivo de registro escrito pelo pflogd é em formato binário e não
pode ser lido com um editor de textos. O tcpdump deve ser utilizado para
ver o registro.

<p>
Para ver o arquivo de registro:
<blockquote>
<tt>
# tcpdump -n -e -ttt -r /var/log/pflog
</tt>
</blockquote>

<p>
Perceba que o uso do tcpdump(8) para ver um arquivo de registro
<i>não</i> mostra a atividade em tempo real. Um monitoramento em tempo
real dos pacotes registrados é conseguido usando a interface
<tt>pflog0</tt>:
<blockquote>
<tt>
# tcpdump -n -e -ttt -i pflog0
</tt>
</blockquote>

<p>
<font color="#e00000">NOTA: </font>
Ao examinar os registros, um cuidado especial deve ser tomado com a
loquacidade do decodificador de protocolos do tcpdump (ativada pela
opção <tt>-v</tt>). Os decodificadores de protocolos do tcpdump não
possuem um histórico de segurança perfeito.
Pelo menos em teoria, um ataque muito lento pode ser possível
utilizando-se de partes da carga útil dos pacotes que são registrados
pelo dispositivo de registro. É prática recomendada mover os arquivos
de registro para fora da máquina do firewall antes de examiná-los dessa
maneira.

<p>
Cuidado adicional deve existir com a segurança no acesso aos registros.
Por padrão, o pflogd registra 160 bytes do pacote no arquivo de registro.
Acesso aos registros pode prover acesso parcial à carga útil de
pacotes com informações sensíveis (como nomes de usuário e senhas do
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=telnet&amp;sektion=1"
>telnet(1)</a> ou
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=ftp&amp;sektion=1"
>ftp(1)</a>).

<a name="filter"></a>
<h2>Filtragem da Saída de Registro</h2>
Como o pflogd registra no formato binário tcpdump, toda a gama de
atributos do tcpdump pode ser utilizada ao examinar os registros.
Por exemplo, para ver apenas pacotes que correspondam à certa porta:
<blockquote>
<tt>
# tcpdump -n -e -ttt -r /var/log/pflog port 80
</tt>
</blockquote>

<p>
Isso pode ser filtrado ainda mais, limitando a exibição de pacotes com
certa combinação de máquina e porta:
<blockquote>
<tt>
# tcpdump -n -e -ttt -r /var/log/pflog port 80 and host 192.168.1.3
</tt>
</blockquote>

<p>
A mesma ideia pode ser aplicada ao ler através da interface
<tt>pflog0</tt>
<blockquote>
<tt>
# tcpdump -n -e -ttt -i pflog0 host 192.168.4.2
</tt>
</blockquote>

<p>
Note que isso não tem nenhum impacto sobre quais pacotes são registrados
no arquivo do pflogd; o comando acima apenas mostra pacotes conforme
eles são registrados.

<p>
Além de usar as regras de filtragem padrão do
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=tcpdump&amp;sektion=8"
>tcpdump(8)</a>, a linguagem de filtragem do tcpdump foi estendida para
ler a saída do pflogd:
<ul>
<li><tt>ip</tt> - a família de endereços é a IPv4.
<li><tt>ip6</tt> - a família de endereços é a IPv6.
<li><tt>on <i>interface</i></tt> - o pacote passou pela interface
    <i>interface</i>.
<li><tt>ifname <i>interface</i></tt> - o mesmo que
    <tt>on <i>interface</i></tt>.
<li><tt>ruleset <i>nome</i></tt> - o
    <a href="anchors.html">conjunto de regras/âncora</a> que o pacote
    correspondeu.
<li><tt>rulenum <i>número</i></tt> - o número <i>número</i> da regra que
    correspondeu ao pacote.
<li><tt>action <i>ação</i></tt> - a ação empregada no pacote.
    As ações possíveis são: <tt>pass</tt> e <tt>block</tt>.
<li><tt>reason <i>razão</i></tt> - a razão pela qual a <tt>ação</tt> foi
    tomada. As razões possíveis são: <tt>match</tt>,
    <tt>bad-offset</tt>, <tt>fragment</tt>, <tt>short</tt>,
    <tt>normalize</tt>, <tt>memory</tt>, <tt>bad-timestamp</tt>,
    <tt>congestion</tt>, <tt>ip-option</tt>, <tt>proto-cksum</tt>,
    <tt>state-mismatch</tt>, <tt>state-insert</tt>,
    <tt>state-limit</tt>, <tt>src-limit</tt> e <tt>synproxy</tt>.
<li><tt>inbound</tt> - o pacote estava entrando.
<li><tt>outbound</tt> - o pacote estava saindo.
</ul>

<p>
Exemplo:
<blockquote>
<tt>
# tcpdump -n -e -ttt -i pflog0 inbound and action block and on wi0
</tt>
</blockquote>

<p>
Isso mostra o registro em tempo real de pacotes de entrada que foram
bloqueados na interface wi0.

<a name="syslog"></a>
<h2>Registro de Pacotes Através do Syslog</h2>
Em muitas situações é desejável possuir os registros do firewall
disponíveis em formato texto ASCII e/ou enviá-los a um servidor de
registros remoto.
Tudo isso pode ser obtido com o uso de um pequeno script shell, algumas
pequenas alterações em arquivos de configuração do OpenBSD e com o
daemon de registro de dados
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=syslogd&amp;sektion=8"
>syslogd(8)</a>. O syslogd faz o registro em formato ASCII e também é
capaz de fazer o registro em um servidor remoto.

<p>
Crie o seguinte script:

<p>
<tt>/etc/pflogrotate</tt>
<pre>
	#!/bin/sh
	PFLOG=/var/log/pflog
	FILE=/var/log/pflog5min.$(date "+%Y%m%d%H%M")
	pkill -ALRM -u root -U root -t - -x pflogd
	if [ -r $PFLOG ] && [ $(stat -f %z $PFLOG) -gt 24 ]; then
	   mv $PFLOG $FILE
	   kill -HUP $(cat /var/run/pflogd.pid)
	   pkill -HUP -u root -U root -t - -x pflogd
	   tcpdump -n -e -s 160 -ttt -r $FILE | logger -t pf -p local0.info
	   rm $FILE
	fi
</pre>

<p>
Edite o arquivo de tarefas agendadas do root:
<blockquote>
<tt>
# crontab -u root -e
</tt>
</blockquote>

<p>
Adicione as duas linhas seguintes:
<blockquote>
<tt>
# rotate pf log file every 5 minutes<br>
0-59/5 *       *       *       *       /bin/sh /etc/pflogrotate
</tt>
</blockquote>

<p>
Adicione a linha a seguir em <tt>/etc/syslog.conf</tt>:
<blockquote>
<tt>
local0.info &nbsp;&nbsp;&nbsp;&nbsp;/var/log/pflog.txt
</tt>
</blockquote>

<p>
Se você também quer fazer o registro em um servidor remoto, insira
a linha:
<blockquote>
<tt>
local0.info &nbsp;&nbsp;&nbsp;&nbsp;@@syslogger
</tt>
</blockquote>

<p>
Certifique-se de que a máquina <i>syslogger</i> esteja definida no
arquivo
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=hosts&amp;sektion=5"
>hosts(5)</a>.

<p>
Crie o arquivo <tt>/var/log/pflog.txt</tt> para que o syslog possa
fazer o registro nele, e dê a ele as mesmas permissões do arquivo pflog.
<blockquote>
<tt>
# touch /var/log/pflog.txt<br>
# chmod 600 /var/log/pflog.txt
</tt>
</blockquote>

<p>
Avise o syslogd sobre as alterações, reiniciando-o:
<blockquote>
<tt>
# kill -HUP $(cat /var/run/syslog.pid)
</tt>
</blockquote>

<p>
Todos pacotes registrados agora são enviados para
<tt>/var/log/pflog.txt</tt>.
Caso a segunda linha tenha sido adicionada, eles também são enviados
para a máquina de registro remoto <i>syslogger</i>.

<p>
O script <tt>/etc/pflogrotate</tt> agora processa e exclui
<tt>/var/log/pflog</tt>, assim a rotação do <tt>pflog</tt> por
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=newsyslog&amp;sektion=8"
>newsyslog(8)</a> não é mais necessária e deve ser desabilitada.
Contudo, <tt>/var/log/pflog.txt</tt> substitui <tt>/var/log/pflog</tt>
e sua rotação deve ser ativada.
Altere <tt>/etc/newsyslog.conf</tt> da seguinte forma:
<pre>
    #/var/log/pflog       600    3    250    *    ZB "pkill -HUP -u root -U root -t - -x pflogd"
    /var/log/pflog.txt    600    7    *      24
</pre>

<p>
Agora o PF registra em <tt>/var/log/pflog.txt</tt> no formato ASCII.
Se estiver configurado em <tt>/etc/syslog.conf</tt>, também registra em
um servidor remoto. O registro não é imediato, pode levar cerca de
5-6 minutos (o intervalo da tarefa no cron) antes que os pacotes
registrados apareçam no arquivo.

<p>
[<a href="tagging.html">Anterior: Marcação de Pacotes</a>]
[<a href="index.html">Conteúdo</a>]
[<a href="perf.html">Próximo: Desempenho</a>]

<p>
<hr>
<a href="index.html"><img height="24" width="24" src="../../../images/back.gif" border="0" alt="[voltar]"></a>
<a href="mailto:www@@openbsd.org">www@@openbsd.org</a>
<br>
<small>
<!--
Originally [OpenBSD: index.html,v 1.49 ]<br>
$Translation: logging.html,v 1.22 2013/12/01 12:44:33 egypcio Exp $<br>
-->
$OpenBSD: logging.html,v 1.21 2013/12/06 20:52:46 ajacoutot Exp $
</small>

</body>
</html>
@


1.21
log
@Sync with Steelix CVS
@
text
@d384 1
a384 1
$OpenBSD$
@


1.20
log
@Sync with Steelix CVS
@
text
@d63 1
a63 1
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=pflog&amp;sektion=4&amp;manpath=OpenBSD+5.3"
d70 1
a70 1
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=pflogd&amp;sektion=8&amp;manpath=OpenBSD+5.3"
d381 2
a382 2
Originally [OpenBSD: index.html,v 1.48 ]<br>
$Translation: logging.html,v 1.21 2013/05/02 22:48:46 renato Exp $<br>
@


1.19
log
@Sync with Steelix CVS
@
text
@d63 1
a63 1
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=pflog&amp;sektion=4&amp;manpath=OpenBSD+5.2"
d70 1
a70 1
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=pflogd&amp;sektion=8&amp;manpath=OpenBSD+5.2"
d381 2
a382 2
Originally [OpenBSD: index.html,v 1.47 ]<br>
$Translation: logging.html,v 1.20 2012/11/06 16:57:12 egypcio Exp $<br>
@


1.18
log
@Sync with Steelix CVS
@
text
@d63 1
a63 1
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=pflog&amp;sektion=4&amp;manpath=OpenBSD+5.1"
d70 1
a70 1
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=pflogd&amp;sektion=8&amp;manpath=OpenBSD+5.1"
d381 2
a382 2
Originally [OpenBSD: index.html,v 1.46 ]<br>
$Translation: logging.html,v 1.19 2012/06/12 21:14:55 renato Exp $<br>
@


1.17
log
@Sync with Steelix CVS
@
text
@d63 1
a63 1
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=pflog&amp;sektion=4&amp;manpath=OpenBSD+4.8"
d70 1
a70 1
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=pflogd&amp;sektion=8&amp;manpath=OpenBSD+4.8"
d170 1
a170 1
Por padrão, o pflogd registra 96 bytes do pacote no arquivo de registro.
d280 1
a280 1
	   tcpdump -n -e -ttt -r $FILE | logger -t pf -p local0.info
d381 2
a382 2
Originally [OpenBSD: index.html,v 1.42 ]<br>
$Translation: logging.html,v 1.18 2010/11/24 16:29:16 renato Exp $<br>
@


1.16
log
@Sync with Steelix CVS
@
text
@d63 1
a63 1
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=pflog&amp;sektion=4&amp;manpath=OpenBSD+4.6"
d70 1
a70 1
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=pflogd&amp;sektion=8&amp;manpath=OpenBSD+4.6"
d79 1
a79 7
deve ser usada em regras de <a href="nat.html">NAT/rdr</a> e
<a href="filter.html">filtragem</a>.
É importante notar que o PF pode registrar apenas pacotes que estejam
sendo liberados ou bloqueados; você não pode criar uma regra que apenas
registre os pacotes.

<p>
d275 1
a275 1
	kill -ALRM $(cat /var/run/pflogd.pid)
d279 1
d358 1
a358 1
    #/var/log/pflog       600    3    250    *    ZB /var/run/pflogd.pid
d381 2
a382 2
Originally [OpenBSD: index.html,v 1.38 ]<br>
$Translation: logging.html,v 1.17 2009/11/12 10:00:47 alan Exp $<br>
@


1.15
log
@Sync with Steelix CVS
@
text
@d224 2
a225 2
<li><tt>ip</tt> - a família do endereço é a IPv4.
<li><tt>ip6</tt> - a família do endereço é a IPv6.
d387 1
a387 1
$Translation: logging.html,v 1.16 2009/10/18 16:52:52 alan Exp $<br>
@


1.14
log
@Sync with Steelix CVS
@
text
@d63 1
a63 1
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=pflog&amp;sektion=4&amp;manpath=OpenBSD+4.5"
d70 1
a70 1
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=pflogd&amp;sektion=8&amp;manpath=OpenBSD+4.5"
d386 2
a387 2
Originally [OpenBSD: index.html,v 1.37 ]<br>
$Translation: logging.html,v 1.15 2009/10/13 19:12:28 alan Exp $<br>
@


1.13
log
@Sync with Steelix CVS
@
text
@d4 2
a5 1
<title>PF: Logging</title><link rev="made" href="mailto:www@@openbsd.org">
d44 1
a44 1
<h1><font color="#e00000">PF: Logging</font></h1>
d51 4
a54 4
<li><a href="#log">Logando Pacotes</a>
<li><a href="#logfile">Lendo um Arquivo de Log</a>
<li><a href="#filter">Filtrando Saídas de Log</a>
<li><a href="#syslog">Logando Pacotes Através do Syslog</a>
d61 2
a62 2
Quando um pacote é logado pelo PF, uma cópia do cabeçalho do pacote é
enviado para a interface
d64 2
a65 2
>pflog(8)</a> junto com alguns outros dados adicionais, como a
interface que o pacote estava transitando, a ação que o PF tomou
d67 2
a68 2
A interface pflog(4) libera aplicações no espaço de usuário a receber
os dados de logging do kernel.
d72 2
a73 2
Por padrão, o pflogd(8) ouve na interface <tt>pflog0</tt> e escreve
todos os dados logados no arquivo <tt>/var/log/pflog</tt>.
d76 1
a76 1
<h2>Logando Pacotes</h2>
d78 1
a78 1
Para logar pacotes atravessando o PF, a palavra-chave <tt>log</tt>
d81 3
a83 3
Perceba que o PF pode logar apenas pacotes que estejam sendo liberados
ou bloqueados; você não pode criar uma regra que apenas
logue os pacotes.
d86 5
a90 5
A palavra-chave <tt>log</tt> faz com que todos os pacotes que casem
com a regra sejam logados.
No caso da regra estar <a href="filter.html#state">criando estado</a>,
apenas o primeiro pacote (o que faz com que o estado seja criado)
será logado.
d98 2
a99 2
<dd>Faz com que todos os pacotes, e não apenas o primeiro, sejam
logados.
d103 3
a105 3
<dd>Faz com que todos os pacotes casados sejam logados na interface
pflog(4) especificada.
Por exemplo, quando usando
d107 3
a109 3
>spamlogd(8)</a>, todo o tráfego SMTP pode ser logado pelo PF para uma
interface pflog(4) dedicada.
O daemon spamlogd(8) pode então ser ordenado para escutar naquela
d111 2
a112 2
Isso mantém limpo o arquivo de log principal do PF de tráfego SMTP, o
qual fora isso, não precisa ser logado.
d117 1
a117 1
A interface de log padrão <tt>pflog0</tt> é criada automaticamente.
d120 3
a122 3
<dd>Faz com que além da informação padrão de log, o user-id e
group-id Unix do usuário dono do socket de origem/destino do pacote
(independente de ser local) sejam logados também.
d126 1
a126 1
As opções devem ser informadas entre parênteses após a palavra-chave
d138 4
a141 4
<h2>Lendo um Arquivo de Log</h2>
O arquivo de log escrito pelo pflogd é em formato binário e não pode ser
lido utilizando um editor de textos. O tcpdump deve ser utilizado para
ver os logs.
d144 1
a144 1
Para ver o arquivo de log:
d152 4
a155 3
Perceba que o uso do tcpdump(8) para ver um arquivo de log <i>não</i>
mostra a atividade em tempo real. Um monitoramento em tempo real dos
pacotes logados é conseguido usando a interface <tt>pflog0</tt>:
d164 4
a167 4
Quando examinando logs, um cuidado especial deve ser tomado
com a opção verbose do decodificador de protocolos do tcpdump
(ativada pela opção <tt>-v</tt>). Os decodificadores de protocolos
do tcpdump não possuem um histórico de segurança perfeito.
d169 4
a172 3
utilizando-se de partes do payload dos pacotes que são logados pelo
dispositivo de log. É prática recomendada mover os arquivos de log
fora da máquina do firewall antes de examiná-los dessa maneira.
d175 4
a178 5
Cuidado adicional deve existir com a segurança no acesso aos logs.
Por padrão, o pflogd irá registrar 96 bytes do pacote no
arquivo de log. Acesso aos logs pode prover acesso parcial a
payloads de pacotes com informações sensíveis
(como nomes de usuário e senhas
d185 4
a188 4
<h2>Filtrando a Saída de Log</h2>
Como o pflogd loga em formato tcpdump binário, toda a gama de atributos
do tcpdump pode ser utilizada quando estiver examinando os logs. Por
exemplo, para ver apenas pacotes que casem com certa porta:
d196 2
a197 2
Isso pode ser filtrado ainda mais, limitando a exibição de pacotes
com certa combinação de host e porta:
d205 1
a205 1
A mesma idéia pode ser aplicada quando lendo através da interface
d214 3
a216 3
Note que isso não tem nenhum impacto sobre pacotes que são logados
no arquivo do pflogd; o comando acima mostra apenas pacotes
conforme eles são logados.
d221 1
a221 1
>tcpdump(8)</a>, a linguagem de filtragem do tcpdump foi extendida para
d224 22
a245 20
<li><tt>ip</tt> - família do endereço é IPv4.
<li><tt>ip6</tt> - família do endereço é IPv6.
<li><tt>on <i>int</i></tt> - pacote passou pela interface
    <i>int</i>.
<li><tt>ifname <i>int</i></tt> - o mesmo que <tt>on <i>int</i></tt>.
<li><tt>ruleset <i>nome</i></tt> - a
    <a href="anchors.html">ruleset/anchor</a> que o pacote casou.
<li><tt>rulenum <i>num</i></tt> - número <i>num</i> da regra que casou
    com o pacote.
<li><tt>action <i>act</i></tt> - a ação empregada no pacote.
    Ações possíveis são <tt>pass</tt> e <tt>block</tt>.
<li><tt>reason <i>res</i></tt> - a razão pela qual a <tt>ação</tt> foi
    tomada. Razões possíveis são <tt>match</tt>, <tt>bad-offset</tt>,
    <tt>fragment</tt>, <tt>short</tt>, <tt>normalize</tt>,
    <tt>memory</tt>, <tt>bad-timestamp</tt>, <tt>congestion</tt>,
    <tt>ip-option</tt>, <tt>proto-cksum</tt>, <tt>state-mismatch</tt>,
    <tt>state-insert</tt>, <tt>state-limit</tt>, <tt>src-limit</tt> e
    <tt>synproxy</tt>.
<li><tt>inbound</tt> - pacote estava entrando.
<li><tt>outbound</tt> - pacote estava saindo.
d257 1
a257 1
Isso mostra o log, em tempo real, de pacotes entrantes que foram
d261 7
a267 6
<h2>Logando Pacotes Através do Syslog</h2>
Em muitas situações é desejável possuir logs do firewall disponíveis
em formato texto ASCII e/ou enviá-los a um servidor de logs remoto.
Tudo isso pode ser obtido com o uso de um pequeno shell script,
algumas pequenas alterações em arquivos de configuração do OpenBSD,
e o daemon de log
d269 2
a270 2
>syslogd(8)</a>. O syslogd loga em formato ASCII e também é capaz de
logar em servidor remoto.
d291 1
a291 1
Edite o cron do root:
d316 2
a317 1
Se você também quiser logar num servidor remoto, insira a linha:
d325 2
a326 1
Certifique-se de que o host <i>syslogger</i> esteja definido no arquivo
d332 1
a332 1
logar nele, e dê a ele as mesmas permissões do arquivo pflog.
d349 1
a349 1
Todos pacotes logados agora são enviados para
d352 1
a352 1
para o host remoto <i>syslogger</i>.
d355 1
a355 1
O script <tt>/etc/pflogrotate</tt> agora processa e deleta
d358 1
a358 1
>newsyslog(8)</a> não é mais necessária, e deve ser desabilitada.
d368 5
a372 5
Agora o PF loga em <tt>/var/log/pflog.txt</tt> no formato ASCII.
Se estiver configurado em <tt>/etc/syslog.conf</tt>, também logará num
servidor remoto. O log não é imediato, pode levar cerca de 5-6
minutos (o intervalo da tarefa no cron) antes que os pacotes logados
apareçam no arquivo.
d387 1
a387 1
$Translation: logging.html,v 1.14 2009/05/12 00:31:16 alan Exp $<br>
@


1.12
log
@Sync with Steelix CVS
@
text
@d40 1
a40 1
[<a href="perf.html">Próximo: Performance</a>]
d62 1
a62 1
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=pflog&amp;sektion=8&amp;manpath=OpenBSD+4.4"
d69 1
a69 1
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=pflogd&amp;sektion=8&amp;manpath=OpenBSD+4.4"
d177 1
a177 1
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=telnet&amp;sektion=1&amp;manpath=OpenBSD+4.1"
d179 1
a179 1
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=ftp&amp;sektion=1&amp;manpath=OpenBSD+4.1"
d229 2
a230 2
<li><tt>rulenum <i>num</i></tt> - número da regra que casou com o
    pacote.
d370 1
a370 1
[<a href="perf.html">Próximo: Performance</a>]
d379 2
a380 2
Originally [OpenBSD: index.html,v 1.36 ]<br>
$Translation: logging.html,v 1.12 2009/03/11 00:52:56 dsantos Exp $<br>
@


1.11
log
@Sync with Steelix CVS
@
text
@d7 3
a9 3
<meta name="description" content="the OpenBSD FAQ page">
<meta name="keywords" content="openbsd,faq,pf">
<meta name="distribution" content="global">
d38 3
a40 3
[<a href="tagging.html">Anterior: Marca&ccedil;&atilde;o de Pacotes</a>]
[<a href="index.html">Conte&uacute;do</a>]
[<a href="perf.html">Pr&oacute;ximo: Performance</a>]
d47 1
a47 1
<h3>Conte&uacute;do</h3>
d49 1
a49 1
<li><a href="#intro">Introdu&ccedil;&atilde;o</a>
d52 2
a53 2
<li><a href="#filter">Filtrando Sa&iacute;das de Log</a>
<li><a href="#syslog">Logando Pacotes Atrav&eacute;s do Syslog</a>
d59 14
a72 16
<h2>Introdu&ccedil;&atilde;o</h2>
Quando um pacote &eacute; logado, uma c&oacute;pia do cabe&ccedil;alho do
pacote &eacute; enviada para a interface 
<a
href="http://www.openbsd.org/cgi-bin/man.cgi?query=pflog&amp;sektion=4&amp;manpath=OpenBSD+4.2"
>pflog(4)</a> junto com dados adicionais como a interface que o 
pacote foi transmitido, a a&ccedil;&atilde;o que o PF tomou (pass ou block),
etc. 
A interface pflog(4) permite que aplica&ccedil;&otilde;es em espa&ccedil;o de
usu&aacute;rio recebam dados de log do PF vindos do kernel. 
Se o PF estiver habilitado quando o sistema iniciar, o servi&ccedil;o 
<a
href="http://www.openbsd.org/cgi-bin/man.cgi?query=pflogd&amp;sektion=8&amp;manpath=OpenBSD+4.2"
>pflogd(8)</a> &eacute; iniciado.
Por padr&atilde;o pflogd(8) escuta a interface <tt>pflog0</tt> e escreve
todos os dados de log no arquivo <tt>/var/log/pflog</tt>.
d78 1
a78 1
deve ser usada em regras <a href="nat.html">NAT/rdr</a> e 
d80 2
a81 2
Perceba que o PF pode logar apenas pacotes que estejam sendo liberados 
ou bloqueados; voc&ecirc; n&atilde;o pode criar uma regra que apenas 
d85 1
a85 1
A palavra-chave <tt>log</tt> faz com que todos os pacotes que combinem 
d87 3
a89 3
No caso da regra estar <a href="filter.html#state">criando estado</a>, 
apenas o primeiro pacote (o que faz com que o estado seja criado) 
ser&aacute; logado.
d92 2
a93 2
As op&ccedil;&otilde;es que podem ser passadas a palavra-chave 
<tt>log</tt> s&atilde;o:
d97 1
a97 1
<dd>Faz com que todos os pacotes, e n&atilde;o apenas o primeiro, sejam
d99 1
a99 1
&Eacute; &uacute;til para regras que criam estado.
d102 3
a104 3
<dd>Faz com que todos os pacotes que combinem com a regra sejam logados
na interface pflog(4) especificada.
Por exemplo, quando estiver usando
d106 7
a112 7
>spamlogd(8)</a> todo o trafego SMTP pode ser logado numa interface pflog(4)
dedicada pelo PF. 
O servi&ccedil;o spamlogd(8) pode ent&atilde;o ser configurado para escutar
nesta interface.
Isto mant&eacute;m o arquivo principal de log do PF limpo de trafego SMTP
que de alguma forma n&atilde;o precisa ser logado.
Use
d114 3
a116 3
>ifconfig(8)</a> para criar interfaces pflog(4).
A interface de log padr&atilde;o <tt>pflog0</tt> &eacute; criada
automaticamente. 
d119 3
a121 4
<dd>Faz com que al&eacute;m da informa&ccedil;&atilde;o padr&atilde;o de
log, o user-id e group-id Unix do usu&aacute;rio dono do socket de 
origem/destino do pacote (independente de ser local) sejam logados 
tamb&eacute;m.
d125 3
a127 3
As op&ccedil;&otilde;es devem ser informadas entre par&ecirc;nteses
ap&oacute;s a palavra <tt>log</tt>; v&aacute;rias op&ccedil;&otilde;es 
podem ser informadas separando-as com v&iacute;rgula ou espa&ccedil;o.
d131 1
a131 3
pass in log (all, to pflog1) on $ext_if inet proto tcp to $ext_if port 22 keep
state

d135 1
d138 2
a139 2
O arquivo de log escrito pelo pflogd &eacute; em formato bin&aacute;rio e n&atilde;o pode ser 
lido utilizando um editor de texto. O tcpdump deve ser utilizado para 
d151 3
a153 3
Perceba que usando tcpdump(8) para ver um arquivo de log <i>n&atilde;o</i> 
mostra a atividade em tempo real. Um monitoramento em tempo real dos 
pacotes logados &eacute; conseguido usando a interface <tt>pflog0</tt>:
d162 16
a177 18
Quando estiver examinando logs, um cuidado especial deve ser tomado 
com a op&ccedil;&atilde;o verbose do decodificador de protocolos do tcpdump 
(ativada pela op&ccedil;&atilde;o <tt>-v</tt>). Os decodificadores de 
protocolos do tcpdump n&atilde;o possuem um perfeito hist&oacute;rico de 
seguran&ccedil;a.  Pelo menos em teoria, um ataque muito lento 
pode ser poss&iacute;vel utilizando-se de partes do payload dos 
pacotes que s&atilde;o logados pelo dispositivo de log. &Eacute; 
pr&aacute;tica recomendada mover os arquivos de log fora da 
m&aacute;quina do firewall antes de examin&aacute;-los desta maneira.

<p>
Um cuidado adicional deve existir com a seguran&ccedil;a no acesso aos 
logs. Por padr&atilde;o, pflogd ir&aacute; registrar 96 bytes do pacote no 
arquivo de log.  O acesso aos logs pode prover acesso parcial a 
payloads de pacotes com informa&ccedil;&otilde;es sens&iacute;veis  
(como nomes de usu&aacute;rio e senhas 
<a
href="http://www.openbsd.org/cgi-bin/man.cgi?query=telnet&amp;sektion=1"
d179 1
a179 2
<a
href="http://www.openbsd.org/cgi-bin/man.cgi?query=ftp&amp;sektion=1"
d183 4
a186 4
<h2>Filtrando a Sa&iacute;da de Log</h2>
Como pflogd loga em formato tcpdump bin&aacute;rio, toda a gama de atributos 
do tcpdump pode ser utilizada quando estiver examinando os logs. Por 
exemplo, para ver apenas pacotes que combinem com certa porta:
d194 2
a195 2
Isso pode ser filtrado ainda mais limitando a exibi&ccedil;&atilde;o de pacotes 
com certa combina&ccedil;&atilde;o de host e porta:
d203 1
a203 1
A mesma id&eacute;ia pode ser aplicada quando lendo atrav&eacute;s da interface 
d212 3
a214 3
Note que isso n&atilde;o tem nenhum impacto sobre pacotes que s&atilde;o logados
no arquivos do pflogd; o comando acima mostra apenas pacotes 
conforme eles s&atilde;o logados.
d217 4
a220 4
Al&eacute;m de usar as regras de filtragem padr&atilde;o do 
<a
href="http://www.openbsd.org/cgi-bin/man.cgi?query=tcpdump&amp;sektion=8">tcpdump(8)</a>, 
a linguagem do tcpdump do OpenBSD's foi extendida para ler a sa&iacute;da do pflogd:
d222 2
a223 2
<li><tt>ip</tt> - fam&iacute;lia do endere&ccedil;o &eacute; IPv4.
<li><tt>ip6</tt> - fam&iacute;lia do endere&ccedil;o &eacute; IPv6.
d225 1
a225 1
<i>int</i>.
d227 13
a239 12
<li><tt>ruleset <i>nome</i></tt> - a 
<a href="anchors.html">ruleset/anchor</a> que o pacote combinou.
<li><tt>rulenum <i>num</i></tt> - n&uacute;mero da regra que combinou com o pacote.
<li><tt>action <i>act</i></tt> - a a&ccedil;&atilde;o empregada no pacote.
A&ccedil;&otilde;es poss&iacute;veis s&atilde;o <tt>pass</tt> e <tt>block</tt>.
<li><tt>reason <i>res</i></tt> - a raz&atilde;o pela qual a <tt>a&ccedil;&atilde;o</tt> foi  
tomada. Raz&otilde;es poss&iacute;veis s&atilde;o <tt>match</tt>, <tt>bad-offset</tt>,
<tt>fragment</tt>, <tt>short</tt>, <tt>normalize</tt>, 
<tt>memory</tt>, <tt>bad-timestamp</tt>,
<tt>congestion</tt>, <tt>ip-option</tt>, <tt>proto-cksum</tt>,
<tt>state-mismatch</tt>, <tt>state-insert</tt>, <tt>state-limit</tt>,
<tt>src-limit</tt> e <tt>synproxy</tt>.
d253 2
a254 2
Isso mostra o log, em tempo real, de pacotes entrantes que foram 
bloquados na interface wi0.
d257 9
a265 10
<h2>Logando Pacotes Atrav&eacute;s do Syslog</h2>
Em muitas situa&ccedil;&otilde;es &eacute; desej&aacute;vel possuir 
logs do firewall dispon&iacute;veis em formato texto ASCII e/ou 
envi&aacute;-los a um servidor de logs remoto. 
Tudo isso pode ser obtido com o uso de um pequeno shell script, 
algumas pequenas altera&ccedil;&otilde;es em arquivos de 
configura&ccedil;&atilde;o do OpenBSD, e o servi&ccedil;o de log 
<a
href="http://www.openbsd.org/cgi-bin/man.cgi?query=syslogd&amp;sektion=8">syslogd(8)</a>. 
O syslogd loga em formato ASCII e tamb&eacute;m &eacute; capaz de logar em servidor remoto.
d278 4
a281 4
		mv $PFLOG $FILE
		kill -HUP $(cat /var/run/pflogd.pid)
		tcpdump -n -e -ttt -r $FILE | logger -t pf -p local0.info
		rm $FILE
d311 1
a311 2
Se voc&ecirc; tamb&eacute;m quiser logar num servidor remoto, insira 
a linha:
d319 2
a320 3
Certifique-se de que <i>syslogger</i> esteja definido no arquivo 
<a
href="http://www.openbsd.org/cgi-bin/man.cgi?query=hosts&amp;sektion=5"
d324 2
a325 2
Crie o arquivo <tt>/var/log/pflog.txt</tt> para que o syslog 
possa logar nele e de as mesmas permiss&otilde;es do arquivo pflog.
d334 1
a334 1
Avise o syslogd sobre a altera&ccedil;&atilde;o, reinciando-o:
d342 1
a342 1
Todos pacotes logados agora s&atilde;o enviados para 
d344 2
a345 2
Caso a segunda linha tenha sido adicionada eles tamb&eacute;m 
s&atilde;o enviados para o host remoto <i>syslogger</i>.
d348 6
a353 7
O script <tt>/etc/pflogrotate</tt> agora processa e deleta 
<tt>/var/log/pflog</tt>, assim a rota&ccedil;&atilde;o do 
<tt>pflog</tt> por <a
href="http://www.openbsd.org/cgi-bin/man.cgi?query=newsyslog&amp;sektion=8">newsyslog(8)</a> 
n&atilde;o &eacute; mais necess&aacute;ria, e deve ser desabilitada. Contudo, 
<tt>/var/log/pflog.txt</tt> subistitui
<tt>/var/log/pflog</tt> e sua rota&ccedil;&atilde;o deve ser ativada.
d355 1
a355 1
<pre>    
d361 5
a365 5
Agora o PF loga em <tt>/var/log/pflog.txt</tt> no formato ASCII. 
Se estiver configurado em <tt>/etc/syslog.conf</tt>, tamb&eacute;m 
logar&aacute; num servidor remoto.  O log n&atilde;o &eacute; imediato 
podendo ser necess&aacute;rio no m&aacute;ximo 5-6 minutos (o 
intervalo da tarefa no cron) para que eles apace&ccedil;am no arquivo.
d368 3
a370 3
[<a href="tagging.html">Anterior: Marca&ccedil;&atilde;o de Pacotes</a>]
[<a href="index.html">Conte&uacute;do</a>]
[<a href="perf.html">Pr&oacute;ximo: Performance</a>]
d379 2
a380 2
Originally [OpenBSD: index.html,v 1.34 ]<br>
$Translation: logging.html,v 1.11 2007/11/24 18:12:31 dsantos Exp $<br>
d382 1
a382 1
$OpenBSD$ 
@


1.10
log
@sync with steelix translation CVS
@
text
@d14 1
a14 1
Copyright (c) 2003-2005, Joel Knight <enabled@@myrealbox.com>
d49 1
a49 1
<li><a href="#intro">Introdu&ccedil;ao</a>
d60 2
a61 1
O log de pacotes no PF &eacute; feito pelo 
d63 7
a69 2
href="http://www.openbsd.org/cgi-bin/man.cgi?query=pflogd&amp;sektion=8&amp;manpath=OpenBSD+4.0"
>pflogd(8)</a> que ouve na interface 
d71 4
a74 6
href="http://www.openbsd.org/cgi-bin/man.cgi?query=pflog&amp;sektion=4&amp;manpath=OpenBSD+4.0"
><tt>pflog0</tt></a> e escreve logs em arquivo (normalmente /var/log/pflog) 
em formato bin&aacute;rio 
<a
href="http://www.openbsd.org/cgi-bin/man.cgi?query=tcpdump&amp;sektion=8&amp;manpath=OpenBSD+4.0">tcpdump(8)</a>. Regras de <a href="filter.html">Filtragem</a> que especificam <tt>log</tt> 
ou <tt>log (all)</tt> s&atilde;o logadas desta maneira.
d103 17
d134 3
a136 1
pass in log (all) on $ext_if inet proto tcp to $ext_if port 22 keep state
a139 3
<p>
Loga todos os pacots com destino &agrave; porta 22.

d143 1
a143 1
lido utilizando um editor de textos. O tcpdump deve ser utilizado para 
d166 1
a166 1
Quando examinando logs, cuidado especial deve ser tomado 
d177 1
a177 1
Cuidado adicional deve existir com a seguran&ccedil;a no acesso aos 
d179 1
a179 1
arquivo de log.  Acesso aos logs pode prover acesso parcial a 
d183 1
a183 1
href="http://www.openbsd.org/cgi-bin/man.cgi?query=telnet&amp;sektion=1&amp;manpath=OpenBSD+4.0"
d186 1
a186 1
href="http://www.openbsd.org/cgi-bin/man.cgi?query=ftp&amp;sektion=1&amp;manpath=OpenBSD+4.0"
d226 2
a227 2
href="http://www.openbsd.org/cgi-bin/man.cgi?query=tcpdump&amp;sektion=8&amp;manpath=OpenBSD+4.0">tcpdump(8)</a>, a linguagem do tcpdump do OpenBSD's 
foi extendida para ler a sa&iacute;da do pflogd:
d266 1
a266 1
envi&accute;-los a um servidor de logs remoto. 
d269 1
a269 1
configura&ccedil;&atilde;o do OpenBSD, e o daemon de log 
d271 2
a272 2
href="http://www.openbsd.org/cgi-bin/man.cgi?query=syslogd&amp;sektion=8&amp;manpath=OpenBSD+4.0">syslogd(8)</a>. O syslogd loga em formato ASCII e 
tamb&eacute;m &eacute; capaz de logar em servidor remoto.
d329 1
a329 1
href="http://www.openbsd.org/cgi-bin/man.cgi?query=hosts&amp;sektion=5&amp;manpath=OpenBSD+4.0"
d358 1
a358 1
<tt>/var/log/pflog</tt> assim, a rota&ccedil;&atilde;o do 
d360 2
a361 2
href="http://www.openbsd.org/cgi-bin/man.cgi?query=newsyslog&amp;sektion=8&amp;manpath=OpenBSD+4.0">newsyslog(8)</a> n&atilde;o &eacute; mais 
necess&aacute;ria, e deve ser desabilitada. Contudo, 
d389 2
a390 2
Originally [OpenBSD: index.html,v 1.31 ]<br>
$Translation: logging.html,v 1.10 2006/12/28 18:29:29 dsantos Exp $<br>
@


1.9
log
@sync with steelix translation CVS
@
text
@d62 1
a62 1
href="http://www.openbsd.org/cgi-bin/man.cgi?query=pflogd&amp;sektion=8&amp;manpath=OpenBSD+3.9"
d65 1
a65 1
href="http://www.openbsd.org/cgi-bin/man.cgi?query=pflog&amp;sektion=4&amp;manpath=OpenBSD+3.9"
d69 1
a69 1
href="http://www.openbsd.org/cgi-bin/man.cgi?query=tcpdump&amp;sektion=8&amp;manpath=OpenBSD+3.9">tcpdump(8)</a>. Regras de <a href="filter.html">Filtragem</a> que especificam <tt>log</tt> 
d163 1
a163 1
href="http://www.openbsd.org/cgi-bin/man.cgi?query=telnet&amp;sektion=1&amp;manpath=OpenBSD+3.9"
d166 1
a166 1
href="http://www.openbsd.org/cgi-bin/man.cgi?query=ftp&amp;sektion=1&amp;manpath=OpenBSD+3.9"
d206 1
a206 1
href="http://www.openbsd.org/cgi-bin/man.cgi?query=tcpdump&amp;sektion=8&amp;manpath=OpenBSD+3.9">tcpdump(8)</a>, a linguagem do tcpdump do OpenBSD's 
d251 1
a251 1
href="http://www.openbsd.org/cgi-bin/man.cgi?query=syslogd&amp;sektion=8&amp;manpath=OpenBSD+3.9">syslogd(8)</a>. O syslogd loga em formato ASCII e 
d309 1
a309 1
href="http://www.openbsd.org/cgi-bin/man.cgi?query=hosts&amp;sektion=5&amp;manpath=OpenBSD+3.9"
d340 1
a340 1
href="http://www.openbsd.org/cgi-bin/man.cgi?query=newsyslog&amp;sektion=8&amp;manpath=OpenBSD+3.9">newsyslog(8)</a> n&atilde;o &eacute; mais 
d369 2
a370 2
Originally [OpenBSD: index.html,v 1.29 ]<br>
$Translation: logging.html,v 1.9 2006/06/23 15:10:21 dsantos Exp $<br>
@


1.8
log
@sync with steelix translation CVS
@
text
@d244 6
a249 5
Em muitas situa&ccedil;&otilde;es &eacute; desej&aacute;vel possuir logs do firewall 
dispon&iacute;veis em formato texto ASCII e/ou envi&accute;-los a um servidor de logs remoto. 
Tudo isso pode ser obtido com o uso de dois pequenos shell scripts, algumas 
pequenas altera&ccedil;&otilde;es em arquivos de configura&ccedil;&atilde;o do OpenBSD, e o 
daemon de log 
d251 2
a252 2
href="http://www.openbsd.org/cgi-bin/man.cgi?query=syslogd&amp;sektion=8&amp;manpath=OpenBSD+3.9">syslogd(8)</a>. O syslogd loga em formato ASCII e tamb&eacute;m &eacute; capaz de logar 
em servidor remoto.
d255 1
a255 7
Primeiro devemos criar um usu&aacute;rio, <tt>pflogger</tt>, com shell 
<tt>/sbin/nologin</tt>. A forma mais f&aacute;cil de cria-lo &eacute; com 
<a
href="http://www.openbsd.org/cgi-bin/man.cgi?query=adduser&amp;sektion=8&amp;manpath=OpenBSD+3.9">adduser(8)</a>.

<p>
Ap&oacute;s criar o usu&aacute;rio <tt>pflogger</tt>, crie os dois scripts:
d261 2
a262 1
	FILE=/home/pflogger/pflog5min.$(date "+%Y%m%d%H%M")
d264 2
a265 3
	if [ $(ls -l /var/log/pflog | cut -d " " -f 8) -gt 24 ]; then
		mv /var/log/pflog $FILE
		chown pflogger $FILE
d267 2
a268 17
	fi
</pre>

<p>
<tt>/home/pflogger/pfl2sysl</tt>
<pre>
	#!/bin/sh
	# feed rotated pflog file(s) to syslog
	# do not start if another instance of this script is already running
	pgrep pfl2sysl >/dev/null 2>&1
	if [ $? -ne 0 ] ; then
		for logfile in /home/pflogger/pflog5min* ; do
			if [ -f "$logfile" ] ; then
				tcpdump -n -e -ttt -r $logfile | logger -t pf -p local0.info
				rm $logfile
			fi
		done
a289 17
Crie uma entrada no cron para o usu&aacute;rio <tt>pflogger</tt>:
<blockquote>
<tt>
# crontab -u pflogger -e
</tt>
</blockquote>

<p>
Adicione as duas linhas seguintes:
<blockquote>
<tt>
# feed rotated pflog file(s) to syslog<br>
0-59/5 *       *       *       *       /bin/sh /home/pflogger/pfl2sysl
</tt>
</blockquote>

<p>
d298 2
a299 1
Se voc&ecirc; tamb&eacute;m quiser logar num servidor remoto, insira a linha:
d314 1
a314 1
possa logar nele.
d317 2
a318 1
# touch /var/log/pflog.txt
d331 4
a334 3
Todos pacotes logados agora s&atilde;o enviados para <tt>/var/log/pflog.txt</tt>.
Caso a segunda linha tenha sido adicionada eles tamb&eacute;m s&atilde;o enviados para 
o host remoto <i>syslogger</i>.
d338 5
a342 4
<tt>/var/log/pflog</tt> assim, a rota&ccedil;&atilde;o do <tt>pflog</tt> por 
<a
href="http://www.openbsd.org/cgi-bin/man.cgi?query=newsyslog&amp;sektion=8&amp;manpath=OpenBSD+3.9">newsyslog(8)</a> n&atilde;o &eacute; mais necess&aacute;ria, e deve 
ser desabilitada. Contudo, <tt>/var/log/pflog.txt</tt> subistitui
d353 3
a355 3
logar&aacute; num servidor remoto.  O log n&atilde;o &eacute; imediato podendo ser 
necess&aacute;rio no m&aacute;ximo 5-6 minutos (o intervalo da tarefa no cron) para que 
eles apace&ccedil;am no arquivo.
d369 2
a370 2
Originally [OpenBSD: index.html,v 1.26 ]<br>
$Translation: logging.html,v 1.8 2006/05/28 17:23:02 dsantos Exp $<br>
@


1.7
log
@sync with Steelix CVS
@
text
@d50 1
d62 1
a62 1
href="http://www.openbsd.org/cgi-bin/man.cgi?query=pflogd&amp;sektion=8&amp;manpath=OpenBSD+3.8"
d65 1
a65 1
href="http://www.openbsd.org/cgi-bin/man.cgi?query=pflog&amp;sektion=4&amp;manpath=OpenBSD+3.8"
d69 1
a69 1
href="http://www.openbsd.org/cgi-bin/man.cgi?query=tcpdump&amp;sektion=8&amp;manpath=OpenBSD+3.8">tcpdump(8)</a>. Regras de <a href="filter.html">Filtragem</a> que especificam <tt>log</tt> 
d72 48
d163 1
a163 1
href="http://www.openbsd.org/cgi-bin/man.cgi?query=telnet&amp;sektion=1&amp;manpath=OpenBSD+3.8"
d166 1
a166 1
href="http://www.openbsd.org/cgi-bin/man.cgi?query=ftp&amp;sektion=1&amp;manpath=OpenBSD+3.8"
d206 1
a206 1
href="http://www.openbsd.org/cgi-bin/man.cgi?query=tcpdump&amp;sektion=8&amp;manpath=OpenBSD+3.8">tcpdump(8)</a>, a linguagem do tcpdump do OpenBSD's 
d250 1
a250 1
href="http://www.openbsd.org/cgi-bin/man.cgi?query=syslogd&amp;sektion=8&amp;manpath=OpenBSD+3.8">syslogd(8)</a>. O syslogd loga em formato ASCII e tamb&eacute;m &eacute; capaz de logar 
d257 1
a257 1
href="http://www.openbsd.org/cgi-bin/man.cgi?query=adduser&amp;sektion=8&amp;manpath=OpenBSD+3.8">adduser(8)</a>.
d345 1
a345 1
href="http://www.openbsd.org/cgi-bin/man.cgi?query=hosts&amp;sektion=5&amp;manpath=OpenBSD+3.8"
d374 1
a374 1
href="http://www.openbsd.org/cgi-bin/man.cgi?query=newsyslog&amp;sektion=8&amp;manpath=OpenBSD+3.8">newsyslog(8)</a> n&atilde;o &eacute; mais necess&aacute;ria, e deve 
d402 2
a403 2
Originally [OpenBSD: index.html,v 1.24 ]<br>
$Translation: logging.html,v 1.7 2005/12/22 21:21:45 dsantos Exp $<br>
@


1.6
log
@sync with Steelix CVS
@
text
@d69 1
a69 1
ou <tt>log-all</tt> s&atilde;o logadas desta maneira.
d353 2
a354 2
Originally [OpenBSD: index.html,v 1.23 ]<br>
$Translation: logging.html,v 1.6 2005/12/01 17:48:38 dsantos Exp $<br>
@


1.5
log
@sync with steelix translation CVS
@
text
@d216 8
a223 7
        FILE=/home/pflogger/pflog5min.$(date "+%Y%m%d%H%M")
        kill -ALRM $(cat /var/run/pflogd.pid)
        if [ $(ls -l /var/log/pflog | cut -d " " -f 8) -gt 24 ]; then
           mv /var/log/pflog $FILE
           chown pflogger $FILE
           kill -HUP $(cat /var/run/pflogd.pid)
        fi
d229 12
a240 6
        for logfile in /home/pflogger/pflog5min* ; do
           if [ -s "$logfile" ]; then
              tcpdump -n -e -ttt -r $logfile | logger -t pf -p local0.info
              rm $logfile
           fi
        done
d353 2
a354 2
Originally [OpenBSD: index.html,v 1.22 ]<br>
$Translation: logging.html,v 1.5 2005/11/15 14:36:42 dsantos Exp $<br>
@


1.4
log
@sync with Steelix CVS
@
text
@d60 2
a61 1
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=pflogd&amp;sektion=8&amp;manpath=OpenBSD+3.7"
d63 2
a64 1
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=pflog&amp;sektion=4&amp;manpath=OpenBSD+3.7"
d67 2
a68 1
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=tcpdump&amp;sektion=8&amp;manpath=OpenBSD+3.7">tcpdump(8)</a>. Regras de <a href="filter.html">Filtragem</a> que especificam <tt>log</tt> 
d113 2
a114 1
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=telnet&amp;sektion=1&amp;manpath=OpenBSD+3.7"
d116 2
a117 1
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=ftp&amp;sektion=1&amp;manpath=OpenBSD+3.7"
d156 2
a157 1
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=tcpdump&amp;sektion=8&amp;manpath=OpenBSD+3.7">tcpdump(8)</a>, a linguagem do tcpdump do OpenBSD's 
d200 2
a201 1
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=syslogd&amp;sektion=8&amp;manpath=OpenBSD+3.7">syslogd(8)</a>. O syslogd loga em formato ASCII e tamb&eacute;m &eacute; capaz de logar 
d207 2
a208 1
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=adduser&amp;sektion=8&amp;manpath=OpenBSD+3.7">adduser(8)</a>.
d288 2
a289 1
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=hosts&amp;sektion=5&amp;manpath=OpenBSD+3.7"
d317 2
a318 1
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=newsyslog&amp;sektion=8&amp;manpath=OpenBSD+3.7">newsyslog(8)</a> n&atilde;o &eacute; mais necess&aacute;ria, e deve 
d345 4
a348 2
Originally [OpenBSD: index.html,v 1.21 ]<br>
$Translation: logging.html,v 1.4 2005/06/30 20:56:33 dsantos Exp $<br>
@


1.3
log
@sync with Steelix CVS
@
text
@d159 2
d335 2
a336 2
Originally [OpenBSD: index.html,v 1.20 ]<br>
$Translation: logging.html,v 1.3 2005/05/27 15:11:33 dsantos Exp $<br>
@


1.2
log
@Sync with Steelix CVS
@
text
@d60 1
a60 1
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=pflogd&amp;sektion=8&amp;manpath=OpenBSD+3.6"
d62 1
a62 1
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=pflog&amp;sektion=4&amp;manpath=OpenBSD+3.6"
d65 1
a65 1
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=tcpdump&amp;sektion=8&amp;manpath=OpenBSD+3.6">tcpdump(8)</a>. Regras de <a href="filter.html">Filtragem</a> que especificam <tt>log</tt> 
d110 1
a110 1
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=telnet&amp;sektion=1&amp;manpath=OpenBSD+3.6"
d112 1
a112 1
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=ftp&amp;sektion=1&amp;manpath=OpenBSD+3.6"
d151 1
a151 1
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=tcpdump&amp;sektion=8&amp;manpath=OpenBSD+3.6">tcpdump(8)</a>, a linguagem do tcpdump do OpenBSD's 
d165 4
a168 1
<tt>memory</tt> e <tt>bad-timestamp</tt>.
d192 1
a192 1
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=syslogd&amp;sektion=8&amp;manpath=OpenBSD+3.6">syslogd(8)</a>. O syslogd loga em formato ASCII e tamb&eacute;m &eacute; capaz de logar 
d198 1
a198 1
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=adduser&amp;sektion=8&amp;manpath=OpenBSD+3.6">adduser(8)</a>.
d278 1
a278 1
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=hosts&amp;sektion=5&amp;manpath=OpenBSD+3.6"
d306 1
a306 1
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=newsyslog&amp;sektion=8&amp;manpath=OpenBSD+3.6">newsyslog(8)</a> n&atilde;o &eacute; mais necess&aacute;ria, e deve 
d333 2
a334 2
Originally [OpenBSD: index.html,v 1.19 ]<br>                                                      
$Translation: logging.html,v 1.2 2005/02/11 15:58:44 dsantos Exp $<br>                 
@


1.1
log
@sync with steelix translation CVS
@
text
@d14 1
a14 1
Copyright (c) 2003, 2004, Joel Knight <enabled@@myrealbox.com>
d164 2
a165 2
<tt>fragment</tt>, <tt>short</tt>, <tt>normalize</tt> e 
<tt>memory</tt>.
d330 2
a331 2
Originally [OpenBSD: index.html,v 1.18 ]<br>                                                      
$Translation: logging.html,v 1.1 2005/01/04 17:09:07 dsantos Exp $<br>                 
@

