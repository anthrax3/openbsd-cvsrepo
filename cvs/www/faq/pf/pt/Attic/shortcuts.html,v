head	1.20;
access;
symbols;
locks; strict;
comment	@# @;


1.20
date	2014.04.01.17.14.11;	author nick;	state dead;
branches;
next	1.19;

1.19
date	2013.12.06.20.52.46;	author ajacoutot;	state Exp;
branches;
next	1.18;

1.18
date	2013.05.03.05.53.48;	author ajacoutot;	state Exp;
branches;
next	1.17;

1.17
date	2012.11.07.09.26.25;	author ajacoutot;	state Exp;
branches;
next	1.16;

1.16
date	2012.11.02.07.24.05;	author ajacoutot;	state Exp;
branches;
next	1.15;

1.15
date	2012.01.03.08.19.10;	author ajacoutot;	state Exp;
branches;
next	1.14;

1.14
date	2011.09.24.06.19.54;	author ajacoutot;	state Exp;
branches;
next	1.13;

1.13
date	2010.11.25.16.49.10;	author ajacoutot;	state Exp;
branches;
next	1.12;

1.12
date	2010.09.25.05.38.50;	author ajacoutot;	state Exp;
branches;
next	1.11;

1.11
date	2009.10.19.09.39.59;	author ajacoutot;	state Exp;
branches;
next	1.10;

1.10
date	2009.10.17.15.58.26;	author ajacoutot;	state Exp;
branches;
next	1.9;

1.9
date	2009.05.16.08.59.12;	author ajacoutot;	state Exp;
branches;
next	1.8;

1.8
date	2009.03.16.20.24.23;	author tobias;	state Exp;
branches;
next	1.7;

1.7
date	2007.12.01.10.39.11;	author tobias;	state Exp;
branches;
next	1.6;

1.6
date	2007.06.20.09.29.47;	author jufi;	state Exp;
branches;
next	1.5;

1.5
date	2006.11.22.15.14.07;	author saad;	state Exp;
branches;
next	1.4;

1.4
date	2006.05.29.11.06.11;	author jufi;	state Exp;
branches;
next	1.3;

1.3
date	2005.11.18.20.48.47;	author jufi;	state Exp;
branches;
next	1.2;

1.2
date	2005.05.30.13.52.07;	author saad;	state Exp;
branches;
next	1.1;

1.1
date	2005.01.06.20.03.30;	author jufi;	state Exp;
branches;
next	;


desc
@@


1.20
log
@
Abandon translations, per deraadt@@ and ajacoutot@@.
@
text
@<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<html>
<head>
<title>PF: Atalhos na Criação de Conjuntos de Regras</title>
<link rev="made" href="mailto:www@@openbsd.org">
<meta http-equiv="Content-Type" content="text/html; charset=ISO-8859-1">
<meta name="resource-type" content="document">
<meta name="description"   content="the OpenBSD FAQ page">
<meta name="keywords"      content="openbsd,faq,pf">
<meta name="distribution"  content="global">
</head>

<!--
Copyright (c) 2003, 2004 Joel Knight <enabled@@myrealbox.com>

Permission to use, copy, modify, and distribute this documentation for
any purpose with or without fee is hereby granted, provided that the
above copyright notice and this permission notice appear in all copies.

THE DOCUMENTATION IS PROVIDED "AS IS" AND THE AUTHOR DISCLAIMS ALL
WARRANTIES WITH REGARD TO THIS DOCUMENTATION INCLUDING ALL IMPLIED
WARRANTIES OF MERCHANTABILITY AND FITNESS. IN NO EVENT SHALL THE
AUTHOR BE LIABLE FOR ANY SPECIAL, DIRECT, INDIRECT, OR CONSEQUENTIAL
DAMAGES OR ANY DAMAGES WHATSOEVER RESULTING FROM LOSS OF USE, DATA OR
PROFITS, WHETHER IN AN ACTION OF CONTRACT, NEGLIGENCE OR OTHER
TORTIOUS ACTION, ARISING OUT OF OR IN CONNECTION WITH THE USE OR
PERFORMANCE OF THIS DOCUMENTATION
-->

<body bgcolor="#ffffff" text="#000000">
<!-- Passes validator.w3.org, please keep it this way;
please, use a max of 72 chars per line -->

<a href="../../../pt/index.html">
<img alt="[OpenBSD]" height=30 width=141 src="../../../images/smalltitle.gif" border="0">
</a>
<p>
[<a href="rdr.html">Anterior: Redirecionamento de Tráfego
("Port Forwarding")</a>]
[<a href="index.html">Conteúdo</a>]
[<a href="options.html">Próximo: Opções em Tempo de Execução</a>]

<p>
<h1>
<font color="#e00000">PF: Atalhos na Criação de Conjuntos de Regras</font>
</h1>

<hr>

<h3>Conteúdo</h3>
<ul>
<li><a href="#intro">Introdução</a>
<li><a href="#macros">Uso de Macros</a>
<li><a href="#lists">Uso de Listas</a>
<li><a href="#grammar">Gramática do PF</a>
	<ul>
	<li><a href="#elim">Eliminação de Palavras-chave</a>
	<li><a href="#return">Simplificação de <tt>Return</tt></a>
	<li><a href="#order">Ordenação de Palavras-chave</a>
	</ul>
</ul>

<hr>

<a name="intro"></a>
<h2>Introdução</h2>
O PF oferece várias formas de simplificar conjuntos de regras.
Alguns bons exemplos são através do uso de
<a href="macros.html#macros">macros</a> e
<a href="macros.html#lists">listas</a>.
Além disso, a linguagem do conjunto de regras, ou gramática, também
oferece alguns atalhos para tornar o conjunto de regras mais simples.
Como uma regra geral, quanto mais simples as regras, mais fácil de
entender e mantê-las.

<a name="macros"></a>
<h2>Uso de Macros</h2>
Macros são úteis porque são uma alternativa para se referenciar
endereços, números de portas, nomes de interfaces, etc., em um
conjunto de regras.
O endereço IP de um servidor mudou? Sem problema, apenas atualize a
macro; não é necessário sair alterando regras de filtragem que você
teve tanto trabalho para aperfeiçoar às suas necessidades.

<p>
Um costume comum em conjuntos de regras do PF é definir macros para cada
interface de rede.
Se em um dado momento uma placa de rede precisar ser substituída
por uma com driver diferente (por exemplo, trocar uma 3Com por uma
Intel), a macro pode ser atualizada e as regras de filtragem funcionarão
como antes.
Outro benefício é quando se usa o mesmo conjunto de regras em diferentes
máquinas.
Certas máquinas podem ter placas de rede diferentes, e utilizar macros
para defini-las permite usar o conjunto de regras com o mínimo de
edição.
É prática recomendada usar macros para definir informações sujeitas à
alterações, como números de porta, endereços IP e nomes de interface.
<blockquote>
<tt>
# Define macros para cada interface de rede<br>
IntIF = "dc0"<br>
ExtIF = "fxp0"<br>
DmzIF = "fxp1"
</tt>
</blockquote>

<p>
Outra convenção comum é o uso de macros para definir endereços IP e
blocos de rede. Isso reduz bastante o trabalho de manutenção do
conjunto de regras quando endereços IP são alterados.
<blockquote>
<tt>
# Define nossas redes<br>
IntNet = "192.168.0.0/24"<br>
ExtAdd = "24.65.13.4"<br>
DmzNet = "10.0.0.0/24"
</tt>
</blockquote>

<p>
Caso a rede interna for expandida ou mesmo reconfigurada em outro
bloco de endereçamento IP, a macro pode ser atualizada:
<blockquote>
<tt>
IntNet = "{ 192.168.0.0/24, 192.168.1.0/24 }"
</tt>
</blockquote>

<p>
Uma vez recarregado o conjunto de regras, tudo funcionará como antes.

<a name="lists"></a>
<h2>Uso de Listas</h2>
Vamos dar uma olhada em um bom grupo de regras para você ter no seu
conjunto de regras para lidar com endereços especificados na
<a href="http://www.geektools.com/rfc/rfc1918.txt">RFC 1918</a>,
que simplesmente não podem ficar vagando na Internet, e quando
são encontrados, provavelmente estão tentando causar algum problema:
<blockquote>
<tt>
block in &nbsp;quick on tl0 inet from 127.0.0.0/8 to any<br>
block in &nbsp;quick on tl0 inet from 192.168.0.0/16 to any<br>
block in &nbsp;quick on tl0 inet from 172.16.0.0/12 to any<br>
block in &nbsp;quick on tl0 inet from 10.0.0.0/8 to any<br>
block out quick on tl0 inet from any to 127.0.0.0/8<br>
block out quick on tl0 inet from any to 192.168.0.0/16<br>
block out quick on tl0 inet from any to 172.16.0.0/12<br>
block out quick on tl0 inet from any to 10.0.0.0/8
</tt>
</blockquote>

<p>
Agora veja a simplificação:
<blockquote>
<tt>
block in &nbsp;quick on tl0 inet from { 127.0.0.0/8, 192.168.0.0/16, \<br>
&nbsp;&nbsp;&nbsp;172.16.0.0/12, 10.0.0.0/8 } to any<br>
block out quick on tl0 inet from any to { 127.0.0.0/8, \<br>
&nbsp;&nbsp;&nbsp;192.168.0.0/16, 172.16.0.0/12, 10.0.0.0/8 }
</tt>
</blockquote>

<p>
O conjunto de regras foi reduzido de oito linhas para apenas duas.
Tudo fica melhor ainda quando se usa macros junto com listas:
<blockquote>
<tt>
NoRouteIPs = "{ 127.0.0.0/8, 192.168.0.0/16, 172.16.0.0/12, \<br>
&nbsp;&nbsp;&nbsp;10.0.0.0/8 }"
<br>
ExtIF = "tl0"<br>
block in &nbsp;quick on $ExtIF from $NoRouteIPs to any<br>
block out quick on $ExtIF from any to $NoRouteIPs
</tt>
</blockquote>

<p>
Note que macros e listas simplificam o arquivo <tt>pf.conf</tt>,
mas as linhas são expandidas em múltiplas regras pelo
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=pfctl&amp;sektion=8&amp;manpath=OpenBSD+5.4"
>pfctl(8)</a>. Portanto, o exemplo acima na verdade é expandido para
as seguintes regras:
<blockquote>
<tt>
block in &nbsp;quick on tl0 inet from 127.0.0.0/8 to any<br>
block in &nbsp;quick on tl0 inet from 192.168.0.0/16 to any<br>
block in &nbsp;quick on tl0 inet from 172.16.0.0/12 to any<br>
block in &nbsp;quick on tl0 inet from 10.0.0.0/8 to any<br>
block out quick on tl0 inet from any to 10.0.0.0/8<br>
block out quick on tl0 inet from any to 172.16.0.0/12<br>
block out quick on tl0 inet from any to 192.168.0.0/16<br>
block out quick on tl0 inet from any to 127.0.0.0/8
</tt>
</blockquote>

<p>
Como você pode ver, a expansão do PF é puramente uma conveniência para
quem escreve e mantém o arquivo <tt>pf.conf</tt>, não uma simplificação
das regras processadas pelo
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=pf&amp;sektion=4&amp;manpath=OpenBSD+5.4"
>pf(4)</a>.

<p>
Macros podem ser usadas para definir mais do que endereços e portas;
elas podem ser usadas em qualquer lugar em um arquivo de regras do PF:
<blockquote>
<tt>
pre  = "pass in quick on ep0 inet proto tcp from "<br>
post = "to any port { 80, 6667 }"<br>
<br>
# Sala de aula do David<br>
$pre 21.14.24.80 $post<br>
<br>
# Casa do Nick<br>
$pre 24.2.74.79 $post<br>
$pre 24.2.74.178 $post
</tt>
</blockquote>

<p>
Expande para:
<blockquote>
<tt>
pass in quick on ep0 inet proto tcp from 21.14.24.80 to any \<br>
&nbsp;&nbsp;&nbsp;port = 80<br>
pass in quick on ep0 inet proto tcp from 21.14.24.80 to any \<br>
&nbsp;&nbsp;&nbsp;port = 6667<br>
pass in quick on ep0 inet proto tcp from 24.2.74.79 to any \<br>
&nbsp;&nbsp;&nbsp;port = 80<br>
pass in quick on ep0 inet proto tcp from 24.2.74.79 to any \<br>
&nbsp;&nbsp;&nbsp;port = 6667<br>
pass in quick on ep0 inet proto tcp from 24.2.74.178 to any \<br>
&nbsp;&nbsp;&nbsp;port = 80<br>
pass in quick on ep0 inet proto tcp from 24.2.74.178 to any \<br>
&nbsp;&nbsp;&nbsp;port = 6667
</tt>
</blockquote>

<a name="grammar"></a>
<h2>Gramática do PF</h2>
A gramática do PF é bem flexível, o que permite grande flexibilidade
em um conjunto de regras. O PF pode até mesmo deduzir certas
palavras-chave, o que significa que elas não precisam ser declaradas
explicitamente em uma regra, e a ordenação de palavra-chave é relaxada,
de forma que não se faz necessário memorizar uma sintaxe precisa.

<a name="elim"></a>
<h3>Eliminação de Palavras-chave</h3>
<p>
Para definir uma política "negar por padrão", duas regras são
utilizadas:
<blockquote>
<tt>
block in &nbsp;all<br>
block out all
</tt>
</blockquote>

<p>
Isso pode ser reduzido para:
<blockquote>
<tt>
block
</tt>
</blockquote>

<p>
Quando a direção não é especificada, o PF assume que a regra se aplica
a pacotes se movendo em ambas as direções.

<p>
De maneira similar, as cláusulas "<tt>from any to any</tt>" e
"<tt>all</tt>" podem ser deixadas de lado em uma regra, por exemplo:
<blockquote>
<tt>
block in on rl0 all<br>
pass &nbsp;in quick log on rl0 proto tcp from any to any port 22 keep state
</tt>
</blockquote>

<p>
pode ser simplificada como:
<blockquote>
<tt>
block in on rl0<br>
pass &nbsp;in quick log on rl0 proto tcp to port 22 keep state</tt>
</blockquote>

<p>
A primeira regra bloqueia todo tráfego de entrada de pacotes vindos de
qualquer lugar para qualquer lugar em rl0, e a segunda regra aceita
tráfego TCP com destino a porta 22 em rl0.

<a name="return"></a>
<h3>Simplificação de <tt>Return</tt></h3>
<p>
Um conjunto de regras usado para bloquear pacotes e responder com
um pacote TCP RST ou ICMP de Inalcançável pode ficar assim:
<blockquote>
<tt>
block in all<br>
block return-rst in proto tcp all<br>
block return-icmp in proto udp all<br>
block out all<br>
block return-rst out proto tcp all<br>
block return-icmp out proto udp all
</tt>
</blockquote>

<p>
Ou podem ser simplificadas como:
<blockquote>
<tt>
block return
</tt>
</blockquote>

<p>
Quando o PF encontra a palavra-chave <tt>return</tt>, ele é inteligente
o bastante para enviar a resposta apropriada, ou nenhuma resposta,
dependendo do protocolo do pacote sendo bloqueado.

<a name="order"></a>
<h3>Ordenação de Palavras-chave</h3>
<p>
A ordem em que as palavras-chave são especificadas, na maioria dos
casos, é bem flexível. Por exemplo, uma regra escrita assim:
<blockquote>
<tt>
pass in log quick on rl0 proto tcp to port 22 \<br>
&nbsp;&nbsp;&nbsp;flags S/SA keep state queue ssh label ssh
</tt>
</blockquote>

<p>
Também pode ser escrita assim:
<blockquote>
<tt>
pass in quick log on rl0 proto tcp to port 22 \<br>
&nbsp;&nbsp;&nbsp;queue ssh keep state label ssh flags S/SA
</tt>
</blockquote>

<p>
Variações similares também funcionarão.

<p>
[<a href="rdr.html">Anterior: Redirecionamento de Tráfego
("Port Forwarding")</a>]
[<a href="index.html">Conteúdo</a>]
[<a href="options.html">Próximo: Opções em Tempo de Execução</a>]

<p>
<hr>
<a href="index.html"><img height="24" width="24" src="../../../images/back.gif" border="0" alt="[voltar]"></a>
<a href="mailto:www@@openbsd.org">www@@openbsd.org</a>
<br>
<small>
<!--
Originally [OpenBSD: shortcuts.html,v 1.32 ]<br>
$Translation: shortcuts.html,v 1.19 2013/12/01 12:44:33 egypcio Exp $<br>
-->
$OpenBSD: shortcuts.html,v 1.19 2013/12/06 20:52:46 ajacoutot Exp $
</small>

</body>
</html>
@


1.19
log
@Sync with Steelix CVS
@
text
@d364 1
a364 1
$OpenBSD$
@


1.18
log
@Sync with Steelix CVS
@
text
@d181 1
a181 1
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=pfctl&amp;sektion=8&amp;manpath=OpenBSD+5.3"
d201 1
a201 1
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=pf&amp;sektion=4&amp;manpath=OpenBSD+5.3"
d361 2
a362 2
Originally [OpenBSD: shortcuts.html,v 1.31 ]<br>
$Translation: shortcuts.html,v 1.18 2013/05/02 22:48:46 renato Exp $<br>
@


1.17
log
@Sync with Steelix CVS
@
text
@d181 1
a181 1
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=pfctl&amp;sektion=8&amp;manpath=OpenBSD+5.2"
d201 1
a201 1
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=pf&amp;sektion=4&amp;manpath=OpenBSD+5.2"
d361 2
a362 2
Originally [OpenBSD: shortcuts.html,v 1.30 ]<br>
$Translation: shortcuts.html,v 1.17 2012/11/06 16:57:12 egypcio Exp $<br>
@


1.16
log
@Sync with Steelix CVS
@
text
@d181 1
a181 1
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=pfctl&amp;sektion=8&amp;manpath=OpenBSD+5.1"
d201 1
a201 1
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=pf&amp;sektion=4&amp;manpath=OpenBSD+5.1"
d361 2
a362 2
Originally [OpenBSD: shortcuts.html,v 1.29 ]<br>
$Translation: shortcuts.html,v 1.16 2012/11/01 16:19:57 egypcio Exp $<br>
@


1.15
log
@Sync with Steelix CVS
@
text
@d181 1
a181 1
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=pfctl&amp;sektion=8&amp;manpath=OpenBSD+5.0"
d201 1
a201 1
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=pf&amp;sektion=4&amp;manpath=OpenBSD+5.0"
d361 2
a362 2
Originally [OpenBSD: shortcuts.html,v 1.28 ]<br>
$Translation: shortcuts.html,v 1.15 2012/01/02 16:38:56 renato Exp $<br>
@


1.14
log
@Sync with Steelix CVS
@
text
@d181 1
a181 1
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=pfctl&amp;sektion=8&amp;manpath=OpenBSD+4.9"
d201 1
a201 1
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=pf&amp;sektion=4&amp;manpath=OpenBSD+4.9"
d361 2
a362 2
Originally [OpenBSD: shortcuts.html,v 1.27 ]<br>
$Translation: shortcuts.html,v 1.14 2011/09/21 15:35:09 renato Exp $<br>
@


1.13
log
@Sync with Steelix CVS
@
text
@d181 1
a181 1
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=pfctl&amp;sektion=8&amp;manpath=OpenBSD+4.8"
d201 1
a201 1
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=pf&amp;sektion=4&amp;manpath=OpenBSD+4.8"
d361 2
a362 2
Originally [OpenBSD: shortcuts.html,v 1.26 ]<br>
$Translation: shortcuts.html,v 1.13 2010/11/24 16:29:16 renato Exp $<br>
@


1.12
log
@Sync with Steelix CVS
@
text
@d181 1
a181 1
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=pfctl&amp;sektion=8&amp;manpath=OpenBSD+4.7"
d201 1
a201 1
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=pf&amp;sektion=4&amp;manpath=OpenBSD+4.7"
d361 2
a362 2
Originally [OpenBSD: shortcuts.html,v 1.25 ]<br>
$Translation: shortcuts.html,v 1.12 2010/09/24 21:12:00 renato Exp $<br>
@


1.11
log
@Sync with Steelix CVS
@
text
@d181 1
a181 1
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=pfctl&amp;sektion=8&amp;manpath=OpenBSD+4.6"
d201 1
a201 1
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=pf&amp;sektion=4&amp;manpath=OpenBSD+4.6"
d210 1
a210 1
post = "to any port { 80, 6667 } keep state"<br>
d226 1
a226 1
&nbsp;&nbsp;&nbsp;port = 80 keep state<br>
d228 1
a228 1
&nbsp;&nbsp;&nbsp;port = 6667 keep state<br>
d230 1
a230 1
&nbsp;&nbsp;&nbsp;port = 80 keep state<br>
d232 1
a232 1
&nbsp;&nbsp;&nbsp;port = 6667 keep state<br>
d234 1
a234 1
&nbsp;&nbsp;&nbsp;port = 80 keep state<br>
d236 1
a236 1
&nbsp;&nbsp;&nbsp;port = 6667 keep state
d264 1
a264 1
block all
d361 2
a362 2
Originally [OpenBSD: shortcuts.html,v 1.24 ]<br>
$Translation: shortcuts.html,v 1.11 2009/10/18 16:52:52 alan Exp $<br>
@


1.10
log
@Sync with Steelix CVS
@
text
@d181 1
a181 1
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=pfctl&amp;sektion=8&amp;manpath=OpenBSD+4.5"
d201 1
a201 1
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=pf&amp;sektion=4&amp;manpath=OpenBSD+4.5"
d361 2
a362 2
Originally [OpenBSD: shortcuts.html,v 1.23 ]<br>
$Translation: shortcuts.html,v 1.10 2009/10/13 19:12:28 alan Exp $<br>
@


1.9
log
@Sync with Steelix CVS
@
text
@d4 1
a4 1
<title>PF: Atalhos na Criação de Regras</title>
d45 1
a45 1
<font color="#e00000">PF: Atalhos na Criação de Regras</font>
d53 2
a54 2
<li><a href="#macros">Usando Macros</a>
<li><a href="#lists">Usando Listas</a>
d57 1
a57 1
	<li><a href="#elim">Eliminação de Palavras-Chave</a>
d59 1
a59 1
	<li><a href="#order">Ordenação de Palavras</a>
d67 2
a68 2
O PF oferece várias formas de simplificar regras. Alguns bons exemplos
são através do uso de
d71 4
a74 3
Além disso, a linguagem das regras, ou gramática, também oferece alguns
atalhos para tornar as regras mais simples.  Como uma regra geral,
quanto mais simples as regras, mais fácil de entender e manter.
d77 1
a77 1
<h2>Usando Macros</h2>
d79 2
a80 1
endereços, números de portas, nomes de interfaces, etc., em uma regra.
d86 7
a92 5
Um costume comum em regras PF é definir macros para cada interface de
rede. Se em um dado momento uma placa de rede precisar ser substituída
por uma com driver diferente, por exemplo trocar uma 3Com por uma Intel,
a macro pode ser atualizada e as regras de filtragem funcionarão como
antes. Outro benefício é quando se usa as mesmas regras em diferentes
d95 3
a97 2
para definí-las permite usar as regras com o mínimo de edição. É
prática recomendada usar macros para definir informações sujeitas à
d110 2
a111 2
blocos de rede. Isso reduz bastante o trabalho de manutenção de regras
quando endereços IP são alterados.
d131 1
a131 1
Uma vez recarregadas as regras, tudo funcionará como antes.
d134 3
a136 2
<h2>Usando Listas</h2>
Vejamos algumas regras para lidar com endereços especificados na
d165 1
a165 1
As regras foram reduzidas de oito linhas para apenas duas.
d198 1
a198 1
Como pode ver, a expansão do PF é puramente uma conveniência para
d206 1
a206 1
elas podem ser usadas em qualquer lugar num arquivo de regras PF:
d243 4
a246 4
na construção de regras. O PF pode até mesmo deduzir certas palavras,
o que significa que elas não precisam ser declaradas explicitamente
numa regra, e a ordem de construção é relaxada, de forma que não se
faz necessário memorizar uma sintaxe precisa.
d249 1
a249 1
<h3>Eliminação de Palavras-Chave</h3>
d270 1
a270 1
à pacotes se movendo em ambas as direções.
d274 1
a274 1
"<tt>all</tt>" podem ser deixadas de lado numa regra, por exemplo:
d291 2
a292 2
A primeira regra bloqueia todo tráfego entrante de pacotes vindos de
qualquer lugar em rl0 para qualquer lugar, e a segunda regra aceita
d298 2
a299 2
Regras usadas para bloquear pacotes e responder com TCP
RST ou ICMP Unreachable podem ficar assim:
d320 2
a321 2
Quando o PF encontra a palavra <tt>return</tt>, ele é inteligente o
bastante para enviar a resposta apropriada, ou nenhuma resposta,
d325 1
a325 1
<h3>Ordenação de Palavras</h3>
d362 1
a362 1
$Translation: shortcuts.html,v 1.9 2009/05/10 17:44:16 alan Exp $<br>
@


1.8
log
@Sync with Steelix CVS
@
text
@d96 1
a96 1
# define macros para cada interface de rede<br>
d175 1
a175 1
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=pfctl&amp;sektion=8&amp;manpath=OpenBSD+4.4"
d195 1
a195 1
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=pf&amp;sektion=4&amp;manpath=OpenBSD+4.4"
d355 2
a356 2
Originally [OpenBSD: shortcuts.html,v 1.22 ]<br>
$Translation: shortcuts.html,v 1.8 2009/03/11 00:52:57 dsantos Exp $<br>
@


1.7
log
@Sync with Steelix CVS
@
text
@d4 1
a4 1
<title>PF: Atalhos na Cria&ccedil;&atilde;o de Regras</title>
d8 3
a10 3
<meta name="description" content="the OpenBSD FAQ page">
<meta name="keywords" content="openbsd,faq,pf">
<meta name="distribution" content="global">
d38 4
a41 3
[<a href="rdr.html">Anterior: Redirecionamento de Tr&aacute;fego (Port Forwarding)</a>]
[<a href="index.html">Conte&uacute;do</a>]
[<a href="options.html">Pr&oacute;ximo: Op&ccedil;&otilde;es em Tempo de Execu&ccedil;&atilde;o</a>]
d45 1
a45 1
<font color="#e00000">PF: Atalhos na Cria&ccedil;&atilde;o de Regras</font>
d50 1
a50 1
<h3>Conte&uacute;do</h3>
d52 1
a52 1
<li><a href="#intro">Introdu&ccedil;&atilde;o</a>
d55 1
a55 1
<li><a href="#grammar">Gram&aacute;tica do PF</a>
d57 3
a59 3
	<li><a href="#elim">Elimina&ccedil;&atilde;o de Palavras-Chave</a>
	<li><a href="#return">Simplifica&ccedil;&atilde;o de <tt>Return</tt></a>
	<li><a href="#order">Ordena&ccedil;&atilde;o de Palavras</a>
d66 3
a68 3
<h2>Introdu&ccedil;&atilde;o</h2>
O PF oferece v&aacute;rias formas de simplificar regras. Alguns bons 
exemplos s&atilde;o atrav&eacute;s do uso de
d71 3
a73 3
Al&eacute;m disso, a linguagem das regras, ou gram&aacute;tica, tamb&eacute;m oferece 
alguns atalhos para tornar as regras mais simples.  Como uma regra geral, quanto 
mais simples as regras, mais f&aacute;cil entender e manter.
d77 17
a93 16
Macros s&atilde;o &uacute;teis porque s&atilde;o uma alternativa para se referenciar 
endere&ccedil;os, n&uacute;meros de portas, nomes de interfaces, etc, em uma regra. 
O endere&ccedil;o IP de um servidor mudou? Sem problema, apenas atualize a macro; 
n&atilde;o &eacute; necess&aacute;rio sair alterando regras de filtragem que voc&ecirc; teve 
tanto trabalho para aperfei&ccedil;oar as suas necessidades.

<p>
Um costume comum em regras PF &eacute; definir macros para cada interface de
rede. Se em dado momento uma placa de rede precisar ser substitu&iacute;da
por uma com driver diferente, por exemplo trocar uma 3Com por uma Intel, 
a macro pode ser atualizada e as regras de filtragem funcionar&atilde;o como antes.
Outro benef&iacute;cio &eacute; quando se usa as mesmas regras em diferentes m&aacute;quinas. 
Certas m&aacute;quinas podem ter placas de rede diferentes, e utilizar macros 
para defini-las permite usar as regras com o m&iacute;nimo de edi&ccedil;&atilde;o. &Eacute; 
pr&aacute;tica recomendada usar macros para definir informa&ccedil;&otilde;es sujeitas a 
altera&ccedil;&atilde;o como n&uacute;meros de porta, endere&ccedil;os IP e nomes de interface.
d104 3
a106 3
Outra conven&ccedil;&atilde;o comum &eacute; o uso de macros para definir endere&ccedil;os IP e 
blocos de rede. Isso reduz bastante o trabalho de manuten&ccedil;&atilde;o de regras quando 
endere&ccedil;os IP s&atilde;o alterados.
d109 1
a109 1
# define nossas redes<br>
d117 2
a118 2
Caso a rede interna for expandida ou mesmo reconfigurada em outro 
bloco de endere&ccedil;amento IP, a macro pode ser atualizada:
d126 1
a126 1
Uma vez recarregadas as regras, tudo funcionar&aacute; como antes.
d130 1
a130 1
Vejamos algumas regras para lidar com endere&ccedil;os especificados na 
d132 2
a133 3
que simplesmente n&atilde;o podem ficar vagando na Internet, e quando
s&atilde;o encontrados, provavelmente est&atilde;o tentando causar algum 
problema:
d148 1
a148 1
Agora veja a simplifica&ccedil;&atilde;o:
d173 5
a177 5
Note que macros e listas simplificam o arquivo 
<tt>pf.conf</tt>, mas as linhas s&atilde;o expandidas em m&uacute;ltiplas regras pelo 
<a
href="http://www.openbsd.org/cgi-bin/man.cgi?query=pfctl&amp;sektion=8&amp;manpath=OpenBSD+4.2"
>pfctl(8)</a>.  Portanto, o exemplo acima &eacute; expandido na verdade para as seguintes regras:
d192 4
a195 5
Como pode ver, a expans&atilde;o do PF &eacute; puramente uma conveni&ecirc;ncia para 
quem escreve e mant&eacute;m o arquivo <tt>pf.conf</tt>, n&atilde;o uma simplifica&ccedil;&atilde;o 
das regras processadas pelo 
<a
href="http://www.openbsd.org/cgi-bin/man.cgi?query=pf&amp;sektion=4&amp;manpath=OpenBSD+4.2"
d199 2
a200 2
Macros podem ser usadas para definir mais do que endere&ccedil;os e portas; elas podem 
ser usadas em qualquer lugar num arquivo de regras PF:
d206 1
a206 1
# Classe do David<br>
d235 6
a240 6
<h2>Gram&aacute;tica do PF</h2>
A gram&aacute;tica do PF &eacute; bem flex&iacute;vel, o que permite grande flexibilidade 
na constru&ccedil;&atilde;o de regras. PF pode at&eacute; mesmo deduzir certas palavras,
o que significa que elas n&atilde;o precisam ser declaradas explicitamente 
numa regra, e a ordem de constru&ccedil;&atilde;o &eacute; relaxada, de forma que n&atilde;o se 
faz necess&aacute;rio memorizar uma sintaxe precisa.
d243 1
a243 1
<h3>Elimina&ccedil;&atilde;o de Palavras-Chave</h3>
d245 2
a246 1
Para definir uma pol&iacute;tica "negar por padr&atilde;o", duas regras s&atilde;o utilizadas:
d263 2
a264 2
Quando a dire&ccedil;&atilde;o n&atilde;o &eacute; especificada, PF assume que a regra se aplica a
pacotes movendo em ambas as dire&ccedil;&otilde;es.
d267 2
a268 2
De maneira similar, as cl&aacute;usulas "<tt>from any to any</tt>" e "<tt>all</tt>" 
podem ser deixadas de lado numa regra, por exemplo:
d285 3
a287 3
A primeira regra bloqueia todo tr&aacute;fego entrante de pacotes vindos de 
qualquer lugar em rl0 para qualquer lugar, e a segunda regra aceita 
tr&aacute;fego TCP com destino &agrave; porta 22 em rl0.
d290 1
a290 1
<h3>Simplifica&ccedil;&atilde;o de <tt>Return</tt></h3>
d292 1
a292 1
Regras usadas para bloquear pacotes e responder com TCP 
d314 2
a315 2
Quando PF encontra a palavra <tt>return</tt>, ele &eacute; inteligente o 
bastante para enviar a resposta apropriada, ou nenhuma resposta, 
d319 1
a319 1
<h3>Ordena&ccedil;&atilde;o de Palavras</h3>
d321 2
a322 2
A ordem em que as palavras-chave s&atilde;o especificadas na maioria 
dos casos &eacute; bem flex&iacute;vel. Por exemplo, uma regra escrita assim:
d325 1
a325 1
pass in log quick on rl0 proto tcp to port 22 \<br> 
d331 1
a331 1
Tamb&eacute;m pode ser escrita assim:
d340 1
a340 1
Varia&ccedil;&otilde;es similares tamb&eacute;m funcionar&atilde;o.
d343 4
a346 3
[<a href="rdr.html">Anterior: Redirecionamento de Tr&aacute;fego (Port Forwarding)</a>]
[<a href="index.html">Conte&uacute;do</a>]
[<a href="options.html">Pr&oacute;ximo: Op&ccedil;&otilde;es em Tempo de Execu&ccedil;&atilde;o</a>]
d350 1
a350 1
<a href="index.html"><img height="24" width="24" src="../../../images/back.gif" border="0" alt="[back]"></a>
d355 2
a356 2
Originally [OpenBSD: shortcuts.html,v 1.20 ]<br>
$Translation: shortcuts.html,v 1.7 2007/11/24 18:12:32 dsantos Exp $<br>
d358 1
a358 1
$OpenBSD$ 
@


1.6
log
@Sync with steelix translation CVS
@
text
@d124 1
a124 1
Uma vez recarregas as regras, tudo funcionar&aacute; como antes.
d175 1
a175 1
href="http://www.openbsd.org/cgi-bin/man.cgi?query=pfctl&amp;sektion=8&amp;manpath=OpenBSD+4.1"
d195 1
a195 1
href="http://www.openbsd.org/cgi-bin/man.cgi?query=pf&amp;sektion=4&amp;manpath=OpenBSD+4.1"
d353 2
a354 2
Originally [OpenBSD: shortcuts.html,v 1.19 ]<br>
$Translation: shortcuts.html,v 1.6 2007/06/18 22:09:39 dsantos Exp $<br>
@


1.5
log
@sync with Steelix CVS
@
text
@d175 1
a175 1
href="http://www.openbsd.org/cgi-bin/man.cgi?query=pfctl&amp;sektion=8&amp;manpath=OpenBSD+4.0"
d195 1
a195 1
href="http://www.openbsd.org/cgi-bin/man.cgi?query=pf&amp;sektion=4&amp;manpath=OpenBSD+4.0"
d353 2
a354 2
Originally [OpenBSD: shortcuts.html,v 1.18 ]<br>
$Translation: shortcuts.html,v 1.5 2006/11/21 01:54:24 dsantos Exp $<br>
@


1.4
log
@sync with steelix translation CVS
@
text
@d175 1
a175 1
href="http://www.openbsd.org/cgi-bin/man.cgi?query=pfctl&amp;sektion=8&amp;manpath=OpenBSD+3.9"
d195 1
a195 1
href="http://www.openbsd.org/cgi-bin/man.cgi?query=pf&amp;sektion=4&amp;manpath=OpenBSD+3.9"
d353 2
a354 2
Originally [OpenBSD: shortcuts.html,v 1.17 ]<br>
$Translation: shortcuts.html,v 1.4 2006/05/28 17:23:03 dsantos Exp $<br>
@


1.3
log
@sync with steelix translation CVS
@
text
@d175 1
a175 1
href="http://www.openbsd.org/cgi-bin/man.cgi?query=pfctl&amp;sektion=8&amp;manpath=OpenBSD+3.8"
d195 1
a195 1
href="http://www.openbsd.org/cgi-bin/man.cgi?query=pf&amp;sektion=4&amp;manpath=OpenBSD+3.8"
d353 2
a354 2
Originally [OpenBSD: shortcuts.html,v 1.16 ]<br>
$Translation: shortcuts.html,v 1.3 2005/11/15 14:36:42 dsantos Exp $<br>
@


1.2
log
@sync with Steelix CVS
@
text
@d174 2
a175 1
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=pfctl&amp;sektion=8&amp;manpath=OpenBSD+3.7"
d194 2
a195 1
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=pf&amp;sektion=4&amp;manpath=OpenBSD+3.7"
d352 4
a355 2
Originally [OpenBSD: shortcuts.html,v 1.15 ]<br>
$Translation: shortcuts.html,v 1.2 2005/05/27 15:11:33 dsantos Exp $<br>
@


1.1
log
@sync with steelix translation CVS
@
text
@d174 1
a174 1
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=pfctl&amp;sektion=8&amp;manpath=OpenBSD+3.6"
d193 1
a193 1
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=pf&amp;sektion=4&amp;manpath=OpenBSD+3.6"
d350 2
a351 2
Originally [OpenBSD: shortcuts.html,v 1.14 ]<br> 
$Translation: shortcuts.html,v 1.1 2005/01/04 17:09:07 dsantos Exp $<br>                 
@

