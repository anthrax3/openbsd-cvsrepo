head	1.34;
access;
symbols;
locks; strict;
comment	@# @;


1.34
date	2014.04.01.17.14.11;	author nick;	state dead;
branches;
next	1.33;

1.33
date	2013.11.02.14.03.43;	author ajacoutot;	state Exp;
branches;
next	1.32;

1.32
date	2013.05.02.06.05.50;	author ajacoutot;	state Exp;
branches;
next	1.31;

1.31
date	2012.11.02.11.41.14;	author ajacoutot;	state Exp;
branches;
next	1.30;

1.30
date	2012.10.05.15.42.58;	author ajacoutot;	state Exp;
branches;
next	1.29;

1.29
date	2012.08.21.19.23.27;	author ajacoutot;	state Exp;
branches;
next	1.28;

1.28
date	2012.05.13.16.30.19;	author ajacoutot;	state Exp;
branches;
next	1.27;

1.27
date	2011.11.03.06.54.03;	author ajacoutot;	state Exp;
branches;
next	1.26;

1.26
date	2011.11.03.06.53.11;	author ajacoutot;	state Exp;
branches;
next	1.25;

1.25
date	2011.11.01.22.59.12;	author ajacoutot;	state Exp;
branches;
next	1.24;

1.24
date	2011.05.01.19.01.24;	author ajacoutot;	state Exp;
branches;
next	1.23;

1.23
date	2010.11.03.19.50.18;	author ajacoutot;	state Exp;
branches;
next	1.22;

1.22
date	2010.07.27.04.49.26;	author ajacoutot;	state Exp;
branches;
next	1.21;

1.21
date	2010.05.27.10.00.59;	author ajacoutot;	state Exp;
branches;
next	1.20;

1.20
date	2010.05.23.16.20.42;	author ajacoutot;	state Exp;
branches;
next	1.19;

1.19
date	2010.03.29.07.15.38;	author ajacoutot;	state Exp;
branches;
next	1.18;

1.18
date	2009.10.19.09.39.58;	author ajacoutot;	state Exp;
branches;
next	1.17;

1.17
date	2009.05.02.17.33.49;	author tobias;	state Exp;
branches;
next	1.16;

1.16
date	2009.02.22.20.35.21;	author tobias;	state Exp;
branches;
next	1.15;

1.15
date	2008.12.13.11.02.10;	author tobias;	state Exp;
branches;
next	1.14;

1.14
date	2007.12.30.14.59.18;	author tobias;	state Exp;
branches;
next	1.13;

1.13
date	2007.11.19.10.43.15;	author tobias;	state Exp;
branches;
next	1.12;

1.12
date	2007.05.10.12.43.46;	author saad;	state Exp;
branches;
next	1.11;

1.11
date	2006.11.04.17.38.45;	author saad;	state Exp;
branches;
next	1.10;

1.10
date	2006.10.31.07.48.52;	author jufi;	state Exp;
branches;
next	1.9;

1.9
date	2006.07.06.15.41.58;	author saad;	state Exp;
branches;
next	1.8;

1.8
date	2006.05.10.09.02.25;	author jufi;	state Exp;
branches;
next	1.7;

1.7
date	2006.05.03.14.48.29;	author saad;	state Exp;
branches;
next	1.6;

1.6
date	2006.05.01.12.19.18;	author jufi;	state Exp;
branches;
next	1.5;

1.5
date	2006.01.02.06.51.10;	author saad;	state Exp;
branches;
next	1.4;

1.4
date	2005.11.01.19.05.41;	author jufi;	state Exp;
branches;
next	1.3;

1.3
date	2005.07.03.07.28.33;	author saad;	state Exp;
branches;
next	1.2;

1.2
date	2005.05.22.17.38.07;	author saad;	state Exp;
branches;
next	1.1;

1.1
date	2005.03.09.19.27.55;	author jufi;	state Exp;
branches;
next	;


desc
@@


1.34
log
@
Abandon translations, per deraadt@@ and ajacoutot@@.
@
text
@<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<html>
<head>
<title>PF: Voorbeeld: Firewall voor Thuis of Klein Kantoor</title>
<link rev="made" href="mailto:www@@openbsd.org">
<meta http-equiv="Content-Type" content="text/html; charset=ISO-8859-1">
<meta name="resource-type" content="document">
<meta name="description"   content="the OpenBSD FAQ page">
<meta name="keywords"      content="openbsd,faq,pf">
<meta name="distribution"  content="global">
</head>

<!--
Copyright (c) 2003, 2004 Joel Knight <enabled@@myrealbox.com>

Permission to use, copy, modify, and distribute this documentation for
any purpose with or without fee is hereby granted, provided that the
above copyright notice and this permission notice appear in all copies.

THE DOCUMENTATION IS PROVIDED "AS IS" AND THE AUTHOR DISCLAIMS ALL
WARRANTIES WITH REGARD TO THIS DOCUMENTATION INCLUDING ALL IMPLIED
WARRANTIES OF MERCHANTABILITY AND FITNESS. IN NO EVENT SHALL THE
AUTHOR BE LIABLE FOR ANY SPECIAL, DIRECT, INDIRECT, OR CONSEQUENTIAL
DAMAGES OR ANY DAMAGES WHATSOEVER RESULTING FROM LOSS OF USE, DATA OR
PROFITS, WHETHER IN AN ACTION OF CONTRACT, NEGLIGENCE OR OTHER
TORTIOUS ACTION, ARISING OUT OF OR IN CONNECTION WITH THE USE OR
PERFORMANCE OF THIS DOCUMENTATION
-->

<body bgcolor="#ffffff" text="#000000">
<!-- Passes validator.w3.org, please keep it this way;
please, use a max of 72 chars per line -->

<a href="../../../nl/index.html">
<img alt="[OpenBSD]" height=30 width=141 src="../../../images/smalltitle.gif" border="0">
</a>
<p>
[<a href="carp.html">Vorige: Firewall Redundantie met CARP en pfsync</a>]
[<a href="index.html">Inhoud</a>]

<p>
<h1><font color="#e00000">PF: Voorbeeld: Firewall voor Thuis of Klein
Kantoor</font></h1>
<hr>

<h3>Inhoudsopgave</h3>
<ul>
<li><a href="#scenario">Het Scenario</a>
	<ul>
	<li><a href="#network">Het Netwerk</a>
	<li><a href="#objective">De Doelstelling</a>
	<li><a href="#prep">Voorbereiding</a>
	</ul>
<li><a href="#ruleset">De Regelset</a>
	<ul>
	<li><a href="#macros">Macro's</a>
	<li><a href="#options">Opties</a>
	<li><a href="#rules">Filterregels</a>
	</ul>
<li><a href="#allrules">De Volledige Regelset</a>
</ul>

<hr>

<a name="scenario"></a>
<h2>Het Scenario</h2>
In dit voorbeeld draait PF op een OpenBSD machine die fungeert als
firewall en NAT gateway voor een klein netwerk in een huis of kantoor. De
globale doelstelling is om Internettoegang aan te bieden aan het netwerk
en beperkte toegang tot de firewall machine vanaf het Internet, en een
interne webserver aan het externe Internet bloot te stellen. Dit
document zal een volledige regelset overlopen die precies dat doet.

<a name="network"></a>
<h3>Het Netwerk</h3>
Het netwerk is als volgt opgebouwd:

<pre>
    
  [ COMP1 ]    [ COMP3 ]
      |            |
   ---+------+-----+------- xl0 [ OpenBSD ] fxp0 -------- ( Internet )
             |
         [ COMP2 ]

</pre>

<p>
Er zijn een aantal computers in het interne netwerk; het diagramma toont
er drie maar het werkelijke aantal is irrelevant. Deze computers zijn
gewone werkstations die gebruikt worden voor web surfen, e-mail,
chatten, enz., behalve COMP3 die ook een kleine webserver draait.
Het interne netwerk gebruikt het 192.168.0.0 / 255.255.255.0 netwerkblok.

<p>
De OpenBSD firewall is een Celeron 300 met twee netwerkkaarten: een 3com
3c509B (<tt>xl0</tt>) en een Intel EtherExpress Pro/100 (<tt>fxp0</tt>).
De firewall heeft een kabelverbinding naar het Internet en gebruikt NAT om
deze verbinding te delen met het interne netwerk. Het IP adres op de externe
interface wordt dynamisch toegekend door de Internet Service Provider.

<a name="objective"></a>
<h3>De Doelstelling</h3>
De doelstellingen zijn:
<ul>
<li>Bied onbeperkte Internet toegang aan elke interne computer.
<li>Gebruik een "standaard weigeren" filterregelset.
<li>Laat het volgende binnenkomende verkeer toe naar de firewall vanaf het
Internet:
	<ul>
	<li>SSH (TCP poort 22): dit zal gebruikt worden voor extern onderhoud
	van de firewall machine.
	<li>Auth/Ident (TCP poort 113): gebruikt door bepaalde diensten zoals
	SMTP en IRC.
	<li>ICMP Echo Requests: het ICMP pakket-type gebruikt door
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=ping&amp;sektion=8"
>ping(8)</a>.
	</ul>
<li>Leid TCP poort 80 verbindingspogingen (die pogingen zijn om een webserver
te benaderen) om naar computer COMP3.
Laat ook TCP poort 80 verkeer dat bestemd is voor COMP3, toe doorheen de
firewall.
<li>Log filterstatistieken op de externe interface.
<li>Antwoord standaard met een TCP RST of ICMP Unreachable voor geblokkeerde
pakketten.
<li>Maak de regelset zo eenvoudig en gemakkelijk mogelijk om te onderhouden.
</ul>

<a name="prep"></a>
<h3>Voorbereiding</h3>
Dit document veronderstelt dat de OpenBSD host netjes geconfigureerd is om
als router te fungeren, inclusief het verifiëren van de IP netwerksetup,
Internet-connectiviteit, en het instellen van de
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=sysctl&amp;sektion=3"
>sysctl(3)</a> variabelen <tt>net.inet.ip.forwarding</tt> en/of
<tt>net.inet6.ip6.forwarding</tt> op "<tt>1</tt>".
U moet ook PF ingeschakeld hebben met
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=pfctl&amp;sektion=8&amp;manpath=OpenBSD+5.4"
>pfctl(8)</a> of door de overeenkomstige variabele in te stellen in
<tt>/etc/rc.conf.local</tt>.
PF staat standaard aan bij OpenBSD 4.6 en nieuwere versies.

<a name="ruleset"></a>
<h2>De Regelset</h2>
Het volgende zal doorheen een regelset stappen die de bovenstaande
doelstellingen vervult.

<a name="macros"></a>
<h3>Macro's</h3>
De volgende macro's worden gedefinieerd om onderhoud en het lezen van
de regelset gemakkelijker te maken:
<blockquote><pre>
int_if="xl0"

tcp_services="{ 22, 113 }"
icmp_types="echoreq"

comp3="192.168.0.3"
</pre></blockquote>

<p>
De eerste regel definiëert de interne netwerkinterface waarop filtering zal
gebeuren.
Door deze hier te definiëren, kunnen we als we dit systeem moeten verplaatsen
naar een systeem met andere hardware, alleen die regel veranderen
en zal de rest van de regelset nog steeds bruikbaar zijn.
(In dit voorbeeld zal de externe interface worden behandeld door de
<tt>egress</tt> interface groep.
Deze wordt automatisch ingesteld op iedere interface die een default
route heeft, in dit geval fxp0.)
De tweede en derde regel sommen de TCP poortnummers op van de
diensten die geopend zullen worden voor het Internet (SSH en ident/auth) en
de ICMP pakket-types die zullen doorgelaten worden op de firewall machine.
Tenslotte definieert de laatste lijn het IP adres van COMP3.

<p>
<b>Opmerking</b>: Als de Internetverbinding
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=pppoe&amp;sektion=4"
>PPPoE</a> vereiste, dan zou filtering en NAT moeten plaatsvinden op de
<tt>pppoe0</tt> interface en <i>niet</i> op de egress interface
(<tt>fxp0</tt>).

<a name="options"></a>
<h3>Opties</h3>
De volgende twee opties zullen het standaard antwoord instellen voor
<tt>block</tt> filterregels en het loggen van statistieken inschakelen
voor de externe interface:
<blockquote><pre>
set block-policy return
set loginterface egress
</pre></blockquote>

<p>
Elk Unix systeem heeft een "loopback" interface.
Dit is een virtuele netwerkinterface die door toepassingen gebruikt worden
om binnen het systeem met elkaar te communiceren.
Op OpenBSD is de loopback interface
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=lo&amp;sektion=4"
>lo(4)</a>.
Het wordt als de beste gewoonte beschouwd om al het filteren op loopback
interfaces uit te schakelen.
Met <a href="options.html#skip">set skip</a> zullen we dat tot stand brengen.
<blockquote><pre>
set skip on lo
</pre></blockquote>
<!-- XXX this should be interface groups, but PF (at least up to
4.8) just does a substring match on the interface name -->
Merk op dat we hier alle <tt>lo</tt> interfaces overslaan,
hierdoor hoeven we ons later, mochten we bijkomende loopback interfaces
toevoegen, geen zorgen te maken over het wijzigen van dit gedeelte van ons
bestaande regelsbestand.

<a name="rules"></a>
<h3>Firewall Regels</h3>

We beginnen met regels om het gebruik van
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=ftp-proxy&amp;sektion=8&amp;manpath=OpenBSD+5.4"
>ftp-proxy(8)</a> te ondersteunen zodat FTP-clients op het lokale netwerk
FTP-servers op internet kunnen bereiken.
Dit functioneert door het dynamisch invoegen van regels wanneer een
ftp-verbinding wordt gemaakt.
Dit wordt gedaan met behulp van een <a href="anchors.html">anker</a>:
<blockquote><pre>
anchor "ftp-proxy/*"
</pre></blockquote>

<p>
Nu voegen we de regel toe die nodig is om FTP-verbindingen om te leiden
zodat ze worden gezien door ftp-proxy(8):
<blockquote><pre>
pass in quick on $int_if inet proto tcp to any port ftp \
    divert-to 127.0.0.1 port 8021
</pre></blockquote>

<p>
Deze regel onderschept FTP-verbindingen naar poort 21 en leidt ze om naar
ftp-proxy(8) die draait op poort 8021 en, door het gebruik van het
<tt>quick</tt> keyword, zullen packets die matchen niet verder worden
gecontroleerd door de volgende regels van de regelset.
Indien gebruikers regelmatig verbinding maken naar FTP-servers op
andere poorten, dan zou een lijst gebruikt moeten worden om de doel-poort
aan te geven, bijvoorbeeld:
<tt>to any port { 21, 2121 }</tt>.

<p>
Merk op dat zowel de <a href="anchors.html">anker</a> als de
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=ftp-proxy&amp;sektion=8&amp;manpath=OpenBSD+5.4"
>ftp-proxy(8)</a> omleidingsregel voor alle <tt>match</tt> regels voor NAT
moeten staan, anders werkt ftp-proxy(8) niet zoals u verwacht.

<p>
Nu gaan we verder met enkele <tt>match</tt> regels.
Op zichzelf bepaalt een <tt>match</tt> regel niet of een packet mag worden
doorgelaten of niet.
In plaats daarvan, zullen voor de packets die overeenkomen met deze regel de
paramaters worden onthouden; deze worden vervolgens gebruikt in iedere
<tt>pass</tt> regel die dit packet behandelt.

<p>
Dit is krachtig: parameters zoals <a href="nat.html">NAT</a> of
<a href="queueing.html">queueing</a> kunnen worden toegepast op bepaalde
klasses van packets en vervolgens kunnen de toegangsrechten apart
gedefinieerd worden.

<p>
Om NAT uit te voeren voor het volledige interne netwerk wordt de volgende
<tt>match</tt> regel gebruikt:
<blockquote><pre>
match out on egress inet from !(egress:network) to any nat-to (egress:0)
</pre></blockquote>

<p>
In dit geval zou "<tt>!(egress:network)</tt>" eenvoudig vervangen kunnen
worden door "<tt>$int_if:network</tt>", naar indien u meerdere interne
interfaces zou toevoegen, zou u meerdere NAT-regels moeten toevoegen,
terwijl met deze constructie NAT wordt uitgevoerd voor alle beschermde
interfaces.

<p>
Aangezien het IP adres op de externe interface dynamisch toegekend wordt,
worden er haakjes gezet rond de vertalingsinterface zodat PF zal merken
wanneer het adres verandert.
De toevoeging :0 wordt gebruikt zodat alleen het eerste adres wordt
gebruikt voor de vertaling, mocht de externe interface meerdere adressen
hebben.

<p>
Tenslotte wordt de protocolfamilie <tt>inet</tt> (IPv4) opgegeven.
Dit voorkomt het vertalen van <tt>inet6</tt> (IPv6) packets die mogelijk
worden ontvangen.

<p>
Nu de regels die de toegang bepalen.
Start met het standaard niet toestaan:
<blockquote><pre>
block in log
</pre></blockquote>

<p>
Op dit ogenblik zal alle verkeer dat op een interface probeert binnen te
komen, geblokkeerd worden, zelfs dat van het interne netwerk.
Deze packets worden tevens gelogd.
Volgende regels zullen de firewall openen volgens de
bovenstaande doelstellingen en ook alle benodigde virtuele interfaces
openen.

<p>
Hou in het achterhoofd dat pf verkeer kan blokkeren dat binnenkomt of
buitengaat op een interface.
Het kan uw leven vereenvoudigen als u ervoor kiest om verkeer in één
richting te filteren, veeleer dan te proberen het overeind te houden wanneer
u bepaalde dingen inwaarts filtert, en andere dingen uitwaarts.
In ons geval zullen we verkiezen om inwaarts verkeer te filteren, maar
zodra het verkeer toegelaten wordt in een interface, zullen we niet
proberen het te blokkeren als het weer naar buiten gaat, dus we zullen
het volgende doen:
<blockquote><pre>
pass out quick
</pre></blockquote>

Door <tt>quick</tt> te gebruiken wordt voorkomen dat packets worden
gecontroleerd door de volgende regels, wat de prestaties verbetert.

<p>
Het is goed om de <a href="filter.html#antispoof">spoofed address
protection</a> te gebruiken:
<blockquote><pre>
antispoof quick for { lo $int_if }
</pre></blockquote>

<p>
Open nu de poorten gebruikt door die netwerkdiensten die beschikbaar zullen
zijn voor het Internet.
Eerst het verkeer dat bestemd is voor de firewall zelf:
<blockquote><pre>
pass in on egress inet proto tcp from any to (egress) \
    port $tcp_services
</pre></blockquote>

<p>
Het specificeren van de netwerkpoorten in de macro <tt>$tcp_services</tt>
maakt het eenvoudig om bijkomende diensten te openen voor het Internet door
eenvoudigweg de macro te bewerken en de regelset te herladen. UDP diensten
kunnen ook geopend worden door een <tt>$udp_services</tt> macro aan te maken
en een filterregel toe te voegen die gelijkaardig is aan de bovenstaande
en <tt>proto udp</tt> specificeert.

<p>
De volgende regel vangt alle pogingen op om door iemand op Internet een
verbinding te maken met poort 80 op de firewall.
Legitieme poginen om deze poort te bereiken zijn van gebruiks die de
webserver op het netwerk te bereiken.
Deze verbindingspogingen moeten worden omgeleid naar COMP3:

<blockquote><pre>
pass in on egress inet proto tcp to (egress) port 80 rdr-to $comp3
</pre></blockquote>

<p>
ICMP verkeer moet doorgelaten worden:
<blockquote><pre>
pass in inet proto icmp all icmp-type $icmp_types
</pre></blockquote>

<p>
Gelijkaardig aan de <tt>$tcp_services</tt> macro, kan de <tt>$icmp_types</tt>
macro gemakkelijk bewerkt worden om de types van ICMP pakketten te veranderen
die zullen toegestaan worden de firewall te bereiken. Merk op dat deze regel
van toepassing is op alle netwerkinterfaces.

<p>
Nu moet verkeer naar en vanuit het interne netwerk doorgelaten worden.
We zullen aannemen dat gebruikers op het interne netwerk weten wat ze
aan het doen zijn en dat ze geen problemen gaan veroorzaken. Dit is niet
noodzakelijk een geldige veronderstelling; een veel meer beperkende regelset
zou voor vele omgevingen gepast zijn.
<blockquote><pre>
pass in on $int_if
</pre></blockquote>

<p>
TCP, UDP en ICMP verkeer wordt toegestaan om de firewall te verlaten naar het
Internet dankzij de "<tt>pass out</tt>" regel hierboven.
Toestandsinformatie wordt bijgehouden zodat de terugkerende pakketten
binnen gelaten zullen worden doorheen de firewall.

<a name="allrules"></a>
<h2>De Volledige Regelset</h2>
<table border=0 width="650">
<tr><td nowrap bgcolor="#EEEEEE">
<pre>
# macro's

int_if="xl0"

tcp_services="{ 22, 113 }"
icmp_types="echoreq"

comp3="192.168.0.3"

# opties

set block-policy return
set loginterface egress
set skip on lo

# FTP Proxy regels

anchor "ftp-proxy/*"

pass in quick on $int_if inet proto tcp to any port ftp \
    divert-to 127.0.0.1 port 8021

# match-regels

match out on egress inet from !(egress:network) to any nat-to (egress:0)

# filterregels

block in log
pass out quick

antispoof quick for { lo $int_if }

pass in on egress inet proto tcp from any to (egress) \
    port $tcp_services
 
pass in on egress inet proto tcp to (egress) port 80 rdr-to $comp3

pass in inet proto icmp all icmp-type $icmp_types

pass in on $int_if
</pre>
</td></tr>
</table>

<p>
[<a href="carp.html">Vorige: Firewall Redundantie met CARP en pfsync</a>]
[<a href="index.html">Inhoud</a>]

<p>
<hr>
<a href="index.html"><img height="24" width="24" src="../../../images/back.gif" border="0" alt="[terug]"></a> 
<a href="mailto:www@@openbsd.org">www@@openbsd.org</a>
<br>
<small>
<!--
Originally [OpenBSD: example1.html,v 1.54 ]<br>
$Translation: example1.html,v 1.36 2013/11/02 12:49:28 maurice Exp $<br>
-->
$OpenBSD: example1.html,v 1.33 2013/11/02 14:03:43 ajacoutot Exp $
</small>

</body>
</html> 
@


1.33
log
@Sync with Steelix CVS
@
text
@d451 1
a451 1
$OpenBSD$
@


1.32
log
@Sync with Steelix CVS
@
text
@d138 1
a138 1
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=pfctl&amp;sektion=8&amp;manpath=OpenBSD+5.3"
d217 1
a217 1
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=ftp-proxy&amp;sektion=8&amp;manpath=OpenBSD+5.3"
d247 1
a247 1
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=ftp-proxy&amp;sektion=8&amp;manpath=OpenBSD+5.3"
d448 2
a449 2
Originally [OpenBSD: example1.html,v 1.53 ]<br>
$Translation: example1.html,v 1.35 2013/05/01 17:37:04 maurice Exp $<br>
@


1.31
log
@Sync with Steelix CVS
@
text
@d138 1
a138 1
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=pfctl&amp;sektion=8&amp;manpath=OpenBSD+5.2"
d217 1
a217 1
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=ftp-proxy&amp;sektion=8&amp;manpath=OpenBSD+5.2"
d247 1
a247 1
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=ftp-proxy&amp;sektion=8&amp;manpath=OpenBSD+5.2"
d448 2
a449 2
Originally [OpenBSD: example1.html,v 1.52 ]<br>
$Translation: example1.html,v 1.34 2012/11/02 10:45:33 maurice Exp $<br>
@


1.30
log
@Sync with Steelix CVS
@
text
@d138 1
a138 1
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=pfctl&amp;sektion=8&amp;manpath=OpenBSD+5.1"
d217 1
a217 1
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=ftp-proxy&amp;sektion=8&amp;manpath=OpenBSD+5.1"
d247 1
a247 1
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=ftp-proxy&amp;sektion=8&amp;manpath=OpenBSD+5.1"
d448 2
a449 2
Originally [OpenBSD: example1.html,v 1.51 ]<br>
$Translation: example1.html,v 1.33 2012/10/03 09:46:58 maurice Exp $<br>
@


1.29
log
@Sync with Steelix CVS
@
text
@d356 1
a356 2
pass in on egress inet proto tcp to (egress) port 80 \
    rdr-to $comp3 synproxy state
a359 5
Voor een bijkomend beetje veiligheid, zullen we gebruik maken van de
<a href="filter.html#synproxy">TCP SYN Proxy</a> om de webserver verder
te beschermen.

<p>
d428 1
a428 2
pass in on egress inet proto tcp to (egress) port 80 \
    rdr-to $comp3 synproxy state
d448 2
a449 2
Originally [OpenBSD: example1.html,v 1.50 ]<br>
$Translation: example1.html,v 1.32 2012/08/18 09:57:57 maurice Exp $<br>
@


1.28
log
@Sync with Steelix CVS
@
text
@d164 2
a165 2
Door ze hier te definiëren, kunnen we als we dit systeem moeten verplaatsen
naar een systeem met andere hardware, alleen die twee lijnen veranderen,
d180 2
a181 1
<tt>pppoe0</tt> interface en <i>niet</i> op <tt>fxp0</tt>.
d190 1
a190 1
set loginterface fxp0
d410 1
a410 1
set loginterface fxp0
d422 1
a422 1
match out on egress inet from !(egress) to any nat-to (egress:0)
d455 2
a456 2
Originally [OpenBSD: example1.html,v 1.49 ]<br>
$Translation: example1.html,v 1.31 2012/05/11 17:18:36 maurice Exp $<br>
@


1.27
log
@Sync with Steelix CVS
@
text
@d138 1
a138 1
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=pfctl&amp;sektion=8&amp;manpath=OpenBSD+5.0"
d216 1
a216 1
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=ftp-proxy&amp;sektion=8&amp;manpath=OpenBSD+5.0"
d246 1
a246 1
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=ftp-proxy&amp;sektion=8&amp;manpath=OpenBSD+5.0"
d454 2
a455 2
Originally [OpenBSD: example1.html,v 1.48 ]<br>
$Translation: example1.html,v 1.30 2011/11/02 18:31:40 maurice Exp $<br>
@


1.26
log
@Sync with Steelix CVS
@
text
@@


1.25
log
@Sync with Steelix CVS
@
text
@d138 1
a138 1
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=pfctl&amp;sektion=8&amp;manpath=OpenBSD+4.9"
d216 1
a216 1
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=ftp-proxy&amp;sektion=8&amp;manpath=OpenBSD+4.9"
d246 1
a246 1
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=ftp-proxy&amp;sektion=8&amp;manpath=OpenBSD+4.9"
d454 2
a455 2
Originally [OpenBSD: example1.html,v 1.47 ]<br>
$Translation: example1.html,v 1.29 2011/11/01 19:46:05 maurice Exp $<br>
@


1.24
log
@Sync with Steelix CVS
@
text
@d231 1
a231 1
    rdr-to 127.0.0.1 port 8021
d417 1
a417 1
    rdr-to 127.0.0.1 port 8021
d454 2
a455 2
Originally [OpenBSD: example1.html,v 1.46 ]<br>
$Translation: example1.html,v 1.28 2011/05/01 15:20:32 maurice Exp $<br>
@


1.23
log
@Sync with Steelix CVS
@
text
@d138 1
a138 1
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=pfctl&amp;sektion=8&amp;manpath=OpenBSD+4.8"
d216 1
a216 1
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=ftp-proxy&amp;sektion=8&amp;manpath=OpenBSD+4.8"
d246 1
a246 1
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=ftp-proxy&amp;sektion=8&amp;manpath=OpenBSD+4.8"
d454 2
a455 2
Originally [OpenBSD: example1.html,v 1.45 ]<br>
$Translation: example1.html,v 1.27 2010/11/03 18:34:56 maurice Exp $<br>
@


1.22
log
@Sync with Steelix CVS
@
text
@d58 1
a58 4
	<li><a href="#scrub">Scrub</a>
	<li><a href="#nat">Network Address Translation</a>
	<li><a href="#rdr">Omleiding ("redirection")</a>
	<li><a href="#filter">Filterregels</a>
d138 1
a138 1
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=pfctl&amp;sektion=8&amp;manpath=OpenBSD+4.7"
d206 1
a206 1
4.7) just does a substring match on the interface name -->
d212 1
a212 4
<a name="scrub"></a>
<a name="nat"></a>
<a name="rdr"></a>
<a name="filter"></a>
d216 1
a216 1
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=ftp-proxy&amp;sektion=8&amp;manpath=OpenBSD+4.7"
d246 1
a246 1
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=ftp-proxy&amp;sektion=8&amp;manpath=OpenBSD+4.7"
d454 2
a455 2
Originally [OpenBSD: example1.html,v 1.43 ]<br>
$Translation: example1.html,v 1.26 2010/07/24 06:30:15 maurice Exp $<br>
@


1.21
log
@Syn with Steelix CVS
@
text
@d221 37
a257 1
Het voorbeeld begint met enkele <tt>match</tt> regels.
a336 12
We zullen
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=ftp-proxy&amp;sektion=8&amp;manpath=OpenBSD+4.7"
>ftp-proxy(8)</a> gebruiken zodat FTP-clients op het lokale netwerk
FTP-servers op internet kunnen bereiken.
Dit functioneert door het dynamisch invoegen van regels wanneer een
ftp-verbinding wordt gemaakt.
Dit wordt gedaan met behulp van een <a href="anchors.html">anker</a>:
<blockquote><pre>
anchor "ftp-proxy/*"
</pre></blockquote>

<p>
a353 16
Nu voegen we de regel toe die nodig is om FTP-verbindingen om te leiden
zodat ze worden gezien door ftp-proxy(8):
<blockquote><pre>
pass in on $int_if inet proto tcp to any port ftp \
    rdr-to 127.0.0.1 port 8021
</pre></blockquote>

<p>
Deze regel onderschept FTP-verbindingen naar poort 21 en leidt ze om naar
ftp-proxy(8) die draait op poort 8021.
Indien gebruikers regelmatig verbinding maken naar FTP-servers op
andere poorten, dan zou een lijst gebruikt moeten worden om de doel-poort
aan te geven, bijvoorbeeld:
+<tt>to any port { 21, 2121 }</tt>.

<p>
d418 7
a435 2
anchor "ftp-proxy/*"

a438 3
pass in on $int_if inet proto tcp to any port ftp \
    rdr-to 127.0.0.1 port 8021
 
d460 2
a461 2
Originally [OpenBSD: example1.html,v 1.42 ]<br>
$Translation: example1.html,v 1.23 2010/05/26 18:49:24 maurice Exp $<br>
@


1.20
log
@Sync with Steelix CVS
@
text
@d155 6
a160 8
<blockquote>
<tt>
ext_if="fxp0"<br>
int_if="xl0"<br>
<br>
tcp_services="{ 22, 113 }"<br>
icmp_types="echoreq"<br>
<br>
d162 1
a162 2
</tt>
</blockquote>
d165 1
a165 1
De eerste twee lijnen definiëren de netwerkinterfaces waarop filtering zal
d170 5
a174 1
De derde en vierde lijnen sommen de TCP poortnummers op van de
d181 1
a181 1
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=pppoe&amp;sektion=8"
d183 1
a183 1
<tt>tun0</tt> interface en <i>niet</i> op <tt>fxp0</tt>.
d190 4
a193 6
<blockquote>
<tt>
set block-policy return<br>
set loginterface $ext_if
</tt>
</blockquote>
d205 1
a205 2
<blockquote>
<tt>
d207 4
a210 3
</tt>
</blockquote>
Merk op dat we hier de volledige interface-groep <tt>lo</tt> overslaan,
d216 17
a232 8
<h3>Scrub</h3>
Er is geen reden om het aanbevolen schrobben van alle binnenkomende verkeer
niet te gebruiken, dus dit is een eenvoudige one-liner:
<blockquote>
<tt>
match in all scrub (no-df)
</tt>
</blockquote>
d234 1
a234 2
<a name="nat"></a>
<h3>Network Address Translation</h3>
d236 4
a239 6
<tt>nat</tt> regel gebruikt:
<blockquote>
<tt>
nat on $ext_if from !($ext_if) to any -&gt; ($ext_if)
</tt>
</blockquote>
d242 5
a246 4
De "<tt>!($ext_if)</tt>" zou in dit geval gemakkelijk kunnen vervangen worden
door een "<tt>$int_if</tt>", maar als u meerdere interne interfaces toevoegt,
zou u bijkomende NAT regels moeten toevoegen, terwijl met deze structuur
NAT zal geregeld worden op alle beschermde interfaces.
d252 3
d257 3
a259 8
Aangezien we een werkende FTP proxy zullen willen, zullen we het NAT
<a href="anchors.html">anker</a> er ook inzetten:

<blockquote>
<tt>
nat-anchor "ftp-proxy/*"
</tt>
</blockquote>
d261 6
a266 42


<a name="rdr"></a>
<h3>Omleiding ("redirection")</h3>
De eerste omleidingsregels die nodig zijn dienen voor
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=ftp-proxy&amp;sektion=8&amp;manpath=OpenBSD+4.7"
>ftp-proxy(8)</a> zodat FTP clients op het lokale netwerk kunnen verbinden
naar FTP servers op het Internet.
<blockquote>
<tt>
rdr-anchor "ftp-proxy/*"<br>
rdr on $int_if proto tcp from any to any port 21 -&gt; 127.0.0.1 port 8021
</tt>
</blockquote>

<p>
Merk op dat deze regel alleen FTP verbindingen naar poort 21 zal opvangen.
Als gebruikers regelmatig verbinden naar FTP servers op andere poorten,
dan moet er een lijst gebruikt worden om de bestemmingspoort te specificeren,
bijvoorbeeld: <tt>from any to any port { 21, 2121 }</tt>.

<p>
De laatste omleidingsregel vangt pogingen op door iemand op het Internet
om te verbinden naar TCP poort 80 op de firewall.
Legitieme pogingen om deze poort te benaderen zullen komen van gebruikers
die proberen de webserver van het netwerk te bereiken.
Deze verbindingspogingen moeten omgeleid worden naar COMP3:

<blockquote>
<tt>
rdr on $ext_if proto tcp from any to any port 80 -&gt; $comp3
</tt>
</blockquote>

<a name="filter"></a>
<h3>Filterregels</h3>
Nu de filterregels. Begin met het "standaard weigeren":
<blockquote>
<tt>
block in<br>
</tt>
</blockquote>
d271 1
d286 6
a291 5
<blockquote>
<tt>
pass out keep state
</tt>
</blockquote>
a293 7
We hebben een <a href="anchors.html">anker</a> nodig voor ftp-proxy(8):
<blockquote>
<tt>
anchor "ftp-proxy/*"
</tt>
</blockquote>

d296 1
a296 2
<blockquote>
<tt>
d298 1
a298 2
</tt>
</blockquote>
d300 11
d316 4
a319 6
<blockquote>
<tt>
pass in on $ext_if inet proto tcp from any to ($ext_if) \<br>
&nbsp;&nbsp;&nbsp;port $tcp_services flags S/SA keep state
</tt>
</blockquote>
d330 26
a355 8
Bovenop een <tt>rdr</tt> regel te hebben die webserver-verkeer doorgeeft
naar COMP3, MOETEN we dit verkeer ook doorheen de firewall laten gaan:
<blockquote>
<tt>
pass in on $ext_if inet proto tcp from any to $comp3 port 80 \<br>
&nbsp;&nbsp;&nbsp;&nbsp;flags S/SA synproxy state
</tt>
</blockquote>
d364 3
a366 5
<blockquote>
<tt>
pass in inet proto icmp all icmp-type $icmp_types keep state
</tt>
</blockquote>
d380 3
a382 5
<blockquote>
<tt>
pass in quick on $int_if
</tt>
</blockquote>
d386 1
a386 1
Internet dankzij de "<tt>pass out keep state</tt>" lijn hierboven.
d396 1
a396 1
ext_if="fxp0"
d405 1
d407 1
a407 2
set loginterface $ext_if

d410 1
a410 7
# scrub
match in all scrub (no-df)

# nat/rdr
nat on $ext_if from !($ext_if) -> ($ext_if:0)
nat-anchor "ftp-proxy/*"
rdr-anchor "ftp-proxy/*"
d412 1
a412 2
rdr pass on $int_if proto tcp to port ftp -> 127.0.0.1 port 8021
rdr on $ext_if proto tcp from any to any port 80 -> $comp3
a414 1
block in
d416 2
a417 1
pass out keep state
a418 1
anchor "ftp-proxy/*"
d421 1
a421 2
pass in on $ext_if inet proto tcp from any to ($ext_if) \
   port $tcp_services flags S/SA keep state
d423 8
a430 2
pass in on $ext_if inet proto tcp from any to $comp3 port 80 \
    flags S/SA synproxy state
d432 1
a432 1
pass in inet proto icmp all icmp-type $icmp_types keep state
d434 1
a434 1
pass in quick on $int_if
d450 2
a451 2
Originally [OpenBSD: example1.html,v 1.41 ]<br>
$Translation: example1.html,v 1.22 2010/05/23 13:38:49 maurice Exp $<br>
@


1.19
log
@Sync with Steelix CVS
@
text
@d141 1
a141 1
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=pfctl&amp;sektion=8&amp;manpath=OpenBSD+4.6"
d262 1
a262 1
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=ftp-proxy&amp;sektion=8&amp;manpath=OpenBSD+4.6"
d469 2
a470 2
Originally [OpenBSD: example1.html,v 1.40 ]<br>
$Translation: example1.html,v 1.21 2010/03/19 18:42:43 maurice Exp $<br>
@


1.18
log
@Sync with Steelix CVS
@
text
@d144 1
d469 2
a470 2
Originally [OpenBSD: example1.html,v 1.39 ]<br>
$Translation: example1.html,v 1.20 2009/10/18 22:53:10 maurice Exp $<br>
@


1.17
log
@Sync with Steelix CVS
@
text
@d141 1
a141 1
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=pfctl&amp;sektion=8&amp;manpath=OpenBSD+4.5"
d221 1
a221 1
scrub in
d261 1
a261 1
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=ftp-proxy&amp;sektion=8&amp;manpath=OpenBSD+4.5"
d426 1
a426 1
scrub in
d468 2
a469 2
Originally [OpenBSD: example1.html,v 1.38 ]<br>
$Translation: example1.html,v 1.19 2009/05/01 15:28:39 maurice Exp $<br>
@


1.16
log
@Sync with Steelix CVS
@
text
@d141 1
a141 1
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=pfctl&amp;sektion=8&amp;manpath=OpenBSD+4.4"
d261 1
a261 1
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=ftp-proxy&amp;sektion=8&amp;manpath=OpenBSD+4.4"
d468 2
a469 2
Originally [OpenBSD: example1.html,v 1.37 ]<br>
$Translation: example1.html,v 1.18 2009/01/25 20:33:16 maurice Exp $<br>
@


1.15
log
@Sync with Steelix CVS
@
text
@d468 2
a469 2
Originally [OpenBSD: example1.html,v 1.36 ]<br>
$Translation: example1.html,v 1.17 2008/12/04 21:56:57 maurice Exp $<br>
@


1.14
log
@Sync with Steelix CVS
@
text
@d141 1
a141 1
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=pfctl&amp;sektion=8&amp;manpath=OpenBSD+4.2"
d261 1
a261 1
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=ftp-proxy&amp;sektion=8&amp;manpath=OpenBSD+4.2"
d468 2
a469 2
Originally [OpenBSD: example1.html,v 1.34 ]<br>
$Translation: example1.html,v 1.16 2007/12/30 10:57:39 smestdag Exp $<br>
@


1.13
log
@Sync with Steelix CVS
@
text
@d452 1
a452 1
pass quick on $int_if
d468 2
a469 2
Originally [OpenBSD: example1.html,v 1.33 ]<br>
$Translation: example1.html,v 1.15 2007/11/18 10:30:30 smestdag Exp $<br>
@


1.12
log
@Sync with Steelix CVS
@
text
@d141 1
a141 1
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=pfctl&amp;sektion=8&amp;manpath=OpenBSD+4.1"
d261 1
a261 1
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=ftp-proxy&amp;sektion=8&amp;manpath=OpenBSD+4.1"
d468 2
a469 2
Originally [OpenBSD: example1.html,v 1.32 ]<br>
$Translation: example1.html,v 1.14 2007/05/10 07:36:39 smestdag Exp $<br>
@


1.11
log
@sync with Steelix CVS
@
text
@d119 1
a119 1
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=ping&amp;sektion=8&amp;manpath=OpenBSD+4.0"
d137 1
a137 1
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=sysctl&amp;sektion=3&amp;manpath=OpenBSD+4.0"
d141 1
a141 1
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=pfctl&amp;sektion=8&amp;manpath=OpenBSD+4.0"
d179 1
a179 1
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=pppoe&amp;sektion=8&amp;manpath=OpenBSD+4.0"
d200 1
a200 1
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=lo&amp;sektion=4&amp;manpath=OpenBSD+4.0"
d261 1
a261 1
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=ftp-proxy&amp;sektion=8&amp;manpath=OpenBSD+4.0"
d468 2
a469 2
Originally [OpenBSD: example1.html,v 1.31 ]<br>
$Translation: example1.html,v 1.13 2006/11/03 17:28:37 smestdag Exp $<br>
@


1.10
log
@sync with steelix translation CVS
@
text
@d119 1
a119 1
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=ping&amp;sektion=8&amp;manpath=OpenBSD+3.9"
d137 2
a138 2
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=sysctl&amp;sektion=3&amp;manpath=OpenBSD+3.9"
>sysctl(3)</a> variabelen <tt>net.inet.ip.forwarding</tt> en
d140 4
a143 1
Waarschijnlijk wil u ook PF activeren in <tt>/etc/rc.conf.local</tt>.
d179 1
a179 1
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=pppoe&amp;sektion=8&amp;manpath=OpenBSD+3.9"
d200 1
a200 1
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=lo&amp;sektion=4&amp;manpath=OpenBSD+3.9"
d261 1
a261 1
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=ftp-proxy&amp;sektion=8&amp;manpath=OpenBSD+3.9"
d468 2
a469 2
Originally [OpenBSD: example1.html,v 1.29 ]<br>
$Translation: example1.html,v 1.12 2006/10/31 07:28:37 smestdag Exp $<br>
@


1.9
log
@sync with Steelix CVS
@
text
@d136 4
a139 2
Internet-connectiviteit, en het instellen van <tt>net.inet.ip.forwarding</tt>
op "<tt>1</tt>".
d465 2
a466 2
Originally [OpenBSD: example1.html,v 1.28 ]<br>
$Translation: example1.html,v 1.11 2006/07/04 09:53:05 smestdag Exp $<br>
@


1.8
log
@sync with steelix translation CVS
@
text
@d176 1
a176 1
<tt>tun0</tt> interface en <i>niet</i> op <tt>xl0</tt>.
d463 2
a464 2
Originally [OpenBSD: example1.html,v 1.27 ]<br>
$Translation: example1.html,v 1.10 2006/05/08 21:06:54 smestdag Exp $<br>
@


1.7
log
@sync with Steelix CVS
@
text
@d202 1
a202 1
set skip on lo0
d205 4
d463 2
a464 2
Originally [OpenBSD: example1.html,v 1.26 ]<br>
$Translation: example1.html,v 1.9 2006/05/03 06:12:23 smestdag Exp $<br>
@


1.6
log
@3.9 release time.
@
text
@d151 1
a152 1
ext_if="fxp0"<br>
d176 1
a176 1
<tt>tun0</tt> interface en <i>niet</i> op <tt>ep0</tt>.
d239 1
a239 1
<a href="anchor.html">anker</a> er ook inzetten:
d314 1
a314 1
We hebben een <a href="anchor.html">anker</a> nodig voor ftp-proxy(8):
d459 2
a460 2
Originally [OpenBSD: example1.html,v 1.24 ]<br>
$Translation: example1.html,v 1.8 2006/05/01 10:41:10 smestdag Exp $<br>
@


1.5
log
@sync with Steelix CVS
@
text
@d73 2
a74 1
en beperkte toegang tot de firewall machine vanaf het Internet. Dit
d84 2
a85 2
      |            |                               ADSL
   ---+------+-----+------- fxp0 [ OpenBSD ] ep0 -------- ( Internet )
d99 3
a101 3
De OpenBSD router is een Pentium 100 met twee netwerkkaarten: een 3com
3c509B (<tt>ep0</tt>) en een Intel EtherExpress Pro/100 (<tt>fxp0</tt>).
De router heeft een ADSL verbinding naar het Internet en gebruikt NAT om
d119 1
a119 1
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=ping&amp;sektion=8&amp;manpath=OpenBSD+3.8"
d138 1
d151 2
a152 2
int_if = "fxp0"<br>
ext_if = "ep0"<br>
d154 2
a155 2
tcp_services = "{ 22, 113 }"<br>
icmp_types = "echoreq"<br>
d157 1
a157 4
priv_nets = "{ 127.0.0.0/8, 192.168.0.0/16, 172.16.0.0/12, 10.0.0.0/8 }"
<br>
<br>
comp3 = "192.168.0.3"
d163 5
a167 1
gebeuren. De derde en vierde lijnen sommen de TCP poortnummers op van de
d169 1
a169 4
de ICMP pakket-types die zullen toegelaten worden de firewall machine te
bereiken.
De vijfde lijn definieert de loopback en
<a href="http://www.geektools.com/rfc/rfc1918.txt">RFC 1918</a> adresblokken.
d173 2
a174 2
<b>Opmerking</b>: Als de ADSL Internetverbinding
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=pppoe&amp;sektion=8&amp;manpath=OpenBSD+3.8"
d195 1
a195 1
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=lo&amp;sektion=4&amp;manpath=OpenBSD+3.8"
d212 1
a212 1
scrub in all
d222 1
a222 1
nat on $ext_if from $int_if:network to any -&gt; ($ext_if)
d227 6
d237 12
d251 2
a252 2
De eerste omleidingsregel die nodig is dient voor
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=ftp-proxy&amp;sektion=8&amp;manpath=OpenBSD+3.8"
d257 1
d269 1
a269 1
De tweede omleidingsregel vangt pogingen op door iemand op het Internet
d286 1
a286 1
block all<br>
d291 3
a293 2
Op dit ogenblik zal niets doorheen de firewall gaan, zelfs niet vanaf het
interne netwerk. De volgende regels zullen de firewall openen volgens de
d298 9
a306 7
Vervolgens zullen de
<a href="http://www.geektools.com/rfc/rfc1918.txt">RFC 1918</a>
adressen geblokkeerd worden om in of uit de externe interface te gaan.
Deze adressen mogen nooit voorkomen op het publieke Internet, en het
filteren ervan zal ervoor zorgen dat de router deze adressen niet vanuit het
interne netwerk naar buiten "lekt", en ook gelijk welke binnenkomende
pakketten blokkeert met een bronadres in één van die netwerken.
d309 1
a309 2
block drop in &nbsp;quick on $ext_if from $priv_nets to any<br>
block drop out quick on $ext_if from any to $priv_nets
d314 15
a328 8
Merk op dat <tt>block drop</tt> gebruikt wordt om PF op te dragen om niet
te antwoorden met een TCP RST of ICMP Unreachable pakket. Aangezien de
RFC 1918 adressen niet bestaan op het Internet, zal gelijk welk pakket dat
naar die adressen verstuurd wordt, er toch nooit geraken. De <tt>quick</tt>
optie wordt gebruikt om PF op te dragen geen moeite te doen om de rest van
de filterregels te evalueren als één van de bovenstaande regels overeenstemt;
pakketten naar en van <tt>$priv_nets</tt> netwerken zullen onmiddellijk
gedropt worden.
d332 2
a333 1
zijn voor het Internet:
d354 1
a354 1
pass in on $ext_if proto tcp from any to $comp3 port 80 \<br>
d361 1
a361 1
<a href="filter.html#synproxy">TCP SYN Proxy</a> om deweb server verder
d365 1
a365 15
Opdat actieve modus FTP verbindingen zouden werken van binnen de LAN,
moet de volgende regel aanwezig zijn om de ftp-data verbinding, geïnitieerd
door de FTP server, terug naar de client toe te laten.
Aangezien FTP verbindingen ge-proxied worden door ftp-proxy, zal het
eigenlijk de ftp-data verbinding zelf aannemen en vervolgens de gegevens
omleiden naar de client in de LAN.
<blockquote>
<tt>
pass in on $ext_if inet proto tcp from port 20 to ($ext_if) \<br>
&nbsp;&nbsp;&nbsp;&nbsp;user proxy flags S/SA keep state
</tt>
</blockquote>

<p>
ICMP verkeer moet nu doorgelaten worden:
d383 1
a383 1
zou voor bepaalde omgevingen gepast zijn.
d386 1
a386 45
pass in on $int_if from $int_if:network to any keep state
</tt>
</blockquote>

<p>
De bovenstaande regel zal gelijk welke interne machine toelaten om pakketten
doorheen de firewall te sturen; hij zal echter de firewall <i>niet</i>
toestaan een verbinding te initiëren naar een interne machine. Is dit een
goed idee? Dat hangt af van enkele van de fijnere details van de netwerksetup.
Als de firewall ook een DHCP server is, kan hij een adres moeten "pingen"
om de beschikbaarheid ervan te verifiëren alvorens het toe te kennen.
De firewall toelaten te verbinden naar het interne netwerk laat ook toe
dat iemand die naar de firewall ge-ssh't heeft vanaf het Internet, vervolgens
machines op het netwerk benadert. Hou in het achterhoofd dat het <i>niet</i>
toelaten aan de firewall om rechtstreeks met het netwerk te communiceren,
geen groot beveiligingsvoordeel vormt; als iemand toegang verkrijgt tot de
firewall, kan hij waarschijnlijk toch de filterregels aanpassen. Door de
volgende regel toe te voegen, zal de firewall verbindingen naar het interne
netwerk kunnen initiëren:
<blockquote>
<tt>
pass out on $int_if from any to $int_if:network keep state
</tt>
</blockquote>

<p>
Merk op dat als deze lijnen allebei aanwezig zijn, de <tt>keep state</tt>
optie niet nodig is; alle pakketten zullen doorheen de interne interface
kunnen gaan omdat er een regel is om pakketten in beide richtingen door te
laten. Als de <tt>pass out</tt> lijn er echter <i>niet</i> staat, dan
<i>moet</i> de <tt>pass in</tt> lijn <tt>keep state</tt> bevatten.
Er is ook wat prestatievoordeel aan toestand bijhouden:
Toestandstabellen worden gecontroleerd voordat regels geëvalueerd worden,
en als een toestandsovereenstemming gevonden wordt, wordt het pakket doorheen
de firewall gelaten zonder doorheen regelset-evaluatie te gaan. Dit kan een
prestatievoordeel bieden op een zwaar belaste firewall, hoewel in een
eenvoudig systeem als dit het onwaarschijnlijk is om voldoende belasting
te genereren om van belang te zijn.

<p>
Laat tenslotte verkeer naar buiten op de externe interface:
<blockquote>
<tt>
pass out on $ext_if proto tcp all modulate state flags S/SA<br>
pass out on $ext_if proto { udp, icmp } all keep state
d392 2
a393 1
Internet. Toestandsinformatie wordt bijgehouden zodat de terugkerende pakketten
d402 2
a403 2
int_if = "fxp0"
ext_if = "ep0"
d405 2
a406 2
tcp_services = "{ 22, 113 }"
icmp_types = "echoreq"
d408 1
a408 3
priv_nets = "{ 127.0.0.0/8, 192.168.0.0/16, 172.16.0.0/12, 10.0.0.0/8 }"
	  
comp3 = "192.168.0.3"
d413 2
a414 1
set skip on lo0
d417 1
a417 1
scrub in all
d420 6
a425 4
nat on $ext_if from $int_if:network to any -&gt; ($ext_if)
rdr on $int_if proto tcp from any to any port 21 -&gt; 127.0.0.1 \
   port 8021
rdr on $ext_if proto tcp from any to any port 80 -&gt; $comp3
d428 1
a428 1
block all
d430 4
a433 2
block drop in  quick on $ext_if from $priv_nets to any
block drop out quick on $ext_if from any to $priv_nets
d438 2
a439 5
pass in on $ext_if proto tcp from any to $comp3 port 80 \
   flags S/SA synproxy state

pass in on $ext_if inet proto tcp from port 20 to ($ext_if) \
   user proxy flags S/SA keep state
d443 1
a443 5
pass in  on $int_if from $int_if:network to any keep state
pass out on $int_if from any to $int_if:network keep state

pass out on $ext_if proto tcp all modulate state flags S/SA
pass out on $ext_if proto { udp, icmp } all keep state
d459 2
a460 2
Originally [OpenBSD: example1.html,v 1.22 ]<br>
$Translation: example1.html,v 1.7 2006/01/01 10:44:50 smestdag Exp $<br>
@


1.4
log
@sync with steelix translation CVS
@
text
@d190 16
a277 13
Elk Unix-systeem heeft een "loopback" interface. Dit is een virtuele
netwerkinterface die door toepassingen gebruikt wordt om met elkaar te
praten binnen het systeem. In het algemeen wordt alle verkeer best
doorgelaten op de loopback interface. Op OpenBSD is de loopback interface
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=lo&amp;sektion=4&amp;manpath=OpenBSD+3.8"
>lo(4)</a>.
<blockquote>
<tt>
pass quick on lo0 all
</tt>
</blockquote>

<p>
d443 1
a456 2
pass quick on lo0 all

d491 2
a492 2
Originally [OpenBSD: example1.html,v 1.21 ]<br>
$Translation: example1.html,v 1.6 2005/11/01 12:25:57 smestdag Exp $<br>
@


1.3
log
@sync with Steelix CVS
@
text
@d118 1
a118 1
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=ping&amp;sektion=8&amp;manpath=OpenBSD+3.7"
d174 1
a174 1
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=pppoe&amp;sektion=8&amp;manpath=OpenBSD+3.7"
d218 1
a218 1
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=ftp-proxy&amp;sektion=8&amp;manpath=OpenBSD+3.7"
d266 1
a266 1
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=lo&amp;sektion=4&amp;manpath=OpenBSD+3.7"
d489 2
a490 2
Originally [OpenBSD: example1.html,v 1.20 ]<br>
$Translation: example1.html,v 1.5 2005/07/01 14:52:32 smestdag Exp $<br>
@


1.2
log
@sync with Steelix CVS
@
text
@d46 1
a46 1
<h3>Inhoudstafel</h3>
d490 1
a490 1
$Translation: example1.html,v 1.4 2005/05/21 23:37:04 smestdag Exp $<br>
@


1.1
log
@Sync with Steelix CVS
@
text
@d38 1
a38 2
[<a href="authpf.html">Vorige: Authpf: Gebruiker-Shell voor Authentiserende
Gateways</a>]
d118 1
a118 1
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=ping&amp;sektion=8&amp;manpath=OpenBSD+3.6"
d174 1
a174 1
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=pppoe&amp;sektion=8&amp;manpath=OpenBSD+3.6"
d218 1
a218 1
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=ftp-proxy&amp;sektion=8&amp;manpath=OpenBSD+3.6"
d266 1
a266 1
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=lo&amp;sektion=4&amp;manpath=OpenBSD+3.6"
d479 1
a479 2
[<a href="authpf.html">Vorige: Authpf: Gebruiker-Shell voor Authentiserende
Gateways</a>]
d489 2
a490 2
Originally [OpenBSD: example1.html,v 1.18 ]<br>
$Translation: example1.html,v 1.1 2005/03/06 16:04:26 smestdag Exp $<br>
@

