head	1.70;
access;
symbols;
locks; strict;
comment	@# @;


1.70
date	2017.06.26.17.18.58;	author tb;	state Exp;
branches;
next	1.69;
commitid	jKVBuSx5No9bUpg1;

1.69
date	2016.08.15.02.22.14;	author tb;	state Exp;
branches;
next	1.68;
commitid	3DeixV5YkPOb78RN;

1.68
date	2016.08.14.15.21.18;	author tb;	state Exp;
branches;
next	1.67;
commitid	p45GRXRN7v62aGwm;

1.67
date	2016.08.12.14.26.56;	author tj;	state Exp;
branches;
next	1.66;
commitid	wmjPiWi8vapA5CoX;

1.66
date	2016.08.12.14.20.07;	author tj;	state Exp;
branches;
next	1.65;
commitid	wKtnoAViycX3Ro70;

1.65
date	2016.06.13.17.58.25;	author tj;	state Exp;
branches;
next	1.64;
commitid	Grx2UyJPWzJbbhkP;

1.64
date	2016.04.18.19.07.50;	author tj;	state Exp;
branches;
next	1.63;
commitid	g0cUF3jNn5Tz4oaZ;

1.63
date	2016.04.16.00.30.41;	author tj;	state Exp;
branches;
next	1.62;
commitid	rTxoenHHaeutOff1;

1.62
date	2016.04.15.20.39.49;	author tb;	state Exp;
branches;
next	1.61;
commitid	jwteSMEb4rFzI8UA;

1.61
date	2016.03.29.01.27.39;	author tb;	state Exp;
branches;
next	1.60;
commitid	4Y8oU6GBrSY1UOfW;

1.60
date	2016.03.27.19.52.09;	author sthen;	state Exp;
branches;
next	1.59;
commitid	hi2ObFv9LGB98JY5;

1.59
date	2016.03.22.10.56.56;	author sthen;	state Exp;
branches;
next	1.58;
commitid	G2izHhNJ7aqR0Y6j;

1.58
date	2016.03.21.05.46.21;	author beck;	state Exp;
branches;
next	1.57;
commitid	zEx6zFkNSFFExu0v;

1.57
date	2016.01.11.06.30.13;	author tb;	state Exp;
branches;
next	1.56;
commitid	kpxTb5fPDcXr5p29;

1.56
date	2015.10.18.19.48.19;	author nick;	state Exp;
branches;
next	1.55;
commitid	gkrFWKimwWNVivXe;

1.55
date	2015.09.26.08.57.52;	author sthen;	state Exp;
branches;
next	1.54;
commitid	TpL5N8pMn9ZvirKf;

1.54
date	2015.07.02.05.49.05;	author bentley;	state Exp;
branches;
next	1.53;
commitid	AP3UllesavMDEUhQ;

1.53
date	2015.05.11.11.18.30;	author sthen;	state Exp;
branches;
next	1.52;
commitid	wRrXxcro6dFYiwF8;

1.52
date	2015.04.30.23.48.01;	author nick;	state Exp;
branches;
next	1.51;
commitid	uFWv68UTtTmjkqVF;

1.51
date	2014.12.02.03.17.26;	author nick;	state Exp;
branches;
next	1.50;
commitid	RQ0cKiFD5x45dGyo;

1.50
date	2014.12.01.10.01.07;	author bentley;	state Exp;
branches;
next	1.49;
commitid	DtrOVs7q8kqgEsjm;

1.49
date	2014.07.30.21.57.19;	author sthen;	state Exp;
branches;
next	1.48;
commitid	632wqensvvuAHAOA;

1.48
date	2014.06.24.13.42.23;	author sthen;	state Exp;
branches;
next	1.47;
commitid	lNk1kOIOTb9J7iWf;

1.47
date	2014.06.03.11.11.20;	author nick;	state Exp;
branches;
next	1.46;
commitid	Bl9YHio9LiChPels;

1.46
date	2014.05.01.15.03.50;	author nick;	state Exp;
branches;
next	1.45;

1.45
date	2014.03.31.02.33.07;	author nick;	state Exp;
branches;
next	1.44;

1.44
date	2013.11.01.14.07.06;	author nick;	state Exp;
branches;
next	1.43;

1.43
date	2013.05.01.13.21.45;	author nick;	state Exp;
branches;
next	1.42;

1.42
date	2013.04.21.00.47.14;	author sthen;	state Exp;
branches;
next	1.41;

1.41
date	2013.02.18.16.09.29;	author nick;	state Exp;
branches;
next	1.40;

1.40
date	2012.11.01.15.06.36;	author nick;	state Exp;
branches;
next	1.39;

1.39
date	2012.08.17.00.49.57;	author nick;	state Exp;
branches;
next	1.38;

1.38
date	2012.05.11.11.20.04;	author nick;	state Exp;
branches;
next	1.37;

1.37
date	2011.11.02.01.01.47;	author nick;	state Exp;
branches;
next	1.36;

1.36
date	2011.06.28.08.33.49;	author jj;	state Exp;
branches;
next	1.35;

1.35
date	2011.05.01.12.57.11;	author nick;	state Exp;
branches;
next	1.34;

1.34
date	2011.02.13.15.17.27;	author jj;	state Exp;
branches;
next	1.33;

1.33
date	2010.11.01.09.53.51;	author nick;	state Exp;
branches;
next	1.32;

1.32
date	2010.05.19.13.25.16;	author sthen;	state Exp;
branches;
next	1.31;

1.31
date	2009.10.16.19.12.42;	author nick;	state Exp;
branches;
next	1.30;

1.30
date	2009.04.30.17.27.31;	author nick;	state Exp;
branches;
next	1.29;

1.29
date	2008.10.31.16.49.34;	author nick;	state Exp;
branches;
next	1.28;

1.28
date	2008.07.27.17.13.47;	author nick;	state Exp;
branches;
next	1.27;

1.27
date	2007.11.01.02.57.56;	author joel;	state Exp;
branches;
next	1.26;

1.26
date	2007.05.06.18.59.54;	author nick;	state Exp;
branches;
next	1.25;

1.25
date	2006.11.01.01.56.01;	author joel;	state Exp;
branches;
next	1.24;

1.24
date	2006.10.27.19.26.13;	author nick;	state Exp;
branches;
next	1.23;

1.23
date	2006.05.01.00.54.29;	author nick;	state Exp;
branches;
next	1.22;

1.22
date	2005.12.28.17.11.25;	author joel;	state Exp;
branches;
next	1.21;

1.21
date	2005.11.01.11.35.18;	author nick;	state Exp;
branches;
next	1.20;

1.20
date	2005.05.20.00.12.02;	author joel;	state Exp;
branches;
next	1.19;

1.19
date	2004.12.22.04.28.16;	author david;	state Exp;
branches;
next	1.18;

1.18
date	2004.11.01.21.41.07;	author nick;	state Exp;
branches;
next	1.17;

1.17
date	2004.10.29.17.22.57;	author nick;	state Exp;
branches;
next	1.16;

1.16
date	2004.08.19.15.28.50;	author nick;	state Exp;
branches;
next	1.15;

1.15
date	2004.05.07.01.55.23;	author nick;	state Exp;
branches;
next	1.14;

1.14
date	2004.04.30.18.00.25;	author nick;	state Exp;
branches;
next	1.13;

1.13
date	2004.01.01.04.16.17;	author nick;	state Exp;
branches;
next	1.12;

1.12
date	2003.11.27.15.08.25;	author nick;	state Exp;
branches;
next	1.11;

1.11
date	2003.11.09.23.29.02;	author nick;	state Exp;
branches;
next	1.10;

1.10
date	2003.09.27.16.00.20;	author horacio;	state Exp;
branches;
next	1.9;

1.9
date	2003.09.22.02.29.03;	author nick;	state Exp;
branches;
next	1.8;

1.8
date	2003.09.16.01.23.49;	author nick;	state Exp;
branches;
next	1.7;

1.7
date	2003.06.16.22.17.00;	author david;	state Exp;
branches;
next	1.6;

1.6
date	2003.06.13.02.54.08;	author nick;	state Exp;
branches;
next	1.5;

1.5
date	2003.06.04.22.39.33;	author margarida;	state Exp;
branches;
next	1.4;

1.4
date	2003.05.25.01.35.07;	author nick;	state Exp;
branches;
next	1.3;

1.3
date	2003.05.15.03.03.54;	author nick;	state Exp;
branches;
next	1.2;

1.2
date	2003.05.01.14.20.37;	author nick;	state Exp;
branches;
next	1.1;

1.1
date	2003.05.01.01.46.06;	author nick;	state Exp;
branches;
next	;


desc
@@


1.70
log
@move man.openbsd.org links from http:// to https://
reduces the number of http:// links in www/ from >33k to <7k

thanks to schwarze for doing the work
@
text
@<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<html>
<head>

<!-- If you make edits to any FAQ documents, please start each sentence
     on a new line, and try to keep the general formatting consistent
     with the rest of the pages -->

<title>OpenBSD PF: Network Address Translation</title>
<meta http-equiv="Content-Type" content="text/html; charset=ISO-8859-1">
<meta name="viewport" content="width=device-width, initial-scale=1">
<link rel="stylesheet" type="text/css" href="../../openbsd.css">
<link rel="canonical" href="https://www.openbsd.org/faq/pf/nat.html">
</head>

<!--
Copyright (c) 2003, Nick Holland <nick@@openbsd.org>
Copyright (c) 2003, 2004, Joel Knight <enabled@@myrealbox.com>

Permission to use, copy, modify, and distribute this documentation for
any purpose with or without fee is hereby granted, provided that the
above copyright notice and this permission notice appear in all copies.

THE DOCUMENTATION IS PROVIDED "AS IS" AND THE AUTHOR DISCLAIMS ALL
WARRANTIES WITH REGARD TO THIS DOCUMENTATION INCLUDING ALL IMPLIED
WARRANTIES OF MERCHANTABILITY AND FITNESS. IN NO EVENT SHALL THE
AUTHOR BE LIABLE FOR ANY SPECIAL, DIRECT, INDIRECT, OR CONSEQUENTIAL
DAMAGES OR ANY DAMAGES WHATSOEVER RESULTING FROM LOSS OF USE, DATA OR
PROFITS, WHETHER IN AN ACTION OF CONTRACT, NEGLIGENCE OR OTHER
TORTIOUS ACTION, ARISING OUT OF OR IN CONNECTION WITH THE USE OR
PERFORMANCE OF THIS DOCUMENTATION
-->

<body bgcolor="#ffffff" text="#000000">

<h2>
<a href="../../index.html">
<font color="#0000ff"><i>Open</i></font><font color="#000084">BSD</font></a>
<font color="#e00000">PF - Network Address Translation</font>
<small>
<a href="index.html" style="font-weight:normal; float:right">[Contents]</a>
</small>
</h2>
<hr>

<ul>
  <li><a href="#intro"  >Introduction</a>
  <li><a href="#works"  >How NAT works</a>
  <li><a href="#ipfwd"  >IP forwarding</a>
  <li><a href="#config" >Configuring NAT</a>
  <li><a href="#binat"  >Bidirectional mapping (1:1 mapping)</a>
  <li><a href="#except" >Translation rule exceptions</a>
  <li><a href="#status" >Checking NAT status</a>
</ul>

<hr>

<h2 id="intro">Introduction</h2>

Network Address Translation (NAT) is a way to map an entire network (or
networks) to a single IP address.
NAT is necessary when the number of IP addresses assigned to you by your
Internet Service Provider is less than the total number of computers that
you wish to provide internet access for.
NAT is described in <a href="https://tools.ietf.org/html/rfc1631">RFC 1631</a>.

<p>
NAT allows you to take advantage of the reserved address blocks described in
<a href="http://tools.ietf.org/html/rfc1918">RFC 1918</a>.
Typically, your internal network will be setup to use one or more of
these network blocks.
They are:

<blockquote><pre>
10.0.0.0/8       (10.0.0.0 - 10.255.255.255)
172.16.0.0/12    (172.16.0.0 - 172.31.255.255)
192.168.0.0/16   (192.168.0.0 - 192.168.255.255)
</pre></blockquote>

An OpenBSD system doing NAT will have at least two network interfaces, one
to the internet, the other to your internal network.
NAT will be translating requests from the internal network so they appear
to all be coming from your OpenBSD NAT system.

<h2 id="works">How NAT works</h2>

When a client on the internal network contacts a machine on the internet,
it sends out IP packets destined for that machine.
These packets contain all the addressing information necessary to get them
to their destination.
NAT is concerned with these pieces of information:

<ul>
  <li>Source IP address (for example, 192.168.1.35)
  <li>Source TCP or UDP port (for example, 2132)
</ul>

When the packets pass through the NAT gateway, they will be modified so
that they appear to be coming from the NAT gateway itself.
The NAT gateway will record the changes it makes in its state table so that
it can a) reverse the changes on return packets and b) ensure that return
packets are passed through the firewall and are not blocked.
For example, the following changes might be made:

<ul>
  <li>Source IP: replaced with the external address of the gateway
      (for example, 198.51.100.1)
  <li>Source port: replaced with a randomly chosen, unused port on the gateway
      (for example, 53136)
</ul>

Neither the internal machine nor the Internet host is aware of these
translation steps.
To the internal machine, the NAT system is simply an internet gateway.
To the internet host, the packets appear to come directly from the NAT system;
it is completely unaware that the internal workstation even exists.

<p>
When the internet host replies to the internal machine's packets, they
will be addressed to the NAT gateway's external IP (198.51.100.1) at the
translation port (53136).
The NAT gateway will then search the state table to determine if the reply
packets match an already established connection.
A unique match will be found based on the IP/port combination which tells PF
the packets belong to a connection initiated by the internal machine
192.168.1.35.
PF will then make the opposite changes it made to the outgoing packets and
forward the reply packets on to the internal machine.

<p>
Translation of ICMP packets happens in a similar fashion but without the
source port modification.

<h2 id="ipfwd">IP forwarding</h2>

Since NAT is almost always used on routers and network gateways, it will
probably be necessary to enable IP forwarding so that packets can travel
between network interfaces on the OpenBSD machine.
IP forwarding is enabled using the
<a href="https://man.openbsd.org/sysctl.3">sysctl(3)</a> mechanism:

<blockquote><pre>
# <b>sysctl net.inet.ip.forwarding=1</b>
# <b>echo  'net.inet.ip.forwarding=1' >> /etc/sysctl.conf</b>
</pre></blockquote>

Or, for IPv6:

<blockquote><pre>
# <b>sysctl net.inet6.ip6.forwarding=1</b>
# <b>echo  'net.inet6.ip6.forwarding=1' >> /etc/sysctl.conf</b>
</pre></blockquote>

<h2 id="config">Configuring NAT</h2>

NAT is specified as an optional <tt>nat-to</tt> parameter to an outbound
<tt>pass</tt> rule.
Often, rather than being set directly on the <tt>pass</tt> rule, a
<tt>match</tt> rule is used.
When a packet is selected by a <tt>match</tt> rule, parameters (e.g.
<tt>nat-to</tt>) in that rule are remembered and are applied to the packet
when a <tt>pass</tt> rule matching the packet is reached.
This permits a whole class of packets to be handled by a single
<tt>match</tt> rule and then specific decisions on whether to allow the
traffic can be made with <tt>block</tt> and <tt>pass</tt> rules.

<p>
The general format in <tt>pf.conf</tt> looks something like this:

<blockquote><pre>
match out on interface [af] \
   from src_addr to dst_addr \
   nat-to ext_addr [pool_type] [static-port]
[...]
pass out [log] on interface [af] [proto protocol] \
   from ext_addr [port src_port] \
   to dst_addr [port dst_port]
</pre></blockquote>

<dl>
<dt><tt>match</tt>
<dd>When a packet traverses the ruleset and matches a <tt>match</tt>
    rule, any optional parameters specified in that rule are remembered
    for future use (made "sticky").

<dt><tt>pass</tt>
<dd>This rule allows the packet to be transmitted.
    If the packet was previously matched by a <tt>match</tt> rule where
    parameters were specified, they will be applied to this packet.
    <tt>pass</tt> rules may have their own parameters; these take
    priority over parameters specified in a <tt>match</tt> rule.

<dt><tt>out</tt>
<dd>Specifies the direction of packet flow where this rule applies.
    <tt>nat-to</tt> may only be specified for outbound packets.

<dt><tt>log</tt>
<dd>Log matching packets via
    <a href="https://man.openbsd.org/pflogd">pflogd(8)</a>.
    Normally, only the first packet that matches will be logged.
    To log all matching packets, use <tt>log (all)</tt>.

<dt><tt><i>interface</i></tt>
<dd>The name or group of the network interface to transmit packets on.

<dt><tt><i>af</i></tt>
<dd>The address family, either <tt>inet</tt> for IPv4 or <tt>inet6</tt>
    for IPv6.
    PF is usually able to determine this parameter based on the
    source/destination address(es).

<dt><tt><i>protocol</i></tt>
<dd>The protocol (e.g. tcp, udp, icmp) of packets to allow.
    If <i>src_port</i> or <i>dst_port</i> is specified, the protocol
    <em>must</em> also be given.

<dt><tt><i>src_addr</i></tt>
<dd>The source (internal) address of packets that will be translated.
    The source address can be specified as:
    <ul>
      <li>A single IPv4 or IPv6 address.
      <li>A <a href="https://web.archive.org/web/20150213012421/http://public.swbell.net/dedicated/cidr.html">CIDR</a>
          network block.
      <li>A fully qualified domain name that will be resolved via DNS when the
          ruleset is loaded.
          All resulting IP addresses will be substituted into the rule.
      <li>The name or group of a network interface.
          Any IPv4 and IPv6 addresses assigned to the interface will be
          substituted into the rule at load time.
      <li>The name of a network interface followed by
          <tt>/<i>netmask</i></tt> (e.g. <tt>/24</tt>).
          Each IP address on the interface is combined with the netmask to
          form a CIDR network block which is substituted into the rule.
      <li>The name or group of a network interface followed by any one of
          these modifiers:
        <ul>
          <li><tt>:network</tt> - substitutes the CIDR network block (e.g.,
              192.168.0.0/24)
          <li><tt>:broadcast</tt> - substitutes the network broadcast address
          (e.g., 192.168.0.255)
          <li><tt>:peer</tt> - substitutes the peer's IP address on a
          point-to-point link
        </ul>
        <dl>
        <dd>In addition, the <tt>:0</tt> modifier can be appended to either an
            interface name/group or to any of the above modifiers to indicate
            that PF should not include aliased IP addresses in the substitution.
            These modifiers can also be used when the interface is contained in
            parentheses.
            Example: <tt>fxp0:network:0</tt>
        </dl>
      <li>A <a href="tables.html">table</a>.
      <li>Any of the above but negated using the <tt>!</tt> ("not") modifier.
      <li>A set of addresses using a <a href="macros.html#lists">list</a>.
      <li>The keyword <tt>any</tt> meaning all addresses
    </ul>

<dt><tt><i>src_port</i></tt>
<dd>The source port in the Layer 4 packet header.
    Ports can be specified as:
    <ul>
      <li>A number between 1 and 65535
      <li>A valid service name from
          <a href="https://man.openbsd.org/services">services(5)</a>
      <li>A set of ports using a <a href="macros.html#lists">list</a>
      <li>A range:
        <ul>
          <li><tt>!=</tt> (not equal)
          <li><tt>&lt;</tt> (less than)
          <li><tt>&gt;</tt> (greater than)
          <li><tt>&lt;=</tt> (less than or equal)
          <li><tt>&gt;=</tt> (greater than or equal)
          <li><tt>&gt;&lt;</tt> (range)
          <li><tt>&lt;&gt;</tt> (inverse range)
        <dl>
        <dd>The last two are binary operators (they take two arguments) and
            do not include the arguments in the range.
        </dl>
      <li><tt>:</tt> (inclusive range)
      <dl>
      <dd>The inclusive range operator is also a binary operator and does
          include the arguments in the range.
      </dl>
    </ul>
</ul>

The <tt>port</tt> option is not usually used in <tt>nat</tt> rules because
the goal is usually to NAT all traffic regardless of the port(s) being used.

<dt><tt><i>dst_addr</i></tt>
<dd>The destination address of packets to be translated.
    The destination address is specified in the same way as the source address.

<dt><tt><i>dst_port</i></tt>
<dd>The destination port in the Layer 4 packet header.
    This port is specified in the same way as the source port.

<dt><tt><i>ext_addr</i></tt>
<dd>The external (translation) address on the NAT gateway that packets
    will be translated to.
    The external address can be specified as:
    <ul>
      <li>A single IPv4 or IPv6 address.
      <li>A <a href="https://web.archive.org/web/20150611113606/http://public.swbell.net/dedicated/cidr.html">CIDR</a>
          network block.
      <li>A fully qualified domain name that will be resolved via DNS when the
          ruleset is loaded.
      <li>The name or group of the external network interface.
          Any IP addresses assigned to the interface will be substituted into
          the rule at load time.
      <li>The name or group of the external network interface in parentheses
          <tt>( )</tt>.
          This tells PF to update the rule if the IP address(es) on the named
          interface changes.
          This is highly useful when the external interface gets its IP address
          via DHCP or dial-up, as the ruleset doesn't have to be reloaded each
          time the address changes.
      <li>The name or group of a network interface followed by either one of
          these modifiers:
        <ul>
          <li><tt>:network</tt> - substitutes the CIDR network block (e.g.,
              192.168.0.0/24)
          <li><tt>:peer</tt> - substitutes the peer's IP address on a
              point-to-point link
        </ul>
        <dl>
        <dd>In addition, the <tt>:0</tt> modifier can be appended to either an
            interface name/group or to any of the above modifiers to indicate
            that PF should not include aliased IP addresses in the substitution.
            These modifiers can also be used when the interface is contained in
            parentheses.
            Example: <tt>fxp0:network:0</tt>
        </dl>
          <li>A set of addresses using a <a href="macros.html#lists">list</a>.
    </ul>

<dt><tt><i>pool_type</i></tt>
<dd>Specifies the type of <a href="pools.html">address pool</a> to use
    for translation.

<dt><tt>static-port</tt>
<dd>Tells PF not to translate the source port in TCP and UDP packets.

</dl>

<p>
This would lead to a most basic form of these lines similar to this:

<blockquote><pre>
match out on tl0 from 192.168.1.0/24 to any nat-to 198.51.100.1
pass on tl0 from 192.168.1.0/24 to any
</pre></blockquote>

Or you may simply use:

<blockquote><pre>
pass out on tl0 from 192.168.1.0/24 to any nat-to 198.51.100.1
</pre></blockquote>

This rule says to perform NAT on the <tt>tl0</tt> interface for any
packets coming from 192.168.1.0/24 and to replace the source IP address
with 198.51.100.1.

<p>
While the above rule is correct, it is not recommended form.
Maintenance could be difficult as any change of the external or internal
network numbers would require the line be changed.
Compare instead with this easier to maintain line (<tt>tl0</tt> is external,
<tt>dc0</tt> internal):

<blockquote><pre>
pass out on tl0 inet from dc0:network to any nat-to tl0
</pre></blockquote>

The advantage should be fairly clear: you can change the IP addresses of
either interface without changing this rule.
Note that <tt>inet</tt> should be specified in this case to ensure that
only IPv4 addresses are used, avoiding unexpected surprises.

<p>
When specifying an interface name for the translation address as above,
the IP address is determined at pf.conf <i>load</i> time, not on the fly.
If you are using DHCP to configure your external interface, this can be
a problem.
If your assigned IP address changes, NAT will continue translating outgoing
packets using the old IP address.
This will cause outgoing connections to stop functioning.
To get around this, you can tell PF to automatically update the translation
address by putting parentheses around the interface name:

<blockquote><pre>
pass out on tl0 inet from dc0:network to any nat-to (tl0)
</pre></blockquote>

This method works for translation to both IPv4 and IPv6 addresses.

<h2 id="binat">Bidirectional mapping (1:1 mapping)</h2>

A bidirectional mapping can be established by using the
<tt>binat-to</tt> parameter.
A <tt>binat-to</tt> rule establishes a one to one mapping between an internal
IP address and an external address.
This can be useful, for example, to provide a web server on the internal
network with its own external IP address.
Connections from the Internet to the external address will be translated to
the internal address and connections from the web server (such as DNS requests)
will be translated to the external address.
TCP and UDP ports are never modified with <tt>binat-to</tt> rules as they are
with <tt>nat</tt> rules.

<p>
Example:

<blockquote><pre>
web_serv_int = "192.168.1.100"
web_serv_ext = "198.51.100.6"

pass on tl0 from $web_serv_int to any binat-to $web_serv_ext
</pre></blockquote>

<h2 id="except">Translation rule exceptions</h2>

If you need to translate most traffic, but provide exceptions in some cases,
make sure that the exceptions are handled by a filter rule which does not
include the nat-to parameter.
For example, if the NAT example above was modified to look like this:

<blockquote><pre>
pass  out on tl0 from 192.168.1.0/24 to any nat-to 198.51.100.79
pass  out on tl0 from 192.168.1.208  to any
</pre></blockquote>

Then the entire 192.168.1.0/24 network would have its packets translated to
the external address 198.51.100.79 except for 192.168.1.208.

<h2 id="status">Checking NAT status</h2>

To view the active NAT translations,
<a href="https://man.openbsd.org/pfctl">pfctl(8)</a> is used with the
<tt>-s state</tt> option.
This option will list all the current NAT sessions:

<blockquote><pre>
# <b>pfctl -s state</b>
fxp0 tcp 192.168.1.35:2132 (198.51.100.1:53136) -&gt; 198.51.100.10:22 TIME_WAIT:TIME_WAIT
fxp0 udp 192.168.1.35:2491 (198.51.100.1:60527) -&gt; 198.51.100.33:53   MULTIPLE:SINGLE
</pre></blockquote>

Explanations (first line only):

<dl>
<dt>fxp0
<dd>Indicates the interface that the state is bound to.
    The word <tt>self</tt> will appear if the state is
    <a href="options.html#state-policy"><tt>floating</tt></a>.
</dl>

<dl>
<dt>TCP
<dd>The protocol being used by the connection.
</dl>

<dl>
<dt>192.168.1.35:2132
<dd>The IP address (192.168.1.35) of the machine on the internal network.
    The source port (2132) is shown after the address.
    This is also the address that is replaced in the IP header.
</dl>

<dl>
<dt>198.51.100.1:53136
<dd>The IP address (198.51.100.1) and port (53136) on the gateway that
    packets are being translated to.
</dl>

<dl>
<dt>198.51.100.10:22
<dd>The IP address (198.51.100.10) and the port (22) that the internal
    machine is connecting to.
</dl>

<dl>

<dt>TIME_WAIT:TIME_WAIT
<dd>This indicates what state PF believes the TCP connection to be in.
</dl>

<p>
</body>
</html>
@


1.69
log
@tls on openbsd.org is now real:
- link to https://www.openbsd.org from the sub-projects' pages
- make internal links relative
- switch link rel=canonical to https to please some search engines
"go ahead" from beck, "do it!!!!" tj
@
text
@d140 1
a140 1
<a href="http://man.openbsd.org/sysctl.3">sysctl(3)</a> mechanism:
d199 1
a199 1
    <a href="http://man.openbsd.org/pflogd">pflogd(8)</a>.
d264 1
a264 1
          <a href="http://man.openbsd.org/services">services(5)</a>
d439 1
a439 1
<a href="http://man.openbsd.org/pfctl">pfctl(8)</a> is used with the
@


1.68
log
@use <blockquote><pre> instead of just <blockquote>

patch from Vinicius Zavam, thanks!
@
text
@d13 1
a13 1
<link rel="canonical" href="http://www.openbsd.org/faq/pf/nat.html">
@


1.67
log
@partially revert previous: the pass logic was correct.
@
text
@d414 1
a414 1
<blockquote>
d419 1
a419 1
</blockquote>
@


1.66
log
@fix inverted pass/block logic and missing line break in nat example.

reported by petr topiarz
@
text
@d430 1
a430 1
block out on tl0 from 192.168.1.208  to any
@


1.65
log
@sync pf guide formatting with the main faq's style, fixing a few grammar
knits and broken links along the way.

input and ok tb
@
text
@d428 4
a431 4
<blockquote>
pass out on tl0 from 192.168.1.0/24 to any nat-to 198.51.100.79
pass out on tl0 from 192.168.1.208 to any
</blockquote>
@


1.64
log
@page titles and <title> should be the same.
@
text
@d4 5
a10 1
<meta name="description"   content="the OpenBSD FAQ page">
d47 7
a53 7
<li><a href="#intro" >Introduction</a>
<li><a href="#works" >How NAT Works</a>
<li><a href="#ipfwd" >IP Forwarding</a>
<li><a href="#config">Configuring NAT</a>
<li><a href="#binat" >Bidirectional Mapping (1:1 mapping)</a>
<li><a href="#except">Translation Rule Exceptions</a>
<li><a href="#status">Checking NAT Status</a>
d59 1
d61 5
a65 6
networks) to a single IP address.  NAT is necessary when the number of
IP addresses assigned to you by your Internet Service Provider is less
than the total number of computers that you wish to provide Internet
access for. NAT is described in
<a href="http://tools.ietf.org/html/rfc1631">RFC 1631</a>,
"The IP Network Address Translator (NAT)."
d68 2
a69 4
NAT allows you to take advantage of the reserved address blocks
described in
<a href="http://tools.ietf.org/html/rfc1918">RFC 1918</a>,
"Address Allocation for Private Internets."
d71 8
a78 6
these network blocks. They are:
<pre>
	10.0.0.0/8       (10.0.0.0 - 10.255.255.255)
	172.16.0.0/12    (172.16.0.0 - 172.31.255.255)
	192.168.0.0/16   (192.168.0.0 - 192.168.255.255)
</pre>
a79 1
<p>
d81 11
a91 3
to the Internet, the other to your internal network.  NAT will be
translating requests from the internal network so they appear to all be
coming from your OpenBSD NAT system.
a92 6
<h2 id="works">How NAT Works</h2>
<p>
When a client on the internal network contacts a machine on the
Internet, it sends out IP packets destined for that machine. These
packets contain all the addressing information necessary to get them to
their destination. NAT is concerned with these pieces of information:
d94 2
a95 2
<li>Source IP address (for example, 192.168.1.35)
<li>Source TCP or UDP port (for example, 2132)
d98 7
a104 7
<p>
When the packets pass through the NAT gateway they will be modified so
that they appear to be coming from the NAT gateway itself. The NAT
gateway will record the changes it makes in its state table so that it
can a) reverse the changes on return packets and b) ensure that return
packets are passed through the firewall and are not blocked. For example,
the following changes might be made:
d106 4
a109 4
<li>Source IP: replaced with the external address of the
gateway (for example, 198.51.100.1)
<li>Source port: replaced with a randomly chosen, unused port on the
gateway (for example, 53136)
a111 1
<p>
d113 4
a116 4
translation steps. To the internal machine, the NAT system is simply an
Internet gateway. To the Internet host, the packets appear to come
directly from the NAT system; it is completely unaware that the
internal workstation even exists.
d119 1
a119 1
When the Internet host replies to the internal machine's packets, they
d121 8
a128 7
translation port (53136). The NAT gateway will then search the state
table to determine if the reply packets match an already established
connection. A unique match will be found based on the IP/port
combination which tells PF the packets belong to a connection initiated
by the internal machine 192.168.1.35. PF will then make the opposite
changes it made to the outgoing packets and forward the reply packets on
to the internal machine.
d134 8
a141 11
<!-- legacy anchor; can eventually be removed -->
<a name="filter"></a>
<a name="enable"></a>
<h2 id="ipfwd">IP Forwarding</h2>
<p>
Since NAT is almost always used on routers and network gateways, it
will probably be necessary to enable IP forwarding so that packets can
travel between network interfaces on the OpenBSD machine.
IP forwarding is enabled using the 
<a href="http://man.openbsd.org/sysctl.3"
>sysctl(3)</a> mechanism:
d146 1
a146 1
<p>
d148 1
a148 1
<p>
d156 7
a162 8
NAT is specified as an optional <tt>nat-to</tt> parameter to an
outbound <tt>pass</tt> rule.
Often, rather than being set directly on the <tt>pass</tt> rule,
a <tt>match</tt> rule is used.
When a packet is selected by a <tt>match</tt> rule, parameters
(e.g. <tt>nat-to</tt>) in that rule are remembered and are
applied to the packet when a <tt>pass</tt> rule matching the
packet is reached.
d164 3
a166 2
<tt>match</tt> rule and then specific decisions on whether to allow
the traffic can be made with <tt>block</tt> and <tt>pass</tt> rules.
d169 10
a178 11
<blockquote>
<tt>
match out on <i>interface</i> [<i>af</i>] \<br>
&nbsp;&nbsp;&nbsp;from <i>src_addr</i> to <i>dst_addr</i> \<br>
&nbsp;&nbsp;&nbsp;nat-to <i>ext_addr</i> [<i>pool_type</i>] [static-port]<br>
...<br>
pass out [log] on <i>interface</i> [<i>af</i>] [proto <i>protocol]</i> \<br>
&nbsp;&nbsp;&nbsp;from <i>ext_addr</i> [port <i>src_port</i>] \<br>
&nbsp;&nbsp;&nbsp;to <i>dst_addr</i> [port <i>dst_port</i>]
</tt>
</blockquote>
d183 2
a184 2
rule, any optional parameters specified in that rule are remembered
for future use (made "sticky").
d188 4
a191 4
If the packet was previously matched by a <tt>match</tt> rule where
parameters were specified, they will be applied to this packet.
<tt>pass</tt> rules may have their own parameters; these take
priority over parameters specified in a <tt>match</tt> rule.
d195 1
a195 1
<tt>nat-to</tt> may only be specified for outbound packets.
d199 3
a201 4
<a href="http://man.openbsd.org/pflogd.8"
>pflogd(8)</a>.
Normally only the first packet that matches will be logged.
To log all matching packets, use <tt>log (all)</tt>.
d208 3
a210 2
for IPv6. PF is usually able to determine this parameter based on the
source/destination address(es).
d214 2
a215 2
If <i>src_port</i> or <i>dst_port</i> is specified, the protocol
<em>must</em> also be given.
d219 38
a256 38
The source address can be specified as:
<ul>
<li>A single IPv4 or IPv6 address.
<li>A <a href="http://public.swbell.net/dedicated/cidr.html">CIDR</a> 
network block.
<li>A fully qualified domain name that will be resolved via DNS when the
ruleset is loaded. All resulting IP addresses will be substituted into
the rule.
<li>The name or group of a network interface.
Any IPv4 and IPv6 addresses assigned to the interface will be
substituted into the rule at load time.
<li>The name of a network interface followed by
<tt>/<i>netmask</i></tt> (e.g. <tt>/24</tt>). Each IP address on the
interface is combined with the netmask to form a CIDR network block
which is substituted into the rule.
<li>The name or group of a network interface followed by any one of these
modifiers: 
  <ul>
  <li><tt>:network</tt> - substitutes the CIDR network block (e.g.,
  192.168.0.0/24)
  <li><tt>:broadcast</tt> - substitutes the network broadcast address
  (e.g., 192.168.0.255)
  <li><tt>:peer</tt> - substitutes the peer's IP address on a
  point-to-point link
  </ul>
  <dl>
  <dd>In addition, the <tt>:0</tt> modifier can be appended to either an
  interface name/group or to any of the above modifiers to indicate that PF
  should not include aliased IP addresses in the substitution.
  These modifiers can also be used when the interface is contained in
  parentheses.
  Example: <tt>fxp0:network:0</tt>
  </dl>
<li>A <a href="tables.html">table</a>.
<li>Any of the above but negated using the <tt>!</tt> ("not") modifier.
<li>A set of addresses using a <a href="macros.html#lists">list</a>.
<li>The keyword <tt>any</tt> meaning all addresses
</ul>
d259 26
a284 27
<dd>The source port in the Layer 4 packet header. Ports can be specified
as:
<ul>
<li>A number between 1 and 65535
<li>A valid service name from
<a href="http://man.openbsd.org/services.5"
><tt>/etc/services</tt></a>
<li>A set of ports using a <a href="macros.html#lists">list</a>
<li>A range:
	<ul>
	<li><tt>!=</tt> (not equal)
	<li><tt>&lt;</tt> (less than)
	<li><tt>&gt;</tt> (greater than)
	<li><tt>&lt;=</tt> (less than or equal)
	<li><tt>&gt;=</tt> (greater than or equal)
	<li><tt>&gt;&lt;</tt> (range)
	<li><tt>&lt;&gt;</tt> (inverse range)
	<dl>
	<dd>The last two are binary operators (they take two arguments) and
	do not include the arguments in the range.
	</dl>
	<li><tt>:</tt> (inclusive range)
	<dl>
	<dd>The inclusive range operator is also a binary operator and does
	include the arguments in the range.
	</dl>
	</ul>
d286 3
a288 3
The <tt>port</tt> option is not usually used in <tt>nat</tt> rules
because the goal is usually to NAT all traffic regardless of the port(s)
being used.
d291 2
a292 2
<dd>The destination address of packets to be translated. The destination
address is specified in the same way as the source address.
d295 2
a296 2
<dd>The destination port in the Layer 4 packet header. This port is
specified in the same way as the source port.
d300 36
a335 32
will be translated to. The external address can be specified as:
<ul>
<li>A single IPv4 or IPv6 address.
<li>A <a href="http://public.swbell.net/dedicated/cidr.html">CIDR</a> 
network block.
<li>A fully qualified domain name that will be resolved via DNS when the
ruleset is loaded.
<li>The name or group of the external network interface. Any IP addresses assigned
to the interface will be substituted into the rule at load time.
<li>The name or group of the external network interface in parentheses 
<tt>( )</tt>. This tells PF to update the rule if the IP address(es) on
the named interface changes. This is highly useful when the external
interface gets its IP address via DHCP or dial-up as the ruleset
doesn't have to be reloaded each time the address changes.
<li>The name or group of a network interface followed by either one of these
modifiers: 
  <ul>
  <li><tt>:network</tt> - substitutes the CIDR network block (e.g.,
  192.168.0.0/24)
  <li><tt>:peer</tt> - substitutes the peer's IP address on a
  point-to-point link
  </ul>
  <dl>
  <dd>In addition, the <tt>:0</tt> modifier can be appended to either an
  interface name/group or to any of the above modifiers to indicate that PF
  should not include aliased IP addresses in the substitution.
  These modifiers can also be used when the interface is contained in
  parentheses.
  Example: <tt>fxp0:network:0</tt>
  </dl>
<li>A set of addresses using a <a href="macros.html#lists">list</a>.
</ul>
d339 1
a339 1
for translation.
d348 3
a350 3
<blockquote>
<tt>
match out on tl0 from 192.168.1.0/24 to any nat-to 198.51.100.1<br>
d352 2
a353 2
</tt>
</blockquote>
d355 2
a356 2
<blockquote>
<tt>
d358 1
a358 2
</tt>
</blockquote>
a359 1
<p>
d367 5
a371 5
network numbers would require the line be changed.  Compare instead with
this easier to maintain line (<tt>tl0</tt> is external, <tt>dc0</tt>
internal):
<blockquote>
<tt>
d373 1
a373 2
</tt>
</blockquote>
a374 1
<p>
d382 10
a391 9
the IP address is determined at pf.conf <i>load</i> time, not on the
fly.  If you are using DHCP to configure your external interface, this
can be a problem. If your assigned IP address changes, NAT will
continue translating outgoing packets using the old IP address. This
will cause outgoing connections to stop functioning. To get around this,
you can tell PF to automatically update the translation address by
putting parentheses around the interface name:
<blockquote>
<tt>
d393 1
a393 2
</tt>
</blockquote>
a394 1
<p>
d397 2
a398 1
<h2 id="binat">Bidirectional Mapping (1:1 mapping)</h2>
d401 9
a409 10
A <tt>binat-to</tt> rule establishes a one to one mapping between
an internal IP address and an external address.
This can be useful, for example, to provide a web server on
the internal network with its own external IP address.
Connections from the Internet to the external address will
be translated to the internal address and connections from
the web server (such as DNS requests) will be translated
to the external address.
TCP and UDP ports are never modified with <tt>binat-to</tt>
rules as they are with <tt>nat</tt> rules.
d413 1
d415 4
a418 6
<tt>
web_serv_int = "192.168.1.100"<br>
web_serv_ext = "198.51.100.6"<br>
<br>
pass on tl0 from $web_serv_int to any binat-to $web_serv_ext<br>
</tt>
d421 1
a421 1
<h2 id="except">Translation Rule Exceptions</h2>
d423 3
a425 3
If you need to translate most traffic, but provide exceptions in
some cases, make sure that the exceptions are handled by a filter rule
which does not include the nat-to parameter.
d429 2
a430 4
<tt>
pass out on tl0 from 192.168.1.0/24 to any nat-to 198.51.100.79<br>
pass out on tl0 from 192.168.1.208 to any<br>
</tt>
d433 4
a436 3
<p>
Then the entire 192.168.1.0/24 network would have its packets
translated to the external address 198.51.100.79 except for 192.168.1.208.
d438 10
a447 11
<h2 id="status">Checking NAT Status</h2>
To view the active NAT translations
<a href="http://man.openbsd.org/pfctl.8"
>pfctl(8)</a> is used with the <tt>-s state</tt> option. This option will list
all the current NAT sessions:

<pre>
   # pfctl -s state
   fxp0 tcp 192.168.1.35:2132 (198.51.100.1:53136) -&gt; 198.51.100.10:22 TIME_WAIT:TIME_WAIT
   fxp0 udp 192.168.1.35:2491 (198.51.100.1:60527) -&gt; 198.51.100.33:53   MULTIPLE:SINGLE
</pre>
a448 1
<p>
d453 3
a455 3
<dd>Indicates the interface that the state is bound to. The word
<tt>self</tt> will appear if the state is 
<a href="options.html#state-policy"><tt>floating</tt></a>.
d465 3
a467 3
<dd>The IP address (192.168.1.35) of the machine on the internal
network. The source port (2132) is shown after the address. This is also
the address that is replaced in the IP header.
d473 1
a473 1
packets are being translated to.
d479 1
a479 1
machine is connecting to.
@


1.63
log
@tweak [faq index] button and sync the pf user's guide with that style.
@
text
@d4 1
a4 1
<title>PF - Network Address Translation (NAT)</title>
d35 1
a35 1
<font color="#e00000">PF - Network Address Translation (NAT)</font>
@


1.62
log
@use short form man links in the faq and fix a few broken links
@
text
@a30 2
<!-- Passes validator.w3.org, please keep it this way;
please, use a max of 72 chars per line -->
d36 3
a40 5
<p>
[<a href="index.html">Contents</a>]
[<a href="filter.html">Previous: Packet Filtering</a>]
[<a href="rdr.html">Next: Traffic Redirection (Port Forwarding)</a>]
<p>
a41 1
<h3>Table of Contents</h3>
d43 3
a45 3
<li><a href="#intro">Introduction</a>
<li><a href="#works">How NAT Works</a>
<li><a href="#ipfwd">IP Forwarding</a>
d47 1
a47 1
<li><a href="#binat">Bidirectional Mapping (1:1 mapping)</a>
a491 5

<p>
[<a href="filter.html">Previous: Packet Filtering</a>]
[<a href="index.html">Contents</a>]
[<a href="rdr.html">Next: Traffic Redirection (Port Forwarding)</a>]
@


1.61
log
@new openbsd faq style. joint with tj and validator.w3.org
@
text
@d143 1
a143 1
<a href="http://man.openbsd.org/?query=sysctl&amp;sektion=3"
d203 1
a203 1
<a href="http://man.openbsd.org/?query=pflogd&amp;sektion=8"
d268 1
a268 1
<a href="http://man.openbsd.org/?query=services&amp;sektion=5"
d448 1
a448 1
<a href="http://man.openbsd.org/?query=pfctl&amp;sektion=8"
@


1.60
log
@add a small sprinkling of css to improve readability in the faq, ok tj@@ tb@@
@
text
@d4 1
a4 1
<title>PF: Network Address Translation (NAT)</title>
d34 1
d36 4
a39 2
<img alt="[OpenBSD]" height=30 width=141 src="../../images/smalltitle.gif" border="0">
</a>
d41 1
a42 1
[<a href="index.html">Contents</a>]
a43 1

a44 3
<h1><font color="#e00000">PF: Network Address Translation (NAT)</font></h1>

<hr>
@


1.59
log
@fix URIs, the / before querystring is not optional,
if not fixed up by browsers the server returns 400 Bad Request.
@
text
@d7 2
@


1.58
log
@change http://www.openbsd.org/cgi-bin/man.cgi to be http://man.openbsd.org
this points stuff to the new place and gets us ready to deprecate the old
place we did this.
@
text
@d142 1
a142 1
<a href="http://man.openbsd.org?query=sysctl&amp;sektion=3"
d202 1
a202 1
<a href="http://man.openbsd.org?query=pflogd&amp;sektion=8"
d267 1
a267 1
<a href="http://man.openbsd.org?query=services&amp;sektion=5"
d447 1
a447 1
<a href="http://man.openbsd.org?query=pfctl&amp;sektion=8"
@


1.57
log
@TJ's work on the FAQ continues, this time a big diff with lots of small
fixes:

- only specify the current supported "set debug" choices in the options
  section of the pf faq
- clarify ipv4 vs ipv6 configs in the nat section of the pf faq
- mention that usb disk images are available in addition to the cd isos
- don't say that all donors get their name on the donations page anymore
- replace the last few instances of "ftp mirrors" with "http mirrors" or
  just "mirrors" where appropriate
- reword some 5.8 mentions to reduce the amount of version bumps we have
  to do each release
- few minor tweaks

Thanks!
@
text
@d142 1
a142 1
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=sysctl&amp;sektion=3"
d202 1
a202 1
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=pflogd&amp;sektion=8"
d267 1
a267 1
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=services&amp;sektion=5"
d447 1
a447 1
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=pfctl&amp;sektion=8"
@


1.56
log
@
rev for 5.8, mostly removing manpath part of man page urls
@
text
@d144 4
a147 7
<blockquote>
<tt>
# sysctl net.inet.ip.forwarding=1<br>
# sysctl net.inet6.ip6.forwarding=1 <i>(if using IPv6)</i>
</tt>
</blockquote>

d149 1
a149 10
To make this change permanent, the following lines should be added to
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=sysctl.conf&amp;sektion=5"
><tt>/etc/sysctl.conf</tt></a>:
<blockquote>
<tt>
net.inet.ip.forwarding=1<br>
net.inet6.ip6.forwarding=1
</tt>
</blockquote>

d151 4
a154 3
These lines are present but commented out (prefixed with a <tt>#</tt>)
in the default install. Remove the <tt>#</tt> and save the file. IP
forwarding will be enabled when the machine is rebooted.
d354 1
a354 1
or you may simply use
@


1.55
log
@The FAQ relates to the current OpenBSD release and 4.7 PF was a long time
ago, no need to talk about the NAT rewrite any more. De-confuses the page.
Pointed out by Michael McConville.
@
text
@d213 1
a213 1
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=pflogd&amp;sektion=8&amp;manpath=OpenBSD+5.7"
d458 1
a458 1
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=pfctl&amp;sektion=8&amp;manpath=OpenBSD+5.7"
@


1.54
log
@Clean up meta tags.

name=distribution, name=keywords, and name=resource-type have no effect
in modern search engines and just clutter up the page source.

From Pavel Plamenov.
@
text
@a167 3
<font color="#ff0000">NOTE:</font> This information is for OpenBSD 4.7.
NAT configuration was significantly different in earlier versions.
<p>
@


1.53
log
@Add 'link rel="canonical"' to pages, acting as a hint to search engines
to list the copies on www.openbsd.org rather than mirrors.

From Carlin Bingham, ok millert@@ nick@@
@
text
@a5 1
<meta name="resource-type" content="document">
a6 2
<meta name="keywords"      content="openbsd,faq,pf">
<meta name="distribution"  content="global">
@


1.52
log
@
updates for 5.7
@
text
@d10 1
@


1.51
log
@
5.5->5.6 which I forgot and Jonathan Thornburg (jthorn at astro dot
indiana dot edu) reminded me of, but also sent a diff for, thanks!
@
text
@d218 1
a218 1
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=pflogd&amp;sektion=8&amp;manpath=OpenBSD+5.6"
d463 1
a463 1
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=pfctl&amp;sektion=8&amp;manpath=OpenBSD+5.6"
@


1.50
log
@Convert the pf faq to use id="" instead of "a name=""></a>.
@
text
@d218 1
a218 1
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=pflogd&amp;sektion=8&amp;manpath=OpenBSD+5.5"
d463 1
a463 1
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=pfctl&amp;sektion=8&amp;manpath=OpenBSD+5.5"
@


1.49
log
@Switch example addresses to the prefixes reserved for documentation in rfc5737.
From Sevan Janiyan, nick@@ ok
@
text
@d60 1
a60 2
<a name="intro"></a>
<h2>Introduction</h2>
d88 1
a88 2
<a name="works"></a>
<h2>How NAT Works</h2>
d138 1
a138 2
<a name="ipfwd"></a>
<h2>IP Forwarding</h2>
d169 1
a169 2
<a name="config"></a>
<h2>Configuring NAT</h2>
d418 1
a418 2
<a name="binat"></a>
<h2>Bidirectional Mapping (1:1 mapping)</h2>
d443 1
a443 2
<a name="except"></a>
<h2>Translation Rule Exceptions</h2>
d461 1
a461 2
<a name="status"></a>
<h2>Checking NAT Status</h2>
@


1.48
log
@explicitly specify "inet" in various nat-to rules where it's ambiguous
(plus minor whitespace cleanup)
@
text
@d110 1
a110 1
gateway (for example, 24.5.0.5)
d124 1
a124 1
will be addressed to the NAT gateway's external IP (24.5.0.5) at the
d370 1
a370 1
match out on tl0 from 192.168.1.0/24 to any nat-to 24.5.0.5<br>
d377 1
a377 1
pass out on tl0 from 192.168.1.0/24 to any nat-to 24.5.0.5
d384 1
a384 1
with 24.5.0.5.
d442 1
a442 1
web_serv_ext = "24.5.0.6"<br>
d458 1
a458 1
pass out on tl0 from 192.168.1.0/24 to any nat-to 24.2.74.79<br>
d465 1
a465 1
translated to the external address 24.2.74.79 except for 192.168.1.208.
d476 2
a477 2
   fxp0 tcp 192.168.1.35:2132 (24.5.0.5:53136) -&gt; 65.42.33.245:22 TIME_WAIT:TIME_WAIT
   fxp0 udp 192.168.1.35:2491 (24.5.0.5:60527) -&gt; 24.2.68.33:53   MULTIPLE:SINGLE
d503 2
a504 2
<dt>24.5.0.5:53136
<dd>The IP address (24.5.0.5) and port (53136) on the gateway that
d509 2
a510 2
<dt>65.42.33.245:22
<dd>The IP address (65.42.33.245) and the port (22) that the internal
@


1.47
log
@
dead link, new link.  From peter dot de dot com, thanks!
@
text
@d251 2
a252 2
Any IP addresses assigned to the interface will be substituted into the
rule at load time.
d394 1
a394 1
pass out on tl0 from dc0:network to any nat-to tl0
d401 2
d415 1
a415 1
pass out on tl0 from dc0:network to any nat-to (tl0)
d527 1
a527 1
</html> 
@


1.46
log
@
update for 5.5
@
text
@d67 1
a67 1
<a href="http://www.geektools.com/rfc/rfc1631.txt">RFC 1631</a>,
d73 1
a73 1
<a href="http://www.geektools.com/rfc/rfc1918.txt">RFC 1918</a>,
@


1.45
log
@
www@@ removal, normalize footers.
@
text
@d222 1
a222 1
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=pflogd&amp;sektion=8&amp;manpath=OpenBSD+5.4"
d468 1
a468 1
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=pfctl&amp;sektion=8&amp;manpath=OpenBSD+5.4"
@


1.44
log
@
update for 5.4
@
text
@a4 1
<link rev="made" href="mailto:www@@openbsd.org">
a523 6
<hr>
<a href="index.html"><img height="24" width="24" src="../../images/back.gif" border="0" alt="[back]"></a> 
<a href="mailto:www@@openbsd.org">www@@openbsd.org</a>
<br>
<small>$OpenBSD: nat.html,v 1.43 2013/05/01 13:21:45 nick Exp $</small>

@


1.43
log
@
updates for 5.3
@
text
@d223 1
a223 1
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=pflogd&amp;sektion=8&amp;manpath=OpenBSD+5.3"
d469 1
a469 1
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=pfctl&amp;sektion=8&amp;manpath=OpenBSD+5.3"
d529 1
a529 1
<small>$OpenBSD: nat.html,v 1.42 2013/04/21 00:47:14 sthen Exp $</small>
@


1.42
log
@replace "adapters" with "interfaces", it makes more sense when you consider
vlans. prompted by a mail to misc from fekete at tormail.org
@
text
@d223 1
a223 1
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=pflogd&amp;sektion=8&amp;manpath=OpenBSD+5.2"
d469 1
a469 1
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=pfctl&amp;sektion=8&amp;manpath=OpenBSD+5.2"
d529 1
a529 1
<small>$OpenBSD: nat.html,v 1.41 2013/02/18 16:09:29 nick Exp $</small>
@


1.41
log
@
pacbell.net is gone, fortunately swbell.net provides almost the exact same
CIDR document.  pointed out by parranoya at gmail dot com.
@
text
@d85 1
a85 1
An OpenBSD system doing NAT will have at least two network adapters, one
d529 1
a529 1
<small>$OpenBSD: nat.html,v 1.40 2012/11/01 15:06:36 nick Exp $</small>
@


1.40
log
@
enter 5.2
@
text
@d246 1
a246 1
<li>A <a href="http://public.pacbell.net/dedicated/cidr.html">CIDR</a> 
d328 1
a328 1
<li>A <a href="http://public.pacbell.net/dedicated/cidr.html">CIDR</a> 
d529 1
a529 1
<small>$OpenBSD: nat.html,v 1.39 2012/08/17 00:49:57 nick Exp $</small>
@


1.39
log
@
mention interface groups, from Robert.
@
text
@d223 1
a223 1
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=pflogd&amp;sektion=8&amp;manpath=OpenBSD+5.1"
d469 1
a469 1
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=pfctl&amp;sektion=8&amp;manpath=OpenBSD+5.1"
d529 1
a529 1
<small>$OpenBSD: nat.html,v 1.38 2012/05/11 11:20:04 nick Exp $</small>
@


1.38
log
@
forgot to actually COMMIT these 5.1 changes.  *sigh*
@
text
@d332 1
a332 1
<li>The name of the external network interface. Any IP addresses assigned
d334 1
a334 1
<li>The name of the external network interface in parentheses 
d339 1
a339 1
<li>The name of a network interface followed by either one of these
d349 1
a349 1
  interface name or to any of the above modifiers to indicate that PF
d529 1
a529 1
<small>$OpenBSD: nat.html,v 1.37 2011/11/02 01:01:47 nick Exp $</small>
@


1.37
log
@
rev man page references to 5.0
@
text
@d223 1
a223 1
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=pflogd&amp;sektion=8&amp;manpath=OpenBSD+5.0"
d469 1
a469 1
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=pfctl&amp;sektion=8&amp;manpath=OpenBSD+5.0"
d529 1
a529 1
<small>$OpenBSD: nat.html,v 1.36 2011/06/28 08:33:49 jj Exp $</small>
@


1.36
log
@Fixes from Michal Mazurek
@
text
@d223 1
a223 1
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=pflogd&amp;sektion=8&amp;manpath=OpenBSD+4.9"
d469 1
a469 1
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=pfctl&amp;sektion=8&amp;manpath=OpenBSD+4.9"
d529 1
a529 1
<small>$OpenBSD: nat.html,v 1.35 2011/05/01 12:57:11 nick Exp $</small>
@


1.35
log
@
updates for 4.9
@
text
@d475 2
a476 2
   fxp0 TCP 192.168.1.35:2132 -&gt; 24.5.0.5:53136 -&gt; 65.42.33.245:22 TIME_WAIT:TIME_WAIT
   fxp0 UDP 192.168.1.35:2491 -&gt; 24.5.0.5:60527 -&gt; 24.2.68.33:53   MULTIPLE:SINGLE
d529 1
a529 1
<small>$OpenBSD: nat.html,v 1.34 2011/02/13 15:17:27 jj Exp $</small>
@


1.34
log
@Missing line breaks. ok sthen@@
@
text
@d223 1
a223 1
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=pflogd&amp;sektion=8&amp;manpath=OpenBSD+4.8"
d469 1
a469 1
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=pfctl&amp;sektion=8&amp;manpath=OpenBSD+4.8"
d529 1
a529 1
<small>$OpenBSD: nat.html,v 1.33 2010/11/01 09:53:51 nick Exp $</small>
@


1.33
log
@
update to 4.8
@
text
@d371 1
a371 1
match out on tl0 from 192.168.1.0/24 to any nat-to 24.5.0.5
d457 1
a457 1
pass out on tl0 from 192.168.1.0/24 to any nat-to 24.2.74.79
d529 1
a529 1
<small>$OpenBSD: nat.html,v 1.32 2010/05/19 13:25:16 sthen Exp $</small>
@


1.32
log
@Update the PF faq for 4.7 changes.
@
text
@d223 1
a223 1
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=pflogd&amp;sektion=8&amp;manpath=OpenBSD+4.7"
d469 1
a469 1
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=pfctl&amp;sektion=8&amp;manpath=OpenBSD+4.7"
d529 1
a529 1
<small>$OpenBSD: nat.html,v 1.31 2009/10/16 19:12:42 nick Exp $</small>
@


1.31
log
@
quick update for 4.6.  much more is needed, at least scrub.html is
currently dead wrong, so I've unlinked it from the rest for now.
@
text
@a51 1
<li><a href="#filter">NAT and Packet Filtering</a>
d138 1
a139 16
<h2>NAT and Packet Filtering</h2>
<p>
<font color="#ff0000">NOTE:</font> Translated packets must still pass
through the filter engine and will be blocked or passed based on the
filter rules that have been defined. 
The <i>only</i> exception to this rule is when the <tt>pass</tt> keyword
is used within the <tt>nat</tt> rule.
This will cause the NATed packets to pass right through the filtering
engine.

<p>
Also be aware that since translation occurs <i>before</i> filtering, the
filter engine will see the <i>translated</i> packet with the translated
IP address and port as outlined in <a href="#works">How NAT Works</a>.

<!-- legacy anchor; can eventually be removed -->
d175 17
a191 2
The general format for NAT rules in <tt>pf.conf</tt> looks
something like this:
d194 7
a200 4
nat [pass] [log] on <i>interface</i> [<i>af</i>] from <i>src_addr</i> 
[port <i>src_port</i>] to \<br>
&nbsp;&nbsp;&nbsp;<i>dst_addr</i> [port <i>dst_port</i>] -&gt; 
<i>ext_addr</i> [<i>pool_type</i>] [static-port]
d205 4
a208 2
<dt><tt>nat</tt>
<dd>The keyword that begins a NAT rule.
d211 9
a219 1
<dd>Causes translated packets to completely bypass the filter rules.
d223 1
a223 1
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=pflogd&amp;sektion=8&amp;manpath=OpenBSD+4.6"
d229 1
a229 1
<dd>The name or group of the network interface to translate packets on.
d236 5
d368 8
a375 1
This would lead to a most basic form of this line similar to this:
d378 1
a378 1
nat on tl0 from 192.168.1.0/24 to any -&gt; 24.5.0.5
d395 1
a395 1
nat on tl0 from dc0:network to any -&gt; tl0
d414 1
a414 1
nat on tl0 from dc0:network to any -&gt; (tl0)
d424 11
a434 9
<tt>binat</tt> rule. A <tt>binat</tt> rule establishes a one to one
mapping between an internal IP address and an external address. This can
be useful, for example, to provide a web server on the internal network
with its own external IP address. Connections from the Internet to the
external address will be translated to the internal address and
connections from the web server (such as DNS requests) will be
translated to the external address. TCP and UDP ports are never
modified with <tt>binat</tt> rules as they are with <tt>nat</tt>
rules.
d443 1
a443 1
binat on tl0 from $web_serv_int to any -&gt; $web_serv_ext<br>
d449 6
a454 3
Exceptions can be made to translation rules by using the <tt>no</tt>
keyword. For example, if the NAT example above was modified to look
like this:
d457 2
a458 2
no nat on tl0 from 192.168.1.208 to any<br>
nat on tl0 from 192.168.1.0/24 to any -&gt; 24.2.74.79
a465 5
<p>
Note that the first matching rule wins; if it's a <tt>no</tt> rule,
then the packet is not translated. The <tt>no</tt> keyword can also be
used with <tt>binat</tt> and <a href="rdr.html"><tt>rdr</tt></a> rules.

d469 1
a469 1
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=pfctl&amp;sektion=8&amp;manpath=OpenBSD+4.6"
d529 1
a529 1
<small>$OpenBSD: nat.html,v 1.30 2009/04/30 17:27:31 nick Exp $</small>
@


1.30
log
@
updates for 4.5
@
text
@d211 1
a211 1
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=pflogd&amp;sektion=8&amp;manpath=OpenBSD+4.5"
d445 1
a445 1
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=pfctl&amp;sektion=8&amp;manpath=OpenBSD+4.5"
d505 1
a505 1
<small>$OpenBSD: nat.html,v 1.29 2008/10/31 16:49:34 nick Exp $</small>
@


1.29
log
@
update numbers for 4.4
@
text
@d211 1
a211 1
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=pflogd&amp;sektion=8&amp;manpath=OpenBSD+4.4"
d445 1
a445 1
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=pfctl&amp;sektion=8&amp;manpath=OpenBSD+4.4"
d505 1
a505 1
<small>$OpenBSD: nat.html,v 1.28 2008/07/27 17:13:47 nick Exp $</small>
@


1.28
log
@
PF updates for 4.3..which got missed a few times.
@
text
@d211 1
a211 1
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=pflogd&amp;sektion=8&amp;manpath=OpenBSD+4.3"
d445 1
a445 1
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=pfctl&amp;sektion=8&amp;manpath=OpenBSD+4.3"
d505 1
a505 1
<small>$OpenBSD: nat.html,v 1.27 2007/11/01 02:57:56 joel Exp $</small>
@


1.27
log
@Updates for OpenBSD 4.2
@
text
@d211 1
a211 1
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=pflogd&amp;sektion=8&amp;manpath=OpenBSD+4.2"
d445 1
a445 1
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=pfctl&amp;sektion=8&amp;manpath=OpenBSD+4.2"
d505 1
a505 1
<small>$OpenBSD: nat.html,v 1.26 2007/05/06 18:59:54 nick Exp $</small>
@


1.26
log
@
manpath changes to:
  4.1 for PF related items
  removed for non-PF-related items, which will probably either not
    change much, or benefit from the newest, best man pages.
@
text
@d195 1
a195 1
nat [pass [log]] on <i>interface</i> [<i>af</i>] from <i>src_addr</i> 
d210 2
a211 2
<dd>When <tt>pass</tt> is specified, packets can be logged via
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=pflogd&amp;sektion=8&amp;manpath=OpenBSD+4.1"
d445 1
a445 1
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=pfctl&amp;sektion=8&amp;manpath=OpenBSD+4.1"
d505 1
a505 1
<small>$OpenBSD: nat.html,v 1.25 2006/11/01 01:56:01 joel Exp $</small>
@


1.25
log
@Updates for OpenBSD 4.0. uRPF, tftp-proxy, more ftp-proxy, etc.
Thanks to mcbride for the bits about interface groups
@
text
@d164 1
a164 1
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=sysctl&amp;sektion=3&amp;manpath=OpenBSD+4.0"
d175 1
a175 1
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=sysctl.conf&amp;sektion=5&amp;manpath=OpenBSD+4.0"
d211 1
a211 1
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=pflogd&amp;sektion=8&amp;manpath=OpenBSD+4.0"
d271 1
a271 1
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=services&amp;sektion=5&amp;manpath=OpenBSD+4.0"
d445 1
a445 1
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=pfctl&amp;sektion=8&amp;manpath=OpenBSD+4.0"
d505 1
a505 1
<small>$OpenBSD: nat.html,v 1.24 2006/10/27 19:26:13 nick Exp $</small>
@


1.24
log
@
"tweaks and fixes" from Jeremy Reed, via Joel@@.  Committed at request
of joel@@
@
text
@d164 1
a164 1
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=sysctl&amp;sektion=3&amp;manpath=OpenBSD+3.9"
d175 1
a175 1
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=sysctl.conf&amp;sektion=5&amp;manpath=OpenBSD+3.9"
d211 1
a211 1
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=pflogd&amp;sektion=8&amp;manpath=OpenBSD+3.9"
d217 1
a217 1
<dd>The name of the network interface to translate packets on.
d234 3
a236 2
<li>The name of a network interface. Any IP addresses assigned to the
interface will be substituted into the rule at load time.
d241 1
a241 1
<li>The name of a network interface followed by any one of these
d253 1
a253 1
  interface name or to any of the above modifiers to indicate that PF
d271 1
a271 1
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=services&amp;sektion=5&amp;manpath=OpenBSD+3.9"
d445 1
a445 1
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=pfctl&amp;sektion=8&amp;manpath=OpenBSD+3.9"
d505 1
a505 1
<small>$OpenBSD: nat.html,v 1.23 2006/05/01 00:54:29 nick Exp $</small>
@


1.23
log
@
3.9 updates, mostly rev'ing man page links
@
text
@d69 2
a70 1
<a href="http://www.geektools.com/rfc/rfc1631.txt">RFC 1631</a>.
d75 2
a76 1
<a href="http://www.geektools.com/rfc/rfc1918.txt">RFC 1918</a>.
d243 1
a243 1
  <li><tt>:network</tt> - substitues the CIDR network block (e.g.,
d247 1
a247 1
  <li><tt>:peer</tt> - substitues the peer's IP address on a
d253 1
a253 1
  should not include aliased IP addresses in the substituion.
d324 1
a324 1
  <li><tt>:network</tt> - substitues the CIDR network block (e.g.,
d326 1
a326 1
  <li><tt>:peer</tt> - substitues the peer's IP address on a
d332 1
a332 1
  should not include aliased IP addresses in the substituion.
d504 1
a504 1
<small>$OpenBSD: nat.html,v 1.22 2005/12/28 17:11:25 joel Exp $</small>
@


1.22
log
@Clarify how the "log" keyword works in 3.8 and onwards.
@
text
@d162 1
a162 1
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=sysctl&amp;sektion=3&amp;manpath=OpenBSD+3.8"
d173 1
a173 1
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=sysctl.conf&amp;sektion=5&amp;manpath=OpenBSD+3.8"
d209 1
a209 1
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=pflogd&amp;sektion=8&amp;manpath=OpenBSD+3.8"
d268 1
a268 1
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=services&amp;sektion=5&amp;manpath=OpenBSD+3.8"
d442 1
a442 1
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=pfctl&amp;sektion=8&amp;manpath=OpenBSD+3.8"
d502 1
a502 1
<small>$OpenBSD: nat.html,v 1.21 2005/11/01 11:35:18 nick Exp $</small>
@


1.21
log
@
bump manpath= tag for 3.8
@
text
@d193 1
a193 1
nat [pass] on <i>interface</i> [<i>af</i>] from <i>src_addr</i> 
d207 7
d502 1
a502 1
<small>$OpenBSD: nat.html,v 1.20 2005/05/20 00:12:02 joel Exp $</small>
@


1.20
log
@Updates for OpenBSD 3.7.
@
text
@d162 1
a162 1
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=sysctl&amp;sektion=3&amp;manpath=OpenBSD+3.7"
d173 1
a173 1
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=sysctl.conf&amp;sektion=5&amp;manpath=OpenBSD+3.7"
d261 1
a261 1
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=services&amp;sektion=5&amp;manpath=OpenBSD+3.7"
d435 1
a435 1
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=pfctl&amp;sektion=8&amp;manpath=OpenBSD+3.7"
d495 1
a495 1
<small>$OpenBSD: nat.html,v 1.19 2004/12/22 04:28:16 david Exp $</small>
@


1.19
log
@make small title logo a link back to main page; ok nick@@
@
text
@d162 1
a162 1
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=sysctl&amp;sektion=3&amp;manpath=OpenBSD+3.6"
d173 1
a173 1
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=sysctl.conf&amp;sektion=5&amp;manpath=OpenBSD+3.6"
d261 1
a261 1
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=services&amp;sektion=5&amp;manpath=OpenBSD+3.6"
d435 1
a435 1
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=pfctl&amp;sektion=8&amp;manpath=OpenBSD+3.6"
d495 1
a495 1
<small>$OpenBSD: nat.html,v 1.18 2004/11/01 21:41:07 nick Exp $</small>
@


1.18
log
@
3.6 content upgrades.  Directly from Joel Knight, jaredy@@ did the
anchors and nested anchors work, rest is by Joel.
@
text
@d35 3
a37 1
<img alt="[OpenBSD]" height=30 width=141 src="../../images/smalltitle.gif">
d495 1
a495 1
<small>$OpenBSD: nat.html,v 1.17 2004/10/29 17:22:57 nick Exp $</small>
@


1.17
log
@
Update for 3.6
@
text
@d416 1
a416 1
no nat on tl0 from 192.168.1.10 to any<br>
d423 1
a423 1
translated to the external address 24.2.74.79 except for 192.168.1.10.
d493 1
a493 1
<small>$OpenBSD: nat.html,v 1.16 2004/08/19 15:28:50 nick Exp $</small>
@


1.16
log
@
-w is optional for sysctl since 3.5 and no longer needed, and was
annoying, so remove from FAQ.
Thanks to krw@@, tom@@, jolan@@, jmc@@, jaredy@@ and probably 20 other
people whos messages will get to me after they clear spamd...
@
text
@d160 1
a160 1
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=sysctl&amp;sektion=3&amp;manpath=OpenBSD+3.5"
d171 1
a171 1
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=sysctl.conf&amp;sektion=5&amp;manpath=OpenBSD+3.5"
d259 1
a259 1
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=services&amp;sektion=5&amp;manpath=OpenBSD+3.5"
d433 1
a433 1
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=pfctl&amp;sektion=8&amp;manpath=OpenBSD+3.5"
d493 1
a493 1
<small>$OpenBSD: nat.html,v 1.15 2004/05/07 01:55:23 nick Exp $</small>
@


1.15
log
@
Add an OpenBSD license to the PF User's Guide.
Concept and breakdown of copyrights agreed to by Joel Knight and myself,
license assistance millert@@, ok deraadt@@.
@
text
@d164 2
a165 2
# sysctl -w net.inet.ip.forwarding=1<br>
# sysctl -w net.inet6.ip6.forwarding=1 <i>(if using IPv6)</i>
d493 1
a493 1
<small>$OpenBSD: nat.html,v 1.14 2004/04/30 18:00:25 nick Exp $</small>
@


1.14
log
@
PF User's Guide updates for OpenBSD 3.5.
Work done by Joel Knight (enabled et myrealbox.dit com), many, many thanks
to him for providing and maintaining some darned good docs.
@
text
@a10 1
<meta name="copyright"     content="This document copyright 2002-2004 by OpenBSD.">
d13 18
d493 1
a493 1
<small>$OpenBSD: nat.html,v 1.13 2004/01/01 04:16:17 nick Exp $</small>
@


1.13
log
@
Bump copyright to 2004
@
text
@d143 1
a143 1
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=sysctl&amp;sektion=3&amp;manpath=OpenBSD+3.4"
d154 1
a154 1
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=sysctl.conf&amp;sektion=5&amp;manpath=OpenBSD+3.4"
d212 18
a229 3
<li>The name of a network interface followed by the <tt>:network</tt>
keyword. The resulting CIDR network (e.g. 192.168.0.0/24) will be
substituted into the rule when the ruleset is loaded.
d242 1
a242 1
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=services&amp;sektion=5&amp;manpath=OpenBSD+3.4"
a253 1
	</ul>
d258 6
d293 16
a308 3
<li>The name of a network interface followed by the <tt>:network</tt>
keyword. The resulting CIDR network (e.g. 192.168.0.0/24) will be
substituted into the rule when the ruleset is loaded.
d342 1
a342 1
nat on tl0 from dc0/24 to any -&gt; tl0
d354 1
a354 1
can be a problem. If your assigned IP address changes then NAT will
d361 1
a361 1
nat on tl0 from dc0/24 to any -&gt; (tl0)
d366 1
a366 2
There is one major limitation to doing this: Only the first IP alias on
an interface is evaluated when the interface name is placed in parentheses.
d416 1
a416 1
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=pfctl&amp;sektion=8&amp;manpath=OpenBSD+3.4"
d422 2
a423 2
   TCP 192.168.1.35:2132 -&gt; 24.5.0.5:53136 -&gt; 65.42.33.245:22 TIME_WAIT:TIME_WAIT
   UDP 192.168.1.35:2491 -&gt; 24.5.0.5:60527 -&gt; 24.2.68.33:53   MULTIPLE:SINGLE
d430 7
d476 1
a476 1
<small>$OpenBSD: nat.html,v 1.12 2003/11/27 15:08:25 nick Exp $</small>
@


1.12
log
@
Major update to the PF FAQ from "Mr. PF FAQ", Joel Knight.  THANKS!
@
text
@d11 1
a11 1
<meta name="copyright"     content="This document copyright 2002-2003 by OpenBSD.">
d437 1
a437 1
<small>$OpenBSD: nat.html,v 1.11 2003/11/09 23:29:02 nick Exp $</small>
@


1.11
log
@
Update of PF User's Guide to 3.4.  Ok, really just pointing the man page
links at the 3.4-release man pages rather than the 3.3-release man pages.
Work by Joel Knight.
@
text
@d20 1
a20 1
[<a href="queueing.html">Previous: Queueing</a>]
d22 1
a22 1
[<a href="rdr.html">Next: Traffic Redirection</a>]
d33 2
a34 1
<li><a href="#enable">Enabling NAT</a>
d118 17
d136 2
a137 1
<h2>Enabling NAT</h2>
d139 6
a144 3
To enable NAT on an OpenBSD gateway, in addition to 
<a href="config.html#activate">activating PF</a>, you must also enable
IP forwarding:
d170 1
a170 1
The general format for NAT rules in <tt>/etc/pf.conf</tt> looks
d174 1
a174 1
nat on <i>extif</i> [<i>af</i>] from <i>src_addr</i> 
d177 1
a177 1
<i>ext_addr</i>
d182 8
a189 2
<dt><tt><i>extif</i></tt>
<dd>The name of the external network interface.
d279 7
d428 1
a428 1
[<a href="queueing.html">Previous: Queueing</a>]
d430 1
a430 1
[<a href="rdr.html">Next: Traffic Redirection</a>]
d437 1
a437 1
<small>$OpenBSD: nat.html,v 1.10 2003/09/27 16:00:20 horacio Exp $</small>
@


1.10
log
@first opened tag, last closed
ok nick@@
@
text
@d132 1
a132 1
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=sysctl.conf&amp;sektion=5&amp;manpath=OpenBSD+3.3"
d199 1
a199 1
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=services&amp;sektion=5&amp;manpath=OpenBSD+3.3"
d349 1
a349 1
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=pfctl&amp;sektion=8&amp;manpath=OpenBSD+3.3"
d402 1
a402 1
<small>$OpenBSD: nat.html,v 1.9 2003/09/22 02:29:03 nick Exp $</small>
@


1.9
log
@
From Joel Knight: changes formatting so that all keywords are
in <i>, all literals are in <tt>, etc.  Excess man page links removed.
No words were changed.
@
text
@d181 1
a181 1
<tt>/<i>netmask</tt></i> (e.g. <tt>/24</tt>). Each IP address on the
d402 1
a402 1
<small>$OpenBSD: nat.html,v 1.8 2003/09/16 01:23:49 nick Exp $</small>
@


1.8
log
@
Grammar and punctuation clean up, from Joel Knight.
Only a very few words changed.
@
text
@d181 1
a181 1
<i><tt>/netmask</tt></i> (e.g. <tt>/24</tt>). Each IP address on the
d402 1
a402 1
<small>$OpenBSD: nat.html,v 1.7 2003/06/16 22:17:00 david Exp $</small>
@


1.7
log
@fix grammatical error reported by david l goodrich <dlg@@iastate.edu>
ok nick@@
@
text
@d286 1
a286 1
can be a problem: if your assigned IP address changes then NAT will
d298 1
a298 1
There is one major limitation to doing this: only the first IP alias on
d342 1
a342 1
Note that the first matching rule wins -- if it's a <tt>no</tt> rule
d402 1
a402 1
<small>$OpenBSD: nat.html,v 1.6 2003/06/13 02:54:08 nick Exp $</small>
@


1.6
log
@
Improved wrapping of man page links, renders better on some browsers.
No words altered.  From Joel Knight.
@
text
@d219 1
a219 1
being using.
d402 1
a402 1
<small>$OpenBSD: nat.html,v 1.5 2003/06/04 22:39:33 margarida Exp $</small>
@


1.5
log
@i.e. -> e.g.
From pmsac <pmsac@@toxyn.org>
(Chato, minucioso e boa pessoa)
@
text
@d132 2
a133 2
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=sysctl.conf&amp;sektion=5&amp;manpath=OpenBSD+3.3">
<tt>/etc/sysctl.conf</tt></a>:
d199 2
a200 2
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=services&amp;sektion=5&amp;manpath=OpenBSD+3.3">
<tt>/etc/services</tt></a>
d349 2
a350 2
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=pfctl&amp;sektion=8&amp;manpath=OpenBSD+3.3">
pfctl(8)</a> is used with the <tt>-s state</tt> option. This option will list
d402 1
a402 1
<small>$OpenBSD: nat.html,v 1.4 2003/05/25 01:35:07 nick Exp $</small>
@


1.4
log
@
Various wording and punctuation improvements, by Joel Knight.
@
text
@d181 1
a181 1
<i><tt>/netmask</tt></i> (i.e. <tt>/24</tt>). Each IP address on the
d185 1
a185 1
keyword. The resulting CIDR network (i.e. 192.168.0.0/24) will be
d246 1
a246 1
keyword. The resulting CIDR network (i.e. 192.168.0.0/24) will be
d402 1
a402 1
<small>$OpenBSD: nat.html,v 1.3 2003/05/15 03:03:54 nick Exp $</small>
@


1.3
log
@
Table of Contents now on each page.  Work by Joel Knight (yay! Joel! 8-).
@
text
@d176 2
a177 1
ruleset is loaded.
d180 4
a183 2
<li>The name of a network interface followed by a netmask. The resulting
CIDR network block will be substituted into the rule at load time.
d185 1
a185 1
keyword. The resulting CIDR network (ie 192.168.0.0/24) will be
d187 1
d246 1
a246 1
keyword. The resulting CIDR network (ie 192.168.0.0/24) will be
d402 1
a402 1
<small>$OpenBSD: nat.html,v 1.2 2003/05/01 14:20:37 nick Exp $</small>
@


1.2
log
@
ARGH!  no, it is "ruleset", not "rule set".  Pointed out by Margarida@@
@
text
@d29 15
a43 1
<p>
d398 1
a398 1
<small>$OpenBSD: nat.html,v 1.1 2003/05/01 01:46:06 nick Exp $</small>
@


1.1
log
@
The long awaited, new PF FAQ!
Most of it written by Joel Knight >enabled at myrealbox dot com<,
some parts by me, a few parts yanked out of the old PF FAQ.
GREAT work, Joel!
@
text
@d162 1
a162 1
rule set is loaded.
d169 1
a169 1
substituted into the rule when the rule set is loaded.
d219 1
a219 1
rule set is loaded.
d225 1
a225 1
interface gets its IP address via DHCP or dial-up as the rule set
d229 1
a229 1
substituted into the rule when the rule set is loaded.
d384 1
a384 1
<small>$OpenBSD$</small>
@

