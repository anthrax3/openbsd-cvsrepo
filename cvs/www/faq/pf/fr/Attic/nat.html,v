head	1.41;
access;
symbols;
locks; strict;
comment	@# @;


1.41
date	2014.04.01.17.14.10;	author nick;	state dead;
branches;
next	1.40;

1.40
date	2013.11.01.18.04.05;	author ajacoutot;	state Exp;
branches;
next	1.39;

1.39
date	2013.05.07.12.47.22;	author ajacoutot;	state Exp;
branches;
next	1.38;

1.38
date	2013.04.26.13.06.05;	author ajacoutot;	state Exp;
branches;
next	1.37;

1.37
date	2013.02.22.07.53.37;	author ajacoutot;	state Exp;
branches;
next	1.36;

1.36
date	2012.11.02.07.24.05;	author ajacoutot;	state Exp;
branches;
next	1.35;

1.35
date	2012.08.17.06.29.34;	author ajacoutot;	state Exp;
branches;
next	1.34;

1.34
date	2012.05.19.22.52.00;	author ajacoutot;	state Exp;
branches;
next	1.33;

1.33
date	2012.05.13.16.30.18;	author ajacoutot;	state Exp;
branches;
next	1.32;

1.32
date	2011.11.05.12.45.49;	author ajacoutot;	state Exp;
branches;
next	1.31;

1.31
date	2011.07.04.15.54.49;	author ajacoutot;	state Exp;
branches;
next	1.30;

1.30
date	2011.05.07.08.22.01;	author ajacoutot;	state Exp;
branches;
next	1.29;

1.29
date	2011.02.20.10.08.24;	author ajacoutot;	state Exp;
branches;
next	1.28;

1.28
date	2010.11.09.08.15.21;	author ajacoutot;	state Exp;
branches;
next	1.27;

1.27
date	2010.10.03.15.11.11;	author ajacoutot;	state Exp;
branches;
next	1.26;

1.26
date	2009.10.20.20.44.42;	author ajacoutot;	state Exp;
branches;
next	1.25;

1.25
date	2009.05.01.13.16.23;	author tobias;	state Exp;
branches;
next	1.24;

1.24
date	2008.12.01.07.52.52;	author tobias;	state Exp;
branches;
next	1.23;

1.23
date	2008.08.25.14.21.24;	author tobias;	state Exp;
branches;
next	1.22;

1.22
date	2008.01.13.13.43.35;	author tobias;	state Exp;
branches;
next	1.21;

1.21
date	2007.05.09.05.49.53;	author jufi;	state Exp;
branches;
next	1.20;

1.20
date	2007.02.11.08.22.01;	author saad;	state Exp;
branches;
next	1.19;

1.19
date	2006.11.22.15.14.07;	author saad;	state Exp;
branches;
next	1.18;

1.18
date	2006.10.29.10.58.52;	author jufi;	state Exp;
branches;
next	1.17;

1.17
date	2006.05.02.17.09.33;	author jufi;	state Exp;
branches;
next	1.16;

1.16
date	2006.04.21.09.28.54;	author jufi;	state Exp;
branches;
next	1.15;

1.15
date	2006.03.10.16.35.07;	author saad;	state Exp;
branches;
next	1.14;

1.14
date	2005.12.31.00.54.37;	author saad;	state Exp;
branches;
next	1.13;

1.13
date	2005.11.03.11.30.53;	author saad;	state Exp;
branches;
next	1.12;

1.12
date	2005.07.28.09.54.34;	author saad;	state Exp;
branches;
next	1.11;

1.11
date	2005.05.22.17.38.07;	author saad;	state Exp;
branches;
next	1.10;

1.10
date	2005.01.18.09.54.52;	author jufi;	state Exp;
branches;
next	1.9;

1.9
date	2004.12.29.10.38.26;	author saad;	state Exp;
branches;
next	1.8;

1.8
date	2004.11.03.21.01.25;	author saad;	state Exp;
branches;
next	1.7;

1.7
date	2004.11.01.02.56.30;	author saad;	state Exp;
branches;
next	1.6;

1.6
date	2004.10.13.14.44.30;	author jufi;	state Exp;
branches;
next	1.5;

1.5
date	2004.10.12.07.18.41;	author jufi;	state Exp;
branches;
next	1.4;

1.4
date	2004.10.11.16.17.48;	author jufi;	state Exp;
branches;
next	1.3;

1.3
date	2004.10.07.10.24.20;	author jufi;	state Exp;
branches;
next	1.2;

1.2
date	2004.08.26.15.19.52;	author jufi;	state Exp;
branches;
next	1.1;

1.1
date	2004.05.31.21.12.02;	author saad;	state Exp;
branches;
next	;


desc
@@


1.41
log
@
Abandon translations, per deraadt@@ and ajacoutot@@.
@
text
@<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<html>
<head>
<title>PF : Traduction des Adresses IP (&quot;NAT&quot;)</title>
<link rev="made" href="mailto:www@@openbsd.org">
<meta http-equiv="Content-Type" content="text/html; charset=ISO-8859-1">
<meta name="resource-type" content="document">
<meta name="description"   content="the OpenBSD FAQ page">
<meta name="keywords"      content="openbsd,faq,pf">
<meta name="distribution"  content="global">
</head>

<!--
Copyright (c) 2003, Nick Holland <nick@@openbsd.org>
Copyright (c) 2003, 2004, Joel Knight <enabled@@myrealbox.com>

Permission to use, copy, modify, and distribute this documentation for
any purpose with or without fee is hereby granted, provided that the
above copyright notice and this permission notice appear in all copies.

THE DOCUMENTATION IS PROVIDED "AS IS" AND THE AUTHOR DISCLAIMS ALL
WARRANTIES WITH REGARD TO THIS DOCUMENTATION INCLUDING ALL IMPLIED
WARRANTIES OF MERCHANTABILITY AND FITNESS. IN NO EVENT SHALL THE
AUTHOR BE LIABLE FOR ANY SPECIAL, DIRECT, INDIRECT, OR CONSEQUENTIAL
DAMAGES OR ANY DAMAGES WHATSOEVER RESULTING FROM LOSS OF USE, DATA OR
PROFITS, WHETHER IN AN ACTION OF CONTRACT, NEGLIGENCE OR OTHER
TORTIOUS ACTION, ARISING OUT OF OR IN CONNECTION WITH THE USE OR
PERFORMANCE OF THIS DOCUMENTATION
-->

<body bgcolor="#ffffff" text="#000000">
<!-- Passes validator.w3.org, please keep it this way;
please, use a max of 72 chars per line -->

<a href="../../../fr/index.html">
<img alt="[OpenBSD]" height="30" width="141" src="../../../images/smalltitle.gif" border="0">
</a>
<p>
[<a href="filter.html">Précédent : Filtrage de Paquets</a>]
[<a href="index.html">Index</a>]
[<a href="rdr.html">Suivant : Redirection du Trafic</a>]

<p>
<h1><font color="#e00000">PF : Traduction des Adresses IP (&quot;NAT&quot;)</font></h1>

<hr>

<h3>Table des Matières</h3>
<ul>
<li><a href="#intro">Introduction</a>
<li><a href="#works">Comment Fonctionne la NAT</a>
<li><a href="#ipfwd">Routage IP</a>
<li><a href="#config">Configurer la NAT</a>
<li><a href="#binat">Mise en Correspondance Bidirectionnelle (mise en
    correspondance 1:1)</a>
<li><a href="#except">Exceptions aux Règles de Traduction</a>
<li><a href="#status">Vérification de l'état de la NAT</a>
</ul>

<hr>

<a name="intro"></a>
<h2>Introduction</h2>
La traduction d'adresses IP (&quot;NAT&quot;) est un mécanisme destiné à
faire correspondre un réseau entier (ou des réseaux) à une seule adresse
IP. Un tel mécanisme est nécessaire lorsque le nombre des adresses IP
qui vous sont attribuées par votre Fournisseur d'Accès à Internet est plus
petit que le nombre de machines qui doivent pouvoir bénéficier d'une
connexion Internet. La NAT est décrite dans la
<a href="http://www.geektools.com/rfc/rfc1631.txt">RFC 1631</a>,
"The IP Network Address Translator (NAT)".

<p>
La NAT vous permet de bénéficier des blocs d'adressage privés décrits
dans la
<a href="http://www.geektools.com/rfc/rfc1918.txt">RFC 1918</a>,
"Address Allocation for Private Internets".
Typiquement, votre réseau interne sera paramétré pour
utiliser un ou plusieurs des blocs réseau suivants :
<pre>
        10.0.0.0/8       (10.0.0.0 - 10.255.255.255)
        172.16.0.0/12    (172.16.0.0 - 172.31.255.255)
        192.168.0.0/16   (192.168.0.0 - 192.168.255.255)
</pre>

<p>
Un système OpenBSD mettant en oeuvre la NAT aura au moins deux interfaces
réseau dont une est connectée à Internet; l'autre étant connectée à
votre réseau interne. La NAT traduit les requêtes en provenance de votre
réseau interne de telle façon à les faire apparaître comme si elles
étaient générées par votre système de NAT OpenBSD.

<a name="works"></a>
<h2>Comment Fonctionne la NAT</h2>
<p>
Lorsqu'un client du réseau interne entre en communication avec une
machine sur Internet, il envoie des paquets IP à destination de cette
machine. Ces paquets contiennent toutes les informations sur leur
émetteur et leur destinataire nécessaires à leur bon acheminement. La
NAT prend en compte les informations suivantes :
<ul>
<li>L'adresse IP source (192.168.1.35 par exemple)
<li>Port TCP ou UDP source (2132 par exemple)
</ul>

<p>
Lorsque les paquets passent à travers la passerelle NAT, ils sont
modifiés de telle façon à ce qu'ils semblent provenir de la passerelle
NAT. Cette passerelle enregistrera les modifications effectuées dans sa
table d'état afin de a) inverser les modifications pour les paquets de
retour et b) s'assurer que les paquets de retour sont autorisés à
traverser le pare-feu et ne sont pas bloqués. Par exemple, les
modifications suivantes peuvent être effectuées :
<ul>
<li>Adresse IP source : remplacée par l'adresse externe de la passerelle
    (24.5.0.5 par exemple)
<li>Port source : remplacé par un port non utilisé sur la passerelle et
    choisi de manière aléatoire (53136 par exemple)
</ul>

<p>
Aucune des deux extrémités de la communication ne se rend compte de ces
modifications. Pour la machine interne, le système qui effectue la NAT
est simplement une passerelle Internet. Pour l'hôte sur Internet, les
paquets semblent provenir directement du système de NAT; il ne sait même
pas que la machine interne existe.

<p>
Lorsque l'hôte sur Internet répond aux paquets de la machine interne, ils
seront envoyés à l'adresse IP externe de la passerelle NAT (24.5.0.5)
sur le port de traduction (53136). Dès réception de ces paquets, la
passerelle NAT cherchera dans sa table d'état si ces paquets de retour
correspondent à une connexion déjà établie. Une correspondance unique
sera trouvée, basée sur la combinaison IP/port qui permet à PF de voir
que les paquets appartiennent à une connexion initiée par la machine
interne 192.168.1.35. PF effectuera les modifications inverses à celles
effectuées sur les paquets sortants puis enverra ces paquets à la
machine interne.

<p>
La traduction de paquets ICMP s'effectue de manière similaire mais sans
la modification du port source.

<!-- legacy anchor; can eventually be removed -->
<a name="filter"></a>
<a name="enable"></a>
<a name="ipfwd"></a>
<h2>Routage IP</h2>
<p>
Vu que la NAT est utilisée la plupart du temps sur des routeurs et des
passerelles réseau, il sera probablement nécessaire d'activer le routage
IP pour permettre aux paquets de traverser les interfaces réseau du
système OpenBSD. Le routage IP peut être activé à l'aide du mécanisme
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=sysctl&amp;sektion=3"
>sysctl(3)</a> :
<blockquote>
<tt>
# sysctl net.inet.ip.forwarding=1<br>
# sysctl net.inet6.ip6.forwarding=1 <i>(si Ipv6 est utilisé)</i>
</tt>
</blockquote>

<p>
Pour rendre cette modification permanente, les lignes suivantes doivent
être ajoutées au fichier
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=sysctl.conf&amp;sektion=5"><tt>/etc/sysctl.conf</tt></a> :
<blockquote>
<tt>
net.inet.ip.forwarding=1<br>
net.inet6.ip6.forwarding=1
</tt>
</blockquote>

<p>
Ces lignes sont déjà présentes dans l'installation par défaut mais sont
commentées (préfixées avec un caractère <tt>#</tt>). Supprimez le
<tt>#</tt> et sauvegardez le fichier. Le routage IP sera désormais
activé automatiquement à chaque redémarrage.

<a name="config"></a>
<h2>Configurer la NAT</h2>
<font color="#ff0000">NOTE :</font> Cette information est pour OpenBSD 4.7.
La configuration du NAT était très différente dans les versions pécédentes.
<p>

Le NAT est spécifié comme un paramètre optionnel <tt>nat-to</tt> pour une
règle de sortie <tt>pass</tt>.
Souvent, plutôt que de configurer directement la règle <tt>pass</tt>,
une règle <tt>match</tt> est utilisée.
Quand un paquet est selectionné par une règle <tt>match</tt>, les paramètres
dans cette règle (par exemple <tt>nat-to</tt>) sont retenus et sont
appliqués au paquet quand une règle <tt>pass</tt> correspondante est
atteinte.
Cela permet a une grande classe de paquets d'être traités par une unique
règle <tt>match</tt> et les décisions spécifiques concernant l'opportunité
d'autoriser le trafic peuvent-être faite avec des règles <tt>block</tt> et <tt>pass</tt>.
<p>
Le format général dans <tt>pf.conf</tt> ressemble à quelque chose comme cela :

<blockquote>
<tt>
match out on <i>interface</i> [<i>af</i>] \<br>
&nbsp;&nbsp;&nbsp;from <i>src_addr</i> to <i>dst_addr</i> \<br>
&nbsp;&nbsp;&nbsp;nat-to <i>ext_addr</i> [<i>pool_type</i>] [static-port]<br>
...<br>
pass out [log] on <i>interface</i> [<i>af</i>] [proto <i>protocol]</i> \<br>
&nbsp;&nbsp;&nbsp;from <i>ext_addr</i> [port <i>src_port</i>] \<br>
&nbsp;&nbsp;&nbsp;to <i>dst_addr</i> [port <i>dst_port</i>]
</tt>
</blockquote>

<dl>
<dt><tt>match</tt>
<dd>Quand un paquet traverse le jeu de règles et correspond à une règle <tt>match</tt>,
tous les paramètres optionnels spécifiés dans cette règle sont retenus
pour des usages futurs (devient "sticky").

<dt><tt>pass</tt>
<dd>Cette règle permet au paquet d'être transmis.
Si le paquet a obtenu précedemment une correspondance avec une règle <tt>match</tt>
ou des paramètres ont été spécifiés, ils seront appliqués au paquet.
Les règles <tt>pass</tt> peuvent avoir leurs propres paramètres; ils ont la
priorité sur les paramètres spécifiés dans une règle <tt>match</tt>.

<dt><tt>out</tt>
<dd>Spécifie la direction du flot de paquet ou s'applique cette règle.
<tt>nat-to</tt> ne peut s'appliquer qu'aux paquets sortants.

<dt><tt>log</tt>
<dd>Journaliser les paquets correspondants à l'aide de
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=pflogd&amp;sektion=8&amp;manpath=OpenBSD+5.4">pflogd(8)</a>.
Normalement, uniquement le premier paquet qui correspond à la règle sera
tracé. Pour tracer tous les paquets correspondants, utilisez <tt>log
(all)</tt>.

<dt><tt><i>interface</i></tt>
<dd>Le nom ou groupe de l'interface réseau sur laquelle les paquets
seront transmis.

<dt><tt><i>af</i></tt>
<dd>La famille d'adresses : <tt>inet</tt> pour IPv4 ou <tt>inet6</tt>
    pour IPv6. PF est normalement capable de déterminer ce paramètre à
    partir des adresses source/destination.

<dt><tt><i>protocol</i></tt>
<dd>Le protocole (par exemple tcp, udp, icmp) des paquets qui est permis.
Si <i>src_port</i> ou <i>dst_port</i> est spécifié, le protocole
<em>doit</em> aussi être donné.

<dt><tt><i>src_addr</i></tt>
<dd>L'adresse source (interne) des paquets qui seront traduits.
    L'adresse source peut être spécifiée de plusieurs manières :
<ul>
<li>Une seule adresse IPv4 ou IPv6.
<li>Un bloc réseau en notation 
<a href="http://public.swbell.net/dedicated/cidr.html">CIDR</a>.
<li>Un nom de domaine au format FQDN qui sera résolu via DNS lorsque les
    règles seront chargées. Ce nom de domaine sera remplacé par toutes
    les adresses IP résultant de la résolution.
<li>Un nom ou groupe d'interface réseau. Ce nom sera remplacé par toutes
    les adresses IP attribuées à cette interface au moment du chargement
    des règles.
<li>Un nom d'interface réseau suivi d'un <tt>/<i>netmask</i></tt>
    (<tt>/24</tt> par exemple). Chaque adresse IP attribuée à
    l'interface sera combinée avec le netmask pour former un bloc réseau
    en notation CIDR. Le résultat remplacera la spécification initiale
    dans la règle.
<li>Le nom ou groupe d'une interface réseau suivi par un modificateur
    parmi les modificateurs suivants :
  <ul>
  <li><tt>:network</tt> - remplace le bloc réseau en notation
      CIDR (192.168.0.0/24 par exemple)
  <li><tt>:broadcast</tt> - remplace l'adresse de broadcast
      réseau (192.168.0.255 par exemple)
  <li><tt>:peer</tt> - remplace l'adresse IP du pair dans une
      communication point-à-point
  </ul>
  <dl>
  <dd>De plus, le modificateur <tt>:0</tt> peut être ajouté au
      nom/groupe de l'interface ou à l'un des modificateurs précités
      pour indiquer à PF que les alias IP ne doivent pas être inclus
      dans la substitution. Ces modificateurs peuvent aussi être
      utilisés lorsque le nom de l'interface est entre parenthèses.
      Exemple :
      <tt>fxp0:network:0</tt>
  </dl>

<li>Une <a href="tables.html">table</a>.
<li>N'importe quelle spécification précitée préfixée du modificateur
    <tt>!</tt> ("not") pour indiquer la négation.
<li>Un ensemble d'adresses en utilisant une
<a href="macros.html#lists">liste</a>.
<li>Le mot-clé <tt>any</tt> signifiant toutes les adresses.
</ul>

<dt><tt><i>src_port</i></tt>
<dd>Le port source dans l'en-tête du paquet (couche 4). Les ports
    peuvent être spécifiés de la manière suivante :
<ul>
<li>Un nombre entre 1 et 65535
<li>Un nom de service valide figurant dans le fichier
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=services&amp;sektion=5"
><tt>/etc/services</tt></a>
<li>Un ensemble de ports sous forme de
    <a href="macros.html#lists">liste</a>
<li>Un intervalle :
        <ul>
        <li><tt>!=</tt> (différent de)
        <li><tt>&lt;</tt> (inférieur à)
        <li><tt>&gt;</tt> (supérieur à)
        <li><tt>&lt;=</tt> (inférieur ou égal à)
        <li><tt>&gt;=</tt> (supérieur ou égal à)
        <li><tt>&gt;&lt;</tt> (intervalle)
        <li><tt>&lt;&gt;</tt> (intervalle inverse)
        <dl>
        <dd>Les deux derniers opérateurs sont des opérateurs binaires
            (ils prennent deux arguments) et n'incluent pas les
            arguments dans l'intervalle.
        </dl>
        <li><tt>:</tt> (intervalle avec inclusion)
        <dl>
        <dd>L'opérateur d'intervalle avec inclusion est aussi un
            opérateur binaire mais contrairement aux deux opérateurs
            précédents, il inclut les arguments dans l'intervalle.
        </dl>
        </ul>
</ul>
L'option <tt>port</tt> n'est pas habituellement utilisée dans les règles
<tt>nat</tt> vu que le but est souvent de traduire tout le trafic peu
importe le(s) port(s) utilisé(s).

<dt><tt><i>dst_addr</i></tt>
<dd>L'adresse destination des paquets à traduire. L'adresse de
    destination est spécifiée de la même manière que l'adresse source.

<dt><tt><i>dst_port</i></tt>
<dd>Le port destination dans l'en-tête du paquet (couche 4). Ce port est
    spécifié de la même manière que le port source.

<dt><tt><i>ext_addr</i></tt>
<dd>L'adresse externe (de traduction) sur la passerelle NAT. C'est
    l'adresse qui figurera dans les paquets une fois ceux-ci traduits.
    L'adresse externe peut être spécifiée comme suit :
<ul>
<li>Une seule adresse IPv4 ou IPv6.
<li>Un bloc réseau en notation 
<a href="http://public.swbell.net/dedicated/cidr.html">CIDR</a>.
<li>Un nom de domaine au format FQDN qui sera résolu via DNS lorsque les
    règles seront chargées. Ce nom de domaine sera remplacé par toutes
    les adresses IP résultant de la résolution.
<li>Le nom ou le groupe de l'interface réseau externe. Ce nom sera remplacé par
    toutes les adresses IP attribuées à cette interface au moment du
    chargement des règles.
<li>Le nom ou le groupe de l'interface réseau externe entouré de parenthèses <tt>(
    )</tt>. Ceci permet à PF de mettre à jour la règle si l'adresse ou
    les adresses IP de cette interface change(nt). C'est très utile
    lorsque l'interface obtient son adresse IP via DHCP ou un système
    dial-up. Dans ce cas, les règles n'ont pas à être rechargées chaque
    fois que l'adresse change.
<li>Le nom ou le groupe d'une interface réseau suivi par un modificateur parmi les
    modificateurs suivants :
  <ul>
  <li><tt>:network</tt> - remplace le bloc réseau en notation
      CIDR (192.168.0.0/24 par exemple)
  <li><tt>:peer</tt> - remplace l'adresse IP du pair dans une
      communication point-à-point
  </ul>
  <dl>
  <dd>De plus, le modificateur <tt>:0</tt> peut être ajouté au nom/groupe de
      l'interface ou à l'un des modificateurs précités pour indiquer à
      PF que les alias IP ne doivent pas être inclus dans la
      substitution. Ces modificateurs peuvent aussi être utilisés lorsque
      le nom de l'interface est entre parenthèses. Exemple :
      <tt>fxp0:network:0</tt>
  </dl>
<li>Un ensemble d'adresses en utilisant une
<a href="macros.html#lists">liste</a>.
</ul>

<dt><tt><i>pool_type</i></tt>
<dd>Spécifie le type de <a href="pools.html">pool d'adresses</a> à
    utiliser pour la traduction.

<dt><tt>static-port</tt>
<dd>Si cette option est utilisée, PF ne traduira pas le port source des
    paquets TCP et UDP.

</dl>

<p>
Ceci nous donne des lignes de la forme basique suivante :
<blockquote>
<tt>
match out on tl0 from 192.168.1.0/24 to any nat-to 24.5.0.5<br>
pass on tl0 from 192.168.1.0/24 to any
</tt>
</blockquote>
ou vous pouvez utiliser simplement
<blockquote>
<tt>
pass out on tl0 from 192.168.1.0/24 to any nat-to 24.5.0.5
</tt>
</blockquote>

<p>
Cette règle permet d'effectuer la NAT sur l'interface <tt>tl0</tt> sur
tout paquet provenant de 192.168.1.0/24 et remplace l'adresse IP source
par 24.5.0.5.

<p>
Bien que cette règle soit correcte, ce n'est pas la forme recommandée.
La maintenance peut s'avérer difficile vu que toute modification des
adresses réseau externe ou interne nécessitera une modification de la
règle. La forme suivante est plus facile à maintenir (<tt>tl0</tt> est
l'interface externe, <tt>dc0</tt> est l'interface interne) :
<blockquote>
<tt>
pass out on tl0 from dc0:network to any nat-to tl0
</tt>
</blockquote>

<p>
L'avantage de cette forme doit être clair maintenant : vous pouvez
changer les adresses IP des deux interfaces sans changer la règle.

<p>
Lorsque vous spécifiez un nom d'interface comme adresse de traduction
tel que c'est fait dans la règle ci-dessus, l'adresse IP est déterminée
lors du <i>chargement</i> de pf.conf. Elle n'est pas déterminée à la
volée. Si vous utilisez DHCP pour configurer votre interface externe,
ceci peut poser problème. Par exemple, si l'adresse qui vous est
attribuée change, le système de NAT continuera à traduire les paquets
sortants en utilisant l'ancienne adresse IP. Les connexions sortantes ne
fonctionneront donc plus. Pour éviter ce problème, vous pouvez dire à PF
de mettre à jour automatiquement l'adresse de traduction en mettant des
parenthèses autour du nom de l'interface :
<blockquote>
<tt>
pass out on tl0 from dc0:network to any nat-to (tl0)
</tt>
</blockquote>

<p>
Cette méthode fonctionne aussi bien pour la traduction d'adresses IPv6
que pour la traduction d'adresses IPv4.

<a name="binat"></a>
<h2>Mise en Correspondance Bidirectionnelle (mise en correspondance
    1:1)</h2>
Une mise en correspondance bidirectionnelle (traduction 1 à 1) peut être
établie en utilisant un paramètre <tt>binat-to</tt>. 
Une règle <tt>binat-to</tt> établit une correspondance 1 à 1 entre une 
adresse IP interne et une adresse externe. 
Ceci peut être pratique par exemple pour permettre à un
serveur web interne d'avoir sa propre adresse de traduction externe. Les
connexions en provenance d'Internet à destination de cette adresse
externe seront acheminées vers l'adresse interne du serveur web. Quant
aux requêtes émanant du serveur web (telles que les requêtes DNS), elles
seront traduites par l'adresse externe. 
Les ports TCP et UDP ne sont jamais modifiés par les règles <tt>binat-to</tt>
comme pour les règles <tt>nat</tt>.

<p>
Exemple :
<blockquote>
<tt>
web_serv_int = "192.168.1.100"<br>
web_serv_ext = "24.5.0.6"<br>
<br>
pass on tl0 from $web_serv_int to any binat-to $web_serv_ext<br>
</tt>
</blockquote>

<a name="except"></a>
<h2>Exceptions aux Règles de Traduction</h2>
Si vous avez besoin de traduire la plupart du trafic, mais avoir des
exceptions dans certains cas, soyez sûr que les exceptions sont prises en
compte par une règle de filtrage qui n'est pas incluse dans le paramètre
nat-to.
Par exemple, si la règle de NAT précédente était modifiée de la manière suivante :
<blockquote>
<tt>
pass out on tl0 from 192.168.1.0/24 to any nat-to 24.2.74.79<br>
pass out on tl0 from 192.168.1.208 to any<br>
</tt>
</blockquote>

<p>
Alors tous les paquets du réseau 192.168.1.0/24 seront traduits avec
l'adresse externe 24.2.74.79 excepté pour la machine 192.168.1.208.

<a name="status"></a>
<h2>Vérification de l'état de la NAT</h2>
Pour voir les traductions actives, il faut utiliser
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=pfctl&amp;sektion=8&amp;manpath=OpenBSD+5.4">pfctl(8)</a>
avec l'option <tt>-s state</tt>. Cette option affichera une liste de
toutes les sessions NAT en cours :

<pre>
   # pfctl -s state
   fxp0 tcp 192.168.1.35:2132 (24.5.0.5:53136) -&gt; 65.42.33.245:22 TIME_WAIT:TIME_WAIT
   fxp0 udp 192.168.1.35:2491 (24.5.0.5:60527) -&gt; 24.2.68.33:53   MULTIPLE:SINGLE
</pre>

<p>
Explications (première ligne uniquement) :

<dl>
<dt>fxp0
<dd>Indique l'interface à laquelle est rattachée la session. Le mot-clé
    <tt>self</tt> apparaîtra si la session est de type
<a href="options.html#state-policy"><tt>floating</tt></a>.
</dl>

<dl>
<dt>TCP
<dd>Le protocole utilisé par la connexion.
</dl>

<dl>
<dt>192.168.1.35:2132
<dd>L'adresse IP (192.168.1.35) de la machine sur le réseau interne. Le
    port source (2132) est affiché après l'adresse. C'est aussi
    l'adresse qui sera remplacée au niveau de l'en-tête IP.
</dl>

<dl>
<dt>24.5.0.5:53136
<dd>L'adresse IP (24.5.0.5) et le port (53136) sur la passerelle
    utilisés pour la traduction.
</dl>

<dl>
<dt>65.42.33.245:22
<dd>L'adresse IP (65.42.33.245) et le port (22) auxquels la machine
    interne est connectée.
</dl>

<dl>

<dt>TIME_WAIT:TIME_WAIT
<dd>Indique l'état de la connexion TCP, vu par PF.
</dl>

<p>
[<a href="filter.html">Précédent : Filtrage de Paquets</a>]
[<a href="index.html">Index</a>]
[<a href="rdr.html">Suivant : Redirection du Trafic</a>]

<p>
<hr>
<a href="index.html"><img height="24" width="24" src="../../../images/back.gif" border="0" alt="[back]"></a> 
<a href="mailto:www@@openbsd.org">www@@openbsd.org</a>
<br>
<small>
<!--
Originally [OpenBSD: nat.html,v 1.44 ]<br>
$Translation: nat.html,v 1.43 2013/11/01 17:02:17 rustybsd Exp $<br>
-->
$OpenBSD: nat.html,v 1.40 2013/11/01 18:04:05 ajacoutot Exp $
</small>

</body>
</html> 
@


1.40
log
@Sync with Steelix CVS
@
text
@d560 1
a560 1
$OpenBSD$
@


1.39
log
@Sync with Steelix CVS
@
text
@d231 1
a231 1
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=pflogd&amp;sektion=8&amp;manpath=OpenBSD+5.3">pflogd(8)</a>.
d495 1
a495 1
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=pfctl&amp;sektion=8&amp;manpath=OpenBSD+5.3">pfctl(8)</a>
d557 2
a558 2
Originally [OpenBSD: nat.html,v 1.43 ]<br>
$Translation: nat.html,v 1.42 2013/05/07 08:34:48 rustybsd Exp $<br>
@


1.38
log
@Sync with Steelix CVS
@
text
@d231 1
a231 1
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=pflogd&amp;sektion=8&amp;manpath=OpenBSD+5.2">pflogd(8)</a>.
d495 1
a495 1
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=pfctl&amp;sektion=8&amp;manpath=OpenBSD+5.2">pfctl(8)</a>
d557 2
a558 2
Originally [OpenBSD: nat.html,v 1.42 ]<br>
$Translation: nat.html,v 1.41 2013/04/26 10:18:07 rustybsd Exp $<br>
@


1.37
log
@Sync with Steelix CVS
@
text
@d87 1
a87 1
Un système OpenBSD mettant en oeuvre la NAT aura au moins deux cartes
d557 2
a558 2
Originally [OpenBSD: nat.html,v 1.41 ]<br>
$Translation: nat.html,v 1.40 2013/02/21 16:23:32 rustybsd Exp $<br>
@


1.36
log
@Sync with Steelix CVS
@
text
@d256 1
a256 1
<a href="http://public.pacbell.net/dedicated/cidr.html">CIDR</a>.
d347 1
a347 1
<a href="http://public.pacbell.net/dedicated/cidr.html">CIDR</a>.
d557 2
a558 2
Originally [OpenBSD: nat.html,v 1.40 ]<br>
$Translation: nat.html,v 1.39 2012/11/01 19:46:21 rustybsd Exp $<br>
@


1.35
log
@Sync with Steelix CVS
@
text
@d231 1
a231 1
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=pflogd&amp;sektion=8&amp;manpath=OpenBSD+5.1">pflogd(8)</a>.
d460 1
a460 1
Les ports TCP et UDP ne sont jamais modifiés par les règles <tt>binat-to</tt> 
d495 1
a495 1
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=pfctl&amp;sektion=8&amp;manpath=OpenBSD+5.1">pfctl(8)</a>
d557 2
a558 2
Originally [OpenBSD: nat.html,v 1.39 ]<br>
$Translation: nat.html,v 1.38 2012/08/17 06:15:16 rustybsd Exp $<br>
@


1.34
log
@Sync with Steelix CVS
@
text
@d351 1
a351 1
<li>Le nom de l'interface réseau externe. Ce nom sera remplacé par
d354 1
a354 1
<li>Le nom de l'interface réseau externe entouré de parenthèses <tt>(
d360 1
a360 1
<li>Le nom d'une interface réseau suivi par un modificateur parmi les
d369 1
a369 1
  <dd>De plus, le modificateur <tt>:0</tt> peut être ajouté au nom de
d557 2
a558 2
Originally [OpenBSD: nat.html,v 1.38 ]<br>
$Translation: nat.html,v 1.37 2012/05/17 14:16:54 rustybsd Exp $<br>
@


1.33
log
@Sync with Steelix CVS
@
text
@d186 2
a187 2
Le NAT est spécifié comme un paramétre optionnel <tt>nat-to</tt> pour une
régle de sortie <tt>pass</tt>.
d190 1
a190 1
Quand un paquet est selectionné par une règle <tt>match</tt>, les paramétres
d214 2
a215 2
<dd>Quand un paquet traverse le jeu de règles et correspond à une règle <tt>match</tt>
, tous les paramétres optionnels spécifiés dans cette règle sont retenus
d221 3
a223 3
ou des paramétres ont été spécifiés, ils seront appliqués au paquet.
Les règles <tt>pass</tt> peuvent avoir leurs propres paramétres; ils ont la
priorité sur les paramétres spécifiés dans une règle <tt>match</tt>.
d451 1
a451 1
établie en utilisant un paramétre <tt>binat-to</tt>. 
d558 1
a558 1
$Translation: nat.html,v 1.36 2012/05/11 18:40:10 rustybsd Exp $<br>
@


1.32
log
@Sync with Steelix CVS
@
text
@d183 1
a183 1
La configuration du NAT était trés différente dans les versions pécédentes.
d231 1
a231 1
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=pflogd&amp;sektion=8&amp;manpath=OpenBSD+5.0">pflogd(8)</a>.
d478 1
a478 1
compte par une règle de filtrage qui n'est pas incluse dans le paramétre
d495 1
a495 1
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=pfctl&amp;sektion=8&amp;manpath=OpenBSD+5.0">pfctl(8)</a>
d557 2
a558 2
Originally [OpenBSD: nat.html,v 1.37 ]<br>
$Translation: nat.html,v 1.35 2011/11/05 09:29:00 benoit Exp $<br>
@


1.31
log
@Sync with Steelix CVS
@
text
@d231 1
a231 1
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=pflogd&amp;sektion=8&amp;manpath=OpenBSD+4.9">pflogd(8)</a>.
d495 1
a495 1
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=pfctl&amp;sektion=8&amp;manpath=OpenBSD+4.9">pfctl(8)</a>
d557 2
a558 2
Originally [OpenBSD: nat.html,v 1.36 ]<br>
$Translation: nat.html,v 1.34 2011/07/03 07:48:03 benoit Exp $<br>
@


1.30
log
@Sync with Steelix CVS
@
text
@d501 2
a502 2
   fxp0 TCP 192.168.1.35:2132 -&gt; 24.5.0.5:53136 -&gt; 65.42.33.245:22 TIME_WAIT:TIME_WAIT
   fxp0 UDP 192.168.1.35:2491 -&gt; 24.5.0.5:60527 -&gt; 24.2.68.33:53   MULTIPLE:SINGLE
d557 2
a558 2
Originally [OpenBSD: nat.html,v 1.35 ]<br>
$Translation: nat.html,v 1.33 2011/05/07 07:02:59 benoit Exp $<br>
@


1.29
log
@Sync with Steelix CVS
@
text
@d231 1
a231 2
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=pflogd&amp;sektion=8&amp;manpath=OpenBSD+4.8"
>pflogd(8)</a>.
d495 1
a495 1
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=pfctl&amp;sektion=8&amp;manpath=OpenBSD+4.8">pfctl(8)</a>
d557 2
a558 2
Originally [OpenBSD: nat.html,v 1.34 ]<br>
$Translation: nat.html,v 1.32 2011/02/20 09:56:46 benoit Exp $<br>
@


1.28
log
@Sync with Steelix CVS
@
text
@d395 1
a395 1
match out on tl0 from 192.168.1.0/24 to any nat-to 24.5.0.5
d484 1
a484 1
pass out on tl0 from 192.168.1.0/24 to any nat-to 24.2.74.79
d558 2
a559 2
Originally [OpenBSD: nat.html,v 1.33 ]<br>
$Translation: nat.html,v 1.31 2010/11/06 14:41:18 benoit Exp $<br>
@


1.27
log
@Sync with Steelix CVS
@
text
@d231 1
a231 1
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=pflogd&amp;sektion=8&amp;manpath=OpenBSD+4.7"
d496 1
a496 1
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=pfctl&amp;sektion=8&amp;manpath=OpenBSD+4.7">pfctl(8)</a>
d558 2
a559 2
Originally [OpenBSD: nat.html,v 1.32 ]<br>
$Translation: nat.html,v 1.30 2010/10/01 08:57:38 benoit Exp $<br>
@


1.26
log
@Sync with Steelix CVS
@
text
@a51 1
<li><a href="#filter">NAT et Filtrage de Paquets</a>
d144 1
a145 17
<h2>NAT et Filtrage de Paquets</h2>
<p>
<font color="#ff0000">REMARQUE :</font>
Les paquets traduits doivent, comme n'importe quel autre paquet, être
évalués par le mécanisme pare-feu suivant les règles de filtrage
définies. La <i>seule</i> exception à cette règle est lorsque le
mot-clé <tt>pass</tt> est utilisé dans la règle de <tt>nat</tt>. Ce
mot-clé permettra aux paquets traduits d'être autorisés immédiatement
par le pare-feu.

<p>
Il est à noter que la traduction a lieu <i>avant</i> le filtrage. Ce qui
veut dire que le pare-feu verra le paquet <i>traduit</i> avec l'adresse
IP et le port traduits tel que c'est expliqué dans
<a href="#works">Comment Fonctionne la NAT</a>.

<!-- legacy anchor; can eventually be removed -->
d182 18
a199 2
Le format général des règles de NAT dans <tt>pf.conf</tt> est le suivant
:
d202 7
a208 4
nat [pass] [log] on <i>interface</i> [<i>af</i>] from <i>src_addr</i>
[port <i>src_port</i>] to \<br>
&nbsp;&nbsp;&nbsp;<i>dst_addr</i> [port <i>dst_port</i>] -&gt; 
<i>ext_addr</i> [<i>pool_type</i>] [static-port]
d213 4
a216 2
<dt><tt>nat</tt>
<dd>Le mot-clé qui permet de créer une règle de NAT.
d219 9
a227 2
<dd>Permet aux paquets traduits de contourner complètement les règles de
    filtrage et d'être autorisés systématiquement par le pare-feu.
d231 1
a231 1
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=pflogd&amp;sektion=8&amp;manpath=OpenBSD+4.6"
d239 1
a239 1
seront traduits.
d246 5
d392 8
a399 1
Ceci nous donne une ligne de la forme basique suivante :
d402 1
a402 1
nat on tl0 from 192.168.1.0/24 to any -&gt; 24.5.0.5
d419 1
a419 1
nat on tl0 from dc0:network to any -&gt; tl0
d440 1
a440 1
nat on tl0 from dc0:network to any -&gt; (tl0)
d452 4
a455 3
établie en utilisant une règle <tt>binat</tt>. Une règle <tt>binat</tt>
établit une correspondance 1 à 1 entre une adresse IP interne et une
adresse externe. Ceci peut être pratique par exemple pour permettre à un
d460 3
a462 4
seront traduites de telle façon à remplacer l'adresse interne par
l'adresse externe de traduction attribuée au serveur web. Contrairement
aux règles <tt>nat</tt>, les règles <tt>binat</tt> ne modifient jamais
les ports TCP.
d471 1
a471 1
binat on tl0 from $web_serv_int to any -&gt; $web_serv_ext<br>
d477 5
a481 3
Des exceptions aux règles de traduction peuvent être faites en utilisant
le mot-clé <tt>no</tt>. Par exemple, si la règle de NAT précédente était
modifiée de la manière suivante :
d484 2
a485 2
no nat on tl0 from 192.168.1.208 to any<br>
nat on tl0 from 192.168.1.0/24 to any -&gt; 24.2.74.79
a492 7
<p>
Il est à noter que la première règle à laquelle un paquet correspond est
appliquée et aucune évaluation supplémentaire n'est effectuée. S'il y a
une règle <tt>no</tt>, alors le paquet n'est pas traduit. Le mot-clé
<tt>no</tt> peut être utilisé avec les règles <tt>binat</tt> et
<a href="rdr.html"><tt>rdr</tt></a>.

d496 1
a496 1
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=pfctl&amp;sektion=8&amp;manpath=OpenBSD+4.6">pfctl(8)</a>
d558 2
a559 2
Originally [OpenBSD: nat.html,v 1.31 ]<br>
$Translation: nat.html,v 1.29 2009/10/19 15:48:30 benoit Exp $<br>
@


1.25
log
@Sync with Steelix CVS
@
text
@d220 1
a220 1
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=pflogd&amp;sektion=8&amp;manpath=OpenBSD+4.5"
d478 1
a478 1
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=pfctl&amp;sektion=8&amp;manpath=OpenBSD+4.5">pfctl(8)</a>
d540 2
a541 2
Originally [OpenBSD: nat.html,v 1.30 ]<br>
$Translation: nat.html,v 1.28 2009/04/30 22:46:58 benoit Exp $<br>
@


1.24
log
@Sync with Steelix CVS
@
text
@d220 1
a220 1
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=pflogd&amp;sektion=8&amp;manpath=OpenBSD+4.4"
d478 1
a478 1
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=pfctl&amp;sektion=8&amp;manpath=OpenBSD+4.4">pfctl(8)</a>
d540 2
a541 2
Originally [OpenBSD: nat.html,v 1.29 ]<br>
$Translation: nat.html,v 1.27 2008/11/26 22:39:39 benoit Exp $<br>
@


1.23
log
@Sync with Steelix CVS
@
text
@d220 1
a220 1
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=pflogd&amp;sektion=8&amp;manpath=OpenBSD+4.3"
d478 1
a478 1
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=pfctl&amp;sektion=8&amp;manpath=OpenBSD+4.3">pfctl(8)</a>
d540 2
a541 2
Originally [OpenBSD: nat.html,v 1.28 ]<br>
$Translation: nat.html,v 1.26 2008/08/20 15:32:00 gapz Exp $<br>
@


1.22
log
@Sync with Steelix CVS
@
text
@d220 1
a220 1
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=pflogd&amp;sektion=8&amp;manpath=OpenBSD+4.2"
d478 1
a478 1
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=pfctl&amp;sektion=8&amp;manpath=OpenBSD+4.2">pfctl(8)</a>
d540 2
a541 2
Originally [OpenBSD: nat.html,v 1.27 ]<br>
$Translation: nat.html,v 1.25 2008/01/11 10:52:47 saad Exp $<br>
@


1.21
log
@Sync with steelix translation CVS
@
text
@d123 1
a123 1
Aucune des deux extrêmités de la communication ne se rend compte de ces
d203 1
a203 1
nat [pass [log]] on <i>interface</i> [<i>af</i>] from <i>src_addr</i>
d219 2
a220 3
<dd>Lorsque <tt>pass</tt> est spécifié, les paquets peuvent être tracés
à l'aide de
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=pflogd&amp;sektion=8&amp;manpath=OpenBSD+4.1"
d478 1
a478 1
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=pfctl&amp;sektion=8&amp;manpath=OpenBSD+4.1">pfctl(8)</a>
d540 2
a541 2
Originally [OpenBSD: nat.html,v 1.26 ]<br>
$Translation: nat.html,v 1.23 2007/05/07 09:38:20 ajacoutot Exp $<br>
@


1.20
log
@sync with Steelix CVS
@
text
@d171 1
a171 1
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=sysctl&amp;sektion=3&amp;manpath=OpenBSD+4.0"
d183 1
a183 1
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=sysctl.conf&amp;sektion=5&amp;manpath=OpenBSD+4.0"><tt>/etc/sysctl.conf</tt></a> :
d221 1
a221 1
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=pflogd&amp;sektion=8&amp;manpath=OpenBSD+4.0"
d288 1
a288 1
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=services&amp;sektion=5&amp;manpath=OpenBSD+4.0"
d479 1
a479 1
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=pfctl&amp;sektion=8&amp;manpath=OpenBSD+4.0">pfctl(8)</a>
d541 2
a542 2
Originally [OpenBSD: nat.html,v 1.25 ]<br>
$Translation: nat.html,v 1.22 2007/02/10 16:41:44 benoit Exp $<br>
@


1.19
log
@sync with Steelix CVS
@
text
@d113 1
a113 1
travers le pare-feu et ne sont pas bloqués. Par exemple, les
d278 2
a279 2
<a href="macros.html#lists">liste</a>
<li>Le mot-clé <tt>any</tt> signifiant toutes les adresses
d363 1
a363 1
<a href="macros.html#lists">liste</a>
d542 1
a542 1
$Translation: nat.html,v 1.21 2006/11/21 14:59:52 ajacoutot Exp $<br>
@


1.18
log
@sync with steelix translation CVS
@
text
@d171 1
a171 1
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=sysctl&amp;sektion=3&amp;manpath=OpenBSD+3.9"
d183 1
a183 1
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=sysctl.conf&amp;sektion=5&amp;manpath=OpenBSD+3.9"><tt>/etc/sysctl.conf</tt></a> :
d221 1
a221 1
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=pflogd&amp;sektion=8&amp;manpath=OpenBSD+3.9"
d228 2
a229 2
<dd>Le nom de l'interface réseau sur laquelle les paquets seront
    traduits.
d246 3
a248 3
<li>Un nom d'interface réseau. Ce nom sera remplacé par toutes les
    adresses IP attribuées à cette interface au moment du chargement des
    règles.
d254 2
a255 2
<li>Le nom d'une interface réseau suivi par un modificateur parmi les
    modificateurs suivants :
d265 6
a270 5
  <dd>De plus, le modificateur <tt>:0</tt> peut être ajouté au nom de
      l'interface ou à l'un des modificateurs précités pour indiquer à
      PF que les alias IP ne doivent pas être inclus dans la
      substitution. Ces modificateurs peuvent aussi être utilisés
      lorsque le nom de l'interface est entre parenthèses. Exemple :
d288 1
a288 1
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=services&amp;sektion=5&amp;manpath=OpenBSD+3.9"
d479 1
a479 1
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=pfctl&amp;sektion=8&amp;manpath=OpenBSD+3.9">pfctl(8)</a>
d541 2
a542 2
Originally [OpenBSD: nat.html,v 1.24 ]<br>
$Translation: nat.html,v 1.20 2006/10/28 18:41:16 aanriot Exp $<br>
@


1.17
log
@sync with steelix translation CVS
@
text
@d71 2
a72 1
<a href="http://www.geektools.com/rfc/rfc1631.txt">RFC 1631</a>.
d77 2
a78 1
<a href="http://www.geektools.com/rfc/rfc1918.txt">RFC 1918</a>.
d540 2
a541 2
Originally [OpenBSD: nat.html,v 1.23 ]<br>
$Translation: nat.html,v 1.19 2006/05/02 10:12:39 ajacoutot Exp $<br>
@


1.16
log
@sync with steelix translation CVS
@
text
@d169 1
a169 1
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=sysctl&amp;sektion=3&amp;manpath=OpenBSD+3.8"
d181 1
a181 1
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=sysctl.conf&amp;sektion=5&amp;manpath=OpenBSD+3.8"><tt>/etc/sysctl.conf</tt></a> :
d219 1
a219 1
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=pflogd&amp;sektion=8&amp;manpath=OpenBSD+3.8"
d285 1
a285 1
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=services&amp;sektion=5&amp;manpath=OpenBSD+3.8"
d476 1
a476 1
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=pfctl&amp;sektion=8&amp;manpath=OpenBSD+3.8">pfctl(8)</a>
d538 2
a539 2
Originally [OpenBSD: nat.html,v 1.22 ]<br>
$Translation: nat.html,v 1.18 2006/04/20 06:42:51 ajacoutot Exp $<br>
@


1.15
log
@sync with Steelix CVS
@
text
@d98 1
a98 1
émetteur et leur destinaitaire nécessaires à leur bon acheminement. La
d214 1
a214 1
    filtrage et d'être autorisés systèmatiquement par le pare-feu.
d539 1
a539 1
$Translation: nat.html,v 1.17 2006/03/09 14:46:29 ajacoutot Exp $<br>
@


1.14
log
@sync with Steelix CVS
@
text
@d35 1
a35 1
<a href="../../fr/index.html">
a351 1
  <dd>
d539 1
a539 1
$Translation: nat.html,v 1.16 2005/12/31 00:45:21 saad Exp $<br>
@


1.13
log
@sync with Steelix CVS
@
text
@d201 1
a201 1
nat [pass] on <i>interface</i> [<i>af</i>] from <i>src_addr</i> 
d216 9
d539 2
a540 2
Originally [OpenBSD: nat.html,v 1.21 ]<br>
$Translation: nat.html,v 1.15 2005/11/02 19:38:09 aanriot Exp $<br>
@


1.12
log
@sync with Steelix CVS
@
text
@d169 1
a169 1
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=sysctl&amp;sektion=3&amp;manpath=OpenBSD+3.7"
d181 1
a181 1
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=sysctl.conf&amp;sektion=5&amp;manpath=OpenBSD+3.7"><tt>/etc/sysctl.conf</tt></a> :
d276 1
a276 1
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=services&amp;sektion=5&amp;manpath=OpenBSD+3.7"
d468 1
a468 1
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=pfctl&amp;sektion=8&amp;manpath=OpenBSD+3.7">pfctl(8)</a>
d530 2
a531 2
Originally [OpenBSD: nat.html,v 1.20 ]<br>
$Translation: nat.html,v 1.14 2005/07/28 09:09:44 saad Exp $<br>
@


1.11
log
@sync with Steelix CVS
@
text
@d68 1
a68 1
qui vous sont attribuées par votre Fournisseur d'Accès Internet est plus
d77 2
a78 2
Typiquement, votre réseau interne sera paramétré de telle façon à
utiliser un ou plusieurs blocs réseau parmi les blocs suivants :
d106 1
a106 1
Lorsque les paquets passent à travers la passerelle NAT, ils seront
d123 1
a123 1
est simplement une passerelle Internet. Pour le hôte Internet, les
d128 1
a128 1
Lorsque le hôte Internet répond aux paquets de la machine interne, ils
d243 1
a243 1
<li>Le nom d'une interface réseau suivie par un modificateur parmi les
d272 1
a272 1
    peuvent spécifiés de la manière suivante :
d332 1
a332 1
    dial- up. Dans ce cas, les règles n'ont pas à être rechargées chaque
d334 1
a334 1
<li>Le nom d'une interface réseau suivie par un modificateur parmi les
d347 1
a347 1
      substitution Ces modificateurs peuvent aussi être utilisés lorsque
d461 1
a461 1
une règle <tt>no</tt>, alors le paquet n'est pas traduit. Le mot- clé
d531 1
a531 1
$Translation: nat.html,v 1.13 2005/05/21 09:51:45 aanriot Exp $<br>
@


1.10
log
@Sync with Steelix CVS
@
text
@d169 1
a169 1
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=sysctl&amp;sektion=3&amp;manpath=OpenBSD+3.6"
d181 1
a181 1
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=sysctl.conf&amp;sektion=5&amp;manpath=OpenBSD+3.6"><tt>/etc/sysctl.conf</tt></a> :
d276 1
a276 1
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=services&amp;sektion=5&amp;manpath=OpenBSD+3.6"
d468 1
a468 1
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=pfctl&amp;sektion=8&amp;manpath=OpenBSD+3.6">pfctl(8)</a>
d530 2
a531 2
Originally [OpenBSD: nat.html,v 1.19 ]<br>
$Translation: nat.html,v 1.12 2005/01/17 21:34:48 aanriot Exp $<br>
@


1.9
log
@sync with Steelix CVS
@
text
@d529 1
d531 2
a532 1
$Translation: nat.html,v 1.11 2004/12/29 10:33:02 saad Exp $<br>
@


1.8
log
@sync with Steelix CVS
@
text
@d35 3
a37 1
<img alt="[OpenBSD]" height=30 width=141 src="../../../images/smalltitle.gif">
d529 2
a530 2
Originally [OpenBSD: nat.html,v 1.18 ]<br>
$Translation: nat.html,v 1.9 2004/11/03 15:34:07 saad Exp $<br>
@


1.7
log
@sync with Steelix CVS
@
text
@d447 1
a447 1
no nat on tl0 from 192.168.1.10 to any<br>
d454 1
a454 1
l'adresse externe 24.2.74.79 excepté pour la machine 192.168.1.10.
d527 2
a528 2
Originally [OpenBSD: nat.html,v 1.17 ]<br>
$Translation: nat.html,v 1.8 2004/11/01 00:15:16 saad Exp $<br>
@


1.6
log
@Sync with Steelix CVS
@
text
@d167 1
a167 1
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=sysctl&amp;sektion=3&amp;manpath=OpenBSD+3.5"
d179 1
a179 1
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=sysctl.conf&amp;sektion=5&amp;manpath=OpenBSD+3.5"><tt>/etc/sysctl.conf</tt></a> :
d274 1
a274 1
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=services&amp;sektion=5&amp;manpath=OpenBSD+3.5"
d466 1
a466 1
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=pfctl&amp;sektion=8&amp;manpath=OpenBSD+3.5">pfctl(8)</a>
d527 2
a528 2
Originally [OpenBSD: nat.html,v 1.16 ]<br>
$Translation: nat.html,v 1.7 2004/10/13 11:53:05 saad Exp $<br>
@


1.5
log
@Sync with Steelix CVS
@
text
@d4 1
a4 1
<title>PF: Traduction des Adresses IP (&quot;NAT&quot;)</title>
d528 1
a528 1
$Translation: nat.html,v 1.6 2004/10/11 21:41:41 saad Exp $<br>
@


1.4
log
@Sync with Steelix CVS
@
text
@d4 1
a4 1
<title>PF: Traduction des Adresses IP ("NAT")</title>
d42 1
a42 1
<h1><font color="#e00000">PF : Traduction des Adresses IP ("NAT")</font></h1>
d54 1
a54 1
correspondance 1:1)</a>
d63 6
a68 8
La traduction d'adresses IP (NAT) est un mécanisme destiné
à faire correspondre un réseau entier (ou des
réseaux) à une seule adresse IP. Un tel mécanisme
est nécessaire lorsque le nombre des adresses IP qui vous sont
attribuées par votre Fournisseur d'Accès Internet est plus
petit que le nombre de machines qui doivent pouvoir
bénéficier d'une connexion Internet. La NAT est
décrite dans la
d72 2
a73 2
La NAT vous permet de bénéficier des blocs d'adressage
privés décrits dans la
d75 2
a76 3
Typiquement, votre réseau interne sera paramétré de
telle façon à utiliser un ou plusieurs blocs réseau
parmi les blocs suivants :
d84 5
a88 7
Un système OpenBSD mettant en oeuvre la NAT aura au moins deux
cartes réseau dont une est connectée à Internet;
l'autre étant connectée à votre réseau
interne. La NAT traduit les requêtes en provenance de votre
réseau interne de telle façon à les faire
apparaître comme si elles étaient
générées par votre système de NAT OpenBSD.
d93 5
a97 6
Lorsqu'un client du réseau interne entre en communication avec
une machine sur Internet, il envoie des paquets IP à destination
de cette machine. Ces paquets contiennent toutes les informations sur
leur émetteur et leur destinaitaire nécessaires à
leur bon acheminement. La NAT prend en compte les informations suivantes
:
d104 7
a110 8
Lorsque les paquets passent à travers la passerelle NAT, ils
seront modifiés de telle façon à ce qu'ils semblent
provenir de la passerelle NAT. Cette passerelle enregistrera les
modifications effectuées dans sa table d'états afin de a)
inverser les modifications pour les paquets de retour et b) s'assurer
que les paquets de retour sont autorisés à travers le pare-
feu et ne sont pas bloqués. Par exemple, les modifications
suivantes peuvent être effectuées :
d112 4
a115 5
<li>Adresse IP source : remplacée par l'adresse externe de la
    passerelle (24.5.0.5 par exemple)
<li>Port source : remplacé par un port non utilisé sur la
    passerelle et choisi de manière aléatoire (53136 par
    exemple)
d119 17
a135 19
Aucune des deux extrêmités de la communication ne se rend
compte de ces modifications. Pour la machine interne, le système
qui effectue la NAT est simplement une passerelle Internet. Pour le
hôte Internet, les paquets semblent provenir directement du
système de NAT; il ne sait même pas que la machine interne
existe.

<p>
Lorsque le hôte Internet répond aux paquets de la machine
interne, ils seront envoyés à l'adresse IP externe de la
passerelle NAT (24.5.0.5) sur le port de traduction (53136). Dès
réception de ces paquets, la passerelle NAT cherchera dans sa
table d'états si ces paquets de retour correspondent à une
connexion déjà établie. Une correspondance unique
sera trouvée, basée sur la combinaison IP/port qui permet
à PF de voir que les paquets appartiennent à une connexion
initiée par la machine interne 192.168.1.35. PF effectuera les
modifications inverses à celles effectuées sur les paquets
sortants puis enverra ces paquets à la machine interne.
d138 2
a139 2
La traduction de paquets ICMP s'effectue de manière similaire
mais sans la modification du port source.
d145 6
a150 7
Les paquets traduits doivent, comme n'importe quel autre paquet,
être évalués par le mécanisme pare-feu
suivant les règles de filtrage définies.
La <i>seule</i> exception à cette règle est lorsque le mot-
clé <tt>pass</tt> est utilisé dans la règle de
<tt>nat</tt>. Ce mot-clé permettra aux paquets traduits
d'être autorisés immédiatement par le pare- feu.
d153 3
a155 3
Il est à noter que la traduction a lieu <i>avant</i> le filtrage.
Ce qui veut dire que le pare-feu verra le paquet <i>traduit</i> avec
l'adresse IP et le port traduits tel que c'est expliqué dans
d163 4
a166 5
Vu que la NAT est utilisée la plupart du temps sur des routeurs
et des passerelles réseau, il sera probablement nécessaire
d'activer le routage IP pour permettre aux paquets de traverser les
interfaces réseau du système OpenBSD. Le routage IP peut
être activé à l'aide du mécanisme
d188 3
a190 4
Ces lignes sont déjà présentes dans l'installation
par défaut mais sont commentées (préfixées
avec un caractère <tt>#</tt>). Supprimez le <tt>#</tt> et
sauvegardez le fichier. Le routage IP sera désormais
d195 2
a196 2
Le format général des règles de NAT dans
<tt>pf.conf</tt> est le suivant :
d208 1
a208 2
<dd>Le mot-clé qui permet de créer une règle de
    NAT.
d211 2
a212 3
<dd>Permet aux paquets traduits de contourner complètement les
    règles de filtrage et d'être autorisés
    systèmatiquement par le pare-feu.
d220 2
a221 2
    pour IPv6. PF est normalement capable de déterminer ce
    paramètre à partir des adresses source/destination.
d225 1
a225 2
    L'adresse source peut être spécifiée de
    plusieurs manières :
d230 6
a235 7
<li>Un nom de domaine au format FQDN qui sera résolu via DNS
    lorsque les règles seront chargées. Ce nom de domaine
    sera remplacé par toutes les adresses IP résultant de
    la résolution.
<li>Un nom d'interface réseau. Ce nom sera remplacé par
    toutes les adresses IP attribuées à cette interface au
    moment du chargement des règles.
d237 6
a242 6
    (<tt>/24</tt> par exemple). Chaque adresse IP attribuée
    à l'interface sera combinée avec le netmask pour
    former un bloc réseau en notation CIDR. Le résultat
    remplacera la spécification initiale dans la règle.
<li>Le nom d'une interface réseau suivie par un modificateur
    parmi les modificateurs suivants :
d252 5
a256 6
  <dd>De plus, le modificateur <tt>:0</tt> peut être ajouté
      au nom de l'interface ou à l'un des modificateurs
      précités pour indiquer à PF que les alias IP
      ne doivent pas être inclus dans la substitution. Ces
      modificateurs peuvent aussi être utilisés lorsque le
      nom de l'interface est entre parenthèses. Exemple :
d261 2
a262 3
<li>N'importe quelle spécification précitée
    préfixée du modificateur <tt>!</tt> ("not") pour
    indiquer la négation.
d276 2
a277 1
<li>Un ensemble de ports sous forme de <a href="macros.html#lists">liste</a>
d288 3
a290 3
        <dd>Les deux derniers opérateurs sont des
            opérateurs binaires (ils prennent deux arguments) et
            n'incluent pas les arguments dans l'intervalle.
d295 2
a296 3
            opérateur binaire mais contrairement aux deux
            opérateurs précédents, il inclut les
            arguments dans l'intervalle.
d300 3
a302 3
L'option <tt>port</tt> n'est pas habituellement utilisée dans les
règles <tt>nat</tt> vu que le but est souvent de traduire tout le
trafic peu importe le(s) port(s) utilisé(s).
d306 1
a306 2
    destination est spécifiée de la même
    manière que l'adresse source.
d309 2
a310 3
<dd>Le port destination dans l'en-tête du paquet (couche 4). Ce
    port est spécifié de la même manière que
    le port source.
d320 14
a333 16
<li>Un nom de domaine au format FQDN qui sera résolu via DNS
    lorsque les règles seront chargées. Ce nom de domaine
    sera remplacé par toutes les adresses IP résultant de
    la résolution.
<li>Le nom de l'interface réseau externe. Ce nom sera
    remplacé par toutes les adresses IP attribuées
    à cette interface au moment du chargement des règles.
<li>Le nom de l'interface réseau externe entouré de
    parenthèses <tt>( )</tt>. Ceci permet à PF de mettre
    à jour la règle si l'adresse ou les adresses IP de
    cette interface change(nt). C'est très utile lorsque
    l'interface obtient son adresse IP via DHCP ou un système dial-
    up. Dans ce cas, les règles n'ont pas à être
    rechargées chaque fois que l'adresse change.
<li>Le nom d'une interface réseau suivie par un modificateur
    parmi les modificateurs suivants :
d342 5
a346 6
  <dd>De plus, le modificateur <tt>:0</tt> peut être ajouté
      au nom de l'interface ou à l'un des modificateurs
      précités pour indiquer à PF que les alias IP
      ne doivent pas être inclus dans la substitution Ces
      modificateurs peuvent aussi être utilisés lorsque le
      nom de l'interface est entre parenthèses. Exemple :
d354 2
a355 2
<dd>Spécifie le type de <a href="pools.html">pool d'adresses</a>
    à utiliser pour la traduction.
d358 2
a359 2
<dd>Si cette option est utilisée, PF ne traduira pas le port
    source des paquets TCP et UDP.
d372 3
a374 3
Cette règle permet d'effectuer la NAT sur l'interface
<tt>tl0</tt> sur tout paquet provenant de 192.168.1.0/24 et remplace
l'adresse IP source par 24.5.0.5.
d377 4
a380 5
Bien que cette règle soit correcte, ce n'est pas la forme
recommandée. La maintenance peut s'avérer difficile vu que
toute modification des adresses réseau externe ou interne
nécessitera une modification de la règle. La forme
suivante est plus facile à maintenir (<tt>tl0</tt> est
d390 1
a390 2
changer les adresses IP des deux interfaces sans changer la
règle.
d393 9
a401 11
Lorsque vous spécifiez un nom d'interface comme adresse de
traduction tel que c'est fait dans la règle ci-dessus, l'adresse
IP est déterminée lors du <i>chargement</i> de pf.conf.
Elle n'est pas déterminée à la volée. Si
vous utilisez DHCP pour configurer votre interface externe, ceci peut
poser problème. Par exemple, si l'adresse qui vous est
attribuée change, le système de NAT continuera à
traduire les paquets sortants en utilisant l'ancienne adresse IP. Les
connexions sortantes ne fonctionneront donc plus. Pour éviter ce
problème, vous pouvez dire à PF de mettre à jour
automatiquement l'adresse de traduction en mettant des
d410 2
a411 2
Cette méthode fonctionne aussi bien pour la traduction d'adresses
IPv6 que pour la traduction d'adresses IPv4.
d416 12
a427 14
Une mise en correspondance bidirectionnelle (traduction 1 à 1)
peut être établie en utilisant une règle
<tt>binat</tt>. Une règle <tt>binat</tt> établit une
correspondance 1 à 1 entre une adresse IP interne et une adresse
externe. Ceci peut être pratique par exemple pour permettre
à un serveur web interne d'avoir sa propre adresse de traduction
externe. Les connexions en provenance d'Internet à destination de
cette adresse externe seront acheminées vers l'adresse interne du
serveur web. Quant aux requêtes émanant du serveur web
(telles que les requêtes DNS), elles seront traduites de telle
façon à remplacer l'adresse interne par l'adresse externe
de traduction attribuée au serveur web. Contrairement aux
règles <tt>nat</tt>, les règles <tt>binat</tt> ne
modifient jamais les ports TCP.
d442 2
a443 3
Des exceptions aux règles de traduction peuvent être faites
en utilisant le mot-clé <tt>no</tt>. Par exemple, si la
règle de NAT précédente était
d453 2
a454 3
Alors tous les paquets du réseau 192.168.1.0/24 seront traduits
avec l'adresse externe 24.2.74.79 excepté pour la machine
192.168.1.10.
d457 5
a461 6
Il est à noter que la première règle à
laquelle un paquet correspond est appliquée et aucune
évaluation supplémentaire n'est effectuée. S'il y a
une règle <tt>no</tt>, alors le paquet n'est pas traduit. Le mot-
clé <tt>no</tt> peut être utilisé avec les
règles <tt>binat</tt> et <a href="rdr.html"><tt>rdr</tt></a>.
d482 1
a482 1
<tt>self</tt> apparaîtra si la session est de type
d493 3
a495 4
<dd>L'adresse IP (192.168.1.35) de la machine sur le réseau
    interne. Le port source (2132) est affiché après
    l'adresse. C'est aussi l'adresse qui sera remplacée au niveau
    de l'en-tête IP.
d501 1
a501 1
utilisés pour la traduction.
d507 1
a507 1
interne est connectée.
d528 1
a528 1
$Translation: nat.html,v 1.4 2004/10/11 12:24:36 saad Exp $<br>
@


1.3
log
@Sync with Steelix CVS
@
text
@d37 1
a37 1
[<a href="filter.html">Pr&eacute;c&eacute;dent : Filtrage de Paquets</a>]
d46 1
a46 1
<h3>Table des Mati&egrave;res</h3>
d55 2
a56 2
<li><a href="#except">Exceptions aux R&egrave;gles de Traduction</a>
<li><a href="#status">V&eacute;rification de l'&eacute;tat de la NAT</a>
d63 5
a67 5
La traduction d'adresses IP (NAT) est un m&eacute;canisme destin&eacute;
&agrave; faire correspondre un r&eacute;seau entier (ou des
r&eacute;seaux) &agrave; une seule adresse IP. Un tel m&eacute;canisme
est n&eacute;cessaire lorsque le nombre des adresses IP qui vous sont
attribu&eacute;es par votre Fournisseur d'Acc&egrave;s Internet est plus
d69 2
a70 2
b&eacute;n&eacute;ficier d'une connexion Internet. La NAT est
d&eacute;crite dans la
d74 2
a75 2
La NAT vous permet de b&eacute;n&eacute;ficier des blocs d'adressage
priv&eacute;s d&eacute;crits dans la
d77 2
a78 2
Typiquement, votre r&eacute;seau interne sera param&eacute;tr&eacute; de
telle fa&ccedil;on &agrave; utiliser un ou plusieurs blocs r&eacute;seau
d87 7
a93 7
Un syst&egrave;me OpenBSD mettant en oeuvre la NAT aura au moins deux
cartes r&eacute;seau dont une est connect&eacute;e &agrave; Internet;
l'autre &eacute;tant connect&eacute;e &agrave; votre r&eacute;seau
interne. La NAT traduit les requ&ecirc;tes en provenance de votre
r&eacute;seau interne de telle fa&ccedil;on &agrave; les faire
appara&icirc;tre comme si elles &eacute;taient
g&eacute;n&eacute;r&eacute;es par votre syst&egrave;me de NAT OpenBSD.
d98 2
a99 2
Lorsqu'un client du r&eacute;seau interne entre en communication avec
une machine sur Internet, il envoie des paquets IP &agrave; destination
d101 1
a101 1
leur &eacute;metteur et leur destinaitaire n&eacute;cessaires &agrave;
d110 2
a111 2
Lorsque les paquets passent &agrave; travers la passerelle NAT, ils
seront modifi&eacute;s de telle fa&ccedil;on &agrave; ce qu'ils semblent
d113 1
a113 1
modifications effectu&eacute;es dans sa table d'&eacute;tats afin de a)
d115 3
a117 3
que les paquets de retour sont autoris&eacute;s &agrave; travers le pare-
feu et ne sont pas bloqu&eacute;s. Par exemple, les modifications
suivantes peuvent &ecirc;tre effectu&eacute;es :
d119 1
a119 1
<li>Adresse IP source : remplac&eacute;e par l'adresse externe de la
d121 2
a122 2
<li>Port source : remplac&eacute; par un port non utilis&eacute; sur la
    passerelle et choisi de mani&egrave;re al&eacute;atoire (53136 par
d127 2
a128 2
Aucune des deux extr&ecirc;mit&eacute;s de la communication ne se rend
compte de ces modifications. Pour la machine interne, le syst&egrave;me
d130 2
a131 2
h&ocirc;te Internet, les paquets semblent provenir directement du
syst&egrave;me de NAT; il ne sait m&ecirc;me pas que la machine interne
d135 11
a145 11
Lorsque le h&ocirc;te Internet r&eacute;pond aux paquets de la machine
interne, ils seront envoy&eacute;s &agrave; l'adresse IP externe de la
passerelle NAT (24.5.0.5) sur le port de traduction (53136). D&egrave;s
r&eacute;ception de ces paquets, la passerelle NAT cherchera dans sa
table d'&eacute;tats si ces paquets de retour correspondent &agrave; une
connexion d&eacute;j&agrave; &eacute;tablie. Une correspondance unique
sera trouv&eacute;e, bas&eacute;e sur la combinaison IP/port qui permet
&agrave; PF de voir que les paquets appartiennent &agrave; une connexion
initi&eacute;e par la machine interne 192.168.1.35. PF effectuera les
modifications inverses &agrave; celles effectu&eacute;es sur les paquets
sortants puis enverra ces paquets &agrave; la machine interne.
d148 1
a148 1
La traduction de paquets ICMP s'effectue de mani&egrave;re similaire
d156 6
a161 6
&ecirc;tre &eacute;valu&eacute;s par le m&eacute;canisme pare-feu
suivant les r&egrave;gles de filtrage d&eacute;finies.
La <i>seule</i> exception &agrave; cette r&egrave;gle est lorsque le mot-
cl&eacute; <tt>pass</tt> est utilis&eacute; dans la r&egrave;gle de
<tt>nat</tt>. Ce mot-cl&eacute; permettra aux paquets traduits
d'&ecirc;tre autoris&eacute;s imm&eacute;diatement par le pare- feu.
d164 1
a164 1
Il est &agrave; noter que la traduction a lieu <i>avant</i> le filtrage.
d166 1
a166 1
l'adresse IP et le port traduits tel que c'est expliqu&eacute; dans
d174 2
a175 2
Vu que la NAT est utilis&eacute;e la plupart du temps sur des routeurs
et des passerelles r&eacute;seau, il sera probablement n&eacute;cessaire
d177 2
a178 2
interfaces r&eacute;seau du syst&egrave;me OpenBSD. Le routage IP peut
&ecirc;tre activ&eacute; &agrave; l'aide du m&eacute;canisme
d184 1
a184 1
# sysctl net.inet6.ip6.forwarding=1 <i>(si Ipv6 est utilis&eacute;)</i>
d190 1
a190 1
&ecirc;tre ajout&eacute;es au fichier
d200 5
a204 5
Ces lignes sont d&eacute;j&agrave; pr&eacute;sentes dans l'installation
par d&eacute;faut mais sont comment&eacute;es (pr&eacute;fix&eacute;es
avec un caract&egrave;re <tt>#</tt>). Supprimez le <tt>#</tt> et
sauvegardez le fichier. Le routage IP sera d&eacute;sormais
activ&eacute; automatiquement &agrave; chaque red&eacute;marrage.
d208 1
a208 1
Le format g&eacute;n&eacute;ral des r&egrave;gles de NAT dans
d221 1
a221 1
<dd>Le mot-cl&eacute; qui permet de cr&eacute;er une r&egrave;gle de
d225 3
a227 3
<dd>Permet aux paquets traduits de contourner compl&egrave;tement les
    r&egrave;gles de filtrage et d'&ecirc;tre autoris&eacute;s
    syst&egrave;matiquement par le pare-feu.
d230 1
a230 1
<dd>Le nom de l'interface r&eacute;seau sur laquelle les paquets seront
d235 2
a236 2
    pour IPv6. PF est normalement capable de d&eacute;terminer ce
    param&egrave;tre &agrave; partir des adresses source/destination.
d240 2
a241 2
    L'adresse source peut &ecirc;tre sp&eacute;cifi&eacute;e de
    plusieurs mani&egrave;res :
d244 1
a244 1
<li>Un bloc r&eacute;seau en notation 
d246 13
a258 13
<li>Un nom de domaine au format FQDN qui sera r&eacute;solu via DNS
    lorsque les r&egrave;gles seront charg&eacute;es. Ce nom de domaine
    sera remplac&eacute; par toutes les adresses IP r&eacute;sultant de
    la r&eacute;solution.
<li>Un nom d'interface r&eacute;seau. Ce nom sera remplac&eacute; par
    toutes les adresses IP attribu&eacute;es &agrave; cette interface au
    moment du chargement des r&egrave;gles.
<li>Un nom d'interface r&eacute;seau suivi d'un <tt>/<i>netmask</i></tt>
    (<tt>/24</tt> par exemple). Chaque adresse IP attribu&eacute;e
    &agrave; l'interface sera combin&eacute;e avec le netmask pour
    former un bloc r&eacute;seau en notation CIDR. Le r&eacute;sultat
    remplacera la sp&eacute;cification initiale dans la r&egrave;gle.
<li>Le nom d'une interface r&eacute;seau suivie par un modificateur
d261 1
a261 1
  <li><tt>:network</tt> - remplace le bloc r&eacute;seau en notation
d264 1
a264 1
      r&eacute;seau (192.168.0.255 par exemple)
d266 1
a266 1
      communication point-&agrave;-point
d269 6
a274 6
  <dd>De plus, le modificateur <tt>:0</tt> peut &ecirc;tre ajout&eacute;
      au nom de l'interface ou &agrave; l'un des modificateurs
      pr&eacute;cit&eacute;s pour indiquer &agrave; PF que les alias IP
      ne doivent pas &ecirc;tre inclus dans la substitution. Ces
      modificateurs peuvent aussi &ecirc;tre utilis&eacute;s lorsque le
      nom de l'interface est entre parenth&egrave;ses. Exemple :
d279 3
a281 3
<li>N'importe quelle sp&eacute;cification pr&eacute;cit&eacute;e
    pr&eacute;fix&eacute;e du modificateur <tt>!</tt> ("not") pour
    indiquer la n&eacute;gation.
d284 1
a284 1
<li>Le mot-cl&eacute; <tt>any</tt> signifiant toutes les adresses
d288 2
a289 2
<dd>Le port source dans l'en-t&ecirc;te du paquet (couche 4). Les ports
    peuvent sp&eacute;cifi&eacute;s de la mani&egrave;re suivante :
d298 5
a302 5
        <li><tt>!=</tt> (diff&eacute;rent de)
        <li><tt>&lt;</tt> (inf&eacute;rieur &agrave;)
        <li><tt>&gt;</tt> (sup&eacute;rieur &agrave;)
        <li><tt>&lt;=</tt> (inf&eacute;rieur ou &eacute;gal &agrave;)
        <li><tt>&gt;=</tt> (sup&eacute;rieur ou &eacute;gal &agrave;)
d306 2
a307 2
        <dd>Les deux derniers op&eacute;rateurs sont des
            op&eacute;rateurs binaires (ils prennent deux arguments) et
d312 3
a314 3
        <dd>L'op&eacute;rateur d'intervalle avec inclusion est aussi un
            op&eacute;rateur binaire mais contrairement aux deux
            op&eacute;rateurs pr&eacute;c&eacute;dents, il inclut les
d319 3
a321 3
L'option <tt>port</tt> n'est pas habituellement utilis&eacute;e dans les
r&egrave;gles <tt>nat</tt> vu que le but est souvent de traduire tout le
trafic peu importe le(s) port(s) utilis&eacute;(s).
d324 3
a326 3
<dd>L'adresse destination des paquets &agrave; traduire. L'adresse de
    destination est sp&eacute;cifi&eacute;e de la m&ecirc;me
    mani&egrave;re que l'adresse source.
d329 2
a330 2
<dd>Le port destination dans l'en-t&ecirc;te du paquet (couche 4). Ce
    port est sp&eacute;cifi&eacute; de la m&ecirc;me mani&egrave;re que
d336 1
a336 1
    L'adresse externe peut &ecirc;tre sp&eacute;cifi&eacute;e comme suit :
d339 1
a339 1
<li>Un bloc r&eacute;seau en notation 
d341 15
a355 15
<li>Un nom de domaine au format FQDN qui sera r&eacute;solu via DNS
    lorsque les r&egrave;gles seront charg&eacute;es. Ce nom de domaine
    sera remplac&eacute; par toutes les adresses IP r&eacute;sultant de
    la r&eacute;solution.
<li>Le nom de l'interface r&eacute;seau externe. Ce nom sera
    remplac&eacute; par toutes les adresses IP attribu&eacute;es
    &agrave; cette interface au moment du chargement des r&egrave;gles.
<li>Le nom de l'interface r&eacute;seau externe entour&eacute; de
    parenth&egrave;ses <tt>( )</tt>. Ceci permet &agrave; PF de mettre
    &agrave; jour la r&egrave;gle si l'adresse ou les adresses IP de
    cette interface change(nt). C'est tr&egrave;s utile lorsque
    l'interface obtient son adresse IP via DHCP ou un syst&egrave;me dial-
    up. Dans ce cas, les r&egrave;gles n'ont pas &agrave; &ecirc;tre
    recharg&eacute;es chaque fois que l'adresse change.
<li>Le nom d'une interface r&eacute;seau suivie par un modificateur
d358 1
a358 1
  <li><tt>:network</tt> - remplace le bloc r&eacute;seau en notation
d361 1
a361 1
      communication point-&agrave;-point
d365 6
a370 6
  <dd>De plus, le modificateur <tt>:0</tt> peut &ecirc;tre ajout&eacute;
      au nom de l'interface ou &agrave; l'un des modificateurs
      pr&eacute;cit&eacute;s pour indiquer &agrave; PF que les alias IP
      ne doivent pas &ecirc;tre inclus dans la substitution Ces
      modificateurs peuvent aussi &ecirc;tre utilis&eacute;s lorsque le
      nom de l'interface est entre parenth&egrave;ses. Exemple :
d378 2
a379 2
<dd>Sp&eacute;cifie le type de <a href="pools.html">pool d'adresses</a>
    &agrave; utiliser pour la traduction.
d382 1
a382 1
<dd>Si cette option est utilis&eacute;e, PF ne traduira pas le port
d396 1
a396 1
Cette r&egrave;gle permet d'effectuer la NAT sur l'interface
d401 5
a405 5
Bien que cette r&egrave;gle soit correcte, ce n'est pas la forme
recommand&eacute;e. La maintenance peut s'av&eacute;rer difficile vu que
toute modification des adresses r&eacute;seau externe ou interne
n&eacute;cessitera une modification de la r&egrave;gle. La forme
suivante est plus facile &agrave; maintenir (<tt>tl0</tt> est
d414 1
a414 1
L'avantage de cette forme doit &ecirc;tre clair maintenant : vous pouvez
d416 1
a416 1
r&egrave;gle.
d419 4
a422 4
Lorsque vous sp&eacute;cifiez un nom d'interface comme adresse de
traduction tel que c'est fait dans la r&egrave;gle ci-dessus, l'adresse
IP est d&eacute;termin&eacute;e lors du <i>chargement</i> de pf.conf.
Elle n'est pas d&eacute;termin&eacute;e &agrave; la vol&eacute;e. Si
d424 2
a425 2
poser probl&egrave;me. Par exemple, si l'adresse qui vous est
attribu&eacute;e change, le syst&egrave;me de NAT continuera &agrave;
d427 2
a428 2
connexions sortantes ne fonctionneront donc plus. Pour &eacute;viter ce
probl&egrave;me, vous pouvez dire &agrave; PF de mettre &agrave; jour
d430 1
a430 1
parenth&egrave;ses autour du nom de l'interface :
d438 1
a438 1
Cette m&eacute;thode fonctionne aussi bien pour la traduction d'adresses
d444 13
a456 13
Une mise en correspondance bidirectionnelle (traduction 1 &agrave; 1)
peut &ecirc;tre &eacute;tablie en utilisant une r&egrave;gle
<tt>binat</tt>. Une r&egrave;gle <tt>binat</tt> &eacute;tablit une
correspondance 1 &agrave; 1 entre une adresse IP interne et une adresse
externe. Ceci peut &ecirc;tre pratique par exemple pour permettre
&agrave; un serveur web interne d'avoir sa propre adresse de traduction
externe. Les connexions en provenance d'Internet &agrave; destination de
cette adresse externe seront achemin&eacute;es vers l'adresse interne du
serveur web. Quant aux requ&ecirc;tes &eacute;manant du serveur web
(telles que les requ&ecirc;tes DNS), elles seront traduites de telle
fa&ccedil;on &agrave; remplacer l'adresse interne par l'adresse externe
de traduction attribu&eacute;e au serveur web. Contrairement aux
r&egrave;gles <tt>nat</tt>, les r&egrave;gles <tt>binat</tt> ne
d471 5
a475 5
<h2>Exceptions aux R&egrave;gles de Traduction</h2>
Des exceptions aux r&egrave;gles de traduction peuvent &ecirc;tre faites
en utilisant le mot-cl&eacute; <tt>no</tt>. Par exemple, si la
r&egrave;gle de NAT pr&eacute;c&eacute;dente &eacute;tait
modifi&eacute;e de la mani&egrave;re suivante :
d484 2
a485 2
Alors tous les paquets du r&eacute;seau 192.168.1.0/24 seront traduits
avec l'adresse externe 24.2.74.79 except&eacute; pour la machine
d489 6
a494 6
Il est &agrave; noter que la premi&egrave;re r&egrave;gle &agrave;
laquelle un paquet correspond est appliqu&eacute;e et aucune
&eacute;valuation suppl&eacute;mentaire n'est effectu&eacute;e. S'il y a
une r&egrave;gle <tt>no</tt>, alors le paquet n'est pas traduit. Le mot-
cl&eacute; <tt>no</tt> peut &ecirc;tre utilis&eacute; avec les
r&egrave;gles <tt>binat</tt> et <a href="rdr.html"><tt>rdr</tt></a>.
d497 1
a497 1
<h2>V&eacute;rification de l'&eacute;tat de la NAT</h2>
d510 1
a510 1
Explications (premi&egrave;re ligne uniquement) :
d514 2
a515 2
<dd>Indique l'interface &agrave; laquelle est rattach&eacute;e la session. Le mot-cl&eacute;
<tt>self</tt> appara&icirc;tra si la session est de type
d521 1
a521 1
<dd>Le protocole utilis&eacute; par la connexion.
d526 4
a529 4
<dd>L'adresse IP (192.168.1.35) de la machine sur le r&eacute;seau
    interne. Le port source (2132) est affich&eacute; apr&egrave;s
    l'adresse. C'est aussi l'adresse qui sera remplac&eacute;e au niveau
    de l'en-t&ecirc;te IP.
d535 1
a535 1
utilis&eacute;s pour la traduction.
d541 1
a541 1
interne est connect&eacute;e.
d547 1
a547 1
<dd>Indique l'&eacute;tat de la connexion TCP, vu par PF.
d551 1
a551 1
[<a href="filter.html">Pr&eacute;c&eacute;dent : Filtrage de Paquets</a>]
d562 1
a562 1
$Translation: nat.html,v 1.3 2004/10/06 17:17:44 saad Exp $<br>
@


1.2
log
@Sync with Steelix CVS
@
text
@d37 1
a37 1
[<a href="../filter.html">Pr&eacute;c&eacute;dent : Filtrage de Paquets</a>]
d551 1
a551 1
[<a href="../filter.html">Pr&eacute;c&eacute;dent : Filtrage de Paquets</a>]
d562 1
a562 1
$Translation: nat.html,v 1.2 2004/08/26 08:12:57 saad Exp $<br>
@


1.1
log
@sync with Steelix CVS
@
text
@d37 1
a37 1
[<a href="../filter.html">Précédent : Filtrage de Paquets</a>]
d46 1
a46 1
<h3>Table des Matières</h3>
d55 2
a56 2
<li><a href="#except">Exceptions aux Règles de Traduction</a>
<li><a href="#status">Vérification de l'état de la NAT</a>
d63 8
a70 6
La traduction d'adresses IP (NAT) est un mécanisme destiné à faire
correspondre un réseau entier (ou des réseaux) à une seule adresse IP.
Un tel mécanisme est nécessaire lorsque le nombre des adresses IP qui
vous sont attribuées par votre Fournisseur d'Accès Internet est plus
petit que le nombre de machines qui doivent pouvoir bénéficier d'une
connexion Internet. La NAT est décrite dans la
d74 2
a75 2
La NAT vous permet de bénéficier des blocs d'adressage privés décrits
dans la
d77 3
a79 2
Typiquement, votre réseau interne sera paramétré de telle façon à
utiliser un ou plusieurs blocs réseau parmi les blocs suivants :
d81 3
a83 3
	10.0.0.0/8       (10.0.0.0 - 10.255.255.255)
	172.16.0.0/12    (172.16.0.0 - 172.31.255.255)
	192.168.0.0/16   (192.168.0.0 - 192.168.255.255)
d87 7
a93 5
Un système OpenBSD mettant en oeuvre la NAT aura au moins deux cartes
réseau dont une est connectée à Internet; l'autre étant connectée à
votre réseau interne. La NAT traduit les requêtes en provenance de
votre réseau interne de telle façon à les faire apparaître comme si
elles étaient générées par votre système de NAT OpenBSD.
d98 6
a103 5
Lorsqu'un client du réseau interne entre en communication avec une machine sur Internet,
il envoie des paquets IP à destination de cette machine. Ces paquets
contiennent toutes les informations sur leur émetteur et leur
destinaitaire nécessaires à leur bon acheminement. La NAT prend en
compte les informations suivantes :
d110 8
a117 7
Lorsque les paquets passent à travers la passerelle NAT, ils seront
modifiés de telle façon à ce qu'ils semblent provenir de la
passerelle NAT. Cette passerelle enregistrera les modifications
effectuées dans sa table d'états afin de a) inverser les modifications
pour les paquets de retour et b) s'assurer que les paquets de retour
sont autorisés à travers le pare-feu et ne sont pas bloqués. Par
exemple, les modifications suivantes peuvent être effectuées :
d119 5
a123 4
<li>Adresse IP source : remplacée par l'adresse externe de la passerelle 
(24.5.0.5 par exemple)
<li>Port source : remplacé par un port non utilisé sur la passerelle et choisi de manière
aléatoire (53136 par exemple)
d127 19
a145 17
Aucune des deux extrêmités de la communication ne se rend compte de ces
modifications. Pour la machine interne, le système qui effectue la NAT
est simplement une passerelle Internet. Pour le hôte Internet, les
paquets semblent provenir directement du système de NAT; il ne sait même
pas que la machine interne existe.

<p>
Lorsque le hôte Internet répond aux paquets de la machine interne, ils
seront envoyés à l'adresse IP externe de la passerelle NAT
(24.5.0.5) sur le port de traduction (53136). Dès réception de ces
paquets, la passerelle NAT cherchera dans sa table d'états si ces
paquets de retour correspondent à une connexion déjà établie. Une
correspondance unique sera trouvée, basée sur la combinaison IP/port qui
permet à PF de voir que les paquets appartiennent à une connexion
initiée par la machine interne 192.168.1.35. PF effectuera les
modifications inverses à celles effectuées sur les paquets sortants puis
enverra ces paquets à la machine interne.
d148 2
a149 2
La traduction de paquets ICMP s'effectue de manière similaire mais sans
la modification du port source.
d155 7
a161 7
Les paquets traduits doivent, comme n'importe quel autre paquet, être
évalués par le mécanisme pare-feu suivant les règles de filtrage
définies.
La <i>seule</i> exception à cette règle est lorsque le mot-clé
<tt>pass</tt> est utilisé dans la règle de <tt>nat</tt>. 
Ce mot-clé permettra aux paquets traduits d'être autorisés immédiatement
par le pare-feu.
d164 3
a166 3
Il est à noter que la traduction a lieu <i>avant</i> le filtrage. Ce qui
veut dire que le pare-feu verra le paquet <i>traduit</i> avec l'adresse
IP et le port traduits tel que c'est expliqué dans
d174 5
a178 5
Vu que la NAT est utilisée la plupart du temps sur des routeurs et des
passerelles réseau, il sera probablement nécessaire d'activer le routage
IP pour permettre aux paquets de traverser les interfaces réseau du
système OpenBSD.
Le routage IP peut être activé à l'aide du mécanisme
d183 2
a184 2
# sysctl -w net.inet.ip.forwarding=1<br>
# sysctl -w net.inet6.ip6.forwarding=1 <i>(if using IPv6)</i>
d190 1
a190 1
être ajoutées au fichier
d200 5
a204 4
Ces lignes sont déjà présentes dans l'installation par défaut mais sont
commentées (préfixées avec un caractère <tt>#</tt>). Supprimez le
<tt>#</tt> et sauvegardez le fichier. Le routage IP sera désormais
activé automatiquement à chaque redémarrage.
d208 2
a209 2
Le format général des règles de NAT dans <tt>pf.conf</tt> est le suivant
:
d221 2
a222 1
<dd>Le mot-clé qui permet de créer une règle de NAT.
d225 3
a227 2
<dd>Permet aux paquets traduits de contourner complètement les règles de
filtrage et d'être autorisés systèmatiquement par le pare-feu.
d230 2
a231 2
<dd>Le nom de l'interface réseau sur laquelle les paquets seront
traduits.
d235 2
a236 2
pour IPv6. PF est normalement capable de déterminer ce paramètre à
partir des adresses source/destination.
d240 2
a241 1
L'adresse source peut être spécifiée de plusieurs manières :
d244 1
a244 1
<li>Un bloc réseau en notation 
d246 14
a259 13
<li>Un nom de domaine au format FQDN qui sera résolu via DNS
lorsque les règles seront chargées. Ce nom de domaine sera remplacé par
toutes les adresses IP résultant de la résolution.
<li>Un nom d'interface réseau. Ce nom sera remplacé par toutes les
adresses IP attribuées à cette interface au moment du chargement des
règles.
<li>Un nom d'interface réseau suivi d'un
<tt>/<i>netmask</i></tt> (<tt>/24</tt> par exemple). Chaque adresse IP
attribuée à l'interface sera combinée avec le netmask pour former un
bloc réseau en notation CIDR. Le résultat remplacera la spécification
initiale dans la règle.
<li>Le nom d'une interface réseau suivie par un modificateur parmi les
modificateurs suivants :
d261 4
a264 4
  <li><tt>:network</tt> - remplace le bloc réseau en notation CIDR
(192.168.0.0/24 par exemple)
  <li><tt>:broadcast</tt> - remplace l'adresse de broadcast réseau
(192.168.0.255 par exemple)
d266 1
a266 1
communication point-à-point
d269 7
a275 6
  <dd>De plus, le modificateur <tt>:0</tt> peut être ajouté au nom de
l'interface ou à l'un des modificateurs précités pour indiquer à PF que
les alias IP ne doivent pas être inclus dans la substitution.
Ces modificateurs peuvent aussi être utilisés lorsque le nom de
l'interface est entre parenthèses.
  Exemple : <tt>fxp0:network:0</tt>
d277 1
d279 3
a281 2
<li>N'importe quelle spécification précitée préfixée du modificateur
<tt>!</tt> ("not") pour indiquer la négation.
d284 1
a284 1
<li>Le mot-clé <tt>any</tt> signifiant toutes les adresses
d288 2
a289 2
<dd>Le port source dans l'en-tête du paquet (couche 4). Les ports
peuvent spécifiés de la manière suivante :
d297 21
a317 20
	<ul>
	<li><tt>!=</tt> (différent de)
	<li><tt>&lt;</tt> (inférieur à)
	<li><tt>&gt;</tt> (supérieur à)
	<li><tt>&lt;=</tt> (inférieur ou égal à)
	<li><tt>&gt;=</tt> (supérieur ou égal à)
	<li><tt>&gt;&lt;</tt> (intervalle)
	<li><tt>&lt;&gt;</tt> (intervalle inverse)
	<dl>
	<dd>Les deux derniers opérateurs sont des opérateurs binaires
	(ils prennent deux arguments) et n'incluent pas les arguments
	dans l'intervalle.
	</dl>
	<li><tt>:</tt> (intervalle avec inclusion)
	<dl>
	<dd>L'opérateur d'intervalle avec inclusion est aussi un
	opérateur binaire mais contrairement aux deux opérateurs
	précédents, il inclut les arguments dans l'intervalle.
	</dl>
	</ul>
d319 3
a321 3
L'option <tt>port</tt> n'est pas habituellement utilisée dans les règles
<tt>nat</tt> vu que le but est souvent de traduire tout le trafic peu
importe le(s) port(s) utilisé(s).
d324 3
a326 2
<dd>L'adresse destination des paquets à traduire. L'adresse de
destination est spécifiée de la même manière que l'adresse source.
d329 3
a331 2
<dd>Le port destination dans l'en-tête du paquet (couche 4). Ce port est
spécifié de la même manière que le port source.
d335 2
a336 2
l'adresse qui figurera dans les paquets une fois ceux-ci traduits.
L'adresse externe peut être spécifiée comme suit :
d339 1
a339 1
<li>Un bloc réseau en notation 
d341 16
a356 14
<li>Un nom de domaine au format FQDN qui sera résolu via DNS
lorsque les règles seront chargées. Ce nom de domaine sera remplacé par
toutes les adresses IP résultant de la résolution.
<li>Le nom de l'interface réseau externe. Ce nom sera remplacé par toutes les
adresses IP attribuées à cette interface au moment du chargement des
règles.
<li>Le nom de l'interface réseau externe entouré de parenthèses <tt>(
)</tt>. Ceci permet à PF de mettre à jour la règle si l'adresse ou les
adresses IP de cette interface change(nt). C'est très utile lorsque
l'interface obtient son adresse IP via DHCP ou un système dial-up. Dans
ce cas, les règles n'ont pas à être rechargées chaque fois que l'adresse
change.
<li>Le nom d'une interface réseau suivie par un modificateur parmi les
modificateurs suivants :
d358 2
a359 2
  <li><tt>:network</tt> - remplace le bloc réseau en notation CIDR
(192.168.0.0/24 par exemple)
d361 1
a361 1
communication point-à-point
d365 7
a371 7
  <dd>De plus, le modificateur <tt>:0</tt> peut être ajouté au nom de
  l'interface ou à l'un des modificateurs précités pour indiquer à PF
  que
  les alias IP ne doivent pas être inclus dans la substitution
  Ces modificateurs peuvent aussi être utilisés lorsque le nom de
  l'interface est entre parenthèses.
  Exemple : <tt>fxp0:network:0</tt>
d378 2
a379 2
<dd>Spécifie le type de <a href="pools.html">pool d'adresses</a> à
utiliser pour la traduction.
d382 2
a383 2
<dd>Si cette option est utilisée, PF ne traduira pas le port source des
paquets TCP et UDP.
d396 3
a398 3
Cette règle permet d'effectuer la NAT sur l'interface <tt>tl0</tt> sur
tout paquet provenant de 192.168.1.0/24 et remplace l'adresse IP source
par 24.5.0.5.
d401 5
a405 4
Bien que cette règle soit correcte, ce n'est pas la forme recommandée.
La maintenance peut s'avérer difficile vu que toute modification des
adresses réseau externe ou interne nécessitera une modification de la
règle. La forme suivante est plus facile à maintenir (<tt>tl0</tt> est
d414 17
a430 14
L'avantage de cette forme doit être clair maintenant : vous pouvez
changer les adresses IP des deux interfaces sans changer la règle.

<p>
Lorsque vous spécifiez un nom d'interface comme adresse de traduction
tel que c'est fait dans la règle ci-dessus, l'adresse IP est déterminée
lors du <i>chargement</i> de pf.conf. Elle n'est pas déterminée à la
volée. Si vous utilisez DHCP pour configurer votre interface externe,
ceci peut poser problème. Par exemple, si l'adresse qui vous est
attribuée change, le système de NAT continuera à traduire les paquets
sortants en utilisant l'ancienne adresse IP. Les connexions sortantes ne
fonctionneront donc plus. Pour éviter ce problème, vous pouvez dire à PF
de mettre à jour automatiquement l'adresse de traduction en mettant des
parenthèses autour du nom de l'interface :
d438 2
a439 2
Cette méthode fonctionne aussi bien pour la traduction d'adresses IPv6
que pour la traduction d'adresses IPv4.
d442 16
a457 14
<h2>Mise en Correspondance Bidirectionnelle (mise en
correspondance 1:1)</h2>
Une mise en correspondance bidirectionnelle (traduction 1 à 1) peut être
établie en utilisant une règle <tt>binat</tt>. Une règle <tt>binat</tt>
établit une correspondance 1 à 1 entre une adresse IP interne et
une adresse externe. Ceci peut être pratique par exemple pour permettre
à un serveur web interne d'avoir sa propre adresse de traduction
externe. Les connexions en provenance d'Internet à destination de cette
adresse externe seront acheminées vers l'adresse interne du serveur web.
Quant aux requêtes émanant du serveur web (telles que les requêtes DNS),
elles seront traduites de telle façon à remplacer l'adresse interne par
l'adresse externe de traduction attribuée au serveur web. Contrairement
aux règles <tt>nat</tt>, les règles <tt>binat</tt> ne modifient jamais
les ports TCP.
d471 5
a475 4
<h2>Exceptions aux Règles de Traduction</h2>
Des exceptions aux règles de traduction peuvent être faites en utilisant
le mot-clé <tt>no</tt>. Par exemple, si la règle de NAT précédente était
modifiée de la manière suivante :
d484 3
a486 2
Alors tous les paquets du réseau 192.168.1.0/24 seront traduits avec
l'adresse externe 24.2.74.79 excepté pour la machine 192.168.1.10.
d489 6
a494 5
Il est à noter que la première règle à laquelle un paquet correspond est
appliquée et aucune évaluation supplémentaire n'est effectuée. S'il y a
une règle <tt>no</tt>, alors le paquet n'est pas traduit. Le mot-clé
<tt>no</tt> peut être utilisé avec les règles <tt>binat</tt> et
<a href="rdr.html"><tt>rdr</tt></a>.
d497 1
a497 1
<h2>Vérification de l'état de la NAT</h2>
d500 2
a501 1
avec l'option <tt>-s state</tt>. Cette option affichera une liste de toutes les sessions NAT en cours :
d510 1
a510 1
Explications (première ligne uniquement) :
d514 2
a515 2
<dd>Indique l'interface à laquelle est rattachée la session. Le mot-clé
<tt>self</tt> apparaîtra si la session est de type
d521 1
a521 1
<dd>Le protocole utilisé par la connexion.
d526 4
a529 3
<dd>L'adresse IP (192.168.1.35) de la machine sur le réseau interne. Le
port source (2132) est affiché après l'adresse. C'est aussi l'adresse
qui sera remplacée au niveau de l'en-tête IP.
d535 1
a535 1
utilisés pour la traduction.
d541 1
a541 1
interne est connectée.
d547 1
a547 1
<dd>Indique l'état de la connexion TCP, vu par PF.
d551 1
a551 1
[<a href="../filter.html">Précédent : Filtrage de Paquets</a>]
d561 2
a562 2
Originally [OpenBSD: nat.html,v 1.15 ]<br>
$Translation: nat.html,v 1.1 2004/05/28 18:44:13 saad Exp $<br>
@

