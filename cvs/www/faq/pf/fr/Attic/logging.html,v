head	1.46;
access;
symbols;
locks; strict;
comment	@# @;


1.46
date	2014.04.01.17.14.10;	author nick;	state dead;
branches;
next	1.45;

1.45
date	2013.11.01.18.04.05;	author ajacoutot;	state Exp;
branches;
next	1.44;

1.44
date	2013.05.07.12.47.22;	author ajacoutot;	state Exp;
branches;
next	1.43;

1.43
date	2012.11.02.07.24.05;	author ajacoutot;	state Exp;
branches;
next	1.42;

1.42
date	2012.05.19.22.52.00;	author ajacoutot;	state Exp;
branches;
next	1.41;

1.41
date	2012.05.13.16.30.18;	author ajacoutot;	state Exp;
branches;
next	1.40;

1.40
date	2012.02.05.16.19.25;	author ajacoutot;	state Exp;
branches;
next	1.39;

1.39
date	2011.11.05.12.45.49;	author ajacoutot;	state Exp;
branches;
next	1.38;

1.38
date	2011.05.07.08.22.01;	author ajacoutot;	state Exp;
branches;
next	1.37;

1.37
date	2010.11.09.08.15.21;	author ajacoutot;	state Exp;
branches;
next	1.36;

1.36
date	2010.07.30.16.48.33;	author ajacoutot;	state Exp;
branches;
next	1.35;

1.35
date	2010.05.23.16.20.41;	author ajacoutot;	state Exp;
branches;
next	1.34;

1.34
date	2010.04.04.18.48.32;	author ajacoutot;	state Exp;
branches;
next	1.33;

1.33
date	2009.10.20.20.44.42;	author ajacoutot;	state Exp;
branches;
next	1.32;

1.32
date	2009.05.01.13.16.23;	author tobias;	state Exp;
branches;
next	1.31;

1.31
date	2008.12.01.07.52.52;	author tobias;	state Exp;
branches;
next	1.30;

1.30
date	2008.08.25.14.21.24;	author tobias;	state Exp;
branches;
next	1.29;

1.29
date	2008.01.13.13.43.34;	author tobias;	state Exp;
branches;
next	1.28;

1.28
date	2007.05.10.12.43.45;	author saad;	state Exp;
branches;
next	1.27;

1.27
date	2007.02.14.19.01.55;	author jufi;	state Exp;
branches;
next	1.26;

1.26
date	2006.11.02.18.23.22;	author jufi;	state Exp;
branches;
next	1.25;

1.25
date	2006.10.29.10.58.52;	author jufi;	state Exp;
branches;
next	1.24;

1.24
date	2006.06.01.06.33.44;	author jufi;	state Exp;
branches;
next	1.23;

1.23
date	2006.05.14.09.54.41;	author saad;	state Exp;
branches;
next	1.22;

1.22
date	2006.05.02.17.09.33;	author jufi;	state Exp;
branches;
next	1.21;

1.21
date	2006.03.10.16.35.07;	author saad;	state Exp;
branches;
next	1.20;

1.20
date	2005.12.31.00.54.37;	author saad;	state Exp;
branches;
next	1.19;

1.19
date	2005.12.12.10.18.53;	author saad;	state Exp;
branches;
next	1.18;

1.18
date	2005.11.20.09.27.38;	author saad;	state Exp;
branches;
next	1.17;

1.17
date	2005.11.03.11.30.53;	author saad;	state Exp;
branches;
next	1.16;

1.16
date	2005.06.06.12.14.49;	author saad;	state Exp;
branches;
next	1.15;

1.15
date	2005.05.22.17.38.07;	author saad;	state Exp;
branches;
next	1.14;

1.14
date	2005.02.13.17.41.41;	author saad;	state Exp;
branches;
next	1.13;

1.13
date	2005.01.18.09.54.52;	author jufi;	state Exp;
branches;
next	1.12;

1.12
date	2004.12.29.10.38.26;	author saad;	state Exp;
branches;
next	1.11;

1.11
date	2004.12.18.11.00.30;	author saad;	state Exp;
branches;
next	1.10;

1.10
date	2004.11.26.20.14.55;	author jufi;	state Exp;
branches;
next	1.9;

1.9
date	2004.11.01.02.56.30;	author saad;	state Exp;
branches;
next	1.8;

1.8
date	2004.10.13.14.44.30;	author jufi;	state Exp;
branches;
next	1.7;

1.7
date	2004.10.11.16.17.48;	author jufi;	state Exp;
branches;
next	1.6;

1.6
date	2004.10.07.10.24.20;	author jufi;	state Exp;
branches;
next	1.5;

1.5
date	2004.05.12.20.51.36;	author saad;	state Exp;
branches;
next	1.4;

1.4
date	2004.05.06.21.34.05;	author saad;	state Exp;
branches;
next	1.3;

1.3
date	2004.02.20.06.33.11;	author jufi;	state Exp;
branches;
next	1.2;

1.2
date	2004.01.03.19.45.23;	author jufi;	state Exp;
branches;
next	1.1;

1.1
date	2003.12.29.22.13.35;	author horacio;	state Exp;
branches;
next	;


desc
@@


1.46
log
@
Abandon translations, per deraadt@@ and ajacoutot@@.
@
text
@<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<html>
<head>
<title>PF : Journal des Événements</title>
<link rev="made" href="mailto:www@@openbsd.org">
<meta http-equiv="Content-Type" content="text/html; charset=ISO-8859-1">
<meta name="resource-type" content="document">
<meta name="description"   content="the OpenBSD FAQ page">
<meta name="keywords"      content="openbsd,faq,pf">
<meta name="distribution"  content="global">
</head>

<!--

Copyright (c) 2003, Nick Holland <nick@@openbsd.org>
Copyright (c) 2003-2007 Joel Knight <enabled@@myrealbox.com>

Permission to use, copy, modify, and distribute this documentation for
any purpose with or without fee is hereby granted, provided that the
above copyright notice and this permission notice appear in all copies.

THE DOCUMENTATION IS PROVIDED "AS IS" AND THE AUTHOR DISCLAIMS ALL
WARRANTIES WITH REGARD TO THIS DOCUMENTATION INCLUDING ALL IMPLIED
WARRANTIES OF MERCHANTABILITY AND FITNESS. IN NO EVENT SHALL THE
AUTHOR BE LIABLE FOR ANY SPECIAL, DIRECT, INDIRECT, OR CONSEQUENTIAL
DAMAGES OR ANY DAMAGES WHATSOEVER RESULTING FROM LOSS OF USE, DATA OR
PROFITS, WHETHER IN AN ACTION OF CONTRACT, NEGLIGENCE OR OTHER
TORTIOUS ACTION, ARISING OUT OF OR IN CONNECTION WITH THE USE OR
PERFORMANCE OF THIS DOCUMENTATION
-->

<body bgcolor="#ffffff" text="#000000">
<!-- Passes validator.w3.org, please keep it this way;
please, use a max of 72 chars per line -->

<a href="../../../fr/index.html">
<img alt="[OpenBSD]" height="30" width="141"
src="../../../images/smalltitle.gif" border="0">
</a>
<p>
[<a href="tagging.html">Précédent : Balisage de
Paquets</a>]
[<a href="index.html">Index</a>]
[<a href="perf.html">Suivant : Performances</a>]

<p>
<h1><font color="#e00000">PF : Journal des Événements</font></h1>

<hr>

<h3>Table des Matières</h3>
<ul>
<li><a href="#intro">Introduction</a>
<li><a href="#log">Traçage De Paquets</a>
<li><a href="#logfile">Lire un Fichier d'Événements</a>
<li><a href="#filter">Filtrer les Événements en Sortie</a>
<li><a href="#syslog">Enregistrement des Événements via Syslog</a>
</ul>

<hr>

<a name="intro"></a>
<h2>Introduction</h2>
Lorsqu'un paquet est enregistré par PF, une copie de l'en-tête est
envoyée à une interface
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=pflog&amp;sektion=4&amp;manpath=OpenBSD+5.4"
>pflog(4)</a> ainsi que des informations supplémentaires telles que
l'interface sur laquelle transitait le paquet, l'action que PF a
entreprise (pass ou block), etc.
L'interface pflog(4) permet aux applications utilisateur de recevoir les
événements enregistrés par PF à partir du noyau.
Si PF est activé lors du démarrage du système, le service
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=pflogd&amp;sektion=8&amp;manpath=OpenBSD+5.4"
>pflogd(8)</a> est démarré.
Par défaut, pflog(8) écoute sur l'interface <tt>pflog0</tt> et
enregistre tous les événements reçus dans le fichier
<tt>/var/log/pflog</tt>.

<a name="log"></a>
<h2>Traçage De Paquets</h2>
<p>
Afin de tracer les paquets passant à travers PF, le mot-clé
<tt>log</tt> doit être utilisé.
Le mot-clé <tt>log</tt> indique à PF de tracer les paquets
correspondant à la règle dans laquelle ce mot-clé figure.
Dans le cas où la règle <a href="filter.html#state">crée un état</a>,
seul le premier paquet "vu" (celui qui entraîne la création de l'état)
sera tracé.

<p>
Les options qui peuvent être fournies au mot-clé <tt>log</tt> sont :

<dl>
<dt><tt>all</tt>
<dd>Tous les paquets seront tracés et pas uniquement le paquet initial.
Utile pour les règles à état.

<dt><tt>to <i>pflogN</i></tt>
<dd>Tous les paquets correspondants seront enregistrés par l'interface
pflog(4) spécifiée.
Par exemple, lorsque
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=spamlogd&amp;sektion=8"
>spamlogd(8)</a> est utilisé, tout le trafic SMTP peut être enregistré
par une une interface pflog(4) dédiée.
Le service spamlogd(8) peut alors être configuré pour écouter sur cette
interface. Ceci permet de garder le fichier d'événements principal
propre de tout trafic SMTP qui n'aurait pas dû figuré dans les fichiers
journaux.
Utilisez
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=ifconfig&amp;sektion=8"
>ifconfig(8)</a> pour créer des interfaces pflog(4). L'interface par
défaut <tt>pflog0</tt> est créée automatiquement.

<dt><tt>user</tt>
<dd>Trace aussi les identifiants UNIX utilisateur et groupe qui
possèdent la socket à partir de laquelle le paquet est émis ou vers
laquelle il est destiné (socket local bien entendu), en plus des
informations standard.
</dl>

<p>
Les options sont fournies entre parenthèses après le mot-clé
<tt>log</tt>; plusieurs options peuvent être séparées par une virgule ou
un espace.

<blockquote>
<tt>
pass in log (all, to pflog1) on $ext_if inet proto tcp to $ext_if port 22 keep state
</tt>
</blockquote>


<a name="logfile"></a>
<h2>Lire un Fichier d'Événements</h2>
pflogd écrit le fichier d'événements dans un format binaire compatible
tcpdump(8). Il ne peut donc n'être analysé que par tcpdump(8) ou tout
autre outil acceptant des fichiers dans ce format.

<p>
Pour lire le fichier d'événements :
<blockquote>
<tt>
# tcpdump -n -e -ttt -r /var/log/pflog
</tt>
</blockquote>

<p>
La lecture du fichier <i>pflog</i> à l'aide de tcpdump(8) ne donne
pas un affichage en temps réel.
Cependant, il est possible d'obtenir un tel affichage en utilisant
l'interface <tt>pflog0</tt> :
<blockquote>
<tt>
# tcpdump -n -e -ttt -i pflog0
</tt>
</blockquote>

<p>
<font color="#e00000">REMARQUE : </font>
Lorsque vous examinez les événements, une attention particulière doit
être accordée au décodage verbeux des protocoles effectué par tcpdump
(décodage activé par l'option <tt>-v</tt>). Les décodeurs protocolaires
de tcpdump ne possèdent pas un historique sécurité parfait. En théorie
du moins, une attaque reste possible en utilisant les charges utiles
partielles enregistrées par le périphérique d'enregistrement
d'événements. Il est recommandé de déplacer les fichiers d'événements du
pare-feu vers une autre machine avant de les traiter à l'aide de
tcpdump(8).

<p>
Des précautions supplémentaires doivent êtres prises pour sécuriser
l'accès aux événements. Par défaut, pflogd enregistrera 160 octets du
paquet dans le fichier d'événements. L'accès aux fichiers d'événements
pourrait fournir un accès partiel à des charges utiles de paquets
sensibles (tels que les noms d'utilisateurs et les mots de passe
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=telnet&amp;sektion=1"
>telnet(1)</a>
ou <a href="http://www.openbsd.org/cgi-bin/man.cgi?query=ftp&amp;sektion=1"
>ftp(1)</a>).

<a name="filter"></a>
<h2>Filtrer les Événements en Sortie</h2>
Etant donné que pflogd enregistre les événements au format binaire
tcpdump, la totalité des fonctionnalités tcpdump peut être utilisée pour
analyser les événements. Par exemple, pour voir uniquement les paquets
qui correspondent à un certain port :
<blockquote>
<tt>
# tcpdump -n -e -ttt -r /var/log/pflog port 80
</tt>
</blockquote>

<p>
Ceci peut être encore affiné en limitant l'affichage des paquets à une
certaine combinaison d'hôte et de port :
<blockquote>
<tt>
# tcpdump -n -e -ttt -r /var/log/pflog port 80 and host 192.168.1.3
</tt>
</blockquote>

<p>
La même idée peut être appliquée quand on lit les événéments directement
à partir de l'interface <tt>pflog0</tt> :
<blockquote>
<tt>
# tcpdump -n -e -ttt -i pflog0 host 192.168.4.2
</tt>
</blockquote>

<p>
Il est à noter que ces manipulations n'ont aucun impact sur les paquets
enregistrés dans le fichier d'événements pflogd; les commandes ci-dessus
ne feront qu'afficher les paquets au fur et à mesure qu'ils sont
enregistrés.

<p>
En plus de l'utilisation des règles de filtrage standard
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=tcpdump&amp;sektion=8"
>tcpdump(8)</a>,
le langage de filtrage du tcpdump a été étendu pour lire la sortie de
pflogd :
<ul>
<li><tt>ip</tt> - la famille d'adresses est IPv4.
<li><tt>ip6</tt> - la famille d'adresses est IPv6.
<li><tt>on <i>int</i></tt> - le paquet est passé à travers l'interface
    <i>int</i>.
<li><tt>ifname <i>int</i></tt> - idem <tt>on <i>int</i></tt>.
<li><tt>ruleset <i>name</i></tt> - le <a href="anchors.html">jeu de
    règles/ancre</a> auquel correspond le paquet.
<li><tt>rulenum <i>num</i></tt> - la règle de filtrage à laquelle
    correspondait le paquet était la règle numéro <i>num</i>.
<li><tt>action <i>act</i></tt> - l'action prise pour le paquet. Les
    actions possibles sont <tt>pass</tt> et <tt>block</tt>.
<li><tt>reason <i>res</i></tt> - la raison pour laquelle
    l'<tt>action</tt> a été prise. Les raisons possibles sont
    <tt>match</tt>, <tt>bad-offset</tt>, <tt>fragment</tt>,
    <tt>short</tt>, <tt>normalize</tt>, <tt>memory</tt> et
    <tt>bad-timestamp</tt>,
<tt>congestion</tt>, <tt>ip-option</tt>, <tt>proto-cksum</tt>,
<tt>state-mismatch</tt>, <tt>state-insert</tt>, <tt>state-limit</tt>,
<tt>src-limit</tt> et <tt>synproxy</tt>.
<li><tt>inbound</tt> - le paquet était entrant.
<li><tt>outbound</tt> - le paquet était sortant.
</ul>

<p>
Exemple :
<blockquote>
<tt>
# tcpdump -n -e -ttt -i pflog0 inbound and action block and on wi0
</tt>
</blockquote>

<p>
Cette commande affichera l'événement en temps réel créé par des paquets
entrants bloqués sur l'interface wi0.

<a name="syslog"></a>
<h2>Enregistrement des Événements à Travers Syslog</h2>
Dans plusieurs situations, il est souhaitable de disposer des événements
enregistrés par le pare-feu sous format ASCII ou de les envoyer à un
serveur d'événements central distant. Tout ceci peut être effectué par
un petit script shell, quelques modifications mineures aux fichiers
de configuration d'OpenBSD, et
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=syslogd&amp;sektion=8"
>syslogd(8)</a>, 
le service qui permet d'enregistrer les événements.
Syslogd enregistre les événements au format ASCII et il est aussi
capable de les envoyer à un serveur d'événements distant.

<p>
Créez le script suivant :

<p>
<tt>/etc/pflogrotate</tt>
<pre>
	#!/bin/sh
        PFLOG=/var/log/pflog
        FILE=/var/log/pflog5min.$(date "+%Y%m%d%H%M")
        pkill -ALRM -u root -U root -t - -x pflogd
        if [ -r $PFLOG ] && [ $(stat -f %z $PFLOG) -gt 24 ]; then
           mv $PFLOG $FILE
           pkill -HUP -u root -U root -t - -x pflogd
           tcpdump -n -e -s 160 -ttt -r $FILE | logger -t pf -p local0.info
           rm $FILE
        fi
</pre>

<p>
Editez la liste des tâches cron du super-utilisateur root :
<blockquote>
<tt>
# crontab -u root -e
</tt>
</blockquote>

<p>
Ajoutez-y les deux lignes suivantes :
<blockquote>
<tt>
# effectuer une rotation du fichier d'événements<br>
# toutes les 5 minutes
0-59/5 *       *       *       *       /bin/sh /etc/pflogrotate
</tt>
</blockquote>

<p>
Ajoutez la ligne suivante au fichier <tt>/etc/syslog.conf</tt> :
<blockquote>
<tt>
local0.info &nbsp;&nbsp;&nbsp;&nbsp;/var/log/pflog.txt
</tt>
</blockquote>

<p>
Si vous voulez les envoyer aussi à un serveur d'événements distant,
ajoutez la ligne suivante
<blockquote>
<tt>
local0.info &nbsp;&nbsp;&nbsp;&nbsp;@@syslogger
</tt>
</blockquote>

<p>
Assurez vous que l'hôte <i>syslogger</i> a bien été défini dans le
fichier
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=hosts&amp;sektion=5"
>hosts(5)</a>.

<p>
Créez le fichier <tt>/var/log/pflog.txt</tt> afin de permettre à syslog
d'enregistrer les événements dans ce fichier et donnez lui les mêmes
permissions qu'au fichier pflog.
<blockquote>
<tt>
# touch /var/log/pflog.txt<br>
# chmod 600 /var/log/pflog.txt
</tt>
</blockquote>

<p>
Relancez syslogd pour que les modifications soient prises en compte :
<blockquote>
<tt>
# kill -HUP $(cat /var/run/syslog.pid)
</tt>
</blockquote>

<p>
Tous les événements enregistrés sont maintenant envoyés vers
<tt>/var/log/pflog.txt</tt>. Si la seconde ligne a été ajoutée, les
événements sont aussi envoyés au serveur d'événements distant
<i>syslogger</i>.

<p>
Le script <tt>/etc/pflogrotate</tt> traite désormais
<tt>/var/log/pflog</tt> et le supprime à la fin du traitement. La
rotation du fichier <tt>pflog</tt> par
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=newsyslog&amp;sektion=8"
>newsyslog(8)</a> 
n'est plus nécessaire désormais et devrait être désactivée. Cependant
<tt>/var/log/pflog.txt</tt> remplace <tt>/var/log/pflog</tt> et sa
rotation devrait être activée. Modifiez <tt>/etc/newsyslog.conf</tt>
comme suit :
<pre>
    #/var/log/pflog       600    3    250    *    ZB "pkill -HUP -u root -U /root -t - -x pflogd"
    /var/log/pflog.txt    600    7    *      24
</pre>

<p>
PF, à l'aide du mécanisme précité, générera des événements qui seront
enregistrés au format ASCII dans le fichier <tt>/var/log/pflog.txt</tt>. Si
<tt>/etc/syslog.conf</tt> est configuré en conséquence, ces événements
pourront aussi être envoyés à un serveur de logs distant. L'enregistrement des
événements n'est pas immédiate. Elle prend jusqu'à 5-6 minutes
(l'intervalle d'exécution de la tâche cron) avant que les événements
enregistrés apparaissent dans le fichier.

<p>
[<a href="tagging.html">Précédent : Balisage de Paquets</a>]
[<a href="index.html">Index</a>]
[<a href="perf.html">Suivant : Performances</a>]

<p>
<hr>
<a href="index.html"><img height="24" width="24"
src="../../../images/back.gif" border="0" alt="[back]"></a>
<a href="mailto:www@@openbsd.org">www@@openbsd.org</a>
<br>
<small>
<!--
Originally [OpenBSD: logging.html,v 1.49 ]<br>
$Translation: logging.html,v 1.49 2013/11/01 17:02:17 rustybsd Exp $<br>
-->
$OpenBSD: logging.html,v 1.45 2013/11/01 18:04:05 ajacoutot Exp $
</small>

</body>
</html> 
@


1.45
log
@Sync with Steelix CVS
@
text
@d396 1
a396 1
$OpenBSD$
@


1.44
log
@Sync with Steelix CVS
@
text
@d66 1
a66 1
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=pflog&amp;sektion=4&amp;manpath=OpenBSD+5.3"
d73 1
a73 1
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=pflogd&amp;sektion=8&amp;manpath=OpenBSD+5.3"
d393 2
a394 2
Originally [OpenBSD: logging.html,v 1.48 ]<br>
$Translation: logging.html,v 1.48 2013/05/07 08:34:48 rustybsd Exp $<br>
@


1.43
log
@Sync with Steelix CVS
@
text
@d66 1
a66 1
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=pflog&amp;sektion=4&amp;manpath=OpenBSD+5.2"
d73 1
a73 1
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=pflogd&amp;sektion=8&amp;manpath=OpenBSD+5.2"
d393 2
a394 2
Originally [OpenBSD: logging.html,v 1.47 ]<br>
$Translation: logging.html,v 1.47 2012/11/01 19:46:21 rustybsd Exp $<br>
@


1.42
log
@Sync with Steelix CVS
@
text
@d66 1
a66 1
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=pflog&amp;sektion=4&amp;manpath=OpenBSD+5.1"
d73 1
a73 1
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=pflogd&amp;sektion=8&amp;manpath=OpenBSD+5.1"
d393 2
a394 2
Originally [OpenBSD: logging.html,v 1.46 ]<br>
$Translation: logging.html,v 1.46 2012/05/17 14:16:54 rustybsd Exp $<br>
@


1.41
log
@Sync with Steelix CVS
@
text
@d82 1
a82 1
Afin de tracer les paquets passant à travers PF, le mot-clef
d84 2
a85 2
Le mot-clef <tt>log</tt> indique à PF de tracer les paquets
correspondant à la règle dans laquelle ce mot-clef figure.
d91 1
a91 1
Les options qui peuvent être fournies au mot-clef <tt>log</tt> sont :
d122 1
a122 1
Les options sont fournies entre parenthèses après le mot-clef
d394 1
a394 1
$Translation: logging.html,v 1.45 2012/05/11 18:33:24 rustybsd Exp $<br>
@


1.40
log
@Sync with Steelix CVS
@
text
@d66 1
a66 1
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=pflog&amp;sektion=4&amp;manpath=OpenBSD+5.0"
d73 1
a73 1
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=pflogd&amp;sektion=8&amp;manpath=OpenBSD+5.0"
d393 2
a394 2
Originally [OpenBSD: logging.html,v 1.45 ]<br>
$Translation: logging.html,v 1.44 2012/02/05 10:45:56 ajacoutot Exp $<br>
@


1.39
log
@Sync with Steelix CVS
@
text
@d4 1
a4 1
<title>PF : Journal des Evénements</title>
d47 1
a47 1
<h1><font color="#e00000">PF : Journal des Evénements</font></h1>
d55 3
a57 3
<li><a href="#logfile">Lire un Fichier d'Evénements</a>
<li><a href="#filter">Filtrer les Evénements en Sortie</a>
<li><a href="#syslog">Enregistrement des Evénements via Syslog</a>
d134 1
a134 1
<h2>Lire un Fichier d'Evénements</h2>
d182 1
a182 1
<h2>Filtrer les Evénements en Sortie</h2>
d260 1
a260 1
<h2>Enregistrement des Evénements à Travers Syslog</h2>
d394 1
a394 1
$Translation: logging.html,v 1.43 2011/11/05 09:20:59 benoit Exp $<br>
@


1.38
log
@Sync with Steelix CVS
@
text
@d66 1
a66 1
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=pflog&amp;sektion=4&amp;manpath=OpenBSD+4.9"
d73 1
a73 1
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=pflogd&amp;sektion=8&amp;manpath=OpenBSD+4.9"
d172 1
a172 1
l'accès aux événements. Par défaut, pflogd enregistrera 96 octets du
d285 1
a285 1
           tcpdump -n -e -ttt -r $FILE | logger -t pf -p local0.info
d393 2
a394 2
Originally [OpenBSD: logging.html,v 1.43 ]<br>
$Translation: logging.html,v 1.42 2011/05/07 06:58:36 benoit Exp $<br>
@


1.37
log
@Sync with Steelix CVS
@
text
@d66 1
a66 1
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=pflog&amp;sektion=4&amp;manpath=OpenBSD+4.8"
d73 1
a73 1
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=pflogd&amp;sektion=8&amp;manpath=OpenBSD+4.8"
d393 2
a394 2
Originally [OpenBSD: logging.html,v 1.42 ]<br>
$Translation: logging.html,v 1.41 2010/11/06 14:41:18 benoit Exp $<br>
@


1.36
log
@Sync with Steelix CVS
@
text
@d66 1
a66 1
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=pflog&amp;sektion=4&amp;manpath=OpenBSD+4.7"
d73 1
a73 1
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=pflogd&amp;sektion=8&amp;manpath=OpenBSD+4.7"
d393 2
a394 2
Originally [OpenBSD: logging.html,v 1.41 ]<br>
$Translation: logging.html,v 1.40 2010/07/30 03:48:28 benoit Exp $<br>
@


1.35
log
@Sync with Steelix CVS
@
text
@d281 1
a281 1
        kill -ALRM $(cat /var/run/pflogd.pid)
d284 1
a284 1
           kill -HUP $(cat /var/run/pflogd.pid)
d393 2
a394 2
Originally [OpenBSD: logging.html,v 1.40 ]<br>
$Translation: logging.html,v 1.39 2010/05/22 05:29:52 benoit Exp $<br>
@


1.34
log
@Sync with Steelix CVS
@
text
@d66 1
a66 1
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=pflog&amp;sektion=4&amp;manpath=OpenBSD+4.6"
d73 1
a73 1
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=pflogd&amp;sektion=8&amp;manpath=OpenBSD+4.6"
d367 1
a367 1
    #/var/log/pflog       600    3    250    *    ZB /var/run/pflogd.pid
d393 2
a394 2
Originally [OpenBSD: logging.html,v 1.39 ]<br>
$Translation: logging.html,v 1.38 2010/04/03 05:07:23 benoit Exp $<br>
@


1.33
log
@Sync with Steelix CVS
@
text
@d83 1
a83 7
<tt>log</tt> doit être utilisé dans les règles de <a
href="nat.html">NAT/rdr</a> et de <a href="filter.html">filtrage</a>.
Il est à noter que PF ne peut tracer que les paquets qu'il bloque ou
qu'il laisse passer; vous ne pouvez pas créer de règle qui ne fait que
du traçage de paquets.

<p>
d393 2
a394 2
Originally [OpenBSD: logging.html,v 1.38 ]<br>
$Translation: logging.html,v 1.37 2009/10/19 15:48:30 benoit Exp $<br>
@


1.32
log
@Sync with Steelix CVS
@
text
@d66 1
a66 1
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=pflog&amp;sektion=4&amp;manpath=OpenBSD+4.5"
d73 1
a73 1
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=pflogd&amp;sektion=8&amp;manpath=OpenBSD+4.5"
d399 2
a400 2
Originally [OpenBSD: logging.html,v 1.37 ]<br>
$Translation: logging.html,v 1.36 2009/04/30 22:46:58 benoit Exp $<br>
@


1.31
log
@Sync with Steelix CVS
@
text
@d66 1
a66 1
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=pflog&amp;sektion=4&amp;manpath=OpenBSD+4.4"
d73 1
a73 1
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=pflogd&amp;sektion=8&amp;manpath=OpenBSD+4.4"
d399 2
a400 2
Originally [OpenBSD: logging.html,v 1.36 ]<br>
$Translation: logging.html,v 1.35 2008/11/26 22:39:39 benoit Exp $<br>
@


1.30
log
@Sync with Steelix CVS
@
text
@d66 1
a66 1
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=pflog&amp;sektion=4&amp;manpath=OpenBSD+4.3"
d73 1
a73 1
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=pflogd&amp;sektion=8&amp;manpath=OpenBSD+4.3"
d399 2
a400 2
Originally [OpenBSD: logging.html,v 1.35 ]<br>
$Translation: logging.html,v 1.34 2008/08/20 15:32:00 gapz Exp $<br>
@


1.29
log
@Sync with Steelix CVS
@
text
@d66 1
a66 1
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=pflog&amp;sektion=4&amp;manpath=OpenBSD+4.2"
d73 1
a73 1
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=pflogd&amp;sektion=8&amp;manpath=OpenBSD+4.2"
d399 2
a400 2
Originally [OpenBSD: logging.html,v 1.34 ]<br>
$Translation: logging.html,v 1.33 2008/01/11 10:30:25 saad Exp $<br>
@


1.28
log
@Sync with Steelix CVS
@
text
@d66 1
a66 1
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=pflog&amp;sektion=4&amp;manpath=OpenBSD+4.1"
d73 1
a73 1
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=pflogd&amp;sektion=8&amp;manpath=OpenBSD+4.1"
d399 2
a400 2
Originally [OpenBSD: logging.html,v 1.33 ]<br>
$Translation: logging.html,v 1.32 2007/05/10 12:25:24 saad Exp $<br>
@


1.27
log
@sync with steelix translation CVS
@
text
@d16 1
a16 1
Copyright (c) 2003-2005 Joel Knight <enabled@@myrealbox.com>
d64 14
a77 10
L'enregistrement des Evénements dans PF est effectué par
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=pflogd&amp;sektion=8&amp;manpath=OpenBSD+4.0">pflogd(8)</a>
qui écoute sur l'interface
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=pflog&amp;sektion=4&amp;manpath=OpenBSD+4.0"><tt>pflog0</tt></a>
et écrit les paquets dans un fichier d'événements
(normalement /var/log/pflog) au format binaire
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=tcpdump&amp;sektion=8&amp;manpath=OpenBSD+4.0">tcpdump(8)</a>.
Les flux correspondant aux règles de
<a href="filter.html">filtrage</a> qui contiennent les mots-clés
<tt>log</tt> ou <tt>log (all)</tt> sont enregistrés de cette manière.
d104 16
d134 1
a134 2
pass in log (all) on $ext_if inet proto tcp to $ext_if port 22 keep
state
a137 2
<p>
Trace tous les paquets entrants à destination du port 22.
d182 4
a185 2
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=telnet&amp;sektion=1&amp;manpath=OpenBSD+4.0">telnet(1)</a>
ou <a href="http://www.openbsd.org/cgi-bin/man.cgi?query=ftp&amp;sektion=1&amp;manpath=OpenBSD+4.0">ftp(1)</a>).
d225 2
a226 1
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=tcpdump&amp;sektion=8&amp;manpath=OpenBSD+4.0">tcpdump(8)</a>,
d272 2
a273 1
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=syslogd&amp;sektion=8&amp;manpath=OpenBSD+4.0">syslogd(8)</a>, 
d334 2
a335 1
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=hosts&amp;sektion=5&amp;manpath=OpenBSD+4.0">hosts(5)</a>.
d366 2
a367 1
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=newsyslog&amp;sektion=8&amp;manpath=OpenBSD+4.0">newsyslog(8)</a> 
d399 2
a400 2
Originally [OpenBSD: logging.html,v 1.31 ]<br>
$Translation: logging.html,v 1.31 2007/02/13 09:14:15 benoit Exp $<br>
@


1.26
log
@sync with steelix translation CVS
@
text
@d182 1
a182 1
certaine combinaison de hôte et de port :
d228 1
a228 1
<tt>src-limit</tt>, and <tt>synproxy</tt>.
d251 1
a251 1
de configuration OpenBSD, et
d311 1
a311 1
Assurez vous que le hôte <i>syslogger</i> a bien été défini dans le
d377 1
a377 1
$Translation: logging.html,v 1.30 2006/11/02 08:49:03 ajacoutot Exp $<br>
@


1.25
log
@sync with steelix translation CVS
@
text
@d65 1
a65 1
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=pflogd&amp;sektion=8&amp;manpath=OpenBSD+3.9">pflogd(8)</a>
d67 1
a67 1
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=pflog&amp;sektion=4&amp;manpath=OpenBSD+3.9"><tt>pflog0</tt></a>
d70 1
a70 1
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=tcpdump&amp;sektion=8&amp;manpath=OpenBSD+3.9">tcpdump(8)</a>.
d165 2
a166 2
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=telnet&amp;sektion=1&amp;manpath=OpenBSD+3.9">telnet(1)</a>
ou <a href="http://www.openbsd.org/cgi-bin/man.cgi?query=ftp&amp;sektion=1&amp;manpath=OpenBSD+3.9">ftp(1)</a>).
d206 1
a206 1
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=tcpdump&amp;sektion=8&amp;manpath=OpenBSD+3.9">tcpdump(8)</a>,
d252 1
a252 1
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=syslogd&amp;sektion=8&amp;manpath=OpenBSD+3.9">syslogd(8)</a>, 
d313 1
a313 1
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=hosts&amp;sektion=5&amp;manpath=OpenBSD+3.9">hosts(5)</a>.
d344 1
a344 1
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=newsyslog&amp;sektion=8&amp;manpath=OpenBSD+3.9">newsyslog(8)</a> 
d376 2
a377 2
Originally [OpenBSD: logging.html,v 1.30 ]<br>
$Translation: logging.html,v 1.29 2006/10/28 18:41:16 aanriot Exp $<br>
@


1.24
log
@sync with steelix translation CVS
cvs: ----------------------------------------------------------------------
@
text
@d207 2
a208 2
le langage de filtrage du tcpdump fourni avec OpenBSD a été étendu pour
lire la sortie de pflogd :
d376 2
a377 2
Originally [OpenBSD: logging.html,v 1.29 ]<br>
$Translation: logging.html,v 1.28 2006/05/31 08:54:24 ajacoutot Exp $<br>
@


1.23
log
@sync with Steelix CVS
@
text
@d250 1
a250 1
deux petits scripts shell, quelques modifications mineures aux fichiers
d258 1
a258 8
Il faut d'abord créer un utilisateur, <tt>pflogger</tt>, avec un shell
<tt>/sbin/nologin</tt>. La façon la plus simple de créer cet utilisateur
consiste à utiliser la commande
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=adduser&amp;sektion=8&amp;manpath=OpenBSD+3.9">adduser(8)</a>.

<p>
Après avoir crée l'utilisateur <tt>pflogger</tt>, créez les deux scripts
suivants :
d264 2
a265 1
        FILE=/home/pflogger/pflog5min.$(date "+%Y%m%d%H%M")
d267 2
a268 3
        if [ $(ls -l /var/log/pflog | cut -d " " -f 8) -gt 24 ]; then
           mv /var/log/pflog $FILE
           chown pflogger $FILE
d270 2
a275 17
<tt>/home/pflogger/pfl2sysl</tt>
<pre>
	#!/bin/sh
	# feed rotated pflog file(s) to syslog
	# do not start if another instance of this script is already running
	pgrep pfl2sysl >/dev/null 2>&1
	if [ $? -ne 0 ] ; then
		for logfile in /home/pflogger/pflog5min* ; do
			if [ -f "$logfile" ] ; then
				tcpdump -n -e -ttt -r $logfile | logger -t pf -p local0.info
				rm $logfile
			fi
		done
	fi
</pre>

<p>
a293 20
Créer une liste de tâches cron pour l'utilisateur
<tt>pflogger</tt> :
<blockquote>
<tt>
# crontab -u pflogger -e
</tt>
</blockquote>

<p>
Ajoutez-y les deux lignes suivantes :
<blockquote>
<tt>
# alimenter le(s) fichier(s) pflog après rotation à<br>
# syslog

0-59/5 *       *       *       *       /bin/sh /home/pflogger/pfl2sysl
</tt>
</blockquote>

<p>
d317 2
a318 1
d'enregistrer les événements dans ce fichier.
d321 2
a322 1
# touch /var/log/pflog.txt
d376 2
a377 2
Originally [OpenBSD: logging.html,v 1.26 ]<br>
$Translation: logging.html,v 1.25 2006/05/12 07:05:02 ajacoutot Exp $<br>
@


1.22
log
@sync with steelix translation CVS
@
text
@d399 1
a399 1
évênements n'est pas immédiate. Elle prend jusqu'à 5-6 minutes
d417 1
a417 1
$Translation: logging.html,v 1.24 2006/05/02 10:12:39 ajacoutot Exp $<br>
@


1.21
log
@sync with Steelix CVS
@
text
@d65 1
a65 1
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=pflogd&amp;sektion=8&amp;manpath=OpenBSD+3.8">pflogd(8)</a>
d67 1
a67 1
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=pflog&amp;sektion=4&amp;manpath=OpenBSD+3.8"><tt>pflog0</tt></a>
d70 1
a70 1
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=tcpdump&amp;sektion=8&amp;manpath=OpenBSD+3.8">tcpdump(8)</a>.
d165 2
a166 2
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=telnet&amp;sektion=1&amp;manpath=OpenBSD+3.8">telnet(1)</a>
ou <a href="http://www.openbsd.org/cgi-bin/man.cgi?query=ftp&amp;sektion=1&amp;manpath=OpenBSD+3.8">ftp(1)</a>).
d206 1
a206 1
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=tcpdump&amp;sektion=8&amp;manpath=OpenBSD+3.8">tcpdump(8)</a>,
d252 1
a252 1
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=syslogd&amp;sektion=8&amp;manpath=OpenBSD+3.8">syslogd(8)</a>, 
d261 1
a261 1
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=adduser&amp;sektion=8&amp;manpath=OpenBSD+3.8">adduser(8)</a>.
d355 1
a355 1
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=hosts&amp;sektion=5&amp;manpath=OpenBSD+3.8">hosts(5)</a>.
d384 1
a384 1
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=newsyslog&amp;sektion=8&amp;manpath=OpenBSD+3.8">newsyslog(8)</a> 
d416 2
a417 2
Originally [OpenBSD: logging.html,v 1.25 ]<br>
$Translation: logging.html,v 1.23 2006/03/09 14:46:29 ajacoutot Exp $<br>
@


1.20
log
@sync with Steelix CVS
@
text
@d36 1
a36 1
<a href="../../fr/index.html">
d67 1
a67 1
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=pflog&amp;sektion=4&amp;manpath=OpenBSD+3.8">pflog0</a>
d69 1
a69 1
(normalement <i>/var/log/pflog</i>) au format binaire
d138 1
a138 1
<i>pas</i> un affichage en temps réel.
d214 1
a214 1
<li><tt>ifname <i>int</i></tt> - idem.
d225 4
a228 1
    <tt>bad-timestamp</tt>.
d310 1
a310 1
# toutes les 5 minutes<br>
d329 1
a329 1
# syslog<br>
d383 1
a383 1
rotation de ce fichier par
d396 4
a399 3
enregistrés dans le fichier <tt>/var/log/pflog.txt</tt>. Ces événements
pourront aussi être envoyés à un serveur d'événements distant. La
conversion en ASCII n'est pas immédiate. Elle prend jusqu'à 5-6 minutes
d417 1
a417 1
$Translation: logging.html,v 1.22 2005/12/31 00:45:21 saad Exp $<br>
@


1.19
log
@sync with Steelix CVS
@
text
@d54 1
d75 47
d412 2
a413 2
Originally [OpenBSD: logging.html,v 1.24 ]<br>
$Translation: logging.html,v 1.21 2005/12/12 09:27:25 saad Exp $<br>
@


1.18
log
@sync with Steelix CVS
@
text
@d72 1
a72 1
<tt>log</tt> ou <tt>log-all</tt> sont enregistrés de cette manière.
d364 2
a365 2
Originally [OpenBSD: logging.html,v 1.23 ]<br>
$Translation: logging.html,v 1.20 2005/11/20 09:07:45 saad Exp $<br>
@


1.17
log
@sync with Steelix CVS
@
text
@d219 1
d232 12
a243 6
        for logfile in /home/pflogger/pflog5min* ; do
     if [ -s "$logfile" ]; then
           tcpdump -n -e -ttt -r $logfile | logger -t pf -p local0.info
           rm $logfile
     fi
        done
d364 2
a365 2
Originally [OpenBSD: logging.html,v 1.22 ]<br>
$Translation: logging.html,v 1.19 2005/11/02 19:38:09 aanriot Exp $<br>
@


1.16
log
@sync with Steelix CVS
@
text
@d64 1
a64 1
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=pflogd&amp;sektion=8&amp;manpath=OpenBSD+3.7">pflogd(8)</a>
d66 1
a66 1
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=pflog&amp;sektion=4&amp;manpath=OpenBSD+3.7">pflog0</a>
d69 1
a69 1
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=tcpdump&amp;sektion=8&amp;manpath=OpenBSD+3.7">tcpdump(8)</a>.
d117 2
a118 2
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=telnet&amp;sektion=1&amp;manpath=OpenBSD+3.7">telnet(1)</a>
ou <a href="http://www.openbsd.org/cgi-bin/man.cgi?query=ftp&amp;sektion=1&amp;manpath=OpenBSD+3.7">ftp(1)</a>).
d158 1
a158 1
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=tcpdump&amp;sektion=8&amp;manpath=OpenBSD+3.7">tcpdump(8)</a>,
d201 1
a201 1
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=syslogd&amp;sektion=8&amp;manpath=OpenBSD+3.7">syslogd(8)</a>, 
d210 1
a210 1
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=adduser&amp;sektion=8&amp;manpath=OpenBSD+3.7">adduser(8)</a>.
d297 1
a297 1
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=hosts&amp;sektion=5&amp;manpath=OpenBSD+3.7">hosts(5)</a>.
d326 1
a326 1
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=newsyslog&amp;sektion=8&amp;manpath=OpenBSD+3.7">newsyslog(8)</a> 
d357 2
a358 2
Originally [OpenBSD: logging.html,v 1.21 ]<br>
$Translation: logging.html,v 1.18 2005/06/06 11:34:45 saad Exp $<br>
@


1.15
log
@sync with Steelix CVS
@
text
@d167 2
d357 2
a358 2
Originally [OpenBSD: logging.html,v 1.20 ]<br>
$Translation: logging.html,v 1.17 2005/05/21 18:19:49 aanriot Exp $<br>
@


1.14
log
@sync with Steelix CVS
@
text
@d37 2
a38 1
<img alt="[OpenBSD]" height="30" width="141" src="../../../images/smalltitle.gif" border="0">
d64 1
a64 1
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=pflogd&amp;sektion=8&amp;manpath=OpenBSD+3.6">pflogd(8)</a>
d66 1
a66 1
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=pflog&amp;sektion=4&amp;manpath=OpenBSD+3.6">pflog0</a>
d69 4
a72 5
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=tcpdump&amp;sektion=8&amp;manpath=OpenBSD+3.6">tcpdump(8)</a>.
Les flux correspondant aux règles de <a
href="filter.html">filtrage</a> qui contiennent les mots-clés
<tt>log</tt> ou <tt>log-all</tt> sont enregistrés de cette
manière.
d76 3
a78 3
pflogd écrit le fichier d'événements sous format binaire compatible
tcpdump(8). Il ne peut donc être analysé que par tcpdump(8) ou par tout
autre outil acceptant des fichiers dans ce format
d102 17
a118 19
être prise par rapport au décodage verbeux des protocoles effectué par
tcpdump (décodage activé par l'option <tt>-v</tt>). Les décodeurs
protocolaires de tcpdump ne possèdent pas un historique sécurité
parfait. En théorie du moins, une attaque reste possible en utilisant
les charges utiles partielles enregistrées par le périphérique
d'enregistrement d'événements. Il est recommandé de déplacer les
fichiers d'événements du pare-feu vers une autre machine avant de les
traiter à l'aide de tcpdump(8).

<p>
Des précautions supplémentaires doivent êtres prises
pour sécuriser l'accès aux événements. Par
défaut, pflogd enregistrera 96 octets du paquet dans le fichier
d'événements. L'accès aux fichiers
d'événements pourrait fournir un accès partiel
à des charges utiles de paquets sensibles (tels que les noms
d'utilisateurs et les mots de passe
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=telnet&amp;sektion=1&amp;manpath=OpenBSD+3.6">telnet(1)</a> ou
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=ftp&amp;sektion=1&amp;manpath=OpenBSD+3.6">ftp(1)</a>).
d122 3
a124 4
Etant donné que pflogd enregistre les événements au
format binaire tcpdump, la totalité des fonctionnalités
tcpdump peut être utilisée pour analyser les
événements. Par exemple, pour voir uniquement les paquets
d133 2
a134 2
Ceci peut être encore affiné en limitant l'affichage des
paquets à une certaine combinaison de hôte et de port :
d142 2
a143 3
La même idée peut être appliquée quand on lit
les événéments directement à partir de
l'interface <tt>pflog0</tt> :
d151 4
a154 4
Il est à noter que ces manipulations n'ont aucun impact sur les
paquets enregistrés dans le fichier d'événements
pflogd; les commandes ci-dessus ne feront qu'afficher les paquets au fur
et à mesure qu'ils sont enregistrés.
d158 3
a160 3
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=tcpdump&amp;sektion=8&amp;manpath=OpenBSD+3.6">tcpdump(8)</a>,
le langage de filtrage du tcpdump fourni avec OpenBSD a
été étendu pour lire la sortie de pflogd :
d164 2
a165 3
<li><tt>on <i>int</i></tt> - le paquet est passé à travers
    l'interface
<i>int</i>.
d167 2
a168 3
<li><tt>rulenum <i>num</i></tt> - la règle de filtrage à
    laquelle correspondait le paquet était la règle
    numéro <i>num</i>.
d172 2
a173 2
    l'<tt>action</tt> a été prise. Les raisons possibles
    sont <tt>match</tt>, <tt>bad-offset</tt>, <tt>fragment</tt>,
d189 2
a190 2
Cette commande affichera l'événement en temps réel
crée par des paquets entrants bloqués sur l'interface wi0.
d194 6
a199 8
Dans plusieurs situations, il est souhaitable de disposer des
événements enregistrés par le pare-feu sous format
ASCII ou de les envoyer à un serveur d'événements
central distant. Tout ceci peut être effectué par deux
petits scripts shell, quelques modifications mineures aux fichiers de
configuration OpenBSD, et

<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=syslogd&amp;sektion=8&amp;manpath=OpenBSD+3.6">syslogd(8)</a>, 
d201 2
a202 3
Syslogd enregistre les événements sous format ASCII et il
est aussi capable de les envoyer à un serveur
d'événements distant.
d205 4
a208 4
Il faut d'abord créer un utilisateur, <tt>pflogger</tt>, avec un
shell <tt>/sbin/nologin</tt>. La façon la plus simple de
créer cet utilisateur consiste à utiliser la commande
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=adduser&amp;sektion=8&amp;manpath=OpenBSD+3.6">adduser(8)</a>.
d211 2
a212 2
Après avoir crée l'utilisateur <tt>pflogger</tt>,
créez les deux scripts suivants :
d284 2
a285 2
Si vous voulez les envoyer aussi à un serveur
d'événements distant, ajoutez la ligne suivante
d293 3
a295 3
Assurez vous que le hôte <i>syslogger</i> a bien été
défini dans le fichier
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=hosts&amp;sektion=5&amp;manpath=OpenBSD+3.6">hosts(5)</a>.
d298 2
a299 3
Créez le fichier <tt>/var/log/pflog.txt</tt> afin de permettre
à syslog d'enregistrer les événements dans ce
fichier.
d315 3
a317 4
Tous les événements enregistrés sont maintenant
envoyés vers <tt>/var/log/pflog.txt</tt>. Si la seconde ligne a
été ajoutée, les événements sont
aussi envoyés au serveur d'événements distant
d324 5
a328 5
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=newsyslog&amp;sektion=8&amp;manpath=OpenBSD+3.6">newsyslog(8)</a> 
n'est plus nécessaire désormais et devrait être
désactivée. Cependant <tt>/var/log/pflog.txt</tt> remplace
<tt>/var/log/pflog</tt> et sa rotation devrait être
activée. Modifiez <tt>/etc/newsyslog.conf</tt> comme suit :
d335 6
a340 9
PF, à l'aide du mécanisme précité,
générera des événements qui seront
enregistrés dans le fichier <tt>/var/log/pflog.txt</tt>. Ces
événements pourront aussi être envoyés
à un serveur d'événements distant. La conversion en
ASCII n'est pas immédiate. Elle prend jusqu'à 5-6 minutes
(l'intervalle d'exécution de la tâche cron) avant que les
événements enregistrés apparaissent dans le
fichier.
d343 1
a343 2
[<a href="tagging.html">Précédent : Balisage de
Paquets</a>]
d349 2
a350 1
<a href="index.html"><img height="24" width="24" src="../../../images/back.gif" border="0" alt="[back]"></a> 
d355 2
a356 2
Originally [OpenBSD: logging.html,v 1.19 ]<br>
$Translation: logging.html,v 1.15 2005/02/13 16:52:28 svincent Exp $<br>
@


1.13
log
@Sync with Steelix CVS
@
text
@d14 3
a16 1
Copyright (c) 2003, 2004 Joel Knight <enabled@@myrealbox.com>
d180 2
a181 1
    <tt>short</tt>, <tt>normalize</tt>, et <tt>memory</tt>.
d239 1
a239 1
		   if [ -s "$logfile" ]; then
d242 1
a242 1
		   fi
d369 2
a370 2
Originally [OpenBSD: logging.html,v 1.18 ]<br>
$Translation: logging.html,v 1.14 2005/01/17 21:34:48 aanriot Exp $<br>
@


1.12
log
@sync with Steelix CVS
@
text
@d365 1
d367 2
a368 1
$Translation: logging.html,v 1.13 2004/12/29 10:33:02 saad Exp $<br>
@


1.11
log
@sync with Steelix CVS
@
text
@d34 3
a36 1
<img alt="[OpenBSD]" height=30 width=141 src="../../../images/smalltitle.gif">
d365 2
a366 2
Originally [OpenBSD: logging.html,v 1.17 ]<br>
$Translation: logging.html,v 1.11 2004/12/18 08:22:05 aanriot Exp $<br>
@


1.10
log
@Sync with Steelix CVS
@
text
@d234 1
d237 1
d363 2
a364 2
Originally [OpenBSD: logging.html,v 1.16 ]<br>
$Translation: logging.html,v 1.10 2004/11/25 22:10:28 saad Exp $<br>
@


1.9
log
@sync with Steelix CVS
@
text
@d51 1
a51 2
<li><a href="#syslog">Enregistrement des Evénements à
    Travers Syslog</a>
d63 1
a63 1
(normalement /var/log/pflog) au format binaire
d72 3
a74 3
Le fichier d'événements écrit par pflogd est dans
un format binaire que seul tcpdump(8) ou tout outil connaissant le
format binaire tcpdump peut lire.
d85 2
a86 2
Il est à noter que l'utilisation de tcpdump(8) pour lire le
fichier pflog ne donne <i>pas</i> un affichage en temps réel.
d97 9
a105 11
Lorsque vous examinez les événements, une attention
particulière doit être prise par rapport au décodage
verbeux des protocoles effectué par tcpdump (décodage
activé par l'option <tt>-v</tt>). Les décodeurs
protocolaires de tcpdump ne possèdent pas un historique
sécurité parfait. En théorie du moins, une attaque
retardée peut être possible à travers les charges
utiles partielles enregistrées par le périphérique
d'enregistrement d'événements. Il est recommandé de
déplacer les fichiers d'événements du pare-feu
avant de procéder à leur examen de cette manière.
d362 1
a362 1
$Translation: logging.html,v 1.9 2004/11/01 00:14:17 saad Exp $<br>
@


1.8
log
@Sync with Steelix CVS
@
text
@d60 1
a60 1
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=pflogd&amp;sektion=8&amp;manpath=OpenBSD+3.5">pflogd(8)</a>
d62 1
a62 1
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=pflog&amp;sektion=4&amp;manpath=OpenBSD+3.5">pflog0</a>
d65 1
a65 1
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=tcpdump&amp;sektion=8&amp;manpath=OpenBSD+3.5">tcpdump(8)</a>.
d118 2
a119 2
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=telnet&amp;sektion=1&amp;manpath=OpenBSD+3.5">telnet(1)</a> ou
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=ftp&amp;sektion=1&amp;manpath=OpenBSD+3.5">ftp(1)</a>).
d161 1
a161 1
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=tcpdump&amp;sektion=8&amp;manpath=OpenBSD+3.5">tcpdump(8)</a>,
d205 1
a205 1
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=syslogd&amp;sektion=8&amp;manpath=OpenBSD+3.5">syslogd(8)</a>, 
d215 1
a215 1
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=adduser&amp;sektion=8&amp;manpath=OpenBSD+3.5">adduser(8)</a>.
d300 1
a300 1
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=hosts&amp;sektion=5&amp;manpath=OpenBSD+3.5">hosts(5)</a>.
d331 1
a331 1
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=newsyslog&amp;sektion=8&amp;manpath=OpenBSD+3.5">newsyslog(8)</a> 
d364 2
a365 2
Originally [OpenBSD: logging.html,v 1.15 ]<br>
$Translation: logging.html,v 1.8 2004/10/13 11:53:05 saad Exp $<br>
@


1.7
log
@Sync with Steelix CVS
@
text
@d4 1
a4 1
<title>PF: Journal des Evénements</title>
d42 1
a42 1
<h1><font color="#e00000">PF: Journal des Evénements</font></h1>
d365 1
a365 1
$Translation: logging.html,v 1.7 2004/10/11 12:24:36 saad Exp $<br>
@


1.6
log
@Sync with Steelix CVS
@
text
@d4 1
a4 1
<title>PF: Journal des Ev&eacute;nements</title>
d36 1
a36 1
[<a href="tagging.html">Pr&eacute;c&eacute;dent : Balisage de
d42 1
a42 1
<h1><font color="#e00000">PF: Journal des Ev&eacute;nements</font></h1>
d46 1
a46 1
<h3>Table des Mati&egrave;res</h3>
d49 3
a51 3
<li><a href="#logfile">Lire un Fichier d'Ev&eacute;nements</a>
<li><a href="#filter">Filtrer les Ev&eacute;nements en Sortie</a>
<li><a href="#syslog">Enregistrement des Ev&eacute;nements &agrave;
d59 1
a59 1
L'enregistrement des Ev&eacute;nements dans PF est effectu&eacute; par
d61 1
a61 1
qui &eacute;coute sur l'interface
d63 1
a63 1
et &eacute;crit les paquets dans un fichier d'&eacute;v&eacute;nements
d66 4
a69 4
Les flux correspondant aux r&egrave;gles de <a
href="filter.html">filtrage</a> qui contiennent les mots-cl&eacute;s
<tt>log</tt> ou <tt>log-all</tt> sont enregistr&eacute;s de cette
mani&egrave;re.
d72 2
a73 2
<h2>Lire un Fichier d'Ev&eacute;nements</h2>
Le fichier d'&eacute;v&eacute;nements &eacute;crit par pflogd est dans
d78 1
a78 1
Pour lire le fichier d'&eacute;v&eacute;nements :
d86 2
a87 2
Il est &agrave; noter que l'utilisation de tcpdump(8) pour lire le
fichier pflog ne donne <i>pas</i> un affichage en temps r&eacute;el.
d98 19
a116 19
Lorsque vous examinez les &eacute;v&eacute;nements, une attention
particuli&egrave;re doit &ecirc;tre prise par rapport au d&eacute;codage
verbeux des protocoles effectu&eacute; par tcpdump (d&eacute;codage
activ&eacute; par l'option <tt>-v</tt>). Les d&eacute;codeurs
protocolaires de tcpdump ne poss&egrave;dent pas un historique
s&eacute;curit&eacute; parfait. En th&eacute;orie du moins, une attaque
retard&eacute;e peut &ecirc;tre possible &agrave; travers les charges
utiles partielles enregistr&eacute;es par le p&eacute;riph&eacute;rique
d'enregistrement d'&eacute;v&eacute;nements. Il est recommand&eacute; de
d&eacute;placer les fichiers d'&eacute;v&eacute;nements du pare-feu
avant de proc&eacute;der &agrave; leur examen de cette mani&egrave;re.

<p>
Des pr&eacute;cautions suppl&eacute;mentaires doivent &ecirc;tres prises
pour s&eacute;curiser l'acc&egrave;s aux &eacute;v&eacute;nements. Par
d&eacute;faut, pflogd enregistrera 96 octets du paquet dans le fichier
d'&eacute;v&eacute;nements. L'acc&egrave;s aux fichiers
d'&eacute;v&eacute;nements pourrait fournir un acc&egrave;s partiel
&agrave; des charges utiles de paquets sensibles (tels que les noms
d122 6
a127 6
<h2>Filtrer les Ev&eacute;nements en Sortie</h2>
Etant donn&eacute; que pflogd enregistre les &eacute;v&eacute;nements au
format binaire tcpdump, la totalit&eacute; des fonctionnalit&eacute;s
tcpdump peut &ecirc;tre utilis&eacute;e pour analyser les
&eacute;v&eacute;nements. Par exemple, pour voir uniquement les paquets
qui correspondent &agrave; un certain port :
d135 2
a136 2
Ceci peut &ecirc;tre encore affin&eacute; en limitant l'affichage des
paquets &agrave; une certaine combinaison de h&ocirc;te et de port :
d144 2
a145 2
La m&ecirc;me id&eacute;e peut &ecirc;tre appliqu&eacute;e quand on lit
les &eacute;v&eacute;n&eacute;ments directement &agrave; partir de
d154 2
a155 2
Il est &agrave; noter que ces manipulations n'ont aucun impact sur les
paquets enregistr&eacute;s dans le fichier d'&eacute;v&eacute;nements
d157 1
a157 1
et &agrave; mesure qu'ils sont enregistr&eacute;s.
d160 1
a160 1
En plus de l'utilisation des r&egrave;gles de filtrage standard
d163 1
a163 1
&eacute;t&eacute; &eacute;tendu pour lire la sortie de pflogd :
d167 1
a167 1
<li><tt>on <i>int</i></tt> - le paquet est pass&eacute; &agrave; travers
d171 3
a173 3
<li><tt>rulenum <i>num</i></tt> - la r&egrave;gle de filtrage &agrave;
    laquelle correspondait le paquet &eacute;tait la r&egrave;gle
    num&eacute;ro <i>num</i>.
d177 1
a177 1
    l'<tt>action</tt> a &eacute;t&eacute; prise. Les raisons possibles
d180 2
a181 2
<li><tt>inbound</tt> - le paquet &eacute;tait entrant.
<li><tt>outbound</tt> - le paquet &eacute;tait sortant.
d193 2
a194 2
Cette commande affichera l'&eacute;v&eacute;nement en temps r&eacute;el
cr&eacute;e par des paquets entrants bloqu&eacute;s sur l'interface wi0.
d197 1
a197 1
<h2>Enregistrement des Ev&eacute;nements &agrave; Travers Syslog</h2>
d199 3
a201 3
&eacute;v&eacute;nements enregistr&eacute;s par le pare-feu sous format
ASCII ou de les envoyer &agrave; un serveur d'&eacute;v&eacute;nements
central distant. Tout ceci peut &ecirc;tre effectu&eacute; par deux
d206 4
a209 4
le service qui permet d'enregistrer les &eacute;v&eacute;nements.
Syslogd enregistre les &eacute;v&eacute;nements sous format ASCII et il
est aussi capable de les envoyer &agrave; un serveur
d'&eacute;v&eacute;nements distant.
d212 3
a214 3
Il faut d'abord cr&eacute;er un utilisateur, <tt>pflogger</tt>, avec un
shell <tt>/sbin/nologin</tt>. La fa&ccedil;on la plus simple de
cr&eacute;er cet utilisateur consiste &agrave; utiliser la commande
d218 2
a219 2
Apr&egrave;s avoir cr&eacute;e l'utilisateur <tt>pflogger</tt>,
cr&eacute;ez les deux scripts suivants :
d243 1
a243 1
Editez la liste des t&acirc;ches cron du super-utilisateur root :
d254 1
a254 1
# effectuer une rotation du fichier d'&eacute;v&eacute;nements<br>
d261 1
a261 1
Cr&eacute;er une liste de t&acirc;ches cron pour l'utilisateur
d273 1
a273 1
# alimenter le(s) fichier(s) pflog apr&egrave;s rotation &agrave;<br>
d289 2
a290 2
Si vous voulez les envoyer aussi &agrave; un serveur
d'&eacute;v&eacute;nements distant, ajoutez la ligne suivante
d298 2
a299 2
Assurez vous que le h&ocirc;te <i>syslogger</i> a bien &eacute;t&eacute;
d&eacute;fini dans le fichier
d303 2
a304 2
Cr&eacute;ez le fichier <tt>/var/log/pflog.txt</tt> afin de permettre
&agrave; syslog d'enregistrer les &eacute;v&eacute;nements dans ce
d321 4
a324 4
Tous les &eacute;v&eacute;nements enregistr&eacute;s sont maintenant
envoy&eacute;s vers <tt>/var/log/pflog.txt</tt>. Si la seconde ligne a
&eacute;t&eacute; ajout&eacute;e, les &eacute;v&eacute;nements sont
aussi envoy&eacute;s au serveur d'&eacute;v&eacute;nements distant
d328 2
a329 2
Le script <tt>/etc/pflogrotate</tt> traite d&eacute;sormais
<tt>/var/log/pflog</tt> et le supprime &agrave; la fin du traitement. La
d332 4
a335 4
n'est plus n&eacute;cessaire d&eacute;sormais et devrait &ecirc;tre
d&eacute;sactiv&eacute;e. Cependant <tt>/var/log/pflog.txt</tt> remplace
<tt>/var/log/pflog</tt> et sa rotation devrait &ecirc;tre
activ&eacute;e. Modifiez <tt>/etc/newsyslog.conf</tt> comme suit :
d342 8
a349 8
PF, &agrave; l'aide du m&eacute;canisme pr&eacute;cit&eacute;,
g&eacute;n&eacute;rera des &eacute;v&eacute;nements qui seront
enregistr&eacute;s dans le fichier <tt>/var/log/pflog.txt</tt>. Ces
&eacute;v&eacute;nements pourront aussi &ecirc;tre envoy&eacute;s
&agrave; un serveur d'&eacute;v&eacute;nements distant. La conversion en
ASCII n'est pas imm&eacute;diate. Elle prend jusqu'&agrave; 5-6 minutes
(l'intervalle d'ex&eacute;cution de la t&acirc;che cron) avant que les
&eacute;v&eacute;nements enregistr&eacute;s apparaissent dans le
d353 1
a353 1
[<a href="tagging.html">Pr&eacute;c&eacute;dent : Balisage de
d365 1
a365 1
$Translation: logging.html,v 1.6 2004/10/06 17:17:44 saad Exp $<br>
@


1.5
log
@sync with Steelix CVS. thanks to Olivier HORN <ohorn at axal dot fr> for
a fix.
@
text
@d67 1
a67 1
href="../filter.html">filtrage</a> qui contiennent les mots-cl&eacute;s
d365 1
a365 1
$Translation: logging.html,v 1.5 2004/05/12 20:21:45 saad Exp $<br>
@


1.4
log
@Sync with Steelix CVS
@
text
@a10 1
<meta name="copyright"     content="This document copyright 2003-2004 by OpenBSD.">
d13 17
d364 2
a365 2
Originally [OpenBSD: logging.html,v 1.14 ]<br>
$Translation: logging.html,v 1.4 2004/05/02 21:04:14 saad Exp $<br>
@


1.3
log
@Sync with Steelix CVS
@
text
@d44 1
a44 1
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=pflogd&amp;sektion=8&amp;manpath=OpenBSD+3.4">pflogd(8)</a>
d46 1
a46 1
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=pflog&amp;sektion=4&amp;manpath=OpenBSD+3.4">pflog0</a>
d49 1
a49 1
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=tcpdump&amp;sektion=8&amp;manpath=OpenBSD+3.4">tcpdump(8)</a>.
d73 1
a73 1
l'interface pflog0 :
d102 2
a103 2
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=telnet&amp;sektion=1&amp;manpath=OpenBSD+3.4">telnet(1)</a> ou
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=ftp&amp;sektion=1&amp;manpath=OpenBSD+3.4">ftp(1)</a>).
d130 1
a130 1
l'interface pflog0 :
d145 1
a145 1
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=tcpdump&amp;sektion=8&amp;manpath=OpenBSD+3.4">tcpdump(8)</a>,
d189 1
a189 1
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=syslogd&amp;sektion=8&amp;manpath=OpenBSD+3.4">syslogd(8)</a>, 
d199 1
a199 1
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=adduser&amp;sektion=8&amp;manpath=OpenBSD+3.4">adduser(8)</a>.
d284 1
a284 1
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=hosts&amp;sektion=5&amp;manpath=OpenBSD+3.4">hosts(5)</a>.
d315 1
a315 1
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=newsyslog&amp;sektion=8&amp;manpath=OpenBSD+3.4">newsyslog(8)</a> 
d348 2
a349 2
Originally [OpenBSD: logging.html,v 1.13 ]<br>
$Translation: logging.html,v 1.3 2004/02/19 20:31:29 saad Exp $<br>
@


1.2
log
@Sync with Steelix CVS
@
text
@d23 1
a23 1
[<a href="perf.html">Suivant : Performance</a>]
d340 1
a340 1
[<a href="perf.html">Suivant : Performance</a>]
d349 1
a349 1
$Translation: logging.html,v 1.2 2004/01/02 21:49:07 saad Exp $<br>
@


1.1
log
@Sync with Steelix CVS
@
text
@d11 1
a11 1
<meta name="copyright"     content="This document copyright 2003 by OpenBSD.">
d287 10
d348 2
a349 2
Originally [OpenBSD: logging.html,v 1.11 ]<br>
$Translation: logging.html,v 1.1 2003/12/28 21:20:14 saad Exp $<br>
@

