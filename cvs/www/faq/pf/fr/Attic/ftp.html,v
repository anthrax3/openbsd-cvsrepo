head	1.38;
access;
symbols;
locks; strict;
comment	@# @;


1.38
date	2014.04.01.17.14.10;	author nick;	state dead;
branches;
next	1.37;

1.37
date	2013.11.01.18.04.05;	author ajacoutot;	state Exp;
branches;
next	1.36;

1.36
date	2013.05.07.12.47.22;	author ajacoutot;	state Exp;
branches;
next	1.35;

1.35
date	2012.11.02.07.24.05;	author ajacoutot;	state Exp;
branches;
next	1.34;

1.34
date	2012.05.19.22.52.00;	author ajacoutot;	state Exp;
branches;
next	1.33;

1.33
date	2012.05.13.16.30.18;	author ajacoutot;	state Exp;
branches;
next	1.32;

1.32
date	2011.11.05.12.45.49;	author ajacoutot;	state Exp;
branches;
next	1.31;

1.31
date	2011.05.07.08.22.01;	author ajacoutot;	state Exp;
branches;
next	1.30;

1.30
date	2010.11.09.08.15.21;	author ajacoutot;	state Exp;
branches;
next	1.29;

1.29
date	2010.05.24.18.32.44;	author ajacoutot;	state Exp;
branches;
next	1.28;

1.28
date	2009.10.20.20.44.42;	author ajacoutot;	state Exp;
branches;
next	1.27;

1.27
date	2009.05.01.13.16.23;	author tobias;	state Exp;
branches;
next	1.26;

1.26
date	2008.12.01.07.52.52;	author tobias;	state Exp;
branches;
next	1.25;

1.25
date	2008.08.25.14.21.24;	author tobias;	state Exp;
branches;
next	1.24;

1.24
date	2008.01.13.13.43.34;	author tobias;	state Exp;
branches;
next	1.23;

1.23
date	2007.05.09.05.49.53;	author jufi;	state Exp;
branches;
next	1.22;

1.22
date	2007.02.14.19.01.55;	author jufi;	state Exp;
branches;
next	1.21;

1.21
date	2007.02.06.06.04.56;	author saad;	state Exp;
branches;
next	1.20;

1.20
date	2007.01.06.02.47.26;	author saad;	state Exp;
branches;
next	1.19;

1.19
date	2006.12.27.16.17.16;	author saad;	state Exp;
branches;
next	1.18;

1.18
date	2006.12.25.19.10.14;	author jufi;	state Exp;
branches;
next	1.17;

1.17
date	2006.05.12.06.32.29;	author jufi;	state Exp;
branches;
next	1.16;

1.16
date	2006.05.03.14.48.29;	author saad;	state Exp;
branches;
next	1.15;

1.15
date	2006.05.02.17.09.33;	author jufi;	state Exp;
branches;
next	1.14;

1.14
date	2005.11.03.11.30.53;	author saad;	state Exp;
branches;
next	1.13;

1.13
date	2005.05.22.17.38.07;	author saad;	state Exp;
branches;
next	1.12;

1.12
date	2005.01.18.09.54.52;	author jufi;	state Exp;
branches;
next	1.11;

1.11
date	2004.12.29.10.38.26;	author saad;	state Exp;
branches;
next	1.10;

1.10
date	2004.11.03.21.01.25;	author saad;	state Exp;
branches;
next	1.9;

1.9
date	2004.11.01.02.56.30;	author saad;	state Exp;
branches;
next	1.8;

1.8
date	2004.10.13.14.44.30;	author jufi;	state Exp;
branches;
next	1.7;

1.7
date	2004.10.11.16.17.48;	author jufi;	state Exp;
branches;
next	1.6;

1.6
date	2004.05.12.20.51.36;	author saad;	state Exp;
branches;
next	1.5;

1.5
date	2004.05.06.21.34.05;	author saad;	state Exp;
branches;
next	1.4;

1.4
date	2004.02.20.06.33.11;	author jufi;	state Exp;
branches;
next	1.3;

1.3
date	2004.01.16.20.22.29;	author jufi;	state Exp;
branches;
next	1.2;

1.2
date	2004.01.03.19.45.23;	author jufi;	state Exp;
branches;
next	1.1;

1.1
date	2003.12.29.22.13.35;	author horacio;	state Exp;
branches;
next	;


desc
@@


1.38
log
@
Abandon translations, per deraadt@@ and ajacoutot@@.
@
text
@<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<html>
<head>
<title>PF : Gestion du Protocole FTP</title>
<link rev="made" href="mailto:www@@openbsd.org">
<meta http-equiv="Content-Type" content="text/html; charset=ISO-8859-1">
<meta name="resource-type" content="document">
<meta name="description"   content="the OpenBSD FAQ page">
<meta name="keywords"      content="openbsd,faq,pf">
<meta name="distribution"  content="global">
</head>

<!--
Copyright (c) 2003, 2004 Joel Knight <enabled@@myrealbox.com>

Permission to use, copy, modify, and distribute this documentation for
any purpose with or without fee is hereby granted, provided that the
above copyright notice and this permission notice appear in all copies.

THE DOCUMENTATION IS PROVIDED "AS IS" AND THE AUTHOR DISCLAIMS ALL
WARRANTIES WITH REGARD TO THIS DOCUMENTATION INCLUDING ALL IMPLIED
WARRANTIES OF MERCHANTABILITY AND FITNESS. IN NO EVENT SHALL THE
AUTHOR BE LIABLE FOR ANY SPECIAL, DIRECT, INDIRECT, OR CONSEQUENTIAL
DAMAGES OR ANY DAMAGES WHATSOEVER RESULTING FROM LOSS OF USE, DATA OR
PROFITS, WHETHER IN AN ACTION OF CONTRACT, NEGLIGENCE OR OTHER
TORTIOUS ACTION, ARISING OUT OF OR IN CONNECTION WITH THE USE OR
PERFORMANCE OF THIS DOCUMENTATION
-->

<body bgcolor="#ffffff" text="#000000">
<!-- Passes validator.w3.org, please keep it this way;
please, use a max of 72 chars per line -->

<a href="../../fr/index.html">
<img alt="[OpenBSD]" height="30" width="141" src="../../../images/smalltitle.gif" border="0">
</a>
<p>
[<a href="perf.html">Précédent : Performances</a>]
[<a href="index.html">Index</a>]
[<a href="authpf.html">Suivant : Authpf : Shell Utilisateur pour les
Passerelles d'Authentification</a>]

<p>
<h1><font color="#e00000">PF : Gestion du Protocole FTP</font></h1>
<hr>

<h3>Table des Matières</h3>
<ul>
<li><a href="#modes">Modes FTP</a>
<li><a href="#client">Client FTP derrière un pare-feu</a>
<li><a href="#server">Serveur FTP protégé par un pare-feu PF local</a>
<li><a href="#natserver">Serveur FTP protégé par un pare-feu PF externe
	avec NAT</a>
<li><a href="#info">Plus d'informations sur FTP</a>
<li><a href="#tftp-proxy">Proxy TFTP</a>
</ul>

<hr>

<a name="modes"></a>
<h2>Modes FTP</h2>
FTP est un protocole qui date d'une époque où Internet était un petit
ensemble de machines avec des relations de confiance mutuelle et où tout
le monde connaissait tout le monde. A cette époque le besoin de filtrer
ou d'assurer une sécurité stricte était inexistant. FTP n'était pas
conçu pour filtrer, pour faire transiter du trafic à travers les 
pare-feu, ou pour fonctionner avec la NAT.

<p>
FTP peut fonctionner dans deux modes : passif et actif. De manière
générale, le choix du mode actif ou passif consiste à déterminer
l'extrêmité de communication FTP qui a un problème avec le filtrage 
pare-feu. Dans le meilleur des mondes, il faudrait supporter les deux 
modes pour rendre vos utilisateurs heureux.

<p>
Dans le mode FTP actif, quand un utilisateur se connecte à un serveur
FTP distant et demande une information ou un fichier, le serveur FTP
effectue une connexion vers le client pour transférer les données
demandées. Cette connexion est appelée la <i>connexion de données</i>.
Pour commencer, le client FTP choisit un port aléatoire qui lui servira
pour recevoir les données. Le client envoie le numéro de port qu'il a
choisi au serveur FTP puis se met à l'écoute des connexions entrantes à
destination de ce port. Le serveur FTP initie ensuite une connexion vers
l'adresse du client sur le port choisi et transfère les données. Ce mode
de fonctionnement est problématique pour les utilisateurs essayant
d'accéder à des serveurs FTP lorsqu'ils sont derrière une passerelle
NAT. Vu la manière dont fonctionne la NAT, le serveur FTP initie la
connexion de données en se connectant à l'adresse externe de la
passerelle NAT sur le port choisi. La passerelle NAT n'a pas de
correspondance pour le paquet reçu dans sa table d'état. Le paquet sera
ignoré et ne sera pas délivré au client.

<p>
Dans le mode FTP passif (le mode par défaut utilisé par le client
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=ftp&amp;sektion=1">ftp(1)</a> 
d'OpenBSD), le client demande au serveur de choisir un port aléatoire
sur lequel ce dernier se mettra à l'écoute en attente de la connexion de
données. Le serveur communique au client le port qu'il a choisi pour le
transfert des données. Malheureusement, ce n'est pas toujours possible
ou souhaitable à cause de la possibilité d'existence d'un pare-feu
devant le serveur FTP qui bloquerait les connexions de données en
entrée. Le client ftp(1) d'OpenBSD utilise le mode passif par défaut;
pour forcer le mode FTP actif, utilisez le drapeau -A du client ftp(1).
Il est aussi possible de désactiver le mode passif (et donc d'activer
par cette action le mode actif) en utilisant la commande "<tt>passive
off</tt>" à l'invite de commandes "<tt>ftp&gt;</tt>".


<a name="client"></a>
<h2>Client FTP derrière un pare-feu</h2>
Comme précédemment indiqué, FTP ne fonctionne pas très bien à travers
des mécanismes de NAT et des pare-feux.

<p>
Packet Filter fournit une solution à ce cas en détournant le trafic FTP
à travers un serveur mandataire FTP (proxy). Ce processus agit de telle
façon à "guider" votre trafic FTP à travers la passerelle NAT/pare-feu
en activant des règles pour PF puis en les désactivant lorsque le
transfert est terminé à l'aide du système des
<a href="anchors.html">ancres</a> PF. Le proxy FTP utilisé par PF est
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=ftp-proxy&amp;sektion=8&amp;manpath=OpenBSD+5.4">ftp-proxy(8)</a>.

<p>
Pour l'activer, ajustez la ligne suivante selon vos besoins et ajoutez
la tôt à la section des règles de <tt>pf.conf</tt> :

<blockquote>
<tt>
pass in quick on $int_if proto tcp to port 21 divert-to 127.0.0.1 port 8021
</tt>
</blockquote>

<p>
Cela détourne FTP en provenance de vos clients vers le programme ftp-proxy(8) 
qui écoute sur votre machine au port 8021.

<p>
Vous avez également besoin dans vos règles :
<blockquote>
<tt>
anchor "ftp-proxy/*"
</tt>
</blockquote>

<p>
Il est évident que le serveur mandataire doit être démarré et exécuté
sur la machine OpenBSD. Ceci peut être effectué en insérant la ligne
suivante dans <tt>/etc/rc.conf.local</tt> :

<blockquote>
<tt>
ftpproxy_flags=""
</tt>
</blockquote>

<p>
Le programme ftp-proxy peut être démarré en tant que root afin d'avoir 
à éviter de redémarrer.

<p>
ftp-proxy écoute sur le port 8021, le même port auquel la ligne
<tt>divert-to</tt> précédente renvoie le trafic FTP.

<p>
Pour supporter les connexions actives de certains clients (maniaque), 
vous devez utiliser l'option "-r" de ftp-proxy(8).

<a name="server"></a>
<h2>Serveur FTP protégé par un pare-feu PF local</h2>
Dans ce cas, PF est activé sur le serveur FTP lui-même
plutôt que sur un pare-feu dédié. Pour les besoins
d'une connexion FTP passive, FTP utilisera un haut port TCP choisi de
manière aléatoire pour les données entrantes. Par
défaut, le serveur FTP natif d'OpenBSD
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=ftpd&amp;sektion=8">ftpd(8)</a> 
utilise la plage 49152 à 65535. Ces ports doivent être
autorisés en entrée ainsi que le port 21 (le port de
contrôle FTP) :

<blockquote>
<tt>
pass in on $ext_if proto tcp to port 21<br>
pass in on $ext_if proto tcp to port &gt; 49151
</tt>
</blockquote>

<p>
Si vous le souhaitez, vous pouvez restreindre cette plage
considérablement. Dans le cas du programme
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=ftpd&amp;sektion=8">ftpd(8)</a> 
d'OpenBSD, ceci peut être effectué en utilisant les
variables
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=sysctl&amp;sektion=8">sysctl(8)</a> 
<tt>net.inet.ip.porthifirst</tt> et
<tt>net.inet.ip.porthilast</tt>.

<a name="natserver"></a>
<h2>Serveur FTP protégé par un pare-feu PF externe avec NAT</h2>
Dans ce cas, le pare-feu doit rediriger tout le trafic vers le serveur
FTP et ne doit pas bloquer les ports requis. Afin d'accomplir celà,
parlons à nouveau de ftp-proxy(8).

<p>
ftp-proxy(8) peut-être utilisé dans un mode ou il transmet toutes les
connexions FTP à un serveur FTP spécifique.
Généralement, on configurera le proxy pour écouter sur le port 21 du
firewall et rediriger toutes les connexions sur le serveur applicatif.

<p>
Editez <tt>/etc/rc.conf.local</tt> et ajoutez :

<blockquote>
<tt>
ftpproxy_flags="-R 10.10.10.1 -p 21 -b 192.168.0.1"
</tt>
</blockquote>

<p>
Ici, 10.10.10.1 est l'adresse IP du serveur FTP, 21 est le port sur
lequel va écouter ftp-proxy(8), et 192.168.0.1 est l'adresse du firewall
sur laquelle doit écouter le proxy.

<p>
À présent, pour les règles de pf.conf :

<blockquote>
<tt>
ext_ip = "192.168.0.1"<br>
ftp_ip = "10.10.10.1"<br>
<br>
match out on $ext_if inet from $int_if nat-to ($ext_if)<br>
<br>
anchor "ftp-proxy/*"<br>
pass in on $ext_if inet proto tcp to $ext_ip port 21<br>
pass out on $int_if inet proto tcp to $ftp_ip port 21 user proxy
</tt>
</blockquote>

<p>
Ici, nous autorisons la connexion entrante sur le port 21 et l'interface
externe ainsi que la connexion sortante vers le serveur FTP.
L'ajout de "user proxy" à la règle de sortie permet de s'assurer que
seules les connexions initiées par ftp-proxy(8) sont permises.

<p>
Il est à noter que si vous désirez que ftp-proxy(8) protège un serveur
FTP sans empêcher pour autant les clients de faire du FTP sortant en
étant derrière le firewall, deux instances de ftp-proxy seront
nécessaires.

<a name="info"></a>
<h2>Plus d'informations sur FTP</h2>
Vous pouvez obtenir plus d'informations concernant le filtrage et le
fonctionnement de FTP de manière générale dans le
livre blanc suivant :
<ul>
<li><a href="http://www.pintday.org/whitepapers/ftp-review.shtml">FTP
Reviewed</a>
</ul>

<a name="tftp-proxy"></a>
<h2>Proxy TFTP</h2>

<p>
Le protocole Trivial File Transfer Protocol (TFTP) souffre du même genre
de limitations que FTP lorsqu'il s'agit de traverser un
firewall. Heureusement, PF dispose d'un proxy d'aide pour TFTP appelé
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=tftp-proxy&amp;sektion=8&amp;manpath=OpenBSD+5.4">tftp-proxy(8)</a>.

<p>
tftp-proxy(8) est configuré d'une façon similaire à celle de
ftp-proxy(8) dans la section <a href="#client">Client FTP derrière un
pare-feu</a> ci-dessus.

<blockquote>
<tt>
match out on $ext_if from $int_if nat-to ($ext_if)<br>
anchor "tftp-proxy/*"<br>
pass in quick on $int_if inet proto udp from $int_if to port tftp \<br>
&nbsp;&nbsp;&nbsp;&nbsp;divert-to 127.0.0.1 port 6969<br>
<br>
anchor "tftp-proxy/*"
</tt>
</blockquote>

<p>
Les règles ci-dessus autorisent le protocole TFTP en sortie depuis le
réseau interne et vers les serveurs TFTP sur le réseau externe.

<p>
La dernière étape à considérer est l'activation de tftp-proxy dans
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=inetd.conf&amp;sektion=5"
>inetd.conf(5)</a> afin que ce dernier écoute sur le port indiqué par la
règle <tt>divert-to</tt> ci-dessus, en l'occurence 6969.

<blockquote>
<tt>
127.0.0.1:6969  dgram   udp   wait  root  /usr/libexec/tftp-proxy tftp-proxy
</tt>
</blockquote>

<p>
Contrairement à ftp-proxy(8), tftp-proxy(8) est utilisé via inetd.

<p>
[<a href="perf.html">Précédent : Performances</a>]
[<a href="index.html">Index</a>]
[<a href="authpf.html">Suivant : Authpf : Shell Utilisateur pour les
Passerelles d'Authentification</a>]

<p>
<hr>
<a href="index.html"><img height="24" width="24" src="../../../images/back.gif" border="0" alt="[back]"></a> 
<a href="mailto:www@@openbsd.org">www@@openbsd.org</a>
<br>
<small>
<!--
Originally [OpenBSD: ftp.html,v 1.39 ]<br>
$Translation: ftp.html,v 1.41 2013/11/01 17:02:17 rustybsd Exp $<br>
-->
$OpenBSD: ftp.html,v 1.37 2013/11/01 18:04:05 ajacoutot Exp $
</small>

</body>
</html> 
@


1.37
log
@Sync with Steelix CVS
@
text
@d322 1
a322 1
$OpenBSD$
@


1.36
log
@Sync with Steelix CVS
@
text
@d122 1
a122 1
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=ftp-proxy&amp;sektion=8&amp;manpath=OpenBSD+5.3">ftp-proxy(8)</a>.
d269 1
a269 1
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=tftp-proxy&amp;sektion=8&amp;manpath=OpenBSD+5.3">tftp-proxy(8)</a>.
d319 2
a320 2
Originally [OpenBSD: ftp.html,v 1.38 ]<br>
$Translation: ftp.html,v 1.40 2013/05/07 08:34:48 rustybsd Exp $<br>
@


1.35
log
@Sync with Steelix CVS
@
text
@d122 1
a122 1
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=ftp-proxy&amp;sektion=8&amp;manpath=OpenBSD+5.2">ftp-proxy(8)</a>.
d269 1
a269 1
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=tftp-proxy&amp;sektion=8&amp;manpath=OpenBSD+5.2">tftp-proxy(8)</a>.
d319 2
a320 2
Originally [OpenBSD: ftp.html,v 1.37 ]<br>
$Translation: ftp.html,v 1.39 2012/11/01 19:46:21 rustybsd Exp $<br>
@


1.34
log
@Sync with Steelix CVS
@
text
@d122 1
a122 1
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=ftp-proxy&amp;sektion=8&amp;manpath=OpenBSD+5.1">ftp-proxy(8)</a>.
d269 1
a269 1
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=tftp-proxy&amp;sektion=8&amp;manpath=OpenBSD+5.1">tftp-proxy(8)</a>.
d319 2
a320 2
Originally [OpenBSD: ftp.html,v 1.36 ]<br>
$Translation: ftp.html,v 1.38 2012/05/17 14:16:54 rustybsd Exp $<br>
@


1.33
log
@Sync with Steelix CVS
@
text
@d113 1
a113 1
des mécanismes de NAT et des pare-feu.
d320 1
a320 1
$Translation: ftp.html,v 1.37 2012/05/11 15:00:20 rustybsd Exp $<br>
@


1.32
log
@Sync with Steelix CVS
@
text
@d122 1
a122 1
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=ftp-proxy&amp;sektion=8&amp;manpath=OpenBSD+5.0">ftp-proxy(8)</a>.
d269 1
a269 1
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=tftp-proxy&amp;sektion=8&amp;manpath=OpenBSD+5.0">tftp-proxy(8)</a>.
d319 2
a320 2
Originally [OpenBSD: ftp.html,v 1.35 ]<br>
$Translation: ftp.html,v 1.36 2011/11/05 09:20:59 benoit Exp $<br>
@


1.31
log
@Sync with Steelix CVS
@
text
@d116 1
a116 1
Packet Filter fournit une solution à ce cas en redirigeant le trafic FTP
d122 1
a122 1
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=ftp-proxy&amp;sektion=8&amp;manpath=OpenBSD+4.9">ftp-proxy(8)</a>.
d130 1
a130 1
pass in quick on $int_if proto tcp to port 21 rdr-to 127.0.0.1 port 8021
d135 1
a135 1
Cela redirige FTP en provenance de vos clients vers le programme ftp-proxy(8) 
d163 1
a163 1
<tt>rdr-to</tt> précédente renvoie le trafic FTP.
d269 1
a269 1
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=tftp-proxy&amp;sektion=8&amp;manpath=OpenBSD+4.9">tftp-proxy(8)</a>.
d280 2
a281 2
pass in quick on $int_if proto udp from $int_if to port tftp \<br>
&nbsp;&nbsp;&nbsp;&nbsp;rdr-to 127.0.0.1 port 6969<br>
d295 1
a295 1
règle <tt>rdr-to</tt> ci-dessus, en l'occurence 6969.
d319 2
a320 2
Originally [OpenBSD: ftp.html,v 1.33 ]<br>
$Translation: ftp.html,v 1.35 2011/05/07 06:58:36 benoit Exp $<br>
@


1.30
log
@Sync with Steelix CVS
@
text
@d122 1
a122 2
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=ftp-proxy&amp;sektion=8&amp;manpath=OpenBSD+4.8">
ftp-proxy(8)</a>.
d269 1
a269 2
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=tftp-proxy&amp;sektion=8&amp;manpath=OpenBSD+4.8"
>tftp-proxy(8)</a>.
d319 2
a320 2
Originally [OpenBSD: ftp.html,v 1.32 ]<br>
$Translation: ftp.html,v 1.34 2010/11/06 14:32:40 benoit Exp $<br>
@


1.29
log
@Sync with Steelix CVS
@
text
@d122 1
a122 1
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=ftp-proxy&amp;sektion=8&amp;manpath=OpenBSD+4.7">
d270 1
a270 1
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=tftp-proxy&amp;sektion=8&amp;manpath=OpenBSD+4.7"
d321 2
a322 2
Originally [OpenBSD: ftp.html,v 1.31 ]<br>
$Translation: ftp.html,v 1.33 2010/05/24 14:33:24 benoit Exp $<br>
@


1.28
log
@Sync with Steelix CVS
@
text
@d122 1
a122 1
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=ftp-proxy&amp;sektion=8&amp;manpath=OpenBSD+4.6">
d127 1
a127 1
la à la section NAT de <tt>pf.conf</tt> :
d131 1
a131 4
nat-anchor "ftp-proxy/*"<br>
rdr-anchor "ftp-proxy/*"<br>
rdr on $int_if proto tcp from any to any port 21 -&gt; 127.0.0.1 \<br>
&nbsp;&nbsp;&nbsp;port 8021
d136 2
a137 5
Les deux premières lignes sont les <a href="anchors.html">ancres</a>
utilisées par ftp-proxy afin d'ajouter les règles à chaud afin de gérer
votre trafic FTP. La dernière ligne redirige FTP en provenance de vos
clients vers le programme ftp-proxy(8) qui écoute sur votre machine au
port 8021.
d164 1
a164 1
<tt>rdr</tt> précédente renvoie le trafic FTP.
d167 2
a168 3
Pour activer les connexions actives, vous devez utiliser l'option "-r"
de ftp-proxy(8) (avec l'ancien proxy, vous utilisiez l'option
"-u root").
d184 2
a185 3
pass in on $ext_if proto tcp from any to any port 21 keep state<br>
pass in on $ext_if proto tcp from any to any port &gt; 49151 \<br>
&nbsp;&nbsp;&nbsp;keep state
d233 1
a233 3
nat-anchor "ftp-proxy/*"<br>
nat on $ext_if inet from $int_if -&gt; ($ext_if)<br>
rdr-anchor "ftp-proxy/*"<br>
d235 3
a237 5
pass in on $ext_if inet proto tcp to $ext_ip port 21 \<br>
&nbsp;&nbsp;&nbsp;&nbsp;flags S/SA keep state<br>
pass out on $int_if inet proto tcp to $ftp_ip port 21 \<br>
&nbsp;&nbsp;&nbsp;&nbsp;user proxy flags S/SA keep state<br>
anchor "ftp-proxy/*"
d270 1
a270 1
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=tftp-proxy&amp;sektion=8&amp;manpath=OpenBSD+4.6"
d280 4
a283 4
nat on $ext_if from $int_if -&gt; ($ext_if)<br>
rdr-anchor "tftp-proxy/*"<br>
rdr on $int_if proto udp from $int_if to port tftp -&gt; \<br>
&nbsp;&nbsp;&nbsp;&nbsp;127.0.0.1 port 6969<br>
d297 1
a297 1
règle <tt>rdr</tt> ci-dessus, en l'occurence 6969.
d321 2
a322 2
Originally [OpenBSD: ftp.html,v 1.29 ]<br>
$Translation: ftp.html,v 1.31 2009/10/19 15:48:30 benoit Exp $<br>
@


1.27
log
@Sync with Steelix CVS
@
text
@d122 1
a122 1
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=ftp-proxy&amp;sektion=8&amp;manpath=OpenBSD+4.5">
d282 1
a282 1
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=tftp-proxy&amp;sektion=8&amp;manpath=OpenBSD+4.5"
d333 2
a334 2
Originally [OpenBSD: ftp.html,v 1.28 ]<br>
$Translation: ftp.html,v 1.30 2009/04/30 22:46:58 benoit Exp $<br>
@


1.26
log
@Sync with Steelix CVS
@
text
@d122 1
a122 1
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=ftp-proxy&amp;sektion=8&amp;manpath=OpenBSD+4.4">
d282 1
a282 1
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=tftp-proxy&amp;sektion=8&amp;manpath=OpenBSD+4.4"
d333 2
a334 2
Originally [OpenBSD: ftp.html,v 1.27 ]<br>
$Translation: ftp.html,v 1.29 2008/11/26 22:39:39 benoit Exp $<br>
d336 1
a336 1
$OpenBSD: ftp.html,v 1.14 2005/11/03 11:30:53 saad Exp $
@


1.25
log
@Sync with Steelix CVS
@
text
@d122 1
a122 1
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=ftp-proxy&amp;sektion=8&amp;manpath=OpenBSD+4.3">
d282 1
a282 1
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=tftp-proxy&amp;sektion=8&amp;manpath=OpenBSD+4.3"
d333 2
a334 2
Originally [OpenBSD: ftp.html,v 1.26 ]<br>
$Translation: ftp.html,v 1.28 2008/08/20 15:32:00 gapz Exp $<br>
@


1.24
log
@Sync with Steelix CVS
@
text
@d121 2
a122 3
<a href="anchors.html">ancres</a> PF. Le proxy FTP utilisé par PF dans
OpenBSD 3.9 et les releases suivantes est
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=ftp-proxy&amp;sektion=8&amp;manpath=OpenBSD+4.2">
a123 5
(remarque : les versions précédentes d'OpenBSD utilisaient un proxy
différent du même nom qui est documenté dans la page de manuel OpenBSD
3.8
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=ftp-proxy&amp;sektion=8&amp;manpath=OpenBSD+3.8">
ftp-proxy(8)v3.8</a>).
d282 1
a282 1
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=tftp-proxy&amp;sektion=8&amp;manpath=OpenBSD+4.2"
d333 2
a334 2
Originally [OpenBSD: ftp.html,v 1.25 ]<br>
$Translation: ftp.html,v 1.27 2008/01/11 10:30:25 saad Exp $<br>
@


1.23
log
@Sync with steelix translation CVS
@
text
@d123 1
a123 1
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=ftp-proxy&amp;sektion=8&amp;manpath=OpenBSD+4.1">
d288 1
a288 1
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=tftp-proxy&amp;sektion=8&amp;manpath=OpenBSD+4.1"
d339 2
a340 2
Originally [OpenBSD: ftp.html,v 1.24 ]<br>
$Translation: ftp.html,v 1.26 2007/05/07 09:38:20 ajacoutot Exp $<br>
@


1.22
log
@sync with steelix translation CVS
@
text
@d96 1
a96 1
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=ftp&amp;sektion=1&amp;manpath=OpenBSD+4.0">ftp(1)</a> 
d123 1
a123 1
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=ftp-proxy&amp;sektion=8&amp;manpath=OpenBSD+4.0">
d190 1
a190 1
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=ftpd&amp;sektion=8&amp;manpath=OpenBSD+4.0">ftpd(8)</a> 
d206 1
a206 1
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=ftpd&amp;sektion=8&amp;manpath=OpenBSD+4.0">ftpd(8)</a> 
d209 1
a209 1
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=sysctl&amp;sektion=8&amp;manpath=OpenBSD+4.0">sysctl(8)</a> 
d288 1
a288 1
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=tftp-proxy&amp;sektion=8&amp;manpath=OpenBSD+4.0"
d313 1
a313 1
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=inetd.conf&amp;sektion=5&amp;manpath=OpenBSD+4.0"
d339 2
a340 2
Originally [OpenBSD: ftp.html,v 1.23 ]<br>
$Translation: ftp.html,v 1.25 2007/02/14 17:12:53 benoit Exp $<br>
@


1.21
log
@sync with Steelix CVS
@
text
@d66 2
a67 2
conçu pour filtrer, pour faire transiter du trafic à travers les pare-
feu, ou pour fonctionner avec la NAT.
d72 3
a74 3
l'extrêmité de communication FTP qui a un problème avec le filtrage pare-
feu. Dans le meilleur des mondes, il faudrait supporter les deux modes
pour rendre vos utilisateurs heureux.
d148 1
a148 1
clients vers le program ftp-proxy(8) qui écoute sur votre machine au
d152 1
a152 1
Vous avez également besoin d'une dans vos règles :
d171 2
a172 2
Le program ftp-proxy peut être démarré en tant que root afin d'avoir à
éviter de redémarrer.
d308 1
a308 1
Les règles ci-dessus autorisent le protocole TFTP en sortie depuie le
d324 1
a324 1
Contrairement à ftp-proxy(8), tftp-proxy(8) est utilisé vi inetd.
d340 1
a340 1
$Translation: ftp.html,v 1.24 2007/02/05 07:03:30 benoit Exp $<br>
@


1.20
log
@Sync with Steelix CVS
@
text
@d67 1
a67 1
feux, ou pour fonctionner avec la NAT.
d113 1
a113 1
des mécanismes de NAT et des pare-feux.
d340 1
a340 1
$Translation: ftp.html,v 1.23 2007/01/05 10:38:39 ajacoutot Exp $<br>
@


1.19
log
@sync with Steelix CVS
@
text
@a10 1
<meta name="copyright"     content="This document copyright 2002-2004 by OpenBSD.">
d340 1
a340 1
$Translation: ftp.html,v 1.22 2006/12/26 10:29:45 ajacoutot Exp $<br>
@


1.18
log
@sync with steelix translation CVS
@
text
@d229 2
a230 1
<p>
d341 1
a341 1
$Translation: ftp.html,v 1.21 2006/12/24 18:28:20 aanriot Exp $<br>
@


1.17
log
@sync with steelix translation CVS
@
text
@d52 5
a56 5
<li><a href="#server">Serveur FTP protégé par un pare-feu
    PF local</a>
<li><a href="#natserver">Serveur FTP protégé par un
    pare-feu PF externe avec NAT</a>
<li><a href="#info">Plus d'Informations sur FTP</a>
d97 1
a97 1
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=ftp&amp;sektion=1&amp;manpath=OpenBSD+3.9">ftp(1)</a> 
d122 3
a124 3
<a href="anchors.html">ancres</a> PF. Le proxy FTP utilisé par OpenBSD
3.9 et PF est
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=ftp-proxy&amp;sektion=8&amp;manpath=OpenBSD+3.9">
a183 6
<p>
Veuillez noter que ftp-proxy(8) est utilisé pour aider les
<b>clients FTP</b> derrière un pare-feu PF ; il n'est pas
utilisé pour prendre en charge un <b>serveur FTP</b>
derrière un tel pare-feu.

d191 1
a191 1
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=ftpd&amp;sektion=8&amp;manpath=OpenBSD+3.9">ftpd(8)</a> 
d207 1
a207 1
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=ftpd&amp;sektion=8&amp;manpath=OpenBSD+3.9">ftpd(8)</a> 
d210 1
a210 1
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=sysctl&amp;sektion=8&amp;manpath=OpenBSD+3.9">sysctl(8)</a> 
d215 1
a215 2
<h2>Serveur FTP protégé par un pare-feu PF externe avec
    NAT</h2>
d217 11
a227 5
FTP. De plus, il ne doit bloquer aucun des ports requis. Pour fournir un
exemple concret, on supposera encore une fois que le serveur FTP est le
serveur standard sous OpenBSD :
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=ftpd&amp;sektion=8&amp;manpath=OpenBSD+3.9">ftpd(8)</a>, 
utilisant la plage de ports par défaut.
d230 12
a241 2
Voici un exemple de règles qui pourraient être
utilisées dans ce cas de figure :
d244 2
a245 1
ftp_server = "10.0.3.21"<br>
d247 3
a249 4
rdr on $ext_if proto tcp from any to any port 21 -&gt; $ftp_server \<br>
&nbsp;&nbsp;&nbsp;port 21<br>
rdr on $ext_if proto tcp from any to any port 49152:65535 -&gt; \<br>
&nbsp;&nbsp;&nbsp;$ftp_server port 49152:65535<br>
d251 5
a255 11
# in on $ext_if<br>
pass in quick on $ext_if proto tcp from any to $ftp_server \<br>
&nbsp;&nbsp;&nbsp;port 21 keep state<br>
pass in quick on $ext_if proto tcp from any to $ftp_server \<br>
&nbsp;&nbsp;&nbsp;port &gt; 49151 keep state<br>
<br>
# out on $int_if<br>
pass out quick on $int_if proto tcp from any to $ftp_server \<br>
&nbsp;&nbsp;&nbsp;port 21 keep state<br>
pass out quick on $int_if proto tcp from any to $ftp_server \<br>
&nbsp;&nbsp;&nbsp;port &gt; 49151 keep state
d259 11
d272 1
a272 1
<h2>Plus d'Informations sur FTP</h2>
d281 45
d339 2
a340 2
Originally [OpenBSD: ftp.html,v 1.22 ]<br>
$Translation: ftp.html,v 1.20 2006/05/11 13:42:11 ajacoutot Exp $<br>
@


1.16
log
@sync with Steelix CVS
@
text
@d153 8
d280 2
a281 2
Originally [OpenBSD: ftp.html,v 1.21 ]<br>
$Translation: ftp.html,v 1.19 2006/05/03 08:27:12 ajacoutot Exp $<br>
@


1.15
log
@sync with steelix translation CVS
@
text
@a176 2

<p>
d272 2
a273 2
Originally [OpenBSD: ftp.html,v 1.20 ]<br>
$Translation: ftp.html,v 1.18 2006/05/02 11:58:12 ajacoutot Exp $<br>
@


1.14
log
@sync with Steelix CVS
@
text
@d97 1
a97 1
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=ftp&amp;sektion=1&amp;manpath=OpenBSD+3.8">ftp(1)</a> 
a115 1

d119 14
a132 3
façon à "guider" votre trafic FTP à travers la passerelle NAT/pare-feu.
Le mandataire FTP utilisé par OpenBSD et PF est
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=ftp-proxy&amp;sektion=8&amp;manpath=OpenBSD+3.8">ftp-proxy(8)</a>.  
d138 2
d146 5
a150 3
Voici l'explication de cette ligne : "Le trafic entrant sur l'interface
interne est redirigé vers le serveur mandataire sur cette machine et
écoutant sur le port 8021".
d155 1
a155 1
suivante dans <tt>/etc/inetd.conf</tt> :
d159 1
a159 2
127.0.0.1:8021 stream tcp nowait root /usr/libexec/ftp-proxy \<br>
&nbsp;&nbsp;&nbsp;ftp-proxy -n
d164 6
a169 7
L'option <tt>-n</tt> est uniquement nécessaire si la machine OpenBSD
effectue de la traduction d'adresses (NAT). Il faut maintenant envoyer
un signal 'HUP' à
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=inetd&amp;sektion=8&amp;manpath=OpenBSD+3.8"
>inetd(8)</a> pour qu'il relise son fichier de configuration.
Une manière d'envoyer le signal 'HUP' consiste à utiliser
la commande suivante :
d171 4
a174 5
<blockquote>
<tt>
kill -HUP `cat /var/run/inetd.pid`
</tt>
</blockquote>
a176 23
Notez que ftp-proxy écoute sur le port 8021, le même
port qui est utilisé dans la ligne <tt>rdr</tt>. Le choix du port
8021 est arbitraire, bien que 8021 est un bon choix vu qu'il n'est
utilisé par aucune autre application.

<p>
A ce moment, seules les connexions FTP en mode passif fonctionneront.
Pour autoriser les connexions en mode actif, la connexion ftp-data
initiée par le serveur doit être permise par le pare-feu.
Malheureusement, le port sur lequel cette connexion arrive ne peut être
connu à l'avance mais uniquement l'intervalle à laquelle il appartient.
Par contre, on sait que la connexion sera initiée à partir du port 20
(port ftp-data) et que ftp-proxy acceptera cette connexion (il
transmettra par la suite les données au client).
Etant donnée que ftp-proxy s'éxecute avec les privilèges de
l'utilisateur <tt>proxy</tt>, le mot-clé <tt>user</tt> peut être
utilisé dans la règle de filtrage.
<blockquote>
<tt>
pass in on $ext_if inet proto tcp from port 20 to ($ext_if) \<br>
&nbsp;&nbsp;&nbsp;&nbsp;user proxy flags S/SA keep state
</tt>
</blockquote>
d180 1
a180 1
<b>clients FTP</b> derrière un pare-feu PF; il n'est pas
a183 1

d191 1
a191 1
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=ftpd&amp;sektion=8&amp;manpath=OpenBSD+3.8">ftpd(8)</a> 
d207 1
a207 1
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=ftpd&amp;sektion=8&amp;manpath=OpenBSD+3.8">ftpd(8)</a> 
d210 1
a210 1
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=sysctl&amp;sektion=8&amp;manpath=OpenBSD+3.8">sysctl(8)</a> 
d221 1
a221 1
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=ftpd&amp;sektion=8&amp;manpath=OpenBSD+3.8">ftpd(8)</a>, 
d274 2
a275 2
Originally [OpenBSD: ftp.html,v 1.19 ]<br>
$Translation: ftp.html,v 1.16 2005/11/02 19:38:09 aanriot Exp $<br>
d277 1
a277 1
$OpenBSD$
@


1.13
log
@sync with Steelix CVS
@
text
@d97 1
a97 1
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=ftp&amp;sektion=1&amp;manpath=OpenBSD+3.7">ftp(1)</a> 
d122 1
a122 1
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=ftp-proxy&amp;sektion=8&amp;manpath=OpenBSD+3.7">ftp-proxy(8)</a>.  
d154 1
a154 1
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=inetd&amp;sektion=8&amp;manpath=OpenBSD+3.7"
d204 1
a204 1
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=ftpd&amp;sektion=8&amp;manpath=OpenBSD+3.7">ftpd(8)</a> 
d220 1
a220 1
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=ftpd&amp;sektion=8&amp;manpath=OpenBSD+3.7">ftpd(8)</a> 
d223 1
a223 1
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=sysctl&amp;sektion=8&amp;manpath=OpenBSD+3.7">sysctl(8)</a> 
d234 1
a234 1
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=ftpd&amp;sektion=8&amp;manpath=OpenBSD+3.7">ftpd(8)</a>, 
d287 2
a288 2
Originally [OpenBSD: ftp.html,v 1.18 ]<br>
$Translation: ftp.html,v 1.15 2005/05/21 07:33:19 aanriot Exp $<br>
@


1.12
log
@Sync with Steelix CVS
@
text
@d97 1
a97 1
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=ftp&amp;sektion=1&amp;manpath=OpenBSD+3.6">ftp(1)</a> 
d122 1
a122 1
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=ftp-proxy&amp;sektion=8&amp;manpath=OpenBSD+3.6">ftp-proxy(8)</a>.  
d154 1
a154 1
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=inetd&amp;sektion=8&amp;manpath=OpenBSD+3.6"
d204 1
a204 1
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=ftpd&amp;sektion=8&amp;manpath=OpenBSD+3.6">ftpd(8)</a> 
d220 1
a220 1
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=ftpd&amp;sektion=8&amp;manpath=OpenBSD+3.6">ftpd(8)</a> 
d223 1
a223 1
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=sysctl&amp;sektion=8&amp;manpath=OpenBSD+3.6">sysctl(8)</a> 
d234 1
a234 1
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=ftpd&amp;sektion=8&amp;manpath=OpenBSD+3.6">ftpd(8)</a>, 
d287 2
a288 2
Originally [OpenBSD: ftp.html,v 1.17 ]<br>
$Translation: ftp.html,v 1.14 2005/01/17 21:34:48 aanriot Exp $<br>
@


1.11
log
@sync with Steelix CVS
@
text
@d286 1
d288 2
a289 1
$Translation: ftp.html,v 1.13 2004/12/29 10:33:02 saad Exp $<br>
@


1.10
log
@sync with Steelix CVS
@
text
@d35 3
a37 1
<img alt="[OpenBSD]" height=30 width=141 src="../../../images/smalltitle.gif">
d286 2
a287 2
Originally [OpenBSD: ftp.html,v 1.16 ]<br>
$Translation: ftp.html,v 1.11 2004/11/03 15:49:22 saad Exp $<br>
@


1.9
log
@sync with Steelix CVS
@
text
@d61 31
a91 36
FTP est un protocole qui date d'une époque où Internet
était un petit ensemble de machines avec des relations de
confiance mutuelle et où tout le monde connaissait tout le monde.
A cette époque le besoin de filtrer ou d'assurer une
sécurité stricte était inexistant. FTP
n'était pas conçu pour filtrer, pour faire transiter du
trafic à travers les pare-feux, ou pour fonctionner avec la NAT.

<p>
FTP peut fonctionner dans deux modes : passif et actif. De
manière générale, le choix du mode actif ou passif
consiste à déterminer l'extrêmité de
communication FTP qui a un problème avec le filtrage pare-feu.
Dans le meilleur des mondes, il faudrait supporter les deux modes pour
rendre vos utilisateurs heureux.

<p>
Dans le mode FTP actif, quand un utilisateur se connecte à un
serveur FTP distant et demande une information ou un fichier, le serveur
FTP effectue une connexion vers le client pour transférer les
données demandées. Cette connexion est appelée la
<i>connexion de données</i>. Pour commencer, le client FTP
choisit un port aléatoire qui lui servira pour recevoir les
données. Le client envoie le numéro de port qu'il a choisi
au serveur FTP puis se met à l'écoute des connexions
entrantes à destination de ce port. Le serveur FTP initie ensuite
une connexion vers l'adresse du client sur le port choisi et
transfère les données. Ce mode de fonctionnement est
problématique pour les utilisateurs essayant d'accéder
à des serveurs FTP lorsqu'ils sont derrière une passerelle
NAT. Vu la manière dont fonctionne la NAT, le serveur FTP initie
la connexion de données en se connectant à l'adresse
externe de la passerelle NAT sur le port choisi. La passerelle NAT n'a
pas de correspondance pour le paquet reçu dans sa table
d'état. Le paquet sera ignoré et ne sera pas
délivré au client.
d94 1
a94 2
Dans le mode FTP passif (le mode par défaut utilisé par le
client
d96 11
a106 13
d'OpenBSD), le client demande au serveur de choisir un port
aléatoire sur lequel ce dernier se mettra à
l'écoute en attente de la connexion de données. Le serveur
communique au client le port qu'il a choisi pour le transfert des
données. Malheureusement, ce n'est pas toujours possible ou
souhaitable à cause de la possibilité d'existence d'un
pare-feu devant le serveur FTP qui bloquerait les connexions de
données en entrée. Le client ftp(1) d'OpenBSD utilise le
mode passif par défaut; pour forcer le mode FTP actif, utilisez
le drapeau -A du client ftp(1). Il est aussi possible de
désactiver le mode passif (et donc d'activer par cette action le
mode actif) en utilisant la commande "<tt>passive off</tt>" à
l'invite de commandes "<tt>ftp&gt;</tt>".
d111 2
a112 3
Comme précédemment indiqué, FTP ne fonctionne pas
très bien à travers des mécanismes de NAT et des
pare-feux.
d116 4
a119 5
Packet Filter fournit une solution à ce cas en redirigeant le
trafic FTP à travers un serveur mandataire FTP (proxy). Ce
processus agit de telle façon à "guider" votre trafic FTP
à travers la passerelle NAT/pare-feu. Le mandataire FTP
utilisé par OpenBSD et PF est
d133 2
a134 2
interne est redirigé vers le serveur mandataire sur cette machine
et écoutant sur le port 8021".
d137 2
a138 3
Il est évident que le serveur mandataire doit être
démarré et exécuté sur la machine OpenBSD.
Ceci peut être effectué en insérant la ligne
d144 1
a144 1
&nbsp;&nbsp;&nbsp;ftp-proxy
d149 5
a153 3
Il faut ensuite redémarrer le système ou envoyer le signal
'HUP' à
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=inetd&amp;sektion=8&amp;manpath=OpenBSD+3.6">inetd(8)</a>.  
d170 19
d284 2
a285 2
Originally [OpenBSD: ftp.html,v 1.15 ]<br>
$Translation: ftp.html,v 1.10 2004/11/01 00:12:51 saad Exp $<br>
@


1.8
log
@Sync with Steelix CVS
@
text
@d101 1
a101 1
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=ftp&amp;sektion=1&amp;manpath=OpenBSD+3.5">ftp(1)</a> 
d130 1
a130 1
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=ftp-proxy&amp;sektion=8&amp;manpath=OpenBSD+3.5">ftp-proxy(8)</a>.  
d162 1
a162 1
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=inetd&amp;sektion=8&amp;manpath=OpenBSD+3.5">inetd(8)</a>.  
d192 1
a192 1
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=ftpd&amp;sektion=8&amp;manpath=OpenBSD+3.5">ftpd(8)</a> 
d208 1
a208 1
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=ftpd&amp;sektion=8&amp;manpath=OpenBSD+3.5">ftpd(8)</a> 
d211 1
a211 1
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=sysctl&amp;sektion=8&amp;manpath=OpenBSD+3.5">sysctl(8)</a> 
d222 1
a222 1
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=ftpd&amp;sektion=8&amp;manpath=OpenBSD+3.5">ftpd(8)</a>, 
d274 2
a275 2
Originally [OpenBSD: ftp.html,v 1.14 ]<br>
$Translation: ftp.html,v 1.9 2004/10/13 11:53:05 saad Exp $<br>
@


1.7
log
@Sync with Steelix CVS
@
text
@d4 1
a4 1
<title>PF: Gestion du Protocole FTP</title>
d43 1
a43 1
<h1><font color="#e00000">PF: Gestion du Protocole FTP</font></h1>
d275 1
a275 1
$Translation: ftp.html,v 1.8 2004/10/11 12:24:36 saad Exp $<br>
@


1.6
log
@sync with Steelix CVS. thanks to Olivier HORN <ohorn at axal dot fr> for
a fix.
@
text
@d37 1
a37 1
[<a href="perf.html">Pr&eacute;c&eacute;dent : Performances</a>]
d46 1
a46 1
<h3>Table des Mati&egrave;res</h3>
d49 2
a50 2
<li><a href="#client">Client FTP derri&egrave;re un pare-feu</a>
<li><a href="#server">Serveur FTP prot&eacute;g&eacute; par un pare-feu
d52 1
a52 1
<li><a href="#natserver">Serveur FTP prot&eacute;g&eacute; par un
d61 7
a67 7
FTP est un protocole qui date d'une &eacute;poque o&ugrave; Internet
&eacute;tait un petit ensemble de machines avec des relations de
confiance mutuelle et o&ugrave; tout le monde connaissait tout le monde.
A cette &eacute;poque le besoin de filtrer ou d'assurer une
s&eacute;curit&eacute; stricte &eacute;tait inexistant. FTP
n'&eacute;tait pas con&ccedil;u pour filtrer, pour faire transiter du
trafic &agrave; travers les pare-feux, ou pour fonctionner avec la NAT.
d71 3
a73 3
mani&egrave;re g&eacute;n&eacute;rale, le choix du mode actif ou passif
consiste &agrave; d&eacute;terminer l'extr&ecirc;mit&eacute; de
communication FTP qui a un probl&egrave;me avec le filtrage pare-feu.
d78 1
a78 1
Dans le mode FTP actif, quand un utilisateur se connecte &agrave; un
d80 7
a86 7
FTP effectue une connexion vers le client pour transf&eacute;rer les
donn&eacute;es demand&eacute;es. Cette connexion est appel&eacute;e la
<i>connexion de donn&eacute;es</i>. Pour commencer, le client FTP
choisit un port al&eacute;atoire qui lui servira pour recevoir les
donn&eacute;es. Le client envoie le num&eacute;ro de port qu'il a choisi
au serveur FTP puis se met &agrave; l'&eacute;coute des connexions
entrantes &agrave; destination de ce port. Le serveur FTP initie ensuite
d88 5
a92 5
transf&egrave;re les donn&eacute;es. Ce mode de fonctionnement est
probl&eacute;matique pour les utilisateurs essayant d'acc&eacute;der
&agrave; des serveurs FTP lorsqu'ils sont derri&egrave;re une passerelle
NAT. Vu la mani&egrave;re dont fonctionne la NAT, le serveur FTP initie
la connexion de donn&eacute;es en se connectant &agrave; l'adresse
d94 3
a96 3
pas de correspondance pour le paquet re&ccedil;u dans sa table
d'&eacute;tat. Le paquet sera ignor&eacute; et ne sera pas
d&eacute;livr&eacute; au client.
d99 1
a99 1
Dans le mode FTP passif (le mode par d&eacute;faut utilis&eacute; par le
d103 2
a104 2
al&eacute;atoire sur lequel ce dernier se mettra &agrave;
l'&eacute;coute en attente de la connexion de donn&eacute;es. Le serveur
d106 2
a107 2
donn&eacute;es. Malheureusement, ce n'est pas toujours possible ou
souhaitable &agrave; cause de la possibilit&eacute; d'existence d'un
d109 2
a110 2
donn&eacute;es en entr&eacute;e. Le client ftp(1) d'OpenBSD utilise le
mode passif par d&eacute;faut; pour forcer le mode FTP actif, utilisez
d112 2
a113 2
d&eacute;sactiver le mode passif (et donc d'activer par cette action le
mode actif) en utilisant la commande "<tt>passive off</tt>" &agrave;
d118 3
a120 3
<h2>Client FTP derri&egrave;re un pare-feu</h2>
Comme pr&eacute;c&eacute;demment indiqu&eacute;, FTP ne fonctionne pas
tr&egrave;s bien &agrave; travers des m&eacute;canismes de NAT et des
d125 5
a129 5
Packet Filter fournit une solution &agrave; ce cas en redirigeant le
trafic FTP &agrave; travers un serveur mandataire FTP (proxy). Ce
processus agit de telle fa&ccedil;on &agrave; "guider" votre trafic FTP
&agrave; travers la passerelle NAT/pare-feu. Le mandataire FTP
utilis&eacute; par OpenBSD et PF est
d132 1
a132 1
la &agrave; la section NAT de <tt>pf.conf</tt> :
d143 2
a144 2
interne est redirig&eacute; vers le serveur mandataire sur cette machine
et &eacute;coutant sur le port 8021".
d147 3
a149 3
Il est &eacute;vident que le serveur mandataire doit &ecirc;tre
d&eacute;marr&eacute; et ex&eacute;cut&eacute; sur la machine OpenBSD.
Ceci peut &ecirc;tre effectu&eacute; en ins&eacute;rant la ligne
d160 2
a161 2
Il faut ensuite red&eacute;marrer le syst&egrave;me ou envoyer le signal
'HUP' &agrave;
d163 1
a163 1
Une mani&egrave;re d'envoyer le signal 'HUP' consiste &agrave; utiliser
d173 2
a174 2
Notez que ftp-proxy &eacute;coute sur le port 8021, le m&ecirc;me
port qui est utilis&eacute; dans la ligne <tt>rdr</tt>. Le choix du port
d176 1
a176 1
utilis&eacute; par aucune autre application.
d179 4
a182 4
Veuillez noter que ftp-proxy(8) est utilis&eacute; pour aider les
<b>clients FTP</b> derri&egrave;re un pare-feu PF; il n'est pas
utilis&eacute; pour prendre en charge un <b>serveur FTP</b>
derri&egrave;re un tel pare-feu.
d186 3
a188 3
<h2>Serveur FTP prot&eacute;g&eacute; par un pare-feu PF local</h2>
Dans ce cas, PF est activ&eacute; sur le serveur FTP lui-m&ecirc;me
plut&ocirc;t que sur un pare-feu d&eacute;di&eacute;. Pour les besoins
d190 2
a191 2
mani&egrave;re al&eacute;atoire pour les donn&eacute;es entrantes. Par
d&eacute;faut, le serveur FTP natif d'OpenBSD
d193 3
a195 3
utilise la plage 49152 &agrave; 65535. Ces ports doivent &ecirc;tre
autoris&eacute;s en entr&eacute;e ainsi que le port 21 (le port de
contr&ocirc;le FTP) :
d207 1
a207 1
consid&eacute;rablement. Dans le cas du programme
d209 1
a209 1
d'OpenBSD, ceci peut &ecirc;tre effectu&eacute; en utilisant les
d216 1
a216 1
<h2>Serveur FTP prot&eacute;g&eacute; par un pare-feu PF externe avec
d223 1
a223 1
utilisant la plage de ports par d&eacute;faut.
d226 2
a227 2
Voici un exemple de r&egrave;gles qui pourraient &ecirc;tre
utilis&eacute;es dans ce cas de figure :
d255 1
a255 1
fonctionnement de FTP de mani&egrave;re g&eacute;n&eacute;rale dans le
d263 1
a263 1
[<a href="perf.html">Pr&eacute;c&eacute;dent : Performances</a>]
d275 1
a275 1
$Translation: ftp.html,v 1.7 2004/05/12 20:21:45 saad Exp $<br>
@


1.5
log
@Sync with Steelix CVS
@
text
@d14 17
d274 2
a275 2
Originally [OpenBSD: ftp.html,v 1.13 ]<br>
$Translation: ftp.html,v 1.6 2004/05/06 05:08:48 saad Exp $<br>
@


1.4
log
@Sync with Steelix CVS
@
text
@d84 1
a84 1
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=ftp&amp;sektion=1&amp;manpath=OpenBSD+3.4">ftp(1)</a> 
d113 1
a113 1
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=ftp-proxy&amp;sektion=8&amp;manpath=OpenBSD+3.4">ftp-proxy(8)</a>.  
d145 1
a145 1
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=inetd&amp;sektion=8&amp;manpath=OpenBSD+3.4">inetd(8)</a>.  
d156 1
a156 1
Notez que ftp-proxy &eacute;coute sur le serveur 8031, le m&ecirc;me
d175 1
a175 1
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=ftpd&amp;sektion=8&amp;manpath=OpenBSD+3.4">ftpd(8)</a> 
d191 1
a191 1
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=ftpd&amp;sektion=8&amp;manpath=OpenBSD+3.4">ftpd(8)</a> 
d194 1
a194 1
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=sysctl&amp;sektion=8&amp;manpath=OpenBSD+3.4">sysctl(8)</a> 
d205 1
a205 1
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=ftpd&amp;sektion=8&amp;manpath=OpenBSD+3.4">ftpd(8)</a>, 
d257 2
a258 2
Originally [OpenBSD: ftp.html,v 1.12 ]<br>
$Translation: ftp.html,v 1.4 2004/02/19 20:31:29 saad Exp $<br>
@


1.3
log
@Sync with Steelix CVS
@
text
@d4 1
a4 1
<title>PF: Probl&egrave;mes avec FTP</title>
d20 1
a20 1
[<a href="perf.html">Pr&eacute;c&eacute;dent : Performance</a>]
d26 1
a26 1
<h1><font color="#e00000">PF: Probl&egrave;mes avec FTP</font></h1>
d246 1
a246 1
[<a href="perf.html">Pr&eacute;c&eacute;dent : Performance</a>]
d258 1
a258 1
$Translation: ftp.html,v 1.3 2004/01/08 19:53:51 saad Exp $<br>
@


1.2
log
@Sync with Steelix CVS
@
text
@d220 1
d224 6
d257 2
a258 2
Originally [OpenBSD: ftp.html,v 1.11 ]<br>
$Translation: ftp.html,v 1.2 2004/01/02 21:49:07 saad Exp $<br>
@


1.1
log
@Sync with Steelix CVS
@
text
@d11 1
a11 1
<meta name="copyright"     content="This document copyright 2002-2003 by OpenBSD.">
d250 2
a251 2
Originally [OpenBSD: ftp.html,v 1.10 ]<br>
$Translation: ftp.html,v 1.1 2003/12/28 21:20:14 saad Exp $<br>
@

