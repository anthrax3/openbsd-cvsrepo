head	1.26;
access;
symbols;
locks; strict;
comment	@# @;


1.26
date	2014.04.01.17.14.10;	author nick;	state dead;
branches;
next	1.25;

1.25
date	2013.07.23.06.21.49;	author ajacoutot;	state Exp;
branches;
next	1.24;

1.24
date	2011.05.26.16.59.30;	author ajacoutot;	state Exp;
branches;
next	1.23;

1.23
date	2010.05.24.18.32.44;	author ajacoutot;	state Exp;
branches;
next	1.22;

1.22
date	2009.06.29.17.19.48;	author ajacoutot;	state Exp;
branches;
next	1.21;

1.21
date	2007.05.09.05.49.53;	author jufi;	state Exp;
branches;
next	1.20;

1.20
date	2007.02.11.08.22.01;	author saad;	state Exp;
branches;
next	1.19;

1.19
date	2006.11.02.18.23.22;	author jufi;	state Exp;
branches;
next	1.18;

1.18
date	2006.05.02.17.09.33;	author jufi;	state Exp;
branches;
next	1.17;

1.17
date	2006.03.10.16.35.07;	author saad;	state Exp;
branches;
next	1.16;

1.16
date	2005.11.03.11.30.53;	author saad;	state Exp;
branches;
next	1.15;

1.15
date	2005.06.13.13.11.43;	author saad;	state Exp;
branches;
next	1.14;

1.14
date	2005.05.22.17.38.07;	author saad;	state Exp;
branches;
next	1.13;

1.13
date	2005.01.18.09.54.52;	author jufi;	state Exp;
branches;
next	1.12;

1.12
date	2004.12.29.10.38.26;	author saad;	state Exp;
branches;
next	1.11;

1.11
date	2004.12.06.06.47.12;	author saad;	state Exp;
branches;
next	1.10;

1.10
date	2004.11.26.20.14.55;	author jufi;	state Exp;
branches;
next	1.9;

1.9
date	2004.11.01.02.56.30;	author saad;	state Exp;
branches;
next	1.8;

1.8
date	2004.10.11.16.17.48;	author jufi;	state Exp;
branches;
next	1.7;

1.7
date	2004.05.31.21.12.02;	author saad;	state Exp;
branches;
next	1.6;

1.6
date	2004.05.12.20.51.36;	author saad;	state Exp;
branches;
next	1.5;

1.5
date	2004.05.06.21.34.05;	author saad;	state Exp;
branches;
next	1.4;

1.4
date	2004.03.26.08.40.52;	author jufi;	state Exp;
branches;
next	1.3;

1.3
date	2004.03.14.21.41.11;	author jufi;	state Exp;
branches;
next	1.2;

1.2
date	2004.03.01.09.26.20;	author jufi;	state Exp;
branches;
next	1.1;

1.1
date	2004.02.15.17.58.09;	author jufi;	state Exp;
branches;
next	;


desc
@@


1.26
log
@
Abandon translations, per deraadt@@ and ajacoutot@@.
@
text
@<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<html>
<head>
<title>PF : Redirection de Trafic ("Forwarding"
            de Ports)</title>
<link rev="made" href="mailto:www@@openbsd.org">
<meta http-equiv="Content-Type" content="text/html; charset=ISO-8859-1">
<meta name="resource-type" content="document">
<meta name="description"   content="the OpenBSD FAQ page">
<meta name="keywords"      content="openbsd,faq,pf">
<meta name="distribution"  content="global">
</head>

<!--
Copyright (c) 2003, Nick Holland <nick@@openbsd.org>
Copyright (c) 2003-2005, Joel Knight <enabled@@myrealbox.com>

Permission to use, copy, modify, and distribute this documentation for
any purpose with or without fee is hereby granted, provided that the
above copyright notice and this permission notice appear in all copies.

THE DOCUMENTATION IS PROVIDED "AS IS" AND THE AUTHOR DISCLAIMS ALL
WARRANTIES WITH REGARD TO THIS DOCUMENTATION INCLUDING ALL IMPLIED
WARRANTIES OF MERCHANTABILITY AND FITNESS. IN NO EVENT SHALL THE
AUTHOR BE LIABLE FOR ANY SPECIAL, DIRECT, INDIRECT, OR CONSEQUENTIAL
DAMAGES OR ANY DAMAGES WHATSOEVER RESULTING FROM LOSS OF USE, DATA OR
PROFITS, WHETHER IN AN ACTION OF CONTRACT, NEGLIGENCE OR OTHER
TORTIOUS ACTION, ARISING OUT OF OR IN CONNECTION WITH THE USE OR
PERFORMANCE OF THIS DOCUMENTATION
-->

<body bgcolor="#ffffff" text="#000000">
<!-- Passes validator.w3.org, please keep it this way;
please, use a max of 72 chars per line -->

<a href="../../../fr/index.html">
<img alt="[OpenBSD]" height="30" width="141" src="../../../images/smalltitle.gif" border="0">
</a>
<p>
[<a href="nat.html">Précédent : Traduction d'Adresses
Réseau</a>]
[<a href="index.html">Index</a>]
[<a href="shortcuts.html">Suivant : Raccourcis pour la Création
de Jeux de Règles</a>]

<h1><font color="#e00000">PF : Redirection de Trafic ("Forwarding" de
    Ports)</font></h1>

<hr>

<h3>Table des Matières</h3>
<ul>
<li><a href="#intro">Introduction</a>
<li><a href="#filter">Redirection et Filtrage de Paquets</a>
<li><a href="#security">Implications au niveau de la
    Sécurité</a>
<li><a href="#reflect">Redirection et Réflexion</a>
        <ul>
        <li><a href="#splitdns">DNS en "Split-Horizon"</a>
        <li><a href="#sepnet">Déplacer le Serveur Vers un
            Réseau Local Séparé</a>
        <li><a href="#tcpproxy">Mandater les Connexions TCP ("TCP
            Proxying")</a>
        <li><a href="#rdrnat">Combinaison RDR-TO et NAT-TO</a>
        </ul>
</ul>

<hr>

<a name="intro"></a>
<a name="filter"></a>
<h2>Introduction</h2>
Quand vous utilisez la NAT, les machines sur votre réseau peuvent
accéder à la totalité des ressources Internet. Qu'en est-il lorsqu'une
de vos machines derrière la passerelle NAT a besoin d'être accédée
depuis Internet ? La redirection est utilisée pour résoudre ce genre de
problèmes. Elle permet au trafic entrant d'être acheminé vers une
machine derrière la passerelle NAT.

<p>
Prenons un exemple :
<blockquote>
<tt>
pass in on tl0 proto tcp from any to any port 80 rdr-to 192.168.1.20
</tt>
</blockquote>

<p>
La ligne ci-dessus redirige le trafic à destination du port TCP 80
(serveur web) vers une machine sur le réseau d'adresse IP 192.168.1.20.
Ainsi, même si cette machine est derrière votre passerelle, le monde
externe peut y avoir accès.

<p>
La partie <tt>from any to any</tt> de la ligne <tt>rdr</tt> précitée
peut être assez utile. Si vous voulez restreindre les adresses ou les
sous-réseaux autorisés à avoir accès au serveur web sur le port 80, vous
pouvez le faire de la façon suivante :
<blockquote>
<tt>
pass in on tl0 proto tcp from 27.146.49.0/24 to any port 80 \<br>
&nbsp;&nbsp;&nbsp;rdr-to 192.168.1.20
</tt>
</blockquote>

<p>
Ceci aura pour effet de rediriger uniquement le trafic en provenance du
sous-réseau spécifié. Notez que cela implique la possibilité de
rediriger différentes machines en entrée vers des machines derrière la
passerelle. Une telle fonctionnalité est utile. Par exemple, vous pouvez
autoriser des utilisateurs sur des sites distants à accèder à leur
propre machine dans la mesure où vous connaissez leur adresse IP :
<blockquote>
<tt>
pass in on tl0 proto tcp from 27.146.49.14 to any port 80 \<br>
&nbsp;&nbsp;&nbsp;rdr-to 192.168.1.20<br>
pass in on tl0 proto tcp from 16.114.4.89 to any port 80 \<br>
&nbsp;&nbsp;&nbsp;rdr-to 192.168.1.22<br>
pass in on tl0 proto tcp from 24.2.74.178 to any port 80 \<br>
&nbsp;&nbsp;&nbsp;rdr-to 192.168.1.23
</tt>
</blockquote>

<p>
Une plage de ports peut aussi être redirigée par une même règle :
<blockquote>
<tt>
pass in on tl0 proto tcp from any to any port 5000:5500 \<br>
&nbsp;&nbsp;&nbsp;rdr-to 192.168.1.20<br>
pass in on tl0 proto tcp from any to any port 5000:5500 \<br>
&nbsp;&nbsp;&nbsp;rdr-to 192.168.1.20 port 6000<br>
pass in on tl0 proto tcp from any to any port 5000:5500 \<br>
&nbsp;&nbsp;&nbsp;rdr-to 192.168.1.20 port 7000:*<br>
</tt>
</blockquote>

<p>
Les exemples précédents permettent de rediriger tout port entre 5000 et
5500 inclus vers 192.168.1.20.
Dans la première règle, on a une correspondance de ports 1 à 1. Ainsi le
port 5000 est redirigé vers le port 5000 de la machine destination, le
port 5001 est redirigé vers le port 5001 et ainsi de suite.
Dans la deuxième règle, la plage de ports toute entière est redirigée
vers le port 6000.
Enfin, dans la troisième règle, le port 5000 est redirigé vers le port
7000, 5001 vers 7001 et ainsi de suite.

<a name="security"></a>
<h2>Implications au niveau de la Sécurité</h2>
La redirection a des implications au niveau de la sécurité. La création
d'une ouverture pour autoriser le trafic à destination du réseau interne
protégé peut causer la compromission d'une machine sur ce dernier. Par
exemple, si le trafic est redirigé vers un serveur web interne et que
par malheur, une vulnérabilité est découverte dans le service web ou
dans un script CGI executé par le serveur, alors la machine peut être
compromise par un utilisateur distant. Une fois cette compromission
réalisée, l'utilisateur malveillant peut rebondir à partir de cette
machine vers le réseau interne ce qui, bien entendu, ne peut être bloqué
par le pare-feu étant donné qu'il ne voit pas ce trafic.

<p>
Ces risques peuvent être minimisés en confinant de manière stricte le
système accédé depuis l'extérieur à un réseau séparé. Ce réseau est
souvent appelé zone démilitarisée (DMZ) ou réseau de service privé
(Private Service Network, PSN). De cette façon, si le serveur web est
compromis, les effets peuvent être limités au réseau DMZ/PSN en filtrant
soigneusement le trafic autorisé entre DMZ/PSN et vos autres réseaux.

<a name="reflect"></a>
<h2>Redirection et Réflexion</h2>
Souvent, les règles de redirection sont utilisées pour faire suivre des
connexions Internet entrantes à un serveur local disposant d'une adresse
privée sur le réseau interne comme le montre l'exemple suivant :
<blockquote>
<tt>
server = 192.168.1.40<br>
<br>
pass in on $ext_if proto tcp from any to $ext_if port 80 \<br>
&nbsp;&nbsp;&nbsp;rdr-to $server port 80
</tt>
</blockquote>

<p>
Mais lorsque la règle de redirection est testée par un client du LAN,
elle ne fonctionne pas. C'est normal car les règles de redirection ne
s'appliquent qu'aux paquets qui passent à travers l'interface spécifiée
dans chacune d'elles (dans l'exemple précité, c'est l'interface externe
<tt>$ext_if</tt>). Cependant, une connexion émanant d'un client interne
et à destination de l'adresse externe du pare-feu n'implique pas que les
paquets vont passer à travers l'interface externe du pare-feu. La pile
TCP/IP sur le pare- feu compare l'adresse de destination des paquets
entrants avec ses propres adresses et aliases et détecte les connexions
qui lui sont destinées lorsque les paquets constituant celles-ci passent
son interface interne. De tels paquets ne passent pas physiquement à
travers l'interface externe, et de toute façon la pile ne simule pas ce
passage. Ainsi, PF ne voit jamais ces paquets sur l'interface externe.
Du coup, la règle de redirection sur l'interface externe n'est jamais
appliquée.

<p>
Que doit-on faire alors ? ajouter une seconde règle de redirection sur
l'interface interne ? non, ça ne fonctionnera pas mieux. Lorsque le
client local se connecte à l'interface externe du pare-feu, le paquet
initial de l'échange TCP atteint le pare-feu via son interface interne.
La nouvelle règle de redirection s'applique et l'adresse de destination
est remplacée par celle du serveur interne. Le paquet et alors redirigé
par l'interface interne du pare-feu vers le serveur interne. Mais
l'adresse source n'a pas été modifiée. Elle contient l'adresse du client
local. Le serveur envoie alors directement les réponses au client. Le
pare-feu ne voit jamais le retour et n'a aucune chance de traduire
correctement les paquets de retour. Le client reçoit une réponse à
partir d'une source inattendue. Il met alors fin à cette connexion.

<p>
Cependant, il est souvent souhaitable que les clients sur le LAN se
connectent au même serveur interne que les clients externes et de
manière aussi transparente. Il existe plusieurs solutions à ce problème
:

<a name="splitdns"></a>
<h3>DNS en "Split-Horizon"</h3>

<p>
Il est possible de configurer les serveurs DNS pour fournir une réponse
différente selon la provenance de la requête : clients internes ou
externes. Ainsi les clients internes recevront l'adresse interne du
serveur en réponse à leur demande de résolution de nom. Ils pourront
alors se connecter directement au serveur local sans impliquer le pare-feu. 
Ce dernier sera alors moins sollicité.

<a name="sepnet"></a>
<h3>Déplacer le Serveur Vers un Réseau Local Séparé</h3>

<p>
Une autre solution consiste à ajouter une carte réseau au pare-feu et à
déplacer le serveur local vers un réseau dédié de type DMZ. Les
connexions des clients locaux seront alors redirigées de la même manière
que les connexions en provenance d'Internet. L'utilisation de réseaux
séparés a plusieurs avantages. Entre autres, une amélioration du niveau
de sécurité en isolant le serveur des machines internes. Si le serveur
(qui, nous le rappelons, est joignable à partir d'Internet) est
compromis, il ne peut se connecter à des machines internes directement
vu que toutes ces connexions doivent passer à travers le pare-feu.

<a name="tcpproxy"></a>
<h3>Mandater les Connexions TCP ("TCP Proxying")</h3>

<p>
Un mandataire TCP générique peut être mis en place sur le pare-feu. Ce
mandataire devra écouter sur le port de redirection ou accepter les
connexions sur l'interface interne et redirigées sur le port sur lequel
il écoute. Lorsqu'un client se connecte sur le pare-feu, le mandataire
accepte la connexion, établit une seconde connexion au serveur interne,
et véhicule les données entre les deux connexions.

<p>
Des mandataires simples peuvent être crées avec 
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=inetd&amp;sektion=8"
>inetd(8)</a> et
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=nc&amp;sektion=1"
>nc(1)</a>.
L'entrée suivante dans le fichier <tt>/etc/inetd.conf</tt> crée une
socket d'écoute rattachée à l'adresse de loopback (127.0.0.1) et le port
5000. Les connexions sont redirigées sur le port 80 du serveur
192.168.1.10.
La redirection est faite avec l'utilisateur "proxy".
<blockquote>
<tt>
127.0.0.1:5000 stream tcp nowait proxy /usr/bin/nc nc -w \<br>
&nbsp;&nbsp;&nbsp;20 192.168.1.10 80
</tt>
</blockquote>

<p>
La règle de redirection suivante redirige le port 80 sur l'interface
interne du mandataire :
<blockquote>
<tt>
pass in on $int_if proto tcp from $int_net to $ext_if port 80 \<br>
&nbsp;&nbsp;&nbsp;rdr-to 127.0.0.1 port 5000
</tt>
</blockquote>

Des mandataires hautes-performances peuvent aussi être crées avec
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=relayd&amp;sektion=8"
>relayd(8)</a>.

<a name="rdrnat"></a>
<h3>Combinaison RDR-TO et NAT-TO</h3>

<p>
A l'aide d'une règle NAT supplémentaire sur l'interface interne, la
traduction manquante d'adresse source décrite plus haut peut être
réalisée.
<blockquote>
<tt>
pass in on $int_if proto tcp from $int_net to $ext_if port 80 \<br>
&nbsp;&nbsp;&nbsp;rdr-to $server<br>
pass out on $int_if proto tcp to $server port 80 \<br>
&nbsp;&nbsp;&nbsp;received-on $int_if nat-to $int_if
</tt>
</blockquote>

<p>
Ceci aura pour effet d'effectuer une autre traduction d'adresse du
paquet initial envoyé par le client lorsque celui-ci est redirigé à
travers l'interface interne. Cette seconde opération de traduction
remplacera l'adresse source du client par l'adresse interne du pare-feu.
Le serveur interne répondra alors à l'adresse interne du pare-feu, qui
effectuera les opérations de NAT et de RDR inverses avant de faire
suivre le paquet au client. Cette méthode est relativement complexe.
Elle crée deux états séparés pour chaque connexion redirigée. Il faut
prendre des précautions pour éviter que la règle de NAT ne s'applique au
reste du trafic tel que les connexions en provenance de hôtes externes
(via d'autres redirections) ou en provenance du pare-feu lui-même. La
règle <tt>rdr-to</tt> précitée soumettra à la pile TCP/IP des paquets en
provenance du réseau interne et à destination de ce dernier.

<p>

<p>
[<a href="nat.html">Précédent : Traduction d'Adresses
Réseau</a>]
[<a href="index.html">Index</a>]
[<a href="shortcuts.html">Suivant : Raccourcis pour la Création
de Jeux de Règles</a>]

<p>
<hr>
<a href="index.html"><img height="24" width="24" src="../../../images/back.gif" border="0" alt="[back]"></a> 
<a href="mailto:www@@openbsd.org">www@@openbsd.org</a>
<br>
<small>
<!--
Originally [OpenBSD: rdr.html,v 1.31 ]<br>
$Translation: rdr.html,v 1.28 2013/07/23 03:19:57 rustybsd Exp $<br>
-->
$OpenBSD: rdr.html,v 1.25 2013/07/23 06:21:49 ajacoutot Exp $
</small>

</body>
</html> 
@


1.25
log
@Sync with Steelix CVS
@
text
@d338 1
a338 1
$OpenBSD$
@


1.24
log
@Sync with Steelix CVS
@
text
@d76 1
a76 1
depuis Internet ? la redirection est utilisée pour résoudre ce genre de
d336 1
a336 1
$Translation: rdr.html,v 1.27 2011/05/13 06:42:39 benoit Exp $<br>
@


1.23
log
@Sync with Steelix CVS
@
text
@a319 2
Nous recommandons cependant de privilégier plutôt les autres solutions
précédemment mentionnées.
d335 2
a336 2
Originally [OpenBSD: rdr.html,v 1.30 ]<br>
$Translation: rdr.html,v 1.26 2010/05/24 15:24:53 benoit Exp $<br>
@


1.22
log
@Sync with Steelix CVS
@
text
@d64 1
a64 1
        <li><a href="#rdrnat">Combinaison RDR et NAT</a>
d71 1
d84 1
a84 1
rdr on tl0 proto tcp from any to any port 80 -&gt; 192.168.1.20
d101 2
a102 2
rdr on tl0 proto tcp from 27.146.49.0/24 to any port 80 -&gt; \<br>
&nbsp;&nbsp;&nbsp;192.168.1.20
d115 6
a120 6
rdr on tl0 proto tcp from 27.146.49.14 to any port 80 -&gt; \<br>
&nbsp;&nbsp;&nbsp;192.168.1.20<br>
rdr on tl0 proto tcp from 16.114.4.89 to any port 80 -&gt; \<br>
&nbsp;&nbsp;&nbsp;192.168.1.22<br>
rdr on tl0 proto tcp from 24.2.74.178 to any port 80 -&gt; \<br>
&nbsp;&nbsp;&nbsp;192.168.1.23
d128 6
a133 6
rdr on tl0 proto tcp from any to any port 5000:5500 -&gt; \<br>
&nbsp;&nbsp;&nbsp;192.168.1.20<br>
rdr on tl0 proto tcp from any to any port 5000:5500 -&gt; \<br>
&nbsp;&nbsp;&nbsp;192.168.1.20 port 6000<br>
rdr on tl0 proto tcp from any to any port 5000:5500 -&gt; \<br>
&nbsp;&nbsp;&nbsp;192.168.1.20 port 7000:*<br>
a147 68
<a name="filter"></a>
<h2>Redirection et Filtrage de Paquets</h2>
<font color="#ff0000">REMARQUE :</font> Les paquets redirigés doivent
encore être autorisés par le moteur de filtrage. Ils seront bloqués ou
autorisés selon les règles de filtrage qui ont été définies.

<p>
La <i>seule</i> exception à cette règle est lorsque le mot-clé
<tt>pass</tt> est utilisé dans la règle <tt>rdr</tt>. Dans ce cas, les
paquets redirigés passeront à travers le moteur de filtrage et l'état de
connexion sera préservé : Les règles de filtrage ne seront pas
considérées pour ces paquets.
Ceci est un raccourci utile pour éviter de rajouter des règles de
filtrage <tt>pass</tt> pour chaque règle de redirection.
Il faut voir cela comme une règle <tt>rdr</tt> normale (sans mot-clé
<tt>pass</tt>) associée à une règle de filtrage <tt>pass</tt> avec le
mot-clé <tt>keep state</tt>. Cependant, si vous voulez mettre en oeuvre
des options de filtrage spécifiques telles que <tt>synproxy</tt>,
<tt>modulate state</tt>, etc... vous devrez utiliser une règle de filtrage
<tt>pass</tt> dédiée étant donné que ces options ne sont pas
implémentées au niveau des règles de redirection.

<p>
Notez aussi que la traduction est effectuée <i>avant</i> le filtrage. Le
moteur de filtrage verra le paquet <i>traduit</i>, c'est à dire après que son
adresse IP destination et/ou port de destination soient modifiés pour
correspondre à l'adresse/au port de redirection spécifié(e) dans la
règle <tt>rdr</tt>. Considérons le cas suivant :
<ul>
<li>192.0.2.1 - hôte sur Internet
<li>24.65.1.13 - adresse IP externe du routeur OpenBSD
<li>192.168.1.5 - adresse IP interne du serveur web
</ul>

<p>
Règle de redirection :
<blockquote>
<tt>
rdr on tl0 proto tcp from 192.0.2.1 to 24.65.1.13 port 80 \<br>
&nbsp;&nbsp;&nbsp;-&gt; 192.168.1.5 port 8000
</tt>
</blockquote>

<p>
Avant que la règle de redirection <tt>rdr</tt> ne soit utilisée, le paquet est
traité :

<ul>
<li>Adresse source : 192.0.2.1
<li>Port source : 4028 (choisi de manière arbitraire par le système
    d'exploitation)
<li>Adresse de destination : 24.65.1.13
<li>Port de destination : 80
</ul>

<p>
Puis la règle de redirection <tt>rdr</tt> est évaluée :
<ul>
<li>Adresse source : 192.0.2.1
<li>Port source : 4028
<li>Adresse de destination : 192.168.1.5
<li>Port de destination : 8000
</ul>

<p>
Le moteur de filtrage verra le paquet IP tel qu'il apparaît après la
traduction effectuée par le mécanisme de redirection.

d178 2
a179 2
rdr on $ext_if proto tcp from any to $ext_if port 80 -&gt; $server \<br>
&nbsp;&nbsp;&nbsp;port 80
d279 2
a280 2
rdr on $int_if proto tcp from $int_net to $ext_if port 80 -&gt; \<br>
&nbsp;&nbsp;&nbsp;127.0.0.1 port 5000
d284 4
d289 1
a289 1
<h3>Combinaison RDR et NAT</h3>
d297 4
a300 6
rdr on $int_if proto tcp from $int_net to $ext_if port 80 -&gt; \<br>
&nbsp;&nbsp;&nbsp;$server
<br>
no nat on $int_if proto tcp from $int_if to $int_net<br>
nat on $int_if proto tcp from $int_net to $server port 80 -&gt; \<br>
&nbsp;&nbsp;&nbsp;$int_if
d316 1
a316 1
règle <tt>rdr</tt> précitée soumettra à la pile TCP/IP des paquets en
d337 2
a338 2
Originally [OpenBSD: rdr.html,v 1.28 ]<br>
$Translation: rdr.html,v 1.25 2009/06/22 12:16:54 benoit Exp $<br>
@


1.21
log
@Sync with steelix translation CVS
@
text
@d333 1
d336 1
a336 1
127.0.0.1:5000 stream tcp nowait nobody /usr/bin/nc nc -w \<br>
d402 2
a403 2
Originally [OpenBSD: rdr.html,v 1.27 ]<br>
$Translation: rdr.html,v 1.24 2007/05/07 09:45:08 ajacoutot Exp $<br>
@


1.20
log
@sync with Steelix CVS
@
text
@d325 1
a325 1
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=inetd&amp;sektion=8&amp;manpath=OpenBSD+4.0"
d327 1
a327 1
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=nc&amp;sektion=1&amp;manpath=OpenBSD+4.0"
d401 2
a402 2
Originally [OpenBSD: rdr.html,v 1.26 ]<br>
$Translation: rdr.html,v 1.22 2007/02/10 16:41:45 benoit Exp $<br>
@


1.19
log
@sync with steelix translation CVS
@
text
@d159 1
a159 1
Ceci est un racourci utile pour éviter de rajouter des règles de
d165 1
a165 1
<tt>modulate state</tt>, etc. vous devrez utilisez une règle de filtrage
d171 1
a171 1
moteur de filtrage verra le paquet <i>traduit</i>, ç.à.d. après que son
d226 1
a226 1
par le pare-feu étant donné qu'il ne voit pas ce traffic.
d295 2
a296 2
alors se connecter directement au serveur local sans impliquer le pare-
feu. Ce dernier sera alors moins sollicité.
d402 1
a402 1
$Translation: rdr.html,v 1.21 2006/11/02 08:49:04 ajacoutot Exp $<br>
@


1.18
log
@sync with steelix translation CVS
@
text
@d325 1
a325 1
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=inetd&amp;sektion=8&amp;manpath=OpenBSD+3.9"
d327 1
a327 1
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=nc&amp;sektion=1&amp;manpath=OpenBSD+3.9"
d401 2
a402 2
Originally [OpenBSD: rdr.html,v 1.25 ]<br>
$Translation: rdr.html,v 1.20 2006/05/02 10:12:39 ajacoutot Exp $<br>
@


1.17
log
@sync with Steelix CVS
@
text
@d325 1
a325 1
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=inetd&amp;sektion=8&amp;manpath=OpenBSD+3.8"
d327 1
a327 1
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=nc&amp;sektion=1&amp;manpath=OpenBSD+3.8"
d401 2
a402 2
Originally [OpenBSD: rdr.html,v 1.24 ]<br>
$Translation: rdr.html,v 1.19 2006/03/09 14:46:29 ajacoutot Exp $<br>
@


1.16
log
@sync with Steelix CVS
@
text
@d36 1
a36 1
<a href="../../fr/index.html">
d191 2
a192 2
Avant que la règle de redirection ne soit utilisée, le paquet est traité
:
d203 1
a203 1
Puis la règle de redirection est évaluée :
d402 1
a402 1
$Translation: rdr.html,v 1.18 2005/11/02 19:38:09 aanriot Exp $<br>
@


1.15
log
@sync with Steelix CVS
@
text
@d325 1
a325 1
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=inetd&amp;sektion=8&amp;manpath=OpenBSD+3.7"
d327 1
a327 1
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=nc&amp;sektion=1&amp;manpath=OpenBSD+3.7"
d401 2
a402 2
Originally [OpenBSD: rdr.html,v 1.23 ]<br>
$Translation: rdr.html,v 1.17 2005/06/13 12:57:12 saad Exp $<br>
@


1.14
log
@sync with Steelix CVS
@
text
@d15 2
a16 1
Copyright (c) 2003, 2004, Nick Holland <nick@@openbsd.org>
d123 24
d401 2
a402 2
Originally [OpenBSD: rdr.html,v 1.22 ]<br>
$Translation: rdr.html,v 1.16 2005/05/21 10:02:27 aanriot Exp $<br>
@


1.13
log
@Sync with Steelix CVS
@
text
@d300 1
a300 1
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=inetd&amp;sektion=8&amp;manpath=OpenBSD+3.6"
d302 1
a302 1
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=nc&amp;sektion=1&amp;manpath=OpenBSD+3.6"
d376 2
a377 2
Originally [OpenBSD: rdr.html,v 1.21 ]<br>
$Translation: rdr.html,v 1.15 2005/01/17 21:34:49 aanriot Exp $<br>
@


1.12
log
@sync with Steelix CVS
@
text
@d375 1
d377 2
a378 1
$Translation: rdr.html,v 1.14 2004/12/29 10:33:02 saad Exp $<br>
@


1.11
log
@sync with Steelix CVS
@
text
@d35 3
a37 1
<img alt="[OpenBSD]" height=30 width=141 src="../../../images/smalltitle.gif">
d375 2
a376 2
Originally [OpenBSD: rdr.html,v 1.20 ]<br>
$Translation: rdr.html,v 1.12 2004/12/06 06:44:39 saad Exp $<br>
@


1.10
log
@Sync with Steelix CVS
@
text
@d124 17
a140 5
autorisés selon les règles de filtrage qui ont été définies. La
<i>seule</i> exception à cette règle est lorsque le mot-clé
<tt>pass</tt> est utilisé dans la règle <tt>rdr</tt>; dans ce cas, les
paquets redirigés seront automatiquement autorisés par le moteur de
filtrage.
d373 2
a374 2
Originally [OpenBSD: rdr.html,v 1.17 ]<br>
$Translation: rdr.html,v 1.11 2004/11/25 22:19:35 saad Exp $<br>
@


1.9
log
@sync with Steelix CVS
@
text
@d70 5
a74 6
accéder à la totalité des ressources Internet.
Qu'en est-il lorsqu'une de vos machines derrière la passerelle
NAT a besoin d'être accédée depuis Internet ? la
redirection est utilisée pour résoudre ce genre de
problèmes. Elle permet au trafic entrant d'être
acheminé vers une machine derrière la passerelle NAT.
d85 4
a88 4
La ligne ci-dessus redirige le trafic à destination du port TCP
80 (serveur web) vers une machine sur le réseau d'adresse IP
192.168.1.20. Ainsi, même si cette machine est derrière
votre passerelle, le monde externe peut y avoir accès.
d91 4
a94 5
La partie <tt>from any to any</tt> de la ligne <tt>rdr</tt>
précitée peut être assez utile. Si vous voulez
restreindre les adresses ou les sous-réseaux autorisés
à avoir accès au serveur web sur le port 80, vous pouvez
le faire de la façon suivante :
d104 5
a108 7
sous-réseau spécifié. Notez que cela implique la
possibilité de rediriger différentes machines en
entrée vers des machines derrière la passerelle. Une telle
fonctionnalité est utile. Par exemple, vous pouvez autoriser des
utilisateurs sur des sites distants à accèder à
leur propre machine dans la mesure où vous connaissez leur
adresse IP :
d122 7
a128 8
<font color="#ff0000">REMARQUE :</font> Les paquets redirigés
doivent encore être autorisés par le moteur de filtrage.
Ils seront bloqués ou autorisés selon les règles de
filtrage qui ont été définies. La <i>seule</i>
exception à cette règle est lorsque le mot-clé
<tt>pass</tt> est utilisé dans la règle <tt>rdr</tt>; dans
ce cas, les paquets redirigés seront automatiquement
autorisés par le moteur de filtrage.
d131 4
a134 5
Notez aussi que la traduction est effectuée <i>avant</i> le
filtrage. Le moteur de filtrage verra le paquet <i>traduit</i>,
ç.à.d. après que son adresse IP destination et/ou
port de destination soient modifiés pour correspondre à
l'adresse/au port de redirection spécifié(e) dans la
d152 3
a154 2
Avant que la règle de redirection ne soit utilisée, le
paquet est traité :
d157 2
a158 2
<li>Port source : 4028 (choisi de manière arbitraire par le
    système d'exploitation)
d173 2
a174 3
Le moteur de filtrage verra le paquet IP tel qu'il apparaît
après la traduction effectuée par le mécanisme de
redirection.
d178 18
a195 23
La redirection a des implications au niveau de la
sécurité. La création d'une ouverture pour
autoriser le trafic à destination du réseau interne
protégé peut causer la compromission d'une machine sur ce
dernier. Par exemple, si le trafic est redirigé vers un serveur
web interne et par malheur, une vulnérabilité est
découverte dans le service web ou dans un script CGI
executé par le serveur, alors la machine peut être
compromise par un intrus provenant d'Internet. Une fois cette
compromission réalisée, l'intrus peut rebondir à
partir de cette machine vers le réseau interne ce qui est bien
entendu permis par le pare-feu.

<p>
Ces risques peuvent être minimisés en confinant de
manière stricte le système accédé depuis
l'extérieur à un réseau séparé. Ce
réseau est souvent appelé zone démilitarisée
(DMZ) ou réseau de service privé (Private Service Network,
PSN). De cette façon, si le serveur web est compromis, les effets
peuvent être limités au réseau DMZ/PSN en filtrant
soigneusement le trafic autorisé entre DMZ/PSN et vos autres
réseaux.
d199 3
a201 4
Souvent, les règles de redirection sont utilisées pour
faire suivre des connexions Internet entrantes à un serveur local
disposant d'une adresse privée sur le réseau interne comme
le montre l'exemple suivant :
d212 14
a225 16
Mais lorsque la règle de redirection est testée par un
client du LAN, elle ne fonctionne pas. C'est normal car les
règles de redirection ne s'appliquent qu'aux paquets qui passent
à travers l'interface spécifiée dans chacune
d'elles (dans l'exemple précité, c'est l'interface externe
<tt>$ext_if</tt>). Cependant, une connexion émanant d'un client
interne et à destination de l'adresse externe du pare-feu
n'implique pas que les paquets vont passer à travers l'interface
externe du pare-feu. La pile TCP/IP sur le pare- feu compare l'adresse
de destination des paquets entrants avec ses propres adresses et aliases
et détecte les connexions qui lui sont destinées lorsque
les paquets constituant celles-ci passent son interface interne. De tels
paquets ne passent pas physiquement à travers l'interface
externe, et de toute façon la pile ne simule pas ce passage.
Ainsi, PF ne voit jamais ces paquets sur l'interface externe. Du coup,
la règle de redirection sur l'interface externe n'est jamais
d229 12
a240 14
Que doit-on faire alors ? ajouter une seconde règle de
redirection sur l'interface interne ? non, ça ne fonctionnera pas
mieux. Lorsque le client local se connecte à l'interface externe
du pare-feu, le paquet initial de l'échange TCP atteint le 
pare-feu via son interface interne. La nouvelle règle de
redirection s'applique et l'adresse de destination est remplacée
par celle du serveur interne. Le paquet et alors redirigé par
l'interface interne du pare-feu vers le serveur interne. Mais l'adresse
source n'a pas été modifiée. Elle contient
l'adresse du client local. Le serveur envoie alors directement les
réponses au client. Le pare-feu ne voit jamais le retour et n'a
aucune chance de traduire correctement les paquets de retour. Le client
reçoit une réponse à partir d'une source
inattendue. Il met alors fin à cette connexion.
d245 2
a246 2
manière aussi transparente. Il existe plusieurs solutions
à ce problème :
d252 6
a257 7
Il est possible de configurer les serveurs DNS pour fournir une
réponse différente selon la provenance de la requête
: clients internes ou externes. Ainsi les clients internes recevront
l'adresse interne du serveur en réponse à leur demande de
résolution de nom. Ils pourront alors se connecter directement au
serveur local sans impliquer le pare-feu. Ce dernier sera alors moins
sollicité.
d260 1
a260 2
<h3>Déplacer le Serveur Vers un Réseau Local
    Séparé</h3>
d263 9
a271 12
Une autre solution consiste à ajouter une carte réseau au
pare-feu et à déplacer le serveur local vers un
réseau dédié de type DMZ. Les connexions des
clients locaux seront alors redirigées de la même
manière que les connexions en provenance d'Internet.
L'utilisation de réseaux séparés a plusieurs
avantages. Entre autres, une amélioration du niveau de
sécurité en isolant le serveur des machines internes. Si
le serveur (qui, nous le rappelons, est joignable d'Internet) est
compromis, il ne peut se connecter à des machines internes
directement vu que toutes ces connexions doivent passer à travers
le pare-feu.
d277 6
a282 7
Un proxy TCP générique peut être mis en place sur le
pare-feu. Ce proxy devra écouter sur le port de redirection ou
accepter les connexions sur l'interface interne et redirigées sur
le port sur lequel il écoute. Lorsqu'un client se connecte sur le
pare-feu, le proxy accepte la connexion, établit une seconde
connexion au serveur interne, et véhicule les données
entre les deux connexions.
d285 1
a285 1
Des proxies simples peuvent être crées avec 
d290 4
a293 4
L'entrée suivante dans le fichier <tt>/etc/inetd.conf</tt>
crée une socket d'écoute rattachée à
l'adresse de loopback (127.0.0.1) et le port 5000. Les connexions sont
redirigées sur le port 80 du serveur 192.168.1.10.
d302 2
a303 2
La règle de redirection suivante redirige le port 80 sur
l'interface interne du proxy :
d315 3
a317 3
A l'aide d'une règle NAT supplémentaire sur l'interface
interne, la traduction manquante d'adresse source décrite plus
haut peut être réalisée.
d331 12
a342 16
paquet initial envoyé par le client lorsque celui-ci est
redirigé à travers l'interface interne. Cette seconde
opération de traduction remplacera l'adresse source du client par
l'adresse interne du pare-feu. Le serveur interne répondra alors
à l'adresse interne du pare-feu, qui effectuera les
opérations de NAT et de RDR inverses avant de faire suivre le
paquet au client. Cette méthode est relativement complexe. Elle
crée deux états séparés pour chaque
connexion redirigée. Il faut prendre des précautions pour
éviter que la règle de NAT s'applique au reste du trafic
tel que les connexions en provenance de hôtes externes (via
d'autres redirections) ou en provenance du pare-feu lui-même. Il
est à noter que la règle <tt>rdr</tt>
précitée fera apparaître à la pile TCP/IP des
paquets en provenance du réseau interne et à destination
de ce dernier.
d345 2
a346 2
Cependant, nous recommandons de privilégier plutôt les
solutions précédemment mentionnées.
d362 1
a362 1
$Translation: rdr.html,v 1.10 2004/11/01 00:19:41 saad Exp $<br>
@


1.8
log
@Sync with Steelix CVS
@
text
@d308 1
a308 1
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=inetd&amp;sektion=8&amp;manpath=OpenBSD+3.5"
d310 1
a310 1
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=nc&amp;sektion=1&amp;manpath=OpenBSD+3.5"
d387 2
a388 2
Originally [OpenBSD: rdr.html,v 1.16 ]<br>
$Translation: rdr.html,v 1.9 2004/10/11 12:24:36 saad Exp $<br>
@


1.7
log
@sync with Steelix CVS
@
text
@d37 2
a38 2
[<a href="nat.html">Pr&eacute;c&eacute;dent : Traduction d'Adresses
R&eacute;seau</a>]
d40 2
a41 2
[<a href="shortcuts.html">Suivant : Raccourcis pour la Cr&eacute;ation
de Jeux de R&egrave;gles</a>]
d48 1
a48 1
<h3>Table des Mati&egrave;res</h3>
d53 2
a54 2
    S&eacute;curit&eacute;</a>
<li><a href="#reflect">Redirection et R&eacute;flexion</a>
d57 2
a58 2
        <li><a href="#sepnet">D&eacute;placer le Serveur Vers un
            R&eacute;seau Local S&eacute;par&eacute;</a>
d69 7
a75 7
Quand vous utilisez la NAT, les machines sur votre r&eacute;seau peuvent
acc&eacute;der &agrave; la totalit&eacute; des ressources Internet.
Qu'en est-il lorsqu'une de vos machines derri&egrave;re la passerelle
NAT a besoin d'&ecirc;tre acc&eacute;d&eacute;e depuis Internet ? la
redirection est utilis&eacute;e pour r&eacute;soudre ce genre de
probl&egrave;mes. Elle permet au trafic entrant d'&ecirc;tre
achemin&eacute; vers une machine derri&egrave;re la passerelle NAT.
d86 4
a89 4
La ligne ci-dessus redirige le trafic &agrave; destination du port TCP
80 (serveur web) vers une machine sur le r&eacute;seau d'adresse IP
192.168.1.20. Ainsi, m&ecirc;me si cette machine est derri&egrave;re
votre passerelle, le monde externe peut y avoir acc&egrave;s.
d93 4
a96 4
pr&eacute;cit&eacute;e peut &ecirc;tre assez utile. Si vous voulez
restreindre les adresses ou les sous-r&eacute;seaux autoris&eacute;s
&agrave; avoir acc&egrave;s au serveur web sur le port 80, vous pouvez
le faire de la fa&ccedil;on suivante :
d106 6
a111 6
sous-r&eacute;seau sp&eacute;cifi&eacute;. Notez que cela implique la
possibilit&eacute; de rediriger diff&eacute;rentes machines en
entr&eacute;e vers des machines derri&egrave;re la passerelle. Une telle
fonctionnalit&eacute; est utile. Par exemple, vous pouvez autoriser des
utilisateurs sur des sites distants &agrave; acc&egrave;der &agrave;
leur propre machine dans la mesure o&ugrave; vous connaissez leur
d126 8
a133 8
<font color="#ff0000">REMARQUE :</font> Les paquets redirig&eacute;s
doivent encore &ecirc;tre autoris&eacute;s par le moteur de filtrage.
Ils seront bloqu&eacute;s ou autoris&eacute;s selon les r&egrave;gles de
filtrage qui ont &eacute;t&eacute; d&eacute;finies. La <i>seule</i>
exception &agrave; cette r&egrave;gle est lorsque le mot-cl&eacute;
<tt>pass</tt> est utilis&eacute; dans la r&egrave;gle <tt>rdr</tt>; dans
ce cas, les paquets redirig&eacute;s seront automatiquement
autoris&eacute;s par le moteur de filtrage.
d136 1
a136 1
Notez aussi que la traduction est effectu&eacute;e <i>avant</i> le
d138 4
a141 4
&ccedil;.&agrave;.d. apr&egrave;s que son adresse IP destination et/ou
port de destination soient modifi&eacute;s pour correspondre &agrave;
l'adresse/au port de redirection sp&eacute;cifi&eacute;(e) dans la
r&egrave;gle <tt>rdr</tt>. Consid&eacute;rons le cas suivant :
d143 1
a143 1
<li>192.0.2.1 - h&ocirc;te sur Internet
d149 1
a149 1
R&egrave;gle de redirection :
d158 2
a159 2
Avant que la r&egrave;gle de redirection ne soit utilis&eacute;e, le
paquet est trait&eacute; :
d162 2
a163 2
<li>Port source : 4028 (choisi de mani&egrave;re arbitraire par le
    syst&egrave;me d'exploitation)
d169 1
a169 1
Puis la r&egrave;gle de redirection est &eacute;valu&eacute;e :
d178 2
a179 2
Le moteur de filtrage verra le paquet IP tel qu'il appara&icirc;t
apr&egrave;s la traduction effectu&eacute;e par le m&eacute;canisme de
d183 1
a183 1
<h2>Implications au niveau de la S&eacute;curit&eacute;</h2>
d185 7
a191 7
s&eacute;curit&eacute;. La cr&eacute;ation d'une ouverture pour
autoriser le trafic &agrave; destination du r&eacute;seau interne
prot&eacute;g&eacute; peut causer la compromission d'une machine sur ce
dernier. Par exemple, si le trafic est redirig&eacute; vers un serveur
web interne et par malheur, une vuln&eacute;rabilit&eacute; est
d&eacute;couverte dans le service web ou dans un script CGI
execut&eacute; par le serveur, alors la machine peut &ecirc;tre
d193 2
a194 2
compromission r&eacute;alis&eacute;e, l'intrus peut rebondir &agrave;
partir de cette machine vers le r&eacute;seau interne ce qui est bien
d198 9
a206 9
Ces risques peuvent &ecirc;tre minimis&eacute;s en confinant de
mani&egrave;re stricte le syst&egrave;me acc&eacute;d&eacute; depuis
l'ext&eacute;rieur &agrave; un r&eacute;seau s&eacute;par&eacute;. Ce
r&eacute;seau est souvent appel&eacute; zone d&eacute;militaris&eacute;e
(DMZ) ou r&eacute;seau de service priv&eacute; (Private Service Network,
PSN). De cette fa&ccedil;on, si le serveur web est compromis, les effets
peuvent &ecirc;tre limit&eacute;s au r&eacute;seau DMZ/PSN en filtrant
soigneusement le trafic autoris&eacute; entre DMZ/PSN et vos autres
r&eacute;seaux.
d209 4
a212 4
<h2>Redirection et R&eacute;flexion</h2>
Souvent, les r&egrave;gles de redirection sont utilis&eacute;es pour
faire suivre des connexions Internet entrantes &agrave; un serveur local
disposant d'une adresse priv&eacute;e sur le r&eacute;seau interne comme
d224 1
a224 1
Mais lorsque la r&egrave;gle de redirection est test&eacute;e par un
d226 6
a231 6
r&egrave;gles de redirection ne s'appliquent qu'aux paquets qui passent
&agrave; travers l'interface sp&eacute;cifi&eacute;e dans chacune
d'elles (dans l'exemple pr&eacute;cit&eacute;, c'est l'interface externe
<tt>$ext_if</tt>). Cependant, une connexion &eacute;manant d'un client
interne et &agrave; destination de l'adresse externe du pare-feu
n'implique pas que les paquets vont passer &agrave; travers l'interface
d234 1
a234 1
et d&eacute;tecte les connexions qui lui sont destin&eacute;es lorsque
d236 2
a237 2
paquets ne passent pas physiquement &agrave; travers l'interface
externe, et de toute fa&ccedil;on la pile ne simule pas ce passage.
d239 2
a240 2
la r&egrave;gle de redirection sur l'interface externe n'est jamais
appliqu&eacute;e.
d243 7
a249 7
Que doit-on faire alors ? ajouter une seconde r&egrave;gle de
redirection sur l'interface interne ? non, &ccedil;a ne fonctionnera pas
mieux. Lorsque le client local se connecte &agrave; l'interface externe
du pare-feu, le paquet initial de l'&eacute;change TCP atteint le 
pare-feu via son interface interne. La nouvelle r&egrave;gle de
redirection s'applique et l'adresse de destination est remplac&eacute;e
par celle du serveur interne. Le paquet et alors redirig&eacute; par
d251 1
a251 1
source n'a pas &eacute;t&eacute; modifi&eacute;e. Elle contient
d253 1
a253 1
r&eacute;ponses au client. Le pare-feu ne voit jamais le retour et n'a
d255 2
a256 2
re&ccedil;oit une r&eacute;ponse &agrave; partir d'une source
inattendue. Il met alors fin &agrave; cette connexion.
d260 3
a262 3
connectent au m&ecirc;me serveur interne que les clients externes et de
mani&egrave;re aussi transparente. Il existe plusieurs solutions
&agrave; ce probl&egrave;me :
d269 1
a269 1
r&eacute;ponse diff&eacute;rente selon la provenance de la requ&ecirc;te
d271 2
a272 2
l'adresse interne du serveur en r&eacute;ponse &agrave; leur demande de
r&eacute;solution de nom. Ils pourront alors se connecter directement au
d274 1
a274 1
sollicit&eacute;.
d277 2
a278 2
<h3>D&eacute;placer le Serveur Vers un R&eacute;seau Local
    S&eacute;par&eacute;</h3>
d281 8
a288 8
Une autre solution consiste &agrave; ajouter une carte r&eacute;seau au
pare-feu et &agrave; d&eacute;placer le serveur local vers un
r&eacute;seau d&eacute;di&eacute; de type DMZ. Les connexions des
clients locaux seront alors redirig&eacute;es de la m&ecirc;me
mani&egrave;re que les connexions en provenance d'Internet.
L'utilisation de r&eacute;seaux s&eacute;par&eacute;s a plusieurs
avantages. Entre autres, une am&eacute;lioration du niveau de
s&eacute;curit&eacute; en isolant le serveur des machines internes. Si
d290 2
a291 2
compromis, il ne peut se connecter &agrave; des machines internes
directement vu que toutes ces connexions doivent passer &agrave; travers
d298 6
a303 6
Un proxy TCP g&eacute;n&eacute;rique peut &ecirc;tre mis en place sur le
pare-feu. Ce proxy devra &eacute;couter sur le port de redirection ou
accepter les connexions sur l'interface interne et redirig&eacute;es sur
le port sur lequel il &eacute;coute. Lorsqu'un client se connecte sur le
pare-feu, le proxy accepte la connexion, &eacute;tablit une seconde
connexion au serveur interne, et v&eacute;hicule les donn&eacute;es
d307 1
a307 1
Des proxies simples peuvent &ecirc;tre cr&eacute;es avec 
d312 2
a313 2
L'entr&eacute;e suivante dans le fichier <tt>/etc/inetd.conf</tt>
cr&eacute;e une socket d'&eacute;coute rattach&eacute;e &agrave;
d315 1
a315 1
redirig&eacute;es sur le port 80 du serveur 192.168.1.10.
d324 1
a324 1
La r&egrave;gle de redirection suivante redirige le port 80 sur
d337 3
a339 3
A l'aide d'une r&egrave;gle NAT suppl&eacute;mentaire sur l'interface
interne, la traduction manquante d'adresse source d&eacute;crite plus
haut peut &ecirc;tre r&eacute;alis&eacute;e.
d353 15
a367 15
paquet initial envoy&eacute; par le client lorsque celui-ci est
redirig&eacute; &agrave; travers l'interface interne. Cette seconde
op&eacute;ration de traduction remplacera l'adresse source du client par
l'adresse interne du pare-feu. Le serveur interne r&eacute;pondra alors
&agrave; l'adresse interne du pare-feu, qui effectuera les
op&eacute;rations de NAT et de RDR inverses avant de faire suivre le
paquet au client. Cette m&eacute;thode est relativement complexe. Elle
cr&eacute;e deux &eacute;tats s&eacute;par&eacute;s pour chaque
connexion redirig&eacute;e. Il faut prendre des pr&eacute;cautions pour
&eacute;viter que la r&egrave;gle de NAT s'applique au reste du trafic
tel que les connexions en provenance de h&ocirc;tes externes (via
d'autres redirections) ou en provenance du pare-feu lui-m&ecirc;me. Il
est &agrave; noter que la r&egrave;gle <tt>rdr</tt>
pr&eacute;cit&eacute;e fera appara&icirc;tre &agrave; la pile TCP/IP des
paquets en provenance du r&eacute;seau interne et &agrave; destination
d371 2
a372 2
Cependant, nous recommandons de privil&eacute;gier plut&ocirc;t les
solutions pr&eacute;c&eacute;demment mentionn&eacute;es.
d375 2
a376 2
[<a href="nat.html">Pr&eacute;c&eacute;dent : Traduction d'Adresses
R&eacute;seau</a>]
d378 2
a379 2
[<a href="shortcuts.html">Suivant : Raccourcis pour la Cr&eacute;ation
de Jeux de R&egrave;gles</a>]
d388 1
a388 1
$Translation: rdr.html,v 1.8 2004/05/28 18:44:13 saad Exp $<br>
@


1.6
log
@sync with Steelix CVS. thanks to Olivier HORN <ohorn at axal dot fr> for
a fix.
@
text
@d37 1
a37 1
[<a href="../nat.html">Pr&eacute;c&eacute;dent : Traduction d'Adresses
d375 1
a375 1
[<a href="../nat.html">Pr&eacute;c&eacute;dent : Traduction d'Adresses
d388 1
a388 1
$Translation: rdr.html,v 1.7 2004/05/12 20:21:45 saad Exp $<br>
@


1.5
log
@Sync with Steelix CVS
@
text
@a11 1
<meta name="copyright"     content="This document copyright 2002-2004 by OpenBSD.">
d14 17
d387 2
a388 2
Originally [OpenBSD: rdr.html,v 1.15 ]<br>
$Translation: rdr.html,v 1.6 2004/05/02 21:04:14 saad Exp $<br>
@


1.4
log
@Sync with Steelix CVS
@
text
@d292 1
a292 1
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=inetd&amp;sektion=8&amp;manpath=OpenBSD+3.4"
d294 1
a294 1
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=nc&amp;sektion=1&amp;manpath=OpenBSD+3.4"
d371 2
a372 2
Originally [OpenBSD: rdr.html,v 1.14 ]<br>
$Translation: rdr.html,v 1.5 2004/03/23 20:29:05 saad Exp $<br>
@


1.3
log
@Sync with Steelix CVS
@
text
@d352 1
a352 11
de ce dernier. Pour &eacute;viter que la pile envoie des messages de
redirection ICMP (disant au client que la destination est directement
joignable ce qui aura pour effet de casser la redirection),
d&eacute;sactivez l'envoi de messages de redirection ICMP sur le pare-
feu en utilisant
<blockquote>
<tt>
# sysctl -w net.inet.ip.redirect=0<br>
# sysctl -w net.inet6.ip6.redirect=0 <i>(if using IPv6)</i>
</tt>
</blockquote>
d371 2
a372 2
Originally [OpenBSD: rdr.html,v 1.13 ]<br>
$Translation: rdr.html,v 1.4 2004/03/12 22:55:05 saad Exp $<br>
@


1.2
log
@Sync with Steelix CVS
@
text
@d137 1
a137 1
&nbsp;&nbsp;&nbsp;-&gt; 192.168.1.5 8000
d381 2
a382 2
Originally [OpenBSD: rdr.html,v 1.12 ]<br>
$Translation: rdr.html,v 1.3 2004/02/29 20:27:49 saad Exp $<br>
@


1.1
log
@Sync with Steelix CVS
@
text
@d21 1
a21 1
[<a href="nat.html">Pr&eacute;c&eacute;dent : Traduction d'Adresses
d369 1
a369 1
[<a href="nat.html">Pr&eacute;c&eacute;dent : Traduction d'Adresses
d382 1
a382 1
$Translation: rdr.html,v 1.2 2004/02/13 23:21:59 saad Exp $<br>
@

