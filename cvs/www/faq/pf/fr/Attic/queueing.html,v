head	1.32;
access;
symbols;
locks; strict;
comment	@# @;


1.32
date	2014.04.01.17.14.10;	author nick;	state dead;
branches;
next	1.31;

1.31
date	2013.11.01.18.04.05;	author ajacoutot;	state Exp;
branches;
next	1.30;

1.30
date	2013.05.07.12.47.22;	author ajacoutot;	state Exp;
branches;
next	1.29;

1.29
date	2012.11.02.07.24.05;	author ajacoutot;	state Exp;
branches;
next	1.28;

1.28
date	2012.05.19.22.52.00;	author ajacoutot;	state Exp;
branches;
next	1.27;

1.27
date	2012.05.13.16.30.18;	author ajacoutot;	state Exp;
branches;
next	1.26;

1.26
date	2011.11.05.12.45.49;	author ajacoutot;	state Exp;
branches;
next	1.25;

1.25
date	2011.05.07.08.22.01;	author ajacoutot;	state Exp;
branches;
next	1.24;

1.24
date	2010.11.09.08.15.21;	author ajacoutot;	state Exp;
branches;
next	1.23;

1.23
date	2010.09.26.10.09.25;	author ajacoutot;	state Exp;
branches;
next	1.22;

1.22
date	2009.10.20.20.44.42;	author ajacoutot;	state Exp;
branches;
next	1.21;

1.21
date	2009.05.01.13.16.23;	author tobias;	state Exp;
branches;
next	1.20;

1.20
date	2009.02.22.20.35.21;	author tobias;	state Exp;
branches;
next	1.19;

1.19
date	2008.12.01.07.52.52;	author tobias;	state Exp;
branches;
next	1.18;

1.18
date	2008.08.25.14.21.24;	author tobias;	state Exp;
branches;
next	1.17;

1.17
date	2008.01.13.13.43.35;	author tobias;	state Exp;
branches;
next	1.16;

1.16
date	2007.05.09.05.49.53;	author jufi;	state Exp;
branches;
next	1.15;

1.15
date	2007.02.14.19.01.55;	author jufi;	state Exp;
branches;
next	1.14;

1.14
date	2007.01.06.02.47.26;	author saad;	state Exp;
branches;
next	1.13;

1.13
date	2006.11.02.18.23.22;	author jufi;	state Exp;
branches;
next	1.12;

1.12
date	2006.05.02.17.09.33;	author jufi;	state Exp;
branches;
next	1.11;

1.11
date	2006.03.10.16.35.07;	author saad;	state Exp;
branches;
next	1.10;

1.10
date	2005.11.03.11.30.53;	author saad;	state Exp;
branches;
next	1.9;

1.9
date	2005.05.22.17.38.07;	author saad;	state Exp;
branches;
next	1.8;

1.8
date	2005.02.26.10.30.40;	author jufi;	state Exp;
branches;
next	1.7;

1.7
date	2005.02.13.17.41.41;	author saad;	state Exp;
branches;
next	1.6;

1.6
date	2005.01.18.09.54.52;	author jufi;	state Exp;
branches;
next	1.5;

1.5
date	2004.12.29.10.38.26;	author saad;	state Exp;
branches;
next	1.4;

1.4
date	2004.11.01.02.56.30;	author saad;	state Exp;
branches;
next	1.3;

1.3
date	2004.10.13.14.44.30;	author jufi;	state Exp;
branches;
next	1.2;

1.2
date	2004.10.11.16.17.48;	author jufi;	state Exp;
branches;
next	1.1;

1.1
date	2004.10.11.10.15.58;	author jufi;	state Exp;
branches;
next	;


desc
@@


1.32
log
@
Abandon translations, per deraadt@@ and ajacoutot@@.
@
text
@<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<html>
<head>
<title>PF : Gestion de La Bande Passante</title>
<link rev="made" href="mailto:www@@openbsd.org">
<meta http-equiv="Content-Type" content="text/html; charset=ISO-8859-1">
<meta name="resource-type" content="document">
<meta name="description" content="the OpenBSD FAQ page">
<meta name="keywords"      content="openbsd,faq,pf">
<meta name="distribution"  content="global">
</head>

<!--
Copyright (c) 2003-2005 Joel Knight <enabled@@myrealbox.com>

Permission to use, copy, modify, and distribute this documentation for
any purpose with or without fee is hereby granted, provided that the
above copyright notice and this permission notice appear in all copies.

THE DOCUMENTATION IS PROVIDED "AS IS" AND THE AUTHOR DISCLAIMS ALL
WARRANTIES WITH REGARD TO THIS DOCUMENTATION INCLUDING ALL IMPLIED
WARRANTIES OF MERCHANTABILITY AND FITNESS. IN NO EVENT SHALL THE
AUTHOR BE LIABLE FOR ANY SPECIAL, DIRECT, INDIRECT, OR CONSEQUENTIAL
DAMAGES OR ANY DAMAGES WHATSOEVER RESULTING FROM LOSS OF USE, DATA OR
PROFITS, WHETHER IN AN ACTION OF CONTRACT, NEGLIGENCE OR OTHER
TORTIOUS ACTION, ARISING OUT OF OR IN CONNECTION WITH THE USE OR
PERFORMANCE OF THIS DOCUMENTATION
-->

<body bgcolor="#ffffff" text="#000000">
<!-- Passes validator.w3.org, please keep it this way;
please, use a max of 72 chars per line -->

<a href="../../../fr/index.html">
<img alt="[OpenBSD]" height="30" width="141" src="../../../images/smalltitle.gif" border="0">
</a>
<p>
[<a href="anchors.html">Précédent : Ancres</a>]
[<a href="index.html">Sommaire</a>]
[<a href="pools.html">Suivant : Ensembles d'adresses (&quot;Pools&quot;) et
Partage de Charge</a>]

<p>
<h1><font color="#e00000">PF : Gestion de La Bande Passante</font></h1>


<hr>

<h3>Table des Matières</h3>
<ul>
<li><a href="#queueing">Mise en queue</a>
<li><a href="#sched">Planificateurs</a>
 <ul>
 <li><a href="#cbq">Mise en queue par classes</a>
 <li><a href="#priq">Mise en queue par priorités</a>
 <li><a href="#red">Détection Aléatoire Anticipée</a>
 <li><a href="#ecn">Notification Explicite de Congestion</a>
 </ul>
<li><a href="#altq">Configuration de la Mise en queue</a>
<li><a href="#assign">Assignation du Trafic dans une Queue</a>
<li><a href="#example1">Exemple #1 : Réseau domestique</a>
<li><a href="#example2">Exemple #2 : Réseau d'entreprise</a>
</ul>

<hr>

<a name="queueing"></a>
<h2>Mise en queue</h2>
<p>
Mettre en queue quelque chose signifie stocker, de manière ordonnée,
cette chose pendant qu'elle attend un traitement. Dans un réseau
informatique, quand les paquets de données sont envoyés à l'extérieur de
l'hôte, ils entrent dans une queue où ils attendent un traitement par le
système d'exploitation. Celui-ci décide ensuite quelle queue et quel(s)
paquet(s) de cette queue doivent être traités. L'ordre dans lequel le
système d'exploitation sélectionne les paquets à traiter peut affecter
les performances du réseau. Par exemple, imaginez un utilisateur
lançant deux applications réseau : SSH et FTP. Idéalement, les paquets
SSH devraient être traités avant les paquets FTP à cause de la
sensibilité au temps de SSH; quand une clef est entrée dans le client
SSH, une réponse immédiate est attendue, mais un transfert FTP retardé
de quelques secondes n'attirera pratiquement pas l'attention. Mais que
se passe-t-il si le routeur manipulant ces connexions traite un grand
nombre de paquets provenant de la connexion FTP avant de traiter la
connexion SSH ? Les paquets de la connexion SSH resteront dans la queue
(ou seront rejetés par le routeur si la queue n'est pas assez grande
pour accueillir tous les paquets) et la session SSH apparaitra
certainement comme ralentie ou haletante. En modifiant la stratégie de
mise en queue utilisée, la bande passante du réseau peut être partagée
de façon juste entre les différents applications, utilisateurs et
ordinateurs.

<p>
Notez que la mise en queue est utile uniquement pour les paquets sortant
("<i>outbound</i>"). Une fois qu'un paquet arrive sur une interface dans
la direction entrante il est déjà trop tard pour le mettre en queue --
la bande passante a déjà été consommée et l'interface le reçoit
simplement. La seule solution est d'activer la mise en queue sur un
routeur adjacent ou, si l'hôte recevant le paquet agit comme un routeur,
d'activer la mise en queue sur l'interface interne sur laquelle les
paquets quittent le routeur.

<a name="sched"></a>
<h2>Planificateurs</h2>
L'algorithme décide des queues à traiter et dans quel ordre. Par défaut,
OpenBSD utilise un algorithme "First In First Out" (FIFO). Une queue
FIFO travaille comme une caisse de supermarché -- le premier article de
la queue est le premier traité. Au fur et à mesure que des nouveaux
paquets arrivent, ils sont ajoutés à la queue. Si la queue est pleine -
et c'est là que l'analogie avec la caisse de supermarché s'arrête - les
nouveaux paquets sont rejetés. Ceci est connu sous le nom de "tail-
drop".

<p>
OpenBSD supporte deux algorithmes additionnels :
<ul>
<li>Mise en queue par classes
<li>Mise en queue par priorités
</ul>

<a name="cbq"></a>
<h3>Mise en queue par classes</h3>
La Mise en queue par classes (CBQ) est un algorithme de mise en queue
qui divise la bande passante des multiples connexions réseau en queues
ou en classes. Chaque queue se voit ainsi assigner un trafic sur les
bases d'une adresse source ou de destination, d'un numéro de port, d'un
protocole, etc... Une queue peut optionnellement être configurée pour
emprunter de la bande passante aux queues parentes si celles-ci sont sous-
utilisées. Les queues ont aussi une priorité selon qu'elles contiennent
du trafic interactif, comme SSH, et peuvent avoir leurs paquets traités
avant les queues contenant le trafic volumineux, comme FTP.

<p>
Les queues CBQ sont ordonnées de manière hiérarchique. Au sommet de la
hiérarchie se trouve la queue "root" qui définit la totalité de la bande
passante disponible. Les queues enfant sont crées sous la queue "root",
chacune d'elle peut se voir assigner une partie de la bande passante de
la queue "root". Par exemple, les queues peuvent être définies comme
suit :

<dl>
<dd>Root Queue (2Mbps)
        <dl>
        <dd>Queue A (1Mbps)
        <dd>Queue B (500Kbps)
        <dd>Queue C (500Kbps)
        </dl>
</dl>

<p>
Dans ce cas, la totalité de la bande passante est fixée à 2 megabits par
seconde (Mbps). Cette bande passante est ensuite subdivisée en trois
queues enfant.

<p>
La hiérarchie peut encore être approfondie en définissant des queues
dans les queues. Pour subdiviser équitablement la bande passante entre
les différents utilisateurs et aussi classer leur trafic pour éviter que
certains protocoles ne privent de bande passante d'autres protocoles,
une structure de mise en queue comme celle-ci peut être définie :

<dl>
<dd>Root Queue (2Mbps)
        <dl>
        <dd>UserA (1Mbps)
                <dl>
                <dd>ssh (50Kbps)
                <dd>bulk (950Kbps)
                </dl>
        <dd>UserB (1Mbps)
                <dl>
                <dd>audio (250Kbps)
                <dd>bulk (750Kbps)
                        <dl>
                        <dd>http (100Kbps)
                        <dd>other (650Kbps)
                        </dl>
                </dl>
        </dl>
</dl>

<p>
Notez qu' à chaque niveau, la somme des bandes passantes assignées à
chaque queue ne doit pas être supérieure à celle assignée à la queue
parent.

<p>
Une queue peut être configurée pour emprunter de la bande passante aux
queues parent si ces dernières en ont en excès suite à la non-utilisation 
par d'autres queues enfant. Considérez le réglage de mise en queue suivant :

<dl>
<dd>Root Queue (2Mbps)
        <dl>
        <dd>UserA (1Mbps)
                <dl>
                <dd>ssh (100Kbps)
                <dd>ftp (900Kbps, borrow)
                </dl>
        <dd>UserB (1Mbps)
        </dl>
</dl>

<p>
Si le trafic dans la queue <tt>ftp</tt> excède 900Kbps et le trafic dans
la queue <tt>UserA</tt> est inférieur à 1Mbps (parce que la queue
<tt>ssh</tt> utilise moins que les 100Kbps qu'elle dispose), la queue
<tt>ftp</tt> empruntera l'excès de bande passante de <tt>UserA</tt>.
Dans cette optique la queue <tt>ftp</tt> est en mesure d'utiliser
davantage de bande passante que ce qui lui est assigné quand elle fait
face à une surcharge. Quand la queue <tt>ssh</tt> verra sa charge
augmenter, la bande passante empruntée sera restituée.

<p>
CBQ assigne une priorité à chaque queue. Les queues avec une priorité
élevée sont préférées aux queues avec une priorité inférieure pendant
une congestion tant que les deux queues partagent le même parent (en
d'autres termes, tant que les deux queues appartiennent à une même
branche de la hiérarchie). Les queues avec une même priorité sont
traitées dans un mode "round-robin". Par exemple :

<dl>
<dd>Root Queue (2Mbps)
        <dl>
        <dd>UserA (1Mbps, priority 1)
                <dl>
                <dd>ssh (100Kbps, priority 5)
                <dd>ftp (900Kbps, priority 3)
                </dl>
        <dd>UserB (1Mbps, priority 1)
        </dl>
</dl>

<p>
CBQ traitera les queues <tt>UserA</tt> et <tt>UserB</tt> dans un mode
"round-robin" -- aucune queue ne sera préférée à une autre. Pendant le
temps ou la queue <tt>UserA</tt> est traitée, CBQ traitera aussi les
queues enfant. Dans ce cas, la queue <tt>ssh</tt> a une priorité plus
élevée et aura un traitement préférentiel vis à vis de la queue
<tt>ftp</tt> si le réseau est congestionné. Notez que les queues
<tt>ssh</tt> et <tt>ftp</tt> n'ont pas leurs priorités comparées à
celles de <tt>UserA</tt> et <tt>UserB</tt> à cause du fait qu'elles ne
sont pas dans une même branche de la hiérarchie.

<p>
Pour un regard plus détaillé sur la théorie du fonctionnement de CBQ,
veuillez consulter les
<a href="http://www.icir.org/floyd/cbq.html">Références sur CBQ</a>.

<a name="priq"></a>
<h3>Mise en queue par priorités</h3>
La Mise en queue par priorités (PRIQ) assigne des queues à une interface
réseau et chaque queue possède une priorité. Une queue avec une priorité
plus élevée est <i>toujours</i> traitée avant une queue avec une
priorité moindre.
Si plusieurs queues ont la même priorité elles sont traitées en
"round-robin".

<p>
La structure des queues de PRIQ est plate -- vous ne pouvez pas définir
de queue au sein d'une autre queue. La queue "root" est définie et
possède la totalité de la bande passante disponible, et les sous-queues
sont définies ensuite en aval. Considérez l'exemple suivant :
<dl>
<dd>Root Queue (2Mbps)
        <dl>
        <dd>Queue A (priority 1)
        <dd>Queue B (priority 2)
        <dd>Queue C (priority 3)
        </dl>
</dl>

<p>
La queue "root" est définie comme ayant 2Mbps de bande passante
disponible et trois sous-queues sont définies. La queue avec la plus
haute priorité (le nombre priorité le plus grand) est servie en premier.
Une fois que tous les paquets dans cette queue ont été traités, ou si la
queue est vide, PRIQ s'occupe de la queue avec la priorité suivante. Au
sein d'une queue donnée, les paquets sont traités selon la manière
"First In First Out" (FIFO).

<p>
Il est important de noter que si vous utilisez PRIQ, vous devez créer
vos queues très prudemment. A cause du fait que PRIQ traite
<i>toujours</i> une queue avec une grande priorité avant une queue avec
une priorité basse, il est possible qu'une queue avec une priorité
élevée cause la suppression ou la disparition des paquets d'une queue
avec une priorité basse si la queue avec la priorité élevée reçoit un
flux constant de paquets.

<a name="red"></a>
<h3>Détection Aléatoire Anticipée</h3>
La Détection Aléatoire Anticipée (RED) est un algorithme d'évitement des
congestions. Sa fonction est d'éviter les congestions en s'assurant que
la queue ne devienne pas pleine. Elle réalise cela en calculant en
permanence la largeur moyenne (taille) de la queue et en la comparant à
deux valeurs de seuil, un seuil minimum et un seuil maximum. Si la
taille moyenne de la queue est au dessous du seuil minimal, aucun paquet
n'est rejeté. Si la moyenne est au dessus du seuil maximum alors
<i>tous</i> les nouveaux paquets arrivant sont rejetés. Si la moyenne
est comprise entre les seuils minimum et maximum les paquets sont
rejetés suivant une probabilité calculée grâce à la taille de la queue.
En d'autres mots, quand l'occupation de la queue approche le seuil
maximum, de plus en plus de paquets sont rejetés. Quand il rejete des
paquets, RED rejette aléatoirement la connexion pour laquelle il va
rejeter les paquets. Les connexions utilisant largement la bande
passante ont une plus grande probabilité de voir leurs paquets rejetés.

<p>
RED est utile car il évite la situation connue sous le nom de
synchronisation globale et il peut s'adapter à des bonds du trafic. La
synchronisation globale se réfère à une perte totale des données
sortantes due à la suppression simultanée de paquets de plusieurs
connexions. Par exemple, si la congestion apparait sur un routeur
supportant le trafic de 10 connexions FTP et tous les paquets de ces
connexions sont rejetés (comme c'est le cas avec une mise en queue
FIFO), la totalité du trafic sortant sera rejeté; brusquement. Ce n'est
pas une situation idéale car elle entraîne une réduction du trafic de
toutes les connexions FTP ce qui signifie que le réseau n'est plus
utilisé avec son potentiel maximum. RED évite cela en choisissant
aléatoirement une de ces connexions plutôt que de choisir toutes les
connexions. Les connexions utilisant une large partie de la bande
passante ont une probabilité supérieure de voir leurs paquets rejetés.
Dans cette optique, les connexions avec une haute bande passante seront
étranglées, la congestion sera évitée, et les pertes violentes de trafic
de sortie n'auront pas lieu. De plus, RED est capable de supporter des
explosions du trafic car il commence la suppression des paquets
<i>avant</i> que la queue ne devienne pleine. Si une explosion du trafic
se produit, il y aura assez d'espace pour mémoriser les nouveaux
paquets.

<p>
RED ne devrait être utilisé que quand le protocole est capable de
répondre aux indicateurs de congestion du réseau. Dans beaucoup de cas
cela signifie que RED devrait être utilisé pour mettre en queue du
trafic TCP et non du trafic UDP ou ICMP.

<p>
Pour un regard plus détaillé sur la théorie derrière RED, veuillez
consulter
<a href="http://www.icir.org/floyd/red.html">References on RED</a>.

<a name="ecn"></a>
<h3>Notification Explicite de Congestion</h3>
La Notification Explicite de Congestion (Early Congestion Notification
ou ECN) travaille en conjonction avec RED pour notifier deux hôtes
communicant via le réseau d'une congestion le long du chemin de
communication. Ceci est fait en autorisant RED à fixer un drapeau dans
l'entête du paquet plutôt que de rejeter le paquet. Si l'on part du
principe que l'hôte expéditeur supporte ECN, il pourra lire ce drapeau
et diminuer son trafic réseau en fonction.

<p>
Pour plus d'informations sur ECN, veuillez consulter
<a href="http://www.rfc-editor.org/rfc/rfc3168.txt">RFC 3168</a>.

<a name="altq"></a>
<h2>Configuration de la Mise en queue</h2>
Depuis OpenBSD 3.0 la
<a href="http://www.csl.sony.co.jp/person/kjc/kjc/software.html#ALTQ" >Mise en queue alternée (ALTQ)</a>, 
implémentation de la mise en queue, fait partie du système de base. En
commençant avec OpenBSD 3.3 ALTQ a été intégrée dans PF.
L'implémentation de ALTQ dans OpenBSD supporte les algorithmes de Mise
en Queue par classes (CBQ) et de Mise en Queue par priorités (PRIQ).
Elle supporte aussi la Détection Aléatoire Anticipée (RED) et la
Notification de Congestion Explicite (ECN).

<p>
Parce que ALTQ a été fusionnée avec PF, ce dernier doit être activé pour
que la mise en queue fonctionne. Les instructions sur la procédure
d'activation de PF peuvent être trouvées dans les
<a href="config.html#activate">Principes de base</a>.

<p>
La Mise en queue est configurée dans <tt>
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=pf.conf&amp;sektion=5&amp;manpath=OpenBSD+5.4"
>pf.conf</a></tt>.
Il y a deux types de directives utilisées pour configurer la Mise en
Queue :
<ul>
<li><tt>altq on</tt> - active la mise en queue sur une interface,
    définit l'algorithme à utiliser et créée la queue "root"
<li><tt>queue</tt> - définit les propriétés d'une queue enfant
</ul>

<p>
La syntaxe de la directive <tt>altq on</tt> est :
<blockquote>
<tt>
altq on <i>interface scheduler</i> bandwidth <i>bw</i> qlimit 
<i>qlim</i> \<br>
&nbsp;&nbsp;&nbsp;tbrsize <i>size</i> queue { <i>queue_list</i> }
</tt>
</blockquote>

<ul>
<li><tt><i>interface</i></tt> - l'interface réseau sur laquelle activer
    la mise en queue.
<li><tt><i>scheduler</i></tt> - l'algorithme à utiliser. Les valeurs
    possibles sont <tt>cbq</tt> et <tt>priq</tt>. Actuellement, seul un
    algorithme à la fois peut être activé sur une interface.
<li><tt><i>bw</i></tt> - la quantité totale de bande passante disponible
    pour l'algorithme. Elle peut être spécifiée avec une valeur absolue
    en utilisant les suffixes <tt>b</tt>, <tt>Kb</tt>, <tt>Mb</tt>, et
    <tt>Gb</tt> signifiant bits, kilobits, megabits, et gigabits par
    seconde, en valeur ou en pourcentage de la bande passante de l'
    <tt><i>interface</i></tt>.
<li><tt><i>qlim</i></tt> - le nombre maximum de paquets à stocker dans
    une queue. Ce paramètre est optionnel. Il est par défaut de 50.
<li><tt><i>size</i></tt> - la taille du régulateur en octets. Si elle
    n'est pas spécifiée, la taille utilisée est basée sur la bande
    passante de l' <tt><i>interface</i></tt>.
<li><tt><i>queue_list</i></tt> - une liste de queues enfant à créer en
    dessous de la queue "root".
</ul>

<p>
Par exemple :
<blockquote>
<tt>
altq on fxp0 cbq bandwidth 2Mb queue { std, ssh, ftp }
</tt>
</blockquote>
Ceci active CBQ sur l'interface <tt>fxp0</tt>. La totalité de la bande
passante disponible est fixée à 2Mbps. Trois queues enfant sont définies
: <tt>std</tt>, <tt>ssh</tt> et <tt>ftp</tt>.

<p>
La syntaxe pour la directive <tt>queue</tt> est :
<blockquote>
<tt>
queue <i>name</i> [on <i>interface</i>] bandwidth <i>bw</i> [priority 
<i>pri</i>] [qlimit <i>qlim</i>] \<br>
&nbsp;&nbsp;&nbsp;<i>scheduler</i> ( <i>sched_options</i> )
{ <i>queue_list</i> }
</tt>
</blockquote>

<ul>
<li><tt><i>name</i></tt> - le nom de la queue. Il doit correspondre à un
    des noms de queues définies dans la directive <tt>altq on</tt>
    <tt><i>queue_list</i></tt>. Pour <tt>cbq</tt> il peut aussi
    correspondre au nom d'une queue dans la directive <tt>queue</tt>
    précédente <tt><i>queue_list</i></tt>. Les noms de queue ne doivent
    pas être plus longs que 15 caractères.
<li><tt><i>interface</i></tt> - l'interface réseau pour laquelle la
    queue est valide. Cette valeur est optionnelle et si elle n'est pas
    précisée, la queue sera valide pour toutes les interfaces.
<li><tt><i>bw</i></tt> - la quantité totale de bande passante disponible
    pour la queue. Elle doit être spécifiée avec une valeur absolue en
    utilisant les suffixes <tt>b</tt>, <tt>Kb</tt>, <tt>Mb</tt>, et
    <tt>Gb</tt> signifiant bits, kilobits, megabits, et gigabits par
    seconde, en valeur ou en pourcentage de la bande passante de la
    queue parent. Ce paramètre n'est applicable que lorsque l'on utilise
    l'algorithme <tt>cbq</tt>.
	 Si non spécifié, 100% de la bande passante de la queue mère est
	 utilisée.
<li><tt><i>pri</i></tt> - la priorité de la queue. Pour <tt>cbq</tt> la
    gamme de priorités va de 0 à 7 et pour <tt>priq</tt> la gamme va de
    0 à 15. La priorité 0 est la priorité la plus basse. Quand elle
    n'est pas spécifiée, elle est par défaut de 1.
<li><tt><i>qlim</i></tt> - le nombre maximum de paquets acceptables dans
    une queue. Quand il n'est pas spécifié, la valeur utilisée par
    défaut est de 50.
<li><tt><i>scheduler</i></tt> - l'algorithme utilisé, soit <tt>cbq</tt>
    soit <tt>priq</tt>. Il doit être le même que celui de la queue
    "root".
<li><tt><i>sched_options</i></tt> - d'autres options peuvent être
    passées à l'algorithme pour contrôler son comportement :
        <ul>
        <li><tt>default</tt> - définit une queue par défaut dans
            laquelle tous les paquets ne répondant pas à une quelconque
            règle vont. Cette queue par défaut doit être unique.
        <li><tt>red</tt> - active la Détection Aléatoire Anticipée (RED)
            pour cette queue.
        <li><tt>rio</tt> - active RED dans les sens ENTREE/SORTIE. Dans
            ce mode, RED maintiendra des longueurs moyennes de queues et
            des valeurs de seuil, une pour chaque niveau de Qualité de
            service.
        <li><tt>ecn</tt> - active la Notification Explicite de
            Congestion (ECN) pour cette queue. <tt>Ecn</tt> implique
            <tt>red</tt>.
        <li><tt>borrow</tt> - la queue peut emprunter de la bande
            passante aux queues parent. Ceci n'est valable que lorsque
            vous utilisez l'algorithme <tt>cbq</tt>.
        </ul>
<li><tt><i>queue_list</i></tt> - une liste de queues enfant &agrave
    créer sous cette queue. Une <tt><i>queue_list</i></tt> ne peut être
    définie que lorsque l'on utilise l'algorithme <tt>cbq</tt>.
</ul>

<p>
Suite de l'exemple ci-dessus :
<blockquote>
<tt>
queue std bandwidth 50% cbq(default)<br>
queue ssh bandwidth 25% { ssh_login, ssh_bulk }<br>
&nbsp;&nbsp;queue ssh_login bandwidth 25% priority 4 cbq(ecn)<br>
&nbsp;&nbsp;queue ssh_bulk  bandwidth 75% cbq(ecn)<br>
queue ftp bandwidth 500Kb priority 3 cbq(borrow red)<br>
</tt>
</blockquote>

<p>
Ici, les paramètres des queues enfant définies précédemment sont
définis. La queue <tt>std</tt> se voit attribuer une bande passante
correspondant à 50% de celle de la queue "root" (1 Mbps) et est définie
comme queue par défaut. La queue <tt>ssh</tt> se voit assigner 25% de la bande
passante de la queue racine (500kb) et contient également deux autres queues,
<tt>ssh_login</tt> et <tt>ssh_bulk</tt>. La queue <tt>ssh_login</tt> a
une priorité plus élevée que <tt>ssh_bulk</tt> et les deux ont ECN
activé. La queue <tt>ftp</tt> obtient une bande passante de 500Kbps et
obtient une priorité de 3. Elle peut aussi emprunter de la bande
passante quand une quantité supplémentaire est disponible et RED est
activé.

<p>
<b>REMARQUE :</b> Chaque définition de queue enfant a sa bande passante
spécifiée.
Sans spécifier la bande passante, PF donnera 100% de la bande passante
de la queue parente.
Dans cette situation, ceci causera une erreur lors du chargement des
règles sauf s'il y a une queue avec 100% de la bande passante, aucune
autre queue ne peut être déclarée à ce niveau, car il n'y a plus de
bande passante à allouer.

<a name="assign"></a>
<h3>Assignation du Trafic à une Queue</h3>
<p>
Pour assigner du trafic à une queue, le mot-clé <tt>queue</tt> est
utilisé en conjonction avec les <a href="filter.html">règles de
filtrage</a> de PF. Par exemple, considérons un jeu de règles de
filtrage contenant une ligne comme :
<blockquote>
<tt>pass out on fxp0 proto tcp to port 22</tt>
</blockquote>

<p>
Les paquets répondant à cette règle peuvent être assignés à une queue
spécifique en utilisant le mot-clé <tt>queue</tt> :
<blockquote>
<tt>pass out on fxp0 proto tcp to port 22 queue ssh</tt>
</blockquote>

<p>
Quand une entrée est crée dans la table d'état par cette règle, PF
enregistre la queue dans la table d'état; cela sera utilisé par les autres
paquets permis par cette entrée :
<blockquote>
<tt>pass in on fxp0 proto tcp to port 80 queue http</tt>
</blockquote>
Avec cette règle, les paquets traversant en retour <tt>fxp0</tt> qui
s'applique à une connexion active arrivera dans la queue <tt>http</tt>.
Il faut remarquer que même si le mot-clé <tt>queue</tt> est utilisé sur une
règle de filtrage sur un trafic entrant, le but est de spécifier une queue
pour le trafic sortant correspondant; la règle précedente ne mise pas en
"queue" le trafic entrant.

<p>
Lorsque l'on utilise le mot-clé <tt>queue</tt> avec les directives
<tt>block</tt>, les paquets TCP RST ou ICMP Unreachable résultants sont
assignés dans la queue spécifiée.

<p>
Notez que la désignation des queues est possible sur une interface
différente de celle définie dans la directive <tt>altq on</tt> :
<blockquote>
<tt> 
altq on fxp0 cbq bandwidth 2Mb queue { std, ftp }<br>
queue std bandwidth 500Kb cbq(default)<br>
queue ftp bandwidth 1.5Mb<br>
<br>
pass in on dc0 proto tcp to port 21 queue ftp<br>
</tt>
</blockquote>

<p>
La Mise en queue est activée sur <tt>fxp0</tt> mais la désignation
concerne <tt>dc0</tt>.
Si les paquets répondant à la règle <tt>pass</tt> (ou l'état crée par cette
règle) sortent de l'interface <tt>fxp0</tt>, ils seront mis en queue dans
<tt>ftp</tt>. 
Ce type de mise en queue peut être très pratique sur les routeurs.

<p>
Normalement, un seul nom de queue est donné avec le mot-clé
<tt>queue</tt>, mais si un deuxième nom est spécifié cette queue sera
utilisée pour les paquets avec un
<a href="http://www.rfc-editor.org/rfc/rfc791.txt">Type de Service (ToS)</a>
"low-delay" et pour les paquets TCP ACK sans donnée. Un bon exemple de
ceci est l'utilisation de SSH. Les connexions de sessions SSH mettent le
ToS en "low-delay" contrairement aux sessions SCP et SFTP. PF peut
utiliser cette information pour mettre les paquets correspondant à une
connexion dans une queue différente que celles pour les connexions sans
ouverture de session. Ceci peut être utile pour donner la priorité aux
connexions avec ouverture de session sur les paquets de transfert de
fichiers.
<blockquote>
<tt>pass out on fxp0 from any to any port 22 queue(ssh_bulk, ssh_login)</tt>
</blockquote>

<p>
Ceci assigne les paquets correspondant aux connexions d'ouverture de
session SSH à la queue <tt>ssh_login</tt> et les paquets correspondant
aux connexions SCP et SFTP dans la queue <tt>ssh_bulk</tt>. Les
connexions d'ouverture de session auront leurs paquets traités avant
ceux des connexions SCP et SFTP car la queue <tt>ssh_login</tt> a une
priorité plus élevée.

<p>
L'assignation des paquets TCP ACK à une queue ayant une priorité élevée
est utile pour les connexions asymétriques, c'est à dire les connexions
qui ont des bandes passantes différentes en envoi et en réception, comme
les lignes ADSL. Avec une ligne ADSL, si le canal d'envoi est utilisé à
son maximum et si un téléchargement est lancé, le téléchargement en
souffrira car les paquets TCP ACK devant être envoyés seront
congestionnés quand ils essaieront de traverser le canal d'envoi. Des
tests ont montré que pour réaliser les meilleurs résultats, la bande
passante de la queue d'envoi doit être inférieure à la capacité
maximale. Par exemple, si une ligne ADSL a un envoi maximum de 640Kbps,
le fait de régler la <tt>bande passante</tt> de la queue "root" sur une
valeur comme 600Kb entraînera de meilleures performances. C'est après
des essais et des erreurs que vous obtiendrez les meilleurs réglages de
<tt>bande passante</tt>.

<a name="example1"></a>
<h2>Exemple #1 : Réseau domestique</h2>
<pre>
  
    [ Alice ]    [ Charlie ]
        |             |                              ADSL
     ---+-----+-------+------ dc0 [ OpenBSD ] fxp0 -------- ( Internet )
              |
           [ Bob ]

</pre>

<p>
Dans cet exemple, OpenBSD est utilisé sur une passerelle Internet pour
un petit réseau à domicile avec trois stations de travail. La passerelle
réalise le filtrage de paquets et la NAT. La connexion Internet via une
ligne ADSL possède une bande passante descendante de 2MBps et montante
de 640Kbps.

<p>
La politique de mise en queue pour ce réseau :
<ul>
<li>Réserver une bande passante de 80Kbps en téléchargement pour Bob
    afin qu'il puisse jouer aux jeux en ligne sans être ralenti par les
    téléchargements d'Alice et de Charlie. Autoriser Bob à utiliser plus
    de 80Kbps quand ceci est possible.
<li>Le trafic généré par le SSH interactif et la messagerie instantanée
    aura une plus haute priorité que le trafic régulier.
<li>Les requêtes et les réponses DNS auront la seconde plus haute
    priorité.
<li>Les paquets TCP ACK sortants auront une priorité plus haute que tout
    autre trafic sortant.
</ul>

<p>
Le jeu de règles ci-dessous permet cette politique réseau. Notez que
seules les directives de <tt>pf.conf</tt> qui concernent directement la
politique ci-dessus sont présentes.

<p>
<table border=0 width="650">
<tr><td nowrap bgcolor="#EEEEEE">
<pre>
# active la mise en queue sur l'interface externe pour contrôler 
# le trafic allant sur Internet. utilise l'algorithme priq pour 
# contrôler uniquement les priorités. 
# fixe la bande passante à 610Kbps pour avoir les meilleures
# performances à la sortie de la queue TCP ACK.

altq on fxp0 priq bandwidth 610Kb queue { std_out, ssh_im_out, dns_out, \
        tcp_ack_out }

# définit les paramètres pour les queues enfant.
# std_out      - la queue standard. toute règle de filtrage ci-dessous 
#                qui ne spécifie pas explicitement une queue aura
#                son trafic ajouté à cette queue.
# ssh_im_out   - trafic généré par le SSH interactif et
#                la messagerie instantanée
#                variés.
# dns_out      - requêtes DNS.
# tcp_ack_out  - paquets TCP ACK sans donnée.

queue std_out     priq(default)
queue ssh_im_out  priority 4 priq(red)
queue dns_out     priority 5
queue tcp_ack_out priority 6

# active la mise en queue sur l'interface interne en vue de contrôler
# le trafic provenant d'Internet. utilise l'algorithme cbq pour
# contrôler la bande passante. la bande passante maximale est de
# 2Mbps.

altq on dc0 cbq bandwidth 2Mb queue { std_in, ssh_im_in, dns_in, bob_in }

# définit les paramètres pour les queues enfant.
# std_in      - la queue standard. toute règle de filtrage ci-dessous 
#               qui ne spécifie pas explicitement une queue aura
#               son trafic ajouté à cette queue.
# ssh_im_in   - trafic généré par le SSH interactif et
#               par la messagerie instantanée.
# dns_in      - réponses DNS.
# bob_in      - bande passante réservée à la station
#               de travail de Bob. l'autorise à emprunter.

queue std_in    bandwidth 1.6Mb cbq(default)
queue ssh_im_in bandwidth 200Kb priority 4
queue dns_in    bandwidth 120Kb priority 5
queue bob_in    bandwidth 80Kb cbq(borrow)


# ... dans la section filtrage de pf.conf ...

alice         = "192.168.0.2"
bob           = "192.168.0.3"
charlie       = "192.168.0.4"
local_net     = "192.168.0.0/24"
ssh_ports     = "{ 22 2022 }"
im_ports      = "{ 1863 5190 5222 }"

# règles de filtrage pour l'entrée en fxp0
block in on fxp0 all

# règles de filtrage pour la sortie en fxp0
block out on fxp0 all
pass  out on fxp0 inet proto tcp from (fxp0) queue(std_out, tcp_ack_out)
pass  out on fxp0 inet proto { udp icmp } from (fxp0)
pass  out on fxp0 inet proto { tcp udp } from (fxp0) to port domain \
	queue dns_out
pass  out on fxp0 inet proto tcp from (fxp0) to port $ssh_ports \
	queue(std_out, ssh_im_out)
pass  out on fxp0 inet proto tcp from (fxp0) to port $im_ports \
	queue(ssh_im_out, tcp_ack_out)

# règles de filtrage pour l'entrée en dc0
block in on dc0 all
pass  in on dc0 from $local_net

# règles de filtrage pour la sortie en dc0
block out on dc0 all
pass  out on dc0 to $local_net
pass  out on dc0 proto { tcp udp } from port domain to $local_net \
 	queue dns_in
pass  out on dc0 proto tcp from port $ssh_ports to $local_net \
 	queue(std_in, ssh_im_in)
pass  out on dc0 proto tcp from port $im_ports to $local_net \
 	queue ssh_im_in
pass  out on dc0 to $bob queue bob_in 	 	
</pre>
</td></tr>
</table>

<a name="example2"></a>
<h2>Exemple #2 : Réseau d'entreprise</h2>
<pre>

  ( IT Dept )  [ Boss's PC ]
       |          |                                   T1
     --+----+-----+---------- dc0 [ OpenBSD ] fxp0 -------- ( Internet )
            |                         fxp1
         [ COMP1 ]    [ WWW ]         /
                         |           / 
                       --+----------' 

</pre>

<p>
Dans cet exemple, l'hôte OpenBSD agit en pare-feu pour le réseau d'une
entreprise. L'entreprise utilise un serveur WWW dans la partie DMZ de
son réseau où les clients envoient leurs sites via FTP. Le département
IT a son propre sous-réseau connecté au réseau principal, et le
directeur a un PC sur son bureau utilisé pour les emails et le surf sur
Internet. La connexion à Internet se fait via une ligne T1 avec une
bande passante de 1.5Mbps dans les deux directions. Tous les autres
segments du réseau utilisent Fast Ethernet (100Mbps).

<p>
L'administrateur réseau a décidé de la politique suivante :
<ul>
<li>Limiter tout le trafic entre le serveur WWW et Internet à 500Kbps dans
chaque direction
	<ul>
	<li>Réserver 250Kbps pour le trafic HTTP.
	<li>Réserver 250Kbps pour le reste (trafic non-HTTP, etc...)
	<li>Permettre autrement de pouvoir emprunter dans les 500Kbps.
	<li>Donner au trafic HTTP entre le serveur WWW et Internet une
		 priorité plus élevée que les autres trafics entre le serveur WWW
		 et Internet (comme les envois FTP).
	</ul>
<li>Le trafic entre le serveur WWW et le réseau interne peut utiliser
	 davantage que les 100Mbps offerts par le réseau.
<li>Réserver 500Kbps pour le réseau du département IT pour qu'ils
    puissent télécharger les dernières mises à jour de logiciels de
    façon rapide. Ils devront pouvoir utiliser plus de 500Kbps quand de
    la bande passante additionnelle sera disponible.
<li>Donner une priorité plus élevée au trafic entre le PC du directeur
    et Internet que tout autre trafic allant ou venant d'Internet.
</ul>

<p>
Le jeu de règles ci-dessous permet cette politique réseau. Notez que
seul les directives de <tt>pf.conf</tt> qui concernent directement la
politique ci-dessus sont présentes;
<a href="nat.html"><tt>nat</tt></a>,
<a href="rdr.html"><tt>rdr</tt></a>, <a href="options.html">options</a>,
etc... ne sont pas montrées.

<p>
<table border=0 width="650">
<tr><td nowrap bgcolor="#EEEEEE">
<pre>
# active la mise en queue sur l'interface externe pour les paquets sortant sur
# Internet. utilise l'algorithme cbq, afin que la bande passante de chaque
# queue puisse être contrôlée. la bande passante sortante
# maximale est de 1.5Mbps.

altq on fxp0 cbq bandwidth 1.5Mb queue { std_ext, www_ext, boss_ext }

# définit les paramètres pour les queues enfant.
# std_ext        - la queue standard. également queue par défaut 
#                  pour le trafic sortant sur fxp0.
# www_ext        - queue contenant les queues du serveur WWW. limitée à
#                  500Kbps.
#   www_ext_http - trafic http du serveur WWW; plus haute priorité.
#   www_ext_misc - tout le trafic non-http du serveur WWW.
# boss_ext       - trafic venant de l'ordinateur du patron.

queue std_ext        bandwidth 500Kb cbq(default borrow)
queue www_ext        bandwidth 500Kb { www_ext_http, www_ext_misc }
  queue www_ext_http bandwidth 50% priority 3 cbq(red borrow)
  queue www_ext_misc bandwidth 50% priority 1 cbq(borrow)
queue boss_ext       bandwidth 500Kb priority 3 cbq(borrow)

# active la mise en queue sur l'interface interne pour contrôler le trafic
# venant d'Internet ou de la DMZ. utilise l'algorithme cbq pour contrôler
# la bande passante de chaque queue. la bande passante sur cette interface
# est fixée au maximum. le trafic venant de la DMZ sera en mesure
# d'utiliser la totalité de cette bande passante alors que le trafic
# venant de l'Internet sera limité à 1.0Mbps (car 0.5Mbps
# (500Kbps) sont alloués à fxp1).

altq on dc0 cbq bandwidth 100% queue { net_int, www_int }

# définit les paramètres pour les queues enfant.
# net_int    - queue contenant le trafic provenant de Internet. la bande
#              passante est de 1.0Mbps.
#   std_int  - la queue standard. également queue par défaut pour
#              le trafic sortant en dc0.
#   it_int   - trafic vers le réseau du département informatique;
#					réserver 500Kbps.
#   boss_int - trafic vers le PC du patron; assigner la plus haute
#   				priorité.
# www_int    - trafic du serveur WWW de la DMZ; vitesse maximale.

queue net_int    bandwidth 1.0Mb { std_int, it_int, boss_int }
  queue std_int  bandwidth 250Kb cbq(default borrow)
  queue it_int   bandwidth 500Kb cbq(borrow)
  queue boss_int bandwidth 250Kb priority 3 cbq(borrow)
queue www_int    bandwidth 99Mb cbq(red borrow)

# active la mise en queue sur l'interface de la DMZ pour contrôler
# le trafic destiné au serveur WWW. cbq sera utilisé
# sur cette interface tant que le contrôle détaillé de la bande
# passante sera nécessaire. la bande passante sur cette interface
# est fixée au maximum. le trafic provenant du réseau
# interne sera en mesure d'utiliser la totalité de la bande passante
# alors que le trafic provenant d'Internet sera limité à 500Kbps.

altq on fxp1 cbq bandwidth 100% queue { internal_dmz, net_dmz }

# définit les paramètres pour les queues enfant.
# internal_dmz   - trafic provenant du réseau interne.
# net_dmz        - queue contenant le trafic provenant de Internet.
#   net_dmz_http - trafic http; plus haute priorité.
#   net_dmz_misc - tout autre trafic. c'est aussi la queue par défaut.

queue internal_dmz   bandwidth 99Mb cbq(borrow)
queue net_dmz        bandwidth 500Kb { net_dmz_http, net_dmz_misc }
  queue net_dmz_http bandwidth 50% priority 3 cbq(red borrow)
  queue net_dmz_misc bandwidth 50% priority 1 cbq(default borrow)


# ... dans la section filtrage du pf.conf ...

main_net  = "192.168.0.0/24"
it_net    = "192.168.1.0/24"
int_nets  = "{ 192.168.0.0/24, 192.168.1.0/24 }"
dmz_net   = "10.0.0.0/24"

boss      = "192.168.0.200"
wwwserv   = "10.0.0.100"

# refus par défaut
block on { fxp0, fxp1, dc0 } all

# règles de filtrage pour l'entrée de fxp0
pass in on fxp0 proto tcp from any to $wwwserv port { 21, \
	&gt; 49151 } queue www_ext_misc
pass in on fxp0 proto tcp from any to $wwwserv port 80 queue www_ext_http

# règles de filtrage pour la sortie de fxp0
pass out on fxp0 from $int_nets
pass out on fxp0 from $boss queue boss_ext

# règles de filtrage pour l'entrée de dc0
pass in on dc0 from $int_nets
pass in on dc0 from $it_net queue it_int
pass in on dc0 from $boss queue boss_int
pass in on dc0 proto tcp from $int_nets to $wwwserv port { 21, 80, \
        &gt; 49151 } queue www_int

# règles de filtrage pour la sortie de dc0
pass out on dc0 from dc0 to $int_nets

# règles de filtrage pour l'entrée de fxp1
pass in on fxp1 proto { tcp, udp } from $wwwserv to port 53

# règles de filtrages pour la sortie de fxp1
pass out on fxp1 proto tcp to $wwwserv port { 21, \
	&gt; 49151 } queue net_dmz_misc
pass out on fxp1 proto tcp to $wwwserv port 80 queue net_dmz_http
pass out on fxp1 proto tcp from $int_nets to $wwwserv port { 80, \
        21, &gt; 49151 } queue internal_dmz
</pre>
</td></tr>
</table>

<p>
[<a href="anchors.html">Précédent : Ancres</a>]
[<a href="index.html">Index</a>]
[<a href="pools.html">Suivant : Ensembles d'adresses (&quot;Pools&quot;) et
Partage de Charge</a>]

<p>
<hr>
<a href="index.html"><img height="24" width="24" src="../../../images/back.gif" border="0" alt="[back]"></a> 
<a href="mailto:www@@openbsd.org">www@@openbsd.org</a>
<br>
<small>
<!--
Originally [OpenBSD: queueing.html,v 1.46 ]<br>
$Translation: queueing.html,v 1.37 2013/11/01 17:02:17 rustybsd Exp $<br>
-->
$OpenBSD: queueing.html,v 1.31 2013/11/01 18:04:05 ajacoutot Exp $
</small>

</body>
</html> 
@


1.31
log
@Sync with Steelix CVS
@
text
@d948 1
a948 1
$OpenBSD$
@


1.30
log
@Sync with Steelix CVS
@
text
@d376 1
a376 1
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=pf.conf&amp;sektion=5&amp;manpath=OpenBSD+5.3"
d945 2
a946 2
Originally [OpenBSD: queueing.html,v 1.45 ]<br>
$Translation: queueing.html,v 1.36 2013/05/07 08:34:48 rustybsd Exp $<br>
@


1.29
log
@Sync with Steelix CVS
@
text
@d376 1
a376 1
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=pf.conf&amp;sektion=5&amp;manpath=OpenBSD+5.2"
d945 2
a946 2
Originally [OpenBSD: queueing.html,v 1.44 ]<br>
$Translation: queueing.html,v 1.35 2012/11/01 19:46:21 rustybsd Exp $<br>
@


1.28
log
@Sync with Steelix CVS
@
text
@d376 1
a376 1
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=pf.conf&amp;sektion=5&amp;manpath=OpenBSD+5.1"
d556 1
a556 1
pour le trafic sortant correspondant; la règle précedente ne mise pas en 
d581 1
a581 1
règle) sortent de l'interface <tt>fxp0</tt>, ils seront mis en queue dans 
d816 2
a817 2
# active la mise en queue sur l'interface externe pour les paquets sortant sur 
# Internet. utilise l'algorithme cbq, afin que la bande passante de chaque 
d945 2
a946 2
Originally [OpenBSD: queueing.html,v 1.43 ]<br>
$Translation: queueing.html,v 1.34 2012/05/17 14:16:54 rustybsd Exp $<br>
@


1.27
log
@Sync with Steelix CVS
@
text
@d554 1
a554 1
Il faut remarquer que même si le mot clé <tt>queue</tt> est utilisé sur une
d946 1
a946 1
$Translation: queueing.html,v 1.33 2012/05/11 18:32:19 rustybsd Exp $<br>
@


1.26
log
@Sync with Steelix CVS
@
text
@d376 1
a376 1
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=pf.conf&amp;sektion=5&amp;manpath=OpenBSD+5.0"
d945 2
a946 2
Originally [OpenBSD: queueing.html,v 1.42 ]<br>
$Translation: queueing.html,v 1.32 2011/11/05 09:29:00 benoit Exp $<br>
@


1.25
log
@Sync with Steelix CVS
@
text
@d376 1
a376 1
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=pf.conf&amp;sektion=5&amp;manpath=OpenBSD+4.9"
d945 2
a946 2
Originally [OpenBSD: queueing.html,v 1.41 ]<br>
$Translation: queueing.html,v 1.31 2011/05/07 07:02:59 benoit Exp $<br>
@


1.24
log
@Sync with Steelix CVS
@
text
@d376 1
a376 1
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=pf.conf&amp;sektion=5&amp;manpath=OpenBSD+4.8"
d945 2
a946 2
Originally [OpenBSD: queueing.html,v 1.40 ]<br>
$Translation: queueing.html,v 1.30 2010/11/06 14:41:18 benoit Exp $<br>
@


1.23
log
@Sync with Steelix CVS
@
text
@d376 1
a376 1
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=pf.conf&amp;sektion=5&amp;manpath=OpenBSD+4.7"
d945 2
a946 2
Originally [OpenBSD: queueing.html,v 1.39 ]<br>
$Translation: queueing.html,v 1.29 2010/09/25 14:18:06 benoit Exp $<br>
@


1.22
log
@Sync with Steelix CVS
@
text
@d376 1
a376 1
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=pf.conf&amp;sektion=5&amp;manpath=OpenBSD+4.6"
d535 1
a535 1
<tt>pass out on fxp0 from any to any port 22</tt>
d542 1
a542 1
<tt>pass out on fxp0 from any to any port 22 queue ssh</tt>
d546 14
d573 1
a573 1
pass in on dc0 from any to any port 21 queue ftp<br>
d580 4
a583 3
Si les paquets répondant à la règle <tt>pass</tt> sortent de l'interface
<tt>fxp0</tt>, ils seront mis en queue dans <tt>ftp</tt>. Ce type de
mise en queue peut être très pratique sur les routeurs.
a625 18
<p>
Quand on utilise le mot-clé <tt>queue</tt> avec des règles qui
<tt>gardent l'état</tt> comme :
<blockquote>
<tt>
pass in on fxp0 proto tcp from any to any port 22 flags S/SA \<br>
&nbsp;&nbsp;&nbsp;keep state queue ssh
</tt>
</blockquote>

<p>
PF enregistrera la queue dans la table d'états ce qui entraînera que les
paquets traversant <tt>fxp0</tt> au retour et répondant à la connexion
"stateful" termineront dans la queue <tt>ssh</tt>. Notez que même si le mot-clé
<tt>queue</tt> est utilisé dans une règle filtrant le trafic entrant, le
but est de spécifier une queue pour le trafic sortant correspondant; la
règle ci-dessus ne mettra pas en queue les paquets entrants.

d663 1
a663 4
politique ci-dessus sont présentes;
<a href="nat.html"><tt>nat</tt></a>,
<a href="rdr.html"><tt>rdr</tt></a>, <a href="options.html">options</a>,
etc... ne sont pas montrées.
d730 8
a737 9
pass  out on fxp0 inet proto tcp from (fxp0) to any flags S/SA \
        keep state queue(std_out, tcp_ack_out)
pass  out on fxp0 inet proto { udp icmp } from (fxp0) to any keep state
pass  out on fxp0 inet proto { tcp udp } from (fxp0) to any port domain \
        keep state queue dns_out
pass  out on fxp0 inet proto tcp from (fxp0) to any port $ssh_ports \
        flags S/SA keep state queue(std_out, ssh_im_out)
pass  out on fxp0 inet proto tcp from (fxp0) to any port $im_ports \
        flags S/SA keep state queue(ssh_im_out, tcp_ack_out)
d745 8
a752 8
pass  out on dc0 from any to $local_net
pass  out on dc0 proto { tcp udp } from any port domain to $local_net \
        queue dns_in
pass  out on dc0 proto tcp from any port $ssh_ports to $local_net \
        queue(std_in, ssh_im_in)
pass  out on dc0 proto tcp from any port $im_ports to $local_net \
        queue ssh_im_in
pass  out on dc0 from any to $bob queue bob_in
d902 2
a903 3
        &gt; 49151 } flags S/SA keep state queue www_ext_misc
pass in on fxp0 proto tcp from any to $wwwserv port 80 \
        flags S/SA keep state queue www_ext_http
d906 2
a907 2
pass out on fxp0 from $int_nets to any keep state
pass out on fxp0 from $boss to any keep state queue boss_ext
d910 3
a912 3
pass in on dc0 from $int_nets to any keep state
pass in on dc0 from $it_net to any queue it_int
pass in on dc0 from $boss to any queue boss_int
d914 1
a914 1
        &gt; 49151 } flags S/SA keep state queue www_int
d920 1
a920 2
pass in on fxp1 proto { tcp, udp } from $wwwserv to any port 53 \
        keep state
d923 3
a925 4
pass out on fxp1 proto tcp from any to $wwwserv port { 21, \
        &gt; 49151 } flags S/SA keep state queue net_dmz_misc
pass out on fxp1 proto tcp from any to $wwwserv port 80 \
        flags S/SA keep state queue net_dmz_http
d927 1
a927 1
        21, &gt; 49151 } flags S/SA keep state queue internal_dmz
d945 2
a946 2
Originally [OpenBSD: queueing.html,v 1.38 ]<br>
$Translation: queueing.html,v 1.28 2009/10/19 15:48:30 benoit Exp $<br>
@


1.21
log
@Sync with Steelix CVS
@
text
@d376 1
a376 1
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=pf.conf&amp;sektion=5&amp;manpath=OpenBSD+4.5"
d955 2
a956 2
Originally [OpenBSD: queueing.html,v 1.37 ]<br>
$Translation: queueing.html,v 1.27 2009/04/30 22:46:58 benoit Exp $<br>
@


1.20
log
@Sync with Steelix CVS
@
text
@d376 1
a376 1
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=pf.conf&amp;sektion=5&amp;manpath=OpenBSD+4.4"
d955 2
a956 2
Originally [OpenBSD: queueing.html,v 1.36 ]<br>
$Translation: queueing.html,v 1.26 2009/01/25 20:10:53 benoit Exp $<br>
@


1.19
log
@Sync with Steelix CVS
@
text
@d955 2
a956 2
Originally [OpenBSD: queueing.html,v 1.35 ]<br>
$Translation: queueing.html,v 1.25 2008/11/26 22:39:39 benoit Exp $<br>
@


1.18
log
@Sync with Steelix CVS
@
text
@d376 1
a376 1
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=pf.conf&amp;sektion=5&amp;manpath=OpenBSD+4.3"
d955 2
a956 2
Originally [OpenBSD: queueing.html,v 1.34 ]<br>
$Translation: queueing.html,v 1.24 2008/08/20 15:32:01 gapz Exp $<br>
@


1.17
log
@Sync with Steelix CVS
@
text
@d376 1
a376 1
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=pf.conf&amp;sektion=5&amp;manpath=OpenBSD+4.2"
d955 2
a956 2
Originally [OpenBSD: queueing.html,v 1.33 ]<br>
$Translation: queueing.html,v 1.23 2008/01/11 10:52:48 saad Exp $<br>
@


1.16
log
@Sync with steelix translation CVS
@
text
@d83 1
a83 1
se passe t'il si le routeur manipulant ces connexions traite un grand
d89 1
a89 1
mise en queue utilisée, la bande bassante du réseau peut être partagée
d127 1
a127 1
protocol, etc... Une queue peut optionnellement être configurée pour
d216 1
a216 1
elevée sont préferées aux queues avec une priorité inférieure pendant
d236 1
a236 1
"round-robin" -- aucune queue ne sera préferée à une autre. Pendant le
d239 1
a239 1
élevée et aura un traitement préferentiel vis à vis de la queue
d253 1
a253 1
réseau et chaque queue posséde une priorité. Une queue avec une priorité
d305 1
a305 1
paquets, RED choisi aléatoirement la connexion pour laquelle il va
d312 1
a312 1
synchronisation globale se référe à une perte totale des données
d339 1
a339 1
Pour une regard plus détaillé sur la théorie derrière RED, veuillez
d350 1
a350 1
principe que l'hôte expediteur supporte ECN, il pourra lire ce drapeau
d376 1
a376 1
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=pf.conf&amp;sektion=5&amp;manpath=OpenBSD+4.1"
d789 1
a789 1
L'administrateur réseau a decidé de la politique suivante :
d955 2
a956 2
Originally [OpenBSD: queueing.html,v 1.32 ]<br>
$Translation: queueing.html,v 1.21 2007/05/07 09:38:20 ajacoutot Exp $<br>
@


1.15
log
@sync with steelix translation CVS
@
text
@d253 5
a257 3
réseau et chaque queue posséde une priorité distincte. Une queue avec
une priorité plus élevée est <i>toujours</i> traitée avant une queue
avec une priorité moindre.
d376 1
a376 1
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=pf.conf&amp;sektion=5&amp;manpath=OpenBSD+4.0"
d955 2
a956 2
Originally [OpenBSD: queueing.html,v 1.30 ]<br>
$Translation: queueing.html,v 1.20 2007/02/11 17:10:10 benoit Exp $<br>
@


1.14
log
@Sync with Steelix CVS
@
text
@d76 2
a77 2
système d'exploitation selectionne les paquets à traiter peut affecter
les performances du réseau. Par exemple, immaginez un utilisateur
d87 1
a87 1
pour acceuillir tous les paquets) et la session SSH apparaitra
d115 1
a115 1
OpenBSD supporte deux algorithmes additionels :
d127 2
a128 2
protocol, etc. Une queue peut optionnellement être configurée pour
emprunter de la bande passante aux queues parent si celles-ci sont sous-
d189 2
a190 3
queues parent si ces dernières en ont en excès suite à la non-
utilisation par d'autres queues enfant. Considérez le réglage de mise en
queue suivant :
d305 1
a305 1
passante sont une plus grande probabilité de voir leurs paquets rejetés.
d310 1
a310 1
synchronisation globale se réferre à une perte totale des données
d334 1
a334 1
trafic TCP et non UDP ou ICMP trafic.
d380 1
a380 1
    définit l'algorithme à utiliser, et créée la queue "root"
d424 1
a424 1
: <tt>std</tt>, <tt>ssh</tt>, et <tt>ftp</tt>.
d455 1
a455 1
	 utilisé.
d508 1
a508 1
<tt>ssh_login</tt> et <tt>ssh_bulk</tt>. La queue, <tt>ssh_login</tt> a
d663 1
a663 1
seul les directives de <tt>pf.conf</tt> qui concernent directement la
d667 1
a667 1
etc., ne sont pas montrées.
d777 1
a777 1
Dans cet exemple, l' hôte OpenBSD agit en firewall pour le réseau d'une
d789 2
a790 1
<li>Limiter tout le trafic entre le serveur WWW et Internet à 500Kbps in
d793 1
a793 1
	<li>Réserver 250Kbps pour le reste (trafic non-HTTP etc.)
d799 1
a799 1
<li>Le trafic entre le serveur WWW et le érseau interne peut utiliser
d815 1
a815 1
etc., ne sont pas montrées.
d902 1
a902 1
# refut par défaut
d954 1
a954 1
$Translation: queueing.html,v 1.19 2007/01/05 10:38:39 ajacoutot Exp $<br>
@


1.13
log
@sync with steelix translation CVS
@
text
@d8 1
a8 1
<meta name="description"   content=" page de la FAQ OpenBSD">
d954 1
a954 1
$Translation: queueing.html,v 1.18 2006/11/02 08:49:04 ajacoutot Exp $<br>
@


1.12
log
@sync with steelix translation CVS
@
text
@d375 1
a375 1
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=pf.conf&amp;sektion=5&amp;manpath=OpenBSD+3.9"
d953 2
a954 2
Originally [OpenBSD: queueing.html,v 1.29 ]<br>
$Translation: queueing.html,v 1.17 2006/05/02 10:12:39 ajacoutot Exp $<br>
@


1.11
log
@sync with Steelix CVS
@
text
@d375 1
a375 1
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=pf.conf&amp;sektion=5&amp;manpath=OpenBSD+3.8"
d953 2
a954 2
Originally [OpenBSD: queueing.html,v 1.28 ]<br>
$Translation: queueing.html,v 1.16 2006/03/09 14:46:29 ajacoutot Exp $<br>
@


1.10
log
@sync with Steelix CVS
@
text
@d34 1
a34 1
<a href="../../fr/index.html">
d117 2
a118 2
<li>Mise en queue par classes</li>
<li>Mise en queue par priorités</li>
d507 2
a508 3
comme queue par défaut. La queue <tt>ssh</tt> définie deux queues
enfant, <tt>ssh_login</tt et la queue possédant 25% de la bande passante
de la queue racine (500kb) et contient également deux autres queues,
d623 1
a623 1
"stateful" termineront dans la queue "ssh". Notez que même si le mot-clé
a789 2
<li>Limiter le trafic entre le serveur WWW et Internet à 500Kbps dans
    chaque direction.
d954 1
a954 1
$Translation: queueing.html,v 1.15 2005/11/02 19:38:09 aanriot Exp $<br>
@


1.9
log
@sync with Steelix CVS
@
text
@d375 1
a375 1
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=pf.conf&amp;sektion=5&amp;manpath=OpenBSD+3.7"
d956 2
a957 2
Originally [OpenBSD: queueing.html,v 1.27 ]<br>
$Translation: queueing.html,v 1.14 2005/05/21 17:47:54 aanriot Exp $<br>
@


1.8
log
@Sync with Steelix CVS
@
text
@d61 1
a61 1
<li><a href="#example1">Exemple #1 : Réseau SoHo</a>
d375 1
a375 1
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=pf.conf&amp;sektion=5&amp;manpath=OpenBSD+3.6"
d630 1
a630 1
<h2>Exemple #1 : Réseau SoHo</h2>
d956 2
a957 2
Originally [OpenBSD: queueing.html,v 1.26 ]<br>
$Translation: queueing.html,v 1.12 2005/02/25 16:38:59 aanriot Exp $<br>
@


1.7
log
@sync with Steelix CVS
@
text
@d455 2
d496 3
a498 3
queue ssh { ssh_login, ssh_bulk }<br>
&nbsp;&nbsp;queue ssh_login  priority 4 cbq(ecn)<br>
&nbsp;&nbsp;queue ssh_bulk   cbq(ecn)<br>
d508 18
a525 6
enfant, <tt>ssh_login</tt> et <tt>ssh_bulk</tt>. La queue
<tt>ssh_login</tt> a une priorité plus élevée que <tt>ssh_bulk</tt> et
les deux ont ECN activé. La queue <tt>ftp</tt> obtient une bande
passante de 500Kbps et obtient une priorité de 3. Elle peut aussi
emprunter de la bande passante quand une quantité supplémentaire est
disponible et RED est activé.
d556 1
a556 1
queue std cbq(default)<br>
d716 3
a718 3
queue std_in    cbq(default)
queue ssh_im_in priority 4
queue dns_in    priority 5
d793 11
a803 5
<li>Aucune limite de bande passante sur le trafic entre le serveur WWW
    et le réseau interne.
<li>Donner une priorité plus haute au trafic HTTP entre le serveur WWW
    et Internet que tout autre trafic entre le serveur WWW et Internet
    (comme les envois FTP).
d836 3
a838 3
#   www_ext_http - trafic http provenant du serveur WWW
#   www_ext_misc - tout le trafic non-http provenant du serveur WWW
# boss_ext       - trafic venant de l'ordinateur du directeur
d840 1
a840 1
queue std_ext        cbq(default)
d842 3
a844 3
  queue www_ext_http priority 3 cbq(red)
  queue www_ext_misc priority 1
queue boss_ext       priority 3
d861 5
a865 4
#   it_int   - trafic à destination du réseau du
#              département IT.
#   boss_int - trafic à destination du PC du directeur.
# www_int    - trafic provenant du serveur WWW dans la DMZ.
d868 1
a868 1
  queue std_int  cbq(default)
d870 2
a871 2
  queue boss_int priority 3
queue www_int    cbq(red)
d886 2
a887 2
#   net_dmz_http - trafic http.
#   net_dmz_misc - tout trafic autre. c'est aussi la queue par défaut.
d889 1
a889 1
queue internal_dmz      # aucun réglage spécifique requis
d891 2
a892 2
  queue net_dmz_http priority 3 cbq(red)
  queue net_dmz_misc priority 1 cbq(default)
d956 2
a957 2
Originally [OpenBSD: queueing.html,v 1.25 ]<br>
$Translation: queueing.html,v 1.11 2005/02/13 16:52:29 svincent Exp $<br>
@


1.6
log
@Sync with Steelix CVS
@
text
@d14 1
a14 1
Copyright (c) 2003, 2004 Joel Knight <enabled@@myrealbox.com>
d38 3
a40 3
[<a href="anchors.html">Précédent : Ancres et Bases de Règles Nommées (Sub)</a>]
[<a href="index.html">Index</a>]
[<a href="pools.html">Suivant : PF : Ensembles d'adresses (&quot;Pools&quot;) et
d53 6
a58 6
	<ul>
	<li><a href="#cbq">Mise en queue par classes</a>
	<li><a href="#priq">Mise en queue par priorités</a>
	<li><a href="#red">Détection Aléatoire Anticipée</a>
	<li><a href="#ecn">Notification Explicite de Congestion</a>
	</ul>
d923 1
a923 1
[<a href="anchors.html">Précédent : Ancres et Bases de Règles Nommées (Sub)</a>]
d925 1
a925 1
[<a href="pools.html">Suivant : PF : Ensembles d'adresses (&quot;Pools&quot;) et
d935 2
a936 2
Originally [OpenBSD: queueing.html,v 1.24 ]<br>
$Translation: queueing.html,v 1.10 2005/01/17 21:34:48 aanriot Exp $<br>
@


1.5
log
@sync with Steelix CVS
@
text
@d934 1
d936 2
a937 1
$Translation: queueing.html,v 1.9 2004/12/29 10:33:02 saad Exp $<br>
@


1.4
log
@sync with Steelix CVS
@
text
@d34 3
a36 1
<img alt="[OpenBSD]" height=30 width=141 src="../../../images/smalltitle.gif">
d934 2
a935 2
Originally [OpenBSD: queueing.html,v 1.23 ]<br>
$Translation: queueing.html,v 1.7 2004/11/01 00:18:20 saad Exp $<br>
@


1.3
log
@Sync with Steelix CVS
@
text
@d373 1
a373 1
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=pf.conf&amp;sektion=5&amp;manpath=OpenBSD+3.5"
d932 2
a933 2
Originally [OpenBSD: queueing.html,v 1.22 ]<br>
$Translation: queueing.html,v 1.6 2004/10/13 11:53:05 saad Exp $<br>
@


1.2
log
@Sync with Steelix CVS
@
text
@d39 1
d58 1
a58 1
<li><a href="#assign">Assignation du Traffic dans une Queue</a>
d512 1
a512 1
<h3>Assignation du Traffic à une Queue</h3>
d928 1
a928 1
<a href="index.html"><img height="24" width="24" src="../../images/back.gif" border="0" alt="[back]"></a> 
d933 1
a933 1
$Translation: queueing.html,v 1.5 2004/10/11 12:12:43 saad Exp $<br>
@


1.1
log
@Sync with Steelix CVS
@
text
@d36 1
a36 1
[<a href="anchors.html">Précédent : Ancres et Bases de R&egrave;gles Nomm&eacute;es (Sub)</a>]
d46 1
a46 1
<h3>Table des Mati&egrave;res</h3>
d52 2
a53 2
	<li><a href="#priq">Mise en queue par priorit&eacute;s</a>
	<li><a href="#red">D&eacute;tection Al&eacute;atoire Anticip&eacute;e</a>
d58 2
a59 2
<li><a href="#example1">Exemple #1 : Petit R&eacute;seau, R&eacute;seau domestique </a>
<li><a href="#example2">Exemple #2 : R&eacute;seau d'entreprise</a>
d67 32
a98 7
Mettre en queue quelquechose signifie stocker, de mani&egrave;re ordonn&eacute;e, cette chose pendant qu'elle attend un traitement. Dans un r&eacute;seau informatique,	quand les paquets de donn&eacute;es sont envoy&eacute;s &agrave; l'ext&eacute;rieur de l'h&ocirc;te, ils entrent dans une queue ou ils attendent un traitement par le syst&egrave;me d'exploitation. Celui-ci decide ensuite quelle queue et quel(s) paquet(s) de cette queue doivent &ecirc;tre trait&eacute;s.
L'ordre dans lequel le syst&egrave;me d'exploitation selectionne les paquets 
&agrave; traiter peut affecter les performances du r&eacute;seau.
Par exemple, immaginez un utilisateur lan&ccedil;ant deux applications r&eacute;seau : SSH et FTP. Id&eacute;alement, les paquets SSH devraient &ecirc;tre trait&eacute;s avant les paquets FTP &agrave; cause de la sensibilit&eacute; au temps de SSH; quand une clef est entr&eacute;e dans le client SSH, une r&eacute;ponse imm&eacute;diate est attendue, mais un transfert FTP retard&eacute; de quelques secondes n'attirera pratiquement pas l'attention. Mais que se passe t'il si le routeur manipulant ces connexions traite un grand nombre de paquets provenant de la connexion FTP avant de traiter la connexion SSH ? Les paquets de la connexion SSH resteront dans la queue (ou seront rejet&eacute;s par le routeur si la queue n'est pas assez grande pour acceuillir tous les paquets) et la session SSH apparaitra certainement comme ralentie ou haletante. En modifiant la strat&eacute;gie de mise en queue utilis&eacute;e, la bande bassante du r&eacute;seau peut être partag&eacute;e de fa&ccedil;on juste entre les diff&eacute;rents applications, utilisateurs et ordinateurs.

<p>
Notez que la mise en queue est utile uniquement pour les paquets sortant ("<i>outbound</i>"). Une fois qu'un paquet arrive sur une interface dans la direction entrante il est d&eacute;j&agrave; trop tard pour le mettre en queue -- la bande passante a d&eacute;j&agrave; &eacute;t&eacute; consomm&eacute;e et l'interface le re&ccedil;oit simplement. La seule solution est d'activer la mise en queue sur un routeur adjacent ou, si l'h&ocirc;te recevant le paquet agit comme un routeur, d'activer la mise en queue sur l'interface interne sur laquelle les paquets quittent le routeur.
d102 8
a109 7
L'algorithme d&eacute;cide des queues &agrave; traiter et dans quel ordre.
Par d&eacute;faut, OpenBSD utilise un algorithme "First In First Out"
(FIFO). Une queue FIFO travaille comme une caisse de supermarch&eacute;
-- le premier article de la queue est le premier trait&eacute;. Au fur
et &agrave; mesure que des nouveaux paquets arrivent, ils sont
ajout&eacute;s &agrave; la queue. Si la queue est pleine - et c'est là
que l'analogie avec la caisse de supermarché s'arrête - les nouveaux paquets sont rejet&eacute;s. Ceci est connu sous le nom de "tail-drop".
d115 1
a115 1
<li>Mise en queue par priorit&eacute;s</li>
d120 17
a136 4
La Mise en queue par classes (CBQ) est un algorithme de mise en queue qui divise la bande passante des multiples connexions r&eacute;seau en queues ou en classes. Chaque queue se voit ainsi assigner un trafic sur les bases d'une adresse source ou de destination, d'un num&eacute;ro de port, d'un protocol, etc. Une queue peut optionnellement être configur&eacute;e pour emprunter de la bande passante aux queues parent si celles-ci sont sous-utilis&eacute;es. Les queues ont aussi une priorit&eacute; selon qu'elles contiennent du trafic interactif, comme SSH, et peuvent avoir leurs paquets trait&eacute;s avant les queues contenant le trafic volumineux, comme FTP.

<p>
Les queues CBQ sont ordonn&eacute;es de mani&egrave;re hi&eacute;rarchique. Au sommet de la hi&eacute;rarchie se trouve la queue "root" qui d&eacute;finit la totalit&eacute; de la bande passante disponible. Les queues enfant sont cr&eacute;es sous la queue "root", chacune d'elle peut se voir assigner une partie de la bande passante de la queue "root". Par exemple, les queues peuvent être d&eacute;finies comme suit :
d140 5
a144 5
	<dl>
	<dd>Queue A (1Mbps)
	<dd>Queue B (500Kbps)
	<dd>Queue C (500Kbps)
	</dl>
d148 3
a150 1
Dans ce cas, la totalit&eacute; de la bande passante est fix&eacute;e &agrave; 2 megabits par seconde (Mbps). Cette bande passante est ensuite subdivis&eacute;e en trois queues enfant.
d153 5
a157 1
La hi&eacute;rarchie peut encore être approfondie en d&eacute;finissant des queues dans les queues. Pour subdiviser &eacute;quitablement la bande passante entre les diff&eacute;rents utilisateurs et aussi classer leur trafic pour &eacute;viter que certains protocoles ne privent de bande passante d'autres protocoles, une structure de mise en queue comme celle-ci peut être d&eacute;finie :
d161 16
a176 16
	<dl>
	<dd>UserA (1Mbps)
		<dl>
		<dd>ssh (50Kbps)
		<dd>bulk (950Kbps)
		</dl>
	<dd>UserB (1Mbps)
		<dl>
		<dd>audio (250Kbps)
		<dd>bulk (750Kbps)
			<dl>
			<dd>http (100Kbps)
			<dd>other (650Kbps)
			</dl>
		</dl>
	</dl>
d180 3
a182 1
Notez qu' &agrave; chaque niveau, la somme des bandes passantes assign&eacute;es &agrave; chaque queue ne doit pas être sup&eacute;rieure &agrave; celle assign&eacute;e &agrave; la queue parent.
d185 4
a188 1
Une queue peut être configur&eacute;e pour emprunter de la bande passante aux queues parent si ces derni&egrave;res en ont en exc&egrave;s suite &agrave; la non-utilisation par d'autres queues enfant. Consid&eacute;rez le r&eacute;glage de mise en queue suivant :
d192 8
a199 8
	<dl>
	<dd>UserA (1Mbps)
		<dl>
		<dd>ssh (100Kbps)
		<dd>ftp (900Kbps, borrow)
		</dl>
	<dd>UserB (1Mbps)
	</dl>
d203 16
a218 4
Si le trafic dans la queue <tt>ftp</tt> exc&egrave;de 900Kbps et le trafic dans la queue <tt>UserA</tt> est inf&eacute;rieur &agrave; 1Mbps (parce que la queue <tt>ssh</tt> utilise moins que les 100Kbps qu'elle dispose), la queue <tt>ftp</tt> empruntera l'exc&egrave;s de bande passante de <tt>UserA</tt>. Dans cette optique la queue <tt>ftp</tt> est en mesure d'utiliser davantage de bande passante que ce qui lui est assign&eacute; quand elle fait face &agrave; une surcharge. Quand la queue <tt>ssh</tt> verra sa charge augmenter, la bande passante emprunt&eacute;e sera restitu&eacute;e.

<p>
CBQ assigne une priorit&eacute; &agrave; chaque queue. Les queues avec une priorit&eacute; elev&eacute;e sont pr&eacute;fer&eacute;es aux queues avec une priorit&eacute; inf&eacute;rieure pendant une congestion tant que les deux queues partagent le même parent (en d'autres termes, tant que les deux queues appartiennent &agrave; une même branche de la hi&eacute;rarchie). Les queues avec une même priorit&eacute; sont trait&eacute;es dans un mode "round-robin". Par exemple :
d222 8
a229 8
	<dl>
	<dd>UserA (1Mbps, priority 1)
		<dl>
		<dd>ssh (100Kbps, priority 5)
		<dd>ftp (900Kbps, priority 3)
		</dl>
	<dd>UserB (1Mbps, priority 1)
	</dl>
d233 9
a241 1
CBQ traitera les queues <tt>UserA</tt> et <tt>UserB</tt> dans un mode "round-robin" -- aucune queue ne sera pr&eacute;fer&eacute;e &agrave; une autre. Pendant le temps ou la queue <tt>UserA</tt> est trait&eacute;e, CBQ traitera aussi les queues enfant. Dans ce cas, la queue <tt>ssh</tt> a une priorit&eacute; plus &eacute;lev&eacute;e et aura un traitement pr&eacute;ferentiel vis &agrave; vis de la queue <tt>ftp</tt> si le r&eacute;seau est congestionn&eacute;. Notez que les queues <tt>ssh</tt> et  <tt>ftp</tt> n'ont pas leurs priorit&eacute;s compar&eacute;es &agrave; celles de <tt>UserA</tt> et <tt>UserB</tt> &agrave; cause du fait qu'elles ne sont pas dans une même branche de la hi&eacute;rarchie.
d244 3
a246 1
Pour un regard plus d&eacute;taill&eacute; sur la th&eacute;orie du fonctionnement de CBQ, consultez s'il vous pla&icirc;t les <a href="http://www.icir.org/floyd/cbq.html">R&eacute;f&eacute;rences sur CBQ</a>.
d249 5
a253 2
<h3>Mise en queue par priorit&eacute;s</h3>
La Mise en queue par priorit&eacute;s (PRIQ) assigne des queues &agrave; une interface r&eacute;seau et chaque queue poss&eacute;de une priorit&eacute; distincte. Une queue avec une priorit&eacute; plus &eacute;lev&eacute;e est <i>toujours</i> trait&eacute;e avant une queue avec une priorit&eacute; moindre.
d256 4
a259 1
La structure des queues de PRIQ est plate -- vous ne pouvez pas d&eacute;finir de queue au sein d'une autre queue. La queue "root" est d&eacute;finie et poss&egrave;de la totalit&eacute; de la bande passante disponible, et les sous-queues sont d&eacute;finies ensuite en aval. Consid&eacute;rez l'exemple suivant :
d262 5
a266 5
	<dl>
	<dd>Queue A (priority 1)
	<dd>Queue B (priority 2)
	<dd>Queue C (priority 3)
	</dl>
d270 16
a285 4
La queue "root" est d&eacute;finie comme ayant 2Mbps de bande passante disponible et trois sous-queues sont d&eacute;finies. La queue avec la plus haute priorit&eacute; (le nombre priorit&eacute; le plus grand) est servie en premier. Une fois que tous les paquets dans cette queue ont &eacute;t&eacute; trait&eacute;s, ou si la queue est vide, PRIQ s'occupe de la queue avec la priorit&eacute; suivante. Au sein d'une queue donn&eacute;e, les paquets sont trait&eacute;s selon la mani&egrave;re "First In First Out" (FIFO).

<p>
Il est important de noter que si vous utilisez PRIQ, vous devez cr&eacute;er vos queues tr&egrave;s prudemment. A cause du fait que PRIQ traite <i>toujours</i> une queue avec une grande priorit&eacute; avant une queue avec une priorit&eacute; basse, il est possible qu'une queue avec une priorit&eacute; &eacute;lev&eacute;e cause la suppression ou la disparition des paquets d'une queue avec une priorit&eacute; basse si la queue avec la priorit&eacute; &eacute;lev&eacute;e reçoit un flux constant de paquets.
d288 45
a332 5
<h3>D&eacute;tection Al&eacute;atoire Anticip&eacute;e</h3>
La D&eacute;tection Al&eacute;atoire Anticip&eacute;e (RED) est un algorithme d'&eacute;vitement des congestions. Sa fonction est d'&eacute;viter les congestions en s'assurant que la queue ne devienne pas pleine. Elle r&eacute;alise cela en calculant en permanence la largeur moyenne (taille) de la queue et en la comparant &agrave; deux valeurs de seuil, un seuil minimum et un seuil maximum. Si la taille moyenne de la queue est au dessous du seuil minimal, aucun paquet n'est rejet&eacute;. Si la moyenne est au dessus du seuil maximum alors <i>tous</i> les nouveaux paquets arrivant sont rejet&eacute;s. Si la moyenne est comprise entre les seuils minimum et maximum les paquets sont rejet&eacute;s suivant une probabilit&eacute; calcul&eacute;e grâce &agrave; la taille de la queue. En d'autres mots, quand l'occupation de la queue approche le seuil maximum, de plus en plus de paquets sont rejet&eacute;s. Quand il rejete des paquets, RED choisi al&eacute;atoirement la connexion pour laquelle il va rejeter les paquets. Les connexions utilisant largement la bande passante sont une plus grande probabilit&eacute; de voir leurs paquets rejet&eacute;s.

<p>
RED est utile car il &eacute;vite la situation connue sous le nom de synchronisation globale et il peut s'adapter &agrave; des bonds du trafic. La synchronisation globale se r&eacute;ferre &agrave; une perte totale des donn&eacute;es sortantes due &agrave; la suppression simultan&eacute;e de paquets de plusieurs connexions. Par exemple, si la congestion apparait sur un routeur supportant le trafic de 10 connexions FTP et tous les paquets de ces connexions sont rejet&eacute;s (comme c'est le cas avec une mise en queue FIFO), la totalit&eacute; du trafic sortant sera rejet&eacute;; brusquement. Ce n'est pas une situation id&eacute;ale car elle entra&icirc;ne une r&eacute;duction du trafic de toutes les connexions FTP ce qui signifie que le r&eacute;seau n'est plus utilis&eacute; avec son potentiel maximum. RED &eacute;vite cela en choisissant al&eacute;atoirement une de ces connexions plut&ocirc;t que de choisir toutes les connexions. Les connexions utilisant une large partie de la bande passante ont une probabilit&eacute; sup&eacute;rieure de voir leurs paquets rejet&eacute;s. Dans cette optique, les connexions avec une haute bande passante seront &eacute;trangl&eacute;es, la congestion sera &eacute;vit&eacute;e, et les pertes violentes de trafic de sortie n'auront pas lieu. De plus, RED est capable de supporter des explosions du trafic car il commence la suppression des paquets <i>avant</i> que la queue ne devienne pleine. Si une explosion du trafic se produit, il y aura assez d'espace pour m&eacute;moriser les nouveaux paquets.
d335 2
a336 4
RED ne devrait être utilis&eacute; que quand le protocole est capable de r&eacute;pondre aux indicateurs de congestion du r&eacute;seau. Dans beaucoup de cas cela signifie que RED devrait être utilis&eacute; pour mettre en queue du trafic TCP et non UDP ou ICMP trafic.

<p>
Pour une regard plus d&eacute;taill&eacute; sur la th&eacute;orie derri&egrave;re RED, s'il vous plait consultez
d341 7
a347 1
La Notification Explicite de Congestion (ECN) travaille en conjonction avec RED pour notifier deux h&ocirc;tes communicant via le r&eacute;seau d'une congestion le long du chemin de communication. Ceci est fait en autorisant RED &agrave; fixer un drapeau dans l'entête du paquet plut&ocirc;t que de rejeter le paquet. Si l'on part du principe que l'h&ocirc;te expediteur supporte ECN, il pourra lire ce drapeau et diminuer son trafic r&eacute;seau en fonction.
d350 1
a350 1
Pour plus d'informations sur ECN, r&eacute;ferrez vous s'il vous pla&icirc;t &agrave; la
d356 7
a362 2
<a href="http://www.csl.sony.co.jp/person/kjc/kjc/software.html#ALTQ"
>Mise en queue altern&eacute;e (ALTQ)</a>, impl&eacute;mentation de la mise en queue, fait partie du syst&egrave;me de base. En commençant avec OpenBSD 3.3 ALTQ a &eacute;t&eacute; int&eacute;gr&eacute;e dans PF. L'impl&eacute;mentation de ALTQ dans OpenBSD supporte les algorithmes de Mise en Queue par classes (CBQ) et de Mise en Queue par priorit&eacute;s (PRIQ). Elle supporte aussi la D&eacute;tection Al&eacute;atoire Anticip&eacute;e (RED) et la Notification de Congestion Explicite (ECN).
d365 3
a367 1
Parce que ALTQ a &eacute;t&eacute; fusionn&eacute;e avec PF, ce dernier doit être activ&eacute; pour que la mise en queue fonctionne. Les instructions sur la proc&eacute;dure d'activation de PF peuvent être trouv&eacute;es dans les
d371 1
a371 1
La Mise en queue est configur&eacute;e dans <tt>
d373 3
a375 1
>pf.conf</a></tt>. Il y a deux types de directives utilis&eacute;es pour configurer la Mise en Queue :
d377 3
a379 2
<li><tt>altq on</tt> - active la mise en queue sur une interface, d&eacute;finit l'algorithme &agrave; utiliser, et cr&eacute;&eacute;e la queue "root"
<li><tt>queue</tt> - d&eacute;finit les propri&eacute;t&eacute;s d'une queue enfant
d393 18
a410 13
<li><tt><i>interface</i></tt> - l'interface r&eacute;seau sur laquelle activer la mise en queue.
<li><tt><i>scheduler</i></tt> - l'algorithme &agrave; utiliser. Les valeurs possibles sont
<tt>cbq</tt> et <tt>priq</tt>. Actuellement, seul un algorithme &agrave; la fois peut être activ&eacute; sur une interface.
<li><tt><i>bw</i></tt> - la quantit&eacute; totale de bande passante disponible pour l'algorithme.
Elle peut être sp&eacute;cifi&eacute;e avec une valeur absolue en utilisant les suffixes <tt>b</tt>,
<tt>Kb</tt>, <tt>Mb</tt>, et <tt>Gb</tt> signifiant bits, kilobits,
megabits, et gigabits par seconde, en valeur ou en pourcentage de la bande passante de l'
<tt><i>interface</i></tt>.
<li><tt><i>qlim</i></tt> - le nombre maximum de paquets &agrave; stocker dans une queue. 
Ce param&egrave;tre est optionnel. Il est par d&eacute;faut de 50.
<li><tt><i>size</i></tt> - la taille du r&eacute;gulateur en octets. Si elle n'est pas sp&eacute;cifi&eacute;e, la taille utilis&eacute;e est bas&eacute;e sur la bande passante de l'
<tt><i>interface</i></tt>.
<li><tt><i>queue_list</i></tt> - une liste de queues enfant &agrave; cr&eacute;er en dessous de la queue "root".
d420 3
a422 2
Ceci active CBQ sur l'interface <tt>fxp0</tt>. La totalit&eacute; de la bande passante disponible est fix&eacute;e &agrave; 2Mbps. Trois queues enfant sont d&eacute;finies : <tt>std</tt>,
<tt>ssh</tt>, et <tt>ftp</tt>.
d436 48
a483 33
<li><tt><i>name</i></tt> - le nom de la queue. Il doit correspondre &agrave;
un des noms de queues d&eacute;finies dans la directive <tt>altq on</tt>
<tt><i>queue_list</i></tt>. Pour <tt>cbq</tt> il peut aussi correspondre au
nom d'une queue dans la directive <tt>queue</tt> pr&eacute;c&eacute;dente
<tt><i>queue_list</i></tt>. Les noms de queue ne doivent pas &ecirc;tre plus longs que 15 caract&egrave;res.
<li><tt><i>interface</i></tt> - l'interface r&eacute;seau pour laquelle la queue est valide. Cette valeur est optionnelle et si elle n'est pas pr&eacute;cis&eacute;e, la queue sera valide pour toutes les interfaces.
<li><tt><i>bw</i></tt> - la quantit&eacute; totale de bande passante disponible pour la queue.
Elle doit &ecirc;tre sp&eacute;cifi&eacute;e avec une valeur absolue en utilisant les suffixes <tt>b</tt>, <tt>Kb</tt>, <tt>Mb</tt>, et <tt>Gb</tt> signifiant bits, kilobits, megabits, et gigabits par seconde, en valeur ou en pourcentage de la bande passante de la queue parent.
Ce param&egrave;tre n'est applicable que lorsque l'on utilise l'algorithme <tt>cbq</tt>.
<li><tt><i>pri</i></tt> - la priorit&eacute; de la queue. Pour <tt>cbq</tt> la
gamme de priorit&eacute;s va de 0 &agrave; 7 et pour <tt>priq</tt> la gamme va de 0 &agrave; 15.
La priorit&eacute; 0 est la priorit&eacute; la plus basse. Quand elle n'est pas sp&eacute;cifi&eacute;e, elle est par d&eacute;faut de 1.
<li><tt><i>qlim</i></tt> - le nombre maximum de paquets acceptables dans une queue. 
Quand il n'est pas sp&eacute;cifi&eacute;, la valeur utilis&eacute;e par d&eacute;faut est de 50.
<li><tt><i>scheduler</i></tt> - l'algorithme utilis&eacute;, soit <tt>cbq</tt> soit <tt>priq</tt>. Il doit &ecirc;tre le m&ecirc;me que celui de la queue "root".
<li><tt><i>sched_options</i></tt> - d'autres options peuvent &ecirc;tre pass&eacute;es &agrave; l'algorithme pour contr&ocirc;ler son comportement :
	<ul>
	<li><tt>default</tt> - d&eacute;finit une queue par d&eacute;faut dans 
	laquelle tous les paquets ne r&eacute;pondant pas &agrave; une quelconque 
    r&egrave;gle vont. Cette queue par d&eacute;faut doit &ecirc;tre unique.
	<li><tt>red</tt> - active la D&eacute;tection Al&eacute;atoire 
	Anticip&eacute;e (RED) pour cette queue.
	<li><tt>rio</tt> - active RED dans les sens ENTREE/SORTIE. Dans ce mode, RED 
	maintiendra des longueurs moyennes de queues et des valeurs de seuil,
	une pour chaque niveau de Qualit&eacute; de service.
	<li><tt>ecn</tt> - active la Notification Explicite de Congestion (ECN) 
	pour cette queue. <tt>Ecn</tt> implique <tt>red</tt>.
	<li><tt>borrow</tt> - la queue peut emprunter de la bande passante aux 
	queues parent. Ceci n'est valable que lorsque vous utilisez l'algorithme	<tt>cbq</tt>.
	</ul>
<li><tt><i>queue_list</i></tt> - une liste de queues enfant &agrave cr&eacute;er sous 
cette queue. Une <tt><i>queue_list</i></tt> ne peut &ecirc;tre d&eacute;finie 
que lorsque l'on utilise l'algorithme <tt>cbq</tt>.
d499 10
a508 1
Ici, les param&egrave;tres des queues enfant d&eacute;finies pr&eacute;c&eacute;demment sont d&eacute;finis. La queue <tt>std</tt> se voit attribuer une bande passante correspondant &agrave; 50% de celle de la queue "root" (1 Mbps) et est d&eacute;finie comme queue par d&eacute;faut. La queue <tt>ssh</tt> d&eacute;finie deux queues enfant, <tt>ssh_login</tt> et <tt>ssh_bulk</tt>. La queue <tt>ssh_login</tt> a une priorit&eacute; plus &eacute;lev&eacute;e que <tt>ssh_bulk</tt> et les deux ont ECN activ&eacute;. La queue <tt>ftp</tt> obtient une bande passante de 500Kbps et obtient une priorit&eacute; de 3. Elle peut aussi emprunter de la bande passante quand une quantit&eacute; suppl&eacute;mentaire est disponible et RED est activ&eacute;.
d511 1
a511 1
<h3>Assignation du Traffic &agrave; une Queue</h3>
d513 4
a516 1
Pour assigner du trafic &agrave; une queue, le mot-cl&eacute; <tt>queue</tt> est utilis&eacute; en conjonction avec les <a href="filter.html">r&egrave;gles de filtrage</a> de PF. Par exemple, consid&eacute;rons un jeu de r&egrave;gles de filtrage contenant une ligne comme :
d522 2
a523 1
Les paquets r&eacute;pondant &agrave; cette r&egrave;gle peuvent &ecirc;tre assign&eacute;s &agrave; une queue sp&eacute;cifique en utilisant le mot-cl&eacute; <tt>queue</tt> :
d529 3
a531 1
Lorsque l'on utilise le mot-cl&eacute; <tt>queue</tt> avec les directives <tt>block</tt>, les paquets TCP RST ou ICMP Unreachable r&eacute;sultants sont assign&eacute;s dans la queue sp&eacute;cifi&eacute;e.
d534 2
a535 1
Notez que la d&eacute;signation des queues est possible sur une interface diff&eacute;rente de celle d&eacute;finie dans la directive <tt>altq on</tt> :
d547 19
a565 5
La Mise en queue est activ&eacute;e sur <tt>fxp0</tt> mais la d&eacute;signation concerne <tt>dc0</tt>.
Si les paquets r&eacute;pondant &agrave; la r&egrave;gle <tt>pass</tt> sortent de l'interface <tt>fxp0</tt>, ils seront mis en queue dans <tt>ftp</tt>. Ce type de mise en queue peut &ecirc;tre tr&egrave;s pratique sur les routeurs.

<p>
Normalement, un seul nom de queue est donn&eacute; avec le mot-cl&eacute; <tt>queue</tt>, mais si un deuxi&egrave;me nom est sp&eacute;cifi&eacute; cette queue sera utilis&eacute;e pour les paquets avec un <a href="http://www.rfc-editor.org/rfc/rfc791.txt">Type de Service (ToS)</a> "low-delay" et pour les paquets TCP ACK sans donn&eacute;e. Un bon exemple de ceci est l'utilisation de SSH. Les connexions de sessions SSH mettent le ToS en "low-delay" contrairement aux sessions SCP et SFTP. PF peut utiliser cette information pour mettre les paquets correspondant &agrave; une connexion dans une queue diff&eacute;rente que celles pour les connexions sans ouverture de session. Ceci peut &ecirc;tre utile pour donner la priorit&eacute; aux connexions avec ouverture de session sur les paquets de transfert de fichiers.
d571 22
a592 4
Ceci assigne les paquets correspondant aux connexions d'ouverture de session SSH &agrave; la queue <tt>ssh_login</tt> et les paquets correspondant aux connexions SCP et SFTP dans la queue <tt>ssh_bulk</tt>. Les connexions d'ouverture de session auront leurs paquets trait&eacute;s avant ceux des connexions SCP et SFTP car la queue <tt>ssh_login</tt> a une priorit&eacute; plus &eacute;lev&eacute;e.

<p>
L'assignation des paquets TCP ACK &agrave; une queue ayant une priorit&eacute; &eacute;lev&eacute;e est utile pour les connexions asym&eacute;triques, c'est &agrave; dire les connexions qui ont des bandes passantes diff&eacute;rentes en envoi et en r&eacute;ception, comme les lignes ADSL. Avec une ligne ADSL, si le canal d'envoi est utilis&eacute; &agrave; son maximum et si un t&eacute;l&eacute;chargement est lanc&eacute;, le t&eacute;l&eacute;chargement en souffrira car les paquets TCP ACK devant &ecirc;tre envoy&eacute;s seront congestionn&eacute;s quand ils essaieront de traverser le canal d'envoi. Des tests ont montr&eacute; que pour r&eacute;aliser les meilleurs r&eacute;sultats, la bande passante de la queue d'envoi doit &ecirc;tre inf&eacute;rieure &agrave; la capacit&eacute; maximale. Par exemple, si une ligne ADSL a un envoi maximum de 640Kbps, le fait de r&eacute;gler la <tt>bande passante</tt> de la queue "root" sur une valeur comme 600Kb entra&icirc;nera de meilleures performances. C'est apr&egrave;s des essais et des erreurs que vous obtiendrez les meilleurs r&eacute;glages de <tt>bande passante</tt>.
d595 2
a596 1
Quand on utilise le mot-cl&eacute; <tt>queue</tt> avec des r&egrave;gles qui <tt>gardent l'&eacute;tat</tt> comme :
d605 6
a610 1
PF enregistrera la queue dans la table d'&eacute;tats ce qui entra&icirc;nera que les paquets traversant <tt>fxp0</tt> au retour et r&eacute;pondant &agrave; la connexion "stateful" termineront dans la queue "ssh". Notez que m&ecirc;me si le mot-cl&eacute; <tt>queue</tt> est utilis&eacute; dans une r&egrave;gle filtrant le trafic entrant, le but est de sp&eacute;cifier une queue pour le trafic sortant correspondant; la r&egrave;gle ci-dessus ne mettra pas en queue les paquets entrants.
d613 1
a613 1
<h2>Exemple #1 : Petit R&eacute;seau, R&eacute;seau domestique</h2>
d625 5
a629 1
Dans cet exemple, OpenBSD est utilis&eacute; sur une passerelle Internet pour un petit r&eacute;seau &agrave; domicile avec trois stations de travail. La passerelle r&eacute;alise le filtrage de paquets et la NAT. La connexion Internet via une ligne ADSL poss&egrave;de une bande passante descendante de 2MBps et montante de 640Kbps.
d632 1
a632 1
La politique de mise en queue pour ce r&eacute;seau :
d634 10
a643 4
<li>R&eacute;server une bande passante de 80Kbps en t&eacute;l&eacute;chargement pour Bob afin qu'il puisse jouer aux jeux en ligne sans &ecirc;tre ralenti par les t&eacute;l&eacute;chargements d'Alice et de Charlie. Autoriser Bob &agrave; utiliser plus de 80Kbps quand ceci est possible.
<li>Le trafic g&eacute;n&eacute;r&eacute; par le SSH interactif et la messagerie instantan&eacute;e aura une plus haute priorit&eacute; que le trafic r&eacute;gulier.
<li>Les requ&ecirc;tes et les r&eacute;ponses DNS auront la seconde plus haute priorit&eacute;.
<li>Les paquets TCP ACK sortants auront une priorit&eacute; plus haute que tout autre trafic sortant.
d647 3
a649 1
Le jeu de r&egrave;gles ci-dessous permet cette politique r&eacute;seau. Notez que seul les directives de <tt>pf.conf</tt> qui concernent directement la politique ci-dessus sont pr&eacute;sentes;
d652 1
a652 1
etc., ne sont pas montr&eacute;es.
d658 1
a658 1
# active la mise en queue sur l'interface externe pour contr&ocirc;ler 
d660 3
a662 3
# contr&ocirc;ler uniquement les priorit&eacute;s. 
# fixe la bande passante &agrave; 610Kbps pour avoir les meilleures
# performances &agrave; la sortie de la queue TCP ACK.
d665 1
a665 1
	tcp_ack_out }
d667 9
a675 9
# d&eacute;finit les param&egrave;tres pour les queues enfant.
# std_out      - la queue standard. toute r&egrave;gle de filtrage ci-dessous 
#                qui ne sp&eacute;cifie pas explicitement une queue aura
#                son trafic ajout&eacute; &agrave; cette queue.
# ssh_im_out   - trafic g&eacute;n&eacute;r&eacute; par le SSH interactif et
#                la messagerie instantan&eacute;e
#                vari&eacute;s.
# dns_out      - requ&ecirc;tes DNS.
# tcp_ack_out  - paquets TCP ACK sans donn&eacute;e.
d682 1
a682 1
# active la mise en queue sur l'interface interne en vue de contr&ocirc;ler
d684 1
a684 1
# contr&ocirc;ler la bande passante. la bande passante maximale est de
d689 9
a697 9
# d&eacute;finit les param&egrave;tres pour les queues enfant.
# std_in      - la queue standard. toute r&egrave;gle de filtrage ci-dessous 
#               qui ne sp&eacute;cifie pas explicitement une queue aura
#               son trafic ajout&eacute; &agrave; cette queue.
# ssh_im_in   - trafic g&eacute;n&eacute;r&eacute; par le SSH interactif et
#               par la messagerie instantan&eacute;e.
# dns_in      - r&eacute;ponses DNS.
# bob_in      - bande passante r&eacute;serv&eacute;e &agrave; la station
#               de travail de Bob. l'autorise &agrave; emprunter.
d714 1
a714 1
# r&egrave;gles de filtrage pour l'entr&eacute;e en fxp0
d717 1
a717 1
# r&egrave;gles de filtrage pour la sortie en fxp0
d720 1
a720 1
	keep state queue(std_out, tcp_ack_out)
d723 1
a723 1
	keep state queue dns_out
d725 1
a725 1
	flags S/SA keep state queue(std_out, ssh_im_out)
d727 1
a727 1
	flags S/SA keep state queue(ssh_im_out, tcp_ack_out)
d729 1
a729 1
# r&egrave;gles de filtrage pour l'entr&eacute;e en dc0
d733 1
a733 1
# r&egrave;gles de filtrage pour la sortie en dc0
d737 1
a737 1
	queue dns_in
d739 1
a739 1
	queue(std_in, ssh_im_in)
d741 1
a741 1
	queue ssh_im_in
d748 1
a748 1
<h2>Exemple #2 : R&eacute;seau d'entreprise</h2>
d762 8
a769 1
Dans cet exemple, l' h&ocirc;te OpenBSD agit en firewall pour le r&eacute;seau d'une entreprise. L'entreprise utilise un serveur WWW dans la partie DMZ de son r&eacute;seau o&ugrave; les clients envoient leurs sites via FTP. Le d&eacute;partement IT a son propre sous-r&eacute;seau connect&eacute; au r&eacute;seau principal, et le directeur a un PC sur son bureau utilis&eacute; pour les emails et le surf sur Internet. La connexion &agrave; Internet se fait via une ligne T1 avec une bande passante de 1.5Mbps dans les deux directions. Tous les autres segments du r&eacute;seau utilisent Fast Ethernet (100Mbps).
d772 1
a772 1
L'administrateur r&eacute;seau a decid&eacute; de la politique suivante :
d774 13
a786 7
<li>Limiter le trafic entre le serveur WWW et Internet &agrave; 500Kbps dans 
chaque direction.
<li>Aucune limite de bande passante sur le trafic entre le serveur WWW et le r&eacute;seau interne.
<li>Donner une priorit&eacute; plus haute au trafic HTTP entre le serveur WWW et Internet que tout autre trafic entre le serveur WWW et Internet (comme les 
envois FTP).
<li>R&eacute;server 500Kbps pour le r&eacute;seau du d&eacute;partement IT pour qu'ils puissent t&eacute;l&eacute;charger les derni&egrave;res mises &agrave; jour de logiciels de fa&ccedil;on rapide. Ils devront pouvoir utiliser plus de 500Kbps quand de la bande passante additionnelle sera disponible.
<li>Donner une priorit&eacute; plus &eacute;lev&eacute;e au trafic entre le PC du directeur et Internet que tout autre trafic allant ou venant d'Internet.
d790 3
a792 1
Le jeu de r&egrave;gles ci-dessous permet cette politique r&eacute;seau. Notez que seul les directives de <tt>pf.conf</tt> qui concernent directement la politique ci-dessus sont pr&eacute;sentes;
d795 1
a795 1
etc., ne sont pas montr&eacute;es.
d803 1
a803 1
# queue puisse &ecirc;tre contr&ocirc;l&eacute;e. la bande passante sortante
d808 2
a809 2
# d&eacute;finit les param&egrave;tres pour les queues enfant.
# std_ext        - la queue standard. &eacute;galement queue par d&eacute;faut 
d811 1
a811 1
# www_ext        - queue contenant les queues du serveur WWW. limit&eacute;e &agrave;
d823 2
a824 2
# active la mise en queue sur l'interface interne pour contr&ocirc;ler le trafic
# venant d'Internet ou de la DMZ. utilise l'algorithme cbq pour contr&ocirc;ler
d826 4
a829 4
# est fix&eacute;e au maximum. le trafic venant de la DMZ sera en mesure
# d'utiliser la totalit&eacute; de cette bande passante alors que le trafic
# venant de l'Internet sera limit&eacute; &agrave; 1.0Mbps (car 0.5Mbps
# (500Kbps) sont allou&eacute;s &agrave; fxp1).
d833 1
a833 1
# d&eacute;finit les param&egrave;tres pour les queues enfant.
d836 1
a836 1
#   std_int  - la queue standard. &eacute;galement queue par d&eacute;faut pour
d838 3
a840 3
#   it_int   - trafic &agrave; destination du r&eacute;seau du
#              d&eacute;partement IT.
#   boss_int - trafic &agrave; destination du PC du directeur.
d849 7
a855 7
# active la mise en queue sur l'interface de la DMZ pour contr&ocirc;ler
# le trafic destin&eacute; au serveur WWW. cbq sera utilis&eacute;
# sur cette interface tant que le contr&ocirc;le d&eacute;taill&eacute; de la bande
# passante sera n&eacute;cessaire. la bande passante sur cette interface
# est fix&eacute;e au maximum. le trafic provenant du r&eacute;seau
# interne sera en mesure d'utiliser la totalit&eacute; de la bande passante
# alors que le trafic provenant d'Internet sera limit&eacute; &agrave; 500Kbps.
d859 2
a860 2
# d&eacute;finit les param&egrave;tres pour les queues enfant.
# internal_dmz   - trafic provenant du r&eacute;seau interne.
d863 1
a863 1
#   net_dmz_misc - tout trafic autre. c'est aussi la queue par d&eacute;faut.
d865 1
a865 1
queue internal_dmz      # aucun r&eacute;glage sp&eacute;cifique requis
d881 1
a881 1
# refut par d&eacute;faut
d884 1
a884 1
# r&egrave;gles de filtrage pour l'entr&eacute;e de fxp0
d886 1
a886 1
	&gt; 49151 } flags S/SA keep state queue www_ext_misc
d888 1
a888 1
	flags S/SA keep state queue www_ext_http
d890 1
a890 1
# r&egrave;gles de filtrage pour la sortie de fxp0
d894 1
a894 1
# r&egrave;gles de filtrage pour l'entr&eacute;e de dc0
d899 1
a899 1
	&gt; 49151 } flags S/SA keep state queue www_int
d901 1
a901 1
# r&egrave;gles de filtrage pour la sortie de dc0
d904 1
a904 1
# r&egrave;gles de filtrage pour l'entr&eacute;e de fxp1
d906 1
a906 1
	keep state
d908 1
a908 1
# r&egrave;gles de filtrages pour la sortie de fxp1
d910 1
a910 1
	&gt; 49151 } flags S/SA keep state queue net_dmz_misc
d912 1
a912 1
	flags S/SA keep state queue net_dmz_http
d914 1
a914 1
	21, &gt; 49151 } flags S/SA keep state queue internal_dmz
d920 1
a920 1
[<a href="anchors.html">Précédent : Ancres et Bases de R&egrave;gles Nomm&eacute;es (Sub)</a>]
d931 2
a932 2
Originally [OpenBSD: queuing.html,v 1.22 ]<br>
$Translation: queueing.html,v 1.2 2004/10/11 09:55:47 saad Exp $<br>
d934 2
a935 1
</small><br>
@

