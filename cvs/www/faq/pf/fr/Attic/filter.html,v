head	1.58;
access;
symbols;
locks; strict;
comment	@# @;


1.58
date	2014.04.01.17.14.10;	author nick;	state dead;
branches;
next	1.57;

1.57
date	2013.11.01.18.04.05;	author ajacoutot;	state Exp;
branches;
next	1.56;

1.56
date	2013.07.23.06.21.49;	author ajacoutot;	state Exp;
branches;
next	1.55;

1.55
date	2013.05.07.12.47.22;	author ajacoutot;	state Exp;
branches;
next	1.54;

1.54
date	2012.11.02.07.24.05;	author ajacoutot;	state Exp;
branches;
next	1.53;

1.53
date	2012.10.11.14.26.22;	author ajacoutot;	state Exp;
branches;
next	1.52;

1.52
date	2012.08.21.19.23.27;	author ajacoutot;	state Exp;
branches;
next	1.51;

1.51
date	2012.08.17.06.29.34;	author ajacoutot;	state Exp;
branches;
next	1.50;

1.50
date	2012.05.19.22.52.00;	author ajacoutot;	state Exp;
branches;
next	1.49;

1.49
date	2012.05.13.16.30.18;	author ajacoutot;	state Exp;
branches;
next	1.48;

1.48
date	2012.04.14.07.25.46;	author ajacoutot;	state Exp;
branches;
next	1.47;

1.47
date	2012.03.17.09.59.11;	author ajacoutot;	state Exp;
branches;
next	1.46;

1.46
date	2011.11.05.12.45.49;	author ajacoutot;	state Exp;
branches;
next	1.45;

1.45
date	2011.07.04.15.54.49;	author ajacoutot;	state Exp;
branches;
next	1.44;

1.44
date	2011.05.07.08.22.01;	author ajacoutot;	state Exp;
branches;
next	1.43;

1.43
date	2011.04.02.08.13.11;	author ajacoutot;	state Exp;
branches;
next	1.42;

1.42
date	2010.11.09.08.15.21;	author ajacoutot;	state Exp;
branches;
next	1.41;

1.41
date	2010.09.26.10.09.25;	author ajacoutot;	state Exp;
branches;
next	1.40;

1.40
date	2009.11.30.13.23.49;	author ajacoutot;	state Exp;
branches;
next	1.39;

1.39
date	2009.10.26.20.27.01;	author ajacoutot;	state Exp;
branches;
next	1.38;

1.38
date	2009.10.20.20.44.42;	author ajacoutot;	state Exp;
branches;
next	1.37;

1.37
date	2009.10.11.20.35.03;	author ajacoutot;	state Exp;
branches;
next	1.36;

1.36
date	2009.05.01.13.16.23;	author tobias;	state Exp;
branches;
next	1.35;

1.35
date	2009.02.22.20.35.21;	author tobias;	state Exp;
branches;
next	1.34;

1.34
date	2008.12.01.07.52.52;	author tobias;	state Exp;
branches;
next	1.33;

1.33
date	2008.08.25.14.21.24;	author tobias;	state Exp;
branches;
next	1.32;

1.32
date	2008.01.13.13.43.34;	author tobias;	state Exp;
branches;
next	1.31;

1.31
date	2007.05.23.09.40.57;	author jufi;	state Exp;
branches;
next	1.30;

1.30
date	2007.05.14.11.27.36;	author saad;	state Exp;
branches;
next	1.29;

1.29
date	2007.05.11.08.47.41;	author saad;	state Exp;
branches;
next	1.28;

1.28
date	2007.02.10.05.22.17;	author saad;	state Exp;
branches;
next	1.27;

1.27
date	2007.02.02.06.46.52;	author saad;	state Exp;
branches;
next	1.26;

1.26
date	2006.12.27.16.17.16;	author saad;	state Exp;
branches;
next	1.25;

1.25
date	2006.12.25.19.10.14;	author jufi;	state Exp;
branches;
next	1.24;

1.24
date	2006.10.29.10.58.52;	author jufi;	state Exp;
branches;
next	1.23;

1.23
date	2006.05.14.09.54.41;	author saad;	state Exp;
branches;
next	1.22;

1.22
date	2006.05.02.17.09.33;	author jufi;	state Exp;
branches;
next	1.21;

1.21
date	2006.04.21.09.28.54;	author jufi;	state Exp;
branches;
next	1.20;

1.20
date	2006.03.10.16.35.07;	author saad;	state Exp;
branches;
next	1.19;

1.19
date	2006.01.02.06.51.10;	author saad;	state Exp;
branches;
next	1.18;

1.18
date	2005.12.31.00.54.37;	author saad;	state Exp;
branches;
next	1.17;

1.17
date	2005.11.29.15.13.39;	author saad;	state Exp;
branches;
next	1.16;

1.16
date	2005.11.03.11.30.53;	author saad;	state Exp;
branches;
next	1.15;

1.15
date	2005.10.16.10.14.28;	author saad;	state Exp;
branches;
next	1.14;

1.14
date	2005.07.28.09.54.34;	author saad;	state Exp;
branches;
next	1.13;

1.13
date	2005.05.22.17.38.07;	author saad;	state Exp;
branches;
next	1.12;

1.12
date	2005.02.26.10.30.40;	author jufi;	state Exp;
branches;
next	1.11;

1.11
date	2005.02.22.16.47.44;	author saad;	state Exp;
branches;
next	1.10;

1.10
date	2005.01.29.16.06.47;	author jufi;	state Exp;
branches;
next	1.9;

1.9
date	2005.01.18.09.54.52;	author jufi;	state Exp;
branches;
next	1.8;

1.8
date	2004.12.29.10.38.26;	author saad;	state Exp;
branches;
next	1.7;

1.7
date	2004.11.03.21.01.25;	author saad;	state Exp;
branches;
next	1.6;

1.6
date	2004.11.01.02.56.30;	author saad;	state Exp;
branches;
next	1.5;

1.5
date	2004.10.21.14.21.48;	author jufi;	state Exp;
branches;
next	1.4;

1.4
date	2004.10.13.14.44.30;	author jufi;	state Exp;
branches;
next	1.3;

1.3
date	2004.10.12.07.18.40;	author jufi;	state Exp;
branches;
next	1.2;

1.2
date	2004.10.11.16.17.48;	author jufi;	state Exp;
branches;
next	1.1;

1.1
date	2004.10.07.10.24.20;	author jufi;	state Exp;
branches;
next	;


desc
@@


1.58
log
@
Abandon translations, per deraadt@@ and ajacoutot@@.
@
text
@<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<html>
<head>
<title>PF : Filtrage de Paquets</title>
<link rev="made" href="mailto:www@@openbsd.org">
<meta http-equiv="Content-Type" content="text/html; charset=ISO-8859-1">
<meta name="resource-type" content="document">
<meta name="description"   content="the OpenBSD FAQ page">
<meta name="keywords"      content="openbsd,faq,pf">
<meta name="distribution"  content="global">
</head>

<!--
Copyright (c) 2003-2007 Joel Knight <enabled@@myrealbox.com>

Permission to use, copy, modify, and distribute this documentation for
any purpose with or without fee is hereby granted, provided that the
above copyright notice and this permission notice appear in all copies.

THE DOCUMENTATION IS PROVIDED "AS IS" AND THE AUTHOR DISCLAIMS ALL
WARRANTIES WITH REGARD TO THIS DOCUMENTATION INCLUDING ALL IMPLIED
WARRANTIES OF MERCHANTABILITY AND FITNESS. IN NO EVENT SHALL THE
AUTHOR BE LIABLE FOR ANY SPECIAL, DIRECT, INDIRECT, OR CONSEQUENTIAL
DAMAGES OR ANY DAMAGES WHATSOEVER RESULTING FROM LOSS OF USE, DATA OR
PROFITS, WHETHER IN AN ACTION OF CONTRACT, NEGLIGENCE OR OTHER
TORTIOUS ACTION, ARISING OUT OF OR IN CONNECTION WITH THE USE OR
PERFORMANCE OF THIS DOCUMENTATION
-->

<body bgcolor="#ffffff" text="#000000">
<!-- Passes validator.w3.org, please keep it this way;
please, use a max of 72 chars per line -->

<a href="../../../fr/index.html">
<img alt="[OpenBSD]" height="30" width="141" src="../../../images/smalltitle.gif" border="0">
</a>
<p>
[<a href="tables.html">Section précédente&nbsp;: Tables</a>]
[<a href="index.html">Index</a>]
[<a href="nat.html">Section suivante&nbsp;: Traduction des Adresses IP (&quot;NAT&quot;)</a>]

<h1><font color="#e00000">PF&nbsp;: Le Filtrage de Paquets</font></h1>

<hr>

<h3>Table des Matières</h3>

<ul>
<li><a href="#intro">Introduction</a>
<li><a href="#syntax">Syntaxe</a>
<li><a href="#defdeny">Blocage par défaut</a>
<li><a href="#pass">Laisser passer le trafic</a>
<li><a href="#quick">L'option <tt>quick</tt></a>
<li><a href="#state">Conserver l'état</a>
<li><a href="#udpstate">Conserver l'état avec UDP</a>
<li><a href="#stateopts">Options de Suivis Stateful</a>
<li><a href="#tcpflags">Les drapeaux TCP</a>
<li><a href="#synproxy">Service mandataire TCP SYN</a>
<li><a href="#antispoof">Bloquer les paquets usurpés</a>
<li><a href="#urpf">Unicast Reverse Path Forwarding</a>
<li><a href="#osfp">Reconnaissance passive d'OS par leurs empreintes</a>
<li><a href="#ipopts">Les options IP</a>
<li><a href="#example">Un exemple de règles de filtrage</a>
</ul>

<hr>

<a name="intro"></a>

<h2>Introduction</h2>
Le filtrage de paquets à l'aide de
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=pf&amp;sektion=4&amp;manpath=OpenBSD+5.4">pf(4)</a>
consiste à autoriser ou bloquer le trafic réseau en fonction des
propriétés des protocoles des couches 3
(<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=ip&amp;sektion=4"
>IPv4</a> et
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=ip6&amp;sektion=4"
>IPv6</a>) et 4 
(<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=tcp&amp;sektion=4"
>TCP</a>,
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=udp&amp;sektion=4"
>UDP</a>,
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=icmp&amp;sektion=4"
>ICMP</a> et 
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=icmp6&amp;sektion=4"
>ICMPv6</a>).
Les adresses et ports source et destination ainsi que les protocoles
utilisés sont des critères fréquemment employés.

<p>
Les règles de filtrage énumèrent les critères auxquels doivent se
conformer les paquets et spécifient les actions qui y sont associées&nbsp;:
bloquer ou laisser passer. Ces règles sont évaluées de façon
séquentielle de la première à la dernière (du haut vers le bas dans les
fichiers de règles utilisés).

Sauf utilisation du mot-clé <tt>quick</tt> dans l'une d'entre elles,
chaque paquet est évalué à l'aide de <i>toutes</i> les règles avant
qu'une décision finale ne soit prise. 

L'action (block ou pass) associée à la dernière règle dont les critères
se rapportent au paquet traité est appliquée. La première règle est un
<tt>tout laisser passer</tt> implicite de sorte que si aucune règle
n'est applicable à un paquet, celui-ci est accepté (<tt>pass</tt>).

<a name="syntax"></a>
<h2>Syntaxe</h2>

L'écriture des règles obéit à la syntaxe <i>très simplifiée</i> suivante
:
<blockquote>
<tt>
<i>action</i> [<i>direction</i>] [log] [quick] [on <i>interface</i>] 
[<i>af</i>] [proto <i>protocol</i>] \<br>
&nbsp;&nbsp;&nbsp;[from <i>src_addr</i> [port <i>src_port</i>]] [to 
<i>dst_addr</i> [port <i>dst_port</i>]] \<br>
&nbsp;&nbsp;&nbsp;[flags <i>tcp_flags</i>] [<i>state</i>]
</tt>
</blockquote>

<dl>
<dt><tt><i>action</i></tt>
<dd>Ce mot-clé indique le type d'action associé à tout paquet
correspondant aux critères contenus dans la règle. Les deux valeurs
possibles sont <tt>pass</tt> et <tt>block</tt>. <tt>pass</tt> signifie
que le paquet sera transféré au noyau pour être traité. Le blocage du
paquet (<tt>block</tt>) sera fonction de la politique définie par les
options
<a href="options.html#block-policy"><tt>block-policy</tt></a>. L'action
associée par défaut peut être modifiée en spécifiant <tt>block drop</tt>
ou <tt>block return</tt>.

<dt><tt><i>direction</i></tt>
<dd>Ce mot-clé spécifie le sens du trafic vu depuis l'interface réseau
: celui-ci peut être entrant (<tt>in</tt>) ou sortant (<tt>out</tt>).

<dt><tt>log</tt>
<dd>La présence de ce mot-clé dans une règle déclenche la
journalisation des paquets correspondants à la règle grâce à
l'utilitaire
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=pflogd&amp;sektion=8&amp;manpath=OpenBSD+5.4">pflogd(8)</a>.
Si la règle crée un état, seul le paquet correspondant à l'ouverture de
la session est conservé. Pour conserver tous les paquets d'une session,
il faut utiliser le mot-clé <tt>log (all)</tt>.

<dt><tt>quick</tt>
<dd>Si le mot-clé <tt>quick</tt> est utilisé dans une règle, celle-ci
est considérée comme étant la dernière à prendre en compte et
l'<tt><i>action</i></tt> spécifiée est prise.

<dt><tt><i>interface</i></tt>
<dd>Le nom ou le groupe de l'interface sur laquelle le paquet
transite. Les interfaces peuvent être ajoutées à des groupes arbitraires
en utilisant la commande
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=ifconfig&amp;sektion=8"
>ifconfig(8)</a>.
Plusieurs groupes sont également automatiquement créés par le noyau&nbsp;:
<ul>
<li>Le groupe <tt>egress</tt>, qui contient la/les interface(s)
relative(s) à la route par défaut.
<li>Les groupes par famille pour les interfaces clonables.
Par exemple&nbsp;: <tt>ppp</tt> ou <tt>carp</tt>.
</ul>
Ceci causerait la correspondance de la règle pour tout paquet traversant
respectivement une interface <tt>ppp</tt> ou <tt>carp</tt>.

<dt><tt><i>af</i></tt>
<dd>Il est possible de spécifier la famille d'adresses IP à laquelle
appliquer une règle à l'aide de ce mot-clé. Les deux valeurs possibles
sont <tt>inet</tt> pour les adresses IPv4 et <tt>inet6</tt> pour
IPv6. PF peut généralement déterminer à quelle famille appartient un
paquet à partir de ses adresses source et destination.

<dt><tt><i>protocol</i></tt>
<dd>Ce mot-clé identifie les protocoles de couche 4 utilisés. Il peut
prendre les valeurs suivantes&nbsp;:
<ul>
<li><tt>tcp</tt>
<li><tt>udp</tt>
<li><tt>icmp</tt>
<li><tt>icmp6</tt>
<li>tout protocole spécifié dans le fichier
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=protocols&amp;sektion=5"
><tt>/etc/protocols</tt></a>
<li>le numéro d'un protocole compris entre 0 et 255
<li>un ensemble de protocoles passé dans une
        <a href="macros.html#lists">liste</a>.
</ul>

<dt><tt><i>src_addr</i></tt>, <tt><i>dst_addr</i></tt> 

<dd>Ces mots-clefs identifient respectivement les adresses source et
destination du paquet telles que contenues dans son en-tête IP. Ces
adresses peuvent être spécifiées&nbsp;:
<ul>
<li>sous la forme d'adresse IPv4 ou IPv6.
<li>sous la forme d'un bloc d'adresses
<a href="http://public.swbell.net/dedicated/cidr.html">CIDR</a>.
<li>sous la forme d'un domaine. Ce dernier fera l'objet d'une résolution
    DNS lors du chargement des règles par PF. La règle s'appliquera
    alors à toutes les adresses du domaine.
<li>par l'intermédiaire du nom d'une interface réseau. Toute adresse IP
    affectée à cette interface sera valide pour la règle.
<li>par l'intermédiaire du nom d'une interface réseau suivi d'un <tt>/<i>netmask
    </i></tt> (par exemple <tt>/24</tt>). Toutes les adresses IP
    correspondant au bloc CIDR formé par l'adresse IP de l'interface et le
    masque de sous réseau seront valides pour cette règle.
<li>sous la forme du nom d'une interface réseau mis entre parenthèses
    <tt>( )</tt>. Cette mise en forme indique à PF qu'il doit mettre ses
    règles à jour en cas de changement de l'adresse IP affectée à
    l'interface en question. Cette technique est très utile dans le cas
    de liaisons PPP ou d'utilisation du protocole DHCP pour
    l'attribution d'adresses IP. Elle évite d'avoir à recharger les
    règles à chaque nouvelle affectation.
<li>grâce au nom d'une interface suivi d'un des paramètres suivants&nbsp;:
  <ul>
  <li><tt>:network</tt> - identifie un bloc CIDR (par exemple&nbsp;:
      192.168.0.0/24)
  <li><tt>:broadcast</tt> - identifie une adresse de multi-diffusion
      (par exemple&nbsp;: 192.168.0.255)
  <li><tt>:peer</tt> - identifie l'adresse d'un pair sur un lien point à
      point.
  </ul>
  <dl>
  <dd>De plus, le paramètre <tt>:0</tt> peut être ajouté aussi bien au
      nom d'une interface qu'à chacun des paramètres présentés
      ci-dessus. PF ne prend alors pas en compte les éventuels alias
      d'adresses IP affectés à l'interface. Ces paramètres peuvent
      aussi être utilisés dans le cas d'une interface entre parenthèses.
      Par exemple: <tt>fxp0:network:0</tt>
  </dl>
<li>à l'aide d'une <a href="tables.html">table</a>.
<li>Le mot-clé <tt>urpf-failed</tt> peut être utilisé au niveau de
    l'adresse source pour indiquer si elle doit ou non subir une <a
    href="#urpf">vérification uRPF</a>.
<li>sous toutes les formes décrites ci-dessus précédées du paramètre
    d'inversion <tt>!</tt> (&quot;not&quot;).
<li>à l'aide d'une <a href="macros.html#lists">liste</a> d'adresses.
<li>grâce au mot-clé <tt>any</tt> qui identifie n'importe quelle
    adresse.
<li>grâce au mot-clé <tt>all</tt> qui est un raccourci pour
    l'expression <tt>from any to any</tt> (n'importe quelle source vers
    n'importe quelle destination).
</ul>

<dt><tt><i>src_port</i></tt>, <tt><i>dst_port</i></tt>
<dd>Ces mots-clefs identifient respectivement les ports source et
    destination qui apparaissent dans les en-têtes des protocoles de
    couche 4. Ces ports peuvent être spécifiés&nbsp;:
<ul>
<li>sous forme numérique par un nombre compris entre 1 et 65535.
<li>par le nom d'un service tel qu'identifié dans le fichier 
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=services&amp;sektion=5"
><tt>/etc/services</tt></a>.
<li>sous la forme d'une <a href="macros.html#lists">liste</a>.
<li>sous la forme d'un intervalle de ports construit à l'aide des
    opérateurs suivants&nbsp;:
        <ul>
        <li><tt>!=</tt> (différent)
        <li><tt>&lt;</tt> (inférieur à)
        <li><tt>&gt;</tt> (supérieur à)
        <li><tt>&lt;=</tt> (inférieur ou égal à)
        <li><tt>&gt;=</tt> (supérieur ou égal à)
        <li><tt>&gt;&lt;</tt> (intervalle)
        <li><tt>&lt;&gt;</tt> (intervalle inverse)
        <dl>
        <dd>Les deux derniers opérateurs demandent deux arguments pour
            former un intervalle qui n'inclut pas ces arguments.
        </dl>
        <li><tt>:</tt> (intervalle complet)
        <dl>
        <dd>L'opérateur d'intervalle complet est également un opérateur binaire
        incluant les arguments dans l'intervalle.
        </dl>
        </ul>
</ul>

<dt><tt><i>tcp_flags</i></tt>
<dd>Spécifie les drapeaux qui doivent être activés dans l'en-tête TCP lors de
    l'utilisation de <tt>proto tcp</tt>. Cette valeur est spécifiée ainsi&nbsp;:
    <tt>flags <i>check</i>/<i>mask</i></tt>. Par exemple&nbsp;: <tt>flags S/SA</tt>.
    Dans ce cas, PF teste uniquement la valeur des drapeaux S et A (SYN et ACK) 
    pour savoir si le drapeau SYN est positionné (et est appliqué à toutes
    les règles TCP par défaut).
    <tt>flags any</tt> indique à PF de ne pas vérifier les drapeaux.

<dt><tt><i>state</i></tt>
<dd>Ce mot-clé indique dans quel état doit être le paquet pour
    satisfaire à une règle.
<ul>
<li><tt>no state</tt> - fonctionne avec TCP, UDP et ICMP.
    PF ne suivra pas cette connexion avec état.
    Pour les connexions TCP, <tt>flags any</tt> est aussi généralement
    nécessaire.
<li><tt>keep state</tt> - s'applique aux protocoles TCP, UDP et ICMP.
    Cette option est appliquée par défaut à toutes les règles de filtrage.
<li><tt>modulate state</tt> - ne s'applique qu'au protocole TCP. PF
    renforcera le caractère aléatoire des numéros de séquence initiaux
    (ISN) générés pour ces paquets.
<li><tt>synproxy state</tt> - PF agit comme mandataire pour les
    connexions TCP entrantes. Cela renforce la protection contre les
    attaques par inondation de paquets SYN en provenance d'adresses
    usurpées. Cette option active implicitement les fonctionnalités
    <tt>keep state</tt> et <tt>modulate state</tt>.
</ul>
</dl>

<a name="defdeny"></a>
<h2>Blocage par défaut</h2>
Il est recommandé d'adopter une approche de blocage par défaut lors de
la configuration d'un pare-feu. Cela signifie que <i>tout</i> est
interdit et que l'on autorise le trafic au cas par cas. Cette approche
est assimilable à l'application d'un principe de précaution et simplifie
l'écriture des règles.

<p>
Cette politique de blocage par défaut repose sur deux règles&nbsp;:
<blockquote>
<tt>
block in &nbsp;all<br>
block out all
</tt>
</blockquote>

<p>
Cela suffit à interdire tout trafic dans un sens comme dans l'autre et
ce sur toutes les interfaces de la machine.

<a name="pass"></a>
<h2>Laisser passer le trafic</h2>

Une fois notre politique restrictive mise en place, il faut spécifier
quelles sont les connexions autorisées. C'est là qu'entrent en jeu les
critères décrits précédemment&nbsp;: adresse et port source et destination,
protocole, etc... Chaque fois qu'un paquet est autorisé à franchir les
murs du pare-feu, les règles correspondantes devront être les plus
restrictives possibles&nbsp;: il s'agit de n'autoriser que le trafic voulu et
lui seul.

<p>
Quelques exemples:
<blockquote>
<tt>
# Autoriser le trafic entrant sur l'interface dc0<br>
# en provenance du réseau local 192.168.0.0/24,<br>
# à destination de la machine dont l'adresse IP est 192.168.0.1.<br>
# Dans le même temps, autoriser le trafic sortant par l'interface dc0.<br>
pass in &nbsp;on dc0 from 192.168.0.0/24 to 192.168.0.1<br>
pass out on dc0 from 192.168.0.1 to 192.168.0.0/24<br>
<br>
<br>
# Autoriser le trafic TCP entrant sur l'interface fxp0<br>
# à destination d'un serveur HTTP.<br>
# Le nom de l'interface - fxp0 - est utilisé comme adresse de destination<br>
# pour les paquets autorisés.<br>
pass in on fxp0 proto tcp from any to fxp0 port www
</tt>
</blockquote>

<a name="quick"></a>
<h2>L'option <tt>quick</tt></h2>
Comme nous l'avons vu, chaque paquet est testé au regard de toutes les
règles de filtrage, de la première à la dernière. Par défaut, un paquet
est marqué à chaque test. Le résultat final peut ainsi changer d'une
règle à l'autre jusqu'à ce que toutes aient été parcourues. Rappelons
que c'est <b>la dernière règle à laquelle correspond un paquet qui
l'emporte</b> sur les autres. Il y a cependant une exception&nbsp;: si l'option
<tt>quick</tt> est présente dans une règle et qu'un paquet correspond
aux critères de cette règle, il n'y a plus de tests&nbsp;: la règle en
question est alors considérée par PF comme étant la dernière. Les
exemples suivants illustrent ce cas de figure&nbsp;:

<p>
Mauvais&nbsp;:
<blockquote>
<tt>
block in on fxp0 proto tcp port ssh<br>
pass &nbsp;in all
</tt>
</blockquote>

<p>
La ligne <tt>block</tt> n'aura aucun effet. Les paquets seront bien
évalués suivant ses critères, mais la ligne suivante annulera tout effet
de cette première règle.

<p>
Mieux&nbsp;:
<blockquote>
<tt>
block in quick on fxp0 proto tcp port ssh<br>
pass &nbsp;in all
</tt>
</blockquote>

<p>
A première vue c'est la même chose. Si la ligne <tt>block</tt> correspond,
l'option <tt>quick</tt> provoque l'arrêt des tests pour chaque paquet qui
correspond aux critères de la première règle. Les paquets qui n'y
satisfont pas seront quant à eux testés au regard des critères de la
règle suivante.

<a name="state"></a>
<h2>Conserver l'état</h2>

Une des fonctionnalités les plus importantes de PF est sa capacité à
conserver l'état des connexions. PF est capable d'évaluer un paquet non
plus unitairement mais dans le contexte de la connexion à laquelle il
appartient. PF utilise pour cela une table d'état grâce à laquelle PF
peut rapidement déterminer si un paquet fait partie d'une connexion déjà
établie et autorisée. Si tel est le cas, le paquet est transféré sans
test complémentaire.

<p>
Conserver l'état des connexions a pour avantage de simplifier les règles
de filtrage et d'améliorer les performances. PF évalue les paquets
<i>quel que soit leur sens</i>&nbsp;: il n'est alors plus nécessaire d'écrire
les règles pour les paquets des flux retour. PF consacre ainsi beaucoup
moins de temps à inspecter les paquets.

<p>
Quand une règle crée un état, le premier paquet qui déclenche
l'activation de celle-ci provoque la création d'un enregistrement dans
la table d'état des connexions en cours. Par la suite, non seulement les
paquets allant de l'expéditeur au destinataire sont rattachés à cette
table et donc autorisés à passer, mais également les paquets qui
appartiennent aux réponses du destinataire.

<p>
Toutes les règles <i>pass</i> créent de manière automatique une entrée
dans la table d'état dès qu'un paquet les active.
Cela peut être désactivé de manière explicite en utilisant l'option
<tt>no state</tt>.

<blockquote>
<tt>
pass out on fxp0 proto tcp from any to any
</tt>
</blockquote>

<p>
Cette règle autorise les connexions TCP sortantes sur l'interface
<tt>fxp0</tt> mais aussi les paquets retour. L'option keep state permet donc
d'augmenter les performances du pare-feu car la recherche dans la table d'état
est beaucoup plus rapide que l'opération consistant à évaluer un paquet au
regard de toutes les règles de filtrage.

<p>
L'option <tt>modulate state</tt> fonctionne de la même façon que
l'option <tt>keep state</tt> à ceci près qu'elle ne s'applique qu'aux
paquets TCP sortants. L'option <tt>modulate state</tt> renforce le
caractère aléatoire de leurs numéros de séquence initiaux (ISN). Cette
option permet de renforcer la sécurité de certains systèmes
d'exploitation ne sachant pas générer d'ISN suffisamment aléatoires. Pour
simplifier les règles, l'option <tt>modulate state</tt> peut être utilisée 
pour les autres protocoles que TCP, dans les autres cas elle est traitée
comme <tt>keep state</tt>.

<p>
Pour conserver l'état des connexions TCP, UDP et ICMP tout en renforçant
la sécurité des ISN&nbsp;:
<blockquote>
<tt>

pass out on fxp0 proto { tcp, udp, icmp } from any \<br>
&nbsp;&nbsp;&nbsp;&nbsp;to any modulate state<br>
</tt>
</blockquote>

<p>
Un des avantages de conserver l'état des connexions tient à ce que les
messages ICMP relatifs à celles-ci seront traités comme faisant partie
de la connexion. Si des messages ICMP sont émis par une machine pour
signaler une congestion par exemple, et que le suivi d'état est utilisé,
les messages seront pris en compte et acceptés par le pare-feu. Sans
cela, ils auraient été bloqués ou ignorés.

<p>
La portée d'une entrée dans la table d'état dépend des options
<a href="options.html#state-policy"><tt>state-policy</tt></a> d'une manière
globale ou bien des options <tt>if-bound</tt>, <tt>group-bound</tt> et
<tt>floating-state</tt>. Les valeurs appliquées règle par règle ont la même
signification que lorsqu'elles sont utilisées avec l'option
<tt>state-policy</tt>. Par exemple&nbsp;:

<blockquote>
<tt>
pass out on fxp0 proto { tcp, udp, icmp } from any \<br>
&nbsp;&nbsp;&nbsp;&nbsp;to any modulate state (if-bound)<br>
</tt>
</blockquote>

<p>
Selon cette règle, les paquets ne trouveront une correspondance dans la
table d'état que s'ils transitent par l'interface <tt>fxp0</tt>.



<a name="udpstate"></a>
<h2>Conserver l'état des connexions UDP</h2>

On entend souvent dire qu'il est impossible d'utiliser la table d'état
avec UDP car c'est un protocole sans état. S'il est vrai qu'une
connexion UDP n'utilise pas stricto sensu le concept d'état tel que le
fait une connexion TCP (à savoir une ouverture et une terminaison
explicites de la connexion), cela n'a aucune conséquence sur la capacité
qu'a PF de créer et gérer des états pour les connexions UDP. Pour ce
type de protocole sans début/fin de connexion explicite, PF
conserve simplement une trace de la durée d'une session. S'il s'écoule
un certain laps de temps sans échange de paquets entre les deux parties,
l'entrée associée à la session dans la table d'état est supprimée.
Ce laps de temps peut être configuré dans la section
<a href="options.html">options</a> du fichier <tt>pf.conf</tt>.

<a name="stateopts"></a>
<h2>Options de Suivi Stateful</h2>
Les règles de filtrage qui créent une entrée dans la table d'états
peuvent spécifier plusieurs options afin de contrôler le comportement de
ces créations d'états.
Les options suivantes sont disponibles&nbsp;:

<dl>
<dt><tt>max <i>number</i></tt>
<dd>Limite le nombre maximum d'entrées d'états que la règle peut créer à
<i>number</i>.
Si le maximum est atteint, les paquets qui devraient normalement créer
un état sont rejetés jusqu'à ce que le nombre d'états existants soit en
dessous de la limite.

<dt><tt>no state</tt>
<dd>Empêche la règle de créer automatiquement une entrée dans la table
d'état.

<dt><tt>source-track</tt>
<dd>Cette option active le suivi du nombre d'états créés par adresse IP
source.
Cette option a deux formats&nbsp;:
       <ul>
       <li><tt>source-track rule</tt> - Le nombre maximum d'états créés
           par cette règle est limité par les options <tt>max-src-nodes
           </tt> et <tt>max-src-states</tt> de la règle. Seules les
           entrées d'états créées par cette règle particulière comptent
           pour la limite des règles.
       <li><tt>source-track global</tt> - Le nombre d'états créés par
           toutes les règles qui utilisent cette option est limité.
           Chaque règle peut spécifier différentes options <tt>max-src-nodes
           </tt> et <tt>max-src-states</tt>, cependant, les entrées
           d'états créées par toute règle participante comptent en vue
           d'une limite individuelle éventuelle.
       </ul>
Le nombre total d'adresses IP source suivies globalement peut être
contrôlé via l'option
<a href="options.html#limit"><tt>src-nodes</tt> runtime</a>.

<dt><tt>max-src-nodes <i>nombre</i></tt>
<dd>Lorsque l'option <tt>source-track</tt> est utilisée,
<tt>max-src-nodes</tt> limitera le nombre d'adresses IP source pouvant
créer simultanément une entrée.
Cette option peut seulement être utilisée avec une option <tt>source-track</tt>.

<dt><tt>max-src-states <i>nombre</i></tt>
<dd>Lorsque l'option <tt>source-track</tt> est utilisée,
<tt>max-src-states</tt> limitera le nombre d'entrées d'états
simultanées pouvant être crées par adresse IP source.
La portée de cette limite (les états créés par cette règle uniquement ou
les états créés par toutes les règles utilisant <tt>source-track</tt>)
est dépendante de l'option <tt>source-track</tt> spécifiée.
</dl>

<p>
Les options sont spécifiées entre parenthèses et tout de suite après
l'un des mots-clés de gestion d'état ((<tt>keep state</tt>,
<tt>modulate state</tt>, ou <tt>synproxy state</tt>).
S'il y a plusieurs options, vous devez les séparer par des virgules.
A partir d'OpenBSD 4.1, le mot-clé <tt>keep state</tt> est utilisé par
défaut par toutes les règles de filtrage lorsqu'aucun mot-clé de gestion
d'état n'est spécifié.
Malgré cela, un de ces mots-clés doit tout de même être spécifié lors de
l'utilisation d'options de gestion d'état.

<p>
Une règle d'exemple&nbsp;:

<blockquote>
<tt>
pass in on $ext_if proto tcp to $web_server \<br>
&nbsp;&nbsp;&nbsp;&nbsp;port www keep state \<br>
&nbsp;&nbsp;&nbsp;&nbsp;(max 200, source-track rule, max-src-nodes 100,
max-src-states 3)
</tt>
</blockquote>

<p>
La règle ci-dessus définit le comportement suivant&nbsp;:

<ul>
<li>Limiter le nombre maximum absolu d'états pouvant être créés par
cette règle à 200
<li>Activer le suivi de la source; limiter la création d'états pour
cette règle uniquement
<li>Limiter le nombre maximum de n&#156;uds pouvant simultanément créer des
états à 100
<li>Limiter le nombre maximum d'états simultanés par adresse IP source à
3
</ul>

<p>
Un jeu séparé de restrictions peut être placé sur les connexions TCP
stateful qui ont une poignée de main "3-way handshake" complète.

<dl>
<dt><tt>max-src-conn <i>nombre</i></tt>
<dd>Limiter le nombre maximum de connexions TCP simultanées ayant
réalisé la poignée de main qu'un hôte peut initier.
<dt><tt>max-src-conn-rate <i>nombre</i> / <i>intervalle</i></tt>
<dd>Limiter le taux de nouvelles connexions à un certaine fréquence.
</dl>

<p>
Ces deux options font appel à l'option <tt>source-track rule</tt> et
sont incompatibles avec <tt>source-track global</tt>.

<p>
Ces limites étant placées sur les connexions TCP ayant réalisé la
poignée de main TCP, des connexions plus agressives pourront toujours
avoir lieu depuis les adresses IP concernées.

<dl>
<dt><tt>overload &lt;<i>table</i>&gt;</tt>
<dd>Mettre l'adresse d'un hôte concerné dans la table désignée.
<dt><tt>flush [global]</tt>
<dd>Tue toutes les autres connexions qui correspondent à cette règle et
qui ont été créées par cette adresse IP source.
Quand <tt>global</tt> est spécifié, cela tue tous les états
correspondant à cette adresse IP source, sans discernement de la règle
qui a créé cet état.
</dl>

<p>
Un exemple&nbsp;:

<blockquote>
<tt>
table &lt;abusive_hosts&gt; persist<br>
block in quick from &lt;abusive_hosts&gt;<br>
<br>
pass in on $ext_if proto tcp to $web_server \<br>
&nbsp;&nbsp;&nbsp;&nbsp;port www flags S/SA keep state \<br>
&nbsp;&nbsp;&nbsp;&nbsp;(max-src-conn 100, max-src-conn-rate 15/5,
overload &lt;abusive_hosts&gt; flush)
</tt>
</blockquote>

<p>
Ceci permet de&nbsp;:

<ul>
<li>Limiter le nombre maximum de connexions par source à 100
<li>Limiter le taux du nombre de connexions à 15 dans une durée de 5
secondes
<li>Mettre l'adresse IP de tout hôte qui dépasse ces limites dans la
table <tt>&lt;abusive_hosts&gt;</tt>
<li>Pour des adresses IP concernées, supprimer tous les états créés par
cette règle.
</ul>

<a name="tcpflags"></a>
<h2>Les drapeaux TCP</h2>

On utilise souvent les drapeaux TCP dans des règles pour traiter les
ouvertures de sessions. Ces drapeaux et leur signification sont
présentés dans la liste suivante&nbsp;:
<ul>
<li><b>F</b>&nbsp;: FIN  - Fin de session
<li><b>S</b>&nbsp;: SYN  - Synchronize ; correspond à une ouverture de session
<li><b>R</b>&nbsp;: RST  - Reset ; met fin à une session
<li><b>P</b>&nbsp;: PUSH - Push ; le paquet est envoyé immédiatement
<li><b>A</b>&nbsp;: ACK - Acknowledgement ; atteste de l'acquittement d'une
    des parties
<li><b>U</b>&nbsp;: URG  - Urgent
<li><b>E</b>&nbsp;: ECE  - Explicit Congestion Notification Echo ; avis de congestion
<li><b>W</b>&nbsp;: CWR - Congestion Window Reduced ; avis de réduction de la
    fenêtre TCP
</ul>

<p>
Le mot-clé <tt>flags</tt> doit apparaître dans une règle si l'on
souhaite que PF prenne en compte la valeur des drapeaux TCP d'un paquet.
La syntaxe est la suivante&nbsp;:
<blockquote>
<tt>
flags <i>check</i>/<i>mask</i><br>
flags any
</tt>
</blockquote>

<p>
La partie <tt><i>mask</i></tt> de la règle indique la liste des drapeaux
que PF doit inspecter. La partie <tt><i>check</i></tt> quant à elle
spécifie les drapeaux qui doivent être positionnés pour que la règle
s'applique au paquet traité.
L'utilisation du mot-clé <tt>any</tt> permet de positionner n'importe quelle
combinaison de drapeaux au niveau de l'en-tête.
<blockquote>
<tt>
pass in on fxp0 proto tcp from any to any port ssh flags S/SA<br>
pass in on fxp0 proto tcp from any to any port ssh
</tt>
</blockquote>

<p>
Comme les <tt>drapeaux S/SA</tt> sont définis par défaut, les règles
précédentes sont équivalentes, chacune de ces règles s'applique au trafic
TCP avec le drapeau SYN positionné en regardant uniquement les drapeaux SYN
et ACK.
Un paquet avec les drapeaux SYN et ECE s'appliquera aux règles précédentes,
mais pas à un paquet dont les drapeaux SYN et ACK ou dont seul le 
drapeau ACK sont positionnés.

<p>
Les drapeaux par défaut peuvent être contournés en utilisant l'option
<tt>flags</tt> tel que spécifié plus haut.

<p>
Il faut manipuler les drapeaux avec prudence et se méfier des mauvais
conseils. Certaines personnes suggèrent de ne créer des entrées que pour
les paquets dont le drapeau SYN est positionné. Ce qui peut aboutir à
cette règle&nbsp;:
<pre>
     . . . flags S/FSRPAUEW  <i>mauvaise pioche !!</i>
</pre>

<p>
En théorie, une session TCP commence par un paquet dont le drapeau SYN
est positionné. Toujours en théorie, il ne faut créer une entrée dans la
table d'état que pour ce genre de paquets. Mais certains systèmes
utilisent le drapeau ECN en début de session. Ces paquets sont rejetés
par la règle précédente.
Une meilleure solution consiste à ne pas spécifier de drapeau et de
laisser PF appliquer les drapeaux par défaut à vos règles.
Si vous avez réellement besoin de spécifier des drapeaux vous-même alors
cette combinaison devrait être sûre&nbsp;:
<blockquote>
<tt>
. . . flags S/SAFR
</tt>
</blockquote>

<p>
<!--XXX scrub changes may have invalidated this-->
Si le trafic est normalisé, il peut être
pratique et sûr de ne pas tester la valeur des drapeaux FIN et RST. Dans
ce cas, PF rejette tout paquet entrant dont les drapeaux TCP sont
positionnés de manière illicite (par exemple SYN et RST) et les
combinaisons potentiellement ambiguës (telles que SYN et FIN) seront
normalisées.


<a name="synproxy"></a>
<h2>Mandataire TCP SYN</h2>

<p>
Normalement, quand un client ouvre une connexion TCP vers un serveur, PF
relaie les paquets d'ouverture
(<a href="http://www.inetdaemon.com/tutorials/internet/tcp/3-way_handshake.shtml"
>handshake</a>) au fur et à mesure qu'ils arrivent. 
PF peut agir en tant que mandataire (proxy). Dans ce cas, PF va traiter
la demande en lieu et place du serveur et ne transfèrera qu'ensuite les
paquets à ce dernier. Aucun paquet n'est transmis au serveur avant que
le client n'ait terminé l'échange initial (handshake).

Dans le cas d'attaques par inondation de paquets SYN, les paquets de
l'attaquant n'atteignent jamais le serveur protégé, mais les clients
légitimes termineront la liaison et passeront.

Cela minimise l'impact d'inondations TCP SYN spoofées sur le service
protégé, en les gérant directement dans PF. Cependant, l'utilisation
systématique de cette option n'est pas recommandée, étant donné qu'elle
rompt le comportement prévu du protocole TCP lorsque le serveur ne peut
traiter la requête et lorsque les équilibreurs de charges sont actifs.

<p>
Le mandataire TCP SYN est activé à l'aide de l'option <tt>synproxy
state</tt>&nbsp;:

<blockquote>
<tt>
pass in on $ext_if proto tcp to $web_server port www synproxy state
</tt>
</blockquote>

<p>
Toutes les connexions à destination du serveur HTTP seront mandatées par
PF.

<p>
L'option <tt>synproxy state</tt> apporte les mêmes avantages que les
options <tt>keep state</tt> et <tt>modulate state</tt>.

<p>
Par contre, l'option synproxy ne fonctionne pas quand PF est installé en
passerelle transparente
(<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=bridge&amp;sektion=4"
>bridge(4)</a>).


<a name="antispoof"></a>
<h2>Bloquer les paquets usurpés</h2>

On parle d'usurpation quand un utilisateur mal intentionné maquille son
adresse IP dans le but d'anonymiser ou de cacher son identité afin de
lancer des attaques sans que leur origine soit détectable. Il peut
également essayer et parfois réussir à avoir accès à des services
réservés à certaines adresses.

<p>
PF permet de se prémunir de ce type d'attaques grâce à l'option
<tt>antispoof</tt>&nbsp;:

<blockquote>
<tt>
antispoof [log] [quick] for <i>interface</i> [<i>af</i>]

</tt>
</blockquote>

<dl>
<dt><tt>log</tt>
<dd>Journalise les paquets via 
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=pflogd&amp;sektion=8&amp;manpath=OpenBSD+5.4">pflogd(8)</a>.

<dt><tt>quick</tt>
<dd>Si un paquet correspond à la règle, celle-ci est appliquée
    immédiatement.

<dt><tt><i>interface</i></tt>
<dd>Désigne l'interface sur laquelle s'applique la protection. Il est
    possible de passer une <a href="macros.html#lists">liste</a>
    d'interfaces en paramètre.


<dt><tt><i>af</i></tt>
<dd>Spécifie le type d'adresse&nbsp;: <tt>inet</tt> pour IPv4 ou
    <tt>inet6</tt> pour IPv6.
</dl>

<p>
Exemple:
<blockquote>
<tt>
antispoof for fxp0 inet
</tt>

</blockquote>

<p>
Quand les règles sont chargées, toutes les occurrences du mot
<tt>antispoof</tt> sont décodées dans deux filtres. Si l'interface
<tt>fxp0</tt> dont l'adresse IP est 10.0.0.1 pour un masque de sous-
réseau de 255.255.255.0 (soit /24) est protégée, l'option
<tt>antispoof</tt> sera décodée ainsi&nbsp;:

<blockquote>
<tt>
block in on ! fxp0 inet from 10.0.0.0/24 to any<br>

block in inet from 10.0.0.1 to any
</tt>
</blockquote>

<p>
Cette règle déclenche deux actions&nbsp;:
<ul>
<li>elle bloque tout le trafic en provenance du réseau 10.0.0.0/24 s'il
    ne passe <i>pas</i> par l'interface <tt>fxp0</tt>. Puisque le réseau
    10.0.0.0/24 est branché sur l'interface <tt>fxp0</tt>, aucun paquet en
    provenance de celui-ci ne devrait arriver ailleurs.

<li>elle bloque tout le trafic entrant dont l'adresse source est
    10.0.0.1, à savoir celle de l'interface <tt>fxp0</tt>. Cette machine
    ne devrait en effet jamais émettre de paquets à travers une
    interface externe et par conséquent ne doit pas recevoir de paquets
    ayant son adresse IP comme adresse source.
</ul>

<p>
<b>REMARQUE</b>&nbsp;: le filtrage activé par l'option <tt>antispoof</tt>
   d'une règle s'applique également aux paquets envoyés sur l'adresse de
   bouclage interne (loopback).
   Le filtrage est communément désactivé sur ces interfaces, et cela
   devient primordial lors de l'utilisation de règles antispoof&nbsp;:
<blockquote>
<tt>
set skip on lo0<br>
<br>
antispoof for fxp0 inet
</tt>

</blockquote>

<p>
L'utilisation de l'option <tt>antispoof</tt> est réservée aux interfaces
qui possèdent une adresse IP. Utiliser <tt>antispoof</tt> sur une interface sans
adresse IP aboutit au filtrage suivant&nbsp;:
<blockquote>
<tt>
block drop in on ! fxp0 inet all<br>
block drop in inet all
</tt>
</blockquote>

<p>
Avec ce genre de règles, le risque est réel de bloquer <i>tout</i> le
trafic entrant sur <i>toutes</i> les interfaces.

<a name="urpf"></a>
<h2>Unicast Reverse Path Forwarding</h2>

<p>
PF offre la fonctionnalité Unicast Reverse Path Forwarding (uRPF).
Lorsqu'un paquet est soumis à la vérification uRPF, l'adresse IP source
de celui-ci est recherchée dans la table de routage. Si l'interface de
sortie trouvée dans la table de routage afin de joindre la source est la
même que celle par laquelle le paquet vient d'entrer, le test uRPF
réussit. Si les interfaces ne correspondent pas, il est alors possible
que le paquet ait une adresse source spoofée.

<p>
La vérification uRPF peut être réalisée sur les paquets en utilisant
dans les règles de filtrage le mot-clé <tt>urpf-failed</tt>&nbsp;:

<blockquote>
<tt>
block in quick from urpf-failed label uRPF
</tt>
</blockquote>

<p>
Notez que la vérification uRPF n'a de sens que dans un environnement de
routage symétrique.

<p>
uRPF propose la même fonctionnalité que les règles
<a href="#antispoof">antispoof</a>.


<a name="osfp"></a>
<h2>Reconnaissance passive d'OS par leurs empreintes</h2>

<p>
La reconnaissance passive d'OS par leurs empreintes (&quot;OS
Fingerprinting&quot; ou OSFP) est une méthode qui permet de reconnaître
à distance quel système d'exploitation tourne sur une machine. Cette
reconnaissance se base sur les caractéristiques des paquets TCP SYN
renvoyés par une machine. Ces informations peuvent être utilisées comme
critères dans des règles de filtrage.

<p>
PF utilise le fichier
<a href="options.html#fingerprints">d'empreintes</a>
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=pf.os&amp;sektion=5&amp;manpath=OpenBSD+5.4"><tt>/etc/pf.os</tt></a>
pour reconnaître les systèmes d'exploitation auxquels il a affaire.
Lorsque PF s'exécute, la liste des empreintes reconnues peut être
consultée grâce à la commande suivante&nbsp;:

<blockquote>
<tt>
# pfctl -s osfp
</tt>
</blockquote>

<p>
Dans une règle, une empreinte peut être désignée sous la forme d'une
classe, d'une version ou d'un sous-type d'OS. La liste de ces éléments
est affichée à l'aide de la commande <tt>pfctl</tt>. Pour désigner une
empreinte dans une règle, il faut utiliser le mot-clé <tt>os</tt>&nbsp;:

<blockquote>
<tt>
pass &nbsp;in on $ext_if proto tcp from any os OpenBSD keep state<br>
block in on $ext_if proto tcp from any os "Windows 2000"<br>
block in on $ext_if proto tcp from any os "Linux 2.4 ts"<br>
block in on $ext_if proto tcp from any os unknown
</tt>
</blockquote>

<p>
<tt>unknown</tt> est une classe spéciale désignant les systèmes
d'exploitation dont l'empreinte n'est pas connue.

<p>
<font color="#ff0000">Notez bien que </font>:
<ul>
  <li>La reconnaissance peut échouer face à des paquets spécifiquement
      construits pour tromper la détection d'empreintes.
  <li>L'application de correctifs peut modifier le comportement de la
      pile TCP/IP d'un système d'exploitation et faire également échouer
      ou tromper la reconnaissance de l'OS.
  <li>L'option OSFP n'est applicable qu'aux paquets TCP SYN. Elle est
      inefficace avec d'autres protocoles et pour les sessions déjà
      établies.
</ul>

<a name="ipopts"></a>
<h2>Les options IP</h2>

PF bloque par défaut tous les paquets qui utilisent les options IP. Cela
rend moins aisé le travail des outils de reconnaissance d'empreintes
tels que nmap. Si une application utilise ces options (par exemple IGMP
ou les diffusions multicast) il est possible d'utiliser l'option
<tt>allow-opts</tt>&nbsp;:

<blockquote>
<tt>
pass in quick on fxp0 all allow-opts
</tt>
</blockquote>

<a name="example"></a>
<h2>Exemple de règles de filtrage</h2>

Vous trouverez ci-dessous un exemple de règles de filtrage pour un
pare-feu PF destiné à protéger un petit réseau connecté à Internet. Seules
les règles de filtrage sont mentionnées ;
<a href="queueing.html"><tt>queueing</tt></a>,
<a href="nat.html"><tt>nat</tt></a>, 
<a href="rdr.html"><tt>rdr</tt></a>, etc... 
ont été volontairement laissées de côté.
<br>

<br>
<table border=0 width="650">
<tr><td nowrap bgcolor="#EEEEEE">
<pre>
ext_if  = "fxp0"
int_if  = "dc0"
lan_net = "192.168.0.0/24"

# Déclaration du tableau référençant toutes les adresses IP affectées au
# pare-feu.
table &lt;firewall&gt; const { self }

# Ne pas filtrer sur l'interface de bouclage
set skip on lo0

# Normalisation de tous les paquets entrants.
match in all scrub (no-df)

# Mise en place d'une politique d'interdiction par défaut.
block all

# Activation de la protection contre l'usurpation sur toutes les
# interfaces.
block in quick from urpf-failed

# Les connexions ssh ne sont autorisées qu'en provenance du réseau local
# et de la machine 192.168.0.15. "block return" provoque l'émission d'un
# paquet TCP RST pour mettre fin aux connexions illicites. "quick"
# assure que cette règle n'est pas contredite par les règles "pass".
block return in quick on $int_if proto tcp from ! 192.168.0.15 \
   to $int_if port ssh

# Autoriser le trafic sortant et entrant sur le réseau local.
# ces règles créeront des entrées au niveau de la table d'état étant
# donné que le mot-clé "keep state" est automatiquement appliqué.
pass in  on $int_if from $lan_net
pass out on $int_if to $lan_net

# Autoriser les connexions sortantes tcp, udp et icmp sur l'interface
# externe.
# les connexions tcp seront modulées, et udp/icmp auront un suivi
# d'état.
pass out on $ext_if proto { tcp udp icmp } all modulate state

# Autoriser les connexions ssh sur l'interface externe du moment
# qu'elles ne sont pas destinées au pare-feu lui-même. Journaliser le
# paquet qui initie la session afin de pouvoir déterminer, plus tard,
# qui a essayé de se connecter.
# Décommentez la dernière partie pour utiliser le proxy tcp syn.
pass in log on $ext_if proto tcp to ! &lt;firewall&gt; \
   port ssh # synproxy state
</pre>
</td></tr>
</table>

<p>
[<a href="tables.html">Section précédente&nbsp;: Tables</a>]
[<a href="index.html">Index</a>]
[<a href="nat.html">Section suivante&nbsp;: Traduction des Adresses IP (&quot;NAT&quot;)</a>]


<p>
<hr>
<a href="index.html"><img height="24" width="24" src="../../../images/back.gif" border="0" alt="[back]"></a> 
<a href="mailto:www@@openbsd.org">www@@openbsd.org</a>
<br>
<small>
<!--
Originally [OpenBSD: filter.html,v 1.68 ]<br>
$Translation: filter.html,v 1.63 2013/11/01 17:02:17 rustybsd Exp $<br>
-->
$OpenBSD: filter.html,v 1.57 2013/11/01 18:04:05 ajacoutot Exp $
</small>

</body>
</html>
@


1.57
log
@Sync with Steelix CVS
@
text
@d1102 1
a1102 1
$OpenBSD$
@


1.56
log
@Sync with Steelix CVS
@
text
@d72 1
a72 1
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=pf&amp;sektion=4&amp;manpath=OpenBSD+5.3">pf(4)</a>
d141 1
a141 1
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=pflogd&amp;sektion=8&amp;manpath=OpenBSD+5.3">pflogd(8)</a>.
d830 1
a830 1
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=pflogd&amp;sektion=8&amp;manpath=OpenBSD+5.3">pflogd(8)</a>.
d961 1
a961 1
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=pf.os&amp;sektion=5&amp;manpath=OpenBSD+5.3"><tt>/etc/pf.os</tt></a>
d1099 2
a1100 2
Originally [OpenBSD: filter.html,v 1.67 ]<br>
$Translation: filter.html,v 1.62 2013/07/23 03:19:57 rustybsd Exp $<br>
@


1.55
log
@Sync with Steelix CVS
@
text
@d432 1
a432 1
Cela peut-être désactivé de manière explicite en utilisant l'option
d542 1
a542 1
           entrées d'états crées par cette règle particulière comptent
d548 1
a548 1
           d'états crées par toute règle participante comptent en vue
d713 1
a713 1
précédentes sont équivalentes, chacune des ces règles s'applique au trafic
d1100 1
a1100 1
$Translation: filter.html,v 1.61 2013/05/07 08:34:48 rustybsd Exp $<br>
@


1.54
log
@Sync with Steelix CVS
@
text
@d72 1
a72 1
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=pf&amp;sektion=4&amp;manpath=OpenBSD+5.2">pf(4)</a>
d141 1
a141 1
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=pflogd&amp;sektion=8&amp;manpath=OpenBSD+5.2">pflogd(8)</a>.
d830 1
a830 1
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=pflogd&amp;sektion=8&amp;manpath=OpenBSD+5.2">pflogd(8)</a>.
d961 1
a961 1
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=pf.os&amp;sektion=5&amp;manpath=OpenBSD+5.2"><tt>/etc/pf.os</tt></a>
d1099 2
a1100 2
Originally [OpenBSD: filter.html,v 1.66 ]<br>
$Translation: filter.html,v 1.60 2012/11/01 19:46:21 rustybsd Exp $<br>
@


1.53
log
@Sync with Steelix CVS
@
text
@d72 1
a72 1
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=pf&amp;sektion=4&amp;manpath=OpenBSD+5.1">pf(4)</a>
d141 1
a141 1
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=pflogd&amp;sektion=8&amp;manpath=OpenBSD+5.1">pflogd(8)</a>.
d830 1
a830 1
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=pflogd&amp;sektion=8&amp;manpath=OpenBSD+5.1">pflogd(8)</a>.
d961 1
a961 1
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=pf.os&amp;sektion=5&amp;manpath=OpenBSD+5.1"><tt>/etc/pf.os</tt></a>
d1099 2
a1100 2
Originally [OpenBSD: filter.html,v 1.65 ]<br>
$Translation: filter.html,v 1.59 2012/10/06 18:06:30 rustybsd Exp $<br>
@


1.52
log
@Sync with Steelix CVS
@
text
@d770 11
a780 3
le client n'ait terminé l'échange initial (handshake). L'avantage de
cette méthode est de protéger le serveur des attaques par inondation de
paquets SYN lancées à l'aide de paquets falsifiés.
d1077 3
a1079 4
# paquet qui initie la session afin de pouvoir déterminer qui s'est
# connecté. Activer un service mandataire SYN.
# Les drapeaux par défaut "S/SA" seront automatiquement appliqués à la
# règle par PF.
d1081 1
a1081 1
   port ssh synproxy state
d1099 2
a1100 2
Originally [OpenBSD: filter.html,v 1.64 ]<br>
$Translation: filter.html,v 1.58 2012/08/20 11:05:44 rustybsd Exp $<br>
@


1.51
log
@Sync with Steelix CVS
@
text
@d1092 2
a1093 2
Originally [OpenBSD: filter.html,v 1.63 ]<br>
$Translation: filter.html,v 1.57 2012/08/17 06:15:16 rustybsd Exp $<br>
@


1.50
log
@Sync with Steelix CVS
@
text
@d1017 1
a1017 1
<a href="queueing.html">queueing</a>,
d1092 2
a1093 2
Originally [OpenBSD: filter.html,v 1.62 ]<br>
$Translation: filter.html,v 1.56 2012/05/17 14:16:54 rustybsd Exp $<br>
@


1.49
log
@Sync with Steelix CVS
@
text
@d97 1
a97 1
Sauf utilisation du mot-clef <tt>quick</tt> dans l'une d'entre elles,
d123 1
a123 1
<dd>Ce mot-clef indique le type d'action associé à tout paquet
d134 1
a134 1
<dd>Ce mot-clef spécifie le sens du trafic vu depuis l'interface réseau
d138 1
a138 1
<dd>La présence de ce mot-clef dans une règle déclenche la
d144 1
a144 1
il faut utiliser le mot-clef <tt>log (all)</tt>.
d147 1
a147 1
<dd>Si le mot-clef <tt>quick</tt> est utilisé dans une règle, celle-ci
d169 1
a169 1
appliquer une règle à l'aide de ce mot-clef. Les deux valeurs possibles
d175 1
a175 1
<dd>Ce mot-clef identifie les protocoles de couche 4 utilisés. Il peut
d239 1
a239 1
<li>grâce au mot-clef <tt>any</tt> qui identifie n'importe quelle
d241 1
a241 1
<li>grâce au mot-clef <tt>all</tt> qui est un raccourci pour
d288 1
a288 1
<dd>Ce mot-clef indique dans quel état doit être le paquet pour
d687 1
a687 1
Le mot-clef <tt>flags</tt> doit apparaître dans une règle si l'on
d922 1
a922 1
dans les règles de filtrage le mot-clef <tt>urpf-failed</tt>&nbsp;:
d968 1
a968 1
empreinte dans une règle, il faut utiliser le mot-clef <tt>os</tt>&nbsp;:
d1093 1
a1093 1
$Translation: filter.html,v 1.55 2012/05/11 18:29:32 rustybsd Exp $<br>
@


1.48
log
@Sync with Steelix CVS
@
text
@d72 1
a72 1
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=pf&amp;sektion=4&amp;manpath=OpenBSD+5.0">pf(4)</a>
d141 1
a141 1
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=pflogd&amp;sektion=8&amp;manpath=OpenBSD+5.0">pflogd(8)</a>.
d822 1
a822 1
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=pflogd&amp;sektion=8&amp;manpath=OpenBSD+5.0">pflogd(8)</a>.
d953 1
a953 1
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=pf.os&amp;sektion=5&amp;manpath=OpenBSD+5.0"><tt>/etc/pf.os</tt></a>
d1092 2
a1093 2
Originally [OpenBSD: filter.html,v 1.61 ]<br>
$Translation: filter.html,v 1.54 2012/04/14 06:09:29 rustybsd Exp $<br>
@


1.47
log
@Sync with Steelix CVS
@
text
@d38 1
a38 1
[<a href="tables.html">Section précédente : Tables</a>]
d40 1
a40 1
[<a href="nat.html">Section suivante : Traduction des Adresses IP (&quot;NAT&quot;)</a>]
d42 1
a42 1
<h1><font color="#e00000">PF : Le Filtrage de Paquets</font></h1>
d92 1
a92 1
conformer les paquets et spécifient les actions qui y sont associées :
d157 1
a157 1
Plusieurs groupes sont également automatiquement créés par le noyau :
d162 1
a162 1
Par exemple : <tt>ppp</tt> ou <tt>carp</tt>.
d176 1
a176 1
prendre les valeurs suivantes :
d194 1
a194 1
adresses peuvent être spécifiées :
d215 1
a215 1
<li>grâce au nom d'une interface suivi d'un des paramètres suivants :
d217 1
a217 1
  <li><tt>:network</tt> - identifie un bloc CIDR (par exemple :
d220 1
a220 1
      (par exemple : 192.168.0.255)
d249 1
a249 1
    couche 4. Ces ports peuvent être spécifiés :
d257 1
a257 1
    opérateurs suivants :
d268 1
a268 1
            former un intervalle qui n'inclue pas ces arguments.
d280 2
a281 2
    l'utilisation de <tt>proto tcp</tt>. Cette valeur est spécifiée ainsi :
    <tt>flags <i>check</i>/<i>mask</i></tt>. Par exemple : <tt>flags S/SA</tt>.
d293 1
a293 1
    Pour les connnexions TCP, <tt>flags any</tt> est aussi généralement
d317 1
a317 1
Cette politique de blocage par défaut repose sur deux règles :
d334 1
a334 1
critères décrits précédemment : adresse et port source et destination,
d337 1
a337 1
restrictives possibles : il s'agit de n'autoriser que le trafic voulu et
d367 1
a367 1
l'emporte</b> sur les autres. Il y a cependant une exception : si l'option
d369 1
a369 1
aux critères de cette règle, il n'y a plus de tests : la règle en
d371 1
a371 1
exemples suivants illustrent ce cas de figure :
d374 1
a374 1
Mauvais :
d388 1
a388 1
Mieux :
d417 1
a417 1
<i>quel que soit leur sens</i> : il n'est alors plus nécessaire d'écrire
d430 1
a430 1
Toutes les règles <i>pass</i> créent de maniére automatique une entrée
d432 1
a432 1
Cela peut-être désactivé de maniére explicite en utilisant l'option
d461 1
a461 1
la sécurité des ISN :
d484 1
a484 1
<tt>state-policy</tt>. Par exemple :
a516 2
Filter rules that create state entries can specify various options to
control the behavior of the resulting state entry.
d520 1
a520 1
Les options suivantes sont disponibles :
d537 1
a537 1
Cette option a deux formats :
d582 1
a582 1
Une règle d'exemple :
d594 1
a594 1
La règle ci-dessus définit le comportement suivant :
d601 1
a601 1
<li>Limiter le nombre maximum de noeuds pouvant simultanément créer des
d640 1
a640 1
Un exemple :
d655 1
a655 1
Ceci permet de :
d672 1
a672 1
présentés dans la liste suivante :
d674 5
a678 5
<li><b>F</b> : FIN  - Fin de session
<li><b>S</b> : SYN  - Synchronize ; correspond à une ouverture de session
<li><b>R</b> : RST  - Reset ; met fin à une session
<li><b>P</b> : PUSH - Push ; le paquet est envoyé immédiatement
<li><b>A</b> : ACK - Acknowledgement ; atteste de l'acquittement d'une
d680 3
a682 3
<li><b>U</b> : URG  - Urgent
<li><b>E</b> : ECE  - Explicit Congestion Notification Echo ; avis de congestion
<li><b>W</b> : CWR - Congestion Window Reduced ; avis de réduction de la
d689 1
a689 1
La syntaxe est la suivante :
d728 1
a728 1
cette règle :
d742 1
a742 1
cette combinaison devrait être sûre :
d776 1
a776 1
state</tt> :
d810 1
a810 1
<tt>antispoof</tt> :
d835 1
a835 1
<dd>Spécifie le type d'adresse : <tt>inet</tt> pour IPv4 ou
d853 1
a853 1
<tt>antispoof</tt> sera décodée ainsi :
d864 1
a864 1
Cette règle déclenche deux actions :
d879 1
a879 1
<b>REMARQUE</b> : le filtrage activé par l'option <tt>antispoof</tt>
d883 1
a883 1
   devient primordial lors de l'utilisation de règles antispoof :
d896 1
a896 1
adresse IP aboutit au filtrage suivant :
d922 1
a922 1
dans les règles de filtrage le mot-clef <tt>urpf-failed</tt> :
d956 1
a956 1
consultée grâce à la commande suivante :
d968 1
a968 1
empreinte dans une règle, il faut utiliser le mot-clef <tt>os</tt> :
d1003 1
a1003 1
<tt>allow-opts</tt> :
d1080 1
a1080 1
[<a href="tables.html">Section précédente : Tables</a>]
d1082 1
a1082 1
[<a href="nat.html">Section suivante : Traduction des Adresses IP (&quot;NAT&quot;)</a>]
d1093 1
a1093 1
$Translation: filter.html,v 1.53 2012/03/17 09:55:33 benoit Exp $<br>
@


1.46
log
@Sync with Steelix CVS
@
text
@d974 4
a977 4
pass &nbsp;in on $ext_if from any os OpenBSD keep state<br>
block in on $ext_if from any os "Windows 2000"<br>
block in on $ext_if from any os "Linux 2.4 ts"<br>
block in on $ext_if from any os unknown
d1094 2
a1095 2
Originally [OpenBSD: filter.html,v 1.60 ]<br>
$Translation: filter.html,v 1.52 2011/11/05 09:20:59 benoit Exp $<br>
@


1.45
log
@Sync with Steelix CVS
@
text
@d72 1
a72 1
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=pf&amp;sektion=4&amp;manpath=OpenBSD+4.9">pf(4)</a>
d141 1
a141 1
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=pflogd&amp;sektion=8&amp;manpath=OpenBSD+4.9">pflogd(8)</a>.
d824 1
a824 1
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=pflogd&amp;sektion=8&amp;manpath=OpenBSD+4.9">pflogd(8)</a>.
d955 1
a955 1
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=pf.os&amp;sektion=5&amp;manpath=OpenBSD+4.9"><tt>/etc/pf.os</tt></a>
d1094 2
a1095 2
Originally [OpenBSD: filter.html,v 1.59 ]<br>
$Translation: filter.html,v 1.51 2011/07/03 07:48:03 benoit Exp $<br>
@


1.44
log
@Sync with Steelix CVS
@
text
@d1094 2
a1095 2
Originally [OpenBSD: filter.html,v 1.58 ]<br>
$Translation: filter.html,v 1.50 2011/05/07 06:58:36 benoit Exp $<br>
@


1.43
log
@Sync with Steelix CVS
@
text
@d72 1
a72 1
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=pf&amp;sektion=4&amp;manpath=OpenBSD+4.8">pf(4)</a>
d141 1
a141 1
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=pflogd&amp;sektion=8&amp;manpath=OpenBSD+4.8">pflogd(8)</a>.
d824 1
a824 2
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=pflogd&amp;sektion=8&amp;manpath=OpenBSD+4.8"
>pflogd(8)</a>.
d955 1
a955 2
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=pf.os&amp;sektion=5&amp;manpath=OpenBSD+4.8"
><tt>/etc/pf.os</tt></a>
d1094 2
a1095 2
Originally [OpenBSD: filter.html,v 1.57 ]<br>
$Translation: filter.html,v 1.49 2011/04/02 07:46:15 benoit Exp $<br>
@


1.42
log
@Sync with Steelix CVS
@
text
@d198 1
a198 1
<a href="http://public.pacbell.net/dedicated/cidr.html">CIDR</a>.
d708 1
a708 1
pass in on fxp0 proto tcp from any to any port ssh flags S/SA
d1096 2
a1097 2
Originally [OpenBSD: filter.html,v 1.55 ]<br>
$Translation: filter.html,v 1.48 2010/11/06 14:32:40 benoit Exp $<br>
@


1.41
log
@Sync with Steelix CVS
@
text
@d72 1
a72 1
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=pf&amp;sektion=4&amp;manpath=OpenBSD+4.7">pf(4)</a>
d141 1
a141 1
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=pflogd&amp;sektion=8&amp;manpath=OpenBSD+4.7">pflogd(8)</a>.
d824 1
a824 1
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=pflogd&amp;sektion=8&amp;manpath=OpenBSD+4.7"
d956 1
a956 1
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=pf.os&amp;sektion=5&amp;manpath=OpenBSD+4.7"
d1096 2
a1097 2
Originally [OpenBSD: filter.html,v 1.54 ]<br>
$Translation: filter.html,v 1.47 2010/09/25 13:57:54 benoit Exp $<br>
@


1.40
log
@Sync with Steelix CVS
@
text
@d72 1
a72 1
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=pf&amp;sektion=4&amp;manpath=OpenBSD+4.6">pf(4)</a>
d141 1
a141 1
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=pflogd&amp;sektion=8&amp;manpath=OpenBSD+4.6">pflogd(8)</a>.
d282 4
a285 5
    Dans ce cas, PF teste la valeur des drapeaux S et A (SYN et ACK) pour savoir
    s'ils sont positionnés. Si le drapeau SYN est positionné, et uniquement ce
    drapeau, alors la règle est applicable.
    A partir d'OpenBSD 4.1, les drapeaux par défaut <tt>S/SA</tt> sont
    appliqués à toutes les règles de filtrage TCP.
d291 4
d296 1
a296 2
    A partir d'OpenBSD 4.1, cette option est appliquée par défaut à
    toutes les règles de filtrage.
d377 1
a377 1
block in on fxp0 proto tcp from any to any port ssh<br>
d391 1
a391 1
block in quick on fxp0 proto tcp from any to any port ssh<br>
d430 4
a433 5
A partir d'OpenBSD 4.1, toutes les règles de filtrage créent
automatiquement une entrée dans la table d'état dès qu'un paquet les
active.
Dans les versions précédentes d'OpenBSD, une règle de filtrage doit
explicitement utiliser l'option <tt>keep state</tt>.
a434 2
<p>
Voici un exemple pour OpenBSD 4.1 et les versions suivantes :
d442 1
a442 9
Voici un exemple pour OpenBSD 4.0 et les versions antérieures :
<blockquote>
<tt>
pass out on fxp0 proto tcp from any to any keep state
</tt>
</blockquote>

<p>
Ces règles autorisent les connexions TCP sortantes sur l'interface
d454 4
a457 3
d'exploitation ne sachant pas générer d'ISN suffisamment aléatoires. A
partir de la version 3.5 d'OpenBSD, l'option <tt>modulate state</tt>
peut être utilisée pour les autres protocoles que TCP.
a497 3
<p>
Il faut noter que les règles <a href="nat.html"><tt>nat</tt></a>, <a href="nat.html#binat"><tt>binat</tt></a> et <a href="rdr.html"><tt>rdr</tt></a> créent implicitement des entrées dans la table d'état.

d709 1
d714 7
a720 18
Cette règle s'applique aux paquets TCP dont le drapeau SYN est
positionné. PF limite son inspection aux drapeaux SYN et ACK. La règle
s'applique donc à un paquet dont les drapeaux SYN et ECE sont
positionnés mais pas à un paquet dont les drapeaux SYN et ACK ou dont
seul le drapeau ACK sont positionnés.

<p>
A partir d'OpenBSD 4.1, les drapeaux appliqués par défaut aux règles TCP
sont <tt>flags S/SA</tt>.
Combinés avec le mot-clé <tt>keep state</tt> positionné par défaut au
niveau de toutes les règles de filtrage à partir d'OpenBSD 4.1, les deux
règles suivantes deviennent équivalentes :
<blockquote>
<tt>
pass out on fxp0 proto tcp all flags S/SA keep state<br>
pass out on fxp0 proto tcp all
</tt>
</blockquote>
a722 4
Chaque règle sera activée par les paquets TCP dont le drapeau SYN est
positionné et dont le drapeau ACK ne l'est pas et chacune de ces deux
règles créera une entrée dans la table d'état pour les paquets
correspondants.
a726 12
Jusqu'à OpenBSD 4.0, aucun drapeau n'était positionné par défaut par les
règles de filtrage.
Chaque règle devait spécifier le(s) drapeau(x) ainsi que l'option
<tt>keep state</tt>.

<blockquote>
<tt>
pass out on fxp0 proto tcp all flags S/SA keep state
</tt>
</blockquote>

<p>
d752 1
a752 1
<!--XXX scrub-->
d782 1
a782 2
pass in on $ext_if proto tcp from any to $web_server port www \<br>
&nbsp;&nbsp;&nbsp;flags S/SA synproxy state
d824 1
a824 1
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=pflogd&amp;sektion=8&amp;manpath=OpenBSD+4.6"
d915 1
a915 2
Depuis <a href="../../../fr/40.html">OpenBSD 4.0</a>, PF offre la
fonctionnalité Unicast Reverse Path Forwarding (uRPF).
d956 1
a956 1
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=pf.os&amp;sektion=5&amp;manpath=OpenBSD+4.6"
d1062 2
a1063 2
pass in  on $int_if from $lan_net to any
pass out on $int_if from any to $lan_net
d1077 1
a1077 1
pass in log on $ext_if proto tcp from any to ! &lt;firewall&gt; \
d1096 2
a1097 2
Originally [OpenBSD: filter.html,v 1.53 ]<br>
$Translation: filter.html,v 1.46 2009/11/30 10:59:52 benoit Exp $<br>
@


1.39
log
@Sync with Steelix CVS
@
text
@d1135 2
a1136 2
Originally [OpenBSD: filter.html,v 1.52 ]<br>
$Translation: filter.html,v 1.45 2009/10/22 16:19:58 benoit Exp $<br>
@


1.38
log
@Sync with Steelix CVS
@
text
@d572 1
a572 1
Cette option peut seulement être utilisée avec une règle <tt>source-track</tt>.
d1136 1
a1136 1
$Translation: filter.html,v 1.44 2009/10/19 15:48:30 benoit Exp $<br>
@


1.37
log
@Sync with Steelix CVS
@
text
@d72 1
a72 1
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=pf&amp;sektion=4&amp;manpath=OpenBSD+4.5">pf(4)</a>
d141 1
a141 1
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=pflogd&amp;sektion=8&amp;manpath=OpenBSD+4.5">pflogd(8)</a>.
d789 2
a790 1
Si le trafic est <a href="scrub.html">normalisé</a>, il peut être
d862 1
a862 1
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=pflogd&amp;sektion=8&amp;manpath=OpenBSD+4.5"
d995 1
a995 1
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=pf.os&amp;sektion=5&amp;manpath=OpenBSD+4.5"
d1082 1
a1082 1
scrub in all
d1135 2
a1136 2
Originally [OpenBSD: filter.html,v 1.51 ]<br>
$Translation: filter.html,v 1.43 2009/10/09 15:25:04 ajacoutot Exp $<br>
@


1.36
log
@Sync with Steelix CVS
@
text
@d353 1
a353 1
# pour les paquets autorisés.
d1135 1
a1135 1
$Translation: filter.html,v 1.42 2009/04/30 22:46:58 benoit Exp $<br>
@


1.35
log
@Sync with Steelix CVS
@
text
@d72 1
a72 1
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=pf&amp;sektion=4&amp;manpath=OpenBSD+4.4">pf(4)</a>
d141 1
a141 1
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=pflogd&amp;sektion=8&amp;manpath=OpenBSD+4.4">pflogd(8)</a>.
d861 1
a861 1
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=pflogd&amp;sektion=8&amp;manpath=OpenBSD+4.4"
d994 1
a994 1
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=pf.os&amp;sektion=5&amp;manpath=OpenBSD+4.4"
d1134 2
a1135 2
Originally [OpenBSD: filter.html,v 1.50 ]<br>
$Translation: filter.html,v 1.41 2009/01/25 20:10:53 benoit Exp $<br>
@


1.34
log
@Sync with Steelix CVS
@
text
@d1134 2
a1135 2
Originally [OpenBSD: filter.html,v 1.49 ]<br>
$Translation: filter.html,v 1.40 2008/11/26 22:39:38 benoit Exp $<br>
@


1.33
log
@Sync with Steelix CVS
@
text
@d72 1
a72 1
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=pf&amp;sektion=4&amp;manpath=OpenBSD+4.3">pf(4)</a>
d141 1
a141 1
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=pflogd&amp;sektion=8&amp;manpath=OpenBSD+4.3">pflogd(8)</a>.
d861 1
a861 1
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=pflogd&amp;sektion=8&amp;manpath=OpenBSD+4.3"
d994 1
a994 1
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=pf.os&amp;sektion=5&amp;manpath=OpenBSD+4.3"
d1134 2
a1135 2
Originally [OpenBSD: filter.html,v 1.48 ]<br>
$Translation: filter.html,v 1.39 2008/08/20 15:32:00 gapz Exp $<br>
@


1.32
log
@Sync with Steelix CVS
@
text
@d72 1
a72 1
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=pf&amp;sektion=4&amp;manpath=OpenBSD+4.2">pf(4)</a>
d141 1
a141 1
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=pflogd&amp;sektion=8&amp;manpath=OpenBSD+4.2">pflogd(8)</a>.
d861 1
a861 1
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=pflogd&amp;sektion=8&amp;manpath=OpenBSD+4.2"
d994 1
a994 1
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=pf.os&amp;sektion=5&amp;manpath=OpenBSD+4.2"
d1134 2
a1135 2
Originally [OpenBSD: filter.html,v 1.47 ]<br>
$Translation: filter.html,v 1.38 2008/01/11 10:52:47 saad Exp $<br>
@


1.31
log
@Sycn with steelix translation CVS
@
text
@d72 1
a72 1
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=pf&amp;sektion=4&amp;manpath=OpenBSD+4.1">pf(4)</a>
d141 1
a141 1
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=pflogd&amp;sektion=8&amp;manpath=OpenBSD+4.1">pflogd(8)</a>.
d335 1
a335 1
restrictives possible : il s'agit de n'autoriser que le trafic voulu et
d519 1
a519 1
type de protocole sans début ou fin de connexion explicites, PF
d540 2
a541 1
un état sont rejetés jusqu'à ce que le nombre d'états existants diminue.
d803 1
a803 1
(<a href="http://www.inetdaemon.com/tutorials/internet/tcp/connections.html"
d861 1
a861 1
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=pflogd&amp;sektion=8&amp;manpath=OpenBSD+4.1"
d994 1
a994 1
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=pf.os&amp;sektion=5&amp;manpath=OpenBSD+4.1"
d1134 2
a1135 2
Originally [OpenBSD: filter.html,v 1.44 ]<br>
$Translation: filter.html,v 1.36 2007/05/21 14:17:51 benoit Exp $<br>
@


1.30
log
@Sync with Steelix CVS
@
text
@d201 1
a201 1
    alors à tous les adresses du domaine.
d1134 1
a1134 1
$Translation: filter.html,v 1.35 2007/05/14 07:43:19 ajacoutot Exp $<br>
@


1.29
log
@Sync with Steelix CVS
@
text
@d528 5
a532 4
Quand une règle de filtrage crée une entrée dans la table d'états suite
à l'utilisation des mots clé <tt>keep state</tt>, <tt>modulate
state</tt> ou <tt>synproxy state</tt>, certaines options peuvent être
spécifiées afin de contrôler le comportement de ces créations d'états.
d1134 1
a1134 1
$Translation: filter.html,v 1.34 2007/05/10 16:08:21 saad Exp $<br>
@


1.28
log
@sync with Steelix CVS
@
text
@d14 1
a14 1
Copyright (c) 2003, 2004 Joel Knight <enabled@@myrealbox.com>
d72 1
a72 1
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=pf&amp;sektion=4&amp;manpath=OpenBSD+4.0">pf(4)</a>
d75 1
a75 1
(<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=ip&amp;sektion=4&amp;manpath=OpenBSD+4.0"
d77 1
a77 1
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=ip6&amp;sektion=4&amp;manpath=OpenBSD+4.0"
d79 1
a79 1
(<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=tcp&amp;sektion=4&amp;manpath=OpenBSD+4.0"
d81 1
a81 1
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=udp&amp;sektion=4&amp;manpath=OpenBSD+4.0"
d83 1
a83 1
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=icmp&amp;sektion=4&amp;manpath=OpenBSD+4.0"
d85 1
a85 1
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=icmp6&amp;sektion=4&amp;manpath=OpenBSD+4.0"
d141 4
a144 6
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=pflogd&amp;sektion=8&amp;manpath=OpenBSD+4.0">pflogd(8)</a>.
Si les options <tt>keep state</tt>, <tt>modulate state</tt>, ou
<tt>synproxy state</tt> sont également renseignées, seul le paquet
correspondant à l'ouverture de la session est conservé. Pour conserver
tous les paquets d'une session, il faut utiliser le mot-clef <tt>log
(all)</tt>.
d155 1
a155 1
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=ifconfig&amp;sektion=8&amp;manpath=OpenBSD+4.0"
d183 1
a183 1
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=protocols&amp;sektion=5&amp;manpath=OpenBSD+4.0"
d187 1
a187 1
	<a href="macros.html#lists">liste</a>.
d233 3
d253 1
a253 1
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=services&amp;sektion=5&amp;manpath=OpenBSD+4.0"
d258 1
a258 1
	<ul>
d285 2
d293 2
d420 24
a443 7
Quand l'option <tt>keep state</tt> est utilisée dans une règle, le
premier paquet qui déclenche l'activation de celle-ci provoque la
création d'un enregistrement dans la table d'état des connexions en
cours. Par la suite, non seulement les paquets allant de l'expéditeur au
destinataire sont rattachés à cette table et donc autorisés à passer,
mais également les paquets qui appartiennent aux réponses du
destinataire. Par exemple :
d451 1
a451 1
Cette règle autorise les connexions TCP sortantes sur l'interface
d482 3
a484 3
signaler une congestion par exemple, et que l'option <tt>keep state</tt>
est activée, les messages seront pris en compte et acceptés par le
pare-feu. Sans cela, ils auraient été bloqués ou ignorés.
d541 4
d582 11
d598 1
a598 1
&nbsp;&nbsp;&nbsp;&nbsp;port www flags S/SA keep state \<br>
d703 2
a704 1
flags <i>check</i>/<i>mask</i>
d713 2
d729 5
a733 1
Notez que les précédentes versions d'OpenBSD acceptaient cette syntaxe :
d736 2
a737 1
. . . flags S
d742 6
a747 2
Ce qui n'est plus vrai : le masque doit maintenant <i>toujours</i> être
renseigné.
d750 4
a753 2
Les drapeaux sont souvent utilisés avec l'option <tt>keep state</tt>
pour mieux contrôler la création des entrées dans la table d'état :
a761 4
Une entrée est créée pour tous les paquets TCP sortants dont le drapeau
SYN est positionné.

<p>
d775 5
a779 1
par la règle précédente. Une meilleure solution est :
d792 1
a792 4
normalisées. Il est fortement recommandé de toujours <tt>normaliser</tt>
(scrub) le trafic entrant :
<blockquote>
<tt>
a793 8
scrub in on fxp0<br>
.<br>
.<br>
.<br>
pass in on fxp0 proto tcp from any to any port ssh flags S/SA \<br>
&nbsp;&nbsp;&nbsp;keep state
</tt>
</blockquote>
d832 1
a832 1
(<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=bridge&amp;sektion=4&amp;manpath=OpenBSD+4.0"
d859 1
a859 1
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=pflogd&amp;sektion=8&amp;manpath=OpenBSD+4.0"
a976 15
<p>
Les hôtes étant des extremités IPsec ne devraient pas activer uRPF sur
l'interface
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=enc&amp;sektion=4&amp;manpath=OpenBSD+4.0"
><tt>enc0</tt></a>.
uRPF échouerait toujours sur <tt>enc0</tt> et bloquerait tous les
paquets. Si vous n'avez pas besoin de filtrer le trafic IPsec encapsulé,
<tt>set skip on enc0</tt> est alors recommandé.
Autrement, évitez uRPF sur cette interface.

<blockquote>
<tt>
block in quick on ! enc0 from urpf-failed label uRPF
</tt>
</blockquote>
d992 1
a992 1
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=pf.os&amp;sektion=5&amp;manpath=OpenBSD+4.0"
d1084 3
a1086 3
# Activation de la protection contre l'usurpation sur l'interface
# externe.
antispoof quick for $int_if inet
d1093 1
a1093 1
   to $int_if port ssh flags S/SA
d1096 2
d1103 3
a1105 5
# Activer le suivi des états pour les protocoles udp et icmp.
# Activer l'option modulate state sur les paquets tcp.

pass out on $ext_if proto tcp all modulate state flags S/SA
pass out on $ext_if proto { udp, icmp } all keep state
d1111 2
d1114 1
a1114 1
   port ssh flags S/SA synproxy state
d1132 2
a1133 2
Originally [OpenBSD: filter.html,v 1.40 ]<br>
$Translation: filter.html,v 1.33 2007/02/09 22:04:03 benoit Exp $<br>
@


1.27
log
@sync with Steelix CVS
@
text
@d84 1
a84 1
>ICMP</a>, et 
d207 1
a207 1
    </i></tt> (par exemple, <tt>/24</tt>). Toutes les adresses IP
d289 1
a289 1
<li><tt>keep state</tt> - s'applique aux protocoles TCP, UDP, et ICMP.
d328 1
a328 1
protocole, etc. Chaque fois qu'un paquet est autorisé à franchir les
d468 1
a468 1
<tt>floating-state</tt>. Les valeurs appliquées règle par règle on la même
d944 2
a945 2
<tt>set skip on enc0</tt> est aloas recommandé.
Autrement, éviter uRPF sur cette interface.
d1034 1
a1034 1
<a href="rdr.html"><tt>rdr</tt></a>, etc. 
d1106 1
a1106 1
$Translation: filter.html,v 1.32 2007/02/01 16:31:39 ajacoutot Exp $<br>
@


1.26
log
@sync with Steelix CVS
@
text
@d910 1
a910 1
Depuis <a href="../../../40.html">OpenBSD 4.0</a>, PF offre la
d1106 1
a1106 1
$Translation: filter.html,v 1.31 2006/12/26 10:29:45 ajacoutot Exp $<br>
@


1.25
log
@sync with steelix translation CVS
@
text
@d438 6
a443 6
paquets TCP sortants. Elle renforce le caractère aléatoire de leurs
numéros de séquence initiaux (ISN). Cette option permet de renforcer la
sécurité de certains systèmes d'exploitation ne sachant pas générer
d'ISN suffisamment aléatoires. A partir de la version 3.5 d'OpenBSD,
l'option <tt>modulate state</tt> peut être utilisée pour les autres
protocoles que TCP.
d1106 1
a1106 1
$Translation: filter.html,v 1.30 2006/12/24 17:59:23 aanriot Exp $<br>
@


1.24
log
@sync with steelix translation CVS
@
text
@d60 1
d72 1
a72 1
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=pf&amp;sektion=4&amp;manpath=OpenBSD+3.9">pf(4)</a>
d75 1
a75 1
(<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=ip&amp;sektion=4&amp;manpath=OpenBSD+3.9"
d77 1
a77 1
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=ip6&amp;sektion=4&amp;manpath=OpenBSD+3.9"
d79 1
a79 1
(<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=tcp&amp;sektion=4&amp;manpath=OpenBSD+3.9"
d81 1
a81 1
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=udp&amp;sektion=4&amp;manpath=OpenBSD+3.9"
d83 1
a83 1
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=icmp&amp;sektion=4&amp;manpath=OpenBSD+3.9"
d85 1
a85 1
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=icmp6&amp;sektion=4&amp;manpath=OpenBSD+3.9"
d124 5
a128 5
    correspondant aux critères contenus dans la règle. Les deux valeurs
    possibles sont <tt>pass</tt> et <tt>block</tt>.
<tt>pass</tt> signifie que le paquet sera transféré au noyau pour être
traité. Le blocage du paquet (<tt>block</tt>) sera fonction de la
politique définie par les options
d130 2
a131 2
associée par défaut peut être modifiée en spécifiant
<tt>block drop</tt> ou <tt>block return</tt>.
d135 1
a135 2
    : celui-ci peut être entrant (<tt>in</tt>) ou sortant
    (<tt>out</tt>).
d139 8
a146 8
    journalisation des paquets correspondants à la règle grâce à
    l'utilitaire
    <a href="http://www.openbsd.org/cgi-bin/man.cgi?query=pflogd&amp;sektion=8&amp;manpath=OpenBSD+3.9">pflogd(8)</a>.
    Si les options <tt>keep state</tt>, <tt>modulate state</tt>, ou
    <tt>synproxy state</tt> sont également renseignées, seul le paquet
    correspondant à l'ouverture de la session est conservé. Pour
    conserver tous les paquets d'une session, il faut utiliser le
    mot-clef <tt>log (all)</tt>.
d149 3
a151 3
<dd>Si le mot-clef <tt>quick</tt> est utilisé dans une règle, celle-ci est
    considérée comme étant la dernière à prendre en compte et
    l'<tt><i>action</i></tt> spécifiée est prise.
d154 14
a167 6
<dd>Ce mot-clef désigne l'interface sur laquelle le trafic est à
    analyser. Il est possible de grouper plusieurs interfaces. Dans ce
    cas, le groupe est désigné par le nom générique de l'interface non
    suivi d'un numéro. Par exemple : <tt>ppp</tt> ou <tt>fxp</tt>. La
    règle s'appliquera aux paquets traversant toute interface de type
    <tt>ppp</tt> ou <tt>fxp</tt> respectivement.
d171 4
a174 5
    appliquer une règle à l'aide de ce mot-clef. Les deux valeurs
    possibles sont <tt>inet</tt> pour les adresses IPv4 ou
    <tt>inet6</tt> pour IPv6. PF peut généralement déterminer à quelle
    famille appartient un paquet à partir de ses adresses source et
    destination.
d178 1
a178 1
    prendre les valeurs suivantes :
d185 1
a185 1
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=protocols&amp;sektion=5&amp;manpath=OpenBSD+3.9"
d189 1
a189 1
    <a href="macros.html#lists">liste</a>.
d195 2
a196 2
    destination du paquet telles que contenues dans son en-tête IP. Ces
    adresses peuvent être spécifiées :
d252 1
a252 1
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=services&amp;sektion=5&amp;manpath=OpenBSD+3.9"
d438 6
a443 5
paquets TCP sortants. L'option <tt>modulate state</tt> renforce le caractère
aléatoire de leurs numéros de séquence initiaux (ISN). Cette option permet de
renforcer la sécurité de certains systèmes d'exploitation ne sachant pas générer
des ISN suffisamment aléatoires. A partir de la version 3.5 d'OpenBSD, l'option
<tt>modulate state</tt> peut être utilisée pour les autres protocoles que TCP.
d792 1
a792 1
(<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=bridge&amp;sektion=4&amp;manpath=OpenBSD+3.9"
d819 1
a819 1
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=pflogd&amp;sektion=8&amp;manpath=OpenBSD+3.9"
d906 47
d967 1
a967 1
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=pf.os&amp;sektion=5&amp;manpath=OpenBSD+3.9"
d1105 2
a1106 2
Originally [OpenBSD: filter.html,v 1.37 ]<br>
$Translation: filter.html,v 1.29 2006/10/28 18:41:16 aanriot Exp $<br>
@


1.23
log
@sync with Steelix CVS
@
text
@d1050 2
a1051 2
Originally [OpenBSD: filter.html,v 1.36 ]<br>
$Translation: filter.html,v 1.28 2006/05/14 08:15:31 ajacoutot Exp $<br>
@


1.22
log
@sync with steelix translation CVS
@
text
@d96 3
a98 1
Sauf utilisation du mot-clef <tt>quick</tt> dans l'une d'entre elles, chaque paquet est évalué à l'aune de <i>toutes</i> les règles avant qu'une décision finale ne soit prise. 
d112 1
a112 1
<i>action</i> [<i>direction</i>] [log] [quick] [on <i>interface</i>]
d114 1
a114 1
&nbsp;&nbsp;&nbsp;[from <i>src_addr</i>] [port <i>src_port</i>]] [to 
a116 1

d259 1
a259 1
        <dd>Les trois derniers opérateurs demandent deux arguments pour
d1051 1
a1051 1
$Translation: filter.html,v 1.27 2006/05/02 10:12:39 ajacoutot Exp $<br>
@


1.21
log
@sync with steelix translation CVS
@
text
@d71 1
a71 1
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=pf&amp;sektion=4&amp;manpath=OpenBSD+3.8">pf(4)</a>
d74 1
a74 1
(<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=ip&amp;sektion=4&amp;manpath=OpenBSD+3.8"
d76 1
a76 1
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=ip6&amp;sektion=4&amp;manpath=OpenBSD+3.8"
d78 1
a78 1
(<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=tcp&amp;sektion=4&amp;manpath=OpenBSD+3.8"
d80 1
a80 1
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=udp&amp;sektion=4&amp;manpath=OpenBSD+3.8"
d82 1
a82 1
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=icmp&amp;sektion=4&amp;manpath=OpenBSD+3.8"
d84 1
a84 1
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=icmp6&amp;sektion=4&amp;manpath=OpenBSD+3.8"
d140 1
a140 1
    <a href="http://www.openbsd.org/cgi-bin/man.cgi?query=pflogd&amp;sektion=8&amp;manpath=OpenBSD+3.8">pflogd(8)</a>.
d177 1
a177 1
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=protocols&amp;sektion=5&amp;manpath=OpenBSD+3.8"
d244 1
a244 1
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=services&amp;sektion=5&amp;manpath=OpenBSD+3.8"
d783 1
a783 1
(<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=bridge&amp;sektion=4&amp;manpath=OpenBSD+3.8"
d810 1
a810 1
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=pflogd&amp;sektion=8&amp;manpath=OpenBSD+3.8"
d911 1
a911 1
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=pf.os&amp;sektion=5&amp;manpath=OpenBSD+3.8"
d1049 2
a1050 2
Originally [OpenBSD: filter.html,v 1.35 ]<br>
$Translation: filter.html,v 1.26 2006/04/20 06:42:51 ajacoutot Exp $<br>
@


1.20
log
@sync with Steelix CVS
@
text
@d573 1
a573 1
Un jeu séparé de restictions peut être placé sur les connexions TCP
d872 1
a872 1
   devient primmordial lors de l'utilisation de règles antispoof :
d1050 1
a1050 1
$Translation: filter.html,v 1.25 2006/03/09 14:46:29 ajacoutot Exp $<br>
@


1.19
log
@sync with Steelix CVS
@
text
@d34 1
a34 1
<a href="../../fr/index.html">
d101 1
a101 1
n'est applicable à un paquet, celui-ci est accepté.
d128 1
a128 1
associée à <tt>block</tt> par défaut peut être modifiée en spécifiant
d148 3
a150 3
<dd>Si ce mot-clef est utilisé dans une règle, celle-ci est considérée
    comme étant la dernière à prendre en compte. Les règles suivantes
    sont ignorées.
d198 4
a201 4
<li>par l'intermédiaire du nom d'une interface réseau suivi d'un masque
    de sous-réseau (<tt>/24</tt>). Toutes les adresses IP correspondant
    au bloc CIDR formé par l'adresse IP de l'interface et le
    <i>netmask</i> seront valides pour cette règle.
a256 1
        <li><tt>:</tt> (intervalle complet)
d261 5
d270 6
a275 9

<dd>L'activation d'une règle peut être conditionnée à la valeur des
    drapeaux TCP d'un paquet. Cette valeur est spécifiée ainsi :
    <tt>flags <i>check</i>/<i>mask</i></tt>.

Par exemple : <tt>flags S/SA</tt>. Dans ce cas, PF teste la valeur des
drapeaux S et A (SYN et ACK) pour savoir s'ils sont positionnés. Si le
drapeau SYN est positionné, et uniquement ce drapeau, alors la règle est
applicable.
d340 1
a340 1
# pour les paquets autorisés.<br> 
d351 2
a352 2
que c'est la dernière règle à laquelle correspond un paquet qui
l'emporte sur les autres. Il y a cependant une exception : si l'option
d382 2
a383 2
A première vue c'est la même chose. Toutefois la présence de l'option
<tt>quick</tt> provoque l'arrêt des tests pour chaque paquet qui
d422 4
a425 5
<tt>fxp0</tt> mais aussi les paquets retour. L'option <tt>keep
state</tt> permet donc d'augmenter les performances du pare-feu car la
recherche dans la table d'état est beaucoup plus rapide que l'opération
consistant à évaluer un paquet au regard de toutes les règles de
filtrage.
d430 5
a434 5
paquets TCP sortants. Elle renforce le caractère aléatoire de leurs
numéros de séquence initiaux (ISN). Cette option permet de renforcer la
sécurité de certains systèmes d'exploitation ne sachant pas générer des
ISN suffisamment aléatoires. A partir de la version 3.5 d'OpenBSD, cette
option peut être utilisée pour les autres protocoles que TCP.
d457 5
a461 3
<tt>state-policy</tt> d'une manière globale ou bien des options
<tt>if-bound</tt>, <tt>group-bound</tt> et <tt>floating-state</tt> dont
les valeurs sont appliquées règle par règle. Par exemple :
d535 1
a535 4
La portée de cette limite (uniquement les états créés par cette règle,
ou les états créés par toutes les règles qui utilisent
<tt>source-track</tt>) est dépendant de l'option <tt>source-track</tt>
spécifiée.
d856 4
a859 3
    ne passe <i>pas</i> par l'interface <tt>fxp0</tt>. Aucun paquet pour
    ce réseau ne devrait en effet être vu ailleurs que sur cette
    interface.
d884 2
a885 2
qui possèdent une adresse IP. Dans le cas contraire, on aboutit au
filtrage suivant :
d1050 1
a1050 1
$Translation: filter.html,v 1.24 2006/01/01 18:03:51 aanriot Exp $<br>
@


1.18
log
@sync with Steelix CVS
@
text
@d870 3
a872 2
   bouclage interne (loopback). Ce trafic doit donc être explicitement
   autorisé :
d875 1
a875 1
pass quick on lo0 all<br>
d994 3
d1001 1
a1001 6
block in  all
block out all

# Autorisation du trafic dans les deux sens sur l'adresse de bouclage
# interne.
pass quick on lo0 all
d1049 2
a1050 2
Originally [OpenBSD: filter.html,v 1.34 ]<br>
$Translation: filter.html,v 1.23 2005/12/31 00:45:21 saad Exp $<br>
@


1.17
log
@sync with Steelix CVS
@
text
@d145 1
a145 1
    mot-clef <tt>log-all</tt>.
d1050 2
a1051 2
Originally [OpenBSD: filter.html,v 1.33 ]<br>
$Translation: filter.html,v 1.22 2005/11/29 09:54:09 saad Exp $<br>
@


1.16
log
@sync with Steelix CVS
@
text
@d625 2
a626 1
<li>Limiter le taux du nombre de connexions à 15 dans une 5ème envergure
d1051 1
a1051 1
$Translation: filter.html,v 1.21 2005/11/02 19:38:09 aanriot Exp $<br>
@


1.15
log
@sync with Steelix CVS
@
text
@d71 1
a71 1
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=pf&amp;sektion=4&amp;manpath=OpenBSD+3.7">pf(4)</a>
d74 1
a74 1
(<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=ip&amp;sektion=4&amp;manpath=OpenBSD+3.7"
d76 1
a76 1
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=ip6&amp;sektion=4&amp;manpath=OpenBSD+3.7"
d78 1
a78 1
(<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=tcp&amp;sektion=4&amp;manpath=OpenBSD+3.7"
d80 1
a80 1
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=udp&amp;sektion=4&amp;manpath=OpenBSD+3.7"
d82 1
a82 1
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=icmp&amp;sektion=4&amp;manpath=OpenBSD+3.7"
d84 1
a84 1
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=icmp6&amp;sektion=4&amp;manpath=OpenBSD+3.7"
d140 1
a140 1
    <a href="http://www.openbsd.org/cgi-bin/man.cgi?query=pflogd&amp;sektion=8&amp;manpath=OpenBSD+3.7">pflogd(8)</a>.
d177 1
a177 1
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=protocols&amp;sektion=5&amp;manpath=OpenBSD+3.7"
d244 1
a244 1
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=services&amp;sektion=5&amp;manpath=OpenBSD+3.7"
d783 1
a783 1
(<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=bridge&amp;sektion=4&amp;manpath=OpenBSD+3.7"
d810 1
a810 1
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=pflogd&amp;sektion=8&amp;manpath=OpenBSD+3.7"
d909 1
a909 1
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=pf.os&amp;sektion=5&amp;manpath=OpenBSD+3.7"
d1049 2
a1050 2
Originally [OpenBSD: filter.html,v 1.32 ]<br>
$Translation: filter.html,v 1.20 2005/10/16 10:02:48 saad Exp $<br>
@


1.14
log
@sync with Steelix CVS
@
text
@d730 3
a732 2
positionnés de manière illicite (par exemple : SYN et FIN ou SYN et
RST). Il est fortement recommandé de toujours <tt>normaliser</tt>
d1049 2
a1050 2
Originally [OpenBSD: filter.html,v 1.31 ]<br>
$Translation: filter.html,v 1.19 2005/07/28 09:09:44 saad Exp $<br>
@


1.13
log
@sync with Steelix CVS
@
text
@d144 2
a145 2
    conserver tous les paquets d'une session, il faut utiliser le mot-
    clef <tt>log-all</tt>.
d209 1
a209 1
<li>grâce au nom d'une interface suivie d'un des paramètres suivants :
d222 1
a222 1
      d'adresses IP affectées à l'interface. Ces paramètres peuvent
d234 1
a234 1
    n'importe quelles destination).
d286 1
a286 1
    attaques par inondations de paquets SYN en provenance d'adresses
d393 1
a393 1
appartient. PF utilise pour cela une table d'état gràce à laquelle PF
d401 1
a401 1
<i>quelque soit leur sens</i> : il n'est alors plus nécessaire d'écrire
d452 2
a453 2
est activée, les messages seront pris en compte et acceptés par le pare-
feu. Sans cela, ils auraient été être bloqués ou ignorés.
d474 1
a474 1
Il faut noter que les règles <a href="nat.html"><tt>nat</tt></a>, <a href="nat.html#binat"><tt>binat</tt></a> et <a href="rdr.html"><tt>rdr</tt></a> créent implicitement des entrées dans la tables d'état.
d486 2
a487 2
type de protocole sans début ou de fin de connexion explicites, PF
conserve simplement une trace de la durée d'une session. Si il s'écoule
d489 2
a490 2
la table d'état associée à la session est vidée. Ce laps de temps peut
être configuré dans la section
d494 1
a494 1
<h2>Options de Suivis Stateful</h2>
d505 1
a505 1
SI le maximum est atteint, les paquets qui devraient normalement créer
d509 1
a509 1
<dd>Cette option active le suivis du nombre d'états créés par adresse IP
d514 2
a515 2
           par cette règle est limité par les options <tt>max-src-
           nodes</tt> et <tt>max-src-states</tt> de la règle. Seules les
d520 2
a521 2
           Chaque règle peut spécifier différentes options <tt>max-src-
           nodes</tt> et <tt>max-src-states</tt>, cependant, les entrées
d525 2
a526 2
Le nombre total d'adresses IP source suivis globalement peut être
controllé via l'option
d539 1
a539 1
<dd>LOrsque l'option <tt>source-track</tt> est utilisée,
d541 1
a541 1
simultanéespouvant être crées par adresse IP source.
d565 1
a565 1
<li>Activer le suivis de la source; limiter la création d'états pour
d580 1
a580 1
réalisées la poignée de main qu'un hôte peut initier.
d590 1
a590 1
Ces limites étant placées sur les connexions TCP ayant réalisées la
d592 1
a592 1
avoir lieu depuis les adresses ip concernées.
d599 1
a599 1
qui ont été crées par cette adresse IP source.
d652 1
a652 1
Le mot-clef <tt>flags</tt> doit apparaitre dans une règle si l'on
d899 1
a899 1
Fingerprinting&quot; ou OSFP) est une méthode qui permet de reconnaitre
d910 1
a910 1
pour reconnaitre les systèmes d'exploitation auxquels il a à faire.
d912 1
a912 1
consultée gràce à la commande suivante :
d958 2
a959 2
ou les diffusions multicast) il est possible d'utiliser l'option <tt>allow-
opts</tt> :
d970 3
a972 3
Vous trouverez ci-dessous un exemple de règles de filtrage pour un pare-
feu PF destiné à protèger un petit réseau connecté à Internet. Seules
les règles de filtrage sont mentionées ;
d987 2
a988 2
# déclaration du tableau référençant toutes les adresses IP affectées au
# pare-feu
d991 1
a991 1
# Normalisation de tous les paquets entrants
d994 1
a994 1
# Mise en place d'une politique d'interdiction par défaut
d999 1
a999 1
# interne
d1009 1
a1009 1
# assure que que cette règle n'est pas contredite par les règles "pass".
d1026 1
a1026 1
# qu'elles ne sont pas destinées au pare-feu lui-même Journalise le
d1049 1
a1049 1
$Translation: filter.html,v 1.18 2005/05/21 07:33:19 aanriot Exp $<br>
@


1.12
log
@Sync with Steelix CVS
@
text
@d71 1
a71 1
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=pf&amp;sektion=4&amp;manpath=OpenBSD+3.6">pf(4)</a>
d74 1
a74 1
(<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=ip&amp;sektion=4&amp;manpath=OpenBSD+3.6"
d76 1
a76 1
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=ip6&amp;sektion=4&amp;manpath=OpenBSD+3.6"
d78 1
a78 1
(<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=tcp&amp;sektion=4&amp;manpath=OpenBSD+3.6"
d80 1
a80 1
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=udp&amp;sektion=4&amp;manpath=OpenBSD+3.6"
d82 1
a82 1
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=icmp&amp;sektion=4&amp;manpath=OpenBSD+3.6"
d84 1
a84 1
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=icmp6&amp;sektion=4&amp;manpath=OpenBSD+3.6"
d140 1
a140 1
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=pflogd&amp;sektion=8&amp;manpath=OpenBSD+3.6">pflogd(8)</a>.
d177 1
a177 1
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=protocols&amp;sektion=5&amp;manpath=OpenBSD+3.6"
d244 1
a244 1
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=services&amp;sektion=5&amp;manpath=OpenBSD+3.6"
d573 59
d782 1
a782 1
(<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=bridge&amp;sektion=4&amp;manpath=OpenBSD+3.6"
d809 1
a809 1
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=pflogd&amp;sektion=8&amp;manpath=OpenBSD+3.6"
d907 2
a908 1
<a href="options.html#fingerprints">d'empreintes</a> <a href="http://www.openbsd.org/cgi-bin/man.cgi?query=pf.os&amp;sektion=5&amp;manpath=OpenBSD+3.6"
d1048 2
a1049 2
Originally [OpenBSD: filter.html,v 1.30 ]<br>
$Translation: filter.html,v 1.17 2005/02/26 08:05:03 aanriot Exp $<br>
@


1.11
log
@sync with Steelix CVS
@
text
@d56 1
d493 80
d868 4
a871 4
pass &nbsp;in on $ext_if any os OpenBSD keep state<br>
block in on $ext_if any os "Windows 2000"<br>
block in on $ext_if any os "Linux 2.4 ts"<br>
block in on $ext_if any os unknown
d988 2
a989 2
Originally [OpenBSD: filter.html,v 1.28 ]<br>
$Translation: filter.html,v 1.15 2005/02/22 09:44:53 saad Exp $<br>
@


1.10
log
@Sync with Steelix CVS
@
text
@d907 2
a908 2
Originally [OpenBSD: filter.html,v 1.27 ]<br>
$Translation: filter.html,v 1.14 2005/01/29 04:53:04 saad Exp $<br>
@


1.9
log
@Sync with Steelix CVS
@
text
@d109 4
a112 4
<i>action</i> <i>direction</i> [log] [quick] on <i>interface</i> [<i>af</i>] 
[proto <i>protocol</i>] \<br>
&nbsp;&nbsp;&nbsp;from <i>src_addr</i> [port <i>src_port</i>] to 
<i>dst_addr</i> [port <i>dst_port</i>] \<br>
d907 2
a908 2
Originally [OpenBSD: filter.html,v 1.26 ]<br>
$Translation: filter.html,v 1.13 2005/01/17 21:34:48 aanriot Exp $<br>
@


1.8
log
@sync with Steelix CVS
@
text
@d906 1
d908 2
a909 1
$Translation: filter.html,v 1.12 2004/12/29 10:33:01 saad Exp $<br>
@


1.7
log
@sync with Steelix CVS
@
text
@d34 3
a36 1
<img alt="[OpenBSD]" height=30 width=141 src="../../../images/smalltitle.gif">
d906 2
a907 2
Originally [OpenBSD: filter.html,v 1.25 ]<br>
$Translation: filter.html,v 1.10 2004/11/03 15:28:25 saad Exp $<br>
@


1.6
log
@sync with Steelix CVS
@
text
@d111 1
a111 1
&nbsp;&nbsp;&nbsp;[<i>tcp_flags</i>] [<i>state</i>]
d904 2
a905 2
Originally [OpenBSD: filter.html,v 1.24 ]<br>
$Translation: filter.html,v 1.9 2004/11/01 00:12:28 saad Exp $<br>
@


1.5
log
@Sync with Steelix CVS
@
text
@d68 1
a68 1
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=pf&amp;sektion=4&amp;manpath=OpenBSD+3.5">pf(4)</a>
d71 1
a71 1
(<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=ip&amp;sektion=4&amp;manpath=OpenBSD+3.5"
d73 1
a73 1
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=ip6&amp;sektion=4&amp;manpath=OpenBSD+3.5"
d75 1
a75 1
(<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=tcp&amp;sektion=4&amp;manpath=OpenBSD+3.5"
d77 1
a77 1
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=udp&amp;sektion=4&amp;manpath=OpenBSD+3.5"
d79 1
a79 1
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=icmp&amp;sektion=4&amp;manpath=OpenBSD+3.5"
d81 1
a81 1
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=icmp6&amp;sektion=4&amp;manpath=OpenBSD+3.5"
d137 1
a137 1
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=pflogd&amp;sektion=8&amp;manpath=OpenBSD+3.5">pflogd(8)</a>.
d174 1
a174 1
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=protocols&amp;sektion=5&amp;manpath=OpenBSD+3.5"
d241 1
a241 1
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=services&amp;sektion=5&amp;manpath=OpenBSD+3.5"
d640 1
a640 1
(<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=bridge&amp;sektion=4&amp;manpath=OpenBSD+3.5"
d667 1
a667 1
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=pflogd&amp;sektion=8&amp;manpath=OpenBSD+3.5"
d765 1
a765 1
<a href="options.html#fingerprints">d'empreintes</a> <a href="http://www.openbsd.org/cgi-bin/man.cgi?query=pf.os&amp;sektion=5&amp;manpath=OpenBSD+3.5"
d904 2
a905 2
Originally [OpenBSD: filter.html,v 1.22 ]<br>
$Translation: filter.html,v 1.8 2004/10/18 12:50:56 saad Exp $<br>
@


1.4
log
@Sync with Steelix CVS
@
text
@d269 3
a271 2
drapeaux S et A (SYN et ACK) pour savoir s'ils sont positionnés. Si tel
est le cas, la règle est applicable.
d904 2
a905 2
Originally [OpenBSD: filter.html,v 1.21 ]<br>
$Translation: filter.html,v 1.7 2004/10/13 11:53:05 saad Exp $<br>
@


1.3
log
@Sync with Steelix CVS
@
text
@d4 1
a4 1
<title>PF: Filtrage de Paquets</title>
d904 1
a904 1
$Translation: filter.html,v 1.6 2004/10/11 21:34:24 saad Exp $<br>
@


1.2
log
@Sync with Steelix CVS
@
text
@d38 1
a38 1
[<a href="nat.html">Section suivante : Traduction des Adresses IP ("NAT")</a>]
d67 4
a70 2
Le filtrage de paquets à l'aide de <a href="http://www.openbsd.org/cgi-bin/man.cgi?query=pf&amp;sektion=4&amp;manpath=OpenBSD+3.5"
>pf(4)</a> consiste à autoriser ou bloquer le trafic réseau en fonction des propriétés des protocoles des couches 3 
d82 3
a84 1
>ICMPv6</a>). Les adresses et ports source et destination ainsi que les protocoles utilisés sont des critères fréquemment employés.
d87 5
a91 1
Les règles de filtrage énumèrent les critères auxquels doivent se conformer les paquets et spécifient les actions qui y sont associées : bloquer ou laisser passer. Ces règles sont évaluées de façon séquentielle de la première à la dernière (du haut vers le bas dans les fichiers de règles utilisés).
d95 4
a98 2
L'action (block ou pass) associée à la dernière règle dont les critères se rapportent au paquet traitée est appliquée. 
La première règle est un <tt>tout laisser passer</tt> implicite de sorte que si aucune règle n'est applicable à un paquet, celui-ci est accepté.
d103 2
a104 1
L'écriture des règles obéit à la syntaxe <i>très simplifiée</i> suivante :
d118 9
a126 4
<dd>Ce mot-clef indique le type d'action associé à tout paquet correspondant aux critères contenus dans la règle. Les deux valeurs possibles sont <tt>pass</tt> et <tt>block</tt>. 
<tt>pass</tt> signifie que le paquet sera transféré au noyau pour être traité. 
Le blocage du paquet (<tt>block</tt>) sera fonction de la politique définie par les options <a href="options.html#block-policy"><tt>block-policy</tt></a>. L'action associée à <tt>block</tt> par défaut peut être modifiée en spécifiant <tt>block
drop</tt> ou <tt>block return</tt>.
d129 3
a131 1
<dd>Ce mot-clef spécifie le sens du trafic vu depuis l'interface réseau : celui-ci peut être entrant (<tt>in</tt>) ou sortant (<tt>out</tt>).
d134 9
a142 3
<dd>La présence de ce mot-clef dans une règle déclenche la journalisation des paquets correspondants à la règle grâce à l'utilitaire 
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=pflogd&amp;sektion=8&amp;manpath=OpenBSD+3.5"
>pflogd(8)</a>. Si les options <tt>keep state</tt>, <tt>modulate state</tt>, ou <tt>synproxy state</tt> sont également renseignées, seul le paquet correspondant à l'ouverture de la session est conservé. Pour conserver tous les paquets d'une session, il faut utiliser le mot-clef <tt>log-all</tt>.
d145 3
a147 1
<dd>Si ce mot-clef est utilisé dans une règle, celle-ci est considérée comme étant la dernière à prendre en compte. Les règles suivantes sont ignorées.
d150 6
a155 2
<dd>Ce mot-clef désigne l'interface sur laquelle le trafic est à analyser. Il est possible de grouper plusieurs interfaces. Dans ce cas, le groupe est désigné par le nom générique de l'interface non suivi d'un numéro. Par exemple : 
<tt>ppp</tt> or <tt>fxp</tt>. La règle s'appliquera aux paquets traversant toute interface de type <tt>ppp</tt> et tt>fxp</tt>.
d158 6
a163 1
<dd>Il est possible de spécifier la famille d'adresses IP à laquelle appliquer une règle à l'aide de ce mot-clef. Les deux valeurs possibles sont <tt>inet</tt> pour les adresses IPv4 ou <tt>inet6</tt> pour IPv6. PF peut généralement déterminer à quelle famille appartient un paquet à partir de ses adresses source et destination.
d166 2
a167 1
<dd>Ce mot-clef identifie les protocoles de couche 4 utilisés. Il peut prendre les valeurs suivantes :
d173 2
a174 1
<li>tout protocole spécifié dans le fichier <a href="http://www.openbsd.org/cgi-bin/man.cgi?query=protocols&amp;sektion=5&amp;manpath=OpenBSD+3.5"
d177 2
a178 1
<li>un ensemble de protocoles passé dans une <a href="macros.html#lists">liste</a>.
d183 3
a185 1
<dd>Ces mots-clefs identifient respectivement l'adresse source et de destination du paquet telle que contenue dans son en-tête IP. Ces adresses peuvent être spécifiées :
d188 18
a205 5
<li>sous la forme d'un bloc d'adresses <a href="http://public.pacbell.net/dedicated/cidr.html">CIDR</a>.
<li>sous la forme d'un domaine. Ce dernier fera l'objet d'une résolution DNS lors du chargement des règles par PF. La règle s'appliquera alors à tous les adresses du domaine.
<li>par l'intermédiaire du nom d'une interface réseau. Toute adresse IP affectée à cette interface sera valide pour la règle.
<li>par l'intermédiaire du nom d'une interface réseau suivi d'un masque de sous-réseau (<tt>/24</tt>). Toutes les adresses IP correspondant au bloc CIDR formé par l'adresse IP de l'interface et le <i>netmask</i> seront valides pour cette règle. 
<li>sous la forme du nom d'une interface réseau mis entre parenthèses <tt>( )</tt>. Cette mise en forme indique à PF qu'il doit mettre ses règles à jour en cas de changement de l'adresse IP affectée à l'interface en question. Cette technique est très utile dans le cas de liaisons PPP ou d'utilisation du protocole DHCP pour l'attribution d'adresses IP. Elle évite d'avoir à recharger les règles à chaque nouvelle affectation. 
d208 6
a213 3
  <li><tt>:network</tt> - identifie un bloc CIDR (par exemple : 192.168.0.0/24)
  <li><tt>:broadcast</tt> - identifie une adresse de multi-diffusion (par exemple : 192.168.0.255)
  <li><tt>:peer</tt> - identifie l'adresse d'un pair sur un lien point à point.
d216 6
a221 1
  <dd>De plus, le paramètre <tt>:0</tt> peut être ajouté aussi bien au nom d'une interface qu'à chacun des paramètres présentés ci-dessus. PF ne prend alors pas en compte les éventuels alias d'adresses IP affectées à l'interface. Ces paramètres peuvent aussi être utilisés dans le cas d'une interface entre parenthèses. Par exemple: <tt>fxp0:network:0</tt>
d223 3
a225 2
<li>à l'aide d'un <a href="tables.html">tableau</a>.
<li>sous toutes les formes décrites ci-dessus précédées du paramètre d'inversion <tt>!</tt> ("non").
d227 5
a231 3
<li>grâce au mot-clef <tt>any</tt> qui identifie n'importe quelle adresse.
<li>grâce au mot-clef <tt>all</tt> qui est un raccourci pour l'expression <tt>from any to any</tt> (n'importe quelle source vers n'importe quelles destination).

d235 3
a237 1
<dd>Ces mots-clefs identifient respectivement les ports source et destination qui apparaissent dans les en-têtes des protocoles de couche 4. Ces ports peuvent être spécifiés :
d244 3
a246 2
<li>sous la forme d'un intervalle de ports construit à l'aide des opérateurs suivants :

d256 2
a257 1
        <dd>Les trois derniers opérateurs demandent deux arguments pour former un intervalle qui n'inclue pas ces arguments.
d264 7
a270 2
<dd>L'activation d'une règle peut être conditionnée à la valeur des drapeaux TCP d'un paquet. Cette valeur est spécifiée ainsi : <tt>flags <i>check</i>/<i>mask</i></tt>. 
Par exemple : <tt>flags S/SA</tt>. Dans ce cas, PF teste la valeur des drapeaux S et A (SYN et ACK) pour savoir s'ils sont positionnés. Si tel est le cas, la règle est applicable.
d273 2
a274 1
<dd>Ce mot-clef indique dans quel état doit être le paquet pour satisfaire à une règle.
d277 8
a284 2
<li><tt>modulate state</tt> - ne s'applique qu'au protocole TCP. PF renforcera le caractère aléatoire des numéros de séquence initiaux (ISN) générés pour ces paquets.
<li><tt>synproxy state</tt> - PF agit comme mandataire pour les connexions TCP entrantes. Cela renforce la protection contre les attaques par inondations de paquets SYN en provenance d'adresses usurpées. Cette option active implicitement les fonctionnalités <tt>keep state</tt> et <tt>modulate state</tt>.
d290 5
a294 3
Il est recommandé d'adopter une approche de blocage par défaut lors de la configuration d'un pare-feu. 
Cela signifie que <i>tout</i> est interdit et que l'on autorise le trafic au cas par cas. 
Cette approche est assimilable à l'application d'un principe de précaution et simplifie l'écriture des règles.
d306 2
a307 1
Cela suffit à interdire tout trafic dans un sens comme dans l'autre et ce sur toutes les interfaces de la machine.
d312 7
a318 2
Une fois mise en place notre politique restrictive, il faut spécifier quelles sont les connexions autorisées. C'est là qu'entrent en jeu les critères décrits précédemment : adresse et port source et destination, protocole, etc.
Chaque fois qu'un paquet est autorisé à franchir les murs du pare-feu, les règles correspondantes devront être les plus restrictives que possible : il s'agit de n'autoriser que le trafic voulu et lui seul.
d342 10
a351 2
Comme nous l'avons vu, chaque paquet est testé au regard de toutes les règles de filtrage, de la première à la dernière. 
Par défaut, un paquet est marqué à chaque test. Le résultat final peut ainsi changer d'une règle à l'autre jusqu'à ce que toutes aient été parcourues. Rappelons que c'est la dernière règle à laquelle correspond un paquet qui l'emporte sur les autres. Il y a cependant une exception : si l'option <tt>quick</tt> est présente dans une règle et qu'un paquet correspond aux critères de cette règle, il n'y a plus de tests : la règle en question est alors considérée par PF comme étant la dernière. Les exemples suivants illustrent ce cas de figure :
d363 3
a365 1
La ligne <tt>block</tt> n'aura aucun effet. Les paquets seront bien évalués suivant ses critères, mais la ligne suivante annulera tout effet de cette première règle.
d377 5
a381 1
A première vue c'est la même chose. Toutefois la présence de l'option <tt>quick</tt> provoque l'arrêt des tests pour chaque paquet qui correspond aux critères de la première règle. Les paquets qui n'y satisfont pas seront quant à eux testés au regard des critères de la règle suivante. 
d386 23
a408 7
Une des fonctionnalités les plus importantes de PF est sa capacité à conserver l'état des connexions. PF est capable d'évaluer un paquet non plus unitairement mais dans le contexte de la connexion à laquelle il appartient. PF utilise pour cela une table d'état gràce à laquelle PF peut rapidement déterminer si un paquet fait partie d'une connexion déjà établie et autorisée. Si tel est le cas, le paquet est transféré sans test complémentaire.

<p>
Conserver l'état des connexions a pour avantage de simplifier les règles de filtrage et d'améliorer les performances. PF évalue les paquets <i>quelque soit leur sens</i> : il n'est alors plus nécessaire d'écrire les règles pour les paquets des  lux retour. PF consacre ainsi beaucoup moins de temps à inspecter les paquets.

<p>
Quand l'option <tt>keep state</tt> est utilisée dans une règle, le premier paquet qui déclenche l'activation de celle-ci provoque la création d'un enregistrement dans la table d'état des connexions en cours. Par la suite, non seulement les paquets allant de l'expéditeur au destinataire sont rattachés à cette table et donc autorisés à passer, mais également les paquets qui appartiennent aux réponses du destinataire. Par exemple :
d416 15
a430 2
Cette règle autorise les connexions TCP sortantes sur l'interface <tt>fxp0</tt> mais aussi les paquets retour. 
L'option <tt>keep state</tt> permet donc d'augmenter les performances du pare-feu car la recherche dans la table d'état est beaucoup plus rapide que l'opération consistant à évaluer un paquet au regard de toutes les règles de filtrage.
d433 2
a434 4
L'option <tt>modulate state</tt> fonctionne de la même façon que l'option <tt>keep state</tt> à ceci près qu'elle ne s'applique qu'aux paquets TCP sortants. Elle renforce le caractère aléatoire de leurs numéros de séquence initiaux (ISN). Cette option permet de renforcer la sécurité de certains systèmes d'exploitation ne sachant pas générer des ISN suffisamment aléatoires. A partir de la version 3.5 d'OpenBSD, cette option peut être utilisée pour les autres protocoles que TCP.

<p>
Pour conserver l'état des connexions TCP, UDP et ICMP tout en renforçant la sécurité des ISN :
d444 6
a449 1
Un des avantages de conserver l'état des connexions tient à ce que les messages ICMP relatifs à celles-ci seront traités comme faisant partie de la connexion. Si des messages ICMP sont émis par une machine pour signaler une congestion par exemple, et que l'option <tt>keep state</tt> est activée, les messages seront pris en compte et acceptés par le pare-feu. Sans cela, ils auraient été être bloqués ou ignorés. 
d452 4
a455 1
La portée d'une entrée dans la table d'état dépend des options <tt>state-policy</tt> d'une manière globale ou bien des options <tt>if-bound</tt>, <tt>group-bound</tt> et <tt>floating-state</tt> dont les valeurs sont appliquées règle par règle. Par exemple :
d465 2
a466 1
Selon cette règle, les paquets ne trouveront une correspondance dans la table d'état que s'ils transitent par l'interface <tt>fxp0</tt>.
d476 11
a486 1
On entend souvent dire qu'il est impossible d'utiliser la table d'état avec UDP car c'est un protocole sans état. S'il est vrai qu'une connexion UDP n'utilise pas stricto sensu le concept d'état tel que le fait une connexion TCP (à savoir une ouverture et une terminaison explicites de la connexion), cela n'a aucune conséquence sur la capacité qu'a PF de créer et gérer des états pour les connexions UDP. Pour ce type de protocole sans début ou de fin de connexion explicites, PF conserve simplement une trace de la durée d'une session. Si il s'écoule un certain laps de temps sans échange de paquets entre les deux parties, la table d'état associée à la session est vidée. Ce laps de temps peut être configuré dans la section 
d492 3
a494 1
On utilise souvent les drapeaux TCP dans des règles pour traiter les ouvertures de sessions. Ces drapeaux et leur signification sont présentés dans la liste suivante :
d500 2
a501 1
<li><b>A</b> : ACK  - Acknowledgement ; atteste de l'accord d'une des parties
d504 2
a505 1
<li><b>W</b> : CWR  - Congestion Window Reduced ; avis de réduction de la fenêtre TCP
d509 3
a511 1
Le mot-clef <tt>flags</tt> doit apparaitre dans une règle si l'on souhaite que PF prenne en compte la valeur des drapeaux TCP d'un paquet. La syntaxe est la suivante :
d519 4
a522 1
La partie <tt><i>mask</i></tt> de la règle indique la liste des drapeaux que PF doit inspecter. La partie <tt><i>check</i></tt> quant à elle spécifie les drapeaux qui doivent être positionnés pour que la règle s'applique au paquet traité. 
d530 5
a534 1
Cette règle s'applique aux paquets TCP dont le drapeau SYN est positionné. PF limite son inspection aux drapeaux SYN et ACK. La règle s'applique donc à un paquet dont les drapeaux SYN et ECE sont positionnés mais pas à un paquet dont les drapeaux SYN et ACK ou dont seul le drapeau ACK sont positionnés. 
d537 1
a537 1
Notez que les précédentes versions d'OpenBSD acceptaient cette syntaxe : 
d545 2
a546 1
Ce qui n'est plus vrai : le masque doit maintenant <i>toujours</i> être renseigné.
d549 2
a550 1
Les drapeaux sont souvent utilisés avec l'option <tt>keep state</tt> pour mieux contrôler la création des entrées dans la table d'état :
d559 2
a560 1
Une entrée est créée pour tous les paquets TCP sortants dont le drapeau SYN est positionné.
d563 4
a566 1
Il faut manipuler les drapeaux avec prudence et se méfier des mauvais conseils. Certaines personnes suggèrent de ne créer des entrées que pour les paquets dont le drapeau SYN est positionné. Ce qui peut aboutir à cette règle :
d572 5
a576 1
En théorie, une session TCP commence par un paquet dont le drapeau SYN est positionné. Toujours en théorie, il ne faut créer une entrée dans la table d'état que pour ce genre de paquets. Mais certains systèmes utilisent le drapeau ECN en début de session. Ces paquets sont rejetés par la règle précédente. Une meilleure solution est :
d584 6
a589 1
Si le trafic est <a href="scrub.html">normalisé</a>, il peut être pratique et sûr de ne pas tester la valeur des drapeaux FIN et RST. Dans ce cas, PF rejette tout paquet entrant dont les drapeaux TCP sont positionnés de manière illicite (par exemple : SYN et FIN ou SYN et RST). Il est fortement recommandé de toujours <tt>normaliser</tt> (scrub) le trafic entrant :
d606 2
a607 1
Normalement, quand un client ouvre une connexion TCP vers un serveur, PF relaie les paquets d'ouverture  
d610 6
a615 1
PF peut agir en tant que mandataire (proxy). Dans ce cas, PF va traiter la demande en lieu et place du serveur et ne transfèrera qu'ensuite les paquets à ce dernier. Aucun paquet n'est transmis au serveur avant que le client n'ait terminé l'échange initial (handshake). L'avantage de cette méthode est de protéger le serveur des attaques par inondation de paquets SYN lancées à l'aide de paquets falsifiés.
d618 2
a619 1
Le mandataire TCP SYN est activé à l'aide de l'option <tt>synproxy state</tt> :
d629 2
a630 1
Toutes les connexions à destination du serveur HTTP seront mandatées par PF.
d633 2
a634 2
L'option <tt>synproxy state</tt> apporte les mêmes avantages que les options 
<tt>keep state</tt> et <tt>modulate state</tt>.
d637 3
a639 1
Par contre, l'option synproxy ne fonctionne pas quand PF est installé en passerelle transparente (<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=bridge&amp;sektion=4&amp;manpath=OpenBSD+3.5"
d646 5
a650 1
On parle d'usurpation quand un utilisateur mal intentionné maquille son adresse IP dans le but d'anonymiser ou de cacher son identité afin de lancer des attaques sans que leur origine soit détectable. Il peut également essayer et parfois réussir à avoir accès à des services réservés à certaines adresses.
d653 2
a654 1
PF permet de se prémunir de ce type d'attaques grâce à l'option <tt>antispoof</tt> :
d670 2
a671 1
<dd>Si un paquet correspond à la règle, celle-ci est appliquée immédiatement.
d674 3
a676 1
<dd>Désigne l'interface sur laquelle s'applique la protection. Il est possible de passer une <a href="macros.html#lists">liste</a> d'interfaces en paramètre.
d680 2
a681 1
<dd>Spécifie le type d'adresse : <tt>inet</tt> pour IPv4 ou <tt>inet6</tt> pour IPv6.
d694 5
a698 2
Quand les règles sont chargées, toutes les occurrences du mot <tt>antispoof</tt> 
sont décodées dans deux filtres. Si l'interface <tt>fxp0</tt> dont l'adresse IP est 10.0.0.1 pour un masque de sous-réseau de 255.255.255.0 (soit /24) est protégée, l'option <tt>antispoof</tt> sera décodée ainsi : 
d711 9
a719 4
<li>elle bloque tout le trafic en provenance du réseau 10.0.0.0/24 s'il ne passe <i>pas</i> 
par l'interface <tt>fxp0</tt>. Aucun paquet pour ce réseau ne devrait en effet être vu ailleurs que sur cette interface.
<li>elle bloque tout le trafic entrant dont l'adresse source est 10.0.0.1, à savoir celle de l'interface <tt>fxp0</tt>. 
Cette machine ne devrait en effet jamais émettre de paquets à travers une interface externe et par conséquent ne doit pas recevoir de paquets ayant son adresse IP comme adresse source. 
d723 4
a726 1
<b>NOTE</b>: le filtrage activé par l'option  <tt>antispoof</tt> d'une règle s'applique également aux paquets envoyés sur l'adresse de bouclage interne (loopback). Ce trafic doit donc être explicitement autorisé :
d737 3
a739 1
L'utilisation de l'option <tt>antispoof</tt> est réservée aux interfaces qui possèdent une adresse IP. Dans le cas contraire, on aboutit au filtrage suivant :
d748 2
a749 1
Avec ce genre de règles, le risque est réel de bloquer <i>tout</i> le trafic entrant sur <i>toutes</i> les interfaces.
d755 6
a760 1
La reconnaissance passive d'OS par leurs empreintes est une méthode qui permet de reconnaitre à distance quel système d'exploitation tourne sur une machine. Cette reconnaissance se base sur les caractéristiques des paquets TCP SYN renvoyés par une machine. Ces informations peuvent être utilisées comme critères dans des règles de filtrage.
d763 6
a768 4
PF utilise le fichier <a href="options.html#fingerprints">d'empreintes</a> <a
href="http://www.openbsd.org/cgi-bin/man.cgi?query=pf.os&amp;sektion=5&amp;manpath=OpenBSD+3.5"
><tt>/etc/pf.os</tt></a> pour reconnaitre les systèmes d'exploitation auxquels il a à faire.
Lorsque PF s'exécute, la liste des empreintes reconnues peut être consultée gràce à la commande suivante :
d777 4
a780 3
Dans une règle, une empreinte peut être désignée sous la forme d'une classe, d'une version ou d'un sous-type d'OS.
La liste de ces éléments est affichée à l'aide de la commande <tt>pfctl</tt>.
Pour désigner une empreinte dans une règle, il faut utiliser le mot-clef <tt>os</tt> :
d792 2
a793 1
<tt>unknown</tt> est une classe spéciale désignant les systèmes d'exploitation dont l'empreinte n'est pas connue. 
d798 8
a805 3
  <li>La reconnaissance peut échouer face à des paquets spécifiquement construits pour tromper la détection d'empreintes.
  <li>L'application de correctifs peut modifier le comportement de la pile TCP/IP d'un système d'exploitation et faire également échouer ou tromper la reconnaissance de l'OS.
  <li>L'option OSFP n'est applicable qu'aux paquets TCP SYN. Elle est inefficace avec d'autres protocoles et pour les sessions déjà établies.
d811 5
a815 1
PF bloque par défaut tous les paquets qui utilisent les options IP. Cela rend moins aisé le travail des outils de reconnaissance d'empreintes tels que nmap. Si une application utilise ces options (par exemple IGMP ou les diffusions multicast) il est possible d'utiliser l'option <tt>allow-opts</tt> :
d826 4
a829 3
Vous trouverez ci-dessous un exemple de règles de filtrage pour un
pare-feu PF destiné à protèger un petit réseau connecté à Internet.
Seules les règles de filtrage sont mentionées ; <a href="queueing.html">queueing</a>, 
d843 2
a844 1
# déclaration du tableau référençant toutes les adresses IP affectées au pare-feu
d854 2
a855 1
# Autorisation du trafic dans les deux sens sur l'adresse de bouclage interne
d858 2
a859 1
# Activation de la protection contre l'usurpation sur l'interface externe.
d863 3
a865 3
# et de la machine 192.168.0.15. "block return" provoque l'émission d'un 
# paquet TCP RST pour mettre fin aux connexions illicites. "quick" assure que 
# que cette règle n'est pas contredite par les règles "pass".
d873 2
a874 1
# Autoriser les connexions sortantes tcp, udp et icmp sur l'interface externe.
d877 1
d881 4
a884 3
# Autoriser les connexions ssh sur l'interface externe du moment qu'elles 
# ne sont pas destinées au pare-feu lui-même Journalise le paquet qui initie la session 
# afin de pouvoir déterminer qui s'est connecté. Activer un service mandataire SYN.
d894 1
a894 1
[<a href="nat.html">Section suivante : Traduction des Adresses IP ("NAT")</a>]
d904 1
a904 1
$Translation: filter.html,v 1.4 2004/10/11 12:25:39 saad Exp $<br>
@


1.1
log
@Sync with Steelix CVS
@
text
@d44 1
a44 1
<h3>Table des Mati&egrave;res</h3>
d601 1
a601 1
Seules les règles de filtrage sont mentionées ; <a href="../queueing.html">queueing</a>, 
d670 1
a670 1
$Translation: filter.html,v 1.2 2004/10/06 17:21:11 saad Exp $<br>
@

