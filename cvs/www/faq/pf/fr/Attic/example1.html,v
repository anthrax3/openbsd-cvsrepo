head	1.47;
access;
symbols;
locks; strict;
comment	@# @;


1.47
date	2014.04.01.17.14.10;	author nick;	state dead;
branches;
next	1.46;

1.46
date	2013.11.01.18.04.05;	author ajacoutot;	state Exp;
branches;
next	1.45;

1.45
date	2013.05.07.12.47.22;	author ajacoutot;	state Exp;
branches;
next	1.44;

1.44
date	2012.11.02.07.24.05;	author ajacoutot;	state Exp;
branches;
next	1.43;

1.43
date	2012.10.11.14.26.22;	author ajacoutot;	state Exp;
branches;
next	1.42;

1.42
date	2012.08.17.06.29.34;	author ajacoutot;	state Exp;
branches;
next	1.41;

1.41
date	2012.05.19.22.52.00;	author ajacoutot;	state Exp;
branches;
next	1.40;

1.40
date	2012.05.13.16.30.18;	author ajacoutot;	state Exp;
branches;
next	1.39;

1.39
date	2011.11.05.12.45.49;	author ajacoutot;	state Exp;
branches;
next	1.38;

1.38
date	2011.05.07.08.22.01;	author ajacoutot;	state Exp;
branches;
next	1.37;

1.37
date	2010.11.12.17.22.55;	author ajacoutot;	state Exp;
branches;
next	1.36;

1.36
date	2010.11.09.08.15.21;	author ajacoutot;	state Exp;
branches;
next	1.35;

1.35
date	2010.10.03.15.11.11;	author ajacoutot;	state Exp;
branches;
next	1.34;

1.34
date	2010.05.24.18.32.44;	author ajacoutot;	state Exp;
branches;
next	1.33;

1.33
date	2010.03.19.14.01.23;	author ajacoutot;	state Exp;
branches;
next	1.32;

1.32
date	2009.10.20.20.44.42;	author ajacoutot;	state Exp;
branches;
next	1.31;

1.31
date	2009.05.01.13.16.23;	author tobias;	state Exp;
branches;
next	1.30;

1.30
date	2009.02.22.20.35.21;	author tobias;	state Exp;
branches;
next	1.29;

1.29
date	2008.12.01.07.52.52;	author tobias;	state Exp;
branches;
next	1.28;

1.28
date	2008.08.25.14.21.24;	author tobias;	state Exp;
branches;
next	1.27;

1.27
date	2008.01.13.13.43.34;	author tobias;	state Exp;
branches;
next	1.26;

1.26
date	2007.05.09.05.49.53;	author jufi;	state Exp;
branches;
next	1.25;

1.25
date	2007.02.16.05.14.25;	author saad;	state Exp;
branches;
next	1.24;

1.24
date	2007.02.06.06.04.56;	author saad;	state Exp;
branches;
next	1.23;

1.23
date	2006.11.02.18.23.22;	author jufi;	state Exp;
branches;
next	1.22;

1.22
date	2006.10.30.14.20.19;	author jufi;	state Exp;
branches;
next	1.21;

1.21
date	2006.10.29.10.58.52;	author jufi;	state Exp;
branches;
next	1.20;

1.20
date	2006.07.06.15.41.58;	author saad;	state Exp;
branches;
next	1.19;

1.19
date	2006.05.10.09.02.25;	author jufi;	state Exp;
branches;
next	1.18;

1.18
date	2006.05.03.14.48.29;	author saad;	state Exp;
branches;
next	1.17;

1.17
date	2006.05.02.17.09.33;	author jufi;	state Exp;
branches;
next	1.16;

1.16
date	2006.03.10.16.35.07;	author saad;	state Exp;
branches;
next	1.15;

1.15
date	2006.01.02.06.51.10;	author saad;	state Exp;
branches;
next	1.14;

1.14
date	2005.11.03.11.30.53;	author saad;	state Exp;
branches;
next	1.13;

1.13
date	2005.05.22.17.38.07;	author saad;	state Exp;
branches;
next	1.12;

1.12
date	2005.01.18.09.54.52;	author jufi;	state Exp;
branches;
next	1.11;

1.11
date	2004.12.29.10.38.26;	author saad;	state Exp;
branches;
next	1.10;

1.10
date	2004.11.03.21.01.25;	author saad;	state Exp;
branches;
next	1.9;

1.9
date	2004.11.01.02.56.30;	author saad;	state Exp;
branches;
next	1.8;

1.8
date	2004.10.12.07.18.40;	author jufi;	state Exp;
branches;
next	1.7;

1.7
date	2004.10.11.16.17.48;	author jufi;	state Exp;
branches;
next	1.6;

1.6
date	2004.10.07.10.24.20;	author jufi;	state Exp;
branches;
next	1.5;

1.5
date	2004.05.16.13.08.03;	author saad;	state Exp;
branches;
next	1.4;

1.4
date	2004.05.12.20.51.36;	author saad;	state Exp;
branches;
next	1.3;

1.3
date	2004.05.06.21.34.05;	author saad;	state Exp;
branches;
next	1.2;

1.2
date	2004.01.03.19.45.23;	author jufi;	state Exp;
branches;
next	1.1;

1.1
date	2003.12.29.22.13.35;	author horacio;	state Exp;
branches;
next	;


desc
@@


1.47
log
@
Abandon translations, per deraadt@@ and ajacoutot@@.
@
text
@<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<html>
<head>
<title>PF : Exemple : Pare-feu pour réseau domestique ou
            petite société</title>
<link rev="made" href="mailto:www@@openbsd.org">
<meta http-equiv="Content-Type" content="text/html; charset=ISO-8859-1">
<meta name="resource-type" content="document">
<meta name="description"   content="the OpenBSD FAQ page">
<meta name="keywords"      content="openbsd,faq,pf">
<meta name="distribution"  content="global">
</head>

<!--
Copyright (c) 2003, 2004 Joel Knight <enabled@@myrealbox.com>

Permission to use, copy, modify, and distribute this documentation for
any purpose with or without fee is hereby granted, provided that the
above copyright notice and this permission notice appear in all copies.

THE DOCUMENTATION IS PROVIDED "AS IS" AND THE AUTHOR DISCLAIMS ALL
WARRANTIES WITH REGARD TO THIS DOCUMENTATION INCLUDING ALL IMPLIED
WARRANTIES OF MERCHANTABILITY AND FITNESS. IN NO EVENT SHALL THE
AUTHOR BE LIABLE FOR ANY SPECIAL, DIRECT, INDIRECT, OR CONSEQUENTIAL
DAMAGES OR ANY DAMAGES WHATSOEVER RESULTING FROM LOSS OF USE, DATA OR
PROFITS, WHETHER IN AN ACTION OF CONTRACT, NEGLIGENCE OR OTHER
TORTIOUS ACTION, ARISING OUT OF OR IN CONNECTION WITH THE USE OR
PERFORMANCE OF THIS DOCUMENTATION
-->

<body bgcolor="#ffffff" text="#000000">
<!-- Passes validator.w3.org, please keep it this way;
please, use a max of 72 chars per line -->

<a href="../../../fr/index.html">
<img alt="[OpenBSD]" height="30" width="141" src="../../../images/smalltitle.gif" border="0">
</a>
<p>
[<a href="carp.html">Précédent : Haute disponibilité des pare-feux
avec CARP et pfsync</a>]
[<a href="index.html">Index</a>]

<p>
<h1><font color="#e00000">PF : Exemple : Pare-feu pour réseau domestique
    ou petite société</font></h1> <hr>

<h3>Table des Matières</h3>
<ul>
<li><a href="#scenario">Le Scenario</a>
        <ul>
        <li><a href="#network">Le Réseau</a>
        <li><a href="#objective">Les Objectifs</a>
        <li><a href="#prep">Préparation</a>
        </ul>
<li><a href="#ruleset">Le Jeu de Règles</a>
        <ul>
        <li><a href="#macros">Macros</a>
        <li><a href="#options">Options</a>
        <li><a href="#rules">Règles de pare-feur</a>
        </ul>
<li><a href="#allrules">Le Jeu de Règles Complet</a>
</ul>

<hr>

<a name="scenario"></a>
<h2>Le Scenario</h2>
Dans cet exemple, PF fonctionne sur une machine OpenBSD jouant le rôle
de pare-feu et de passerelle NAT pour un réseau SoHo. L'objectif global
est de fournir un accès Internet au réseau local, de fournir un accès
limité au pare-feu depuis Internet et d'exposer un serveur web interne
à l'Internet. Ce document a pour but de vous montrer comment on
construit un jeu de règles correspondant à l'objectif précité.

<a name="network"></a>
<h3>Le Réseau</h3>
Le réseau est conçu de la manière suivante :

<pre>
    
  [ COMP1 ]    [ COMP3 ]
      |            |                               
   ---+------+-----+------- xl0 [ OpenBSD ] fxp0 -------- ( Internet )
             |
         [ COMP2 ]

</pre>

<p>
Il y a un certain nombre de machines sur le réseau interne. Le diagramme
en montre trois mais le vrai nombre n'est pas une donnée utile. Ces
machines sont des stations de travail normales servant à surfer sur le
web, écrire des messages électroniques, participer à des forums de
discussion en ligne, etc à l'exception de COMP3 qui sert aussi de
serveur Web. Le réseau interne utilise le bloc de réseau
192.168.0.0 / 255.255.255.0.

<p>
Le pare-feu OpenBSD est une machine dotée d'un Celeron 300 et de deux
cartes réseau : une 3Com 3c905B (<tt>xl0</tt>) et une Intel
EtherExpress Pro/100 (<tt>fxp0</tt>). Le pare-feu a une connexion câble
vers Internet et utilise la NAT pour partager cette connexion avec le
réseau interne. L'adresse IP de l'interface externe est attribuée
dynamiquement par le Fournisseur d'Accès Internet.

<a name="objective"></a>
<h3>Les Objectifs</h3>
Les objectifs sont les suivants :
<ul>
<li>Fournir un accès Internet sans restriction pour chaque machine du
    réseau interne.
<li>Utiliser un jeu de règles bloquant tout flux par défaut.
<li>Autoriser les flux entrants suivants sur le pare-feu à partir
    d'Internet :
        <ul>
        <li>SSH (port TCP 22) : utilisé pour la maintenance externe du
            pare-feu.
        <li>Auth/Ident (port TCP 113): utilisé par quelques services
            tels que SMTP et IRC.
        <li>Messages ICMP "Echo Request" : Le type de paquet ICMP
            utilisé par
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=ping&amp;sektion=8">ping(8)</a>.
        </ul>
<li>Rediriger les tentatives de connexion sur le port TCP 80 (qui sont
    des tentatives d'accès à un serveur Web) vers la machine COMP3. Et
    autoriser aussi le trafic vers le port TCP 80 destiné à COMP3 à
    travers le pare-feu.
<li>Enregistrer des statistiques de filtrage pour l'interface externe.
<li>Par défaut, renvoyer un RST TCP ou un message ICMP "Unreachable"
    pour les paquets bloqués.
<li>S'assurer que le jeu de règles est aussi simple et facile à
    maintenir que possible.
</ul>

<a name="prep"></a>
<h3>Préparation</h3>
Ce document suppose que l'hôte OpenBSD a été correctement configuré
pour fonctionner comme routeur : configuration réseau, connexion
Internet et positionnement des variables 
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=sysctl&amp;sektion=3"
>sysctl(3)</a> <tt>net.inet.ip.forwarding</tt> et/ou
<tt>net.inet6.ip6.forwarding</tt> à "<tt>1</tt>".
Vouc devez également activer PF en utilisant
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=pfctl&amp;sektion=8&amp;manpath=OpenBSD+5.4"
>pfctl(8)</a> ou en définissant la variable appropriée dans
<tt>/etc/rc.conf.local</tt>.
PF est activé par défaut sur OpenBSD 4.6 et les nouvelles versions.

<a name="ruleset"></a>
<h2>Le Jeu de Règles</h2>
Les sections ci-après détaillent la manière dont le jeu de règles
répondra aux objectifs précités.

<a name="macros"></a>
<h3>Macros</h3>
Les macros suivantes sont définies pour rendre la maintenance et la
lecture du jeu de règles plus faciles :
<blockquote><pre>
int_if="xl0"

tcp_services="{ 22, 113 }"
icmp_types="echoreq"

comp3 = "192.168.0.3"
</pre></blockquote>

<p>
La première ligne définit les interfaces réseau sur
lesquelles le filtrage sera effectué. En les définissant ici, si nous
devons déplacer ce système vers une autre machine avec un matériel
différent, nous pourrons alors ne changer que ces deux lignes et le
reste des règles restera valable. 
(Pour cet exemple, l'interface externe sera assurée en utilisant
l'interface de groupe <tt>egress</tt>.
C'est automatiquement activé sur toutes les interfaces ayant une route par
défaut, dans ce cas, fxp0).
Les deuxièmes et troisièmes lignes listent les numéros de port TCP  
des services ouverts depuis Internet
(SSH et ident/auth) et les types de paquets ICMP qui sont autorisés à
parvenir jusqu'aù pare-feu. Enfin, la dernière ligne définit l'adresse
IP de COMP3.

<p>
<b>Remarque</b> : Si la connexion Internet nécessite l'utilisation
   de
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=pppoe&amp;sektion=4">PPPoE</a>, 
   le filtrage et la NAT s'effectueront sur l'interface <tt>pppoe0</tt> <i>au
   lieu de</i> l'interface de sortie (<tt>fxp0</tt>).

<a name="options"></a>
<h3>Options</h3>
Les deux options suivantes spécifient la réponse par défaut fournie par
les règles de filtrage <tt>block</tt> et activent la collecte de
statistiques sur l'interface externe :
<blockquote><pre>
set block-policy return
set loginterface egress
</pre></blockquote>

<p>
Chaque système Unix possède une interface de "loopback".
C'est une interface réseau virtuelle utilisée par les applications pour
converser avec les autres au sein du même système.
Sur OpenBSD, l'interface de bouclage ("loopback") est
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=lo&amp;sektion=4"
>lo(4)</a>.
Le filtrage est communément désactivé sur ces interfaces.
L'utilisation de <a href="options.html#skip">set skip</a> permet
d'accomplir cela.
<blockquote><pre>
set skip on lo
</pre></blockquote>
<!-- XXX this should be interface groups, but PF (at least up to
 4.8) just does a substring match on the interface name -->
Veuillez prendre note que nous n'effectuons pas de filtrage sur les
interfaces <tt>lo</tt>, de cette manière nous pourrions
rajouter des interfaces de loopback supplémentaire sans avoir à nous
soucier de mettre à jour cette partie de la configuration.

<a name="rules"></a>
<h3>Règles Pare-feu</h3>

On commencera avec des règles pour supporter l'utilisation de 
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=ftp-proxy&amp;sektion=8&amp;manpath=OpenBSD+5.4">
ftp-proxy(8)</a> ainsi les clients FTP sur le réseau local pourront se
connecter aux serveurs FTP sur Inernet.
Cela fonctionne en insérant dynamiquement des règles quand une connexion ftp
est effectuée.
C'est réalisé en utilisant une <a href="anchors.html">ancre</a>:
<blockquote><pre>
anchor "ftp-proxy/*"
</pre></blockquote>

<p>
Maintenant nous allons ajouter la règle permettant le détournement des
connexions FTP pour qu'elles soient vues par ftp-proxy(8):
<blockquote><pre>
pass in quick on $int_if inet proto tcp to any port ftp \
    divert-to 127.0.0.1 port 8021
</pre></blockquote>

<p>
Cette règle intercepte les connexions FTP sur le port 21 et les détourne
vers une instance ftp-proxy(8) tournant sur le port 8021 et, à travers
l'utilisation du mot-clé <tt>quick</tt>, les paquets valides ne seront pas
testés par le reste du jeu de règles.
Si des utilisateurs se connectent sur les serveurs FTP sur des ports
différents, une liste peut être utilisée pour spécifier le port de
destination, par exemple :
<tt>to any port { 21, 2121 }</tt>.


<p>
Il faut remarquer qu'aussi bien les <a href="anchors.html">ancres</a> que
la règle de redirection
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=ftp-proxy&amp;sektion=8&amp;manpath=OpenBSD+5.4"
>ftp-proxy(8)</a> ont besoin d'être placées avant toutes règles <tt>match</tt> 
pour le NAT ou le ftp-proxy(8) ne fonctionnera pas bien.

<p>
Maintenant nous allons voir les règles <tt>match</tt>.
Par elle-même, une règle <tt>match</tt> ne détermine pas si un paquet a la
permission ou non de passer.
À la place, les paquets qui sont conformes à cette règle auront les
paramètres mémorisés; ils seront utilisés dans toutes les règles <tt>pass</tt>
qui valident ces paquets.

<p>
C'est puissant : des paramètres comme <a href="nat.html">NAT</a>
ou <a href="queueing.html">queueing</a> peuvent être appliqués pour
certaines classes de paquets, et les permissions d'accès définies séparement.
 
<p>
Pour avoir du NAT pour la totalité du réseau interne la règle <tt>match</tt>
suivante est utilisée :
<blockquote><pre>
match out on egress inet from !(egress:network) to any nat-to (egress:0)
</pre></blockquote>
 
<p>
Dans ce cas, le "<tt>!(egress:network)</tt>" peut être facilement remplacé
par un "<tt>$int_if:network</tt>", mais si vous ajoutez plusieurs interfaces
internes, vous devrez ajouter des règles NAT en plus, par rapport à la
structure, NAT sera utilisé sur toutes les interfaces protégées.

<p>
Comme l'adresse IP de l'interface externe est assignée dynamiquement, les
parenthèses sont placées entre l'interface de traduction pour que PF soit
notifié d'un chagement d'adresse.
Le suffixe :0 est utilisé pour cela, si l'interface externe possède
plusieurs adresses, seule la première est utilisée pour la
traduction. 


<p>
Pour finir, la famille de protocole <tt>inet</tt> (IPv4) est spécifiée.
Cela supprime la traduction de tous les paquets <tt>inet6</tt> (IPv6) qui
sont reçus.

<p>
Maintenant les règles pour contrôler les permissions d'accès.
On commence avec une interdiction par défaut :
<blockquote><pre>
block in log
</pre></blockquote>

<p>
À ce point, tout le trafic entrant sera bloqué, même celui en provenance
du réseau interne. Ces paquets seront aussi tracés.
Des règles suivantes vont ouvrir un certain nombre de flux sur le pare-feu
afin de répondre aux objectifs précités et d'ouvrir toutes les interfaces
virtuelles nécessaires.

<p>
Gardez à l'esprit que pf peut bloquer le trafic entrant ou sortant d'une
interface.
Cela peut vous simplifier la tâche de ne filtrer que dans une direction
plutôt que d'essayer de rester consistant en filtrant le trafic sortant
et entrant.
Dans notre cas, nous choisirons de filtrer le trafic entrant uniquement,
mais lorsque celui-ci sera permit sur une interface nous ne
l'empêcherons pas d'en sortir. Pour se faire, nous utiliserons :

<blockquote><pre>
pass out quick
</pre></blockquote>

En utilisant <tt>quick</tt>, les paquets sortants ne seront pas vérifiés sur
les règles suivantes, cela améliore les performances.
 
<p>
Il est utile d'utiliser la <a href="filter.html#antispoof">protection
contre le spoofing d'adresses</a> :
<blockquote><pre>
antispoof quick for { lo $int_if }
</pre></blockquote>

<p>
Maintenant, il faut ouvrir les ports utilisés par les services réseau
disponibles depuis Internet. Tout d'abord, le trafic destiné au pare-feu
lui-même :

<blockquote><pre>
pass in on egress inet proto tcp from any to (egress) \
    port $tcp_services
</pre></blockquote>

<p>
La spécification des ports réseau par le biais de la macro
<tt>$tcp_services</tt> rend l'ouverture de nouveaux services pour des
connexions provenant d'Internet plus facile dans la mesure où il suffira
de modifier la macro et recharger le jeu de règles. Des services UDP
peuvent aussi être mis à disposition en créant la macro
<tt>$udp_services</tt> et en ajoutant une règle de filtrage adéquate
similaire à la règle de filtrage ci-dessus en spécifiant <tt>proto
udp</tt>.

<p>
La règle suivante récupère toutes les tentatives de quelqu'un sur Internet
voulant se connecter sur le port 80 du pare-feu.
Les tentatives légitimes pour accéder à ce port seront des utilisateurs
essayant d'accéder au serveur web du réseau. 
Ces tentatives de connexion seront redirigées vers COMP3 :
 
<blockquote><pre>
pass in on egress inet proto tcp to (egress) port 80 rdr-to $comp3
</pre></blockquote>

<p>
Le trafic ICMP doit être permis :
<blockquote><pre>
pass in inet proto icmp all icmp-type $icmp_types
</pre></blockquote>

<p>
Comme pour la macro <tt>$tcp_services</tt>, la macro
<tt>$icmp_types</tt> peut facilement être modifiée pour changer les
types des paquets ICMP qui doivent être autorisés à atteindre le 
pare-feu. Notez que cette règle s'applique à toutes les interfaces 
réseau.

<p>
Maintenant, le trafic en provenance du réseau interne doit être
autorisé. Nous supposerons que les utilisateurs du réseau interne savent
ce qu'ils font et ne provoqueront pas de problème sur Internet. Ce n'est
pas nécessairement une bonne supposition pour de nombreux
environnements.
<blockquote><pre>
pass in on $int_if
</pre></blockquote>

<p>
Le trafic TCP, UDP et ICMP à destination d'Internet est autorisé à sortir
du pare-feu grâce à la règle précédente "<tt>pass out</tt>".
L'information sur l'état des connexions est sauvegardée pour permettre
aux paquets de retour de passer à leur tour la barrière que constitue le
pare-feu.

<a name="allrules"></a>
<h2>Le Jeu de Règles Complet</h2>
<table border=0 width="650">
<tr><td nowrap bgcolor="#EEEEEE">
<pre>
# macros

int_if="xl0"

tcp_services = "{ 22, 113 }"
icmp_types = "echoreq"

comp3 = "192.168.0.3"

# options

set block-policy return
set loginterface egress

set skip on lo

# règles Proxy FTP

anchor "ftp-proxy/*"

pass in quick on $int_if inet proto tcp to any port ftp \
    divert-to 127.0.0.1 port 8021

# règles match

match out on egress inet from !(egress:network) to any nat-to (egress:0)

# règles de filtrage

block in log
pass out quick

antispoof quick for { lo $int_if }

pass in on egress inet proto tcp from any to (egress) \
    port $tcp_services

pass in on egress inet proto tcp to (egress) port 80 rdr-to $comp3

pass in inet proto icmp all icmp-type $icmp_types

pass in on $int_if
</pre>
</td></tr>
</table>

<p>
[<a href="carp.html">Précédent : Haute disponibilité des pare-feux
avec CARP et pfsync</a>]
[<a href="index.html">Index</a>]

<p>
<hr>
<a href="index.html"><img height="24" width="24"
src="../../../images/back.gif" border="0" alt="[back]"></a>
<a href="mailto:www@@openbsd.org">www@@openbsd.org</a>
<br>
<small>
<!--
Originally [OpenBSD: example1.html,v 1.54 ]<br>
$Translation: example1.html,v 1.51 2013/11/01 17:02:17 rustybsd Exp $<br>
-->
$OpenBSD: example1.html,v 1.46 2013/11/01 18:04:05 ajacoutot Exp $
</small>

</body>
</html> 
@


1.46
log
@Sync with Steelix CVS
@
text
@d466 1
a466 1
$OpenBSD$
@


1.45
log
@Sync with Steelix CVS
@
text
@d144 1
a144 1
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=pfctl&amp;sektion=8&amp;manpath=OpenBSD+5.3"
d224 1
a224 1
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=ftp-proxy&amp;sektion=8&amp;manpath=OpenBSD+5.3">
d256 1
a256 1
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=ftp-proxy&amp;sektion=8&amp;manpath=OpenBSD+5.3"
d463 2
a464 2
Originally [OpenBSD: example1.html,v 1.53 ]<br>
$Translation: example1.html,v 1.50 2013/05/07 08:34:48 rustybsd Exp $<br>
@


1.44
log
@Sync with Steelix CVS
@
text
@d144 1
a144 1
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=pfctl&amp;sektion=8&amp;manpath=OpenBSD+5.2"
d224 1
a224 1
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=ftp-proxy&amp;sektion=8&amp;manpath=OpenBSD+5.2">
d256 1
a256 1
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=ftp-proxy&amp;sektion=8&amp;manpath=OpenBSD+5.2"
d463 2
a464 2
Originally [OpenBSD: example1.html,v 1.52 ]<br>
$Translation: example1.html,v 1.49 2012/11/01 19:46:20 rustybsd Exp $<br>
@


1.43
log
@Sync with Steelix CVS
@
text
@d144 1
a144 1
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=pfctl&amp;sektion=8&amp;manpath=OpenBSD+5.1"
d224 1
a224 1
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=ftp-proxy&amp;sektion=8&amp;manpath=OpenBSD+5.1">
d256 1
a256 1
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=ftp-proxy&amp;sektion=8&amp;manpath=OpenBSD+5.1"
d463 2
a464 2
Originally [OpenBSD: example1.html,v 1.51 ]<br>
$Translation: example1.html,v 1.48 2012/10/06 18:06:30 rustybsd Exp $<br>
@


1.42
log
@Sync with Steelix CVS
@
text
@d366 1
a366 2
pass in on egress inet proto tcp to (egress) port 80 \
    rdr-to $comp3 synproxy state
a369 5
Pour un niveau de sécurité plus élevé, nous utilisons
<a href="filter.html#synproxy">TCP SYN Proxy</a> pour améliorer la
protection du web serveur.

<p>
d441 1
a441 2
pass in on egress inet proto tcp to (egress) port 80 \
    rdr-to $comp3 synproxy state
d463 2
a464 2
Originally [OpenBSD: example1.html,v 1.50 ]<br>
$Translation: example1.html,v 1.47 2012/08/17 06:15:16 rustybsd Exp $<br>
@


1.41
log
@Sync with Steelix CVS
@
text
@d188 1
a188 1
   lieu de</i> <tt>fxp0</tt>.
d197 1
a197 1
set loginterface fxp0
d422 1
a422 1
set loginterface fxp0
d435 1
a435 1
match out on egress inet from !(egress) to any nat-to (egress:0)
d470 2
a471 2
Originally [OpenBSD: example1.html,v 1.49 ]<br>
$Translation: example1.html,v 1.46 2012/05/17 14:16:54 rustybsd Exp $<br>
@


1.40
log
@Sync with Steelix CVS
@
text
@d39 1
a39 1
[<a href="carp.html">Précédent : Haute-disponibilité des pare-feu
d235 1
a235 1
Maintenant nous allons ajouter la régle permettant le détournement des
d243 1
a243 1
Cette règle intercepte les connxions FTP sur le port 21 et les détournent
d245 1
a245 1
l'utilisation du mot clé <tt>quick</tt>, les paquets valides ne seront pas
d248 1
a248 1
diffèrents, une liste peut-être utilisée pour spécifier le port de
d262 1
a262 1
Par elle-même, un règle <tt>match</tt> ne détermine pas si un paquet à la
d264 2
a265 2
A la place, les paquets qui sont conforment à cette règle auront les
paramétres mémorisés; ils seront utilisés dans toutes les règles <tt>pass</tt>
d269 2
a270 2
C'est puissant : des paramétres comme <a href="nat.html">NAT</a>
ou <a href="queueing.html">queueing</a> peuvent être appliqué pour
d281 1
a281 1
Dans ce cas, le "<tt>!(egress:network)</tt>" peut-être facilement remplacé
d283 1
a283 1
interners, vous devrez ajouter des règles NAT en plus, par rapport à la
d288 1
a288 1
parenthéses sont placées entre l'interface de traduction pour que PF soit
d290 2
a291 2
Le suffixe :0 est utilisé pour cela, si l'interface externe posséde
plusieurs adresses, seule la premiére adresse est utilisée pour la
d308 5
a312 6
A ce point, tout le trafic entrant sera bloqué même celui en provenance
du réseau interne. 
Ces paquets seront aussi tracés.
Des règles suivantes vont ouvrir un certain
nombre de flux sur le pare-feu afin de répondre aux objectifs précités
et d'ouvrir toutes les interfaces virtuelles nécessaires.
d359 1
a359 1
La règle suivante récupére toutes les tentatives de quelqu'un sur Internet
d399 1
a399 1
Le trafic TCP, UDP et ICMP à destination d'Internet est autorisé sortir
d458 1
a458 1
[<a href="carp.html">Précédent : Haute-disponibilité des pare-feu
d471 1
a471 1
$Translation: example1.html,v 1.45 2012/05/11 14:58:46 rustybsd Exp $<br>
@


1.39
log
@Sync with Steelix CVS
@
text
@d144 1
a144 1
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=pfctl&amp;sektion=8&amp;manpath=OpenBSD+5.0"
d224 1
a224 1
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=ftp-proxy&amp;sektion=8&amp;manpath=OpenBSD+5.0">
d256 1
a256 1
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=ftp-proxy&amp;sektion=8&amp;manpath=OpenBSD+5.0"
d471 2
a472 2
Originally [OpenBSD: example1.html,v 1.48 ]<br>
$Translation: example1.html,v 1.44 2011/11/05 09:20:59 benoit Exp $<br>
@


1.38
log
@Sync with Steelix CVS
@
text
@d144 1
a144 1
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=pfctl&amp;sektion=8&amp;manpath=OpenBSD+4.9"
d224 1
a224 1
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=ftp-proxy&amp;sektion=8&amp;manpath=OpenBSD+4.9">
d235 1
a235 1
Maintenant nous allons ajouter la régle permettant le redirection des
d239 1
a239 1
    rdr-to 127.0.0.1 port 8021
d243 1
a243 1
Cette règle intercepte les connxions FTP sur le port 21 et les redirigent
d256 1
a256 1
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=ftp-proxy&amp;sektion=8&amp;manpath=OpenBSD+4.9"
d432 1
a432 1
    rdr-to 127.0.0.1 port 8021
d471 2
a472 2
Originally [OpenBSD: example1.html,v 1.46 ]<br>
$Translation: example1.html,v 1.43 2011/05/07 06:58:36 benoit Exp $<br>
@


1.37
log
@Sync with Steelix CVS
@
text
@d144 1
a144 1
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=pfctl&amp;sektion=8&amp;manpath=OpenBSD+4.8"
d224 1
a224 1
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=ftp-proxy&amp;sektion=8&amp;manpath=OpenBSD+4.8">
d256 1
a256 1
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=ftp-proxy&amp;sektion=8&amp;manpath=OpenBSD+4.8"
d471 2
a472 2
Originally [OpenBSD: example1.html,v 1.45 ]<br>
$Translation: example1.html,v 1.42 2010/11/09 21:54:54 benoit Exp $<br>
@


1.36
log
@Sync with Steelix CVS
@
text
@d471 2
a472 2
Originally [OpenBSD: example1.html,v 1.44 ]<br>
$Translation: example1.html,v 1.41 2010/11/06 14:32:40 benoit Exp $<br>
@


1.35
log
@Sync with Steelix CVS
@
text
@d59 1
a59 4
        <li><a href="#scrub">Scrub</a>
        <li><a href="#nat">Traduction d'Adresses Réseau</a>
        <li><a href="#rdr">Redirection</a>
        <li><a href="#filter">Règles de Filtrage</a>
d144 1
a144 1
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=pfctl&amp;sektion=8&amp;manpath=OpenBSD+4.7"
d214 1
a214 1
 4.7) just does a substring match on the interface name -->
d220 1
a220 3
<a name="scrub"></a>
<a name="rdr"></a>
<a name="filter"></a>
d224 1
a224 1
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=ftp-proxy&amp;sektion=8&amp;manpath=OpenBSD+4.7">
d256 1
a256 1
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=ftp-proxy&amp;sektion=8&amp;manpath=OpenBSD+4.7"
d471 2
a472 2
Originally [OpenBSD: example1.html,v 1.43 ]<br>
$Translation: example1.html,v 1.40 2010/10/01 05:50:39 benoit Exp $<br>
@


1.34
log
@Sync with Steelix CVS
@
text
@d161 6
a166 8
<blockquote>
<tt>
ext_if="fxp0"<br>
int_if="xl0"<br>
<br>
tcp_services = "{ 22, 113 }"<br>
icmp_types = "echoreq"<br>
<br>
d168 1
a168 2
</tt>
</blockquote>
d171 1
a171 1
Les deux premières lignes définissent les interfaces réseau sur
d175 7
a181 2
reste des règles restera valable. Les troisièmes et quatrièmes lignes
listent les numéros de port TCP des services ouverts depuis Internet
d189 2
a190 2
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=pppoe&amp;sektion=8">PPPoE</a>, 
   le filtrage et la NAT s'effectueront sur l'interface <tt>tun0</tt> <i>au
d198 4
a201 6
<blockquote>
<tt>
set block-policy return<br>
set loginterface $ext_if
</tt>
</blockquote>
d213 1
a213 2
<blockquote>
<tt>
d215 5
a219 4
</tt>
</blockquote>
Veuillez prendre note que nous n'effectuons pas de filtrage sur le
groupe d'interfaces <tt>lo</tt> entier, de cette manière nous pourrions
d224 33
a256 15
<h3>Scrub</h3>
Il n'y a aucune raison pour ne pas utiliser la normalisation de paquets
recommandée pour tous les paquets entrants. Il suffit d'utiliser la
ligne suivante :

<blockquote>
<tt>
match in all scrub (no-df)
</tt>
</blockquote>

<a name="nat"></a>
<h3>Traduction d'Adresses Réseau</h3>
Pour effectuer la NAT du réseau interne, la règle de <tt>nat</tt>
suivante est utilisée :
d258 6
a263 5
<blockquote>
<tt>
nat on $ext_if from !($ext_if) to any -&gt; ($ext_if)
</tt>
</blockquote>
d266 6
a271 4
Dans ce cas, "<tt>!($ext_if)</tt>" pourrait être aisément remplacé par
"<tt>$int_if</tt>" mais si vous ajoutez plusieurs interfaces internes
vous devrez ajouter de nouvelles règles NAT, alors qu'avec cette
structure, NAT sera activé sur toutes les interfaces protégées.
d274 16
a289 4
Vu que l'adresse IP de l'interface externe est attribuée dynamiquement,
des parenthèses sont utilisés autour de l'interface de traduction afin
que PF tienne compte automatiquement des changements d'adresse IP sur
cette interface.
d292 6
a297 2
Puisque nous souhaitons que le proxy FTP fonctionne, nous ajouterons
également <a href="anchors.html">l'ancre</a> NAT :
a298 5
<blockquote>
<tt>
nat-anchor "ftp-proxy/*"
</tt>
</blockquote>
d300 4
a303 32
<a name="rdr"></a>
<h3>Redirection</h3>
La première redirection est pour
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=ftp-proxy&amp;sektion=8&amp;manpath=OpenBSD+4.7">ftp-proxy(8)</a> 
afin de permettre aux clients FTP sur le réseau interne de se connecter
à des serveurs FTP sur Internet.
<blockquote>
<tt>
rdr-anchor "ftp-proxy/*"<br>
rdr on $int_if proto tcp from any to any port 21 -&gt; 127.0.0.1 port 8021
</tt>
</blockquote>

<p>
Il est à noter que cette règle ne fonctionnera que pour les connexions
FTP au port 21. Si les utilisateurs se connectent de manière régulière à
des serveurs FTP sur d'autres ports, une liste devra être utilisée pour
spécifier le port de destination, par exemple : <tt>from any to any port
{ 21, 2121 }</tt>.

<p>
La dernière règle de redirection est utilisée pour toutes les tentatives
de connexion sur le port TCP 80 du pare-feu en provenance d'Internet.
Les tentatives légitimes d'accès à ce port seront générées par des
utilisateurs qui essaient d'accèder au serveur web du réseau. Ces
tentatives de connexion doivent être redirigées vers COMP3 :

<blockquote>
<tt>
rdr on $ext_if proto tcp from any to any port 80 -&gt; $comp3
</tt>
</blockquote>
d305 6
a310 9
<a name="filter"></a>
<h3>Règles de Filtrage</h3>
Détaillons maintenant les règles de filtrage. Commencez par
l'interdiction par défaut de tout trafic :
<blockquote>
<tt>
block in<br>
</tt>
</blockquote>
d314 3
a316 1
du réseau interne. Des règles suivantes vont ouvrir un certain
d330 7
a336 6
<blockquote>
<tt>
pass out keep state
</tt>
</blockquote>

a337 8
Nous avons besoin d'une <a href="anchors.html">ancre</a> pour
ftp-proxy(8) :
<blockquote>
<tt>
anchor "ftp-proxy/*"
</tt>
</blockquote>

d340 1
a340 2
<blockquote>
<tt>
d342 1
a342 2
</tt>
</blockquote>
d349 4
a352 6
<blockquote>
<tt>
pass in on $ext_if inet proto tcp from any to ($ext_if) \<br>
&nbsp;&nbsp;&nbsp;port $tcp_services flags S/SA keep state
</tt>
</blockquote>
d365 10
a374 8
En plus de la règle <tt>rdr</tt> qui fait suivre tout le trafic web vers
COMP3, nous DEVONS aussi autoriser ce trafic à travers le pare-feu :
<blockquote>
<tt>
pass in on $ext_if inet proto tcp from any to $comp3 port 80 \<br>
&nbsp;&nbsp;&nbsp;&nbsp;flags S/SA synproxy state
</tt>
</blockquote>
d383 3
a385 5
<blockquote>
<tt>
pass in inet proto icmp all icmp-type $icmp_types keep state
</tt>
</blockquote>
d400 3
a402 5
<blockquote>
<tt>
pass in quick on $int_if
</tt>
</blockquote>
d406 1
a406 1
du pare-feu grâce à la règle précédente "<tt>pass out keep state</tt>".
d417 1
a417 1
ext_if="fxp0"
d426 1
d428 1
a428 1
set loginterface $ext_if
d432 6
a437 2
# scrub
match in all scrub (no-df)
d439 3
a441 6
# nat/rdr
nat on $ext_if from !($ext_if) -> ($ext_if:0)
nat-anchor "ftp-proxy/*"
rdr-anchor "ftp-proxy/*"
rdr pass on $int_if proto tcp to port ftp -> 127.0.0.1 port 8021
rdr on $ext_if proto tcp from any to any port 80 -> $comp3
a443 1
block in
d445 2
a446 1
pass out keep state
a447 1
anchor "ftp-proxy/*"
d450 2
a451 2
pass in on $ext_if inet proto tcp from any to ($ext_if) \
   port $tcp_services flags S/SA keep state
d453 2
a454 2
pass in on $ext_if inet proto tcp from any to $comp3 port 80 \
   flags S/SA synproxy state
d456 1
a456 1
pass in inet proto icmp all icmp-type $icmp_types keep state
d458 1
a458 1
pass in quick on $int_if
d476 2
a477 2
Originally [OpenBSD: example1.html,v 1.41 ]<br>
$Translation: example1.html,v 1.39 2010/05/24 06:30:44 benoit Exp $<br>
@


1.33
log
@Sync with Steelix CVS
@
text
@d147 1
a147 1
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=pfctl&amp;sektion=8&amp;manpath=OpenBSD+4.6"
d271 1
a271 1
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=ftp-proxy&amp;sektion=8&amp;manpath=OpenBSD+4.6">ftp-proxy(8)</a> 
d485 2
a486 2
Originally [OpenBSD: example1.html,v 1.40 ]<br>
$Translation: example1.html,v 1.38 2010/03/19 05:31:41 benoit Exp $<br>
@


1.32
log
@Sync with Steelix CVS
@
text
@d150 1
d485 2
a486 2
Originally [OpenBSD: example1.html,v 1.39 ]<br>
$Translation: example1.html,v 1.37 2009/10/19 15:29:20 benoit Exp $<br>
@


1.31
log
@Sync with Steelix CVS
@
text
@d147 1
a147 1
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=pfctl&amp;sektion=8&amp;manpath=OpenBSD+4.5"
d230 1
a230 1
scrub in
d270 1
a270 1
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=ftp-proxy&amp;sektion=8&amp;manpath=OpenBSD+4.5">ftp-proxy(8)</a> 
d441 1
a441 1
scrub in
d484 2
a485 2
Originally [OpenBSD: example1.html,v 1.38 ]<br>
$Translation: example1.html,v 1.36 2009/04/30 22:46:58 benoit Exp $<br>
@


1.30
log
@Sync with Steelix CVS
@
text
@d147 1
a147 1
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=pfctl&amp;sektion=8&amp;manpath=OpenBSD+4.4"
d270 1
a270 1
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=ftp-proxy&amp;sektion=8&amp;manpath=OpenBSD+4.4">ftp-proxy(8)</a> 
d484 2
a485 2
Originally [OpenBSD: example1.html,v 1.37 ]<br>
$Translation: example1.html,v 1.35 2009/01/25 20:10:53 benoit Exp $<br>
@


1.29
log
@Sync with Steelix CVS
@
text
@d484 2
a485 2
Originally [OpenBSD: example1.html,v 1.36 ]<br>
$Translation: example1.html,v 1.34 2008/11/26 22:39:38 benoit Exp $<br>
@


1.28
log
@Sync with Steelix CVS
@
text
@d147 1
a147 1
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=pfctl&amp;sektion=8&amp;manpath=OpenBSD+4.3"
d270 1
a270 1
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=ftp-proxy&amp;sektion=8&amp;manpath=OpenBSD+4.3">ftp-proxy(8)</a> 
d484 2
a485 2
Originally [OpenBSD: example1.html,v 1.35 ]<br>
$Translation: example1.html,v 1.33 2008/08/20 15:32:00 gapz Exp $<br>
@


1.27
log
@Sync with Steelix CVS
@
text
@d147 1
a147 1
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=pfctl&amp;sektion=8&amp;manpath=OpenBSD+4.2"
d270 1
a270 1
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=ftp-proxy&amp;sektion=8&amp;manpath=OpenBSD+4.2">ftp-proxy(8)</a> 
d484 2
a485 2
Originally [OpenBSD: example1.html,v 1.34 ]<br>
$Translation: example1.html,v 1.32 2008/01/11 10:30:24 saad Exp $<br>
@


1.26
log
@Sync with steelix translation CVS
@
text
@d147 1
a147 1
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=pfctl&amp;sektion=8&amp;manpath=OpenBSD+4.1"
d270 1
a270 1
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=ftp-proxy&amp;sektion=8&amp;manpath=OpenBSD+4.1">ftp-proxy(8)</a> 
d466 1
a466 1
pass quick on $int_if
d484 2
a485 2
Originally [OpenBSD: example1.html,v 1.32 ]<br>
$Translation: example1.html,v 1.31 2007/05/07 09:38:20 ajacoutot Exp $<br>
@


1.25
log
@sync with Steelix CVS
@
text
@d125 1
a125 1
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=ping&amp;sektion=8&amp;manpath=OpenBSD+4.0">ping(8)</a>.
d143 1
a143 1
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=sysctl&amp;sektion=3&amp;manpath=OpenBSD+4.0"
d147 1
a147 1
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=pfctl&amp;sektion=8&amp;manpath=OpenBSD+4.0"
d186 1
a186 1
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=pppoe&amp;sektion=8&amp;manpath=OpenBSD+4.0">PPPoE</a>, 
d207 1
a207 1
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=lo&amp;sektion=4&amp;manpath=OpenBSD+4.0"
d270 1
a270 1
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=ftp-proxy&amp;sektion=8&amp;manpath=OpenBSD+4.0">ftp-proxy(8)</a> 
d484 2
a485 2
Originally [OpenBSD: example1.html,v 1.31 ]<br>
$Translation: example1.html,v 1.30 2007/02/15 08:29:35 benoit Exp $<br>
@


1.24
log
@sync with Steelix CVS
@
text
@d103 1
a103 1
cartes réseau : une 3Com 3c905B (<tt>xl0</tt>) et d'une Intel
d140 1
a140 1
Ce document suppose que le hôte OpenBSD a été correctement configuré
d205 1
a205 1
conversée avec les autres au sein du même système.
d318 1
a318 1
interface?
d397 3
a399 2
types des paquets ICMP qui doivent être autorisés à atteindre le pare-
feu. Notez que cette règle s'applique à toutes les interfaces réseau.
d414 1
a414 1
Le trafic TCP, UDP, et ICMP à destination d'Internet est autorisé sortir
d485 1
a485 1
$Translation: example1.html,v 1.29 2007/02/05 07:03:30 benoit Exp $<br>
@


1.23
log
@sync with steelix translation CVS
@
text
@d39 1
a39 1
[<a href="carp.html">Précédent : Haute-disponibilité des pare-feux
d471 1
a471 1
[<a href="carp.html">Précédent : Haute-disponibilité des pare-feux
d484 1
a484 1
$Translation: example1.html,v 1.28 2006/11/02 08:49:03 ajacoutot Exp $<br>
@


1.22
log
@sync with steelix translation CVS
@
text
@d125 1
a125 1
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=ping&amp;sektion=8&amp;manpath=OpenBSD+3.9">ping(8)</a>.
d143 2
a144 2
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=sysctl&amp;sektion=3&amp;manpath=OpenBSD+3.9"
>sysctl(3)</a> <tt>net.inet.ip.forwarding</tt> et
d146 4
d186 1
a186 1
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=pppoe&amp;sektion=8&amp;manpath=OpenBSD+3.9">PPPoE</a>, 
d207 1
a207 1
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=lo&amp;sektion=4&amp;manpath=OpenBSD+3.9"
d270 1
a270 1
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=ftp-proxy&amp;sektion=8&amp;manpath=OpenBSD+3.9">ftp-proxy(8)</a> 
d483 2
a484 2
Originally [OpenBSD: example1.html,v 1.29 ]<br>
$Translation: example1.html,v 1.27 2006/10/29 18:17:29 ajacoutot Exp $<br>
@


1.21
log
@sync with steelix translation CVS
@
text
@d142 1
a142 2
Internet et positionnement à "<tt>1</tt>" des variables
<tt>net.inet.ip.forwarding</tt> et <tt>net.inet6.ip6.forwarding</tt> de
d144 2
a145 1
>sysctl(3)</a>.
d480 1
a480 1
$Translation: example1.html,v 1.26 2006/10/28 18:41:16 aanriot Exp $<br>
@


1.20
log
@sync with Steelix CVS
@
text
@d142 4
a145 4
Internet et <tt>net.inet.ip.forwarding</tt> avec une valeur de
"<tt>1</tt>".
Il est probable que vous deviez également activer PF dans
<tt>/etc/rc.conf.local</tt>.
d479 2
a480 2
Originally [OpenBSD: example1.html,v 1.28 ]<br>
$Translation: example1.html,v 1.25 2006/07/03 11:42:15 ajacoutot Exp $<br>
@


1.19
log
@sync with steelix translation CVS
@
text
@d184 1
a184 1
   lieu de</i> <tt>xl0</tt>.
d479 2
a480 2
Originally [OpenBSD: example1.html,v 1.27 ]<br>
$Translation: example1.html,v 1.24 2006/05/08 07:12:57 saad Exp $<br>
@


1.18
log
@sync with Steelix CVS
@
text
@d210 1
a210 1
set skip on lo0
d213 4
d479 2
a480 2
Originally [OpenBSD: example1.html,v 1.26 ]<br>
$Translation: example1.html,v 1.23 2006/05/03 08:07:07 ajacoutot Exp $<br>
@


1.17
log
@sync with steelix translation CVS
@
text
@d158 2
a159 2
ext_if="xl0"<br>
int_if = "fxp0"<br>
d184 1
a184 1
   lieu de</i> <tt>ep0</tt>.
d251 1
a251 1
également <a href="anchor.html">l'ancre</a> NAT :
d325 1
a325 1
Nous avons besoin d'une <a href="anchor.html">ancre</a> pour
d475 2
a476 2
Originally [OpenBSD: example1.html,v 1.24 ]<br>
$Translation: example1.html,v 1.22 2006/05/02 11:57:21 ajacoutot Exp $<br>
@


1.16
log
@sync with Steelix CVS
@
text
@d73 4
a76 4
est de fournir un accès Internet au réseau local et de fournir un accès
limité au pare-feu depuis Internet. Ce document a pour but de vous
montrer comment on construit un jeu de règles correspondant à l'objectif
précité.
d85 2
a86 2
      |            |                               ADSL
   ---+------+-----+------- fxp0 [ OpenBSD ] ep0 -------- ( Internet )
d102 3
a104 3
Le routeur OpenBSD est une machine dotée d'un Pentium 100 et de deux
cartes réseau : une 3Com 3c509B (<tt>ep0</tt>) et d'une Intel
EtherExpress Pro/100 (<tt>fxp0</tt>). Le routeur a une connexion ADSL
d125 1
a125 1
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=ping&amp;sektion=8&amp;manpath=OpenBSD+3.8">ping(8)</a>.
d142 4
a145 2
Internet, <tt>net.inet.ip.forwarding</tt> avec une valeur de
"<tt>1</tt>" etc.
d158 1
a159 1
ext_if = "ep0"<br>
a163 3
priv_nets = "{ 127.0.0.0/8, 192.168.0.0/16, 172.16.0.0/12, 10.0.0.0/8 }"
<br>
<br>
d170 8
a177 7
lesquelles le filtrage sera effectué. Les deux lignes suivantes listent
les numéros de port TCP des services ouverts depuis Internet (SSH et
ident/auth) et les types de paquets ICMP qui sont autorisés à parvenir
jusqu'aù pare-feu. La cinquième ligne définit le réseau de loopback et
les blocs d'adresses
<a href="http://www.geektools.com/rfc/rfc1918.txt">RFC 1918</a>.
Enfin, la dernière ligne définit l'adresse IP de COMP3.
d180 1
a180 1
<b>Remarque</b> : Si la connexion Internet ADSL nécessite l'utilisation
d182 1
a182 1
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=pppoe&amp;sektion=8&amp;manpath=OpenBSD+3.8">PPPoE</a>, 
d203 1
a203 1
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=lo&amp;sektion=4&amp;manpath=OpenBSD+3.8"
d222 1
a222 1
scrub in all
d233 1
a233 1
nat on $ext_if from $int_if:network to any -&gt; ($ext_if)
d238 6
d249 10
d262 1
a262 1
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=ftp-proxy&amp;sektion=8&amp;manpath=OpenBSD+3.8">ftp-proxy(8)</a> 
d267 1
d280 1
a280 1
La seconde règle de redirection est utilisée pour toutes les tentatives
d298 1
a298 1
block all<br>
d303 2
a304 2
Avec cette règle, aucun trafic ne sera autorisé y compris le trafic
provenant du réseau interne. Les règles ci-après vont ouvrir un certain
d309 9
a317 7
Ensuite, les adresses
<a href="http://www.geektools.com/rfc/rfc1918.txt">RFC 1918</a>
doivent être bloquées en entrée et en sortie de l'interface externe. Ces
adresses ne doivent jamais apparaître sur le réseau Internet public.
Leur filtrage permet de s'assurer que le routeur ne divulgue pas les
adresses utilisées par le réseau interne et de bloquer tous les paquets
entrants avec une adresse source appartenant à l'un de ces réseaux.
d320 1
a320 2
block drop in &nbsp;quick on $ext_if from $priv_nets to any<br>
block drop out quick on $ext_if from any to $priv_nets
d325 15
a339 8
Il est à noter que <tt>block drop</tt> est utilisé pour dire à PF de ne
pas répondre par un paquet TCP RST ou ICMP "Unreachable". Vu que les
adresses correspondant à la RFC 1918 n'existent pas sur Internet, tout
paquet envoyé vers une de ces adresses ne sera jamais acheminé vers sa
destination de toute façon. L'option <tt>quick</tt> est utilisée pour
dire à PF de ne pas évaluer le reste des règles de filtrage si un paquet
correspond à l'une des règles ci-dessus; les paquets de et vers les
réseaux <tt>$priv_nets</tt> seront immédiatement détruits.
d343 3
a345 1
disponibles depuis Internet :
d368 1
a368 1
pass in on $ext_if proto tcp from any to $comp3 port 80 \<br>
d379 1
a379 14
Pour que les connexions en mode FTP actif fonctionnent à partir du LAN,
la règle ci-après doit être utilisée pour autoriser la connexion
ftp-data initiée par le serveur FTP vers le client.
Vu que ftp-proxy sert de mandataire pour les connexion FTP, il acceptera
la connexion ftp-data et retransmettra les données au client sur le LAN.
<blockquote>
<tt>
pass in on $ext_if inet proto tcp from port 20 to ($ext_if) \<br>
&nbsp;&nbsp;&nbsp;&nbsp;user proxy flags S/SA keep state
</tt>
</blockquote>

<p>
Le trafic ICMP doit aussi être permis :
d396 2
a397 46
pas nécessairement une bonne supposition; pour certains environnements,
il serait plus judicieux d'utiliser un jeu de règles plus restrictif.
<blockquote>
<tt>
pass in on $int_if from $int_if:network to any keep state
</tt>
</blockquote>

<p>
La règle ci-dessus permettra à n'importe quelle machine interne
d'envoyer des paquets à travers le pare-feu; cependant, le pare-feu ne
sera <i>pas</i> autorisé à à initier une connexion vers une machine
interne. Est-ce une bonne idée ? Ceci dépendra de certains détails fins
de la configuration réseau. Si le pare-feu est aussi un serveur DHCP, il
aurait éventuellement besoin de vérifier la présence d'une adresse
("ping") pour voir si elle est disponible avant de l'attribuer à une
machine. Permettre au pare-feu de se connecter au réseau interne veut
dire aussi que quelqu'un qui accéderait en SSH au pare-feu depuis
Internet sera autorisé à accèder aux machines sur le réseau. Gardez à
l'esprit que ne <i>pas</i> autoriser le pare-feu à communiquer directement avec
le réseau n'est pas d'un grand bénéfice du point de vue de la sécurité; si
quelqu'un accède au pare-feu, il pourra très probablement altérer les
règles de filtrage de toute façon. En ajoutant la règle suivante, le 
pare-feu sera capable d'initier des connexions vers le réseau interne :
<blockquote>
<tt>
pass out on $int_if from any to $int_if:network keep state
</tt>
</blockquote>

<p>
Notez que si les deux lignes ci-dessus sont utilisées, l'option <tt>keep
state</tt> n'est pas nécessaire car il y a une règle pour laisser passer
les paquets dans les deux directions. Cependant, si la ligne <tt>pass
out</tt> n'est <i>pas</i> utilisée, la règle <tt>pass in</tt>
<i>doit</i> comporter l'option <tt>keep state</tt>. Garder l'état d'une
connexion permet aussi d'améliorer les performances : Les tables d'état
sont vérifiées avant l'évaluation des règles, et si un état est trouvé,
le passage du paquet à travers le pare-feu est autorisé sans que le jeu
de règles ne soit évalué. Cette méthode de fonctionnement peut offrir de
meilleures performances pour un pare-feu très chargé bien que pour un
système aussi simple, la charge ne sera très certainement pas assez
significative pour que cela fasse une différence.

<p>
Finalement, il faut laisser le trafic sortir de l'interface externe :
d400 1
a400 2
pass out on $ext_if proto tcp all modulate state flags S/SA<br>
pass out on $ext_if proto { udp, icmp } all keep state
d406 4
a409 3
du pare-feu. L'information sur l'état des connexions est sauvegardée
pour permettre aux paquets de retour de passer à leur tour la barrière
que constitue le pare-feu.
d417 2
a418 2
int_if = "fxp0"
ext_if = "ep0"
a422 2
priv_nets = "{ 127.0.0.0/8, 192.168.0.0/16, 172.16.0.0/12, 10.0.0.0/8 }"
          
d428 2
a429 1
set skip on lo0
d432 1
a432 1
scrub in all
d435 5
a439 4
nat on $ext_if from $int_if:network to any -&gt; ($ext_if)
rdr on $int_if proto tcp from any to any port 21 -&gt; 127.0.0.1 \
   port 8021
rdr on $ext_if proto tcp from any to any port 80 -&gt; $comp3
d442 1
a442 1
block all
d444 4
a447 2
block drop in  quick on $ext_if from $priv_nets to any
block drop out quick on $ext_if from any to $priv_nets
d452 1
a452 1
pass in on $ext_if proto tcp from any to $comp3 port 80 \
a454 3
pass in on $ext_if inet proto tcp from port 20 to ($ext_if) \
   user proxy flags S/SA keep state

d457 1
a457 5
pass in  on $int_if from $int_if:network to any keep state
pass out on $int_if from any to $int_if:network keep state

pass out on $ext_if proto tcp all modulate state flags S/SA
pass out on $ext_if proto { udp, icmp } all keep state
d475 2
a476 2
Originally [OpenBSD: example1.html,v 1.22 ]<br>
$Translation: example1.html,v 1.20 2006/03/09 14:46:29 ajacoutot Exp $<br>
@


1.15
log
@sync with Steelix CVS
@
text
@d35 1
a35 1
<a href="../../fr/index.html">
d183 2
a184 2
   le filtrage et la NAT s'effectueront sur l'interface <tt>tun0</tt> au
   lieu de <tt>ep0</tt>.
d401 2
a402 2
l'esprit qu'interdire au pare-feu de communiquer directement avec le
réseau n'est pas d'un grand bénéfice du point de vue de la sécurité; si
d511 1
a511 1
$Translation: example1.html,v 1.19 2006/01/01 18:03:51 aanriot Exp $<br>
@


1.14
log
@sync with Steelix CVS
@
text
@d198 16
a291 13
Tout système Unix a une interface de "loopback". C'est une interface
virtuelle représentant un réseau utilisé par les applications pour
établir des canaux de communication locaux à la machine. De manière
générale, tout le trafic au niveau de l'interface de "loopback" doit
être autorisé. Sous OpenBSD, l'interface de "loopback" est
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=lo&amp;sektion=4&amp;manpath=OpenBSD+3.8">lo(4)</a>.
<blockquote>
<tt>
Pass quick on lo0 all
</tt>
</blockquote>

<p>
d460 1
a473 2
pass quick on lo0 all

d510 2
a511 2
Originally [OpenBSD: example1.html,v 1.21 ]<br>
$Translation: example1.html,v 1.18 2005/11/02 19:38:09 aanriot Exp $<br>
@


1.13
log
@sync with Steelix CVS
@
text
@d125 1
a125 1
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=ping&amp;sektion=8&amp;manpath=OpenBSD+3.7">ping(8)</a>.
d182 1
a182 1
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=pppoe&amp;sektion=8&amp;manpath=OpenBSD+3.7">PPPoE</a>, 
d230 1
a230 1
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=ftp-proxy&amp;sektion=8&amp;manpath=OpenBSD+3.7">ftp-proxy(8)</a> 
d281 1
a281 1
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=lo&amp;sektion=4&amp;manpath=OpenBSD+3.7">lo(4)</a>.
d508 2
a509 2
Originally [OpenBSD: example1.html,v 1.20 ]<br>
$Translation: example1.html,v 1.17 2005/05/22 17:21:27 saad Exp $<br>
@


1.12
log
@Sync with Steelix CVS
@
text
@d4 2
a5 1
<title>PF : Exemple : Pare-feu SoHo</title>
d39 2
a40 2
[<a href="authpf.html">Précédent : Authpf: Shell
Utilisateur pour les Passerelles d'Authentification</a>]
d44 2
a45 2
<h1><font color="#e00000">PF : Exemple : Pare-feu SoHo</font></h1>
<hr>
d125 1
a125 1
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=ping&amp;sektion=8&amp;manpath=OpenBSD+3.6">ping(8)</a>.
d182 1
a182 1
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=pppoe&amp;sektion=8&amp;manpath=OpenBSD+3.6">PPPoE</a>, 
d230 1
a230 1
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=ftp-proxy&amp;sektion=8&amp;manpath=OpenBSD+3.6">ftp-proxy(8)</a> 
d281 1
a281 1
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=lo&amp;sektion=4&amp;manpath=OpenBSD+3.6">lo(4)</a>.
d284 1
a284 1
pass quick on lo0 all
d496 2
a497 2
[<a href="authpf.html">Précédent : Authpf: Shell
Utilisateur pour les Passerelles d'Authentification</a>]
d502 2
a503 1
<a href="index.html"><img height="24" width="24" src="../../../images/back.gif" border="0" alt="[back]"></a> 
d508 2
a509 2
Originally [OpenBSD: example1.html,v 1.18 ]<br>
$Translation: example1.html,v 1.13 2005/01/17 21:34:48 aanriot Exp $<br>
@


1.11
log
@sync with Steelix CVS
@
text
@d505 1
d507 2
a508 1
$Translation: example1.html,v 1.12 2004/12/29 10:33:01 saad Exp $<br>
@


1.10
log
@sync with Steelix CVS
@
text
@d34 3
a36 1
<img alt="[OpenBSD]" height=30 width=141 src="../../../images/smalltitle.gif">
d505 2
a506 2
Originally [OpenBSD: example1.html,v 1.17 ]<br>
$Translation: example1.html,v 1.10 2004/11/03 15:21:08 saad Exp $<br>
@


1.9
log
@sync with Steelix CVS
@
text
@d346 13
d478 3
d503 2
a504 2
Originally [OpenBSD: example1.html,v 1.16 ]<br>
$Translation: example1.html,v 1.9 2004/11/01 00:11:16 saad Exp $<br>
@


1.8
log
@Sync with Steelix CVS
@
text
@d122 1
a122 1
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=ping&amp;sektion=8&amp;manpath=OpenBSD+3.5">ping(8)</a>.
d179 1
a179 1
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=pppoe&amp;sektion=8&amp;manpath=OpenBSD+3.5">PPPoE</a>, 
d227 1
a227 1
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=ftp-proxy&amp;sektion=8&amp;manpath=OpenBSD+3.5">ftp-proxy(8)</a> 
d278 1
a278 1
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=lo&amp;sektion=4&amp;manpath=OpenBSD+3.5">lo(4)</a>.
d487 2
a488 2
Originally [OpenBSD: example1.html,v 1.15 ]<br>
$Translation: example1.html,v 1.8 2004/10/11 16:43:24 saad Exp $<br>
@


1.7
log
@Sync with Steelix CVS
@
text
@d68 5
a72 6
Dans cet exemple, PF fonctionne sur une machine OpenBSD jouant le
rôle de pare-feu et de passerelle NAT pour un réseau SoHo.
L'objectif global est de fournir un accès Internet au
réseau local et de fournir un accès limité au
pare-feu depuis Internet. Ce document a pour but de vous montrer comment
on construit un jeu de règles correspondant à l'objectif
d90 6
a95 7
Il y a un certain nombre de machines sur le réseau interne. Le
diagramme en montre trois mais le vrai nombre n'est pas une
donnée utile. Ces machines sont des stations de travail normales
servant à surfer sur le web, écrire des messages
électroniques, participer à des forums de discussion en
ligne, etc à l'exception de COMP3 qui sert aussi de serveur Web.
Le réseau interne utilise le bloc de réseau
d99 6
a104 7
Le routeur OpenBSD est une machine dotée d'un Pentium 100 et de
deux cartes réseau : une 3Com 3c509B (<tt>ep0</tt>) et d'une
Intel EtherExpress Pro/100 (<tt>fxp0</tt>). Le routeur a une connexion
ADSL vers Internet et utilise la NAT pour partager cette connexion avec
le réseau interne. L'adresse IP de l'interface externe est
attribuée dynamiquement par le Fournisseur d'Accès
Internet.
d110 3
a112 4
<li>Fournir un accès Internet sans restriction pour chaque
    machine du réseau interne.
<li>Utiliser un jeu de règles bloquant tout flux par
    défaut.
d116 4
a119 4
        <li>SSH (port TCP 22) : utilisé pour la maintenance
            externe du pare-feu.
        <li>Auth/Ident (port TCP 113): utilisé par quelques
            services tels que SMTP et IRC.
d125 3
a127 3
    des tentatives d'accès à un serveur Web) vers la
    machine COMP3. Et autoriser aussi le trafic vers le port TCP 80
    destiné à COMP3 à travers le pare-feu.
d129 4
a132 4
<li>Par défaut, renvoyer un RST TCP ou un message ICMP
    "Unreachable" pour les paquets bloqués.
<li>S'assurer que le jeu de règles est aussi simple et facile
    à maintenir que possible.
d137 4
a140 4
Ce document suppose que le hôte OpenBSD a été
correctement configuré pour fonctionner comme routeur :
configuration réseau, connexion Internet,
<tt>net.inet.ip.forwarding</tt> avec une valeur de "<tt>1</tt>" etc.
d144 2
a145 3
Les sections ci-après détaillent la manière dont le
jeu de règles répondra aux objectifs
précités.
d149 2
a150 2
Les macros suivantes sont définies pour rendre la maintenance et
la lecture du jeu de règles plus faciles :
d167 5
a171 6
Les deux premières lignes définissent les interfaces
réseau sur lesquelles le filtrage sera effectué. Les deux
lignes suivantes listent les numéros de port TCP des services
ouverts depuis Internet (SSH et ident/auth) et les types de paquets ICMP
qui sont autorisés à parvenir jusqu'aù pare-feu. La
cinquième ligne définit le réseau de loopback et
d177 2
a178 2
<b>Remarque</b> : Si la connexion Internet ADSL nécessite
   l'utilisation de
d185 3
a187 3
Les deux options suivantes spécifient la réponse par
défaut fournie par les règles de filtrage <tt>block</tt>
et activent la collecte de statistiques sur l'interface externe :
d198 2
a199 2
recommandée pour tous les paquets entrants. Il suffit d'utiliser
la ligne suivante :
d209 2
a210 2
Pour effectuer la NAT du réseau interne, la règle de
<tt>nat</tt> suivante est utilisée :
d219 4
a222 4
Vu que l'adresse IP de l'interface externe est attribuée
dynamiquement, des parenthèses sont utilisés autour de
l'interface de traduction afin que PF tienne compte automatiquement des
changements d'adresse IP sur cette interface.
d228 2
a229 2
afin de permettre aux clients FTP sur le réseau interne de se
connecter à des serveurs FTP sur Internet.
d237 5
a241 6
Il est à noter que cette règle ne fonctionnera que pour
les connexions FTP au port 21. Si les utilisateurs se connectent de
manière régulière à des serveurs FTP sur
d'autres ports, une liste devra être utilisée pour
spécifier le port de destination, par exemple : <tt>from any to
any port { 21, 2121 }</tt>.
d247 2
a248 2
utilisateurs qui essaient d'accèder au serveur web du réseau.
Ces tentatives de connexion doivent être redirigées vers COMP3 :
d258 2
a259 2
Détaillons maintenant les règles de filtrage. Commencez
par l'interdiction par défaut de tout trafic :
d267 4
a270 5
Avec cette règle, aucun trafic ne sera autorisé y compris
le trafic provenant du réseau interne. Les règles
ci-après vont ouvrir un certain nombre de flux sur le pare-feu
afin de répondre aux objectifs précités et d'ouvrir
toutes les interfaces virtuelles nécessaires.
d273 5
a277 6
Tout système Unix a une interface de "loopback". C'est une
interface virtuelle représentant un réseau utilisé
par les applications pour établir des canaux de communication
locaux à la machine. De manière générale,
tout le trafic au niveau de l'interface de "loopback" doit être
autorisé. Sous OpenBSD, l'interface de "loopback" est
d288 5
a292 6
doivent être bloquées en entrée et en sortie de
l'interface externe. Ces adresses ne doivent jamais apparaître sur
le réseau Internet public. Leur filtrage permet de s'assurer que
le routeur ne divulgue pas les adresses utilisées par le
réseau interne et de bloquer tous les paquets entrants avec une
adresse source appartenant à l'un de ces réseaux.
d301 8
a308 10
Il est à noter que <tt>block drop</tt> est utilisé pour
dire à PF de ne pas répondre par un paquet TCP RST ou ICMP
"Unreachable". Vu que les adresses correspondant à la RFC 1918
n'existent pas sur Internet, tout paquet envoyé vers une de ces
adresses ne sera jamais acheminé vers sa destination de toute
façon. L'option <tt>quick</tt> est utilisée pour dire
à PF de ne pas évaluer le reste des règles de
filtrage si un paquet correspond à l'une des règles
ci-dessus; les paquets de et vers les réseaux <tt>$priv_nets</tt>
seront immédiatement détruits.
d311 2
a312 2
Maintenant, il faut ouvrir les ports utilisés par les services
réseau disponibles depuis Internet :
d323 5
a327 6
connexions provenant d'Internet plus facile dans la mesure où il
suffira de modifier la macro et recharger le jeu de règles. Des
services UDP peuvent aussi être mis à disposition en
créant la macro <tt>$udp_services</tt> et en ajoutant une
règle de filtrage adéquate similaire à la
règle de filtrage ci-dessus en spécifiant <tt>proto
d331 2
a332 3
En plus de la règle <tt>rdr</tt> qui fait suivre tout le trafic
web vers COMP3, nous DEVONS aussi autoriser ce trafic à travers
le pare-feu :
d341 3
a343 4
Pour un niveau de sécurité plus élevé, nous
utilisons
<a href="filter.html#synproxy">TCP SYN Proxy</a> pour
améliorer la protection du web serveur.
d355 3
a357 4
<tt>$icmp_types</tt> peut facilement être modifiée pour
changer les types des paquets ICMP qui doivent être
autorisés à atteindre le pare-feu. Notez que cette
règle s'applique à toutes les interfaces réseau.
d360 5
a364 6
Maintenant, le trafic en provenance du réseau interne doit
être autorisé. Nous supposerons que les utilisateurs du
réseau interne savent ce qu'ils font et ne provoqueront pas de
problème sur Internet. Ce n'est pas nécessairement une
bonne supposition; pour certains environnements, il serait plus
judicieux d'utiliser un jeu de règles plus restrictif.
d372 15
a386 19
La règle ci-dessus permettra à n'importe quelle machine
interne d'envoyer des paquets à travers le pare-feu; cependant,
le pare-feu ne sera <i>pas</i> autorisé à à initier
une connexion vers une machine interne. Est-ce une bonne idée ?
Ceci dépendra de certains détails fins de la configuration
réseau. Si le pare-feu est aussi un serveur DHCP, il aurait
éventuellement besoin de vérifier la présence d'une
adresse ("ping") pour voir si elle est disponible avant de l'attribuer
à une machine. Permettre au pare-feu de se connecter au
réseau interne veut dire aussi que quelqu'un qui
accéderait en SSH au pare-feu depuis Internet sera
autorisé à accèder aux machines sur le
réseau. Gardez à l'esprit qu'interdire au pare-feu de
communiquer directement avec le réseau n'est pas d'un grand
bénéfice du point de vue de la sécurité; si
quelqu'un accède au pare-feu, il pourra très probablement
altérer les règles de filtrage de toute façon. En
ajoutant la règle suivante, le pare-feu sera capable d'initier
des connexions vers le réseau interne :
d394 12
a405 15
Notez que si les deux lignes ci-dessus sont utilisées, l'option
<tt>keep state</tt> n'est pas nécessaire car il y a une
règle pour laisser passer les paquets dans les deux directions.
Cependant, si la ligne <tt>pass out</tt> n'est <i>pas</i>
utilisée, la règle <tt>pass in</tt> <i>doit</i> comporter
l'option <tt>keep state</tt>. Garder l'état d'une connexion
permet aussi d'améliorer les performances : Les tables
d'état sont vérifiées avant l'évaluation des
règles, et si un état est trouvé, le passage du
paquet à travers le pare-feu est autorisé sans que le jeu
de règles ne soit évalué. Cette méthode de
fonctionnement peut offrir de meilleures performances pour un pare-feu
très chargé bien que pour un système aussi simple,
la charge ne sera très certainement pas assez significative pour
que cela fasse une différence.
d417 4
a420 5
Le trafic TCP, UDP, et ICMP à destination d'Internet est
autorisé sortir du pare-feu. L'information sur l'état des
connexions est sauvegardée pour permettre aux paquets de retour
de passer à leur tour la barrière que constitue le
pare-feu.
d488 1
a488 1
$Translation: example1.html,v 1.7 2004/10/11 12:24:36 saad Exp $<br>
@


1.6
log
@Sync with Steelix CVS
@
text
@d36 1
a36 1
[<a href="authpf.html">Pr&eacute;c&eacute;dent : Authpf: Shell
d44 1
a44 1
<h3>Table des Mati&egrave;res</h3>
d48 1
a48 1
        <li><a href="#network">Le R&eacute;seau</a>
d50 1
a50 1
        <li><a href="#prep">Pr&eacute;paration</a>
d52 1
a52 1
<li><a href="#ruleset">Le Jeu de R&egrave;gles</a>
d57 1
a57 1
        <li><a href="#nat">Traduction d'Adresses R&eacute;seau</a>
d59 1
a59 1
        <li><a href="#filter">R&egrave;gles de Filtrage</a>
d61 1
a61 1
<li><a href="#allrules">Le Jeu de R&egrave;gles Complet</a>
d69 3
a71 3
r&ocirc;le de pare-feu et de passerelle NAT pour un r&eacute;seau SoHo.
L'objectif global est de fournir un acc&egrave;s Internet au
r&eacute;seau local et de fournir un acc&egrave;s limit&eacute; au
d73 2
a74 2
on construit un jeu de r&egrave;gles correspondant &agrave; l'objectif
pr&eacute;cit&eacute;.
d77 2
a78 2
<h3>Le R&eacute;seau</h3>
Le r&eacute;seau est con&ccedil;u de la mani&egrave;re suivante :
d91 1
a91 1
Il y a un certain nombre de machines sur le r&eacute;seau interne. Le
d93 5
a97 5
donn&eacute;e utile. Ces machines sont des stations de travail normales
servant &agrave; surfer sur le web, &eacute;crire des messages
&eacute;lectroniques, participer &agrave; des forums de discussion en
ligne, etc &agrave; l'exception de COMP3 qui sert aussi de serveur Web.
Le r&eacute;seau interne utilise le bloc de r&eacute;seau
d101 2
a102 2
Le routeur OpenBSD est une machine dot&eacute;e d'un Pentium 100 et de
deux cartes r&eacute;seau : une 3Com 3c509B (<tt>ep0</tt>) et d'une
d105 2
a106 2
le r&eacute;seau interne. L'adresse IP de l'interface externe est
attribu&eacute;e dynamiquement par le Fournisseur d'Acc&egrave;s
d113 5
a117 5
<li>Fournir un acc&egrave;s Internet sans restriction pour chaque
    machine du r&eacute;seau interne.
<li>Utiliser un jeu de r&egrave;gles bloquant tout flux par
    d&eacute;faut.
<li>Autoriser les flux entrants suivants sur le pare-feu &agrave; partir
d120 1
a120 1
        <li>SSH (port TCP 22) : utilis&eacute; pour la maintenance
d122 1
a122 1
        <li>Auth/Ident (port TCP 113): utilis&eacute; par quelques
d125 1
a125 1
            utilis&eacute; par
d129 1
a129 1
    des tentatives d'acc&egrave;s &agrave; un serveur Web) vers la
d131 1
a131 1
    destin&eacute; &agrave; COMP3 &agrave; travers le pare-feu.
d133 4
a136 4
<li>Par d&eacute;faut, renvoyer un RST TCP ou un message ICMP
    "Unreachable" pour les paquets bloqu&eacute;s.
<li>S'assurer que le jeu de r&egrave;gles est aussi simple et facile
    &agrave; maintenir que possible.
d140 4
a143 4
<h3>Pr&eacute;paration</h3>
Ce document suppose que le h&ocirc;te OpenBSD a &eacute;t&eacute;
correctement configur&eacute; pour fonctionner comme routeur :
configuration r&eacute;seau, connexion Internet,
d147 4
a150 4
<h2>Le Jeu de R&egrave;gles</h2>
Les sections ci-apr&egrave;s d&eacute;taillent la mani&egrave;re dont le
jeu de r&egrave;gles r&eacute;pondra aux objectifs
pr&eacute;cit&eacute;s.
d154 2
a155 2
Les macros suivantes sont d&eacute;finies pour rendre la maintenance et
la lecture du jeu de r&egrave;gles plus faciles :
d172 3
a174 3
Les deux premi&egrave;res lignes d&eacute;finissent les interfaces
r&eacute;seau sur lesquelles le filtrage sera effectu&eacute;. Les deux
lignes suivantes listent les num&eacute;ros de port TCP des services
d176 2
a177 2
qui sont autoris&eacute;s &agrave; parvenir jusqu'a&ugrave; pare-feu. La
cinqui&egrave;me ligne d&eacute;finit le r&eacute;seau de loopback et
d180 1
a180 1
Enfin, la derni&egrave;re ligne d&eacute;finit l'adresse IP de COMP3.
d183 1
a183 1
<b>Remarque</b> : Si la connexion Internet ADSL n&eacute;cessite
d191 2
a192 2
Les deux options suivantes sp&eacute;cifient la r&eacute;ponse par
d&eacute;faut fournie par les r&egrave;gles de filtrage <tt>block</tt>
d204 1
a204 1
recommand&eacute;e pour tous les paquets entrants. Il suffit d'utiliser
d214 3
a216 3
<h3>Traduction d'Adresses R&eacute;seau</h3>
Pour effectuer la NAT du r&eacute;seau interne, la r&egrave;gle de
<tt>nat</tt> suivante est utilis&eacute;e :
d225 2
a226 2
Vu que l'adresse IP de l'interface externe est attribu&eacute;e
dynamiquement, des parenth&egrave;ses sont utilis&eacute;s autour de
d232 1
a232 1
La premi&egrave;re redirection est pour
d234 2
a235 2
afin de permettre aux clients FTP sur le r&eacute;seau interne de se
connecter &agrave; des serveurs FTP sur Internet.
d243 1
a243 1
Il est &agrave; noter que cette r&egrave;gle ne fonctionnera que pour
d245 3
a247 3
mani&egrave;re r&eacute;guli&egrave;re &agrave; des serveurs FTP sur
d'autres ports, une liste devra &ecirc;tre utilis&eacute;e pour
sp&eacute;cifier le port de destination, par exemple : <tt>from any to
d251 1
a251 1
La seconde r&egrave;gle de redirection est utilis&eacute;e pour toutes les tentatives
d253 3
a255 3
Les tentatives l&eacute;gitimes d'acc&egrave;s &agrave; ce port seront g&eacute;n&eacute;r&eacute;es par des
utilisateurs qui essaient d'acc&egrave;der au serveur web du r&eacute;seau.
Ces tentatives de connexion doivent &ecirc;tre redirig&eacute;es vers COMP3 :
d264 3
a266 3
<h3>R&egrave;gles de Filtrage</h3>
D&eacute;taillons maintenant les r&egrave;gles de filtrage. Commencez
par l'interdiction par d&eacute;faut de tout trafic :
d274 5
a278 5
Avec cette r&egrave;gle, aucun trafic ne sera autoris&eacute; y compris
le trafic provenant du r&eacute;seau interne. Les r&egrave;gles
ci-apr&egrave;s vont ouvrir un certain nombre de flux sur le pare-feu
afin de r&eacute;pondre aux objectifs pr&eacute;cit&eacute;s et d'ouvrir
toutes les interfaces virtuelles n&eacute;cessaires.
d281 6
a286 6
Tout syst&egrave;me Unix a une interface de "loopback". C'est une
interface virtuelle repr&eacute;sentant un r&eacute;seau utilis&eacute;
par les applications pour &eacute;tablir des canaux de communication
locaux &agrave; la machine. De mani&egrave;re g&eacute;n&eacute;rale,
tout le trafic au niveau de l'interface de "loopback" doit &ecirc;tre
autoris&eacute;. Sous OpenBSD, l'interface de "loopback" est
d297 6
a302 6
doivent &ecirc;tre bloqu&eacute;es en entr&eacute;e et en sortie de
l'interface externe. Ces adresses ne doivent jamais appara&icirc;tre sur
le r&eacute;seau Internet public. Leur filtrage permet de s'assurer que
le routeur ne divulgue pas les adresses utilis&eacute;es par le
r&eacute;seau interne et de bloquer tous les paquets entrants avec une
adresse source appartenant &agrave; l'un de ces r&eacute;seaux.
d311 10
a320 10
Il est &agrave; noter que <tt>block drop</tt> est utilis&eacute; pour
dire &agrave; PF de ne pas r&eacute;pondre par un paquet TCP RST ou ICMP
"Unreachable". Vu que les adresses correspondant &agrave; la RFC 1918
n'existent pas sur Internet, tout paquet envoy&eacute; vers une de ces
adresses ne sera jamais achemin&eacute; vers sa destination de toute
fa&ccedil;on. L'option <tt>quick</tt> est utilis&eacute;e pour dire
&agrave; PF de ne pas &eacute;valuer le reste des r&egrave;gles de
filtrage si un paquet correspond &agrave; l'une des r&egrave;gles
ci-dessus; les paquets de et vers les r&eacute;seaux <tt>$priv_nets</tt>
seront imm&eacute;diatement d&eacute;truits.
d323 2
a324 2
Maintenant, il faut ouvrir les ports utilis&eacute;s par les services
r&eacute;seau disponibles depuis Internet :
d333 1
a333 1
La sp&eacute;cification des ports r&eacute;seau par le biais de la macro
d335 6
a340 6
connexions provenant d'Internet plus facile dans la mesure o&ugrave; il
suffira de modifier la macro et recharger le jeu de r&egrave;gles. Des
services UDP peuvent aussi &ecirc;tre mis &agrave; disposition en
cr&eacute;ant la macro <tt>$udp_services</tt> et en ajoutant une
r&egrave;gle de filtrage ad&eacute;quate similaire &agrave; la
r&egrave;gle de filtrage ci-dessus en sp&eacute;cifiant <tt>proto
d344 2
a345 2
En plus de la r&egrave;gle <tt>rdr</tt> qui fait suivre tout le trafic
web vers COMP3, nous DEVONS aussi autoriser ce trafic &agrave; travers
d355 1
a355 1
Pour un niveau de s&eacute;curit&eacute; plus &eacute;lev&eacute;, nous
d358 1
a358 1
am&eacute;liorer la protection du web serveur.
d361 1
a361 1
Le trafic ICMP doit aussi &ecirc;tre permis :
d370 4
a373 4
<tt>$icmp_types</tt> peut facilement &ecirc;tre modifi&eacute;e pour
changer les types des paquets ICMP qui doivent &ecirc;tre
autoris&eacute;s &agrave; atteindre le pare-feu. Notez que cette
r&egrave;gle s'applique &agrave; toutes les interfaces r&eacute;seau.
d376 4
a379 4
Maintenant, le trafic en provenance du r&eacute;seau interne doit
&ecirc;tre autoris&eacute;. Nous supposerons que les utilisateurs du
r&eacute;seau interne savent ce qu'ils font et ne provoqueront pas de
probl&egrave;me sur Internet. Ce n'est pas n&eacute;cessairement une
d381 1
a381 1
judicieux d'utiliser un jeu de r&egrave;gles plus restrictif.
d389 7
a395 7
La r&egrave;gle ci-dessus permettra &agrave; n'importe quelle machine
interne d'envoyer des paquets &agrave; travers le pare-feu; cependant,
le pare-feu ne sera <i>pas</i> autoris&eacute; &agrave; &agrave; initier
une connexion vers une machine interne. Est-ce une bonne id&eacute;e ?
Ceci d&eacute;pendra de certains d&eacute;tails fins de la configuration
r&eacute;seau. Si le pare-feu est aussi un serveur DHCP, il aurait
&eacute;ventuellement besoin de v&eacute;rifier la pr&eacute;sence d'une
d397 11
a407 11
&agrave; une machine. Permettre au pare-feu de se connecter au
r&eacute;seau interne veut dire aussi que quelqu'un qui
acc&eacute;derait en SSH au pare-feu depuis Internet sera
autoris&eacute; &agrave; acc&egrave;der aux machines sur le
r&eacute;seau. Gardez &agrave; l'esprit qu'interdire au pare-feu de
communiquer directement avec le r&eacute;seau n'est pas d'un grand
b&eacute;n&eacute;fice du point de vue de la s&eacute;curit&eacute;; si
quelqu'un acc&egrave;de au pare-feu, il pourra tr&egrave;s probablement
alt&eacute;rer les r&egrave;gles de filtrage de toute fa&ccedil;on. En
ajoutant la r&egrave;gle suivante, le pare-feu sera capable d'initier
des connexions vers le r&eacute;seau interne :
d415 3
a417 3
Notez que si les deux lignes ci-dessus sont utilis&eacute;es, l'option
<tt>keep state</tt> n'est pas n&eacute;cessaire car il y a une
r&egrave;gle pour laisser passer les paquets dans les deux directions.
d419 7
a425 7
utilis&eacute;e, la r&egrave;gle <tt>pass in</tt> <i>doit</i> comporter
l'option <tt>keep state</tt>. Garder l'&eacute;tat d'une connexion
permet aussi d'am&eacute;liorer les performances : Les tables
d'&eacute;tat sont v&eacute;rifi&eacute;es avant l'&eacute;valuation des
r&egrave;gles, et si un &eacute;tat est trouv&eacute;, le passage du
paquet &agrave; travers le pare-feu est autoris&eacute; sans que le jeu
de r&egrave;gles ne soit &eacute;valu&eacute;. Cette m&eacute;thode de
d427 3
a429 3
tr&egrave;s charg&eacute; bien que pour un syst&egrave;me aussi simple,
la charge ne sera tr&egrave;s certainement pas assez significative pour
que cela fasse une diff&eacute;rence.
d441 4
a444 4
Le trafic TCP, UDP, et ICMP &agrave; destination d'Internet est
autoris&eacute; sortir du pare-feu. L'information sur l'&eacute;tat des
connexions est sauvegard&eacute;e pour permettre aux paquets de retour
de passer &agrave; leur tour la barri&egrave;re que constitue le
d448 1
a448 1
<h2>Le Jeu de R&egrave;gles Complet</h2>
d476 1
a476 1
# r&egrave;gles de filtrage
d502 1
a502 1
[<a href="authpf.html">Pr&eacute;c&eacute;dent : Authpf: Shell
d513 1
a513 1
$Translation: example1.html,v 1.6 2004/10/06 17:17:44 saad Exp $<br>
@


1.5
log
@sync with Steelix CVS
@
text
@d357 1
a357 1
<a href="../filter.html#synproxy">TCP SYN Proxy</a> pour
d513 1
a513 1
$Translation: example1.html,v 1.5 2004/05/16 05:58:11 saad Exp $<br>
@


1.4
log
@sync with Steelix CVS. thanks to Olivier HORN <ohorn at axal dot fr> for
a fix.
@
text
@d96 2
a97 1
ligne, etc. Le r&eacute;seau interne utilise le bloc de r&eacute;seau
d128 4
d165 3
d177 2
a178 2
derni&egrave;re ligne d&eacute;finit le r&eacute;seau de loopback et les
blocs d'adresses
d180 1
d232 1
a232 1
La seule redirection n&eacute;cessaire est pour
d250 13
d344 17
d461 2
d474 1
d487 3
d512 2
a513 2
Originally [OpenBSD: example1.html,v 1.14 ]<br>
$Translation: example1.html,v 1.4 2004/05/12 20:21:45 saad Exp $<br>
@


1.3
log
@Sync with Steelix CVS
@
text
@a10 1
<meta name="copyright"     content="This document copyright 2003-2004 by OpenBSD.">
d13 17
d467 2
a468 2
Originally [OpenBSD: example1.html,v 1.13 ]<br>
$Translation: example1.html,v 1.3 2004/05/02 20:46:22 saad Exp $<br>
@


1.2
log
@Sync with Steelix CVS
@
text
@d4 1
a4 1
<title>PF : Exemple #1 : Pare-feu SoHo</title>
d25 1
a25 1
<h1><font color="#e00000">PF : Exemple #1 : Pare-feu SoHo</font></h1>
d109 1
a109 1
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=ping&amp;sektion=8&amp;manpath=OpenBSD+3.4">ping(8)</a>.
d160 1
a160 1
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=pppoe&amp;sektion=8&amp;manpath=OpenBSD+3.4">PPPoE</a>, 
d208 1
a208 1
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=ftp-proxy&amp;sektion=8&amp;manpath=OpenBSD+3.4">ftp-proxy(8)</a> 
d249 1
a249 1
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=lo&amp;sektion=4&amp;manpath=OpenBSD+3.4">lo(4)</a>.
d451 2
a452 2
Originally [OpenBSD: example1.html,v 1.12 ]<br>
$Translation: example1.html,v 1.2 2004/01/02 21:49:07 saad Exp $<br>
@


1.1
log
@Sync with Steelix CVS
@
text
@d11 1
a11 1
<meta name="copyright"     content="This document copyright 2003 by OpenBSD.">
d451 2
a452 2
Originally [OpenBSD: example1.html,v 1.11 ]<br>
$Translation: example1.html,v 1.1 2003/12/28 21:20:14 saad Exp $<br>
@

