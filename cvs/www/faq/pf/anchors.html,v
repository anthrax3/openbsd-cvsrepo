head	1.54;
access;
symbols;
locks; strict;
comment	@# @;


1.54
date	2017.06.26.17.18.58;	author tb;	state Exp;
branches;
next	1.53;
commitid	jKVBuSx5No9bUpg1;

1.53
date	2016.09.19.23.44.47;	author tj;	state Exp;
branches;
next	1.52;
commitid	P53AgOpLKrOmgs5r;

1.52
date	2016.08.15.02.22.14;	author tb;	state Exp;
branches;
next	1.51;
commitid	3DeixV5YkPOb78RN;

1.51
date	2016.06.13.17.58.24;	author tj;	state Exp;
branches;
next	1.50;
commitid	Grx2UyJPWzJbbhkP;

1.50
date	2016.04.18.19.07.50;	author tj;	state Exp;
branches;
next	1.49;
commitid	g0cUF3jNn5Tz4oaZ;

1.49
date	2016.04.16.00.30.41;	author tj;	state Exp;
branches;
next	1.48;
commitid	rTxoenHHaeutOff1;

1.48
date	2016.04.15.20.39.49;	author tb;	state Exp;
branches;
next	1.47;
commitid	jwteSMEb4rFzI8UA;

1.47
date	2016.03.29.01.27.39;	author tb;	state Exp;
branches;
next	1.46;
commitid	4Y8oU6GBrSY1UOfW;

1.46
date	2016.03.27.19.52.09;	author sthen;	state Exp;
branches;
next	1.45;
commitid	hi2ObFv9LGB98JY5;

1.45
date	2016.03.22.10.56.56;	author sthen;	state Exp;
branches;
next	1.44;
commitid	G2izHhNJ7aqR0Y6j;

1.44
date	2016.03.21.05.46.21;	author beck;	state Exp;
branches;
next	1.43;
commitid	zEx6zFkNSFFExu0v;

1.43
date	2015.10.18.19.48.19;	author nick;	state Exp;
branches;
next	1.42;
commitid	gkrFWKimwWNVivXe;

1.42
date	2015.07.02.05.49.05;	author bentley;	state Exp;
branches;
next	1.41;
commitid	AP3UllesavMDEUhQ;

1.41
date	2015.05.11.11.18.30;	author sthen;	state Exp;
branches;
next	1.40;
commitid	wRrXxcro6dFYiwF8;

1.40
date	2015.04.30.23.48.01;	author nick;	state Exp;
branches;
next	1.39;
commitid	uFWv68UTtTmjkqVF;

1.39
date	2014.12.02.03.17.26;	author nick;	state Exp;
branches;
next	1.38;
commitid	RQ0cKiFD5x45dGyo;

1.38
date	2014.12.01.10.01.07;	author bentley;	state Exp;
branches;
next	1.37;
commitid	DtrOVs7q8kqgEsjm;

1.37
date	2014.05.01.15.03.50;	author nick;	state Exp;
branches;
next	1.36;

1.36
date	2014.03.31.02.33.07;	author nick;	state Exp;
branches;
next	1.35;

1.35
date	2013.11.01.14.07.05;	author nick;	state Exp;
branches;
next	1.34;

1.34
date	2013.05.01.13.21.45;	author nick;	state Exp;
branches;
next	1.33;

1.33
date	2012.11.01.15.06.36;	author nick;	state Exp;
branches;
next	1.32;

1.32
date	2012.05.11.11.20.04;	author nick;	state Exp;
branches;
next	1.31;

1.31
date	2011.11.02.01.01.47;	author nick;	state Exp;
branches;
next	1.30;

1.30
date	2011.05.01.12.57.11;	author nick;	state Exp;
branches;
next	1.29;

1.29
date	2010.11.01.09.53.51;	author nick;	state Exp;
branches;
next	1.28;

1.28
date	2010.05.19.13.25.16;	author sthen;	state Exp;
branches;
next	1.27;

1.27
date	2009.10.16.19.12.42;	author nick;	state Exp;
branches;
next	1.26;

1.26
date	2009.04.30.17.27.31;	author nick;	state Exp;
branches;
next	1.25;

1.25
date	2008.10.31.16.49.34;	author nick;	state Exp;
branches;
next	1.24;

1.24
date	2008.07.27.17.13.47;	author nick;	state Exp;
branches;
next	1.23;

1.23
date	2007.11.01.02.57.56;	author joel;	state Exp;
branches;
next	1.22;

1.22
date	2007.05.07.01.13.53;	author joel;	state Exp;
branches;
next	1.21;

1.21
date	2007.05.06.18.59.54;	author nick;	state Exp;
branches;
next	1.20;

1.20
date	2006.11.01.01.56.01;	author joel;	state Exp;
branches;
next	1.19;

1.19
date	2006.05.01.00.54.29;	author nick;	state Exp;
branches;
next	1.18;

1.18
date	2005.11.01.11.35.18;	author nick;	state Exp;
branches;
next	1.17;

1.17
date	2005.05.20.00.12.02;	author joel;	state Exp;
branches;
next	1.16;

1.16
date	2005.02.07.05.43.24;	author joel;	state Exp;
branches;
next	1.15;

1.15
date	2004.12.22.04.28.16;	author david;	state Exp;
branches;
next	1.14;

1.14
date	2004.11.01.21.41.07;	author nick;	state Exp;
branches;
next	1.13;

1.13
date	2004.10.29.17.22.57;	author nick;	state Exp;
branches;
next	1.12;

1.12
date	2004.05.07.01.55.23;	author nick;	state Exp;
branches;
next	1.11;

1.11
date	2004.04.30.18.00.25;	author nick;	state Exp;
branches;
next	1.10;

1.10
date	2004.01.01.04.16.17;	author nick;	state Exp;
branches;
next	1.9;

1.9
date	2003.11.27.15.08.25;	author nick;	state Exp;
branches;
next	1.8;

1.8
date	2003.11.09.23.29.02;	author nick;	state Exp;
branches;
next	1.7;

1.7
date	2003.09.22.02.29.03;	author nick;	state Exp;
branches;
next	1.6;

1.6
date	2003.09.16.01.23.49;	author nick;	state Exp;
branches;
next	1.5;

1.5
date	2003.06.23.01.51.36;	author nick;	state Exp;
branches;
next	1.4;

1.4
date	2003.06.13.02.54.08;	author nick;	state Exp;
branches;
next	1.3;

1.3
date	2003.05.15.03.03.54;	author nick;	state Exp;
branches;
next	1.2;

1.2
date	2003.05.01.14.20.37;	author nick;	state Exp;
branches;
next	1.1;

1.1
date	2003.05.01.01.46.06;	author nick;	state Exp;
branches;
next	;


desc
@@


1.54
log
@move man.openbsd.org links from http:// to https://
reduces the number of http:// links in www/ from >33k to <7k

thanks to schwarze for doing the work
@
text
@<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<html>
<head>

<!-- If you make edits to any FAQ documents, please start each sentence
     on a new line, and try to keep the general formatting consistent
     with the rest of the pages -->

<title>OpenBSD PF: Anchors</title>
<meta http-equiv="Content-Type" content="text/html; charset=ISO-8859-1">
<meta name="viewport" content="width=device-width, initial-scale=1">
<link rel="stylesheet" type="text/css" href="../../openbsd.css">
<link rel="canonical" href="https://www.openbsd.org/faq/pf/anchors.html">
</head>

<!--
Copyright (c) 2003-2007 Joel Knight <enabled@@myrealbox.com>

Permission to use, copy, modify, and distribute this documentation for
any purpose with or without fee is hereby granted, provided that the
above copyright notice and this permission notice appear in all copies.

THE DOCUMENTATION IS PROVIDED "AS IS" AND THE AUTHOR DISCLAIMS ALL
WARRANTIES WITH REGARD TO THIS DOCUMENTATION INCLUDING ALL IMPLIED
WARRANTIES OF MERCHANTABILITY AND FITNESS. IN NO EVENT SHALL THE
AUTHOR BE LIABLE FOR ANY SPECIAL, DIRECT, INDIRECT, OR CONSEQUENTIAL
DAMAGES OR ANY DAMAGES WHATSOEVER RESULTING FROM LOSS OF USE, DATA OR
PROFITS, WHETHER IN AN ACTION OF CONTRACT, NEGLIGENCE OR OTHER
TORTIOUS ACTION, ARISING OUT OF OR IN CONNECTION WITH THE USE OR
PERFORMANCE OF THIS DOCUMENTATION
-->

<body bgcolor="#ffffff" text="#000000">

<h2>
<a href="../../index.html">
<font color="#0000ff"><i>Open</i></font><font color="#000084">BSD</font></a>
<font color="#e00000">PF - Anchors</font>
<small>
<a href="index.html" style="font-weight:normal; float:right">[Contents]</a>
</small>
</h2>
<hr>

<ul>
  <li><a href="#intro"  >Introduction</a>
  <li><a href="#anchors">Anchors</a>
  <li><a href="#options">Anchor options</a>
  <li><a href="#manip"  >Manipulating anchors</a>
</ul>

<hr>

<h2 id="intro">Introduction</h2>

In addition to the main ruleset, PF can also evaluate sub-rulesets.
Since sub-rulesets can be manipulated on the fly by using
<a href="https://man.openbsd.org/pfctl">pfctl(8)</a>, they provide a convenient
way of dynamically altering an active ruleset.
Whereas a <a href="tables.html">table</a> is used to hold a dynamic list of
addresses, a sub-ruleset is used to hold a dynamic set of rules.
A sub-ruleset is attached to the main ruleset by using an <tt>anchor</tt>.

<p>
Anchors can be nested which allows for sub-rulesets to be chained together.
Anchor rules will be evaluated relative to the anchor in which they are loaded.
For example, anchor rules in the main ruleset will create anchor attachment
points with the main ruleset as their parent, and anchor rules loaded from
files with the <tt>load anchor</tt> directive will create anchor points with
that anchor as their parent.

<a name="named"></a><h2 id="anchors">Anchors</h2>

An anchor is a collection of rules, tables and other anchors that has been
assigned a name.
When PF comes across an <tt>anchor</tt> rule in the main ruleset, it will
evaluate the rules contained within the anchor point as it evaluates rules
in the main ruleset.
Processing will then continue in the main ruleset unless the packet matches
a filter rule that uses the <tt>quick</tt> option, in which case the match
will be considered final and will abort the evaluation of rules in both the
anchor and the main rulesets.

<p>
For example:

<blockquote><pre>
block on     egress
pass  out on egress

anchor goodguys
</pre></blockquote>

This ruleset sets a default deny policy on the egress interface for incoming
and outgoing traffic, which is then statefully passed out, and an anchor rule
is created named <tt>goodguys</tt>.
Anchors can be populated with rules by three methods:

<ul>
  <li>using a <tt>load</tt> rule
  <li>using <a href="https://man.openbsd.org/pfctl">pfctl(8)</a>
  <li>specifying the rules inline of the main ruleset
</ul>

The <tt>load</tt> rule causes <tt>pfctl</tt> to populate the specified anchor
by reading rules from a text file.
The <tt>load</tt> rule must be placed after the <tt>anchor</tt> rule.

<p>
For example:

<blockquote><pre>
anchor goodguys
load anchor goodguys from "/etc/anchor-goodguys-ssh"
</pre></blockquote>

To add rules to an anchor using <tt>pfctl</tt>, the following type of command
can be used:

<blockquote><pre>
# <b>echo "pass in proto tcp from 192.0.2.3 to any port 22" | pfctl -a goodguys -f -</b>
</pre></blockquote>

Rules can also be saved to (and loaded from) a text file.
For example, you could append the following two lines to the
<tt>/etc/anchor-goodguys-www</tt> file:

<blockquote><pre>
pass in proto tcp from 192.0.2.3 to any port 80
pass in proto tcp from 192.0.2.4 to any port { 80 443 }
</pre></blockquote>

Then applied with:

<blockquote><pre>
# <b>pfctl -a goodguys -f /etc/anchor-goodguys-www</b>
</pre></blockquote>

To load rules directly from the main ruleset, enclose the anchor rules
in a brace-delimited block:

<blockquote><pre>
anchor "goodguys" {
        pass in proto tcp from 192.168.2.3 to port 22
}
</pre></blockquote>

Inline anchors can also contain more anchors.

<blockquote><pre>
allow = "{ 192.0.2.3 192.0.2.4 }"

anchor "goodguys" {
  anchor {
       pass in proto tcp from 192.0.2.3 to port 80
  }
  pass in proto tcp from $allow to port 22
}
</pre></blockquote>

With inline anchors, the name of the anchor becomes optional.
Note how the nested anchor in the above example does not have a name.
The macro <tt>$allow</tt> is created outside of the anchor (in the main
ruleset) and is then used within the anchor.

<p>
Rules can be loaded into an anchor using the same syntax and options
as rules loaded into the main ruleset.
One caveat is that, unless you're using inline anchors, any
<a href="macros.html">macros</a> that are used must also be defined within
the anchor itself; macros that are defined in the parent ruleset are
<i>not</i> visible from the anchor.

<p>
Since anchors can be nested, it's possible to specify that all child
anchors within a specified anchor be evaluated:

<blockquote><pre>
anchor "spam/*"
</pre></blockquote>

This syntax causes each rule within each anchor attached to the
<tt>spam</tt> anchor to be evaluated.
The child anchors will be evaluated in alphabetical order but are not
descended into recursively.
Anchors are always evaluated relative to the anchor in which they're defined.

<p>
Each anchor, as well as the main ruleset, exist separately from the other
rulesets.
Operations done on one ruleset, such as flushing the rules, do not affect
any of the others.
In addition, removing an anchor point from the main ruleset does not destroy
the anchor or any child anchors that are attached to that anchor.
An anchor is not destroyed until it's flushed of all rules using
<a href="https://man.openbsd.org/pfctl">pfctl(8)</a> and there are no child
anchors within the anchor.

<h2 id="options">Anchor options</h2>

Optionally, <tt>anchor</tt> rules can specify interface, protocol, source
and destination address, tag, etc, using the same syntax as other rules.
When such information is given, <tt>anchor</tt> rules are only processed
if the packet matches the <tt>anchor</tt> rule's definition.

<p>
For example:

<blockquote><pre>
block          on egress
pass       out on egress
anchor ssh in  on egress proto tcp to port 22
</pre></blockquote>

The rules in the anchor <tt>ssh</tt> are only evaluated for TCP packets
destined for port 22 that come in on the egress interface.
Rules are then added to the <tt>anchor</tt> like so:

<blockquote><pre>
# <b>echo "pass in from 192.0.2.10 to any" | pfctl -a ssh -f -</b>
</pre></blockquote>

So, even though the filter rule doesn't specify an interface, protocol
or port, the host 192.0.2.10 will only be permitted to connect using
SSH because of the <tt>anchor</tt> rule's definition.

<p>
The same syntax can be applied to inline anchors.

<blockquote><pre>
allow = "{ 192.0.2.3 192.0.2.4 }"
anchor "goodguys" in proto tcp {
   anchor proto tcp to port 80 {
      pass from 192.0.2.3
   }
   anchor proto tcp to port 22 {
      pass from $allow
   }
}
</pre></blockquote>

<h2 id="manip">Manipulating anchors</h2>

Manipulation of anchors is performed via
<a href="https://man.openbsd.org/pfctl">pfctl(8)</a>.
It can be used to add and remove rules from an anchor without reloading
the main ruleset.

<p>
To list all the rules in the anchor named <tt>ssh</tt>:

<blockquote><pre>
# <b>pfctl -a ssh -s rules</b>
</pre></blockquote>

To flush all rules from the same anchor:

<blockquote><pre>
# <b>pfctl -a ssh -F rules</b>
</pre></blockquote>

For a full list of commands, please see
<a href="https://man.openbsd.org/pfctl">pfctl(8)</a>.

<p>
</body>
</html>
@


1.53
log
@less "$ext_if" and more egress to simplify example rulesets.
zap some stray <p> tags while here.
@
text
@d58 1
a58 1
<a href="http://man.openbsd.org/pfctl">pfctl(8)</a>, they provide a convenient
d101 1
a101 1
  <li>using <a href="http://man.openbsd.org/pfctl">pfctl(8)</a>
d196 1
a196 1
<a href="http://man.openbsd.org/pfctl">pfctl(8)</a> and there are no child
d245 1
a245 1
<a href="http://man.openbsd.org/pfctl">pfctl(8)</a>.
d263 1
a263 1
<a href="http://man.openbsd.org/pfctl">pfctl(8)</a>.
@


1.52
log
@tls on openbsd.org is now real:
- link to https://www.openbsd.org from the sub-projects' pages
- make internal links relative
- switch link rel=canonical to https to please some search engines
"go ahead" from beck, "do it!!!!" tj
@
text
@d88 3
a90 3
ext_if = "fxp0"
block on $ext_if
pass  out on $ext_if
d94 1
a94 1
This ruleset sets a default deny policy on <tt>fxp0</tt> for both incoming
a104 1
<p>
d210 3
a212 4
ext_if = "fxp0"
block          on $ext_if
pass       out on $ext_if
anchor ssh in  on $ext_if proto tcp to port 22
d216 1
a216 1
destined for port 22 that come in on <tt>fxp0</tt>.
@


1.51
log
@sync pf guide formatting with the main faq's style, fixing a few grammar
knits and broken links along the way.

input and ok tb
@
text
@d13 1
a13 1
<link rel="canonical" href="http://www.openbsd.org/faq/pf/anchors.html">
@


1.50
log
@page titles and <title> should be the same.
@
text
@d4 5
a10 1
<meta name="description"   content="the OpenBSD FAQ page">
d46 4
a49 4
<li><a href="#intro"  >Introduction</a>
<li><a href="#anchors">Anchors</a>
<li><a href="#options">Anchor Options</a>
<li><a href="#manip"  >Manipulating Anchors</a>
d55 28
a82 31
In addition to the main ruleset, PF can also evaluate sub rulesets.
Since sub rulesets can be manipulated on the fly by using 
<a href="http://man.openbsd.org/pfctl.8"
>pfctl(8)</a>, they provide a convenient way of dynamically
altering an active ruleset.
Whereas a <a href="tables.html">table</a> is used to hold a dynamic
list of addresses, a sub ruleset is used to hold a dynamic set of rules.
A sub ruleset is attached to the main ruleset by using an <tt>anchor</tt>.

<p>
Anchors can be nested which allows for sub rulesets to be
chained together.
Anchor rules will be evaluated relative to the anchor in which
they are loaded.
For example, anchor rules in the main ruleset will create anchor
attachment points with the main ruleset as their parent, and anchor
rules loaded from files with the <tt>load anchor</tt> directive will
create anchor points with that anchor as their parent.

<a name="named"></a>
<h2 id="anchors">Anchors</h2>
An anchor is a collection of rules, tables, and other anchors
that has been assigned a name.
When PF comes across an <tt>anchor</tt> rule in the main
ruleset, it will evaluate the rules contained within the
anchor point as it evaluates rules in the main ruleset.
Processing will then continue in the main ruleset unless the packet
matches a filter rule that uses the <tt>quick</tt> option,
in which case the match will be considered final and will
abort the evaluation of rules in both the anchor and the
main rulesets.
d86 5
a90 6
<blockquote>
<tt>
ext_if = "fxp0"<br>
<br>
block on $ext_if<br>
pass &nbsp;out on $ext_if<br>
d92 6
a97 2
</tt>
</blockquote>
a98 6
<p>
This ruleset sets a default deny policy on <tt>fxp0</tt> for both
incoming and outgoing traffic.
Traffic is then statefully passed out and an anchor rule is
created named <tt>goodguys</tt>.
Anchors can be populated with rules by three methods: 
d100 3
a102 5
<li>using a <tt>load</tt> rule
<li>using 
<a href="http://man.openbsd.org/pfctl.8"
>pfctl(8)</a>
<li>specifying the rules inline of the main ruleset
d106 2
a107 2
The <tt>load</tt> rule causes <tt>pfctl</tt> to populate the
specified anchor by reading rules from a text file.
d109 6
a114 4
Example:
<blockquote>
<tt>
anchor goodguys<br>
d116 8
a123 2
</tt>
</blockquote>
d125 14
a138 21
<p>
To add rules to an anchor using <tt>pfctl</tt>, the following type of
command can be used:
<blockquote>
<tt>
# echo "pass in proto tcp from 192.0.2.3 to any port 22" \<br>
&nbsp;&nbsp;&nbsp;| pfctl -a goodguys -f -
</tt>
</blockquote>

<p>
Rules can also be saved and loaded from a text file:
<blockquote>
<tt>
# cat &gt;&gt; /etc/anchor-goodguys-www<br>
pass in proto tcp from 192.0.2.3 to any port 80<br>
pass in proto tcp from 192.0.2.4 to any port { 80 443 }<br>
<br>
# pfctl -a goodguys -f /etc/anchor-goodguys-www<br>
</tt>
</blockquote>
a139 1
<p>
d143 3
a145 4
<blockquote>
<tt>
anchor "goodguys" { <br>
&nbsp;&nbsp;&nbsp;pass in proto tcp from 192.168.2.3 to port 22<br>
d147 1
a147 2
</tt>
</blockquote>
a148 1
<p>
d151 8
a158 9
<blockquote>
<tt>
allow = "{ 192.0.2.3 192.0.2.4 }" <br>
<br>
anchor "goodguys" { <br>
&nbsp;&nbsp;&nbsp;anchor { <br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;pass in proto tcp from 192.0.2.3 to port 80 <br>
&nbsp;&nbsp;&nbsp;} <br>
&nbsp;&nbsp;&nbsp;pass in proto tcp from $allow to port 22<br>
d160 1
a160 2
</tt>
</blockquote>
d162 1
a162 1
With inline anchors the name of the anchor becomes optional.
d164 2
a165 2
Also note how the macro <tt>$allow</tt> is created outside of the anchor
(in the main ruleset) and is then used within the anchor.
d170 4
a173 4
One caveat, however, is that unless you're using inline anchors any 
<a href="macros.html">macros</a> that are used must also be defined 
within the anchor itself; macros that are defined in the parent ruleset
are <i>not</i> visible from the anchor.
d179 1
a179 2
<blockquote>
<tt>
d181 1
a181 2
</tt>
</blockquote>
a182 1
<p>
d186 22
a207 19
descended into recursively. 
Anchors are always evaluated relative to the anchor in which they're
defined.

<p>
Each anchor, as well as the main ruleset, exist separately from
the other rulesets. Operations done on one ruleset, such as flushing the
rules, do not affect any of the others.  In addition, removing an anchor
point from the main ruleset does not destroy the anchor or any child
anchors that are attached to that anchor. An anchor is not
destroyed until it's flushed of all rules using
<a href="http://man.openbsd.org/pfctl.8"
>pfctl(8)</a> and there are no child anchors within the anchor. 

<h2 id="options">Anchor Options</h2>
Optionally, <tt>anchor</tt> rules can specify interface, protocol,
source and destination address, tag, etc., using the same syntax as other
rules. When such information is given, <tt>anchor</tt> rules are only
processed if the packet matches the <tt>anchor</tt> rule's definition.
a208 9
<blockquote>
<tt>
ext_if = "fxp0"<br>
<br>
block on $ext_if<br>
pass &nbsp;out on $ext_if<br>
anchor ssh in on $ext_if proto tcp to port 22<br>
</tt>
</blockquote>
d210 9
a218 3
<p>
The rules in the anchor <tt>ssh</tt> are only evaluated for TCP
packets destined for port 22 that come in on <tt>fxp0</tt>.
a219 5
<blockquote>
<tt>
# echo "pass in from 192.0.2.10 to any" | pfctl -a ssh -f -
</tt>
</blockquote>
d221 6
a226 3
<p>
So, even though the filter rule doesn't specify an interface, protocol,
or port, the host 192.0.2.10 will only be permitted to connect using 
d232 9
a240 11
<blockquote>
<tt>
allow = "{ 192.0.2.3 192.0.2.4 }" <br>
<br>
anchor "goodguys" in proto tcp { <br>
&nbsp;&nbsp;&nbsp;anchor proto tcp to port 80 { <br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;pass from 192.0.2.3 <br>
&nbsp;&nbsp;&nbsp;} <br>
&nbsp;&nbsp;&nbsp;anchor proto tcp to port 22 { <br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;pass from $allow<br>
&nbsp;&nbsp;&nbsp;} <br>
d242 3
a244 2
</tt>
</blockquote>
d246 4
a249 4
<h2 id="manip">Manipulating Anchors</h2>
Manipulation of anchors is performed via <tt>pfctl</tt>. It can
be used to add and remove rules from an anchor without reloading the
main ruleset.
a252 5
<blockquote>
<tt>
# pfctl -a ssh -s rules
</tt>
</blockquote>
d254 4
a257 1
<p>
a258 5
<blockquote>
<tt>
# pfctl -a ssh -F rules
</tt>
</blockquote>
d260 4
a263 1
<p>
d265 1
a265 2
<a href="http://man.openbsd.org/pfctl.8"
>pfctl(8)</a>.
d269 1
a269 1
</html> 
@


1.49
log
@tweak [faq index] button and sync the pf user's guide with that style.
@
text
@d4 1
a4 1
<title>PF - Anchors</title>
@


1.48
log
@use short form man links in the faq and fix a few broken links
@
text
@a29 2
<!-- Passes validator.w3.org, please keep it this way;
please, use a max of 72 chars per line -->
d35 3
a39 5
<p>
[<a href="index.html">Contents</a>]
[<a href="options.html">Previous: Runtime Options</a>]
[<a href="pools.html">Next: Address Pools and Load Balancing</a>]
<p>
a40 1
<h3>Table of Contents</h3>
d42 1
a42 1
<li><a href="#intro">Introduction</a>
d45 1
a45 1
<li><a href="#manip">Manipulating Anchors</a>
a285 5

<p>
[<a href="options.html">Previous: Runtime Options</a>]
[<a href="index.html">Contents</a>]
[<a href="pools.html">Next: Address Pools and Load Balancing</a>]
@


1.47
log
@new openbsd faq style. joint with tj and validator.w3.org
@
text
@d58 1
a58 1
<a href="http://man.openbsd.org/?query=pfctl&amp;sektion=8"
d109 1
a109 1
<a href="http://man.openbsd.org/?query=pfctl&amp;sektion=8"
d214 1
a214 1
<a href="http://man.openbsd.org/?query=pfctl&amp;sektion=8"
d289 1
a289 1
<a href="http://man.openbsd.org/?query=pfctl&amp;sektion=8"
@


1.46
log
@add a small sprinkling of css to improve readability in the faq, ok tj@@ tb@@
@
text
@d4 1
a4 1
<title>PF: Anchors</title>
d33 1
d35 4
a38 2
<img alt="[OpenBSD]" height=30 width=141 src="../../images/smalltitle.gif" border="0">
</a>
d40 1
a41 2
[<a href="index.html">Contents</a>]
<!-- [<a href="queueing.html">Next: Packet Queueing and Prioritization</a>] -->
a42 1

a43 3
<h1><font color="#e00000">PF: Anchors</font></h1>

<hr>
@


1.45
log
@fix URIs, the / before querystring is not optional,
if not fixed up by browsers the server returns 400 Bad Request.
@
text
@d7 2
@


1.44
log
@change http://www.openbsd.org/cgi-bin/man.cgi to be http://man.openbsd.org
this points stuff to the new place and gets us ready to deprecate the old
place we did this.
@
text
@d58 1
a58 1
<a href="http://man.openbsd.org?query=pfctl&amp;sektion=8"
d109 1
a109 1
<a href="http://man.openbsd.org?query=pfctl&amp;sektion=8"
d214 1
a214 1
<a href="http://man.openbsd.org?query=pfctl&amp;sektion=8"
d289 1
a289 1
<a href="http://man.openbsd.org?query=pfctl&amp;sektion=8"
@


1.43
log
@
rev for 5.8, mostly removing manpath part of man page urls
@
text
@d58 1
a58 1
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=pfctl&amp;sektion=8"
d109 1
a109 1
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=pfctl&amp;sektion=8"
d214 1
a214 1
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=pfctl&amp;sektion=8"
d289 1
a289 1
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=pfctl&amp;sektion=8"
@


1.42
log
@Clean up meta tags.

name=distribution, name=keywords, and name=resource-type have no effect
in modern search engines and just clutter up the page source.

From Pavel Plamenov.
@
text
@d58 1
a58 1
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=pfctl&amp;sektion=8&amp;manpath=OpenBSD+5.7"
d109 1
a109 1
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=pfctl&amp;sektion=8&amp;manpath=OpenBSD+5.7"
d214 1
a214 1
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=pfctl&amp;sektion=8&amp;manpath=OpenBSD+5.7"
d289 1
a289 1
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=pfctl&amp;sektion=8&amp;manpath=OpenBSD+5.7"
@


1.41
log
@Add 'link rel="canonical"' to pages, acting as a hint to search engines
to list the copies on www.openbsd.org rather than mirrors.

From Carlin Bingham, ok millert@@ nick@@
@
text
@a5 1
<meta name="resource-type" content="document">
a6 2
<meta name="keywords"      content="openbsd,faq,pf">
<meta name="distribution"  content="global">
@


1.40
log
@
updates for 5.7
@
text
@d10 1
@


1.39
log
@
5.5->5.6 which I forgot and Jonathan Thornburg (jthorn at astro dot
indiana dot edu) reminded me of, but also sent a diff for, thanks!
@
text
@d60 1
a60 1
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=pfctl&amp;sektion=8&amp;manpath=OpenBSD+5.6"
d111 1
a111 1
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=pfctl&amp;sektion=8&amp;manpath=OpenBSD+5.6"
d216 1
a216 1
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=pfctl&amp;sektion=8&amp;manpath=OpenBSD+5.6"
d291 1
a291 1
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=pfctl&amp;sektion=8&amp;manpath=OpenBSD+5.6"
@


1.38
log
@Convert the pf faq to use id="" instead of "a name=""></a>.
@
text
@d60 1
a60 1
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=pfctl&amp;sektion=8&amp;manpath=OpenBSD+5.5"
d111 1
a111 1
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=pfctl&amp;sektion=8&amp;manpath=OpenBSD+5.5"
d216 1
a216 1
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=pfctl&amp;sektion=8&amp;manpath=OpenBSD+5.5"
d291 1
a291 1
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=pfctl&amp;sektion=8&amp;manpath=OpenBSD+5.5"
@


1.37
log
@
update for 5.5
@
text
@d57 1
a57 2
<a name="intro"></a>
<h2>Introduction</h2>
d78 1
a78 2
<a name="anchors"></a>
<h2>Anchors</h2>
d219 1
a219 2
<a name="options"></a>
<h2>Anchor Options</h2>
d268 1
a268 3

<a name="manip"></a>
<h2>Manipulating Anchors</h2>
@


1.36
log
@
www@@ removal, normalize footers.
@
text
@d39 2
a40 1
[<a href="queueing.html">Next: Packet Queueing and Prioritization</a>]
d61 1
a61 1
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=pfctl&amp;sektion=8&amp;manpath=OpenBSD+5.4"
d113 1
a113 1
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=pfctl&amp;sektion=8&amp;manpath=OpenBSD+5.4"
d218 1
a218 1
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=pfctl&amp;sektion=8&amp;manpath=OpenBSD+5.4"
d296 1
a296 1
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=pfctl&amp;sektion=8&amp;manpath=OpenBSD+5.4"
d302 1
a302 1
[<a href="queueing.html">Next: Packet Queueing and Prioritization</a>]
@


1.35
log
@
update for 5.4
@
text
@a4 1
<link rev="made" href="mailto:www@@openbsd.org">
a303 6
<hr>
<a href="index.html"><img height="24" width="24" src="../../images/back.gif" border="0" alt="[back]"></a> 
<a href="mailto:www@@openbsd.org">www@@openbsd.org</a>
<br>
<small>$OpenBSD: anchors.html,v 1.34 2013/05/01 13:21:45 nick Exp $</small>

@


1.34
log
@
updates for 5.3
@
text
@d61 1
a61 1
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=pfctl&amp;sektion=8&amp;manpath=OpenBSD+5.3"
d113 1
a113 1
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=pfctl&amp;sektion=8&amp;manpath=OpenBSD+5.3"
d218 1
a218 1
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=pfctl&amp;sektion=8&amp;manpath=OpenBSD+5.3"
d296 1
a296 1
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=pfctl&amp;sektion=8&amp;manpath=OpenBSD+5.3"
d309 1
a309 1
<small>$OpenBSD: anchors.html,v 1.33 2012/11/01 15:06:36 nick Exp $</small>
@


1.33
log
@
enter 5.2
@
text
@d61 1
a61 1
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=pfctl&amp;sektion=8&amp;manpath=OpenBSD+5.2"
d113 1
a113 1
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=pfctl&amp;sektion=8&amp;manpath=OpenBSD+5.2"
d218 1
a218 1
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=pfctl&amp;sektion=8&amp;manpath=OpenBSD+5.2"
d296 1
a296 1
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=pfctl&amp;sektion=8&amp;manpath=OpenBSD+5.2"
d309 1
a309 1
<small>$OpenBSD: anchors.html,v 1.32 2012/05/11 11:20:04 nick Exp $</small>
@


1.32
log
@
forgot to actually COMMIT these 5.1 changes.  *sigh*
@
text
@d61 1
a61 1
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=pfctl&amp;sektion=8&amp;manpath=OpenBSD+5.1"
d113 1
a113 1
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=pfctl&amp;sektion=8&amp;manpath=OpenBSD+5.1"
d218 1
a218 1
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=pfctl&amp;sektion=8&amp;manpath=OpenBSD+5.1"
d296 1
a296 1
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=pfctl&amp;sektion=8&amp;manpath=OpenBSD+5.1"
d309 1
a309 1
<small>$OpenBSD: anchors.html,v 1.31 2011/11/02 01:01:47 nick Exp $</small>
@


1.31
log
@
rev man page references to 5.0
@
text
@d61 1
a61 1
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=pfctl&amp;sektion=8&amp;manpath=OpenBSD+5.0"
d113 1
a113 1
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=pfctl&amp;sektion=8&amp;manpath=OpenBSD+5.0"
d218 1
a218 1
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=pfctl&amp;sektion=8&amp;manpath=OpenBSD+5.0"
d296 1
a296 1
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=pfctl&amp;sektion=8&amp;manpath=OpenBSD+5.0"
d309 1
a309 1
<small>$OpenBSD: anchors.html,v 1.30 2011/05/01 12:57:11 nick Exp $</small>
@


1.30
log
@
updates for 4.9
@
text
@d61 1
a61 1
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=pfctl&amp;sektion=8&amp;manpath=OpenBSD+4.9"
d113 1
a113 1
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=pfctl&amp;sektion=8&amp;manpath=OpenBSD+4.9"
d218 1
a218 1
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=pfctl&amp;sektion=8&amp;manpath=OpenBSD+4.9"
d296 1
a296 1
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=pfctl&amp;sektion=8&amp;manpath=OpenBSD+4.9"
d309 1
a309 1
<small>$OpenBSD: anchors.html,v 1.29 2010/11/01 09:53:51 nick Exp $</small>
@


1.29
log
@
update to 4.8
@
text
@d61 1
a61 1
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=pfctl&amp;sektion=8&amp;manpath=OpenBSD+4.8"
d113 1
a113 1
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=pfctl&amp;sektion=8&amp;manpath=OpenBSD+4.8"
d218 1
a218 1
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=pfctl&amp;sektion=8&amp;manpath=OpenBSD+4.8"
d296 1
a296 1
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=pfctl&amp;sektion=8&amp;manpath=OpenBSD+4.8"
d309 1
a309 1
<small>$OpenBSD: anchors.html,v 1.28 2010/05/19 13:25:16 sthen Exp $</small>
@


1.28
log
@Update the PF faq for 4.7 changes.
@
text
@d61 1
a61 1
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=pfctl&amp;sektion=8&amp;manpath=OpenBSD+4.7"
d113 1
a113 1
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=pfctl&amp;sektion=8&amp;manpath=OpenBSD+4.7"
d218 1
a218 1
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=pfctl&amp;sektion=8&amp;manpath=OpenBSD+4.7"
d296 1
a296 1
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=pfctl&amp;sektion=8&amp;manpath=OpenBSD+4.7"
d309 1
a309 1
<small>$OpenBSD: anchors.html,v 1.27 2009/10/16 19:12:42 nick Exp $</small>
@


1.27
log
@
quick update for 4.6.  much more is needed, at least scrub.html is
currently dead wrong, so I've unlinked it from the rest for now.
@
text
@d61 1
a61 1
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=pfctl&amp;sektion=8&amp;manpath=OpenBSD+4.6"
d63 4
a66 4
altering an active ruleset. Whereas a <a href="tables.html">table</a> 
is used to hold a dynamic list of addresses, a sub ruleset is used to
hold a dynamic set of filter, <tt>nat</tt>, <tt>rdr</tt>, and
<tt>binat</tt> rules.
a68 14
Sub rulesets are attached to the main ruleset by using anchors.  There
are four types of <tt>anchor</tt> rules:
<ul>
<li><tt>anchor <i>name</i></tt> - evaluates all <a href="filter.html">
filter</a> rules in the anchor <i><tt>name</tt></i>
<li><tt>binat-anchor <i>name</i></tt> - evaluates all 
<a href="nat.html#binat"><tt>binat</tt></a> rules in the
anchor <i><tt>name</tt></i>
<li><tt>nat-anchor <i>name</i></tt> - evaluates all <a href="nat.html">
<tt>nat</tt></a> rules in the anchor <i><tt>name</tt></i>
<li><tt>rdr-anchor <i>name</i></tt> - evaluates all <a href="rdr.html">
<tt>rdr</tt></a> rules in the anchor <i><tt>name</tt></i>
</ul>

d81 2
a82 2
An anchor is a collection of filter and/or translation rules, tables,
and other anchors that has been assigned a name.
d87 4
a90 4
matches a filter rule that uses the <tt>quick</tt> option or a
translation rule within the anchor in which case the match will be
considered final and will abort the evaluation of rules in both the
anchor and the main rulesets.
d98 2
a99 2
block on $ext_if all<br>
pass &nbsp;out on $ext_if all keep state<br>
d105 5
a109 4
This ruleset sets a default deny policy on <tt>fxp0</tt> for both incoming and
outgoing traffic. Traffic is then statefully passed out and an anchor
rule is created named <tt>goodguys</tt>. Anchors can be populated
with rules by three methods: 
d113 1
a113 1
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=pfctl&amp;sektion=8&amp;manpath=OpenBSD+4.6"
d186 2
a187 2
Filter and translation rules can be loaded into an anchor using
the same syntax and options as rules loaded into the main ruleset.
d218 1
a218 1
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=pfctl&amp;sektion=8&amp;manpath=OpenBSD+4.6"
d224 1
a224 1
source and destination address, tag, etc., using the same syntax as filter
d232 3
a234 3
block on $ext_if all<br>
pass &nbsp;out on $ext_if all keep state<br>
anchor ssh in on $ext_if proto tcp from any to any port 22<br>
d240 2
a241 2
packets destined for port 22 that come in on <tt>fxp0</tt>. Rules are then added
to the <tt>anchor</tt> like so:
d287 1
a287 1
To flush all filter rules from the same anchor:
d296 1
a296 1
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=pfctl&amp;sektion=8&amp;manpath=OpenBSD+4.6"
d309 1
a309 1
<small>$OpenBSD: anchors.html,v 1.26 2009/04/30 17:27:31 nick Exp $</small>
@


1.26
log
@
updates for 4.5
@
text
@d38 1
a38 1
[<a href="scrub.html">Previous: Scrub (Packet Normalization)</a>]
d61 1
a61 1
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=pfctl&amp;sektion=8&amp;manpath=OpenBSD+4.5"
d126 1
a126 1
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=pfctl&amp;sektion=8&amp;manpath=OpenBSD+4.5"
d231 1
a231 1
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=pfctl&amp;sektion=8&amp;manpath=OpenBSD+4.5"
d309 1
a309 1
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=pfctl&amp;sektion=8&amp;manpath=OpenBSD+4.5"
d313 1
a313 1
[<a href="scrub.html">Previous: Scrub (Packet Normalization)</a>]
d322 1
a322 1
<small>$OpenBSD: anchors.html,v 1.25 2008/10/31 16:49:34 nick Exp $</small>
@


1.25
log
@
update numbers for 4.4
@
text
@d61 1
a61 1
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=pfctl&amp;sektion=8&amp;manpath=OpenBSD+4.4"
d126 1
a126 1
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=pfctl&amp;sektion=8&amp;manpath=OpenBSD+4.4"
d231 1
a231 1
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=pfctl&amp;sektion=8&amp;manpath=OpenBSD+4.4"
d309 1
a309 1
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=pfctl&amp;sektion=8&amp;manpath=OpenBSD+4.4"
d322 1
a322 1
<small>$OpenBSD: anchors.html,v 1.24 2008/07/27 17:13:47 nick Exp $</small>
@


1.24
log
@
PF updates for 4.3..which got missed a few times.
@
text
@d61 1
a61 1
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=pfctl&amp;sektion=8&amp;manpath=OpenBSD+4.3"
d126 1
a126 1
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=pfctl&amp;sektion=8&amp;manpath=OpenBSD+4.3"
d231 1
a231 1
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=pfctl&amp;sektion=8&amp;manpath=OpenBSD+4.3"
d309 1
a309 1
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=pfctl&amp;sektion=8&amp;manpath=OpenBSD+4.3"
d322 1
a322 1
<small>$OpenBSD: anchors.html,v 1.23 2007/11/01 02:57:56 joel Exp $</small>
@


1.23
log
@Updates for OpenBSD 4.2
@
text
@d61 1
a61 1
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=pfctl&amp;sektion=8&amp;manpath=OpenBSD+4.2"
d126 1
a126 1
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=pfctl&amp;sektion=8&amp;manpath=OpenBSD+4.2"
d231 1
a231 1
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=pfctl&amp;sektion=8&amp;manpath=OpenBSD+4.2"
d309 1
a309 1
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=pfctl&amp;sektion=8&amp;manpath=OpenBSD+4.2"
d322 1
a322 1
<small>$OpenBSD: anchors.html,v 1.22 2007/05/07 01:13:53 joel Exp $</small>
@


1.22
log
@Updates for OpenBSD 4.1
@
text
@d61 1
a61 1
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=pfctl&amp;sektion=8&amp;manpath=OpenBSD+4.1"
d126 1
a126 1
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=pfctl&amp;sektion=8&amp;manpath=OpenBSD+4.1"
d231 1
a231 1
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=pfctl&amp;sektion=8&amp;manpath=OpenBSD+4.1"
d309 1
a309 1
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=pfctl&amp;sektion=8&amp;manpath=OpenBSD+4.1"
d322 1
a322 1
<small>$OpenBSD: anchors.html,v 1.21 2007/05/06 18:59:54 nick Exp $</small>
@


1.21
log
@
manpath changes to:
  4.1 for PF related items
  removed for non-PF-related items, which will probably either not
    change much, or benefit from the newest, best man pages.
@
text
@d14 1
a14 1
Copyright (c) 2003-2005 Joel Knight <enabled@@myrealbox.com>
d122 1
a122 1
with rules by two methods: 
d128 1
d166 33
d201 1
a201 1
One caveat, however, is that any 
d266 19
d322 1
a322 1
<small>$OpenBSD: anchors.html,v 1.20 2006/11/01 01:56:01 joel Exp $</small>
@


1.20
log
@Updates for OpenBSD 4.0. uRPF, tftp-proxy, more ftp-proxy, etc.
Thanks to mcbride for the bits about interface groups
@
text
@d61 1
a61 1
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=pfctl&amp;sektion=8&amp;manpath=OpenBSD+4.0"
d126 1
a126 1
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=pfctl&amp;sektion=8&amp;manpath=OpenBSD+4.0"
d197 1
a197 1
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=pfctl&amp;sektion=8&amp;manpath=OpenBSD+4.0"
d256 1
a256 1
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=pfctl&amp;sektion=8&amp;manpath=OpenBSD+4.0"
d269 1
a269 1
<small>$OpenBSD: anchors.html,v 1.19 2006/05/01 00:54:29 nick Exp $</small>
@


1.19
log
@
3.9 updates, mostly rev'ing man page links
@
text
@d61 1
a61 1
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=pfctl&amp;sektion=8&amp;manpath=OpenBSD+3.9"
d126 1
a126 1
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=pfctl&amp;sektion=8&amp;manpath=OpenBSD+3.9"
d197 1
a197 1
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=pfctl&amp;sektion=8&amp;manpath=OpenBSD+3.9"
d256 1
a256 1
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=pfctl&amp;sektion=8&amp;manpath=OpenBSD+3.9"
d269 1
a269 1
<small>$OpenBSD: anchors.html,v 1.18 2005/11/01 11:35:18 nick Exp $</small>
@


1.18
log
@
bump manpath= tag for 3.8
@
text
@d61 1
a61 1
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=pfctl&amp;sektion=8&amp;manpath=OpenBSD+3.8"
d126 1
a126 1
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=pfctl&amp;sektion=8&amp;manpath=OpenBSD+3.8"
d197 1
a197 1
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=pfctl&amp;sektion=8&amp;manpath=OpenBSD+3.8"
d256 1
a256 1
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=pfctl&amp;sektion=8&amp;manpath=OpenBSD+3.8"
d269 1
a269 1
<small>$OpenBSD: anchors.html,v 1.17 2005/05/20 00:12:02 joel Exp $</small>
@


1.17
log
@Updates for OpenBSD 3.7.
@
text
@d61 1
a61 1
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=pfctl&amp;sektion=8&amp;manpath=OpenBSD+3.7"
d126 1
a126 1
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=pfctl&amp;sektion=8&amp;manpath=OpenBSD+3.7"
d197 1
a197 1
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=pfctl&amp;sektion=8&amp;manpath=OpenBSD+3.7"
d256 1
a256 1
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=pfctl&amp;sektion=8&amp;manpath=OpenBSD+3.7"
d269 1
a269 1
<small>$OpenBSD: anchors.html,v 1.16 2005/02/07 05:43:24 joel Exp $</small>
@


1.16
log
@- eliminate all remaining references to named rulesets
- fix pf.conf and pfctl syntax so they're not using named ruleset syntax
- mention that anchors can be nested
- adjust copyright date

ok nick@@
@
text
@d61 1
a61 1
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=pfctl&amp;sektion=8&amp;manpath=OpenBSD+3.6"
d126 1
a126 1
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=pfctl&amp;sektion=8&amp;manpath=OpenBSD+3.6"
d197 1
a197 1
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=pfctl&amp;sektion=8&amp;manpath=OpenBSD+3.6"
d256 1
a256 1
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=pfctl&amp;sektion=8&amp;manpath=OpenBSD+3.6"
d269 1
a269 1
<small>$OpenBSD: anchors.html,v 1.15 2004/12/22 04:28:16 david Exp $</small>
@


1.15
log
@make small title logo a link back to main page; ok nick@@
@
text
@d4 1
a4 1
<title>PF: Anchors and Named Rulesets</title>
d14 1
a14 1
Copyright (c) 2003, 2004 Joel Knight <enabled@@myrealbox.com>
d43 1
a43 1
<h1><font color="#e00000">PF: Anchors and Named Rulesets</font></h1>
d50 1
a50 1
<li><a href="#named">Named Rulesets</a>
d83 8
a90 6
<tt>anchor</tt> rules will be evaluated relative to the anchor in which
they are loaded. For example, <tt>anchor</tt> rules in the main ruleset
will create anchor attachment points with the main ruleset as their
parent, and <tt>anchor</tt> rules loaded from files with the
<tt>load anchor</tt> directive will create anchor points with that
anchor as their parent.
d93 1
d99 1
a99 1
<tt>anchor</tt> point as it evaluates rules in the main ruleset.
d132 3
a134 2
specified anchor and named ruleset by reading rules from a text
file. Example:
d137 2
a138 1
load anchor goodguys:ssh from "/etc/anchor-goodguys-ssh"
a142 5
When the main ruleset is loaded, the rules listed in the file
<tt>/etc/anchor-goodguys-ssh</tt> will be loaded into the named ruleset
<tt>ssh</tt> attached to the <tt>goodguys</tt> anchor.

<p>
d148 1
a148 1
&nbsp;&nbsp;&nbsp;| pfctl -a goodguys/ssh -f -
a152 6
This adds a <tt>pass</tt> rule to the anchor named <tt>ssh</tt>
attached to the <tt>goodguys</tt> anchor. PF will then evaluate
this rule (and any other filter rules that get added) when it reaches
the <tt>anchor "goodguys/*"</tt> line in the main ruleset.

<p>
d160 1
a160 1
# pfctl -a goodguys:www -f /etc/anchor-goodguys-www<br>
d165 1
a165 5
This loads the rules from the <tt>/etc/anchor-goodguys-www</tt> file
into the named ruleset <tt>www</tt> in the <tt>goodguys</tt> anchor.

<p>
Filter and translation rules can be loaded into a named ruleset using
d169 20
a188 2
within the named ruleset; macros that are defined in the main ruleset
are <i>not</i> visible from named rulesets.
d191 1
a191 1
Each named ruleset, as well as the main ruleset, exist separately from
d194 2
a195 2
point from the main ruleset does not destroy the anchor or any named
rulesets that are attached to that anchor. A named ruleset is not
d198 1
a198 2
>pfctl(8)</a>. Once an anchor point has no named rulesets attached to
it, it's also destroyed.
d223 1
a223 1
# echo "pass in from 192.0.2.10 to any" | pfctl -a ssh/allowed -f -
d239 1
a239 2
To list all the rules in the anchor named <tt>allowed</tt> attached
to the <tt>ssh</tt> anchor:
d242 1
a242 1
# pfctl -a ssh/allowed -s rules
d250 1
a250 1
# pfctl -a ssh/allowed -F rules
d269 1
a269 1
<small>$OpenBSD: anchors.html,v 1.14 2004/11/01 21:41:07 nick Exp $</small>
@


1.14
log
@
3.6 content upgrades.  Directly from Joel Knight, jaredy@@ did the
anchors and nested anchors work, rest is by Joel.
@
text
@d34 3
a36 1
<img alt="[OpenBSD]" height=30 width=141 src="../../images/smalltitle.gif">
d263 1
a263 1
<small>$OpenBSD: anchors.html,v 1.13 2004/10/29 17:22:57 nick Exp $</small>
@


1.13
log
@
Update for 3.6
@
text
@d50 1
a50 1
<li><a href="#manip">Manipulating Named Rulesets</a>
d81 6
a86 1
Only the main ruleset can contain <tt>anchor</tt> rules.
d89 6
a94 6
<h2>Named Rulesets</h2>
A named ruleset is a group of filter and/or translation rules that has
been assigned a name. An <tt>anchor</tt> point may contain more than one 
such ruleset. When PF comes across an <tt>anchor</tt> rule in the main
ruleset, it will evaluate all the rulesets attached to that
<tt>anchor</tt> point in alphabetical order according to their names.
d146 1
a146 1
&nbsp;&nbsp;&nbsp;| pfctl -a goodguys:ssh -f -
d151 1
a151 1
This adds a <tt>pass</tt> rule to the ruleset named <tt>ssh</tt>
d154 1
a154 1
the <tt>anchor goodguys</tt> line in the main ruleset.
d214 1
a214 1
# echo "pass in from 192.0.2.10 to any" | pfctl -a ssh:allowed -f -
d224 3
a226 3
<h2>Manipulating Named Rulesets</h2>
Manipulation of named rulesets is performed via <tt>pfctl</tt>. It can
be used to add and remove rules from a ruleset without reloading the
d230 1
a230 1
To list all the rules in the ruleset <tt>allowed</tt> attached
d234 1
a234 1
# pfctl -a ssh:allowed -s rules
d239 1
a239 1
To flush all filter rules from the same ruleset: 
d242 1
a242 1
# pfctl -a ssh:allowed -F rules
a246 4
If the ruleset name is omitted, the action applies to all rules in the
anchor.

<p>
d261 1
a261 1
<small>$OpenBSD: anchors.html,v 1.12 2004/05/07 01:55:23 nick Exp $</small>
@


1.12
log
@
Add an OpenBSD license to the PF User's Guide.
Concept and breakdown of copyrights agreed to by Joel Knight and myself,
license assistance millert@@, ok deraadt@@.
@
text
@d59 1
a59 1
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=pfctl&amp;sektion=8&amp;manpath=OpenBSD+3.5"
d116 1
a116 1
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=pfctl&amp;sektion=8&amp;manpath=OpenBSD+3.5"
d182 1
a182 1
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=pfctl&amp;sektion=8&amp;manpath=OpenBSD+3.5"
d247 1
a247 1
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=pfctl&amp;sektion=8&amp;manpath=OpenBSD+3.5"
d260 1
a260 1
<small>$OpenBSD: anchors.html,v 1.11 2004/04/30 18:00:25 nick Exp $</small>
@


1.11
log
@
PF User's Guide updates for OpenBSD 3.5.
Work done by Joel Knight (enabled et myrealbox.dit com), many, many thanks
to him for providing and maintaining some darned good docs.
@
text
@a10 1
<meta name="copyright"     content="This document copyright 2003-2004 by OpenBSD.">
d13 17
d260 1
a260 1
<small>$OpenBSD: anchors.html,v 1.10 2004/01/01 04:16:17 nick Exp $</small>
@


1.10
log
@
Bump copyright to 2004
@
text
@d43 1
a43 1
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=pfctl&amp;sektion=8&amp;manpath=OpenBSD+3.4"
d100 1
a100 1
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=pfctl&amp;sektion=8&amp;manpath=OpenBSD+3.4"
d166 1
a166 1
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=pfctl&amp;sektion=8&amp;manpath=OpenBSD+3.4"
d173 1
a173 1
source and destination address, etc., using the same syntax as filter
d231 1
a231 1
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=pfctl&amp;sektion=8&amp;manpath=OpenBSD+3.4"
d244 1
a244 1
<small>$OpenBSD: anchors.html,v 1.9 2003/11/27 15:08:25 nick Exp $</small>
@


1.9
log
@
Major update to the PF FAQ from "Mr. PF FAQ", Joel Knight.  THANKS!
@
text
@d11 1
a11 1
<meta name="copyright"     content="This document copyright 2003 by OpenBSD.">
d244 1
a244 1
<small>$OpenBSD: anchors.html,v 1.8 2003/11/09 23:29:02 nick Exp $</small>
@


1.8
log
@
Update of PF User's Guide to 3.4.  Ok, really just pointing the man page
links at the 3.4-release man pages rather than the 3.3-release man pages.
Work by Joel Knight.
@
text
@d20 1
a20 1
[<a href="logging.html">Previous: Logging</a>]
d22 1
a22 1
[<a href="shortcuts.html">Next: Shortcuts For Creating Rulesets</a>]
d44 1
a44 1
><tt>pfctl(8)</tt></a>, they provide a convenient way of dynamically
d93 1
a93 1
This ruleset sets a default deny policy on fxp0 for both incoming and
d95 27
a121 2
rule is created named <tt><i>goodguys</i></tt>. To add rules to the
<tt><i>goodguys</i></tt> anchor the following commands can be used:
d130 2
a131 2
This adds a <tt>pass</tt> rule to the ruleset named <tt><i>ssh</i></tt>
attached to the <tt><i>goodguys</i></tt> anchor. PF will then evaluate
d149 1
a149 2
into the named ruleset <tt><i>www</i></tt> in the
<tt><i>goodguys</i></tt> anchor.
d188 2
a189 2
The rules in the anchor <tt><i>ssh</i></tt> are only evaluated for TCP
packets destined for port 22 that come in on fxp0. Rules are then added
d209 2
a210 2
To list all the rules in the ruleset <tt><i>allowed</i></tt> attached
to the <tt><i>ssh</i></tt> anchor:
d232 1
a232 1
><tt>pfctl(8)</tt></a>.
d235 1
a235 1
[<a href="logging.html">Previous: Logging</a>]
d237 1
a237 1
[<a href="shortcuts.html">Next: Shortcuts For Creating Rulesets</a>]
d244 1
a244 1
<small>$OpenBSD: anchors.html,v 1.7 2003/09/22 02:29:03 nick Exp $</small>
@


1.7
log
@
From Joel Knight: changes formatting so that all keywords are
in <i>, all literals are in <tt>, etc.  Excess man page links removed.
No words were changed.
@
text
@d43 1
a43 1
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=pfctl&amp;sektion=8&amp;manpath=OpenBSD+3.3"
d142 1
a142 1
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=pfctl&amp;sektion=8&amp;manpath=OpenBSD+3.3"
d207 1
a207 1
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=pfctl&amp;sektion=8&amp;manpath=OpenBSD+3.3"
d220 1
a220 1
<small>$OpenBSD: anchors.html,v 1.6 2003/09/16 01:23:49 nick Exp $</small>
@


1.6
log
@
Grammar and punctuation clean up, from Joel Knight.
Only a very few words changed.
@
text
@d87 1
a87 1
pass  out on $ext_if all keep state<br>
d158 1
a158 1
pass  out on $ext_if all keep state<br>
d164 1
a164 1
The rules in the <tt>anchor <i>ssh</i></tt> are only evaluated for TCP
d186 1
a186 1
to the <tt><i>ssh</i></tt> <tt>anchor</tt>:
d220 1
a220 1
<small>$OpenBSD: anchors.html,v 1.5 2003/06/23 01:51:36 nick Exp $</small>
@


1.5
log
@
A couple important points.  From Joel Knight.
@
text
@d149 1
a149 1
source and destination address, etc using the same syntax as filter
d206 1
a206 1
For a full list of commands please see
d220 1
a220 1
<small>$OpenBSD: anchors.html,v 1.4 2003/06/13 02:54:08 nick Exp $</small>
@


1.4
log
@
Improved wrapping of man page links, renders better on some browsers.
No words altered.  From Joel Knight.
@
text
@d127 19
d220 1
a220 1
<small>$OpenBSD: anchors.html,v 1.3 2003/05/15 03:03:54 nick Exp $</small>
@


1.3
log
@
Table of Contents now on each page.  Work by Joel Knight (yay! Joel! 8-).
@
text
@d43 2
a44 2
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=pfctl&amp;sektion=8&amp;manpath=OpenBSD+3.3">
<tt>pfctl(8)</tt></a>, they provide a convenient way of dynamically
d188 2
a189 2
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=pfctl&amp;sektion=8&amp;manpath=OpenBSD+3.3">
<tt>pfctl(8)</tt></a>.
d201 1
a201 1
<small>$OpenBSD: anchors.html,v 1.2 2003/05/01 14:20:37 nick Exp $</small>
@


1.2
log
@
ARGH!  no, it is "ruleset", not "rule set".  Pointed out by Margarida@@
@
text
@d29 12
a40 1
<p>
d201 1
a201 1
<small>$OpenBSD: anchors.html,v 1.1 2003/05/01 01:46:06 nick Exp $</small>
@


1.1
log
@
The long awaited, new PF FAQ!
Most of it written by Joel Knight >enabled at myrealbox dot com<,
some parts by me, a few parts yanked out of the old PF FAQ.
GREAT work, Joel!
@
text
@d4 1
a4 1
<title>PF: Anchors and Named Rule Sets</title>
d22 1
a22 1
[<a href="shortcuts.html">Next: Shortcuts For Creating Rule Sets</a>]
d25 1
a25 1
<h1><font color="#e00000">PF: Anchors and Named Rule Sets</font></h1>
d30 2
a31 2
In addition to the main rule set, PF can also evaluate sub rule sets.
Since sub rule sets can be manipulated on the fly by using 
d34 2
a35 2
altering an active rule set. Whereas a <a href="tables.html">table</a> 
is used to hold a dynamic list of addresses, a sub rule set is used to
d40 1
a40 1
Sub rule sets are attached to the main rule set by using anchors.  There
d54 1
a54 1
Only the main rule set can contain <tt>anchor</tt> rules.
d57 2
a58 2
<h2>Named Rule Sets</h2>
A named rule set is a group of filter and/or translation rules that has
d60 2
a61 2
such rule set. When PF comes across an <tt>anchor</tt> rule in the main
rule set, it will evaluate all the rule sets attached to that
d63 1
a63 1
Processing will then continue in the main rule set unless the packet
d67 1
a67 1
anchor and the main rule sets.
d82 1
a82 1
This rule set sets a default deny policy on fxp0 for both incoming and
d94 1
a94 1
This adds a <tt>pass</tt> rule to the rule set named <tt><i>ssh</i></tt>
d97 1
a97 1
the <tt>anchor goodguys</tt> line in the main rule set.
d113 1
a113 1
into the named rule set <tt><i>www</i></tt> in the
d149 4
a152 4
<h2>Manipulating Named Rule Sets</h2>
Manipulation of named rule sets is performed via <tt>pfctl</tt>. It can
be used to add and remove rules from a rule set without reloading the
main rule set.
d155 1
a155 1
To list all the rules in the rule set <tt><i>allowed</i></tt> attached
d164 1
a164 1
To flush all filter rules from the same rule set: 
d172 1
a172 1
If the rule set name is omitted, the action applies to all rules in the
d183 1
a183 1
[<a href="shortcuts.html">Next: Shortcuts For Creating Rule Sets</a>]
d190 1
a190 1
<small>$OpenBSD$</small>
@

