head	1.62;
access;
symbols;
locks; strict;
comment	@# @;


1.62
date	2017.06.26.17.18.58;	author tb;	state Exp;
branches;
next	1.61;
commitid	jKVBuSx5No9bUpg1;

1.61
date	2017.06.20.10.10.42;	author tb;	state Exp;
branches;
next	1.60;
commitid	VuInGzPSLTmz2B1C;

1.60
date	2017.01.15.11.33.04;	author tb;	state Exp;
branches;
next	1.59;
commitid	Lf9DlDlFvcmcsmNT;

1.59
date	2016.09.19.23.44.47;	author tj;	state Exp;
branches;
next	1.58;
commitid	P53AgOpLKrOmgs5r;

1.58
date	2016.08.15.02.22.14;	author tb;	state Exp;
branches;
next	1.57;
commitid	3DeixV5YkPOb78RN;

1.57
date	2016.06.13.17.58.25;	author tj;	state Exp;
branches;
next	1.56;
commitid	Grx2UyJPWzJbbhkP;

1.56
date	2016.04.18.19.07.50;	author tj;	state Exp;
branches;
next	1.55;
commitid	g0cUF3jNn5Tz4oaZ;

1.55
date	2016.04.16.00.30.41;	author tj;	state Exp;
branches;
next	1.54;
commitid	rTxoenHHaeutOff1;

1.54
date	2016.04.15.21.53.42;	author schwarze;	state Exp;
branches;
next	1.53;
commitid	YZv8S2kLQbFQZcyu;

1.53
date	2016.04.15.20.39.49;	author tb;	state Exp;
branches;
next	1.52;
commitid	jwteSMEb4rFzI8UA;

1.52
date	2016.03.29.01.27.39;	author tb;	state Exp;
branches;
next	1.51;
commitid	4Y8oU6GBrSY1UOfW;

1.51
date	2016.03.27.19.52.09;	author sthen;	state Exp;
branches;
next	1.50;
commitid	hi2ObFv9LGB98JY5;

1.50
date	2016.03.22.10.56.56;	author sthen;	state Exp;
branches;
next	1.49;
commitid	G2izHhNJ7aqR0Y6j;

1.49
date	2016.03.21.05.46.21;	author beck;	state Exp;
branches;
next	1.48;
commitid	zEx6zFkNSFFExu0v;

1.48
date	2015.10.18.19.48.19;	author nick;	state Exp;
branches;
next	1.47;
commitid	gkrFWKimwWNVivXe;

1.47
date	2015.07.02.05.49.05;	author bentley;	state Exp;
branches;
next	1.46;
commitid	AP3UllesavMDEUhQ;

1.46
date	2015.05.11.11.18.30;	author sthen;	state Exp;
branches;
next	1.45;
commitid	wRrXxcro6dFYiwF8;

1.45
date	2015.04.30.23.48.01;	author nick;	state Exp;
branches;
next	1.44;
commitid	uFWv68UTtTmjkqVF;

1.44
date	2014.12.02.03.17.26;	author nick;	state Exp;
branches;
next	1.43;
commitid	RQ0cKiFD5x45dGyo;

1.43
date	2014.12.01.10.01.07;	author bentley;	state Exp;
branches;
next	1.42;
commitid	DtrOVs7q8kqgEsjm;

1.42
date	2014.06.24.13.42.23;	author sthen;	state Exp;
branches;
next	1.41;
commitid	lNk1kOIOTb9J7iWf;

1.41
date	2014.05.01.15.03.50;	author nick;	state Exp;
branches;
next	1.40;

1.40
date	2014.03.31.02.33.07;	author nick;	state Exp;
branches;
next	1.39;

1.39
date	2013.11.01.14.07.06;	author nick;	state Exp;
branches;
next	1.38;

1.38
date	2013.05.01.13.21.45;	author nick;	state Exp;
branches;
next	1.37;

1.37
date	2012.11.01.15.06.36;	author nick;	state Exp;
branches;
next	1.36;

1.36
date	2012.05.11.11.20.04;	author nick;	state Exp;
branches;
next	1.35;

1.35
date	2011.11.02.01.01.47;	author nick;	state Exp;
branches;
next	1.34;

1.34
date	2011.11.01.13.24.27;	author sthen;	state Exp;
branches;
next	1.33;

1.33
date	2011.05.01.12.57.11;	author nick;	state Exp;
branches;
next	1.32;

1.32
date	2010.11.01.09.53.51;	author nick;	state Exp;
branches;
next	1.31;

1.31
date	2010.05.24.12.13.41;	author sthen;	state Exp;
branches;
next	1.30;

1.30
date	2010.05.19.13.25.16;	author sthen;	state Exp;
branches;
next	1.29;

1.29
date	2009.10.16.19.12.42;	author nick;	state Exp;
branches;
next	1.28;

1.28
date	2009.04.30.17.27.31;	author nick;	state Exp;
branches;
next	1.27;

1.27
date	2008.10.31.16.49.34;	author nick;	state Exp;
branches;
next	1.26;

1.26
date	2008.07.27.17.13.47;	author nick;	state Exp;
branches;
next	1.25;

1.25
date	2007.11.01.02.57.56;	author joel;	state Exp;
branches;
next	1.24;

1.24
date	2007.05.06.18.59.54;	author nick;	state Exp;
branches;
next	1.23;

1.23
date	2006.11.01.01.56.01;	author joel;	state Exp;
branches;
next	1.22;

1.22
date	2006.05.11.01.18.23;	author nick;	state Exp;
branches;
next	1.21;

1.21
date	2006.05.02.12.17.07;	author steven;	state Exp;
branches;
next	1.20;

1.20
date	2006.05.01.00.52.07;	author nick;	state Exp;
branches;
next	1.19;

1.19
date	2005.11.01.11.35.18;	author nick;	state Exp;
branches;
next	1.18;

1.18
date	2005.05.20.00.12.02;	author joel;	state Exp;
branches;
next	1.17;

1.17
date	2004.12.22.04.28.16;	author david;	state Exp;
branches;
next	1.16;

1.16
date	2004.11.01.21.41.07;	author nick;	state Exp;
branches;
next	1.15;

1.15
date	2004.10.29.17.22.57;	author nick;	state Exp;
branches;
next	1.14;

1.14
date	2004.05.07.01.55.23;	author nick;	state Exp;
branches;
next	1.13;

1.13
date	2004.04.30.18.00.25;	author nick;	state Exp;
branches;
next	1.12;

1.12
date	2004.01.08.01.03.48;	author nick;	state Exp;
branches;
next	1.11;

1.11
date	2004.01.01.04.16.17;	author nick;	state Exp;
branches;
next	1.10;

1.10
date	2003.11.27.15.08.25;	author nick;	state Exp;
branches;
next	1.9;

1.9
date	2003.11.09.23.29.02;	author nick;	state Exp;
branches;
next	1.8;

1.8
date	2003.09.16.01.23.49;	author nick;	state Exp;
branches;
next	1.7;

1.7
date	2003.06.29.20.28.24;	author nick;	state Exp;
branches;
next	1.6;

1.6
date	2003.06.13.02.54.08;	author nick;	state Exp;
branches;
next	1.5;

1.5
date	2003.05.16.22.05.46;	author nick;	state Exp;
branches;
next	1.4;

1.4
date	2003.05.15.03.03.54;	author nick;	state Exp;
branches;
next	1.3;

1.3
date	2003.05.12.04.20.06;	author nick;	state Exp;
branches;
next	1.2;

1.2
date	2003.05.09.02.36.09;	author nick;	state Exp;
branches;
next	1.1;

1.1
date	2003.05.01.01.46.06;	author nick;	state Exp;
branches;
next	;


desc
@@


1.62
log
@move man.openbsd.org links from http:// to https://
reduces the number of http:// links in www/ from >33k to <7k

thanks to schwarze for doing the work
@
text
@<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<html>
<head>

<!-- If you make edits to any FAQ documents, please start each sentence
     on a new line, and try to keep the general formatting consistent
     with the rest of the pages -->

<title>OpenBSD PF: Issues with FTP</title>
<meta http-equiv="Content-Type" content="text/html; charset=ISO-8859-1">
<meta name="viewport" content="width=device-width, initial-scale=1">
<link rel="stylesheet" type="text/css" href="../../openbsd.css">
<link rel="canonical" href="https://www.openbsd.org/faq/pf/ftp.html">
</head>

<!--
Copyright (c) 2003, Nick Holland <nick@@openbsd.org>
Copyright (c) 2003, 2004, Joel Knight <enabled@@myrealbox.com>

Permission to use, copy, modify, and distribute this documentation for
any purpose with or without fee is hereby granted, provided that the
above copyright notice and this permission notice appear in all copies.

THE DOCUMENTATION IS PROVIDED "AS IS" AND THE AUTHOR DISCLAIMS ALL
WARRANTIES WITH REGARD TO THIS DOCUMENTATION INCLUDING ALL IMPLIED
WARRANTIES OF MERCHANTABILITY AND FITNESS. IN NO EVENT SHALL THE
AUTHOR BE LIABLE FOR ANY SPECIAL, DIRECT, INDIRECT, OR CONSEQUENTIAL
DAMAGES OR ANY DAMAGES WHATSOEVER RESULTING FROM LOSS OF USE, DATA OR
PROFITS, WHETHER IN AN ACTION OF CONTRACT, NEGLIGENCE OR OTHER
TORTIOUS ACTION, ARISING OUT OF OR IN CONNECTION WITH THE USE OR
PERFORMANCE OF THIS DOCUMENTATION
-->

<body bgcolor="#ffffff" text="#000000">

<h2>
<a href="../../index.html">
<font color="#0000ff"><i>Open</i></font><font color="#000084">BSD</font></a>
<font color="#e00000">PF - Issues with FTP</font>
<small>
<a href="index.html" style="font-weight:normal; float:right">[Contents]</a>
</small>
</h2>
<hr>

<ul>
  <li><a href="#modes"      >FTP modes</a>
  <li><a href="#client"     >FTP client behind the firewall</a>
  <li><a href="#server"     >PF "self-protecting" an FTP server</a>
  <li><a href="#natserver"  >FTP server protected by an external PF firewall
                             running NAT</a>
  <li><a href="#info"       >More information on FTP</a>
  <li><a href="#tftp-proxy" >Proxying TFTP</a>
</ul>

<hr>

<h2 id="modes">FTP modes</h2>

FTP is a protocol that dates back to when the internet was a small,
friendly collection of computers and everyone knew everyone else.
At that time, the need for filtering or tight security wasn't necessary.
FTP wasn't designed for filtering, for passing through firewalls, or for
working with NAT.

<p>
You can use FTP in one of two ways: passive or active.
Generally, the choice of active or passive is made to determine who has the
problem with firewalling.
Realistically, you will have to support both to have happy users.

<p>
With active FTP, when a user connects to a remote FTP server and requests
information or a file, the FTP server makes a new connection back to the
client to transfer the requested data.
This is called the <i>data connection</i>.
To start, the FTP client chooses a random port to receive the data connection.
The client sends the port number it chose to the FTP server and listens for
an incoming connection on that port.
The FTP server then initiates a connection to the client's address at the
chosen port and transfers the data.
This is a problem for users attempting to gain access to FTP servers from
behind a NAT gateway.
Because of how NAT works, the FTP server initiates the data connection by
connecting to the external address of the NAT gateway on the chosen port.
The NAT machine will receive this, but because it has no mapping for the
packet in its state table, it will drop the packet and won't deliver it to
the client.

<p>
With passive mode FTP (the default mode with OpenBSD's
<a href="https://man.openbsd.org/ftp">ftp(1)</a> client), the client requests
that the server pick a random port to listen on for the data connection.
The server informs the client of the port it has chosen, and the client
connects to this port to transfer the data.
Unfortunately, this is not always possible or desirable because of the
possibility of a firewall in front of the FTP server blocking the incoming
data connection.
OpenBSD's ftp(1) uses passive mode by default.
To force active mode FTP, use the <tt>-A</tt> flag to <tt>ftp</tt>, or set
passive mode to "off" by issuing the command "<tt>passive off</tt>" at the
"<tt>ftp&gt;</tt>" prompt.

<h2 id="client">FTP client behind the firewall</h2>

As indicated earlier, FTP does not go through NAT and firewalls very well.

<p>
Packet Filter provides a solution for this situation by diverting FTP traffic
through an FTP proxy server.
This process acts to "guide" your FTP traffic through the NAT gateway/firewall,
by actively adding needed rules to PF system and removing them when done, by
means of the PF <a href="anchors.html">anchors</a> system.
The FTP proxy used by PF is
<a href="https://man.openbsd.org/ftp-proxy">ftp-proxy(8)</a>.

<p>
To activate it, put something like this early in the rules section
of <tt>pf.conf</tt>:

<blockquote><pre>
pass in quick on $int_if inet proto tcp to port 21 divert-to 127.0.0.1 port 8021
</pre></blockquote>

This diverts FTP from your clients to the ftp-proxy(8) program, which is
listening on your machine to port 8021.

<p>
You also need an anchor in the rules section:

<blockquote><pre>
anchor "ftp-proxy/*"
</pre></blockquote>

The proxy server has to be started and running on the OpenBSD box.

<blockquote><pre>
# <b>rcctl enable ftpproxy</b>
# <b>rcctl start  ftpproxy</b>
</pre></blockquote>

The ftp-proxy utility listens on port 8021, the same port the above
<tt>divert-to</tt> statement is sending FTP traffic to.

<p>
To support active mode connections from certain (fussy) clients,
you may need the <tt>-r</tt> switch on ftp-proxy(8).

<h2 id="server">PF "self-protecting" an FTP server</h2>

In this case, PF is running on the FTP server itself rather than a dedicated
firewall computer.
When servicing a passive FTP connection, FTP will use a randomly chosen, high
TCP port for incoming data.
By default, OpenBSD's native <a href="https://man.openbsd.org/ftpd">ftpd(8)</a>
uses the range 49152 to 65535.
Obviously, these must be passed through the filter rules, along with port 21
(the FTP control port):

<blockquote><pre>
pass in on egress proto tcp to port 21
pass in on egress proto tcp to port &gt; 49151
</pre></blockquote>

You can tighten up that range of ports considerably if you want to.
In the case of <a href="https://man.openbsd.org/ftpd">ftpd(8)</a>, that is
done using the <a href="https://man.openbsd.org/sysctl">sysctl(8)</a> variables
<tt>net.inet.ip.porthifirst</tt> and <tt>net.inet.ip.porthilast</tt>.

<h2 id="natserver">FTP server protected by an external PF firewall running
NAT</h2>

In this case, the firewall must redirect traffic to the FTP server in addition
to not blocking the required ports.
In order to accomplish this, we turn again to ftp-proxy(8).

<p>
ftp-proxy(8) can be run in a mode that causes it to forward all FTP connections
to a specific FTP server.
Basically, we'll set up the proxy to listen on port 21 of the firewall and
forward all connections to the backend server.

<blockquote><pre>
# <b>rcctl set ftpproxy flags -R 10.10.10.1 -p 21 -b 192.168.0.1</b>
</pre></blockquote>

Here 10.10.10.1 is the IP address of the actual FTP server, 21 is the
port we want ftp-proxy(8) to listen on, and 192.168.0.1 is the address
on the firewall that we want the proxy to bind to.

<p>
Now for the pf.conf rules:

<blockquote><pre>
ext_ip = "192.168.0.1"
ftp_ip = "10.10.10.1"
match out on egress inet from $int_if nat-to (egress)
anchor "ftp-proxy/*"
pass in  on  egress inet proto tcp to $ext_ip port 21
pass out on $int_if inet proto tcp to $ftp_ip port 21 user _ftp_proxy
</pre></blockquote>

Here we allow the connection inbound to port 21 on the external interface,
as well as the corresponding outbound connection to the FTP server.
The "user _ftp_proxy" addition to the outbound rule ensures that only
connections initiated by ftp-proxy(8) are permitted.

<p>
Note that if you want to run ftp-proxy(8) to protect an FTP server as well
as allow clients to FTP out from behind the firewall, two instances of
ftp-proxy will be required.

<h2 id="info">More information on FTP</h2>

More information on filtering FTP and how FTP works in general can be
found in this whitepaper:

<ul>
  <li><a href="http://www.pintday.org/whitepapers/ftp-review.shtml">FTP
      Reviewed</a>
</ul>

<h2 id="tftp-proxy">Proxying TFTP</h2>

Trivial File Transfer Protocol (TFTP) suffers from some of the same
limitations as FTP does when it comes to passing through a firewall.
Luckily, PF has a helper proxy for TFTP called
<a href="https://man.openbsd.org/tftp-proxy">tftp-proxy(8)</a>.

<p>
tftp-proxy(8) is set up in much the same way as ftp-proxy(8) was in
the <a href="#client">FTP client behind the firewall</a> section above.

<blockquote><pre>
match out on egress inet from $int_if nat-to (egress)
anchor "tftp-proxy/*"
pass in quick on $int_if inet proto udp from $lan to port tftp \
    divert-to 127.0.0.1 port 6969
pass out quick on $ext_if inet proto udp from $lan to port tftp \
    group _tftp_proxy divert-reply
</pre></blockquote>

The rules above allow TFTP outbound from the internal network to TFTP
servers on the external network.

<p>
The last step is to enable and start tftp-proxy(8).

<blockquote><pre>
# <b>rcctl enable tftpproxy</b>
# <b>rcctl start  tftpproxy</b>
</pre></blockquote>

<p>
</body>
</html>
@


1.61
log
@since 5.3, tftpproxy is started as a daemon, not via inetd.
while there, sync the pf rules with tftp-proxy(8) and fix a typo.

original diff from martin ziemer on misc, thanks!
help and ok sthen
@
text
@d92 1
a92 1
<a href="http://man.openbsd.org/ftp">ftp(1)</a> client), the client requests
d115 1
a115 1
<a href="http://man.openbsd.org/ftp-proxy">ftp-proxy(8)</a>.
d155 1
a155 1
By default, OpenBSD's native <a href="http://man.openbsd.org/ftpd">ftpd(8)</a>
d166 2
a167 2
In the case of <a href="http://man.openbsd.org/ftpd">ftpd(8)</a>, that is
done using the <a href="http://man.openbsd.org/sysctl">sysctl(8)</a> variables
d228 1
a228 1
<a href="http://man.openbsd.org/tftp-proxy">tftp-proxy(8)</a>.
@


1.60
log
@the user is _ftp_proxy, not only proxy.

found by mik j and semarie, thanks!
@
text
@d231 1
a231 1
tftp-proxy(8) is setup in much the same way as ftp-proxy(8) was in
d237 1
a237 1
pass in quick on $int_if inet proto udp from $int_if to port tftp \
d239 2
a240 1
anchor "tftp-proxy/*"
d247 1
a247 4
The last step is to enable tftp-proxy in
<a href="http://man.openbsd.org/inetd.conf">inetd.conf(5)</a> so that it
listens on the same port that the <tt>divert-to</tt> rule specified above,
in this case 6969.
d250 2
a251 1
127.0.0.1:6969  dgram   udp   wait  root  /usr/libexec/tftp-proxy tftp-proxy
a252 2

Unlike ftp-proxy(8), tftp-proxy(8) is spawned from inetd.
@


1.59
log
@less "$ext_if" and more egress to simplify example rulesets.
zap some stray <p> tags while here.
@
text
@d200 1
a200 1
pass out on $int_if inet proto tcp to $ftp_ip port 21 user proxy
d205 2
a206 2
The "user proxy" addition to the outbound rule ensures that only connections
initiated by ftp-proxy(8) are permitted.
@


1.58
log
@tls on openbsd.org is now real:
- link to https://www.openbsd.org from the sub-projects' pages
- make internal links relative
- switch link rel=canonical to https to please some search engines
"go ahead" from beck, "do it!!!!" tj
@
text
@a9 1
<!-- XXX this old page can probably be removed entirely -->
d161 2
a162 2
pass in on $ext_if proto tcp to port 21
pass in on $ext_if proto tcp to port &gt; 49151
d197 1
a197 1
match out on $ext_if inet from $int_if nat-to ($ext_if)
d199 1
a199 1
pass in  on $ext_if inet proto tcp to $ext_ip port 21
d235 1
a235 1
match out on $ext_if inet from $int_if nat-to ($ext_if)
@


1.57
log
@sync pf guide formatting with the main faq's style, fixing a few grammar
knits and broken links along the way.

input and ok tb
@
text
@d14 1
a14 1
<link rel="canonical" href="http://www.openbsd.org/faq/pf/ftp.html">
@


1.56
log
@page titles and <title> should be the same.
@
text
@d4 5
d10 1
a11 1
<meta name="description"   content="the OpenBSD FAQ page">
d48 7
a54 7
<li><a href="#modes"     >FTP Modes</a>
<li><a href="#client"    >FTP Client Behind the Firewall</a>
<li><a href="#server"    >PF "Self-Protecting" an FTP Server</a>
<li><a href="#natserver" >FTP Server Protected by an External PF Firewall
                          Running NAT</a>
<li><a href="#info"      >More Information on FTP</a>
<li><a href="#tftp-proxy">Proxying TFTP</a>
d59 5
a63 4
<h2 id="modes">FTP Modes</h2>
FTP is a protocol that dates back to when the Internet was a small,
friendly collection of computers and everyone knew everyone else. At
that time the need for filtering or tight security wasn't necessary.
d68 36
a103 33
You can use FTP in one of two ways: passive or active.  Generally, the
choice of active or passive is made to determine who has the problem
with firewalling.  Realistically, you will have to support both to have
happy users.

<p>
With active FTP, when a user connects to a remote FTP server and
requests information or a file, the FTP server makes a new
connection back to the client to transfer the requested data. This is
called the <i>data connection</i>.  To start, the FTP client chooses a
random port to receive the data connection on. The client sends the port
number it chose to the FTP server and then listens for an incoming
connection on that port.  The FTP server then initiates a connection to
the client's address at the chosen port and transfers the data.  This is a
problem for users attempting to gain access to FTP servers from behind a
NAT gateway.  Because of how NAT works, the FTP server initiates the data
connection by connecting to the external address of the NAT gateway on
the chosen port.  The NAT machine will receive this, but because it has
no mapping for the packet in its state table, it will drop the packet and
won't deliver it to the client.

<p>
With passive mode FTP (the default mode with OpenBSD's <a
href="http://man.openbsd.org/ftp.1"
>ftp(1)</a> client), the client requests that the server pick a random
port to listen on for the data connection. The server informs the client
of the port it has chosen, and the client connects to this port to
transfer the data. Unfortunately, this is not always possible or
desirable because of the possibility of a firewall in front of the FTP
server blocking the incoming data connection. OpenBSD's ftp(1) uses
passive mode by default; to force active mode FTP, use the -A flag to
ftp, or set passive mode to "off" by issuing the command "<tt>passive
off</tt>"  at the "<tt>ftp&gt;</tt>" prompt.
d105 1
a106 1
<h2 id="client">FTP Client Behind the Firewall</h2>
a108 1

d110 5
a114 5
Packet Filter provides a solution for this situation by diverting FTP
traffic through an FTP proxy server. This process acts to "guide" your
FTP traffic through the NAT gateway/firewall, by actively adding needed
rules to PF system and removing them when done, by means of the PF
<a href="anchors.html">anchors</a> system. 
d116 1
a116 1
<a href="http://man.openbsd.org/ftp-proxy.8">ftp-proxy(8)</a>.
d122 1
a122 2
<blockquote>
<tt>
d124 1
a124 2
</tt>
</blockquote>
d126 2
a127 3
<p>
This diverts FTP from your clients to the ftp-proxy(8) program,
which is listening on your machine to port 8021.
d131 2
a132 2
<blockquote>
<tt>
d134 3
a136 2
</tt>
</blockquote>
d138 4
a141 4
<p>
Hopefully it is apparent the proxy server has to be started and running on
the OpenBSD box. This is done by inserting the following line in
<tt>/etc/rc.conf.local</tt>:
d143 2
a144 5
<blockquote>
<tt>
ftpproxy_flags=""
</tt>
</blockquote>
d147 2
a148 2
The ftp-proxy program can be started as root to activate it without a
reboot.
d150 1
a150 3
<p>
ftp-proxy listens on port 8021, the same port the above <tt>divert-to</tt>
statement is sending FTP traffic to.
d152 8
a159 3
<p>
To support active mode connections from certain (fussy) clients,
you may need the '-r' switch on ftp-proxy(8).
d161 2
a162 13
<h2 id="server">PF "Self-Protecting" an FTP Server</h2>
In this case, PF is running on the FTP server itself rather than a
dedicated firewall computer.  When servicing a passive FTP connection,
FTP will use a randomly chosen, high TCP port for incoming data.  By
default, OpenBSD's native FTP server 
<a href="http://man.openbsd.org/ftpd.8"
>ftpd(8)</a> uses the range 49152 to 65535.
Obviously, these must be passed through the filter rules, along with
port 21 (the FTP control port):

<blockquote>
<tt>
pass in on $ext_if proto tcp to port 21<br>
d164 6
a169 2
</tt>
</blockquote>
d171 5
a175 12
<p>
Note that if you desire, you can tighten up that range of ports
considerably. In the case of the OpenBSD 
<a href="http://man.openbsd.org/ftpd.8"
>ftpd(8)</a> program, that is done using the 
<a href="http://man.openbsd.org/sysctl.8"
>sysctl(8)</a> variables <tt>net.inet.ip.porthifirst</tt> and
<tt>net.inet.ip.porthilast</tt>.

<h2 id="natserver">FTP Server Protected by an External PF Firewall Running NAT</h2>
In this case, the firewall must redirect traffic to the FTP server in
addition to not blocking the required ports.
d179 8
a186 13
ftp-proxy(8) can be run in a mode that causes it to forward all FTP
connections to a specific FTP server.
Basically we'll setup the proxy to listen on port 21 of the firewall and
forward all connections to the back-end server.

<p>
Edit <tt>/etc/rc.conf.local</tt> and add the following:

<blockquote>
<tt>
ftpproxy_flags="-R 10.10.10.1 -p 21 -b 192.168.0.1"
</tt>
</blockquote>
a187 1
<p>
d195 6
a200 9
<blockquote>
<tt>
ext_ip = "192.168.0.1"<br>
ftp_ip = "10.10.10.1"<br>
<br>
match out on $ext_if inet from $int_if nat-to ($ext_if)<br>
<br>
anchor "ftp-proxy/*"<br>
pass in on $ext_if inet proto tcp to $ext_ip port 21<br>
d202 6
a207 2
</tt>
</blockquote>
d210 3
a212 5
Here we allow the connection inbound to port 21 on the external
interface as well as the corresponding outbound connection to the FTP
server.
The "user proxy" addition to the outbound rule ensures that only
connections initiated by ftp-proxy(8) are permitted.
d214 1
a214 4
<p>
Note that if you want to run ftp-proxy(8) to protect an FTP server as
well as allow clients to FTP out from behind the firewall that two
instances of ftp-proxy will be required.
a215 1
<h2 id="info">More Information on FTP</h2>
d218 1
d220 2
a221 2
<li><a href="http://www.pintday.org/whitepapers/ftp-review.shtml">FTP
Reviewed</a>
a225 1
<p>
d229 1
a229 1
<a href="http://man.openbsd.org/tftp-proxy.8">tftp-proxy(8)</a>.
d233 1
a233 1
the <a href="#client">FTP Client Behind the Firewall</a> section above.
d235 2
a236 7
<blockquote>
<tt>
match out on $ext_if inet from $int_if nat-to ($ext_if)<br>
anchor "tftp-proxy/*"<br>
pass in quick on $int_if inet proto udp from $int_if to port tftp \<br>
&nbsp;&nbsp;&nbsp;&nbsp;divert-to 127.0.0.1 port 6969<br>
<br>
d238 4
a241 2
</tt>
</blockquote>
a242 1
<p>
d248 3
a250 3
<a href="http://man.openbsd.org/inetd.conf.5"
>inetd.conf(5)</a> so that it listens on the same port that the
<tt>divert-to</tt> rule specified above, in this case 6969.
d252 1
a252 2
<blockquote>
<tt>
d254 1
a254 2
</tt>
</blockquote>
a255 1
<p>
d260 1
a260 1
</html> 
@


1.55
log
@tweak [faq index] button and sync the pf user's guide with that style.
@
text
@d4 1
a4 1
<title>PF - Issues with FTP</title>
@


1.54
log
@fix a few links in the previous commit
@
text
@a30 2
<!-- Passes validator.w3.org, please keep it this way;
please, use a max of 72 chars per line -->
d36 3
a40 6
<p>
[<a href="index.html">Contents</a>]
[<a href="perf.html">Previous: Performance</a>]
[<a href="authpf.html">Next: Authpf: User Shell for Authenticating
Gateways</a>]
<p>
a41 1
<h3>Table of Contents</h3>
d43 6
a48 6
<li><a href="#modes">FTP Modes</a>
<li><a href="#client">FTP Client Behind the Firewall</a>
<li><a href="#server">PF "Self-Protecting" an FTP Server</a>
<li><a href="#natserver">FTP Server Protected by an External PF Firewall
Running NAT</a>
<li><a href="#info">More Information on FTP</a>
a282 7


<p>
[<a href="perf.html">Previous: Performance</a>]
[<a href="index.html">Contents</a>]
[<a href="authpf.html">Next: Authpf: User Shell for Authenticating
Gateways</a>]
@


1.53
log
@use short form man links in the faq and fix a few broken links
@
text
@d114 1
a114 1
<a href="http://man.openbsd.org/ftp-proxy&amp;sektion=8">ftp-proxy(8)</a>.
@


1.52
log
@new openbsd faq style. joint with tj and validator.w3.org
@
text
@d91 1
a91 1
href="http://man.openbsd.org/?query=ftp&amp;sektion=1"
d114 1
a114 2
<a href="http://man.openbsd.org/?query=ftp-proxy&amp;sektion=8"
>ftp-proxy(8)</a>.
d166 1
a166 1
<a href="http://man.openbsd.org/?query=ftpd&amp;sektion=8"
d181 1
a181 1
<a href="http://man.openbsd.org/?query=ftpd&amp;sektion=8"
d183 1
a183 1
<a href="http://man.openbsd.org/?query=sysctl&amp;sektion=8"
d254 1
a254 2
<a href="http://man.openbsd.org/?query=tftp-proxy&amp;sektion=8"
>tftp-proxy(8)</a>.
d277 1
a277 1
<a href="http://man.openbsd.org/?query=inetd.conf&amp;sektion=5"
@


1.51
log
@add a small sprinkling of css to improve readability in the faq, ok tj@@ tb@@
@
text
@d4 1
a4 1
<title>PF: Issues with FTP</title>
d34 1
d36 4
a39 2
<img alt="[OpenBSD]" height=30 width=141 src="../../images/smalltitle.gif" border="0">
</a>
d41 1
a42 1
[<a href="index.html">Contents</a>]
a44 1

a45 2
<h1><font color="#e00000">PF: Issues with FTP</font></h1>
<hr>
@


1.50
log
@fix URIs, the / before querystring is not optional,
if not fixed up by browsers the server returns 400 Bad Request.
@
text
@d7 2
@


1.49
log
@change http://www.openbsd.org/cgi-bin/man.cgi to be http://man.openbsd.org
this points stuff to the new place and gets us ready to deprecate the old
place we did this.
@
text
@d89 1
a89 1
href="http://man.openbsd.org?query=ftp&amp;sektion=1"
d112 1
a112 1
<a href="http://man.openbsd.org?query=ftp-proxy&amp;sektion=8"
d165 1
a165 1
<a href="http://man.openbsd.org?query=ftpd&amp;sektion=8"
d180 1
a180 1
<a href="http://man.openbsd.org?query=ftpd&amp;sektion=8"
d182 1
a182 1
<a href="http://man.openbsd.org?query=sysctl&amp;sektion=8"
d253 1
a253 1
<a href="http://man.openbsd.org?query=tftp-proxy&amp;sektion=8"
d277 1
a277 1
<a href="http://man.openbsd.org?query=inetd.conf&amp;sektion=5"
@


1.48
log
@
rev for 5.8, mostly removing manpath part of man page urls
@
text
@d89 1
a89 1
href="http://www.openbsd.org/cgi-bin/man.cgi?query=ftp&amp;sektion=1"
d112 1
a112 1
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=ftp-proxy&amp;sektion=8"
d165 1
a165 1
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=ftpd&amp;sektion=8"
d180 1
a180 1
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=ftpd&amp;sektion=8"
d182 1
a182 1
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=sysctl&amp;sektion=8"
d253 1
a253 1
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=tftp-proxy&amp;sektion=8"
d277 1
a277 1
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=inetd.conf&amp;sektion=5"
@


1.47
log
@Clean up meta tags.

name=distribution, name=keywords, and name=resource-type have no effect
in modern search engines and just clutter up the page source.

From Pavel Plamenov.
@
text
@d112 1
a112 1
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=ftp-proxy&amp;sektion=8&amp;manpath=OpenBSD+5.7"
d253 1
a253 1
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=tftp-proxy&amp;sektion=8&amp;manpath=OpenBSD+5.7"
@


1.46
log
@Add 'link rel="canonical"' to pages, acting as a hint to search engines
to list the copies on www.openbsd.org rather than mirrors.

From Carlin Bingham, ok millert@@ nick@@
@
text
@a5 1
<meta name="resource-type" content="document">
a6 2
<meta name="keywords"      content="openbsd,faq,pf">
<meta name="distribution"  content="global">
@


1.45
log
@
updates for 5.7
@
text
@d10 1
@


1.44
log
@
5.5->5.6 which I forgot and Jonathan Thornburg (jthorn at astro dot
indiana dot edu) reminded me of, but also sent a diff for, thanks!
@
text
@d114 1
a114 1
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=ftp-proxy&amp;sektion=8&amp;manpath=OpenBSD+5.6"
d255 1
a255 1
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=tftp-proxy&amp;sektion=8&amp;manpath=OpenBSD+5.6"
@


1.43
log
@Convert the pf faq to use id="" instead of "a name=""></a>.
@
text
@d114 1
a114 1
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=ftp-proxy&amp;sektion=8&amp;manpath=OpenBSD+5.5"
d255 1
a255 1
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=tftp-proxy&amp;sektion=8&amp;manpath=OpenBSD+5.5"
@


1.42
log
@explicitly specify "inet" in various nat-to rules where it's ambiguous
(plus minor whitespace cleanup)
@
text
@d60 1
a60 2
<a name="modes"></a>
<h2>FTP Modes</h2>
d103 1
a103 2
<a name="client"></a>
<h2>FTP Client Behind the Firewall</h2>
d162 1
a162 3

<a name="server"></a>
<h2>PF "Self-Protecting" an FTP Server</h2>
d188 1
a188 2
<a name="natserver"></a>
<h2>FTP Server Protected by an External PF Firewall Running NAT</h2>
d241 1
a241 3

<a name="info"></a>
<h2>More Information on FTP</h2>
d249 1
a249 3

<a name="tftp-proxy"></a>
<h2>Proxying TFTP</h2>
@


1.41
log
@
update for 5.5
@
text
@d273 1
a273 1
match out on $ext_if from $int_if nat-to ($ext_if)<br>
@


1.40
log
@
www@@ removal, normalize footers.
@
text
@d116 1
a116 1
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=ftp-proxy&amp;sektion=8&amp;manpath=OpenBSD+5.4"
d264 1
a264 1
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=tftp-proxy&amp;sektion=8&amp;manpath=OpenBSD+5.4"
@


1.39
log
@
update for 5.4
@
text
@a4 1
<link rev="made" href="mailto:www@@openbsd.org">
a308 6
<hr>
<a href="index.html"><img height="24" width="24" src="../../images/back.gif" border="0" alt="[back]"></a> 
<a href="mailto:www@@openbsd.org">www@@openbsd.org</a>
<br>
<small>$OpenBSD: ftp.html,v 1.38 2013/05/01 13:21:45 nick Exp $</small>

@


1.38
log
@
updates for 5.3
@
text
@d117 1
a117 1
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=ftp-proxy&amp;sektion=8&amp;manpath=OpenBSD+5.3"
d265 1
a265 1
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=tftp-proxy&amp;sektion=8&amp;manpath=OpenBSD+5.3"
d314 1
a314 1
<small>$OpenBSD: ftp.html,v 1.37 2012/11/01 15:06:36 nick Exp $</small>
@


1.37
log
@
enter 5.2
@
text
@d117 1
a117 1
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=ftp-proxy&amp;sektion=8&amp;manpath=OpenBSD+5.2"
d265 1
a265 1
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=tftp-proxy&amp;sektion=8&amp;manpath=OpenBSD+5.2"
d314 1
a314 1
<small>$OpenBSD: ftp.html,v 1.36 2012/05/11 11:20:04 nick Exp $</small>
@


1.36
log
@
forgot to actually COMMIT these 5.1 changes.  *sigh*
@
text
@d117 1
a117 1
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=ftp-proxy&amp;sektion=8&amp;manpath=OpenBSD+5.1"
d265 1
a265 1
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=tftp-proxy&amp;sektion=8&amp;manpath=OpenBSD+5.1"
d314 1
a314 1
<small>$OpenBSD: ftp.html,v 1.35 2011/11/02 01:01:47 nick Exp $</small>
@


1.35
log
@
rev man page references to 5.0
@
text
@d117 1
a117 1
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=ftp-proxy&amp;sektion=8&amp;manpath=OpenBSD+5.0"
d265 1
a265 1
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=tftp-proxy&amp;sektion=8&amp;manpath=OpenBSD+5.0"
d314 1
a314 1
<small>$OpenBSD: ftp.html,v 1.34 2011/11/01 13:24:27 sthen Exp $</small>
@


1.34
log
@In 5.0, ftp-proxy and tftp-proxy use divert-to. Update faq accordingly.
@
text
@d117 1
a117 1
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=ftp-proxy&amp;sektion=8&amp;manpath=OpenBSD+4.9"
d265 1
a265 1
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=tftp-proxy&amp;sektion=8&amp;manpath=OpenBSD+4.9"
d314 1
a314 1
<small>$OpenBSD: ftp.html,v 1.33 2011/05/01 12:57:11 nick Exp $</small>
@


1.33
log
@
updates for 4.9
@
text
@d111 1
a111 1
Packet Filter provides a solution for this situation by redirecting FTP
d126 1
a126 1
pass in quick on $int_if proto tcp to port 21 rdr-to 127.0.0.1 port 8021
d131 1
a131 1
This redirects FTP from your clients to the ftp-proxy(8) program,
d158 1
a158 1
ftp-proxy listens on port 8021, the same port the above <tt>rdr-to</tt>
d276 2
a277 2
pass in quick on $int_if proto udp from $int_if to port tftp \<br>
&nbsp;&nbsp;&nbsp;&nbsp;rdr-to 127.0.0.1 port 6969<br>
d291 1
a291 1
<tt>rdr-to</tt> rule specified above, in this case 6969.
d314 1
a314 1
<small>$OpenBSD: ftp.html,v 1.32 2010/11/01 09:53:51 nick Exp $</small>
@


1.32
log
@
update to 4.8
@
text
@d117 1
a117 1
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=ftp-proxy&amp;sektion=8&amp;manpath=OpenBSD+4.8"
d265 1
a265 1
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=tftp-proxy&amp;sektion=8&amp;manpath=OpenBSD+4.8"
d314 1
a314 1
<small>$OpenBSD: ftp.html,v 1.31 2010/05/24 12:13:41 sthen Exp $</small>
@


1.31
log
@rdr -> rdr-to in text
@
text
@d117 1
a117 1
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=ftp-proxy&amp;sektion=8&amp;manpath=OpenBSD+4.7"
d265 1
a265 1
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=tftp-proxy&amp;sektion=8&amp;manpath=OpenBSD+4.7"
d314 1
a314 1
<small>$OpenBSD: ftp.html,v 1.30 2010/05/19 13:25:16 sthen Exp $</small>
@


1.30
log
@Update the PF faq for 4.7 changes.
@
text
@d291 1
a291 1
<tt>rdr</tt> rule specified above, in this case 6969.
d314 1
a314 1
<small>$OpenBSD: ftp.html,v 1.29 2009/10/16 19:12:42 nick Exp $</small>
@


1.29
log
@
quick update for 4.6.  much more is needed, at least scrub.html is
currently dead wrong, so I've unlinked it from the rest for now.
@
text
@d117 1
a117 1
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=ftp-proxy&amp;sektion=8&amp;manpath=OpenBSD+4.6"
d121 1
a121 1
To activate it, put something like this in the NAT section
d126 1
a126 4
nat-anchor "ftp-proxy/*"<br>
rdr-anchor "ftp-proxy/*"<br>
rdr on $int_if proto tcp from any to any port 21 -&gt; 127.0.0.1 \<br>
&nbsp;&nbsp;&nbsp;port 8021
d131 2
a132 5
The first two lines are a couple <a href="anchors.html">anchors</a>
which are used by ftp-proxy to add rules on-the-fly as needed to
manage your FTP traffic.
The last line redirects FTP from your clients to the ftp-proxy(8)
program, which is listening on your machine to port 8021.
d158 1
a158 1
ftp-proxy listens on port 8021, the same port the above <tt>rdr</tt>
d162 2
a163 2
To enable active mode connections, you need the '-r' switch on
ftp-proxy(8) (for this you had to run the old proxy with "-u root").
d179 2
a180 3
pass in on $ext_if proto tcp from any to any port 21 keep state<br>
pass in on $ext_if proto tcp from any to any port &gt; 49151 \<br>
&nbsp;&nbsp;&nbsp;keep state
d227 1
a227 3
nat-anchor "ftp-proxy/*"<br>
nat on $ext_if inet from $int_if -&gt; ($ext_if)<br>
rdr-anchor "ftp-proxy/*"<br>
d229 3
a231 5
pass in on $ext_if inet proto tcp to $ext_ip port 21 \<br>
&nbsp;&nbsp;&nbsp;&nbsp;flags S/SA keep state<br>
pass out on $int_if inet proto tcp to $ftp_ip port 21 \<br>
&nbsp;&nbsp;&nbsp;&nbsp;user proxy flags S/SA keep state<br>
anchor "ftp-proxy/*"
d265 1
a265 1
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=tftp-proxy&amp;sektion=8&amp;manpath=OpenBSD+4.6"
d274 4
a277 4
nat on $ext_if from $int_if -&gt; ($ext_if)<br>
rdr-anchor "tftp-proxy/*"<br>
rdr on $int_if proto udp from $int_if to port tftp -&gt; \<br>
&nbsp;&nbsp;&nbsp;&nbsp;127.0.0.1 port 6969<br>
d314 1
a314 1
<small>$OpenBSD: ftp.html,v 1.28 2009/04/30 17:27:31 nick Exp $</small>
@


1.28
log
@
updates for 4.5
@
text
@d117 1
a117 1
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=ftp-proxy&amp;sektion=8&amp;manpath=OpenBSD+4.5"
d276 1
a276 1
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=tftp-proxy&amp;sektion=8&amp;manpath=OpenBSD+4.5"
d325 1
a325 1
<small>$OpenBSD: ftp.html,v 1.27 2008/10/31 16:49:34 nick Exp $</small>
@


1.27
log
@
update numbers for 4.4
@
text
@d117 1
a117 1
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=ftp-proxy&amp;sektion=8&amp;manpath=OpenBSD+4.4"
d276 1
a276 1
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=tftp-proxy&amp;sektion=8&amp;manpath=OpenBSD+4.4"
d325 1
a325 1
<small>$OpenBSD: ftp.html,v 1.26 2008/07/27 17:13:47 nick Exp $</small>
@


1.26
log
@
PF updates for 4.3..which got missed a few times.
@
text
@d117 1
a117 1
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=ftp-proxy&amp;sektion=8&amp;manpath=OpenBSD+4.3"
d276 1
a276 1
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=tftp-proxy&amp;sektion=8&amp;manpath=OpenBSD+4.3"
d325 1
a325 1
<small>$OpenBSD: ftp.html,v 1.25 2007/11/01 02:57:56 joel Exp $</small>
@


1.25
log
@Updates for OpenBSD 4.2
@
text
@d116 2
a117 2
The FTP proxy used by PF in OpenBSD 3.9 and later is
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=ftp-proxy&amp;sektion=8&amp;manpath=OpenBSD+4.2"
a118 4
(note: earlier versions of OpenBSD used a different proxy of the same
name, which is documented in OpenBSD 3.8's
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=ftp-proxy&amp;sektion=8&amp;manpath=OpenBSD+3.8"
>ftp-proxy(8)v3.8</a>).
d276 1
a276 1
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=tftp-proxy&amp;sektion=8&amp;manpath=OpenBSD+4.2"
d325 1
a325 1
<small>$OpenBSD: ftp.html,v 1.24 2007/05/06 18:59:54 nick Exp $</small>
@


1.24
log
@
manpath changes to:
  4.1 for PF related items
  removed for non-PF-related items, which will probably either not
    change much, or benefit from the newest, best man pages.
@
text
@d117 1
a117 1
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=ftp-proxy&amp;sektion=8&amp;manpath=OpenBSD+4.1"
d280 1
a280 1
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=tftp-proxy&amp;sektion=8&amp;manpath=OpenBSD+4.1"
d329 1
a329 1
<small>$OpenBSD: ftp.html,v 1.23 2006/11/01 01:56:01 joel Exp $</small>
@


1.23
log
@Updates for OpenBSD 4.0. uRPF, tftp-proxy, more ftp-proxy, etc.
Thanks to mcbride for the bits about interface groups
@
text
@d93 1
a93 1
href="http://www.openbsd.org/cgi-bin/man.cgi?query=ftp&amp;sektion=1&amp;manpath=OpenBSD+4.0"
d117 1
a117 1
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=ftp-proxy&amp;sektion=8&amp;manpath=OpenBSD+4.0"
d182 1
a182 1
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=ftpd&amp;sektion=8&amp;manpath=OpenBSD+4.0"
d198 1
a198 1
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=ftpd&amp;sektion=8&amp;manpath=OpenBSD+4.0"
d200 1
a200 1
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=sysctl&amp;sektion=8&amp;manpath=OpenBSD+4.0"
d280 1
a280 1
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=tftp-proxy&amp;sektion=8&amp;manpath=OpenBSD+4.0"
d304 1
a304 1
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=inetd.conf&amp;sektion=5&amp;manpath=OpenBSD+4.0"
d329 1
a329 1
<small>$OpenBSD: ftp.html,v 1.22 2006/05/11 01:18:23 nick Exp $</small>
@


1.22
log
@
bah.  Forgot the rules anchor.
@
text
@d56 1
d93 1
a93 1
href="http://www.openbsd.org/cgi-bin/man.cgi?query=ftp&amp;sektion=1&amp;manpath=OpenBSD+3.9"
d116 2
a117 2
The FTP proxy used by OpenBSD 3.9 and PF is
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=ftp-proxy&amp;sektion=8&amp;manpath=OpenBSD+3.9"
d139 1
a139 1
which are used to by ftp-proxy to add rules on-the-fly as needed to
a174 5
<p>
Please note that ftp-proxy(8) is to help <b>FTP clients</b> behind a PF
filter; it is not used to handle an <b>FTP server</b> behind a PF
filter.

d182 1
a182 1
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=ftpd&amp;sektion=8&amp;manpath=OpenBSD+3.9"
d198 1
a198 1
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=ftpd&amp;sektion=8&amp;manpath=OpenBSD+3.9"
d200 1
a200 1
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=sysctl&amp;sektion=8&amp;manpath=OpenBSD+3.9"
d207 8
a214 4
addition to not blocking the required ports.  For the sake of discussion,
we will assume the FTP server in question is again the standard OpenBSD
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=ftpd&amp;sektion=8&amp;manpath=OpenBSD+3.9"
>ftpd(8)</a>, using the default range of ports.
d217 2
a218 1
Here is an example subset of rules which would accomplish this:
d221 16
a236 1
ftp_server = "10.0.3.21"<br>
d238 3
a240 4
rdr on $ext_if proto tcp from any to any port 21 -&gt; $ftp_server \<br>
&nbsp;&nbsp;&nbsp;port 21<br>
rdr on $ext_if proto tcp from any to any port 49152:65535 -&gt; \<br>
&nbsp;&nbsp;&nbsp;$ftp_server port 49152:65535<br>
d242 5
a246 11
# in on $ext_if<br>
pass in quick on $ext_if proto tcp from any to $ftp_server \<br>
&nbsp;&nbsp;&nbsp;port 21 keep state<br>
pass in quick on $ext_if proto tcp from any to $ftp_server \<br>
&nbsp;&nbsp;&nbsp;port &gt; 49151 keep state<br>
<br>
# out on $int_if<br>
pass out quick on $int_if proto tcp from any to $ftp_server \<br>
&nbsp;&nbsp;&nbsp;port 21 keep state<br>
pass out quick on $int_if proto tcp from any to $ftp_server \<br>
&nbsp;&nbsp;&nbsp;port &gt; 49151 keep state
d250 12
d272 46
d329 1
a329 1
<small>$OpenBSD: ftp.html,v 1.21 2006/05/02 12:17:07 steven Exp $</small>
@


1.21
log
@fix typos, spotted by Antoine Jacoutot.
@
text
@d144 8
d262 1
a262 1
<small>$OpenBSD: ftp.html,v 1.20 2006/05/01 00:52:07 nick Exp $</small>
@


1.20
log
@
Update for 3.9's ftp-proxy
@
text
@a166 3


<p>
d254 1
a254 1
<small>$OpenBSD: ftp.html,v 1.19 2005/11/01 11:35:18 nick Exp $</small>
@


1.19
log
@
bump manpath= tag for 3.8
@
text
@d92 1
a92 1
href="http://www.openbsd.org/cgi-bin/man.cgi?query=ftp&amp;sektion=1&amp;manpath=OpenBSD+3.8"
d112 8
a119 2
FTP traffic through the NAT gateway/firewall.  The FTP proxy used by
OpenBSD and PF is
d121 4
a124 1
>ftp-proxy(8)</a>.  To activate it, put something like this in the NAT section
d129 2
d137 5
a141 3
The explanation of this line is: "Traffic on the internal interface is
redirected to the proxy server running on this machine which is
listening at port 8021".
d146 1
a146 1
<tt>/etc/inetd.conf</tt>:
d150 1
a150 2
127.0.0.1:8021 stream tcp nowait root /usr/libexec/ftp-proxy \<br>
&nbsp;&nbsp;&nbsp;ftp-proxy -n
d155 6
a160 6
Note that the <tt>-n</tt> switch is only necessary if the OpenBSD
machine is performing NAT.
Now send a 'HUP' signal to
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=inetd&amp;sektion=8&amp;manpath=OpenBSD+3.8"
>inetd(8)</a> to have it reread its configuration file.
One way to send the 'HUP' signal is with the command:
d162 3
a164 5
<blockquote>
<tt>
kill -HUP `cat /var/run/inetd.pid`
</tt>
</blockquote>
a166 16
You will note that ftp-proxy is listening on port 8021, the same port
the above <tt>rdr</tt> statement is sending FTP traffic to.  The choice
of port 8021 is arbitrary, though 8021 is a good choice as it is not
defined for any other application.

<p>
At this point only passive mode FTP connections will function. 
To enable active mode connections, the ftp-data connection that the FTP
server initiates must be passed in on the firewall. 
Unfortunately, the port that this connection comes in on can't be known
beforehand, only the range that it falls within. 
What is known, however, is that the connection will be initiated from
port 20 (ftp-data port) and that ftp-proxy will be accepting the
connection (and then relaying data to the client). 
Since ftp-proxy runs as the user <tt>proxy</tt>, the <tt>user</tt>
keyword can be used in the filter rule.
a167 6
<blockquote>
<tt>
pass in on $ext_if inet proto tcp from port 20 to ($ext_if) \<br>
&nbsp;&nbsp;&nbsp;&nbsp;user proxy flags S/SA keep state
</tt>
</blockquote>
d170 3
a172 2
Please note that ftp-proxy(8) is to help <b>FTP clients</b> behind a PF filter;
it is not used to handle an <b>FTP server</b> behind a PF filter.
d181 1
a181 1
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=ftpd&amp;sektion=8&amp;manpath=OpenBSD+3.8"
d197 1
a197 1
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=ftpd&amp;sektion=8&amp;manpath=OpenBSD+3.8"
d199 1
a199 1
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=sysctl&amp;sektion=8&amp;manpath=OpenBSD+3.8"
d208 1
a208 1
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=ftpd&amp;sektion=8&amp;manpath=OpenBSD+3.8"
d257 1
a257 1
<small>$OpenBSD: ftp.html,v 1.18 2005/05/20 00:12:02 joel Exp $</small>
@


1.18
log
@Updates for OpenBSD 3.7.
@
text
@d92 1
a92 1
href="http://www.openbsd.org/cgi-bin/man.cgi?query=ftp&amp;sektion=1&amp;manpath=OpenBSD+3.7"
d114 1
a114 1
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=ftp-proxy&amp;sektion=8&amp;manpath=OpenBSD+3.7"
d146 1
a146 1
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=inetd&amp;sektion=8&amp;manpath=OpenBSD+3.7"
d192 1
a192 1
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=ftpd&amp;sektion=8&amp;manpath=OpenBSD+3.7"
d208 1
a208 1
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=ftpd&amp;sektion=8&amp;manpath=OpenBSD+3.7"
d210 1
a210 1
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=sysctl&amp;sektion=8&amp;manpath=OpenBSD+3.7"
d219 1
a219 1
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=ftpd&amp;sektion=8&amp;manpath=OpenBSD+3.7"
d268 1
a268 1
<small>$OpenBSD: ftp.html,v 1.17 2004/12/22 04:28:16 david Exp $</small>
@


1.17
log
@make small title logo a link back to main page; ok nick@@
@
text
@d92 1
a92 1
href="http://www.openbsd.org/cgi-bin/man.cgi?query=ftp&amp;sektion=1&amp;manpath=OpenBSD+3.6"
d114 1
a114 1
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=ftp-proxy&amp;sektion=8&amp;manpath=OpenBSD+3.6"
d146 1
a146 1
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=inetd&amp;sektion=8&amp;manpath=OpenBSD+3.6"
d192 1
a192 1
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=ftpd&amp;sektion=8&amp;manpath=OpenBSD+3.6"
d208 1
a208 1
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=ftpd&amp;sektion=8&amp;manpath=OpenBSD+3.6"
d210 1
a210 1
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=sysctl&amp;sektion=8&amp;manpath=OpenBSD+3.6"
d219 1
a219 1
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=ftpd&amp;sektion=8&amp;manpath=OpenBSD+3.6"
d268 1
a268 1
<small>$OpenBSD: ftp.html,v 1.16 2004/11/01 21:41:07 nick Exp $</small>
@


1.16
log
@
3.6 content upgrades.  Directly from Joel Knight, jaredy@@ did the
anchors and nested anchors work, rest is by Joel.
@
text
@d35 3
a37 1
<img alt="[OpenBSD]" height=30 width=141 src="../../images/smalltitle.gif">
d268 1
a268 1
<small>$OpenBSD: ftp.html,v 1.15 2004/10/29 17:22:57 nick Exp $</small>
@


1.15
log
@
Update for 3.6
@
text
@d136 1
a136 1
&nbsp;&nbsp;&nbsp;ftp-proxy
d141 3
a143 1
and either rebooting the system or sending a 'HUP' signal to
d145 2
a146 1
>inetd(8)</a>.  One way to send the 'HUP' signal is with the command:
d161 19
d266 1
a266 1
<small>$OpenBSD: ftp.html,v 1.14 2004/05/07 01:55:23 nick Exp $</small>
@


1.14
log
@
Add an OpenBSD license to the PF User's Guide.
Concept and breakdown of copyrights agreed to by Joel Knight and myself,
license assistance millert@@, ok deraadt@@.
@
text
@d90 1
a90 1
href="http://www.openbsd.org/cgi-bin/man.cgi?query=ftp&amp;sektion=1&amp;manpath=OpenBSD+3.5"
d112 1
a112 1
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=ftp-proxy&amp;sektion=8&amp;manpath=OpenBSD+3.5"
d142 1
a142 1
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=inetd&amp;sektion=8&amp;manpath=OpenBSD+3.5"
d168 1
a168 1
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=ftpd&amp;sektion=8&amp;manpath=OpenBSD+3.5"
d184 1
a184 1
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=ftpd&amp;sektion=8&amp;manpath=OpenBSD+3.5"
d186 1
a186 1
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=sysctl&amp;sektion=8&amp;manpath=OpenBSD+3.5"
d195 1
a195 1
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=ftpd&amp;sektion=8&amp;manpath=OpenBSD+3.5"
d244 1
a244 1
<small>$OpenBSD: ftp.html,v 1.13 2004/04/30 18:00:25 nick Exp $</small>
@


1.13
log
@
PF User's Guide updates for OpenBSD 3.5.
Work done by Joel Knight (enabled et myrealbox.dit com), many, many thanks
to him for providing and maintaining some darned good docs.
@
text
@a10 1
<meta name="copyright"     content="This document copyright 2002-2004 by OpenBSD.">
d13 18
d244 1
a244 1
<small>$OpenBSD: ftp.html,v 1.12 2004/01/08 01:03:48 nick Exp $</small>
@


1.12
log
@
From Joel Knight: makes one of the example rulesets in the FTP section
more complete. Suggested by Xavier Santolaria (xavier at santolaria dot net).
@
text
@d73 1
a73 1
href="http://www.openbsd.org/cgi-bin/man.cgi?query=ftp&amp;sektion=1&amp;manpath=OpenBSD+3.4"
d95 1
a95 1
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=ftp-proxy&amp;sektion=8&amp;manpath=OpenBSD+3.4"
d125 1
a125 1
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=inetd&amp;sektion=8&amp;manpath=OpenBSD+3.4"
d151 1
a151 1
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=ftpd&amp;sektion=8&amp;manpath=OpenBSD+3.4"
d167 1
a167 1
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=ftpd&amp;sektion=8&amp;manpath=OpenBSD+3.4"
d169 1
a169 1
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=sysctl&amp;sektion=8&amp;manpath=OpenBSD+3.4"
d178 1
a178 1
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=ftpd&amp;sektion=8&amp;manpath=OpenBSD+3.4"
d227 1
a227 1
<small>$OpenBSD: ftp.html,v 1.11 2004/01/01 04:16:17 nick Exp $</small>
@


1.11
log
@
Bump copyright to 2004
@
text
@d192 1
d196 6
d227 1
a227 1
<small>$OpenBSD: ftp.html,v 1.10 2003/11/27 15:08:25 nick Exp $</small>
@


1.10
log
@
Major update to the PF FAQ from "Mr. PF FAQ", Joel Knight.  THANKS!
@
text
@d11 1
a11 1
<meta name="copyright"     content="This document copyright 2002-2003 by OpenBSD.">
d220 1
a220 1
<small>$OpenBSD: ftp.html,v 1.9 2003/11/09 23:29:02 nick Exp $</small>
@


1.9
log
@
Update of PF User's Guide to 3.4.  Ok, really just pointing the man page
links at the 3.4-release man pages rather than the 3.3-release man pages.
Work by Joel Knight.
@
text
@d97 1
a97 1
of <tt>/etc/pf.conf</tt>:
d220 1
a220 1
<small>$OpenBSD: ftp.html,v 1.8 2003/09/16 01:23:49 nick Exp $</small>
@


1.8
log
@
Grammar and punctuation clean up, from Joel Knight.
Only a very few words changed.
@
text
@d73 1
a73 1
href="http://www.openbsd.org/cgi-bin/man.cgi?query=ftp&amp;sektion=1&amp;manpath=OpenBSD+3.3"
d95 1
a95 1
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=ftp-proxy&amp;sektion=8&amp;manpath=OpenBSD+3.3"
d125 1
a125 1
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=inetd&amp;sektion=8&amp;manpath=OpenBSD+3.3"
d151 1
a151 1
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=ftpd&amp;sektion=8&amp;manpath=OpenBSD+3.3"
d167 1
a167 1
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=ftpd&amp;sektion=8&amp;manpath=OpenBSD+3.3"
d169 1
a169 1
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=sysctl&amp;sektion=8&amp;manpath=OpenBSD+3.3"
d178 1
a178 1
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=ftpd&amp;sektion=8&amp;manpath=OpenBSD+3.3"
d220 1
a220 1
<small>$OpenBSD: ftp.html,v 1.7 2003/06/29 20:28:24 nick Exp $</small>
@


1.7
log
@
Attach new authpf section, from Joel Knight.
@
text
@d112 1
a112 1
Hopefully, it is apparent the proxy server has to be started and running on
d137 1
a137 1
of port 8021 is arbitrary, though 8021 is a good choice, as it is not
d175 1
a175 1
In this case, the firewall must redirect traffic to the FTP server, in
d220 1
a220 1
<small>$OpenBSD: ftp.html,v 1.6 2003/06/13 02:54:08 nick Exp $</small>
@


1.6
log
@
Improved wrapping of man page links, renders better on some browsers.
No words altered.  From Joel Knight.
@
text
@d22 2
a23 2
[<a href="example1.html">Next: Example #1: Firewall for Home or Small
Office</a>]
d212 2
a213 2
[<a href="example1.html">Next: Example #1: Firewall for Home or Small
Office</a>]
d220 1
a220 1
<small>$OpenBSD: ftp.html,v 1.5 2003/05/16 22:05:46 nick Exp $</small>
@


1.5
log
@
missing protos, spotted by Matt Jibson (dolmant at dolmant dot net).
Line wrappings for better view in lynx, from Joel Knight.
@
text
@d169 2
a170 2
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=sysctl&amp;sektion=8&amp;manpath=OpenBSD+3.3">
sysctl(8)</a> variables <tt>net.inet.ip.porthifirst</tt> and
d205 2
a206 1
<li><a href="http://www.pintday.org/whitepapers/ftp-review.shtml">FTP Reviewed</a>
d220 1
a220 1
<small>$OpenBSD: ftp.html,v 1.4 2003/05/15 03:03:54 nick Exp $</small>
@


1.4
log
@
Table of Contents now on each page.  Work by Joel Knight (yay! Joel! 8-).
@
text
@d101 2
a102 1
rdr on $int_if from any to any port 21 -&gt; 127.0.0.1 port 8021
d118 2
a119 1
127.0.0.1:8021 stream tcp nowait root /usr/libexec/ftp-proxy ftp-proxy
d187 2
a188 1
rdr on $ext_if proto tcp from any to any port 21 -&gt; $ftp_server port 21<br>
d192 4
a195 3
pass in quick on $ext_if proto tcp from any to $ftp_server port 21 keep state<br>
pass in quick on $ext_if proto tcp from any to $ftp_server port &gt; 49151 \<br>
&nbsp;&nbsp;&nbsp;keep state
d219 1
a219 1
<small>$OpenBSD: ftp.html,v 1.3 2003/05/12 04:20:06 nick Exp $</small>
@


1.3
log
@
Joel Knight's rework of my FTP info.
@
text
@d29 14
a42 1
<p>
d215 1
a215 1
<small>$OpenBSD: ftp.html,v 1.2 2003/05/09 02:36:09 nick Exp $</small>
@


1.2
log
@
oops.  $WEB -&gt; $FTP.  Spotted by >lists at scapa dot dnsalias dot net<
@
text
@d22 1
a22 1
[<a href="example1.html">Next: Example Firewall For Home or Small 
d31 4
a34 4
friendly collection of computers and everyone knew everyone else, before
the need for filtering or tight security had occurred to anyone.  It
wasn't designed for filtering, or for passing through firewalls or to
work with NAT.
d37 4
a40 4
You can use FTP in two ways: passive and active.  Generally, the choice
of active or passive is made to determine who has the problem with
firewalling.  Realistically you will have to support both to have happy
users.
d44 26
a69 20
requests information or a file, the FTP client sends the server a random
port number that the FTP server will make a connection to on the
client and transfer the data. This is a problem for users attempting
to gain access to FTP servers from within the LAN.  When the FTP server
sends its information, it sends it to the external NIC at a random port.
The NAT machine will receive this, but because it has no mappings for
the unknown packet and doesn't have any mappings for that port, it will
drop the packet and won't deliver it.

<p>
With passive mode FTP (the default with OpenBSD's
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=ftp&amp;sektion=1&amp;manpath=OpenBSD+3.3">
ftp(1)</a> client), the client requests that the server picks a
random port that it will listen on for the data connection. The server
informs the client of the port it has chosen, and the client connects to
this port to transfer the data. Unfortunately, this is not always
possible or desirable. ftp(1) uses this mode by default; to force active
mode FTP, use the -A flag to ftp, or set the passive mode to off by
issuing the command "<tt>passive off</tt>"  at the "<tt>ftp&gt;</tt>"
prompt.
d72 2
a73 1
<h2>Client FTP behind the firewall</h2>
d78 18
a95 14
Packet Filter provides a solution for this situation, redirecting
FTP traffic through an FTP proxy server, a process which acts to "guide" your
FTP traffic through the filters.  The FTP proxy used by OpenBSD and PF is
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=ftp-proxy&amp;sektion=8&amp;manpath=OpenBSD+3.3">
ftp-proxy(8)</a>.  To activate it, put something like this in the NAT section
of <tt>/etc/pf.conf</tt> file:

<pre>
     rdr on tl0 from any to any port 21 -&gt; 127.0.0.1 port 8021
</pre>

Short explanation of this line is, "Traffic on the internal interface is
redirected to the proxy server running on this machine which is listening at
port 8021".
d99 1
a99 1
the OpenBSD box, this is done by inserting the following line in
d102 5
a106 3
<pre>
     127.0.0.1:8021 stream tcp nowait root /usr/libexec/ftp-proxy ftp-proxy
</pre>
d108 1
d110 2
a111 2
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=inetd&amp;sektion=8&amp;manpath=OpenBSD+3.3">
inetd(8)</a>.  One way to send the 'HUP' signal is with the command:
d113 5
a117 3
<pre>
    kill -HUP `cat /var/run/inetd.pid`
</pre>
d119 5
a123 3
You will note that ftp-proxy is listening on port 8021, the same port the above
rdr statement was sending FTP traffic to.  The choice of port 8021 is arbitrary,
though 8021 is a good choice, as it is not defined for any other application.
d126 1
a126 1
Please note that ftp-proxy(8) is to help <b>FTP clients</b> behind a PF filter,
d130 18
a147 12
<h2>PF "self-protecting" an FTP server</h2>
In this case, PF is running on the FTP server, rather than a separate
computer.  When servicing a passive FTP connection, FTP will use a random
high TCP port for incoming data.  By default, OpenBSD's native FTP server
ftpd(8) uses the range 49152 to 65535.  Obviously, these must be passed in,
along with port 21 (the FTP control port):

<pre>
     pass in on $EXT proto tcp from any to any port 21 keep state
     pass in on $EXT proto tcp from any to any port &gt; 49151 \
          keep state
</pre>
d149 1
d151 5
a155 2
considerably, in the case of the OpenBSD ftpd(8) program, that is done
using the sysctl(8) variables <tt>net.inet.ip.porthifirst</tt> and
d158 2
a159 1
<h2>FTP server protected by an external PF firewall running NAT</h2>
d163 2
a164 1
ftpd(8), using the default range of ports.
d168 13
a180 11
<pre>
     FTP="10.0.3.21"
     rdr on $EXT proto tcp from any to any port 21 -&gt; $FTP port 21
     rdr on $EXT proto tcp from any to any port 49152:65535 -&gt; \
         $FTP port 49152:65535

     ...
     pass in quick on $EXT proto TCP from any to any port 21 keep state
     pass in quick on $EXT proto TCP from any to any port &gt; 49151  \
         keep state
</pre>
d183 4
a186 1
More information on filtering FTP:
d194 1
a194 1
[<a href="example1.html">Next: Example Firewall For Home or Small 
d202 1
a202 1
<small>$OpenBSD: ftp.html,v 1.1 2003/05/01 01:46:06 nick Exp $</small>
@


1.1
log
@
The long awaited, new PF FAQ!
Most of it written by Joel Knight >enabled at myrealbox dot com<,
some parts by me, a few parts yanked out of the old PF FAQ.
GREAT work, Joel!
@
text
@d142 1
a142 1
         $WEB port 49152:65535
d167 1
a167 1
<small>$OpenBSD$</small>
@

