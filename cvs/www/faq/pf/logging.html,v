head	1.67;
access;
symbols;
locks; strict;
comment	@# @;


1.67
date	2016.09.19.23.44.47;	author tj;	state Exp;
branches;
next	1.66;
commitid	P53AgOpLKrOmgs5r;

1.66
date	2016.08.15.02.22.14;	author tb;	state Exp;
branches;
next	1.65;
commitid	3DeixV5YkPOb78RN;

1.65
date	2016.06.13.17.58.25;	author tj;	state Exp;
branches;
next	1.64;
commitid	Grx2UyJPWzJbbhkP;

1.64
date	2016.04.18.19.07.50;	author tj;	state Exp;
branches;
next	1.63;
commitid	g0cUF3jNn5Tz4oaZ;

1.63
date	2016.04.16.00.30.41;	author tj;	state Exp;
branches;
next	1.62;
commitid	rTxoenHHaeutOff1;

1.62
date	2016.04.15.20.39.49;	author tb;	state Exp;
branches;
next	1.61;
commitid	jwteSMEb4rFzI8UA;

1.61
date	2016.03.29.01.27.39;	author tb;	state Exp;
branches;
next	1.60;
commitid	4Y8oU6GBrSY1UOfW;

1.60
date	2016.03.27.19.52.09;	author sthen;	state Exp;
branches;
next	1.59;
commitid	hi2ObFv9LGB98JY5;

1.59
date	2016.03.22.10.56.56;	author sthen;	state Exp;
branches;
next	1.58;
commitid	G2izHhNJ7aqR0Y6j;

1.58
date	2016.03.21.05.46.21;	author beck;	state Exp;
branches;
next	1.57;
commitid	zEx6zFkNSFFExu0v;

1.57
date	2015.10.18.19.48.19;	author nick;	state Exp;
branches;
next	1.56;
commitid	gkrFWKimwWNVivXe;

1.56
date	2015.07.02.05.49.05;	author bentley;	state Exp;
branches;
next	1.55;
commitid	AP3UllesavMDEUhQ;

1.55
date	2015.05.11.11.18.30;	author sthen;	state Exp;
branches;
next	1.54;
commitid	wRrXxcro6dFYiwF8;

1.54
date	2015.04.30.23.48.01;	author nick;	state Exp;
branches;
next	1.53;
commitid	uFWv68UTtTmjkqVF;

1.53
date	2014.12.02.03.17.26;	author nick;	state Exp;
branches;
next	1.52;
commitid	RQ0cKiFD5x45dGyo;

1.52
date	2014.12.01.10.01.07;	author bentley;	state Exp;
branches;
next	1.51;
commitid	DtrOVs7q8kqgEsjm;

1.51
date	2014.05.01.15.03.50;	author nick;	state Exp;
branches;
next	1.50;

1.50
date	2014.03.31.02.33.07;	author nick;	state Exp;
branches;
next	1.49;

1.49
date	2013.11.01.14.07.06;	author nick;	state Exp;
branches;
next	1.48;

1.48
date	2013.05.01.13.21.45;	author nick;	state Exp;
branches;
next	1.47;

1.47
date	2012.11.01.15.06.36;	author nick;	state Exp;
branches;
next	1.46;

1.46
date	2012.05.11.11.20.04;	author nick;	state Exp;
branches;
next	1.45;

1.45
date	2011.11.02.01.01.47;	author nick;	state Exp;
branches;
next	1.44;

1.44
date	2011.07.14.00.58.02;	author nick;	state Exp;
branches;
next	1.43;

1.43
date	2011.05.01.12.57.11;	author nick;	state Exp;
branches;
next	1.42;

1.42
date	2010.11.01.09.53.51;	author nick;	state Exp;
branches;
next	1.41;

1.41
date	2010.07.15.00.22.22;	author sthen;	state Exp;
branches;
next	1.40;

1.40
date	2010.05.19.13.25.16;	author sthen;	state Exp;
branches;
next	1.39;

1.39
date	2010.04.01.23.33.59;	author jmc;	state Exp;
branches;
next	1.38;

1.38
date	2009.10.16.19.12.42;	author nick;	state Exp;
branches;
next	1.37;

1.37
date	2009.04.30.17.27.31;	author nick;	state Exp;
branches;
next	1.36;

1.36
date	2008.10.31.16.49.34;	author nick;	state Exp;
branches;
next	1.35;

1.35
date	2008.07.27.17.13.47;	author nick;	state Exp;
branches;
next	1.34;

1.34
date	2007.11.01.02.57.56;	author joel;	state Exp;
branches;
next	1.33;

1.33
date	2007.05.07.01.13.53;	author joel;	state Exp;
branches;
next	1.32;

1.32
date	2007.05.06.18.59.54;	author nick;	state Exp;
branches;
next	1.31;

1.31
date	2006.11.01.01.56.01;	author joel;	state Exp;
branches;
next	1.30;

1.30
date	2006.10.27.19.26.13;	author nick;	state Exp;
branches;
next	1.29;

1.29
date	2006.05.31.07.23.00;	author steven;	state Exp;
branches;
next	1.28;

1.28
date	2006.05.30.07.49.12;	author steven;	state Exp;
branches;
next	1.27;

1.27
date	2006.05.29.19.25.57;	author steven;	state Exp;
branches;
next	1.26;

1.26
date	2006.05.01.00.54.29;	author nick;	state Exp;
branches;
next	1.25;

1.25
date	2005.12.28.17.12.26;	author joel;	state Exp;
branches;
next	1.24;

1.24
date	2005.12.12.02.22.47;	author nick;	state Exp;
branches;
next	1.23;

1.23
date	2005.11.17.12.08.16;	author nick;	state Exp;
branches;
next	1.22;

1.22
date	2005.11.01.11.35.18;	author nick;	state Exp;
branches;
next	1.21;

1.21
date	2005.06.04.18.16.47;	author joel;	state Exp;
branches;
next	1.20;

1.20
date	2005.05.20.00.12.02;	author joel;	state Exp;
branches;
next	1.19;

1.19
date	2005.02.07.05.25.27;	author joel;	state Exp;
branches;
next	1.18;

1.18
date	2004.12.22.04.28.16;	author david;	state Exp;
branches;
next	1.17;

1.17
date	2004.12.17.21.46.19;	author nick;	state Exp;
branches;
next	1.16;

1.16
date	2004.10.29.17.22.57;	author nick;	state Exp;
branches;
next	1.15;

1.15
date	2004.05.07.01.55.23;	author nick;	state Exp;
branches;
next	1.14;

1.14
date	2004.04.30.18.00.25;	author nick;	state Exp;
branches;
next	1.13;

1.13
date	2004.01.01.04.16.17;	author nick;	state Exp;
branches;
next	1.12;

1.12
date	2003.12.30.21.58.01;	author nick;	state Exp;
branches;
next	1.11;

1.11
date	2003.11.30.23.18.06;	author nick;	state Exp;
branches;
next	1.10;

1.10
date	2003.11.28.04.09.45;	author nick;	state Exp;
branches;
next	1.9;

1.9
date	2003.11.09.23.29.02;	author nick;	state Exp;
branches;
next	1.8;

1.8
date	2003.09.22.02.29.03;	author nick;	state Exp;
branches;
next	1.7;

1.7
date	2003.09.16.01.23.49;	author nick;	state Exp;
branches;
next	1.6;

1.6
date	2003.07.03.14.01.08;	author nick;	state Exp;
branches;
next	1.5;

1.5
date	2003.06.30.12.53.07;	author nick;	state Exp;
branches;
next	1.4;

1.4
date	2003.06.13.02.54.08;	author nick;	state Exp;
branches;
next	1.3;

1.3
date	2003.05.15.03.03.54;	author nick;	state Exp;
branches;
next	1.2;

1.2
date	2003.05.01.14.20.37;	author nick;	state Exp;
branches;
next	1.1;

1.1
date	2003.05.01.01.46.06;	author nick;	state Exp;
branches;
next	;


desc
@@


1.67
log
@less "$ext_if" and more egress to simplify example rulesets.
zap some stray <p> tags while here.
@
text
@<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<html>
<head>

<!-- If you make edits to any FAQ documents, please start each sentence
     on a new line, and try to keep the general formatting consistent
     with the rest of the pages -->

<title>OpenBSD PF: Logging</title>
<meta http-equiv="Content-Type" content="text/html; charset=ISO-8859-1">
<meta name="viewport" content="width=device-width, initial-scale=1">
<link rel="stylesheet" type="text/css" href="../../openbsd.css">
<link rel="canonical" href="https://www.openbsd.org/faq/pf/logging.html">
</head>

<!--
Copyright (c) 2003, Nick Holland <nick@@openbsd.org>
Copyright (c) 2003-2007, Joel Knight <enabled@@myrealbox.com>

Permission to use, copy, modify, and distribute this documentation for
any purpose with or without fee is hereby granted, provided that the
above copyright notice and this permission notice appear in all copies.

THE DOCUMENTATION IS PROVIDED "AS IS" AND THE AUTHOR DISCLAIMS ALL
WARRANTIES WITH REGARD TO THIS DOCUMENTATION INCLUDING ALL IMPLIED
WARRANTIES OF MERCHANTABILITY AND FITNESS. IN NO EVENT SHALL THE
AUTHOR BE LIABLE FOR ANY SPECIAL, DIRECT, INDIRECT, OR CONSEQUENTIAL
DAMAGES OR ANY DAMAGES WHATSOEVER RESULTING FROM LOSS OF USE, DATA OR
PROFITS, WHETHER IN AN ACTION OF CONTRACT, NEGLIGENCE OR OTHER
TORTIOUS ACTION, ARISING OUT OF OR IN CONNECTION WITH THE USE OR
PERFORMANCE OF THIS DOCUMENTATION
-->

<body bgcolor="#ffffff" text="#000000">

<h2>
<a href="../../index.html">
<font color="#0000ff"><i>Open</i></font><font color="#000084">BSD</font></a>
<font color="#e00000">PF - Logging</font>
<small>
<a href="index.html" style="font-weight:normal; float:right">[Contents]</a>
</small>
</h2>
<hr>

<ul>
  <li><a href="#intro"   >Introduction</a>
  <li><a href="#log"     >Logging packets</a>
  <li><a href="#logfile" >Reading a log file</a>
  <li><a href="#filter"  >Filtering log output</a>
  <li><a href="#syslog"  >Packet logging through syslog</a>
</ul>

<hr>

<h2 id="intro">Introduction</h2>

When a packet is logged by PF, a copy of the packet header is sent to a
<a href="http://man.openbsd.org/pflog">pflog(4)</a> interface along with
some additional data such as the interface the packet was transiting, the
action that PF took (pass or block), etc.
The pflog(4) interface allows user-space applications to receive PF's
logging data from the kernel.
If PF is enabled when the system is booted, the
<a href="http://man.openbsd.org/pflogd">pflogd(8)</a> daemon is started.
By default, pflogd(8) listens on the <tt>pflog0</tt> interface and writes
all logged data to the <tt>/var/log/pflog</tt> file.

<h2 id="log">Logging packets</h2>

In order to log packets passing through PF, the <tt>log</tt> keyword must
be used.
The <tt>log</tt> keyword causes all packets that match the rule to be logged.
In the case where the rule is <a href="filter.html#state">creating state</a>,
only the first packet seen (the one that causes the state to be created) will
be logged.

<p>
The options that can be given to the <tt>log</tt> keyword are:

<dl>
<dt><tt>all</tt>
<dd>Causes all matching packets, not just the initial packet, to be logged.
    Useful for rules that create state.

<dt><tt>to <i>pflogN</i></tt>
<dd>Causes all matching packets to be logged to the specified pflog(4)
    interface.
    For example, when using
    <a href="http://man.openbsd.org/spamlogd">spamlogd(8)</a>, all SMTP traffic
    can be logged to a dedicated pflog(4) interface by PF.
    The spamlogd(8) daemon can then be told to listen on that interface.
    This keeps the main PF logfile clean of SMTP traffic which otherwise
    would not need to be logged.
    Use <a href="http://man.openbsd.org/ifconfig">ifconfig(8)</a> to create
    pflog(4) interfaces.
    The default log interface <tt>pflog0</tt> is created automatically.

<dt><tt>user</tt>
<dd>Causes the user id and group id that owns the socket that the packet is
    sourced from/destined to (whichever socket is local) to be logged along
    with the standard log information.
</dl>

Options are given in parenthesis after the <tt>log</tt> keyword; multiple
options can be separated by a comma or space.

<blockquote><pre>
pass in log (all, to pflog1) on egress inet proto tcp to egress port 22
</pre></blockquote>

<h2 id="logfile">Reading a log file</h2>

The log file written by pflogd is in binary format and cannot be read using
a text editor.
<a href="http://man.openbsd.org/tcpdump">tcpdump(8)</a> must be used instead.

<p>
To view the log file:

<blockquote><pre>
# <b>tcpdump -n -e -ttt -r /var/log/pflog</b>
</pre></blockquote>

Note that using tcpdump(8) to watch the pflog file does <i>not</i> give
a real-time display.
A real-time display of logged packets is achieved by using the <tt>pflog0</tt>
interface:

<blockquote><pre>
# <b>tcpdump -n -e -ttt -i pflog0</b>
</pre></blockquote>

<b>NOTE:</b> When examining the logs, special care should be taken with
tcpdump's verbose protocol decoding (activated via the <tt>-v</tt> command
line option).
tcpdump's protocol decoders do not have a perfect security history.
At least in theory, a delayed attack could be possible via the partial packet
payloads recorded by the logging device.
It is recommended practice to move the log files off of the firewall machine
before examining them in this way.

<p>
Additional care should also be taken to secure access to the logs.
By default, pflogd will record 160 bytes of the packet in the log file.
Access to the logs could provide partial access to sensitive packet payloads.

<h2 id="filter">Filtering log output</h2>

Because pflogd logs in tcpdump binary format, the full range of tcpdump
features can be used when reviewing the logs.
For example, to only see packets that match a certain port:

<blockquote><pre>
# <b>tcpdump -n -e -ttt -r /var/log/pflog port 80</b>
</pre></blockquote>

This can be further refined by limiting the display of packets to a certain
host and port combination:

<blockquote><pre>
# <b>tcpdump -n -e -ttt -r /var/log/pflog port 80 and host 192.168.1.3</b>
</pre></blockquote>

The same idea can be applied when reading from the <tt>pflog0</tt> interface:

<blockquote><pre>
# <b>tcpdump -n -e -ttt -i pflog0 host 192.168.4.2</b>
</pre></blockquote>

Note that this has no impact on which packets are logged to the pflogd
log file; the above commands only display packets as they are being logged.

<p>
In addition to using the standard
<a href="http://man.openbsd.org/tcpdump.8">tcpdump(8)</a> filter rules, the
tcpdump filter language has been extended for reading pflogd output:

<ul>
  <li><tt>ip</tt> - address family is IPv4.
  <li><tt>ip6</tt> - address family is IPv6.
  <li><tt>on <i>int</i></tt> - packet passed through the interface
      <i>int</i>.
  <li><tt>ifname <i>int</i></tt> - same as <tt>on <i>int</i></tt>.
  <li><tt>ruleset <i>name</i></tt> - the
      <a href="anchors.html">ruleset/anchor</a> that the packet was matched in.
  <li><tt>rulenum <i>num</i></tt> - the filter rule that the packet matched
      was rule number <i>num</i>.
  <li><tt>action <i>act</i></tt> - the action taken on the packet.
      Possible actions are <tt>pass</tt> and <tt>block</tt>.
  <li><tt>reason <i>res</i></tt> - the reason that <tt>action</tt> was taken.
      Possible reasons are <tt>match</tt>, <tt>bad-offset</tt>,
      <tt>fragment</tt>, <tt>short</tt>, <tt>normalize</tt>,
      <tt>memory</tt>, <tt>bad-timestamp</tt>, <tt>congestion</tt>,
      <tt>ip-option</tt>, <tt>proto-cksum</tt>, <tt>state-mismatch</tt>,
      <tt>state-insert</tt>, <tt>state-limit</tt>, <tt>src-limit</tt>
      and <tt>synproxy</tt>.
  <li><tt>inbound</tt> - packet was inbound.
  <li><tt>outbound</tt> - packet was outbound.
</ul>

Example:

<blockquote><pre>
# <b>tcpdump -n -e -ttt -i pflog0 inbound and action block and on wi0</b>
</pre></blockquote>

This display the log, in real-time, of inbound packets that were blocked
on the wi0 interface.

<h2 id="syslog">Packet logging through syslog</h2>

In many situations it is desirable to have the firewall logs available
in ASCII format and/or to send them to a remote logging server.
All this can be accomplished with a small shell script, some minor changes
of the OpenBSD configuration files, and
<a href="http://man.openbsd.org/syslogd">syslogd(8)</a>, the logging daemon.
syslogd logs in ASCII and is also able to log to a remote logging server.

<p>
Create the following script as <tt>/etc/pflogrotate</tt>.

<blockquote><pre>
#!/bin/sh
PFLOG=/var/log/pflog
FILE=/var/log/pflog5min.$(date "+%Y%m%d%H%M")

pkill -ALRM -u root -U root -t - -x pflogd
if [ -r $PFLOG ] && [ $(stat -f %z $PFLOG) -gt 24 ]; then
   mv $PFLOG $FILE
   pkill -HUP -u root -U root -t - -x pflogd
   tcpdump -n -e -s 160 -ttt -r $FILE | logger -t pf -p local0.info
   rm $FILE
fi
</pre></blockquote>

Edit root's cron table:

<blockquote><pre>
# <b>crontab -u root -e</b>
</pre></blockquote>

Add the following two lines:

<blockquote><pre>
# rotate pf log file every 5 minutes
0-59/5 *       *       *       *       /bin/sh /etc/pflogrotate
</pre></blockquote>

Add the following line to <tt>/etc/syslog.conf</tt>:

<blockquote><pre>
local0.info     /var/log/pflog.txt
</pre></blockquote>

If you also want to log to a remote log server, add the line:

<blockquote><pre>
local0.info     @@syslogger
</pre></blockquote>

Make sure host <i>syslogger</i> has been defined in the
<a href="http://man.openbsd.org/hosts">hosts(5)</a> file.

<p>
Create the file <tt>/var/log/pflog.txt</tt> to allow syslog to log to
that file, and give it the same permissions as the pflog file.

<blockquote><pre>
# <b>touch /var/log/pflog.txt</b>
# <b>chmod 600 /var/log/pflog.txt</b>
</pre></blockquote>

Make syslogd notice the changes by restarting it:

<blockquote><pre>
# <b>kill -HUP $(cat /var/run/syslog.pid)</b>
</pre></blockquote>

All logged packets are now sent to <tt>/var/log/pflog.txt</tt>.
If the second line is added, they are sent to the remote logging host
<i>syslogger</i> as well.

<p>
The script <tt>/etc/pflogrotate</tt> now processes and then deletes
<tt>/var/log/pflog</tt> so rotation of <tt>pflog</tt> by
<a href="http://man.openbsd.org/newsyslog">newsyslog(8)</a> is no longer
necessary and should be disabled.
However, <tt>/var/log/pflog.txt</tt> replaces <tt>/var/log/pflog</tt> and
rotation of it should be activated.
Change <tt>/etc/newsyslog.conf</tt> as follows:

<blockquote><pre>
#/var/log/pflog       600    3    250    *    ZB "pkill -HUP -u root -U root -t - -x pflogd"
/var/log/pflog.txt    600    7    *      24
</pre></blockquote>

PF will now log in ASCII to <tt>/var/log/pflog.txt</tt>.
If so configured in <tt>/etc/syslog.conf</tt>, it will also log to a remote
server.
The logging is not immediate but it can take up to about 5-6 minutes (the cron
job interval) before the logged packets appear in the file.

<p>
</body>
</html>
@


1.66
log
@tls on openbsd.org is now real:
- link to https://www.openbsd.org from the sub-projects' pages
- make internal links relative
- switch link rel=canonical to https to please some search engines
"go ahead" from beck, "do it!!!!" tj
@
text
@a104 1
<p>
d109 1
a109 1
pass in log (all, to pflog1) on $ext_if inet proto tcp to $ext_if port 22 keep state
a201 1
<p>
@


1.65
log
@sync pf guide formatting with the main faq's style, fixing a few grammar
knits and broken links along the way.

input and ok tb
@
text
@d13 1
a13 1
<link rel="canonical" href="http://www.openbsd.org/faq/pf/logging.html">
@


1.64
log
@page titles and <title> should be the same.
@
text
@d4 5
a10 1
<meta name="description"   content="the OpenBSD FAQ page">
d47 5
a51 5
<li><a href="#intro"  >Introduction</a>
<li><a href="#log"    >Logging Packets</a>
<li><a href="#logfile">Reading a Log File</a>
<li><a href="#filter" >Filtering Log Output</a>
<li><a href="#syslog" >Packet Logging Through Syslog</a>
d57 1
d59 3
a61 4
<a href="http://man.openbsd.org/pflog.4"
>pflog(4)</a> interface along with some additional data such as the
interface the packet was transiting, the action that PF took (pass or
block), etc.
d65 2
a66 3
<a href="http://man.openbsd.org/pflogd.8"
>pflogd(8)</a> daemon is started.
By default pflogd(8) listens on the <tt>pflog0</tt> interface and writes
d69 8
a76 9
<h2 id="log">Logging Packets</h2>
<p>
In order to log packets passing through PF, the <tt>log</tt> keyword
must be used.
The <tt>log</tt> keyword causes all packets that match the rule to be
logged.
In the case where the rule is <a href="filter.html#state">creating
state</a>, only the first packet seen (the one that causes the state to
be created) will be logged.
d83 2
a84 3
<dd>Causes all matching packets, not just the initial packet, to be
logged.
Useful for rules that create state.
d88 10
a97 12
interface.
For example, when using
<a href="http://man.openbsd.org/spamlogd.8"
>spamlogd(8)</a> all SMTP traffic can be logged to a dedicated pflog(4)
interface by PF.
The spamlogd(8) daemon can then be told to listen on that interface.
This keeps the main PF logfile clean of SMTP traffic which otherwise
would not need to be logged.
Use
<a href="http://man.openbsd.org/ifconfig.8"
>ifconfig(8)</a> to create pflog(4) interfaces.
The default log interface <tt>pflog0</tt> is created automatically.
d100 3
a102 3
<dd>Causes the UNIX user-id and group-id that owns the socket that the
packet is sourced from/destined to (whichever socket is local) to be
logged along with the standard log information.
d106 2
a107 2
Options are given in parenthesis after the <tt>log</tt> keyword;
multiple options can be separated by a comma or space.
d109 1
a109 2
<blockquote>
<tt>
d111 1
a111 2
</tt>
</blockquote>
d113 1
d115 3
a117 3
<h2 id="logfile">Reading a Log File</h2>
The log file written by pflogd is in binary format and cannot be read
using a text editor. Tcpdump must be used to view the log.
a120 5
<blockquote>
<tt>
# tcpdump -n -e -ttt -r /var/log/pflog
</tt>
</blockquote>
d122 4
a125 1
<p>
d127 3
a129 7
a real-time display. A real-time display of logged packets is achieved
by using the <tt>pflog0</tt> interface:
<blockquote>
<tt>
# tcpdump -n -e -ttt -i pflog0
</tt>
</blockquote>
d131 17
a147 9
<p>
<font color="#e00000">NOTE: </font>
When examining the logs, special care should be taken with 
tcpdump's verbose protocol decoding (activated via the 
<tt>-v</tt> command line option). Tcpdump's protocol decoders do not
have a perfect security history.  At least in theory, a delayed attack
could be possible via the partial packet payloads recorded by the
logging device. It is recommended practice to move the log files off of
the firewall machine before examining them in this way.
d149 1
a149 9
<p>
Additional care should also be taken to secure access to the logs. By default, 
pflogd will record 160 bytes of the packet in the log file.  Access
to the logs could provide partial access to sensitive packet payloads
(like
<a href="http://man.openbsd.org/telnet.1"
>telnet(1)</a> or
<a href="http://man.openbsd.org/ftp.1"
>ftp(1)</a> usernames and passwords).
a150 1
<h2 id="filter">Filtering Log Output</h2>
d152 2
a153 7
features can be used when reviewing the logs. For example, to only see
packets that match a certain port:
<blockquote>
<tt>
# tcpdump -n -e -ttt -r /var/log/pflog port 80
</tt>
</blockquote>
d155 12
a166 8
<p>
This can be further refined by limiting the display of packets to a 
certain host and port combination:
<blockquote>
<tt>
# tcpdump -n -e -ttt -r /var/log/pflog port 80 and host 192.168.1.3
</tt>
</blockquote>
d168 3
a170 8
<p>
The same idea can be applied when reading from the <tt>pflog0</tt>
interface:
<blockquote>
<tt>
# tcpdump -n -e -ttt -i pflog0 host 192.168.4.2
</tt>
</blockquote>
a171 1
<p>
d173 1
a173 2
log file; the above commands only display packets as they are being
logged.
d176 4
a179 4
In addition to using the standard 
<a href="http://man.openbsd.org/tcpdump.8"
>tcpdump(8)</a> filter rules, the tcpdump filter language has been
extended for reading pflogd output:
d181 20
a200 21
<li><tt>ip</tt> - address family is IPv4.
<li><tt>ip6</tt> - address family is IPv6.
<li><tt>on <i>int</i></tt> - packet passed through the interface
<i>int</i>.
<li><tt>ifname <i>int</i></tt> - same as <tt>on <i>int</i></tt>.
<li><tt>ruleset <i>name</i></tt> - the 
<a href="anchors.html">ruleset/anchor</a> that the packet was matched
in.
<li><tt>rulenum <i>num</i></tt> - the filter rule that the packet matched
was rule number <i>num</i>.
<li><tt>action <i>act</i></tt> - the action taken on the packet.
Possible actions are <tt>pass</tt> and <tt>block</tt>.
<li><tt>reason <i>res</i></tt> - the reason that <tt>action</tt> was 
taken. Possible reasons are <tt>match</tt>, <tt>bad-offset</tt>,
<tt>fragment</tt>, <tt>short</tt>, <tt>normalize</tt>,
<tt>memory</tt>, <tt>bad-timestamp</tt>,
<tt>congestion</tt>, <tt>ip-option</tt>, <tt>proto-cksum</tt>,
<tt>state-mismatch</tt>, <tt>state-insert</tt>, <tt>state-limit</tt>,
<tt>src-limit</tt>, and <tt>synproxy</tt>.
<li><tt>inbound</tt> - packet was inbound.
<li><tt>outbound</tt> - packet was outbound.
a204 5
<blockquote>
<tt>
# tcpdump -n -e -ttt -i pflog0 inbound and action block and on wi0
</tt>
</blockquote>
d206 4
a209 1
<p>
d213 2
a214 1
<h2 id="syslog">Packet Logging Through Syslog</h2>
d216 28
a243 6
in ASCII format and/or to send them to a remote logging server.  All
this can be accomplished with a small shell script, some minor
changes of the OpenBSD configuration files, and 
<a href="http://man.openbsd.org/syslogd.8"
>syslogd(8)</a>, the logging daemon. Syslogd logs in ASCII and
is also able to log to a remote logging server.
d245 1
a245 17
<p>
Create the following script:

<p>
<tt>/etc/pflogrotate</tt>
<pre>
	#!/bin/sh
	PFLOG=/var/log/pflog
	FILE=/var/log/pflog5min.$(date "+%Y%m%d%H%M")
	pkill -ALRM -u root -U root -t - -x pflogd
	if [ -r $PFLOG ] && [ $(stat -f %z $PFLOG) -gt 24 ]; then
	   mv $PFLOG $FILE
	   pkill -HUP -u root -U root -t - -x pflogd
	   tcpdump -n -e -s 160 -ttt -r $FILE | logger -t pf -p local0.info
	   rm $FILE
	fi
</pre>
d247 2
a248 13
<p>
Edit root's cron job:
<blockquote>
<tt>
# crontab -u root -e
</tt>
</blockquote>

<p>
Add the following two lines:
<blockquote>
<tt>
# rotate pf log file every 5 minutes<br>
d250 1
a250 2
</tt>
</blockquote>
a251 1
<p>
a252 5
<blockquote>
<tt>
local0.info &nbsp;&nbsp;&nbsp;&nbsp;/var/log/pflog.txt
</tt>
</blockquote>
d254 4
a257 1
<p>
a258 5
<blockquote>
<tt>
local0.info &nbsp;&nbsp;&nbsp;&nbsp;@@syslogger
</tt>
</blockquote>
d260 4
a263 1
<p>
d265 1
a265 2
<a href="http://man.openbsd.org/hosts.5"
>hosts(5)</a> file.
a269 6
<blockquote>
<tt>
# touch /var/log/pflog.txt<br>
# chmod 600 /var/log/pflog.txt
</tt>
</blockquote>
d271 5
a275 1
<p>
a276 5
<blockquote>
<tt>
# kill -HUP $(cat /var/run/syslog.pid)
</tt>
</blockquote>
d278 4
a281 1
<p>
d283 1
a283 1
If the second line is added they are sent to the remote logging host
d289 4
a292 4
<a href="http://man.openbsd.org/newsyslog.8"
>newsyslog(8)</a> is no longer necessary and should be
disabled. However, <tt>/var/log/pflog.txt</tt> replaces
<tt>/var/log/pflog</tt> and rotation of it should be activated.
a293 4
<pre>
    #/var/log/pflog       600    3    250    *    ZB "pkill -HUP -u root -U root -t - -x pflogd"
    /var/log/pflog.txt    600    7    *      24
</pre>
d295 10
a304 6
<p>
PF will now log in ASCII to <tt>/var/log/pflog.txt</tt>. If so 
configured in <tt>/etc/syslog.conf</tt>, it will also log to a remote
server.  The logging is not immediate but it can take up to about 5-6
minutes (the cron job interval) before the logged packets appear in the
file.
d308 1
a308 1
</html> 
@


1.63
log
@tweak [faq index] button and sync the pf user's guide with that style.
@
text
@d4 1
a4 1
<title>PF - Logging</title>
@


1.62
log
@use short form man links in the faq and fix a few broken links
@
text
@a30 2
<!-- Passes validator.w3.org, please keep it this way;
please, use a max of 72 chars per line -->
d36 3
a40 5
<p>
[<a href="index.html">Contents</a>]
[<a href="tagging.html">Previous: Packet Tagging</a>]
[<a href="perf.html">Next: Performance</a>]
<p>
a41 1
<h3>Table of Contents</h3>
d43 2
a44 2
<li><a href="#intro">Introduction</a>
<li><a href="#log">Logging Packets</a>
d46 2
a47 2
<li><a href="#filter">Filtering Log Output</a>
<li><a href="#syslog">Packet Logging Through Syslog</a>
a339 5

<p>
[<a href="tagging.html">Previous: Packet Tagging</a>]
[<a href="index.html">Contents</a>]
[<a href="perf.html">Next: Performance</a>]
@


1.61
log
@new openbsd faq style. joint with tj and validator.w3.org
@
text
@d59 1
a59 1
<a href="http://man.openbsd.org/?query=pflog&amp;sektion=4"
d66 1
a66 1
<a href="http://man.openbsd.org/?query=pflogd&amp;sektion=8"
d94 1
a94 1
<a href="http://man.openbsd.org/?query=spamlogd&amp;sektion=8"
d101 1
a101 1
<a href="http://man.openbsd.org/?query=ifconfig&amp;sektion=8"
d159 1
a159 1
<a href="http://man.openbsd.org/?query=telnet&amp;sektion=1"
d161 1
a161 1
<a href="http://man.openbsd.org/?query=ftp&amp;sektion=1"
d199 1
a199 1
<a href="http://man.openbsd.org/?query=tcpdump&amp;sektion=8"
d243 1
a243 1
<a href="http://man.openbsd.org/?query=syslogd&amp;sektion=8"
d300 1
a300 1
<a href="http://man.openbsd.org/?query=hosts&amp;sektion=5"
d329 1
a329 1
<a href="http://man.openbsd.org/?query=newsyslog&amp;sektion=8"
@


1.60
log
@add a small sprinkling of css to improve readability in the faq, ok tj@@ tb@@
@
text
@d4 1
a4 1
<title>PF: Logging</title>
d34 1
d36 4
a39 2
<img alt="[OpenBSD]" height=30 width=141 src="../../images/smalltitle.gif" border="0">
</a>
d41 1
a42 1
[<a href="index.html">Contents</a>]
a43 1

a44 3
<h1><font color="#e00000">PF: Logging</font></h1>

<hr>
@


1.59
log
@fix URIs, the / before querystring is not optional,
if not fixed up by browsers the server returns 400 Bad Request.
@
text
@d7 2
@


1.58
log
@change http://www.openbsd.org/cgi-bin/man.cgi to be http://man.openbsd.org
this points stuff to the new place and gets us ready to deprecate the old
place we did this.
@
text
@d58 1
a58 1
<a href="http://man.openbsd.org?query=pflog&amp;sektion=4"
d65 1
a65 1
<a href="http://man.openbsd.org?query=pflogd&amp;sektion=8"
d93 1
a93 1
<a href="http://man.openbsd.org?query=spamlogd&amp;sektion=8"
d100 1
a100 1
<a href="http://man.openbsd.org?query=ifconfig&amp;sektion=8"
d158 1
a158 1
<a href="http://man.openbsd.org?query=telnet&amp;sektion=1"
d160 1
a160 1
<a href="http://man.openbsd.org?query=ftp&amp;sektion=1"
d198 1
a198 1
<a href="http://man.openbsd.org?query=tcpdump&amp;sektion=8"
d242 1
a242 1
<a href="http://man.openbsd.org?query=syslogd&amp;sektion=8"
d299 1
a299 1
<a href="http://man.openbsd.org?query=hosts&amp;sektion=5"
d328 1
a328 1
<a href="http://man.openbsd.org?query=newsyslog&amp;sektion=8"
@


1.57
log
@
rev for 5.8, mostly removing manpath part of man page urls
@
text
@d58 1
a58 1
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=pflog&amp;sektion=4"
d65 1
a65 1
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=pflogd&amp;sektion=8"
d93 1
a93 1
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=spamlogd&amp;sektion=8"
d100 1
a100 1
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=ifconfig&amp;sektion=8"
d158 1
a158 1
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=telnet&amp;sektion=1"
d160 1
a160 1
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=ftp&amp;sektion=1"
d198 1
a198 1
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=tcpdump&amp;sektion=8"
d242 1
a242 1
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=syslogd&amp;sektion=8"
d299 1
a299 1
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=hosts&amp;sektion=5"
d328 1
a328 1
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=newsyslog&amp;sektion=8"
@


1.56
log
@Clean up meta tags.

name=distribution, name=keywords, and name=resource-type have no effect
in modern search engines and just clutter up the page source.

From Pavel Plamenov.
@
text
@d58 1
a58 1
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=pflog&amp;sektion=4&amp;manpath=OpenBSD+5.7"
d65 1
a65 1
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=pflogd&amp;sektion=8&amp;manpath=OpenBSD+5.7"
@


1.55
log
@Add 'link rel="canonical"' to pages, acting as a hint to search engines
to list the copies on www.openbsd.org rather than mirrors.

From Carlin Bingham, ok millert@@ nick@@
@
text
@a5 1
<meta name="resource-type" content="document">
a6 2
<meta name="keywords"      content="openbsd,faq,pf">
<meta name="distribution"  content="global">
@


1.54
log
@
updates for 5.7
@
text
@d10 1
@


1.53
log
@
5.5->5.6 which I forgot and Jonathan Thornburg (jthorn at astro dot
indiana dot edu) reminded me of, but also sent a diff for, thanks!
@
text
@d60 1
a60 1
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=pflog&amp;sektion=4&amp;manpath=OpenBSD+5.6"
d67 1
a67 1
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=pflogd&amp;sektion=8&amp;manpath=OpenBSD+5.6"
@


1.52
log
@Convert the pf faq to use id="" instead of "a name=""></a>.
@
text
@d60 1
a60 1
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=pflog&amp;sektion=4&amp;manpath=OpenBSD+5.5"
d67 1
a67 1
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=pflogd&amp;sektion=8&amp;manpath=OpenBSD+5.5"
@


1.51
log
@
update for 5.5
@
text
@d58 1
a58 2
<a name="intro"></a>
<h2>Introduction</h2>
d72 1
a72 2
<a name="log"></a>
<h2>Logging Packets</h2>
d123 1
a123 2
<a name="logfile"></a>
<h2>Reading a Log File</h2>
d165 1
a165 2
<a name="filter"></a>
<h2>Filtering Log Output</h2>
d239 1
a239 2
<a name="syslog"></a>
<h2>Packet Logging Through Syslog</h2>
@


1.50
log
@
www@@ removal, normalize footers.
@
text
@d61 1
a61 1
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=pflog&amp;sektion=4&amp;manpath=OpenBSD+5.4"
d68 1
a68 1
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=pflogd&amp;sektion=8&amp;manpath=OpenBSD+5.4"
@


1.49
log
@
update for 5.4
@
text
@a4 1
<link rev="made" href="mailto:www@@openbsd.org">
a357 6
<hr>
<a href="index.html"><img height="24" width="24" src="../../images/back.gif" border="0" alt="[back]"></a> 
<a href="mailto:www@@openbsd.org">www@@openbsd.org</a>
<br>
<small>$OpenBSD: logging.html,v 1.48 2013/05/01 13:21:45 nick Exp $</small>

@


1.48
log
@
updates for 5.3
@
text
@d62 1
a62 1
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=pflog&amp;sektion=4&amp;manpath=OpenBSD+5.3"
d69 1
a69 1
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=pflogd&amp;sektion=8&amp;manpath=OpenBSD+5.3"
d363 1
a363 1
<small>$OpenBSD: logging.html,v 1.47 2012/11/01 15:06:36 nick Exp $</small>
@


1.47
log
@
enter 5.2
@
text
@d62 1
a62 1
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=pflog&amp;sektion=4&amp;manpath=OpenBSD+5.2"
d69 1
a69 1
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=pflogd&amp;sektion=8&amp;manpath=OpenBSD+5.2"
d363 1
a363 1
<small>$OpenBSD: logging.html,v 1.46 2012/05/11 11:20:04 nick Exp $</small>
@


1.46
log
@
forgot to actually COMMIT these 5.1 changes.  *sigh*
@
text
@d62 1
a62 1
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=pflog&amp;sektion=4&amp;manpath=OpenBSD+5.1"
d69 1
a69 1
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=pflogd&amp;sektion=8&amp;manpath=OpenBSD+5.1"
d363 1
a363 1
<small>$OpenBSD: logging.html,v 1.45 2011/11/02 01:01:47 nick Exp $</small>
@


1.45
log
@
rev man page references to 5.0
@
text
@d62 1
a62 1
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=pflog&amp;sektion=4&amp;manpath=OpenBSD+5.0"
d69 1
a69 1
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=pflogd&amp;sektion=8&amp;manpath=OpenBSD+5.0"
d363 1
a363 1
<small>$OpenBSD: logging.html,v 1.44 2011/07/14 00:58:02 nick Exp $</small>
@


1.44
log
@
Update from Joel Knight, once known as joel@@
@
text
@d62 1
a62 1
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=pflog&amp;sektion=4&amp;manpath=OpenBSD+4.9"
d69 1
a69 1
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=pflogd&amp;sektion=8&amp;manpath=OpenBSD+4.9"
d363 1
a363 1
<small>$OpenBSD: logging.html,v 1.43 2011/05/01 12:57:11 nick Exp $</small>
@


1.43
log
@
updates for 4.9
@
text
@d161 1
a161 1
pflogd will record 96 bytes of the packet in the log file.  Access
d267 1
a267 1
	   tcpdump -n -e -ttt -r $FILE | logger -t pf -p local0.info
d363 1
a363 1
<small>$OpenBSD: logging.html,v 1.42 2010/11/01 09:53:51 nick Exp $</small>
@


1.42
log
@
update to 4.8
@
text
@d62 1
a62 1
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=pflog&amp;sektion=4&amp;manpath=OpenBSD+4.8"
d69 1
a69 1
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=pflogd&amp;sektion=8&amp;manpath=OpenBSD+4.8"
d363 1
a363 1
<small>$OpenBSD: logging.html,v 1.41 2010/07/15 00:22:22 sthen Exp $</small>
@


1.41
log
@Adapt example script now that pflogd.pid is no more.
From Lars Toft Jacobsen on www@@, thanks!
@
text
@d62 1
a62 1
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=pflog&amp;sektion=4&amp;manpath=OpenBSD+4.7"
d69 1
a69 1
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=pflogd&amp;sektion=8&amp;manpath=OpenBSD+4.7"
d363 1
a363 1
<small>$OpenBSD: logging.html,v 1.40 2010/05/19 13:25:16 sthen Exp $</small>
@


1.40
log
@Update the PF faq for 4.7 changes.
@
text
@d263 1
a263 1
	kill -ALRM $(cat /var/run/pflogd.pid)
d266 1
a266 1
	   kill -HUP $(cat /var/run/pflogd.pid)
d363 1
a363 1
<small>$OpenBSD: logging.html,v 1.39 2010/04/01 23:33:59 jmc Exp $</small>
@


1.39
log
@remove an inaccuracy; from Rene Maroufi
ok henning nick sthen
@
text
@d62 1
a62 1
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=pflog&amp;sektion=4&amp;manpath=OpenBSD+4.6"
d69 1
a69 1
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=pflogd&amp;sektion=8&amp;manpath=OpenBSD+4.6"
d342 1
a342 1
    #/var/log/pflog       600    3    250    *    ZB /var/run/pflogd.pid
d363 1
a363 1
<small>$OpenBSD: logging.html,v 1.38 2009/10/16 19:12:42 nick Exp $</small>
@


1.38
log
@
quick update for 4.6.  much more is needed, at least scrub.html is
currently dead wrong, so I've unlinked it from the rest for now.
@
text
@d78 1
a78 6
must be used within <a href="nat.html">NAT/rdr</a> and
<a href="filter.html">filter</a> rules.
Note that PF can only log packets that it's blocking or passing; you
cannot specify a rule that only logs packets.

<p>
d363 1
a363 1
<small>$OpenBSD: logging.html,v 1.37 2009/04/30 17:27:31 nick Exp $</small>
@


1.37
log
@
updates for 4.5
@
text
@d62 1
a62 1
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=pflog&amp;sektion=4&amp;manpath=OpenBSD+4.5"
d69 1
a69 1
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=pflogd&amp;sektion=8&amp;manpath=OpenBSD+4.5"
d368 1
a368 1
<small>$OpenBSD: logging.html,v 1.36 2008/10/31 16:49:34 nick Exp $</small>
@


1.36
log
@
update numbers for 4.4
@
text
@d62 1
a62 1
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=pflog&amp;sektion=4&amp;manpath=OpenBSD+4.4"
d69 1
a69 1
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=pflogd&amp;sektion=8&amp;manpath=OpenBSD+4.4"
d368 1
a368 1
<small>$OpenBSD: logging.html,v 1.35 2008/07/27 17:13:47 nick Exp $</small>
@


1.35
log
@
PF updates for 4.3..which got missed a few times.
@
text
@d62 1
a62 1
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=pflog&amp;sektion=4&amp;manpath=OpenBSD+4.3"
d69 1
a69 1
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=pflogd&amp;sektion=8&amp;manpath=OpenBSD+4.3"
d368 1
a368 1
<small>$OpenBSD: logging.html,v 1.34 2007/11/01 02:57:56 joel Exp $</small>
@


1.34
log
@Updates for OpenBSD 4.2
@
text
@d62 1
a62 1
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=pflog&amp;sektion=4&amp;manpath=OpenBSD+4.2"
d69 1
a69 1
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=pflogd&amp;sektion=8&amp;manpath=OpenBSD+4.2"
d368 1
a368 1
<small>$OpenBSD: logging.html,v 1.33 2007/05/07 01:13:53 joel Exp $</small>
@


1.33
log
@Updates for OpenBSD 4.1
@
text
@d62 1
a62 1
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=pflog&amp;sektion=4&amp;manpath=OpenBSD+4.1"
d69 1
a69 1
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=pflogd&amp;sektion=8&amp;manpath=OpenBSD+4.1"
d368 1
a368 1
<small>$OpenBSD: logging.html,v 1.32 2007/05/06 18:59:54 nick Exp $</small>
@


1.32
log
@
manpath changes to:
  4.1 for PF related items
  removed for non-PF-related items, which will probably either not
    change much, or benefit from the newest, best man pages.
@
text
@d15 1
a15 1
Copyright (c) 2003-2005, Joel Knight <enabled@@myrealbox.com>
d61 8
a68 1
Packet logging in PF is done by
d70 3
a72 8
>pflogd(8)</a> which listens on the
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=pflog&amp;sektion=4&amp;manpath=OpenBSD+4.1"
><tt>pflog0</tt></a> interface and writes packets to a log file (normally
/var/log/pflog) in 
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=tcpdump&amp;sektion=8"
>tcpdump(8)</a> binary format. <a href="filter.html">Filter</a> rules
that specify the <tt>log</tt> or <tt>log (all)</tt> keyword are logged in
this manner.
d99 15
d126 1
a126 1
pass in log (all) on $ext_if inet proto tcp to $ext_if port 22 keep state
a129 2
<p>
Log all incoming packets destined to port 22.
d368 1
a368 1
<small>$OpenBSD: logging.html,v 1.31 2006/11/01 01:56:01 joel Exp $</small>
@


1.31
log
@Updates for OpenBSD 4.0. uRPF, tftp-proxy, more ftp-proxy, etc.
Thanks to mcbride for the bits about interface groups
@
text
@d62 1
a62 1
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=pflogd&amp;sektion=8&amp;manpath=OpenBSD+4.0"
d64 1
a64 1
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=pflog&amp;sektion=4&amp;manpath=OpenBSD+4.0"
d67 1
a67 1
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=tcpdump&amp;sektion=8&amp;manpath=OpenBSD+4.0"
d154 1
a154 1
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=telnet&amp;sektion=1&amp;manpath=OpenBSD+4.0"
d156 1
a156 1
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=ftp&amp;sektion=1&amp;manpath=OpenBSD+4.0"
d195 1
a195 1
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=tcpdump&amp;sektion=8&amp;manpath=OpenBSD+4.0"
d240 1
a240 1
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=syslogd&amp;sektion=8&amp;manpath=OpenBSD+4.0"
d297 1
a297 1
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=hosts&amp;sektion=5&amp;manpath=OpenBSD+4.0"
d326 1
a326 1
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=newsyslog&amp;sektion=8&amp;manpath=OpenBSD+4.0"
d353 1
a353 1
<small>$OpenBSD: logging.html,v 1.30 2006/10/27 19:26:13 nick Exp $</small>
@


1.30
log
@
"tweaks and fixes" from Jeremy Reed, via Joel@@.  Committed at request
of joel@@
@
text
@d62 1
a62 1
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=pflogd&amp;sektion=8&amp;manpath=OpenBSD+3.9"
d64 1
a64 1
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=pflog&amp;sektion=4&amp;manpath=OpenBSD+3.9"
d67 1
a67 1
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=tcpdump&amp;sektion=8&amp;manpath=OpenBSD+3.9"
d154 1
a154 1
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=telnet&amp;sektion=1&amp;manpath=OpenBSD+3.9"
d156 1
a156 1
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=ftp&amp;sektion=1&amp;manpath=OpenBSD+3.9"
d195 1
a195 1
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=tcpdump&amp;sektion=8&amp;manpath=OpenBSD+3.9"
d240 1
a240 1
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=syslogd&amp;sektion=8&amp;manpath=OpenBSD+3.9"
d297 1
a297 1
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=hosts&amp;sektion=5&amp;manpath=OpenBSD+3.9"
d326 1
a326 1
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=newsyslog&amp;sektion=8&amp;manpath=OpenBSD+3.9"
d353 1
a353 1
<small>$OpenBSD: logging.html,v 1.29 2006/05/31 07:23:00 steven Exp $</small>
@


1.29
log
@in the pflogrotate script, check existence of the pflog file before running
stat(1) on it.

suggestion from Daniel Polak <daniel at sys.nl>
@
text
@d196 1
a196 1
>tcpdump(8)</a> filter rules, OpenBSD's tcpdump filter language has been
d353 1
a353 1
<small>$OpenBSD: logging.html,v 1.28 2006/05/30 07:49:12 steven Exp $</small>
@


1.28
log
@new command on new line. thanks, Antoine Jacoutot.
@
text
@d245 1
a245 1
First we create the following script:
d251 1
d254 2
a255 2
	if [ $(stat -f %z /var/log/pflog) -gt 24 ]; then
	   mv /var/log/pflog $FILE
d353 1
a353 1
<small>$OpenBSD: logging.html,v 1.27 2006/05/29 19:25:57 steven Exp $</small>
@


1.27
log
@Make "packet logging through syslog" much simpler using only one script,
run by root, which is required to run tcpdump (so it will run privilege
separated). Better permissions for pflog.txt while here.

based on suggestion from Daniel Polak <daniel at sys.nl>

ok henning@@ nick@@
@
text
@d304 1
a304 1
# touch /var/log/pflog.txt
d352 1
a352 1
<small>$OpenBSD: logging.html,v 1.26 2006/05/01 00:54:29 nick Exp $</small>
@


1.26
log
@
3.9 updates, mostly rev'ing man page links
@
text
@d238 1
a238 1
this can be accomplished with two small shell scripts, some minor
d245 1
a245 8
First we have to create a user, <tt>pflogger</tt>, with a
<tt>/sbin/nologin</tt> shell. The easiest way to create this user is with
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=adduser&amp;sektion=8&amp;manpath=OpenBSD+3.9"
>adduser(8)</a>.

<p>
After creating the user <tt>pflogger</tt>, create the following two
scripts:
d251 1
a251 1
	FILE=/home/pflogger/pflog5min.$(date "+%Y%m%d%H%M")
d253 1
a253 1
	if [ $(ls -l /var/log/pflog | cut -d " " -f 8) -gt 24 ]; then
a254 1
	   chown pflogger $FILE
d256 2
a257 17
	fi
</pre>

<p>
<tt>/home/pflogger/pfl2sysl</tt>
<pre>
	#!/bin/sh
	# feed rotated pflog file(s) to syslog
	# do not start if another instance of this script is already running
	pgrep pfl2sysl >/dev/null 2>&1
	if [ $? -ne 0 ] ; then
		for logfile in /home/pflogger/pflog5min* ; do
			if [ -f "$logfile" ] ; then
				tcpdump -n -e -ttt -r $logfile | logger -t pf -p local0.info
				rm $logfile
			fi
		done
a278 17
Create a cron job for user <tt>pflogger</tt>:
<blockquote>
<tt>
# crontab -u pflogger -e
</tt>
</blockquote>

<p>
Add the following two lines:
<blockquote>
<tt>
# feed rotated pflog file(s) to syslog<br>
0-59/5 *       *       *       *       /bin/sh /home/pflogger/pfl2sysl
</tt>
</blockquote>

<p>
d301 1
a301 1
that file.
d305 1
d352 1
a352 1
<small>$OpenBSD: logging.html,v 1.25 2005/12/28 17:12:26 joel Exp $</small>
@


1.25
log
@New subsection explaining how the "log" keyword works and the options
that it will take.
@
text
@d62 1
a62 1
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=pflogd&amp;sektion=8&amp;manpath=OpenBSD+3.8"
d64 1
a64 1
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=pflog&amp;sektion=4&amp;manpath=OpenBSD+3.8"
d67 1
a67 1
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=tcpdump&amp;sektion=8&amp;manpath=OpenBSD+3.8"
d154 1
a154 1
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=telnet&amp;sektion=1&amp;manpath=OpenBSD+3.8"
d156 1
a156 1
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=ftp&amp;sektion=1&amp;manpath=OpenBSD+3.8"
d195 1
a195 1
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=tcpdump&amp;sektion=8&amp;manpath=OpenBSD+3.8"
d240 1
a240 1
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=syslogd&amp;sektion=8&amp;manpath=OpenBSD+3.8"
d247 1
a247 1
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=adduser&amp;sektion=8&amp;manpath=OpenBSD+3.8"
d336 1
a336 1
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=hosts&amp;sektion=5&amp;manpath=OpenBSD+3.8"
d364 1
a364 1
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=newsyslog&amp;sektion=8&amp;manpath=OpenBSD+3.8"
d391 1
a391 1
<small>$OpenBSD: logging.html,v 1.24 2005/12/12 02:22:47 nick Exp $</small>
@


1.24
log
@
"log-all" is gone, now "log (all)".
From Tamas Tevesz (ice at extreme dot hu) via www@@, thanks!
@
text
@d51 1
d72 44
d391 1
a391 1
<small>$OpenBSD: logging.html,v 1.23 2005/11/17 12:08:16 nick Exp $</small>
@


1.23
log
@
"The diff corrects a sitation where multiple instances of the script
pfl2sysl would be started in error.  This would occur if the previous
run pfl2sysl had not yet finished (due to a very large log file)."
From Daniel Polak (daniel at sys dot nl), thanks!  ok dhartmei@@
@
text
@d68 1
a68 1
that specify the <tt>log</tt> or <tt>log-all</tt> keyword are logged in
d346 1
a346 1
<small>$OpenBSD: logging.html,v 1.22 2005/11/01 11:35:18 nick Exp $</small>
@


1.22
log
@
bump manpath= tag for 3.8
@
text
@d212 1
d225 12
a236 6
	for logfile in /home/pflogger/pflog5min* ; do
	   if [ -s "$logfile" ]; then
	      tcpdump -n -e -ttt -r $logfile | logger -t pf -p local0.info
	      rm $logfile
	   fi
	done
d332 1
a332 1
server.  The logging is not immediate but can take up to about 5-6
d346 1
a346 1
<small>$OpenBSD: logging.html,v 1.21 2005/06/04 18:16:47 joel Exp $</small>
@


1.21
log
@Mention "ruleset" log filter
@
text
@d61 1
a61 1
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=pflogd&amp;sektion=8&amp;manpath=OpenBSD+3.7"
d63 1
a63 1
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=pflog&amp;sektion=4&amp;manpath=OpenBSD+3.7"
d66 1
a66 1
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=tcpdump&amp;sektion=8&amp;manpath=OpenBSD+3.7"
d109 1
a109 1
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=telnet&amp;sektion=1&amp;manpath=OpenBSD+3.7"
d111 1
a111 1
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=ftp&amp;sektion=1&amp;manpath=OpenBSD+3.7"
d150 1
a150 1
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=tcpdump&amp;sektion=8&amp;manpath=OpenBSD+3.7"
d195 1
a195 1
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=syslogd&amp;sektion=8&amp;manpath=OpenBSD+3.7"
d202 1
a202 1
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=adduser&amp;sektion=8&amp;manpath=OpenBSD+3.7"
d284 1
a284 1
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=hosts&amp;sektion=5&amp;manpath=OpenBSD+3.7"
d312 1
a312 1
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=newsyslog&amp;sektion=8&amp;manpath=OpenBSD+3.7"
d339 1
a339 1
<small>$OpenBSD: logging.html,v 1.20 2005/05/20 00:12:02 joel Exp $</small>
@


1.20
log
@Updates for OpenBSD 3.7.
@
text
@d159 3
d339 1
a339 1
<small>$OpenBSD: logging.html,v 1.19 2005/02/07 05:25:27 joel Exp $</small>
@


1.19
log
@Mention the "bad-timestamp" logging reason. Adjust copyright date while
here.

ok nick@@
@
text
@d61 1
a61 1
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=pflogd&amp;sektion=8&amp;manpath=OpenBSD+3.6"
d63 1
a63 1
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=pflog&amp;sektion=4&amp;manpath=OpenBSD+3.6"
d66 1
a66 1
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=tcpdump&amp;sektion=8&amp;manpath=OpenBSD+3.6"
d109 1
a109 1
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=telnet&amp;sektion=1&amp;manpath=OpenBSD+3.6"
d111 1
a111 1
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=ftp&amp;sektion=1&amp;manpath=OpenBSD+3.6"
d150 1
a150 1
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=tcpdump&amp;sektion=8&amp;manpath=OpenBSD+3.6"
d166 4
a169 1
<tt>memory</tt>, and <tt>bad-timestamp</tt>.
d192 1
a192 1
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=syslogd&amp;sektion=8&amp;manpath=OpenBSD+3.6"
d199 1
a199 1
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=adduser&amp;sektion=8&amp;manpath=OpenBSD+3.6"
d281 1
a281 1
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=hosts&amp;sektion=5&amp;manpath=OpenBSD+3.6"
d309 1
a309 1
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=newsyslog&amp;sektion=8&amp;manpath=OpenBSD+3.6"
d336 1
a336 1
<small>$OpenBSD: logging.html,v 1.18 2004/12/22 04:28:16 david Exp $</small>
@


1.18
log
@make small title logo a link back to main page; ok nick@@
@
text
@d15 1
a15 1
Copyright (c) 2003, 2004, Joel Knight <enabled@@myrealbox.com>
d165 2
a166 2
<tt>fragment</tt>, <tt>short</tt>, <tt>normalize</tt>, and 
<tt>memory</tt>.
d333 1
a333 1
<small>$OpenBSD: logging.html,v 1.17 2004/12/17 21:46:19 nick Exp $</small>
@


1.17
log
@
PR4038, from John Ladwig.  Sample script had some flaws.  Used danh@@'s
fix, however.
@
text
@d35 3
a37 1
<img alt="[OpenBSD]" height=30 width=141 src="../../images/smalltitle.gif">
d333 1
a333 1
<small>$OpenBSD: logging.html,v 1.16 2004/10/29 17:22:57 nick Exp $</small>
@


1.16
log
@
Update for 3.6
@
text
@d217 4
a220 2
	   tcpdump -n -e -ttt -r $logfile | logger -t pf -p local0.info
	   rm $logfile
d331 1
a331 1
<small>$OpenBSD: logging.html,v 1.15 2004/05/07 01:55:23 nick Exp $</small>
@


1.15
log
@
Add an OpenBSD license to the PF User's Guide.
Concept and breakdown of copyrights agreed to by Joel Knight and myself,
license assistance millert@@, ok deraadt@@.
@
text
@d59 1
a59 1
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=pflogd&amp;sektion=8&amp;manpath=OpenBSD+3.5"
d61 1
a61 1
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=pflog&amp;sektion=4&amp;manpath=OpenBSD+3.5"
d64 1
a64 1
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=tcpdump&amp;sektion=8&amp;manpath=OpenBSD+3.5"
d107 1
a107 1
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=telnet&amp;sektion=1&amp;manpath=OpenBSD+3.5"
d109 1
a109 1
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=ftp&amp;sektion=1&amp;manpath=OpenBSD+3.5"
d148 1
a148 1
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=tcpdump&amp;sektion=8&amp;manpath=OpenBSD+3.5"
d187 1
a187 1
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=syslogd&amp;sektion=8&amp;manpath=OpenBSD+3.5"
d194 1
a194 1
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=adduser&amp;sektion=8&amp;manpath=OpenBSD+3.5"
d274 1
a274 1
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=hosts&amp;sektion=5&amp;manpath=OpenBSD+3.5"
d302 1
a302 1
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=newsyslog&amp;sektion=8&amp;manpath=OpenBSD+3.5"
d329 1
a329 1
<small>$OpenBSD: logging.html,v 1.14 2004/04/30 18:00:25 nick Exp $</small>
@


1.14
log
@
PF User's Guide updates for OpenBSD 3.5.
Work done by Joel Knight (enabled et myrealbox.dit com), many, many thanks
to him for providing and maintaining some darned good docs.
@
text
@a10 1
<meta name="copyright"     content="This document copyright 2003-2004 by OpenBSD.">
d13 18
d329 1
a329 1
<small>$OpenBSD: logging.html,v 1.13 2004/01/01 04:16:17 nick Exp $</small>
@


1.13
log
@
Bump copyright to 2004
@
text
@d42 1
a42 1
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=pflogd&amp;sektion=8&amp;manpath=OpenBSD+3.4"
d44 2
a45 2
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=pflog&amp;sektion=4&amp;manpath=OpenBSD+3.4"
>pflog0</a> interface and writes packets to a log file (normally
d47 1
a47 1
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=tcpdump&amp;sektion=8&amp;manpath=OpenBSD+3.4"
d68 1
a68 1
by using the pflog0 interface:
d90 1
a90 1
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=telnet&amp;sektion=1&amp;manpath=OpenBSD+3.4"
d92 1
a92 1
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=ftp&amp;sektion=1&amp;manpath=OpenBSD+3.4"
d116 2
a117 1
The same idea can be applied when reading from the pflog0 interface:
d131 1
a131 1
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=tcpdump&amp;sektion=8&amp;manpath=OpenBSD+3.4"
d170 1
a170 1
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=syslogd&amp;sektion=8&amp;manpath=OpenBSD+3.4"
d177 1
a177 1
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=adduser&amp;sektion=8&amp;manpath=OpenBSD+3.4"
d257 1
a257 1
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=hosts&amp;sektion=5&amp;manpath=OpenBSD+3.4"
d285 1
a285 1
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=newsyslog&amp;sektion=8&amp;manpath=OpenBSD+3.4"
d312 1
a312 1
<small>$OpenBSD: logging.html,v 1.12 2003/12/30 21:58:01 nick Exp $</small>
@


1.12
log
@
touch the log file.  Requested by Daniel Polak (daniel at sys dot nl)
via dhartmei@@
@
text
@d11 1
a11 1
<meta name="copyright"     content="This document copyright 2003 by OpenBSD.">
d311 1
a311 1
<small>$OpenBSD: logging.html,v 1.11 2003/11/30 23:18:06 nick Exp $</small>
@


1.11
log
@
Sync new tagging article.  Diff from Joel Knight (the guy does a complete
job!).
@
text
@d260 9
d311 1
a311 1
<small>$OpenBSD: logging.html,v 1.10 2003/11/28 04:09:45 nick Exp $</small>
@


1.10
log
@
next/prev error.  Spotted and fixed by Joel Knight.
@
text
@d20 1
a20 1
[<a href="pools.html">Previous: Address Pools and Load Balancing </a>]
d293 1
a293 1
[<a href="pools.html">Previous: Address Pools and Load Balancing </a>]
d302 1
a302 1
<small>$OpenBSD: logging.html,v 1.9 2003/11/09 23:29:02 nick Exp $</small>
@


1.9
log
@
Update of PF User's Guide to 3.4.  Ok, really just pointing the man page
links at the 3.4-release man pages rather than the 3.3-release man pages.
Work by Joel Knight.
@
text
@d20 1
a20 1
[<a href="filter.html">Previous: Packet Filtering</a>]
d22 1
a22 1
[<a href="anchors.html">Next: Anchors and Named Rulesets</a>]
d293 1
a293 1
[<a href="filter.html">Previous: Packet Filtering</a>]
d295 1
a295 1
[<a href="anchors.html">Next: Anchors and Named Rulesets</a>]
d302 1
a302 1
<small>$OpenBSD: logging.html,v 1.8 2003/09/22 02:29:03 nick Exp $</small>
@


1.8
log
@
From Joel Knight: changes formatting so that all keywords are
in <i>, all literals are in <tt>, etc.  Excess man page links removed.
No words were changed.
@
text
@d42 1
a42 1
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=pflogd&amp;sektion=8&amp;manpath=OpenBSD+3.3"
d44 1
a44 1
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=pflog&amp;sektion=4&amp;manpath=OpenBSD+3.3"
d47 1
a47 1
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=tcpdump&amp;sektion=8&amp;manpath=OpenBSD+3.3"
d90 1
a90 1
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=telnet&amp;sektion=1&amp;manpath=OpenBSD+3.3"
d92 1
a92 1
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=ftp&amp;sektion=1&amp;manpath=OpenBSD+3.3"
d130 1
a130 1
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=tcpdump&amp;sektion=8&amp;manpath=OpenBSD+3.3"
d169 1
a169 1
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=syslogd&amp;sektion=8&amp;manpath=OpenBSD+3.3"
d176 1
a176 1
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=adduser&amp;sektion=8&amp;manpath=OpenBSD+3.3"
d256 1
a256 1
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=hosts&amp;sektion=5&amp;manpath=OpenBSD+3.3"
d275 1
a275 1
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=newsyslog&amp;sektion=8&amp;manpath=OpenBSD+3.3"
d302 1
a302 1
<small>$OpenBSD: logging.html,v 1.7 2003/09/16 01:23:49 nick Exp $</small>
@


1.7
log
@
Grammar and punctuation clean up, from Joel Knight.
Only a very few words changed.
@
text
@d54 2
a55 6
The log file written by 
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=pflogd&amp;sektion=8&amp;manpath=OpenBSD+3.3"
>pflogd(8)</a> is in binary format and cannot be read using a text
editor. 
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=tcpdump&amp;sektion=8&amp;manpath=OpenBSD+3.3"
>Tcpdump(8)</a> must be used to view the log.
d66 3
a68 5
Note that using 
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=tcpdump&amp;sektion=8&amp;manpath=OpenBSD+3.3"
>tcpdump(8)</a> to watch the pflog file does <i>not</i> give a real-time
display. A real-time display of logged packets is achieved by using the
pflog0 interface:
d77 1
a77 2
When examining the logs, special care should be taken
with 
d87 1
a87 2
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=pflogd&amp;sektion=8&amp;manpath=OpenBSD+3.3"
>pflogd</a> will record 96 bytes of the packet in the log file.  Access
d97 3
a99 7
Because 
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=pflogd&amp;sektion=8&amp;manpath=OpenBSD+3.3"
>pflogd(8)</a> logs in 
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=tcpdump&amp;sektion=8&amp;manpath=OpenBSD+3.3"
>tcpdump(8)</a> binary format, the full range of tcpdump features can be
used when reviewing the logs. For example, to only see packets that
match a certain port:
d170 1
a170 1
>syslogd(8)</a>, the logging daemon. Syslogd(8) logs in ASCII and
d242 1
a242 1
local0.info    /var/log/pflog.txt
d250 1
a250 1
local0.info    @@syslogger
d257 1
a257 1
>/etc/hosts(5)</a> file.
d260 1
a260 1
Make syslogd(8) notice the changes by restarting it:
d280 4
a283 6
<blockquote>
<tt>
#/var/log/pflog       600    3    250    *    ZB /var/run/pflogd.pid<br>
/var/log/pflog.txt    600    7    *      24
</tt>
</blockquote>
d302 1
a302 1
<small>$OpenBSD: logging.html,v 1.6 2003/07/03 14:01:08 nick Exp $</small>
@


1.6
log
@
"a name=" -> "a href".  Spotted by Tomasz Bak (openbsdpl at wp dot pl),
thanks!
@
text
@d301 2
a302 2
configured in <tt>/etc/syslog.conf</tt> it will also log to a remote
server.  The logging is not immediate but it can take up to about 5-6
d316 1
a316 1
<small>$OpenBSD: logging.html,v 1.4 2003/06/13 02:54:08 nick Exp $</small>
@


1.5
log
@
"newsyslogd" -> "newsyslog", spotted by David@@
Wording improvement, from Joel Knight.
@
text
@d48 1
a48 1
>tcpdump(8)</a> binary format. <a name="filter.html">Filter</a> rules
@


1.4
log
@
Improved wrapping of man page links, renders better on some browsers.
No words altered.  From Joel Knight.
@
text
@d83 1
a83 1
When examining one's logs, special care should be taken
d288 1
a288 1
>newsyslogd(8)</a> is no longer necessary and should be
d316 1
a316 1
<small>$OpenBSD: logging.html,v 1.3 2003/05/15 03:03:54 nick Exp $</small>
@


1.3
log
@
Table of Contents now on each page.  Work by Joel Knight (yay! Joel! 8-).
@
text
@d42 4
a45 4
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=pflogd&amp;sektion=8&amp;manpath=OpenBSD+3.3">
pflogd(8)</a> which listens on the
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=pflog&amp;sektion=4&amp;manpath=OpenBSD+3.3">
pflog0</a> interface and writes packets to a log file (normally
d47 2
a48 2
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=tcpdump&amp;sektion=8&amp;manpath=OpenBSD+3.3">
tcpdump(8)</a> binary format. <a name="filter.html">Filter</a> rules
d55 2
a56 2
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=pflogd&amp;sektion=8&amp;manpath=OpenBSD+3.3">
pflogd(8)</a> is in binary format and cannot be read using a text
d58 2
a59 2
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=tcpdump&amp;sektion=8&amp;manpath=OpenBSD+3.3">
Tcpdump(8)</a> must be used to view the log.
d71 2
a72 2
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=tcpdump&amp;sektion=8&amp;manpath=OpenBSD+3.3">
tcpdump(8)</a> to watch the pflog file does <i>not</i> give a real-time
d94 2
a95 2
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=pflogd&amp;sektion=8&amp;manpath=OpenBSD+3.3">
pflogd</a> will record 96 bytes of the packet in the log file.  Access
d98 4
a101 4
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=telnet&amp;sektion=1&amp;manpath=OpenBSD+3.3">
telnet(1)</a> or
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=ftp&amp;sektion=1&amp;manpath=OpenBSD+3.3">
ftp(1)</a> usernames and passwords).
d106 4
a109 4
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=pflogd&amp;sektion=8&amp;manpath=OpenBSD+3.3">
pflogd(8)</a> logs in 
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=tcpdump&amp;sektion=8&amp;manpath=OpenBSD+3.3">
tcpdump(8)</a> binary format, the full range of tcpdump features can be
d142 2
a143 2
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=tcpdump&amp;sektion=8&amp;manpath=OpenBSD+3.3">
tcpdump(8)</a> filter rules, OpenBSD's tcpdump filter language has been
d181 2
a182 2
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=syslogd&amp;sektion=8&amp;manpath=OpenBSD+3.3">
syslogd(8)</a>, the logging daemon. Syslogd(8) logs in ASCII and
d188 2
a189 2
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=adduser&amp;sektion=8&amp;manpath=OpenBSD+3.3">
adduser(8)</a>.
d268 2
a269 2
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=hosts&amp;sektion=5&amp;manpath=OpenBSD+3.3">
/etc/hosts(5)</a> file.
d287 2
a288 2
<a  href="http://www.openbsd.org/cgi-bin/man.cgi?query=newsyslog&amp;sektion=8&amp;manpath=OpenBSD+3.3">
newsyslogd(8)</a> is no longer necessary and should be
d316 1
a316 1
<small>$OpenBSD: logging.html,v 1.2 2003/05/01 14:20:37 nick Exp $</small>
@


1.2
log
@
ARGH!  no, it is "ruleset", not "rule set".  Pointed out by Margarida@@
@
text
@d29 12
a40 1
<p>
d53 1
a53 1
<h2>Reading A Log File</h2>
d316 1
a316 1
<small>$OpenBSD: logging.html,v 1.1 2003/05/01 01:46:06 nick Exp $</small>
@


1.1
log
@
The long awaited, new PF FAQ!
Most of it written by Joel Knight >enabled at myrealbox dot com<,
some parts by me, a few parts yanked out of the old PF FAQ.
GREAT work, Joel!
@
text
@d22 1
a22 1
[<a href="anchors.html">Next: Anchors and Named Rule Sets</a>]
d298 1
a298 1
[<a href="anchors.html">Next: Anchors and Named Rule Sets</a>]
d305 1
a305 1
<small>$OpenBSD$</small>
@

