head	1.39;
access;
symbols;
locks; strict;
comment	@# @;


1.39
date	2014.04.01.17.18.45;	author nick;	state dead;
branches;
next	1.38;

1.38
date	2013.11.01.18.04.05;	author ajacoutot;	state Exp;
branches;
next	1.37;

1.37
date	2013.05.01.17.39.07;	author ajacoutot;	state Exp;
branches;
next	1.36;

1.36
date	2013.05.01.14.42.14;	author ajacoutot;	state Exp;
branches;
next	1.35;

1.35
date	2012.11.02.07.24.05;	author ajacoutot;	state Exp;
branches;
next	1.34;

1.34
date	2012.05.13.16.30.18;	author ajacoutot;	state Exp;
branches;
next	1.33;

1.33
date	2012.01.21.19.34.39;	author ajacoutot;	state Exp;
branches;
next	1.32;

1.32
date	2009.11.07.07.32.54;	author ajacoutot;	state Exp;
branches;
next	1.31;

1.31
date	2009.05.04.19.07.52;	author tobias;	state Exp;
branches;
next	1.30;

1.30
date	2008.11.01.11.02.22;	author tobias;	state Exp;
branches;
next	1.29;

1.29
date	2008.08.10.16.14.28;	author tobias;	state Exp;
branches;
next	1.28;

1.28
date	2008.03.09.13.37.13;	author tobias;	state Exp;
branches;
next	1.27;

1.27
date	2008.01.13.13.43.34;	author tobias;	state Exp;
branches;
next	1.26;

1.26
date	2007.11.12.20.29.59;	author saad;	state Exp;
branches;
next	1.25;

1.25
date	2007.05.10.12.43.46;	author saad;	state Exp;
branches;
next	1.24;

1.24
date	2007.04.26.03.08.06;	author jufi;	state Exp;
branches;
next	1.23;

1.23
date	2006.11.01.11.30.45;	author jufi;	state Exp;
branches;
next	1.22;

1.22
date	2006.10.29.10.58.52;	author jufi;	state Exp;
branches;
next	1.21;

1.21
date	2006.08.23.08.54.20;	author jufi;	state Exp;
branches;
next	1.20;

1.20
date	2006.08.08.07.14.20;	author saad;	state Exp;
branches;
next	1.19;

1.19
date	2006.06.01.06.33.44;	author jufi;	state Exp;
branches;
next	1.18;

1.18
date	2006.05.01.12.19.17;	author jufi;	state Exp;
branches;
next	1.17;

1.17
date	2006.04.25.08.25.49;	author saad;	state Exp;
branches;
next	1.16;

1.16
date	2006.01.14.11.36.00;	author jufi;	state Exp;
branches;
next	1.15;

1.15
date	2006.01.06.12.42.41;	author jufi;	state Exp;
branches;
next	1.14;

1.14
date	2005.12.18.12.05.08;	author jufi;	state Exp;
branches;
next	1.13;

1.13
date	2005.11.18.20.48.47;	author jufi;	state Exp;
branches;
next	1.12;

1.12
date	2005.11.04.20.24.23;	author jufi;	state Exp;
branches;
next	1.11;

1.11
date	2005.09.20.07.30.02;	author saad;	state Exp;
branches;
next	1.10;

1.10
date	2005.06.06.12.14.49;	author saad;	state Exp;
branches;
next	1.9;

1.9
date	2005.05.22.17.38.08;	author saad;	state Exp;
branches;
next	1.8;

1.8
date	2005.05.20.17.13.26;	author jufi;	state Exp;
branches;
next	1.7;

1.7
date	2005.02.08.13.59.02;	author jufi;	state Exp;
branches;
next	1.6;

1.6
date	2005.01.18.17.18.10;	author jufi;	state Exp;
branches;
next	1.5;

1.5
date	2004.12.22.20.00.48;	author jufi;	state Exp;
branches;
next	1.4;

1.4
date	2004.12.19.10.49.33;	author jufi;	state Exp;
branches;
next	1.3;

1.3
date	2004.12.08.05.22.43;	author saad;	state Exp;
branches;
next	1.2;

1.2
date	2004.12.01.19.35.52;	author jufi;	state Exp;
branches;
next	1.1;

1.1
date	2003.11.27.19.39.09;	author horacio;	state Exp;
branches;
next	;


desc
@@


1.39
log
@
missed another one...
@
text
@<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<html>
<head>
<title>PF: Protokollierung</title>
<link rev="made" href="mailto:www@@openbsd.org">
<meta http-equiv="Content-Type" content="text/html; charset=ISO-8859-1">
<meta name="resource-type" content="document">
<meta name="description"   content="the OpenBSD FAQ page">
<meta name="keywords"      content="openbsd,faq,pf">
<meta name="distribution"  content="global">
</head>

<!--
Copyright (c) 2003, Nick Holland <nick@@openbsd.org>
Copyright (c) 2003-2007, Joel Knight <enabled@@myrealbox.com>

Permission to use, copy, modify, and distribute this documentation for
any purpose with or without fee is hereby granted, provided that the
above copyright notice and this permission notice appear in all copies.

THE DOCUMENTATION IS PROVIDED "AS IS" AND THE AUTHOR DISCLAIMS ALL
WARRANTIES WITH REGARD TO THIS DOCUMENTATION INCLUDING ALL IMPLIED
WARRANTIES OF MERCHANTABILITY AND FITNESS. IN NO EVENT SHALL THE
AUTHOR BE LIABLE FOR ANY SPECIAL, DIRECT, INDIRECT, OR CONSEQUENTIAL
DAMAGES OR ANY DAMAGES WHATSOEVER RESULTING FROM LOSS OF USE, DATA OR
PROFITS, WHETHER IN AN ACTION OF CONTRACT, NEGLIGENCE OR OTHER
TORTIOUS ACTION, ARISING OUT OF OR IN CONNECTION WITH THE USE OR
PERFORMANCE OF THIS DOCUMENTATION
-->

<body bgcolor="#ffffff" text="#000000">
<!-- Passes validator.w3.org, please keep it this way;
please, use a max of 72 chars per line -->

<a href="../../../de/index.html">
<img alt="[OpenBSD]" height=30 width=141 src="../../../images/smalltitle.gif" border="0">
</a>
<p>
[<a href="tagging.html">Zurück: Pakete markieren</a>]
[<a href="index.html">Inhalt</a>]
[<a href="perf.html">Weiter: Leistung</a>]

<p>
<h1><font color="#e00000">PF: Aufzeichnen</font></h1>

<hr>

<h3>Inhaltsverzeichnis</h3>
<ul>
<li><a href="#intro">Einführung</a>
<li><a href="#log">Pakete aufzeichnen</a>
<li><a href="#logfile">Eine Logdatei lesen</a>
<li><a href="#filter">Logausgabe filtern</a>
<li><a href="#syslog">Pakete über syslog aufzeichnen</a>
</ul>

<hr>

<a name="intro"></a>
<h2>Einführung</h2>
Wenn ein Paket in PF aufgezeichnet wird, dann wird eine Kopie des
Paketheaders an das <a
href="http://www.openbsd.org/cgi-bin/man.cgi?query=pflog&amp;sektion=4&amp;manpath=OpenBSD+5.4"
>pflog(4)</a>-Interfaces mit weiteren zusätzlichen Daten gesendet.
Weitere Daten wären zum Beispiel das Interface, durch das das Paket
passierte, die von PF durchgeführte Aktion (pass oder block) etc.
Das pflog(4)-Interface ermöglicht es Anwendungen im Userland, PFs
aufgezeichnete Daten aus dem Kernel zu empfangen. Wenn PF während des
Bootvorgangs aktiviert wird, dann wird der Daemon <a
href="http://www.openbsd.org/cgi-bin/man.cgi?query=pflogd&amp;sektion=8&amp;manpath=OpenBSD+5.4"
>pflogd(8)</a> ebenfalls gestartet. Standardmäßig lauscht pflogd(8)
auf dem <tt>pflog8</tt>-Interface und schreibt alle aufgezeichneten
Daten in die Datei <tt>/var/log/pflog</tt>.

<a name="log"></a>
<h2>Pakete aufzeichnen</h2>
<p>
Um PF passierende Pakete protokollieren zu können, muss das Schlüsselword
<tt>log</tt> angegeben werden.
Das Schlüsselwort <tt>log</tt> bewirkt, dass alle Pakete, die auf die
Regel zutreffen, aufgezeichnet werden. Falls die Regel
<a href="filter.html#state">einen Status anlegt</a>, wird nur das erste
aufkommende Paket aufgezeichnet (d.&nbsp;h. das Paket, das für das
Anlegen des Status verantwortlich ist).

<p>
Folgende Optionen können an das Schlüsselwort <tt>log</tt> übergeben
werden:

<dl>
<dt><tt>all</tt>
<dd>Sorgt dafür, dass alle zutreffenden Pakete (nicht nur das erste
Paket) aufgezeichnet werden. Insbesondere für Regeln sinnvoll, die
einen Status anlegen.

<dt><tt>to <i>pflogN</i></tt>
<dd>Sorgt dafür, dass alle zutreffenden Pakete auf dem angegebenen
pflog(4)-Interface ausgegeben werden. Wenn zum Beispiel <a
href="http://www.openbsd.org/cgi-bin/man.cgi?query=spamlogd&amp;sektion=8"
>spamlogd(8)</a> verwendet wird, dann kann der gesamte SMTP-Verkehr
über ein extra dafür bereitgestelltes pflog(4)-Interface von PF
aufgezeichnet werden. Der spamlogd(8)-Daemon wiederum kann so
eingestellt werden, dass er auf diesem Interface lauscht. Somit würde
die Hauptlogdatei von PF vom SMTP-Verkehr befreit werden, der ansonsten
nicht weiter aufgezeichnet werden muss.
Verwende <a
href="http://www.openbsd.org/cgi-bin/man.cgi?query=ifconfig&amp;sektion=8"
>ifconfig(8)</a>, um pflog(4)-Interfaces zu erstellen. Das
standardmäßige genutzte Loginterface <tt>pflog(8)</tt> wird automatisch
erstellt.

<dt><tt>user</tt>
<dd>Sorgt dafür, dass die Unix-Benutzer-ID und -Gruppen-ID des
Besitzers des Sockets, von dem aus das Paket gesendet/zu dem das
Paket gesendet wird, neben den standardmäßigen Loginformationen
aufgezeichnet werden.
</dl>

<p>
Optionen werden in Klammern nach dem Schlüsselwort <tt>log</tt>
angegeben; mehrere Optionen werden mit Kommas oder Leerstellen getrennt.

<blockquote>
<tt>
pass in log (all, to pflog1) on $ext_if inet proto tcp to $ext_if port 22 keep state
</tt>
</blockquote>

<a name="logfile"></a>
<h2>Eine Logdatei lesen</h2>
Die Logdatei, die von pflogd geschrieben wird, ist im Binärformat und
kann nicht mit einem Texteditor gelesen werden. Tcpdump muss verwendet
werden, um die Log anzuzeigen.

<p>
Um die Logdatei anzusehen:
<blockquote>
<tt>
# tcpdump -n -e -ttt -r /var/log/pflog
</tt>
</blockquote>

<p>
Bedenke, dass die Verwendung von tcpdump(8), um die pflog-Datei
anzusehen, <i>keine</i> Echtzeitanzeige ist. Eine Echtzeitanzeige
aufgezeichneter Pakete wird anhand des <tt>pflog0</tt>-Interfaces
erreicht:
<blockquote>
<tt>
# tcpdump -n -e -ttt -i pflog0
</tt>
</blockquote>

<p>
<font color="#e00000">HINWEIS: </font>
Wenn die Logs untersucht werden, sollte besondere Vorsicht mit tcpdumps
ausführlicher Protokolldekodierung herrschen (diese wird mit der
Kommandozeilenoption <tt>-v</tt> aktiviert). Tcpdumps
Protokolldekodierer hat keine perfekte Sicherheitsvergangenheit.
Zumindest ist in der Theorie ein verzögerter Angriff möglich, indem die
einzelnen Paketpayloads mit dem Loggingdevice aufgezeichnet werden. Es
ist empfohlene Praxis, die Logdateien von der Firewallmaschine auf
einen anderen Rechner zu verschieben, bevor sie auf diesem Weg überprüft
werden.

<p>
Besondere Sorgfalt sollte ebenfalls beim Absichern des Zugriffs auf
die Logs geboten sein.
Standardmäßig speichert pflogd 160 Bytes eines Pakets in der Protokolldatei.
Zugriff auf die Logs könnten somit Zugriff auf
sensible Paketpayloads ermöglichen (wie zum Beispiel
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=telnet&amp;sektion=1"
>telnet(1)</a>- oder
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=ftp&amp;sektion=1"
>ftp(1)</a>-Benutzernamen und -Passwörter).

<a name="filter"></a>
<h2>Log-Ausgabe filtern</h2>
Weil pflogd-Logs im tcpdump-Binärformat vorliegen, kann die gesamte
Palette der tcpdump-Funktionen genutzt werden, wenn die Logs wieder
angesehen werden. Zum Beispiel kann Folgendes verwendet werden, um
nur die Pakete zu sehen, die mit einem bestimmten Port übereinstimmen:
<blockquote>
<tt>
# tcpdump -n -e -ttt -r /var/log/pflog port 80
</tt>
</blockquote>

<p>
Dies kann weiter verbessert werden, indem die angezeigten Pakete
auf eine bestimmte Host- und Portkombination reduziert werden:
<blockquote>
<tt>
# tcpdump -n -e -ttt -r /var/log/pflog port 80 and host 192.168.1.3
</tt>
</blockquote>

<p>
Die gleiche Idee kann angewendet werden, wenn vom
<tt>pflog0</tt>-Interface gelesen wird:
<blockquote>
<tt>
# tcpdump -n -e -ttt -i pflog0 host 192.168.4.2
</tt>
</blockquote>

<p>
Bedenke, dass dies keinen Einfluss darauf nimmt, welche Pakete
in die Logdatei aufgezeichnet werden; das zuvor angegebene Kommando
zeigt nur Pakete an, sobald sie aufgezeichnet werden.

<p>
Zusätzlich zu den typischen
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=tcpdump&amp;sektion=8"
>tcpdump(8)</a>-Filterregeln wurde die tcpdump-Filtersprache so
erweitert, dass die pflogd-Ausgabe gelesen werden kann:
<ul>
<li><tt>ip</tt> - Adressfamilie ist IPv4.
<li><tt>ip6</tt> - Adressfamilie ist IPv6.
<li><tt>on <i>int</i></tt> - Pakete, die durch das <i>int</i>-Interface
hereingekommen sind.
<li><tt>ifname <i>int</i></tt> - das Gleiche wie <tt>on <i>int</i></tt>.
<li><tt>ruleset <i>name</i></tt> - der
<a href="anchors.html">Regelsatz/Anker</a>, der auf das Paket zutraf.
<li><tt>rulenum <i>num</i></tt> - Die Filterregel, auf die das Paket
zutraf, war Regelnummer <i>num</i>.
<li><tt>action <i>act</i></tt> - Die Aktion, die auf das Paket
angewandt wurde.
Mögliche Aktionen sind <tt>pass</tt> und <tt>block</tt>.
<li><tt>reason <i>res</i></tt> - Der Grund für die Aktion (<tt>action</tt>).
Mögliche Gründe sind <tt>match</tt>, <tt>bad-offset</tt>,
<tt>fragment</tt>, <tt>short</tt>, <tt>normalize</tt>,
<tt>memory</tt>, <tt>bad-timestamp</tt>,
<tt>congestion</tt>, <tt>ip-option</tt>, <tt>proto-cksum</tt>,
<tt>state-mismatch</tt>, <tt>state-insert</tt>, <tt>state-limit</tt>,
<tt>src-limit</tt>, und <tt>synproxy</tt>.
<li><tt>inbound</tt> - Paket kam herein.
<li><tt>outbound</tt> - Paket ging heraus.
</ul>

<p>
Beispiel:
<blockquote>
<tt>
# tcpdump -n -e -ttt -i pflog0 inbound and action block and on wi0
</tt>
</blockquote>

<p>
Dies zeigt die Log von eingehenden Paketen in Echtzeit an, die auf dem
wi0-Interface geblockt worden sind.

<a name="syslog"></a>
<h2>Pakete durch syslog aufzeichnen</h2>
In vielen Situationen ist es erwünscht, die Firewall-Logs im ASCII-Format
verfügbar zu haben und/oder diese zu einem entfernten Logserver zu senden.
All das kann mit einem kleinen Shellskript, ein paar kleinen Änderungen
an den OpenBSD-Konfigurationsdateien und
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=syslogd&amp;sektion=8"
>syslogd(8)</a>, dem Logging-Daemon, erreicht werden. Syslogd zeichnet
in ASCII auf und ist ebenfalls in der Lage, auf einen entfernten Logserver
aufzuzeichnen.

<p>
Erstelle das folgende Skript:

<p>
<tt>/etc/pflogrotate</tt>
<pre>
	#!/bin/sh
	PFLOG=/var/log/pflog
	FILE=/var/log/pflog5min.$(date "+%Y%m%d%H%M")
	pkill -ALRM -u root -U root -t - -x pflogd
	if [ -r $PFLOG ] && [ $(stat -f %z $PFLOG) -gt 24 ]; then
	   mv $PFLOG $FILE
	   pkill -HUP -u root -U root -t - -x pflogd
	   tcpdump -n -e -s 160 -ttt -r $FILE | logger -t pf -p local0.info
	   rm $FILE
	fi
</pre>

<p>
Editiere roots Cron-Job:
<blockquote>
<tt>
# crontab -u root -e
</tt>
</blockquote>

<p>
Füge diese beiden Zeilen mit ein:
<blockquote>
<tt>
# rotate pf log file every 5 minutes<br>
0-59/5 *       *       *       *       /bin/sh /etc/pflogrotate
</tt>
</blockquote>

<p>
Füge folgende Zeile in <tt>/etc/syslog.conf</tt> mit ein:
<blockquote>
<tt>
local0.info &nbsp;&nbsp;&nbsp;&nbsp;/var/log/pflog.txt
</tt>
</blockquote>

<p>
Wenn du ebenfalls auf einen entfernten Log-Server aufzeichnen willst,
füge diese Zeile mit ein:
<blockquote>
<tt>
local0.info &nbsp;&nbsp;&nbsp;&nbsp;@@syslogger
</tt>
</blockquote>

<p>
Stelle sicher, dass der Host <i>syslogger</i> in der
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=hosts&amp;sektion=5"
>hosts(5)</a>-Datei definiert wurde.

<p>
Erstelle die Datei <tt>/var/log/pflog.txt</tt>, damit syslog in der Lage
ist, in diese Datei aufzuzeichnen, und gib dieser Datei die gleichen
Rechte wie der pflog-Datei.
<blockquote>
<tt>
# touch /var/log/pflog.txt<br>
# chmod 600 /var/log/pflog.txt
</tt>
</blockquote>

<p>
Teile syslogd die Änderungen mit, indem du ihn neustartest:
<blockquote>
<tt>
# kill -HUP $(cat /var/run/syslog.pid)
</tt>
</blockquote>

<p>
Alle aufgezeichnete Pakete werden nun zur <tt>/var/log/pflog.txt</tt>-Datei
gesendet. Wenn die zweite Zeile hinzugefügt wurde, dann werden sie
ebenfalls zum entfernten Log-Host <i>syslogger</i> gesendet.

<p>
Das Skript <tt>/etc/pflogrotate</tt> verarbeitet und entfernt danach
<tt>/var/log/pflog</tt>, sodass das Rotieren von <tt>pflog</tt> durch
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=newsyslog&amp;sektion=8"
>newsyslog(8)</a> nicht weiter notwendig ist und daher auch ausgeschaltet
werden könnte. Trotzdem wird <tt>/var/log/pflog.txt</tt>
<tt>/var/log/pflog</tt> ersetzen und das Rotieren davon sollte aktiviert
werden.
Ändere <tt>/etc/newsyslog.conf</tt> wie folgt:
<pre>
    #/var/log/pflog       600    3    250    *    ZB "pkill -HUP -u root -U root -t - -x pflogd"
    /var/log/pflog.txt    600    7    *      24
</pre>

<p>
PF wird nun im ASCII-Format in <tt>/var/log/pflog.txt</tt> aufzeichnen.
Wenn es in <tt>/etc/syslog.conf</tt> so angeben wurde, wird ebenfalls
auf einen entfernten Log-Server aufgezeichnet. Die Aufzeichnung findet
nicht sofort statt, stattdessen kann es bis zu 5 oder 6 Minuten dauern
(das Cron-Job-Intervall), bevor aufgezeichnete Pakete in der
Datei auftauchen.

<p>
[<a href="tagging.html">Zurück: Pakete markieren</a>]
[<a href="index.html">Inhalt</a>]
[<a href="perf.html">Weiter: Leistung</a>]

<p>
<hr>
<a href="index.html"><img height="24" width="24" src="../../../images/back.gif" border="0" alt="[zurück]"></a>
<a href="mailto:www@@openbsd.org">www@@openbsd.org</a>
<br>
<small>
<!--
Originally [OpenBSD: logging.html,v 1.49 ]<br>
$Translation: logging.html,v 1.38 2013/11/01 16:59:45 steffen Exp $<br>
-->
$OpenBSD: logging.html,v 1.38 2013/11/01 18:04:05 ajacoutot Exp $
</small>

</body>
</html>
@


1.38
log
@Sync with Steelix CVS
@
text
@d382 1
a382 1
$OpenBSD$
@


1.37
log
@Sync with Steelix CVS
@
text
@d63 1
a63 1
href="http://www.openbsd.org/cgi-bin/man.cgi?query=pflog&amp;sektion=4&amp;manpath=OpenBSD+5.3"
d70 1
a70 1
href="http://www.openbsd.org/cgi-bin/man.cgi?query=pflogd&amp;sektion=8&amp;manpath=OpenBSD+5.3"
d379 2
a380 2
Originally [OpenBSD: logging.html,v 1.48 ]<br>
$Translation: logging.html,v 1.37 2013/05/01 16:34:16 steffen Exp $<br>
@


1.36
log
@Sync with Steelix CVS
@
text
@d379 2
a380 2
Originally [OpenBSD: logging.html,v 1.47 ]<br>
$Translation: logging.html,v 1.36 2013/05/01 13:35:26 steffen Exp $<br>
@


1.35
log
@Sync with Steelix CVS
@
text
@d63 1
a63 1
href="http://www.openbsd.org/cgi-bin/man.cgi?query=pflog&amp;sektion=4&amp;manpath=OpenBSD+5.2"
d70 1
a70 1
href="http://www.openbsd.org/cgi-bin/man.cgi?query=pflogd&amp;sektion=8&amp;manpath=OpenBSD+5.2"
d380 1
a380 1
$Translation: logging.html,v 1.35 2012/11/01 20:43:18 steffen Exp $<br>
@


1.34
log
@Sync with Steelix CVS
@
text
@d63 1
a63 1
href="http://www.openbsd.org/cgi-bin/man.cgi?query=pflog&amp;sektion=4&amp;manpath=OpenBSD+5.1"
d70 1
a70 1
href="http://www.openbsd.org/cgi-bin/man.cgi?query=pflogd&amp;sektion=8&amp;manpath=OpenBSD+5.1"
d379 2
a380 2
Originally [OpenBSD: logging.html,v 1.46 ]<br>
$Translation: logging.html,v 1.34 2012/05/11 17:06:29 steffen Exp $<br>
@


1.33
log
@Sync with Steelix CVS
@
text
@d63 1
a63 1
href="http://www.openbsd.org/cgi-bin/man.cgi?query=pflog&amp;sektion=4&amp;manpath=OpenBSD+5.0"
d70 1
a70 1
href="http://www.openbsd.org/cgi-bin/man.cgi?query=pflogd&amp;sektion=8&amp;manpath=OpenBSD+5.0"
d379 2
a380 2
Originally [OpenBSD: logging.html,v 1.45 ]<br>
$Translation: logging.html,v 1.33 2012/01/17 16:04:09 steffen Exp $<br>
@


1.32
log
@Sync with Steelix CVS
@
text
@d4 1
a4 1
<title>PF: Aufzeichnen</title>
d63 1
a63 1
href="http://www.openbsd.org/cgi-bin/man.cgi?query=pflog&amp;sektion=4&amp;manpath=OpenBSD+4.6"
d70 1
a70 1
href="http://www.openbsd.org/cgi-bin/man.cgi?query=pflogd&amp;sektion=8&amp;manpath=OpenBSD+4.6"
d78 2
a79 8
Damit Pakete, die PF passieren, aufgezeichnet werden können, muss das
Schlüsselwort <tt>log</tt> innerhalb der <a href="nat.html">NAT/rdr</a>-
und <a href="filter.html">Filter</a>regeln angegeben werden. Beachte,
dass PF nur Pakete aufzeichnen kann, die geblockt oder durchgelassen
werden; du kannst also keine Regel angeben, die einfach nur Pakete
aufzeichnet.

<p>
d168 3
a170 2
die Logs geboten sein. Standardmäßig nimmt pflogd 96 Bytes des Pakets
in die Logdatei auf. Zugriff auf die Logs könnten somit Zugriff auf
d273 1
a273 1
	kill -ALRM $(cat /var/run/pflogd.pid)
d276 2
a277 2
	   kill -HUP $(cat /var/run/pflogd.pid)
	   tcpdump -n -e -ttt -r $FILE | logger -t pf -p local0.info
d355 1
a355 1
    #/var/log/pflog       600    3    250    *    ZB /var/run/pflogd.pid
d379 2
a380 2
Originally [OpenBSD: logging.html,v 1.38 ]<br>
$Translation: logging.html,v 1.32 2009/11/05 12:55:49 tobias Exp $<br>
@


1.31
log
@Sync with Steelix CVS
@
text
@d63 1
a63 1
href="http://www.openbsd.org/cgi-bin/man.cgi?query=pflog&amp;sektion=4&amp;manpath=OpenBSD+4.5"
d70 1
a70 1
href="http://www.openbsd.org/cgi-bin/man.cgi?query=pflogd&amp;sektion=8&amp;manpath=OpenBSD+4.5"
d384 2
a385 2
Originally [OpenBSD: logging.html,v 1.37 ]<br>
$Translation: logging.html,v 1.31 2009/05/03 12:44:32 tobias Exp $<br>
@


1.30
log
@Sync with Steelix CVS
@
text
@d63 1
a63 1
href="http://www.openbsd.org/cgi-bin/man.cgi?query=pflog&amp;sektion=4&amp;manpath=OpenBSD+4.4"
d70 1
a70 1
href="http://www.openbsd.org/cgi-bin/man.cgi?query=pflogd&amp;sektion=8&amp;manpath=OpenBSD+4.4"
d384 2
a385 2
Originally [OpenBSD: logging.html,v 1.36 ]<br>
$Translation: logging.html,v 1.30 2008/11/01 09:15:07 paldium Exp $<br>
@


1.29
log
@Sync with Steelix CVS
@
text
@d63 1
a63 1
href="http://www.openbsd.org/cgi-bin/man.cgi?query=pflog&amp;sektion=4&amp;manpath=OpenBSD+4.3"
d70 1
a70 1
href="http://www.openbsd.org/cgi-bin/man.cgi?query=pflogd&amp;sektion=8&amp;manpath=OpenBSD+4.3"
d384 2
a385 2
Originally [OpenBSD: logging.html,v 1.35 ]<br>
$Translation: logging.html,v 1.29 2008/08/04 14:41:04 paldium Exp $<br>
@


1.28
log
@Sync with Steelix CVS
@
text
@d63 1
a63 1
href="http://www.openbsd.org/cgi-bin/man.cgi?query=pflog&amp;sektion=4&amp;manpath=OpenBSD+4.2"
d70 1
a70 1
href="http://www.openbsd.org/cgi-bin/man.cgi?query=pflogd&amp;sektion=8&amp;manpath=OpenBSD+4.2"
d384 2
a385 2
Originally [OpenBSD: logging.html,v 1.34 ]<br>
$Translation: logging.html,v 1.28 2008/03/04 23:03:17 paldium Exp $<br>
@


1.27
log
@Sync with Steelix CVS
@
text
@d72 1
a72 1
auf dem <tt>pflog8</tt>-Interface und schreibt alle augezeichneten
d385 1
a385 1
$Translation: logging.html,v 1.27 2008/01/13 12:27:53 paldium Exp $<br>
@


1.26
log
@Sync with Steelix CVS
@
text
@d106 1
a106 1
>spamlogd(8)</a> verwendet wird, dann kann der gesamte SMTP-Verkehr 
d385 1
a385 1
$Translation: logging.html,v 1.26 2007/11/03 10:45:43 paldium Exp $<br>
@


1.25
log
@Sync with Steelix CVS
@
text
@d63 1
a63 1
href="http://www.openbsd.org/cgi-bin/man.cgi?query=pflog&amp;sektion=4&amp;manpath=OpenBSD+4.1"
d70 1
a70 1
href="http://www.openbsd.org/cgi-bin/man.cgi?query=pflogd&amp;sektion=8&amp;manpath=OpenBSD+4.1"
d119 1
a119 1
<dd>Sorgt dafür, dass die UNIX-Benutzer-ID und -Gruppen-ID des
d352 1
a352 1
<tt>/var/log/pflog</tt>, so dass das Rotieren von <tt>pflog</tt> durch
d384 2
a385 2
Originally [OpenBSD: logging.html,v 1.33 ]<br>
$Translation: logging.html,v 1.25 2007/05/09 14:08:40 paldium Exp $<br>
@


1.24
log
@Sync with steelix translation CVS
@
text
@d15 1
a15 1
Copyright (c) 2003-2005, Joel Knight <enabled@@myrealbox.com>
d61 13
a73 11
In PF werden Pakete mit Hilfe von
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=pflogd&amp;sektion=8&amp;manpath=OpenBSD+4.0"
>pflogd(8)</a> aufgezeichnet, das auf dem
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=pflog&amp;sektion=4&amp;manpath=OpenBSD+4.0"
><tt>pflog0</tt></a>-Interface lauscht und Pakete in eine Logdatei
(normalerweise /var/log/pflog) im
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=tcpdump&amp;sektion=8&amp;manpath=OpenBSD+4.0"
>tcpdump(8)</a>-Binärformat schreibt. <a
href="filter.html">Filter</a>regeln, die das <tt>log</tt>- oder
<tt>log (all)</tt>-Schlüsselwort mit angeben, zeichen genau auf diese
Art und Weise auf.
d102 16
d131 1
a131 1
pass in log (all) on $ext_if inet proto tcp to $ext_if port 22 keep state
a134 3
<p>
Hiermit werden alle eingehenden Pakete für den Port 22 aufgezeichnet.

d177 1
a177 1
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=telnet&amp;sektion=1&amp;manpath=OpenBSD+4.0"
d179 1
a179 1
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=ftp&amp;sektion=1&amp;manpath=OpenBSD+4.0"
d219 1
a219 1
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=tcpdump&amp;sektion=8&amp;manpath=OpenBSD+4.0"
d264 1
a264 1
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=syslogd&amp;sektion=8&amp;manpath=OpenBSD+4.0"
d323 1
a323 1
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=hosts&amp;sektion=5&amp;manpath=OpenBSD+4.0"
d353 1
a353 1
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=newsyslog&amp;sektion=8&amp;manpath=OpenBSD+4.0"
d384 2
a385 2
Originally [OpenBSD: logging.html,v 1.31 ]<br>
$Translation: logging.html,v 1.24 2007/04/25 15:41:14 paldium Exp $<br>
@


1.23
log
@sync with steelix translation CVS
@
text
@d364 1
a364 1
<a href="index.html"><img height="24" width="24" src="../../../images/back.gif" border="0" alt="[zurück]"></a> 
d370 1
a370 1
$Translation: logging.html,v 1.23 2006/11/01 10:48:51 paldium Exp $<br>
d376 1
a376 1
</html> 
@


1.22
log
@sync with steelix translation CVS
@
text
@d62 1
a62 1
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=pflogd&amp;sektion=8&amp;manpath=OpenBSD+3.9"
d64 1
a64 1
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=pflog&amp;sektion=4&amp;manpath=OpenBSD+3.9"
d67 1
a67 1
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=tcpdump&amp;sektion=8&amp;manpath=OpenBSD+3.9"
d162 1
a162 1
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=telnet&amp;sektion=1&amp;manpath=OpenBSD+3.9"
d164 1
a164 1
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=ftp&amp;sektion=1&amp;manpath=OpenBSD+3.9"
d204 1
a204 1
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=tcpdump&amp;sektion=8&amp;manpath=OpenBSD+3.9"
d249 1
a249 1
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=syslogd&amp;sektion=8&amp;manpath=OpenBSD+3.9"
d308 1
a308 1
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=hosts&amp;sektion=5&amp;manpath=OpenBSD+3.9"
d338 1
a338 1
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=newsyslog&amp;sektion=8&amp;manpath=OpenBSD+3.9"
d369 2
a370 2
Originally [OpenBSD: logging.html,v 1.30 ]<br>
$Translation: logging.html,v 1.22 2006/10/29 09:44:48 paldium Exp $<br>
@


1.21
log
@sync with steelix translation CVS
@
text
@d205 1
a205 1
>tcpdump(8)</a>-Filterregeln wurde OpenBSDs tcpdump-Filtersprache so
d369 2
a370 2
Originally [OpenBSD: logging.html,v 1.29 ]<br>
$Translation: logging.html,v 1.21 2006/08/15 10:39:00 paldium Exp $<br>
@


1.20
log
@sync with Steelix CVS
@
text
@d273 1
a273 1
Editieren roots Cron-Job:
d281 1
a281 1
Fügen diese beiden Zeilen mit ein:
d290 1
a290 1
Fügen folgende Zeile in <tt>/etc/syslog.conf</tt> mit ein:
d350 3
a352 3
PF wird nun in ASCII in <tt>/var/log/pflog.txt</tt> aufzeichnen. Wenn
es in <tt>/etc/syslog.conf</tt> so angeben wurde, wird ebenfalls auf
einen entfernten Log-Server aufgezeichnet. Das Aufzeichnen findet
d370 1
a370 1
$Translation: logging.html,v 1.20 2006/08/06 14:06:56 paldium Exp $<br>
@


1.19
log
@sync with steelix translation CVS
cvs: ----------------------------------------------------------------------
@
text
@d53 2
a54 2
<li><a href="#filter">Log-Ausgabe filtern</a>
<li><a href="#syslog">Pakete durch syslog aufzeichnen</a>
d61 1
a61 1
In PF wird das Aufzeichnen von Paketen mit Hilfe von
d63 1
a63 1
>pflogd(8)</a> realisiert, welches auf dem
d68 4
a71 3
>tcpdump(8)</a>-Binärformat schreibt. <a href="filter.html">Filter</a>regeln,
die das <tt>log</tt>- oder <tt>log (all)</tt>-Schlüsselwort mit angeben,
zeichen genau auf diese Art und Weise auf.
d86 1
a86 1
<a href="filter.html#state">ein ,state' anlegt</a>, wird nur das erste
d88 1
a88 1
Anlegen des ,states' verantwortlich ist).
d91 2
a92 2
Die Optionen, die an das Schlüsselwort <tt>log</tt> übergeben werden
können, sind:
d97 2
a98 2
Paket) aufgezeichnet werden. Insbesondere für Regeln sinnvoll, die ein
,state' anlegen.
d135 4
a138 3
Bedenke, dass die Verwendung von tcpdump(8), um die pflog-Datei anzusehen,
<i>keine</i> Echtzeit-Anzeige ist. Eine Echtzeit-Anzeige aufgezeichneter
Pakete wird anhand des <tt>pflog0</tt>-Interfaces erreicht:
d148 8
a155 7
,verbose'-Protokoll-Dekodierung herrschen (diese wird mit der
<tt>-v</tt>-Kommandozeilenoption aktiviert). Tcpdumps Protokoll-Dekodierer
hat keine perfekte Sicherheitsvergangenheit. Zumindest ist in der Theorie
ein verzögerter Angriff möglich, indem die einzelnen Paket-,payloads' mit
dem Logging-Device aufgezeichnet werden. Es ist empfohlene Praxis, die
Logdateien von der Firewall-Maschine auf einen anderen Rechner zu
verschieben, bevor sie auf diesem Weg überprüft werden.
d161 1
a161 1
sensible Paket-,payloads' ermöglichen (wie zum Beispiel
d181 1
a181 1
auf eine bestimmte Host- und Port-Kombination reduziert werden:
d189 2
a190 2
Die gleiche Idee kann angewendet werden, wenn vom <tt>pflog0</tt>-Interface
gelesen wird:
d208 2
a209 2
<li><tt>ip</tt> - Adress-Familie ist IPv4.
<li><tt>ip6</tt> - Adress-Familie ist IPv6.
d370 1
a370 1
$Translation: logging.html,v 1.19 2006/05/31 19:00:25 paldium Exp $<br>
@


1.18
log
@3.9 release time.
@
text
@d244 1
a244 1
All das kann mit zwei kleinen Shellskripten, ein paar kleinen Änderungen
d252 1
a252 9
Zuerst müssen wir einen Benutzer <tt>pflogger</tt> anlegen, der eine
<tt>/sbin/nologin</tt>-Shell besitzt. Der einfachste Weg, um diesen
Benutzer anzulegen, ist
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=adduser&amp;sektion=8&amp;manpath=OpenBSD+3.9"
>adduser(8)</a>.

<p>
Nachdem wir den Benutzer <tt>pflogger</tt> angelegt haben, erstellen
wir die beiden folgenden Skripte:
d258 2
a259 1
	FILE=/home/pflogger/pflog5min.$(date "+%Y%m%d%H%M")
d261 2
a262 3
	if [ $(ls -l /var/log/pflog | cut -d " " -f 8) -gt 24 ]; then
	   mv /var/log/pflog $FILE
	   chown pflogger $FILE
d264 2
a265 17
	fi
</pre>

<p>
<tt>/home/pflogger/pfl2sysl</tt>
<pre>
	#!/bin/sh
	# feed rotated pflog file(s) to syslog
	# do not start if another instance of this script is already running
	pgrep pfl2sysl >/dev/null 2>&1
	if [ $? -ne 0 ] ; then
		for logfile in /home/pflogger/pflog5min* ; do
			if [ -f "$logfile" ] ; then
				tcpdump -n -e -ttt -r $logfile | logger -t pf -p local0.info
				rm $logfile
			fi
		done
a286 17
Erstellen einen Cron-Job für den Benutzer <tt>pflogger</tt>:
<blockquote>
<tt>
# crontab -u pflogger -e
</tt>
</blockquote>

<p>
Fügen die folgenden beiden Zeilen ein:
<blockquote>
<tt>
# feed rotated pflog file(s) to syslog<br>
0-59/5 *       *       *       *       /bin/sh /home/pflogger/pfl2sysl
</tt>
</blockquote>

<p>
d310 2
a311 1
ist, in diese Datei aufzuzeichnen.
d314 2
a315 1
# touch /var/log/pflog.txt
d366 2
a367 2
Originally [OpenBSD: logging.html,v 1.26 ]<br>
$Translation: logging.html,v 1.18 2006/05/01 11:17:11 paldium Exp $<br>
@


1.17
log
@sync with Steelix CVS
@
text
@d62 1
a62 1
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=pflogd&amp;sektion=8&amp;manpath=OpenBSD+3.8"
d64 1
a64 1
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=pflog&amp;sektion=4&amp;manpath=OpenBSD+3.8"
d67 1
a67 1
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=tcpdump&amp;sektion=8&amp;manpath=OpenBSD+3.8"
d159 1
a159 1
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=telnet&amp;sektion=1&amp;manpath=OpenBSD+3.8"
d161 1
a161 1
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=ftp&amp;sektion=1&amp;manpath=OpenBSD+3.8"
d201 1
a201 1
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=tcpdump&amp;sektion=8&amp;manpath=OpenBSD+3.8"
d246 1
a246 1
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=syslogd&amp;sektion=8&amp;manpath=OpenBSD+3.8"
d255 1
a255 1
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=adduser&amp;sektion=8&amp;manpath=OpenBSD+3.8"
d345 1
a345 1
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=hosts&amp;sektion=5&amp;manpath=OpenBSD+3.8"
d373 1
a373 1
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=newsyslog&amp;sektion=8&amp;manpath=OpenBSD+3.8"
d404 2
a405 2
Originally [OpenBSD: logging.html,v 1.25 ]<br>
$Translation: logging.html,v 1.17 2006/04/24 17:44:30 paldium Exp $<br>
@


1.16
log
@sync with steelix translation CVS
@
text
@a5 1
<meta http-equiv="Content-Language" content="de">
d8 1
a8 1
<meta name="description"   content="Die OpenBSD-FAQ-Seite">
d404 2
a405 2
Originally [OpenBSD: logging.html,v 1.25 ]
$Translation: logging.html,v 1.16 2006/01/10 12:18:04 paldium Exp $
@


1.15
log
@sync with steelix translation CVS
@
text
@d169 1
a169 1
angesehen werden. Zum Beispiel kann folgendes verwendet werden, um
d210 1
a210 1
<li><tt>ifname <i>int</i></tt> - das gleiche wie <tt>on <i>int</i></tt>.
d406 1
a406 1
$Translation: logging.html,v 1.15 2006/01/04 11:32:23 paldium Exp $
@


1.14
log
@sync with steelix translation CVS
@
text
@d52 1
d73 47
d405 2
a406 2
Originally [OpenBSD: logging.html,v 1.24 ]
$Translation: logging.html,v 1.14 2005/12/12 09:37:45 paldium Exp $
@


1.13
log
@sync with steelix translation CVS
@
text
@d69 1
a69 1
die das <tt>log</tt>- oder <tt>log-all</tt>-Schlüsselwort mit angeben,
d357 2
a358 2
Originally [OpenBSD: logging.html,v 1.23 ]
$Translation: logging.html,v 1.13 2005/11/18 10:18:35 paldium Exp $
@


1.12
log
@sync with steelix translation CVS
@
text
@d218 1
d231 12
a242 6
	for logfile in /home/pflogger/pflog5min* ; do
	   if [ -s "$logfile" ]; then
	      tcpdump -n -e -ttt -r $logfile | logger -t pf -p local0.info
	      rm $logfile
	   fi
	done
d357 2
a358 2
Originally [OpenBSD: logging.html,v 1.22 ]
$Translation: logging.html,v 1.12 2005/11/04 11:01:45 paldium Exp $
@


1.11
log
@sync with Steelix CVS
@
text
@d62 1
a62 1
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=pflogd&amp;sektion=8&amp;manpath=OpenBSD+3.7"
d64 1
a64 1
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=pflog&amp;sektion=4&amp;manpath=OpenBSD+3.7"
d67 1
a67 1
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=tcpdump&amp;sektion=8&amp;manpath=OpenBSD+3.7"
d112 1
a112 1
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=telnet&amp;sektion=1&amp;manpath=OpenBSD+3.7"
d114 1
a114 1
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=ftp&amp;sektion=1&amp;manpath=OpenBSD+3.7"
d154 1
a154 1
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=tcpdump&amp;sektion=8&amp;manpath=OpenBSD+3.7"
d199 1
a199 1
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=syslogd&amp;sektion=8&amp;manpath=OpenBSD+3.7"
d208 1
a208 1
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=adduser&amp;sektion=8&amp;manpath=OpenBSD+3.7"
d291 1
a291 1
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=hosts&amp;sektion=5&amp;manpath=OpenBSD+3.7"
d319 1
a319 1
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=newsyslog&amp;sektion=8&amp;manpath=OpenBSD+3.7"
d350 2
a351 2
Originally [OpenBSD: logging.html,v 1.21 ]
$Translation: logging.html,v 1.11 2005/09/14 16:16:39 paldium Exp $
@


1.10
log
@sync with Steelix CVS
@
text
@d6 1
a8 1
<meta http-equiv="Content-Language" content="de">
d351 1
a351 1
$Translation: logging.html,v 1.10 2005/06/05 16:47:00 paldium Exp $
@


1.9
log
@sync with Steelix CVS
@
text
@d163 2
d350 2
a351 2
Originally [OpenBSD: logging.html,v 1.20 ]
$Translation: logging.html,v 1.9 2005/05/20 18:05:19 paldium Exp $
@


1.8
log
@sync with steelix translation CVS
@
text
@d322 1
a322 1
Ändere </tt>/etc/newsyslog.conf</tt> wie folgt:
d349 1
a349 1
$Translation: logging.html,v 1.8 2005/05/20 16:33:52 paldium Exp $
@


1.7
log
@Sync with Steelix CVS
@
text
@d62 1
a62 1
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=pflogd&amp;sektion=8&amp;manpath=OpenBSD+3.6"
d64 1
a64 1
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=pflog&amp;sektion=4&amp;manpath=OpenBSD+3.6"
d67 1
a67 1
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=tcpdump&amp;sektion=8&amp;manpath=OpenBSD+3.6"
d112 1
a112 1
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=telnet&amp;sektion=1&amp;manpath=OpenBSD+3.6"
d114 1
a114 1
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=ftp&amp;sektion=1&amp;manpath=OpenBSD+3.6"
d154 1
a154 1
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=tcpdump&amp;sektion=8&amp;manpath=OpenBSD+3.6"
d171 4
a174 1
<tt>memory</tt> und <tt>bad-timestamp</tt>.
d197 1
a197 1
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=syslogd&amp;sektion=8&amp;manpath=OpenBSD+3.6"
d206 1
a206 1
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=adduser&amp;sektion=8&amp;manpath=OpenBSD+3.6"
d289 1
a289 1
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=hosts&amp;sektion=5&amp;manpath=OpenBSD+3.6"
d317 1
a317 1
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=newsyslog&amp;sektion=8&amp;manpath=OpenBSD+3.6"
d348 2
a349 2
Originally [OpenBSD: logging.html,v 1.19 ]
$Translation: logging.html,v 1.7 2005/02/07 12:39:02 paldium Exp $
@


1.6
log
@Sync with Steelix CVS
@
text
@d16 1
a16 1
Copyright (c) 2003, 2004, Joel Knight <enabled@@myrealbox.com>
d170 2
a171 2
<tt>fragment</tt>, <tt>short</tt>, <tt>normalize</tt> und 
<tt>memory</tt>.
d345 2
a346 2
Originally [OpenBSD: logging.html,v 1.18 ]
$Translation: logging.html,v 1.6 2005/01/18 14:33:46 paldium Exp $
@


1.5
log
@Sync with Steelix CVS
@
text
@d9 1
a9 1
<meta name="description"   content="die OpenBSD-FAQ-Seite">
d344 5
a348 3
Originally [OpenBSD: logging.html,v 1.18 ]<br>
$Translation: logging.html,v 1.5 2004/12/22 12:29:53 paldium Exp $<br>
$OpenBSD: logging.html,v 1.18 2004/12/22 04:28:16 david Exp $
@


1.4
log
@Sync with Steelix CVS
@
text
@d36 3
a38 1
<img alt="[OpenBSD]" height=30 width=141 src="../../../images/smalltitle.gif">
d344 3
a346 3
Originally [OpenBSD: logging.html,v 1.17 ]<br>
$Translation: logging.html,v 1.4 2004/12/18 20:59:20 paldium Exp $<br>
$OpenBSD: logging.html,v 1.17 2004/12/17 21:46:19 nick Exp $
@


1.3
log
@sync with Steelix CVS
@
text
@d224 4
a227 2
	   tcpdump -n -e -ttt -r $logfile | logger -t pf -p local0.info
	   rm $logfile
d342 3
a344 3
Originally [OpenBSD: logging.html,v 1.16 ]<br>
$Translation: logging.html,v 1.3 2004/12/07 16:56:32 paldium Exp $<br>
$OpenBSD: logging.html,v 1.16 2004/10/29 17:22:57 nick Exp $
@


1.2
log
@Sync with Steelix CVS
@
text
@d8 2
a9 1
<meta name="description"   content="Die OpenBSD-FAQ-Seite">
d43 1
a43 1
<h1><font color="#e00000">PF: Logging</font></h1>
d100 1
a100 1
ein verzögerter Angriff möglich, indem die einzelnen Paket-Payloads mit
d109 1
a109 1
sensible Paket-Payloads ermöglichen (wie zum Beispiel
d166 1
a166 1
<li><tt>reason <i>res</i></tt> - Der Grund für die <tt>action</tt> (Aktion).
d198 1
a198 1
Zuerst müssen wir einen Benutzer, <tt>pflogger</tt>, anlegen, der eine
d309 1
a309 1
<tt>/var/log/pflog</tt>, sodass das Rotieren von <tt>pflog</tt> durch
d315 1
a315 1
Ändere </tt>/etc/newsyslog.conf</tt> wiefolgt:
d336 1
a336 1
<a href="index.html"><img height="24" width="24" src="../../images/back.gif" border="0" alt="[back]"></a> 
d340 2
a341 4
Originally [OpenBSD: logging.html,v 1.16 ]
<br>
$Translation: logging.html,v 1.2 2004/12/01 14:54:18 paldium Exp $
<br>
@


1.1
log
@Sync with Steelix CVS
@
text
@d4 1
a4 1
<title>PF: Logging</title>
d8 1
a8 1
<meta name="description"   content="the OpenBSD FAQ page">
a10 1
<meta name="copyright"     content="This document copyright 2003 by OpenBSD.">
d13 18
d37 3
a39 3
[<a href="filter.html">Previous: Packet Filtering</a>]
[<a href="index.html">Contents</a>]
[<a href="anchors.html">Next: Anchors and Named Rulesets</a>]
d46 1
a46 1
<h3>Table of Contents</h3>
d48 4
a51 4
<li><a href="#intro">Introduction</a>
<li><a href="#logfile">Reading a Log File</a>
<li><a href="#filter">Filtering Log Output</a>
<li><a href="#syslog">Packet Logging Through Syslog</a>
d57 11
a67 11
<h2>Introduction</h2>
Packet logging in PF is done by
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=pflogd&amp;sektion=8&amp;manpath=OpenBSD+3.4"
>pflogd(8)</a> which listens on the
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=pflog&amp;sektion=4&amp;manpath=OpenBSD+3.4"
>pflog0</a> interface and writes packets to a log file (normally
/var/log/pflog) in 
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=tcpdump&amp;sektion=8&amp;manpath=OpenBSD+3.4"
>tcpdump(8)</a> binary format. <a href="filter.html">Filter</a> rules
that specify the <tt>log</tt> or <tt>log-all</tt> keyword are logged in
this manner.
d70 4
a73 3
<h2>Reading a Log File</h2>
The log file written by pflogd is in binary format and cannot be read
using a text editor. Tcpdump must be used to view the log.
d76 1
a76 1
To view the log file:
d84 3
a86 3
Note that using tcpdump(8) to watch the pflog file does <i>not</i> give
a real-time display. A real-time display of logged packets is achieved
by using the pflog0 interface:
d94 19
a112 18
<font color="#e00000">NOTE: </font>
When examining the logs, special care should be taken with 
tcpdump's verbose protocol decoding (activated via the 
<tt>-v</tt> command line option). Tcpdump's protocol decoders do not
have a perfect security history.  At least in theory, a delayed attack
could be possible via the partial packet payloads recorded by the
logging device. It is recommended practice to move the log files off of
the firewall machine before examining them in this way.

<p>
Additional care should also be taken to secure access to the logs. By default, 
pflogd will record 96 bytes of the packet in the log file.  Access
to the logs could provide partial access to sensitive packet payloads
(like
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=telnet&amp;sektion=1&amp;manpath=OpenBSD+3.4"
>telnet(1)</a> or
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=ftp&amp;sektion=1&amp;manpath=OpenBSD+3.4"
>ftp(1)</a> usernames and passwords).
d115 5
a119 4
<h2>Filtering Log Output</h2>
Because pflogd logs in tcpdump binary format, the full range of tcpdump
features can be used when reviewing the logs. For example, to only see
packets that match a certain port:
d127 2
a128 2
This can be further refined by limiting the display of packets to a 
certain host and port combination:
d136 2
a137 1
The same idea can be applied when reading from the pflog0 interface:
d145 3
a147 3
Note that this has no impact on which packets are logged to the pflogd
log file; the above commands only display packets as they are being
logged.
d150 4
a153 4
In addition to using the standard 
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=tcpdump&amp;sektion=8&amp;manpath=OpenBSD+3.4"
>tcpdump(8)</a> filter rules, OpenBSD's tcpdump filter language has been
extended for reading pflogd output:
d155 13
a167 12
<li><tt>ip</tt> - address family is IPv4.
<li><tt>ip6</tt> - address family is IPv6.
<li><tt>on <i>int</i></tt> - packet passed through the interface
<i>int</i>.
<li><tt>ifname <i>int</i></tt> - same as <tt>on <i>int</i></tt>.
<li><tt>rulenum <i>num</i></tt> - the filter rule that the packet matched
was rule number <i>num</i>.
<li><tt>action <i>act</i></tt> - the action taken on the packet.
Possible actions are <tt>pass</tt> and <tt>block</tt>.
<li><tt>reason <i>res</i></tt> - the reason that <tt>action</tt> was 
taken. Possible reasons are <tt>match</tt>, <tt>bad-offset</tt>,
<tt>fragment</tt>, <tt>short</tt>, <tt>normalize</tt>, and 
d169 2
a170 2
<li><tt>inbound</tt> - packet was inbound.
<li><tt>outbound</tt> - packet was outbound.
d174 1
a174 1
Example:
d182 2
a183 2
This display the log, in real-time, of inbound packets that were blocked
on the wi0 interface.
d186 9
a194 8
<h2>Packet Logging Through Syslog</h2>
In many situations it is desirable to have the firewall logs available
in ASCII format and/or to send them to a remote logging server.  All
this can be accomplished with two small shell scripts, some minor
changes of the OpenBSD configuration files, and 
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=syslogd&amp;sektion=8&amp;manpath=OpenBSD+3.4"
>syslogd(8)</a>, the logging daemon. Syslogd logs in ASCII and
is also able to log to a remote logging server.
d197 4
a200 3
First we have to create a user, <tt>pflogger</tt>, with a
<tt>/sbin/nologin</tt> shell. The easiest way to create this user is with
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=adduser&amp;sektion=8&amp;manpath=OpenBSD+3.4"
d204 2
a205 2
After creating the user <tt>pflogger</tt>, create the following two
scripts:
d229 1
a229 1
Edit root's cron job:
d237 1
a237 1
Add the following two lines:
d246 1
a246 1
Create a cron job for user <tt>pflogger</tt>:
d254 1
a254 1
Add the following two lines:
d263 1
a263 1
Add the following line to <tt>/etc/syslog.conf</tt>:
d271 2
a272 1
If you also want to log to a remote log server, add the line:
d280 3
a282 3
Make sure host <i>syslogger</i> has been defined in the
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=hosts&amp;sektion=5&amp;manpath=OpenBSD+3.4"
>hosts(5)</a> file.
d285 10
a294 1
Make syslogd notice the changes by restarting it:
d302 3
a304 3
All logged packets are now sent to <tt>/var/log/pflog.txt</tt>.
If the second line is added they are sent to the remote logging host
<i>syslogger</i> as well.
d307 8
a314 7
The script <tt>/etc/pflogrotate</tt> now processes and then deletes
<tt>/var/log/pflog</tt> so rotation of <tt>pflog</tt> by
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=newsyslog&amp;sektion=8&amp;manpath=OpenBSD+3.4"
>newsyslog(8)</a> is no longer necessary and should be
disabled. However, <tt>/var/log/pflog.txt</tt> replaces
<tt>/var/log/pflog</tt> and rotation of it should be activated.
Change <tt>/etc/newsyslog.conf</tt> as follows:
d321 6
a326 5
PF will now log in ASCII to <tt>/var/log/pflog.txt</tt>. If so 
configured in <tt>/etc/syslog.conf</tt>, it will also log to a remote
server.  The logging is not immediate but can take up to about 5-6
minutes (the cron job interval) before the logged packets appear in the
file.
d329 3
a331 3
[<a href="filter.html">Previous: Packet Filtering</a>]
[<a href="index.html">Contents</a>]
[<a href="anchors.html">Next: Anchors and Named Rulesets</a>]
d335 1
a335 1
<a href="../../de/index.html"><img height="24" width="24" src="../../../images/back.gif" border="0" alt="[back]"></a> 
d339 5
a343 3
Originally [OpenBSD: logging.html,v 1.9 ]<br>
$Translation: logging.html,v 1.1 2003/11/27 17:34:57 sl Exp $<br>
$OpenBSD$
@

