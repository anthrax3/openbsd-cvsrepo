head	1.36;
access;
symbols;
locks; strict;
comment	@# @;


1.36
date	2014.04.01.17.18.45;	author nick;	state dead;
branches;
next	1.35;

1.35
date	2013.11.01.18.04.05;	author ajacoutot;	state Exp;
branches;
next	1.34;

1.34
date	2013.05.01.17.39.07;	author ajacoutot;	state Exp;
branches;
next	1.33;

1.33
date	2013.05.01.14.42.14;	author ajacoutot;	state Exp;
branches;
next	1.32;

1.32
date	2013.04.26.13.06.05;	author ajacoutot;	state Exp;
branches;
next	1.31;

1.31
date	2013.02.20.14.08.03;	author ajacoutot;	state Exp;
branches;
next	1.30;

1.30
date	2012.11.02.07.24.05;	author ajacoutot;	state Exp;
branches;
next	1.29;

1.29
date	2012.08.21.19.23.27;	author ajacoutot;	state Exp;
branches;
next	1.28;

1.28
date	2012.05.13.16.30.18;	author ajacoutot;	state Exp;
branches;
next	1.27;

1.27
date	2012.01.21.19.34.39;	author ajacoutot;	state Exp;
branches;
next	1.26;

1.26
date	2009.11.07.07.32.54;	author ajacoutot;	state Exp;
branches;
next	1.25;

1.25
date	2009.05.04.19.07.52;	author tobias;	state Exp;
branches;
next	1.24;

1.24
date	2008.11.01.11.02.22;	author tobias;	state Exp;
branches;
next	1.23;

1.23
date	2008.08.10.16.14.28;	author tobias;	state Exp;
branches;
next	1.22;

1.22
date	2008.03.09.13.37.13;	author tobias;	state Exp;
branches;
next	1.21;

1.21
date	2007.11.12.20.29.59;	author saad;	state Exp;
branches;
next	1.20;

1.20
date	2007.05.09.05.49.53;	author jufi;	state Exp;
branches;
next	1.19;

1.19
date	2007.04.26.03.08.06;	author jufi;	state Exp;
branches;
next	1.18;

1.18
date	2006.11.01.11.30.45;	author jufi;	state Exp;
branches;
next	1.17;

1.17
date	2006.10.29.10.58.52;	author jufi;	state Exp;
branches;
next	1.16;

1.16
date	2006.08.08.07.14.20;	author saad;	state Exp;
branches;
next	1.15;

1.15
date	2006.05.01.12.19.17;	author jufi;	state Exp;
branches;
next	1.14;

1.14
date	2006.04.25.08.25.49;	author saad;	state Exp;
branches;
next	1.13;

1.13
date	2006.02.12.20.34.43;	author jufi;	state Exp;
branches;
next	1.12;

1.12
date	2006.01.06.12.42.41;	author jufi;	state Exp;
branches;
next	1.11;

1.11
date	2005.11.04.20.24.23;	author jufi;	state Exp;
branches;
next	1.10;

1.10
date	2005.09.20.07.30.02;	author saad;	state Exp;
branches;
next	1.9;

1.9
date	2005.05.22.17.38.08;	author saad;	state Exp;
branches;
next	1.8;

1.8
date	2005.05.20.17.13.26;	author jufi;	state Exp;
branches;
next	1.7;

1.7
date	2005.05.19.18.23.06;	author jufi;	state Exp;
branches;
next	1.6;

1.6
date	2005.05.04.17.52.25;	author jufi;	state Exp;
branches;
next	1.5;

1.5
date	2005.01.18.17.18.10;	author jufi;	state Exp;
branches;
next	1.4;

1.4
date	2004.12.22.20.00.48;	author jufi;	state Exp;
branches;
next	1.3;

1.3
date	2004.12.08.05.22.44;	author saad;	state Exp;
branches;
next	1.2;

1.2
date	2004.12.01.19.35.52;	author jufi;	state Exp;
branches;
next	1.1;

1.1
date	2003.11.27.19.39.09;	author horacio;	state Exp;
branches;
next	;


desc
@@


1.36
log
@
missed another one...
@
text
@<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<html>
<head>
<title>PF: Network Address Translation (NAT)</title>
<link rev="made" href="mailto:www@@openbsd.org">
<meta http-equiv="Content-Type" content="text/html; charset=ISO-8859-1">
<meta name="resource-type" content="document">
<meta name="description"   content="the OpenBSD FAQ page">
<meta name="keywords"      content="openbsd,faq,pf">
<meta name="distribution"  content="global">
</head>

<!--
Copyright (c) 2003, Nick Holland <nick@@openbsd.org>
Copyright (c) 2003, 2004, Joel Knight <enabled@@myrealbox.com>

Permission to use, copy, modify, and distribute this documentation for
any purpose with or without fee is hereby granted, provided that the
above copyright notice and this permission notice appear in all copies.

THE DOCUMENTATION IS PROVIDED "AS IS" AND THE AUTHOR DISCLAIMS ALL
WARRANTIES WITH REGARD TO THIS DOCUMENTATION INCLUDING ALL IMPLIED
WARRANTIES OF MERCHANTABILITY AND FITNESS. IN NO EVENT SHALL THE
AUTHOR BE LIABLE FOR ANY SPECIAL, DIRECT, INDIRECT, OR CONSEQUENTIAL
DAMAGES OR ANY DAMAGES WHATSOEVER RESULTING FROM LOSS OF USE, DATA OR
PROFITS, WHETHER IN AN ACTION OF CONTRACT, NEGLIGENCE OR OTHER
TORTIOUS ACTION, ARISING OUT OF OR IN CONNECTION WITH THE USE OR
PERFORMANCE OF THIS DOCUMENTATION
-->

<body bgcolor="#ffffff" text="#000000">
<!-- Passes validator.w3.org, please keep it this way;
please, use a max of 72 chars per line -->

<a href="../../../de/index.html">
<img alt="[OpenBSD]" height=30 width=141 src="../../../images/smalltitle.gif" border="0">
</a>
<p>
[<a href="filter.html">Zurück: Pakete filtern</a>]
[<a href="index.html">Inhalt</a>]
[<a href="rdr.html">Weiter: Verkehr-Umleitung (Port-Weiterleitung)</a>]

<p>
<h1><font color="#e00000">PF: Network Address Translation (NAT)</font></h1>

<hr>

<h3>Inhaltsverzeichnis</h3>
<ul>
<li><a href="#intro">Einführung</a>
<li><a href="#works">Wie NAT funktioniert</a>
<li><a href="#ipfwd">IP-Weiterleitung</a>
<li><a href="#config">NAT konfigurieren</a>
<li><a href="#binat">Bidirektionales Mapping (1:1 mapping)</a>
<li><a href="#except">Übersetzungsregel-Ausnahmen</a>
<li><a href="#status">Den NAT-Status abfragen</a>
</ul>

<hr>

<a name="intro"></a>
<h2>Einführung</h2>
Network Address Translation (NAT) ist ein Weg, um ein gesamtes
Netzwerk (oder Netzwerke) einer einzigen IP-Adresse zuzuweisen.
NAT ist notwendig, wenn du mehr Rechner besitzt, denen du
Internetzugriff ermöglichen möchtest, als dir dein Internetanbieter
IP-Adressen bereitgestellt hat. Im
<a href="http://www.geektools.com/rfc/rfc1631.txt">RFC 1631</a>
»The IP Network Address Translator (NAT)« wird NAT beschrieben.

<p>
NAT erlaubt dir den Vorteil der reservierten Adressblöcke zu
nutzen, wie sie in
<a href="http://www.geektools.com/rfc/rfc1918.txt">RFC 1918</a>
»Address Allocation for Private Internets« beschrieben werden.
Normalerweise wird dein internes Netzwerk so eingerichtet sein, dass
einer dieser Netzwerkblöcke verwendet wird. Diese sind:
<pre>
        10.0.0.0/8       (10.0.0.0 - 10.255.255.255)
        172.16.0.0/12    (172.16.0.0 - 172.31.255.255)
        192.168.0.0/16   (192.168.0.0 - 192.168.255.255)
</pre>

<p>
Ein NAT ausführendes OpenBSD-System wird mindestens zwei Netzwerkschnittstellen
besitzen, eines in Richtung Internet, das andere in Richtung internes Netzwerk.
NAT wird die Anfragen des internen Netzwerk umschreiben, so dass es aussieht,
als ob sie einzig vom System mit OpenBSD-NAT kommen würden.

<a name="works"></a>
<h2>Wie NAT funktioniert</h2>
<p>
Wenn ein Client im internen Netzwerk eine Maschine im Internet
kontaktiert, sendet er IP-Pakete, die für diese Maschine bestimmt
sind. Diese Pakete beinhalten alle Adressinformationen, die benötigt
werden, um am Ziel anzukommen. NAT befasst sich mit diesen
Informationen:
<ul>
<li>Quell-IP-Adresse (zum Beispiel 192.168.1.35)
<li>Quell-TCP- oder -UDP-Port (zum Beispiel 2132)
</ul>

<p>
Wenn das Paket durch das NAT-Gateway gesendet wird, wird es so
modifiziert, dass es wirkt, als wenn es vom NAT-Gateway geschickt
worden wäre. Das NAT-Gateway wird sich die Änderungen in der
Statustabelle merken, sodass es a) die Änderungen für die
Antwortpakete wieder rückgängig machen kann und b) sicherstellen kann,
dass die Antwortpakete durch die Firewall gelassen und nicht geblockt
werden. Zum Beispiel können die folgenden Änderungen durchgeführt
werden:
<ul>
<li>Quell-IP: ersetzt mit der externen Adresse des Gateways
(zum Beispiel 24.5.0.5)
<li>Quell-Port: ersetzt mit einem zufällig gewählten, unbenutzten Port
des Gateways (zum Beispiel 53136)
</ul>

<p>
Weder die interne Maschine noch der Internethost wissen etwas von
diesen Übersetzungsschritten. Für die interne Maschine ist das
NAT-System einfach ein Internetgateway. Für den Internethost
scheinen die Pakete vom NAT-System direkt zu kommen; er weiß noch
nicht einmal, dass die interne Workstation überhaupt existiert.

<p>
Wenn der Internethost auf die Pakete der internen Maschine antwortet,
werden sie an die externe IP des NAT-Gateways (24.5.0.5) und den
Übersetzungsport (53136) gerichtet sein. Das NAT-Gateway durchsucht dann
die Statustabelle, ob die Antwortpakete zu einer bereits erstellten
Verbindung gehören. Ein einzigartiger Treffer (basierend auf der
IP/Port-Kombination) wird gefunden, der PF mitteilt, dass die
Pakete zu einer Verbindung gehören, die von der internen Maschine
192.168.1.35 eröffnet wurde. PF wird dann die entgegengesetzten
Änderungen, die an den gesendeten Paketen gemacht worden sind,
vornehmen und die Antwortpakete an die interne Maschine weiterleiten.

<p>
Die Übersetzung von ICMP-Paketen findet auf eine ähnliche Art und Weise
statt, aber ohne der Quellport-Modifizierung.

<!-- legacy anchor; can eventually be removed -->
<a name="filter"></a>
<a name="enable"></a>
<a name="ipfwd"></a>
<h2>IP-Weiterleitung</h2>
<p>
Da NAT fast ausschließlich auf Routern und Netzwerkgateways verwendet
wird, ist es wahrscheinlich notwendig, IP-Weiterleitung zu aktivieren,
sodass die Pakete zwischen den Netzwerkinterfaces der OpenBSD-Maschine
ausgetauscht werden können. IP-Weiterleitung wird über den
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=sysctl&amp;sektion=3"
>sysctl(3)</a>-Mechanismus aktiviert:
<blockquote>
<tt>
# sysctl net.inet.ip.forwarding=1<br>
# sysctl net.inet6.ip6.forwarding=1 <i>(wenn IPv6 verwendet wird)</i>
</tt>
</blockquote>

<p>
Um diese Änderungen dauerhaft zu machen, sollten die folgenden
Zeilen in die
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=sysctl.conf&amp;sektion=5"
><tt>/etc/sysctl.conf</tt></a> eingetragen werden:
<blockquote>
<tt>
net.inet.ip.forwarding=1<br>
net.inet6.ip6.forwarding=1
</tt>
</blockquote>

<p>
Diese Zeilen sind zwar in der Standardinstallation bereits vorhanden,
aber auskommentiert (vor ihnen steht eine Raute <tt>#</tt>).
Entferne die <tt>#</tt> und speicher die Datei. IP-Weiterleitung
wird aktiviert, wenn die Maschine neustartet.

<a name="config"></a>
<h2>NAT konfigurieren</h2>
<font color="#ff0000">Anmerkung:</font> Diese Information ist für OpenBSD 4.7.
Die Konfiguration von NAT unterschied sich in früheren Versionen signifikant.
<p>

NAT wird durch einen optionalen Parameter <tt>nat-to</tt> zu einer abgehenden
<tt>pass</tt>-Regel spezifiziert.
Oft wird, statt des direkten Setzens in der <tt>pass</tt>-Regel, eine
<tt>match</tt>-Regel benutzt.
Wird ein Paket durch eine <tt>match</tt>-Regel selektiert, so werden die
Parameter dieser Regel (z.&nbsp;B. <tt>nat-to</tt>) erinnert und auf das Paket
angewandt, wenn eine auf das Paket passende <tt>pass</tt>-Regel erreicht wird.
Dies erlaubt die Verarbeitung einer ganzen Klasse von Paketen durch eine
einzige <tt>match</tt>-Regel, woraufhin spezifische Entscheidungen darüber, ob
der Verkehr zugelassen werden soll, mit Hilfe von <tt>block</tt> und
<tt>pass</tt>-Regeln getroffen werden können.
<p>
Das generelle Format der <tt>pf.conf</tt> sieht in etwa so aus:
<blockquote>
<tt>
match out on <i>interface</i> [<i>af</i>] \<br>
&nbsp;&nbsp;&nbsp;from <i>src_addr</i> to <i>dst_addr</i> \<br>
&nbsp;&nbsp;&nbsp;nat-to <i>ext_addr</i> [<i>pool_type</i>] [static-port]<br>
...<br>
pass out [log] on <i>interface</i> [<i>af</i>] [proto <i>protocol]</i> \<br>
&nbsp;&nbsp;&nbsp;from <i>ext_addr</i> [port <i>src_port</i>] \<br>
&nbsp;&nbsp;&nbsp;to <i>dst_addr</i> [port <i>dst_port</i>]
</tt>
</blockquote>

<dl>
<dt><tt>match</tt>
<dd>Wenn ein Paket einen Regelsatz durchläuft und in einer <tt>match</tt>-Regel
eine Entsprechung findet, so werden alle spezifizierten optionalen Parameter
der Regel für die spätere Nutzung erinnert (sie werden »sticky« gemacht).

<dt><tt>pass</tt>
<dd>Diese Regel erlaubt die Übertragung des Pakets.
Wurde das Paket vorher einer <tt>match</tt>-Regel mit Parametern zugeordnet, so
werden selbige auf das Paket angewandt.
<tt>pass</tt>-Regeln können ihre eigenen Parameter haben; diese haben Vorrang
über Parameter, die in <tt>match</tt>-Regeln spezifiziert wurden.

<dt><tt>out</tt>
<dd>Spezifiziert die Richtung des Paketflusses, auf welche diese Regel
zutrifft.
<tt>nat-to</tt> darf nur auf ausgehende Pakete angewandt werden.

<dt><tt>log</tt>
<dd>Zeichne zutreffende Pakete mittels
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=pflogd&amp;sektion=8&amp;manpath=OpenBSD+5.4"
>pflogd(8)</a> auf.
Normalerweise wird nur das erste
zutreffende Paket aufgezeichnet. Damit alle Pakete protokolliert
werden verwende <tt>log (all)</tt>.

<dt><tt><i>interface</i></tt>
<dd>Der Name oder die Gruppe der Netzwerkschnittstelle, auf dem die Pakete
überstragen werden sollen.

<dt><tt><i>af</i></tt>
<dd>Die Adressfamilie: <tt>inet</tt> für IPv4 oder <tt>inet6</tt>
für IPv6. PF ist normalerweise in der Lage, das selbst anhand der
Quell/Ziel-Adresse(n) herauszufinden.

<dt><tt><i>protocol</i></tt>
<dd>Die Protokollfamilie (z.&nbsp;B. tcp, udp, icmp), deren Pakete erlaubt
werden sollen.
Wenn <i>src_port</i> oder <i>dst_port</i> spezifiziert sind, so <em>muss</em>
das Protokoll ebenfalls angegeben werden.

<dt><tt><i>src_addr</i></tt>
<dd>Die (interne) Quelladresse der Pakete, die übersetzt werden
sollen.
Die Quelladresse kann wie folgt angegeben werden:
<ul>
<li>Eine einzelne IPv4- oder IPv6-Adresse.
<li>Ein
<a href="http://public.swbell.net/dedicated/cidr.html">CIDR</a>-Netzwerkblock.
<li>Ein »fully qualified domain name«, der per DNS aufgelöst werden
kann, wenn der Regelsatz geladen wird. Alle resultierenden IP-Adressen
werden in die Regel eingesetzt.
<li>Der Name oder die Gruppe eines Netzwerkinterfaces. Jegliche
IP-Adressen, die dem Interface zugeordnet worden sind, werden in die
Regel zur Ladezeit eingesetzt.
<li>Der Name eines Netzwerkinterfaces, gefolgt von
<tt>/<i>netmask</i></tt> (z.&nbsp;B. <tt>/24</tt>). Jede IP-Adresse auf
dem Interface wird mit der Netzmaske kombiniert, um einen
CIDR-Netzwerkblock zu bilden, der in die Regel eingesetzt wird.
<li>Der Name oder die Gruppe eines Netzwerkinterfaces, gefolgt von einem
dieser Modifizierer:
  <ul>
  <li><tt>:network</tt> - fügt den CIDR-Netzwerkblock ein (z.&nbsp;B.
  192.168.0.0/24)
  <li><tt>:broadcast</tt> - fügt die Netzwerkbroadcastadresse ein
  (z.&nbsp;B. 192.168.0.255)
  <li><tt>:peer</tt> - fügt die IP-Adresse eines Peers von einem
  Point-to-Point-Link ein
  </ul>
  <dl>
  <dd>Zusätzlich kann der <tt>:0</tt>-Modifizierer einem
  Interfacenamen/der Interfacegruppe oder einem der vorher genannten
  Modifizierer angehängt werden, um PF mitzuteilen, dass keine
  IP-Adressaliase mit eingefügt werden sollen. Diese Modifizierer können
  ebenfalls verwendet werden, wenn das Interface sich in Klammern
  befindet. Beispiel: <tt>fxp0:network:0</tt>
  </dl>
<li>Eine <a href="tables.html">Tabelle</a>.
<li>Irgendeine der zuvor genannten Möglichkeiten, aber mit dem <tt>!</tt>-
(»nicht«) Modifizierer.
<li>Ein Satz an Adressen unter Verwendung einer
<a href="macros.html#lists">Liste</a>.
<li>Das Schlüsselwort <tt>any</tt>, das für alle Adressen steht
</ul>

<dt><tt><i>src_port</i></tt>
<dd>Der Quellport im Layer-4-Paketheader. Ports können wie folgt
angegeben werden:
<ul>
<li>Eine Nummer zwischen 1 und 65535
<li>Ein gültiger Servicename aus
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=services&amp;sektion=5"
><tt>/etc/services</tt></a>
<li>Ein Satz an Ports unter Verwendung einer
<a href="macros.html#lists">Liste</a>
<li>Ein Bereich:
	<ul>
	<li><tt>!=</tt> (ungleich)
	<li><tt>&lt;</tt> (kleiner als)
	<li><tt>&gt;</tt> (größer als)
	<li><tt>&lt;=</tt> (kleiner oder gleich)
	<li><tt>&gt;=</tt> (größer oder gleich)
	<li><tt>&gt;&lt;</tt> (Bereich)
	<li><tt>&lt;&gt;</tt> (invertierter Bereich)
	<dl>
	<dd>Die letzten beiden sind Binäroperatoren (sie nehmen zwei
	Argumente) und fügen diese Argumente nicht mit in den Bereich
	ein.
	</dl>
	<li><tt>:</tt> (inklusiver Bereich)
	<dl>
	<dd>Der Operator für den inklusiven Bereich ist ebenfalls ein
	Binäroperator und fügt die Argumente mit in den Bereich ein.
	</dl>
	</ul>
</ul>
Die <tt>port</tt>-Option wird normalerweise nicht in <tt>nat</tt>-Regeln
verwendet, da das Ziel normalerweise ist, NAT auf den Verkehr
auszuüben - unabhängig davon, welche Ports verwendet werden.

<dt><tt><i>dst_addr</i></tt>
<dd>Die Zieladresse der Pakete, die übersetzt werden sollen. Die
Zieladresse wird genauso wie die Quelladresse angegeben.

<dt><tt><i>dst_port</i></tt>
<dd>Der Zielport im Layer-4-Paketheader. Dieser Port wird genauso
wie der Quellport angegeben.

<dt><tt><i>ext_addr</i></tt>
<dd>Die externe (Übersetzungs-)Adresse des NAT-Gateways, die die
übersetzten Pakete annehmen soll. Die externe Adresse kann wie folgt
angegeben werden:
<ul>
<li>Eine einzelne IPv4- oder IPv6-Adresse.
<li>Ein
<a href="http://public.swbell.net/dedicated/cidr.html">CIDR</a>-Netzwerkblock.
<li>Ein »fully qualified domain name«, der per DNS aufgelöst werden
kann, wenn der Regelsatz geladen wird. Alle resultierenden IP-Adressen
werden in die Regel eingesetzt.
<li>Der Name oder die Gruppe der externen Netzwerkschnittstelle.
Alle IP-Adressen, die der Schnittstelle zugeordnet wurden, werden zur Ladezeit
in die Regel eingesetzt.
<li>Der Name des externen Netzwerkinterfaces in Klammern <tt>( )</tt>.
Dies teil PF mit, dass die Regel neugeladen werden soll, wenn die
IP-Adresse(n) des genannten Interfaces sich über DHCP oder dial-up
ändern. Somit mus der Regelsatz nicht immer neugeladen werden, wenn sich
die Adresse ändert.
<li>Der Name oder die Gruppe einer Netzwerkschnittstelle, gefolgt von einem
dieser Modifikatoren:
  <ul>
  <li><tt>:network</tt> - fügt den CIDR-Netzwerkblock ein (z.&nbsp;B.
  192.168.0.0/24)
  <li><tt>:peer</tt> - fügt die IP-Adresse eines Peers von einem
  Point-to-Point-Link ein
  </ul>
  <dl>
  <dd>Zusätzlich kann der Modifikator <tt>:0</tt> entweder an einen
  Schnittstellen- oder Gruppennamen oder aber an einen der oben genannten
  Modifikatoren angehängt werden, um PF mitzuteilen, dass es keinerlei
  IP-Adressen-Alias mit einfügen soll.
  Diese Modifikatoren können ebenfalls verwendet werden, wenn die Schnittstelle
  sich in Klammern befindet.
  Beispiel: <tt>fxp0:network:0</tt>.
  </dl>
<li>Ein Satz an Adressen unter Verwendung einer
<a href="macros.html#lists">Liste</a>.
</ul>

<dt><tt><i>pool_type</i></tt>
<dd>Gibt den Typ des <a href="pools.html">Adresspools</a> an, der
für die Übersetzung verwendet werden soll.

<dt><tt>static-port</tt>
<dd>Teilt PF mit, den Quellport in TCP- und UDP-Paketen nicht zu
verändern.

</dl>

<p>
Dies würde in der einfachsten Form zu Zeilen ähnlich den folgenden führen:
<blockquote>
<tt>
match out on tl0 from 192.168.1.0/24 to any nat-to 24.5.0.5<br>
pass on tl0 from 192.168.1.0/24 to any
</tt>
</blockquote>
oder du benutzt einfach
<blockquote>
<tt>
pass out on tl0 from 192.168.1.0/24 to any nat-to 24.5.0.5
</tt>
</blockquote>


<p>
Diese Regel besagt, dass NAT auf dem <tt>tl0</tt>-Interface für
alle Pakete ausgeführt werden soll, die von 192.168.1.0./24 aus kommen,
und sie mit der Quell-IP-Adresse von 24.5.0.5 übersetzt werden sollen.

<p>
Während die vorher genannte Regel korrekt ist, ist es keine empfohlene
Form. Die Verwaltung könnte schwierig sein, da jegliche Änderung an
den internen oder externen Netzwerknummern eine Änderung der Zeile
zur Folge hätte. Vergleiche sie stattdessen mit dieser einfacher zu
verwaltenen Zeile (<tt>tl0</tt> ist extern, <tt>dc0</tt> intern):
<blockquote>
<tt>
pass out on tl0 from dc0:network to any nat-to tl0
</tt>
</blockquote>

<p>
Der Vorteil sollte recht klar sein: du kannst die IP-Adressen von
einem der Interfaces ändern, ohne die Regeln ändern zu müssen.

<p>
Wenn ein Interfacename für die Übersetzungsadresse wie zuvor
angegeben wird, wird die IP-Adresse zur <i>Lade</i>zeit von pf.conf
ermittelt - nicht während der Verwendung! Wenn du DHCP verwendest, um
dein externes Interface zu konfigurieren, kann dies zu einem Problem
werden.  Wenn deine zugewiesene IP-Adresse sich ändert, wird NAT
weiterhin die hinausgehenden Pakete mit der alten IP-Adresse übersetzen.
Dies wird dazu führen, dass ausgehende Verbindungen nicht mehr
funktionieren werden. Um dies zu umgehen, kannst du PF sagen, dass die
Übersetzungsadresse automatisch aktualisiert werden soll, indem
Klammern um den Interfacenamen herum gesetzt werden:
<blockquote>
<tt>
pass out on tl0 from dc0:network to any nat-to (tl0)
</tt>
</blockquote>

<p>
Diese Methode funktioniert für Übersetzungen von IPv4- und
IPv6-Adressen.

<a name="binat"></a>
<h2>Bidirektionale Abbildung (1:1 Abbildung)</h2>
Eine bidirektionales Abbildung kann durch die Verwendung des Parameters
<tt>binat-to</tt> erzielt werden.
Eine <tt>binat-to</tt>-Regel etabliert eine Eins-zu-eins-Umsetzung zwischen
einer internen IP-Adresse und einer externen Adresse.
Dies kann zum Beispiel nützlich sein, um einen Webserver im internen Netzwerk
mit seiner eigenen externen IP-Adresse auszustatten.
Verbindungen aus dem Internet zu der externen Adresse werden zu der internen
Adresse übersetzt werden, und Verbindungen des Webservers (wie DNS-Anfragen)
werden auf die externe Adresse übersetzt.
TCP- und UDP-Ports werden niemals mit <tt>binat-to</tt>-Regeln modifiziert,
da sie von <tt>nat</tt>-Regeln erfaßt werden.

<p>
Beispiel:
<blockquote>
<tt>
web_serv_int = "192.168.1.100"<br>
web_serv_ext = "24.5.0.6"<br>
<br>
pass on tl0 from $web_serv_int to any binat-to $web_serv_ext<br>
</tt>
</blockquote>

<a name="except"></a>
<h2>Übersetzungsregel-Ausnahmen</h2>

Wenn du den meisten Verkehr Übersetzen musst, aber für einige Fälle Ausnahmen
benötigst, so stelle sicher das die Ausnahmen von Filterregeln behandelt
werden, die keinen nat-to-Parameter enthalten.
Zum Beispiel, wenn obiges NAT-Beispiel modifiziert werden würde, um so
auszusehen:

<blockquote>
<tt>
pass out on tl0 from 192.168.1.0/24 to any nat-to 24.2.74.79<br>
pass out on tl0 from 192.168.1.208 to any<br>
</tt>
</blockquote>

<p>
Dann würde das gesamte 192.168.1.0/24-Netzwerk alle Pakete auf die externe
Adresse 24.2.74.79 übersetzt bekommen, mit Ausnahme von 192.168.1.208.

<a name="status"></a>
<h2>Den NAT-Status abfragen</h2>
Um die aktiven NAT-Übersetzungen zu betrachten, wird
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=pfctl&amp;sektion=8&amp;manpath=OpenBSD+5.4"
>pfctl(8)</a> mit der Option <tt>-s state</tt> verwendet. Diese Option
wird alle momentanen NAT-Sitzungen auflisten:

<pre>
   # pfctl -s state
   fxp0 tcp 192.168.1.35:2132 (24.5.0.5:53136) -&gt; 65.42.33.245:22 TIME_WAIT:TIME_WAIT
   fxp0 udp 192.168.1.35:2491 (24.5.0.5:60527) -&gt; 24.2.68.33:53   MULTIPLE:SINGLE
</pre>

<p>
Erklärungen (nur die erste Zeile):

<dl>
<dt>fxp0
<dd>Gibt das Interface an, an welches der Status gebunden ist. Das Wort
<tt>self</tt> wird erscheinen, wenn der Status
<a href="options.html#state-policy">»<tt>floating«</tt>«</a> ist.
</dl>

<dl>
<dt>TCP
<dd>Das Protokoll, das von der Verbindung genutzt wird.
</dl>

<dl>
<dt>192.168.1.35:2132
<dd>Die IP-Adresse (192.168.1.35) der Maschine im internen Netzwerk.
Der Quellport (2132) wird nach der Adresse angezeigt. Dies ist ebenfalls
die Adresse, die im IP-Header ersetzt wird.
</dl>

<dl>
<dt>24.5.0.5:53136
<dd>Die IP-Adresse (24.5.0.5) und Port (53136) vom Gateway, mit denen
die Pakete übersetzt werden.
</dl>

<dl>
<dt>65.42.33.245:22
<dd>Die IP-Adresse (65.42.33.245) und der Port (22), mit denen die
interne Maschine verbunden ist.
</dl>

<dl>

<dt>TIME_WAIT:TIME_WAIT
<dd>Dies gibt an, was PF glaubt, zu welchem Status die TCP-Verbindung
gehört.
</dl>

<p>
[<a href="filter.html">Zurück: Pakete filtern</a>]
[<a href="index.html">Inhalt</a>]
[<a href="rdr.html">Weiter: Verkehr-Umleitung (Port-Weiterleitung)</a>]

<p>
<hr>
<a href="index.html"><img height="24" width="24" src="../../../images/back.gif" border="0" alt="[zurück]"></a>
<a href="mailto:www@@openbsd.org">www@@openbsd.org</a>
<br>
<small>
<!--
Originally [OpenBSD: nat.html,v 1.44 ]<br>
$Translation: nat.html,v 1.34 2013/11/01 16:59:45 steffen Exp $<br>
-->
$OpenBSD: nat.html,v 1.35 2013/11/01 18:04:05 ajacoutot Exp $
</small>

</body>
</html>
@


1.35
log
@Sync with Steelix CVS
@
text
@d560 1
a560 1
$OpenBSD$
@


1.34
log
@Sync with Steelix CVS
@
text
@d230 1
a230 1
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=pflogd&amp;sektion=8&amp;manpath=OpenBSD+5.3"
d494 1
a494 1
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=pfctl&amp;sektion=8&amp;manpath=OpenBSD+5.3"
d557 2
a558 2
Originally [OpenBSD: nat.html,v 1.43 ]<br>
$Translation: nat.html,v 1.33 2013/05/01 16:34:16 steffen Exp $<br>
@


1.33
log
@Sync with Steelix CVS
@
text
@d557 2
a558 2
Originally [OpenBSD: nat.html,v 1.42 ]<br>
$Translation: nat.html,v 1.32 2013/05/01 13:35:26 steffen Exp $<br>
@


1.32
log
@Sync with Steelix CVS
@
text
@d230 1
a230 1
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=pflogd&amp;sektion=8&amp;manpath=OpenBSD+5.2"
d494 1
a494 1
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=pfctl&amp;sektion=8&amp;manpath=OpenBSD+5.2"
d558 1
a558 1
$Translation: nat.html,v 1.31 2013/04/21 15:52:38 steffen Exp $<br>
@


1.31
log
@Sync with Steelix CVS
@
text
@d85 4
a88 5
Ein OpenBSD-System, das NAT durchführt, muss mindestens zwei
Netzwerkadapter besitzen: einen in Richtung Internet und die anderen
in Richtung internes Netzwerk. NAT wird die Anfragen vom internen
Netzwerk so übersetzen, dass sie so wirken, als wenn sie alle vom
OpenBSD-NAT-System kommen würden.
d557 2
a558 2
Originally [OpenBSD: nat.html,v 1.41 ]<br>
$Translation: nat.html,v 1.30 2013/02/20 09:44:31 steffen Exp $<br>
@


1.30
log
@Sync with Steelix CVS
@
text
@d259 1
a259 1
<a href="http://public.pacbell.net/dedicated/cidr.html">CIDR</a>-Netzwerkblock.
d346 1
a346 1
<a href="http://public.pacbell.net/dedicated/cidr.html">CIDR</a>-Netzwerkblock.
d558 2
a559 2
Originally [OpenBSD: nat.html,v 1.40 ]<br>
$Translation: nat.html,v 1.29 2012/11/01 20:43:18 steffen Exp $<br>
@


1.29
log
@Sync with Steelix CVS
@
text
@d231 1
a231 1
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=pflogd&amp;sektion=8&amp;manpath=OpenBSD+5.1"
d495 1
a495 1
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=pfctl&amp;sektion=8&amp;manpath=OpenBSD+5.1"
d558 2
a559 2
Originally [OpenBSD: nat.html,v 1.39 ]<br>
$Translation: nat.html,v 1.28 2012/08/18 11:44:14 steffen Exp $<br>
@


1.28
log
@Sync with Steelix CVS
@
text
@d350 3
a352 3
<li>Der Name des externen Netzwerkinterfaces. Jegliche IP-Adressen, die
dem Interface zugeordnet worden sind, werden in die Regel zur Ladezeit
eingesetzt.
d358 2
a359 2
<li>Der Name eines Netzwerkinterfaces, gefolgt von einem dieser
Modifizierer:
d367 7
a373 6
  <dd>Zusätzlich kann der <tt>:0</tt>-Modifizierer einem Interfacenamen
  oder einem der vorher genannten Modifizierer angehängt werden, um
  PF mitzuteilen, dass keine IP-Adressaliase mit eingefügt werden
  sollen. Diese Modifizierer können ebenfalls verwendet werden, wenn
  das Interface sich in Klammern befindet.
  Beispiel: <tt>fxp0:network:0</tt>
d558 2
a559 2
Originally [OpenBSD: nat.html,v 1.38 ]<br>
$Translation: nat.html,v 1.27 2012/05/11 17:06:29 steffen Exp $<br>
@


1.27
log
@Sync with Steelix CVS
@
text
@d231 1
a231 1
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=pflogd&amp;sektion=8&amp;manpath=OpenBSD+5.0"
d494 1
a494 1
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=pfctl&amp;sektion=8&amp;manpath=OpenBSD+5.0"
d557 2
a558 2
Originally [OpenBSD: nat.html,v 1.37 ]<br>
$Translation: nat.html,v 1.26 2012/01/20 20:21:49 steffen Exp $<br>
@


1.26
log
@Sync with Steelix CVS
@
text
@a51 1
<li><a href="#filter">NAT und das Filtern von Paketen</a>
d143 1
a144 17
<h2>NAT und das Filtern von Paketen</h2>
<p>
<font color="#ff0000">HINWEIS:</font> Übersetzte Pakete müssen weiterhin
die Filterengine durchlaufen und werden geblockt oder durchgelassen -
je nachdem, welche Filterregeln definiert wurden.
Die <i>einzige</i> Ausnahme zu dieser Regel ist, wenn das
<tt>pass</tt>-Schlüsselwort innerhalb der <tt>nat</tt>-Regel verwendet
wird. Dies hat zur Folge, dass NAT-Pakete direkt durch die Filterengine
gelassen werden.

<p>
Sei dir ebenfalls bewusst, dass - da die Übersetzung <i>vor</i> dem
Filtern stattfindet - die Filterengine die <i>übersetzten</i> Pakete
mit den übersetzten IP-Adressen und Ports sehen wird, wie es in
<a href="#works">Wie NAT funktioniert</a> beschrieben wurde.

<!-- legacy anchor; can eventually be removed -->
d182 17
a198 2
Das generelle Format der NAT-Regeln in <tt>pf.conf</tt> sieht so
ähnlich aus wie folgt:
d201 7
a207 4
nat [pass [log] on <i>interface</i> [<i>af</i>] from <i>src_addr</i>
[port <i>src_port</i>] to \<br>
&nbsp;&nbsp;&nbsp;<i>dst_addr</i> [port <i>dst_port</i>] -&gt;
<i>ext_addr</i> [<i>pool_type</i>] [static-port]
d212 4
a215 2
<dt><tt>nat</tt>
<dd>Das Schlüsselwort, das eine NAT-Regel einleitet.
d218 10
a227 2
<dd>Sorgt dafür, dass übersetzte Pakete komplett von den Filterregeln
unbeachtet bleiben.
d231 1
a231 1
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=pflogd&amp;sektion=8&amp;manpath=OpenBSD+4.6"
d238 2
a239 2
<dd>Der Name des Netzwerkinterfaces, auf dem die Pakete übersetzt
werden sollen.
d246 6
d389 8
a396 2
Dies würde zu der einfachsten Form einer Zeile führen, die dieser
ähnlich sein würde:
d399 1
a399 1
nat on tl0 from 192.168.1.0/24 to any -&gt; 24.5.0.5
d403 1
d417 1
a417 1
nat on tl0 from dc0:network to any -&gt; tl0
d438 1
a438 1
nat on tl0 from dc0:network to any -&gt; (tl0)
d447 12
a458 12
<h2>Bidirektionales Mapping (1:1 mapping)</h2>
Ein bidirektionales Mapping kann durch die Verwendung der
<tt>binat</tt>-Regel aufgebaut werden. Eine <tt>binat</tt>-Regel
erzeugt ein Eins-zu-eins-Mapping zwischen einer internen und einer
externen IP-Adresse. Dies kann sinnvoll sein, wenn beispielsweise
ein Webserver aus dem internen Netzwerk mit seiner eigenen externen
Adresse bereitgestellt werden soll. Verbindungen aus dem Internet
zur externen Adresse werden dann zur internen Adresse übersetzt und
Verbindungen vom Webserver (zum Beispiel DNS-Anfragen) werden mit
der externen Adresse übersetzt. TCP- und UDP-Ports werden niemals
mit <tt>binat</tt>-Regeln modifiziert wie es mit <tt>nat</tt>-Regeln
der Fall ist.
d467 1
a467 1
binat on tl0 from $web_serv_int to any -&gt; $web_serv_ext<br>
d473 7
a479 4
Ausnahmen bei den Übersetzungsregeln können unter Verwendung des
<tt>no</tt>-Schlüsselwortes gemacht werden. Wenn zum Beispiel das
vorherige NAT-Beispiel so modifiziert wurde, dass es nun wie folgt
aussieht:
d482 2
a483 2
no nat on tl0 from 192.168.1.208 to any<br>
nat on tl0 from 192.168.1.0/24 to any -&gt; 24.2.74.79
d488 2
a489 8
Dann werden für das gesamte 192.168.1.0/24-Netzwerk alle Pakete
zur externen Adresse 24.2.74.79 übersetzt, nur nicht für 192.168.1.208.

<p>
Bedenke, dass die erste zutreffende Regel gewinnt; wenn es eine
<tt>no</tt>-Regel ist, dann wird das Paket nicht übersetzt. Das
<tt>no</tt>-Schlüsselwort kann ebenfalls mit <tt>binat</tt>-
und <a href="rdr.html"><tt>rdr</tt></a>-Regeln verwendet werden.
d494 1
a494 1
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=pfctl&amp;sektion=8&amp;manpath=OpenBSD+4.6"
d500 2
a501 2
   fxp0 TCP 192.168.1.35:2132 -&gt; 24.5.0.5:53136 -&gt; 65.42.33.245:22 TIME_WAIT:TIME_WAIT
   fxp0 UDP 192.168.1.35:2491 -&gt; 24.5.0.5:60527 -&gt; 24.2.68.33:53   MULTIPLE:SINGLE
d557 2
a558 2
Originally [OpenBSD: nat.html,v 1.31 ]<br>
$Translation: nat.html,v 1.25 2009/11/05 12:55:49 tobias Exp $<br>
@


1.25
log
@Sync with Steelix CVS
@
text
@d220 1
a220 1
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=pflogd&amp;sektion=8&amp;manpath=OpenBSD+4.5"
d473 1
a473 1
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=pfctl&amp;sektion=8&amp;manpath=OpenBSD+4.5"
d536 2
a537 2
Originally [OpenBSD: nat.html,v 1.30 ]<br>
$Translation: nat.html,v 1.24 2009/05/03 12:44:32 tobias Exp $<br>
@


1.24
log
@Sync with Steelix CVS
@
text
@d220 1
a220 1
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=pflogd&amp;sektion=8&amp;manpath=OpenBSD+4.4"
d473 1
a473 1
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=pfctl&amp;sektion=8&amp;manpath=OpenBSD+4.4"
d536 2
a537 2
Originally [OpenBSD: nat.html,v 1.29 ]<br>
$Translation: nat.html,v 1.23 2008/11/01 09:15:07 paldium Exp $<br>
@


1.23
log
@Sync with Steelix CVS
@
text
@d220 1
a220 1
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=pflogd&amp;sektion=8&amp;manpath=OpenBSD+4.3"
d473 1
a473 1
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=pfctl&amp;sektion=8&amp;manpath=OpenBSD+4.3"
d536 2
a537 2
Originally [OpenBSD: nat.html,v 1.28 ]<br>
$Translation: nat.html,v 1.22 2008/08/04 14:41:05 paldium Exp $<br>
@


1.22
log
@Sync with Steelix CVS
@
text
@d220 1
a220 1
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=pflogd&amp;sektion=8&amp;manpath=OpenBSD+4.2"
d473 1
a473 1
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=pfctl&amp;sektion=8&amp;manpath=OpenBSD+4.2"
d536 2
a537 2
Originally [OpenBSD: nat.html,v 1.27 ]<br>
$Translation: nat.html,v 1.21 2008/03/04 23:03:18 paldium Exp $<br>
@


1.21
log
@Sync with Steelix CVS
@
text
@d117 1
a117 1
<li>Quell-Port: ersetzt mit einem zufällig gewählten, unbenutzen Port
d149 1
a149 1
jenachdem, welche Filterregeln definiert wurden.
d475 1
a475 1
wird alle momentanten NAT-Sitzungen auflisten:
d537 1
a537 1
$Translation: nat.html,v 1.20 2007/11/03 10:45:43 paldium Exp $<br>
@


1.20
log
@Sync with steelix translation CVS
@
text
@d109 1
a109 1
Statustabelle merken, so dass es a) die Änderungen für die
d168 1
a168 1
so dass die Pakete zwischen den Netzwerkinterfaces der OpenBSD-Maschine
d203 1
a203 1
nat [pass [log]] on <i>interface</i> [<i>af</i>] from <i>src_addr</i>
d219 4
a222 3
<dd>Wenn <tt>pass</tt> angegeben wird, können Pakete mittels
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=pflogd&amp;sektion=8&amp;manpath=OpenBSD+4.1"
>pflogd(8)</a> aufgezeichnet werden. Normalerweise wird nur das erste
d473 1
a473 1
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=pfctl&amp;sektion=8&amp;manpath=OpenBSD+4.1"
d536 2
a537 2
Originally [OpenBSD: nat.html,v 1.26 ]<br>
$Translation: nat.html,v 1.19 2007/05/08 21:34:45 simon Exp $<br>
@


1.19
log
@Sync with steelix translation CVS
@
text
@d170 1
a170 1
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=sysctl&amp;sektion=3&amp;manpath=OpenBSD+4.0"
d182 1
a182 1
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=sysctl.conf&amp;sektion=5&amp;manpath=OpenBSD+4.0"
d220 1
a220 1
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=pflogd&amp;sektion=8&amp;manpath=OpenBSD+4.0"
d284 1
a284 1
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=services&amp;sektion=5&amp;manpath=OpenBSD+4.0"
d472 1
a472 1
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=pfctl&amp;sektion=8&amp;manpath=OpenBSD+4.0"
d535 2
a536 2
Originally [OpenBSD: nat.html,v 1.25 ]<br>
$Translation: nat.html,v 1.18 2007/04/25 15:41:14 paldium Exp $<br>
@


1.18
log
@sync with steelix translation CVS
@
text
@d192 1
a192 1
Diese Zeilen sind zwar in der Standardinstallation bereits vorhanden, 
d203 1
a203 1
nat [pass [log]] on <i>interface</i> [<i>af</i>] from <i>src_addr</i> 
d205 1
a205 1
&nbsp;&nbsp;&nbsp;<i>dst_addr</i> [port <i>dst_port</i>] -&gt; 
d536 1
a536 1
$Translation: nat.html,v 1.17 2006/11/01 10:48:51 paldium Exp $<br>
d542 1
a542 1
</html> 
@


1.17
log
@sync with steelix translation CVS
@
text
@d170 1
a170 1
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=sysctl&amp;sektion=3&amp;manpath=OpenBSD+3.9"
d182 1
a182 1
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=sysctl.conf&amp;sektion=5&amp;manpath=OpenBSD+3.9"
d220 1
a220 1
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=pflogd&amp;sektion=8&amp;manpath=OpenBSD+3.9"
d245 3
a247 3
<li>Der Name eines Netzwerkinterfaces. Jegliche IP-Adressen, die dem
Interface zugeordnet worden sind, werden in die Regel zur Ladezeit
eingesetzt.
d252 2
a253 2
<li>Der Name eines Netzwerkinterfaces, gefolgt von einem dieser
Modifizierer:
d263 6
a268 6
  <dd>Zusätzlich kann der <tt>:0</tt>-Modifizierer einem Interfacenamen
  oder einem der vorher genannten Modifizierer angehängt werden, um
  PF mitzuteilen, dass keine IP-Adressaliase mit eingefügt werden
  sollen. Diese Modifizierer können ebenfalls verwendet werden, wenn
  das Interface sich in Klammern befindet.
  Beispiel: <tt>fxp0:network:0</tt>
d284 1
a284 1
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=services&amp;sektion=5&amp;manpath=OpenBSD+3.9"
d472 1
a472 1
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=pfctl&amp;sektion=8&amp;manpath=OpenBSD+3.9"
d535 2
a536 2
Originally [OpenBSD: nat.html,v 1.24 ]<br>
$Translation: nat.html,v 1.16 2006/10/29 09:44:48 paldium Exp $<br>
@


1.16
log
@sync with Steelix CVS
@
text
@d70 1
a70 1
wird NAT beschrieben.
d76 3
a78 3
beschrieben werden. Normalerweise wird dein internes Netzwerk so
eingerichtet sein, dass einer dieser Netzwerkblöcke verwendet wird.
Diese sind:
d535 2
a536 2
Originally [OpenBSD: nat.html,v 1.23 ]<br>
$Translation: nat.html,v 1.15 2006/08/06 14:06:56 paldium Exp $<br>
@


1.15
log
@3.9 release time.
@
text
@d66 3
a68 4
NAT ist notwendig, wenn dir eine Anzahl von IP-Adressen von deinem
Internet-Anbieter zur Verfügung gestellt wurde, die geringer ist
als die Gesamtanzahl an Rechnern, denen du Internetzugriff ermöglichen
möchtest. NAT wird im
d70 1
a70 1
beschrieben.
d76 3
a78 3
beschrieben werden.
Normalerweise wird dein internes Netzwerk so eingerichtet sein, dass einer
dieser Netzwerkblöcke verwendet wird. Diese sind:
d87 1
a87 1
Netzwerk-Adapter besitzen, einen in Richtung Internet und die anderen
d97 3
a99 2
sind. Diese Pakete beinhalten alle Adress-Informationen, die benötigt
sind, um am Ziel anzukommen. NAT befasst sich mit diesen Informationen:
d108 4
a111 4
worden sind. Das NAT-Gateway wird sich die Änderungen in der
,state'-Tabelle merken, so dass es a) die Änderungen für die
Antwort-Pakete wieder rückgängig machen kann und b) sicherstellen kann,
dass die Antwort-Pakete durch die Firewall gelassen und nicht geblockt
d117 2
a118 2
<li>Quell-Port: ersetzt mit einem zufällig gewählten, unbenutzen Port des
Gateways (zum Beispiel 53136)
d122 3
a124 3
Weder die interne Maschine noch der Internet-Host wissen etwas von
diesen Übersetzungs-Schritten. Für die interne Maschine ist das
NAT-System einfach ein Internet-Gateway. Für den Internet-Host
d129 1
a129 1
Wenn der Internet-Host auf die Pakete der internen Maschine antwortet,
d131 4
a134 4
Übersetzungs-Port (53136) gerichtet sein. Das NAT-Gateway durchsucht dann
die ,state'-Tabelle, ob die Antwort-Pakete zu einer bereits erstellten
Verbindung gehören. Ein einzigartiger Treffer, basierend auf der
IP/Port-Kombination, wird gefunden, welcher PF mitteilt, dass die
d137 2
a138 2
Änderungen, die an den Paketen, die hinausgingen, gemacht worden sind,
vornehmen und die Antwort-Pakete an die interne Maschine weiterleiten.
d142 1
a142 1
statt, aber ohne der Quell-Port-Modifizierung.
d148 2
a149 2
die Filter-Engine durchlaufen und werden geblockt oder durchgelassen,
jenachdem, welche Filterregeln definiert worden sind.
d152 1
a152 2
wird.
Dies hat zur Folge, dass NAT-Pakete direkt durch die Filter-Engine
d156 3
a158 3
Sei dir ebenfalls bewusst, dass, da die Übersetzung <i>vor</i> dem
Filtern stattfindet, die Filter-Engine die <i>übersetzten</i> Pakete
mit den übersetzten IP-Adressen und Ports sehen, wie es in
d166 1
a166 1
Da NAT fast ausschließlich auf Routern und Netzwerk-Gateways verwendet
d168 2
a169 2
so dass die Pakete zwischen den Netzwerk-Interfaces der OpenBSD-Maschine
ausgetauscht werden können. IP-Weiterleitung wird durch den
d181 1
a181 1
Zeilen der
d183 1
a183 1
><tt>/etc/sysctl.conf</tt></a> hinzugefügt werden:
d192 2
a193 2
Diese Zeilen sind in der Standard-Installation bereits vorhanden, aber
auskommentiert (vor ihnen steht eine Raute <tt>#</tt>).
d226 1
a226 1
<dd>Der Name des Netzwerk-Interfaces, auf dem die Pakete übersetzt
d230 1
a230 1
<dd>Die Adress-Familie, entweder <tt>inet</tt> für IPv4 oder <tt>inet6</tt>
d232 1
a232 1
Quell-/Ziel-Adresse(n) herauszufinden.
d235 1
a235 1
<dd>Die Quell- (interne) Adresse der Pakete, die übersetzt werden
d237 1
a237 1
Die Quell-Adresse kann wie folgt angegeben werden:
d242 4
a245 4
<li>Ein ,fully qualified domain name', der per DNS aufgelöst werden kann,
wenn der Regelsatz geladen wird. Alle resultierenden IP-Adressen werden in
die Regel eingesetzt.
<li>Der Name eines Netzwerk-Interfaces. Jegliche IP-Adressen, die dem
d248 5
a252 5
<li>Der Name eines Netzwerk-Interfaces, gefolgt von
<tt>/<i>netmask</i></tt> (z.B. <tt>/24</tt>). Jede IP-Adresse auf dem
Interface wird mit der Netzmaske kombiniert, um einen CIDR-Netzwerkblock
zu bilden, der in die Regel eingesetzt wird.
<li>Der Name eines Netzwerk-Interfaces, gefolgt von einem dieser
d255 1
a255 1
  <li><tt>:network</tt> - fügt den CIDR-Netzwerkblock ein (z.B.
d257 2
a258 2
  <li><tt>:broadcast</tt> - fügt die Netzwerk-Broadcast-Adresse ein
  (z.B. 192.168.0.255)
d265 1
a265 1
  PF mitzuteilen, dass keine IP-Adress-Aliase mit eingefügt werden
d272 1
a272 1
(,nicht') Modifizierer.
d279 1
a279 1
<dd>Der Source-Port im Layer-4-Paket-Header. Ports können wie folgt
d298 3
a300 2
	<dd>Die letzten beiden sind Binär-Operatoren (sie nehmen zwei
	Argumente) und fügen diese Argumente nicht mit in den Bereich ein.
d305 1
a305 1
	Binär-Operator und fügt die Argumente mit in den Bereich ein.
d311 1
a311 1
auszuüben, unabhängig davon, welche Ports verwendet werden.
d314 2
a315 2
<dd>Die Ziel-Adresse der Pakete, die übersetzt werden sollen. Die
Ziel-Adresse wird genauso wie die Quell-Adresse angegeben.
d318 2
a319 2
<dd>Der Ziel-Port im Layer-4-Paket-Header. Dieser Port wird genauso
wie der Quell-Port angegeben.
d323 1
a323 1
übersetzten Pakete annehmen sollen. Die externe Adresse kann wie folgt
d329 4
a332 4
<li>Ein ,fully qualified domain name', der per DNS aufgelöst werden kann,
wenn der Regelsatz geladen wird. Alle resultierenden IP-Adressen werden in
die Regel eingesetzt.
<li>Der Name des externen Netzwerk-Interfaces. Jegliche IP-Adressen, die
d335 1
a335 1
<li>Der Name des externen Netzwerk-Interfaces in Klammern <tt>( )</tt>.
d337 2
a338 2
IP-Adresse(n) des genannten Interfaces sich über DHCP oder ,dial-up'
ändern, da der Regelsatz nicht immer neugeladen werden muss, wenn sich
d340 1
a340 1
<li>Der Name eines Netzwerk-Interfaces, gefolgt von einem dieser
d343 1
a343 1
  <li><tt>:network</tt> - fügt den CIDR-Netzwerkblock ein (z.B.
d351 1
a351 1
  PF mitzuteilen, dass keine IP-Adress-Aliase mit eingefügt werden
d361 1
a361 1
<dd>Gibt den Typ des <a href="pools.html">Adress-Pools</a> an, der
d365 1
a365 1
<dd>Teilt PF mit, den Quell-Port in TCP- und UDP-Paketen nicht zu
d401 1
a401 1
Wenn ein Interfacename für die Übersetzungs-Adresse wie zuvor
d403 8
a410 8
ermittelt, nicht während der Verwendung. Wenn du DHCP verwendet, um dein
externes Interface zu konfigurieren, kann dies zu einem Problem werden.
Wenn deine zugewiesene IP-Adresse sich ändert, wird NAT weiterhin die
Pakete, die hinausgehen, mit der alten IP-Adresse übersetzen. Dies
wird dazu führen, dass ausgehende Verbindungen nicht mehr funktionieren
werden. Um dies zu umgehen, kannst du PF sagen, dass die
Übersetzungs-Adresse automatisch aktualisiert werden soll, indem
Klammern um den Interface-Namen herum gesetzt werden:
d418 2
a419 1
Diese Methode funktioniert für Übersetzungen von IPv4- und IPv6-Adressen.
d425 1
a425 1
erzeugt ein eins-zu-eins-Mapping zwischen einer internen und einer
d473 1
a473 1
>pfctl(8)</a> mit der <tt>-s state</tt>-Option verwendet. Diese Option
d487 3
a489 3
<dd>Gibt das Interface an, an welches der ,state' gebunden ist. Das Wort
<tt>self</tt> wird erscheinen, wenn der ,state'
<a href="options.html#state-policy"><tt>,floating'</tt></a> ist.
d500 1
a500 1
Der Quell-Port (2132) wird nach der Adresse angezeigt. Dies ist ebenfalls
d519 2
a520 1
<dd>Dies gibt an, was PF glaubt, zu welchem ,state' die TCP-Verbindung gehört.
d536 1
a536 1
$Translation: nat.html,v 1.14 2006/05/01 11:17:11 paldium Exp $<br>
@


1.14
log
@sync with Steelix CVS
@
text
@d171 1
a171 1
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=sysctl&amp;sektion=3&amp;manpath=OpenBSD+3.8"
d183 1
a183 1
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=sysctl.conf&amp;sektion=5&amp;manpath=OpenBSD+3.8"
d221 1
a221 1
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=pflogd&amp;sektion=8&amp;manpath=OpenBSD+3.8"
d285 1
a285 1
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=services&amp;sektion=5&amp;manpath=OpenBSD+3.8"
d471 1
a471 1
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=pfctl&amp;sektion=8&amp;manpath=OpenBSD+3.8"
d533 2
a534 2
Originally [OpenBSD: nat.html,v 1.22 ]<br>
$Translation: nat.html,v 1.13 2006/04/24 17:44:30 paldium Exp $<br>
@


1.13
log
@sync with steelix translation CVS
@
text
@a5 1
<meta http-equiv="Content-Language" content="de">
d8 1
a8 1
<meta name="description"   content="Die OpenBSD-FAQ-Seite">
d533 2
a534 2
Originally [OpenBSD: nat.html,v 1.22 ]
$Translation: nat.html,v 1.12 2006/02/12 20:23:54 jufi Exp $
@


1.12
log
@sync with steelix translation CVS
@
text
@d222 1
a222 1
a href="http://www.openbsd.org/cgi-bin/man.cgi?query=pflogd&amp;sektion=8&amp;manpath=OpenBSD+3.8"
d535 1
a535 1
$Translation: nat.html,v 1.11 2006/01/03 12:35:11 paldium Exp $
@


1.11
log
@sync with steelix translation CVS
@
text
@d205 1
a205 1
nat [pass] on <i>interface</i> [<i>af</i>] from <i>src_addr</i> 
d220 7
d534 2
a535 2
Originally [OpenBSD: nat.html,v 1.21 ]
$Translation: nat.html,v 1.10 2005/11/04 11:01:45 paldium Exp $
@


1.10
log
@sync with Steelix CVS
@
text
@d172 1
a172 1
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=sysctl&amp;sektion=3&amp;manpath=OpenBSD+3.7"
d184 1
a184 1
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=sysctl.conf&amp;sektion=5&amp;manpath=OpenBSD+3.7"
d279 1
a279 1
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=services&amp;sektion=5&amp;manpath=OpenBSD+3.7"
d465 1
a465 1
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=pfctl&amp;sektion=8&amp;manpath=OpenBSD+3.7"
d527 2
a528 2
Originally [OpenBSD: nat.html,v 1.20 ]
$Translation: nat.html,v 1.9 2005/09/14 16:16:39 paldium Exp $
@


1.9
log
@sync with Steelix CVS
@
text
@d6 1
a8 1
<meta http-equiv="Content-Language" content="de">
d528 1
a528 1
$Translation: nat.html,v 1.8 2005/05/20 18:05:19 paldium Exp $
@


1.8
log
@sync with steelix translation CVS
@
text
@d326 2
a327 2
<li>Der Name eines Netzwerk-Interfaces. Jegliche IP-Adressen, die dem
Interface zugeordnet worden sind, werden in die Regel zur Ladezeit
d329 5
a333 4
<li>Der Name eines Netzwerk-Interfaces, gefolgt von
<tt>/<i>netmask</i></tt> (z.B. <tt>/24</tt>). Jede IP-Adresse auf dem
Interface wird mit der Netzmaske kombiniert, um einen CIDR-Netzwerkblock
zu bilden, der in die Regel eingesetzt wird.
a338 2
  <li><tt>:broadcast</tt> - fügt die Netzwerk-Broadcast-Adresse ein
  (z.B. 192.168.0.255)
a349 3
<li>Eine <a href="tables.html">Tabelle</a>.
<li>Irgendeine der zuvor genannten Möglichkeiten, aber mit dem <tt>!</tt>-
(,nicht') Modifizierer.
a351 1
<li>Das Schlüsselwort <tt>any</tt>, das für alle Adressen steht
d466 1
a466 1
>pfctl(8)</a> mit der <tt>-s state</t>-Option verwendet. Diese Option
d528 1
a528 1
$Translation: nat.html,v 1.7 2005/05/20 16:33:52 paldium Exp $
@


1.7
log
@sync with steelxi translation CVS
@
text
@d172 1
a172 1
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=sysctl&amp;sektion=3&amp;manpath=OpenBSD+3.6"
d184 1
a184 1
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=sysctl.conf&amp;sektion=5&amp;manpath=OpenBSD+3.6"
d279 1
a279 1
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=services&amp;sektion=5&amp;manpath=OpenBSD+3.6"
d470 1
a470 1
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=pfctl&amp;sektion=8&amp;manpath=OpenBSD+3.6"
d532 2
a533 2
Originally [OpenBSD: nat.html,v 1.19 ]
$Translation: nat.html,v 1.6 2005/04/25 18:16:47 paldium Exp $
@


1.6
log
@huge sync from the translators
@
text
@@


1.5
log
@Sync with Steelix CVS
@
text
@d67 1
a67 1
NAT ist notwendig, wenn dir eine Anzahl an IP-Adressen von deinem
d533 1
a533 1
$Translation: nat.html,v 1.5 2005/01/18 14:33:46 paldium Exp $
@


1.4
log
@Sync with Steelix CVS
@
text
@d9 1
a9 1
<meta name="description"   content="die OpenBSD-FAQ-Seite">
d531 5
a535 3
Originally [OpenBSD: nat.html,v 1.19 ]<br>
$Translation: nat.html,v 1.4 2004/12/22 12:29:53 paldium Exp $<br>
$OpenBSD: nat.html,v 1.19 2004/12/22 04:28:16 david Exp $
@


1.3
log
@sync with Steelix CVS
@
text
@d36 3
a38 1
<img alt="[OpenBSD]" height=30 width=141 src="../../../images/smalltitle.gif">
d531 3
a533 3
Originally [OpenBSD: nat.html,v 1.18 ]<br>
$Translation: nat.html,v 1.3 2004/12/07 16:56:32 paldium Exp $<br>
$OpenBSD: nat.html,v 1.18 2004/11/01 21:41:07 nick Exp $
@


1.2
log
@Sync with Steelix CVS
@
text
@d8 2
a9 1
<meta name="description"   content="Die OpenBSD-FAQ-Seite">
d36 1
a36 1
<img alt="[OpenBSD]" height=30 width=141 src="../../images/smalltitle.gif">
d78 1
a78 1
dieser Netzwerkblöcke verwenden wird. Diese sind:
d100 2
a101 2
<li>Source-IP-Adresse (zum Beispiel 192.168.1.35)
<li>Source-TCP- oder -UDP-Port (zum Beispiel 2132)
d106 1
a106 1
modifiziert, dass es wirkt, als wenn sie vom NAT-Gateway geschickt
d108 3
a110 3
,state'-Tabelle merken, sodass es a) die Änderungen für die
Antwort-Pakete wieder rückgängig machen kann und b) sicherstellen,
dass die Antwortpakete durch die Firewall gelassen und nicht geblockt
d114 1
a114 1
<li>Source-IP: ersetzt mit der externen Adresse des Gateways
d116 1
a116 1
<li>Source-Port: ersetzt mit einem zufällig gewähltem, unbenutzen Port des
d136 1
a136 1
Änderungen, die an den Paketen gemacht worden sind, die hinausgingen,
d141 1
a141 1
statt, aber ohne der Source-Port-Modifizierung.
d158 1
a158 1
mit den übersetzten IP-Adressen und Port sehen, wie es in
d168 1
a168 1
sodass die Pakete zwischen den Netzwerk-Interfaces der OpenBSD-Maschine
d175 1
a175 1
# sysctl net.inet6.ip6.forwarding=1 <i>(if using IPv6)</i>
d200 1
a200 1
ähnlich aus wiefolgt:
d225 1
a225 1
Source-/Ziel-Adresse(n) herauszufinden.
d228 1
a228 1
<dd>Die Source- (interne) Adresse der Pakete, die übersetzt werden
d230 1
a230 1
Die Source-Adresse kann wiefolgt angegeben werden:
d253 1
a253 1
  Point-to-Point-Link
d272 1
a272 1
<dd>Der Source-Port im Layer-4-Paket-Header. Ports können wiefolgt
d276 1
a276 1
<li>Ein gültiger Service-Name aus
d296 2
a297 2
	<dd>Der inklusiver-Bereich-Operator ist ebenfalls ein Binär-Operator
	und fügt die Argumente mit in den Bereich ein.
d307 1
a307 1
Ziel-Adresse wird genauso wie die Source-Adresse angegeben.
d311 1
a311 1
wie der Source-Port angegeben.
d315 1
a315 1
übersetzten Pakete annehmen sollen. Die externe Adresse kann wiefolgt
d339 1
a339 1
  Point-to-Point-Link
d350 1
a350 1
<li>Irgendetwas der zuvor genannten Möglichkeiten, aber mit dem <tt>!</tt>-
d362 1
a362 1
<dd>Teilt PF mit, den Source-Port in TCP- und UDP-Paketen nicht zu
d379 1
a379 1
und sie mit der Source-IP-Adresse von 24.5.0.5 übersetzt werden sollen.
d395 1
a395 1
einer der Interfaces ändern, ohne die Regeln ändern zu müssen.
d398 1
a398 1
Wenn ein Interface-Name für die Übersetzungs-Adresse wie zuvor
d446 1
a446 1
vorherige NAT-Beispiel so modifiziert wurde, dass es nun wiefolgt
d483 1
a483 1
<dd>Gibt das Interface an, an welche der ,state' gebunden ist. Das Wort
d496 1
a496 1
Der Source-Port (2132) wird nach der Adresse angezeigt. Dies ist ebenfalls
d525 1
a525 1
<a href="index.html"><img height="24" width="24" src="../../images/back.gif" border="0" alt="[back]"></a> 
d530 1
a530 1
$Translation: nat.html,v 1.2 2004/12/01 18:47:44 paldium Exp $<br>
@


1.1
log
@Sync with Steelix CVS
@
text
@d8 1
a8 1
<meta name="description"   content="the OpenBSD FAQ page">
a10 1
<meta name="copyright"     content="This document copyright 2002-2003 by OpenBSD.">
d13 18
d35 1
a35 1
<img alt="[OpenBSD]" height=30 width=141 src="../../../images/smalltitle.gif">
d37 3
a39 3
[<a href="queueing.html">Previous: Queueing</a>]
[<a href="index.html">Contents</a>]
[<a href="rdr.html">Next: Traffic Redirection</a>]
d46 1
a46 1
<h3>Table of Contents</h3>
d48 8
a55 7
<li><a href="#intro">Introduction</a>
<li><a href="#works">How NAT Works</a>
<li><a href="#enable">Enabling NAT</a>
<li><a href="#config">Configuring NAT</a>
<li><a href="#binat">Bidirectional Mapping (1:1 mapping)</a>
<li><a href="#except">Translation Rule Exceptions</a>
<li><a href="#status">Checking NAT Status</a>
d61 17
a77 14
<h2>Introduction</h2>
Network Address Translation (NAT) is a way to map an entire network (or
networks) to a single IP address.  NAT is necessary when the number of
IP addresses assigned to you by your Internet Service Provider is less
than the total number of computers that you wish to provide Internet
access for. NAT is described in
<a href="http://www.geektools.com/rfc/rfc1631.txt">RFC 1631</a>.

<p>
NAT allows you to take advantage of the reserved address blocks
described in
<a href="http://www.geektools.com/rfc/rfc1918.txt">RFC 1918</a>.
Typically, your internal network will be setup to use one or more of
these network blocks. They are:
d79 3
a81 3
	10.0.0.0/8       (10.0.0.0 - 10.255.255.255)
	172.16.0.0/12    (172.16.0.0 - 172.31.255.255)
	192.168.0.0/16   (192.168.0.0 - 192.168.255.255)
d85 5
a89 4
An OpenBSD system doing NAT will have at least two network adapters, one
to the Internet, the other to your internal network.  NAT will be
translating requests from the internal network so they appear to all be
coming from your OpenBSD NAT system.
d92 1
a92 1
<h2>How NAT Works</h2>
d94 4
a97 4
When a client on the internal network contacts a machine on the
Internet, it sends out IP packets destined for that machine. These
packets contain all the addressing information necessary to get them to
their destination. NAT is concerned with these pieces of information:
d99 2
a100 2
<li>Source IP address (for example, 192.168.1.35)
<li>Source TCP or UDP port (for example, 2132)
d104 8
a111 6
When the packets pass through the NAT gateway they will be modified so
that they appear to be coming from the NAT gateway itself. The NAT
gateway will record the changes it makes in its state table so that it
can a) reverse the changes on return packets and b) ensure that return
packets are passed through the firewall and are not blocked. For example,
the following changes might be made:
d113 4
a116 4
<li>Source IP: replaced with the external address of the
gateway (for example, 24.5.0.5)
<li>Source port: replaced with a randomly chosen, unused port on the
gateway (for example, 53136)
d120 39
a158 20
Neither the internal machine nor the Internet host is aware of these
translation steps. To the internal machine, the NAT system is simply an
Internet gateway. To the Internet host, the packets appear to come
directly from the NAT system; it is completely unaware that the
internal workstation even exists.

<p>
When the Internet host replies to the internal machine's packets, they
will be addressed to the NAT gateway's external IP (24.5.0.5) at the
translation port (53136). The NAT gateway will then search the state
table to determine if the reply packets match an already established
connection. A unique match will be found based on the IP/port
combination which tells PF the packets belong to a connection initiated
by the internal machine 192.168.1.35. PF will then make the opposite
changes it made to the outgoing packets and forward the reply packets on
to the internal machine.

<p>
Translation of ICMP packets happens in a similar fashion but without the
source port modification.
d160 1
d162 2
a163 1
<h2>Enabling NAT</h2>
d165 6
a170 3
To enable NAT on an OpenBSD gateway, in addition to 
<a href="config.html#activate">activating PF</a>, you must also enable
IP forwarding:
d173 2
a174 2
# sysctl -w net.inet.ip.forwarding=1<br>
# sysctl -w net.inet6.ip6.forwarding=1 <i>(if using IPv6)</i>
d179 4
a182 3
To make this change permanent, the following lines should be added to
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=sysctl.conf&amp;sektion=5&amp;manpath=OpenBSD+3.4"
><tt>/etc/sysctl.conf</tt></a>:
d191 4
a194 3
These lines are present but commented out (prefixed with a <tt>#</tt>)
in the default install. Remove the <tt>#</tt> and save the file. IP
forwarding will be enabled when the machine is rebooted.
d197 3
a199 3
<h2>Configuring NAT</h2>
The general format for NAT rules in <tt>/etc/pf.conf</tt> looks
something like this:
d202 1
a202 1
nat on <i>extif</i> [<i>af</i>] from <i>src_addr</i> 
d205 1
a205 1
<i>ext_addr</i>
d210 10
a219 2
<dt><tt><i>extif</i></tt>
<dd>The name of the external network interface.
d222 3
a224 3
<dd>The address family, either <tt>inet</tt> for IPv4 or <tt>inet6</tt>
for IPv6. PF is usually able to determine this parameter based on the
source/destination address(es).
d227 3
a229 2
<dd>The source (internal) address of packets that will be translated.
The source address can be specified as:
d231 37
a267 19
<li>A single IPv4 or IPv6 address.
<li>A <a href="http://public.pacbell.net/dedicated/cidr.html">CIDR</a> 
network block.
<li>A fully qualified domain name that will be resolved via DNS when the
ruleset is loaded. All resulting IP addresses will be substituted into
the rule.
<li>The name of a network interface. Any IP addresses assigned to the
interface will be substituted into the rule at load time.
<li>The name of a network interface followed by
<tt>/<i>netmask</i></tt> (e.g. <tt>/24</tt>). Each IP address on the
interface is combined with the netmask to form a CIDR network block
which is substituted into the rule.
<li>The name of a network interface followed by the <tt>:network</tt>
keyword. The resulting CIDR network (e.g. 192.168.0.0/24) will be
substituted into the rule when the ruleset is loaded.
<li>A <a href="tables.html">table</a>.
<li>Any of the above but negated using the <tt>!</tt> ("not") modifier.
<li>A set of addresses using a <a href="macros.html#lists">list</a>.
<li>The keyword <tt>any</tt> meaning all addresses
d271 2
a272 2
<dd>The source port in the Layer 4 packet header. Ports can be specified
as:
d274 3
a276 3
<li>A number between 1 and 65535
<li>A valid service name from
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=services&amp;sektion=5&amp;manpath=OpenBSD+3.4"
d278 3
a280 2
<li>A set of ports using a <a href="macros.html#lists">list</a>
<li>A range:
d282 12
a293 8
	<li><tt>!=</tt> (not equal)
	<li><tt>&lt;</tt> (less than)
	<li><tt>&gt;</tt> (greater than)
	<li><tt>&lt;=</tt> (less than or equal)
	<li><tt>&gt;=</tt> (greater than or equal)
	<li><tt>&gt;&lt;</tt> (range)
	<li><tt>&lt;&gt;</tt> (inverse range)
	</ul>
d295 2
a296 2
	<dd>The last two are binary operators (they take two arguments) and
	do not include the arguments in the range.
d298 1
d300 3
a302 3
The <tt>port</tt> option is not usually used in <tt>nat</tt> rules
because the goal is usually to NAT all traffic regardless of the port(s)
being used.
d305 2
a306 2
<dd>The destination address of packets to be translated. The destination
address is specified in the same way as the source address.
d309 2
a310 2
<dd>The destination port in the Layer 4 packet header. This port is
specified in the same way as the source port.
d313 3
a315 2
<dd>The external (translation) address on the NAT gateway that packets
will be translated to. The external address can be specified as:
d317 37
a353 16
<li>A single IPv4 or IPv6 address.
<li>A <a href="http://public.pacbell.net/dedicated/cidr.html">CIDR</a> 
network block.
<li>A fully qualified domain name that will be resolved via DNS when the
ruleset is loaded.
<li>The name of the external network interface. Any IP addresses assigned
to the interface will be substituted into the rule at load time.
<li>The name of the external network interface in parentheses 
<tt>( )</tt>. This tells PF to update the rule if the IP address(es) on
the named interface changes. This is highly useful when the external
interface gets its IP address via DHCP or dial-up as the ruleset
doesn't have to be reloaded each time the address changes.
<li>The name of a network interface followed by the <tt>:network</tt>
keyword. The resulting CIDR network (e.g. 192.168.0.0/24) will be
substituted into the rule when the ruleset is loaded.
<li>A set of addresses using a <a href="macros.html#lists">list</a>.
d356 8
d367 2
a368 1
This would lead to a most basic form of this line similar to this:
d376 3
a378 3
This rule says to perform NAT on the <tt>tl0</tt> interface for any
packets coming from 192.168.1.0/24 and to replace the source IP address
with 24.5.0.5.
d381 5
a385 5
While the above rule is correct, it is not recommended form.
Maintenance could be difficult as any change of the external or internal
network numbers would require the line be changed.  Compare instead with
this easier to maintain line (<tt>tl0</tt> is external, <tt>dc0</tt>
internal):
d388 1
a388 1
nat on tl0 from dc0/24 to any -&gt; tl0
d393 2
a394 2
The advantage should be fairly clear: you can change the IP addresses of
either interface without changing this rule.
d397 10
a406 8
When specifying an interface name for the translation address as above,
the IP address is determined at pf.conf <i>load</i> time, not on the
fly.  If you are using DHCP to configure your external interface, this
can be a problem. If your assigned IP address changes then NAT will
continue translating outgoing packets using the old IP address. This
will cause outgoing connections to stop functioning. To get around this,
you can tell PF to automatically update the translation address by
putting parentheses around the interface name:
d409 1
a409 1
nat on tl0 from dc0/24 to any -&gt; (tl0)
d414 1
a414 2
There is one major limitation to doing this: Only the first IP alias on
an interface is evaluated when the interface name is placed in parentheses.
d417 12
a428 11
<h2>Bidirectional Mapping (1:1 mapping)</h2>
A bidirectional mapping can be established by using the
<tt>binat</tt> rule. A <tt>binat</tt> rule establishes a one to one
mapping between an internal IP address and an external address. This can
be useful, for example, to provide a web server on the internal network
with its own external IP address. Connections from the Internet to the
external address will be translated to the internal address and
connections from the web server (such as DNS requests) will be
translated to the external address. TCP and UDP ports are never
modified with <tt>binat</tt> rules as they are with <tt>nat</tt>
rules.
d431 1
a431 1
Example:
d442 5
a446 4
<h2>Translation Rule Exceptions</h2>
Exceptions can be made to translation rules by using the <tt>no</tt>
keyword. For example, if the NAT example above was modified to look
like this:
d449 1
a449 1
no nat on tl0 from 192.168.1.10 to any<br>
d455 2
a456 2
Then the entire 192.168.1.0/24 network would have its packets
translated to the external address 24.2.74.79 except for 192.168.1.10.
d459 4
a462 3
Note that the first matching rule wins; if it's a <tt>no</tt> rule,
then the packet is not translated. The <tt>no</tt> keyword can also be
used with <tt>binat</tt> and <a href="rdr.html"><tt>rdr</tt></a> rules.
d465 5
a469 5
<h2>Checking NAT Status</h2>
To view the active NAT translations
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=pfctl&amp;sektion=8&amp;manpath=OpenBSD+3.4"
>pfctl(8)</a> is used with the <tt>-s state</tt> option. This option will list
all the current NAT sessions:
d473 2
a474 2
   TCP 192.168.1.35:2132 -&gt; 24.5.0.5:53136 -&gt; 65.42.33.245:22 TIME_WAIT:TIME_WAIT
   UDP 192.168.1.35:2491 -&gt; 24.5.0.5:60527 -&gt; 24.2.68.33:53   MULTIPLE:SINGLE
d478 8
a485 1
Explanations (first line only):
d489 1
a489 1
<dd>The protocol being used by the connection.
d494 3
a496 3
<dd>The IP address (192.168.1.35) of the machine on the internal
network. The source port (2132) is shown after the address. This is also
the address that is replaced in the IP header.
d501 2
a502 2
<dd>The IP address (24.5.0.5) and port (53136) on the gateway that
packets are being translated to.
d507 2
a508 2
<dd>The IP address (65.42.33.245) and the port (22) that the internal
machine is connecting to.
d514 1
a514 1
<dd>This indicates what state PF believes the TCP connection to be in.
d518 3
a520 3
[<a href="queueing.html">Previous: Queueing</a>]
[<a href="index.html">Contents</a>]
[<a href="rdr.html">Next: Traffic Redirection</a>]
d524 1
a524 1
<a href="../../de/index.html"><img height="24" width="24" src="../../../images/back.gif" border="0" alt="[back]"></a> 
d528 3
a530 3
Originally [OpenBSD: nat.html,v 1.11 ]<br>
$Translation: nat.html,v 1.1 2003/11/27 17:34:57 sl Exp $<br>
$OpenBSD$
@

