head	1.36;
access;
symbols;
locks; strict;
comment	@# @;


1.36
date	2014.04.01.17.18.45;	author nick;	state dead;
branches;
next	1.35;

1.35
date	2013.11.01.18.04.05;	author ajacoutot;	state Exp;
branches;
next	1.34;

1.34
date	2013.05.01.17.39.07;	author ajacoutot;	state Exp;
branches;
next	1.33;

1.33
date	2013.05.01.14.42.14;	author ajacoutot;	state Exp;
branches;
next	1.32;

1.32
date	2012.11.02.07.24.05;	author ajacoutot;	state Exp;
branches;
next	1.31;

1.31
date	2012.05.13.16.30.18;	author ajacoutot;	state Exp;
branches;
next	1.30;

1.30
date	2012.01.31.23.04.08;	author ajacoutot;	state Exp;
branches;
next	1.29;

1.29
date	2012.01.21.19.34.39;	author ajacoutot;	state Exp;
branches;
next	1.28;

1.28
date	2009.11.07.07.32.54;	author ajacoutot;	state Exp;
branches;
next	1.27;

1.27
date	2009.05.04.19.07.52;	author tobias;	state Exp;
branches;
next	1.26;

1.26
date	2008.11.01.11.02.22;	author tobias;	state Exp;
branches;
next	1.25;

1.25
date	2008.08.10.16.14.28;	author tobias;	state Exp;
branches;
next	1.24;

1.24
date	2008.03.09.13.37.13;	author tobias;	state Exp;
branches;
next	1.23;

1.23
date	2007.11.12.20.29.59;	author saad;	state Exp;
branches;
next	1.22;

1.22
date	2007.05.09.05.49.52;	author jufi;	state Exp;
branches;
next	1.21;

1.21
date	2007.04.26.03.08.05;	author jufi;	state Exp;
branches;
next	1.20;

1.20
date	2007.02.10.05.22.16;	author saad;	state Exp;
branches;
next	1.19;

1.19
date	2006.11.01.11.30.45;	author jufi;	state Exp;
branches;
next	1.18;

1.18
date	2006.08.08.07.14.20;	author saad;	state Exp;
branches;
next	1.17;

1.17
date	2006.05.01.12.19.17;	author jufi;	state Exp;
branches;
next	1.16;

1.16
date	2006.04.25.08.25.49;	author saad;	state Exp;
branches;
next	1.15;

1.15
date	2006.01.14.11.36.00;	author jufi;	state Exp;
branches;
next	1.14;

1.14
date	2005.11.04.20.24.23;	author jufi;	state Exp;
branches;
next	1.13;

1.13
date	2005.09.20.07.30.02;	author saad;	state Exp;
branches;
next	1.12;

1.12
date	2005.07.27.10.30.04;	author saad;	state Exp;
branches;
next	1.11;

1.11
date	2005.05.22.17.38.07;	author saad;	state Exp;
branches;
next	1.10;

1.10
date	2005.05.20.17.13.26;	author jufi;	state Exp;
branches;
next	1.9;

1.9
date	2005.02.12.10.27.29;	author jufi;	state Exp;
branches;
next	1.8;

1.8
date	2005.02.08.13.59.02;	author jufi;	state Exp;
branches;
next	1.7;

1.7
date	2005.01.18.17.18.10;	author jufi;	state Exp;
branches;
next	1.6;

1.6
date	2004.12.22.20.00.48;	author jufi;	state Exp;
branches;
next	1.5;

1.5
date	2004.12.08.05.22.43;	author saad;	state Exp;
branches;
next	1.4;

1.4
date	2004.11.25.10.05.28;	author jufi;	state Exp;
branches;
next	1.3;

1.3
date	2004.11.18.19.39.13;	author jufi;	state Exp;
branches;
next	1.2;

1.2
date	2004.02.16.00.29.50;	author jufi;	state Exp;
branches;
next	1.1;

1.1
date	2003.11.27.19.39.09;	author horacio;	state Exp;
branches;
next	;


desc
@@


1.36
log
@
missed another one...
@
text
@<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<html>
<head>
<title>PF: Authpf: Benutzer-Shell für authentifizierende Gateways</title>
<link rev="made" href="mailto:www@@openbsd.org">
<meta http-equiv="Content-Type" content="text/html; charset=ISO-8859-1">
<meta name="resource-type" content="document">
<meta name="description"   content="the OpenBSD FAQ page">
<meta name="keywords"      content="openbsd,faq,pf">
<meta name="distribution"  content="global">
</head>

<!--
Copyright (c) 2003-2007 Joel Knight <enabled@@myrealbox.com>

Permission to use, copy, modify, and distribute this documentation for
any purpose with or without fee is hereby granted, provided that the
above copyright notice and this permission notice appear in all copies.

THE DOCUMENTATION IS PROVIDED "AS IS" AND THE AUTHOR DISCLAIMS ALL
WARRANTIES WITH REGARD TO THIS DOCUMENTATION INCLUDING ALL IMPLIED
WARRANTIES OF MERCHANTABILITY AND FITNESS. IN NO EVENT SHALL THE
AUTHOR BE LIABLE FOR ANY SPECIAL, DIRECT, INDIRECT, OR CONSEQUENTIAL
DAMAGES OR ANY DAMAGES WHATSOEVER RESULTING FROM LOSS OF USE, DATA OR
PROFITS, WHETHER IN AN ACTION OF CONTRACT, NEGLIGENCE OR OTHER
TORTIOUS ACTION, ARISING OUT OF OR IN CONNECTION WITH THE USE OR
PERFORMANCE OF THIS DOCUMENTATION
-->

<body bgcolor="#ffffff" text="#000000">
<!-- Passes validator.w3.org, please keep it this way;
please, use a max of 72 chars per line -->

<a href="../../../de/index.html">
<img alt="[OpenBSD]" height=30 width=141 src="../../../images/smalltitle.gif" border="0">
</a>
<p>
[<a href="ftp.html">Zurück: Probleme mit FTP</a>]
[<a href="index.html">Inhalt</a>]
[<a href="carp.html">Weiter: Firewall-Redundanz mit CARP und pfsync</a>]

<h1><font color="#e00000">PF: Authpf: Benutzer-Shell für authentifizierende
Gateways</font></h1>

<hr>

<h3>Inhaltsverzeichnis</h3>
<ul>
<li><a href="#intro">Einführung</a>
<li><a href="#config">Konfiguration</a>
	<ul>
	<li><a href="#enable">Authpf aktivieren</a>
	<li><a href="#linkmain">Authpf in den Hauptregelsatz einbinden</a>
	<li><a href="#loadrules">Geladene Regeln konfigurieren</a>
	<li><a href="#acl">Zugriffskontrolllisten (ACL)</a>
	<li><a href="#message">Eine Login-Nachricht anzeigen</a>
	<li><a href="#shell">Authpf als Shell eines Benutzers zuweisen</a>
	</ul>
<li><a href="#loginclass">Eine authpf-Loginklasse erstellen</a>
<li><a href="#wholog">Sehen, wer eingeloggt ist</a>
<li><a href="#example">Beispiel</a>
</ul>

<hr>

<a name="intro"></a>
<h2>Einführung</h2>
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=authpf&amp;sektion=8&amp;manpath=OpenBSD+5.4"
>Authpf(8)</a> ist eine Benutzer-Shell für authentifizierende Gateways.
Ein authentifizierendes Gateway verhält sich wie jedes gewöhnliche
Gateway (z.&nbsp;B. ein Router) mit der Ausnahme, dass Benutzer sich
erst authentifizieren müssen, bevor der Verkehr durchgelassen wird. Wenn
eine Benutzershell auf <tt>/usr/sbin/authpf</tt> gestellt ist
(z.&nbsp;B. statt
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=ksh&amp;sektion=1"
>ksh(1)</a>,
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=csh&amp;sektion=1"
>csh(1)</a> etc.) und der Benutzer mit SSH einloggt, wird authpf alle
notwendigen Änderungen am aktiven
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=pf&amp;sektion=4&amp;manpath=OpenBSD+5.4"
>pf(4)</a>-Regelsatz durchführen, sodass der Verkehr des Benutzers
durch den Filter geleitet und/oder unter Verwendung von Network Address
Translation oder Umleitung übersetzt wird. Sobald der Benutzer sich
ausloggt oder seine Sitzung unterbrochen wird, wird authpf jegliche
Regeln entfernen, die für den Benutzer geladen worden sind. Des Weiteren
werden alle zustandsbedingten (stateful) Verbindungen getrennt, die vom
Benutzer geöffnet wurden. Daher kann der Benutzer seinen Verkehr nur
durch das Gateway leiten, wenn er seine SSH-Sitzung offen hält.

<p>
Authpf lädt die Filter-Regeln eines Benutzers in einen einzigen
<a href="anchors.html">Ankerpunkt</a>.
Die Benennung des Ankers findet unter Verwendung einer Kombination
von dem Unix-Benutzernamens des Anwenders und der authpf-Prozess-ID
in Form von »<tt>username(PID)</tt>« statt. Jeder Anker eines Benutzers
wird innerhalb des <tt>authpf</tt>-Ankers gespeichert, welcher wiederum
dem Hauptregelsatz angehängt ist. Der vollständige Ankerpfad wird
somit:

<blockquote>
<tt>
<i>main_ruleset</i>/authpf/<i>username</i>(<i>PID</i>)
</tt>
</blockquote>

<p>
Die Regeln, die authpf lädt, können benutzerspezifisch oder auf
einer systemweiten Basis konfiguriert werden.

<p>
Beispielverwendungen von authpf beinhalten:
<ul>
<li>Vom Benutzer wird erwartet, dass er sich authentifiziert, bevor
Zugriff auf das Internet erlaubt wird.
<li>Bestimmten Benutzern - wie zum Beispiel Administratoren -
Zugriff auf eingeschränkte Teile des Netzwerks erlauben.
<li>Nur bekannten Benutzern den Zugriff auf den Rest des Netzwerkes
oder auf das Internet von drahtlosen Netzwerksegmenten aus erlauben.
<li>Arbeitnehmern, die zu Hause oder unterwegs etc. arbeiten, Zugriff
auf die Ressourcen im Netzwerk der Firma erlauben. Benutzer, die
außerhalb des Büros sind, können dann nicht nur auf das Firmennetz
zugreifen, sondern können auch auf bestimmte Ressourcen (z.&nbsp;B.
ihren eigenen Desktop) weitergeleitet werden, je nachdem, mit welchem
Benutzernamen sie sich authentifizieren.
<li>An Orten wie beispielsweise einer Bibliothek oder anderen Plätzen
mit öffentlichen Internetterminals, könnte PF so konfiguriert werden,
dass Gastbenutzern nur begrenzter Internetzugriff erlaubt wird. Authpf
kann dann ebenfalls benutzt werden, um registrierten Benutzern den
vollen Internetzugriff zu gewähren.
</ul>

<p>
Authpf loggt neben dem Benutzernamen und der IP-Adresse von jedem
Benutzer, der sich erfolgreich authentifiziert, ebenfalls die
Start- und Endzeiten ihrer Loginsitzung über
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=syslogd&amp;sektion=8"
>syslogd(8)</a>. Unter Verwendung dieser Informationen kann ein
Administrator erfahren, wer wann eingeloggt war und Benutzer somit
für ihren Netzwerkverkehr belangbar machen.

<a name="config"></a>
<h2>Konfiguration</h2>
Die Grundschritte, die benötigt werden, um authpf zu konfigurieren,
werden hier aufgelistet. Für eine komplette Beschreibung von authpfs
Konfiguration greife bitte auf die
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=authpf&amp;sektion=8&amp;manpath=OpenBSD+5.4"
>authpf-Handbuchseite</a> zurück.

<a name="enable"></a>
<h3>Authpf aktivieren</h3>

<p>
Authpf wird nicht laufen, wenn die Konfigurationsdatei
<tt>/etc/authpf/authpf.conf</tt> nicht existiert.
Die Datei kann leer sein (Größe null), muss aber existieren, da sich authpf
ansonsten sofort beendet, nachdem sich ein Benutzer erfolgreich angemeldet hat.

<p>
Die folgenden Konfigurationsdirektiven können in <tt>authpf.conf</tt>
angegeben werden:

<ul>
<li><tt>anchor=<i>name</i></tt> - benutze den angegebenen
<a href="anchors.html">Anker</a>-Namen statt »authpf«.
<li><tt>table=<i>name</i></tt> - benutze den angegebenen
<a href="tables.html">Tabellen</a>-Namen statt »authpf_users«.
</ul>

<a name="linkmain"></a>
<h3>Authpf in den Hauptregelsatz einbinden</h3>
Authpf wird in den Hauptregelsatz mit Hilfe einer <tt>anchor</tt>-Regel
eingebunden:
<blockquote>
<tt>
anchor "authpf/*"<br>
</tt>
</blockquote>

<p>
Wo auch immer die <tt>anchor</tt>-Regel innerhalb des Regelsatzes platziert
ist, wird PF vom Hauptregelsatz abzweigen, um die authpf-Regeln zu verarbeiten.

<a name="loadrules"></a>
<h3>Geladene Regeln konfigurieren</h3>
Authpf lädt seine Regeln von einer dieser beiden Dateien:
<ul>
<li><tt>/etc/authpf/users/$USER/authpf.rules</tt>
<li><tt>/etc/authpf/authpf.rules</tt>
</ul>

<p>
Die erste Datei beinhaltet Regeln, die nur geladen werden, wenn sich der
Benutzer <tt>$USER</tt> (dies wird mit dem Benutzernamen des Benutzers
ausgetauscht) einloggt. Die benutzerspezifische Regelkonfiguration wird
verwendet, wenn ein bestimmter Benutzer - wie zum Beispiel ein
Administrator - einen Satz an Regeln benötigt, die vom standardmäßigen
Satz abweichen. Die zweite Datei beinhaltet die standardmäßigen Regeln,
die für jeden Benutzer geladen werden, der keine eigene
<tt>authpf.rules</tt>-Datei hat. Wenn die benutzerspezifische Datei
existiert, wird sie die standardmäßige Datei überschreiben. Zumindest
eine von beiden Dateien muss existieren, ansonsten wird authpf
nicht laufen.

<p>
Regeln haben dieselbe Syntax wie in jedem anderen PF-Regelsatz, mit einer
Ausnahme: Authpf erlaubt die Nutzung vom zwei vordefinierten Makros:
<ul>
<li><tt>$user_ip</tt> - Die IP-Adresse des eingeloggten Benutzers
<li><tt>$user_id</tt> - Der Benutzername des eingeloggten Benutzers
</ul>

<p>
Es wird empfohlen, das <tt>$user_ip</tt>-Makro zu verwenden,
um nur den Verkehr durch das Gateway vom Computer des
authentifizierten Benutzers zu erlauben.

<p>
Zusätzlich zum <tt>$user_ip</tt>-Makro wird authpf die
<tt>authpf_users</tt>-Tabelle verwenden (wenn sie existiert), um
die IP-Adressen aller authentifizierten Benutzer aufzubewahren.
Stelle sicher, dass du die Tabelle definierst, bevor du sie
verwendest:

<blockquote>
<tt>
table &lt;authpf_users&gt; persist<br>
pass in on $ext_if proto tcp from &lt;authpf_users&gt; \<br>
&nbsp;&nbsp;&nbsp;&nbsp;to port smtp
</tt>
</blockquote>

<p>
Diese Tabelle sollte nur in Regeln verwendet werden, die dafür
gedacht sind, für alle authentifizierten Benutzer zu gelten.

<a name="acl"></a>
<h3>Access-Control-Listen</h3>
Benutzern kann die Verwendung von authpf verweigert werden, indem eine
Datei im <tt>/etc/authpf/banned/</tt>-Verzeichnis erstellt und sie
nach dem Benutzernamen benannt wird, dem der Zugriff verweigert werden
soll. Der Inhalt dieser Datei wird den Benutzern angezeigt werden, bevor
authpf ihre Verbindung wieder trennt. Dies erlaubt einen einfachen Weg,
um Benutzern mitzuteilen, warum ihnen der Zugriff entzogen wurde und an
wen sie sich wenden müssen, wenn ihr Zugriff wiederhergestellt werden
soll.

<p>
So gesagt ist es ebenfalls möglich, nur bestimmte Benutzer zu erlauben,
indem der Benutzername in die <tt>/etc/authpf/authpf.allow</tt>-Datei
eingetragen wird. Wenn die <tt>/etc/authpf/authpf.allow</tt>-Datei nicht
existiert oder »<tt>*</tt>« in die Datei eingetragen wurde, wird authpf
jedem Benutzer, der sich erfolgreich über SSH eingeloggt hat, den Zugriff
erlauben, solange dieser nicht explizit gebannt wurde.

<p>
Wenn authpf nicht in der Lage ist herauszufinden, ob ein Benutzername
erlaubt oder verboten ist, wird es eine kurze Nachricht ausgeben und
den Benutzer wieder trennen. Ein Eintrag in <tt>/etc/authpf/banned/</tt>
überschreibt immer einen Eintrag in <tt>/etc/authpf/authpf.allow</tt>.

<a name="message"></a>
<h3>Eine Loginnachricht anzeigen</h3>

<p>
Jedes Mal, wenn sich ein Benutzer erfolgreich bei authpf anmeldet,
wird eine Begrüßung ausgegeben, die angibt, dass der Benutzer
authentifiziert ist.

<blockquote>
<tt>
Hello charlie. You are authenticated from host "64.59.56.140"
</tt>
</blockquote>

<p>
Diese Nachricht kann ergänzt werden, indem eine angepasste Nachricht
in <tt>/etc/authpf/authpf.message</tt> geschrieben wird.
Der Inhalt dieser Datei wird nach der standardmäßigen
Willkommensnachricht ausgegeben.

<a name="shell"></a>
<h3>Authpf als Shell eines Benutzers zuweisen</h3>
Damit authpf funktionieren kann, muss es als Loginshell einem Benutzer
zugewiesen sein. Wenn der Benutzer sich erfolgreich mit
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=sshd&amp;sektion=8"
>sshd(8)</a>
authentifiziert, wird authpf als Benutzershell ausgeführt. Es wird dann
überprüft, ob dem Benutzer erlaubt wurde, authpf zu benutzen, die
Regeln werden aus den passenden Dateien geladen usw.

<p>
Es gibt einige Wege, um authpf als Benutzershell zuzuweisen:
<ol>
<li>Manuell für jeden Benutzer unter Verwendung von
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=chsh&amp;sektion=1"
>chsh(1)</a>,
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=vipw&amp;sektion=8"
>vipw(8)</a>,
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=useradd&amp;sektion=8"
>useradd(8)</a>,
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=usermod&amp;sektion=8"
>usermod(8)</a> etc.
<li>Einen Benutzer einer Loginklasse zuweisen und die Option
<tt>shell</tt> in
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=login.conf&amp;sektion=5"
><tt>/etc/login.conf</tt></a> anpassen.
</ol>

<a name="loginclass"></a>
<h2>Eine authpf-Loginklasse erstellen</h2>
Wenn authpf auf einem System genutzt wird, das sowohl reguläre
Benutzerkonten als auch authpf-Benutzerkonten hat, kann es nützlich sein,
eine separate Loginklasse für die authpf-Benutzer benutzen.
Dies ermöglicht das Ändern bestimmter Dinge für jene Accounts auf
systemweiter Basis und die Einrichtung unterschiedlicher Richtlinien
für reguläre Accounts und authpf-Accounts. Einige Beispiele, wie
Richtlinien eingerichtet werden können:

<ul>
<li><b>shell</b> - die Loginshell eines Benutzers angeben.
Dies kann verwendet werden, um <tt>authpf</tt> als Shell des Benutzers
zu erzwingen; egal, welcher Eintrag in der
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=passwd&amp;sektion=5"
>passwd(5)</a>-Datenbank vorliegt.
<li><b>welcome</b> - gibt an, welche
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=motd&amp;sektion=5"
>motd(5)</a>-Datei angezeigt werden soll, wenn sich ein Benutzer
anmeldet. Das ist nützlich, um Nachrichten anzuzeigen, die nur für
authpf-Benutzer von Bedeutung sind.
</ul>

<p>
Loginklassen können in der
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=login.conf&amp;sektion=5"
>login.conf(5)</a>-Datei erstellt werden.
OpenBSD wird mit einer authpf-Loginklasse ausgeliefert,
die wie folgt definiert ist:

<blockquote>
<tt>
authpf:\<br>
&nbsp;&nbsp;&nbsp;&nbsp;:welcome=/etc/motd.authpf:\<br>
&nbsp;&nbsp;&nbsp;&nbsp;:shell=/usr/sbin/authpf:\<br>
&nbsp;&nbsp;&nbsp;&nbsp;:tc=default:
</tt>
</blockquote>

<p>
Benutzer werden einer Loginklasse zugewiesen, indem das
<tt>class</tt>-Feld des passwd(5)-Datenbankeintrags vom Benutzer
geändert wird. Ein Weg, das zu machen, ist das
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=chsh&amp;sektion=1"
>chsh(1)</a>-Kommando.


<a name="wholog"></a>
<h2>Sehen, wer eingeloggt ist</h2>
Sobald sich ein Benutzer erfolgreich eingeloggt hat und authpf die
PF-Regeln angepasst hat, ändert authpf den Prozesstitel, um auf den
Benutzernamen und die IP-Adresse des eingeloggten Benutzer zu deuten:
<pre>
    # ps -ax | grep authpf
    23664 p0  Is+     0:00.11 -authpf: charlie@@192.168.1.3 (authpf)
</pre>

<p>
Hier ist der Benutzer <tt>charlie</tt> von der Maschine 192.168.1.3 aus
eingeloggt. Durch das Senden eines SIGTERM-Signals zum authpf-Prozess
wird der Benutzer gewaltsam ausgeloggt. Authpf wird ebenfalls jegliche
geladenen Regeln entfernen, die für den Benutzer bestimmt waren und
schließt alle zustandsbedingten Verbindungen, die der Benutzer geöffnet
hat.
<pre>
    # kill -TERM 23664
</pre>

<a name="example"></a>
<h2>Beispiel</h2>
Authpf wird auf einem OpenBSD-Gateway verwendet, um Benutzer eines
drahtlosen Netzwerkes zu authentifizieren, welches Teil eines größeren
Campus-Netzwerkes ist. Sobald ein Benutzer sich authentifiziert hat
(vorausgesetzt, dass er nicht auf der Bannliste steht) wird ihm
erlaubt, sowohl eine SSH-Verbindung nach außen aufzubauen und im Web
zu surfen (einschließlich sicheren Webseiten) als auch auf einen der
Campus-DNS-Server zuzugreifen.

<p>
Die <tt>/etc/authpf/authpf.rules</tt>-Datei beinhaltet folgende Regeln:<br>
<br>

<table border=0 width="650">
<tr><td nowrap bgcolor="#EEEEEE">
<pre>
wifi_if = "wi0"

pass in quick on $wifi_if proto tcp from $user_ip to port { ssh, http, \
   https }
</pre>
</td></tr>
</table>

<p>
Der administrative Benutzer <tt>charlie</tt> braucht die Möglichkeit,
auf die SMTP- und POP3-Server vom Campus zuzugreifen, sowie im Web
zu surfen und SSH zu verwenden. Die folgenden Regeln wurden in
<tt>/etc/authpf/users/charlie/authpf.rules</tt> eingestellt:<br>
<br>

<table border=0 width="650">
<tr><td nowrap bgcolor="#EEEEEE">
<pre>
wifi_if = "wi0"
smtp_server = "10.0.1.50"
pop3_server = "10.0.1.51"

pass in quick on $wifi_if \
   proto tcp from $user_ip to $smtp_server port smtp
pass in quick on $wifi_if \
   proto tcp from $user_ip to $pop3_server port pop3
pass in quick on $wifi_if \
   proto tcp from $user_ip to port { ssh, http, https }
</pre>
</td></tr>
</table>

<p>
Der Hauptregelsatz, der sich in <tt>/etc/pf.conf</tt> befindet, wurde
wie folgt aufgesetzt:<br>
<br>

<table border=0 width="650">
<tr><td nowrap bgcolor="#EEEEEE">
<pre>
# macros
wifi_if = "wi0"
ext_if  = "fxp0"
dns_servers = "{ 10.0.1.56, 10.0.2.56 }"

table &lt;authpf_users&gt; persist

# filter
block drop all

pass out quick on $ext_if inet proto { tcp, udp, icmp } \
   from { $wifi_if:network, $ext_if }

pass in quick on $wifi_if inet proto tcp \
   from $wifi_if:network to $wifi_if port ssh

pass in quick on $wifi_if inet proto { tcp, udp } \
   from &lt;authpf_users&gt; to $dns_servers port domain

anchor "authpf/*" in on $wifi_if
</pre>
</td></tr>
</table>

<p>
Der Regelsatz ist sehr einfach und macht Folgendes:
<ul>
<li>Blockiere alles (standardmäßig blocken).
<li>Lasse ausgehenden TCP-, UDP- und ICMP-Verkehr durch das externe
Interface vom drahtlosen Netzwerk und dem Gateway selbst durch.
<li>Lasse eingehenden SSH-Verkehr vom drahtlosen Netzwerk durch, der für
das Gateway bestimmt ist. Diese Regel ist notwendig, damit sich
Benutzer einloggen können.
<li>Lasse eingehende DNS-Anfragen von allen authentifizierten
authpf-Benutzern zu den DNS-Servern des Campus durch.
<li>Erzeuge einen Ankerpunkt »authpf« für eingehenden Verkehr auf dem
drahtlosen Interface.
</ul>

<p>
Die Idee hinter dem Hauptregelsatz ist, alles zu blocken und nur so
wenig Verkehr zuzulassen wie möglich. Der Verkehr kann frei durch das
externe Interface fließen, doch wird alles durch die »standardmäßig
blocken«-Richtlinie am Eindringen in das drahtlose Netzwerkinterface
gehindert. Sobald sich ein Benutzer authentifiziert, wird der Verkehr von
ihm das drahtlose Interface passieren dürfen, um von dort aus durch das
Gateway in den Rest des Netzwerkes fließen zu dürfen. Das
<tt>quick</tt>-Schlüsselwort wird durchgehend verwendet, sodass PF nicht
jeden benannten Regelsatz überprüfen muss, wenn eine neue Verbindung durch
das Gateway gelassen wird.

<p>
[<a href="ftp.html">Zurück: Probleme mit FTP</a>]
[<a href="index.html">Inhalt</a>]
[<a href="carp.html">Weiter: Firewall-Redundanz mit CARP und pfsync</a>]

<p>
<hr>
<a href="index.html"><img height="24" width="24" src="../../../images/back.gif" border="0" alt="[zurück]"></a>
<a href="mailto:www@@openbsd.org">www@@openbsd.org</a>
<br>
<small>
<!--
Originally [OpenBSD: authpf.html,v 1.34 ]<br>
$Translation: authpf.html,v 1.35 2013/11/01 16:59:45 steffen Exp $<br>
-->
$OpenBSD: authpf.html,v 1.35 2013/11/01 18:04:05 ajacoutot Exp $
</small>

</body>
</html>
@


1.35
log
@Sync with Steelix CVS
@
text
@d500 1
a500 1
$OpenBSD$
@


1.34
log
@Sync with Steelix CVS
@
text
@d68 1
a68 1
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=authpf&amp;sektion=8&amp;manpath=OpenBSD+5.3"
d80 1
a80 1
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=pf&amp;sektion=4&amp;manpath=OpenBSD+5.3"
d146 1
a146 1
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=authpf&amp;sektion=8&amp;manpath=OpenBSD+5.3"
d497 2
a498 2
Originally [OpenBSD: authpf.html,v 1.33 ]<br>
$Translation: authpf.html,v 1.34 2013/05/01 16:34:16 steffen Exp $<br>
@


1.33
log
@Sync with Steelix CVS
@
text
@d497 2
a498 2
Originally [OpenBSD: authpf.html,v 1.32 ]<br>
$Translation: authpf.html,v 1.33 2013/05/01 13:35:26 steffen Exp $<br>
@


1.32
log
@Sync with Steelix CVS
@
text
@d68 1
a68 1
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=authpf&amp;sektion=8&amp;manpath=OpenBSD+5.2"
d80 1
a80 1
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=pf&amp;sektion=4&amp;manpath=OpenBSD+5.2"
d146 1
a146 1
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=authpf&amp;sektion=8&amp;manpath=OpenBSD+5.2"
d498 1
a498 1
$Translation: authpf.html,v 1.32 2012/11/01 20:43:18 steffen Exp $<br>
@


1.31
log
@Sync with Steelix CVS
@
text
@d68 1
a68 1
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=authpf&amp;sektion=8&amp;manpath=OpenBSD+5.1"
d80 1
a80 1
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=pf&amp;sektion=4&amp;manpath=OpenBSD+5.1"
d146 1
a146 1
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=authpf&amp;sektion=8&amp;manpath=OpenBSD+5.1"
d497 2
a498 2
Originally [OpenBSD: authpf.html,v 1.31 ]<br>
$Translation: authpf.html,v 1.31 2012/05/11 17:06:29 steffen Exp $<br>
@


1.30
log
@Sync with Steelix CVS
@
text
@d68 1
a68 1
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=authpf&amp;sektion=8&amp;manpath=OpenBSD+5.0"
d80 1
a80 1
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=pf&amp;sektion=4&amp;manpath=OpenBSD+5.0"
d146 1
a146 1
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=authpf&amp;sektion=8&amp;manpath=OpenBSD+5.0"
d497 2
a498 2
Originally [OpenBSD: authpf.html,v 1.30 ]<br>
$Translation: authpf.html,v 1.30 2012/01/31 21:20:33 tobias Exp $<br>
@


1.29
log
@Sync with Steelix CVS
@
text
@d147 1
a147 1
>authpf-Manualseite</a> zurück.
d498 1
a498 1
$Translation: authpf.html,v 1.29 2012/01/18 20:39:39 steffen Exp $<br>
@


1.28
log
@Sync with Steelix CVS
@
text
@d68 1
a68 1
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=authpf&amp;sektion=8&amp;manpath=OpenBSD+4.6"
d80 1
a80 1
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=pf&amp;sektion=4&amp;manpath=OpenBSD+4.6"
d91 1
a91 1
Authpf lädt Filter/NAT-Regeln eines Benutzers in einen einzigartigen
d146 1
a146 1
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=authpf&amp;sektion=8&amp;manpath=OpenBSD+4.6"
d154 3
a156 3
<tt>/etc/authpf/authpf.conf</tt> nicht existiert. Selbst wenn die Datei
leer ist (keine Größe) muss sie existieren, ansonsten wird sich authpf
sofort wieder beenden, wenn sich ein Benutzer erfolgreich angemeldet hat.
d171 2
a172 2
Authpf wird unter Verwendung von <tt>anchor</tt>-Regeln in den
Hauptregelsatz eingebunden:
a174 3
nat-anchor "authpf/*"<br>
rdr-anchor "authpf/*"<br>
binat-anchor "authpf/*"<br>
d180 2
a181 6
Überall dort, wo <tt>anchor</tt>-Regeln innerhalb des Regelsatzes
platziert wurden, wird PF vom Hauptregelsatz abzweigen, um die
authpf-Regeln zu verarbeiten. Es ist nicht notwendig, dass alle vier
<tt>anchor</tt>-Regeln vorhanden sind; wenn authpf zum Beispiel nicht
so aufgesetzt wurde, dass es irgendwelche <tt>nat</tt>-Regeln laden
soll, kann die <tt>nat-anchor</tt>-Regel ausgelassen werden.
d205 2
a206 3
Filter- und Übersetzungsregeln haben die gleiche Syntax wie jeder
anderer PF-Regelsatz mit einer Ausnahme: Authpf erlaubt die Verwendung
von zwei vordefinierten Makros:
d228 1
a228 1
&nbsp;&nbsp;&nbsp;&nbsp;to port  smtp flags S/SA keep state
d397 1
a397 1
   https } flags S/SA keep state
d416 6
a421 6
pass in quick on $wifi_if proto tcp from $user_ip to $smtp_server \
   port smtp flags S/SA keep state
pass in quick on $wifi_if proto tcp from $user_ip to $pop3_server \
   port pop3 flags S/SA keep state
pass in quick on $wifi_if proto tcp from $user_ip to port { ssh, http, \
   https } flags S/SA keep state
a440 2
scrub in all

d444 5
a448 4
pass out quick on $ext_if inet proto tcp from \
   { $wifi_if:network, $ext_if } flags S/SA modulate state
pass out quick on $ext_if inet proto { udp, icmp } from \
   { $wifi_if:network, $ext_if } keep state
d450 2
a451 2
pass in quick on $wifi_if inet proto tcp from $wifi_if:network to $wifi_if \
   port ssh flags S/SA keep state
a452 2
pass in quick on $wifi_if inet proto { tcp, udp } from &lt;authpf_users&gt; \
   to $dns_servers port domain keep state
d497 2
a498 2
Originally [OpenBSD: authpf.html,v 1.26 ]<br>
$Translation: authpf.html,v 1.28 2009/11/05 12:55:49 tobias Exp $<br>
@


1.27
log
@Sync with Steelix CVS
@
text
@d68 1
a68 1
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=authpf&amp;sektion=8&amp;manpath=OpenBSD+4.5"
d80 1
a80 1
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=pf&amp;sektion=4&amp;manpath=OpenBSD+4.5"
d146 1
a146 1
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=authpf&amp;sektion=8&amp;manpath=OpenBSD+4.5"
d508 2
a509 2
Originally [OpenBSD: authpf.html,v 1.25 ]<br>
$Translation: authpf.html,v 1.27 2009/05/03 12:44:31 tobias Exp $<br>
@


1.26
log
@Sync with Steelix CVS
@
text
@d68 1
a68 1
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=authpf&amp;sektion=8&amp;manpath=OpenBSD+4.4"
d80 1
a80 1
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=pf&amp;sektion=4&amp;manpath=OpenBSD+4.4"
d146 1
a146 1
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=authpf&amp;sektion=8&amp;manpath=OpenBSD+4.4"
d508 2
a509 2
Originally [OpenBSD: authpf.html,v 1.24 ]<br>
$Translation: authpf.html,v 1.26 2008/11/01 09:15:06 paldium Exp $<br>
@


1.25
log
@Sync with Steelix CVS
@
text
@d68 1
a68 1
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=authpf&amp;sektion=8&amp;manpath=OpenBSD+4.3"
d80 1
a80 1
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=pf&amp;sektion=4&amp;manpath=OpenBSD+4.3"
d146 1
a146 1
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=authpf&amp;sektion=8&amp;manpath=OpenBSD+4.3"
d508 2
a509 2
Originally [OpenBSD: authpf.html,v 1.23 ]<br>
$Translation: authpf.html,v 1.25 2008/08/04 14:41:03 paldium Exp $<br>
@


1.24
log
@Sync with Steelix CVS
@
text
@d68 1
a68 1
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=authpf&amp;sektion=8&amp;manpath=OpenBSD+4.2"
d80 1
a80 1
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=pf&amp;sektion=4&amp;manpath=OpenBSD+4.2"
d146 1
a146 1
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=authpf&amp;sektion=8&amp;manpath=OpenBSD+4.2"
d508 2
a509 2
Originally [OpenBSD: authpf.html,v 1.22 ]<br>
$Translation: authpf.html,v 1.24 2008/03/04 23:03:16 paldium Exp $<br>
@


1.23
log
@Sync with Steelix CVS
@
text
@d123 1
a123 1
ihren eigenen Desktop) weitergeleitet werden, jenachdem, mit welchem
d135 1
a135 1
Start- und Endzeiten ihrer Loginsetzung über
d208 1
a208 1
eine von beiden Dateien muss existierieren, ansonsten wird authpf
d273 1
a273 1
Jedesmal, wenn sich ein Benutzer erfolgreich bei authpf anmeldet,
d320 1
a320 1
Benutzerkonten als auch auhtpf-Benutzerkonten hat, kann es nützlich sein,
d322 1
a322 1
Dies ermöglicht das Ändern bestimmer Dinge für jene Accounts auf
d509 1
a509 1
$Translation: authpf.html,v 1.23 2007/11/03 10:45:41 paldium Exp $<br>
@


1.22
log
@Sync with steelix translation CVS
@
text
@d68 1
a68 1
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=authpf&amp;sektion=8&amp;manpath=OpenBSD+4.1"
d71 1
a71 1
Gateway (z.&nbps;B. ein Router) mit der Ausnahme, dass Benutzer sich
d80 2
a81 2
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=pf&amp;sektion=4&amp;manpath=OpenBSD+4.1"
>pf(4)</a>-Regelsatz durchführen, so dass der Verkehr des Benutzers
d94 1
a94 1
von dem UNIX-Benutzernamens des Anwenders und der authpf-Prozess-ID
d146 1
a146 1
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=authpf&amp;sektion=8&amp;manpath=OpenBSD+4.1"
d492 1
a492 1
<tt>quick</tt>-Schlüsselwort wird durchgehend verwendet, so dass PF nicht
d508 2
a509 2
Originally [OpenBSD: authpf.html,v 1.21 ]<br>
$Translation: authpf.html,v 1.22 2007/05/08 21:04:13 simon Exp $<br>
@


1.21
log
@Sync with steelix translation CVS
@
text
@d14 1
a14 1
Copyright (c) 2003-2005 Joel Knight <enabled@@myrealbox.com>
d68 1
a68 1
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=authpf&amp;sektion=8&amp;manpath=OpenBSD+4.0"
d75 1
a75 1
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=ksh&amp;sektion=1&amp;manpath=OpenBSD+4.0"
d77 1
a77 1
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=csh&amp;sektion=1&amp;manpath=OpenBSD+4.0"
d80 1
a80 1
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=pf&amp;sektion=4&amp;manpath=OpenBSD+4.0"
d136 1
a136 1
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=syslogd&amp;sektion=8&amp;manpath=OpenBSD+4.0"
d146 1
a146 1
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=authpf&amp;sektion=8&amp;manpath=OpenBSD+4.0"
d293 1
a293 1
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=sshd&amp;sektion=8&amp;manpath=OpenBSD+4.0"
d303 1
a303 1
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=chsh&amp;sektion=1&amp;manpath=OpenBSD+4.0"
d305 1
a305 1
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=vipw&amp;sektion=8&amp;manpath=OpenBSD+4.0"
d307 1
a307 1
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=useradd&amp;sektion=8&amp;manpath=OpenBSD+4.0"
d309 1
a309 1
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=usermod&amp;sektion=8&amp;manpath=OpenBSD+4.0"
d313 1
a313 1
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=login.conf&amp;sektion=5&amp;manpath=OpenBSD+4.0"
d321 1
a321 1
eine separate Loginklasse für die authpf-Benutzer anzulegen.
d344 2
a345 1
Eine Beispiel-Loginklasse für authpf-Benutzer:
d508 2
a509 2
Originally [OpenBSD: authpf.html,v 1.19 ]<br>
$Translation: authpf.html,v 1.21 2007/04/25 15:41:14 paldium Exp $<br>
@


1.20
log
@sync with Steelix CVS
@
text
@d304 1
a304 1
>chsh(1)</a>, 
d332 1
a332 1
>passwd(5)</a>-Datenbank vorliegt. 
d502 1
a502 1
<a href="index.html"><img height="24" width="24" src="../../../images/back.gif" border="0" alt="[zurück]"></a> 
d508 1
a508 1
$Translation: authpf.html,v 1.20 2007/02/09 18:13:48 paldium Exp $<br>
d514 1
a514 1
</html> 
@


1.19
log
@sync with steelix translation CVS
@
text
@d78 1
a78 1
>csh(1)</a>, etc.) und der Benutzer mit SSH einloggt, wird authpf alle
d119 1
a119 1
<li>Arbeitnehmern, die zu Hause oder unterwegs, etc. arbeiten, Zugriff
d297 1
a297 1
Regeln werden aus den passenden Dateien geladen, usw.
d310 1
a310 1
>usermod(8)</a>, etc.
d508 1
a508 1
$Translation: authpf.html,v 1.19 2006/11/01 10:48:51 paldium Exp $<br>
@


1.18
log
@sync with Steelix CVS
@
text
@d68 1
a68 1
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=authpf&amp;sektion=8&amp;manpath=OpenBSD+3.9"
d75 1
a75 1
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=ksh&amp;sektion=1&amp;manpath=OpenBSD+3.9"
d77 1
a77 1
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=csh&amp;sektion=1&amp;manpath=OpenBSD+3.9"
d80 1
a80 1
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=pf&amp;sektion=4&amp;manpath=OpenBSD+3.9"
d136 1
a136 1
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=syslogd&amp;sektion=8&amp;manpath=OpenBSD+3.9"
d146 1
a146 1
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=authpf&amp;sektion=8&amp;manpath=OpenBSD+3.9"
d293 1
a293 1
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=sshd&amp;sektion=8&amp;manpath=OpenBSD+3.9"
d303 1
a303 1
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=chsh&amp;sektion=1&amp;manpath=OpenBSD+3.9"
d305 1
a305 1
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=vipw&amp;sektion=8&amp;manpath=OpenBSD+3.9"
d307 1
a307 1
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=useradd&amp;sektion=8&amp;manpath=OpenBSD+3.9"
d309 1
a309 1
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=usermod&amp;sektion=8&amp;manpath=OpenBSD+3.9"
d313 1
a313 1
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=login.conf&amp;sektion=5&amp;manpath=OpenBSD+3.9"
d507 2
a508 2
Originally [OpenBSD: authpf.html,v 1.18 ]<br>
$Translation: authpf.html,v 1.18 2006/08/06 14:06:56 paldium Exp $<br>
@


1.17
log
@3.9 release time.
@
text
@d55 1
a55 1
	<li><a href="#acl">Access-Control-Listen</a>
d59 1
a59 1
<li><a href="#loginclass">Eine authpf-Login-Klasse erstellen</a>
d69 6
a74 6
>Authpf(8)</a> ist eine Benutzer-Shell für authentifizierende Gateways. Ein
authentifizierendes Gateway ist wie jedes gewöhnliche Gateway (a.k.a.
ein Router), ausgenommen, dass Benutzer sich erst authentifizieren
müssen, bevor der Gateway den Verkehr durchlässt. Wenn eine
Benutzer-Shell auf <tt>/usr/sbin/authpf</tt> gestellt ist (z.B. statt
die Benutzer-Shell auf
d78 2
a79 2
>csh(1)</a>, etc. zu stellen) und der Benutzer unter Verwendung von
SSH einloggt, wird authpf alle notwendigen Änderungen an dem aktiven
d81 1
a81 1
>pf(4)</a>-Regelsatz durchzuführen, so dass der Verkehr des Benutzers
d85 4
a88 4
Regeln entfernen, die für den Benutzer geladen worden sind, und
trennt alle ,stateful' Verbindungen, die vom Benutzer geöffnet worden
sind. Daher besteht die Möglichkeit des Benutzers, seinen Verkehr durch
das Gateway zu leiten, nur solange er seine SSH-Sitzung offen hält.
d95 4
a98 4
in Form von "<tt>username(PID)</tt>" statt.
Jeder Anker eines Benutzers wird innerhalb des <tt>authpf</tt>-Ankers
gespeichert, welcher wiederum dem Hauptregelsatz angehängt ist.
Der ,fully qualified anchor path' wird somit:
d113 3
a115 3
<li>Vom Benutzer erwarten, sich zu authentifizieren, bevor Zugriff auf
das Internet erlaubt wird.
<li>Bestimmten Benutzern -- wie zum Beispiel Administratoren --
d119 1
a119 1
<li>Arbeitnehmern, die zuhause oder unterwegs arbeiten, etc., Zugriff
d122 2
a123 2
zugreifen, sondern können auch auf bestimmte Ressourcen (z.B. ihren
eigenen Desktop) weitergeleitet werden, jenachdem, mit welchem
d126 2
a127 2
mit öffentlichen Internet-Terminals, könnte PF so konfiguriert werden,
dass Gast-Benutzern nur begrenzter Internetzugriff erlaubt wird. Authpf
d133 3
a135 3
Authpf loggt den Benutzernamen und die IP-Adresse von jedem Benutzer,
der sich erfolgreich authentifiziert, so wie auch die Start- und
Endzeiten ihrer Login-Sitzung per
d143 1
a143 1
Die Basis-Schritte, die benötigt werden, um authpf zu konfigurieren,
d147 1
a147 1
>authpf-Manual-Seite</a> zurück.
d154 3
a156 4
<tt>/etc/authpf/authpf.conf</tt> nicht existiert.
Selbst wenn die Datei leer ist (keine Größe) muss sie existieren,
ansonsten wird sich authpf sofort wieder beenden, wenn sich ein
Benutzer erfolgreich angemeldet hat.
d163 4
a166 4
<li><tt>anchor=<i>name</i></tt> - Benutze den angegebenen
<a href="anchors.html">Anker</a>-Namen statt ,authpf'.
<li><tt>table=<i>name</i></tt> - Benutze den angegebenen
<a href="tables.html">Tabellen</a>-Namen statt ,authpf_users'.
d201 3
a203 3
ausgetauscht) einloggt. Die Benutzer-spezifische Regelkonfiguration wird
verwendet, wenn ein bestimmter Benutzer -- wie zum Beispiel ein
Administrator -- einen Satz von Regeln benötigt, die vom standardmäßigen
d206 1
a206 1
<tt>authpf.rules</tt>-Datei hat. Wenn die Benutzer-spezifische Datei
d212 1
a212 1
Filter- und Übersetzungsregeln haben die gleiche Syntax wie jede
d221 2
a222 2
Es ist empfohlene Praxis, das <tt>$user_ip</tt>-Makro zu verwenden,
um nur den Verkehr durch das Gateway von dem Computer des
d242 1
a242 1
gedacht sind, für alle authentifizierte Benutzer zu gelten.
d247 1
a247 1
Datei in dem <tt>/etc/authpf/banned/</tt>-Verzeichnis erstellt und sie
d259 1
a259 1
existiert oder ,<tt>*</tt>' in die Datei eingetragen wurde, wird authpf
d270 1
a270 1
<h3>Eine Login-Nachricht anzeigen</h3>
d291 1
a291 1
Damit authpf funktionieren kann, muss es als Login-Shell einem Benutzer
d295 3
a297 3
authentifiziert, wird authpf als Benutzer-Shell ausgeführt. Es wird dann
überprüfen, ob dem Benutzer erlaubt wurde, authpf zu benutzen, lädt die
Regeln aus den passenden Dateien, etc.
d300 1
a300 1
Es gibt einige Wege, um authpf als Benutzer-Shell zuzuweisen:
d311 2
a312 2
<li>Durch das Zuweisen eines Benutzer zu einer Login-Klasse und dem
Ändern der <tt>shell</tt>-Option dieser Klasse in
d314 1
a314 1
><tt>/etc/login.conf</tt></a>.
d318 1
a318 1
<h2>Eine authpf-Login-Klasse erstellen</h2>
d320 2
a321 2
Benutzerkonten und auhtpf-Benutzerkonten hat, kann es nützlich sein,
eine separate Login-Klasse für die authpf-Benutzer anzulegen.
d323 1
a323 1
systemweiter Basis und das einrichten unterschiedlicher Richtlinien
d328 1
a328 1
<li><b>shell</b> - Die Login-Shell eines Benutzers angeben.
d330 1
a330 1
zu erzwingen, egal, welcher Eintrag in der
d333 1
a333 1
<li><b>welcome</b> - Gibt an, welche
d341 1
a341 1
Login-Klassen können in der
d344 1
a344 1
Eine Beispiel-Login-Klasse für authpf-Benutzer:
d356 1
a356 1
Benutzer werden eine Login-Klasse zugewiesen, indem das
d366 1
a366 1
PF-Regeln angepasst hat, ändert authpf den Prozesstitel um auf den
d375 1
a375 1
eingeloggt. Durch das Senden eines SIGTERM-Signals zum authpf-Prozesses
d378 2
a379 1
schließt alle ,stateful' Verbindungen, die der Benutzer geöffnet hat.
d388 5
a392 5
Campus-Netzwerkes ist. Sobald ein Benutzer sich authentifiziert hat,
vorausgesetzt, dass er nicht auf der Bannliste steht, wird ihm
erlaubt, eine SSH-Verbindung nach außen aufzubauen und im Web zu
surfen (einschließlich sicheren Webseiten), zusätzlich zu dem Zugriff auf
einen der Campus-DNS-Server.
d434 2
a435 2
Der Hauptregelsatz -- der sich in <tt>/etc/pf.conf</tt> befindet --
wurde wie folgt aufgesetzt:<br>
d471 1
a471 1
<li>Blockiere alles (standardmäßiges Blocken).
d479 1
a479 1
<li>Erzeuge einen Ankerpunkt ,authpf' für eingehenden Verkehr auf dem
d486 2
a487 2
externe Interface fließen, doch wird alles durch die ,standardmäßiges
Blocken'-Richtlinie am Eindringen in das drahtlose Netzwerk-Interface
d508 1
a508 1
$Translation: authpf.html,v 1.17 2006/05/01 11:17:11 paldium Exp $<br>
@


1.16
log
@sync with Steelix CVS
@
text
@d68 1
a68 1
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=authpf&amp;sektion=8&amp;manpath=OpenBSD+3.8"
d75 1
a75 1
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=ksh&amp;sektion=1&amp;manpath=OpenBSD+3.8"
d77 1
a77 1
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=csh&amp;sektion=1&amp;manpath=OpenBSD+3.8"
d80 1
a80 1
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=pf&amp;sektion=4&amp;manpath=OpenBSD+3.8"
d136 1
a136 1
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=syslogd&amp;sektion=8&amp;manpath=OpenBSD+3.8"
d146 1
a146 1
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=authpf&amp;sektion=8&amp;manpath=OpenBSD+3.8"
d294 1
a294 1
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=sshd&amp;sektion=8&amp;manpath=OpenBSD+3.8"
d304 1
a304 1
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=chsh&amp;sektion=1&amp;manpath=OpenBSD+3.8"
d306 1
a306 1
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=vipw&amp;sektion=8&amp;manpath=OpenBSD+3.8"
d308 1
a308 1
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=useradd&amp;sektion=8&amp;manpath=OpenBSD+3.8"
d310 1
a310 1
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=usermod&amp;sektion=8&amp;manpath=OpenBSD+3.8"
d314 1
a314 1
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=login.conf&amp;sektion=5&amp;manpath=OpenBSD+3.8"
d507 2
a508 2
Originally [OpenBSD: authpf.html,v 1.17 ]<br>
$Translation: authpf.html,v 1.16 2006/04/24 17:44:30 paldium Exp $<br>
@


1.15
log
@sync with steelix translation CVS
@
text
@a5 1
<meta http-equiv="Content-Language" content="de">
d8 1
a8 1
<meta name="description"   content="Die OpenBSD-FAQ-Seite">
d507 2
a508 2
Originally [OpenBSD: authpf.html,v 1.17 ]
$Translation: authpf.html,v 1.15 2006/01/10 12:18:04 paldium Exp $
@


1.14
log
@sync with steelix translation CVS
@
text
@d470 1
a470 1
Der Regelsatz ist sehr einfach und macht folgendes:
d509 1
a509 1
$Translation: authpf.html,v 1.14 2005/11/04 11:01:45 paldium Exp $
@


1.13
log
@sync with Steelix CVS
@
text
@d69 1
a69 1
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=authpf&amp;sektion=8&amp;manpath=OpenBSD+3.7"
d76 1
a76 1
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=ksh&amp;sektion=1&amp;manpath=OpenBSD+3.7"
d78 1
a78 1
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=csh&amp;sektion=1&amp;manpath=OpenBSD+3.7"
d81 1
a81 1
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=pf&amp;sektion=4&amp;manpath=OpenBSD+3.7"
d137 1
a137 1
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=syslogd&amp;sektion=8&amp;manpath=OpenBSD+3.7"
d147 1
a147 1
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=authpf&amp;sektion=8&amp;manpath=OpenBSD+3.7"
d295 1
a295 1
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=sshd&amp;sektion=8&amp;manpath=OpenBSD+3.7"
d305 1
a305 1
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=chsh&amp;sektion=1&amp;manpath=OpenBSD+3.7"
d307 1
a307 1
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=vipw&amp;sektion=8&amp;manpath=OpenBSD+3.7"
d309 1
a309 1
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=useradd&amp;sektion=8&amp;manpath=OpenBSD+3.7"
d311 1
a311 1
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=usermod&amp;sektion=8&amp;manpath=OpenBSD+3.7"
d315 1
a315 1
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=login.conf&amp;sektion=5&amp;manpath=OpenBSD+3.7"
d508 2
a509 2
Originally [OpenBSD: authpf.html,v 1.16 ]
$Translation: authpf.html,v 1.13 2005/09/14 16:16:38 paldium Exp $
@


1.12
log
@sync with Steelix CVS
@
text
@d6 1
a8 1
<meta http-equiv="Content-Language" content="de">
d509 1
a509 1
$Translation: authpf.html,v 1.12 2005/07/26 10:44:24 paldium Exp $
@


1.11
log
@sync with Steelix CVS
@
text
@d41 1
a41 1
[<a href="../carp.html">Weiter: Firewall-Redundanz mit CARP und pfsync</a>]
d499 1
a499 1
[<a href="../carp.html">Weiter: Firewall-Redundanz mit CARP und pfsync</a>]
d509 1
a509 1
$Translation: authpf.html,v 1.11 2005/05/21 21:51:03 paldium Exp $
@


1.10
log
@sync with steelix translation CVS
@
text
@d41 1
a41 2
[<a href="example1.html">Weiter: Beispiel: Firewall für zuhause oder
ein kleines Büro</a>]
d499 1
a499 2
[<a href="example1.html">Weiter: Beispiel: Firewall für zuhause oder
ein kleines Büro</a>]
d508 2
a509 2
Originally [OpenBSD: authpf.html,v 1.15 ]
$Translation: authpf.html,v 1.10 2005/05/20 16:33:52 paldium Exp $
@


1.9
log
@Sync with Steelix CVS
@
text
@d70 1
a70 1
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=authpf&amp;sektion=8&amp;manpath=OpenBSD+3.6"
d77 1
a77 1
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=ksh&amp;sektion=1&amp;manpath=OpenBSD+3.6"
d79 1
a79 1
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=csh&amp;sektion=1&amp;manpath=OpenBSD+3.6"
d82 1
a82 1
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=pf&amp;sektion=4&amp;manpath=OpenBSD+3.6"
d138 1
a138 1
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=syslogd&amp;sektion=8&amp;manpath=OpenBSD+3.6"
d148 1
a148 1
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=authpf&amp;sektion=8&amp;manpath=OpenBSD+3.6"
d296 1
a296 1
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=sshd&amp;sektion=8&amp;manpath=OpenBSD+3.6"
d306 1
a306 1
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=chsh&amp;sektion=1&amp;manpath=OpenBSD+3.6"
d308 1
a308 1
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=vipw&amp;sektion=8&amp;manpath=OpenBSD+3.6"
d310 1
a310 1
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=useradd&amp;sektion=8&amp;manpath=OpenBSD+3.6"
d312 1
a312 1
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=usermod&amp;sektion=8&amp;manpath=OpenBSD+3.6"
d316 1
a316 1
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=login.conf&amp;sektion=5&amp;manpath=OpenBSD+3.6"
d510 2
a511 2
Originally [OpenBSD: authpf.html,v 1.14 ]
$Translation: authpf.html,v 1.9 2005/02/12 09:59:59 paldium Exp $
@


1.8
log
@Sync with Steelix CVS
@
text
@d54 1
d58 1
d61 1
a62 1
<li><a href="#moreinfo">Weitere Informationen</a>
d151 21
d228 19
d272 20
d320 46
a385 8
<a name="moreinfo"></a>
<h2>Weitere Informationen</h2>

Für eine komplette Beschreibung von authpfs Funktionsweise, greife
bitte auf die
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=authpf&amp;sektion=8&amp;manpath=OpenBSD+3.6"
>authpf-Manual-Seite</a> zurück.

a403 1
dns_servers = "{ 10.0.1.56, 10.0.2.56 }"
a404 2
pass in quick on $wifi_if proto udp from $user_ip to $dns_servers \
   port domain keep state
a423 1
dns_servers = "{ 10.0.1.56, 10.0.2.56 }"
a424 2
pass in quick on $wifi_if proto udp from $user_ip to $dns_servers \
   port domain keep state
d446 3
d455 4
a458 4
pass out quick on $ext_if proto tcp from $wifi_if:network flags S/SA \
   modulate state
pass out quick on $ext_if proto { udp, icmp } from $wifi_if:network \
   keep state
d460 1
a460 1
pass in quick on $wifi_if proto tcp from $wifi_if:network to $wifi_if \
d463 2
d475 1
a475 1
Interface vom drahtlosen Netzwerk durch.
d479 2
d510 2
a511 2
Originally [OpenBSD: authpf.html,v 1.11 ]
$Translation: authpf.html,v 1.8 2005/02/07 12:39:02 paldium Exp $
@


1.7
log
@Sync with Steelix CVS
@
text
@d15 1
a15 1
Copyright (c) 2003, 2004 Joel Knight <enabled@@myrealbox.com>
d91 18
a108 12
Authpf ändert den aktiven
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=pf&amp;sektion=4&amp;manpath=OpenBSD+3.6"
>pf(4)</a>-Regelsatz ab, indem Regeln einem
<a href="anchors.html#named">benannten Regelsatz</a> hinzugefügt werden,
der einem <a href="anchors.html">Ankerpunkt</a> angehängt ist.
Jedes Mal, wenn sich ein Benutzer authentifiziert, erstellt
autpf einen benannten Regelsatz und lädt vorkonfigurierte
<a href="filter.html">Filter</a>-, <a href="nat.html"><tt>nat</tt></a>-,
<a href="nat.html#binat"><tt>binat</tt></a>- und
<a href="rdr.html"><tt>rdr</tt></a>-Regeln hinein. Die Regeln, die authpf
lädt, können auf einer Benutzer-spezifischen oder System-weiten Basis
konfiguriert werden.
d409 2
a410 2
Originally [OpenBSD: authpf.html,v 1.10 ]
$Translation: authpf.html,v 1.7 2005/01/18 14:33:46 paldium Exp $
@


1.6
log
@Sync with Steelix CVS
@
text
@d9 1
a9 1
<meta name="description"   content="die OpenBSD-FAQ-Seite">
d402 5
a406 3
Originally [OpenBSD: authpf.html,v 1.10 ]<br>
$Translation: authpf.html,v 1.6 2004/12/22 12:29:53 paldium Exp $<br>
$OpenBSD: authpf.html,v 1.10 2004/12/22 04:28:16 david Exp $
@


1.5
log
@sync with Steelix CVS
@
text
@d35 3
a37 1
<img alt="[OpenBSD]" height=30 width=141 src="../../../images/smalltitle.gif">
d402 3
a404 3
Originally [OpenBSD: authpf.html,v 1.9 ]<br>
$Translation: authpf.html,v 1.5 2004/12/07 16:56:32 paldium Exp $<br>
$OpenBSD: authpf.html,v 1.9 2004/11/11 09:50:15 saad Exp $
@


1.4
log
@Sync with Steelix CVS
@
text
@d8 2
a9 1
<meta name="description"   content="Die OpenBSD FAQ Seite">
d54 1
a54 1
	<li><a href="#acl">Access Control Listen</a>
d67 1
a67 3
>Authpf(8)</a> is a user shell for authenticating gateways. An

ist eine Benutzer-Shell für authentifizierende Gateways. Ein
d79 1
a79 1
>pf(4)</a> Regelsatz durchzuführen, so dass der Verkehr des Benutzers
d81 1
a81 1
Translation oder redirection übersetzt wird. Sobald der Benutzer sich
d86 1
a86 1
das Gateway zu leiten, nur solange er seine SSH Sitzung offen hält.
d91 1
a91 1
>pf(4)</a> Regelsatz ab, indem Regeln einem
d94 1
a94 1
Jedes Mal, wenn eine sich ein Benutzer authentifiziert, erstellt
d99 1
a99 1
lädt, können auf einer benutzerspezifischen oder systemweiten Basis
d111 1
a111 1
<li>Arbeitern, die zuhause oder unterwegs arbeiten, etc., Zugriff
d114 1
a114 1
zugreifen, sondern können auch auf bestimmte Ressourcen (z.B. ihrem
d119 1
a119 1
dass Gast Benutzern nur begrenzter Internetzugriff erlaubt wird. Authpf
d125 3
a127 3
Authpf loggt den Benutzernamen und die IP Adresse von jedem Benutzer,
der sich erfolgreich authentifiziert, so wie auch den Start- und
Endzeiten ihrer Login Sitzung per
d135 1
a135 1
Die Basis-Schritte, die benötigt werden, um authpf zu konfigurieren
d139 1
a139 1
>authpf Manual Seite</a> zurück..
d156 2
a157 2
platziert wurden, wird PF  vom Hauptregelsatz abzweigen, um die
authpf Regeln zu verarbeiten. Es ist nicht notwendig, dass alle vier
d160 1
a160 1
soll, kann die <tt>nat-anchor</tt> Regel ausgelassen werden.
d173 1
a173 1
ausgetauscht) einloggt. Die benutzerspezifische Regelkonfiguration wird
d178 2
a179 2
<tt>authpf.rules</tt> Datei hat. Wenn die benutzerspezifische Datei
existiert, wird es die standardmäßige Datei überschreiben. Zumindest
d185 1
a185 1
anderer PF Regelsatz mit einer Ausnahme: Authpf erlaubt die Verwendung
d188 1
a188 1
<li><tt>$user_ip</tt> - Die IP Adresse des eingeloggten Benutzers
d193 1
a193 1
Es ist empfohlene Praxis, das <tt>$user_ip</tt> Makro zu verwenden,
d198 1
a198 1
<h3>Access Control Listen</h3>
d200 1
a200 1
Datei in dem <tt>/etc/authpf/banned/</tt> Verzeichnis erstellt und sie
d210 3
a212 3
indem der Benutzername in die <tt>/etc/authpf/authpf.allow</tt> Datei
eingetragen wird. Wenn die <tt>/etc/authpf/authpf.allow</tt> Datei nicht
existiert oder "<tt>*</tt>" in die Datei eingetragen wurde, wird authpf
d245 1
a245 1
Ändern der <tt>shell</tt> Option dieser Klasse in
d252 3
a254 3
Sobald sich ein Benutzer erfolgreich eingeloggt hat und authpf die PF
Regeln angepasst hat, ändert authpf den Prozesstitel um auf den
Benutzernamen und die IP Adresse des eingeloggten Benutzer zu deuten:
d262 1
a262 1
eingeloggt. Durch das Senden eines SIGTERM Signals zum authpf Prozesses
d276 1
a276 1
>authpf Manual Seite</a> zurück.
d280 1
a280 1
Authpf wird auf einem OpenBSD Gateway verwendet, um Benutzer eines
d282 5
a286 5
Campus Netzwerkes ist. Sobald ein Benutzer sich authentifiziert hat,
vorausgesetzt, dass sie nicht auf der Bannliste stehen, wird ihnen
erlaubt, eine SSH Verbindung nach außen aufzubauen und im Web zu
surfen (einschließlich sicheren Webseiten), zusätzlich zu dem Zugriff
einen der Campus DNS Server.
d289 1
a289 1
Die <tt>/etc/authpf/authpf.rules</tt> Datei beinhaltet folgende Regeln:<br>
d308 1
a308 1
auf die SMTP und POP3 Server vom Campus zuzugreifen, sowie im Web
d367 1
a367 1
<li>Lasse ausgehenden TCP, UDP und ICMP Verkehr durch das externe
d369 1
a369 1
<li>Lasse eingehen SSH Verkehr vom drahtlosen Netzwerk durch, der für
d372 1
a372 1
<li>Erzeuge einen Ankerpunkt "authpf" für eingehenden Verkehr auf dem
d378 8
a385 8
wenigen Verkehr zuzulassen wie möglich. Der Verkehr kann frei durch das
externe Interface fließen, doch wird alles durch die standardmäßige deny
Richtlinie am Eindringen in das drahtlose Netzwerk Interface verhindert.
Sobald sich ein Benutzer authentifiziert, wird der Verkehr von ihm
das drahtlose Interface passieren dürfen, um von dort aus durch das
Gateway in den Rest des Netzwerkes fließen zu dürfen. Das <tt>quick</tt>
Schlüsselwort wird durchgehend verwendet, so dass PF nicht jeden
benannten Regelsatz überprüfen muss, wenn eine neue Verbindung durch
d396 1
a396 1
<a href="index.html"><img height="24" width="24" src="../../images/back.gif" border="0" alt="[back]"></a> 
d400 4
a403 5
Originally [OpenBSD: authpf.html,v 1.9 ]
<br>
$Translation: authpf.html,v 1.4 2004/11/24 21:11:39 paldium Exp $
<br></small>
<small>$OpenBSD: authpf.html,v 1.9 2004/11/11 09:50:15 saad Exp $</small>
@


1.3
log
@Sync with Steelix CVS
@
text
@d4 1
a4 1
<title>PF: Authpf: Benutzer-Shell für Authentifizierende Gateways</title>
d41 1
a41 1
<h1><font color="#e00000">PF: Authpf: User Shell for Authenticating
d64 1
a64 1
<h2>Introduction</h2>
d367 1
a367 1
<li>Blockiere alles (standardmäßiges deny).
d403 1
a403 1
$Translation: authpf.html,v 1.3 2004/11/18 17:06:26 paldium Exp $
@


1.2
log
@Sync with Steelix CVS
@
text
@d4 1
a4 1
<title>PF: Authpf: User Shell for Authenticating Gateways</title>
d8 1
a8 1
<meta name="description"   content="the OpenBSD FAQ page">
a10 1
<meta name="copyright"     content="This document copyright 2004 by OpenBSD.">
d13 17
d36 4
a39 4
[<a href="ftp.html">Previous: Issues with FTP</a>]
[<a href="index.html">Contents</a>]
[<a href="example1.html">Next: Example #1: Firewall for Home or
Small Office</a>]
d46 1
a46 1
<h3>Table of Contents</h3>
d48 2
a49 2
<li><a href="#intro">Introduction</a>
<li><a href="#config">Configuration</a>
d51 4
a54 4
	<li><a href="#linkmain">Linking Authpf into the Main Ruleset</a>
	<li><a href="#loadrules">Configuring Loaded Rules</a>
	<li><a href="#acl">Access Control Lists</a>
	<li><a href="#shell">Assigning Authpf as a User's Shell</a>
d56 3
a58 3
<li><a href="#wholog">Seeing Who is Logged In</a>
<li><a href="#moreinfo">More Information</a>
<li><a href="#example">Example</a>
d65 1
a65 1
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=authpf&amp;sektion=8&amp;manpath=OpenBSD+3.4"
d67 8
a74 6
authenticating gateway is just like a regular network gateway (a.k.a. a
router) except that users must first authenticate themselves to the
gateway before it will allow traffic to pass through it. When a user's
shell is set to <tt>/usr/sbin/authpf</tt> (i.e., instead of setting a
user's shell to
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=ksh&amp;sektion=1&amp;manpath=OpenBSD+3.4"
d76 26
a101 23
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=csh&amp;sektion=1&amp;manpath=OpenBSD+3.4"
>csh(1)</a>, etc) and the user logs in using SSH, authpf will make the
necessary changes to the active  
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=pf&amp;sektion=4&amp;manpath=OpenBSD+3.4"
>pf(4)</a> ruleset so that the user's traffic is passed through the
filter and/or translated using Network Address Translation or
redirection. Once the user logs out or their session is disconnected,
authpf will remove any rules loaded for the user and kill any stateful
connections the user has open. Because of this, the ability of the user
to pass traffic through the gateway only exists while the user keeps
their SSH session open. 

<p>
Authpf alters the  
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=pf&amp;sektion=4&amp;manpath=OpenBSD+3.4"
>pf(4)</a> ruleset by adding rules to a 
<a href="anchors.html#named">named ruleset</a> attached to an
<a href="anchors.html">anchor point</a>. Each time a user authenticates,
authpf creates a new named ruleset and loads the preconfigured
<a href="filter.html">filter</a>, <a href="nat.html"><tt>nat</tt></a>,
<a href="nat.html#binat"><tt>binat</tt></a>, and 
<a href="rdr.html"><tt>rdr</tt></a> rules into it. The rules that authpf
loads can be configured on a per-user or global basis.
d104 1
a104 1
Example uses of authpf include:
d106 17
a122 14
<li>Requiring users to authenticate before allowing Internet access.
<li>Granting certain users -- such as administrators -- access to
restricted parts of the network.
<li>Allowing only known users to access the rest of the network or
Internet from a wireless network segment.
<li>Allowing workers from home, on the road, etc., access to resources on
the company network.  Users outside the office can not only open access
to the company network, but can also be redirected to particular
resources (e.g., their own desktop) based on the username they
authenticate with.
<li>In a setting such as a library or other place with public Internet
terminals, PF may be configured to allow limited Internet access to
guest users. Authpf can then be used to provide registered users with
complete access.
d126 7
a132 7
Authpf logs the username and IP address of each user who authenticates
successfully as well as the start and end times of their login session
via
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=syslogd&amp;sektion=8&amp;manpath=OpenBSD+3.4"
>syslogd(8)</a>. By using this information, an administrator can
determine who was logged in when and also make users accountable for
their network traffic.
d135 6
a140 5
<h2>Configuration</h2>
The basic steps needed to configure authpf are outlined here. For a
complete description of authpf configuration, please refer to the
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=authpf&amp;sektion=8&amp;manpath=OpenBSD+3.4"
>authpf man page</a>.
d143 3
a145 2
<h3>Linking Authpf into the Main Ruleset</h3>
Authpf is linked into the main ruleset by using <tt>anchor</tt> rules:
d148 4
a151 4
nat-anchor authpf<br>
rdr-anchor authpf<br>
binat-anchor authpf<br>
anchor authpf<br>
d156 6
a161 5
Wherever the <tt>anchor</tt> rules are placed within the ruleset is
where PF will branch off from the main ruleset to evaluate the authpf
rules. It's not necessary for all four <tt>anchor</tt> rules to be
present; for example, if authpf hasn't been setup to load any
<tt>nat</tt> rules, the <tt>nat-anchor</tt> rule can be omitted.
d164 2
a165 2
<h3>Configuring Loaded Rules</h3>
Authpf loads its rules from one of two files:
d172 16
a187 13
The first file contains rules that are only loaded when the user
<tt>$USER</tt> (which is replaced with the user's username) logs in. The
per-user rule configuration is used when a specific user -- such as an
administrator -- requires a set of rules that is different than the
default set.  The second file contains the default rules which are
loaded for any user that doesn't have their own <tt>authpf.rules</tt>
file. If the user-specific file exists, it will override the default
file. At least one of the files must exist or authpf will not run. 

<p>
Filter and translation rules have the same syntax as in any other PF
ruleset with one exception: Authpf allows for the use of two predefined
macros:
d189 2
a190 2
<li><tt>$user_ip</tt> - the IP address of the logged in user
<li><tt>$user_id</tt> - the username of the logged in user
d194 3
a196 3
It's recommended practice to use the <tt>$user_ip</tt> macro to only
permit traffic through the gateway from the authenticated user's
computer.
d199 23
a221 20
<h3>Access Control Lists</h3>
Users can be prevented from using authpf by creating a file in the
<tt>/etc/authpf/banned/</tt> directory and naming it after the username
that is to be denied access.  The contents of the file will be displayed
to the user before authpf disconnects them. This provides a handy way to
notify the user of why they're disallowed access and who to contact to
have their access restored.

<p>
Conversely, it's also possible to allow only specific users access by
placing usernames in the <tt>/etc/authpf/authpf.allow</tt> file.  If the
<tt>/etc/authpf/authpf.allow</tt> file does not exist or "<tt>*</tt>" is
entered into the file, then authpf will permit access to any user who
successfully logs in via SSH as long as they are not explicitly banned.

<p>
If authpf is unable to determine if a username is allowed or denied, it
will print a brief message and then disconnect the user. An entry in
<tt>/etc/authpf/banned/</tt> always overrides an entry in
<tt>/etc/authpf/authpf.allow</tt>.
d224 8
a231 7
<h3>Assigning Authpf as a User's Shell</h3>
In order for authpf to work it must be assigned as the user's login
shell. When the user successfully authenticates to
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=sshd&amp;sektion=8&amp;manpath=OpenBSD+3.4"
>sshd(8)</a>, authpf will be executed as the user's shell. It will then
check if the user is allowed to use authpf, load the rules from the
appropriate file, etc.
d234 1
a234 1
There are a couple ways of assigning authpf as a user's shell:
d236 2
a237 2
<li>Manually for each user using
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=chsh&amp;sektion=1&amp;manpath=OpenBSD+3.4"
d239 1
a239 1
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=vipw&amp;sektion=8&amp;manpath=OpenBSD+3.4"
d241 1
a241 1
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=useradd&amp;sektion=8&amp;manpath=OpenBSD+3.4"
d243 1
a243 1
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=usermod&amp;sektion=8&amp;manpath=OpenBSD+3.4"
d245 3
a247 3
<li>By assigning users to a login class and changing the class's 
<tt>shell</tt> option in
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=login.conf&amp;sektion=5&amp;manpath=OpenBSD+3.4"
d252 4
a255 4
<h2>Seeing Who is Logged In</h2>
Once a user has successfully logged in and authpf has adjusted the PF
rules, authpf changes its process title to indicate the username and IP
address of the logged in user:
d262 5
a266 4
Here the user <tt>charlie</tt> is logged in from the machine
192.168.1.3.  By sending a SIGTERM signal to the authpf process, the
user can be forcefully logged out. Authpf will also remove any rules
loaded for the user and kill any stateful connections the user has open.
d272 6
a277 4
<h2>More Information</h2>
For a complete description of authpf operation, please refer to the 
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=authpf&amp;sektion=8&amp;manpath=OpenBSD+3.4"
>authpf man page</a>.
d280 8
a287 6
<h2>Example</h2>
Authpf is being used on an OpenBSD gateway to authenticate users on a
wireless network which is part of a larger campus network. Once a user
has authenticated, assuming they're not on the banned list, they will be
permitted to SSH out and to browse the web (including secure web sites)
in addition to accessing either of the campus DNS servers.
d290 1
a290 1
The <tt>/etc/authpf/authpf.rules</tt> file contains the following rules:<br>
d308 4
a311 4
The administrative user <tt>charlie</tt> needs to be able to access the
campus SMTP and POP3 servers in addition to surfing the web and using
SSH. The following rules are setup in
<tt>/etc/authpf/users/charlie/authpf.rules</tt>:<br>
d335 2
a336 2
The main ruleset -- located in <tt>/etc/pf.conf</tt> -- is setup
as follows:<br>
d359 1
a359 1
anchor authpf in on $wifi_if
d365 1
a365 1
The ruleset is very simple and does the following:
d367 8
a374 7
<li>Block everything (default deny).
<li>Pass outgoing TCP, UDP, and ICMP traffic on the external interface 
from the wireless network.
<li>Pass incoming SSH traffic from the wireless network destined for the
gateway itself. This rule is necessary to permit users to log in.
<li>Create the anchor point "authpf" for incoming traffic on the wireless
interface. 
d378 16
a393 15
The idea behind the main ruleset is to block everything and allow the
least amount of traffic through as possible. Traffic is free to flow out
on the external interface but is blocked from entering the wireless
interface by the default deny policy. Once a user authenticates,
their traffic is permitted to pass in on the wireless interface
and to then flow through the gateway into the rest of the network. The
<tt>quick</tt> keyword is used throughout so that PF doesn't have to
evaluate each named ruleset when a new connection passes through the
gateway.

<p>
[<a href="ftp.html">Previous: Issues with FTP</a>]
[<a href="index.html">Contents</a>]
[<a href="example1.html">Next: Example #1: Firewall for Home or
Small Office</a>]
d397 1
a397 1
<a href="../../de/index.html"><img height="24" width="24" src="../../../images/back.gif" border="0" alt="[back]"></a> 
d401 1
a401 1
Originally [OpenBSD: authpf.html,v 1.5 ]
d403 4
a406 4
$Translation: authpf.html,v 1.2 2004/02/15 23:53:04 jufi Exp $
<br>
</small>
<small>$OpenBSD: authpf.html,v 1.5 2004/01/01 04:16:17 nick Exp $</small>
@


1.1
log
@Sync with Steelix CVS
@
text
@d11 1
a11 1
<meta name="copyright"     content="This document copyright 2003 by OpenBSD.">
d360 4
a363 3
Originally [OpenBSD: authpf.html,v 1.4 ]<br>
$Translation: authpf.html,v 1.1 2003/11/27 17:34:57 sl Exp $<br>
$OpenBSD$
d365 1
a365 1

@

