head	1.18;
access;
symbols;
locks; strict;
comment	@# @;


1.18
date	2011.11.27.14.41.28;	author ajacoutot;	state dead;
branches;
next	1.17;

1.17
date	2008.08.10.16.14.28;	author tobias;	state Exp;
branches;
next	1.16;

1.16
date	2008.03.09.13.37.13;	author tobias;	state Exp;
branches;
next	1.15;

1.15
date	2007.11.12.20.29.59;	author saad;	state Exp;
branches;
next	1.14;

1.14
date	2007.04.26.03.08.07;	author jufi;	state Exp;
branches;
next	1.13;

1.13
date	2006.11.01.11.30.45;	author jufi;	state Exp;
branches;
next	1.12;

1.12
date	2006.10.31.15.09.58;	author jufi;	state Exp;
branches;
next	1.11;

1.11
date	2006.10.29.10.58.52;	author jufi;	state Exp;
branches;
next	1.10;

1.10
date	2006.04.25.08.25.49;	author saad;	state Exp;
branches;
next	1.9;

1.9
date	2006.01.14.11.36.00;	author jufi;	state Exp;
branches;
next	1.8;

1.8
date	2005.09.20.07.30.02;	author saad;	state Exp;
branches;
next	1.7;

1.7
date	2005.02.08.13.59.02;	author jufi;	state Exp;
branches;
next	1.6;

1.6
date	2005.01.18.17.18.10;	author jufi;	state Exp;
branches;
next	1.5;

1.5
date	2004.12.22.20.00.48;	author jufi;	state Exp;
branches;
next	1.4;

1.4
date	2004.12.08.05.22.44;	author saad;	state Exp;
branches;
next	1.3;

1.3
date	2004.12.03.19.44.28;	author jufi;	state Exp;
branches;
next	1.2;

1.2
date	2004.02.16.00.29.50;	author jufi;	state Exp;
branches;
next	1.1;

1.1
date	2003.11.27.19.39.09;	author horacio;	state Exp;
branches;
next	;


desc
@@


1.18
log
@Sync with Steelix CVS
@
text
@<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<html>
<head>
<title>PF: Scrub (Paket-Normalisierung)</title>
<link rev="made" href="mailto:www@@openbsd.org">
<meta http-equiv="Content-Type" content="text/html; charset=ISO-8859-1">
<meta name="resource-type" content="document">
<meta name="description"   content="the OpenBSD FAQ page">
<meta name="keywords"      content="openbsd,faq,pf">
<meta name="distribution"  content="global">
</head>

<!--
Copyright (c) 2003, Nick Holland <nick@@openbsd.org>
Copyright (c) 2003-2005, Joel Knight <enabled@@myrealbox.com>

Permission to use, copy, modify, and distribute this documentation for
any purpose with or without fee is hereby granted, provided that the
above copyright notice and this permission notice appear in all copies.

THE DOCUMENTATION IS PROVIDED "AS IS" AND THE AUTHOR DISCLAIMS ALL
WARRANTIES WITH REGARD TO THIS DOCUMENTATION INCLUDING ALL IMPLIED
WARRANTIES OF MERCHANTABILITY AND FITNESS. IN NO EVENT SHALL THE
AUTHOR BE LIABLE FOR ANY SPECIAL, DIRECT, INDIRECT, OR CONSEQUENTIAL
DAMAGES OR ANY DAMAGES WHATSOEVER RESULTING FROM LOSS OF USE, DATA OR
PROFITS, WHETHER IN AN ACTION OF CONTRACT, NEGLIGENCE OR OTHER
TORTIOUS ACTION, ARISING OUT OF OR IN CONNECTION WITH THE USE OR
PERFORMANCE OF THIS DOCUMENTATION
-->

<body bgcolor="#ffffff" text="#000000">
<!-- Passes validator.w3.org, please keep it this way;
please, use a max of 72 chars per line -->

<a href="../../../de/index.html">
<img alt="[OpenBSD]" height=30 width=141 src="../../../images/smalltitle.gif" border="0">
</a>
<p>
[<a href="options.html">Zurück: Laufzeit-Optionen</a>]
[<a href="index.html">Inhalt</a>]
[<a href="anchors.html">Weiter: Anker</a>]

<p>
<h1><font color="#e00000">PF: Scrub (Paket-Normalisierung)</font></h1>
<hr>

<h3>Inhaltsverzeichnis</h3>
<ul>
<li><a href="#intro">Einführung</a>
<li><a href="#options">Optionen</a>
</ul>

<hr>

<a name="intro"></a>
<h2>Einführung</h2>
,Scrubbing' ist die Normalisierung von Paketen, sodass keine
Zweideutigkeiten bei der Interpretation bei dem ultimativen Ziel
der Pakete entstehen. Die scrub-Direktive setzt fragmentierte Pakete
ebenfalls wieder zusammen, schützt einige Betriebssysteme vor einigen
Formen von Attacken und lässt TCP-Pakete fallen, die eine ungültige
<a href="filter.html#tcpflags">Flag</a>-Kombination haben. Eine
einfache Form einer scrub-Direktive:
<blockquote>
<tt>
scrub in all
</tt>
</blockquote>

<p>
Dies wird ,scrub' auf alle eingehenden Pakete auf allen Interfaces
anwenden.

<p>
Ein Grund, auf einem Interface ,scrub' nicht auszuführen, ist, wenn
man NFS durch PF leitet. Einige Nicht-OpenBSD-Plattformen senden
(und erwarten) seltsame Pakete - fragmentierte Pakete, die das
,nicht fragmentieren'-Bit gesetzt haben, welche (ordnungsgemäß) von
<tt>scrub</tt> abgelehnt werden. Dies kann mit der Verwendung der
<tt>no-df</tt>-Option gelöst werden. Ein anderer Grund ist, dass einige
Multiplayer-Spiele Probleme mit Verbindungen haben, die durch PF mit
aktivem <tt>scrub</tt> geleitet werden. Wenn man von diesen etwas
ungewöhnlichen Fällen absieht, ist es <i>dringend empfohlene</i>
Praxis, ,scrub' auf alle Pakete anzuwenden.

<p>
Die Syntax der <tt>scrub</tt>-Direktive ist der
<a href="filter.html">Filter</a>-Syntax sehr ähnlich, was es
sehr einfach macht, bestimmte Pakete auszuwählen, auf die ,scrub'
angewendet werden soll und auf welche nicht.
Das <tt>no</tt>-Schlüsselwort kann vor <tt>scrub</tt> benutzt werden,
um bestimmte Pakete dem ,scrub' nicht zu unterziehen.
So wie es bei <a href="nat.html#except"><tt>nat</tt>-Regeln</a> auch
der Fall ist, gewinnt die erste zutreffende Regel.

<p>
Mehr zu den Prinzipien und Konzepten vom ,scrubbing' kann in den
<i><a href="http://www.icir.org/vern/papers/norm-usenix-sec-01-html/index.html"
>Network Intrusion Detection: Evasion, Traffic Normalization, and
End-to-End Protocol Semantics</a></i>-Unterlagen gefunden werden.

<a name="options"></a>
<h2>Optionen</h2>
<tt>Scrub</tt> hat die folgenden Optionen:
<dl>
<dt><tt>no-df</tt>
<dd>Entfernt das <i>nicht fragmentieren</i>-Bit vom IP-Paket-Header.
Von einigen Betriebssystemen ist bekannt, dass sie fragmentierte
Pakete mit gesetztem <i>nicht fragmentieren</i>-Bit generieren. Dies
gilt insbesondere bei der Verwendung von NFS. <tt>Scrub</tt> wird
solche Pakete fallen lassen, außer die <tt>no-df</tt>-Option wurde
angegeben. Weil einige Betriebssysteme <i>nicht fragmentieren</i>-Pakete
mit einem leeren IP-identification-Header-Feld senden, wird das
Verwenden von <tt>no-df</tt> in Verbindung mit <tt>random-id</tt>
empfohlen.

<dt><tt>random-id</tt>
<dd>Ersetzt das IP-identification-Feld von Paketen mit zufälligen
Werten, um Betriebssysteme auszugleichen, die vorhersehbare Werte
verwenden. Diese Option gilt nur für Pakete, die nach dem
optionalen Zusammensetzen der Pakete nicht fragmentiert sind.

<dt><tt>min-ttl <i>num</i></tt>
<dd>Erzwingt eine minimale Time To Live (TTL) in IP-Paket-Headern.

<dt><tt>max-mss <i>num</i></tt>
<dd>Erzwingt eine maximale Maximum Segment Size (MSS) in TCP-Paket-Headern.

<dt><tt>fragment reassemble</tt>
<dd>Puffert eingehende Paketfragmente und setzt sie wieder in ein
ganzes Paket um, bevor sie in die Filter-Engine gesendet werden.
Der Vorteil ist, dass Filterregeln sich nur um komplette Pakete
kümmern müssen und somit fragmentierte vernachlässigen können.
Der Nachteil ist, dass mehr Speicher benötigt wird, um die Paketfragmente
zwischenzuspeichern. Dies ist das standardmäßige Verhalten, wenn
keine <tt>fragment</tt>-Option angegeben wurde. Dies ist ebenfalls die
einzige <tt>fragment</tt>-Option, die mit NAT zusammen arbeitet.

<dt><tt>fragment crop</tt>
<dd>Veranlasst doppelte Fragmente fallen zu lassen und überlappende
abzuschneiden. Im Gegensatz zu <tt>fragment reassemble</tt>,
werden Fragmente nicht zwischengespeichert sondern, sobald sie ankommen,
durchgelassen.

<dt><tt>fragment drop-ovl</tt>
<dd><tt>fragment crop</tt> ähnlich, außer, dass doppelte und überlappende
Fragmente genauso wie weiter-korrespondierende Fragmente fallengelassen
werden.

<dt><tt>reassemble tcp</tt>
<dd>normalisiert TCP-Verbindungen ,statefully'.
Wenn <tt>scrub reassemble tcp</tt> verwendet wird, darf eine Richtung
(rein/raus) nicht angegeben werden.
Die folgenden Normalisierungen werden durchgeführt:
	<ul>
	<li>Keiner Seite der Verbindung wird erlaubt, ihre IP-TTL zu
	reduzieren. Dies wird gemacht, um Schutz gegen Angreifer zu
	bieten, die Pakete so senden, dass sie die Firewall erreichen,
	die Information des gehaltenen ,states' beeinflussen und
	auslaufen, bevor sie den Ziel-Host erreichen können. Die TTL
	von allen Paketen wird erhöht, um den höchsten Wert anzunehmen,
	der bei der Verbindung beobachtet wurde.
	<li>Moduliere
	<a href="http://www.geektools.com/rfc/rfc1323.txt">RFC1323</a>-Zeitstempel
	in TCP-Paket-Headern mit einer Zufallszahl. Dies kann Beobachter
	davon abhalten, die Uptime des Hosts zu ermitteln, oder davon
	abhalten zu raten, wie viele Hosts hinter einem NAT-Gateway
	liegen.
	</ul>
</dl>

<p>
Beispiele:
<blockquote>
<tt>
scrub in on fxp0 all fragment reassemble min-ttl 15 max-mss 1400<br>
scrub in on fxp0 all no-df<br>
scrub &nbsp;&nbsp; on fxp0 all reassemble tcp
</tt>
</blockquote>

<p>
[<a href="options.html">Zurück: Laufzeit-Optionen</a>]
[<a href="index.html">Inhalt</a>]
[<a href="anchors.html">Weiter: Anker</a>]

<p>
<hr>
<a href="index.html"><img height="24" width="24" src="../../../images/back.gif" border="0" alt="[zurück]"></a>
<a href="mailto:www@@openbsd.org">www@@openbsd.org</a>
<br>
<small>
<!--
Originally [OpenBSD: scrub.html,v 1.15 ]<br>
$Translation: scrub.html,v 1.17 2008/08/04 14:41:05 paldium Exp $<br>
-->
$OpenBSD: scrub.html,v 1.17 2008/08/10 16:14:28 tobias Exp $
</small>

</body>
</html>
@


1.17
log
@Sync with Steelix CVS
@
text
@d197 1
a197 1
$OpenBSD$
@


1.16
log
@Sync with Steelix CVS
@
text
@d194 2
a195 2
Originally [OpenBSD: scrub.html,v 1.14 ]<br>
$Translation: scrub.html,v 1.16 2008/03/04 23:03:19 paldium Exp $<br>
@


1.15
log
@Sync with Steelix CVS
@
text
@d111 1
a111 1
solche Pakete fallenlassen, außer die <tt>no-df</tt>-Option wurde
d195 1
a195 1
$Translation: scrub.html,v 1.15 2007/11/03 10:45:44 paldium Exp $<br>
@


1.14
log
@Sync with steelix translation CVS
@
text
@d57 1
a57 1
,Scrubbing' ist die Normalisierung von Paketen, so dass keine
d195 1
a195 1
$Translation: scrub.html,v 1.14 2007/04/25 15:41:15 paldium Exp $<br>
@


1.13
log
@sync with steelix translation CVS
@
text
@d77 1
a77 1
(und erwarten) seltsame Pakete -- fragmentierte Pakete, die das
d106 1
a106 1
<dt><tt>no-df</tt> 
d117 1
a117 1
<dt><tt>random-id</tt> 
d123 1
a123 1
<dt><tt>min-ttl <i>num</i></tt> 
d126 1
a126 1
<dt><tt>max-mss <i>num</i></tt> 
d129 1
a129 1
<dt><tt>fragment reassemble</tt> 
d139 1
a139 1
<dt><tt>fragment crop</tt> 
d145 1
a145 1
<dt><tt>fragment drop-ovl</tt> 
d195 1
a195 1
$Translation: scrub.html,v 1.13 2006/11/01 10:48:51 paldium Exp $<br>
d201 1
a201 1
</html> 
@


1.12
log
@sync with steelix translation CVS
@
text
@d98 1
a98 1
,<a href="http://www.icir.org/vern/papers/norm-usenix-sec-01-html/index.html"
d100 1
a100 1
End-to-End Protocol Semantics</a>'-Unterlagen gefunden werden.
d195 1
a195 1
$Translation: scrub.html,v 1.12 2006/10/31 12:39:06 paldium Exp $<br>
@


1.11
log
@sync with steelix translation CVS
@
text
@d194 2
a195 2
Originally [OpenBSD: scrub.html,v 1.13 ]<br>
$Translation: scrub.html,v 1.11 2006/10/29 09:44:48 paldium Exp $<br>
@


1.10
log
@sync with Steelix CVS
@
text
@d118 1
a118 1
<dd>Ersetzt das IP-identification-Feld gesendeter Pakete mit zufälligen
d120 1
a120 1
verwenden. Diese Option gilt nur für gesendete Pakete, die nach dem
d194 2
a195 2
Originally [OpenBSD: scrub.html,v 1.12 ]<br>
$Translation: scrub.html,v 1.10 2006/04/24 17:44:30 paldium Exp $<br>
@


1.9
log
@sync with steelix translation CVS
@
text
@a5 1
<meta http-equiv="Content-Language" content="de">
d8 1
a8 1
<meta name="description"   content="Die OpenBSD-FAQ-Seite">
d194 2
a195 2
Originally [OpenBSD: scrub.html,v 1.12 ]
$Translation: scrub.html,v 1.9 2006/01/10 12:18:04 paldium Exp $
@


1.8
log
@sync with Steelix CVS
@
text
@d168 2
a169 1
	abhalten zu raten, wieviele Hosts hinter einem NAT-Gateway liegen.
d196 1
a196 1
$Translation: scrub.html,v 1.8 2005/09/14 16:16:39 paldium Exp $
@


1.7
log
@Sync with Steelix CVS
@
text
@d6 1
a8 1
<meta http-equiv="Content-Language" content="de">
d195 1
a195 1
$Translation: scrub.html,v 1.7 2005/02/07 12:39:02 paldium Exp $
@


1.6
log
@Sync with Steelix CVS
@
text
@d16 1
a16 1
Copyright (c) 2003, 2004, Joel Knight <enabled@@myrealbox.com>
d42 1
a42 1
[<a href="anchors.html">Weiter: Anker und benannte (Unter-)Regelsätze</a>]
d185 1
a185 1
[<a href="anchors.html">Weiter: Anker und benannte (Unter-)Regelsätze</a>]
d194 2
a195 2
Originally [OpenBSD: scrub.html,v 1.11 ]
$Translation: scrub.html,v 1.6 2005/01/18 14:33:46 paldium Exp $
@


1.5
log
@Sync with Steelix CVS
@
text
@d9 1
a9 1
<meta name="description"   content="die OpenBSD-FAQ-Seite">
d193 5
a197 3
Originally [OpenBSD: scrub.html,v 1.11 ]<br>
$Translation: scrub.html,v 1.5 2004/12/22 12:29:54 paldium Exp $<br>
$OpenBSD: scrub.html,v 1.11 2004/12/22 04:28:16 david Exp $
@


1.4
log
@sync with Steelix CVS
@
text
@d36 3
a38 1
<img alt="[OpenBSD]" height=30 width=141 src="../../../images/smalltitle.gif">
d193 3
a195 3
Originally [OpenBSD: scrub.html,v 1.10 ]<br>
$Translation: scrub.html,v 1.4 2004/12/07 16:56:32 paldium Exp $<br>
$OpenBSD: scrub.html,v 1.10 2004/11/01 21:41:07 nick Exp $
@


1.3
log
@Sync with Steelix CVS, all work by Tobias Stoeckmann
@
text
@d9 1
a9 1
<meta name="description"   content="Die OpenBSD-FAQ-Seite">
d56 1
a56 1
,Scrubbing' ist die Normalisierung von Paketen, sodass keine
d112 1
a112 1
mit einer leeren IP-identification-Header-Feld senden, wird das
d146 1
a146 1
Fragmente genauso wie weiter-korrespondierende Fragmente fallen gelassen
d187 1
a187 1
<a href="index.html"><img height="24" width="24" src="../../images/back.gif" border="0" alt="[back]"></a> 
d192 1
a192 1
$Translation: scrub.html,v 1.3 2004/12/03 15:58:35 paldium Exp $<br>
@


1.2
log
@Sync with Steelix CVS
@
text
@d4 1
a4 1
<title>PF: Scrub (Paket Normalisierung)</title>
d8 2
a9 1
<meta name="description"   content="the OpenBSD FAQ page">
a11 1
<meta name="copyright"     content="This document copyright 2002-2003 by OpenBSD.">
d14 18
d38 3
a40 3
[<a href="options.html">Previous: Options</a>]
[<a href="index.html">Contents</a>]
[<a href="queueing.html">Next: Queueing</a>]
d43 1
a43 1
<h1><font color="#e00000">PF: Scrub</font></h1>
d46 1
a46 1
<h3>Table of Contents</h3>
d48 2
a49 2
<li><a href="#intro">Introduction</a>
<li><a href="#options">Options</a>
d55 8
a62 7
<h2>Introduction</h2>
"Scrubbing" is the normalization of packets so there are no ambiguities
in interpretation by the ultimate destination of the packet.  The scrub
directive also reassembles fragmented packets, protecting some operating
systems from some forms of attack, and drops TCP packets that have
invalid <a href="filter.html#tcpflags">flag</a> combinations.  A simple
form of the scrub directive:
d70 2
a71 16
This will scrub all incoming packets on all interfaces.

<p>
One reason not to scrub on an interface is if one is passing NFS through
PF.  Some non-OpenBSD platforms send (and expect) strange packets --
fragmented packets with the "do not fragment" bit set, which are
(properly) rejected by <tt>scrub</tt>.  This can be resolved by use of the
<tt>no-df</tt> option.  Another reason is some multi-player games have
connection problems passing through PF with <tt>scrub</tt> enabled.
Other than these somewhat unusual cases, scrubbing all packets is
<i>highly recommended</i> practice.

<p>
The <tt>scrub</tt> directive syntax is very similar to the
<a href="filter.html">filtering</a> syntax which makes it easy to
selectively scrub certain packets and not others.
d74 26
a99 3
More on the principle and concepts of scrubbing here:
<a href="http://www.icir.org/vern/papers/norm-usenix-sec-01-html/index.html"
>http://www.icir.org/vern/papers/norm-usenix-sec-01-html/index.html</a>
d102 2
a103 2
<h2>Options</h2>
<tt>Scrub</tt> has the following options:
d106 9
a114 8
<dd>Clears the <i>don't fragment</i> bit from the IP
packet header. Some operating systems are known to generate fragmented
packets with the <i>don't fragment</i> bit set. This is particularly
true with NFS. <tt>Scrub</tt> will drop such packets unless the
<tt>no-df</tt> option is specified. Because some operating systems
generate <i>don't fragment</i> packets with a zero IP identification
header field, using <tt>no-df</tt> in conjunction with <tt>random-id</tt>
is recommended.
d117 4
a120 4
<dd>Replaces the IP identification field of
outgoing packets with random values to compensate for operating systems
that use predictable values. This option only applies to outgoing
packets that are not fragmented after the optional packet reassembly.
d123 1
a123 2
<dd>Enforces a minimum Time To Live (TTL)
in IP packet headers.
d126 1
a126 2
<dd>Enforces a maximum Maximum Segment
Size (MSS) in TCP packet headers.
d129 8
a136 7
<dd>Buffers incoming packet fragments and
reassembles them into a complete packet before passing them to the
filter engine. The advantage is that filter rules only have to deal
with complete packets and can ignore fragments. The drawback is the
increased memory needed to buffer packet fragments. This is the default
behavior when no <tt>fragment</tt> option is specified. This is also the
only <tt>fragment</tt> option that works with NAT.
d139 4
a142 3
<dd>Causes duplicate fragments to be dropped
and any overlaps to be cropped. Unlike <tt>fragment reassemble</tt>,
fragments are not buffered but are passed on as soon as they arrive.
d145 23
a167 3
<dd>Similar to <tt>fragment crop</tt>
except that all duplicate or overlapping fragments will be dropped as
well as any further corresponding fragments.
d171 1
a171 1
Example:
d174 3
a176 1
scrub in on fxp0 all fragment reassemble min-ttl 15 max-mss 1400
d181 3
a183 3
[<a href="options.html">Previous: Options</a>]
[<a href="index.html">Contents</a>]
[<a href="queueing.html">Next: Queueing</a>]
d187 1
a187 1
<a href="../../de/index.html"><img height="24" width="24" src="../../../images/back.gif" border="0" alt="[back]"></a> 
d191 3
a193 3
Originally [OpenBSD: scrub.html,v 1.6 ]<br>
$Translation: scrub.html,v 1.2 2004/02/15 23:53:04 jufi Exp $<br>
$OpenBSD$
@


1.1
log
@Sync with Steelix CVS
@
text
@d4 1
a4 1
<title>PF: Scrub</title>
d141 1
a141 1
$Translation: scrub.html,v 1.1 2003/11/27 17:34:57 sl Exp $<br>
@

