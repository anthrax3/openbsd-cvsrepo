head	1.27;
access;
symbols;
locks; strict;
comment	@# @;


1.27
date	2014.04.01.17.18.45;	author nick;	state dead;
branches;
next	1.26;

1.26
date	2013.11.01.18.04.05;	author ajacoutot;	state Exp;
branches;
next	1.25;

1.25
date	2013.05.01.17.39.07;	author ajacoutot;	state Exp;
branches;
next	1.24;

1.24
date	2013.05.01.14.42.14;	author ajacoutot;	state Exp;
branches;
next	1.23;

1.23
date	2012.11.02.07.24.05;	author ajacoutot;	state Exp;
branches;
next	1.22;

1.22
date	2012.05.13.16.30.18;	author ajacoutot;	state Exp;
branches;
next	1.21;

1.21
date	2012.01.17.11.13.00;	author ajacoutot;	state Exp;
branches;
next	1.20;

1.20
date	2009.11.07.07.32.54;	author ajacoutot;	state Exp;
branches;
next	1.19;

1.19
date	2009.05.04.19.07.52;	author tobias;	state Exp;
branches;
next	1.18;

1.18
date	2008.11.01.11.02.22;	author tobias;	state Exp;
branches;
next	1.17;

1.17
date	2008.08.10.16.14.28;	author tobias;	state Exp;
branches;
next	1.16;

1.16
date	2007.11.12.20.29.59;	author saad;	state Exp;
branches;
next	1.15;

1.15
date	2007.05.09.05.49.52;	author jufi;	state Exp;
branches;
next	1.14;

1.14
date	2007.04.26.03.08.05;	author jufi;	state Exp;
branches;
next	1.13;

1.13
date	2006.11.01.11.30.45;	author jufi;	state Exp;
branches;
next	1.12;

1.12
date	2006.08.08.07.14.20;	author saad;	state Exp;
branches;
next	1.11;

1.11
date	2006.07.06.15.41.58;	author saad;	state Exp;
branches;
next	1.10;

1.10
date	2006.04.25.08.25.49;	author saad;	state Exp;
branches;
next	1.9;

1.9
date	2005.11.04.20.24.23;	author jufi;	state Exp;
branches;
next	1.8;

1.8
date	2005.09.20.07.30.02;	author saad;	state Exp;
branches;
next	1.7;

1.7
date	2005.05.20.17.13.26;	author jufi;	state Exp;
branches;
next	1.6;

1.6
date	2005.01.18.17.18.10;	author jufi;	state Exp;
branches;
next	1.5;

1.5
date	2004.12.22.20.00.48;	author jufi;	state Exp;
branches;
next	1.4;

1.4
date	2004.12.08.05.22.43;	author saad;	state Exp;
branches;
next	1.3;

1.3
date	2004.12.03.19.44.28;	author jufi;	state Exp;
branches;
next	1.2;

1.2
date	2004.11.28.16.13.25;	author jufi;	state Exp;
branches;
next	1.1;

1.1
date	2003.11.27.19.39.09;	author horacio;	state Exp;
branches;
next	;


desc
@@


1.27
log
@
missed another one...
@
text
@<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<html>
<head>
<title>PF: Probleme mit FTP</title>
<link rev="made" href="mailto:www@@openbsd.org">
<meta http-equiv="Content-Type" content="text/html; charset=ISO-8859-1">
<meta name="resource-type" content="document">
<meta name="description"   content="the OpenBSD FAQ page">
<meta name="keywords"      content="openbsd,faq,pf">
<meta name="distribution"  content="global">
</head>

<!--
Copyright (c) 2003, Nick Holland <nick@@openbsd.org>
Copyright (c) 2003, 2004, Joel Knight <enabled@@myrealbox.com>

Permission to use, copy, modify, and distribute this documentation for
any purpose with or without fee is hereby granted, provided that the
above copyright notice and this permission notice appear in all copies.

THE DOCUMENTATION IS PROVIDED "AS IS" AND THE AUTHOR DISCLAIMS ALL
WARRANTIES WITH REGARD TO THIS DOCUMENTATION INCLUDING ALL IMPLIED
WARRANTIES OF MERCHANTABILITY AND FITNESS. IN NO EVENT SHALL THE
AUTHOR BE LIABLE FOR ANY SPECIAL, DIRECT, INDIRECT, OR CONSEQUENTIAL
DAMAGES OR ANY DAMAGES WHATSOEVER RESULTING FROM LOSS OF USE, DATA OR
PROFITS, WHETHER IN AN ACTION OF CONTRACT, NEGLIGENCE OR OTHER
TORTIOUS ACTION, ARISING OUT OF OR IN CONNECTION WITH THE USE OR
PERFORMANCE OF THIS DOCUMENTATION
-->

<body bgcolor="#ffffff" text="#000000">
<!-- Passes validator.w3.org, please keep it this way;
please, use a max of 72 chars per line -->

<a href="../../../de/index.html">
<img alt="[OpenBSD]" height=30 width=141 src="../../../images/smalltitle.gif" border="0">
</a>
<p>
[<a href="perf.html">Zurück: Leistung</a>]
[<a href="index.html">Inhalt</a>]
[<a href="authpf.html">Weiter: Authpf: Benutzer-Shell für authentifizierende
Gateways</a>]

<p>
<h1><font color="#e00000">PF: Probleme mit FTP</font></h1>
<hr>

<h3>Inhaltsverzeichnis</h3>
<ul>
<li><a href="#modes">FTP-Modi</a>
<li><a href="#client">FTP-Client hinter der Firewall</a>
<li><a href="#server">Ein FTP-Server, der »sich selbst mit PF
    schützt«</a>
<li><a href="#natserver">FTP-Server, die durch eine externe PF-Firewall
mit NAT beschützt werden</a>
<li><a href="#info">Weitere Informationen zum Thema FTP</a>
<li><a href="#tftp-proxy">Proxy für TFTP</a>
</ul>

<hr>

<a name="modes"></a>
<h2>FTP-Modi</h2>
FTP ist ein Protokoll, das zu der Zeit entwickelt wurde, als das Internet
noch eine kleine, freundliche Ansammlung von Computern war und jeder
jeden kannte. Zu dieser Zeit war die Notwendigkeit zum Filtern und für
strikte Sicherheit nicht gegeben. FTP wurde nicht zum Filtern, zum
Weiterleiten durch Firewalls oder für die Zusammenarbeit mit NAT
entwickelt.

<p>
Du kannst FTP auf zwei unterschiedliche Weisen verwenden: passiv oder
aktiv. Generell gilt, dass die Wahl zwischen aktiv und passiv entscheidet,
wer das Problem mit der Firewall haben wird. Sei realistisch, du wirst
beide unterstützen müssen, um glückliche Anwender zu haben.

<p>
Bei aktivem FTP wird der FTP-Server eine neue Verbindung zurück zum
-Client eröffnen, um die angefragten Daten zu übertragen, wenn ein
Benutzer sich zu einem entfernten FTP-Server verbindet und eine
Information oder Datei anfragt. Diese wird als <i>data connection</i>
bezeichnet. Am Anfang entscheidet der FTP-Client sich für einen
zufälligen Port, auf dem die Datenverbindung angenommen werden soll. Der
Client sendet dann die gewählte Portnummer zum FTP-Server und lauscht
dann auf dem Port für eine eingehende Verbindung. Der FTP-Server
erstellt dann eine Verbindung zur Adresse vom Client am gewählten Port
und überträgt die Daten. Dies ist ein Problem für Benutzer, die auf
einen FTP-Server zugreifen wollen, wenn sie selbst hinter einem
NAT-Gateway liegen. Wegen der Funktionsweise von NAT wird der FTP-Server
eine Datenverbindung zur externen Adresse des NAT-Gateways auf dem
gewählten Port aufbauen. Die NAT-Maschine wird diese Verbindung
erhalten, aber da sie nicht in der Statustabelle aufgelistet ist, wird
sie das Paket fallen lassen und nicht zum Client weiterleiten.

<p>
Beim passiven FTP-Modus (dem standardmäßigen Modus mit OpenBSDs <a
href="http://www.openbsd.org/cgi-bin/man.cgi?query=ftp&amp;sektion=1"
>ftp(1)</a>-Client) wird der Client vom Server verlangen, dass dieser
einen zufälligen Port auswählen soll, auf dem er dann auf die
Datenverbindung wartet. Der Server teilt dem Client mit, welchen
Port er ausgewählt hat und der Client verbindet sich auf diesen Port,
um die Daten zu übertragen. Unglücklicherweise ist dies nicht immer
möglich oder erwünscht, da die Möglichkeit besteht, dass eine Firewall
vor dem FTP-Server die eingehende Datenverbindung blockt. OpenBSDs
ftp(1) verwendet standardmäßig den passiven Modus. Um aktives FTP
zu erzwingen, verwende die Option -A mit ftp oder setze den passiven
Modus aus (off), indem du das Kommando »<tt>passive off</tt>« am
»<tt>ftp&gt;</tt>«-Prompt eingibst.

<a name="client"></a>
<h2>FTP-Client hinter der Firewall</h2>
Wie zuvor schon angedeutet, funktioniert FTP nicht sonderlich gut über
NAT und Firewalls.


<p>
Packet Filter bietet eine Lösung für dieses Problem, indem der
FTP-Verkehr über einen FTP-Proxyserver umgeleitet wird.
Dieser Prozess leitet deinen FTP-Verkehr durch das NAT-Gateway/durch die
NAT-Firewall, indem aktiv benötigte Regeln zum PF-System hinzugefügt
und danach wieder entfernt werden. All das wird über das
<a href="anchors.html">Anker</a>-System von PF ermöglicht.
Der FTP-Proxy, der von PF verwendet wird, ist
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=ftp-proxy&amp;sektion=8&amp;manpath=OpenBSD+5.4"
>ftp-proxy(8)</a>.

<p>
Um ihn zu aktivieren, schreibe etwas wie das Folgende frühzeitig in den
Abschnitt »Regeln« der Datei <tt>pf.conf</tt>:

<blockquote>
<tt>
pass in quick on $int_if inet proto tcp to port 21 divert-to 127.0.0.1 port 8021
</tt>
</blockquote>

<p>
Dies leitet FTP-Anfragen von deinen Clients auf das Program ftp-proxy(8) um,
dass auf deiner Maschine auf dem Port 8021 lauscht.

<p>
Du benötigst ebenfalls einen Anker im Regel-Abschnitt:
<blockquote>
<tt>
anchor "ftp-proxy/*"
</tt>
</blockquote>

<p>
Hoffentlich ist es ersichtlich, dass der Proxyserver auf dem
OpenBSD-System gestartet werden und laufen muss. Dies wird erreicht,
indem die folgende Zeile in die <tt>/etc/rc.conf.local</tt> hinzugefügt
wird:

<blockquote>
<tt>
ftpproxy_flags=""
</tt>
</blockquote>

<p>
Das Programm ftp-proxy kann als root gestartet werden, um es auch
ohne Neustart zu aktivieren.

<p>
ftp-proxy lauscht auf dem Port 8021 - der gleiche Port, an den das obige
»<tt>divert-to</tt>«-Angabe den FTP-Verkehr sendet.

<p>
Um »active mode«-Verbindungen (aktives FTP) von gewissen (pingeligen) Clients
zu unterstützen, benötigst du die Option »-r« von ftp-proxy(8).


<a name="server"></a>
<h2>Ein FTP-Server, der »sich selbst mit PF schützt«</h2>
In diesem Fall läuft PF direkt auf dem FTP-Server, statt auf einem
extra dafür installiertem Firewall-Computer. Wenn eine passive
FTP-Verbindung angeboten wird, wird FTP zufällig einen hohen TCP-Port
für eingehende Daten auswählen. Standardmäßig wird OpenBSDs nativer
FTP-Server
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=ftpd&amp;sektion=8"
>ftpd(8)</a>
einen Port aus dem Bereich 49152 bis 65535 nutzen.
Diese müssen selbstverständlich zusätzlich zum Port 21
(FTP-Kontrollport) durch die Filterregeln gelassen werden.

<blockquote>
<tt>
pass in on $ext_if proto tcp to port 21<br>
pass in on $ext_if proto tcp to port &gt; 49151
</tt>
</blockquote>

<p>
Wenn du möchtest, kannst du den Bereich der Ports beachtlich
verbessern. Im Falle von OpenBSDs
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=ftpd&amp;sektion=8"
>ftpd(8)</a>-Programm wird dies durch die Verwendung von den
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=sysctl&amp;sektion=8"
>sysctl(8)</a>-Variablen <tt>net.inet.ip.porthifirst</tt> und
<tt>net.inet.ip.porthilast</tt> ermöglicht.

<a name="natserver"></a>
<h2>FTP-Server, die durch eine externe PF-Firewall mit NAT beschützt
werden</h2>
In diesem Fall muss die Firewall den Verkehr zum FTP-Server nicht nur
zu den Ports durchlassen, sondern auch weiterleiten. Um dies zu
bewerkstelligen, wenden wir uns wieder ftp-proxy(8) zu.

<p>
ftp-proxy(8) kann in einem Modus betrieben werden, der alle
FTP-Verbindungen zu einem bestimmten FTP-Server weiterleitet. Im Grunde
werden wir also einen Proxy einrichten, der auf Port 21 der Firewall
lauscht und alle Verbindungen zum eigentlichen Server weiterleitet.


<p>
Editiere <tt>/etc/rc.conf.local</tt> und füge folgende Zeile hinzu:

<blockquote>
<tt>
ftpproxy_flags="-R 10.10.10.1 -p 21 -b 192.168.0.1"
</tt>
</blockquote>

<p>
10.10.10.1 ist hierbei die IP-Adresse des tatsächlichen FTP-Servers,
21 ist die Portnummer, auf der ftp-proxy(8) lauschen soll und
192.168.0.1 ist die Adresse der Firewall, an die sich der Proxy binden
soll.

<p>
Kommen wir nun zu den pf.conf-Regeln:

<blockquote>
<tt>
ext_ip = "192.168.0.1"<br>
ftp_ip = "10.10.10.1"<br>
<br>
match out on $ext_if inet from $int_if nat-to ($ext_if)<br>
<br>
anchor "ftp-proxy/*"<br>
pass in on $ext_if inet proto tcp to $ext_ip port 21<br>
pass out on $int_if inet proto tcp to $ftp_ip port 21 user proxy
</tt>
</blockquote>

<p>
Hiermit erlauben wir eingehenden Verkehr zum Port 21 des externen
Interfaces und ausgehenden Verkehr zum FTP-Server. Die Erweiterung
»user proxy« bei der ausgehenden Verbindung stellt sicher, dass nur
Verbindungen erlaubt werden, die vom ftp-proxy initiiert wurden.

<p>
Falls du mit ftp-proxy(8) einen FTP-Server beschützen möchtest und
gleichzeitig FTP-Clients hinter der Firewall verwalten musst, so
brauchst du zwei ftp-proxy-Instanzen.


<a name="info"></a>
<h2>Weitere Informationen zum Thema FTP</h2>
Weitere Informationen zum Thema FTP-Filtern und wie FTP generell
funktioniert, können in diesem Whitepaper gefunden werden:
<ul>
<li><a href="http://www.pintday.org/whitepapers/ftp-review.shtml">FTP
Reviewed</a>
</ul>


<a name="tftp-proxy"></a>
<h2>Proxy für TFTP</h2>

<p>
Das »Trivial File Transfer Protocol« (TFTP) hat die gleichen Nachteile
wie FTP, wenn es um die Weiterleitung durch eine Firewall geht.
Zum Glück verfügt PF über einen Hilfsproxy für TFTP:
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=tftp-proxy&amp;sektion=8&amp;manpath=OpenBSD+5.4"
>tftp-proxy(8)</a>.

<p>
tftp-proxy(8) wird fast genauso wie ftp-proxy(8) im Abschnitt
<a href="#client">FTP-Client hinter der Firewall</a> eingerichtet.

<blockquote>
<tt>
match out on $ext_if from $int_if nat-to ($ext_if)<br>
anchor "tftp-proxy/*"<br>
pass in quick on $int_if inet proto udp from $int_if to port tftp \<br>
&nbsp;&nbsp;&nbsp;&nbsp;divert-to 127.0.0.1 port 6969<br>
<br>
anchor "tftp-proxy/*"
</tt>
</blockquote>

<p>
Diese Regeln erlauben ausgehenden TFTP-Verkehr vom internen Netzwerk
zu TFTP-Servern im externen Netzwerk.

<p>
Der letzte Schritt besteht darin, tftp-proxy in der
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=inetd.conf&amp;sektion=5"
>inetd.conf(5)</a> zu aktivieren, sodass der Proxy auf dem
selben Port lauscht, wie in der <tt>divert-to</tt>-Regel angegeben; in diesem
Fall 6969.

<blockquote>
<tt>
127.0.0.1:6969  dgram   udp   wait  root  /usr/libexec/tftp-proxy tftp-proxy
</tt>
</blockquote>

<p>
Im Gegensatz zu ftp-proxy(8) wird tftp-proxy(8) von inetd aufgerufen.


<p>
[<a href="perf.html">Zurück: Leistung</a>]
[<a href="index.html">Inhalt</a>]
[<a href="authpf.html">Weiter: Authpf: Benutzer-Shell für authentifizierende
Gateways</a>]

<p>
<hr>
<a href="index.html"><img height="24" width="24" src="../../../images/back.gif" border="0" alt="[zurück]"></a>
<a href="mailto:www@@openbsd.org">www@@openbsd.org</a>
<br>
<small>
<!--
Originally [OpenBSD: ftp.html,v 1.39 ]<br>
$Translation: ftp.html,v 1.26 2013/11/01 16:59:45 steffen Exp $<br>
-->
$OpenBSD: ftp.html,v 1.26 2013/11/01 18:04:05 ajacoutot Exp $
</small>

</body>
</html>
@


1.26
log
@Sync with Steelix CVS
@
text
@d332 1
a332 1
$OpenBSD$
@


1.25
log
@Sync with Steelix CVS
@
text
@d124 1
a124 1
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=ftp-proxy&amp;sektion=8&amp;manpath=OpenBSD+5.3"
d277 1
a277 1
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=tftp-proxy&amp;sektion=8&amp;manpath=OpenBSD+5.3"
d329 2
a330 2
Originally [OpenBSD: ftp.html,v 1.38 ]<br>
$Translation: ftp.html,v 1.25 2013/05/01 16:34:16 steffen Exp $<br>
@


1.24
log
@Sync with Steelix CVS
@
text
@d329 2
a330 2
Originally [OpenBSD: ftp.html,v 1.37 ]<br>
$Translation: ftp.html,v 1.24 2013/05/01 13:35:26 steffen Exp $<br>
@


1.23
log
@Sync with Steelix CVS
@
text
@d124 1
a124 1
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=ftp-proxy&amp;sektion=8&amp;manpath=OpenBSD+5.2"
d277 1
a277 1
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=tftp-proxy&amp;sektion=8&amp;manpath=OpenBSD+5.2"
d330 1
a330 1
$Translation: ftp.html,v 1.23 2012/11/01 20:43:18 steffen Exp $<br>
@


1.22
log
@Sync with Steelix CVS
@
text
@d124 1
a124 1
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=ftp-proxy&amp;sektion=8&amp;manpath=OpenBSD+5.1"
d277 1
a277 1
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=tftp-proxy&amp;sektion=8&amp;manpath=OpenBSD+5.1"
d329 2
a330 2
Originally [OpenBSD: ftp.html,v 1.36 ]<br>
$Translation: ftp.html,v 1.22 2012/05/11 17:06:29 steffen Exp $<br>
@


1.21
log
@Sync with Steelix CVS
@
text
@d124 1
a124 1
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=ftp-proxy&amp;sektion=8&amp;manpath=OpenBSD+5.0"
d277 1
a277 1
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=tftp-proxy&amp;sektion=8&amp;manpath=OpenBSD+5.0"
d329 2
a330 2
Originally [OpenBSD: ftp.html,v 1.35 ]<br>
$Translation: ftp.html,v 1.21 2012/01/16 19:24:22 steffen Exp $<br>
@


1.20
log
@Sync with Steelix CVS
@
text
@d118 2
a119 2
FTP-Verkehr durch einen FTP-Proxyserver hindurch geleitet wird. Dieser
Prozess leitet deinen FTP-Verkehr durch das NAT-Gateway/durch die
d124 1
a124 1
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=ftp-proxy&amp;sektion=8&amp;manpath=OpenBSD+4.6"
d128 2
a129 2
Um ihn zu aktivieren, schreibe in die NAT-Sektion
von <tt>pf.conf</tt> einen Eintrag, der auf diesem aufbaut:
d133 1
a133 4
nat-anchor "ftp-proxy/*"<br>
rdr-anchor "ftp-proxy/*"<br>
rdr on $int_if proto tcp from any to any port 21 -&gt; 127.0.0.1 \<br>
&nbsp;&nbsp;&nbsp;port 8021
d138 2
a139 6
Die ersten beiden Zeilen aktivieren eine Reihe
<a href="anchors.html">Anker</a>, die von ftp-proxy genutzt werden,
um Regeln bei Bedarf hinzufügen zu können, wenn es um die Verwaltung
von FTP-Verkehr geht.
Die letzte Zeile leitet FTP von deinen Clients zum Programm ftp-proxy(8)
um, welches auf deiner Maschine auf dem Port 8021 hört.
d142 1
a142 1
Du braucht ebenfalls einen Anker in deiner Regelsektion:
d166 2
a167 3
ftp-proxy lauscht auf dem Port 8021 - der gleiche Port, der im
vorherigen <tt>rdr</tt>-Ausdruck genannt wurde, als es um die Umleitung
des FTP-Verkehrs ging.
d170 2
a171 3
Um Verbindungen für aktives FTP zu ermöglichen, musst du die Option
»-r« an ftp-proxy(8) übergeben (hierfür musstest du an den alten
Proxy »-u root« benutzen).
d189 2
a190 3
pass in on $ext_if proto tcp from any to any port 21 keep state<br>
pass in on $ext_if proto tcp from any to any port &gt; 49151 \<br>
&nbsp;&nbsp;&nbsp;keep state
d240 1
a240 3
nat-anchor "ftp-proxy/*"<br>
nat on $ext_if inet from $int_if -&gt; ($ext_if)<br>
rdr-anchor "ftp-proxy/*"<br>
d242 3
a244 5
pass in on $ext_if inet proto tcp to $ext_ip port 21 \<br>
&nbsp;&nbsp;&nbsp;&nbsp;flags S/SA keep state<br>
pass out on $int_if inet proto tcp to $ftp_ip port 21 \<br>
&nbsp;&nbsp;&nbsp;&nbsp;user proxy flags S/SA keep state<br>
anchor "ftp-proxy/*"
d277 1
a277 1
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=tftp-proxy&amp;sektion=8&amp;manpath=OpenBSD+4.6"
d286 4
a289 4
nat on $ext_if from $int_if -&gt; ($ext_if)<br>
rdr-anchor "tftp-proxy/*"<br>
rdr on $int_if proto udp from $int_if to port tftp -&gt; \<br>
&nbsp;&nbsp;&nbsp;&nbsp;127.0.0.1 port 6969<br>
d303 1
a303 1
selben Port lauscht, wie in der <tt>rdr</tt>-Regel angegeben; in diesem
d329 2
a330 2
Originally [OpenBSD: ftp.html,v 1.29 ]<br>
$Translation: ftp.html,v 1.20 2009/11/05 12:55:49 tobias Exp $<br>
@


1.19
log
@Sync with Steelix CVS
@
text
@d124 1
a124 1
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=ftp-proxy&amp;sektion=8&amp;manpath=OpenBSD+4.5"
d291 1
a291 1
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=tftp-proxy&amp;sektion=8&amp;manpath=OpenBSD+4.5"
d343 2
a344 2
Originally [OpenBSD: ftp.html,v 1.28 ]<br>
$Translation: ftp.html,v 1.19 2009/05/03 12:44:31 tobias Exp $<br>
@


1.18
log
@Sync with Steelix CVS
@
text
@d124 1
a124 1
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=ftp-proxy&amp;sektion=8&amp;manpath=OpenBSD+4.4"
d291 1
a291 1
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=tftp-proxy&amp;sektion=8&amp;manpath=OpenBSD+4.4"
d343 2
a344 2
Originally [OpenBSD: ftp.html,v 1.27 ]<br>
$Translation: ftp.html,v 1.18 2008/11/01 09:15:07 paldium Exp $<br>
@


1.17
log
@Sync with Steelix CVS
@
text
@d124 1
a124 1
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=ftp-proxy&amp;sektion=8&amp;manpath=OpenBSD+4.3"
d291 1
a291 1
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=tftp-proxy&amp;sektion=8&amp;manpath=OpenBSD+4.3"
d343 2
a344 2
Originally [OpenBSD: ftp.html,v 1.26 ]<br>
$Translation: ftp.html,v 1.17 2008/08/04 14:41:04 paldium Exp $<br>
@


1.16
log
@Sync with Steelix CVS
@
text
@d123 3
a125 7
Der FTP-Proxy, der von OpenBSD und PF verwendet wird, ist
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=ftp-proxy&amp;sektion=8&amp;manpath=OpenBSD+4.2"
>ftp-proxy(8)</a>. (Hinweis: frühere OpenBSD-Versionen verwendeten
einen anderen Proxy mit dem selben Namen, der in OpenBSD 3.8
dokumentiert wurde:
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=ftp-proxy&amp;sektion=8&amp;manpath=OpenBSD+3.8"
>ftp-proxy(8)v3.8</a>)
d291 1
a291 1
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=tftp-proxy&amp;sektion=8&amp;manpath=OpenBSD+4.2"
d343 2
a344 2
Originally [OpenBSD: ftp.html,v 1.25 ]<br>
$Translation: ftp.html,v 1.16 2007/11/03 10:45:42 paldium Exp $<br>
@


1.15
log
@Sync with steelix translation CVS
@
text
@d124 1
a124 1
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=ftp-proxy&amp;sektion=8&amp;manpath=OpenBSD+4.1"
d295 1
a295 1
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=tftp-proxy&amp;sektion=8&amp;manpath=OpenBSD+4.1"
d320 1
a320 1
>inetd.conf(5)</a> zu aktivieren, so dass der Proxy auf dem
d347 2
a348 2
Originally [OpenBSD: ftp.html,v 1.24 ]<br>
$Translation: ftp.html,v 1.15 2007/05/08 21:34:44 simon Exp $<br>
@


1.14
log
@Sync with steelix translation CVS
@
text
@d97 1
a97 1
href="http://www.openbsd.org/cgi-bin/man.cgi?query=ftp&amp;sektion=1&amp;manpath=OpenBSD+4.0"
d124 1
a124 1
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=ftp-proxy&amp;sektion=8&amp;manpath=OpenBSD+4.0"
d194 1
a194 1
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=ftpd&amp;sektion=8&amp;manpath=OpenBSD+4.0"
d211 1
a211 1
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=ftpd&amp;sektion=8&amp;manpath=OpenBSD+4.0"
d213 1
a213 1
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=sysctl&amp;sektion=8&amp;manpath=OpenBSD+4.0"
d295 1
a295 1
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=tftp-proxy&amp;sektion=8&amp;manpath=OpenBSD+4.0"
d319 1
a319 1
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=inetd.conf&amp;sektion=5&amp;manpath=OpenBSD+4.0"
d347 2
a348 2
Originally [OpenBSD: ftp.html,v 1.23 ]<br>
$Translation: ftp.html,v 1.14 2007/04/25 15:41:14 paldium Exp $<br>
@


1.13
log
@sync with steelix translation CVS
@
text
@d348 1
a348 1
$Translation: ftp.html,v 1.13 2006/11/01 10:48:51 paldium Exp $<br>
d354 1
a354 1
</html> 
@


1.12
log
@sync with Steelix CVS
@
text
@d57 1
d97 1
a97 1
href="http://www.openbsd.org/cgi-bin/man.cgi?query=ftp&amp;sektion=1&amp;manpath=OpenBSD+3.9"
d124 1
a124 1
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=ftp-proxy&amp;sektion=8&amp;manpath=OpenBSD+3.9"
a185 5
<p>
Bedenke bitte, dass der ftp-proxy(8) dazu da ist, den <b>FTP-Clients</b>
hinter einem PF-Filter zu helfen; er kann keinen <b>FTP-Server</b> hinter
einem PF-Filter handhaben.

d194 1
a194 1
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=ftpd&amp;sektion=8&amp;manpath=OpenBSD+3.9"
d211 1
a211 1
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=ftpd&amp;sektion=8&amp;manpath=OpenBSD+3.9"
d213 1
a213 1
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=sysctl&amp;sektion=8&amp;manpath=OpenBSD+3.9"
d221 18
a238 5
zu den Ports durchlassen, sondern auch weiterleiten. Um das Beispiel
einfach zu halten, nehmen wir an, dass wieder der normale
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=ftpd&amp;sektion=8&amp;manpath=OpenBSD+3.9"
>ftpd(8)</a> von OpenBSD mit dem standardmäßigen Portbereich genutzt
wird.
d241 8
a248 1
Hier ist ein Beispiel-Unterregelsatz, der dies realisieren würde:
d251 2
a252 1
ftp_server = "10.0.3.21"<br>
d254 3
a256 4
rdr on $ext_if proto tcp from any to any port 21 -&gt; $ftp_server \<br>
&nbsp;&nbsp;&nbsp;port 21<br>
rdr on $ext_if proto tcp from any to any port 49152:65535 -&gt; \<br>
&nbsp;&nbsp;&nbsp;$ftp_server port 49152:65535<br>
d258 5
a262 11
# in on $ext_if<br>
pass in quick on $ext_if proto tcp from any to $ftp_server \<br>
&nbsp;&nbsp;&nbsp;port 21 keep state<br>
pass in quick on $ext_if proto tcp from any to $ftp_server \<br>
&nbsp;&nbsp;&nbsp;port &gt; 49151 keep state<br>
<br>
# out on $int_if<br>
pass out quick on $int_if proto tcp from any to $ftp_server \<br>
&nbsp;&nbsp;&nbsp;port 21 keep state<br>
pass out quick on $int_if proto tcp from any to $ftp_server \<br>
&nbsp;&nbsp;&nbsp;port &gt; 49151 keep state
d266 11
d287 47
d347 2
a348 2
Originally [OpenBSD: ftp.html,v 1.22 ]<br>
$Translation: ftp.html,v 1.12 2006/08/06 14:06:56 paldium Exp $<br>
@


1.11
log
@sync with Steelix CVS
@
text
@d52 2
a53 1
<li><a href="#server">Ein FTP-Server, der ,sich selbst mit PF schützt'</a>
d55 1
a55 1
beschützt werden, die NAT verwendet</a>
d66 1
a66 1
straffe Sicherheit nicht gegeben. FTP wurde nicht zum Filtern, zum
d77 16
a92 15
Bei aktivem FTP wird der FTP-Server eine neue Verbindung zurück zum -Client
eröffnen, um die angefragten Daten zu übertragen, wenn ein Benutzer sich
zu einem entfernten FTP-Server verbindet und eine Information oder Datei
anfragt. Diese wird als <i>data connection</i> bezeichnet. Am Anfang
entscheidet der FTP-Client sich für einen zufälligen Port, auf dem die
,data connection' angenommen werden soll. Der Client sendet dann die
gewählte Portnummer zum FTP-Server und lauscht dann auf dem Port für eine
eingehende Verbindung. Der FTP-Server erstellt dann eine Verbindung zur
Adresse vom Client am gewählten Port und überträgt die Daten. Dies ist ein
Problem für Benutzer, die auf einen FTP-Server zugreifen wollen, wenn sie
selbst hinter einem NAT-Gateway liegen. Wegen der Funktionsweise von NAT
wird der FTP-Server eine ,data connection' zur externen Adresse des
NAT-Gateways auf dem gewählten Port aufbauen. Die NAT-Maschine wird diese
Verbindung erhalten, aber da sie nicht in der ,state'-Tabelle aufgelistet
ist, wird sie das Paket fallen lassen und nicht zum Client weiterleiten.
d95 1
a95 1
Beim passiven FTP-Modus (dem standardmäßigem Modus mit OpenBSDs <a
d99 1
a99 1
,data connection' wartet. Der Server teilt dem Client mit, welchen
d103 5
a107 5
vor dem FTP-Server die eingehende ,data connection' blockt. OpenBSDs
ftp(1) verwendet standardmäßig den passiven Modus; um aktives FTP
zu erzwingen, verwende die -A-Option mit ftp oder setze den passiven
Modus aus (off), indem du das Kommando ,<tt>passive off</tt>' am
,<tt>ftp&gt;</tt>' Prompt eingibst.
d111 2
a112 2
Wie zuvor schon angedeutet, geht FTP nicht sonderlich gut durch NAT
und Firewalls hindurch.
d118 1
a118 1
Prozess ,leitet' deinen FTP-Verkehr durch das NAT-Gateway/durch die
d120 1
a120 1
und danach wieder entfernt werden - all das wird über das
d124 1
a124 1
>ftp-proxy(8)</a>. (Hinweis: früher OpenBSD-Versionen verwendeten
d128 1
a128 1
>ftp-proxy(8)v3.8</a>.)
d131 2
a132 2
Um ihn zu aktivieren, erstelle in der NAT-Sektion
von <tt>pf.conf</tt> etwas, das ähnlich diesem Eintrag ist:
d172 1
a172 1
Das ftp-proxy-Programm kann als root gestartet werden, um es auch
d181 1
a181 1
Um Verbindungen für aktives FTP zu ermögilchen, musst du die Option
d192 1
a192 1
<h2>Ein FTP-Server, der ,sich selbst mit PF schützt'</h2>
d201 2
a202 2
Diese müssen selbstverständlich durch die Filterregeln gelassen werden,
zusätzlich zum Port 21 (dem FTP-Kontroll-Port):
d214 1
a214 1
verbessern. Im Falle vom OpenBSD
d222 5
a226 5
<h2>FTP-Server, die durch eine externe PF-Firewall beschützt werden,
die NAT verwendet</h2>
In diesem Fall muss die Firewall den Verkehr zum FTP-Server zusätzlich
zum Durchlassen der Ports auch weiterleiten. Um das Beispiel einfach
zu halten, nehmen wir an, dass wieder der normale OpenBSD-
d228 1
a228 1
>ftpd(8)</a> unter Verwendung des standardmäßigen Portbereichs genutzt
d260 1
a260 1
funktioniert, können in diesem ,whitepaper' gefunden werden:
d280 1
a280 1
$Translation: ftp.html,v 1.11 2006/07/02 11:19:44 paldium Exp $<br>
@


1.10
log
@sync with Steelix CVS
@
text
@d94 1
a94 1
href="http://www.openbsd.org/cgi-bin/man.cgi?query=ftp&amp;sektion=1&amp;manpath=OpenBSD+3.8"
d117 8
a124 2
NAT-Firewall. Der FTP-Proxy, der von OpenBSD und PF verwendet wird,
ist
d126 4
a129 1
>ftp-proxy(8)</a>. Um ihn zu aktivieren, erstelle in der NAT-Sektion
d134 2
d142 6
a147 3
Die Erklärung dieser Zeile ist: "Verkehr auf dem internen Interface wird
zum Proxyserver weitergeleitet, der auf dieser Maschine läuft und auf
dem Port 8021 lauscht."
d150 1
a150 4
Hoffentlich ist es offensichtlich, dass der Proxyserver auf dem
OpenBSD-Rechner gestartet werden und auch laufen muss. Dies wird durch das
Eintragen der folgenden Zeile in die <tt>/etc/inetd.conf</tt> realisiert:

d153 1
a153 2
127.0.0.1:8021 stream tcp nowait root /usr/libexec/ftp-proxy \<br>
&nbsp;&nbsp;&nbsp;ftp-proxy -n
d158 4
a161 6
Bedenke, dass die <tt>-n</tt>-Option nur notwendig ist, wenn die
OpenBSD-Maschine als NAT arbeitet.
Sende jetzt ein ,HUP'-Signal zum
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=inetd&amp;sektion=8&amp;manpath=OpenBSD+3.8"
>inetd(8)</a>, so dass dieser seine Konfigurationsdatei neu einließt.
Ein Weg, das ,HUP'-Signal zu senden, ist, folgendes Kommando einzugeben:
d165 1
a165 1
kill -HUP `cat /var/run/inetd.pid`
d170 7
a176 19
Du wirst bemerken, dass der ftp-proxy auf den Port 8021 hört, dem
gleichen Port, auf den in der vorherigen <tt>rdr</tt>-Angabe der
FTP-Verkehr weitergeleitet wird. Die Wahl von Port 8021 ist willkürlich,
wobei 8021 eine gute Wahl ist, da dieser für keine andere Applikation
definiert wurde.

<p>
Zu diesem Zeitpunkt werden nur passive FTP-Verbindungen funktionieren.
Um aktive Verbindungen ebenfalls zu ermöglichen, muss die ,ftp-data
connection', die der FTP Server aufbaut, zur Firewall durchgelassen
werden.
Leider kann der Port, auf den die Verbindung aufgebaut werden soll,
nicht vorhergesagt werden, nur der Bereich, in dem dieses möglich sein
könnte.
Was jedoch bekannt ist, ist, dass die Verbindung vom Port 20
(ftp-data-Port) aus errichtet wird, und dass der ftp-proxy die Verbindung
akzeptieren wird (und dann die Daten zum Client weiterleitet).
Da der ftp-proxy als Benutzer <tt>proxy</tt> läuft, kann das
<tt>user</tt>-Schlüsselwort in der Filterregel angewandt werden.
d178 4
a181 6
<blockquote>
<tt>
pass in on $ext_if inet proto tcp from port 20 to ($ext_if) \<br>
&nbsp;&nbsp;&nbsp;&nbsp;user proxy flags S/SA keep state
</tt>
</blockquote>
d196 1
a196 1
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=ftpd&amp;sektion=8&amp;manpath=OpenBSD+3.8"
d213 1
a213 1
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=ftpd&amp;sektion=8&amp;manpath=OpenBSD+3.8"
d215 1
a215 1
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=sysctl&amp;sektion=8&amp;manpath=OpenBSD+3.8"
d225 1
a225 1
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=ftpd&amp;sektion=8&amp;manpath=OpenBSD+3.8"
d277 2
a278 2
Originally [OpenBSD: ftp.html,v 1.19 ]<br>
$Translation: ftp.html,v 1.10 2006/04/24 17:44:30 paldium Exp $<br>
@


1.9
log
@sync with steelix translation CVS
@
text
@a5 1
<meta http-equiv="Content-Language" content="de">
d8 1
a8 1
<meta name="description"   content="Die OpenBSD-FAQ-Seite">
d283 2
a284 2
Originally [OpenBSD: ftp.html,v 1.19 ]
$Translation: ftp.html,v 1.9 2005/11/04 11:01:45 paldium Exp $
@


1.8
log
@sync with Steelix CVS
@
text
@d95 1
a95 1
href="http://www.openbsd.org/cgi-bin/man.cgi?query=ftp&amp;sektion=1&amp;manpath=OpenBSD+3.7"
d120 1
a120 1
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=ftp-proxy&amp;sektion=8&amp;manpath=OpenBSD+3.7"
d152 1
a152 1
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=inetd&amp;sektion=8&amp;manpath=OpenBSD+3.7"
d203 1
a203 1
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=ftpd&amp;sektion=8&amp;manpath=OpenBSD+3.7"
d220 1
a220 1
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=ftpd&amp;sektion=8&amp;manpath=OpenBSD+3.7"
d222 1
a222 1
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=sysctl&amp;sektion=8&amp;manpath=OpenBSD+3.7"
d232 1
a232 1
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=ftpd&amp;sektion=8&amp;manpath=OpenBSD+3.7"
d284 2
a285 2
Originally [OpenBSD: ftp.html,v 1.18 ]
$Translation: ftp.html,v 1.8 2005/09/14 16:16:39 paldium Exp $
@


1.7
log
@sync with steelix translation CVS
@
text
@d6 1
a8 1
<meta http-equiv="Content-Language" content="de">
d285 1
a285 1
$Translation: ftp.html,v 1.7 2005/05/20 16:33:52 paldium Exp $
@


1.6
log
@Sync with Steelix CVS
@
text
@d95 1
a95 1
href="http://www.openbsd.org/cgi-bin/man.cgi?query=ftp&amp;sektion=1&amp;manpath=OpenBSD+3.6"
d120 1
a120 1
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=ftp-proxy&amp;sektion=8&amp;manpath=OpenBSD+3.6"
d152 1
a152 1
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=inetd&amp;sektion=8&amp;manpath=OpenBSD+3.6"
d203 1
a203 1
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=ftpd&amp;sektion=8&amp;manpath=OpenBSD+3.6"
d220 1
a220 1
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=ftpd&amp;sektion=8&amp;manpath=OpenBSD+3.6"
d222 1
a222 1
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=sysctl&amp;sektion=8&amp;manpath=OpenBSD+3.6"
d231 2
a232 1
zu halten, nehmen wir an, dass wieder der normale OpenBSD
d284 2
a285 2
Originally [OpenBSD: ftp.html,v 1.17 ]
$Translation: ftp.html,v 1.6 2005/01/18 14:33:46 paldium Exp $
@


1.5
log
@Sync with Steelix CVS
@
text
@d9 1
a9 1
<meta name="description"   content="die OpenBSD-FAQ-Seite">
d282 5
a286 3
Originally [OpenBSD: ftp.html,v 1.17 ]<br>
$Translation: ftp.html,v 1.5 2004/12/22 12:29:53 paldium Exp $<br>
$OpenBSD: ftp.html,v 1.17 2004/12/22 04:28:16 david Exp $
@


1.4
log
@sync with Steelix CVS
@
text
@d36 3
a38 1
<img alt="[OpenBSD]" height=30 width=141 src="../../../images/smalltitle.gif">
d282 4
a285 5
Originally [OpenBSD: ftp.html,v 1.16 ]
<br>
$Translation: ftp.html,v 1.4 2004/12/07 16:56:32 paldium Exp $
<br></small>
<small>$OpenBSD: ftp.html,v 1.16 2004/11/01 21:41:07 nick Exp $</small>
@


1.3
log
@Sync with Steelix CVS, all work by Tobias Stoeckmann
@
text
@d8 2
a9 1
<meta name="description"   content="the OpenBSD FAQ page">
d120 1
a120 1
von <tt>pf.conf</a> etwas, das ähnlich diesem Eintrag ist:
d130 1
a130 1
Dier Erklärung dieser Zeile ist: "Verkehr auf dem internen Interface wird
d276 1
a276 1
<a href="index.html"><img height="24" width="24" src="../../images/back.gif" border="0" alt="[back]"></a> 
d282 1
a282 1
$Translation: ftp.html,v 1.3 2004/12/01 21:05:44 paldium Exp $
@


1.2
log
@Sync with Steelix CVS
@
text
@d35 1
a35 1
<img alt="[OpenBSD]" height=30 width=141 src="../../images/smalltitle.gif">
d48 4
a51 4
<li><a href="#modes">FTP Modi</a>
<li><a href="#client">FTP Client hinter der Firewall</a>
<li><a href="#server">Ein FTP Server, der "sich selbst mit PF schützt"</a>
<li><a href="#natserver">FTP Server, die durch eine externe PF Firewall
d59 2
a60 2
<h2>FTP Modi</h2>
FTP ist ein Protokoll, das zu der Zeit zurückreicht, als das Internet
d74 1
a74 1
Bei aktivem FTP wird der FTP Server eine neue Verbindung zurück zum Client
d76 1
a76 1
zu einem entfernten FTP Server verbindet und eine Information oder Datei
d78 1
a78 1
entscheidet der FTP Client sich für einen zufälligen Port, auf dem die
d80 2
a81 2
gewählte Portnummer zum FTP Server und lauscht auf diesem für eine
eingehende Verbindung. Der FTP Server erstellt dann eine Verbindung zur
d83 5
a87 5
Problem für Benutzer, die auf einen FTP Server zugreifen wollen, wenn sie
selbst hinter einem NAT Gateway liegen. Wegen der Funktionsweise von NAT
wird der FTP Server eine ,data connection' zur externen Adresse des NAT
Gateways auf dem gewählten Port aufbauen. Die NAT Maschine wird diese
Verbindung erhalten, aber da sie nicht in der ,state' Tabelle aufgelistet
d91 1
a91 1
Beim passiven FTP Modus (dem standardmäßigem Modus mit OpenBSDs <a
d93 1
a93 1
>ftp(1)</a> Client) wird der Client vom Server verlangen, dass dieser
d99 1
a99 1
vor dem FTP Server die eingehende ,data connection' blockt. OpenBSDs
d101 3
a103 3
zu erzwingen, verwende die -A Option mit ftp oder setze den passiven
Modus "off" (aus), indem du das Kommando "<tt>passive off</tt>" am
"<tt>ftp&gt;</tt>" Prompt eingibst.
d106 1
a106 1
<h2>FTP Client hinter der Firewall</h2>
d112 4
a115 4
Packet Filter bietet eine Lösung für dieses Problem, indem der FTP
Verkehr durch einen FTP Proxy Server hindurch geleitet wird. Dieser
Prozess "leitet" deinen FTP Verkehr durch das NAT Gateway/durch die
NAT Firewall. Der FTP Proxy, der von OpenBSD und PF verwendet wird,
d118 1
a118 1
>ftp-proxy(8)</a>. Um ihn zu aktivieren, erstelle in der NAT Sektion
d130 1
a130 1
zum Proxy Server weitergeleitet, der auf dieser Maschine läuft und auf
d134 2
a135 2
Hoffentlich ist es offensichtlich, dass der Proxy Server auf dem OpenBSD
Rechner gestartet werden muss und auch läuft. Dies wird durch das
d146 3
a148 3
Bedenke, dass die <tt>-n</tt> Option nur notwendig ist, wenn die
OpenBSD Maschine als NAT arbeitet.
Sende jetzt ein 'HUP' Signal zum
d151 1
a151 1
Ein Weg, das 'HUP' Signal zu senden, ist, folgendes Kommando einzugeben:
d161 2
a162 2
gleichen Port, auf den in der vorherigen <tt>rdr</tt> Angabe der
FTP Verkehr weitergeleitet wird. Die Wahl von Port 8021 ist willkürlich,
d167 1
a167 1
Zu diesem Zeitpunkt werden nur passive FTP Verbindungen funktionieren.
d172 1
a172 1
vorhergesagt werden, nur der Bereich, in dem dieses möglich sein
d174 2
a175 2
Was jedoch bekannt ist, ist, dass die Verbindung vom Port 20 (ftp-data
Port) aus errichtet wird, und dass der ftp-proxy die Verbindung
d177 2
a178 2
Da der ftp-proxy als Benutzer <tt>proxy</tt> läuft, kann as
<tt>user</tt> Schlüsselwort in der Filter-Regel angewandt werden.
d188 3
a190 3
Bedenke bitte, dass der ftp-proxy(8) dazu da ist, den <b>FTP clients</b>
hinter einem PF Filter zu helfen; er kann keinen <b>FTP Server</b> hinter
einem PF Filter handhaben.
d194 4
a197 4
<h2>Ein FTP Server, der "sich selbst mit PF schützt"</h2>
In diesem Fall läuft PF direkt auf dem FTP Server, statt auf einem
extra dafür installiertem Firewall Computer. Wenn eine passive FTP
Verbindung angeboten wird, wird FTP zufällig einen hohen TCP Port
d199 1
a199 1
FTP server
d203 2
a204 2
Diese müssen selbstverständlich durch die Filter-Regeln gelassen werden,
zusätzlich zum Port 21 (dem FTP Kontroll-Port):
d218 1
a218 1
>ftpd(8)</a> Programm wird dies durch die Verwendung von den
d220 1
a220 1
>sysctl(8)</a> Variablen <tt>net.inet.ip.porthifirst</tt> und
d224 1
a224 1
<h2>FTP Server, die durch eine externe PF Firewall beschützt werden,
d226 1
a226 1
In diesem Fall muss die Firewall den Verkehr zum FTP Server zusätzlich
d233 1
a233 1
Hier ist ein Beispiel Unterregelsatz, der dies realisieren würde:
d260 1
a260 1
Weitere Informationen zum Thema FTP Filtern und wie FTP generell
d281 1
a281 1
$Translation: ftp.html,v 1.2 2004/11/28 14:03:02 paldium Exp $
@


1.1
log
@Sync with Steelix CVS
@
text
@d4 1
a4 1
<title>PF: Issues with FTP</title>
a10 1
<meta name="copyright"     content="This document copyright 2002-2003 by OpenBSD.">
d13 18
d35 1
a35 1
<img alt="[OpenBSD]" height=30 width=141 src="../../../images/smalltitle.gif">
d37 3
a39 3
[<a href="perf.html">Previous: Performance</a>]
[<a href="index.html">Contents</a>]
[<a href="authpf.html">Next: Authpf: User Shell for Authenticating
d43 1
a43 1
<h1><font color="#e00000">PF: Issues with FTP</font></h1>
d46 1
a46 1
<h3>Table of Contents</h3>
d48 6
a53 6
<li><a href="#modes">FTP Modes</a>
<li><a href="#client">FTP Client Behind the Firewall</a>
<li><a href="#server">PF "Self-Protecting" an FTP Server</a>
<li><a href="#natserver">FTP Server Protected by an External PF Firewall
Running NAT</a>
<li><a href="#info">More Information on FTP</a>
d59 45
a103 42
<h2>FTP Modes</h2>
FTP is a protocol that dates back to when the Internet was a small,
friendly collection of computers and everyone knew everyone else. At
that time the need for filtering or tight security wasn't necessary.
FTP wasn't designed for filtering, for passing through firewalls, or for
working with NAT.

<p>
You can use FTP in one of two ways: passive or active.  Generally, the
choice of active or passive is made to determine who has the problem
with firewalling.  Realistically, you will have to support both to have
happy users.

<p>
With active FTP, when a user connects to a remote FTP server and
requests information or a file, the FTP server makes a new
connection back to the client to transfer the requested data. This is
called the <i>data connection</i>.  To start, the FTP client chooses a
random port to receive the data connection on. The client sends the port
number it chose to the FTP server and then listens for an incoming
connection on that port.  The FTP server then initiates a connection to
the client's address at the chosen port and transfers the data.  This is a
problem for users attempting to gain access to FTP servers from behind a
NAT gateway.  Because of how NAT works, the FTP server initiates the data
connection by connecting to the external address of the NAT gateway on
the chosen port.  The NAT machine will receive this, but because it has
no mapping for the packet in its state table, it will drop the packet and
won't deliver it to the client.

<p>
With passive mode FTP (the default mode with OpenBSD's <a
href="http://www.openbsd.org/cgi-bin/man.cgi?query=ftp&amp;sektion=1&amp;manpath=OpenBSD+3.4"
>ftp(1)</a> client), the client requests that the server pick a random
port to listen on for the data connection. The server informs the client
of the port it has chosen, and the client connects to this port to
transfer the data. Unfortunately, this is not always possible or
desirable because of the possibility of a firewall in front of the FTP
server blocking the incoming data connection. OpenBSD's ftp(1) uses
passive mode by default; to force active mode FTP, use the -A flag to
ftp, or set passive mode to "off" by issuing the command "<tt>passive
off</tt>"  at the "<tt>ftp&gt;</tt>" prompt.

d106 3
a108 2
<h2>FTP Client Behind the Firewall</h2>
As indicated earlier, FTP does not go through NAT and firewalls very well.
d112 8
a119 7
Packet Filter provides a solution for this situation by redirecting FTP
traffic through an FTP proxy server. This process acts to "guide" your
FTP traffic through the NAT gateway/firewall.  The FTP proxy used by
OpenBSD and PF is
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=ftp-proxy&amp;sektion=8&amp;manpath=OpenBSD+3.4"
>ftp-proxy(8)</a>.  To activate it, put something like this in the NAT section
of <tt>/etc/pf.conf</tt>:
d129 3
a131 3
The explanation of this line is: "Traffic on the internal interface is
redirected to the proxy server running on this machine which is
listening at port 8021".
d134 3
a136 3
Hopefully it is apparent the proxy server has to be started and running on
the OpenBSD box. This is done by inserting the following line in
<tt>/etc/inetd.conf</tt>:
d141 1
a141 1
&nbsp;&nbsp;&nbsp;ftp-proxy
d146 6
a151 3
and either rebooting the system or sending a 'HUP' signal to
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=inetd&amp;sektion=8&amp;manpath=OpenBSD+3.4"
>inetd(8)</a>.  One way to send the 'HUP' signal is with the command:
d160 26
a185 4
You will note that ftp-proxy is listening on port 8021, the same port
the above <tt>rdr</tt> statement is sending FTP traffic to.  The choice
of port 8021 is arbitrary, though 8021 is a good choice as it is not
defined for any other application.
d188 3
a190 2
Please note that ftp-proxy(8) is to help <b>FTP clients</b> behind a PF filter;
it is not used to handle an <b>FTP server</b> behind a PF filter.
d194 11
a204 9
<h2>PF "Self-Protecting" an FTP Server</h2>
In this case, PF is running on the FTP server itself rather than a
dedicated firewall computer.  When servicing a passive FTP connection,
FTP will use a randomly chosen, high TCP port for incoming data.  By
default, OpenBSD's native FTP server 
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=ftpd&amp;sektion=8&amp;manpath=OpenBSD+3.4"
>ftpd(8)</a> uses the range 49152 to 65535.
Obviously, these must be passed through the filter rules, along with
port 21 (the FTP control port):
d215 7
a221 7
Note that if you desire, you can tighten up that range of ports
considerably. In the case of the OpenBSD 
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=ftpd&amp;sektion=8&amp;manpath=OpenBSD+3.4"
>ftpd(8)</a> program, that is done using the 
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=sysctl&amp;sektion=8&amp;manpath=OpenBSD+3.4"
>sysctl(8)</a> variables <tt>net.inet.ip.porthifirst</tt> and
<tt>net.inet.ip.porthilast</tt>.
d224 7
a230 6
<h2>FTP Server Protected by an External PF Firewall Running NAT</h2>
In this case, the firewall must redirect traffic to the FTP server in
addition to not blocking the required ports.  For the sake of discussion,
we will assume the FTP server in question is again the standard OpenBSD
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=ftpd&amp;sektion=8&amp;manpath=OpenBSD+3.4"
>ftpd(8)</a>, using the default range of ports.
d233 1
a233 1
Here is an example subset of rules which would accomplish this:
d243 1
d247 6
d259 3
a261 3
<h2>More Information on FTP</h2>
More information on filtering FTP and how FTP works in general can be
found in this whitepaper:
d268 3
a270 3
[<a href="perf.html">Previous: Performance</a>]
[<a href="index.html">Contents</a>]
[<a href="authpf.html">Next: Authpf: User Shell for Authenticating
d275 1
a275 1
<a href="../../de/index.html"><img height="24" width="24" src="../../../images/back.gif" border="0" alt="[back]"></a> 
d279 5
a283 4
Originally [OpenBSD: ftp.html,v 1.9 ]<br>
$Translation: ftp.html,v 1.1 2003/11/27 17:34:57 sl Exp $<br>
$OpenBSD$
</small>
@

