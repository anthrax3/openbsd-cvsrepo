head	1.35;
access;
symbols;
locks; strict;
comment	@# @;


1.35
date	2014.04.01.17.18.45;	author nick;	state dead;
branches;
next	1.34;

1.34
date	2013.11.01.18.04.05;	author ajacoutot;	state Exp;
branches;
next	1.33;

1.33
date	2013.05.01.17.39.07;	author ajacoutot;	state Exp;
branches;
next	1.32;

1.32
date	2013.05.01.14.42.14;	author ajacoutot;	state Exp;
branches;
next	1.31;

1.31
date	2012.12.21.10.33.10;	author ajacoutot;	state Exp;
branches;
next	1.30;

1.30
date	2012.11.02.07.24.05;	author ajacoutot;	state Exp;
branches;
next	1.29;

1.29
date	2012.05.13.16.30.18;	author ajacoutot;	state Exp;
branches;
next	1.28;

1.28
date	2012.02.07.07.42.45;	author ajacoutot;	state Exp;
branches;
next	1.27;

1.27
date	2012.01.17.11.13.00;	author ajacoutot;	state Exp;
branches;
next	1.26;

1.26
date	2010.02.24.07.21.25;	author ajacoutot;	state Exp;
branches;
next	1.25;

1.25
date	2009.11.07.07.32.54;	author ajacoutot;	state Exp;
branches;
next	1.24;

1.24
date	2009.05.26.21.30.39;	author ajacoutot;	state Exp;
branches;
next	1.23;

1.23
date	2009.05.04.19.07.52;	author tobias;	state Exp;
branches;
next	1.22;

1.22
date	2008.11.26.08.25.03;	author tobias;	state Exp;
branches;
next	1.21;

1.21
date	2008.11.01.11.02.22;	author tobias;	state Exp;
branches;
next	1.20;

1.20
date	2008.08.10.16.14.28;	author tobias;	state Exp;
branches;
next	1.19;

1.19
date	2008.03.09.13.37.13;	author tobias;	state Exp;
branches;
next	1.18;

1.18
date	2007.11.12.20.29.59;	author saad;	state Exp;
branches;
next	1.17;

1.17
date	2007.06.23.18.29.30;	author jufi;	state Exp;
branches;
next	1.16;

1.16
date	2007.05.09.05.49.52;	author jufi;	state Exp;
branches;
next	1.15;

1.15
date	2007.04.26.03.08.05;	author jufi;	state Exp;
branches;
next	1.14;

1.14
date	2007.02.21.10.27.59;	author jufi;	state Exp;
branches;
next	1.13;

1.13
date	2007.02.10.05.22.16;	author saad;	state Exp;
branches;
next	1.12;

1.12
date	2006.11.01.11.30.45;	author jufi;	state Exp;
branches;
next	1.11;

1.11
date	2006.10.29.10.58.52;	author jufi;	state Exp;
branches;
next	1.10;

1.10
date	2006.08.08.07.14.20;	author saad;	state Exp;
branches;
next	1.9;

1.9
date	2006.05.01.12.19.17;	author jufi;	state Exp;
branches;
next	1.8;

1.8
date	2006.04.25.08.25.49;	author saad;	state Exp;
branches;
next	1.7;

1.7
date	2006.01.14.11.36.00;	author jufi;	state Exp;
branches;
next	1.6;

1.6
date	2005.11.25.00.26.23;	author saad;	state Exp;
branches;
next	1.5;

1.5
date	2005.11.12.15.54.54;	author jufi;	state Exp;
branches;
next	1.4;

1.4
date	2005.11.04.20.24.23;	author jufi;	state Exp;
branches;
next	1.3;

1.3
date	2005.09.28.19.46.33;	author saad;	state Exp;
branches;
next	1.2;

1.2
date	2005.08.07.08.54.38;	author saad;	state Exp;
branches;
next	1.1;

1.1
date	2005.08.04.21.13.19;	author saad;	state Exp;
branches;
next	;


desc
@@


1.35
log
@
missed another one...
@
text
@<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<html>
<head>
<title>PF: Firewall-Redundanz mit CARP und pfsync</title>
<link rev="made" href="mailto:www@@openbsd.org">
<meta http-equiv="Content-Type" content="text/html; charset=ISO-8859-1">
<meta name="resource-type" content="document">
<meta name="description"   content="the OpenBSD FAQ page">
<meta name="keywords"      content="openbsd,faq,pf,carp,pfsync">
<meta name="distribution"  content="global">
</head>

<!--
Copyright (c) 2005-2007 Joel Knight <enabled@@myrealbox.com>

Permission to use, copy, modify, and distribute this documentation for
any purpose with or without fee is hereby granted, provided that the
above copyright notice and this permission notice appear in all copies.

THE DOCUMENTATION IS PROVIDED "AS IS" AND THE AUTHOR DISCLAIMS ALL
WARRANTIES WITH REGARD TO THIS DOCUMENTATION INCLUDING ALL IMPLIED
WARRANTIES OF MERCHANTABILITY AND FITNESS. IN NO EVENT SHALL THE
AUTHOR BE LIABLE FOR ANY SPECIAL, DIRECT, INDIRECT, OR CONSEQUENTIAL
DAMAGES OR ANY DAMAGES WHATSOEVER RESULTING FROM LOSS OF USE, DATA OR
PROFITS, WHETHER IN AN ACTION OF CONTRACT, NEGLIGENCE OR OTHER
TORTIOUS ACTION, ARISING OUT OF OR IN CONNECTION WITH THE USE OR
PERFORMANCE OF THIS DOCUMENTATION
-->

<body bgcolor="#ffffff" text="#000000">
<!-- Passes validator.w3.org, please keep it this way;
please, use a max of 72 chars per line -->

<a href="../../../de/index.html">
<img alt="[OpenBSD]" height=30 width=141 src="../../../images/smalltitle.gif" border="0">
</a>
<p>
[<a href="authpf.html">Zurück: Authpf: Benutzer-Shell für
authentifizierende Gateways</a>]
[<a href="index.html">Inhalt</a>]
[<a href="example1.html">Weiter: Firewall für zuhause oder ein kleines
Büro</a>]

<p>
<h1><font color="#e00000">PF: Firewallredundanz mit CARP und pfsync</font></h1>

<hr>

<h3>Inhaltsverzeichnis</h3>
<ul>
<li><a href="#carpintro">Einführung in CARP</a>
<li><a href="#carpop">Funktionsweise von CARP</a>
<li><a href="#carpconfig">Konfiguration von CARP</a>
<li><a href="#carpex">CARP-Beispiel</a>
<li><a href="#pfsyncintro">Einführung in pfsync</a>
<li><a href="#pfsyncop">Funktionsweise von pfsync</a>
<li><a href="#pfsyncconfig">Konfiguration von pfsync</a>

<li><a href="#pfsyncex">pfsync-Beispiel</a>
<li><a href="#failover">Kombinieren von CARP und pfsync für
Ausfallsicherheit und Redundanz</a>
<li><a href="#ops">Weitere technische Möglichkeiten</a>
	<ul>
	<li><a href="#bootconfig">CARP und pfsync während des
	Bootvorgangs konfigurieren</a>
	<li><a href="#forcefail">Ausfallsicherheit vom Masterhost
	testen</a>
	<li><a href="#RulesetTips">Tipps für Regelsätze</a>
	</ul>
<li><a href="#ref">Weitere Referenzen</a>

</ul>

<hr>

<a name="carpintro"></a>
<h2>Einführung in CARP</h2>
CARP ist das »Common Address Redundancy«-Protokoll. Sein Hauptzweck
ist es, mehreren Hosts in einem gleichen Netzwerksegment zu ermöglichen,
eine IP-Adresse zu teilen. CARP ist eine sichere und freie
Alternative zum <a href="http://www.ietf.org/rfc/rfc3768.txt">»Virtual
Router Redundancy«-Protokoll</a> (VRRP) und zum
<a href="http://www.ietf.org/rfc/rfc2281.txt">»Hot Standby
Router«-Protokoll</a> (HSRP).

<p>
CARP funktioniert, indem es einer Gruppe mehreren Hosts in einem gleichen
Netzwerksegment ermöglicht, sich eine IP-Adresse zu teilen. Eine solche
Gruppe wird als Redundanzgruppe bezeichnet (im Folgenden nur Gruppe
genannt). Dieser Gruppe ist eine IP-Adresse zugeteilt, die
sich die Gruppenmitglieder untereinander teilen. Innerhalb der Gruppe
arbeitet ein Host als Master, die restlichen Hosts in der Gruppe als
Backup. Der Masterhost hält die zugewiesene IP-Adresse; er reagiert
auf den gesamten Netzwerkverkehr und auf ARP-Anfragen, die an ihn bzw.
an die ihm zugewiesene IP gerichtet sind. Jeder Host kann einer oder
mehreren Gruppen zugeteilt sein.

<p>
In der Praxis wird CARP häufig dazu genutzt, eine Gruppe von redundanten
Firewalls zu erstellen. Die virtuelle IP, die der Gruppe zugeteilt ist,
wird bei den Netzwerkclients als das standardmäßige Gateway
konfiguriert. Sollte nun der Masterhost der Gruppe ausfallen, so wird
einer der Backuphosts in der Gruppe seine Funktion übernehmen.

<p>
CARP unterstützt IPv4 und IPv6.


<a name="carpop"></a>
<h2>Funktionsweise von CARP</h2>
Der Masterhost sendet in regelmäßigen Zeitintervallen Nachrichten an das
lokale Netzwerk, um den Backuphosts mitzuteilen, dass er im Betrieb
ist. Wenn die Backuphosts nach einer festgelegten Zeitspanne keine
dieser Nachrichten registrieren, wird einer der Backuphosts an dessen
Stelle treten und dessen Dienst übernehmen. Der Backuphost, der die
niedrigsten Werten für <tt>advbase</tt> und <tt>advskew</tt> hat,
wird die Aufgabe übernehmen.

<p>
Es ist möglich, mehrere CARP-Gruppen in einem gleichen Netzwerksegment
einzurichten. Die CARP-Nachrichten beinhalten eine »Virtual Host ID«,
welche es den Hosts ermöglicht, zwischen den verschiedenen Gruppen zu
unterscheiden.

<p>
Um eine Gruppe vor gefälschten CARP-Nachrichten zu schützen, ist es
möglich, jede dieser Gruppen mit Passwortschutz zu versehen. Jedes
gesendete Paket ist durch einen SHA1-HMAC geschützt.

<p>
CARP ist ein eigenständiges Protokoll, sodass extra definierte
pass-Regeln im Regelsatz verwendet werden sollten.

<blockquote>
<tt>
pass out on $carp_dev proto carp keep state
</tt>
</blockquote>

<p>
<tt>$carp_dev</tt> sollte das physikalische Interface sein, über welches
CARP kommuniziert.


<a name="carpconfig"></a>
<h2>Konfiguration von CARP</h2>
Jede Gruppe wird durch ein virtuelles
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=carp&amp;sektion=4&amp;manpath=OpenBSD+5.4"
>carp(4)</a>-Netzwerkinterface dargestellt. Als solches wird es auch
mit
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=ifconfig&amp;sektion=8"
>ifconfig(8)</a> konfiguriert.

<blockquote>
<tt>
ifconfig <i>carpN</i> create<br>
<br>
ifconfig <i>carpN</i> vhid <i>vhid</i> [pass <i>password</i>]
[carpdev <i>carpdev</i>] \<br>
&nbsp;&nbsp;&nbsp;[advbase <i>advbase</i>] [advskew <i>advskew</i>]
[state <i>state</i>] [group|-group <i>group</i>] \<br>
&nbsp;&nbsp;&nbsp;<i>ipaddress</i> netmask <i>mask</i>
</tt>
</blockquote>
<!-- XXX someone who understands carpnodes should add a piece -->

<dl>
<dt><tt><i>carpN</i></tt>

<dd>Der Name des virtuellen carp(4)-Interfaces, wobei <i>N</i> die
Interface-Nummer ist (z.&nbsp;B. carp10).

<dt><tt><i>vhid</i></tt>
<dd>Die »Virtual Host ID«.
Eine eindeutige Nummer, die zur Identifizierung einer Redundanzgruppe innerhalb
eines Netzwerks, und zur Unterscheidung von Gruppen als solche genutzt wird.
Gültige Werte sind 1 bis 255.
Der Wert muss für alle Mitglieder einer Gruppe identisch sein.

<dt><tt><i>password</i></tt>
<dd>Das Passwort, welches die Mitglieder einer Gruppe nutzen, um sich
untereinander zu authentifizieren. Alle Hosts in einer Gruppe müssen das
gleiche Passwort benutzen.

<dt><tt><i>carpdev</i></tt>
<dd>Dieser Parameter ist optional. Er gibt das physikalische Interface
an, welches dem Netzwerksegment zugeordnet ist, in dem sich die Gruppe
befindet. Standardmäßig versucht CARP, das richtige Interface selbst zu
finden. Dabei sucht es anhand der Kombination aus Netzwerkmaske
(<i>mask</i>) und IP-Adresse (<i>ipaddress</i>) nach dem Interface, das
in dem gleichen Subnetz ist wie das carp(4)-Interface.

<dt><tt><i>advbase</i></tt>
<dd>Dieser Parameter ist optional. Er gibt an, in welchen
Zeitintervallen der Host Nachrichten an die Gruppe senden soll, die
signalisieren, dass der Host ein Mitglied der Gruppe ist. Gültige Werte
sind 1 bis 255. Der Standardwert ist 1.

<dt><tt><i>advskew</i></tt>
<dd>Dieser optionale Parameter gibt an, wie sehr <tt><i>advbase</i></tt>
gestreckt werden soll, wenn CARP-Advertisements gesendet werden. Durch
die Einstellung von <tt><i>advskew</i></tt> kann der Master-CARP-Host
festgelegt werden. Je höher der Wert ist, desto <i>geringer</i> ist
seine Berechtigung, die Rolle vom Masterhost einzunehmen. Gültige
Werte sind 0 bis 254. Der Standardwert ist 0.

<dt><tt><i>state</i></tt>
<dd>Zwingt das carp(4)-Interface dazu, einen bestimmten Status
anzunehmen. Gültige Werte sind <tt>init</tt>, <tt>backup</tt> und
<tt>master</tt>.

<dt><tt><i>group</i>, <i>-group</i></tt>
<dd>Fügt eine carp(4)-Schnittstelle zu einer bestimmten Schnittstellengruppe
hinzu, oder entfernt sie von dort.
Standardmäßig werden alle carp(4)-Schnittstellen zu der Gruppe <tt>carp</tt>
hinzugefügt.
Jede Gruppe besitzt einen <tt>carpdemote</tt>-Zähler, der alle
carp(4)-Schnittstellen beeinflusst, die zu dieser Schnittstelle gehören.
Wie <a href="#demote">unten</a> beschrieben wird, kann es nützlich sein,
bestimmte Schnittstellen zum Zwecke der Ausfallsicherung zu Gruppen
zusammenzufassen.

<dt><tt><i>ipaddress</i></tt>
<dd>Dies ist die IP-Adresse, die der Gruppe zugewiesen wird. Diese
Adresse muss nicht im selben Subnetz sein wie die IP-Adresse, die dem
physikalischen Interface zugeordnet ist (sofern vorhanden). Die
Adresse muss jedem Host in der Gruppe zugewiesen sein.

<dt><tt><i>mask</i></tt>
<dd>Die Subnetzmaske der gemeinsam genutzten IP.
</dl>

<p>
Weiterhin kann das Verhalten von CARP via
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=sysctl&amp;sektion=8"
>sysctl(8)</a> manipuliert werden.

<dl>
<dt><tt>net.inet.carp.allow</tt>
<dd>Akzeptiert eingehende CARP-Pakete - oder nicht. Standardwert ist 1
(akzeptiert).

<dt><tt>net.inet.carp.preempt</tt>
<dd>Erlaubt Hosts innerhalb einer Redundanz-Gruppe, die einen besseren
<tt>advbase</tt>- und <tt>advskew</tt>-Wert haben, zum Masterhost zu
werden.
Zusätzlich erlaubt diese Option das Herunterfahren einer Schnittstellengruppe
als Ganzes in dem Fall, dass eine ihrer Schnittstellen ausfällt.
Fällt eine physikalisch vorhandene Schnittstelle mit aktiviertem CARP aus,
so wird der Degradierungszähler, <tt>carpdemote</tt>, um eins (1) bei all
jenen Schnittstellengruppen erhöht, denen die carp(4)-Schnittstelle angehört,
was effektiv zu einem Ausfall aller Gruppenmitglieder führt.
<tt>net.inet.carp.preempt</tt> ist standardmäßig 0 (deaktiviert).

<dt><tt>net.inet.carp.log</tt>
<dd>Protokolliere Status-Änderungen, fehlerhafte Pakete und andere Fehler.
Kann einen Wert zwischen null (0) und sieben (7) haben, entsprechend der
syslog(3)-Prioritäten.
Der Standard ist zwei (2; nur Status-Änderungen).
</dl>

<a name="carpex"></a>
<h2>CARP-Beispiel</h2>
Es folgt eine Beispielkonfiguration für CARP.

<blockquote>
<tt>
# sysctl -w net.inet.carp.allow=1<br>
# ifconfig carp1 create<br>
# ifconfig carp1 vhid 1 pass mekmitasdigoat carpdev em0 \<br>
&nbsp;&nbsp;&nbsp;&nbsp;advskew 100 10.0.0.1 netmask 255.255.255.0<br>
</tt>
</blockquote>

<p>
Das bewirkt Folgendes:
<ul>
<li>Schaltet den Empfang von CARP-Paketen ein (dies ist die
Standardeinstellung).
<li>Erzeugt ein carp(4)-Interface: <tt>carp1</tt>.
<li>Konfiguriert <tt>carp1</tt> für den virtuellen Host Nr. 1, setzt ein
Passwort und konfiguriert das Interface <tt>em0</tt> als jenes, das zur
Gruppe gehört. Dazu wird der Host durch Setzen von <tt>advskew</tt> auf
<tt>100</tt> als Backuphost konfiguriert (natürlich nur, wenn der
Master einen kleineren Wert als 100 bei <tt>advskew</tt> besitzt). Die
virtuelle IP, die der Gruppe zugewiesen ist, ist 10.0.0.1. Die
Subnetzmaske ist 255.255.255.0.
</ul>

<p>
Ein Aufruf von <tt>ifconfig</tt> für <tt>carp1</tt> zeigt den
Status des Interfaces an.

<blockquote>
<tt>
# ifconfig carp1<br>
carp1: flags=8802&lt;UP,BROADCAST,SIMPLEX,MULTICAST&gt; mtu 1500<br>

&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;carp: BACKUP carpdev em0 vhid 1 advbase 1
advskew 100<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;groups: carp<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;inet 10.0.0.1 netmask 0xffffff00
broadcast 10.0.0.255
</tt>
</blockquote>


<a name="pfsyncintro"></a>
<h2>Einführung in pfsync</h2>
Das
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=pfsync&amp;sektion=4&amp;manpath=OpenBSD+5.4"
>pfsync(4)</a>-Netzwerkinterface zeigt bestimmte Änderungen des
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=pf&amp;sektion=4&amp;manpath=OpenBSD+5.4"
>pf(4)</a>-Zustands (seiner Tabellen) an.

Durch die Nutzung von
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=tcpdump&amp;sektion=8"
>tcpdump(8)</a> können diese Änderungen in Echtzeit überwacht werden.
Zusätzlich kann das pfsync(4)-Interface diese Änderungen an andere
Hosts im Netzwerk senden, sodass diese den Zustand ihrer Tabellen
entsprechend angleichen können. Ebenso kann pfsync(4) auf solche
Nachrichten aus dem Netzwerk warten und diese lesen.

<a name="pfsyncop"></a>
<h2>Funktionsweise von pfsync</h2>
Standardmäßig sendet oder empfängt pfsync(4) keine derartigen Meldungen
über das Netzwerk. Dennoch können die Updates mittels tcpdump(8) oder
anderen Programmen mitverfolgt werden.

<p>
Wenn pfsync(4) so konfiguriert ist, diese Nachrichten über das Netzwerk
zu senden und zu empfangen, werden die Nachrichten an alle Teilnehmer
der Gruppe versendet. All diese Updateinformationen werden jedoch ohne
Authentifizierung versendet. Um hier für Sicherheit zu sorgen, gibt es
zwei bewährte Verfahren:

<ol>
<li>Verbinde die zwei Maschinen, die ihre Updates untereinander
austauschen sollen, mit einem Crossover-Kabel und konfiguriere das
Interface als <tt>syncdev</tt> (siehe <a href="#pfsyncconfig">hier</a>).
<li>Benutze die ifconfig(8)-Option <tt>syncpeer</tt> (siehe <a
href="#pfsyncconfig">unten</a>), um eine Unicastverbindung über das
Netzwerk zwischen den Maschinen aufzubauen, über die sie die Nachrichten
austauschen können. Danach konfiguriere
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=ipsec&amp;sektion=4"
>ipsec(4)</a>, um die Verbindung abzusichern.
</ol>

<p>
Wenn die Updates über das Netzwerk gesendet und empfangen werden,
sollten diese pfsync-Pakete auch im Regelsatz so berücksichtigt werden,
dass sie auch ihr Ziel erreichen können.

<blockquote>
<tt>
pass on $sync_if proto pfsync
</tt>
</blockquote>

<p>
<tt>$sync_if</tt> sollte das physikalische Interface sein, über das
pfsync(4) kommuniziert.


<a name="pfsyncconfig"></a>
<h2>Konfiguration von pfsync</h2>
Da pfsync(4) als virtuelles Netzwerkinterface arbeitet, wird es mit
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=ifconfig&amp;sektion=8"
>ifconfig(8)</a> konfiguriert.

<blockquote>
<tt>
ifconfig <i>pfsyncN</i> syncdev <i>syncdev</i> [syncpeer
<i>syncpeer</i>] [defer|-defer]
</tt>
</blockquote>

<dl>
<dt><tt><i>pfsyncN</i></tt>
<dd>Der Name des pfsync(4)-Interfaces. <tt>pfsync0</tt> ist
standardmäßig benutzbar, wenn der generische Kernel
<tt>(GENERIC)</tt> verwendet wird.

<dt><tt><i>syncdev</i></tt>
<dd>Der Name des physikalischen Interfaces, worüber pfsync die Updates
versendet.

<dt><tt><i>syncpeer</i></tt>
<dd>Dieser Parameter ist optional. Er gibt den Host an, an den Updates
als Unicastnachrichten versendet werden sollen. Standardmäßig werden
die Updatenachrichten als Multicastnachricht an die Gruppe im lokalen
Netzwerk gesendet. Diese Option überschreibt das Verhalten und sendet
stattdessen das Update per Unicastnachricht an den angegebenen
<tt><i>syncpeer</i></tt>.

<dt><tt><i>defer</i></tt>
<dd>Wenn der Schalter <tt>defer</tt> benutzt wird, so wird das erste Paket
einer neuen Verbindung, die die Firewall passiert, nicht transmittiert bevor
entweder ein anderes pfsync(4)-System die Statustabellen-Ergänzung anerkannt
hat, oder ein Zeitlimit abgelaufen ist.
Dies verursacht kleine Verzögerungen, erlaubt aber den Fluss des Traffic, wenn
mehr als eine Firewall aktiv Pakete bearbeiten könnte (»active/active«),
zum Beispiel mit bestimmten ospfd(8)-, bgpd(8)- oder carp(4)-Konfigurationen.
</dl>


<a name="pfsyncex"></a>
<h2>pfsync-Beispiel</h2>
Es folgt eine pfsync-Beispielkonfiguration.

<blockquote>
<tt>
# ifconfig pfsync0 syncdev em1 up<br>
</tt>
</blockquote>

Dies aktiviert pfsync auf dem <tt>em1</tt>-Interface. Ausgehender
Verkehr wird via Multicast in das Netzwerk gesendet. Jeder Host mit
aktiviertem pfsync kann die Updates empfangen.

<a name="failover"></a>
<h2>Kombinieren von CARP und pfsync für Ausfallsicherheit und
Redundanz</h2>
Durch die Kombination der Fähigkeiten von CARP und pfsync lässt sich
eine Gruppe von zwei oder mehr Hosts zu einem Firewallcluster mit hoher
Verfügbarkeit und Redundanz erstellen.
<dl>
<dt>CARP:
<dd>Regelt automatisch die Ausfallsicherheit, indem ein anderer Host
seine Aufgabe bei einem Ausfall übernimmt.

<dt>pfsync:
<dd>Synchronisiert die Statustabellen zwischen allen Firewalls in einer
Gruppe. Wenn eine Firewall ausfallen sollte, kann der Netzwerkverkehr
ohne Unterbrechung über den neuen Firewallhost laufen. Der neue
Firewallhost hat stets eine aktuelle Statustabelle und kann sofort
seine Arbeit verrichten.
</dl>

<p>
Ein Beispielszenario. Zwei Firewalls: <tt>fw1</tt> und <tt>fw2</tt>.

<pre>
         +------| WAN/Internet |------+
         |                            |
      em2|                            |em2
      +-----+                      +-----+
      | fw1 |-em1--------------em1-| fw2 |
      +-----+                      +-----+
      em0|                            |em0
         |                            |
      ---+--gemeinsam genutztes LAN---+---

</pre>

<p>
Die Firewalls sind über ein Crossover-Kabel miteinander über
<tt>em1</tt> verbunden. Beide sind an das LAN mit <tt>em0</tt> und an
das WAN (bzw. Internet) an <tt>em2</tt> angeschlossen.

Die IP-Adressen wurden folgendermaßen vergeben:

<ul>
<li>fw1 em0: 172.16.0.1
<li>fw1 em1: 10.10.10.1

<li>fw1 em2: 192.0.2.1
<li>fw2 em0: 172.16.0.2
<li>fw2 em1: 10.10.10.2
<li>fw2 em2: 192.0.2.2
<li>LAN shared IP: 172.16.0.100
<li>WAN/Internet shared IP: 192.0.2.100
</ul>

<p>

Als Firewall-Masterhost wird <tt>fw1</tt> festgelegt.

<p>
Konfiguration von fw1:

<table border=0 width="650">
<tr><td nowrap bgcolor="#EEEEEE">

<pre>
! aktiviere Präemptivität und Ausfallsicherheit für Gruppeninterfaces
# sysctl -w net.inet.carp.preempt=1

! pfsync konfigurieren
# ifconfig em1 10.10.10.1 netmask 255.255.255.0
# ifconfig pfsync0 syncdev em1
# ifconfig pfsync0 up

! CARP auf dem LAN-Interface konfigurieren
# ifconfig carp1 create
# ifconfig carp1 vhid 1 carpdev em0 pass lanpasswd \
     172.16.0.100 netmask 255.255.255.0

! CARP auf dem WAN/Internet-Interface konfigurieren.
# ifconfig carp2 create
# ifconfig carp2 vhid 2 carpdev em2 pass netpasswd \
    192.0.2.100 netmask 255.255.255.0
</pre>
</td></tr>
</table>

<p>
Konfiguration von fw2:

<table border=0 width="650">
<tr><td nowrap bgcolor="#EEEEEE">
<pre>
! aktiviere Präemptivität und Ausfallsicherheit für Gruppeninterfaces
# sysctl -w net.inet.carp.preempt=1

! pfsync konfigurieren
# ifconfig em1 10.10.10.2 netmask 255.255.255.0
# ifconfig pfsync0 syncdev em1
# ifconfig pfsync0 up

! CARP auf dem LAN-Interface konfigurieren
# ifconfig carp1 create
# ifconfig carp1 vhid 1 carpdev em0 pass lanpasswd \
     advskew 128 172.16.0.100 netmask 255.255.255.0

! CARP auf dem WAN/Internet-Interface konfigurieren.
# ifconfig carp2 create
# ifconfig carp2 vhid 2 carpdev em2 pass netpasswd \
    advskew 128 192.0.2.100 netmask 255.255.255.0
</pre>
</td></tr>
</table>


<a name="ops"></a>
<h2>Weitere technische Möglichkeiten</h2>
Weitere technische Möglichkeiten im Umgang mit CARP und pfsync.

<a name="bootconfig"></a>
<h3>CARP und pfsync während des Bootvorgangs konfigurieren</h3>
Da carp(4) und pfsync besondere Netzwerkinterfacetypen sind,
lassen sie sich während des Bootvorgangs konfigurieren, indem man für
sie eine
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=hostname.if&amp;sektion=5"
>hostname.if(5)</a>-Datei anlegt.
Das Skript
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=netstart&amp;sektion=8"
>netstart</a> wird während des Bootens dann anhand diesen Dateien die
Konfiguration durchführen.

<p>
Beispiele:

<dl>

<dt>/etc/hostname.carp1</dt>
<dd>
inet 172.16.0.100 255.255.255.0 172.16.0.255 vhid 1 carpdev em0 \<br>
&nbsp;&nbsp;&nbsp;&nbsp;pass lanpasswd
</dd>
</dl>

<dl>
<dt>/etc/hostname.pfsync0</dt>
<dd>
up syncdev em1
</dd>
</dl>

<a name="forcefail"></a>
<h3>Ausfallsicherheit vom Master-Host testen</h3>
Es kann irgendwann die Zeit kommen, in der der Masterhost ausfällt,
bzw. sein Dienst vorübergehend eingestellt werden muss. Dies kann
geschehen, wenn man den Masterhost warten muss oder ein Problem
besteht, welches zu beheben ist. Das Ziel ist es, den Masterhost von
seinem Dienst zu suspendieren, ohne dass der Netzwerkverkehr davon
beeinträchtigt wird. Dazu muss einer der Backuphosts den Dienst des
Masterhosts übernehmen.

<p>
Um einen solchen Ausfall für eine bestimmte CARP-Gruppe zu erzwingen,
fahre das carp(4)-Interface auf dem Masterhost herunter. Das führt
dazu, dass der Masterhost sich selber mit »unendlich hohen«
<tt>advbase</tt> und <tt>advskew</tt> ankündigen wird. Der Backuphost
(oder einer davon) wird das merken und ab sofort die Rolle vom
Masterhost übernehmen.

<blockquote>
<tt>
# ifconfig carp1 down
</tt>
</blockquote>

<p>
Eine Alternative wäre <tt>advskew</tt> zu vergrößern, sodass der
Wert größer ist als <tt>advskew</tt> auf dem Backuphost
(bzw. den anderen Backuphosts). Damit wird ein Failover hervorgerufen,
der es dem Master ermöglicht, weiterhin in der CARP-Gruppe verfügbar
zu sein.

<a name="demote"></a>
<p>
Eine andere Möglichkeit, um Ausfallsicherheit zu gewährleisten,
ist die Anpassung des CARP-Demotionzählers. Der Demotionzähler gilt
als Maß dafür, wie »bereit« ein Host ist, der Master der CARP-Gruppe
zu werden. Wenn ein Host zum Beispiel gerade dabei ist hochzufahren,
wäre es eine schlechte Idee, ihn als CARP-Master zu deklarieren, bis
alle Interfaces eingerichtet, alle Netzwerkdaemons gestartet wurden
etc. Hosts, die einen hohen Demotionwert versenden, werden seltener
als Master ausgewählt.

<p>
Ein Demotionzähler wird in jeder Interfacegruppe gespeichert, zu der
das CARP-Interface gehört. Standardmäßig sind alle CARP-Interfaces
Mitglied der »carp«-Interfacegruppe. Der aktuelle Wert des
Demotioncounters kann mit ifconfig(8) angezeigt werden:

<blockquote>
<tt>
# ifconfig -g carp<br>
carp: carp demote count 0
</tt>
</blockquote>

<p>
In diesem Beispiel wird der Zähler der »carp«-Interfacegruppe angezeigt.
Wenn ein CARP-Host sich selbst im Netzwerk anbietet, so wird die Summe
aller Demotionzähler der Interfacegruppen versendet, zu denen das
carp(4)-Interface gehört. Das heißt, dass der versendete Demotionwert
die Summe aller Zähler darstellt.

<p>
Nehmen wir nun folgendes Beispiel an. Zwei Firewalls mit CARP besitzen
folgende CARP-Interfaces:

<ul>
<li>carp1 - Buchhaltung
<li>carp2 - Angestellte
<li>carp3 - Internet
<li>carp4 - DMZ
</ul>

<p>
Das Ziel besteht darin, nur die carp1- und carp2-Gruppen im Falle eines
Ausfalls auf die zweite Firewall umzuleiten.

<p>
Zuerst müssen beide zuerst zu einer neuen Interfacegruppe hinzugefügt
werden. In diesem Beispiel nennen wir sie »internal«:

<blockquote>
<tt>
# ifconfig carp1 group internal<br>
# ifconfig carp2 group internal<br>
# ifconfig internal<br>
carp1: flags=8843&lt;UP,BROADCAST,RUNNING,SIMPLEX,MULTICAST&gt; mtu 1500<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;carp: MASTER carpdev em0 vhid 1 advbase 1
advskew 100<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;groups: carp internal<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;inet 10.0.0.1 netmask 0xffffff00 broadcast
10.0.0.255<br>
carp2: flags=8843&lt;UP,BROADCAST,RUNNING,SIMPLEX,MULTICAST&gt; mtu 1500<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;carp: MASTER carpdev em1 vhid 2 advbase 1
advskew 100<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;groups: carp internal<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;inet 10.0.1.1 netmask 0xffffff00 broadcast
10.0.1.255
</tt>
</blockquote>

<p>
Nun erhöhen wir den Demotionzähler für die Gruppe »internal« mittels
ifconfig(8):

<blockquote>
<tt>
# ifconfig -g internal<br>
internal: carp demote count 0<br>
# ifconfig -g internal carpdemote 50<br>
# ifconfig -g internal<br>
internal: carp demote count 50<br>
</tt>
</blockquote>

<p>
Die Firewall wird nun im Falle eines Ausfalls die Gruppen carp1 und
carp2 gerne an die andere Firewall im Cluster übergeben, doch weiterhin
Master von carp3 und carp4 bleiben. Wenn die andere Firewall nun selbst
beginnt, sich mit einem Demotionwert über 50 anzubieten, oder die
andere Firewall aufhört, ihren Wert zu übermitteln, so wird diese
Firewall wie zuvor die Gruppen carp1 und carp2 übernehmen.

<p>
Um auf die primäre Firewall zurückfallen zu können, mach die Änderungen
wieder rückgängig:

<blockquote>
<tt>
# ifconfig -g internal -carpdemote 50<br>
# ifconfig -g internal<br>
internal: carp demote count 0<br>
</tt>
</blockquote>

<p>
Netzwerkdaemons wie zum Beispiel
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=bgpd&amp;sektion=8"
>OpenBGPD</a> und
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=sasyncd&amp;sektion=8"
>sasyncd(8)</a> verwenden den Demotioncounter, um sicherzustellen,
dass die Firewall nicht zum Master wird, bevor die BGP-Sitzung
aufgebaut und IPsec-SAs synchronisiert wurden.

<a name="RulesetTips"></a>
<h3>Tipps für Regelsätze</h3>
<b>Filter das physikalische Interface.</b>
Soweit es PF anbelangt, wird der Netzwerkverkehr vom physikalischen
Interface und nicht vom virtuellen CARP-Interface (d.&nbsp;h.
<tt>carp0</tt>) empfangen. Schreibe also deine Regelsätze
dementsprechend. Vergiss nicht, dass ein Interfacename in einer
PF-Regel entweder der Name eines physikalischen Interfaces
oder eine dem Interface zugewiesene Adresse sein kann. Zum Beispiel
könnte diese Regel korrekt sein:
<blockquote><tt>
pass in on fxp0 inet proto tcp from any to carp0 port 22
</tt></blockquote>
Das Ersetzen von <tt>fxp0</tt> in <tt>carp0</tt> würde aber nicht das
machen, was du erwartest.

<p>
<b>Vergiss NIEMALS</b>, <tt>proto carp</tt> und <tt>proto pfsync</tt>
zu übergeben!

<p>

<a name="ref"></a>
<h2>Weitere Referenzen</h2>

Bitte folge den Links für weitere Informationen zu dem Thema.
<ul>
<li>
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=carp&amp;sektion=4&amp;manpath=OpenBSD+5.4"
>carp(4)</a>
<li>
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=pfsync&amp;sektion=4&amp;manpath=OpenBSD+5.4"
>pfsync(4)</a>
<li>
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=ifconfig&amp;sektion=8"
>ifconfig(8)</a>
<li>
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=hostname.if&amp;sektion=5"
>hostname.if(5)</a>
<li>
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=pf.conf&amp;sektion=5&amp;manpath=OpenBSD+5.4"
>pf.conf(5)</a>
<li>
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=ifstated&amp;sektion=8"
>ifstated(8)</a>
<li>
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=ifstated.conf&amp;sektion=5"
>ifstated.conf(5)</a>
</ul>


<p>
[<a href="authpf.html">Zurück: Authpf: Benutzer-Shell für
authentifizierende Gateways</a>]
[<a href="index.html">Inhalt</a>]
[<a href="example1.html">Weiter: Firewall für zuhause oder ein kleines
Büro</a>]

<p>
<hr>
<a href="index.html"><img height="24" width="24" src="../../../images/back.gif" border="0" alt="[zurück]"></a>
<a href="mailto:www@@openbsd.org">www@@openbsd.org</a>
<br>

<small>
<!--
Originally [OpenBSD: carp.html,v 1.35 ]<br>
$Translation: carp.html,v 1.36 2013/11/01 16:59:45 steffen Exp $<br>
-->
$OpenBSD: carp.html,v 1.34 2013/11/01 18:04:05 ajacoutot Exp $
</small>

</body>
</html>
@


1.34
log
@Sync with Steelix CVS
@
text
@d783 1
a783 1
$OpenBSD$
@


1.33
log
@Sync with Steelix CVS
@
text
@d148 1
a148 1
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=carp&amp;sektion=4&amp;manpath=OpenBSD+5.3"
d311 1
a311 1
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=pfsync&amp;sektion=4&amp;manpath=OpenBSD+5.3"
d313 1
a313 1
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=pf&amp;sektion=4&amp;manpath=OpenBSD+5.3"
d742 1
a742 1
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=carp&amp;sektion=4&amp;manpath=OpenBSD+5.3"
d745 1
a745 1
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=pfsync&amp;sektion=4&amp;manpath=OpenBSD+5.3"
d754 1
a754 1
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=pf.conf&amp;sektion=5&amp;manpath=OpenBSD+5.3"
d780 2
a781 2
Originally [OpenBSD: carp.html,v 1.34 ]<br>
$Translation: carp.html,v 1.35 2013/05/01 16:34:16 steffen Exp $<br>
@


1.32
log
@Sync with Steelix CVS
@
text
@d780 2
a781 2
Originally [OpenBSD: carp.html,v 1.33 ]<br>
$Translation: carp.html,v 1.34 2013/05/01 13:35:26 steffen Exp $<br>
@


1.31
log
@Sync with Steelix CVS
@
text
@d148 1
a148 1
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=carp&amp;sektion=4&amp;manpath=OpenBSD+5.2"
d311 1
a311 1
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=pfsync&amp;sektion=4&amp;manpath=OpenBSD+5.2"
d313 1
a313 1
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=pf&amp;sektion=4&amp;manpath=OpenBSD+5.2"
d742 1
a742 1
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=carp&amp;sektion=4&amp;manpath=OpenBSD+5.2"
d745 1
a745 1
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=pfsync&amp;sektion=4&amp;manpath=OpenBSD+5.2"
d754 1
a754 1
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=pf.conf&amp;sektion=5&amp;manpath=OpenBSD+5.2"
d781 1
a781 1
$Translation: carp.html,v 1.33 2012/12/21 10:28:41 steffen Exp $<br>
@


1.30
log
@Sync with Steelix CVS
@
text
@d174 3
a176 2
<dd>Die »Virtual Host ID«. Dies ist eine Nummer, die eine Gruppe
innerhalb eines Netzwerksegments eindeutig identifiziert.
d178 1
d780 2
a781 2
Originally [OpenBSD: carp.html,v 1.32 ]<br>
$Translation: carp.html,v 1.32 2012/11/01 20:43:18 steffen Exp $<br>
@


1.29
log
@Sync with Steelix CVS
@
text
@d148 1
a148 1
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=carp&amp;sektion=4&amp;manpath=OpenBSD+5.1"
d309 1
a309 1
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=pfsync&amp;sektion=4&amp;manpath=OpenBSD+5.1"
d311 1
a311 1
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=pf&amp;sektion=4&amp;manpath=OpenBSD+5.1"
d740 1
a740 1
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=carp&amp;sektion=4&amp;manpath=OpenBSD+5.1"
d743 1
a743 1
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=pfsync&amp;sektion=4&amp;manpath=OpenBSD+5.1"
d752 1
a752 1
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=pf.conf&amp;sektion=5&amp;manpath=OpenBSD+5.1"
d778 2
a779 2
Originally [OpenBSD: carp.html,v 1.31 ]<br>
$Translation: carp.html,v 1.31 2012/05/11 17:06:29 steffen Exp $<br>
@


1.28
log
@Sync with Steelix CVS
@
text
@d148 1
a148 1
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=carp&amp;sektion=4&amp;manpath=OpenBSD+5.0"
d309 1
a309 1
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=pfsync&amp;sektion=4&amp;manpath=OpenBSD+5.0"
d311 1
a311 1
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=pf&amp;sektion=4&amp;manpath=OpenBSD+5.0"
d740 1
a740 1
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=carp&amp;sektion=4&amp;manpath=OpenBSD+5.0"
d743 1
a743 1
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=pfsync&amp;sektion=4&amp;manpath=OpenBSD+5.0"
d752 1
a752 1
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=pf.conf&amp;sektion=5&amp;manpath=OpenBSD+5.0"
d778 2
a779 2
Originally [OpenBSD: carp.html,v 1.30 ]<br>
$Translation: carp.html,v 1.30 2012/02/05 17:49:28 steffen Exp $<br>
@


1.27
log
@Sync with Steelix CVS
@
text
@d411 1
a411 1
# ifconfig pfsync0 syncdev em1<br>
d778 2
a779 2
Originally [OpenBSD: carp.html,v 1.29 ]<br>
$Translation: carp.html,v 1.29 2012/01/13 20:29:18 steffen Exp $<br>
@


1.26
log
@Sync with Steelix CVS
@
text
@d148 1
a148 1
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=carp&amp;sektion=4&amp;manpath=OpenBSD+4.6"
a159 1

d161 2
a162 2
[state <i>state</i>] <i>ipaddress</i> \<br>
&nbsp;&nbsp;&nbsp;netmask <i>mask</i>
d165 1
d210 11
d242 1
a242 1
<dd>Erlaubt Hosts innerhalb einer Gruppe, die einen besseren
d244 8
a251 6
werden. Zusätzlich erlaubt diese Option das Herunterfahren aller
Interfaces in dem Fall, dass ein Interface ausfällt. Wenn ein
physikalisches CARP-Interface herunterfährt, wird CARP <tt>advskew</tt>
bei allen anderen CARP-Schnittstellen auf den Wert 240 setzen. Im
Wesentlichen wird er sich so selbst von seinem Dienst suspendieren.
Standardwert ist 0 (aus).
d254 4
a257 2

<dd>Zeichnet fehlerhafte CARP-Pakete auf. Standard ist 0 (aus).
a259 1

d309 1
a309 1
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=pfsync&amp;sektion=4&amp;manpath=OpenBSD+4.6"
d311 1
a311 1
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=pf&amp;sektion=4&amp;manpath=OpenBSD+4.6"
d372 1
a372 2
<i>syncpeer</i>]

d393 9
d599 1
d740 1
a740 1
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=carp&amp;sektion=4&amp;manpath=OpenBSD+4.6"
d743 1
a743 1
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=pfsync&amp;sektion=4&amp;manpath=OpenBSD+4.6"
d752 1
a752 1
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=pf.conf&amp;sektion=5&amp;manpath=OpenBSD+4.6"
d778 2
a779 2
Originally [OpenBSD: carp.html,v 1.25 ]<br>
$Translation: carp.html,v 1.28 2010/02/20 14:37:13 tobias Exp $<br>
@


1.25
log
@Sync with Steelix CVS
@
text
@a242 6

<dt><tt>net.inet.carp.arpbalance</tt>
<dd>Ermöglicht Lastverteilung zwischen mehreren Gruppen. Standard ist
0 (aus). Siehe auch
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=carp&amp;sektion=4&amp;manpath=OpenBSD+4.6"
>carp(4)</a> für weitere Informationen.
d755 2
a756 2
Originally [OpenBSD: carp.html,v 1.24 ]<br>
$Translation: carp.html,v 1.27 2009/11/05 12:55:49 tobias Exp $<br>
@


1.24
log
@Sync with Steelix CVS
@
text
@d148 1
a148 1
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=carp&amp;sektion=4&amp;manpath=OpenBSD+4.5"
d247 1
a247 1
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=carp&amp;sektion=4&amp;manpath=OpenBSD+4.5"
d301 1
a301 1
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=pfsync&amp;sektion=4&amp;manpath=OpenBSD+4.5"
d303 1
a303 1
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=pf&amp;sektion=4&amp;manpath=OpenBSD+4.5"
d723 1
a723 1
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=carp&amp;sektion=4&amp;manpath=OpenBSD+4.5"
d726 1
a726 1
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=pfsync&amp;sektion=4&amp;manpath=OpenBSD+4.5"
d735 1
a735 1
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=pf.conf&amp;sektion=5&amp;manpath=OpenBSD+4.5"
d761 2
a762 2
Originally [OpenBSD: carp.html,v 1.23 ]<br>
$Translation: carp.html,v 1.26 2009/05/19 19:51:22 tobias Exp $<br>
@


1.23
log
@Sync with Steelix CVS
@
text
@d212 1
a212 1
Adresse darf nicht im selben Subnetz sein wie die IP-Adresse, die dem
d762 1
a762 1
$Translation: carp.html,v 1.25 2009/05/03 12:44:31 tobias Exp $<br>
@


1.22
log
@Sync with Steelix CVS
@
text
@d148 1
a148 1
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=carp&amp;sektion=4&amp;manpath=OpenBSD+4.4"
d247 1
a247 1
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=carp&amp;sektion=4&amp;manpath=OpenBSD+4.4"
d301 1
a301 1
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=pfsync&amp;sektion=4&amp;manpath=OpenBSD+4.4"
d303 1
a303 1
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=pf&amp;sektion=4&amp;manpath=OpenBSD+4.4"
d723 1
a723 1
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=carp&amp;sektion=4&amp;manpath=OpenBSD+4.4"
d726 1
a726 1
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=pfsync&amp;sektion=4&amp;manpath=OpenBSD+4.4"
d735 1
a735 1
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=pf.conf&amp;sektion=5&amp;manpath=OpenBSD+4.4"
d761 2
a762 2
Originally [OpenBSD: carp.html,v 1.22 ]<br>
$Translation: carp.html,v 1.24 2008/11/22 11:01:57 paldium Exp $<br>
@


1.21
log
@Sync with Steelix CVS
@
text
@d543 3
a545 1
<br>
d761 2
a762 2
Originally [OpenBSD: carp.html,v 1.21 ]<br>
$Translation: carp.html,v 1.23 2008/11/01 09:15:06 paldium Exp $<br>
@


1.20
log
@Sync with Steelix CVS
@
text
@d148 1
a148 1
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=carp&amp;sektion=4&amp;manpath=OpenBSD+4.3"
d247 1
a247 1
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=carp&amp;sektion=4&amp;manpath=OpenBSD+4.3"
d301 1
a301 1
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=pfsync&amp;sektion=4&amp;manpath=OpenBSD+4.3"
d303 1
a303 1
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=pf&amp;sektion=4&amp;manpath=OpenBSD+4.3"
d721 1
a721 1
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=carp&amp;sektion=4&amp;manpath=OpenBSD+4.3"
d724 1
a724 1
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=pfsync&amp;sektion=4&amp;manpath=OpenBSD+4.3"
d733 1
a733 1
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=pf.conf&amp;sektion=5&amp;manpath=OpenBSD+4.3"
d759 2
a760 2
Originally [OpenBSD: carp.html,v 1.20 ]<br>
$Translation: carp.html,v 1.22 2008/08/04 14:41:03 paldium Exp $<br>
@


1.19
log
@Sync with Steelix CVS
@
text
@d148 1
a148 1
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=carp&amp;sektion=4&amp;manpath=OpenBSD+4.2"
d247 1
a247 1
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=carp&amp;sektion=4&amp;manpath=OpenBSD+4.2"
d301 1
a301 1
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=pfsync&amp;sektion=4&amp;manpath=OpenBSD+4.2"
d303 1
a303 1
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=pf&amp;sektion=4&amp;manpath=OpenBSD+4.2"
d721 1
a721 1
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=carp&amp;sektion=4&amp;manpath=OpenBSD+4.2"
d724 1
a724 1
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=pfsync&amp;sektion=4&amp;manpath=OpenBSD+4.2"
d733 1
a733 1
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=pf.conf&amp;sektion=5&amp;manpath=OpenBSD+4.2"
d759 2
a760 2
Originally [OpenBSD: carp.html,v 1.19 ]<br>
$Translation: carp.html,v 1.21 2008/03/04 23:03:17 paldium Exp $<br>
@


1.18
log
@Sync with Steelix CVS
@
text
@d468 1
a468 1
! aktiviere Preemptivität und Ausfallsicherheit für Gruppeninterfaces
d495 1
a495 1
! aktiviere Preemptivität und Ausfallsicherheit für Gruppeninterfaces
d583 1
a583 1
ist die Anpassung des CARP-Demotionzählers. Der Demtionzähler gilt
d700 1
a700 1
PF-Regel entweder der Name eines physikalischen Interfacess
d760 1
a760 1
$Translation: carp.html,v 1.20 2007/11/03 10:45:41 paldium Exp $<br>
@


1.17
log
@sync with steelix translation CVS
@
text
@d131 1
a131 1
CARP ist ein eigenständiges Protokoll, so dass extra definierte
d148 1
a148 1
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=carp&amp;sektion=4&amp;manpath=OpenBSD+4.1"
d247 1
a247 1
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=carp&amp;sektion=4&amp;manpath=OpenBSD+4.1"
d301 1
a301 1
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=pfsync&amp;sektion=4&amp;manpath=OpenBSD+4.1"
d303 1
a303 1
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=pf&amp;sektion=4&amp;manpath=OpenBSD+4.1"
d310 1
a310 1
Hosts im Netzwerk senden, so dass diese den Zustand ihrer Tabellen
d575 1
a575 1
Eine Alternative wäre <tt>advskew</tt> zu vergrößern, so dass der
d721 1
a721 1
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=carp&amp;sektion=4&amp;manpath=OpenBSD+4.1"
d724 1
a724 1
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=pfsync&amp;sektion=4&amp;manpath=OpenBSD+4.1"
d733 1
a733 1
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=pf.conf&amp;sektion=5&amp;manpath=OpenBSD+4.1"
d759 2
a760 2
Originally [OpenBSD: carp.html,v 1.18 ]<br>
$Translation: carp.html,v 1.19 2007/06/20 17:34:09 paldium Exp $<br>
@


1.16
log
@Sync with steelix translation CVS
@
text
@d481 1
a481 1
! CARP auf dem WAN-/Internet-Interface konfigurieren.
d508 1
a508 1
! CARP auf dem WAN-/Internet-Interface konfigurieren.
d760 1
a760 1
$Translation: carp.html,v 1.18 2007/05/08 21:19:11 simon Exp $<br>
@


1.15
log
@Sync with steelix translation CVS
@
text
@d148 1
a148 1
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=carp&amp;sektion=4&amp;manpath=OpenBSD+4.0"
d151 1
a151 1
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=ifconfig&amp;sektion=8&amp;manpath=OpenBSD+4.0"
d222 1
a222 1
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=sysctl&amp;sektion=8&amp;manpath=OpenBSD+4.0"
d247 1
a247 1
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=carp&amp;sektion=4&amp;manpath=OpenBSD+4.0"
d301 1
a301 1
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=pfsync&amp;sektion=4&amp;manpath=OpenBSD+4.0"
d303 1
a303 1
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=pf&amp;sektion=4&amp;manpath=OpenBSD+4.0"
d307 1
a307 1
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=tcpdump&amp;sektion=8&amp;manpath=OpenBSD+4.0"
d335 1
a335 1
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=ipsec&amp;sektion=4&amp;manpath=OpenBSD+4.0"
d358 1
a358 1
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=ifconfig&amp;sektion=8&amp;manpath=OpenBSD+4.0"
d526 1
a526 1
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=hostname.if&amp;sektion=5&amp;manpath=OpenBSD+4.0"
d529 1
a529 1
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=netstart&amp;sektion=8&amp;manpath=OpenBSD+4.0"
d686 1
a686 1
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=bgpd&amp;sektion=8&amp;manpath=OpenBSD+4.0"
d688 1
a688 1
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=sasyncd&amp;sektion=8&amp;manpath=OpenBSD+4.0"
d721 1
a721 1
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=carp&amp;sektion=4&amp;manpath=OpenBSD+4.0"
d724 1
a724 1
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=pfsync&amp;sektion=4&amp;manpath=OpenBSD+4.0"
d727 1
a727 1
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=ifconfig&amp;sektion=8&amp;manpath=OpenBSD+4.0"
d730 1
a730 1
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=hostname.if&amp;sektion=5&amp;manpath=OpenBSD+4.0"
d733 1
a733 1
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=pf.conf&amp;sektion=5&amp;manpath=OpenBSD+4.0"
d736 1
a736 1
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=ifstated&amp;sektion=8&amp;manpath=OpenBSD+4.0"
d739 1
a739 1
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=ifstated.conf&amp;sektion=5&amp;manpath=OpenBSD+4.0"
d759 2
a760 2
Originally [OpenBSD: carp.html,v 1.16 ]<br>
$Translation: carp.html,v 1.17 2007/04/25 15:41:14 paldium Exp $<br>
@


1.14
log
@sync with steelix translation CVS
@
text
@d190 1
a190 1
  
d693 1
a693 1
<a name="RulesetTips"></a> 
d739 1
a739 1
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=ifstated.conf&amp;sektion=5&amp;manpath=OpenBSD+4.0" 
d760 1
a760 1
$Translation: carp.html,v 1.16 2007/02/19 20:24:34 paldium Exp $<br>
@


1.13
log
@sync with Steelix CVS
@
text
@d561 6
a566 5
Um einen solchen Ausfall zu erzwingen, fahre das carp(4)-Interface auf
dem Masterhost herunter. Das führt dazu, dass der Masterhost sich
selber mit »unendlich hohen« <tt>advbase</tt> und <tt>advskew</tt>
ankündigen wird. Der Backuphost (oder einer davon) wird das merken
und ab sofort die Rolle vom Masterhost übernehmen.
d575 5
a579 2
Wenn preempt aktiviert wurde, so werden auch <b>alle</b> anderen
CARP-Gruppen zum Failoververhalten wechseln.
d759 2
a760 2
Originally [OpenBSD: carp.html,v 1.15 ]<br>
$Translation: carp.html,v 1.15 2007/02/09 18:15:20 paldium Exp $<br>
@


1.12
log
@sync with steelix translation CVS
@
text
@d14 1
a14 1
Copyright (c) 2005 Joel Knight <enabled@@myrealbox.com>
d200 1
a200 1
die Einstellung von <tt><i>advbase</i></tt> kann der Master-CARP-Host
d203 1
a203 1
Werte sind 1 bis 254. Der Standardwert ist 0.
d583 1
a583 1
alle Interfaces eingerichtet, alle Netzwerkdaemons gestartet wurden,
d755 2
a756 2
Originally [OpenBSD: carp.html,v 1.13 ]<br>
$Translation: carp.html,v 1.13 2006/11/01 10:48:51 paldium Exp $<br>
@


1.11
log
@sync with steelix translation CVS
@
text
@d148 1
a148 1
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=carp&amp;sektion=4&amp;manpath=OpenBSD+3.9"
d151 1
a151 1
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=ifconfig&amp;sektion=8&amp;manpath=OpenBSD+3.9"
d222 1
a222 1
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=sysctl&amp;sektion=8&amp;manpath=OpenBSD+3.9"
d247 1
a247 1
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=carp&amp;sektion=4&amp;manpath=OpenBSD+3.9"
d291 1
d301 1
a301 1
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=pfsync&amp;sektion=4&amp;manpath=OpenBSD+3.9"
d303 1
a303 1
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=pf&amp;sektion=4&amp;manpath=OpenBSD+3.9"
d307 1
a307 1
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=tcpdump&amp;sektion=8&amp;manpath=OpenBSD+3.9"
d335 1
a335 1
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=ipsec&amp;sektion=4&amp;manpath=OpenBSD+3.9"
d358 1
a358 1
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=ifconfig&amp;sektion=8&amp;manpath=OpenBSD+3.9"
d526 1
a526 1
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=hostname.if&amp;sektion=5&amp;manpath=OpenBSD+3.9"
d529 1
a529 1
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=netstart&amp;sektion=8&amp;manpath=OpenBSD+3.9"
d573 116
d717 1
a717 1
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=carp&amp;sektion=4&amp;manpath=OpenBSD+3.9"
d720 1
a720 1
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=pfsync&amp;sektion=4&amp;manpath=OpenBSD+3.9"
d723 1
a723 1
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=ifconfig&amp;sektion=8&amp;manpath=OpenBSD+3.9"
d726 1
a726 1
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=hostname.if&amp;sektion=5&amp;manpath=OpenBSD+3.9"
d729 1
a729 1
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=pf.conf&amp;sektion=5&amp;manpath=OpenBSD+3.9"
d732 1
a732 1
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=ifstated&amp;sektion=8&amp;manpath=OpenBSD+3.9"
d735 1
a735 1
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=ifstated.conf&amp;sektion=5&amp;manpath=OpenBSD+3.9" 
d755 2
a756 2
Originally [OpenBSD: carp.html,v 1.12 ]<br>
$Translation: carp.html,v 1.12 2006/10/29 09:44:47 paldium Exp $<br>
@


1.10
log
@sync with Steelix CVS
@
text
@d82 1
a82 1
Router Redundancy«-Protokoll</a> und zum
d84 1
a84 1
Router«-Protokoll</a>.
d162 2
a163 2
[state <i>state</i>] <i>ipaddress</i>
<i>mask</i>
d254 1
a254 1
Eine Beispielkonfiguration für CARP.
d261 1
a261 1
&nbsp;&nbsp;&nbsp;&nbsp;advskew 100 10.0.0.1 255.255.255.0<br>
d390 1
a390 1
Eine pfsync-Beispielkonfiguration.
d478 1
a478 1
     172.16.0.100 255.255.255.0
d483 1
a483 1
    192.0.2.100 255.255.255.0
d505 1
a505 1
     advskew 128 172.16.0.100 255.255.255.0
d510 1
a510 1
    advskew 128 192.0.2.100 255.255.255.0
d638 2
a639 2
Originally [OpenBSD: carp.html,v 1.10 ]<br>
$Translation: carp.html,v 1.11 2006/08/06 14:06:56 paldium Exp $<br>
@


1.9
log
@3.9 release time.
@
text
@d45 1
a45 1
<h1><font color="#e00000">PF: Firewall-Redundanz mit CARP und pfsync</font></h1>
d66 1
a66 1
	<li><a href="#forcefail">Ausfallsicherheit vom Master-Host
d78 1
a78 1
CARP ist das ,Common Address Redundancy'-Protokoll. Sein primärer Zweck
d80 5
a84 5
sich eine IP-Adresse zu teilen. CARP ist eine sichere und freie
Alternative zum <a href="http://www.ietf.org/rfc/rfc3768.txt">,Virtual
Router Redundancy'-Protokoll</a> und zum
<a href="http://www.ietf.org/rfc/rfc2281.txt">,Hot Standby
Router'-Protokoll</a>.
d87 1
a87 1
CARP arbeitet, indem es einer Gruppe mehreren Hosts in einem gleichen
d89 1
a89 1
Gruppe wird als ,redundancy group' bezeichnet (im Folgenden nur Gruppe
d92 2
a93 2
arbeitet ein Host als ,master'. Die restlichen Hosts in der Gruppe als
,backup'. Der Master-Host ,hält' die zugewiesene IP-Adresse; er reagiert
d102 2
a103 2
konfiguriert. Sollte nun der Master-Host der Gruppe ausfallen, so wird
einer der Backup-Hosts in der Gruppe seine Funktion übernehmen.
d111 7
a117 7
Der Master-Host sendet in regelmäßigen Abständen Nachrichten an das
lokale Netzwerk, um den Backup-Hosts mitzuteilen, dass er im Betrieb
ist. Wenn die Backup-Hosts nach einer festgelegten Zeitspanne keine
dieser Nachrichten registrieren, wird einer der Backup-Hosts an dessen
Stelle treten und dessen Dienst übernehmen. Das wird der Backup-Host
sein, der mit den niedrigsten Werten für <tt>advbase</tt> und
<tt>advskew</tt> konfiguriert ist.
d121 1
a121 1
einzurichten. Die CARP-Nachrichten beinhalten eine ,Virtual Host ID',
d126 1
a126 1
Um eine Gruppe vor gespooften CARP-Nachrichten zu schützen, ist es
d128 1
a128 1
Paket, welches gesendet wird, ist durch einen SHA1 HMAC geschützt.
d131 2
a132 2
Seitdem CARP ein eigenständiges Protokoll ist, sollten extra definierte
,pass'-Regeln im Regelsatz verwendet werden.
d170 2
a171 2
<dd>Der Name des virtuellen carp(4)-Interfaces. Wobei <i>N</i> die
Interface-Nummer ist (z.B. carp10).
d174 1
a174 1
<dd>Die ,Virtual Host ID'. Dies ist eine Nummer, die eine Gruppe
d176 1
a176 1
Akzeptierte Werte sind 1 bis 255.
d187 3
a189 3
finden. Dabei schaut es nach dem Interface, welches in dem gleichen
Subnetz ist wie das carp(4)-Interface, anhand der Kombination aus
Netzwerkmaske (<i>mask</i>) und IP-Adresse (<i>ipaddress</i>).
d192 4
a195 4
<dd>Dieser Parameter ist optional. Er gibt an, in welchen Zeitabständen
der Host Nachrichten an die Gruppe senden soll, die signalisieren, dass
der Host ein Mitglied der Gruppe ist. Akzeptierte Werte sind 1 bis 255.
Standard ist 1.
d199 1
a199 1
gestreckt werden soll, wenn CARP-,advertisements' gesendet werden. Durch
d202 1
a202 1
seine Berechtigung, die Rolle vom Master-Host einzunehmen. Akzeptierte
d207 1
a207 1
anzunehmen. Zulässige Werte sind <tt>init</tt>, <tt>backup</tt> und
d213 1
a213 1
physikalischen Interface zugeordnet ist, sofern es vorhanden ist. Die
d227 1
a227 1
<dd>Akzeptiert eingehende CARP-Pakete, oder nicht. Standard ist 1
d231 2
a232 2
<dd>Erlaubt Hosts innerhalb einer Gruppe, welche einen besseren
<tt>advbase</tt>- und <tt>advskew</tt>-Wert haben, der Master-Host zu
d237 1
a237 1
Wesentlichen wird er sich so selbst von seinem Dienst ,suspendieren'.
d242 1
a242 1
<dd>Loggt fehlerhafte CARP-Pakete. Standard ist 0 (aus).
d245 1
a245 1
<dd>Ermöglicht ,load balancing' zwischen mehreren Gruppen. Standard ist
d268 1
a268 1
<li>Schaltet den Empfang von CARP-Paketen ein. (Dies ist die
d270 2
a271 2
<li>Erzeugt ein carp(4)-Interface, <tt>carp1</tt>.
<li>Konfiguriert <tt>carp1</tt> für den virtuellen Host #1, setzt ein
d274 1
a274 1
<tt>100</tt> als Backup-Host konfiguriert (natürlich nur, wenn der
d281 1
a281 1
Das Ausführen von <tt>ifconfig</tt> auf <tt>carp1</tt> zeigt den
d303 1
a303 1
>pf(4)</a>-Zustands, seiner ,tables', an.
d321 4
a324 4
zu senden und zu empfangen, so verhält es sich so, dass die Nachrichten
an alle Teilnehmer der Gruppe versendet werden. All diese
Updateinformationen werden jedoch ohne Authentifizierung versendet. Um
hier für Sicherheit zu sorgen, gibt es zwei bewährte Verfahren:
d331 1
a331 1
href="#pfsyncconfig">unten</a>), um eine ,unicast'-Verbindung über das
d356 1
a356 1
Seit pfsync(4) als virtuelles Netzwerkinterface arbeitet, wird es mit
d380 2
a381 2
als Unicast-Nachrichten versendet werden sollen. Standardmäßig werden
die Update-Nachrichten als Multicast-Nachricht an die Gruppe im lokalen
d383 1
a383 1
stattdessen das Update per Unicast-Nachricht an den angegebenen
d399 2
a400 2
Verkehr wird via Multicast in das Netzwerk gesendet. Jeder Host, mit
aktiviertem pfsync, kann die Updates empfangen.
d406 1
a406 1
eine Gruppe von 2 oder mehr Hosts zu einem Firewall-Cluster mit hoher
d414 1
a414 1
<dd>Synchronisiert die Status-Tabellen zwischen allen Firewalls in einer
d416 2
a417 2
ohne Unterbrechung über den neuen Firewall-Host laufen; der neue
Firewall-Host hat stets eine aktuelle Status-Tabelle und kann sofort
d422 1
a422 1
Ein Beispielszenario. Zwei Firewalls, <tt>fw1</tt> und <tt>fw2</tt>.
d440 1
a440 1
das WAN, bzw. Internet, an <tt>em2</tt> angeschlossen.
d442 1
a442 1
Die IP-Adressen sind folgendermaßen vergeben:
d458 1
a458 1
Als Firewall-Master-Host wird <tt>fw1</tt> festgelegt.
d522 1
a522 1
Seitdem carp(4) und pfsync eine besondere Art Netzwerkinterface sind,
d551 1
a551 1
Es kann irgendwann die Zeit kommen, in der der Master-Host ausfällt,
d553 5
a557 5
geschehen, wenn man den Master-Host warten muss oder ein Problem
besteht, welches zu beheben ist. Das Ziel ist es, den Master-Host von
seinem Dienst zu ,suspendieren', ohne dass der Netzwerkverkehr davon
beeinträchtigt wird. Dazu muss einer der Backup-Hosts den Dienst des
Master-Hosts übernehmen.
d561 4
a564 4
dem Master-Host herunter. Das führt dazu, dass der Master-Host sich
selber mit ,unendlich hohen' <tt>advbase</tt> und <tt>advskew</tt>
ankündigen wird. Der Backup-Host (oder einer davon) wird das ,merken'
und ab sofort die Rolle vom Master-Host übernehmen.
d579 1
a579 1
PF-Regel entweder der Name eines physikalischen Interfaces
d639 1
a639 1
$Translation: carp.html,v 1.10 2006/05/01 11:17:11 paldium Exp $<br>
@


1.8
log
@sync with Steelix CVS
@
text
@d148 1
a148 1
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=carp&amp;sektion=4&amp;manpath=OpenBSD+3.8"
d151 1
a151 1
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=ifconfig&amp;sektion=8&amp;manpath=OpenBSD+3.8"
d222 1
a222 1
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=sysctl&amp;sektion=8&amp;manpath=OpenBSD+3.8"
d247 1
a247 1
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=carp&amp;sektion=4&amp;manpath=OpenBSD+3.8"
d300 1
a300 1
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=pfsync&amp;sektion=4&amp;manpath=OpenBSD+3.8"
d302 1
a302 1
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=pf&amp;sektion=4&amp;manpath=OpenBSD+3.8"
d306 1
a306 1
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=tcpdump&amp;sektion=8&amp;manpath=OpenBSD+3.8"
d334 1
a334 1
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=ipsec&amp;sektion=4&amp;manpath=OpenBSD+3.8"
d357 1
a357 1
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=ifconfig&amp;sektion=8&amp;manpath=OpenBSD+3.8"
d525 1
a525 1
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=hostname.if&amp;sektion=5&amp;manpath=OpenBSD+3.8"
d528 1
a528 1
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=netstart&amp;sektion=8&amp;manpath=OpenBSD+3.8"
d600 1
a600 1
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=carp&amp;sektion=4&amp;manpath=OpenBSD+3.8"
d603 1
a603 1
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=pfsync&amp;sektion=4&amp;manpath=OpenBSD+3.8"
d606 1
a606 1
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=ifconfig&amp;sektion=8&amp;manpath=OpenBSD+3.8"
d609 1
a609 1
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=hostname.if&amp;sektion=5&amp;manpath=OpenBSD+3.8"
d612 1
a612 1
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=pf.conf&amp;sektion=5&amp;manpath=OpenBSD+3.8"
d615 1
a615 1
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=ifstated&amp;sektion=8&amp;manpath=OpenBSD+3.8"
d618 1
a618 1
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=ifstated.conf&amp;sektion=5&amp;manpath=OpenBSD+3.8" 
d638 2
a639 2
Originally [OpenBSD: carp.html,v 1.9 ]<br>
$Translation: carp.html,v 1.9 2006/04/24 17:44:30 paldium Exp $<br>
@


1.7
log
@sync with steelix translation CVS
@
text
@a5 1
<meta http-equiv="Content-Language" content="de">
d8 1
a8 1
<meta name="description"   content="Die OpenBSD-FAQ-Seite">
d638 2
a639 2
Originally [OpenBSD: carp.html,v 1.9 ]
$Translation: carp.html,v 1.8 2006/01/10 12:18:04 paldium Exp $
@


1.6
log
@sync with Steelix CVS
@
text
@d267 1
a267 1
Das bewirkt folgendes:
d640 1
a640 1
$Translation: carp.html,v 1.7 2005/11/24 14:04:25 paldium Exp $
@


1.5
log
@sync with steelix translation CVS
@
text
@d615 6
d640 1
a640 1
$Translation: carp.html,v 1.6 2005/11/12 10:27:52 paldium Exp $
@


1.4
log
@sync with steelix translation CVS
@
text
@d69 1
d573 21
d633 2
a634 2
Originally [OpenBSD: carp.html,v 1.7 ]
$Translation: carp.html,v 1.5 2005/11/04 11:01:45 paldium Exp $
@


1.3
log
@sync with Steelix CVS
@
text
@d148 1
a148 1
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=carp&amp;sektion=4&amp;manpath=OpenBSD+3.7"
d151 1
a151 1
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=ifconfig&amp;sektion=8&amp;manpath=OpenBSD+3.7"
d222 1
a222 1
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=sysctl&amp;sektion=8&amp;manpath=OpenBSD+3.7"
d247 1
a247 1
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=carp&amp;sektion=4&amp;manpath=OpenBSD+3.7"
d300 1
a300 1
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=pfsync&amp;sektion=4&amp;manpath=OpenBSD+3.7"
d302 1
a302 1
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=pf&amp;sektion=4&amp;manpath=OpenBSD+3.7"
d306 1
a306 1
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=tcpdump&amp;sektion=8&amp;manpath=OpenBSD+3.7"
d334 1
a334 1
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=ipsec&amp;sektion=4&amp;manpath=OpenBSD+3.7"
d357 1
a357 1
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=ifconfig&amp;sektion=8&amp;manpath=OpenBSD+3.7"
d525 1
a525 1
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=hostname.if&amp;sektion=5&amp;manpath=OpenBSD+3.7"
d528 1
a528 1
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=netstart&amp;sektion=8&amp;manpath=OpenBSD+3.7"
d579 1
a579 1
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=carp&amp;sektion=4&amp;manpath=OpenBSD+3.7"
d582 1
a582 1
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=pfsync&amp;sektion=4&amp;manpath=OpenBSD+3.7"
d585 1
a585 1
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=ifconfig&amp;sektion=8&amp;manpath=OpenBSD+3.7"
d588 1
a588 1
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=hostname.if&amp;sektion=5&amp;manpath=OpenBSD+3.7"
d591 1
a591 1
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=pf.conf&amp;sektion=5&amp;manpath=OpenBSD+3.7"
d611 2
a612 2
Originally [OpenBSD: carp.html,v 1.6 ]
$Translation: carp.html,v 1.4 2005/09/25 07:58:38 paldium Exp $
@


1.2
log
@sync with Steelix CVS
@
text
@d477 1
a477 1
# ifconfig carp1 vhid 1 carpdev em0 password lanpasswd \
d482 1
a482 1
# ifconfig carp2 vhid 2 carpdev em2 password netpasswd \
d504 1
a504 1
# ifconfig carp1 vhid 1 carpdev em0 password lanpasswd \
d509 1
a509 1
# ifconfig carp2 vhid 2 carpdev em2 password netpasswd \
d540 1
a540 1
&nbsp;&nbsp;&nbsp;&nbsp;password lanpasswd
d611 2
a612 2
Originally [OpenBSD: carp.html,v 1.5 ]
$Translation: carp.html,v 1.3 2005/08/05 16:38:19 paldium Exp $
@


1.1
log
@sync with Steelix CVS
@
text
@d1 618
a618 618
<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<html>
<head>
<title>PF: Firewall-Redundanz mit CARP und pfsync</title>
<link rev="made" href="mailto:www@@openbsd.org">
<meta http-equiv="Content-Language" content="de">
<meta http-equiv="Content-Type" content="text/html; charset=ISO-8859-1">
<meta name="resource-type" content="document">
<meta name="description"   content="Die OpenBSD-FAQ-Seite">
<meta name="keywords"      content="openbsd,faq,pf,carp,pfsync">
<meta name="distribution"  content="global">
</head>

<!--
Copyright (c) 2005 Joel Knight <enabled@@myrealbox.com>

Permission to use, copy, modify, and distribute this documentation for
any purpose with or without fee is hereby granted, provided that the
above copyright notice and this permission notice appear in all copies.

THE DOCUMENTATION IS PROVIDED "AS IS" AND THE AUTHOR DISCLAIMS ALL
WARRANTIES WITH REGARD TO THIS DOCUMENTATION INCLUDING ALL IMPLIED
WARRANTIES OF MERCHANTABILITY AND FITNESS. IN NO EVENT SHALL THE
AUTHOR BE LIABLE FOR ANY SPECIAL, DIRECT, INDIRECT, OR CONSEQUENTIAL
DAMAGES OR ANY DAMAGES WHATSOEVER RESULTING FROM LOSS OF USE, DATA OR
PROFITS, WHETHER IN AN ACTION OF CONTRACT, NEGLIGENCE OR OTHER
TORTIOUS ACTION, ARISING OUT OF OR IN CONNECTION WITH THE USE OR
PERFORMANCE OF THIS DOCUMENTATION
-->

<body bgcolor="#ffffff" text="#000000">
<!-- Passes validator.w3.org, please keep it this way;
please, use a max of 72 chars per line -->

<a href="../../../de/index.html">
<img alt="[OpenBSD]" height=30 width=141 src="../../../images/smalltitle.gif" border="0">
</a>
<p>
[<a href="authpf.html">Zurück: Authpf: Benutzer-Shell für
authentifizierende Gateways</a>]
[<a href="index.html">Inhalt</a>]
[<a href="example1.html">Weiter: Firewall für zuhause oder ein kleines
Büro</a>]

<p>
<h1><font color="#e00000">PF: Firewall-Redundanz mit CARP und pfsync</font></h1>

<hr>

<h3>Inhaltsverzeichnis</h3>
<ul>
<li><a href="#carpintro">Einführung in CARP</a>
<li><a href="#carpop">Funktionsweise von CARP</a>
<li><a href="#carpconfig">Konfiguration von CARP</a>
<li><a href="#carpex">CARP-Beispiel</a>
<li><a href="#pfsyncintro">Einführung in pfsync</a>
<li><a href="#pfsyncop">Funktionsweise von pfsync</a>
<li><a href="#pfsyncconfig">Konfiguration von pfsync</a>

<li><a href="#pfsyncex">pfsync-Beispiel</a>
<li><a href="#failover">Kombinieren von CARP und pfsync für
Ausfallsicherheit und Redundanz</a>
<li><a href="#ops">Weitere technische Möglichkeiten</a>
	<ul>
	<li><a href="#bootconfig">CARP und pfsync während des
	Bootvorgangs konfigurieren</a>
	<li><a href="#forcefail">Ausfallsicherheit vom Master-Host
	testen</a>
	</ul>
<li><a href="#ref">Weitere Referenzen</a>

</ul>

<hr>

<a name="carpintro"></a>
<h2>Einführung in CARP</h2>
CARP ist das ,Common Address Redundancy'-Protokoll. Sein primärer Zweck
ist es, mehreren Hosts in einem gleichen Netzwerksegment zu ermöglichen,
sich eine IP-Adresse zu teilen. CARP ist eine sichere und freie
Alternative zum <a href="http://www.ietf.org/rfc/rfc3768.txt">,Virtual
Router Redundancy'-Protocol</a> und zum
<a href="http://www.ietf.org/rfc/rfc2281.txt">,Hot Standby
Router'-Protokoll</a>.

<p>
CARP arbeitet, indem es einer Gruppe mehreren Hosts in einem gleichen
Netzwerksegment ermöglicht, sich eine IP-Adresse zu teilen. Eine solche
Gruppe wird als ,redundancy group' bezeichnet (im Folgenden nur Gruppe
genannt). Dieser Gruppe ist eine IP-Adresse zugeteilt, die
sich die Gruppenmitglieder untereinander teilen. Innerhalb der Gruppe
arbeitet ein Host als ,master'. Die restlichen Hosts in der Gruppe als
,backup'. Der Master-Host ,hält' die zugewiesene IP-Adresse; er reagiert
auf den gesamten Netzwerkverkehr und auf ARP-Anfragen, die an ihn bzw.
an die ihm zugewiesene IP gerichtet sind. Jeder Host kann einer oder
mehreren Gruppen zugeteilt sein.

<p>
In der Praxis wird CARP häufig dazu genutzt, eine Gruppe von redundanten
Firewalls zu erstellen. Die virtuelle IP, die der Gruppe zugeteilt ist,
wird bei den Netzwerkclients als das standardmäßige Gateway
konfiguriert. Sollte nun der Master-Host der Gruppe ausfallen, so wird
einer der Backup-Hosts in der Gruppe seine Funktion übernehmen.

<p>
CARP unterstützt IPv4 und IPv6.


<a name="carpop"></a>
<h2>Funktionsweise von CARP</h2>
Der Master-Host sendet in regelmäßigen Abständen Nachrichten an das
lokale Netzwerk, um den Backup-Hosts mitzuteilen, dass er im Betrieb
ist. Wenn die Backup-Hosts nach einer festgelegten Zeitspanne keine
dieser Nachrichten registrieren, wird einer der Backup-Hosts an dessen
Stelle treten und dessen Dienst übernehmen. Das wird der Backup-Host
sein, der mit den niedrigsten Werten für <tt>advbase</tt> und
<tt>advskew</tt> konfiguriert ist.

<p>
Es ist möglich, mehrere CARP-Gruppen in einem gleichen Netzwerksegment
einzurichten. Die CARP-Nachrichten beinhalten eine ,Virtual Host ID',
welche es den Hosts ermöglicht, zwischen den verschiedenen Gruppen zu
unterscheiden.

<p>
Um eine Gruppe vor gespooften CARP-Nachrichten zu schützen, ist es
möglich, jede dieser Gruppen mit Passwortschutz zu versehen. Jedes
Paket, welches gesendet wird, ist durch einen SHA1 HMAC geschützt.

<p>
Seitdem CARP ein eigenständiges Protokoll ist, sollten extra definierte
,pass'-Regeln im Regelsatz verwendet werden.

<blockquote>
<tt>
pass out on $carp_dev proto carp keep state
</tt>
</blockquote>

<p>
<tt>$carp_dev</tt> sollte das physikalische Interface sein, über welches
CARP kommuniziert.


<a name="carpconfig"></a>
<h2>Konfiguration von CARP</h2>
Jede Gruppe wird durch ein virtuelles
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=carp&amp;sektion=4&amp;manpath=OpenBSD+3.7"
>carp(4)</a>-Netzwerkinterface dargestellt. Als solches wird es auch
mit
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=ifconfig&amp;sektion=8&amp;manpath=OpenBSD+3.7"
>ifconfig(8)</a> konfiguriert.

<blockquote>
<tt>
ifconfig <i>carpN</i> create<br>
<br>
ifconfig <i>carpN</i> vhid <i>vhid</i> [pass <i>password</i>]
[carpdev <i>carpdev</i>] \<br>

&nbsp;&nbsp;&nbsp;[advbase <i>advbase</i>] [advskew <i>advskew</i>]
[state <i>state</i>] <i>ipaddress</i>
<i>mask</i>
</tt>
</blockquote>

<dl>
<dt><tt><i>carpN</i></tt>

<dd>Der Name des virtuellen carp(4)-Interfaces. Wobei <i>N</i> die
Interface-Nummer ist (z.B. carp10).

<dt><tt><i>vhid</i></tt>
<dd>Die ,Virtual Host ID'. Dies ist eine Nummer, die eine Gruppe
innerhalb eines Netzwerksegments eindeutig identifiziert.
Akzeptierte Werte sind 1 bis 255.

<dt><tt><i>password</i></tt>
<dd>Das Passwort, welches die Mitglieder einer Gruppe nutzen, um sich
untereinander zu authentifizieren. Alle Hosts in einer Gruppe müssen das
gleiche Passwort benutzen.

<dt><tt><i>carpdev</i></tt>
<dd>Dieser Parameter ist optional. Er gibt das physikalische Interface
an, welches dem Netzwerksegment zugeordnet ist, in dem sich die Gruppe
befindet. Standardmäßig versucht CARP, das richtige Interface selbst zu
finden. Dabei schaut es nach dem Interface, welches in dem gleichen
Subnetz ist wie das carp(4)-Interface, anhand der Kombination aus
Netzwerkmaske (<i>mask</i>) und IP-Adresse (<i>ipaddress</i>).
  
<dt><tt><i>advbase</i></tt>
<dd>Dieser Parameter ist optional. Er gibt an, in welchen Zeitabständen
der Host Nachrichten an die Gruppe senden soll, die signalisieren, dass
der Host ein Mitglied der Gruppe ist. Akzeptierte Werte sind 1 bis 255.
Standard ist 1.

<dt><tt><i>advskew</i></tt>
<dd>Dieser optionale Parameter gibt an, wie sehr <tt><i>advbase</i></tt>
gestreckt werden soll, wenn CARP-,advertisements' gesendet werden. Durch
die Einstellung von <tt><i>advbase</i></tt> kann der Master-CARP-Host
festgelegt werden. Je höher der Wert ist, desto <i>geringer</i> ist
seine Berechtigung, die Rolle vom Master-Host einzunehmen. Akzeptierte
Werte sind 1 bis 254. Der Standardwert ist 0.

<dt><tt><i>state</i></tt>
<dd>Zwingt das carp(4)-Interface dazu, einen bestimmten Status
anzunehmen. Zulässige Werte sind <tt>init</tt>, <tt>backup</tt> und
<tt>master</tt>.

<dt><tt><i>ipaddress</i></tt>
<dd>Dies ist die IP-Adresse, die der Gruppe zugewiesen wird. Diese
Adresse darf nicht im selben Subnetz sein wie die IP-Adresse, die dem
physikalischen Interface zugeordnet ist, sofern es vorhanden ist. Die
Adresse muss jedem Host in der Gruppe zugewiesen sein.

<dt><tt><i>mask</i></tt>
<dd>Die Subnetzmaske der gemeinsam genutzten IP.
</dl>

<p>
Weiterhin kann das Verhalten von CARP via
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=sysctl&amp;sektion=8&amp;manpath=OpenBSD+3.7"
>sysctl(8)</a> manipuliert werden.

<dl>
<dt><tt>net.inet.carp.allow</tt>
<dd>Akzeptiert eingehende CARP-Pakete, oder nicht. Standard ist 1
(akzeptiert).

<dt><tt>net.inet.carp.preempt</tt>
<dd>Erlaubt Hosts innerhalb einer Gruppe, welche einen besseren
<tt>advbase</tt>- und <tt>advskew</tt>-Wert haben, der Master-Host zu
werden. Zusätzlich erlaubt diese Option das Herunterfahren aller
Interfaces in dem Fall, dass ein Interface ausfällt. Wenn ein
physikalisches CARP-Interface herunterfährt, wird CARP <tt>advskew</tt>
bei allen anderen CARP-Schnittstellen auf den Wert 240 setzen. Im
Wesentlichen wird er sich so selbst von seinem Dienst ,suspendieren'.
Standardwert ist 0 (aus).

<dt><tt>net.inet.carp.log</tt>

<dd>Loggt fehlerhafte CARP-Pakete. Standard ist 0 (aus).

<dt><tt>net.inet.carp.arpbalance</tt>
<dd>Ermöglicht ,load balancing' zwischen mehreren Gruppen. Standard ist
0 (aus). Siehe auch
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=carp&amp;sektion=4&amp;manpath=OpenBSD+3.7"
>carp(4)</a> für weitere Informationen.
</dl>


<a name="carpex"></a>
<h2>CARP-Beispiel</h2>
Eine Beispielkonfiguration für CARP.

<blockquote>
<tt>
# sysctl -w net.inet.carp.allow=1<br>
# ifconfig carp1 create<br>
# ifconfig carp1 vhid 1 pass mekmitasdigoat carpdev em0 \<br>
&nbsp;&nbsp;&nbsp;&nbsp;advskew 100 10.0.0.1 255.255.255.0<br>
</tt>
</blockquote>

<p>
Das bewirkt folgendes:
<ul>
<li>Schaltet den Empfang von CARP-Paketen ein. (Dies ist die
Standardeinstellung).
<li>Erzeugt ein carp(4)-Interface, <tt>carp1</tt>.
<li>Konfiguriert <tt>carp1</tt> für den virtuellen Host #1, setzt ein
Passwort und konfiguriert das Interface <tt>em0</tt> als jenes, das zur
Gruppe gehört. Dazu wird der Host durch Setzen von <tt>advskew</tt> auf
<tt>100</tt> als Backup-Host konfiguriert (natürlich nur, wenn der
Master einen kleineren Wert als 100 bei <tt>advskew</tt> besitzt). Die
virtuelle IP, die der Gruppe zugewiesen ist, ist 10.0.0.1. Die
Subnetzmaske ist 255.255.255.0.
</ul>

<p>
Das Ausführen von <tt>ifconfig</tt> auf <tt>carp1</tt> zeigt den
Status des Interfaces.

<blockquote>
<tt>
# ifconfig carp1<br>
carp1: flags=8802&lt;UP,BROADCAST,SIMPLEX,MULTICAST&gt; mtu 1500<br>

&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;carp: BACKUP carpdev em0 vhid 1 advbase 1
advskew 100<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;inet 10.0.0.1 netmask 0xffffff00
broadcast 10.0.0.255
</tt>
</blockquote>


<a name="pfsyncintro"></a>
<h2>Einführung in pfsync</h2>
Das
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=pfsync&amp;sektion=4&amp;manpath=OpenBSD+3.7"
>pfsync(4)</a>-Netzwerkinterface zeigt bestimmte Änderungen des
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=pf&amp;sektion=4&amp;manpath=OpenBSD+3.7"
>pf(4)</a>-Zustands, seiner Tables, an.

Durch die Nutzung von
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=tcpdump&amp;sektion=8&amp;manpath=OpenBSD+3.7"
>tcpdump(8)</a> können diese Änderungen in Echtzeit überwacht werden.
Zusätzlich kann das pfsync(4)-Interface diese Änderungen an andere
Hosts im Netzwerk senden, so dass diese den Zustand ihrer Tabellen
entsprechend angleichen können. Ebenso kann pfsync(4) auf solche
Nachrichten aus dem Netzwerk warten und diese lesen.

<a name="pfsyncop"></a>
<h2>Funktionsweise von pfsync</h2>
Standardmäßig sendet oder empfängt pfsync(4) keine derartigen Meldungen
über das Netzwerk. Dennoch können die Updates mittels tcpdump(8) oder
anderen Programmen mitverfolgt werden.

<p>
Wenn pfsync(4) so konfiguriert ist, diese Nachrichten über das Netzwerk
zu senden und zu empfangen, so verhält es sich so, dass die Nachrichten
an alle Teilnehmer der Gruppe versendet werden. All diese
Updateinformationen werden jedoch ohne Authentifizierung versendet. Um
hier für Sicherheit zu sorgen, gibt es zwei bewährte Verfahren:

<ol>
<li>Verbinde die zwei Maschinen, die ihre Updates untereinander
austauschen sollen, mit einem Crossover-Kabel und konfiguriere das
Interface als <tt>syncdev</tt> (siehe <a href="#pfsyncconfig">hier</a>).
<li>Benutze die ifconfig(8)-Option <tt>syncpeer</tt> (siehe <a
href="#pfsyncconfig">unten</a>), um eine ,unicast'-Verbindung über das
Netzwerk zwischen den Maschinen aufzubauen, über die sie die Nachrichten
austauschen können. Danach konfiguriere
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=ipsec&amp;sektion=4&amp;manpath=OpenBSD+3.7"
>ipsec(4)</a>, um die Verbindung abzusichern.
</ol>

<p>
Wenn die Updates über das Netzwerk gesendet und empfangen werden,
sollten diese pfsync-Pakete auch im Regelsatz so berücksichtigt werden,
dass sie auch ihr Ziel erreichen können.

<blockquote>
<tt>
pass on $sync_if proto pfsync
</tt>
</blockquote>

<p>
<tt>$sync_if</tt> sollte das physikalische Interface sein, über das
pfsync(4) kommuniziert.


<a name="pfsyncconfig"></a>
<h2>Konfiguration von pfsync</h2>
Seit pfsync(4) als virtuelles Netzwerkinterface arbeitet, wird es mit
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=ifconfig&amp;sektion=8&amp;manpath=OpenBSD+3.7"
>ifconfig(8)</a> konfiguriert.

<blockquote>
<tt>
ifconfig <i>pfsyncN</i> syncdev <i>syncdev</i> [syncpeer
<i>syncpeer</i>]

</tt>
</blockquote>

<dl>
<dt><tt><i>pfsyncN</i></tt>
<dd>Der Name des pfsync(4)-Interfaces. <tt>pfsync0</tt> ist
standardmäßig benutzbar, wenn der generische Kernel
<tt>(GENERIC)</tt> verwendet wird.

<dt><tt><i>syncdev</i></tt>
<dd>Der Name des physikalischen Interfaces, worüber pfsync die Updates
versendet.

<dt><tt><i>syncpeer</i></tt>
<dd>Dieser Parameter ist optional. Er gibt den Host an, an den Updates
als Unicast-Nachrichten versendet werden sollen. Standardmäßig werden
die Update-Nachrichten als Multicast-Nachricht an die Gruppe im lokalen
Netzwerk gesendet. Diese Option überschreibt das Verhalten und sendet
stattdessen das Update per Unicast-Nachricht an den angegebenen
<tt><i>syncpeer</i></tt>.
</dl>


<a name="pfsyncex"></a>
<h2>pfsync-Beispiel</h2>
Eine pfsync-Beispielkonfiguration.

<blockquote>
<tt>
# ifconfig pfsync0 syncdev em1<br>
</tt>
</blockquote>

Dies aktiviert pfsync auf dem <tt>em1</tt>-Interface. Ausgehender
Traffic wird via Multicast in das Netzwerk gesendet. Jeder Host, mit
aktiviertem pfsync, kann die Updates empfangen.

<a name="failover"></a>
<h2>Kombinieren von CARP und pfsync für Ausfallsicherheit und
Redundanz</h2>
Durch die Kombination der Fähigkeiten von CARP und pfsync lässt sich
eine Gruppe von 2 oder mehr Hosts zu einem Firewall-Cluster mit hoher
Verfügbarkeit und Redundanz erstellen.
<dl>
<dt>CARP:
<dd>Regelt automatisch die Ausfallsicherheit, indem ein anderer Host
seine Aufgabe bei einem Ausfall übernimmt.

<dt>pfsync:
<dd>Synchronisiert die Status-Tabellen zwischen allen Firewalls in einer
Gruppe. Wenn eine Firewall ausfallen sollte, kann der Netzwerkverkehr
ohne Unterbrechung über den neuen Firewall-Host laufen; der neue
Firewall-Host hat stets eine aktuelle Status-Tabelle und kann sofort
seine Arbeit verrichten.
</dl>

<p>
Ein Beispielszenario. Zwei Firewalls, <tt>fw1</tt> und <tt>fw2</tt>.

<pre>
         +------| WAN/Internet |------+
         |                            |
      em2|                            |em2
      +-----+                      +-----+
      | fw1 |-em1--------------em1-| fw2 |
      +-----+                      +-----+
      em0|                            |em0
         |                            |
      ---+--gemeinsam genutztes LAN---+---

</pre>

<p>
Die Firewalls sind über ein Crossover-Kabel miteinander über
<tt>em1</tt> verbunden. Beide sind an das LAN mit <tt>em0</tt> und an
das WAN, bzw. Internet, an <tt>em2</tt> angeschlossen.

Die IP-Adressen sind folgendermaßen vergeben:

<ul>
<li>fw1 em0: 172.16.0.1
<li>fw1 em1: 10.10.10.1

<li>fw1 em2: 192.0.2.1
<li>fw2 em0: 172.16.0.2
<li>fw2 em1: 10.10.10.2
<li>fw2 em2: 192.0.2.2
<li>LAN shared IP: 172.16.0.100
<li>WAN/Internet shared IP: 192.0.2.100
</ul>

<p>

Als Firewall-Master-Host wird <tt>fw1</tt> festgelegt.

<p>
Konfiguration von fw1:

<table border=0 width="650">
<tr><td nowrap bgcolor="#EEEEEE">

<pre>
! aktiviere Preemptivität und Ausfallsicherheit für Gruppeninterfaces
# sysctl -w net.inet.carp.preempt=1

! pfsync konfigurieren
# ifconfig em1 10.10.10.1 netmask 255.255.255.0
# ifconfig pfsync0 syncdev em1
# ifconfig pfsync0 up

! CARP auf dem LAN-Interface konfigurieren
# ifconfig carp1 create
# ifconfig carp1 vhid 1 carpdev em0 password lanpasswd \
     172.16.0.100 255.255.255.0

! CARP auf dem WAN-/Internet-Interface konfigurieren.
# ifconfig carp2 create
# ifconfig carp2 vhid 2 carpdev em2 password netpasswd \
    192.0.2.100 255.255.255.0
</pre>
</td></tr>
</table>

<p>
Konfiguration von fw2:

<table border=0 width="650">
<tr><td nowrap bgcolor="#EEEEEE">
<pre>
! aktiviere Preemptivität und Ausfallsicherheit für Gruppeninterfaces
# sysctl -w net.inet.carp.preempt=1

! pfsync konfigurieren
# ifconfig em1 10.10.10.2 netmask 255.255.255.0
# ifconfig pfsync0 syncdev em1
# ifconfig pfsync0 up

! CARP auf dem LAN-Interface konfigurieren
# ifconfig carp1 create
# ifconfig carp1 vhid 1 carpdev em0 password lanpasswd \
     advskew 128 172.16.0.100 255.255.255.0

! CARP auf dem WAN-/Internet-Interface konfigurieren.
# ifconfig carp2 create
# ifconfig carp2 vhid 2 carpdev em2 password netpasswd \
    advskew 128 192.0.2.100 255.255.255.0
</pre>
</td></tr>
</table>


<a name="ops"></a>
<h2>Weitere technische Möglichkeiten</h2>
Weitere technische Möglichkeiten im Umgang mit CARP und pfsync.

<a name="bootconfig"></a>
<h3>CARP und pfsync während des Bootvorgangs konfigurieren</h3>
Seitdem carp(4) und pfsync eine besondere Art Netzwerkinterface sind,
lassen sie sich während des Bootvorgangs konfigurieren, indem man für
sie eine
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=hostname.if&amp;sektion=5&amp;manpath=OpenBSD+3.7"
>hostname.if(5)</a>-Datei anlegt.
Das Skript
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=netstart&amp;sektion=8&amp;manpath=OpenBSD+3.7"
>netstart</a> wird während des Bootens dann anhand diesen Dateien die
Konfiguration durchführen.

<p>
Beispiele:

<dl>

<dt>/etc/hostname.carp1</dt>
<dd>
inet 172.16.0.100 255.255.255.0 172.16.0.255 vhid 1 carpdev em0 \<br>
&nbsp;&nbsp;&nbsp;&nbsp;password lanpasswd
</dd>
<br>
<dt>/etc/hostname.pfsync0</dt>
<dd>
up syncdev em1
</dd>
</dl>

<a name="forcefail"></a>
<h3>Ausfallsicherheit vom Master-Host testen</h3>
Es kann irgendwann die Zeit kommen, in der der Master-Host ausfällt,
bzw. sein Dienst vorrübergehend eingestellt werden muss. Dies kann
geschehen, wenn man den Master-Host warten muss oder ein Problem
besteht, welches zu beheben ist. Das Ziel ist es, den Master-Host von
seinem Dienst zu ,suspendieren', ohne dass der Netzwerkverkehr davon
beeinträchtigt wird. Dazu muss einer der Backup-Hosts den Dienst des
Master-Hosts übernehmen.

<p>
Um einen solchen Ausfall zu erzwingen, fahre das carp(4)-Interface auf
dem Master-Host herunter. Das führt dazu, dass der Master-Host sich
selber mit ,unendlich hohen' <tt>advbase</tt> und <tt>advskew</tt>
ankündigen wird. Der Backup-Host (oder einer davon) wird das ,merken'
und ab sofort die Rolle vom Master-Host übernehmen.

<blockquote>
<tt>
# ifconfig carp1 down
</tt>
</blockquote>


<a name="ref"></a>
<h2>Weitere Referenzen</h2>

Bitte folge den Links für weitere Informationen zu dem Thema.
<ul>
<li>
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=carp&amp;sektion=4&amp;manpath=OpenBSD+3.7"
>carp(4)</a>
<li>
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=pfsync&amp;sektion=4&amp;manpath=OpenBSD+3.7"
>pfsync(4)</a>
<li>
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=ifconfig&amp;sektion=8&amp;manpath=OpenBSD+3.7"
>ifconfig(8)</a>
<li>
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=hostname.if&amp;sektion=5&amp;manpath=OpenBSD+3.7"
>hostname.if(5)</a>
<li>
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=pf.conf&amp;sektion=5&amp;manpath=OpenBSD+3.7"
>pf.conf(5)</a>
</ul>


<p>
[<a href="authpf.html">Zurück: Authpf: Benutzer-Shell für
authentifizierende Gateways</a>]
[<a href="index.html">Inhalt</a>]
[<a href="example1.html">Weiter: Firewall für zuhause oder ein kleines
Büro</a>]

<p>
<hr>
<a href="index.html"><img height="24" width="24" src="../../../images/back.gif" border="0" alt="[zurück]"></a>
<a href="mailto:www@@openbsd.org">www@@openbsd.org</a>
<br>

<small>
<!--
Originally [OpenBSD: carp.html,v 1.5 ]
$Translation: carp.html,v 1.1 2005/08/03 15:57:44 paldium Exp $
-->
$OpenBSD$
</small>

</body>
</html>
@

