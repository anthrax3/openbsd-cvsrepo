head	1.14;
access;
symbols;
locks; strict;
comment	@# @;


1.14
date	2014.04.01.17.14.10;	author nick;	state dead;
branches;
next	1.13;

1.13
date	2011.03.13.07.16.15;	author ajacoutot;	state Exp;
branches;
next	1.12;

1.12
date	2004.09.03.04.45.58;	author jufi;	state Exp;
branches;
next	1.11;

1.11
date	2004.01.04.22.29.12;	author horacio;	state Exp;
branches;
next	1.10;

1.10
date	2003.12.03.21.40.56;	author horacio;	state Exp;
branches;
next	1.9;

1.9
date	2003.11.17.19.44.24;	author horacio;	state Exp;
branches;
next	1.8;

1.8
date	2003.09.28.10.01.03;	author horacio;	state Exp;
branches;
next	1.7;

1.7
date	2003.09.27.14.55.54;	author horacio;	state Exp;
branches;
next	1.6;

1.6
date	2003.09.20.07.00.26;	author horacio;	state Exp;
branches;
next	1.5;

1.5
date	2003.07.06.15.17.26;	author jufi;	state Exp;
branches;
next	1.4;

1.4
date	2003.06.21.11.27.36;	author jufi;	state Exp;
branches;
next	1.3;

1.3
date	2003.06.15.12.27.34;	author jufi;	state Exp;
branches;
next	1.2;

1.2
date	2003.06.05.14.47.49;	author jufi;	state Exp;
branches;
next	1.1;

1.1
date	2003.05.28.14.39.30;	author jufi;	state Exp;
branches;
next	;


desc
@@


1.14
log
@
Abandon translations, per deraadt@@ and ajacoutot@@.
@
text
@<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<html>
<head>
<title>PF: Traducción de Direcciones de Red (NAT)</title>
<link rev="made" href="mailto:www@@openbsd.org">
<meta http-equiv="Content-Type" content="text/html; charset=ISO-8859-1">
<meta name="resource-type" content="document">
<meta name="description"   content="the OpenBSD FAQ page">
<meta name="keywords"      content="openbsd,faq,pf">
<meta name="distribution"  content="global">
</head>

<!--
Copyright (c) 2003, Nick Holland <nick@@openbsd.org>
Copyright (c) 2003, 2004, Joel Knight <enabled@@myrealbox.com>

Permission to use, copy, modify, and distribute this documentation for
any purpose with or without fee is hereby granted, provided that the
above copyright notice and this permission notice appear in all copies.

THE DOCUMENTATION IS PROVIDED "AS IS" AND THE AUTHOR DISCLAIMS ALL
WARRANTIES WITH REGARD TO THIS DOCUMENTATION INCLUDING ALL IMPLIED
WARRANTIES OF MERCHANTABILITY AND FITNESS. IN NO EVENT SHALL THE
AUTHOR BE LIABLE FOR ANY SPECIAL, DIRECT, INDIRECT, OR CONSEQUENTIAL
DAMAGES OR ANY DAMAGES WHATSOEVER RESULTING FROM LOSS OF USE, DATA OR
PROFITS, WHETHER IN AN ACTION OF CONTRACT, NEGLIGENCE OR OTHER
TORTIOUS ACTION, ARISING OUT OF OR IN CONNECTION WITH THE USE OR
PERFORMANCE OF THIS DOCUMENTATION
-->

<body bgcolor="#ffffff" text="#000000">
<!-- Passes validator.w3.org, please keep it this way;
please, use a max of 72 chars per line -->

<a href="../../../es/index.html">
<img alt="[OpenBSD]" height="30" width="141" src="../../../images/smalltitle.gif" border="0">
</a>
<p>
[<a href="filter.html">Anterior: Filtrado de paquetes</a>]
[<a href="index.html">Contenido</a>]
[<a href="rdr.html">Siguiente: Redireccionamiento de tráfico (reenvío de puertos)</a>]

<p>
<h1><font color="#e00000">PF: Traducción de Direcciones de Red
(NAT)</font></h1>

<hr>

<h3>Índice de contenidos</h3>
<ul>
<li><a href="#intro">Introducción</a>
<li><a href="#works">Cómo Funciona NAT</a>
<li><a href="#ipfwd">Reenvío de paquetes IP</a> (<i>IP Forwarding</i>)
<li><a href="#config">Configuración de NAT</a>
<li><a href="#binat">Asignación bidireccional (asignación
1:1)</a>
<li><a href="#except">Excepciones a las reglas de traducción</a>
<li><a href="#status">Comprobación del estado de NAT</a>
</ul>

<hr>

<a name="intro"></a>
<h2>Introducción a NAT</h2>
<p>
La Traducción de Direcciones de Red, o NAT (<i>Network Address
Translation</i>), es un sistema que se utiliza para asignar una red
completa (o varias redes) a una sola dirección IP.  NAT es
necesario cuando la cantidad de direcciones IP que nos haya asignado
nuestro proveedor de Internet sea inferior a la cantidad de ordenadores
que queramos que accedan a Internet.  NAT se describe en el
<a href="http://www.geektools.com/rfc/rfc1631.txt">RFC 1631</a>,
"The IP Network Address Translator (NAT)".

<p>
NAT nos permite aprovechar los bloques de direcciones reservadas que se
describen en el
<a href="http://www.geektools.com/rfc/rfc1918.txt">RFC 1918</a>, 
"Address Allocation for Private Internets".
Generalmente, una red interna se suele configurar para que use uno o
más de estos bloques de red.  Estos bloques son:
<pre>
	10.0.0.0/8       (10.0.0.0 - 10.255.255.255)
	172.16.0.0/12    (172.16.0.0 - 172.31.255.255)
	192.168.0.0/16   (192.168.0.0 - 192.168.255.255)
</pre>

<p>
Un sistema OpenBSD configurado para NAT tendrá como mínimo
dos adaptadoras de red, una para Internet y la otra para la red interna.
NAT se encargará de traducir los requerimientos desde la red
interna, de modo que parezca que todos provienen del sistema OpenBSD en
el que se encuentra configurado NAT.

<a name="works"></a>
<h2>Cómo funciona NAT</h2>
<p>
Cuando un cliente en la red interna contacta con un máquina en
Internet, envía paquetes IP destinados a esa máquina.
Estos paquetes contienen toda la información de direccionamiento
necesaria para que puedan ser llevados a su destino.  NAT se encarga de
estas piezas de información:
<ul>
<li>Dirección IP de origen (por ejemplo, 192.168.1.35)
<li>Puerto TCP o UDP de origen (por ejemplo, 2132)
</ul>

<p>
Cuando los paquetes pasan a través de la pasarela de NAT, son
modificados para que parezca que se han originado y provienen de la
misma pasarela de NAT.  La pasarela de NAT registra los cambios que
realiza en su tabla de estado, para así poder: a) invertir los
cambios en los paquetes devueltos, y b) asegurarse de que los paquetes
devueltos pasen a través del cortafuegos y no sean bloqueados.
Por ejemplo, podrían ocurrir los siguientes cambios:
<ul>
<li>IP de origen: sustituida con la dirección externa de la
pasarela (por ejemplo, 24.5.0.5)
<li>Puerto de origen: sustituido con un puerto no en uso de la pasarela,
escogido aleatoriamente (por ejemplo, 53136)
</ul>

<p>
Ni la máquina interna ni el anfitrión de Internet se dan
cuenta de estos pasos de traducción.  Para la máquina
interna, el sistema NAT es simplemente una pasarela a Internet.  Para el
anfitrión de Internet, los paquetes parecen venir directamente
del sistema NAT;  ni siquiera se da cuenta de que existe la
estación interna.

<p>
Cuando el anfitrión de Internet responde a los paquetes internos
de la máquina, los direcciona a la IP externa de la pasarela de
NAT (24.5.0.5) y a su puerto de traducción (53136).  La pasarela
de NAT busca entonces en la tabla de estado para determinar si los
paquetes de respuesta concuerdan con alguna conexión establecida.
Entonces encontrará una única concordancia basada en la
combinación de la dirección IP y el puerto, y esto indica
a PF que los paquetes pertenecen a una conexión iniciada por la
máquina interna 192.168.1.35.  Acto seguido PF realiza los
cambios opuestos a los que realizó para los paquetes salientes, y
reenvía los paquetes de respuesta a la máquina interna.

<p>
La traducción de paquetes ICMP ocurre de forma parecida, pero sin
la modificación del puerto de origen.

<!-- legacy anchor; can eventually be removed -->
<a name="filter"></a>
<a name="enable"></a>
<a name="ipfwd"></a>
<h2>Reenvío de paquetes IP</h2>
<p>
Dado que NAT se utiliza casi siempre en los enrutadores y pasarelas de red, 
probablemente será necesario habilitar el reenvío de IP (<i>IP Forwarding</i>) 
para que los paquetes puedan viajar entre las interfaces de red de la máquina 
OpenBSD. El reenvío de IP se habilita mediante el mecanismo 
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=sysctl&amp;sektion=3"
>sysctl(3)</a>:

<blockquote>
<tt>
# sysctl net.inet.ip.forwarding=1<br>
# sysctl net.inet6.ip6.forwarding=1 <i>(if using IPv6)</i>
</tt>
</blockquote>

<p>
Para que este cambio sea permanente, hay que añadir las
siguientes líneas al fichero
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=sysctl.conf&amp;sektion=5"
><tt>/etc/sysctl.conf</tt></a>:
<blockquote>
<tt>
net.inet.ip.forwarding=1<br>
net.inet6.ip6.forwarding=1
</tt>
</blockquote>

<p>
Estas líneas ya existen en la instalación determinada,
pero como comentarios (prefijadas con <tt>#</tt>).  Hay que quitar el
signo <tt>#</tt> y guardar el fichero.  El reenvío de IP se
activará cuando se reinicie la máquina.

<a name="config"></a>
<h2>Configuración de NAT</h2>
<font color="#ff0000">NOTA:</font> Esta información es para OpenBSD 4.7.
La configuración de NAT era notablemente diferente en versiones anteriores.
<p>
NAT se especifica como un parámetro opcional <tt>nat-to</tt> 
por una regla de salida <tt>pass</tt>. 
A menudo, en lugar de establecer directamente la regla 
<tt>pass</tt>, se usa una regla <tt>match</tt>. 
Cuando un paquete es seleccionado por una regla <tt>match</tt>, 
los parámetros de dicha regla (por ejemplo, <tt>nat-to</tt>)  
se recuerdan y se aplican al paquete cuando se ve afectado por la 
regla <tt>match</tt> coincidente. 
Esto permite que toda una clase de paquetes 
sea manipulada por una sola regla <tt>match</tt> y
a continuación las decisiones específicas sobre la conveniencia de 
autorizar el tráfico se puede hacer con las reglas <tt>block</tt> y
<tt>pass</tt>.
<p>
El formato general para las reglas de NAT en <tt>/etc/pf.conf</tt> es
parecido al siguiente:
<blockquote>
<tt>
match out on <i>interface</i> [<i>af</i>] \<br>
&nbsp;&nbsp;&nbsp;from <i>src_addr</i> to <i>dst_addr</i> \<br>
&nbsp;&nbsp;&nbsp;nat-to <i>ext_addr</i> [<i>pool_type</i>] [static-port]<br>
...<br>
pass out [log] on <i>interface</i> [<i>af</i>] [proto <i>protocol]</i> \<br>
&nbsp;&nbsp;&nbsp;from <i>ext_addr</i> [port <i>src_port</i>] \<br>
&nbsp;&nbsp;&nbsp;to <i>dst_addr</i> [port <i>dst_port</i>]
</tt>
</blockquote>

<dl>
<dt><tt>match</tt>
<dd>Cuando un paquete atraviesa el conjunto de reglas 
y coincide con una regla <tt>match</tt>, todos los parámetros 
opcionales especificados en dicha regla se recuerdan para 
un uso futuro (se convierte en "adherente").

<dt><tt>pass</tt>
<dd>Esta regla permite que el paquete sea transmitido. 
Si el paquete previamente obtuvo una correspondencia 
con una regla <tt>match</tt> en el que los parámetros 
se han especificado, se aplicarán a este paquete. 
Las reglas <tt>pass</tt> pueden tener sus propios 
parámetros; estos tienen prioridad sobre los 
parámetros especificados en una regla <tt>match</tt>.

<dt><tt>out</tt>
<dd>Especifica la dirección del fujo del paquete donde se aplica 
esta regla. <tt>nat-to</tt> solo puede especificarse para paquetes
salientes.

<dt><tt>log</tt>
<dd>Los paquetes coincidentes se registran mediante
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=pflogd&amp;sektion=8&amp;manpath=OpenBSD+4.8"
>pflogd(8)</a>.
Normalmente solo se registra el primer paquete coincidente.
Para registrar todos los paquetes, use <tt>log (all)</tt>.

<dt><tt><i>interface</i></tt>
<dd>El nombre o grupo de la interfaz de red sobre la que
se transmiten los paquetes.

<dt><tt><i>af</i></tt>
<dd>La familia de direcciones, que será <tt>inet</tt> para IPv4
ó <tt>inet6</tt> para IPv6.  PF suele ser capaz de determinar
este parámetro basándose en la dirección (o
direcciones) de origen/destino.

<dt><tt><i>protocol</i></tt>
<dd>El protocolo (por ejemplo tcp, udp, icmp) de paquetes permitido.
Si se especifica <i>src_port</i> o <i>dst_port</i>, el protocolo
<em>must</em> también debe darse.

<dt><tt><i>src_addr</i></tt>
<dd>La dirección de origen (interna) de los paquetes que vayan a
ser traducidos.  La dirección de origen se puede especificar
como:
<ul>
<li>Una dirección IPv4 ó IPv6 única.
<li>Un bloque de red del esquema de &laquo;Enrutamiento de
Inter-Dominios sin Clases&raquo;
(<a href="http://public.pacbell.net/dedicated/cidr.html">CIDR</a>).
<li>Un &laquo;Nombre de Dominio Totalmente Cualificado&raquo; (FQDN) que
se resolverá por el &laquo;Servicio de Nombres de Dominio&raquo;
(DNS) cuando se cargue el grupo de reglas.  Todas las direcciones IP
resultantes se sustituirán dentro de la regla.
<li>El nombre o grupo de una interfaz de red.  
Cualquier dirección IP asignada a la interfaz será sustituida 
dentro de la regla cuando se carguen las reglas.
<li>El nombre de una interfaz de red seguida de una máscara de
red como sigue: <tt>/<i>netmask</i></tt> (por ejemplo <tt>/24</tt>).
Cada dirección IP en la interfaz se combina con la máscara
de red para formar un bloque de red CIDR que se sustituye dentro de la
regla.
<li>El nombre o grupo de una interfaz de red seguida de 
cualquiera de estos modificadores:
  <ul>
  <li><tt>:network</tt> - reemplaza a un bloque de red CIDR (ejemplo:
  192.168.0.0/24)
  <li><tt>:broadcast</tt> - reemplaza a la dirección de difusión de la red
  (ejemplo: 192.168.0.255)
  <li><tt>:peer</tt> - reemplaza a la dirección IP del otro extremo en una
  conexión punto a punto
  </ul>
  <dl>
  <dd>Además, el modificador <tt>:0</tt> puede ser añadido tanto al nombre/grupo 
  de la interfaz o a cualquiera de los modificadores anteriores para indicar que
  PF no debe incluir direcciones IP de alias en la sustitución.
  Estos modificadores también pueden usarse cuando la interfaz esté entre
  paréntesis.
  Ejemplo: <tt>fxp0:network:0</tt>
  </dl>
<li>Una <a href="tables.html">tabla</a>.
<li>Cualquiera de los anteriores en negación, usando el
modificador <tt>!</tt> (&quot;not&quot;).
<li>Un grupo de direcciones que usen una
<a href="macros.html#lists">lista</a>.
<li>La palabra-clave <tt>any</tt> para indicar todas las direcciones.
</ul>

<dt><tt><i>src_port</i></tt>
<dd>El puerto de origen en la capa 4 de la cabecera del paquete.
Los puertos se pueden especificar como:
<ul>
<li>Un número entre 1 y 65535
<li>Un nombre de servicio válido de
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=services&amp;sektion=5"
><tt>/etc/services</tt></a>
<li>Un grupo de puertos que usen una
<a href="macros.html#lists">lista</a>
<li>Un intervalo:
	<ul>
	<li><tt>!=</tt> (no es igual que)
	<li><tt>&lt;</tt> (menor que)
	<li><tt>&gt;</tt> (mayor que)
	<li><tt>&lt;=</tt> (menor o igual que)
	<li><tt>&gt;=</tt> (mayor o igual que)
	<li><tt>&gt;&lt;</tt> (intervalo)
	<li><tt>&lt;&gt;</tt> (intervalo inverso)
	<dl>
	<dd>Los dos últimos son operadores binarios (toman dos
	argumentos) y no incluyen los argumentos en el campo.
	</dl>
	<li><tt>:</tt> (intervalo inclusivo)
	<dl>
	<dd>El operador de intervalo inclusivo también es un operador binario
	e incluye el argumento en el intervalo.
	</dl>
	</ul>
</ul>
La opción <tt>port</tt> no se suele usar en las reglas de
<tt>nat</tt> por que el objetivo suele ser traducir las direcciones de
todo el tráfico sin tener en cuenta el puerto, o los puertos, que
se estén utilizando.

<dt><tt><i>dst_addr</i></tt>
<dd>La dirección de destino de los paquetes que hay que traducir.
La dirección de destino se especifica del mismo modo que la
dirección de origen.

<dt><tt><i>dst_port</i></tt>
<dd>El puerto de destino en la capa Layer 4 de la cabecera del paquete.
Este puerto se especifica del mismo modo que el puerto de origen.

<dt><tt><i>ext_addr</i></tt>
<dd>La dirección externa (la traducción) en la pasarela
NAT a la que se traducirán los paquetes.  La dirección
externa se puede especificar como:
<ul>
<li>Una dirección IPv4 o IPv6 única.
<li>Un bloque de red
<a href="http://public.pacbell.net/dedicated/cidr.html">CIDR</a>.
<li>Un &laquo;Nombre de Dominio Totalmente Cualificado&raquo; (FQDN) que
se resolverá por el &laquo;Servicio de Nombres de Dominio&raquo;
(DNS) cuando se cargue el grupo de reglas.
<li>El nombre de la interfaz de red externa.  Cualquier dirección
IP asignada a la interfaz será sustituida dentro de la regla
cuando se carguen las reglas.
<li>El nombre de la interfaz de red externa entre paréntesis.  De
este modo se instruye a PF para que actualice la regla si la
dirección, o direcciones, IP en dicha interfaz cambia.  Es de
gran utilidad cuando la interfaz externa obtiene su dirección IP
por medio de DHCP o de una conexión tipo <i>dial-up</i>, ya que
no hay que volver a cargar el grupo de reglas cada vez que cambie la
dirección.
<li>El nombre de una interfaz de red seguida por cualquiera de los siguientes
modificadores:
  <ul>
  <li><tt>:network</tt> - reemplaza al bloque de red CIDR (ejemplo:
  192.168.0.0/24)
  <li><tt>:peer</tt> - reemplaza a la dirección IP del extremo en una conexión
   punto a punto
  </ul>
  <dl>
  <dd>Además, el modificador <tt>:0</tt> puede ser añadido tanto al nombre de
  la interfaz o a cualquier de los modificadores anteriores para indicar a PF
  no debe incluir direcciones IP de alia en la expansión.
  Estos modificadores también pueden ser usados cuando la interfaz está
  encerrada entre paréntesis.
  Ejemplo: <tt>fxp0:network:0</tt>
  </dl>
<li>Un grupo de direcciones que usen una <a href="macros.html#lists">lista</a>.
</ul>

<dt><tt><i>pool_type</i></tt>
<dd>Especifica el tipo de <a href="pools.html">reserva de direcciones</a> 
a usar para la traducción.

<dt><tt>static-port</tt>
<dd>Informa a PF para no traducir el puerto origen en 
paquetes TCP y UDP.

</dl>

<p>
Esto nos llevaría a una forma muy básica de estas
líneas, que quedaría parecida a la siguiente:
<blockquote>
<tt>
match out on tl0 from 192.168.1.0/24 to any nat-to 24.5.0.5<br>
pass on tl0 from 192.168.1.0/24 to any
</tt>
</blockquote>
O se puede usar simplemente
<blockquote>
<tt>
pass out on tl0 from 192.168.1.0/24 to any nat-to 24.5.0.5
</tt>
</blockquote>

<p>
Esta regla indica que hay que realizar NAT en la interfaz <tt>tl0</tt>
para cualquier paquete que venga de 192.168.1.0/24, y sustituir la
dirección IP de origen con 24.5.0.5.

<p>
Aunque la regla anterior es correcta, la forma no es la recomendable.
El mantenimiento podría resultar difícil ya que cualquier
cambio de los números de la red externa o interna
requeriría que se cambiara la línea.  Cómparese con
la siguiente regla (<tt>tl0</tt> es externa y <tt>dc0</tt> interna), que
es más fácil de mantener:
<blockquote>
<tt>
pass out on tl0 from dc0:network to any nat-to tl0
</tt>
</blockquote>

<p>
La ventaja debería ser obvia:  podemos cambiar la
dirección IP de cualquiera de las interfaces sin cambiar esta
regla.

<p>
Cuando se especifica un nombre de interfaz para la dirección de
traducción, como en el ejemplo anterior, la dirección IP
se determina en el momento de <i>carga</i> de pf.conf, no sobre la
marcha.  Si se está usando DHCP para configurar la interfaz
externa, esto puede representar un problema, ya que si la
dirección IP asignada cambiara, entonces NAT seguiría
traduciendo los paquetes salientes usando la dirección IP
antigua.  Como resultado, las conexiones salientes dejarían de
funcionar.  Para evitarlo, se puede indicar a PF que actualice
automáticamente la dirección de traducción poniendo
entre paréntesis el nombre de la interfaz:
<blockquote>
<tt>
pass out on tl0 from dc0:network to any nat-to (tl0)
</tt>
</blockquote>

<p>
Este método funciona para traducir tanto direcciones IPv4 como IPv6.

<a name="binat"></a>
<h2>Asignación bidireccional (asignación 1:1)</h2>
<p>
Se puede establecer una asignación de tipo bidireccional usando
la regla <tt>binat-to</tt>.  
Una regla <tt>binat-to</tt> establece una
asignación de uno a uno entre la dirección IP interna y
la dirección externa.  Esto puede ser útil, por ejemplo,
para colocar un servidor web en la red interna con su propia
dirección IP externa.  Las conexiones desde Internet hacia la
dirección externa se traducirán a la dirección
interna, y las conexiones desde el servidor web (como las
peticiones DNS) se traducirán a la dirección
externa.  
Los puertos TCP y UDP nunca se modifican con las reglas
<tt>binat-to</tt> como se modifican con las reglas <tt>nat</tt>.

<p>
Ejemplo:
<blockquote>
<tt>
web_serv_int = "192.168.1.100"<br>
web_serv_ext = "24.5.0.6"<br>
<br>
pass on tl0 from $web_serv_int to any binat-to $web_serv_ext<br>
</tt>
</blockquote>

<a name="except"></a>
<h2>Excepciones a las reglas de traducción</h2>
<p>
Si se necesita traducir la mayoría del tráfico, 
pero incluyendo excepciones en algunos casos, 
asegúrese de que las excepciones son manejadas por una regla
de filtrado que no incluya el parámetro nat-to. 
Así, el ejemplo de NAT anterior se
modificaría del siguiente modo:

<blockquote>
<tt>
pass out on tl0 from 192.168.1.0/24 to any nat-to 24.2.74.79<br>
pass out on tl0 from 192.168.1.208 to any<br>
</tt>
</blockquote>

<p>
Y entonces los paquetes de toda la red 192.168.1.0/24 se
traducirían a la dirección externa 24.2.74.79, a
excepción de 192.168.1.208.

<a name="status"></a>
<h2>Comprobación del estado de NAT</h2>
<p>
Para ver las traducciones de NAT activas se usa
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=pfctl&amp;sektion=8&amp;manpath=OpenBSD+4.8"
>pfctl(8)</a>
con la opción y el argumento <tt>-s state</tt>.  Esta
opción muestra un listado de todas las sesiones de NAT actuales:

<pre>
   # pfctl -s state
   fxp0 TCP 192.168.1.35:2132 -&gt; 24.5.0.5:53136 -&gt; 65.42.33.245:22 TIME_WAIT:TIME_WAIT
   fxp0 UDP 192.168.1.35:2491 -&gt; 24.5.0.5:60527 -&gt; 24.2.68.33:53   MULTIPLE:SINGLE
</pre>

<p>
La explicación de esto (solo de la primera línea) es:

<dl>
<dt>fxp0
<dd>Indica la interfaz a la que está asociado el estado. Aparecerá la palabra
<tt>self</tt> si el estado es
<a href="options.html#state-policy"><tt>floating</tt></a>.
</dl>

<dl>
<dt>TCP
<dd>El protocolo que está usando la conexión.
</dl>

<dl>
<dt>192.168.1.35:2132
<dd>La dirección IP (192.168.1.35) de la máquina en la red
interna.  El puerto de origen (2132) se muestra después de la
dirección.  ésta también es la dirección que
se sustituye en la cabecera IP.
</dl>

<dl>
<dt>24.5.0.5:53136
<dd>La dirección IP (24.5.0.5) y el puerto (53136) en la pasarela
a la que se están traduciendo los paquetes.
</dl>

<dl>
<dt>65.42.33.245:22
<dd>La dirección IP (65.42.33.245) y el puerto (22) al que se
está conectando la máquina interna.
</dl>

<dl>

<dt>TIME_WAIT:TIME_WAIT
<dd>Indica el estado en el que PF cree que se encuentra la
conexión TCP.
</dl>

<p>
[<a href="filter.html">Anterior: Filtrado de paquetes</a>]
[<a href="index.html">Contenido</a>]
[<a href="rdr.html">Siguiente: Redireccionamiento de tráfico (reenvío de puertos)</a>]

<p>
<hr>
<a href="index.html"><img height="24" width="24" src="../../../images/back.gif" border="0" alt="[back]"></a> 
<a href="mailto:www@@openbsd.org">www@@openbsd.org</a>
<br>
<small>
<!--
Originally [OpenBSD: nat.html,v 1.34 ]<br>
$Translation: nat.html,v 1.14 2011/03/04 21:08:58 mvidal Exp $<br>
-->
$OpenBSD: nat.html,v 1.13 2011/03/13 07:16:15 ajacoutot Exp $
</small>

</body>
</html> 
@


1.13
log
@Sync with Steelix CVS
@
text
@d585 1
a585 1
$OpenBSD$
@


1.12
log
@Sync with Steelix CVS
@
text
@d4 1
a4 1
<title>PF: Traducci&oacute;n de Direcciones de Red (NAT)</title>
a6 1
<meta http-equiv="Content-Language" content="es">
d8 2
a9 2
<meta name="description"   content="Preguntas Frecuentes de OpenBSD">
<meta name="keywords"      content="openbsd,preguntas frecuentes,faq,pf">
d35 3
a37 1
<img alt="[OpenBSD]" height="30" width="141" src="../../../images/smalltitle.gif">
d41 1
a41 1
[<a href="rdr.html">Siguiente: Redireccionamiento de Tr&aacute;fico</a>]
d44 1
a44 1
<h1><font color="#e00000">PF: Traducci&oacute;n de Direcciones de Red
d49 1
a49 1
<h3>&Iacute;ndice de contenidos</h3>
d51 5
a55 5
<li><a href="#intro">Introducci&oacute;n</a>
<li><a href="#works">C&oacute;mo Funciona NAT</a>
<li><a href="#enable">Activaci&oacute;n de NAT</a>
<li><a href="#config">Configuraci&oacute;n de NAT</a>
<li><a href="#binat">Asignaci&oacute;n Bidireccional (Asignaci&oacute;n
d57 2
a58 2
<li><a href="#except">Excepciones a las Reglas de Traducci&oacute;n</a>
<li><a href="#status">Comprobaci&oacute;n del Estado de NAT</a>
d64 1
a64 1
<h2>Introducci&oacute;n a NAT</h2>
d66 1
a66 1
La Traducci&oacute;n de Direcciones de Red, o NAT (<i>Network Address
d68 1
a68 1
completa (o varias redes) a una sola direcci&oacute;n IP.  NAT es
d72 2
a73 1
<a href="http://www.geektools.com/rfc/rfc1631.txt">RFC 1631</a>.
d78 2
a79 1
<a href="http://www.geektools.com/rfc/rfc1918.txt">RFC 1918</a>.
d81 1
a81 1
m&aacute;s de estos bloques de red.  Estos bloques son:
d89 1
a89 1
Un sistema OpenBSD configurado para NAT tendr&aacute; como m&iacute;nimo
d91 1
a91 1
NAT se encargar&aacute; de traducir los requerimientos desde la red
d96 1
a96 1
<h2>C&oacute;mo Funciona NAT</h2>
d98 3
a100 3
Cuando un cliente en la red interna contacta con un m&aacute;quina en
Internet, env&iacute;a paquetes IP destinados a esa m&aacute;quina.
Estos paquetes contienen toda la informaci&oacute;n de direccionamiento
d102 1
a102 1
estas piezas de informaci&oacute;n:
d104 1
a104 1
<li>Direcci&oacute;n IP de origen (por ejemplo, 192.168.1.35)
d109 1
a109 1
Cuando los paquetes pasan a trav&eacute;s de la pasarela de NAT, son
d112 1
a112 1
realiza en su tabla de estado, para as&iacute; poder: a) invertir los
d114 2
a115 2
devueltos pasen a trav&eacute;s del cortafuegos y no sean bloqueados.
Por ejemplo, podr&iacute;an ocurrir los siguientes cambios:
d117 1
a117 1
<li>IP de origen: sustituida con la direcci&oacute;n externa de la
d124 2
a125 2
Ni la m&aacute;quina interna ni el anfitri&oacute;n de Internet se dan
cuenta de estos pasos de traducci&oacute;n.  Para la m&aacute;quina
d127 1
a127 1
anfitri&oacute;n de Internet, los paquetes parecen venir directamente
d129 1
a129 1
estaci&oacute;n interna.
d132 3
a134 3
Cuando el anfitri&oacute;n de Internet responde a los paquetes internos
de la m&aacute;quina, los direcciona a la IP externa de la pasarela de
NAT (24.5.0.5) y a su puerto de traducci&oacute;n (53136).  La pasarela
d136 7
a142 7
paquetes de respuesta concuerdan con alguna conexi&oacute;n establecida.
Entonces encontrar&aacute; una &uacute;nica concordancia basada en la
combinaci&oacute;n de la direcci&oacute;n IP y el puerto, y esto indica
a PF que los paquetes pertenecen a una conexi&oacute;n iniciada por la
m&aacute;quina interna 192.168.1.35.  Acto seguido PF realiza los
cambios opuestos a los que realiz&oacute; para los paquetes salientes, y
reenv&iacute;a los paquetes de respuesta a la m&aacute;quina interna.
d145 2
a146 2
La traducci&oacute;n de paquetes ICMP ocurre de forma parecida, pero sin
la modificaci&oacute;n del puerto de origen.
d148 2
d151 2
a152 1
<h2>Activaci&oacute;n de NAT</h2>
d154 7
a160 3
Para activar NAT en una pasarela de OpenBSD, adem&aacute;s de
<a href="config.html#activate">activar PF</a>, tambi&eacute;n hay que
activar el reenv&iacute;o de paquetes IP (<i>IP forwarding</i>):
d164 1
a164 1
# sysctl net.inet6.ip6.forwarding=1 <i>(si se usa IPv6)</i>
d169 4
a172 3
Para que este cambio sea permanente, hay que a&ntilde;adir las
siguientes l&iacute;neas al fichero
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=sysctl.conf&amp;sektion=5&amp;manpath=OpenBSD+3.5"><tt>/etc/sysctl.conf</tt></a>:
d181 1
a181 1
Estas l&iacute;neas ya existen en la instalaci&oacute;n determinada,
d183 2
a184 2
signo <tt>#</tt> y guardar el fichero.  El reenv&iacute;o de IP se
activar&aacute; cuando se reinicie la m&aacute;quina.
d187 17
a203 1
<h2>Configuraci&oacute;n de NAT</h2>
d209 7
a215 4
nat on <i>extif</i> [<i>af</i>] from <i>src_addr</i> 
[port <i>src_port</i>] to \<br>
&nbsp;&nbsp;&nbsp;<i>dst_addr</i> [port <i>dst_port</i>] -&gt; 
<i>ext_addr</i>
d220 30
a249 2
<dt><tt><i>extif</i></tt>
<dd>El nombre de la interfaz de red.
d252 3
a254 3
<dd>La familia de direcciones, que ser&aacute; <tt>inet</tt> para IPv4
&oacute; <tt>inet6</tt> para IPv6.  PF suele ser capaz de determinar
este par&aacute;metro bas&aacute;ndose en la direcci&oacute;n (o
d257 5
d263 2
a264 2
<dd>La direcci&oacute;n de origen (interna) de los paquetes que vayan a
ser traducidos.  La direcci&oacute;n de origen se puede especificar
d267 1
a267 1
<li>Una direcci&oacute;n IPv4 &oacute; IPv6 &uacute;nica.
d272 1
a272 1
se resolver&aacute; por el &laquo;Servicio de Nombres de Dominio&raquo;
d274 5
a278 5
resultantes se sustituir&aacute;n dentro de la regla.
<li>El nombre de una interfaz de red.  Cualquier direcci&oacute;n IP
asignada a la interfaz ser&aacute; sustituida dentro de la regla cuando
se carguen las reglas.
<li>El nombre de una interfaz de red seguida de una m&aacute;scara de
d280 1
a280 1
Cada direcci&oacute;n IP en la interfaz se combina con la m&aacute;scara
d283 2
a284 2
<li>El nombre de una interfaz de red seguida de cualquiera de estos
modificadores:
d286 1
a286 1
  <li><tt>:network</tt> - expande a un bloque de red CIDR (ejemplo:
d288 1
a288 1
  <li><tt>:broadcast</tt> - expande a la dirección de difusión de la red
d290 1
a290 1
  <li><tt>:peer</tt> - expande a la dirección IP del otro extremo en una
d294 4
a297 4
  <dd>Además, el modificador <tt>:0</tt> puede ser añadido tanto al nombre de
  la interfaz or a cualquier de los modificadores anteriores para indicar que
  PF no debe incluir direcciones IP de alias en la expansión.
  Estos modificadores también pueden ser usados cuando la interfaz esté enre
d302 1
a302 1
<li>Cualquiera de los anteriores en negaci&oacute;n, usando el
d306 1
a306 1
<li>La clave <tt>any</tt> para indicar todas las direcciones.
d310 1
a310 1
<dd>El puerto de origen en la capa Layer 4 de la cabecera del paquete.
d313 4
a316 3
<li>Un n&uacute;mero entre 1 y 65535
<li>Un nombre de servicio v&aacute;lido de
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=services&amp;sektion=5&amp;manpath=OpenBSD+3.5"><tt>/etc/services</tt></a>
d319 1
a319 1
<li>Un indicador de campo:
d329 1
a329 1
	<dd>Los dos &uacute;ltimos son operadores binarios (toman dos
d339 1
a339 1
La opci&oacute;n <tt>port</tt> no se suele usar en las reglas de
d341 2
a342 2
todo el tr&aacute;fico sin tener en cuenta el puerto, o los puertos, que
se est&eacute;n utilizando.
d345 3
a347 3
<dd>La direcci&oacute;n de destino de los paquetes que hay que traducir.
La direcci&oacute;n de destino se especifica del mismo modo que la
direcci&oacute;n de origen.
d354 2
a355 2
<dd>La direcci&oacute;n externa (la traducci&oacute;n) en la pasarela
NAT a la que se traducir&aacute;n los paquetes.  La direcci&oacute;n
d358 1
a358 1
<li>Una direcci&oacute;n IPv4 &oacute; IPv6 &uacute;nica.
d362 1
a362 1
se resolver&aacute; por el &laquo;Servicio de Nombres de Dominio&raquo;
d364 2
a365 2
<li>El nombre de la interfaz de red externa.  Cualquier direcci&oacute;n
IP asignada a la interfaz ser&aacute; sustituida dentro de la regla
d367 1
a367 1
<li>El nombre de la interfaz de red externa entre par&eacute;ntesis.  De
d369 3
a371 3
direcci&oacute;n, o direcciones, IP en dicha interfaz cambia.  Es de
gran utilidad cuando la interfaz externa obtiene su direcci&oacute;n IP
por medio de DHCP o de una conexi&oacute;n tipo <i>dial-up</i>, ya que
d373 1
a373 1
direcci&oacute;n.
d377 1
a377 1
  <li><tt>:network</tt> - expande al bloque de red CIDR (ejemplo:
d379 1
a379 1
  <li><tt>:peer</tt> - expande a la dirección IP del extremo en una conexión
d393 8
d404 2
a405 2
Esto nos llevar&iacute;a a una forma muy b&aacute;sica de la
l&iacute;nea, que quedar&iacute;a parecida a la siguiente:
d408 8
a415 1
nat on tl0 from 192.168.1.0:network to any -&gt; 24.5.0.5
d422 1
a422 1
direcci&oacute;n IP de origen con 24.5.0.5.
d426 3
a428 3
El mantenimiento podr&iacute;a resultar dif&iacute;cil ya que cualquier
cambio de los n&uacute;meros de la red externa o interna
requerir&iacute;a que se cambiara la l&iacute;nea.  C&oacute;mparese con
d430 1
a430 1
es m&aacute;s f&aacute;cil de mantener:
d433 1
a433 1
nat on tl0 from dc0:network to any -&gt; tl0
d438 2
a439 2
La ventaja deber&iacute;a ser obvia:  podemos cambiar la
direcci&oacute;n IP de cualquiera de las interfaces sin cambiar esta
d443 2
a444 2
Cuando se especifica un nombre de interfaz para la direcci&oacute;n de
traducci&oacute;n, como en el ejemplo anterior, la direcci&oacute;n IP
d446 1
a446 1
marcha.  Si se est&aacute; usando DHCP para configurar la interfaz
d448 3
a450 3
direcci&oacute;n IP asignada cambiara, entonces NAT seguir&iacute;a
traduciendo los paquetes salientes usando la direcci&oacute;n IP
antigua.  Como resultado, las conexiones salientes dejar&iacute;an de
d452 2
a453 2
autom&aacute;ticamente la direcci&oacute;n de traducci&oacute;n poniendo
entre par&eacute;ntesis el nombre de la interfaz:
d456 1
a456 1
nat on tl0 from dc0:network to any -&gt; (tl0)
d464 1
a464 1
<h2>Asignaci&oacute;n Bidireccional (asignaci&oacute;n 1:1)</h2>
d466 13
a478 11
Se puede establecer una asignaci&oacute;n de tipo bidireccional usando
la regla <tt>binat</tt>.  Una regla <tt>binat</tt> establece una
asignaci&oacute;n de uno por uno entre la direcci&oacute;n IP interna y
la direcci&oacute;n externa.  Esto puede ser &uacute;til, por ejemplo,
para colocar un servidor de <i>web</i> en la red interna con su propia
direcci&oacute;n IP externa.  Las conexiones desde Internet hacia la
direcci&oacute;n externa se traducir&aacute;n a la direcci&oacute;n
interna, y las conexiones desde el servidor de <i>web</i> (como los
requerimientos de DNS) se traducir&aacute;n a la direcci&oacute;n
externa.  Los puertos TCP y UDP nunca se modifican con las reglas
<tt>binat</tt> como se modifican con las reglas <tt>nat</tt>.
d487 1
a487 1
binat on tl0 from $web_serv_int to any -&gt; $web_serv_ext<br>
d492 1
a492 1
<h2>Excepciones a las Reglas de Traducci&oacute;n</h2>
d494 7
a500 3
Se pueden hacer excepciones a las reglas de traducci&oacute;n usando la
clave <tt>no</tt>.  As&iacute;, el ejemplo de NAT anterior se
modificar&iacute;a del siguiente modo:
d503 2
a504 2
no nat on tl0 from 192.168.1.10 to any<br>
nat on tl0 from 192.168.1.0/24 to any -&gt; 24.2.74.79
d510 2
a511 8
traducir&iacute;an a la direcci&oacute;n externa 24.2.74.79, a
excepci&oacute;n de 192.168.1.10.

<p>
N&oacute;tese que la primera regla que concuerde ser&aacute; la que se
aplique; si es una regla con la clave <tt>no</tt>, entonces el paquete
no se traducir&aacute;.  La clave <tt>no</tt> tambi&eacute;n se puede
usar con reglas <tt>binat</tt> y <a href="rdr.html"><tt>rdr</tt></a>.
d514 1
a514 1
<h2>Comprobaci&oacute;n del Estado de NAT</h2>
d517 4
a520 3
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=pfctl&amp;sektion=8&amp;manpath=OpenBSD+3.5">pfctl(8)</a>
con la opci&oacute;n y el argumento <tt>-s state</tt>.  Esta
opci&oacute;n muestra un listado de todas las sesiones de NAT actuales:
d529 1
a529 2
La explicaci&oacute;n de esto (s&oacute;lo de la primera l&iacute;nea)
es:
d540 1
a540 1
<dd>El protocolo que est&aacute; usando la conexi&oacute;n.
d545 3
a547 3
<dd>La direcci&oacute;n IP (192.168.1.35) de la m&aacute;quina en la red
interna.  El puerto de origen (2132) se muestra despu&eacute;s de la
direcci&oacute;n.  &Eacute;sta tambi&eacute;n es la direcci&oacute;n que
d553 2
a554 2
<dd>La direcci&oacute;n IP (24.5.0.5) y el puerto (53136) en la pasarela
a la que se est&aacute;n traduciendo los paquetes.
d559 2
a560 2
<dd>La direcci&oacute;n IP (65.42.33.245) y el puerto (22) al que se
est&aacute; conectando la m&aacute;quina interna.
d567 1
a567 1
conexi&oacute;n TCP.
d573 1
a573 1
[<a href="rdr.html">Siguiente: Redireccionamiento de Tr&aacute;fico</a>]
d577 1
a577 1
<a href="index.html"><img height="24" width="24" src="../../../images/back.gif" border="0" alt="[&Iacute;ndice]"></a> 
d581 5
a585 3
Originally [OpenBSD: nat.html,v 1.16 ]<br>
$OpenBSD$<br>
$Translation: nat.html,v 1.13 2004/09/03 00:56:19 santana Exp $
d587 1
@


1.11
log
@Sync with Steelix CVS
@
text
@a11 1
<meta name="copyright"     content="Este documento es copyright 2002-2004 de OpenBSD.">
d14 18
d153 2
a154 2
# sysctl -w net.inet.ip.forwarding=1<br>
# sysctl -w net.inet6.ip6.forwarding=1 <i>(si se usa IPv6)</i>
d161 1
a161 1
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=sysctl.conf&amp;sektion=5&amp;manpath=OpenBSD+3.4"><tt>/etc/sysctl.conf</tt></a>:
d220 18
a237 3
<li>El nombre de una interfaz de red seguido de la clave
<tt>:network</tt>.  La red CIDR resultante (por ejemplo 192.168.0.0/24)
ser&aacute; sustituida dentro de la regla cuando se carguen las reglas.
d252 1
a252 1
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=services&amp;sektion=5&amp;manpath=OpenBSD+3.4"><tt>/etc/services</tt></a>
d262 2
a263 3
	<li><tt>&gt;&lt;</tt> (dentro del campo... menor que y mayor que)
	<li><tt>&lt;&gt;</tt> (campo inverso)
	</ul>
d268 6
d310 17
a326 5
<li>El nombre de una interfaz de red seguido de la clave
<tt>:network</tt>.  La red CIDR resultante (por ejemplo 192.168.0.0/24)
ser&aacute; sustituida dentro de la regla cuando se carguen las reglas.
<li>Un grupo de direcciones que usen una
<a href="macros.html#lists">lista</a>.
d336 1
a336 1
nat on tl0 from 192.168.1.0/24 to any -&gt; 24.5.0.5
d354 1
a354 1
nat on tl0 from dc0/24 to any -&gt; tl0
d377 1
a377 1
nat on tl0 from dc0/24 to any -&gt; (tl0)
d382 1
a382 3
Esto tiene una limitaci&oacute;n importante:  cuando el nombre de la
interfaz va entre par&eacute;ntesis, s&oacute;lo se eval&uacute;a el
primer alias IP en una interfaz.
d438 1
a438 1
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=pfctl&amp;sektion=8&amp;manpath=OpenBSD+3.4">pfctl(8)</a>
d444 2
a445 2
   TCP 192.168.1.35:2132 -&gt; 24.5.0.5:53136 -&gt; 65.42.33.245:22 TIME_WAIT:TIME_WAIT
   UDP 192.168.1.35:2491 -&gt; 24.5.0.5:60527 -&gt; 24.2.68.33:53   MULTIPLE:SINGLE
d453 7
d502 1
a502 1
Originally [OpenBSD: nat.html,v 1.13 ]<br>
d504 1
a504 1
$Translation: nat.html,v 1.12 2004/01/04 21:32:07 horacio Exp $
@


1.10
log
@Sync with Steelix CVS
@
text
@d12 1
a12 1
<meta name="copyright"     content="Este documento es copyright 2002-2003 de OpenBSD.">
d448 1
a448 1
Originally [OpenBSD: nat.html,v 1.12 ]<br>
d450 1
a450 1
$Translation: nat.html,v 1.11 2003/12/02 15:35:11 horacio Exp $
@


1.9
log
@Sync with Steelix CVS
@
text
@d21 1
a21 1
[<a href="queueing.html">Anterior: Formaci&oacute;n de Colas</a>]
d438 1
a438 1
[<a href="queueing.html">Anterior: Formaci&oacute;n de Colas</a>]
d448 1
a448 1
Originally [OpenBSD: nat.html,v 1.11 ]<br>
d450 1
a450 1
$Translation: nat.html,v 1.10 2003/11/17 19:22:08 horacio Exp $
@


1.8
log
@sync with steelix cvs
@
text
@d144 1
a144 1
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=sysctl.conf&amp;sektion=5&amp;manpath=OpenBSD+3.3"><tt>/etc/sysctl.conf</tt></a>:
d220 1
a220 1
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=services&amp;sektion=5&amp;manpath=OpenBSD+3.3"><tt>/etc/services</tt></a>
d391 1
a391 1
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=pfctl&amp;sektion=8&amp;manpath=OpenBSD+3.3">pfctl(8)</a>
d448 1
a448 1
Originally [OpenBSD: nat.html,v 1.10 ]<br>
d450 1
a450 1
$Translation: nat.html,v 1.9 2003/09/27 22:39:26 horacio Exp $
@


1.7
log
@sync with steelix cvs
@
text
@d199 1
a199 1
red como sigue: <tt>/<i>netmask</tt></i> (por ejemplo <tt>/24</tt>).
d448 1
a448 1
Originally [OpenBSD: nat.html,v 1.9 ]<br>
d450 1
a450 1
$Translation: nat.html,v 1.8 2003/09/27 13:46:08 horacio Exp $
@


1.6
log
@sync with steelix cvs
@
text
@d199 1
a199 1
red como sigue: <i><tt>/netmask</tt></i> (por ejemplo <tt>/24</tt>).
d448 1
a448 1
Originally [OpenBSD: nat.html,v 1.8 2003/09/16 01:23:49 nick Exp ]<br>
d450 1
a450 1
$Translation: nat.html,v 1.7 2003/09/19 22:10:58 horacio Exp $
@


1.5
log
@sync with steelix translation CVS
@
text
@d448 1
a448 1
Originally [OpenBSD: nat.html,v 1.7 2003/06/16 22:17:00 david Exp ]<br>
d450 1
a450 1
$Translation: nat.html,v 1.6 2003/07/06 10:54:42 horacio Exp $
@


1.4
log
@sync with steelix translation CVS
@
text
@d37 1
a37 1
<li><a href="#binat">Asignaci&oacute;n Bidireccional (asignaci&oacute;n
d48 2
a49 1
NAT (<i>Network Address Translation</i>) es un modo para asignar una red
d51 1
a51 1
necesaria cuando la cantidad de direcciones IP que nos haya asignado
d57 1
a57 1
NAT nos permite aprovechar los bloques de direcciones reservados que se
d61 1
a61 1
m&aacute;s de estos bloques de red.  &Eacute;stos son:
d72 2
a73 2
interna, de modo que parezca que todos provienen del sistema OpenBSD que
tiene NAT configurado.
d89 7
a95 7
Cuando los paquetes pasan a trav&eacue;s de la pasarela de NAT, son
modificados para que parezca que vienen de la misma pasarela de NAT.  La
paserla de NAT registra los cambios que realiza en su tabla de estado,
para as&iacute; poder a) invertir los cambios en los paquetes devueltos,
y b) asegurarse de que los paquetes devueltos pasen a trav&eacute;s del
cortafuegos y no sean bloqueados.  Por ejemplo, podr&iacute;an ocurrir
los siguientes cambios:
d100 1
a100 1
escogido de forma aleatoria (por ejemplo, 53136)
d116 2
a117 2
paquetes de respuesta coinciden con alguna conexi&oacute;n establecida.
Encontrar&aacute; una &uacute;nica coincidencia basada en la
d120 2
a121 2
m&aacute;quina interna 192.168.1.35.  Entonces PF realiza los cambios
opuestos a los que realiz&oacute; para los paquetes salientes, y
d183 3
a185 3
<dd>La direcci&oacute;n de origen (interna) de los paquetes que
ser&aacute;n traducidos.  La direcci&oacute;n de origen se puede
especificar como:
d284 1
a284 1
l&iacute;nea parecida a la siguiente:
d292 1
a292 1
Esta reglas indica que hay que realizar NAT en la interfaz <tt>tl0</tt>
d300 3
a302 3
requerir&iacute;na que se cambiara la l&iacute;nea.  C&oacute;mparese
con la siguiente regla (<tt>tl0</tt> es externa y <tt>dc0</tt> interna),
que es m&aacute;s f&aacute;cil de mantener:
d311 2
a312 2
direcci&oacute;n IP de cualquier de las interfaces sin cambiar esta
reglas.
d319 7
a325 7
externa, esto puede representar un problema:  si la direcci&oacute;n IP
asignada cambia, entonces NAT seguir&aacute; traduciendo los paquetes
salientes usando la direcci&oacute;n IP antigua.  Como resultado, las
conexiones salientes dejar&aacute;n de funcionar.  Para evitarlo, se
puede indicar a PF que actualice autom&aacute;ticamente la
direcci&oacute;n de traducci&oacute;n poniendo entre par&eacute;ntesis
el nombre de la interfaz:
d344 1
a344 1
para proveer un servidor de <i>web</i> en la red interna con su propia
d364 1
a364 1
<h2>Excepciones a la Reglas de Traducci&oacute;n</h2>
d367 2
a368 2
clave <tt>no</tt>.  Por ejemplo, el ejemplo de NAT anterior se
modificar&iacute;a as&iacute;:
d378 1
a378 1
traducir&iacute;an a la direcci&oacute;n externa 24.2.74.79 a
d382 4
a385 4
N&oacute;tese que la primera regla que coincida ser&aacute; la que gane;
si es una regla <tt>no</tt>, entonces el paquete no se traducir&aacute;.
La clave <tt>no</tt> tambi&eacute;n se puede usar con reglas
<tt>binat</tt> y <a href="rdr.html"><tt>rdr</tt></a>.
d392 2
a393 2
con la opci&oacute;n <tt>-s state</tt>.  Esta opci&oacute;n muestra un
listado de todas las sesiones de NAT actuales:
d450 1
a450 1
$Translation: nat.html,v 1.5 2003/06/17 19:55:45 horacio Exp $
@


1.3
log
@sync with steelix translation CVS
@
text
@d240 1
a240 1
se est&aacute;n utilizando.
d447 1
a447 1
Originally [OpenBSD: nat.html,v 1.6 2003/06/13 02:54:08 nick Exp ]<br>
d449 1
a449 1
$Translation: nat.html,v 1.4 2003/06/15 11:40:23 horacio Exp $
@


1.2
log
@sync with steelix translation CVS
@
text
@d447 1
a447 1
Originally [OpenBSD: nat.html,v 1.5 2003/06/04 22:39:33 margarida Exp ]<br>
d449 1
a449 1
$Translation: nat.html,v 1.3 2003/06/05 13:19:56 horacio Exp $
@


1.1
log
@
initial translation from horacio
@
text
@d198 3
a200 3
red como sigue: <i><tt>/netmask</tt></i> (o sea, <tt>/24</tt>).  Cada
direcci&oacute;n IP en la interfaz se combina con la m&aacute;scara de
red para formar un bloque de red CIDR que se sustituye dentro de la
d203 1
a203 1
<tt>:network</tt>.  La red CIDR resultante (o sea 192.168.0.0/24)
d273 1
a273 1
<tt>:network</tt>.  La red CIDR resultante (o sea 192.168.0.0/24)
d447 1
a447 1
Originally [OpenBSD: nat.html,v 1.4 2003/05/25 01:35:07 nick Exp ]<br>
d449 1
a449 1
$Translation: nat.html,v 1.2 2003/05/26 09:12:05 horacio Exp $
@

