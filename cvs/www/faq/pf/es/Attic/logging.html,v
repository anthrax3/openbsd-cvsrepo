head	1.12;
access;
symbols;
locks; strict;
comment	@# @;


1.12
date	2014.04.01.17.14.10;	author nick;	state dead;
branches;
next	1.11;

1.11
date	2011.03.13.07.16.15;	author ajacoutot;	state Exp;
branches;
next	1.10;

1.10
date	2004.09.03.04.45.58;	author jufi;	state Exp;
branches;
next	1.9;

1.9
date	2004.01.04.22.29.12;	author horacio;	state Exp;
branches;
next	1.8;

1.8
date	2003.12.03.21.40.56;	author horacio;	state Exp;
branches;
next	1.7;

1.7
date	2003.11.17.19.44.24;	author horacio;	state Exp;
branches;
next	1.6;

1.6
date	2003.09.27.14.55.54;	author horacio;	state Exp;
branches;
next	1.5;

1.5
date	2003.09.20.07.00.26;	author horacio;	state Exp;
branches;
next	1.4;

1.4
date	2003.07.06.15.17.26;	author jufi;	state Exp;
branches;
next	1.3;

1.3
date	2003.07.04.22.43.46;	author jufi;	state Exp;
branches;
next	1.2;

1.2
date	2003.06.15.12.27.34;	author jufi;	state Exp;
branches;
next	1.1;

1.1
date	2003.05.28.14.39.30;	author jufi;	state Exp;
branches;
next	;


desc
@@


1.12
log
@
Abandon translations, per deraadt@@ and ajacoutot@@.
@
text
@<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<html>
<head>
<title>PF: Registros de bitácora</title>
<link rev="made" href="mailto:www@@openbsd.org">
<meta http-equiv="Content-Type" content="text/html; charset=ISO-8859-1">
<meta name="resource-type" content="document">
<meta name="description"   content="the OpenBSD FAQ page">
<meta name="keywords"      content="openbsd,faq,pf">
<meta name="distribution"  content="global">
</head>

<!--
Copyright (c) 2003, Nick Holland <nick@@openbsd.org>
Copyright (c) 2003-2007, Joel Knight <enabled@@myrealbox.com>

Permission to use, copy, modify, and distribute this documentation for
any purpose with or without fee is hereby granted, provided that the
above copyright notice and this permission notice appear in all copies.

THE DOCUMENTATION IS PROVIDED "AS IS" AND THE AUTHOR DISCLAIMS ALL
WARRANTIES WITH REGARD TO THIS DOCUMENTATION INCLUDING ALL IMPLIED
WARRANTIES OF MERCHANTABILITY AND FITNESS. IN NO EVENT SHALL THE
AUTHOR BE LIABLE FOR ANY SPECIAL, DIRECT, INDIRECT, OR CONSEQUENTIAL
DAMAGES OR ANY DAMAGES WHATSOEVER RESULTING FROM LOSS OF USE, DATA OR
PROFITS, WHETHER IN AN ACTION OF CONTRACT, NEGLIGENCE OR OTHER
TORTIOUS ACTION, ARISING OUT OF OR IN CONNECTION WITH THE USE OR
PERFORMANCE OF THIS DOCUMENTATION
-->

<body bgcolor="#ffffff" text="#000000">
<!-- Passes validator.w3.org, please keep it this way;
please, use a max of 72 chars per line -->

<a href="../../../es/index.html">
<img alt="[OpenBSD]" height="30" width="141"
src="../../../images/smalltitle.gif" border="0">
</a>
<p>
[<a href="tagging.html">Anterior: Marcado de
paquetes</a>]
[<a href="index.html">Contenido</a>]
[<a href="perf.html">Siguiente: Rendimiento</a>]

<p>
<h1><font color="#e00000">PF: Registros de bitácora</font></h1>

<hr>

<h3>Índice de contenidos</h3>
<ul>
<li><a href="#intro">Introducción</a>
<li><a href="#log">Registro de paquetes</a>
<li><a href="#logfile">Interpretación de un fichero de
registro</a>
<li><a href="#filter">Filtrado de la salida de registro</a>
<li><a href="#syslog">Registro de paquetes con syslog</a>
</ul>

<hr>

<a name="intro"></a>
<h2>Introducción</h2>
<p>
Cuando PF registra un paquete, se envía una copia de la cabecera del 
paquete a la interfaz <a href="http://www.openbsd.org/cgi-bin/man.cgi?query=pflog&amp;sektion=4&amp;manpath=OpenBSD+4.8"
>pflog(4)</a>, junto con algunos 
datos adicionales tales como la interfaz por la que 
ha transitado el paquete, la acción que PF adoptó (permitir o bloquear), etc. 
La interfaz pflog(4) permite que las aplicaciones en espacio de usuario 
reciban los datos de registro PF del núcleo. Si PF 
está activado cuando el sistema arranca, el demonio 
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=pflogd&amp;sektion=8&amp;manpath=OpenBSD+4.8"
>pflogd(8)</a> 
se inicia. De forma predeterminada pflogd(8) escucha en el interfaz 
<tt>pflog0</tt> y escribe todos los registros de bitácora en el fichero 
<tt>/var/log/pflog</tt>.

<a name="log"></a>
<h2>Registro de paquetes</h2>
<p>
Para registrar los paquetes que pasan a través de PF, debe usarse
la palabra-clave <tt>log</tt>. La palabra clave <tt>log</tt> hace 
que se registren todos los paquetes que concuerden con la regla. 
En el caso de que la regla <a href="filter.html#state">cree estado</a>, 
solo se registra el primer paquete visto (o el que hace que se cree el 
estado).

<p>
Las opciones que pueden pasarse a la palabra-clave <tt>log</tt> son:

<dl>
<dt><tt>all</tt>
<dd>Hace que todos los paquetes concordantes, no solo el paquete inicial,
serán registrados.
Útil para reglas que crean estado.

<dt><tt>to <i>pflogN</i></tt>
<dd>Hace que todos los paquetes concordantes sean registrados 
por la interfaz pflog(4) especificada. 
Por ejemplo, cuando se utiliza 
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=spamlogd&amp;sektion=8"
>spamlogd(8)</a> todo el tráfico SMTP puede ser registrado por PF
en una interfaz pflog(4) dedicada. El demonio spamlogd(8) puede
entonces ser configurado para que escuche en esa interfaz.  Esto permite
mantener a la bitácora de registro principal de PF libre de tráfico SMTP 
que no precisaría ser registrado. 
Utilice <a href="http://www.openbsd.org/cgi-bin/man.cgi?query=ifconfig&amp;sektion=8"
>ifconfig(8)</a> para crear interfaces pflog(4). 
La interfaz de registro predeterminado <tt>pflog0</tt> 
se crea automáticamente.

<dt><tt>user</tt>
<dd>Hace que el identificador de usuario y de grupo de UNIX al que pertenece 
el <i>socket</i> del origen/destino del paquete (cualquier <i>socket</i> 
local) sea registrado junto con la información de bitácora estándar.
</dl>

<p>
Las opciones se dan entre paréntesis después de la palabra-clave <tt>log</tt>; 
pueden pasarse varias opciones separadas por una coma o un espacio.

<blockquote>
<tt>
pass in log (all, to pflog1) on $ext_if inet proto tcp to $ext_if port 22 keep state
</tt>
</blockquote>


<a name="logfile"></a>
<h2>Interpretación de un fichero de registro</h2>
<p>
El fichero de registro grabado por pflogd se encuentra en formato
binario, y no se puede leer usando un editor de texto.  Hay que usar
tcpdump para ver el registro.

<p>
Para poder leer el fichero de registro:
<blockquote>
<tt>
# tcpdump -n -e -ttt -r /var/log/pflog
</tt>
</blockquote>

<p>
Nótese que el uso de tcpdump para leer el fichero pflog <i>no</i>
ofrece una visión en tiempo real.  Para obtener una visión
en tiempo real de los paquetes registrados, hay que usar la interfaz
<tt>pflog0</tt>:
<blockquote>
<tt>
# tcpdump -n -e -ttt -i pflog0
</tt>
</blockquote>

<p>
<font color="#e00000">NOTA: </font>
Cuando se examinan los registros, hay que tener un cuidado especial con
la descodificación verbosa del protocolo por parte de tcpdump
(activada mediante la opción <tt>-v</tt> en la línea de
órdenes).  Los descodificadores del protocolo de tcpdump no
tienen un historial de seguridad perfecto.  En teoría, existe la
posibilidad de un ataque retardado a través de las cargas
útiles (<i>payloads</i>) parciales de los paquetes registrados
por el dispositivo de registro.  En la práctica se recomienda
trasladar los ficheros de registro desde la máquina de
cortafuegos a otra máquina antes de examinarlos de esta forma.

<p>
También hay que tener un cuidado adicional al asegurar el acceso
a los registros.  pflogd registra 96 bytes del paquete en el fichero de
registro en el modo predeterminado.  El acceso a los registros
podría pemitir acceso parcial a cargas útiles de paquetes
sensibles (como los nombres de usuario y contraseñas de
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=telnet&amp;sektion=1"
>telnet(1)</a> o
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=ftp&amp;sektion=1"
>ftp(1)</a>).

<a name="filter"></a>
<h2>Filtrado de la salida de registro</h2>
<p>
Como pflogd efectúa los registros en formato binario de tcpdump,
se pueden usar todas las funcionalidades de tcpdump para revisar los
registros.  Por ejemplo, para ver solamente los paquetes que concuerden
con un cierto puerto:
<blockquote>
<tt>
# tcpdump -n -e -ttt -r /var/log/pflog port 80
</tt>
</blockquote>

<p>
Esto se puede refinar aún más limitando la cantidad de
paquetes que mostrará a los que concuerden con una
combinación de un cierto anfitrión y puerto:
<blockquote>
<tt>
# tcpdump -n -e -ttt -r /var/log/pflog port 80 and host 192.168.1.3
</tt>
</blockquote>

<p>
Se puede aplicar la misma idea cuando se lee desde la interfaz <tt>pflog0</tt>:
<blockquote>
<tt>
# tcpdump -n -e -ttt -i pflog0 host 192.168.4.2
</tt>
</blockquote>

<p>
Nótese que esto no tiene ningún impacto sobre qué
paquetes se registran en el fichero de registro de pflogd.  Las
órdenes anteriores sólo muestran los paquetes que
están siendo registrados en ese momento.

<p>
Además de usar las reglas de filtrado estándar de
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=tcpdump&amp;sektion=8"
>tcpdump(8)</a>, el lenguaje de filtrado de tcpdump se ha extendido 
para que pueda leer la salida de pflogd:
<ul>
<li><tt>ip</tt> - la familia de direcciones es IPv4.
<li><tt>ip6</tt> - la familia de direcciones es IPv6.
<li><tt>on <i>int</i></tt> - el paquete ha pasado por la interfaz
<i>int</i>.
<li><tt>ifname <i>int</i></tt> - lo mismo que <tt>on <i>int</i></tt>.
<li><tt>ruleset <i>name</i></tt> - el  
<a href="anchors.html">conjunto de reglas/anclaje</a> con el que concordó 
el paquete.
<li><tt>rulenum <i>num</i></tt> - la regla de filtrado con la que ha
concordado el paquete es la regla número <i>num</i>.
<li><tt>action <i>act</i></tt> - la acción que se ha tomado en el
paquete.  Las acciones pueden ser <tt>pass</tt> o <tt>block</tt>.
<li><tt>reason <i>res</i></tt> - el motivo por el que se ha tomado la
acción, <tt>action</tt>.  Los motivos pueden ser <tt>match</tt>, 
<tt>bad-offset</tt>, <tt>fragment</tt>, <tt>short</tt>, <tt>normalize</tt>,
<tt>memory</tt>, <tt>bad-timestamp</tt>,
<tt>congestion</tt>, <tt>ip-option</tt>, <tt>proto-cksum</tt>,
<tt>state-mismatch</tt>, <tt>state-insert</tt>, <tt>state-limit</tt>,
<tt>src-limit</tt> y <tt>synproxy</tt>.
<li><tt>inbound</tt> - el paquete era un paquete entrante.
<li><tt>outbound</tt> - el paquete era un paquete saliente.
</ul>

<p>
Ejemplo:
<blockquote>
<tt>
# tcpdump -n -e -ttt -i pflog0 inbound and action block and on wi0
</tt>
</blockquote>

<p>
Esto muestra el registro, en tiempo real, de los paquetes entrantes que
han sido bloqueados en la interfaz wi0.

<a name="syslog"></a>
<h2>Registro de paquetes con syslog</h2>
<p>
Hay muchas situaciones en las que es deseable tener los registros del
cortafuegos en formato ASCII (texto simple) y/o enviarlos a un servidor
de registros remoto.  Todo esto se puede conseguir con un
pequeño guión (<i>script</i>), algunos cambios 
menores en los ficheros de configuración de OpenBSD y 
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=syslogd&amp;sektion=8"
>syslogd(8)</a>, el servicio (demonio) de registro de bitácoras.
Syslogd realiza los registros en formato ASCII y también puede
efectuar los registros en un servidor de registros remoto.

<p>
Hay que crear el siguiente guión de ejecución:

<p>
<tt>/etc/pflogrotate</tt>
<pre>
	#!/bin/sh
	PFLOG=/var/log/pflog
	FILE=/var/log/pflog5min.$(date "+%Y%m%d%H%M")
	pkill -ALRM -u root -U root -t - -x pflogd
	if [ -r $PFLOG ] && [ $(stat -f %z $PFLOG) -gt 24 ]; then
	   mv $PFLOG $FILE
	   pkill -HUP -u root -U root -t - -x pflogd
	   tcpdump -n -e -ttt -r $FILE | logger -t pf -p local0.info
	   rm $FILE
	fi
</pre>

<p>
Editar la tarea de cron del usuario <i>root</i>:
<blockquote>
<tt>
# crontab -u root -e
</tt>
</blockquote>

<p>
Añadir las dos siguientes líneas:
<blockquote>
<tt>
# rotate pf log file every 5 minutes<br>
0-59/5 *       *       *       *       /bin/sh /etc/pflogrotate
</tt>
</blockquote>

<p>
Añadir la siguiente línea a <tt>/etc/syslog.conf</tt>:
<blockquote>
<tt>
local0.info &nbsp;&nbsp;&nbsp;&nbsp;/var/log/pflog.txt
</tt>
</blockquote>

<p>
Si también se quiere efectuar los registros en un servidor de
registros remoto, hay que añadir la línea:
<blockquote>
<tt>
local0.info &nbsp;&nbsp;&nbsp;&nbsp;@@syslogger
</tt>
</blockquote>

<p>
Hay que asegurarse de que el anfitrión <i>syslogger</i> se
encuentre definido en el fichero
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=hosts&amp;sektion=5"
>hosts(5)</a>.

<p>
Crear el fichero <tt>/var/log/pflog.txt</tt> para que syslog pueda
escribir registros en él y darle los mismos permisos que al fichero pflog:
<blockquote>
<tt>
# touch /var/log/pflog.txt<br>
# chmod 600 /var/log/pflog.txt
</tt>
</blockquote>

<p>
Para que syslogd tenga constancia de estos cambios hay que reiniciarlo:
<blockquote>
<tt>
# kill -HUP $(cat /var/run/syslog.pid)
</tt>
</blockquote>

<p>
Ahora todos los paquetes registrados son enviados a
<tt>/var/log/pflog.txt</tt>.  Si se añade la segunda
línea, también se envían al anfitrión de
registros remotos <i>syslogger</i>.

<p>
Ahora, el guión <tt>/etc/pflogrotate</tt> procesa y luego elimina
<tt>/var/log/pflog</tt>, de modo que ya no es necesaria la
rotación de <tt>pflog</tt> por
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=newsyslog&amp;sektion=8"
>newsyslog(8)</a>,
y debe ser desactivada.  Sin embargo, <tt>/var/log/pflog.txt</tt>
sustituye a <tt>/var/log/pflog</tt> y hay que activar su
rotación.  Para ello hay que realizar los siguientes cambios en
el fichero <tt>/etc/newsyslog.conf</tt>:
<pre>
    #/var/log/pflog       600    3    250    *    ZB "pkill -HUP -u root -U root -t - -x pflogd"
    /var/log/pflog.txt    600    7    *      24
</pre>

<p>
Ahora PF realizará los registros en formato ASCII en el fichero
<tt>/var/log/pflog.txt</tt>.  Y <tt>/etc/syslog.conf</tt> enviará
los registros a un servidor remoto si ha sido configurado para que lo
haga.  El registro no es inmediato, y puede tardar entre 5 y 6 minutos
(el intervalo de la tarea de cron) antes de que los paquetes registrados
aparezcan en el fichero.

<p>
[<a href="tagging.html">Anterior: Marcado de
paquetes</a>]
[<a href="index.html">Contenido</a>]
[<a href="perf.html">Siguiente: Rendimiento</a>]

<p>
<hr>
<a href="index.html"><img height="24" width="24"
src="../../../images/back.gif" border="0" alt="[back]"></a>
<a href="mailto:www@@openbsd.org">www@@openbsd.org</a>
<br>
<small>
<!--
Originally [OpenBSD: logging.html,v 1.42 ]<br>
$Translation: logging.html,v 1.13 2011/03/05 14:22:40 mvidal Exp $<br>
-->
$OpenBSD: logging.html,v 1.11 2011/03/13 07:16:15 ajacoutot Exp $
</small>

</body>
</html> 
@


1.11
log
@Sync with Steelix CVS
@
text
@d393 1
a393 1
$OpenBSD$
@


1.10
log
@Sync with Steelix CVS
@
text
@d4 1
a4 1
<title>PF: Registros de Bit&aacute;cora</title>
a6 1
<meta http-equiv="Content-Language" content="es">
d8 2
a9 2
<meta name="description"   content="Preguntas Frecuentes de OpenBSD">
<meta name="keywords"      content="openbsd,preguntas frecuentes,faq,pf">
d15 1
a15 1
Copyright (c) 2003, 2004, Joel Knight <enabled@@myrealbox.com>
d35 4
a38 1
<img alt="[OpenBSD]" height="30" width="141" src="../../../images/smalltitle.gif">
d40 1
a40 1
[<a href="tagging.html">Anterior: <i>Tagging:</i> Marcado de
d46 1
a46 1
<h1><font color="#e00000">PF: Registros de Bit&aacute;cora</font></h1>
d50 1
a50 1
<h3>&Iacute;ndice de Contenidos</h3>
d52 6
a57 5
<li><a href="#intro">Introducci&oacute;n</a>
<li><a href="#logfile">Interpretaci&oacute;n de un Fichero de
Registro</a>
<li><a href="#filter">Filtrado de la Salida de Registro</a>
<li><a href="#syslog">Registro de Paquetes con Syslog</a>
d63 1
a63 1
<h2>Introduction</h2>
d65 64
a128 10
El registro de paquetes en PF se realiza mediante
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=pflogd&amp;sektion=8&amp;manpath=OpenBSD+3.5">pflogd(8)</a>,
que est&aacute; a la escucha en la interfaz
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=pflog&amp;sektion=4&amp;manpath=OpenBSD+3.5">pflog0</a>
y graba los paquetes en un fichero de registro (generalmente
/var/log/pflog) en formato binario de
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=tcpdump&amp;sektion=8&amp;manpath=OpenBSD+3.5">tcpdump(8)</a>.
Las <a href="filter.html">Reglas de Filtrado</a> en las que se
especifican las claves <tt>log</tt> o <tt>log-all</tt> registran los
paquetes de este modo.
d131 1
a131 1
<h2>Interpretaci&oacute;n de un Fichero de Registro</h2>
d146 2
a147 2
N&oacute;tese que el uso de tcpdump para leer el fichero pflog <i>no</i>
ofrece una visi&oacute;n en tiempo real.  Para obtener una visi&oacute;n
d159 9
a167 9
la descodificaci&oacute;n verbosa del protocolo por parte de tcpdump
(activada mediante la opci&oacute;n <tt>-v</tt> en la l&iacute;nea de
&oacute;rdenes).  Los descodificadores del protocolo de tcpdump no
tienen un historial de seguridad perfecto.  En teor&iacute;a, existe la
posibilidad de un ataque retardado a trav&eacute;s de las cargas
&uacute;tiles (<i>payloads</i>) parciales de los paquetes registrados
por el dispositivo de registro.  En la pr&aacute;ctica se recomienda
trasladar los ficheros de registro desde la m&aacute;quina de
cortafuegos a otra m&aacute;quina antes de examinarlos de esta forma.
d170 1
a170 1
Tambi&eacute;n hay que tener un cuidado adicional al asegurar el acceso
d173 6
a178 4
podr&iacute;a pemitir acceso parcial a cargas &uacute;tiles de paquetes
sensibles (como los nombres de usuario y contrase&ntilde;as de
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=telnet&amp;sektion=1&amp;manpath=OpenBSD+3.5">telnet(1)</a> o
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=ftp&amp;sektion=1&amp;manpath=OpenBSD+3.5">ftp(1)</a>).
d181 1
a181 1
<h2>Filtrado de la Salida de Registro</h2>
d183 1
a183 1
Como pflogd efect&uacute;a los registros en formato binario de tcpdump,
d194 3
a196 3
Esto se puede refinar a&uacute;n m&aacute;s limitando la cantidad de
paquetes que mostrar&aacute; a los que concuerden con una
combinaci&oacute;n de un cierto anfitri&oacute;n y puerto:
d212 1
a212 1
N&oacute;tese que esto no tiene ning&uacute;n impacto sobre qu&eacute;
d214 2
a215 2
&oacute;rdenes anteriores s&oacute;lo muestran los paquetes que
est&aacute;n siendo registrados en ese momento.
d218 4
a221 3
Adem&aacute;s de usar las reglas de filtrado est&aacute;ndar de
tcpdump(8), el lenguaje de filtrado de tcpdump se ha extendido para que
pueda leer la salida de pflogd:
d228 3
d232 2
a233 2
concordado el paquete es la regla n&uacute;mero <i>num</i>.
<li><tt>action <i>act</i></tt> - la acci&oacute;n que se ha tomado en el
d236 6
a241 3
acci&oacute;n, <tt>action</tt>.  Los motivos pueden ser <tt>match</tt>,
<tt>bad-offset</tt>, <tt>fragment</tt>, <tt>short</tt>,
<tt>normalize</tt>, y <tt>memory</tt>.
d259 1
a259 1
<h2>Registro de Paquetes con Syslog</h2>
d263 6
a268 6
de registros remoto.  Todo esto se puede conseguir con dos
peque&ntilde;os guiones (<i>scripts</i>), algunos peque&ntilde;os
cambios de los ficheros de configuraci&oacute;n de OpenBSD, y el
d&aelig;mon de registro,
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=syslogd&amp;sektion=8&amp;manpath=OpenBSD+3.5">syslogd(8)</a>.
Syslogd realiza los registros en formato ASCII y tambi&eacute;n puede
d272 1
a272 8
Para ello, primero hay que crear un usuario, <tt>pflogger</tt>, con el
int&eacute;rprete (<i>shell</i>) <tt>/sbin/nologin</tt>.  La forma
m&aacute;s sencilla de crear este usuario es con
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=adduser&amp;sektion=8&amp;manpath=OpenBSD+3.5">adduser(8)</a>.

<p>
Despu&eacute;s de crear el usuario <tt>pflogger</tt>, hay que crear los
dos siguientes guiones de ejecuci&oacute;n:
d277 9
a285 6
	FILE=/home/pflogger/pflog5min.$(date &quot;+%Y%m%d%H%M&quot;)
	kill -ALRM $(cat /var/run/pflogd.pid)
	if [ $(ls -l /var/log/pflog | cut -d &quot; &quot; -f 8) -gt 24 ]; then
	   mv /var/log/pflog $FILE
	   chown pflogger $FILE
	   kill -HUP $(cat /var/run/pflogd.pid)
a289 9
<tt>/home/pflogger/pfl2sysl</tt>
<pre>
	for logfile in /home/pflogger/pflog5min* ; do
	   tcpdump -n -e -ttt -r $logfile | logger -t pf -p local0.info
	   rm $logfile
	done
</pre>

<p>
d298 1
a298 1
A&ntilde;adir las dos siguientes l&iacute;neas:
d307 1
a307 18
Crear una tarea de cron para el usuario <tt>pflogger</tt>:
<blockquote>
<tt>
# crontab -u pflogger -e
</tt>
</blockquote>

<p>
A&ntilde;adir las siguientes dos l&iacute;neas:
<blockquote>
<tt>
# feed rotated pflog file(s) to syslog<br>
0-59/5 *       *       *       *       /bin/sh /home/pflogger/pfl2sysl
</tt>
</blockquote>

<p>
A&ntilde;adir la siguiente l&iacute;nea a <tt>/etc/syslog.conf</tt>:
d315 2
a316 2
Si tambi&eacute;n se quiere efectuar los registros en un servidor de
registros remoto, hay que a&ntilde;adir la l&iacute;nea:
d324 1
a324 1
Hay que asegurarse de que el anfitri&oacute;n <i>syslogger</i> se
d326 2
a327 1
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=hosts&amp;sektion=5&amp;manpath=OpenBSD+3.5">hosts(5)</a>.
d331 1
a331 1
escribir registros en &eacute;l:
d334 2
a335 1
# touch /var/log/pflog.txt
d349 2
a350 2
<tt>/var/log/pflog.txt</tt>.  Si se a&ntilde;ade la segunda
l&iacute;nea, tambi&eacute;n se env&iacute;an al anfitri&oacute;n de
d354 1
a354 1
Ahora, el gui&oacute;n <tt>/etc/pflogrotate</tt> procesa y luego elimina
d356 3
a358 2
rotaci&oacute;n de <tt>pflog</tt> por
<a  href="http://www.openbsd.org/cgi-bin/man.cgi?query=newsyslog&amp;sektion=8&amp;manpath=OpenBSD+3.5">newsyslog(8)</a>,
d361 1
a361 1
rotaci&oacute;n.  Para ello hay que realizar los siguientes cambios en
d364 1
a364 1
    #/var/log/pflog       600    3    250    *    ZB /var/run/pflogd.pid
d369 2
a370 2
Ahora PF realizar&aacute; los registros en formato ASCII en el fichero
<tt>/var/log/pflog.txt</tt>.  Y <tt>/etc/syslog.conf</tt> enviar&aacute;
d377 1
a377 1
[<a href="tagging.html">Anterior: <i>Tagging:</i> Marcado de
d384 2
a385 1
<a href="index.html"><img height="24" width="24" src="../../../images/back.gif" border="0" alt="[&Iacute;ndice]"></a> 
d389 5
a393 3
Originally [OpenBSD: logging.html,v 1.15 ]<br>
$OpenBSD$<br>
$Translation: logging.html,v 1.12 2004/09/03 00:20:53 santana Exp $
d395 1
@


1.9
log
@Sync with Steelix CVS
@
text
@a11 1
<meta name="copyright"     content="Este documento es copyright 2003-2004 de OpenBSD.">
d14 18
d63 1
a63 1
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=pflogd&amp;sektion=8&amp;manpath=OpenBSD+3.4">pflogd(8)</a>,
d65 1
a65 1
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=pflog&amp;sektion=4&amp;manpath=OpenBSD+3.4">pflog0</a>
d68 1
a68 1
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=tcpdump&amp;sektion=8&amp;manpath=OpenBSD+3.4">tcpdump(8)</a>.
d92 1
a92 1
pflog0:
d118 2
a119 2
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=telnet&amp;sektion=1&amp;manpath=OpenBSD+3.4">telnet(1)</a> o
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=ftp&amp;sektion=1&amp;manpath=OpenBSD+3.4">ftp(1)</a>).
d145 1
a145 1
Se puede aplicar la misma idea cuando se lee desde la interfaz pflog0:
d201 1
a201 1
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=syslogd&amp;sektion=8&amp;manpath=OpenBSD+3.4">syslogd(8)</a>.
d209 1
a209 1
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=adduser&amp;sektion=8&amp;manpath=OpenBSD+3.4">adduser(8)</a>.
d290 1
a290 1
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=hosts&amp;sektion=5&amp;manpath=OpenBSD+3.4">hosts(5)</a>.
d319 1
a319 1
<a  href="http://www.openbsd.org/cgi-bin/man.cgi?query=newsyslog&amp;sektion=8&amp;manpath=OpenBSD+3.4">newsyslog(8)</a>,
d349 1
a349 1
Originally [OpenBSD: logging.html,v 1.13 ]<br>
d351 1
a351 1
$Translation: logging.html,v 1.11 2004/01/04 21:32:07 horacio Exp $
@


1.8
log
@Sync with Steelix CVS
@
text
@d12 1
a12 1
<meta name="copyright"     content="Este documento es copyright 2003 de OpenBSD.">
d276 9
d332 1
a332 1
Originally [OpenBSD: logging.html,v 1.11 ]<br>
d334 1
a334 1
$Translation: logging.html,v 1.10 2003/12/02 15:35:11 horacio Exp $
@


1.7
log
@Sync with Steelix CVS
@
text
@d21 2
a22 1
[<a href="filter.html">Anterior: Filtrado de Paquetes</a>]
d24 1
a24 2
[<a href="anchors.html">Siguiente: Anclajes y Grupos de Reglas con
Nombre</a>]
d312 2
a313 1
[<a href="filter.html">Anterior: Filtrado de Paquetes</a>]
d315 1
a315 2
[<a href="anchors.html">Siguiente: Anclajes y Grupos de Reglas con
Nombre</a>]
d323 1
a323 1
Originally [OpenBSD: logging.html,v 1.9 ]<br>
d325 1
a325 1
$Translation: logging.html,v 1.9 2003/11/17 19:22:08 horacio Exp $
@


1.6
log
@sync with steelix cvs
@
text
@d46 1
a46 1
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=pflogd&amp;sektion=8&amp;manpath=OpenBSD+3.3">pflogd(8)</a>,
d48 1
a48 1
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=pflog&amp;sektion=4&amp;manpath=OpenBSD+3.3">pflog0</a>
d51 1
a51 1
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=tcpdump&amp;sektion=8&amp;manpath=OpenBSD+3.3">tcpdump(8)</a>.
d101 2
a102 2
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=telnet&amp;sektion=1&amp;manpath=OpenBSD+3.3">telnet(1)</a> o
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=ftp&amp;sektion=1&amp;manpath=OpenBSD+3.3">ftp(1)</a>).
d184 1
a184 1
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=syslogd&amp;sektion=8&amp;manpath=OpenBSD+3.3">syslogd(8)</a>.
d192 1
a192 1
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=adduser&amp;sektion=8&amp;manpath=OpenBSD+3.3">adduser(8)</a>.
d273 1
a273 1
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=hosts&amp;sektion=5&amp;manpath=OpenBSD+3.3">hosts(5)</a>.
d293 1
a293 1
<a  href="http://www.openbsd.org/cgi-bin/man.cgi?query=newsyslog&amp;sektion=8&amp;manpath=OpenBSD+3.3">newsyslog(8)</a>,
d323 1
a323 1
Originally [OpenBSD: logging.html,v 1.8 ]<br>
d325 1
a325 1
$Translation: logging.html,v 1.8 2003/09/27 13:46:08 horacio Exp $
@


1.5
log
@sync with steelix cvs
@
text
@d59 3
a61 6
El fichero de registro grabado por
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=pflogd&amp;sektion=8&amp;manpath=OpenBSD+3.3">pflogd(8)</a>
se encuentra en formato binario, y no se puede leer usando un editor de
texto.  Hay que usar
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=tcpdump&amp;sektion=8&amp;manpath=OpenBSD+3.3">tcpdump(8)</a>
para ver el registro.
d72 4
a75 5
N&oacute;tese que el uso de
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=tcpdump&amp;sektion=8&amp;manpath=OpenBSD+3.3">tcpdump(8)</a>
para leer el fichero pflog <i>no</i> ofrece una visi&oacute;n en tiempo
real.  Para obtener una visi&oacute;n en tiempo real de los paquetes
registrados, hay que usar la interfaz pflog0:
d97 4
a100 6
a los registros.
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=pflogd&amp;sektion=8&amp;manpath=OpenBSD+3.3">pflogd</a>
registra 96 bytes del paquete en el fichero de registro en el modo
predeterminado.  El acceso a los registros podr&iacute;a pemitir acceso
parcial a cargas &uacute;tiles de paquetes sensibles (como los nombres
de usuario y contrase&ntilde;as de
d107 1
a107 4
Como
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=pflogd&amp;sektion=8&amp;manpath=OpenBSD+3.3">pflogd(8)</a>
efect&uacute;a los registros en formato binario de
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=tcpdump&amp;sektion=8&amp;manpath=OpenBSD+3.3">tcpdump(8)</a>,
d143 2
a144 3
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=tcpdump&amp;sektion=8&amp;manpath=OpenBSD+3.3">tcpdump(8)</a>,
el lenguaje de filtrado de tcpdump se ha extendido para que pueda leer
la salida de pflogd:
d185 1
a185 1
Syslogd(8) realiza los registros en formato ASCII y tambi&eacute;n puede
d257 1
a257 1
local0.info    /var/log/pflog.txt
d266 1
a266 1
local0.info    @@syslogger
d273 1
a273 1
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=hosts&amp;sektion=5&amp;manpath=OpenBSD+3.3">/etc/hosts(5)</a>.
d276 1
a276 2
Para que syslogd(8) tenga constancia de estos cambios hay que
reiniciarlo:
d298 4
a301 6
<blockquote>
<tt>
#/var/log/pflog       600    3    250    *    ZB /var/run/pflogd.pid<br>
/var/log/pflog.txt    600    7    *      24
</tt>
</blockquote>
d323 1
a323 1
Originally [OpenBSD: logging.html,v 1.7 2003/09/16 01:23:49 nick Exp ]<br>
d325 1
a325 1
$Translation: logging.html,v 1.7 2003/09/19 22:10:58 horacio Exp $
@


1.4
log
@sync with steelix translation CVS
@
text
@d336 1
a336 1
Originally [OpenBSD: logging.html,v 1.6 2003/07/03 14:01:08 nick Exp ]<br>
d338 1
a338 1
$Translation: logging.html,v 1.6 2003/07/06 10:54:42 horacio Exp $
@


1.3
log
@sync with steelix translation CVS
@
text
@d52 3
a54 3
Las <a href="filter.html">Reglas de Filtrado</a> que especifican en las
que se especifican las claves <tt>log</tt> o <tt>log-all</tt> registran
los paquetes de este modo.
d63 1
a63 1
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=tcpdump&amp;sektion=8&amp;manpath=OpenBSD+3.3">Tcpdump(8)</a>
d67 1
a67 1
Para ver el fichero de registro:
d77 1
a77 1
para mirar el fichero pflog <i>no</i> da una visi&oacute;n en tiempo
d89 2
a90 2
la descodificaci&oacute;n verbosa del protocolo por tcpdump (activada
mediante la opci&oacute;n <tt>-v</tt> en la l&iacute;nea de
d92 6
a97 7
tienen un historial de seguridad perfecto.  Por lo menos en
teor&iacute;a, existe la posibilidad de un ataque retardado a
trav&eacute;s de las cargas &uacute;tiles (<i>payloads</i>) parciales de
los paquetes registradas por el dispositivo de registro.  En la
pr&aacute;ctica se recomienda trasladar los ficheros de registro desde
la m&aacute;quina de cortafuegos a otra m&aacute;quina antes de
examinarlas de esta forma.
d104 1
a104 1
predeterminado.  El acceso a los registros podr&iacute;a proveer acceso
d118 1
a118 1
registros.  Por ejemplo, para ver solamente los paquetes que coinciden
d127 3
a129 3
Esto se puede refinar a&uacute;n m&aacute;s limitando los paquetes que
mostrar&aacute; a los que coincidan con una combinaci&oacute;n de un
cierto anfitri&oacute;n y puerto:
d146 1
a146 1
paquetes son registrados en el fichero de registro de pflogd.  Las
d162 1
a162 1
coincidido con el paquete es la regla n&uacute;mero <i>num</i>.
d273 1
a273 1
registros remoto, hay que a&ntilde;dir la l&iacute;nea:
d281 2
a282 2
Hay que asegurarse de que el anfitri&oacute;n <i>syslogger</i> haya sido
definido en el fichero
d297 2
a298 2
l&iacute;nea, tambi&eacute;n se envian al anfitri&oacute;n de registros
remotos <i>syslogger</i>.
d301 1
a301 1
El gui&oacute;n <tt>/etc/pflogrotate</tt> ahora procesa y luego elimina
d304 1
a304 1
<a  href="http://www.openbsd.org/cgi-bin/man.cgi?query=newsyslog&amp;sektion=8&amp;manpath=OpenBSD+3.3">newsyslog(8)</a>
d306 1
a306 1
sustituye a <tt>/var/log/pflog</tt>, y hay que activar su
d319 4
a322 4
los registros a un servidor remoto si se ha configurado para que lo haga
as&iacute;.  El registro no es inmediato, y puede tardar entre 5 y 6
minutos (el intervalo de la tarea de cron) antes de que los paquetes
registrados aparezcan en el fichero.
d338 1
a338 1
$Translation: logging.html,v 1.5 2003/07/04 22:12:49 horacio Exp $
@


1.2
log
@sync with steelix translation CVS
@
text
@d52 1
a52 1
Las <a name="filter.html">Reglas de Filtrado</a> que especifican en las
d88 11
a98 10
Cuando se examinan los registros propios, hay que tener un cuidado
especial con la decodificaci&oacute;n verbosa del protocolo por tcpdump
(activada mediante la opci&oacute;n <tt>-v</tt> en la l&iacute;nea de
&oacute;rdenes).  Los decodificadores del protocolo de tcpdump no tienen
un historial de seguridad perfecto.  Por lo menos en teor&iacute;a,
existe la posibilidad de un ataque retardado a trav&eacute;s de las
cargas &uacute;tiles (<i>payloads</i>) parciales de los paquetes
registradas por el dispositivo de registro.  En la pr&aacute;ctica se
recomienda trasladar los ficheros de registro desde la m&aacute;quina de
cortafuegos a otra m&aacute;quina antes de examinarlas de esta forma.
d305 1
a305 1
<a  href="http://www.openbsd.org/cgi-bin/man.cgi?query=newsyslog&amp;sektion=8&amp;manpath=OpenBSD+3.3">newsyslogd(8)</a>
d337 1
a337 1
Originally [OpenBSD: logging.html,v 1.4 2003/06/13 02:54:08 nick Exp ]<br>
d339 1
a339 1
$Translation: logging.html,v 1.3 2003/06/15 11:40:23 horacio Exp $
@


1.1
log
@
initial translation from horacio
@
text
@d336 1
a336 1
Originally [OpenBSD: logging.html,v 1.3 2003/05/15 03:03:54 nick Exp ]<br>
d338 1
a338 1
$Translation: logging.html,v 1.2 2003/05/26 09:12:05 horacio Exp $
@

