head	1.30;
access;
symbols;
locks; strict;
comment	@# @;


1.30
date	2017.05.21.23.16.04;	author tb;	state Exp;
branches;
next	1.29;
commitid	5CbNia6ar2kDGY9Q;

1.29
date	2016.09.08.03.41.47;	author tb;	state Exp;
branches;
next	1.28;
commitid	fehTct1T7rFIvOgE;

1.28
date	2016.08.15.02.22.14;	author tb;	state Exp;
branches;
next	1.27;
commitid	3DeixV5YkPOb78RN;

1.27
date	2016.08.04.00.36.35;	author tb;	state Exp;
branches;
next	1.26;
commitid	Ct90YakoD7MLgFTF;

1.26
date	2016.08.01.20.07.19;	author tb;	state Exp;
branches;
next	1.25;
commitid	ofD2d0niSxI5p36x;

1.25
date	2016.04.22.01.48.34;	author tb;	state Exp;
branches;
next	1.24;
commitid	ScAO1WtIOv6PY0I2;

1.24
date	2016.04.21.18.14.10;	author tb;	state Exp;
branches;
next	1.23;
commitid	eXdtW1hDhf3sU8D2;

1.23
date	2016.04.15.20.39.49;	author tb;	state Exp;
branches;
next	1.22;
commitid	jwteSMEb4rFzI8UA;

1.22
date	2016.04.09.22.55.45;	author tb;	state Exp;
branches;
next	1.21;
commitid	Wgx2QsAm21an230r;

1.21
date	2016.04.04.11.40.21;	author semarie;	state Exp;
branches;
next	1.20;
commitid	XOWNwemdWUKQ35if;

1.20
date	2016.03.30.15.05.31;	author tb;	state Exp;
branches;
next	1.19;
commitid	NiY8UeMcPJWEZyow;

1.19
date	2016.03.29.11.17.47;	author sthen;	state Exp;
branches;
next	1.18;
commitid	coqlNYvQHEuZp7dY;

1.18
date	2016.03.29.01.27.39;	author tb;	state Exp;
branches;
next	1.17;
commitid	4Y8oU6GBrSY1UOfW;

1.17
date	2016.03.28.03.25.53;	author tb;	state Exp;
branches;
next	1.16;
commitid	ovDK0UMEalyyhcVd;

1.16
date	2016.03.27.19.52.09;	author sthen;	state Exp;
branches;
next	1.15;
commitid	hi2ObFv9LGB98JY5;

1.15
date	2016.03.27.15.37.56;	author sthen;	state Exp;
branches;
next	1.14;
commitid	Cqal0pSN3CoGaBpV;

1.14
date	2016.03.27.14.03.47;	author tb;	state Exp;
branches;
next	1.13;
commitid	sOrfWjAhq0r2kcDZ;

1.13
date	2016.03.27.10.40.51;	author tb;	state Exp;
branches;
next	1.12;
commitid	dS0FLXs58TAKVon0;

1.12
date	2016.03.27.09.57.14;	author tb;	state Exp;
branches;
next	1.11;
commitid	d5mJwZyKCcWuNqkH;

1.11
date	2016.03.27.09.34.09;	author tb;	state Exp;
branches;
next	1.10;
commitid	d1cZ2965ba4noYIg;

1.10
date	2016.03.26.15.41.28;	author tb;	state Exp;
branches;
next	1.9;
commitid	NPUdO0YgctH5gt6O;

1.9
date	2016.03.26.15.22.05;	author tb;	state Exp;
branches;
next	1.8;
commitid	nx9vLrWoE0lC0Z3F;

1.8
date	2016.03.26.15.18.11;	author tb;	state Exp;
branches;
next	1.7;
commitid	DFRwX8OS4rSDk0VC;

1.7
date	2016.03.26.15.17.33;	author tb;	state Exp;
branches;
next	1.6;
commitid	40vDsZyucHfO5KBd;

1.6
date	2016.03.26.15.10.27;	author tb;	state Exp;
branches;
next	1.5;
commitid	DX2g8D9AF0g9RIIb;

1.5
date	2016.03.26.14.56.51;	author tb;	state Exp;
branches;
next	1.4;
commitid	mziVPdTdSdN8s0yC;

1.4
date	2016.03.26.14.51.46;	author tb;	state Exp;
branches;
next	1.3;
commitid	IDeDoY3th5HvdQoC;

1.3
date	2016.03.26.13.44.45;	author sthen;	state Exp;
branches;
next	1.2;
commitid	AgCpoo1d6nkugGjX;

1.2
date	2016.03.26.13.37.48;	author tb;	state Exp;
branches;
next	1.1;
commitid	YpiIudhSQqeIfjcS;

1.1
date	2016.03.26.13.27.07;	author tb;	state Exp;
branches;
next	;
commitid	TkB93V5nqbswDS7b;


desc
@@


1.30
log
@remove redundant css
@
text
@<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<html>
<head>
<title>OpenBSD Upgrade Guide: 5.8 to 5.9</title>
<meta http-equiv="Content-Type" content="text/html; charset=ISO-8859-1">
<meta name="description"   content="OpenBSD Upgrade Process for 5.8 -> 5.9">
<meta name="copyright"     content="This document copyright 2016 by OpenBSD">
<meta name="viewport"      content="width=device-width, initial-scale=1">
<link rel="stylesheet"     type="text/css" href="../openbsd.css">
<link rel="canonical"      href="https://www.openbsd.org/faq/upgrade59.html">
<style type="text/css">
  ul { list-style: none; }
</style>
</head>

<body bgcolor="#ffffff" text="#000000">

<h2>
<a href="../index.html">
<font color="#0000ff"><i>Open</i></font><font color="#000084">BSD</font></a>
<font color="#e00000">Upgrade Guide: 5.8 to 5.9</font>
</h2>
<hr>
<p>
<a href="index.html">[FAQ Index]</a> |
<a href="upgrade58.html">[5.7 -> 5.8]</a>
<a href="upgrade60.html">[5.9 -> 6.0]</a>
<p>

<blockquote><i>
Note: Upgrades are only supported from one release to the release immediately
following it. </i>
<p>
<i>
It is highly recommended that you read through and fully understand this process
before attempting it.
Especially for critical or physically remote machines, it is recommended that
you test it on an identical, local system first.
</i></blockquote>

Boot from the install kernel, <a href="faq4.html#bsd.rd">bsd.rd</a>.
This can be done by booting from an
<a href="https://openbsdstore.com/">install CD</a>, or other
<a href="faq4.html#MkInsMedia">bootable install media</a>.
Alternatively, you can place the 5.9 version of <tt>bsd.rd</tt> in the root of
your file system and instruct the boot loader to boot this kernel instead
of your usual kernel -- on amd64 and i386:
<tt>boot&gt; <b>boot bsd.rd</b></tt>

<p>
Once this kernel is booted, choose the <tt>(U)pgrade</tt> option and follow the
prompts.
The upgrade process retains all your configuration info.
If you absolutely have to, you can follow the
<a href="#NoInstKern">manual upgrade process</a> instead.

<p>
Final steps:
<ol>
  <li id="sysmerge">
    Run <a href="http://man.openbsd.org/sysmerge">sysmerge(8)</a>
    as root: <tt># <b>sysmerge</b></tt>
    <p>
    The <a href="http://man.openbsd.org/sysmerge">sysmerge(8)</a>
    utility will compare the files that are currently on your system with
    those that would be installed in a fresh install.
    It will assist you in merging the changes into your system, using
    <a href="http://man.openbsd.org/sdiff">sdiff(1)</a>.
    <p>
    The section on <a href="#ConfigChanges">configuration changes</a> lists
    some important cases that need extra care.
  <li>
    <a href="#RmFiles">Remove some files</a>.
    <p>
  <li id="pkg_add-u">
    Upgrade your packages using
    <a href="http://man.openbsd.org/pkg_add">pkg_add(1)</a>:
    <tt># <b>pkg_add -u</b></tt>
    <p>
    In many cases, that will be all you need to do.
    Check the <a href="#SpecPkg">section below</a> to see if any of your
    installed packages require workarounds to upgrade.
</ol>

<hr>

<h3 id="ConfigChanges">Configuration changes</h3>

<ul>
  <li><b><a href="http://man.openbsd.org/ntpd.conf">ntpd.conf(5)</a>:</b>
    The <tt>rtable</tt> option was removed from <tt>server</tt> and
    <tt>servers</tt>.
    Users of <tt>server * rtable X</tt> will need to switch to launching
    ntpd with
    <blockquote><pre>
    # <b>route -T X exec /usr/sbin/ntpd</b>
    </pre></blockquote>

  <li><b><a href="http://man.openbsd.org/pf.conf">pf.conf(5)</a>:</b>
    <tt>set debug</tt> no longer accepts the <tt>none</tt>, <tt>urgent</tt>,
    <tt>misc</tt> and <tt>loud</tt> arguments, which were deprecated several
    releases ago.
    Use <tt>emerg</tt>, <tt>alert</tt>, <tt>crit</tt>, <tt>err</tt>,
    <tt>warning</tt>, <tt>notice</tt>, <tt>info</tt> or <tt>debug</tt> instead.
    Change this before updating, or your pf.conf will not load.

  <p>
  <li><b><a href="http://man.openbsd.org/smtpd.conf">
    smtpd.conf(5)</a>:</b>
    The <tt>pki</tt> keyword no longer accepts a <tt>ca</tt> parameter.
    Custom CA certificates must be declared using the new <tt>ca</tt> keyword:
    <blockquote><pre>
    ca mail.example.org certificate "/etc/mail/CA.pem"
    </pre></blockquote>

  <li><b><a href="http://man.openbsd.org/netstart">netstart(8)</a>:</b>
    Options <tt>multicast_host</tt> and <tt>multicast_router</tt> have been
    merged into a single <tt>multicast</tt> option.
    In order to enable multicast the following line should be added in
    <a href="http://man.openbsd.org/rc.conf.local">rc.conf.local(8)</a>:
    <blockquote><pre>
    multicast=YES
    </pre></blockquote>
    If you previously set these options to something other than <tt>YES</tt> or
    the interface carrying the default route, you will also need to add a static
    route for <tt>224.0.0.0/4</tt>.

  <p>
  <li><b><a href="http://man.openbsd.org/tun">tun(4)</a>:</b>
    This was previously a "dual mode" device.
    By default it would act as a layer-3 "routed" device, but by use
    of the <tt>link0</tt> flag it would change to a layer-2 "ethernet" mode.
    This layer-2 mode has now been has been split off to a separate
    <a href="http://man.openbsd.org/tap">tap(4)</a>
    device.
    <p>
    For some use cases (e.g. ssh tunnel-forwarding run as a non-root user),
    permissions on the device nodes would have been modified; these should
    be applied to the new device nodes as necessary.
    <tt>hostname.tun*</tt> files using the <tt>link0</tt> flag should be moved
    to <tt>hostname.tap*</tt> instead, and the flag should be removed.
    Other configuration may need to be adjusted to use the new device
    name, for example for software like QEMU, OpenVPN or SIMH.
    Networking configuration (bridges, PF) referring to these devices
    may also need to change.
</ul>

<h3 id="RmFiles">Files to delete</h3>

<blockquote><pre>
rm -f /usr/libexec/smtpd/makemap

# People requiring these backends should install the opensmtpd-extras main package.
rm -f /usr/libexec/smtpd/table-ldap
rm -f /usr/libexec/smtpd/table-passwd
rm -f /usr/libexec/smtpd/table-sqlite
rm -f /usr/share/man/man5/table_passwd.5

rm -f /usr/share/misc/termcap.db /usr/share/misc/terminfo.db

rm -f /usr/X11R6/include/intel_*.h
rm -f /usr/X11R6/include/r600_pci_ids.h
rm -f /usr/X11R6/include/radeon_*.h

rm -f /usr/include/malloc.h

rm -f /usr/libexec/auth/login_tis
rm -f /etc/rc.d/yppasswdd /usr/sbin/rpc.yppasswdd

cd /usr/X11R6/include/freetype2
rm -rf config
rm -f freetype.h ftadvanc.h ftbbox.h ftbdf.h ftbitmap.h ftbzip2.h \
          ftcache.h ftcffdrv.h ftchapters.h ftcid.h fterrdef.h \
          fterrors.h ftfntfmt.h ftgasp.h ftglyph.h ftgxval.h ftgzip.h \
          ftimage.h ftincrem.h ftlcdfil.h ftlist.h ftlzw.h ftmac.h \
          ftmm.h ftmodapi.h ftmoderr.h ftotval.h ftoutln.h ftpfr.h \
          ftrender.h ftsizes.h ftsnames.h ftstroke.h ftsynth.h \
          ftsystem.h fttrigon.h fttypes.h ftwinfnt.h t1tables.h \
          ttnameid.h tttables.h tttags.h ttunpat.h
</pre></blockquote>

<h3 id="SpecPkg">Special packages</h3>

<ul>
  <li><b>php-fpm:</b>
    To allow installing multiple versions of php-fpm on the same system,
    the rc script has been renamed to include the version number.
    Modify references to <tt>php_fpm</tt> in
    <tt>/etc/rc.conf.local</tt> to e.g. <tt>php56_fpm</tt>.
  <p><li><b>gophernicus:</b>
    <tt>in.gophernicus</tt> moved from <tt>/usr/local/sbin/</tt> to
    <tt>/usr/local/libexec</tt>.
    Update your <tt>/etc/inetd.conf</tt> accordingly.
  <p>
  <li><b>puppetboard:</b>
    The default configuration file (<tt>default_settings.py</tt>) format has
    changed and needs to be merged with <tt>default_settings.py.dist</tt>
    before restarting the <tt>puppetboard</tt> service.
  <p>
  <li><b>cfs:</b>
    The security/cfs port has been removed.
    Users are encouraged to use another data encryption method.
    Possible alternatives are:
    softraid(4) crypto, encrypted vnd(4) devices or the security/encfs port.
    Delete the package with <tt># <b>pkg_delete cfs</b></tt>
  <p>
  <li>
    <b>node modules:</b>
    All modules for lang/node have been removed in favor of directly using npm.
    Native modules need to be built with <tt>-std=gnu++0x</tt>, so npm
    internally sets <tt>CXX=eg++</tt> when building native modules.
    To remove any installed modules:
    <blockquote><pre>
    for i in node-always node-async node-bcrypt node-bindings \
            node-buffer-writer node-canvas node-cloned node-daemon \
            node-expresso node-fibers node-generic-pool node-gir \
            node-java node-mnm node-pg node-rmdir node-sqlite3 \
            node-syslog node-typescript coffeescript;
            do
                    pkg_delete $i
            done
    </pre></blockquote>
</ul>

<hr>
<h2 id="NoInstKern">Upgrade without the install kernel</h2>

<b style="color:e00000">This is NOT the recommended process.
Use the install kernel method if at all possible!</b>

<p>
Sometimes, you need to do an upgrade of a machine for which the normal upgrade
process is not possible.
The most common case is a machine in a remote location and there is no easy
access to the system console.

<h3>Preparation</h3>

<ul>
  <li><b>Place install files in a good location.</b>
    Make sure you have sufficient space!
    Running out of space on a remote upgrade could be...unfortunate.
    Note that using softdeps can exaggerate the situation as deleted and
    overwritten files do not release their space immediately.
    Consider disabling the <tt>softdep</tt> mount option in <tt>/etc/fstab</tt>
    and rebooting before undertaking a manual upgrade.
    Having at least 200MB free on <tt>/usr</tt> would be recommended.

  <p>
  <li><b>Becoming root.</b>
    While using
    <a href="http://man.openbsd.org/doas">doas(1)</a>
    before each command is generally a good practice, the command will likely
    be broken by the last steps, so you should become root before starting
    this process.
    It might be good to verify your access to root using a method other than
    doas at this point, i.e., direct login or using
    <a href="http://man.openbsd.org/su">su(1)</a>.

  <p>
  <li><b>Stop and/or disable any appropriate applications.</b>
    During this process, all the userland applications will be replaced but
    may not be runnable, and strange things may happen as a result.
    You may also have issues with DNS resolution during the first reboot, so
    PF rules and NFS mounts dependent upon DNS may cause boot-up problems.
    There may be other applications which you wish to keep from running
    immediately after the upgrade, stop and disable them as well.

  <p>
  <li><b>Install new boot blocks.</b>
    This should actually be done at the end of any upgrade.
    If this has been neglected, then failure to do this now may break serial
    console or other things, depending on your platform.
    Use <a href="http://man.openbsd.org/OpenBSD-5.9/i386/installboot">
    installboot(8)</a>,
    assuming <tt>sd0</tt> is your boot disk:

    <blockquote><pre>
    <b>installboot -v sd0</b>
    </pre></blockquote>
</ul>

<h3>Upgrading manually</h3>

<ul>
  <li><b>Install new kernels.</b>
    The extra steps for copying over the primary kernel are done
    to ensure that there is always a valid kernel on the disk.
    <p>
    If using the multiprocessor kernel:
    <blockquote><pre>
    <b>cd /usr/rel</b>    # where you put the release files
    <b>ln -f /bsd /obsd && cp bsd.mp /nbsd && mv /nbsd /bsd</b>
    <b>cp bsd.rd /</b>
    <b>cp bsd /bsd.sp</b>
    </pre></blockquote>
    If using the single processor kernel:
    <blockquote><pre>
    <b>cd /usr/rel</b>    # where you put the release files
    <b>ln -f /bsd /obsd && cp bsd /nbsd && mv /nbsd /bsd</b>
    <b>cp bsd.rd bsd.mp /</b>    # may give a harmless warning
    </pre></blockquote>

  <p>
  <li><b>Install new userland.</b>
    Save a copy of reboot(8), extract and install the release tarballs, reboot.
    Install <tt>base59.tgz</tt> last, because the new base system, in particular
    <a href="http://man.openbsd.org/tar">tar(1)</a> and
    <a href="http://man.openbsd.org/reboot">reboot(8)</a>,
    will not work with the old kernel.

    <blockquote><pre>
    <b>cp /sbin/reboot /sbin/oreboot</b>
    <b>tar -C / -xzphf xserv59.tgz</b>
    <b>tar -C / -xzphf xfont59.tgz</b>
    <b>tar -C / -xzphf xshare59.tgz</b>
    <b>tar -C / -xzphf xbase59.tgz</b>
    <b>tar -C / -xzphf game59.tgz</b>
    <b>tar -C / -xzphf comp59.tgz</b>
    <b>tar -C / -xzphf man59.tgz</b>
    <b>tar -C / -xzphf base59.tgz</b>    # Install last!
    <b>/sbin/oreboot</b>
    </pre></blockquote>

  <p>
  <li><b>After reboot, upgrade <tt>/dev</tt>.</b>
    Run
    <a href="http://man.openbsd.org/OpenBSD-5.9/i386/MAKEDEV">
    MAKEDEV(8)</a>:
    <blockquote><pre>
    <b>cd /dev</b>
    <b>./MAKEDEV all</b>
    </pre></blockquote>

  <li><b>Upgrade boot loader.</b>
    Still assuming <tt>sd0</tt> is your boot disk:
    <blockquote><pre>
    <b>installboot -v sd0</b>
    </pre></blockquote>

  <li><b><a href="#sysmerge">Run sysmerge</a>.</b>
    Now is a good time to do
    <blockquote><pre>
    <b>sysmerge</b>
    </pre></blockquote>

  <li><b>Upgrade firmware.</b>
    There may be new firmware for your system.
    Update it with
    <a href="http://man.openbsd.org/fw_update">fw_update(1)</a>:
    <blockquote><pre>
    <b>fw_update -v</b>
    </pre></blockquote>

  <li><b>Finish up.</b>
    Review the console output from boot (using <tt><b>dmesg -s</b></tt>)
    and correct any failures as necessary.
    Proceed by <a href="#RmFiles">removing some files</a> -- don't forget
    <tt>/sbin/oreboot</tt> -- and <a href="#pkg_add-u">upgrading packages</a>.
</ul>

<p>
<a href="index.html">[FAQ Index]</a> |
<a href="upgrade58.html">[5.7 -> 5.8]</a>
<a href="upgrade60.html">[5.9 -> 6.0]</a>

<p>
<hr>
<br>
<small>$OpenBSD: upgrade59.html,v 1.29 2016/09/08 03:41:47 tb Exp $</small>

</body>
</html>
@


1.29
log
@zap remnants of the removed script hackery
@
text
@a11 1
  tt { white-space: pre; }
d370 1
a370 1
<small>$OpenBSD: upgrade59.html,v 1.28 2016/08/15 02:22:14 tb Exp $</small>
@


1.28
log
@tls on openbsd.org is now real:
- link to https://www.openbsd.org from the sub-projects' pages
- make internal links relative
- switch link rel=canonical to https to please some search engines
"go ahead" from beck, "do it!!!!" tj
@
text
@a11 2
  .hidden  { display: none; }
  .visible { display: block; }
d371 1
a371 1
<small>$OpenBSD: upgrade59.html,v 1.27 2016/08/04 00:36:35 tb Exp $</small>
@


1.27
log
@hook up upgrade60.html
@
text
@d10 1
a10 1
<link rel="canonical"      href="http://www.openbsd.org/faq/upgrade59.html">
d373 1
a373 1
<small>$OpenBSD: upgrade59.html,v 1.26 2016/08/01 20:07:19 tb Exp $</small>
@


1.26
log
@minor fixes found while working on upgrade60.html
@
text
@d30 1
d368 1
d373 1
a373 1
<small>$OpenBSD: upgrade59.html,v 1.25 2016/04/22 01:48:34 tb Exp $</small>
@


1.25
log
@more cleanup after javascript removal
@
text
@d46 1
a46 2
<a href="http://www.openbsd.org/faq/faq4.html#MkInsMedia">
bootable install media</a>.
d57 1
a57 2
<a href="#NoInstKern" onclick="javascript:flip_visibility('NoInstKern')">
manual upgrade process</a> instead.
d228 1
a228 1
<h2 id="NoInstKern">Upgrade without the Install Kernel</h2>
a298 1
    <p>
a369 1
<a href="index.html"><img height="24" width="24" src="../images/back.gif" border="0" alt="[back]"></a>
d371 1
a371 1
<small>$OpenBSD: upgrade59.html,v 1.24 2016/04/21 18:14:10 tb Exp $</small>
@


1.24
log
@kill pointless javascript. it's broken.
bug reported by daniel shahaf, thanks!
@
text
@a228 3
<a href="#NoInstKern" onclick="javascript:flip_visibility('NoInstKern')">
Show manual upgrade process</a>
<div id="NoInstKern" class="visible">
d230 1
a230 1
<h2>Upgrade without the Install Kernel</h2>
a366 5
<a href="#NoInstKern" onclick="javascript:flip_visibility('NoInstKern')">
Hide manual upgrade process</a>

</div>

d375 1
a375 1
<small>$OpenBSD: upgrade59.html,v 1.23 2016/04/15 20:39:49 tb Exp $</small>
@


1.23
log
@use short form man links in the faq and fix a few broken links
@
text
@a16 18
<script type="text/javascript">
function onload() {
    var hide = [ 'NoInstKern' ];

    for (id = 0; id < hide.length; id++) {
        var item = document.getElementById(hide[id]);
        if (item) {
            item.className = 'hidden';
        }
    }
}
function flip_visibility(id) {
    var item = document.getElementById(id);
    if (item) {
        item.className = (item.className === 'hidden') ? 'visible' : 'hidden';
    }
}
</script>
d19 1
a19 1
<body bgcolor="#ffffff" text="#000000" onload="javascript:onload();">
d383 1
a383 1
<small>$OpenBSD: upgrade59.html,v 1.22 2016/04/09 22:55:45 tb Exp $</small>
@


1.22
log
@more css surgery, metadata and other cleanup, validation fixes.
@
text
@d83 1
a83 1
    Run <a href="http://man.openbsd.org/?query=sysmerge">sysmerge(8)</a>
d86 1
a86 1
    The <a href="http://man.openbsd.org/?query=sysmerge">sysmerge(8)</a>
d90 1
a90 1
    <a href="http://man.openbsd.org/?query=sdiff">sdiff(1)</a>.
d99 1
a99 1
    <a href="http://man.openbsd.org/?query=pkg_add">pkg_add(1)</a>:
d112 1
a112 1
  <li><b><a href="http://man.openbsd.org/?query=ntpd.conf">ntpd.conf(5)</a>:</b>
d121 1
a121 1
  <li><b><a href="http://man.openbsd.org/?query=pf.conf">pf.conf(5)</a>:</b>
d130 1
a130 1
  <li><b><a href="http://man.openbsd.org/?query=smtpd.conf">
d138 1
a138 1
  <li><b><a href="http://man.openbsd.org/?query=netstart">netstart(8)</a>:</b>
d142 1
a142 1
    <a href="http://man.openbsd.org/?query=rc.conf.local">rc.conf.local(8)</a>:
d151 1
a151 1
  <li><b><a href="http://man.openbsd.org/?query=tun">tun(4)</a>:</b>
d156 1
a156 1
    <a href="http://man.openbsd.org/?query=tap">tap(4)</a>
d277 1
a277 1
    <a href="http://man.openbsd.org/?query=doas">doas(1)</a>
d283 1
a283 1
    <a href="http://man.openbsd.org/?query=su">su(1)</a>.
d299 1
a299 1
    Use <a href="http://man.openbsd.org/?query=installboot&amp;arch=i386">
d334 2
a335 2
    <a href="http://man.openbsd.org/?query=tar">tar(1)</a> and
    <a href="http://man.openbsd.org/?query=reboot">reboot(8)</a>,
d354 1
a354 1
    <a href="http://man.openbsd.org/?query=MAKEDEV&amp;arch=i386">
d376 1
a376 1
    <a href="http://man.openbsd.org/?query=fw_update">fw_update(1)</a>:
d401 1
a401 1
<small>$OpenBSD: upgrade59.html,v 1.21 2016/04/04 11:40:21 semarie Exp $</small>
@


1.21
log
@adds removed programs that could operate on credentials on cleanup list.
adds also malloc.h per sthen@@ request.

ok sthen@@ benno@@
@
text
@d46 2
a47 2
<a href="upgrade58.html">[5.7 -> 5.8]</a> |
<a href="index.html">[FAQ Index]</a>
d394 2
a395 5

<font color="#0000e0">
<a href="upgrade58.html">[5.7 -> 5.8]</a> |
<a href="index.html">[FAQ Index]</a>
</font>
d401 1
a401 1
<small>$OpenBSD: upgrade59.html,v 1.20 2016/03/30 15:05:31 tb Exp $</small>
@


1.20
log
@Add back single processor kernel case. Useful for copy-pasting.
Requested by Kapetanakis Giannis.
@
text
@d187 5
d404 1
a404 1
<small>$OpenBSD: upgrade59.html,v 1.19 2016/03/29 11:17:47 sthen Exp $</small>
@


1.19
log
@reinstate <body onload>
@
text
@d309 2
d317 7
d399 1
a399 1
<small>$OpenBSD: upgrade59.html,v 1.18 2016/03/29 01:27:39 tb Exp $</small>
@


1.18
log
@new openbsd faq style. joint with tj and validator.w3.org
@
text
@d37 1
a37 1
<body bgcolor= "#ffffff" text= "#000000">
d390 1
a390 1
<small>$OpenBSD: upgrade59.html,v 1.17 2016/03/28 03:25:53 tb Exp $</small>
@


1.17
log
@don't satisfy yourself. just review the output from dmesg -s
@
text
@d10 1
a10 1

d35 1
d37 1
a37 2
<link rel="canonical" href="http://www.openbsd.org/faq/upgrade58.html">
</head>
d39 1
a39 1
<body bgcolor="#ffffff" text="#000000" onload="javascript:onload();">
d41 4
a44 2
<img alt="[OpenBSD]" height=30 width=141 src="../images/smalltitle.gif" border="0">
</a>
a45 1
<font color="#0000e0">
d48 1
a48 3
</font>

<h1 style="color:#e00000">Upgrade Guide: 5.8 to 5.9</h1>
d390 1
a390 1
<small>$OpenBSD: upgrade59.html,v 1.16 2016/03/27 19:52:09 sthen Exp $</small>
@


1.16
log
@add a small sprinkling of css to improve readability in the faq, ok tj@@ tb@@
@
text
@a368 3
    Satisfy yourself that you have a working system, e.g.
    by rebooting once more and working through
    <a href="http://man.openbsd.org/?query=afterboot">afterboot(8)</a>.
d391 1
a391 1
<small>$OpenBSD: upgrade59.html,v 1.15 2016/03/27 15:37:56 sthen Exp $</small>
@


1.15
log
@5.7->5.8 -> 5.8->5.9
@
text
@d8 2
d394 1
a394 1
<small>$OpenBSD: upgrade59.html,v 1.14 2016/03/27 14:03:47 tb Exp $</small>
@


1.14
log
@two simple css tweaks:
avoid line wrapping inside tt tags and declare the ul style
once globally instead of three times locally
@
text
@d4 1
a4 1
<title>OpenBSD Upgrade Guide: 5.7 to 5.8</title>
d6 2
a7 2
<meta name="description"   content="OpenBSD Upgrade Process for 5.7 -> 5.8">
<meta name="copyright"     content="This document copyright 2015 by OpenBSD">
d392 1
a392 1
<small>$OpenBSD: upgrade59.html,v 1.13 2016/03/27 10:40:51 tb Exp $</small>
@


1.13
log
@more polishing:
- one, we, you -> you or imperative
- zap some more extra words
- reduce the amount of bold
@
text
@d12 2
d110 1
a110 1
<ul style="list-style-type: none">
d200 1
a200 1
<ul style="list-style-type: none">
a255 1
<p>
d257 2
a258 1
<ul style="list-style-type: none">
d304 1
a304 1
<ul style="list-style-type: none">
d392 1
a392 1
<small>$OpenBSD: upgrade59.html,v 1.12 2016/03/27 09:57:14 tb Exp $</small>
@


1.12
log
@We give orders, we don't ask politely.
@
text
@d249 4
a252 5
Sometimes, one needs to do an upgrade of a machine when one can't easily
use the normal upgrade process.
The most common case is when the machine is in a remote location and you
don't have easy access to the system console.
One can usually do this by carefully following this process:
d257 1
a257 1
  <li><b>Place install files in a "good" location.</b>
d288 3
a290 4
    This should actually be done at the end of any upgrade, but we will
    assume this has been neglected.
    Failure to do this may break serial console or other things, depending
    on your platform.
d305 1
a305 1
    to ensure that there is always a valid copy of the kernel on the disk.
d314 3
a316 3
  <li><b>Save a copy of reboot(8), install new userland applications.</b>
    Note that we are installing <tt>base59.tgz</tt> last, because the
    new base system, in particular
d335 2
a336 2
  <li><b>After reboot completes, upgrade <tt>/dev</tt>.</b>
    The new
d338 1
a338 3
    MAKEDEV</a>
    script was copied to <tt>/dev</tt> by the installation of
    <tt>base59.tgz</tt>, so you simply need to do the following:
d344 1
a344 1
  <li><b>Install the upgraded boot loader.</b>
d390 1
a390 1
<small>$OpenBSD: upgrade59.html,v 1.11 2016/03/27 09:34:09 tb Exp $</small>
@


1.11
log
@put back softdeps sentence, suggest disabling them in fstab,
as pointed out by sthen
@
text
@d202 1
a202 1
    If you are using this, modify references to <tt>php_fpm</tt> in
d207 1
a207 1
    Please remember to update your <tt>/etc/inetd.conf</tt> accordingly.
d219 1
a219 1
    Delete it with <tt># <b>pkg_delete cfs</b></tt>
d394 1
a394 1
<small>$OpenBSD: upgrade59.html,v 1.10 2016/03/26 15:41:28 tb Exp $</small>
@


1.10
log
@These are actually two separate lists.
Split them.
@
text
@d261 4
d394 1
a394 1
<small>$OpenBSD: upgrade59.html,v 1.9 2016/03/26 15:22:05 tb Exp $</small>
@


1.9
log
@An opening parenthesis that was never closed.
Also, we no longer assume anything ksh specific.
@
text
@a248 1

d255 2
d264 1
a264 1
  <li><b>Become root with ksh(1).</b>
d296 1
d298 3
d390 1
a390 1
<small>$OpenBSD: upgrade59.html,v 1.8 2016/03/26 15:18:11 tb Exp $</small>
@


1.8
log
@Move manpage link to installboot(8) to first usage.
@
text
@d270 1
a270 1
    doas at this point (i.e., direct login or using
a271 3
    Also, the use of the OpenBSD
    <a href="http://man.openbsd.org/?query=ksh">ksh(1)</a>
    shell is assumed.
d385 1
a385 1
<small>$OpenBSD: upgrade59.html,v 1.7 2016/03/26 15:17:33 tb Exp $</small>
@


1.7
log
@don't mention softdeps
@
text
@d291 3
d343 1
a343 3
    Use <a href="http://man.openbsd.org/?query=installboot&amp;arch=i386">
    installboot(8)</a>,
    assuming <tt>sd0</tt> is your boot disk:
d388 1
a388 1
<small>$OpenBSD: upgrade59.html,v 1.6 2016/03/26 15:10:27 tb Exp $</small>
@


1.6
log
@You're very deep in custom territory here. The single-processor case
is the same as the multiprocessor case, mutatis mutandis.
@
text
@a259 2
    Note that using softdeps can exaggerate the situation as deleted and
    overwritten files do not release their space immediately.
d387 1
a387 1
<small>$OpenBSD: upgrade59.html,v 1.5 2016/03/26 14:56:51 tb Exp $</small>
@


1.5
log
@and now the ghastly bold emphasis is no longer needed
@
text
@d298 1
a298 21
  <li><b>Install new kernel(s).</b>
    <ul>
    <li>If you are using the multiprocessor kernel:
      <blockquote><pre>
      <b>cd /usr/rel</b>    # where you put the release files
      <b>ln -f /bsd /obsd && cp bsd.mp /nbsd && mv /nbsd /bsd</b>
      <b>cp bsd.rd /</b>
      <b>cp bsd /bsd.sp</b>
      </pre></blockquote>

    <li>If using a single processor kernel:
      <blockquote><pre>
      <b>cd /usr/rel</b>    # where you put the release files
      <b>ln -f /bsd /obsd && cp bsd /nbsd && mv /nbsd /bsd</b>
      <b>cp bsd.rd bsd.mp /</b>
      </pre></blockquote>
      Note: you will get a harmless error message if your platform doesn't
      have a <tt>bsd.mp</tt>.
    </ul>

    <p>
d301 6
a306 2
    This way the system will be able to boot even after a really badly timed
    power outage or system crash.
d389 1
a389 1
<small>$OpenBSD: upgrade59.html,v 1.4 2016/03/26 14:51:46 tb Exp $</small>
@


1.4
log
@prune some more superfluous text
@
text
@d326 1
a326 1
    Note that we are installing <tt>base59.tgz</tt> <b>last</b>, because the
d330 1
a330 1
    <b>will not work</b> with the old kernel.
d405 1
a405 1
<small>$OpenBSD: upgrade59.html,v 1.3 2016/03/26 13:44:45 sthen Exp $</small>
@


1.3
log
@Suggest that "dmesg -s" is used to review any failures during boot,
tb@@ likes the idea.
@
text
@a325 3
    You are still running the old kernel, it is possible the new reboot
    command will not run on the old kernel, so we will start by saving a
    copy of the old reboot command.
d328 2
a329 1
    <a href="http://man.openbsd.org/?query=tar">tar(1)</a>,
a330 2
    We reboot immediately, as the system is probably barely runnable after
    the unpacking of all the new files.
a344 4
    Not all file sets will need to be installed for all applications,
    however if you installed a file set originally, you should certainly
    upgrade it with the new file set now.

d405 1
a405 1
<small>$OpenBSD: upgrade59.html,v 1.2 2016/03/26 13:37:48 tb Exp $</small>
@


1.2
log
@Aargh, bad href. spotted by sthen@@
@
text
@d391 2
d413 1
a413 1
<small>$OpenBSD: upgrade59.html,v 1.1 2016/03/26 13:27:07 tb Exp $</small>
@


1.1
log
@New upgrade guide: 5.8 -> 5.9.
Further polishing can happen in-tree.
Tested on i386 and amd64.

ok and lots of input from sthen@@ and tj@@
@
text
@d392 1
a392 1
    <tt>/sbin/oreboot</tt> -- and <a href="pkg_add-u">upgrading packages</a>.
d411 1
a411 1
<small>$OpenBSD$</small>
@

