head	1.85;
access;
symbols;
locks; strict;
comment	@# @;


1.85
date	2014.04.01.17.03.08;	author nick;	state dead;
branches;
next	1.84;

1.84
date	2004.01.04.22.23.57;	author horacio;	state Exp;
branches;
next	1.83;

1.83
date	2003.11.17.19.40.51;	author horacio;	state Exp;
branches;
next	1.82;

1.82
date	2003.11.03.14.45.36;	author horacio;	state Exp;
branches;
next	1.81;

1.81
date	2003.09.10.12.42.01;	author horacio;	state Exp;
branches;
next	1.80;

1.80
date	2003.08.16.20.06.05;	author jufi;	state Exp;
branches;
next	1.79;

1.79
date	2003.07.27.15.30.08;	author jufi;	state Exp;
branches;
next	1.78;

1.78
date	2003.07.20.14.13.29;	author jufi;	state Exp;
branches;
next	1.77;

1.77
date	2003.07.11.19.36.35;	author jufi;	state Exp;
branches;
next	1.76;

1.76
date	2003.06.02.11.29.04;	author jufi;	state Exp;
branches;
next	1.75;

1.75
date	2003.05.21.12.42.08;	author jufi;	state Exp;
branches;
next	1.74;

1.74
date	2003.05.06.21.22.24;	author jufi;	state Exp;
branches;
next	1.73;

1.73
date	2003.05.01.20.47.29;	author jufi;	state Exp;
branches;
next	1.72;

1.72
date	2003.04.07.22.04.57;	author jufi;	state Exp;
branches;
next	1.71;

1.71
date	2003.04.02.09.34.35;	author jufi;	state Exp;
branches;
next	1.70;

1.70
date	2003.03.19.19.00.47;	author jufi;	state Exp;
branches;
next	1.69;

1.69
date	2003.03.14.09.47.04;	author jufi;	state Exp;
branches;
next	1.68;

1.68
date	2003.03.01.18.08.38;	author jufi;	state Exp;
branches;
next	1.67;

1.67
date	2003.02.25.20.13.04;	author jufi;	state Exp;
branches;
next	1.66;

1.66
date	2003.01.06.22.01.41;	author jufi;	state Exp;
branches;
next	1.65;

1.65
date	2002.12.15.19.08.37;	author jufi;	state Exp;
branches;
next	1.64;

1.64
date	2002.12.06.17.51.07;	author jufi;	state Exp;
branches;
next	1.63;

1.63
date	2002.11.24.18.52.30;	author jufi;	state Exp;
branches;
next	1.62;

1.62
date	2002.11.23.20.01.57;	author jufi;	state Exp;
branches;
next	1.61;

1.61
date	2002.11.11.18.28.53;	author jufi;	state Exp;
branches;
next	1.60;

1.60
date	2002.11.09.22.14.51;	author jufi;	state Exp;
branches;
next	1.59;

1.59
date	2002.10.29.17.56.37;	author jufi;	state Exp;
branches;
next	1.58;

1.58
date	2002.10.25.20.14.36;	author jufi;	state Exp;
branches;
next	1.57;

1.57
date	2002.10.06.10.39.29;	author jufi;	state Exp;
branches;
next	1.56;

1.56
date	2002.07.27.09.00.49;	author jufi;	state Exp;
branches;
next	1.55;

1.55
date	2002.07.14.12.24.28;	author jufi;	state Exp;
branches;
next	1.54;

1.54
date	2002.07.05.10.22.26;	author jufi;	state Exp;
branches;
next	1.53;

1.53
date	2002.06.29.17.50.51;	author jufi;	state Exp;
branches;
next	1.52;

1.52
date	2002.06.17.21.40.25;	author jufi;	state Exp;
branches;
next	1.51;

1.51
date	2002.06.08.08.37.00;	author jufi;	state Exp;
branches;
next	1.50;

1.50
date	2002.06.06.18.40.00;	author jufi;	state Exp;
branches;
next	1.49;

1.49
date	2002.05.24.20.42.22;	author jufi;	state Exp;
branches;
next	1.48;

1.48
date	2002.05.21.09.30.48;	author jufi;	state Exp;
branches;
next	1.47;

1.47
date	2002.05.01.08.53.29;	author jufi;	state Exp;
branches;
next	1.46;

1.46
date	2002.04.17.19.31.43;	author jufi;	state Exp;
branches;
next	1.45;

1.45
date	2002.03.30.20.12.27;	author jufi;	state Exp;
branches;
next	1.44;

1.44
date	2002.03.30.11.49.55;	author jufi;	state Exp;
branches;
next	1.43;

1.43
date	2002.03.27.22.12.34;	author jufi;	state Exp;
branches;
next	1.42;

1.42
date	2002.03.23.10.16.59;	author jufi;	state Exp;
branches;
next	1.41;

1.41
date	2002.03.20.20.40.01;	author jufi;	state Exp;
branches;
next	1.40;

1.40
date	2002.03.09.10.58.50;	author jufi;	state Exp;
branches;
next	1.39;

1.39
date	2002.01.28.19.21.45;	author jufi;	state Exp;
branches;
next	1.38;

1.38
date	2002.01.26.11.46.29;	author jufi;	state Exp;
branches;
next	1.37;

1.37
date	2002.01.20.20.40.42;	author jufi;	state Exp;
branches;
next	1.36;

1.36
date	2002.01.20.11.39.09;	author jufi;	state Exp;
branches;
next	1.35;

1.35
date	2002.01.19.09.12.50;	author jufi;	state Exp;
branches;
next	1.34;

1.34
date	2001.12.31.10.55.47;	author jufi;	state Exp;
branches;
next	1.33;

1.33
date	2001.12.30.11.48.26;	author jufi;	state Exp;
branches;
next	1.32;

1.32
date	2001.12.06.21.17.40;	author jufi;	state Exp;
branches;
next	1.31;

1.31
date	2001.11.29.17.04.52;	author jufi;	state Exp;
branches;
next	1.30;

1.30
date	2001.11.25.22.12.37;	author jufi;	state Exp;
branches;
next	1.29;

1.29
date	2001.10.21.09.15.45;	author jufi;	state Exp;
branches;
next	1.28;

1.28
date	2001.09.20.05.08.53;	author jufi;	state Exp;
branches;
next	1.27;

1.27
date	2001.07.08.15.52.53;	author jufi;	state Exp;
branches;
next	1.26;

1.26
date	2001.06.16.07.49.23;	author jufi;	state Exp;
branches;
next	1.25;

1.25
date	2001.05.07.05.56.56;	author jufi;	state Exp;
branches;
next	1.24;

1.24
date	2001.05.05.18.13.07;	author jufi;	state Exp;
branches;
next	1.23;

1.23
date	2001.04.25.19.53.56;	author jufi;	state Exp;
branches;
next	1.22;

1.22
date	2001.04.07.07.58.55;	author jufi;	state Exp;
branches;
next	1.21;

1.21
date	2001.03.22.19.01.07;	author jufi;	state Exp;
branches;
next	1.20;

1.20
date	2001.02.25.20.15.34;	author jufi;	state Exp;
branches;
next	1.19;

1.19
date	2001.01.02.17.11.52;	author jufi;	state Exp;
branches;
next	1.18;

1.18
date	2000.12.28.22.00.24;	author jufi;	state Exp;
branches;
next	1.17;

1.17
date	2000.12.01.16.30.18;	author jufi;	state Exp;
branches;
next	1.16;

1.16
date	2000.11.29.20.59.02;	author jufi;	state Exp;
branches;
next	1.15;

1.15
date	2000.11.22.18.04.46;	author jufi;	state Exp;
branches;
next	1.14;

1.14
date	2000.11.11.13.29.21;	author jufi;	state Exp;
branches;
next	1.13;

1.13
date	2000.09.29.07.00.05;	author jufi;	state Exp;
branches;
next	1.12;

1.12
date	2000.07.01.12.20.42;	author jufi;	state Exp;
branches;
next	1.11;

1.11
date	2000.06.02.22.54.25;	author wvdputte;	state Exp;
branches;
next	1.10;

1.10
date	2000.05.21.22.36.40;	author wvdputte;	state Exp;
branches;
next	1.9;

1.9
date	2000.05.20.16.28.58;	author wvdputte;	state Exp;
branches;
next	1.8;

1.8
date	2000.05.16.19.38.50;	author wvdputte;	state Exp;
branches;
next	1.7;

1.7
date	2000.05.16.10.07.39;	author wvdputte;	state Exp;
branches;
next	1.6;

1.6
date	2000.05.15.00.36.26;	author wvdputte;	state Exp;
branches;
next	1.5;

1.5
date	2000.04.30.20.30.16;	author wvdputte;	state Exp;
branches;
next	1.4;

1.4
date	2000.04.26.17.03.26;	author wvdputte;	state Exp;
branches;
next	1.3;

1.3
date	2000.04.22.11.06.59;	author wvdputte;	state Exp;
branches;
next	1.2;

1.2
date	2000.04.09.12.06.13;	author wvdputte;	state Exp;
branches;
next	1.1;

1.1
date	2000.04.05.21.10.40;	author wvdputte;	state Exp;
branches;
next	;


desc
@@


1.85
log
@
Abandon translations, per deraadt@@ and ajacoutot@@.
Thanks to all those that did the translation work, and my appologies to
those who had to translate my writing!
@
text
@<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<html>
<head>
<title>6 - Redes</title>
<link rev="made" href="mailto:www@@openbsd.org">
<meta http-equiv="Content-Type" content="text/html; charset=ISO-8859-1">
<meta http-equiv="Content-Language" content="es">
<meta name="resource-type" content="documento">
<meta name="description"   content="Preguntas Frecuentes de OpenBSD">
<meta name="keywords"      content="openbsd,faq,documentación">
<meta name="distribution"  content="global">
<meta name="copyright"     content="Este documento es copyright 1998-2004 de OpenBSD.">
</head>

<body bgcolor="#ffffff" text="#000000">
<!-- máx. 72 caracteres por línea -->

<img alt="[OpenBSD]" height="30" width="141" src="../../images/smalltitle.gif">
<p>
<font color="#0000e0">
<a href="index.html">[&Iacute;ndice de documentos]</a>
<a href="faq5.html">[Secci&oacute;n 5 - Compilaci&oacute;n del sistema
con el c&oacute;digo fuente]</a>
<a href="faq7.html">[Secci&oacute;n 7 - Controles de teclado y
pantalla]</a>
</font>

<h1><font color="#e00000">6 - Redes</font></h1>

<hr>

<p>
<h3>&Iacute;ndice de contenidos</h3>
<ul>
<li><a href="#Intro">6.1 - Introducci&oacute;n</a>
<li><a href="#Setup">6.2 - Configuraci&oacute;n inicial de la red</a>
<li><a href="#PF">6.3 - C&oacute;mo montar un filtro de red y
cortafuegos con OpenBSD</a>
<li><a href="#DHCP">6.4 - El Protocolo de Configuraci&oacute;n para
Anfitriones Din&aacute;micos (DHCP)</a>
<li><a href="#PPP">6.5 - Protocolo Punto a Punto (PPP)</a>
<li><a href="#Tuning">6.6 - Ajuste de par&aacute;metros de red</a>
<li><a href="#NFS">6.7 - C&oacute;mo usar el Sistema de Archivos de Red
(NFS)</a>
<li><a href="#PPTP">6.8 - Configuraci&oacute;n de una conexi&oacute;n
PPTP en OpenBSD</a>
<li><a href="#Bridge">6.9 - C&acute;mo configurar un &laquo;puente de
red&raquo; (<i>bridge</i>) con OpenBSD</a>
</ul>

<hr>

<p>
<a name="Intro"></a>
<h2>6.1 - Introducci&oacute;n</h2>

<p>
Para la comprensi&oacute;n de la mayor parte de este documento
ser&aacute; de gran ayuda haber le&iacute;do antes, y por lo menos haber
asimilado en parte, el cap&iacute;tulo 5 sobre la
<a href="faq5.html">&laquo;Configuraci&oacute;n del
N&uacute;cleo&raquo;</a> de estos documentos, as&iacute; como las
p&aacute;ginas del manual de
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=ifconfig&amp;sektion=8">ifconfig(8)</a>
y de
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=netstat&amp;sektion=1">netstat(1)</a>.

<p>
Tanto si se es un administrador de redes que est&aacute; configurando
protocolos de enrutamiento, como si se est&aacute; usando el sistema
OpenBSD como un enrutador, como si se necesita conocer m&aacute;s a
fondo los protocolos de redes IP, es realmente necesario leer
<a href="http://www.3com.com/other/pdfs/infra/corpinfo/en_US/501302.pdf">
Understanding IP addressing</a>
&iexcl;Es un documento excelente que contiene conocimientos
b&aacute;sicos fundamentales sobre redes IP!

<p>
Si se est&aacute; trabajando con aplicaciones como servidores de http,
servidores de ftp y servidores de correo, ser&aacute; muy beneficioso
leer los <a href="http://the.rfc-editor.org/rfc.html">RFC</a>.

<p>
<i>(Nota: existe un proyecto de traducci&oacute;n de documentos RFC al
castellano, <a href="http://www.rfc-es.org/">RFC-ES</a>)</i>

<p>
Pero lo m&aacute;s seguro es que no se puedan leer todos, y por ello lo
m&aacute;s pr&aacute;ctico es seleccionar algunos temas de
inter&eacute;s o aquellos que se usen en el entorno de red del que se
disponga.  Es aconsejable leerlos al mismo tiempo que se intenta
averiguar su funcionamiento.  Los RFC definen much&iacute;simas (miles)
de las normas para protocolos en Internet y c&oacute;mo se supone que
deben funcionar estos protocolos.

<p>
<a name="Setup"></a>
<h2>6.2 - Configuraci&oacute;n inicial de la red</h2>

<p>
<a name="Setup.1"></a>
<h3>6.2.1 - Identificaci&oacute;n y configuraci&oacute;n de las
interfaces de red</h3>

<p>
Para empezar a configurar una red, lo primero que se debe hacer es
identificar la interfaz de red.  En OpenBSD las interfaces se designan
por el tipo de tarjeta, no por el tipo de conexi&oacute;n.  La tarjeta
de red se puede ver durante el arranque mientras se inicia el sistema, o
despu&eacute;s del arranque usando la orden
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=dmesg&amp;sektion=8">dmesg(8)</a>.
Tambi&eacute;n es posible ver la interfaz de red usando la orden
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=ifconfig&amp;sektion=8">ifconfig(8)</a>.
Por ejemplo, v&eacute;ase a continuaci&oacute;n la salida originada por
dmesg para una tarjeta de red Intel Fast Ethernet, que usa el nombre de
dispositivo <i>fxp</i>.

<blockquote>
<pre>
fxp0 at pci0 dev 10 function 0 &quot;Intel 82557&quot; rev 0x0c: irq 5, address 00:02:b3:2b:10:f7
inphy0 at fxp0 phy 1: i82555 10/100 media interface, rev. 4
</pre>
</blockquote>

<p>
Si no se conoce el nombre del dispositivo, se puede buscar en la
<a href="../../es/plat.html">lista de hardware con soporte</a> de la
plataforma correspondiente.  En esa p&aacute;gina hay un listado con
muchos nombres de tarjetas comunes junto con los nombres de dispositivo
que les corresponde en OpenBSD.  Combinando el nombre alfab&eacute;tico
abreviado (como <i>fxp</i>) con un n&uacute;mero asignado por el
n&uacute;cleo del sistema se obtendr&aacute; el nombre de la interfaz
(como <i>fxp0</i>).

<p>
Se puede averiguar qu&eacute; interfaces de red han sido identificadas
por el sistema mediante la utilidad 
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=ifconfig&amp;sektion=8">ifconfig(8)</a>.
La orden siguiente mostrar&aacute; todas las interfaces de red que
existan en un sistema.  En este ejemplo s&oacute;lo se ha encontrado una
interfaz f&iacute;sica de ethernet, la
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=fxp&amp;sektion=4">
fxp(4)</a>.

<blockquote>
<pre>
$ <b>ifconfig -a</b>
lo0: flags=8049&lt;UP,LOOPBACK,RUNNING,MULTICAST&gt; mtu 33224
        inet 127.0.0.1 netmask 0xff000000
        inet6 ::1 prefixlen 128
        inet6 fe80::1%lo0 prefixlen 64 scopeid 0x5
lo1: flags=8008&lt;LOOPBACK,MULTICAST&gt; mtu 33224
fxp0: flags=8843&lt;UP,BROADCAST,RUNNING,SIMPLEX,MULTICAST&gt; mtu 1500
        address: 00:04:ac:dd:39:6a
        media: Ethernet autoselect (100baseTX full-duplex)
        status: active
        inet 10.0.0.38 netmask 0xffffff00 broadcast 10.0.0.255
        inet6 fe80::204:acff:fedd:396a%fxp0 prefixlen 64 scopeid 0x1
pflog0: flags=0&lt;&gt; mtu 33224
pfsync0: flags=0&lt;&gt; mtu 2020
sl0: flags=c010&lt;POINTOPOINT,LINK2,MULTICAST&gt; mtu 296
sl1: flags=c010&lt;POINTOPOINT,LINK2,MULTICAST&gt; mtu 296
ppp0: flags=8010&lt;POINTOPOINT,MULTICAST&gt; mtu 1500
ppp1: flags=8010&lt;POINTOPOINT,MULTICAST&gt; mtu 1500
tun0: flags=10&lt;POINTOPOINT&gt; mtu 3000
tun1: flags=10&lt;POINTOPOINT&gt; mtu 3000
enc0: flags=0&lt;&gt; mtu 1536
bridge0: flags=0&lt;&gt; mtu 1500
bridge1: flags=0&lt;&gt; mtu 1500
vlan0: flags=0&lt;&gt; mtu 1500
        address: 00:00:00:00:00:00
vlan1: flags=0&lt;&gt; mtu 1500
        address: 00:00:00:00:00:00
gre0: flags=9010&lt;POINTOPOINT,LINK0,MULTICAST&gt; mtu 1450
gif0: flags=8010&lt;POINTOPOINT,MULTICAST&gt; mtu 1280
gif1: flags=8010&lt;POINTOPOINT,MULTICAST&gt; mtu 1280
gif2: flags=8010&lt;POINTOPOINT,MULTICAST&gt; mtu 1280
gif3: flags=8010&lt;POINTOPOINT,MULTICAST&gt; mtu 1280
</pre>
</blockquote>

<p>
Como se puede comprobar, 
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=ifconfig&amp;sektion=8">ifconfig(8)</a>
muestra mucha m&aacute;s informaci&oacute;n de la que necesitamos en
este momento.  Pero aqu&iacute; lo importante es que nos permite ver
nuestra interfaz.  En el ejemplo, la tarjeta de la interfaz ya
est&aacute; configurada.  Esto es obvio porque ya hay una red IP
configurada en fxp0, y de aqu&iacute; los valores &quot;inet 10.0.0.38
netmask 0xffffff00 broadcast 10.0.0.255&quot;.  Adem&aacute;s, los
indicadores <b>UP</b> y <b>RUNNING</b> se encuentran activados.

<p>
Finalmente, n&oacute;tese que hay otras interfaces que tambi&eacute;n se
encuentran activadas de modo predeterminado.  &Eacute;stas son
interfaces virtuales que tienen varias funciones.  Las siguientes
p&aacute;ginas del manual las describen:

<ul>
<!-- XXXrelease -->
<li><a href="http://www.openbsd.org/cgi-bin/man.cgi?query=lo&amp;sektion=4">lo</a> - Interfaz de circuito cerrado (<i>loopback</i>)
<li><a href="http://www.openbsd.org/cgi-bin/man.cgi?query=pflog&amp;sektion=4&amp;manpath=OpenBSD+3.4">pflog</a> - Interfaz de registros del Filtro de Paquetes (<i>PF</i>)
<li><a href="http://www.openbsd.org/cgi-bin/man.cgi?query=sl&amp;sektion=4">sl</a> - Interfaz de red SLIP
<li><a href="http://www.openbsd.org/cgi-bin/man.cgi?query=ppp&amp;sektion=4">ppp</a> - Protocolo punto a punto (PPP)
<li><a href="http://www.openbsd.org/cgi-bin/man.cgi?query=tun&amp;sektion=4">tun</a> - Interfaz de red por t&uacute;nel
<li><a href="http://www.openbsd.org/cgi-bin/man.cgi?query=enc&amp;sektion=4">enc</a> - Interfaz de encapsulamiento
<li><a href="http://www.openbsd.org/cgi-bin/man.cgi?query=bridge&amp;sektion=4">bridge</a> - Interfaz de puente Ethernet
<li><a href="http://www.openbsd.org/cgi-bin/man.cgi?query=vlan&amp;sektion=4">vlan</a> - Interfaz de encapsulaci&oacute;n IEEE 802.1Q
<li><a href="http://www.openbsd.org/cgi-bin/man.cgi?query=gre&amp;sektion=4">gre</a> - Interfaz de encapsulaci&oacute;n GRE/MobileIP
<li><a href="http://www.openbsd.org/cgi-bin/man.cgi?query=gif&amp;sektion=4">gif</a> - Interfaz de t&uacute;nel IPv4/IPv6 gen&eacute;rica
</ul>

<p>
Si a&uacute;n no se ha configurado la interfaz, el primer paso
ser&aacute; crear el fichero <tt>/etc/hostname.xxx</tt>, donde se debe
sustituir <tt>xxx</tt> por el nombre de la interfaz.  De acuerdo con la
informaci&oacute;n de los ejemplos anteriores, el nombre ser&iacute;a
<tt>/etc/hostname.fxp0</tt>.  La composici&oacute;n de este fichero es
as&iacute; de sencilla:<br>

<blockquote>
<pre>
address_family address netmask broadcast [other options]
</pre>
</blockquote>

<p>
(Se puede ver m&aacute;s informaci&oacute;n sobre el formato de este
fichero en la p&aacute;gina del manual de
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=hostname.if&amp;sektion=5">hostname.if(5)</a>)

<p>
El fichero de configuraci&oacute;n de una interfaz t&iacute;pica,
configurada para una direcci&oacute;n de IPv4, debe ser algo como lo
siguiente:

<blockquote>
<pre>
$ <b>cat /etc/hostname.fxp0</b>
inet 10.0.0.38 255.255.255.0 NONE
</pre>
</blockquote>

<p>
Tambi&eacute;n se podr&iacute;a especificar tipos de medio para
Ethernet;  por ejemplo, si se quisiera forzar el modo 100baseTX
full-duplex:

<blockquote><pre>
inet 10.0.0.38 255.255.255.0 NONE media 100baseTX mediaopt full-duplex
</pre></blockquote>

<p>
Aunque nunca se debe forzar el modo <i>full duplex</i>, a menos que
ambas partes de la conexi&oacute;n est&eacute;n configuradas para ello.
A menos que sea necesario por alg&uacute;n motivo especial, la
configuraci&oacute;n del tipo de medio se debe excluir.

<p>
Para especificar una interfaz determinada se puede usar indicadores
especiales, en cuyo caso el formato del fichero <i>hostname</i> no
cambiar&iacute;a mucho:

<blockquote><pre>
$ <b>cat /etc/hostname.vlan0</b>
inet 172.21.0.0 255.255.255.0 NONE vlan 2 vlandev fxp1
</pre></blockquote>

<p>
El siguiente paso ser&aacute; la configuraci&oacute;n de la pasarela
(<i>gateway</i>) predeterminada.  Para ello basta con poner la
direcci&oacute;n IP de la pasarela en el fichero <tt>/etc/mygate</tt>.
Esto permitir&aacute; que la pasarela se active en el momento del
arranque.  A continuaci&oacute;n hay que configurar los nombres de
servidores (<i>nameservers</i>) y el fichero <tt>/etc/hosts</tt>
(v&eacute;ase la p&aacute;gina del manual de
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=hosts&amp;sektion=5">hosts(5)</a>).
Para configurar los nombres de servidores, antes se debe crear un
fichero con el nombre <tt>/etc/resolv.conf</tt>.  Puede verse m&aacute;s
informaci&oacute;n sobre el formato de este fichero en la p&aacute;gina
del manual de
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=resolv.conf&amp;sektion=5">resolv.conf(5)</a>.
El siguiente ejemplo es para un uso t&iacute;pico.  En este ejemplo los
servidores de dominio son 125.2.3.4 y 125.2.3.5.  Y tambi&eacute;n se es
parte del dominio &laquo;example.com&raquo;:

<blockquote>
<pre>
$ <b>cat /etc/resolv.conf</b>
search example.com
nameserver 125.2.3.4
nameserver 125.2.3.5
lookup file bind
</pre>
</blockquote>

<p>
Desde este punto ya se puede reiniciar o bien ejecutar el gui&oacute;n
de configuraci&oacute;n (<i>script</i>) <b>/etc/netstart</b>.  Este
gui&oacute;n de configuraci&oacute;n se ejecuta como superusuario
(<i>root</i>) del siguiente modo:

<blockquote>
<pre>
# <b>sh /etc/netstart</b>
writing to routing socket: File exists
add net 127: gateway 127.0.0.1: File exists
writing to routing socket: File exists
add net 224.0.0.0: gateway 127.0.0.1: File exists
</pre>
</blockquote>

<p>
N&oacute;tese que se ha producido un peque&ntilde;o n&uacute;mero de
errores.  Pero al ejecutar este gui&oacute;n, se reconfingurar&aacute;n
cosas que ya se hab&iacute;an configurado anteriormente.  De hecho,
algunas rutas ya existen en la tabla de enrutamiento del n&uacute;cleo
del sistema.  Desde aqu&iacute;, el sistema deber&iacute;a funcionar con
normalidad.  Se puede realizar una comprobaci&oacute;n con
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=ifconfig&amp;sektion=8">ifconfig(8)</a>
para asegurarse de que la interfaz se ha configurado correctamente.
Tambi&eacute;n es posible comprobar las rutas con
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=netstat&amp;sektion=1">netstat(1)</a> o <a href="http://www.openbsd.org/cgi-bin/man.cgi?query=route&amp;sektion=8">route(8)</a>.
Si tenemos problemas con el enrutamiento, podemos usar el indicador
<tt>-n</tt> para la orden route(8), que muestra las direcciones de IP en
lugar de realizar una b&uacute;squeda de DNS y mostrar el
<i>hostname</i>.  He aqu&iacute; un ejemplo en el que se muestran las
tablas de enrutamiento usando sendos programas:

<blockquote>
<pre>
$ <b>netstat -rn</b>
Routing tables

Internet:
Destination        Gateway            Flags     Refs     Use    Mtu  Interface
default            10.0.0.1           UGS         0       86      -  fxp0
127/8              127.0.0.1          UGRS        0        0      -  lo0
127.0.0.1          127.0.0.1          UH          0        0      -  lo0
10.0.0/24          link#1             UC          0        0      -  fxp0
10.0.0.1           aa:0:4:0:81:d      UHL         1        0      -  fxp0
10.0.0.38          127.0.0.1          UGHS        0        0      -  lo0
224/4              127.0.0.1          URS         0        0      -  lo0

Encap:
Source             Port  Destination        Port  Proto SA(Address/SPI/Proto)

$ <b>route show</b>
Routing tables

Internet:
Destination      Gateway            Flags
default          10.0.0.1           UG
127.0.0.0        LOCALHOST          UG
localhost        LOCALHOST          UH
10.0.0.0         link#1             U
10.0.0.1         aa:0:4:0:81:d      UH
10.0.0.38        LOCALHOST          UGH
BASE-ADDRESS.MCA LOCALHOST          U
</pre>
</blockquote>

<p>
<a name="Setup.2"></a>
<h3>6.2.2 - Configuraci&oacute;n del sistema OpenBSD como pasarela
(<i>gateway</i>)</h3>

<p>
Lo que sigue es la informaci&oacute;n b&aacute;sica necesaria para
configurar el sistema OpenBSD como una pasarela (tambi&eacute;n llamada
&laquo;enrutador&raquo; o &laquo;encaminador&raquo;).  Si se va a usar
OpenBSD como un enrutador en Internet, sugerimos la lectura de la
secci&oacute;n que contiene las instrucciones sobre la
configuraci&oacute;n del Filtro de Paquetes IP (PF), para poder bloquear
el tr&aacute;fico que sea potencialmente malicioso.  Adem&aacute;s,
debido a la escasa disponibilidad de direcciones de
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=ip&amp;sektion=4">
IPv4</a> en los proveedores de servicios de redes y registros
regionales, es conveniente leer la secci&oacute;n sobre la
Traducci&oacute;n de Direcciones de Red (NAT), que contiene
informaci&oacute;n sobre c&oacute;mo conservar el espacio de
direcci&oacute;n IP.

<p>
El n&uacute;cleo GENERIC posee la capacidad de permitir el
reenv&iacute;o de IP (<i>IP Forwarding</i>), pero antes debe ser
activado.  Para activarlo hay que usar la utilidad
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=sysctl&amp;sektion=8">sysctl(8)</a>;
y para que los cambios sean permanentes hay que editar el fichero
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=sysctl.conf&amp;sektion=5">/etc/sysctl.conf(5)</a>
y activar <i>IP Forwarding</i> en &eacute;ste.  Esto se puede hacer
a&ntilde;adiendo la siguiente l&iacute;nea a ese fichero de
configuraci&oacute;n:

<blockquote>
<pre>
net.inet.ip.forwarding=1
</pre>
</blockquote>

<p>
Para que este cambio surja efecto sin que haya que reiniciar el sistema,
hay que usar directamente la utilidad
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=sysctl&amp;sektion=8">sysctl(8)</a>.
Recu&eacute;rdese que este cambio ya no existir&aacute; inmediatamente
despu&eacute;s de reiniciar, y que es necesario ejecutarlo como
superusuario:

<blockquote>
<pre>
# <b>sysctl -w net.inet.ip.forwarding=1</b>
net.inet.ip.forwarding: 0 -&gt; 1
</pre>
</blockquote>

<p>
A continuaci&oacute;n se deben modificar las rutas en los otros
anfitriones, en ambos extremos.  OpenBSD ofrece muchas posibilidades de
utilizaci&oacute;n como enrutador, usando <i>software</i> como 
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=routed&amp;sektion=8">routed(8)</a>,
<a href="http://www.gated.org">gated</a>, <a href="http://www.mrtd.net">mrtd</a> y <a href="http://www.zebra.org">zebra</a>.
OpenBSD dispone de soporte para zebra, gated y mrtd en la
colecci&oacute;n de portes, e incluye soporte para varias interfaces T1,
HSSI, ATM, FDDI, Ethernet, e interfaces de serie (PPP/SLIP).

<p>
<a name="Setup.3"></a>
<h3>6.2.3 - Configuraci&oacute;n de un alias en una interfaz</h3>

<p>
OpenBSD dispone de un sencillo mecanismo para la configuraci&oacute;n de
los alias de IP en una interfaz.  Lo &uacute;nico que hay que hacer para
configurar los alias es editar el fichero
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=hostname.if&amp;sektion=5"><tt>/etc/hostname.&lt;if&gt;</tt></a>.
El gui&oacute;n de ejecuci&oacute;n
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=rc&amp;sektion=8">/etc/rc(8)</a>,
que forma parte de la <a href="faq10.html#rc">jerarqu&iacute;a de inicio
rc</a>, leer&aacute; este fichero durante el proceso de inicio del
sistema.  Por ejemplo, supongamos que el usuario tiene una interfaz
<b>dc0</b> y pertenece a la red 192.168.0.0.  Otra informaci&oacute;n de
importancia es:

<ul>
<li>IP para dc0 es 192.168.0.2
<li>NETMASK es 255.255.255.0
</ul>

<p>
Notas sobre los alias:  en OpenBSD s&oacute;lo se usa el nombre de la
interfaz y no existen diferencias entre el primer alias y el segundo;
por lo tanto, y a diferencia de otros sistemas operativos, en OpenBSD no
hay que referirse a ellos como dc0:0 y dc0:1.  Si hacemos referencia a
una direcci&oacute;n de IP alias espec&iacute;fica con ifconfig, o si
estamos a&ntilde;adiendo un alias, debemos asegurarnos de escribir
'<kbd>ifconfig int alias</kbd>', en lugar de '<kbd>ifconfig int</kbd>',
en la l&iacute;nea de &oacute;rdenes.  Los alias se pueden eliminar con
la orden '<kbd>ifconfig int delete</kbd>'.

<p>
Asumiendo que se est&eacute;n usando direcciones de IP m&uacute;ltiples
que se encuentran en la misma subred IP con alias, la
configuraci&oacute;n de la m&aacute;scara de red (<i>netmask</i>) para
cada alias pasa a ser 255.255.255.255.  No necesitan seguir la
m&aacute;scara de red del primer IP vinculado a la interfaz.  En el
siguiente fichero <tt>/etc/hostname.dc0</tt> de ejemplo, se han
a&ntilde;adido dos alias al dispositivo <b>dc0</b>, el cual, por cierto,
se ha configurado como 192.168.0.2 netmask 255.255.255.0:

<blockquote>
<pre>
# <b>cat /etc/hostname.dc0</b>
inet 192.168.0.2 255.255.255.0 media 100baseTX
inet alias 192.168.0.3 255.255.255.255
inet alias 192.168.0.4 255.255.255.255
</pre>
</blockquote>

<p>
Una vez que se haya configurado este fichero, ser&aacute; necesario
reiniciar para que los cambios funcionen.  Aunque tambi&eacute;n es
posible hacer efectivos los alias a mano, usando la utilidad
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=ifconfig&amp;sektion=8">ifconfig(8)</a>.
Para hacer efectivo el primer alias se usar&iacute;a la orden:

<blockquote>
<pre>
# <b>ifconfig dc0 inet alias 192.168.0.3 netmask 255.255.255.255</b>
</pre>
</blockquote>

<p>
Para ver estos alias se usar&iacute;a la orden:

<blockquote>
<pre>
$ <b>ifconfig -A</b>
dc0: flags=8863&lt;UP,BROADCAST,NOTRAILERS,RUNNING,SIMPLEX,MULTICAST&gt;
        media: Ethernet manual
        inet 192.168.0.2  netmask 0xffffff00 broadcast 192.168.0.255
        inet 192.168.0.3 netmask 0xffffffff broadcast 192.168.0.3
</pre>
</blockquote>


<p>
<a name="NAT"></a>
<a name="PF"></a>
<h2>6.3 - C&oacute;mo montar un filtro de red y un cortafuegos con
OpenBSD</h2>

<p>
El Filtro de Paquetes (a partir de aqu&iacute; PF) es el sistema de
OpenBSD para filtrar el tr&aacute;fico TCP/IP y realizar las tareas de
Traducci&oacute;n de Direcciones de Red (NAT).  PF tambi&eacute;n puede
normalizar y acondicionar el tr&aacute;fico TCP/IP y proveer control del
ancho de banda y priorizaci&oacute;n de paquetes, y se puede utilizar
para crear cortafuegos resistentes y flexibles.  Su configuraci&oacute;n
y funcionamiento se describen en la
<a href="../pf/es/index.html"><b>Gu&iacute;a del Usuario de PF</b></a>.


<p>
<a name="DHCP"></a>
<h2>6.4 - DHCP</h2>

<p>
<h3>6.4.1 Cliente DHCP</h3>

<p>
Para usar el cliente de DHCP que se incluye en OpenBSD, 
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=dhclient&amp;sektion=8">dhclient(8)</a>,
hay que editar el fichero <tt>/etc/hostname.xl0</tt> (suponiendo que la
interfaz principal de ethernet sea xl0 ... la interfaz podr&iacute;a ser
ep0, fxp0, o cualquier otra) para modificarlo.  La &uacute;nica
modificaci&oacute;n necesaria en este fichero es a&ntilde;adir la
palabra clave '<tt>dhcp</tt>':

<pre>
# <b>echo dhcp &gt;/etc/hostname.xl0</b>
</pre>

<p>
Esto har&aacute; que OpenBSD inicie el cliente DHCP
autom&aacute;ticamente durante el arranque.  OpenBSD obtendr&aacute; la
informaci&oacute;n sobre nuestra direcci&oacute;n IP, pasarela, y
servidores de DNS desde el servidor de DHCP.

<p>
Si se desea iniciar un cliente dhcp desde la l&iacute;nea de
&oacute;rdenes, antes hay que asegurarse de que el fichero
<tt>/etc/dhclient</tt> exista y entonces usar la orden:

<pre>
# <b>dhclient fxp0</b>
</pre>

<p>
en donde fxp0 es la interfaz en la que se desea recibir dhcp.

<p>
Sea cual fuere el modo en que se inicie dhclient, se puede editar el
fichero <tt>/etc/dhclient</tt> para <b>evitar</b> que se actualice la
DNS de acuerdo con la idea que tenga el servidor de dhcp sobre la DNS,
comentando las l&iacute;neas precedidas por 'request' (son ejemplos de
la configuraci&oacute;n predefinida, pero es necesario activarlos para
anular la configuraci&oacute;n predefinida de dhclient):

<pre>
request subnet-mask, broadcast-address, time-offset, routers,
      domain-name, domain-name-servers, host-name, lpr-servers, ntp-servers;
</pre>

<p>
y a continuaci&oacute;n <b>eliminar</b> domain-name-servers.
Tambi&eacute;n, si se desea, es posible anular hostname u otras
configuraciones.

<p>
<h3>6.4.2 Servidor DHCP</h3>

<p>
Si se desea usar OpenBSD como servidor de DHCP con
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=dhcpd&amp;sektion=8">dhcpd(8)</a>,
hay que editar el fichero <tt>/etc/rc.conf</tt> y configurarlo
a&ntilde;adiendo <tt>dhcp_flags=&quot;-q&quot;</tt> en lugar de
<tt>dhcp_flags=NO</tt>.  Tambi&eacute;n hay que a&ntilde;adir en
<tt>/etc/dhcp.interfaces</tt> las interfaces en las que se desee que
dhcp permanezca <b>a la escucha</b>:

<pre>
# <b>echo xl1 xl2 xl3 &gt;/etc/dhcpd.interfaces</b>
</pre>

<p>
y editar <tt>/etc/dhcpd.conf</tt>.  Las opciones son bastante claras:

<pre>
        option  domain-name &quot;example.com&quot;;
        option  domain-name-servers 192.168.1.3, 192.168.1.5;

        subnet 192.168.1.0 netmask 255.255.255.0 {
                option routers 192.168.1.1;

                range 192.168.1.32 192.168.1.127;
        }
</pre>

<p>
Con esto indicaremos a los clientes de DHCP que el dominio que deben
a&ntilde;adir a sus requerimientos de DNS es example.com (as&iacute;, si
un usuario escribiera 'telnet joe', los enviar&iacute;a a
joe.example.com).  Les dirigir&aacute; a los servidores de DNS
192.168.1.3 y 192.168.1.5.  A los anfitriones que se encuentren en la
misma red que una interfaz de ethernet en la m&aacute;quina de OpenBSD
(que est&aacute; en el rango 192.168.1.0/24) les asignar&aacute; una
direcci&oacute;n de IP entre 192.168.1.32 y 192.168.1.127, con una
configuraci&oacute;n predeterminada de la pasarela de 192.168.1.1.

<p>
Si se quiere iniciar dhcpd(8) desde la l&iacute;nea de &oacute;rdenes,
hay que intentar lo siguiente despu&eacute;s de editar
<tt>/etc/dhcpd.conf</tt>:

<pre>
# <b>dhcpd -q fxp0</b>
</pre>

<p>
en donde <tt>fxp0</tt> es la interfaz que se desea que empiece a servir
requerimientos de dhcp.  El indicador <tt>-q</tt> fuerza una salida
silenciosa de dhcpd, ya que de otro modo es muy ruidoso.

<p>
Si se est&aacute; actuando como servidor de DHCP para una m&aacute;quina
Windows, se puede hacer que dhcpd(8) ofrezca al cliente una
direcci&oacute;n de servidor 'WINS'.  Para ello hay que a&ntilde;adir la
siguiente l&iacute;nea al fichero <tt>/etc/dhcpd.conf</tt>:

<pre>
     option    netbios-name-servers    192.168.92.55;
</pre>

<p>
En donde <tt>192.168.92.55</tt> es el IP del servidor de Windows o
Samba.  Para informaci&oacute;n sobre otras opciones que puedan aceptar
los clientes de DHCP, v&eacute;se
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=dhcp-options&amp;sektion=5">dhcp-options(5)</a>.

<p>
<a name="PPP"></a>
<h2>6.5 - PPP </h2>

<p>
El &laquo;Protocolo Punto a Punto&raquo; (PPP) es el que se suele usar
para crear una conexi&oacute;n con el ISP (el proveedor de Internet) a
trav&eacute;s de un m&oacute;dem.  OpenBSD puede hacer esto de dos
modos:

<ul>
<li><a href="http://www.openbsd.org/cgi-bin/man.cgi?query=pppd&amp;sektion=8">pppd(8)</a> - el d&aelig;mon ppp del n&uacute;cleo del sistema (<i>kernel</i>).
<li><a href="http://www.openbsd.org/cgi-bin/man.cgi?query=ppp&amp;sektion=8">ppp(8)</a> - el d&aelig;mon ppp del modo de usuario.
</ul>

<p>
Primero trataremos el d&aelig;mon del modo de usuario.  Para empezar
necesitaremos algo de informaci&oacute;n sobre nuestro proveedor.  He
aqu&iacute; una lista de la informaci&oacute;n que ser&aacute;
necesaria:

<ul>
   <li>El n&uacute;mero de tel&eacute;fono de conexi&oacute;n de.
   proveedor (ISP)
   <li>Nuestro <i>nameserver</i> (nombre del servidor) 
   <li>Nuestro nombre de usuario y contrase&ntilde;a
   <li>Nuestra pasarela (<i>gateway</i>)
</ul>

<p>
Parte de esta informaci&oacute;n no es estrictamente necesaria, pero
ser&aacute; de gran ayuda para configurar ppp.  El d&aelig;mon PPP del
modo de usuario utiliza el fichero
<a href="http://www.openbsd.org/cgi-bin/cvsweb/src/etc/ppp/ppp.conf.sample">/etc/ppp/ppp.conf</a>
como fichero de configuraci&oacute;n.  Existen muchos ficheros en
<tt>/etc/ppp</tt> de gran utilidad, que pueden contener diferentes
ejemplos de configuraci&oacute;n para situaciones distintas.  Es
aconsejable mirar en ese directorio.

<p>
En caso de no estar usando un n&uacute;cleo GENERIC, debemos asegurarnos
de que tenemos la siguiente l&iacute;nea en nuestro fichero de
configuraci&oacute;n:

<blockquote><pre><strong>
pseudo-device   tun             2
</strong></pre></blockquote>

<p>
<h3>Configuraci&oacute;n inicial para PPP(8)</h3>

<p>
La configuraci&oacute;n inicial del d&aelig;mon PPP del modo de usuario
consiste en editar su fichero <tt>/etc/ppp/ppp.conf</tt>.  Este fichero
no existe y se debe crear, pero se puede tomar el fichero
<tt>/etc/ppp/ppp.conf.sample</tt>, editarlo, y crear un fichero
<tt>ppp.conf</tt> propio a partir de ah&iacute;.  Aqu&iacute;
empezaremos con la configuraci&oacute;n m&aacute;s simple, y
probablemente la m&aacute;s utilizada.  A continuaci&oacute;n puede
verse un peque&ntilde;o fichero <tt>ppp.conf</tt> que realizar&aacute;
la conexi&oacute;n con el ISP y usar&aacute; nuestras rutas predefinidas
y nuestro <i>nameserver</i>.  Para la creaci&oacute;n de este fichero,
toda la informaci&oacute;n que necesitaremos ser&aacute; el
n&uacute;mero de tel&eacute;fono de nuestro ISP, nuestro nombre de
usuario, y nuestra contrase&ntilde;a:

<blockquote><pre>
default:
set log Phase Chat LCP IPCP CCP tun command     
set device /dev/cua01                           
set speed 115200     
set dial "ABORT BUSY ABORT NO\\sCARRIER TIMEOUT 5 \"\" AT OK-AT-OK ATE1Q0 OK\\dATDT\\T TIMEOUT 40 CONNECT"
</pre></blockquote>

<p>
La secci&oacute;n bajo la opci&oacute;n <tt>default:</tt> se
ejecutar&aacute; cada vez que se realice un requerimiento para una
conexi&oacute;n.  En ella se configura toda la informaci&oacute;n
cr&iacute;tica.  Con &quot;set log&quot; se configuran los niveles de
ingreso.  Esto se puede cambiar; para m&aacute;s informaci&oacute;n
sobre c&oacute;mo configurar los niveles de ingreso v&eacute;ase la
p&aacute;gina del manual de
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=ppp&amp;sektion=8">
ppp(8)</a>.  El dispositivo se configura con &quot;set device&quot;.
&Eacute;ste es el dispositivo en el que se encuentra el m&oacute;dem.
En este ejemplo el m&oacute;dem est&aacute; en el puerto de
comunicaciones 2 (COM2), mientras que el puerto de comunicaciones 1
corresponder&iacute;a a <tt>/dev/cua00</tt>.  Con &quot;set speed&quot;
se configura la velocidad de la conexi&oacute;n por llamada, y con
&quot;set dial&quot; se configuran los par&aacute;metros de la llamada.
Con esto se puede cambiar el tiempo muerto, etc...  Es conveniente dejar
esta l&iacute;nea m&aacute;s o menos como est&aacute;.

<p>
A continuaci&oacute;n podemos pasar a configurar la informaci&oacute;n
espec&iacute;fica para nuestro ISP.  Para ello debemos a&ntilde;adir
otra opci&oacute;n en la secci&oacute;n <b>default:</b>.  Se puede dar
cualquier nombre a esta etiqueta, pero lo m&aacute;s f&aacute;cil es
darle el nombre del ISP.  En el ejemplo usaremos <b>myisp:</b> para la
opci&oacute;n que har&aacute; referencia a nuestro ISP.  He aqu&iacute;
una configuraci&oacute;n simple que incorpora todo lo necesario para
conectar:

<blockquote><pre>
myisp:
set phone 1234567   
set login "ABORT NO\\sCARRIER TIMEOUT 5 ogin:--ogin: ppp word: ppp"
set timeout 120   
set ifaddr 10.0.0.1/0 10.0.0.2/0 255.255.255.0 0.0.0.0
add default HISADDR 
enable dns
</pre></blockquote>

<p>
Aqu&iacute; hemos configurado la informaci&oacute;n esencial para un ISP
espec&iacute;fico.  La primera opci&oacute;n, &quot;set phone&quot;, es
para configurar el n&uacute;mero de tel&eacute;fono para la
conexi&oacute;n con el ISP.  La opci&oacute;n &quot;set login&quot; es
para configurar nuestras opciones de ingreso.  En el ejemplo hemos
puesto un tiempo muerto de espera de 5, lo que significa que nuestro
intento de ingreso terminar&aacute; despu&eacute;s de 5 segundos si no
hay transportador.  De lo contrario esperar&aacute; hasta recibir un
&quot;login&quot; para enviar nuestro nombre de usuario y
contrase&ntilde;a.  En el ejemplo, tanto el nombre de usuario como la
contraseña son &quot;ppp&quot;.  Estos valores hay que sustituirlos por
otros reales.  La opci&oacute;n &quot;set timeout&quot; es para
configurar el tiempo de espera para todo el proceso de ingreso.  La
opci&oacute;n &quot;set ifaddr&quot; es algo complicada.  He aqu&iacute;
una explicaci&oacute;n m&aacute;s extensa sobre ella:

<blockquote><pre>
set ifaddr 10.0.0.1/0 10.0.0.2/0 255.255.255.0 0.0.0.0
</pre></blockquote>

<p>
Hemos configurado la l&iacute;nea anterior con el formato &quot;<b>set
ifaddr [myaddr[/nn] [hisaddr[/nn] [netmask [triggeradr]]]]</b>&quot;.
De este modo el primer IP que se especifique es el que querremos como
nuestro IP.  Si se tiene una direcci&oacute;n IP est&aacute;tica, se
debe a&ntilde;adir aqu&iacute;.  En el ejemplo hemos usado /0, que
indica que no es necesario que concuerde ning&uacute;n bit de esta
direcci&oacute;n ip, y que se puede sustituir todo.  El segundo IP que
se especifique es el que esperamos como el IP de nuestro ISP.  Si lo
conocemos lo podemos especificar aqu&iacute;, pero en la l&iacute;nea no
sabemos cu&aacute;l se asignar&aacute;, as&iacute; que dejaremos que nos
lo digan.  Esto es muy &uacute;til al negociar con algunas
implementaciones PPP que no asignan un n&uacute;mero IP a menos que la
conexi&oacute;n les requiera ``0.0.0.0''.

<p>
La siguiente opci&oacute;n &quot;add default HISADDR&quot; es para
configurar la ruta predefinida hasta nuestra IP.  Si nuestra IP
cambiara, la ruta se actualizar&iacute;a de forma autom&aacute;tica.
Con &quot;enable dns&quot; indicamos a nuestro ISP que autentifique
nuestras direcciones <i>nameservers</i>.  Esto no debe hacerse si se
est&aacute; usando una DNS local, ya que ppp circunvalar&aacute; su uso
introduciendo algunas l&iacute;neas en <tt>/etc/resolv.conf</tt>.

<p>
<h3>C&oacute;mo usar PPP(8)</h3>

<p>
Ahora que ya tenemos el fichero <i>ppp.conf</i> configurado, podemos
intentar una conexi&oacute;n con nuestro ISP.  A continuaci&oacute;n se
dar&aacute;n algunos detalles sobre argumentos de uso com&uacute;n con
ppp.

<ul>
   <li><tt>ppp -auto myisp</tt> - Inicia ppp, configura las interfaces,
   conecta con el ISP, y a continuaci&oacute;n pasa a un plano de fondo.
   <li><tt>ppp -ddial myisp</tt> - Parecido a -auto, pero si la
   conexi&oacute;n cayera volver&iacute;a a conectar.
</ul>

<p>
Si se usa <tt>/usr/sbin/ppp</tt> sin pasarle ninguna opci&oacute;n,
pasar&aacute; al modo interactivo, desde donde se podr&aacute;
interaccionar directamente con el m&oacute;dem.  De este modo se pueden
depurar problemas en el fichero <tt>ppp.conf</tt>.

<p>
<h3>Acciones adicionales con ppp(8)</h3>

<p>
Si se necesitara ejecutar &oacute;rdenes al tiempo que se conecta o
desconecta, puede hacerse creando dos ficheros adicionales,
<tt>/etc/ppp/ppp.linkup</tt> y <tt>/etc/ppp/ppp.linkdown</tt>.  Pueden
verse ejemplos de configuraci&oacute;n para estos ficheros en:

<ul>
   <li><a href="http://www.openbsd.org/cgi-bin/cvsweb/src/etc/ppp/ppp.linkup.sample">ppp.linkup</a>
   <li><a href="http://www.openbsd.org/cgi-bin/cvsweb/src/etc/ppp/ppp.linkdown.sample">ppp.linkdown</a>
</ul>

<p>
Se puede obtener m&aacute;s informaci&oacute;n en el
<a href="http://www.freebsd.org/doc/es_ES.ISO8859-1/books/handbook/userppp.html">cap&iacute;tulo sobre <i>userppp</i> de la Gu&iacute;a de FreeBSD</a>.

<p>
<a name="Tuning"></a>
<h2>6.6 - Ajuste de par&aacute;metros de red</h2>
<!-- XXXrelease -->
<p>
<h3>6.6.1 - &iquest;C&oacute;mo se puede forzar al n&uacute;cleo del
sistema para obtener un mayor n&uacute;mero de reintentos y tiempos de
espera mayores en las sesiones de TCP?</h3>

<p>
Para problemas de conexi&oacute;n o enrutamiento se puede usar lo
siguiente (hay que tener en cuenta que para que sea más efectivo, ambos
lados de la conexi&oacute;n deben usar valores similares):

<p>
Para forzarlo hay que usar <tt>sysctl</tt> e incrementar los valores de:

<pre>
net.inet.tcp.keepinittime
net.inet.tcp.keepidle
net.inet.tcp.keepintvl
</pre>

<p>
Si se usa sysctl -a se podr&aacute;n ver los valores actuales de estos y
muchos otros par&aacute;metros.  Para cambiar cualquiera de ellos, hay
que usar <tt>sysctl -w</tt>; como por ejemplo en
<tt>sysctl -w net.inet.tcp.keepidle=28800</tt>.

<p>
<h3>6.6.2 - &iquest;C&oacute;mo se pueden activar emisiones
dirigidas?</h3>

<p>
Por lo general, no es aconsejable hacerlo ya que, si el sistema OpenBSD
es un enrutador, permite que se pueda enviar tr&aacute;fico a la
direcci&oacute;n o direcciones de emisi&oacute;n de nuestras redes.

<p>
En algunos casos, como en el de las redes cerradas, puede tener cierta
utilidad, en particular cuando se est&eacute;n usando implementaciones
antiguas del protocolo NetBIOS.  Se puede activar con
<tt>sysctl -w net.inet.ip.directed-broadcast=1</tt>.  Es convienente
informarse sobre los <a href="http://www.netscan.org">ataques
<i>&quot;smurf&quot;</i></a> para saber por qu&eacute; se encuentra
desactivado por definici&oacute;n.

<p>
<h3>6.6.3 - No quiero que el n&uacute;cleo haga asignaciones
din&aacute;micas de ciertos puertos</h3>

<p>
Tambi&eacute;n existe un sysctl para esto.  De la p&aacute;gina del
manual de
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=sysctl&amp;sektion=8">sysctl(8)</a>:

<pre>
A&ntilde;ada la lista de puertos TCP que no deber&iacute;an ser
asignados de forma din&aacute;mica por el n&uacute;cleo.  Esto puede
utilizarse para evitar que algunos d&aelig;mons se apropien de un cierto
puerto que sea necesario para el funcionamiento de otro programa.  La
lista de elementos puede ir separada por comas y/o espacios en blanco.

 #  <b>sysctl -w  net.inet.tcp.baddynamic=749,750,751,760,761,871</b>

Tambi&eacute;n se pueden a&ntilde;adir o eliminar puertos de la lista
actual.

 #  <b>sysctl -w net.inet.tcp.baddynamic=+748</b>
 #  <b>sysctl -w net.inet.tcp.baddynamic=-871</b>
</pre>

<p>
<a name="NFS"></a>
<h2>6.7 - Uso simple de NFS</h2>

<p>
El &laquo;Sistema de Archivos de Red&raquo; (NFS, <i>Network File
System</i>) se usa para compartir un sistema de archivos en una red.
Algunas p&aacute;ginas del manual que se deber&iacute;an leer antes de
intentar configurar un servidor de NFS son:

<ul>
<li><a href="http://www.openbsd.org/cgi-bin/man.cgi?query=nfsd&amp;sektion=8">nfsd(8)</a>
<li><a href="http://www.openbsd.org/cgi-bin/man.cgi?query=mountd&amp;sektion=8">mountd(8)</a>
<li><a href="http://www.openbsd.org/cgi-bin/man.cgi?query=exports&amp;sektion=5">exports(5)</a>
</ul>

<p>
En esta secci&oacute;n se detallar&aacute;n los pasos para una
configuraci&oacute;n simple de NFS.  El ejemplo ofrece detalles sobre un
servidor en una LAN, con clientes que tengan acceso NFS en la LAN.  En
esta secci&oacute;n no se tratar&aacute; sobre la seguridad de NFS.
Asumiremos que ya se ha configurado el paquete de filtros, u otra
protecci&oacute;n como cortafuegos, para prevenir el acceso desde el
exterior.  Si nuestra configuraci&oacute;n permite el acceso desde el
exterior a nuestro servidor de NFS, y si tenemos alg&uacute;n tipo de
datos confidenciales o importantes, es muy recomendable usar IPsec.  De
otro modo existe la posibilidad de que extra&ntilde;os puedan ver
nuestro tr&aacute;fico de NFS.  Tambi&eacute;n ser&iacute;a posible que
alguien pretendiera estar en la direcci&oacute;n IP a la que hayamos
autorizado la entrada en el servidor de NFS.  Existen varios tipos de
ataques efectivos en este aspecto.  Cuando IPsec est&aacute;
correctamente configurado, protege contra todos estos tipos de ataques.

<p>
Otra nota importante sobre seguridad.  No se debe a&ntilde;adir un
sistema de archivos a <tt>/etc/exports</tt> sin alg&uacute;n tipo de
lista de anfitriones autorizados.  Sin una lista de anfitriones que
puedan montar un directorio particular, cualquiera que pueda llegar al
anfitri&oacute;n podr&aacute; montar los directorios de NFS en
<tt>exports</tt>.

<p>
NFS depende de que
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=portmap&amp;sektion=8">portmap(8)</a>
se encuentre en ejecuci&oacute;n antes de poder operar.  Portmap(8),
desde la versi&oacute;n 3.2 de OpenBSD, se encuentra desactivado en el
modo predeterminado, y por lo tanto hay que activarlo en el fichero
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=rc.conf&amp;sektion=8">rc.conf(8)</a>
cambiando la l&iacute;nea de <tt>portmap</tt> as&iacute;:

<blockquote><pre>
portmap=YES
</pre></blockquote>

<p>
y reiniciar para que el cambio sea efectivo.

<p>
La configuraci&oacute;n consiste en un servidor con el ip
<b>10.0.0.1</b>, que servir&aacute; NFS s&oacute;lo a clientes dentro de
esa red.  El primer paso para configurar NFS es configurar el fichero
<tt>/etc/exports</tt>.  Este fichero se compone de una lista con los
sistemas de archivos que se quiera que sean accesibles por medio de NFS,
y define qui&eacute;n puede acceder a cada uno de ellos.  Existen muchas
opciones que puede usar en su fichero <tt>/etc/exports</tt>, y es
conveniente leer la p&aacute;gina del manual de
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=exports&amp;sektion=5">exports(5)</a>.
En este ejemplo empezaremos con un fichero <tt>/etc/exports</tt> como el
siguiente:

<blockquote><pre>
#
# Base de datos de NFS exports
# V&eacute;ase exports(5) para m&aacute;s informaci&oacute;n.  Vaya con
# cuidado, una mala configuraci&oacute;n puede hacer que
# sus sistemas de archivos sean legibles por todo el mundo.
/work -alldirs -ro -network 10.0.0 -mask 255.255.255.0
</pre></blockquote>

<p>
Esto quiere decir que el sistema de archivos local <tt>/work</tt>
estar&aacute; disponible a trav&eacute;s de NFS.  <tt>-alldirs</tt>
indica que los clientes podr&aacute;n montar en cualquier parte bajo el
punto de montaje <tt>/work</tt>.  <tt>-ro</tt> indica que
&uacute;nicamente se permitir&aacute; montarlo en modo de s&oacute;lo
lectura.  Los dos &uacute;ltimos argumentos indican que s&oacute;lo los
clientes dentro de la red 10.0.0.0 que usen una m&aacute;scara de red
255.255.255.0, estar&aacute;n autorizados a montar este sistema de
archivos.  Esto es importante en algunos servidores accesibles desde
diferentes redes.

<p>
Una vez que se haya configurado el fichero <tt>/etc/exports</tt>, se puede
continuar y pasar a configurar el servidor de NFS.  Primero hay que
asegurarse de que las opciones NFSSERVER y NFSCLIENT se encuentren en la
configuraci&oacute;n del n&uacute;cleo del sistema (el n&uacute;cleo
GENERIC incluye estas opciones).  A continuaci&oacute;n hay que
configurar <tt>nfs_server=YES</tt> en el fichero <tt>/etc/rc.conf</tt>.
De este modo, cuando se reinicie el sistema, se activar&aacute;n nfsd(8)
y mountd(8).  Ahora ya se pueden iniciar los d&aelig;mons.  Estos
d&aelig;mons deben ser iniciados por el superusuario, <i>root</i>, y es
necesario asegurarse de que portmap(8) est&eacute; en funcionamiento en
el sistema.  El ejemplo que sigue sobre c&oacute;mo iniciar nfsd(8)
sirve tanto para TCP como para UDP usando 4 d&aelig;mons.  Para
gestionar el m&aacute;ximo n&uacute;mero de requerimientos de clientes
concurrentes a los que se quiera dar servicio, hay que activar un
n&uacute;mero apropiado de d&aelig;mons del servidor de NFS.

<blockquote><pre>
# <b>/sbin/nfsd -tun 4</b>
</pre></blockquote>

<p>
No s&oacute;lo se debe iniciar el servidor de nfsd(8), sino que
tambi&eacute;n es necesario iniciar mountd(8).  &Eacute;ste es el
d&aelig;mon que da servicio a los requerimientos para montar en NFS.
Para iniciar mountd(8), hay que asegurarse de que existe un fichero
vac&iacute;o <tt>mountdtab</tt> e invocar el d&aelig;mon:

<blockquote><pre>
# <b>echo -n &gt;/var/db/mountdtab</b>
# <b>/sbin/mountd</b>
</pre></blockquote>

<p>
Si se hace alg&uacute;n cambio en el fichero <tt>/etc/exports</tt>
mientras NFS est&eacute; funcionando, se tendr&aacute; que avisar a
mountd sobre el cambio pas&aacute;ndole una se&ntilde;al
&quot;HUP&quot;:

<blockquote><pre>
# <b>kill -HUP `cat /var/run/mountd.pid`</b>
</pre></blockquote>

<p>
<h3>Comprobaci&oacute;n de estad&iacute;sticas en NFS</h3>

<p>
Se pueden realizar comprobaciones para asegurarse de que estos
d&aelig;mons est&eacute;n funcionando y registrados con RPC.  Para ello
se usa rcpinfo(8).

<blockquote><pre>
$ <b>rpcinfo -p 10.0.0.1</b>
   program vers proto   port
    100000    2   tcp    111  portmapper
    100000    2   udp    111  portmapper
    100005    1   udp    633  mountd
    100005    3   udp    633  mountd
    100005    1   tcp    916  mountd
    100005    3   tcp    916  mountd
    100003    2   udp   2049  nfs
    100003    3   udp   2049  nfs
    100003    2   tcp   2049  nfs
    100003    3   tcp   2049  nfs
</pre></blockquote>

<p>
Durante su uso normal, existen unas pocas utilidades más que nos
permitir&aacute;n ver lo que est&aacute; ocurriendo con NFS.  Una de
ellas es
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=showmount&amp;sektion=8">showmount(8)</a>
que nos permite ver qu&eacute; se encuentra montado y qui&eacute;n lo
est&aacute; montando.  Tambi&eacute;n est&aacute; nfsstat(8), que
muestra una informaci&oacute;n de las estad&iacute;sticas mucho
m&aacute;s amplia.  Para usar showmount(8), basta con escribir
<tt>/usr/bin/showmount -a host</tt>.  Por ejemplo:

<blockquote><pre>
$ <b>/usr/bin/showmount -a 10.0.0.1</b>
All mount points on 10.0.0.1:
10.0.0.37:/work
</pre></blockquote>

<p>
<h3>C&oacute;mo montar Sistemas de Archivos de Red (NFS)</h3>

<p>
Los sistemas de archivos NFS se deben montar mediante mount(8) o,
m&aacute;s exactamente, mediante
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=mount_nfs&amp;sektion=8">mount_nfs(8)</a>.
Para montar el sistema de archivos <tt>/work</tt> del anfitri&oacute;n
10.0.0.1 en un sistema de archivo local <tt>/mnt</tt>, se debe hacer lo
siguiente (no es necesario usar una direcci&oacute;n IP, mount se
encargar&aacute; de la resoluci&oacute;n de nombres):

<blockquote><pre>
# <b>mount -t nfs 10.0.0.1:/work /mnt</b>
</pre></blockquote>

<p>
Para que el sistema se monte al iniciar, hay que a&ntilde;adir algo como
lo que viene a continuaci&oacute;n en el fichero <tt>/etc/fstab</tt>:

<blockquote><pre>
10.0.0.1:/work /mnt nfs rw 0 0
</pre></blockquote>

<p>
&iexcl;&iexcl;Es importante usar <tt>0 0</tt> al final de esta
l&iacute;nea para que la m&aacute;quina no intente ejecutar fsck sobre
el sistema de archivo NFS durante el inicio del sistema!!  El resto de
opciones de seguridad t&iacute;picas, como noexec, nodev y nosuid,
tambi&eacute;n deber&iacute;an usarse donde sean posibles, como en:

<blockquote><pre>
10.0.0.1:/work /mnt nfs rw,nodev,nosuid 0 0
</pre></blockquote>

<p>
De este modo ning&uacute;n dispositivo o programa setuid en el servidor
de NFS podr&aacute; traspasar las medidas de seguridad en el cliente de
NFS.  Si los programas que se monten no deben ser ejecutados por el
cliente de NFS, se debe a&ntilde;adir noexec a esta lista.

<p>
<a name="PPTP"></a>
<h2>6.8 - Configuraci&oacute;n de una conexi&oacute;n PPTP en
OpenBSD</h2>

<p>
<strong>NOTA:</strong> Esta informaci&oacute;n no es v&aacute;lida para
<strong>TODOS</strong> los proveedores de conexiones ADSL, pero mucha de
la informaci&oacute;n que aqu&iacute; se encuentra se puede usar como
base.  Esta informaci&oacute;n s&oacute;lo se ha verificado con
<a href="http://www.inode.at">Inode</a>, un proveedor de ADSL en
Austria.

<p>
Antes que nada hay que instalar <i>pptp</i>.  El porte de <i>pptp</i> se
encuentra en <tt>/usr/ports/net/pptp</tt>.  Se puede encontrar
m&aacute;s informaci&oacute;n sobre el &aacute;rbol de portes de OpenBSD
en la secci&oacute;n sobre los
<a href="faq8.html#Ports"><tt>Portes</tt></a> del cap&iacute;tulo 8 de
estos documentos.

<p>
Debido a un conflicto entre el soporte integrado en el n&uacute;cleo de
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=gre&amp;sektion=4">gre(4)</a>
y pptp, es preciso recompilar el n&uacute;cleo del sistema, eliminando
el soporte para gre(4).

<blockquote>Parche para eliminar el soporte para GRE(4).
<pre>
Index: GENERIC
===================================================================
RCS file: /cvs/src/sys/conf/GENERIC,v
retrieving revision 1.86
diff -u -r1.86 GENERIC
--- GENERIC     14 Mar 2002 00:42:25 -0000      1.86
+++ GENERIC     17 May 2002 01:52:17 -0000
@@@@ -87,7 +87,7 @@@@
 pseudo-device  enc     1       # option IPSEC needs the encapsulation interface
 pseudo-device  bridge  2       # network bridging support
 pseudo-device  vlan    2       # IEEE 802.1Q VLAN
-pseudo-device  gre     1       # GRE encapsulation interface
+#pseudo-device gre     1       # GRE encapsulation interface
 #pseudo-device strip   1       # Starmode Radio IP interface

 pseudo-device  pty     64      # pseudo-terminals
</pre>
</blockquote>

<p>
Para recompilar el n&uacute;cleo, antes hay que obtener el c&oacute;digo
fuente de OpenBSD mediante cvs (v&eacute;ase la p&aacute;gina de
<a href="../../es/anoncvs.html">AnonCVS</a> para m&aacute;s
informaci&oacute;n), aplicar el parche anterior, y recompilar el
n&uacute;cleo tal y como se indica en la secci&oacute;n sobre la
<a href="faq5.html#Building"><tt>compilaci&oacute;n del
n&uacute;cleo</tt></a> del cap&iacute;tulo 5 de estos documentos.

<p>
Una vez que ya se haya instalado el paquete <b>pptp</b> y el nuevo
n&uacute;cleo, hay que editar unos cuantos ficheros para configurar la
conexi&oacute;n.  Este paquete utiliza el programa de
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=ppp&amp;sektion=8">ppp(8)</a>
nativo de OpenBSD;  si se est&aacute; familiarizado con ppp(8), gran
parte de la configuraci&oacute;n es id&eacute;ntica.  V&eacute;se
tambi&eacute;n la secci&oacute;n sobre <a href="#PPP">PPP</a> de este
documento.

<ul>
<li>1 - /etc/ppp/options
<li>2 - /etc/ppp/pap-secrets
</ul>

<p>
Para el fichero <tt>/etc/ppp/options</tt>, una configuraci&oacute;n como
la siguiente ser&aacute; probablemente todo lo que se necesite:

<blockquote><pre>
# <b>cat /etc/ppp/options</b>
name &quot;LOGINNAME&quot;
noauth
noipdefault
defaultroute
debug
</pre></blockquote>

<p>
Se debe sustituir <tt>LOGINNAME</tt> con el identificador de usuario.

<p>
Para el fichero <tt>/etc/ppp/pap-secrets</tt> se necesitar&aacute; una
l&iacute;nea como &eacute;sta:

<blockquote><pre>
# <b>cat /etc/ppp/pap-secrets</b>
LOGINNAME 10.0.0.138 PASSWORD
</pre></blockquote>

<p>
en donde LOGINNAME es el identificador de usuario y PASSWORD la
contrase&ntilde;a.  10.0.0.138 es la direcci&oacute;n IP asignada al
m&oacute;dem en caso de que se use ADSL, etc.  Hay que asegurarse de que
este fichero s&oacute;lo pueda ser le&iacute;do por es superusuario
<i>root</i> (modo 600).

<p>
<h3>6.8.1 - Asignaci&oacute;n de una direcci&oacute;n a la interfaz de
red</h3>

<p>
En el ejemplo anterior, el m&oacute;dem ten&iacute;a una interfaz
10.0.0.38 preconfigurada.  Pero ahora necesitaremos asignar
una direcci&oacute;n a NUESTRA interfaz.  Lo mejor es escoger
una direcci&oacute;n de IP cercana a la asignada para el MODEM, o
usar la direcci&oacute;n de IP est&aacute;tica que nos hayan
asignado.  La secci&oacute;n sobre
<a href="#Setup"><tt>Configuraci&oacute;n inicial de la red</tt></a> de
este documento contiene m&aacute;s informaci&oacute;n sobre la
configuraci&oacute;n de interfaces.

<p>
Una vez que hayamos configurado la interfaz, deber&iacute;amos estar en
disposici&oacute;n de establecer una conexi&oacute;n pptp con la orden:

<blockquote><pre>
# <b>/usr/local/sbin/pptp 10.0.0.138 &amp;</b>
</pre></blockquote>

<p>
Como ya hemos dicho, se usar&aacute; el ppp(8) nativo de OpenBSD, y se
iniciar&aacute;n dos procesos;  en consecuencia, para matar pptp
ser&aacute; necesario matar estos dos procesos:

<blockquote><pre>
# <b>kill -9 [pid de pppd]</b>
$ <b>kill -9 [pid de pptp]</b>
</pre></blockquote>

<p>
Es recomendable abrir <tt>/var/log/messages</tt> en una ventana de
terminal aparte, para poder reconocer cualquier posible problema.

<blockquote><pre>
# <b>tail -f /var/log/messages</b>
</pre></blockquote>

<p>
Tambi&eacute;n es aconsejable poner la orden de inicio en
<tt>/etc/rc.local</tt> para que se conecte de forma autom&aacute;tica
cuando se reinicie el sistema.


<p>
<a name="Bridge"></a>
<h2>6.9 - C&oacute;mo configurar un &laquo;puente de red&raquo; en
OpenBSD</h2>

<p>
Un puente de red
(o <a href="http://www.openbsd.org/cgi-bin/man.cgi?query=bridge&amp;sektion=4">bridge</a>)
es un enlace entre dos o m&aacute;s redes separadas entre s&iacute;.  A
diferencia de los enrutadores, la transferencia de paquetes a
trav&eacute;s de un puente de red es &laquo;invisible&raquo;;
l&oacute;gicamente, los dos segmentos de red aparecen como un solo
segmento a los nodos de cada extremo del puente.  El puente s&oacute;lo
reenv&iacute;a aquellos paquetes que deban pasar desde un segmento hacia
el otro, por lo que, entre otras cosas, ofrecen una forma f&aacute;cil
para reducir el tr&aacute;fico en una red compleja, y a&uacute;n
as&iacute;, permiten que cualquier nodo pueda acceder a otro nodo
cualquiera siempre que esto sea preciso.

<p>
N&oacute;tese que, debido a esta &laquo;naturaleza invisible&raquo;, una
interfaz en un puente puede o no tener una direcci&oacute;n IP propia.
Si la tiene, la interfaz tendr&aacute; dos modos de operaci&oacute;n,
uno que ser&aacute; parte de un puente y el otro un NIC normal
independiente.  Si ninguna de las interfaces tiene una direcci&oacute;n
IP, entonces el puente pasar&aacute; los datos de red, pero no se
podr&aacute; mantener externamente (esto se puede considerar una
funcionalidad).

<p>
<h3>Ejemplo de una aplicaci&oacute;n de puente de red</h3>

<p>
Uno de mis bastidores tiene unos cuantos sistemas ya viejos, y ninguno
de &eacute;stos tiene un NIC 10BASE-TX integrado.  Aunque todos tienen
un conector AUI o AAUI, mis transportadores se limitan al cable coaxial.
Una de las m&aacute;quinas en este bastidor es un servidor de OpenBSD
que siempre est&aacute; conectado a la red de alta velocidad.
A&ntilde;adi&eacute;ndole un segundo NIC con puerto coaxial puedo usar
esta m&aacute;quina como un puente de red hacia la red coaxial.

<p>
Ahora este sistema tiene dos NIC, una tarjeta Intel EtherExpress/100
(<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=fxp&amp;sektion=4"><tt>fxp0</tt></a>)
y otra tarjeta 3c590-Combo
(<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=ep&amp;sektion=4"><tt>ep0</tt></a>)
para el puerto coaxial.  <tt>fxp0</tt> es el enlace con el resto de mi
red, y por lo tanto tendr&aacute; una direcci&oacute;n IP;  <tt>ep0</tt>
s&oacute;lo se va a usar para el puente, y por lo tanto no tendr&aacute;
ninguna direcci&oacute;n IP.  Las m&aacute;quinas conectadas al segmento
coaxial se comunican como si estuvieran en el resto de la red...
&iquest;c&oacute;mo se hace esto?

<p>
El fichero <tt>hostname.fxp0</tt> contiene la informaci&oacute;n de
configuraci&oacute;n de la tarjeta <tt>fxp0</tt>.  Esta m&aacute;quina
est&aacute; configurada mediante DCHP, por lo que el fichero es como
sigue:

<blockquote><pre>
$ <b>cat /etc/hostname.fxp0</b>
dhcp NONE NONE NONE NONE
</pre></blockquote>

<p>
Hasta aqu&iacute; sin sorpresas.

<p>
La tarjeta <tt>ep0</tt> es, l&oacute;gicamente, algo diferente:

<blockquote><pre>
$ <b>cat /etc/hostname.ep0</b>
up media 10base2
</pre></blockquote>

<p>
Aqu&iacute; pasamos al sistema la instrucci&oacute;n de activar esta
interfaz usando
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=ifconfig&amp;sektion=8">ifconfig(8)</a>,
y de configurarla como 10BASE-2 (coaxial).  No es necesario especificar
ninguna direcci&oacute;n IP ni informaci&oacute;n parecida para esta
interfaz.  Las opciones que acepta la tarjeta <tt>ep</tt> se pueden
encontrar en la p&aacute;gina del manual de
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=ep&amp;sektion=4">
ep(4)</a>.

<p>
Ahora necesitamos configurar el puente de red.  Los puentes de red se
inician siempre que exista un fichero que se llame algo como
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=bridgename.if&amp;sektion=5"><tt>nombre_puente.bridge0</tt></a>.
He aqu&iacute; un ejemplo de mi situaci&oacute;n:

<blockquote><pre>
$ <b>cat /etc/bridgename.bridge0</b>
add fxp0
add ep0
up
</pre></blockquote>

<p>
Lo que dice es que se configure un puente de red que consista de dos
NIC, fxp0 y ep0, y que se active.  No importa el orden en que aparezcan
las tarjetas, recu&eacute;rdese que un puente de red es muy
sim&eacute;trico, los paquetes pasan en ambas direcciones.

<p>
&iexcl;Eso es todo!  Despu&eacute;s de reiniciar ya tendremos un puente
de red totalmente funcional.

<p>
<h3>Filtros de paquetes en un puente de red</h3>
<p>
Aunque existen varios usos para un puente de red simple como
&eacute;ste, es muy probable que quiera hacer algo con los paquetes
mientras pasan a trav&eacute;s del puente.  Se puede usar
<a href="#PF">PF</a> para restringir el tr&aacute;fico que pasar&aacute;
a trav&eacute;s del puente.

<p>
Hay que tener en cuenta que, por la naturaleza del puente, los mismos
datos pasar&aacute;n a trav&eacute;s de ambas interfaces, por lo que
s&oacute;lo ser&aacute; necesario filtrar en una sola interfaz.  Las
reglas &quot;Pass all&quot; pueden quedar as&iacute;:

<blockquote><pre>
pass in  on ep0  all
pass out on ep0  all
pass in  on fxp0 all
pass out on fxp0 all
</pre></blockquote>

<p>
Supongamos ahora que quiero filtrar el tr&aacute;fico que llegue a estas
viejas m&aacute;quinas, y que s&oacute;lo quiero que pase el
tr&aacute;fico de <i>web</i> y SSH por ellas.  En este caso dejaremos
salir y entrar todo el tr&aacute;fico de la interfaz ep0, y filtraremos
el de la interfaz fxp0, usando &quot;keep state&quot; para manejar la
respuesta de datos:

<blockquote><pre>
# Pass all traffic through ep0
pass in quick on ep0 all
pass out quick on ep0 all

# Block fxp0 traffic
block in  on fxp0 all
block out on fxp0 all

pass in quick on fxp0 proto tcp from any to any port {22, 80} \
     flags S/SA keep state
</pre></blockquote>

<p>
N&oacute;tese que este grupo de reglas evitar&aacute; que llegue
cualquier tr&aacute;fico a la m&aacute;quina que funciona como puente de
red o a cualquier otro nodo &laquo;detr&aacute;s&raquo; de ella, excepto
el tr&aacute;fico entrante de HTTP y SSH.  Es posible obtener otros
resultado filtrando la otra interfaz.

<p>
Para monitorizar y controlar el puente, se puede usar la orden
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=brconfig&amp;sektion=8">brconfig(8)</a>,
que tambi&eacute;n puede ser usada para crear un puente de red
despu&eacute;s del arranque.

<p>
<h3>Consejos</h3>

<ul>
<li>Es MUY recomendable filtrar en una sola interfaz.  Aunque se puede
filtrar en ambas, para ello hay que saber muy bien lo que se est&aacute;
haciendo.

<li>Usando la opci&oacute;n <i>blocknonip</i> de
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=brconfig&amp;sektion=8">brconfig(8)</a>
o en
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=bridgename.if&amp;sektion=5">bridgename.bridge0</a>,
se puede evitar que se cuele tr&aacute;fico no IP (como IPX o NETBEUI)
por los filtros.  Hay que tener en cuenta que los puentes de red
funcionan para todo tipo de tr&aacute;fico, no s&oacute;lo para IP.

<li>Un puente de red requiere que los NIC est&eacute;n en &laquo;modo
prom&iacute;scuo&raquo; (que est&eacute;n a la escucha para TODO el
tr&aacute;fico de red, no s&oacute;lo para el de la interfaz
redireccionada).  Esto implica una mayor carga en el procesador y el bus
de la esperada.  Algunos NIC no funcionan correctamente en este modo; el
<i>chip</i> TI ThunderLAN
(<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=tl&amp;sektion=4">tl(4)</a>)
es un ejemplo de un <i>chip</i> que no funciona como parte de un puente.
</ul>


<p>
<font color="#0000e0">
<a href="index.html">[&Iacute;ndice de documentos]</a>
<a href="faq5.html">[Secci&oacute;n 5 - Compilaci&oacute;n del sistema
con el c&oacute;digo fuente]</a>
<a href="faq7.html">[Secci&oacute;n 7 - Controles de teclado y
pantalla]</a>
</font>

<p>
<hr>
<a href="index.html"><img height="24" width="24" src="../../back.gif" border="0" alt="[&iacute;ndice]"></a>
<a href="mailto:www@@openbsd.org">www@@openbsd.org</a>
<br>
<small>
Originally [OpenBSD: faq6.html,v 1.182 ]<br>
$Translation: faq6.html,v 1.99 2004/01/04 19:59:59 horacio Exp $<br>
$OpenBSD: faq6.html,v 1.84 2004/01/04 22:23:57 horacio Exp $
</small>
</body>
</html>
@


1.84
log
@Sync with Steelix CVS
@
text
@d1494 1
a1494 1
$OpenBSD$
@


1.83
log
@Sync with Steelix CVS
@
text
@d12 1
a12 1
<meta name="copyright"     content="Este documento es copyright 1998-2003 de OpenBSD.">
d1492 2
a1493 2
Originally [OpenBSD: faq6.html,v 1.181 ]<br>
$Translation: faq6.html,v 1.98 2003/11/17 18:49:01 horacio Exp $<br>
@


1.82
log
@Sync with Steelix CVS
@
text
@d1239 1
a1239 1
<h3>6.9.1 - Asignaci&oacute;n de una direcci&oacute;n a la interfaz de
d1492 2
a1493 2
Originally [OpenBSD: faq6.html,v 1.180 ]<br>
$Translation: faq6.html,v 1.97 2003/11/02 19:29:50 horacio Exp $<br>
@


1.81
log
@sync with steelix cvs
@
text
@d35 4
a38 3
<li><a href="#Intro">6.0.1 - Introducci&oacute;n</a>
<li><a href="#Setup">6.1 - Configuraci&oacute;n inicial de la red</a>
<li><a href="#PF">6.2 - El subsistema de Filtro de Paquetes IP (PF)</a>
d45 1
a45 1
<li><a href="#PPTP">6.9 - Configuraci&oacute;n de una conexi&oacute;n
d47 1
a47 1
<li><a href="#Bridge">6.10 - Configuraci&oacute;n de un &laquo;puente de
d55 1
a55 1
<h2>6.0.1 - Introducci&oacute;n</h2>
d98 1
a98 1
<h2>6.1 - Configuraci&oacute;n inicial de la red</h2>
d102 1
a102 1
<h3>6.1.1 - Identificaci&oacute;n y configuraci&oacute;n de las
d202 1
a202 1
<li><a href="http://www.openbsd.org/cgi-bin/man.cgi?query=pflog&amp;sektion=4&amp;manpath=OpenBSD+3.3">pflog</a> - Interfaz de registros del Filtro de Paquetes (<i>PF</i>)
d365 1
a365 1
<h3>6.1.2 - Configuraci&oacute;n del sistema OpenBSD como pasarela
d428 1
a428 1
<h3>6.1.3 - Configuraci&oacute;n de un alias en una interfaz</h3>
d508 2
a509 1
<h2>6.2 - El subsistema de Filtro de Paquetes IP (PF)</h2>
d516 3
a518 3
ancho de banda y priorizaci&oacute;n de paquetes.  PF ha sido parte
integral del n&uacute;cleo GENERIC del sistema OpenBSD desde OpenBSD
3.0.  Su configuraci&oacute;n y funcionamiento se describe en la nueva
a520 4
<p>
El viejo documento sobre PF todav&iacute;a se encuentra disponible
<a href="faq6pf.html">aqu&iacute;</a>.

d1136 1
a1136 1
<h2>6.9 - Configuraci&oacute;n de una conexi&oacute;n PPTP en
d1287 1
a1287 1
<h2>6.10 - Configuraci&oacute;n de un &laquo;puente de red&raquo; en
a1395 1
<!-- XXXchanges - changes with OpenBSD 3.3 -->
d1492 2
a1493 2
Originally [OpenBSD: faq6.html,v 1.178 2003/09/09 02:08:41 nick Exp ]<br>
$Translation: faq6.html,v 1.96 2003/09/10 09:34:13 horacio Exp $<br>
@


1.80
log
@sync with steelix translation CVS
@
text
@d538 1
a538 1
palabra clave 'dhcp':
d587 4
a590 4
a&ntilde;adiendo dhcp_flags=&quot;-q&quot; en lugar de dhcp_flags=NO.
Tambi&eacute;n hay que a&ntilde;adir en <tt>/etc/dhcp.interfaces</tt>
las interfaces en las que se quiera que dhcp est&eacute; <b>a la
escucha</b>:
d1495 2
a1496 2
Originally [OpenBSD: faq6.html,v 1.177 2003/07/25 20:05:19 nick Exp ]<br>
$Translation: faq6.html,v 1.95 2003/08/15 16:03:19 horacio Exp $<br>
@


1.79
log
@sync with steelix translation CVS
@
text
@d107 3
a109 3
por el tipo de tarjeta, no por el tipo de conexi&oacute;n.  Se puede ver
la tarjeta de red durante el arranque, mientras se inicia el sistema, o
despu&eacute;s del arranque, usando la orden
d111 1
a111 1
Tambi&eacute;n se puede ver la interfaz de red usando la orden
d115 1
a115 1
dispositivo fxp.
d125 1
a125 1
Si se desconoce es el nombre del dispositivo, se puede buscar en la
d128 3
a130 3
muchos nombres de tarjetas comunes y sus correspondientes nombres de
dispositivo en OpenBSD.  Combinando el nombre abreviado
alfab&eacute;tico (como fxp) con un n&uacute;mero asignado por el
d132 1
a132 1
(como fxp0).
d136 1
a136 1
usando la utilidad 
d139 4
a142 3
existan en un sistema.  Esta salida muestra s&oacute;lo una interfaz
f&iacute;sica de ethernet, la
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=fxp&amp;sektion=4">fxp(4)</a>.
d186 1
a186 1
nuestra interfaz.  En el ejemplo anterior, la tarjeta de la interfaz ya
d213 4
a216 4
Si la interfaz no se ha configurado, el primer paso ser&aacute; crear el
fichero <tt>/etc/hostname.xxx</tt>, donde se debe sustituir <tt>xxx</tt>
por el nombre de la interfaz.  De acuerdo con la informaci&oacute;n de
los ejemplos anteriores, el nombre ser&iacute;a
d227 1
a227 1
(Puede verse m&aacute;s informaci&oacute;n sobre el formato de este
d233 2
a234 2
configurada para una direcci&oacute;n de IPv4, ser&iacute;a parecido a
lo siguiente:
d244 2
a245 2
Tambi&eacute;n se podr&iacute;a especificar tipos de media para
Ethernet, por ejemplo, si se quisiera forzar el modo 100baseTX
d253 4
a256 4
Aunque nunca se debe forzar el modo <i>full duplex</i> a menos que ambas
partes de la conexi&oacute;n est&eacute;n configuradas para hacerlo.  A
menos que sea necesario por alg&uacute;n motivo especial, la
configuraci&oacute;n del tipo de media se debe excluir.
d259 3
a261 3
O puede que se prefiera usar indicadores especiales para especificar una
cierta interfaz.  &iexcl;El formato del fichero <i>hostname</i> no
cambiar&aacute; mucho!
d283 2
a284 2
servidores de dominio son 125.2.3.4 y 125.2.3.5.  Tambi&eacute;n
pertenece al dominio &laquo;example.com&raquo;.
d313 6
a318 6
N&oacute;tese que se produce un peque&ntilde;o n&uacute;mero de errores.
Pero al ejecutar este gui&oacute;n, se reconfingurar&aacute;n cosas que
ya se hab&iacute;an configurado anteriormente.  De hecho, algunas rutas
ya existen en la tabla de enrutamiento del n&uacute;cleo del sistema.
Desde aqu&iacute;, el sistema deber&iacute;a funcionar con normalidad.
Se puede realizar una comprobaci&oacute;n con
d326 2
a327 2
<i>hostname</i>.  He aqu&iacute; un ejemplo en el que se ven las tablas
de enrutamiento usando ambos programas.
d368 4
a371 4
&Eacute;sta es la informaci&oacute;n b&aacute;sica necesaria para
configurar el sistema OpenBSD como una pasarela (tambi&eacute;n conocida
como &laquo;enrutador&raquo; o &laquo;encaminador&raquo;).  Si se va a
usar OpenBSD como un enrutador en Internet, sugerimos la lectura de la
d374 2
a375 2
tr&aacute;fico que sea potencialmente malicioso.  Adem&aacute;s, debido
a la escasa disponibilidad de direcciones de
d385 4
a388 4
reenv&iacute;o de IP (<i>IP Forwarding</i>), pero debe ser activado.
Para activarlo hay que usar la utilidad
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=sysctl&amp;sektion=8">sysctl(8)</a>.
Para que los cambios sean permanentes, hay que editar el fichero
d392 1
a392 1
configuraci&oacute;n.
d404 3
a406 3
Recu&eacute;rdese que este cambio todav&iacute;a no existir&aacute;
despu&eacute;s de reiniciar, y que habr&aacute; que ejecutarlo como
superusuario.
d416 3
a418 3
A continuaci&oacute;n se debe modificar las rutas en los otros
anfitriones en ambos extremos.  OpenBSD ofrece muchas posibilidades de
uso como enrutador, usando <i>software</i> como 
d430 3
a432 3
OpenBSD dispone de un simple mecanismo para la configuraci&oacute;n de
los alias de IP en una interfaz.  Para configurarlos s&oacute;lo hay que
editar el fichero
d434 1
a434 1
El gui&oacute;n
d448 2
a449 2
Unas notas sobre los alias:  en OpenBSD s&oacute;lo se usa el nombre de
la interfaz y no existen diferencias entre el primer alias y el segundo;
d453 4
a456 4
estamos a&ntilde;adiendo un alias, debemos asegurarse de escribir
'<kbd>ifconfig int alias</kbd>' en lugar de '<kbd>ifconfig int</kbd>' en
la l&iacute;nea de &oacute;rdenes.  Se puede eliminar los alias con la
orden '<kbd>ifconfig int delete</kbd>'.
d461 6
a466 6
configuraci&oacute;n del enmascaramiento de red (<i>netmask</i>) para
cada alias pasa a ser 255.255.255.255.  No necesitan seguir el
<i>netmask</i> del primer IP vinculado a la interfaz.  En el siguiente
<tt>/etc/hostname.dc0</tt> de ejemplo, se a&ntilde;aden dos alias al
dispositivo <b>dc0</b>, el cual, por cierto, se configur&oacute; como
192.168.0.2 netmask 255.255.255.0.
d535 4
a538 3
interfaz principal de ethernet sea xl0) para modificarlo;  la interfaz
podr&iacute;a ser ep0, o fxp0, o cualquier otra).  La &uacute;nica
modificaci&oacute;n necesaria en este fichero es a&ntilde;adir 'dhcp'.
d551 3
a553 3
Si se quiere iniciar un cliente dhcp desde la l&iacute;nea de
&oacute;rdenes, hay que asegurarse de que el fichero
<tt>/etc/dhclient</tt> exista, y entonces usar la orden:
d568 1
a568 1
anular la configuraci&oacute;n predefinida de dhclient).
d577 1
a577 1
Tambi&eacute;n es posible que se quiera anular hostname u otras
d584 1
a584 1
Si se quiere usar OpenBSD como servidor DHCP con
d586 1
a586 1
hay que editar el fichero <tt>/etc/rc.conf</tt>, y configurarlo
d615 3
a617 3
192.168.1.3 y 192.168.1.5.  Para los anfitriones que se encuentren en la
misma red que una interfaz de ethernet en la m&aacute;quina de OpenBSD,
que est&aacute; en el rango 192.168.1.0/24, les asignar&aacute; una
d619 1
a619 1
configuraci&oacute;n predeterminada de la pasarela como 192.168.1.1.
d631 3
a633 3
En donde <tt>fxp0</tt> es la interfaz que se quiere que empiece a servir
dhcp.  El indicador <tt>-q</tt> fuerza una salida silenciosa de dhcpd,
ya que de otro modo es muy ruidoso.
d637 2
a638 2
Windows, es posible que se desee que dhcpd(8) ofrezca al cliente una
direcci&oacute;n de servidor 'WINS'.  Para ello se debe a&ntilde;adir la
d647 2
a648 2
Samba.  Para ver m&aacute;s opciones que puedan aceptar sus clientes
DHCP, v&eacute;se
d656 4
a659 3
El &laquo;Protocolo Punto a Punto&raquo;, PPP, es el que se suele usar
para crear una conexi&oacute;n con su ISP a trav&eacute;s de un
m&oacute;dem.  OpenBSD puede hacer esto de dos maneras:
d662 2
a663 2
<li><a href="http://www.openbsd.org/cgi-bin/man.cgi?query=pppd&amp;sektion=8">pppd(8)</a> - Es el d&aelig;mon ppp del n&uacute;cleo (<i>kernel</i>) del sistema.
<li><a href="http://www.openbsd.org/cgi-bin/man.cgi?query=ppp&amp;sektion=8">ppp(8)</a> - Es el d&aelig;mon ppp del modo de usuario.
d708 8
a715 8
empezaremos con la m&aacute;s simple, y probablemente m&aacute;s
utilizada, configuraci&oacute;n.  A continuaci&oacute;n puede verse un
peque&ntilde;o fichero <tt>ppp.conf</tt> que realizar&aacute; la
conexi&oacute;n con el ISP y usar&aacute; nuestras rutas predefinidas y
nuestro <i>nameserver</i>.  Para este fichero, toda la
informaci&oacute;n que necesitaremos ser&aacute; el n&uacute;mero de
tel&eacute;fono de nuestro ISP, nuestro nombre de usuario, y nuestro
contrase&ntilde;a.
d726 7
a732 6
La secci&oacute;n bajo la opci&oacute;n <tt>default:</tt> se ejecutada
cada vez que se requiera una conexi&oacute;n.  En ella se configura toda
la informaci&oacute;n cr&iacute;tica.  Con &quot;set log&quot; se
configuran los niveles de ingreso.  Esto se puede cambiar; para
m&aacute;s informaci&oacute;n sobre c&oacute;mo configurar los niveles
de ingreso v&eacute;ase la p&aacute;gina del manual de
d765 1
a765 1
Aqu&iacute; hemos configurado informaci&oacute;n esencial para un ISP
d847 1
a847 1
<a href="http://www.freebsd.org/doc/en_US.ISO8859-1/books/handbook/userppp.html">cap&iacute;tulo sobre <i>userppp</i> de la Gu&iacute;a de FreeBSD</a>.
d883 1
a883 1
Por lo general, no es aconsejable hacerlo, ya que si el sistema OpenBSD
d1293 2
a1294 1
Un puente o <a href="http://www.openbsd.org/cgi-bin/man.cgi?query=bridge&amp;sektion=4">bridge</a>
d1297 1
a1297 1
trav&eacute;s de un puente es &laquo;invisible&raquo;;
d1317 1
a1317 1
<h3>Ejemplo de una aplicaci&oacute;n de puente</h3>
d1326 1
a1326 1
esta m&aacute;quina como un puente hacia la red coaxial.
d1374 2
a1375 2
Ahora necesitamos configurar el puente.  Los puentes se inician siempre
que exista un fichero que se llame algo como
d1387 4
a1390 4
Lo que dice es que se configure un puente que consista de dos NIC, fxp0
y ep0, y que se active.  No importa el orden en que aparezcan las
tarjetas, recu&eacute;rdese que un puente es muy sim&eacute;trico, los
paquetes pasan en ambas direcciones.
d1394 1
a1394 1
totalmente funcional.
d1397 1
a1397 1
<h3>Filtros de paquetes en un puente (<i>bridge</i>)</h3>
d1400 5
a1404 5
Aunque existen varios usos para un puente simple como &eacute;ste, es
muy probable que quiera hacer algo con los paquetes mientras pasan a
trav&eacute;s del puente.  Se puede usar <a href="#PF">PF</a> para
restringir el tr&aacute;fico que pasar&aacute; a trav&eacute;s del
puente.
d1442 4
a1445 4
cualquier tr&aacute;fico a la m&aacute;quina puente o a cualquier otro
nodo &laquo;detr&aacute;s&raquo; de ella, excepto el tr&aacute;fico
entrante de HTTP y SSH.  Es posible obtener otros resultado filtrando la
otra interfaz.
d1450 2
a1451 2
que tambi&eacute;n puede ser usada para crear un puente despu&eacute;s
del arranque.
d1466 2
a1467 2
por los filtros.  Hay que tener en cuenta que los puentes funcionan para
todo tipo de tr&aacute;fico, no s&oacute;lo para IP.
d1469 1
a1469 1
<li>Un puente requiere que los NIC est&eacute;n en &laquo;modo
d1496 1
a1496 1
$Translation: faq6.html,v 1.94 2003/07/26 16:34:03 horacio Exp $<br>
@


1.78
log
@sync with steelix translation CVS
@
text
@a53 1
<a name="6.0.1"></a>
a96 1
<a name="6.1"></a>
a100 1
<a name="6.1.1"></a>
a362 1
<a name="6.1.2"></a>
a425 1
<a name="6.1.3"></a>
a524 1
<a name="6.4"></a>
a650 1
<a name="6.5"></a>
a846 1
<a name="6.6"></a>
a918 1
<a name="6.7"></a>
d942 7
a948 8
datos confidenciales o importantes, es muy recomendable usar
<a href="faq13.html">IPsec</a>.  De otro modo existe la posibilidad de
que extra&ntilde;os puedan ver nuestro tr&aacute;fico de NFS.
Tambi&eacute;n ser&iacute;a posible que alguien pretendiera estar en la
direcci&oacute;n IP a la que hayamos autorizado la entrada en el
servidor de NFS.  Existen varios tipos de ataques efectivos en este
aspecto.  Cuando IPsec est&aacute; correctamente configurado, protege
contra todos estos tipos de ataques.
a1133 1
<a name="6.9"></a>
d1490 2
a1491 2
Originally [OpenBSD: faq6.html,v 1.175 2003/07/17 19:22:25 nick Exp ]<br>
$Translation: faq6.html,v 1.93 2003/07/19 18:23:00 horacio Exp $<br>
@


1.77
log
@sync with steelix translation CVS
@
text
@a43 2
<li><a href="#DNS">6.8 - El Servicio de Nombres de Dominio  - DNS,
BIND, y named</a>
a1142 675
<a name="DNS"></a>
<a name="6.8"></a>
<h2>6.8 - Servicio de Nombres de Dominio  - DNS, BIND, y named</h2>

<p>
<i>Nota: La siguiente secci&oacute;n ha sido escrita para OpenBSD 3.2 y
versiones anteriores, que inclu&iacute;an BIND4.  OpenBSD 3.3 ahora
incluye BIND9, que est&aacute; mejor documentado en libros y en Internet
de lo que estaba la versi&oacute;n anterior, BIND4.</i>

<p>
<i>Al igual que suced&iacute;a con BIND4 en OpenBSD, BIND9 en OpenBSD se
ejecuta en un entorno chroot(2), y tiene una cantidad de mejoras de
seguridad sobre la versi&oacute;n est&aacute;ndar de BIND9:</i>

<ul>
<li><i>soporte para arc4random() (integrado en 9.3.0-snapshot)</i>
<li><i>llama tzset antes que chroot</i>
<li><i>abre /dev/null antes que chroot</i>
<li><i>vuelve al dispositivo aleatorio predeterminado del sistema cuando
se est&aacute; ejecutando en chroot</i>
<li><i>a&ntilde;ade la implementaci&oacute;n LCG (Linear Congruential
Generator) a libisc</i>
<li><i>usa LCG en lugar de LFSR para generaci&oacute;n de ID hasta que
se pruebe que LFSR es fiable</i>
<li><i>selecci&oacute;n de transporte de requerimiento IPv{4,6} para
dig(1)</i>
<li><i>reparaci&oacute;n de sha1.c para circunvalar un error de
optimizaci&oacute;n de gcc (sparc64)</i>
<li><i>chroot a <tt>/var/named</tt> predeterminado</i>
<li><i>setuid al usuario <tt>named</tt> predeterminado</i>
<li><i>write pid-file antes que chroot</i>
</ul>
<i>Los usuarios de OpenBSD 3.3 pueden mirar la siguiente
documentaci&oacute;n:</i>
<ul>
<li><i><a href="http://www.openbsd.org/cgi-bin/man.cgi?query=named&amp;sektion=8">named(8)</a></i>
<li><i><a href="http://www.openbsd.org/cgi-bin/cvsweb/~checkout~/src/usr.sbin/bind/doc/arm/Bv9ARM.html">BIND 9 Administrator Reference Manual</a>
(estas p&aacute;ginas tambi&eacute;n est&aacute;n disponibles en el
directorio <tt>/usr/share/doc/html/bind/</tt> del sistema)</i>
</ul>

<h3>6.8.1 &iquest;Qu&eacute; es DNS?</h3>

<p>
El &laquo;Servicio de Nombres de Dominio&raquo; (DNS, <i>Domain Name
Service</i>) es una facilidad de red que permite a los dominios de
redes IP proveer resoluciones de direcciones nombre-a-IP y resoluciones
direcci&oacute;n-a-nombre en respuesta a un requerimiento.  La
instalaci&oacute;n t&iacute;pica de OpenBSD est&aacute; configurada por
definici&oacute;n como un cliente de DNS, pero no como un servidor de
DNS.  O sea, la instalaci&oacute;n predeterminada de OpenBSD puede
llevar a cabo un requerimiento de DNS para la direcci&oacute;n de una
m&aacute;quina contra un servidor de nombres de dominio, pero no puede
responder a uno de esos requerimientos de DNS de por s&iacute; a menos
que se configure con ese fin.

<p>
Mi m&aacute;quina con OpenBSD est&aacute; conectada actualmente a
Internet a trav&eacute;s de mi proveedor, y por lo tanto puedo usar la
utilidad
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=nslookup&amp;sektion=8">nslookup(8)</a>
para ejecutar el requerimiento de DNS:

<blockquote>
<pre>
$ <b>nslookup www.openbsd.org</b>
Server:  ns4.us.prserv.net
Address:  165.87.201.244

Non-authoritative answer:
Name:    www.openbsd.org
Address:  129.128.5.191
</pre>
</blockquote>

<p>
<b>165.87.201.244</b> es el nombre del servidor que ha contestado,
porque es el &laquo;nombre de servidor&raquo; (<i>nameserver</i>) que
mi proveedor me dijo que usara con mi cuenta, y cuyo n&uacute;mero se
debe introducir en el fichero
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=resolv.conf&amp;sektion=5">/etc/resolv.conf</a>.
Pero la respuesta no fue autorizada.  Para una respuesta autorizada,
investiguemos cu&aacute;l es el servidor de DNS autorizado para el
dominio <i>openbsd.org</i>, y pregunt&eacute;mosle por la
direcci&oacute;n de <i>www.openbsd.org</i>:

<blockquote>
<pre>
# Identificar el nombre de los servidores de openbsd.org
# con la ayuda del nombre del servidor de mi ISP.
$ <b>nslookup -type=NS openbsd.org</b>
Server:  ns4.us.prserv.net
Address:  165.87.201.244

Non-authoritative answer:
openbsd.org     nameserver = cvs.openbsd.org
openbsd.org     nameserver = gandalf.sigmasoft.com
openbsd.org     nameserver = cs.colorado.edu
openbsd.org     nameserver = ns.appli.se
openbsd.org     nameserver = zeus.theos.com

Authoritative answers can be found from:
cvs.openbsd.org internet address = 199.185.137.3
gandalf.sigmasoft.com   internet address = 198.144.202.98
cs.colorado.edu internet address = 128.138.243.151
ns.appli.se     internet address = 194.198.196.230
zeus.theos.com  internet address = 199.185.137.1

# Usar la informaci&oacute;n obtenida para requerir una
# resoluci&oacute;n autorizada:
# requerir la autorizaci&oacute;n zeus.theos.com.
$ <b>nslookup www.openbsd.org zeus.theos.com</b>
Server:  zeus.theos.com
Address:  199.185.137.1

Name:    www.openbsd.org
Address:  129.128.5.191
</pre>
</blockquote>

<p>
<i>zeus.theos.com</i> es, como es de suponer, una m&aacute;quina que
funciona con OpenBSD y que est&aacute; correctamente configurada para
ser un servidor de DNS para el dominio <i>openbsd.org</i>.

<p>
<a name="DNS.1.1"></a>
<a name="6.8.1.1"></a>
<h3>6.8.1.1 &iquest;D&oacute;nde se puede aprender todo sobre DNS y su
implementaci&oacute;n en OpenBSD?</h3>

<ul>
<li>En los RFC <a href="http://www.faqs.org/rfcs/rfc1033.html">1033</a>, <a href="http://www.faqs.org/rfcs/rfc1034.html">1034</a>, y <a href="http://www.faqs.org/rfcs/rfc1035.html">1035</a> 
se puede encontrar m&aacute;s informaci&oacute;n sobre el sistema de
nombres de dominio en Internet.
<li>En el libro de O'Reilly Associates
<i><a href="../../es/books.html#6">DNS and BIND</a></i>.
<li>En las
<a href="http://www.openbsd.org/cgi-bin/man.cgi">p&aacute;ginas del
manual de OpenBSD</a>, en especial las p&aacute;ginas de
   <ul>
   <li><a href="http://www.openbsd.org/cgi-bin/man.cgi?query=dig&amp;sektion=1">dig(1)</a>
   <li><a href="http://www.openbsd.org/cgi-bin/man.cgi?query=nslookup&amp;sektion=8">nslookup(8)</a>
   <li><a href="http://www.openbsd.org/cgi-bin/man.cgi?query=gethostbyname&amp;sektion=3">gethostbyname(3)</a>
   <li><a href="http://www.openbsd.org/cgi-bin/man.cgi?query=named&amp;sektion=8">named(8)</a>
   <li><a href="http://www.openbsd.org/cgi-bin/man.cgi?query=resolver&amp;sektion=3">resolver(3)</a>
   <li><a href="http://www.openbsd.org/cgi-bin/man.cgi?query=resolver&amp;sektion=5">resolver(5)</a>
   </ul>
</ul>

<p>
La orden
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=dig&amp;sektion=1">dig(1)</a>
es epecialmente &uacute;til porque puede requerir un dominio y devolver
la informaci&oacute;n pr&aacute;cticamente en el mismo formato requerido
por los ficheros de configuraci&oacute;n de BIND.  Se puede usar
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=dig&amp;sektion=1">dig(1)</a>
para examinar nombres de servidores que se sepa que est&aacute;n
operando correctamente para comparar la configuraci&oacute;n con la de
ellos.

<p>
<h3>6.8.2 &iquest;Es necesario que mi m&aacute;quina sea un servidor de
nombres de dominio?</h3>

<p>
No se debe configurar como servidor de nombres de dominio a menos que se
est&eacute; seguro que se necesita que funcione como un servidor de DNS.
La instalaci&oacute;n predeterminada de OpenBSD no activa la
m&aacute;quina como servidor de nombres de dominio, aunque todos los
ficheros necesarios se encuentran instalados y listos para la
activaci&oacute;n.  Para la mayor&iacute;a de estaciones de trabajo, es
suficiente con los ficheros
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=hosts&amp;sektion=5">/etc/hosts</a>
para indicar las direcciones de IP de las m&aacute;quinas locales y
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=resolv.conf&amp;sektion=5">/etc/resolv.conf</a>
para indicar qu&eacute; servidores de DNS har&aacute;n el servicio en la
intranet o Internet.

<p>
Por otra parte, alguien podr&iacute;a necesitar que la m&aacute;quina
estuviera configurada como un servidor de nombres de dominio si:

<ul>
<li>se tiene una LAN IP en la que no se quieren replicar los ficheros
<tt>hosts</tt> de direcciones locales en cada m&aacute;quina; en este
caso se puede configurar la m&aacute;quina con OpenBSD como servidor de
DNS para que d&eacute; servicio a los requerimientos de otras
m&aacute;quinas de la LAN.

<ul>
<li><b>Nota:</b> No existen restricciones en la pr&aacute;ctica al
n&uacute;mero de servidores de DNS en una LAN.  Cualquier m&aacute;quina
o todas las de la LAN puede ofrecer el servicio de DNS si se configuran
para ello.  Que uno de estos servidores se considere autorizado desde
fuera de la LAN (o incluso conocido desde fuera de la LAN), es un factor
de configuraci&oacute;n que suele estar controlado por el nivel superior
inmediato de la LAN en la jerarqu&iacute;a de dominios.
</ul>

<li>se tiene una LAN IP en la que residan m&aacute;quinas que se quiera
que sean localizables a trav&eacute;s de requerimientos de DNS por
m&aacute;quinas en otra LAN o WAN.

<li>se tiene dificultades al resolver el nombre de dominio local a una
direcci&oacute;n IP, o al resolver cualquier otro nombre local a
direcciones IP aunque los ficheros <tt>/etc/hosts</tt> y
<tt>/etc/resolv.conf</tt> est&eacute;n correctamente configrados (por
ejemplo, en OpenBSD, Netscape a veces se comporta de este modo porque
implementa su propia herramienta de resoluci&oacute;n, en lugar de usar
gethostbyname(3) para la b&uacute;squeda de direcciones).
</ul>

<p>
Algo m&aacute;s a tener en cuenta es la velocidad de ejecuci&oacute;n.
Como la resoluci&oacute;n de nombres es un proceso repititivo en el que
el servidor de nombres realiza repetidos requerimientos sobre
direcciones en dominios remotos a otros servidores de nombres, la
resoluci&oacute;n de nombres puede tardar algo m&aacute;s si se tiene
una conexi&oacute;n por m&oacute;dem a Internet y se est&aacute;n
requiriendo direcciones remotas al servidor propio de DNS (que a su vez
har&aacute; continuos requerimientos a servidores de nombres remotos a
trav&eacute;s del m&oacute;dem) que si se est&aacute; requiriendo el
servidor de nombres del ISP (que probablemente tenga una conexi&oacute;n
m&aacute;s r&aacute;pida a los servidores de nombres remotos).

<p>
<h3>6.8.3 &iquest;Cu&aacute;les son los componentes de software del
servidor de DNS?</h3>

<ul>
<li>named <i>(``d&aelig;mon de name'')</i>
<li>Los ficheros de configuraci&oacute;n en el directorio bajo la
jerarqu&iacute;a de <tt>/var/named/</tt>
</ul>

<p>
<h4>6.8.3.1 &iquest;Qu&eacute; nivel de BIND tiene soporte?</h4>
<!-- XXXchanges - changes with OpenBSD 3.3 -->
<p>
BIND es el nombre de la especificaci&oacute;n sobre la forma en que
act&uacute;a un servidor de nombres de dominio.  Los componentes de DNS
existen para implementar BIND de forma colectiva.

<p>
Existen tres especificaciones de BIND diferentes:

<ol>
<li>BIND 4
<li>BIND 8
<li>BIND 9
</ol>

<p>
En la instalaci&oacute;n predeterminada de OpenBSD, <b>named</b> tiene
soporte para BIND 4.x.

<p>
<h4>6.8.3.2 &iquest;Cu&aacute;les son algunas de las alternativas a
proveer DNS a trav&eacute;s de la implementaci&oacute;n predeterminada
de BIND 4.x?</h4>
<!-- XXXexpires - goes away when 3.2 becomes unsupported -->
<ul>
<li>La implementaci&oacute;n de BIND 9.x, que se encuentra en
<tt>/usr/ports/net/bind9</tt> (v&eacute;ase la p&aacute;gina sobre los
<a href="../../es/ports.html">portes</a>).
</ul>

<p>
<h5>6.8.3.2.1 Nota de <u>Seguridad</u></h5>

<p>
Si se usan estas implementaciones alternativas de DNS, se estar&aacute;
ofreciendo un servicio de red cr&iacute;tico mediante la
utilizaci&oacute;n de unos programas que pueden no haber sido sometidos
al mismo nivel de escrutinio que el d&aelig;mon de <code>name</code> en
la instalaci&oacute;n base, <b><code>named</code></b>, el cual ha pasado
una <a href="../../es/security.html">auditor&iacute;a de seguridad</a>.
&Eacute;sta es una consideraci&oacute;n a tener muy en cuenta, ya que si
se pone en peligro un servidor de nombres de dominio, los
resolucionadores que usen ese servidor de DNS pueden ser redireccionados
al sitio de un impostor.

<p>
<h3>6.8.4 &iquest;Cu&aacute;nto hay que instalar?</h3>

<p>
Si la configuraci&oacute;n predefinida de la red se instal&oacute;
correctamente durante la instalaci&oacute;n de OpenBSD, ya estar&aacute;
todo instalado.  S&oacute;lo ser&aacute; necesario configurar el
d&aelig;mon de <code>name</code> (<b>named</b>).

<p>
<h3>6.8.5 &iquest;C&oacute;mo se configura DNS?</h3>
<!-- XXXchanges - changes with OpenBSD 3.3 -->
<p>
Para configurar DNS en OpenBSD, se debe editar y/o crear los ficheros
que controlan el d&aelig;mon de <code>name</code>, <b>named</b>.  La
ubicaci&oacute;n predeterminada de estos ficheros es el directorio
<tt>/var/named</tt> y sus subdirectorios, y en especial el fichero
<tt>/var/named/named.boot</tt> que es el fichero de
inicializaci&oacute;n para <b>named</b>.  Tambi&eacute;n hay un par
pasoso m&aacute;s para la configuraci&oacute;n que deben realizarse en
<tt>/etc</tt>.

<p>
En este documento configuraremos el d&aelig;mon de <code>name</code> en
<i>nemo.yewtopia.com</i> como el nombre nombre primario del servidor
para el dominio (&iexcl;muy peque&ntilde;o!) <i>yewtopia.com</i>.  La
direcci&oacute;n de <i>nemo.yewtopia.com</i> es <i>192.168.1.9</i>.
Otras dos m&aacute;quinas en esa subrred son <i>crater.yewtopia.com</i>
en 192.168.1.1 y <i>earhart.yewtopia.com</i> en 192.168.1.2.

<p>
<h4>6.8.5.1 Configuraci&oacute;n en <tt>/var/named</tt></h4>
<!-- XXXchanges - changes with OpenBSD 3.3 -->
<p>
<h5>6.8.5.1.1 <tt>/var/named/named.boot</tt></h5>

<blockquote>
<pre>
; qu&eacute; subdirectorio contiene los ficheros de
; la base de datos de lookup
directory       /namedb

; type    domain   source host/file backup file
; tipo    dominio  file/host origen fichero respaldo
cache     .	   root.cache
primary   0.0.127.IN-ADDR.ARPA  localhost.rev

; ejemplo de configuraci&oacute;n de servidor primario:
primary  yewtopia.com yewtopia
primary  1.168.192.IN-ADDR.ARPA yewtopia.rev
</pre>
</blockquote>

<p>
Esto indica al proceso de inicializaci&oacute;n en qu&eacute;
subdirectorio y bajo qu&eacute; nombres encontrar&aacute; los ficheros
de configuraci&oacute;n de <tt>yewtopia.com</tt>.

<p>
<h5>6.8.5.1.2 <tt>/var/named/namedb/localhost.rev</tt></h5>

<blockquote>
<pre>
; lookup inversa para interfaz local
@@       IN      SOA     nemo.yewtopia.com.  your_id.nemo.yewtopia.com.  (
                                14      ; Serial
                                3600    ; Refresh
                                900     ; Retry
                                3600000 ; Expire
                                3600 )  ; Minimum
        IN      NS      nemo.yewtopia.com.
1       IN      PTR     localhost.yewtopia.com.
</pre>
</blockquote>

<p>
<h5>6.8.5.1.3 <tt>/var/named/namedb/yewtopia</tt></h5>

<blockquote>
<pre>
; Base de datos del dominio yewtopia.com
@@       IN      SOA     nemo.yewtopia.com.  your_id.nemo.yewtopia.com.  (
                                14      ; Serial
                                3600    ; Refresh
                                900     ; Retry
                                3600000 ; Expire
                                3600 )  ; Minimum
                     IN      NS      nemo.yewtopia.com.

; Direcciones
localhost.yewtopia.com.      IN A    127.0.0.1
crater.yewtopia.com.         IN A    192.168.1.1
earhart.yewtopia.com.        IN A    192.168.1.2
nemo.yewtopia.com.           IN A    192.168.1.9
</pre>
</blockquote>

<p>
<h5>6.8.5.1.4 <tt>/var/named/namedb/yewtopia.rev</tt></h5>

<blockquote>
<pre>
; Base de datos de lookup inversa del dominio yewtopia
@@       IN      SOA     nemo.yewtopia.com.  your_id.nemo.yewtopia.com.  (
                                14      ; Serial
                                3600    ; Refresh
                                900     ; Retry
                                3600000 ; Expire
                                3600 )  ; Minimum
1.168.192.in-addr.arpa. IN      NS      nemo.yewtopia.com.

; Direcciones
1.1.168.192.in-addr.arpa. IN PTR crater.yewtopia.com.
2.1.168.192.in-addr.arpa. IN PTR earhart.yewtopia.com.
9.1.168.192.in-addr.arpa. IN PTR nemo.yewtopia.com.
</pre>
</blockquote>

<p>
<h4>6.8.5.2 Configuraci&oacute;n en <tt>/etc</tt></h4>

<p>
<h5>6.8.5.2.1 <tt>/etc/resolv.conf</tt></h5>

<p>
Hay que asegurarse de que <tt>/etc/resolv.conf</tt> apunte al dominio de
la m&aacute;quina local (en vez de, por ejemplo, al nombre del servidor
del ISP), de modo que la resoluci&oacute;n del nombre en requerimientos
sea enviada al <b>named</b> que se haya configurado.

<blockquote><pre>
domain yewtopia.com
lookup file bind
</pre></blockquote>

<p>
<h4>6.8.5.2.2 <tt>/etc/hosts</tt></h4>

<p>
Si anteriormente se han a&ntilde;adido las direcciones de varias
m&aacute;quinas al fichero <tt>/etc/hosts</tt>, puede ser conveniente
acortar el fichero <tt>/etc/hosts</tt> al estado en que se encontraba
por definic&oacute;n:

<blockquote><pre>
# Host addresses
127.0.0.1       localhost       localhost.localdomain
192.168.1.9     nemo            nemo.yewtopia.com
</pre></blockquote>

<p>
de modo que <b>named</b> no sea circunvalado en favor de direcciones
(probablemente caducadas) en el fichero <tt>/etc/hosts</tt>.
&iexcl;<u>Es necesario asegurarse de que se tiene como m&iacute;nimo la
entrada predefinida de <i>localhost</i></u>, o la red no se
iniciar&aacute; correctamente!  N&oacute;tese tambi&eacute;n que
<i>nemo</i> debe aparecer en el propio fichero hosts, o de lo contrario
se producir&aacute; un mensaje de error (no da&ntilde;ino) durante el
arranque cuando <tt>/etc/netstart</tt> se invoque
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=route&amp;sektion=8">route(8)</a>
para a&ntilde;adir <i>nemo</i> (cuyo nombre aparece en
<tt>/etc/myname</tt>).

<p>
<h4>6.8.5.3 C&oacute;mo usar
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=dig&amp;sektion=1">dig(1)</a>
para examinar los resultados.</h4>

<blockquote>
<pre>
$ <b>dig @@nemo.yewtopia.com yewtopia.com any any</b>

; &lt;&lt;&gt;&gt; DiG 2.2 &lt;&lt;&gt;&gt; @@nemo.yewtopia yewtopia any any
; (1 server found)
;; res options: init recurs defnam dnsrch
;; got answer:
;; -&gt;&gt;HEADER&lt;&lt;- opcode: QUERY, status: NOERROR, id: 59904
;; flags: qr rd ra; Ques: 1, Ans: 2, Auth: 0, Addit: 1
;; QUESTIONS:
;;      yewtopia.com, type = ANY, class = ANY

;; ANSWERS:
yewtopia.com.   3600    SOA    nemo.yewtopia.com.  your_id.nemo.yewtopia.com. (
                        14      ; serial
                        3600    ; refresh (1 hour)
                        900     ; retry (15 mins)
                        3600000 ; expire (41 days 16 hours)
                        3600 )  ; minimum (1 hour)
yewtopia.com.   3600    NS      nemo.yewtopia.com.

;; ADDITIONAL RECORDS:
nemo.yewtopia.com.  3600    A       192.168.1.9

;; Total query time: 4 msec
;; FROM: nemo to SERVER: nemo.yewtopia.com  192.168.1.9
;; WHEN: Tue May  2 23:47:19 2000
;; MSG SIZE  sent: 25  rcvd: 102
</pre>
</blockquote>

<p>
<h3>6.8.6 &iquest;C&oacute;mo y cu&aacute;ndo se inicia y se para
DNS?</h3>

<p>
<h4>6.8.6.1 C&oacute;mo iniciar DNS</h4>

<p>
El d&aelig;mon de name <b>named</b> se lanza durante el inicio del
sistema desde
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=rc&amp;sektion=8">/etc/rc</a>
si la l&iacute;nea instalada por definici&oacute;n en
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=rc.conf&amp;sektion=8">/etc/rc.conf</a>,

<blockquote><pre>
named_flags=NO          # para uso normal: &quot;&quot;
</pre></blockquote>

<p>
se cambia a

<blockquote><pre>
named_flags=&quot;&quot;          # para uso normal: &quot;&quot;
</pre></blockquote>

<p>
Tambi&eacute;n se deben examinar las siguientes l&iacute;neas en
<tt>/etc/rc.conf</tt>:

<blockquote><pre>
named_user=named                # named no deber&iacute;a ejecutarse como root a menos que fuera necesario
named_chroot=/var/named         # D&oacute;nde chroot named si no est&aacute; vac&iacute;o
</pre></blockquote>

<p>
Estos valores predefinidos ser&aacute;n v&aacute;lidos para casi todas
las configuraciones.

<p>
Para iniciar <b>named</b> de forma manual, se usa la orden
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=ndc&amp;sektion=8">ndc(8)</a>
Por ejemplo:

<blockquote><pre>
# <b>ndc start</b>
          o
# <b>ndc restart</b>
</pre></blockquote>

<p>
<h4>6.8.6.2 C&oacute;mo parar DNS</h4>

<p>
El mejor modo de parar el d&aelig;mon de <code>name</code> es usando la
orden
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=ndc&amp;sektion=8">ndc(8)</a>.
Por ejemplo:

<blockquote><pre>
# <b>ndc stop</b>
</pre></blockquote>

<p>
Si no funciona, hay que encontrar el PID (identificador del proceso) de
<b>named</b> y usar la orden
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=kill&amp;sektion=1">kill(1)</a>
para finalizar el proceso.  El PID de <b>named</b> mientras est&eacute;
funcionando se encontrar&aacute; en la primera l&iacute;nea del fichero
<tt>/var/named/named.pid</tt>:

<blockquote><pre>
# <b>cat /var/named/named.pid</b>
4608
named -t /var/named -u named
# <b>kill -KILL 4608</b>
</pre></blockquote>

<p>
<h4>6.8.6.3 C&oacute;mo reiniciar DNS con una configuraci&oacute;n
alterada</h4>

<p>
Para hacer que un proceso en funcionamiento del d&aelig;mon de name se
reinicie recargando su configuraci&oacute;n despu&eacute;s de haberle
hecho cambios, se debe enviar una se&ntilde;al HUP:

<blockquote><pre>
# <b>kill -HUP 4608</b> 
</pre></blockquote>

<p>
o usar la orden
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=ndc&amp;sektion=8">ndc(8)</a>.
Por ejemplo:

<blockquote><pre>
# <b>ndc reload</b>
</pre></blockquote>

<p>
<h3>6.8.7 &iquest;C&oacute;mo bloqueo los requerimientos AXFR?</h3>

<p>
ejemplo:

<blockquote><pre>
garden:/home/jeremy$<b>  host -l openssh.com</b>
openssh.com.            NS      zeus.theos.com.
openssh.com.            NS      cvs.openbsd.org.
openssh.com.            NS      gandalf.sigmasoft.com.
openssh.com.            NS      cs.colorado.edu.
openssh.com.            NS      ns.appli.se.
openssh.com.            A       199.185.137.4
cvs.openssh.com.        A       199.185.137.4
localhost.openssh.com.  A       127.0.0.1
</pre></blockquote>

<p>
Esta informaci&oacute;n es &uacute;til para depurar DNS, pero en algunos
casos puede que no interese que esta informaci&oacute;n se haga
p&uacute;blica.  Si se est&aacute; usando in-addr(rfc2317) sin clase
para inverso, &iexcl; 'host -' podr&iacute;a dar informaci&oacute;n
sobre todos los dominios hospedados en el sistema!  Esto se puede
solucionar f&aacute;cilmente con la cl&aacute;usula 'allow-transfer' en
el fichero <tt>zone</tt>.
<br><br>
Si se usa Bind8 ser&aacute; necesario especificar los anfitriones a los
que se quiere permitir la transferencia de zonas en el fichero (o
ficheros) individual de zona:

<blockquote><pre>
zone &quot;foo.com&quot; in {
        type master;
        file &quot;directory/zonefile&quot;;
        allow-transfer {
          127.0.0.1;
          10.0.0.6;
          10.0.255.12;
        };
};
</pre></blockquote>

<p>
Tambi&eacute;n se pueden bloquear las transferencias para todos los
dominios editando <tt>/var/named.conf</tt> y a&ntilde;adi&eacute;ndo el
par&aacute;metro 'allow-transfer' a la secci&oacute;n 'options' del
fichero de configuraci&oacute;n:

<blockquote><pre>
   options {
        allow-transfer { 127.0.0.1; };
    };
</pre></blockquote>

<p>
El m&eacute;todo para Bind8 tambi&eacute;n funciona para Bind9.<br>
Si se est&aacute; usando Bind 4 (predeterminado en OpenBSD), se puede
editar <tt>/var/named/named.boot</tt> y usar la opci&oacute;n
'xfrnets'.<br>

<blockquote><pre>
xfrnets 209.142.221.5 12.7.96.7
; type    domain                source host/file                backup file
cache     .                                                     root.cache
primary   0.0.127.IN-ADDR.ARPA  localhost.rev
</pre></blockquote>

<p>
Bind 4 permite transferencias desde clases enteras, por lo que no es tan
exacto.  Generalmente, los &uacute;nicos anfitriones que necesitan
efectuar transferencias son los esclavos y los anfitriones de DNS desde
los que se quiera depurar (127.0.0.1 es normalmente un buen
anfitri&oacute;n desde donde permitir transferencias).  El bloqueo de
requerimientos AXFR a&ntilde;ade un nivel adicional de privacidad, pero
puede entorpecer el &uacute;til depurado de DNS (gracias a 
<a href="mailto:ntang@@nachtwache.org">Nicholas Tang</a> por este
consejo).

<p>
<h3>6.8.7 &iquest;Qu&eacute; queda por ver sobre la configuraci&oacute;n
de DNS?</h3>

<p>
Hay muchas cosas de las que no hemos hablado, como por ejemplo
c&oacute;mo configurar DNS para que los requerimientos para dominios de
intranet que no sean visibles desde la ra&iacute;z de la
jerarqu&iacute;a del dominio, dependan de servidores dentro de la
empresa.  Se puede obtener m&aacute;s informaci&oacute;n sobre DNS en
los <a href="#DNS.1.1">documentos que recomendamos</a>.

<p>
d1501 2
a1502 2
Originally [OpenBSD: faq6.html,v 1.174 2003/07/06 16:04:04 nick Exp ]<br>
$Translation: faq6.html,v 1.92 2003/07/06 17:30:32 horacio Exp $<br>
@


1.76
log
@
sync with steelix translation CVS
@
text
@d83 1
a83 1
leer los <a href="http://the.rfceditor.org/rfc.html">RFC</a>.
d2178 2
a2179 2
Originally [OpenBSD: faq6.html,v 1.173 2003/05/30 15:16:59 nick Exp ]<br>
$Translation: faq6.html,v 1.91 2003/06/01 16:38:55 horacio Exp $<br>
@


1.75
log
@
sync with steelix translation CVS
@
text
@d61 2
a62 2
ser&aacute; de gran ayuda haber le&iacute;do antes, y por lo menos
asimilado en parte, el cap&iacute;tulo sobre la
d64 1
a64 1
N&uacute;cleo&raquo;</a> que se encuentra en estos documentos, y las
d71 1
a71 1
Tanto si se es un administrador de redes y se est&aacute; configurando
d78 1
a78 1
fundamentales sobre redes de IP!
d82 2
a83 3
servidores de ftp y servidores de correo, entonces la lectura de los
<a href="http://the.rfceditor.org/rfc.html">RFC</a> supondr&aacute; un
considerable beneficio.
d160 1
a160 1
        inet 192.168.1.35 netmask 0xffffff00 broadcast 192.168.1.255
d523 1
a523 1
<a href="../pf/index.html"><b>Gu&iacute;a del Usuario de PF</b></a>.
d2178 2
a2179 2
Originally [OpenBSD: faq6.html,v 1.172 2003/05/20 01:27:45 nick Exp ]<br>
$Translation: faq6.html,v 1.89 2003/05/20 16:37:22 horacio Exp $<br>
@


1.74
log
@
sync with steelix translation CVS
@
text
@d61 1
a61 1
ser&aacute; de gran ayuda haber le&iacute;do antes y, por lo menos
d107 2
a108 2
<h3>6.1.1 - Idenficaci&oacute;n y configuraci&oacute;n de las interfaces
de red</h3>
d2179 2
a2180 2
Originally [OpenBSD: faq6.html,v 1.171 2003/05/05 22:18:48 nick Exp ]<br>
$Translation: faq6.html,v 1.88 2003/05/06 18:07:59 horacio Exp $<br>
@


1.73
log
@
changes for OpenBSD 3.3
@
text
@a37 2
<li><a href="#NAT">6.3 - Traducci&oacute;n de Direcciones de Red
(NAT)</a>
d512 1
a513 1
<a name="6.2"></a>
a514 509
<!-- XXXrelease -->
<p>
El subsistema de Filtros de Paquetes, que fue introducido a partir de la
versi&oacute;n 3.0, realiza dos tareas:  se encarga de los permisos de
reenv&iacute;o al nivel del paquete, y asigna anfitriones/subrredes a
una variedad de direcciones externas.  El fichero de
configuraci&oacute;n para este servicio es
<tt><a href="http://www.openbsd.org/cgi-bin/man.cgi?query=pf.conf&amp;sektion=5&amp;manpath=OpenBSD+3.3">/etc/pf.conf(5)</a></tt>.

<p>
Nota:  en OpenBSD 3.0 y 3.1 hab&iacute;a un fichero de
configuraci&oacute;n adicional, <tt>/etc/nat.conf</tt>.  Sus funciones
se han incorporado ahora en <tt>/etc/pf.conf</tt>.

<p>
El fichero
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=pf.conf&amp;sektion=5"><tt>/etc/pf.conf(5)</tt></a>
consta de cuatro partes:

<ul>
<li><b>Options:</b>  Varias opciones para el control del funcionamiento
de PF.
<li><b>Scrub:</b>  Reprocesamiento de paquetes para normalizarlos y
desfragmentarlos.
<li><b><a href="#NAT">NAT and Redirection Rules:</a></b>  Las reglas de
redireccionamiento de NAT.  NAT permite que muchas m&aacute;quinas
puedan acceder a Internet a trav&eacute;s de una sola direcci&oacute;n
IP.  El redireccionamiento permite reenviar las peticiones entrantes a
una m&aacute;quina particular detr&aacute;s de NAT.
<li><b>Filter Rules:</b>  Las reglas de filtrado permiten el filtrado o
bloqueo selectivo de paquetes a medida que van pasando a trav&eacute;s
de cualquiera de las interfaces.
</ul>

<p>
No es necesario que exista ninguna de estas secciones, pero las que
existan deben aparecer en el mismo orden en el que se ha indicado.

<p>
Para iniciar estos servicios con el sistema, antes es necesario editar
el fichero
<tt><a href="http://www.openbsd.org/cgi-bin/man.cgi?query=rc.conf&amp;sektion=8">/etc/rc.conf(8)</a></tt>
y activar las siguientes l&iacute;neas:

<blockquote>
<pre>
pf=YES
</pre>
</blockquote>

<p>
Si no se va a usar NAT, es probable que tambi&eacute;n haya que
configurar el valor de
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=sysctl&amp;sektion=8">sysctl(8)</a>,
<tt>net.inet.ip.forwarding</tt>, a 1.  Para ello se debe activar las
l&iacute;neas relevantes en
<tt><a href="http://www.openbsd.org/cgi-bin/man.cgi?query=sysctl.conf&amp;sektion=5">/etc/sysctl.conf(5)</a></tt>
y reiniciar la m&aacute;quina.

<p>
Si PF se encuentra compilado en el n&uacute;cleo, pero no ha sido
activado en el fichero
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=rc.conf&amp;sektion=8">/etc/rc.conf(8)</a>,
se puede activar f&aacute;cilmente con la orden
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=pfctl&amp;sektion=8&amp;manpath=OpenBSD+3.3">pfctl(8)</a>.

<blockquote>
<pre>
# <b>pfctl -f /etc/pf.conf</b>
# <b>pfctl -e</b>
</pre>
</blockquote>

<p>
La primera l&iacute;nea configura el filtrado y NAT, usando
<tt>/etc/pf.conf</tt>, y la segunda activa PF.

<p>
Esto tambi&eacute;n puede combinarse en una sola l&iacute;nea de
&oacute;rdenes:

<blockquote><pre>
# <b>pfctl -f /etc/pf.conf -e</b>
</pre></blockquote>

<p>
Si se realiza alg&uacute;n cambio en <tt>/etc/pf.conf</tt>
despu&eacute;s de haber iniciado PF, se pueden volver a cargar sus
reglas recargando el fichero:

<blockquote><pre>
# <b>pfctl -f /etc/pf.conf</b>
</pre></blockquote>

<p>
A partir de aqu&iacute; este documento cubrir&aacute; algunos aspectos
b&aacute;sicos de la configuraci&oacute;n de
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=pf.conf&amp;sektion=5&amp;manpath=OpenBSD+3.3">pf.conf(5)</a>
Puede verse el ejemplo del <a href="#sample_pf.conf">juego de reglas
resultante</a> que incluye todos los cambios que se explican a
continuaci&oacute;n en detalle.  Tambi&eacute;n se puede encontrar
m&aacute;s informaci&oacute;n sobre el filtro de paquetes PF en las
<a href="http://www.benzedrine.cx/pf.html">p&aacute;ginas de PF</a> y en
el documento <a href="http://www.inebriated.demon.nl/pf-howto/">Packet
Filter HOWTO</a>.

<p>
<h3>El Filtro de Paquetes IP (PF)</h3>

<p>
Para activar PF en el momento del inicio del sistema es necesario
modificar <tt>/etc/rc.conf</tt> de modo que se lea <tt>pf=YES</tt>.  El
filtro de paquetes IP (PF) est&aacute; controlado por el fichero
<tt>/etc/pf.conf</tt>, que se leer&aacute; durante el inicio.  Puede
verse una explicaci&oacute;n m&aacute;s detallada en la p&aacute;gina
del manual de
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=pf.conf&amp;sektion=5&amp;manpath=OpenBSD+3.3">pf.conf(5)</a>. 
En los siguientes ejemplos, <tt>fxp0</tt> representa la interfaz externa
a Internet.  En otros casos puede ser diferente, dependiendo del
adaptador de ethernet del que se disponga en la m&aacute;quina.  En
estas reglas asumiremos que existe una conexi&oacute;n permanente a
Internet, del mismo tipo que la de un servidor de <i>web</i>.

<p>
Las reglas de PF se procesan de modo secuencial desde el principio hasta
el final, lo que ayuda a visualizar cada uno de los paquetes que tengan
que atravesar cada una de las regla antes de alcanzar su destino.

<p>
Por ejemplo, el grupo de reglas predeterminado permite que entren y
salgan todos los paquetes:

<blockquote><pre>
pass out all 
pass in all
</pre></blockquote>

<p>
que es la forma abreviada de:

<blockquote><pre>
pass in from any to any
pass out from any to any
</pre></blockquote>

<p>
y que se puede leer como &laquo;dejar pasar los paquetes entrantes
procedentes de cualquier parte y hacia cualquier destino&raquo;, y que
implica &laquo;en cualquier interfaz (siempre impl&iacute;cito si no se
especifica una interfaz) de cualquier familia de direcciones de
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=inet&amp;sektion=4">inet (v4)</a> &oacute; <a href="http://www.openbsd.org/cgi-bin/man.cgi?query=inet6&amp;sektion=4">inet6 (v6)</a>&raquo;.

<p>
L&oacute;gicamente, estas reglas no representan un buen ejemplo de
filtrado.  Un filtrado m&aacute;s &uacute;til estar&aacute; basado en la
familia de direcciones (IPv4 &oacute; IPv6), en los protocolos y en los
puertos usados por los servicios que se desean filtrar.  Se puede
especificar cualquiera de los protocolos que aparecen en la lista de
<tt><a href="http://www.openbsd.org/cgi-bin/man.cgi?query=protocols&amp;sektion=5">/etc/protocols(5)</a></tt>,
bien por su nombre o por su n&uacute;mero, pero nosotros s&oacute;lo
trataremos los protocolos
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=tcp&amp;sektion=4">tcp(4)</a>,
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=udp&amp;sektion=4">udp(4)</a> e
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=icmp&amp;sektion=4">icmp(4)</a>.

<p>
Supongamos ahora que no quisi&eacute;ramos permitir ninguna
conexi&oacute;n IPv4 entrante por el puerto TCP 3306 (MySQL) porque la
base de datos s&oacute;lo deber&iacute;a permitir la conexi&oacute;n de
forma local.  En este caso, el grupo de reglas ser&iacute;a como sigue:

<blockquote><pre>
pass out all
pass in all
block in on fxp0 inet proto tcp from any to any port 3306
</pre></blockquote>

<p>
que traducido viene a decir lo siguiente: &laquo;bloquear todos los
paquetes IPv4 entrantes procedentes cualquier sitio y con destino a
cualquier sitio, por el puerto tcp 3306&raquo;.  N&oacute;tese que hay
que especificar un protocolo con cada filtro basado en los puertos, y se
recomienda que se indique la familia de direcciones a la que pertenece.
Para los servicios definidos en el fichero
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=services&amp;sektion=5">/etc/services(5)</a>,
tambi&eacute;n se puede usar los nombres del servicio, como por ejemplo
<i>www</i> o <i>mysql</i>.  Un paquete con destino al puerto tcp 3306 en
una interfaz <tt>fxp0</tt>, pasar&aacute; la primer regla &quot;pass
in&quot;, y a continuaci&oacute;n ser&aacute; bloqueado por la regla
&quot;block in port 3306&quot;.  Si se invirtiera el orden de las reglas
entrantes (recu&eacute;rdese que el orden es importante):

<blockquote><pre>
pass out all
block in on fxp0 inet proto tcp from any to any port 3306
pass in all
</pre></blockquote>

<p>
los paquetes con destino al puerto tcp 3306 pasar&iacute;an porque la
&uacute;ltima regla en el grupo permite que pasen todos los paquetes.
Cuando se escriban reglas para el filtrado de paquetes es importante
tener en cuenta lo siguiente: <b>La &uacute;ltima regla que concuerde
tendr&aacute; precedencia</b>.

<p>
Y, por supuesto, existen excepciones para toda regla.  La opci&oacute;n
<i>quick</i> filtra el paquete en la primera regla que concuerde.
Veamos de nuevo el defectuoso ejemplo anterior,
a&ntilde;adi&eacute;ndole la opci&oacute;n <i>quick</i> a la regla
&quot;block in&quot;:

<blockquote><pre>
pass out all
block in quick on fxp0 inet proto tcp from any to any port 3306
pass in all
</pre></blockquote>

<p>
Un paquete destinado para el puerto tcp 3306 ser&aacute; filtrado por la
regla &quot;block in quick&quot; y bloqueado inmediatamente.  Todos los
paquetes destinados a otros puertos no encontrar&aacute;n una
concordancia en las reglas hasta llegar a la regla &quot;pass in&quot;,
que permite que pasen todos los paquetes.

<p>
<b>Denegaci&oacute;n predefinida</b>

<p>
La pol&iacute;tica de filtrado de p&aacute;quetes m&aacute;s segura es
la de &laquo;denegaci&oacute;n por definici&oacute;n&raquo;.  Esta
pol&iacute;tica es mucho m&aacute;s segura que la denegaci&oacute;n
expl&iacute;cita de cada uno de los servicios protegidos, permite el uso
de grupos de reglas m&aacute;s breves, y puede proteger de un servicio
que haya sido mal configurado de forma accidental y que haya quedado
expuesto.

<p>
Veamos ahora otro ejemplo de un grupo de reglas real, seguido por una
explicaci&oacute;n, l&iacute;nea por l&iacute;nea.  El siguiente ejemplo
es para un servidor de web con una pol&iacute;tica de denegaci&oacute;n
predefinida que s&oacute;lo permita conexiones ssh (para
administraci&oacute;n), y conexiones http (puerto 80) y https (puerto
443).

<blockquote>
<pre>
block in on fxp0 all
pass  in on fxp0 inet proto tcp from any to any port 22
pass  in on fxp0 inet proto tcp from any to any port 80
pass  in on fxp0 inet proto tcp from any to any port 443
pass out on fxp0 all
</pre>
</blockquote>

<p>
Esto permitir&aacute; el paso de conexiones desde cualquier punto de
origen con destino a los puertos tcp 22 (ssh), 80 (http) y 443 (https).
Cualquier otro intento de conexi&oacute;n distinto ser&aacute;
bloqueado, y permitir&aacute; el paso a todas las conexiones salientes,
cualquiera que sea su destino.  Este grupo de reglas es muy estricto.
Pero, &iquest;y si quisi&eacute;ramos que s&oacute;lo puedan conectarse
a ssh los anfitriones internos de nuestro bloque de direcciones 1.1.1.0,
y que al mismo tiempo que se permitan las conexiones externas a http y
https?

<blockquote><pre>
block in on fxp0 all
pass  in on fxp0 inet proto tcp from 1.1.1.0/24 to any port 22
pass  in on fxp0 inet proto tcp from any to any port 80
pass  in on fxp0 inet proto tcp from any to any port 443
pass out on fxp0 all
</pre></blockquote>

<p>
De acuerdo, pero, &iquest;y si s&oacute;lo quisi&eacute;ramos permitir
la administraci&oacute;n remota de nuestro servidor de web a una sola
m&aacute;quina (1.1.1.1)?  Entonces cambiar&iacute;amos esta regla:

<blockquote><pre>
pass  in on fxp0 inet proto tcp from 1.1.1.0/24 to any port 22
</pre></blockquote>

<p>
por esta otra:

<blockquote><pre>
pass  in on fxp0 inet proto tcp from 1.1.1.1/32 to any port 22
</pre></blockquote>

<p>
<b>Ejemplos de reglas</b>

<p>
He aqu&iacute; algunas ejemplos de reglas que pueden ser de utilidad
para todos (en las que se asume que <tt>fxp0</tt> es la interfaz externa
conectada a Internet).  Primero configuraremos un filtro simple para la
protecci&oacute;n contra la falsificaci&oacute;n de direcciones IP
(<i>ip address spoofing</i>).  Estas direcciones, por lo general, no
deber&iacute;an vagar por Internet y, si lo hacen, lo que es bastante
raro, las bloquearemos:

<blockquote><pre>
block in quick on fxp0 inet from { 127.0.0.0/8, 192.168.0.0/16, \
172.16.0.0/12, 10.0.0.0/8 } to any
block out quick on fxp0 inet from any to { 127.0.0.0/8, 192.168.0.0/16, \
172.16.0.0/12, 10.0.0.0/8 }
</pre></blockquote>

<p>
Nuestro grupo de reglas est&aacute; mejorando;  cuando lo ponemos todo
junto obtenemos lo siguiente:

<blockquote><pre>
# no permitir a nadie falsificar direcciones que no se
# puedan enrutar
block in quick on fxp0 inet from { 127.0.0.0/8, 192.168.0.0/16, \
172.16.0.0/12, 10.0.0.0/8 } to any
block out quick on fxp0 inet from any to { 127.0.0.0/8, 192.168.0.0/16, \
172.16.0.0/12, 10.0.0.0/8 }

# permitir la conexi&oacute;n por ssh s&oacute;lo a nuestra
# m&aacute;quina de administraci&oacute;n

pass in quick on fxp0 inet proto tcp from 1.1.1.1/32 to any port 22

# permitir que otros usen http y https

pass in quick on fxp0 inet proto tcp from any to any port 80
pass in quick on fxp0 inet proto tcp from any to any port 443

# finalmente, cerrar el resto con una denegaci&oacute;n
# predeterminada
block in quick on fxp0 from any to any

# y dejar pasar todo el tr&aacute;fico saliente
pass out on fxp0 from any to any
</pre></blockquote>

<p>
<b>Registro de paquetes</b>

<p>
De momento va bastante bien, pero a&uacute;n podr&iacute;a ir mejor.
&iquest;Qué har&iacute;amos si quisi&eacute;ramos obtener un registro de
cualquier intento de conexi&oacute;n al puerto 22 (ssh) que pasara a
trav&eacute;s de nuestro cortafuegos?  Ser&iacute;a fácil, ya que PF
puede gestionar este caso con la opci&oacute;n clave:
<i>log</i>:

<blockquote><pre>
pass in quick on fxp0 inet proto tcp from 1.1.1.1/32 to any port 22
block in log quick on fxp0 inet proto tcp from any to any port 22
</pre></blockquote>

<p>
Esta regla permitir&aacute; la conexi&oacute;n remota por el puerto 22 a
nuestra m&aacute;quina de administraci&oacute;n, pero denegar&aacute; y
registrar&aacute; cualquier otro intento de conexi&oacute;n al puerto
22.

<p>
Los paquetes registrados se env&iacute;an a la interfaz pflog0, que
est&aacute; siendo monitorizada por
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=pflogd&amp;sektion=8&amp;manpath=OpenBSD+3.3">pflogd(8)</a>,
el cual suele volcar los paquetes a <tt>/var/log/pflog</tt> en el
formato binario de
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=tcpdump&amp;sektion=8&amp;manpath=OpenBSD+3.3">tcpdump(8)</a>.
Si pf se encuentra activado en
<tt><a href="http://www.openbsd.org/cgi-bin/man.cgi?query=rc.conf&amp;sektion=8">/etc/rc.conf(8)</a></tt>,
pflogd(8) se inicia de modo predefinido desde
<tt><a href="http://www.openbsd.org/cgi-bin/man.cgi?query=rc&amp;sektion=8">/etc/rc(8)</a></tt>.
Estos ficheros de registro se pueden leer usando la siguiente orden:

<blockquote><pre>
# <b>tcpdump -n -e -ttt -r /var/log/pflog</b>
</pre></blockquote>

<p>
Hay que tener en cuenta que la utilizaci&oacute;n de tcpdump para la
monitorizaci&oacute;n del fichero <i>pflog</i> NO ofrece
informaci&oacute;n en tiempo real.  Para ver la informaci&oacute;n en
tiempo real hay que usar la siguiente orden:

<blockquote><pre>
# <b>tcpdump -i pflog0</b>
</pre></blockquote>

<p>
Tambi&eacute;n es posible usar tcpdump para estrechar el objetivo y
facilitar as&iacute; el depurado:

<blockquote><pre>
# <b>tcpdump -e -i pflog0 port 80</b>
</pre></blockquote>

<p>
Esta orden NO altera los datos que se incluyen en el fichero
<tt>/var/log/pflog</tt>.

<p>
Cuando se examinan los registros propios, es aconsejable tener mucho
cuidado con la descodificaci&oacute;n del protocolo (la verbosidad en
los mensajes se activa a&ntilde;adiendole a la orden la opci&oacute;n
<tt>-v</tt>).  Los descodificadores de protocolo de tcpdump no tienen un
historial impecable.  En teor&iacute;a, ser&iacute;a posible un ataque
retrasado a trav&eacute;s de paquetes parciales de carga &uacute;til
(<i>partial packet payload</i>) registrados por el dispositivo de
ingreso.

<p>
Es preciso tener un cuidado especial con el acceso a los registros.
pflogd captura 96 bytes del paquete y los registra.  El acceso a los
registros podr&iacute;a dar acceso parcial a paquetes de carga
&uacute;til de car&aacute;cter reservado (como los registros de ingreso
de 
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=telnet&amp;sektion=1">telnet(1)</a> o
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=ftp&amp;sektion=1">ftp(1)</a>).

<p>
<b>Registro de paquetes con <tt>syslog</tt></b>

<p>
Hay muchas situaciones en las que es conveniente que los registros
(<i>logs</i>) del cortafuegos est&eacute;n disponibles en formato ASCII
(texto simple) y/o enviarlos a un servidor de registros remoto.  Esto se
puede llevar a cabo mediante dos peque&ntilde;os guiones de
ejecuci&oacute;n del int&eacute;rprete de &oacute;rdenes (<i>shell
scripts</i>) y con unos cambios m&iacute;nimos de los ficheros de
configuraci&oacute;n de OpenBSD.

<p>
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=syslogd&amp;sektion=8&amp;manpath=OpenBSD+3.3">Syslogd(8)</a>
es el d&aelig;mon est&aacute;ndar para registros, que los realiza en
formato ASCII y que tambi&eacute;n puede enviarlos a un servidor de
registros remoto.

<p>
Para ello, primero debemos crear un usuario, <i>pflogger</i>, con
<i>.nologin.</i> como int&eacute;rprete.  La forma m&aacute;s
f&aacute;cil de crear este usuario es con la orden
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=adduser&amp;sektion=8&amp;manpath=OpenBSD+3.3">adduser(8)</a>.

<p>
Despu&eacute;s de crear el usuario <i>pflogger</i> crearemos los dos
guiones de ejecuci&oacute;n siguientes:

<p>
<tt>/etc/pflogrotate</tt>
<blockquote><pre>
FILE=/home/pflogger/pflog5min.$(date "+%Y%m%d%H%M")
kill -ALRM $(cat /var/run/pflogd.pid)
if [ $(ls -l /var/log/pflog | cut -d " " -f 8) -gt 24 ]; then
        mv /var/log/pflog $FILE
        chown pflogger $FILE
        kill -HUP $(cat /var/run/pflogd.pid)
fi
</blockquote></pre>

<p>
<tt>/home/pflogger/pfl2sysl</tt>
<blockquote><pre>
#!/bin/sh
# alimentar a syslog con los ficheros pflog rotados
for logfile in /home/pflogger/pflog5min* ; do
        tcpdump -n -e -ttt -r $logfile | logger -t pf -p local0.info
        rm $logfile
done
</blockquote></pre>

<p>
A continuaci&oacute;n abriremos la tarea de
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=cron&amp;sektion=8">cron(8)</a>
del usuario <i>root</i> en modo de edici&oacute;n mediante la orden
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=crontab&amp;sektion=1">crontab(1)</a>:

<blockquote><pre>
# <b>crontab -u root -e</b>
</pre></blockquote>

<p>
y le a&ntilde;adiremos las dos l&iacute;neas siguientes:

<blockquote><pre>
# rotar el fichero de registro de pf cada 5 minutos
0-59/5 *       *       *       *       /bin/sh /etc/pflogrotate
</blockquote></pre>

<p>
luego crearemos una tarea de cron para el usuario <i>pflogger</i>:

<blockquote><pre>
# <b>crontab -u pflogger -e</b>
</pre></blockquote>

<p>
y le a&ntilde;adiremos la l&iacute;nea siguiente:

<blockquote><pre>
# alimentar syslog con los ficheros de pflog rotados
0-59/5 *       *       *       *       /bin/sh /home/pflogger/pfl2sysl
</blockquote></pre>

<p>
y la siguiente l&iacute;nea en <tt>/etc/syslog.conf</tt>:

<blockquote><pre>
local0.info    /var/log/pflog.txt
</blockquote></pre>
d517 8
a524 89
Si queremos que los registros se realicen mediante un servidor de
registros remoto, tambi&eacute;n a&ntilde;adiremos la l&iacute;nea:

<blockquote><pre>
local0.info    @@syslogger
</blockquote></pre>

<p>
asegur&aacute;ndonos de que el anfitri&oacute;n <i>syslogger</i> se
encuentre definido en el fichero
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=hosts&amp;sektion=5&amp;manpath=OpenBSD+3.3">/etc/hosts(5)</a>.

<p>
Todos los paquetes registrados ser&aacute;n enviados al fichero
<tt>/var/log/pflog.txt</tt>.  Si adem&aacute;s hemos a&ntilde;adido la
segunda l&iacute;nea, tambi&eacute;n ser&aacute;n enviados al
anfitri&oacute;n de registro remoto, <i>syslogger</i>.

<p>
Ahora <tt>/etc/pflogrotate</tt> procesa y luego elimina
<tt>/var/log/pflog</tt>, por lo que la rotaci&oacute;n de <i>pflog</i>
por
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=newsyslog&amp;sektion=8&amp;manpath=OpenBSD+3.3">newsyslogd(8)</a>
ya no es necesaria y debe ser desactivada.  Sin embargo,
<tt>/var/log/pflog.txt</tt> sustituye <tt>/var/log/pflog</tt>, y la
rotaci&oacute;n deber&iacute;a permanecer activada.  Para ello
cambiaremos <tt>/etc/newsyslog.conf</tt> de la siguiente forma:

<blockquote><pre>
#/var/log/pflog        600     3       250     *       ZB      /var/run/pflogd.pid
/var/log/pflog.txt     600     7       *       24
</blockquote></pre>

<p>
Ahora los registros de pf en ASCII ir&aacute;n a
<tt>/var/log/pflog.txt</tt>.  Adem&aacute;s, si lo hemos configurado en
<tt>/etc/syslog.conf</tt>, tambi&eacute;n enviar&aacute; los registros a
un servidor remoto.  El proceso del registro no es inmediato, sino que
tarda entre unos 5 &oacute; 6 minutos (el intervalo de la tarea de cron)
antes de que los paquetes registrados aparezcan en el fichero.

<p>
<b>Protocolos m&uacute;ltiples</b>

<p>
&iquest;Qu&eacute; ocurrir&iacute;a si necesit&aacute;ramos permitir las
conexiones a un servicio que funcionara sobre m&uacute;ltiples
protocolos (como bind, que usa TCP y UDP)?  PF nos permite agrupar
opciones (m&aacute;s adelante volveremos a este tema):

<blockquote><pre>
# Permitir el tr&aacute;fico de DNS para BIND
pass in quick on fxp0 inet proto { tcp, udp } from any to any port 53
</pre></blockquote>

<p>
N&oacute;tese los espacios a ambos lados de los caracteres '{ }'.  Esta
forma es m&aacute;s elegante que la que habr&iacute;a que usar como
alternativa:

<blockquote><pre>
pass in quick on fxp0 inet proto tcp from any to any port 53
pass in quick on fxp0 inet proto udp from any to any port 53
</pre></blockquote>

<p>
<a name="normalization"></a>
<b>Normalizaci&oacute;n de paquetes</b>

<p> 
La &laquo;normalizaci&oacute;n de paquetes&raquo; implica el
reensamblaje de los paquetes fragmentados y la limpieza de las opciones
de IP.  Algunos sistemas operativos y aplicaciones tienen problemas con
paquetes fragmentados o an&oacute;malos, y en general es bueno
normalizar los paquetes para que los puedan buscar bien las reglas de
filtros y los anfitriones de destino de estos paquetes.  Por lo tanto,
casi siempre es beneficioso normalizar los paquetes antes de que lleguen
a su destino final.  Para esto se utiliza la directiva
<b>scrub</b>, que se usa como sigue:

<blockquote><pre>
scrub in all
</pre></blockquote>

<p>
Esta directiva a&ntilde;ade una peque&ntilde;a carga adicional al
sistema, y requiere de un poco de memoria para los fragmentos del
paquete.  Las ventajas de la normalizaci&oacute;n de paquetes casi
siempre son mayores que este peque&ntilde;o coste.
d527 2
a528 1067
<b>Opciones de IP</b>

<p>
En su modo predeterminado, PF bloquea los paquetes que tienen las
opciones de IP activadas.  Esto puede dificultar a&uacute;n m&aacute;s
la tarea a las utilidades de detecci&oacute;n de sistemas como nmap.  Si
se tiene una aplicaci&oacute;n que requiera el paso de estos paquetes,
como puede ser IGMP, puede usarse la directiva <b>allow-opts</b>:

<blockquote><pre>
pass in quick on fxp0 all allow-opts
</pre></blockquote>

<p>
<b>Indicadores de TCP, conexiones establecidas, y mantenimiento del
estado</b>

<p>
PF tambi&eacute;n puede filtrar los paquetes bas&aacute;ndose en los
indicadores de TCP, y mantener as&iacute; las conexiones establecidas y
el estado de la conexi&oacute;n.  Se recomienda que todos los usuarios
que quieran filtrar paquetes bas&aacute;ndose en los indicadores TCP
entiendan antes el papel que desempe&ntilde;a cada indicador.  Por
ejemplo, si un usuario quisiera denegar la conexi&oacute;n a todos los
paquetes con los indicadores FIN, URG, y PSH activados (por ejemplo, en
un intento por obtener la huella digital de un sistema operativo
mediante nmap), podr&iacute;a usar una regla como la siguiente:

<blockquote><pre>
block in quick on fxp0 inet proto tcp from any to any flags FUP/FUP
</pre></blockquote>

<p>
(Gracias a <a href="mailto:halogen@@nol.net">Kyle Hargraves</a> por esta
regla)

<p>
El pr&oacute;ximo truco de PF es su capacidad para &laquo;mantener el
estado&raquo; (<i>keep state</i>).  El concepto de &laquo;mantener el
estado&raquo; se puede definir como &laquo;no contestar hasta que no ser
preguntado&raquo; o, en otras palabras, una vez que se ha establecido
una conexi&oacute;n, los paquetes ya no tienen que atravesar grupos de
reglas.  &Eacute;sta es una funcionalidad muy potente que permite
escribir unas reglas mucho m&aacute;s sencillas y seguras.

<p>
Veamos c&oacute;mo se podr&iacute;a aplicar este estado al ejemplo del
grupo de reglas anterior.  &iquest;Confuso?  Revis&eacute;moslo: estamos
permitiendo el acceso para la gesti&oacute;n del sistema desde nuestra
m&aacute;quina de clase C al puerto 22 (ssh), y el acceso al servidor de
<i>web</i> a todo el tr&aacute;fico entrante a los puertos 80 (http) y
443 (https); y estamos bloqueando el resto del tr&aacute;fico.  pero,
&iquest;y si quisi&eacute;ramos establecer una conexi&oacute;n a
trav&eacute;s de
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=ssh&amp;sektion=1">ssh(1)</a>
fuera del servidor de <i>web</i>? o, &iquest;y si necesit&aacute;ramos
usar
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=lynx&amp;sektion=1">
lynx(1)</a> para buscar algo en los documentos de las preguntas
frecuentes?  No podr&iacute;amos, ya que habr&iacute;amos bloqueado
todas las conexiones entrantes que no fueran dirigidas a los puertos
especificados.  Aunque &eacute;sta es la ruta m&aacute;s segura, puede
ser muy poco conveniente.  a&ntilde;adiendo las opciones clave <i>keep
state</i> a la regla &quot;pass out&quot;, podemos permitir de forma
autom&aacute;tica el paso de los paquetes que sean una respuesta a
conexiones que hayamos iniciado nosotros previamente, como por ejemplo
al navegar por la <i>web</i>.  Recu&eacute;rdese que es necesario
especificar para qu&eacute; protocolo estamos efectuando el
mantenimiento del estado.

<blockquote><pre>
block in  on fxp0 inet proto tcp all
pass  in  on fxp0 inet proto tcp from 1.1.1.0/24 to any port 22 keep state
pass  in  on fxp0 inet proto tcp from any to any port 80 keep state
pass  in  on fxp0 inet proto tcp from any to any port 443 keep state
pass  out on fxp0 inet proto tcp all keep state
</pre></blockquote>

<p>
Este peque&ntilde;o cambio supondr&aacute; un dram&aacute;tico
incremento en la flexibilidad y seguridad de nuestro grupo de reglas:
por ejemplo, en el grupo de reglas anterior, estamos permitiendo el paso
a todo el tr&aacute;fico tcp hacia los puertos 80 y 443.  A&uacute;n
podemos hacer que sea un poco m&aacute;s estricto.  Para establecer una
conexi&oacute;n tcp s&oacute;lo se necesita permitir que tenga lugar el
saludo inicial (<i>handshake</i>); una vez que esto ocurra, podemos
bloquear el tr&aacute;fico a ese puerto y permitir que la regla
&quot;keep state&quot; gestione la conexi&oacute;n.  Para que se
complete el saludo inicial, s&oacute;lo es necesario que los paquetes
SYNACK est&eacute;n activados.  Dejando pasar s&oacute;lo paquetes con
SYN activado se puede prevenir muchas formas de barridos de puertos
(<i>port scanning</i>), como puede ser el barrido de FIN.  Los
indicadores S/SA del indicador S (SYN) y el indicador A (ACK) indican
que s&oacute;lo se puede activar SYN.  No se investiga sobre otros
paquetes.  Ahora, las reglas est&aacute;n de este modo:

<blockquote><pre>
block in  on fxp0 inet proto tcp all
pass  in  on fxp0 inet proto tcp from 1.1.1.0/24 to any port 22 \
	flags S/SA keep state
pass  in  on fxp0 inet proto tcp from any to any port 80 \
	flags S/SA keep state
pass  in  on fxp0 inet proto tcp from any to any port 443 \
	flags S/SA keep state
block out on fxp0 inet proto tcp all
pass  out on fxp0 inet proto tcp all flags S/SA keep state
</pre></blockquote>

<p>
Empecemos a poner un poco de orden colocando juntas todas las reglas que
tenemos hasta ahora.  Este grupo de reglas tendr&aacute; soporte para
IPv4, una pol&iacute;tica de denegaci&oacute;n predefinida,
permitir&aacute; conexiones para la gesti&oacute;n del sistema
s&oacute;lo si provienen de una red interna (a trav&eacute;s de ssh), y
permitir&aacute; el paso del tr&aacute;fico entrante hacia los puertos
80 (http) y 443 (https).  Adem&aacute;s, proteger&aacute; contra
direcciones de ip falsificadas no enrutables, y bloquear&aacute; todos
los paquetes que est&eacute;n tan fragmentados que no se puedan
inspeccionar.  Una configuraci&oacute;n bastante completa para un
servidor de <i>web</i> p&uacute;blico.  He aqu&iacute; c&oacute;mo
quedar&iacute;a <tt>/etc/pf.conf</tt>:

<blockquote><pre>
# limpiar paquetes fragmentados y an&oacute;malos
scrub in all

# no permitir a nadie que falsee direcciones no enrutables
block in quick on fxp0 inet from { 127.0.0.0/8, 192.168.0.0/16, \
172.16.0.0/12, 10.0.0.0/8 } to any
block out quick on fxp0 inet from any to { 127.0.0.0/8, 192.168.0.0/16, \
172.16.0.0/12, 10.0.0.0/8 }

# por definici&oacute;n, bloquear todos los paquetes entrantes
# excepto los que est&eacute;n expl&iacute;citamente
# permitidos en reglas siguientes
block in on fxp0 all

# permitir que otros usen http y https
pass in on fxp0 inet proto tcp from any to any port 80 \
	flags S/SA keep state
pass in on fxp0 inet proto tcp from any to any port 443 \
	flags S/SA keep state

# y dejar pasar todo el tr&aacute;fico saliente, incluido TCP,
# UDP, e ICMP, y crear un estado, de modo que los servidores
# de DNS externos puedan responder a nuestros propios
# requerimientos de DNS (UDP).
block out on fxp0                 all
pass  out on fxp0 inet proto tcp  all flags S/SA keep state
pass  out on fxp0 inet proto udp  all            keep state
pass  out on fxp0 inet proto icmp all            keep state
</pre></blockquote>

<p>
Aunque esto pueda parecer suficiente, todav&iacute;a hay algunas cosas
que PF nos permitir&aacute; realizar para que el fichero
<tt>pf.conf</tt> sea m&aacute;s claro y m&aacute;s f&aacute;cil de
mantener.

<p>
<b><i>Sets</i> (agrupaciones)</b>

<p>
Las agrupaciones son abreviaciones que sirven para escribir reglas
m&aacute;s simples y claras en PF.  Por ejemplo, &iquest;qu&eacute;
har&iacute;amos si quisi&eacute;ramos permitir conexiones a un servicio
que funcionase sobre m&uacute;ltiples protocolos como BIND, que usa TCP
y UDP?

<blockquote><pre>
pass in quick on fxp0 inet proto { tcp, udp } from any to any port 53
</pre></blockquote>

<p>
N&oacute;tense los espacios a ambos lados de los caracteres '{ }'.

<p>
Los grupos de IP relacionadas entre s&iuacute; se pueden reagrupar en
agrupaciones (<i>sets</i>);  estas agrupaciones se pueden utilizar en
cualquier parte en la que se pueda usar una IP.  Por ejemplo, tomando
como partida nuestras reglas contra la falsificaci&oacute;n de IP
anteriores:

<blockquote><pre>
# no permitir que nadie pueda falsificar las
# direcciones no enrutables
block in quick on fxp0 inet from { 127.0.0.0/8, 192.168.0.0/16, \
172.16.0.0/12, 10.0.0.0/8 } to any
block out quick on fxp0 inet from any to { 127.0.0.0/8, 192.168.0.0/16, \
172.16.0.0/12, 10.0.0.0/8 }
</pre></blockquote>

<p>
<b>Expansi&oacute;n de variables</b>

<p>
Un problema con el ejemplo del fichero <tt>pf.conf</tt> anterior es que,
si necesit&aacute;ramos cambiar nuestro NIC, o cambiar una
direcci&oacute;n IP, tendr&iacute;amos que modificar muchas
l&iacute;neas.  Para suavizarlo podemos definir variables de
expansi&oacute;n:

<blockquote><pre>
NoRouteIPs=&quot;{ 127.0.0.0/8, 192.168.0.0/16, 172.16.0.0/12, 10.0.0.0/8 }&quot;
ExtIF=&quot;fxp0&quot;
block in quick on $ExtIF from $NoRouteIPs to any
block out quick on $ExtIF from any to $NoRouteIPs
</pre></blockquote>

<p>
<a name="sample_pf.conf"></a>
<b>Todo junto</b>

<p>
Pongamos todo lo que hemos visto hasta ahora en un fichero y comprobemos
la elegancia de este fichero:

<blockquote><pre>
# definir algunas variables
ExtIF=&quot;fxp0&quot;              # la interfaz externa
IntNet=&quot;1.1.1.0/24&quot;       # nuestra red interna
NoRouteIPs=&quot;{ 127.0.0.0/8, 192.168.0.0/16, 172.16.0.0/12, 10.0.0.0/8 }&quot;
Services=&quot;{ www, https }&quot;

# eliminar los paquetes fragmentados y an&oacute;malos
scrub in all

# no permitir que alguien pueda falsificar
# las direcciones no enrutables
block in  quick on $ExtIF from $NoRouteIPs to any
block out quick on $ExtIF from any to $NoRouteIPs
 
# por definici&oacute;n, bloquear todos los paquetes
# entrantes, excepto los que tengan el paso permitido de forma
# expl&iacute;cita en reglas siguientes
block in on $ExtIF all

# permitir a otros el uso de http y https
pass  in on $ExtIF inet proto tcp from any to any port $Services \
	flags S/SA keep state

# y dejar salir al tr&aacute;fico saliente, y mantener el
# estado en las conexiones establecidas
# pass out all protocols, including TCP, UDP and ICMP, and create state,
# so that external DNS servers can reply to our own DNS requests (UDP).
block out on $ExtIF                 all
pass  out on $ExtIF inet proto tcp  all flags S/SA keep state
pass  out on $ExtIF inet proto udp  all            keep state
pass  out on $ExtIF inet proto icmp all            keep state
</pre></blockquote>

<p>
Si se experimenta problemas, puede activarse el registro en reglas
individuales con la clave <i>log</i> para facilitar la
resoluci&oacute;n de los problemas, o sea:

<blockquote><pre>
pass in log quick on fxp0 proto tcp from 1.1.1.0/24 to any port 22
</pre></blockquote>

<p>
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=pflogd&amp;sektion=8&amp ;manpath=OpenBSD+3.3">pflogd(8)</a>
escribir&aacute; las entradas de registros de ip a
<tt>/var/log/pflog</tt>.
Recu&eacute;rdese que <tt>/var/log/pflog</tt> es un fichero binario que
debe ser le&iacute;do por medio de
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=tcpdump&amp;sektion=8&amp;manpath=OpenBSD+3.3">tcpdump(8)</a>,
y NO directamente como un fichero normal de texto.

<p>
&iexcl;Cuando se modifique el fichero de configuraci&oacute;n para el
registro de paquetes, no hay que olvidarse de ejecutar <kbd>pfctl -R
/etc/pf.conf</kbd> para que se efect&uacute;en los cambios!

<p>
<a name="6.3"></a>
<a name="NAT"></a>
<h2>6.3 - NAT, el sistema de Traducci&oacute;n de Direcciones de
Red</h2>
<!-- XXXrelease -->
<p>
<h4>Nota:  En OpenBSD 3.2 y en versiones posteriores, las funciones de
NAT se han incorporado en el fichero <tt>/etc/pf.conf</tt>, no en el
fichero aparte <tt>/etc/nat.conf</tt> que se usaba en OpenBSD 3.0 y
3.1</h4>

<p>
<a name="nat1.0"></a>
<h3><u>6.3.1 Introducci&oacute;n a NAT</u></h3>

<a name="nat1.1"></a>

<p>
Basado en la especificaci&oacute;n
<a href="http://www.geektools.com/rfc/rfc1631.txt">RFC 1631</a>, NAT
provee de un modo f&aacute;cil para la asignaci&oacute;n de redes
internas a una sola direcci&oacute;n de Internet enrutable
(&laquo;real&raquo;).  Es de gran utilidad si no se dispone de
direcciones asignadas oficialmente para cada anfitri&oacute;n en la red
interna.  Cuando se configuren redes privadas/internas se pueden
aprovechar los bloques de direcci&oacute;n reservados (asignados en la
especificaci&oacute;n
<a href="http://www.geektools.com/rfc/rfc1918.txt">RFC 1918</a>), como:

<p>
10.0.0.0/8 (10.0.0.0 - 10.255.255.255)<br>
172.16.0.0/12 (172.16.0.0 - 172.31.255.255)<br>
192.168.0.0/16 (192.168.0.0 - 192.168.255.255)

<p>
Se asume que el usuario ya disponde de un sistema OpenBSD configurado
con dos tarjetas de red (una conectada a Internet y la otra a la red
local).

<p>
<a name="nat1.3"></a>
<b>Detalles de configuraci&oacute;n</b>

<p>
Usaremos el sistema que se describe a continuaci&oacute;n como ejemplo.
Como la configuraci&oacute;n particular de cada usuario ser&aacute;, con
casi toda seguridad, distinta a &eacute;sta, hay que tener mucho cuidado
con no copiar literalmente todo lo que aqu&iacute; se vea y
despu&eacute;s esperar que funcione correctamente.

<blockquote>
<b>NICs: </b>
<pre>
Intel EtherExpress Pro/100 <b>fxp0</b>
Conectada a la LAN EXTERNA (o WAN)
<b>IP Address: </b>24.5.0.5
<b>Netmask: </b>255.255.255.0

Compaq Netelligent 10/100Mb <b>tl0</b>
Conectada a la LAN INTERNA
<b>IP Address: </b>192.168.1.1
<b>Netmask: </b>255.255.255.0
</pre>
</blockquote>

<blockquote>
<b>IP enrutable por Internet, externo (en este ejemplo, una
conexi&oacute;n por m&oacute;dem anal&oacute;gico a trav&eacute;s de un
proveedor de servicios de Internet)</b><br>
<pre>
<b>IP Address: </b>24.5.0.5
<b>Netmask: </b>255.255.255.0
<b>Gateway: </b>24.5.0.1
</pre>
</blockquote>

<blockquote>
<b>Red de &Aacute;rea Local (LAN)</b><br>
En este entorno de ejemplo las m&aacute;quinas de la LAN usan el esquema
de direcciones IP 192.168.1.xxx (en donde xxx es un n&uacute;mero
&uacute;nico).  Existe una gran variedad de sistemas operativos
diferentes en la red interna, incluidos Windows 98, Windows NT, OpenBSD
y Linux, pero el sistema operativo cliente no es un problema para NAT.
Cada m&aacute;quina est&aacute; conectada a un concentrador
(<i>hub</i>) designado para el uso interno.  Para este documento y sus
ejemplos, se asumir&aacute; que el cliente en la red interna tiene una
direcci&oacute;n de IP 192.168.1.40
</blockquote>

<blockquote>
<b>Diagrama de configuraci&oacute;n</b>
<pre>

+-----+              +---------+          +----------+
| Hub |--------- tl0 |   NAT   | fxp0 ----| Internet |
+-----+              +---------+          +----------+
| |
| +-- Cliente A
+---- M&aacute;s clientes

		      +--------------------------+
		      |          LEYENDA         |
		      +--------------------------+
		      |  NIC fxp0 - 24.5.0.5     |
		      |  NIC tl0  - 192.168.1.1  |
		      | Cliente A - 192.168.1.40 |
		      +--------------------------+

</pre>
</blockquote>

<p>
<a name="nat2.0"></a>
<h3><u>6.3.2 Traducci&oacute;n de Direcciones de Red</u></h3>

<p>
<a name="nat2.1"></a>
<b>Introducci&oacute;n a NAT</b>

<p>
Cada nodo en Internet requiere una direcci&oacute;n IP &uacute;nica.
Con IPv4 hay un n&uacute;mero finito de direcciones IP diferentes
disponibles, y como resultado no son gratuitas.  La mayor&iacute;a de
proveedores de Internet a &laquo;bajo coste&raquo; limitan un sitio a
cualquier parte desde 1 a 30 direcciones, y mientras organizaciones con
presupuestos m&aacute;s grandes pueden permitirse un bloque mayor, en la
mayor&iacute;a de los casos existen pocos beneficios y demasiados
riesgos al tener cada m&aacute;quina con una direcci&oacute;n individual
en Internet.

<p>
La &laquo;Traducci&oacute;n de Direcciones de Red&raquo; (<i>Network
Address Translation</i>), o NAT, tambi&eacute;n conocida como
&laquo;Enmascaramiento de IP&raquo; en Linux (<i>IP Masquerading</i>),
permite que varias m&aacute;quinas se encuentren <i>detr&aacute;s</i> de
una sola, o de varias, direcci&oacute;n IP.  Cada m&aacute;quina en la
red interna tiene una direcci&oacute;n IP no registrada que se asigna de
forma interna (de acuerdo con las especificaciones del
<a href="http://www.geektools.com/rfc/rfc1918.txt">RFC 1918</a>), y
todas utilizan la misma direcci&oacute;n IP externa de forma
simult&aacute;nea.

<p>
NAT funciona de un modo bastante simple.  Cuando un cliente dentro de la
LAN quiere conectarse a la m&aacute;quina en Internet, le env&iacute;a
un paquete TCP con un requerimiento de conexi&oacute;n.  Dentro de la
cabecera del paquete TCP se encuentra la direcci&oacute;n IP del cliente
(por ejemplo, 192.168.1.40) y la direcci&oacute;n IP del
anfitri&oacute;n requerido (por ejemplo, 123.45.67.89).  La
m&aacute;quina en la que est&aacute; funcionando NAT intercepta este
paquete TCP y cambia la direcci&oacute;n IP del cliente de 192.168.1.40
a la direcci&oacute;n IP de la m&aacute;quina conectada a Internet (por
ejemplo, 24.5.0.5).  De este modo enga&ntilde;a a la m&aacute;quina
anfitriona, haci&eacute;ndole pensar que la conexi&oacute;n requerida
proviene de la m&aacute;quina con NAT, no de la m&aacute;quina cliente.
Entonces, el anfitri&oacute;n env&iacute;a de vuelta respuestas a la
m&aacute;quina NAT como si &eacute;sta fuera la que se estuviera
conectando.  Cuando la m&aacute;quina NAT recibe las respuestas, las
traduce r&aacute;pidamente y env&iacute;a el paquete al cliente.
Generalmente, el cliente no tiene ni la m&aacute;s remota idea de lo que
est&aacute; ocurriendo, y la supuesta conexi&oacute;n a Internet es
transparente para el usuario y para las aplicaciones del usuario.

<p>
El ejemplo siguiente muestra NAT de un modo m&aacute;s claro:

<blockquote><pre>
Cliente ---------------- tl0 [ NAT ] fxp0 ---------- Internet Host
192.168.1.40 --- 192.168.1.1 [ NAT ] 24.5.0.5 --- 123.45.67.89

Paquete TCP SALIENTE                             Paquete TCP SALIENTE
Desde: 192.168.1.40  &gt;&gt;=== NAT ===&gt;&gt; Hacia: 24.5.0.5
Hacia: 123.45.67.89                              Hacia: 123.45.67.89

Paquete TCP ENTRANTE				 Paquete TCP ENTRANTE
Desde: 123.45.67.89 				 Desde: 123.45.67.89
Hacia: 192.168.1.40  &lt;&lt;=== NAT ===&lt;&lt; Hacia: 24.5.0.5
</pre></blockquote>

<p>
<a name="nat2.2"></a>
<b>&iquest;Por qu&eacute; usar NAT?</b>

<p>
Despu&eacute;s de haber conseguido un m&oacute;dem cable en mi nuevo
apartamento, me d&iacute; cuenta de que ten&iacute;a un peque&ntilde;o
problema:  &iquest;c&oacute;mo podr&iacute;a conseguir acceso a Internet
para mis compa&ntilde;eros de apartamento si el m&oacute;dem estaba en
mi habitaci&oacute;n?  S&oacute;lo hab&iacute;a unas pocas opciones que
pod&iacute;a utilizar, y que iban desde obtener direcciones IP extras,
pasando por instalar un servidor proxy, hasta instalar NAT (el ejemplo
casero del m&oacute;dem cable no debe llevarnos a enga&ntilde;o, NAT es
lo suficientemente potente como para enmascarar un gran red con cientos
o incluso miles de m&aacute;quinas).

<p>
Existen varias razones por las que decid&iacute; instalar NAT, la
primera de ellas fue el ahorro en costes.  En la casa viv&iacute;an dos
compa&ntilde;eros de piso, y compartir gastos es una buena idea.
Adem&aacute;s, cada uno ten&iacute;a su propio PC y yo ten&iacute;a
tres; ten&iacute;amos cinco m&aacute;quinas que conectar, pero mi ISP
s&oacute;lo permit&iacute;a tres direcciones IP por casa, lo que
significaba que no hab&iacute;an direcciones IP suficientes para que
cada m&aacute;quina pudiera acceder a Internet de forma
simult&aacute;nea.

<p>
Usando NAT, cada m&aacute;quina tendr&iacute;a una direcci&oacute;n IP
interna &uacute;nica,  pero todas compartir&iacute;an la &uacute;nica
direcci&oacute;n IP que mi ISP me dio.  El coste se redujo notablemente.

<p>
<a name="nat2.4"></a>
<b>Preconfiguraci&oacute;n</b>

<p>
Para activar NAT en una m&aacute;quina OpenBSD, antes hay que configurar
PF.  Esto se puede hacer f&aacute;cilmente editando los ficheros que
aparecen en la siguiente lista (los cambios al fichero deben hacerse de
tal modo que aparezcan como las opciones que siguen a
continuaci&oacute;n):

<p>
<b>/etc/rc.conf</b> (este fichero se usa para iniciar servicios durante
el arranque)

<blockquote><pre>
pf=YES<br>
</pre></blockquote>

<p>
<b>/etc/sysctl.conf</b>

<blockquote><pre>
net.inet.ip.forwarding=1
</pre></blockquote>

<p>
Despu&iacute;s de haber realizado estos cambios, la m&aacute;quina
estar&aacute; lista para la configuraci&oacute;n de NAT.

<p>
<a name="nat2.5"></a>
<b>Configuraci&oacute;n</b>

<p>
El primer paso es configurar el fichero de reglas de PF
(<tt><a href="http://www.openbsd.org/cgi-bin/man.cgi?query=pf.conf&amp;sektion=5&amp;manpath=OpenBSD+3.3">/etc/pf.conf</a></tt>).
Para el prop&oacute;sito que persigue este documento, dejaremos que el
tr&aacute;fico pase a trav&eacute;s de este cortafuegos sin que haya
interferencias.  El fichero quedar&aacute; como sigue:

<blockquote><pre>
pass in all
pass out all
</pre></blockquote>

<p>
Se puede ver m&aacute;s informaci&oacute;n en la secci&oacute;n que
trata sobre <a href="#PF"><tt>PF</tt>, el paquete de filtros IP</a> de
OpenBSD.

<p>
La sintaxis de la parte correspondiente a NAT del fichero de
configuraci&oacute;n
(<tt><a href="http://www.openbsd.org/cgi-bin/man.cgi?query=pf.conf&amp;sektion=5&amp;manpath=OpenBSD+3.3">/etc/pf.conf</a></tt>)
es bastante simple.  De acuerdo con el ejemplo de configuraci&oacute;n
anterior, el fichero de configuraci&oacute;n de NAT contendr&aacute; las
siguientes entradas:

<blockquote><pre>
nat on fxp0 from 192.168.1.0/24 to any -&gt; 24.5.0.5
</pre></blockquote>

<p>
He aqu&iacute; el significado de cada una de estas l&iacute;neas.

<dl>
<dt>&quot;nat&quot;
<dd>Indica que la orden que se est&aacute; dando es una regla de NAT.
</dl>

<dl>
<dt>&quot;fxp0&quot;
<dd>&Eacute;sta es la interfaz de red que est&aacute; conectada a
Internet.
</dl>

<dl>
<dt>&quot;192.168.1.0/24&quot;
<dd>La direcci&oacute;n IP y de enmascaramiento de red
(<i>netmask</i>, cuyo formato es CIDR).  La combinaci&oacute;n de ambas
indica que &laquo;se debe asignar cualquier direcci&oacute;n IP con un
valor desde 192.168.1.1 hasta 192.168.1.254&raquo;.
</dl>

<dl>
<dt>&quot;24.5.0.5&quot;
<dd>&Eacute;sta es la direcci&oacute;n IP externa que se asignar&aacute;
a la direcci&oacute;n IP interna.
</dl>


<p>
<a name="nat2.6"></a>
<b>Funcionamiento</b>

<p>
Una vez que se haya acabado de configurar, hay dos formas de activar
NAT.  La primera forma, y la mejor si fuera posible, es reiniciando el
sistema OpenBSD.  Para ello basta con usar la orden <kbd>reboot</kbd>.

<p>
Si se quiere ejecutar NAT desde la l&iacute;nea de &oacute;rdenes,
ser&aacute; necesario usar las siguientes &oacute;rdenes:

<blockquote>
<pre>
# <b>pfctl -N /etc/nat.conf</b>
# <b>pfctl -e</b>
</pre>
</blockquote>

<p>
La primera l&iacute;nea es para cargar un grupo de reglas de NAT en PF
(y eliminar cualquier regla anterior), y la segunda para activar PF.
Despu&eacute;s de esto, la mejor manera de asegurarse de que todo
iniciar&aacute; como se espera, es reiniciar el sistema.

<p>
<b>Nota:</b> para volver a cargar las configuraciones de NAT (en el caso
en que se cambiaran y no se quisiera reiniciar) debe ejecutarse de nuevo
la primera orden.  Las configuraciones ser&aacute;n descargadas y
cargadas de nuevo.

<p>
<a name="nat3.0"></a>
<h3><u>6.3.3 Base de conocimientos de NAT</u></h3>

<p>
<a name="nat3.1"></a>
<b>Comprobaci&oacute;n del estado de NAT</b>

<p>
Para averiguar c&oacute;mo est&aacute; funcionando NAT o asegurarse de
que las configuraciones hayan hecho efecto, se usa la opci&oacute;n
&quot;-ss&quot;.  Esta opci&oacute;n mostrar&aacute; un listado de todas
las sesiones que NAT est&eacute; usando actualmente:

<blockquote>
<pre>
# pfctl -ss
TCP  192.168.1.40:2132 -&gt; 24.5.0.5:53136 -&gt; 65.42.33.245:22       TIME_WAIT:TIME_WAIT
TCP  192.168.1.40:2492 -&gt; 24.5.0.5:55011 -&gt; 65.42.33.245:22       ESTABLISHED:ESTABLISHED
UDP  192.168.1.40:2491 -&gt; 24.5.0.5:60527 -&gt; 24.2.68.33:53       2:1
</pre>
</blockquote>

<p>
A continuaci&oacute;n puede verse una explicaci&oacute;n sobre lo que
significa la primera l&iacute;nea (las otras son similares):

<dl>
<dt>&quot;192.168.1.40:2132&quot;
<dd>Indica la direcci&oacute;n IP de la m&aacute;quina que est&eacute;
usando NAT (192.168.1.40) en la LAN.  El n&uacute;mero del puerto que se
use para realizar la conexi&oacute;n (2132) se mostrar&aacute; a
continuaci&oacute;n.
</dl>

<dl>
<dt>&quot;24.5.0.5:53136&quot;
<dd>Indica que la conexi&oacute;n se dirige hacia Internet a
trav&eacute;s de la direcci&oacute;n 24.5.0.5, usando el puerto 53136.
</dl>

<dl>
<dt>&quot;65.42.33.245:22&quot;
<dd>La direcci&oacute;n IP y el puerto al que se conecta.
</dl>

<dl>
<dt>&quot;TIME_WAIT:TIME_WAIT&quot;
<dd>Indica el estado en que PF cree que se encuentra la conexi&oacute;n
TCP.
</dl>

<p>
<a name="nat3.2"></a>
<b>Consideraciones sobre FTP y NAT</b>

<p>
Existen unas cuantas limitaciones de NAT a tener en cuenta, de las
cuales la m&aacute;s com&uacute;n es con FTP.  FTP se puede usar de dos
modos:  pasivo y activo;  de &eacute;stos, FTP pasivo est&aacute;
considerado como el m&aacute;s seguro en la mayor&iacute;a de los casos.

<p>
Con FTP activo, cuando un usuario se conecta a un servidor de FTP remoto
y pide un fichero o informaci&oacute;n, el cliente de FTP env&iacute;a
al servidor un n&uacute;mero de puerto aleatorio en el que el servidor
establecer&aacute; una conexi&oacute;n para el cliente y por el que
tranmitir&aacute; la informaci&oacute;n requerida.  Esto supone un
problema para los usuarios que intenten acceder a servidores de FTP
desde dentro de la misma red interna.  Cuando el servidor de FTP
env&iacute;a su informaci&oacute;n, la env&iacute;a al NIC externo y a
un puerto aleatorio.  La m&aacute;quina de NAT la recibe, pero debido a
que no tiene asignaciones para el paquete desconocido ni para este
puerto, bloquea el paquete y no lo entrega.

<p>
Con el modo pasivo de FTP (el predeterminado en el cliente de
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=ftp&amp;sektion=1">ftp(1)</a>
en OpenBSD), el cliente realiza una petici&oacute;n para que el servidor
escoja un puerto aleatorio, y se mantiene a la escucha por ese puerto en
espera de recibir los datos de conexi&oacute;n.  El servidor informa al
cliente del puerto que ha elegido, y el cliente se conecta a ese puerto
para transferir los datos.  Esto, desafortunadamente, no siempre es
posible ni deseable.  ftp(1) usa este modo por definici&oacute;n;  para
forzar el uso del modo activo de FTP hay que usar el indicador <i>-A</i>
con la orden de <kbd>ftp</kbd>, o desactivar el modo pasivo mediante la
orden

<blockquote><pre>
passive off
</pre></blockquote>

<p>
desde el punto de inserci&oacute;n <i>ftp&gt;</i>.

<p>
PF dispone de otra soluci&oacute;n para este caso, redireccionando el
tr&aacute;fico de FTP a trav&eacute;s de un servidor <i>proxy</i> de
FTP, un proceso que &laquo;gu&iacute;a&raquo; el tr&aacute;fico de FTP a
trav&eacute;s de los filtros.  El <i>proxy</i> de FTP utilizado por
OpenBSD y PF es
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=ftp-proxy&amp;sektion=8&amp;manpath=OpenBSD+3.3">ftp-proxy(8)</a>.

Para activarlo hay que a&ntilde;adir al fichero <tt>/etc/pf.conf</tt>
algo parecido a esto:

<blockquote><pre>
rdr on tl0 proto tcp from any to any port 21 -&gt; 127.0.0.1 port 8021
</pre></blockquote>

<p>
En pocas palabras, esta l&iacute;nea significa que el
&laquo;tr&aacute;fico por el puerto 21 de TCP en la interfaz interna se
redirecciona al servidor de proxy que hay funcionando en esta
m&aacute;quina y que est&aacute; a la escucha por el puerto 8021&raquo;.

<p>
Con suerte, es f&aacute;cil ver que el servidor de proxy se debe iniciar
y ejecutar en la m&aacute;quina OpenBSD, lo que se hace introduciendo la
siguiente l&iacute;nea en el fichero <tt>/etc/inetd.conf</tt>:

<blockquote><pre>
127.0.0.1:8021 stream tcp nowait root /usr/libexec/ftp-proxy ftp-proxy
</pre></blockquote>

y reiniciando el sistema of enviando una se&ntilde;al 'HUP' a
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=inetd&amp;sektion=8">inetd(8)</a>.
Una modo de enviar esta se&ntilde;al 'HUP' es mediante la orden:

<blockquote><pre>
kill -HUP `cat /var/run/inetd.pid`
</pre></blockquote>

<p>
N&oacute;tese que ftp-proxy quedar&aacute; a la escucha por el puerto
8021, el mismo puerto al que rdr estaba enviando el tr&aacute;fico de
FTP.  Hemos escogido el puerto 8021 de forma arbitraria, aunque 8021 es
una buena elecci&oacute;n ya que no est&aacute; asignado para ninguna
otra aplicaci&oacute;n.

<p>
<a name="nat3.3"></a>
<b>Redireccionamiento del tr&aacute;fico</b>

<p>
Con algunas aplicaciones es probable que haya que redireccionar el
tr&aacute;fico entrante o saliente para un cierto protocolo y/o puerto,
hacia una cierta m&aacute;quina que se encuentre detr&aacute;s del
sistema de filtros.  Un ejemplo de esto podr&iacute;a ser el caso de una
m&aacute;quina que se encontrara dentro de la red local y que tuviera un
servidor de <i>web</i> al que hubiera que acceder desde fuera (o, por
supuesto, por el ya consabido ftp-proxy(8)).  Las conexiones entrantes a
nuestra IP v&aacute;lida de Internet se encontrar&aacute;n con que, a
menos que la m&aacute;quina de NAT tambi&eacute;n tenga un servidor de
<i>web</i>, no pondr&aacute;n conectarse.  Para ello usaremos la
directiva 'rdr' de NAT en el fichero de reglas, a fin de dar las
instrucciones sobre hacia d&oacute;nde se debe redireccionar una
conexi&oacute;n concreta.

<p>
Para nuestro ejemplo, supongamos que un servidor de <i>web</i> reside en
la LAN y que su direcci&oacute;n IP es 192.168.1.80.  El fichero de
reglas de NAT necesita una nueva directiva para gestionar esta
situaci&oacute;n.  Hay que a&ntilde;adir una l&iacute;nea parecida a la
siguiente en el fichero <tt>/etc/pf.conf</tt>:

<blockquote>
<pre>
rdr on fxp0 proto tcp from any to any port 80 -&gt; 192.168.1.80 port 80
</pre>
</blockquote>

<p>
Desglosando esta l&iacute;nea para ver qu&eacute; signfica cada
componente de ella:

<dl>
<dt>&quot;rdr&quot;
<dd>Es la orden que le est&aacute; pasando a NAT.  Indica a NAT que lo
que viene a continuaci&oacute;n es una entrada para redireccionar una
conexi&oacute;n.
</dl>


<dl>
<dt>&quot;on fxp0&quot;
<dd>Es la interfaz de red que est&aacute; conectada a Internet.
</dl>

<dl>
<dt>&quot;from any to any&quot;
<dd>Indica cu&aacute;l es la direcci&oacute;n IP que hay que
redireccionar (cualquiera de las que entren en fxp0, como se indica
anteriormente, con cualquier IP como destino).
</dl>

<dl>
<dt>&quot;port 80&quot;
<dd>&Eacute;ste es el puerto (80) entrante que debe ser redireccionado.
No es estrictamente necesario indicar el puerto con el n&uacute;mero
&laquo;80&raquo;, tambi&eacute;n se podr&iacute;a indicar como
&laquo;port www&raquo; para especificar una redirecci&oacute;n del
puerto 80.  Si se quiere usar un nombre en lugar de un n&uacute;mero, el
nombre del servicio y el puerto correspondiente deben existir en el
fichero <tt>/etc/services</tt>.
</dl>

<dl>
<dt>&quot;192.168.1.80 port 80&quot;
<dd>La direcci&oacute;n IP de la m&aacute;quina LAN a la que son
redireccionados los paquetes.  N&oacute;tese que el puerto de destino NO
tiene porqu&eacute; coincidir con el puerto entrante.  Por ejemplo, lo
siguiente es v&aacute;lido e incluso puede ser &uacute;til:
<pre>
rdr on fxp0 proto tcp from any to any port 8080 -&gt; 192.168.1.35 port 80
</pre>
Esta l&iacute;nea redireccionar&iacute;a el tr&aacute;fico entrante en
el puerto 8080 a un servidor de <i>web</i> de una m&aacute;quina en la
red interna, en el puerto 80.
</dl>

<p>
Cuando hayamos terminado de a&ntilde;adir todos los datos, recargaremos
las reglas de NAT y el redireccionamiento comezar&aacute; de inmediato.

<p>
<b>Denegaci&oacute;n</b>

<p>
En ocasiones es necesario aplicar excepciones a una regla de
redireccionamiento de NAT.  Un ejemplo de esto ser&iacute;a <i>AOL
Instant Messenger</i>, que suele escabullirse de los cortafuegos a
trav&eacute;s de cualquier puerto disponible.  Es posible que ftp-proxy
interfiera con AIM cuando decide salir por el puerto remoto 21.  Si
alguien que esto puede ser malo (muchas personas pierden bastante tiempo
intentando bloquear AIM), se pueden excluir las direcciones IP utilizada
por los servidores AIM del tr&aacute;fico redireccionado por nuestra
l&iacute;nea de ftp-proxy anterior.  Para ello, se usar&aacute; la
siguiente regla:

<blockquote>
<pre>
rdr on tl0 proto tcp from any to ! 64.12.163.199 port 21 -&gt; 127.0.0.1 port 8021
</pre>
</blockquote>

Interpretaci&oacute;n: redireccionar el tr&aacute;fico que entra en tl0
con direcci&oacute;n al puerto 21, pero NO por 64.12.163.199 (por el que
los usuarios del servidor de AIM ten&iacute;an problemas) al puerto 8021
del anfitri&oacute;n local (en donde se supone que estar&aacute;
esperando ftp-proxy).  Pero avisamos que existen muchos servidores de
AIM;  si alguien est&aacute; interesado en esta aplicaci&oacute;n, es
probable que tenga que jugar con estas direcciones IP (64.12.0.0/16
puede ser m&aacute; productiva, aunque es probable que tambi&eacute;n
interfiera con algunos sitios que no sean de AOL).

<p>
<a name="nat3.4"></a>
<b>NAT frente a proxy</b>

<p>
La diferencia entre NAT y una aplicaci&oacute;n basada en <i>proxy</i>
es que el software de <i>proxy</i> act&uacute;a como un intermediario
entre Internet y las m&aacute;quinas conectadas a la LAN.  En
prinicipio, esto no representa ning&uacute;n problema;  sin embargo,
cada aplicaci&oacute;n que se quiera ejecutar en la m&aacute;quina y
conectarla a Internet a trav&eacute;s del servidor de <i>proxy</i>, DEBE
reconocer el <i>proxy</i> (ser capaz de usarlo).  No todas las
aplicaciones son capaces de esto (en especial los juegos).  A&uacute;n
m&aacute;s, no existen aplicaciones para servidores de <i>proxy</i> para
todos los servicios de Internet.  NAT asigna la red interna de un modo
transparente, para que sea posible conectares a Internet.  La
&uacute;nica ventaja de seguridad que proxy tiene sobre NAT es que el
software de <i>proxy</i> puede haber sido programado para funciones de
seguridad, y puede filtrar de acuerdo con el contenido a fin de evitar
que una macro de virus se interne en la m&aacute;quina Windows, o
proteger los programas contra desbordamientos de la memoria intermedia
(<i>buffer overflows</i>) y otros peligros.  El mantenimiento de estos
filtros es, con frecuencia, un trabajo muy pesado.

<p>
<a name="nat3.5"></a>
<b>Redireccionamiento y reflexi&oacute;n</b>

<p>
Con frecuencia, las reglas de redireccionamiento se usan para reenviar
conexiones entrantes desde Internet hacia un servidor local con una
direcci&oacute;n privada en la LAN, como en:

<pre>
rdr on $ext_if proto tcp from any to $ext_if port 80 -&gt; $server port 80
</pre>

<p>
Pero cuando se comprueba la regla de redireccionamiento desde un cliente
en la LAN, no funciona.  El motivo es que las reglas de
redireccionamiento s&oacute;lo son aplicables a los paquetes que pasan a
trav&eacute;s de la interfaz especificada (<tt>$ext_if</tt>, la interfaz
externa en el ejemplo).  Sin embargo, el conectarse a la
direcci&oacute;n externa del cortafuegos desde un anfitri&oacute;n en la
LAN no significa que los paquetes vayan a pasar a trav&eacute;s de su
interfaz externa.  La pila TCP/IP del cortafuegos compara la
direcci&oacute;n de destino de los paquetes entrantes con su propia
direcci&oacute;n y sus alias, y detecta las conexiones a si misma tan
pronto como pasan la interfaz interna.  Estos paquetes no pasan de
f&iacute;sicamente por la interfaz interna, y la pila no simula un pase
de este tipo de nin&uacute;n modo.  pf nunca ve estos paquetes en la
interfaz externa, y la regla de redireccionamiento especificando la
interfaz interna, no es aplicable.

<p>
Al a&ntilde;adir una segunda regla de redireccionamiento para la
interfaz interna no surte el efecto deseado.  Cuando el cliente local se
conecta a la direcci&oacute;n externa del cortafuegos, el paquete
inicial del saludo de conexi&oacute;n de TCP (<i>TCP handshake</i>)
llega al cortafuegos a trav&eacute;s de la interfaz interna.  La regla
de redirecci&oacute;n es entonces aplicable y la direcci&oacute;n de
destino se sustituye con la del servidor interno.  El paquete se
reenv&iacute;a de vuelta a trav&eacute;s de la interfaz interna y llega
al servidor interno.  Pero la direcci&oacute;n de origen no se ha
traducido y todav&iacute;a contiene la direcci&oacute;n local del
cliente, por lo que el servidor env&iacute;a sus respuestas directamente
al cliente.  El cortafuegos nunca llega a ver la respuesta y por lo
tanto no tiene la oportunidad de invertir correctamente la
traducci&oacute;n.  El cliente recibe una respuesta desde una fuente que
no esperaba, por lo que la bloquea, falla el saludo de conexi&oacute;n
de TCP, y no se llega a establecer ninguna conexi&oacute;n.

<p>
Aun as&iacute;, con frecuencia es deseable que los clientes en la LAN se
conecten al mismo servidor interno como clientes externos, de forma
transparente.  Existen varias soluciones para este problema:

<p>
<b>Dividir el horizonte de DNS</b>

<p>
Es posible configurar los servidores de DNS para que respondan a
requerimientos de anfitriones locales de forma diferente que a
requerimientos externos, para que los clientes locales reciban la
direcci&oacute;n interna del servidor durante la resoluci&oacute;n del
nombre.  Entonces se conectar&aacute;n directamente al servidor local, y
el cortafuegos no formar&aacute; parte en modo alguno.  De este modo se
reduce el tr&aacute;fico local, ya que los paquetes no tienen que ser
enviados a trav&eacute;s del cortafuegos.

<p>
<b>Trasladar el servidor a una red local separada</b>

<p>
Al a&ntilde;adir una interfaz de red adicional al cortafuegos y
trasladar el servidor local desde la red del cliente a una red dedicada
(DMZ), se permite el redireccionamiento de las conexiones desde clientes
locales del mismo modo que el redireccionamiento de conexiones externas.
El uso de redes separadas tiene varias ventajas, incluida la mejora de
la seguridad mediante el aislamiento del servidor del resto de los
anfitriones locales.  Si alguna vez se comprometiera el servidor (que en
nuestro caso es accesible desde Internet), no podr&iacute;a acceder a
otros anfitriones locales de forma directa, ya que todas las conexiones
tienen que pasar a trav&eacute;s del cortafuegos.

<p>
<b>TCP proxying</b>

<p>
Se puede configurar una proxy de TCP en el cortafuegos, bien a la
escucha en el puerto de reenv&iacute;o o bien redireccionando las
conexiones de la interfaz interna al puerto por el que est&eacute; a la
escucha.  Cuando un cliente local se conecta al cortafuegos, la proxy
acepta la conexi&oacute;n, establece una segunda conexi&oacute;n al
servidor interno, y reenv&iacute;a los datos entre esas dos conexiones.

<p>
Las proxies simples se pueden crear usando
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=inetd&sektion=8">inetd(8)</a>
y <a href="http://www.openbsd.org/cgi-bin/man.cgi?query=nc&sektion=1">nc(1)</a>.
La siguiente entrada de <tt>/etc/inetd.conf</tt> crea un conector
(<i>socket</i>) vinculado a la direcci&oacute;n de circuito cerrado
(<i>loopback</i>) y al puerto 5000.  Las conexiones se reenv&iacute;an
al puerto 80 del servidor 192.168.1.10.

<pre>
127.0.0.1:5000 stream tcp wait nobody /usr/bin/nc nc -w 20 192.168.1.10 80
</pre>

<p>
La siguiente regla de redireccionamiento reenv&iacute;a el puerto 80 de
la interfaz interna a la proxy:

<pre>
rdr on $int_if proto tcp from $int_net to $ext_if port 80 -&gt; 127.0.0.1 port 5000
</pre>

<p>
<b>Combinaci&oacute;n de RDR y NAT</b>

<p>
Con una regla adicional de NAT en la interfaz interna se puede obtener
la traducci&oacute;n de la direcci&oacute;n de origen que falta y que se
ha descrito anteriormente.

<pre>
rdr on $int_if proto tcp from $int_net to $ext_if port 80 -&gt; $server
no nat on $int_if proto tcp from $int_if to $int_net
nat on $int_if proto tcp from $int_net to $server port 80 -&gt; $int_if
</pre>

<p>
Esto har&aacute; que el paquete inicial desde el cliente sea traducido
de nuevo cuando se reenv&iacute;e de vuelta a trav&eacute;s de la
interfaz interna, sustituyendo la direcci&oacute;n de origen del cliente
con la direcci&oacute;n interna del cortafuegos.  El servidor interno
enviar&aacute; un respuesta de vuelta al cortafuegos, que puede invertir
las traducciones de NAT y RDR cuando lo reenv&iacute;e al cliente local.
Esta construcci&oacute;n es algo compleja, ya que crea dos estados
separados por cada conexi&oacute;n reflectada.  Hay que tener cuidado de
evitar que la regla de NAT sea aplicable a otro tr&aacute;fico, por
ejemplo a conexiones que provengan de anfitriones externos (a
trav&eacute;s de otros redireccionamientos) o del mismo cortafuegos.
N&oacute;tese que la regla de rdr anterior har&aacute; que la pila
TCP/IP vea los paquetes que lleguen a la interfaz interna con una
direcci&oacute;n de destino de dentro de la red interna.  Para evitar
que la pila lance mensajes de redireccionamiento de ICMP (indicando al
cliente que puede alcanzar su destino directamente y rompiendo la
reflexi&oacute;n), se puede desactivar los redireccionamientos en la
pasarela usando

<pre>
# <strong>sysctl -w net.inet.ip.redirect=0</strong>
</pre>

<p>
En general, se deber&iacute;an utilizar las soluciones que se han
mencionado.

<p>
<a name="nat4.0"></a>
<b>6.3.4 Enlaces y referencias</b>

<p>
Ficheros de OpenBSD:
<ul>
<li><tt>/etc/pf.conf</tt> - fichero de reglas de PF/NAT
<li><tt>/etc/rc.conf</tt> - fichero de configuraci&oacute;n general de
inicio del sistema que hay que editar para iniciar NAT y PF durante el
arranque del sistema
<li><tt>/etc/sysctl.conf</tt> - fichero para activar el reenv&iacute;o
de IP (<i>IP forwarding</i>)
</ul>

<p>
Enlaces de NAT en Internet:
<ul>
<li><a href="http://www.openbsd.org/cgi-bin/man.cgi?query=pf.conf&amp;sektion=5&amp;manpath=OpenBSD+3.3">p&aacute;gina del manual de pf.conf</a>
<li><a href="http://www.openbsd.org/cgi-bin/man.cgi?query=pfctl&amp;sektion=8&amp;manpath=OpenBSD+3.3">p&aacute;gina del manual de pfctl</a>
<li><a href="http://www.geektools.com/rfc/rfc1631.txt">http://www.geektools.com/rfc/rfc1631.txt</a>
</ul>
d853 1
a853 1
<a href="http://www.freebsd.org/doc/en_US.ISO8859-1/books/handbook/userppp.html">cap&iacute;tulo sobre <i>userppp</i> de la Gu&ieacute;a de FreeBSD</a>.
d1154 1
a1154 1
de lo que estaba la versi&oacute;n anterior, BIND4.
d1157 1
a1157 1
Al igual que suced&iacute;a con BIND4 en OpenBSD, BIND9 en OpenBSD se
d1159 1
a1159 1
seguridad sobre la versi&oacute;n est&aacute;ndar de BIND9:
d1162 16
a1177 15
<li>soporte para arc4random() (integrado en 9.3.0-snapshot)
<li>llama tzset antes que chroot
<li>abre /dev/null antes que chroot
<li>vuelve al dispositivo aleatorio predeterminado del sistema cuando se
est&aacute; ejecutando en chroot
<li>a&ntilde;ade la implementaci&oacute;n LCG (Linear Congruential
Generator) a libisc
<li>usa LCG en lugar de LFSR para generaci&oacute;n de ID hasta que se
pruebe que LFSR es fiable
<li>selecci&oacute;n de transporte de requerimiento IPv{4,6} para dig(1)
<li>reparaci&oacute;n de sha1.c para circunvalar un error de
optimizaci&oacute;n de gcc (sparc64)
<li>chroot a <tt>/var/named</tt> predeterminado
<li>setuid al usuario <tt>named</tt> predeterminado
<li>write pid-file antes que chroot
d1179 2
a1180 2
Los usuarios de OpenBSD 3.3 pueden mirar la siguiente
documentaci&oacute;n:
d1182 2
a1183 2
<li><a href="http://www.openbsd.org/cgi-bin/man.cgi?query=named&amp;sektion=8">named(8)</a>
<li><a href="http://www.openbsd.org/cgi-bin/cvsweb/~checkout~/src/usr.sbin/bind/doc/arm/Bv9ARM.html">BIND 9 Administrator Reference Manual</a>
d1185 1
a1185 1
directorio <tt>/usr/share/doc/html/bind/</tt> del sistema)
a1186 1
</blockquote></i>
d1288 6
a1293 6
   <li><a href="http://www.openbsd.org/cgi-bin/man.cgi?query=dig&amp;sektion=1&format=html">dig(1)</a>
   <li><a href="http://www.openbsd.org/cgi-bin/man.cgi?query=nslookup&amp;sektion=8&format=html">nslookup(8)</a>
   <li><a href="http://www.openbsd.org/cgi-bin/man.cgi?query=gethostbyname&amp;sektion=3&format=html">gethostbyname(3)</a>
   <li><a href="http://www.openbsd.org/cgi-bin/man.cgi?query=named&amp;sektion=8&format=html">named(8)</a>
   <li><a href="http://www.openbsd.org/cgi-bin/man.cgi?query=resolver&amp;sektion=3&format=html">resolver(3)</a>
   <li><a href="http://www.openbsd.org/cgi-bin/man.cgi?query=resolver&amp;sektion=5&format=html">resolver(5)</a>
d2054 2
a2055 1
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=ep&amp;sektion=4">ep(4)</a>.
d2179 2
a2180 2
Originally [OpenBSD: faq6.html,v 1.169 2003/05/01 01:47:41 nick Exp ]<br>
$Translation: faq6.html,v 1.86 2003/05/01 18:42:42 horacio Exp $<br>
@


1.72
log
@
sync with steelix translation CVS
@
text
@d22 4
a25 2
<a href="faq5.html">[Secci&oacute;n 5 - Configuraci&oacute;n del n&uacute;cleo y del disco]</a>
<a href="faq7.html">[Secci&oacute;n 7 - Controles del teclado]</a>
d51 1
a51 1
red&raquo; (<em>bridge</em>) con OpenBSD</a>
d89 2
a90 2
<em>(Nota: existe un proyecto de traducci&oacute;n de documentos RFC al
castellano, <a href="http://www.rfc-es.org/">RFC-ES</a>)</em>
d155 1
a155 1
        inet6 fe80::1%lo0 prefixlen 64 scopeid 0x4
d157 1
a157 1
        inet 127.0.0.1 netmask 0xff000000 
d160 1
d163 2
a164 2
        inet 10.0.0.38 netmask 0xffffff00 broadcast 10.0.0.255
        inet6 fe80::202:b3ff:fe2b:10f7%fxp0 prefixlen 64 scopeid 0x1
d166 1
d177 1
d179 2
a180 1
gre0: flags=8010&lt;POINTOPOINT,MULTICAST&gt; mtu 1450
d207 2
a208 2
<li><a href="http://www.openbsd.org/cgi-bin/man.cgi?query=lo&amp;sektion=4">lo</a> - Interfaz de circuito cerrado (<em>loopback</em>)
<li><a href="http://www.openbsd.org/cgi-bin/man.cgi?query=pflog&amp;sektion=4&amp;manpath=OpenBSD+3.2">pflog</a> - Interfaz de registros del Filtro de Paquetes (<em>PF</em>)
d221 5
a225 4
fichero <i>/etc/hostname.xxx</i>, donde se debe sustituir <i>xxx</i> por
el nombre de la interfaz.  De acuerdo con la informaci&oacute;n de los
ejemplos anteriores, el nombre ser&iacute;a <i>/etc/hostname.fxp0</i>.
La composici&oacute;n de este fichero es as&iacute; de sencilla:<br>
d260 3
a262 3
Aunque nunca se debe forzar el modo <em>full duplex</em> a menos que
ambas partes de la conexi&oacute;n est&eacute;n configuradas para
hacerlo.  A menos que sea necesario por alg&uacute;n motivo especial, la
d267 1
a267 1
cierta interfaz.  &iexcl;El formato del fichero <em>hostname</em> no
d277 2
a278 2
(<em>gateway</em>) predeterminada.  Para ello basta con poner la
direcci&oacute;n IP de la pasarela en el fichero <i>/etc/mygate</i>.
d281 1
a281 1
servidores (<em>nameservers</em>) y el fichero <i>/etc/hosts</i>
d285 1
a285 1
fichero con el nombre <i>/etc/resolv.conf</i>.  Puede verse m&aacute;s
d291 1
a291 1
pertenece al dominio &laquo;midominio.com&raquo;.
d296 1
a296 1
search midominio.com
d305 3
a307 4
de configuraci&oacute;n (<em>script</em>)
<b>/etc/netstart</b>.  Este gui&oacute;n de
configuraci&oacute;n se ejecuta como superusuario (<em>root</em>) del
siguiente modo:
d373 1
a373 1
(<em>gateway</em>)</h3>
d393 1
a393 1
reenv&iacute;o de IP (<em>IP Forwarding</em>), pero debe ser activado.
d398 1
a398 1
y activar <em>IP Forwarding</em> en &eacute;ste.  Esto se puede hacer
d426 1
a426 1
uso como enrutador, usando <em>software</em> como 
d442 1
a442 1
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=hostname.if&amp;sektion=5"><em>/etc/hostname.&lt;if&gt;</em></a>.
d470 1
a470 1
configuraci&oacute;n del enmascaramiento de red (<em>netmask</em>) para
d472 2
a473 2
<em>netmask</em> del primer IP vinculado a la interfaz.  En el siguiente
<em>/etc/hostname.dc0</em> de ejemplo, se a&ntilde;aden dos alias al
d519 6
a524 3
<h4>Nota:  En OpenBSD 3.2 las funciones del fichero de
configuraci&oacute;n <i>/etc/nat.conf</i> se han fusionado en el fichero
<i>/etc/pf.conf</i>.</h4>
d527 7
a533 2
El nuevo fichero
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=pf.conf&amp;sektion=5"><i>/etc/pf.conf</i></a>
a555 8
El subsistema de filtros de paquetes de IP, PF, se cre&oacute; con el
fin de gestionar dos tareas:  tratar con los permisos de reenv&iacute;o
a nivel de paquetes IP, y asignar anfitriones/subredes a un rango de
direcciones externas.  El fichero de configuraci&oacute;n para este
servicio es
<i><a href="http://www.openbsd.org/cgi-bin/man.cgi?query=pf.conf&amp;sektion=5&amp;manpath=OpenBSD+3.2">/etc/pf.conf(5)</a></i>. 

<p>
d558 1
a558 1
<em><a href="http://www.openbsd.org/cgi-bin/man.cgi?query=rc.conf&amp;sektion=8">/etc/rc.conf(8)</a></em>
d573 1
a573 1
<em><a href="http://www.openbsd.org/cgi-bin/man.cgi?query=sysctl.conf&amp;sektion=5">/etc/sysctl.conf(5)</a></em>
d581 1
a581 1
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=pfctl&amp;sektion=8&amp;manpath=OpenBSD+3.2">pfctl(8)</a>:
d592 1
a592 1
<i>/etc/pf.conf</i>, y la segunda activa PF.
d603 1
a603 1
Si se realiza alg&uacute;n cambio en <em>/etc/pf.conf</em>
d614 1
a614 1
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=pf.conf&amp;sektion=5&amp;manpath=OpenBSD+3.2">pf.conf(5)</a>
d628 1
a628 1
modificar <em>/etc/rc.conf</em> de modo que se lea <tt>pf=YES</tt>.  El
d630 1
a630 1
<em>/etc/pf.conf</em>, que se leer&aacute; durante el inicio.  Puede
d633 2
a634 2
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=pf.conf&amp;sektion=5&amp;manpath=OpenBSD+3.2">pf.conf(5)</a>. 
En los siguientes ejemplos, <em>fxp0</em> representa la interfaz externa
d638 1
a638 1
Internet, del mismo tipo que la de un servidor de <em>web</em>.
d675 1
a675 1
<em><a href="http://www.openbsd.org/cgi-bin/man.cgi?query=protocols&amp;sektion=5">/etc/protocols(5)</a></em>,
d703 5
a707 5
<em>www</em> o <em>mysql</em>.  Un paquete con destino al puerto tcp
3306 en una interfaz <em>fxp0</em>, pasar&aacute; la primer regla
&quot;pass in&quot;, y a continuaci&oacute;n ser&aacute; bloqueado por
la regla &quot;block in port 3306&quot;.  Si se invirtiera el orden de
las reglas entrantes (recu&eacute;rdese que el orden es importante):
d724 1
a724 1
<em>quick</em> filtra el paquete en la primera regla que concuerde.
d726 1
a726 1
a&ntilde;adi&eacute;ndole la opci&oacute;n <em>quick</em> a la regla
d812 1
a812 1
para todos (en las que se asume que <em>fxp0</em> es la interfaz externa
d815 1
a815 1
(<em>ip address spoofing</em>).  Estas direcciones, por lo general, no
d865 1
a865 1
<em>log</em>:
d881 2
a882 2
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=pflogd&amp;sektion=8&amp;manpath=OpenBSD+3.2">pflogd(8)</a>,
el cual suele volcar los paquetes a <em>/var/log/pflog</em> en el
d884 1
a884 1
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=tcpdump&amp;sektion=8&amp;manpath=OpenBSD+3.2">tcpdump(8)</a>.
d886 1
a886 1
<em><a href="http://www.openbsd.org/cgi-bin/man.cgi?query=rc.conf&amp;sektion=8">/etc/rc.conf(8)</a></em>,
d888 1
a888 1
<em><a href="http://www.openbsd.org/cgi-bin/man.cgi?query=rc&amp;sektion=8">/etc/rc(8)</a></em>.
d915 1
a915 1
<em>/var/log/pflog</em>.
d921 1
a921 1
<em>-v</em>).  Los descodificadores de protocolo de tcpdump no tienen un
d924 1
a924 1
(<em>partial packet payload</em>) registrados por el dispositivo de
d941 5
a945 5
(<em>logs</em>) del cortafuegos est&eacute;n disponibles en formato
ASCII (texto simple) y/o enviarlos a un servidor de registros remoto.
Esto se puede llevar a cabo mediante dos peque&ntilde;os guiones de
ejecuci&oacute;n del int&eacute;rprete de &oacute;rdenes (<em>shell
scripts</em>) y con unos cambios m&iacute;nimos de los ficheros de
d949 1
a949 1
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=syslogd&amp;sektion=8&amp;manpath=OpenBSD+3.2">Syslogd(8)</a>
d955 2
a956 2
Para ello, primero debemos crear un usuario, <em>pflogger</em>, con
<em>.nologin.</em> como int&eacute;rprete.  La forma m&aacute;s
d958 1
a958 1
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=adduser&amp;sektion=8&amp;manpath=OpenBSD+3.2">adduser(8)</a>.
d961 1
a961 1
Despu&eacute;s de crear el usuario <em>pflogger</em> crearemos los dos
d965 1
a965 1
<i>/etc/pflogrotate</i>
d977 1
a977 1
<i>/home/pflogger/pfl2sysl</i>
d990 1
a990 1
del usuario <em>root</em> en modo de edici&oacute;n mediante la orden
d1006 1
a1006 1
luego crearemos una tarea de cron para el usuario <em>pflogger</em>:
d1021 1
a1021 1
y la siguiente l&iacute;nea en <i>/etc/syslog.conf</i>:
d1038 1
a1038 1
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=hosts&amp;sektion=5&amp;manpath=OpenBSD+3.2">/etc/hosts(5)</a>.
d1042 1
a1042 1
<i>/var/log/pflog.txt</i>.  Si adem&aacute;s hemos a&ntilde;adido la
d1047 4
a1050 3
Ahora <i>/etc/pflogrotate</i> procesa y luego elimina
<i>/var/log/pflog</i>, por lo que la rotaci&oacute;n de <i>pflog</i> por
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=newsyslog&amp;sektion=8&amp;manpath=OpenBSD+3.2">newsyslogd(8) </a>
d1052 1
a1052 1
<i>/var/log/pflog.txt</i> sustituye <i>/var/log/pflog</i>, y la
d1054 1
a1054 1
cambiaremos <i>/etc/newsyslog.conf</i> de la siguiente forma:
d1063 2
a1064 2
<i>/var/log/pflog.txt</i>.  Adem&aacute;s, si lo hemos configurado en
<i>/etc/syslog.conf</i>, tambi&eacute;n enviar&aacute; los registros a
d1157 1
a1157 1
estado&raquo; (<em>keep state</em>).  El concepto de &laquo;mantener el
d1169 1
a1169 1
<em>web</em> a todo el tr&aacute;fico entrante a los puertos 80 (http) y
d1174 1
a1174 1
fuera del servidor de <em>web</em>? o, &iquest;y si necesit&aacute;ramos
d1181 2
a1182 2
ser muy poco conveniente.  a&ntilde;adiendo las opciones clave <em>keep
state</em> a la regla &quot;pass out&quot;, podemos permitir de forma
d1185 1
a1185 1
al navegar por la <em>web</em>.  Recu&eacute;rdese que es necesario
d1204 1
a1204 1
saludo inicial (<em>handshake</em>); una vez que esto ocurra, podemos
d1210 1
a1210 1
(<em>port scanning</em>), como puede ser el barrido de FIN.  Los
d1238 2
a1239 2
servidor de <em>web</em> p&uacute;blico.  He aqu&iacute; c&oacute;mo
quedar&iacute;a <em>/etc/pf.conf</em>:
d1275 1
a1275 1
<em>pf.conf</em> sea m&aacute;s claro y m&aacute;s f&aacute;cil de
d1279 1
a1279 1
<b><em>Sets</em> (agrupaciones)</b>
d1297 1
a1297 1
agrupaciones (<em>sets</em>);  estas agrupaciones se pueden utilizar en
d1315 1
a1315 1
Un problema con el ejemplo del fichero <em>pf.conf</em> anterior es que,
d1372 1
a1372 1
individuales con la clave <em>log</em> para facilitar la
d1380 1
a1380 1
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=pflogd&amp;sektion=8&amp;manpath=OpenBSD+3.2">pflogd(8)</a>
d1382 2
a1383 2
<em>/var/log/pflog</em>.
Recu&eacute;rdese que <em>/var/log/pflog</em> es un fichero binario que
d1385 1
a1385 1
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=tcpdump&amp;sektion=8&amp;manpath=OpenBSD+3.2">tcpdump(8)</a>,
d1401 2
a1402 2
NAT se han incorporado en el fichero <i>/etc/pf.conf</i>, no en el
fichero aparte <i>/etc/nat.conf</i> que se usaba en OpenBSD 3.0 y
d1478 1
a1478 1
(<em>hub</em>) designado para el uso interno.  Para este documento y sus
d1525 7
a1531 7
La &laquo;Traducci&oacute;n de Direcciones de Red&raquo; (<em>Network
Address Translation</em>), o NAT, tambi&eacute;n conocida como
&laquo;Enmascaramiento de IP&raquo; en Linux (<em>IP Masquerading</em>),
permite que varias m&aacute;quinas se encuentren <em>detr&aacute;s</em>
de una sola, o de varias, direcci&oacute;n IP.  Cada m&aacute;quina en
la red interna tiene una direcci&oacute;n IP no registrada que se asigna
de forma interna (de acuerdo con las especificaciones del
d1641 1
a1641 1
(<em><a href="http://www.openbsd.org/cgi-bin/man.cgi?query=pf.conf&amp;sektion=5&amp;manpath=OpenBSD+3.2">/etc/pf.conf</a></em>).
d1659 1
a1659 1
(<i><a href="http://www.openbsd.org/cgi-bin/man.cgi?query=nat.conf&amp;sektion=5&amp;manpath=OpenBSD+3.2">/etc/pf.conf</a></i>)
d1685 3
a1687 3
(<em>netmask</em>, cuyo formato es CIDR).  La combinaci&oacute;n de
ambas indica que &laquo;se debe asignar cualquier direcci&oacute;n IP
con un valor desde 192.168.1.1 hasta 192.168.1.254&raquo;.
d1813 3
a1815 3
forzar el uso del modo activo de FTP hay que usar el indicador
<em>-A</em> con la orden de <kbd>ftp</kbd>, o desactivar el modo pasivo
mediante la orden
d1822 1
a1822 1
desde el punto de inserci&oacute;n <em>ftp&gt;</em>.
d1826 1
a1826 1
tr&aacute;fico de FTP a trav&eacute;s de un servidor <em>proxy</em> de
d1828 1
a1828 1
trav&eacute;s de los filtros.  El <em>proxy</em> de FTP utilizado por
d1830 3
a1832 2
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=ftp-proxy&amp;sektion=8&amp;manpath=OpenBSD+3.2">ftp-proxy(8)</a>.
Para activarlo hay que a&ntilde;adir al fichero <em>/etc/pf.conf</em>
d1848 1
a1848 1
siguiente l&iacute;nea en el fichero <em>/etc/inetd.conf</em>:
d1879 1
a1879 1
servidor de <em>web</em> al que hubiera que acceder desde fuera (o, por
d1883 1
a1883 1
<em>web</em>, no pondr&aacute;n conectarse.  Para ello usaremos la
d1889 2
a1890 2
Para nuestro ejemplo, supongamos que un servidor de <em>web</em> reside
en la LAN y que su direcci&oacute;n IP es 192.168.1.80.  El fichero de
d1893 1
a1893 1
siguiente en el fichero <em>/etc/pf.conf</em>:
d1933 1
a1933 1
fichero <em>/etc/services</em>.
d1946 1
a1946 1
el puerto 8080 a un servidor de <em>web</em> de una m&aacute;quina en la
d1959 2
a1960 2
redireccionamiento de NAT.  Un ejemplo de esto ser&iacute;a <em>AOL
Instant Messenger</em>, que suele escabullirse de los cortafuegos a
d1990 2
a1991 2
La diferencia entre NAT y una aplicaci&oacute;n basada en <em>proxy</em>
es que el software de <em>proxy</em> act&uacute;a como un intermediario
d1995 2
a1996 2
conectarla a Internet a trav&eacute;s del servidor de <em>proxy</em>,
DEBE reconocer el <em>proxy</em> (ser capaz de usarlo).  No todas las
d1998 3
a2000 3
m&aacute;s, no existen aplicaciones para servidores de <em>proxy</em>
para todos los servicios de Internet.  NAT asigna la red interna de un
modo transparente, para que sea posible conectares a Internet.  La
d2002 1
a2002 1
software de <em>proxy</em> puede haber sido programado para funciones de
d2006 1
a2006 1
(<em>buffer overflows</em>) y otros peligros.  El mantenimiento de estos
d2043 1
a2043 1
inicial del saludo de conexi&oacute;n de TCP (<em>TCP handshake</em>)
d2105 3
a2107 3
La siguiente entrada de <em>/etc/inetd.conf</em> crea un conector
(<em>socket</em>) vinculado a la direcci&oacute;n de circuito cerrado
(<em>loopback</em>) y al puerto 5000.  Las conexiones se reenv&iacute;an
d2171 2
a2172 2
<li><em>/etc/pf.conf</em> - fichero de reglas de PF/NAT
<li><em>/etc/rc.conf</em> - fichero de configuraci&oacute;n general de
d2175 2
a2176 2
<li><em>/etc/sysctl.conf</em> - fichero para activar el reenv&iacute;o
de IP (<em>IP forwarding</em>)
d2182 2
a2183 2
<li><a href="http://www.openbsd.org/cgi-bin/man.cgi?query=pf.conf&amp;sektion=5&amp;manpath=OpenBSD+3.2">p&aacute;gina del manual de pf.conf</a>
<li><a href="http://www.openbsd.org/cgi-bin/man.cgi?query=pfctl&amp;sektion=8&amp;manpath=OpenBSD+3.2">p&aacute;gina del manual de pfctl</a>
d2199 1
a2199 1
hay que editar el fichero <em>/etc/hostname.xl0</em> (suponiendo que la
d2217 1
a2217 1
<i>/etc/dhclient</i> exista, y entonces usar la orden:
d2228 2
a2229 2
fichero <i>/etc/dhclient</i> para <b>evitar</b> que se actualice la DNS
de acuerdo con la idea que tenga el servidor de dhcp sobre la DNS,
d2250 1
a2250 1
hay que editar el fichero <i>/etc/rc.conf</i>, y configurarlo
d2252 2
a2253 2
Tambi&eacute;n hay que a&ntilde;adir en <i>/etc/dhcp.interfaces</i> las
interfaces en las que se quiera que dhcp est&eacute; <b>a la
d2261 1
a2261 1
y editar <i>/etc/dhcpd.conf</i>.  Las opciones son bastante claras:
d2264 1
a2264 1
        option  domain-name &quot;xyz.mil&quot;;
d2276 8
a2283 8
a&ntilde;adir a sus requerimientos de DNS es xyz.mil (as&iacute;, si un
usuario escribiera 'telnet joe', los enviar&iacute;a a joe.xyz.mil).
Les dirigir&aacute; a los servidores de DNS 192.168.1.3 y 192.168.1.5.
Para los anfitriones que se encuentren en la misma red que una interfaz
de ethernet en la m&aacute;quina de OpenBSD, que est&aacute; en el rango
192.168.1.0/24, les asignar&aacute; una direcci&oacute;n de IP entre
192.168.1.32 y 192.168.1.127, con una configuraci&oacute;n
predeterminada de la pasarela como 192.168.1.1.
d2288 1
a2288 1
<em>/etc/dhcpd.conf</em>:
d2303 1
a2303 1
siguiente l&iacute;nea al fichero <em>/etc/dhcpd.conf</em>:
d2326 1
a2326 1
<li><a href="http://www.openbsd.org/cgi-bin/man.cgi?query=pppd&amp;sektion=8">pppd(8)</a> - Es el d&aelig;mon ppp del n&uacute;cleo (<em>kernel</em>) del sistema.
d2339 1
a2339 1
   <li>Nuestro <em>nameserver</em> (nombre del servidor) 
d2341 1
a2341 1
   <li>Nuestra pasarela (<em>gateway</em>)
d2350 1
a2350 1
<i>/etc/ppp</i> de gran utilidad, que pueden contener diferentes
d2368 7
a2374 7
consiste en editar su fichero <i>/etc/ppp/ppp.conf</i>.  Este fichero no
existe y se debe crear, pero se puede tomar el fichero
<i>/etc/ppp/ppp.conf.sample</i>, editarlo, y crear un fichero
<i>ppp.conf</i> propio a partir de ah&iacute;.  Aqu&iacute; empezaremos
con la m&aacute;s simple, y probablemente m&aacute;s utilizada,
configuraci&oacute;n.  A continuaci&oacute;n puede verse un
peque&ntilde;o fichero <i>ppp.conf</i> que realizar&aacute; la
d2401 2
a2402 2
corresponder&iacute;a a <i>/dev/cua00</i>.  Con &quot;set speed&quot; se
configura la velocidad de la conexi&oacute;n por llamada, y con
d2468 1
a2468 1
nuestras direcciones <em>nameservers</em>.  Esto no debe hacerse si se
d2470 1
a2470 1
introduciendo algunas l&iacute;neas en <em>/etc/resolv.conf</em>.
d2489 1
a2489 1
Si se usa <i>/usr/sbin/ppp</i> sin pasarle ninguna opci&oacute;n,
d2492 1
a2492 1
depurar problemas en el fichero <i>ppp.conf</i>.
d2500 2
a2501 2
<i>/etc/ppp/ppp.linkup</i> y <i>/etc/ppp/ppp.linkdown</i>.  Pueden verse
ejemplos de configuraci&oacute;n para estos ficheros en:
d2510 1
a2510 1
<a href="http://www.freebsd.org/doc/en_US.ISO8859-1/books/handbook/userppp.html">cap&iacute;tulo sobre <em>userppp</em> de la Gu&ieacute;a de FreeBSD</a>.
d2557 1
a2557 1
<em>&quot;smurf&quot;</em></a> para saber por qu&eacute; se encuentra
d2591 2
a2592 2
El &laquo;Sistema de Archivos de Red&raquo; (NFS, <em>Network File
System</em>) se usa para compartir un sistema de archivos en una red.
d2622 3
a2624 3
sistema de archivos a <i>/etc/exports</i> sin alg&uacute;n tipo de lista
de anfitriones autorizados.  Sin una lista de anfitriones que puedan
montar un directorio particular, cualquiera que pueda llegar al
d2626 1
a2626 1
<i>exports</i>.
d2648 1
a2648 1
<i>/etc/exports</i>.  Este fichero se compone de una lista con los
d2651 1
a2651 1
opciones que puede usar en su fichero <i>/etc/exports</i>, y es
d2654 1
a2654 1
En este ejemplo empezaremos con un fichero <i>/etc/exports</i> como el
d2679 1
a2679 1
Una vez que se haya configurado el fichero <i>/etc/exports</i>, se puede
d2684 1
a2684 1
configurar <tt>nfs_server=YES</tt> en el fichero <i>/etc/rc.conf</i>.
d2687 3
a2689 3
d&aelig;mons deben ser iniciados por el superusuario, <em>root</em>, y
es necesario asegurarse de que portmap(8) est&eacute; en funcionamiento
en el sistema.  El ejemplo que sigue sobre c&oacute;mo iniciar nfsd(8)
d2704 1
a2704 1
vac&iacute;o <em>mountdtab</em> e invocar el d&aelig;mon:
d2712 1
a2712 1
Si se hace alg&uacute;n cambio en el fichero <em>/etc/exports</em>
d2768 2
a2769 2
Para montar el sistema de archivos <i>/work</i> del anfitri&oacute;n
10.0.0.1 en un sistema de archivo local <i>/mnt</i>, se debe hacer lo
d2779 1
a2779 1
lo que viene a continuaci&oacute;n en el fichero <em>/etc/fstab</em>:
d2808 37
d2848 2
a2849 2
El &laquo;Servicio de Nombres de Dominio&raquo; (DNS, <em>Domain Name
Service</em>) es una facilidad de red que permite a los dominios de
d2881 1
a2881 1
porque es el &laquo;nombre de servidor&raquo; (<em>nameserver</em>) que
d2887 2
a2888 2
dominio <em>openbsd.org</em>, y pregunt&eacute;mosle por la
direcci&oacute;n de <em>www.openbsd.org</em>:
d2925 1
a2925 1
<em>zeus.theos.com</em> es, como es de suponer, una m&aacute;quina que
d2927 1
a2927 1
ser un servidor de DNS para el dominio <em>openbsd.org</em>.
d2940 1
a2940 1
<em><a href="../../es/books.html#6">DNS and BIND</a></em>.
d2989 1
a2989 1
<em>hosts</em> de direcciones locales en cada m&aacute;quina; en este
d3010 2
a3011 2
direcciones IP aunque los ficheros <em>/etc/hosts</em> y
<em>/etc/resolv.conf</em> est&eacute;n correctamente configrados (por
d3014 1
a3014 1
<em>gethostbyname(3)</em> para la b&uacute;squeda de direcciones).
d3037 1
a3037 1
jerarqu&iacute;a de <i>/var/named/</i>
d3068 1
a3068 1
<em>/usr/ports/net/bind9</em> (v&eacute;ase la p&aacute;gina sobre los
d3103 5
a3107 4
<i>/var/named</i> y sus subdirectorios, y en especial el fichero
<i>/var/named/named.boot</i> que es el fichero de inicializaci&oacute;n
para <b>named</b>.  Tambi&eacute;n hay un par pasoso m&aacute;s para la
configuraci&oacute;n que deben realizarse en <i>/etc</i>.
d3118 1
a3118 1
<h4>6.8.5.1 Configuraci&oacute;n en <i>/var/named</i></h4>
d3121 1
a3121 1
<h5>6.8.5.1.1 <i>/var/named/named.boot</i></h5>
d3143 1
a3143 1
de configuraci&oacute;n de <em>yewtopia.com</em>.
d3146 1
a3146 1
<h5>6.8.5.1.2 <em>/var/named/namedb/localhost.rev</em></h5>
d3163 1
a3163 1
<h5>6.8.5.1.3 <em>/var/named/namedb/yewtopia</em></h5>
d3185 1
a3185 1
<h5>6.8.5.1.4 <em>/var/named/namedb/yewtopia.rev</em></h5>
d3206 1
a3206 1
<h4>6.8.5.2 Configuraci&oacute;n en <i>/etc</i></h4>
d3209 1
a3209 1
<h5>6.8.5.2.1 <i>/etc/resolv.conf</i></h5>
d3212 1
a3212 1
Hay que asegurarse de que <i>/etc/resolv.conf</i> apunte al dominio de
d3223 1
a3223 1
<h4>6.8.5.2.2 <i>/etc/hosts</i></h4>
d3227 3
a3229 3
m&aacute;quinas al fichero <i>/etc/hosts</i>, puede ser conveniente
acortar el fichero <i>/etc/hosts</i> al estado en que se encontraba por
definic&oacute;n:
d3239 7
a3245 7
(probablemente caducadas) en el fichero <i>/etc/hosts</i>.  &iexcl;<u>Es
necesario asegurarse de que se tiene como m&iacute;nimo la entrada
predefinida de <i>localhost</i></u>, o la red no se iniciar&aacute;
correctamente!  N&oacute;tese tambi&eacute;n que <i>nemo</i> debe
aparecer en el propio fichero hosts, o de lo contrario se
producir&aacute; un mensaje de error (no da&ntilde;ino) durante el
arranque cuando <i>/etc/netstart</i> se invoque
d3248 1
a3248 1
<i>/etc/myname</i>).
d3314 1
a3314 1
<em>/etc/rc.conf</em>:
d3355 1
a3355 1
<i>/var/named/named.pid</i>:
d3411 1
a3411 1
el fichero <em>zone</em>.
d3431 1
a3431 1
dominios editando <em>/var/named.conf</em> y a&ntilde;adi&eacute;ndo el
d3444 1
a3444 1
editar <em>/var/named/named.boot</em> y usar la opci&oacute;n
d3492 4
a3495 4
Antes que nada hay que instalar <em>pptp</em>.  El porte de
<em>pptp</em> se encuentra en <em>/usr/ports/net/pptp</em>.  Se puede
encontrar m&aacute;s informaci&oacute;n sobre el &aacute;rbol de portes
de OpenBSD en la secci&oacute;n sobre los
d3551 1
a3551 1
Para el fichero <em>/etc/ppp/options</em>, una configuraci&oacute;n como
d3567 1
a3567 1
Para el fichero <i>/etc/ppp/pap-secrets</i> se necesitar&aacute; una
d3580 1
a3580 1
<em>root</em> (modo 600).
d3625 1
a3625 1
<em>/etc/rc.local</em> para que se conecte de forma autom&aacute;tica
d3762 1
a3762 1
tr&aacute;fico de <em>web</em> y SSH por ellas.  En este caso dejaremos
d3801 1
a3801 1
<li>Usando la opci&oacute;n <em>blocknonip</em> de
d3814 1
a3814 1
<em>chip</em> TI ThunderLAN
d3816 1
a3816 2
es un ejemplo de un <em>chip</em> que no funciona como parte de un
puente.
d3823 4
a3826 2
<a href="faq5.html">[Secci&oacute;n 5 - Configuraci&oacute;n del n&uacute;cleo y del disco]</a>
<a href="faq7.html">[Secci&oacute;n 7 - Controles del teclado]</a>
d3835 2
a3836 2
Originally [OpenBSD: faq6.html,v 1.168 2003/04/04 17:49:08 nick Exp ]<br>
$Translation: faq6.html,v 1.85 2003/04/06 22:13:42 horacio Exp $<br>
@


1.71
log
@
sync with steelix translation CVS
@
text
@d200 1
d270 6
a275 5
(<em>gateway</em>) Para ello basta con poner la direcci&oacute;n IP de
la pasarela en el fichero <i>/etc/mygate</i>.  Esto permitir&aacute; que
la pasarela se active en el momento del arranque.  A continuaci&oacute;n
hay que configurar los nombres de servidores (<em>nameservers</em>) y el
fichero <i>/etc/hosts</i> (v&eacute;ase la p&aacute;gina del manual de
d324 5
a328 2
El ejemplo siguiente muestra c&oacute;mo se pueden ver las tablas de las
rutas usando ambas herramientas.
d511 1
a511 1

d1391 1
a1391 1

d2508 1
a2508 1

d2997 1
a2997 1

d3020 1
a3020 1

d3053 1
a3053 1

d3073 1
a3073 1

d3691 2
a3692 2
<h3>Filtros de paquetes en un puente</h3>

d3788 2
a3789 2
Originally [OpenBSD: faq6.html,v 1.166 2003/04/01 02:57:17 nick Exp ]<br>
$Translation: faq6.html,v 1.84 2003/04/01 08:30:18 horacio Exp $<br>
@


1.70
log
@
sync with steelix translation CVS
@
text
@d425 1
a425 1
<h3>6.1.3 - Configuraci&oacute;n de un alias en una interfaz.</h3>
d1487 1
a1487 1
		      | Cliente A - 192.168.1.35 |
d1550 1
a1550 1
192.168.1.35 --- 192.168.1.1 [ NAT ] 24.5.0.5 --- 123.45.67.89
d1553 1
a1553 1
Desde: 192.168.1.35  &gt;&gt;=== NAT ===&gt;&gt; Hacia: 24.5.0.5
d1734 3
a1736 3
TCP  192.168.1.35:2132 -&gt; 24.5.0.5:53136 -&gt; 65.42.33.245:22       TIME_WAIT:TIME_WAIT
TCP  192.168.1.35:2492 -&gt; 24.5.0.5:55011 -&gt; 65.42.33.245:22       ESTABLISHED:ESTABLISHED
UDP  192.168.1.35:2491 -&gt; 24.5.0.5:60527 -&gt; 24.2.68.33:53       2:1
d1745 1
a1745 1
<dt>&quot;192.168.1.35:2132&quot;
d1747 1
a1747 1
usando NAT (192.168.1.35) en la LAN.  El n&uacute;mero del puerto que se
d3783 2
a3784 2
Originally [OpenBSD: faq6.html,v 1.165 2003/03/18 03:41:04 nick Exp ]<br>
$Translation: faq6.html,v 1.83 2003/03/18 12:33:29 horacio Exp $<br>
@


1.69
log
@
sync with steelix translation CVS
@
text
@d20 7
a26 1
<h2><font color="#e00000">6 - Redes</font></h2>
d3772 1
a3772 1
<a href="index.html">[Volver al &iacute;ndice principal]</a>
d3783 2
a3784 2
Originally [OpenBSD: faq6.html,v 1.164 2003/03/08 02:31:57 nick Exp ]<br>
$Translation: faq6.html,v 1.82 2003/03/12 20:15:40 horacio Exp $<br>
@


1.68
log
@
sync with steelix translation CVS
@
text
@a68 2
<a href="http://www.3com.com/corpinfo/en_US/technology/tech_paper.jsp?DOC_ID=135">Understanding IP addressing</a>
(tambi&eacute;n disponible desde
d70 3
a72 2
este enlace</a>).  &iexcl;Es un documento excelente que contiene
conocimientos fundamentales sobre redes de IP!
d3777 2
a3778 2
Originally [OpenBSD: faq6.html,v 1.163 2003/02/28 00:40:17 nick Exp ]<br>
$Translation: faq6.html,v 1.81 2003/03/01 11:24:49 horacio Exp $<br>
@


1.67
log
@
sync with steelix translation CVS
@
text
@d3299 1
a3299 1
<i>/var/named/named.pid</i>.
d3619 4
a3622 4
red, y por lo tanto tiene una direcci&oacute;n IP;  <tt>ep0</tt>
s&oacute;lo se va a usar para el puente, y por lo tanto no tiene una
direcci&oacute;n IP.  Las m&aacute;quinas conectadas al segmento coaxial
se comunican como si estuvieran en el resto de la red...
d3778 2
a3779 2
Originally [OpenBSD: faq6.html,v 1.160 2003/02/20 03:09:55 nick Exp ]<br>
$Translation: faq6.html,v 1.80 2003/02/21 19:40:35 horacio Exp $<br>
@


1.66
log
@
sync with steelix translation CVS
@
text
@d4 1
a4 1
<title>6.0 - Redes</title>
d20 1
a20 1
<h2><font color="#e00000">6.0 - Redes</font></h2>
d3768 2
a3769 2
<a href="faq5.html">[Secci&oacute;n 5.0 - Configuraci&oacute;n del n&uacute;cleo y del disco]</a>
<a href="faq7.html">[Secci&oacute;n 7.0 - Controles del teclado]</a>
d3778 2
a3779 2
Originally [OpenBSD: faq6.html,v 1.159 2003/01/01 13:02:00 nick Exp ]<br>
$Translation: faq6.html,v 1.79 2003/01/06 18:33:13 horacio Exp $<br>
@


1.65
log
@
sync with badlands translation CVS
@
text
@d12 1
a12 1
<meta name="copyright"     content="Este documento es copyright 1998-2002 de OpenBSD.">
d3778 2
a3779 2
Originally [OpenBSD: faq6.html,v 1.158 2002/12/14 23:36:27 couderc Exp ]<br>
$Translation: faq6.html,v 1.78 2002/12/15 07:34:02 horacio Exp $<br>
@


1.64
log
@
sync with badlands translation CVS
@
text
@d243 1
a243 1
inet 10.0.0.38 255.255.255.0 NONE media 100baseTX media-opt full-duplex
d3778 2
a3779 2
Originally [OpenBSD: faq6.html,v 1.157 2002/12/05 20:10:14 nick Exp ]<br>
$Translation: faq6.html,v 1.77 2002/12/05 23:52:01 horacio Exp $<br>
@


1.63
log
@
sync
@
text
@d2611 16
d3778 2
a3779 2
Originally [OpenBSD: faq6.html,v 1.156 2002/11/24 00:32:36 nick Exp ]<br>
$Translation: faq6.html,v 1.76 2002/11/24 08:24:22 horacio Exp $<br>
@


1.62
log
@
sync
@
text
@d1718 1
a1718 1
<b>Verificaci&oacute;n del estado de NAT</b>
d3762 2
a3763 2
Originally [OpenBSD: faq6.html,v 1.155 2002/11/20 14:20:56 dhartmei Exp ]<br>
$Translation: faq6.html,v 1.75 2002/11/21 21:25:53 horacio Exp $<br>
@


1.61
log
@
sync
@
text
@d2129 15
a2143 2
trav&eacute;s de otros redireccionamientos) o del mismo cortafuegos.  En
general, se deber&iacute;an utilizar las soluciones que se han
d3762 2
a3763 2
Originally [OpenBSD: faq6.html,v 1.154 2002/11/10 17:59:05 nick Exp ]<br>
$Translation: faq6.html,v 1.74 2002/11/11 14:24:15 horacio Exp $<br>
@


1.60
log
@
sync
@
text
@d1818 1
a1818 1
rdr on tl0 from any to any port 21 -&gt; 127.0.0.1 port 8021
d1823 3
a1825 3
&laquo;tr&aacute;fico en la interfaz interna se redirecciona al servidor
de proxy que hay funcionando en esta m&aacute;quina y que est&aacute; a
la escucha por el puerto 8021&raquo;.
d1879 1
a1879 1
rdr on fxp0 from any to any port 80 -&gt; 192.168.1.80 port 80
d1925 1
a1925 1
rdr on fxp0 from any to any port 8080 -&gt; 192.168.1.35 port 80
d1953 1
a1953 1
rdr on tl0 from any to ! 64.12.163.199 port 21 -&gt; 127.0.0.1 port 8021
d2001 1
a2001 1
rdr on $ext_if from any to $ext_if port 80 -&gt; $server port 80
d3749 2
a3750 2
Originally [OpenBSD: faq6.html,v 1.153 2002/11/05 21:45:02 jufi Exp ]<br>
$Translation: faq6.html,v 1.73 2002/11/09 21:25:49 horacio Exp $<br>
@


1.59
log
@
sync with badlands translation CVS
@
text
@d1 1
d20 3
a22 1
<h2><font color="#e00000">6.0 - Redes</font><hr></h2>
d25 2
a26 1
<ul><h3>&Iacute;ndice de contenidos</h3>
d38 1
a38 1
<li><a href= "#DNS">6.8 - El Servicio de Nombres de Dominio  - DNS,
d45 1
a47 1
<br>
d118 1
a118 1
<ul>
d123 1
a123 1
</ul>
d144 1
a144 1
<ul>
d146 1
a146 1
$ <strong>ifconfig -a</strong>
d175 1
a175 1
</ul>
d186 1
a186 2
indicadores <strong>UP</strong> y <strong>RUNNING</strong> se encuentran
activados.
d196 1
a196 1
<li><a href="http://www.openbsd.org/cgi-bin/man.cgi?query=pflog&amp;sektion=4&amp;manpath=OpenBSD+3.1">pflog</a> - Interfaz de registros del Filtro de Paquetes (<em>PF</em>)
d209 4
a212 5
fichero <strong>/etc/hostname.xxx</strong>, donde se debe sustituir
<strong>xxx</strong> por el nombre de la interfaz.  De acuerdo con la
informaci&oacute;n de los ejemplos anteriores, el nombre ser&iacute;a
<strong>/etc/hostname.fxp0</strong>.  La composici&oacute;n de este
fichero es as&iacute; de sencilla:<br>
d214 1
a214 1
<ul>
d218 1
a218 1
</ul>
d230 1
a230 1
<ul>
d232 1
a232 1
$ <strong>cat /etc/hostname.fxp0</strong>
d235 1
a235 1
</ul>
d242 1
a242 1
<ul><pre>
d244 1
a244 1
</pre></ul>
d257 2
a258 2
<ul><pre>
$ <strong>cat /etc/hostname.vlan0</strong>
d260 1
a260 1
</pre></ul>
d265 4
a268 5
la pasarela en el fichero <strong>/etc/mygate</strong>.  Esto
permitir&aacute; que la pasarela se active en el momento del arranque.
A continuaci&oacute;n hay que configurar los nombres de servidores
(<em>nameservers</em>) y el fichero <strong>/etc/hosts</strong>
(v&eacute;ase la p&aacute;gina del manual de
d271 3
a273 3
fichero con el nombre <strong>/etc/resolv.conf</strong>.
Puede verse m&aacute;s informaci&oacute;n sobre el formato de este
fichero en la p&aacute;gina del manual de
d279 1
a279 1
<ul>
d281 1
a281 1
$ <strong>cat /etc/resolv.conf</strong>
d287 1
a287 1
</ul>
d292 1
a292 1
<strong>/etc/netstart</strong>.  Este gui&oacute;n de
d296 1
a296 1
<ul>
d298 1
a298 1
# <strong>sh /etc/netstart</strong>
d304 1
a304 1
</ul>
d320 1
a320 1
<ul>
d322 1
a322 1
$ <strong>netstat -rn</strong>
d338 1
a338 1
$ <strong>route show</strong>
d351 1
a351 1
</ul>
d386 1
a386 1
<ul>
d390 1
a390 1
</ul>
d400 1
a400 1
<ul>
d402 1
a402 1
# <strong>sysctl -w net.inet.ip.forwarding=1</strong>
d405 1
a405 1
</ul>
d432 2
a433 2
<strong>dc0</strong> y pertenece a la red 192.168.0.0.  Otra
informaci&oacute;n de importancia es:
d458 2
a459 2
dispositivo <strong>dc0</strong>, el cual, por cierto, se
configur&oacute; como 192.168.0.2 netmask 255.255.255.0.
d461 1
a461 1
<ul>
d463 1
a463 1
# <strong>cat /etc/hostname.dc0</strong>
d468 1
a468 1
</ul>
d477 1
a477 1
<ul>
d479 1
a479 1
# <strong>ifconfig dc0 inet alias 192.168.0.3 netmask 255.255.255.255</strong>
d481 1
a481 1
</ul>
d486 1
a486 1
<ul>
d488 1
a488 1
$ <strong>ifconfig -A</strong>
d494 1
a494 1
</ul>
a499 1
<a name="PacketFilter"></a>
d503 27
a529 5
<h5>Nota: <em>Packet Filter</em> (el sistema de filtros de paquetes IP
de OpenBSD) es el subsistema de filtrado para OpenBSD 3.0 y versiones
posteriores.  Las preguntas frecuentes sobre IPF/IPNAT para OpenBSD 2.9
y versiones anteriores, se encuentran en <a href="faqipf.html">esta
p&aacute;gina</a>.</h5>
d535 3
a537 4
direcciones externas.  Los ficheros de configuraci&oacute;n para estos
dos servicios son
<em><a href="http://www.openbsd.org/cgi-bin/man.cgi?query=pf.conf&amp;sektion=5&amp;manpath=OpenBSD+3.1">/etc/pf.conf(5)</a></em> and
<em><a href="http://www.openbsd.org/cgi-bin/man.cgi?query=nat.conf&amp;sektion=5&amp;manpath=OpenBSD+3.1">/etc/nat.conf(5)</a></em>.
d545 1
a545 1
<ul>
d549 1
a549 1
</ul>
d565 1
a565 1
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=pfctl&amp;sektion=8&amp;manpath=OpenBSD+3.1">pfctl(8)</a>:
d567 1
a567 1
<ul>
d569 2
a570 3
# <strong>pfctl -R /etc/pf.conf</strong>
# <strong>pfctl -N /etc/nat.conf</strong>
# <strong>pfctl -e</strong>
d572 1
a572 1
</ul>
d575 2
a576 6
La primera l&iacute;nea configura el filtrado usando
<em>/etc/pf.conf</em>, y la segunda configura la traducci&oacute;n de
direcciones usando <em>/etc/nat.conf</em> (m&aacute;s informaci&oacute;n
sobre la traducci&oacute;n de direcciones IP en la secci&oacute;n sobre
<a href="#NAT"><tt>NAT</tt>)</a>) de este documento y, finalmente, la
&uacute;ltima l&iacute;nea activa PF.
d582 3
a584 5
<ul>
<pre>
# <strong>pfctl -R /etc/pf.conf -N /etc/nat.conf -e</strong>
</pre>
</ul>
d589 1
a589 1
reglas recargando el fichero apropiado:
d591 3
a593 5
<ul>
<pre>
# <strong>pfctl -R /etc/pf.conf</strong>
</pre>
</ul>
d597 2
a598 3
b&aacute;sicos de configuraciones de
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=pf.conf&amp;sektion=5&amp;manpath=OpenBSD+3.1">pf.conf(5)</a>
y <a href="http://www.openbsd.org/cgi-bin/man.cgi?query=nat.conf&amp;sektion=5&amp;manpath=OpenBSD+3.1">nat.conf(5)</a>.
d617 1
a617 1
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=pf.conf&amp;sektion=5&amp;manpath=OpenBSD+3.1">pf.conf(5)</a>. 
d633 1
a633 2
<ul>
<pre>
d636 1
a636 2
</pre>
</ul>
d641 1
a641 2
<ul>
<pre>
d644 1
a644 2
</pre>
</ul>
d672 1
a672 2
<ul>
<pre>
d676 1
a676 2
</pre>
</ul>
d693 1
a693 2
<ul>
<pre>
d697 1
a697 2
</pre>
</ul>
d703 2
a704 2
tener en cuenta lo siguiente: <strong>La &uacute;ltima regla que
concuerde tendr&aacute; precedencia</strong>.
d713 1
a713 2
<ul>
<pre>
d717 1
a717 2
</pre>
</ul>
d727 1
a727 1
<strong>Denegaci&oacute;n predefinida</strong>
d746 1
a746 1
<ul>
d754 1
a754 1
</ul>
d767 1
a767 2
<ul>
<pre>
d773 1
a773 2
</pre>
</ul>
d780 1
a780 2
<ul>
<pre>
d782 1
a782 2
</pre>
</ul>
d787 1
a787 2
<ul>
<pre>
d789 1
a789 2
</pre>
</ul>
d792 1
a792 1
<strong>Ejemplos de reglas</strong>
d803 1
a803 1
<ul><pre>
d808 1
a808 1
</pre></ul>
d814 1
a814 1
<ul><pre>
d838 1
a838 2
</pre>
</ul>
d841 1
a841 1
<strong>Registro de paquetes</strong>
d851 1
a851 2
<ul>
<pre>
d854 1
a854 2
</pre>
</ul>
d865 1
a865 1
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=pflogd&amp;sektion=8&amp;manpath=OpenBSD+3.1">pflogd(8)</a>,
d868 1
a868 1
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=tcpdump&amp;sektion=8&amp;manpath=OpenBSD+3.1">tcpdump(8)</a>.
d875 3
a877 5
<ul>
<pre>
# <strong>tcpdump -n -e -ttt -r /var/log/pflog</strong>
</pre>
</ul>
d881 1
a881 1
monitorizaci&oacute;n del fichero <em>pflog</em> NO ofrece
d885 3
a887 5
<ul>
<pre>
# <strong>tcpdump -i pflog0</strong>
</pre>
</ul>
d893 3
a895 5
<ul>
<pre>
# <strong>tcpdump -e -i pflog0 port 80</strong>
</pre>
</ul>
d921 1
a921 1
<strong>Registro de paquetes con <tt>syslog</tt></strong>
d933 1
a933 1
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=syslogd&amp;sektion=8&amp;manpath=OpenBSD+3.1">Syslogd(8)</a>
d942 1
a942 1
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=adduser&amp;sektion=8&amp;manpath=OpenBSD+3.1">adduser(8)</a>.
d950 1
a950 1
<ul><pre>
d958 1
a958 1
</ul></pre>
d962 1
a962 1
<ul><pre>
d969 1
a969 1
</ul></pre>
d977 1
a977 1
<ul><pre>
d979 1
a979 1
</pre></ul>
d984 1
a984 1
<ul><pre>
d987 1
a987 1
</ul></pre>
d992 1
a992 1
<ul><pre>
d994 1
a994 1
</pre></ul>
d999 1
a999 1
<ul><pre>
d1002 1
a1002 1
</ul></pre>
d1007 1
a1007 1
<ul><pre>
d1009 1
a1009 1
</ul></pre>
d1015 1
a1015 1
<ul><pre>
d1017 1
a1017 1
</ul></pre>
d1022 1
a1022 1
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=hosts&amp;sektion=5&amp;manpath=OpenBSD+3.1">/etc/hosts(5)</a>.
d1033 1
a1033 1
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=newsyslog&amp;sektion=8&amp;manpath=OpenBSD+3.1">newsyslogd(8) </a>
d1039 1
a1039 1
<ul><pre>
d1042 1
a1042 1
</ul></pre>
d1053 1
a1053 1
<strong>Protocolos m&uacute;ltiples</strong>
d1061 1
a1061 2
<ul>
<pre>
d1064 1
a1064 2
</pre>
</ul>
d1071 1
a1071 2
<ul>
<pre>
d1074 1
a1074 2
</pre>
</ul>
d1078 1
a1078 1
<strong>Normalizaci&oacute;n de paquetes</strong>
d1089 1
a1089 1
<strong>scrub</strong>, que se usa como sigue:
d1091 1
a1091 2
<ul>
<pre>
d1093 1
a1093 2
</pre>
</ul>
d1102 1
a1102 1
<strong>Opciones de IP</strong>
d1109 1
a1109 2
como puede ser IGMP, puede usarse la directiva
<strong>allow-opts</strong>:
d1111 1
a1111 2
<ul>
<pre>
d1113 1
a1113 2
</pre>
</ul>
d1116 2
a1117 2
<strong>Indicadores de TCP, conexiones establecidas, y mantenimiento del
estado</strong>
d1130 1
a1130 2
<ul>
<pre>
d1132 1
a1132 2
</pre>
</ul>
d1135 1
a1135 1
(Gracias a <a href=mailto:halogen@@nol.net>Kyle Hargraves</a> por esta
d1159 7
a1165 7
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=lynx&amp;sektion=1">lynx(1)</a>
para buscar algo en los documentos de las preguntas frecuentes?  No
podr&iacute;amos, ya que habr&iacute;amos bloqueado todas las conexiones
entrantes que no fueran dirigidas a los puertos especificados.  Aunque
&eacute;sta es la ruta m&aacute;s segura, puede ser muy poco
conveniente.  a&ntilde;adiendo las opciones clave <em>keep state</em> a
la regla &quot;pass out&quot;, podemos permitir de forma
d1172 1
a1172 2
<ul>
<pre>
d1178 1
a1178 2
</pre>
</ul>
d1198 1
a1198 2
<ul>
<pre>
d1208 1
a1208 2
</pre>
</ul>
d1224 1
a1224 2
<ul>
<pre>
d1253 1
a1253 2
</pre>
</ul>
d1262 1
a1262 1
<strong><em>Sets</em> (agrupaciones)</strong>
d1271 1
a1271 2
<ul>
<pre>
d1273 1
a1273 2
</pre>
</ul>
d1285 1
a1285 2
<ul>
<pre>
d1292 1
a1292 2
</pre>
</ul>
d1295 1
a1295 1
<strong>Variables de expansi&oacute;n</strong>
d1304 1
a1304 2
<ul>
<pre>
d1309 1
a1309 2
</pre>
</ul>
d1313 1
a1313 1
<strong>Todo junto</strong>
d1319 1
a1319 2
<ul>
<pre>
d1351 1
a1351 2
</pre>
</ul>
d1358 1
a1358 2
<ul>
<pre>
d1360 1
a1360 2
</pre>
</ul>
d1363 1
a1363 1
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=pflogd&amp;sektion=8&amp;manpath=OpenBSD+3.1">pflogd(8)</a>
d1368 1
a1368 1
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=tcpdump&amp;sektion=8&amp;manpath=OpenBSD+3.1">tcpdump(8)</a>,
a1376 37
<h3>Diferencias entre PF e IPF</h3>

<p>
El Filtro de Paquetes IP (PF), se ha dise&ntilde;ado para que tenga un
alto nivel de compatibilidad con el fichero de reglas <em>ipf.rules</em>
de IPF.  PF no es un simple sustituto de IPF.  Las principales
diferencias sint&acute;cticas entre la reglas de filtrado son las
siguientes:

<ul>
<li><strong><em>group</em> y <em>head</em>:</strong>
Estas opciones ya no se utilizan, debido a que las reglas de filtrado se
optimizan al vuelo.  Si se est&aacute; migrando desde las viejas reglas
de IPF es preciso eliminar cualquier definici&oacute;n de <em>group</em>
o <em>head</em> y reordenar las reglas de forma manual,
asegur&aacute;ndose de que la sem&aacute;ntica no haya cambiado.
<li><strong><em>level:</em></strong>
Cuando se efect&uacute;an registros, PF no acepta la opci&oacute;n
<em>level</em> como clave de registro, ya que el registro se realiza a
trav&eacute;s de
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=syslogd&amp;sektion=8">syslogd(8)</a>,
pero mediante un d&aelig;mon de registro separado.  Para examinar un
tipo de tr&aacute;fico particular, como se hac&iacute;a con la
opci&oacute;n <em>level</em>, hay que usar cualquiera de las opciones de
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=tcpdump&amp;sektion=8&amp;manpath=OpenBSD+3.1">tcpdump(8)</a>
disponibles para este efecto.
<li><strong><em>keep frags</em>:</strong>
Se ha sustituido por la normalizaci&oacute;n que realiza
<a href="#normalization">scrub</a>.
<li><strong>Reglas <em>@@n</em>:</strong>
En PF no existe soporte para prefijar reglas con <em>@@n</em> con el fin
de introducirlas en ciertos puntos en la lista de la regla, como en IPF.
Para ver los n&uacute;meros de regla que ha asignado PF se debe usar la
orden <kbd>pfctl -sr</kbd>.
</ul>

<p>
d1383 4
a1386 4
<h5>Nota: PF es el sistema de filtrado en OpenBSD 3.0 y versiones
posteriores.  Las preguntas frecuentes sobre IPF/IPNAT para OpenBSD 2.9
y versiones anteriores, se encuentran en
<a href="faqipf.html">esta p&aacute;gina</a>.</h5>
d1409 1
a1409 1
192.168.0.0/16 (192.168.0.0 - 192.168.255.255)<br>
d1416 1
a1416 1
<br>
d1418 1
a1418 1
<strong>Detalles de configuraci&oacute;n</strong>
d1427 17
a1443 15
<ul>
<strong>NICs: </strong>
<ul>
Intel EtherExpress Pro/100 <strong>fxp0</strong><br>
Conectada a la LAN EXTERNA (o WAN)<br>
<strong>IP Address: </strong>24.5.0.5<br>
<strong>Netmask: </strong>255.255.255.0<br>
<br>
Compaq Netelligent 10/100Mb <strong>tl0</strong><br>
Conectada a la LAN INTERNA<br>
<strong>IP Address: </strong>192.168.1.1<br>
<strong>Netmask: </strong>255.255.255.0<br>
</ul>
<br>
<strong>IP enrutable por Internet, externo (en este ejemplo, una
d1445 10
a1454 9
proveedor de servicios de Internet)</strong><br>
<ul>
<strong>IP Address: </strong>24.5.0.5<br>
<strong>Netmask: </strong>255.255.255.0<br>
<strong>Gateway: </strong>24.5.0.1<br>
</ul>
<br>
<strong>Red de &Aacute;rea Local (LAN)</strong><br>
<ul>
d1464 5
a1468 4
</ul>
<br>
<strong>Diagrama de configuraci&oacute;n</strong>
<ul><pre>
d1485 2
a1486 2
</pre></ul>
</ul>
d1488 1
a1488 1
<br>
a1490 1
<br>
d1492 1
d1494 1
a1494 1
<strong>Introducci&oacute;n a NAT</strong>
d1543 1
a1543 1
<ul><pre>
d1554 1
a1554 1
</pre></ul>
d1556 1
a1556 1
<br>
d1558 1
a1558 1
<strong>&iquest;Por qu&eacute; usar NAT?</strong>
d1590 1
a1590 1
<strong>Preconfiguraci&oacute;n</strong>
d1600 2
a1601 2
<strong>/etc/rc.conf</strong> (este fichero se usa para iniciar
servicios durante el arranque)
d1603 1
a1603 1
<ul><pre>
d1605 1
a1605 1
</pre></ul>
d1608 1
a1608 1
<strong>/etc/sysctl.conf</strong>
d1610 1
a1610 1
<ul><pre>
d1612 1
a1612 1
</pre></ul>
d1620 1
a1620 1
<strong>Configuraci&oacute;n</strong>
d1624 1
a1624 1
(<em><a href="http://www.openbsd.org/cgi-bin/man.cgi?query=pf.conf&amp;sektion=5&amp;manpath=OpenBSD+3.1">/etc/pf.conf</a></em>).
d1629 1
a1629 2
<ul>
<pre>
d1632 1
a1632 2
</pre>
</ul>
d1640 3
a1642 2
La sintaxis del fichero de configuraci&oacute;n de NAT
(<em><a href="http://www.openbsd.org/cgi-bin/man.cgi?query=nat.conf&amp;sektion=5&amp;manpath=OpenBSD+3.1">/etc/nat.conf</a></em>)
d1647 1
a1647 2
<ul>
<pre>
d1649 1
a1649 2
</pre>
</ul>
d1654 24
a1677 27
<ul>
<strong>&quot;nat&quot;</strong>
<p>
Indica que la orden que se est&aacute; dando es una regla de NAT.
</ul>

<ul>
<strong>&quot;fxp0&quot;</strong>
<p>
&Eacute;sta es la interfaz de red que est&aacute; conectada a Internet.
</ul>

<ul>
<strong>&quot;192.168.1.0/24&quot;</strong>
<p>
La direcci&oacute;n IP y de enmascaramiento de red (<em>netmask</em>,
cuyo formato es CIDR).  La combinaci&oacute;n de ambas indica que
&laquo;se debe asignar cualquier direcci&oacute;n IP con un valor desde
192.168.1.1 hasta 192.168.1.254&raquo;.
</ul>

<ul>
<strong>&quot;24.5.0.5&quot;</strong>
<p>
&Eacute;sta es la direcci&oacute;n IP externa que se asignar&aacute; a
la direcci&oacute;n IP interna.
</ul>
d1682 1
a1682 1
<strong>Funcionamiento</strong>
d1693 1
a1693 1
<ul>
d1695 2
a1696 2
# <strong>pfctl -N /etc/nat.conf</strong>
# <strong>pfctl -e</strong>
d1698 1
a1698 1
</ul>
d1707 4
a1710 4
<strong>Nota:</strong> para volver a cargar las configuraciones de NAT
(en el caso en que se cambiaran y no se quisiera reiniciar) debe
ejecutarse de nuevo la primera orden.  Las configuraciones ser&aacute;n
descargadas y cargadas de nuevo.
d1712 1
a1712 1
<br>
d1716 1
a1716 1
<br>
d1718 1
a1718 1
<strong>Verificaci&oacute;n del estado de NAT</strong>
d1726 1
a1726 1
<ul>
d1733 1
a1733 1
</ul>
d1739 3
a1741 4
<ul>
<strong>&quot;192.168.1.35:2132&quot;</strong>
<p>
Indica la direcci&oacute;n IP de la m&aacute;quina que est&eacute;
d1745 1
a1745 14
</ul>

<ul>
<strong>&quot;24.5.0.5:53136&quot;</strong>
<p>
Indica que la conexi&oacute;n se dirige hacia Internet a trav&eacute;s
de la direcci&oacute;n 24.5.0.5, usando el puerto 53136.
</ul>

<ul>
<strong>&quot;65.42.33.245:22&quot;</strong>
<p>
La direcci&oacute;n IP y el puerto al que se conecta.
</ul>
d1747 16
a1762 6
<ul>
<strong>&quot;TIME_WAIT:TIME_WAIT&quot;</strong>
<p>
Indica el estado en que PF cree que se encuentra la
conexi&oacute;n TCP.
</ul>
d1766 1
a1766 1
<strong>Consideraciones sobre FTP y NAT</strong>
d1799 2
a1800 2
<dl><dt>
<pre>
d1802 4
a1805 3
</pre>
</dt></dl>
desde el punto de pedido <em>ftp&gt;</em>.
d1813 2
a1814 2
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=ftp-proxy&amp;sektion=8&amp;manpath=OpenBSD+3.1">ftp-proxy(8)</a>.
Para activarlo hay que a&ntilde;adir al fichero <em>/etc/nat.conf</em>
d1817 1
a1817 2
<ul>
<pre>
d1819 1
a1819 2
</pre>
</ul>
d1821 1
d1832 1
a1832 2
<ul>
<pre>
d1834 1
a1834 2
</pre>
</ul>
d1840 1
a1840 2
<ul>
<pre>
d1842 1
a1842 2
</pre>
</ul>
d1844 1
d1853 1
a1853 1
<strong>Redireccionamiento del tr&aacute;fico</strong>
d1875 1
a1875 1
siguiente en el fichero <em>/etc/nat.conf</em>:
d1877 1
a1877 1
<ul>
d1881 1
a1881 1
</ul>
d1887 4
a1890 5
<ul>
<strong>&quot;rdr&quot;</strong>
<p>
Es la orden que le est&aacute; pasando a NAT.  Indica a NAT que lo que
viene a continuaci&oacute;n es una entrada para redireccionar una
d1892 1
a1892 2
</ul>

a1893 13
<ul>
<strong>&quot;on fxp0&quot;</strong>
<p>
Es la interfaz de red que est&aacute; conectada a Internet.
</ul>

<ul>
<strong>&quot;from any to any&quot;</strong>
 <p>
Indica cu&aacute;l es la direcci&oacute;n IP que hay que redireccionar
(cualquiera de las que entren en fxp0, como se indica anteriormente, con
cualquier IP como destino).
</ul>
d1895 16
a1910 5
<ul>
<strong>&quot;port 80&quot;</strong>
<p>
&Eacute;ste es el puerto (80) entrante que debe ser redireccionado.  No
es estrictamente necesario indicar el puerto con el n&uacute;mero
d1916 1
a1916 1
</ul>
d1918 3
a1920 4
<ul>
<strong>&quot;192.168.1.80 port 80&quot;</strong>
<p>
La direcci&oacute;n IP de la m&aacute;quina LAN a la que son
d1930 1
a1930 1
</ul>
d1937 1
a1937 1
<strong>Denegaci&oacute;n</strong>
d1951 1
a1951 1
<ul>
d1955 1
a1955 1
</ul>
d1969 1
a1969 1
<strong>NAT frente a proxy</strong>
d1993 1
a1993 1
<strong>Redireccionamiento y reflexi&oacute;n</strong>
d2045 1
a2045 1
<strong>Dividir el horizonte de DNS</strong>
d2058 1
a2058 1
<strong>Trasladar el servidor a una red local separada</strong>
d2073 1
a2073 1
<strong>TCP proxying</strong>
d2105 1
a2105 1
<strong>Combinaci&oacute;n de RDR y NAT</strong>
d2135 1
a2135 1
<strong>6.3.4 Enlaces y referencias</strong>
d2140 1
a2140 1
<li><em>/etc/nat.conf</em> - fichero de reglas de NAT
d2151 2
a2152 2
<li><a href="http://www.openbsd.org/cgi-bin/man.cgi?query=nat.conf&amp;sektion=5&amp;manpath=OpenBSD+3.1">p&aacute;gina del manual de nat.conf</a>
<li><a href="http://www.openbsd.org/cgi-bin/man.cgi?query=pfctl&amp;sektion=8&amp;manpath=OpenBSD+3.1">p&aacute;gina del manual de pfctl</a>
a2155 1
<br>
d2157 1
a2157 1
<p> 
d2162 1
d2174 1
a2174 1
# <strong>echo dhcp &gt;/etc/hostname.xl0</strong>
d2177 1
d2186 1
a2186 1
<em>/etc/dhclient</em> exista, y entonces usar la orden:
d2189 1
a2189 1
# <strong>dhclient fxp0</strong>
d2192 1
d2197 5
a2201 5
fichero <em>/etc/dhclient</em> para <strong>evitar</strong> que se
actualice la DNS de acuerdo con la idea que tenga el servidor de dhcp
sobre la DNS, comentando las l&iacute;neas precedidas por 'request' (son
ejemplos de la configuraci&oacute;n predefinida, pero es necesario
activarlos para anular la configuraci&oacute;n predefinida de dhclient).
d2208 2
a2209 1
y a continuaci&oacute;n <strong>eliminar</strong> domain-name-servers.
d2216 1
d2219 1
a2219 1
hay que editar el fichero <em>/etc/rc.conf</em>, y configurarlo
d2221 3
a2223 3
Tambi&eacute;n hay que a&ntilde;adir en <em>/etc/dhcp.interfaces</em>
las interfaces en las que se quiera que dhcp est&eacute; <strong>a la
escucha</strong>:
d2226 1
a2226 1
# <strong>echo xl1 xl2 xl3 &gt;/etc/dhcpd.interfaces</strong>
d2229 2
a2230 1
y editar <em>/etc/dhcpd.conf</em>.  Las opciones son bastante claras:
d2244 9
a2252 9
Con esto indicar&eacute;mos a los clientes de dhcp que el dominio que
deben a&ntilde;adir a sus requerimientos de DNS es xyz.mil (as&iacute;,
si un usuario escribiera 'telnet joe', los enviar&iacute;a a
joe.xyz.mil).  Les dirigir&aacute; a los servidores de DNS 192.168.1.3 y
192.168.1.5.  Para los anfitriones que se encuentren en la misma red que
una interfaz de ethernet en la m&aacute;quina de OpenBSD, que
est&aacute; en el rango 192.168.1.0/24, les asignar&aacute; una
direcci&oacute;n de IP entre 192.168.1.32 y 192.168.1.127, con una
configuraci&oacute;n predeterminada de la pasarela como 192.168.1.1.
d2255 2
a2256 2
Si se quiere iniciar dhcpd desde la l&iacute;nea de &oacute;rdenes, hay
que intentar lo siguiente despu&eacute;s de editar
d2260 1
a2260 1
# <strong>dhcpd -q fxp0</strong>
d2263 4
a2266 3
En donde fxp0 es la interfaz que se quiere que empiece a servir dhcp.
El indicador -q fuerza una salida silenciosa de dhcpd, ya que de otro
modo es muy ruidoso.
d2270 1
a2270 1
Windows, es posible que se desee que dhcp ofrezca al cliente una
d2275 1
a2275 1
option	netbios-name-servers	192.168.92.55;
d2278 4
a2281 3
En donde 192.168.92.55 es el IP del servidor de Windows o Samba.  Para
ver m&aacute;s opciones que puedan aceptar sus clientes DHCP,
v&eacute;se
d2319 1
a2319 1
<em>/etc/ppp</em> de gran utilidad, que pueden contener diferentes
d2328 1
a2328 1
<ul><pre><strong>
d2330 1
a2330 2
</strong></pre></ul>

d2332 1
d2337 7
a2343 7
consiste en editar su fichero <em>/etc/ppp/ppp.conf</em>.  Este fichero
no existe y se debe crear, pero se puede tomar el fichero
<em>/etc/ppp/ppp.conf.sample</em>, editarlo, y crear un fichero
<em>ppp.conf</em> propio a partir de ah&iacute;.  Aqu&iacute;
empezaremos con la m&aacute;s simple, y probablemente m&aacute;s
utilizada, configuraci&oacute;n.  A continuaci&oacute;n puede verse un
peque&ntilde;o fichero <em>ppp.conf</em> que realizar&aacute; la
d2345 1
a2345 1
nuestro <em>nameserver</em>.  Para este fichero, toda la
d2350 1
a2350 2
<ul>
<pre>
d2356 1
a2356 2
</pre>
</ul>
d2359 16
a2374 16
La secci&oacute;n bajo la opci&oacute;n <strong>default:</strong> se
ejecutada cada vez que se requiera una conexi&oacute;n.  En ella se
configura toda la informaci&oacute;n cr&iacute;tica.  Con &quot;set
log&quot; se configuran los niveles de ingreso.  Esto se puede cambiar;
para m&aacute;s informaci&oacute;n sobre c&oacute;mo configurar los
niveles de ingreso v&eacute;ase la p&aacute;gina del manual de
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=ppp&amp;sektion=8">ppp(8)</a>.
El dispositivo se configura con &quot;set device&quot;.  &Eacute;ste es
el dispositivo en el que se encuentra el m&oacute;dem.  En este ejemplo
el m&oacute;dem est&aacute; en el puerto de comunicaciones 2 (COM2),
mientras que el puerto de comunicaciones 1 corresponder&iacute;a a
<em>/dev/cua00</em>.  Con &quot;set speed&quot; se configura la
velocidad de la conexi&oacute;n por llamada, y con &quot;set dial&quot;
se configuran los par&aacute;metros de la llamada.  Con esto se puede
cambiar el tiempo muerto, etc...  Es conveniente dejar esta l&iacute;nea
m&aacute;s o menos como est&aacute;.
d2379 6
a2384 7
otra opci&oacute;n en la secci&oacute;n <strong>default:</strong>.  Se
puede dar cualquier nombre a esta etiqueta, pero lo m&aacute;s
f&aacute;cil es darle el nombre del ISP.  En el ejemplo usaremos
<strong>myisp:</strong> para la opci&oacute;n que har&aacute; referencia
a nuestro ISP.  He aqu&iacute; una configuraci&oacute;n simple que
incorpora todo lo necesario para conectar:
<p>
d2386 1
a2386 2
<ul>
<pre>
d2394 1
a2394 2
</pre>
</ul>
d2413 1
a2413 1
<ul><pre>
d2415 1
a2415 1
</pre></ul>
d2418 13
a2430 14
Hemos configurado la l&iacute;nea anterior con el formato
&quot;<strong>set ifaddr [myaddr[/nn] [hisaddr[/nn] [netmask
[triggeradr]]]]</strong>&quot;.  De este modo el primer IP que se
especifique es el que querremos como nuestro IP.  Si se tiene una
direcci&oacute;n IP est&aacute;tica, se debe a&ntilde;adir aqu&iacute;.
En el ejemplo hemos usado /0, que indica que no es necesario que
concuerde ning&uacute;n bit de esta direcci&oacute;n ip, y que se puede
sustituir todo.  El segundo IP que se especifique es el que esperamos
como el IP de nuestro ISP.  Si lo conocemos lo podemos especificar
aqu&iacute;, pero en la l&iacute;nea no sabemos cu&aacute;l se
asignar&aacute;, as&iacute; que dejaremos que nos lo digan.  Esto es muy
&uacute;til al negociar con algunas implementaciones PPP que no asignan
un n&uacute;mero IP a menos que la conexi&oacute;n les requiera
``0.0.0.0''.
d2441 1
d2445 1
a2445 1
Ahora que ya tenemos el fichero <em>ppp.conf</em> configurado, podemos
d2451 1
a2451 1
   <li><em>ppp -auto myisp</em> - Inicia ppp, configura las interfaces,
d2453 1
a2453 1
   <li><em>ppp -ddial myisp</em> - Parecido a -auto, pero si la
d2458 1
a2458 1
Si se usa <em>/usr/sbin/ppp</em> sin pasarle ninguna opci&oacute;n,
d2461 1
a2461 1
depurar problemas en el fichero <em>ppp.conf</em>.
d2463 1
d2469 2
a2470 2
<em>/etc/ppp/ppp.linkup</em> y <em>/etc/ppp/ppp.linkdown</em>.  Pueden
verse ejemplos de configuraci&oacute;n para estos ficheros en:
d2486 1
d2491 1
d2505 1
d2511 1
d2515 1
d2529 1
d2533 1
d2545 1
a2545 1
 #  <strong>sysctl -w  net.inet.tcp.baddynamic=749,750,751,760,761,871</strong>
d2550 2
a2551 2
 #  <strong>sysctl -w net.inet.tcp.baddynamic=+748</strong>
 #  <strong>sysctl -w net.inet.tcp.baddynamic=-871</strong>
d2591 3
a2593 3
sistema de archivos a <em>/etc/exports</em> sin alg&uacute;n tipo de
lista de anfitriones autorizados.  Sin una lista de anfitriones que
puedan montar un directorio particular, cualquiera que pueda llegar al
d2595 1
a2595 1
<em>exports</em>.
d2599 6
a2604 6
<strong>10.0.0.1</strong>, que servir&aacute; NFS s&oacute;lo a clientes
dentro de esa red.  El primer paso para configurar NFS es configurar el
fichero <em>/etc/exports</em>.  Este fichero se compone de una lista con
los sistemas de archivos que se quiera que sean accesibles por medio de
NFS, y define qui&eacute;n puede acceder a cada uno de ellos.  Existen
muchas opciones que puede usar en su fichero <em>/etc/exports</em>, y es
d2607 1
a2607 1
En este ejemplo empezaremos con un fichero <em>/etc/exports</em> como el
d2610 1
a2610 2
<ul>
<pre>
d2617 1
a2617 32
</pre>
</ul>

<p>
Esto quiere decir que el sistema de archivos local <em>/work</em>
estar&aacute; disponible a trav&eacute;s de NFS.
<strong>-alldirs</strong> indica que los clientes podr&aacute;n montar
en cualquier parte bajo el punto de montaje <em>/work</em>.
<strong>-ro</strong> indica que &uacute;nicamente se permitir&aacute;
montarlo en modo de s&oacute;lo lectura.  Los dos &uacute;ltimos
argumentos indican que s&oacute;lo los clientes dentro de la red
10.0.0.0 que usen una m&aacute;scara de red 255.255.255.0,
estar&aacute;n autorizados a montar este sistema de archivos.  Esto es
importante en algunos servidores accesibles desde diferentes redes.

<p>
Una vez que se haya configurado el fichero <em>/etc/exports</em>, se
puede continuar y pasar a configurar el servidor de NFS.  Primero hay
que asegurarse de que las opciones NFSSERVER y NFSCLIENT se encuentren
en la configuraci&oacute;n del n&uacute;cleo del sistema (el
n&uacute;cleo GENERIC incluye estas opciones).  A continuaci&oacute;n
hay que configurar <strong>nfs_server=YES</strong> en el fichero
<em>/etc/rc.conf</em>.  De este modo, cuando se reinicie el sistema, se
activar&aacute;n nfsd(8) y mountd(8).  Ahora ya se pueden iniciar los
d&aelig;mons.  Estos d&aelig;mons deben ser iniciados por el
superusuario, <em>root</em>, y es necesario asegurarse de que portmap(8)
est&eacute; en funcionamiento en el sistema.  El ejemplo que sigue sobre
c&oacute;mo iniciar nfsd(8) sirve tanto para TCP como para UDP usando 4
d&aelig;mons.  Para gestionar el m&aacute;ximo n&uacute;mero de
requerimientos de clientes concurrentes a los que se quiera dar
servicio, hay que activar un n&uacute;mero apropiado de d&aelig;mons del
servidor de NFS.
d2620 31
a2650 6

<ul>
<pre>
# <strong>/sbin/nfsd -tun 4</strong>
</pre>
</ul>
a2657 1
<p>
d2659 4
a2662 6
<ul>
<pre>
# <strong>echo -n &gt;/var/db/mountdtab</strong>
# <strong>/sbin/mountd</strong>
</pre>
</ul>
d2670 3
a2672 5
<ul>
<pre>
# <strong>kill -HUP `cat /var/run/mountd.pid`</strong>
</pre>
</ul>
a2674 1

d2682 2
a2683 5
<p>

<ul>
<pre>
$ <strong>rpcinfo -p 10.0.0.1</strong>
d2695 1
a2695 2
</pre>
</ul>
d2706 1
a2706 1
<strong>/usr/bin/showmount -a host</strong>.  Por ejemplo:
d2708 2
a2709 5
<p>

<ul>
<pre>
$ <strong>/usr/bin/showmount -a 10.0.0.1</strong>
d2712 1
a2712 2
</pre>
</ul>
d2714 1
d2721 2
a2722 2
Para montar el sistema de archivos <em>/work</em> del anfitri&oacute;n
10.0.0.1 en un sistema de archivo local <em>/mnt</em>, se debe hacer lo
a2724 1
<p>
d2726 3
a2728 5
<ul>
<pre>
# <strong>mount -t nfs 10.0.0.1:/work /mnt</strong>
</pre>
</ul>
d2730 1
a2730 1
<P>
d2734 1
a2734 4
<p>

<ul>
<pre>
d2736 1
a2736 2
</pre>
</ul>
d2745 1
a2745 4
<p>

<ul>
<pre>
d2747 1
a2747 2
</pre>
</ul>
d2760 1
d2783 1
a2783 1
<ul>
d2785 1
a2785 1
$ <strong>nslookup www.openbsd.org</strong>
d2793 1
a2793 1
</ul>
d2796 4
a2799 4
<strong>165.87.201.244</strong> es el nombre del servidor que ha
contestado, porque es el &laquo;nombre de servidor&raquo;
(<em>nameserver</em>) que mi proveedor me dijo que usara con mi cuenta,
y cuyo n&uacute;mero se debe introducir en el fichero
d2806 1
a2806 1
<ul>
d2810 1
a2810 1
$ <strong>nslookup -type=NS openbsd.org</strong>
d2831 1
a2831 1
$ <strong>nslookup www.openbsd.org zeus.theos.com</strong>
d2838 1
a2838 1
</ul>
d2845 1
d2847 1
d2881 1
d2911 7
a2917 8
<li><strong>Nota:</strong> No existen restricciones en la
pr&aacute;ctica al n&uacute;mero de servidores de DNS en una LAN.
Cualquier m&aacute;quina o todas las de la LAN puede ofrecer el servicio
de DNS si se configuran para ello.  Que uno de estos servidores se
considere autorizado desde fuera de la LAN (o incluso conocido desde
fuera de la LAN), es un factor de configuraci&oacute;n que suele estar
controlado por el nivel superior inmediato de la LAN en la
jerarqu&iacute;a de dominios.
d2946 1
d2951 1
a2951 1
<li>named <em>(``d&aelig;mon de name'')</em>
d2953 1
a2953 1
jerarqu&iacute;a de <em>/var/named/</em>
d2956 1
d2974 2
a2975 2
En la instalaci&oacute;n predeterminada de OpenBSD,
<strong>named</strong> tiene soporte para BIND 4.x.
d2977 1
d2988 1
d2996 6
a3001 6
la instalaci&oacute;n base, <strong><code>named</code></strong>, el cual
ha pasado una <a href="../../es/security.html">auditor&iacute;a de
seguridad</a>.  &Eacute;sta es una consideraci&oacute;n a tener muy en
cuenta, ya que si se pone en peligro un servidor de nombres de dominio,
los resolucionadores que usen ese servidor de DNS pueden ser
redireccionados al sitio de un impostor.
d3003 1
d3010 1
a3010 1
d&aelig;mon de <code>name</code> (<strong>named</strong>).
d3012 1
d3017 6
a3022 7
que controlan el d&aelig;mon de <code>name</code>,
<strong>named</strong>.  La ubicaci&oacute;n predeterminada de estos
ficheros es el directorio <em>/var/named</em> y sus subdirectorios, y en
especial el fichero <em>/var/named/named.boot</em> que es el fichero de
inicializaci&oacute;n para <strong>named</strong>.  Tambi&eacute;n hay
un par pasoso m&aacute;s para la configuraci&oacute;n que deben
realizarse en <em>/etc</em>.
d3026 5
a3030 6
<em>nemo.yewtopia.com</em> como el nombre nombre primario del servidor
para el dominio (&iexcl;muy peque&ntilde;o!) <em>yewtopia.com</em>.  La
direcci&oacute;n de <em>nemo.yewtopia.com</em> es <em>192.168.1.9</em>.
Otras dos m&aacute;quinas en esa subrred son
<em>crater.yewtopia.com</em> en 192.168.1.1 y
<em>earhart.yewtopia.com</em> en 192.168.1.2.
d3032 2
a3033 1
<h4>6.8.5.1 Configuraci&oacute;n en <em>/var/named</em></h4>
d3035 2
a3036 1
<h5>6.8.5.1.1 <em>/var/named/named.boot</em></h5>
d3038 1
a3038 1
<ul>
d3053 1
a3053 1
</ul>
d3060 1
d3063 1
a3063 1
<ul>
d3075 1
a3075 1
</ul>
d3077 1
d3080 1
a3080 1
<ul>
d3097 1
a3097 1
</ul>
d3099 1
d3102 1
a3102 1
<ul>
d3118 1
a3118 1
</ul>
d3120 2
a3121 1
<h4>6.8.5.2 Configuraci&oacute;n en <em>/etc</em></h4>
d3123 2
a3124 1
<h5>6.8.5.2.1 <em>/etc/resolv.conf</em></h5>
d3127 1
a3127 1
Hay que asegurarse de que <em>/etc/resolv.conf</em> apunte al dominio de
d3130 1
a3130 1
sea enviada al <strong>named</strong> que se haya configurado.
d3132 1
a3132 2
<ul>
<pre>
d3135 1
a3135 2
</pre>
</ul>
d3137 2
a3138 1
<h4>6.8.5.2.2 <em>/etc/hosts</em></h4>
d3142 3
a3144 3
m&aacute;quinas al fichero <em>/etc/hosts</em>, puede ser conveniente
acortar el fichero <em>/etc/hosts</em> al estado en que se encontraba
por definic&oacute;n
d3146 1
a3146 2
<ul>
<pre>
d3150 1
a3150 2
</pre>
</ul>
d3153 8
a3160 8
de modo que <strong>named</strong> no sea circunvalado en favor de
direcciones (probablemente caducadas) en el fichero <em>/etc/hosts</em>.
&iexcl;<u>Es necesario asegurarse de que se tiene como m&iacute;nimo la
entrada predefinida de <em>localhost</em></u>, o la red no se
iniciar&aacute; correctamente!  N&oacute;tese tambi&eacute;n que
<em>nemo</em> debe aparecer en el propio fichero hosts, o de lo
contrario se producir&aacute; un mensaje de error (no da&ntilde;ino)
durante el arranque cuando <em>/etc/netstart</em> se invoque
d3162 2
a3163 2
para a&ntilde;adir <em>nemo</em> (cuyo nombre aparece en
<em>/etc/myname</em>).
d3165 1
d3170 1
a3170 1
<ul>
d3172 1
a3172 1
$ <strong>dig @@nemo.yewtopia.com yewtopia.com any any</strong>
d3200 1
a3200 1
</ul>
d3202 1
d3206 1
d3210 2
a3211 2
El d&aelig;mon de name <strong>named</strong> se lanza durante el inicio
del sistema desde
d3216 1
a3216 2
<ul>
<pre>
d3218 1
a3218 2
</pre>
</ul>
d3223 1
a3223 2
<ul>
<pre>
d3225 1
a3225 2
</pre>
</ul>
d3231 1
a3231 2
<ul>
<pre>
d3234 1
a3234 2
</pre>
</ul>
d3241 1
a3241 1
Para iniciar <strong>named</strong> de forma manual, se usa la orden
d3245 2
a3246 3
<ul>
<pre>
# <strong>ndc start</strong>
d3248 2
a3249 3
# <strong>ndc restart</strong>
</pre>
</ul>
d3251 1
d3260 3
a3262 5
<ul>
<pre>
# <strong>ndc stop</strong>
</pre>
</ul>
d3266 1
a3266 1
<strong>named</strong> y usar la orden
d3268 3
a3270 3
para finalizar el proceso.  El PID de <strong>named</strong> mientras
est&eacute; funcionando se encontrar&aacute; en la primera l&iacute;nea
del fichero <em>/var/named/named.pid</em>.
d3272 2
a3273 3
<ul>
<pre>
# <strong>cat /var/named/named.pid</strong>
d3276 2
a3277 3
# <strong>kill -KILL 4608</strong>
</pre>
</ul>
d3279 1
d3288 3
a3290 5
<ul>
<pre>
# <strong>kill -HUP 4608</strong> 
</pre>
</ul>
d3297 3
a3299 5
<ul>
<pre>
# <strong>ndc reload</strong>
</pre>
</ul>
d3301 1
d3307 2
a3308 3
<ul>
<pre>
garden:/home/jeremy$<strong>  host -l openssh.com</strong>
d3317 1
a3317 2
</pre>
</ul>
d3332 1
a3332 2
<ul>
<pre>
d3342 1
a3342 2
</pre>
</ul>
d3344 1
d3350 1
a3350 2
<ul>
<pre>
d3354 1
a3354 2
</pre>
</ul>
d3356 1
d3362 1
a3362 2
<ul>
<pre>
d3367 1
a3367 2
</pre>
</ul>
d3369 1
d3380 1
a3380 1

d3420 1
a3420 1
<ul>Parche para eliminar el soporte para GRE(4).
d3439 1
a3439 1
</ul>
d3451 3
a3453 3
Una vez que ya se haya instalado el paquete <strong>pptp</strong> y el
nuevo n&uacute;cleo, hay que editar unos cuantos ficheros para
configurar la conexi&oacute;n.  Este paquete utiliza el programa de
d3469 2
a3470 3
<ul>
<pre>
# <strong>cat /etc/ppp/options</strong>
d3476 1
a3476 2
</pre>
</ul>
d3482 1
a3482 1
Para el fichero <em>/etc/ppp/pap-secrets</em> se necesitar&aacute; una
d3485 2
a3486 3
<ul>
<pre>
# <strong>cat /etc/ppp/pap-secrets</strong>
d3488 1
a3488 2
</pre>
</ul>
d3497 1
d3516 3
a3518 5
<ul>
<pre>
# <strong>/usr/local/sbin/pptp 10.0.0.138 &amp;</strong>
</pre>
</ul>
d3525 4
a3528 6
<ul>
<pre>
# <strong>kill -9 [pid de pppd]</strong>
$ <strong>kill -9 [pid de pptp]</strong>
</pre>
</ul>
d3530 1
d3534 3
a3536 5
<ul>
<pre>
# <strong>tail -f /var/log/messages</strong>
</pre>
</ul>
d3544 1
d3549 1
d3572 1
d3602 1
a3602 2
<blockquote>
<pre>
d3605 1
a3605 2
</pre>
</blockquote>
d3613 1
a3613 2
<blockquote>
<pre>
d3616 1
a3616 2
</pre>
</blockquote>
d3618 1
d3634 1
a3634 2
<blockquote>
<pre>
d3639 1
a3639 2
</pre>
</blockquote>
d3651 1
d3667 1
a3667 2
<blockquote>
<pre>
d3672 1
a3672 2
</pre>
</blockquote>
d3674 1
d3682 1
a3682 2
<blockquote>
<pre>
d3693 1
a3693 2
</pre>
</blockquote>
d3708 1
d3749 2
a3750 2
Originally [OpenBSD: faq6.html,v 1.148 2002/10/26 14:58:50 dhartmei Exp ]<br>
$Translation: faq6.html,v 1.72 2002/10/29 17:10:31 horacio Exp $<br>
@


1.58
log
@
sync with badlands translazion CVS
@
text
@d25 2
a26 2
<li><a href="#PF">6.2 - Sistema de filtro de paquetes IP (PF)</a>
<li><a href="#NAT">6.3 - Traducci&oacute;n de direcciones de red
d28 2
a29 2
<li><a href="#DHCP">6.4 - Protocolo de configuraci&oacute;n para
anfitriones din&aacute;micos (DHCP)</a>
d31 5
a35 5
<li><a href="#Tuning">6.6 - C&oacute;mo afinar los par&aacute;metros de
red</a>
<li><a href="#NFS">6.7 - C&oacute;mo usar NFS</a>
<li><a href= "#DNS">6.8 - Servicio de Nombres de Dominio  - DNS, BIND, y
named</a>
d38 1
a38 1
<li><a href="#Bridge">6.10 - C&oacute;mo configurar un &laquo;puente de
d51 1
a51 1
ser&aacute; de gran ayuda que haber le&iacute;do antes y, por lo menos
d54 1
a54 1
n&uacute;cleo&raquo;</a> que se encuentra en estos documentos, y las
d68 2
a69 2
este enlace</a>).  &iexcl;&Eacute;ste es un documento excelente que
contiene conocimientos fundamentales sobre redes de IP!
d84 5
a88 5
inter&eacute;s o que se usen en el entorno de red del que se disponga.
Es aconsejable leerlos al tiempo que se intenta averiguar c&oacute;mo
deben funcionar.  Los RFC definen much&iacute;simas (miles) de las
normas para protocolos en Internet y c&oacute;mo se supone que deben
funcionar estos protocolos.
d98 1
a98 1
<h3>6.1.1 - Idenficaci&oacute;n y configuraci&oacute;n de la interfaces
d102 5
a106 5
Para empezar, lo primero que se debe hacer es identificar la interfaz de
red.  En OpenBSD las interfaces se designan por el tipo de tarjeta, no
por el tipo de conexi&oacute;n.  Se puede ver la tarjeta de red mientras
durante el arranque, mientras se inicia el sistema, o despu&eacute;s del
arranque, usando la orden
d110 1
a110 1
Por ejemplo, v&eacute;se a continuaci&oacute;n la salida originada por
d124 1
a124 1
plataforma correspondiente.  En esa p&aacute;gina hay un listado de
d132 2
a133 2
Es posible averiguar qu&eacute; interfaces de red han sido
identificadas, usando la utilidad 
d177 1
a177 1
este momento.  Pero lo importante aqu&iacute; es que nos permite ver
d186 4
a189 4
Finalmente, n&oacute;tese que otras cuantas interfaces se encuentran
activadas de forma predeterminada.  &Eacute;stas son interfaces
virtuales que tienen varias funciones.  Las siguientes p&aacute;ginas
del manual las describen:
d193 1
a193 1
<li><a href="http://www.openbsd.org/cgi-bin/man.cgi?query=pflog&amp;sektion=4&amp;manpath=OpenBSD+3.1">pflog</a> - Interfaz de registros del Filtro de paquetes (<em>PF</em>)
d205 1
a205 1
Si la interfaz no se ha configurada, el primer paso ser&aacute; crear el
d225 2
a226 2
configurada para una direcci&oacute;n de IPv4, ser&iacute;a como el
siguiente:
d251 1
a251 1
O puede que se quiera usar indicadores especiales para especificar una
d261 7
a267 7
El siguiente paso ser&aacute; la configuraci&oacute;n de la pasarela.
Para ello basta con poner la direcci&oacute;n IP de la pasarela en el
fichero <strong>/etc/mygate</strong>.  Esto permitir&aacute; que la
pasarela se active en el momento del arranque.  A continuaci&oacute;n
hay que configurar los nombres de servidores (<em>nameservers</em>) y el
fichero <strong>/etc/hosts</strong> (v&eacute;ase la p&aacute;gina del
manual de
d269 1
a269 1
Para configurar los nombres de servidores antes se debe crear un
d272 1
a272 1
fichero tomando en la p&aacute;gina del manual de
d281 1
a281 1
search sudominio.dom
d290 4
a293 2
de configuraci&oacute;n <strong>/etc/netstart</strong>.  Para ello se
ejecutar&aacute; (como superusuario, <em>root</em>):
d307 5
a311 6
Pero al ejecutar este gui&oacute;n (<em>script</em>), se
reconfingurar&aacute;n cosas que ya se hab&iacute;an configurado
anteriormente.  De hecho, algunas rutas ya existen en la tabla de
enrutamiento del n&uacute;cleo del sistema.  Desde aqu&iacute;, el
sistema deber&iacute;a funcionar con normalidad.  Se puede realizar una
comprobaci&oacute;n con
d362 11
a372 10
usar OpenBSD como un enrutador en Internet, sugerimos que tambi&eacute;n
se lea la secci&oacute;n con las instrucciones sobre la
configuraci&oacute;n de Filtros de paquetes IP (PF), para poder bloquear
tr&aacute;fico potencialmente malicioso.  Adem&aacute;s, debido a la
escasa disponibilidad de direcciones de
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=ip&amp;sektion=4">IPv4</a>
en los proveedores de servicios de redes y registros regionales, es
conveniente leer la secci&oacute;n sobre traducci&oacute;n de
direcciones de red (NAT), que contiene informaci&oacute;n sobre
c&oacute;mo conservar el espacio de direcci&oacute;n IP.
d376 2
a377 2
reenv&iacute;o de IP (<em>IP Forwarding</em>, pero debe ser activado.
Para ello hay que usar la utilidad
d413 2
a414 3
colecci&oacute;n de portes.  OpenBSD incluye soporte para varias
interfaces T1, HSSI, ATM, FDDI, Ethernet, e interfaces de serie
(PPP/SLIP).
d419 1
a419 1
<h3>6.1.3 - Configuraci&oacute;n de alias en una interfaz.</h3>
d423 2
a424 2
los alias de IP en una interfaz.  Para configurarlos s&oacute;lo tiene
que editar el fichero
d441 1
a441 1
la interfaz; no existen diferencias entre el primer alias y el segundo;
d443 3
a445 3
hay que referirse a ellos como dc0:0 y dc0:1.  Si hace referencia a una
direcci&oacute; de IP alias espec&iacute;fica con ifconfig, o si
est&aacute; a&ntilde;adiendo un alias, hay que asegurarse de escribir
d455 1
a455 1
<em>netmask</em> del primer IP ligado a la interfaz.  En el siguiente
d500 1
a500 1
<h2>6.2 - Sistema de filtro de paquetes IP (PF)</h2>
d503 2
a504 2
<h5>Nota: <em>Packet Filter</em> (el subsistema de filtros de paquetes
IP de OpenBSD) es el sistema de filtrado para OpenBSD 3.0 y versiones
d597 1
a597 1
<h3>Filtro de paquetes IP (PF)</h3>
d1122 1
a1122 1
<strong>IP Options</strong>
d1139 1
a1139 1
<strong>Indicadores TCP, conexiones establecidas, y mantenimiento del
d1457 2
a1458 1
<h2>6.3 - NAT</h2>
d1564 1
a1564 1
<h3><u>6.3.2 Traducci&oacute;n de direcciones de red</u></h3>
d1662 1
a1662 1
<br>
d1692 1
a1692 1
<br>
d1760 1
d1848 1
d1938 1
a1938 1
<br>
d2180 3
a2182 3
(<em>socket</em>) vinculado a la direcci&oacute;n de <em>loopback</em> y
al puerto 5000.  Las conexiones se reenv&iacute;an al puerto 80 del
servidor 192.168.1.10.
d2573 1
a2573 1
<h2>6.6 - C&oacute;mo ajustar par&aacute;metros de red</h2>
d2577 1
a2577 1
espera mayores en las sesiones TCP?</h3>
d2817 1
a2817 1
<h3>C&oacute;mo montar sistemas de archivo NFS</h3>
d2820 2
a2821 2
Los sistemas de archivo NFS se deben montar mediante mount(8), o
m&aacute;s exactamente mediante
d3795 4
a3798 4
pass in  on ep0  any
pass out on ep0  any
pass in  on fxp0 any
pass out on fxp0 any
d3877 2
a3878 2
Originally [OpenBSD: faq6.html,v 1.147 2002/10/25 14:18:48 dhartmei Exp ]<br>
$Translation: faq6.html,v 1.70 2002/10/25 19:27:43 horacio Exp $<br>
@


1.57
log
@
sync with badlands translation CVS
@
text
@d5 1
d51 2
a52 2
ser&aacute; de gran ayuda que se haya le&iacute;do y, por lo menos,
asimilado en parte el cap&iacute;tulo sobre la
d54 4
a57 3
n&uacute;cleo&raquo;</a> de estos documentos, y las p&aacute;ginas del
manual de
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=ifconfig&amp;sektion=8">ifconfig(8)</a> y de
d61 4
a64 4
Si se es un administrador de redes y se est&aacute; configurando
protocolos de enrutamiento, si se est&aacute; usando el sistema OpenBSD
como un enrutador, si se necesita conocer m&aacute;s a fondo los
protocolos de redes IP, entonces es realmente necesario leer
d67 3
a69 3
<a href="http://www.3com.com/other/pdfs/infra/corpinfo/en_US/501302.pdf">este enlace</a>).
&iexcl;&Eacute;ste es un documento excelente que contiene conocimientos
fundamentales sobre redes de IP!
d82 1
a82 1
Lo m&aacute;s seguro es que no se puedan leer todos, y por ello lo
d104 3
a106 3
por el tipo de conexi&oacute;n.  Puede verse la tarjeta de red mientras
se inicia durante el arranque, o despu&eacute;s del arranque, usando la
orden
d122 1
a122 1
Si no se conoce es el nombre del dispositivo, se puede buscar en la
d2080 142
d3873 2
a3874 2
Originally [OpenBSD: faq6.html,v 1.146 2002/10/04 14:15:26 nick Exp ]<br>
$Translation: faq6.html,v 1.68 2002/10/05 14:50:20 horacio Exp $<br>
@


1.56
log
@
sync with badlands translation CVS
@
text
@d14 1
a18 1
</p>
a39 1
</p>
a46 1
</p>
d55 2
a56 2
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=ifconfig&sektion=8">ifconfig(8)</a> y de
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=netstat&apropos=0&sektion=1&format=html">netstat(1)</a>.
a91 1
</p>
a97 1
</p>
d105 1
a105 1
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=dmesg&sektion=8">dmesg(8)</a>.
d107 1
a107 1
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=ifconfig&sektion=8">ifconfig(8)</a>.
a110 1
</p>
a127 1
</p>
d132 1
a132 1
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=ifconfig&sektion=8">ifconfig(8)</a>.
d136 1
a136 2
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=fxp&sektion=4">fxp(4)</a>.
</p>
d173 1
a173 1
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=ifconfig&sektion=8">ifconfig(8)</a>
a181 1
</p>
a187 1
</p>
d191 1
a191 1
<li><a href="http://www.openbsd.org/cgi-bin/man.cgi?query=pflog&sektion=4&manpath=OpenBSD+3.1">pflog</a> - Interfaz de registros del Filtro de paquetes (<em>PF</em>)
a208 1
</p>
a219 1
</p>
a224 1
</p>
a236 1
</p>
a246 1
</p>
a251 1
</p>
d266 1
a266 1
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=hosts&sektion=5">hosts(5)</a>).
d271 1
a271 1
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=resolv.conf&sektion=5">resolv.conf(5)</a>.
a274 1
</p>
a289 1
</p>
d309 1
a309 1
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=ifconfig&sektion=8">ifconfig(8)</a>
d312 1
a312 1
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=netstat&sektion=1">netstat(1)</a> o <a href="http://www.openbsd.org/cgi-bin/man.cgi?query=route&sektion=8">route(8)</a>.
a314 1
</p>
a353 1
</p>
d364 1
a364 1
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=ip&sektion=4">IPv4</a>
a368 1
</p>
d374 1
a374 1
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=sysctl&sektion=8">sysctl(8)</a>.
d376 1
a376 1
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=sysctl.conf&sektion=5">/etc/sysctl.conf(5)</a>
a379 1
</p>
d390 1
a390 1
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=sysctl&sektion=8">sysctl(8)</a>.
a393 1
</p>
d406 1
a406 1
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=routed&sektion=8">routed(8)</a>,
a411 1
</p>
a416 1
</p>
d422 1
a422 1
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=hostname.if&sektion=5"><em>/etc/hostname.&lt;if&gt;</em></a>.
d424 1
a424 1
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=rc&sektion=8">/etc/rc(8)</a>,
a429 1
</p>
a445 1
</p>
a455 1
</p>
d470 1
a470 1
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=ifconfig&sektion=8">ifconfig(8)</a>.
a471 1
</p>
a480 1
</p>
a497 1
</p>
a504 1
</p>
d512 2
a513 3
<em><a href="http://www.openbsd.org/cgi-bin/man.cgi?query=pf.conf&sektion=5&manpath=OpenBSD+3.1">/etc/pf.conf(5)</a></em> and
<em><a href="http://www.openbsd.org/cgi-bin/man.cgi?query=nat.conf&sektion=5&manpath=OpenBSD+3.1">/etc/nat.conf(5)</a></em>.
</p>
d518 1
a518 1
<em><a href="http://www.openbsd.org/cgi-bin/man.cgi?query=rc.conf&sektion=8">/etc/rc.conf(8)</a></em>
a519 1
</p>
d530 1
a530 1
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=sysctl&sektion=8">sysctl(8)</a>,
d533 1
a533 1
<em><a href="http://www.openbsd.org/cgi-bin/man.cgi?query=sysctl.conf&sektion=5">/etc/sysctl.conf(5)</a></em>
a534 1
</p>
d539 1
a539 1
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=rc.conf&sektion=8">/etc/rc.conf(8)</a>,
d541 1
a541 2
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=pfctl&sektion=8&manpath=OpenBSD+3.1">pfctl(8)</a>:
</p>
a557 1
</p>
d559 1
a572 1
</p>
d583 2
a584 2
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=pf.conf&sektion=5&manpath=OpenBSD+3.1">pf.conf(5)</a>
y <a href="http://www.openbsd.org/cgi-bin/man.cgi?query=nat.conf&sektion=5&manpath=OpenBSD+3.1">nat.conf(5)</a>.
a591 1
</p>
a594 1
</p>
d603 1
a603 1
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=pf.conf&sektion=5&manpath=OpenBSD+3.1">pf.conf(5)</a>. 
a608 1
</p>
a613 1
</p>
d625 2
a626 1
 
d636 1
a641 1
</p>
d649 1
a649 1
<em><a href="http://www.openbsd.org/cgi-bin/man.cgi?query=protocols&sektion=5">/etc/protocols(5)</a></em>,
d652 3
a654 4
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=tcp&sektion=4">tcp(4)</a>,
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=udp&sektion=4">udp(4)</a> e
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=icmp&sektion=4">icmp(4)</a>.
</p>
a661 1

d670 1
d677 1
a677 1
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=services&sektion=5">/etc/services(5)</a>,
d693 1
a698 1
</p>
a720 1
</p>
d722 1
a732 1
</p>
a740 1
</p>
a761 1
</p>
d773 1
d784 1
a791 1
</p>
d793 1
d812 1
a841 1
</p>
d843 1
d861 1
a865 1
</p>
d870 1
a870 1
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=pflogd&sektion=8&manpath=OpenBSD+3.1">pflogd(8)</a>,
d873 1
a873 1
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=tcpdump&sektion=8&manpath=OpenBSD+3.1">tcpdump(8)</a>.
d875 1
a875 1
<em><a href="http://www.openbsd.org/cgi-bin/man.cgi?query=rc.conf&sektion=8">/etc/rc.conf(8)</a></em>,
d877 1
a877 1
<em><a href="http://www.openbsd.org/cgi-bin/man.cgi?query=rc&sektion=8">/etc/rc(8)</a></em>.
a884 1
</p>
d898 1
d908 1
a910 1
</p>
a920 1
</p>
d928 134
a1061 3
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=telnet&sektion=1">telnet(1)</a> o
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=ftp&sektion=1">ftp(1)</a>).
</p>
a1064 1
</p>
d1079 1
a1089 1
</p>
a1093 1
</p>
d1112 1
a1116 1
</p>
a1119 1
</p>
a1133 1
</p>
a1137 1
</p>
d1156 1
a1158 1
</p>
a1167 1
</p>
d1178 1
a1178 1
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=ssh&sektion=1">ssh(1)</a>
d1181 1
a1181 1
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=lynx&sektion=1">lynx(1)</a>
a1192 1
</p>
a1234 1
</p>
a1281 1
</p>
a1287 1
</p>
a1290 1
</p>
d1305 1
a1306 1
</p>
a1324 1
</p>
a1327 1
</p>
a1343 1
</p>
a1347 1
</p>
a1387 1
</p>
d1400 2
a1401 1
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=pflogd&sektion=8&manpath=OpenBSD+3.1">pflogd(8)</a>
d1406 1
a1406 1
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=tcpdump&sektion=8&manpath=OpenBSD+3.1">tcpdump(8)</a>,
a1407 1
</p>
a1412 1
</p>
a1415 1
</p>
a1422 1
</p>
d1430 1
a1430 1
asegur&aacute;ndose de que la sem&aacute;ntica no haya cambiado.</li>
d1435 1
a1435 1
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=syslogd&sektion=8">syslogd(8)</a>,
d1439 2
a1440 2
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=tcpdump&sektion=8&manpath=OpenBSD+3.1">tcpdump(8)</a>
disponibles para este efecto.</li>
d1443 1
a1443 1
<a href="#normalization">scrub</a>.</li>
d1448 1
a1448 1
orden <kbd>pfctl -sr</kbd>.</li>
a1454 1
</p>
a1460 1
</p>
a1478 1
</p>
a1483 1
</p>
a1488 1
</p>
a1499 1
</p>
a1575 1
</p>
a1587 1
</p>
a1608 1
</p>
a1611 1
</p>
a1640 1
</p>
a1651 1
</p>
a1656 1
</p>
a1667 1
</p>
a1671 1
</p>
a1678 1
</p>
a1686 1
</p>
d1694 1
a1694 1
(<em><a href="http://www.openbsd.org/cgi-bin/man.cgi?query=pf.conf&sektion=5&manpath=OpenBSD+3.1">/etc/pf.conf</a></em>).
a1697 1
</p>
a1709 1
</p>
d1713 1
a1713 1
(<em><a href="http://www.openbsd.org/cgi-bin/man.cgi?query=nat.conf&sektion=5&manpath=OpenBSD+3.1">/etc/nat.conf</a></em>)
a1716 1
</p>
a1725 1
</p>
a1730 1
</p>
a1736 1
</p>
a1745 1
</p>
a1752 1
</p>
a1762 1
</p>
a1766 1
</p>
a1779 1
</p>
a1785 1
</p>
a1799 1
</p>
a1812 1
</p>
a1820 1
</p>
a1827 1
</p>
a1833 1
</p>
a1840 1
</p>
a1850 1
</p>
a1863 1
</p>
d1867 1
a1867 1
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=ftp&sektion=1">ftp(1)</a>
a1882 1
</p>
d1890 1
a1890 1
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=ftp-proxy&sektion=8&manpath=OpenBSD+3.1">ftp-proxy(8)</a>.
d1896 1
a1896 1
rdr on tl0 from any to any port 21 -&gt; 127.0.0.1 port 8081
d1903 1
a1903 2
la escucha por el puerto 8081&raquo;.
</p>
d1912 1
a1912 1
127.0.0.1:8081 stream tcp nowait root /usr/libexec/ftp-proxy ftp-proxy
d1917 1
a1917 1
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=inetd&sektion=8">inetd(8)</a>.
d1927 2
a1928 2
8081, el mismo puerto al que rdr estaba enviando el tr&aacute;fico de
FTP.  Hemos escogido el puerto 8081 de forma arbitraria, aunque 8081 es
a1930 1
</p>
a1949 1
</p>
a1956 1
</p>
a1966 1
</p>
a1973 1
</p>
a1980 1
</p>
a1988 1
</p>
a2000 1
</p>
a2015 1
</p>
a2020 1
</p>
a2023 1
</p>
d2039 1
a2039 1
rdr on tl0 from any to ! 64.12.163.199 port 21 -&gt; 127.0.0.1 port 8081
d2045 1
a2045 1
los usuarios del servidor de AIM ten&iacute;an problemas) al puerto 8081
a2051 1
</p>
a2055 1
</p>
a2075 1
</p>
a2079 1
</p>
a2090 1
</p>
d2095 2
a2096 2
<li><a href="http://www.openbsd.org/cgi-bin/man.cgi?query=nat.conf&sektion=5&manpath=OpenBSD+3.1">p&aacute;gina del manual de nat.conf</a>
<li><a href="http://www.openbsd.org/cgi-bin/man.cgi?query=pfctl&sektion=8&manpath=OpenBSD+3.1">p&aacute;gina del manual de pfctl</a>
a2098 1
</p>
a2105 1
</p>
d2111 1
a2111 1
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=dhclient&sektion=8">dhclient(8)</a>,
d2158 1
a2158 1
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=dhcpd&sektion=8">dhcpd(8)</a>,
d2219 1
a2219 1
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=dhcp-options&sektion=5">dhcp-options(5)</a>.
a2224 1
</p>
d2226 1
d2232 2
a2233 2
<li><a href="http://www.openbsd.org/cgi-bin/man.cgi?query=pppd&sektion=8">pppd(8)</a> - Es el d&aelig;mon ppp del n&uacute;cleo (<em>kernel</em>) del sistema.</li>
<li><a href="http://www.openbsd.org/cgi-bin/man.cgi?query=ppp&sektion=8">ppp(8)</a> - Es el d&aelig;mon ppp del modo de usuario.</li>
a2240 1
</p>
a2258 1
</p>
a2263 1
</p>
a2285 1
</p>
d2304 1
a2304 1
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=ppp&sektion=8">ppp(8)</a>.
a2313 1
</p>
a2353 1
</p>
a2373 1
</p>
a2382 1
</p>
a2390 1
</p>
a2403 1
</p>
a2411 1
</p>
a2420 1
</p>
a2425 1
</p>
d2470 1
a2470 1
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=sysctl&sektion=8">sysctl(8)</a>:
a2491 1
</p>
a2497 1
</p>
d2500 3
a2502 3
<li><a href="http://www.openbsd.org/cgi-bin/man.cgi?query=nfsd&sektion=8">nfsd(8)</a>
<li><a href="http://www.openbsd.org/cgi-bin/man.cgi?query=mountd&sektion=8">mountd(8)</a>
<li><a href="http://www.openbsd.org/cgi-bin/man.cgi?query=exports&sektion=5">exports(5)</a>
a2521 1
</p>
a2529 1
</p>
d2540 1
a2540 1
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=exports&sektion=5">exports(5)</a>.
a2542 1
</p>
a2565 1
</p>
d2652 1
a2652 1
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=showmount&sektion=8">showmount(8)</a>
d2674 1
a2674 1
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=mount_nfs&sektion=8">mount_nfs(8)</a>.
a2723 1
</p>
d2744 1
a2744 1
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=nslookup&sektion=8">nslookup(8)</a>
a2745 1
</p>
d2764 1
a2764 1
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=resolv.conf&sektion=5">/etc/resolv.conf</a>.
a2768 1
</p>
a2807 1
</p>
d2816 1
a2816 1
nombres de dominio en Internet.</li>
d2818 1
a2818 1
<em><a href="../../es/books.html#6">DNS and BIND</a></em>.</li>
d2821 1
a2821 1
manual de OpenBSD</a>, en especial las p&aacute;ginas de</li>
d2823 6
a2828 6
   <li><a href="http://www.openbsd.org/cgi-bin/man.cgi?query=dig&sektion=1&format=html">dig(1)</a>
   <li><a href="http://www.openbsd.org/cgi-bin/man.cgi?query=nslookup&sektion=8&format=html">nslookup(8)</a>
   <li><a href="http://www.openbsd.org/cgi-bin/man.cgi?query=gethostbyname&sektion=3&format=html">gethostbyname(3)</a>
   <li><a href="http://www.openbsd.org/cgi-bin/man.cgi?query=named&sektion=8&format=html">named(8)</a>
   <li><a href="http://www.openbsd.org/cgi-bin/man.cgi?query=resolver&sektion=3&format=html">resolver(3)</a>
   <li><a href="http://www.openbsd.org/cgi-bin/man.cgi?query=resolver&sektion=5&format=html">resolver(5)</a>
d2834 1
a2834 1
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=dig&sektion=1">dig(1)</a>
d2838 1
a2838 1
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=dig&sektion=1">dig(1)</a>
a2841 1
</p>
d2854 1
a2854 1
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=hosts&sektion=5">/etc/hosts</a>
d2856 1
a2856 1
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=resolv.conf&sektion=5">/etc/resolv.conf</a>
a2858 1
</p>
d2869 1
a2869 1
m&aacute;quinas de la LAN.</li>
d2879 1
a2879 1
jerarqu&iacute;a de dominios.</li>
d2884 1
a2884 1
m&aacute;quinas en otra LAN o WAN.</li>
d2892 1
a2892 1
<em>gethostbyname(3)</em> para la b&uacute;squeda de direcciones).</li>
a2906 1
</p>
d2912 1
a2912 1
<li>named <em>(``d&aelig;mon de name'')</em></li>
d2914 1
a2914 1
jerarqu&iacute;a de <em>/var/named/</em></li>
a2922 1
</p>
d2928 3
a2930 3
<li>BIND 4</li>
<li>BIND 8</li>
<li>BIND 9</li>
d2944 1
a2944 1
<a href="../../es/ports.html">portes</a>).</li>
a2959 1
</p>
a2967 1
</p>
a2979 1
</p>
a2988 1
</p>
a3081 1
</p>
a3096 1
</p>
d3115 1
a3115 1
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=route&sektion=8">route(8)</a>
a3117 1
</p>
d3120 1
a3120 1
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=dig&sektion=1">dig(1)</a>
d3163 1
a3163 1
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=rc&sektion=8">/etc/rc</a>
d3165 1
a3165 2
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=rc.conf&sektion=8">/etc/rc.conf</a>,
</p>
a3174 1
</p>
a3184 1
</p>
a3195 1
</p>
d3199 1
a3199 1
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=ndc&sektion=8">ndc(8)</a>
a3200 1
</p>
d3215 1
a3215 1
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=ndc&sektion=8">ndc(8)</a>.
a3216 1
</p>
d3227 1
a3227 1
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=kill&sektion=1">kill(1)</a>
a3230 1
</p>
a3247 1
</p>
d3257 1
a3257 1
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=ndc&sektion=8">ndc(8)</a>.
a3258 1
</p>
a3347 1
</p>
a3359 1
</p>
a3365 1
</p>
a3373 1
</p>
a3381 1
</p>
d3385 1
a3385 1
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=gre&sektion=4">gre(4)</a>
a3387 1
</p>
a3417 1
</p>
d3423 1
a3423 1
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=ppp&sektion=8">ppp(8)</a>
a3427 1
</p>
a3436 1
</p>
a3450 1
</p>
a3468 1
</p>
a3482 1
</p>
a3497 1
</p>
a3513 1
</p>
a3518 1
</p>
d3525 1
a3525 1
Un puente o <a href="http://www.openbsd.org/cgi-bin/man.cgi?query=bridge&sektion=4">bridge</a>
d3560 1
a3560 1
(<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=fxp&sektion=4"><tt>fxp0</tt></a>)
d3562 1
a3562 1
(<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=ep&sektion=4"><tt>ep0</tt></a>)
d3598 1
a3598 1
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=ifconfig&sektion=8">ifconfig(8)</a>,
d3603 1
a3603 1
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=ep&sektion=4">ep(4)</a>.
d3608 1
a3608 1
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=bridgename.if&sektion=5"><tt>nombre_puente.bridge0</tt></a>.
d3654 2
a3655 2
Supongamos ahora que quiero filtrar el tr&aacute;fico que llegue a
estas viejas m&aacute;quinas, y que s&oacute;lo quiero que pase el
d3685 1
a3685 1
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=brconfig&sektion=8">brconfig(8)</a>,
d3697 1
a3697 1
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=brconfig&sektion=8">brconfig(8)</a>
d3699 1
a3699 1
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=bridgename.if&sektion=5">bridgename.bridge0</a>,
d3708 3
a3710 3
de la esperada.  Algunos NIC no funcionan correctamente en este modo;
el <em>chip</em> TI ThunderLAN
(<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=tl&sektion=4">tl(4)</a>)
a3721 1
</p>
d3729 2
a3730 2
Originally [OpenBSD: faq6.html,v 1.144 2002/07/25 22:06:57 nick Exp ]<br>
$Translation: faq6.html,v 1.67 2002/07/26 22:53:22 horacio Exp $<br>
a3732 1
</p>
@


1.55
log
@
sync with badlands translation CVS
@
text
@d37 2
d1008 9
a1016 5
Como hay algunos sistemas operativos y aplicaciones que tienen problemas
con paquetes fragmentados o an&oacute;malos, a veces es beneficioso
normalizar los paquetes antes de que pasen a su destino final.  Esto se
hace mediante la directiva <strong>scrub</strong>, que se usa como
sigue:
d1024 4
a1027 3
Pero como esta orden a&ntilde;ade una carga adicional en el sistema, no
es recomendable usarla a menos que este sistema se encuentre protegiendo
a un dispositivo que tenga una pobre implementaci&oacute;n de TCP/IP.
d3565 65
d3631 129
d3774 2
a3775 2
Originally [OpenBSD: faq6.html,v 1.141 2002/07/12 02:51:35 nick Exp ]<br>
$Translation: faq6.html,v 1.66 2002/07/14 07:03:31 horacio Exp $<br>
@


1.54
log
@
sync with badlands translation CVS
@
text
@d2382 1
a2382 1
   conecta con el isp, y a continuaci&oacute;n pasa a un plano de fondo.
d3573 2
a3574 2
Originally [OpenBSD: faq6.html,v 1.140 2002/07/02 01:17:58 nick Exp ]<br>
$Translation: faq6.html,v 1.65 2002/07/05 09:37:44 horacio Exp $<br>
@


1.53
log
@
sync with badslands translation CVS
@
text
@d2471 1
a2471 1
   sysctl -w net.inet.tcp.baddynamic=749,750,751,760,761,871
d2476 2
a2477 2
   sysctl -w net.inet.tcp.baddynamic=+748
   sysctl -w net.inet.tcp.baddynamic=-871
d3537 1
a3537 1
% <strong>kill -9 [pid de pptp]</strong>
d3573 2
a3574 2
Originally [OpenBSD: faq6.html,v 1.138 2002/06/24 12:09:54 espie Exp ]<br>
$Translation: faq6.html,v 1.64 2002/06/29 15:17:02 horacio Exp $<br>
@


1.52
log
@
sync with badlands translation CVS
@
text
@d847 1
a847 1
block out quick on fxp0 inet from any to { 127.0.0.0/8, 192.168.0.0/16, \ 
d1037 1
a1037 1
pass in quick on fxp0 allow-opts
d1315 1
a1315 1
pass in log quick on fxp0 from 1.1.1.0/24 to any port 22
d3573 2
a3574 2
Originally [OpenBSD: faq6.html,v 1.135 2002/06/14 23:51:16 nick Exp ]<br>
$Translation: faq6.html,v 1.63 2002/06/17 21:32:39 horacio Exp $<br>
@


1.51
log
@
sync with badlands translation CVS
@
text
@d198 1
a198 1
<li><a href="http://www.openbsd.org/cgi-bin/man.cgi?query=pflog&amp;sektion=4">pflog</a> - Interfaz de registro del paquete de filtros (<em>PF</em>)
d541 2
a542 2
<em><a href="http://www.openbsd.org/cgi-bin/man.cgi?query=pf.conf&amp;sektion=5">/etc/pf.conf(5)</a></em> y
<em><a href="http://www.openbsd.org/cgi-bin/man.cgi?query=nat.conf&amp;sektion=5">/etc/nat.conf(5)</a></em>.
d573 1
a573 1
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=pfctl&sektion=8">pfctl(8)</a>:
d617 2
a618 2
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=pf.conf&sektion=5">pf.conf(5)</a> y
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=nat.conf&sektion=5">nat.conf(5)</a>.
d639 1
a639 1
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=pf.conf&sektion=5">pf.conf(5)</a>. 
d908 1
a908 1
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=pflogd&sektion=8">pflogd(8)</a>,
d911 1
a911 1
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=tcpdump&sektion=8">tcpdump(8)</a>.
d1319 3
a1321 2
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=pflogd&sektion=8">pflogd(8)</a>
escribir&aacute; las entradas del registro ip a <em>/var/log/pflog</em>.
d1324 1
a1324 1
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=tcpdump&sektion=8">tcpdump(8)</a>,
d1361 1
a1361 1
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=tcpdump&sektion=8">tcpdump(8)</a>
d1633 1
a1633 1
(<em><a href="http://www.openbsd.org/cgi-bin/man.cgi?query=pf.conf&sektion=5">/etc/pf.conf</a></em>).
d1654 1
a1654 1
(<em><a href="http://www.openbsd.org/cgi-bin/man.cgi?query=nat.conf&sektion=5">/etc/nat.conf</a></em>)
d1850 1
a1850 1
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=ftp-proxy&sektion=8">ftp-proxy(8)</a>.
d2072 2
a2073 2
<li><a href="http://www.openbsd.org/cgi-bin/man.cgi?query=nat.conf&sektion=5">p&aacute;gina del manual de nat.conf</a>
<li><a href="http://www.openbsd.org/cgi-bin/man.cgi?query=pfctl&sektion=8">p&aacute;gina del manual de pfctl</a>
d3573 2
a3574 2
Originally [OpenBSD: faq6.html,v 1.134 2002/05/30 17:22:05 nick Exp ]<br>
$Translation: faq6.html,v 1.62 2002/06/06 18:42:56 horacio Exp $<br>
@


1.50
log
@
sync with badlands CVS
@
text
@d50 2
a51 2
ser&aacute; de gran ayuda que se haya leido y, por lo menos, asimilado
en parte el cap&iacute;tulo
d53 2
a54 2
N&uacute;cleo&raquo;</a> 
de las preguntas frecuentes, y las p&aacute;ginas del manual de
d588 2
a589 2
sobre la traducci&oacute;n de direcciones IP en
<a href="#NAT">secci&oacute;n 6.3 (NAT)</a>) y, finalmente, la
d739 3
a741 3
Y por supuesto que existen excepciones para toda regla.  La
opci&oacute;n <em>quick</em> filtra el paquete en la primera regla que
concuerde.  Veamos de nuevo el defectuoso ejemplo anterior,
d754 5
a758 6
Un paquete destinado para el puerto tcp 3306 ser&aacute;
filtrado por la regla &quot;block in quick&quot; y bloqueado
inmediatamente.  Todos los paquetes destinados a otros puertos
no encontrar&aacute;n una concordancia en las reglas hasta
llegar a la regla &quot;pass in&quot; que permite que pasen
todos los paquetes.
d764 7
a770 7
La pol&iacute;tica de filtrado de p&aacute;quetes m&aacute;s
segura es la de &laquo;denegaci&oacute;n por
definici&oacute;n&raquo;.  Esta pol&iacute;tica es mucho
m&aacute;s segura que la denegaci&oacute;n expl&iacute;cita de
cada servicio protegido, permite grupos de reglas m&aacute;s
breves, y puede proteger de un servicio que haya sido mal
configurado de modo accidental y que haya quedado expuesto.
d774 6
a779 7
Veamos ahora otro ejemplo de grupo de reglas real, seguido de
una explicaci&oacute;n l&iacute;nea por l&iacute;nea.  El
siguiente ejemplo es para un servidor de web con una
pol&iacute;tica de denegaci&oacute;n predefinida que
s&oacute;lo permite conexiones ssh (para
administraci&oacute;n), y conexiones http (puerto 80) y https
(puerto 443).
d793 9
a801 8
Esto permitir&aacute; las conexiones desde cualquier sitio a
los puertos tcp 22 (ssh), 80 (http) y 443 (https).  Cualquier
otro intento de conexi&oacute;n distinto ser&aacute;
bloqueado, y permitir&aacute; todas las conexiones salientes.
Este grupo de reglas es muy estricto.  Pero, &iquest;y si Vd.
s&oacute;lo quisiera permitir la conexi&oacute;n a ssh a
anfitriones internos en su bloque de direcciones 1.1.1.0, y al
mismo tiempo permitir conexiones externas a http y https?
d814 3
a816 4
De acuerdo, pero, &iquest;y si s&oacute;lo quisiera permitir
la administraci&oacute;n remota de su servidor de web a una
sola m&aacute;quina (1.1.1.1)?  En tal caso cambiar&iacute;a
esta regla:
d836 7
a842 8
He aqu&iacute; algunas ejemplos de reglas que pueden ser de
utilidad para todos (en las que se asume que <em>fxp0</em> es
la interfaz externa conectada a Internet).  Primero
configuraremos un filtro simple para la protecci&oacute;n de
falsificaci&oacute;n de direcciones IP (<em>ip address
spoofing</em>).  Estas direcciones, por lo general, no
deber&iacute;an vagar por Internet, y si lo hacen, lo que es
bastante raro, las bloqueamos:
d851 2
a852 2
Nuestro grupo de reglas est&aacute; mejorando;  cuando lo
ponemos todo junto obtenemos esto:
d885 5
a889 5
De momento va bastante bien, pero podr&iacute;a ir mejor.
&iquest;Qué har&iacute;amos si quisi&eacute;ramos obtener un
registro de cualquier intento de conexi&oacute;n al puerto 22
(ssh) que fuera por nuestro cortafuegos?  Ser&iacute;a fácil,
PF puede gestionar este caso con la opci&oacute;n clave
d899 4
a902 4
Esta regla permitir&aacute; la conexi&oacute;n remota por el
puerto 22 a nuestra m&aacute;quina de administraci&oacute;n,
pero denegar&aacute; y registrar&aacute; cualquier otro
intento de conexi&oacute;n al puerto 22.
d906 2
a907 2
Los paquetes registrados se env&iacute;an a la interfaz
pflog0, que es monitorizada por
d909 1
a909 1
que suele volcar los paquetes a <em>/var/log/pflog</em> en
d916 1
a916 2
Puede leer estos ficheros de registro usando la siguiente
orden:
d926 4
a929 5
Hay que tener en cuenta que la utilizaci&oacute;n de tcpdump
para monitorizar el fichero <em>pflog</em> NO ofrece
informaci&oacute;n a tiempo real.  Si quiere ver la
informaci&oacute;n a tiempo real, puede usar la siguiente
orden:
d937 2
a938 2
Tambi&eacute;n es posible usar tcpdump para estrechar el
objetivo y facilitar as&iacute; el depurado:
d951 8
a958 9
Cuando se examinan los registros propios, es aconsejable tener
mucho cuidado con la descodificaci&oacute;n del protocolo (la
verbosidad en los mensajes se activa a&ntilde;adiendo la
opci&oacute;n <em>-v</em> a la orden).  Los descodificadores
de protocolo de tcpdump no tienen un historial impecable.  En
teor&iacute;a ser&iacute;a posible un ataque retrasado a
trav&eacute;s de paquetes parciales de carga &uacute;til
(<em>partial packet payload</em>) registrados por el
dispositivo de ingreso.
d962 5
a966 5
Es preciso tener un cuidado especial con el acceso a los
registros.  pflogd captura 96 bytes del paquete y los
registrar&aacute;.  El acceso a los registros podr&iacute;a
proveer acceso parcial a paquetes de carga &uacute;til de
car&aacute;cter reservado (como registros de ingreso de 
d976 4
a979 5
&iquest;Qu&eacute; ocurrir&iacute;a si necesit&aacute;ramos
permitir las conexiones a un servicio que funcionara sobre
m&uacute;ltiples protocolos (como bind, que usa TCP y UDP)?
PF le permite agrupar opciones (m&aacute;s adelante volveremos
a este tema):
d988 3
a990 3
N&oacute;ntese los espacios a ambos lados de los caracteres
'{ }'.  Esta forma es m&aacute;s elegante que la alternativa
que tendr&iacute;a que usar:
d1006 5
a1010 5
Como hay algunos sistemas operativos y aplicaciones que tienen
problemas con paquetes fragmentados o an&oacute;malos, a veces
es beneficioso normalizar los paquetes antes de que pasen a su
destino final.  Esto se hace mediante la directiva
<strong>scrub</strong>, que se usa como sigue:
d1018 3
a1020 4
Pero como esto a&ntilde;ade una carga adicional en el sistema,
no es recomendable usar esta orden a menos que este sistema se
encuentre protegiendo a un dispositivo con una pobre
implementaci&oacute;n de TCP/IP.
d1028 5
a1032 6
En su comportamiento predeterminado, PF bloquea los paquetes
que tienen las opciones de IP activadas.  Esto puede
dificultar a&uacute;n m&aacute;s la tarea a las utilidades de
detecci&oacute;n de sistemas como nmap.  Si tiene una
aplicaci&oacute;n que requiera el paso de estos paquetes, como
puede ser IGMP, puede usar la directiva
d1043 2
a1044 2
<strong>Indicadores TCP, conexiones establecidas, y
mantenimiento del estado</strong>
d1048 9
a1056 11
PF tambi&eacute;n puede filtrar los paquetes bas&aacute;ndose
en los indicadores de TCP, y mantener las conexiones
establecidas y el estado de la conexi&oacute;n.  Se recomienda
que todos los usuarios que deseen filtrar paquetes
bas&aacute;ndose en los indicadores TCP entiendan antes el
papel que desempe&ntilde;a cada indicador.  Por ejemplo, si un
usuario quisiera denegar la conexi&oacute;n a todos los
paquetes con los indicadores FIN, URG, y PSH activados (como
por ejemplo en un intento de obtener identificar a un sistema
operativo mediante nmap), podr&iacute;a usar una regla como la
siguiente:
d1069 7
a1075 9
El pr&oacute;ximo truco de PF es su capacidad para
&laquo;mantener el estado&raquo; (<em>&quot;keep
state&quot;</em>).  &laquo;Mantener el estado&raquo; ha sido
definido como &laquo;no hablar hasta que no le hablen&raquo;
o, en otras palabras, una vez que se ha establecido una
conexi&oacute;n, los paquetes ya no tienen que atravesar
grupos de reglas.  &Eacute;sta es una potente funcionalidad
que permite escribir unas reglas mucho m&aacute;s sencillas y
seguras.
d1079 8
a1086 9
Por ejemplo, veamos c&oacute;mo se puede aplicar este estado
al ejemplo del grupo de reglas anterior.
&iquest;Todav&iacute;a est&aacute; confundido?.
Revis&eacute;moslo: estamos permitiendo el acceso para la
gesti&oacute;n del sistema desde nuestra m&aacute;quina de
clase C al puerto 22 (ssh), y el acceso <em>web</em> a todo el
tr&aacute;fico entrante a los puertos 80 (http) y 443 (https).
Y estamos bloqueando el resto del tr&aacute;fico;  pero,
&iquest;y si quisiera conectar a trav&eacute;s de
d1088 14
a1101 13
fuera del servidor de <em>web</em>? o, &iquest;y si necesitara
usar <a href="http://www.openbsd.org/cgi-bin/man.cgi?query=lynx&sektion=1">lynx(1)</a>
para buscar algo en las p&aacute;ginas de Preguntas
Frecuentes?  No podr&iacute;a, ya que habr&iacute;a bloqueado
todas las conexiones entrantes que no estuvieran dirigidas a
los puertos especificados.  Aunque &eacute;sta es la ruta
m&aacute;s segura, puede ser muy poco conveniente.  Al
a&ntilde;adir las opciones clave <em>keep state</em> a la
regla &quot;pass out&quot;, puede permitir de forma
autom&aacute;tica el paso de paquetes que sean una respuesta a
conexiones que Vd. haya iniciado previamente, como por ejemplo
al navegar por la web.  Recuerde que es necesario especificar
para qu&eacute; protocolo estamos manteniendo el estado.
d1116 14
a1129 16
incremento en la flexibilidad y seguridad de su grupo de
reglas:  por ejemplo, en el grupo de reglas anterior, estamos
permitiendo el paso a todo el tr&aacute;fico tcp a los puertos
80 y 443.  A&uacute;n puede hacerlo un poco m&aacute;s
estricto.  Para establecer una conexi&oacute;n tcp s&oacute;lo
necesita permitir que tenga lugar el saludo inicial
(<em>handshake</em>); una vez que esto ocurra, puede bloquear
el tr&aacute;fico a ese puerto y permitir a la regla
&quot;keep state&quot; que gestione la conexi&oacute;n.  Para
que se complete el saludo inicial, s&oacute;lo es necesario
que los paquetes tengan SYNACK activado.  Dejando pasar
s&oacute;lo paquetes con SYN activado se puede prevenir muchas
formas de barridos de puertos (<em>port scanning</em>), como
puede ser el barrido de FIN.  Los indicadores S/SA del
indicador S (SYN) y el indicador A (ACK) indican que
s&oacute;lo se puede activar SYN.  No se investiga sobre otros
d1148 11
a1158 13
Empecemos a poner un poco de orden poniendo todas las reglas
que tenemos hasta ahora juntas.  Este grupo de reglas
tendr&aacute; soporte para IPv4, una pol&iacute;tica de
denegaci&oacute;n predefinida, permitir&aacute; conexiones
para la gesti&oacute;n del sistema s&oacute;lo si provienen de
una red interna (a trav&eacute;s de ssh), y permitir&aacute;
el paso del tr&aacute;fico entrante a los puertos 80 (http) y
443 (https).  Adem&aacute;s, proteger&aacute; contra
direcciones de ip falsificadas no enrutables, y
bloquear&aacute; todos los paquetes que est&eacute;n tan
fragmentados que no puedan ser inspeccionados.  Una
configuraci&oacute;n bastante completa para un servidor de
<em>web</em> p&uacute;blico.  He aqu&iacute; c&oacute;mo
d1196 4
a1199 4
Aunque esto pueda parecer suficiente, hay algunas cosas que PF
le permitir&aacute; llevar a cabo para que su fichero
<em>pf.conf</em> sea m&aacute;s claro y m&aacute;s
f&aacute;cil de mantener.
d1207 5
a1211 5
Las agrupaciones son abreviaciones que sirven para escribir
reglas m&aacute;s simples y claras en PF.  Por ejemplo,
&iquest;qu&eacute; har&iacute;amos si quisi&eacute;ramos
permitir conexiones a un servicio que funcionase sobre
m&uacute;ltiples protocolos como BIND, que usa TCP y UDP?
d1219 1
a1219 1
N&oacute;ntese los espacios a ambos lados de los caracteres '{ }'.
d1223 5
a1227 5
Los grupos de IP relacionadas se pueden reagrupar en
&laquo;agrupaciones&raquo; (<em>sets</em>), que se pueden
utilizar en cualquier parte en la que se pueda usar una IP.
Por ejemplo, tomando como partida nuestras reglas contra la
falsificaci&oacute;n de IP anteriores:
d1246 5
a1250 5
Un problema con el ejemplo del fichero <em>pf.conf</em>
anterior es que, si necesit&aacute;ramos cambiar nuestro NIC,
o cambiar una direcci&oacute;n IP, tendr&iacute;amos que
cambiar muchas l&iacute;neas.  Para suavizarlo podemos definir
variables de expansi&oacute;n:
d1268 2
a1269 2
Pongamos todo lo que hemos visto hasta ahora en un fichero y
veremos la elegancia de &eacute;ste:
d1309 1
a1309 1
Si experimenta problemas, puede activar el registro en reglas
d1311 1
a1311 1
resoluci&oacute;n de problemas, o sea:
d1319 6
a1324 4
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=pflogd&sektion=8">pflogd(8)</a> escribir&aacute; las entradas del registro ip a
<em>/var/log/pflog</em>.  Recuerde que <em>/var/log/pflog</em>
es un fichero binario que debe ser leido por
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=tcpdump&sektion=8">tcpdump(8)</a>, y NO directamente por humanos.
d1328 3
a1330 4
&iexcl;Cuando modifique el fichero sde configuraci&oacute;n
para el registro de paquetes, no se olvide de ejecutar
<kbd>pfctl -R /etc/pf.conf</kbd> para que los cambios tengan
lugar!
d1338 5
a1342 5
El Filtro de Paquetes IP (PF), ha sido dise&ntilde;ado para
ser muy compatible con el fichero de reglas <em>ipf.rules</em>
de IPF.  Sin embargo, PF no es un simple substituto para IPF.
Las diferencial sint&acute;cticas principales de la reglas de
filtrado (<em>pf.conf</em>) son las siguientes:
d1347 5
a1351 6
Estas opciones ya no se utilizan, debido a que las reglas de
filtrado se optimizan al vuelo.  Si est&aacute; migrando desde
sus viejas reglas de IPF debe eliminar cualquier
definici&oacute;n de <em>group</em> o <em>head</em> y
reordenar sus reglas de forma manual, asegur&aacute;ndose de
que la sem&aacute;ntica no haya cambiado.</li>
d1353 3
a1355 3
Cuando se efect&uacute;an registros, PF no acepta la
opci&oacute;n <em>level</em> como clave de registro, ya que el
registro se lleva a cabo mediante
d1357 3
a1359 4
pero mediante un d&aelig;mon de registro separado.  Para
examinar un tipo de tr&aacute;fico particular, como se
hac&iacute;a con la opci&oacute;n <em>level</em>, use
cualquiera de las opciones de
d1361 1
a1361 1
disponibles a este efecto.</li>
d1363 2
a1364 2
Ha sido substituido por la normalizaci&oacute;n que lleva a
cabo <a href="#normalization">scrub</a>.</li>
d1366 4
a1369 4
En PF no existe soporte para prefijar reglas con <em>@@n</em>
para introducirlas en ciertos puntos en la lista de la regla,
como en IPF.  Para ver los n&uacute;meros de regla que ha
asignado PF, use la orden <kbd>pfctl -sr</kbd>.</li>
d1379 4
a1382 4
<h5>Nota: PF es el sistema de filtrado en OpenBSD 3.0 y
versiones posteriores.  Si est&aacute; buscando las preguntas
frecuentes de IPF/IPNAT para OpenBSD 2.9 y versiones
anteriores, pulse <a href="faqipf.html">aqu&iacute;</a>.</h5>
d1393 7
a1399 8
<a href="http://www.geektools.com/rfc/rfc1631.txt">RFC
1631</a>, NAT provee de un modo f&aacute;cil para asignar
redes internas a una sola direcci&oacute;n de Internet
enrutable (&laquo;real&raquo;).  Es de gran utilidad si no
dispone de direcciones asignadas oficialmente para cada
anfitri&oacute;n en su red interna.  Cuando configure redes
privadas/internas puede aprovechar los bloques de
direcci&oacute;n reservados (asignados en la
d1401 1
a1401 2
<a href="http://www.geektools.com/rfc/rfc1918.txt">RFC
1918</a>), como:
d1411 3
a1413 3
Se asume que el usuario ya tiene configurado un sistema
OpenBSD con dos tarjetas de red (una conectada a Internet y la
otra a la red local).
d1421 5
a1425 5
Usaremos el sistema que se describe a continuaci&oacute;n como
ejemplo.  Como su configuraci&oacute;n ser&aacute;, con casi
toda seguridad, distinta a &eacute;sta, tenga mucho cuidado
con no copiar lo que vea literalmente en su sistema y
esperando que funcione correctamente.
d1443 2
a1444 2
conexi&oacute;n por m&oacute;dem anal&oacute;gico provista por un
Proveedor de Servicios de Internet)</strong><br>
d1453 9
a1461 10
En este entorno de ejemplo, las m&aacute;quinas de la LAN usan
el esquema de direcciones IP 192.168.1.xxx (donde xxx es un
n&uacute;mero &uacute;nico).  Existe una gran variedad de
sistemas operativos diferentes en la red interna, incluidos
Windows 98, Windows NT, OpenBSD y Linux, pero el sistema
operativo cliente no es un problema para NAT.  Cada
m&aacute;quina est&aacute; conectada a un concentrador
(<em>hub</em>) designado para uso interno.  Para este
documento y sus ejemplos, se asumir&aacute; que el cliente en
la red interna tiene una direcci&oacute;n IP 192.168.1.40
d1494 9
a1502 10
Cada nodo en Internet requiere una direcci&oacute;n IP
&uacute;nica.  Con IPv4 hay un n&uacute;mero finito de
direcciones IP diferentes disponibles, y como resultado no son
gratuitas.  La mayor&iacute;a de proveedores de Internet de
&laquo;bajos costes&raquo; limitan un sitio a cualquier parte
desde 1 a 30 direcciones, y mientras organizaciones con
presupuestos m&aacute;s grandes pueden permitirse un bloque
mayor, en la mayor&iacute;a de los casos, existen pocos
beneficios y demasiados riesgos al tener cada m&aacute;quina
con una direcci&oacute;n individual en Internet.
d1506 10
a1515 10
NAT, &laquo;Traducci&oacute;n de Direcciones de Red&raquo;
(tambi&eacute;n conocido como &laquo;Enmascaramiento de
IP&raquo; en Linux), permite que varias m&aacute;quinas se
encuentren <em>detr&aacute;s</em> de una direcci&oacute;n IP
(o de unas cuantas).  Cada m&aacute;quina en la red interna
tiene una direcci&oacute;n IP no registrada que se asigna de
forma interna (de acuerdo con las especificaciones de
<a href="http://www.geektools.com/rfc/rfc1918.txt">RFC
1918</a>), y todas utilizan la misma direcci&oacute;n IP
externa de forma simult&aacute;nea.
d1519 4
a1522 5
El modo en que funciona NAT es bastante simple.  Cuando un
cliente dentro de la LAN quiere conectar a la m&aacute;quina
en Internet, le env&iacute;a un paquete TCP con un
requerimiento de conexi&oacute;n.  Dentro de la cabecera del
paquete TCP se encuentra la direcci&oacute;n IP del cliente
d1525 13
a1537 15
m&aacute;quina en la que est&aacute; funcionando NAT
intercepta este paquete TCP y cambia la direcci&oacute;n IP
del cliente de 192.168.1.40 a la direcci&oacute;n IP de la
m&aacute;quina conectada a Internet (por ejemplo, 24.5.0.5).
De este modo enga&ntilde;a a la m&aacute;quina anfitriona,
haci&eacute;ndole pensar que la conexi&oacute;n requerida
proviene de la m&aacute;quina con NAT, no de la m&aacute;quina
cliente.  Entonces el anfitri&oacute;n env&iacute;a de vuelta
respuestas a la m&aacute;quina NAT como si &eacute;sta fuera
la que se estuviera conectando.  Cuando la m&aacute;quina NAT
recibe las respuestas, las traduce r&aacute;pidamente y
env&iacute;a el paquete al cliente.  Generalmente, el cliente
no tiene ni la m&aacute;s remota idea de lo que est&aacute;
ocurriendo y la supuesta conexi&oacute;n a Internet es
transparente al usuario y a las aplicaciones del usuario.
d1562 10
a1571 12
Una vez que ya hab&iacute;a conseguido un m&oacute;dem cable
en mi nuevo apartamento me d&iacute; cuenta de que
ten&iacute;a un peque&ntilde;o problema.  &iquest;C&oacute;mo
podr&iacute;a conseguir acceso a Internet para mis
compa&ntilde;eros de apartamento si el m&oacute;dem estaba en
mi habitaci&oacute;n?  S&oacute;lo hab&iacute;a unas pocas
opciones que pod&iacute;an ayudarme, y que iban desde obtener
direcciones IP extras, pasando por instalar un servidor proxy,
hasta instalar NAT (no permita que el ejemplo casero del
m&oacute;dem cable le enga&ntilde;e, NAT es lo suficientemente
potente como para enmascarar un gran red con cientos o incluso
miles de m&aacute;quinas).
d1575 9
a1583 10
Existen varias razones por las que decid&iacute; instalar NAT,
la primera de ellas la de ahorrar costes.  En la casa
viv&iacute;an dos compa&ntilde;eros de piso, y compartir
gastos es una buena idea.  Adem&aacute;s, cada uno
ten&iacute;a su propio PC y yo ten&iacute;a tres;
ten&iacute;amos cinco m&aacute;quinas que conectar, pero mi
ISP s&oacute;lo permit&iacute;a tres direcciones IP por casa,
lo que significaba que no hab&iacute;an direcciones IP
suficientes para que cada m&aacute;quina pudiera acceder a
Internet de forma simult&aacute;nea.
d1587 3
a1589 4
Usando NAT cada m&aacute;quina tendr&iacute;a una
direcci&oacute;n IP interna &uacute;nica,  pero
compartir&iacute;an la &uacute;nica direcci&oacute;n IP que mi
ISP me dio.  El coste se redujo.
d1597 5
a1601 5
Para activar NAT en su m&aacute;quina OpenBSD,
necesitar&aacute; configurar PF.  Esto se puede llevar a cabo
de una manera f&aacute;cil editando los ficheros que aparecen
en la siguiente lista (haga los cambios al fichero de modo que
aparezcan como las opciones que siguen a continuaci&oacute;n):
d1605 2
a1606 2
<strong>/etc/rc.conf</strong> (este fichero se usa para
iniciar servicios durante el arranque)
d1622 1
a1622 1
Despu&iacute;s de haber hecho estos cambios, la m&aacute;quina
d1633 3
a1635 4
Para el prop&oacute;sito que persigue este documento,
dejaremos que el tr&aacute;fico pase a trav&eacute;s de este
cortafuegos sin que haya interferencias.  El fichero
ser&aacute; como sigue:
d1646 3
a1648 3
Para m&aacute;s informaci&oacute;n puede leer la
secci&oacute;n sobre <a href="#PF">PF, el paquete de filtros
IP</a> de OpenBSD.
d1654 3
a1656 4
es bastante simple.  De acuerdo con el ejemplo de
configuraci&oacute;n anterior, el fichero de
configuraci&oacute;n de NAT contendr&aacute; las siguientes
entradas:
d1666 1
a1666 1
He aqu&iacute; lo que significan estas l&iacute;neas.
d1672 1
a1672 2
Indica que la orden que se est&aacute; dando es una regla de
NAT.
d1679 1
a1679 2
&Eacute;sta es la interfaz de red que est&aacute; conectada a
Internet.
d1686 4
a1689 5
La direcci&oacute;n IP y de enmascaramiento de red
(<em>netmask</em>, cuyo formato es CIDR).  La
combinaci&oacute;n de ambas indica que &laquo;cualquier
direcci&oacute;n IP con un valor desde 192.168.1.1 hasta
192.168.1.254 debe ser asignado&raquo;.
d1696 2
a1697 2
&Eacute;sta es la direcci&oacute;n IP external que se
asignar&aacute; a la direcci&oacute;n IP interna.
d1706 3
a1708 4
Una vez que haya acabado de configurarlo, hay dos formas de
activar NAT.  La primera forma, y la mejor si fuera posible,
es reiniciando su sistema OpenBSD.  Para ello basta que use la
orden <kbd>reboot</kbd>.
d1712 2
a1713 2
Si quiere ejecutar NAT desde la l&iacute;nea de
&oacute;rdenes, use las siguiente &oacute;rdenes:
d1724 4
a1727 5
La primera l&iacute;nea es para cargar un grupo de reglas de
NAT en PF (y eliminar cualquier regla anterior), y la segunda
para activar PF.  Despu&eacute;s de esto, la mejor manera de
asegurarse que todo iniciar&aacute; como se espera, es
reiniciar el sistema.
d1731 4
a1734 4
<strong>Nota:</strong> para volver a cargar las
configuraciones de NAT (en el caso en que las cambiara y no
quisiera reiniciar) ejecute la primera orden de nuevo.  Las
configuraciones ser&aacute;n descargadas y cargadas de nuevo.
d1746 4
a1749 5
Para averiguar c&oacute;mo est&aacute; funcionando NAT o
asegurarse de que las configuraciones hayan hecho efecto, use
la opci&oacute;n &quot;-ss&quot;.  Esta opci&oacute;n le
mostrar&aacute; un listado de todas las sesiones que NAT
est&eacute; usando actualmente:
d1762 2
a1763 3
A continuaci&oacute;n puede ver una explicaci&oacute;n sobre
lo que significa la primera l&iacute;nea (las otras son
similares):
d1769 3
a1771 4
Le indica la direcci&oacute;n IP de la m&aacute;quina que
est&eacute; usando NAT (192.168.1.35) en la LAN.  El
n&uacute;mero del puerto que se use para realizar la
conexi&oacute;n (2132) se mostrar&aacute; a
d1779 2
a1780 3
Indica que la conexi&oacute;n se dirige hacia Internet a
trav&eacute;s de la direcci&oacute;n 24.5.0.5 usando el puerto
53136.
d1803 4
a1806 5
Existen unas cuantas limitaciones de NAT a tener en cuenta, de
las cuales la m&aacute;s com&uacute;n es con FTP.  Puede usar
FTP de dos maneras:  pasivo y activo;  de &eacute;stas, FTP
pasivo est&aacute; considerado como el m&aacute;s seguro en la
mayor&iacute;a de los casos.
d1810 11
a1820 13
Con FTP activo, cuando un usuario conecta a un servidor de FTP
remoto y pide un fichero o informaci&oacute;n, el cliente de
FTP env&iacute;a al servidor un n&uacute;mero aleatorio de
puerto en el que el servidor establecer&aacute; una
conexi&oacute;n para el cliente y por el que tranmitir&aacute;
la informaci&oacute;n requerida.  Esto supone un problema para
los usuarios que intenten acceder a servidores de FTP desde
dentro de la misma red interna.  Cuando el servidor de FTP
env&iacute;a su informaci&oacute;n, la env&iacute;a al NIC
externo y a un puerto aleatorio.  La m&aacute;quina de NAT la
recibe, pero debido a que no tiene asignaciones para el
paquete desconocido ni para este puerto, bloquea el paquete y
no lo entrega.
d1825 10
a1834 10
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=ftp&sektion=1">ftp(1)</a> en OpenBSD),
el cliente hace una petici&oacute;n para que el servidor
escoja un puerto aleatorio, y se mantiene a la escucha por ese
puerto esperando los datos de conexi&oacute;n.  El servidor
informa al cliente del puerto que ha elegido, y el cliente se
conecta a ese puerto para tranferir los datos.  Esto,
desafortunadamente, no siempre es posible ni deseable.  ftp(1)
usa este modo de forma predeterminada;  para forzar el uso del
modo activo de FTP, use el indicador <em>-A</em> con la orden
de <kbd>ftp</kbd>, o desactive el modo pasivo mediante la orden
d1844 5
a1848 6
PF dispone de otra soluci&oacute;n para este caso,
redireccionando el tr&aacute;fico de FTP a trav&eacute;s de un
servidor <em>proxy</em> de FTP, un proceso que
&laquo;gu&iacute;a&raquo; su tr&aacute;fico de FTP a
trav&eacute;s de los filtros.  El <em>proxy</em> de FTP
utilizado por OpenBSD y PF es
d1850 2
a1851 2
Para activarlo, a&ntilde;ada a su fichero
<em>/etc/nat.conf</em> algo parecido a esto:
d1860 3
a1862 4
&laquo;tr&aacute;fico en la interfaz interna se redirecciona
al servidor de proxy que hay funcionando en esta
m&aacute;quina y que est&aacute; a la escucha por el puerto
8081&raquo;.
d1866 3
a1868 4
Con suerte, es f&aacute;cil ver que el servidor de proxy debe
ser iniciado y ejecutado en la m&aacute;quina OpenBSD, lo que
se hace introduciendo la siguiente l&iacute;nea en el fichero
<em>/etc/inetd.conf</em>:
d1878 1
a1878 2
Una forma de enviar esta se&ntilde;al 'HUP' es mediante la
orden:
d1886 5
a1890 5
Notar&aacute;a que ftp-proxy estar&aacute; a la escucha por el
puerto 8081, el mismo puerto al que rdr estaba enviando el
tr&aacute;fico de FTP.  Hemos escogido el puerto 8081 de forma
arbitraria, aunque 8081 es una buena elecci&oacute;n ya que no
est&aacute; asignado para ninguna otra aplicaci&oacute;n.
d1898 13
a1910 15
Con algunas aplicaciones es probable que tenga que
redireccionar el tr&aacute;fico entrante o saliente para un
cierto protocolo y/o puerto, hacia una cierta m&aacute;quina
que se encuentre detr&aacute;s del sistema de filtros.  Un
ejemplo de esto podr&iacute;a ser el caso de una
m&aacute;quina que se encontrara dentro de la red local y que
tuviera un servidor de <em>web</em> que tuviera que ser
accedido desde fuera (o, por supuesto, el ya consabido
ftp-proxy(8)).  Las conexiones entrantes a us IP v&aacute;lida
de Internet se encontrar&aacute;n con que, a menos que la
m&aacute;quina de NAT tambi&eacute;n tenga un servidor de
<em>web</em>, no pondr&aacute;n conectarse.  Para ello
usaremos la directiva 'rdr' de NAT en el fichero de reglas, a
fin de dar las instrucciones sobre d&oacute;nde se debe
redireccionar una conexi&oacute;n concreta.
d1914 5
a1918 5
Para nuestro ejemplo, supongamos que un servidor de web reside
en la LAN y que su direcci&oacute;n IP es 192.168.1.80.  El
fichero de reglas de NAT necesita una nueva directiva para
gestionar esto.  A&ntilde;ada una l&iacute;nea parecida a la
siguiente al fichero <em>/etc/nat.conf</em>:
d1935 3
a1937 3
Es la orden que le est&aacute; pasando a NAT.  Indica a NAT
que lo que viene a continuaci&oacute;n es una entrada para
redireccionar una conexi&oacute;n.
d1952 3
a1954 3
Indica cu&aacute;l es la direcci&oacute;n IP que hay que
redireccionar (cualquiera de las que entren en fxp0, como se
indica anteriormente, con cualquier IP como destino).
d1961 7
a1967 8
&Eacute;ste es el puerto (80) entrante que debe ser
redireccionado.  El n&uacute;mero &laquo;80&raquo; no es
estrictamente necesario, tambi&eacute;n podr&iacute;a usar
&laquo;port www&raquo; para especificar una redirecci&oacute;n
del puerto 80.  Si desea usar un nombre en lugar de un
n&uacute;mero, el nombre del servicio y el puerto
correspondiente deben existir en el fichero
<em>/etc/services</em>.
d1975 3
a1977 4
redireccionados los paquetes.  N&oacute;tese que el puerto de
destino NO tiene porqu&eacute; coincidir con el puerto
entrante.  Por ejemplo, lo siguiente es v&aacute;lido e
incluso puede ser &uacute;til:
d1981 3
a1983 3
Esta l&iacute;nea redireccionar&iacute;a el tr&aacute;fico
entrante en el puerto 8080 a un servidor de <em>web</em> de
una m&aacute;quina en la red interna, en el puerto 80.
d1988 2
a1989 2
Cuando haya terminado de a&ntilde;adir todos los datos, recargue las
reglas de NAT y el redireccionamiento comezar&aacute; de inmediato.
d1998 8
a2005 9
redireccionamiento de NAT.  Un ejemplo de esto ser&iacute;a
<em>AOL Instant Messenger</em>, que suele escabullirse de los
cortafuegos a trav&eacute;s de cualquier puerto disponible.
Es posible que ftp-proxy interfiera con AIM cuando decide
salir por el puerto remoto 21.  Si cree que esto puede ser
malo (muchas personas pierden bastante tiempo intentando
bloquear AIM), puede excluir las direcciones IP usadas por los
servidores AIM del tr&aacute;fico redireccionado por nuestra
l&iacute;nea de ftp-proxy anterior.  Para ello, use la
d2014 9
a2022 11
Interpretaci&oacute;n: redireccionar el tr&aacute;fico que
entra en tl0 con direcci&oacute;n al puerto 21, pero NO por
64.12.163.199 (con el que los usuarios del servidor de AIM
ten&iacute;an problemas) al puerto 8081 del anfitri&oacute;n
local (en donde se supone que estar&aacute; esperando
ftp-proxy).  Pero le avisamos que existen muchos servidores de
AIM;  si le interesa esta aplicaci&oacute;n, es probable que
tenga que jugar con estas direcciones IP (64.12.0.0/16 puede
ser m&aacute; productiva, aunque es probable que
tambi&eacute;n interfiera con algunos sitios que no sean de
AOL).
d2031 18
a2048 21
La diferencia entre NAT y una aplicaci&oacute;n basada en
<em>proxy</em> es que el software de <em>proxy</em>
act&uacute;a como un intermediario entre Internet y las
m&aacute;quinas conectadas a la LAN.  En prinicipio esto no
presenta ning&uacute;n problema, sin embargo cada
aplicaci&oacute;n que quiera ejecutar en su m&aacute;quina y
conectarla a Internet a trav&eacute;s del servidor de
<em>proxy</em>, DEBE reconocer el <em>proxy</em> (ser capaz de
usarlo).  No todas las aplicaciones con capaces de esto (en
especial los juegos).  A&uacute;n m&aacute;s, no existen
aplicaciones para servidores de <em>proxy</em> para todos los
servicios de Internet.  NAT asigna su red interna de un modo
transparente, para que pueda conectar a Internet.  La
&uacute;nica ventaja de seguridad que proxy tiene sobre NAT es
que el software de <em>proxy</em> puede haber sido programado
para funciones de seguridad, y puede filtrar seg&uacute;n el
contenido con el fin de evitar que una macro de virus se
interne en su m&aacute;quina Windows, o proteger sus programas
contra desbordamientos de la memoria intermedia (<em>buffer
overflows</em>), y otros peligros.  El mantenimiento de estos
filtros es a menudo un trabajo muy pesado.
d2060 5
a2064 5
<li><em>/etc/rc.conf</em> - fichero de configuraci&oacute;n
general de inicio del sistema que hay que editar para iniciar
NAT y PF durante el arranque del sistema
<li><em>/etc/sysctl.conf</em> - fichero para activar el
reenv&iacute;o de IP (<em>IP forwarding</em>)
d2090 4
a2093 4
edite el fichero <em>/etc/hostname.xl0</em> (suponiendo que su interfaz
principal de ethernet sea xl0;  la suya podr&iacute;a ser ep0, o fxp0,
o cualquier otra).  Todo lo que necesita a&ntilde;adir a este fichero
es 'dhcp'.
d2101 2
a2102 2
informaci&oacute;n sobre su direcci&oacute;n IP, pasarela, y servidores
de DNS desde el servidor de DHCP.
d2105 3
a2107 3
Si quiere iniciar un cliente dhcp desde la l&iacute;nea de
&oacute;rdenes, aseg&uacute;rese de que el fichero
<em>/etc/dhclient</em> existe, y entonces escriba:
d2113 1
a2113 1
en donde fxp0 es la interfaz en la que quiere recibir dhcp.
d2116 6
a2121 7
Sea cual fuere el modo en que inicie dhclient, puede editar el
fichero <em>/etc/dhclient</em> para <strong>evitar</strong>
que se actualice su DNS de acuerdo con la idea que tenga el
servidor dhcp sobre la DNS, comentando las l&iacute;neas
precedidas por 'request' (son ejemplos de la
configuraci&oacute;n predefinida, pero necesita activarlos
para anular la configuraci&oacute;n predefinida de dhclient).
d2128 3
a2130 3
y a continuaci&oacute;n <strong>eliminar</strong>
domain-name-servers.  Tambi&eacute;n es posible que
tambi&eacute;n desee anular hostname u otras configuraciones.
d2135 1
a2135 1
Si quiere usar OpenBSD como servidor DHCP con
d2137 5
a2141 4
edite el fichero <em>/etc/rc.conf</em>.  Config&uacute;relo poniendo
dhcp_flags=&quot;-q&quot; en lugar de dhcp_flags=NO.  A&ntilde;ada en
<em>/etc/dhcp.interfaces</em> las interfaces en las que quiera que dhcp
est&eacute; <strong>a la escucha</strong>.
d2147 1
a2147 1
y edite <em>/etc/dhcpd.conf</em>.  Las opciones son bastante claras:
d2161 14
a2174 16
Con esto indicar&aacute; a sus clientes dhcp que el dominio
que deben a&ntilde;adir a sus requerimientos de DNS es xyz.mil
(as&iacute;, si un usuario escribiera 'telnet joe', los
enviar&iacute;a a joe.xyz.mil).  Les dirigir&aacute; a los
servidores de DNS 192.168.1.3 y 192.168.1.5.  Para los
anfitriones que se encuentren en la misma red que una interfaz
de ethernet en la m&aacute;quina de OpenBSD, que est&aacute;
en el rango 192.168.1.0/24, les asignar&aacute; una
direcci&oacute;n de IP entre 192.168.1.32 y 192.168.1.127,
configurando su pasarela por definici&oacute;n como
192.168.1.1.

<p>
Si quiere iniciar dhcpd desde la l&iacute;nea de
&oacute;rdenes, despu&eacute;s de editar
<em>/etc/dhcpd.conf</em> intente lo siguiente:
d2180 3
a2182 3
En donde fxp0 es la interfaz que Vd. desea que empiece a
servir dhcp.  El indicador -q fuerza dhcpd en silencio, ya que
de otro modo es muy ruidoso.
d2185 4
a2188 5
Si est&aacute; actuando como servidor de DHCP para una
m&aacute;quina Windows, es posible que quiera que dhcp ofrezca
al cliente una direcci&oacute;n de servidor 'WINS'.  Para ello
a&ntilde;ada la siguiente l&iacute;nea al fichero
<em>/etc/dhcpd.conf</em>:
d2194 3
a2196 2
En donde 192.168.92.55 es el IP de su servidor de Windows o Samba.
Para ver m&aacute;s opciones que puedan aceptar sus clientes DHCP, lea
d2205 2
a2206 2
El &laquo;Protocolo Punto a Punto&raquo; es el que se suele usar para
crear una conexi&oacute;n con su ISP a trav&eacute;s de un
d2211 1
a2211 1
<li><a href="http://www.openbsd.org/cgi-bin/man.cgi?query=ppp&sektion=8">ppp(8)</a> - Es el d&aelig;mon ppp del modo usuario.</li>
d2216 3
a2218 2
necesitar&aacute; algo de informaci&oacute;n sobre su isp.  He
aqu&iacute; una lista de la informaci&oacute;n que necesitar&aacute;:
d2222 5
a2226 5
   <li>El n&uacute;mero de tel&eacute;fono de conexi&oacute;n de su
       proveedor (ISP)
   <li>Su <em>nameserver</em> (nombre del servidor) 
   <li>Su nombre de usuario y contrase&ntilde;a
   <li>Su pasarela (<em>gateway</em>)
d2231 2
a2232 2
ser&aacute; de gran ayuda para configurar ppp.  El d&aelig;mon PPP de
modo usuario utiliza el fichero
d2236 2
a2237 2
ejemplos de configuraci&oacute;n para situaciones distintas.  Le
aconsejamos que mire en ese directorio.
d2241 2
a2242 2
En caso de no estar usando un n&uacute;cleo GENERIC, aseg&uacute;rese
de que tiene la siguiente l&iacute;nea en su fichero de
d2254 1
a2254 1
La configuraci&oacute;n inicial del d&aelig;mon PPP de modo usuario
d2256 11
a2266 10
no existe y debe ser creado, pero puede tomar el fichero
<em>/etc/ppp/ppp.conf.sample</em>, editarlo, y crear su propio fichero
<em>ppp.conf</em> a partir de ah&iacute;.  Aqu&iacute; empezar&eacute;
con la m&aacute;s simple, y probablemente m&aacute;s utilizada,
configuraci&oacute;n.  A continuaci&oacute;n puede ver un
peque&ntilde;o fichero <em>ppp.conf</em> que llevar&aacute; a cabo la
conexi&oacute;n con su ISP y usar&aacute; sus rutas predefinidas y su
<em>nameserver</em>.  Para este fichero, toda la informaci&oacute;n que
necesitar&aacute; ser&aacute; el n&uacute;mero de tel&eacute;fono de su
ISP, su nombre de usuario, y su contrase&ntilde;a.
d2280 6
a2285 7
La secci&oacute;n en la opci&oacute;n
<strong>default:</strong> ser&aacute; ejecutada cada vez.  En
ella se configura toda la informaci&oacute;n cr&iacute;tica.
Con &quot;set log&quot; se configuran los niveles de ingreso.
Esto se puede cambiar;  para m&aacute;s informaci&oacute;n
sobre c&oacute;mo configurar los niveles de ingreso lea la
p&aacute;gina del manual
d2287 9
a2295 10
El dispositivo se configura con &quot;set device&quot;.
&Eacute;ste es el dispositivo en el que se encuentra el modem.
En este ejemplo el modem est&aacute; en el puerto de
comunicaciones 2 (COM2), mientras que el puerto de
comunicaciones 1 corresponder&iacute;a a <em>/dev/cua00</em>.
Con &quot;set speed&quot; se configura la velocidad de la
conexi&oacute;n por llamada, y con &quot;set dial&quot; se
configura los par&aacute;metros de la llamada.  Con esto se
puede cambiar el tiempo muerto, etc...  Es conveniente dejar
esta l&iacute;nea m&aacute;s o menos como est&aacute;.
d2299 7
a2305 8
A continuaci&oacute;n puede pasar a configurar la
informaci&oacute;n espec&iacute;fica para su ISP.  Para ello
debe a&ntilde;adir otra opci&oacute;n en la secci&oacute;n
<strong>default:</strong>.  Puede dar cualquier nombre a esta
etiqueta, pero lo m&aacute;s f&aacute;cil es darle el nombre
de su ISP.  En el ejemplo usaremos <strong>myisp:</strong>
para la opci&oacute;n que har&aacute; referencia a nuestro
ISP.  He aqu&iacute; una configuraci&oacute;n simple que
d2325 12
a2336 12
conexi&oacute;n de su ISP.  La opci&oacute;n &quot;set login&quot; es
para configurar sus opciones de ingreso.  En el ejemplo hemos puesto un
tiempo muerto de espera de 5, lo que significa que terminar&aacute;
nuestro intento de ingreso despu&eacute;s de 5 segundos su no hay
transportador.  De lo contrario esperar&aacute; hasta recibir un
&quot;login&quot; para enviar su nombre de usuario y contrase&ntilde;a.
En el ejemplo, tanto el nombre de usuario como la contraseña son
&quot;ppp&quot;.  Estos valores hay que substituirlos por otros reales.
La opci&oacute;n &quot;set timeout&quot; es para configurar el tiempo
de espera para todo el proceso de ingreso.  La opci&oacute;n &quot;set
ifaddr&quot; es algo complicada.  He aqu&iacute; una explicaci&oacute;n
m&aacute;s extensa sobre ella:
d2346 12
a2357 13
[triggeradr]]]]</strong>&quot;.  De este modo el primer IP que
se especifique es el que querremos como nuestro IP.  Sin tiene
una direcci&oacute;n IP est&aacute;tica, escr&iacute;bala
aqu&iacute;.  En el ejemplo hemos usado /0, que indica que no
es necesario que concuerde ning&uacute;n bit de esta
direcci&oacute;n ip, y que se puede substituir todo.  El
segundo IP que se especifique es el que esperamos como el IP
de nuestro ISP.  Si lo sabe lo puede especificar aqu&iacute;,
pero en la l&iacute;nea no sabemos cu&aacute;l se
asignar&aacute;, as&iacute; que dejaremos que nos lo digan.
Esto es muy &uacute;til al negociar con algunas
implementaciones PPP que no asignan un n&uacute;mero IP a
menos que su conexi&oacute;n les requiera ``0.0.0.0''.
d2362 6
a2367 6
configurar la ruta predefinida a su IP.  Si su IP cambiara, la ruta se
actualizar&iacute;a de forma autom&aacute;tica.  Con &quot;enable
dns&quot; indicamos a nuestro ISP que autentifique nuestras direcciones
<em>nameservers</em>.  No haga esto si est&aacute; usando una DNS
local, ya que ppp circunvalar&aacute; su uso introduciendo algunas
l&iacute;neas en <em>/etc/resolv.conf</em>.
d2380 4
a2383 6
   <li><em>ppp -auto myisp</em> 
       - Inicia ppp, configura sus interfaces, le conecta con su isp, y
       a continuaci&oacute;n pasa a un plano de fondo.
   <li><em>ppp -ddial myisp</em> 
       - Parecido a -auto, pero si su conexi&oacute;n cayera
       volver&iacute;a a conectar.
d2387 4
a2390 4
Si usa <em>/usr/sbin/ppp</em> sin pasarle ninguna opci&oacute;n, le
pasar&aacute; al modo interactivo, desde donde podr&aacute;
interaccionar directamente con el m&oacute;dem.  De este modo puede
depurar problemas en su fichero <em>ppp.conf</em>.
d2396 4
a2399 4
Si necesitara ejecutar &oacute;rdenes al tiempo que conecta o
desconecta, puede hacerlo creando dos ficheros adicionales.
<em>/etc/ppp/ppp.linkup</em> y <em>/etc/ppp/ppp.linkdown</em>.
Puede ver ejemplos de configuraci&oacute;n para estos ficheros en:
d2408 1
a2408 1
Puede encontrar m&aacute;s informaci&oacute;n en el
d2415 1
a2415 1
<h2>6.6 - C&oacute;mo afinar par&aacute;metros de red</h2>
d2418 1
a2418 1
<h3>6.6.1 - &iquest;C&oacute;mo puedo forzar al n&uacute;cleo del
d2422 3
a2424 3
Para problemas de conexi&oacute;n o enrutamiento puede usar lo
siguiente.  Tenga en cuenta que para que sea más efectivo, ambos lados
de la conexi&oacute;n deben usar valores similares.
d2427 1
a2427 1
Para forzarlo use <tt>sysctl</tt> e incremente los valores de:
d2435 3
a2437 3
Si usa sysctl -a podr&aacute; ver los valores actuales de estos y
muchos otros par&aacute;metros.  Para cambiar cualquiera de ellos, use
<tt>sysctl -w</tt>, como por ejemplo en
d2440 2
a2441 1
<h3>6.6.2 - &iquest;C&oacute;mo puedo activar emisiones dirigidas?</h3>
d2443 3
a2445 3
Por regla general no es aconsejable hacer esto, ya que si su sistema
OpenBSD es un enrutador, permite que puedan enviar tr&aacute;fico a la
direcci&oacute;n o direcciones de emisi&oacute;n de sus redes.
d2448 7
a2454 6
En algunos casos, como en redes cerradas, puede tener cierta utilidad,
en particular cuando est&eacute; usando implementaciones antiguas del
protocolo NetBIOS.  Se puede activar con <tt>sysctl -w
net.inet.ip.directed-broadcast=1</tt>.  Para saber porqu&eacute; se
encuentra desactivado por definici&oacute;n, inf&oacute;rmese sobre
<a href="http://www.netscan.org">ataques <em>&quot;smurf&quot;</em></a>.
d2465 4
a2468 5
asignados din&aacute;micamente por el n&uacute;cleo.  Esto se puede
usar para evitar que algunos d&aelig;mons se apropien de un puerto
espec&iacute;fico que sea necesario para el funcionamiento de otro
programa.  La lista de elementos puede ir separada por comas y/o
espacios en blanco.
d2486 4
a2489 5
El &laquo;Sistema de Archivos de Red&raquo; (NFS, <em>Network
File System</em>) se usa para compartir un sistema de archivos
en una red.  Algunas p&aacute;ginas del manual que
deber&iacute;a leer antes de que intente configurar un
servidor de NFS son:
d2500 4
a2503 4
configuraci&oacute;n simple de NFS.  El ejemplo ofrece detalles sobre
un servidor en una LAN, con clientes que tengan acceso NFS en la LAN.
En esta secci&oacute;n no se tratar&aacute; sobre la seguridad de NFS.
Asumiremos que Vd. ya ha configurado su paquete de filtros, u otra
d2505 5
a2509 5
exterior.  Si su configuraci&oacute;n permite el acceso desde el
exterior a su servidor de NFS, y si tiene alg&uacute;n tipo de datos
confidenciales o importantes, le recomendamos encarecidamente que haga
uso de <a href="faq13.html">IPsec</a>.  De otro modo existe la
posibilidad de que extra&ntilde;os puedan ver su tr&aacute;fico NFS.
d2511 4
a2514 4
direcci&oacute;n IP que tenga autorizada la entrada en su servidor NFS.
Existen varios tipos de ataques efectivos en este aspecto.  Cuando
IPsec est&aacute; correctamente configurado, protege contra todos estos
tipos de ataques.
d2518 5
a2522 6
Otra nota importante sobre seguridad.  No se limite a
a&ntilde;adir un sistema de archivos a <em>/etc/exports</em>
sin alg&uacute;n tipo de lista de anfitriones autorizados.
Sin una lista de anfitriones que puedan montar un directorio
particular, cualquiera que pueda llegar a su
anfitrionesodr&aacute; montar sus directorios de NFS en
d2528 7
a2534 9
<strong>10.0.0.1</strong>, que servir&aacute; NFS s&oacute;lo
a clientes dentro de esa red.  El primer paso para configurar
NFS es configurar su fichero <em>/etc/exports</em>.  Este
fichero se compone de una lista con los sistemas de archivo
que quiera que se encuentren accesibles por medio de NFS, y
define qui&eacute;n puede acceder a cada uno de ellos.
Existen muchas opciones que puede usar en su fichero
<em>/etc/exports</em>, y es conveniente leer la p&aacute;gina
del manual
d2536 2
a2537 2
En este ejemplo empezaremos con un fichero
<em>/etc/exports</em> como el siguiente:
d2543 4
a2546 3
# NFS exports Database
# See exports(5) for more information.  Be very careful, misconfiguration
# of this file can result in your filesystems being readable by the world.
d2552 10
a2561 11
Esto quiere decir que el sistema de archivo local
<em>/work</em> estar&aacute; disponible por medio de NFS.
<strong>-alldirs</strong> indica que los clientes
podr&aacute;n montar en cualquier parte del punto de montaje
<em>/work</em>.  <strong>-ro</strong> indica que s&oacute;lo
se permitir&aacute; montarlo en modo de s&oacute;lo lectura.
Los dos &uacute;ltimos argumentos indican que s&oacute;lo los
clientes dentro de la red 10.0.0.0 que usen una m&aacute;scara
de red 255.255.255.0, estar&aacute;n autorizados a montar este
sistema de archivo.  Esto es importante en algunos servidores
accesibles desde diferentes redes.
d2565 16
a2580 18
Una vez que su fichero <em>/etc/exports</em> haya sido
configurado, puede seguir adelante y configurar su servidor
NFS.  Primero deber&iacute;a asegurarse de que las opciones
NFSSERVER y NFSCLIENT se encuentren en la configuraci&oacute;n
del n&uacute;cleo de su sistema (el n&uacute;cleo GENERIC
incluye estas opciones).  A continuaci&oacute;n debe
configurar <strong>nfs_server=YES</strong> en el fichero
<em>/etc/rc.conf</em>.  De este modo, cuando reinicie el
sistema, se activar&aacute;n nfsd(8) y mountd(8).  Ahora ya
puede continuar e iniciar los d&aelig;mons Vd. mismo.  Estos
d&aelig;mons deben ser iniciados por root, y debe asegurarse
de que portmap(8) se encuentre funcionando en su sistema.  El
ejemplo que sigue sobre c&oacute;mo iniciar nfsd(8) sirve
tanto para TCP como para UDP usando 4 d&aelig;mons.  Para
gestionar el m&aacute;ximo n&uacute;mero de requerimientos de
clientes concurrentes a los que quiera dar servicio, debe
activar un n&uacute;mero apropiado de d&aelig;mons del
servidor NFS.
d2591 2
a2592 2
No s&oacute;lo debe iniciar el servidor nfsd(8), sino que
tambi&eacute;n necesita iniciar mountd(8).  &Eacute;ste es el
d2594 2
a2595 3
Para iniciar mountd(8), aseg&uacute;rese de que exista un
fichero vac&iacute;o <em>mountdtab</em> e invoque el
d&aelig;mon:
d2606 4
a2609 3
Si hace alg&uacute;n cambio al fichero <em>/etc/exports</em> mientras
NFS est&eacute; funcionando, tendr&aacute; que avisar a mountd sobre el
cambio pas&aacute;ndole una se&ntilde;al &quot;HUP&quot;:
d2622 1
a2622 1
Puede llevar a cabo comprobaciones para asegurarse de que estos
d2624 1
a2624 1
use rcpinfo(8).
d2646 1
a2646 1
Durante su uso normal, existen unas pocas utilidades más que le
d2650 1
a2650 1
que le permite ver qu&eacute; se encuentra montado y qui&eacute;n lo
d2653 1
a2653 1
m&aacute;s amplia.  Para usar showmount(8) escriba
d2669 2
a2670 2
Los sistemas de archivo NFS se deben montar mediante mount(8),
o m&aacute;s exactamente mediante
d2672 4
a2675 5
Para montar un sistema de archivo <em>/work</em> del
anfitri&oacute;n 10.0.0.1 en un sistema de archivo local
<em>/mnt</em>, haga lo siguiente (no necesita usar una
direcci&oacute;n IP, mount se encargar&aacute; de la
resoluci&oacute;n de nombres):
d2685 2
a2686 2
Para que el sistema se monte al iniciar, a&ntilde;ada una algo como lo
que ve a continuaci&oacute;n en su fichero <em>/etc/fstab</em>:
d2697 2
a2698 2
&iexcl;&iexcl;Es importante que use <tt>0 0</tt> al final de esta
l&iacute;nea para que su m&aacute;quina no intente ejecutar fsck sobre
d2700 1
a2700 1
opciones de seguridad t&iacute;picas como noexec, nodev, y nosuid,
d2713 3
a2715 4
NFS podr&aacute; traspasar las medidas de seguridad en el cliente NFS.
Si no est&aacute; montando programas para ejecutarlos en el cliente
NFS, a&ntilde;ada noexec a esta lista.

d2720 1
a2720 2
<h2>6.8 - Servicio de Nombres de Dominio  - DNS, BIND, y
named</h2>
d2726 2
a2727 2
El &laquo;Servicio de Nombres de Dominio&raquo; (DNS, &quot;Domain Name
Service&quot;) es una facilidad de red que permite a los dominios de
d2729 2
a2730 2
direcci&oacute;n-a-nombre en respuesta a un requerimiento.  Su
instalaci&oacute;n de OpenBSD est&aacute; configurada por
d2732 5
a2736 5
DNS.  O sea, su instalaci&oacute;n de OpenBSD puede llevar a cabo un
requerimiento de DNS para la direcci&oacute;n de una m&aacute;quina 
contra un servidor de nombres de dominio, pero no puede responder a uno
de esos requerimientos de DNS de por s&iacute; a menos que la configure
para ello.
d2739 3
a2741 4
Mi m&aacute;quina con OpenBSD est&aacute; conectada
actualmente a Internet a trav&eacute;s de mi proveedor (ISP,
<em>Internet Service Provider</em>), y por lo tanto puedo usar
la utilidad
a2743 1

d2759 4
a2762 4
<strong>165.87.201.244</strong> es el nombre del servidor que
ha contestado, porque es el &laquo;nombre de servidor&raquo;
(<em>nameserver</em>) que mi ISP me dijo que usara con mi
cuenta, y cuyo n&uacute;mero se introduce en el fichero
d2764 4
a2767 5
Pero la respuesta no fue autorizada.  Para una respuesta
autorizada, investiguemos cu&aacute;l es el servidor de DNS
autorizado para el dominio <em>openbsd.org</em>, y
pregunt&eacute;mosle por la direcci&oacute;n de
<em>www.openbsd.org</em>:
d2792 1
a2792 1
# Usar la informaci&oacute;n conseguida para requerir una
d2805 1
a2805 1
<em>zeus.theos.com</em> es, como puede suponer, una m&aacute;quina que
d2811 1
a2811 1
<h3>6.8.1.1 &iquest;D&oacute;nde puedo aprender todo sobre DNS y su
d2815 8
a2822 6
<li>Lea los RFC <a href="http://www.faqs.org/rfcs/rfc1033.html">1033</a>, <a href="http://www.faqs.org/rfcs/rfc1034.html">1034</a>, y <a href="http://www.faqs.org/rfcs/rfc1035.html">1035</a> 
para m&aacute;s informaci&oacute;n sobre el sistema de nombres de
dominio en Internet.</li>
<li>Lea el libro de O'Reilly Associates<em><a href="../../es/books.html#6">DNS and BIND</a></em>.</li>
<li>Lea las <a href="http://www.openbsd.org/cgi-bin/man.cgi">p&aacute;ginas de manual de OpenBSD</a>,
en especial las p&aacute;ginas de</li>
d2837 2
a2838 2
la informaci&oacute;n pr&aacute;cticamente en el mismo formato
requerido por los ficheros de configuraci&oacute;n de BIND.  Puede usar
d2840 16
a2855 14
para examinar nombres de servidores que sepa que est&aacute;n operando
correctamente para comparar su configuraci&oacute;n con la de ellos.
</p>

<h3>6.8.2 &iquest;Necesita mi m&aacute;quina ser un servidor de nombres
de dominio?</h3>

<p>
Si no est&aacute; seguro de si necesita que su m&aacute;quina haga el
papel de servidor de DNS, no la configure de ese modo.  La
instalaci&oacute;n de OpenBSD no activa su m&aacute;quina como servidor
de nombres de dominio por definici&oacute;n, aunque todos los ficheros
necesarios se encuentran instalados.  Para la mayor&iacute;a de
estaciones de trabajo, es suficiente con los ficheros
d2857 1
a2857 1
para indicar las direcciones IP de la m&aacute;quinas locales y
d2859 2
a2860 2
para indicar qu&eacute; servidores de DNS le har&aacute;n el servicio
en la intranet o internet.
d2864 2
a2865 2
Por otra parte, podr&iacute;a necesitar configurar su m&aacute;quina
como un servidor de nombres de dominio:
d2868 5
a2872 5
<li>Si tiene una LAN IP en la que no quiere replicar los
ficheros &quot;hosts&quot; de direcciones locales en cada
m&aacute;quina, puede configurar su m&aacute;quina con OpenBSD
como servidor de DNS y servir los requerimientos de otras
m&aacute;quinas de su LAN.</li>
d2876 20
a2895 22
pr&aacute;ctica al n&uacute;mero de servidores de DNS en una
LAN.  Cualquier m&aacute;quina o todas las de la LAN puede
ofrecer el servicio de DNS si se configuran para ello.  Que
uno de estos servidores se considere autorizado desde fuera de
su LAN (o incluso conocido desde fuera de la LAN), es un
factor de configuraci&oacute;n que suele estar controlado por
el nivel superior inmediato de su LAn en la jerarqu&iacute;a
de dominios.</li>
</ul>

<li>Si tiene una LAN IP en la que residen m&aacute;quinas que
quiera que sean localizables a trav&eacute;s de requerimientos
de DNS por m&aacute;quinas en otra LAN o WAN.</li>

<li>Si tiene dificultades en resolver el nombre de dominio
local a una direcci&oacute;n IP, o resolver cualquier otro
nombre local a direcciones IP aunque tenga los ficheros
<em>/etc/hosts</em> y <em>/etc/resolv.conf</em> correctamente
(v.g., en OpenBSD, Netscape a veces se comporta de este modo
porque implementa su propia herramienta de resoluci&oacute;n,
en lugar de usar <em>gethostbyname(3)</em> para la
b&uacute;squeda de direcciones).</li>
d2899 3
a2901 3
Algo m&aacute;s a tener en cuenta es el velocidad de ejecuci&oacute;n.
Como la resoluci&oacute;n de nombres es un proceso repititivo, en el
que el servidor de nombres lleva a cabo repetidos requerimientos de
d2903 7
a2909 8
resoluci&oacute;n de nombres puede tardar algo m&aacute;s si tiene una
conexi&oacute;n por m&oacute;dem a Internet y est&aacute; requiriendo
direcciones remotas a su propio servidor de DNS (que har&aacute;
continuos requerimientos a servidores de nombres remotos a
trav&eacute;s del m&oacute;dem) que si est&aacute; requiriendo el
servidor de nombres de su ISP (que probablemente tenga una
conexi&oacute;n m&aacute;s r&aacute;pida a los servidores de nombres
remotos).
d2918 1
a2918 1
    jerarqu&iacute;a de <em>/var/named/</em></li>
d2924 3
a2926 3
BIND es el nombre de la especificaci&oacute;n del comportamiento de un
servidor de nombres de dominio.  Los componentes de DNS existen para
implementar BIND de forma colectiva.
d2930 1
a2930 1
Existen tres especificaciones BIND diferentes:
d2939 2
a2940 2
Tal y como queda instalado, OpenBSD <strong>named</strong>
tiene soporte para BIND 4.x.
d2943 2
a2944 2
proveer DNS a trav&eacute;s de la implementaci&oacute;n predefinida de
BIND 4.x?</h4>
d2947 3
a2949 3
<li>La implementaci&oacute;n de BIND 9.x en
<em>/usr/ports/net/bind9</em> (v&eacute;ase la p&aacute;gina
sobre <a href="../../es/ports.html">portes</a>).</li>
d2955 5
a2959 5
Si usa estas implementaciones alternativas del DNS, estar&aacute;
ofreciendo un servicio de red cr&iacute;tico mediante el uso de unos
programas que pueden no haber sido sometidos al mismo nivel de
escrutinio que el d&aelig;mon de <code>name</code> en la
instalaci&oacute;n base, <strong><code>named</code></strong>, el cual
d2961 3
a2963 3
seguridad</a>.  Esta es una consideraci&oacute;n a tener muy en cuenta,
ya que si un servidor de nombres de dominio es puesto en peligro, los
resolucionadores que usen ese servidor de DNS pueden ser
d2967 1
a2967 1
<h3>6.8.4 &iquest;Cu&aacute;nto tengo que instalar?</h3>
d2971 3
a2973 3
correctamente durante la instalaci&oacute;n de OpenBSD, tendr&aacute;
todo ya instalado.  S&oacute;lo tiene que configurar el d&aelig;mon de
name (&quot;named&quot;).
d2976 1
a2976 1
<h3>6.8.5 &iquest;C&oacute;mo configuro DNS?</h3>
d2979 5
a2983 5
Para configurar DNS en OpenBSD, edite y/o cree los ficheros que
controlan el d&aelig;mon de <code>name</code>, <strong>named</strong>.
La ubicaci&oacute;n por definici&oacute;n de estos ficheros es el
directorio <em>/var/named</em> y sus subdirectorios, en especial el
fichero <em>/var/named/named.boot</em> que es el fichero de
d2985 2
a2986 2
un par m&aacute;s de pasos para la configuraci&oacute;n que se deben
llevar a cabo en <em>/etc</em>.
d2990 1
a2990 1
En este documento configuraremos el d&aelig;mon de name en
d3005 2
a3006 1
; tell what subdir has the lookup database files
d3010 1
d3014 1
a3014 1
; example primary server config:
d3029 1
a3029 1
; Reverse lookup for localhost interface
d3045 1
a3045 1
; yewtopia.com domain database
d3054 1
a3054 1
; Addresses
d3066 1
a3066 1
; yewtopia domain reverse lookup database
d3075 1
a3075 1
; Addresses
d3087 4
a3090 5
Aseg&uacute;rese de que <em>/etc/resolv.conf</em> ahora se&ntilde;ale
al dominio de la m&aacute;quina local (en vez de, por ejemplo, el
nombre del servidor de su ISP), de modo que la resoluci&oacute;n del
nombre en requerimientos sea enviada al
<strong>named</strong> que haya configurado.
d3103 3
a3105 3
Si anteriormente hubiera a&ntilde;adido las direcciones de varias
m&aacute;quinas al fichero <em>/etc/hosts</em>, puede que le interese
acortar su fichero <em>/etc/hosts</em> al estado en que se encontraba
d3119 7
a3125 7
direcciones (probablemente caducadas) en el fichero
<em>/etc/hosts</em>.  &iexcl;<u>Aseg&uacute;rese de que tiene al menos
la entrada predefinida de <em>localhost</em></u>, o su red no
iniciar&aacute; correctamente!  Note tambi&eacute;n que <em>nemo</em>
debe aparecer en su propio fichero hosts, o de lo contrario ver&aacute;
un mensaje de error (no da&ntilde;ino) durante el arranque cuando
<em>/etc/netstart</em> invoque
d3167 2
a3168 1
<h3>6.8.6 &iquest;C&oacute;mo y cu&aacute;ndo inicio y paro DNS?</h3>
d3173 2
a3174 2
El d&aelig;mon de name <strong>named</strong> se lanza durante el
inicio del sistema desde
d3177 1
a3177 1
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=rc.conf&sektion=8">/etc/rc.conf</a>.
d3197 2
a3198 1
Examine tambi&eacute;n estas l&iacute;neas en <em>/etc/rc.conf</em>:
d3214 1
a3214 1
Para iniciar <strong>named</strong> de forma manual, use la orden
d3243 2
a3244 2
Si no funcionara, encuentre el id del proceso de <strong>named</strong>
y use la orden
d3246 3
a3248 3
para finalizar el proceso.  El PID para <strong>named</strong> mientras
est&eacute; funcionando se encontrar&aacute; como la primera
l&iacute;nea del fichero <em>/var/named/named.pid</em>.
d3260 2
a3261 2
<h4>6.8.6.3 C&oacute;mo reiniciar DNS con una
configuraci&oacute;n alterada</h4>
d3266 1
a3266 1
hecho cambios, env&iacute;e una se&ntilde;al <em>hangup</em>:
d3276 1
a3276 1
o use la orden
d3307 7
a3313 7
Esta informaci&oacute;n es &uacute;til para depurar DNS, pero en
algunos casos puede que no le interese que esta informaci&oacute;n se
haga p&uacute;blica.  Si est&aacute; usando in-addr(rfc2317) sin clase
para inverso, &iexcl; 'host -' podr&iacute;a informar sobre todos los
dominios hospedados en su sistema!  Esto se puede solucionar
f&aacute;cilmente con la cl&aacute;usula 'allow-transfer' en su fichero
<em>zone</em>.
d3315 3
a3317 3
Si usa Bind8 necesitar&aacute; especificar los anfitriones a los
que quiere permitir la transferencia de zonas en su(s) fichero(s)
individual zone:
d3321 1
a3321 1
zone "foo.com" in {
d3323 1
a3323 1
        file "directory/zonefile";
d3333 1
a3333 1
Tambi&eacute;n puede bloquear las transferencias para todos los
d3347 3
a3349 2
Si est&aacute; usando Bind 4 (predefinido en OpenBSD), puede editar
<em>/var/named/named.boot</em> y usar la opci&oacute;n 'xfrnets'.<br>
d3360 7
a3366 8
Bind 4 permite transferencias desde clases enteras, por lo que no es
tan exacto.  Generalmente, los &uacute;nicos anfitriones que
necesitan llevar a cabo transferencias son los esclavos y
anfitriones de DNS desde los que quiera depurar (127.0.0.1 es
normalmente un buen anfitri&oacute;n desde donde permitir
transferencias).  El bloqueo de requerimientos AXFR a&ntilde;ade un
nivel adicional de privacidad, pero puede entorpecer el &uacute;til
depurado de DNS (gracias a 
d3372 2
a3373 2
<h3>6.8.7 &iquest;Qu&eacute; ha quedado en el tintero sobre la
configuraci&oacute;n de DNS?</h3>
d3376 1
a3376 1
Hay muchas cosas de las que no hemos hablado, como por ejemplo,
d3379 3
a3381 3
jerarqu&iacute;a del dominio dependan de servidores dentro de su
empresa.  Lea los <a href="#DNS.1.1">documentos que le recomendamos</a>
para m&aacute;s informaci&oacute;n sobre DNS.
d3393 4
a3396 4
<strong>TODOS</strong> los proveedores de conexiones ADSL, pero mucha
de la informaci&oacute;n que encontrar&aacute; aqu&iacute; se puede
usar como base.  Esta informaci&oacute;n s&oacute;lo se ha comprobado
con <a href="http://www.inode.at">Inode</a>, un proveedor de ADSL en
d3401 6
a3406 5
Antes que nada debe instalar <em>pptp</em>.  El porte de
<em>pptp</em> se encuentra en <em>/usr/ports/net/pptp</em>.
Puede encontrar m&aacute;s informaci&oacute;n sobre el
&aacute;rbol de portes de OpenBSD en la
<a href="faq8.html#Ports">secci&oacute;n 8</a>.
d3412 2
a3413 2
y pptp, tendr&aacute; que recompilar el n&uacute;cleo del sistema,
eliminando el soporte de gre(4).
d3416 1
a3416 1
<ul>Parche para eliminar el soporte de GRE(4).
d3438 7
a3444 6
Para recompilar el n&uacute;cleo, obtenga antes el
c&oacute;digo fuente de OpenBSD mediante cvs (v&eacute;ase la
p&aacute;gina de <a href="../../es/anoncvs.html">AnonCVS</a>
para m&aacute;s informaci&oacute;n), aplique el parche
siguiente, y recompile el n&uacute;cleo tal y como se indica
en la <a href="faq5.html#Building">secci&oacute;n 5.3</a>.
d3448 3
a3450 4
Una vez que ya tenga instalado el paquete
<strong>pptp</strong> y el nuevo n&uacute;cleo, deber&aacute;
editar unos cuantos ficheros para configurar su
conexi&oacute;n.  Este paquete utiliza el programa de
d3452 4
a3455 4
nativo de OpenBSD;  si est&aacute; familiarizado con ppp(8),
gran parte de la configuraci&oacute;n es id&eacute;ntica.  Lea
tambi&eacute;n la secci&oacute;n sobre <a href="#PPP">PPP</a>
de este documento.
d3464 2
a3465 2
Para el fichero <em>/etc/ppp/options</em>, una configuraci&oacute;n
como la siguiente ser&aacute; probablemente todo lo que necesite:
d3480 1
a3480 1
Debe substituir <tt>LOGINNAME</tt> con su identificador de usuario.
d3484 1
a3484 1
Para el fichero <em>/etc/ppp/pap-secrets</em> necesitar&aacute; una
d3495 5
a3499 5
En donde LOGINNAME es su identificador de usuario y PASSWORD su
contrase&ntilde;a.  10.0.0.138 es la direcci&oacute;n IP asignada a su
modem en caso de que use ADSL, etc.  Aseg&uacute;rese de que este
fichero sea de &laquo;s&oacute;lo lectura&raquo; para el usuario
&quot;root&quot; (modo 600).
d3502 1
a3502 1
<h3>6.9.1 - Asignaci&oacute;n de una direcci&oacute;n a su interfaz de
d3506 1
a3506 1
En el ejemplo anterior, el modem ven&iacute;a con una interfaz
d3509 6
a3514 5
una direcci&oacute;n IP cercana a la asignada para el MODEM, o
usar la direcci&oacute;n IP est&aacute;tica que nos hayan
asignado.  Puede leer m&aacute;s sobre c&oacute;mo configurar
interfaces en la secci&oacute;n sobre
<a href="#Setup">configuraci&oacute;n</a> en este documento.
d3518 2
a3519 2
Una vez que haya configurado su interfaz, deber&iacute;a poder
establecer una conexi&oacute;n pptp con la orden:
d3528 3
a3530 3
Como ya hemos dicho, usar&aacute; el ppp(8) nativo de OpenBSD, e
iniciar&aacute; dos procesos;  en consecuencia, podr&aacute; matar pptp
matando estos dos procesos:
d3541 1
a3541 1
terminal aparte, para poder reconoce cualquier posible problema.
d3551 3
a3553 3
Tambi&eacute;n le sugerimos que ponga la orden de inicio en
<em>/etc/rc.local</em> para que conecte de forma autom&aacute;tica
cuando reinicie el sistema.
d3573 1
a3573 1
$Translation: faq6.html,v 1.61 2002/06/05 21:43:51 horacio Exp $<br>
@


1.49
log
@
sync with badlands translation CVS
@
text
@d21 1
a21 1
<ul><h3>Tabla de contenidos</h3>
d23 8
a30 1
<li><a href="#Setup">6.1 - Configuraci&oacute;n inicial de la
a31 9
<li><a href="#PF">6.2 - Sistema de filtro de paquetes IP
(PF)</a>
<li><a href="#NAT">6.3 - Traducci&oacute;n de direcciones de
red (NAT)</a>
<li><a href="#DHCP">6.4 - Protocolo de configuraci&oacute;n
para anfitriones din&aacute;micos (DHCP)</a>
<li><a href="#PPP">6.5 - Protocolo Punto a Punto (PPP)</a>
<li><a href="#Tuning">6.6 - C&oacute;mo afinar los
par&aacute;metros de red</a>
d33 4
a36 4
<li><a href= "#DNS">6.8 - Servicio de Nombres de Dominio  -
DNS, BIND, y named</a>
<li><a href="#PPTP">6.9 - Configuraci&oacute;n de una
conexi&oacute;n PPTP en OpenBSD</a>
d50 2
a51 2
ser&aacute; de gran ayuda que haya leido y, por lo menos,
asimilado en parte el cap&iacute;tulo
d54 2
a55 3
de las Preguntas Frecuentes, y las p&aacute;ginas de manual
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=ifconfig&sektion=8">ifconfig(8)</a>
y
d59 4
a62 5
Si es Vd. un administrador de redes y est&aacute; configurando
protocolos de enrutamiento, si est&aacute; usando su sistema
OpenBSD como un enrutador, si necesita conocer m&aacute;s a
fondo los protocolos de redes IP, entonces es realmente
necesario que lea
d66 2
a67 2
&iexcl;&Eacute;ste es un excelente documento que contiene
conocimientos fundamentales sobre redes de IP!
d70 4
a73 4
Si est&aacute; trabajando con aplicaciones como servidores de
http, servidores de ftp, y servidores de correo, se puede
beneficiar en gran medida de la lectura de los
<a href="http://the.rfceditor.org/rfc.html">RFC</a>.
d76 2
a77 3
<em>(Nota: existe un proyecto de traducci&oacute;n de
documentos RFC al castellano,
<a href="http://www.rfc-es.org/">RFC-ES</a>)</em>
d80 7
a86 5
Lo m&aacute;s seguro es que no los pueda leer todos.  Seleccione
algunos temas que le interesen, o que use en su entorno de red.
L&eacute;alos y averig&uuml;e c&oacute;mo deber&iacute;an funcionar.
Los RFC definen much&iacute;simas (miles) de las normas para protocolos
en internet y c&oacute;mo se supone que deben funcionar.
d97 2
a98 2
<h3>6.1.1 - Idenficaci&oacute;n y configuraci&oacute;n de la
interfaces de red</h3>
d102 5
a106 5
Lo primero que debe hacer para empezar es identificar su
interfaz de red.  En OpenBSD las interfaces se designan por el
tipo de tarjeta, no por el tipo de conexi&oacute;n.  Puede ver
su tarjeta de red iniciar durante el arranque, o
despu&eacute;s del arranque usando la orden
d108 1
a108 1
Tambi&eacute;n puede ver su interfaz de red usando la orden
d110 3
a112 3
Por ejemplo, vea a continuaci&oacute;n la salida originada por
dmesg para una tarjeta de red Intel Fast Ethernet, que usa el
nombre de dispositivo fxp.
d123 8
a130 9
Si no sabe cu&aacute;l es el nombre de su dispositivo,
b&uacute;squelo en la <a href="../../es/plat.html">lista de hardware
con soporte</a> de la plataforma correspondiente.
Encontrar&aacute; una lista de muchos nombres de tarjetas
comunes y sus nombres de dispositivo en OpenBSD.  Combine el
nombre abreviado alfab&eacute;tico (como fxp) con un
n&uacute;mero asignado por el n&uacute;cleo del sistema y
obtendr&aacute; el nombre de la interfaz (como fxp0).
tiene una lista de tarjetas comunes con sus nombres de dispositivo.
d134 2
a135 2
Puede averiguar qu&eacute; interfaces de red han sido
identificadas usando la utilidad 
d137 2
a138 2
La orden siguiente mostrar&aacute; todas las interfaces de red
en un sistema.  Esta salida muestra s&oacute;lo una interfaz
d177 1
a177 1
Como habr&aacute; podido comprobar, 
d182 5
a186 5
est&aacute; configurada.  Esto es obvio porque ya hay una red
IP configurada en fxp0, y de aqu&iacute; los valores
&quot;inet 10.0.0.38 netmask 0xffffff00 broadcast 10.0.0.255&quot;.
Adem&aacute;s, los indicadores <strong>UP</strong> y
<strong>RUNNING</strong> est&aacute;n activados.
d190 4
a193 4
Finalmente, notar&aacute; que otras cuantas interfaces se
encuentran activadas de forma predeterminada.  &Eacute;stas
son interfaces virtuales que tienen varias funciones.  Las
siguientes p&aacute;ginas del manual las describen:
d197 10
a206 10
<li><a href="http://www.openbsd.org/cgi-bin/man.cgi?query=lo&sektion=4">lo</a> - Interfaz de circuito cerrado (<em>loopback</em>)
<li><a href="http://www.openbsd.org/cgi-bin/man.cgi?query=pflog&sektion=4">pflog</a> - Interfaz de registro del paquete de filtros (<em>PF</em>)
<li><a href="http://www.openbsd.org/cgi-bin/man.cgi?query=sl&sektion=4">sl</a> - Interfaz de red SLIP
<li><a href="http://www.openbsd.org/cgi-bin/man.cgi?query=ppp&sektion=4">ppp</a> - Protocolo punto a punto (PPP)
<li><a href="http://www.openbsd.org/cgi-bin/man.cgi?query=tun&sektion=4">tun</a> - Interfaz de red por t&uacute;nel
<li><a href="http://www.openbsd.org/cgi-bin/man.cgi?query=enc&sektion=4">enc</a> - Interfaz de encapsulamiento
<li><a href="http://www.openbsd.org/cgi-bin/man.cgi?query=bridge&sektion=4">bridge</a> - Interfaz de puente Ethernet
<li><a href="http://www.openbsd.org/cgi-bin/man.cgi?query=vlan&sektion=4">vlan</a> - Interfaz de encapsulaci&oacute;n IEEE 802.1Q
<li><a href="http://www.openbsd.org/cgi-bin/man.cgi?query=gre&sektion=4">gre</a> - Interfaz de encapsulaci&oacute;n GRE/MobileIP
<li><a href="http://www.openbsd.org/cgi-bin/man.cgi?query=gif&sektion=4">gif</a> - Interfaz de t&uacute;nel IPv4/IPv6 gen&eacute;rica
d210 6
a215 8
Si su interfaz no ha sido configurada, el primer paso
ser&aacute; crear el fichero
<strong>/etc/hostname.xxx</strong>, donde el nombre de su
interfaz substituir&aacute; xxx.  De acuerdo con la
informaci&oacute;n de los ejemplos anteriores, el nombre
ser&iacute;a <strong>/etc/hostname.fxp0</strong>.  La
composici&oacute;n de este fichero es as&iacute; de
sencilla:<br>
d225 3
a227 3
(Para leer m&aacute;s sobre el formato de este fichero, tome
como referencia la p&aacute;gina de manual
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=hostname.if&sektion=5&format=html">hostname.if(5)</a>)
d231 3
a233 3
El fichero de configuraci&oacute;n de una interfaz
t&iacute;pica, configurada para una direcci&oacute;n de IPv4,
ser&iacute;a como el siguiente:
d244 3
a246 3
Tambi&eacute;n podr&iacute;a especificar tipos de media para
Ethernet, por ejemplo, si quisiera forza el modo 100baseTX
full-duplex.
d254 4
a257 5
Aunque nunca debe forzar el modo <em>full duplex</em> a menos
que ambas partes de la conexi&oacute;n est&eacute;n
configuradas para hacerlo.  A menos que sea necesario por
alg&uacute;n motivo especial, la configuraci&oacute;n del tipo
de media se debe excluir.
d261 3
a263 3
O puede que quiera usar indicadores especiales para
especificar una cierta interfaz.  &iexcl;El formato del
fichero <em>hostname</em> no cambia mucho!
d272 9
a280 9
El siguiente paso ser&aacute; la configuraci&oacute;n de su
pasarela.  Para ello basta con que ponga el IP de su pasarela
en el fichero <strong>/etc/mygate</strong>.  Esto
permitir&aacute; que su pasarela se active en el momento del
arranque.  A continuaci&oacute;n deber&aacute; configurar sus
nombres de servidores (<em>nameservers</em>) y su fichero
<strong>/etc/hosts</strong> (mire la p&aacute;gina del manual
de <a href="http://www.openbsd.org/cgi-bin/man.cgi?query=hosts&sektion=5">hosts(5)</a>).
Para configurar sus nombres de servidores debe crear un
d282 2
a283 2
Puede leer m&aacute;s sobre el formato de este fichero en la
p&aacute;gina del manual de
d285 3
a287 4
El siguiente ejemplo es para un uso t&iacute;pico.  En este
ejemplo sus servidores de dominio son 125.2.3.4 y 125.2.3.5.
Tambi&eacute;n pertenece al dominio
&laquo;sudominio.dom&raquo;.
d301 3
a303 4
Desde este punto ya puede reiniciar o bien ejecutar el
gui&oacute;n de configuraci&oacute;n
<strong>/etc/netstart</strong>.  Puede hacerlo ejecutando
(como root):
d317 10
a326 10
F&iacute;jese en que se produce un peque&ntilde;o
n&uacute;mero de errores.  Pero al ejecutar este gui&oacute;n
(<em>script</em>), reconfingurar&aacute; cosas que ya
hab&iacute;a configurado anteriormente.  De hecho, algunas
rutas ya existen en la tabla de enrutamiento del n&uacute;cleo
del sistema.  Desde aqu&iacute; el sistema deber&iacute;a
funcionar con normalidad.  Puede hacer una comprobaci&oacute;n
con <a href="http://www.openbsd.org/cgi-bin/man.cgi?query=ifconfig&sektion=8">ifconfig(8)</a>
para asegurarse de que su interfaz se configur&oacute;
correctamente.  Tambi&eacute;n puede comprobar sus rutas con
d328 2
a329 2
A continuaci&oacute;n puede ver un ejemplo de c&oacute;mo ver
sus tablas de rutas usando ambas herramientas.
d368 2
a369 2
<h3>6.1.2 - Configuraci&oacute;n del sistema OpenBSD como
pasarela (<em>gateway</em>)</h3>
d373 13
a385 14
&Eacute;sta es la informaci&oacute;n b&aacute;sica que
necesita para configurar su sistema OpenBSD como una pasarela
(tambi&eacute;n llamada &laquo;enrutador&raquo; o
&laquo;encaminador&raquo;).  Si piensa usar OpenBSD como un
enrutador en Internet, le sugerimos que lea tambi&eacute;n la
secci&oacute;n con las instrucciones sobre la
configuraci&oacute;n de Filtros de paquetes IP (PF), para
bloquear tr&aacute;fico potencialmente malicioso.
Adem&aacute;s, debido a la escasa disponibilidad de
direcciones <a href="http://www.openbsd.org/cgi-bin/man.cgi?query=ip&sektion=4">IPv4</a> en los proveedores de servicios de redes y
registros regionales, es conveniente leer la secci&oacute;n
sobre traducci&oacute;n de direcciones de red (NAT) para
informaci&oacute;n sobre c&oacute;mo conservar su espacio de
direcci&oacute;n IP.
d389 5
a393 4
El n&uacute;cleo GENERIC posee la capacidad de permitir IP
Forwarding, pero debe ser activado.  Para ello debe usar la
utilidad <a href="http://www.openbsd.org/cgi-bin/man.cgi?query=sysctl&sektion=8">sysctl(8)</a>.
Para que los cambios sean permanentes, debe editar el fichero
d395 2
a396 2
para activar IP Forwarding.  Esto lo puede llevar a cabo
a&ntilde;adiendo la siguiente l&iacute;nea en ese fichero de
d407 2
a408 2
Para que este cambio surja efecto sin tener que reiniciar el
sistema, use directamente la utilidad
d410 3
a412 3
Recuerde que este cambio todav&iacute;a no existir&aacute;
despu&eacute;s de reiniciar, y que necesitar&aacute; ser
ejecutado como root.
d423 3
a425 3
A continuaci&oacute;n modifique las rutas en los otros
anfitriones de ambos lados.  OpenBSD ofrece muchas
posibilidades de uso como enrutador, usando software como 
d427 1
a427 3
<a href="http://www.gated.org">gated</a>, 
<a href="http://www.mrtd.net">mrtd</a> y 
<a href="http://www.zebra.org">zebra</a>.
d429 3
a431 3
colecci&oacute;n de portes.  OpenBSD incluye soporte para
varias interfaces T1, HSSI, ATM, FDDI, Ethernet, e interfaces
de serie (PPP/SLIP).
d441 3
a443 3
OpenBSD dispone de un simple mecanismo para configurar los
alias de ip en una interfaz.  Para ellos s&oacute;lo tiene que
editar el fichero
d447 5
a451 6
que forma parte de la
<a href="faq10.html#rc">jerarqu&iacute;a de inicio rc</a>,
leer&aacute; este fichero durante el proceso de inicio del
sistema.  Por ejemplo, supongamos que el usuario tiene una
interfaz <strong>dc0</strong> y pertenece a la red
192.168.0.0.  Otra informaci&oacute;n de importancia:
d461 2
a462 2
la interfaz; no existen diferencias entre el primer alias y el segundo,
por lo tanto, a diferencia de otros sistemas operativos, en OpenBSD no
d465 4
a468 4
est&aacute; a&ntilde;adiendo un alias, aseg&uacute;rese de decir
'<kbd>ifconfig int alias</kbd>' en lugar de '<kbd>ifconfig int</kbd>'
en la l&iacute;nea de &oacute;rdenes.  Puede eliminar los alias con
'<kbd>ifconfig int delete</kbd>'.
d472 8
a479 8
Asumiendo que est&eacute; usando direcciones de IP m&uacute;ltiples que
est&eacute;n en la misma subred IP con alias, la configuraci&oacute;n
de su enmascaramiento de red (&quot;netmask&quot;) para cada alias pasa
a ser 255.255.255.255.  No necesitan seguir el netmask del primer IP
ligado a la interfaz.  En el siguiente <em>/etc/hostname.dc0</em> de
ejemplo, se a&ntilde;aden dos alias al dispositivo
<strong>dc0</strong>, el cual, por cierto, se configur&oacute; como
192.168.0.2 netmask 255.255.255.0.
d492 3
a494 3
Una vez que haya configurado este fichero ser&aacute; necesario
reiniciar para que los cambios funcionen.  Sin embargo, puede hacer
efectivos los alias a mano, usando la utilidad
d496 1
a496 1
Para hacer efectivo el primer alias use la orden:
d506 1
a506 1
Para ver estos alias debe usar la orden:
d528 5
a532 5
<h5>Nota: &quot;<em>Packet Filter</em>&quot; (&laquo;filtro de
paquetes IP&raquo;) es el sistema de filtrado para OpenBSD 3.0
y versiones posteriores.  Si busca las preguntas frecuents
sobre IPF/IPNAT para OpenBSD 2.9 y versiones anteriores, pulse
sobre <a href="faqipf.html">enlace</a>.</h5>
d534 1
d536 7
a542 7
El subsistema de Filtro de paquetes IP fue creado con el fin
de gestionar dos tareas:  tratar con los permisos de
reenv&iacute;o a nivel de paquetes IP, y asignar
anfitriones/subredes a un rango de direcciones externas.  Los
ficheros de configuraci&oacute;n para estos dos servicios son
<em><a href="http://www.openbsd.org/cgi-bin/man.cgi?query=pf.conf&sektion=5">/etc/pf.conf(5)</a></em> y
<em><a href="http://www.openbsd.org/cgi-bin/man.cgi?query=nat.conf&sektion=5">/etc/nat.conf(5)</a></em>.
d546 3
a548 2
Para iniciar estos servicios con su sistema, antes debe editar
el fichero <em><a href="http://www.openbsd.org/cgi-bin/man.cgi?query=rc.conf&sektion=8">/etc/rc.conf(8)</a></em>
d559 1
a559 1
Si no va a usar NAT, es probable que tambi&eacute;n tenga que
d562 2
a563 2
<tt>net.inet.ip.forwarding</tt>, a 1.  Para ello debe activar
las l&iacute;neas relevantes en
d565 1
a565 1
y reiniciar su m&aacute;quina.
d569 1
a569 1
Si tiene PF compilado en su n&uacute;cleo pero no lo ha
d572 1
a572 1
lo puede activar f&aacute;cilmente con la orden
d586 5
a590 6
<em>/etc/pf.conf</em>, y la segunda configura la
traducci&oacute;n de direcciones usando <em>/etc/nat.conf</em>
(m&aacute;s informaci&oacute;n sobre la traducci&oacute;n de
direcciones IP en <a href="#NAT">secci&oacute;n 6.3
(NAT)</a>), y finalmente, la &uacute;ltima l&iacute;nea activa
PF.
d593 2
a594 2
Esto tambi&eacute;n se puece combinar en una sola l&iacute;nea
de &oacute;rdenes:
d603 2
a604 2
Si hace alg&uacute;n cambio en <em>/etc/pf.conf</em>
despu&eacute;s de haber iniciado PF, puede volver a cargar sus
d619 6
a624 8
Puede ver el ejemplo de <a href="#sample_pf.conf">juego de
reglas resultante</a> que incluye todos los cambios que se
explican a continuaci&oacute;n en detalle.  Tambi&eacute;n
puede encontrar m&aacute;s informaci&oacute;n sobre el filtro
de paquetes PF en las
<a href="http://www.benzedrine.cx/pf.html">p&aacute;ginas de
PF</a> y en el documento
<a href="http://www.inebriated.demon.nl/pf-howto/">Packet
d633 6
a638 6
Para activar PF en el momento del inicio del sistema, necesita
modificar <em>/etc/rc.conf</em> de modo que lea
<tt>pf=YES</tt>.  El filtro de paquetes IP (PF) est&aacute;
controlado por el fichero <em>/etc/pf.conf</em>, que se
leer&aacute; durante el inicio.  Para una explicaci&oacute;n
m&aacute;s detallada lea la p&aacute;gina de manual
d640 5
a644 6
En los siguientes ejemplos, <em>fxp0</em> representa la
interfaz externa a Internet.  En su caso puede ser diferente,
dependiendo del adaptador de ethernet de que disponga en su
m&aacute;quina.  En estas reglas se asumir&aacute; que existe
una conexi&oacute;n permanente a Internet, del mismo tipo que
la de un servidor de <em>web</em>.
d648 3
a650 4
Las reglas de PF se procesan de modo secuencial desde el
principio hasta el final, siendo de ayuda para visualizar cada
paquete que tenga que atravesar cada regla antes de alcanzar
su destino.
d654 2
a655 2
Por ejemplo, el grupo de reglas predefinido permite que entren
y salgan todos los paquetes:
d673 5
a677 6
y que se puede leer como &laquo;dejar pasar los paquetes
entrantes procedentes de cualquier parte y con cualquier
destino&raquo;, y que implica &laquo;en cualquier interfaz
(siempre impl&iacute;cito si no se especifica una interfaz) de
cualquier familia de direcciones, 
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=inet&sektion=4">inet (v4)</a> o <a href="http://www.openbsd.org/cgi-bin/man.cgi?query=inet6&sektion=4">inet6 (v6)</a>&quot;.
d681 5
a685 6
L&oacute;gicamente, estas reglas no representan un buen
ejemplo de filtro.  Un filtrado m&aacute;s &uacute;til
estar&aacute; basado en la familia de direcciones (IPv4
&oacute; IPv6), los protocolos y los puertos usados por los
servicios que desea filtrar.  Se puede especificar cualquiera
de los protocolos que aparecen en la lista de
d687 2
a688 2
bien por su nombre o su n&uacute;mero, pero nosotros
s&oacute;lo abordaremos
d695 4
a698 5
Supongamos ahora que no queremos permitir ninguna
conexi&oacute;n IPv4 entrante por el puerto TCP 3306 (MySQL)
porque la base de datos s&oacute;lo deber&iacute;a permitir la
conexi&oacute;n de forma local.  En este caso el grupo de
reglas ser&iacute;a as&iacute;:
d709 5
a713 6
Que traducido viene a decir lo siguiente: &laquo;bloquear
todos los paquetes IPv4 entrantes procedentes cualquier sitio
y con destino a cualquier sitio, por el puerto tcp
3306&raquo;.  N&oacute;tese que se debe especificar un
protocolo con cada filtro basado en puertos, y se recomienda
que se indique al familia de direcciones a la que pertenece.
d716 6
a721 7
tambi&eacute;n se puede usar los nombres del servicio, como
por ejemplo <em>www</em> o <em>mysql</em>.  Un paquete con
destino al puerto tcp 3306 en una interfaz <em>fxp0</em>,
pasar&aacute; la primer regla &quot;pass in&quot;, y a
continuaci&oacute;n ser&aacute; bloqueado por la regla
&quot;block in port 3306&quot;.  Si invirtiera el orden de
sus reglas entrantes (recuerde que el orden es importante):
d731 4
a734 5
los paquetes con destino al puerto tcp 3306 pasar&iacute;an
debido a que la &uacute;ltima regla en el grupo permite que
pasen todos los paquetes.  Cuando est&eacute; escribiendo
reglas para el filtrado de paquetes es importante que tenga en
cuenta lo siguiente: <strong>La &uacute;ltima regla que
d739 5
a743 5
Por supuesto que existen excepciones para toda regla.  La
opci&oacute;n <em>quick</em> filtra el paquete en la primera
regla que concuerde.  Veamos el defectuoso ejemplo anterior,
a&ntilde;adi&eacute;ndole la opci&oacute;n <em>quick</em> a la
regla &quot;block in&quot;:
d2550 1
a2550 1
en una red.  Algunas p&aacute;ginas de manual que
d3101 1
a3101 2
@@       IN      SOA     nemo.yewtopia.com.
your_id.nemo.yewtopia.com.  (
d3117 1
a3117 2
yewtopia.com.        IN      SOA     nemo.yewtopia.com.
your_id.nemo.yewtopia.com.  (
d3138 1
a3138 2
1.168.192.in-addr.arpa. IN      SOA     nemo.yewtopia.com.
your_id.nemo.yewtopia.com.  (
d3209 1
a3209 1
$ <strong>dig @@nemo.yewtopia yewtopia any any</strong>
d3218 1
a3218 1
;;      yewtopia, type = ANY, class = ANY
d3221 1
a3221 2
yewtopia.        3600   SOA     nemo.yewtopia.
your_id.nemo.yewtopia. (
d3227 1
a3227 1
yewtopia.        3600   NS      nemo.yewtopia.
d3230 1
a3230 1
nemo.yewtopia.   3600   A       192.168.1.9
d3233 1
a3233 1
;; FROM: nemo to SERVER: nemo.yewtopia.  192.168.1.9
d3640 2
a3641 2
Originally [OpenBSD: faq6.html,v 1.133 2002/05/23 13:10:11 dhartmei Exp ]<br>
$Translation: faq6.html,v 1.60 2002/05/24 18:58:04 horacio Exp $<br>
@


1.48
log
@
sync with badlands translation CVS
@
text
@d807 1
a807 1
block in on fxp0 from all
d811 1
a811 1
pass out on fxp0 from all
d828 1
a828 1
block in on fxp0 from all
d832 1
a832 1
pass out on fxp0 from all
d3665 2
a3666 2
Originally [OpenBSD: faq6.html,v 1.132 2002/05/20 01:03:28 nick Exp ]<br>
$Translation: faq6.html,v 1.59 2002/05/20 23:57:20 horacio Exp $<br>
@


1.47
log
@
sync with badlands translation CVS
@
text
@a137 18
Nota sobre actualizaci&oacute;n desde versiones antiguas de
OpenBSD:  Los controladores de Ethernet antiguos son, en
ocasiones, reemplazadospor otros m&aacute;s nuevos, y es
probable que el nombre de la interfaz cambie al mismo tiempo.
Por ejemplo, despu&eacute;s de OpenBSD 2.6, los controladores
<em>mx</em>, <em>al</em>, <em>ax</em> y <em>pn</em> fueron
substituidos por el controlador <em>dc</em>.  En consecuencia,
cualquier referencia en <em>/etc/dhcpd.interfaces</em>, en
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=pf.conf&sektion=5">/etc/pf.conf(5)</a> o en
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=nat.conf&sektion=5">/etc/nat.conf(5)</a>,
debe cambiarse con el nuevo nombre de la interfaz.
Adem&aacute;s, se debe cambiar el nombre de cualquier fichero
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=hostname.if&sektion=5">/etc/hostname.xxx</a>
en consecuencia (<em>xxx</em> representa el nombre y
n&uacute;mero de la interfaz).
</p>

<p>
a450 3
<strong>&iexcl;Desde la versi&oacute;n 2.8, ya <em>/etc/ifaliases</em>
no se usa!</strong>

a1214 5
# permitir la conexi&oacute;n por ssh s&oacute;lo las
# m&aacute;quinas en la red interna
pass in on fxp0 inet proto tcp from 1.1.1.0/24 to any port 22 \
	flags S/SA keep state

a1329 5
# permitir s&oacute;lo a nuestras m&aacute;quinas la
# conexi&oacute;n por ssh
pass  in on $ExtIF inet proto tcp from $IntNet to any port 22 \
	flags S/SA keep state

a2357 12
<strong>AVISO</strong> - En OpenBSD 2.6, el sistema se
lanz&oacute; con un fichero <em>/etc/ppp/ppp.conf.example</em>
que conten&iacute;a una configuraci&oacute;n err&oacute;nea
para el dispositivo.  El dispositivo era <strong>&quot;set
device /dev/cuaa0&quot;</strong> cuando en realidad
deb&iacute;a ser <em>/dev/cua00</em>, que corresponde al
dispositivo para el puerto de comunicaciones 1 (COM1).  Su
dispositivo podr&iacute;a no estar en COM1, a&uacute;n
as&iacute; este esquema era err&oacute;neo.
</p>

<p>
d3496 5
a3500 8
Antes que nada debe instalar pptp.  Existe un porte de pptp en
el &aacute;rbol de portes de OpenBSD que fue a&ntilde;adido A
PARTIR de la versi&oacute;n 2.8 de OpenBSD, y que se instala y
funciona bien desde el mismo &aacute;rbol.  Lo puede encontrar
en <em>/usr/ports/net/pptp</em>.  Para m&aacute;s
informaci&oacute;n sobre el &aacute;rbol de portes de OpenBSD,
lea la secci&oacute;n sobre los <a href="faq8.html#Ports">portes
del cap&iacute;tulo 8</a>.
d3512 1
a3512 1
Index: sys/conf/GENERIC
d3515 13
a3527 12
retrieving revision 1.66
diff -u -r1.66 GENERIC
--- sys/conf/GENERIC    2000/10/13 04:21:14     1.66
+++ sys/conf/GENERIC    2000/12/26 19:55:31
@@@@ -97,6 +97,6 @@@@
 pseudo-device  ksyms   1	# kernel symbols device
 pseudo-device  bridge  2	# network bridging support
 #pseudo-device vlan    2	# IEEE 802.1Q VLAN
-pseudo-device  gre     1	# GRE encapsulation interface
+#pseudo-device gre     1	# GRE encapsulation interface

 option		BOOT_CONFIG     # add support for boot -c
d3532 6
a3537 9
Para recompilar el n&uacute;cleo, obtenga antes la
distribuci&oacute;n 2.8-stable de OpenBSD mediante cvs (lea la
p&aacute;gina de <a href="../../es/stable.html">OpenBSD
Stable</a> para m&aacute;s informaci&oacute;n), aplicar el
parche anterior al fichero de configuraci&oacute;n del
n&uacute;cleo, <em>GENERIC</em>, y recompilar el n&uacute;cleo
tal y como se describe en la secci&oacute;n sobre la
<a href="faq5.html#Building">compilaci&oacute;n de
n&uacute;cleos</a> del cap&iacute;tulo 5.
d3665 2
a3666 2
Originally [OpenBSD: faq6.html,v 1.131 2002/04/30 13:02:47 nick Exp ]<br>
$Translation: faq6.html,v 1.58 2002/04/30 22:01:16 horacio Exp $<br>
@


1.46
log
@
sync with badlands translation CVS
@
text
@d1567 1
a1567 1
Cada nodo en Interner requiere una direcci&oacute;n IP
d2225 5
a2229 4
Sea cual fuere el modo en que inicie dhclient, puede
<strong>evitar</strong> que se actualice su DNS de acuerdo con
la idea que tenga el servidor dhcp sobre la DNS, comentando
las l&iacute;neas precedidas por 'request' (son ejemplos de la
d2231 1
a2231 1
para anular la configuraci&oacute;n predefinida de dhclient)
d3713 2
a3714 2
Originally [OpenBSD: faq6.html,v 1.130 2002/04/15 19:24:34 jufi Exp ]<br>
$Translation: faq6.html,v 1.57 2002/04/17 14:13:55 horacio Exp $<br>
@


1.45
log
@
sync with badlands translation CVS
@
text
@d3712 2
a3713 2
Originally [OpenBSD: faq6.html,v 1.129 2002/03/27 08:54:17 mpech Exp ]<br>
$Translation: faq6.html,v 1.56 2002/03/30 13:12:17 horacio Exp $<br>
@


1.44
log
@
sync with badlands translation CVS
@
text
@d25 2
a26 1
<li><a href="#PF">6.2 - Filtro de paquetes IP (PF)</a>
d557 1
a557 1
<h2>6.2 - Filtro de paquetes IP (PF)</h2>
d3713 1
a3713 1
$Translation: faq6.html,v 1.55 2002/03/29 10:02:50 horacio Exp $<br>
@


1.43
log
@
sync with badlands translation CVS
@
text
@d5 1
d3712 1
a3712 1
$Translation: faq6.html,v 1.54 2002/03/27 10:50:00 horacio Exp $<br>
@


1.42
log
@
broken links
@
text
@d1968 1
a1968 1
8081 stream tcp nowait root /usr/libexec/ftp-proxy ftp-proxy
d3710 2
a3711 2
Originally [OpenBSD: faq6.html,v 1.128 2002/03/20 03:54:33 nick Exp ]<br>
$Translation: faq6.html,v 1.53 2002/03/23 09:49:47 jufi Exp $<br>
@


1.41
log
@
sync with badlands translation CVS.
@
text
@d125 1
a125 1
b&uacute;squelo en la <a href="../plat.html">lista de hardware
d3711 1
a3711 1
$Translation: faq6.html,v 1.52 2002/03/20 10:07:10 horacio Exp $<br>
@


1.40
log
@
sync with badlands translation CVS
@
text
@d890 1
a890 1
block out quick on fxp0 inet from any to { 127.0.0.1/8, 192.168.0.0/16, \ 
d902 1
a902 1
block out quick on fxp0 inet from any to { 127.0.0.1/8, 192.168.0.0/16, \
d1150 5
a1154 5
regla &quot;pass out&quot;, puede permitir el paso de
paquetes que sean una respuesta a conexiones que Vd. haya
iniciado previamente, como por ejemplo al navegar por la
web.  Recuerde que es necesario especificar para qu&eacute;
protocolo estamos manteniendo el estado.
d1226 1
a1226 1
block out quick on fxp0 inet from any to { 127.0.0.1/8, 192.168.0.0/16, \
d1297 1
a1297 1
block out quick on fxp0 inet from any to { 127.0.0.1/8, 192.168.0.0/16, \
d1316 1
a1316 1
NoRouteIPs=&quot;{ 127.0.0.1/8, 192.168.0.0/16, 172.16.0.0/12, 10.0.0.0/8 }&quot;
d1338 1
a1338 1
NoRouteIPs=&quot;{ 127.0.0.1/8, 192.168.0.0/16, 172.16.0.0/12, 10.0.0.0/8 }&quot;
d2280 3
a2282 2
Si quiere iniciar dhcpd desde la l&iacute;nea de &oacute;rdenes,
despu&eacute;s de editar <em>/etc/dhcpd.conf</em> intente lo siguiente:
d2288 3
a2290 2
En donde fxp0 es la interfaz que Vd. desea que empiece a servir dhcp.
El indicador -q fuerza dhcpd en silencio, de otro modo es muy ruidoso.
d2293 5
a2297 4
Si est&aacute; actuando como servidor de DHCP para una m&aacute;quina
Windows, es posible que quiera que dhcp ofrezca al cliente una
direcci&oacute;n de servidor 'WINS'.  Para ello a&ntilde;ada la
siguiente l&iacute;nea al fichero <em>/etc/dhcpd.conf</em>:
d3710 2
a3711 2
Originally [OpenBSD: faq6.html,v 1.127 2002/03/01 18:53:51 dhartmei Exp ]<br>
$Translation: faq6.html,v 1.51 2002/03/08 21:13:27 horacio Exp $<br>
@


1.39
log
@
sync with badlands translation CVS
@
text
@d742 1
a742 1
block in on fxp0 inet proto tcp from any to any port = 3306
d759 1
a759 1
&quot;block in port = 3306&quot;.  Si invirtiera el orden de
d765 1
a765 1
block in on fxp0 inet proto tcp from any to any port = 3306
d788 1
a788 1
block in quick on fxp0 inet proto tcp from any to any port = 3306
d826 5
a830 5
pass in quick on fxp0 inet proto tcp from any to any port = 22
pass in quick on fxp0 inet proto tcp from any to any port = 80
pass in quick on fxp0 inet proto tcp from any to any port = 443
block in quick on fxp0 from any to any
pass out on fxp0 from any to any
d847 5
a851 5
pass in quick on fxp0 inet proto tcp from 1.1.1.0/24 to any port = 22
pass in quick on fxp0 inet proto tcp from any to any port = 80
pass in quick on fxp0 inet proto tcp from any to any port = 443
block in quick on fxp0 from any to any
pass out on fxp0 from any to any
d862 1
a862 1
pass in quick on fxp0 inet proto tcp from 1.1.1.0/24 to any port = 22
d870 1
a870 1
pass in quick on fxp0 inet proto tcp from 1.1.1.1/32 to any port = 22
d908 1
a908 1
pass in quick on fxp0 inet proto tcp from 1.1.1.1/32 to any port = 22
d912 2
a913 2
pass in quick on fxp0 inet proto tcp from any to any port = 80
pass in quick on fxp0 inet proto tcp from any to any port = 443
d937 2
a938 2
pass in quick on fxp0 inet proto tcp from 1.1.1.1/32 to any port = 22
block in log quick on fxp0 inet proto tcp from any to any port = 22
d1031 1
a1031 1
pass in quick on fxp0 inet proto { tcp, udp } from any to any port = 53
d1041 2
a1042 2
pass in quick on fxp0 inet proto tcp from any to any port = 53
pass in quick on fxp0 inet proto udp from any to any port = 53
d1151 2
a1152 2
conexiones entrantes que sean respuestas a conexiones que Vd.
haya iniciado previamente, como por ejemplo al navegar por la
d1159 5
a1163 5
pass in quick on fxp0 inet proto tcp from 1.1.1.0/24 to any port = 22
pass in quick on fxp0 from any to any port = 80
pass in quick on fxp0 from any to any port = 443
block in quick on fxp0 from any to any
pass out on fxp0 inet proto tcp from any to any keep state
d1189 9
a1197 5
pass in quick on fxp0 inet proto tcp from 1.1.1.0/24 to any port = 22
pass in quick on fxp0 inet proto tcp from any to any port = 80 flags S/SA
pass in quick on fxp0 inet proto tcp from any to any port = 443 flags S/SA
block in quick on fxp0 from any to any
pass out on fxp0 proto tcp from any to any keep state
d1229 5
d1236 2
a1237 1
pass in quick on fxp0 inet proto tcp from 1.1.1.0/24 to any port = 22
d1240 13
a1252 10
pass in quick on fxp0 inet proto tcp from any to any port = 80 flags S/SA
pass in quick on fxp0 inet proto tcp from any to any port = 443 flags S/SA

# finalmente, bloquear el resto con una denegaci&oacute;n por
# definici&oacute;n
block in quick on fxp0 from any to any

# y dejar pasar todo el tr&aacute;fico saliente y mantener el
# estado en conexiones establecidas
pass out on fxp0 from any to any keep state
d1273 1
a1273 1
m&uacute;ltiples protocolos (como BIND, que usa TCP y UDP?
d1277 1
a1277 1
pass in quick on fxp0 inet proto { tcp, udp } from any to any port = 53
d1346 1
a1346 1
block in quick on $ExtIF from $NoRouteIPs to any
d1348 5
d1356 2
a1357 1
pass in quick on $ExtIF inet proto tcp from $IntNet to any port = 22
d1360 2
a1361 1
pass in quick on $ExtIF inet proto tcp from any to any port $Services flags S/SA
a1362 4
# finalmente, bloquear el resto con
# una denegaci&oacute;n predefinida
block in quick on $ExtIF from any to any
 
d1365 6
a1370 1
pass out on $ExtIF from any to any keep state
d1382 1
a1382 1
pass in log quick on fxp0 from 1.1.1.0/24 to any port = 22
d3707 2
a3708 2
Originally [OpenBSD: faq6.html,v 1.126 2002/01/27 22:51:50 nick Exp ]<br>
$Translation: faq6.html,v 1.50 2002/01/28 14:51:09 horacio Exp $<br>
@


1.38
log
@
sync with badlands translation CVS
@
text
@d65 3
a67 1
<a href="http://www.3com.com/corpinfo/en_US/technology/tech_paper.jsp?DOC_ID=135">Understanding IP addressing</a>.
d3686 2
a3687 2
Originally [OpenBSD: faq6.html,v 1.125 2002/01/26 00:17:54 horacio Exp ]<br>
$Translation: faq6.html,v 1.49 2002/01/26 00:23:56 horacio Exp $<br>
@


1.37
log
@
sync with badlands translation CVS.
@
text
@d9 1
a9 1
<meta name="copyright"     content="Este documento es copyright 1998-2001 de OpenBSD.">
d55 1
a55 1
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=ifconfig&apropos=0&sektion=8&format=html">ifconfig(8)</a> 
d110 2
a111 3
dmesg para una tarjeta de red ne2k, que usa un nombre de
dispositivo
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=ne&sektion=4">ne(4)</a>.
d116 2
a117 2
ne3 at pcmcia1 function 0 "Linksys, EtherFast 10/100 PC Card (PCMPC100), " port 0x340/16 irq 9
ne3: address 00:e0:98:04:95:ba
d122 8
a129 1
Si no sabe cu&aacute;l es el nombre de su dispositivo, aqu&iacute;
d133 17
a149 44
<ul>
<li>Tarjetas de red ne2000 - <a href="http://www.openbsd.org/cgi-bin/man.cgi?query=ne&sektion=4">ne</a>
<li>3Com EtherLink III y Fast EtherLink III Ethernet - <a href="http://www.openbsd.org/cgi-bin/man.cgi?query=ep&sektion=4">ep</a>
<li>3Com EtherLink XL y Fast EtherLink XL Ethernet (3C9xx) - <a href="http://www.openbsd.org/cgi-bin/man.cgi?query=xl&sektion=4">xl</a>
<li>Controladora del dispositivo Intel 82586 chip Ethernet - <a href="http://www.openbsd.org/cgi-bin/man.cgi?query=ie&sektion=4&arch=i386">ie</a>
<ul>Que incluyen tarjetas como:
	<li>3Com 3C507
	<li>AT&amp;T StarLAN 10
	<li>AT&amp;T EN100
	<li>AT&amp;T StarLan Fiber
	<li>Intel EtherExpress 16
</ul>

<li>Controladora DEC/Intel 21142/3 y cl&oacute;nica 10/100 Ethernet - <a href="http://www.openbsd.org/cgi-bin/man.cgi?query=dc&sektion=4">dc</a>

<ul>
<font size="-1"><strong>Nota:</strong> Algunos controladores
que estaban en OpenBSD 2.6, como <a href="http://www.openbsd.org/cgi-bin/man.cgi?query=mx&sektion=4&manpath=OpenBSD+2.6">mx</a>, <a href="http://www.openbsd.org/cgi-bin/man.cgi?query=ax&sektion=4&manpath=OpenBSD+2.6">ax</a>, al y <a href="http://www.openbsd.org/cgi-bin/man.cgi?query=pn&sektion=4&manpath=OpenBSD+2.6">pn</a>, han sido substituidos por este controlador.</font><br>
Que incluye tarjetas como:

   <li>Intel 21142/21143 (antes fabricada por DEC)
   <li>Macronix 98713, 98713A, 98715, 98715A y 98725
   <li>Davicom DM9100 y DM9102
   <li>ASIX Electronics AX88140A y AX88141
   <li>ADMtek AL981 Comet y AN985 Centaur
   <li>Lite-On 82c168 y 82c169 PNIC
   <li>Lite-On/Macronix 82c115 PNIC II

<p>
Si va a actualizar a OpenBSD 3.0 desde la versi&oacute;n 2.6
&oacute; desde una versi&oacute;n m&aacute;s antigua, necesita
prestar atenci&oacute;n a este punto.  Cualquier referencia en
<em>/etc/ifaliases</em>, <a href="http://www.openbsd.org/cgi-bin/man.cgi?query=pf.conf&sektion=5">/etc/pf.conf(5)</a>, o <a href="http://www.openbsd.org/cgi-bin/man.cgi?query=nat.conf&sektion=5">/etc/nat.conf(5)</a>
a los nombres de interfaz antiguos <em>mx</em>, <em>al</em>,
<em>ax</em>, o <em>pn</em>, debe ser substituida por
<em>dc</em>.  Adem&aacute;s, cualquier fichero
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=hostname.if&sektion=5">hostname.xxx</a>
con las extensiones de interfaz antiguas, se debe renombrar a
<em>hostname.dcX</em> para que pueda ser reconocido.
Substituya X con el n&uacute;mero de la interfaz.
</ul>
<li>Lucent Technologies WaveLAN/IEEE 802.11DS - <a href="http://www.openbsd.org/cgi-bin/man.cgi?query=wi&sektion=4">wi</a>
<li>Aironet Communications 4500/4800 IEEE 802.11DS - <a href="http://www.openbsd.org/cgi-bin/man.cgi?query=an&sektion=4">an</a>
</ul>
d152 1
a152 1
Tambi&eacute;n puede comprobar qu&eacute; interfaces han sido
d154 5
a158 2
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=ifconfig&sektion=8&format=html">ifconfig(8)</a>.
He aqu&iacute; la salida que mostrar&iacute;a un dispositivo ne2k.
d164 8
a171 5
lo0: flags=8009&lt;UP,LOOPBACK,MULTICAST&gt;
        inet 127.0.0.1 netmask 0xff000000
lo1: flags=8008&lt;LOOPBACK,MULTICAST&gt;
ne3: flags=8863&lt;UP,BROADCAST,NOTRAILERS,RUNNING,SIMPLEX,MULTICAST&gt;
        media: Ethernet manual
d173 18
a190 9
sl0: flags=c010&lt;POINTOPOINT,LINK2,MULTICAST&gt;
sl1: flags=c010&lt;POINTOPOINT,LINK2,MULTICAST&gt;
ppp0: flags=8010&lt;POINTOPOINT,MULTICAST&gt;
ppp1: flags=8010&lt;POINTOPOINT,MULTICAST&gt;
tun0: flags=10&lt;POINTOPOINT&gt;
tun1: flags=10&lt;POINTOPOINT&gt;
enc0: flags=0&lt;&gt;
bridge0: flags=0&lt;&gt;
bridge1: flags=0&lt;&gt;
d196 1
a196 1
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=ifconfig&sektion=8&format=html">ifconfig(8)</a> 
d200 12
a211 7
est&aacute; configurada.  Esto se sabe al ver que los valores ya han
sido fijados en &quot;inet 10.0.0.38 netmask 0xffffff00 broadcast
10.0.0.255&quot;, y que los indicadores <strong>UP</strong> y
<strong>RUNNING</strong> est&aacute;n activados.  Tambi&eacute;n
podr&aacute; notar muchas otras interfaces.  A continuaci&oacute;n
puede ver una lista de interfaces que se supone que deben estar
ah&iacute;.
d215 10
a224 6
<li><a href="http://www.openbsd.org/cgi-bin/man.cgi?query=lo&sektion-4&format=html">lo</a> - Interfaz Loopback
<li><a href="http://www.openbsd.org/cgi-bin/man.cgi?query=sl&sektion=4&format=html">sl</a> - Interfaz de Red SLIP
<li><a href="http://www.openbsd.org/cgi-bin/man.cgi?query=ppp&sektion=8">ppp</a> - Protocolo Punto a Punto
<li><a href="http://www.openbsd.org/cgi-bin/man.cgi?query=tun&sektion=4&format=html">tun</a> - Interfaz de Red de T&uacute;nel
<li><a href="http://www.openbsd.org/cgi-bin/man.cgi?query=enc&sektion=4&format=html">enc</a> - Interfaz de Encapsulamiento
<li><a href="http://www.openbsd.org/cgi-bin/man.cgi?query=bridge&sektion=4&format=html">bridge</a> - Interfaz Ethernet Puente
d230 2
a231 2
<strong>/etc/hostname.${IF}</strong>, donde el nombre de su
interfaz substituir&aacute; ${IF}.  De acuerdo con la
d233 3
a235 6
ser&iacute;a <strong>/etc/hostname.ne3</strong>.  La
composici&oacute;n de este fichero es como sigue a
continuaci&oacute;n:<br>
(Para leer m&aacute;s sobre el formato de este fichero, tome
como referencia la p&aacute;gina de manual
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=hostname.if&sektion=5&format=html">hostname.if(5)</a>)
d240 1
a240 1
[address_family] [your_ip] [your_netmask] [media options]
d245 9
a253 2
Por lo tanto, para el ejemplo anterior, un nombre correcto ser&iacute;a
parecido a este:
d258 1
a258 1
$ <strong>cat /etc/hostname.ne3</strong>
d264 29
d340 7
a346 5
F&iacute;jese en que se producen un peque&ntilde;o
n&uacute;mero de errores, pero &eacute;stos se refieren a la
interfaz de loopback.  Por lo tanto puede ignorar estos
errores.  A partir de aqu&iacute; su sistema deber&iacute;a
funcionar correctamente.  Puede hacer una comprobaci&oacute;n
d362 1
a362 1
default            10.0.0.1           UGS         0       86      -  ne3
d365 2
a366 2
10.0.0/24          link#1             UC          0        0      -  ne3
10.0.0.1           aa:0:4:0:81:d      UHL         1        0      -  ne3
d449 3
a451 2
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=routed&apropos=0&sektion=8&format=html">routed(8)</a>, <a href="http://www.gated.org">gated</a>, 
<a href="http://www.mrtd.net">mrtd</a>, y 
d453 1
a453 1
OpenBSD dispone de soporte para gated y mrtd en la
d472 1
a472 1
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=hostname.if&sektion=5&format=html"><em>/etc/hostname.&lt;if&gt;</em></a>.
d476 1
a476 1
<a href="faq10.html#10.3">jerarqu&iacute;a de inicio rc</a>,
d515 2
a516 2
inet alias 192.168.0.3 255.255.255.255 NONE
inet alias 192.168.0.4 255.255.255.255 NONE
d524 1
a524 1
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=ifconfig&sektion=8&format=html">ifconfig(8)</a>.
d886 4
a889 8
block in quick on fxp0 inet from 127.0.0.0/8 to any
block in quick on fxp0 inet from 192.168.0.0/16 to any
block in quick on fxp0 inet from 172.16.0.0/12 to any
block in quick on fxp0 inet from 10.0.0.0/8 to any
block out quick on fxp0 inet from any to 127.0.0.1/8
block out quick on fxp0 inet from any to 192.168.0.0/16
block out quick on fxp0 inet from any to 172.16.0.0/12
block out quick on fxp0 inet from any to 10.0.0.0/8
d897 5
a901 9
# puedan rutear
block in quick on fxp0 inet from 127.0.0.0/8 to any
block in quick on fxp0 inet from 192.168.0.0/16 to any
block in quick on fxp0 inet from 172.16.0.0/12 to any
block in quick on fxp0 inet from 10.0.0.0/8 to any
block out quick on fxp0 inet from any to 127.0.0.1/8
block out quick on fxp0 inet from any to 192.168.0.0/16
block out quick on fxp0 inet from any to 172.16.0.0/12
block out quick on fxp0 inet from any to 10.0.0.0/8
d1065 1
a1065 1
encuentre protegiendo a una m&aacute;quina con una pobre
d1218 4
a1221 8
block in quick on fxp0 inet from 127.0.0.0/8 to any
block in quick on fxp0 inet from 192.168.0.0/16 to any
block in quick on fxp0 inet from 172.16.0.0/12 to any
block in quick on fxp0 inet from 10.0.0.0/8 to any
block out quick on fxp0 inet from any to 127.0.0.1/8
block out quick on fxp0 inet from any to 192.168.0.0/16
block out quick on fxp0 inet from any to 172.16.0.0/12
block out quick on fxp0 inet from any to 10.0.0.0/8
a1258 12
Normalmente, nos limitar&iacute;amos a escribir algo
as&iacute;:

<ul>
<pre>
pass in quick on fxp0 inet proto tcp from any to any port = 53
pass in quick on fxp0 inet proto udp from any to any port = 53
</pre>
</ul>

pero con el agrupamiento de PF podr&iacute;amos simplificarlo
as&iacute;:
d1280 1
a1280 16
block in quick on fxp0 inet from 127.0.0.0/8 to any
block in quick on fxp0 inet from 192.168.0.0/16 to any
block in quick on fxp0 inet from 172.16.0.0/12 to any
block in quick on fxp0 inet from 10.0.0.0/8 to any
block out quick on fxp0 inet from any to 127.0.0.1/8
block out quick on fxp0 inet from any to 192.168.0.0/16
block out quick on fxp0 inet from any to 172.16.0.0/12
block out quick on fxp0 inet from any to 10.0.0.0/8
</pre>
</ul>
 
se podr&iacute;a consolidar en s&oacute;lo dos l&iacute;neas:

<ul>
<pre>
block in quick on fxp0 inet from { 127.0.0.1/8, 192.168.0.0/16, \
d1383 3
a1385 3
de IPF.  Sin embargo, PF no es, ni se pretende que sea, una
r&eacute;plica substitutiva de IPF.  En esta secci&oacute;n se
detallan algunas de las diferencias entre los dos subsistemas.
a1475 3
<strong>Sistema operativo de la m&aacute;quina:
</strong>OpenBSD v3.0 i386<br>
<br>
d1704 2
a1705 2
<a href="#6.2">secci&oacute;n 6.2</a> de estas preguntas
frecuentes.
d2173 1
a2173 1
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=dhclient&apropos=0&sektion=8&format=html">dhclient(8)</a>,
d2220 1
a2220 1
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=dhcpd&apropos=0&sektion=8&format=html">dhcpd(8)</a>,
d2279 1
a2279 1
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=dhcp-options&apropos=0&sektion=5&format=html">dhcp-options(5)</a>.
d2292 2
a2293 2
   <li><a href="http://www.openbsd.org/cgi-bin/man.cgi?query=pppd&sektion=8&format=html">pppd(8)</a> - Es el d&aelig;mon ppp del n&uacute;cleo (<em>kernel</em>) del sistema.
   <li><a href="http://www.openbsd.org/cgi-bin/man.cgi?query=ppp&sektion=8&format=html">ppp(8)</a> - Es el d&aelig;mon ppp del modo usuario.
d2378 2
a2379 2
p&aacute;gina de manual
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=ppp&sektion=8&format=html">ppp(8)</a>.
d2506 2
a2507 3
Puede encontrar m&aacute;s informaci&oacute;n en
<a href="http://www.freebsd.org/handbook/userppp.html">http://www.freebsd.org/handbook/userppp.html</a> o en
<a href="http://www.es.freebsd.org/es/FAQ/ppp.html">http://www.es.freebsd.org/es/FAQ/ppp.html</a>.
d2555 1
a2555 1
Tambi&eacute;n existe un sysctl para esto.  De la p&aacute;gina de
d2557 1
a2557 1
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=sysctl&apropos=0&sektion=8&format=html">sysctl(8)</a>:
d2588 1
a2589 1
<p>
d2591 3
a2593 3
   <li><a href="http://www.openbsd.org/cgi-bin/man.cgi?query=nfsd&sektion=8&format=html">nfsd(8)</a>
   <li><a href="http://www.openbsd.org/cgi-bin/man.cgi?query=mountd&sektion=8&format=html">mountd(8)</a>
   <li><a href="http://www.openbsd.org/cgi-bin/man.cgi?query=exports&sektion=5&format=html">exports(5)</a>
d2613 1
d2635 2
a2636 1
de manual <a href="http://www.openbsd.org/cgi-bin/man.cgi?query=exports&sektion=5&format=html">exports(5)</a>.
d2697 3
a2699 1
Para iniciar mountd(8) escriba:
d2704 1
d2752 1
a2752 1
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=showmount&sektion=8&format=html">showmount(8)</a>,
d2774 1
a2774 1
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=mount_nfs&sektion=8&format=html">mount_nfs(8)</a>.
d2849 1
a2849 1
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=nslookup&sektion=8&format=html">nslookup(8)</a>
d2871 1
a2871 1
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=resolv.conf&sektion=5&format=html">/etc/resolv.conf</a>.
d2919 1
a2919 1
<a name="6.8.1.1"></a>
d2927 1
a2927 1
<li>Lea el libro de O'Reilly Associates<em><a href="../../es/books.html#dns&bind">DNS and BIND</a></em>.</li>
d2942 1
a2942 1
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=dig&sektion=1&format=html">dig(1)</a>
d2946 1
a2946 1
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=dig&sektion=1&format=html">dig(1)</a>
d2961 1
a2961 1
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=hosts&sektion=5&format=html">/etc/hosts</a>
d2963 1
a2963 1
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=resolv.conf&sektion=5&format=html">/etc/resolv.conf</a>
d3236 1
a3236 1
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=route&sektion=8&format=html">route(8)</a>
d3242 1
a3242 1
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=dig&sektion=1&format=html">dig(1)</a>
d3285 1
a3285 1
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=rc&sektion=8&format=html">/etc/rc</a>
d3287 1
a3287 1
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=rc.conf&sektion=8&format=html">/etc/rc.conf</a>,
d3324 1
a3324 1
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=ndc&sektion=8&format=html">ndc(8)</a>.
d3341 1
a3341 1
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=ndc&sektion=8&format=html">ndc(8)</a>.
d3354 1
a3354 1
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=kill&sektion=1&format=html">kill(1)</a>
d3386 1
a3386 1
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=ndc&sektion=8&format=html">ndc(8)</a>.
d3489 1
a3489 1
empresa.  Lea los <a href="#6.8.1.1">documentos que le recomendamos</a>
d3516 2
a3517 2
lea la <a href="faq8.html#8.6">secci&oacute;n 8.6</a> de las
preguntas frecuentes.
d3522 1
a3522 1
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=gre&apropos=0&sektion=0&manpath=OpenBSD+Current&arch=i386&format=html">gre(4)</a>
d3548 9
a3556 8
Para recompilar el n&uacute;cleo, obtenga antes la distribuci&oacute;n
2.8-stable de OpenBSD mediante cvs (lea la p&aacute;gina de
<a href="../../es/stable.html">OpenBSD Stable</a> para m&aacute;s
informaci&oacute;n), aplicar el parche anterior al fichero de
configuraci&oacute;n del n&uacute;cleo, <em>GENERIC</em>, y recompilar
el n&uacute;cleo tal y como se describe en la
<a href="faq5.html#5.3">secci&oacute;n 5.3</a> de las preguntas
frecuentes.
d3560 9
a3568 7
Una vez que ya tenga instalado el paquete <strong>pptp</strong> y el
nuevo n&uacute;cleo, deber&aacute; editar unos cuantos ficheros para
configurar su conexi&oacute;n.  Este paquete utiliza el programa de
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=ppp&apropos=0&sektion=0&manpath=OpenBSD+Current&arch=i386&format=html">ppp(8)</a>
nativo de OpenBSD;  si est&aacute; familiarizado con ppp(8), gran parte
de la configuraci&oacute;n es id&eacute;ntica.  Lea tambi&eacute;n la
<a href="#6.5">secci&oacute;n 6.5</a> de este documento.
d3620 7
a3626 6
10.0.0.38 preconfigurada.  Pero ahora necesitaremos asignar una
direcci&oacute;n a NUESTRA interfaz.  Lo mejor es escoger una
direcci&oacute;n IP cercana a la asignada para el MODEM, o usar la
direcci&oacute;n IP est&aacute;tica que nos hayan asignado.  Puede leer
m&aacute;s sobre c&oacute;mo configurar interfaces en la
<a href="#6.1">secci&oacute;n 6.1</a> de este documento.
d3684 2
a3685 2
Originally [OpenBSD: faq6.html,v 1.120 2002/01/20 06:04:50 kjell Exp ]<br>
$Translation: faq6.html,v 1.46 2002/01/20 12:39:09 horacio Exp $<br>
@


1.36
log
@
sync with badlands.
@
text
@d262 3
a264 3
nombres de servidores (<em>&quot;nameservers&quot;</em>) y su
fichero <strong>/etc/hosts</strong> (mire la p&aacute;gina del
manual de <a href="http://www.openbsd.org/cgi-bin/man.cgi?query=hosts&sektion=5">hosts(5)</a>).
d268 2
a269 1
p&aacute;gina del manual de <a href="http://www.openbsd.org/cgi-bin/man.cgi?query=resolv.conf&sektion=5">resolv.conf(5)</a>.
d408 3
a410 3
A continuaci&oacute;n modifique las rutas en los otros hu&eacute;spedes
de ambos lados.  OpenBSD ofrece muchas posibilidades de uso como
enrutador, usando software como 
d414 4
a417 3
OpenBSD dispone de soporte para gated y mrtd en la colecci&oacute;n de
portes.  OpenBSD incluye soporte para varias interfaces T1, HSSI, ATM,
FDDI, Ethernet, e interfaces de serie (PPP/SLIP).
d518 5
a522 5
<h5>Nota: &quot;<em>Packet Filter</em>&quot; (Filtro de
paquetes IP) es el sistema de filtrado para OpenBSD 3.0 y
versiones posteriores.  Si busca las preguntas frecuents sobre
IPF/IPNAT para OpenBSD 2.9 y versiones anteriores, pulse sobre
<a href="faqipf.html">enlace</a>.</h5>
d800 2
a801 2
hu&eacute;spedes internos en su bloque de direcciones 1.1.1.0,
y al mismo tiempo permitir conexiones externas a http y https?
d841 2
a842 2
falsificaci&oacute;n de direcciones IP (<em>&quot;ip address
spoofing&quot;</em>).  Estas direcciones, por lo general, no
d923 1
a923 1
<i><a href="http://www.openbsd.org/cgi-bin/man.cgi?query=rc.conf&sektion=8">/etc/rc.conf(8)</a></i>,
d970 2
a971 2
(<em>&quot;partial packet payload&quot;</em>) registrados por
el dispositivo de ingreso.
d1142 11
a1152 10
(<em>&quot;handshake&quot;</em>); una vez que esto ocurra,
puede bloquear el tr&aacute;fico a ese puerto y permitir a la
regla &quot;keep state&quot; que gestione la conexi&oacute;n.
Para que se complete el saludo inicial, s&oacute;lo necesita
permitir el paso a los paquetes con los indicadores SYN y
SYNACK activados.  Dejando pasar s&oacute;lo paquetes con SYN
y SYNACK activados se pueden prevenir muchas formas de
barridos de puertos (<em>&quot;port scanning&quot;</em>) como
puede ser el barrido de FIN.  Ahora las reglas est&aacute;n de
este modo:
d1256 4
a1259 4
&laquo;agrupaciones&raquo; (<em>&quot;sets&quot;</em>), que se
pueden utilizar en cualquier parte en la que se pueda usar una
IP.  Por ejemplo, tomando como partida nuestras reglas contra
la falsificaci&oacute;n de IP anteriores:
d1508 5
a1512 6
operativo cliente no es un problema para NAT.
Cada m&aacute;quina est&aacute; conectada a un concentrador
(<em>&quot;hub&quot;</em>) designado para uso interno.  Para
este documento y sus ejemplos, se asumir&aacute; que el
cliente en la red interna tiene una direcci&oacute;n IP
192.168.1.40
d1750 1
a1750 1
(<em>&quot;netmask&quot;</em>, cuyo formato es CIDR).  La
d1773 1
a1773 1
orden &laquo;<em>reboot</em>&laquo;.
d2133 3
a2135 4
contra desbordamientos de la memoria intermedia
(<em>&quot;buffer overflows&quot;</em>), y otros peligros.  El
mantenimiento de estos filtros es a menudo un trabajo muy
pesado.
d2151 1
a2151 1
reenv&iacute;o de IP (<em>&quot;IP forwarding&quot;</em>)
d2247 11
a2257 9
Con esto indicar&aacute; a sus clientes dhcp que el dominio que deben
a&ntilde;adir a sus requerimientos de DNS es xyz.mil (as&iacute;, si un
usuario escribiera 'telnet joe', los enviar&iacute;a a joe.xyz.mil).
Les dirigir&aacute; a los servidores de DNS 192.168.1.3 y 192.168.1.5.
Para los hu&eacute;spedes que se encuentren en la misma red que una
interfaz de ethernet en la m&aacute;quina de OpenBSD, que est&aacute;
en el rango 192.168.1.0/24, les asignar&aacute; una direcci&oacute;n de
IP entre 192.168.1.32 y 192.168.1.127, configurando su pasarela por
definici&oacute;n como 192.168.1.1.
d2295 1
a2295 1
   <li><a href="http://www.openbsd.org/cgi-bin/man.cgi?query=pppd&sektion=8&format=html">pppd(8)</a> - Es el d&aelig;mon ppp del n&uacute;cleo (<em>&quot;kernel&quot;</em>) del sistema.
d2587 5
a2591 4
El &laquo;Sistema de Archivos de Red&raquo; (NFS, <em>&quot;Network
File System&quot;</em>) se usa para compartir un sistema de archivos en
una red.  Algunas p&aacute;ginas de manual que deber&iacute;a leer
antes de que intente configurar un servidor de NFS son:
a2593 1

d2619 7
a2625 6
Otra nota importante sobre seguridad.  No se limite a a&ntilde;adir un
sistema de archivos a <em>/etc/exports</em> sin alg&uacute;n tipo de
lista de hu&eacute;spedes autorizados.  Sin una lista de
hu&eacute;spedes que puedan montar un directorio particular, cualquiera
que pueda llegar a su hu&eacute;sped podr&aacute; montar sus
directorios de NFS en <em>exports</em>.
d2771 2
a2772 3
Los sistemas de archivo NFS se deben montar mediante mount(8), o
m&aacute;s
exactamente mediante
d2774 5
a2778 4
Para montar un sistema de archivo <em>/work</em> del hu&eacute;sped
10.0.0.1 en un sistema de archivo local <em>/mnt</em>, haga lo
siguiente (no necesita usar una direcci&oacute;n IP, mount se
encargar&aacute; de la resoluci&oacute;n de nombres):
d2844 4
a2847 3
Mi m&aacute;quina con OpenBSD est&aacute; conectada actualmente a
Internet a trav&eacute;s de mi proveedor (ISP <em>&quot;Internet
Service Provider&quot;</em>), y por lo tanto puedo usar la utilidad
d2868 2
a2869 2
(<em>&quot;nameserver&quot;</em>) que mi ISP me dijo que usara
con mi cuenta, y cuyo n&uacute;mero se introduce en el fichero
d2926 1
a2926 1
<li>Lea el libro de O'Reilly Associates<i><a href="../../es/books.html#dns&bind">DNS and BIND</a></i>.</li>
d3023 1
a3023 1
<li>named <i>(``d&aelig;mon de name'')</i></li>
d3025 1
a3025 1
    jerarqu&iacute;a de <i>/var/named/</i></li>
d3054 3
a3056 2
<li>La implementaci&oacute;n de BIND 9.x en <i>/usr/ports/net/bind9</i> 
    (ver <a href="../../es/ports.html">portes</a>).</li>
d3423 1
a3423 1
Si usa Bind8 necesitar&aacute; especificar los hu&eacute;spedes a los
d3468 1
a3468 1
tan exacto.  Generalmente, los &uacute;nicos hu&eacute;spedes que
d3470 2
a3471 2
hu&eacute;spedes de DNS desde los que quiera depurar (127.0.0.1 es
normalmente un buen hu&eacute;sped desde donde permitir
d3679 2
a3680 2
Originally [OpenBSD: faq6.html,v 1.119 2002/01/13 00:00:32 ericj Exp ]<br>
$Translation: faq6.html,v 1.45 2002/01/19 21:25:10 horacio Exp $<br>
@


1.35
log
@
sync with badlands translation CVS.
new tags.
@
text
@d76 1
a76 1
<i>(Nota: existe un proyecto de traducci&oacute;n de
d78 1
a78 1
<a href="http://www.arrakis.es/~pjleon/rfc-es/index.html">RFC-ES</a>)</i>
d1441 1
a1441 1
privadas/internas, puede aprovechar los bloques de
d3674 1
a3674 1
$Translation: faq6.html,v 1.44 2002/01/16 20:14:55 horacio Exp $<br>
@


1.34
log
@
sync with badlands translation CVS
@
text
@d12 1
a12 1
<body bgcolor="#ffffff" text="#000000" link="#23238e">
d21 16
a36 15
<li><a href="#6.0.1">6.0.1 - Introducci&oacute;n</a>
<li><a href="#6.1">6.1 - Configuraci&oacute;n inicial de la red</a>
<li><a href="#6.2">6.2 - Filtro de paquetes IP (PF)</a>
<li><a href="#6.3">6.3 - Traducci&oacute;n de Direcciones de Red
    (NAT)</a>
<li><a href="#6.4">6.4 - Protocolo de Configuraci&oacute;n para
    H&uacute;espedes Din&aacute;micos
    (DHCP)</a>
<li><a href="#6.5">6.5 - Protocolo Punto a Punto (PPP)</a>
<li><a href="#6.6">6.6 - Afinar par&aacute;metros de red</a>
<li><a href="#6.7">6.7 - Usar NFS</a>
<li><a href= "#6.8">6.8 - Servicio de Nombres de Dominio  - DNS, BIND,
    y named</a>
<li><a href="#6.9">6.9 - Configuraci&oacute;n de una conexi&oacute;n
    PPTP en OpenBSD</a>
d43 1
d46 2
d87 2
d91 1
d94 1
d96 2
a97 2
<h3>6.1.1 - Idenficaci&oacute;n y configuraci&oacute;n de la interfaces
de red</h3>
d350 1
d352 2
a353 2
<h3>6.1.2 - Configuraci&oacute;n del sistema OpenBSD como pasarela
(<em>&quot;gateway&quot;</em>)</h3>
d419 1
d509 1
d1807 1
a1807 1
<strong>Verificar el estado de NAT</strong>
d2166 3
a2168 1
<a name="6.4"></a> <h2>6.4 - DHCP</h2>
d2282 1
d2512 1
d2514 2
a2515 1
<h2>6.6 - Afinar par&aacute;metros de red</h2>
d2577 2
d2581 1
d2817 2
d2820 3
a2822 1
<h2>6.8 - Servicio de Nombres de Dominio  - DNS, BIND, y named</h2>
d3273 1
a3273 1
<h4>6.8.6.1 Iniciar DNS</h4>
d3329 1
a3329 1
<h4>6.8.6.2 Parar DNS</h4>
d3362 2
a3363 1
<h4>6.8.6.3 Reiniciar DNS con una configuraci&oacute;n alterada</h4>
d3486 2
a3487 1

d3491 1
d3673 2
a3674 2
Originally [OpenBSD: faq6.html,v 1.117 2001/12/30 11:37:25 jufi Exp ]<br>
$Translation: faq6.html,v 1.43 2001/12/31 00:12:22 horacio Exp $<br>
@


1.33
log
@
sync with badlands translation CVS.
@
text
@d135 2
a136 2
<font size="-1"><b>Nota:</b> Algunos controladores que estaban en
OpenBSD 2.6, como <a href="http://www.openbsd.org/cgi-bin/man.cgi?query=mx&sektion=4&manpath=OpenBSD+2.6">mx</a>, <a href="http://www.openbsd.org/cgi-bin/man.cgi?query=ax&sektion=4&manpath=OpenBSD+2.6">ax</a>, al y <a href="http://www.openbsd.org/cgi-bin/man.cgi?query=pn&sektion=4&manpath=OpenBSD+2.6">pn</a>, han sido substituidos por este controlador.</font><br>
d148 3
a150 3
Si va a actualizar a OpenBSD 2.7 desde una versi&oacute;n
m&aacute;s antigua de OpenBSD, necesita prestar
atenci&oacute;n a este punto.  Cualquier referencia en
d462 1
a462 1
# <b>cat /etc/hostname.dc0</b>
d479 1
a479 1
# <b>ifconfig dc0 inet alias 192.168.0.3 netmask 255.255.255.255</b>
d489 1
a489 1
$ <b>ifconfig -A</b>
d1478 1
a1478 1
<b>IP enrutable por Internet, externo (en este ejemplo, una
d1480 1
a1480 1
Proveedor de Servicios de Internet)<br></b>
d1487 1
a1487 1
<b>Red de &Aacute;rea Local (LAN)</b><br>
d1601 1
a1601 1
<b>&iquest;Por qu&eacute; usar NAT?</b>
d1640 1
a1640 1
<b>Preconfiguraci&oacute;n</b>
d2189 6
a2194 5
Sea cual fuere el modo en que inicie dhclient, puede <b>evitar</b> que
se actualice su DNS de acuerdo con la idea que tenga el servidor dhcp
sobre la DNS, comentando las l&iacute;neas precedidas por 'request'
(son ejemplos de la configuraci&oacute;n predefinida, pero necesita
activarlos para anular la configuraci&oacute;n predefinida de dhclient)
d2201 3
a2203 3
y a continuaci&oacute;n <b>eliminar</b> domain-name-servers.
Tambi&eacute;n es posible que tambi&eacute;n desee anular hostname u
otras configuraciones.
d2213 1
a2213 1
est&eacute; <b>a la escucha</b>.
d2346 9
a2354 8
<b>AVISO</b> - En OpenBSD 2.6, el sistema se lanz&oacute; con un
fichero <em>/etc/ppp/ppp.conf.example</em> que conten&iacute;a una
configuraci&oacute;n err&oacute;nea para el dispositivo.  El
dispositivo era <b>"set device /dev/cuaa0"</b> cuando en realidad
deb&iacute;a ser <em>/dev/cua00</em>, que corresponde al dispositivo
para el puerto de comunicaciones 1 (COM1).  Su dispositivo
podr&iacute;a no estar en COM1, a&uacute;n as&iacute; este esquema era
err&oacute;neo.
d2358 5
a2362 4
La secci&oacute;n en la opci&oacute;n <b>default:</b> ser&aacute;
ejecutada cada vez.  En ella se configura toda la informaci&oacute;n
cr&iacute;tica.  Con &quot;set log&quot; se configuran los niveles de
ingreso.  Esto se puede cambiar;  para m&aacute;s informaci&oacute;n
d2366 10
a2375 9
El dispositivo se configura con &quot;set device&quot;.  &Eacute;ste es
el dispositivo en el que se encuentra el modem.  En este ejemplo el
modem est&aacute; en el puerto de comunicaciones 2 (COM2), mientras que
el puerto de comunicaciones 1 corresponder&iacute;a a
<em>/dev/cua00</em>.  Con &quot;set speed&quot; se configura la
velocidad de la conexi&oacute;n por llamada, y con &quot;set dial&quot;
se configura los par&aacute;metros de la llamada.  Con esto se puede
cambiar el tiempo muerto, etc...  Es conveniente dejar esta
l&iacute;nea m&aacute;s o menos como est&aacute;.
d2379 9
a2387 8
A continuaci&oacute;n puede pasar a configurar la informaci&oacute;n
espec&iacute;fica para su ISP.  Para ello debe a&ntilde;adir otra
opci&oacute;n en la secci&oacute;n <b>default:</b>.  Puede dar
cualquier nombre a esta etiqueta, pero lo m&aacute;s f&aacute;cil es
darle el nombre de su ISP.  En el ejemplo usaremos <b>myisp:</b> para
la opci&oacute;n que har&aacute; referencia a nuestro ISP.  He
aqu&iacute; una configuraci&oacute;n simple que incorpora todo lo
necesario para conectar:
d2425 15
a2439 14
Hemos configurado la l&iacute;nea anterior con el formato 
&quot;<b>set ifaddr [myaddr[/nn] [hisaddr[/nn] [netmask
[triggeradr]]]]</b>&quot;.  De este modo el primer IP que se
especifique es el que querremos como nuestro IP.  Sin tiene una
direcci&oacute;n IP est&aacute;tica, escr&iacute;bala aqu&iacute;.  En
el ejemplo hemos usado /0, que indica que no es necesario que concuerde
ning&uacute;n bit de esta direcci&oacute;n ip, y que se puede
substituir todo.  El segundo IP que se especifique es el que esperamos
como el IP de nuestro ISP.  Si lo sabe lo puede especificar
aqu&iacute;, pero en la l&iacute;nea no sabemos cu&aacute;l se
asignar&aacute;, as&iacute; que dejaremos que nos lo digan.  Esto es
muy &uacute;til al negociar con algunas implementaciones PPP que no
asignan un n&uacute;mero IP a menos que su conexi&oacute;n les requiera
``0.0.0.0''.
d2607 6
a2612 5
<b>10.0.0.1</b>, que servir&aacute; NFS s&oacute;lo a clientes dentro
de esa red.  El primer paso para configurar NFS es configurar su
fichero <em>/etc/exports</em>.  Este fichero se compone de una lista
con los sistemas de archivo que quiera que se encuentren accesibles por
medio de NFS, y define qui&eacute;n puede acceder a cada uno de ellos.
d2614 4
a2617 4
<em>/etc/exports</em>, y es conveniente leer la p&aacute;gina de manual
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=exports&sektion=5&format=html">exports(5)</a>.
En este ejemplo empezaremos con un fichero <em>/etc/exports</em> como
el siguiente:
d2631 11
a2641 9
Esto quiere decir que el sistema de archivo local <em>/work</em>
estar&aacute; disponible por medio de NFS.  <b>-alldirs</b> indica que
los clientes podr&aacute;n montar en cualquier parte del punto de
montaje <em>/work</em>.  <b>-ro</b> indica que s&oacute;lo se
permitir&aacute; montarlo en modo de s&oacute;lo lectura.  Los dos
&uacute;ltimos argumentos indican que s&oacute;lo los clientes dentro
de la red 10.0.0.0 que usen una m&aacute;scara de red 255.255.255.0,
estar&aacute;n autorizados a montar este sistema de archivo.  Esto es
importante en algunos servidores accesibles desde diferentes redes.
d2645 18
a2662 16
Una vez que su fichero <em>/etc/exports</em> haya sido configurado,
puede seguir adelante y configurar su servidor NFS.  Primero
deber&iacute;a asegurarse de que las opciones NFSSERVER y NFSCLIENT se
encuentren en la configuraci&oacute;n del n&uacute;cleo de su sistema
(el n&uacute;cleo GENERIC incluye estas opciones).  A
continuaci&oacute;n debe configurar <strong>nfs_server=YES</strong> en
el fichero <em>/etc/rc.conf</em>.  De este modo, cuando reinicie el
sistema, se activar&aacute;n nfsd(8) y mountd(8).  Ahora ya puede
continuar e iniciar los d&aelig;mons Vd. mismo.  Estos d&aelig;mons
deben ser iniciados por root, y debe asegurarse de que portmap(8) se
encuentre funcionando en su sistema.  El ejemplo que sigue sobre
c&oacute;mo iniciar nfsd(8) sirve tanto para TCP como para UDP usando 4
d&aelig;mons.  Para gestionar el m&aacute;ximo n&uacute;mero de
requerimientos de clientes concurrentes a los que quiera dar servicio,
debe activar un n&uacute;mero apropiado de d&aelig;mons del servidor
NFS.
d2733 1
a2733 1
<b>/usr/bin/showmount -a host</b>.  Por ejemplo:
d2838 4
a2841 4
<b>165.87.201.244</b> es el nombre del servidor que ha contestado,
porque es el &laquo;nombre de servidor&raquo;
(<em>&quot;nameserver&quot;</em>) que mi ISP me dijo que usara con mi
cuenta, y cuyo n&uacute;mero se introduce en el fichero
d2843 5
a2847 4
Pero la respuesta no fue autorizada.  Para una respuesta autorizada,
investiguemos cu&aacute;l es el servidor de DNS autorizado para el
dominio <em>openbsd.org</em>, y pregunt&eacute;mosle por la
direcci&oacute;n de <em>www.openbsd.org</em>:
d2944 30
a2973 29
<li>Si tiene una LAN IP en la que no quiere replicar los ficheros
    &quot;hosts&quot; de direcciones locales en cada m&aacute;quina,
    puede configurar su m&aacute;quina con OpenBSD como servidor de DNS
    y servir los requerimientos de otras m&aacute;quinas de su
    LAN.</li>

<ul>
<li><b>Nota:</b> No existen restricciones en la pr&aacute;ctica al
    n&uacute;mero de servidores de DNS en una LAN.  Cualquier
    m&aacute;quina o todas las de la LAN puede ofrecer el servicio de
    DNS si se configuran para ello.  Que uno de estos servidores se
    considere autorizado desde fuera de su LAN (o incluso conocido
    desde fuera de la LAN), es un factor de configuraci&oacute;n que
    suele estar controlado por el nivel superior inmediato de su LAn en
    la jerarqu&iacute;a de dominios.</li>
</ul>

<li>Si tiene una LAN IP en la que residen m&aacute;quinas que quiera
    que sean localizables a trav&eacute;s de requerimientos de DNS por
    m&aacute;quinas en otra LAN o WAN.</li>

<li>Si tiene dificultades en resolver el nombre de dominio local a una
    direcci&oacute;n IP, o resolver cualquier otro nombre local a
    direcciones IP aunque tenga los ficheros <em>/etc/hosts</em> y
    <em>/etc/resolv.conf</em> correctamente (v.g., en OpenBSD, Netscape
    a veces se comporta de este modo porque implementa su propia
    herramienta de resoluci&oacute;n, en lugar de usar
    <em>gethostbyname(3)</em> para la b&uacute;squeda de
    direcciones).</li>
d3009 1
a3009 1
Existen dos especificaciones BIND diferentes:
d3014 1
d3018 2
a3019 2
Tal y como queda instalado, OpenBSD <b>named</b> tiene soporte para
BIND 4.x.
d3477 7
a3483 6
Antes que nada debe instalar pptp.  Existe un porte de pptp en el
&aacute;rbol de portes de OpenBSD que fue a&ntilde;adido A PARTIR de la
versi&oacute;n 2.8 de OpenBSD, y que se instala y funciona bien desde
el mismo &aacute;rbol.  Lo puede encontrar en <em>/ports/net/pptp</em>.
Para m&aacute;s informaci&oacute;n sobre el &aacute;rbol de portes de
OpenBSD, lea la <a href="faq8.html#8.6">secci&oacute;n 8.6</a> de las
d3647 2
a3648 2
Originally [OpenBSD: faq6.html,v 1.116 2001/12/23 03:09:52 miod Exp ]<br>
$Translation: faq6.html,v 1.42 2001/12/30 03:07:47 horacio Exp $<br>
@


1.32
log
@
sync with badlands translation CVS.
@
text
@d1325 1
a1325 1
pass in quick on $ExtIF inet proto tcp from any to any port = $Services flags S/SA
d2582 1
a2582 1
uso de <a href="faq13.html">IPSec</a>.  De otro modo existe la
d2587 1
a2587 1
IPSec est&aacute; correctamente configurado, protege contra todos estos
d3605 1
a3605 1
# <strong>tail -f /var/log/message</strong>
d3632 2
a3633 2
Originally [OpenBSD: faq6.html,v 1.113 2001/12/06 03:20:46 ericj Exp ]<br>
$Translation: faq6.html,v 1.41 2001/12/06 17:50:27 horacio Exp $<br>
@


1.31
log
@
sync with badlands translation CVS
@
text
@d1333 1
a1333 1
pass out on $ExtIf from any to any keep state
d1770 1
a1770 1
# <strong>pfctl -N /etc/net.conf</strong>
d3632 2
a3633 2
Originally [OpenBSD: faq6.html,v 1.111 2001/11/23 00:38:48 horacio Exp ]<br>
$Translation: faq6.html,v 1.40 2001/11/28 21:56:39 horacio Exp $<br>
@


1.30
log
@
sync with badlands translation CVS.
@
text
@d46 4
a49 3
ser&aacute; de gran ayuda que haya leido y, por lo menos, asimilado en
parte el cap&iacute;tulo
<a href="faq5.html">&laquo;Configuraci&oacute;n del N&uacute;cleo&raquo;</a> 
d57 4
a60 3
protocolos de enrutamiento, si est&aacute; usando su sistema OpenBSD
como un enrutador, si necesita conocer m&aacute;s a fondo los
protocolos de redes IP, entonces es realmente necesario que lea
d62 2
a63 2
&iexcl;&Eacute;ste es un excelente documento que contiene conocimientos
fundamentales sobre redes de IP!
d66 3
a68 3
Si est&aacute; trabajando con aplicaciones como servidores de http,
servidores de ftp, y servidores de correo, se puede beneficiar en gran
medida de la lectura de los
d93 12
a104 9
Lo primero que debe hacer para empezar es identificar su interfaz de
red.  En OpenBSD las interfaces se designan por el tipo de tarjeta, no
por el tipo de conexi&oacute;n.  Puede ver su tarjeta de red iniciar
durante el arranque, o despu&eacute;s del arranque usando la orden
<strong>dmesg(8)</strong>.  Tambi&eacute;n puede ver su interfaz de red
usando la orden
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=ifconfig&sektion=8&format=html">ifconfig(8)</a>.
Por ejemplo, vea a continuaci&oacute;n la salida originada por dmesg
para una tarjeta de red ne2k, que usa un nombre de dispositivo ne.
d120 4
a123 4
<li>ne2000 Network Cards - <a href="http://www.openbsd.org/cgi-bin/man.cgi?query=ne&sektion=4&format=html">ne</a> 
<li>3Com EtherLink III and Fast EtherLink III Ethernet - <a href="http://www.openbsd.org/cgi-bin/man.cgi?query=ep&sektion=4&format=html">ep</a>
<li>3Com EtherLink XL and Fast EtherLink XL Ethernet (3C9xx) - <a href="http://www.openbsd.org/cgi-bin/man.cgi?query=xl&sektion=4&format=html">xl</a>
<li>Intel 82586 chip Ethernet device driver - <a href="http://www.openbsd.org/cgi-bin/man.cgi?query=ie&sektion=4&format=html">ie</a>
d132 1
a132 1
<li>Controlador DEC/Intel 21142/3 y cl&oacute;nico 10/100 Ethernet - <a href="http://www.openbsd.org/cgi-bin/man.cgi?query=dc&sektion=4&format=html">dc</a>
d136 1
a136 2
OpenBSD 2.6, como mx, ax, al y pn, han sido substituidos por este
controlador.</font><br>
d139 1
a139 1
   <li>Intel 21142/21143 (antes fabricado por DEC)
d151 8
a158 8
<em>/etc/ifaliases</em>, <em>/etc/pf.conf</em>, o
<em>/etc/nat.conf</em> a los nombres de interfaz antiguos
<em>mx</em>, <em>al</em>, <em>ax</em>, o <em>pn</em>, se debe
substituir por <em>dc</em>.  Adem&aacute;s, cualquier fichero
<em>hostname.xxx</em> con las extensiones de interfaz
antiguas, se debe renombrar a <em>hostname.dcX</em> para que
pueda ser reconocido.  Substituya X con el n&uacute;mero de la
interfaz.
d210 1
a210 1
<li>ppp - Protocolo Punto a Punto
d217 3
a219 2
Si su interfaz no ha sido configurada, el primer paso ser&aacute; crear
el fichero <strong>/etc/hostname.${IF}</strong>, donde el nombre de su
d221 7
a227 6
informaci&oacute;n de los ejemplos anteriores, el nombre ser&iacute;a
<strong>/etc/hostname.ne3</strong>.  La composici&oacute;n de este
fichero es como sigue a continuaci&oacute;n.  Para leer m&aacute;s
sobre el formato de este fichero, tome como referencia la p&aacute;gina
de manual
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=hostname.if&sektion=5&format=html">hostname.if(5)</a>
d249 16
a264 13
El siguiente paso ser&aacute; la configuraci&oacute;n de su pasarela.
Para ello basta con que ponga el IP de su pasarela en el fichero
<strong>/etc/mygate</strong>.  Esto permitir&aacute; que su pasarela se
active en el momento del arranque.  A continuaci&oacute;n deber&aacute;
configurar sus nombres de servidores (<i>&quot;nameservers&quot;</i>) y
su fichero <strong>/etc/hosts</strong>.  Para configurar sus nombres de
servidores debe crear un fichero con el nombre
<strong>/etc/resolv.conf</strong>.  Puede leer m&aacute;s sobre el
formato de este fichero en la p&aacute;gina de manual
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=resolv.conf&sektion=5&format=html">resolv.conf(5)</a>.
El siguiente ejemplo es para un uso t&iacute;pico.  En este ejemplo sus
servidores de dominio son 125.2.3.4 y 125.2.3.5.  Tambi&eacute;n
pertenece al dominio &laquo;sudominio.dom&raquo;.
d278 4
a281 3
Desde este punto ya puede reiniciar o bien ejecutar el gui&oacute;n de
configuraci&oacute;n <strong>/etc/netstart</strong>.  Puede hacerlo
escribiendo (como root):
d286 1
a286 1
$ <strong>sh /etc/netstart</strong>
d295 11
a305 11
F&iacute;jese en que se producen un peque&ntilde;o n&uacute;mero de
errores, pero &eacute;stos se refieren a la interfaz de loopback.  Por
lo tanto puede ignorar estos errores.  A partir de aqu&iacute; su
sistema deber&iacute;a funcionar correctamente.  Puede hacer una
comprobaci&oacute;n con 
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=ifconfig&sektion=8&format=html">ifconfig(8)</a>
para asegurarse de que su interfaz se configur&oacute; correctamente.
Tambi&eacute;n puede comprobar sus rutas con
<strong>netstat(1)</strong> o <strong>route(8)</strong>.  A
continuaci&oacute;n puede ver un ejemplo de c&oacute;mo ver sus tablas
de rutas usando ambas herramientas.
d325 1
d357 1
a357 1
direcciones IPv4 en los proveedores de servicios de redes y
d367 6
a372 5
utilidad <strong>sysctl(8)</strong>.  Para que los cambios
sean permanentes, debe editar el fichero
<em>/etc/sysctl.conf</em> para habilitar IP Forwarding.  Esto
lo puede llevar a cabo a&ntilde;adiendo la siguiente
l&iacute;nea en ese fichero de configuraci&oacute;n.
d382 6
a387 4
Para que este cambio surja efecto sin tener que reiniciar el sistema,
use directamente la utilidad <strong>sysctl(8)</strong>.  Recuerde que
este cambio todav&iacute;a no existir&aacute; despu&eacute;s de
reiniciar, y que necesitar&aacute; ser ejecutado como root.
d418 3
a420 2
OpenBSD dispone de un simple mecanismo para configurar los alias de ip en
una interfaz.  Para ellos s&oacute;lo tiene que editar el fichero
d422 3
a424 1
El gui&oacute;n <i>/etc/rc</i>, que forma parte de la
d426 4
a429 4
leer&aacute; este fichero durante el proceso de inicio del sistema.
Por ejemplo, supongamos que el usuario tiene una interfaz
<strong>dc0</strong> y pertenece a la red 192.168.0.0.  Otra
informaci&oacute;n de importancia:
d509 1
a509 1
<a href="../faqipf.html">enlace</a>.</h5>
d517 2
a518 2
<em><a href="http://www.openbsd.org/cgi-bin/man.cgi?query=pf.conf&sektion=5">/etc/pf.conf</a></em> y
<em><a href="http://www.openbsd.org/cgi-bin/man.cgi?query=nat.conf&sektion=5">/etc/nat.conf</a></em>.
d523 1
a523 1
el fichero <em><a href="http://www.openbsd.org/cgi-bin/man.cgi?query=rc.conf&sektion=8">/etc/rc.conf</a></em>
d535 5
a539 3
configurar el valor de sysctl <tt>net.inet.ip.forwarding</tt>
a 1.  Para ello debe activar las l&iacute;neas relevantes en
<em><a href="http://www.openbsd.org/cgi-bin/man.cgi?query=sysctl.conf&sektion=5">/etc/sysctl.conf</a></em>
d545 5
a549 3
activado en el fichero <em>/etc/rc.conf</em>, lo puede activar
f&aacute;cilmente con la orden
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=pfctl&sektion=8">pfctl</a>:
d582 1
a588 1
</p>
d657 2
a658 2
cualquier familia de direcciones, inet (v4) o inet6
(v6)&raquo;.
d668 6
a673 3
<em>/etc/protocols</em>, bien por su nombre o su
n&uacute;mero, pero nosotros s&oacute;lo abordaremos TCP, UDP
e ICMP.
d699 1
a699 1
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=services&sektion=5">/etc/services</a>,
d844 1
a844 1
Nuestro grupo de reglas est&aacute; mejorando, cuando lo
d909 2
a910 1
Si pf se encuentra activado en <em>/etc/rc.conf</em>,
d912 1
a912 1
<em>/etc/rc</em>.
d950 2
a951 2
Cuando se examinan los registros, es aconsejable tener mucho
cuidado con la descodificaci&oacute;n del protocolo (la
d966 3
a968 2
car&aacute;cter reservado (como registros de ingreso de telnet
o FTP).
d1001 1
d1004 1
d1094 15
a1108 12
&iquest;y si quisiera conectar por ssh fuera del servidor de
web? o, &iquest;y si necesitara usar lynx para buscar algo en
las p&aacute;ginas de Preguntas Frecuentes?  No podr&iacute;a,
ya que habr&iacute;a bloqueado todas las conexiones entrantes
que no estuvieran dirigidas a los puertos especificados.
Aunque &eacute;sta es la ruta m&aacute;s segura, puede ser muy
poco conveniente.  Al a&ntilde;adir las opciones clave
<em>keep state</em> a la regla &quot;pass out&quot;, puede
permitir el paso de conexiones entrantes que sean respuestas a
conexiones que Vd. haya iniciado previamente, como por ejemplo
al navegar por la web.  Recuerde que es necesario especificar
para qu&eacute; protocolo estamos manteniendo el estado.
d1203 3
a1205 2
le permitir&aacute; llevar a cabo para que su fichero pf.conf
sea m&aacute;s claro y m&aacute;s f&aacute;cil de mantener.
d1349 1
a1349 1
pflogd(8) escribir&aacute; las entradas del registro ip a
d1351 2
a1352 2
es un fichero binario que debe ser leido por tcpdump(8), y NO
directamente por humanos.
d1385 8
a1392 5
registro se lleva a cabo mediante syslogd(8), pero mediante un
d&aelig;mon de registro separado.  Para examinar un tipo de
tr&aacute;fico particular, como se hac&iacute;a con la
opci&oacute;n <em>level</em>, use cualquiera de las opciones
de tcpdump(8) disponibles a este efecto.</li>
d1395 1
a1395 1
cabo <a href="#normalization">scrub</a>.
d1400 1
a1400 1
asignado PF, use la orden <kbd>pfctl -sr</kbd>.
d1413 1
a1413 1
anteriores, pulse <a href="../faqipf.html">aqu&iacute;</a>.</h5>
d1912 1
a1912 1
<em>/etc/nat.rules</em> algo parecido a esto:
a1938 2
+and either rebooting the system or sending a 'HUP' signal to inetd.  One
+way to send the 'HUP' signal is with the command:
d1940 3
a1942 2
<em>inetd</em>.  Una forma de enviar esta se&ntilde;al 'HUP'
es mediante la orden:
d1984 1
a1984 1
siguiente al fichero <em>/etc/nat.rules</em>:
d3632 2
a3633 2
Originally [OpenBSD: faq6.html,v 1.109 2001/11/20 00:39:41 dhartmei Exp ]<br>
$Translation: faq6.html,v 1.38 2001/11/22 17:15:12 horacio Exp $<br>
@


1.29
log
@sync with badlands translation CVS, work by Horacio
@
text
@d12 1
a12 1
<body bgcolor="#ffffff" text="#000000" link="#23238E">
d23 1
a23 1
<li><a href="#6.2">6.2 - Filtros IP</a>
d59 1
a59 1
<a href="http://www.3com.com/solutions/en_US/ncs/501302.html">Understanding IP addressing</a>.
d144 11
a154 8
Si va a actualizar a OpenBSD 2.7 desde una versi&oacute;n m&aacute;s
antigua de OpenBSD, necesita prestar atenci&oacute;n a este punto.
Cualquier referencia en <i>/etc/ifaliases</i>, <i>/etc/ipf.rules</i>, o
<i>/etc/ipnat.rules</i> a los nombres de interfaz antiguos mx, al, ax,
o pn, se debe substituir por dc.  Adem&aacute;s, cualquier fichero
hostname.xxx con las extensiones de interfaz antiguas, se debe
renombrar a hostname.dcX para que pueda ser reconocido.  Substituya X
con el n&uacute;mero de la interfaz.
d337 14
a350 11
&Eacute;sta es la informaci&oacute;n b&aacute;sica que necesita para
configurar su sistema OpenBSD como una pasarela (tambi&eacute;n llamada
&laquo;enrutador&raquo; o &laquo;encaminador&raquo;).  Si piensa usar
OpenBSD como un enrutador en Internet, le sugerimos que lea
tambi&eacute;n la secci&oacute;n con las instrucciones sobre la
configuraci&oacute;n de <a href="#6.2">Filtros IP</a>, para bloquear
tr&aacute;fico potencialmente malicioso.  Adem&aacute;s, debido a la
escasa disponibilidad de direcciones IPv4 en los proveedores de
servicios de redes y registros regionales, es conveniente leer la
secci&oacute;n sobre <a href="#6.3">NAT</a> para informaci&oacute;n
sobre c&oacute;mo conservar su espacio de direcci&oacute;n IP.
d354 6
a359 5
El n&uacute;cleo GENERIC posee la capacidad de permitir IP Forwarding,
pero debe ser activado.  Para ello debe usar la utilidad
<strong>sysctl(8)</strong>.  Para que los cambios sean permanentes,
debe editar el fichero <em>/etc/sysctl.conf</em> para habilitar IP
Forwarding.  Esto lo puede llevar a cabo a&ntilde;adiendo la siguiente
d483 2
a484 1
<h2>6.2 - Filtros IP</h2>
d488 5
a492 8
El paquete de filtros IP, IPFilter, se creó con el fin de gestionar dos
tareas, tratar con permisos
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=ipf&apropos=0&sektion=8&format=html&manpath=OpenBSD+2.7">ipf(8)</a>
para el env&iacute;o a nivel de paquetes y asignar
hu&eacute;spedes/subrredes a un campo de direcciones externas
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=ipnat&apropos=0&sektion=8&format=html&manpath=OpenBSD+2.7">ipnat(8)</a>.
Los ficheros de configuraci&oacute;n para estos dos servicios son
<em>/etc/ipf.rules</em> y <em>/etc/ipnat.rules</em>.
a493 1

d495 7
a501 3
Para iniciar estos servicios con su sistema, antes debe editar el
fichero <em>/etc/rc.conf</em> y activar las siguientes l&iacute;neas
tal y como se muestra a continuaci&oacute;n:
a503 5
<ul><pre>
ipfilter=YES
ipnat=YES
</pre></ul>

d505 3
a507 4
<strong>NOTA:</strong> no siempre es necesario activar ambas opciones,
a menos que vaya a usar los dos.  Sin embargo, si va a usar
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=ipnat&sektion=8&manpath=OpenBSD+2.7">ipnat(8)</a>,
<em>ipfilter</em> tambi&eacute;n tendr&aacute; que ser activado.
a509 13
<p>
Si va a usar
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=ipnat&sektion=8&manpath=OpenBSD+2.7">ipnat(8)</a>,
es muy probable que tambi&eacute;n deba configurar el valor
<em>net.inet.ip.forwarding</em> de sysctl a <code>1</code>.  Puede
hacerlo activando la l&iacute;nea correspondiente en
<em>/etc/sysctl.conf</em>.
</p>

<p>
Si ha compilado IP Filter en su n&uacute;cleo pero no lo ha activado en
el fichero <em>/etc/rc.conf</em>, lo puede activar f&aacute;cilmente.

d512 1
a512 2
# <strong>ipf -Fa -f /etc/ipf.rules -E</strong>
# <strong>ipnat -CF -f /etc/ipnat.rules</strong>
d517 6
a522 4
El indicador <em>-E</em> en ipf `activa' IP Filter.  El indicador
<em>-Fa</em> limpia cualquier regla que pueda tener ah&iacute;.<br>
<em>-f /etc/ipf.rules</em> carga las reglas desde
<em>/etc/ipf.rules</em>.
d525 4
a528 2
Si hace alg&uacute;n cambio en <em>/etc/ipf.rules</em> despu&eacute;s
de haber cargado ipf, puede recargar sus reglas muy f&aacute;cilmente.
d532 3
a534 1
# <strong>ipf -Fa -f /etc/ipf.rules</strong>
d538 12
a549 1
Lo mismo para ipnat...
d553 1
a553 1
# <strong>ipnat -CF -f /etc/ipnat.rules</strong>
d557 4
a560 1
Tambi&eacute;n puede activar <a href="http://www.openbsd.org/cgi-bin/man.cgi?query=ipmon&sektion=8&manpath=OpenBSD+2.7">ipmon(8)</a> para el depurado.
d564 1
a564 1
# <strong>ipmon -Ds</strong>
d567 1
d572 11
a582 11
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=ipf&sektion=8&manpath=OpenBSD+2.7">ipf(8)</a>
y <a href="http://www.openbsd.org/cgi-bin/man.cgi?query=ipnat&sektion=8&manpath=OpenBSD+2.7">ipnat(8)</a>.
Existen muchos ejemplos para ipnat y ipf en <em>/usr/share/ipf</em>, le
recomendamos que escoja el que m&aacute;s se acerque a la
configuraci&oacute;n que Vd. desee, y que lo modifique conforme a sus
necesidades.  Puede encontrar m&aacute;s informaci&oacute;n sobre
Filtros IP en los archivos de la
<a href="http://false.net/ipfilter/">lista de correo IP Filter</a>, en
las <a href="http://coombs.anu.edu.au/~avalon/">p&aacute;ginas de IP
Filter</a>, y en el <a href="http://www.obfuscation.org/ipf/">IP Filter
HOWTO</a>.
d586 1
a586 1
<h3>IPF</h3>
d590 13
a602 11
Para activar ipf desde el momento del inicio del sistema necesita
modificar <em>/etc/rc.conf</em> de modo que lea IPFILTER=YES.  IP
Filter (ipf) est&aacute; controlado por <i>/etc/ipf.rules</i>, que se
leer&aacute; durante el inicio.  Para una explicaci&oacute;n m&aacute;s
detallada lea la p&aacute;gina de manual
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=ipf&sektion=5&manpath=OpenBSD+2.7">ipf(5)</a>.
En los siguientes ejemplos, fxp0 representa la interfaz externa a
internet.  En su caso puede ser diferente seg&uacute;n el adaptador de
ethernet de que disponga en su m&aacute;quina.  En estas reglas se
asumir&aacute; que existe una conexi&oacute;n permanente a internet,
del mismo tipo que la de un servidor de web.
d606 4
a609 3
Las reglas de IP Filter se procesan de modo secuencial desde el principio
hasta el final, siendo de ayuda para visualizar cada paquete que tenga que
atravesar cada regla antes de alcanzar su destino.
d613 11
a623 2
Por ejemplo, el grupo de reglas predefinido permite que entren y salgan
todos los paquetes:
a626 1
pass out from any to any 
d628 1
d632 27
a658 4
Supongamos ahora que no queremos permitir ninguna conexi&oacute;n
entrante por el puerto 3306 (mysql) porque la base de datos s&oacute;lo
deber&iacute;a permitir la conexi&oacute;n de forma local.  En este
caso el grupo de reglas ser&iacute;a as&iacute;:
d662 3
a664 3
pass out from any to any
pass in from any to any
block in on fxp0 from any to any port = 3306
d668 15
a682 7
Que traducido viene a decir lo siguiente: &laquo;bloquear todos los
paquetes entrantes desde cualquier sitio hasta cualquier sitio cuyo
destino sea 3306&raquo;.  Lo que ocurrir&iacute;a es que un paquete
destinado al puerto 3306 en la interfaz fxp0 pasar&iacute;a la primera
regla &quot;pass in&quot;, y acto seguido ser&iacute;a bloqueado por la
regla &quot;block in port = 3306&quot;.  En el caso en que se
invirtieran las reglas de entrada (recuerde que el orden es importante)
d686 3
a688 3
pass out from any to any
block in on fxp0 from any to any port = 3306
pass in from any to any
d692 6
a697 5
los paquetes destinados al puerto 3306 pasar&iacute;an debido a que la
&uacute;ltima regla en el grupo permite que pasen todos los paquetes.
Cuando est&eacute; escribiendo reglas para el filtrado de paquetes es
importante que tenga en cuenta lo siguiente:
<b>La &uacute;ltima regla que concuerde tendr&aacute; precedencia</b>.
d701 5
a705 4
Por supuesto que existen excepciones para toda regla.  La opci&oacute;n
<em>quick</em> filtra el paquete en la primera regla que concuerde.
Veamos el defectuoso ejemplo anterior a&ntilde;adi&eacute;ndole la
opci&oacute;n <em>quick</em> a la regla &quot;block in&quot;:
d709 3
a711 3
pass out from any to any
block in quick on fxp0 from any to any port = 3306
pass in from any to any
d716 6
a721 5
Un paquete destinado para el puerto 3306 ser&aacute; filtrado por la
regla &quot;block in quick&quot; y bloqueado inmediatamente.  Todos los
paquetes destinados a otros puertos no encontrar&aacute;n una
concordancia en las reglas hasta llegar a la regla &quot;pass in&quot;
que permite que pasen todos los paquetes.
d724 1
a724 1
<b>Denegaci&oacute;n predefinida</b>
d727 6
a732 5
La pol&iacute;tica de filtrado de p&aacute;quetes m&aacute;s segura es
la de &laquo;denegaci&oacute;n por definici&oacute;n&raquo;.  Esta
pol&iacute;tica es mucho m&aacute;s segura que la denegaci&oacute;n
expl&iacute;cita de cada servicio protegido, permite grupos de reglas
m&aacute;s breves, y puede proteger de un servicio que haya sido mal
d734 1
d737 8
a744 6
Veamos ahora otro ejemplo de grupo de reglas real, seguido de una
explicaci&oacute;n l&iacute;nea por l&iacute;nea.  El siguiente ejemplo
es para un servidor de web con una pol&iacute;tica de denegaci&oacute;n
predefinida que s&oacute;lo permite conexiones ssh (para
administraci&oacute;n), y conexiones http (puerto 80) y https (puerto
443).
d748 3
a750 3
pass in quick on fxp0 from any to any port = 22
pass in quick on fxp0 from any to any port = 80
pass in quick on fxp0 from any to any port = 443
d757 7
a763 6
Esto permitir&aacute; las conexiones desde cualquier sitio a los
puertos 22 (ssh), 80 (http) y 443 (https).  Cualquier otro intento de
conexi&oacute;n distinto ser&aacute; bloqueado, y permitir&aacute;
todas las conexiones salientes.  Este grupo de reglas es muy estricto.
Pero, &iquest;y si Vd. s&oacute;lo quisiera permitir la conexi&oacute;n
a ssh a hu&eacute;spedes internos en su bloque de direcciones 1.1.1.0,
d769 3
a771 3
pass in quick on fxp0 from 1.1.1.0/24 to any port = 22
pass in quick on fxp0 from any to any port = 80
pass in quick on fxp0 from any to any port = 443
d777 4
a780 3
De acuerdo, pero, &iquest;y si s&oacute;lo quisiera permitir la
administraci&oacute;n remota de su servidor de web a una sola
m&aacute;quina (1.1.1.1)?  En tal caso cambiar&iacute;a esta regla:
d784 1
a784 1
pass in quick on fxp0 from 1.1.1.0/24 to any port = 22
d792 1
a792 1
pass in quick on fxp0 from 1.1.1.1/32 to any port = 22
d795 44
d840 4
a843 3
IP Filter tiene soporte para formas de &quot;netmask address&quot;
tanto CIDR como de punto decimal.  Por tanto podr&iacute;a escribir lo
anterior de esta forma:
d845 6
a850 3
<ul>
<pre>
pass in quick on fxp0 from 1.1.1.1/255.255.255.255 to any port = 22
a852 2

pero, &iquest;para qu&eacute;?
d855 1
a855 1
<b>Ejemplos de reglas</b>
d858 6
a863 4
Aqu&iacute; puede ver algunas buenas reglas que puede usar cualquier
persona (se asume que fxp0 es la interfaz externa conectada a
interner).  Para empezar configuraremos una simple protecci&oacute;n
contra la falsificaci&oacute;n de direcciones.
d867 2
a868 8
block in quick on fxp0 from 127.0.0.0/8 to any
block in quick on fxp0 from 192.168.0.0/16 to any
block in quick on fxp0 from 172.16.0.0/12 to any
block in quick on fxp0 from 10.0.0.0/8 to any
block out quick on fxp0 from any to 127.0.0.1/8
block out quick on fxp0 from any to 192.168.0.0/16
block out quick on fxp0 from any to 172.16.0.0/12
block out quick on fxp0 from any to 10.0.0.0/8
d872 18
a889 2
Tambi&eacute;n es una buena idea separar su interfaz de
<em>loopback</em> de sus otras reglas.
d893 1
a893 2
pass out quick on lo0
pass in quick on lo0
d896 1
d898 6
a903 2
Nuestro grupo de reglas empieza a tener buena pinta;  cuando lo ponemos
todo junto, esto es lo que vemos:
d907 1
a907 40
# loopback rules
pass out quick on lo0
pass in quick on lo0

# no permitir a nadie falsificar direcciones que no puedan ser enrutadas

block in quick on fxp0 from 127.0.0.0/8 to any
block in quick on fxp0 from 192.168.0.0/16 to any
block in quick on fxp0 from 172.16.0.0/12 to any
block in quick on fxp0 from 10.0.0.0/8 to any
block out quick on fxp0 from any to 127.0.0.1/8
block out quick on fxp0 from any to 192.168.0.0/16
block out quick on fxp0 from any to 172.16.0.0/12
block out quick on fxp0 from any to 10.0.0.0/8

# permitir la conexi&oacute;n por ssh s&oacute;lo a nuestra m&aacute;quina de administraci&oacute;n

pass in quick on fxp0 from 1.1.1.1/32 to any port = 22

# permitir que otros usen http y https

pass in quick on fxp0 from any to any port = 80
pass in quick on fxp0 from any to any port = 443

# finalmente, cerrar el resto con una denegaci&oacute;n por definici&oacute;n

block in quick on fxp0 from any to any

# y dejar pasar todo el tr&aacute;fico saliente
# Los indicadores S son para asegurar que el estado del seguimiento
# comience s&oacute;lo en el primer paquete saliente en una
# sesi&oacute;n de tcp.
# El indicador s s&oacute;lo funciona con el protocolo tcp, y son
# necesarias tres entradas para cubrir los tres protocolo (tcp, udp, y
# icmp).

pass out     quick on fxp0 proto tcp  from any to any flags S keep state
pass out     quick on fxp0 proto udp  from any to any         keep state
pass out     quick on fxp0 proto icmp from any to any         keep state
pass out on fxp0 from any to any
a909 1
</p>
d911 2
a912 8
<b>Registro de paquetes</b>

<p>
De momento va bastante bien, pero podr&iacute;a ir mejor.  &iquest;Qué
har&iacute;amos si quisi&eacute;ramos obtener un registro de cualquier
intento de conexi&oacute;n al puerto 22 (ssh) que fuera por nuestro
cortafuegos?  Ser&iacute;a fácil, IP Filter puede gestionar este caso
con la opci&oacute;n clave <em>log</em>:
d916 1
a916 2
pass in quick on fxp0 from 1.1.1.1/32 to any port = 22
block in log quick on fxp0 from any to any port = 22
d920 14
a933 4
Esta regla permitir&aacute; la conexi&oacute;n remota por el puerto 22
a nuestra m&aacute;quina de administraci&oacute;n, pero denegar&aacute;
y registrar&aacute; cualquier otro intento de conexi&oacute;n al puerto
22.
d936 8
a943 1
<b>Filtrado de paquetes seg&uacute;n el protocolo</b>
d946 1
a946 8
IP Filter puede filtrar cualquier protocolo IP bas&aacute;ndose en su
n&uacute;mero o nombre en 
<a href=file://localhost/etc/protocols>/etc/protocols</a>.  Para que se
entienda con m&aacute;s claridad, s&oacute;lo trataremos aqu&iacute;
con tcp, udp, e icmp.  &Eacute;stos son los protocolos de uso
m&aacute;s com&uacute;n.  Todas las aplicaciones b&aacute;sicas de
internet dependen de la disponibilidad y de la correcta operatibilidad
de estos protocolos.
d950 5
a954 6
Para que ipf filtre seg&uacute;n qu&eacute; protocolo, se debe usar la
opci&oacute;n clave <em>proto</em>.  Bas&aacute;ndonos en el ejemplo
anterior, y puesto que ssh funciona sobre tcp, s&oacute;lo
deber&iacute;amos permitir la conexi&oacute;n a paquetes tcp.  Usando
la opci&oacute;n clave <em>proto</em> para permitir s&oacute;lo
conexiones tcp, obtendremos una regla como esta:
d958 2
a959 1
pass in quick on fxp0 proto tcp from 1.1.1.1/32 to any port = 22
d963 3
a965 7
Pero, &iquest;y si necesit&aacute;ramos permitir conexiones a un
servicio como bind que funciona tanto sobre tcp como sobre udp?  En el
caso de tcp/udp, IP Filter nos permite agrupar ambos protocolos en un
s&oacute;lo (Nota: esto s&oacute;lo es v&aacute;lido para tcp/udp).
Usando el ejemplo de bind, una regla que permita conexiones de tcp y
udp en un entorno de denegaci&oacute;n por definici&oacute;n
ser&iacute;a:
d969 2
a970 1
pass in quick on fxp0 proto tcp/udp from any to any port = 53
d975 2
a976 1
<b>Filtrado de paquetes</b>
d979 5
a983 11
Adem&aacute;s de filtrar seg&uacute;n el protocolo, IP Filter
tambi&eacute;n puede gestionar paquetes de IP fragmentados (un
m&eacute;todo com&uacute;n para bular filtros de paquetes).  Hay dos
opciones claves posibles que se pueden usar para tratar paquetes de ip
fragmentados, <em>frag</em> para paquetes de IP fragmentados normales,
o <em>short</em> para paquetes de IP con cabeceras demasiado
peque&ntilde;as para poder compararlas.  Ya que, dependiendo de las
condiciones de conexi&oacute;n, los paquetes fragmentados pueden darse
normalmente, es mejor filtrar s&oacute;lo los paquetes con cabeceras
demasiado peque&ntilde;as como para obtener comparaciones
v&aacute;lidas.  Esto se puede conseguir con la siguiente regla:
d987 1
a987 1
block in quick proto tcp all with short
d991 5
a995 6
&iquest;Y qu&eacute; hay de las Opciones de IP?  IP Filter
tambi&eacute;n puede tratar con ese tipo de paquetes.  Los paquetes se
pueden bloquear si tienen las opciones de IP activadas, o se pueden
bloquear seg&uacute;n las opciones de IP que est&eacute;n activadas.
Por ejemplo, la siguiente regla bloquear&aacute; y crear&aacute; un
registro de todos los paquetes con las opciones de ip activadas.
d997 3
a999 5
<ul>
<pre>
block in log quick on fxp0 all with ipopts
</pre>
</ul>
d1001 8
a1008 6
Sin embargo, esto puede estropear algunas cosas como
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=traceroute&sektion=8&format=html">traceroute(8)</a>.
Tambi&eacute;n es posible especificar qu&eacute; opciones no
ser&aacute;n permitidas.  Por ejemplo, una buena regla es la de
bloquear todos los paquetes con opciones de enrutamiento de fuentes.
Se puede llevar a cabo con esta regla:
d1012 1
a1012 2
block in quick on fxp0 all with opt lsrr
block in quick on fxp0 all with opt ssrr
d1015 1
d1017 4
a1020 2
<b>Indicadores TCP, conexiones establecidas, y mantenimiento del
estado</b>
d1023 10
a1032 9
La principal fuerza de IP Filter reside en su capacidad para filtrar
paquetes bas&aacute;ndose en los indicadores TCP, y mantener conexiones
establecidas y el estado de la conexi&oacute;n.  Se recomienda a todos
los usuarios que deseen filtrar paquetes bas&aacute;ndose en
indicadores TCP que entiendan antes el papel que desempe&ntilde;a cada
indicador.  Por ejemplo, si un usuario quisiera denegar la
conexi&oacute;n a todos los paquetes con los indicadores FIN, URG, y
PSH activados (como por ejemplo un intento de obtener la huella digital
de un sistema operativo por nmap), podr&iacute;a usar una regla como la
d1037 1
a1037 1
block in quick on fxp0 proto tcp from any to any flags FUP
d1046 9
a1054 7
El pr&oacute;ximo truco de IP Filter es su capacidad para
&laquo;mantener el estado&raquo; (<em>keep state</em>).  Se ha descrito
mantener el estado como &laquo;no hablar hasta que no le hablen&raquo;,
o en otras palabras, una vez que se ha establecido una conexi&oacute;n,
los paquetes ya no tienen que atravesar grupos de reglas.  &Eacute;sta
es una potente caracter&iacute;stica que permite escribir unas reglas
mucho m&aacute;s sencillas y seguras.
d1058 19
a1076 16
Por ejemplo, veamos c&oacute;mo se puede aplicar este estado al ejemplo
del grupo de reglas anterior.  &iquest;Todav&iacute;a est&aacute;
confundifo?.  Revis&eacute;moslo: estamos permitiendo el acceso de
gesti&oacute;n desde nuestra m&aacute;quina de clase C al puerto 22
(ssh), y el acceso web a todo el tr&aacute;fico a los puertos 80 (http)
y 443 (https).  Estamos bloqueando el resto de tr&aacute;fico.  Pero,
&iquest;y si quisiera conectar por ssh fuera del servidor de web? o,
&iquest;y si necesitara usar lynx para buscar algo en las
p&aacute;ginas de Preguntas Frecuentes?  No podr&iacute;a, ya que
habr&iacute;a bloqueado todas las conexiones entrantes que no
estuvieran dirigidas a los puertos especificados.  Aunque &eacute;sta
es la ruta m&aacute;s segura, puede ser muy poco conveniente.  Al
a&ntilde;adir las opciones clave <em>keep state</em> a la regla
&quot;pass out&quot;, puede permitir el paso de conexiones entrantes
que sean respuestas a conexiones que Vd. haya iniciado, como por
ejemplo al navegar por la web.  Recuerde que es necesario especificar
d1078 1
d1082 1
a1082 1
pass in quick on fxp0 from 1.1.1.0/24 to any port = 22
d1086 1
a1086 1
pass out on fxp0 proto tcp from any to any keep state
a1088 1
</p>
d1092 16
a1107 13
incremento en la flexibilidad y seguridad de su grupo de reglas, debido
a que IP Filter es extremadamente flexible.  Por ejemplo, en el grupo
de reglas anterior, est&aacute; permitiendo todo el tr&aacute;fico tcp
a los puertos 80 y 443.  A&uacute;n puede ajustarlo un poco m&aacute;s.
Para establecer una conexi&oacute;n tcp s&oacute;lo necesita permitir
que tenga lugar el saludo inicial (<em>&quot;handshake&quot;</em>);
una vez que esto ocurra, puede bloquear el tr&aacute;fico a ese puerto
y permitir a la regla &quot;keep state&quot; que gestione la
conexi&oacute;n.  Para que se complete el saludo inicial, s&oacute;lo
necesita permitir el paso a los paquetes con los indicadores SYN y
SYNACK activados.  Al dejar pasar s&oacute;lo paquetes con SYN y SYNACK
activados puede prevenir muchas formas de escaneos de puertos como
puede ser el escaneo FIN.  Ahora las reglas est&aacute;n de este modo:
d1111 3
a1113 3
pass in quick on fxp0 from 1.1.1.0/24 to any port = 22
pass in quick on fxp0 from any to any port = 80 flags S/SA
pass in quick on fxp0 from any to any port = 443 flags S/SA
d1121 14
a1134 11
Pongamos ahora todas las reglas que tenemos, poni&eacute;ndolas en un
solo paquete de reglas.  Este paquete de reglas tendr&aacute; una
pol&iacute;tica de denegaci&oacute;n predefinida, permitir&aacute;
conexiones de gesti&oacute;n s&oacute;lo desde una red local (mediante
ssh), y permitir&aacute; el paso de tr&aacute;fico entrante en los
puertos 80 (http) y 443 (https).  Adem&aacute;s, proteger&aacute;
contra direcciones de ip falsificadas no enrutables, y bloquear&aacute;
todos los paquetes que no est&eacute;n tan fragmentados que no puedan
ser inspeccionados.  Una configuraci&oacute;n bastante comprensiva para
un servidor de web p&uacute;blico.  He aqu&iacute; c&oacute;mo
quedar&iacute;a <em>/etc/ipf.rules</em>:
d1138 2
a1139 10
# reglas de loopback
pass out quick on lo0
pass in quick on lo0

# bloquear fragmentos diminutos
block in quick proto tcp all with short

# bloquear paquetes enrutados de fuentes
block in quick on fxp0 all with opt lsrr
block in quick on fxp0 all with opt ssrr
d1142 12
a1153 11
block in quick on fxp0 from 127.0.0.0/8 to any
block in quick on fxp0 from 192.168.0.0/16 to any
block in quick on fxp0 from 172.16.0.0/12 to any
block in quick on fxp0 from 10.0.0.0/8 to any
block out quick on fxp0 from any to 127.0.0.1/8
block out quick on fxp0 from any to 192.168.0.0/16
block out quick on fxp0 from any to 172.16.0.0/12
block out quick on fxp0 from any to 10.0.0.0/8

# permitir la conexi&oacute;n por ssh s&oacute;lo a sus m&aacute;quinas
pass in quick on fxp0 from 1.1.1.0/24 to any port = 22
d1156 2
a1157 2
pass in quick on fxp0 from any to any port = 80 flags S/SA
pass in quick on fxp0 from any to any port = 443 flags S/SA
d1159 2
a1160 1
# finalmente, bloquear el resto con una denegaci&oacute;n por definici&oacute;n
d1163 3
a1165 3
# y dejar pasar todo el tr&aacute;fico saliente y mantener el estado
# en conexiones establecidas
pass out on fxp0 proto tcp from any to any keep state
d1171 3
a1173 14
Si tiene problemas puede activar el ingreso en reglas individuales para
analizarlos;  o sea,
pass in log quick on fxp0 from 1.1.1.0/24 to any port = 22<br>
Cuando modifique el fichero de configuraci&oacute;n para obtener
ficheros log de informaci&oacute;n de los paquetes, no se olvide de
hacer que los cambios surtan efecto mediante:
ipf -Fa -f /etc/ipf.rules<br>
ipmon escribir&aacute; las entradas de los ficheros de log en
<em>/var/log/ipflog</em>.<br>
Para m&aacute;s informaci&oacute;n sobre ipf, el
<a href=http://www.obfuscation.org/ipf/ipf-howto.txt>IPF howto</a> es
una fuente excelente, como tambi&eacute;n lo son los recursos
disponibles en las p&aacute;ginas de
<a href=http://coombs.anu.edu.au/~avalon/ip-filter.html>IP Filter</a>.
d1177 1
a1177 2
<a name="6.3"></a>
<h2>6.3 - IPNAT</h2>
d1181 25
a1205 2
Desarrollado sobre un trabajo original de Wayne Fergerstrom 
&lt;wayne@@methadonia.net&gt;
d1208 23
a1230 2
<a name="nat1.0"></a>
<h3><u>6.3.1 Introducci&oacute;n a NAT</u></h3>
d1232 9
a1240 2
<a name="nat1.1"></a>
<b>Secci&oacute;n de Introducci&oacute;n</b>
d1243 1
a1243 11
Esta secci&oacute;n pretende servir de ayuda para aquellos que instalen
y configuren la &laquo;Traducci&oacute;n de Direcciones de Red&raquo;
(NAT, &quot;Network Address Translation&quot;) en una m&aacute;quina
con OpenBSD.
Se asume que el usuario ya ha configurado y activado una m&aacute;quina
con OpenBSD con dos tarjetas de red (una conectada a Internet y la otra
a la red local).
IP NAT funcionar&aacute; en m&aacute;quinas con s&oacute;lo un NIC, sin
embargo, como los paquetes entrar&aacute;n y saldr&aacute;n de la misma
interfaz, las colisiones de ethernet ralentizar&aacute;n el rendimiento
de forma considerable.
d1247 5
a1251 8
Basado en <a href="http://www.geektools.com/rfc/rfc1631.txt">RFC 1631</a>,
ipnat ofrece una forma f&aacute;cil para la asignaci&oacute;n de redes
locales a una direcci&oacute;n &uacute;nica enrutable
(&laquo;real&raquo;) de internet.  Esto es de gran utilidad si no
dispone de direcciones asignadas oficialmente para cada hu&eacute;sped
en su red interna.  Cuando configura redes privadas/internas, puede
aprovechar los bloques de direcciones reservados (asignados en
<a href="http://www.geektools.com/rfc/rfc1918.txt">RFC 1918</a>), como:
d1253 1
d1255 4
a1258 3
10.0.0.0/8 (10.0.0.0 - 10.255.255.255)
172.16.0.0/12 (172.16.0.0 - 172.31.255.255)
192.168.0.0/16 (192.168.0.0 - 192.168.255.255)
d1260 1
d1263 4
a1266 2
<a name="nat1.2"></a>
<b>Terminolog&iacute;a</b>
d1269 35
a1303 4
Los t&eacute;rminos convencionales usados en este documento son
bastante claros.  Con el fin de documentarlos, repasar&eacute; algunos
de estos t&eacute;rminos y la acepci&oacute;n que toman en este
documento.
d1306 5
d1312 11
a1322 1
<strong>&quot;NAT&quot;</strong>
d1324 4
a1327 3
Describe la funci&oacute;n de &laquo;Traducci&oacute;n de Direcciones
de Red&raquo;.  El proceso de NAT se describir&aacute; m&aacute;s
adelante en este documento.
d1329 37
d1368 33
a1400 2
<ul>
<strong>&quot;ipnat&quot;</strong>
d1403 3
a1405 5
Es la abreviaci&oacute;n de &laquo;Traducci&oacute;n de Direcciones de
Red IP&raquo;.  Se puede utilizar de manera indistinta en
substituci&oacute;n de NAT.  Sin embargo, en este documento el
t&eacute;rmino &quot;ipnat&quot; se utilizar&aacute; tan s&oacute;lo
para el uso de la l&iacute;nea de &oacute;rdenes.
a1406 1
</ul>
a1407 2
<ul>
<strong>&quot;IPF&quot;</strong>
d1409 3
a1411 9
Es la abreviaci&oacute;n de &laquo;Filtro IP&raquo;.  IP Filter es un
paquete de software de filtrado portable que se incluye como parte del
sistema OpenBSD.  IP Filter debe estar activado antes de poder activar
ipnat.  Se activa de modo f&aacute;cil, simplemente editando el fichero
<em>/etc/rc.conf</em> y cambiando <em>ipfilter=NO</em> por
<em>ipfilter=YES</em>.  Esto s&oacute;lo lo cambiar para la
secuencia de inicio, y es necesario ejecutar 'ipf -E' para
activar ipf mientras el sistema est&aacute; en funcionamiento.
M&aacute;s adelante se describen estos pasos.
a1412 1
</ul>
d1416 1
a1416 1
<b>Detalles de configuraci&oacute;n</b>
d1419 5
a1423 6
Esta parte se refiere a los detalles de configuraci&oacute;n de las
m&aacute;quinas para este documento.  Su configuraci&oacute;n
ser&aacute; distinta de &eacute;sta, pero el prop&oacute;sito de este
documento es el de ofrecerle una breve idea de c&oacute;mo puede ser,
con el fin de que pueda adaptar esta informaci&oacute;n a su
configuraci&oacute;n.
d1427 2
a1428 1
<b>Sistema operativo de la m&aacute;quina: </b>OpenBSD v2.7 i386<br>
d1430 1
a1430 1
<b>NICs: </b>
d1432 9
a1440 9
	NetGear 10/100MB <b>dc0</b><br>
	Conectada a una LAN EXTERNA (o WAN)<br>
	<b>IP Address: </b>24.5.0.5<br>
	<b>Netmask: </b>255.255.255.0<br>
	<br>
	NetGear 10/100MB <b>dc1</b><br>
	Conectada a una LAN INTERNA<br>
	<b>IP Address: </b>192.168.1.1<br>
	<b>Netmask: </b>255.255.255.0<br>	
d1447 3
a1449 3
	<b>IP Address: </b>24.5.0.5<br>
	<b>Netmask: </b>255.255.255.0<br>
	<b>Gateway: </b>24.5.0.1<br>
d1454 10
a1463 7
En este ejemplo, las m&aacute;quinas de la LAN usan el esquema de
direcciones IP 192.168.1.xxx (donde xxx es un n&uacute;mero
&uacute;nico).  Existe una gran variedad de sistemas operativos
diferentes en la LAN interna, incluidos Windows 98, Windows NT, OpenBSD
y Linux.  Cada m&aacute;quina est&aacute; conectada a un
&quot;hub&quot; designado para uso interno.  Para este documento y sus
ejemplos, el cliente en la LAN asumir&aacute; una direcci&oacute;n IP
d1467 1
a1467 1
<b>Diagrama de configuraci&oacute;n</b>
d1469 15
a1483 14
+-----+              +---------+         +----------+
| Hub |--------- dc1 |   NAT   | dc0 ----| Internet |
+-----+              +---------+         +----------+
  | |
  | +-- Cliente A
  +---- M&aacute;s clientes 

                              +--------------------------+
                              |           LEGEND         |
                              +--------------------------+
                              |   NIC dc0 - 24.5.0.5     |
                              |   NIC dc1 - 192.168.1.1  |
                              | Cliente A - 192.168.1.40 |
                              +--------------------------+
d1494 1
a1494 1
<b>Introducci&oacute;n a NAT</b>
d1497 10
a1506 9
Cada d&iacute;a m&aacute;s empresas y usuarios entran en Internet, y
cada uno debe tener una direcci&oacute;n IP, pero las direcciones IP
p&uacute;blicas son cada vez m&aacute;s dif&iacute;ciles de conseguir.
Para muchas personas la soluci&oacute;n ha sido la
&laquo;Traducci&oacute;n de Direcciones de Red&raquo; (o NAT).  NAT es
un modo muy simple y a la vez muy potente de conectar una LAN a
Internet sin tener que comprar o alquilar direcciones IP para cada
m&aacute;quina.  NAT tambi&eacute;n es conocido como
&laquo;Enmascaramiento de IP&raquo; entre los usuarios de Linux.
d1510 10
a1519 7
Cuando NAT est&aacute; funcionando correctamente, permite que los
usuarios dentro de la LAN puedan acceder a Internet a trav&eacute;s de
diferentes direcciones de IP (la que haya activado con su proveedor).
Cada m&aacute;quina conectada a la LAN usa la direcci&oacute;n IP (de
forma transparente) de la m&aacute;quina que est&aacute; configurada
para usar la direcci&oacute;n de IP asignada por el Proveedor de
Servicion de Internet (ISP).
d1523 22
a1544 19
El modo en que funciona NAT es increiblemente simple.  Cuando un
cliente dentro de la LAN quiere conectar a la m&aacute;quina en
Internet, le env&iacute;a un paquete TCP con un requerimiento de
conexi&oacute;n.  Dentro de la cabecera del paquete TCP se encuentra la
direcci&oacute;n IP del cliente (o sea, 192.168.1.40) y la
direcci&oacute;n IP del anfitri&oacute;n requerido (o sea,
123.45.67.89).  La m&aacute;quina en la que est&aacute; funcionando NAT
intercepta este paquete TCP y cambia la direcci&oacute;n IP del cliente
de 192.168.1.40 a la direcci&oacute;n IP de la m&aacute;quina conectada
a Internet (o sea, 24.5.0.5).  De este modo enga&ntilde;a a la
m&aacute;quina anfitriona, haci&eacute;ndole pensar que la
conexi&oacute;n requerida proviene de la m&aacute;quina con NAT, no de
la m&aacute;quina cliente.  Entonces el anfitri&oacute;n env&iacute;a
de vuelta respuestas a la m&aacute;quina NAT como si &eacute;sta fuera
la que se estuviera conectando.  Cuando la m&aacute;quina NAT recibe
las respuestas, las traduce r&aacute;pidamente y env&iacute;a el
paquete al cliente.  El cliente no tiene ni la m&aacute;s remota idea
de lo que est&aacute; ocurriendo y la falsificaci&oacute;n de la
conectividad a Internet es totalmente transparente.
d1552 2
a1553 2
Cliente ----------------- dc1 [ NAT ] dc0 ---------- Anfitri&oacute;n de Internet
192.168.1.40 --- 192.168.1.1 [ NAT ] 24.5.0.5 --- 123.45.67.89
d1555 7
a1561 7
Paquete TCP SALIENTE                            Paquete TCP SALIENTE
Desde: 192.168.1.40      &gt;&gt;=== NAT ===&gt;&gt;        Desde: 24.5.0.5
Hacia: 123.45.67.89                             Hacia: 123.45.67.89

Paquete TCP ENTRANTE				Paquete TCP ENTRANTE
Desde: 123.45.67.89 				Desde: 123.45.67.89
Hacia: 192.168.1.40      &lt;&lt;=== NAT ===&lt;&lt;        Hacia: 24.5.0.5
d1569 12
a1580 10
Una vez que ya hab&iacute;a conseguido un m&oacute;dem cable en mi
nuevo apartamento me d&iacute; cuenta de que ten&iacute;a un
peque&ntilde;o problema.  &iquest;C&oacute;mo podr&iacute;a conseguir
acceso a Internet para mis compa&ntilde;eros de apartamento si el
m&oacute;dem estaba en mi habitaci&oacute;n?  S&oacute;lo hab&iacute;a
unas pocas opciones que pod&iacute;an ayudarme, y que iban desde
obtener direcciones IP extras, pasando por instalar un servidor proxy,
hasta instalar NAT (no permita que el ejemplo del m&oacute;dem cable le
enga&ntilde;e, NAT es lo suficientemente potente como para enmascarar
un gran red con cientos o incluso miles de m&aacute;quinas).
d1584 10
a1593 6
Existen varias razones por las que decid&iacute; instalar NAT, la
primera de ellas mi econom&iacute;a.  En la casa viv&iacute;an dos
compa&ntilde;eros de piso (cada uno con su propio PC) y yo (con tres
PCs).  Mi ISP s&oacute;lo permit&iacute;a tres direcciones IP por casa,
lo que significaba que no hab&iacute;an suficientes IPs para que cada
m&aacute;quina pudiera tener acceso a Internet.
d1597 4
a1600 3
Usando NAT cada m&aacute;quina tendr&iacute;a una direcci&oacute;n IP
&uacute;nica (interna), pero compartir&iacute;an la &uacute;nica
direcci&oacute;n IP que mi ISP me dio.  El coste se redujo.
d1604 1
a1604 1
<a name="nat2.3"></a>
d1608 5
a1612 5
Para activar NAT en su m&aacute;quina OpenBSD, necesitar&aacute;
configurar IPF y NAT.  Esto se puede llevar a cabo de una manera
f&aacute;cil editando los ficheros que aparecen en la siguiente lista
(haga los cambios al fichero de modo que aparezcan como las opciones
que siguen a continuaci&oacute;n):
d1616 2
a1617 2
<b>/etc/rc.conf</b> (este fichero se usa para iniciar servicios durante
el arranque)
d1620 3
a1622 4
<ul>
	ipfilter=YES<br>
	ipnat=YES
</ul>
d1625 1
a1625 1
<b>/etc/sysctl.conf</b>
d1628 3
a1630 3
<ul>
	net.inet.ip.forwarding=1
</ul>
d1638 2
a1639 2
<a name="nat2.4"></a>
<b>Configuraci&oacute;n</b>
d1642 5
a1646 4
El primer paso es configurar el fichero de reglas de IPF
(<i>/etc/ipf.rules</i>).  Para el prop&oacute;sito que persigue este
documento, dejaremos que el tr&aacute;fico pase a trav&eacute;s de esta
opci&oacute;n de cortafuegos sin que haya interferencias.  El fichero
d1652 2
a1653 2
pass in from any to any
pass out from any to any
d1659 2
a1660 1
<a href="#6.2">secci&oacute;n 6.2</a> de estas Preguntas Frecuentes.
d1665 5
a1669 3
(<i>/etc/ipnat.rules</i>) es bastante simple.  De acuerdo con el
ejemplo de configuraci&oacute;n anterior, el fichero de
configuraci&oacute;n de NAT contendr&aacute; las siguientes entradas:
d1674 1
a1674 2
map dc0 192.168.1.0/24 -&gt; 24.5.0.5/32 portmap tcp/udp 10000:60000
map dc0 192.168.1.0/24 -&gt; 24.5.0.5/32
d1683 1
a1683 1
<strong>&quot;map&quot;</strong>
d1685 2
a1686 3
&Eacute;sta es la orden que se le pasa a ipnat.  Dicha orden indica a
ipnat que &eacute;sta es una entrada para cambiar la direcci&oacute;n
IP entre la LAN e Internet.
d1691 1
a1691 1
<strong>&quot;dc0&quot;</strong>
d1693 2
a1694 1
&Eacute;sta es la interfaz de red que est&aacute; conectada a Internet.
d1699 1
a1699 1
<b>&quot;192.168.1.0/24&quot;</b>
d1704 2
a1705 17
direcci&oacute;n IP con un valor desde 192.168.1.1 hasta 192.168.1.254
debe ser asignado&raquo;.  Si prefiere no usar el formato CIDR, puede
substituir &laquo;/24&raquo; por &laquo;/255.255.255.0&raquo;.
</p>
</ul>

<ul>
<b>&quot;24.5.0.5/32&quot;</b>
<p>
Esta direcci&oacute;n de IP y de enmascaramiento de red indica la
direcci&oacute;n IP que se asignar&aacute; a la LAN.  /32 indica una
sola direcci&oacute;n IP.  Tambi&eacute;n puede asignarle direcciones
IP /24, &oacute; 256 (&oacute; /27, &oacute; cualquier otro
n&uacute;mero de bits que quiera).  Esto &uacute;ltimo es muy
&uacute;til si tiene varios miles de m&aacute;quinas hu&eacute;spedes
detr&aacute;s de su NAT... claro que s&oacute;lo es de utilidad si ese
/24 est&aacute; siendo enrutado a su sistema OpenBSD.
d1710 1
a1710 1
<b>&quot;portmap tcp/udp 10000:60000&quot;</b>
d1712 2
a1713 2
Esto asigna todos los paquetes tcp/udp a puertos desde el 10000 hasta
el 60000.
a1716 28
<p>
La segunda l&iacute;nea tiene casi la misma entrada que la primera,
exceptuando la parte final.  En esta l&iacute;nea se indica a ipnat que
debe asignar cualquier otra cosa (que no sea tcp/udp, ya que esos
paquetes concuerdan en la primera l&iacute;nea) a cualquier puerto que
requiera (usado por ICMP y otros protocolos).  Una vez que esto
est&aacute; en el fichero, s&oacute;lo tiene que ejecutar el
d&aelig;mon IPF.
</p>

<br>

<a name="nat2.5"></a>
<b>NAT selectivo</b>

<p>
Es posible que quiera evitar NAT para un rango de direcciones externas.
Continuando con el ejemplo anterior, supongamos que hay
hu&eacute;spedes en la red 24.5.0.0/28 para los que quiere que su
pasarela NAT sea un simple enrutador, sin traducci&oacute;n de
direcciones.  Puede suprimir la traducci&oacute;n de direcciones para
el tr&aacute;fico desde <em>dc0</em> hasta esta subrred con lo
siguiente:
</p>
<ul><pre>
map dc0 from 192.168.1.0/24 ! to 24.5.0.0/28 -&gt; 24.5.0.5/32 portmap tcp/udp 10000:60000
map dc0 from 192.168.1.0/24 ! to 24.5.0.0/28 -&gt; 24.5.0.5/32
</pre></ul>
d1719 1
a1719 1
<b>Funcionamiento</b>
d1722 4
a1725 5
Ejecutar NAT tambi&eacute;n es un proceso muy sencillo.  Una vez que
haya acabado de configurarlo, hay dos maneras de activar NAT.  La
primera manera, y la mejor si fuera posible comprobar la fase de
configuraci&oacute;n, es reiniciando su sistema OpenBSD.  Para ello
basta que use la orden &laquo;<i>reboot</i>&laquo;.
d1729 2
a1730 2
Si quiere ejecutar ipnat desde la l&iacute;nea de &oacute;rdenes, use
las siguiente &oacute;rdenes:
d1735 2
a1736 2
# ipf -Fa -f /etc/ipf.rules -E
# ipnat -CF -f /etc/ipnat.rules
d1741 5
a1745 15
Con la primera l&iacute;nea de órdenes se activa IPF (recuerde que NAT
depende de IPF, y por lo tanto es necesario iniciar IPF y tenerlo en
funcionamiento antes de poder cargar NAT).  Las opciones en la
l&iacute;nea de &oacute;rdenes &quot;-Fa&quot; limpian cualquier
entrada existente.  &quot;-f /etc/ipf.rules&quot; indica a ipf
d&oacute;nde encontrar el fichero con las reglas.  &quot;-E&quot; es el
interruptor para activar el d&aelig;mon IPF.
</p>

<p>
La segunda l&iacute;nea de &oacute;rdenes es para activar NAT.
&quot;-CF&quot; limpia y descarga todas las entradas existentes en la
tabla de NAT.  &quot;-f /etc/ipnat.rules&quot; indica a NAT
d&oacute;nde encontrar el fichero con las reglas de NAT.  Ahora ya
tiene NAT funcionando.  As&iacute; de sencillo.
d1749 4
a1752 4
<b>Nota:</b> para volver a cargar las configuraciones de NAT (en el
caso en que las cambiara y no quisiera reiniciar) ejecute la segunda
orden de nuevo.  Las configuraciones ser&aacute;n descargadas y
cargadas de nuevo.
d1761 1
a1761 1
<b>Verificar el estado de NAT</b>
d1764 5
a1768 5
Para averiguar c&oacute;mo est&aacute; funcionando NAT o asegurarse de
que las configuraciones hayan hecho efecto, use la opci&oacute;n
&quot;-l&quot;.  Esta opci&oacute;n le mostrar&aacute; un listado de
todas las opciones de configuraci&oacute;n y sesiones actuales que
est&eacute; usando ipnat:
d1773 4
a1776 6
# <b>ipnat -l</b>
map dc0 192.168.1.0/24 -&gt; 24.5.0.5/32 portmap tcp/udp 10000:60000
map dc0 192.168.1.0/24 -&gt; 24.5.0.5/32

List of active sessions:
MAP 192.168.1.40  2473  &lt;- -&gt; 24.5.0.5  13463 [129.128.5.191 80]
d1781 3
a1783 5
El prop&oacute;sito de las primeras dos l&iacute;neas es el de
verificar las configuraciones que se introdujeron anteriormente en
<em>/etc/ipnat.rules</em>.  Cualquier l&iacute;nea a partir de esas dos
mostrar&aacute; una lista de las conexiones que est&eacute;n siendo
actualmente controladas por NAT.
d1787 1
a1787 1
<b>&quot;MAP 192.168.1.40  2473&quot;</b>
d1789 5
a1793 3
Le indica la direcci&oacute;n IP de la m&aacute;quina que est&eacute;
usando NAT en la LAN.  El n&uacute;mero del puerto que se use para
realizar la conexi&oacute;n se mostrar&aacute; a continuaci&oacute;n.
d1798 1
a1798 1
<b>&quot;&lt;- -&gt;&quot;</b>
d1800 3
a1802 2
Indica que NAT est&aacute; gestionando el flujo de tr&aacute;fico en
ambas direcciones.
d1807 1
a1807 1
<b>&quot;24.5.0.5  13463&quot;</b>
d1809 1
a1809 2
Indica que la conexi&oacute;n va a Internet a trav&eacute;s de la
direcci&oacute;n IP 24.5.0.5 y que usa el puerto 13463.
d1814 1
a1814 1
<b>&quot;129.128.5.191 80&quot;</b>
d1816 2
a1817 2
La direcci&oacute;n IP y el puerto por el que se est&aacute; realizando
la conexi&oacute;n.
d1822 9
a1830 1
<b>Limitaciones de NAT (en FTP)</b>
d1833 15
a1847 37
NAT tiene unas pocas limitaciones a tener en cuenta.  Cuando un usuario
conecta a un servidor de FTP remoto y pide informaci&oacute;n o un
fichero a &eacute;ste, el servidor de FTP conectar&aacute; con el
cliente y le transferir&aacute; los datos.  Este proceso se lleva a
cabo por un puerto libre aleatorio.  Pero esto representa un problema
para los usuarios que intentan obtener acceso a los servidores de FTP
desde dentro de la LAN.  Cuando el servidor de FTP env&iacute;a sus
datos, los env&iacute;a al NIC externo en un puerto aleatorio.  La
m&aacute;quina NAT los recibe, pero como no tiene ninguna
asignaci&oacute;n para el paquete desconocido ni para ese puerto en
concreto, suelta el paquete y no lo entrega.

<p>
La soluci&oacute;n a esto est&aacute; en que el usuario se ubique en
&laquo;modo pasivo&raquo; en su cliente de FTP.  De este modo
indicar&aacute; al servidor que desea conectarse a &eacute;ste, y que
no ocurra lo antes mencionado.  As&iacute;, al realizar el usuario la
conexi&oacute;n, NAT la gestionar&aacute; correctamente.

<p>
IP Filter ofrece otra soluci&oacute;n para esta situaci&oacute;n, un
<em>&quot;proxy&quot;</em> de ftp integrado en el c&oacute;digo de NAT.
Para activarlo, debe escribir algo parecido a lo siguiente antes de sus
otras asignaciones para NAT.

<pre>
map dc0 192.168.1.0/24 -&gt; 24.5.0.5/32 proxy port ftp ftp/tcp
</pre>

Con esto, el n&uacute;cleo del sistema observar&aacute; sus conexiones
por FTP para la orden &quot;PORT&quot; que proceda del cliente de ftp,
y substituir&aacute; la direcci&oacute;n IP y el puerto con su propia
direcci&oacute;n IP externa y con un puerto de su elecci&oacute;n.
Obviamente, esto requiere de un uso mucho m&aacute;s intensivo de
recursos pero, a menos que su m&aacute;quina de filtrado NAT/IP esté
alcanzando una masa cr&iacute;tica, no deber&iacute;a darle
ning&uacute;n problema.
d1849 60
d1910 12
d1925 1
a1925 1
<b>Redireccionamiento del tr&aacute;fico</b>
d1928 15
a1942 10
Es posible que haya momentos en los que necesite redireccionar el
tr&aacute;fico entrante o saliente hacia cierto protocolo o puerto.  Un
buen ejemplo de esto podr&iacute;a ser el caso en el que tuviera un
servidor que residiera dentro de la LAN y que estuviera haciendo la
funci&oacute;n de servidor de web.  Las conexiones entrantes a su IP
v&aacute;lido de Internet se encontrar&iacute;an con que, a menos que
su m&aacute;quina NAT fuera el servidor de web, no podr&iacute;an
conectar.  Para solventarlo usaremos la directiva `rdr' de NAT en el
fichero de reglas, para darle las instrucciones sobre a d&oacute;nde
debe redireccionar (o enrutar) una conexi&oacute;n en particular.
d1946 5
a1950 4
Para nuestro ejemplo, supongamos que un servidor de web reside en la
LAN y que su direcci&oacute;n IP es 192.168.1.80.  El fichero de reglas
de NAT necesita una nueva directiva para gestionar esto.  A&ntilde;ada
una l&iacute;nea parecida a la siguiente al fichero ipnat.rules:
d1955 1
a1955 1
rdr dc0 24.5.0.5/32 port 80 -&gt; 192.168.1.80 port 80
d1965 1
a1965 1
<b>&quot;rdr&quot;</b>
d1967 3
a1969 2
Es la orden que le est&aacute; pasando a ipnat.  Indica a ipnat que lo
que sigue es una entrada para redireccionar una conexi&oacute;n.
d1975 1
a1975 1
<b>&quot;dc0&quot;</b>
d1982 5
a1986 4
<b>&quot;24.5.0.5/32&quot;</b>
<p>
Indica que es una conexi&oacute;n entrante a esta dirección IP
(s&oacute;lo en dc0, como arriba).
d1991 1
a1991 1
<b>&quot;port 80&quot;</b>
d1993 8
a2000 6
&Eacute;ste es el puerto (80) que debe ser redireccionado.  El
n&uacute;mero &laquo;80&raquo; no es estrictamente necesario,
tambi&eacute;n podr&iacute;a usar &laquo;port www&raquo; para
especificar una redirecci&oacute;n del puerto 80.  Si desea usar un
nombre en lugar de un n&uacute;mero, el nombre del servicio y el puerto
correspondiente deben existir en el fichero <em>/etc/services</em>.
d2005 1
a2005 1
<b>&quot;192.168.1.80&quot;</b>
d2007 11
a2017 5
Es la direcci&oacute;n IP y de enmascaramiento de red
(<em>&quot;netmask&quot;</em>) de la m&aacute;quina LAN a la que
redireccionan los paquetes.  El enmascaramiento de red es siempre
&laquo;/32&raquo; (y por tanto no es necesario especificarlo), para que
los paquetes puedan ser redirigidos a una m&aacute;quina en particular.
d2026 37
a2062 1
<br>
d2064 2
a2065 1
<b>NAT frente a proxy</b>
d2068 22
a2089 17
La diferencia entre NAT y una aplicaci&oacute;n basada en proxy es que
el software de proxy act&uacute;a como un intermediario entre Internet
y las m&aacute;quinas conectadas a la LAN.  En prinicipio esto no
presenta ning&uacute;n problema, sin embargo cada aplicaci&oacute;n que
quiera ejecutar en su m&aacute;quina y conectarla a Internet a
trav&eacute;s del servidor de proxy, DEBE reconocer el proxy (ser capaz
de usarlo).  No todas las aplicaciones con capaces de esto (en especial
los juegos).  A&uacute;n m&aacute;s, no existen aplicaciones para
servidores de proxy para todos los servicios de Internet.  NAT asigna
su red interna de un modo transparente, para que pueda conectar a
Internet.  La &uacute;nica ventaja de seguridad que proxy tiene sobre
NAT es que el software de proxy puede haber sido programado para
funciones de seguridad, y puede filtrar seg&uacute;n el contenido con
el fin de evitar que una macro de virus se interne en su m&aacute;quina
Windows, o proteger sus programas contra desbordamientos de la memoria
intermedia (<em>&quot;buffer overflows&quot;</em>), y otros peligros.
El mantenimiento de estos filtros es a menudo un trabajo muy pesado.
d2092 1
d2094 2
a2095 1
<b>6.3.4 Referencias y recursos</b>
d2100 6
a2105 9
   <li><em>/etc/ipnat.rules</em> 
       - fichero de reglas de NAT
   <li><em>/etc/rc.conf</em> 
       - fichero para iniciar ipnat e ipf durante el arranque del
	 sistema
   <li><em>/etc/sysctl.conf</em> 
       - fichero para activar IP forwarding
   <li><em>/usr/share/ipf/nat.1</em> 
       - ejemplos de ipnat.rules
d2112 2
a2113 3
<li><a href="http://www.openbsd.org/cgi-bin/man.cgi?query=ipnat&sektion=8&manpath=OpenBSD+2.7">http://www.openbsd.org/cgi-bin/man.cgi?query=ipnat&sektion=8</a>
<li><a href="http://www.openbsd.org/cgi-bin/man.cgi?query=ipnat&sektion=5&manpath=OpenBSD+2.7">P&aacute;gina de manual que muestra la sintaxis correcta de <em>ipnat.rules</em></a>
<li><a href="http://coombs.anu.edu.au/~avalon/">http://coombs.anu.edu.au/~avalon/</a>
d2116 1
a2116 1
<p>
d2121 2
a2122 1
<a name="6.4"></a> <h2>6.4 - DHCP</h2> </p>
d2127 1
a2127 1
Para usar el cliente DHCP incluido en OpenBSD, 
d3598 2
a3599 2
Originally [OpenBSD: faq6.html,v 1.107 2001/10/16 02:00:43 nick Exp ]<br>
$Translation: faq6.html,v 1.37 2001/10/19 14:08:16 horacio Exp $<br>
@


1.28
log
@
sync with badlands translation CVS.
@
text
@d1187 4
a1190 3
<em>/etc/rc.conf</em> y cambiando ipf=NO por ipf=YES.  Esto s&oacute;lo
lo cambiar para la secuencia de inicio, y es necesario ejecutar 'ipf
-E' para activar ipf mientras el sistema est&aacute; en funcionamiento.
d3300 2
a3301 2
Originally [OpenBSD: faq6.html,v 1.106 2001/08/25 09:31:33 jufi Exp ]<br>
$Translation: faq6.html,v 1.36 2001/09/20 02:09:36 horacio Exp $<br>
@


1.27
log
@
Updated.
@
text
@d9 1
a9 1
<meta name="copyright"     content="Este documento es copyright 1998-2000 de OpenBSD.">
d70 2
a71 2
<i>(Nota: existe un proyecto de traducci&oacute;n de RFCs al castellano
conocido como
d2679 1
a2679 1
<li>La implementaci&oacute;n de BIND 8.x en <i>/usr/ports/net/bind8</i> 
a2680 14
<li>Tambi&eacute;n se encuentra disponible
    <a href="http://cr.yp.to/dnscache.html">DNSCache</a>, de D. J.
    Bernstein.  DNSCache tambi&eacute;n se puede encontrar en el
    &aacute;rbol de portes en <em>/usr/ports/net/dnscache/</em>.  Este
    programa incluye un servidor de DNS minimalista que es perfecto
    para sitios que no tengan grandes bases de datos de entradas de
    DNS.  DNSCache se podr&iacute;a manejar por guiones
    (<em>&quot;scripts&quot;</em>) f&aacute;cilmente.  Su
    configuraci&oacute;n no se parece en nada a la de abajo, pero
    est&aacute; bien documentada en su p&aacute;gina web.</li>
<li>Un grupo de personas que estaban particularmente descontentas con
    BIND, decidieron escribir <a href="http://www.dents.org">Dents</a>,
    su propio servidor de DNS, desde cero.  Contiene algunas
    funcionalidades interesantes.</li>
d2739 2
a2740 4
; type    domain                source host/file
backup file
cache
root.cache
d3299 2
a3300 2
Originally [OpenBSD: faq6.html,v 1.101 2001/07/06 07:41:29 horacio Exp ]<br>
$Translation: faq6.html,v 1.35 2001/07/06 11:22:41 horacio Exp $<br>
@


1.26
log
@
ipnat.conf -> ipnat.rules
@
text
@d482 1
a482 1
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=ipf&apropos=0&sektion=8&format=html">ipf(8)</a>
d485 1
a485 1
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=ipnat&apropos=0&sektion=8&format=html">ipnat(8)</a>.
d504 1
a504 1
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=ipnat&sektion=8">ipnat(8)</a>,
d510 1
a510 1
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=ipnat&sektion=8">ipnat(8)</a>,
d552 1
a552 1
Tambi&eacute;n puede activar ipmon para el depurado.
d563 2
a564 2
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=ipf&sektion=8">ipf(8)</a>
y <a href="http://www.openbsd.org/cgi-bin/man.cgi?query=ipnat&sektion=8">ipnat(8)</a>.
d586 1
a586 1
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=ipf&apropos=0&sektion=5&format=html">ipf(5)</a>.
d1813 2
a1814 2
<li><a href="http://www.openbsd.org/cgi-bin/man.cgi?query=ipnat&sektion=8">http://www.openbsd.org/cgi-bin/man.cgi?query=ipnat&sektion=8</a>
<li><a href="http://www.openbsd.org/cgi-bin/man.cgi?query=ipnat&sektion=5&format=html">P&aacute;gina de manual que muestra la sintaxis correcta de <em>ipnat.rules</em></a>
d1836 1
a1836 1
# <strong>echo dhcp >/etc/hostname.xl0</strong>
d1882 1
a1882 1
# <strong>echo xl1 xl2 xl3 >/etc/dhcpd.interfaces</strong>
d3315 2
a3316 2
Originally [OpenBSD: faq6.html,v 1.100 2001/06/14 22:57:01 fgsch Exp ]<br>
$Translation: faq6.html,v 1.34 2001/06/16 00:25:11 horacio Exp $<br>
@


1.25
log
@
Sync with badlands translation CVS, work by Horacio
@
text
@d1702 1
a1702 1
una l&iacute;nea parecida a la siguiente a su ipnat.con:
d3315 2
a3316 2
Originally [OpenBSD: faq6.html,v 1.99 2001/05/06 16:33:15 jufi Exp ]<br>
$Translation: faq6.html,v 1.33 2001/05/06 20:26:29 horacio Exp $<br>
@


1.24
log
@
Sync with badlands translation CVS, work by Horacio
@
text
@d562 8
a569 6
b&aacute;sicos de configuraciones de ipf(8) y ipnat(8).  Existen muchos
ejemplos para ipnat y ipf en <em>/usr/share/ipf</em>, le recomendamos
que escoja el que m&aacute;s se acerque a la configuraci&oacute;n que
Vd. desee, y que lo modifique conforme a sus necesidades.  Puede
encontrar m&aacute;s informaci&oacute;n sobre Filtros IP en los
archivos de la
d3315 2
a3316 2
Originally [OpenBSD: faq6.html,v 1.97 2001/05/05 04:34:09 ericj Exp ]<br>
$Translation: faq6.html,v 1.32 2001/05/05 14:06:03 horacio Exp $<br>
@


1.23
log
@
Sync with badlands translation CVS, work by Horacio
@
text
@d153 2
d480 2
a481 2
El paquete IP Filter se creó con el fin de gestionar dos tareas, tratar
con permisos
d491 24
a514 7
Para activarlos durante el inicio del sistema es necesario editar
<em>/etc/rc.conf</em>.  Tambi&eacute;n es necesario tener la
l&iacute;nea net.inet.ip.forwarding=1 en <em>/etc/sysctl.conf</em> (o
el n&uacute;cleo de su sistema necesita tener activada la opci&oacute;n
IPFORWARDING o GATEWAY).  Y tambi&eacute;n se necesita un n&uacute;cleo
compilado con las opciones IPFILTER y IPFILTER_LOG (los n&uacute;cleos
GENERIC no disponen de estas opciones).
d523 2
a524 2
# ipf -Fa -f /etc/ipf.rules -E
# ipnat -CF -f /etc/ipnat.rules
d529 3
a531 3
El indicador <tt>-E</tt> en ipf 'activa' IP Filter.  El indicador
<tt>-Fa</tt> limpia cualquier regla que pueda tener ah&iacute;.<br>
<tt>-f /etc/ipf.rules</tt> carga las reglas desde
d540 1
a540 1
# ipf -Fa -f /etc/ipf.rules
d548 1
a548 1
# ipnat -CF -f /etc/ipnat.rules
d556 1
a556 1
# ipmon -Ds
d562 1
a562 1
b&aacute;sicos de configuraciones de ipf y ipnat.  Existen muchos
a686 3
#############################
# begin ruleset
#############################
a691 3
##############################
# end ruleset
##############################
a706 3
#############################
# begin ruleset
#############################
a711 3
##############################
# end ruleset
##############################
a781 3
###########################
# begin ruleset
###########################
a782 1

a821 4

#############################
# end ruleset
#############################
a993 3
#############################
# begin ruleset
#############################
a998 3
##############################
# end ruleset
##############################
a1020 3
#############################
# begin ruleset
#############################
a1025 3
##############################
# end ruleset
##############################
a1044 3
###########################
# begin ruleset
###########################
a1078 4

#############################
# end ruleset
#############################
d1503 17
d2742 1
a2742 1
<h4>6.8.5.1 Configuraci&oacute;n en <em>/etc/named</em></h4>
d3313 2
a3314 2
Originally [OpenBSD: faq6.html,v 1.93 2001/04/18 17:59:57 ericj Exp ]<br>
$Translation: faq6.html,v 1.31 2001/04/25 11:43:34 horacio Exp $<br>
@


1.22
log
@
Sync with translation CVS, work by Horacio
@
text
@d59 1
a59 2
<a href="http://www.3com.com/nsc/501302s.html">Understanding IP
addressing</a>.
d3316 2
a3317 2
Originally [OpenBSD: faq6.html,v 1.92 2001/03/30 18:57:15 ericj Exp ]<br>
$Translation: faq6.html,v 1.30 2001/04/06 16:41:15 horacio Exp $<br>
@


1.21
log
@
More updates by Horacio
@
text
@d5 3
a7 3
<meta name="resource-type" content="document">
<meta name="description"   content="the OpenBSD FAQ page">
<meta name="keywords"      content="openbsd,faq">
d9 1
a9 1
<meta name="copyright"     content="This document copyright 1998-2000 by OpenBSD.">
d3032 1
a3032 1
# <strong>ndc restart</strong>
d3317 2
a3318 2
Originally [OpenBSD: faq6.html,v 1.89 2001/03/17 20:59:33 austin Exp ]<br>
$Translation: faq6.html,v 1.29 2001/03/22 12:51:56 horacio Exp $<br>
@


1.20
log
@
Sync with translation CVS. Work by Horacio
@
text
@d3317 2
a3318 2
Originally [OpenBSD: faq6.html,v 1.88 2001/01/27 22:19:47 ericj Exp ]<br>
$Translation: faq6.html,v 1.28 2001/02/24 23:02:28 horacio Exp $<br>
@


1.19
log
@
Sync with Badlands Translation CVS. Work by Horacio
@
text
@d1354 1
a1354 1
<b>Porqu&eacute; usar NAT</b>
d1983 1
a1983 1
</pre></ul></strong>
d3007 1
a3008 1
</pre>
d3317 2
a3318 2
Originally [OpenBSD: faq6.html,v 1.86 2000/12/26 20:07:04 ericj Exp ]<br>
$Translation: faq6.html,v 1.26 2001/01/01 15:54:39 horacio Exp $<br>
@


1.18
log
@
Sync with Badlands Translation CVS. Work by Horacio
@
text
@d34 2
d3133 169
d3317 2
a3318 2
Originally [OpenBSD: faq6.html,v 1.85 2000/12/26 17:06:36 ericj Exp ]<br>
$Translation: faq6.html,v 1.25 2000/12/26 21:12:10 horacio Exp $<br>
@


1.17
log
@
More updates from Horacio.
@
text
@d390 3
d394 1
a394 1
OpenBSD dispone de un simple mecanismo para configurar alias de ip en
d396 3
a398 2
<i>/etc/ifaliases</i>.  El gui&oacute;n <i>/etc/rc</i>, que forma parte
de la <a href="faq10.html#10.3">jerarqu&iacute;a de inicio rc</a>,
d400 3
a402 3
Por ejemplo, supongamos que el usuario tiene una interfaz <b>dc0</b> y
pertenece a la red 192.168.0.0.  Otra informaci&oacute;n de
importancia:
a410 10
El formato del fichero <i>/etc/ifaliases</i> es:
</p>

<ul>
<pre>
[interface] [ip address] [netmask]
</pre>
</ul>

<p>
d420 1
d427 4
a430 26
ligado a la interfaz.  En el siguiente <i>/etc/ifaliases</i> de
ejemplo, se a&ntilde;aden dos alias al dispositivo <b>dc0</b>, el cual,
por cierto, se configur&oacute; como 192.168.0.2 netmask 255.255.255.0.
</p>

<ul>
<pre>
$ <b>cat /etc/ifaliases</b>
dc0	192.168.0.3	255.255.255.255
dc0	192.168.0.4	255.255.255.255
</pre>
</ul>

<p>
Aqu&iacute; se ha usado un s&oacute;lo netmask para todos, para que no
se vuelva a crear un duplicado de la entrada de la tabla de
enrutamiento para la misma red.

<p>
<b>NOTA</b>:<br>

A partir de OpenBSD 2.7, puede configurar los alias en el fichero
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=hostname.if&sektion=5&format=html"><i>/etc/hostname.*</i></a>.
Para realizar la misma configuraci&oacute;n que arriba, tendr&iacute;a
un fichero <i>/etc/hostname.dc0</i> que estar&iacute;a estructurado del
siguiente modo:
d435 1
d3146 2
a3147 2
Originally [OpenBSD: faq6.html,v 1.83 2000/11/30 04:58:09 ericj Exp ]<br>
$Translation: faq6.html,v 1.24 2000/12/01 14:10:59 horacio Exp $<br>
@


1.16
log
@
Updated by Horacio
@
text
@d840 3
a842 3
pass in      quick on fxp0 proto tcp  from any to any flags S keep state
pass in      quick on fxp0 proto udp  from any to any         keep state
pass in      quick on fxp0 proto icmp from any to any         keep state
d3172 2
a3173 2
Originally [OpenBSD: faq6.html,v 1.82 2000/11/24 05:36:07 jeremy Exp ]<br>
$Translation: faq6.html,v 1.23 2000/11/25 14:49:25 horacio Exp $<br>
@


1.15
log
@
more files from horacio
@
text
@d833 10
a842 1

d1107 1
a1107 1
# permitir la conexión por ssh sólo a sus máquinas
d1114 1
a1114 1
# finalmente, bloquear el resto con una denegación por definición
d1117 1
a1117 1
# y dejar pasar todo el tráfico saliente y mantener el estado
d3172 2
a3173 2
Originally [OpenBSD: faq6.html,v 1.81 2000/11/15 22:06:06 chris Exp ]<br>
$Translation: faq6.html,v 1.22 2000/11/20 23:29:01 horacio Exp $<br>
@


1.14
log
@
All updated by Horacio.
@
text
@d57 4
a60 3
<a href="http://www.3com.com/nsc/501302s.html">Understanding IP addressing</a>.
&Eacute;ste es un documento excelente que contiene conocimientos
fundamentales sobre redes de IP.
d66 1
a66 1
<a href="http://www.nexor.com/info/rfc/index/rfc.htm?index/rfc.html">RFC</a>
d69 1
a69 1
<i>(Nota: existe un proyecto de traducción de RFCs al castellano
d74 5
a78 5
Por supuesto que no podr&aacute; leerlos todos, as&iacute; que elija
algunos temas en los que est&eacute; interesado, o que puedan serle
&uacute;tiles en su entorno de trabajo.  Los RFC definen
much&iacute;simas (miles) de las normativas para protocolos en internet
y c&oacute;mo se supone que deben funcionar.
d3163 2
a3164 2
Originally [OpenBSD: faq6.html,v 1.80 2000/11/10 14:03:33 art Exp ]<br>
$Translation: faq6.html,v 1.21 2000/11/11 01:32:47 horacio Exp $<br>
@


1.13
log
@
Sync with Badlands Translation CVS. Work by es Horacio
@
text
@d20 1
a20 1
<ul><h3>Tabla de Contenidos</h3>
d30 1
a30 1
<li><a href="#6.6">6.6 - Afinar Par&aacute;metros de Red</a>
d325 2
a326 1
<h3>6.1.2 - Configuraci&oacute;n del sistema OpenBSD como pasarela</h3>
d3150 3
a3152 3
<a href="index.html">[Volver al &Iacute;ndice Principal]</a>
<a href="faq5.html">[Secci&oacute;n 5.0 - Configuraci&oacute;n del N&uacute;cleo y del Disco]</a>
<a href="faq7.html">[To Secci&oacute;n 7.0 - Controles del Teclado]</a>
d3162 2
a3163 2
Originally [OpenBSD: faq6.html,v 1.79 2000/09/17 16:13:49 jeremy Exp ]<br>
$Translation: faq6.html,v 1.19 2000/09/28 08:26:32 horacio Exp $<br>
@


1.12
log
@
And the updated spanish FAQ. Work by Horacio as well.
@
text
@d80 1
a80 1
<h2>6.1 - Configuraci&oacute;n Inicial de la Red</h2>
d84 2
a85 1
<h3>6.1.1 - Idenficación y Configuración de la Interfaces de Red</h3>
d89 6
a94 6
Lo primero que debe hacer para empezar es identificar su interfaz de red.
En OpenBSD las interfaces se designan por el tipo de tarjeta, no por el tipo
de conexión.
Puede ver su tarjeta de red iniciar durante el arranque, o después del
arranque usando la orden <strong>dmesg(8)</strong>.
También puede ver su interfaz de red usando la orden
d96 2
a97 2
Por ejemplo, vea a continuación la salida originada por dmesg para una 
tarjeta de red ne2k, que usa un nombre de dispositivo ne.
d108 2
a109 2
Si no sabe cuál es el nombre de su dispositivo, aquí tiene una lista de
tarjetas comunes con sus nombres de dispositivo.
d144 6
a149 6
Cualquier referencia en /etc/ifaliases, /etc/ipf.rules, o
/etc/ipnat.rules a los nombres de interfaz antiguos mx, al, ax, o pn, se
debe substituir por dc.  Adem&aacute;s, cualquier fichero hostname.xxx
con las extensiones de interfaz antiguas, se debe renombrar a
hostname.dcX para que pueda ser reconocido.  Substituya X con el
n&uacute;mero de la interfaz.
d154 4
a157 3
También puede comprobar qué interfaces han sido identificadas usando la
utilidad <a href="http://www.openbsd.org/cgi-bin/man.cgi?query=ifconfig&sektion=8&format=html">ifconfig(8)</a>.
He aquí la salida que mostraría un dispositivo ne2k.
d182 1
a182 1
Como habrá podido comprobar, 
d184 10
a193 9
muestra mucha más información de la que necesitamos en este momento.
Pero lo importante aquí es que nos permite ver nuestra interfaz.
En el ejemplo anterior, la tarjeta de la interfaz ya está configurada.
Esto se sabe al ver que los valores ya han sido fijados en 
&quot;inet 10.0.0.38 netmask 0xffffff00 broadcast 10.0.0.255&quot;, y que los
indicadores <strong>UP</strong> y <strong>RUNNING</strong> están activados.
También podrá notar muchas otras interfaces.
A continuación puede ver una lista de interfaces que se supone que deben
estar ahí.
d206 8
a213 8
Si su interfaz no ha sido configurada, el primer paso será crear el fichero
<strong>/etc/hostname.${IF}</strong>, donde el nombre de su interfaz
substituirá ${IF}.
De acuerdo con la información de los ejemplos anteriores, el nombre sería
<strong>/etc/hostname.ne3</strong>.
La composición de este fichero es como sigue a continuación.
Para leer más sobre el formato de este fichero, tome como referencia la
página de manual
d224 2
a225 2
Por lo tanto, para el ejemplo anterior, un nombre correcto sería parecido a
este:
d236 1
a236 1
El siguiente paso será la configuración de su pasarela.
d238 7
a244 7
<strong>/etc/mygate</strong>.
Esto permitirá que su pasarela se active en el momento del arranque.
A continuación deberá configurar sus nombres de servidores
(&quot;nameservers&quot;) y su fichero <strong>/etc/hosts</strong>.
Para configurar sus nombres de servidores debe crear un fichero con el nombre
<strong>/etc/resolv.conf</strong>.
Puede leer más sobre el formato de este fichero en la página de manual
d246 3
a248 3
El siguiente ejemplo es para un uso típico.
En este ejemplo sus servidores de dominio son 125.2.3.4 y 125.2.3.5.
También pertenece al dominio &laquo;sudominio.dom&raquo;.
d262 3
a264 3
Desde este punto ya puede reiniciar o bien ejecutar el guión de configuración
<strong>/etc/netstart</strong>.
Puede hacerlo escribiendo (como root):
d278 5
a282 5
Fíjese en que se producen un pequeño número de errores, pero éstos se
refieren a la interfaz de loopback.
Por lo tanto puede ignorar estos errores.
A partir de aquí su sistema debería funcionar correctamente.
Puede hacer una comprobación con 
d284 5
a288 5
para asegurarse de que su interfaz se configuró correctamente.
También puede comprobar sus rutas con <strong>netstat(1)</strong> o
<strong>route(8)</strong>.
A continuación puede ver un ejemplo de cómo ver sus tablas de rutas usando
ambas herramientas.
d325 1
a325 1
<h3>6.1.2 - Configuración del Sistema OpenBSD como Pasarela</h3>
d329 11
a339 11
Ésta es la información básica que necesita para configurar su sistema OpenBSD
como una pasarela (también llamada &laquo;enrutador&raquo; o
&laquo;encaminador&raquo;).
Si piensa usar OpenBSD como un enrutador en Internet, le sugerimos que lea
también la sección con las instrucciones sobre la configuración de
<a href="#6.2">Filtros IP</a>, para bloquear tráfico potencialmente
malicioso.
Además, debido a la escasa disponibilidad de direcciones IPv4 en los
proveedores de servicios de redes y registros regionales, es conveniente
leer la sección sobre <a href="#6.3">NAT</a> para información sobre cómo
conservar su espacio de dirección IP.
d343 6
a348 7
El núcleo GENERIC posee la capacidad de permitir IP Forwarding, pero debe ser
activado.
Para ello debe usar la utilidad <strong>sysctl(8)</strong>.
Para que los cambios sean permanentes, debe editar el fichero
<strong>/etc/sysctl.conf</strong> para habilitar IP Forwarding.
Esto lo puede llevar a cabo añadiendo la siguiente línea en ese fichero de
configuración.
d358 4
a361 4
Para que este cambio surja efecto sin tener que reiniciar el sistema, use
directamente la utilidad <strong>sysctl(8)</strong>.
Recuerde que este cambio todavía no existirá después de reiniciar, y que
necesitará ser ejecutado como root.
d372 3
a374 3
A continuación modifique las rutas en los otros huéspedes de ambos lados.
OpenBSD ofrece muchas posibilidades de uso como enrutador, usando software
como 
d378 3
a380 3
OpenBSD dispone de soporte para gated y mrtd en la colección de portes.
OpenBSD incluye soporte para varias interfaces T1, HSSI, ATM, FDDI, Ethernet,
e interfaces de serie (PPP/SLIP).
d385 1
a385 1
<h3>6.1.3 - Configuración de Alias en una Interfaz.</h3>
d389 5
a393 6
OpenBSD dispone de un simple mecanismo para configurar alias de ip en una
interfaz.
Para ellos sólo tiene que editar el fichero <i>/etc/ifaliases</i>.
El guión <i>/etc/rc</i>, que forma parte de la 
<a href="faq10.html#10.3">jerarquía de inicio rc</a>, leerá este fichero
durante el proceso de inicio del sistema.
d395 2
a396 2
pertenece a la red 192.168.0.0.
Otra información de importancia:
d467 3
a469 3
Una vez que haya configurado este fichero será necesario reiniciar para que
los cambios funcionen.
Sin embargo, puede hacer efectivos los alias a mano, usando la utilidad
d501 8
a508 6
El paquete IP Filter se creó con el fin de gestionar dos tareas, tratar con
permisos <a href="http://www.openbsd.org/cgi-bin/man.cgi?query=ipf&apropos=0&sektion=8&format=html">ipf(8)</a>
para el envío a nivel de paquetes y asignar huéspedes/subrredes a un campo de
direcciones externas <a href="http://www.openbsd.org/cgi-bin/man.cgi?query=ipnat&apropos=0&sektion=8&format=html">ipnat(8)</a>.
Los ficheros de configuración para estos dos servicios son /etc/ipf.rules y
/etc/ipnat.rules.
d513 6
a518 6
/etc/rc.conf.
También es necesario tener la línea net.inet.ip.forwarding=1 en
/etc/sysctl.conf (o el núcleo de su sistema necesita tener activada la opción
IPFORWARDING o GATEWAY).
Y también se necesita un núcleo compilado con las opciones IPFILTER y
IPFILTER_LOG (los núcleos GENERIC no disponen de estas opciones).
d522 2
a523 2
Si ha compilado IP Filter en su núcleo pero no lo ha activado en el fichero
/etc/rc.conf, lo puede activar fácilmente.
d533 4
a536 3
El indicador <tt>-E</tt> en ipf 'activa' IP Filter.
El indicador <tt>-Fa</tt> limpia cualquier regla que pueda tener ahí.<br>
<tt>-f /etc/ipf.rules</tt> carga las reglas desde /etc/ipf.rules.
d539 2
a540 2
Si hace algún cambio en /etc/ipf.rules después de haber cargado ipf, puede
recargar sus reglas muy fácilmente.
d556 8
d565 11
a575 9
A partir de aquí este documento cubrirá algunos aspectos básicos de
configuraciones de ipf y ipnat.
Existen muchos ejemplos para ipnat y ipf en /usr/share/ipf, le recomendamos
que escoja el que más se acerque a la configuración que Vd. desee, y que lo 
modifique conforme a sus necesidades.
Puede encontrar más información sobre Filtros IP en los archivos de la
<a href="http://false.net/ipfilter/">lista de correo IP Filter</a>, en las
<a href="http://coombs.anu.edu.au/~avalon/">páginas de IP Filter</a>, y en el
<a href="http://www.obfuscation.org/ipf/">IP Filter HOWTO</a>.
d583 5
a587 5
Para activar ipf desde el momento del inicio del sistema necesita modificar
/etc/rc.conf de modo que lea IPFILTER=YES.
IP Filter (ipf) está controlado por /etc/ipf.rules, que se leerá durante el
inicio.
Para una explicación más detallada lea la página de manual
d589 5
a593 5
En los siguientes ejemplos, fxp0 representa la interfaz externa a internet.
En su caso puede ser diferente según el adaptador de ethernet de que disponga
en su máquina.
En estas reglas se asumirá que existe una conexión permanente a internet, del
mismo tipo que la de un servidor de web.
d603 2
a604 2
Por ejemplo, el grupo de reglas predefinido permite que entren y salgan todos
los paquetes:
d613 4
a616 4
Supongamos ahora que no queremos permitir ninguna conexión entrante por el
puerto 3306 (mysql) porque la base de datos sólo debería permitir la conexión
de forma local.
En este caso el grupo de reglas sería así:
d626 7
a632 8
Que traducido viene a decir lo siguiente: &laquo;bloquear todos los paquetes
entrantes desde cualquier sitio hasta cualquier sitio cuyo destino sea
3306&raquo;.
Lo que ocurriría es que un paquete destinado al puerto 3306 en la interfaz
fxp0 pasaría la primera regla &quot;pass in&quot;, y acto seguido sería
bloqueado por la regla &quot;block in port = 3306&quot;.
En el caso en que se invirtieran las reglas de entrada (recuerde que el orden
es importante)
d642 5
a646 5
los paquetes destinados al puerto 3306 pasarían debido a que la última regla
en el grupo permite que pasen todos los paquetes.
Cuando esté escribiendo reglas para el filtrado de paquetes es importante que
tenga en cuenta lo siguiente:
<b>La última regla que concuerde tendrá precedencia</b>.
d650 4
a653 4
Por supuesto que existen excepciones para toda regla.
La opción <em>quick</em> filtra el paquete en la primera regla que concuerde.
Veamos el defectuoso ejemplo anterior añadiéndole la opción <em>quick</em> a
la regla &quot;block in&quot;:
d664 24
a687 23
Un paquete destinado para el puerto 3306 será filtrado por la regla 
&quot;block in quick&quot; y bloqueado inmediatamente.
Todos los paquetes destinados a otros puertos no encontrarán una concordancia
en las reglas hasta llegar a la regla &quot;pass in&quot; que permite que
pasen todos los paquetes.
</p>

<b>Denegación Predefinida</b>

<p>
La política de filtrado de páquetes más segura es la de &laquo;denegación 
por definición&raquo;.
Esta política es mucho más segura que la denegación explícita de cada
servicio protegido, permite grupos de reglas más breves, y puede proteger de
un servicio que haya sido mal configurado de modo accidental y que haya
quedado expuesto.

<p>
Veamos ahora otro ejemplo de grupo de reglas real, seguido de una explicación
línea por línea.
El siguiente ejemplo es para un servidor de web con una política de
denegación predefinida que sólo permite conexiones ssh (para administración),
y conexiones http (puerto 80) y https (puerto 443).
d706 7
a712 8
Esto permitirá las conexiones desde cualquier sitio a los puertos 22 (ssh),
80 (http) y 443 (https).
Cualquier otro intento de conexión distinto será bloqueado, y permitirá todas
las conexiones salientes.
Este grupo de reglas es muy estricto.
Pero, ¿y si Vd. sólo quisiera permitir la conexión a ssh a huéspedes internos
en su bloque de direcciones 1.1.1.0, y al mismo tiempo permitir conexiones
externas a http y https?
d731 3
a733 3
Muy bien, pero, ¿y si sólo quisiera permitir la administración remota de su
servidor de web a una sola máquina (1.1.1.1)?
En tal caso cambiaría esta regla:
d749 3
a751 3
IP Filter tiene soporte para formas de &quot;netmask address&quot; tanto CIDR
como de punto decimal.
Por tanto podría escribir lo anterior de esta forma:
d759 1
a759 1
pero, ¿para qué?
d762 1
a762 1
<b>Ejemplos de Reglas</b>
d765 4
a768 4
He aquí algunas buenas reglas para que las pueda usar cualquier persona (se
asume que fxp0 es la interfaz externa conectada a interner).
Para empezar configuraremos una simple protección contra la falsificación de
direcciones.
d783 2
a784 2
También es una buena idea separar su interfaz de loopback de sus otras
reglas.
d793 2
a794 2
Nuestro grupo de reglas empieza a tener buena pinta;  cuando lo ponemos todo
junto, esto es lo que vemos:
d817 1
a817 1
# permitir la conexión por ssh sólo a nuestra máquina de administración
d826 1
a826 1
# finalmente, cerrar el resto con una denegación por definición
d830 1
a830 1
# y dejar pasar todo el tráfico saliente
d841 1
a841 1
<b>Registro de Paquetes</b>
d844 5
a848 5
De momento va bastante bien, pero podría ir mejor.
¿Qué haríamos si quisiéramos obtener un registro de cualquier intento de
conexión al puerto 22 (ssh) que fuera por nuestro cortafuegos?
Sería fácil, IP Filter puede gestionar este caso con la opción clave 
<em>log</em>:
d857 4
a860 3
Esta regla permitirá la conexión remota por el puerto 22 a nuestra máquina de
administración, pero denegará y registrará cualquier otro intento de conexión
al puerto 22.
d863 1
a863 1
<b>Filtrado de Paquetes según el Protocolo</b>
d877 6
a882 6
Para que ipf filtre según qué protocolo, se debe usar la opción clave 
<em>proto</em>.
Basándonos en el ejemplo anterior, y puesto que ssh funciona sobre tcp, sólo
deberíamos permitir la conexión a paquetes tcp.
Usando la opción clave <em>proto</em> para permitir sólo conexiones tcp,
obtendremos una regla como esta:
d890 7
a896 6
Pero, ¿y si necesitáramos permitir conexiones a un servicio como bind que
funciona tanto sobre tcp como sobre udp?
En el caso de tcp/udp, IP Filter nos permite agrupar ambos protocolos en un
sólo (Nota: esto sólo es válido para tcp/udp).
Usando el ejemplo de bind, una regla que permita conexiones de tcp y udp en
un entorno de denegación por definición sería:
d905 1
a905 1
<b>Filtrado de Paquetes</b>
d908 11
a918 10
Además de filtrar según el protocolo, IP Filter también puede gestionar
paquetes de IP fragmentados (un método común para bular filtros de paquetes).
Hay dos opciones claves posibles que se pueden usar para tratar paquetes de
ip fragmentados, <em>frag</em> para paquetes de IP fragmentados normales, o
<em>short</em> para paquetes de IP con cabeceras demasiado pequeñas para
poder compararlas.
Ya que, dependiendo de las condiciones de conexión, los paquetes fragmentados
pueden darse normalmente, es mejor filtrar sólo los paquetes con cabeceras
demasiado pequeñas como para obtener comparaciones válidas.
Esto se puede conseguir con la siguiente regla:
d926 6
a931 6
¿Y qué hay de las Opciones de IP?
IP Filter también puede tratar con ese tipo de paquetes.
Los paquetes se pueden bloquear si tienen las opciones de IP activadas, o se
pueden bloquear según las opciones de IP que estén activadas.
Por ejemplo, la siguiente regla bloqueará y creará un registro de todos los
paquetes con las opciones de ip activadas.
d941 3
a943 3
También es posible especificar qué opciones no serán permitidas.
Por ejemplo, una buena regla es la de bloquear todos los paquetes con
opciones de enrutamiento de fuentes.
d953 2
a954 1
<b>Indicadores TCP, Conexiones Establecidas, y Mantenimiento del Estado</b>
d957 10
a966 9
La principal fuerza de IP Filter reside en su capacidad para filtrar paquetes
basándose en los indicadores TCP, y mantener conexiones establecidas y el
estado de la conexión.
Se recomienda a todos los usuarios que deseen filtrar paquetes basándose en
indicadores TCP que entiendan antes el papel que desempeña cada indicador.
Por ejemplo, si un usuario quisiera denegar la conexión a todos los paquetes
con los indicadores FIN, URG, y PSH activados (como por ejemplo un intento de
obtener la huella digital de un sistema operativo por nmap), podría usar una
regla como la siguiente:
d974 2
a975 1
(Gracias a <a href=mailto:halogen@@nol.net>Kyle Hargraves</a> por esa regla)
d979 7
a985 7
El próximo truco de IP Filter es su capacidad para &laquo;mantener el
estado&raquo;.
Se ha descrito mantener el estado como &laquo;no hablar hasta que no le
hablen&raquo;, o en otras palabras, una vez que se ha establecido una
conexión, los paquetes ya no tienen que atravesar grupos de reglas.
Ésta es una potente característica que permite escribir unas reglas mucho más
sencillas y seguras.
d989 17
a1005 16
Por ejemplo, veamos cómo se puede aplicar este estado al ejemplo del grupo de
reglas anterior.
¿Todavía está confundifo?.
Revisémoslo: estamos permitiendo el acceso de gestión desde nuestra máquina 
de clase C al puerto 22 (ssh), y el acceso web a todo el tráfico a los
puertos 80 (http) y 443 (https).
Estamos bloqueando el resto de tráfico.
Pero, ¿y si quisiera conectar por ssh fuera del servidor de web? o,
¿y si necesitara usar lynx para buscar algo en las páginas de Preguntas
Frecuentes?
No podría, ya que habría bloqueado todas las conexiones entrantes que no
estuvieran dirigidas a los puertos especificados.
Aunque ésta es la ruta más segura, puede ser muy poco conveniente.
Al añadir las opciones clave <em>keep state</em> a la regla &quot;pass
out&quot;, puede permitir el paso de conexiones entrantes que sean respuestas
a conexiones que Vd. haya iniciado, como por ejemplo al navegar por la web.
d1016 1
a1016 1
pass out on fxp0 from any to any keep state
d1030 9
a1038 9
Para establecer una conexión tcp sólo necesita permitir que tenga lugar
el saludo inicial (&quot;handshake&quot;);  una vez que esto ocurra,
puede bloquear el tráfico a ese puerto y permitir a la regla &quot;keep
state&quot; que gestione la conexión.  Para que se complete el saludo
inicial, sólo necesita permitir el paso a los paquetes con los
indicadores SIN y SIN/ACK activados.  Al dejar pasar sólo paquetes con
SIN y SIN/ACK activados puede prevenir muchas formas de escaneos de
puertos como puede ser el escaneo FIN.  Ahora las reglas están de este
modo:
d1049 1
a1049 1
pass out on fxp0 from any to any keep state
d1058 11
a1068 10
Pongamos ahora todas las reglas que tenemos, poniéndolas en un solo paquete
de reglas.
Este paquete de reglas tendrá una política de denegación predefinida,
permitirá conexiones de gestión sólo desde una red local (mediante ssh), y
permitirá el paso de tráfico entrante en los puertos 80 (http) y 443 (https).
Además, protegerá contra direcciones de ip falsificadas no enrutables, y
bloqueará todos los paquetes que no estén tan fragmentados que no puedan ser
inspeccionados.
Una configuración bastante comprensiva para un servidor de web público.
He aquí cómo quedaría /etc/ipf.rules:
d1108 1
a1108 1
pass out on fxp0 from any to any keep state
d1118 14
a1131 4
Para más información sobre ipf, el
<a href=http://www.obfuscation.org/ipf/ipf-howto.txt>IPF howto</a> es una
fuente excelente, como también lo son los recursos disponibles en las páginas
de <a href=http://coombs.anu.edu.au/~avalon/ip-filter.html>IP Filter</a>.
d1166 6
a1171 6
ipnat ofrece una forma fácil para la asignación de redes locales a una
dirección única enrutable (&laquo;real&raquo;) de internet.
Esto es de gran utilidad si no dispone de direcciones asignadas oficialmente
para cada huésped en su red interna.
Cuando configura redes privadas/internas, puede aprovechar los bloques de
direcciones reservados (asignados en
d1182 1
a1182 1
<b>Terminología</b>
d1185 4
a1188 3
Los términos convencionales usados en este documento son bastante claros.
Con el fin de documentarlos, repasaré algunos de estos términos y la acepción
que toman en este documento.
d1194 3
a1196 2
Describe la función de &laquo;Traducción de Direcciones de Red&raquo;.
El proceso de NAT se describirá más adelante en este documento.
d1204 5
a1208 4
Es la abreviación de &laquo;Traducción de Direcciones de Red IP&raquo;.
Se puede utilizar de manera indistinta en substitución de NAT.
Sin embargo, en este documento el térmitno &quot;ipnat&quot; se utilizará tan
sólo para el uso de la línea de órdenes.
d1215 8
a1222 9
Es la abreviación de &laquo;Filtro IP&raquo;.
IP Filter es un paquete de software de filtrado portable que se incluye como
parte del sistema OpenBSD.
IP Filter debe estar activado antes de poder activar ipnat.
Se activa de modo fácil, simplemente editando el fichero /etc/rc.conf y
cambiando ipf=NO por ipf=YES.
Esto sólo lo cambiar para la secuencia de inicio, y es necesario ejecutar
'ipf -E' para activar ipf mientras el sistema está en funcionamiento.
Más adelante se describen estos pasos.
d1228 1
a1228 1
<b>Detalles de Configuración</b>
d1231 6
a1236 5
Esta parte se refiere a los detalles de configuración de las máquinas para
este documento.
Su configuración será distinta de ésta, pero el propósito de este documento
es el de ofrecerle una breve idea de cómo puede ser, con el fin de que pueda
adaptar esta información a su configuración.
d1240 1
a1240 1
<b>Sistema Operativo de la Máquina: </b>OpenBSD v2.7 i386<br>
d1255 3
a1257 2
<b>IP enrutable por Internet, externo (en este ejemplo, una conexión por
módem analógico provista por un Proveedor de Servicios de Internet)<br></b>
d1264 1
a1264 1
<b>Red de Área Local (LAN)</b><br>
d1266 8
a1273 7
En este ejemplo, las máquinas de la LAN usan el esquema de direcciones IP
192.168.1.xxx (donde xxx es un número único).
Existe una gran variedad de sistemas operativos diferentes en la LAN interna,
incluidos Windows 98, Windows NT, OpenBSD y Linux.
Cada máquina está conectada a un &quot;hub&quot; designado para uso interno.
Para este documento y sus ejemplos, el cliente en la LAN asumirá una
dirección IP 192.168.1.40
d1276 1
a1276 1
<b>Diagrama de Configuración</b>
d1298 1
a1298 1
<h3><u>6.3.2 Traducción de Direcciones de Red</u></h3>
d1302 1
a1302 1
<b>Introducción a NAT</b>
d1305 9
a1313 9
Cada día más empresas y usuarios entran en Internet, y cada uno debe tener
una dirección IP, pero las direcciones IP públicas son cada vez más 
difíciles de conseguir.
Para muchas personas la solución ha sido la &laquo;Traducción de Direcciones
de Red&raquo; (o NAT).
NAT es un modo muy simple y a la vez muy potente de conectar una LAN a
Internet sin tener que comprar o alquilar direcciones IP para cada máquina.
NAT también es conocido como &laquo;Enmascaramiento de IP&raquo; entre los
usuarios de Linux.
d1317 7
a1323 6
Cuando NAT está funcionando correctamente, permite que los usuarios dentro de
la LAN puedan acceder a Internet a través de diferentes direcciones de IP (la
que haya activado con su proveedor).
Cada máquina conectada a la LAN usa la dirección IP (de forma transparente)
de la máquina que está configurada para usar la dirección de IP asignada por
el Proveedor de Servicion de Internet (ISP).
d1327 19
a1345 17
El modo en que funciona NAT es increiblemente simple.
Cuando un cliente dentro de la LAN quiere conectar a la máquina en Internet,
le envía un paquete TCP con un requerimiento de conexión.
Dentro de la cabecera del paquete TCP se encuentra la dirección IP del
cliente (o sea, 192.168.1.40) y la dirección IP del anfitrión requerido (o
sea, 123.45.67.89).
La máquina en la que está funcionando NAT intercepta este paquete TCP y
cambia la dirección IP del cliente de 192.168.1.40 a la dirección IP de la
máquina conectada a Internet (o sea, 24.5.0.5).
De este modo engaña a la máquina anfitriona, haciéndole pensar que la
conexión requerida proviene de la máquina con NAT, no de la máquina cliente.
Entonces el anfitrión envía de vuelta respuestas a la máquina NAT como si
ésta fuera la que se estuviera conectando.
Cuando la máquina NAT recibe las respuestas, las traduce rápidamente y envía
el paquete al cliente.
El cliente no tiene ni la más remota idea de lo que está ocurriendo y la
falsificación de la conectividad a Internet es totalmente transparente.
d1349 1
a1349 1
El ejemplo siguiente muestra NAT de un modo más claro:
d1353 1
a1353 1
Cliente ----------------- dc1 [ NAT ] dc0 ---------- Anfitrión de Internet
d1367 1
a1367 1
<b>Porqué Usar NAT</b>
d1370 10
a1379 9
Una vez que ya había conseguido un módem cable en mi nuevo 
apartamento me dí cuenta de que tenía un pequeño problema.
¿Cómo podría conseguir acceso a Internet para mis compañeros de apartamento
si el módem estaba en mi habitación?
Sólo había unas pocas opciones que podían ayudarme, y que iban desde obtener
direcciones IP extras, pasando por instalar un servidor proxy, hasta instalar
NAT (no permita que el ejemplo del módem cable le engañe, NAT es lo 
suficientemente potente como para enmascarar un gran red con cientos o 
incluso miles de máquinas).
d1383 6
a1388 6
Existen varias razones por las que decidí instalar NAT, la primera de ellas
mi economía.
En la casa vivían dos compañeros de piso (cada uno con su propio PC) y yo
(con tres PCs).
Mi ISP sólo permitía tres direcciones IP por casa, lo que significaba que no
habían suficientes IPs para que cada máquina pudiera tener acceso a Internet.
d1392 3
a1394 3
Usando NAT cada máquina tendría una dirección IP única (interna), pero
compartirían la única dirección IP que mi ISP me dio.
El coste se redujo.
d1399 1
a1399 1
<b>Preconfiguración</b>
d1402 5
a1406 4
Para activar NAT en su máquina OpenBSD, necesitará configurar IPF y NAT.
Esto se puede llevar a cabo de una manera fácil editando los ficheros que
aparecen en la siguiente lista (haga los cambios al fichero de modo que
aparezcan como las opciones que siguen a continuación):
d1410 2
a1411 2
<b>/etc/rc.conf</b> (este fichero se usa para iniciar servicios durante el
                    arranque)
d1428 2
a1429 2
Después de haber hecho estos cambios, la máquina estará lista para la
configuración de NAT.
d1434 1
a1434 1
<b>Configuración</b>
d1438 4
a1441 4
(<i>/etc/ipf.rules</i>).
Para el propósito que persigue este documento, dejaremos que el tráfico pase
a través de esta opción de cortafuegos sin que haya interferencias.
El fichero será como sigue:
d1452 2
a1453 2
Para más información puede leer la <a href="#6.2">sección 6.2</a> de estas
Preguntas Frecuentes.
d1457 4
a1460 4
La sintaxis del fichero de configuración de NAT (<i>/etc/ipnat.rules</i>) es
bastante simple.
De acuerdo con el ejemplo de configuración anterior, el fichero de
configuración de NAT contendrá las siguientes entradas:
d1471 1
a1471 1
He aquí lo que significan estas líneas.
d1477 2
a1478 2
Ésta es la orden que se le pasa a ipnat.
Dicha orden indica a ipnat que ésta es una entrada para cambiar la dirección
d1486 1
a1486 1
Ésta es la interfaz de red que está conectada a Internet.
d1493 6
a1498 6
La dirección IP y de enmascaramiento de red (&quot;netmask&quot;, cuyo
formato es CIDR).
La combinación de ambas indica que &laquo;cualquier dirección IP con un valor
desde 192.168.1.1 hasta 192.168.1.254 debe ser asignado&raquo;.
Si prefiere no usar el formato CIDR, puede substituir &laquo;/24&raquo; por
&laquo;/255.255.255.0&raquo;.
d1505 8
a1512 8
Esta dirección de IP y de enmascaramiento de red indica la dirección IP que
se asignará a la LAN.
/32 indica una sola dirección IP.
También puede asignarle direcciones IP /24, ó 256 (ó /27, ó cualquier otro
número de bits que quiera).
Esto último es muy útil si tiene varios miles de máquinas huéspedes detrás de
su NAT... claro que sólo es de utilidad si ese /24 está siendo enrutado a su
sistema OpenBSD.
d1519 2
a1520 2
Esto asigna todos los paquetes tcp/udp a puertos desde el 10000 hasta el 
60000.
d1525 7
a1531 7
La segunda línea tiene casi la misma entrada que la primera, exceptuando la
parte final.
En esta línea se indica a ipnat que debe asignar cualquier otra cosa (que no
sea tcp/udp, ya que esos paquetes concuerdan en la primera línea) a cualquier
puerto que requiera (usado por ICMP y otros protocolos).
Una vez que esto está en el fichero, sólo tiene que ejecutar el d&aelig;mon
IPF.
d1540 5
a1544 5
Ejecutar NAT también es un proceso muy sencillo.
Una vez que haya acabado de configurarlo, hay dos maneras de activar NAT.
La primera manera, y la mejor si fuera posible comprobar la fase de
configuración, es reiniciando su sistema OpenBSD.
Para ello basta que use la orden &laquo;<i>reboot</i>&laquo;.
d1548 2
a1549 2
Si quiere ejecutar ipnat desde la línea de órdenes, use las siguiente
órdenes:
d1560 7
a1566 8
Con la primera línea de órdenes se activa IPF (recuerde que NAT depende de 
IPF, y por lo tanto es necesario iniciar IPF y tenerlo en funcionamiento antes 
de poder cargar NAT).
Las opciones en la línea de órdenes &quot;-Fa&quot; limpian cualquier entrada
existente.
&quot;-f /etc/ipf.rules&quot; indica a ipf dónde encontrar el fichero con las
reglas.
&quot;-E&quot; es el interruptor para activar el d&aelig;mon IPF.
d1570 5
a1574 6
La segunda línea de órdenes es para activar NAT.
&quot;-CF&quot; limpia y descarga todas las entradas existentes en la tabla
de NAT.
&quot;-f /etc/ipnat.rules&quot; indica a NAT dónde encontrar el fichero con
las reglas de NAT.
Ahora ya tiene NAT funcionando.  Así de sencillo.
d1578 4
a1581 3
<b>Nota:</b> para volver a cargar las configuraciones de NAT (en el caso en
que las cambiara y no quisiera reiniciar) ejecute la segunda orden de nuevo.
Las configuraciones serán descargadas y cargadas de nuevo.
d1586 1
a1586 1
<h3><u>6.3.3 Base de Conocimientos de NAT</u></h3>
d1590 1
a1590 1
<b>Verificar el Estado de NAT</b>
d1593 5
a1597 4
Para averiguar cómo está funcionando NAT o asegurarse de que las
configuraciones hayan hecho efecto, use la opción &quot;-l&quot;.
Esta opción le mostrará un listado de todas las opciones de configuración y
sesiones actuales que esté usando ipnat:
d1612 5
a1616 4
El propósito de las primeras dos líneas es el de verificar las
configuraciones que se introdujeron anteriormente en /etc/ipnat.rules.
Cualquier línea a partir de esas dos mostrará una lista de las conexiones que
estén siendo actualmente controladas por NAT.
d1622 3
a1624 3
Le indica la dirección IP de la máquina que esté usando NAT en la LAN.
El número del puerto que se use para realizar la conexión se mostrará a
continuación.
d1631 2
a1632 1
Indica que NAT está gestionando el flujo de tráfico en ambas direcciones.
d1639 2
a1640 2
Indica que la conexión va a Internet a través de la dirección IP 24.5.0.5 y
que usa el puerto 13463.
d1647 2
a1648 1
La dirección IP y el puerto por el que se está realizando la conexión.
d1656 24
a1679 25
NAT tiene unas pocas limitaciones a tener en cuenta.
Cuando un usuario conecta a un servidor de FTP remoto y pide información o un
fichero a éste, el servidor de FTP conectará con el cliente y le transferirá
los datos.
Este proceso se lleva a cabo por un puerto libre aleatorio.
Pero esto representa un problema para los usuarios que intentan obtener
acceso a los servidores de FTP desde dentro de la LAN.
Cuando el servidor de FTP envía sus datos, los envía al NIC externo en un
puerto aleatorio.
La máquina NAT los recibe, pero como no tiene ninguna asignación para el
paquete desconocido ni para ese puerto en concreto, suelta el paquete y no
lo entrega.

<p>
La solución a esto está en que el usuario se ubique en &laquo;modo
pasivo&raquo; en su cliente de FTP.
De este modo indicará al servidor que desea conectarse a éste, y que no
ocurra lo antes mencionado.
Así, al realizar el usuario la conexión, NAT la gestionará correctamente.

<p>
IP Filter ofrece otra solución para esta situación, un &quot;proxy&quot; de
ftp integrado en el código de NAT.
Para activarlo, debe escribir algo parecido a lo siguiente antes de sus otras
asignaciones para NAT.
d1685 8
a1692 7
Con esto, el núcleo del sistema observará sus conexiones por FTP para la
orden &quot;PORT&quot; que proceda del cliente de ftp, y substituirá la
dirección IP y el puerto con su propia dirección IP externa y con un puerto
de su elección.
Obviamente, esto requiere de un uso mucho más intensivo de recursos pero, a
menos que su máquina de filtrado NAT/IP esté alcanzando una masa crítica, no
debería darle ningún problema.
d1698 1
a1698 1
<b>Redireccionamiento del Tráfico</b>
d1701 10
a1710 10
Es posible que haya momentos en los que necesite redireccionar el tráfico
entrante o saliente hacia cierto protocolo o puerto.
Un buen ejemplo de esto podría ser el caso en el que tuviera un servidor que
residiera dentro de la LAN y que estuviera haciendo la función de servidor de
web.
Las conexiones entrantes a su IP válido de Internet se encontrarían con que, 
a menos que su máquina NAT fuera el servidor de web, no podrían conectar.
Para solventarlo usaremos la directiva `rdr' de NAT en el fichero de reglas,
para darle las instrucciones sobre a dónde debe redireccionar (o enrutar) una
conexión en particular.
d1714 4
a1717 4
Para nuestro ejemplo, supongamos que un servidor de web reside en la LAN y
que su dirección IP es 192.168.1.80.
El fichero de reglas de NAT necesita una nueva directiva para gestionar esto.
Añada una línea parecida a la siguiente a su ipnat.con:
d1727 2
a1728 1
Desglosando esta línea para ver qué signfica cada componente de ella:
d1734 2
a1735 3
Es la orden que le está pasando a ipnat.
Indica a ipnat que lo que sigue es una entrada para redireccionar una
conexión.
d1743 1
a1743 1
Es la interfaz de red que está conectada a Internet.
d1750 2
a1751 2
Indica que es una conexión entrante a esta dirección IP (sólo en dc0, como
arriba).
d1758 6
a1763 5
Éste es el puerto (80) que debe ser redireccionado.
El número &laquo;80&raquo; no es estrictamente necesario, también podría usar 
&laquo;port www&raquo; para especificar una redirección del puerto 80.
Si desea usar un nombre en lugar de un número, el nombre del servicio y el
puerto correspondiente deben existir en el fichero /etc/services.
d1770 5
a1774 5
Es la dirección IP y de enmascaramiento de red (&quot;netmask&quot;) de la
máquina LAN a la que redireccionan los paquetes.
El enmascaramiento de red es siempre &laquo;/32&raquo; (y por tanto no es
necesario especificarlo), para que los paquetes puedan ser redirigidos a una
máquina en particular.
d1779 2
a1780 2
Cuando haya terminado de añadir todos los datos, recargue las reglas de NAT y
el redireccionamiento comezará de inmediato.
d1785 1
a1785 1
<b>NAT frente a Proxy</b>
d1788 16
a1803 17
La diferencia entre NAT y una aplicación basada en proxy es que el software
de proxy actúa como un intermediario entre Internet y las máquinas conectadas
a la LAN.
En prinicipio esto no presenta ningún problema, sin embargo cada aplicación
que quiera ejecutar en su máquina y conectarla a Internet a través del
servidor de proxy, DEBE reconocer el proxy (ser capaz de usarlo).
No todas las aplicaciones con capaces de esto (en especial los juegos).
Aún más, no existen aplicaciones para servidores de proxy para todos los
servicios de Internet.
NAT asigna su red interna de un modo transparente, para que pueda conectar a
Internet.
La única ventaja de seguridad que proxy tiene sobre NAT es que el software de
proxy puede haber sido programado para funciones de seguridad, y puede
filtrar según el contenido con el fin de evitar que una macro de virus se 
interne en su máquina Windows, o proteger sus programas contra
desbordamientos de la memoria intermedia (&quot;buffer overflows&quot;), y
otros peligros.
d1808 1
a1808 1
<b>6.3.4 Referencias y Recursos</b>
d1813 9
a1821 5
   <li>/etc/ipnat.rules - fichero de reglas de NAT
   <li>/etc/rc.conf - fichero para iniciar ipnat e ipf durante el arranque 
       del sistema
   <li>/etc/sysctl.conf - fichero para activar IP forwarding
   <li>/usr/share/ipf/nat.1 - ejemplos de ipnat.rules
d1829 1
a1829 1
<li><a href="http://www.openbsd.org/cgi-bin/man.cgi?query=ipnat&sektion=5&format=html">Página de manual que muestra la sintaxis correcta de ipnat.rules</a>
d1845 4
a1848 3
edite el fichero /etc/hostname.xl0 (suponiendo que su interfaz principal de
ethernet sea xl0;  la suya podría ser ep0, o fxp0, o cualquier otra).
Todo lo que necesita añadir a este fichero es 'dhcp'.
d1854 3
a1856 3
Esto hará que OpenBSD inicie el cliente DHCP automáticamente durante el
arranque.
OpenBSD obtendrá la información sobre su dirección IP, pasarela, y servidores
d1860 3
a1862 2
Si quiere iniciar un cliente dhcp desde la línea de órdenes, asegúrese de que
el fichero /etc/dhclient existe, y entonces escriba:
d1871 5
a1875 5
Sea cual fuere el modo en que inicie dhclient, puede <b>evitar</b> que se
actualice su DNS de acuerdo con la idea que tenga el servidor dhcp sobre la
DNS, comentando las líneas precedidas por 'request' (son ejemplos de la
configuración predefinida, pero necesita activarlos para anular la
configuración predefinida de dhclient)
d1882 3
a1884 2
y a continuación <b>eliminar</b> domain-name-servers.
También es posible que también desee anular hostname u otras configuraciones.
d1891 1
a1891 1
edite el fichero /etc/rc.conf.  Config&uacute;relo poniendo
d1893 1
a1893 1
/etc/dhcp.interfaces las interfaces en las que quiera que dhcp
d1900 1
a1900 2
y edite /etc/dhcpd.conf.
Las opciones son bastante claras:
d1914 9
a1922 8
Con esto indicará a sus clientes dhcp que el dominio que deben añadir a sus
requerimientos de DNS es xyz.mil (así, si un usuario escribiera 'telnet joe',
los enviaría a joe.xyz.mil).
Les dirigirá a los servidores de DNS 192.168.1.3 y 192.168.1.5.
Para los huéspedes que se encuentren en la misma red que una interfaz de
ethernet en la máquina de OpenBSD, que está en el rango 192.168.1.0/24, les
asignará una dirección de IP entre 192.168.1.32 y 192.168.1.127, configurando
su pasarela por definición como 192.168.1.1.
d1925 2
a1926 2
Si quiere iniciar dhcpd desde la línea de órdenes, después de editar
/etc/dhcpd.conf intente lo siguiente:
d1936 4
a1939 3
Si está actuando como servidor de DHCP para una máquina Windows, es posible
que quiera que dhcp ofrezca al cliente una dirección de servidor 'WINS'.
Para ello añada la siguiente línea al fichero /etc/dhcpd.conf:
d1946 1
a1946 1
Para ver más opciones que puedan aceptar sus clientes DHCP, lea
d1954 3
a1956 3
El &laquo;Protocolo Punto a Punto&raquo; es el que se suele usar para crear
una conexión con su ISP a través de un modem.
OpenBSD puede hacer esto de dos maneras:
d1959 1
a1959 1
   <li><a href="http://www.openbsd.org/cgi-bin/man.cgi?query=pppd&sektion=8&format=html">pppd(8)</a> - Es el d&aelig;mon ppp del núcleo del sistema.
d1964 3
a1966 3
Primero trataremos el d&aelig;mon del modo de usuario.
Para empezar necesitará algo de información sobre su isp.
He aquí una lista de la información que necesitará:
d1970 5
a1974 4
   <li>El número de teléfono de conexión de su proveedor (ISP)
   <li>Su &quot;nameserver&quot; (nombre del servidor) 
   <li>Su nombre de usuario y contraseña
   <li>Su pasarela
d1978 3
a1980 3
Parte de esta información no es estrictamente necesaria, pero será de gran
ayuda para configurar ppp.
El d&aelig;mon PPP de modo usuario utiliza el fichero
d1982 4
a1985 4
como fichero de configuración.
Existen muchos ficheros en <b>/etc/ppp</b> de gran utilidad, que pueden
contener diferentes ejemplos de configuración para situaciones distintas.
Le aconsejamos que mire en ese directorio.
d1989 3
a1991 2
En caso de no estar usando un núcleo GENERIC, asegúrese de que tiene la
siguiente línea en su fichero de configuración:
d1999 1
a1999 1
<h3>Configuración Inicial para PPP(8)</h3>
d2002 12
a2013 12
La configuración inicial del d&aelig;mon PPP de modo usuario consiste en
editar su fichero <b>/etc/ppp/ppp.conf</b>.
Este fichero no existe y debe ser creado, pero puede tomar el fichero
<b>/etc/ppp/ppp.conf.sample</b>, editarlo, y crear su propio fichero
<b>ppp.conf</b> a partir de ahí.
Aquí empezaré con la más simple, y probablemente más utilizada,
configuración.
A continuación puede ver un pequeño fichero <b>ppp.conf</b> que llevará a
cabo la conexión con su ISP y usará sus rutas predefinidas y su
&quot;nameserver&quot;.
Para este fichero, toda la información que necesitará será el número de
teléfono de su ISP, su nombre de usuario, y su contraseña.
d2027 8
a2034 7
<b>AVISO</b> - En OpenBSD 2.6, el sistema salió con un fichero
<i>/etc/ppp/ppp.conf.example</i> que contenía una configuración errónea para
el dispositivo.
El dispositivo era <i>"set device /dev/cuaa0"</i> cuando en realidad debía
ser <i>/dev/cua00</i>, que corresponde al dispositivo para el puerto de
comunicaciones 1 (COM1).
Su dispositivo podría no estar en COM1, aún así este esquema era erróneo.
d2038 6
a2043 5
La sección en la opción <b>default:</b> será ejecutada cada vez.
En ella se configura toda la información crítica.
Con &quot;set log&quot; se configuran los niveles de ingreso.
Esto se puede cambiar;  para más información sobre cómo configurar los
niveles de ingreso lea la página de manual
d2045 9
a2053 9
El dispositivo se configura con &quot;set device&quot;.
Éste es el dispositivo en el que se encuentra el modem.
En este ejemplo el modem está en el puerto de comunicaciones 2 (COM2),
mientras que el puerto de comunicaciones 1 correspondería a /dev/cua00.
Con &quot;set speed&quot; se configura la velocidad de la conexión por
llamada, y con &quot;set dial&quot; se configura los parámetros de la
llamada.
Con esto se puede cambiar el tiempo muerto, etc...
Es conveniente dejar esta línea más o menos como está.
d2057 8
a2064 9
A continuación puede pasar a configurar la información específica para su
ISP.
Para ello debe añadir otra opción en la sección <b>default:</b>.
Puede dar cualquier nombre a esta etiqueta, pero lo más fácil es darle el
nombre de su ISP.
En el ejemplo usaremos <b>myisp:</b> para la opción que hará referencia a
nuestro ISP.
He aquí una configuración simple que incorpora todo lo necesario para
conectar:
d2080 9
a2088 9
Aquí hemos configurado información esencial para un ISP específico.
La primera opción, &quot;set phone&quot;, es para configurar el número de 
teléfono para la conexión de su ISP.
La opción &quot;set login&quot; es para configurar sus opciones de ingreso.
En el ejemplo hemos puesto un tiempo muerto de espera de 5, lo que significa
que terminará nuestro intento de ingreso después de 5 segundos su no hay
transportador.
De lo contrario esperará hasta recibir un &quot;login&quot; para enviar su
nombre de usuario y contraseña.
d2090 5
a2094 6
&quot;ppp&quot;.
Estos valores hay que substituirlos por otros reales.
La opción &quot;set timeout&quot; es para configurar el tiempo de espera para
todo el proceso de ingreso.
La opción &quot;set ifaddr&quot; es algo complicada.
He aquí una explicación más extensa sobre ella:
d2102 1
a2102 1
Hemos configurado la línea anterior con el formato 
d2104 12
a2115 12
[triggeradr]]]]</b>&quot;.
De este modo el primer IP que se especifique es el que querremos como nuestro
IP.
Sin tiene una dirección IP estática, escríbala aquí.
En el ejemplo hemos usado /0, que indica que no es necesario que concuerde
ningún bit de esta dirección ip, y que se puede substituir todo.
El segundo IP que se especifique es el que esperamos como el IP de nuestro
ISP.
Si lo sabe lo puede especificar aquí, pero en la línea no sabemos cuál se
asignará, así que dejaremos que nos lo digan.
Esto es muy útil al negociar con algunas implementaciones PPP que no asignan
un número IP a menos que su conexión les requiera ``0.0.0.0''.
d2119 15
a2133 15
La siguiente opción &quot;add default HISADDR&quot; es para configurar la
ruta predefinida a su IP.
Si su IP cambiara, la ruta se actualizaría de forma automática.
Con &quot;enable dns&quot; indicamos a nuestro ISP que autentifique nuestras
direcciones &quot;nameservers&quot;.
No haga esto si está usando una DNS local, ya que ppp circunvalará su uso
introduciendo algunas líneas en /etc/resolv.conf.
</p>

<h3>Cómo Usar PPP(8)</h3>

<p>
Ahora que ya tenemos el fichero <b>ppp.conf</b> configurado, podemos intentar
una conexión con nuestro ISP.
A continuación se darán algunos detalles sobre argumentos de uso común con
d2138 6
a2143 4
   <li><b>ppp -auto myisp</b> - Inicia ppp, configura sus interfaces, le
       conecta con su isp, y a continuación pasa a un plano de fondo.
   <li><b>ppp -ddial myisp</b> - Parecido a -auto, pero si su conexión
       cayera volvería a conectar.
d2147 4
a2150 3
Si usa <b>/usr/sbin/ppp</b> sin pasarle ninguna opción, le pasará al modo
interactivo, desde donde podrá interaccionar directamente con el modem.
De este modo puede depurar problemas en su fichero <b>ppp.conf</b>.
d2153 1
a2153 1
<h3>Acciones extras con ppp(8)</h3>
d2156 4
a2159 4
Si necesitara ejecutar órdenes al tiempo que conecta o desconecta, puede
hacerlo creando dos ficheros extras.
<b>/etc/ppp/ppp.linkup</b> y <b>/etc/ppp/ppp.linkdown</b>.
Puede ver ejemplos de configuración para estos ficheros en:
d2168 1
a2168 1
Puede encontrar más información en
d2175 1
a2175 1
<h2>6.6 - Afinar Parámetros de Red</h2>
d2177 7
a2183 6
<h3>6.6.1 - ¿Cómo puedo forzar al núcleo del sistema para obtener un mayor
número de reintentos y tiempos de espera mayores en las sesiones TCP?</h3>

Para problemas de conexión o enrutamiento puede usar lo siguiente.
Tenga en cuenta que para que sea más efectivo, ambos lados de la conexión
deben usar valores similares.
d2194 3
a2196 3
Si usa sysctl -a podrá ver los valores actuales de estos y muchos otros
parámetros.
Para cambiar cualquiera de ellos, use <tt>sysctl -w</tt>, como por ejemplo en
d2199 1
a2199 1
<h3>6.6.2 - ¿Cómo puedo activar emisiones dirigidas?</h3>
d2201 3
a2203 3
Por regla general no es aconsejable hacer esto, ya que si su sistema OpenBSD
es un enrutador, permite que puedan enviar tráfico a la dirección o 
direcciones de emisión de sus redes.
d2206 6
a2211 6
En algunos casos, como en redes cerradas, puede tener cierta utilidad, en
particular cuando esté usando implementaciones antiguas del protocolo
NetBIOS.
Se puede activar con <tt>sysctl -w net.inet.ip.directed-broadcast=1</tt>.
Para saber porqué se encuentra desactivado por definición, infórmese sobre
<a href="http://www.netscan.org">ataques &quot;smurf&quot;</a>.
d2213 2
a2214 2
<h3>6.6.3 - No quiero que el núcleo haga asignaciones dinámicas de ciertos
puertos</h3>
d2216 2
a2217 2
También existe un sysctl para esto.
De la página de manual de
d2221 6
a2226 5
Añada la lista de puertos TCP que no deberían ser asignados dinámicamente por
el núcleo.  Esto se puede usar para evitar que algunos daemons se apropien de
un puerto específico que sea necesario para el funcionamiento de otro
programa.  La lista de elementos puede ir separada por comas y/o espacios en
blanco.
d2230 2
a2231 1
También se pueden añadir o eliminar puertos de la lista actual.
d2241 4
a2244 4
El &laquo;Sistema de Archivos de Red&raquo; (NFS, &quot;Network File
System&quot;) se usa para compartir un sistema de archivos en una red.
Algunas páginas de manual que debería leer antes de que intente configurar un
servidor de NFS son:
d2255 24
a2278 23
En esta sección se detallarán los pasos para una configuración simple de NFS.
El ejemplo ofrece detalles sobre un servidor en una LAN, con clientes que
tengan acceso NFS en la LAN.
En esta sección no se tratará sobre la seguridad de NFS.
Asumiremos que Vd. ya ha configurado su paquete de filtrado, u otra protección
de cortafuegos, para prevenir el acceso desde el exterior.
Si su configuración permite el acceso desde el exterior a su servidor de NFS,
y si tiene algún tipo de datos confidenciales o importantes, le recomendamos
encarecidamente que haga uso de <a href="faq13.html">IPSec</a>.
De otro modo existe la posibilidad de que extraños puedan ver su tráfico NFS.
También sería posible que alguien pretendiera estar en la dirección IP que
tenga autorizada la entrada en su servidor NFS.
Existen varios tipos de ataques efectivos en este aspecto.
Cuando IPSec está correctamente configurado, protege contra todos estos tipos
de ataques.

<p>
Otra nota importante sobre seguridad.
No se limite a añadir un sistema de archivos a /etc/exports sin algún tipo de
lista de húespedes autorizados.
Sin una lista de huéspedes que puedan montar un directorio particular,
cualquiera que pueda llegar a su huésped podrá montar sus directorios de NFS
en <i>exports</i>.
d2282 8
a2289 9
La configuración consiste en un servidor con el ip <b>10.0.0.1</b>, que
servirá NFS sólo a clientes dentro de esa red.
El primer paso para configurar NFS es configurar su fichero 
<i>/etc/exports</i>.
Este fichero se compone de una lista con los sistemas de archivo que quiera
que se encuentren accesibles por medio de NFS, y define quién puede acceder a
cada uno de ellos.
Existen muchas opciones que puede usar en su fichero <i>/etc/exports</i>, y
es conveniente leer la página de manual
d2291 2
a2292 2
En este ejemplo empezaremos con un fichero <i>/etc/exports</i> como el
siguiente:
d2295 2
a2296 1
<ul><pre>
d2302 2
a2303 1
</pre></ul>
d2306 9
a2314 9
Esto quiere decir que el sistema de archivo local <b>/work</b> estará
disponible por medio de NFS.
<b>-alldirs</b> indica que los clientes podrán montar en cualquier parte del
punto de montaje <b>/work</b>.
<b>-ro</b> indica que sólo se permitirá montarlo en modo de sólo lectura.
Los dos últimos argumentos indican que sólo los clientes dentro de la red
10.0.0.0 que usen una máscara de red 255.255.255.0, estarán autorizados a
montar este sistema de archivo.
Esto es importante en algunos servidores accesibles desde diferentes redes.
d2318 16
a2333 16
Una vez que su fichero <i>/etc/exports</i> haya sido configurado, puede
seguir adelante y configurar su servidor NFS.
Primero debería asegurarse de que las opciones NFSSERVER y NFSCLIENT se
encuentren en la configuración del núcleo de su sistema (el núcleo GENERIC
incluye estas opciones).
A continuación debe configurar <strong>nfs_server=YES</strong> en el fichero
<i>/etc/rc.conf</i>.
De este modo, cuando reinicie el sistema, se activarán nfsd(8) y mountd(8).
Ahora ya puede continuar e iniciar los d&aelig;mons Vd. mismo.
Estos d&aelig;mons deben ser iniciados por root, y debe asegurarse de que
portmap(8) se encuentre funcionando en su sistema.
El ejemplo que sigue sobre cómo iniciar nfsd(8) sirve tanto para TCP como
para UDP usando 4 d&aelig;mons.
Para gestionar el máximo número de requerimientos de clientes concurrentes
a los que quiera dar servicio, debe activar un número apropiado de
d&aelig;mons del servidor NFS.
d2344 3
a2346 4
No sólo debe iniciar el servidor nfsd(8), sino que también necesita iniciar
mountd(8).
Éste es el d&aelig;mon que da servicio a los requerimientos para montar en
NFS.
d2357 3
a2359 3
Si hace algún cambio al fichero /etc/exports mientras NFS esté funcionando,
tendrá que avisar a mountd sobre el cambio pasándole una señal
&quot;HUP&quot;:
d2369 1
a2369 1
<h3>Comprobación de estadísticas en NFS</h3>
d2372 3
a2374 3
Puede llevar a cabo comprobaciones para asegurarse de que estos d&aelig;mons
estén funcionando y registrados con RPC.
Para ello use rcpinfo(8).
d2396 3
a2398 3
Durante su uso normal, existen unas pocas utilidades más que le permitirán
ver lo que está ocurriendo con NFS.
Una de ellas es
d2400 5
a2404 5
que le permite ver qué se encuentra montado y quién lo está montando.
También está nfsstat(8), que muestra una información de las estadísticas
mucho más amplia.
Para usar showmount(8) escriba <b>/usr/bin/showmount -a host</b>.
Por ejemplo:
d2416 1
a2416 1
<h3>Cómo montar sistemas de archivo NFS</h3>
d2419 2
a2420 1
Los sistemas de archivo NFS se deben montar mediante mount(8), o más
d2423 4
a2426 3
Para montar un sistema de archivo /work del huésped 10.0.0.1 en un sistema de
archivo local /mnt, haga lo siguiente (no necesita usar una dirección IP,
mount se encargará de la resolución de nombres):
d2436 2
a2437 2
Para que el sistema se monte al iniciar, añada una algo como lo que ve a
continuación en su fichero <i>/etc/fstab</i>:
d2441 2
a2442 1
<ul><pre>
d2444 2
a2445 1
</pre></ul>
d2448 5
a2452 5
¡¡Es importante que use <tt>0 0</tt> al final de esta línea para que su 
máquina no intente ejecutar fsck sobre el sistema de archivo NFS durante el
inicio del sistema!!
El resto de opciones de seguridad típicas como noexec, nodev, y nosuid,
también deberían usarse donde sean posibles, como en:
d2456 2
a2457 1
<ul><pre>
d2459 2
a2460 1
</pre></ul>
d2463 4
a2466 4
De este modo ningún dispositivo o programa setuid en el servidor NFS podrá
traspasar las medidas de seguridad en el cliente NFS.
Si no está montando programas para ejecutarlos en el cliente NFS, añada
noexec a esta lista.
d2489 2
a2490 2
Internet a trav&eacute;s de mi proveedor (ISP &quot;Internet Service
Provider&quot;), y por lo tanto puedo usar la utilidad
d2510 3
a2512 3
porque es el &laquo;nombre de servidor&raquo; (&quot;nameserver&quot;)
que mi ISP me dijo que usara con mi cuenta, y cuyo n&uacute;mero se
introduce en el fichero
d2516 2
a2517 2
dominio <i>openbsd.org</i>, y pregunt&eacute;mosle por la
direcci&oacute;n de <i>www.openbsd.org</i>:
d2555 1
a2555 1
<i>zues.theos.com</i> es, como puede suponer, una m&aacute;quina que
d2557 1
a2557 1
ser un servidor de DNS para el dominio <i>openbsd.org</i>.
d2569 1
a2569 1
<li>Lea las <a href="http://www.openbsd.org/cgi-bin/man.cgi">P&aacute;ginas de Manual de OpenBSD</a>,
d2637 3
a2639 3
    direcciones IP aunque tenga los ficheros <i>/etc/hosts</i> y
    <i>/etc/resolv.conf</i> correctamente (v.g., en OpenBSD, Netscape a
    veces se comporta de este modo porque implementa su propia
d2641 1
a2641 1
    <i>gethostbyname(3)</i> para la b&uacute;squeda de
d2699 1
a2699 1
    &aacute;rbol de portes en <i>/usr/ports/net/dnscache/</i>.  Este
d2703 3
a2705 3
    (&quot;scripts&quot;) f&aacute;cilmente.  Su configuraci&oacute;n
    no se parece en nada a la de abajo, pero est&aacute; bien
    documentada en su p&aacute;gina web.</li>
d2716 1
a2716 1
proveyendo un servicio de red cr&iacute;tico mediante el uso de unos
d2718 5
a2722 5
escrutinio que el d&aelig;mon de name en la instalaci&oacute;n
base, <b>named</b>, el cual ha pasado una
<a href="../../es/security.html">auditor&iacute;a de seguridad</a>.
Esta es una consideraci&oacute;n a tener muy en cuenta, ya que si un
servidor de nombres de dominio es puesto en peligro, los
d2740 7
a2746 7
controlan el d&aelig;mon de name, <code>named</code>.  La
ubicaci&oacute;n por definici&oacute;n de estos ficheros es el
directorio <i>/var/named</i> y sus subdirectorios, en especial el
fichero <i>/var/named/named.boot</i> que es el fichero de
inicializaci&oacute;n para <b>named</b>.  Tambi&eacute;n hay un par
m&aacute;s de pasos para la configuraci&oacute;n que se deben llevar a
cabo en <i>/etc</i>.
d2751 6
a2756 5
<i>nemo.yewtopia.com</i> como el nombre nombre primario del servidor
para el dominio (&iexcl;muy peque&ntilde;o!) <i>yewtopia.com</i>.  La
direcci&oacute;n de <i>nemo.yewtopia.com</i> es <i>192.168.1.9</i>.
Otras dos m&aacute;quinas en esa subrred son <i>crater.yewtopia.com</i>
en 192.168.1.1 y <i>earhart.yewtopia.com</i> en 192.168.1.2.
d2759 1
a2759 1
<h4>6.8.5.1 Configuraci&oacute;n en <i>/etc/named</i></h4>
d2761 1
a2761 1
<h5>6.8.5.1.1 <i>/var/named/named.boot</i></h5>
d2783 1
a2783 1
de configuraci&oacute;n de <i>yewtopia.com</i>.
d2785 1
a2785 1
<h5>6.8.5.1.2 <i>/var/named/namedb/localhost.rev</i></h5>
d2802 1
a2802 1
<h5>6.8.5.1.3 <i>/var/named/namedb/yewtopia</i></h5>
d2824 1
a2824 1
<h5>6.8.5.1.4 <i>/var/named/namedb/yewtopia.rev</i></h5>
d2845 1
a2845 1
<h4>6.8.5.2 Configuraci&oacute;n en <i>/etc</i></h4>
d2847 1
a2847 1
<h5>6.8.5.2.1 <i>/etc/resolv.conf</i></h5>
d2850 6
a2855 5
Aseg&uacute;rese de que <i>/etc/resolv.conf</i> ahora se&ntilde;ale al
dominio de la m&aacute;quina local (en vez de, por ejemplo, el nombre
del servidor de su ISP), de modo que la resoluci&oacute;n del nombre en
requerimientos sea enviada al <b>named</b> que haya configurado.
+</p>
d2864 1
a2864 1
<h4>6.8.5.2.2 <i>/etc/hosts</i></h4>
d2868 3
a2870 3
m&aacute;quinas al fichero <i>/etc/hosts</i>, puede que le interese
acortar su fichero <i>/etc/hosts</i> al estado en que se encontraba por
definic&oacute;n
d2882 8
a2889 7
de modo que <b>named</b> no sea circunvalado en favor de direcciones
(probablemente caducadas) en el fichero <i>/etc/hosts</i>.
&iexcl;<u>Aseg&uacute;rese de que tiene al menos la entrada predefinida 
de <i>localhost</i></u>, o su red no iniciar&aacute; correctamente!
Note tambi&eacute;n que <i>nemo</i> debe aparecer en su propio fichero
hosts, o de lo contrario ver&aacute; un mensaje de error (no
da&ntilde;ino) durante el arranque cuando <i>/etc/netstart</i> invoque
d2891 2
a2892 2
para a&ntilde;adir <i>nemo</i> (cuyo nombre aparece en
<i>/etc/myname</i>).
d2895 3
a2897 1
<h4>6.8.5.3 Usar <a href="http://www.openbsd.org/cgi-bin/man.cgi?query=dig&sektion=1&format=html">dig(1)</a> para examinar los resultados.</h4>
d2937 2
a2938 2
El d&aelig;mon de name <b>named</b> se lanza durante el inicio del
sistema desde
d2961 1
a2961 1
Examine tambi&eacute;n estas l&iacute;neas en <i>/etc/rc.conf</i>:
d2972 2
a2973 2
Estos valores predefinidos ser&aacute;n v&aacute;lidos para
casi todas las configuraciones.
d2977 1
a2977 1
Para iniciar <b>named</b> de forma manual, use la orden
d2993 2
a2994 1
El mejor modo de parar el d&aelig;mon de name es usando la orden
d3006 2
a3007 2
Si no funcionara, encuentre el id del proceso de <code>named</code> y
use la orden
d3009 1
a3009 1
para finalizar el proceso.  El PID para <code>named</code> mientras
d3011 1
a3011 1
l&iacute;nea del fichero <i>/var/named/named.pid</i>.
d3028 1
a3028 1
hecho cambios, env&iacute;e una se&ntilde;al &quot;hangup&quot;:
d3049 85
d3161 2
a3162 2
Originally [OpenBSD: faq6.html,v 1.73 2000/05/26 19:43:44 reinhard Exp ]<br>
$Translation: faq6.html,v 1.18 2000/06/21 18:40:02 horacio Exp $<br>
@


1.11
log
@
Sync with Badlands Translation CVS. Work by Horacio.
@
text
@d2113 1
a2113 1
<a href="http://www.freebsd.org/es/faq/userppp.html">http://www.freebsd.org/es/faq/userppp.html</a>.
d3004 1
a3004 1
$Translation: faq6.html,v 1.16 2000/06/01 20:22:12 horacio Exp $<br>
@


1.10
log
@
Sync with Badlands Translation CVS. Work by Horacio.
@
text
@a81 9
<ul>Tabla de Contenidos
   <li><a href="#6.1.1">6.1.1 - Idenficaci&oacute;n y
       Configuraci&oacute;n de las Interfaces de Red</a></li>
   <li><a href="#6.1.2">6.1.2 - Configuraci&oacute;n del Sistema
       OpenBSD como Pasarela</a></li>
   <li><a href="#6.1.3">6.1.3 - Configuraci&oacute;n de los Alias en
       una Interfaz de Red</a>
</ul>

d127 4
a130 3
Que incluye tarjetas como: <b>Nota:</b> Algunos controladores que
estaban en OpenBSD 2.6, como mx, ax, al y pn, han sido substituidos por
este controlador.
d141 2
d194 6
a199 6
<li><a href="http://www.openbsd.org/cgi-bin/man.cgi?query=lo&sektion-4&format=html">lo*</a> - Interfaz Loopback
<li><a href="http://www.openbsd.org/cgi-bin/man.cgi?query=sl&sektion=4&format=html">sl*</a> - Interfaz de Red Slip
<li>ppp* - Protocolo Punto a Punto
<li><a href="http://www.openbsd.org/cgi-bin/man.cgi?query=tun&sektion=4&format=html">tun*</a> - Interfaz de Red Tunnel
<li><a href="http://www.openbsd.org/cgi-bin/man.cgi?query=enc&sektion=4&format=html">enc*</a> - Interfaz de Encapsulamiento
<li><a href="http://www.openbsd.org/cgi-bin/man.cgi?query=bridge&sektion=4&format=html">bridge*</a> - Interfaz Puente Ethernet
d414 18
a431 7
Unas notas sobre los alias:  en OpenBSD sólo se usa el nombre de la interfaz;
no existen diferencias entre el primer alias y el segundo, por lo tanto, a
diferencia de otros sistemas operativos, no hay que referirse a ellos como
dc0:0 y dc0:1;  asegúrese también de que su netmask para el alias <b>NO</b>
sea el mismo que para el ip actual de la interfaz.
En este ejemplo de <i>/etc/ifaliases</i>, añadiremos dos alias al dispositivo
<b>dc0</b>.
d443 5
d1840 4
a1843 4
edite el fichero /etc/rc.conf.
Configúrelo poniendo dhcp_flags=&quot;-q&quot; en lugar de dhcp_flags=NO.
Añada en /etc/dhcp.interfaces las interfaces en las que quiera que dhcp esté
&laquo;a la escucha&raquo;
d2628 1
a2628 1
    (ver <a href="../../es/ports.html">portes</a>)</li>
d2632 11
a2642 1
    &aacute;rbol de portes en <i>/usr/ports/net/dnscache/</i>.</li>
d3003 2
a3004 2
Originally [OpenBSD: faq6.html,v 1.71 2000/05/16 20:42:16 ericj Exp ]<br>
$Translation: faq6.html,v 1.15 2000/05/21 17:52:44 horacio Exp $<br>
@


1.9
log
@
Sync with Badlands Translation CVS. Work by es Horacio.
@
text
@d2763 1
a2763 1
dominio de la m&aacute;quina local (el vez de, por ejemplo, el nombre
d2930 1
a2930 1
<h4>6.8.6.3 Reiniciar DNS con una configuraci&aocute;n alterada</h4>
d2984 1
a2984 1
$Translation: faq6.html,v 1.14 2000/05/17 01:41:59 horacio Exp $<br>
@


1.8
log
@
Sync with Badlands Translation CVS. Work by Horacio.
@
text
@d1196 1
a1196 1
<b>Sistema Operativo de la Máquina: </b>OpenBSD v2.5 i386<br>
d2983 2
a2984 2
Originally [OpenBSD: faq6.html,v 1.70 2000/05/15 21:29:18 ericj Exp ]<br>
$Translation: faq6.html,v 1.13 2000/05/16 16:34:51 horacio Exp $<br>
@


1.7
log
@
Sync with Badlands Translation CVS. Work by Horacio
@
text
@d22 1
a22 1
<li><a href="#6.1">6.1 - configuraci&oacute;n inicial de la red</a>
d41 1
a41 1
<h2>6.0.1 - Introducción</h2>
d43 7
a49 5
Para la comprensión de la mayor parte de este documento será de gran ayuda
que haya leido y, por lo menos, asimilado en parte el capítulo
<a href="faq5.html">&laquo;Configuración del Núcleo&raquo;</a> de las
Preguntas Frecuentes, y las páginas de manual
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=ifconfig&apropos=0&sektion=8&format=html">ifconfig(8)</a> y
d53 25
a77 20
Si es Vd. un administrador de redes y está configurando protocolos de
enrutamiento, si está usando su sistema OpenBSD como un enrutador, si
necesita conocer más a fondo los protocolos de redes IP, entonces es
realmente necesario que lea
<a href="http://www.3com.com/nsc/501302s.html">Understanding IP
addressing</a>.
Éste es un documento excelente que contiene conocimientos fundamentales 
sobre redes de IP.

<p>
Si está trabajando con aplicaciones como servidores de http, servidores de
ftp, y servidores de correo, se puede beneficiar en gran medida de la lectura
de los
<a href="http://www.nexor.com/info/rfc/index/rfc.htm?index/rfc.html">RFCs</a>
(Nota: existe un proyecto de traducción de RFCs al castellano conocido como
<a href="http://www.arrakis.es/~pjleon/rfc-es/index.html">RFC-ES</a>).
Por supuesto que no podrá leerlos todos, así que elija algunos temas en los
que esté interesado, o que puedan serle útiles en su entorno de trabajo.
Los RFCs definen muchísimas (miles) de las normativas para protocolos en
internet y cómo se supone que deben funcionar.
d80 1
a80 1
<h2>6.1 - Configuración Inicial de la Red</h2>
d83 6
a88 6
   <li><a href="#6.1.1">6.1.1 - Idenficación y Configuración de las
       Interfaces de Red</a></li>
   <li><a href="#6.1.2">6.1.2 - Configuración del Sistema OpenBSD como
       Pasarela</a></li>
   <li><a href="#6.1.3">6.1.3 - Configuración de los Alias en una Interfaz de
       Red</a>
d942 1
a942 1
block in quick proto tcp on fxp0 from any to any flags FUP
d2983 2
a2984 2
Originally [OpenBSD: faq6.html,v 1.69 2000/05/15 01:27:42 ericj Exp ]<br>
$Translation: faq6.html,v 1.12 2000/05/15 23:44:30 horacio Exp $<br>
@


1.6
log
@Sync with Badlands Translation CVS. Work by Horacio.
@
text
@d2407 1
a2407 1
<a href="http://www.openbsd.org/man.cgi?query=nslookup&sektion=8&format=html">nslookup(8)</a>
d2484 1
a2484 1
<li>Lea el libro de O'Reilly Associates<i><a href="http://www.oreilly.com/catalog/dns3/">DNS and BIND</a></i>.</li>
d2976 2
a2977 2
Originally [OpenBSD: faq6.html,v 1.68 2000/05/13 21:46:44 ericj Exp ]<br>
$Translation: faq6.html,v 1.11 2000/05/15 00:15:04 horacio Exp $<br>
@


1.5
log
@Sync with Badlands Translation CVS. Work by Horacio.
@
text
@d21 2
a22 2
<li><a href="#6.0.1">6.0.1 - Introducción</a>
<li><a href="#6.1">6.1 - Configuración Inicial de la Red</a>
d24 4
a27 2
<li><a href="#6.3">6.3 - Traducción de Direcciones de Red (NAT)</a>
<li><a href="#6.4">6.4 - Protocolo de Configuración para Húespedes Dinámicos
d30 1
a30 1
<li><a href="#6.6">6.6 - Afinar Parámetros de Red</a>
d32 2
d98 1
a98 1
tarjeta de red ne2k, que usa un nombre de dispositivo ne*.
d114 4
a117 4
<li>ne2000 Network Cards - <a href="http://www.openbsd.org/cgi-bin/man.cgi?query=ne&sektion=4&format=html">ne*</a> 
<li>3Com EtherLink III and Fast EtherLink III Ethernet - <a href="http://www.openbsd.org/cgi-bin/man.cgi?query=ep&sektion=4&format=html">ep*</a>
<li>3Com EtherLink XL and Fast EtherLink XL Ethernet (3C9xx) - <a href="http://www.openbsd.org/cgi-bin/man.cgi?query=xl&sektion=4&format=html">xl*</a>
<li>Intel 82586 chip Ethernet device driver - <a href="http://www.openbsd.org/cgi-bin/man.cgi?query=ie&sektion=4&format=html">ie*</a>
d125 24
d392 1
a392 1
Por ejemplo, supongamos que el usuario tiene una interfaz <b>pn0</b> y
d398 1
a398 1
<li>IP para pn0 es 192.168.0.2
d416 1
a416 1
pn0:0 y pn0:1;  asegúrese también de que su netmask para el alias <b>NO</b>
d419 1
a419 1
<b>pn0</b>.
d425 2
a426 2
pn0	192.168.0.3	255.255.255.255
pn0	192.168.0.4	255.255.255.255
d433 1
a433 3
Después del lanzamiento de la versión 2.6, el fichero <i>/etc/ifaliases</i>
perdió valor.
A partir de OpenBSD 2.7 los alias se configurarán en el fichero
d435 3
a437 2
Para configurarlo como anteriormente, tendrá un fichero
<i>/etc/hostname.pn0</i> estructurado del siguiente modo:
d440 2
a441 1
<ul><pre>
d445 2
a446 1
</ul></pre>
d458 1
a458 1
# <b>ifconfig pn0 inet alias 192.168.0.3 netmask 255.255.255.255</b>
d469 1
a469 1
pn0: flags=8863&lt;UP,BROADCAST,NOTRAILERS,RUNNING,SIMPLEX,MULTICAST&gt;
d835 8
a842 5
IP Filter también puede aplicar filtros basándose en el protocolo que esté
filtrando, de hecho, IP Filter puede filtrar cualquier protocolo que se
encuentre en la lista 
<a href=file://localhost/etc/protocols>/etc/protocols</a>.
Para ver esto con más claridad, sólo trataremos con tcp, udp, e icmp.
d873 1
a873 1
<b>Vudú en el Filtrado de Paquetes</b>
d988 14
a1001 14
Este pequeño cambio supondrá un dramático incremento en la flexibilidad y
seguridad de su grupo de reglas, ya que le permitirá hacer algo de magia.
Por ejemplo, en el grupo de reglas anterior, está permitiendo todo el tráfico
tcp a los puertos 80 y 443.
Aún puede ajustarlo un poco más.
Para establecer una conexión tcp sólo necesita permitir que tenga lugar el
saludo inicial (&quot;handshake&quot;);  una vez que esto ocurra, puede
bloquear el tráfico a ese puerto y permitir a la regla &quot;keep state&quot;
que gestione la conexión.
Para que se complete el saludo inicial, sólo necesita permitir el paso a los
paquetes con los indicadores SIN y SIN/ACK activados.
Al dejar pasar sólo paquetes con SIN y SIN/ACK activados puede prevenir
muchas formas de escaneos de puertos como puede ser el escaneo FIN.
Ahora las reglas están de este modo:
a1095 27
<ul>
   <li><a href="#nat1.0">6.3.1 Introducción</a>
   <ul>
      <li><a href="#nat1.1">6.3.1.1 Finalidad</a>
      <li><a href="#nat1.2">6.3.1.2 Terminología</a>
      <li><a href="#nat1.3">6.3.1.3 Detalles de Configuración</a>
   </ul>
   <li><a href="#nat2.0">6.3.2 Traducción de Direcciones de Redes (NAT)</a>
   <ul>
      <li><a href="#nat2.1">6.3.2.1 Introducción a NAT</a>
      <li><a href="#nat2.2">6.3.2.2 ¿Por Qué Usar NAT?</a>
      <li><a href="#nat2.3">6.3.2.3 Preconfiguración</a>
      <li><a href="#nat2.4">6.3.2.4 Configuración</a>
      <li><a href="#nat2.5">6.3.2.5 Funcionamiento</a>
   </ul>
   <li><a href="#nat3.0">6.3.3 Base de Conocimientos sobre NAT</a>
   <ul>
      <li><a href="#nat3.1">6.3.3.1 Comprobación del Status de NAT</a>
      <li><a href="#nat3.2">6.3.3.2 Limitaciones de NAT (en FTP)</a>
      <li><a href="#nat3.3">6.3.3.3 Redireccionamiento del Tráfico</a>
      <li><a href="#nat3.4">6.3.3.4 NAT frente a Proxy</a>
   </ul>
   <li><a href="#nat4.0">6.3.4 Referencias y Recursos</a>
</ul>

<hr>

d1097 1
a1097 1
<h3><u>6.3.1 Introducción</u></h3>
d1100 1
a1100 1
<b>Finalidad</b>
d1103 11
a1113 7
La finalidad de este documento es la de dar una idea básica y explicar la
instalación y configuración de la &laquo;Traducción de Direcciones de
Redes&raquo; (NAT) en una máquina OpenBSD.
Este documento está dirigido a usuarios con un nivel de conocimientos básico
a intermedio en UNIX, TCP/IP, y tecnologías de redes.
Se asume que el usuario ya ha instalado y configurado un sistema OpenBSD con
dos tarjetas de red (una conectada a internet y la otra a la red local).
d1193 1
a1193 1
	NetGear 10/100MB <b>pn0</b><br>
d1198 1
a1198 1
	NetGear 10/100MB <b>pn1</b><br>
d1226 1
a1226 1
| Hub |--------- pn1 |   NAT   | pn0 ----| Internet |
d1230 1
a1230 1
  +---- Más clientes 
d1235 2
a1236 2
                              |   NIC pn0 - 24.5.0.5     |
                              |   NIC pn1 - 192.168.1.1  |
d1297 1
a1297 1
Cliente ----------------- pn1 [ NAT ] pn0 ---------- Anfitrión de Internet
d1407 2
a1408 2
map pn0 192.168.1.0/24 -&gt; 24.5.0.5/32 portmap tcp/udp 10000:60000
map pn0 192.168.1.0/24 -&gt; 24.5.0.5/32
d1426 1
a1426 1
<strong>&quot;pn0&quot;</strong>
d1545 2
a1546 2
map pn0 192.168.1.0/24 -&gt; 24.5.0.5/32 portmap tcp/udp 10000:60000
map pn0 192.168.1.0/24 -&gt; 24.5.0.5/32
d1622 1
a1622 1
map pn0 192.168.1.0/24 -&gt; 24.5.0.5/32 proxy port ftp ftp/tcp
d1661 1
a1661 1
rdr pn0 24.5.0.5/32 port 80 -&gt; 192.168.1.80 port 80
d1680 1
a1680 1
<b>&quot;pn0&quot;</b>
d1689 1
a1689 1
Indica que es una conexión entrante a esta dirección IP (sólo en pn0, como
d2385 576
d2964 3
a2966 3
<a href="index.html">[Volver al Índice Principal]</a>
<a href="faq5.html">[Sección 5.0 - Configuración del Núcleo y del Disco]</a>
<a href="faq7.html">[To Section 7.0 - Controles del Teclado]</a>
d2976 2
a2977 2
Originally [OpenBSD: faq6.html,v 1.59 2000/04/05 21:49:26 ericj Exp ]<br>
$Translation: faq6.html,v 1.10 2000/04/29 17:58:08 horacio Exp $<br>
a2982 2


@


1.4
log
@Sync with Badlands translation CVS. Work by Horacio
@
text
@d9 1
a9 1
<meta name="copyright"     content="This document copyright 1998-1999 by OpenBSD.">
d2387 1
a2387 1
<a href="index.html"><img height="24" width="24" src="../../back.gif" border="0" alt="[back]"></a>
d2392 1
a2392 1
$Translation: faq6.html,v 1.9 2000/04/26 15:22:20 horacio Exp $<br>
@


1.3
log
@Sync with Badlands CVS. Work by Horacio
@
text
@d2177 1
a2177 1
encarecidamente que haga uso de <a href="../faq13.html">IPSec</a>.
d2392 1
a2392 1
$Translation: faq6.html,v 1.8 2000/04/20 16:41:10 horacio Exp $<br>
@


1.2
log
@Updates by Horacio
@
text
@d362 1
a362 1
<a href="../faq10.html#10.3">jerarquía de inicio rc</a>, leerá este fichero
d2392 1
a2392 1
$Translation: faq6.html,v 1.7 2000/04/08 10:45:57 horacio Exp $<br>
@


1.1
log
@Added Spanish translation, work by Horacio
@
text
@d92 1
a92 1
<strong>ifconfig(8)</strong>.
d125 1
a125 1
utilidad <strong>ifconfig(8)</strong>.
d151 3
a153 2
Como habrá podido comprobar, <strong>ifconfig(8)</strong> muestra mucha más
información de la que necesitamos en este momento.
d250 3
a252 2
Puede hacer una comprobación con <strong>ifconfig(8)</strong> para asegurarse 
de que su interfaz se configuró correctamente.
d1049 1
a1049 1
the <a href=http://www.obfuscation.org/ipf/ipf-howto.txt>IPF howto</a> es una
d1079 1
a1079 1
   <li><a href="#nat3.0">6.3.3 Base de Conocimentos sobre NAT</a>
d1520 1
a1520 1
<h3><u>6.3.3 Base de Conocimentos de NAT</u></h3>
d2087 1
a2087 1
<a href="http://www.freebsd.org/faq/userppp.html">http://www.freebsd.org/faq/userppp.html</a>.
d2391 2
a2392 2
Originally [OpenBSD: faq6.html,v 1.58 2000/03/25 00:05:05 wvdputte Exp ]<br>
$Translation: faq6.html,v 1.6 2000/04/05 14:29:45 horacio Exp $<br>
@

