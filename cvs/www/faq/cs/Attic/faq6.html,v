head	1.20;
access;
symbols;
locks; strict;
comment	@# @;


1.20
date	2006.09.30.08.55.04;	author jufi;	state dead;
branches;
next	1.19;

1.19
date	2004.01.16.20.30.20;	author jufi;	state Exp;
branches;
next	1.18;

1.18
date	2003.12.03.21.30.16;	author horacio;	state Exp;
branches;
next	1.17;

1.17
date	2003.11.03.14.19.31;	author horacio;	state Exp;
branches;
next	1.16;

1.16
date	2003.10.30.18.00.22;	author horacio;	state Exp;
branches;
next	1.15;

1.15
date	2003.02.05.19.28.46;	author jufi;	state Exp;
branches;
next	1.14;

1.14
date	2002.11.23.20.08.48;	author jufi;	state Exp;
branches;
next	1.13;

1.13
date	2002.11.20.13.07.59;	author jufi;	state Exp;
branches;
next	1.12;

1.12
date	2002.09.23.18.05.59;	author jufi;	state Exp;
branches;
next	1.11;

1.11
date	2002.09.09.11.54.47;	author jufi;	state Exp;
branches;
next	1.10;

1.10
date	2002.08.27.12.20.06;	author jufi;	state Exp;
branches;
next	1.9;

1.9
date	2002.02.22.19.09.01;	author jufi;	state Exp;
branches;
next	1.8;

1.8
date	2002.02.14.01.03.42;	author jufi;	state Exp;
branches;
next	1.7;

1.7
date	2001.11.25.22.18.39;	author jufi;	state Exp;
branches;
next	1.6;

1.6
date	2001.08.29.17.58.44;	author jufi;	state Exp;
branches;
next	1.5;

1.5
date	2001.07.14.14.00.38;	author jufi;	state Exp;
branches;
next	1.4;

1.4
date	2001.06.21.15.48.37;	author jufi;	state Exp;
branches;
next	1.3;

1.3
date	2001.06.14.22.57.04;	author fgsch;	state Exp;
branches;
next	1.2;

1.2
date	2001.05.31.19.02.35;	author jufi;	state Exp;
branches;
next	1.1;

1.1
date	2001.05.11.06.28.56;	author jufi;	state Exp;
branches;
next	;


desc
@@


1.20
log
@not maintained anymore, time to go.
@
text
@<html>
<head>
<meta http-equiv="Content-type" content="text/html; charset=iso-8859-2">
<title>6 - Nastavení sítì</title>
<link rev= "made" href= "mailto:www@@openbsd.org">
<meta name= "resource-type" content= "document">
<meta name= "description"   content= "the OpenBSD FAQ page">
<meta name= "keywords"      content= "openbsd,faq">
<meta name= "distribution"  content= "global">
<meta name= "copyright"     content= "This document copyright 1998-2004 by OpenBSD.">
</head>

<body bgcolor="#ffffff" text="#000000">
<!-- passes validator.w3.org, please keep it this way -->

<img alt="[OpenBSD]" height=30 width=141 src="../../images/smalltitle.gif">
<p>
<font color="#0000e0">
<a href="index.html">[FAQ Index]</a>
<a href="faq5.html">[Sekce 5 - Pøeklad systému ze zdrojových kódù</a>
<a href="faq7.html">[Sekce 7 - Nastavení klávesnice a displeje]</a>
</font>

<h1><font color="#e00000">6 - Nastavení sítì</font></h1>

<p>
<h3>Obsah</h3>
<ul>
<li><a href= "#Intro" >6.1 - Pøedtím ne¾ pùjdeme dále</a>
<li><a href= "#Setup" >6.2 - Úvodní nastavení sítì</a>
<li><a href= "#PF"    >6.3 - Packet Filter (PF)</a>
<li><a href= "#DHCP"  >6.4 - Dynamic Host Configuration Protocol (DHCP)</a>
<li><a href= "#PPP"   >6.5 - Point to Point Protokol</a>
<li><A href= "#Tuning">6.6 - Zlep¹ování výkonu sítì</a>
<li><a href= "#NFS"   >6.7 - Pou¾ívání NFS</a>
<li><a href= "#PPTP"  >6.8 - Nastavení PPTP spojení v OpenBSD</a>
<li><a href= "#Bridge">6.9 - Nastavení bridge s OpenBSD</a>
</ul>

<hr>

<p>
<a name="Intro"></a>
<h2>6.1 - Pøedtím ne¾ pùjdeme dále</h2>

<p>
Na úvod pøedpokládáme, ¾e ètenáø pøeèetl a alespoò èásteènì chápe sekci 
<a href="faq5.html">Konfigurace jádra</a> tìchto FAQ, stejnì jako
manuálové stránky pøíkazù 
<a href= "http://www.openbsd.org/cgi-bin/man.cgi?query=ifconfig&amp;amp;sektion=8">
ifconfig(8)</a> a 
<a href= "http://www.openbsd.org/cgi-bin/man.cgi?query=netstat&amp;amp;sektion=1">
netstat(1)</a>.

<p>
Pokud jste administrátor sítì a nastavujete smìrovací protokoly, pokud 
pou¾íváte OpenBSD box jako router, pokud chcete hloubìji poznat princip 
fungovaní sítì s IP protokolem, pak byste si rozhodnì mìli pøeèíst
<a href="http://www.3com.com/other/pdfs/infra/corpinfo/en_US/501302.pdf">
V¹e co potøebujete vìdìt o IP adresování</a>.
Jedná se skuteènì o vynikající dokument, který obsahuje zcela
nepostradatelné informace pro práci se sítìmi na bázi IP protokolu,
obzvlá¹tì pokud pokud máte co do èinìní nebo zodpovídáte za více ne¾
jednu sí».

<p>
Pokud pracujete s aplikacemi jako jsou web servery, ftp servery a mail
servery, mù¾ete najít mnoho cenných informací 
<a href="http://the.rfc-editor.org/rfc.html">ètením RFC dokumentù</a>.
Samozøejmì, ¾e je nemù¾ete pøeèíst v¹echny. 
Radìji si vyberte téma, o které se zajímáte, nebo které pou¾íváte
v práci.  RFC definují mnoho (øádovì tisíce) standardù protokolù
internetu a popisují, jak tyto protokoly jsou navr¾eny a jak pracují.

<p>
<a name="Setup"></a>
<h2>6.2 - Úvodní nastavení sítì</h2>

<p>
<a name="Setup.1"></a>
<h3>6.2.1 - Identifikace a nastavení va¹ich sí»ových rozhraní</h3>

<p>
Nejprve je nutné identifikovat v systému vá¹ sí»ový hardware. V OpenBSD
jsou sí»ová rozhraní pojmenovaná podle sí»ové karty, ne podle typu
spojení.  To zda byla va¹e sí»ová karta inicializovaná, mù¾ete vidìt pøi
startu systému, nebo pozdìji pomocí pøíkazu
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=dmesg&amp;amp;sektion=8">dmesg(8)</a>.
Rovnì¾ mù¾ete svoje sí»ová rozhraní identifikovat ve výpisu pøíkazu
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=ifconfig&amp;amp;sektion=8">ifconfig(8)</a>
Napøíklad zde je výstup z pøíkazu dmesg pro sí»ovou kartu Intel Fast
Ethernet, které odpovídá název zaøízení fxp.
</p>

<blockquote><pre>
fxp0 at pci0 dev 10 function 0 "Intel 82557" rev 0x0c: irq 5, address 00:02:b3:2b:10:f7
inphy0 at fxp0 phy 1: i82555 10/100 media interface, rev. 4
</pre></blockquote>

<p>
Pokud nevíte, jaké jméno v systému odpovídá va¹í kartì, podívejte se,
prosím, na <a href="../../cs/plat.html">seznam podporovaného hardwaru</a>
pro Va¹i platformu. Najdete tam seznam mnoha bì¾ných sí»ových karet a
jména je OpenBSD ovladaèù. Spojte krátké alfabetické jméno zaøízení
(jako fxp) s èíslem pøiøazeným kernelem a získáte jméno rozhraní (napø.
fxp0).
</p>

<p>
Chcete-li zjistit, která zaøízení byla identifikována, mù¾ete pou¾ít
pøíkaz 
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=ifconfig&amp;sektion=8">ifconfig(8)</a>.
Následující pøíkaz uká¾e v¹echna sí»ová rozhraní v systému.
V tomto vzorovém výstupu vidíme pouze jedno fyzické rozhraní,
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=fxp&amp;sektion=4">fxp(4)</a>.

<blockquote><pre>
$ <strong>ifconfig -a</strong>
lo0: flags=8049&lt;UP,LOOPBACK,RUNNING,MULTICAST&gt; mtu 33224
        inet 127.0.0.1 netmask 0xff000000 
        inet6 ::1 prefixlen 128
        inet6 fe80::1%lo0 prefixlen 64 scopeid 0x5
lo1: flags=8008&lt;LOOPBACK,MULTICAST&gt; mtu 33224
fxp0: flags=8843&lt;UP,BROADCAST,RUNNING,SIMPLEX,MULTICAST&gt; mtu 1500
	address: 00:04:ac:dd:39:6a
        media: Ethernet autoselect (100baseTX full-duplex)
        status: active
        inet 10.0.0.38 netmask 0xffffff00 broadcast 10.0.0.255
	inet6 fe80::204:acff:fedd:396a%fxp0 prefixlen 64 scopeid 0x1
pflog0: flags=0&lt;&gt; mtu 33224
pfsync0: flags=0&lt;&gt; mtu 2020
sl0: flags=c010&lt;POINTOPOINT,LINK2,MULTICAST&gt; mtu 296
sl1: flags=c010&lt;POINTOPOINT,LINK2,MULTICAST&gt; mtu 296
ppp0: flags=8010&lt;POINTOPOINT,MULTICAST&gt; mtu 1500
ppp1: flags=8010&lt;POINTOPOINT,MULTICAST&gt; mtu 1500
tun0: flags=10&lt;POINTOPOINT&gt; mtu 3000
tun1: flags=10&lt;POINTOPOINT&gt; mtu 3000
enc0: flags=0&lt;&gt; mtu 1536
bridge0: flags=0&lt;&gt; mtu 1500
bridge1: flags=0&lt;&gt; mtu 1500
vlan0: flags=0&lt;&gt; mtu 1500
	address: 00:00:00:00:00:00
vlan1: flags=0&lt;&gt; mtu 1500
	address: 00:00:00:00:00:00
gre0: flags=9010&lt;POINTOPOINT,LINK0,MULTICAST&gt; mtu 1450
gif0: flags=8010&lt;POINTOPOINT,MULTICAST&gt; mtu 1280
gif1: flags=8010&lt;POINTOPOINT,MULTICAST&gt; mtu 1280
gif2: flags=8010&lt;POINTOPOINT,MULTICAST&gt; mtu 1280
gif3: flags=8010&lt;POINTOPOINT,MULTICAST&gt; mtu 1280
</pre></blockquote>	 

<p>
Jak je vidìt, 
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=ifconfig&amp;sektion=8">ifconfig(8)</a>
dává více informací, ne¾ v této fázi potøebujeme. Umo¾òuje nám ale najít
na¹e zaøízení. V pøedcházejícím pøíkladì je ji¾ sí»ová karta
nakonfigurována.  Poznáte to podle vypsaných hodnot &quot;inet 10.0.0.38
netmask 0xffffff00 broadcast 10.0.0.255&quot;, odpovídající nastavení
parametrù a také pomocí pøíznakù <strong>UP</strong> a
<strong>RUNNING</strong>.

<p>
Zaznamenáte také nìkolik dal¹í rozhraní, která jsou standardnì zapnuta.
Ta poskytují rùzné slu¾by. Následující manuálové stránky je popisují:

<ul>
<!-- XXXrelease -->
<li><a href="http://www.openbsd.org/cgi-bin/man.cgi?query=lo&amp;sektion=4">lo</a>
  - Loopback Interface
<li><a href="http://www.openbsd.org/cgi-bin/man.cgi?query=pflog&amp;sektion=4&amp;manpath=OpenBSD+3.4">pflog</a>
 - Packet Filter Logging Interface
<li><a href="http://www.openbsd.org/cgi-bin/man.cgi?query=sl&amp;sektion=4">sl</a>
 - SLIP Network Interface
<li><a href="http://www.openbsd.org/cgi-bin/man.cgi?query=ppp&amp;sektion=4">ppp</a>
 - Point to Point Protocol
<li><a href="http://www.openbsd.org/cgi-bin/man.cgi?query=tun&amp;sektion=4">tun</a>
 - Tunnel Network Interface
<li><a href="http://www.openbsd.org/cgi-bin/man.cgi?query=enc&amp;sektion=4">enc</a>
 - Encapsulating Interface
<li><a href="http://www.openbsd.org/cgi-bin/man.cgi?query=bridge&amp;sektion=4">bridge</a>
 - Ethernet Bridge Interface
<li><a href="http://www.openbsd.org/cgi-bin/man.cgi?query=vlan&amp;sektion=4">vlan</a>
 - IEEE 802.1Q Encapsulation Interface
<li><a href="http://www.openbsd.org/cgi-bin/man.cgi?query=gre&amp;sektion=4">gre</a>
 - GRE/MobileIP Encapsulation Interface
<li><a href="http://www.openbsd.org/cgi-bin/man.cgi?query=gif&amp;sektion=4">gif</a>
 - Generic IPv4/IPv6 Tunnel Interface
</ul>

<p>
Pokud va¹e zaøízení nemáte nakonfigurované, prvním krokem je vytvoøení
souboru <strong>/etc/hostname.xxx</strong>.
Jméno zaøízení se nachází na místì xxx. V pøedcházejícím pøíkladu by by
jméno bylo <strong>/etc/hostname.ne3</strong>. Formát tohoto souboru
je jednoduchý:<br>
</p>

<blockquote><pre>
address_family va¹e_ip va¹e_sí»ová_maska [media options]
</pre></blockquote>

(Mnohem více informací o formátu tohoto souboru najdete v manuálové stránce 
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=hostname.if&amp;sektion=5">hostname.if(5)</a>.)

<p>
Typický konfiguraèní soubor rozhraní nastaveného na IPv4 adresu bude
vypadat takto:

<blockquote><pre>
$ <strong>cat /etc/hostname.fxp0</strong>
inet 10.0.0.38 255.255.255.0 NONE
</pre></blockquote>

<p>
Mù¾ete také urèit typ Ethernetového média, tøeba kdy¾ si budete chtít
vynutit 100baseTX full-duplex mód.
</p>

<blockquote><pre>
inet 10.0.0.38 255.255.255.0 NONE media 100baseTX mediaopt full-duplex
</pre></blockquote>

<p>
(Samozøejmì byste si nikdy nemìli vynutit full duplex mód, pokud to
neudìlají obì strany spojení! Pokud nemáte speciální potøeby, nastavení
média by mìlo být vynecháno.)

<p> 
Nebo mù¾ete chtít nastavit speciální flagy pro urèité zaøízení. Formát
souboru hostname se pøíli¹ nezmìní!

<blockquote><pre>
$ <strong>cat /etc/hostname.vlan0</strong>
inet 172.21.0.0 255.255.255.0 NONE vlan 2 vlandev fxp1
</pre></blockquote>

<p>
Dal¹í krok je nastavení defaultního routeru. Provedete to tak, ¾e jeho
IP adresu umístíte do souboru s názvem <strong>/etc/mygate</strong>. Tím
umo¾níte, aby vá¹ defaultní router byl nastaven pøi startu. 
Poté byste mìli nastavit va¹e nameservery a soubor <strong>/etc/hosts</strong>
(viz manuálová stránka
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=hosts&amp;sektion=5">hosts(5)</a>).
Nastavení nameserverù spoèívá mj. ve vytvoøení souboru s názvem 
<strong>/etc/resolv.conf</strong>. Více informací o formátu tohoto
souboru naleznete v manuálové stránce 
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=resolv.conf&amp;sektion=5">resolv.conf(5)</a>.
Pro standardní pou¾ití zde je pøíklad takového souboru. V tomto pøíkladu
pøedpokládejme, ¾e adresy va¹ich nameserverù jsou 125.2.3.4 a 125.2.3.5. 
Patøíte rovnì¾ do domény &quot;example.com&quot;.

<blockquote><pre>
$ <strong>cat /etc/resolv.conf</strong>
search example.com
nameserver 125.2.3.4
nameserver 125.2.3.5
lookup file bind
</pre></blockquote>

<p>
Nyní mù¾ete buïto restartovat poèítaè, nebo spustit skript
<strong>/etc/netstart</strong>. Udìláte to jednodu¹e napsáním (jako
u¾ivatel root):

<blockquote><pre>
# <strong>sh /etc/netstart</strong>
writing to routing socket: File exists
add net 127: gateway 127.0.0.1: File exists
writing to routing socket: File exists
add net 224.0.0.0: gateway 127.0.0.1: File exists
</pre></blockquote>

<p>
V¹imnìte si, ¾e do¹lo k nìkolika chybám.  Spu¹tìním tohoto skriptu
rekonfigurujete vìci, které jsou ji¾ zkonfigurovány. Tak tøeba nìkteré
routy u¾ existovaly v routovacích tabulkách jádra.  Nyní by vá¹ systém
mìl být nastaven a mìl by fungovat. Opìt se mù¾ete pøíkazem 
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=ifconfig&amp;sektion=8">ifconfig(8)</a>
pøesvìdèit, ¾e je va¹e zaøízení nastaveno správnì. Smìrování paketù na
sí»ových rozhraních, nastavení rout mù¾ete zkontrolovat pomocí pøíkazu
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=netstat&amp;sektion=1">netstat(1)</a>
nebo <a href="http://www.openbsd.org/cgi-bin/man.cgi?query=route&amp;sektion=8">route(8)</a>.
Pokud máte problémy s routováním, pou¾ijte route(8) s volbou -n,
která zpùsobí, ¾e budou vypisovány IP adresy místo provádìní DNS
dotazù a vypsání hostname.
Zde je pøíklad, jak si obìma zpùsoby prohlédnout routovací tabulky.

<blockquote><pre>
$ <strong>netstat -rn</strong>
Routing tables

Internet:
Destination        Gateway            Flags     Refs     Use    Mtu  Interface
default            10.0.0.1           UGS         0       86      -  fxp0 
127/8              127.0.0.1          UGRS        0        0      -  lo0
127.0.0.1          127.0.0.1          UH          0        0      -  lo0
10.0.0/24          link#1             UC          0        0      -  fxp0 
10.0.0.1           aa:0:4:0:81:d      UHL         1        0      -  fxp0
10.0.0.38          127.0.0.1          UGHS        0        0      -  lo0
224/4              127.0.0.1          URS         0        0      -  lo0

Encap:
Source             Port  Destination        Port  Proto SA(Address/SPI/Proto)

$ <strong>route show</strong>
Routing tables

Internet:
Destination      Gateway            Flags
default          10.0.0.1           UG
127.0.0.0        LOCALHOST          UG
localhost        LOCALHOST          UH
10.0.0.0         link#1             U
10.0.0.1         aa:0:4:0:81:d      UH
10.0.0.38        LOCALHOST          UGH
BASE-ADDRESS.MCA LOCALHOST          U
</pre></blockquote>

<p>
<a name="Setup.2"></a>
<h3>6.2.2 - Nastavení OpenBSD jako routeru</h3>

<p>
Následují základní informace, které potøebujete znát, abyste mohli
nastavit va¹e OpenBSD jako router . Pokud pou¾íváte OpenBSD jako router
v síti Internet, doporuèujeme vám, abyste si pøeèetli rovnì¾ nastavení
Packet Filteru, o kterém pojednává dal¹í èást. Pomocí Packet Filteru
mù¾ete blokovat potenciálnì nebezpeèné sí»ové relace. Rovnì¾ se z dùvodu
nedostatkù IP adres na Internetu pro
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=ip&amp;sektion=4">IPv4</a>
mù¾ete podívat na Pøeklad sí»ových adres (Network address
translation), kde najdete informace, jak roz¹íøit vá¹ adresový prostor.
</p>

<p>
Jádro kompilované jako GENERIC má ji¾ v sobì podporu IP Forwardingu,
kterou je nutné zapnout. Mù¾ete tak uèinit pomocí pøíkazu  
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=sysctl&amp;sektion=8">sysctl(8)</a>. 
Pro trvalou zmìnu byste mìli zeditovat soubor 
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=sysctl.conf&amp;sektion=5">/etc/sysctl.conf</a>.
Udìláte to snadno pøidáním následující øádky do tohoto souboru.
</p>

<blockquote><pre>
net.inet.ip.forwarding=1
</pre></blockquote>

<p>
Chcete-li tuto zmìnu provést bez restartu stroje, mìli byste pou¾ít
pøíkaz
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=sysctl&amp;sektion=8">sysctl(8)</a>.
Pamatujte si v¹ak, ¾e tato zmìna nebude trvalá, vydr¾í jen do rebootu a
také ¾e tento pøíkaz musíte spustit jako u¾ivatel root.
</p>

<blockquote><pre>
# <strong>sysctl -w net.inet.ip.forwarding=1</strong>
net.inet.ip.forwarding: 0 -&gt; 1
</pre></blockquote>

<p>
Nyní zmìòte routovací tabulky na jiných strojích. Je mnoho zpùsobù
pou¾ití OpenBSD jako router, pomocí softwaru
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=routed&amp;sektion=8">routed(8)</a>,
<a href="http://www.gated.org">gated</a>,
<a href="http://www.mrtd.net">mrtd</a> a <a href="http://www.zebra.org">zebra</a>.
OpenBSD podporuje porty v ports tree zebra, gated, a mrtd.
OpenBSD podporuje mnoho sí»ových zaøízení, jako T1, HSSI, ATM, FDDI,
Ethernet a sériové PPP/SLIP zaøízení.

<p>
<a name="Setup.3"></a>
<h3>6.2.3 - Nastavení aliasù zaøízení</h3>

<p>
OpenBSD má jednoduchý mechanismus, který umo¾òuje nastavit ip aliasy na
zaøízení.  V¹e spoèívá v jednoduché editaci souboru
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=hostname.if&amp;sektion=5"><i>/etc/hostname.&lt;if&gt;</i></a>.
Tento soubor je pøeèten pøi startu systému skriptem
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=rc&amp;sektion=8">/etc/rc(8)</a>,
který je souèástí <a href="faq10.html#rc">rc startup hierarchy</a>. 
Napøíklad pøedpokládejme, ¾e u¾ivatel má zaøízení <b>dc0</b> a je na
síti 192.168.0.0.  Dal¹í podstatné informace jsou:

<ul>
<li>IP adresa pro dc0 je 192.168.0.2
<li>sí»ová maska  255.255.255.0
</ul>

<p>
Nìkolik poznámek o aliasech. V OpenBSD pou¾íváte pouze název zaøízení.
Není tady rozdíl mezi prvním aliasem nebo druhým aliasem. Narozdíl od
nìkterých operaèních systémù, OpenBSD se na nì neodkazuje jako dc0:0,
dc0:1. Pokud se odkazujete na urèitou aliasovanou IP adresu pomocí
ifconfig, nebo pøidáváte alias, ujistìte se, ¾e pí¹ete "<tt>ifconfig
interface alias</tt>" namísto  "<tt>ifconfig interface</tt>". Smazat
alias mù¾ete pomocí "<tt>ifconfig interface delete</tt>".

<p>
Pøedpokládejme, ¾e pou¾íváte více IP adres, které jsou na stejné
podsíti, a pou¾íváte k tomu aliasy. va¹e sí»ová maska pro ka¾dý alias má
automaticky hodnotu 255.255.255.255. Není nutné, aby sí»ové masky aliasù
následovaly sí»ovou masku prvního IP spojeného s tímto zaøízením. V
následujícím pøíkladì <i>/etc/hostname.dc0</i> jsou pøidány dva aliasy
pro zaøízení dc0, které mimo jiné bylo nastaveno jako 192.168.0.2
netmask 255.255.255.0.

<blockquote><pre>
# <b>cat /etc/hostname.dc0</b>
inet 192.168.0.2 255.255.255.0 media 100baseTX
inet alias 192.168.0.3 255.255.255.255
inet alias 192.168.0.4 255.255.255.255
</pre></blockquote>

<p>
Poté co jste vytvoøili tento soubor, budete muset rebootovat, aby se
zmìny nastavení projevily. Nebo mù¾ete nastavit aliasy ruènì pomocí 
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=ifconfig&amp;sektion=8">ifconfig(8)</a>.
Nastavení prvního aliasu by se provedlo takto:

<blockquote><pre>
# <b>ifconfig dc0 inet alias 192.168.0.3 netmask 255.255.255.255</b>
</pre></blockquote>

<p>
Pro prohlí¾ení tìchto aliasù je vhodný pøíkaz:

<blockquote><pre>
$ <b>ifconfig -A</b>
dc0: flags=8863&lt;UP,BROADCAST,NOTRAILERS,RUNNING,SIMPLEX,MULTICAST&gt;
        media: Ethernet manual
        inet 192.168.0.2  netmask 0xffffff00 broadcast 192.168.0.255
        inet 192.168.0.3 netmask 0xffffffff broadcast 192.168.0.3
</pre></blockquote>

<p>
<a name="NAT"></a>
<a name="PF"></a>
<h2>6.3 - Packet Filter (PF)</h2>
Packet Filter (dále je PF) je systém pro filtrování TCP/IP provozu
a provádìní pøekladu adres (Network Address Translation) v OpenBSD.
PF je také pou¾itelný k normalizování a pomiòování TCP/IP provozu
a ke kontrole ¹íøky pásma a prioritizaci paketù a mù¾e být pou¾it
k vytváøení výkoných a flexibilních firewallù.
Je popsán v <a href="../pf/cs/index.html">U¾ivatelské pøíruèce PF</a>.

<p>

<a name= "DHCP"></a>
<h2>6.4 - DHCP</h2>

<h3>6.4.1 DHCP Klient</h3>
<p>
Pro pou¾ívání DHCP klienta 
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=dhclient&amp;sektion=8">dhclient(8)</a>
dodávaného spolu s OpenBSD, zeditujte soubor /etc/hostname.xl0 (za
pøedpokladu, ¾e va¹e hlavní ethernetové rozhraní je xl0. Mù¾ete mít jiné
rozhraní, napø. ep0 nebo fxp0 nebo jiné!) Jediné slovo, které musí tento
soubor po editaci obsahovat je 'dhcp'.

<pre>
# <strong>echo dhcp  &gt;/etc/hostname.xl0</strong>
</pre>

<p>
Tento pøíkaz zpùsobí automatické nastartovaní DHCP klienta pøi
bootování.  OpenBSD bude od DHCP serveru po¾adovat informaci o své IP
adrese, defaultním routeru a DNS serverech.

<p>
Chcete-li spou¹tìt DHCP klienta z pøíkazové øádky, ujistìte se, ¾e
existuje soubor /etc/dhclient.conf a potom vyzkou¹ejte:

<pre>
# <strong>dhclient fxp0</strong>
</pre>

<p>
kde fxp0 je rozhraní, které chcete konfigurovat pomocí DHCP.

<p>
Bez ohledu na to, jak spustíte DHCP klienta, mù¾ete zeditovat soubor
/etc/dhclient.conf , aby napø. nedo¹lo ke zmìnì v ji¾ nakonfigurovaném
DNS na základì odezvy DHCP serveru. V tomto pøípadì staèí kdy¾
odkomentujete øádku zaèínající slovem 'request' (tato øádka se nachází v
pùvodním souboru, ale potøebujete ji odkomentovat abyste docílili zmìny
v chování DHCP klienta).

<pre>
request subnet-mask, broadcast-address, time-offset, routers,
      domain-name, domain-name-servers, host-name, lpr-servers, ntp-servers;
</pre>

<p>
a potom <b>odstraòte</b> slovo domain-name-servers. Samozøejmì mù¾ete
chtít odstranit i jiná nastavení jako napø. hostname.

<p>
<h3>6.4.2 DHCP Server</h3>
<p>
Pokud chcete pou¾ívat OpenBSD jako DHCP server 
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=dhcpd&amp;sektion=8">dhcpd(8)</a>,
zeditujte /etc/rc.conf. Nastavte v nìm volbu dhcpd_flags="-q" namísto
pùvodní dhcpd_flags=NO. Nyní uveïte rozhraní, na kterých chcete, aby
<b>poslouchal</b> DHCP server, v souboru /etc/dhcpd.interfaces.

<pre>
     # <b>echo xl1 xl2 xl3  &gt;/etc/dhcpd.interfaces</b>
</pre>

<p>
Pak upravte <tt>/etc/dhcpd.conf</tt>.
Volby uvedené v tomto souboru jsou dostateènì zøejmé.

<pre>
        option  domain-name "example.com";
        option  domain-name-servers 192.168.1.3, 192.168.1.5;

        subnet 192.168.1.0 netmask 255.255.255.0 {
                option routers 192.168.1.1;

                range 192.168.1.32 192.168.1.127;
        }
</pre>

<p>
Takovéto nastavení øíká va¹im DHCP klientùm, ¾e doména, kterou mají
pøidávat k DNS dotazùm je xyz.mil (tedy pokud u¾ivatel napí¹e 'telnet
joe', pak ve skuteènosti se bude spojovat se strojem joe.xyz.mil).
Dále odká¾ete klienta, aby pou¾íval DNS servery 192.168.1.3 a
192.168.1.5.  Poèítaèùm na stejné síti jako je ethernetové rozhraní DHCP
serveru, je¾ je v rozsahu 192.168.1.0/24 , bude DHCP server pøiøazovat
IP adresy mezi 192.168.1.32 a 192.168.1.127. Defaultní router klientù
bude nastaven na 192.168.1.1.

<p>
Pokud chcete spou¹tìt dhcpd z pøíkazové øádky, po editaci
/etc/dhcpd.conf vyzkou¹ejte:

<pre>
     # <b>dhcpd -q fxp0</b>
</pre>

<p>
kde fxp0 je rozhraní, na kterém chcete nastartovat DHCP server. Volba -q øíká
dhcpd; aby vypisoval co nejménì informací, v opaèném pøípadì je toti¾
velmi "ukecaný".

<p>
Pou¾íváte-li DHCP server pro stroje s Windows, mù¾ete dát klientovi adresu
'WINS' serveru. Docílíte toho tímto øádkem v /etc/dhcpd.conf:

<pre>
     option  netbios-name-servers  192.168.92.55;
</pre>

<p>
(kde 192.168.92.55 je IP va¹eho Windows nebo Samba serveru.)
Více voleb pro dhcp klienty se najdete zde: 
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=dhcp-options&amp;sektion=5">dhcp-options(5)</a>.

<p>
<a name="PPP"></a>
<h2>6.5 - PPP </h2>
<p>
Point-to-Point Protokol je tím protokolem, který se dnes pou¾ívá pro spojení s
modemem va¹eho ISP. OpenBSD má dva zpùsoby jak toto spojení nakonfigurovat.

<ul>
<li><a href="http://www.openbsd.org/cgi-bin/man.cgi?query=pppd&amp;sektion=8">pppd(8)</a>
 - Jedná se o ppp démona zaèlenìného do jádra systému .
<li><a href="http://www.openbsd.org/cgi-bin/man.cgi?query=ppp&amp;sektion=8">ppp(8)</a>
 - Tento ppp démon pracuje jako u¾ivatelský proces (nesystémový).
</ul>

<p>
První, který popí¹eme bude nesystémový ppp démon. Pøedtím ne¾ zaènete s
konfigurací je dobré zjistit si nìkteré údaje od va¹eho ISP. Jedná se
pøedev¹ím o:

<ul>
<li>Telefonní (dialup) èíslo va¹eho ISP
<li>vá¹ nameserver
<li>va¹e u¾ivatelské jméno a heslo
<li>vá¹ router
</ul>

<p>
Nìkteré z tìchto informací nutnì nepotøebujete, bez jiných se zase
neobejdete.  Nesystémový ppp démon pou¾ívá
<a href="http://www.openbsd.org/cgi-bin/cvsweb/src/etc/ppp/ppp.conf.sample">/etc/ppp/ppp.conf</a>
jako svùj konfiguraèní soubor.
V adresáøi <b>/etc/ppp</b> se obecnì nachází øada souborù, které nabízejí
rùzné nastavení pro rùzné situace. Mìli byste si je prohlédnout.

<p>
Také se ujistìte, v pøípadì, ¾e pou¾íváte jádro GENERIC, ¾e máte
následující øádku ve va¹em konfiguraèním souboru:

<blockquote><pre><strong>
pseudo-device   tun             2
</strong></pre></blockquote>

<p>
<h3>Úvodní nastavení - pro PPP(8)</h3>

<p>
Úvodní nastavení nesystémového démona se sestává z editace souboru
<b>/etc/ppp/ppp.conf</b>. Tento soubor defaultnì neexistuje, ale je tu
soubor <b>/etc/ppp/ppp.conf.sample</b> , který mù¾ete jednodu¹e
zeditovat a vytvoøit tak vlastní <b>ppp.conf</b> . Zde zaèneme s
nejjednodu¹¹ím a patrnì také nejèastìj¹ím nastavením. Zde je soubor
<b>ppp.conf</b>, díky kterému se ppp spojí s va¹ím ISP a nastaví
defaultní routy a nameserver. S tímto souborem potøebujete vìdìt jen
informaci o telefonním èísle va¹eho ISP, u¾ivatelském jménu a heslu.

<blockquote>
<pre>
default:
set log Phase Chat LCP IPCP CCP tun command
set device /dev/cua01
set speed 115200
set dial "ABORT BUSY ABORT NO\\sCARRIER TIMEOUT 5 \"\" AT OK-AT-OK ATE1Q0 OK\\dATDT\\T TIMEOUT 40 CONNECT"
</pre>
</blockquote>

<p>
Sekce uvedená slovem <b>default:</b> bude vykonána pøi ka¾dém spu¹tìní.
Zde nastavujeme v¹echny kritické informace. Slovem  &quot;set log&quot;
nastavujeme záznamovou úroveò. Je mo¾né to zmìnit; více manuálová
stránka
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=ppp&amp;sektion=8">ppp(8)</a>.
Sériový port se nastavuje pøíkazem &quot;set device&quot;. Toto je
zaøízení, na kterém se nachází modem. V na¹em  pøípadì je modem na portu
2. Proto com port 1 by byl /dev/cua00. Slovem  &quot;set speed&quot;
nastavujeme rychlost dialup spojení a pomocí &quot;set dial&quot;
nastavujeme parametry dialup-u. Pomocí nich mù¾eme zmìnit ná¹ timeout
atd. 

<p>
Nyní mù¾eme pokraèovat nastavením informací o na¹em ISP. Provedeme to
pøidáním nové sekce za sekci <b>default:</b> . Tato sekce se mù¾e
jmenovat jakkoliv, nejjednodu¹¹í je pou¾ít jméno va¹eho ISP. My
pou¾ijeme oznaèení <b>myisp:</b> .  Následuje krátké a jednoduché
nastavení, které poskytuje to nejnutnìj¹í pro na¹e spojení.

<blockquote>
<pre>
myisp:
set phone 1234567
set login "ABORT NO\\sCARRIER TIMEOUT 5 ogin:--ogin: ppp word: ppp"
set timeout 120
set ifaddr 10.0.0.1/0 10.0.0.2/0 255.255.255.0 0.0.0.0
add default HISADDR
enable dns
</pre>
</blockquote>

<p>
Zde jsme nastavili  &quot;set phone&quot; telefonní èíslo na¹eho ISP,
&quot;set login&quot; volby pro pøihlá¹ení (timeout nastavený na 5
znamená, ¾e pøeru¹íme pokus o pøihlá¹ení po pìti sekundách není-li na
lince signál. Jinak budeme èekat na zaslání na poslání øetìzce
&quot;login:&quot; a pak po¹leme na¹e u¾ivatelské jméno a heslo. U nás
to bude username=ppp a password=ppp. Tyto hodnoty si zmìnte na va¹e
vlastní. &quot;set timeout&quot; nastavuje timeout pro celý pøihla¹ovací
proces na 120 sekund. &quot;set ifaddr&quot; je ponìkud trikové.
Vysvìtlení je zde:

<blockquote><pre>
set ifaddr 10.0.0.1/0 10.0.0.2/0 255.255.255.0 0.0.0.0
</pre></blockquote>

<p>
V øádku nahoøe nastavujeme na¹i IP adresu ve formátu &quot;<b>set ifaddr
[myaddr[/nn] [hisaddr[/nn] [netmask [triggeraddr]]]]</b>&quot;. Tedy
první IP adresa na øádce specifikuje èíslo, které chceme obdr¾et od ISP
jako na¹i IP adresu. Pokud máte statickou IP adresu, nastavte ji zde. U
nás pou¾ijeme /0 , co¾ øíká, ¾e ¾ádný z bitù ip adresy nemusí odpovídat
a proto celá adresa mù¾e být nahrazena jinou (dynamicky pøiøazenou).
Druhá IP adresa je adresa, kterou oèekáváme jako IP adresu na¹eho ISP.
Pokud ji znáte, mù¾ete ji specifikovat. My opìt nevíme, co máme
oèekávat, proto pou¾ijeme opìt /0 . Tøetí èíslo je na¹e sí»ová maska,
zde nastavena na 255.255.255.0 . Pokud specifikujeme triggeraddr, je
pou¾ita namísto myaddr v pùvodní IPCP komunikaci. Pøesto, pouze adresa v
rozsahu myaddr bude akceptována. Toto je u¾iteèné pøi komunikaci s
nìkterými implementacemi PPP, které nedovolují pøiøadit IP adresu, pokud
peer ¾ádá ``0.0.0.0''.

<p>
Dal¹í volba  &quot;add default HISADDR&quot; nastavuje defaultní routu
na IP adresu providera. Dobré je, ¾e pokud se zmìní IP adresa providera
za chodu, bude va¹e routa automaticky upravena. Volbou  &quot;enable
dns&quot; øíkáme na¹emu ISP, aby nám sdìlil adresu nameserveru.
Nepøidávejte tuto volbu, pokud u vás bì¾í lokální DNS, proto¾e ppp lehce
znemo¾ní její pou¾ívání tím, ¾e pøidá nìkolik øádek do souboru
/etc/resolv.conf.

<p>
<h3>Pou¾ívání PPP(8)</h3>

<p>
Nyní máme základní nastavení v souboru <b>ppp.conf</b> pøipravené a
mù¾eme zaèít zkou¹et spojení s na¹ím ISP. Obvyklé formy pøíkazu jsou:
</p>

<ul>
<li><tt>ppp -auto myisp</tt> - Spustí ppp, nastaví rozhraní a spojí se
s na¹im isp, poté pøechází na pozadí.
<li><tt>ppp -ddial myisp</tt> - Podobné jako -auto, ale pokud konekce je
zru¹ena, pokusí se znovu o spojení.
</ul>

<p>
Spu¹tìní <b>/usr/sbin/ppp</b> bez voleb vás zavede do interaktivního
módu. V nìm mù¾ete komunikovat pøímo s modemem, co¾ je velmi vhodné
k ladìní problémù ve va¹em <b>ppp.conf</b>.

<h3>ppp(8) extra</h3>

<p>
V nìkterých situacích mù¾ete chtít spustit dodateènì nìjaké pøíkazy,
kdy¾ je vytvoøeno nebo naopak zru¹eno spojení. Jsou zde dva soubory,
které mù¾ete vytvoøit pro tyto situace. <b>/etc/ppp/ppp.linkup</b> a
<b>/etc/ppp/ppp.linkdown</b>.
Pøíklad nastavení je zde:
</p>

<ul>
<li><a href="http://www.openbsd.org/cgi-bin/cvsweb/src/etc/ppp/ppp.linkup.sample">ppp.linkup</a>
<li><a href="http://www.openbsd.org/cgi-bin/cvsweb/src/etc/ppp/ppp.linkdown.sample">ppp.linkdown</a>
</ul>

<p>
Dal¹í informace mù¾ete najít ve 
<a href="http://www.freebsd.org/doc/en_US.ISO8859-1/books/handbook/userppp.html">FreeBSD Handbook, èást User PPP</a>.

<p>
<a name="Tuning"></a>
<h2>6.6 - Zlep¹ování výkonu sítì</h2>
<!-- XXXrelease -->

<p>
<h3>6.6.1 - Jak pøinutit jádro, aby dovolovalo vìt¹í poèet pokusù a
del¹í timeout pro TCP spojení?</h3>

<p>
Normálnì byste to mìl vyu¾ít v pøípadì smìrovacích nebo spojovacích
problémù.  Samozøejmì, nejefektivnìj¹í je, kdy¾ obì strany spojení
pou¾ívají podobné hodnoty. 

<p>
Pou¾ijte <tt>sysctl</tt> a zvìt¹ete hodnoty promìnných:

<pre>
net.inet.tcp.keepinittime
net.inet.tcp.keepidle
net.inet.tcp.keepintvl
</pre>

<p>
Díky sysctl -a mù¾ete vidìt souèasné hodnoty tìchto a mnoha dal¹ích parametrù.
Zmìnu provedete pomocí <tt>sysctl -w</tt> jako napø. <tt>sysctl -w
net.inet.tcp.keepidle=28800</tt>.

<p>
<h3>6.6.2 - Jak mohu umo¾nit directed broadcast?</h3>

<p>
Normálnì to nepotøebujete dìlat. Directed broadcast umo¾òuje komukoliv
poslat pakety na veøejnou adresu va¹í pøipojené sítì, pokud pou¾íváte
OpenBSD jako router.

<p>
V nìkterých pøípadech uzavøených sítí mù¾e být directed broadcast
u¾iteèný, zejména pøi pou¾ívání starých implementací NetBIOS protokolu.
Pou¾ijte <tt>sysctl -w net.inet.ip.directed-broadcast=1</tt> pro tuto
vlastnost. Rovnou si ale pøeètìte také èlánek o <a
href="http://www.netscan.org">smurf útocích</a>,
pokud chcete vìdìt, proè je tato vlastnost defaultnì vypnutá.

<p>
<h3>6.6.3 - Nechci, aby kernel dynamicky alokoval urèité porty</h3>

<p>
Na tohle tu také máme jedno sysctl. 
V <a href="http://www.openbsd.org/cgi-bin/man.cgi?query=sysctl&amp;sektion=8">sysctl(8)</a>
se pí¹e:

<pre>
Nastavení rezervovaných TCP portù, které by nemìly být dynamicky
pøidìlovány jádrem. Seznam èísel tìchto portù mù¾e být oddìlen èárkami
a/nebo mezerami.

 #  <strong>sysctl -w  net.inet.tcp.baddynamic=749,750,751,760,761,871</strong>

Je také mo¾né odstranit nebo pøidat èásti souèasného seznamu.

 #  <strong>sysctl -w net.inet.tcp.baddynamic=+748</strong>
 #  <strong>sysctl -w net.inet.tcp.baddynamic=-871</strong>
</pre>

<p>
<a name="NFS"></a>
<h2>6.7 - Jednoduché pou¾ití NFS</h2>

<p>
NFS, neboli Network File System, se pou¾ívá pro sdílení souborových
systémù na síti. Dobré je, kdy¾ pøed pokusem o nastavení NFS serverù si
pøeètete pár manuálových stránek:

<ul>
<li><a href="http://www.openbsd.org/cgi-bin/man.cgi?query=nfsd&amp;sektion=8">nfsd(8)</a>
<li><a href="http://www.openbsd.org/cgi-bin/man.cgi?query=mountd&amp;sektion=8">mountd(8)</a>
<li><a href="http://www.openbsd.org/cgi-bin/man.cgi?query=exports&amp;sektion=5">exports(5)</a>
</ul>

<p>
Tato sekce vás provede základními kroky pro jednoduché nastavení NFS.
V pøíkladì pøedpokládejme server na LAN, s klienty pøistupujícími na NFS
na LAN. Nemluvíme zde o zabezpeèení NFS. Pøedpokládáme, ¾e jste ji¾
nastavili filtrování paketù, nebo jinou firewallovou ochranu pro
odepøení pøístupu zvenèí.  Pokud dovolujete vnìj¹í pøístup na vá¹ NFS
server a máte na nìm nìjaká citlivá data, dùraznì doporuèujeme, abyste
zprovoznil IPsec.  V opaèném pøípadì mohou cizí lidé potenciálnì vidìt
va¹e  NFS spojení. Nìkdo mù¾e také pøedstírat, ¾e má IP adresu, která
je povolená na va¹em NFS serveru. Mù¾e to vést i k nìkterým
útokùm. Pokud je IPsec protokol správnì nastaven, mù¾e vás od tohoto
typu útokù ochránit. 

<p>
Jiná podstatná bezpeènostní poznámka. Nepøidávejte filesystém do
/etc/exports bez urèitého seznamu povolených strojù. Bez seznamu strojù,
které mohou pøipojit daný adresáø, mù¾e kdokoliv, kdo má spojení s va¹ím
poèítaèem, pøipojit adresáøe, které pøes NFS exportujete.

<p>
NFS potøebuje, aby
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=portmap&amp;sektion=8">portmap(8)</a>
bì¾el pøed tím, ne¾ zaène fungovat. Portmap(8) je nyní standardnì
vypnut na OpenBSD 3.2 a novìj¹ím, tak¾e ho musíte zapnout v
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=rc.conf&amp;sektion=8">rc.conf(8)</a>
zmìnou øádky <tt>portmap</tt> na

<blockquote><pre>
portmap=YES
</pre></blockquote>
a rebootem, aby se to projevilo.

<p>
Nastavení obsahuje server s ip <b>10.0.0.1</b>, který slou¾í jako NFS
server pouze klientùm na této síti. První krok pøi nastavení NFS je
nastavit soubor <i>/etc/exports</i> . Tento soubor obsahuje seznam
filesystému, které chcete zpøístupnit pøes NFS a definuje, komu je
mù¾ete zpøístupnit.  V <i>/etc/exports</i> mù¾ete pou¾ít spoustu voleb a
nejlépe je pøeèíst si manuálovou stránku 
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=exports&amp;sektion=5">exports(5)</a>.
My máme <i>/etc/exports</i> takovýto:

<blockquote><pre>
#
# NFS exports Database
# See exports(5) for more information.  Be very careful, misconfiguration
# of this file can result in your filesystems being readable by the world.
/work -alldirs -ro -network 10.0.0 -mask 255.255.255.0
</pre></blockquote>

<p>
To znamená, ¾e lokální filesystém  <b>/work</b> bude zpøístupnìn pøes
NFS.  <b>-alldirs</b> øíká, ¾e klienti budou moci pøipojit kterýkoliv
podadresáø adresáøe <b>/work</b>. <b>-ro</b> øíká, ¾e pøipojit
filesystém bude mo¾né jen pro ètení. Poslední dva argumenty øíkají, ¾e
pouze klienti v rozsahu sítì 10.0.0.0 s maskou 255.255.255.0 budu
oprávnìni pøipojit filesystém. To je dùle¾ité zejména pro sítì, které
jsou pøístupné zvenku.

<p>
Máte-li nastaven <i>/etc/exports</i>, mù¾ete pokraèovat v nastavení
NFS serveru. Nejprve se ujistìte, ¾e máte zkompilované jádro s volbami
NFSSERVER a NFSCLIENT (jádra GENERIC jsou ok).  Dále nastavte v
<i>/etc/rc.conf</i> <strong>nfs_server=YES</strong> . Tím spustíte
nfsd(8) i mountd(8) po rebootování.  Pro zaèátek mù¾ete spustit démony
ruènì. Musíte je spustit jako root a potøebujete se ujistit, ¾e vám na
systému bì¾í portmap(8). Pøíklad jak spustit nfsd(8), který pracuje jak
na TCP tak na UDP ve 4 instancích. Mìli byste nastavit maximální poèet
klientù se ¾ádostí o spojení na slu¾bu NFS.

<blockquote><pre>
# <strong>/sbin/nfsd -tun 4</strong>
</pre></blockquote>

<p>
Nestaèí pustit jen nfsd(8) server, musíte spustit i mountd(8). Jedná se
o démona, který vlastnì obsluhuje ¾ádosti o NFS spojení. Ujistìte se. ¾e
existuje prázdný soubor mountdtab, a spus»te démona: 

<blockquote><pre>
# <strong>echo -n &gt;/var/db/mountdtab</strong>
# <strong>/sbin/mountd</strong>
</pre></blockquote>

<p>
Pokud udìláte zmìny v /etc/exports poté co u¾ NFS bì¾í, musíte na to
mountd upozornit! Takhle:

<blockquote><pre>
# <strong>kill -HUP `cat /var/run/mountd.pid`</strong>
</pre></blockquote>

<p>
<h3>Kontrola stavu NFS</h3>

<p>
Nyní se mù¾ete podívat a ujistit se, ¾e démoni bì¾í a jsou registrováni
s RPC.  Pou¾ijte procinfo(8).

<blockquote><pre>
$ <strong>rpcinfo -p 10.0.0.1</strong>
   program vers proto   port
    100000    2   tcp    111  portmapper
    100000    2   udp    111  portmapper
    100005    1   udp    633  mountd
    100005    3   udp    633  mountd
    100005    1   tcp    916  mountd
    100005    3   tcp    916  mountd
    100003    2   udp   2049  nfs
    100003    3   udp   2049  nfs
    100003    2   tcp   2049  nfs
    100003    3   tcp   2049  nfs
</pre></blockquote>

<p>
V normálním provozu máte k dispozici dal¹í utility, které vám
dovolují sledovat co se dìje na NFS. Jedna z nich je 
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=showmount&amp;sektion=8">showmount(8)</a>,
která umo¾òuje sledovat co je právì pøipojeno a kdo to pøipojil. Dále
také nfsstat(8) s podrobnìj¹ím výpisem. Pou¾ití pøíkazu showmount(8):
zkuste <tt>/usr/bin/showmount -a host</tt>. Napøíklad:

<p>

<blockquote><pre>
$ <strong>/usr/bin/showmount -a 10.0.0.1</strong>
All mount points on 10.0.0.1:
10.0.0.37:/work
</pre></blockquote>

<p>
<h3>Pøipojení NFS filesystému</h3>

<p>
NFS filesystém by mìl být pøipojen pomocí pøíkazu mount(8), nebo konkrétnìji 
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=mount_nfs&amp;sektion=8">mount_nfs(8)</a>.
Pro pøipojení filesystému /work na stroji 10.0.0.1 na lokální filesystém
/mnt, udìlejte toto: (pozn. nepotøebujete pou¾ívat ip adresy, mount
pøekládá jména):

<blockquote><pre>
# <strong>mount -t nfs 10.0.0.1:/work /mnt</strong>
</pre></blockquote>

<p>
Pøipojení systému pøi bootu:
pøidejte do <i>/etc/fstab</i>:

<blockquote><pre>
10.0.0.1:/work /mnt nfs rw 0 0
</pre></blockquote>

<p>
Je dùle¾ité pou¾ít <tt>0 0</tt> na konci øádky, jinak bude vá¹ poèítaè
pou¹tìt fsck na NFS filesystém pøi startu!!!!  Jiné standardní security
volby jsou noexec, nodev, a nosuid - ta poslední by mìla být pou¾ita,
kde jen to je mo¾né.
Napø.:

<blockquote><pre>
10.0.0.1:/work /mnt nfs rw,nodev,nosuid 0 0
</pre></blockquote>

<p>
Díky tomu nebudou moci ¾ádné suid bit binárky na NFS serveru podlomit
bezpeènost na NFS klientovi. Pokud nepøipojujete programy, které by mìly
bì¾et na klientovi, pøidejte noexec.

<p>
<a name="PPTP"></a>
<h2>6.8 - Nastavení PPTP spojení v OpenBSD</h2>

<p>
<strong>POZNÁMKA:</strong> Informace se nevztahují ke
<strong>V©EM</strong> ADSL providerùm, ale mnoho informací mù¾e být
pøevzato z tohoto nastavení. O nìm je známo, ¾e funguje pro ADS
providera v Rakousku <a href="http://www.inode.at">Inode</a>.

<p>
Pro zaèátek potøebujete nainstalovat pptp.  Port se nachází v
<i>/usr/ports/net/pptp</i>. Pøeètìte si <a href="faq8.html#Ports">FAQ 8,
Ports</a> pro více informací o OpenBSD ports tree.

<p>
V dùsledku konfliktu pptp s podporou 
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=gre&amp;apropos=0&amp;sektion=0">gre(4)</a>
v jádøe budete nutné pøekompilovat jádro a odstranit podporu pro gre(4).

<blockquote>Patch pro odstranìní GRE(4) podpory.
<pre>
Index: GENERIC
===================================================================
RCS file: /cvs/src/sys/conf/GENERIC,v
retrieving revision 1.86
diff -u -r1.86 GENERIC
--- GENERIC     14 Mar 2002 00:42:25 -0000      1.86
+++ GENERIC     17 May 2002 01:52:17 -0000
@@@@ -87,7 +87,7 @@@@               
 pseudo-device  enc     1       # option IPSEC needs the encapsulation interface
 pseudo-device  bridge  2       # network bridging support
 pseudo-device  vlan    2       # IEEE 802.1Q VLAN
-pseudo-device  gre     1       # GRE encapsulation interface
+#pseudo-device gre     1       # GRE encapsulation interface
 #pseudo-device strip   1       # Starmode Radio IP interface

 pseudo-device  pty     64      # pseudo-terminals
</pre></blockquote>

<p>
Pro pøekompilování jádra proveïte checkout  OpenBSD source tree pomocí cvs 
(podívejte se na webovou stránku <a href="../../cs/anoncvs.html">AnonCVS</a>
pro dal¹í informace), aplikujte pøedcházející patch a pøekompilujete kernel
podle <a href="faq5.html#Building">FAQ 5, Kompilace kernelu</a>.

<p>
Poté co nainstalujete balík <b>pptp</b> a nové jádro, potøebujete zeditovat
soubory pro nastavení spojení. Tento balík pou¾ívá do OpenBSD zakomponované
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=ppp&amp;apropos=0&amp;sektion=0">ppp(8)</a>,
tak¾e pokud se v nìm vyznáte, pak velká èást nastavení vypadá stejnì. Rovnì¾
se podívejte na <a href="#PPP">FAQ 6, PPP</a>.

<ul>
<li>1 - /etc/ppp/options
<li>2 - /etc/ppp/pap-secrets
</ul>

<p>
Soubor <i>/etc/ppp/options</i> s následujícím nastavením bude dìlat
pravdìpodobnì co potøebujete:

<blockquote><pre>
# <strong>cat /etc/ppp/options</strong>
name "LOGINNAME"
noauth
noipdefault
defaultroute
debug
</pre></blockquote>

<p>
<tt>LOGINNAME</tt> Mìlo by být nahrazeno va¹ím User-ID.

<p>
V  <i>/etc/ppp/pap-secrets</i> øádek:

<blockquote><pre>
# <strong>cat /etc/ppp/pap-secrets</strong>
LOGINNAME 10.0.0.138 PASSWORD
</pre></blockquote>

<p>
Kde LOGINNAME je va¹e User-ID a PASSWORD je va¹e heslo. 10.0.0.138 je IP
pøiøazené va¹emu MODEMu v pøípadì ¾e pou¾íváte ADSL, atd. Ujistìte se,
¾e soubor mù¾e èíst pouze u¾ivatel root (mód 600).

<p>
<h3>6.8.1 - Pøiøazení adresy sí»ovému rozhraní</h3>

<p>
V pøedcházejícím pøípadì mìl ná¹ modem pøedkonfigurované rozhraní na
10.0.0.138.  Nyní potøebujeme pøiøadit adresu  NA©EMU rozhraní. Nejlépe
je vybrat si jedno IP blízko tomu, které vám bylo pøiøazeno va¹ím
modemem, nebo pou¾ít statické IP, které vám pøiøadili. Více si pøeètìte
v <a href="#Setup">FAQ 6, Úvodní nastavení sítì</a>.

<p>
Poté co nastavíte rozhraní, mìli byste být schopni vytvoøit pptp
spojení pøíkazem.

<blockquote><pre>
# <strong>/usr/local/sbin/pptp 10.0.0.138 &amp;</strong>
</pre></blockquote>

<p>
Proto¾e pou¾íváme do OpenBSD zaèlenìné ppp(8), jsou nastartovány dva
procesy. Mù¾ete zastavit pptp ukonèením obou procesù:

<blockquote><pre>
# <strong>kill -9 [pid of pppd]</strong>
$ <strong>kill -9 [pid of pptp]</strong>
</pre></blockquote>

Doporuèujeme otevøít si  <tt>/var/log/messages</tt> v oddìleném
terminálovém oknì, abyste rozpoznali mo¾né problémy.

<blockquote>
<pre>
# <strong>tail -f /var/log/messages</strong>
</pre></blockquote>
</p>

<p>
Rovnì¾ si pøidejte startovací pøíkaz do <i>/etc/rc.local</i>, abyste se
mohli automaticky spojit pøi restartu.

<p>
<a name= "Bridge"></a>
<h2>6.9 - Nastavení bridge s OpenBSD</h2>

<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=bridge&amp;sektion=4">Bridge</a>
je spojení mezi dvìma nebo více oddìlenými sítìmi. Narozdíl od routeru
prochází pakety bridgem "neviditelnì" -- dva sí»ové segmenty se logicky
tváøí jako jeden segment pro uzly na obou stranách bridge. Bridge
forwarduje jenom pakety, které mají projít z jednoho segmentu do druhého,
tak¾e mimo jiné pøedstavuje jednoduchý zpùsob jak sní¾it provoz 
v komplexních sítích a pøitom umo¾nit libovolnému uzlu pøístup 
k ostatním, kdy¾ je zapotøebí.

<p>
V¹imnìte si, ¾e kvùli své "neviditelné" povaze mù¾e i nemusí mít
rozhraní bridge svou IP adresu. Pokud ji má, pracuje rozhraní vlastnì ve
dvou módech, jednak jako èást bridge, jednak jako standardní sí»ový
adaptér. Pokud ¾ádné rozhraní nemá IP adresu, bridge bude propou¹tìt
sí»ová data, ale nebude externì udr¾ovatelný (co¾ mù¾e být výhoda).

<p>
<h3>Pøíklad aplikace bridge</h3>
V jednom z mých rackù je nìkolik star¹ích systémù, z nich¾ ¾ádný nemá
integrovaný 10BASE-TX NIC. Vzhledem k tomu, ¾e v¹echny mají AUI nebo
AAUI konektory, mù¾u pou¾ít jenom koaxiální transceivery. Jedna z ma¹in
v tomto racku je OpenBSD terminálový server, který stále bì¾í a je
pøipojen k vysokorychlostní síti. Pøidání druhé sí»ové karty s
koaxiálním portem mi umo¾ní pou¾ít tento stroj jako bridge do koaxiální
sítì.

<p>
Systém má nyní dvì sí»ové karty, Intel EtherExpress/100
(<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=fxp&amp;sektion=4"><tt>fxp0</tt></a>)
a 3c590-Combo
(<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=ep&amp;sektion=4"><tt>ep0</tt></a>)
s koaxiálním portem. <tt>fxp0</tt> je spojení do zbytku mojí sítì a
proto bude mít IP adresu, <tt>ep0</tt> bude slou¾it jenom k bridgování a
nebude mít IP adresu. Poèítaèe v koaxiálním segmentu budou komunikovat
tak, jako by byly ve zbytku mojí sítì. Tak¾e, jak to udìláme?

<p>
Soubor <tt>hostname.fxp0</tt> obsahuje konfiguraci karty <tt>fxp0</tt>.
Tento stroj je nastavován pøes DHCP, tak¾e soubor vypadá takhle:

<blockquote>
<pre>
$ <b>cat /etc/hostname.fxp0</b>
dhcp NONE NONE NONE NONE
</pre>
</blockquote>

<p>
®ádné pøekvapení.

<p>
Karta <tt>ep0</tt> je trochu jinak, jak jste asi uhodli:
<blockquote>
<pre>
$ <b>cat /etc/hostname.ep0</b>
up media 10base2
</pre>
</blockquote>

<p>
Tady øíkáme systému, aby aktivoval toto rozhraní pøes 
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=ifconfig&amp;sektion=8">ifconfig(8)</a>
a nastavil ho na 10BASE-2 (koax). ®ádnou IP adresa nebo podobné informace
nemusíme pro toto rozhraní specifikovat. Volby, které karta <tt>ep</tt>
umo¾òuje, jsou detailnì popsány v její
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=ep&amp;sektion=4">manuálové stránce</a>.

<p>
Teï potøebujeme nastavit bridge. Bridge jsou inicializovány pøítomností
souboru pojmenované nìjak jako
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=bridgename.if&amp;sektion=5">
<tt>bridgename.bridge0</tt></a>.
Tady je pøíklad pro mojí situaci:

<blockquote>
<pre>
$ <b>cat /etc/bridgename.bridge0</b>
add fxp0
add ep0
up
</pre>
</blockquote>

<p>
Toto øíká: nastav bridge skládající se ze dvou karet, fxp0 a ep0,
a aktivuj ho. Zále¾í na poøadí, ve kterém jsou karty uvedeny? Ne,
vzpomeòte si, ¾e bridge je velmi symetrický -- pakety chodí sem a tam
obìma smìry.

<p>
A je to! Reboot, a máte funkèní bridge.

<p>
<h3>Filtrování na bridge</h3>

I kdy¾ urèitì existuje vyu¾ití pro takhle jednoduché bridge, je mo¾né,
¾e budete chtít s pakety nìco DÌLAT, kdy¾ procházejí bridgem. Jak se
dalo èekat, k omezení, který provoz pùjde skrz bridge, mù¾e být pou¾it
<a href="#PF">Packet Filter</a>.

<p>
Uvìdomte si, ¾e, z podstaty bridge, stejná data prochází obìma
rozhraními, tak¾e potøebuje filtrovat pouze na jednom z nich. Va¹e
defaultní pravidla "Pass all" by vypadala nìjak takhle:

<blockquote>
<pre>
pass in  on ep0  all
pass out on ep0  all
pass in  on fxp0 all
pass out on fxp0 all
</pre>
</blockquote>

<p>
Nyní øeknìme, ¾e chci filtrovat provoz zasahující moje staré stroje.
Chci, aby se k nim dostal jenom Web a SSH. V tomto pøípadì povolíme
v¹echen provoz dovnitø a ven rozhraní ep0, ale budeme filtrovat na
rozhraní fxp0 s vyu¾itím keep state pro data odpovìdí:

<blockquote>
<pre>
# Pass all traffic through ep0
pass in quick on ep0 all
pass out quick on ep0 all

# Block fxp0 traffic
block in  on fxp0 all
block out on fxp0 all

pass in quick on fxp0 proto tcp from any to any port {22, 80} \
     flags S/SA keep state
</pre>
</blockquote>

<p>
V¹imnìte si, ¾e tato sada pravidel zabráním v¹emu kromì HTTP a SSH
spojení dosáhnout samotného bridge nebo kterékoliv ma¹iny "za" ním.
Jiných výsledkù je mo¾né dosáhnout filtrováním na druhém rozhraní.

<p>
K monitorování a kontrole bridge, který jste vytvoøili, pou¾ijte pøíkaz
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=brconfig&amp;sektion=8">brconfig(8)</a>,
který je také mo¾no pou¾ít k vytvoøení bridge po bootu.

<p>
<h3>Tipy k bridgování</h3>

<ul>
<li>Je VELMI doporuèováno, abyste filtrovali pouze na jednom rozhraní.
Je sice mo¾né filtrovat na obou, ale musíte to rozumìt opravdu dobøe,
abyste to udìlali správnì.

<li>Pou¾itím volby <i>blocknonip</i> pro
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=brconfig&amp;sektion=8">brconfig(8)</a>
nebo
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=bridgename.if&amp;sektion=5">bridgename.bridge0</a>,
mù¾ete zabránit ne-IP provozu (jako je IPX nebo NETBEUI) v proklouznutí
va¹imy filtry. To mù¾e být v nìkterých situacích dùle¾ité, ale uvìdomte
si, ¾e bridge funguje v¹echny typy provozu, nejen IP.

<li>Bridging vy¾aduje, aby byly sí»ové karty v "Promiskuitním re¾imu" --
poslouchají V©ECHEN sí»ový provoz, nejen ten, urèený pro dané rozhraní.
Tím dojde k vìt¹ímu zatí¾ení procesoru a sbìrnice ne¾ by èlovìk èekal.
Nìkteré karty v tomto re¾imu nefungují dobøe, TI ThunderLAN chipy
(<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=tl&amp;sektion=4">tl(4)</a>)
jsou pøíkladem chipu, který nebude fungovat jako èást bridge.
</ul>


<p>
<font color= "#0000e0">
<a href="index.html">[FAQ index]</a>
<a href="faq5.html">[Do sekce 5.0 - Nastavení jádra]</a>
<a href="faq7.html">[Do sekce 7.0 - Keyboard controls]</a>
</font>

<p>
<hr>
<a href="index.html"><img height= "24" width= "24" src= "../../images/back.gif" border= "0" alt= "[zpìt]"></a>
<a href="mailto:www@@openbsd.org">www@@openbsd.org</a>
<small>
<br>
Originally [OpenBSD: faq6.html,v 1.182 ]
<br>
$Translation: faq6.html,v 1.19 2004/01/11 21:41:15 certik Exp $
<br>
$OpenBSD: faq6.html,v 1.19 2004/01/16 20:30:20 jufi Exp $
</small>

</body>
</html>
@


1.19
log
@Sync with Steelix CVS
@
text
@d1304 1
a1304 1
$OpenBSD: faq6.html,v 1.15 2003/02/05 19:28:46 jufi Exp $
@


1.18
log
@Sync with Steelix CVS
@
text
@d10 1
a10 1
<meta name= "copyright"     content= "This document copyright 1998-2003 by OpenBSD.">
d1300 1
a1300 1
Originally [OpenBSD: faq6.html,v 1.181 ]
d1302 1
a1302 1
$Translation: faq6.html,v 1.18 2003/12/03 18:24:45 certik Exp $
@


1.17
log
@Sync with Steelix CVS
@
text
@d29 3
a31 3
<li><a href= "#Intro" >6.0.1 - Pøedtím ne¾ pùjdeme dále</a>
<li><a href= "#Setup" >6.1 - Úvodní nastavení sítì</a>
<li><a href= "#PF"    >6.2 - Packet Filter (PF)</a>
d36 2
a37 2
<li><a href= "#PPTP"  >6.9 - Nastavení PPTP spojení v OpenBSD</a>
<li><a href= "#Bridge">6.10 - Nastavení bridge s OpenBSD</a>
d44 1
a44 1
<a name="6.0.1"></a>
d77 1
a77 1
<h2>6.1 - Úvodní nastavení sítì</h2>
d81 1
a81 1
<h3>6.1.1 - Identifikace a nastavení va¹ich sí»ových rozhraní</h3>
a115 1
</p>
d170 1
a170 1
<li><a href="http://www.openbsd.org/cgi-bin/man.cgi?query=pflog&amp;sektion=4&amp;manpath=OpenBSD+3.3">pflog</a>
d321 1
a321 1
<h3>6.1.2 - Nastavení OpenBSD jako routeru</h3>
d373 1
a373 1
<h3>6.1.3 - Nastavení aliasù zaøízení</h3>
d439 1
a439 1
<h2>6.2 - Packet Filter (PF)</h2>
d443 3
a445 3
a ke kontrole ¹íøky pásma a prioritizaci paketù. PF je souèástí
GENERIC OpenBSD kernelu od verze OpenBSD 3.0. Je popsán v nové
<a href="../pf/cs/index.html">U¾ivatelské pøíruèce PF</a>.
a447 1
Staré PF FAQ je stále dostupné <a href="faq6pf.html">zde</a>.
a448 1
<p>
d988 1
a988 1
<h2>6.9 - Nastavení PPTP spojení v OpenBSD</h2>
d1074 1
a1074 1
<h3>6.9.1 - Pøiøazení adresy sí»ovému rozhraní</h3>
d1115 1
a1115 1
<h2>6.10 - Nastavení bridge s OpenBSD</h2>
a1210 1
<!-- XXXchanges - changes with OpenBSD 3.3 -->
d1300 1
a1300 1
Originally [OpenBSD: faq6.html,v 1.178 ]
d1302 1
a1302 1
$Translation: faq6.html,v 1.17 2003/11/02 21:49:28 certik Exp $
@


1.16
log
@Sync with Steelix CVS
@
text
@d1306 1
a1306 1
$Translation: faq6.html,v 1.16 2003/10/29 08:13:12 certik Exp $
@


1.15
log
@
sync with steelix translation CVS,
faq4.html work by pruzicka@@openbsd.cz
@
text
@d4 1
a4 1
<title>6.0 - Nastavení sítì</title>
d10 1
a10 1
<meta name= "copyright"     content= "This document copyright 1998-2002 by OpenBSD.">
d18 7
a24 1
<h2><font color="#e00000">6.0 - Nastavení sítì</font></h2>
a31 1
<li><a href= "#NAT"   >6.3 - Pøeklad sí»ových adres (NAT) </a>
a35 1
<li><a href= "#DNS"   >6.8 - Domain Name Service  - DNS, BIND a named</a>
a44 1
<h2>6.0.1 - Pøedtím ne¾ pùjdeme dále</h2>
d59 2
a60 3
<a href="http://www.3com.com/corpinfo/en_US/technology/tech_paper.jsp?DOC_ID=135">
V¹e co potøebujete vìdìt o IP adresování</a>
(nebo <a href="http://www.3com.com/other/pdfs/infra/corpinfo/en_US/501302.pdf">tady</a>).
d69 1
a69 1
<a href="http://the.rfceditor.org/rfc.html">ètením RFC dokumentù</a>.
a76 1
<a name="6.1"></a>
a80 1
<a name="6.1.1"></a>
d121 1
a121 1
        inet6 fe80::1%lo0 prefixlen 64 scopeid 0x4
d123 1
a123 1
        inet 127.0.0.1 netmask 0xff000000 
d126 1
d130 1
a130 1
	inet6 fe80::202:b3ff:fe2b:10f7%fxp0 prefixlen 64 scopeid 0x1
d132 1
d143 1
d145 2
a146 1
gre0: flags=8010&lt;POINTOPOINT,MULTICAST&gt; mtu 1450
d166 1
d168 1
d171 1
a171 1
<li><a href="http://www.openbsd.org/cgi-bin/man.cgi?query=pflog&amp;sektion=4&amp;manpath=OpenBSD+3.2">pflog</a>
d221 1
a221 1
inet 10.0.0.38 255.255.255.0 NONE media 100baseTX media-opt full-duplex
d251 1
a251 1
Patøíte rovnì¾ do domény &quot;yourdomain.com&quot;.
d255 1
a255 1
search yourdomain.com
d284 3
a321 1
<a name="6.1.2"></a>
d341 1
a341 1
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=sysctl.conf&amp;sektion=5">/etc/sysctl.conf(5)</a>.
d374 1
a374 2
<a name="6.1.3"></a>
<h3>6.1.3 - Nastavení aliasù zaøízení.</h3>
d401 7
a407 1406
Pøedpokládejme, ¾e pou¾íváte více IP adres, které jsou na stejné
podsíti, a pou¾íváte k tomu aliasy. va¹e sí»ová maska pro ka¾dý alias má
automaticky hodnotu 255.255.255.255. Není nutné, aby sí»ové masky aliasù
následovaly sí»ovou masku prvního IP spojeného s tímto zaøízením. V
následujícím pøíkladì <i>/etc/hostname.dc0</i> jsou pøidány dva aliasy
pro zaøízení dc0, které mimo jiné bylo nastaveno jako 192.168.0.2
netmask 255.255.255.0.

<blockquote><pre>
inet 192.168.0.2 255.255.255.0 media 100baseTX
inet alias 192.168.0.3 255.255.255.255
inet alias 192.168.0.4 255.255.255.255
</pre></blockquote>

<p>
Poté co jste vytvoøili tento soubor, budete muset rebootovat, aby se
zmìny nastavení projevily. Nebo mù¾ete nastavit aliasy ruènì pomocí 
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=ifconfig&amp;sektion=8">ifconfig(8)</a>.
Nastavení prvního aliasu by se provedlo takto:

<blockquote><pre>
# <b>ifconfig dc0 inet alias 192.168.0.3 netmask 255.255.255.255</b>
</pre></blockquote>

<p>
Pro prohlí¾ení tìchto aliasù je vhodný pøíkaz:

<blockquote><pre>
$ <b>ifconfig -A</b>
dc0: flags=8863&lt;UP,BROADCAST,NOTRAILERS,RUNNING,SIMPLEX,MULTICAST&gt;
        media: Ethernet manual
        inet 192.168.0.2  netmask 0xffffff00 broadcast 192.168.0.255
        inet 192.168.0.3 netmask 0xffffffff broadcast 192.168.0.3
</pre></blockquote>

<p>
<a name="6.2"></a>
<a name="PF"></a>
<h2>6.2 - Packet Filter (PF)</h2>

<p>
<h4>Poznámka: V OpenBSD 3.2 byla funkce <i>/etc/nat.conf</i>
pøesunuta do <i>/etc/pf.conf</i>.
</h4>

<p>
Nový soubor
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=pf.conf&amp;sektion=5"><i>/etc/pf.conf</i></a>
má ètyøi èásti:

<ul>
<li><b>Options:</b> Rùzné volby ovlivòující èinnost PF.
<li><b>Scrub:</b> Pøepracování paketù kvùli normalizaci a defragmentaci.
<li><b><a href="#NAT">Pravidla NATu a pøesmìrování</a></b> NAT umo¾òuje
  více strojùm pøistupovat na Internet pomocí jedné IP adresy.
  Pøesmìrování umo¾òuje, aby pøíchozí pakety byly pøeposlány na
  urèený stoj za NATem.
<li><b>Pravidla filtru:</b> Umo¾òuje selektivní filtrování nebo
  blokování paketù, kdy¾ procházejí nìkterým z rozhraní.

<p>
Subsystém Packet Filter slou¾í k zaji¹tìní dvou úloh, filtrování na
úrovni paketù a mapování poèítaèù a podsítí na okruh externích adres.
Konfiguraèní soubor pro tuto slu¾bu je
<i><a href="http://www.openbsd.org/cgi-bin/man.cgi?query=pf.conf&amp;sektion=5&amp;manpath=OpenBSD+3.2">/etc/pf.conf(5)</a></i>.

<p>
Aby se tyto slu¾by spou¹tìly pøi startu systému, musíte upravit 
<i><a href="http://www.openbsd.org/cgi-bin/man.cgi?query=rc.conf&amp;sektion=8">/etc/rc.conf(8)</a></i>
a nastavit pøíslu¹ný øádek na:

<blockquote><pre>
pf=YES
</pre></blockquote>

<p>
Pokud pou¾íváte NAT, nejspí¹ budete muset nastavit také hodnotu
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=sysctl&amp;sektion=8">sysctl(8)</a>
<tt>net.inet.ip.forwarding</tt> na 1. To mù¾ete udìlat odkomentováním
pøíslu¹ného øádku v 
<i><a href="http://www.openbsd.org/cgi-bin/man.cgi?query=sysctl.conf&amp;sektion=5">/etc/sysctl.conf(5)</a></i>
a restartováním poèítaèe.

<p>
Pokud máte Packet Filter zakompilovaný v jádøe, ale nemáte ho aktivován v
<i><a href="http://www.openbsd.org/cgi-bin/man.cgi?query=rc.conf&amp;sektion=8">/etc/rc.conf(8)</a></i>,
mù¾ete ho stále je¹tì aktivovat pøíkazem
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=pfctl&amp;sektion=8&amp;manpath=OpenBSD+3.2">pfctl(8)</a>.

<blockquote><pre>
# <b>pfctl -f /etc/pf.conf</b>
# <b>pfctl -e</b>
</pre></blockquote>

<p>
První øádek nastavuje filtrování a NAT podle <i>/etc/pf.conf</i>,
a druhý aktivuje PF.

<p>
Mù¾ete to také zapsat jedním pøíkazem:
<blockquote><pre>
# <strong>pfctl -f /etc/pf.conf -e</strong>
</pre></blockquote>

<p>
Pokud udìláte zmìny v <i>/etc/pf.conf</i> poté
co je PF spu¹tìn, mù¾ete znovu nahrát pravidla opìtovným naètením
pøíslu¹ného souboru:

<blockquote><pre>
# <b>pfctl -f /etc/pf.conf</b>
</pre></blockquote>

<p>
Tento dokument dále popisuje jen nìkolik základních konfigurací  
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=pf.conf&amp;sektion=5&amp;manpath=OpenBSD+3.2">pf.conf(5)</a>.
Mù¾ete se také podívat na <a href="#sample_pf.conf">výsledná
pravidla</a>, která obsahují v¹echna vylep¹ení detailnì popsaná ní¾e.
Dal¹í informace o Packet Filteru najdete na
<a href="http://www.benzedrine.cx/pf.html">webové stránce Packet Filteru</a> 
a v 
<a href="http://www.inebriated.demon.nl/pf-howto/">Packet Filter HOWTO</a>. 

<p>
<h3>Packet Filter</h3>

<p>
Abyste zapnuli Packet Filter pøi bootu, musíte upravit
<i>/etc/rc.conf</i> tak, aby obsahoval <tt>pf=YES</tt>.  Packet Filter
(pf) se nastavuje pomocí <i>/etc/pf.conf</i>, který je naèten pøi bootu.  
Detailnìj¹í vysvìtlení si pøeètete v
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=pf.conf&amp;sektion=5&amp;manpath=OpenBSD+3.2">pf.conf(5)</a>. 
V následujících pøíkladech reprezentuje <tt>fxp0</tt> externí rozhraní k
internetu.  Ve va¹em pøípadì bude patrnì jiné, podle ethernetového
adaptéru ve va¹em poèítaèi. Pravidla pøedpokládají trvalé spojení s
Internetem, jaké byste zaøídili patrnì pro webserver.

<p>
Pravidla Packet Filtru jsou zpracovávána postupnì od shora dolù.  Ka¾dý
paket musí pøejít pøes tato pravidla, pøedtím ne¾ dosáhne svého urèení.

<p>
Napøíklad implicitní soubor pravidel umo¾òuje ka¾dému paketu cestovat
dovnitø a ven:

<blockquote><pre>
pass out all 
pass in all
</pre></blockquote>

<p>
co¾ je zkrácený zápis

<blockquote><pre>
pass in from any to any
pass out from any to any
</pre></blockquote>

<p>
To znamená &quot;propus» pøíchozí pakety odkudkoliv, smìøující
kamkoliv&quot; s implikovaným &quot;na ka¾dém rozhraní (co¾ je
pøedpokládáno poka¾dé, pokud není specifikováno konkrétní rozhraní)
ka¾dé address family,
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=inet&amp;sektion=4">inet (v4)</a>
nebo <a href="http://www.openbsd.org/cgi-bin/man.cgi?query=inet6&amp;sektion=4">inet6 (v6)</a>&quot;.

<p>
Pochopitelnì ¾e tohle není ¾ádný filtr. Skuteèné filtrování bude
zalo¾eno na address family (IPv4 nebo IPv6), protokolu a portu
vyu¾ívaných slu¾bou, kterou chcete filtrovat. Mù¾ete specifikovat
kterýkoli protokol z
<i><a href="http://www.openbsd.org/cgi-bin/man.cgi?query=protocols&amp;sektion=5">/etc/protocols(5)</a></i>,
a» u¾ jménem nebo èíslem, ale my se zamìøíme na
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=tcp&amp;sektion=4">tcp(4)</a>,
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=udp&amp;sektion=4">udp(4)</a> a
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=icmp&amp;sektion=4">icmp(4)</a>.

<p>
Nyní pøedpokládejme, ¾e nechceme dovolit jakékoliv pøíchozí IPv4
spojení na port 3306 (MySQL), proto¾e k databázi by mìl být pøístup
pouze z localhostu.  Soubor pravidel by vypadal takto:

<blockquote><pre>
pass out all
pass in all
block in on fxp0 inet proto tcp from any to any port 3306
</pre></blockquote>

<p>
Toto øíká &quot;blokuj v¹echny pøíchozí IPv4 (inet) pakety, pøicházející
odkudkoliv, smìøující kamkoliv, jejich¾ cílem je port 3306.&quot;
V¹imnìte si, ¾e pokud filtrujete podle portu, musíte uvést také protokol
a doporuèuje se urèit i address family. Slu¾by definované v souboru
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=services&amp;sektion=5">/etc/services(5)</a>
mù¾ete také specifikovat jejich jménem, napøíklad <em>www</em> nebo 
<em>mysql</em>.
Paket urèený pro port 3306 na zaøízení <tt>fxp0</tt> projde pøes první
&quot;pass in&quot; pravidlo a potom bude odhozen díky pravidlu 
&quot;block in port 3306&quot;. Pokud zmìníte poøadí va¹ich pravidel 
(vzpomeòte si, poøadí je dùle¾ité):

<blockquote><pre>
pass out all
block in on fxp0 inet proto tcp from any to any port 3306
pass in all
</pre></blockquote>

<p>
Pakety urèené pro port 3306 projdou, proto¾e poslední pravidlo souboru
dovoluje v¹em pøíchozím paketùm projít. Je dùle¾ité pamatovat si pøi
psaní pravidel pro Packet Filter, ¾e:
<b> Poslední odpovídající pravidlo vítìzí</b>.

<p>
Samozøejmì ¾e existují výjimky pro ka¾dé pravidlo. Volba <em>quick</em>
ukonèí zpracování paketu na prvním pravidlu, které odpovídá. Podívejme
se na pøedcházející pøíklad.
Pokud pøidáme <em>quick</em> k pravidlu &quot;block in&quot;:

<blockquote><pre>
pass out all
block in quick on fxp0 inet proto tcp from any to any port 3306
pass in all
</pre></blockquote>

<p>
Paket urèený pro ná¹ poèítaè na port 3306 bude zpracován bezprostøednì
pravidlem &quot;block in quick&quot; a bude odhozen. V¹echny pakety
urèené pro jiné porty nenajdou odpovídající pravidlo, dokud nedosáhnou
pravidla &quot;pass in&quot;, které jim dovolí projít.

<p>
<b>Default Deny</b>
<p>
Nejbezpeènìj¹í politika filtrování paketù je tzv. politika default
deny.  V¹echny pakety, které nejsou pøímo dovoleny, jsou odhozeny. Tato
politika je mnohem bezpeènìj¹í ne¾ pøímo nepovolovat ka¾dou chránìnou
slu¾bu, umo¾òuje mít relativnì malý soubor pravidel a také mù¾e ochránit
od ¹patnì nakonfigurované slu¾by, která je ponechána svému osudu.

<p>
Nyní se podívejte na jiný pøíklad skuteèného ¾ijícího pøíkladu pravidel
a vysvìtleme si øádku po øádce jejich význam. Je to pøíklad webserveru s
default deny politikou, která povoluje pouze ssh spojení (pro
administraci) a spojení http (port 80) a https (port 443).

<blockquote><pre>
block in on fxp0 all
pass  in on fxp0 inet proto tcp from any to any port 22
pass  in on fxp0 inet proto tcp from any to any port 80
pass  in on fxp0 inet proto tcp from any to any port 443
pass out on fxp0 all
</pre></blockquote>

<p>
Tato pravidla dovolí projít pøíchozím spojením odkudkoliv na tcp porty
22(ssh), 80(http) a 443(https). Odhodí v¹echny ostatní pakety a umo¾ní
v¹echna odchozí spojení. To u¾ je celkem dobrá sada pravidel.  Co kdy¾
ale chcete dovolit ssh spojení pouze z interních strojù ve va¹em
adresovém bloku 1.1.1.0, ale dovolit spojení zvenku na http a https?

<blockquote><pre>
block in on fxp0 all
pass  in on fxp0 inet proto tcp from 1.1.1.0/24 to any port 22
pass  in on fxp0 inet proto tcp from any to any port 80
pass  in on fxp0 inet proto tcp from any to any port 443
pass out on fxp0 from all
</pre></blockquote>

<p>
Docela dobré, ale co kdy¾ chceme dovolit pouze jednomu stroji (1.1.1.1)
administrovat webserver vzdálenì?
V tomto pøípadì mù¾eme zmìnit:

<blockquote><pre>
pass  in on fxp0 inet proto tcp from 1.1.1.0/24 to any port 22
</pre></blockquote>

<p>
na:
<blockquote><pre>
pass  in on fxp0 inet proto tcp from 1.1.1.1/32 to any port 22
</pre></blockquote>

<p>
<b>Pøíklad souboru pravidel</b>
<p>
Zde je nìkolik pravidel pro ka¾dého (pøedpokládejme, ¾e fxp0 je externí
zaøízení pøipojené na internet). Nejprve nastolíme jednoduchou address
spoofing ochranu.  Tyto adresy by (normálnì) nemìly poletovat
Internetem, a pokud ano, je to málokdy dobøe, tak¾e je zablokujeme:

<blockquote><pre>
block in quick on fxp0 inet from { 127.0.0.0/8, 192.168.0.0/16, \
172.16.0.0/12, 10.0.0.0/8 } to any
block out quick on fxp0 inet from any to { 127.0.0.0/8, 192.168.0.0/16, \
172.16.0.0/12, 10.0.0.0/8 }
</pre></blockquote>

<p>
Ná¹ soubor pravidel zatím vypadá dobøe; kdy¾ to dáme v¹echno dohromady,
vypadá to takto:

<blockquote><pre>
# don't allow anyone to spoof non-routeable addresses
block in quick on fxp0 inet from { 127.0.0.0/8, 192.168.0.0/16, \
172.16.0.0/12, 10.0.0.0/8 } to any
block out quick on fxp0 inet from any to { 127.0.0.0/8, 192.168.0.0/16, \
172.16.0.0/12, 10.0.0.0/8 }

# only allow our administration machine to connect via ssh
pass in quick on fxp0 inet proto tcp from 1.1.1.1/32 to any port 22

# allow others to use http and https
pass in quick on fxp0 inet proto tcp from any to any port 80
pass in quick on fxp0 inet proto tcp from any to any port 443

# finally lock the rest down with a default deny
block in quick on fxp0 from any to any

# and let out-going traffic out
pass out on fxp0 from any to any
</pre></blockquote>

<p>
<b>Logování paketù</b>
<p>
Nyní je na¹e situace dost dobrá, ale mohla by být je¹tì lep¹í. Co kdy¾
chceme logovat ka¾dý pokus o spojení na port 22(ssh), který byl
firewallem zablokován?  Jednodu¹e, Packet Filter to umo¾òuje pomocí
slova <em>log</em>:

<blockquote><pre>
pass in quick on fxp0 inet proto tcp from 1.1.1.1/32 to any port 22
block in log quick on fxp0 inet proto tcp from any to any port 22
</pre></blockquote>

<p>
Toto pravidlo dovolí na¹emu vzdálenému administraènímu poèítaèi spojení
na port 22, ale blokuje a loguje v¹echny ostatní pokusy o spojení na
port 22.

<p>
Logované pakety jsou posílány na rozhraní pflog0, které monitoruje
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=pflogd&amp;sektion=8&amp;manpath=OpenBSD+3.2">pflogd(8)</a>,
jen¾ vìt¹inou dumpuje pakety do <i>/var/log/pflog</i> v binárním formátu pro 
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=tcpdump&amp;sektion=8&amp;manpath=OpenBSD+3.2">tcpdump(8)</a>.
pflogd(8) je standardnì pou¹tìn z 
<i><a href="http://www.openbsd.org/cgi-bin/man.cgi?query=rc&amp;sektion=8">/etc/rc(8)</a></i>,
pokud je pf zapnutý v
<i><a href="http://www.openbsd.org/cgi-bin/man.cgi?query=rc.conf&amp;sektion=8">/etc/rc.conf(8)</a></i>.
Tento soubor logù si mù¾ete pøeèíst následujícím pøíkazem:

<blockquote><pre>
# <b>tcpdump -n -e -ttt -r /var/log/pflog</b>
</pre></blockquote>

<p>
Mìli byste si být vìdomi, ¾e pou¾ití tcpdumpu k monitorování souboru pflog
NEZOBRAZUJE výsledky v reálném èase. Pokud chcete vidìt logy v reálném èase,
mù¾ete pou¾ít tento pøíkaz:

<blockquote><pre>
# <b>tcpdump -i pflog0</b>
</pre></blockquote>

<p>
Také je mo¾né usnadnit si ladìní tím, ¾e zmen¹íme zábìr tcpdumpu:

<blockquote><pre>
# <b>tcpdump -e -i pflog0 port 80</b>
</pre></blockquote>

<p>
Tímto NEBUDOU ovlivnìna data, která jsou ulo¾ena v souboru
<i>/var/log/pflog</i>.  

<p>
Pøi zkoumání logù byste mìli být obzvlá¹tì opatrní pøi &quot;verbose
protocol decoding&quot; (aktivovaném volbou -v na pøíkazové øádce).
Tcpdumpové dekodery protokolù nemají úplnì nejlep¹í historie
bezpeènosti.  Alespoò teoreticky jsou mo¾né zpo¾dìné útoky
prostøednictvím urèitého obsahu paketù nahraných logovacím zaøízením.

<p>
Speciální pozornost by mìla být vìnována pøístupu k logùm. Pflogd
odchytí 96 bytù paketu a zapí¹e je do logu. Pøístup k logùm mù¾e
poskytnout èásteèný pøístup k citlivému obsahu paketù (napø.
pøihla¹ování pomocí
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=telnet&amp;sektion=1">telnetu(1)</a> nebo 
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=ftp&amp;sektion=1">ftp(1)</a> ).
</p>

<p>
<b>Logování paketù pomocí syslogu</b>
<p>
V mnoha situacích je ¾ádoucí mít logy z firewallu dostupné v ASCII
formátu a/nebo je posílat na vzdálený logovací server.
Toho mù¾e být dosa¾eno 2 malými shellovými skripty a mírnou zmìnou
konfiguraèních souborù OpenBSD.

<p>
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=syslogd&amp;sektion=8&amp;manpath=OpenBSD+3.2">Syslogd(8)</a>
je standardní logovací démon, loguje v ASCII a je také schopen logovat
na vzdálený logovací server.

<p>
Nejprve musíme vytvoøit u¾ivatele <em>pflogger</em> s .nologin. shellem.
Nejjednodu¹¹í zpùsob jak vytvoøit tohoto u¾ivatele je pomocí
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=adduser&amp;sektion=8&amp;manpath=OpenBSD+3.2">adduser(8)</a>.

<p>
Po vytvoøení u¾ivatele <em>pflogger</em> vytvoøte následující dva
skripty:

<p>
<i>/etc/pflogrotate</i>

<blockquote><pre>
FILE=/home/pflogger/pflog5min.$(date "+%Y%m%d%H%M")
kill -ALRM $(cat /var/run/pflogd.pid)
if [ $(ls -l /var/log/pflog | cut -d " " -f 8) -gt 24 ]; then
        mv /var/log/pflog $FILE
        chown pflogger $FILE
        kill -HUP $(cat /var/run/pflogd.pid)
fi
</pre></blockquote>

<p>
<i>/home/pflogger/pfl2sysl</i>

<blockquote><pre>
#!/bin/sh
# feed rotated pflog file(s) to syslog
for logfile in /home/pflogger/pflog5min* ; do
        tcpdump -n -e -ttt -r $logfile | logger -t pf -p local0.info
        rm $logfile
done
</pre></blockquote>

<p>
Upravte crontab u¾ivatele <em>root</em>

<blockquote><pre>
# <b>crontab -u root -e</b>
</pre></blockquote>

<p>
a pøidejte následující dva øádky:

<blockquote><pre>
# rotate pf log file every 5 minutes
0-59/5 *       *       *       *       /bin/sh /etc/pflogrotate
</pre></blockquote>

<p>
Vytvoøte crontab pro u¾ivatele <em>pflogger</em>

<blockquote><pre>
# <b>crontab -u pflogger -e</b>
</pre></blockquote>

<p>
a pøidejte následující dva øádky:

<blockquote><pre>
# feed rotated pflog file(s) to syslog
0-59/5 *       *       *       *       /bin/sh /home/pflogger/pfl2sysl
</pre></blockquote>

<p>
Pøidejte následující øádek do <i>/etc/syslog.conf</i>:

<blockquote><pre>
local0.info    /var/log/pflog.txt
</pre></blockquote>

<p>
Pokud chcete logovat na vzdálený log server, pøidejte také øádek:

<blockquote><pre>
local0.info    @@syslogger
</pre></blockquote>

<p>
a ujistìte se, ¾e stroj <i>syslogger</i> je definován v souboru
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=hosts&amp;sektion=5&amp;manpath=OpenBSD+3.2">
/etc/hosts(5)</a>.

<p>
V¹echny zalogované pakety jsou zaznamenány do <i>/var/log/pflog.txt</i>.
Pokud je pøidána i druhá øádka, jsou také poslány na vzdálený logovací
server <i>syslogger</i>.

<p>
<i>/etc/pflogrotate</i> nyní zpracovává a ma¾e <i>/var/log/pflog</i>,
tak¾e rotování <i>pflog</i> pomocí
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=newsyslog&amp;sektion=8&amp;manpath=OpenBSD+3.2">
newsyslogd(8)</a> u¾ není zapotøebí a mìlo by být vypnuto. Nicménì
<i>/var/log/pflog.txt</i> nahrazuje <i>/var/log/pflog</i> a jeho
rotování by mìlo být aktivováno.
Zmìòte <i>/etc/newsyslog.conf</i> takto:

<blockquote><pre>
#/var/log/pflog        600     3       250     *       ZB /var/run/pflogd.pid
/var/log/pflog.txt     600     7       *       24
</pre></blockquote>

<p>
Pf bude nyní logovat v ASCII do /var/log/pflog.txt. Pokud je tak
nastaven v <em>/etc/syslog.conf</em>, bude také posílat logy na vzdálený
server. Logování není okam¾ité, ale mù¾e trvat a¾ 5-6 minut (interval
úlohy v cronu) ne¾ se logované pakety objeví v souboru.

<p>
<b>Vícenásobné protokoly</b>

<p>
Co kdy¾ potøebujeme povolit spojení na slu¾by bì¾ící pøes více
protokolù, jako je bind, který vyu¾ívá TCP a UDP?  Packet Filter vám
umo¾òuje volby spojit dohromady do mno¾in (o tom více podìji):

<blockquote><pre>
# Pass DNS traffic for BIND
pass in quick on fxp0 inet proto { tcp, udp } from any to any port 53
</pre></blockquote>

<p>
V¹imnìte si mezer z obou stran kolem znakù '{ }'. To je èist¹í
ne¾ alternativní zápis, který byste jinak pou¾ili:

<blockquote><pre>
pass in quick on fxp0 inet proto tcp from any to any port 53
pass in quick on fxp0 inet proto udp from any to any port 53
</pre></blockquote>

<p>
<a name="normalization"></a>
<b>Normalizování paketù</b>
<p>
Normalizování paketù znamená opìtné spojování fragmentovaných paketù a
ru¹ení IP options.  Nìkteré operaèní systémy a aplikace mívají problémy
s abnormálními nebo fragmentovanými pakety a je obecnì dobré mít pakety
normalizované pøi porovnávání s pravidly filtru a doruèení cílovému
stroji.  Proto je témìø v¾dy pøínosné normalizovat pakety pøedtím, ne¾
jsou propu¹tìny na své koneèné místo urèení.  To je mo¾né provést volbou
<b>scrub</b>, pou¾itou takto:

<blockquote><pre>
scrub in all
</pre></blockquote>

<p>
To zpùsobuje velmi malé dal¹í zatí¾ení systému a vy¾aduje trochu pamìti
na cachování fragmentù paketu. Pøínos normalizace paketù témìø v¾dy
pøevý¹í tyto ztráty.

<p>
<b>IP options</b>
<p>
Standardnì PF blokuje pakety s nastavenými IP options. To mù¾e ztí¾it
¾ivot utilitám pro &quot;OS fingerprinting&quot;, jako je nmap. Pokud
máte aplikaci, která vy¾aduje propou¹tìní takových paketù, jako
multicast nebo IGMP, mù¾ete vyu¾ít volbu <b>allow-opts</b>:

<blockquote><pre>
pass in quick on fxp0 all allow-opts
</pre></blockquote>

<p>
<b>TCP pøíznaky, vytvoøená spojení a udr¾ování stavu</b>
<p>
Packet Filter mù¾e také filtrovat pakety na základì TCP pøíznakù a
udr¾ovat vytvoøená spojení a stavy spojení. Doporuèujeme, aby v¹ichni
u¾ivatelé, kteøí chtìjí filtrovat pakety podle TCP pøíznakù, rozumìli,
jaký význam ka¾dý pøíznak má. Napøíklad pokud chcete blokovat v¹echny
pakety s nastavenými pøíznaky FIN, URG a PSH (jako ku pøíkladu pokusy o
OS fingerprinting nmapem) pou¾ijete takovéhle pravidlo:

<blockquote><pre>
block in quick on fxp0 inet proto tcp from any to any flags FUP/FUP
</pre></blockquote>

<p>
(Thanks to <a href=mailto:halogen@@nol.net>Kyle Hargraves</a> za tento tip)

<p>
Dal¹í skvìlá vlastnost Packet Filteru je jeho schopnost udr¾ovat stav.
Udr¾ování stavu je vysvìtlováno jako &quot;nemluvit dokud nejsem
osloven&quot;.  Jinak øeèeno, jakmile je spojení vytvoøeno, pakety u¾
nemusí projít souborem pravidel. To je velice mocná vlastnost, která
umo¾òuje psaní mnohem jednodu¹¹ích a bezpeènìj¹ích pravidel.

<p>
Napøíklad se podívejme, jak mù¾eme uplatnit tuto vlastnost pøi psaní
na¹í ukázkové sestavy pravidel. Pro pøipomenutí, dovolujeme
administraèní pøístup z na¹í adresy tøídy C na port 22(ssh) a dovolujeme
v¹echna pøíchozí spojení na port 80 (http) a 443 (https). Blokujeme
v¹echna ostatní spojení. Co ale dìlat v pøípadì, ¾e se chceme spojit
pomocí
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=ssh&amp;sektion=1">ssh(1)</a>
z web serveru, nebo chceme pou¾ít 
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=lynx&amp;sektion=1">lynx(1)</a> 
abychom se podívali na nìco ve FAQ? To udìlat nemù¾eme, proto¾e jsme
zablokovali v¹echna pøíchozí spojení, které smìøují na jiné ne¾ námi
povolené porty. Aèkoliv nastavení ip filtru je tak bezpeèné jak to jen
jde, mù¾e být ponìkud nevyhovující. Pøidáním slova <em>keep state</em>
do pravidla &quot;pass out&quot; mù¾eme automaticky povolit pakety,
které pøicházejí jako odezva na na¹e pokusy o spojení, jako je napø.
surfování na webu.  Pamatujte si, ¾e potøebujeme specifikovat protokol,
pro který udr¾ujeme stav.

<blockquote><pre>
block in  on fxp0 inet proto tcp all
pass  in  on fxp0 inet proto tcp from 1.1.1.0/24 to any port 22 keep state
pass  in  on fxp0 inet proto tcp from any to any port 80 keep state
pass  in  on fxp0 inet proto tcp from any to any port 443 keep state
pass  out on fxp0 inet proto tcp all keep state
</pre></blockquote>

<p>
Tato malá zmìna dramaticky zvy¹uje flexibilitu a bezpeènost na¹í sady
pravidel.  Napøíklad, v pøecházejícím pøíkladì umo¾òujeme tcp spojení na
port 80 a 443.  Mù¾eme to ale je¹tì zlep¹it. K tomu, aby se vytvoøilo
tcp spojení, potøebujeme aby probìhl jen poèáteèní handshake. Jakmile k
nìmu dojde, mù¾eme blokovat spojení na tento port a pomocí na¹eho
&quot;keep state&quot; pravidlo bude udr¾ovat vytvoøené spojení. Abychom
dovolili poèáteèní handshake, potøebujeme dovolit pakety pouze s
nastaveným flagem SYN a nenastaveným ACK. Propu¹tìním paketù pouze s
pøíznaky SYN se ubráníme mnoha formám port skenù jako je napøíklad FIN
skenování. flags S/SA znamená: z flagù S (SYN) a A (ACK) mù¾e být
nastaven jenom SYN. Ostatní flagy nejsou zkoumány.
Pravidla nyní vypadají takto:

<blockquote><pre>
block in  on fxp0 inet proto tcp all
pass  in  on fxp0 inet proto tcp from 1.1.1.0/24 to any port 22 \
	flags S/SA keep state
pass  in  on fxp0 inet proto tcp from any to any port 80 \
	flags S/SA keep state
pass  in  on fxp0 inet proto tcp from any to any port 443 \
	flags S/SA keep state
block out on fxp0 inet proto tcp all
pass  out on fxp0 inet proto tcp all flags S/SA keep state
</pre></blockquote>

<p>
Nyní dejme dohromady v¹echny pravidla, která jsme mìli dosud v na¹í
sadì.  Tato sada bude podporovat IPv4, mít default deny politiku,
povolující pouze administrativní spojení z interní sítì (pøes ssh) a
umo¾òující pøíchozí spojení na porty 80 (http) a 443 (https). Ochrání
nás rovnì¾ pøed spoofovanými neroutovatelnými ip adresami a zaká¾e
v¹echny pakety, které jsou pøíli¹ fragmentované nato, aby se daly
vy¹etøit. Docela dobré nastavení pro veøejný webserver. Zde je ukázka
souboru <i>/etc/pf.conf</i>:

<blockquote><pre>
# Clean up fragmented and abnormal packets
scrub in all

# don't allow anyone to spoof non-routeable addresses
block in quick on fxp0 inet from { 127.0.0.0/8, 192.168.0.0/16, \
172.16.0.0/12, 10.0.0.0/8 } to any
block out quick on fxp0 inet from any to { 127.0.0.0/8, 192.168.0.0/16, \
172.16.0.0/12, 10.0.0.0/8 }

# by default, block all incoming packets, except those explicitly
# allowed by further rules
block in on fxp0 all

# allow others to use http and https
pass in on fxp0 inet proto tcp from any to any port 80 \
	flags S/SA keep state
pass in on fxp0 inet proto tcp from any to any port 443 \
	flags S/SA keep state

# and let out-going traffic out and maintain state on established connections
# pass out all protocols, including TCP, UDP and ICMP, and create state,
# so that external DNS servers can reply to our own DNS requests (UDP).
block out on fxp0                 all
pass  out on fxp0 inet proto tcp  all flags S/SA keep state
pass  out on fxp0 inet proto udp  all            keep state
pass  out on fxp0 inet proto icmp all            keep state

</pre></blockquote>

<p>
I kdy¾ toto mù¾e vypadat dobøe, existuje je¹tì pár dal¹ích vìcí, kterými
vám Packet Filter pomáhá, aby soubor <i>pf.conf</i> byl èist¹í a dal se
lépe udr¾ovat.

<p>
<b>Mno¾iny</b>
<p>
Mno¾iny jsou u¾iteèné "zkratky" pro psaní jednoduchých
a jasných pravidel v PF. Co kdy¾, napøíklad, potøebujeme
povolit spojení na slu¾by bì¾ících pøes více protokolù,
jako tøeba BIND, který pou¾ívá TCP a UDP?

<blockquote><pre>
pass in quick on fxp0 inet proto { tcp, udp } from any to any port 53
</pre></blockquote>

<p>
V¹imnìte si mezer z obou stran znakù '{ }'.

<p>
Skupiny souvisejících IP mohou být spojeny dohromady do mno¾in,
které mohou být kdekoliv pou¾ity místo jednoho IP.
Vezmeme-li ku pøíkladu na¹e anti-spoofing pravidla uvedená vý¹e:

<blockquote><pre>
# don't allow anyone to spoof non-routeable addresses
block in quick on fxp0 inet from { 127.0.0.0/8, 192.168.0.0/16, \
172.16.0.0/12, 10.0.0.0/8 } to any
block out quick on fxp0 inet from any to { 127.0.0.0/8, 192.168.0.0/16, \
172.16.0.0/12, 10.0.0.0/8 }
</pre></blockquote>

<p>
<b>Expanze promìnných</b>
<p>
Jeden problém se vý¹e uvedeným vzorovým souborem <i>pf.conf</i> je,
¾e pokud potøebujete vymìnit vá¹ NIC nebo zmìnit IP adresu,
musíte zmìnit velký poèet øádek. Ten mù¾eme sní¾it pou¾itím
expanze promìných:

<blockquote><pre>
NoRouteIPs="{ 127.0.0.0/8, 192.168.0.0/16, 172.16.0.0/12, 10.0.0.0/8 }"
ExtIF="fxp0"
block in quick on $ExtIF from $NoRouteIPs to any
block out quick on $ExtIF from any to $NoRouteIPs
</pre></blockquote>

<p>
<a name="sample_pf.conf"></a>
<b>Dáváme to v¹e dohromady</b>
<p>
A teï to v¹echno dejme dohromady a podívejme se na eleganci výsledného
souboru:

<blockquote><pre>
# Define useful variables
ExtIF="fxp0"              # External Interface
IntNet="1.1.1.0/24"       # Our internal network
NoRouteIPs="{ 127.0.0.0/8, 192.168.0.0/16, 172.16.0.0/12, 10.0.0.0/8 }"
Services="{ www, https }"

# Clean up fragmented and abnormal packets
scrub in all

# don't allow anyone to spoof non-routeable addresses
block in  quick on $ExtIF from $NoRouteIPs to any
block out quick on $ExtIF from any to $NoRouteIPs

# by default, block all incoming packets, except those explicitly
# allowed by further rules
block in on $ExtIF all

# allow others to use http and https
pass  in on $ExtIF inet proto tcp from any to any port $Services \
	flags S/SA keep state

# and let out-going traffic out and maintain state on established connections
# pass out all protocols, including TCP, UDP and ICMP, and create state,
# so that external DNS servers can reply to our own DNS requests (UDP).
block out on $ExtIF                 all
pass  out on $ExtIF inet proto tcp  all flags S/SA keep state
pass  out on $ExtIF inet proto udp  all            keep state
pass  out on $ExtIF inet proto icmp all            keep state
</pre></blockquote>

<p>
Pokud se vyskytnou nìjaké problémy, mo¾ná budete chtít zprovoznit
logování u jednotlivých pravidel, abyste vìdìli, co se dìje, napø:

<blockquote><pre>
pass in log quick on fxp0 proto tcp from 1.1.1.0/24 to any port 22
</pre></blockquote>

<p>
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=pflogd&amp;sektion=8&amp;manpath=OpenBSD+3.2">pflogd(8)</a>
zapí¹e záznam ip logu do <i>/var/log/pflog</i>.
Vzpomeòte si, ¾e <i>/var/log/pflog</i> je binární soubor urèený ke ètení pomocí
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=tcpdump&amp;sektion=8&amp;manpath=OpenBSD+3.2">tcpdump(8)</a>,
NE pøímo èlovìkem.

<p>
Pokud zmìníte konfiguraèní soubor, nezapomeòte pou¾ít
<b>pfctl -R /etc/pf.conf</b>, aby se zmìny uplatnily! 

<p>
<a name="6.3"></a>
<a name="NAT"></a>
<h2>6.3 - NAT</h2>

<p>
<h4>Poznámka: V OpenBSD 3.2 jsou funkce NATu zahrnuty v souboru 
<i>/etc/pf.conf</i>, nikoliv v samostatném souboru <i>/etc/nat.conf</i>
pou¾ívaném v OpenBSD 3.0 a 3.1</h4>

<a name="nat1.0"></a>
<h3><u>6.3.1 NAT Introduction</u></h3>

<a name="nat1.1"></a>

<p>
Na základì
<a href="http://www.geektools.com/rfc/rfc1631.txt">RFC 1631</a>,
NAT poskytuje jednoduchý zpùsob jak namapovat interní sí» na jedinou
routovatelnou ("reálnou") internetovou adresu. Toto je velmi u¾iteèné,
pokud je¹tì napøíklad nemáte oficiálnì pøiøazené adresy pro ka¾dý stroj
na va¹í interní síti. Pøi nastavování soukromé/interní sítì, mù¾ete
s výhodou pou¾ít rezervovaných adresových blokù (pøiøazených v
<a href="http://www.geektools.com/rfc/rfc1918.txt">RFC 1918</a>),
jako jsou:

<p>
10.0.0.0/8 (10.0.0.0 - 10.255.255.255)<br>
172.16.0.0/12 (172.16.0.0 - 172.31.255.255)<br>
192.168.0.0/16 (192.168.0.0 - 192.168.255.255)

<p>
Pøedpokládá se, ¾e u¾ivatel u¾ nastavil a nakonfiguroval OpenBSD se
dvìma sí»ovými kartami (jedna pøipojena k Internetu a druhá k lokální
síti).

<p>
<a name="nat1.3"></a>
<b>Nastavení</b>

<p>
Jako pøíklad pou¾ijeme ní¾e popsaný systém. Va¹e uspoøádání
se témìø urèitì bude li¹it, tak¾e buïte velmi opatrní,
pokud odsud cokoliv doslova pøepí¹ete a oèekáváte, ¾e
to bude fungovat tak, jak jste chtìli.

<blockquote>
<b>Sí»ové karty:</b>
<pre>
Intel EtherExpress Pro/100 <b>fxp0</b>
Connected to the EXTERNAL LAN (or WAN)
<b>IP Address: </b>24.5.0.5
<b>Netmask: </b>255.255.255.0

Compaq Netelligent 10/100Mb <b>tl0</b>
Connected to the INTERNAL LAN
<b>IP Address: </b>192.168.1.1
<b>Netmask: </b>255.255.255.0
</pre>
</blockquote>

<blockquote>
<b>Externí, internetová routa (dodal ji ISP, v tomto pøípadì se jedná o
linku modemovou)<br></b>
<pre>
<b>IP Address: </b>24.5.0.5
<b>Netmask: </b>255.255.255.0
<b>Gateway: </b>24.5.0.1
</pre>
</blockquote>

<blockquote>
<b>Lokální sí»</b>
<ul>
V na¹em vzorovém prostøedí pou¾ívají poèítaèe na LAN adresové schéma
192.168.1.xxx (kde xxx je jedineèné èíslo). Na LAN je mnoho rùzných OS,
vèetnì Windows 98, Windows NT, OpenBSD a Linux, ale OS klienta nehraje
pøi NAT roli.  V tomto dokumentu a v jeho pøíkladech bude klient na LAN
pou¾ívat IP adresu 192.168.1.40.
</blockquote>

<blockquote>
<b>Diagram nastavení</b>
<pre>
+-----+              +---------+          +----------+
| Hub |--------- tl0 |   NAT   | fxp0 ----| Internet |
+-----+              +---------+          +----------+
| |
| +-- Klient A
+---- Dal¹í klienti 

		      +--------------------------+
		      |          LEGEND          |
		      +--------------------------+
		      |  NIC fxp0 - 24.5.0.5     |
		      |  NIC tl0  - 192.168.1.1  |
		      | Klient A  - 192.168.1.35 |
		      +--------------------------+

</pre>
</blockquote>

<p>
<a name="nat2.0"></a>
<h3><u>6.3.2 Network Address Translation</u></h3>
<br>

<p>
<a name="nat2.1"></a>
<b>Seznámení s NATem</b>

<p>
Ka¾dý uzel Internetu potøebuje unikátní IP adresu. Pøinejmen¹ím
u IPv4 je mno¾ství dostupných IP adres velmi omezené a proto
nejsou zdarma. Hodnì "levných" ISP poskytuje nìco mezi 1 a 30
adresami, a i kdy¾ si organizace s vìt¹ím rozpoètem mohou
dovolit vìt¹í blok, ve vìt¹inì pøípadù z toho, ¾e ka¾dý poèítaè je
na Internetu individuálnì adresovatelný,  plyne málo
výhod a znaèná rizika.

<p>
Network Address Translation (pøeklad adres), nebo NAT, (také známý jako 
&quot;IP Masquerading&quot;,
pokud pocházíte z linuxového prostøedí) umo¾òuje, aby více poèítaèù
bylo umístìno &quot;za&quot; jednou IP adresou (nebo malým mno¾stvím adres).
Ka¾dý &quot;interní&quot; poèítaè má lokálnì pøidìlenou, neregistrovanou
IP adresu (podle <a href="http://www.geektools.com/rfc/rfc1918.txt">RFC
1918</a>), a v¹echny souèasnì vyu¾ívají stejnou externí IP adresu.

<p>
Zpùsob, jakým NAT pracuje je pøekvapivì jednoduchý. Kdy¾ se klient na
LAN chce spojit se strojem v Internetu, po¹le ven TCP paket se ¾ádostí o
spojení. Uvnitø TCP hlavièky paketu je klientova IP adresa (napø.
192.168.1.40) a po¾adovaná IP adresa cílového poèítaèe (napø.
123.45.67.89). Stroj, na kterém bì¾í NAT obdr¾í tento TCP paket a zmìní
klientovu IP adresu v hlavièce z 192.168.1.40 na IP adresu pøipojenou na
Internet (napø.  24.5.0.5). Tímto zpùsobem efektivnì docílíme toho, ¾e
cílový poèítaè se domnívá, ¾e vlastní spojení pøichází ze stroje, na
kterém bì¾í NAT. Cílový poèítaè (host) posílá dále pakety týkající se
daného spojení na adresu stroje s NATem. Kdy¾ stroj s NATem obdr¾í paket
od host-a, pøelo¾í rychle cílovou IP adresu na adresu klienta a po¹le
paket klientovi. Klient nemá ani tu¹ení o tom, co se stalo a Internetové
spojení je pro nìj zcela transparentní.

<p>
Následující pøíklad ozøejmí dosud nepochopené:

<blockquote><pre>
Klient ----------------- tl0 [ NAT ] fxp0 ---------- Internet Host
192.168.1.35 --- 192.168.1.1 [ NAT ] 24.5.0.5 --- 123.45.67.89

Odcházející TCP Packet                  Odcházející TCP Packet
From: 192.168.1.35  &gt;&gt;=== NAT ===&gt;&gt;     From: 24.5.0.5
To: 123.45.67.89                        To: 123.45.67.89

Pøíchozí TCP Packet                     Pøíchozí TCP Packet
From: 123.45.67.89 			From: 123.45.67.89
To:   192.168.1.40  &lt;&lt;=== NAT ===&lt;&lt;     To: 24.5.0.5
</pre></blockquote>

<p>
<a name="nat2.2"></a>
<b>Proè pou¾ívat NAT?</b>

<p>
Kdy¾ jsem se nastìhoval do nového bytu, byl jsem postaven pøed men¹í
problém.  Jak dát pøipojení k Internetu mým spolubydlícím, kdy¾ modemový
kabel je pouze v mé místnosti? Bylo tu nìkolik mo¾ností, které jsem mohl
implementovat, poèínají tím, ¾e ka¾dý z nás obdr¾í vlastní IP adresu,
pøes nastavení proxy serveru a¾ po nastavení NATu. (Nenechejte se mýlit
pøíkladem s modemovým kabelem. NAT je dostateènì silný aby zamaskoval
velikou LAN se stovkami ba i tisíci poèítaèù!)

<p>
Je tu mnoho dùvodù, proè jsem chtìl nastavit NAT. Dùvodem èíslo jedna
bylo u¹etøit peníze. V mém domì jsou dva spolubydlící (ka¾dý s vlastním
PC) a já sám se tøemi poèítaèi, tak¾e potøebujeme pøipojit pìt poèítaèù.
Mùj ISP ale povoluje pouze tøi IP adresy v ka¾dé domácnosti.  To
znamená, ¾e zde není dostatek IP adres , aby ka¾dému poèítaèi mohl být
umo¾nìn internetový pøístup.

<p>
Pøi pou¾ití NATu bude mít ka¾dý stroj unikátní (interní) IP adresu, ale
budou sdílet jednu IP adresu pro pøístup na Internet. Náklady jdou dolù.

<p>
<a name="nat2.4"></a>
<b>Setup</b>

<p>
Nejprve budete muset na va¹em OpenBSD systému zapnout PF. Toho
jednodu¹e docílíte editací souborù uvedených dále (zmìny udìlejte tak,
aby odpovídající øádky vypadaly jako ty následující):

<p>
<b>/etc/rc.conf</b> (z tohoto souboru se startují programy pøi bootování)

<blockquote><pre>
pf=YES<br>
</pre></blockquote>

<p>
<b>/etc/sysctl.conf</b>

<blockquote><pre>
net.inet.ip.forwarding=1
</pre></blockquote>

<p>
Po tìchto zmìnách je stroj pøipraven pro konfiguraci NATu.

<p>
<a name="nat2.5"></a>
<b>Konfigurace</b>

<p>
Prvním krokem je nastavit soubor s pravidly pro PF
(<i><a href="http://www.openbsd.org/cgi-bin/man.cgi?query=pf.conf&amp;sektion=5&amp;manpath=OpenBSD+3.2">/etc/pf.conf</a></i>).
Pro úèely tohoto dokumentu dovolíme spojení pøes tento firewall bez
omezení.  Soubor by mìl vypadat asi takto:

<blockquote><pre>
pass in all
pass out all
</pre></blockquote>

<p>
Pro dal¹í informace si pøeètìte <a href="#PF">FAQ 6, Packet Filter</a>

<p>
Èást s nastavení NATu v souboru
(<i><a href="http://www.openbsd.org/cgi-bin/man.cgi?query=pf.conf&amp;sektion=5&amp;manpath=OpenBSD+3.2">/etc/pf.conf</a></i>).
má velmi jednoduchý syntax.
Pro pøípad nastaveného firewallu (viz. vý¹e) bude vypadat takto:

<blockquote><pre>
nat on fxp0 from 192.168.1.0/24 to any -&gt; 24.5.0.5
</pre></blockquote>

<p>
Zde je vysvìtlení pøedcházejícího øádku.

<dl>
<dt>"nat"
<dd> Tímto øíkáte, ¾e pøíkaz, který zadáváte, je pravidlo NATu.
</dl>

<dl>
<dt>"fxp0"
<dd>Název sí»ového rozhraní pøipojeného na Internet.
</dl>

<dl>
<dt>"192.168.1.0/24"
<dd>IP adresa a sí»ová maska (maska je v CIDR formátu). Dohromady to
 znamená "jakákoliv IP adresa o hodnotì od 192.168.1.1 do 192.168.1.254"
 má být mapována. 
</dl>

<dl>
<dt>"24.5.0.5"
<dd>
Externí IP adresa, na kterou budou mapovány interní IP adresy.
</dl>

<p>
<a name="nat2.6"></a>
<b>Running</b>

<p>
Jakmile je jednou konfigurace kompletní, jsou zde dva zpùsoby jak
spustit NAT. První (a nejlep¹í, pokud je to mo¾né) je rebootovat
OpenBSD stroj. To se provede pøíkazem "<i>reboot</i>".

<p>
Spu¹tìní NATu z pøíkazové øádky docílíte pøíkazy:

<blockquote><pre>
# <b>pfctl -f /etc/pf.conf</b>
# <b>pfctl -e</b>
</pre></blockquote>

<p>
První øádek nahraje soubor pravidel NATu do PF (a zahodí stará pravidla),
druhý zapíná PF. Reboot je opìt nejlep¹í cestou, jak se ujistit,
¾e se po rebootu spustí v¹e tak, jak jste pøedpokládali.

<p>
<b>Poznámka:</b> budete-li potøebovat updatovat nastavení NATu (v
pøípadì, ¾e editujete soubor, ale nechcete rebootovat) staèí pøedchozí
pøíkaz spustit znovu. Nastavení bude obnoveno s provedenými zmìnami.

<p>
<a name="nat3.0"></a>
<h3><u>6.3.3 Nat Knowledge Base</u></h3>

<p>
<a name="nat3.1"></a>
<b>Testování NATu</b>

<p>
Chcete-li zjistit, jak NAT právì pracuje, nebo se ujistit o tom, zda
nastavení jsou funkèní, pou¾ijte volbu "-ss". Tato volba vypí¹e seznam
v¹ech souèasných spojení, které NAT zpracovává:

<blockquote><pre>
# pfctl -ss
TCP  192.168.1.35:2132 -&gt; 24.5.0.5:53136 -&gt; 65.42.33.245:22       TIME_WAIT:TIME_WAIT
TCP  192.168.1.35:2492 -&gt; 24.5.0.5:55011 -&gt; 65.42.33.245:22       ESTABLISHED:ESTABLISHED
UDP  192.168.1.35:2491 -&gt; 24.5.0.5:60527 -&gt; 24.2.68.33:53       2:1
</pre></blockquote>

<p>
Vysvìtlení (prvního øádku, ostatní jsou podobné):

<dl>
<dt>"192.168.1.35:2132"
<dd> To vám øíká IP adresu poèítaèe ve vnitøní síti, který pou¾ívá NAT
(192.168.1.35).  Za ní následuje port, pou¾itý k vytvoøení spojení
(2132).
</dl>

<dl>
<dt>"24.5.0.5:53136"
<dd>To znaèí, ¾e spojení jde do internetu pøes IP adresu 24.5.0.5
a port 53136.
</dl>

<dl>
<dt>"65.42.33.245:22"
<dd>IP adresa a port, na který spojení vede.
</dl>

<dl>
<dt>"TIME_WAIT:TIME_WAIT"
<dd>To ukazuje stav TCP, ve kterém si PF myslí, ¾e spojení je.
</dl>

<p>
<a name="nat3.2"></a>
<b> Omezení NATu pøi FTP</b>

<p>
Existuje nìkolik omezení, která NAT pøiná¹í, z nich¾ nejèastìj¹í
je pøi FTP. FTP mù¾ete pou¾ívat dvìma zpùsoby: pasivním a aktivním.
Pasivní FTP je obecnì pova¾ováno za bezpeènìj¹í.

<p>
Kdy¾ se pøi aktivním FTP u¾ivatel pøipojí na vzdálený FTP server a
¾ádá informace nebo soubor, FTP klient po¹le serveru náhodné èíslo
portu, na který se FTP server pøipojí a pøenese data. To zpùsobuje
problém pro u¾ivatele, kteøí se sna¾í získat pøístup na FTP server
z vnitøní sítì. Kdy¾ FTP server posílá data, posílá je na náhodný
port na externí sí»ovou kartu. Ma¹ina, která provádí NAT, je pøijme,
ale proto¾e nemá ¾ádné mapování pro neznámý paket a ¾ádné mapování
pro tento port, zahodí paket a nedoruèí ho.

<p>
Pøi pasivní módu FTP (co¾ je default pro OpenBSD
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=ftp&amp;sektion=1">ftp(1)</a>
klienta), klient po¾ádá server, aby vybral náhodný port, na kterém
bude èekat na datové spojení. Server informuje klienta o tom, jaký
port vybral, a klient se na tento port pøipojí, aby pøenesl data.
Bohu¾el to není v¾dy mo¾né nebo ¾ádoucí. ftp(1) standardnì pou¾ívá
tento mód; pou¾ít aktivní FTP mód ho donutíte pou¾itím volby -A nebo
vypnutím pasivního módu zadáním pøíkazu

<blockquote><pre>
passive off
</pre></blockquote>

<p>
na pøíkazovém øádku ftp&gt;.

<p>
Packet Filter poskytuje je¹tì dal¹í øe¹ení, pøesmìrováním FTP spojení
pøes FTP proxy server, co¾ je proces, který funguje jako "prùvodce"
FTP spojení skrz filtry. FTP proxy pou¾ívaná OpenBSD a PF je
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=ftp-proxy&amp;sektion=8&amp;manpath=OpenBSD+3.2">ftp-proxy(8)</a>.
Aktivujete ji pøidání nìèeho takového do va¹e souboru <i>/etc/pf.conf</i>:

<blockquote><pre>
rdr on tl0 from any to any port 21 -&gt; 127.0.0.1 port 8021
</pre></blockquote>

<p>
Krátké vysvìtlení  této øádky je: "Provoz na interním rozhraní je
pøesmìrován na proxy server bì¾ící na tomto stroji, která poslouchá na
portu 8021".

<p>
Doufejme, ¾e je jasné, ¾e proxy server musí být spu¹tìn a bì¾í na tomto
OpenBSD stroji. To udìláme pøidáním následujícího øádku do
<i>/etc/inetd.conf</i>:

<blockquote><pre>
127.0.0.1:8021 stream tcp nowait root /usr/libexec/ftp-proxy ftp-proxy
</pre></blockquote>

<p>
a buï restartováním systému nebo poslání signálu 'HUP'
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=inetd&amp;sektion=8">inetd(8)</a>.
Jedním ze zpùsobù, jak poslat signál 'HUP' je pøíkaz:

<blockquote><pre>
kill -HUP `cat /var/run/inetd.pid`
</pre></blockquote>

<p>
V¹imnìte si, ¾e ftp-proxy poslouchá na portu 8021, stejném jako port, na
který vý¹e uvedený pøíkaz rdr posílá FTP spojení. Výbìr portu 8021 je
náhodný, i kdy¾ 8021 je dobrá volba, proto¾e není definován pro ¾ádnou
jinou aplikaci.

<p>
<a name="nat3.3"></a>
<b>Pøesmìrování provozu</b>

<p>
Stane se, ¾e potøebujete pøesmìrovat pøíchozí nebo odchozí spojení pro
urèitý protokol nebo port na nìjaký stroj za filtrovacím systémem.
Pøíkladem tohoto je mù¾e být poèítaè ve vnitøní síti, na kterém bì¾í web
server pøístupný ze svìta, (nebo samozøejmì na¹e známá ftp-proxy(8)).
Pøíchozí spojení na platnou Internetovou IP adresu v¹ak budou bez odezvy,
proto¾e na stroji s NATem nebì¾í web server. Pro tento úèel pou¾íváme
direktivu NATu 'rdr' v souboru s pravidly, která dává instrukce pro
pøesmìrování urèitého spojení.

<p>
V na¹em pøípadì pøedpokládejme, ¾e web server se nachází na LAN s IP
adresou 192.168.1.80. Soubor s pravidly pro NAT potøebuje novou
direktivu, která se o toto postará. Pøidejte øádku podobnou této do
<i>/etc/pf.conf</i>:

<blockquote><pre>
rdr on fxp0 proto tcp from any to any port 80 -&gt; 192.168.1.80 port 80
</pre></blockquote>

<p>
Vysvìtlení ka¾dé èásti této øádky:

<dl>
<dt>"rdr"
<dd>Pøíkaz, který dáváte NATu. Øíká NATu, ¾e tato polo¾ka je pøíkaz
k pøesmìrování spojení.
</dl>

<dl>
<dt>"on fxp0"
<dd>Externí sí»ové rozhraní pøipojené k Internetu.
</dl>

<dl>
<dt>"from any to any"
<dd>Toto øíká, kterou adresu pøesmìrovat (pøicházející odkudkoliv
na fxp0, jak bylo naznaèeno vý¹e, na jakémkoliv cílové IP)
</dl>

<dl>
<dt>"port 80"
<dd>Pøíchozí port (80), který má být pøesmìrován. Nemusíte pou¾ít èíslo
"80", mù¾ete také pou¾ít "port www" pro pøesmìrování portu 80. Pokud
chcete pou¾ít jméno namísto èísla, musí odpovídající název a èíslo
existovat v souboru <i>/etc/services</i>.
</dl>

<dl>
<dt>"192.168.1.80 port 80"
<dd>IP adresa stroje v LAN, na který se budou pøesmìrovávat pakety.
V¹imnìte si, ¾e cílový port NEMUSÍ odpovídat pøíchozímu portu.  Tak¾e
tøeba následující pøíklad je platný a dokonce potenciálnì u¾iteèný:
<pre>
rdr on fxp0 proto tcp from any to any port 8080 -&gt; 192.168.1.35 port 80
</pre>
Tento øádek by smìroval pøíchozí spojení na port 8080 na webserver
bì¾ící na stroji ve vnitøní síti na "standardním" portu 80.
</dl>

<p>
Po pøidání pravidla znovu nahrajte pravidla NATu a pøesmìrování zaène
okam¾itì fungovat.

<p>
<b>Negace</b>
<p>
Nìkdy potøebujete udìlat výjimku z pravidla NATu nebo pøesmìrování.
Tady je pøíklad. AOL Instant Messenger známý tím, ¾e se proplí¾í skrz
firewally ka¾dým dostupným portem. Mo¾ná zjistíte, ¾e ftp-proxy
interferuje s AIMem, kdy¾ se rozhodne projít ven na port 21. Pokud vám
to vadí (hodnì lidí tráví nezanedbatelnì èasu pokusy o zablokování
AIMu!), mù¾ete se rozhodnout vyøadit IP adresy AIM serverù ze spojení
pøesmìrovávaných na¹ím pravidlem pro ftp-proxy. Udìláte to
následujícím øádkem:

<blockquote><pre>
rdr on tl0 proto tcp from any to ! 64.12.163.199 port 21 -&gt; 127.0.0.1 port 8021
</pre></blockquote>

<p>
Interpretace: Pøesmìruj spojení pøicházející na na tl0 smìøující na port
21, ale NE na 64.12.163.199 (u¾ivatelé serverù AIMu s tím mìli potí¾e)
na localhost, port 8021 (kde, doufejme, èeká ftp-proxy).  No a teï byste
si mìli uvìdomit, ¾e AIM serverù je hodnì, tak¾e si patrnì budete muset
pohrát s tìmito IP adresami (64.12.0.0/16 by mohlo být produktivnìj¹í, i
kdy¾ pravdìpodobnì zasáhne i nìkteré non-AOL servery).

<p>
<a name="nat3.4"></a>
<b>NAT versus Proxy</b>
<p>
Rozdíl mezi NATem a aplikaènì zalo¾enou proxy je ten, ¾e proxy software
jedná jako prostøedník mezi Internetem a strojem pøipojeným na LAN. To
je v poøádku, pøesto ka¾dá aplikace, kterou chcete spustit MUSÍ být
schopna pou¾ít proxy server. Ne v¹echny aplikace to doká¾í (obzvlá¹»
hry). Navíc neexistují proxy server aplikace pro v¹echny Internetové
slu¾by. NAT prùhlednì mapuje va¹i interní sí», aby mohla být spojena s
Internetem. Jediná výhoda, proè pou¾ívat proxy software narozdíl od NATu
je, ¾e proxy software by mìl být bezpeèný a mù¾e provádìt filtrování na
základì obsahu paketù, uchrání tak vá¹ stroj s Windows od macro viru,
mù¾e ochránit od buffer overflowu software klienta a více.  Pou¾ívání
tìchto filtrù je vìt¹inou nároèný úkol.

<p>
<a name="nat3.5"></a>
<b>Pøesmìrování a odrá¾ení</b>

<p>
Èasto jsou pøesmìrovávací pravidla pou¾ívána k pøesmìrování spojení
pøicházejících z Internetu na lokální server s privátní adresou v LAN,
jako tøeba:

<pre>
rdr on $ext_if proto tcp from any to $ext_if port 80 -&gt; $server port 80
</pre>

<p>
Ale kdy¾ jsou pravidla pro pøesmìrování testována z klientské stanice v
LAN, uká¾e se, ¾e to nefunguje.
Problém je v tom, ¾e pøesmìrovávací pravidla se uplatní pouze na pakety,
které procházejí specifikovaným rozhraním ($ext_if, externí rozhraní, v
na¹em pøíkladu).
Pøipojování se k vnìj¹ímu rozhraní firewallu ze stanice v LAN nicménì
neznamená, ¾e pakety budou procházet vnìj¹ím rozhraním.
TCP/IP stack na firewallu porovnává cílovou adresu pøíchozích paketù s
vlastními adresami a aliasy a rozpozná spojení na nìj samý u¾ v
okam¾iku, kdy procházejí vnitøním rozhraním. Takové pakety fyzicky
neprojdou vnìj¹ím rozhraním a stack takový prùchod ¾ádným zpùsobem
nesimuluje. pf tyto pakety nikdy nevidí na vnìj¹ím rozhraní a
pravidla pro pøesmìrování na vnìj¹ím rozhraní se neuplatní.

<p>
Pøidání druhého pøesmìrovávacího pravidla na vnitøním rozhraní nemá
oèekávaný úèinek.
Kdy¾ se lokální klient pøipojuje na externí adresu firewallu, úvodní
paket TCP handshake se dostane na firewall vnitøním rozhraním.
Pravidlo pøesmìrování se uplatní a cílová adresa je nahrazena adresou
vnitøního serveru. Paket je pøesmìrován zpátky skrz vnitøní rozhraní a
dostane se k vnitønímu serveru.
Ale zdrojová adresa nebyla pøelo¾ena a stále obsahuje adresu lokálního
klienta. Firewall nikdy neobdr¾í odpovìï a nemá ¹anci správnì zmìnit
pøeklad. Klient obdr¾í odpovìï ze zdroje, který neèekal, a zahodí ji.
TCP handshake sel¾e a ¾ádné spojení nemù¾e být vytvoøeno.

<p>
Nicménì pøesto je èasto zapotøebí, aby se klienti na LAN mohli
transparentnì pøipojit na vnitøní server stejným zpùsobem jako vnìj¹í.
Existuje nìkolik øe¹ení tohoto problému:

<p>
<b>Rozdìlené DNS</b>
<p>
Je mo¾né nastavit DNS servery, aby odpovídaly na dotazy vnitøních
klientù jinak ne¾ na externí dotazy, tak¾e lokální klienti obdr¾í adresu
vnitøního serveru bìhem pøekladu jména.
Potom se budou pøipojovat pøímo ani¾ by se na tom podílel firewall.
Tím se sni¾uje lokální provoz, proto¾e pakety nemusejí být posílány pøes
firewall.

<p>
<b>Pøesunutí serveru do oddìlené vnitøní sítì</b>
<p>
Pøidání dal¹ího sí»ového rozhraní na firewall a pøesunutí lokálního
serveru z vnitøní sítì do dedikované sítì (DMZ) umo¾òuje pøesmìrovaní z
lokálních klientù stejným zpùsobem jako pøesmìrování externích spojení.
Pou¾ití oddìlené sítì má nìkolik výhod, vèetnì zvý¹ení bezpeènosti díky
izolování serveru od ostatních lokálních stanic.
Pokud by server (který je v na¹em pøípadì dostupný z internetu) byl
kompromitován, nemá pøímý pøístup k ostatním lokálním strojùm, proto¾e
v¹echna spojení musí projít firewallem.

<p>
<b>Pou¾ití TCP proxy</b>
<p>
Mù¾eme na firewallu nastavit obecnou TCP proxy, buï naslouchající na
pøesmìrovávaném portu nebo pøesmìrování spojení z vnitøního rozhraní na
port, na kterém naslouchá.
Kdy¾ se lokální klient pøipojí na firewall, proxy akceptuje spojení,
vytvoøí nové spojení na vnitøní server a pøeposílá data mezi tìmito
dvìma spojeními.

<p>
Jednoduché proxy mù¾eme vytvoøit pou¾itím
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=inetd&amp;sektion=8">inetd(8)</a>
a
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=nc&amp;sektion=1">nc(1)</a>.
Následující øádek v <i>/etc/inetd.conf</i> vytvoøí naslouchající soket
na loopback adrese a portu 5000.
Spojení jsou pøesmìrována na port 80 na serveru 192.168.1.10.

<pre>
127.0.0.1:5000 stream tcp wait nobody /usr/bin/nc nc -w 20 192.168.1.10 80
</pre>

<p>
Následující pravidlo pøesmìruje port 80 na vnitøním rozhraní na proxy:
d409 6
a414 3
<pre>
rdr on $int_if proto tcp from $int_net to $ext_if port 80 -&gt; 127.0.0.1 port 5000
</pre>
d417 4
a420 4
<b>Kombinace RDR a NAT</b>
<p>
Pøidáním dal¹ího NAT pravidla mù¾eme dosáhnout chybìjícího pøekladu
zdrojové adresy popsáného vý¹e.
d422 3
a424 5
<pre>
rdr on $int_if proto tcp from $int_net to $ext_if port 80 -&gt; $server
no nat on $int_if proto tcp from $int_if to $int_net
nat on $int_if proto tcp from $int_net to $server port 80 -&gt; $int_if
</pre>
d427 1
a427 13
To zpùsobí, ¾e úvodní pakety od klienta budou pøelo¾eny znovu, kdy¾ jsou
pøeposílány zpátky vnitøním rozhraním, pøièem¾ je zdrojová adresa
klienta nahrazena vnitøní adresou firewallu.
Vnitøní server odpoví zpátky firewallu, který mù¾e vrátit oba NAT i RDR
pøeklady, kdy¾ pøeposílá odpovìï lokálnímu klientovi.
Je zapotøebí dát si pozor, aby se NAT pravidlo neuplatnilo i na dal¹í
provoz, napøíklad spojení pøicházející od externích strojù (dal¹ími
pøesmìrováními) nebo ze samotného firewallu.
Uvìdomte si, ¾e vý¹e uvedené rdr pravidlo zpùsobí, ¾e TCP/IP stack 
obdr¾í pakety pøicházející z vnitøního rozhraní s cílovou adresou 
ve vnitøní síti. Abyste stacku zabránili ve vyslání zprávy ICMP 
redirect (øíkájící klientovi, ¾e jeho cíl je dosa¾itelný pøímo,
co¾ by naru¹ilo odrá¾ení), vypnìte na firewallu redirecty, pomocí
d429 7
a435 5
<pre>
# <strong>sysctl -w net.inet.ip.redirect=0</strong>
</pre>

Obecnì byste mìli pou¾ít spí¹e pøedchozí uvedená øe¹ení.
d438 9
a446 10
<a name="nat4.0"></a>
<b>6.3.4 Links and Cross-References</b>

<p>
OpenBSD soubory:
<ul>
<li>/etc/pf.conf - pravidla pro PF/NAT
<li>/etc/rc.conf - nutné upravit pro spu¹tìní NATu a PF pøi bootu
<li>/etc/sysctl.conf - nutné editovat pro IP forwarding
</ul>
d449 1
a449 8
NAT Internet Links:
<ul>
<li><a href="http://www.openbsd.org/cgi-bin/man.cgi?query=pf.conf&amp;sektion=5&amp;manpath=OpenBSD+3.2">manuálová stránka pf.conf</a>
<li><a href="http://www.openbsd.org/cgi-bin/man.cgi?query=pfctl&amp;sektion=8&amp;manpath=OpenBSD+3.2">manuálová stránka pfctl</a>
<li><a href="http://www.geektools.com/rfc/rfc1631.txt">http://www.geektools.com/rfc/rfc1631.txt</a>
</ul>


a452 1
<a name= "6.4"></a>
d489 2
a490 1
pùvodním souboru), tak docílíte zmìny v chování DHCP klienta.
d506 2
a507 2
zeditujte /etc/rc.conf.  Nastavte v nìm volbu  dhcpd_flags="-q"  namísto
pùvodní dhcpd_flags=NO.  Nyní uveïte rozhraní, na kterých chcete aby
d515 1
a515 1
Pak upravte /etc/dhcpd.conf.
d519 1
a519 1
        option  domain-name "xyz.mil";
a566 1
<a name="6.5"></a>
d633 1
a633 1
nastavujeme záznamovou úroveò. Je mo¾né to zmìnit, více manuálová
a742 1
<a name="6.6"></a>
d744 1
d790 2
a791 1
V <a href="http://www.openbsd.org/cgi-bin/man.cgi?query=sysctl&amp;sektion=8">sysctl(8)</a> se pí¹e:
a807 1
<a name="6.7"></a>
d822 2
a823 2
Tato sekce vás provede základními kroky pro jednoduché nastavení NFS.  V
pøíkladì pøedpokládejme server na LAN, s klienty pøistupujícími na NFS
d828 3
a830 2
zprovoznil <a href="faq13.html">IPsec</a>.  V opaèném pøípadì mohou cizí
lidé potenciálnì vidìt va¹e  NFS spojení. Mù¾e to vést i k nìkterým
d841 13
a989 550
<a name="DNS"></a>
<a name="6.8"></a>
<h2>6.8 - Domain Name Service  - DNS, BIND, a named</h2>

<p>
<h3>6.8.1 Co je DNS?</h3>

<p>
Domain Name Service je sí»ová slu¾ba zprostøedkující sí»ovým doménám na
bázi IP pøeklad sí»ových IP adres na jména a jména strojù na sí»ové
adresy. va¹e instalace OpenBSD je nastavena defaultnì jako DNS klient,
ne jako DNS server. Tj. va¹e instalace OpenBSD mù¾e dávat DNS serverùm
DNS dotazy, ale nemù¾e sama odpovídat na DNS dotazy , pokud není
speciálnì nastavena. Tu je info jak na to.

<p>
Máte-li OpenBSD pøipojené k Internetu pøes va¹eho ISP, mù¾ete spustit 
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=nslookup&amp;sektion=8">nslookup(8)</a>,
program, který provádí DNS dotazy:

<blockquote><pre>
$ <strong>nslookup www.openbsd.org</strong>
Server:  ns4.us.prserv.net
Address:  165.87.201.244

Non-authoritative answer:
Name:    www.openbsd.org
Address:  129.128.5.191
</pre></blockquote>

<p>
<b>165.87.201.244</b> je nameserver , který odpovìdìl, je to nameserver,
který mùj ISP doporuèuje, abych ho pou¾íval v rámci svého úètu a toto
èíslo je ulo¾eno v 
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=resolv.conf&amp;sektion=5">/etc/resolv.conf</a>.
Odpovìï ale nebyla autoritativní. Pro autoritativní odpovìï na DNS dotaz
zjistíme nejprve, který DNS server je autoritativní pro doménu 
<i>openbsd.org</i> a zeptáme se ho pak na adresu <i>www.openbsd.org</i>:

<blockquote><pre>
# Identify the name servers for openbsd.org
# with the help of my ISP's name server.
$ <strong>nslookup -type=NS openbsd.org</strong>
Server:  ns4.us.prserv.net
Address:  165.87.201.244

Non-authoritative answer:
openbsd.org     nameserver = cvs.openbsd.org
openbsd.org     nameserver = gandalf.sigmasoft.com
openbsd.org     nameserver = cs.colorado.edu
openbsd.org     nameserver = ns.appli.se
openbsd.org     nameserver = zeus.theos.com

Authoritative answers can be found from:
cvs.openbsd.org internet address = 199.185.137.3
gandalf.sigmasoft.com   internet address = 198.144.202.98
cs.colorado.edu internet address = 128.138.243.151
ns.appli.se     internet address = 194.198.196.230
zeus.theos.com  internet address = 199.185.137.1

# Use the info gained to query for an authoritative
# resolution: query the authoritative zeus.theos.com.
$ <strong>nslookup www.openbsd.org zeus.theos.com</strong>
Server:  zeus.theos.com
Address:  199.185.137.1

Name:    www.openbsd.org
Address:  129.128.5.191
</pre></blockquote>

<p>
<i>zeus.theos.com</i> je, jak se dá pøedpokládat, server s OpenBSD, který
je správnì nastaven jako DNS server pro doménu <i>openbsd.org</i>.

<p>
<a name="DNS.1.1"></a>
<a name="6.8.1.1"></a>
<h3>6.8.1.1 Kde se dozvím v¹echno o DNS a jeho implementaci pod OpenBSD?</h3>

<ul>
<li>Jednak RFC <a href="http://www.faqs.org/rfcs/rfc1033.html">1033</a>,
<a href="http://www.faqs.org/rfcs/rfc1034.html">1034</a>, 
a <a href="http://www.faqs.org/rfcs/rfc1035.html">1035</a> s více informacemi o DNS.
<li>Kniha od O'Reilly Associates <i><a href="../../books.html#6">DNS a BIND</a> </i>.
<li>Dále pak <a href="http://www.openbsd.org/cgi-bin/man.cgi">OpenBSD Manual</a>, speciálnì manuálové stránky
  <ul>
  <li><a href="http://www.openbsd.org/cgi-bin/man.cgi?query=dig&amp;sektion=1">dig(1)</a>
  <li><a href="http://www.openbsd.org/cgi-bin/man.cgi?query=nslookup&amp;sektion=8">nslookup(8)</a>
  <li><a href="http://www.openbsd.org/cgi-bin/man.cgi?query=gethostbyname&amp;sektion=3">gethostbyname(3)</a>
  <li><a href="http://www.openbsd.org/cgi-bin/man.cgi?query=named&amp;sektion=8">named(8)</a>
  <li><a href="http://www.openbsd.org/cgi-bin/man.cgi?query=resolver&amp;sektion=3">resolver(3)</a>
  <li><a href="http://www.openbsd.org/cgi-bin/man.cgi?query=resolver&amp;sektion=5">resolver(5)</a>
  </ul>
</ul>

<p>
Pøíkaz <a href="http://www.openbsd.org/cgi-bin/man.cgi?query=dig&amp;sektion=1">dig(1)</a>
je u¾iteèný tím, ¾e vrací informaci o doménì ve stejném formátu, jaký je
nutný pro konfiguraèní soubory BINDu. Mù¾ete pou¾ít
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=dig&amp;sektion=1">dig(1)</a>
pro prozkoumání nameserverù, které pracují správnì, abyste mohli
porovnat jejich nastavení s va¹ím.

<p>
<h3>6.8.2 Potøebuji, aby mùj stroj slou¾il jako nameserver?</h3>

<p>
Pokud si nejste jisti, zda by mìl vá¹ stroj slou¾it jako DNS server,
nekonfigurujte ho tak. Instalace OpenBSD defaultnì neaktivuje stroj jako
domain name server, aèkoliv v¹echny potøebné soubory jsou instalovány.
Pro vìt¹inu poèítaèù je dostaèující soubor
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=hosts&amp;sektion=5">/etc/hosts</a>
s názvy lokálních strojù a jejich IP adresami a soubor
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=resolv.conf&amp;sektion=5">/etc/resolv.conf</a>,
který udává adresy DNS serverù, pou¾ívaných vámi na internetu nebo
intranetu.

<p>
Na druhou stranu mù¾e být ve va¹em pøípadì potøeba nastavit stroj jako
domain name server:

<ul>
<li>Pokud máte IP LAN a nechcete replikovat "hosts" soubory lokálních
adres stroj od stroje. V takovém pøípadì byste mohli konfigurovat
OpenBSD jako DNS server a odpovídat na DNS dotazy strojù z va¹í
LAN.
  <ul>
  <li><b>Poznámka:</b> Neexistuje praktické omezení poètu DNS serverù na
  LAN.  ¾ádný nebo naopak v¹echny poèítaèe na LAN mohou nabízet DNS
  slu¾bu, pokud jsou tak konfigurovány. Zda je ten který server pova¾ován
  za autoritativní zvenku va¹í LAN (nebo je vùbec znám venkovním sítím) je
  vlastnost konfigurace, která je vìt¹inou kontrolována na vy¹¹í úrovni
  doménové hierarchie.
  </ul>
<li>Pokud máte IP LAN, na které se nacházejí poèítaèe, které byste
chtìli mít dostupné z hlediska DNS dotazù, ze strojù z jiných IP LAN
nebo WAN.
<li>Pokud máte potí¾e s pøevodem názvu stroje na IP adresu nebo s
pøevodem lokálních názvù na IP adresy, pøesto¾e máte správnì nastaven
obsah souborù <i>/etc/hosts</i> a <i>/etc/resolv.conf</i> (Napø.
Netscape na OpenBSD obèas vykazuje podobné problémy, proto¾e
implementuje vlastní resolver místo pou¾ití funkce
<i>gethostbyname(3)</i> pro kladení DNS dotazù.))
</ul>

<p>
Dal¹ím faktorem je rychlost procesu. Proto¾e pøeklad jmen na adresy je
opakující se proces, ve kterém name servery opakovanì odpovídají jiným
nameserverùm na dotazy ohlednì adres jiných domén, pøeklad jmen mù¾e
trvat ponìkud déle, pokud máte modemové spojení s Internetem a
dotazujete se vlastního DNS serveru na adresy vzdálených poèítaèù (který
se pak bude opakovanì dotazovat vzdálených name serverù pomocí modemu),
ne¾ pokud se dotazujete name serveru va¹eho ISP (který má zøejmì
rychlej¹í spojení se vzdálenými name servery).

<p>
<h3>6.8.3 Jaké jsou softwarové komponenty DNS serveru?</h3>

<ul>
<li>named <i>("name daemon")</i>
<li>Konfiguraèní soubory v adresáøovém hierarchii pod <i>/var/named/</i>
</ul>

<p>
<h4>6.8.3.1 Jaká úroveò BINDu je podporována?</h4>

<p>
BIND je oznaèení implementaci DNS. Komponenty domain name serveru
spoleènì implementují BIND.  </p>

<p>
Existují tøi odli¹né specifikace BIND:

<ol>
<li>BIND 4</li>
<li>BIND 8</li>
<li>BIND 9</li>
</ol>

<p>
V bì¾né instalaci OpenBSD <b>named</b> podporuje BIND 4.x.

<p>
<h4>6.8.3.2 Jaké jsou nìkteré mo¾nosti provozování DNS prostøednictvím
defaultní implementace BIND 4.x?</h4>

<ul>
<li>Iplementace BIND 9.x v <i>/usr/ports/net/bind9</i>.
(Viz. <a href="../../cs/ports.html">ports</a>)
</ul>

<h5>6.8.3.2.1 <u>Poznámka o bezpeènosti</h5></u>

<p>
Pokud pou¾íváte tyto alternativní implementace domain name slu¾by,
provozujete kritickou sí»ovou slu¾bu za pou¾ití softwaru, který nebyl
pøedmìtem bezpeènostního auditu jako
<a href="http://www.openbsd.org/security.html">auditovaný</a>
<b>named</b> name daemon v základní instalaci. Toto je zapotøebí
zvá¾it, ponìvad¾ v pøípadì bezpeènostního naru¹ení domain name serveru
mohou být resolvery pou¾ívající tento name server pøesmìrovány na cizí
místa.
</p>

<p>
<h3>6.8.4 Kolik toho musím nainstalovat?</h3>

<p>
Pokud bylo nále¾itì nainstalováno pùvodní sí»ové nastavení pøi instalaci
OpenBSD, pak je u¾ v¹echno vlastnì instalováno. Musíte je¹tì nastavit
name daemona ("<tt>named</tt>").

<p>
<h3>6.8.5 Jak konfigurovat DNS?</h3>

<p>
Konfigurace se sestává na OpenBSD z editace nebo vytvoøení souborù,
které øídí name daemona <tt>named</tt>. Tyto soubory se nacházejí
pùvodnì v adresáøi <i>/var/named</i> a v jeho podadresáøích, obzvlá¹tì
soubor  <i>/var/named/named.boot</i>, co¾ je inicializaèní soubor pro
<b>named</b>. Je tu rovnì¾ nìkolik dal¹ích krokù konfigurace, které se
nacházejí v <i>/etc</i>.

<p>
V tomto dokumentu budeme konfigurovat name daemona na
<i>nemo.yewtopia.com</i> jako primární nameserver pro (velmi malou!!!)
doménu <i>yewtopia.com</i>. Adresa <i>nemo.yewtopia.com</i> je
<i>192.168.1.9</i>. Dva jiné poèítaèe <i>crater.yewtopia.com </i> na
192.168.1.1 a <i>earhart.yewtopia.com</i> na 192.168.1.2 se nacházejí v
její podsíti.

<p>
<h4>6.8.5.1 Konfigurace v <i>/var/named</i></h4>

<h5>6.8.5.1.1 <i>/var/named/named.boot</i></h5>

<blockquote><pre>
; tell what subdir has the lookup database files
directory       /namedb

; type    domain                source host/file backup file
cache .  root.cache
primary   0.0.127.IN-ADDR.ARPA  localhost.rev

; example primary server config:
primary  yewtopia.com yewtopia
primary  1.168.192.IN-ADDR.ARPA yewtopia.rev
</pre></blockquote>

<p>
Obsah souboru øíká inicializaèními procesu, ve kterém podadresáøi a pod
kterými jmény se nacházejí konfiguraèní soubory pro <i>yewtopia.com</i>.

<p>
<h5>6.8.5.1.2 <i>/var/named/namedb/localhost.rev</i></h5>

<blockquote><pre>
; Reverse lookup for localhost interface
@@       IN      SOA     nemo.yewtopia.com.  your_id.nemo.yewtopia.com.  (

                                14      ; Serial
                                3600    ; Refresh
                                900     ; Retry
                                3600000 ; Expire
                                3600 )  ; Minimum
        IN      NS      nemo.yewtopia.com.
1       IN      PTR     localhost.yewtopia.com.
</pre></blockquote>

<p>
<h5>6.8.5.1.3 <i>/var/named/namedb/yewtopia</i></h5>

<blockquote><pre>
; yewtopia.com domain database
@@      IN      SOA     nemo.yewtopia.com.  your_id.nemo.yewtopia.com.  (
                                14      ; Serial
                                3600    ; Refresh
                                900     ; Retry
                                3600000 ; Expire
                                3600 )  ; Minimum
                     IN      NS      nemo.yewtopia.com.

; Addresses
localhost.yewtopia.com.      IN A    127.0.0.1
crater.yewtopia.com.         IN A    192.168.1.1
earhart.yewtopia.com.        IN A    192.168.1.2
nemo.yewtopia.com.           IN A    192.168.1.9
</pre></blockquote>

<p>
<h5>6.8.5.1.4 <i>/var/named/namedb/yewtopia.rev</i></h5>

<blockquote><pre>
; yewtopia domain reverse lookup database
+@@      IN      SOA     nemo.yewtopia.com.  your_id.nemo.yewtopia.com.  (
                                14      ; Serial
                                3600    ; Refresh
                                900     ; Retry
                                3600000 ; Expire
                                3600 )  ; Minimum
1.168.192.in-addr.arpa. IN      NS      nemo.yewtopia.com.

; Addresses
1.1.168.192.in-addr.arpa. IN PTR crater.yewtopia.com.
2.1.168.192.in-addr.arpa. IN PTR earhart.yewtopia.com.
9.1.168.192.in-addr.arpa. IN PTR nemo.yewtopia.com.
</pre></blockquote>

<p>
<h4>6.8.5.2 Konfigurace v <i>/etc</i></h4>

<p>
<h5>6.8.5.2.1 <i>/etc/resolv.conf</i></h5>
<p>
Ujistìte se, ¾e <i>/etc/resolv.conf</i> nyní odkazuje na doménu lokálního
stroje (namísto napøíklad nameserveru va¹eho ISP) tak, aby ¾ádosti na DNS
dotazy byly zasílány na <b>named</b>, kterého jste konfigurovali!

<blockquote><pre>
domain yewtopia.com
lookup file bind
</pre></blockquote>

<h4>6.8.5.2.2 <i>/etc/hosts</i></h4>

<p>
Pokud jste døíve pøidali adresy rùzných strojù do souboru
<i>/etc/hosts</i>, mù¾ete zvá¾it zkrácení souboru <i>/etc/hosts</i> do
pùvodního stavu:

<blockquote><pre>
# Host addresses
127.0.0.1       localhost       localhost.localdomain
192.168.1.9     nemo            nemo.yewtopia.com
</pre></blockquote>

<p>
Takto není <b>named</b> obcházen v pøípadì (mo¾ná zastaralých) adres v
souboru <i>/etc/hosts</i>. <u>Ujistìte se, ¾e máte pøinejmen¹ím v tomto
souboru polo¾ku <i>localhost</i></u> jinak se va¹e sí» správnì
nenastaví! V¹imnìte si také, ¾e <i>nemo</i> se musí objevit ve vlastním
hosts souboru, jinak uvidíte (vìt¹inou málo nebezpeènou) 
chybovou hlá¹ku pøi startu, kdy¾ <i>/etc/netstart</i> spustí 
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=route&amp;sektion=8">route(8)</a>, 
aby pøidal <i>nemo</i> (jeho¾ adresa se objeví v  <i>/etc/myname</i>).

<p>
<h4>6.8.5.3 Pou¾ití
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=dig&amp;sektion=1">dig(1)</a>
pro zkoumání výsledkù.</h4>

<blockquote><pre>
$ <strong>dig @@nemo.yewtopia.com yewtopia.com any any</strong>

; &lt;&lt;&gt;&gt; DiG 2.2 &lt;&lt;&gt;&gt; @@nemo.yewtopia yewtopia any any
; (1 server found)
;; res options: init recurs defnam dnsrch
;; got answer:
;; -&gt;&gt;HEADER&lt;&lt;- opcode: QUERY, status: NOERROR, id: 59904
;; flags: qr rd ra; Ques: 1, Ans: 2, Auth: 0, Addit: 1
;; QUESTIONS:
;;      yewtopia.com, type = ANY, class = ANY

;; ANSWERS:
yewtopia.com.   3600    SOA    nemo.yewtopia.com.  your_id.nemo.yewtopia.com. (
                        14      ; serial
                        3600    ; refresh (1 hour)
                        900     ; retry (15 mins)
                        3600000 ; expire (41 days 16 hours)
                        3600 )  ; minimum (1 hour)
yewtopia.com.   3600    NS      nemo.yewtopia.com.

;; ADDITIONAL RECORDS:
nemo.yewtopia.com.  3600    A       192.168.1.9

;; Total query time: 4 msec
;; FROM: nemo to SERVER: nemo.yewtopia.com  192.168.1.9
;; WHEN: Tue May  2 23:47:19 2000
;; MSG SIZE  sent: 25  rcvd: 102
</pre></blockquote>

<p>
<h3>6.8.6 Jak a kdy mám nastartovat a zastavit DNS?</h3>

<p>
<h4>6.8.6.1 Start DNS</h4>

<p>
Démon <b>named</b> je spu¹tìn pøi startu systému z 
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=rc&amp;sektion=8">/etc/rc</a>,
v øádce instalované v pùvodním 
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=rc.conf&amp;sektion=8">/etc/rc.conf</a>.

<blockquote><pre>
named_flags=NO          # for normal use: ""
</pre></blockquote>

<p>
je zmìnìno na 

<blockquote><pre>
named_flags=""          # for normal use: ""
</pre></blockquote>

<p>
Rovnì¾ si v¹imnìte øádkù v /etc/rc.conf:

<blockquote><pre>
named_user=named                # Named should not run as root unless neccesary
named_chroot=/var/named         # Where to chroot named if not empty
</pre></blockquote>

<p>
Tato nastavení budou správná pro vìt¹inou míst.

<p>
Ruèní spu¹tìní <b>named</b>: pou¾ijte pøíkaz
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=ndc&amp;sektion=8">ndc(8)</a>.
Napøíklad:

<blockquote><pre>
# <strong>ndc start</strong>
nebo 
# <strong>ndc reload</strong>
</pre></blockquote>

<p>
<h4>6.8.6.2 Zastavení DNS</h4>

<p>
Nejlep¹í zpùsob jak zastavit démona je pou¾ít pøíkaz
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=ndc&amp;sektion=8">ndc(8)</a>.
Napøíklad:

<blockquote><pre>
# <strong>ndc stop</strong>
</pre></blockquote>

<p>
Pokud toto nefunguje, najdìte proces id procesu named a pou¾ijte
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=kill&amp;sektion=1">kill(1)</a>
pro ukonèení procesu. PID of <b>named</b>, pokud bì¾í, mù¾ete najít v
první øádce souboru <i>/var/named/named.pid</i>

<blockquote><pre>
# <strong>cat /var/named/named.pid</strong>
4608
named -t /var/named -u named
# <strong>kill -KILL 4608</strong>
</pre></blockquote>

<p>
<h4>6.8.6.3 Restart DNS se zmìnìnou konfigurací</h4>

<p>
Chcete-li, aby bì¾ící instance démon named restartovala sama sebe, s
naètením nové konfigurace, za¹lete procesu signál "hangup":

<blockquote><pre>
# <strong>kill -HUP 4608</strong>
</pre></blockquote>

<p>
nebo pou¾ijte pøíkaz
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=ndc&amp;sektion=8">ndc(8)</a>.
Napø.:

<blockquote><pre>
# <strong>ndc restart</strong>
</pre></blockquote>

<p>
<h3>6.8.7 Jak zablokovat AXFR dotazy?</h3>
<p>
Pøíklad:

<blockquote><pre>
garden:/home/jeremy$<strong>  host -l openssh.com</strong>
openssh.com.            NS      zeus.theos.com.
openssh.com.            NS      cvs.openbsd.org.
openssh.com.            NS      gandalf.sigmasoft.com.
openssh.com.            NS      cs.colorado.edu.
openssh.com.            NS      ns.appli.se.
openssh.com.            A       199.185.137.4
cvs.openssh.com.        A       199.185.137.4
localhost.openssh.com.  A       127.0.0.1
</pre></blockquote>

<p>
Tato informace je u¾iteèná pøi ladìní DNS, ale v nìkterých pøípadech
nemusí být vhodné nabízet tento výstup veøejnì.  Pokud pou¾íváte
classless in-addr(rfc2317) jako reverz, host -l bude informovat o ka¾dé
doménì, která se nachází ve va¹em systému! Zákazu zónových transferù
docílíte pomocí klauzule 'allow-transfer' ve va¹em zónovém souboru.
<br><br>

Pokud pou¾íváte Bind8, mù¾ete specifikovat poèítaèe, kterým dovolíte
zónové transfery zón ve va¹ich zónových souborech:

<blockquote><pre>
zone "foo.com" in {
        type master;
        file "directory/zonefile";
        allow-transfer {
          127.0.0.1;
          10.0.0.6;
          10.0.255.12;
        };
};
</pre></blockquote>

<p>
Mù¾ete také zablokovat transfery V¹ech domén editováním souboru
/var/named.conf a pøidáním parametru 'allow-transfer' do sekce 'options':

<blockquote><pre>
   options {
        allow-transfer { 127.0.0.1; };
    };
</pre></blockquote>

<p>
Metoda Bind8 pracuje takté¾ s Bind9.<br>
Pokud pou¾íváte Bind 4 (default v OpenBSD) mù¾ete editovat
/var/named/named.boot a pou¾ít volbu 'xfrnets'.<br>

<blockquote><pre>
xfrnets 209.142.221.5 12.7.96.7
; type    domain                source host/file                backup file
cache     .                                                     root.cache
primary   0.0.127.IN-ADDR.ARPA  localhost.rev
</pre></blockquote>

<p>
Bind 4 dovoluje transfery z celých tøíd, tak¾e není tak pøesný.
Typicky jediné stroje, které potøebují vykonávat DNS transfery jsou va¹i
DNS slaves a stroje, ze kterých chcete DNS debugovat (127.0.0.1 je
vìt¹inou dobrá volba, u které dovolit transferu!) Blokování AXFR dotazù
pøidává dal¹í úroveò soukromí, ale mù¾e znemo¾nit debugování DNS. 
(Thanks to <a href=mailto:ntang@@nachtwache.org>Nicholas Tang</a> za tento tip)

<p>
<h3>6.8.8 Co jste mi neøekli o nastavení DNS?</h3>
Je zde toho mnoho, napøíklad, jak nastavit DNS, aby dotazy na
intranetové domény, které nejsou viditelné z koøene doménové hierarchie
byly pøevádìny na servery v rámci va¹í spoleènosti. Radìji si pøeètìte
<a href="#DNS.1.1">Dokumenty které doporuèujeme</a>, kde najdete více
informací o DNS.

<p>
a990 1
<a name="6.9"></a>
d1214 2
d1293 1
a1293 1
<a href="index.html">[Zpìt na hlavní stránku]</a>
d1304 1
a1304 1
Originally [OpenBSD: faq6.html,v 1.155 ]
d1306 1
a1306 1
$Translation: faq6.html,v 1.15 2003/02/03 19:43:04 certik Exp $
d1308 1
a1308 1
$OpenBSD: faq6.html,v 1.10 2002/08/27 12:20:06 jufi Exp $
@


1.14
log
@
sync by Vaclav Rehak
@
text
@d1620 1
a1620 1
rdr on fxp0 from any to any port 80 -&gt; 192.168.1.80 port 80
d3251 1
a3251 1
$Translation: faq6.html,v 1.14 2002/11/23 18:57:11 certik Exp $
@


1.13
log
@
update by Vaclav Rehak <vasek@@openbsd.cz>
@
text
@d1826 10
d3249 1
a3249 1
Originally [OpenBSD: faq6.html,v 1.154 ]
d3251 1
a3251 1
$Translation: faq6.html,v 1.13 2002/11/20 08:58:23 certik Exp $
@


1.12
log
@
sync with badlands translation CVS
@
text
@d13 2
a14 1
<body bgcolor= "#ffffff" text= "#000000">
d18 1
a18 2
<h2><font color=#e00000>6.0 - Nastavení sítì</font><hr></h2>
</p>
d21 8
a28 7
<ul><h3>Obsah</h3>
<li><A href= "#Intro">6.0.1 - Pøedtím ne¾ pùjdeme dále</a>
<li><a href= "#Setup">6.1 - Úvodní nastavení sítì</a>
<li><a href= "#PF">6.2 - Packet Filter (PF)</a>
<li><a href= "#NAT">6.3 - Pøeklad sí»ových adres (NAT) </a>
<li><a href= "#DHCP">6.4 - Dynamic Host Configuration Protocol (DHCP)</a>
<li><a href= "#PPP">6.5 - Point to Point Protokol</a>
d30 3
a32 3
<li><a href= "#NFS">6.7 - Pou¾ívání NFS</a>
<li><a href= "#DNS">6.8 - Domain Name Service  - DNS, BIND a named</a>
<li><a href= "#PPTP">6.9 - Nastavení PPTP spojení v OpenBSD</a>
d35 1
a35 1
</p>
a37 1
<br>
d39 1
a39 1
<a name= "Intro"></a>
d42 1
d47 1
a47 1
<a href= "http://www.openbsd.org/cgi-bin/man.cgi?query=ifconfig&sektion=8">
d49 1
a49 1
<a href= "http://www.openbsd.org/cgi-bin/man.cgi?query=netstat&sektion=1">
d51 1
d56 2
a57 1
<a href="http://www.3com.com/solutions/en_US/ncs/501302.html">V¹e co potøebujete vìdìt o IP adresování</a>
d63 1
d69 3
a71 3
Radìji si vyberte téma, o které se zajímáte, nebo které pou¾íváte v
práci.  RFC definují mnoho (øádovì tisíce) standardù protokolù internetu
a popisují, jak tyto protokoly jsou navr¾eny a jak pracují.
d73 1
a81 1
</p>
d88 1
a88 1
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=dmesg&sektion=8">dmesg(8)</a>.
d90 1
a90 1
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=ifconfig&sektion=8">ifconfig(8)</a>
d95 1
a95 1
<ul><pre>
d98 1
a98 1
</pre></ul>
d102 1
a102 1
prosím, na <a href="./plat.html">seznam podporovaného hardwaru</a>
d112 1
a112 1
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=ifconfig&sektion=8">ifconfig(8)</a>.
d115 1
a115 1
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=fxp&sektion=4">fxp(4)</a>.
d118 1
a118 1
<ul><pre>
d147 1
a147 2
	 
</pre></ul>
d151 1
a151 1
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=ifconfig&sektion=8">ifconfig(8)</a>
d158 1
a158 1
</p>
d163 20
a182 10
<li><a href="http://www.openbsd.org/cgi-bin/man.cgi?query=lo&sektion=4">lo</a> - Loopback Interface
<li><a href="http://www.openbsd.org/cgi-bin/man.cgi?query=pflog&sektion=4">pflog</a> - Packet Filter Logging Interface
<li><a href="http://www.openbsd.org/cgi-bin/man.cgi?query=sl&sektion=4">sl</a> - SLIP Network Interface
<li><a href="http://www.openbsd.org/cgi-bin/man.cgi?query=ppp&sektion=4">ppp</a> - Point to Point Protocol
<li><a href="http://www.openbsd.org/cgi-bin/man.cgi?query=tun&sektion=4">tun</a> - Tunnel Network Interface
<li><a href="http://www.openbsd.org/cgi-bin/man.cgi?query=enc&sektion=4">enc</a> - Encapsulating Interface
<li><a href="http://www.openbsd.org/cgi-bin/man.cgi?query=bridge&sektion=4">bridge</a> - Ethernet Bridge Interface
<li><a href="http://www.openbsd.org/cgi-bin/man.cgi?query=vlan&sektion=4">vlan</a> - IEEE 802.1Q Encapsulation Interface
<li><a href="http://www.openbsd.org/cgi-bin/man.cgi?query=gre&sektion=4">gre</a> - GRE/MobileIP Encapsulation Interface
<li><a href="http://www.openbsd.org/cgi-bin/man.cgi?query=gif&sektion=4">gif</a> - Generic IPv4/IPv6 Tunnel Interface
d193 1
a193 1
<ul><pre>
d195 1
a195 1
</pre></ul>
d198 1
a198 2
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=hostname.if&sektion=5">hostname.if(5)</a>.)
</p>
a202 1
</p>
d204 1
a204 1
<ul><pre>
d207 1
a207 1
</pre></ul>
d214 1
a214 1
<ul><pre>
d216 1
a216 1
</pre></ul>
d218 2
a219 1
(Samozøejmì byste si nikdy nemìli vynutit full dupplex mód, pokud to
a225 1
</p>
d227 1
a227 1
<ul><pre>
d230 1
a230 1
</pre></ul>
d238 1
a238 1
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=hosts&sektion=5">hosts(5)</a>).
d242 1
a242 1
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=resolv.conf&sektion=5">resolv.conf(5)</a>.
a245 1
</p>
d247 1
a247 1
<ul><pre>
d253 1
a253 1
</pre></ul>
d257 1
a257 1
<strong>/etc/netstart</strong>.  Udìláte to jednodu¹e napsáním (jako
a258 1
</p>
d260 1
a260 1
<ul><pre>
d266 1
a266 1
</pre></ul>
d273 1
a273 1
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=ifconfig&sektion=8">ifconfig(8)</a>
d276 2
a277 2
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=netstat&sektion=1">netstat(1)</a>
nebo <a href="http://www.openbsd.org/cgi-bin/man.cgi?query=route&sektion=8">route(8)</a>.
a278 1
</p>
d280 1
a280 1
<ul><pre>
d309 1
a309 1
</pre></ul>
a314 1
</p>
d321 1
a321 1
mù¾ete blokovat potenciálnì nebezpeèné sí»ové relace. Rovnì¾ z dùvodu
d323 2
a324 2
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=ip&sektion=4">IPv4</a>
se mù¾ete podívat na Pøeklad sí»ových adres (Network address
d331 1
a331 1
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=sysctl&sektion=8">sysctl(8)</a>. 
d333 1
a333 1
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=sysctl.conf&sektion=5">/etc/sysctl.conf(5)</a>.
d337 1
a337 1
<ul><pre>
d339 1
a339 1
</pre></ul>
d344 1
a344 1
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=sysctl&sektion=8">sysctl(8)</a>.
d349 1
a349 1
<ul><pre>
d352 1
a352 1
</pre></ul>
d357 1
a357 1
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=routed&apropos=0&sektion=8">routed(8)</a>,
a362 1
</p>
a367 1
</p>
d372 1
a372 1
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=hostname.if&sektion=5"><i>/etc/hostname.&lt;if&gt;</i></a>.
d374 1
a374 1
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=rc&sektion=8">/etc/rc(8)</a>,
a377 1
</p>
a400 1
</p>
d402 1
a402 1
<ul><pre>
d406 1
a406 1
</pre></ul>
d411 1
a411 1
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=ifconfig&sektion=8">ifconfig(8)</a>.
a412 1
</p>
d414 1
a414 1
<ul><pre>
d416 1
a416 1
</pre></ul>
a419 1
</p>
d421 1
a421 1
<ul><pre>
d427 1
a427 1
</pre></ul>
d430 2
a431 2
<a name= "6.2"></a>
<a name= "PF"></a>
d433 1
a433 1
</p>
d435 19
a453 4
<h5>Poznámka: Packet Filter je filtrovací systém v OpenBSD 3.0 a
pozdìj¹ích. Pokud hledáte IPF/IPNAT FAQ pro OpenBSD 2.9 a star¹í,
kliknìte <a href="faqipf.html">zde</a>.</h5>
</p>
d457 3
a459 5
Konfiguraèní soubory pro tyto dvì slu¾by jsou
<i><a href="http://www.openbsd.org/cgi-bin/man.cgi?query=pf.conf&sektion=5">/etc/pf.conf(5)</a></i> 
a 
<i><a href="http://www.openbsd.org/cgi-bin/man.cgi?query=nat.conf&sektion=5">/etc/nat.conf(5)</a></i>.
</p>
d462 1
a462 1
<i><a href="http://www.openbsd.org/cgi-bin/man.cgi?query=rc.conf&sektion=8">/etc/rc.conf(8)</a></i>
a463 1
</p>
d465 1
a465 1
<ul><pre>
d467 1
a467 1
</pre></ul>
d471 1
a471 1
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=sysctl&sektion=8">sysctl(8)</a>
d474 1
a474 1
<i><a href="http://www.openbsd.org/cgi-bin/man.cgi?query=sysctl.conf&sektion=5">/etc/sysctl.conf(5)</a></i>
d476 1
a476 1
</p>
d479 1
a479 1
<i><a href="http://www.openbsd.org/cgi-bin/man.cgi?query=rc.conf&sektion=8">/etc/rc.conf(8)</a></i>,
d481 4
a484 5
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=pfctl&sektion=8&manpath=OpenBSD+3.1">pfctl(8)</a>.
</p>
<ul><pre>
# <b>pfctl -R /etc/pf.conf</b>
# <b>pfctl -N /etc/nat.conf</b>
d486 5
a490 1
</pre></ul>
a492 5
První øádek nastavuje filtrování podle <i>/etc/pf.conf</i>,
druhý nastaví NAT podle <i>/etc/nat.conf</i> (více o NAT najdete
dále v <a href="#NAT">Sekci 6.3, NAT</a>) a koneènì
tøetí aktivuje PF.
</p>
d494 4
a497 3
<ul><pre>
# <strong>pfctl -R /etc/pf.conf -N /etc/nat.conf -e</strong>
</pre></ul>
d502 4
a505 4
</p>
<ul><pre>
# <b>pfctl -R /etc/pf.conf</b>
</pre></ul>
d509 1
a509 2
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=pf.conf&sektion=5&manpath=OpenBSD+3.1">pf.conf(5)</a>
a <a href="http://www.openbsd.org/cgi-bin/man.cgi?query=nat.conf&sektion=5&manpath=OpenBSD+3.1">nat.conf(5)</a>.
a515 1
</p>
a518 1
</p>
d525 2
a526 2
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=pf.conf&sektion=5&manpath=OpenBSD+3.1">pf.conf(5)</a>. 
V následujících pøikladech reprezentuje <tt>fxp0</tt> externí rozhraní k
a529 1
</p>
a533 1
</p>
d539 1
a539 1
<ul><pre>
d542 1
a542 1
</pre></ul>
d544 1
d546 2
a547 1
<ul><pre>
d550 1
a550 1
</pre></ul>
d552 1
d557 3
a559 3
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=inet&sektion=4">inet (v4)</a>
nebo <a href="http://www.openbsd.org/cgi-bin/man.cgi?query=inet6&sektion=4">inet6 (v6)</a>&quot;.
</p>
d565 1
a565 1
<i><a href="http://www.openbsd.org/cgi-bin/man.cgi?query=protocols&sektion=5">/etc/protocols(5)</a></i>,
d567 3
a569 4
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=tcp&sektion=4">tcp(4)</a>,
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=udp&sektion=4">udp(4)</a> a
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=icmp&sektion=4">icmp(4)</a>.
</p>
d572 1
a572 1
Nyní pøedpokládejme, ¾e nechceme dovolit jakoukéliv pøichozí IPv4
d576 1
a576 1
<ul><pre>
d580 1
a580 1
</pre></ul>
d582 1
d585 3
a587 3
V¹imnìte si, ¾e pokud filtrujete podle portu, musíté uvést také protokol
a doporuèuje se urèit i address family. Slu¾eby definované v souboru
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=services&sektion=5">/etc/services(5)</a>
d595 1
a595 1
<ul><pre>
d599 1
a599 1
</pre></ul>
d601 1
a605 1
</p>
d608 1
a608 1
Samozøejmì ¾e existují vyjímky pro ka¾dé pravidlo. Volba <em>quick</em>
d613 1
a613 1
<ul><pre>
d617 1
a617 1
</pre></ul>
a623 1
</p>
d625 1
d627 2
a628 1
<p> Nejbezpeènìj¹í politika filtrování paketù je tzv. politika default
d633 1
a633 1
</p>
d639 2
a640 2
</p>
<ul><pre>
d646 1
a646 1
</pre></ul>
d655 1
a655 1
<ul><pre>
d661 1
a661 1
</pre></ul>
d663 1
d668 1
a668 1
<ul><pre>
d670 3
a672 1
</pre></ul>
d674 1
a674 1
<ul><pre>
d676 1
a676 2
</pre></ul>
</p>
d678 1
d682 1
a682 1
zaøízenípøipojené na internet). Nejprve nastolíme jednoduchou address
d685 2
a686 1
<ul><pre>
d691 1
a691 1
</pre></ul>
d693 1
d697 1
a697 1
<ul><pre>
d716 1
a716 2
</pre></ul>
</p>
d718 1
d723 4
a726 3
firewallem zablokován?  Jednodu¹¹e, Packet Filter to umo¾òuje pomocí
slova <em>log</em> :
<ul><pre>
d729 3
a731 1
</pre></ul>
d735 1
a735 1
</p>
d738 1
a738 1
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=pflogd&sektion=8&manpath=OpenBSD+3.1">pflogd(8)</a>,
d740 1
a740 1
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=tcpdump&sektion=8&manpath=OpenBSD+3.1">tcpdump(8)</a>.
d742 1
a742 1
<i><a href="http://www.openbsd.org/cgi-bin/man.cgi?query=rc&sektion=8">/etc/rc(8)</a></i>,
d744 1
a744 1
<i><a href="http://www.openbsd.org/cgi-bin/man.cgi?query=rc.conf&sektion=8">/etc/rc.conf(8)</a></i>.
d746 2
a747 1
<ul><pre>
d749 2
a750 2
</pre></ul>
</p>
d753 1
a753 1
NEZOBRAZUJE výsledky v reálném èase. Pokud chcete vidìt logy v reaálném èase,
d755 2
a756 1
<ul><pre>
d758 6
a763 3
</pre></ul>
Také je mo¾né usnadnit si debugování tím, ¾e zmen¹íme zábìr tcpdumpu:
<ul><pre>
d765 3
a767 1
</pre></ul>
d770 1
a770 1
</p>
d777 1
a777 1
</p>
d783 2
a784 2
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=telnet&sektion=1">telnetu(1)</a> nebo 
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=ftp&sektion=1">ftp(1)</a> ).
d788 121
d910 1
a910 1
</p>
d915 2
a916 1
<ul><pre>
d919 3
a921 1
</pre></ul>
d924 2
a925 1
<ul><pre>
d928 1
a928 2
</pre></ul>
</p>
a932 1
</p>
d941 2
a942 1
<ul><pre>
d944 3
a946 1
</pre></ul>
a949 1
</p>
a952 1
</p>
d958 2
a959 1
<ul><pre>
d961 1
a961 2
</pre></ul>
</p>
d964 1
a964 2
<b>TCP pøíznaky, vytvoøená spojení a keeping state</b>
</p>
d972 2
a973 1
<ul><pre>
d975 3
a977 1
</pre></ul>
d979 1
a979 1
</p>
d986 1
a986 1
</p>
d988 1
a988 1
Napøíklad se podívejme, jak mu¾eme uplatnit tuto vlastnost pøi psaní
d994 1
a994 1
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=ssh&sektion=1">ssh(1)</a>
d996 1
a996 1
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=lynx&sektion=1">lynx(1)</a> 
d1000 1
a1000 1
jde, mù¾e být ponìkud nevyhovující. Pøídáním slova <em>keep state</em>
d1005 2
a1006 2
</p>
<ul><pre>
d1012 2
a1013 1
</pre></ul>
d1027 2
a1028 1
<ul><pre>
d1038 2
a1039 2
</pre></ul>
</p>
d1049 2
a1050 1
<ul><pre>
d1078 2
a1079 2
</pre></ul>
</p>
a1083 1
</p>
a1086 1
</p>
d1092 2
a1093 1
<ul><pre>
d1095 3
a1097 1
</pre></ul>
d1099 1
a1099 1
</p>
d1104 2
a1105 1
<ul><pre>
d1111 1
a1111 2
</pre></ul>
</p>
d1114 1
a1114 2
<b>Expanze promìných</b>
</p>
d1120 2
a1121 2
</p>
<ul><pre>
d1126 1
a1126 2
</pre></ul>
</p>
a1130 1
</p>
d1134 2
a1135 1
<ul><pre>
d1164 1
a1164 2
</pre></ul>
</p>
d1169 2
a1170 1
<ul><pre>
d1172 4
a1175 2
</pre></ul>
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=pflogd&sektion=8&manpath=OpenBSD+3.1">pflogd(8)</a>
d1177 2
a1178 2
Vzpomìnte si, ¾e <i>/var/log/pflog</i> je binární soubor urèený ke ètení pomocí
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=tcpdump&sektion=8&manpath=OpenBSD+3.1">tcpdump(8)</a>,
d1180 1
a1180 1
</p>
a1183 31
</p>

<p>
<h3>Rozdíly mezi PF a IPF</h3>
</p>
<p>
Packet Filter byl navr¾en tak, aby byl velmi kompatibliní se
souborem <i>ipf.rules</i> pro IPF.
Nicménì PF není jednodu¹e pøesná náhrada IPF.
Základní rozdíly v syntaxy pravidel filtrování (pf.conf) jsou následující:
</p>
<ul>
<li><b>group and head:</b>  Tyto volby nejsou dále podporovány,
nebo» pravidla filtru jsou optimalizována za bìhu.  Pokud pøená¹íte
stará pravidla z IPF, mìli byste smazat v¹echny definice <em>group</em>
nebo <em>head</em> a ruènì pøeuspoøádat pravidla tak, aby se jejich
semantika nezmìnila.</li>
<li><b>level:</b> Pøi logování PF neakceptuje volbu <em>level</em> u
klíèového slova log, proto¾e logování se nedìje prostøednictvím 
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=syslogd&sektion=8">syslogdu(8)</a>,
ale separátním logovacím démonem. K odli¹ení konrétního typu
provozu tak, jak mohlo být provedeno volbou <em>level</em>,
pou¾ijte dostupné volby
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=tcpdump&sektion=8&manpath=OpenBSD+3.1">tcpdumpu(8)</a>.</li>
<li><b>keep frags:</b>  Toto bylo nahrazeno normalizací, kterou provádí volba
<a href="#normalization">scrub</a>.</li>
<li><b>@@n Rules:</b>  PF nepodporuje oznaèování pravidel pomocí <em>@@n</em>,
aby byla umístìna na konkrétní místo v seznamu pravidel tak, jako IPF.
Která èísla PF pøiøadil pravidlùm, mù¾ete zjistit pøíkazem
<tt>pfctl -sr</tt></li>
</ul>
d1189 1
a1189 1
</p>
d1191 4
a1194 4
<h5>Poznámka: Packet Filter je filtrovací systém v OpenBSD 3.0 a
pozdìj¹ích.  Pokud hledáte IPF/IPNAT FAQ pro OpenBSD 2.9 a
star¹í, kliknìte <a href="faqipf.html">zde</a>.</h5>
</p>
a1209 1
</p>
d1214 1
a1214 2
192.168.0.0/16 (192.168.0.0 - 192.168.255.255)<br>
</p>
a1219 1
</p>
d1221 1
a1221 2

<br>
a1229 1
</p>
d1231 16
a1246 14
<ul>
<b>Sí»ové karty: </b>
<ul>
Intel EtherExpress Pro/100 <b>fxp0</b><br>
Connected to the EXTERNAL LAN (or WAN)<br>
<b>IP Address: </b>24.5.0.5<br>
<b>Netmask: </b>255.255.255.0<br>
<br>
Compaq Netelligent 10/100Mb <b>tl0</b><br>
Connected to the INTERNAL LAN<br>
<b>IP Address: </b>192.168.1.1<br>
<b>Netmask: </b>255.255.255.0<br>	
</ul>
<br>
d1249 9
a1257 7
<ul>
<b>IP Address: </b>24.5.0.5<br>
<b>Netmask: </b>255.255.255.0<br>
<b>Gateway: </b>24.5.0.1<br>
</ul>
<br>
<b>Lokální sí»</b><br>
d1264 3
a1266 2
</ul>
<br>
d1268 1
a1268 1
<ul><pre>
d1284 2
a1285 2
</pre></ul>
</ul>
d1287 1
a1287 1
<br>
d1292 1
d1300 1
a1300 1
adresami, a i kdy¾ si organizce s vìt¹ím rozpoètem mohou
d1304 1
a1304 1
</p>
d1313 1
a1313 1
</p>
d1319 1
a1319 1
123.45.67.89). Stroj, na kterém bì¾í NAT obdr¾ít tento TCP paket a zmìní
a1327 1
</p>
a1330 1
</p>
d1332 1
a1332 1
<ul><pre>
d1343 1
a1343 1
</pre></ul>
d1345 1
a1345 1
<br>
d1347 1
a1347 1
<b>Proø pou¾ívat NAT?</b>
a1356 1
</p>
d1361 1
a1361 1
PC) a já sám se tøemi poèítaèi, tak¾e potøebujeme pøipojit pìt poèítaèu.
a1364 1
</p>
a1368 1
</p>
d1370 1
a1370 1
<br>
d1376 1
a1376 1
jednodu¹¹e docílíte editací souborù uvedených dále (zmìny udìlejte tak,
a1377 1
</p>
a1380 1
</p>
d1382 1
a1382 1
<ul><pre>
d1384 1
a1384 1
</pre></ul>
a1387 1
</p>
d1389 1
a1389 1
<ul><pre>
d1391 1
a1391 1
</pre></ul>
a1394 1
</p>
d1396 1
a1396 1
<br>
d1402 1
a1402 1
(<i><a href="http://www.openbsd.org/cgi-bin/man.cgi?query=pf.conf&sektion=5&manpath=OpenBSD+3.1">/etc/pf.conf</a></i>).
a1404 1
</p>
d1406 1
a1406 1
<ul><pre>
d1409 1
a1409 1
</pre></ul>
a1412 1
</p>
d1415 2
a1416 2
Soubor s nastavení NATu
(<i><a href="http://www.openbsd.org/cgi-bin/man.cgi?query=nat.conf&sektion=5&manpath=OpenBSD+3.1">/etc/nat.conf</a></i>).
a1418 1
</p>
d1420 1
a1420 1
<ul><pre>
d1422 1
a1422 1
</pre></ul>
a1425 1
</p>
d1427 22
a1448 22
<ul>
<strong>"nat"</strong>
<p>
Tímto øíkáte, ¾e pøíkaz, který zadáváte, je pravidlo NATu.
</p>
</ul>

<ul>
<strong>"fxp0"</strong>
<p>
Název sí»ového rozhraní pøipojeného na Internet.
</p>
</ul>

<ul>
<b>"192.168.1.0/24"</b>
<p>
IP adresa a sí»ová maska (maska je v CIDR formátu). Dohromady to znamená
"jakákoliv IP adresa o hodnotì od 192.168.1.1 do 192.168.1.254" má být
mapována. 
</p>
</ul>
a1449 2
<ul>
<b>"24.5.0.5"</b>
a1450 4
Externí IP adresa, na kterou budou mapovány interní IP adresy.
</p>
</ul>

a1457 1
</p>
d1460 1
a1460 2
Spu¹tìní NATu z pøíkazové øádky docílíte pøikazy:
</p>
d1462 2
a1463 2
<ul><pre>
# <b>pfctl -N /etc/nat.conf</b>
d1465 1
a1465 1
</pre></ul>
a1470 2
</p>

a1475 1
</p>
d1477 1
a1477 1
<br>
d1481 1
a1481 1
<br>
a1488 1
</p>
d1490 1
a1490 1
<ul><pre>
d1495 1
a1495 1
</pre></ul>
d1499 4
a1502 5
</p>
<ul>
<b>"192.168.1.35:2132"</b>
<p>
To vám øíká IP adresu poèítaèe ve vnitøní síti, který pu¾ívá NAT
d1505 18
a1522 4
</p>
</ul>
<ul>
<b>"24.5.0.5:53136"</b>
a1523 16
To znaèí, ¾e spojení jde do internetu pøes IP adresu 24.5.0.5 a port 53136.
</p>
</ul>
<ul>
<b>"65.42.33.245:22"</b>
<p>
IP adresa a port, na který spojení vede.
</p>
</ul>
<ul>
<b>"TIME_WAIT:TIME_WAIT"</b>
<p>
To ukazuje stav TCP, ve kterém si PF myslí, ¾e spojení je.
</p>
</ul>

d1531 1
a1531 1
</p>
d1541 1
a1541 1
</p>
d1544 1
a1544 1
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=ftp&sektion=1">ftp(1)</a>
d1549 1
a1549 1
tento mód; pou¾ít aktivní FTP mód ho donutíte pou¾itím volby -A neo
d1551 6
a1556 4
<dl><dt>
<pre>passive off
</pre>
</dt></dl>
d1558 1
a1558 1
</p>
d1562 9
a1570 6
FTP spojení skrz filtry. FTP proxy pou¾ívíná OpenBSD a PF je
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=ftp-proxy&sektion=8&manpath=OpenBSD+3.1">ftp-proxy(8)</a>.
Aktivujete ji pøidání nìèeho takového do va¹e souboru <i>/etc/nat.conf</i>:
<ul><pre>
rdr on tl0 from any to any port 21 -&gt; 127.0.0.1 port 8081
</pre></ul>
d1573 2
a1574 2
portu 8081".
</p>
d1579 6
a1584 3
<ul><pre>
127.0.0.1:8081 stream tcp nowait root /usr/libexec/ftp-proxy ftp-proxy
</pre></ul>
d1586 1
a1586 1
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=inetd&sektion=8">inetd(8)</a>.
d1588 2
a1589 1
<ul><pre>
d1591 6
a1596 4
</pre></ul>
V¹imnìte si, ¾e ftp-proxy poslouchá na portu 8081, stejném jako port, na
který vý¹e uvedený pøíkaz rdr posílá FTP spojení. Výbìr portu 8081 je
náhodný, i kdy¾ 8081 je dobrá volba, proto¾e není definován pro ¾ádnou
d1598 2
a1599 2
</p>
<br>
d1601 1
a1601 1
<b>Redirecting Traffic</b>
d1608 1
a1608 1
Pøíchozí spojení na platnou Internetovu IP adresu v¹ak budou bez odezvy,
a1611 1
</p>
d1617 1
a1617 2
<i>/etc/nat.conf</i>:
</p>
d1619 1
a1619 1
<ul><pre>
d1621 1
a1621 1
</pre></ul>
d1625 4
a1628 5
</p>
<ul>
<b>"rdr"</b>
<p>
Pøíkaz, který dáváte NATu. Øíká NATu, ¾e tato polo¾ka je pøíkaz
d1630 1
a1630 2
</p>
</ul>
d1632 8
a1639 11
<ul>
<b>"on fxp0"</b>
<p>
Externí sí»ové rozhraní pøipojené k Internetu.
</p>
</ul>

<ul>
<b>"from any to any"</b>
<p>
Toto øíká, kterou adresu pøesmìrovat (pøicházející odkudkoliv
d1641 1
a1641 2
</p>
</ul>
d1643 3
a1645 4
<ul>
<b>"port 80"</b>
<p>
Pøíchozí port (80), který má být pøesmìrován. Nemusíte pou¾ít èíslo
d1649 5
a1653 6
</p>
</ul>
<ul>
<b>"192.168.1.80 port 80"</b>
<p>
IP adresa stroje v LAN, na který se budou pøesmìrovávat pakety.
d1657 1
a1657 1
rdr on fxp0 from any to any port 8080 -&gt; 192.168.1.35 port 80
d1661 2
a1662 2
</p>
</ul>
d1664 1
a1664 1
Po pøidání pravidla znovu nahrajte pravidla NATu a pøesmìrování zaèkne
d1666 1
a1666 1
</p>
a1668 1
</p>
d1670 1
a1670 1
Nìkdy potøebujete udìlat vyjímkou z pravidla NATu nebo pøesmìrování.
d1678 6
a1683 3
<ul><pre>
rdr on tl0 from any to ! 64.12.163.199 port 21 -&gt; 127.0.0.1 port 8081
</pre></ul>
d1686 1
a1686 1
na localhost, port 8081 (kde, doufejme, èeká ftp-proxy).  No a teï byste
a1689 1
</p>
d1691 1
a1691 1
<br>
a1693 1

d1700 1
a1700 1
slu¾by. NAT prùhlednì mapuje va¹i iterní sí», aby mohla být spojena s
d1702 1
a1702 1
je, ¾e proxy software by mìl být bezpeèný a mù¾eprovádìt filtrování na
a1705 1
</p>
d1707 122
d1833 1
a1833 1
OpenBSD files:
d1835 1
a1835 1
<li>/etc/nat.conf - pravidla pro NAT
a1838 1
</p>
d1843 2
a1844 2
<li><a href="http://www.openbsd.org/cgi-bin/man.cgi?query=nat.conf&sektion=5&manpath=OpenBSD+3.1">manuálová stránka nat.conf</a>
<li><a href="http://www.openbsd.org/cgi-bin/man.cgi?query=pfctl&sektion=8&manpath=OpenBSD+3.1">manuálová stránka pfctl</a>
a1846 1
<p>
a1849 2
<br>

a1853 1
</p>
d1856 3
a1858 2
<p>Pro pou¾ívání DHCP klienta 
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=dhclient&sektion=8">dhclient(8)</a>
d1863 1
d1867 2
d1872 1
d1876 2
a1877 1
<PRE>
d1880 3
a1882 1
Kde fxp0 je rozhraní, na kterém chcete konfigurovat pomocí DHCP.
d1890 1
d1895 2
d1902 1
a1902 1

d1904 1
a1904 1
<A href="http://www.openbsd.org/cgi-bin/man.cgi?query=dhcpd&sektion=8">dhcpd(8)</a>,
d1908 1
d1910 1
a1910 1
# <strong>echo xl1 xl2 xl3  &gt;/etc/dhcpd.interfaces</strong>
d1912 3
a1914 1
Pak zeditujte /etc/dhcpd.conf.
d1916 1
d1931 1
a1931 1
joe' , pak ve skuteènosti se bude spojovat se strojem joe.xyz.mil).
d1935 1
a1935 1
IP adresy mezi 192.168.1.32 a 192.168.1.127.  Defaultní router klientù
d1941 7
a1947 4
<PRE>
# <strong>dhcpd -q fxp0</strong>
</PRE>
Kde fxp0 je rozhraní, na kterém chcete nastartovat DHCP server. Volba -q øíká
d1950 1
d1954 1
d1956 1
a1956 1
option  netbios-name-servers  192.168.92.55;
d1958 6
a1963 3
(kde 192.168.92.55 je IP va¹eho Windows nebo Samba serveru. )
Více voleb pro dhcp klienty se nachází zde: 
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=dhcp-options&sektion=5">dhcp-options(5)</a> .
d1965 2
a1966 2
<a name= "PPP"></a>
<a name= "6.5"></a>
d1968 2
a1969 3
</p>

Point-to-Point Protokol je tím protolem, který se dnes pou¾ívá pro spojení s
d1973 4
a1976 2
<li><a href="http://www.openbsd.org/cgi-bin/man.cgi?query=pppd&sektion=8">pppd(8)</a> - Jedná se o ppp démona zaèlenìného do jádra systému .
<li><a href="http://www.openbsd.org/cgi-bin/man.cgi?query=ppp&sektion=8">ppp(8)</a> - Tento ppp démon pracuje jako u¾ivatelský proces (nesystémový).
a1982 1
</p>
a1997 1
</p>
a2001 1
</p>
d2003 1
a2003 1
<ul><pre><strong>
d2005 1
a2005 2
</strong></pre></ul>

d2007 1
d2013 1
a2013 1
soubor <b>/etc/ppp/ppp.conf.sample</b> , který mù¾ete jednodu¹¹e
a2018 1
</p>
d2020 1
a2020 1
<ul>
d2028 1
a2028 1
</ul>
d2035 1
a2035 1
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=ppp&sektion=8">ppp(8)</a>.
a2041 1
</p>
a2048 1
<p>
d2050 1
a2050 1
<ul>
d2060 1
a2060 1
</ul>
a2071 1
</p>
d2073 1
a2073 1
<ul><pre>
d2075 1
a2075 1
</pre></ul>
a2091 1
</p>
a2100 1
</p>
d2102 1
d2107 1
a2107 1
mù¾eme zaèít zou¹et spojení s na¹ím ISP. Obvyklé formy pøikazu jsou:
d2111 4
a2114 2
<li><b>ppp -auto myisp</b> - Spustí ppp, nastaví rozhraní a spojí se s na¹im isp, poté pøechází na pozadí.
<li><b>ppp -ddial myisp</b> - Podobné jako -auto, ale pokud konekce je zru¹ena, pokusí se znovu o spojení.
d2119 2
a2120 3
módu. V nìm mù¾ete komunikovat pøímo s modemem, velmi vhodné pøi ladìní
problémù ve va¹em  <b>ppp.conf</b>.
</p>
d2138 2
a2139 3
Dal¹í informace: 
<a href="http://www.freebsd.org/doc/en_US.ISO8859-1/books/handbook/userppp.html">FreeBSD Handbook èást User PPP</a>.
</p>
d2142 2
a2143 2
<a name= "Tuning"></a>
<a name= "6.6"></a>
d2146 2
a2147 1
<H3>6.6.1 - Jak pøinutit jádro, aby dovolovalo vìt¹í poèet pokusù a
d2149 2
d2154 1
d2157 1
d2163 2
d2168 2
d2171 2
d2179 1
a2179 1
u¾iteèný, zejména pøi pou¾ívání starých iplementací NetBIOS protokolu.
d2184 5
a2188 1
<H3>6.6.3 - Nechci, aby kernel dynamicky alokoval urèité porty</h3>
d2190 3
a2192 2
V <a href="http://www.openbsd.org/cgi-bin/man.cgi?query=sysctl&sektion=8">sysctl(8)</a> se pí¹e:
<PRE>
d2205 1
a2208 1
</p>
d2210 2
a2211 1
<p> NFS, neboli Network File System, se pou¾ívá pro sdílení souborových
a2214 2
<p>

d2216 3
a2218 3
<li><a href="http://www.openbsd.org/cgi-bin/man.cgi?query=nfsd&sektion=8">nfsd(8)</a>
<li><a href="http://www.openbsd.org/cgi-bin/man.cgi?query=mountd&sektion=8">mountd(8)</a>
<li><a href="http://www.openbsd.org/cgi-bin/man.cgi?query=exports&sektion=5">exports(5)</a>
d2232 1
d2236 1
a2236 1
které mohou pøipojit daný adesáø, mù¾e kdokoliv, kdo má spojení s va¹ím
a2237 1
</p>
d2246 1
a2246 1
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=exports&sektion=5">exports(5)</a>.
a2247 1
</p>
d2249 1
a2249 1
<ul><pre>
d2255 1
a2255 1
</pre></ul>
d2264 1
a2264 2
jsou pøistupné zvenku.
</p>
d2266 2
a2267 1
<p> Máte-li nastaven <i>/etc/exports</i>, mù¾ete pokraèovat v nastavení
d2277 1
a2277 3
<p>

<ul><pre>
d2279 1
a2279 1
</pre></ul>
d2284 1
a2284 2
existuje prázdný soubor mountdtab, a spus»te daemona: 
<p>
d2286 1
a2286 1
<ul><pre>
d2289 1
a2289 1
</pre></ul>
d2295 1
a2295 1
<ul><pre>
d2297 1
a2297 1
</pre></ul>
a2299 1

a2304 1
<p>
d2306 1
a2306 1
<ul><pre>
d2319 1
a2319 1
</pre></ul>
d2321 2
a2322 1
<p>V normálním provozu máte k dispozici dal¹í utility, které vám
d2324 1
a2324 1
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=showmount&sektion=8">showmount(8)</a>,
d2327 1
a2327 1
zkuste <b>/usr/bin/showmount -a host</b>. Napøíklad:
d2331 1
a2331 1
<ul><pre>
d2335 1
a2335 1
</pre></ul>
d2337 1
d2342 1
a2342 1
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=mount_nfs&sektion=8">mount_nfs(8)</a>.
d2345 1
a2345 2
resolvuje jména):
<p>
d2347 1
a2347 1
<ul><pre>
d2349 1
a2349 1
</pre></ul>
a2353 1
<p>
d2355 1
a2355 1
<ul><pre>
d2357 1
a2357 1
</pre></ul>
d2362 3
a2364 3
volby jsou noexec, nodev, a nosuid ta poslední by mìla být pou¾ita kde
jen to je mo¾né. Napø.:
<p>
d2366 1
a2366 1
<ul><pre>
d2368 1
a2368 1
</pre></ul>
d2371 1
a2371 1
Diky tomu nebudou moci ¾ádné suid bit binárky na NFS serveru podlomit
a2378 1
</p>
d2380 1
a2389 1
</p>
d2393 1
a2393 1
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=nslookup&sektion=8">nslookup(8)</a>,
a2394 1
</p>
d2396 1
a2396 1
<ul><pre>
d2404 1
a2404 1
</pre></ul>
d2410 1
a2410 1
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=resolv.conf&sektion=5">/etc/resolv.conf</a>.
a2413 1
</p>
d2415 1
a2415 1
<ul><pre>
d2444 1
a2444 1
</pre></ul>
d2447 1
a2447 1
<i>zeus.theos.com</i> je , jak se dá pøedpokládat, server s OpenBSD, který
a2448 1
</p>
d2450 1
d2453 1
a2453 1
<h3>6.8.1.1 Kde se dozvím v¹echno o DNS a jeho iplementaci pod OpenBSD?</h3>
d2457 4
a2460 4
 <a href="http://www.faqs.org/rfcs/rfc1034.html">1034</a>, 
a <a href="http://www.faqs.org/rfcs/rfc1035.html">1035</a> s více informacemi o DNS.</li>
<li>Kniha od O'Reilly Associates <i><a href="http://www.openbsd.org/books.html#6">DNS a BIND</a> </i>.</li>
<li>Dále pak <a href="http://www.openbsd.org/cgi-bin/man.cgi">OpenBSD Manual</a> speciálnì manuálové stránky </li>
d2462 6
a2467 6
  <li><a href="http://www.openbsd.org/cgi-bin/man.cgi?query=dig&sektion=1">dig(1)</a>
  <li><a href="http://www.openbsd.org/cgi-bin/man.cgi?query=nslookup&sektion=8">nslookup(8)</a>
  <li><a href="http://www.openbsd.org/cgi-bin/man.cgi?query=gethostbyname&sektion=3">gethostbyname(3)</a>
  <li><a href="http://www.openbsd.org/cgi-bin/man.cgi?query=named&sektion=8">named(8)</a>
  <li><a href="http://www.openbsd.org/cgi-bin/man.cgi?query=resolver&sektion=3">resolver(3)</a>
  <li><a href="http://www.openbsd.org/cgi-bin/man.cgi?query=resolver&sektion=5">resolver(5)</a>
d2472 1
a2472 1
Pøíkaz <a href="http://www.openbsd.org/cgi-bin/man.cgi?query=dig&sektion=1">dig(1)</a>
d2475 1
a2475 1
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=dig&sektion=1">dig(1)</a>
a2477 1
</p>
d2479 1
d2487 1
a2487 1
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=hosts&sektion=5">/etc/hosts</a>
d2489 1
a2489 1
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=resolv.conf&sektion=5">/etc/resolv.conf</a>,
a2491 1
</p>
d2496 1
d2501 9
a2509 9
LAN.</li>
<ul>
<li><b>Poznámka:</b> Neexistuje praktické omezení poètu DNS serverù na
LAN.  ¾ádný nebo naopak v¹echny poèítaèe na LAN mohou nabízet DNS
service, pokud jsou tak konfigurovány. Zda je ten který server pova¾ován
za autoritativní zvenku va¹í LAN (nebo je vùbec znám venkovním sítím) je
vlastnost konfigurace, která je vìt¹inou kontrolována na vy¹¹í úrovni
doménové hierarchie.</li>
</ul>
d2512 1
a2512 1
nebo WAN.</li>
d2518 1
a2518 1
<i>gethostbyname(3)</i> pro kladení DNS dotazù.))</li>
a2529 1
</p>
d2531 1
d2535 2
a2536 2
<li>named <i>("name daemon")</i></li>
<li>Konfiguraèní soubory v adresáøovém hierarchii pod <i>/var/named/</i></li>
d2539 1
d2548 1
d2558 1
d2574 1
a2574 1
<b>named</b> name daemon v základní instalaci. Toto je zapotøební
d2580 1
a2586 1
</p>
d2588 1
a2597 1
</p>
a2605 1
</p>
d2607 1
d2612 1
a2612 1
<ul><pre>
d2623 1
a2623 1
</pre></ul>
d2629 1
d2632 1
a2632 1
<ul><pre>
d2643 1
a2643 1
</pre></ul>
d2645 1
d2648 1
a2648 1
<ul><pre>
d2663 1
a2663 1
</pre></ul>
d2665 1
d2668 1
a2668 1
<ul><pre>
d2682 1
a2682 1
</pre></ul>
d2684 1
d2687 1
a2692 1
</p>
d2694 1
a2694 1
<ul><pre>
d2697 1
a2697 1
</pre></ul>
a2704 1
</p>
d2706 1
a2706 1
<ul><pre>
d2710 1
a2710 1
</pre></ul>
d2715 2
a2716 2
souboru polo¾ku <i>localhost</i> </u> jinak se va¹e sí» správnì
nenastaví! V¹imnìte si také, ¾e <i>nemo</i> se mustí objevit ve vlastním
d2719 1
a2719 1
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=route&sektion=8">route(8)</a>, 
a2720 1
</p>
d2722 4
a2725 1
<h4>6.8.5.3 Pou¾ití <a href="http://www.openbsd.org/cgi-bin/man.cgi?query=dig&sektion=1">dig(1)</a> pro zkoumání výsledkù.</h4>
d2727 1
a2727 1
<ul><pre>
d2755 1
a2755 1
</pre></ul>
d2757 1
d2760 1
d2765 1
a2765 1
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=rc&sektion=8">/etc/rc</a>,
d2767 1
a2767 2
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=rc.conf&sektion=8">/etc/rc.conf</a>.
</p>
d2769 1
a2769 1
<ul><pre>
d2771 1
a2771 1
</pre></ul>
a2774 1
</p>
d2776 1
a2776 1
<ul><pre>
d2778 1
a2778 1
</pre></ul>
a2781 1
</p>
d2783 1
a2783 1
<ul><pre>
d2786 1
a2786 1
</pre></ul>
a2789 1
</p>
d2793 1
a2793 1
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=ndc&sektion=8">ndc(8)</a>.
a2794 1
</p>
d2796 1
a2796 1
<ul><pre>
d2800 1
a2800 1
</pre></ul>
d2802 1
d2807 2
a2808 2
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=ndc&sektion=8">ndc(8)</a>.Napøíklad:
</p>
d2810 1
a2810 1
<ul><pre>
d2812 1
a2812 1
</pre></ul>
d2816 1
a2816 1
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=kill&sektion=1">kill(1)</a>
a2818 1
</p>
d2820 1
a2820 1
<ul><pre>
d2825 1
a2825 1
</pre></ul>
d2827 1
d2831 1
a2831 1
Chcete-li, aby bì¾ící instance déman named restartovala sama sebe, s
a2832 1
</p>
d2834 1
a2834 1
<ul><pre>
d2836 1
a2836 1
</pre></ul>
d2840 1
a2840 1
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=ndc&sektion=8">ndc(8)</a>.
a2841 1
</p>
d2843 1
a2843 1
<ul><pre>
d2845 1
a2845 1
</pre></ul>
a2846 1
<h3>6.8.7 Jak zablokovat AXFR dotazy? </h3>
d2848 5
a2852 2
pøíklad:
<ul><pre>
d2862 2
a2863 1
</pre></ul>
d2865 1
a2865 1
Tato informace je u¾iteèná pri ladìní DNS, ale v nìkterých pøípadech
d2871 1
d2874 2
a2875 1
<ul><pre>
d2885 3
a2887 1
</pre></ul>
d2889 3
a2891 2
/var/named.conf a pøidáním parametru 'allow-transfer' do sekce options:
<pre><ul>
d2895 3
a2897 1
</pre></ul>
d2902 1
a2902 1
<pre><ul>
d2907 3
a2909 1
</pre></ul><br>
d2916 2
a2917 1
</p>
a2918 1
<p>
d2922 1
a2922 1
<a href="#DNS.1.1">Dokumenty které doporuèujeme</a> , kde najdete více
a2923 1
</p>
d2925 1
a2934 1
</p>
a2939 1
</p>
d2943 1
a2943 1
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=gre&apropos=0&sektion=0">gre(4)</a>
a2944 1
</p>
d2946 1
a2946 1
<ul>Patch pro odstranìní GRE(4) podpory.
d2964 1
a2964 1
</pre></ul>
a2970 1
</p>
d2975 1
a2975 1
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=ppp&apropos=0&sektion=0">ppp(8)</a>,
a2977 1
</p>
d2986 1
a2986 1
pravdìpodobnì co potøebujete: </p>
d2988 1
a2988 1
<ul><pre>
d2995 1
a2995 1
</pre></ul>
a2998 1
</p>
d3003 1
a3003 1
<ul><pre>
d3006 1
a3006 1
</pre></ul>
a3011 1
</p>
d3013 1
a3021 1
</p>
d3024 1
a3024 1
Poté co nastavíte interfejsy, mìli byste být schopni vytvoøit pptp
d3027 1
a3027 1
<ul><pre>
d3029 1
a3029 1
</pre></ul>
a3033 1
</p>
d3035 1
a3035 1
<ul><pre>
d3038 1
a3038 1
</pre></ul>
d3043 1
a3043 1
<ul>
d3046 1
a3046 1
</pre></ul>
d3050 1
a3050 1
Rovnì¾ si pøidejte startovací pøíkaz do <i>/etc/rc.local</i> abyste se
a3051 2
</p>

d3053 1
d3057 1
a3057 1
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=bridge&sektion=4">Bridge</a>
d3073 1
d3075 1
a3075 1
V jednom z mých rackù je nìkoli star¹ích systémù, z nich¾ ¾ádný nemá
d3085 1
a3085 2
(<a
href="http://www.openbsd.org/cgi-bin/man.cgi?query=fxp&sektion=4"><tt>fxp0</tt></a>)
d3087 1
a3087 2
(<a
href="http://www.openbsd.org/cgi-bin/man.cgi?query=ep&sektion=4"><tt>ep0</tt></a>)
d3104 1
d3116 1
d3118 1
a3118 1
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=ifconfig&sektion=8">ifconfig(8)</a>
d3122 1
a3122 1
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=ep&sektion=4">manuálové stránce</a>.
d3127 2
a3128 2
<a
href="http://www.openbsd.org/cgi-bin/man.cgi?query=bridgename.if&sektion=5"><tt>bridgename.bridge0</tt></a>.
d3140 1
d3149 1
d3163 4
a3166 4
pass in  on ep0  any
pass out on ep0  any
pass in  on fxp0 any
pass out on fxp0 any
d3170 2
a3171 1
Nyní øeknìmì, ¾e chci filtrovat provoz zasahující moje staré stroje.
d3191 1
d3194 1
a3194 1
Jiných výsledkù je mo¾né dosáhnout filtrováním na druhém ruzhraní.
d3198 1
a3198 1
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=brconfig&sektion=8">brconfig(8)</a>,
d3201 1
d3203 1
d3210 1
a3210 1
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=brconfig&sektion=8">brconfig(8)</a>
d3212 1
a3212 1
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=bridgename.if&sektion=5">bridgename.bridge0</a>,
d3221 2
a3222 2
(<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=tl&sektion=4">tl(4)</a>)
jsou pøikladem chipu, který nebude fungovat jako èást bridge.
d3226 1
d3228 3
a3230 3
<a href= "index.html">[Zpìt na hlavní stránku]</a>
<a href= "faq5.html">[Do sekce 5.0 - Nastavení jádra]</a>
<a href= "faq7.html">[Do sekce 7.0 - Keyboard controls]</a>
a3231 1
</p>
d3235 2
a3236 2
<a href= "index.html"><img height= "24" width= "24" src= "../../images/back.gif" border= "0" alt= "[zpìt]"></a>
<a href= "mailto:www@@openbsd.org">www@@openbsd.org</a>
d3239 1
a3239 1
Originally [OpenBSD: faq6.html,v 1.144 ]
d3241 1
a3241 1
$Translation: faq6.html,v 1.12 2002/09/23 15:42:55 certik Exp $
a3247 2


@


1.11
log
@
sync with badlands translation CVS
@
text
@d2990 1
a2990 1
$Translation: faq6.html,v 1.11 2002/09/09 07:53:47 certik Exp $
@


1.10
log
@
sync with badlands translation CVS
@
text
@d32 1
d44 2
a45 2
<a href="faq5.html">Konfigurace jádra</a> tìchto FAQ, stejnì jako manuálové stránky
pøíkazù 
d56 4
a59 3
Jedná se skuteènì o vynikající dokument, který obsahuje zcela nepostradatelné
informace pro práci se sítìmi na bázi IP protokolu, obzvlá¹tì pokud pokud máte
co doèinìní nebo zodpovídáte za více ne¾ jednu sí».
d61 2
a62 2
Pokud pracujete s aplikacemi jako jsou web servery, ftp servery a mail servery,
mù¾ete najít mnoho cenných informací 
d65 3
a67 3
Radìji si vyberte téma, o které se zajímáte, nebo které pou¾íváte v práci.
RFC definují mnoho (øádovì tisíce) standardù protokolù internetu a popisují,
jak tyto protokoly jsou navr¾eny a jak pracují.
d80 4
a83 4
Nejprve je nutné identifikovat v systému vá¹ sí»ový hardware. V OpenBSD jsou
sí»ová rozhraní pojmenovaná podle sí»ové karty, ne podle typu spojení. 
To zda byla va¹e sí»ová karta inicializovaná, mù¾ete vidìt pøi startu systému,
nebo pozdìji pomocí pøíkazu
d87 2
a88 2
Napøíklad zde je výstup z pøíkazu dmesg pro sí»ovou kartu Intel Fast Ethernet, které
odpovídá název zaøízení fxp.
d97 6
a102 5
Pokud nevíte, jaké jméno v systému odpovídá va¹í kartì, 
podívejte se, prosím, na <a href="./plat.html">seznam podporovaného hardwaru</a>
pro Va¹i platformu. Najdete tam seznam mnoha bì¾ných sí»ových karet a jména
je OpenBSD ovladaèù. Spojte krátké alfabetické jméno zaøízení (jako fxp)
s èíslem pøiøazeným kernelem a získáte jméno rozhraní (napø. fxp0).
d106 2
a107 2
Chcete-li zjistit, která zaøízení byla identifikována,
mù¾ete pou¾ít pøíkaz 
d147 8
a154 6
Jak je vidìt, <a href="http://www.openbsd.org/cgi-bin/man.cgi?query=ifconfig&sektion=8">ifconfig(8)</a>
dává více informací, ne¾ v této fázi potøebujeme. Umo¾òuje nám ale najít na¹e
zaøízení. V pøedcházejícím pøíkladì je ji¾ sí»ová karta nakonfigurována.
Poznáte to podle vypsaných hodnot &quot;inet 10.0.0.38 netmask
0xffffff00 broadcast 10.0.0.255&quot;, odpovídající nastavení parametrù a také
pomocí pøíznakù <strong>UP</strong> a <strong>RUNNING</strong>.
d157 1
a157 1
Zaznamenáte také nìkolk dal¹í rozhraní, která jsou standardnì zapnuta.
d173 4
a176 4
Pokud va¹e zaøízení nemáte nakonfigurované, prvním krokem je vytvoøení souboru
<strong>/etc/hostname.xxx</strong>.
Jméno zaøízení se nachází na místì xxx. V pøedcházejícím pøíkladu by
by jméno bylo <strong>/etc/hostname.ne3</strong>. Formát tohoto souboru
d189 2
a190 2
Typický konfiguraèní soubor rozhraní nastaveného na IPv4 adresu
bude vypadat takto:
d199 2
a200 2
Mù¾ete také urèit typ Ethernetového média, tøeba kdy¾ si budete chtít vynutit 
100baseTX full-duplex mód.
d207 3
a209 3
(Samozøejmì byste si nikdy nemìli vynutit full dupplex mód,
pokud to neudìlají obì strany spojení! Pokud nemáte speciální potøeby,
nastavení média by mìlo být vynecháno.)
d222 3
a224 3
Dal¹í krok je nastavení defaultního routeru. Provedete to tak, ¾e jeho IP adresu
umístíte do souboru s názvem <strong>/etc/mygate</strong>. Tím umo¾òíte, aby
vá¹ defaultní router byl nastaven pøi startu. 
d226 5
a230 4
(viz manuálová stránka <a href="http://www.openbsd.org/cgi-bin/man.cgi?query=hosts&sektion=5">hosts(5)</a>).
Nastavení nameserverù spoèívá mmj. ve vytvoøení souboru s názvem 
<strong>/etc/resolv.conf</strong>. Více informací o formátu tohoto souboru 
naleznete v manuálové stránce 
d232 1
a232 1
Pro standardní pou¾ití zde je pøíklad takového souboru. V tomto pøíkladu 
d246 3
a248 2
Nyní mù¾ete buïto restartovat poèítaè, nebo spustit skript <strong>/etc/netstart</strong>.
Udìláte to jednodu¹e napsáním (jako u¾ivatel root):
d260 4
a263 6
V¹imnìte si, ¾e do¹lo k nìkolika chybám.
Spu¹tìním tohoto skriptu rekonfigurujete vìci,
které jsou ji¾ zkonfigurovány. Tak tøeba nìkteré routy
u¾ existovaly v routovacích tabulkách jádra.
Nyní by vá¹ systém mìl být nastaven
a mìl by fungovat. Opìt se mù¾ete pøíkazem 
d265 2
a266 2
pøesvìdèit, ¾e je va¹e zaøízení nastaveno správnì. Smìrování paketù na sí»ových rozhraních,
nastavení rout mù¾ete zkontrolovat pomocí pøíkazu
d310 6
a315 6
Následují základní informace, které potøebujete znát, abyste mohli nastavit
va¹e OpenBSD jako router . Pokud pou¾íváte OpenBSD jako
router v síti Internet, doporuèujeme vám, abyste si pøeèetli rovnì¾ nastavení
Packet Filteru, o kterém pojednává dal¹í èást. Pomocí Packet Filteru mù¾ete blokovat
potenciálnì nebezpeèné sí»ové relace. Rovnì¾ z dùvodu nedostatkù IP adres na
Internetu pro
d317 2
a318 2
se mù¾ete podívat na Pøeklad sí»ových adres (Network address translation), 
kde najdete informace, jak roz¹íøit vá¹ adresový prostor.
d322 2
a323 2
Jádro kompilované jako GENERIC má ji¾ v sobì podporu IP Forwardingu, kterou je 
nutné zapnout. Mù¾ete tak uèinit pomocí pøíkazu  
d335 2
a336 1
Chcete-li tuto zmìnu provést bez restartu stroje, mìli byste pou¾ít pøíkaz
d338 2
a339 2
Pamatujte si v¹ak, ¾e tato zmìna nebude trvalá, vydr¾í
jen do rebootu a také ¾e tento pøíkaz musíte spustit jako u¾ivatel root.
d348 2
a349 2
Nyní zmìòte routovací tabulky na jiných strojích. Je mnoho zpùsobù pou¾ití 
OpenBSD jako router, pomocí softwaru
d354 2
a355 2
OpenBSD podporuje mnoho sí»ových zaøízení, jako T1, HSSI, ATM, FDDI, Ethernet
a sériové PPP/SLIP zaøízení.
d365 2
a366 2
OpenBSD má jednoduchý mechanismus, který umo¾òuje nastavit ip aliasy na zaøízení.
V¹e spoèívá v jednoduché editaci souboru
d371 2
a372 2
Napøíklad pøedpokládejme, ¾e u¾ivatel má zaøízení <b>dc0</b> a je na síti 192.168.0.0.
Dal¹í podstatné informace jsou:
d381 16
a396 14
Nìkolik poznámek o aliasech. V OpenBSD pou¾íváte pouze název zaøízení. Není 
tady rozdíl mezi prvním aliasem nebo druhým aliasem. Narozdíl od nìkterých 
operaèních systémù, OpenBSD se na nì neodkazuje jako dc0:0, dc0:1. Pokud se 
odkazujete na urèitou aliasovanou IP adresu pomocí ifconfig, nebo pøidáváte 
alias, ujistìte se, ¾e pí¹ete "<tt>ifconfig interface alias</tt>" namísto  
"<tt>ifconfig interface</tt>". Smazat alias mù¾ete pomocí 
"<tt>ifconfig interface delete</tt>".
<p>
Pøedpokládejme, ¾e pou¾íváte více IP adres, které jsou na stejné podsíti, 
a pou¾íváte k tomu aliasy. va¹e sí»ová maska pro ka¾dý alias má automaticky 
hodnotu 255.255.255.255. Není nutné, aby sí»ové masky aliasù následovaly 
sí»ovou masku prvního IP spojeného s tímto zaøízením. V následujícím pøíkladì 
<i>/etc/hostname.dc0</i> jsou pøidány dva aliasy pro zaøízení dc0, které mimo 
jiné bylo nastaveno jako 192.168.0.2 netmask 255.255.255.0.
d406 2
a407 2
Poté co jste vytvoøili tento soubor, budete muset rebootovat, aby se zmìny 
nastavení projevily. Nebo mù¾ete nastavit aliasy ruènì pomocí 
d439 3
a441 3
Subsystém Packet Filter slou¾í k zaji¹tìní dvou úloh,
filtrování na úrovni paketù a mapování poèítaèù a podsítí na okruh
externích adres. Konfiguraèní soubory pro tyto dvì slu¾ny jsou
d488 2
a489 2
co je PF spu¹tìn, mù¾ete znovu nahrát pravidla opìtovným naètením pøíslu¹ného
souboru:
d513 2
a514 2
<i>/etc/rc.conf</i> tak, aby obsahoval <tt>pf=YES</tt>.  Packet Filter (pf)
se nastavuje pomocí <i>/etc/pf.conf</i>, který je naèten pøi bootu.  
d517 4
a520 4
V následujících pøikladech reprezentuje <tt>fxp0</tt> externí rozhraní k internetu.
Ve va¹em pøípadì bude patrnì jiné, podle ethernetového adaptéru ve va¹em
poèítaèi. Pravidla pøedpokládají trvalé spojení s Internetem, jaké byste
zaøídili patrnì pro webserver.
d524 2
a525 2
Pravidla Packet Filtru jsou zpracovávána postupnì od shora dolù.
Ka¾dý paket musí pøejít pøes tato pravidla, pøedtím ne¾ dosáhne svého urèení.
d529 2
a530 2
Napøíklad implicitní soubor pravidel umo¾òuje ka¾dému paketu cestovat dovnitø
a ven:
d543 4
a546 3
To znamená &quot;propus» pøíchozí pakety odkudkoliv, smìøující kamkoliv&quot;
s implikovaným &quot;na ka¾dém rozhraní (co¾ je pøedpokládáno poka¾dé, pokud
není specifikováno konkrétní rozhraní) ka¾dé address family,
d551 4
a554 3
Pochopitelnì ¾e tohle není ¾ádný filtr. Skuteèné filtrování bude zalo¾eno
na address family (IPv4 nebo IPv6), protokolu a portu vyu¾ívaných slu¾bou,
kterou chcete filtrovat. Mù¾ete specifikovat kterýkoli protokol z
d563 3
a565 3
Nyní pøedpokládejme, ¾e nechceme dovolit jakoukéliv pøichozí IPv4 spojení 
na port 3306 (MySQL), proto¾e k databázi by mìl být pøístup pouze z localhostu.
Soubor pravidel by vypadal takto:
d573 1
a573 1
Toto øíká &quot;blokuj v¹echny pøíchozí IPv4 (inet) pakety, pøicházející 
d576 2
a577 2
a doporuèuje se urèit i address family. Slu¾eby definované
v souboru <a href="http://www.openbsd.org/cgi-bin/man.cgi?query=services&sektion=5">/etc/services(5)</a>
d591 3
a593 3
Pakety urèené pro port 3306 projdou, proto¾e poslední pravidlo souboru dovoluje
v¹em pøíchozím paketùm projít. Je dùle¾ité pamatovat si pøi psaní pravidel
pro Packet Filter, ¾e:
d598 3
a600 2
Samozøejmì ¾e existují vyjímky pro ka¾dé pravidlo. Volba <em>quick</em> ukonèí
zpracování paketu na prvním pravidlu, které odpovídá. Podívejme se na pøedcházející pøíklad.
d610 4
a613 4
Paket urèený pro ná¹ poèítaè na port 3306 bude zpracován bezprostøednì pravidlem
&quot;block in quick&quot; a bude odhozen. V¹echny pakety urèené pro jiné porty
nenajdou odpovídající pravidlo, dokud nedosáhnou pravidla &quot;pass in&quot;,
které jim dovolí projít.
d617 5
a621 5
<p> Nejbezpeènìj¹í politika filtrování paketù je tzv. politika default deny.
V¹echny pakety, které nejsou pøímo dovoleny, jsou odhozeny. Tato politika je
mnohem bezpeènìj¹í ne¾ pøímo nepovolovat ka¾dou chránìnou slu¾bu, umo¾òuje
mít relativnì malý soubor pravidel a také mù¾e ochránit od ¹patnì 
nakonfigurované slu¾by, která je ponechána svému osudu.
d624 4
a627 4
Nyní se podívejte na jiný pøíklad skuteèného ¾ijícího pøíkladu pravidel a
vysvìtleme si øádku po øádce jejich význam. Je to pøíklad webserveru s default
deny politikou, která povoluje pouze ssh spojení (pro administraci) a spojení
http (port 80) a https (port 443).
d638 5
a642 6
Tato pravidla dovolí projít pøíchozím spojením odkudkoliv na tcp porty 22(ssh), 
80(http) a 443(https). Odhodí v¹echny ostatní pakety a umo¾ní v¹echna
odchozí spojení. To u¾ je celkem dobrá sada pravidel.
Co kdy¾ ale chcete dovolit ssh spojení pouze z interních strojù 
ve va¹em adresovém bloku 1.1.1.0, ale dovolit
spojení zvenku na http a https?
d667 4
a670 3
Zde je nìkolik pravidel pro ka¾dého (pøedpokládejme, ¾e fxp0 je externí zaøízenípøipojené na internet). Nejprve nastolíme jednoduchou address spoofing ochranu.
Tyto adresy by (normálnì) nemìly poletovat Internetem, a pokud ano,
je to málokdy dobøe, tak¾e je zablokujeme:
d705 4
a708 3
Nyní je na¹e situace dost dobrá, ale mohla by být je¹tì lep¹í. Co kdy¾ chceme
logovat ka¾dý pokus o spojení na port 22(ssh), který byl firewallem zablokován?
Jednodu¹¹e, Packet Filter to umo¾òuje pomocí slova <em>log</em> :
d713 3
a715 2
Toto pravidlo dovolí na¹emu vzdálenému administraènímu poèítaèi spojení na port
22, ale blokuje a loguje v¹echny ostatní pokusy o spojení na port 22.
d748 3
a750 3
Tcpdumpové dekodery protokolù nemají úplnì nejlep¹í historie bezpeènosti.
Alespoò teoreticky jsou mo¾né zpo¾dìné útoky prostøednictvím
urèitého obsahu paketù nahraných logovacím zaøízením.
d754 3
a756 3
odchytí 96 bytù paketu a zapí¹e je do logu. Pøístup k logùm
mù¾e poskytnout èásteèný pøístup k citlivému obsahu paketù (napø. pøihla¹ování 
pomocí
d765 3
a767 4
Co kdy¾ potøebujeme povolit spojení na slu¾by bì¾ící pøes více protokolù,
jako je bind, který vyu¾ívá TCP a UDP?
Packet Filter vám umo¾òuje volby spojit dohromady do mno¾in 
(o tom více podìji):
d785 7
a791 9
Normalizování paketù znamená opìtné spojování fragmentovaných paketù
a ru¹ení IP options.
Nìkteré operaèní systémy a aplikace mívají problémy s abnormálními nebo
fragmentovanými pakety a je obecnì dobré mít pakety normalizované
pøi porovnávání s pravidly filtru a doruèení cílovému stroji. 
Proto je témìø v¾dy pøínosné normalizovat pakety pøedtím, ne¾ jsou
propu¹tìny na své koneèné místo urèení. 
To je mo¾né provést volbou <b>scrub</b>,
pou¾itou takto:
d804 4
a807 4
Standardnì PF blokuje pakety s nastavenými IP options. To mù¾e ztí¾it ¾ivot
utilitám pro &quot;OS fingerprinting&quot;, jako je nmap. Pokud máte aplikaci,
která vy¾aduje propou¹tìní takových paketù, jako multicast nebo IGMP, mù¾ete
vyu¾ít volbu <b>allow-opts</b>:
d817 6
a822 7
Packet Filter mù¾e také filtrovat pakety na základì TCP pøíznakù
a udr¾ovat vytvoøená spojení a stavy spojení. Doporuèujeme,
aby v¹ichni u¾ivatelé, kteøí chtìjí filtrovat pakety podle TCP
pøíznakù, rozumìli, jaký význam ka¾dý pøíznak má. Napøíklad
pokud chcete blokovat v¹echny pakety s nastavenými pøíznaky
FIN, URG a PSH (jako ku pøíkladu pokusy o OS fingerprinting nmapem)
pou¾ijete takovéhle pravidlo:
d830 4
a833 4
Udr¾ování stavu je vysvìtlováno jako &quot;nemluvit dokud nejsem osloven&quot;.
Jinak øeèeno, jakmile je spojení vytvoøeno, pakety u¾ nemusí projít
souborem pravidel. To je velice mocná vlastnost, která umo¾òuje
psaní mnohem jednodu¹¹ích a bezpeènìj¹ích pravidel.
d836 6
a841 5
Napøíklad se podívejme, jak mu¾eme uplatnit tuto vlastnost pøi psaní na¹í
ukázkové sestavy pravidel. Pro pøipomenutí, dovolujeme administraèní pøístup z
na¹í adresy tøídy C na port 22(ssh) a dovolujeme v¹echna pøíchozí spojení
na port 80 (http) a 443 (https). Blokujeme v¹echna ostatní spojení. Co ale
dìlat v pøípadì, ¾e se chceme spojit pomocí
d845 8
a852 7
abychom se podívali na nìco ve FAQ? To udìlat nemù¾eme, proto¾e
jsme zablokovali v¹echna pøíchozí spojení, které smìøují na jiné ne¾ námi
povolené porty. Aèkoliv nastavení ip filtru je tak bezpeèné jak to jen jde,
mù¾e být ponìkud nevyhovující. Pøídáním slova <em>keep state</em> do pravidla
 &quot;pass out&quot; mù¾eme automaticky povolit pakety, které pøicházejí
jako odezva na na¹e pokusy o spojení, jako je napø. surfování na webu.
Pamatujte si, ¾e potøebujeme specifikovat protokol, pro který udr¾ujeme stav.
d862 11
a872 10
Tato malá zmìna dramaticky zvy¹uje flexibilitu a bezpeènost na¹í sady pravidel.
Napøíklad, v pøecházejícím pøíkladì umo¾òujeme tcp spojení na port 80 a 443.
Mù¾eme to ale je¹tì zlep¹it. K tomu, aby se vytvoøilo tcp spojení, potøebujeme
aby probìhl jen poèáteèní handshake. Jakmile k nìmu dojde, mù¾eme blokovat
spojení na tento port a pomocí na¹eho &quot;keep state&quot; pravidlo bude
udr¾ovat vytvoøené spojení. Abychom dovolili poèáteèní handshake, potøebujeme
dovolit pakety pouze s nastaveným flagem SYN a nenastaveným ACK. Propu¹tìním paketù
pouze s pøíznaky SYN se ubráníme mnoha formám port skenù jako je
napøíklad FIN skenování. flags S/SA znamená: z flagù S (SYN) a A (ACK) mù¾e
být nastaven jenom SYN. Ostatní flagy nejsou zkoumány.
d887 8
a894 8
Nyní dejme dohromady v¹echny pravidla, která jsme mìli dosud v na¹í sadì.
Tato sada bude podporovat IPv4, mít default deny politiku, 
povolující pouze administrativní spojení z interní sítì (pøes ssh)
a umo¾òující pøíchozí spojení na porty
80 (http) a 443 (https). Ochrání nás rovnì¾ pøed spoofovanými neroutovatelnými
ip adresami a zaká¾e v¹echny pakety, které jsou pøíli¹ fragmentované nato, aby
se daly vy¹etøit. Docela dobré nastavení pro veøejný webserver. Zde je
ukázka souboru <i>/etc/pf.conf</i>:
d926 3
a928 3
I kdy¾ toto mù¾e vypadat dobøe, existuje je¹tì pár dal¹ích vìcí, kterými vám
Packet Filter pomáhá, aby soubor <i>pf.conf</i> byl èist¹í a dal se lépe
udr¾ovat.
d979 2
a980 1
A teï to v¹echno dejme dohromady a podívejme se na eleganci výsledného souboru:
d1014 2
a1015 2
Pokud se vyskytnou nìjaké problémy, mo¾ná budete chtít zprovoznit logování
u jednotlivých pravidel, abyste vìdìli, co se dìje, napø:
d1041 8
a1048 7
nebo» pravidla filtru jsou optimalizována za bìhu.
Pokud pøená¹íte stará pravidla z IPF, mìli byste smazat
v¹echny definice <em>group</em> nebo <em>head</em> a ruènì
pøeuspoøádat pravidla tak, aby se jejich semantika nezmìnila.</li>
<li><b>level:</b> Pøi logování PF neakceptuje volbu <em>level</em> u klíèového
slova log, proto¾e logování se nedìje prostøednictvím 
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=syslogd&sektion=8">syslogdu(8)</a>, ale separátním logovacím démonem. K odli¹ení konrétního typu
d1056 2
a1057 1
Která èísla PF pøiøadil pravidlùm, mù¾ete zjistit pøíkazem <tt>pfctl -sr</tt></li>
d1094 3
a1096 2
Pøedpokládá se, ¾e u¾ivatel u¾ nastavil a nakonfiguroval OpenBSD se dvìma
sí»ovými kartami (jedna pøipojena k Internetu a druhá k lokální síti).
d1125 2
a1126 1
<b>Externí, internetová routa (dodal ji ISP, v tomto pøípadì se jedná o linku modemovou)<br></b>
d1135 5
a1139 6
V na¹em vzorovém prostøedí
pou¾ívají poèítaèe na LAN adresové schéma 192.168.1.xxx (kde xxx je jedineèné
èíslo). Na LAN je mnoho rùzných OS, vèetnì Windows 98, Windows NT, OpenBSD a
Linux, ale OS klienta nehraje pøi NAT roli.
V tomto dokumentu a v jeho pøíkladech bude klient na LAN pou¾ívat IP adresu
192.168.1.40.
d1185 2
a1186 2
IP adresu (podle <a href="http://www.geektools.com/rfc/rfc1918.txt">RFC 1918</a>),
a v¹echny souèasnì vyu¾ívají stejnou externí IP adresu.
d1189 13
a1201 10
Zpùsob, jakým NAT pracuje je pøekvapivì jednoduchý. Kdy¾ se klient na LAN chce
spojit se strojem v Internetu, po¹le ven TCP paket se ¾ádostí o spojení. Uvnitø
TCP hlavièky paketu je klientova IP adresa (napø. 192.168.1.40) a po¾adovaná
IP adresa cílového poèítaèe (napø. 123.45.67.89). Stroj, na kterém bì¾í NAT
obdr¾ít tento TCP paket a zmìní klientovu IP adresu v hlavièce z 192.168.1.40
na IP adresu pøipojenou na Internet (napø.  24.5.0.5). Tímto zpùsobem
efektivnì docílíme toho, ¾e cílový poèítaè se domnívá, ¾e vlastní spojení pøichází ze stroje, na kterém bì¾í NAT. Cílový poèítaè (host) posílá dále pakety
týkající se daného spojení na adresu stroje s NATem. Kdy¾ stroj s NATem obdr¾í
paket od host-a, pøelo¾í rychle cílovou IP adresu na adresu klienta a po¹le paket klientovi. Klient nemá ani tu¹ení o tom, co se stalo a Internetové spojení
je pro nìj zcela transparentní.
d1226 7
a1232 6
Kdy¾ jsem se nastìhoval do nového bytu, byl jsem postaven pøed men¹í problém.
Jak dát pøipojení k Internetu mým spolubydlícím, kdy¾ modemový kabel je
pouze v mé místnosti? Bylo tu nìkolik mo¾ností, které jsem mohl implementovat,
poèínají tím, ¾e ka¾dý z nás obdr¾í vlastní IP adresu, pøes nastavení proxy
serveru a¾ po nastavení NATu. (Nenechejte se mýlit pøíkladem s modemovým kabelem. NAT je dostateènì silný aby zamaskoval velikou LAN se stovkami ba i tisíci
poèítaèù!)
d1236 6
a1241 5
Je tu mnoho dùvodù, proè jsem chtìl nastavit NAT. Dùvodem èíslo jedna bylo
u¹etøit peníze. V mém domì jsou dva spolubydlící (ka¾dý s vlastním PC) a já sám
se tøemi poèítaèi, tak¾e potøebujeme pøipojit pìt poèítaèu. Mùj ISP ale povoluje
pouze tøi IP adresy v ka¾dé domácnosti.  To znamená, ¾e zde není dostatek 
IP adres , aby ka¾dému poèítaèi mohl být umo¾nìn internetový pøístup.
d1245 2
a1246 2
Pøi pou¾ití NATu bude mít ka¾dý stroj unikátní (interní) IP adresu, ale budou
sdílet jednu IP adresu pro pøístup na Internet. Náklady jdou dolù.
d1254 3
a1256 3
Nejprve budete muset na va¹em OpenBSD systému zapnout PF. Toho jednodu¹¹e
docílíte editací souborù uvedených dále (zmìny udìlejte tak, aby odpovídající
øádky vypadaly jako ty následující):
d1286 2
a1287 2
Pro úèely tohoto dokumentu dovolíme spojení pøes tento firewall bez omezení.
Soubor by mìl vypadat asi takto:
d1348 3
a1350 3
Jakmile je jednou konfigurace kompletní, jsou zde dva zpùsoby jak spustit NAT.
První (a nejlep¹í, pokud je to mo¾né) je rebootovat OpenBSD stroj.
To se provede pøíkazem "<i>reboot</i>".
d1370 3
a1372 3
<b>Poznámka:</b> budete-li potøebovat updatovat nastavení NATu (v pøípadì, ¾e
editujete soubor, ale nechcete rebootovat) staèí pøedchozí pøíkaz spustit znovu.
Nastavení bude obnoveno s provedenými zmìnami.
d1384 3
a1386 3
Chcete-li zjistit, jak NAT právì pracuje, nebo se ujistit o tom, zda nastavení
jsou funkèní, pou¾ijte volbu "-ss". Tato volba vypí¹e seznam v¹ech
souèasných spojení, které NAT zpracovává:
d1402 3
a1404 2
To vám øíká IP adresu poèítaèe ve vnitøní síti, který pu¾ívá NAT (192.168.1.35).
Za ní následuje port, pou¾itý k vytvoøení spojení (2132).
d1468 3
a1470 2
Krátké vysvìtlení  této øádky je: "Provoz na interním rozhraní je pøesmìrován
na proxy server bì¾ící na tomto stroji, která poslouchá na portu 8081".
d1485 4
a1488 3
V¹imnìte si, ¾e ftp-proxy poslouchá na portu 8081, stejném jako port, na který
vý¹e uvedený pøíkaz rdr posílá FTP spojení. Výbìr portu 8081 je náhodný,
i kdy¾ 8081 je dobrá volba, proto¾e není definován pro ¾ádnou jinou aplikaci.
d1495 7
a1501 7
Stane se, ¾e potøebujete pøesmìrovat pøíchozí nebo odchozí spojení pro urèitý
protokol nebo port na nìjaký stroj za filtrovacím systémem.
Pøíkladem tohoto je mù¾e být poèítaè ve vnitøní síti, na kterém bì¾í web server
pøístupný ze svìta, (nebo samozøejmì na¹e známá ftp-proxy(8)).
Pøíchozí spojení na platnou Internetovu IP adresu v¹ak budou
bez odezvy, proto¾e na stroji s NATem nebì¾í web server. Pro tento úèel
pou¾íváme direktivu NATu 'rdr' v souboru s pravidly, která dává instrukce pro
d1506 4
a1509 3
V na¹em pøípadì pøedpokládejme, ¾e web server se nachází na LAN s IP adresou
192.168.1.80. Soubor s pravidly pro NAT potøebuje novou direktivu, která se
o toto postará. Pøidejte øádku podobnou této do <i>/etc/nat.conf</i>:
d1545 4
a1548 4
Pøíchozí port (80), který má být pøesmìrován. Nemusíte pou¾ít èíslo "80",
mù¾ete také pou¾ít "port www" pro pøesmìrování portu 80. Pokud
chcete pou¾ít jméno namísto èísla, musí odpovídající název a èíslo existovat
v souboru <i>/etc/services</i>.
d1555 2
a1556 2
V¹imnìte si, ¾e cílový port NEMUSÍ odpovídat pøíchozímu portu.
Tak¾e tøeba následující pøíklad je platný a dokonce potenciálnì u¾iteèný:
d1573 5
a1577 6
Tady je pøíklad. AOL Instant Messenger známý tím, ¾e se proplí¾í
skrz firewally ka¾dým dostupným portem. Mo¾ná zjistíte,
¾e ftp-proxy interferuje s AIMem, kdy¾ se rozhodne projít ven
na port 21. Pokud vám to vadí (hodnì lidí
tráví nezanedbatelnì èasu pokusy o zablokování AIMu!),
mù¾ete se rozhodnout vyøadit IP adresy AIM serverù ze spojení
d1583 6
a1588 7
Interpretace: Pøesmìruj spojení pøicházející na na tl0 smìøující
na port 21, ale NE na 64.12.163.199 (u¾ivatelé serverù AIMu s tím
mìli potí¾e) na localhost, port 8081 (kde, doufejme, èeká ftp-proxy).
No a teï byste si mìli uvìdomit, ¾e AIM serverù je hodnì, tak¾e si
patrnì budete muset pohrát s tìmito IP adresami (64.12.0.0/16 by
mohlo být produktivnìj¹í, i kdy¾ pravdìpodobnì zasáhne i nìkteré
non-AOL servery).
d1596 11
a1606 9
Rozdíl mezi NATem a aplikaènì zalo¾enou proxy je ten, ¾e proxy software jedná
jako prostøedník mezi Internetem a strojem pøipojeným na LAN. To je v poøádku,
pøesto ka¾dá aplikace, kterou chcete spustit MUSÍ být schopna pou¾ít proxy
server. Ne v¹echny aplikace to doká¾í (obzvlá¹» hry). Navíc neexistují proxy
server aplikace pro v¹echny Internetové slu¾by. NAT prùhlednì mapuje va¹i 
iterní sí», aby mohla být spojena s Internetem. Jediná výhoda, proè pou¾ívat
proxy software narozdíl od NATu je, ¾e proxy software by mìl být bezpeèný a mù¾eprovádìt filtrování na základì obsahu paketù, uchrání tak vá¹ stroj s Windows
od macro viru, mù¾e ochránit od buffer overflowu software klienta a více.
Pou¾ívání tìchto filtrù je vìt¹inou nároèný úkol.
d1643 4
a1646 4
 dodávaného spolu s OpenBSD, zeditujte soubor /etc/hostname.xl0 
(za pøedpokladu, ¾e va¹e hlavní ethernetové rozhraní je xl0. Mù¾ete mít jiné 
rozhraní, napø. ep0 nebo fxp0 nebo jiné!) Jediné slovo, které musí tento soubor
po editaci obsahovat je 'dhcp'.
d1650 3
a1652 3
Tento pøíkaz zpùsobí automatické nastartovaní DHCP klienta pøi bootování.
OpenBSD bude od DHCP serveru po¾adovat informaci o své IP adrese, defaultním 
routeru a DNS serverech.
d1654 2
a1655 2
Chcete-li spou¹tìt DHCP klienta z pøíkazové øádky, ujistìte se, ¾e existuje
soubor /etc/dhclient.conf a potom vyzkou¹ejte:
d1660 7
a1666 5
<p>Bez ohledu na to, jak spustíte DHCP klienta, mù¾ete zeditovat soubor 
/etc/dhclient.conf , aby napø. nedo¹lo ke zmìnì v ji¾ nakonfigurovaném DNS na základì
odezvy DHCP serveru. V tomto pøípadì staèí kdy¾ odkomentujete øádku zaèínající
slovem 'request' (tato øádka se nachází v pùvodním souboru), tak docílíte zmìny
v chování DHCP klienta.
d1671 3
a1673 2
a potom <b>odstraòte</b> slovo domain-name-servers. Samozøejmì mù¾ete chtít
odstranit i jiná nastavení jako napø. hostname.
d1679 3
a1681 3
zeditujte /etc/rc.conf.  Nastavte v nìm volbu  dhcpd_flags="-q"  namísto pùvodní dhcpd_flags=NO.
Nyní uveïte rozhraní, na kterých chcete aby <b>poslouchal</b> DHCP server, v
souboru /etc/dhcpd.interfaces.
d1697 1
d1699 9
a1707 6
Takovéto nastavení øíká va¹im DHCP klientùm, ¾e doména, kterou mají pøidávat
k DNS dotazùm je xyz.mil (tedy pokud u¾ivatel napí¹e 'telnet joe' , pak ve skuteènosti se bude spojovat se strojem joe.xyz.mil).  Dále odká¾ete klienta, aby
pou¾íval DNS servery 192.168.1.3 a 192.168.1.5.  Poèítaèùm na stejné síti jako
je ethernetové rozhraní DHCP serveru, je¾ je v rozsahu 192.168.1.0/24 , bude
DHCP server pøiøazovat IP adresy mezi 192.168.1.32 a 192.168.1.127.  Defaultní
router klientù bude nastaven na 192.168.1.1.
d1709 2
a1710 1
Pokud chcete spou¹tìt dhcpd z pøíkazové øádky, po editaci /etc/dhcpd.conf vyzkou¹ejte:
d1741 3
a1743 1
První, který popí¹eme bude nesystémový ppp démon. Pøedtím ne¾ zaènete s konfigurací je dobré zjistit si nìkteré údaje od va¹eho ISP. Jedná se pøedev¹ím o:
d1754 4
a1757 2
Nìkteré z tìchto informací nutnì nepotøebujete, bez jiných se zase neobejdete.
Nesystémový ppp démon pou¾ívá <a href="http://www.openbsd.org/cgi-bin/cvsweb/src/etc/ppp/ppp.conf.sample">/etc/ppp/ppp.conf</a> jako svùj konfiguraèní soubor.
d1763 2
a1764 2
Také se ujistìte, v pøípadì, ¾e pou¾íváte jádro GENERIC, ¾e máte následující
øádku ve va¹em konfiguraèním souboru:
d1775 8
a1782 2
Úvodní nastavení nesystémového démona se sestává z editace souboru <b>/etc/ppp/ppp.conf</b>. Tento soubor defaultnì neexistuje, ale je tu soubor <b>/etc/ppp/ppp.conf.sample</b> , který mù¾ete jednodu¹¹e zeditovat a vytvoøit tak vlastní <b>ppp.conf</b> . Zde zaèneme s nejjednodu¹¹ím a patrnì také nejèastìj¹ím nastavením. Zde je soubor <b>ppp.conf</b>, díky kterému se ppp spojí s va¹ím ISP a nastaví defaultní routy a nameserver. S tímto souborem potøebujete vìdìt jen informaci
o telefonním èísle va¹eho ISP, u¾ivatelském jménu a heslu.
d1796 11
a1806 9
Sekce uvedená slovem <b>default:</b> bude vykonána pøi ka¾dém spu¹tìní. Zde
nastavujeme v¹echny kritické informace. Slovem  &quot;set log&quot; nastavujeme
záznamovou úroveò. Je mo¾né to zmìnit, více manuálová stránka
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=ppp&sektion=8">ppp(8)</a>. Sériový port
se nastavuje pøíkazem &quot;set device&quot;. Toto je zaøízení, na kterém se
nachází modem. V na¹em  pøípadì je modem na portu 2. Proto com port 1 by byl
/dev/cua00. Slovem  &quot;set speed&quot; nastavujeme rychlost dialup spojení
a pomocí &quot;set dial&quot; nastavujeme parametry dialup-u. Pomocí nich
mù¾eme zmìnit ná¹ timeout atd. 
d1810 5
a1814 5
Nyní mù¾eme pokraèovat nastavením informací o na¹em ISP. Provedeme to pøidáním
nové sekce za sekci <b>default:</b> . Tato sekce se mù¾e jmenovat jakkoliv,
nejjednodu¹¹í je pou¾ít jméno va¹eho ISP. My pou¾ijeme oznaèení <b>myisp:</b> .
Následuje krátké a jednoduché nastavení, které poskytuje to nejnutnìj¹í pro
na¹e spojení.
d1830 8
a1837 5
Zde jsme nastavili  &quot;set phone&quot; telefonní èíslo na¹eho ISP,  &quot;set login&quot; volby pro pøihlá¹ení (timeout nastavený na 5 znamená, ¾e pøeru¹íme
pokus o pøihlá¹ení po pìti sekundách není-li na lince signál. Jinak budeme
èekat na zaslání na poslání øetìzce &quot;login:&quot; a pak po¹leme na¹e u¾ivatelské jméno a heslo. U nás to bude username=ppp a password=ppp. Tyto hodnoty
si zmìnte na va¹e vlastní. &quot;set timeout&quot; nastavuje timeout pro celý
pøihla¹ovací proces na 120 sekund. &quot;set ifaddr&quot; je ponìkud trikové.
d1846 14
a1859 6
V øádku nahoøe nastavujeme na¹i IP adresu ve formátu  &quot;<b>set ifaddr [myaddr[/nn] [hisaddr[/nn] [netmask
[triggeraddr]]]]</b>&quot;. Tedy první IP adresa na øádce specifikuje èíslo, které chceme obdr¾et od ISP jako na¹i IP adresu. Pokud máte statickou IP adresu,
nastavte ji zde. U nás pou¾ijeme /0 , co¾ øíká, ¾e ¾ádný z bitù ip adresy nemusí odpovídat a proto celá adresa mù¾e být nahrazena jinou (dynamicky pøiøazenou).
Druhá IP adresa je adresa, kterou oèekáváme jako IP adresu na¹eho ISP. Pokud
ji znáte, mù¾ete ji specifikovat. My opìt nevíme, co máme oèekávat, proto pou¾ijeme opìt /0 . Tøetí èíslo je na¹e sí»ová maska, zde nastavena na 255.255.255.0 . Pokud specifikujeme triggeraddr, je pou¾ita namísto myaddr v pùvodní IPCP komunikaci. Pøesto, pouze adresa v rozsahu myaddr bude akceptována. Toto je u¾iteèné
pøi komunikaci s nìkterými implementacemi PPP, které nedovolují pøiøadit IP adresu, pokud peer ¾ádá ``0.0.0.0''.
d1863 7
a1869 5
Dal¹í volba  &quot;add default HISADDR&quot; nastavuje defaultní routu na IP adresu providera. Dobré je, ¾e pokud se zmìní IP adresa providera za chodu, bude
va¹e routa automaticky upravena. Volbou  &quot;enable dns&quot; øíkáme na¹emu
ISP, aby nám sdìlil adresu nameserveru. Nepøidávejte tuto volbu, pokud u vás
bì¾í lokální DNS, proto¾e ppp lehce znemo¾ní její pou¾ívání tím, ¾e pøidá
nìkolik øádek do souboru /etc/resolv.conf.
d1875 2
a1876 2
Nyní máme základní nastavení v souboru <b>ppp.conf</b> pøipravené a mù¾eme
zaèít zou¹et spojení s na¹ím ISP. Obvyklé formy pøikazu jsou:
d1885 3
a1887 1
Spu¹tìní <b>/usr/sbin/ppp</b> bez voleb vás zavede do interaktivního módu. V nìm mù¾ete komunikovat pøímo s modemem, velmi vhodné pøi ladìní problémù ve va¹em  <b>ppp.conf</b> .
d1893 4
a1896 2
V nìkterých situacích mù¾ete chtít spustit dodateènì nìjaké pøíkazy, kdy¾ je
vytvoøeno nebo naopak zru¹eno spojení. Jsou zde dva soubory, které mù¾ete vytvoøit pro tyto situace. <b>/etc/ppp/ppp.linkup</b> a <b>/etc/ppp/ppp.linkdown</b>.
d1915 5
a1919 3
<H3>6.6.1 - Jak pøinutit jádro, aby dovolovalo vìt¹í poèet pokusù a del¹í timeout pro TCP spojení?</h3>
Normálnì byste to mìl vyu¾ít v pøípadì smìrovacích nebo spojovacích problémù.
Samozøejmì, nejefektivnìj¹í je, kdy¾ obì strany spojení pou¾ívají podobné hodnoty. 
d1931 10
a1940 6
Normálnì to nepotøebujete dìlat. Directed broadcast umo¾òuje komukoliv poslat 
pakety na veøejnou adresu va¹í pøipojené sítì, pokud pou¾íváte OpenBSD jako router.<p>
V nìkterých pøípadech uzavøených sítí mù¾e být directed broadcast u¾iteèný,
zejména pøi pou¾ívání starých iplementací NetBIOS protokolu. Pou¾ijte 
<Tt>sysctl -w net.inet.ip.directed-broadcast=1</tt> pro tuto vlastnost. Rovnou si ale
pøeètìte také èlánek o <a href="http://www.netscan.org">smurf útocích</a>,
d1946 3
a1948 1
Nastavení rezervovaných TCP portù, které by nemìly být dynamicky pøidìlovány jádrem. Seznam èísel tìchto portù mù¾e být oddìlen èárkami a/nebo mezerami.
d1963 3
a1965 1
<p> NFS, neboli Network File System, se pou¾ívá pro sdílení souborových systémù na síti. Dobré je, kdy¾ pøed pokusem o nastavení NFS serverù si pøeètete pár manuálových stránek:
d1976 15
a1990 14
Tato sekce vás provede základními kroky pro jednoduché nastavení NFS. 
V pøíkladì pøedpokládejme server na LAN, s klienty pøistupujícími na NFS 
na LAN. Nemluvíme zde o zabezpeèení NFS. Pøedpokládáme, ¾e jste ji¾ nastavili
filtrování paketù, nebo jinou firewallovou ochranu pro odepøení pøístupu zvenèí.
Pokud dovolujete vnìj¹í pøístup na vá¹ NFS server a máte na nìm nìjaká citlivá 
data, dùraznì doporuèujeme, abyste zprovoznil <a href="faq13.html">IPsec</a>.
 V opaèném pøípadì mohou cizí lidé potenciálnì vidìt va¹e  NFS spojení. Mù¾e 
to vést i k nìkterým útokùm. Pokud je IPsec protokol správnì nastaven, mù¾e 
vás od tohoto typu útokù ochránit. 
<p>
Jiná podstatná bezpeènostní poznámka. Nepøidávejte filesystém do /etc/exports
bez urèitého seznamu povolených strojù. Bez seznamu strojù, které mohou pøipojit
daný adesáø, mù¾e kdokoliv, kdo má spojení s va¹ím poèítaèem, pøipojit adresáøe,
které pøes NFS exportujete.
d1994 6
a1999 6
Nastavení obsahuje server s ip <b>10.0.0.1</b>, který slou¾í jako NFS server
pouze klientùm na této síti. První krok pøi nastavení NFS je nastavit soubor 
<i>/etc/exports</i> . Tento soubor obsahuje seznam filesystému, které chcete
zpøístupnit pøes NFS a definuje, komu je mù¾ete zpøístupnit. 
V <i>/etc/exports</i> mù¾ete pou¾ít spoustu voleb a nejlépe je pøeèíst si
manuálovou stránku 
d2013 18
a2030 14
To znamená, ¾e lokální filesystém  <b>/work</b> bude zpøístupnìn pøes NFS.
<b>-alldirs</b> øíká, ¾e klienti budou moci pøipojit kterýkoliv podadresáø
adresáøe <b>/work</b>. <b>-ro</b> øíká, ¾e pøipojit filesystém bude mo¾né jen
pro ètení. Poslední dva argumenty øíkají, ¾e pouze klienti v rozsahu sítì 10.0.0.0 s maskou 255.255.255.0 budu oprávnìni pøipojit filesystém. To je dùle¾ité
zejména pro sítì, které jsou pøistupné zvenku.
</p>

<p> Máte-li nastaven <i>/etc/exports</i>, mù¾ete pokraèovat v nastavení 
NFS serveru. Nejprve se ujistìte, ¾e máte zkompilované jádro s volbami NFSSERVER a NFSCLIENT (jádra GENERIC jsou ok).
Dále nastavte v <i>/etc/rc.conf</i> <strong>nfs_server=YES</strong> . Tím spustíte nfsd(8) i mountd(8) po rebootování.
Pro zaèátek mù¾ete spustit démony ruènì. Musíte je spustit jako root a potøebujete se ujistit, ¾e vám na systému bì¾í
portmap(8). Pøíklad jak spustit nfsd(8),
který pracuje jak na TCP tak na UDP ve 4 instancích. Mìli byste nastavit maximální poèet klientù
se ¾ádostí o spojení na slu¾bu NFS.
d2039 3
a2041 3
Nestaèí pustit jen nfsd(8) server, musíte spustit i mountd(8). Jedná se o démona,
který vlastnì obsluhuje ¾ádosti o NFS spojení. Ujistìte se. ¾e existuje prázdný
soubor mountdtab, a spus»te daemona: 
d2050 2
a2051 2
Pokud udìláte zmìny v /etc/exports poté co u¾ NFS bì¾í, musíte na to mountd
upozornit! Takhle:
d2062 2
a2063 2
Nyní se mù¾ete podívat a ujistit se, ¾e démoni bì¾í a jsou registrováni s RPC.
Pou¾ijte procinfo(8).
d2081 2
a2082 2
<p>V normálním provozu máte k dispozici dal¹í utility, které vám dovolují 
sledovat co se dìje na NFS. Jedna z nich je 
d2084 3
a2086 3
která umo¾òuje sledovat co je právì pøipojeno a kdo to pøipojil. Dále také 
nfsstat(8) s podrobnìj¹ím výpisem. Pou¾ití pøíkazu showmount(8): zkuste 
<b>/usr/bin/showmount -a host</b>. Napøíklad:
d2101 3
a2103 2
Pro pøipojení filesystému /work na stroji 10.0.0.1 na lokální filesystém /mnt,
udìlejte toto: (pozn. nepotøebujete pou¾ívat ip adresy, mount resolvuje jména):
d2120 4
a2123 3
Je dùle¾ité pou¾ít <tt>0 0</tt> na konci øádky, jinak bude vá¹ poèítaè pou¹tìt fsck na NFS filesystém pøi startu!!!!
Jiné standardní security volby jsou noexec, nodev, a nosuid ta poslední by mìla
být pou¾ita kde jen to je mo¾né. Napø.:
d2131 3
a2133 1
Diky tomu nebudou moci ¾ádné suid bit binárky na NFS serveru podlomit bezpeènost na NFS klientovi. Pokud nepøipojujete programy, které by mìly bì¾et na klientovi, pøidejte noexec.
d2144 7
a2150 3
Domain Name Service je sí»ová slu¾ba zprostøedkující sí»ovým doménám na bázi IP
pøeklad sí»ových IP adres na jména a jména strojù na sí»ové adresy. va¹e instalace OpenBSD je nastavena defaultnì jako DNS klient, ne jako DNS server. Tj. va¹e instalace OpenBSD mù¾e dávat DNS serverùm DNS dotazy, ale nemù¾e sama odpovídat
na DNS dotazy , pokud není speciálnì nastavena. Tu je info jak na to.</p>
d2169 3
a2171 3
<b>165.87.201.244</b> je nameserver , který odpovìdìl, je to nameserver, který
mùj ISP doporuèuje, abych ho pou¾íval v rámci svého úètu a toto èíslo je
ulo¾eno v 
d2236 2
a2237 2
je u¾iteèný tím, ¾e vrací informaci o doménì ve stejném formátu, jaký je nutný
pro konfiguraèní soubory BINDu. Mù¾ete pou¾ít
d2239 2
a2240 2
pro prozkoumání nameserverù, které pracují správnì, abyste mohli porovnat jejich
nastavení s va¹ím.
d2247 3
a2249 3
nekonfigurujte ho tak. Instalace OpenBSD defaultnì neaktivuje stroj jako domain
name server, aèkoliv v¹echny potøebné soubory jsou instalovány. Pro vìt¹inu
poèítaèù je dostaèující soubor
d2251 1
a2251 1
 s názvy lokálních strojù a jejich IP adresami a soubor
d2253 2
a2254 1
který udává adresy DNS serverù, pou¾ívaných vámi na internetu nebo intranetu.
d2258 2
a2259 2
Na druhou stranu mù¾e být ve va¹em pøípadì potøeba nastavit stroj jako domain
name server:
d2261 21
a2281 17
<li>Pokud máte IP LAN a nechcete replikovat "hosts" soubory lokálních adres
stroj od stroje. V takovém pøípadì byste mohli konfigurovat OpenBSD jako
DNS server a odpovídat na DNS dotazy strojù z va¹í LAN.</li>
<ul>
<li><b>Poznámka:</b> Neexistuje praktické omezení poètu DNS serverù na LAN.
¾ádný nebo naopak v¹echny poèítaèe na LAN mohou nabízet DNS service, pokud
jsou tak konfigurovány. Zda je ten který server pova¾ován za autoritativní
zvenku va¹í LAN (nebo je vùbec znám venkovním sítím) je vlastnost konfigurace,
která je vìt¹inou kontrolována na vy¹¹í úrovni doménové hierarchie.</li>
</ul>
<li>Pokud máte IP LAN, na které se nacházejí poèítaèe, které byste chtìli mít
dostupné z hlediska DNS dotazù, ze strojù z jiných IP LAN nebo WAN.</li>
<li>Pokud máte potí¾e s pøevodem názvu stroje na IP adresu nebo s pøevodem
lokálních názvù na IP adresy, pøesto¾e máte správnì nastaven obsah souborù
<i>/etc/hosts</i> a <i>/etc/resolv.conf</i> (Napø. Netscape na OpenBSD obèas
vykazuje podobné problémy, proto¾e implementuje vlastní resolver místo pou¾ití
funkce <i>gethostbyname(3)</i> pro kladení DNS dotazù.))</li>
d2287 6
a2292 6
nameserverùm na dotazy ohlednì adres jiných domén, pøeklad jmen mù¾e trvat
ponìkud déle, pokud máte modemové spojení s Internetem a dotazujete se
vlastního DNS serveru na adresy vzdálených poèítaèù (který se pak bude
opakovanì dotazovat vzdálených name serverù pomocí modemu), ne¾ pokud
 se dotazujete name serveru va¹eho ISP (který
má zøejmì rychlej¹í spojení se vzdálenými name servery).
d2305 2
a2306 2
BIND je oznaèení implementaci DNS. Komponenty domain name serveru spoleènì implementují BIND.
</p>
d2319 2
a2320 1
<h4>6.8.3.2 Jaké jsou nìkteré mo¾nosti provozování DNS prostøednictvím defaultní implementace BIND 4.x?</h4>
d2323 2
a2324 1
<li>Iplementace BIND 9.x v <i>/usr/ports/net/bind9</i>.(Viz. <a href="../../cs/ports.html">ports</a>)
d2330 8
a2337 2
Pokud pou¾íváte tyto alternativní implementace domain name slu¾by, provozujete kritickou sí»ovou slu¾bu za pou¾ití softwaru, který nebyl pøedmìtem bezpeènostního auditu jako <a href="http://www.openbsd.org/security.html">auditovaný</a> <b>named</b> name daemon v základní instalaci. Toto je zapotøební zvá¾it, ponìvad¾
v pøípadì bezpeènostního naru¹ení domain name serveru mohou být resolvery pou¾ívající tento name server pøesmìrovány na cizí místa.
d2343 3
a2345 1
Pokud bylo nále¾itì nainstalováno pùvodní sí»ové nastavení pøi instalaci OpenBSD, pak je u¾ v¹echno vlastnì instalováno. Musíte je¹tì nastavit name daemona ("<tt>named</tt>").
d2351 6
a2356 3
Konfigurace se sestává na OpenBSD z editace nebo vytvoøení souborù, které øídí
name daemona <tt>named</tt>. Tyto soubory se nacházejí pùvodnì v adresáøi <i>/var/named</i> a v jeho podadresáøích, obzvlá¹tì soubor  <i>/var/named/named.boot</i>, co¾ je inicializaèní soubor pro <b>named</b>. Je tu rovnì¾ nìkolik dal¹ích
krokù konfigurace, které se nacházejí v <i>/etc</i>.
d2360 6
a2365 1
V tomto dokumentu budeme konfigurovat name daemona na <i>nemo.yewtopia.com</i> jako primární nameserver pro (velmi malou!!!) doménu <i>yewtopia.com</i>. Adresa i>nemo.yewtopia.com</i> je <i>192.168.1.9</i>. Dva jiné poèítaèe <i>crater.yewtopia.com </i> na 192.168.1.1 a <i>earhart.yewtopia.com</i> na 192.168.1.2 se nacházejí v její podsíti.
d2386 2
a2387 2
Obsah souboru øíká inicializaèními procesu, ve kterém podadresáøi a pod kterými
jmény se nacházejí konfiguraèní soubory pro <i>yewtopia.com</i>.
d2458 3
a2460 1
Pokud jste døíve pøidali adresy rùzných strojù do souboru <i>/etc/hosts</i>, mù¾ete zvá¾it zkrácení souboru <i>/etc/hosts</i> do pùvodního stavu:
d2470 5
a2474 4
Takto není <b>named</b> obcházen v pøípadì (mo¾ná zastaralých) adres v souboru
<i>/etc/hosts</i>. <u>Ujistìte se, ¾e máte pøinejmen¹ím v tomto souboru polo¾ku <i>localhost</i> </u>
jinak se va¹e sí» správnì nenastaví! V¹imnìte si také, ¾e
<i>nemo</i> se mustí objevit ve vlastním hosts souboru, jinak uvidíte (vìt¹inou málo nebezpeènou) 
d2549 3
a2551 1
Ruèní spu¹tìní <b>named</b>: pou¾ijte pøíkaz <a href="http://www.openbsd.org/cgi-bin/man.cgi?query=ndc&sektion=8">ndc(8)</a>. Napøíklad:
d2563 2
a2564 1
Nejlep¹í zpùsob jak zastavit démona je pou¾ít pøíkaz <a href="http://www.openbsd.org/cgi-bin/man.cgi?query=ndc&sektion=8">ndc(8)</a>. Napøíklad:
d2572 4
a2575 1
Pokud toto nefunguje, najdìte proces id procesu named a pou¾ijte <a href="http://www.openbsd.org/cgi-bin/man.cgi?query=kill&sektion=1">kill(1)</a> pro ukonèení procesu. PID of <b>named</b>, pokud bì¾í, mù¾ete najít v první øádce souboru <i>/var/named/named.pid</i>
d2588 2
a2589 2
Chcete-li, aby bì¾ící instance déman named restartovala sama sebe, s naètením
nové konfigurace, za¹lete procesu signál "hangup":
d2597 3
a2599 1
nebo pou¾ijte pøíkaz <a href="http://www.openbsd.org/cgi-bin/man.cgi?query=ndc&sektion=8">ndc(8)</a>. Napø.:
d2621 4
a2624 2
Tato informace je u¾iteèná pri ladìní DNS, ale v nìkterých pøípadech nemusí být vhodné nabízet tento výstup veøejnì.
Pokud pou¾íváte classless in-addr(rfc2317) jako reverz, host -l bude informovat o ka¾dé doménì, která se nachází ve va¹em systému! Zákazu zónových transferù 
d2627 2
a2628 2
Pokud pou¾íváte Bind8, mù¾ete specifikovat poèítaèe, kterým dovolíte zónové
transfery zón ve va¹ich zónových souborech:
d2640 2
a2641 1
Mù¾ete také zablokovat transfery V¹ech domén editováním souboru /var/named.conf a pøidáním parametru 'allow-transfer' do sekce options:
d2648 2
a2649 1
Pokud pou¾íváte Bind 4 (default v OpenBSD) mù¾ete editovat /var/named/named.boot a pou¾ít volbu 'xfrnets'.<br>
d2658 4
a2661 2
Typicky jediné stroje, které potøebují vykonávat DNS transfery jsou va¹i DNS slaves a stroje, ze kterých chcete DNS debugovat (127.0.0.1 je vìt¹inou dobrá volba, u které dovolit transferu!)
Blokování AXFR dotazù pøidává dal¹í úroveò soukromí, ale mù¾e znemo¾nit debugování DNS. 
d2666 5
a2670 1
Je zde toho mnoho, napøíklad, jak nastavit DNS, aby dotazy na intranetové domény, které nejsou viditelné z koøene doménové hierarchie byly pøevádìny na servery v rámci va¹í spoleènosti. Radìji si pøeètìte <a href="#DNS.1.1">Dokumenty které doporuèujeme</a> , kde najdete více informací o DNS.
d2678 4
a2681 1
<strong>POZNÁMKA:</strong> Informace se nevztahují ke  <strong>V©EM</strong> ADSL providerùm, ale mnoho informací mù¾e být pøevzato z tohoto nastavení. O nìm je známo, ¾e funguje pro ADS providera v Rakousku <a href="http://www.inode.at">Inode</a>. 
d2737 2
a2738 2
Soubor <i>/etc/ppp/options</i> s následujícím nastavením bude dìlat pravdìpodobnì co potøebujete:
</p>
d2762 3
a2764 1
Kde LOGINNAME je va¹e User-ID a PASSWORD je va¹e heslo. 10.0.0.138 je IP pøiøazené va¹emu MODEMu v pøípadì ¾e pou¾íváte ADSL, atd. Ujistìte se, ¾e soubor mù¾e èíst pouze u¾ivatel root (mód 600).
d2770 5
a2774 4
V pøedcházejícím pøípadì mìl ná¹ modem pøedkonfigurované rozhraní na 10.0.0.138.
Nyní potøebujeme pøiøadit adresu  NA©EMU rozhraní. Nejlépe je vybrat si jedno
IP blízko tomu, které vám bylo pøiøazeno va¹ím modemem, nebo pou¾ít statické IP,
které vám pøiøadili. Více si pøeètìte v <a href="#Setup">FAQ 6, Úvodní nastavení sítì</a>.
d2778 2
a2779 1
Poté co nastavíte interfejsy, mìli byste být schopni vytvoøit pptp spojení pøíkazem.
d2786 2
a2787 1
Proto¾e pou¾íváme do OpenBSD zaèlenìné ppp(8), jsou nastartovány dva procesy. Mù¾ete zastavit pptp ukonèením obou procesù:
d2795 2
a2796 1
Doporuèujeme otevøít si  <tt>/var/log/messages</tt> v oddìleném terminálovém oknì, abyste rozpoznali mo¾né problémy.
d2805 2
a2806 1
Rovnì¾ si pøidejte startovací pøíkaz do <i>/etc/rc.local</i> abyste se mohli automaticky spojit pøi restartu.
d2810 99
d2910 65
d2988 1
a2988 1
Originally [OpenBSD: faq6.html,v 1.143 ]
d2990 1
a2990 1
$Translation: faq6.html,v 1.10 2002/08/18 20:54:56 certik Exp $
d2992 1
a2992 1
$OpenBSD$
@


1.9
log
@
sync with badlands translation CVS.
@
text
@d4 1
a4 1
<title>6.0 - Networking</title>
d10 1
a10 1
<meta name= "copyright"     content= "This document copyright 1998-2001 by OpenBSD.">
d13 1
a13 1
<body bgcolor= "#ffffff" text= "#000000" link= "#23238E">
d22 10
a31 10
<li><A href= "#6.0.1">6.0.1 - Pøedtím ne¾ pùjdeme dále</a>
<li><a href= "#6.1">6.1 - Úvodní nastavení sítì</a>
<li><a href= "#6.2">6.2 - Packet Filter (PF)</a>
<li><a href= "#6.3">6.3 - Pøeklad sí»ových adres (NAT) </a>
<li><a href= "#6.4">6.4 - Dynamic Host Configuration Protocol (DHCP)</a>
<li><a href= "#6.5">6.5 - Point to Point Protokol</a>
<li><A href= "#6.6">6.6 - Zlep¹ování výkonu sítì</a>
<li><a href= "#6.7">6.7 - Pou¾ívání NFS</a>
<li><a href= "#6.8">6.8 - Domain Name Service  - DNS, BIND a named</a>
<li><a href= "#6.9">6.9 - Nastavení PPTP spojení v OpenBSD</a>
d38 1
d42 4
a45 2
Na úvod pøedpokládáme, ¾e ètenáø pøeèetl a alespoò èásteènì chápe sekci <a href="faq5.html">Konfigurace jádra</a> tìchto FAQ, stejnì jako manuálové stránky
pøíkazù <a href= "http://www.openbsd.org/cgi-bin/man.cgi?query=ifconfig&apropos=0&sektion=8">
d47 2
a48 2
<a href= "http://www.openbsd.org/cgi-bin/man.cgi?query=netstat&apropos=0&sektion=1">
netstat(1)</a> .
d50 8
a57 3
Pokud jste administrátor sítì a nastavujete smìrovací protokoly, pokud pou¾íváte OpenBSD box jako router, pokud chcete hloubìji poznat princip fungovaní sítì
s IP protokolem, pak byste si rozhodnì mìli pøeèíst <a href="http://www.3com.com/solutions/en_US/ncs/501302.html">V¹e co potøebujete vìdìt o IP adresování</a>.
Jedná se skuteènì o vynikající dokument, který obsahuje zcela nepostradatelné informace pro práci se sítìmi na bázi IP protokolu, obzvlá¹tì pokud pokud máte co doèinìní nebo zodpovídáte za více ne¾ jednu sí».
d60 2
a61 1
mù¾ete najít mnoho cenných informací <a href="http://the.rfceditor.org/rfc.html">ètením RFC dokumentù</a>.
d67 1
d72 1
d85 2
a86 2
Napøíklad zde je výstup z pøíkazu dmesg pro sí»ovou kartu ne2000, které
odpovídá název zaøízení ne.
d90 2
a91 2
ne3 at pcmcia1 function 0 "Linksys, EtherFast 10/100 PC Card (PCMPC100), " port 0x340/16 irq 9
ne3: address 00:e0:98:04:95:ba
d95 6
a100 44
Pokud nevíte, jaké jméno v systému odpovídá va¹í kartì, zde je seznam bì¾ných
typù karet a odpovídajících názvù zaøízení.
<ul>
<li> sí»ové karty ne2000 - <a href="http://www.openbsd.org/cgi-bin/man.cgi?query=ne&sektion=4">ne</a>
<li>3Com EtherLink III a Fast EtherLink III Ethernet - <a href="http://www.openbsd.org/cgi-bin/man.cgi?query=ep&sektion=4">ep</a>
<li>3Com EtherLink XL a Fast EtherLink XL Ethernet (3C9xx) - <a href="http://www.openbsd.org/cgi-bin/man.cgi?query=xl&sektion=4">xl</a>
<li>Intel 82586 chip Ethernet device driver - <a href="http://www.openbsd.org/cgi-bin/man.cgi?query=ie&sektion=4">ie</a>
<ul>Který zahrnuje karty jako:
  <li>3Com 3C507
  <li>AT&amp;T StarLAN 10
  <li>AT&amp;T EN100
  <li>AT&amp;T StarLan Fiber
  <li>Intel EtherExpress 16
</ul>
<li>DEC/Intel 21142/3 a clone 10/100 Ethernet driver - <a href="http://www.openbsd.org/cgi-bin/man.cgi?query=dc&sektion=4">dc</a>
<ul><FONT SIZE="-1"> <b>Pozn:</b> Nìkteré drivery, které byly v OpenBSD 2.6, jako napø.
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=mx&sektion=4&manpath=OpenBSD+2.6">mx</a>,
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=ax&sektion=4&manpath=OpenBSD+2.6">ax</a>, al a
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=pn&sektion=4&manpath=OpenBSD+2.6">pn</a>
byly nahrazeny tímto driverem.</font><BR>
Který zahrnuje rovnì¾ karty jako:
  <li>Intel 21142/21143 (døíve vyrábìnými firmou DEC)
  <li>Macronix 98713, 98713A, 98715, 98715A and 98725
  <li>Davicom DM9100 a DM9102
  <li>ASIX Electronics AX88140A a AX88141
  <li>ADMtek AL981 Comet a AN985 Centaur
  <li>Lite-On 82c168 a 82c169 PNIC
  <li>Lite-On/Macronix 82c115 PNIC II
<p>
Pokud upgradujete na OpenBSD 2.7 ze star¹í verze OpenBSD, musíte zde dávat
vìt¹í pozor.
Jakékoliv odkazy v souborech <em>/etc/ifaliases</em>,
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=pf.conf&sektion=5">/etc/pf.conf(5)</a>,
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=nat.conf&sektion=5">/etc/nat.conf(5)</a>
na staré názvy zaøízení jako mx, al, ax nebo pn musí být nahrazeny za dc.
Stejnì tak v¹echny soubory s názvem 
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=hostname.if&sektion=5">hostname.xxx</a>
se starým názvem zaøízení musí
být pøejmenovány na <em>hostname.dcX</em>, aby byly akceptovány. 'X' nahraïte èíslem
va¹eho zaøízení.
</ul>
<li>Lucent Technologies WaveLAN/IEEE 802.11DS - <a href="http://www.openbsd.org/cgi-bin/man.cgi?query=wi&sektion=4">wi</a>
<li>Aironet Communications 4500/4800 IEEE 802.11DS - <a href="http://www.openbsd.org/cgi-bin/man.cgi?query=an&sektion=4">an</a>
</ul>
d103 6
a108 3
Znovu pøipomeòme, ¾e chcete-li zjistit, která zaøízení byla identifikována,
mù¾ete pou¾ít pøíkaz <a href="http://www.openbsd.org/cgi-bin/man.cgi?query=ifconfig&sektion=8">ifconfig(8)</a>. Zde je jeho výstup zobrazující  
zaøízení ne2k.
d113 8
a120 5
lo0: flags=8009&lt;UP,LOOPBACK,MULTICAST&gt;
        inet 127.0.0.1 netmask 0xff000000
lo1: flags=8008&lt;LOOPBACK,MULTICAST&gt;
ne3: flags=8863&lt;UP,BROADCAST,NOTRAILERS,RUNNING,SIMPLEX,MULTICAST&gt;
        media: Ethernet manual
d122 19
a140 9
sl0: flags=c010&lt;POINTOPOINT,LINK2,MULTICAST&gt;
sl1: flags=c010&lt;POINTOPOINT,LINK2,MULTICAST&gt;
ppp0: flags=8010&lt;POINTOPOINT,MULTICAST&gt;
ppp1: flags=8010&lt;POINTOPOINT,MULTICAST&gt;
tun0: flags=10&lt;POINTOPOINT&gt;
tun1: flags=10&lt;POINTOPOINT&gt;
enc0: flags=0&lt;&gt;
bridge0: flags=0&lt;&gt;
bridge1: flags=0&lt;&gt;
d145 1
a145 1
dává více informací, ne¾ v této fázi potøebujeme. Umo¾òuje nám ale vidìt na¹e
d149 1
a149 3
pomocí pøíznakù <strong>UP</strong> a <strong>RUNNING</strong> . Také jste
si urèitì v¹imli mnoha dal¹ích zaøízení. Zde je seznam zaøízení, které byste
zde mìli nalézt.
d151 3
a153 1

d155 2
a156 1
<li><a href="http://www.openbsd.org/cgi-bin/man.cgi?query=lo&sektion-4">lo</a> - Loopback Interface
d158 1
a158 1
<li>ppp - Point to Point Protocol
d161 4
a164 1
<li><a href="http://www.openbsd.org/cgi-bin/man.cgi?query=bridge&sektion=4">bridge</a> - Ethernet bridge interface
d169 2
a170 2
<strong>/etc/hostname.${IF}</strong> .
Kde jméno zaøízení se nachází na místì ${IF}. V pøedcházejícím pøíkladì by
d172 1
a172 2
je následující:<br>
(Více informací o formátu tohoto souboru najdete v manuálové stránce <a href="http://www.openbsd.org/cgi-bin/man.cgi?query=hostname.if&sektion=5">hostname.if(5)</a>.)
d176 1
a176 1
[address_family] [va¹e_ip] [va¹e_sí»ová_maska] [media options]
d179 4
d184 2
a185 1
Pro pøedcházející pøíklad by tento soubor vypadal následovnì:
d189 1
a189 1
$ <strong>cat /etc/hostname.ne3</strong>
d194 23
d218 1
a218 1
umístíte do souboru s názvem <strong>/etc/mygate</strong>. Tak umo¾òíte, aby
d222 7
a228 3
Nastavení nameserverù spoèívá mmj. ve vytvoøení souboru s názvem <strong>/etc/resolv.conf</strong>. Více informací o formátu tohoto souboru naleznete v manuálové stránce <a href="http://www.openbsd.org/cgi-bin/man.cgi?query=resolv.conf&sektion=5">resolv.conf(5)</a>. Pro standardní pou¾ití zde je pøíklad
takového souboru. V tomto pøíkladu pøedpokládejme, ¾e adresy va¹ich nameserverù
jsou  125.2.3.4 a 125.2.3.5. Patøíte rovnì¾ do domény &quot;yourdomain.com&quot;.
d253 5
a257 2
V¹imnìte si, ¾e do¹lo k nìkolika chybám, ale ty se týkají jen zaøízení loopback,
tak¾e je mù¾eme ignorovat. Nyní by vá¹ sí»ový subsystém mìl být správnì nastaven
d273 1
a273 1
default            10.0.0.1           UGS         0       86      -  ne3
d276 2
a277 2
10.0.0/24          link#1             UC          0        0      -  ne3
10.0.0.1           aa:0:4:0:81:d      UHL         1        0      -  ne3
d299 1
d317 2
a318 2
Jádro kompilované jako GENERIC má ji¾ v sobì podporu IP Forwardingu, která musí
být v tomto pøípadì zapnutá. Mù¾ete tak uèinit pomocí pøíkazu  
d342 3
a344 2
Nyní zmìòte routovací tabulky na jiných strojích. Je mnoho zpùsobù pou¾ití OpenBSD jako router, pomocí softwaru
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=routed&apropos=0&sektion=8&format=html">routed(8)</a>,
d346 2
a347 2
<a href="http://www.mrtd.net">mrtd</a>, a <A href="http://www.zebra.org">zebra</a>.
OpenBSD podporuje porty v ports tree jak gated, tak mrtd.
d353 1
a357 2
<strong>Poèínaje OpenBSD 2.8, <i>/etc/ifaliases</i> se u¾ dále nepou¾ívá!</strong>

d361 1
a361 1
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=hostname.if&sektion=5&format=html"><i>/etc/hostname.&lt;if&gt;</i></a>.
d364 1
a364 1
který je souèástí <a href="faq10.html#10.3">rc startup hierarchy</a>. 
d375 14
a388 7
Nìkolik poznámek o aliasech. V OpenBSD pou¾íváte pouze název zaøízení. Není tady rozdíl mezi prvním aliasem nebo druhým aliasem. Narozdíl od nìkterých operaèních systémù, OpenBSD se na nì neodkazuje jako dc0:0, dc0:1. Pokud se odkazujete
na urèitou aliasovanou IP adresu pomocí ifconfig, nebo pøidáváte alias, ujistìte se, ¾e pí¹ete "<tt>ifconfig interface alias</tt>" namísto  "<tt>ifconfig interface</tt>". Smazat alias mù¾ete pomocí "<tt>ifconfig interface delete</tt>".
<p>
Pøedpokládejme, ¾e pou¾íváte více IP adres, které jsou na stejné podsíti, a pou¾íváte k tomu aliasy. va¹e sí»ová maska pro ka¾dý alias má automaticky hodnotu
255.255.255.255. Není nutné, aby sí»ové masky aliasù následovaly sí»ovou masku
prvního IP spojeného s tímto zaøízením. V následujícím pøíkladì <i>/etc/hostname.dc0</i> jsou pøidány dva aliasy pro zaøízení dc0, které mimo jiné bylo nastaveno
jako 192.168.0.2 netmask 255.255.255.0.
a391 1
$ <b>cat /etc/hostname.dc0</b>
d393 2
a394 19
dc0 192.168.0.3 255.255.255.255
dc0 192.168.0.4 255.255.255.255
</ul></pre>
<p>
Ve v¹ech tìchto pøíkladech je pou¾itá maska taková, aby se zabránilo vytvoøení
duplicitní routovací tabulky pro stejnou sí».


<p>
<b>Poznámka:</b><br>

Poèínaje OpenBSD 2.7, mù¾ete nastavit aliasy v souboru <a href="http://www.openbsd.org/cgi-bin/man.cgi?query=hostname.if&sektion=5"><i>/etc/hostname.*</i></a>. Pro provedení stejného nastavení jako v pøedcházejícím pøíkladì, byste vytvoøili následující soubor  <i>/etc/hostname.dc0</i> :
</p>


<ul><pre>
inet 192.168.0.2 255.255.255.0 media 100baseTX
inet alias 192.168.0.3 255.255.255.255 NONE
inet alias 192.168.0.4 255.255.255.255 NONE
a396 1

d398 4
a401 2
Poté co jste vytvoøili tento soubor, budete muset rebootovat, aby se zmìny nastavení promítly. Nebo mù¾ete nastavit aliasy ruènì pomocí <a href="http://www.openbsd.org/cgi-bin/man.cgi?query=ifconfig&sektion=8">ifconfig(8)</a>.
 Nastavení prvního aliasu by se provedlo takto:
d422 1
a422 1
<a name= "PacketFilter"></a>
d460 1
a460 1
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=pfctl&sektion=8">pfctl(8)</a>.
d489 2
a490 2
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=pf.conf&sektion=5">pf.conf(5)</a>
a <a href="http://www.openbsd.org/cgi-bin/man.cgi?query=nat.conf&sektion=5">nat.conf(5)</a>.
d508 1
a508 1
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=pf.conf&sektion=5">pf.conf(5)</a>. 
d560 1
a560 1
block in on fxp0 inet proto tcp from any to any port = 3306
d571 3
a573 2
&quot;pass in&quot; pravidlo a potom bude odhozen díky pravidlu &quot;block in port = 3306&quot;. Pokud zmìníte poøadí va¹ich pravidel (vzpomeòte si, poøadí
je dùle¾ité):
d577 1
a577 1
block in on fxp0 inet proto tcp from any to any port = 3306
d594 1
a594 1
block in quick on fxp0 inet proto tcp from any to any port = 3306
d599 4
a602 2
Paket urèený pro ná¹ poèítaè na port 3306 bude zpracován bezprostøednì pravidlem&quot;block in quick&quot; a bude odhozen. V¹echny pakety urèené pro jiné porty
nenajdou odpovídající pravidlo, dokud nedosáhnou pravidla &quot;pass in&quot;, které jim dovolí projít.
d619 5
a623 5
pass in quick on fxp0 inet proto tcp from any to any port = 22
pass in quick on fxp0 inet proto tcp from any to any port = 80
pass in quick on fxp0 inet proto tcp from any to any port = 443
block in quick on fxp0 from any to any
pass out on fxp0 from any to any
d635 5
a639 5
pass in quick on fxp0 inet proto tcp from 1.1.1.0/24 to any port = 22
pass in quick on fxp0 inet proto tcp from any to any port = 80
pass in quick on fxp0 inet proto tcp from any to any port = 443
block in quick on fxp0 from any to any
pass out on fxp0 from any to any
d647 1
a647 1
pass in quick on fxp0 inet proto tcp from 1.1.1.0/24 to any port = 22
d651 1
a651 1
pass in quick on fxp0 inet proto tcp from 1.1.1.1/32 to any port = 22
d661 4
a664 8
block in quick on fxp0 inet from 127.0.0.0/8 to any
block in quick on fxp0 inet from 192.168.0.0/16 to any
block in quick on fxp0 inet from 172.16.0.0/12 to any
block in quick on fxp0 inet from 10.0.0.0/8 to any
block out quick on fxp0 inet from any to 127.0.0.1/8
block out quick on fxp0 inet from any to 192.168.0.0/16
block out quick on fxp0 inet from any to 172.16.0.0/12
block out quick on fxp0 inet from any to 10.0.0.0/8
d672 4
a675 8
block in quick on fxp0 inet from 127.0.0.0/8 to any
block in quick on fxp0 inet from 192.168.0.0/16 to any
block in quick on fxp0 inet from 172.16.0.0/12 to any
block in quick on fxp0 inet from 10.0.0.0/8 to any
block out quick on fxp0 inet from any to 127.0.0.1/8
block out quick on fxp0 inet from any to 192.168.0.0/16
block out quick on fxp0 inet from any to 172.16.0.0/12
block out quick on fxp0 inet from any to 10.0.0.0/8
d678 1
a678 1
pass in quick on fxp0 inet proto tcp from 1.1.1.1/32 to any port = 22
d681 2
a682 2
pass in quick on fxp0 inet proto tcp from any to any port = 80
pass in quick on fxp0 inet proto tcp from any to any port = 443
d698 2
a699 2
pass in quick on fxp0 inet proto tcp from 1.1.1.1/32 to any port = 22
block in log quick on fxp0 inet proto tcp from any to any port = 22
d706 1
a706 1
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=pflogd&sektion=8">pflogd(8)</a>,
d708 1
a708 1
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=tcpdump&sektion=8">tcpdump(8)</a>.
d733 5
a737 7
<!-- FIXME -->
Pøi zkoumání logù byste mìli být obzvlá¹tì opatrní pøi
verbose protocol decoding (aktivovaném volbou -v na pøíkazové øádce).
Historie bezpeènosti tcpdump's protocol decoders není úplnì perfektní.
At least in theory, a delayed attack could be
possible via the partial packet payloads recorded by the logging
device.
d758 1
a758 1
pass in quick on fxp0 inet proto { tcp, udp } from any to any port = 53
d763 2
a764 2
pass in quick on fxp0 inet proto tcp from any to any port = 53
pass in quick on fxp0 inet proto udp from any to any port = 53
d773 8
a780 3
Proto¾e nìkteré operaèní systémy a aplikace mívají problémy s abnormálními nebo
fragmentovanými pakety, je nìkdy pøínosné normalizovat pakety pøedtím, ne¾ jsou
propu¹tìny na své koneèné místo urèení. To je mo¾né provést volbou <b>scrub</b>,
d785 3
a787 3
Vzhledem k tomu, ¾e to zpùsobuje dal¹í zatí¾ení systému, není dùvod pou¾ívat
tento pøíkaz, pokud ná¹ systém nechrání poèítaè s mizernou implementací
TCP/IP.
d799 1
a799 1
pass in quick on fxp0 allow-opts
d839 1
a839 1
 &quot;pass out&quot; mù¾eme automaticky dovolit spojení, která pøicházejí
d841 1
a841 1
Pamatujte si, ¾e potøebujeme specifikovat protokol pro který udr¾ujeme stav.
d844 5
a848 5
pass in quick on fxp0 inet proto tcp from 1.1.1.0/24 to any port = 22
pass in quick on fxp0 from any to any port = 80
pass in quick on fxp0 from any to any port = 443
block in quick on fxp0 from any to any
pass out on fxp0 inet proto tcp from any to any keep state
d851 2
a852 2
Tato malá zmìna dramaticky zvy¹uje flexibilitu a bezpeènost na¹í sady pravidel
. Napøíklad, v pøecházejícím pøíkladì umo¾òujeme tcp spojení na port 80 a 443.
d857 15
a871 10
dovolit pakety pouze s nastavenými flagy SYN a SYN/ACK. Propu¹tìním paketù
pouze s pøíznaky SYN a SYNACK se ubráníme mnoha formám port skenù jako je
napøíklad
FIN skenování. Pravidla nyní vypadají takto:
<ul><pre>
pass in quick on fxp0 inet proto tcp from 1.1.1.0/24 to any port = 22
pass in quick on fxp0 inet proto tcp from any to any port = 80 flags S/SA
pass in quick on fxp0 inet proto tcp from any to any port = 443 flags S/SA
block in quick on fxp0 from any to any
pass out on fxp0 proto tcp from any to any keep state
d888 4
a891 8
block in quick on fxp0 inet from 127.0.0.0/8 to any
block in quick on fxp0 inet from 192.168.0.0/16 to any
block in quick on fxp0 inet from 172.16.0.0/12 to any
block in quick on fxp0 inet from 10.0.0.0/8 to any
block out quick on fxp0 inet from any to 127.0.0.1/8
block out quick on fxp0 inet from any to 192.168.0.0/16
block out quick on fxp0 inet from any to 172.16.0.0/12
block out quick on fxp0 inet from any to 10.0.0.0/8
d893 3
a895 2
# only allow our machines to connect via ssh
pass in quick on fxp0 inet proto tcp from 1.1.1.0/24 to any port = 22
d898 4
a901 2
pass in quick on fxp0 inet proto tcp from any to any port = 80 flags S/SA
pass in quick on fxp0 inet proto tcp from any to any port = 443 flags S/SA
d903 7
a909 2
# finally lock the rest down with a default deny
block in quick on fxp0 from any to any
a910 2
# and let out-going traffic out and maintain state on established connections
pass out on fxp0 from any to any keep state
a926 6
Normálnì byste museli udìlat nìco jako toto: 
<ul><pre>
pass in quick on fxp0 inet proto tcp from any to any port = 53
pass in quick on fxp0 inet proto udp from any to any port = 53
</pre></ul>
ale místo toho to mù¾ete pomocí mno¾inové notace PF zjednodu¹it jako:
d928 1
a928 1
pass in quick on fxp0 inet proto { tcp, udp } from any to any port = 53
d930 1
a930 1
V¹imnìte si mezer z obou stran znakù '{}'.
d938 1
a938 13
block in quick on fxp0 inet from 127.0.0.0/8 to any
block in quick on fxp0 inet from 192.168.0.0/16 to any
block in quick on fxp0 inet from 172.16.0.0/12 to any
block in quick on fxp0 inet from 10.0.0.0/8 to any
block out quick on fxp0 inet from any to 127.0.0.1/8
block out quick on fxp0 inet from any to 192.168.0.0/16
block out quick on fxp0 inet from any to 172.16.0.0/12
block out quick on fxp0 inet from any to 10.0.0.0/8
</pre></ul>

mohou být slouèena do dvou øádek:
<ul><pre>
block in quick on fxp0 inet from { 127.0.0.1/8, 192.168.0.0/16, \
d940 1
a940 1
block out quick on fxp0 inet from any to { 127.0.0.1/8, 192.168.0.0/16, \
d955 1
a955 1
NoRouteIPs="{ 127.0.0.1/8, 192.168.0.0/16, 172.16.0.0/12, 10.0.0.0/8 }"
d972 1
a972 1
NoRouteIPs="{ 127.0.0.1/8, 192.168.0.0/16, 172.16.0.0/12, 10.0.0.0/8 }"
d979 1
a979 1
block in quick on $ExtIF from $NoRouteIPs to any
d982 3
a984 2
# only allow our machines to connect via ssh
pass in quick on $ExtIF inet proto tcp from $IntNet to any port = 22
d987 2
a988 4
pass in quick on $ExtIF inet proto tcp from any to any port $Services flags S/SA

# finally lock the rest down with a default deny
block in quick on $ExtIF from any to any
d991 6
a996 1
pass out on $ExtIF from any to any keep state
d1004 1
a1004 1
pass in log quick on fxp0 from 1.1.1.0/24 to any port = 22
d1006 2
a1007 1
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=pflogd&sektion=8">pflogd(8)</a> zapí¹e ip hlavièku do <i>/var/log/pflog</i>.
d1009 2
a1010 1
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=tcpdump&sektion=8">tcpdump(8)</a>, NE pøímo èlovìkem.
d1023 2
a1024 2
Nicménì PF není ani nebyl zamý¹len jako pøesná náhrada IPF.
Tato sekce popisuje nìkteré rozdíly mezi tìmito systémy.
d1037 1
a1037 1
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=tcpdump&sektion=8">tcpdumpu(8)</a>.</li>
d1096 1
a1096 3
<b>Operaèní systém: </b>OpenBSD v3.0 i386<br>
<br>
<b>Sí|tové karty: </b>
d1233 2
a1234 1
Nejprve budete muset na va¹em OpenBSD systému zapnout PF. Toho jednodu¹¹e docílíte editací souborù uvedených dále (zmìny udìlejte tak, aby odpovídající
d1264 1
a1264 1
(<i><a href="http://www.openbsd.org/cgi-bin/man.cgi?query=pf.conf&sektion=5">/etc/pf.conf</a></i>).
d1275 1
a1275 1
Pro více informací si pøeètìte <a href="#6.2">FAQ 6.2</a>
d1280 1
a1280 1
(<i><a href="http://www.openbsd.org/cgi-bin/man.cgi?query=nat.conf&sektion=5">/etc/nat.conf</a></i>).
d1441 1
a1441 1
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=ftp-proxy&sektion=8">ftp-proxy(8)</a>.
d1454 1
a1454 1
8081 stream tcp nowait root /usr/libexec/ftp-proxy ftp-proxy
d1599 2
a1600 2
<li><a href="http://www.openbsd.org/cgi-bin/man.cgi?query=nat.conf&sektion=5">nat.conf man page</a>
<li><a href="http://www.openbsd.org/cgi-bin/man.cgi?query=pfctl&sektion=8">pfctl man page</a>
d1610 4
a1613 1
<a name= "6.4"></a> <h2>6.4 - DHCP</h2> </p>
d1616 6
a1621 4
<p>Pro pou¾ívání DHCP klienta <a href="http://www.openbsd.org/cgi-bin/man.cgi?query=dhclient&apropos=0&sektion=8">dhclient(8)</a> dodávaného spolu
s OpenBSD, zeditujte soubor /etc/hostname.xl0 (za pøedpokladu, ¾e va¹e hlavní
ethernetové rozhraní je xl0. Mù¾ete mít jiné rozhraní, napø. ep0 nebo fxp0 nebo
jiné!) Jediné slovo, které musí tento soubor po editaci obsahovat je 'dhcp' .
d1625 3
a1627 1
Tento pøíkaz zpùsobí automatické nastartovaní DHCP klienta pøi bootování. OpenBSD bude od DHCP serveru po¾adovat informaci o své IP adrese, defaultním routeru a DNS serverech.
d1635 2
a1636 1
<p>Bez ohledu na to, jak spustíte DHCP klienta, mù¾ete zeditovat soubor /etc/dhclient.conf , aby napø. nedo¹lo ke zmìnì v ji¾ nakonfigurovaném DNS na základì
d1638 2
a1639 1
slovem 'require' (tato øádka se nachází v pùvodním souboru), tak docílíte zmìny v chování DHCP klienta.
d1649 2
a1650 1
Pokud chcete pou¾ívat OpenBSD jako DHCP server <A href="http://www.openbsd.org/cgi-bin/man.cgi?query=dhcpd&apropos=0&sektion=8">dhcpd(8)</a>,
d1682 1
a1682 1
dhcpd , aby vypisoval co nejménì informací, v opaèném pøípadì je toti¾ dhcpd
d1691 2
a1692 1
Více voleb pro dhcp klienty se nachází zde: <a href="http://www.openbsd.org/cgi-bin/man.cgi?query=dhcp-options&apropos=0&sektion=5">dhcp-options(5)</a> .
d1694 1
a1752 6
<b>Poznámka</b> - Na OpenBSD 2.6 byl systém dodáván se souborem <i>/etc/ppp/ppp.conf.example</i> , který mìl nesprávné nastavení sériového portu. Tento port
byl oznaèen jako zaøízení <i>"/dev/cuaa0"</i>. Zatímco tam mìlo být <i>/dev/cua00</i> , co¾ odpovídá sériovému portu èíslo 1. (COM1). Vá¹ modem  nemusí být na
 COM1, pøesto schéma pojmenování bylo ¹patné.
</p>

<p>
d1755 2
a1756 1
záznamovou úroveò. Je mo¾né to zmìnit, více <a href="http://www.openbsd.org/cgi-bin/man.cgi?query=ppp&sektion=8">ppp(8)</a> man page. Sériový port
d1844 2
a1845 1
Dal¹í informace: <a href="http://www.freebsd.org/handbook/userppp.html">http://www.freebsd.org/handbook/userppp.html</a> nebo <a href="http://www.freebsd.org/faq/userppp.html">http://www.freebsd.org/faq/userppp.html</a>.
d1849 1
d1867 2
a1868 1
Normálnì to nepotøebujete dìlat. Directed broadcast umo¾òuje komukoliv poslat pakety na veøejnou adresu va¹í pøipojené sítì, pokud pou¾íváte OpenBSD jako router.<p>
d1870 2
a1871 1
zejména pøi pou¾ívání starých iplementací NetBIOS protokolu. Pou¾ijte <Tt>sysctl -w net.inet.ip.directed-broadcast=1</tt> pro tuto vlastnost. Rovnou si ale
d1875 2
a1876 1
Na tohle tu také máme jedno sysctl. v <a href="http://www.openbsd.org/cgi-bin/man.cgi?query=sysctl&apropos=0&sektion=8">sysctl(8)</a> se pí¹e:
d1880 1
a1880 1
sysctl -w net.inet.tcp.baddynamic=749,750,751,760,761,871
d1884 2
a1885 2
   sysctl -w net.inet.tcp.baddynamic=+748
   sysctl -w net.inet.tcp.baddynamic=-871
d1888 1
d1891 1
d1893 1
a1893 1
<p> NFS , neboli Network File System, se pou¾ívá pro sdílení souborových systémù na síti. Dobré je, kdy¾ pøed pokusem o nastavení NFS serverù si pøeètete pár manuálových stránek:
d1904 13
a1916 9
Tato sekce vás provede základními kroky pro jednoduché nastavení NFS. V pøíkladì pøedpokládejme server na LAN, s klienty pøistupujícími na NFS na LAN. Nemluvíme zde o zabezpeèení NFS. Pøedpokládáme, ¾e jste ji¾ nastavili filtrování paketù,
nebo jinou firewallovou ochranu pro odepøení pøístupu zvenèí. Pokud dovolujete
vnìj¹í pøístup na vá¹ NFS server a máte na nìm nìjaká citlivá data, dùraznì doporuèujeme, abyste zprovoznil <a href="faq13.html">IPSec</a>. V opaèném pøípadì
mohou cizí lidé potenciálnì vidìt va¹e  NFS spojení. Mù¾e to vést i k nìkterým
útokùm. Pokud je IPSec protokol správnì nastaven, mù¾e vás od tohoto typu útokù
ochránit. 
<p>
Jiná podstatná bezpeènostní poznámka. Nepøidávejte filesystém do /etc/exports bez urèitého seznamu povolených strojù. Bez seznamu strojù, které mohou pøipojit
daný adesáø mù¾e kdokoliv, kdo má spojení s va¹ím poèítaèem pøipojit adresáøe,
d1924 5
a1928 1
zpøístupnit pøes NFS a definuje, komu je mù¾ete zpøístupnit. V <i>/etc/exports</i> mù¾ete pou¾ít spoustu voleb a nejlépe je pøeèíst si <a href="http://www.openbsd.org/cgi-bin/man.cgi?query=exports&sektion=5">exports(5)</a> man page. My máme <i>/etc/exports</i> takovýto:
d1962 3
a1964 1
Nestaèí pustit jen nfsd(8) server, musíte spustit i mountd(8). Jedná se o démona, který vlastnì obsluhuje ¾ádosti o NFS spojení. Napi¹te:
d1968 1
d2004 6
a2009 2
<p>V normálním provozu máte k dispozici dal¹í utility, které vám dovolují sledovat co se dìje na NFS. Jedna z nich je <a href="http://www.openbsd.org/cgi-bin/man.cgi?query=showmount&sektion=8">showmount(8)</a>
, která umo¾òuje sledovat co je právì pøipojeno a kdo to pøipojil. Dále také nfsstat(8) s podrobnìj¹ím výpisem. Pou¾ití pøíkazu showmount(8): zkuste <b>/usr/bin/showmount -a host</b>. Napøíklad:
d2022 2
a2023 1
NFS filesystém by mìl být pøipojen pomocí pøíkazu mount(8),  nebo speciálnì <a href="http://www.openbsd.org/cgi-bin/man.cgi?query=mount_nfs&sektion=8">mount_nfs(8)</a>.
d2054 2
a2055 1

d2058 1
d2068 3
a2070 1
Máte-li OpenBSD pøipojené k Internetu pøes va¹eho ISP, mù¾ete spustit <a href="http://www.openbsd.org/cgi-bin/man.cgi?query=nslookup&sektion=8">nslookup(8)</a>, program, který provádí DNS dotazy:
d2086 5
a2090 2
ulo¾eno v <a href="http://www.openbsd.org/cgi-bin/man.cgi?query=resolv.conf&sektion=5">/etc/resolv.conf</a>. Odpovìï ale nebyla autoritativní. Pro
autoritativní odpovìï na DNS dotaz zjistíme nejprve, který DNS server je autoritativní pro doménu <i>openbsd.org</i> a zeptáme se ho pak na adresu <i>www.openbsd.org</i>:
d2129 1
d2134 4
a2137 2
<li>Jednak RFC <a href="http://www.faqs.org/rfcs/rfc1033.html">1033</a>, <a href="http://www.faqs.org/rfcs/rfc1034.html">1034</a>, a <a href="http://www.faqs.org/rfcs/rfc1035.html">1035</a> s více informacemi o DNS.</li>
<li>Kniha od O'Reilly Associates <i><a href="http://www.openbsd.org/books.html#dns&bind">DNS a BIND</a> </i>.</li>
d2150 5
a2154 1
Pøíkaz <a href="http://www.openbsd.org/cgi-bin/man.cgi?query=dig&sektion=1">dig(1)</a> je u¾iteèný tím, ¾e vrací informaci o doménì ve stejném formátu, jaký je nutný pro konfiguraèní soubory BINDu. Mù¾ete pou¾ít  <a href="http://www.openbsd.org/cgi-bin/man.cgi?query=dig&sektion=1">dig(1)</a> pro prozkoumání nameserverù, které pracují správnì, abyste mohli porovnat jejich
d2161 8
a2168 4
Pokud si nejste jisti, zda by mìl vá¹ stroj slou¾it jako DNS server, nekonfigurujte ho tak. Instalace OpenBSD defaultnì neaktivuje stroj jako domain name server, aèkoliv v¹echny potøebné soubory jsou instalovány. Pro vìt¹inu poèítaèù
je dostaèující soubor  <a href="http://www.openbsd.org/cgi-bin/man.cgi?query=hosts&sektion=5">/etc/hosts</a> s názvy lokálních strojù a jejich IP
adresami a soubor <a href="http://www.openbsd.org/cgi-bin/man.cgi?query=resolv.conf&sektion=5">/etc/resolv.conf</a>, který udává adresy DNS serverù,
pou¾ívaných vámi na internetu nebo intranetu.
d2187 5
a2191 3
<li>Pokud máte potí¾e s pøevodem názvu stroje na IP adresu nebo s pøevodem lokálních názvù na IP adresy, pøesto¾e máte správnì nastaven obsah souborù <i>/etc/hosts</i> a <i>/etc/resolv.conf</i> (Napø. Netscape na OpenBSD obèas vykazuje
podobné problémy, proto¾e implementuje vlastní resolver místo pou¾ití funkce
<i>gethostbyname(3)</i> pro kladení DNS dotazù.))</li>
d2195 7
a2201 3
Dal¹ím faktorem je rychlost procesu. Proto¾e pøeklad jmen na adresy je opakující se proces, ve kterém name servery opakovanì odpovídají jiným nameserverùm na dotazy ohlednì adres jiných domén, pøeklad jmen mù¾e trvat ponìkud déle, pokud
máte modemové spojení s Internetem a dotazujete se vlastního DNS serveru na adresy vzdálených poèítaèù (který se pak bude opakovanì dotazovat vzdálených name
serverù pomocí modemu), ne¾ pokud se dotazujete name serveru va¹eho ISP (který
d2219 1
a2219 1
Existují dvì odli¹né specifikace BIND:
d2223 1
d2285 2
a2286 2
@@       IN      SOA     nemo.yewtopia.com.
your_id.nemo.yewtopia.com.  (
d2300 1
a2300 2
yewtopia.com.        IN      SOA     nemo.yewtopia.com.
your_id.nemo.yewtopia.com.  (
d2319 1
a2319 2
1.168.192.in-addr.arpa. IN      SOA     nemo.yewtopia.com.
your_id.nemo.yewtopia.com.  (
d2372 1
a2372 1
$ <strong>dig @@nemo.yewtopia yewtopia any any</strong>
d2381 1
a2381 1
;;      yewtopia, type = ANY, class = ANY
d2384 1
a2384 2
yewtopia.        3600   SOA     nemo.yewtopia.
your_id.nemo.yewtopia. (
d2390 1
a2390 1
yewtopia.        3600   NS      nemo.yewtopia.
d2393 1
a2393 1
nemo.yewtopia.   3600   A       192.168.1.9
d2396 1
a2396 1
;; FROM: nemo to SERVER: nemo.yewtopia.  192.168.1.9
d2406 4
a2409 1
Démon <b>named</b> je spu¹tìn pøi startu systému z <a href="http://www.openbsd.org/cgi-bin/man.cgi?query=rc&sektion=8">/etc/rc</a>, v øádce instalované v pùvodním <a href="http://www.openbsd.org/cgi-bin/man.cgi?query=rc.conf&sektion=8">/etc/rc.conf</a>.
d2541 1
a2541 1
Je zde toho mnoho, napøíklad, jak nastavit DNS, aby dotazy na intranetové domény, které nejsou viditelné z koøene doménové hierarchie byly pøevádìny na servery v rámci va¹í spoleènosti. Radìji si pøeètìte <a href="#6.8.1.1">Dokumenty které doporuèujeme</a> , kde najdete více informací o DNS.
d2544 1
d2553 3
a2555 1
Pro zaèátek potøebujete nainstalovat pptp. Port byl pøidán do OpenBSD portù POTÉ co bylo vydáno OpenBSD 2.8 a pracuje dobøe s OpenBSD 2.8 ports tree. Port se nachází v <i>/ports/net/pptp</i>. Pøeètìte si <a href="faq8.html#8.6">FAQ 8.6</a> pro více informací o OpenBSD ports tree.
d2559 3
a2561 1
V dùsledku konfliktu pptp s podporou <a href="http://www.openbsd.org/cgi-bin/man.cgi?query=gre&apropos=0&sektion=0&manpath=OpenBSD+Current&arch=i386">gre(4)</a> v jádøe budete nutné pøekompilovat jádro a odstranit podporu pro gre(4).
d2565 2
a2566 2
pre>
Index: sys/conf/GENERIC
d2569 6
a2574 6
retrieving revision 1.66
diff -u -r1.66 GENERIC
--- sys/conf/GENERIC    2000/10/13 04:21:14     1.66
+++ sys/conf/GENERIC    2000/12/26 19:55:31
@@@@ -97,6 +97,6 @@@@
 pseudo-device  ksyms   1       # kernel symbols device
d2576 1
a2576 1
 #pseudo-device vlan    2       # IEEE 802.1Q VLAN
d2579 1
d2581 1
a2581 1
 option         BOOT_CONFIG     # add support for boot -c
d2585 4
a2588 1
Pro pøekompilování jádra proveïte checkout  OpenBSD 2.8-stable pomocí cvs (podívejte se na webovou stránku <a href="../../cs/stable.html">OpenBSD Stable</a> pro více informací), aplikujte pøedcházející patch a pøekompilujete kernel podle <a href="faq5.html#5.3">FAQ 5.3</a>.
d2592 5
a2596 1
Poté co nainstalujete balík <b>pptp</b> a nové jádro, potøebujete zeditovat soubory pro nastavení spojení. Tento balík pou¾ívá do OpenBSD zakomponované <a href="http://www.openbsd.org/cgi-bin/man.cgi?query=ppp&apropos=0&sektion=0&manpath=OpenBSD+Current&arch=i386">ppp(8)</a>, tak¾e pokud se v nìm vyznáte, pak velká èást nastavení vypadá stejnì. Rovnì¾ se podívejte na <a href="#6.5">FAQ 6.5</a>.
d2636 4
a2639 1
V pøedcházejícím pøípadì mìl ná¹ modem pøedkonfigurovaný interfejs na 10.0.0.138. Nyní potøebujeme pøiøadit adresu  NA©EMU rozhraní. Nejlépe je vybrat si jedno IP blízko tomu, které vám bylo pøiøazeno va¹ím modemem, nebo pou¾ít statické IP které vám pøiøadili. Více si pøeètìte v <a href="#6.1">FAQ 6.1</a>.
d2646 1
a2646 1
# <strong>/usr/local/sbin/pptp 10.0.0.138 &</strong>
d2655 1
a2655 1
% <strong>kill -9 [pid of pptp]</strong>
d2662 1
a2662 1
# <strong>tail -f /var/log/message</strong>
d2685 1
a2685 1
Originally [OpenBSD: faq6.html,v 1.111 ]
d2687 1
a2687 1
$Translation: faq6.html,v 1.9 2002/02/22 11:15:18 certik Exp $
@


1.8
log
@
sync with badlands translation CVS
@
text
@d24 1
a24 1
<li><a href= "#6.2">6.2 - IP filtr</a>
d37 6
a42 6
<P>
<A name="6.0.1"></a>
<H2>6.0.1 - Pøedtím ne¾ pùjdeme dále</h2>
<P>
Na úvod pøedpokládáme, ¾e ètenáø pøeèetl a alespoò èásteènì chápe sekci <A href="faq5.html">Konfigurace jádra</a> tìchto FAQ, stejnì jako manuálové stránky
pøíkazù <a href= "http://www.openbsd.org/cgi-bin/man.cgi?query=ifconfig&apropos=0&sektion=8&format=html">
d44 1
a44 1
<a href= "http://www.openbsd.org/cgi-bin/man.cgi?query=netstat&apropos=0&sektion=1&format=html">
d46 1
a46 1
<P>
d48 1
a48 1
s IP protokolem, pak byste si rozhodnì mìli pøeèíst <A HREF="http://www.3com.com/solutions/en_US/ncs/501302.html">V¹e co potøebujete vìdìt o IP adresování</a>.
d50 1
a50 1
<P>
d52 1
a52 1
mù¾ete najít mnoho cenných informací <A HREF="http://the.rfceditor.org/rfc.html">ètením RFC dokumentù</a>.
d70 4
a73 2
nebo pozdìji pomocí pøíkazu <strong>dmesg(8)</strong>. Rovnì¾ mù¾ete svoje
sí»ová rozhraní identifikovat ve výpisu pøíkazu <strong>ifconfig(8)</strong>.
d87 4
a90 4
<li> sí»ové karty ne2000 - <a href="http://www.openbsd.org/cgi-bin/man.cgi?query=ne&sektion=4&format=html">ne</a>
<li>3Com EtherLink III a Fast EtherLink III Ethernet - <a href="http://www.openbsd.org/cgi-bin/man.cgi?query=ep&sektion=4&format=html">ep</a>
<li>3Com EtherLink XL a Fast EtherLink XL Ethernet (3C9xx) - <a href="http://www.openbsd.org/cgi-bin/man.cgi?query=xl&sektion=4&format=html">xl</a>
<li>Intel 82586 chip Ethernet device driver - <a href="http://www.openbsd.org/cgi-bin/man.cgi?query=ie&sektion=4&format=html">ie</a>
d93 3
a95 3
  <li>AT&T StarLAN 10
  <li>AT&T EN100
  <li>AT&T StarLan Fiber
d98 6
a103 3
<li>DEC/Intel 21142/3 a clone 10/100 Ethernet driver - <a href="http://www.openbsd.org/cgi-bin/man.cgi?query=dc&sektion=4&format=html">dc</a>
<ul><FONT SIZE="-1"> <b>Pozn:</b> Nìkteré drivery, které byly v OpenBSD 2.6,
jako napø. mx, ax, al a pn byly nahrazeny tímto driverem.</font><BR>
d112 1
a112 1
<P>
d115 3
a117 1
Jakékoliv odkazy v souborech /etc/ifaliases, /etc/ipf.rules, /etc/ipnat.rules
d119 4
a122 2
Stejnì tak v¹echny soubory s názvem hostname.xxx se starým názvem zaøízení musí
být pøejmenovány na hostname.dcX, aby byly akceptovány. 'X' nahraïte èíslem
d131 1
a131 1
mù¾ete pou¾ít pøíkaz <a href="http://www.openbsd.org/cgi-bin/man.cgi?query=ifconfig&sektion=8&format=html">ifconfig(8)</a>. Zde je jeho výstup zobrazující  
d155 1
a155 1
Jak je vidìt, <a href="http://www.openbsd.org/cgi-bin/man.cgi?query=ifconfig&sektion=8&format=html">ifconfig(8)</a>
d166 2
a167 2
<li><a href="http://www.openbsd.org/cgi-bin/man.cgi?query=lo&sektion-4&format=html">lo</a> - Loopback Interface
<li><a href="http://www.openbsd.org/cgi-bin/man.cgi?query=sl&sektion=4&format=html">sl</a> - SLIP Network Interface
d169 3
a171 3
<li><a href="http://www.openbsd.org/cgi-bin/man.cgi?query=tun&sektion=4&format=html">tun</a> - Tunnel Network Interface
<li><a href="http://www.openbsd.org/cgi-bin/man.cgi?query=enc&sektion=4&format=html">enc</a> - Encapsulating Interface
<li><a href="http://www.openbsd.org/cgi-bin/man.cgi?query=bridge&sektion=4&format=html">bridge</a> - Ethernet bridge interface
d179 2
a180 3
je následující:
Více informací o formátu tohoto souboru najdete v manuálové stránce <a href="http://www.openbsd.org/cgi-bin/man.cgi?query=hostname.if&sektion=5&format=html">hostname.if(5)</a>
.
d200 3
a202 2
Poté byste mìli nastavit va¹e nameservery a soubor <strong>/etc/hosts</strong>.
Nastavení nameserverù spoèívá mmj. ve vytvoøení souboru s názvem <strong>/etc/resolv.conf</strong>. Více informací o formátu tohoto souboru naleznete v manuálové stránce <a href="http://www.openbsd.org/cgi-bin/man.cgi?query=resolv.conf&sektion=5&format=html">resolv.conf(5)</a>. Pro standardní pou¾ití zde je pøíklad
d216 2
a217 1
Nyní mù¾ete buïto restartovat poèítaè, nebo spustit skript <strong>/etc/netstart</strong>. Udìláte to jednodu¹¹e napsáním (jako u¾ivatel root) :
d221 1
a221 1
$ <strong>sh /etc/netstart</strong>
d229 9
a237 2
V¹imnìte si, ¾e do¹lo k nìkolika chybám, ale ty se týkají jen zaøízení loopback.
Tak¾e je mù¾eme ignorovat. Nyní by vá¹ sí»ový subsystém mìl být správnì nastaven a mìl by fungovat. Opìt se mù¾ete pøíkazem <strong>ifconfig(8)</strong> pøesvìdèit, ¾e je va¹e zaøízení nastaveno správnì. Smìrování paketù na sí»ových rozhraních, nastavení rout mù¾ete zkontrolovat pomocí pøíkazu <strong>netstat(1)</strong> nebo <strong>route(8)</strong>. Zde je pøíklad jak si prohlédnout va¹e routovací tabulky.
d256 1
d280 1
a280 1
IP filtru, o kterém pojednává dal¹í èást, pomocí IP filtru mù¾ete blokovat
d282 4
a285 1
Internetu pro IPv4 se mù¾ete podívat na Pøekládání sí»ových adres (Network address translation), kde najdete informace jak roz¹íøit vá¹ adresový prostor.
d290 5
a294 1
být v tomto pøípadì zapnutá. Mù¾ete tak uèinit pomocí pøíkazu  <strong>sysctl(8)</strong>. Pro trvalou zmìnu byste mìli zeditovat soubor <strong>/etc/sysctl.conf</strong> . Udìláte to snadno pøidáním následující øádky do tohoto souboru.
d302 3
a304 1
Chcete-li tuto zmìnu provést bez restartu stroje, mìli byste pou¾ít pøíkaz <strong>sysctl(8)</strong>. Pamatujte si v¹ak, ¾e tato zmìna nebude trvalá, vydr¾í
d314 5
a318 3
Nyní zmìòte routovací tabulky na jiných strojích. Je mnoho zpùsobù pou¾ití OpenBSD jako router, pomocí softwaru <A HREF="http://www.openbsd.org/cgi-bin/man.cgi?query=routed&apropos=0&sektion=8&format=html">routed(8)</a>,
<A HREF="http://www.gated.org">gated</a>, <a href="http://www.mrtd.net">mrtd</a>, a <A href="http://www.zebra.org">zebra</a>.
OpenBSD podporuje porty v ports tree jak pro gated tak mrtd.
d331 8
a338 3
OpenBSD má jednoduchý mechanismus, který umo¾òuje nastavit ip aliasy na zaøízení. V¹e spoèívá v jednoduché editaci souboru <a href="http://www.openbsd.org/cgi-bin/man.cgi?query=hostname.if&sektion=5&format=html"><i>/etc/hostname.&lt;if&gt;</i></a>. Tento soubor
je pøeèten pøi startu systému skriptem <i>/etc/rc</i>, který je souèástí <a href="faq10.html#10.3">rc startup hierarchy</a>. Napøíklad pøedpokládejme, ¾e u¾ivatel má zaøízení <b>dc0</b> a je na síti 192.168.0.0. Dal¹í podstatné informace
jsou:
d349 1
a349 1
<P>
d362 1
a362 1
<P>
d370 1
a370 1
Poèínaje OpenBSD 2.7, mù¾ete nastavit aliasy v souboru <a href="http://www.openbsd.org/cgi-bin/man.cgi?query=hostname.if&sektion=5&format=html"><i>/etc/hostname.*</i></a>. Pro provedení stejného nastavení jako v pøedcházejícím pøíkladì, byste vytvoøili následující soubor  <i>/etc/hostname.dc0</i> :
d382 1
a382 1
Poté co jste vytvoøili tento soubor, budete muset rebootovat, aby se zmìny nastavení promítly. Nebo mù¾ete nastavit aliasy ruènì pomocí <a href="http://www.openbsd.org/cgi-bin/man.cgi?query=ifconfig&sektion=8&format=html">ifconfig(8)</a>.
a401 2


d404 7
a410 1
<h2>6.2 - IP Filter</h2>
a411 1

d413 6
a418 6

Softwarový balík IP Filter od Darrena Reeda slou¾í pro zaji¹tìní následujících dvou úloh:
filtrovací pravidla pro filtrování na úrovni paketù 
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=ipf&apropos=0&sektion=8&format=html">ipf(8)</a> a mapování
poèítaèù, podsítí na okruh externích adres 
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=ipnat&apropos=0&sektion=8&format=html">ipnat(8)</a>. Konfiguraèní soubory pro tyto dvì slu¾by jsou <i>/etc/ipf.rules</i> a <i>/etc/ipnat.rules</i>.
a419 1

d421 3
a423 1
Je nutné zeditovat <i>/etc/rc.conf</i> pro jejich aktivaci pøi startu; øádky nastavte na:
d425 1
d427 1
a427 2
ipfilter=YES
ipnat=YES
d430 7
a436 4
<p><p>
<b>Poznámka:</b> Pokud nebudete pou¾ívat ipnat a ipfilter zároveò, nemusíte nastavovat obì volby. 
Pokud ov¹em pou¾íváte <a href="http://www.openbsd.org/cgi-bin/man.cgi?query=ipnat&sektion=8&manpath=OpenBSD+2.7">ipnat(8)</a>,
musí být aktivován také ipfilter.
a437 1

d439 4
a442 3
Pokud pou¾íváte <a href="http://www.openbsd.org/cgi-bin/man.cgi?query=ipnat&sektion=8&manpath=OpenBSD+2.7">ipnat(8)</a>,
nejspí¹e bude muset nastavit hodnotu sysctl &quot;net.inet.ip.forwarding&quot; na 1. To mù¾ete
udìlat odkomentováním pøíslu¹ného øádku v <i>/etc/sysctl.conf</i>.
a443 4

<P>
Pokud máte IP filtr zakompilovaný v jádøe, ale nemáte ho aktivován v <i>/etc/rc.conf</i>, mù¾ete ho stále je¹tì jednodu¹¹e aktivovat.

d445 3
a447 2
# <strong>ipf -Fa -f /etc/ipf.rules -E</strong>
# <strong>ipnat -CF -f /etc/ipnat.rules</strong>
a449 3
<P>
Volba <tt>-E</tt> u ipf 'umo¾òuje' IP filtr.  <Tt>-Fa</tt> ma¾e v¹echna pravidla pro filtrování, která mohla být ji¾ nastavena. <tt>-f /etc/ipf.rules</tt> nahraje nová pravidla ze souboru 
<i>/etc/ipf.rules</i>.
d451 6
a456 3
Pokud udìláte zmìny v <i>/etc/ipf.rules</i> poté co ipf je nahrán, mù¾ete pravidla
jednodu¹¹e nahrát znova.

d458 1
a458 1
# <strong>ipf -Fa -f /etc/ipf.rules</strong>
d460 5
a464 2
Stejné pro ipnat...

d466 1
a466 5
# <strong>ipnat -CF -f /etc/ipnat.rules</strong>
</pre></ul>
Také budete chtít spustit <a href="http://www.openbsd.org/cgi-bin/man.cgi?query=ipmon&sektion=8&manpath=OpenBSD+2.7">ipmon(8)</a> pro ladìní.
<ul><pre>
# <strong>ipmon -Ds</strong>
d468 1
d470 9
a478 8
Tento dokument obsahuje jen nìkolik základních 
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=ipf&sektion=8&manpath=OpenBSD+2.7">ipf(8)</a> a 
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=ipnat&sektion=8&manpath=OpenBSD+2.7">ipnat(8)</a> konfigurací.
Spousta pìkných pøíkladù je v <i>/usr/share/ipf/</i> . Doporuèujeme, abyste si
vybrali tu, která je vám nejbli¾¹í a modifikovali ji pro va¹e potøeby.
Informace o IP filtru naleznete na IP Filter <A HREF="http://false.net/ipfilter/">mailing list archívu</a>,
<A HREF="http://coombs.anu.edu.au/~avalon/">IP Filter web site</a>, a koneènì <A
HREF="http://www.obfuscation.org/ipf/">IP Filter HOWTO</a>.
d482 1
a482 1
<h3>IPF</h3>
d486 8
a493 3
Pro konfiguraci IP filtru pøi startu, budete muset modifikovat /etc/rc.conf ,aby zde bylo IPFILTER=YES. 
IP Filtr  (ipf) je kontrolován sadou pravidel ze souboru /etc/ipf.rules, která
jsou naètena pøi startu. Pro detailnìj¹í popis si pøeètìte <a href="http://www.openbsd.org/cgi-bin/man.cgi?query=ipf&apropos=0&sektion=5&manpath=OpenBSD+2.7">ipf(5)</a>. V pøikladech, které následují, fxp0 reprezentuje externí rozhraní k internetu. Ve va¹em  pøípadì bude patrnì jiné, na základì ethernetového adaptéru ve va¹em poèítaèi.  Pravidla pøedpokládají trvalé spojení s Internetem, jaké byste
d498 2
a499 2
Pravidla IP filtru jsou zpracovávána postupnì od shora dolù. Ka¾dý paket musí
pøejít pøes tyto pravidla, pøedtím ne¾ dosáhne svého urèení.
d503 7
a509 1
Napøíklad implicitní soubor pravidel umo¾òuje ka¾dému paketu cestovat dovnitø a ven:
d511 1
d513 1
a514 1
pass in from any to any
d517 20
a536 2
Nyní pøedpokládejme, ¾e nechceme dovolit jakoukoliv pøichozí konekci na port
3306 (mysql) proto¾e k databázi by mìl být pøístup pouze z localhostu.
d540 3
a542 3
pass out from any to any
pass in from any to any
block in on fxp0 from any to any port = 3306
d545 9
a553 3
Toto øíká  &quot;blokuj v¹echny pøíchozí pakety, pøicházející na interfejs fxp0 odkudkoliv, smìøující kamkoliv, jejich¾ destinace je port 3306.&quot;
Pøirozenì, paket urèený pro port 3306 na zaøízení fxp0 projde pøes první
&quot;pass in&quot; pravidlo a potom bude odhozen díky pravidlu &quot;block in port = 3306&quot; . Pokud zmìníte poøadí va¹ich pravidel (pamatujte si, poøadí
d557 3
a559 3
pass out from any to any
block in on fxp0 from any to any port = 3306
pass in from any to any
d564 2
a565 2
pro IP filtr, ¾e:
 <b> Poslední odpovídající pravidlo vítìzí</b>.
d569 1
a569 1
Samozøejmì, jsou zde vyjímky pro ka¾dé pravidlo. Volba <em>quick</em> ukonèí 
d571 1
a571 1
Pokud pøidáme  <em>quick</em>  k pravidlu &quot;block in&quot; :
d574 3
a576 3
pass out from any to any
block in quick on fxp0 from any to any port = 3306
pass in from any to any
d579 2
a580 3
ck</em> <p>
Paket urèený pro ná¹ poèítaè na port 3306 bude zpracován bezprostøednì pravidlem
&quot;block in quick&quot; a bude odhozen. V¹echny pakety urèené pro jiné porty
d587 4
a590 3
mnohem bezpeènìj¹í ne¾ pøímo nepovolovat ka¾dou chránìnou slu¾bu, také umo¾òuje
mít relativnì malý soubor pravidel a mù¾e ochránit od ¹patnì nakonfigurované
slu¾by, která je ponechána svému osudu.
d592 3
a594 2
Nyní se podívejte na jiný pøíklad skuteèného ¾ijícího pøíkladu pravidel a vysvìtleme si øádku po øádce jejich význam. Je zde pøíklad webserveru s default deny
politikou, která povoluje pouze ssh spojení (pro administraci) a spojení
d596 1
d598 3
a600 3
pass in quick on fxp0 from any to any port = 22
pass in quick on fxp0 from any to any port = 80
pass in quick on fxp0 from any to any port = 443
d602 1
a602 1
pass out on fxp0 from any to any 
d606 5
a610 4
Tyto pravidla dovolí pøíchozím spojením odkudkoliv na porty 22(ssh), 80(http)
a 443(https) projít. Odhodí v¹echny ostatní pakety a umo¾ní v¹echna odchozí
spojení.
Co ale kdy¾ chcete dovolit ssh spojení pouze z interních strojù , ale dovolit
a611 1
</p>
d614 3
a616 3
pass in quick on fxp0 from 1.1.1.0/24 to any port = 22
pass in quick on fxp0 from any to any port = 80
pass in quick on fxp0 from any to any port = 443
d621 3
a623 2
Docela dobré, ale co kdy¾ chceme dovolit pouze jednomu stroji (1.1.1.1) administrovat webserver vzdálenì?
V tomto pøípadì  mù¾eme zmìnit :
d626 1
a626 1
pass in quick on fxp0 from 1.1.1.0/24 to any port = 22
d630 1
a630 5
pass in quick on fxp0 from 1.1.1.1/32 to any port = 22
</pre></ul>
IP filtr podporuje jak teèkovou desítkovou tak CIDR notaci sí»ové masky. Pøedcházející byste mohli napsat také jako:
<ul><pre>
pass in quick on fxp0 from 1.1.1.1/255.255.255.255 to any port = 22
a631 1
ale proè byste to dìlali?
d633 2
a634 1
<b> Pøíklad souboru pravidel</b>
d636 3
a638 2
Zde je nìkolik pravidel pro ka¾dého (pøedpokládejme, ¾e fxp0 je externí zaøízení
pøipojené na internet). Nejprve nastolíme jednoduchou address spoofing ochranu.
d640 8
a647 8
block in quick on fxp0 from 127.0.0.0/8 to any
block in quick on fxp0 from 192.168.0.0/16 to any
block in quick on fxp0 from 172.16.0.0/12 to any
block in quick on fxp0 from 10.0.0.0/8 to any
block out quick on fxp0 from any to 127.0.0.1/8
block out quick on fxp0 from any to 192.168.0.0/16
block out quick on fxp0 from any to 172.16.0.0/12
block out quick on fxp0 from any to 10.0.0.0/8
d649 2
a650 7
Dobrá my¹lenka je rovnì¾ oddìlit pravidla pro va¹e loopback rozhraní od ostatních. 
 
<ul><pre>
pass out quick on lo0
pass in quick on lo0
</pre></ul>
Ná¹ soubor pravidel zdá se zatím vypadá dobøe, kdy¾ to dáme v¹echno dohromady,
d652 1
a653 5
# loopback rules

pass out quick on lo0
pass in quick on lo0

d655 8
a662 9

block in quick on fxp0 from 127.0.0.0/8 to any
block in quick on fxp0 from 192.168.0.0/16 to any
block in quick on fxp0 from 172.16.0.0/12 to any
block in quick on fxp0 from 10.0.0.0/8 to any
block out quick on fxp0 from any to 127.0.0.1/8
block out quick on fxp0 from any to 192.168.0.0/16
block out quick on fxp0 from any to 172.16.0.0/12
block out quick on fxp0 from any to 10.0.0.0/8
d665 1
a665 2

pass in quick on fxp0 from 1.1.1.1/32 to any port = 22
d668 2
a669 3

pass in quick on fxp0 from any to any port = 80
pass in quick on fxp0 from any to any port = 443
a671 1

a674 1

d683 1
a683 1
Jednodu¹¹e, IP filtr to umo¾òuje pomocí slova <em>log</em> :
d685 2
a686 2
pass in quick on fxp0 from 1.1.1.1/32 to any port = 22
block in log quick on fxp0 from any to any port = 22
a690 1
<b> Filtrování na základì protokolù</b>
d692 13
a704 4
IP filtr umí filtrovat jakýkoliv IP protokol podle jeho èísla nebo názvu
v souboru <a href=file://localhost/etc/protocols>/etc/protocols</a>. My
se zamìøíme jen na protokoly tcp, udp a icmp. Tyto jsou nejèastìji u¾ívány. 
V¹echny zásadní internetové aplikace závisí na implementaci a správném fungování tìchto protokolù.</p>
d706 3
a708 2
Pro filtrování podle protokolù se u¾ívá v konfiguraci ipf klíèové slovo <em>proto</em>. Podíváme-li se na ná¹ pøedchozí pøíklad pravidla pro ssh, proto¾e ssh
pou¾ívá pro svoji komunikaci tcp, mìli bychom dovolit spojení pouze tcp paketùm. Pou¾itím slova <em>proto</em> umo¾níme uspìt pouze tcp paketùm a dostáváme pravidlo podobné tomuto:
d710 1
a710 1
pass in quick on fxp0 proto tcp from 1.1.1.1/32 to any port = 22
d712 1
a712 3
Co ale v pøípadì, kdy potøebujeme umo¾nit spojení slu¾bì pou¾ívající jak tcp
tak i udp, jako je napøíklad bind? V pøípadì tcp/udp IP filtr dovoluje spojit
oba protokoly dohromady. Poznámka: toto je mo¾né pouze v pøípadì tcp/udp. Pou¾ití v pøípadì slu¾by dns v prostøedí s defaultní politikou deny je následující:
d714 1
a714 1
pass in quick on fxp0 proto tcp/udp from any to any port = 53
d716 23
a739 1
<b> Filtrování fragmentù</b>
d741 4
a744 6
Kromì filtrování zalo¾eného na protokolech je IP filtr schopen filtrovat
rovnì¾ fragmentované IP pakety (bì¾ná metoda obcházení paket filtrù). Jsou
zde dvì klíèová slova, která se pou¾ívají pro práci s fragmentovanými ip pakety,  <em>frag</em> pro bì¾nì fragmentované pakety nebo <em>short</em> pro IP pakety, jejich¾ hlavièky jsou pøíli¹ malé pro porovnávání. Proto¾e fragmentované
pakety se mohou vyskytnout v dùsledku bì¾ného provozu, je nejlep¹í filtrovat
pouze pakety, jejich¾ hlavièky jsou pøíli¹ malé pro smysluplné porovnávání. 
Toho dosáhneme pou¾itím následujícího pravidla:
d746 2
a747 1
block in quick proto tcp all with short
d749 17
a765 5
A co IP paket s nastavenými IP volbami ?
IP filtr pracuje i s tìmito fenomény. Pakety mohou být odfiltrovány, pokud
mají nastaveny volby jako takové, nebo pokud mají nastaveny urèité volby.
Napøíklad následující pravidlo zaká¾e a loguje v¹echny pakety s nastavenými
volbami.
d767 1
a767 1
block in log quick on fxp0 all with ipopts
d769 13
a781 3
Toto pravidlo mù¾e ale znemo¾nit funkci nìkterých programù, jako napøíklad
 <a href="http://www.openbsd.org/cgi-bin/man.cgi?query=traceroute&sektion=8&format=html">traceroute(8)</a>. Mù¾ete rovnì¾ specifikovat, které volby IP paketu
nepovolujete. Napøíklad takto:
d783 1
a783 2
block in quick on fxp0 all with opt lsrr
block in quick on fxp0 all with opt ssrr
d785 3
d789 1
d791 7
a797 6
Nyní zaèíná být filtrování progresivní. Nejvìt¹í silou IP filtru je toti¾
schopnost filtrovat pakety na základì nastavených pøíznakù TCP protokolu,
udr¾ovat vytvoøená spojení a jejich stav. Doporuèujeme, aby v¹ichni u¾ivatelé,
kteøí chtìjí filtrovat podle TCP pøíznakù  vìdìli, jakou roli ka¾dý
pøíznak má. Napøíklad , pokud chcete zakázat v¹echny pakety s nastavenými
flagy FIN, URG a PSH (jako napøíklad v pøípadì pokusu o OS fingerprinting pomocí nmap-u ) mù¾ete pou¾ít pravidlo jako je toto:
d799 1
a799 1
block in quick on fxp0 proto tcp from any to any flags FUP
d801 1
a801 1
( Díky  <a href=mailto:halogen@@nol.net>Kyle Hargraves</a> za tento tip)
d804 6
a809 4
Dal¹í výborná vlastnost IP filtru je schopnost udr¾ovat stav. Tato vlastnost
spoèívá v tom, ¾e jakmile je jednou vytvoøeno spojení, pakety týkající se
tohoto spojení u¾ dále nepodstupují filtrování. Toto je velmi silná vlastnost
, která umo¾òuje psát pravidla filtru jednodu¹¹eji a bezpeènìji.</p>
d811 3
a813 2
Napøíklad, podívejme se, jak mu¾eme uplatnit tuto vlastnost pøi psaní na¹í ukázkové sestavy pravidel. Pro pøipomenutí, dovolujeme administraèní pøístup z
na¹í adresy tøídy C na port 22(ssh) a dovolujeme v¹echna pøíchozí spojení 
d815 5
a819 2
dìlat v pøípadì, ¾e se chceme spojit pomocí ssh z web serveru, nebo chceme
pou¾ít lynx abychom se podívali na nìco ve FAQ? To udìlat nemù¾eme, proto¾e
d825 2
d828 1
a828 1
pass in quick on fxp0 from 1.1.1.0/24 to any port = 22
d832 1
a832 1
pass out on fxp0 proto tcp from any to any keep state
a833 1
</p>
d838 1
a838 1
aby probìhl jen poèáteèní handshake, jakmile k nìmu dojde, mù¾eme blokovat
d841 3
a843 1
dovolit pakety pouze s nastavenými flagy SIN a SIN/ACK. Propu¹tìním paketù pouze s pøíznaky SIN a SIN/ACK se ubráníme mnoha formám port skenù jako je napøíklad
d846 3
a848 3
pass in quick on fxp0 from 1.1.1.0/24 to any port = 22
pass in quick on fxp0 from any to any port = 80 flags S/SA
pass in quick on fxp0 from any to any port = 443 flags S/SA
d855 3
a857 2
Tato sada bude mít default deny politiku, umo¾òující pouze administrativní
spojením z interní sítì (pøes ssh) a umo¾òující pøíchozí spojení na porty
d861 1
a861 1
ukázka souboru /etc/ipf.rules :
d863 2
a864 10
# loopback rules
pass out quick on lo0
pass in quick on lo0

# drop itsy bitsy frags
block in quick proto tcp all with short

# drop source routed packets
block in quick on fxp0 all with opt lsrr
block in quick on fxp0 all with opt ssrr
d867 8
a874 8
block in quick on fxp0 from 127.0.0.0/8 to any
block in quick on fxp0 from 192.168.0.0/16 to any
block in quick on fxp0 from 172.16.0.0/12 to any
block in quick on fxp0 from 10.0.0.0/8 to any
block out quick on fxp0 from any to 127.0.0.1/8
block out quick on fxp0 from any to 192.168.0.0/16
block out quick on fxp0 from any to 172.16.0.0/12
block out quick on fxp0 from any to 10.0.0.0/8
d877 1
a877 1
pass in quick on fxp0 from 1.1.1.0/24 to any port = 22
d880 2
a881 2
pass in quick on fxp0 from any to any port = 80 flags S/SA
pass in quick on fxp0 from any to any port = 443 flags S/SA
d887 1
a887 9
#  -- The flags S on the keep state is to ensure that state tracking starts
#    only on the first outbound packet in a tcp session.
#    unnecessary consumption of state table entries.
# -- The flag s only works on the tcp protocol, so three entries are required to
#    to cover all three protocols (tcp, udp, icmp).

pass in        quick on fxp0 proto tcp  from any to any flags S keep state
pass in        quick on fxp0 proto udp  from any to any         keep state
pass in        quick on fxp0 proto icmp from any to any         keep state
d891 3
a893 5
Pokud se vyskytnou nìjaké problémy, mù¾ete chtít zprovoznit logování u jednotlivých pravidel, abyste vìdìli co se dìje, napø.:
pass in log quick on fxp0 from 1.1.1.0/24 to any port = 22<br>
Pokud zmìníte svùj konfiguraèní soubor, aby pravidla logovaly pakety, nezapmeòte dát ipf -Fa -f /etc/ipf.rules aby se zmìny promítly!
<br>ipmon bude psat ip log hlá¹ky do /var/log/ipflog .<br>
Pro dal¹í informace o ipf je k dispozici excelentní <a href=http://www.obfuscation.org/ipf/ipf-howto.txt>IPF how-to</a>, stejnì jako <a href=http://coombs.anu.edu.au/~avalon/ip-filter.html>IP Filter</a> homepage.
d897 1
a897 2
<a name="6.3"></a>
<h2>6.3 - IPNAT</h2>
a898 1

d900 14
a913 1
Initial work done by Wayne Fergerstrom &lt;wayne@@methadonia.net&gt;
d915 15
d931 8
a938 2
<a name="nat1.0"></a>
<h3><u>6.3.1 NAT Úvod</u></h3>
a939 2
<a name="nat1.1"></a>
<b>Sekce Úvod</b>
d941 15
a955 1
Tato sekce se pokou¹í pomoci tìm, kteøí instalují a konfigurují Network Address Translation ("NAT") na systému OpenBSD.
d957 3
a959 4
Pøedpokládá se, ¾e u¾ivatel u¾ nastavil a nakonfiguroval OpenBSD se dvìma
sí»ovými kartami (jedna pøipojena k Internetu a druhá k lokální síti).
Pøeklad IP adres bude fungovat i na strojích s jedním sí»ovým rozhraním, pøesto
je nutné poznamenat, ¾e pakety budou procházet pøes toto jediné rozhraní dovnitø a ven a ¾e ethernetové kolize sní¾í významnì výkon.
d961 18
d980 2
a981 6
<p>
Na základì <a HREF="http://www.geektools.com/rfc/rfc1631.txt">RFC 1631</a>, ipnat dává jednoduchý zpùsob jak namapovat interní sí» na jedinou routovatelnou
("reálnou") internetovou adresu. Toto je velmi u¾iteèné, pokud je¹tì napøíklad
nemáte oficiálnì pøiøazené adresy pro ka¾dý stroj na va¹í interní síti. Pøi
nastavování soukromé/interní sítì, mù¾ete s výhodou pou¾ít rezervovaných adresových blokù (pøiøazených v <A HREF="http://www.geektools.com/rfc/rfc1918.txt">RFC 1918</a>), jako jsou:
<P>
d983 2
a984 3
10.0.0.0/8 (10.0.0.0 - 10.255.255.255)<br>
172.16.0.0/12 (172.16.0.0 - 172.31.255.255)<br>
192.168.0.0/16 (192.168.0.0 - 192.168.255.255)<br>
d986 3
d991 14
a1004 2
<a name="nat1.2"></a>
<b>Terminologie</b>
d1007 8
a1014 1
Pro informaci uvádíme nìkolik zkratek a formát jaký bude v dokumentu pou¾it.
d1016 23
a1038 1
<strong>"NAT"</strong>
d1040 3
a1042 2
Tato zkratka popisuje funkci "Network Address Translation"  tj. pøekladu
sí»ových adres. Proces pøekladu je popsán pozdìji.
d1044 2
a1045 1
</ul>
d1047 1
a1047 2
<ul>
<strong>"ipnat"</strong>
d1050 9
a1058 3
Zkratka za "IP Network Address Translation." V podstatì mù¾e být pou¾ita
podobnì jako NAT. Pøesto v tomto dokumentu bude oznaèovat termín "ipnat" pouze
pro pou¾ití na pøíkazové øádce.
a1059 1
</ul>
d1061 5
a1065 2
<ul>
<strong>"IPF"</strong>
d1068 2
a1069 5
Zkratka za IP filtr. IP filtr je portovatelný software pro filtrování paketù,
který je dodáván jako souèást OpenBSD. IP filtr musí být zapnut, pøedtím ne¾
spustíte ipnat. Je to snadné, docílíte toho editací souboru /etc/rc.conf a
zmìníte ipf=NO na ipf=YES. Tato zmìna zmìní stav vìcí pro dal¹í bootování.
Pokud jste u¾ systém nastartovali mù¾ete ip filtr zapnout pomocí pøíkazu 'ipf -E' . Samozøejmì toto je popsáno dále.
d1071 1
a1071 1
</ul>
d1078 4
a1081 1
Následují informace o nastavení poèítaèù, které figurují v tomto dokumentu.
d1085 1
a1085 1
<b>Operaèní systém: </b>OpenBSD v2.7 i386<br>
d1087 1
a1087 1
<b>Sí»ové karty: </b>
d1089 9
a1097 9
  NetGear 10/100MB <b>dc0</b><br>
  Connected to the EXTERNAL LAN (or WAN)<br>
  <b>IP Address: </b>24.5.0.5<br>
  <b>Netmask: </b>255.255.255.0<br>
  <br>
  NetGear 10/100MB <b>dc1</b><br>
  Connected to the INTERNAL LAN<br>
  <b>IP Address: </b>192.168.1.1<br>
  <b>Netmask: </b>255.255.255.0<br>
d1100 1
a1100 2
<b>Externí, internetová routa (dodal ji ISP, v tomto pøípadì se jedná o linku
modemovou)<br></b>
d1102 3
a1104 3
  <b>IP Address: </b>24.5.0.5<br>
  <b>Netmask: </b>255.255.255.0<br>
  <b>Gateway: </b>24.5.0.1<br>
d1109 2
a1110 1
Poèítaèe na LAN pou¾ívají adresové schéma 192.168.1.xxx (kde xxx je jedineèné
d1112 3
a1114 3
Linux. Ka¾dý stroj je pøipojen k hubu, který je vybaven pro interní pou¾ití.
V tomto dokumentu a v jeho pøíkladech  klient na LAN bude pou¾ívat IP adresu
192.168.1.40
d1119 14
a1132 14
+-----+              +---------+         +----------+
| Hub |--------- dc1 |   NAT   | dc0 ----| Internet |
+-----+              +---------+         +----------+
  | |
  | +-- Klient A
  +---- Ostatní stroje  

                              +-------------------------+
                              |        LEGENDA          |
                              +-------------------------+
                              |  NIC dc0 - 24.5.0.5     |
                              |  NIC dc1 - 192.168.1.1  |
                              | Klient A - 192.168.1.40 |
                              +-------------------------+
d1136 1
d1139 1
a1139 1
<h3><u>6.3.2 Pøeklad sí»ových adres</u></h3>
d1146 16
a1161 3
Jak pøibývají dal¹í a dal¹í firmy, které chtìjí mít spojení na Internet, ka¾dá
musí mít vlastní IP adresu. Veøejných IP adres je èímdál ménì. Øe¹ením pro mnoho lidí je Network Address Translation (NAT), neboli pøeklad sí»ových adres . NAT je jednoduchý zpùsob, jak pøipojit va¹i LAN na Internet, ani¾ byste si
museli zakoupit nebo pronajmout IP adresu pro ka¾dý stroj. 
a1162 1

d1173 1
a1173 1
je zcela transparentní.
d1181 2
a1182 2
Klient ----------------- dc1 [ NAT ] dc0 ---------- Internet Host
192.168.1.40 --- 192.168.1.1 [ NAT ] 24.5.0.5 --- 123.45.67.89
d1184 7
a1190 7
Odcházející TCP paket                     Odcházející TCP paket
From: 192.168.1.40    &gt;&gt;=== NAT ===&gt;&gt;     From: 24.5.0.5
To: 123.45.67.89                          To: 123.45.67.89

Pøicházející TCP paket                    Pøicházející TCP paket
From: 123.45.67.89                        From: 123.45.67.89
To:   192.168.1.40    &lt;&lt;=== NAT ===&lt;&lt;     To: 24.5.0.5
d1195 1
a1195 1
<b>Proè pou¾ívat NAT?</b>
d1207 5
a1211 4
Je tu mnoho dùvodù, proè jsem chtìl nastavit NAT. Dùvodem èíslo jedna bylo u¹etøit peníze. V mém domì jsou tøi spolubydlící (ka¾dý s vlastním PC) a já sám
se tøemi poèítaèi. Mùj ISP dovolí pouze tøi IP adresy v ka¾dé domácnosti.
To znamená, ¾e zde není dostatek IP adres , aby ka¾dému poèítaèi mohl být
dovolen internetový pøístup.
d1215 1
a1215 1
Za pou¾ití NATu bude mít ka¾dý stroj unikátní (interní) IP adresu, ale budou
d1220 1
a1220 1
<a name="nat2.3"></a>
d1224 1
a1224 1
Nejprve budete muset na va¹em OpenBSD systému zapnout IPF a NAT. Toho jednodu¹¹e docílíte editací souborù uvedených dále (zmìny udìlejte tak, aby odpovídající
d1229 1
a1229 1
<b>/etc/rc.conf</b> (Z tohoto souboru se startují programy pøi bootování)
d1232 3
a1234 4
<ul>
  ipfilter=YES<br>
  ipnat=YES
</ul>
d1240 3
a1242 3
<ul>
  net.inet.ip.forwarding=1
</ul>
d1249 1
a1249 1
<a name="nat2.4"></a>
d1253 2
a1254 1
Prvním krokem je nastavit soubor s pravidly pro IPF (<i>/etc/ipf.rules</i>).
d1260 2
a1261 2
pass in from any to any
pass out from any to any
d1269 3
a1271 1
Soubor s nastavením NATu (<i>/etc/ipnat.rules</i>) má velmi jednoduchý syntax.
d1276 1
a1276 2
map dc0 192.168.1.0/24 -&gt; 24.5.0.5/32 portmap tcp/udp 10000:60000
map dc0 192.168.1.0/24 -&gt; 24.5.0.5/32
d1280 1
a1280 1
Zde je vysvìtlení pøedcházejících øádek.
d1284 1
a1284 1
<strong>"map"</strong>
d1286 1
a1286 2
Tímto pøíkazem øíkate NATu,  ¾e podle následujících dat se bude mìnit adresa
mezi LAN a Internetem.
d1291 1
a1291 1
<strong>"dc0"</strong>
d1302 1
a1302 12
mapována. Pokud nechcete pou¾ít CIDR (classless inter-domain routing) notaci,
mù¾ete  "/24" nahradit "/255.255.255.0".
</p>
</ul>

<ul>
<b>"24.5.0.5/32"</b>
<p>
Tato IP adresa a sí»ová maska zastupují IP adresu, na kterou budou namapovány
adresy z LAN. /32 znamená, ¾e se jedná o jednu IP adresu. Mù¾ete také mapovat
na /24 nebo  256 IP adres (nebo /27  nebo jakýkoliv poèet bitù, který chcete)!!  Toto je u¾iteèné, pokud máte nìkolik tisíc klientù umístìných za NATem ....
(Samozøejmì, je to u¾iteèné jenom pokud tìch /24 je smìrováno na vá¹ stroj s OpenBSD!)
d1307 1
a1307 1
<b>"portmap tcp/udp 10000:60000"</b>
d1309 1
a1309 1
Toto mapuje v¹echny tcp/udp pakety na porty v rozsahu od 10000 do 60000.
d1313 1
a1313 26
<p>
Druhý øádek je témìø stejný s výjimkou poslední èásti.
Ta øíká ipnat-u aby mapoval v¹echno ostatní (ne tcp/udp, tyto pakety byly
u¾ obslou¾eny prvním øádkem) na jakýkoliv port, který je po¾adován (pou¾ívá
se pro ICMP a jiné protokoly). Jakmile máte tohle v¹echno v souboru, jediné
co potøebujete je spustit IPF démona.
</p>

<br>

<a name="nat2.5"></a>
<b>Selektivní NAT</b>

<p>
Mohli byste chtít zabránit NAT pro nìkterý rozsah venkovních adres.
Pokraèujme v pøedchozím pøíkladu a pøedpokládejme, ¾e chcete, aby se pro poèítaèe v síti 24.5.0.0/28
Va¹e NAT gateway chovala jako obyèejný router bez pøekladu adres.
Potlaèit pøeklad adres pro odchozí spojení z dc0 do této podsítì mù¾ete takto:
</p>

<ul><pre>
map dc0 from 192.168.1.0/24 ! to 24.5.0.0/28  -&gt;  24.5.0.5/32 portmap tcp/udp 10000:60000
map dc0 from 192.168.1.0/24 ! to 24.5.0.0/28  -&gt;  24.5.0.5/32
</pre></ul>

<a name="nat2.5"></a>
d1317 3
a1319 2
Spu¹tìní NATu je také velmi jednoduché. Jakmile je jednou konfigurace kompletní, jsou zde dva zpùsoby jak spustit NAT. První je rebootovat OpenBSD stroj.
Je to v¹ak metoda pomìrnì nedeterministická a pro toho kdo si nainstaloval OpenBSD jenom poukazuje na neznalost problematiky.
d1323 1
a1323 1
Spu¹tìní ipnat-u z pøikazové øádky docílíte pøíkazy:
d1327 2
a1328 2
# ipf -Fa -f /etc/ipf.rules -E
# ipnat -CF -f /etc/ipnat.rules
d1332 3
a1334 9
První øádek spou¹tí IPF (pamatujte si, ¾e NAT závisí na IPF, proto IPF musí
být spu¹tìn pøed inicializací NATu ). Volby na pøíkazové øádce: "-Fa" vyèistí
filtrovací sadu od ji¾ existujících pravidel, "-f /etc/ipf.rules" øíká ipf,
kde najde filtrovací pravidla, "-E" je pøepínaè spou¹tìjící IPF démona.
</p>

<p>
Druhý øádek spou¹tí NATa. "-CF" sma¾e a instaluje nová pravidla v NAT tabulce.
"-f /etc/ipnat.rules" øíká, kde NAT najde soubor s pravidly. NAT nyní bì¾í.
d1340 2
a1341 1
editujete soubor, ale nechcete rebootovat) staèí pøedchozí pøíkaz spustit znovu. Nastavení bude obnoveno s provedenými zmìnami.
d1346 1
a1346 1
<h3><u>6.3.3 Testování NATu</u></h3>
d1350 1
a1350 1
<b>Kontrola stavu NATu</b>
d1353 3
a1355 3
Chcete-li zjistit, jak NAT právì pracuje,nebo se ujistit o tom, zda nastavení
jsou funkèní, pou¾ijte volbu "-l". Tato volba vypí¹e seznam v¹ech nastavení
a souèasných spojení, které zpracovává ipnat:
d1359 4
a1362 6
# <b>ipnat -l</b>
map dc0 192.168.1.0/24  -&gt;  24.5.0.5/32 portmap tcp/udp 10000:60000
map dc0 192.168.1.0/24  -&gt;  24.5.0.5/32

List of active sessions:
MAP 192.168.1.40  2473  &lt;-  -&gt;  24.5.0.5  13463 [129.128.5.191 80]
d1366 1
a1366 3
První dva øádky informují o souèasném nastavení NATu, které jste zapsali
do /etc/ipnat.rules ji¾ døíve. Øádek pod nimi ukazuje seznam souèasných spojení,
které NAT kontroluje. 
a1367 1

d1369 1
a1369 1
<b>"MAP 192.168.1.40  2473"</b>
d1371 2
a1372 2
Toto vám øíká IP adresu stroje na LAN, který pou¾ívá NAT. Port pou¾itý pro toto
spojení je zobrazen za ní.
a1374 1

d1376 1
a1376 1
<b>"&lt;- -&gt;"</b>
d1378 1
a1378 1
Toto ukazuje, ¾e NAT zpracovává spojení v obou smìrech.
a1380 1

d1382 1
a1382 1
<b>"24.5.0.5  13463"</b>
d1384 1
a1384 1
Toto øíká, ¾e spojení jde do internetu pøes IP adresu 24.5.0.5 a port 13463.
a1386 1

d1388 1
a1388 1
<b>"129.128.5.191 80"</b>
d1390 1
a1390 1
IP adresa a port, na který spojení vede jsou vypsány jako poslední.
d1395 1
a1395 1
<b> Omezení NATu (v FTP)</b>
d1398 41
a1438 5
Existuje nìkolik omezení, která s sebou NAT pøiná¹í. Jedním z nich je FTP.
Kdy¾ se u¾ivatel spojí s FTP serverem v Internetu a ¾ádá informace nebo soubory, FTP server vytvoøí spojení s klientem a pøená¹í tyto informace. Spojení probíhá na náhodném volném portu. Toto je problém pro u¾ivatele poukou¹ející se spojit
s FTP serverem zevnitø LAN. Kdy¾ FTP server ode¹le informaci, po¹le ji na náhodný port na externí sí»ové rozhraní. Stroj s NATem ale nemá ¾ádné mapování pro 
neznámý paket a daný port, opustí tedy paket a nedodá jej. 

d1440 16
a1455 16
Vyøe¹it celý problém mù¾ete tak, ¾e se pøepnete ve FTP klientovi  do "passivního módu". Poté, kdy¾ vytváøíte spojení ven, NAT bude správnì pracovat.
<P>
IP filtr umo¾òuje jiné øe¹ení v této situaci, tj. ftp proxy, která je vestavìna
do kódu NATu. Aktivace dosáhnete tak, ¾e umístíte podobné pravidlo jako je následující pøed va¹e mapování NATu .
<PRE>
map dc0 192.168.1.0/24 -&gt; 24.5.0.5/32 proxy port ftp ftp/tcp
</pre>
S tímto øádkem na svém místì bude kernel hlídat va¹e FTP spojení a v okam¾iku
kdy se v nìm objeví pøíkaz "PORT" pøicházející z ftp klienta, nahradí
IP adresu a port se svou vlastní IP adresou a portem, který si vybere. Potom
otevøe tento port a posílat data pøes tunel na port va¹eho ftp klienta, který
jste po¾adovali. Sice takto docílíte ponìkud pomalej¹ího zpracování paketù, domnívám se ale, ¾e je ve své podstatì zanedbatelné.
ok.
<P>


d1458 1
a1458 1
<b>Pøesmìrování spojení</b>
d1462 4
a1465 2
protokol nebo port. Dobrý pøíklad tohoto je vá¹ web server nacházející se
uvnitø LAN. Pøíchozí spojení na platnou Internetovu IP adresu v¹ak budou
a1471 1

d1474 1
a1474 1
o toto postará. Pøidejte øádku podobnou této do ipnat.rules :
d1478 1
a1478 1
rdr dc0 24.5.0.5/32 port 80 -&gt; 192.168.1.80 port 80
d1482 1
a1482 1
Vysvìtlení:
a1483 1

d1487 2
a1488 1
Pøíkaz, který dáváte ipnatu. Data na této øádce mají význam pøesmìrování spojení.
a1491 1

d1493 1
a1493 1
<b>"dc0"</b>
d1495 1
a1495 1
Sí»ové rozhraní pøipojené k Internetu.
d1500 1
a1500 1
<b>"24.5.0.5/32"</b>
d1502 2
a1503 1
Pøíchozí spojení na IP adresu vý¹e (pouze na device dc0 )
d1510 2
a1511 1
Port, který má být pøesmìrován. "port 80" mù¾ete nahradit "port www". Pokud
d1513 1
a1513 1
v souboru /etc/services.
a1515 1

d1517 1
a1517 1
<b>"192.168.1.80"</b>
d1519 8
a1526 2
IP adresa a maska stroje na LAN, na který se budou pøesmìrovávat pakety.
Maska je v¾dy "/32" a proto nemusí být uvedena.
d1529 28
d1566 5
a1570 5
server. Ne v¹echny aplikace to doká¾í (obzvlá¹» hry). Dále, nejsou zde proxy
server aplikace pro v¹echny Internetové slu¾by. NAT prùhlednì mapuje va¹i iterní sí», aby mohla být spojena s Internetem. Jediná výhoda, proè pou¾ívat
proxy software narozdíl od NATu je, ¾e proxy software by mìl být bezpeèný a mù¾e
provádìt filtrování na základì obsahu paketù, uchrání tak vá¹ stroj s Windows
od macro viru, mù¾e ochránit od buffer overflowu software klienta a více. 
d1575 1
a1575 1
<b>6.3.4 Odkazy</b>
d1578 1
a1578 1
Soubory na OpenBSD:
d1580 2
a1581 2
<li>/etc/ipnat.rules - pravidla pro NAT
<li>/etc/rc.conf - nutné editovat pro spu¹tìní ipnat a ipf pøi bootu
a1582 1
<li>/usr/share/ipf/nat.1 - pøíklad pravidel pro ipnat.
d1589 2
a1590 3
<li><a href="http://www.openbsd.org/cgi-bin/man.cgi?query=ipnat&sektion=8&manpath=OpenBSD+2.">http://www.openbsd.org/cgi-bin/man.cgi?query=ipnat&sektion=8</a>
<li><a href="http://www.openbsd.org/cgi-bin/man.cgi?query=ipnat&sektion=5&manpath=OpenBSD+2.">Man page showing correct ipnat.rules syntax</a>
<li><a href="http://coombs.anu.edu.au/~avalon/">http://coombs.anu.edu.au/~avalon/</a>
d1595 2
d1603 1
a1603 1
<p>Pro pou¾ívání DHCP klienta <A HREF="http://www.openbsd.org/cgi-bin/man.cgi?query=dhclient&apropos=0&sektion=8&format=html">dhclient(8)</a> dodávaného spolu
d1618 1
a1618 1
<P>Bez ohledu na to, jak spustíte DHCP klienta, mù¾ete zeditovat soubor /etc/dhclient.conf , aby napø. nedo¹lo ke zmìnì v ji¾ nakonfigurovaném DNS na základì
d1627 1
a1627 1
<P>
d1630 1
a1630 1
Pokud chcete pou¾ívat OpenBSD jako DHCP server <A href="http://www.openbsd.org/cgi-bin/man.cgi?query=dhcpd&apropos=0&sektion=8&format=html">dhcpd(8)</a>,
d1664 1
a1664 1
<P>
d1671 1
a1671 1
Více voleb pro dhcp klienty se nachází zde: <A HREF="http://www.openbsd.org/cgi-bin/man.cgi?query=dhcp-options&apropos=0&sektion=5&format=html">dhcp-options(5)</a> .
d1681 2
a1682 2
<li><a href="http://www.openbsd.org/cgi-bin/man.cgi?query=pppd&sektion=8&format=html">pppd(8)</a> - Jedná se o ppp démona zaèlenìného do jádra systému .
<li><a href="http://www.openbsd.org/cgi-bin/man.cgi?query=ppp&sektion=8&format=html">ppp(8)</a> - Tento ppp démon pracuje jako u¾ivatelský proces (nesystémový).
d1739 1
a1739 1
záznamovou úroveò. Je mo¾né to zmìnit, více <a href="http://www.openbsd.org/cgi-bin/man.cgi?query=ppp&sektion=8&format=html">ppp(8)</a> man page. Sériový port
d1837 1
a1837 1
<P>
d1848 1
a1848 1
Normálnì to nepotøebujete dìlat. Directed broadcast umo¾òuje komukoliv poslat pakety na veøejnou adresu va¹í pøipojené sítì, pokud pou¾íváte OpenBSD jako router.<P>
d1851 1
a1851 1
pøeètìte také èlánek o <A HREF="http://www.netscan.org">smurf útocích</a>,
d1854 1
a1854 1
Na tohle tu také máme jedno sysctl. v <A HREF="http://www.openbsd.org/cgi-bin/man.cgi?query=sysctl&apropos=0&sektion=8&format=html">sysctl(8)</a> se pí¹e:
d1874 3
a1876 3
<li><a href="http://www.openbsd.org/cgi-bin/man.cgi?query=nfsd&sektion=8&format=html">nfsd(8)</a>
<li><a href="http://www.openbsd.org/cgi-bin/man.cgi?query=mountd&sektion=8&format=html">mountd(8)</a>
<li><a href="http://www.openbsd.org/cgi-bin/man.cgi?query=exports&sektion=5&format=html">exports(5)</a>
d1882 1
a1882 1
vnìj¹í pøístup na vá¹ NFS server a máte na nìm nìjaká citlivá data, dùraznì doporuèujeme, abyste zprovoznil <A HREF="faq13.html">IPSec</a>. V opaèném pøípadì
d1886 1
a1886 1
<P>
d1896 1
a1896 1
zpøístupnit pøes NFS a definuje, komu je mù¾ete zpøístupnit. V <i>/etc/exports</i> mù¾ete pou¾ít spoustu voleb a nejlépe je pøeèíst si <a href="http://www.openbsd.org/cgi-bin/man.cgi?query=exports&sektion=5&format=html">exports(5)</a> man page. My máme <i>/etc/exports</i> takovýto:
d1916 6
a1921 3
NFS serveru. Nejprve se ujistìte, ¾e máte zkompilované jádro s volbami NFSSERVER a NFSCLIENT. (jádra GENERIC jsou ok ). Dále nastavte v <i>/etc/rc.conf</i> <strong>nfs_server=YES</strong> . Tím spustíte nfsd(8) i mountd(8) po rebootování.
Pro zaèátek mù¾ete spustit démony ruènì. Musíte je spustit jako root a potøebujete se ujistit, ¾e vám na systému bì¾í portmap(8). Pøíklad jak spustit nfsd(8),
který pracuje jak na TCP tak na UDP ve 4 instancích. Mìli byste nastavit maximální poèet klientù se ¾ádostí o spojení na slu¾bu NFS.
d1923 1
a1923 1
<P>
d1937 1
a1937 1
<P>
d1941 1
a1941 1
<UL><PRE>
d1945 1
a1945 1
<P>
d1969 1
a1969 1
<p>V normálním provozu máte k dispozici dal¹í utility, které vám dovolují sledovat co se dìje na NFS. Jedna z nich je <a href="http://www.openbsd.org/cgi-bin/man.cgi?query=showmount&sektion=8&format=html">showmount(8)</a>
d1972 1
a1972 1
<P>
d1983 1
a1983 1
NFS filesystém by mìl být pøipojen pomocí pøíkazu mount(8),  nebo speciálnì <a href="http://www.openbsd.org/cgi-bin/man.cgi?query=mount_nfs&sektion=8&format=html">mount_nfs(8)</a>.
d1992 1
a1992 1
<P>
d1995 1
a1995 1
<P>
d1997 1
a1997 1
<UL><PRE>
d2001 1
a2001 1
<P>
d2005 1
a2005 1
<P>
d2007 1
a2007 1
<UL><PRE>
d2011 1
a2011 1
<P>
d2026 1
a2026 1
Máte-li OpenBSD pøipojené k Internetu pøes va¹eho ISP, mù¾ete spustit <a href="http://www.openbsd.org/cgi-bin/man.cgi?query=nslookup&sektion=8&format=html">nslookup(8)</a>, program, který provádí DNS dotazy:
d2042 1
a2042 1
ulo¾eno v <a href="http://www.openbsd.org/cgi-bin/man.cgi?query=resolv.conf&sektion=5&format=html">/etc/resolv.conf</a>. Odpovìï ale nebyla autoritativní. Pro
d2090 6
a2095 6
  <li><a href="http://www.openbsd.org/cgi-bin/man.cgi?query=dig&sektion=1&format=html">dig(1)</a>
  <li><a href="http://www.openbsd.org/cgi-bin/man.cgi?query=nslookup&sektion=8&format=html">nslookup(8)</a>
  <li><a href="http://www.openbsd.org/cgi-bin/man.cgi?query=gethostbyname&sektion=3&format=html">gethostbyname(3)</a>
  <li><a href="http://www.openbsd.org/cgi-bin/man.cgi?query=named&sektion=8&format=html">named(8)</a>
  <li><a href="http://www.openbsd.org/cgi-bin/man.cgi?query=resolver&sektion=3&format=html">resolver(3)</a>
  <li><a href="http://www.openbsd.org/cgi-bin/man.cgi?query=resolver&sektion=5&format=html">resolver(5)</a>
d2100 1
a2100 1
Pøíkaz <a href="http://www.openbsd.org/cgi-bin/man.cgi?query=dig&sektion=1&format=html">dig(1)</a> je u¾iteèný tím, ¾e vrací informaci o doménì ve stejném formátu, jaký je nutný pro konfiguraèní soubory BINDu. Mù¾ete pou¾ít  <a href="http://www.openbsd.org/cgi-bin/man.cgi?query=dig&sektion=1&format=html">dig(1)</a> pro prozkoumání nameserverù, které pracují správnì, abyste mohli porovnat jejich
d2108 2
a2109 2
je dostaèující soubor  <a href="http://www.openbsd.org/cgi-bin/man.cgi?query=hosts&sektion=5&format=html">/etc/hosts</a> s názvy lokálních strojù a jejich IP
adresami a soubor <a href="http://www.openbsd.org/cgi-bin/man.cgi?query=resolv.conf&sektion=5&format=html">/etc/resolv.conf</a>, který udává adresy DNS serverù,
d2298 6
a2303 2
<i>/etc/hosts</i>. <u>Ujistìte se, ¾e máte pøinejmen¹ím v tomto souboru polo¾ku <i>localhost</i> </u> jinak se va¹e sí» správnì nenastaví! V¹imnìte si také, ¾e
 <i>nemo</i> se mustí objevit ve vlastním hosts souboru, jinak uvidíte (vìt¹inou málo nebezpeènou) chybovou hlá¹ku pøi startu, kdy¾ <i>/etc/netstart</i> spustí <a href="http://www.openbsd.org/cgi-bin/man.cgi?query=route&sektion=8&format=html">route(8)</a> , aby pøidal <i>nemo</i> (jeho¾ adresa se objeví v  <i>/etc/myname</i>).
d2306 1
a2306 1
<h4>6.8.5.3 Pou¾ití <a href="http://www.openbsd.org/cgi-bin/man.cgi?query=dig&sektion=1&format=html">dig(1)</a> pro zkoumání výsledkù.</h4>
d2344 1
a2344 1
Démon <b>named</b> je spu¹tìn pøi startu systému z <a href="http://www.openbsd.org/cgi-bin/man.cgi?query=rc&sektion=8&format=html">/etc/rc</a>, v øádce instalované v pùvodním <a href="http://www.openbsd.org/cgi-bin/man.cgi?query=rc.conf&sektion=8&format=html">/etc/rc.conf</a>.
d2373 1
a2373 1
Ruèní spu¹tìní <b>named</b>: pou¾ijte pøíkaz <a href="http://www.openbsd.org/cgi-bin/man.cgi?query=ndc&sektion=8&format=html">ndc(8)</a>. Napøíklad:
d2385 1
a2385 1
Nejlep¹í zpùsob jak zastavit démona je pou¾ít pøíkaz <a href="http://www.openbsd.org/cgi-bin/man.cgi?query=ndc&sektion=8&format=html">ndc(8)</a>. Napøíklad:
d2393 1
a2393 1
Pokud toto nefunguje, najdìte proces id procesu named a pou¾ijte <a href="http://www.openbsd.org/cgi-bin/man.cgi?query=kill&sektion=1&format=html">kill(1)</a> pro ukonèení procesu. PID of <b>named</b>, pokud bì¾í, mù¾ete najít v první øádce souboru <i>/var/named/named.pid</i>
d2415 1
a2415 1
nebo pou¾ijte pøíkaz <a href="http://www.openbsd.org/cgi-bin/man.cgi?query=ndc&sektion=8&format=html">ndc(8)</a>. Napø.:
d2491 1
a2491 1
V dùsledku konfliktu pptp s podporou <a href="http://www.openbsd.org/cgi-bin/man.cgi?query=gre&apropos=0&sektion=0&manpath=OpenBSD+Current&arch=i386&format=html">gre(4)</a> v jádøe budete nutné pøekompilovat jádro a odstranit podporu pro gre(4).
d2518 1
a2518 1
Poté co nainstalujete balík <b>pptp</b> a nové jádro, potøebujete zeditovat soubory pro nastavení spojení. Tento balík pou¾ívá do OpenBSD zakomponované <a href="http://www.openbsd.org/cgi-bin/man.cgi?query=ppp&apropos=0&sektion=0&manpath=OpenBSD+Current&arch=i386&format=html">ppp(8)</a>, tak¾e pokud se v nìm vyznáte, pak velká èást nastavení vypadá stejnì. Rovnì¾ se podívejte na <a href="#6.5">FAQ 6.5</a>.
d2604 1
a2604 1
Originally [OpenBSD: faq6.html,v 1.106 ]
d2606 1
a2606 1
$Translation: faq6.html,v 1.8 2002/02/11 10:04:29 certik Exp $
@


1.7
log
@
sync with badlands translation CVS.
@
text
@d855 1
a855 1
zmìníte ipfilter=NO na ipfilter=YES. Tato zmìna zmìní stav vìcí pro dal¹í bootování.
d2344 1
a2344 1
Originally [OpenBSD: faq6.html,v 1.107 ]
d2346 1
a2346 1
$Translation: faq6.html,v 1.7 2001/11/24 19:49:27 certik Exp $
@


1.6
log
@
sync with badlands translation CVS.
@
text
@d855 1
a855 1
zmìníte ipf=NO na ipf=YES. Tato zmìna zmìní stav vìcí pro dal¹í bootování.
d2344 1
a2344 1
Originally [OpenBSD: faq6.html,v 1.106 ]
d2346 1
a2346 1
$Translation: faq6.html,v 1.6 2001/08/29 12:57:59 certik Exp $
@


1.5
log
@
sync with badlands translation CVS.
@
text
@d10 1
a10 1
<meta name= "copyright"     content= "This document copyright 1998-1999 by OpenBSD.">
d1911 1
a1911 7
<li>Iplementace BIND 8.x v <i>/usr/ports/net/bind8</i>.(Viz. <a href="../../cs/ports.html">ports</a>)
<li>D. J. Bernstein's <a href="http://cr.yp.to/dnscache.html">DNSCache</a>. DNSCache je také dostupná v ports tree na <i>/usr/ports/net/dnscache/</i>.
Tento program obsahuje minimalistický DNS server, který je vynikající pro místa,
která nemají velkou databázi DNS polo¾ek. DNSCache mù¾e být jednodu¹¹e øízena
pomocí skriptu. Více na home page.
<LI>Nìkteøí lidé, kteøi mìli ¹patné zku¹enosti s BINDem se rozhodli napsat Dents, jejich vlastní DNS server, <A HREF="http://www.dents.org">Dents</a>.
Obsahuje øadu zajímavých vlastností.
d1947 2
a1948 4
; type    domain                source host/file
backup file
cache
root.cache
d2344 1
a2344 1
Originally [OpenBSD: faq6.html,v 1.101 ]
d2346 1
a2346 1
$Translation: faq6.html,v 1.5 2001/07/12 19:59:38 certik Exp $
@


1.4
log
@
more updates by Milos Urbanek
@
text
@d283 1
a283 1
net.inet.ip.forwarding: 0 -> 1
d394 1
a394 1
Pokud ov¹em pou¾íváte <a href="http://www.openbsd.org/cgi-bin/man.cgi?query=ipnat&sektion=8">ipnat(8)</a>,
d399 1
a399 1
Pokud pou¾íváte <a href="http://www.openbsd.org/cgi-bin/man.cgi?query=ipnat&sektion=8">ipnat(8)</a>,
d427 1
a427 1
Také budete chtít spustit ipmon pro ladìní.
d433 2
a434 2
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=ipf&sektion=8">ipf(8)</a> a 
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=ipnat&sektion=8">ipnat(8)</a> konfigurací.
d449 1
a449 1
jsou naètena pøi startu. Pro detailnìj¹í popis si pøeètìte <a href="http://www.openbsd.org/cgi-bin/man.cgi?query=ipf&apropos=0&sektion=5&format=html">ipf(5)</a>. V pøikladech, které následují, fxp0 reprezentuje externí rozhraní k internetu. Ve va¹em  pøípadì bude patrnì jiné, na základì ethernetového adaptéru ve va¹em poèítaèi.  Pravidla pøedpokládají trvalé spojení s Internetem, jaké byste
d956 1
a956 1
From: 192.168.1.40    >>=== NAT ===>>     From: 24.5.0.5
d961 1
a961 1
To:   192.168.1.40    <<=== NAT ===<<     To: 24.5.0.5
d1044 2
a1045 2
map dc0 192.168.1.0/24 -> 24.5.0.5/32 portmap tcp/udp 10000:60000
map dc0 192.168.1.0/24 -> 24.5.0.5/32
d1115 2
a1116 2
map dc0 from 192.168.1.0/24 ! to 24.5.0.0/28 -> 24.5.0.5/32 portmap tcp/udp 10000:60000
map dc0 from 192.168.1.0/24 ! to 24.5.0.0/28 -> 24.5.0.5/32
d1170 2
a1171 2
map dc0 192.168.1.0/24 -> 24.5.0.5/32 portmap tcp/udp 10000:60000
map dc0 192.168.1.0/24 -> 24.5.0.5/32
d1174 1
a1174 1
MAP 192.168.1.40  2473  <- -> 24.5.0.5  13463 [129.128.5.191 80]
d1227 1
a1227 1
map dc0 192.168.1.0/24 -> 24.5.0.5/32 proxy port ftp ftp/tcp
d1259 1
a1259 1
rdr dc0 24.5.0.5/32 port 80 -> 192.168.1.80 port 80
d1337 2
a1338 2
<li><a href="http://www.openbsd.org/cgi-bin/man.cgi?query=ipnat&sektion=8">http://www.openbsd.org/cgi-bin/man.cgi?query=ipnat&sektion=8</a>
<li><a href="http://www.openbsd.org/cgi-bin/man.cgi?query=ipnat&sektion=5&format=html">Man page showing correct ipnat.rules syntax</a>
d1355 1
a1355 1
# <strong>echo dhcp >/etc/hostname.xl0</strong>
d1382 1
a1382 1
# <strong>echo xl1 xl2 xl3 >/etc/dhcpd.interfaces</strong>
d2059 1
a2059 1
; <<>> DiG 2.2 <<>> @@nemo.yewtopia yewtopia any any
d2063 1
a2063 1
;; ->>HEADER<<- opcode: QUERY, status: NOERROR, id: 59904
d2352 1
a2352 1
Originally [OpenBSD: faq6.html,v 1.100 ]
d2354 1
a2354 1
$Translation: faq6.html,v 1.4 2001/06/21 15:29:57 certik Exp $
@


1.3
log
@ipnat.conf -> ipnat.rules; spotted by bignose at irc.
@
text
@d2352 1
a2352 1
Originally [OpenBSD: faq6.html,v 1.99 ]
d2354 1
a2354 1
$Translation: faq6.html,v 1.3 2001/05/31 10:47:38 certik Exp $
d2356 1
a2356 1
$OpenBSD: faq6.html,v 1.2 2001/05/31 19:02:35 jufi Exp $
@


1.2
log
@
Sync with badlands translation CVS.
@
text
@d1255 1
a1255 1
o toto postará. Pøidejte øádku podobnou této do ipnat.conf :
d2356 1
a2356 1
$OpenBSD$
@


1.1
log
@
Initial commit of czech translation.
Work by Milos Urbanek.
@
text
@d116 2
d376 1
d378 4
a381 2
filtrovací pravidla pro filtrování na úrovni paketù <A HREF="http://www.openbsd.org/cgi-bin/man.cgi?query=ipf&apropos=0&sektion=8&format=html">ipf(8)</a> a mapování
poèítaèù, podsítí na okruh externích adres <A HREF="http://www.openbsd.org/cgi-bin/man.cgi?query=ipnat&apropos=0&sektion=8&format=html">ipnat(8)</a>. Konfiguraèní soubory pro tyto dvì slu¾by jsou /etc/ipf.rules a /etc/ipnat.rules.
d385 17
a401 4
Je nutné zeditovat /etc/rc.conf pro jejich aktivaci pøi startu. Potøebujete také
 mít net.inet.ip.forwarding=1 ve va¹em /etc/sysctl.conf (nebo va¹e jádro má
zakompilované napevno IPFORWARDING nebo GATEWAY volby) . Jádro rovnì¾ musí
být zkompilované s volbami IPFILTER a IPFILTER_LOG (GENERIC jádra mají tuto vlastnost).
d405 1
a405 1
Pokud máte IP filtr zakompilovaný v jádøe, ale nemáte ho aktivován v /etc/rc.conf, mù¾ete ho stále je¹tì jednodu¹¹e aktivovat.
d408 2
a409 2
# ipf -Fa -f /etc/ipf.rules -E
# ipnat -CF -f /etc/ipnat.rules
d413 2
a414 1
Volba <tt>-E</tt> u ipf 'umo¾òuje' IP filtr.  <Tt>-Fa</tt> ma¾e v¹echna pravidla pro filtrování, která mohla být ji¾ nastavena. <tt>-f /etc/ipf.rules</tt> nahraje nová pravidla ze souboru /etc/ipf.rules.
d416 1
a416 1
Pokud udìláte zmìny v /etc/ipf.rules poté co ipf je nahrán, mù¾ete pravidla
d420 1
a420 1
# ipf -Fa -f /etc/ipf.rules
d425 1
a425 1
# ipnat -CF -f /etc/ipnat.rules
d429 1
a429 1
# ipmon -Ds
d432 4
a435 2
Tento dokument obsahuje jen nìkolik základních ipf a ipnat konfigurací.
Spousta pìkných pøíkladù je v /usr/share/ipf/ . Doporuèujeme, abyste si
d437 2
a438 1
Informace o IP filtru naleznete na IP Filter <A HREF="http://false.net/ipfilter/">mailing list archív</a>, <A HREF="http://coombs.anu.edu.au/~avalon/">IP Filter web site</a>, a koneènì <A
a520 3
#############################
# begin ruleset
#############################
a525 3
##############################
# end ruleset
##############################
a536 3
#############################
# begin ruleset
#############################
a541 3
##############################
# end ruleset
##############################
a582 3
###########################
# begin ruleset
###########################
a614 4

#############################
# end ruleset
#############################
a704 3
#############################
# begin ruleset
#############################
a709 3
##############################
# end ruleset
##############################
a721 3
#############################
# begin ruleset
#############################
a726 3
##############################
# end ruleset
##############################
a737 3
###########################
# begin ruleset
###########################
a778 4

#############################
# end ruleset
#############################
d1105 15
d1945 1
a1945 1
<h4>6.8.5.1 Konfigurace v <i>/etc/named</i></h4>
d2352 1
a2352 1
Originally [OpenBSD: faq6.html,v 1.93 ]
d2354 1
a2354 1
$Translation: faq6.html,v 1.2 2001/05/10 20:19:27 certik Exp $
@

