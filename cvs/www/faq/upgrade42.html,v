head	1.42;
access;
symbols;
locks; strict;
comment	@# @;


1.42
date	2017.06.26.17.18.58;	author tb;	state Exp;
branches;
next	1.41;
commitid	jKVBuSx5No9bUpg1;

1.41
date	2017.05.21.22.57.30;	author tb;	state Exp;
branches;
next	1.40;
commitid	EIiQyNPovRsqAy4X;

1.40
date	2016.08.15.02.22.14;	author tb;	state Exp;
branches;
next	1.39;
commitid	3DeixV5YkPOb78RN;

1.39
date	2016.06.18.02.24.33;	author tj;	state Exp;
branches;
next	1.38;
commitid	IZNDXjoQTSwZtVYE;

1.38
date	2016.04.15.20.39.49;	author tb;	state Exp;
branches;
next	1.37;
commitid	jwteSMEb4rFzI8UA;

1.37
date	2016.04.09.22.55.45;	author tb;	state Exp;
branches;
next	1.36;
commitid	Wgx2QsAm21an230r;

1.36
date	2016.03.27.19.52.09;	author sthen;	state Exp;
branches;
next	1.35;
commitid	hi2ObFv9LGB98JY5;

1.35
date	2016.03.22.10.54.48;	author sthen;	state Exp;
branches;
next	1.34;
commitid	cyODCFvIgxpUoVc0;

1.34
date	2016.03.21.05.46.21;	author beck;	state Exp;
branches;
next	1.33;
commitid	zEx6zFkNSFFExu0v;

1.33
date	2016.02.25.20.58.00;	author tj;	state Exp;
branches;
next	1.32;
commitid	meXmm6pusQ2lZ39V;

1.32
date	2015.07.08.01.11.32;	author nick;	state Exp;
branches;
next	1.31;
commitid	QIEEnBvMxTNfvnfo;

1.31
date	2015.07.02.05.49.04;	author bentley;	state Exp;
branches;
next	1.30;
commitid	AP3UllesavMDEUhQ;

1.30
date	2015.05.11.11.18.30;	author sthen;	state Exp;
branches;
next	1.29;
commitid	wRrXxcro6dFYiwF8;

1.29
date	2014.03.31.01.47.54;	author nick;	state Exp;
branches;
next	1.28;

1.28
date	2008.04.30.21.27.58;	author nick;	state Exp;
branches;
next	1.27;

1.27
date	2008.01.20.17.07.10;	author saad;	state Exp;
branches;
next	1.26;

1.26
date	2008.01.19.21.39.47;	author saad;	state Exp;
branches;
next	1.25;

1.25
date	2008.01.19.17.39.43;	author saad;	state Exp;
branches;
next	1.24;

1.24
date	2007.11.01.02.40.20;	author nick;	state Exp;
branches;
next	1.23;

1.23
date	2007.11.01.02.30.57;	author nick;	state Exp;
branches;
next	1.22;

1.22
date	2007.10.27.18.58.47;	author nick;	state Exp;
branches;
next	1.21;

1.21
date	2007.10.24.22.03.34;	author nick;	state Exp;
branches;
next	1.20;

1.20
date	2007.10.24.16.29.47;	author joel;	state Exp;
branches;
next	1.19;

1.19
date	2007.10.23.00.33.26;	author nick;	state Exp;
branches;
next	1.18;

1.18
date	2007.10.21.16.54.41;	author nick;	state Exp;
branches;
next	1.17;

1.17
date	2007.10.21.16.15.27;	author nick;	state Exp;
branches;
next	1.16;

1.16
date	2007.10.19.10.44.12;	author nick;	state Exp;
branches;
next	1.15;

1.15
date	2007.10.19.02.19.02;	author nick;	state Exp;
branches;
next	1.14;

1.14
date	2007.10.19.00.24.44;	author nick;	state Exp;
branches;
next	1.13;

1.13
date	2007.10.18.22.54.03;	author nick;	state Exp;
branches;
next	1.12;

1.12
date	2007.10.17.11.09.29;	author nick;	state Exp;
branches;
next	1.11;

1.11
date	2007.10.16.03.04.05;	author nick;	state Exp;
branches;
next	1.10;

1.10
date	2007.10.16.03.00.07;	author nick;	state Exp;
branches;
next	1.9;

1.9
date	2007.10.12.19.44.04;	author sthen;	state Exp;
branches;
next	1.8;

1.8
date	2007.10.11.02.07.28;	author nick;	state Exp;
branches;
next	1.7;

1.7
date	2007.10.11.00.55.13;	author nick;	state Exp;
branches;
next	1.6;

1.6
date	2007.09.28.20.17.36;	author sthen;	state Exp;
branches;
next	1.5;

1.5
date	2007.09.09.15.04.49;	author nick;	state Exp;
branches;
next	1.4;

1.4
date	2007.08.24.10.46.33;	author nick;	state Exp;
branches;
next	1.3;

1.3
date	2007.08.20.06.19.30;	author steven;	state Exp;
branches;
next	1.2;

1.2
date	2007.08.20.05.46.10;	author steven;	state Exp;
branches;
next	1.1;

1.1
date	2007.08.15.20.49.01;	author nick;	state Exp;
branches;
next	;


desc
@@


1.42
log
@move man.openbsd.org links from http:// to https://
reduces the number of http:// links in www/ from >33k to <7k

thanks to schwarze for doing the work
@
text
@<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<html>
<head>
<title>OpenBSD Upgrade Guide: 4.1 to 4.2</title>
<meta http-equiv="Content-Type" content="text/html; charset=ISO-8859-1">
<meta name="description"   content="OpenBSD Upgrade Process for 4.1 -> 4.2">
<meta name="copyright"     content="This document copyright 2007 by OpenBSD">
<meta name="viewport"      content="width=device-width, initial-scale=1">
<link rel="stylesheet"     type="text/css" href="../openbsd.css">
<link rel="canonical"      href="https://www.openbsd.org/faq/upgrade42.html">
</head>

<body bgcolor="#ffffff" text="#000000">

<h2>
<a href="../index.html">
<font color="#0000ff"><i>Open</i></font><font color="#000084">BSD</font></a>
<font color="#e00000">Upgrade Guide: 4.1 to 4.2</font>
</h2>
<hr>
<p>
<a href="index.html">[FAQ Index]</a> |
<a href="upgrade41.html">[4.0 -> 4.1]</a> |
<a href="upgrade43.html">[4.2 -> 4.3]</a>

<p>

<i>Note: Upgrades are only supported from one release to the release
immediately following it.
Do not skip releases.</i>

<p><i>
It is highly recommended that you read through and fully understand
this process before attempting it.
If you are doing it on a critical or physically remote machine, it is
recommended that you test this process on an identical, local system to
verify its success before attempting on a critical or remote computer.
</i>

<p>
Upgrading is a convenient way to bring your OpenBSD system up to the most
recent version.
However, the results are not intended to precisely match the results of
a wipe-and-reload installation.
Old library files in particular are not removed in the upgrade process,
as they may be required by older applications that may or may not be
upgraded at this time.
If you REALLY wish to get rid of all these old files, you are probably
better off reinstalling from scratch.

<p>
Table of Contents:
<ul>
<li><a href="#before">Before upgrading</a>
  <ul>
  <li><a href="#libexpat">Packages are now using libexpat shipped with
    X; xbase42.tgz is your friend</a>
  <li><a href="#X7.2XF3">Enter X.org v7.2, exit XF3</a>
  <li><a href="#ahci">Updated ahci driver may change how disks are
    handled</a>
  <li><a href="#bgpd">bgpd filter language change</a>
  <li><a href="#ssh1">SSH protocol 1 discouraged on new installs</a>
  <li><a href="#sudo">Changes in the way sudo(8) passes environment</a>
  <li><a href="#dedc">[alpha Only] Some de(4) NICs will become dc(4)</a>
  <li><a href="#acpi">[i386 Only] apm(4) takes precedence over acpi(4)</a>
  <li><a href="#rc.conf">rc.conf</a>
  <li><a href="#kern">Modified kernel</a>
  </ul>
<li><a href="#upgrade">The upgrade process</a>
<li><a href="#final">Final steps</a>
  <ul>
  <li><a href="#etcUpgrade">Upgrading <tt>/etc</tt></a>
  <li><a href="#Kernchk">Checking the kernel</a>
  <li><a href="#Xup">X configuration files</a>
  <li><a href="#Pkgup">Upgrading packages</a>
  </ul>
</ul>

<hr>
<p>
<h2 id="before">Before upgrading: things to think about and be aware of</h2>

This is <i>not</i> a complete list of the changes that took place
between 4.1 and 4.2, but rather some of the important things that will
impact a large number of users in the upgrade process.
For a more complete list of changes, see
<a href="../plus42.html">plus42.html</a> and the CVS change logs.


<ul>
<li id="libexpat"><b>Packages are now using libexpat shipped with X;
xbase42.tgz is your friend:</b><br>
The libexpat port has been removed.
Packages now use the libexpat which is shipped with X instead.
Many packages depend on libexpat through other dependencies.
For instance, many packages require gettext which depends on
libexpat. Therefore, these packages also depend on libexpat.

<p>
This means that many systems that weren't using X before will now need to
have <tt>xbase42.tgz</tt> installed.
If you don't do this and try to install a package that requires libexpat,
pkg_add(1) will give an error message.

<p>
Also note that building ports is only supported with a full installation,
including <i>all</i> X file sets.

<p>
Finally, after upgrading all your packages to the 4.2 versions, clean up
by removing the old expat package from your system:

<blockquote><pre>
# <b>pkg_delete expat</b>
</pre></blockquote>

<i>This will impact a large number of users!</i>
This was an unfortunate decision whose ramifications were not recognized
earlier in the process.
For 4.3, libexpat will be part of <tt>base43.tgz</tt>, solving this
problem.

<p>
<li id="X7.2XF3"><b>Enter X.org v7.2, exit XF3:</b><br>
A new version of X is in OpenBSD 4.2.
Your old X configuration may need to be adjusted, but many people will
find they don't need an X configuration file at all anymore.

<p>
As OpenBSD adapts to the newest versions of X.org, support for
XF3 on the i386 platform (the only platform it was used on still)
has been dropped.
XF3 was needed only for some very old video chips which were not
supported by XF4 and X.org.
It is not believed this will impact many people.

<p>
The new X.org version changes a lot of config files, so there is a
<a href="#Xup">separate section</a> to this upgrade process for X users.

<p>
<li id="ahci"><b>Updated
<a href="https://man.openbsd.org/ahci.4">ahci</a>
driver may change how disks are handled:</b><br>
Systems using the ahci(4) driver may find SATA disks which had been
recognized and handled by the
<a href="https://man.openbsd.org/wd.4">wd(4)</a>
(i.e., wd0) to become
<a href="https://man.openbsd.org/sd.4">sd(4)</a>
(i.e., sd0) devices.
Watch the <tt>dmesg</tt> output at boot.
A drive which turned up earlier as:

<p>
<blockquote><tt>
pciide1 at pci0 dev 31 function 2 "Intel 82801GBM AHCI SATA" rev 0x02: DMA, channel 0 wired to native-PCI, channel 1 wired to native-PCI<br>
pciide1: using apic 2 int 11 (irq 11) for native-PCI interrupt<br>
wd0 at pciide1 channel 0 drive 0: &lt;FUJITSU MHV2080BH&gt;<br>
wd0: 16-sector PIO, LBA48, 76319MB, 156301488 sectors<br>
wd0(pciide1:0:0): using PIO mode 4, Ultra-DMA mode 5
</tt></blockquote>

now instead turns up as:

<p>
<blockquote><tt>
ahci0 at pci0 dev 31 function 2 "Intel 82801GBM AHCI SATA" rev 0x02: AHCI 1.1: apic 2 int 16 (irq 11)<br>
scsibus1 at ahci0: 32 targets<br>
sd0 at scsibus1 targ 0 lun 0: &lt;ATA, FUJITSU MHV2080B, 0084&gt; SCSI2 0/direct fixed<br>
sd0: 76319MB, 76319 cyl, 64 head, 32 sec, 512 bytes/sec, 156301488 sec total
</tt></blockquote>

This will cause problems for people doing remote upgrades of these
machines, as if the fstab file is not "correct", the system will not
complete booting.
Unfortunately, how the driver handles the disk is dependent upon a lot
of things including BIOS configurations, so IF one has an AHCI SATA
interface, one will have to experiment with a similarly configured
local machine to see if the <tt>/etc/fstab</tt> file will need to be
re-worked.

<p>
It is believed very few people will be hit by this now, as ahci(4)
devices are moderately rare on existing hardware, though becoming much
more common now.

<p>
<li id="bgpd"><b>bgpd filter language change:</b><br>
bgpd filters using only <tt>prefixlen</tt> as filter parameter now need to
include an address family identifier like <tt>inet</tt> or
<tt>inet6</tt>:

<p>
<blockquote><tt>
allow from any <b>inet</b> prefixlen 8 - 24<br>
deny from any <b>inet6</b> prefixlen &gt; 64<br>
</tt></blockquote>

<p>As a reminder, bgplg and associated binaries are disabled at
install/upgrade time. If you use them, they must be re-enabled as
described in
<a href="https://man.openbsd.org/bgplg.8">bgplg(8)</a>.

<p>
<li id="ssh1"><b>SSH protocol 1 discouraged on new installs:</b><br>
New OpenBSD installs will default to not accepting SSH v1 connections.
This upgrade process will not replace the <tt>/etc/ssh</tt>
configuration files, but you may wish to manually do this to gain the
new behavior.
The following diff shows what has changed on new installs:

<blockquote><pre>
--- ./etc/ssh/sshd_config       Sat Mar 10 20:31:32 2007
+++ ../42/etc/ssh/sshd_config   Tue Aug 28 11:59:52 2007
@@@@ -11,3 +11,2 @@@@
 #Port 22
-#Protocol 2,1
 #AddressFamily any
@@@@ -15,2 +14,7 @@@@
 #ListenAddress ::
+
+# Disable legacy (protocol version 1) support in the server for new
+# installations. In future the default will change to require explicit
+# activation of protocol 1
+Protocol 2

</pre></blockquote>

Again, this change is NOT part of the standard upgrade process.

<p>
<li id="sudo"><b>Changes in the way sudo(8) passes environment:</b><br>
For security reasons
<a href="https://man.openbsd.org/sudo.8">sudo(8)</a>
will now reset the environment to a small default set
with only certain variables preserved from the previous environment.

<p>
In order for many things to continue to work as expected, the patch file
<a href="#patchfile">below</a> will add a "<tt>Defaults env_keep</tt>"
line to your <tt>/etc/sudoers</tt> file and otherwise try to make the
file look like the one in <tt>etc42.tgz</tt>, but will possibly fail.
You will want to make sure your <tt>sudoers</tt> file contains
a line that looks something like:
<blockquote><pre>
%wheel       ALL=(ALL) SETENV: ALL
  <i>-- or --</i>
%wheel       ALL=(ALL) NOPASSWD: SETENV: ALL
</pre></blockquote>

assuming you wish "wheel" group users to have full sudo rights.
It would probably be wise to test sudo(8) for proper operation before
logging out of the system after the patch file is applied.

<p>
<li id="dedc"><b>[alpha Only] Some de(4) NICs will become dc(4):</b><br>
On the <a href="../alpha.html">alpha</a> platform, some NICs which had
been supported by the
<a href="https://man.openbsd.org/de.4">de(4)</a>
driver will now be supported by
<a href="https://man.openbsd.org/dc.4">dc(4)</a>.

<p>
IF your NIC is one of these, you will need to alter at least your <tt>/etc/hostname.deX</tt>
(hint: hard link) and your pf.conf files as appropriate.

<p>
Again, this is <i>only</i> on the alpha platform.

<p>
<li id="acpi"><b>[i386 Only] apm(4) takes precedence over acpi(4)</b><br>
The device detection on i386 has been modified to make
<a href="https://man.openbsd.org/OpenBSD-4.2/i386/apm.4">
apm(4)</a> take precedence over
<a href="https://man.openbsd.org/acpi.4">
acpi(4)</a>.
It means that if your hardware has both apm and acpi devices, only apm will
attach.
If for some reason you prefer to use acpi, disable <tt>apm</tt> on your
acpi-enabled kernel using <tt>config(8)</tt> or <tt>boot -c</tt>.

<p>
<li id="rc.conf"><b>rc.conf:</b><br>
Unlike earlier versions of this process, since
<a href="upgrade41.html">4.1</a> it is assumed that
<tt>/etc/rc.conf</tt> is not a user-altered file.
If you have made changes to your <tt>/etc/rc.conf</tt> file, merge those
changes into <tt>/etc/rc.conf.local</tt>.
If you have NO <tt>/etc/rc.conf.local</tt>, simply copy your existing
<tt>/etc/rc.conf</tt> file to <tt>/etc/rc.conf.local</tt> and
<i>delete the last line of the script!</i>
Otherwise, pull your existing <tt>rc.conf</tt> into the top of your
existing <tt>rc.conf.local</tt> file <i>and remove the last line</i>
before doing the rest of this process.

<p>
<li id="kern"><b>Modified kernel:</b><br>
Check whether you have made any modifications to your kernel.
For example, you might have modified your network device to use a
non-default setting using config(8).
Note your changes, so you can repeat them for the new 4.2 kernel.

</ul>

<p>
<hr>
<h2 id="upgrade">The upgrade process</h2>

<h3>Upgrading by install kernel</h3>
If you have access to the system's console, the easiest and safest way
to upgrade is to boot from install media or
<a href="faq4.html#bsd.rd">bsd.rd</a> and follow the upgrade steps,
which are very similar to the <a href="faq4.html">install process</a>.
Afterwards, complete the upgrade by following the <a href="#final">final
steps</a> as detailed below.

<p>
One easy way to boot from the install kernel is to place the 4.2 version
of <i>bsd.rd</i> in the root of your boot drive, then instruct the boot loader
to boot using this new <i>bsd.rd</i> file.
On amd64 and i386, you do this by entering "<tt>boot bsd.rd</tt>" at the
initial <tt>boot&gt;</tt> prompt.

<h3>Upgrading without install kernel</h3>
<i>This is NOT the recommended process.  Use the install kernel method
if at all possible!</i>

<p>
Sometimes, one needs to do an upgrade of a machine when one can't easily
use the normal upgrade process.
The most common case is when the machine is in a remote location and you
don't have easy access to the system console.
One can usually do this by carefully following this process:

<ul>
<li><b>Place install files in a "good" location</b>.
Make sure you have sufficient space!

<p>
<li><b>Stop any "insecure" applications from starting at boot:</b>
There will be a time when PF will be unlikely to be running during this
upgrade process, but your applications may still start and run properly.
Any application dependent upon PF for security should be disabled
before this happens, and should not be re-enabled until proper PF
operation is verified after upgrade.
There may be other applications which you wish to keep from running
during the upgrade, stop and disable them as well.

<p>
<li><b>Check the kernel:</b>
Although <b>most people can skip this step</b>, if you had a modified kernel
in 4.1, it is likely you will need to modify the stock kernel of 4.2.
Especially when you are performing the upgrade process remotely, now is
the time to make sure the new kernel will work upon rebooting the machine.
If any changes must be made to the kernel, the safest thing to do is to
make those changes on a local 4.2 system.
This can be as simple as modifying a specific device using config(8),
or it can involve a recompilation if the option you need is not included
in the GENERIC kernel.
Please consult <a href="faq5.html">FAQ 5 - Building the system from source</a>
before considering to recompile your kernel.

<p>
<li><b>Install new kernel(s)</b>
<blockquote><pre>
<b>export RELEASEPATH=</b><i>/usr/rel</i>   <i># where you put the files</i>
<b>cd ${RELEASEPATH}</b>
<b>rm /obsd ; ln /bsd /obsd && cp bsd /nbsd && mv /nbsd /bsd</b>
<b>cp bsd.rd bsd.mp /</b>
</pre></blockquote>

Note the extra steps for copying over the primary kernel: those are done
to ensure that there is always a valid copy of the kernel on the disk
that the system can boot from should there be a really badly timed power
outage or system crash.

<p>
<li><b>Install new <tt>/etc/firmware</tt> files:</b>
Due to the fact that some uploaded "firmware" files may have been updated,
you may need to update the files in the <tt>/etc/firmware</tt> directory.
This will impact users of only a few devices, though all users can use
this step without harm.
To extract the firmware files from <tt>base42.tgz</tt>, use the
following as root:

<blockquote><pre>
<b>cd /</b>
<b>tar -C / -xzphf ${RELEASEPATH}/base42.tgz ./etc/firmware</b>
</pre></blockquote>

<p>
<li><b>Reboot on the new kernel:</b>
This might be a tempting step to skip, but it should be done now, as
usually, the new kernel will run old userland apps (such as the soon to
be important <tt>reboot</tt>!), but often a new userland will NOT
work on the old kernel.

<p>
<li><b>Install new userland applications.</b>
<i>Do NOT install <tt>etc42.tgz</tt> and <tt>xetc42.tgz</tt> now, because
that will overwrite your current configuration files!</i>

<blockquote><pre>
<b>export RELEASEPATH=</b><i>/usr/rel</i>
<b>cd ${RELEASEPATH}</b>
<b>tar -C / -xzphf base42.tgz</b>
<b>tar -C / -xzphf comp42.tgz</b>
<b>tar -C / -xzphf game42.tgz</b>
<b>tar -C / -xzphf man42.tgz</b>
<b>tar -C / -xzphf misc42.tgz</b>
<b>tar -C / -xzphf xbase42.tgz</b>
<b>tar -C / -xzphf xfont42.tgz</b>
<b>tar -C / -xzphf xserv42.tgz</b>
<b>tar -C / -xzphf xshare42.tgz</b>
</pre></blockquote>

Note: not all file sets will need to be installed for all applications,
however if you installed a file set originally, you should certainly
upgrade it with the new file set now.

<p>
Note: the files in <tt>/etc</tt> are handled separately below, so
<tt>etc42.tgz</tt> and <tt>xetc42.tgz</tt> are NOT unpacked here.

<p>
<li><b>Upgrade <tt>/dev</tt>.</b>
The new
<a href="https://man.openbsd.org/OpenBSD-4.2/i386/MAKEDEV">MAKEDEV</a>
file will be copied to /dev by the installation of
<tt>base42.tgz</tt>, so you simply need to do the following:
<blockquote><pre>
<b>cd /dev</b>
<b>./MAKEDEV all</b>
</pre></blockquote>

<p>
<li><b>Upgrade <tt>/etc</tt> as below</b>.

<p>
<li><b>Reboot</b>
</ul>

During this process,
<a href="https://man.openbsd.org/sendmail.8">sendmail(8)</a>
may produce some error messages like the following:
<pre>
    Nov 1 12:47:05 puffy sm-mta[16733]: filesys_update failed: No such file or directory, fs=., avail=-1, blocksize=380204
</pre>
These messages can be safely ignored for the moment, or you may wish to
halt sendmail(8) during the upgrade process.
Note that sendmail is not working properly at this point, and will need
to be restarted (as part of the reboot) before mail is expected to be
handled properly.

<p>

<hr>
<h2 id="final">Final steps</h2>

Whether you upgrade by using an install kernel and doing a formal
"upgrade" process, or do a "in-place" binary upgrade, there are certain
manual steps that have to be performed.

<h3 id="etcUpgrade">1. Upgrading <tt>/etc</tt></h3>

<p>
You will want to extract the <tt>etc42.tgz</tt> files to a temporary
location:
<blockquote><pre>
<b>tar -C /tmp -xzphf ${RELEASEPATH}/etc42.tgz</b>
</pre></blockquote>


Files that can probably be copied from <tt>etc42.tgz</tt> "as is":

<blockquote><pre>
etc/magic
etc/man.conf
etc/netstart
etc/rc
etc/rc.conf
etc/rpc
etc/services
etc/mail/helpfile
etc/mail/localhost.cf
etc/mail/sendmail.cf
etc/mail/submit.cf
etc/mtree/4.4BSD.dist
etc/mtree/BSD.local.dist
etc/mtree/special
</pre></blockquote>

Note that it IS possible to locally modify these files, if this has been
done, manual merging will be needed.
Pay special attention to <tt>mail/*</tt> if you are using something
other than the default Sendmail(8) configuration.
Here are copy/paste lines for copying these files, assuming you unpacked
<tt>etc42.tgz</tt> in the above recommended place:

<blockquote><pre>
<b>cd /tmp/etc
cp magic man.conf netstart rc rc.conf rpc services /etc
cp mtree/* /etc/mtree/
cp mail/helpfile mail/localhost.cf mail/submit.cf /etc/mail
cp mail/sendmail.cf /etc/mail     </b><i># Careful on this one!!</i>
</pre></blockquote>

<p id="patchfile">
Files that must be manually merged, respecting any local
changes made to them, if they were modified from the default,
otherwise, just copy them over, too:

<blockquote><pre>
etc/ntpd.conf
etc/sensorsd.conf
etc/ssh/ssh_config
etc/ssl/x509v3.cnf
etc/sudoers
etc/sysctl.conf
etc/wsconsctl.conf
var/www/conf/httpd.conf
</pre></blockquote>

The changes to these files are in <a href="upgrade42.patch">this
patch file</a>.
You can attempt to use this by executing the following as root:
<blockquote><pre>
<b>cd /</b>
<b>patch -C -p0 &lt; upgrade42.patch</b>
</pre></blockquote>

This will test the patch to see how well it will apply to YOUR system,
to actually apply it, leave off the "<tt>-C</tt>" option.
Note that it is likely that if you have customized files or not kept
them closely updated, or are upgrading from a snapshot of 3.9, they may
not accept the patch cleanly.
In those cases, you will need to manually apply the changes.
Please test this process before relying on it for a machine you can not
easily get to.

<p>
The following files have had changes which should be looked at, but it
is unlikely they should be directly copied or merged (i.e., if you are
using bgpd.conf, look at the suggested change of strategy, and decide if
it is appropriate for your use).

<blockquote><pre>
etc/bgpd.conf
etc/mail/spamd.conf
etc/ospfd.conf
etc/ssh/sshd_config
</pre></blockquote>

Finally, use
<a href="https://man.openbsd.org/newaliases.8">newaliases(8)</a>
to update the aliases database and
<a href="https://man.openbsd.org/mtree.8">mtree(8)</a>
to create any new directories:
<blockquote><pre>
<b>newaliases</b>
<b>mtree -qdef /etc/mtree/4.4BSD.dist -p / -u</b>
</pre></blockquote>

<h3 id="Kernchk">2. Checking the kernel</h3>
Note: <b>most people can skip this step!</b>
<p>
If you followed the instructions for the upgrade process without install
kernel, you have already completed this step.
However, if you used the install kernel, and if you had a modified kernel
in 4.1, it is likely you will need to modify the stock kernel of 4.2.
This can be as simple as modifying a specific device using config(8),
or it can involve a recompilation if the option you need is not included
in the GENERIC kernel.
Please consult <a href="faq5.html">FAQ 5 - Building the system from source</a>
before considering to recompile your kernel.

<h3 id="Xup">3. X configuration files</h3>
Due to the significant changes in X for this release, the easiest way to
upgrade your X for 4.2 may be to back up your existing X configuration
files, unpack xetc42.tgz, and manually merge back any changes you had
made.

<p>
The files you are most likely to want to save a copy of are
<tt>/etc/X11/xorg.conf</tt> and <tt>/etc/X11/xinit/xinitrc</tt>.
As X now often works with NO xorg.conf file, you may wish to try it
without one before you copy your file back.

<p>
Unpack xetc42.tgz as you would other file sets:
<blockquote><pre>
<b>export RELEASEPATH=/usr/rel
cd ${RELEASEPATH}
tar -C / -xzphf xetc42.tgz
</b></pre></blockquote>

<p>

<h3 id="Pkgup">4. Upgrading packages</h3>
If you installed any packages on your system, you should upgrade them
after completing the upgrade of the base system.
Be aware, however, many packages will require further setup before
and/or after upgrading the package.
Check with the application's upgrade guide for details.

<p>
The following package is known to have significant upgrade issues
that will impact a large number of users.
The fact that a package is not on this list doesn't mean it will have a
trivial upgrade.
You must do some homework on the applications YOU use.

<ul>
<li><b>xfce:</b> Configuration base directory and files have completely
changed.  You will probably have to re-create your configuration from
scratch.
</ul>

<p>
Before continuing, there are some major changes in the 4.2 release which
you should know about:

<ul>
<li>The libexpat port has been removed, and packages are now using the
libexpat shipped with X11 instead.
Many packages depend on libexpat through other dependencies.
For instance, all the packages which require gettext also depend on libexpat.
This means that before you can add or upgrade packages, you most likely
need to have <tt>xbase42.tgz</tt> installed, even if the packages you are
installing don't have a graphical operation.
Refer to the
<a href="faq4.html#FilesNeeded">FAQ</a> about adding
<tt>xbase42.tgz</tt> to an installed system.
If you don't do this and try to install a package that requires libexpat,
pkg_add(1) will give an error message.

<li>If you are using pkg_add(1) in combination with sudo(8), you will
need to change your <tt>/etc/sudoers</tt> as the
<a href="#patchfile">patch file</a> attempts to.
See <a href="#sudo">changes in sudo(8)</a> for more info.

</ul>

The package tools support in-place updating using <tt>pkg_add -u</tt>.
For instance, to update all your packages, make sure <tt>PKG_PATH</tt> is
pointing to the 4.2 packages directory on your CD or nearest FTP mirror,
and use something like

<blockquote><pre>
<b># pkg_add -ui -F update -F updatedepends</b>
</pre></blockquote>

where the <tt>-u</tt> indicates update mode, and <tt>-i</tt> specifies
interactive mode, so pkg_add will prompt you for input when it encounters
some ambiguity. Read the
<a href="https://man.openbsd.org/OpenBSD-4.2/pkg_add">pkg_add(1)</a>
manual page and the <a href="faq15.html#PkgMgmt">package management</a>
chapter of the FAQ for more information.

<p>
You will very possibly see something like this when running the above
command:
<blockquote><pre>
Looking for updates: complete
Cannot find updates for expat-2.0.0
Proceed? [y/N]
</pre></blockquote>

This is indicating you have run into the libexpat problem and must now
install <tt>xbase42.tgz</tt> as mentioned above.
If you have not installed xbase42.tgz, it is recommended that you stop
the package update, install xbase42.tgz and then re-run the package
upgrade.

<p>
Finally, after upgrading all your packages,
clean up by removing the old expat package from your system:

<blockquote><pre>
# <b>pkg_delete expat</b>
</pre></blockquote>

<p>
<a href="index.html">[FAQ Index]</a> |
<a href="upgrade41.html">[4.0 -> 4.1]</a> |
<a href="upgrade43.html">[4.2 -> 4.3]</a>

<p>
<hr>
<a href="index.html"><img height="24" width="24" src="../images/back.gif" border="0" alt="[back]"></a>
<br>
<small>$OpenBSD: upgrade42.html,v 1.41 2017/05/21 22:57:30 tb Exp $</small>

</body>
</html>
@


1.41
log
@more of these linebreaks inside <pre>
@
text
@d143 1
a143 1
<a href="http://man.openbsd.org/ahci.4">ahci</a>
d147 1
a147 1
<a href="http://man.openbsd.org/wd.4">wd(4)</a>
d149 1
a149 1
<a href="http://man.openbsd.org/sd.4">sd(4)</a>
d202 1
a202 1
<a href="http://man.openbsd.org/bgplg.8">bgplg(8)</a>.
d234 1
a234 1
<a href="http://man.openbsd.org/sudo.8">sudo(8)</a>
d259 1
a259 1
<a href="http://man.openbsd.org/de.4">de(4)</a>
d261 1
a261 1
<a href="http://man.openbsd.org/dc.4">dc(4)</a>.
d273 1
a273 1
<a href="http://man.openbsd.org/OpenBSD-4.2/i386/apm.4">
d275 1
a275 1
<a href="http://man.openbsd.org/acpi.4">
d428 1
a428 1
<a href="http://man.openbsd.org/OpenBSD-4.2/i386/MAKEDEV">MAKEDEV</a>
d444 1
a444 1
<a href="http://man.openbsd.org/sendmail.8">sendmail(8)</a>
d555 1
a555 1
<a href="http://man.openbsd.org/newaliases.8">newaliases(8)</a>
d557 1
a557 1
<a href="http://man.openbsd.org/mtree.8">mtree(8)</a>
d656 1
a656 1
<a href="http://man.openbsd.org/OpenBSD-4.2/pkg_add">pkg_add(1)</a>
d692 1
a692 1
<small>$OpenBSD: upgrade42.html,v 1.40 2016/08/15 02:22:14 tb Exp $</small>
@


1.40
log
@tls on openbsd.org is now real:
- link to https://www.openbsd.org from the sub-projects' pages
- make internal links relative
- switch link rel=canonical to https to please some search engines
"go ahead" from beck, "do it!!!!" tj
@
text
@d447 1
a447 2
    Nov 1 12:47:05 puffy sm-mta[16733]: filesys_update failed: No such file or dire
    ctory, fs=., avail=-1, blocksize=380204
d692 1
a692 1
<small>$OpenBSD: upgrade42.html,v 1.39 2016/06/18 02:24:33 tj Exp $</small>
@


1.39
log
@- shorten a few section titles and fix a title mismatch
- remove "with openbsd" from titles (it should be obvious)
- merge "adding a file set after install" into explanation of file sets
- merge "device not configured" and unsupported hardware sections
- remove invisible <p> tags

ok tb
@
text
@d10 1
a10 1
<link rel="canonical"      href="http://www.openbsd.org/faq/upgrade42.html">
d693 1
a693 1
<small>$OpenBSD: upgrade42.html,v 1.38 2016/04/15 20:39:49 tb Exp $</small>
@


1.38
log
@use short form man links in the faq and fix a few broken links
@
text
@d633 1
a633 1
<a href="faq4.html#AddFileSet">FAQ</a> about adding
d693 1
a693 1
<small>$OpenBSD: upgrade42.html,v 1.37 2016/04/09 22:55:45 tb Exp $</small>
@


1.37
log
@more css surgery, metadata and other cleanup, validation fixes.
@
text
@d143 1
a143 1
<a href="http://man.openbsd.org/?query=ahci&amp;sektion=4">ahci</a>
d147 1
a147 1
<a href="http://man.openbsd.org/?query=wd&amp;sektion=4">wd(4)</a>
d149 1
a149 1
<a href="http://man.openbsd.org/?query=sd&amp;sektion=4">sd(4)</a>
d202 1
a202 1
<a href="http://man.openbsd.org/?query=bgplg&amp;sektion=8">bgplg(8)</a>.
d233 2
a234 4
For
<a href="http://man.openbsd.org/?query=sudo&amp;sektion=8#SECURITY+NOTES"
>security reasons</a>
<a href="http://man.openbsd.org/?query=sudo&amp;sektion=8">sudo(8)</a>
d259 1
a259 1
<a href="http://man.openbsd.org/?query=de&amp;sektion=4">de(4)</a>
d261 1
a261 1
<a href="http://man.openbsd.org/?query=dc&amp;sektion=4">dc(4)</a>.
d273 1
a273 1
<a href="http://man.openbsd.org/?query=apm&amp;sektion=4&amp;arch=i386">
d275 1
a275 1
<a href="http://man.openbsd.org/?query=acpi&amp;sektion=4">
d428 1
a428 1
<a href="http://man.openbsd.org/?query=MAKEDEV&amp;sektion=8&amp;arch=i386">MAKEDEV</a>
d444 1
a444 1
<a href="http://man.openbsd.org/?query=sendmail&amp;sektion=8">sendmail(8)</a>
d556 1
a556 1
<a href="http://man.openbsd.org/?query=newaliases&amp;sektion=8">newaliases(8)</a>
d558 1
a558 1
<a href="http://man.openbsd.org/?query=mtree&amp;sektion=8">mtree(8)</a>
d657 1
a657 1
<a href="http://man.openbsd.org/?query=pkg_add&amp;sektion=1&amp;manpath=OpenBSD+4.2">pkg_add(1)</a>
d693 1
a693 1
<small>$OpenBSD: upgrade42.html,v 1.36 2016/03/27 19:52:09 sthen Exp $</small>
@


1.36
log
@add a small sprinkling of css to improve readability in the faq, ok tj@@ tb@@
@
text
@d8 3
a10 3
<meta name="viewport" content="width=device-width, initial-scale=1">
<link rel="stylesheet" type="text/css" href="../openbsd.css">
<link rel="canonical" href="http://www.openbsd.org/faq/upgrade42.html">
d14 2
d17 4
a20 2
<img alt="[OpenBSD]" height=30 width=141 src="../images/smalltitle.gif" border="0">    
</a>
d22 1
a22 7
<font color="#0000e0">
<a href="upgrade35.html">[3.4 -> 3.5]</a> |
<a href="upgrade36.html">[3.5 -> 3.6]</a> |
<a href="upgrade37.html">[3.6 -> 3.7]</a> |
<a href="upgrade38.html">[3.7 -> 3.8]</a> |
<a href="upgrade39.html">[3.8 -> 3.9]</a> |
<a href="upgrade40.html">[3.9 -> 4.0]</a> |
d24 1
a24 3
<a href="upgrade43.html">[4.2 -> 4.3]</a> |
<a href="index.html">[FAQ Index]</a>
</font>
d26 1
a26 3
<h1><font color="#e00000">Upgrade Guide: 4.1 to 4.2
</font></h1>
<hr>
d76 1
a76 1
  </ul> 
d81 1
a81 2
<a name="before"></a>
<h2>Before upgrading: things to think about and be aware of</h2>
a89 1
<a name="libexpat"></a>
d91 1
a91 1
<li><b>Packages are now using libexpat shipped with X;
d96 1
a96 1
For instance, many packages require gettext which depends on 
d124 1
a124 2
<a name="X7.2XF3"></a>
<li><b>Enter X.org v7.2, exit XF3:</b><br>
d142 1
a142 2
<a name="ahci"></a>
<li><b>Updated
d188 2
a189 3
<a name="bgpd"></a>
<li><b>bgpd filter language change:</b><br>
bgpd filters using only <tt>prefixlen</tt> as filter parameter now need to 
d205 1
a205 2
<a name="ssh1"></a>
<li><b>SSH protocol 1 discouraged on new installs:</b><br>
d219 2
a220 2
@@@@ -15,2 +14,7 @@@@  
 #ListenAddress :: 
d226 1
a226 1
        
d232 1
a232 2
<a name="sudo"></a>
<li><b>Changes in the way sudo(8) passes environment:</b><br>
d258 1
a258 2
<a name="dedc"></a>
<li><b>[alpha Only] Some de(4) NICs will become dc(4):</b><br>
d273 1
a273 2
<a name="acpi"></a>
<li><b>[i386 Only] apm(4) takes precedence over acpi(4)</b><br>
d285 1
a285 2
<a name="rc.conf"></a>
<li><b>rc.conf:</b><br>
d299 1
a299 2
<a name="kern"></a>
<li><b>Modified kernel:</b><br>
d309 1
a309 2
<a name="upgrade"></a>
<h2>The upgrade process</h2>
d345 1
a345 1
Any application dependent upon PF for security should be disabled 
d429 1
a429 1
The new 
d461 1
a461 2
<a name="final"></a>
<h2>Final steps</h2>
d463 2
a464 2
Whether you upgrade by using an install kernel and doing a formal  
"upgrade" process, or do a "in-place" binary upgrade, there are certain 
d466 2
a467 3
  
<a name="etcUpgrade"></a>
<h3>1. Upgrading <tt>/etc</tt></h3>
d500 1
a500 1
Here are copy/paste lines for copying these files, assuming you unpacked 
d511 3
a513 4
<p>
<a name="patchfile"></a>
Files that must be manually merged, respecting any local 
changes made to them, if they were modified from the default, 
d567 1
a567 2
<a name="Kernchk"></a>
<h3>2. Checking the kernel</h3>
d580 1
a580 2
<a name="Xup"></a>
<h3>3. X configuration files</h3>
d590 1
a590 1
without one before you copy your file back. 
d602 1
a602 2
<a name="Pkgup"></a>
<h3>4. Upgrading packages</h3>
d651 1
a651 1
 
d669 1
a669 1
Proceed? [y/N] 
d680 1
a680 1
clean up by removing the old expat package from your system:   
d687 1
a687 7
<font color="#0000e0">
<a href="upgrade35.html">[3.4 -> 3.5]</a> |
<a href="upgrade36.html">[3.5 -> 3.6]</a> |
<a href="upgrade37.html">[3.6 -> 3.7]</a> |
<a href="upgrade38.html">[3.7 -> 3.8]</a> |
<a href="upgrade39.html">[3.8 -> 3.9]</a> |
<a href="upgrade40.html">[3.9 -> 4.0]</a> |
d689 1
a689 3
<a href="upgrade43.html">[4.2 -> 4.3]</a> |
<a href="index.html">[FAQ Index]</a>
</font>
d695 1
a695 1
<small>$OpenBSD: upgrade42.html,v 1.35 2016/03/22 10:54:48 sthen Exp $</small>
@


1.35
log
@fix URIs, the / before querystring isn't optional, if it isn't fixed up
by the browser the server returns 400 Bad Request
@
text
@d8 2
d727 1
a727 1
<small>$OpenBSD: upgrade42.html,v 1.34 2016/03/21 05:46:21 beck Exp $</small>
@


1.34
log
@change http://www.openbsd.org/cgi-bin/man.cgi to be http://man.openbsd.org
this points stuff to the new place and gets us ready to deprecate the old
place we did this.
@
text
@d151 1
a151 1
<a href="http://man.openbsd.org?query=ahci&amp;sektion=4">ahci</a>
d155 1
a155 1
<a href="http://man.openbsd.org?query=wd&amp;sektion=4">wd(4)</a>
d157 1
a157 1
<a href="http://man.openbsd.org?query=sd&amp;sektion=4">sd(4)</a>
d211 1
a211 1
<a href="http://man.openbsd.org?query=bgplg&amp;sektion=8">bgplg(8)</a>.
d245 1
a245 1
<a href="http://man.openbsd.org?query=sudo&amp;sektion=8#SECURITY+NOTES"
d247 1
a247 1
<a href="http://man.openbsd.org?query=sudo&amp;sektion=8">sudo(8)</a>
d273 1
a273 1
<a href="http://man.openbsd.org?query=de&amp;sektion=4">de(4)</a>
d275 1
a275 1
<a href="http://man.openbsd.org?query=dc&amp;sektion=4">dc(4)</a>.
d288 1
a288 1
<a href="http://man.openbsd.org?query=apm&amp;sektion=4&amp;arch=i386">
d290 1
a290 1
<a href="http://man.openbsd.org?query=acpi&amp;sektion=4">
d446 1
a446 1
<a href="http://man.openbsd.org?query=MAKEDEV&amp;sektion=8&amp;arch=i386">MAKEDEV</a>
d462 1
a462 1
<a href="http://man.openbsd.org?query=sendmail&amp;sektion=8">sendmail(8)</a>
d577 1
a577 1
<a href="http://man.openbsd.org?query=newaliases&amp;sektion=8">newaliases(8)</a>
d579 1
a579 1
<a href="http://man.openbsd.org?query=mtree&amp;sektion=8">mtree(8)</a>
d681 1
a681 1
<a href="http://man.openbsd.org?query=pkg_add&amp;sektion=1&amp;manpath=OpenBSD+4.2">pkg_add(1)</a>
d725 1
a725 1
<small>$OpenBSD: upgrade42.html,v 1.33 2016/02/25 20:58:00 tj Exp $</small>
@


1.33
log
@old XXX comments in these files make it difficult to grep for things that
actually need to be fixed.
@
text
@d151 1
a151 1
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=ahci&amp;sektion=4">ahci</a>
d155 1
a155 1
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=wd&amp;sektion=4">wd(4)</a>
d157 1
a157 1
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=sd&amp;sektion=4">sd(4)</a>
d211 1
a211 1
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=bgplg&amp;sektion=8">bgplg(8)</a>.
d245 1
a245 1
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=sudo&amp;sektion=8#SECURITY+NOTES"
d247 1
a247 1
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=sudo&amp;sektion=8">sudo(8)</a>
d273 1
a273 1
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=de&amp;sektion=4">de(4)</a>
d275 1
a275 1
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=dc&amp;sektion=4">dc(4)</a>.
d288 1
a288 1
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=apm&amp;sektion=4&amp;arch=i386">
d290 1
a290 1
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=acpi&amp;sektion=4">
d446 1
a446 1
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=MAKEDEV&amp;sektion=8&amp;arch=i386">MAKEDEV</a>
d462 1
a462 1
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=sendmail&amp;sektion=8">sendmail(8)</a>
d577 1
a577 1
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=newaliases&amp;sektion=8">newaliases(8)</a>
d579 1
a579 1
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=mtree&amp;sektion=8">mtree(8)</a>
d681 1
a681 1
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=pkg_add&amp;sektion=1&amp;manpath=OpenBSD+4.2">pkg_add(1)</a>
d725 1
a725 1
<small>$OpenBSD: upgrade42.html,v 1.32 2015/07/08 01:11:32 nick Exp $</small>
@


1.32
log
@
better pages <title>, better matching the page.  From Pavel Plamenov
(pvlplmnv at gmail), thanks!
@
text
@a93 1
<!-- XXX add new stuff -->
d725 1
a725 1
<small>$OpenBSD: upgrade42.html,v 1.31 2015/07/02 05:49:04 bentley Exp $</small>
@


1.31
log
@Clean up meta tags.

name=distribution, name=keywords, and name=resource-type have no effect
in modern search engines and just clutter up the page source.

From Pavel Plamenov.
@
text
@d4 1
a4 1
<title>OpenBSD Upgrade Guide 4.2</title>
d726 1
a726 1
<small>$OpenBSD: upgrade42.html,v 1.30 2015/05/11 11:18:30 sthen Exp $</small>
@


1.30
log
@Add 'link rel="canonical"' to pages, acting as a hint to search engines
to list the copies on www.openbsd.org rather than mirrors.

From Carlin Bingham, ok millert@@ nick@@
@
text
@a5 1
<meta name="resource-type" content="document">
a6 2
<meta name="keywords"      content="openbsd,faq,upgrade,4.2">
<meta name="distribution"  content="global">
d726 1
a726 1
<small>$OpenBSD: upgrade42.html,v 1.29 2014/03/31 01:47:54 nick Exp $</small>
@


1.29
log
@
www@@ is no more.  normalized 54 to new footer style, but rest were left
unchanged deliberately.
@
text
@d11 1
d729 1
a729 1
<small>$OpenBSD: upgrade42.html,v 1.28 2008/04/30 21:27:58 nick Exp $</small>
@


1.28
log
@
link in upgrade43.html
@
text
@a4 1
<link rev="made" href="mailto:www@@openbsd.org">
a726 1
<a href="mailto:www@@openbsd.org">www@@openbsd.org</a>
d728 1
a728 1
<small>$OpenBSD: upgrade42.html,v 1.27 2008/01/20 17:07:10 saad Exp $</small>
@


1.27
log
@typos, better wording.
ok nick@@
@
text
@d27 1
d721 1
d730 1
a730 1
<small>$OpenBSD: upgrade42.html,v 1.26 2008/01/19 21:39:47 saad Exp $</small>
@


1.26
log
@back out last commit which was done by mistake during translation sync.
wait for nick@@'s ok for the set of typos/rewording that appears in that
version before committing an update again, if ever. apologies.
@
text
@d105 2
a106 2
For instance, the many packages which use gettext, also depend on
libexpat.
d109 1
a109 1
This means that many systems that do not use X before will now need to
d174 1
a174 1
now instead turns up as
d213 2
a214 1
described in bgplg(8).
d655 1
a655 1
For instance, all the packages which use gettext, also depend on libexpat.
d728 1
a728 1
<small>$OpenBSD: upgrade42.html,v 1.24 2007/11/01 02:40:20 nick Exp $</small>
@


1.25
log
@Sync with Steelix CVS
@
text
@d105 1
a105 1
For instance, all the packages which require gettext also depend on
d109 1
a109 1
This means that many systems that weren't using X before will now need to
d174 1
a174 1
now instead turns up as:
d185 1
a185 1
machines, as if the <tt>/etc/fstab</tt> file is not "correct", the system will not
d188 1
a188 1
of things including BIOS configurations, so if one has an AHCI SATA
d213 1
a213 2
described in
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=bgplg&amp;apropos=0&amp;sektion=0&amp;manpath=OpenBSD+Current&amp;arch=i386&amp;format=html">bgplg(8)</a>.
d654 1
a654 1
For instance, all the packages which require gettext also depend on libexpat.
@


1.24
log
@
another one that should have been in a few weeks ago:
Maintainer of port Xfce, Landry Breuil, pointed out that xfce has an
annoying upgrade issue, so reinsert the package upgrade warning section.
@
text
@d105 1
a105 1
For instance, the many packages which use gettext, also depend on
d109 1
a109 1
This means that many systems that do not use X before will now need to
d174 1
a174 1
now instead turns up as
d185 1
a185 1
machines, as if the fstab file is not "correct", the system will not
d188 1
a188 1
of things including BIOS configurations, so IF one has an AHCI SATA
d213 2
a214 1
described in bgplg(8).
d655 1
a655 1
For instance, all the packages which use gettext, also depend on libexpat.
d728 1
a728 1
<small>$OpenBSD: upgrade42.html,v 1.23 2007/11/01 02:30:57 nick Exp $</small>
@


1.23
log
@
figures.  Stare at the thing for days, can't find anything else to change.
Commit it, THEN remember stuff that should have been in there long ago.
Paul Stoeber (x0001 at x dot .de1 dot cc) pointed out that the 'h' option
has been used in the install/update scripts for quite some time.
@
text
@d634 13
d727 1
a727 1
<small>$OpenBSD: upgrade42.html,v 1.22 2007/10/27 18:58:47 nick Exp $</small>
@


1.22
log
@
well, one easy answer to where to put this info (about a change in behavior)
is here (duh!).  Apparently Pierre Riteau has got more sleep than me
recently.  From pierre dot riteau at free dot fr, thanks!
@
text
@d408 1
a408 1
<b>tar -C / -xzpf ${RELEASEPATH}/base42.tgz ./etc/firmware</b>
d426 9
a434 9
<b>tar -C / -xzpf base42.tgz</b>
<b>tar -C / -xzpf comp42.tgz</b>
<b>tar -C / -xzpf game42.tgz</b>
<b>tar -C / -xzpf man42.tgz</b>
<b>tar -C / -xzpf misc42.tgz</b>
<b>tar -C / -xzpf xbase42.tgz</b>
<b>tar -C / -xzpf xfont42.tgz</b>
<b>tar -C / -xzpf xserv42.tgz</b>
<b>tar -C / -xzpf xshare42.tgz</b>
d493 1
a493 1
<b>tar -C /tmp -xzpf ${RELEASEPATH}/etc42.tgz</b>
d620 1
a620 1
tar -C / -xzpf xetc42.tgz
d714 1
a714 1
<small>$OpenBSD: upgrade42.html,v 1.21 2007/10/24 22:03:34 nick Exp $</small>
@


1.21
log
@
remove dup info on sudo, get rid of XXX, simplify.  XXX spotted by joel@@
@
text
@d71 1
d287 13
d714 1
a714 1
<small>$OpenBSD: upgrade42.html,v 1.20 2007/10/24 16:29:47 joel Exp $</small>
@


1.20
log
@Better wording and a typo
@
text
@d637 4
a640 7
<li>For security reasons, sudo(8) will reset the environment to a small
default set of variables.
If you are using pkg_add(1) in combination with sudo(8), you will
need to change your <tt>/etc/sudoers</tt> file to at least pass the
PKG_PATH variable!
XXX
Read above for more information.
d700 1
a700 1
<small>$OpenBSD: upgrade42.html,v 1.19 2007/10/23 00:33:26 nick Exp $</small>
@


1.19
log
@
sensorsd.conf is a patch, not copy over.  Spotted by henning@@
@
text
@d200 2
a201 2
bgpd filters using only <tt>prefixlen</tt> as filter parameter need to 
include now a address family identifier like <tt>inet</tt> or
d674 1
a674 1
If you have not installed xbase42.html, it is recommended that you stop
d703 1
a703 1
<small>$OpenBSD: upgrade42.html,v 1.18 2007/10/21 16:54:41 nick Exp $</small>
@


1.18
log
@
improve TOC to be actually semi-useful.
@
text
@a491 1
etc/sensorsd.conf
d511 1
a511 1
cp magic man.conf netstart rc rc.conf rpc sensorsd.conf services /etc
d525 1
d703 1
a703 1
<small>$OpenBSD: upgrade42.html,v 1.17 2007/10/21 16:15:27 nick Exp $</small>
@


1.17
log
@
Reorder/restructure document.
For unknown reasons, I split up the change alerts into something at the
top of the document and something else deep in the middle of the upgrade.
I think it made sense at the time, but it decayed into a mess.  Move all
advisories and warnings to the top.
Reorder slightly.
Add section about Alpha de(4) -> dc(4) change.
Add a #Xup target.
@
text
@d61 13
d76 6
d97 1
d132 1
d151 1
d198 1
d215 1
d243 1
d254 3
a256 3
below will add a "<tt>Defaults env_keep</tt>" line to your
<tt>/etc/sudoers</tt> file and otherwise try to make the file look like
the one in <tt>etc42.tgz</tt>, but will possibly fail.
d270 1
d286 1
d301 1
d468 4
a474 4
Whether you upgrade by using an install kernel and doing a formal
"upgrade" process, or do a "in-place" binary upgrade, there are certain
manual steps that have to be performed.

d519 1
d574 1
d611 1
a623 1
<p>
d703 1
a703 1
<small>$OpenBSD: upgrade42.html,v 1.16 2007/10/19 10:44:12 nick Exp $</small>
@


1.16
log
@
one again, I'm caught committing Comma Abuse.  This time, by Theo himself.
@
text
@d70 6
d106 4
a109 24
<p>

<li><b>Modified kernel:</b><br>
Check whether you have made any modifications to your kernel.
For example, you might have modified your network device to use a
non-default setting using config(8).
Note your changes, so you can repeat them for the new 4.2 kernel.

<p>
<li><b>rc.conf:</b><br>
Unlike earlier versions of this process, since
<a href="upgrade41.html">4.1</a> it is assumed that
<tt>/etc/rc.conf</tt> is not a user-altered file.
If you have made changes to your <tt>/etc/rc.conf</tt> file, merge those
changes into <tt>/etc/rc.conf.local</tt>.
If you have NO <tt>/etc/rc.conf.local</tt>, simply copy your existing
<tt>/etc/rc.conf</tt> file to <tt>/etc/rc.conf.local</tt> and 
<i>delete the last line of the script!</i>
Otherwise, pull your existing <tt>rc.conf</tt> into the top of your
existing <tt>rc.conf.local</tt> file <i>and remove the last line</i>
before doing the rest of this process.

<p>
Failure to do this will probably result in unhappy results.
d126 2
a127 2
The new X.org version changes a lot of config files, so there is
a separate section to this upgrade process for X users.
d175 105
a446 61
<a name="apps"></a>
<h4>1.2. Operational changes</h4>
This is <i>not</i> a complete list of the changes that took place
between 4.1 and 4.2, but rather some of the important things that will
impact a large number of users in the upgrade process.
For a more complete list of changes, see
<a href="../plus42.html">plus42.html</a> and the CVS change logs.

<ul>
<p>
<li><b>bgpd filter language change:</b><br>
bgpd filters using only <tt>prefixlen</tt> as filter parameter need to 
include now a address family identifier like <tt>inet</tt> or
<tt>inet6</tt>:

<p>
<blockquote><tt>
allow from any <b>inet</b> prefixlen 8 - 24<br>
deny from any <b>inet6</b> prefixlen &gt; 64<br>
</tt></blockquote>

<p>As a reminder, bgplg and associated binaries are disabled at
install/upgrade time. If you use them, they must be re-enabled as
described in bgplg(8).

<p>
<li><b>SSH protocol 1 discouraged on new installs:</b><br>
New OpenBSD installs will default to not accepting SSH v1 connections.
This upgrade process will not replace the <tt>/etc/ssh</tt>
configuration files, but you may wish to manually do this to gain the
new behavior.
The following diff shows what has changed on new installs:

<blockquote><pre>
--- ./etc/ssh/sshd_config       Sat Mar 10 20:31:32 2007
+++ ../42/etc/ssh/sshd_config   Tue Aug 28 11:59:52 2007
@@@@ -11,3 +11,2 @@@@
 #Port 22
-#Protocol 2,1
 #AddressFamily any
@@@@ -15,2 +14,7 @@@@  
 #ListenAddress :: 
+
+# Disable legacy (protocol version 1) support in the server for new
+# installations. In future the default will change to require explicit
+# activation of protocol 1
+Protocol 2
        
</pre></blockquote>

Again, it is NOT part of the standard upgrade process.

<p>
<li><b>Changes in the way sudo(8) passes environment:</b>
For
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=sudo&amp;sektion=8#SECURITY+NOTES"
>security reasons</a>
<a href="http://www.openbsd.org/cgi-bin/man.cgi?query=sudo&amp;sektion=8">sudo(8)</a>
will now reset the environment to a small default set
with only certain variables preserved from the previous environment.

a447 20
In order for many things to continue to work as expected, the patch file
below will add a "<tt>Defaults env_keep</tt>" line to your
<tt>/etc/sudoers</tt> file and otherwise try to make the file look like
the one in <tt>etc42.tgz</tt>, but will probably fail.
You will want to make sure your <tt>sudoers</tt> file contains
a line that looks something like:
<blockquote><pre>
%wheel       ALL=(ALL) SETENV: ALL
  <i>-- or --</i>
%wheel       ALL=(ALL) NOPASSWD: SETENV: ALL
</pre></blockquote>

assuming you wish "wheel" group users to have full sudo rights.



</ul>

<a name="etcfiles"></a>
<h4>1.3. <tt>/etc</tt> file changes</h4>
d558 1
d673 1
a673 1
<small>$OpenBSD: upgrade42.html,v 1.15 2007/10/19 02:19:02 nick Exp $</small>
@


1.15
log
@
Upgraders don't (in general) care what Xenocara is.  Zero reason to
mention it here.  It's X, that's what's important to the users.
Pointed out by deraadt@@.
@
text
@d111 1
a111 1
<a href="upgrade41.html">4.1</a>, it is assumed that
d662 1
a662 1
<small>$OpenBSD: upgrade42.html,v 1.14 2007/10/19 00:24:44 nick Exp $</small>
@


1.14
log
@
enter upgrade42.patch  (and there was much rejoicing!)
This makes upgrade42.html usable and ready for testing.
Add more on libexpat (yeah, bit me, so you get better docs).
Tested on (at least) four machines of mine, plus some testing and
examination by henning@@.
Yes, that sudoers diff is wacky... all five of 'em.  If you have a
better idea, speak up.
@
text
@d73 1
a73 1
<li><b>Packages are now using libexpat shipped with xenocara;
d76 1
a76 1
Packages now use the libexpat which is shipped with xenocara instead.
d126 2
a127 3
<li><b>Enter Xenocara, exit XF3:</b><br>
A new version of X is in OpenBSD 4.2, and along with it, a new tree and
build process called <a href="http://www.xenocara.com">Xenocara</a>.
d578 1
a578 1
Before continuing, there are two major changes in the 4.2 release which
d662 1
a662 1
<small>$OpenBSD: upgrade42.html,v 1.13 2007/10/18 22:54:03 nick Exp $</small>
@


1.13
log
@
sendmail.cf was missing from the list of files to copy over, but it was
(properly) in the sample cp commands.  Spotted by Frank Bax, who gets
lots of thanks for looking this over that closely.  (believe it or not,
I actually counted the files and the list...never said I could count)
@
text
@d30 1
a30 2
<h1><font color="#e00000"><!-- Upgrade Guide: 4.1 to 4.2 -->
Work in progress, don't even try it (yet)!
d497 1
a497 1
non-existent patch file</a>.
d624 15
d663 1
a663 1
<small>$OpenBSD: upgrade42.html,v 1.12 2007/10/17 11:09:29 nick Exp $</small>
@


1.12
log
@
Move the libexpat up in the list of issues people will see to "top"
position.  This is gonna hurt people.  Add some obnoxious <i></i> tags.
Also point out the often-given advice, building ports requires a complete
install, means "ALL X file sets".
@
text
@d460 1
d649 1
a649 1
<small>$OpenBSD: upgrade42.html,v 1.11 2007/10/16 03:04:05 nick Exp $</small>
@


1.11
log
@
judging from the lack of response, it sounds like we don't have any
packages with surprising or significant upgrade issues for 4.2.
@
text
@d74 29
a190 27
<p>

<li><b>Packages are now using libexpat shipped with xenocara;
xbase42.tgz is your friend:</b><br>
The libexpat port has been removed.
Packages now use the libexpat which is shipped with xenocara instead.
Many packages depend on libexpat through other dependencies.
For instance, the many packages which use gettext, also depend on
libexpat.

<p>
This means that many systems that do not use X before will now need to
have <tt>xbase42.tgz</tt> installed.
If you don't do this and try to install a package that requires libexpat,
pkg_add(1) will give an error message.

<p>
Also note that building ports is only supported with a full installation.

<p>
Finally, after upgrading all your packages to the 4.2 versions, clean up
by removing the old expat package from your system:

<blockquote><pre>
# <b>pkg_delete expat</b>
</pre></blockquote>

a582 8
<li>For security reasons, sudo(8) will reset the environment to a small
default set of variables.
If you are using pkg_add(1) in combination with sudo(8), you will
need to change your <tt>/etc/sudoers</tt> file to at least pass the
PKG_PATH variable!
XXX
Read above for more information.

d596 9
d648 1
a648 1
<small>$OpenBSD: upgrade42.html,v 1.10 2007/10/16 03:00:07 nick Exp $</small>
@


1.10
log
@
If we don't put the /etc/sshd changes in the upgrade patch, at least
show what they are.  I may change my mind (or have it changed) about
this before release day.  A diff is worth a few dozen words...
@
text
@a576 10
The following package is known to have significant upgrade issues
that will impact a large number of users.
The fact that a package is not on this list doesn't mean it will have a
trivial upgrade.
You must do some homework on the applications YOU use.

<ul>
...
</ul>

d645 1
a645 1
<small>$OpenBSD: upgrade42.html,v 1.9 2007/10/12 19:44:04 sthen Exp $</small>
@


1.9
log
@Remind people to re-chmod the bgplg CGI if they use it.

ok nick@@
@
text
@d384 23
a406 2
This upgrade process will not replace the <tt>/etc/ssh</tt> configuration
files, but you may wish to manually do this to gain the new behavior.
d655 1
a655 1
<small>$OpenBSD: upgrade42.html,v 1.8 2007/10/11 02:07:28 nick Exp $</small>
@


1.8
log
@
fill out copy/patch/edit file sections.
No new users/groups for 4.2.  (yeah, I'll have to renumber it.  Later)
@
text
@d377 4
d634 1
a634 1
<small>$OpenBSD: upgrade42.html,v 1.7 2007/10/11 00:55:13 nick Exp $</small>
@


1.7
log
@
improve header.
Add notes about X, sudo, and ssh.
note: it would be really nice if the people involved in those parts
looked over what I said here and fixed any stupids on my part.
@
text
@a355 12
<a name="users"></a>
<h4>1.1. New users and groups</h4>
<ul>

<blockquote><pre>
  XXX
</pre></blockquote>

These steps will add both the new users and their corresponding groups.
Your environment may allow you to copy/paste those commands.
</ul>

d423 14
a436 1
  XXX
d446 7
a452 3
<blockquote><pre><b>
  XXX
</b></pre></blockquote>
d460 7
a466 1
  XXX
d489 1
a489 1
using pf.conf, look at the suggested change of strategy, and decide if
d493 4
a496 1
  XXX
d630 1
a630 1
<small>$OpenBSD: upgrade42.html,v 1.6 2007/09/28 20:17:36 sthen Exp $</small>
@


1.6
log
@Add a note about port builds requiring a full installation.
Discussed with and shortened wording suggested by Nick.

ok nick@@
@
text
@d8 2
a9 2
<meta name="description"   content="the OpenBSD FAQ page">
<meta name="keywords"      content="openbsd,faq">
d113 4
d173 2
a174 3
This means that many systems that didn't use X before will now need to
have <tt>xbase42.tgz</tt> installed, even if the system does not have a
graphical operation.
d389 31
d508 23
a530 1
<h3>3. Upgrading packages</h3>
d616 1
a616 1
<small>$OpenBSD: upgrade42.html,v 1.5 2007/09/09 15:04:49 nick Exp $</small>
@


1.5
log
@
start filling this out, and unify style a bit.  Still not ready for use.
@
text
@d176 3
d560 1
a560 1
<small>$OpenBSD: upgrade42.html,v 1.4 2007/08/24 10:46:33 nick Exp $</small>
@


1.4
log
@
Those messages are not quite as "ignorable" as was indicated.
You have to restart sendmail.  Reminded of personal painful experience
by jsg@@.
@
text
@d69 1
a69 1
<h2>Before upgrading</h2>
d72 3
a74 1
<p>
d76 2
a77 2
For example, you might have modified your network device to use a non-default
setting using config(8).
d81 3
a83 2
<b>rc.conf:</b>
Unlike earlier versions of this process, it is now assumed that
d95 91
d371 13
a383 1
  XXX
d422 1
a422 1
non-existant patch file</a>.
d557 1
a557 1
<small>$OpenBSD: upgrade42.html,v 1.3 2007/08/20 06:19:30 steven Exp $</small>
@


1.3
log
@talk about sudo change and expat removal in "upgrading packages" section.
@
text
@d237 5
a241 2
These messages can be safely ignored, or you may wish to halt
sendmail(8) during the upgrade process.
d451 1
a451 1
<small>$OpenBSD: upgrade42.html,v 1.2 2007/08/20 05:46:10 steven Exp $</small>
@


1.2
log
@4.2
@
text
@d380 26
d423 7
d448 1
a448 1
<small>$OpenBSD: upgrade42.html,v 1.1 2007/08/15 20:49:01 nick Exp $</small>
@


1.1
log
@
Don't even think of trying to use this yet.
Just a framework at this point, something to work on.
@
text
@d383 1
a383 1
pointing to the 4.1 packages directory on your CD or nearest FTP mirror,
d415 1
a415 1
<small>$OpenBSD: upgrade41.html,v 1.28 2007/05/10 01:32:26 nick Exp $</small>
@

