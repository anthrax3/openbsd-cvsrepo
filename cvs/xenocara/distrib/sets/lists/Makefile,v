head	1.5;
access;
symbols
	OPENBSD_6_1_BASE:1.5
	OPENBSD_6_0:1.5.0.10
	OPENBSD_6_0_BASE:1.5
	OPENBSD_5_9:1.5.0.8
	OPENBSD_5_9_BASE:1.5
	OPENBSD_5_8:1.5.0.6
	OPENBSD_5_8_BASE:1.5
	OPENBSD_5_7:1.5.0.4
	OPENBSD_5_7_BASE:1.5
	OPENBSD_5_6:1.5.0.2
	OPENBSD_5_6_BASE:1.5
	OPENBSD_5_5:1.4.0.24
	OPENBSD_5_5_BASE:1.4
	OPENBSD_5_4:1.4.0.22
	OPENBSD_5_4_BASE:1.4
	OPENBSD_5_3:1.4.0.20
	OPENBSD_5_3_BASE:1.4
	OPENBSD_5_2:1.4.0.18
	OPENBSD_5_2_BASE:1.4
	OPENBSD_5_1_BASE:1.4
	OPENBSD_5_1:1.4.0.16
	OPENBSD_5_0:1.4.0.14
	OPENBSD_5_0_BASE:1.4
	OPENBSD_4_9:1.4.0.12
	OPENBSD_4_9_BASE:1.4
	OPENBSD_4_8:1.4.0.10
	OPENBSD_4_8_BASE:1.4
	OPENBSD_4_7:1.4.0.8
	OPENBSD_4_7_BASE:1.4
	OPENBSD_4_6:1.4.0.6
	OPENBSD_4_6_BASE:1.4
	OPENBSD_4_5:1.4.0.4
	OPENBSD_4_5_BASE:1.4
	OPENBSD_4_4:1.4.0.2
	OPENBSD_4_4_BASE:1.4
	OPENBSD_4_3_BASE:1.2
	OPENBSD_4_3:1.2.0.4
	OPENBSD_4_2:1.2.0.2
	OPENBSD_4_2_BASE:1.2
	v20061127:1.1.1.1
	openbsd:1.1.1;
locks; strict;
comment	@# @;


1.5
date	2014.07.23.20.47.37;	author todd;	state Exp;
branches;
next	1.4;
commitid	wLqJd7gXqDJV1gKc;

1.4
date	2008.04.08.21.53.47;	author todd;	state Exp;
branches;
next	1.3;

1.3
date	2008.04.07.20.59.41;	author todd;	state Exp;
branches;
next	1.2;

1.2
date	2007.03.30.03.55.28;	author todd;	state Exp;
branches;
next	1.1;

1.1
date	2006.11.27.11.25.45;	author matthieu;	state Exp;
branches
	1.1.1.1;
next	;

1.1.1.1
date	2006.11.27.11.25.45;	author matthieu;	state Exp;
branches;
next	;


desc
@@


1.5
log
@remove blank lines too
@
text
@# $OpenBSD: Makefile,v 1.4 2008/04/08 21:53:47 todd Exp $

# Various list maintenance functions

#   sort: verify each md/mi file is sorted and contains uniq lines
# mdtomi: move common md file lines to mi, if present
#  dupes: detect (nothing more) duplicate entries in each arch's complete file
#         list
# sanity: sanity check sets for wrong filecounts across archs


all: sort


sort:
	@@for f in */m*; do echo "===> sorting $$f"; \
		sed 's/[ ]*$$//' $$f | sort -u | awk '/^$$/{next}{print}' > \
			$$f.tmp; \
		diff -u $$f $$f.tmp || true; \
		cat $$f.tmp > $$f && rm $$f.tmp; \
	done

basefiles!= cd xbase;echo md.*
archs  = ${basefiles:S/^md.//}

mdtomi:
	@@echo "Checking for common md file lines for migration to mi files:"
	@@for xdir in x*; do \
	[ "$$xdir" = "xfont" ] && continue; \
	dir=$$(mktemp -d /tmp/mdtomi.XXXXXXXXXX); \
	i1=first; \
	for a in ${archs}; do \
		sort $$xdir/md.$$a >> $$dir/$$a; \
		if [ "X$$i1" = "Xfirst" ]; then \
			i1=$$dir/$$a; \
		else \
			cat $$i1 $$dir/$$a | sort | uniq -d >> $$dir/mi.tmp; \
			echo "===> ($$(echo $$(cat $$dir/mi.tmp|wc -c)))\c"; \
			echo " $$i1 vs $$dir/$$a"; \
			mv $$dir/mi.tmp $$dir/mi; \
			i1=$$dir/mi; \
		fi; \
	done; \
	echo "If any common md files were found, migrating to mi files:"; \
	cat $$dir/mi | while read line; do \
		echo "==> $$line"; \
		for line2 in $$(grep "^$${line}$$" $$xdir/m*); do \
			f=$${line2%:*}; \
			grep -v "^$${line}$$" $$f > $$f.tmp && mv $$f.tmp $$f; \
			echo "===> -$$line2"; \
		done; \
		echo "===> +$$xdir/mi"; \
		echo $$line >> $$xdir/mi; \
	done; rm -rf $$dir; \
	done

dupes:
	@@for d in x*; do \
	for arch in ${archs}; do \
		[ -f $$d/md.$$arch ] || continue; \
		echo "===> $$d/$$arch"; \
		cat $$d/md.$$arch $$d/mi | sort | uniq -d; \
	done; \
	done

sanity:
	@@for d in x*; do \
		[ "$$d" = "xfont" ] && continue; \
		echo "==> $$d"; \
		(cd $$d; cat md* | sort | uniq -c | sort -n ); \
	done
@


1.4
log
@be more exact
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.3 2008/04/07 20:59:41 todd Exp $
d17 2
a18 1
		sed 's/[ ]*$$//' $$f | sort | uniq > $$f.tmp; \
@


1.3
log
@make better, add sanity
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.2 2007/03/30 03:55:28 todd Exp $
d28 1
d46 1
a46 1
		for line2 in $$(grep "^$$line$$" $$xdir/m*); do \
d48 1
a48 1
			grep -v $$line $$f > $$f.tmp && mv $$f.tmp $$f; \
d51 1
a51 1
		echo "===> +$$d/mi"; \
@


1.2
log
@better sorting, auto populate arch list
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.1.1.1 2006/11/27 11:25:45 matthieu Exp $
d9 1
d23 1
a23 1
archs  = ${basefiles:S/md\.//}
d27 2
a28 1
	@@dir=$$(mktemp -d /tmp/mdtomi.XXXXXXXXXX); \
d31 2
a32 2
		sort */md.$$a >> $$dir/$$a; \
		[ "X$$i1" = "Xfirst" ] && { \
d34 1
a34 1
		} || { \
d40 1
a40 1
		}; \
d45 1
a45 1
		for line2 in $$(grep $$line */m*); do \
a47 1
			d=$${f%/*}; \
d51 3
a53 2
		echo $$line >> $$d/mi; \
	done; rm -rf $$dir
d56 6
a61 3
	@@for arch in ${archs}; do \
		echo "===> $$arch"; \
		cat */md.$$arch */mi | sort | uniq -d; \
d64 6
@


1.1
log
@Initial revision
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.11 2004/06/21 21:24:29 matthieu Exp $
d16 1
a16 1
		sort $$f | uniq > $$f.tmp; \
d19 1
a19 1
	done;
d21 2
a22 2
archs  = alpha amd64 cats hp300 hppa i386 mac68k macppc \
	mvme68k mvme88k sparc sparc64 vax
@


1.1.1.1
log
@Bring over distrib from XF4
@
text
@@
