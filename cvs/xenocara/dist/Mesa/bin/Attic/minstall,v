head	1.5;
access;
symbols
	OPENBSD_5_4:1.4.0.8
	OPENBSD_5_4_BASE:1.4
	OPENBSD_5_3:1.4.0.6
	OPENBSD_5_3_BASE:1.4
	OPENBSD_5_2:1.4.0.4
	OPENBSD_5_2_BASE:1.4
	OPENBSD_5_1_BASE:1.4
	OPENBSD_5_1:1.4.0.2
	v7_10_3:1.1.1.3
	OPENBSD_5_0:1.3.0.6
	OPENBSD_5_0_BASE:1.3
	OPENBSD_4_9:1.3.0.2
	OPENBSD_4_9_BASE:1.3
	OPENBSD_4_8:1.3.0.4
	OPENBSD_4_8_BASE:1.3
	OPENBSD_4_7:1.2.0.6
	OPENBSD_4_7_BASE:1.2
	OPENBSD_4_6:1.2.0.4
	OPENBSD_4_6_BASE:1.2
	OPENBSD_4_5:1.2.0.2
	OPENBSD_4_5_BASE:1.2
	OPENBSD_4_4:1.1.1.2.0.4
	OPENBSD_4_4_BASE:1.1.1.2
	OPENBSD_4_3_BASE:1.1.1.2
	OPENBSD_4_3:1.1.1.2.0.2
	v7_0_1:1.1.1.2
	OPENBSD_4_2:1.1.1.1.0.2
	OPENBSD_4_2_BASE:1.1.1.1
	v6_5_2:1.1.1.1
	mesa:1.1.1;
locks; strict;
comment	@# @;


1.5
date	2013.09.05.13.58.31;	author jsg;	state dead;
branches;
next	1.4;

1.4
date	2011.10.23.13.37.30;	author matthieu;	state Exp;
branches;
next	1.3;

1.3
date	2010.05.22.20.05.52;	author matthieu;	state Exp;
branches;
next	1.2;

1.2
date	2008.11.02.14.58.06;	author matthieu;	state Exp;
branches;
next	1.1;

1.1
date	2007.03.03.11.56.24;	author matthieu;	state Exp;
branches
	1.1.1.1;
next	;

1.1.1.1
date	2007.03.03.11.56.24;	author matthieu;	state Exp;
branches;
next	1.1.1.2;

1.1.1.2
date	2007.11.24.17.25.29;	author matthieu;	state Exp;
branches;
next	1.1.1.3;

1.1.1.3
date	2011.10.23.13.29.21;	author matthieu;	state Exp;
branches;
next	;


desc
@@


1.5
log
@Merge Mesa 9.2.0
@
text
@#!/bin/sh


# A minimal replacement for 'install' that supports installing symbolic links.
# Only a limited number of options are supported:
# -d dir          Create a directory
# -m mode         Sets a file's mode when installing


# If these commands aren't portable, we'll need some "if (arch)" type stuff
SYMLINK="ln -s"
MKDIR="mkdir -p"
RM="rm -f"

MODE=""

if [ "$1" = "-d" ] ; then
	# make a directory path
	$MKDIR "$2"
	exit 0
fi

if [ "$1" = "-m" ] ; then
	# set file mode
	MODE=$2
	shift 2
fi

# install file(s) into destination
if [ $# -ge 2 ] ; then

	# Last cmd line arg is the dest dir
	for FILE in $@@ ; do
		DESTDIR="$FILE"
	done

	# Loop over args, moving them to DEST directory
	I=1
	for FILE in $@@ ; do
		if [ $I = $# ] ; then
			# stop, don't want to install $DEST into $DEST
			exit 0
		fi

                DEST=$DESTDIR

                # On CYGWIN, because DLLs are loaded by the native Win32 loader,
                # they are installed in the executable path.  Stub libraries used
                # only for linking are installed in the library path
                case `uname` in
                    CYGWIN*)
                        case $FILE in
                            *.dll)
                                DEST="$DEST/../bin"
                                ;;
                            *)
                                ;;
                        esac
	                ;;
                    *)
                        ;;
                esac

		PWDSAVE=`pwd`

		# determine file's type
		if [ -h "$FILE" ] ; then
			#echo $FILE is a symlink
			# Unfortunately, cp -d isn't universal so we have to
			# use a work-around.

			# Use ls -l to find the target that the link points to
			LL=`ls -l "$FILE"`
			for L in $LL ; do
				TARGET=$L
			done
			#echo $FILE is a symlink pointing to $TARGET

			FILE=`basename "$FILE"`
			# Go to $DEST and make the link
			cd "$DEST"        # pushd
				$RM "$FILE"
				$SYMLINK "$TARGET" "$FILE"
			cd "$PWDSAVE"     # popd

		elif [ -f "$FILE" ] ; then
			#echo "$FILE" is a regular file
			# Only copy if the files differ
			if ! cmp -s $FILE $DEST/`basename $FILE`; then
				$RM "$DEST/`basename $FILE`"
				cp "$FILE" "$DEST"
			fi
			if [ $MODE ] ; then
				FILE=`basename "$FILE"`
				chmod $MODE "$DEST/$FILE"
			fi
		else
			echo "Unknown type of argument: " "$FILE"
			exit 1
		fi

		I=`expr $I + 1`
	done

	exit 0
fi

# If we get here, we didn't find anything to do
echo "Usage:"
echo "  install -d dir                      Create named directory"
echo "  install [-m mode] file [...] dest   Install files in destination"

@


1.4
log
@Merge Mesa 7.10.3
@
text
@@


1.3
log
@Update to Mesa 7.8.1. Tested on a bulk ports build by naddy@@, ok oga@@.
@
text
@d34 1
a34 1
		DEST="$FILE"
d44 19
@


1.2
log
@Mesa 7.2, Tested by ckuethe@@, naddy@@, oga@@, and others.
@
text
@d69 5
a73 2
			$RM "$DEST/`basename $FILE`"
			cp "$FILE" "$DEST"
@


1.1
log
@Initial revision
@
text
@d45 2
a61 1
			PWDSAVE="$PWD"
d69 1
@


1.1.1.1
log
@import MesaLibs version 6.5.2
@
text
@@


1.1.1.2
log
@Mesa 7.0.1
@
text
@a67 1
			$RM "$DEST/`basename $FILE`"
@


1.1.1.3
log
@Import Mesa 7.10.3
@
text
@d34 1
a34 1
		DESTDIR="$FILE"
a44 21
                DEST=$DESTDIR

                # On CYGWIN, because DLLs are loaded by the native Win32 loader,
                # they are installed in the executable path.  Stub libraries used
                # only for linking are installed in the library path
                case `uname` in
                    CYGWIN*)
                        case $FILE in
                            *.dll)
                                DEST="$DEST/../bin"
                                ;;
                            *)
                                ;;
                        esac
	                ;;
                    *)
                        ;;
                esac

		PWDSAVE=`pwd`

d60 1
d68 2
a69 5
			# Only copy if the files differ
			if ! cmp -s $FILE $DEST/`basename $FILE`; then
				$RM "$DEST/`basename $FILE`"
				cp "$FILE" "$DEST"
			fi
@


