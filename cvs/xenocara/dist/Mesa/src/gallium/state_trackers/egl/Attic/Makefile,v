head	1.4;
access;
symbols
	OPENBSD_5_4:1.3.0.4
	OPENBSD_5_4_BASE:1.3
	OPENBSD_5_3:1.3.0.2
	OPENBSD_5_3_BASE:1.3
	OPENBSD_5_2:1.2.0.4
	OPENBSD_5_2_BASE:1.2
	OPENBSD_5_1_BASE:1.2
	OPENBSD_5_1:1.2.0.2
	v7_10_3:1.1.1.1
	mesa:1.1.1
	OPENBSD_5_0:1.1.0.6
	OPENBSD_5_0_BASE:1.1
	OPENBSD_4_9:1.1.0.2
	OPENBSD_4_9_BASE:1.1
	OPENBSD_4_8:1.1.0.4
	OPENBSD_4_8_BASE:1.1;
locks; strict;
comment	@# @;


1.4
date	2013.09.05.14.01.44;	author jsg;	state dead;
branches;
next	1.3;

1.3
date	2012.08.17.13.58.07;	author mpi;	state Exp;
branches;
next	1.2;

1.2
date	2011.10.23.13.37.34;	author matthieu;	state Exp;
branches;
next	1.1;

1.1
date	2010.05.22.20.06.08;	author matthieu;	state Exp;
branches
	1.1.1.1;
next	;

1.1.1.1
date	2011.10.23.13.29.29;	author matthieu;	state Exp;
branches;
next	;


desc
@@


1.4
log
@Merge Mesa 9.2.0
@
text
@TOP = ../../../..
include $(TOP)/configs/current

common_INCLUDES = \
	-I. \
	-I$(TOP)/src/gallium/include \
	-I$(TOP)/src/gallium/auxiliary \
	-I$(TOP)/src/egl/main \
	-I$(TOP)/src/egl/wayland/wayland-drm/ \
	-I$(TOP)/include

common_SOURCES = $(wildcard common/*.c)
common_OBJECTS = $(common_SOURCES:.c=.o)

x11_INCLUDES = \
	-I$(TOP)/src/gallium/drivers \
	-I$(TOP)/src/glx \
	-I$(TOP)/src/mapi \
	-I$(TOP)/src/mesa \
	$(X11_CFLAGS) \
	$(shell pkg-config --cflags-only-I libdrm dri2proto)

x11_SOURCES = $(wildcard x11/*.c) \
	      $(TOP)/src/glx/dri2.c
x11_OBJECTS = $(x11_SOURCES:.c=.o)

wayland_INCLUDES = \
	-I$(TOP)/src/gallium/winsys \
	-I$(TOP)/src/egl/wayland/wayland-egl \
	-I$(TOP)/src/egl/wayland/wayland-drm \
	$(shell pkg-config --cflags-only-I libdrm wayland-client)

wayland_SOURCES = $(wildcard wayland/*.c)
wayland_OBJECTS = $(wayland_SOURCES:.c=.o)

drm_INCLUDES = -I$(TOP)/src/gallium/winsys $(shell pkg-config --cflags-only-I libdrm) \
	       -I$(TOP)/src/gbm/main -I$(TOP)/src/gallium/state_trackers/gbm
drm_SOURCES = $(wildcard drm/*.c)
drm_OBJECTS = $(drm_SOURCES:.c=.o)


fbdev_INCLUDES = -I$(TOP)/src/gallium/winsys/sw
fbdev_SOURCES = $(wildcard fbdev/*.c)
fbdev_OBJECTS = $(fbdev_SOURCES:.c=.o)


ALL_INCLUDES = $(common_INCLUDES) $(x11_INCLUDES) $(drm_INCLUDES) $(fbdev_INCLUDES)
ALL_SOURCES = $(common_SOURCES) $(x11_SOURCES) $(drm_SOURCES) $(fbdev_SOURCES)

EGL_OBJECTS = $(common_OBJECTS)
EGL_CPPFLAGS = $(common_INCLUDES)

# add backends
ifneq ($(findstring x11, $(EGL_PLATFORMS)),)
EGL_OBJECTS += $(x11_OBJECTS)
EGL_CPPFLAGS += -DHAVE_X11_BACKEND
endif
ifneq ($(findstring wayland, $(EGL_PLATFORMS)),)
EGL_OBJECTS += $(wayland_OBJECTS)
EGL_CPPFLAGS += -DHAVE_WAYLAND_BACKEND
DEFINES += -DHAVE_WAYLAND_BACKEND
endif
ifneq ($(findstring drm, $(EGL_PLATFORMS)),)
EGL_OBJECTS += $(drm_OBJECTS)
EGL_CPPFLAGS += -DHAVE_DRM_BACKEND
endif
ifneq ($(findstring fbdev, $(EGL_PLATFORMS)),)
EGL_OBJECTS += $(fbdev_OBJECTS)
EGL_CPPFLAGS += -DHAVE_FBDEV_BACKEND
endif

##### TARGETS #####

default: depend libegl.a

libegl.a: $(EGL_OBJECTS) Makefile
	$(MKLIB) -o egl -static $(EGL_OBJECTS)

depend: 
	rm -f depend
	touch depend
	$(MKDEP) $(MKDEP_OPTIONS) $(ALL_INCLUDES) $(ALL_SOURCES) 2> /dev/null

clean:
	rm -f libegl.a
	rm -f $(EGL_OBJECTS)
	rm -f depend depend.bak

# Dummy target
install:
	@@echo -n ""

##### RULES #####

define egl-cc
$(CC) -c $(common_INCLUDES) $($(1)_INCLUDES) $(DEFINES) $(CFLAGS) $< -o $@@
endef

$(common_OBJECTS): %.o: %.c
	$(CC) -c $(EGL_CPPFLAGS) $(DEFINES) $(CFLAGS) $< -o $@@

$(x11_OBJECTS): %.o: %.c
	$(call egl-cc,x11)

$(wayland_OBJECTS): %.o: %.c
	$(call egl-cc,wayland)

$(drm_OBJECTS): %.o: %.c
	$(call egl-cc,drm)

$(fbdev_OBJECTS): %.o: %.c
	$(call egl-cc,fbdev)

sinclude depend
@


1.3
log
@Upate to libGL 7.11.2

Tested by jsg@@, matthieu@@ and ajacoutot@@, ok mattieu@@
@
text
@@


1.2
log
@Merge Mesa 7.10.3
@
text
@d9 1
d27 5
d33 5
a37 1
drm_INCLUDES = -I$(TOP)/src/gallium/winsys $(shell pkg-config --cflags-only-I libdrm)
d58 5
d104 3
@


1.1
log
@Update to Mesa 7.8.1. Tested on a bulk ports build by naddy@@, ok oga@@.
@
text
@a13 1

d17 1
d20 1
a20 1
	$(shell pkg-config --cflags-only-I libdrm)
d27 29
a55 8
kms_INCLUDES = $(shell pkg-config --cflags-only-I libdrm)
kms_SOURCES = $(wildcard kms/*.c)
kms_OBJECTS = $(kms_SOURCES:.c=.o)


ALL_INCLUDES = $(common_INCLUDES) $(x11_INCLUDES) $(kms_INCLUDES)
ALL_SOURCES = $(common_SOURCES) $(x11_SOURCES) $(kms_SOURCES)
ALL_OBJECTS = $(common_OBJECTS) $(x11_OBJECTS) $(kms_OBJECTS)
d59 1
a59 3
EGL_DISPLAYS_MODS = $(foreach dpy, $(EGL_DISPLAYS), libegl$(dpy).a)

default: depend $(EGL_DISPLAYS_MODS)
d61 2
a62 6

libeglx11.a: $(x11_OBJECTS) $(common_OBJECTS) Makefile
	$(MKLIB) -o eglx11 -static $(x11_OBJECTS) $(common_OBJECTS)

libeglkms.a: $(kms_OBJECTS) $(common_OBJECTS) Makefile
	$(MKLIB) -o eglkms -static $(kms_OBJECTS) $(common_OBJECTS)
d70 2
a71 2
	rm -f $(ALL_OBJECTS)
	rm -f $(EGL_DISPLAYS_MODS)
d80 4
d85 1
a85 1
	$(CC) -c $(common_INCLUDES) $(DEFINES) $(CFLAGS) $< -o $@@
d88 4
a91 1
	$(CC) -c $(common_INCLUDES) $(x11_INCLUDES) $(DEFINES) $(CFLAGS) $< -o $@@
d93 2
a94 2
$(kms_OBJECTS): %.o: %.c
	$(CC) -c $(common_INCLUDES) $(kms_INCLUDES) $(DEFINES) $(CFLAGS) $< -o $@@
@


1.1.1.1
log
@Import Mesa 7.10.3
@
text
@d14 1
a17 1
	-I$(TOP)/src/mapi \
d20 1
a20 1
	$(shell pkg-config --cflags-only-I libdrm dri2proto)
d27 8
a34 29
drm_INCLUDES = -I$(TOP)/src/gallium/winsys $(shell pkg-config --cflags-only-I libdrm)
drm_SOURCES = $(wildcard drm/*.c)
drm_OBJECTS = $(drm_SOURCES:.c=.o)


fbdev_INCLUDES = -I$(TOP)/src/gallium/winsys/sw
fbdev_SOURCES = $(wildcard fbdev/*.c)
fbdev_OBJECTS = $(fbdev_SOURCES:.c=.o)


ALL_INCLUDES = $(common_INCLUDES) $(x11_INCLUDES) $(drm_INCLUDES) $(fbdev_INCLUDES)
ALL_SOURCES = $(common_SOURCES) $(x11_SOURCES) $(drm_SOURCES) $(fbdev_SOURCES)

EGL_OBJECTS = $(common_OBJECTS)
EGL_CPPFLAGS = $(common_INCLUDES)

# add backends
ifneq ($(findstring x11, $(EGL_PLATFORMS)),)
EGL_OBJECTS += $(x11_OBJECTS)
EGL_CPPFLAGS += -DHAVE_X11_BACKEND
endif
ifneq ($(findstring drm, $(EGL_PLATFORMS)),)
EGL_OBJECTS += $(drm_OBJECTS)
EGL_CPPFLAGS += -DHAVE_DRM_BACKEND
endif
ifneq ($(findstring fbdev, $(EGL_PLATFORMS)),)
EGL_OBJECTS += $(fbdev_OBJECTS)
EGL_CPPFLAGS += -DHAVE_FBDEV_BACKEND
endif
d38 3
a40 1
default: depend libegl.a
d42 6
a47 2
libegl.a: $(EGL_OBJECTS) Makefile
	$(MKLIB) -o egl -static $(EGL_OBJECTS)
d55 2
a56 2
	rm -f libegl.a
	rm -f $(EGL_OBJECTS)
a64 4
define egl-cc
$(CC) -c $(common_INCLUDES) $($(1)_INCLUDES) $(DEFINES) $(CFLAGS) $< -o $@@
endef

d66 1
a66 1
	$(CC) -c $(EGL_CPPFLAGS) $(DEFINES) $(CFLAGS) $< -o $@@
d69 1
a69 4
	$(call egl-cc,x11)

$(drm_OBJECTS): %.o: %.c
	$(call egl-cc,drm)
d71 2
a72 2
$(fbdev_OBJECTS): %.o: %.c
	$(call egl-cc,fbdev)
@

