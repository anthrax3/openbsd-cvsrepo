head	1.2;
access;
symbols
	OPENBSD_5_4:1.1.1.1.0.8
	OPENBSD_5_4_BASE:1.1.1.1
	OPENBSD_5_3:1.1.1.1.0.6
	OPENBSD_5_3_BASE:1.1.1.1
	OPENBSD_5_2:1.1.1.1.0.4
	OPENBSD_5_2_BASE:1.1.1.1
	OPENBSD_5_1_BASE:1.1.1.1
	OPENBSD_5_1:1.1.1.1.0.2
	v7_10_3:1.1.1.1
	mesa:1.1.1;
locks; strict;
comment	@ * @;


1.2
date	2013.09.05.14.01.28;	author jsg;	state dead;
branches;
next	1.1;

1.1
date	2011.10.23.13.29.29;	author matthieu;	state Exp;
branches
	1.1.1.1;
next	;

1.1.1.1
date	2011.10.23.13.29.29;	author matthieu;	state Exp;
branches;
next	;


desc
@@


1.2
log
@Merge Mesa 9.2.0
@
text
@#if API < 11
extern "C" HRESULT STDMETHODCALLTYPE D3D10CreateBlob(
	SIZE_T num_bytes,
	LPD3D10BLOB *out_buffer
);

HRESULT STDMETHODCALLTYPE D3D10CreateBlob(
	SIZE_T num_bytes,
	LPD3D10BLOB *out_buffer
)
{
	void* data = malloc(num_bytes);
	if(!data)
		return E_OUTOFMEMORY;
	*out_buffer = new GalliumD3DBlob(data, num_bytes);
	return S_OK;
}

LPCSTR STDMETHODCALLTYPE D3D10GetPixelShaderProfile(
	ID3D10Device *device
)
{
	return "ps_4_0";
}

LPCSTR STDMETHODCALLTYPE D3D10GetVertexShaderProfile(
	ID3D10Device *device
)
{
	return "vs_4_0";
}

LPCSTR STDMETHODCALLTYPE D3D10GetGeometryShaderProfile(
	ID3D10Device *device
)
{
	return "gs_4_0";
}

static HRESULT dxbc_assemble_as_blob(struct dxbc_chunk_header** chunks, unsigned num_chunks, ID3D10Blob** blob)
{
	std::pair<void*, size_t> p = dxbc_assemble(chunks, num_chunks);
	if(!p.first)
		return E_OUTOFMEMORY;
	*blob = new GalliumD3DBlob(p.first, p.second);
	return S_OK;
}

HRESULT D3D10GetInputSignatureBlob(
	const void *shader_bytecode,
	SIZE_T bytecode_length,
	ID3D10Blob **signature_blob
)
{
	dxbc_chunk_signature* sig = dxbc_find_signature(shader_bytecode, bytecode_length, false);
	if(!sig)
		return E_FAIL;

	return dxbc_assemble_as_blob((dxbc_chunk_header**)&sig, 1, signature_blob);
}

HRESULT D3D10GetOutputSignatureBlob(
	const void *shader_bytecode,
	SIZE_T bytecode_length,
	ID3D10Blob **signature_blob
)
{
	dxbc_chunk_signature* sig = dxbc_find_signature(shader_bytecode, bytecode_length, true);
	if(!sig)
		return E_FAIL;

	return dxbc_assemble_as_blob((dxbc_chunk_header**)&sig, 1, signature_blob);
}

HRESULT D3D10GetInputAndOutputSignatureBlob(
	const void *shader_bytecode,
	SIZE_T bytecode_length,
	ID3D10Blob **signature_blob
)
{
	dxbc_chunk_signature* sigs[2];
	sigs[0] = dxbc_find_signature(shader_bytecode, bytecode_length, false);
	if(!sigs[0])
		return E_FAIL;
	sigs[1] = dxbc_find_signature(shader_bytecode, bytecode_length, true);
	if(!sigs[1])
		return E_FAIL;

	return dxbc_assemble_as_blob((dxbc_chunk_header**)&sigs, 2, signature_blob);
}

#endif
@


1.1
log
@Initial revision
@
text
@@


1.1.1.1
log
@Import Mesa 7.10.3
@
text
@@
