head	1.8;
access;
symbols
	OPENBSD_5_2:1.7.0.4
	OPENBSD_5_2_BASE:1.7
	OPENBSD_5_1_BASE:1.7
	OPENBSD_5_1:1.7.0.2
	v7_10_3:1.1.1.4
	OPENBSD_5_0:1.6.0.6
	OPENBSD_5_0_BASE:1.6
	OPENBSD_4_9:1.6.0.2
	OPENBSD_4_9_BASE:1.6
	OPENBSD_4_8:1.6.0.4
	OPENBSD_4_8_BASE:1.6
	OPENBSD_4_7:1.5.0.4
	OPENBSD_4_7_BASE:1.5
	OPENBSD_4_6:1.5.0.2
	OPENBSD_4_6_BASE:1.5
	OPENBSD_4_5:1.4.0.2
	OPENBSD_4_5_BASE:1.4
	OPENBSD_4_4:1.3.0.2
	OPENBSD_4_4_BASE:1.3
	OPENBSD_4_3_BASE:1.2
	OPENBSD_4_3:1.2.0.2
	v7_0_1:1.1.1.3
	OPENBSD_4_2:1.1.1.2.0.2
	OPENBSD_4_2_BASE:1.1.1.2
	v6_5_2:1.1.1.2
	v6_5_1:1.1.1.1
	mesa:1.1.1;
locks; strict;
comment	@# @;


1.8
date	2012.08.17.13.58.14;	author mpi;	state dead;
branches;
next	1.7;

1.7
date	2011.10.23.13.37.39;	author matthieu;	state Exp;
branches;
next	1.6;

1.6
date	2010.05.22.20.06.16;	author matthieu;	state Exp;
branches;
next	1.5;

1.5
date	2009.05.17.20.26.38;	author matthieu;	state Exp;
branches;
next	1.4;

1.4
date	2008.11.02.14.58.13;	author matthieu;	state Exp;
branches;
next	1.3;

1.3
date	2008.05.31.16.36.47;	author matthieu;	state Exp;
branches;
next	1.2;

1.2
date	2008.02.12.21.09.26;	author matthieu;	state Exp;
branches;
next	1.1;

1.1
date	2006.11.25.18.52.07;	author matthieu;	state Exp;
branches
	1.1.1.1;
next	;

1.1.1.1
date	2006.11.25.18.52.07;	author matthieu;	state Exp;
branches;
next	1.1.1.2;

1.1.1.2
date	2007.03.03.11.57.02;	author matthieu;	state Exp;
branches;
next	1.1.1.3;

1.1.1.3
date	2007.11.24.17.27.43;	author matthieu;	state Exp;
branches;
next	1.1.1.4;

1.1.1.4
date	2011.10.23.13.29.35;	author matthieu;	state Exp;
branches;
next	;


desc
@@


1.8
log
@Upate to libGL 7.11.2

Tested by jsg@@, matthieu@@ and ajacoutot@@, ok mattieu@@
@
text
@# -*-makefile-*-

MESA_MODULES = $(TOP)/src/mesa/libmesa.a

COMMON_GALLIUM_SOURCES = \
        ../common/utils.c \
        ../common/vblank.c \
        ../common/dri_util.c \
        ../common/xmlconfig.c

COMMON_SOURCES = $(COMMON_GALLIUM_SOURCES) \
        ../../common/driverfuncs.c \
        ../common/texmem.c \
        ../common/drirenderbuffer.c \
	../common/dri_metaops.c

INCLUDES = $(SHARED_INCLUDES) $(EXPAT_INCLUDES)

OBJECTS = $(C_SOURCES:.c=.o) \
	  $(CXX_SOURCES:.cpp=.o) \
	  $(ASM_SOURCES:.S=.o) 


### Include directories
SHARED_INCLUDES = \
	-I. \
	-I$(TOP)/src/mesa/drivers/dri/common \
	-Iserver \
	-I$(TOP)/include \
	-I$(TOP)/src/mapi \
	-I$(TOP)/src/mesa \
	-I$(TOP)/src/egl/main \
	-I$(TOP)/src/egl/drivers/dri \
	$(LIBDRM_CFLAGS)

CFLAGS += $(API_DEFINES)
CXXFLAGS += $(API_DEFINES)

##### RULES #####

.c.o:
	$(CC) -c $(INCLUDES) $(CFLAGS) $(DRIVER_DEFINES) $< -o $@@

.cpp.o:
	$(CC) -c $(INCLUDES) $(CXXFLAGS) $(DRIVER_DEFINES) $< -o $@@

.S.o:
	$(CC) -c $(INCLUDES) $(CFLAGS) $(DRIVER_DEFINES) $< -o $@@


##### TARGETS #####

default: subdirs lib


.PHONY: lib
lib: symlinks subdirs depend
	@@$(MAKE) $(LIBNAME) $(TOP)/$(LIB_DIR)/$(LIBNAME)

$(LIBNAME): $(OBJECTS) $(MESA_MODULES) $(EXTRA_MODULES) Makefile \
		$(TOP)/src/mesa/drivers/dri/Makefile.template $(TOP)/src/mesa/drivers/dri/common/dri_test.o
	$(MKLIB) -o $@@.tmp -noprefix -linker '$(CXX)' -ldflags '$(LDFLAGS)' \
		$(OBJECTS) $(MESA_MODULES) $(EXTRA_MODULES) $(DRI_LIB_DEPS)
	$(CXX) $(CFLAGS) -o $@@.test $(TOP)/src/mesa/drivers/dri/common/dri_test.o $@@.tmp $(DRI_LIB_DEPS)
	@@rm -f $@@.test
	mv -f $@@.tmp $@@


$(TOP)/$(LIB_DIR)/$(LIBNAME): $(LIBNAME)
	$(INSTALL) $(LIBNAME) $(TOP)/$(LIB_DIR) 


# If the Makefile defined SUBDIRS, run make in each
.PHONY: subdirs
subdirs:
	@@if test -n "$(SUBDIRS)" ; then \
		for dir in $(SUBDIRS) ; do \
			if [ -d $$dir ] ; then \
				(cd $$dir && $(MAKE)) || exit 1; \
			fi \
		done \
	fi


.PHONY: symlinks
symlinks:


depend: $(C_SOURCES) $(CXX_SOURCES) $(ASM_SOURCES) $(SYMLINKS)
	@@ echo "running $(MKDEP)"
	@@ rm -f depend
	@@ touch depend
	@@ $(MKDEP) $(MKDEP_OPTIONS) $(DRIVER_DEFINES) $(INCLUDES) \
		$(C_SOURCES) $(CXX_SOURCES) \
		$(ASM_SOURCES) > /dev/null 2>/dev/null


# Emacs tags
tags:
	etags `find . -name \*.[ch]` `find ../include`


# Remove .o and backup files
clean:
	-rm -f *.o */*.o *~ *.so *~ server/*.o $(SYMLINKS)
	-rm -f depend depend.bak


install: $(LIBNAME)
	$(INSTALL) -d $(DESTDIR)$(DRI_DRIVER_INSTALL_DIR)
	$(MINSTALL) -m 755 $(LIBNAME) $(DESTDIR)$(DRI_DRIVER_INSTALL_DIR)


-include depend
@


1.7
log
@Merge Mesa 7.10.3
@
text
@@


1.6
log
@Update to Mesa 7.8.1. Tested on a bulk ports build by naddy@@, ok oga@@.
@
text
@d20 1
d30 1
d36 2
d44 3
d61 2
a62 2
		$(TOP)/src/mesa/drivers/dri/Makefile.template
	$(MKLIB) -o $@@ -noprefix -linker '$(CC)' -ldflags '$(LDFLAGS)' \
d64 3
d89 1
a89 1
depend: $(C_SOURCES) $(ASM_SOURCES) $(SYMLINKS)
d93 2
a94 1
	@@ $(MKDEP) $(MKDEP_OPTIONS) $(DRIVER_DEFINES) $(INCLUDES) $(C_SOURCES) \
@


1.5
log
@Update to Mesa 7.4.2. Tested by oga@@, ckuethe@@ and naddy@@.
@
text
@d5 1
a5 1
COMMON_SOURCES = \
a6 1
        ../common/texmem.c \
d9 7
a15 2
        ../common/xmlconfig.c \
        ../common/drirenderbuffer.c 
a16 3
ifeq ($(WINDOW_SYSTEM),dri)
WINOBJ=
WINLIB=
a21 14
else
# miniglx
WINOBJ=
WINLIB=-L$(MESA)/src/glx/mini
MINIGLX_INCLUDES = -I$(TOP)/src/glx/mini
INCLUDES = $(MINIGLX_INCLUDES) \
	   $(SHARED_INCLUDES) \
	   $(PCIACCESS_CFLAGS)

OBJECTS = $(C_SOURCES:.c=.o) \
	  $(MINIGLX_SOURCES:.c=.o) \
	  $(ASM_SOURCES:.S=.o) 
endif

d41 1
a41 1
	$(CC) -c $(INCLUDES) $(CFLAGS) $(DRIVER_DEFINES)  $< -o $@@
d46 2
a47 1
default: symlinks depend $(LIBNAME) $(TOP)/$(LIB_DIR)/$(LIBNAME)
d49 3
d53 2
a54 1
$(LIBNAME): $(OBJECTS) $(MESA_MODULES) $(WINOBJ) Makefile $(TOP)/src/mesa/drivers/dri/Makefile.template
d56 1
a56 1
		$(OBJECTS) $(MESA_MODULES) $(WINOBJ) $(DRI_LIB_DEPS)
d63 16
d80 5
a84 3
	touch depend
	$(MKDEP) $(MKDEP_OPTIONS) $(DRIVER_DEFINES) $(INCLUDES) $(C_SOURCES) \
		$(ASM_SOURCES)
d100 1
a100 1
	$(INSTALL) -m 755 $(LIBNAME) $(DESTDIR)$(DRI_DRIVER_INSTALL_DIR)
@


1.4
log
@Mesa 7.2, Tested by ckuethe@@, naddy@@, oga@@, and others.
@
text
@a12 5
COMMON_BM_SOURCES = \
	../common/dri_bufmgr.c \
	../common/dri_bufmgr_fake.c


a41 1
	-I$(TOP)/include/GL/internal \
a42 2
	-I$(TOP)/src/mesa/main \
	-I$(TOP)/src/mesa/glapi \
@


1.3
log
@Update to Mesa 7.0.3. tested my oga@@ and johan@@
@
text
@a5 1
        ../../common/driverfuncs.c \
d15 1
a15 1
	../common/dri_drmpool.c
a50 4
	-I$(TOP)/src/mesa/math \
	-I$(TOP)/src/mesa/shader \
	-I$(TOP)/src/mesa/swrast \
	-I$(TOP)/src/mesa/swrast_setup \
d67 1
a67 1
default: depend symlinks $(LIBNAME) $(TOP)/$(LIB_DIR)/$(LIBNAME)
d71 1
a71 1
	$(TOP)/bin/mklib -ldflags '$(LDFLAGS)' -noprefix -o $@@ \
d82 1
a82 1
		$(ASM_SOURCES) 2>&1 /dev/null
d101 1
a101 1
include depend
@


1.2
log
@Update to Mesa 7.0.2. Tested by naddy@@ (full ports build), simon@@
and oga@@ (with dri enabled).
@
text
@a52 1
	-I$(TOP)/src/mesa/transform \
@


1.1
log
@Initial revision
@
text
@d12 6
a17 1
        ../common/drirenderbuffer.c
d28 1
d33 2
a34 1
	   $(SHARED_INCLUDES)
d59 2
a60 1
	`pkg-config --cflags libdrm`
a75 5
#$(TOP)/$(LIB_DIR)/$(LIBNAME): $(OBJECTS) $(MESA_MODULES) $(WINOBJ) Makefile
#	@@echo BUILDING FOR: $(WINDOW_SYSTEM)
#	$(TOP)/bin/mklib -o $(LIBNAME) -noprefix -install $(TOP)/$(LIB_DIR) \
#		$(WINLIB) $(LIB_DEPS) $(WINOBJ) $(MESA_MODULES) $(OBJECTS)

d77 1
a77 1
	$(TOP)/bin/mklib -noprefix -o $@@ \
a84 3

# Run 'make depend' to update the dependencies if you change
# what's included by any source file.
d88 1
a88 1
		$(ASM_SOURCES) > /dev/null
d101 1
d103 3
a105 2
	$(INSTALL) -d $(DRI_DRIVER_INSTALL_DIR)
	$(INSTALL) -m 755 $(LIBNAME) $(DRI_DRIVER_INSTALL_DIR)
@


1.1.1.1
log
@Import MesaLibs 6.5.1. (in dist/ since its code is shared between lib 
and xserver)...
@
text
@@


1.1.1.2
log
@import MesaLibs version 6.5.2
@
text
@d12 1
a12 6
        ../common/drirenderbuffer.c 

COMMON_BM_SOURCES = \
	../common/dri_bufmgr.c \
	../common/dri_drmpool.c

d88 1
a88 1
		$(ASM_SOURCES) 2>&1 /dev/null
@


1.1.1.3
log
@Mesa 7.0.1
@
text
@a27 1
# miniglx
d32 1
a32 2
	   $(SHARED_INCLUDES) \
	   $(PCIACCESS_CFLAGS)
d57 1
a57 2
	$(LIBDRM_CFLAGS)

d73 5
d87 3
a105 1

a108 1

@


1.1.1.4
log
@Import Mesa 7.10.3
@
text
@d5 2
a6 1
COMMON_GALLIUM_SOURCES = \
d8 1
d11 6
a16 1
        ../common/xmlconfig.c
a17 5
COMMON_SOURCES = $(COMMON_GALLIUM_SOURCES) \
        ../../common/driverfuncs.c \
        ../common/texmem.c \
        ../common/drirenderbuffer.c \
	../common/dri_metaops.c
d19 3
a24 1
	  $(CXX_SOURCES:.cpp=.o) \
d27 14
d48 1
a48 1
	-I$(TOP)/src/mapi \
d50 7
a60 2
CFLAGS += $(API_DEFINES)
CXXFLAGS += $(API_DEFINES)
a66 3
.cpp.o:
	$(CC) -c $(INCLUDES) $(CXXFLAGS) $(DRIVER_DEFINES) $< -o $@@

d68 1
a68 1
	$(CC) -c $(INCLUDES) $(CFLAGS) $(DRIVER_DEFINES) $< -o $@@
d73 1
a73 1
default: subdirs lib
d76 3
a78 11
.PHONY: lib
lib: symlinks subdirs depend
	@@$(MAKE) $(LIBNAME) $(TOP)/$(LIB_DIR)/$(LIBNAME)

$(LIBNAME): $(OBJECTS) $(MESA_MODULES) $(EXTRA_MODULES) Makefile \
		$(TOP)/src/mesa/drivers/dri/Makefile.template $(TOP)/src/mesa/drivers/dri/common/dri_test.o
	$(MKLIB) -o $@@.tmp -noprefix -linker '$(CXX)' -ldflags '$(LDFLAGS)' \
		$(OBJECTS) $(MESA_MODULES) $(EXTRA_MODULES) $(DRI_LIB_DEPS)
	$(CXX) $(CFLAGS) -o $@@.test $(TOP)/src/mesa/drivers/dri/common/dri_test.o $@@.tmp $(DRI_LIB_DEPS)
	@@rm -f $@@.test
	mv -f $@@.tmp $@@
d85 4
a88 23
# If the Makefile defined SUBDIRS, run make in each
.PHONY: subdirs
subdirs:
	@@if test -n "$(SUBDIRS)" ; then \
		for dir in $(SUBDIRS) ; do \
			if [ -d $$dir ] ; then \
				(cd $$dir && $(MAKE)) || exit 1; \
			fi \
		done \
	fi


.PHONY: symlinks
symlinks:


depend: $(C_SOURCES) $(CXX_SOURCES) $(ASM_SOURCES) $(SYMLINKS)
	@@ echo "running $(MKDEP)"
	@@ rm -f depend
	@@ touch depend
	@@ $(MKDEP) $(MKDEP_OPTIONS) $(DRIVER_DEFINES) $(INCLUDES) \
		$(C_SOURCES) $(CXX_SOURCES) \
		$(ASM_SOURCES) > /dev/null 2>/dev/null
d103 2
a104 2
	$(INSTALL) -d $(DESTDIR)$(DRI_DRIVER_INSTALL_DIR)
	$(MINSTALL) -m 755 $(LIBNAME) $(DESTDIR)$(DRI_DRIVER_INSTALL_DIR)
d107 1
a107 1
-include depend
@


