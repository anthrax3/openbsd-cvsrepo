head	1.5;
access;
symbols
	OPENBSD_5_4:1.4.0.4
	OPENBSD_5_4_BASE:1.4
	OPENBSD_5_3:1.4.0.2
	OPENBSD_5_3_BASE:1.4
	OPENBSD_5_2:1.3.0.4
	OPENBSD_5_2_BASE:1.3
	OPENBSD_5_1_BASE:1.3
	OPENBSD_5_1:1.3.0.2
	v7_10_3:1.1.1.1
	mesa:1.1.1
	OPENBSD_5_0:1.2.0.6
	OPENBSD_5_0_BASE:1.2
	OPENBSD_4_9:1.2.0.2
	OPENBSD_4_9_BASE:1.2
	OPENBSD_4_8:1.2.0.4
	OPENBSD_4_8_BASE:1.2
	OPENBSD_4_7:1.1.0.6
	OPENBSD_4_7_BASE:1.1
	OPENBSD_4_6:1.1.0.4
	OPENBSD_4_6_BASE:1.1
	OPENBSD_4_5:1.1.0.2
	OPENBSD_4_5_BASE:1.1;
locks; strict;
comment	@# @;


1.5
date	2013.09.05.13.59.23;	author jsg;	state dead;
branches;
next	1.4;

1.4
date	2012.08.17.13.58.02;	author mpi;	state Exp;
branches;
next	1.3;

1.3
date	2011.10.23.13.37.31;	author matthieu;	state Exp;
branches;
next	1.2;

1.2
date	2010.05.22.20.06.03;	author matthieu;	state Exp;
branches;
next	1.1;

1.1
date	2008.11.02.14.58.10;	author matthieu;	state Exp;
branches
	1.1.1.1;
next	;

1.1.1.1
date	2011.10.23.13.29.23;	author matthieu;	state Exp;
branches;
next	;


desc
@@


1.5
log
@Merge Mesa 9.2.0
@
text
@# src/egl/main/Makefile

TOP = ../../..
include $(TOP)/configs/current


EGL_MAJOR = 1
EGL_MINOR = 0

INCLUDE_DIRS = -I$(TOP)/include

HEADERS = \
	eglcompiler.h \
	eglconfig.h \
	eglcontext.h \
	eglcurrent.h \
	egldefines.h \
	egldisplay.h \
	egldriver.h \
	eglglobals.h \
	eglimage.h \
	egllog.h \
	eglmisc.h \
	eglmode.h \
	eglmutex.h \
	eglscreen.h \
	eglstring.h \
	eglsurface.h \
	eglsync.h

SOURCES = \
	eglapi.c \
	eglarray.c \
	eglconfig.c \
	eglcontext.c \
	eglcurrent.c \
	egldisplay.c \
	egldriver.c \
	eglfallbacks.c \
	eglglobals.c \
	eglimage.c \
	egllog.c \
	eglmisc.c \
	eglmode.c \
	eglscreen.c \
	eglstring.c \
	eglsurface.c \
	eglsync.c

OBJECTS = $(SOURCES:.c=.o)


# use dl*() to load drivers
LOCAL_CFLAGS = -D_EGL_OS_UNIX=1
LOCAL_LIBS =

# egl_dri2 and egl_glx are built-ins
ifeq ($(filter dri2, $(EGL_DRIVERS_DIRS)),dri2)
LOCAL_CFLAGS += -D_EGL_BUILT_IN_DRIVER_DRI2
LOCAL_LIBS += $(TOP)/src/egl/drivers/dri2/libegl_dri2.a
ifneq ($(findstring x11, $(EGL_PLATFORMS)),)
EGL_LIB_DEPS += $(XCB_DRI2_LIBS)
endif
ifneq ($(findstring drm, $(EGL_PLATFORMS)),)
EGL_LIB_DEPS += -lgbm
endif
EGL_LIB_DEPS += $(LIBUDEV_LIBS) $(DLOPEN_LIBS) $(LIBDRM_LIB) $(WAYLAND_LIBS)
endif


ifneq ($(findstring wayland, $(EGL_PLATFORMS)),)
LOCAL_LIBS += $(TOP)/src/egl/wayland/wayland-drm/libwayland-drm.a
endif

ifeq ($(filter glx, $(EGL_DRIVERS_DIRS)),glx)
LOCAL_CFLAGS += -D_EGL_BUILT_IN_DRIVER_GLX
LOCAL_LIBS += $(TOP)/src/egl/drivers/glx/libegl_glx.a
EGL_LIB_DEPS += $(X11_LIBS) $(DLOPEN_LIBS)
endif

# translate --with-egl-platforms to _EGLPlatformType
EGL_NATIVE_PLATFORM=_EGL_INVALID_PLATFORM
ifeq ($(firstword $(EGL_PLATFORMS)),x11)
EGL_NATIVE_PLATFORM=_EGL_PLATFORM_X11
endif
ifeq ($(firstword $(EGL_PLATFORMS)),wayland)
EGL_NATIVE_PLATFORM=_EGL_PLATFORM_WAYLAND
endif
ifeq ($(firstword $(EGL_PLATFORMS)),drm)
EGL_NATIVE_PLATFORM=_EGL_PLATFORM_DRM
endif
ifeq ($(firstword $(EGL_PLATFORMS)),fbdev)
EGL_NATIVE_PLATFORM=_EGL_PLATFORM_FBDEV
endif

LOCAL_CFLAGS += \
	-D_EGL_NATIVE_PLATFORM=$(EGL_NATIVE_PLATFORM) \
	-D_EGL_DRIVER_SEARCH_DIR=\"$(EGL_DRIVER_INSTALL_DIR)\"

.c.o:
	$(CC) -c $(INCLUDE_DIRS) $(CFLAGS) $(LOCAL_CFLAGS) $< -o $@@



default: depend library


# EGL Library
library: $(TOP)/$(LIB_DIR)/$(EGL_LIB_NAME)

$(TOP)/$(LIB_DIR)/$(EGL_LIB_NAME): $(OBJECTS) $(LOCAL_LIBS)
	$(MKLIB) -o $(EGL_LIB) -linker '$(CC)' -ldflags '$(LDFLAGS)' \
		-major $(EGL_MAJOR) -minor $(EGL_MINOR) \
		-install $(TOP)/$(LIB_DIR) $(MKLIB_OPTIONS) \
		-L$(TOP)/$(LIB_DIR) $(EGL_LIB_DEPS) \
		$(OBJECTS) $(LOCAL_LIBS)

install-headers:
	$(INSTALL) -d $(DESTDIR)$(INSTALL_INC_DIR)/KHR
	$(INSTALL) -m 644 $(TOP)/include/KHR/*.h \
		$(DESTDIR)$(INSTALL_INC_DIR)/KHR
	$(INSTALL) -d $(DESTDIR)$(INSTALL_INC_DIR)/EGL
	$(INSTALL) -m 644 $(TOP)/include/EGL/*.h \
		$(DESTDIR)$(INSTALL_INC_DIR)/EGL

PKG_CONFIG_DIR = $(INSTALL_LIB_DIR)/pkgconfig

gl_pcedit = sed \
	-e 's,@@INSTALL_DIR@@,$(INSTALL_DIR),' \
	-e 's,@@INSTALL_LIB_DIR@@,$(INSTALL_LIB_DIR),' \
	-e 's,@@INSTALL_INC_DIR@@,$(INSTALL_INC_DIR),' \
	-e 's,@@VERSION@@,$(MESA_MAJOR).$(MESA_MINOR).$(MESA_TINY),' \
	-e 's,@@EGL_PC_REQ_PRIV@@,$(EGL_PC_REQ_PRIV),' \
	-e 's,@@EGL_PC_LIB_PRIV@@,$(EGL_PC_LIB_PRIV),' \
	-e 's,@@EGL_PC_CFLAGS@@,$(EGL_PC_CFLAGS),' \
	-e 's,@@EGL_LIB@@,$(EGL_LIB),'

egl.pc: egl.pc.in
	$(gl_pcedit) $< > $@@

install: default install-headers egl.pc
	$(INSTALL) -d $(DESTDIR)$(INSTALL_LIB_DIR)
	$(MINSTALL) $(TOP)/$(LIB_DIR)/$(EGL_LIB_GLOB) \
		$(DESTDIR)$(INSTALL_LIB_DIR)
	$(INSTALL) -d $(DESTDIR)$(PKG_CONFIG_DIR)
	$(INSTALL) -m 644 egl.pc $(DESTDIR)$(PKG_CONFIG_DIR)

clean:
	-rm -f *.o
	-rm -f depend depend.bak


depend: $(SOURCES) $(HEADERS)
	@@ echo "running $(MKDEP)"
	@@ rm -f depend
	@@ touch depend
	$(MKDEP) $(MKDEP_OPTIONS) $(DEFINES) $(INCLUDE_DIRS) \
		$(SOURCES) $(HEADERS) > /dev/null 2>/dev/null


-include depend
# DO NOT DELETE
@


1.4
log
@Upate to libGL 7.11.2

Tested by jsg@@, matthieu@@ and ajacoutot@@, ok mattieu@@
@
text
@@


1.3
log
@Merge Mesa 7.10.3
@
text
@d55 25
d86 3
d111 1
a111 1
$(TOP)/$(LIB_DIR)/$(EGL_LIB_NAME): $(OBJECTS)
d115 2
a116 1
		$(EGL_LIB_DEPS) $(OBJECTS)
@


1.2
log
@Update to Mesa 7.8.1. Tested on a bulk ports build by naddy@@, ok oga@@.
@
text
@d10 1
a10 1
INCLUDE_DIRS = -I$(TOP)/include $(X11_CFLAGS)
a14 1
	eglconfigutil.h \
d28 2
a29 1
	eglsurface.h
d33 1
a34 1
	eglconfigutil.c \
d39 1
d47 2
a48 1
	eglsurface.c
d54 1
a54 1
LOCAL_CFLAGS = -D_EGL_PLATFORM_POSIX=1
d56 11
a66 1
EGL_DEFAULT_DISPLAY = $(word 1, $(EGL_DISPLAYS))
d69 1
a69 1
	-D_EGL_DEFAULT_DISPLAY=\"$(EGL_DEFAULT_DISPLAY)\" \
d97 16
a112 1
install: default install-headers
d116 2
@


1.1
log
@Mesa 7.2, Tested by ckuethe@@, naddy@@, oga@@, and others.
@
text
@d7 4
a10 1
INCLUDE_DIRS = -I$(TOP)/include -I$(TOP)/src/mesa/glapi
d13 1
d15 1
d17 2
d22 1
d24 1
a24 1
	eglhash.h \
d26 1
d28 1
d34 1
d36 1
d40 1
d42 1
a42 1
	eglhash.c \
d45 1
d51 9
d61 1
a61 1
	$(CC) -c $(INCLUDE_DIRS) $(CFLAGS) $< -o $@@
d69 1
a69 7
library: $(TOP)/$(LIB_DIR)/libEGL.so

$(TOP)/$(LIB_DIR)/libEGL.so: $(OBJECTS)
	$(MKLIB) -o EGL -linker '$(CC)' -ldflags '$(LDFLAGS)' \
		-major 1 -minor 0 \
		-install $(TOP)/$(LIB_DIR) -ldl $(OBJECTS)

d71 18
d91 2
a92 2
	-rm -f *.o *.so*
	-rm -f core.*
d97 1
d100 2
a101 1
		$(SOURCES) $(HEADERS) > /dev/null 
d103 1
a103 1
include depend
@


1.1.1.1
log
@Import Mesa 7.10.3
@
text
@d7 1
a7 4
EGL_MAJOR = 1
EGL_MINOR = 0

INCLUDE_DIRS = -I$(TOP)/include
a9 1
	eglcompiler.h \
a11 2
	eglcurrent.h \
	egldefines.h \
a14 1
	eglimage.h \
d16 1
a16 1
	eglmisc.h \
a17 1
	eglmutex.h \
d19 1
a19 3
	eglstring.h \
	eglsurface.h \
	eglsync.h
a22 1
	eglarray.c \
a24 1
	eglcurrent.c \
a26 1
	eglfallbacks.c \
a27 1
	eglimage.c \
d29 1
a29 1
	eglmisc.c \
d32 1
a32 3
	eglstring.c \
	eglsurface.c \
	eglsync.c
a36 19
# use dl*() to load drivers
LOCAL_CFLAGS = -D_EGL_OS_UNIX=1

# translate --with-egl-platforms to _EGLPlatformType
EGL_NATIVE_PLATFORM=_EGL_INVALID_PLATFORM
ifeq ($(firstword $(EGL_PLATFORMS)),x11)
EGL_NATIVE_PLATFORM=_EGL_PLATFORM_X11
endif
ifeq ($(firstword $(EGL_PLATFORMS)),drm)
EGL_NATIVE_PLATFORM=_EGL_PLATFORM_DRM
endif
ifeq ($(firstword $(EGL_PLATFORMS)),fbdev)
EGL_NATIVE_PLATFORM=_EGL_PLATFORM_FBDEV
endif

LOCAL_CFLAGS += \
	-D_EGL_NATIVE_PLATFORM=$(EGL_NATIVE_PLATFORM) \
	-D_EGL_DRIVER_SEARCH_DIR=\"$(EGL_DRIVER_INSTALL_DIR)\"

d38 1
a38 1
	$(CC) -c $(INCLUDE_DIRS) $(CFLAGS) $(LOCAL_CFLAGS) $< -o $@@
d46 7
a52 1
library: $(TOP)/$(LIB_DIR)/$(EGL_LIB_NAME)
a53 35
$(TOP)/$(LIB_DIR)/$(EGL_LIB_NAME): $(OBJECTS)
	$(MKLIB) -o $(EGL_LIB) -linker '$(CC)' -ldflags '$(LDFLAGS)' \
		-major $(EGL_MAJOR) -minor $(EGL_MINOR) \
		-install $(TOP)/$(LIB_DIR) $(MKLIB_OPTIONS) \
		$(EGL_LIB_DEPS) $(OBJECTS)

install-headers:
	$(INSTALL) -d $(DESTDIR)$(INSTALL_INC_DIR)/KHR
	$(INSTALL) -m 644 $(TOP)/include/KHR/*.h \
		$(DESTDIR)$(INSTALL_INC_DIR)/KHR
	$(INSTALL) -d $(DESTDIR)$(INSTALL_INC_DIR)/EGL
	$(INSTALL) -m 644 $(TOP)/include/EGL/*.h \
		$(DESTDIR)$(INSTALL_INC_DIR)/EGL

PKG_CONFIG_DIR = $(INSTALL_LIB_DIR)/pkgconfig

gl_pcedit = sed \
	-e 's,@@INSTALL_DIR@@,$(INSTALL_DIR),' \
	-e 's,@@INSTALL_LIB_DIR@@,$(INSTALL_LIB_DIR),' \
	-e 's,@@INSTALL_INC_DIR@@,$(INSTALL_INC_DIR),' \
	-e 's,@@VERSION@@,$(MESA_MAJOR).$(MESA_MINOR).$(MESA_TINY),' \
	-e 's,@@EGL_PC_REQ_PRIV@@,$(EGL_PC_REQ_PRIV),' \
	-e 's,@@EGL_PC_LIB_PRIV@@,$(EGL_PC_LIB_PRIV),' \
	-e 's,@@EGL_PC_CFLAGS@@,$(EGL_PC_CFLAGS),' \
	-e 's,@@EGL_LIB@@,$(EGL_LIB),'

egl.pc: egl.pc.in
	$(gl_pcedit) $< > $@@

install: default install-headers egl.pc
	$(INSTALL) -d $(DESTDIR)$(INSTALL_LIB_DIR)
	$(MINSTALL) $(TOP)/$(LIB_DIR)/$(EGL_LIB_GLOB) \
		$(DESTDIR)$(INSTALL_LIB_DIR)
	$(INSTALL) -d $(DESTDIR)$(PKG_CONFIG_DIR)
	$(INSTALL) -m 644 egl.pc $(DESTDIR)$(PKG_CONFIG_DIR)
d56 2
a57 2
	-rm -f *.o
	-rm -f depend depend.bak
a61 1
	@@ rm -f depend
d64 1
a64 2
		$(SOURCES) $(HEADERS) > /dev/null 2>/dev/null

d66 1
a66 1
-include depend
@


