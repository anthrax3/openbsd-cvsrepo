head	1.2;
access;
symbols
	OPENBSD_6_1_BASE:1.2
	OPENBSD_6_0:1.1.0.8
	OPENBSD_6_0_BASE:1.1
	OPENBSD_5_9:1.1.0.6
	OPENBSD_5_9_BASE:1.1
	OPENBSD_5_8:1.1.0.4
	OPENBSD_5_8_BASE:1.1
	OPENBSD_5_7:1.1.0.2
	OPENBSD_5_7_BASE:1.1;
locks; strict;
comment	@# @;


1.2
date	2016.09.02.10.09.43;	author matthieu;	state Exp;
branches;
next	1.1;
commitid	mKDGsTNpiR2zRHYQ;

1.1
date	2015.01.26.21.32.11;	author matthieu;	state Exp;
branches;
next	;
commitid	01TEvO4uNHLqFv7N;


desc
@@


1.2
log
@Update to xcb-proto/libxcb 1.12. "Just commit it" naddy@@
@
text
@#!/bin/sh

case "$AM_SRCDIR" in
"")
	AM_SRCDIR="."
	;;
*)
	;;
esac

fix=n
status=0
case "$1" in
"-fix")
	fix=y
	;;
esac

for inc in src/*.h; do
	package=xcb-`basename $inc .h`
	pcin="$AM_SRCDIR"/$package.pc.in
	if [ -f $pcin ]; then
		included=`grep '# *include' $inc |
			sed -e 's/[^<"]*[<"]//' -e 's/[>"]//' |
			grep -v 'xcb.h\|xproto.h'`
		requires=`grep '^Requires.private:' $pcin`
		missing=""
		for i in $included; do
			ibase=`basename $i .h`
			r="xcb-$ibase"
			rpcin="$AM_SRCDIR"/$r.pc.in
			if [ -f $rpcin ]; then
				m="$r"
				for has in $requires; do
					if [ $has = $r ]; then
						m=""
					fi
				done
				case "$m" in
				"")
					;;
				*)
					case "$missing" in
					"")
						missing=$m
						;;
					*)
						missing="$missing $m"
						;;
					esac
					;;
				esac
			fi
		done
		case "$missing" in
		"")
			;;
		*)
			if [ "$fix" = "y" ]; then
			    echo $package adding dependency on $missing
			    sed -i '/^Requires.private:/s/$/ '"$missing"'/' $pcin
			else
			    echo $package missing $missing
			    status=1
			fi
			;;
		esac
	fi
done
exit $status
@


1.1
log
@Update to libxcb and xcb-proto 1.11.
Tested on a bulk ports build by naddy@@.
Lots of churn due to white-space and comments changes in generated code.
@
text
@d26 1
a26 1
		requires=`grep '^Requires:' $pcin`
d61 1
a61 1
			    sed -i '/^Requires:/s/$/ '"$missing"'/' $pcin
@

