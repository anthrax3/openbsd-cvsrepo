head	1.10;
access;
symbols
	OPENBSD_5_8:1.9.0.4
	OPENBSD_5_8_BASE:1.9
	OPENBSD_5_7:1.9.0.2
	OPENBSD_5_7_BASE:1.9
	OPENBSD_5_6:1.7.0.2
	OPENBSD_5_6_BASE:1.7
	OPENBSD_5_5:1.5.0.2
	OPENBSD_5_5_BASE:1.5
	OPENBSD_5_4:1.3.0.2
	OPENBSD_5_4_BASE:1.3
	OPENBSD_5_3:1.2.0.2
	OPENBSD_5_3_BASE:1.2
	OPENBSD_5_2:1.1.1.1.0.2
	OPENBSD_5_2_BASE:1.1.1.1
	v7_1O_3:1.1.1.1
	mesa:1.1.1;
locks; strict;
comment	@# @;


1.10
date	2015.12.23.05.06.02;	author jsg;	state dead;
branches;
next	1.9;
commitid	jLBLHykYtPbp9N8b;

1.9
date	2015.01.25.15.09.13;	author jsg;	state Exp;
branches;
next	1.8;
commitid	M1dxZ5qfRB65OrtK;

1.8
date	2014.09.07.15.32.18;	author jsg;	state Exp;
branches;
next	1.7;
commitid	z9PmZqUCgC34b3qk;

1.7
date	2014.07.09.21.32.40;	author jsg;	state Exp;
branches;
next	1.6;
commitid	uM5VFgRcH6JLiuF9;

1.6
date	2014.04.20.10.58.20;	author jsg;	state Exp;
branches;
next	1.5;

1.5
date	2014.01.11.12.39.14;	author miod;	state Exp;
branches;
next	1.4;

1.4
date	2013.09.05.15.11.59;	author jsg;	state Exp;
branches;
next	1.3;

1.3
date	2013.04.14.10.23.04;	author mpi;	state Exp;
branches;
next	1.2;

1.2
date	2012.11.11.12.09.09;	author mpi;	state Exp;
branches;
next	1.1;

1.1
date	2012.07.13.12.43.30;	author mpi;	state Exp;
branches
	1.1.1.1;
next	;

1.1.1.1
date	2012.07.13.12.43.30;	author mpi;	state Exp;
branches;
next	;


desc
@@


1.10
log
@remove now unused local build system for Mesa
@
text
@# $OpenBSD: Makefile.inc,v 1.9 2015/01/25 15:09:13 jsg Exp $
.include <bsd.xconf.mk>
.include "../config.mk"

OBJS+=  ${SRCS:N*.h:R:S/$/.so/g}

.SUFFIXES:
.SUFFIXES: .a .c .cpp .o .so

.c.so:
	@@echo "${COMPILE.c} ${PICFLAG} -DPIC ${.IMPSRC} -o ${.TARGET}"
	@@${COMPILE.c} ${PICFLAG} -DPIC ${.IMPSRC} -o ${.TARGET}.o
	@@${LD} -X -r ${.TARGET}.o -o ${.TARGET}
	@@rm -f ${.TARGET}.o

.cpp.so:
	@@echo "${COMPILE.cc} ${PICFLAG} -DPIC ${.IMPSRC} -o ${.TARGET}"
	@@${COMPILE.cc} ${PICFLAG} -DPIC ${.IMPSRC} -o ${.TARGET}.o
	@@${LD} -X -r ${.TARGET}.o -o ${.TARGET}
	@@rm -f ${.TARGET}.o

lib${LIB}_pic.a: ${OBJS} ${DPADD}
	@@rm -f lib${LIB}_pic.a
	@@${AR} cq lib${LIB}_pic.a `${LORDER} ${OBJS} | tsort -q`
	${RANLIB} lib${LIB}_pic.a

CPPFLAGS+=-DPIPE_SEARCH_DIR=\"${X11BASE}/lib/modules/gallium-pipe\" \
	-DGALLIUM_STATIC_TARGETS=1

.if ${XENOCARA_BUILD_GALLIUM} == "llvm"

LLVM_CONFIG?=	/usr/local/bin/llvm-config
LLVM_V!=	${LLVM_CONFIG} --version | sed 's/svn.*//g'
LLVM_V_MAJOR!=	echo ${LLVM_V} | cut -d. -f 1
LLVM_V_MINOR!=	echo ${LLVM_V} | cut -d. -f 2
LLVM_V_PATCH!=	echo ${LLVM_V} | cut -d. -f 3

.if empty(LLVM_V_PATCH)
LLVM_V_PATCH=0
.endif

LLVM_VERSION_INT="${LLVM_V_MAJOR}0${LLVM_V_MINOR}"

# ugh...
ALLVM_CFLAGS!=		${LLVM_CONFIG} --cflags
ALLVM_CPPFLAGS!=	${LLVM_CONFIG} --cxxflags
BLLVM_CFLAGS=	${ALLVM_CFLAGS:M-[IDf]*}
BLLVM_CPPFLAGS=	${ALLVM_CPPFLAGS:M-[IDf]*}
LLVM_CFLAGS=	${BLLVM_CFLAGS:S/-DNDEBUG//}
LLVM_CPPFLAGS=	${BLLVM_CPPFLAGS:S/-DNDEBUG//}
LLVM_LIBDIR!=	${LLVM_CONFIG} --libdir
LLVM_LIBS!=	${LLVM_CONFIG} --libs engine bitwriter mcjit r600 bitreader ipo asmparser

CFLAGS+=	${LLVM_CFLAGS}
CXXFLAGS=	${LLVM_CPPFLAGS}
LDADD+=		-L${LLVM_LIBDIR} ${LLVM_LIBS}

CPPFLAGS+= \
	-DGALLIUM_LLVMPIPE \
	-DHAVE_LLVM=0x0${LLVM_VERSION_INT} -DLLVM_VERSION_PATCH=${LLVM_V_PATCH}

SWRAST_DRIVERS+= ../../gallium/drivers/llvmpipe/libllvmpipe_pic.a

# for r600 and radeonsi
LOCALBASE?=	/usr/local
LDADD+=		${LOCALBASE}/lib/libelf.a
.endif
@


1.9
log
@Mesa 10.4.3
@
text
@d1 1
a1 1
# $OpenBSD: Makefile.inc,v 1.8 2014/09/07 15:32:18 jsg Exp $
@


1.8
log
@Mesa 10.2.7
@
text
@d1 1
a1 1
# $OpenBSD: Makefile.inc,v 1.7 2014/07/09 21:32:40 jsg Exp $
d27 2
@


1.7
log
@Mesa 10.2.3
@
text
@d1 1
a1 1
# $OpenBSD: Makefile.inc,v 1.6 2014/04/20 10:58:20 jsg Exp $
a29 2
# Remember to keep in sync with LLVM port's version.
LLVM_VERSION=	0x305	# 3.5
d31 10
d58 1
a58 1
	-DHAVE_LLVM=${LLVM_VERSION} -DLLVM_VERSION_PATCH=0
@


1.6
log
@sync LLVM_VERSION with the llvm port.
@
text
@d1 1
a1 1
# $OpenBSD: Makefile.inc,v 1.5 2014/01/11 12:39:14 miod Exp $
d3 1
a3 5

CPP=	cpp -notraditional

CFLAGS+= -std=c99
CPPFLAGS+= -DPACKAGE_BUGREPORT=\"bugs@@openbsd.org\"
d50 1
a50 1
	-DHAVE_LLVM=${LLVM_VERSION}
a56 5
.endif

.if ${MACHINE_ARCH} == "m68k" || ${MACHINE_ARCH} == "powerpc" || \
    ${MACHINE_ARCH} == "sparc"
PICFLAG=-fPIC
@


1.5
log
@m68k needs libGL compiled with -fPIC
@
text
@d1 1
a1 1
# $OpenBSD: Makefile.inc,v 1.4 2013/09/05 15:11:59 jsg Exp $
d35 1
a35 1
LLVM_VERSION=	0x303	# 3.3 
@


1.4
log
@build infrastructure changes for Mesa 9.2.0
ok matthieu@@ mpi@@
@
text
@d1 1
a1 1
# $OpenBSD: Makefile.inc,v 1.3 2013/04/14 10:23:04 mpi Exp $
d63 2
a64 1
.if ${MACHINE_ARCH} == powerpc || ${MACHINE_ARCH} == sparc
@


1.3
log
@Add a new option to the xenocara infrastructure be able to automatically
build the Gallium3D software rasterizer as part of the libGL.

Note that it can also makes use of LLVM to build the llvmpipe if the
corresponding port is installed. Please refer to the README for a more
complete documentation.

Prodded by ajacoutot@@, ok matthieu@@
@
text
@d1 1
a1 1
# $OpenBSD: Makefile.inc,v 1.2 2012/11/11 12:09:09 mpi Exp $
d6 3
d35 1
a35 1
LLVM_VERSION=	0x301	# 3.1 
d38 7
a44 2
LLVM_CFLAGS!=	${LLVM_CONFIG} --cflags
LLVM_CPPFLAGS!=	${LLVM_CONFIG} --cxxflags
d46 1
a46 1
LLVM_LIBS!=	${LLVM_CONFIG} --libs engine
d48 1
a48 1
CFLAGS+=	${LLVM_CFLAGS} -std=gnu99
d57 4
a61 1

@


1.2
log
@Link libGL with -lpthread to allow the llvm-pipe driver to be loaded.

ok matthieu@@, ajacoutot@@
@
text
@d1 2
a2 1
# $OpenBSD: Makefile.inc,v 1.1.1.1 2012/07/13 12:43:30 mpi Exp $
d29 3
a31 1
.ifdef XENOCARA_HAVE_LLVM
d47 2
@


1.1
log
@Initial revision
@
text
@d1 1
a1 1
# $OpenBSD$
d34 1
a34 1
LLVM_LDFLAGS!=	${LLVM_CONFIG} --ldflags
d39 1
a39 1
LDADD+=		${LLVM_LDFLAGS} ${LLVM_LIBS}
@


1.1.1.1
log
@Import the infrastructure for building Gallium3D graphics drivers.
Currently only software drivers are supported, looks ok to matthieu.
@
text
@@
