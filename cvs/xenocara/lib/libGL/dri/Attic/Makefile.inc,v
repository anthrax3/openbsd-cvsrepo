head	1.25;
access;
symbols
	OPENBSD_5_8:1.22.0.4
	OPENBSD_5_8_BASE:1.22
	OPENBSD_5_7:1.22.0.2
	OPENBSD_5_7_BASE:1.22
	OPENBSD_5_6:1.20.0.2
	OPENBSD_5_6_BASE:1.20
	OPENBSD_5_5:1.18.0.2
	OPENBSD_5_5_BASE:1.18
	OPENBSD_5_4:1.16.0.4
	OPENBSD_5_4_BASE:1.16
	OPENBSD_5_3:1.16.0.2
	OPENBSD_5_3_BASE:1.16
	OPENBSD_5_2:1.13.0.2
	OPENBSD_5_2_BASE:1.13
	OPENBSD_5_1_BASE:1.12
	OPENBSD_5_1:1.12.0.2
	OPENBSD_5_0:1.10.0.6
	OPENBSD_5_0_BASE:1.10
	OPENBSD_4_9:1.10.0.2
	OPENBSD_4_9_BASE:1.10
	OPENBSD_4_8:1.10.0.4
	OPENBSD_4_8_BASE:1.10
	OPENBSD_4_7:1.9.0.4
	OPENBSD_4_7_BASE:1.9
	OPENBSD_4_6:1.9.0.2
	OPENBSD_4_6_BASE:1.9
	OPENBSD_4_5:1.8.0.2
	OPENBSD_4_5_BASE:1.8
	OPENBSD_4_4:1.6.0.2
	OPENBSD_4_4_BASE:1.6
	OPENBSD_4_3_BASE:1.4
	OPENBSD_4_3:1.4.0.2;
locks; strict;
comment	@# @;


1.25
date	2015.12.23.05.06.01;	author jsg;	state dead;
branches;
next	1.24;
commitid	jLBLHykYtPbp9N8b;

1.24
date	2015.08.22.00.50.54;	author jsg;	state Exp;
branches;
next	1.23;
commitid	jZtwe3SD2DamfWe4;

1.23
date	2015.08.19.23.00.12;	author matthieu;	state Exp;
branches;
next	1.22;
commitid	fw853FWA6SfHws9e;

1.22
date	2015.02.20.23.31.04;	author jsg;	state Exp;
branches;
next	1.21;
commitid	96FH88ZMzjHy95WG;

1.21
date	2015.01.25.15.09.12;	author jsg;	state Exp;
branches;
next	1.20;
commitid	M1dxZ5qfRB65OrtK;

1.20
date	2014.07.17.13.53.23;	author jsg;	state Exp;
branches;
next	1.19;
commitid	Bndhh6N9oTrdIldh;

1.19
date	2014.07.09.21.32.40;	author jsg;	state Exp;
branches;
next	1.18;
commitid	uM5VFgRcH6JLiuF9;

1.18
date	2013.09.05.15.11.57;	author jsg;	state Exp;
branches;
next	1.17;

1.17
date	2013.08.22.18.48.46;	author miod;	state Exp;
branches;
next	1.16;

1.16
date	2012.11.28.13.53.16;	author mpi;	state Exp;
branches;
next	1.15;

1.15
date	2012.08.26.18.46.42;	author mpi;	state Exp;
branches;
next	1.14;

1.14
date	2012.08.17.13.58.00;	author mpi;	state Exp;
branches;
next	1.13;

1.13
date	2012.07.13.12.55.32;	author mpi;	state Exp;
branches;
next	1.12;

1.12
date	2011.10.26.21.15.07;	author matthieu;	state Exp;
branches;
next	1.11;

1.11
date	2011.10.23.13.57.36;	author matthieu;	state Exp;
branches;
next	1.10;

1.10
date	2010.05.22.20.14.14;	author matthieu;	state Exp;
branches;
next	1.9;

1.9
date	2009.05.17.20.20.23;	author matthieu;	state Exp;
branches;
next	1.8;

1.8
date	2009.01.10.16.06.51;	author oga;	state Exp;
branches;
next	1.7;

1.7
date	2008.11.02.15.01.32;	author matthieu;	state Exp;
branches;
next	1.6;

1.6
date	2008.04.19.07.15.17;	author matthieu;	state Exp;
branches;
next	1.5;

1.5
date	2008.03.25.23.41.50;	author matthieu;	state Exp;
branches;
next	1.4;

1.4
date	2008.02.20.22.41.51;	author matthieu;	state Exp;
branches;
next	1.3;

1.3
date	2008.02.07.00.09.01;	author oga;	state Exp;
branches;
next	1.2;

1.2
date	2008.02.02.17.24.30;	author matthieu;	state Exp;
branches;
next	1.1;

1.1
date	2007.12.04.22.00.27;	author matthieu;	state Exp;
branches;
next	;


desc
@@


1.25
log
@remove now unused local build system for Mesa
@
text
@# $OpenBSD: Makefile.inc,v 1.24 2015/08/22 00:50:54 jsg Exp $
.include <bsd.xconf.mk>
.include "../config.mk"

TOP=		${.CURDIR}/../../../../dist/Mesa
MESA=		${.CURDIR}/../../../../dist/Mesa/src/mesa
GALLIUM=	${.CURDIR}/../../../../dist/Mesa/src/gallium

DRI_DRIVER_INSTALL_DIR=	${X11BASE}/lib/modules/dri

COMMON_GALLIUM_SOURCES = \
	utils.c \
	dri_util.c \
	xmlconfig.c

COMMON_SOURCES = $(COMMON_GALLIUM_SOURCES) \
	megadriver_stub.c

CPPFLAGS+= -DIN_DRI_DRIVER -DGLX_DIRECT_RENDERING \
	 $(INCLUDES) $(DRIVER_DEFINES)

INCLUDES = \
	-I$(TOP)/src/mesa/drivers/dri/common \
	-I$(TOP)/include \
	-I$(TOP)/include/GL/internal \
	-I$(TOP)/src \
	-I$(TOP)/src/gallium/state_trackers/dri \
	-I$(TOP)/src/glsl \
	-I$(TOP)/src/mesa \
	-I$(TOP)/src/mesa/main \
	-I$(TOP)/src/loader \
	-I$(TOP)/src/mapi \
	-I$(TOP)/src/mesa/math \
	-I$(TOP)/src/mesa/transform \
	-I$(TOP)/src/mesa/shader \
	-I$(TOP)/src/mesa/swrast \
	-I$(TOP)/src/mesa/swrast_setup \
	-I$(TOP)/src/egl/main \
	-I$(TOP)/src/egl/drivers/dri \
	-I${.CURDIR}/../../generated \
	-I$(X11BASE)/include \
	-I$(X11BASE)/include/libdrm

.if ${MACHINE_ARCH} == "i386"
CPPFLAGS += \
	-DUSE_X86_ASM \
	-DUSE_MMX_ASM \
	-DUSE_3DNOW_ASM \
	-DUSE_SSE_ASM
.elif ${MACHINE_ARCH} == "amd64"
CPPFLAGS += -DUSE_X86_64_ASM
.endif

LDADD?=	../../mesa/libmesa/libmesa_pic.a \
	../../glsl/libglsl/libglsl_pic.a \
	-L${X11BASE}/lib  -lexpat -ldrm -lm -lstdc++ -lc

.PATH: ${MESA}/drivers/dri/common
.PATH: ${MESA}/drivers/common

.SUFFIXES:
.SUFFIXES: .a .c .cpp .o .S .s .so

.c.so:
	@@echo "${COMPILE.c} ${PICFLAG} -DPIC ${.IMPSRC} -o ${.TARGET}"
	@@${COMPILE.c} ${PICFLAG} -DPIC ${.IMPSRC} -o ${.TARGET}.o
	@@${LD} -X -r ${.TARGET}.o -o ${.TARGET}
	@@rm -f ${.TARGET}.o

.cpp.so:
	@@echo "${COMPILE.cc} ${PICFLAG} -DPIC ${.IMPSRC} -o ${.TARGET}"
	@@${COMPILE.cc} ${PICFLAG} -DPIC ${.IMPSRC} -o ${.TARGET}.o
	@@${LD} -X -r ${.TARGET}.o -o ${.TARGET}
	@@rm -f ${.TARGET}.o


all: ${LIB}

OBJS+=  ${SRCS:N*.h:R:S/$/.so/g}

${LIB}:	${OBJS} ${DPADD}
	${CC} -shared ${PICFLAG} -o $@@ `${LORDER} ${OBJS}|tsort -q` ${LDADD}

clean:
	rm -f ${LIB} ${OBJS}

cleandir:	clean

install: $(LIB)
	${INSTALL} ${INSTALL_COPY} -o ${LIBOWN} -g ${LIBGRP} -m ${LIBMODE} \
	${LIB} ${DESTDIR}${DRI_DRIVER_INSTALL_DIR}

.include <bsd.dep.mk>
@


1.24
log
@use the drm headers from libdrm not the kernel
@
text
@d1 1
a1 1
# $OpenBSD: Makefile.inc,v 1.23 2015/08/19 23:00:12 matthieu Exp $
@


1.23
log
@Enable the build of libOSMesa. Ports will need it soon.
tested by juanfra@@ ok jsg@@
@
text
@d1 1
a1 1
# $OpenBSD: Makefile.inc,v 1.22 2015/02/20 23:31:04 jsg Exp $
d42 1
a42 1
	-I/usr/include/dev/pci/drm
@


1.22
log
@switch back to Mesa 10.2

With 10.4.3 gpu compositing on chromium would result in a black window
on older Intel parts (ie x60s with 945gm) and at least some discrete
Radeon parts.  These problems do not seem to occur on recent Intel
parts, though those have coherent memory and hardware contexts.

It isn't clear what changes in Mesa are involved in the problem
though it also occurs with the 10.3 branch.
@
text
@d1 1
a1 1
# $OpenBSD: Makefile.inc,v 1.21 2015/01/25 15:09:12 jsg Exp $
a16 4
	driverfuncs.c \
	meta_blit.c \
	meta_generate_mipmap.c \
	meta.c \
@


1.21
log
@Mesa 10.4.3
@
text
@d1 1
a1 1
# $OpenBSD: Makefile.inc,v 1.20 2014/07/17 13:53:23 jsg Exp $
d14 1
a14 2
	xmlconfig.c \
	megadriver_stub.c
a18 1
	meta_copy_image.c \
d20 2
a21 1
	meta.c
a58 1
	../../mesa/libmesautil/libmesautil_pic.a \
@


1.20
log
@use CPPFLAGS instead of CFLAGS for additional defines/includes
@
text
@d1 1
a1 1
# $OpenBSD: Makefile.inc,v 1.19 2014/07/09 21:32:40 jsg Exp $
d15 1
d20 1
d22 1
a22 2
	meta.c \
	megadriver_stub.c
d32 1
d36 1
d60 1
a62 1
DPADD?=	../../mesa/libmesa/libmesa_pic.a
d87 1
a87 1
${LIB}:	${OBJS} $(DPADD)
@


1.19
log
@Mesa 10.2.3
@
text
@d1 1
a1 1
# $OpenBSD: Makefile.inc,v 1.18 2013/09/05 15:11:57 jsg Exp $
d23 1
a23 1
CFLAGS+= -DIN_DRI_DRIVER -DGLX_DIRECT_RENDERING \
@


1.18
log
@build infrastructure changes for Mesa 9.2.0
ok matthieu@@ mpi@@
@
text
@d1 1
a1 1
# $OpenBSD: Makefile.inc,v 1.17 2013/08/22 18:48:46 miod Exp $
d3 1
d18 4
a21 1
	meta.c
d23 1
a23 1
CFLAGS+= -std=c99 -g -DIN_DRI_DRIVER -DGLX_DIRECT_RENDERING -DHAVE_PTHREAD \
@


1.17
log
@Remove COMPILER_VERSION tests used to special-case gcc 2, since it is no
longer used.
@
text
@d1 1
a1 1
# $OpenBSD: Makefile.inc,v 1.16 2012/11/28 13:53:16 mpi Exp $
a11 1
	vblank.c \
d17 1
a17 2
	texmem.c \
	drirenderbuffer.c
d19 1
a19 1
CFLAGS+= -std=c99 -g -DIN_DRI_DRIVER -DGLX_DIRECT_RENDERING -DPTHREADS \
d26 1
d38 1
@


1.16
log
@Include the software winsys and state tracker sources in the swrastg
driver rather than in the libmesagallium build. This non functional
change allows to use the libmesagallium in any gallium target (r300g,
nouveau...)
@
text
@d1 1
a1 1
# $OpenBSD: Makefile.inc,v 1.15 2012/08/26 18:46:42 mpi Exp $
d21 1
a21 1
CFLAGS+= -g -DIN_DRI_DRIVER -DGLX_DIRECT_RENDERING -DPTHREADS \
a22 4

.if (${COMPILER_VERSION:L:Mgcc[34]*} != "")
CFLAGS += -std=c99
.endif
@


1.15
log
@Merge libmesa and libmesagallium build makefiles because they share
a lot of common sources.

ok matthieu@@
@
text
@d1 1
a1 1
# $OpenBSD: Makefile.inc,v 1.14 2012/08/17 13:58:00 mpi Exp $
d4 3
a6 2
MESA= ${.CURDIR}/../../../../dist/Mesa/src/mesa
TOP= ${.CURDIR}/../../../../dist/Mesa
@


1.14
log
@Upate to libGL 7.11.2

Tested by jsg@@, matthieu@@ and ajacoutot@@, ok mattieu@@
@
text
@d1 1
a1 1
# $OpenBSD: Makefile.inc,v 1.13 2012/07/13 12:55:32 mpi Exp $
d55 1
a55 1
LDADD?=	../../libmesa/libmesa_pic.a \
d58 1
a58 1
DPADD?=	../../libmesa/libmesa_pic.a
@


1.13
log
@Let swrastg a chance to compile
@
text
@d1 1
a1 1
# $OpenBSD: Makefile.inc,v 1.12 2011/10/26 21:15:07 matthieu Exp $
d18 1
a18 2
	drirenderbuffer.c \
	dri_metaops.c
d31 1
@


1.12
log
@Remove extra white space at EOF
@
text
@d1 1
a1 1
# $OpenBSD: Makefile.inc,v 1.11 2011/10/23 13:57:36 matthieu Exp $
d55 1
a55 1
LDADD=	../../libmesa/libmesa_pic.a \
d58 1
a58 1
DPADD=	../../libmesa/libmesa_pic.a
@


1.11
log
@Build system updates for Mesa 7.10.3
@
text
@d1 1
a1 1
# $OpenBSD: Makefile.inc,v 1.10 2010/05/22 20:14:14 matthieu Exp $
a95 6






@


1.10
log
@Build infrastructure for Mesa 7.8.1.
@
text
@d1 1
a1 1
# $OpenBSD: Makefile.inc,v 1.9 2009/05/17 20:20:23 matthieu Exp $
a27 3
t:
	@@echo x${COMPILER_VERSION:L:Mgcc[34]*}x

d34 1
a34 1
	-I$(TOP)/src/mesa/glapi \
d56 3
a58 6
	../../glsl/pp/libglslpp_pic.a \
	../../glsl/cl/libglslcl_pic.a \
	-L${X11BASE}/lib -lX11 -lexpat -ldrm -lm
DPADD=	../../libmesa/libmesa_pic.a \
	../../glsl/pp/libglslpp_pic.a \
	../../glsl/cl/libglslcl_pic.a
d64 1
a64 1
.SUFFIXES: .a .c .o .S .s .so
d71 7
@


1.9
log
@Update build infrastructure for Mesa 7.4.
@
text
@d1 1
a1 1
# $OpenBSD: Makefile.inc,v 1.8 2009/01/10 16:06:51 oga Exp $
d9 1
a9 1
COMMON_SOURCES = \
a10 1
	texmem.c \
a13 1
	drirenderbuffer.c
d15 15
a29 1
CFLAGS+= -DIN_DRI_DRIVER -DGLX_DIRECT_RENDERING -DPTHREADS $(INCLUDES) $(DRIVER_DEFINES)
d58 7
a64 2
LDADD=	../../libmesa/libmesa_pic.a -L${X11BASE}/lib -lX11 -lexpat -ldrm -lm
DPADD=	../../libmesa/libmesa_pic.a
@


1.8
log
@Switch over to using the kernel *_drm.h headers instead of the copies
thereof provided with libdrm. This has been annoying me forever, and it
a blight caused by developing widely used drivers out of the kernel
tree.

ok matthieu@@
@
text
@d1 1
a1 1
# $OpenBSD: Makefile.inc,v 1.7 2008/11/02 15:01:32 matthieu Exp $
a15 4

COMMON_BM_SOURCES = \
	dri_bufmgr.c \
        dri_bufmgr_fake.c
@


1.7
log
@Update build infrastructure for libGL after Mesa 7.2 update.
@
text
@d1 1
a1 1
# $OpenBSD: Makefile.inc,v 1.6 2008/04/19 07:15:17 matthieu Exp $
d38 1
a38 1
	-I$(X11BASE)/include/drm
@


1.6
log
@dri libs depend on libmesa_pic.a
@
text
@d1 1
a1 1
# $OpenBSD: Makefile.inc,v 1.5 2008/03/25 23:41:50 matthieu Exp $
a9 1
	driverfuncs.c \
d19 1
a19 1
	dri_drmpool.c
d39 10
@


1.5
log
@Introduce bsd.xconf.mk to set default config variables used
at several places in the Xenocara build in a central place instead
of duplicating the checks all over the place. ok oga@@.
@
text
@d1 1
a1 1
# $OpenBSD: Makefile.inc,v 1.4 2008/02/20 22:41:51 matthieu Exp $
d42 2
@


1.4
log
@dri drivers need too be linked against libX11 for AIGLX (for threads stubs).
Problem found by oga@@. Thanks.
@
text
@d1 2
a2 2
# $OpenBSD: Makefile.inc,v 1.3 2008/02/07 00:09:01 oga Exp $
.include <bsd.own.mk>
a7 1
X11BASE ?= /usr/X11R6
@


1.3
log
@Fix the linkage and CFLAGS of the dri libs. they don't segfault immediately
on startup now.

still a little sketchy though.
@
text
@d1 1
a1 1
# $OpenBSD: Makefile.inc,v 1.2 2008/02/02 17:24:30 matthieu Exp $
d42 1
a42 1
LDADD=	../../libmesa/libmesa_pic.a -L${X11BASE}/lib -lexpat -ldrm -lm
@


1.2
log
@stuff for building libGL with dri support. Also includes clean-up
of the regular libGL build. bump major because some symbols were
removed. ok oga@@
@
text
@d1 1
a1 1
# $OpenBSD: Makefile.inc,v 1.1 2007/12/04 22:00:27 matthieu Exp $
d23 1
a23 1
CFLAGS+= -DIN_DRI_DRIVER $(INCLUDES) $(DRIVER_DEFINES)
d42 1
a42 1
LDADD=	../../libmesa/libmesa_pic.a -L${X11BASE}/lib -lexpat -ldrm 
@


1.1
log
@Build infrastructure for libGL dri modules.
Work in progress, not connected to the build yet.
@
text
@d1 1
a1 1
# $OpenBSD$
d42 1
a42 1
LDADD=	-L${X11BASE}/lib -lexpat -ldrm 
@

