head	1.14;
access;
symbols
	OPENBSD_5_8:1.13.0.4
	OPENBSD_5_8_BASE:1.13
	OPENBSD_5_7:1.13.0.2
	OPENBSD_5_7_BASE:1.13
	OPENBSD_5_6:1.10.0.2
	OPENBSD_5_6_BASE:1.10
	OPENBSD_5_5:1.9.0.2
	OPENBSD_5_5_BASE:1.9
	OPENBSD_5_4:1.8.0.2
	OPENBSD_5_4_BASE:1.8
	OPENBSD_5_3:1.7.0.2
	OPENBSD_5_3_BASE:1.7
	OPENBSD_5_2:1.1.1.1.0.2
	OPENBSD_5_2_BASE:1.1.1.1
	v7_10_3:1.1.1.1
	mesa:1.1.1;
locks; strict;
comment	@# @;


1.14
date	2015.12.23.05.06.02;	author jsg;	state dead;
branches;
next	1.13;
commitid	jLBLHykYtPbp9N8b;

1.13
date	2015.02.22.09.30.33;	author jsg;	state Exp;
branches;
next	1.12;
commitid	yhStanAcs6cSYmBc;

1.12
date	2015.02.20.23.31.05;	author jsg;	state Exp;
branches;
next	1.11;
commitid	96FH88ZMzjHy95WG;

1.11
date	2015.01.25.15.09.13;	author jsg;	state Exp;
branches;
next	1.10;
commitid	M1dxZ5qfRB65OrtK;

1.10
date	2014.07.09.21.32.40;	author jsg;	state Exp;
branches;
next	1.9;
commitid	uM5VFgRcH6JLiuF9;

1.9
date	2013.09.05.15.11.58;	author jsg;	state Exp;
branches;
next	1.8;

1.8
date	2013.04.14.10.23.04;	author mpi;	state Exp;
branches;
next	1.7;

1.7
date	2012.12.04.14.06.32;	author mpi;	state Exp;
branches;
next	1.6;

1.6
date	2012.11.28.13.53.16;	author mpi;	state Exp;
branches;
next	1.5;

1.5
date	2012.11.11.12.09.09;	author mpi;	state Exp;
branches;
next	1.4;

1.4
date	2012.08.26.18.46.42;	author mpi;	state Exp;
branches;
next	1.3;

1.3
date	2012.08.21.10.34.07;	author mpi;	state Exp;
branches;
next	1.2;

1.2
date	2012.08.17.13.58.00;	author mpi;	state Exp;
branches;
next	1.1;

1.1
date	2012.07.13.12.54.20;	author mpi;	state Exp;
branches
	1.1.1.1;
next	;

1.1.1.1
date	2012.07.13.12.54.20;	author mpi;	state Exp;
branches;
next	;


desc
@@


1.14
log
@remove now unused local build system for Mesa
@
text
@#	$OpenBSD: Makefile,v 1.13 2015/02/22 09:30:33 jsg Exp $
.include <bsd.xconf.mk>

LIB=	swrast_dri.so

CPPFLAGS= \
	-I${GALLIUM}/include \
	-I${GALLIUM}/auxiliary \
	-I${GALLIUM}/drivers \
	-I${GALLIUM}/winsys \
	-I${GALLIUM}/winsys/sw/dri \
	-I${GALLIUM}/state_trackers/dri/common \
	-DHAVE_POSIX_MEMALIGN

DRIVER_LIBS= \
	../../gallium/drivers/trace/libtrace_pic.a \
	../../gallium/drivers/rbug/librbug_pic.a \
	../../gallium/drivers/softpipe/libsoftpipe_pic.a

DRIVER_DEFINES = \
	-DGALLIUM_RBUG \
	-DGALLIUM_TRACE \
	-DGALLIUM_SOFTPIPE \
	-DDRI_TARGET

.if ${XENOCARA_BUILD_GALLIUM} == "llvm"
DRIVER_DEFINES+= -DGALLIUM_LLVMPIPE
DRIVER_LIBS+=	../../gallium/drivers/llvmpipe/libllvmpipe_pic.a
.endif

WINSYS_SOURCES = \
	dri_sw_winsys.c

DRISW_SOURCES = \
	dri_context.c \
	dri_drawable.c \
	dri_query_renderer.c \
	dri_screen.c \
	drisw.c

SWRAST_COMMON_SOURCES = \
	utils.c \
	dri_util.c \
	xmlconfig.c

GALLIUM_DRI_SOURCES = \
	swrast_drm_api.c

SRCS = \
	${WINSYS_SOURCES} \
	${DRISW_SOURCES} \
	${SWRAST_COMMON_SOURCES} \
	${GALLIUM_DRI_SOURCES}

LDADD=	\
	../../mesa/libmesagallium/libmesagallium_pic.a \
	../../glsl/libglsl/libglsl_pic.a \
	${DRIVER_LIBS} \
	../../gallium/libgallium/libgallium_pic.a \
	-L${X11BASE}/lib -lexpat -lm -lstdc++ -lc -lxcb-dri2

.include "../../gallium/Makefile.inc"
.include <bsd.xorg.mk>

.PATH: ${GALLIUM}/state_trackers/dri
.PATH: ${GALLIUM}/state_trackers/dri/common
.PATH: ${GALLIUM}/state_trackers/dri/sw
.PATH: ${GALLIUM}/targets/dri-swrast
.PATH: ${GALLIUM}/winsys/sw/dri
@


1.13
log
@Backport support for GLX_MESA_query_renderer for non Intel drivers.
This is desirable as the chromium port now uses this extension to
obtain pci vendor/device ids for use in feature/extension blacklists.

Prompted by a mail from byrnet@@, tested on r600g by krw@@

The newly added os_get_total_physical_memory() was passing the length of
a pointer rather than the type which made the sysctl call fail on
non 64 bit archs.  And it was passing the wrong pointer for the result.
Fixes for these problems have been submitted back upstream.
@
text
@d1 1
a1 1
#	$OpenBSD: Makefile,v 1.12 2015/02/20 23:31:05 jsg Exp $
@


1.12
log
@switch back to Mesa 10.2

With 10.4.3 gpu compositing on chromium would result in a black window
on older Intel parts (ie x60s with 945gm) and at least some discrete
Radeon parts.  These problems do not seem to occur on recent Intel
parts, though those have coherent memory and hardware contexts.

It isn't clear what changes in Mesa are involved in the problem
though it also occurs with the 10.3 branch.
@
text
@d1 1
a1 1
#	$OpenBSD: Makefile,v 1.11 2015/01/25 15:09:13 jsg Exp $
d37 1
d65 1
@


1.11
log
@Mesa 10.4.3
@
text
@d1 1
a1 1
#	$OpenBSD: Makefile,v 1.10 2014/07/09 21:32:40 jsg Exp $
a11 1
	-I${GALLIUM}/winsys/sw/kms-dri \
d32 1
a32 2
	dri_sw_winsys.c \
	kms_dri_sw_winsys.c
a36 1
	dri_query_renderer.c \
a37 1
	dri2.c \
d43 1
a43 2
	xmlconfig.c \
	megadriver_stub.c
d46 1
a46 1
	target.c
a57 1
	../../mesa/libmesautil/libmesautil_pic.a \
d64 2
a65 2
.PATH: ${GALLIUM}/state_trackers/dri
.PATH: ${GALLIUM}/targets/dri
a67 1
.PATH: ${GALLIUM}/winsys/sw/kms-dri
@


1.10
log
@Mesa 10.2.3
@
text
@d1 2
a2 1
#	$OpenBSD: Makefile,v 1.9 2013/09/05 15:11:58 jsg Exp $
d10 1
d12 1
d16 1
a16 1
SWRAST_DRIVERS= \
d22 2
a23 1
	-D__NOT_HAVE_DRM_H \
d25 6
a30 2
	-DGALLIUM_RBUG \
	-DGALLIUM_TRACE
d33 2
a34 1
	dri_sw_winsys.c
d37 6
a42 4
        dri_context.c \
        dri_screen.c \
        dri_drawable.c \
        drisw.c
d47 2
a48 1
	xmlconfig.c
d50 2
a51 2
DRIVER_SOURCES = \
	swrast_drm_api.c
d57 1
a57 1
	${DRIVER_SOURCES}
d59 2
a60 1
LDADD=	../../mesa/libmesagallium/libmesagallium_pic.a \
d62 2
a63 1
	${SWRAST_DRIVERS} \
d65 1
a65 2
	-L${X11BASE}/lib -lexpat -lm -lstdc++ -lc
DPADD=	../../mesa/libmesagallium/libmesagallium_pic.a
d70 2
a71 2
.PATH: ${GALLIUM}/state_trackers/dri/common
.PATH: ${GALLIUM}/state_trackers/dri/sw
d74 1
@


1.9
log
@build infrastructure changes for Mesa 9.2.0
ok matthieu@@ mpi@@
@
text
@d1 1
a1 1
#	$OpenBSD: Makefile,v 1.8 2013/04/14 10:23:04 mpi Exp $
d35 1
a35 1
	drisw_util.c \
@


1.8
log
@Add a new option to the xenocara infrastructure be able to automatically
build the Gallium3D software rasterizer as part of the libGL.

Note that it can also makes use of LLVM to build the llvmpipe if the
corresponding port is installed. Please refer to the README for a more
complete documentation.

Prodded by ajacoutot@@, ok matthieu@@
@
text
@d1 1
a1 1
#	$OpenBSD: Makefile,v 1.7 2012/12/04 14:06:32 mpi Exp $
d3 1
a3 1
LIB=	swrastg_dri.so
@


1.7
log
@Correctly define HAVE_POSIX_MEMALIGN, missed in previous. Breakage reported
by ajacoutot@@
@
text
@d1 1
a1 1
#	$OpenBSD: Makefile,v 1.6 2012/11/28 13:53:16 mpi Exp $
d13 1
a13 1
DRIVER_LIBS= \
a17 4
.ifdef XENOCARA_HAVE_LLVM
DRIVER_LIBS+=	../../gallium/drivers/llvmpipe/libllvmpipe_pic.a
.endif

d49 1
a49 1
	${DRIVER_LIBS} \
@


1.6
log
@Include the software winsys and state tracker sources in the swrastg
driver rather than in the libmesagallium build. This non functional
change allows to use the libmesagallium in any gallium target (r300g,
nouveau...)
@
text
@d1 1
a1 1
#	$OpenBSD: Makefile,v 1.5 2012/11/11 12:09:09 mpi Exp $
d11 1
@


1.5
log
@Link libGL with -lpthread to allow the llvm-pipe driver to be loaded.

ok matthieu@@, ajacoutot@@
@
text
@d1 1
a1 1
#	$OpenBSD: Makefile,v 1.4 2012/08/26 18:46:42 mpi Exp $
a4 2
GALLIUM=	${.CURDIR}/../../../../dist/Mesa/src/gallium

d9 2
a10 1
	-I${GALLIUM}/winsys/sw/dri
d27 9
d45 2
d60 2
d63 1
@


1.4
log
@Merge libmesa and libmesagallium build makefiles because they share
a lot of common sources.

ok matthieu@@
@
text
@d1 1
a1 1
#	$OpenBSD: Makefile,v 1.3 2012/08/21 10:34:07 mpi Exp $
d3 1
a3 1
LIB=	swrast_dri.so
d44 1
a44 1
	-L${X11BASE}/lib -lexpat -lm -lstdc++ -lc -lpthread
@


1.3
log
@Use -lpthread only, pointed out by ajacoutot@@
@
text
@d1 1
a1 1
#	$OpenBSD: Makefile,v 1.2 2012/08/17 13:58:00 mpi Exp $
d40 1
a40 1
LDADD=	../../gallium/libmesagallium/libmesagallium_pic.a \
d45 1
a45 1
DPADD=	../../gallium/libmesagallium/libmesagallium_pic.a
@


1.2
log
@Upate to libGL 7.11.2

Tested by jsg@@, matthieu@@ and ajacoutot@@, ok mattieu@@
@
text
@d1 1
a1 1
#	$OpenBSD: Makefile,v 1.1.1.1 2012/07/13 12:54:20 mpi Exp $
d44 1
a44 5
	-L${X11BASE}/lib -lexpat -lm -lstdc++ -lc -pthread
# XXX This is wrong but the gallium drivers depend on libpthread
# and some bindings still fail even with the LD_PRELOAD hack when
# starting X.
LDADD+= -lpthread
@


1.1
log
@Initial revision
@
text
@d1 1
a1 1
#	$OpenBSD$
d48 1
a48 1
#LDADD+= -lpthread
@


1.1.1.1
log
@Import swrastg the Gallium3D software rasterizer. It uses the softpipe
driver by default but can also use the llvmpipe driver that use LLVM 
for code generation if available.

Not yet linked to the build as it depends on pthreads and we don't know
yet how to handle the switch from the default 'swrast' driver, but having
it in tree will help testing and debugging the remaining issues.

Tested by ajacoutot@@ and matthieu@@, looks ok to matthieu@@
@
text
@@
