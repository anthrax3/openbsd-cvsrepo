head	1.9;
access;
symbols
	OPENBSD_6_1:1.8.0.2
	OPENBSD_6_1_BASE:1.8
	OPENBSD_6_0:1.7.0.2
	OPENBSD_6_0_BASE:1.7
	OPENBSD_5_9:1.6.0.8
	OPENBSD_5_9_BASE:1.6
	OPENBSD_5_8:1.6.0.6
	OPENBSD_5_8_BASE:1.6
	OPENBSD_5_7:1.6.0.4
	OPENBSD_5_7_BASE:1.6
	OPENBSD_5_6:1.6.0.2
	OPENBSD_5_6_BASE:1.6
	OPENBSD_5_5:1.5.0.4
	OPENBSD_5_5_BASE:1.5
	OPENBSD_5_4:1.5.0.2
	OPENBSD_5_4_BASE:1.5;
locks; strict;
comment	@# @;


1.9
date	2017.06.18.21.09.07;	author espie;	state Exp;
branches;
next	1.8;
commitid	iDRSKHo4Q5nMe1nz;

1.8
date	2016.08.09.18.57.45;	author matthieu;	state Exp;
branches;
next	1.7;
commitid	70exqceQ0fgX8SLO;

1.7
date	2016.03.11.13.09.42;	author okan;	state Exp;
branches;
next	1.6;
commitid	rypizj9eWLMTQq0Q;

1.6
date	2014.05.18.10.33.05;	author matthieu;	state Exp;
branches;
next	1.5;

1.5
date	2013.04.25.06.53.38;	author matthieu;	state Exp;
branches;
next	1.4;

1.4
date	2013.03.17.20.46.47;	author matthieu;	state Exp;
branches;
next	1.3;

1.3
date	2013.03.13.23.56.54;	author matthieu;	state Exp;
branches;
next	1.2;

1.2
date	2013.03.12.06.26.25;	author matthieu;	state Exp;
branches;
next	1.1;

1.1
date	2013.03.09.14.34.46;	author matthieu;	state Exp;
branches;
next	;


desc
@@


1.9
log
@let X directories build even if you forget depend.
- use BUILDFIRST
- have fontconfig use normal 'all' targets to make sure its files are built
- explicitly document the fontconfig lib order

okay matthieu@@
@
text
@#	$OpenBSD: Makefile,v 1.8 2016/08/09 18:57:45 matthieu Exp $

.include <bsd.xconf.mk>

FONTCONFIG=	${.CURDIR}/../../../dist/fontconfig

LIB=	fontconfig

SRCS = \
	fcatomic.c \
	fcblanks.c \
	fccache.c \
	fccfg.c \
	fccharset.c \
	fccompat.c \
	fcdbg.c \
	fcdefault.c \
	fcdir.c \
	fcformat.c \
	fcfreetype.c \
	fcfs.c \
	fcinit.c \
	fclang.c \
	fclist.c \
	fcmatch.c \
	fcmatrix.c \
	fcname.c \
	fcobjs.c \
	fcpat.c \
	fcrange.c \
	fcserialize.c \
	fcstat.c \
	fcstr.c \
	fcweight.c \
	fcxml.c \
	ftglue.c

CFLAGS +=	-DFC_CACHEDIR='"$(FC_CACHEDIR)"' \
		-DFONTCONFIG_PATH='"$(BASECONFIGDIR)"' \
		-I.

LDADD =	-L${X11BASE}/lib -lfreetype -lexpat -lz -lpthread-stubs

PUBLIC_FILES = \
	$(FONTCONFIG)/fontconfig/fontconfig.h \
	$(FONTCONFIG)/src/fcdeprecate.h \
	$(FONTCONFIG)/fontconfig/fcprivate.h

PUBLIC_FT_FILES = \
	$(FONTCONFIG)/fontconfig/fcfreetype.h

fcaliastail.h: fcalias.h

fcalias.h: $(FONTCONFIG)/src/makealias $(PUBLIC_FILES)
	sh $(FONTCONFIG)/src/makealias "$(FONTCONFIG)/src" \
		fcalias.h fcaliastail.h $(PUBLIC_FILES)

fcftaliastail.h: fcftalias.h

fcftalias.h: $(FONTCONFIG)/src/makealias $(PUBLIC_FT_FILES)
	sh $(FONTCONFIG)/src/makealias "$(FONTCONFIG)/src" \
		fcftalias.h fcftaliastail.h $(PUBLIC_FT_FILES)

.if defined(XENOCARA_RERUN_GPERF) && ${XENOCARA_RERUN_GPERF:L=yes}
fcobjshash.h: fcobjshash.gperf
	gperf -m 100 $< > $@@.tmp && \
	mv -f $@@.tmp $@@ || ( $(RM) $@@.tmp && false )
.endif

beforedepend: fcalias.h fcftalias.h fcobjshash.h lib${LIB}.la
BUILDFIRST = fcalias.h fcftalias.h fcobjshash.h lib${LIB}.la

lib${LIB}.la: ${.CURDIR}/lib${LIB}.la.in
	sed -e 's#@@libdir@@#${LIBDIR}#g' \
	     -e 's#@@sharedlibfontconfig@@#libfontconfig.so.${SHLIB_MAJOR}.${SHLIB_MINOR}#g' \
	< $? > $@@

afterinstall:
	${INSTALL_DATA} lib${LIB}.la ${DESTDIR}${LIBDIR}

obj:_xenocara_obj

CLEANFILES = fcalias.h fcaliastail.h fcftalias.h fcftaliastail.h lib${LIB}.la

.PATH: ${FONTCONFIG}/src

.include <bsd.lib.mk>
.include <bsd.xorg.mk>
@


1.8
log
@Update to fontconfig 2.12.1.

Tested by krw@@, dcoppa@@, ok dcoppa@@.
@
text
@d1 1
a1 1
#	$OpenBSD: Makefile,v 1.7 2016/03/11 13:09:42 okan Exp $
d71 1
@


1.7
log
@Remove support vax and XENOCARA_HAVE_SHARED_LIBS scaffolding.

ok matthieu@@
@
text
@d1 1
a1 1
#	$OpenBSD: Makefile,v 1.6 2014/05/18 10:33:05 matthieu Exp $
a21 1
	fchash.c \
d30 1
d34 1
@


1.6
log
@Update to fontconfig 2.11.1. Tested by shadchin@@
@
text
@d1 1
a1 1
#	$OpenBSD: Makefile,v 1.5 2013/04/25 06:53:38 matthieu Exp $
a70 1
.if ${XENOCARA_HAVE_SHARED_LIBS:L} == "yes"
a74 6
.else
lib${LIB}.la: ${.CURDIR}/lib${LIB}.la.in
	sed -e 's#@@libdir@@#${LIBDIR}#g' \
	     -e 's#@@sharedlibfontconfig@@##g' \
	< $? > $@@
.endif
@


1.5
log
@Generate a correct libfontconfig.la on static only architectures.
@
text
@d1 1
a1 1
#	$OpenBSD: Makefile,v 1.4 2013/03/17 20:46:47 matthieu Exp $
d22 1
@


1.4
log
@fix CFLAGS definition
@
text
@d1 3
a3 1
#	$OpenBSD: Makefile,v 1.3 2013/03/13 23:56:54 matthieu Exp $
d70 6
d77 2
a78 3
	@@sed -e 's#@@libdir@@#${LIBDIR}#g' \
	     -e 's#@@major@@#${SHLIB_MAJOR}#g' \
	     -e 's#@@minor@@#${SHLIB_MINOR}#g' \
d80 1
@


1.3
log
@Add back a libtool archive for libfontconfig.

OpenBSD's libtool needs it for libraries with dependencies.
prodded by espie@@
@
text
@d1 1
a1 1
#	$OpenBSD: Makefile,v 1.2 2013/03/12 06:26:25 matthieu Exp $
d34 1
a34 1
CFLAGS =	-DFC_CACHEDIR='"$(FC_CACHEDIR)"' \
@


1.2
log
@Remove existing stale libfontconfig.la at install time.

fontconfig.la was created by the previous build system and references
the bad library revision.

Suggested by espie@@
@
text
@d1 1
a1 1
#	$OpenBSD: Makefile,v 1.1 2013/03/09 14:34:46 matthieu Exp $
d66 1
a66 1
beforedepend: fcalias.h fcftalias.h fcobjshash.h
d68 8
a75 5
beforeinstall:
	@@if [ -f ${DESTDIR}${LIBDIR}/libfontconfig.la ]; then  \
		echo "rm -f ${DESTDIR}${LIBDIR}/libfontconfig.la" ; \
		rm -f ${DESTDIR}${LIBDIR}/libfontconfig.la ; \
	fi
d79 1
a79 1
CLEANFILES = fcalias.h fcaliastail.h fcftalias.h fcftaliastail.h 
@


1.1
log
@Update to fontconfig 2.10.91 + a few local fixes.
Move to a new BSD make based build system since fontconfig's build
system has become too dependant on GNU make.

Requested by ajacoutot@@, tested by many back in january.
@
text
@d1 1
a1 1
#	$OpenBSD$
d67 6
@

