head	1.1;
access;
symbols
	OPENBSD_6_1_BASE:1.1
	OPENBSD_6_0:1.1.0.16
	OPENBSD_6_0_BASE:1.1
	OPENBSD_5_9:1.1.0.14
	OPENBSD_5_9_BASE:1.1
	OPENBSD_5_8:1.1.0.12
	OPENBSD_5_8_BASE:1.1
	OPENBSD_5_7:1.1.0.10
	OPENBSD_5_7_BASE:1.1
	OPENBSD_5_6:1.1.0.8
	OPENBSD_5_6_BASE:1.1
	OPENBSD_5_5:1.1.0.6
	OPENBSD_5_5_BASE:1.1
	OPENBSD_5_4:1.1.0.4
	OPENBSD_5_4_BASE:1.1
	OPENBSD_5_3:1.1.0.2
	OPENBSD_5_3_BASE:1.1;
locks; strict;
comment	@ * @;


1.1
date	2012.08.17.16.15.20;	author matthieu;	state Exp;
branches;
next	;


desc
@@


1.1
log
@Update to pixman 0.26.2. tested at least by ajacoutot@@, mpi@@, shadchin@@.
@
text
@#include <stdio.h>
#include <stdlib.h>
#include "pixman.h"
#include "gtk-utils.h"

int
main (int argc, char **argv)
{
#define WIDTH 400
#define HEIGHT 400
#define TILE_SIZE 25

    pixman_image_t *checkerboard;
    pixman_image_t *destination;
#define D2F(d) (pixman_double_to_fixed(d))
    pixman_transform_t trans = { {
	    { D2F (-1.96830), D2F (-1.82250), D2F (512.12250)},
	    { D2F (0.00000), D2F (-7.29000), D2F (1458.00000)},
	    { D2F (0.00000), D2F (-0.00911), D2F (0.59231)},
	}};
    int i, j;

    checkerboard = pixman_image_create_bits (PIXMAN_a8r8g8b8,
					     WIDTH, HEIGHT,
					     NULL, 0);

    destination = pixman_image_create_bits (PIXMAN_a8r8g8b8,
					    WIDTH, HEIGHT,
					    NULL, 0);

    for (i = 0; i < HEIGHT / TILE_SIZE; ++i)
    {
	for (j = 0; j < WIDTH / TILE_SIZE; ++j)
	{
	    double u = (double)(j + 1) / (WIDTH / TILE_SIZE);
	    double v = (double)(i + 1) / (HEIGHT / TILE_SIZE);
	    pixman_color_t black = { 0, 0, 0, 0xffff };
	    pixman_color_t white = {
		v * 0xffff,
		u * 0xffff,
		(1 - (double)u) * 0xffff,
		0xffff };
	    pixman_color_t *c;
	    pixman_image_t *fill;

	    if ((j & 1) != (i & 1))
		c = &black;
	    else
		c = &white;

	    fill = pixman_image_create_solid_fill (c);

	    pixman_image_composite (PIXMAN_OP_SRC, fill, NULL, checkerboard,
				    0, 0, 0, 0, j * TILE_SIZE, i * TILE_SIZE,
				    TILE_SIZE, TILE_SIZE);
	}
    }

    pixman_image_set_transform (checkerboard, &trans);
    pixman_image_set_filter (checkerboard, PIXMAN_FILTER_BEST, NULL, 0);
    pixman_image_set_repeat (checkerboard, PIXMAN_REPEAT_NONE);

    pixman_image_composite (PIXMAN_OP_SRC,
			    checkerboard, NULL, destination,
			    0, 0, 0, 0, 0, 0,
			    WIDTH, HEIGHT);

    show_image (destination);

    return 0;
}
@
