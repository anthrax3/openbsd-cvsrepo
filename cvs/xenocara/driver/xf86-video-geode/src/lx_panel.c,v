head	1.6;
access;
symbols
	OPENBSD_6_1_BASE:1.6
	OPENBSD_6_0:1.6.0.16
	OPENBSD_6_0_BASE:1.6
	OPENBSD_5_9:1.6.0.14
	OPENBSD_5_9_BASE:1.6
	OPENBSD_5_8:1.6.0.12
	OPENBSD_5_8_BASE:1.6
	OPENBSD_5_7:1.6.0.10
	OPENBSD_5_7_BASE:1.6
	OPENBSD_5_6:1.6.0.8
	OPENBSD_5_6_BASE:1.6
	OPENBSD_5_5:1.6.0.6
	OPENBSD_5_5_BASE:1.6
	OPENBSD_5_4:1.6.0.4
	OPENBSD_5_4_BASE:1.6
	OPENBSD_5_3:1.6.0.2
	OPENBSD_5_3_BASE:1.6
	OPENBSD_5_2:1.5.0.4
	OPENBSD_5_2_BASE:1.5
	OPENBSD_5_1_BASE:1.5
	OPENBSD_5_1:1.5.0.2
	OPENBSD_5_0:1.4.0.4
	OPENBSD_5_0_BASE:1.4
	OPENBSD_4_9:1.4.0.2
	OPENBSD_4_9_BASE:1.4
	OPENBSD_4_8:1.2.0.4
	OPENBSD_4_8_BASE:1.2
	OPENBSD_4_7:1.1.0.2
	OPENBSD_4_7_BASE:1.1;
locks; strict;
comment	@ * @;


1.6
date	2012.12.16.23.04.18;	author matthieu;	state Exp;
branches;
next	1.5;

1.5
date	2011.09.13.20.25.35;	author matthieu;	state Exp;
branches;
next	1.4;

1.4
date	2010.12.07.21.54.11;	author matthieu;	state Exp;
branches;
next	1.3;

1.3
date	2010.11.05.12.30.03;	author matthieu;	state Exp;
branches;
next	1.2;

1.2
date	2010.05.08.16.26.20;	author matthieu;	state Exp;
branches;
next	1.1;

1.1
date	2009.10.11.09.30.15;	author matthieu;	state Exp;
branches;
next	;


desc
@@


1.6
log
@Update to xf86-video-geode 2.11.14
@
text
@/* Copyright (c) 2008 Advanced Micro Devices, Inc.
 *
 * Permission is hereby granted, free of charge, to any person obtaining a copy
 * of this software and associated documentation files (the "Software"), to
 * deal in the Software without restriction, including without limitation the
 * rights to use, copy, modify, merge, publish, distribute, sublicense, and/or
 * sell copies of the Software, and to permit persons to whom the Software is
 * furnished to do so, subject to the following conditions:
 *
 * The above copyright notice and this permission notice shall be included in
 * all copies or substantial portions of the Software.
 *
 * THE SOFTWARE IS PROVIDED "AS IS", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR
 * IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,
 * FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE
 * AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER
 * LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING
 * FROM, OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS
 * IN THE SOFTWARE.
 *
 * Neither the name of the Advanced Micro Devices, Inc. nor the names of its
 * contributors may be used to endorse or promote products derived from this
 * software without specific prior written permission.
 */

/* Reference: Video Graphics Suite Specification:
 * VG Config Register (0x00) page 16
 * VG FP Register (0x02) page 18
 */

#ifdef HAVE_CONFIG_H
#include "config.h"
#endif

#include <stdio.h>

#include "xf86.h"
#include "compiler.h"
#include "xf86Modes.h"
#include "geode.h"

#define LX_READ_VG(reg) \
                (outw(0xAC1C,0xFC53), outw(0xAC1C,0x0200|(reg)), inw(0xAC1E))

/* This is borrowed from xerver/hw/xfree86/modes */

#define MODEPREFIX NULL, NULL, NULL, 0, M_T_DRIVER
#define MODESUFFIX 0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,FALSE,FALSE,0,NULL,0,0.0,0.0

DisplayModeRec lx_panel_modes[] = {
    {MODEPREFIX, 31200, 320, 354, 384, 400, 0, 240, 249, 253, 260, 0,
     V_NHSYNC | V_NVSYNC, MODESUFFIX}
    ,                           /* 320x200@@75 */
    {MODEPREFIX, 25175, 640, 656, 744, 800, 0, 480, 490, 492, 525, 0,
     V_NHSYNC | V_NVSYNC, MODESUFFIX}
    ,                           /* 640x480@@60 */
    {MODEPREFIX, 40000, 800, 840, 968, 1056, 0, 600, 601, 605, 628, 0,
     V_NHSYNC | V_NVSYNC, MODESUFFIX}
    ,                           /* 880x600@@60 */
    {MODEPREFIX, 65000, 1024, 1048, 1184, 1344, 0, 768, 771, 777, 806, 0,
     V_NHSYNC | V_NVSYNC, MODESUFFIX}
    ,                           /* 1024x768@@60 */
    {MODEPREFIX, 81600, 1152, 1216, 1336, 1520, 0, 864, 865, 868, 895, 0,
     V_NHSYNC | V_NVSYNC, MODESUFFIX}
    ,                           /* 1152x864@@60 */
    {MODEPREFIX, 108000, 1280, 1328, 1440, 1688, 0, 1024, 1025, 1028, 1066, 0,
     V_NHSYNC | V_NVSYNC, MODESUFFIX}
    ,                           /* 1280x1024@@60 */
    {MODEPREFIX, 162000, 1600, 1664, 1856, 2160, 0, 1200, 1201, 1204, 1250, 0,
     V_NHSYNC | V_NVSYNC, MODESUFFIX}
    ,                           /* 1600x1200@@60 */
    {MODEPREFIX, 48960, 1024, 1064, 1168, 1312, 0, 600, 601, 604, 622, 0,
     V_NHSYNC | V_NVSYNC, MODESUFFIX}
    ,                           /* 1024x600@@60 wide panels */
};

/* Get the legacy panel size from VSA, and return the associated mode rec */

DisplayModePtr
LXGetLegacyPanelMode(ScrnInfoPtr pScrni)
{
    unsigned short reg = LX_READ_VG(0x00);
    unsigned char ret = (reg >> 8) & 0x07;

    if ((ret == 1 || ret == 5)) {

        reg = LX_READ_VG(0x02);
        ret = (reg >> 3) & 0x07;

        /* FIXME: 7 is reserved in default. We use this value to support
         * wide screen resolution 1024x600@@80 now for panel. If you want to use
         * that resolution, please assign ret to 7 manually here:
         * "reg = 7"
         * The user can use this entry for other wide screen resolutions.
         */

        if (ret < 8) {
            xf86DrvMsg(pScrni->scrnIndex, X_INFO,
                       " VSA Panel Mode is: %dx%d, pixel clock freq(kHz) is %d\n",
                       lx_panel_modes[ret].HDisplay,
                       lx_panel_modes[ret].VDisplay, lx_panel_modes[ret].Clock);
            return &lx_panel_modes[ret];
        }

    }

    return NULL;
}

/* Construct a moderec from the specified panel mode */

DisplayModePtr
LXGetManualPanelMode(char *modestr)
{
    int clock;
    int hactive, hsstart, hsend, htotal;
    int vactive, vsstart, vsend, vtotal;
    DisplayModePtr mode;
    char sname[32];

    int ret = sscanf(modestr, "%d %d %d %d %d %d %d %d %d",
                     &clock,
                     &hactive, &hsstart, &hsend, &htotal,
                     &vactive, &vsstart, &vsend, &vtotal);

    if (ret != 9)
        return NULL;

    mode = xnfcalloc(1, sizeof(DisplayModeRec));

    if (mode == NULL)
        return NULL;

    sprintf(sname, "%dx%d", hactive, vactive);

    mode->name = xnfalloc(strlen(sname) + 1);
    strcpy(mode->name, sname);

    mode->type = M_T_DRIVER | M_T_PREFERRED;
    mode->Clock = clock;
    mode->HDisplay = hactive;
    mode->HSyncStart = hsstart;
    mode->HSyncEnd = hsend;
    mode->HTotal = htotal;
    mode->VDisplay = vactive;
    mode->VSyncStart = vsstart;
    mode->VSyncEnd = vsend;
    mode->VTotal = vtotal;

    mode->prev = mode->next = NULL;

    return mode;
}
@


1.5
log
@Update to xf86-video-geode 2.11.12. Tested on Alix 3C3.
@
text
@d52 2
a53 2
	V_NHSYNC | V_NVSYNC, MODESUFFIX}
    ,				       /* 320x200@@75 */
d55 2
a56 2
	V_NHSYNC | V_NVSYNC, MODESUFFIX}
    ,				       /* 640x480@@60 */
d58 2
a59 2
	V_NHSYNC | V_NVSYNC, MODESUFFIX}
    ,				       /* 880x600@@60 */
d61 2
a62 2
	V_NHSYNC | V_NVSYNC, MODESUFFIX}
    ,				       /* 1024x768@@60 */
d64 2
a65 2
	V_NHSYNC | V_NVSYNC, MODESUFFIX}
    ,				       /* 1152x864@@60 */
d67 2
a68 2
	V_NHSYNC | V_NVSYNC, MODESUFFIX}
    ,				       /* 1280x1024@@60 */
d70 2
a71 2
	V_NHSYNC | V_NVSYNC, MODESUFFIX}
    ,				       /* 1600x1200@@60 */
d73 2
a74 2
        V_NHSYNC | V_NVSYNC, MODESUFFIX}
    ,				       /* 1024x600@@60 wide panels */
d84 1
d87 2
a88 2
	reg = LX_READ_VG(0x02);
	ret = (reg >> 3) & 0x07;
d90 14
a103 14
	/* FIXME: 7 is reserved in default. We use this value to support
 	 * wide screen resolution 1024x600@@80 now for panel. If you want to use
 	 * that resolution, please assign ret to 7 manually here:
 	 * "reg = 7"
 	 * The user can use this entry for other wide screen resolutions.
	 */

	if (ret < 8) {
	    xf86DrvMsg(pScrni->scrnIndex, X_INFO,
		" VSA Panel Mode is: %dx%d, pixel clock freq(kHz) is %d\n",
		lx_panel_modes[ret].HDisplay, lx_panel_modes[ret].VDisplay,
		lx_panel_modes[ret].Clock);
	    return &lx_panel_modes[ret];
	}
d122 3
a124 3
	&clock,
	&hactive, &hsstart, &hsend, &htotal,
	&vactive, &vsstart, &vsend, &vtotal);
d127 1
a127 1
	return NULL;
d132 1
a132 1
	return NULL;
@


1.4
log
@Update to xf86-video-geode 2.11.10. Tested on Alix 3C3.
@
text
@d72 3
a74 3
    {MODEPREFIX, 67630, 1024, 1080, 1184, 1344, 0, 600, 601, 604, 629, 0,
	V_NHSYNC | V_NVSYNC, MODESUFFIX}
    ,				       /* 1024x600@@80 */
d80 1
a80 1
LXGetLegacyPanelMode(void)
a83 1

d96 5
a100 1
	if (ret < 8)
d102 1
@


1.3
log
@Update to xf86-video-geode 2.11.9.
A bunch of bug fixes and performance improvements. Tested on Alix 3c3.
@
text
@d66 1
a66 1
    {MODEPREFIX, 108000, 1028, 1328, 1440, 1688, 0, 1024, 1025, 1028, 1066, 0,
d72 3
d90 5
a94 3
	/* 7 is a "reserved" value - if we get it, we can only
	 * assume that a panel doesn't exist (or it hasn't been
	 * configured in the BIOS)
d97 1
a97 1
	if (ret < 7)
@


1.2
log
@Update to xf86-video-geode 2.11.8. Tested on Alix 3c3.
@
text
@d127 1
@


1.1
log
@update to xf86-video-geode 2.11.6. Tested on a Alix 3C3.
@
text
@d71 1
a71 1
    ,				       /* 1600x100@@60 */
@

