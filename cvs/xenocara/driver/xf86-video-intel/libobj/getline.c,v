head	1.1;
access;
symbols
	OPENBSD_6_2:1.1.0.10
	OPENBSD_6_2_BASE:1.1
	OPENBSD_6_1:1.1.0.8
	OPENBSD_6_1_BASE:1.1
	OPENBSD_6_0:1.1.0.6
	OPENBSD_6_0_BASE:1.1
	OPENBSD_5_9:1.1.0.4
	OPENBSD_5_9_BASE:1.1
	OPENBSD_5_8:1.1.0.2
	OPENBSD_5_8_BASE:1.1;
locks; strict;
comment	@ * @;


1.1
date	2015.04.12.19.42.00;	author matthieu;	state Exp;
branches;
next	;
commitid	DK857Z2Au1JEohAk;


desc
@@


1.1
log
@Update to xf86-video-intel 2.99.916
Fixes a display bug seenby ajacoutot@@, ok jsg@@ and kettenis@@.
newer X.Org (2.99.917 or master) version cause corruption on older
machines (X40, i965), probably caused by a bug in our kernel,
under investigation by kettenis@@.
@
text
@#include <stdio.h>
#include <stdlib.h>
#include <errno.h>

extern int getline(char **line, size_t *len, FILE *file);

int getline(char **line, size_t *len, FILE *file)
{
	char *ptr, *end;
	int c;

	if (*line == NULL) {
		errno = EINVAL;
		if (*len == 0)
			*line = malloc(4096);
		if (*line == NULL)
			return -1;

		*len = 4096;
	}

	ptr = *line;
	end = *line + *len;

	while ((c = fgetc(file)) != EOF) {
		if (ptr + 1 >= end) {
			char *newline;
			int offset;

			newline = realloc(*line, *len + 4096);
			if (newline == NULL)
				return -1;

			offset = ptr - *line;

			*line = newline;
			*len += 4096;

			ptr = *line + offset;
			end = *line + *len;
		}

		*ptr++ = c;
		if (c == '\n') {
			*ptr = '\0';
			return ptr - *line;
		}
	}
	*ptr = '\0';
	return -1;
}
@
