head	1.1;
access;
symbols
	OPENBSD_6_2:1.1.0.18
	OPENBSD_6_2_BASE:1.1
	OPENBSD_6_1:1.1.0.16
	OPENBSD_6_1_BASE:1.1
	OPENBSD_6_0:1.1.0.14
	OPENBSD_6_0_BASE:1.1
	OPENBSD_5_9:1.1.0.12
	OPENBSD_5_9_BASE:1.1
	OPENBSD_5_8:1.1.0.10
	OPENBSD_5_8_BASE:1.1
	OPENBSD_5_7:1.1.0.8
	OPENBSD_5_7_BASE:1.1
	OPENBSD_5_6:1.1.0.6
	OPENBSD_5_6_BASE:1.1
	OPENBSD_5_5:1.1.0.4
	OPENBSD_5_5_BASE:1.1
	OPENBSD_5_4:1.1.0.2
	OPENBSD_5_4_BASE:1.1;
locks; strict;
comment	@ * @;


1.1
date	2013.03.18.18.38.21;	author matthieu;	state Exp;
branches;
next	;


desc
@@


1.1
log
@Update to xf86-video-intel 2.20.19.

A recent kernel with kernel modesetting support is required.
Thanks to jsg@@ and kettenis@@ for their work.
@
text
@#include "brw.h"

bool brw_sf_kernel__nomask(struct brw_compile *p)
{
	struct brw_reg inv, v0, v1, v2, delta;

	v0 = brw_vec4_grf(3, 0);
	v1 = brw_vec4_grf(4, 0);
	v2 = brw_vec4_grf(5, 0);
	delta = brw_vec8_grf(7, 0);

	inv = brw_vec4_grf(6, 0);
	brw_math_invert(p, inv, brw_vec4_grf(1, 11));

	brw_MOV(p, brw_message_reg(3), v0);

	brw_ADD(p, delta, v1, brw_negate(v2));
	brw_MUL(p, brw_message_reg(1), delta, brw_vec1_grf(6,0));

	brw_ADD(p, delta, v2, brw_negate(v0));
	brw_MUL(p, brw_message_reg(2), delta, brw_vec1_grf(6,2));

	brw_urb_WRITE(p, brw_null_reg(), 0, brw_vec8_grf(0 ,0),
		      false, true, 4, 0, true, true, 0,
		      BRW_URB_SWIZZLE_TRANSPOSE);

	return true;
}

bool brw_sf_kernel__mask(struct brw_compile *p)
{
	struct brw_reg inv, v0, v1, v2;

	v0 = brw_vec8_grf(3, 0);
	v1 = brw_vec8_grf(4, 0);
	v2 = brw_vec8_grf(5, 0);

	inv = brw_vec4_grf(6, 0);
	brw_math_invert(p, inv, brw_vec4_grf(1, 11));

	brw_MOV(p, brw_message_reg(3), v0);

	brw_ADD(p, brw_vec8_grf(7, 0), v1, brw_negate(v2));
	brw_MUL(p, brw_message_reg(1), brw_vec8_grf(7, 0), brw_vec1_grf(6,0));

	brw_ADD(p, brw_vec8_grf(7, 0), v2, brw_negate(v0));
	brw_MUL(p, brw_message_reg(2), brw_vec8_grf(7, 0), brw_vec1_grf(6,2));

	brw_urb_WRITE(p, brw_null_reg(), 0, brw_vec8_grf(0 ,0),
		      false, true, 4, 0, true, true, 0,
		      BRW_URB_SWIZZLE_TRANSPOSE);

	return true;
}
@
