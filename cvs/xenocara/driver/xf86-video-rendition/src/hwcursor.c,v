head	1.3;
access;
symbols
	OPENBSD_6_1_BASE:1.3
	OPENBSD_6_0:1.3.0.16
	OPENBSD_6_0_BASE:1.3
	OPENBSD_5_9:1.3.0.14
	OPENBSD_5_9_BASE:1.3
	OPENBSD_5_8:1.3.0.12
	OPENBSD_5_8_BASE:1.3
	OPENBSD_5_7:1.3.0.10
	OPENBSD_5_7_BASE:1.3
	OPENBSD_5_6:1.3.0.8
	OPENBSD_5_6_BASE:1.3
	OPENBSD_5_5:1.3.0.6
	OPENBSD_5_5_BASE:1.3
	OPENBSD_5_4:1.3.0.4
	OPENBSD_5_4_BASE:1.3
	OPENBSD_5_3:1.3.0.2
	OPENBSD_5_3_BASE:1.3
	OPENBSD_5_2:1.2.0.16
	OPENBSD_5_2_BASE:1.2
	OPENBSD_5_1_BASE:1.2
	OPENBSD_5_1:1.2.0.14
	OPENBSD_5_0:1.2.0.12
	OPENBSD_5_0_BASE:1.2
	OPENBSD_4_9:1.2.0.8
	OPENBSD_4_9_BASE:1.2
	OPENBSD_4_8:1.2.0.10
	OPENBSD_4_8_BASE:1.2
	OPENBSD_4_7:1.2.0.6
	OPENBSD_4_7_BASE:1.2
	OPENBSD_4_6:1.2.0.4
	OPENBSD_4_6_BASE:1.2
	OPENBSD_4_5:1.2.0.2
	OPENBSD_4_5_BASE:1.2
	OPENBSD_4_4:1.1.1.1.0.6
	OPENBSD_4_4_BASE:1.1.1.1
	OPENBSD_4_3_BASE:1.1.1.1
	OPENBSD_4_3:1.1.1.1.0.4
	OPENBSD_4_2:1.1.1.1.0.2
	OPENBSD_4_2_BASE:1.1.1.1
	v4_1_3:1.1.1.1
	v4_1_2:1.1.1.1
	xorg:1.1.1;
locks; strict;
comment	@ * @;


1.3
date	2012.08.11.09.44.22;	author matthieu;	state Exp;
branches;
next	1.2;

1.2
date	2008.10.12.21.05.42;	author matthieu;	state Exp;
branches;
next	1.1;

1.1
date	2006.11.26.20.10.24;	author matthieu;	state Exp;
branches
	1.1.1.1;
next	;

1.1.1.1
date	2006.11.26.20.10.24;	author matthieu;	state Exp;
branches;
next	;


desc
@@


1.3
log
@Update to xf86-video-rendition 4.2.5
@
text
@/*
 * includes
 */

#ifdef HAVE_CONFIG_H
#include "config.h"
#endif

#include "rendition.h"
#include "vtypes.h"
#include "vramdac.h"

#include "hwcursor.h"

/*
 * defines 
 */

#undef DEBUG

/* use a 64x64 cursor, 32x32 otherwise    */
/* note that V2K supports only 64x64 size */
#define BIGCURSOR 1

/*
 * local function prototypes
 */

static Bool RENDITIONUseHWCursor(ScreenPtr pScreen, CursorPtr pCurs);
static void RENDITIONSetCursorColors(ScrnInfoPtr pScreenInfo, int bg, int fg);
static void RENDITIONSetCursorPosition(ScrnInfoPtr pScreenInfo, int x, int y);
static void RENDITIONHideCursor(ScrnInfoPtr pScreenInfo);
static void RENDITIONShowCursor(ScrnInfoPtr pScreenInfo);
static void RENDITIONLoadCursorImage(ScrnInfoPtr pScreenInfo, unsigned char* src);


/*
 * This is top-level initialization funtion
 */
void
RenditionHWCursorPreInit (ScrnInfoPtr pScreenInfo)
{
    renditionPtr pRendition = RENDITIONPTR(pScreenInfo);

#ifdef DEBUG
    ErrorF ("Rendition: Debug RenditionHWCursorPreInit called\n");
#endif

    pRendition->board.hwcursor_used = TRUE;
    if (pRendition->board.chip==V1000_DEVICE){
      /* V1K uses special space on BT-485 RAMDAC */
      pRendition->board.hwcursor_vmemsize = 0;
      pRendition->board.hwcursor_membase = 0 ; /* Not used on V1K */
    }
    else{
      pRendition->board.hwcursor_vmemsize = 64*64*2/8 /* 1024 bytes used */;
      pRendition->board.hwcursor_membase = (pRendition->board.fbOffset >> 10);
      /* Last but not least, update offset-adress */
      pRendition->board.fbOffset += pRendition->board.hwcursor_vmemsize;
    }
}

void
RenditionHWCursorRelease (ScrnInfoPtr pScreenInfo)
{
    renditionPtr pRendition = RENDITIONPTR(pScreenInfo);

#ifdef DEBUG
    ErrorF ("Rendition: Debug RenditionHWCursorRelease called\n");
#endif

    xf86DestroyCursorInfoRec(pRendition->CursorInfoRec);
    pRendition->CursorInfoRec=NULL;
}


Bool
RenditionHWCursorInit(ScreenPtr pScreen)
{
    ScrnInfoPtr  pScreenInfo = xf86ScreenToScrn(pScreen);
    renditionPtr pRendition = RENDITIONPTR(pScreenInfo);
    xf86CursorInfoPtr infoPtr;

#ifdef DEBUG
    ErrorF ("Rendition: Debug RenditionHWCursorInit called\n");
#endif

    infoPtr = xf86CreateCursorInfoRec();
    if(!infoPtr) return FALSE;

    pRendition->CursorInfoRec = infoPtr;

#ifdef BIGCURSOR
    infoPtr->MaxWidth=64;
    infoPtr->MaxHeight=64;
#else
    infoPtr->MaxWidth=32;
    infoPtr->MaxHeight=32;
#endif

    infoPtr->Flags = HARDWARE_CURSOR_BIT_ORDER_MSBFIRST  |
	HARDWARE_CURSOR_TRUECOLOR_AT_8BPP   | 
	HARDWARE_CURSOR_AND_SOURCE_WITH_MASK|
	HARDWARE_CURSOR_SOURCE_MASK_INTERLEAVE_8;


    infoPtr->SetCursorColors      = RENDITIONSetCursorColors;
    infoPtr->SetCursorPosition    = RENDITIONSetCursorPosition;
    infoPtr->LoadCursorImage      = RENDITIONLoadCursorImage;
    infoPtr->HideCursor           = RENDITIONHideCursor;
    infoPtr->ShowCursor           = RENDITIONShowCursor;
    infoPtr->UseHWCursor          = RENDITIONUseHWCursor;

    return xf86InitCursor(pScreen, infoPtr);
}


/*
 * local functions
 */

static Bool
RENDITIONUseHWCursor(ScreenPtr pScreen, CursorPtr pCurs)
{
#ifdef DEBUG
    ErrorF ("Rendition: Debug RENDITIONUseHWCursor called\n");
#endif

  /* have this return false for DoubleScan and Interlaced ? */
    return TRUE;
}


static void
RENDITIONShowCursor(ScrnInfoPtr pScreenInfo)
{
  /* renditionPtr pRendition = RENDITIONPTR(pScreenInfo); */

#ifdef DEBUG
    ErrorF( "RENDITION: ShowCursor called\n");
#endif

    /* enable cursor - X11 mode */
    verite_enablecursor(pScreenInfo, VERITE_3COLORS,
#ifdef BIGCURSOR
        VERITE_CURSOR64
#else 
        VERITE_CURSOR32
#endif
        );
}



static void
RENDITIONHideCursor(ScrnInfoPtr pScreenInfo)
{
#ifdef DEBUG
    ErrorF( "RENDITION: HideCursor called\n");
#endif

    /* Disable cursor */
    verite_enablecursor(pScreenInfo, VERITE_NOCURSOR, 0);
}



static void
RENDITIONSetCursorPosition(ScrnInfoPtr pScreenInfo, int x, int y)
{
#ifdef DEBUG
    ErrorF( "RENDITION: SetCursorPosition(%d, %d) called\n", x, y);
#endif

    verite_movecursor(pScreenInfo, x, y, 1 /* xorigin */, 1 /* yorigin */);
}



static void
RENDITIONSetCursorColors(ScrnInfoPtr pScreenInfo, int bg, int fg)
{
#ifdef DEBUG
    ErrorF( "RENDITION: SetCursorColors(%x, %x) called\n", fg, bg);
#endif

    verite_setcursorcolor(pScreenInfo, bg, fg);
}



static void
RENDITIONLoadCursorImage(ScrnInfoPtr pScreenInfo, unsigned char* src)
{
#ifdef DEBUG
    ErrorF( "RENDITION: loadcursor called\n");
#endif
    verite_loadcursor(pScreenInfo,
#ifdef BIGCURSOR
        VERITE_CURSOR64, 
#else
        VERITE_CURSOR32, 
#endif
        (vu8 *)src);
}


/*
 * end of file hwcursor.c
 */
@


1.2
log
@xf86-video-rendision 4.2.0
@
text
@d78 1
a78 1
RenditionHWCursorInit(int scrnIndex, ScreenPtr pScreen)
d80 1
a80 1
    ScrnInfoPtr  pScreenInfo = xf86Screens[scrnIndex];
@


1.1
log
@Initial revision
@
text
@a0 1
/* $XFree86: xc/programs/Xserver/hw/xfree86/drivers/rendition/hwcursor.c,v 1.6 2000/02/25 21:03:00 dawes Exp $ */
@


1.1.1.1
log
@Importing xf86-video-rendition 4.1.2
@
text
@@
