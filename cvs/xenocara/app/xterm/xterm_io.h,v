head	1.8;
access;
symbols
	OPENBSD_6_1:1.7.0.10
	OPENBSD_6_1_BASE:1.7
	OPENBSD_6_0:1.7.0.8
	OPENBSD_6_0_BASE:1.7
	OPENBSD_5_9:1.7.0.6
	OPENBSD_5_9_BASE:1.7
	OPENBSD_5_8:1.7.0.4
	OPENBSD_5_8_BASE:1.7
	OPENBSD_5_7:1.7.0.2
	OPENBSD_5_7_BASE:1.7
	OPENBSD_5_6:1.6.0.6
	OPENBSD_5_6_BASE:1.6
	OPENBSD_5_5:1.6.0.4
	OPENBSD_5_5_BASE:1.6
	OPENBSD_5_4:1.6.0.2
	OPENBSD_5_4_BASE:1.6
	OPENBSD_5_3:1.5.0.4
	OPENBSD_5_3_BASE:1.5
	OPENBSD_5_2:1.5.0.2
	OPENBSD_5_2_BASE:1.5
	OPENBSD_5_1_BASE:1.3
	OPENBSD_5_1:1.3.0.2
	OPENBSD_5_0:1.2.0.4
	OPENBSD_5_0_BASE:1.2
	OPENBSD_4_9:1.2.0.2
	OPENBSD_4_9_BASE:1.2
	OPENBSD_4_8:1.1.1.1.0.16
	OPENBSD_4_8_BASE:1.1.1.1
	OPENBSD_4_7:1.1.1.1.0.12
	OPENBSD_4_7_BASE:1.1.1.1
	OPENBSD_4_6:1.1.1.1.0.10
	OPENBSD_4_6_BASE:1.1.1.1
	OPENBSD_4_5:1.1.1.1.0.8
	OPENBSD_4_5_BASE:1.1.1.1
	OPENBSD_4_4:1.1.1.1.0.6
	OPENBSD_4_4_BASE:1.1.1.1
	OPENBSD_4_3_BASE:1.1.1.1
	OPENBSD_4_3:1.1.1.1.0.4
	v232:1.1.1.1
	v229:1.1.1.1
	OPENBSD_4_2:1.1.1.1.0.2
	OPENBSD_4_2_BASE:1.1.1.1
	v225:1.1.1.1
	v216:1.1.1.1
	xterm:1.1.1;
locks; strict;
comment	@ * @;


1.8
date	2017.07.15.19.20.51;	author matthieu;	state Exp;
branches;
next	1.7;
commitid	b9xPQ49d1NNt4zlu;

1.7
date	2014.10.05.16.39.19;	author matthieu;	state Exp;
branches;
next	1.6;
commitid	0wVJ6bWh03LWbUdn;

1.6
date	2013.03.09.14.45.39;	author matthieu;	state Exp;
branches;
next	1.5;

1.5
date	2012.06.07.20.20.24;	author matthieu;	state Exp;
branches;
next	1.4;

1.4
date	2012.04.14.09.02.46;	author matthieu;	state Exp;
branches;
next	1.3;

1.3
date	2011.08.18.19.47.43;	author matthieu;	state Exp;
branches;
next	1.2;

1.2
date	2010.08.22.13.38.11;	author matthieu;	state Exp;
branches;
next	1.1;

1.1
date	2006.11.26.11.11.52;	author matthieu;	state Exp;
branches
	1.1.1.1;
next	;

1.1.1.1
date	2006.11.26.11.11.52;	author matthieu;	state Exp;
branches;
next	;


desc
@@


1.8
log
@Update to xterm 330
@
text
@/* $XTermId: xterm_io.h,v 1.64 2017/05/18 21:15:14 tom Exp $ */

/*
 * Copyright 2000-2014,2017 by Thomas E. Dickey
 *
 *                         All Rights Reserved
 *
 * Permission is hereby granted, free of charge, to any person obtaining a
 * copy of this software and associated documentation files (the
 * "Software"), to deal in the Software without restriction, including
 * without limitation the rights to use, copy, modify, merge, publish,
 * distribute, sublicense, and/or sell copies of the Software, and to
 * permit persons to whom the Software is furnished to do so, subject to
 * the following conditions:
 *
 * The above copyright notice and this permission notice shall be included
 * in all copies or substantial portions of the Software.
 *
 * THE SOFTWARE IS PROVIDED "AS IS", WITHOUT WARRANTY OF ANY KIND, EXPRESS
 * OR IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF
 * MERCHANTABILITY, FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT.
 * IN NO EVENT SHALL THE ABOVE LISTED COPYRIGHT HOLDER(S) BE LIABLE FOR ANY
 * CLAIM, DAMAGES OR OTHER LIABILITY, WHETHER IN AN ACTION OF CONTRACT,
 * TORT OR OTHERWISE, ARISING FROM, OUT OF OR IN CONNECTION WITH THE
 * SOFTWARE OR THE USE OR OTHER DEALINGS IN THE SOFTWARE.
 *
 * Except as contained in this notice, the name(s) of the above copyright
 * holders shall not be used in advertising or otherwise to promote the
 * sale, use or other dealings in this Software without prior written
 * authorization.
 */

#ifndef	included_xterm_io_h
#define	included_xterm_io_h

#include <xterm.h>

/*
 * System-specific definitions (keep these chunks one-per-system!).
 *
 * FIXME:  some, such as those defining USE_TERMIOS should be moved to xterm.h
 * as they are integrated with the configure script.
 */
#if defined(__minix)
#define USE_POSIX_TERMIOS 1
#undef HAVE_POSIX_OPENPT	/* present, does not work */
#endif

#ifdef CSRG_BASED
#define USE_TERMIOS
#endif

#ifdef __CYGWIN__
#define ATT
#define SVR4
#define SYSV
#define USE_SYSV_TERMIO
#endif

#if defined(__DragonFly__) || defined(__FreeBSD__) || defined(__NetBSD__) || defined(__OpenBSD__) || defined(__INTERIX) || defined(__APPLE__) || defined(__UNIXWARE__) || defined(__hpux)
#ifndef USE_POSIX_TERMIOS
#define USE_POSIX_TERMIOS
#endif
#endif

#if defined(AIXV4)
#define USE_POSIX_TERMIOS
#ifndef SYSV
#define SYSV
#endif
#endif

#ifdef linux
#define USE_TERMIOS
#endif

#ifdef __SCO__
#define USE_TERMIOS
#ifndef _SVID3
#define _SVID3
#endif
#endif

#ifdef Lynx
#define USE_SYSV_TERMIO
#endif

#ifdef macII
#undef SYSV			/* pretend to be bsd (sgtty.h) */
#endif /* macII */

#if defined(__GLIBC__) && !defined(linux)
#define USE_POSIX_TERMIOS	/* GNU/Hurd, GNU/KFreeBSD and GNU/KNetBSD */
#endif

#ifdef __MVS__
#define SVR4
#define USE_POSIX_TERMIOS
#endif

#ifdef __QNX__
#define USE_POSIX_TERMIOS
#endif

#if defined(__osf__)
#define USE_POSIX_TERMIOS
#undef SYSV
#endif

/*
 * Indirect system dependencies
 */
#if defined(SVR4) && !defined(__sgi)
#define USE_TERMIOS
#endif

#ifdef SYSV
#define USE_SYSV_TERMIO
#endif

#if defined(USE_POSIX_TERMIOS) && !defined(USE_TERMIOS)
#define USE_TERMIOS
#endif

/*
 * Low-level ioctl, where it is needed or non-conflicting with termio/etc.
 */
#ifdef __QNX__
#include <ioctl.h>
#else
#include <sys/ioctl.h>
#endif

/*
 * Terminal I/O includes (termio, termios, sgtty headers).
 */
#if defined(USE_POSIX_TERMIOS) && !defined(__hpux)
#include <termios.h>
#elif defined(USE_TERMIOS)
#include <termios.h>
/* this hacked termios support only works on SYSV */
#define USE_ANY_SYSV_TERMIO
#define termio termios
#ifndef __CYGWIN__
#undef  TCGETA
#define TCGETA TCGETS
#undef  TCSETA
#define TCSETA TCSETS
#undef  TCSETAW
#define TCSETAW TCSETSW
#endif
#elif defined(USE_SYSV_TERMIO)
# define USE_ANY_SYSV_TERMIO
# ifdef Lynx
#  include <termio.h>
# else
#  include <sys/termio.h>
# endif
#elif defined(SYSV) || defined(ISC)
# include <sys/termio.h>
#elif !defined(VMS)
# include <sgtty.h>
#endif /* USE_POSIX_TERMIOS */

/*
 * Stream includes, which declare struct winsize or ttysize.
 */
#ifdef SYSV
#ifdef USE_USG_PTYS
#include <sys/stream.h>		/* get typedef used in ptem.h */
#ifdef HAVE_SYS_PTEM_H
#include <sys/ptem.h>		/* get struct winsize */
#endif
#endif /* USE_USG_PTYS */
#endif /* SYSV */

/*
 * Special cases (structures and definitions that have to be adjusted).
 */
#if defined(__CYGWIN__) && !defined(TIOCSPGRP)
#include <termios.h>
#define TIOCSPGRP (_IOW('t', 118, pid_t))
#endif

#ifdef __hpux
#include <sys/bsdtty.h>		/* defines TIOCSLTC */
#endif

#ifdef ISC
#define TIOCGPGRP TCGETPGRP
#define TIOCSPGRP TCSETPGRP
#endif

#ifdef Lynx
#include <resource.h>
#elif !(defined(SYSV) || defined(linux) || defined(VMS) || (defined(__QNX__)&&!defined(__QNXNTO__)))
#include <sys/resource.h>
#endif

#ifdef macII
#undef FIOCLEX
#undef FIONCLEX
#endif /* macII */

#if defined(__QNX__) || defined(__GNU__) || defined(__MVS__) || defined(__osf__)
#undef TIOCSLTC			/* <sgtty.h> conflicts with <termios.h> */
#undef TIOCSLTC
#endif

#if defined (__sgi) || (defined(__linux__) && defined(__sparc__)) || defined(__UNIXWARE__)
#undef TIOCLSET			/* defined, but not useable */
#endif

#if defined(sun) || defined(__UNIXWARE__)
#include <sys/filio.h>
#endif

#if defined(TIOCSLTC) && ! (defined(linux) || defined(__MVS__) || defined(Lynx) || defined(SVR4))
#define HAS_LTCHARS
#endif

#if !defined(TTYSIZE_STRUCT)
#if defined(TIOCSWINSZ)
#define USE_STRUCT_WINSIZE 1
#define TTYSIZE_STRUCT struct winsize
#define GET_TTYSIZE(fd, data) ioctl(fd, TIOCGWINSZ, (char *) &data)
#define SET_TTYSIZE(fd, data) ioctl(fd, TIOCSWINSZ, (char *) &data)
#define TTYSIZE_COLS(data) data.ws_col
#define TTYSIZE_ROWS(data) data.ws_row
#endif /* TIOCSWINSZ */
#endif /* TTYSIZE_STRUCT */

#ifndef USE_STRUCT_WINSIZE
#error "There is a configuration error with struct winsize ifdef"
#endif

/* "resize" depends upon order of assignments in this macro */
#ifdef USE_STRUCT_WINSIZE
#define setup_winsize(ts, rows, cols, height, width) \
    (ts).ws_xpixel = (ttySize_t) (width), \
    (ts).ws_ypixel = (ttySize_t) (height), \
    TTYSIZE_ROWS(ts) = (ttySize_t) (rows), \
    TTYSIZE_COLS(ts) = (ttySize_t) (cols)
#else
#define setup_winsize(ts, rows, cols, height, width) \
    TTYSIZE_ROWS(ts) = (ttySize_t) (rows), \
    TTYSIZE_COLS(ts) = (ttySize_t) (cols)
#endif

#if OPT_TRACE

#ifdef USE_STRUCT_WINSIZE
#define trace_winsize(ts, id) \
    TRACE(("%s@@%d, TTYSIZE %s chars %dx%d pixels %dx%d\n", \
    	   __FILE__, __LINE__, id, \
	   TTYSIZE_ROWS(ts), TTYSIZE_COLS(ts), (ts).ws_ypixel, (ts).ws_xpixel))
#else
#define trace_winsize(ts, id) \
    TRACE(("%s@@%d, TTYSIZE %s chars %dx%d\n", __FILE__, __LINE__, id, \
    	   TTYSIZE_ROWS(ts), TTYSIZE_COLS(ts)))
#endif

#define TRACE_GET_TTYSIZE(fd, id) { \
	    TTYSIZE_STRUCT debug_ttysize; \
	    if (GET_TTYSIZE(fd, debug_ttysize) == 0) \
		trace_winsize(debug_ttysize, id); \
	    else \
		TRACE(("%s@@%d, TTYSIZE failed %s\n", __FILE__, __LINE__, strerror(errno))); \
	}
#else
#define trace_winsize(ts, id)	/* nothing */
#define TRACE_GET_TTYSIZE(fd, id)	/* nothing */
#endif

typedef unsigned short ttySize_t;

#endif /* included_xterm_io_h */
@


1.7
log
@Update to xterm 311. ok shadchin@@
@
text
@d1 1
a1 1
/* $XTermId: xterm_io.h,v 1.58 2014/07/25 08:26:56 tom Exp $ */
d4 1
a4 1
 * Copyright 2000-2013,2014 by Thomas E. Dickey
d205 1
a205 1
#ifdef __QNX__
a206 9
#undef TIOCLSET
#endif

#if defined(__sgi) && (OSMAJORVERSION >= 5)
#undef TIOCLSET			/* defined, but not useable */
#endif

#if defined(__GNU__) || defined(__MVS__) || defined(__osf__)
#undef TIOCLSET
d211 1
a211 1
#undef TIOCLSET			/* XXX why is this undef-ed again? */
d237 13
d251 13
a263 1
#define TRACE_TTYSIZE(fd, id) { \
d266 1
a266 1
		TRACE(("%s@@%d, TTYSIZE %s %d %d\n", __FILE__, __LINE__, id, TTYSIZE_ROWS(debug_ttysize), TTYSIZE_COLS(debug_ttysize))); \
d271 2
a272 1
#define TRACE_TTYSIZE(fd, id) /* nothing */
d277 1
a277 1
#endif	/* included_xterm_io_h */
@


1.6
log
@Update to xterm 291. Tested by many.
@
text
@d1 1
a1 1
/* $XTermId: xterm_io.h,v 1.56 2013/01/06 15:20:45 tom Exp $ */
d4 1
a4 1
 * Copyright 2000-2012,2013 by Thomas E. Dickey
d44 5
d170 1
a170 1
#include <sys/stream.h>			/* get typedef used in ptem.h */
d172 1
a172 1
#include <sys/ptem.h>			/* get struct winsize */
d211 1
a211 1
#undef TIOCLSET				/* defined, but not useable */
d220 1
a220 1
#undef TIOCLSET /* XXX why is this undef-ed again? */
@


1.5
log
@Update to xterm 279. Tested by krw@@, mpi@@, shadchin@@.
@
text
@d1 1
a1 1
/* $XTermId: xterm_io.h,v 1.54 2012/03/16 09:48:56 tom Exp $ */
d4 1
a4 1
 * Copyright 2000-2011,2012 by Thomas E. Dickey
a54 4
#ifdef __UNIXOS2__
#define USE_SYSV_TERMIO
#endif

a169 5
#elif defined(sun) && !defined(SVR4)
#include <sys/ttycom.h>
#ifdef TIOCSWINSZ
#undef TIOCSSIZE
#endif
a179 50
#ifdef __UNIXOS2__

#define XFREE86_PTY	0x76

#define XTY_TIOCSETA	0x48
#define XTY_TIOCSETAW	0x49
#define XTY_TIOCSETAF	0x4a
#define XTY_TIOCCONS	0x4d
#define XTY_TIOCSWINSZ	0x53
#define XTY_ENADUP	0x5a
#define XTY_TRACE	0x5b
#define XTY_TIOCGETA	0x65
#define XTY_TIOCGWINSZ	0x66
#define PTMS_GETPTY	0x64
#define PTMS_BUFSZ	14

#ifndef NCCS
#define NCCS 11
#endif

#define TIOCCONS	108
#define TIOCSWINSZ	113
#define TIOCGWINSZ	117

struct pt_termios
{
        unsigned short  c_iflag;
        unsigned short  c_oflag;
        unsigned short  c_cflag;
        unsigned short  c_lflag;
        unsigned char   c_cc[NCCS];
        long            _reserved_[4];
};

struct winsize {
	unsigned short	ws_row;		/* rows, in characters */
	unsigned short	ws_col;		/* columns, in characters */
	unsigned short	ws_xpixel;	/* horizontal size, pixels */
	unsigned short	ws_ypixel;	/* vertical size, pixels */
};
#define TTYSIZE_STRUCT struct winsize
#define USE_STRUCT_WINSIZE 1

#ifdef XTERM_MAIN
extern int ptioctl(int fd, int func, void* data);
#define ioctl ptioctl
#endif

#endif /* __UNIXOS2__ */

d227 1
a227 4
#if defined(TIOCSSIZE) && (defined(sun) && !defined(SVR4))
#define USE_STRUCT_TTYSIZE 1
#define TTYSIZE_STRUCT struct ttysize
#elif defined(TIOCSWINSZ)
a229 14
#endif /* sun vs TIOCSWINSZ */
#endif /* TTYSIZE_STRUCT */

#if defined(USE_STRUCT_TTYSIZE)

#define TTYSIZE_STRUCT struct ttysize
#define GET_TTYSIZE(fd, data) ioctl(fd, TIOCGSIZE, &data)
#define SET_TTYSIZE(fd, data) ioctl(fd, TIOCSSIZE, &data)
#define TTYSIZE_COLS(data) data.ts_cols
#define TTYSIZE_ROWS(data) data.ts_lines

#elif defined(USE_STRUCT_WINSIZE)

#define TTYSIZE_STRUCT struct winsize
d234 2
d237 3
a239 1
#endif /* (USE_STRUCT_TTYSIZE) */
@


1.4
log
@Update to xterm 278. Tested by mpi@@, shadchin@@
@
text
@d1 1
a1 1
/* $XTermId: xterm_io.h,v 1.53 2011/12/30 22:45:49 tom Exp $ */
d4 1
a4 1
 * Copyright 2000-2006,2010 by Thomas E. Dickey
d296 1
d298 2
a299 1
#define SET_TTYSIZE(fd, data) ioctl(fd, TIOCSSIZE, &data);
d302 1
d304 1
d306 1
d310 13
@


1.3
log
@Update to xterm 271. Tested by shadchin@@ and ajacoutot@@
@
text
@d1 1
a1 1
/* $XTermId: xterm_io.h,v 1.51 2011/07/03 15:48:35 Paul.Lampert Exp $ */
d170 1
a170 1
#if !defined(SVR4) || defined(__SCO__)
@


1.2
log
@Update to xterm 261. Tested by krw@@, jcs@@.
@
text
@d1 1
a1 1
/* $XTermId: xterm_io.h,v 1.50 2010/05/23 16:04:32 tom Exp $ */
d59 1
a59 1
#if defined(__DragonFly__) || defined(__FreeBSD__) || defined(__NetBSD__) || defined(__OpenBSD__) || defined(__INTERIX) || defined(__APPLE__) || defined(__UNIXWARE__)
d136 1
a136 1
#if defined(USE_POSIX_TERMIOS)
@


1.1
log
@Initial revision
@
text
@d1 1
a1 1
/* $XTermId: xterm_io.h,v 1.47 2006/02/13 01:15:00 tom Exp $ */
d4 1
a4 5
 * $XFree86: xc/programs/xterm/xterm_io.h,v 1.20 2006/02/13 01:15:00 dickey Exp $
 */

/*
 * Copyright 2000-2005,2006 by Thomas E. Dickey
d306 2
@


1.1.1.1
log
@Importing xterm 216
@
text
@@
