head	1.1;
access;
symbols
	OPENBSD_5_8:1.1.0.2;
locks; strict;
comment	@# @;


1.1
date	2015.12.17.14.40.16;	author ajacoutot;	state dead;
branches
	1.1.2.1;
next	;
commitid	MId9n7u48Xv2Zhhe;

1.1.2.1
date	2015.12.17.14.40.16;	author ajacoutot;	state Exp;
branches;
next	;
commitid	MId9n7u48Xv2Zhhe;


desc
@@


1.1
log
@file patch-trytond_model_modelstorage_py was initially added on branch OPENBSD_5_8.
@
text
@@


1.1.2.1
log
@Check all fields when writing a sequence of records, values (CVE-2015-0861)
@
text
@a0 30
$OpenBSD$

http://hg.tryton.org/trytond/raw-rev/a671098903a2

--- trytond/model/modelstorage.py.orig	Tue May 19 14:53:20 2015
+++ trytond/model/modelstorage.py	Thu Dec 17 15:38:01 2015
@@@@ -138,18 +138,19 @@@@ class ModelStorage(Model):
         ModelAccess = pool.get('ir.model.access')
         ModelFieldAccess = pool.get('ir.model.field.access')
 
-        ModelAccess.check(cls.__name__, 'write')
-        ModelFieldAccess.check(cls.__name__,
-            [x for x in values if x in cls._fields], 'write')
-
         assert not len(args) % 2
         actions = iter((records, values) + args)
         all_records = []
+        all_fields = set()
         for records, values in zip(actions, actions):
             if not cls.check_xml_record(records, values):
                 cls.raise_user_error('write_xml_record',
                         error_description='xml_record_desc')
             all_records += records
+            all_fields.update(values.iterkeys())
+
+        ModelAccess.check(cls.__name__, 'write')
+        ModelFieldAccess.check(cls.__name__, all_fields, 'write')
 
         # Increase transaction counter
         Transaction().counter += 1
@

