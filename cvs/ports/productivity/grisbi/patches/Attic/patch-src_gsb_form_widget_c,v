head	1.2;
access;
symbols
	OPENBSD_5_5:1.1.0.4
	OPENBSD_5_5_BASE:1.1
	OPENBSD_5_4:1.1.0.2
	OPENBSD_5_4_BASE:1.1;
locks; strict;
comment	@# @;


1.2
date	2014.03.30.19.36.42;	author landry;	state dead;
branches;
next	1.1;

1.1
date	2013.04.27.13.02.08;	author landry;	state Exp;
branches;
next	;


desc
@@


1.2
log
@Long-awaited update to grisbi 1.0.0.

Add goffice08 dependency for accounts graphing feature, finally!
@
text
@$OpenBSD: patch-src_gsb_form_widget_c,v 1.1 2013/04/27 13:02:08 landry Exp $
http://permalink.gmane.org/gmane.linux.grisbi.devel.french/8671
Fix a crasher in gsb_form_widget_free_list when exiting
--- src/gsb_form_widget.c.orig	Sat Apr 27 12:50:02 2013
+++ src/gsb_form_widget.c	Sat Apr 27 12:49:39 2013
@@@@ -99,6 +99,7 @@@@ GSList *gsb_form_widget_get_list ( void )
 gboolean gsb_form_widget_free_list ( void )
 {
     GSList *tmp_list;
+    GtkWidget *widget_signals;
 
     devel_debug (NULL);
 
@@@@ -120,6 +121,35 @@@@ gboolean gsb_form_widget_free_list ( void )
         {
             if (GTK_IS_WIDGET (element -> element_widget))
             {
+                widget_signals = NULL;
+                if ( GTK_IS_ENTRY ( element -> element_widget ) )
+                {
+                    widget_signals = element -> element_widget;
+                }
+                else if ( GTK_IS_COMBOFIX ( element -> element_widget ) )
+                {
+                    widget_signals = GTK_COMBOFIX ( element -> element_widget ) -> entry;
+                }
+
+                if ( widget_signals )
+                {
+                    g_signal_handlers_disconnect_by_func ( G_OBJECT ( widget_signals ),
+                        G_CALLBACK ( gsb_form_entry_get_focus ),
+                        GINT_TO_POINTER ( element -> element_number ));
+                    g_signal_handlers_disconnect_by_func ( G_OBJECT ( widget_signals ),
+                        G_CALLBACK ( gsb_form_entry_lose_focus ),
+                        GINT_TO_POINTER ( element -> element_number ));
+                    g_signal_handlers_disconnect_by_func ( G_OBJECT ( widget_signals ),
+                        G_CALLBACK ( gsb_form_button_press_event ),
+                        GINT_TO_POINTER ( element -> element_number ));
+                    g_signal_handlers_disconnect_by_func ( G_OBJECT ( widget_signals ),
+                        G_CALLBACK ( gsb_form_key_press_event ),
+                        GINT_TO_POINTER ( element -> element_number ));
+                    g_signal_handlers_disconnect_by_func ( G_OBJECT ( widget_signals ),
+                        G_CALLBACK ( gsb_form_combo_selection_changed ),
+                        GINT_TO_POINTER ( element -> element_number ));
+                }
+
                 /* if there is something in the combofix we destroy, the popup will
                  * be showed because destroying the gtk_entry will erase it directly,
                  * so the simpliest way to avoid that is to erase now the entry, but with
@


1.1
log
@Update to grisbi 0.8.9.

Backport two fixes from
http://article.gmane.org/gmane.linux.grisbi.devel.french/8669
http://article.gmane.org/gmane.linux.grisbi.devel.french/8671 to fix
some crashes when exiting. Still not perfect...
@
text
@d1 1
a1 1
$OpenBSD$
@

