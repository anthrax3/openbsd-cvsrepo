head	1.22;
access;
symbols
	OPENBSD_6_1:1.20.0.2
	OPENBSD_6_1_BASE:1.20
	OPENBSD_6_0:1.16.0.2
	OPENBSD_6_0_BASE:1.16
	OPENBSD_5_9:1.13.0.2
	OPENBSD_5_9_BASE:1.13
	OPENBSD_5_8:1.6.0.4
	OPENBSD_5_8_BASE:1.6
	OPENBSD_5_7:1.5.0.4
	OPENBSD_5_7_BASE:1.5
	OPENBSD_5_6:1.5.0.2
	OPENBSD_5_6_BASE:1.5
	OPENBSD_5_5:1.4.0.4
	OPENBSD_5_5_BASE:1.4
	OPENBSD_5_4:1.4.0.2
	OPENBSD_5_4_BASE:1.4
	OPENBSD_5_3:1.2.0.4
	OPENBSD_5_3_BASE:1.2
	OPENBSD_5_2:1.2.0.2
	OPENBSD_5_2_BASE:1.2
	pascal_20122606:1.1.1.1
	pascal:1.1.1;
locks; strict;
comment	@# @;


1.22
date	2017.05.09.22.22.36;	author gsoares;	state Exp;
branches;
next	1.21;
commitid	hqAZe4djDAkxkjls;

1.21
date	2017.04.08.23.39.06;	author gsoares;	state Exp;
branches;
next	1.20;
commitid	bUse03k8flzf6cr9;

1.20
date	2017.03.01.00.59.59;	author gsoares;	state Exp;
branches;
next	1.19;
commitid	HhKStqJWwzXbli4M;

1.19
date	2017.02.28.02.27.41;	author gsoares;	state Exp;
branches;
next	1.18;
commitid	QEGgTJ1FL2oroXit;

1.18
date	2016.11.04.01.29.17;	author gsoares;	state Exp;
branches;
next	1.17;
commitid	FsLwonRTIEPlwm4K;

1.17
date	2016.10.25.08.57.39;	author otto;	state Exp;
branches;
next	1.16;
commitid	DPX52BaBI4H3NVvM;

1.16
date	2016.06.03.01.44.51;	author gsoares;	state Exp;
branches;
next	1.15;
commitid	IKJMKzAlcWYRs3eE;

1.15
date	2016.05.25.15.49.21;	author okan;	state Exp;
branches;
next	1.14;
commitid	xjzClIqCkyMQsafc;

1.14
date	2016.04.22.02.43.05;	author gsoares;	state Exp;
branches;
next	1.13;
commitid	ZKE9N2hxS894mK6W;

1.13
date	2016.01.24.01.07.19;	author gsoares;	state Exp;
branches;
next	1.12;
commitid	o2SaBlKJxSNpASek;

1.12
date	2015.12.08.22.14.32;	author gsoares;	state Exp;
branches;
next	1.11;
commitid	CjmZNuiDUffzsoZ6;

1.11
date	2015.12.08.13.05.29;	author gsoares;	state Exp;
branches;
next	1.10;
commitid	HczMzMJGCcVa4wsY;

1.10
date	2015.12.04.04.26.33;	author gsoares;	state Exp;
branches;
next	1.9;
commitid	FvWG6hcCXtMF1rys;

1.9
date	2015.11.28.01.37.59;	author gsoares;	state Exp;
branches;
next	1.8;
commitid	u2it7i9BCXGsp2tW;

1.8
date	2015.08.21.22.51.10;	author sthen;	state Exp;
branches;
next	1.7;
commitid	Ahig7CHjExrDzTdF;

1.7
date	2015.08.11.21.41.58;	author jasper;	state Exp;
branches;
next	1.6;
commitid	ixDyFe1aYbmUfbkN;

1.6
date	2015.06.17.22.48.33;	author gsoares;	state Exp;
branches;
next	1.5;
commitid	jWGyAPm5k5xLtOUZ;

1.5
date	2014.03.09.20.26.48;	author pascal;	state Exp;
branches;
next	1.4;

1.4
date	2013.03.21.22.26.27;	author sthen;	state Exp;
branches;
next	1.3;

1.3
date	2013.03.11.11.37.53;	author espie;	state Exp;
branches;
next	1.2;

1.2
date	2012.06.27.10.43.07;	author pascal;	state Exp;
branches;
next	1.1;

1.1
date	2012.06.26.15.07.14;	author pascal;	state Exp;
branches
	1.1.1.1;
next	;

1.1.1.1
date	2012.06.26.15.07.14;	author pascal;	state Exp;
branches;
next	;


desc
@@


1.22
log
@update to latest github commit
@
text
@# $OpenBSD: Makefile,v 1.21 2017/04/08 23:39:06 gsoares Exp $

ONLY_FOR_ARCHS =	amd64 i386 powerpc
BROKEN-powerpc =	threading issues

COMMENT =		Plan 9 from user space

DISTNAME =		plan9port-20170505

GH_ACCOUNT =		9fans
GH_PROJECT =		plan9port
GH_COMMIT =		c976381d67e1c1ff16f155cbcc6c905245d0520f

CATEGORIES =		plan9

HOMEPAGE =		http://swtch.com/plan9port/

MAINTAINER =		Gleydson Soares <gsoares@@openbsd.org>

# mostly LPL (see LICENSE)
# certain fonts may NOT be redistributed separately
PERMIT_PACKAGE_CDROM =	Yes

WANTLIB =		X11 Xext c m pthread util fontconfig freetype z

DISTFILES =		${GH_COMMIT}.tar.gz pgw.tar.bz2:1 \
				roget.tar.bz2:0 scat.tgz:1
DIST_SUBDIR =		plan9port
MASTER_SITES0 =		http://pdos.lcs.mit.edu/~rsc/software/plan9/
MASTER_SITES1 =		http://pdos.lcs.mit.edu/~rsc/

BUILD_DEPENDS =		archivers/bzip2
RUN_DEPENDS =		print/ghostscript/gnu \
			print/gv

WRKDIST =		${WRKDIR}/plan9port-${GH_COMMIT}

PLAN9 =			${PREFIX}/plan9

NO_TEST =		Yes

SUBST_VARS +=		CC

post-extract:
	cd ${WRKSRC}/dict && tar xjf ${FULLDISTDIR}/pgw.tar.bz2
	cd ${WRKSRC}/dict && tar xjf ${FULLDISTDIR}/roget.tar.bz2
	cd ${WRKSRC}/sky && tar xzf ${FULLDISTDIR}/scat.tgz

post-patch:
	cd ${WRKSRC}/src/libthread && cp Darwin-x86_64-swapcontext.c \
		OpenBSD-x86_64.c && cp Darwin-x86_64-asm.s \
		OpenBSD-x86_64-asm.S && mv OpenBSD-386-asm.s \
		OpenBSD-386-asm.S
	find ${WRKSRC} -name .cvsignore -exec rm -f {} \;
	cd ${WRKSRC} && rm -rf .hg .hgignore .hgtags .gitignore

pre-configure:
	${SUBST_CMD} ${WRKSRC}/INSTALL ${WRKSRC}/bin/{9c,9l}

do-build:
	cd ${WRKSRC} && env CC9="${CC}" CCFLAGS="${CFLAGS}" ./INSTALL -b

do-install:
	find ${WRKSRC}/src -name '*.orig' -exec rm -f {} \+
	cd ${WRKSRC} && rm *.orig && sed -i 's#/usr/local#${TRUEPREFIX}#' \
		`cat lib/moveplan9.files`

	${INSTALL_DATA_DIR} ${PLAN9}
	cd ${WRKSRC} && pax -rw . ${PLAN9}
	cd ${PREFIX} && ln -s ../plan9/bin/9 bin/9

.include <bsd.port.mk>
@


1.21
log
@sync with github
zap patches merged upstream
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.20 2017/03/01 00:59:59 gsoares Exp $
d8 1
a8 1
DISTNAME =		plan9port-20170407
d12 1
a12 1
GH_COMMIT =		94b38bdb722052838eb0d940c05995b870db4ea0
@


1.20
log
@teach 9c and 9l how honor CC.
fixes plan9/devdrawserver's build spotted by naddy@@
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.19 2017/02/28 02:27:41 gsoares Exp $
d8 1
a8 3
DISTNAME =		plan9port-20161102
REVISION =		0

d12 1
a12 1
GH_COMMIT =		1b68dbef7b7dd7c4aa2b5755c1399cf66d2ea6fa
@


1.19
log
@honor CC
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.18 2016/11/04 01:29:17 gsoares Exp $
d9 1
d60 1
a60 1
	${SUBST_CMD} ${WRKSRC}/INSTALL
@


1.18
log
@update to latest github commit, includes several fixes to libregexp,
get rid of patches/ merged upstream.
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.17 2016/10/25 08:57:39 otto Exp $
d43 2
d57 3
@


1.17
log
@int cannot hold all the values a ptrdiff_t can take
bump REVISION; ok ray@@
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.16 2016/06/03 01:44:51 gsoares Exp $
d8 2
a9 2
DISTNAME =		plan9port-20160418
REVISION =		2
d13 1
a13 1
GH_COMMIT =		35d43924484b88b9816e40d2f6bff4547f3eec47
@


1.16
log
@fix web(1) plumb $BROWSER
from Neven Sajko via plan9port-review
# https://plan9port-review.googlesource.com/#/c/1561

I had a similar patch rotting in my tree.
Works fine, I've been using it daily with chrome.
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.15 2016/05/25 15:49:21 okan Exp $
d9 1
a9 1
REVISION =		1
@


1.15
log
@Fix 2 overflows (submitted upstream; bug id's in patches);
from Ray Lai.

feedback and ok gsoares@@
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.14 2016/04/22 02:43:05 gsoares Exp $
d9 1
a9 1
REVISION =		0
@


1.14
log
@update to latest git commit
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.13 2016/01/24 01:07:19 gsoares Exp $
d9 1
@


1.13
log
@update to the latest git commit
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.12 2015/12/08 22:14:32 gsoares Exp $
d8 1
a8 1
DISTNAME =		plan9port-20160122
d12 1
a12 1
GH_COMMIT =		c499ab911db8afefa197988c796331697c06219b
@


1.12
log
@update plan9/plan9port to current upstream version
(GH_COMMIT 009b0cb5eb340b8bc3268bfaeb86abfeffdc1b1c).

auxstats(getifaddrs(3)) patches have already been accepted and committed upstream
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.11 2015/12/08 13:05:29 gsoares Exp $
d8 1
a8 1
DISTNAME =		plan9port-20151208
d12 1
a12 1
GH_COMMIT =		009b0cb5eb340b8bc3268bfaeb86abfeffdc1b1c
@


1.11
log
@- use getifaddrs(3) instead of kvm(3)
- stop linking with kvm(3). OpenBSD's p9p/auxstats no longer uses libkvm. (reminded by jasper@@)

OK mpi@@ jasper@@
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.10 2015/12/04 04:26:33 gsoares Exp $
d8 1
a8 2
DISTNAME =		plan9port-20151111
REVISION =		1
d12 1
a12 1
GH_COMMIT =		6a93bd5c92bd2954314f492f10bbcac2c3416da0
@


1.10
log
@unbreak on i386
thanks to sthen@@ for spotting this.
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.9 2015/11/28 01:37:59 gsoares Exp $
d9 1
a9 1
REVISION =		0
d25 1
a25 1
WANTLIB =		X11 Xext c kvm m pthread util fontconfig freetype z
@


1.9
log
@update to 20151111 and take maintainership; ok pascal@@ (former maintainer)
ok jung@@
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.8 2015/08/21 22:51:10 sthen Exp $
d9 1
d51 2
a52 1
		OpenBSD-x86_64-asm.S
@


1.8
log
@sync WANTLIB
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.7 2015/08/11 21:41:58 jasper Exp $
d8 5
a12 2
DISTNAME =		plan9port-20140306
REVISION =		1
d18 1
a18 1
MAINTAINER =		Pascal Stumpf <Pascal.Stumpf@@cubes.de>
d26 1
a26 1
DISTFILES =		${DISTNAME}${EXTRACT_SUFX} pgw.tar.bz2 \
a28 1
MASTER_SITES =		https://plan9port.googlecode.com/files/
a30 1
EXTRACT_SUFX =		.tgz
d36 1
a36 1
WRKDIST =		${WRKDIR}/plan9port
a41 2
SUBST_VARS+=		CC

d52 2
a53 3
	cd ${WRKSRC} && rm -rf .hg .hgignore .hgtags
pre-configure:
	${SUBST_CMD} ${WRKSRC}/INSTALL
d59 1
a59 1
	cd ${WRKSRC} && sed -i 's#/usr/local#${TRUEPREFIX}#' \
@


1.7
log
@use sed -i
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.6 2015/06/17 22:48:33 gsoares Exp $
d9 1
a9 1
REVISION =		0
d21 1
a21 1
WANTLIB =		X11 Xext c kvm m pthread util
@


1.6
log
@add patch for enable fontsrv(4) build on OpenBSD

tweaks/OK juanfra@@ pascal@@ (maintainer)

patch sent upstream
https://plan9port-review.googlesource.com/#/c/1290/
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.5 2014/03/09 20:26:48 pascal Exp $
d61 1
a61 1
	cd ${WRKSRC} && perl -pi -e 's#/usr/local#${TRUEPREFIX}#' \
@


1.5
log
@Overdue update to a newer snapshot, 20140306.
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.4 2013/03/21 22:26:27 sthen Exp $
d9 1
d41 2
d54 2
a55 1

@


1.4
log
@use movw not movl with (16-bit) segment registers.
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.3 2013/03/11 11:37:53 espie Exp $
d8 1
a8 2
DISTNAME =		plan9port-20120508
REVISION =		1
d25 1
a25 1
MASTER_SITES =		${HOMEPAGE}
d34 1
a34 1
WRKDIST =		${WRKDIR}/plan9
a39 31
SCRIPTS = \" \"\" 9 9.rc 9a 9ar 9c 9fs 9l B E Getdir adict awd bundle \
	codereview \
	codereview.py doctype g ipso kill label lc lookman man mk9660 mount \
	netfileget netfilelib.rc netfileput netfilestat nobs nroff osxvers ps \
	psfonts psu psv samsave sig slay spell src ssam stack start stop tref \
	troff2png u u.rc unmount vmount vwhois web wintext wmail yesterday

BINS = 9660srv 9p 9pserve 9term Mail Netfiles acme acmeevent aescbc ascii \
	asn12dsa asn12rsa astro auxclog auxstats awk basename bc bmp bunzip2 \
	bzip2 cal calendar cat cb cleanname cmapcube cmp colors comm core crop \
	date dc dd delatex deroff devdraw dial dict diff disknfs dns dnsdebug \
	dnsquery dnstcp dsa2pub dsa2ssh dsagen dsasign du dump9660 echo ed eqn \
	factor factotum file fmt fontsrv fortune freq fsize getflags gif grap \
	graph grep gunzip gview gzip hget hist hoc htmlfmt htmlroff ico iconv \
	idiff img import join jpg lex listen1 look ls mapd mc md5sum mk mkdir \
	mklatinkbd mtime namespace ndbipquery ndbmkdb ndbmkhash ndbmkhosts \
	ndbquery netkey news p page passwd pbd pemdecode pemencode pic plot \
	plumb plumber png ppm pr primes proof psdownload ramfs rc read \
	readcons resample rio rm rsa2csr rsa2pub rsa2ssh rsa2x509 rsafill \
	rsagen sam samterm scat secstore secstored secuser sed seq sftpcache \
	sha1sum sleep snarfer sort split sprog srv ssh-agent stats statusbar \
	strings sum tail tar tbl tcolors tcs tee test time togif toico topng \
	toppm touch tpic tr tr2post troff troff2html tweak unicode uniq units \
	unutf unvac unzip usage vac vacfs vbackup vcat vmount0 vnfs wc win xd \
	xshove yacc yuv zerotrunc zip 9pfuse acid acidtypes db

VENTI_BINS =    buildindex copy fmtbloom printarenapart syncindex \
        checkarenas dump fmtindex rdarena venti checkindex findscore \
        fmtisect read verifyarena clumpstats fixarenas mirrorarenas \
        ro wrarena fmtarenas printarena sync write

d61 1
a61 24
	cd ${WRKSRC} && ${INSTALL_DATA} CONTRIBUTORS LICENSE rcmain ${PLAN9}
	${INSTALL_PROGRAM_DIR} ${PLAN9}/bin
	cd ${WRKSRC}/bin && ${INSTALL_SCRIPT} ${SCRIPTS} ${PLAN9}/bin
	cd ${WRKSRC}/bin && ${INSTALL_PROGRAM} ${BINS} ${PLAN9}/bin
	${INSTALL_PROGRAM_DIR} ${PLAN9}/bin/fs
	${INSTALL_PROGRAM} ${WRKSRC}/bin/fs/* ${PLAN9}/bin/fs
	${INSTALL_PROGRAM_DIR} ${PLAN9}/bin/upas
	${INSTALL_SCRIPT} ${WRKSRC}/bin/upas/* ${PLAN9}/bin/upas
	${INSTALL_PROGRAM_DIR} ${PLAN9}/bin/venti
	cd ${WRKSRC}/bin/venti && ${INSTALL_PROGRAM} ${VENTI_BINS} \
		${PLAN9}/bin/venti
	${INSTALL_SCRIPT} ${WRKSRC}/bin/venti/conf ${PLAN9}/bin/venti

	${INSTALL_MAN_DIR} ${PLAN9}/man
.for f in fonts index.html junkwords lookman.index mkfile mkindex secindex
	${INSTALL_DATA} ${WRKSRC}/man/${f} ${PLAN9}/man
.endfor
.for n in 1 3 4 5 6 7 8 9
	${INSTALL_MAN_DIR} ${PLAN9}/man/man${n}
	${INSTALL_MAN} ${WRKSRC}/man/man${n}/* ${PLAN9}/man/man${n}
.endfor

	cd ${WRKSRC} && pax -rw acid dict face font include lib \
		ndb news plumb postscript proto sky src tmac troff ${PLAN9}
@


1.3
log
@PERMIT_* / REGRESS->TEST sweep
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.2 2012/06/27 10:43:07 pascal Exp $
d9 1
a9 1
REVISION =		0
@


1.2
log
@Small plist tweak by ajacoutot@@; don't try to use rfork on i386
(noticed by nigel@@)
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.1.1.1 2012/06/26 15:07:14 pascal Exp $
a19 3
PERMIT_PACKAGE_FTP =	Yes
PERMIT_DISTFILES_CDROM =Yes
PERMIT_DISTFILES_FTP =	Yes
d39 1
a39 1
NO_REGRESS =		Yes
@


1.1
log
@Initial revision
@
text
@d1 1
a1 1
# $OpenBSD$
d9 1
@


1.1.1.1
log
@Plan 9 is a distributed computing environment built at Bell Labs
starting in the late 1980s. The system can be obtained from Bell
Labs at http://plan9.bell-labs.com/plan9 and runs on PCs and a
variety of other platforms. Plan 9 became a convenient platform for
experimenting with new ideas, applications, and services.

Plan 9 from User Space provides many of the ideas, applications,
and services from Plan 9 on Unix-like systems. It runs on FreeBSD
(x86), Linux (x86 and PowerPC), Mac OS X (PowerPC), OpenBSD (x86),
and SunOS (Sparc).


testing/feedback and ok landry@@
@
text
@@
