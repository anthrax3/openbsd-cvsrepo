head	1.3;
access;
symbols
	OPENBSD_3_3:1.2.0.16
	OPENBSD_3_3_BASE:1.2
	OPENBSD_3_2:1.2.0.14
	OPENBSD_3_2_BASE:1.2
	OPENBSD_3_1:1.2.0.12
	OPENBSD_3_1_BASE:1.2
	OPENBSD_3_0:1.2.0.10
	OPENBSD_3_0_BASE:1.2
	OPENBSD_2_9_TRACKING_SWITCH:1.2
	OPENBSD_2_9:1.2.0.8
	OPENBSD_2_9_BASE:1.2
	OPENBSD_2_8:1.2.0.6
	OPENBSD_2_8_BASE:1.2
	OPENBSD_2_7:1.2.0.4
	OPENBSD_2_7_BASE:1.2
	OPENBSD_2_6:1.2.0.2
	OPENBSD_2_6_BASE:1.2
	OPENBSD_2_5:1.1.1.1.0.4
	OPENBSD_2_5_BASE:1.1.1.1
	OPENBSD_2_4:1.1.1.1.0.2
	OPENBSD_2_4_BASE:1.1.1.1
	wily:1.1.1.1
	angelos:1.1.1;
locks; strict;
comment	@# @;


1.3
date	2003.05.24.19.13.08;	author pvalchev;	state dead;
branches;
next	1.2;

1.2
date	99.05.11.21.22.01;	author brad;	state Exp;
branches;
next	1.1;

1.1
date	98.05.17.03.01.59;	author angelos;	state Exp;
branches
	1.1.1.1;
next	;

1.1.1.1
date	98.05.17.03.01.59;	author angelos;	state Exp;
branches;
next	;


desc
@@


1.3
log
@update-patches
@
text
@--- libmsg/connect.c.orig	Tue May 11 13:45:26 1999
+++ libmsg/connect.c	Tue May 11 13:48:06 1999
@@@@ -106,11 +106,13 @@@@
 
 	/* bind it to a unix-domain at a temporary address */
 	addr.sun_family = AF_UNIX;
-	tmpnam(addr.sun_path);
+	sprintf(addr.sun_path, "%s/xx.XXXXXXXX", P_tmpdir);
+	close(mkstemp(addr.sun_path));
 	path = strdup(addr.sun_path);
 	len = strlen(addr.sun_path);
 
 	if (bind(s, (struct sockaddr *) &addr, sizeof addr) < 0){
+		unlink(path);
 		perror("bind");
 		return -1;
 	}
@@@@ -119,10 +121,14 @@@@
 
 	fd = wilyfifotalk();		/* fifo to wily */
 	if(fd<0)
+	{
+		unlink(path);
 		return -1;
+	}
 	nwritten = write(fd, addr.sun_path, len);
 	close(fd);
 	if(nwritten !=len){
+		unlink(path);
 		perror("write to wily");
 		return -1;
 	}
@


1.2
log
@- upgrade to wily 0.13.41
- remove GNU_CONFIGURE and add USE_AUTOCONF
- use SEPARATE_BUILD
@
text
@@


1.1
log
@Initial revision
@
text
@d1 32
a32 46
*** libmsg/connect.c.orig	Sat May 16 22:55:34 1998
--- libmsg/connect.c	Sat May 16 23:00:59 1998
***************
*** 106,116 ****
  
  	/* bind it to a unix-domain at a temporary address */
  	addr.sun_family = AF_UNIX;
! 	tmpnam(addr.sun_path);
  	path = strdup(addr.sun_path);
  	len = strlen(addr.sun_path);
  
  	if (bind(s, (struct sockaddr *) &addr, sizeof addr) < 0){
  		perror("bind");
  		return -1;
  	}
--- 106,118 ----
  
  	/* bind it to a unix-domain at a temporary address */
  	addr.sun_family = AF_UNIX;
! 	sprintf(addr.sun_path, "%s/xx.XXXXXXXX", P_tmpdir);
! 	close(mkstemp(addr.sun_path));
  	path = strdup(addr.sun_path);
  	len = strlen(addr.sun_path);
  
  	if (bind(s, (struct sockaddr *) &addr, sizeof addr) < 0){
+ 		unlink(path);
  		perror("bind");
  		return -1;
  	}
***************
*** 119,128 ****
--- 121,134 ----
  
  	fd = wilyfifotalk();		/* fifo to wily */
  	if(fd<0)
+ 	{
+ 		unlink(path);
  		return -1;
+ 	}
  	nwritten = write(fd, addr.sun_path, len);
  	close(fd);
  	if(nwritten !=len){
+ 		unlink(path);
  		perror("write to wily");
  		return -1;
  	}
@


1.1.1.1
log
@wily the editor
@
text
@@
