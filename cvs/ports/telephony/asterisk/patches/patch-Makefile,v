head	1.39;
access;
symbols
	OPENBSD_6_1:1.39.0.2
	OPENBSD_6_1_BASE:1.39
	OPENBSD_6_0:1.38.0.2
	OPENBSD_6_0_BASE:1.38
	OPENBSD_5_9:1.37.0.2
	OPENBSD_5_9_BASE:1.37
	OPENBSD_5_8:1.36.0.4
	OPENBSD_5_8_BASE:1.36
	OPENBSD_5_7:1.35.0.8
	OPENBSD_5_7_BASE:1.35
	OPENBSD_5_6:1.35.0.6
	OPENBSD_5_6_BASE:1.35
	OPENBSD_5_5:1.35.0.4
	OPENBSD_5_5_BASE:1.35
	OPENBSD_5_4:1.35.0.2
	OPENBSD_5_4_BASE:1.35
	OPENBSD_5_3:1.33.0.2
	OPENBSD_5_3_BASE:1.33
	OPENBSD_5_2:1.32.0.2
	OPENBSD_5_2_BASE:1.32
	OPENBSD_5_1_BASE:1.31
	OPENBSD_5_1:1.31.0.2
	OPENBSD_5_0:1.30.0.4
	OPENBSD_5_0_BASE:1.30
	OPENBSD_4_9:1.30.0.2
	OPENBSD_4_9_BASE:1.30
	OPENBSD_4_8:1.28.0.2
	OPENBSD_4_8_BASE:1.28
	OPENBSD_4_7:1.23.0.2
	OPENBSD_4_7_BASE:1.23
	OPENBSD_4_6:1.19.0.2
	OPENBSD_4_6_BASE:1.19
	OPENBSD_4_5:1.18.0.2
	OPENBSD_4_5_BASE:1.18
	OPENBSD_4_4:1.17.0.2
	OPENBSD_4_4_BASE:1.17
	OPENBSD_4_3:1.15.0.2
	OPENBSD_4_3_BASE:1.15
	OPENBSD_4_2:1.10.0.2
	OPENBSD_4_2_BASE:1.10
	OPENBSD_4_1:1.9.0.2
	OPENBSD_4_1_BASE:1.9
	OPENBSD_4_0:1.7.0.2
	OPENBSD_4_0_BASE:1.7
	OPENBSD_3_9:1.6.0.2
	OPENBSD_3_9_BASE:1.6
	OPENBSD_3_8:1.4.0.2
	OPENBSD_3_8_BASE:1.4
	OPENBSD_3_7:1.1.1.1.0.2
	OPENBSD_3_7_BASE:1.1.1.1
	jolan_2004-09-25:1.1.1.1
	jolan:1.1.1;
locks; strict;
comment	@# @;


1.39
date	2016.11.11.10.55.17;	author sthen;	state Exp;
branches;
next	1.38;
commitid	JHzWucB4VBXAd6MH;

1.38
date	2016.03.29.23.24.46;	author sthen;	state Exp;
branches;
next	1.37;
commitid	6xsz7ii52z8elbLl;

1.37
date	2015.10.12.22.07.29;	author sthen;	state Exp;
branches
	1.37.2.1;
next	1.36;
commitid	s4D60mgjUjajPmDX;

1.36
date	2015.06.08.08.44.52;	author sthen;	state Exp;
branches;
next	1.35;
commitid	fpwQjZS08bdnhHwf;

1.35
date	2013.05.17.22.57.50;	author sthen;	state Exp;
branches;
next	1.34;

1.34
date	2013.03.28.20.24.53;	author sthen;	state Exp;
branches;
next	1.33;

1.33
date	2012.09.28.00.03.57;	author sthen;	state Exp;
branches;
next	1.32;

1.32
date	2012.06.07.10.39.25;	author sthen;	state Exp;
branches;
next	1.31;

1.31
date	2011.09.09.15.29.21;	author sthen;	state Exp;
branches;
next	1.30;

1.30
date	2011.01.19.11.25.16;	author sthen;	state Exp;
branches;
next	1.29;

1.29
date	2010.08.27.00.48.19;	author sthen;	state Exp;
branches;
next	1.28;

1.28
date	2010.07.25.10.08.03;	author sthen;	state Exp;
branches
	1.28.2.1;
next	1.27;

1.27
date	2010.06.18.22.10.44;	author sthen;	state Exp;
branches;
next	1.26;

1.26
date	2010.06.02.13.18.56;	author sthen;	state Exp;
branches;
next	1.25;

1.25
date	2010.04.08.16.18.00;	author sthen;	state Exp;
branches;
next	1.24;

1.24
date	2010.03.25.12.01.47;	author sthen;	state Exp;
branches;
next	1.23;

1.23
date	2010.01.17.13.18.36;	author sthen;	state Exp;
branches;
next	1.22;

1.22
date	2009.12.13.12.11.29;	author sthen;	state Exp;
branches;
next	1.21;

1.21
date	2009.11.19.16.17.05;	author sthen;	state Exp;
branches;
next	1.20;

1.20
date	2009.07.21.22.05.24;	author sthen;	state Exp;
branches;
next	1.19;

1.19
date	2009.03.29.22.23.35;	author sthen;	state Exp;
branches
	1.19.2.1;
next	1.18;

1.18
date	2008.10.07.09.57.52;	author sthen;	state Exp;
branches;
next	1.17;

1.17
date	2008.05.27.22.14.34;	author sthen;	state Exp;
branches;
next	1.16;

1.16
date	2008.04.02.23.18.11;	author sthen;	state Exp;
branches;
next	1.15;

1.15
date	2008.02.07.22.08.30;	author sthen;	state Exp;
branches;
next	1.14;

1.14
date	2007.12.19.21.07.27;	author sthen;	state Exp;
branches;
next	1.13;

1.13
date	2007.11.27.10.41.04;	author sthen;	state Exp;
branches;
next	1.12;

1.12
date	2007.10.04.11.25.44;	author sthen;	state Exp;
branches;
next	1.11;

1.11
date	2007.09.05.22.42.52;	author sthen;	state Exp;
branches;
next	1.10;

1.10
date	2007.05.02.17.29.25;	author jolan;	state Exp;
branches;
next	1.9;

1.9
date	2006.12.22.22.16.10;	author jolan;	state Exp;
branches
	1.9.2.1;
next	1.8;

1.8
date	2006.09.24.21.09.26;	author jolan;	state Exp;
branches;
next	1.7;

1.7
date	2006.06.12.19.04.10;	author naddy;	state Exp;
branches
	1.7.2.1;
next	1.6;

1.6
date	2006.02.15.06.11.39;	author sturm;	state Exp;
branches
	1.6.2.1;
next	1.5;

1.5
date	2006.02.02.03.41.36;	author todd;	state Exp;
branches;
next	1.4;

1.4
date	2005.08.15.17.36.07;	author jolan;	state Exp;
branches
	1.4.2.1;
next	1.3;

1.3
date	2005.05.09.16.50.05;	author jcs;	state Exp;
branches;
next	1.2;

1.2
date	2005.05.01.02.12.47;	author jcs;	state Exp;
branches;
next	1.1;

1.1
date	2004.09.26.00.38.24;	author jolan;	state Exp;
branches
	1.1.1.1;
next	;

1.1.1.1
date	2004.09.26.00.38.24;	author jolan;	state Exp;
branches;
next	;

1.4.2.1
date	2006.06.15.15.35.23;	author sturm;	state Exp;
branches;
next	;

1.6.2.1
date	2006.06.15.15.34.35;	author sturm;	state Exp;
branches;
next	;

1.7.2.1
date	2006.11.01.13.45.32;	author sturm;	state Exp;
branches;
next	1.7.2.2;

1.7.2.2
date	2007.05.05.08.22.00;	author sturm;	state Exp;
branches;
next	1.7.2.3;

1.7.2.3
date	2007.08.09.17.11.03;	author ajacoutot;	state Exp;
branches;
next	;

1.9.2.1
date	2007.05.05.08.23.27;	author sturm;	state Exp;
branches;
next	;

1.19.2.1
date	2009.11.23.03.42.45;	author william;	state Exp;
branches;
next	;

1.28.2.1
date	2011.01.22.09.21.56;	author sthen;	state Exp;
branches;
next	;

1.37.2.1
date	2016.05.06.19.51.59;	author sthen;	state Exp;
branches;
next	;
commitid	MNvllYhiYcbujMNc;


desc
@@


1.39
log
@update to asterisk-13.12.2, fixing a chan_sip rtptimeout problem introduced
in 13.12.1 that would cause calls to be dropped early
@
text
@$OpenBSD: patch-Makefile,v 1.38 2016/03/29 23:24:46 sthen Exp $
--- Makefile.orig	Thu Nov 10 19:34:55 2016
+++ Makefile	Fri Nov 11 10:39:52 2016
@@@@ -135,7 +135,7 @@@@ ASTTOPDIR:=$(subst $(space),\$(space),$(CURDIR))
 OVERWRITE=y
 
 # Include debug and macro symbols in the executables (-g) and profiling info (-pg)
-DEBUG=-g3
+#DEBUG=-g3
 
 # Asterisk.conf is located in ASTETCDIR or by using the -C flag
 # when starting Asterisk
@@@@ -190,7 +190,9 @@@@ endif
 
 ifeq ($(findstring -save-temps,$(_ASTCFLAGS) $(ASTCFLAGS)),)
   ifeq ($(findstring -pipe,$(_ASTCFLAGS) $(ASTCFLAGS)),)
+    ifneq ($(OSARCH),OpenBSD)
     _ASTCFLAGS+=-pipe
+    endif
   endif
 endif
 
@


1.38
log
@update to asterisk-13.8.0
@
text
@d1 4
a4 4
$OpenBSD: patch-Makefile,v 1.37 2015/10/12 22:07:29 sthen Exp $
--- Makefile.orig	Tue Mar 29 20:39:33 2016
+++ Makefile	Tue Mar 29 23:51:01 2016
@@@@ -131,7 +131,7 @@@@ ASTTOPDIR:=$(subst $(space),\$(space),$(CURDIR))
d13 1
a13 1
@@@@ -186,7 +186,9 @@@@ endif
@


1.37
log
@update to asterisk-13.6.0

this is a major update - upgrading users should review UPGRADE-12.txt and
UPGRADE.txt in /usr/local/share/doc/asterisk. some configurations will work
unchanged, but there have been big changes in other areas, notably AMI,
CDR and CEL.
@
text
@d1 4
a4 4
$OpenBSD$
--- Makefile.orig	Fri Aug  7 20:14:21 2015
+++ Makefile	Fri Oct  9 15:30:56 2015
@@@@ -128,7 +128,7 @@@@ ASTTOPDIR:=$(subst $(space),\$(space),$(CURDIR))
d13 1
a13 1
@@@@ -183,7 +183,9 @@@@ endif
@


1.37.2.1
log
@MFC update to asterisk-13.8.2, includes some crashes and DoS issues with pjsip
fixed in 13.8.1 and other small fixes
@
text
@d1 4
a4 4
$OpenBSD: patch-Makefile,v 1.38 2016/03/29 23:24:46 sthen Exp $
--- Makefile.orig	Tue Mar 29 20:39:33 2016
+++ Makefile	Tue Mar 29 23:51:01 2016
@@@@ -131,7 +131,7 @@@@ ASTTOPDIR:=$(subst $(space),\$(space),$(CURDIR))
d13 1
a13 1
@@@@ -186,7 +186,9 @@@@ endif
@


1.36
log
@update to asterisk-11.18.0
@
text
@d1 4
a4 4
$OpenBSD: patch-Makefile,v 1.35 2013/05/17 22:57:50 sthen Exp $
--- Makefile.orig	Thu Jun  4 01:44:42 2015
+++ Makefile	Fri Jun  5 10:41:19 2015
@@@@ -126,7 +126,7 @@@@ ASTTOPDIR:=$(subst $(space),\$(space),$(CURDIR))
d13 1
a13 1
@@@@ -178,7 +178,9 @@@@ endif
@


1.35
log
@update to Asterisk 11.4.0, lots of fixes
@
text
@d1 3
a3 3
$OpenBSD: patch-Makefile,v 1.34 2013/03/28 20:24:53 sthen Exp $
--- Makefile.orig	Mon Feb  4 19:50:52 2013
+++ Makefile	Tue Apr  9 15:46:38 2013
d13 1
a13 12
@@@@ -155,8 +155,10 @@@@ LINKER_SYMBOL_PREFIX=
 # The file /etc/asterisk.makeopts will also be included but can be overridden
 # by the file in your home directory.
 
+ifneq ($(OSARCH),OpenBSD)
 GLOBAL_MAKEOPTS=$(wildcard /etc/asterisk.makeopts)
 USER_MAKEOPTS=$(wildcard ~/.asterisk.makeopts)
+endif
 
 MOD_SUBDIR_CFLAGS="-I$(ASTTOPDIR)/include"
 OTHER_SUBDIR_CFLAGS="-I$(ASTTOPDIR)/include"
@@@@ -171,7 +173,9 @@@@ endif
@


1.34
log
@update to Asterisk 11.3.0, various testing by myself and chris@@

- this is a major version update to the new long-term support version
- please review UPGRADE.txt
@
text
@d1 4
a4 4
$OpenBSD: patch-Makefile,v 1.33 2012/09/28 00:03:57 sthen Exp $
--- Makefile.orig	Tue Sep 18 16:47:01 2012
+++ Makefile	Fri Oct 26 14:17:03 2012
@@@@ -131,7 +131,7 @@@@ ASTTOPDIR:=$(subst $(space),\$(space),$(CURDIR))
d13 1
a13 1
@@@@ -160,8 +160,10 @@@@ LINKER_SYMBOL_PREFIX=
d24 1
a24 1
@@@@ -176,7 +178,9 @@@@ endif
@


1.33
log
@Update the asterisk port to 10.8.0 - This is a major update, notable changes:

- If using ConfBridge, note that the dialplan arguments have changed.

- If using the built-in HTTP server, note that a bindaddr must now be given,
previously the default was 0.0.0.0 but this must now be given explicitly.

- Internal database now uses SQLite3 not BDB, conversion tools are provided.

See share/doc/asterisk/UPGRADE.txt for more.
@
text
@d1 4
a4 4
$OpenBSD: patch-Makefile,v 1.31 2011/09/09 15:29:21 sthen Exp $
--- Makefile.orig	Wed Jun 13 15:30:34 2012
+++ Makefile	Tue Sep 18 23:47:38 2012
@@@@ -123,7 +123,7 @@@@ ASTTOPDIR:=$(subst $(space),\$(space),$(CURDIR))
d13 1
a13 1
@@@@ -153,8 +153,10 @@@@ LINKER_SYMBOL_PREFIX=
d24 1
a24 1
@@@@ -164,7 +166,9 @@@@ OPTIONS=
@


1.32
log
@bugfix update to Asterisk 1.8.13.0
@
text
@d2 3
a4 3
--- Makefile.orig	Thu Apr 12 15:26:06 2012
+++ Makefile	Wed Jun  6 21:57:09 2012
@@@@ -121,7 +121,7 @@@@ ASTTOPDIR:=$(subst $(space),\$(space),$(CURDIR))
d13 1
a13 1
@@@@ -151,8 +151,10 @@@@ LINKER_SYMBOL_PREFIX=
d24 1
a24 1
@@@@ -162,7 +164,9 @@@@ OPTIONS=
@


1.31
log
@update to asterisk 1.8.6.0
@
text
@d1 4
a4 4
$OpenBSD: patch-Makefile,v 1.30 2011/01/19 11:25:16 sthen Exp $
--- Makefile.orig	Thu Aug 25 20:08:04 2011
+++ Makefile	Thu Sep  1 10:37:01 2011
@@@@ -122,7 +122,7 @@@@ ASTTOPDIR:=$(subst $(space),\$(space),$(CURDIR))
d13 1
a13 1
@@@@ -152,8 +152,10 @@@@ LINKER_SYMBOL_PREFIX=
d24 1
a24 1
@@@@ -196,7 +198,9 @@@@ endif
a29 10
+    endif
   endif
 endif
 
@@@@ -222,7 +226,9 @@@@ endif
 
 ifeq ($(findstring -march,$(_ASTCFLAGS) $(ASTCFLAGS)),)
   ifneq ($(PROC),ultrasparc)
+    ifneq ($(OSARCH),OpenBSD)
     _ASTCFLAGS+=$(shell if $(CC) -march=$(PROC) -S -o /dev/null -xc /dev/null >/dev/null 2>&1; then echo "-march=$(PROC)"; fi)
@


1.30
log
@SECURITY update to asterisk 1.8.2.1, fixes AST-2011-001 "an issue
when forming an outgoing SIP request while in pedantic mode, which
can cause a stack buffer to be made to overflow if supplied with
carefully crafted caller ID information"

http://downloads.asterisk.org/pub/security/AST-2011-001.html

This is also a major version update to the long-term support
1.8 branch, previous versions of this diff have been tested by
various ports@@ readers, thanks for testing.

Please review /usr/local/share/doc/asterisk/UPGRADE.txt
(also note that memory use has increased).

ok ajacoutot@@ jasper@@
@
text
@d1 3
a3 3
$OpenBSD: patch-Makefile,v 1.28 2010/07/25 10:08:03 sthen Exp $
--- Makefile.orig	Tue Sep 28 19:18:43 2010
+++ Makefile	Mon Oct 11 14:53:46 2010
d22 2
a23 2
 MOD_SUBDIR_CFLAGS=-I$(ASTTOPDIR)/include
 OTHER_SUBDIR_CFLAGS=-I$(ASTTOPDIR)/include
@


1.29
log
@readd missing _ from user/group names in sample config. spotted by Brad.
@
text
@d2 3
a4 3
--- Makefile.orig	Thu Jun 10 21:35:06 2010
+++ Makefile	Wed Jun 30 15:25:51 2010
@@@@ -121,7 +121,7 @@@@ ASTTOPDIR:=$(subst $(space),\$(space),$(CURDIR))
d11 3
a13 3
 
 # Define standard directories for various platforms
@@@@ -181,8 +181,10 @@@@ HTTP_CGIDIR=/var/www/cgi-bin
d24 1
a24 1
@@@@ -225,7 +227,9 @@@@ endif
d34 1
a34 1
@@@@ -251,7 +255,9 @@@@ endif
a43 26
@@@@ -728,18 +734,18 @@@@ samples: adsi
 		echo "                        ; temporary codec translation path for a channel that may not otherwise require one." ; \
 		echo ";transcode_via_sln = yes ; Build transcode paths via SLINEAR, instead of directly" ; \
 		echo ";sendfullybooted = yes  ; Send the FullyBooted AMI event on AMI login and when all modules are finished loading" ; \
-		echo ";runuser = asterisk ; The user to run as" ; \
-		echo ";rungroup = asterisk ; The group to run as" ; \
+		echo "runuser = _asterisk ; The user to run as" ; \
+		echo "rungroup = _asterisk ; The group to run as" ; \
 		echo ";lightbackground = yes ; If your terminal is set for a light-colored background" ; \
 		echo "documentation_language = en_US ; Set the Language you want Documentation displayed in. Value is in the same format as locale names" ; \
 		echo ";hideconnect = yes ; Hide messages displayed when a remote console connects and disconnects" ; \
 		echo "" ; \
 		echo "; Changing the following lines may compromise your security." ; \
-		echo ";[files]" ; \
-		echo ";astctlpermissions = 0660" ; \
-		echo ";astctlowner = root" ; \
-		echo ";astctlgroup = apache" ; \
-		echo ";astctl = asterisk.ctl" ; \
+		echo "[files]" ; \
+		echo "astctlpermissions = 0660" ; \
+		echo "astctlowner = _asterisk" ; \
+		echo "astctlgroup = wheel" ; \
+		echo "astctl = asterisk.ctl" ; \
 		echo "" ; \
 		echo "[compat]" ; \
 		echo "pbx_realtime=1.6" ; \
@


1.28
log
@update to 1.6.2.10, switch to new LIB_DEPENDS etc.
@
text
@d1 1
a1 1
$OpenBSD: patch-Makefile,v 1.27 2010/06/18 22:10:44 sthen Exp $
d50 2
a51 2
+		echo "runuser = asterisk ; The user to run as" ; \
+		echo "rungroup = asterisk ; The group to run as" ; \
@


1.28.2.1
log
@- Add a patch to -stable to fix the AST-2011-001 security problem
(a stack buffer overflow in URI encoding, triggered by crafted caller
ID information when generating outgoing SIP calls, by the uriencode
dialplan function, and possibly with the AGI dialplan application).
http://downloads.asterisk.org/pub/security/AST-2011-001.html

- MFC: use correct user/group names in sample config.

ok william@@ ajacoutot@@
@
text
@d1 1
a1 1
$OpenBSD: patch-Makefile,v 1.28 2010/07/25 10:08:03 sthen Exp $
d50 2
a51 2
+		echo "runuser = _asterisk ; The user to run as" ; \
+		echo "rungroup = _asterisk ; The group to run as" ; \
@


1.27
log
@update to 1.6.2.9; various crash fixes (including one with dtmf detection)
@
text
@d1 3
a3 3
$OpenBSD: patch-Makefile,v 1.26 2010/06/02 13:18:56 sthen Exp $
--- Makefile.orig	Tue May 25 00:52:48 2010
+++ Makefile	Wed Jun  9 21:31:32 2010
d13 1
a13 1
@@@@ -183,8 +183,10 @@@@ HTTP_CGIDIR=/var/www/cgi-bin
d24 1
a24 1
@@@@ -227,7 +229,9 @@@@ endif
d34 1
a34 1
@@@@ -253,7 +257,9 @@@@ endif
d44 1
a44 1
@@@@ -731,18 +737,18 @@@@ samples: adsi
@


1.26
log
@update to 1.6.2.8
@
text
@d1 3
a3 3
$OpenBSD: patch-Makefile,v 1.25 2010/04/08 16:18:00 sthen Exp $
--- Makefile.orig	Mon May  3 18:42:36 2010
+++ Makefile	Tue Jun  1 22:23:41 2010
d44 1
a44 2
@@@@ -730,18 +736,18 @@@@ samples: adsi
 		echo "                        ; to the device.  It is for this reason that this is optional, as it may result in requiring a" ; \
d47 1
d50 2
a51 2
+		echo "runuser = _asterisk ; The user to run as" ; \
+		echo "rungroup = _asterisk ; The group to run as" ; \
@


1.25
log
@Update Asterisk to 1.6.2.6, which will be the only of the 1.6.x branches
receiving most updates in the future; notably, compared to the in-tree
version, this adds a portable (pthread-based) clocking source rather
than relying on a non-portable zaptel timer.

Main functions tested and working well for myself and Diego Casati (thanks!)
Note that ConfBridge (added since 1.6.0) may need more work
@
text
@d1 4
a4 4
$OpenBSD: patch-Makefile,v 1.24 2010/03/25 12:01:47 sthen Exp $
--- Makefile.orig	Thu Feb 18 04:21:31 2010
+++ Makefile	Fri Apr  2 00:59:18 2010
@@@@ -122,7 +122,7 @@@@ ASTTOPDIR:=$(subst $(space),\$(space),$(CURDIR))
d13 1
a13 1
@@@@ -184,8 +184,10 @@@@ HTTP_CGIDIR=/var/www/cgi-bin
d24 1
a24 1
@@@@ -228,7 +230,9 @@@@ endif
d34 1
a34 1
@@@@ -254,7 +258,9 @@@@ endif
d44 1
a44 1
@@@@ -733,18 +739,18 @@@@ samples: adsi
@


1.24
log
@update to 1.6.0.26 + a patch from a ticket upstream.
@
text
@d1 4
a4 4
$OpenBSD: patch-Makefile,v 1.23 2010/01/17 13:18:36 sthen Exp $
--- Makefile.orig	Thu Feb 18 04:20:42 2010
+++ Makefile	Fri Mar 12 20:54:09 2010
@@@@ -119,7 +119,7 @@@@ ASTTOPDIR:=$(subst $(space),\$(space),$(CURDIR))
d13 1
a13 1
@@@@ -181,8 +181,10 @@@@ HTTP_CGIDIR=/var/www/cgi-bin
d24 1
a24 1
@@@@ -225,7 +227,9 @@@@ endif
d34 1
a34 2
@@@@ -250,7 +254,9 @@@@ ifneq ($(findstring BSD,$(OSARCH)),)
 endif
d36 6
a41 4
 ifneq ($(PROC),ultrasparc)
+  ifneq ($(OSARCH),OpenBSD)
   _ASTCFLAGS+=$(shell if $(CC) -march=$(PROC) -S -o /dev/null -xc /dev/null >/dev/null 2>&1; then echo "-march=$(PROC)"; fi)
+  endif
d44 1
a44 11
 ifeq ($(PROC),ppc)
@@@@ -661,7 +667,7 @@@@ samples: adsi
 		echo "astrundir => $(ASTVARRUNDIR)" ; \
 		echo "astlogdir => $(ASTLOGDIR)" ; \
 		echo "" ; \
-		echo ";[options]" ; \
+		echo "[options]" ; \
 		echo ";verbose = 3" ; \
 		echo ";debug = 3" ; \
 		echo ";alwaysfork = yes ; same as -F at startup" ; \
@@@@ -692,15 +698,15 @@@@ samples: adsi
d52 3
@


1.23
log
@Update to 1.6.0.21, various bugs (including some crashes) fixed.
This also has a small change in CDR generation, it's been well tested
upstream but still this can be a touchy area to change, so it's
going in now so the first OpenBSD release with Asterisk 1.6
packages has the change already made.

ok ajacoutot@@
@
text
@d1 4
a4 4
$OpenBSD: patch-Makefile,v 1.22 2009/12/13 12:11:29 sthen Exp $
--- Makefile.orig	Thu Dec 10 21:02:59 2009
+++ Makefile	Fri Jan 15 16:13:10 2010
@@@@ -118,7 +118,7 @@@@ ASTTOPDIR:=$(subst $(space),\$(space),$(CURDIR))
d13 1
a13 1
@@@@ -180,8 +180,10 @@@@ HTTP_CGIDIR=/var/www/cgi-bin
d24 1
a24 1
@@@@ -224,7 +226,9 @@@@ endif
d34 1
a34 1
@@@@ -249,7 +253,9 @@@@ ifneq ($(findstring BSD,$(OSARCH)),)
d44 1
a44 1
@@@@ -658,7 +664,7 @@@@ samples: adsi
d53 3
a55 3
@@@@ -685,15 +691,15 @@@@ samples: adsi
 		echo ";transmit_silence_during_record = yes ; Transmit SLINEAR silence while a channel is being recorded" ; \
 		echo ";transmit_silence = yes ; Transmit SLINEAR silence while a channel is being recorded or DTMF is being generated" ; \
@


1.22
log
@Major version update to 1.6.0.19. For more information about the
upgrade, see /usr/local/share/doc/asterisk/UPGRADE-1.6.txt

Particular thanks to fgsch@@, ian@@ and Michiel van Baak for help and testing.
@
text
@d1 3
a3 3
$OpenBSD$
--- Makefile.orig	Thu Sep 24 19:22:07 2009
+++ Makefile	Wed Oct  7 16:49:21 2009
d44 1
a44 1
@@@@ -657,7 +663,7 @@@@ samples: adsi
d53 1
a53 1
@@@@ -684,15 +690,15 @@@@ samples: adsi
@


1.21
log
@update to 1.4.27, I'll soon be committing a 1.6.0 version but first let's
have the latest 1.4 for people who don't want to move yet.
@
text
@d1 4
a4 21
$OpenBSD: patch-Makefile,v 1.20 2009/07/21 22:05:24 sthen Exp $
--- Makefile.orig	Fri Oct 23 15:00:01 2009
+++ Makefile	Thu Nov 19 15:09:24 2009
@@@@ -41,6 +41,7 @@@@ export ASTVARRUNDIR
 export MODULES_DIR
 export ASTSPOOLDIR
 export ASTVARLIBDIR
+export ASTDBDIR
 export ASTDATADIR
 export ASTLOGDIR
 export ASTLIBDIR
@@@@ -88,7 +89,7 @@@@ ASTCFLAGS+=$(COPTS)
 ASTLDFLAGS+=$(LDOPTS)
 
 #Uncomment this to see all build commands instead of 'quiet' output
-#NOISY_BUILD=yes
+NOISY_BUILD=yes
 
 # Create OPTIONS variable
 OPTIONS=
@@@@ -101,7 +102,7 @@@@ ASTTOPDIR:=$(subst $(space),\$(space),$(CURDIR))
d9 1
a9 1
+DEBUG?=-g3
d11 3
a13 11
 # Staging directory
 # Files are copied here temporarily during the install process
@@@@ -136,6 +137,7 @@@@ else
 ifneq ($(findstring BSD,$(OSARCH)),)
   ASTVARLIBDIR=$(prefix)/share/asterisk
   ASTVARRUNDIR=$(localstatedir)/run/asterisk
+  ASTDBDIR=$(localstatedir)/db/asterisk
 else
   ASTVARLIBDIR=$(localstatedir)/lib/asterisk
 endif
@@@@ -164,8 +166,10 @@@@ HTTP_CGIDIR=/var/www/cgi-bin
d24 1
a24 2
@@@@ -204,8 +208,10 @@@@ ifeq ($(OSARCH),linux-gnu)
 endif
d27 5
a31 2
+ifneq ($(OSARCH),OpenBSD)
 _ASTCFLAGS+=-pipe
a32 1
+endif
d34 1
a34 3
 _ASTCFLAGS+=-Wall -Wstrict-prototypes -Wmissing-prototypes -Wmissing-declarations $(DEBUG)
 
@@@@ -226,8 +232,10 @@@@ ifneq ($(findstring BSD,$(OSARCH)),)
d38 1
a38 1
+ifneq ($(OSARCH),OpenBSD)
d40 1
a41 1
+endif
d44 10
a53 10
   _ASTCFLAGS+=-fsigned-char
@@@@ -589,6 +597,7 @@@@ samples: adsi
 		echo "astetcdir => $(ASTETCDIR)" ; \
 		echo "astmoddir => $(MODULES_DIR)" ; \
 		echo "astvarlibdir => $(ASTVARLIBDIR)" ; \
+		echo "astdbdir => $(ASTDBDIR)" ; \
 		echo "astdatadir => $(ASTDATADIR)" ; \
 		echo "astagidir => $(AGI_DIR)" ; \
 		echo "astspooldir => $(ASTSPOOLDIR)" ; \
@@@@ -619,16 +628,16 @@@@ samples: adsi
a60 1
 		echo ";dahdichanname = yes ; Channels created by chan_dahdi will be called 'DAHDI', otherwise 'Zap'" ; \
d73 3
a75 3
 		) > $(DESTDIR)$(ASTCONFPATH) ; \
 	else \
 		echo "Skipping asterisk.conf creation"; \
@


1.20
log
@bugfix update to 1.4.26; see http://www.asterisk.org/node/48610
@
text
@d1 4
a4 4
$OpenBSD: patch-Makefile,v 1.19 2009/03/29 22:23:35 sthen Exp $
--- Makefile.orig	Thu Jun 11 23:20:31 2009
+++ Makefile	Thu Jun 18 20:50:45 2009
@@@@ -35,6 +35,7 @@@@ export ASTVARRUNDIR
d12 1
a12 1
@@@@ -82,7 +83,7 @@@@ ASTCFLAGS+=$(COPTS)
d21 1
a21 1
@@@@ -95,7 +96,7 @@@@ ASTTOPDIR:=$(subst $(space),\$(space),$(CURDIR))
d30 1
a30 1
@@@@ -130,6 +131,7 @@@@ else
d38 1
a38 1
@@@@ -158,8 +160,10 @@@@ HTTP_CGIDIR=/var/www/cgi-bin
d49 1
a49 1
@@@@ -198,8 +202,10 @@@@ ifeq ($(OSARCH),linux-gnu)
d52 1
a52 1
 ifeq ($(findstring -save-temps,$(ASTCFLAGS)),)
d54 1
a54 1
 ASTCFLAGS+=-pipe
d58 1
a58 1
 ASTCFLAGS+=-Wall -Wstrict-prototypes -Wmissing-prototypes -Wmissing-declarations $(DEBUG)
d60 1
a60 2
@@@@ -219,9 +225,11 @@@@ ifneq ($(findstring BSD,$(OSARCH)),)
   ASTLDFLAGS+=-L/usr/local/lib
d63 1
d65 1
a65 2
 ifneq ($(PROC),ultrasparc)
   ASTCFLAGS+=$(shell if $(CC) -march=$(PROC) -S -o /dev/null -xc /dev/null >/dev/null 2>&1; then echo "-march=$(PROC)"; fi)
d70 2
a71 11
   ASTCFLAGS+=-fsigned-char
@@@@ -404,7 +412,7 @@@@ distclean: $(SUBDIRS_DIST_CLEAN) _clean
 	rm -f build_tools/menuselect-deps
 
 datafiles: _all
-	if [ x`$(ID) -un` = xroot ]; then CFLAGS="$(ASTCFLAGS)" bash build_tools/mkpkgconfig $(DESTDIR)/usr/lib/pkgconfig; fi
+	if [ x`$(ID) -un` = xroot ]; then CFLAGS="$(ASTCFLAGS)" ksh build_tools/mkpkgconfig $(DESTDIR)/usr/lib/pkgconfig; fi
 # Should static HTTP be installed during make samples or even with its own target ala
 # webvoicemail?  There are portions here that *could* be customized but might also be
 # improved a lot.  I'll put it here for now.
@@@@ -581,6 +589,7 @@@@ samples: adsi
d79 1
a79 1
@@@@ -611,16 +620,16 @@@@ samples: adsi
@


1.19
log
@maintenance update to 1.4.24
@
text
@d1 3
a3 3
$OpenBSD: patch-Makefile,v 1.18 2008/10/07 09:57:52 sthen Exp $
--- Makefile.orig	Sat Nov 29 16:58:29 2008
+++ Makefile	Wed Feb 18 20:05:57 2009
d72 9
@


1.19.2.1
log
@MFC:

SECURITY UPDATE

asterisk-1.4.27

Resolves multiple security issues

ok sthen@@ jasper@@
@
text
@d1 4
a4 4
$OpenBSD: patch-Makefile,v 1.19 2009/03/29 22:23:35 sthen Exp $
--- Makefile.orig	Fri Oct 23 15:00:01 2009
+++ Makefile	Thu Nov 19 15:09:24 2009
@@@@ -41,6 +41,7 @@@@ export ASTVARRUNDIR
d12 1
a12 1
@@@@ -88,7 +89,7 @@@@ ASTCFLAGS+=$(COPTS)
d21 1
a21 1
@@@@ -101,7 +102,7 @@@@ ASTTOPDIR:=$(subst $(space),\$(space),$(CURDIR))
d30 1
a30 1
@@@@ -136,6 +137,7 @@@@ else
d38 1
a38 1
@@@@ -164,8 +166,10 @@@@ HTTP_CGIDIR=/var/www/cgi-bin
d49 1
a49 1
@@@@ -204,8 +208,10 @@@@ ifeq ($(OSARCH),linux-gnu)
d52 1
a52 1
 ifeq ($(findstring -save-temps,$(_ASTCFLAGS) $(ASTCFLAGS)),)
d54 1
a54 1
 _ASTCFLAGS+=-pipe
d58 1
a58 1
 _ASTCFLAGS+=-Wall -Wstrict-prototypes -Wmissing-prototypes -Wmissing-declarations $(DEBUG)
d60 2
a61 1
@@@@ -226,8 +232,10 @@@@ ifneq ($(findstring BSD,$(OSARCH)),)
d64 1
d66 1
a66 2
+ifneq ($(OSARCH),OpenBSD)
   _ASTCFLAGS+=$(shell if $(CC) -march=$(PROC) -S -o /dev/null -xc /dev/null >/dev/null 2>&1; then echo "-march=$(PROC)"; fi)
d71 2
a72 2
   _ASTCFLAGS+=-fsigned-char
@@@@ -589,6 +597,7 @@@@ samples: adsi
d80 1
a80 1
@@@@ -619,16 +628,16 @@@@ samples: adsi
@


1.18
log
@maintenance update to 1.4.22; many fixes.
@
text
@d1 3
a3 3
$OpenBSD: patch-Makefile,v 1.17 2008/05/27 22:14:34 sthen Exp $
--- Makefile.orig	Mon Sep  8 21:15:42 2008
+++ Makefile	Thu Oct  2 22:54:53 2008
d60 1
a60 1
@@@@ -214,9 +220,11 @@@@ ifneq ($(findstring BSD,$(OSARCH)),)
d72 1
a72 1
@@@@ -574,6 +582,7 @@@@ samples: adsi
d80 1
a80 1
@@@@ -604,16 +613,16 @@@@ samples: adsi
@


1.17
log
@update to 1.4.20.1; thanks to Pedro la Peu for additional testing.
@
text
@d1 3
a3 3
$OpenBSD: patch-Makefile,v 1.16 2008/04/02 23:18:11 sthen Exp $
--- Makefile.orig	Mon May  5 21:17:55 2008
+++ Makefile	Wed May 21 01:24:30 2008
d72 1
a72 1
@@@@ -575,13 +583,14 @@@@ samples: adsi
d80 1
a80 9
 		echo "astrundir => $(ASTVARRUNDIR)" ; \
 		echo "astlogdir => $(ASTLOGDIR)" ; \
 		echo "" ; \
-		echo ";[options]" ; \
+		echo "[options]" ; \
 		echo ";verbose = 3" ; \
 		echo ";debug = 3" ; \
 		echo ";alwaysfork = yes ; same as -F at startup" ; \
@@@@ -605,15 +614,15 @@@@ samples: adsi
d88 1
@


1.16
log
@update to 1.4.19
ok ian@@
@
text
@d1 3
a3 3
$OpenBSD: patch-Makefile,v 1.15 2008/02/07 22:08:30 sthen Exp $
--- Makefile.orig	Tue Mar 25 14:37:35 2008
+++ Makefile	Fri Mar 28 23:41:28 2008
d72 1
a72 1
@@@@ -573,13 +581,14 @@@@ samples: adsi
d88 1
a88 1
@@@@ -603,15 +612,15 @@@@ samples: adsi
@


1.15
log
@update asterisk to 1.4.18 (following testing during RC period)
ok jolan
@
text
@d1 3
a3 3
$OpenBSD: patch-Makefile,v 1.14 2007/12/19 21:07:27 sthen Exp $
--- Makefile.orig	Tue Jan 29 17:21:33 2008
+++ Makefile	Wed Jan 30 22:22:58 2008
d72 1
a72 1
@@@@ -566,13 +574,14 @@@@ samples: adsi
d88 1
a88 2
@@@@ -595,15 +604,15 @@@@ samples: adsi
 		echo ";record_cache_dir = /tmp ; Specify cache directory (used in cnjunction with cache_record_files)" ; \
d90 1
@


1.14
log
@SECURITY update to 1.4.17, fixes AST-2007-027 (passwordless sip/iax peers,
configured from "realtime" database rather than static .conf files, are not
subject to IP address restrictions).

ok ian
@
text
@d1 3
a3 3
$OpenBSD: patch-Makefile,v 1.13 2007/11/27 10:41:04 sthen Exp $
--- Makefile.orig	Mon Dec 17 06:44:51 2007
+++ Makefile	Tue Dec 18 22:20:14 2007
d21 1
a21 1
@@@@ -93,7 +94,7 @@@@ ASTTOPDIR:=$(shell pwd)
d30 1
a30 1
@@@@ -128,6 +129,7 @@@@ else
d38 1
a38 1
@@@@ -156,8 +158,10 @@@@ HTTP_CGIDIR=/var/www/cgi-bin
d49 1
a49 1
@@@@ -196,8 +200,10 @@@@ ifeq ($(OSARCH),linux-gnu)
d60 1
a60 1
@@@@ -212,9 +218,11 @@@@ ifneq ($(findstring BSD,$(OSARCH)),)
d72 1
a72 1
@@@@ -564,13 +572,14 @@@@ samples: adsi
d88 1
a88 1
@@@@ -593,15 +602,15 @@@@ samples: adsi
@


1.13
log
@update Asterisk to 1.4.14 (with many bug fixes), and h323 flavor
(for interactive builds only).

ok jolan, ian
@
text
@d1 3
a3 3
$OpenBSD: patch-Makefile,v 1.12 2007/10/04 11:25:44 sthen Exp $
--- Makefile.orig	Thu Nov 15 18:37:38 2007
+++ Makefile	Sat Nov 17 00:58:06 2007
d12 1
a12 1
@@@@ -81,7 +82,7 @@@@ ASTCFLAGS+=$(COPTS)
d21 1
a21 1
@@@@ -92,7 +93,7 @@@@ ASTTOPDIR:=$(shell pwd)
d30 1
a30 1
@@@@ -127,6 +128,7 @@@@ else
d38 1
a38 1
@@@@ -155,8 +157,10 @@@@ HTTP_CGIDIR=/var/www/cgi-bin
d49 1
a49 1
@@@@ -195,8 +199,10 @@@@ ifeq ($(OSARCH),linux-gnu)
d60 1
a60 1
@@@@ -211,9 +217,11 @@@@ ifneq ($(findstring BSD,$(OSARCH)),)
d72 1
a72 1
@@@@ -556,13 +564,14 @@@@ samples: adsi
d88 1
a88 1
@@@@ -585,15 +594,15 @@@@ samples: adsi
@


1.12
log
@bug-fix update to 1.4.12

ok ian@@
@
text
@d1 3
a3 3
$OpenBSD: patch-Makefile,v 1.11 2007/09/05 22:42:52 sthen Exp $
--- Makefile.orig	Tue Oct  2 21:06:07 2007
+++ Makefile	Wed Oct  3 12:50:21 2007
d49 1
a49 2
@@@@ -194,7 +198,7 @@@@ ifeq ($(OSARCH),linux-gnu)
   endif
d52 5
a56 2
-ASTCFLAGS+=-pipe -Wall -Wstrict-prototypes -Wmissing-prototypes -Wmissing-declarations $(DEBUG)
+ASTCFLAGS+=-Wall -Wstrict-prototypes -Wmissing-prototypes -Wmissing-declarations $(DEBUG)
d58 1
a58 1
 ASTCFLAGS+=-include $(ASTTOPDIR)/include/asterisk/autoconfig.h
d60 1
a60 1
@@@@ -207,9 +211,11 @@@@ ifneq ($(findstring BSD,$(OSARCH)),)
d72 1
a72 1
@@@@ -552,21 +558,25 @@@@ samples: adsi
d85 12
a96 2
 		echo ";internal_timing = yes" ; \
 		echo ";systemname = my_system_name ; prefix uniqueid with a system name for global uniqueness issues" ; \
a102 3
+		echo "runuser => _asterisk" ; \
+		echo "rungroup => _asterisk" ; \
+		echo "" ; \
@


1.11
log
@major version update to 1.4.11, ok ian@@ jolan@@
@
text
@d1 3
a3 3
$OpenBSD$
--- Makefile.orig	Fri Aug 10 00:10:46 2007
+++ Makefile	Wed Aug 15 22:17:33 2007
d12 2
a13 2
@@@@ -74,7 +75,7 @@@@ ifneq ($(wildcard makeopts),)
 endif
d21 1
a21 1
@@@@ -85,7 +86,7 @@@@ ASTTOPDIR:=$(shell pwd)
d30 1
a30 1
@@@@ -120,6 +121,7 @@@@ else
d38 1
a38 1
@@@@ -148,8 +150,10 @@@@ HTTP_CGIDIR=/var/www/cgi-bin
d49 1
a49 1
@@@@ -187,7 +191,7 @@@@ ifeq ($(OSARCH),linux-gnu)
d58 1
a58 1
@@@@ -200,9 +204,11 @@@@ ifneq ($(findstring BSD,$(OSARCH)),)
d70 1
a70 1
@@@@ -541,21 +547,25 @@@@ samples: adsi
@


1.10
log
@SECURITY: update to 1.2.18 from maintainer stuart henderson

ASA-2007-011: Multiple problems in SIP channel parser handling response
codes
ASA-2007-012: Remote Crash Vulnerability in Manager Interface
@
text
@d1 12
a12 22
$OpenBSD: patch-Makefile,v 1.9 2006/12/22 22:16:10 jolan Exp $
--- Makefile.orig	Wed Jan 10 02:16:45 2007
+++ Makefile	Wed Apr 25 09:51:58 2007
@@@@ -19,8 +19,8 @@@@ OPTIONS=
 # CROSS_COMPILE=/opt/montavista/pro/devkit/arm/xscale_be/bin/xscale_be-
 # CROSS_COMPILE_BIN=/opt/montavista/pro/devkit/arm/xscale_be/bin/
 # CROSS_COMPILE_TARGET=/opt/montavista/pro/devkit/arm/xscale_be/target
-CC=$(CROSS_COMPILE)gcc
-HOST_CC=gcc
+CC?=$(CROSS_COMPILE)gcc
+HOST_CC=$(CC)
 # CROSS_ARCH=Linux
 # CROSS_PROC=arm
 # SUB_PROC=xscale # or maverick
@@@@ -47,8 +47,12 @@@@ ifneq ($(findstring dont-optimize,$(MAKECMDGOALS)),don
 #K6OPT  = -DK6OPT
 
 #Tell gcc to optimize the code
+ifeq (${OSARCH},OpenBSD)
+OPTIMIZE+=-O2
+else
 OPTIMIZE+=-O6
a13 1
+endif
d15 7
a21 1
 #Overwite config files on "make samples"
a22 1
@@@@ -88,7 +92,11 @@@@ INSTALL=install
d24 3
a26 7
 # Where to install asterisk after compiling
 # Default -> leave empty
+ifeq (${OSARCH},OpenBSD)
+INSTALL_PREFIX= ${TRUEPREFIX}
+else
 INSTALL_PREFIX?=
+endif
d30 10
a39 38
@@@@ -110,7 +118,7 @@@@ BUSYDETECT+= #-DBUSYDETECT_TONEONLY
 # Don't use together with -DBUSYDETECT_TONEONLY
 BUSYDETECT+= #-DBUSYDETECT_COMPARE_TONE_AND_SILENCE
 
-ifneq ($(OSARCH),SunOS)
+ifeq ($(OSARCH),Linux)
   ASTLIBDIR=$(INSTALL_PREFIX)/usr/lib/asterisk
   ASTVARLIBDIR=$(INSTALL_PREFIX)/var/lib/asterisk
   ASTETCDIR=$(INSTALL_PREFIX)/etc/asterisk
@@@@ -124,7 +132,25 @@@@ ifneq ($(OSARCH),SunOS)
   ASTMANDIR=$(INSTALL_PREFIX)/usr/share/man
   MODULES_DIR=$(ASTLIBDIR)/modules
   AGI_DIR=$(ASTVARLIBDIR)/agi-bin
-else
+endif
+# OpenBSD has its own packaging mechanism
+ifeq ($(OSARCH),OpenBSD)
+  ASTLIBDIR=$(INSTALL_PREFIX)/lib/asterisk
+  ASTVARLIBDIR=$(INSTALL_PREFIX)/share/asterisk
+  ASTETCDIR=${SYSCONFDIR}/asterisk
+  ASTSPOOLDIR=/var/spool/asterisk
+  ASTLOGDIR=/var/log/asterisk
+  ASTHEADERDIR=$(INSTALL_PREFIX)/include/asterisk
+  ASTCONFPATH=$(ASTETCDIR)/asterisk.conf
+  ASTBINDIR=$(INSTALL_PREFIX)/bin
+  ASTSBINDIR=$(INSTALL_PREFIX)/sbin
+  ASTVARRUNDIR=/var/db/asterisk
+  ASTMANDIR=$(INSTALL_PREFIX)/man
+  
+  MODULES_DIR=$(ASTLIBDIR)/modules
+  AGI_DIR=$(INSTALL_PREFIX)/share/examples/asterisk/agi
+endif
+ifeq ($(OSARCH),SunOS)
   ASTLIBDIR=$(INSTALL_PREFIX)/opt/asterisk/lib
   ASTVARLIBDIR=$(INSTALL_PREFIX)/var/opt/asterisk/lib
   ASTETCDIR=$(INSTALL_PREFIX)/etc/opt/asterisk
@@@@ -165,6 +191,8 @@@@ HTTP_CGIDIR=/var/www/cgi-bin
 # The file, /etc/asterisk.makeopts will also be included, but can be overridden
a41 1
+# OpenBSD wants repeatable builds
d43 2
a44 7
 ifneq ($(wildcard /etc/asterisk.makeopts),)
   include /etc/asterisk.makeopts
 endif
@@@@ -172,6 +200,7 @@@@ endif
 ifneq ($(wildcard ~/.asterisk.makeopts),)
   include ~/.asterisk.makeopts
 endif
d47 4
a50 4
 ifeq ($(OSARCH),Linux)
   ifeq ($(CROSS_COMPILE),)
@@@@ -235,8 +264,10 @@@@ ifeq ($(findstring BSD,$(OSARCH)),BSD)
   ASTCFLAGS+=-I$(CROSS_COMPILE_TARGET)/usr/local/include -L$(CROSS_COMPILE_TARGET)/usr/local/lib
d53 2
a54 7
-ifneq ($(PROC),ultrasparc)
-  ASTCFLAGS+=$(shell if $(CC) -march=$(PROC) -S -o /dev/null -xc /dev/null >/dev/null 2>&1; then echo "-march=$(PROC)"; fi)
+ifneq (${OSARCH},OpenBSD)
+  ifneq ($(PROC),ultrasparc)
+    ASTCFLAGS+=$(shell if $(CC) -march=$(PROC) -S -o /dev/null -xc /dev/null >/dev/null 2>&1; then echo "-march=$(PROC)"; fi)
+  endif
 endif
d56 1
a56 3
 ifeq ($(PROC),ppc)
@@@@ -423,6 +454,7 @@@@ endif
 LIBS+=-lssl
d58 3
a60 10
 _all: all
+ifneq (${OSARCH},OpenBSD)
 	@@echo " +--------- Asterisk Build Complete ---------+"  
 	@@echo " + Asterisk has successfully been built, but +"  
 	@@echo " + cannot be run before being installed by   +"  
@@@@ -430,6 +462,7 @@@@ _all: all
 	@@echo " +                                           +"
 	@@echo " +               $(MAKE) install                +"  
 	@@echo " +-------------------------------------------+"  
+endif
d62 4
a65 14
 all: cleantest depend asterisk subdirs 
 
@@@@ -714,6 +747,7 @@@@ install: all datafiles bininstall install-subdirs
 	@@if [ -x /usr/sbin/asterisk-post-install ]; then \
 		/usr/sbin/asterisk-post-install $(DESTDIR) . ; \
 	fi
+ifneq (${OSARCH},OpenBSD)
 	@@echo " +---- Asterisk Installation Complete -------+"  
 	@@echo " +                                           +"
 	@@echo " +    YOU MUST READ THE SECURITY DOCUMENT    +"
@@@@ -735,6 +769,7 @@@@ install: all datafiles bininstall install-subdirs
 	@@echo " + **Note** This requires that you have      +"
 	@@echo " + doxygen installed on your local system    +"
 	@@echo " +-------------------------------------------+"
a66 1
 	@@$(MAKE) -s oldmodcheck
d68 34
a101 1
 upgrade: all bininstall
@


1.9
log
@update to 1.2.14, from stuart henderson
@
text
@d1 3
a3 3
$OpenBSD: patch-Makefile,v 1.8 2006/09/24 21:09:26 jolan Exp $
--- Makefile.orig	Mon Dec 11 21:55:43 2006
+++ Makefile	Sat Dec 16 22:04:36 2006
d15 1
a15 1
@@@@ -47,8 +47,12 @@@@ ifneq ($(findstring dont-optimize,$(MAKE
d70 1
a70 1
+  AGI_DIR=/var/asterisk/agi-bin
d122 1
a122 1
@@@@ -714,6 +747,7 @@@@ install: all datafiles bininstall instal
d130 1
a130 1
@@@@ -735,6 +769,7 @@@@ install: all datafiles bininstall instal
@


1.9.2.1
log
@MFC:
SECURITY: update to 1.2.18 from maintainer stuart henderson

ASA-2007-011: Multiple problems in SIP channel parser handling response
codes
ASA-2007-012: Remote Crash Vulnerability in Manager Interface
@
text
@d1 1
a1 1
$OpenBSD: patch-Makefile,v 1.9 2006/12/22 22:16:10 jolan Exp $
d70 1
a70 1
+  AGI_DIR=$(INSTALL_PREFIX)/share/examples/asterisk/agi
@


1.8
log
@- update to 1.2.12.1
- be careful not to pick up odbc/popt if they happened to be installed

from maintainer stuart henderson
@
text
@d1 3
a3 3
$OpenBSD: patch-Makefile,v 1.7 2006/06/12 19:04:10 naddy Exp $
--- Makefile.orig	Wed Sep  6 15:09:10 2006
+++ Makefile	Tue Sep 19 14:26:50 2006
d122 1
a122 1
@@@@ -705,6 +738,7 @@@@ install: all datafiles bininstall instal
d130 1
a130 1
@@@@ -726,6 +760,7 @@@@ install: all datafiles bininstall instal
@


1.7
log
@SECURITY:
Update to 1.2.9.1 which addresses a security vulnerability in the IAX2
channel driver (chan_iax2). The vulnerability affects all users with
IAX2 clients that might be compromised or used by a malicious user, and
can lead to denial of service attacks and random Asterisk server crashes
via a relatively trivial exploit.

From: maintainer Stuart Henderson <stu@@spacehopper.org>
@
text
@d1 4
a4 4
$OpenBSD$
--- Makefile.orig	Sun Apr 30 15:27:56 2006
+++ Makefile	Thu Jun  1 02:36:38 2006
@@@@ -19,8 +19,8 @@@@
d15 1
a15 1
@@@@ -46,8 +46,12 @@@@
d28 1
a28 1
@@@@ -85,7 +89,11 @@@@
d40 1
a40 1
@@@@ -107,7 +115,7 @@@@
d49 1
a49 1
@@@@ -121,7 +129,25 @@@@
d76 1
a76 1
@@@@ -162,6 +188,8 @@@@
d85 1
a85 1
@@@@ -169,6 +197,7 @@@@
d93 1
a93 1
@@@@ -229,8 +258,10 @@@@
d106 2
a107 2
@@@@ -412,6 +443,7 @@@@
 INSTALL=install
d114 1
a114 1
@@@@ -419,6 +451,7 @@@@
d122 1
a122 1
@@@@ -694,6 +727,7 @@@@
d130 1
a130 1
@@@@ -715,6 +749,7 @@@@
@


1.7.2.1
log
@sync patches and fix a vulnerability in the chan_skinny module
for more details see: http://www.asterisk.org/node/109
@
text
@d1 4
a4 4
$OpenBSD: patch-Makefile,v 1.7 2006/06/12 19:04:10 naddy Exp $
--- Makefile.orig	Sun Apr 30 16:27:56 2006
+++ Makefile	Fri Oct 20 13:47:54 2006
@@@@ -19,8 +19,8 @@@@ OPTIONS=
d15 1
a15 1
@@@@ -46,8 +46,12 @@@@ ifneq ($(findstring dont-optimize,$(MAKE
d28 1
a28 1
@@@@ -85,7 +89,11 @@@@ MALLOC_DEBUG = #-include $(PWD)/include/
d40 1
a40 1
@@@@ -107,7 +115,7 @@@@ BUSYDETECT+= #-DBUSYDETECT_TONEONLY
d49 1
a49 1
@@@@ -121,7 +129,25 @@@@ ifneq ($(OSARCH),SunOS)
d76 1
a76 1
@@@@ -162,6 +188,8 @@@@ HTTP_CGIDIR=/var/www/cgi-bin
d85 1
a85 1
@@@@ -169,6 +197,7 @@@@ endif
d93 1
a93 1
@@@@ -229,8 +258,10 @@@@ ifeq ($(findstring BSD,$(OSARCH)),BSD)
d106 1
a106 1
@@@@ -412,6 +443,7 @@@@ LIBS+=-lssl
d114 1
a114 1
@@@@ -419,6 +451,7 @@@@ _all: all
d122 1
a122 1
@@@@ -694,6 +727,7 @@@@ install: all datafiles bininstall instal
d130 1
a130 1
@@@@ -715,6 +749,7 @@@@ install: all datafiles bininstall instal
@


1.7.2.2
log
@Security fixes:
ASA-2007-011, http://bugs.digium.com/view.php?id=9313:
Multiple problems in SIP channel parser handling response codes

ASA-2007-012:
Remote Crash Vulnerability in Manager Interface
@
text
@d1 1
a1 1
$OpenBSD: patch-Makefile,v 1.7.2.1 2006/11/01 13:45:32 sturm Exp $
d3 1
a3 1
+++ Makefile	Sat May  5 09:57:49 2007
@


1.7.2.3
log
@- backport some security fixes for
ASA-2007-014 - Stack Buffer Overflow in IAX2 channel driver
ASA-2007-015 - Remote Crash Vulnerability in IAX2 Channel Driver
ASA-2007-016 - Remote Crash Vulnerability in Skinny channel driver from version 1.2.22

All work and testing by Stuart Henderson

ok sturm@@
@
text
@d1 3
a3 3
$OpenBSD: patch-Makefile,v 1.7.2.2 2007/05/05 08:22:00 sturm Exp $
--- Makefile.orig	Sun Apr 30 15:27:56 2006
+++ Makefile	Tue Jul 31 14:42:51 2007
d15 1
a15 1
@@@@ -46,8 +46,12 @@@@ ifneq ($(findstring dont-optimize,$(MAKECMDGOALS)),don
d28 1
a28 1
@@@@ -85,7 +89,11 @@@@ MALLOC_DEBUG = #-include $(PWD)/include/asterisk/astmm
d122 1
a122 1
@@@@ -694,6 +727,7 @@@@ install: all datafiles bininstall install-subdirs
d130 1
a130 1
@@@@ -715,6 +749,7 @@@@ install: all datafiles bininstall install-subdirs
@


1.6
log
@use bcopy instead of memcpy to work around a gcc optimizer bug resulting
in unaligned accesses on sparc64
fix WANTLIB
honour CC, CFLAGS more or less

from Stuart Henderson <stu at spacehopper.org>
ok ian, jolan
@
text
@d2 2
a3 2
--- Makefile.orig	Mon Dec  5 06:47:51 2005
+++ Makefile	Sat Feb 11 02:29:14 2006
d15 1
a15 1
@@@@ -44,8 +44,12 @@@@
d28 1
a28 1
@@@@ -83,7 +87,11 @@@@
d40 1
a40 1
@@@@ -105,7 +113,7 @@@@
d49 1
a49 1
@@@@ -119,7 +127,25 @@@@
d76 1
a76 1
@@@@ -160,6 +186,8 @@@@
d85 1
a85 1
@@@@ -167,6 +195,7 @@@@
d93 1
a93 16
@@@@ -209,6 +238,14 @@@@
   MPG123TARG=linux
 endif
 
+ifeq ($(OSARCH),OpenBSD)
+  PROC?=$(shell uname -m)
+
+  ifeq ($(PROC),arm)
+    OPTIONS+=-fsigned-char
+  endif
+endif
+
 PWD=$(shell pwd)
 GREP=grep
 
@@@@ -227,8 +264,10 @@@@
d106 1
a106 1
@@@@ -410,6 +449,7 @@@@
d114 1
a114 1
@@@@ -417,6 +457,7 @@@@
d122 4
a125 5
@@@@ -666,6 +707,8 @@@@
 	fi 
 	( cd $(DESTDIR)$(ASTVARLIBDIR)/sounds  ; ln -s $(ASTSPOOLDIR)/voicemail . )
 	if [ -f mpg123-0.59r/mpg123 ]; then $(MAKE) -C mpg123-0.59r install; fi
+# OpenBSD packaging has own message-at-actual-install-time
d130 1
a130 1
@@@@ -687,6 +730,7 @@@@
d137 1
a137 1
 NEWMODS=$(notdir $(wildcard */*.so))
@


1.6.2.1
log
@MFC:
SECURITY:
Update to 1.2.9.1 which addresses a security vulnerability in the IAX2
channel driver (chan_iax2). The vulnerability affects all users with
IAX2 clients that might be compromised or used by a malicious user, and
can lead to denial of service attacks and random Asterisk server crashes
via a relatively trivial exploit.
@
text
@d1 4
a4 4
$OpenBSD: patch-Makefile,v 1.7 2006/06/12 19:04:10 naddy Exp $
--- Makefile.orig	Sun Apr 30 16:27:56 2006
+++ Makefile	Thu Jun 15 12:51:08 2006
@@@@ -19,8 +19,8 @@@@ OPTIONS=
d15 1
a15 1
@@@@ -46,8 +46,12 @@@@ ifneq ($(findstring dont-optimize,$(MAKE
d28 1
a28 1
@@@@ -85,7 +89,11 @@@@ MALLOC_DEBUG = #-include $(PWD)/include/
d40 1
a40 1
@@@@ -107,7 +115,7 @@@@ BUSYDETECT+= #-DBUSYDETECT_TONEONLY
d49 1
a49 1
@@@@ -121,7 +129,25 @@@@ ifneq ($(OSARCH),SunOS)
d76 1
a76 1
@@@@ -162,6 +188,8 @@@@ HTTP_CGIDIR=/var/www/cgi-bin
d85 1
a85 1
@@@@ -169,6 +197,7 @@@@ endif
d93 16
a108 1
@@@@ -229,8 +258,10 @@@@ ifeq ($(findstring BSD,$(OSARCH)),BSD)
d121 1
a121 1
@@@@ -412,6 +443,7 @@@@ LIBS+=-lssl
d129 1
a129 1
@@@@ -419,6 +451,7 @@@@ _all: all
d137 5
a141 4
@@@@ -694,6 +727,7 @@@@ install: all datafiles bininstall instal
 	@@if [ -x /usr/sbin/asterisk-post-install ]; then \
 		/usr/sbin/asterisk-post-install $(DESTDIR) . ; \
 	fi
d146 1
a146 1
@@@@ -715,6 +749,7 @@@@ install: all datafiles bininstall instal
d153 1
a153 1
 upgrade: all bininstall
@


1.5
log
@Work by and tested by ian@@ and Stuart Henderson, comments by jolan@@
@
text
@d3 12
a14 1
+++ Makefile	Thu Jan 26 22:39:56 2006
@


1.4
log
@update to 1.0.9, ok jcs pval

most notably fixes an overflow in the management interface (which is not
enabled by default)
@
text
@d1 4
a4 20
$OpenBSD: patch-Makefile,v 1.3 2005/05/09 16:50:05 jcs Exp $
--- Makefile.orig	Tue Apr 26 09:30:23 2005
+++ Makefile	Sun Aug 14 21:15:32 2005
@@@@ -20,6 +20,7 @@@@ OSARCH=$(shell uname -s)
 
 ifeq (${OSARCH},Linux)
 PROC=$(shell uname -m)
+ifneq (${OSARCH},OpenBSD)
 ifeq ($(PROC),x86_64)
 # You must have GCC 3.4 to use k8, otherwise use athlon
 PROC=k8
@@@@ -40,6 +41,7 @@@@ endif
 
 MPG123TARG=linux
 endif
+endif
 
 ifeq ($(findstring BSD,${OSARCH}),BSD)
 PROC=$(shell uname -m)
@@@@ -63,10 +65,14 @@@@ PWD=$(shell pwd)
d7 4
a10 2
 #Tell gcc to optimize the asterisk's code
+ifneq (${OSARCH},OpenBSD)
d12 1
d15 3
a17 8
 #Include debug symbols in the executables (-g) and profiling info (-pg)
+ifneq (${OSARCH},OpenBSD)
 DEBUG=-g #-pg
+endif
 
 # If you are running a radio application, define RADIO_RELAX so that the DTMF
 # will be received more reliably
@@@@ -91,7 +97,11 @@@@ MALLOC_DEBUG = #-include $(PWD)/include/
d24 1
a24 1
 INSTALL_PREFIX=
d29 1
a29 1
@@@@ -111,31 +121,35 @@@@ BUSYDETECT+= #-DBUSYDETECT_TONEONLY
d33 46
a78 30
-ASTLIBDIR=$(INSTALL_PREFIX)/usr/lib/asterisk
-ASTVARLIBDIR=$(INSTALL_PREFIX)/var/lib/asterisk
-ASTETCDIR=$(INSTALL_PREFIX)/etc/asterisk
-ASTSPOOLDIR=$(INSTALL_PREFIX)/var/spool/asterisk
-ASTLOGDIR=$(INSTALL_PREFIX)/var/log/asterisk
-ASTHEADERDIR=$(INSTALL_PREFIX)/usr/include/asterisk
+ASTLIBDIR=$(INSTALL_PREFIX)/lib/asterisk
+ASTVARLIBDIR=$(INSTALL_PREFIX)/share/asterisk
+ASTETCDIR=${SYSCONFDIR}/asterisk
+ASTSPOOLDIR=/var/spool/asterisk
+ASTLOGDIR=/var/log/asterisk
+ASTHEADERDIR=$(INSTALL_PREFIX)/include/asterisk
 ASTCONFPATH=$(ASTETCDIR)/asterisk.conf
-ASTBINDIR=$(INSTALL_PREFIX)/usr/bin
-ASTSBINDIR=$(INSTALL_PREFIX)/usr/sbin
-ASTVARRUNDIR=$(INSTALL_PREFIX)/var/run
-ASTMANDIR=$(INSTALL_PREFIX)/usr/share/man
+ASTBINDIR=$(INSTALL_PREFIX)/bin
+ASTSBINDIR=$(INSTALL_PREFIX)/sbin
+ASTVARRUNDIR=/var/db/asterisk
+ASTMANDIR=$(INSTALL_PREFIX)/man
 
 MODULES_DIR=$(ASTLIBDIR)/modules
-AGI_DIR=$(ASTVARLIBDIR)/agi-bin
+AGI_DIR=/var/asterisk/agi-bin
 
 INCLUDE=-Iinclude -I../include
-CFLAGS=-pipe  -Wall -Wstrict-prototypes -Wmissing-prototypes -Wmissing-declarations $(DEBUG) $(INCLUDE) -D_REENTRANT -D_GNU_SOURCE #-DMAKE_VALGRIND_HAPPY
+CFLAGS+=-pipe  -Wall -Wstrict-prototypes -Wmissing-prototypes -Wmissing-declarations $(DEBUG) $(INCLUDE) -D_REENTRANT -D_GNU_SOURCE #-DMAKE_VALGRIND_HAPPY
 CFLAGS+=$(OPTIMIZE)
d80 4
a83 3
+ifneq (${OSARCH},OpenBSD)
 ifneq ($(PROC),ultrasparc)
 CFLAGS+=$(shell if $(CC) -march=$(PROC) -S -o /dev/null -xc /dev/null >/dev/null 2>&1; then echo "-march=$(PROC)"; fi)
a84 1
+endif
d86 10
a95 4
 CFLAGS+=$(shell if uname -m | grep -q ppc; then echo "-fsigned-char"; fi)
+ifneq (${OSARCH},OpenBSD)
 CFLAGS+=$(shell if [ -f /usr/include/osp/osp.h ]; then echo "-DOSP_SUPPORT -I/usr/include/osp" ; fi)
+endif
d97 3
a99 5
 ifeq (${OSARCH},FreeBSD)
 OSVERSION=$(shell make -V OSVERSION -f /usr/share/mk/bsd.port.subdir.mk)
@@@@ -159,8 +173,10 @@@@ endif
 #Uncomment this to use the older DSP routines
 #CFLAGS+=-DOLD_DSP_ROUTINES
d101 2
d104 3
a106 8
 CFLAGS+=$(shell if [ -f /usr/include/linux/zaptel.h ]; then echo "-DZAPTEL_OPTIMIZATIONS"; fi)
 CFLAGS+=$(shell if [ -f /usr/local/include/zaptel.h ]; then echo "-DZAPTEL_OPTIMIZATIONS"; fi)
+endif
 
 LIBEDIT=editline/libedit.a
 
@@@@ -222,17 +238,21 @@@@ ASTLINK=-Wl,-E 
 SOLINK=-shared -Xlinker -x
d109 2
a110 3
+ifneq (${OSARCH},OpenBSD)
 CC=gcc
+endif
d118 1
a118 1
 	@@echo " + running:                                  +"  
d121 1
a121 2
-	@@echo " +-------------------------------------------+"  
+	@@echo " +-------------------------------------------+"
d124 1
a124 1
 all: depend asterisk subdirs 
d126 2
a127 12
@@@@ -401,7 +421,8 @@@@ bininstall: all
 	mkdir -p $(DESTDIR)$(ASTMANDIR)/man8
 	install -m 644 keys/iaxtel.pub $(DESTDIR)$(ASTVARLIBDIR)/keys
 	install -m 644 keys/freeworlddialup.pub $(DESTDIR)$(ASTVARLIBDIR)/keys
-	install -m 644 asterisk.8.gz $(DESTDIR)$(ASTMANDIR)/man8
+	zcat asterisk.8.gz > asterisk.8
+	install -m 644 asterisk.8 $(DESTDIR)$(ASTMANDIR)/man8
 	if [ -d contrib/firmware/iax ]; then \
 		install -m 644 contrib/firmware/iax/iaxy.bin $(DESTDIR)$(ASTVARLIBDIR)/firmware/iax/iaxy.bin; \
 	else \
@@@@ -410,6 +431,7 @@@@ bininstall: all
 	( cd $(DESTDIR)$(ASTVARLIBDIR)/sounds  ; ln -s $(ASTSPOOLDIR)/vm . )
d130 1
d135 3
a137 3
@@@@ -443,6 +465,7 @@@@ bininstall: all
 	@@echo " + before doing a '$(MAKE) install'.            +"
 	@@echo " +                                           +"
d140 1
d142 1
a142 2
 
 install: all datafiles bininstall
@


1.4.2.1
log
@MFC:
SECURITY:
Update to 1.0.11.1 which addresses a security vulnerability in the IAX2
channel driver (chan_iax2). The vulnerability affects all users with
IAX2 clients that might be compromised or used by a malicious user, and
can lead to denial of service attacks and random Asterisk server crashes
via a relatively trivial exploit.
@
text
@d1 3
a3 3
$OpenBSD: patch-Makefile,v 1.4 2005/08/15 17:36:07 jolan Exp $
--- Makefile.orig	Tue Nov 29 19:24:39 2005
+++ Makefile	Thu Jun 15 16:19:29 2006
d106 2
a107 2
@@@@ -233,17 +249,21 @@@@ ifeq ($(wildcard $(CROSS_COMPILE_TARGET)
   CFLAGS+=-DDLFCNCOMPAT
d129 1
a129 1
@@@@ -412,7 +432,8 @@@@ bininstall: all
d136 4
a139 4
 	install -m 644 contrib/scripts/astgenkey.8 $(DESTDIR)$(ASTMANDIR)/man8
 	install -m 644 contrib/scripts/autosupport.8 $(DESTDIR)$(ASTMANDIR)/man8
 	install -m 644 contrib/scripts/safe_asterisk.8 $(DESTDIR)$(ASTMANDIR)/man8
@@@@ -424,6 +445,7 @@@@ bininstall: all
d147 1
a147 1
@@@@ -457,6 +479,7 @@@@ bininstall: all
@


1.3
log
@- drop to _asterisk user/group by default
- move some files around and change file/directory owners to support
  this
- bump pkgname

ok mr. jolan@@
@
text
@d1 3
a3 3
$OpenBSD: patch-Makefile,v 1.2 2005/05/01 02:12:47 jcs Exp $
--- Makefile.orig	Thu Mar 10 02:15:05 2005
+++ Makefile	Wed Mar 30 13:34:20 2005
d70 1
a70 1
+ASTVARRUNDIR=/var/run/asterisk
d147 1
a147 1
@@@@ -441,6 +463,7 @@@@ bininstall: all
@


1.2
log
@update to asterisk-1.0.7
- put jolan's mirror second
- RUN_DEPENDS on sox and mpg123 for music on hold
- install example indications.conf so ringing works

ok jolan@@
@
text
@d1 1
a1 1
$OpenBSD: patch-Makefile,v 1.1.1.1 2004/09/26 00:38:24 jolan Exp $
d70 1
a70 1
+ASTVARRUNDIR=/var/run
@


1.1
log
@Initial revision
@
text
@d1 3
a3 3
$OpenBSD$
--- Makefile.orig	Thu Sep 16 13:46:39 2004
+++ Makefile	Sat Sep 25 18:03:29 2004
d12 1
a12 2
@@@@ -39,6 +40,7 @@@@ OPTIONS+=-fomit-frame-pointer
 endif
d14 1
d20 1
a20 1
@@@@ -62,10 +64,14 @@@@ PWD=$(shell pwd)
d35 1
a35 1
@@@@ -90,7 +96,11 @@@@ MALLOC_DEBUG = #-include $(PWD)/include/
d47 1
a47 1
@@@@ -110,31 +120,35 @@@@ BUSYDETECT+= #-DBUSYDETECT_TONEONLY
d95 1
a95 1
@@@@ -156,8 +170,10 @@@@ endif
d106 1
a106 1
@@@@ -219,17 +235,21 @@@@ ASTLINK=-Wl,-E 
d129 1
a129 1
@@@@ -397,7 +417,8 @@@@ bininstall: all
d139 1
a139 1
@@@@ -406,6 +427,7 @@@@ bininstall: all
d142 1
a142 1
 	if [ -f mpg123-0.59r/mpg123 ]; then make -C mpg123-0.59r install; fi
d147 3
a149 3
@@@@ -427,6 +449,7 @@@@ bininstall: all
 	@@echo " + **Note** This requires that you have      +"
 	@@echo " + doxygen installed on your local system    +"
d153 1
a154 1
 
@


1.1.1.1
log
@asterisk-1.0.0, open source pbx
@
text
@@
