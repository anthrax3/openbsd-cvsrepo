head	1.1;
access;
symbols;
locks; strict;
comment	@# @;


1.1
date	2017.05.26.15.30.49;	author sthen;	state Exp;
branches;
next	;
commitid	m2FuyaqGe0XgatQw;


desc
@@


1.1
log
@pass LDFLAGS to the autoconf test for clang -fblocks. still broken:

- clang + ld.bfd: link fails in autoconf test, undefined symbols.

- clang + ld.lld: package builds, dlopen()ing the .so modules that use -fblocks
fails at runtime.

because with clang + ld.lld it does build but results in unusable packages,
explicitly mark BROKEN-aarch64 for now.
@
text
@$OpenBSD$

Index: autoconf/ast_check_raii.m4
--- autoconf/ast_check_raii.m4.orig
+++ autoconf/ast_check_raii.m4
@@@@ -37,7 +37,7 @@@@ AC_DEFUN([AST_CHECK_RAII], [
 				AST_CLANG_BLOCKS_LIBS=""
 				AST_CLANG_BLOCKS="-Wno-unknown-warning-option -fblocks"
 				AC_MSG_RESULT(yes)
-			elif test "`echo "int main(){return ^{return 42;}();}" | ${CC} -o /dev/null -fblocks -x c -lBlocksRuntime - 2>&1`" = ""; then
+			elif test "`echo "int main(){return ^{return 42;}();}" | ${CC} -o /dev/null -fblocks -x c ${LDFLAGS} -lBlocksRuntime - 2>&1`" = ""; then
 				AST_CLANG_BLOCKS_LIBS="-lBlocksRuntime"
 				AST_CLANG_BLOCKS="-fblocks"
 				AC_MSG_RESULT(yes)
@
