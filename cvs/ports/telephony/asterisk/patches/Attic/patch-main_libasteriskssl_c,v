head	1.2;
access;
symbols;
locks; strict;
comment	@# @;


1.2
date	2017.07.12.19.55.29;	author sthen;	state dead;
branches;
next	1.1;
commitid	MEAHFhNzvDYzCDPk;

1.1
date	2017.04.07.21.32.20;	author sthen;	state Exp;
branches;
next	;
commitid	nV235s3Hk3XJ0tGS;


desc
@@


1.2
log
@update to asterisk-13.17.0
@
text
@$OpenBSD: patch-main_libasteriskssl_c,v 1.1 2017/04/07 21:32:20 sthen Exp $
--- main/libasteriskssl.c.orig	Fri Apr  7 16:49:39 2017
+++ main/libasteriskssl.c	Fri Apr  7 22:06:13 2017
@@@@ -74,7 +74,7 @@@@ static void ssl_lock(int mode, int n, const char *file
 	}
 }
 
-#if !defined(OPENSSL_VERSION_NUMBER) || OPENSSL_VERSION_NUMBER < 0x10100000L
+#if !defined(OPENSSL_VERSION_NUMBER) || OPENSSL_VERSION_NUMBER < 0x10100000L || defined(LIBRESSL_VERSION_NUMBER)
 int SSL_library_init(void)
 {
 #if defined(AST_DEVMODE)
@@@@ -129,7 +129,7 @@@@ void ERR_free_strings(void)
 int ast_ssl_init(void)
 {
 #if defined(HAVE_OPENSSL) && defined(OPENSSL_VERSION_NUMBER) && \
-	OPENSSL_VERSION_NUMBER < 0x10100000L
+	(OPENSSL_VERSION_NUMBER < 0x10100000L || defined(LIBRESSL_VERSION_NUMBER))
 	unsigned int i;
 	int (*real_SSL_library_init)(void);
 	void (*real_CRYPTO_set_id_callback)(unsigned long (*)(void));
@


1.1
log
@update to asterisk-13.15.0.

add various OPENSSL_VERSION_NUMBER patches now that asterisk supports
openssl 1.1:

- we don't have openssl 1.1's SSL_is_server yet, so use the old check
for ssl->server instead

- we do still need the hack to avoid initing multiple times which is
no longer needed in openssl 1.1
@
text
@d1 1
a1 1
$OpenBSD$
@

