head	1.264;
access;
symbols
	OPENBSD_6_1:1.251.0.2
	OPENBSD_6_1_BASE:1.251
	OPENBSD_6_0:1.235.0.2
	OPENBSD_6_0_BASE:1.235
	OPENBSD_5_9:1.226.0.2
	OPENBSD_5_9_BASE:1.226
	OPENBSD_5_8:1.218.0.4
	OPENBSD_5_8_BASE:1.218
	OPENBSD_5_7:1.214.0.2
	OPENBSD_5_7_BASE:1.214
	OPENBSD_5_6:1.202.0.2
	OPENBSD_5_6_BASE:1.202
	OPENBSD_5_5:1.191.0.2
	OPENBSD_5_5_BASE:1.191
	OPENBSD_5_4:1.184.0.2
	OPENBSD_5_4_BASE:1.184
	OPENBSD_5_3:1.170.0.2
	OPENBSD_5_3_BASE:1.170
	OPENBSD_5_2:1.153.0.2
	OPENBSD_5_2_BASE:1.153
	OPENBSD_5_1_BASE:1.134
	OPENBSD_5_1:1.134.0.2
	OPENBSD_5_0:1.121.0.2
	OPENBSD_5_0_BASE:1.121
	OPENBSD_4_9:1.100.0.2
	OPENBSD_4_9_BASE:1.100
	OPENBSD_4_8:1.90.0.2
	OPENBSD_4_8_BASE:1.90
	OPENBSD_4_7:1.73.0.2
	OPENBSD_4_7_BASE:1.73
	OPENBSD_4_6:1.56.0.2
	OPENBSD_4_6_BASE:1.56
	OPENBSD_4_5:1.49.0.2
	OPENBSD_4_5_BASE:1.49
	OPENBSD_4_4:1.44.0.2
	OPENBSD_4_4_BASE:1.44
	OPENBSD_4_3:1.32.0.2
	OPENBSD_4_3_BASE:1.32
	OPENBSD_4_2:1.21.0.2
	OPENBSD_4_2_BASE:1.21
	OPENBSD_4_1:1.16.0.2
	OPENBSD_4_1_BASE:1.16
	OPENBSD_4_0:1.10.0.2
	OPENBSD_4_0_BASE:1.10
	OPENBSD_3_9:1.8.0.2
	OPENBSD_3_9_BASE:1.8
	OPENBSD_3_8:1.5.0.2
	OPENBSD_3_8_BASE:1.5
	OPENBSD_3_7:1.2.0.2
	OPENBSD_3_7_BASE:1.2
	jolan_2004-09-25:1.1.1.1
	jolan:1.1.1;
locks; strict;
comment	@# @;


1.264
date	2017.09.21.10.11.16;	author sthen;	state Exp;
branches;
next	1.263;
commitid	nrZ2RKk6Zrl5ODcB;

1.263
date	2017.09.01.09.55.28;	author sthen;	state Exp;
branches;
next	1.262;
commitid	qxFjhFaApehpIqVP;

1.262
date	2017.08.31.21.34.05;	author sthen;	state Exp;
branches;
next	1.261;
commitid	jtArbvCm57vAmvMU;

1.261
date	2017.08.22.22.51.04;	author sthen;	state Exp;
branches;
next	1.260;
commitid	rNQAbEl9NpwKqgkn;

1.260
date	2017.08.22.10.27.33;	author espie;	state Exp;
branches;
next	1.259;
commitid	sCnkIOOsVZcKUm8L;

1.259
date	2017.08.05.12.29.21;	author sthen;	state Exp;
branches;
next	1.258;
commitid	s1eyLKJ9jlYZYyvY;

1.258
date	2017.07.16.19.19.02;	author espie;	state Exp;
branches;
next	1.257;
commitid	tt0GhWK5c4uf9ILG;

1.257
date	2017.07.12.19.55.29;	author sthen;	state Exp;
branches;
next	1.256;
commitid	MEAHFhNzvDYzCDPk;

1.256
date	2017.05.26.15.42.45;	author sthen;	state Exp;
branches;
next	1.255;
commitid	Ih7XRKMaF1Lox7K0;

1.255
date	2017.05.26.15.30.49;	author sthen;	state Exp;
branches;
next	1.254;
commitid	m2FuyaqGe0XgatQw;

1.254
date	2017.04.10.11.46.34;	author sthen;	state Exp;
branches;
next	1.253;
commitid	HY6VNZxjJWzKQFDV;

1.253
date	2017.04.07.21.32.20;	author sthen;	state Exp;
branches;
next	1.252;
commitid	nV235s3Hk3XJ0tGS;

1.252
date	2017.04.05.10.27.36;	author sthen;	state Exp;
branches;
next	1.251;
commitid	061BTkt3tBxkS4R9;

1.251
date	2017.03.18.21.49.48;	author sthen;	state Exp;
branches;
next	1.250;
commitid	NOa4C1ZQ1iLGMfFQ;

1.250
date	2017.03.18.21.42.04;	author sthen;	state Exp;
branches;
next	1.249;
commitid	RxgFeqBeHktNBVUd;

1.249
date	2017.02.14.12.31.38;	author sthen;	state Exp;
branches;
next	1.248;
commitid	quKKQrLn1snJOX5r;

1.248
date	2017.02.07.21.09.10;	author kili;	state Exp;
branches;
next	1.247;
commitid	cjUbPtIxw3YIb6hv;

1.247
date	2017.02.06.10.11.31;	author sthen;	state Exp;
branches;
next	1.246;
commitid	j5q6HCihnaAakz2P;

1.246
date	2017.02.02.14.04.07;	author sthen;	state Exp;
branches;
next	1.245;
commitid	x8brg28oQZWYS2QP;

1.245
date	2016.12.10.12.25.44;	author sthen;	state Exp;
branches;
next	1.244;
commitid	e7YSVWImDOixQQhm;

1.244
date	2016.11.29.13.57.49;	author sthen;	state Exp;
branches;
next	1.243;
commitid	Gf4sUy4BJIuXDwFE;

1.243
date	2016.11.11.10.55.17;	author sthen;	state Exp;
branches;
next	1.242;
commitid	JHzWucB4VBXAd6MH;

1.242
date	2016.11.04.11.35.20;	author sthen;	state Exp;
branches;
next	1.241;
commitid	Gg5LRcnQlqj5M3F7;

1.241
date	2016.10.29.19.21.13;	author sthen;	state Exp;
branches;
next	1.240;
commitid	M1bwGUrLVzZlS8MR;

1.240
date	2016.09.23.09.16.57;	author sthen;	state Exp;
branches;
next	1.239;
commitid	XLnI6AbHAmyVU5mO;

1.239
date	2016.09.13.12.13.03;	author sthen;	state Exp;
branches;
next	1.238;
commitid	bCnj26u3ZVEl82Z8;

1.238
date	2016.09.02.11.09.37;	author sthen;	state Exp;
branches;
next	1.237;
commitid	q8FygteYPDVP3gs3;

1.237
date	2016.09.02.10.34.59;	author sthen;	state Exp;
branches;
next	1.236;
commitid	RfL2JeKVfoGkzDta;

1.236
date	2016.07.30.21.12.15;	author sthen;	state Exp;
branches;
next	1.235;
commitid	K2mWukCHmtndR1hw;

1.235
date	2016.06.13.09.22.42;	author ajacoutot;	state Exp;
branches;
next	1.234;
commitid	48uKoEqY2UjYLvSu;

1.234
date	2016.05.14.13.45.17;	author sthen;	state Exp;
branches;
next	1.233;
commitid	Qx6U2dCdp1dtGa7L;

1.233
date	2016.05.09.16.07.13;	author sthen;	state Exp;
branches;
next	1.232;
commitid	aNHQY7yfhiDMuBRr;

1.232
date	2016.04.22.22.37.40;	author sthen;	state Exp;
branches;
next	1.231;
commitid	Ez33MwDLcqDZmerO;

1.231
date	2016.04.15.11.35.12;	author sthen;	state Exp;
branches;
next	1.230;
commitid	oMcvZMT6zM3m2U9Z;

1.230
date	2016.04.02.14.38.19;	author sthen;	state Exp;
branches;
next	1.229;
commitid	bGTV3d7kqzoe2QSa;

1.229
date	2016.03.29.23.24.46;	author sthen;	state Exp;
branches;
next	1.228;
commitid	6xsz7ii52z8elbLl;

1.228
date	2016.03.18.21.38.25;	author naddy;	state Exp;
branches;
next	1.227;
commitid	BVkebQSTXSZokeRG;

1.227
date	2016.02.25.00.42.50;	author sthen;	state Exp;
branches;
next	1.226;
commitid	p3wsQM09AnkCa4Yz;

1.226
date	2016.02.04.02.56.29;	author sthen;	state Exp;
branches
	1.226.2.1;
next	1.225;
commitid	049bVOhkQ1PkED0I;

1.225
date	2016.01.16.14.21.53;	author sthen;	state Exp;
branches;
next	1.224;
commitid	vMAJAFo2jtqZfkxS;

1.224
date	2015.10.31.11.28.57;	author espie;	state Exp;
branches;
next	1.223;
commitid	ldDBDh5O93HoWvdR;

1.223
date	2015.10.30.12.59.16;	author sthen;	state Exp;
branches;
next	1.222;
commitid	vVZOehVa6DiEPxJL;

1.222
date	2015.10.15.13.16.50;	author sthen;	state Exp;
branches;
next	1.221;
commitid	hsd56QlIwfDLHiMJ;

1.221
date	2015.10.12.22.07.28;	author sthen;	state Exp;
branches;
next	1.220;
commitid	s4D60mgjUjajPmDX;

1.220
date	2015.10.10.19.58.47;	author sthen;	state Exp;
branches;
next	1.219;
commitid	DVU5rjHiL77qkjwC;

1.219
date	2015.09.21.14.10.21;	author sthen;	state Exp;
branches;
next	1.218;
commitid	B5xT5VHRUfYWk38E;

1.218
date	2015.06.08.08.44.52;	author sthen;	state Exp;
branches;
next	1.217;
commitid	fpwQjZS08bdnhHwf;

1.217
date	2015.05.08.09.08.44;	author espie;	state Exp;
branches;
next	1.216;
commitid	8WaxsMNN6opOzn9t;

1.216
date	2015.05.05.12.47.02;	author sthen;	state Exp;
branches;
next	1.215;
commitid	atUBlwpjjcKqeYLq;

1.215
date	2015.04.02.17.09.30;	author sthen;	state Exp;
branches;
next	1.214;
commitid	pFawx8i9X16VMpMZ;

1.214
date	2015.02.06.23.27.51;	author sthen;	state Exp;
branches
	1.214.2.1;
next	1.213;
commitid	KgnZWoY0Ja6AhSwH;

1.213
date	2015.01.29.20.45.11;	author sthen;	state Exp;
branches;
next	1.212;
commitid	is52KPxlprxEkqKf;

1.212
date	2015.01.27.21.26.43;	author sthen;	state Exp;
branches;
next	1.211;
commitid	jDFEwq0U3ZjMJisp;

1.211
date	2014.12.12.19.17.52;	author sthen;	state Exp;
branches;
next	1.210;
commitid	SUXlXpEFCfPgsnDb;

1.210
date	2014.11.21.12.40.49;	author sthen;	state Exp;
branches;
next	1.209;
commitid	3cL4b8nFSw9XZk2K;

1.209
date	2014.11.10.20.43.18;	author sthen;	state Exp;
branches;
next	1.208;
commitid	vGvjZWf0bu7xlils;

1.208
date	2014.10.20.23.14.33;	author sthen;	state Exp;
branches;
next	1.207;
commitid	5DoBSBcmzZSdX8Nc;

1.207
date	2014.09.30.00.19.18;	author sthen;	state Exp;
branches;
next	1.206;
commitid	CKlWs40vyHRtuY2a;

1.206
date	2014.09.20.20.37.44;	author sthen;	state Exp;
branches;
next	1.205;
commitid	8htrw8MLRDJ6FeSw;

1.205
date	2014.09.13.18.09.22;	author brad;	state Exp;
branches;
next	1.204;
commitid	PpbRjVZdAmlrmi8q;

1.204
date	2014.09.05.19.17.37;	author sthen;	state Exp;
branches;
next	1.203;
commitid	RNSybuZ9cxryRICw;

1.203
date	2014.09.02.19.53.08;	author sthen;	state Exp;
branches;
next	1.202;
commitid	ZEiR7dcZH7GRSDtR;

1.202
date	2014.07.12.01.32.13;	author sthen;	state Exp;
branches
	1.202.2.1;
next	1.201;
commitid	YbPHQia12Q6YsBuR;

1.201
date	2014.06.12.22.39.12;	author sthen;	state Exp;
branches;
next	1.200;
commitid	FU55V0oX7ss5wEZn;

1.200
date	2014.06.12.14.24.34;	author sthen;	state Exp;
branches;
next	1.199;
commitid	QEWjUNdmqaE5IR4t;

1.199
date	2014.05.31.00.35.31;	author sthen;	state Exp;
branches;
next	1.198;

1.198
date	2014.05.07.00.38.59;	author sthen;	state Exp;
branches;
next	1.197;

1.197
date	2014.04.26.11.59.51;	author sthen;	state Exp;
branches;
next	1.196;

1.196
date	2014.04.21.22.54.50;	author sthen;	state Exp;
branches;
next	1.195;

1.195
date	2014.04.21.11.34.51;	author sthen;	state Exp;
branches;
next	1.194;

1.194
date	2014.03.23.22.05.10;	author sthen;	state Exp;
branches;
next	1.193;

1.193
date	2014.03.11.19.30.44;	author sthen;	state Exp;
branches;
next	1.192;

1.192
date	2014.03.09.20.51.43;	author sthen;	state Exp;
branches;
next	1.191;

1.191
date	2013.12.30.23.04.49;	author sthen;	state Exp;
branches;
next	1.190;

1.190
date	2013.12.20.12.37.05;	author sthen;	state Exp;
branches;
next	1.189;

1.189
date	2013.12.16.23.16.01;	author sthen;	state Exp;
branches;
next	1.188;

1.188
date	2013.12.11.16.00.43;	author sthen;	state Exp;
branches;
next	1.187;

1.187
date	2013.10.21.23.38.44;	author sthen;	state Exp;
branches;
next	1.186;

1.186
date	2013.10.17.09.11.35;	author ajacoutot;	state Exp;
branches;
next	1.185;

1.185
date	2013.08.28.09.46.15;	author sthen;	state Exp;
branches;
next	1.184;

1.184
date	2013.07.16.13.03.19;	author sthen;	state Exp;
branches
	1.184.2.1;
next	1.183;

1.183
date	2013.06.20.08.26.14;	author ajacoutot;	state Exp;
branches;
next	1.182;

1.182
date	2013.06.20.06.54.37;	author ajacoutot;	state Exp;
branches;
next	1.181;

1.181
date	2013.06.17.19.31.17;	author ajacoutot;	state Exp;
branches;
next	1.180;

1.180
date	2013.06.12.20.36.34;	author brad;	state Exp;
branches;
next	1.179;

1.179
date	2013.06.05.00.57.18;	author sthen;	state Exp;
branches;
next	1.178;

1.178
date	2013.05.25.00.33.10;	author brad;	state Exp;
branches;
next	1.177;

1.177
date	2013.05.18.08.44.00;	author sthen;	state Exp;
branches;
next	1.176;

1.176
date	2013.05.17.22.57.50;	author sthen;	state Exp;
branches;
next	1.175;

1.175
date	2013.03.28.21.25.17;	author sthen;	state Exp;
branches;
next	1.174;

1.174
date	2013.03.28.20.24.53;	author sthen;	state Exp;
branches;
next	1.173;

1.173
date	2013.03.27.22.48.22;	author sthen;	state Exp;
branches;
next	1.172;

1.172
date	2013.03.21.08.48.54;	author ajacoutot;	state Exp;
branches;
next	1.171;

1.171
date	2013.03.11.11.41.33;	author espie;	state Exp;
branches;
next	1.170;

1.170
date	2013.01.30.20.59.41;	author sthen;	state Exp;
branches
	1.170.2.1;
next	1.169;

1.169
date	2013.01.22.23.26.30;	author sthen;	state Exp;
branches;
next	1.168;

1.168
date	2013.01.15.01.38.34;	author sthen;	state Exp;
branches;
next	1.167;

1.167
date	2013.01.02.22.33.43;	author sthen;	state Exp;
branches;
next	1.166;

1.166
date	2012.12.11.14.46.41;	author sthen;	state Exp;
branches;
next	1.165;

1.165
date	2012.12.07.12.20.27;	author sthen;	state Exp;
branches;
next	1.164;

1.164
date	2012.11.28.17.29.30;	author sthen;	state Exp;
branches;
next	1.163;

1.163
date	2012.11.08.09.34.31;	author sthen;	state Exp;
branches;
next	1.162;

1.162
date	2012.10.08.21.28.06;	author sthen;	state Exp;
branches;
next	1.161;

1.161
date	2012.09.28.00.03.57;	author sthen;	state Exp;
branches;
next	1.160;

1.160
date	2012.09.25.21.58.46;	author sthen;	state Exp;
branches;
next	1.159;

1.159
date	2012.09.15.12.43.49;	author sthen;	state Exp;
branches;
next	1.158;

1.158
date	2012.08.30.22.45.40;	author sthen;	state Exp;
branches;
next	1.157;

1.157
date	2012.08.23.17.42.27;	author sthen;	state Exp;
branches;
next	1.156;

1.156
date	2012.08.22.08.04.22;	author sthen;	state Exp;
branches;
next	1.155;

1.155
date	2012.08.21.22.45.59;	author sthen;	state Exp;
branches;
next	1.154;

1.154
date	2012.08.04.21.53.56;	author sthen;	state Exp;
branches;
next	1.153;

1.153
date	2012.07.17.13.01.55;	author sthen;	state Exp;
branches
	1.153.2.1;
next	1.152;

1.152
date	2012.07.11.08.51.56;	author sthen;	state Exp;
branches;
next	1.151;

1.151
date	2012.07.05.22.01.22;	author sthen;	state Exp;
branches;
next	1.150;

1.150
date	2012.06.07.10.39.25;	author sthen;	state Exp;
branches;
next	1.149;

1.149
date	2012.05.30.22.45.26;	author sthen;	state Exp;
branches;
next	1.148;

1.148
date	2012.05.30.22.41.30;	author sthen;	state Exp;
branches;
next	1.147;

1.147
date	2012.05.06.13.58.23;	author naddy;	state Exp;
branches;
next	1.146;

1.146
date	2012.05.03.11.25.27;	author sthen;	state Exp;
branches;
next	1.145;

1.145
date	2012.04.28.10.52.08;	author ajacoutot;	state Exp;
branches;
next	1.144;

1.144
date	2012.04.23.21.35.58;	author sthen;	state Exp;
branches;
next	1.143;

1.143
date	2012.04.23.17.15.19;	author espie;	state Exp;
branches;
next	1.142;

1.142
date	2012.04.08.22.34.51;	author sthen;	state Exp;
branches;
next	1.141;

1.141
date	2012.03.27.19.48.03;	author sthen;	state Exp;
branches;
next	1.140;

1.140
date	2012.03.23.22.42.25;	author sthen;	state Exp;
branches;
next	1.139;

1.139
date	2012.03.17.23.08.20;	author sthen;	state Exp;
branches;
next	1.138;

1.138
date	2012.03.15.22.20.50;	author sthen;	state Exp;
branches;
next	1.137;

1.137
date	2012.03.13.23.17.46;	author sthen;	state Exp;
branches;
next	1.136;

1.136
date	2012.02.27.17.12.56;	author sthen;	state Exp;
branches;
next	1.135;

1.135
date	2012.02.16.21.25.08;	author sthen;	state Exp;
branches;
next	1.134;

1.134
date	2012.01.28.08.16.22;	author sthen;	state Exp;
branches
	1.134.2.1;
next	1.133;

1.133
date	2012.01.20.00.18.02;	author sthen;	state Exp;
branches;
next	1.132;

1.132
date	2012.01.19.21.49.56;	author sthen;	state Exp;
branches;
next	1.131;

1.131
date	2011.12.30.22.24.35;	author sthen;	state Exp;
branches;
next	1.130;

1.130
date	2011.12.16.14.50.09;	author sthen;	state Exp;
branches;
next	1.129;

1.129
date	2011.12.09.00.22.43;	author sthen;	state Exp;
branches;
next	1.128;

1.128
date	2011.11.02.08.32.17;	author jasper;	state Exp;
branches;
next	1.127;

1.127
date	2011.10.17.19.35.55;	author sthen;	state Exp;
branches;
next	1.126;

1.126
date	2011.10.17.10.03.51;	author espie;	state Exp;
branches;
next	1.125;

1.125
date	2011.09.24.13.47.42;	author sthen;	state Exp;
branches;
next	1.124;

1.124
date	2011.09.16.12.49.21;	author naddy;	state Exp;
branches;
next	1.123;

1.123
date	2011.09.16.11.41.40;	author espie;	state Exp;
branches;
next	1.122;

1.122
date	2011.09.09.15.29.21;	author sthen;	state Exp;
branches;
next	1.121;

1.121
date	2011.07.12.19.54.39;	author sthen;	state Exp;
branches
	1.121.2.1;
next	1.120;

1.120
date	2011.07.07.01.19.02;	author ajacoutot;	state Exp;
branches;
next	1.119;

1.119
date	2011.06.29.01.15.04;	author sthen;	state Exp;
branches;
next	1.118;

1.118
date	2011.06.27.21.15.14;	author sthen;	state Exp;
branches;
next	1.117;

1.117
date	2011.06.24.13.50.09;	author sthen;	state Exp;
branches;
next	1.116;

1.116
date	2011.06.03.16.08.01;	author sthen;	state Exp;
branches;
next	1.115;

1.115
date	2011.06.02.20.10.01;	author sthen;	state Exp;
branches;
next	1.114;

1.114
date	2011.06.02.13.41.41;	author ajacoutot;	state Exp;
branches;
next	1.113;

1.113
date	2011.05.25.20.11.02;	author sthen;	state Exp;
branches;
next	1.112;

1.112
date	2011.05.11.15.07.14;	author sthen;	state Exp;
branches;
next	1.111;

1.111
date	2011.04.27.17.42.02;	author sthen;	state Exp;
branches;
next	1.110;

1.110
date	2011.04.21.22.28.40;	author sthen;	state Exp;
branches;
next	1.109;

1.109
date	2011.04.15.16.13.24;	author ajacoutot;	state Exp;
branches;
next	1.108;

1.108
date	2011.04.09.19.16.51;	author ian;	state Exp;
branches;
next	1.107;

1.107
date	2011.03.24.22.40.51;	author sthen;	state Exp;
branches;
next	1.106;

1.106
date	2011.03.20.15.37.06;	author ajacoutot;	state Exp;
branches;
next	1.105;

1.105
date	2011.03.17.21.38.09;	author sthen;	state Exp;
branches;
next	1.104;

1.104
date	2011.03.16.23.27.11;	author sthen;	state Exp;
branches;
next	1.103;

1.103
date	2011.03.09.18.51.48;	author ajacoutot;	state Exp;
branches;
next	1.102;

1.102
date	2011.03.02.13.28.24;	author sthen;	state Exp;
branches;
next	1.101;

1.101
date	2011.03.02.12.53.11;	author sthen;	state Exp;
branches;
next	1.100;

1.100
date	2011.01.20.21.44.54;	author sthen;	state Exp;
branches
	1.100.2.1;
next	1.99;

1.99
date	2011.01.20.16.26.26;	author sthen;	state Exp;
branches;
next	1.98;

1.98
date	2011.01.19.11.25.16;	author sthen;	state Exp;
branches;
next	1.97;

1.97
date	2011.01.04.22.35.46;	author fgsch;	state Exp;
branches;
next	1.96;

1.96
date	2010.11.20.19.56.47;	author espie;	state Exp;
branches;
next	1.95;

1.95
date	2010.11.16.21.58.52;	author sthen;	state Exp;
branches;
next	1.94;

1.94
date	2010.10.19.07.43.05;	author espie;	state Exp;
branches;
next	1.93;

1.93
date	2010.09.19.21.14.05;	author sthen;	state Exp;
branches;
next	1.92;

1.92
date	2010.08.27.00.48.19;	author sthen;	state Exp;
branches;
next	1.91;

1.91
date	2010.08.17.19.53.01;	author sthen;	state Exp;
branches;
next	1.90;

1.90
date	2010.07.25.10.08.03;	author sthen;	state Exp;
branches
	1.90.2.1;
next	1.89;

1.89
date	2010.07.05.22.03.22;	author sthen;	state Exp;
branches;
next	1.88;

1.88
date	2010.06.18.22.10.44;	author sthen;	state Exp;
branches;
next	1.87;

1.87
date	2010.06.07.20.03.55;	author sthen;	state Exp;
branches;
next	1.86;

1.86
date	2010.06.02.13.18.56;	author sthen;	state Exp;
branches;
next	1.85;

1.85
date	2010.05.04.23.02.58;	author sthen;	state Exp;
branches;
next	1.84;

1.84
date	2010.05.04.14.41.48;	author sthen;	state Exp;
branches;
next	1.83;

1.83
date	2010.05.04.12.42.33;	author sthen;	state Exp;
branches;
next	1.82;

1.82
date	2010.05.03.21.00.34;	author sthen;	state Exp;
branches;
next	1.81;

1.81
date	2010.04.14.08.23.38;	author sthen;	state Exp;
branches;
next	1.80;

1.80
date	2010.04.10.12.45.35;	author sthen;	state Exp;
branches;
next	1.79;

1.79
date	2010.04.09.11.05.55;	author sthen;	state Exp;
branches;
next	1.78;

1.78
date	2010.04.08.16.18.00;	author sthen;	state Exp;
branches;
next	1.77;

1.77
date	2010.04.02.23.18.53;	author sthen;	state Exp;
branches;
next	1.76;

1.76
date	2010.04.02.19.28.45;	author sthen;	state Exp;
branches;
next	1.75;

1.75
date	2010.03.25.12.01.47;	author sthen;	state Exp;
branches;
next	1.74;

1.74
date	2010.03.23.21.16.53;	author ajacoutot;	state Exp;
branches;
next	1.73;

1.73
date	2010.02.26.18.42.12;	author espie;	state Exp;
branches;
next	1.72;

1.72
date	2010.02.26.12.44.14;	author sthen;	state Exp;
branches;
next	1.71;

1.71
date	2010.02.03.00.18.44;	author sthen;	state Exp;
branches;
next	1.70;

1.70
date	2010.01.17.13.18.36;	author sthen;	state Exp;
branches;
next	1.69;

1.69
date	2009.12.21.00.19.02;	author fgsch;	state Exp;
branches;
next	1.68;

1.68
date	2009.12.19.00.09.37;	author sthen;	state Exp;
branches;
next	1.67;

1.67
date	2009.12.14.04.49.24;	author fgsch;	state Exp;
branches;
next	1.66;

1.66
date	2009.12.13.12.23.57;	author sthen;	state Exp;
branches;
next	1.65;

1.65
date	2009.12.13.12.11.29;	author sthen;	state Exp;
branches;
next	1.64;

1.64
date	2009.11.30.22.51.39;	author sthen;	state Exp;
branches;
next	1.63;

1.63
date	2009.11.19.16.17.04;	author sthen;	state Exp;
branches;
next	1.62;

1.62
date	2009.11.04.21.51.49;	author sthen;	state Exp;
branches;
next	1.61;

1.61
date	2009.11.04.21.49.42;	author sthen;	state Exp;
branches;
next	1.60;

1.60
date	2009.09.04.00.46.35;	author sthen;	state Exp;
branches;
next	1.59;

1.59
date	2009.08.18.22.09.40;	author sthen;	state Exp;
branches;
next	1.58;

1.58
date	2009.08.10.23.22.31;	author sthen;	state Exp;
branches;
next	1.57;

1.57
date	2009.07.21.22.05.24;	author sthen;	state Exp;
branches;
next	1.56;

1.56
date	2009.06.15.23.33.57;	author sthen;	state Exp;
branches
	1.56.2.1;
next	1.55;

1.55
date	2009.06.05.23.10.40;	author sthen;	state Exp;
branches;
next	1.54;

1.54
date	2009.05.22.09.05.10;	author sthen;	state Exp;
branches;
next	1.53;

1.53
date	2009.04.05.22.37.35;	author sthen;	state Exp;
branches;
next	1.52;

1.52
date	2009.04.02.19.37.25;	author sthen;	state Exp;
branches;
next	1.51;

1.51
date	2009.03.29.22.23.35;	author sthen;	state Exp;
branches;
next	1.50;

1.50
date	2009.03.10.21.12.37;	author sthen;	state Exp;
branches;
next	1.49;

1.49
date	2009.01.24.11.22.26;	author sthen;	state Exp;
branches;
next	1.48;

1.48
date	2009.01.10.00.58.15;	author sthen;	state Exp;
branches;
next	1.47;

1.47
date	2009.01.08.21.04.02;	author sthen;	state Exp;
branches;
next	1.46;

1.46
date	2008.10.28.15.21.49;	author naddy;	state Exp;
branches;
next	1.45;

1.45
date	2008.10.07.09.57.52;	author sthen;	state Exp;
branches;
next	1.44;

1.44
date	2008.07.23.08.57.10;	author sthen;	state Exp;
branches;
next	1.43;

1.43
date	2008.06.30.20.03.49;	author sthen;	state Exp;
branches;
next	1.42;

1.42
date	2008.06.14.16.00.10;	author sthen;	state Exp;
branches;
next	1.41;

1.41
date	2008.06.02.23.33.51;	author sthen;	state Exp;
branches;
next	1.40;

1.40
date	2008.05.27.22.14.34;	author sthen;	state Exp;
branches;
next	1.39;

1.39
date	2008.05.27.20.56.12;	author sthen;	state Exp;
branches;
next	1.38;

1.38
date	2008.05.22.19.29.50;	author ajacoutot;	state Exp;
branches;
next	1.37;

1.37
date	2008.05.13.23.49.57;	author sthen;	state Exp;
branches;
next	1.36;

1.36
date	2008.04.23.07.04.09;	author sthen;	state Exp;
branches;
next	1.35;

1.35
date	2008.04.02.23.18.11;	author sthen;	state Exp;
branches;
next	1.34;

1.34
date	2008.03.19.08.18.10;	author sthen;	state Exp;
branches;
next	1.33;

1.33
date	2008.03.15.17.41.12;	author ajacoutot;	state Exp;
branches;
next	1.32;

1.32
date	2008.02.07.22.08.30;	author sthen;	state Exp;
branches;
next	1.31;

1.31
date	2008.01.03.02.23.30;	author sthen;	state Exp;
branches;
next	1.30;

1.30
date	2007.12.21.10.22.19;	author sthen;	state Exp;
branches;
next	1.29;

1.29
date	2007.12.20.13.57.22;	author sthen;	state Exp;
branches;
next	1.28;

1.28
date	2007.12.19.21.07.27;	author sthen;	state Exp;
branches;
next	1.27;

1.27
date	2007.12.01.10.11.53;	author sthen;	state Exp;
branches;
next	1.26;

1.26
date	2007.11.27.10.41.04;	author sthen;	state Exp;
branches;
next	1.25;

1.25
date	2007.10.11.08.05.18;	author sthen;	state Exp;
branches;
next	1.24;

1.24
date	2007.10.04.11.25.44;	author sthen;	state Exp;
branches;
next	1.23;

1.23
date	2007.09.05.22.42.52;	author sthen;	state Exp;
branches;
next	1.22;

1.22
date	2007.09.04.10.33.19;	author sthen;	state Exp;
branches;
next	1.21;

1.21
date	2007.07.19.01.31.27;	author ian;	state Exp;
branches;
next	1.20;

1.20
date	2007.07.02.14.03.34;	author jolan;	state Exp;
branches;
next	1.19;

1.19
date	2007.05.02.17.29.25;	author jolan;	state Exp;
branches;
next	1.18;

1.18
date	2007.03.21.15.51.54;	author jolan;	state Exp;
branches;
next	1.17;

1.17
date	2007.03.15.10.56.31;	author jolan;	state Exp;
branches;
next	1.16;

1.16
date	2007.02.11.01.03.28;	author ian;	state Exp;
branches
	1.16.2.1;
next	1.15;

1.15
date	2006.12.29.22.21.41;	author steven;	state Exp;
branches;
next	1.14;

1.14
date	2006.12.22.22.16.10;	author jolan;	state Exp;
branches;
next	1.13;

1.13
date	2006.10.19.21.19.07;	author jolan;	state Exp;
branches;
next	1.12;

1.12
date	2006.10.18.00.18.36;	author jolan;	state Exp;
branches;
next	1.11;

1.11
date	2006.09.24.21.09.25;	author jolan;	state Exp;
branches;
next	1.10;

1.10
date	2006.06.15.06.39.50;	author steven;	state Exp;
branches
	1.10.2.1;
next	1.9;

1.9
date	2006.06.12.19.04.10;	author naddy;	state Exp;
branches;
next	1.8;

1.8
date	2006.02.15.06.11.39;	author sturm;	state Exp;
branches
	1.8.2.1;
next	1.7;

1.7
date	2006.02.02.16.12.24;	author jolan;	state Exp;
branches;
next	1.6;

1.6
date	2006.02.02.03.41.36;	author todd;	state Exp;
branches;
next	1.5;

1.5
date	2005.08.15.17.36.06;	author jolan;	state Exp;
branches
	1.5.2.1;
next	1.4;

1.4
date	2005.05.09.16.50.05;	author jcs;	state Exp;
branches;
next	1.3;

1.3
date	2005.05.01.02.12.46;	author jcs;	state Exp;
branches;
next	1.2;

1.2
date	2004.12.05.15.15.20;	author alek;	state Exp;
branches;
next	1.1;

1.1
date	2004.09.26.00.38.23;	author jolan;	state Exp;
branches
	1.1.1.1;
next	;

1.1.1.1
date	2004.09.26.00.38.23;	author jolan;	state Exp;
branches;
next	;

1.5.2.1
date	2006.06.15.15.35.23;	author sturm;	state Exp;
branches;
next	1.5.2.2;

1.5.2.2
date	2006.10.20.11.10.11;	author sturm;	state Exp;
branches;
next	;

1.8.2.1
date	2006.06.15.15.34.35;	author sturm;	state Exp;
branches;
next	1.8.2.2;

1.8.2.2
date	2006.10.20.13.54.44;	author sturm;	state Exp;
branches;
next	1.8.2.3;

1.8.2.3
date	2007.03.19.21.41.35;	author sturm;	state Exp;
branches;
next	1.8.2.4;

1.8.2.4
date	2007.03.22.21.36.51;	author sturm;	state Exp;
branches;
next	;

1.10.2.1
date	2006.11.01.13.45.31;	author sturm;	state Exp;
branches;
next	1.10.2.2;

1.10.2.2
date	2007.03.19.21.12.42;	author sturm;	state Exp;
branches;
next	1.10.2.3;

1.10.2.3
date	2007.03.23.07.26.47;	author sturm;	state Exp;
branches;
next	1.10.2.4;

1.10.2.4
date	2007.05.05.08.22.00;	author sturm;	state Exp;
branches;
next	1.10.2.5;

1.10.2.5
date	2007.07.06.13.53.36;	author sturm;	state Exp;
branches;
next	1.10.2.6;

1.10.2.6
date	2007.08.09.17.11.02;	author ajacoutot;	state Exp;
branches;
next	;

1.16.2.1
date	2007.05.01.16.16.42;	author sturm;	state Exp;
branches;
next	1.16.2.2;

1.16.2.2
date	2007.05.05.08.23.27;	author sturm;	state Exp;
branches;
next	1.16.2.3;

1.16.2.3
date	2007.07.06.13.52.18;	author sturm;	state Exp;
branches;
next	1.16.2.4;

1.16.2.4
date	2007.08.02.08.24.38;	author ajacoutot;	state Exp;
branches;
next	;

1.56.2.1
date	2009.11.23.03.42.45;	author william;	state Exp;
branches;
next	1.56.2.2;

1.56.2.2
date	2009.12.23.00.41.16;	author william;	state Exp;
branches;
next	;

1.90.2.1
date	2011.01.22.09.21.56;	author sthen;	state Exp;
branches;
next	;

1.100.2.1
date	2011.06.03.16.10.21;	author sthen;	state Exp;
branches;
next	1.100.2.2;

1.100.2.2
date	2011.06.24.13.52.35;	author sthen;	state Exp;
branches;
next	;

1.121.2.1
date	2011.10.17.19.54.16;	author sthen;	state Exp;
branches;
next	1.121.2.2;

1.121.2.2
date	2011.12.09.00.22.50;	author sthen;	state Exp;
branches;
next	1.121.2.3;

1.121.2.3
date	2012.03.16.10.28.48;	author sthen;	state Exp;
branches;
next	;

1.134.2.1
date	2012.04.11.15.12.47;	author sthen;	state Exp;
branches;
next	1.134.2.2;

1.134.2.2
date	2012.04.23.21.41.03;	author sthen;	state Exp;
branches;
next	1.134.2.3;

1.134.2.3
date	2012.07.06.19.37.02;	author sthen;	state Exp;
branches;
next	;

1.153.2.1
date	2012.12.09.13.21.43;	author sthen;	state Exp;
branches;
next	1.153.2.2;

1.153.2.2
date	2013.01.02.22.34.16;	author sthen;	state Exp;
branches;
next	1.153.2.3;

1.153.2.3
date	2013.03.17.12.53.09;	author sthen;	state Exp;
branches;
next	1.153.2.4;

1.153.2.4
date	2013.03.27.22.49.02;	author sthen;	state Exp;
branches;
next	;

1.170.2.1
date	2013.05.01.09.11.06;	author sthen;	state Exp;
branches;
next	1.170.2.2;

1.170.2.2
date	2013.08.28.09.46.46;	author sthen;	state Exp;
branches;
next	;

1.184.2.1
date	2013.10.30.12.53.33;	author jasper;	state Exp;
branches;
next	;

1.202.2.1
date	2014.11.21.12.42.59;	author sthen;	state Exp;
branches;
next	1.202.2.2;
commitid	3vjlsjP3joK2hNK8;

1.202.2.2
date	2014.12.12.19.18.39;	author sthen;	state Exp;
branches;
next	;
commitid	qE34QkkY7p1jAl9W;

1.214.2.1
date	2015.04.02.17.21.01;	author sthen;	state Exp;
branches;
next	;
commitid	77NV89UWaeltDPPP;

1.226.2.1
date	2016.05.06.19.51.59;	author sthen;	state Exp;
branches;
next	;
commitid	MNvllYhiYcbujMNc;


desc
@@


1.264
log
@update to asterisk-13.17.2 - fix AST-2017-008 RTP/RTCP problems, followup
to AST-2017-005.

The RTP/RTCP stack will now validate RTCP packets before processing
them. Packets failing validation are discarded. RTP stream qualification
now requires the intended series of packets from the same address
without seeing packets from a different source address to accept a new
source address.
@
text
@# $OpenBSD: Makefile,v 1.263 2017/09/01 09:55:28 sthen Exp $

BROKEN-aarch64=	linker problems with BlocksRuntime that only show up at runtime

COMMENT-main=	open source multi-protocol PBX and telephony toolkit

VER=		13.17.2
PJ_V=		2.6
PORTROACH=	limitw:0,odd
DISTNAME=	asterisk-${VER:S/beta/-beta/:S/rc/-rc/}
DISTFILES=	${DISTNAME}${EXTRACT_SUFX} pjproject-${PJ_V}.tar.bz2:0
PKGNAME-main=	asterisk-${VER}

CATEGORIES=	telephony

HOMEPAGE=	http://www.asterisk.org/

MAINTAINER=	Stuart Henderson <sthen@@openbsd.org>

# Mostly GPL v2 (only). "Specific permission is also granted to link
# Asterisk with OpenSSL and OpenH323 and distribute the resulting binary
# files." iLBC codec has BSD-like license terms, but also see patent
# notes in codecs/ilbc/LICENSE_ADDENDUM.
PERMIT_PACKAGE_CDROM=	patent licensing clauses
PERMIT_PACKAGE_FTP=	Yes

WANTLIB-main += ${MODGCC4_CPPWANTLIB}
WANTLIB-main += c crypto curl execinfo gsm iconv iksemel jansson lzma
WANTLIB-main += m nghttp2 ogg portaudio pthread spandsp sqlite3 ssl
WANTLIB-main += termcap tiff uriparser uuid vorbis vorbisenc vorbisfile
WANTLIB-main += xml2 xslt z

# XXX Requires either nested functions (gcc only), or -fblocks (clang).
#
# With clang -fblocks, configure test fails on ld.bfd arches:
#
#    echo 'int main(){return ^{return 42;}();}' | \
#         clang -o /tmp/blockstest -fblocks -x c -L/usr/local/lib -lBlocksRuntime -
#
# -> undefined reference to `_NSConcreteGlobalBlock'
#
# Runtime fails on ld.lld arches: dlopen()ing the .so modules results in
# undefined symbols from the BlocksRuntime lib.
#
# keep telephony/asterisk-g729 in sync with this
COMPILER =		base-gcc ports-gcc

SHARED_LIBS+=		asteriskssl 0.0		# 1
SHARED_LIBS+=		asteriskpj 0.0		# 2

MULTI_PACKAGES=		-main -calendar -http_post -ldap -odbc \
			-pgsql -snmp -speex -tds
PSEUDO_FLAVORS=		${MULTI_PACKAGES:N-main:C/-/no_/g}

LIB_DEPENDS-main=	${MODGCC4_CPPLIBDEP} \
			audio/gsm \
			audio/libogg \
			audio/libvorbis \
			audio/portaudio-svn \
			converters/libiconv \
			databases/sqlite3 \
			devel/libexecinfo \
			devel/jansson \
			graphics/tiff \
			net/curl \
			sysutils/e2fsprogs \
			telephony/spandsp \
			textproc/iksemel \
			textproc/libxml \
			textproc/libxslt \
			www/uriparser
RUN_DEPENDS-main=	telephony/asterisk-sounds/core-sounds/en,gsm>=1.4.25 \
			telephony/asterisk-sounds/moh-opsound,wav
BUILD_DEPENDS=		security/libsrtp>=1.4.4 # statically linked

MASTER_SITES=	https://downloads.asterisk.org/pub/telephony/asterisk/releases/ \
		https://downloads.asterisk.org/pub/telephony/asterisk/old-releases/
MASTER_SITES0=	http://www.pjsip.org/release/${PJ_V}/

USE_GMAKE=		Yes

CONFIGURE_STYLE=	gnu
AUTOCONF_VERSION=	2.69
AUTOMAKE_VERSION=	1.15
BUILD_DEPENDS+=		${MODGNU_AUTOCONF_DEPENDS} \
			${MODGNU_AUTOMAKE_DEPENDS} \
			archivers/bzip2 \
			devel/libtool,-ltdl # bogus dependencies in menuselect

CPPFLAGS+=		-I${X11BASE}/include -I${LOCALBASE}/include
LDFLAGS+=		-L${X11BASE}/lib -L${LOCALBASE}/lib
CONFIGURE_ENV+=		CPPFLAGS="${CPPFLAGS}" \
			CFLAGS="${CFLAGS}" \
			LDFLAGS="${LDFLAGS}" \
			LIBS="-lpthread" \
			NOISY_BUILD="Yes" \
			ac_cv_path_LDCONFIG=:
MAKE_FLAGS+=		ASTCFLAGS="${CFLAGS}" \
			ASTLDFLAGS="${LDFLAGS}" \
			ASTSSL_SO_VERSION="${LIBasteriskssl_VERSION}" \
			ASTPJ_SO_VERSION="${LIBasteriskpj_VERSION}" \
			NOISY_BUILD="Yes" \
			OPTIMIZE=

CONFIGURE_ARGS+=	--localstatedir=/var \
			--with-externals-cache=${FULLDISTDIR} \
			--with-pjproject-bundled

CONFIGURE_ARGS+=	--with-asound=no \
			--with-cap=no \
			--with-dahdi=no \
			--with-gtk2=no \
			--with-h323=no \
			--with-isdnnet=no \
			--with-misdn=no \
			--with-nbs=no \
			--with-newt=no \
			--with-osptk=no \
			--with-oss=no \
			--with-portaudio=${LOCALBASE} \
			--with-pri=no \
			--with-pwlib=no \
			--with-SDL_image=no \
			--with-sdl=no \
			--with-sqlite=no \
			--with-ss7=no \
			--with-suppserv=no \
			--with-tinfo=no \
			--with-tonezone=no \
			--with-vpb=no

CONFIGURE_ARGS+=	--with-jack=no \
			--with-lua=no \
			--with-radius=no \
			--with-resample=no

# Some build options (including a useful malloc debug) are available
# via menuselect. They may be enabled by running 'make configure', cd
# to WRKSRC, 'gmake menuselect', then 'cd -' back to the port directory
# and 'make'.

FLAVOR?=
FLAVORS=		imap

## flavours:

.if ${FLAVOR:Mimap}
CONFIGURE_ARGS+=	--with-imap=system
MAKE_FLAGS+=		MENUSELECT_OPTS_app_voicemail=IMAP_STORAGE
CPPFLAGS+=		-I${LOCALBASE}/include/c-client
LIB_DEPENDS-main+=	mail/alpine,-c-client
WANTLIB-main+=		c-client
.else
CONFIGURE_ARGS+=	--with-imap=no
.endif

## multipackages:
.include <bsd.port.arch.mk>

#.if ${PROPERTIES:Mclang}
#BUILD_DEPENDS+=		devel/blocksruntime
#.endif

# calendar
COMMENT-calendar=	calendar support for Asterisk
WANTLIB-calendar=	crypto expat ical iconv intl iksemel lzma
WANTLIB-calendar+=	m neon proxy pthread ssl xml2 z

LIB_DEPENDS-calendar=	devel/gettext \
			net/neon \
			textproc/libical
.if !${BUILD_PACKAGES:M-calendar}
CONFIGURE_ARGS+=	--with-ical=no
.endif

# http_post
COMMENT-http_post=	HTTP POST support for Asterisk
LIB_DEPENDS-http_post=	devel/gettext mail/gmime
WANTLIB-http_post=	gio-2.0 glib-2.0 gmime-2.6 gobject-2.0 intl pthread
.if !${BUILD_PACKAGES:M-http_post}
CONFIGURE_ARGS+=	--with-gmime=no
.endif

# ldap
COMMENT-ldap=		LDAP support for Asterisk
LIB_DEPENDS-ldap=	databases/openldap,-main
WANTLIB-ldap=		ldap pthread
.if !${BUILD_PACKAGES:M-ldap}
CONFIGURE_ARGS+=	--with-ldap=no
.endif

# freetds
COMMENT-tds=		MSSQL/Sybase support for Asterisk
LIB_DEPENDS-tds=	databases/freetds
WANTLIB-tds=		pthread sybdb
.if !${BUILD_PACKAGES:M-tds}
CONFIGURE_ARGS+=	--with-tds=no
.else
CONFIGURE_ARGS+=	--with-tds=${LOCALBASE}
.endif

# odbc
COMMENT-odbc=		ODBC support for Asterisk
LIB_DEPENDS-odbc=	databases/iodbc
WANTLIB-odbc=		iodbc pthread
.if !${BUILD_PACKAGES:M-odbc}
CONFIGURE_ARGS+=	--with-iodbc=no \
			--with-ltdl=no
.endif

# postgresql
COMMENT-pgsql=		PostgreSQL support for Asterisk
WANTLIB-pgsql=		pq pthread z
LIB_DEPENDS-pgsql=	databases/postgresql
.if !${BUILD_PACKAGES:M-pgsql}
CONFIGURE_ARGS+=	--with-postgres=no
.endif

# snmp
COMMENT-snmp=		Net-SNMP support for Asterisk
WANTLIB-snmp=		crypto kvm m netsnmp netsnmpagent netsnmpmibs pthread
LIB_DEPENDS-snmp=	net/net-snmp
.if !${BUILD_PACKAGES:M-snmp}
CONFIGURE_ARGS+=	--with-snmp=no
.endif

# speex
COMMENT-speex=		Speex codec for Asterisk
WANTLIB-speex=		m pthread speex speexdsp
LIB_DEPENDS-speex=	audio/speex>=1.2rc1
.if !${BUILD_PACKAGES:M-speex}
CONFIGURE_ARGS+=	--with-speex=no
.endif

NO_TEST=		Yes
INSTALL_TARGET=		install samples
EXAMPLEDIR=		${PREFIX}/share/examples/asterisk
EXAMPLEFILES=		cdr.conf extensions.ael extensions.conf logger.conf \
			modules.conf musiconhold.conf sip.conf voicemail.conf

.for i in ${MULTI_PACKAGES:N-main}
# subpackages aren't flavoured, so overwrite the default name/path
FULLPKGNAME$i ?=	asterisk$i-${VER}
FULLPKGPATH$i ?=	${PKGPATH},$i
RUN_DEPENDS$i +=	asterisk-${VER}:telephony/asterisk
.endfor

# otherwise asterisk patchset for pjsua gets in the way
PATCHORIG=		.orig.port

# some of the patches have MS-DOS line endings which patch doesn't like
post-extract:
	@@cd ${WRKSRC}/third-party/; \
	    grep 'PJPROJECT_VERSION = ${PJ_V}$$' versions.mak > /dev/null || \
	    (echo "PJ_V != PJPROJECT_VERSION; update in port"; \
	     grep 'PJPROJECT_VERSION' versions.mak; exit 1)
	@@perl -i -pe 's/\r$$//' ${WRKSRC}/third-party/pjproject/patches/*patch
	mv ${WRKDIR}/pjproject-${PJ_V} ${WRKSRC}/third-party/pjproject/source
	cd ${WRKSRC}/third-party/pjproject; ./apply_patches patches source
	touch ${WRKSRC}/third-party/pjproject/source/.unpacked

post-patch:
.if ${PROPERTIES:Mclang}
	sed -i.beforesubst -e 's, -ftrampolines,,' ${WRKSRC}/Makefile
.endif
	cd ${WRKSRC}; \
	    AUTOMAKE_VERSION=${AUTOMAKE_VERSION} \
	    AUTOCONF_VERSION=${AUTOCONF_VERSION} \
	    ./bootstrap.sh

post-install:
	${INSTALL_DATA_DIR} ${PREFIX}/share/doc/asterisk
	${INSTALL_DATA} ${WRKSRC}/{BUGS,CHANGES,COPYING,CREDITS} \
		${WRKSRC}/{ChangeLog,LICENSE,README*,UPGRADE*.txt} \
		${PREFIX}/share/doc/asterisk
	${INSTALL_DATA} ${WRKSRC}/doc/*.{pdf,txt,odt} \
		${PREFIX}/share/doc/asterisk
	${INSTALL_DATA_DIR} ${EXAMPLEDIR}/basic-pbx
	${INSTALL_DATA} ${WRKSRC}/configs/basic-pbx/* ${EXAMPLEDIR}/basic-pbx
	${INSTALL_DATA_DIR} ${EXAMPLEDIR}/openbsd
.for i in ${EXAMPLEFILES}
	@@${SUBST_CMD} -c -m 444 ${FILESDIR}/$i.sample \
	    ${EXAMPLEDIR}/openbsd/$i.sample
.endfor
	${INSTALL_DATA} ${WRKSRC}/contrib/scripts/asterisk.ldif \
		${WRKSRC}/contrib/scripts/asterisk.ldap-schema \
		${PREFIX}/share/examples/asterisk/
	@@mv ${WRKINST}/${SYSCONFDIR}/asterisk ${EXAMPLEDIR}/default
	@@chown -R ${SHAREOWN}:${SHAREGRP} ${EXAMPLEDIR}
	@@rm -rf ${WRKINST}/{etc,var/{log,run,spool}}/asterisk

.include <bsd.port.mk>
@


1.263
log
@- fix build when pjproject distfile is older than version.mak, breakage
reported by nigel@@

- avoid hardcoded -O3 in pjsip build, honour CFLAGS instead
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.262 2017/08/31 21:34:05 sthen Exp $
d7 1
a7 1
VER=		13.17.1
a8 1
REVISION-main=	0
@


1.262
log
@update to asterisk-13.17.1

AST-2017-005: Media takeover in RTP stack
AST-2017-006: Shell access command injection in app_minivm
AST-2017-007: Remote Crash Vulerability in res_pjsip

also install the basic-pbx sample configs
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.261 2017/08/22 22:51:04 sthen Exp $
d9 1
d77 2
a78 2
MASTER_SITES=	http://downloads.asterisk.org/pub/telephony/asterisk/releases/ \
		http://downloads.asterisk.org/pub/telephony/asterisk/old-releases/
d97 1
@


1.261
log
@add comment noting that these two ports should keep COMPILER in sync
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.260 2017/08/22 10:27:33 espie Exp $
d7 1
a7 1
VER=		13.17.0
a12 1
REVISION=	0
d277 2
@


1.260
log
@rework COMPILER yet again. new version should be easier to grasp
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.259 2017/08/05 12:29:21 sthen Exp $
d46 1
@


1.259
log
@Switch Asterisk to a gcc build (it requires either nested functions,
which are gcc-specific, or clang with -fblocks, which we don't have
working fully yet).

To avoid a C++ standard library conflict, switch to a stripped-down and
patched copy of pjsua/pjsip built as part of the Asterisk build.

Some slight patch gymnastics; Asterisk doesn't distribute pjsua itself
but rather normally downloads, untars and patches as part of the build,
which isn't compatible with the patches we need to apply in order to
fix it with libressl.
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.258 2017/07/16 19:19:02 espie Exp $
d46 1
a46 1
COMPILER =		gcc-only
@


1.258
log
@use COMPILER_LIBCXX where applicable
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.257 2017/07/12 19:55:29 sthen Exp $
d3 1
a3 13
# XXX uses -fblocks on clang, or nested functions on gcc.
#
# on clang/ld.bfd arches, the configure test fails to link. test looks like this:
#
#    echo 'int main(){return ^{return 42;}();}' | \
#         clang -o /tmp/blockstest -fblocks -x c -L/usr/local/lib -lBlocksRuntime -
#
# -> undefined reference to `_NSConcreteGlobalBlock'
#
# on clang/ld.lld arches, it builds ok but runtime fails: dlopen()ing the .so modules
# at runtime fails with undefined symbols from the BlocksRuntime lib.
#
BROKEN-aarch64=		linker problems with BlocksRuntime that only show up at runtime
d5 1
a5 1
COMMENT-main=		open source multi-protocol PBX and telephony toolkit
d7 7
a13 4
VER=			13.17.0
PORTROACH=		limitw:0,odd
DISTNAME=		asterisk-${VER:S/beta/-beta/:S/rc/-rc/}
PKGNAME-main=		asterisk-${VER}
d15 1
a15 1
CATEGORIES=		telephony
d17 1
a17 1
HOMEPAGE=		http://www.asterisk.org/
d19 1
a19 1
MAINTAINER=		Stuart Henderson <sthen@@openbsd.org>
d28 5
a32 7
WANTLIB-main += c crypto curl execinfo g7221codec gsm iconv iksemel
WANTLIB-main += ilbccodec jansson lzma m nghttp2 ogg opencore-amrnb
WANTLIB-main += opencore-amrwb pj pjlib-util pjmedia pjmedia-audiodev
WANTLIB-main += pjmedia-codec pjmedia-videodev pjnath pjsip pjsip-simple
WANTLIB-main += pjsip-ua pjsua pjsua2 portaudio pthread resample spandsp
WANTLIB-main += speex speexdsp sqlite3 ssl ${COMPILER_LIBCXX} termcap tiff uriparser
WANTLIB-main += uuid vorbis vorbisenc vorbisfile xml2 xslt z
d34 16
a49 1
SHARED_LIBS=		asteriskssl 0.0		# 1
d55 2
a56 1
LIB_DEPENDS-main=	audio/gsm \
a66 1
			telephony/pjsua,-main \
d78 1
a78 13

# if using bundled pjproject:
#
#CONFIGURE_ARGS+= --with-pjproject-bundled
#PJ_V=		2.5.5
#MASTER_SITES0=	http://www.pjsip.org/release/${PJ_V}/
#EXTRACT_ONLY=	${DISTNAME}${EXTRACT_SUFX}
#DISTFILES=	${DISTNAME}${EXTRACT_SUFX} pjproject-${PJ_V}.tar.bz2:0
#
#	@@cd ${WRKSRC}/third-party/; \
#	    grep 'PJPROJECT_VERSION = ${PJ_V}$$' versions.mak > /dev/null || \
#	    (echo "PJ_V != PJPROJECT_VERSION; update in port"; \
#	     grep 'PJPROJECT_VERSION' versions.mak; exit 1)
d100 1
d105 2
a106 1
			--with-externals-cache=${FULLDISTDIR}
d159 4
d247 13
a259 3
.if ${PROPERTIES:Mclang}
BUILD_DEPENDS+=		devel/blocksruntime
.endif
@


1.257
log
@update to asterisk-13.17.0
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.256 2017/05/26 15:42:45 sthen Exp $
d42 1
a42 1
WANTLIB-main += speex speexdsp sqlite3 ssl ${LIBCXX} termcap tiff uriparser
@


1.256
log
@update to asterisk-13.15.1, fixing AST-2017-004: Memory exhaustion
on short SCCP packets. This only affects SCCP users (chan_skinny).

13.15.1 also added some fixes to the bundled copy of PJSIP
(used by chan_pjsip, *not* used by chan_sip) -
AST-2017-002: Buffer Overrun in PJSIP transaction layer,
AST-2017-003: Crash in PJSIP multi-part body parser
- however that copy is not used by this package and will need to
be fixed separately.
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.255 2017/05/26 15:30:49 sthen Exp $
d19 1
a19 1
VER=			13.15.1
@


1.255
log
@pass LDFLAGS to the autoconf test for clang -fblocks. still broken:

- clang + ld.bfd: link fails in autoconf test, undefined symbols.

- clang + ld.lld: package builds, dlopen()ing the .so modules that use -fblocks
fails at runtime.

because with clang + ld.lld it does build but results in unusable packages,
explicitly mark BROKEN-aarch64 for now.
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.254 2017/04/10 11:46:34 sthen Exp $
d19 1
a19 1
VER=			13.15.0
@


1.254
log
@use LIBCXX
@
text
@d1 15
a15 1
# $OpenBSD: Makefile,v 1.253 2017/04/07 21:32:20 sthen Exp $
d249 4
d254 3
@


1.253
log
@update to asterisk-13.15.0.

add various OPENSSL_VERSION_NUMBER patches now that asterisk supports
openssl 1.1:

- we don't have openssl 1.1's SSL_is_server yet, so use the old check
for ssl->server instead

- we do still need the hack to avoid initing multiple times which is
no longer needed in openssl 1.1
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.252 2017/04/05 10:27:36 sthen Exp $
d28 1
a28 1
WANTLIB-main += speex speexdsp sqlite3 ssl stdc++ termcap tiff uriparser
@


1.252
log
@update to asterisk-13.14.1

http://downloads.digium.com/pub/security/AST-2017-001.html

CDR: Protect from data overflow in ast_cdr_setuserfield.
ast_cdr_setuserfield wrote to a fixed length field using strcpy.
This could result in a buffer overrun when called from chan_sip or
func_cdr. This patch adds a maximum bytes written to the field by using
ast_copy_string instead.
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.251 2017/03/18 21:49:48 sthen Exp $
d5 1
a5 1
VER=			13.14.1
@


1.251
log
@convert another getprotobyname()
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.250 2017/03/18 21:42:04 sthen Exp $
d5 1
a5 1
VER=			13.14.0
a8 1
REVISION-main=		1
@


1.250
log
@Don't use thread-unsafe getprotobyname(), patch from jira ticket ASTERISK-26759.
Teach some helper scripts about common coredump paths in OpenBSD.
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.249 2017/02/14 12:31:38 sthen Exp $
d9 1
a9 1
REVISION-main=		0
@


1.249
log
@update to asterisk-13.14.0
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.248 2017/02/07 21:09:10 kili Exp $
d9 1
@


1.248
log
@Revert the -kqueue subpackage changes that snucked in by accident.

ok sthen@@
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.247 2017/02/06 10:11:31 sthen Exp $
d5 1
a5 2
VER=			13.13.1
REVISION-main=		1
@


1.247
log
@raise debug level of other audiohook messages, even debug level 1 is unusable
on a busy system
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.246 2017/02/02 14:04:07 sthen Exp $
d34 1
a34 1
MULTI_PACKAGES=		-main -calendar -http_post -kqueue -ldap -odbc \
d36 1
a36 1
PSEUDO_FLAVORS=		${MULTI_PACKAGES:N-main:N-kqueue:C/-/no_/g}
a150 4

# kqueue. normally a pthread timing source is used, the kqueue-based one
# performs poorly with default HZ.
COMMENT-kqueue=		kqueue(2)-based timing source for Asterisk
@


1.246
log
@Patch to raise level of Asterisk's "Read factory %p and write factory %p
both fail to provide %zu samples" debug message which is triggering very
frequently, so that it's possible to get debug level 5 messages without
flattening the box.
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.245 2016/12/10 12:25:44 sthen Exp $
d6 1
a6 1
REVISION-main=		0
d34 1
a34 1
MULTI_PACKAGES=		-main -calendar -http_post -ldap -odbc \
d36 1
a36 1
PSEUDO_FLAVORS=		${MULTI_PACKAGES:N-main:C/-/no_/g}
d151 4
@


1.245
log
@update to asterisk-13.13.1
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.244 2016/11/29 13:57:49 sthen Exp $
d6 1
@


1.244
log
@update to asterisk-13.13.0
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.243 2016/11/11 10:55:17 sthen Exp $
d5 1
a5 1
VER=			13.13.0
@


1.243
log
@update to asterisk-13.12.2, fixing a chan_sip rtptimeout problem introduced
in 13.12.1 that would cause calls to be dropped early
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.242 2016/11/04 11:35:20 sthen Exp $
d5 1
a5 1
VER=			13.12.2
d23 6
a28 6
WANTLIB-main += c crypto curl execinfo g7221codec gsm iksemel ilbccodec
WANTLIB-main += iconv jansson lzma m nghttp2 ogg opencore-amrnb opencore-amrwb
WANTLIB-main += pj pjlib-util pjmedia pjmedia-audiodev pjmedia-codec
WANTLIB-main += pjmedia-videodev pjnath pjsip pjsip-simple pjsip-ua
WANTLIB-main += pjsua pjsua2 portaudio pthread resample spandsp speex
WANTLIB-main += speexdsp sqlite3 ssl stdc++ termcap tiff uriparser
d61 12
a72 2
EXTRACT_ONLY=	${DISTNAME}${EXTRACT_SUFX}
DISTFILES=	${DISTNAME}${EXTRACT_SUFX}
d81 1
d97 2
a98 1
CONFIGURE_ARGS+=	--localstatedir=/var
@


1.242
log
@sync WANTLIB (and in one case, add gettext to LIB_DEPENDS) in dependent ports
now that internationalised domain name support has been removed from net/curl
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.241 2016/10/29 19:21:13 sthen Exp $
d5 1
a5 1
VER=			13.12.1
a8 1
REVISION-main=		0
@


1.241
log
@update to asterisk-13.12.1
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.240 2016/09/23 09:16:57 sthen Exp $
d9 1
d24 1
a24 1
WANTLIB-main += c crypto curl execinfo g7221codec gsm idn iksemel ilbccodec
@


1.240
log
@Cope with moving sqlite3 back to ports.
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.239 2016/09/13 12:13:03 sthen Exp $
d5 1
a5 1
VER=			13.11.2
a8 2
REVISION-main=		0
REVISION-calendar=	0
@


1.239
log
@update to asterisk-13.11.2

res_pjsip: Do not crash on ACKs from unknown endpoints
chan_sip: Don't allocate new RTP instances on top of old ones
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.238 2016/09/02 11:09:37 sthen Exp $
d9 2
d44 1
@


1.238
log
@sync WANTLIB
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.237 2016/09/02 10:34:59 sthen Exp $
d5 1
a5 1
VER=			13.11.0
a8 7
REVISION-calendar=	0
REVISION-http_post=	0
REVISION-ldap=		0
REVISION-pgsql=		0
REVISION-snmp=		0
REVISION-speex=		0
REVISION-tds=		0
d24 1
a24 1
WANTLIB-main += iconv jansson m nghttp2 ogg opencore-amrnb opencore-amrwb
d140 1
a140 1
WANTLIB-calendar=	crypto expat ical iconv intl iksemel
@


1.237
log
@update to asterisk-13.11.0
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.236 2016/07/30 21:12:15 sthen Exp $
d9 7
d148 1
a148 1
WANTLIB-calendar+=	m neon proxy ssl xml2 z
d160 1
a160 1
WANTLIB-http_post=	gio-2.0 glib-2.0 gmime-2.6 gobject-2.0 intl
d168 1
a168 1
WANTLIB-ldap=		ldap
d176 1
a176 1
WANTLIB-tds=		sybdb
d194 1
a194 1
WANTLIB-pgsql=		pq z
d202 1
a202 1
WANTLIB-snmp=		m netsnmp netsnmpagent netsnmpmibs crypto kvm
d210 1
a210 1
WANTLIB-speex=		m speex speexdsp
@


1.236
log
@update to asterisk-13.10.0 and patch for libressl (upstream tests
OPENSSL_VERSION_NUMBER < 0x10002000L to see if DTLSv1_method is available;
it's an error at runtime only as it's in a dlopen'd module, and doesn't
crash the process, just fails loading the module, so you don't notice
until you wonder why calls are all failing...)
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.235 2016/06/13 09:22:42 ajacoutot Exp $
d5 1
a5 1
VER=			13.10.0
@


1.235
log
@Bump after the devel/gmime mono subpackage removal.
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.234 2016/05/14 13:45:17 sthen Exp $
d5 1
a5 1
VER=			13.9.1
a8 2

REVISION-http_post=	0
@


1.234
log
@update to asterisk-13.9.1
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.233 2016/05/09 16:07:13 sthen Exp $
d9 2
@


1.233
log
@update to asterisk-13.9.0
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.231 2016/04/15 11:35:12 sthen Exp $
d5 1
a5 1
VER=			13.9.0
@


1.232
log
@update to asterisk-13.8.2
@
text
@d5 1
a5 1
VER=			13.8.2
@


1.231
log
@security update to asterisk-13.8.1

AST-2016-005: TCP denial of service in PJProject
AST-2016-004: Fix crash on REGISTER with long URI
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.230 2016/04/02 14:38:19 sthen Exp $
d5 1
a5 1
VER=			13.8.1
@


1.230
log
@Fix sample cdr.conf in Asterisk (s/enabled/enable/ - the former used to be
valid but is no more). From Todd Mortimer.

Standardise style while there.
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.229 2016/03/29 23:24:46 sthen Exp $
d5 1
a5 2
VER=			13.8.0
REVISION-main=		0
@


1.229
log
@update to asterisk-13.8.0
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.228 2016/03/18 21:38:25 naddy Exp $
d6 1
@


1.228
log
@remove SHARED_ONLY from simple ports that use the gettext or libiconv module
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.227 2016/02/25 00:42:50 sthen Exp $
d5 1
a5 1
VER=			13.7.2
d24 6
a29 7
WANTLIB-main += jansson m nghttp2 ogg opencore-amrnb opencore-amrwb pj pjlib-util
WANTLIB-main += pjmedia pjmedia-audiodev pjmedia-codec pjmedia-videodev
WANTLIB-main += pjnath pjsip pjsip-simple pjsip-ua pjsua pjsua2 portaudio
WANTLIB-main += pthread resample spandsp speex speexdsp sqlite3 ssl
WANTLIB-main += stdc++ termcap tiff uriparser uuid vorbis vorbisenc
WANTLIB-main += vorbisfile xml2 xslt z
WANTLIB-main += ${MODGETTEXT_WANTLIB}
a32 2
MODULES=		devel/gettext

d41 1
d52 2
a53 4
			www/uriparser \
			${MODGETTEXT_LIB_DEPENDS}
RUN_DEPENDS-main=	${MODGETTEXT_RUN_DEPENDS} \
			telephony/asterisk-sounds/core-sounds/en,gsm>=1.4.25 \
d140 1
a140 1
WANTLIB-calendar=	${MODGETTEXT_WANTLIB} crypto expat ical iksemel
d143 3
a145 3
LIB_DEPENDS-calendar=	net/neon \
			textproc/libical \
			${MODGETTEXT_LIB_DEPENDS}
d152 2
a153 3
LIB_DEPENDS-http_post=	mail/gmime ${MODGETTEXT_LIB_DEPENDS}
WANTLIB-http_post=	gio-2.0 glib-2.0 gmime-2.6 gobject-2.0 \
			${MODGETTEXT_WANTLIB}
@


1.227
log
@update to asterisk-13.7.2, regression fix with pjsip realtime (probably not
all that widely used yet)
@
text
@d1 1
a1 3
# $OpenBSD: Makefile,v 1.226 2016/02/04 02:56:29 sthen Exp $

SHARED_ONLY=		Yes
@


1.226
log
@security update to asterisk-13.7.1 (if anyone has time to look at
pulling -stable up to 11.21.1, that would be appreciated..)

BEAST vulnerability in HTTP server
http://downloads.digium.com/pub/security/AST-2016-001.html

File descriptor exhaustion in chan_sip
http://downloads.digium.com/pub/security/AST-2016-002.html

Remote crash vulnerability when receiving UDPTL FAX data.
http://downloads.digium.com/pub/security/AST-2016-003.html
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.225 2016/01/16 14:21:53 sthen Exp $
d7 1
a7 1
VER=			13.7.1
@


1.226.2.1
log
@MFC update to asterisk-13.8.2, includes some crashes and DoS issues with pjsip
fixed in 13.8.1 and other small fixes
@
text
@d1 3
a3 1
# $OpenBSD: Makefile,v 1.232 2016/04/22 22:37:40 sthen Exp $
d7 1
a7 1
VER=			13.8.2
d26 7
a32 6
WANTLIB-main += iconv jansson m nghttp2 ogg opencore-amrnb opencore-amrwb
WANTLIB-main += pj pjlib-util pjmedia pjmedia-audiodev pjmedia-codec
WANTLIB-main += pjmedia-videodev pjnath pjsip pjsip-simple pjsip-ua
WANTLIB-main += pjsua pjsua2 portaudio pthread resample spandsp speex
WANTLIB-main += speexdsp sqlite3 ssl stdc++ termcap tiff uriparser
WANTLIB-main += uuid vorbis vorbisenc vorbisfile xml2 xslt z
d36 2
a45 1
			converters/libiconv \
d56 4
a59 2
			www/uriparser
RUN_DEPENDS-main=	telephony/asterisk-sounds/core-sounds/en,gsm>=1.4.25 \
d146 1
a146 1
WANTLIB-calendar=	crypto expat ical iconv intl iksemel
d149 3
a151 3
LIB_DEPENDS-calendar=	devel/gettext \
			net/neon \
			textproc/libical
d158 3
a160 2
LIB_DEPENDS-http_post=	devel/gettext mail/gmime
WANTLIB-http_post=	gio-2.0 glib-2.0 gmime-2.6 gobject-2.0 intl
@


1.225
log
@update to Asterisk 13.7.0
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.224 2015/10/31 11:28:57 espie Exp $
d7 1
a7 1
VER=			13.7.0
@


1.224
log
@don't assume FILESDIR has consistent modes
okay sthen@@
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.223 2015/10/30 12:59:16 sthen Exp $
d7 1
a7 3
VER=			13.6.0
REVISION-main=		0
REVISION-tds=		0
d73 1
a73 1
AUTOMAKE_VERSION=	1.10
@


1.223
log
@sync WANTLIB (curl+nghttp2)
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.222 2015/10/15 13:16:50 sthen Exp $
d246 1
a246 1
	@@${SUBST_CMD} -c ${FILESDIR}/$i.sample \
@


1.222
log
@tweaks to asterisk port: fix copy-and-pasto in COMMENT-tds, tidy Makefile
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.221 2015/10/12 22:07:28 sthen Exp $
d8 1
d28 1
a28 1
WANTLIB-main += jansson m ogg opencore-amrnb opencore-amrwb pj pjlib-util
@


1.221
log
@update to asterisk-13.6.0

this is a major update - upgrading users should review UPGRADE-12.txt and
UPGRADE.txt in /usr/local/share/doc/asterisk. some configurations will work
unchanged, but there have been big changes in other areas, notably AMI,
CDR and CEL.
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.215 2015/04/02 17:09:30 sthen Exp $
d8 1
d41 1
a41 2
PSEUDO_FLAVORS=		no_calendar no_http_post no_ldap no_odbc \
			no_pgsql no_snmp no_speex no_tds
d175 1
a175 1
COMMENT-tds=		LDAP support for Asterisk
a182 12

# mysql				need to handle building addons/ first XXX
# up above .include <bsd.port.arch.mk>
#PSEUDO_FLAVORS+=	no_mysql
#MULTI_PACKAGES+=	-mysql
#
#COMMENT-mysql=		MySQL support for Asterisk
#WANTLIB-mysql=		mysqlclient
#LIB_DEPENDS-mysql=	databases/mariadb
#.if !${BUILD_PACKAGES:M-mysql}
#CONFIGURE_ARGS+=	--with-mysqlclient=no
#.endif
@


1.220
log
@update to asterisk-11.20.0
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.219 2015/09/21 14:10:21 sthen Exp $
d7 1
a7 1
VER=			11.20.0
d25 8
a32 4
WANTLIB-main += avcodec avformat avutil c crypto curl execinfo gsm idn
WANTLIB-main += iksemel m ogg opencore-amrnb portaudio pthread spandsp
WANTLIB-main += sqlite3 ssl stdc++ swscale termcap tiff uuid vorbis
WANTLIB-main += vorbisenc vorbisfile xml2 z ${MODGETTEXT_WANTLIB}
a45 1
			audio/opencore-amr \
d48 1
a48 1
			graphics/ffmpeg \
d52 1
d56 2
d257 1
a257 1
	@@${SUBST_CMD} -m 0644 -c ${FILESDIR}/$i.sample \
@


1.219
log
@cope with pexp tightening in rc.subr r1.99, reported by sebastia@@
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.218 2015/06/08 08:44:52 sthen Exp $
d7 1
a7 2
VER=			11.18.0
REVISION-main=		0
@


1.218
log
@update to asterisk-11.18.0
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.217 2015/05/08 09:08:44 espie Exp $
d8 1
@


1.217
log
@don't depend on modes in the ports tree being what we want installed
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.216 2015/05/05 12:47:02 sthen Exp $
d7 1
a7 2
VER=			11.17.0
REVISION-main=		0
@


1.216
log
@Store the TID for "core show threads". Nice clue from jca@@, thanks!
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.215 2015/04/02 17:09:30 sthen Exp $
d252 1
a252 1
	@@${SUBST_CMD} -c ${FILESDIR}/$i.sample \
@


1.215
log
@update to asterisk-11.17.0, which includes a fix from Ed Hynan for an
FD exhaustion problem he was seeing on OpenBSD.
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.214 2015/02/06 23:27:51 sthen Exp $
d8 1
@


1.214
log
@update to asterisk-11.16.0
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.212 2015/01/27 21:26:43 sthen Exp $
d7 1
a7 1
VER=			11.16.0
@


1.214.2.1
log
@MFC update to asterisk-11.17.0, including FD leak fix.
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.215 2015/04/02 17:09:30 sthen Exp $
d7 1
a7 1
VER=			11.17.0
@


1.213
log
@update to Asterisk 11.15.1, disallow \r and/or \n in strings passed to libcurl
AST-2015-002, related to CVE-2014-8150 in cURL.
@
text
@d7 1
a7 1
VER=			11.15.1
@


1.212
log
@bugfix update to asterisk 11.15.0
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.211 2014/12/12 19:17:52 sthen Exp $
d7 1
a7 1
VER=			11.15.0
@


1.211
log
@Update to Asterisk 11.14.2, fixing AST-2014-019 in res_http_websocket,
a crash when receiving a WebSocket packet with a payload length of zero.

"Frames with a payload length of 0 were incorrectly handled in
res_http_websocket. Provided a frame with a payload had been received
prior it was possible for a double free to occur. The realloc operation
would succeed (thus freeing the payload) but be treated as an error.
When the session was then torn down the payload would be freed again
causing a crash. The read function now takes this into account."
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.210 2014/11/21 12:40:49 sthen Exp $
d7 1
a7 1
VER=			11.14.2
@


1.210
log
@SECURITY update to Asterisk 11.14.1

* AST-2014-012: Fix error with mixed address family ACLs.

* AST-2014-014: Fix race condition where channels may get stuck in
ConfBridge under load.

* AST-2014-017 - app_confbridge: permission escalation/class authorization.

* AST-2014-018 - func_db: DB Dialplan function permission escalation via AMI.

...

2014-012 doesn't really affect OpenBSD; Asterisk generally only allows
a single bind address so can't really do multi AF on OpenBSD where
v4-mapped-in-v6 is disabled.

2014-017 is a priv escalation via AMI; ConfbridgeStartRecord didn't require
system privs, but allowed arbitrary system commands to be executed.
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.208 2014/10/20 23:14:33 sthen Exp $
d7 1
a7 1
VER=			11.14.1
@


1.209
log
@update to asterisk-11.14.0
@
text
@d7 1
a7 1
VER=			11.14.0
@


1.208
log
@asterisk 11.13.1, disable sslv3 by default
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.207 2014/09/30 00:19:18 sthen Exp $
d7 1
a7 1
VER=			11.13.1
@


1.207
log
@update to asterisk 11.13.0
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.206 2014/09/20 20:37:44 sthen Exp $
d7 1
a7 1
VER=			11.13.0
@


1.206
log
@security update to asterisk 11.12.1, "AST-2014-010: Remote crash when handling
out of call message in certain dialplan configurations"

https://issues.asterisk.org/jira/browse/ASTERISK-24301
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.205 2014/09/13 18:09:22 brad Exp $
d7 1
a7 1
VER=			11.12.1
@


1.205
log
@Switch from using MySQL to using MariaDB attempt #2. MariaDB is a drop-in replacement.

ok sthen@@
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.204 2014/09/05 19:17:37 sthen Exp $
d7 1
a7 1
VER=			11.12.0
@


1.204
log
@+PORTROACH
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.203 2014/09/02 19:53:08 sthen Exp $
d185 1
a185 1
#LIB_DEPENDS-mysql=	databases/mysql
@


1.203
log
@update to asterisk 11.12.0
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.202 2014/07/12 01:32:13 sthen Exp $
d8 1
@


1.202
log
@update to asterisk 11.11.0
http://downloads.asterisk.org/pub/telephony/asterisk/ChangeLog-11.11.0
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.201 2014/06/12 22:39:12 sthen Exp $
d7 1
a7 1
VER=			11.11.0
@


1.202.2.1
log
@MFC:  SECURITY update to Asterisk 11.14.1

* AST-2014-012: Fix error with mixed address family ACLs.

* AST-2014-014: Fix race condition where channels may get stuck in
ConfBridge under load.

* AST-2014-017 - app_confbridge: permission escalation/class authorization.

* AST-2014-018 - func_db: DB Dialplan function permission escalation via AMI.
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.210 2014/11/21 12:40:49 sthen Exp $
d7 1
a7 2
VER=			11.14.1
PORTROACH=		limitw:0,odd
@


1.202.2.2
log
@MFC Update to Asterisk 11.14.2, fixing AST-2014-019 in res_http_websocket,
a crash when receiving a WebSocket packet with a payload length of zero.

"Frames with a payload length of 0 were incorrectly handled in
res_http_websocket. Provided a frame with a payload had been received
prior it was possible for a double free to occur. The realloc operation
would succeed (thus freeing the payload) but be treated as an error.
When the session was then torn down the payload would be freed again
causing a crash. The read function now takes this into account."
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.211 2014/12/12 19:17:52 sthen Exp $
d7 1
a7 1
VER=			11.14.2
@


1.201
log
@SECURITY update to asterisk 11.10.1

- AST-2014-006: MixMonitor manager action allows arbitrary shell commands
to be called from AMI (management interface) users without having proper
permissions.

- AST-2014-007: add a timeout to mitigate possible DoS on http interface
(connecting but making no request ties up a connection)
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.200 2014/06/12 14:24:34 sthen Exp $
d7 1
a7 1
VER=			11.10.1
@


1.200
log
@create default voicemail directory with same ownership as asterisk would
use itself if creating it from scratch; noted by brad@@
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.199 2014/05/31 00:35:31 sthen Exp $
d7 1
a7 2
VER=			11.10.0
REVISION-main=		0
@


1.199
log
@update to asterisk 11.10.0
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.198 2014/05/07 00:38:59 sthen Exp $
d8 1
@


1.198
log
@Now that c-client no longer pulls in ssl/crypto itself via kerbV, patch
Asterisk's configure script so it can find these required libs. No bump
needed here as it didn't build previously since c-client's lib version
was last bumped.
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.197 2014/04/26 11:59:51 sthen Exp $
d7 1
a7 1
VER=			11.9.0
@


1.197
log
@update to asterisk 11.9.0
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.196 2014/04/21 22:54:50 sthen Exp $
d126 1
a126 1
CONFIGURE_ARGS+=	--with-imap=yes
@


1.196
log
@remove configure.ac patching not needed since c-client no longer needs
kerb5 libs.

@@comment autosupport file which is very linux-centric.
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.195 2014/04/21 11:34:51 sthen Exp $
d7 1
a7 4
VER=			11.8.1
REVISION-main=		0
REVISION-snmp=		0
REVISION-calendar=	0
@


1.195
log
@sync wantlib after gssapi removal in neon
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.194 2014/03/23 22:05:10 sthen Exp $
d8 1
d133 1
a133 1
WANTLIB-main+=		c-client gssapi krb5
@


1.194
log
@sync WANTLIB following removal of tcp wrappers from net-snmp
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.193 2014/03/11 19:30:44 sthen Exp $
d9 1
d142 3
a144 3
WANTLIB-calendar=	${MODGETTEXT_WANTLIB} asn1 crypto expat gssapi \
			ical iksemel krb5 m neon proxy ssl xml2 z wind \
			com_err heimbase roken
@


1.193
log
@SECURITY update to Asterisk 11.8.1, fixing:-

http://downloads.digium.com/pub/security/AST-2014-001.html
Stack Overflow in HTTP Processing of Cookie Headers.

http://downloads.digium.com/pub/security/AST-2014-002.html
Denial of Service Through File Descriptor Exhaustion with chan_sip
Session-Timers.
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.192 2014/03/09 20:51:43 sthen Exp $
d8 1
d209 1
a209 1
WANTLIB-snmp=		m netsnmp netsnmpagent netsnmpmibs crypto kvm wrap
@


1.192
log
@update to asterisk 11.8.0
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.191 2013/12/30 23:04:49 sthen Exp $
d7 1
a7 1
VER=			11.8.0
@


1.191
log
@comment-out the right line in sample config
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.190 2013/12/20 12:37:05 sthen Exp $
d7 1
a7 1
VER=			11.7.0
a9 1
REVISION-main=		0
d53 1
a53 1
			telephony/asterisk-sounds/core-sounds/en,gsm \
@


1.190
log
@update to asterisk 11.7.0
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.189 2013/12/16 23:16:01 sthen Exp $
d10 1
@


1.189
log
@SECURITY update to Asterisk 11.6.1

AST-2013-006: A buffer overflow when receiving odd length 16 bit
messages in app_sms. An infinite loop could occur which would overwrite
memory when a message is received into the unpacksms16() function and
the length of the message is an odd number of bytes.
http://downloads.asterisk.org/pub/security/AST-2013-006-10.diff
http://downloads.digium.com/pub/security/AST-2013-006.html

AST-2013-007: Adds an option to disable certain dangerous dialplan
functions from external sources (e.g. Asterisk management interface):
shell exec and file writes. N.B. to enable this protection, set
"live_dangerously=no" in asterisk.conf if upgrading. (Sample config
file is patched to set this, but upgraders should add it in most
cases).
http://downloads.asterisk.org/pub/security/AST-2013-007-10.diff
http://downloads.digium.com/pub/security/AST-2013-007.html
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.188 2013/12/11 16:00:43 sthen Exp $
d7 1
a7 1
VER=			11.6.1
@


1.188
log
@enable chan_console
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.187 2013/10/21 23:38:44 sthen Exp $
d7 1
a7 1
VER=			11.6.0
a9 1
REVISION-main=		0
@


1.187
log
@update to asterisk 11.6.0
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.186 2013/10/17 09:11:35 ajacoutot Exp $
d10 1
d25 4
a28 5
WANTLIB-main +=	c crypto curl execinfo gsm idn iksemel
WANTLIB-main += m ogg pthread spandsp sqlite3 ssl stdc++ termcap
WANTLIB-main += tiff vorbis vorbisenc vorbisfile xml2 z uuid
WANTLIB-main += avcodec avformat avutil opencore-amrnb swscale
WANTLIB-main += ${MODGETTEXT_WANTLIB}
d43 1
d99 1
a112 1
			--with-portaudio=no \
@


1.186
log
@Fix deps after re-alpine -> alpine.
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.185 2013/08/28 09:46:15 sthen Exp $
d7 1
a7 1
VER=			11.5.1
a10 2
REVISION-main=		0

d66 1
a66 1
AUTOCONF_VERSION=	2.68
@


1.185
log
@SECURITY update to Asterisk 11.5.1

AST-2013-005: Remote crash from invalid SDP

        If the SIP channel driver processes an invalid SDP that defines media
        descriptions before connection information, it may attempt to
        reference the socket address information even though that information
        has not yet been set. This will cause a crash.

AST-2013-004: Fix crash when handling ACK on dialog that has no channel

        A remotely exploitable crash vulnerability exists in the SIP channel
        driver if an ACK with SDP is received after the channel has been
        terminated. The handling code incorrectly assumed that the channel
        would always be present.
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.184 2013/07/16 13:03:19 sthen Exp $
d11 2
d131 1
a131 1
LIB_DEPENDS-main+=	mail/re-alpine,-c-client
@


1.184
log
@update to Asterisk 11.5.0 (and enabled FreeTDS cel/cdr support)
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.183 2013/06/20 08:26:14 ajacoutot Exp $
d7 1
a7 1
VER=			11.5.0
@


1.184.2.1
log
@Security update to asterisk-11.5.1 which fixes CVE-2013-5641 and CVE-2013-5642

ok sthen@@ (MAINTAINER)
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.184 2013/07/16 13:03:19 sthen Exp $
d7 1
a7 1
VER=			11.5.1
@


1.183
log
@No need for pthread.
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.182 2013/06/20 06:54:37 ajacoutot Exp $
d7 1
a7 3
VER=			11.4.0
REVISION-main=		2
REVISION-calendar=	4
d26 1
a26 1
WANTLIB-main += tiff vorbis vorbisenc vorbisfile xml2 z
d35 1
a35 1
			-pgsql -snmp -speex
d37 1
a37 1
			no_pgsql no_snmp no_speex
d47 1
d113 1
a113 2
			--with-resample=no \
			--with-tds=no
d165 10
@


1.182
log
@Unbreak after hx509 and ntlm removal from Kerberos.
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.181 2013/06/17 19:31:17 ajacoutot Exp $
d9 1
a9 1
REVISION-calendar=	3
d144 1
a144 1
			com_err heimbase pthread roken
@


1.181
log
@Unbreak with new Heimdal; get rid of self-cooked krb5-config since we
have it in base now.
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.180 2013/06/12 20:36:34 brad Exp $
d8 2
a9 2
REVISION-main=		1
REVISION-calendar=	2
d144 1
a144 1
			com_err heimbase heimntlm hx509 pthread roken
@


1.180
log
@Revert back to using MySQL 5.1 for the time being. MariaDB 5.5 introduces
a new libmysqlclient non-blocking API which utilizes co-routines. The X86
specific GCC ASM co-routine support hid the fact that there was an issue.
The only fallback code so far is POSIX user contexts which OpenBSD does not
support.

Input from and Ok sthen@@ jasper@@
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.179 2013/06/05 00:57:18 sthen Exp $
d9 1
d143 2
a144 1
			ical iksemel krb5 m neon proxy ssl xml2 z
@


1.179
log
@Fix cookie parsing in Asterisk's HTTP request parser if an RFC2965 Cookie2
header is present. Needed for AMI/HTTP logins with some http clients.
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.178 2013/05/25 00:33:10 brad Exp $
d174 1
a174 1
#LIB_DEPENDS-mysql=	databases/mariadb
@


1.178
log
@Switch from using MySQL to using MariaDB. MariaDB is a drop-in replacement.


ok sthen aja
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.177 2013/05/18 08:44:00 sthen Exp $
d8 1
a8 1
REVISION-main=		0
@


1.177
log
@@@comment res_kqueue_timer.so for now so we fall back to res_pthread_timer
(it didn't used to be built on OpenBSD; 11.4.0 started building it but it's
not correctly functional yet).
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.176 2013/05/17 22:57:50 sthen Exp $
d174 1
a174 1
#LIB_DEPENDS-mysql=	databases/mysql
@


1.176
log
@update to Asterisk 11.4.0, lots of fixes
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.175 2013/03/28 21:25:17 sthen Exp $
d8 1
@


1.175
log
@Add patches to resolve a T38 fax-related deadlock researched by chris@@
https://issues.asterisk.org/jira/secure/attachment/46850/fax-deadlock-v2.patch-11.3.0
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.174 2013/03/28 20:24:53 sthen Exp $
d7 1
a7 2
VER=			11.3.0
REVISION-main=		0
a86 1
			--with-avcodec=no \
@


1.174
log
@update to Asterisk 11.3.0, various testing by myself and chris@@

- this is a major version update to the new long-term support version
- please review UPGRADE.txt
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.172 2013/03/21 08:48:54 ajacoutot Exp $
d8 1
@


1.173
log
@SECURITY update to Asterisk 10.12.2

* A possible buffer overflow during H.264 (video) format negotiation.
CVE-2013-2685

* A denial of service exists in Asterisk's HTTP server.
CVE-2013-2686

* A potential username disclosure exists in the SIP channel driver.
CVE-2013-2264
@
text
@d4 1
d7 1
a7 1
VER=			10.12.2
d21 1
a21 1
PERMIT_PACKAGE_CDROM=	patent licensing clauses in iLBC
d27 1
d30 2
d42 1
d44 1
d54 1
a54 2
BUILD_DEPENDS+=		devel/libtool# for share/aclocal/lt~obsolete.m4
BUILD_DEPENDS+=		security/libsrtp>=1.4.4# statically linked
d76 2
a77 1
			LIBS="-pthread"
d80 1
@


1.172
log
@USE_LIBTOOL=Yes is the default now.
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.171 2013/03/11 11:41:33 espie Exp $
d6 1
a6 3
VER=			10.12.1
REVISION=		0
REVISION-main=
@


1.171
log
@PERMIT_* / REGRESS->TEST sweep
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.170 2013/01/30 20:59:41 sthen Exp $
a59 1
USE_LIBTOOL=		Yes
@


1.170
log
@don't use BUILD_PKGPATH to set RUN_DEPENDS for the packages holding
plugin modules, as these do not depend on the flavour of the main package.
reported by landry.
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.169 2013/01/22 23:26:30 sthen Exp $
a23 2
PERMIT_DISTFILES_CDROM= patent licensing clauses in iLBC
PERMIT_DISTFILES_FTP=	Yes
d208 1
a208 1
NO_REGRESS=		Yes
@


1.170.2.1
log
@MFC update to Asterisk 10.12.2, CVE-2013-2686 CVE-2013-2264
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.173 2013/03/27 22:48:22 sthen Exp $
d6 3
a8 1
VER=			10.12.2
d24 1
a24 1
PERMIT_DISTFILES_CDROM=	patent licensing clauses in iLBC
@


1.170.2.2
log
@SECURITY update (5.3-stable) to Asterisk 10.12.3

AST-2013-005: Remote crash from invalid SDP

        If the SIP channel driver processes an invalid SDP that defines media
        descriptions before connection information, it may attempt to
        reference the socket address information even though that information
        has not yet been set. This will cause a crash.

AST-2013-004: Fix crash when handling ACK on dialog that has no channel

        A remotely exploitable crash vulnerability exists in the SIP channel
        driver if an ACK with SDP is received after the channel has been
        terminated. The handling code incorrectly assumed that the channel
        would always be present.
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.170.2.1 2013/05/01 09:11:06 sthen Exp $
d6 1
a6 1
VER=			10.12.3
@


1.169
log
@bugfix update to Asterisk 10.12.1, fix imap flavour while there (c-client moved)
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.168 2013/01/15 01:38:34 sthen Exp $
d7 2
d220 1
a220 1
RUN_DEPENDS$i +=	asterisk-${VER}:${BUILD_PKGPATH}
@


1.168
log
@bugfix update to Asterisk 10.12.0

- this is the last regular release in the 10.x series, future 10.x releases
will be security fixes only.
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.166 2012/12/11 14:46:41 sthen Exp $
d6 1
a6 1
VER=			10.12.0
d126 1
a126 1
LIB_DEPENDS-main+=	mail/imap-uw,-c-client
@


1.167
log
@update to Asterisk 10.11.1, fixing:

AST-2012-014: crashes due to large stack allocations in TCP;
affects remote unauthenticated SIP *over TCP* and remote authenticated
XMPP/HTTP connections.

AST-2012-015: DoS through resource consumption by exploiting device
state caching; exploitable if anonymous calls are permitted.
@
text
@d6 1
a6 1
VER=			10.11.1
@


1.166
log
@bugfix update to Asterisk 10.11.0

- while there, revise pbx_spool.c kevent timeout fix; rather than
clamping the timestamp, in the particular problem situation we hit
the loop (where dirlist is empty), pass in NULL rather than
INT_MAX-timenow similar to what's done in the inotify case.
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.165 2012/12/07 12:20:27 sthen Exp $
d6 1
a6 1
VER=			10.11.0
@


1.165
log
@Update to Asterisk 10.10.1; fix reference leak in chan_local (no other changes).
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.164 2012/11/28 17:29:30 sthen Exp $
d6 1
a6 1
VER=			10.10.1
@


1.164
log
@This wants share/aclocal/lt~obsolete.m4 from devel/libtool; add it
as BUILD_DEPENDS.
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.163 2012/11/08 09:34:31 sthen Exp $
d6 1
a6 1
VER=			10.10.0
d20 1
a20 1
PERMIT_PACKAGE_CDROM=	patent licensing clauses
d22 1
a22 1
PERMIT_DISTFILES_CDROM= patent licensing clauses
@


1.163
log
@update to Asterisk 10.10.0 - various fixes including with confbridge,
dtmf and chan_local.
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.162 2012/10/08 21:28:06 sthen Exp $
d50 2
a51 1
BUILD_DEPENDS=		security/libsrtp>=1.4.4 # statically linked
@


1.162
log
@update to Asterisk 10.9.0

- Fix channel reference leak in ChanSpy.
- dsp.c: Fix multiple issues when no-interdigit delay is present,
and fast DTMF 50ms/50ms.
- Fix bug where final queue member would not be removed from memory.
- Fix memory leak when CEL is successfully written to PostgreSQL database.
- Fix DUNDi message routing bug when neighboring peer is unreachable.
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.161 2012/09/28 00:03:57 sthen Exp $
d6 1
a6 1
VER=			10.9.0
@


1.161
log
@Update the asterisk port to 10.8.0 - This is a major update, notable changes:

- If using ConfBridge, note that the dialplan arguments have changed.

- If using the built-in HTTP server, note that a bindaddr must now be given,
previously the default was 0.0.0.0 but this must now be given explicitly.

- Internal database now uses SQLite3 not BDB, conversion tools are provided.

See share/doc/asterisk/UPGRADE.txt for more.
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.159 2012/09/15 12:43:49 sthen Exp $
d6 1
a6 1
VER=			10.8.0
@


1.160
log
@revamp asterisk sound-file packaging.

- strip core-sounds and moh out of the main asterisk package,
they change comparatively rarely.

- provide all available languages.

- provide multiple codecs for all files, replacing the asterisk-native-sounds
package which only provided ulaw versions of the asterisk 1.4 files, ports
laid out to permit parallel building.

- the old asterisk-sounds package providing additional sound files beyond
the core ones is now "extra-sounds" modelled after the filename of the
distributed files.
@
text
@d6 1
a6 2
VER=			1.8.16.0
REVISION-main=		0
d79 2
d86 1
d94 1
a106 1
			--with-pwlib=no \
@


1.159
log
@update to Asterisk 1.8.16.0
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.158 2012/08/30 22:45:40 sthen Exp $
d7 1
a10 5
SOUNDS=			CORE MOH EXTRA
SOUNDS_CORE=		asterisk-core-sounds-en-gsm-1.4.22
SOUNDS_MOH=		asterisk-moh-opsound-wav-2.03
SOUNDS_EXTRA=		asterisk-extra-sounds-en-gsm-1.4.11

d19 2
a20 2
# files." core-sounds-*: GPLv2/CC-BY-SA. iLBC codec has BSD-like license
# terms, but also see patent notes in codecs/ilbc/LICENSE_ADDENDUM.
a37 2
SUBST_VARS+=		${SOUNDS:S/^/SOUNDS_/}

d48 3
a50 1
RUN_DEPENDS-main=	${MODGETTEXT_RUN_DEPENDS}
a54 1
MASTER_SITES0=	${MASTER_SITES:C/asterisk/sounds/}
a58 6
.for i in ${SOUNDS}
SVER_$i = ${SOUNDS_$i:C/^[-a-z]*//}
SUBST_VARS += SVER_$i
DISTFILES += ${SOUNDS_$i}${EXTRACT_SUFX}:0 ${SOUNDS_$i}${EXTRACT_SUFX}.sha1:0
.endfor

a79 2
CONFIGURE_ARGS+=	--with-sounds-cache=${DISTDIR}

a218 4
	@@grep _VERSION:= ${WRKSRC}/sounds/Makefile # maintainer aid
.for i in ${SOUNDS}
	@@echo ${SOUNDS_$i}
.endfor
a239 1
	@@mv ${WRKINST}/var/spool/asterisk/voicemail ${EXAMPLEDIR}/voicemail
@


1.158
log
@Security update to asterisk 1.8.15.1.

AST-2012-012: AMI User Unauthorized Shell Access through ExternalIVR
AST-2012-013: ACL rules being ignored during calls by some IAX2 peers
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.157 2012/08/23 17:42:27 sthen Exp $
d6 1
a6 1
VER=			1.8.15.1
d147 2
a148 2
WANTLIB-calendar=	${MODGETTEXT_WANTLIB} asn1 c crypto expat gssapi \
			ical iksemel krb5 m neon proxy pthread ssl xml2 z
d159 1
a159 1
WANTLIB-http_post=	c gio-2.0 glib-2.0 gmime-2.6 gobject-2.0 pthread \
d168 1
a168 1
WANTLIB-ldap=		c ldap
d188 1
a188 1
WANTLIB-odbc=		c iodbc pthread
d196 1
a196 1
WANTLIB-pgsql=		c pq z
d204 1
a204 1
WANTLIB-snmp=		c m netsnmp netsnmpagent netsnmpmibs crypto kvm wrap
d212 1
a212 1
WANTLIB-speex=		c m speex speexdsp
@


1.157
log
@sync wantlib
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.156 2012/08/22 08:04:22 sthen Exp $
d6 1
a6 1
VER=			1.8.15.0
a8 8

REVISION-calendar=	0
REVISION-http_post=	0
REVISION-ldap=		0
REVISION-odbc=		0
REVISION-pgsql=		0
REVISION-snmp=		0
REVISION-speex=		0
@


1.156
log
@Remove no_mono hack now it's done in gmime instead. Suggested by ajacoutot@@
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.155 2012/08/21 22:45:59 sthen Exp $
d10 8
d155 2
a156 2
WANTLIB-calendar=	${MODGETTEXT_WANTLIB} asn1 crypto expat gssapi \
			ical iksemel krb5 m neon proxy ssl xml2 z
d167 1
a167 1
WANTLIB-http_post=	gio-2.0 glib-2.0 gmime-2.6 gobject-2.0 \
d176 1
a176 1
WANTLIB-ldap=		ldap
d196 1
a196 1
WANTLIB-odbc=		iodbc
d204 1
a204 1
WANTLIB-pgsql=		pq z
d212 1
a212 1
WANTLIB-snmp=		m netsnmp netsnmpagent netsnmpmibs crypto kvm wrap
d220 1
a220 1
WANTLIB-speex=		m speex speexdsp
@


1.155
log
@Depend on gmime,no_mono not just gmime. Asterisk doesn't need
gmime-sharp and this gets it built earlier in a broken-mono bulk build.
This is a pseudo flavour only so the plist doesn't change -> no bump.
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.154 2012/08/04 21:53:56 sthen Exp $
d158 1
a158 1
LIB_DEPENDS-http_post=	mail/gmime,no_mono ${MODGETTEXT_LIB_DEPENDS}
@


1.154
log
@update to asterisk 1.8.15.0
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.153 2012/07/17 13:01:55 sthen Exp $
d158 1
a158 1
LIB_DEPENDS-http_post=	mail/gmime ${MODGETTEXT_LIB_DEPENDS}
@


1.153
log
@update to asterisk 1.8.14.1, fixes a problem with tcptls SIP connections
where an SSL_CTX was freed where it shouldn't have been leading to a possible
crash.
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.152 2012/07/11 08:51:56 sthen Exp $
d6 1
a6 1
VER=			1.8.14.1
@


1.153.2.1
log
@Update Asterisk in 5.2-stable to 1.8.18.1, various fixes including
deadlocks, crashes, thread and memory leaks and heap corruption.
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.153 2012/07/17 13:01:55 sthen Exp $
d6 1
a6 1
VER=			1.8.18.1
@


1.153.2.2
log
@update -stable to Asterisk 1.8.19.1, fixing:

AST-2012-014: crashes due to large stack allocations in TCP;
affects remote unauthenticated SIP *over TCP* and remote authenticated
XMPP/HTTP connections.

AST-2012-015: DoS through resource consumption by exploiting device
state caching; exploitable if anonymous calls are permitted.
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.153.2.1 2012/12/09 13:21:43 sthen Exp $
d6 1
a6 1
VER=			1.8.19.1
@


1.153.2.3
log
@SECURITY update for Asterisk in 5.2-stable to 1.8.20.1, includes fixes for the
following (which were fixed in -current by the update to 10.11.1 in January).

AST-2012-014: large stack allocations in TCP; affects remote unauthenticated
SIP *over TCP* and remote authenticated XMPP/HTTP connections.

This was initially suspected to just be a DoS however pirofti@@ pointed me
at this write-up: http://blog.exodusintel.com/2013/01/07/who-was-phone/
(which sheds a bit of light on the increased scans on the default AMI port
that I've noticed recently..)

AST-2012-015: DoS through resource consumption by exploiting device
state caching; exploitable if anonymous calls are permitted.
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.153.2.2 2013/01/02 22:34:16 sthen Exp $
d6 1
a6 1
VER=			1.8.20.1
d188 1
a188 1
WANTLIB-odbc=		iodbc pthread
@


1.153.2.4
log
@SECURITY update for 5.2-stable to Asterisk 1.8.20.2

* A possible buffer overflow during H.264 (video) format negotiation.
CVE-2013-2685

* A denial of service exists in Asterisk's HTTP server.
CVE-2013-2686

* A potential username disclosure exists in the SIP channel driver.
CVE-2013-2264
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.153.2.3 2013/03/17 12:53:09 sthen Exp $
d6 1
a6 1
VER=			1.8.20.2
@


1.152
log
@bugfix update to Asterisk 1.8.14.0

- note that BLINDTRANSFER is no longer available in the 'h' extension,
if you were using this see the CHANGES file
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.151 2012/07/05 22:01:22 sthen Exp $
d6 1
a6 1
VER=			1.8.14.0
d57 2
a58 2
MASTER_SITES=	http://downloads.digium.com/pub/telephony/asterisk/releases/ \
		http://downloads.digium.com/pub/telephony/asterisk/old-releases/
@


1.151
log
@SECURITY update to Asterisk 1.8.13.1 - fixes AST-2012-010, AST-2012-011

- RTP port exhaustion (DoS) if an endpoint responds to SIP INVITEs with
provisional responses but never sends a final response.

- double free with simultaneous access to a single voicemail account.
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.150 2012/06/07 10:39:25 sthen Exp $
d6 1
a6 1
VER=			1.8.13.1
@


1.150
log
@bugfix update to Asterisk 1.8.13.0
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.149 2012/05/30 22:45:26 sthen Exp $
d6 1
a6 1
VER=			1.8.13.0
@


1.149
log
@SECURITY update to Asterisk 1.8.12.2

AST-2012-007, AST-2012-008 fixed in the short-lived 1.8.12.1 release:

* A remotely exploitable crash vulnerability exists in the IAX2 channel
  driver if an established call is placed on hold without a suggested music
  class. Asterisk will attempt to use an invalid pointer to the music
  on hold class name, potentially causing a crash.

* A remotely exploitable crash vulnerability was found in the Skinny (SCCP)
  Channel driver. When an SCCP client closes its connection to the server,
  a pointer in a structure is set to NULL.  If the client was not in the
  on-hook state at the time the connection was closed, this pointer is later
  dereferenced. This allows remote authenticated connections the ability to
  cause a crash in the server, denying services to legitimate users.

Also from 1.8.12.2

* Resolve crash in subscribing for MWI notifications.

ASTOBJ_UNREF sets the variable to NULL after unreffing it, so the
variable should definitely not be used after that. To solve this in
the two cases that affect subscribing for MWI notifications, we
instead save the ref locally, and unref them in the error
conditions.
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.147 2012/05/06 13:58:23 naddy Exp $
d6 1
a6 1
VER=			1.8.12.2
@


1.148
log
@tweaks to the Asterisk port:

- add an extra file to PLIST-calendar
- add comments to the sample sip.conf showing how to hide version numbers
- fix use of _POSIX_THREAD_PRIORITY_SCHEDULING, from Brad
@
text
@d6 1
a6 3
VER=			1.8.12.0
REVISION-main=		0
REVISION-calendar=	0
@


1.147
log
@BUILD_DEPENDS is not subpackage-dependent
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.146 2012/05/03 11:25:27 sthen Exp $
d7 2
d150 1
a150 1
			ical iksemel krb5 m neon ssl xml2 z
@


1.146
log
@Update to Asterisk 1.8.12.0, including lots of fixes for bad sizeof()
use and possible uninitialized var use, some memory leaks, a couple of
possible deadlocks and other issues.

While there, enable the http post module (done as a subpackage to
avoid pulling gmime/glib2 into the main package) and WANTLIB cleanup.

AEL dialplan users should see UPGRADE.txt for information about
changes to inheritance of the 'h' extension.
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.145 2012/04/28 10:52:08 ajacoutot Exp $
d55 1
a55 1
BUILD_DEPENDS-main=	security/libsrtp>=1.4.4 # statically linked
@


1.145
log
@--localstatedir=/var is the default now.
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.144 2012/04/23 21:35:58 sthen Exp $
d6 1
a6 1
VER=			1.8.11.1
d31 10
a40 7
WANTLIB-main += m ogg pthread spandsp sqlite3 srtp ssl stdc++ termcap
WANTLIB-main += tiff vorbis vorbisenc xml2 z ${MODLIBICONV_WANTLIB}

MODULES=		devel/gettext converters/libiconv

MULTI_PACKAGES=		-main -calendar -ldap -odbc -pgsql -snmp -speex
PSEUDO_FLAVORS=		no_calendar no_ldap no_odbc no_pgsql no_snmp no_speex
a49 1
			security/libsrtp>=1.4.4 \
d52 4
a55 1
			textproc/libxml
a97 1
			--with-gmime=no \
a111 1
			--with-usb=no \
a151 1

d156 9
a168 1

a180 1
#
a188 1

a197 1

a205 1

a213 1

@


1.144
log
@SECURITY update to asterisk 1.8.11.1, fixing:

 * A permission escalation vulnerability in Asterisk Manager Interface.  This
   would potentially allow remote authenticated users the ability to execute
   commands on the system shell with the privileges of the user running the
   Asterisk application.

 * A heap overflow vulnerability in the Skinny Channel driver.  The keypad
   button message event failed to check the length of a fixed length buffer
   before appending a received digit to the end of that buffer.  A remote
   authenticated user could send sufficient keypad button message events that
   the buffer would be overrun.

 * A remote crash vulnerability in the SIP channel driver when processing UPDATE
   requests.  If a SIP UPDATE request was received indicating a connected line
   update after a channel was terminated but before the final destruction of the
   associated SIP dialog, Asterisk would attempt a connected line update on a
   non-existing channel, causing a crash.
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.143 2012/04/23 17:15:19 espie Exp $
d86 1
a86 2
CONFIGURE_ARGS+=	--localstatedir=/var \
			--with-sounds-cache=${DISTDIR}
@


1.143
log
@first pass at handling sqlite3 move
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.142 2012/04/08 22:34:51 sthen Exp $
d6 1
a6 1
VER=			1.8.11.0
a8 1
REVISION =		0
@


1.142
log
@update to asterisk 1.8.11.0, including fixes for :
- crash in app_voicemail
- resource leak in SIP TCP/TLS
- ACK routing for non-2xx responses
- buffer overrun/memory leak in 'sip show peers' (race when adding peers whilst displaying)
- various locking problems
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.141 2012/03/27 19:48:03 sthen Exp $
d9 1
a44 1
			databases/sqlite3 \
@


1.141
log
@unbreak with installed pwlib, spotted by naddy@@
zap stray whitespace
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.140 2012/03/23 22:42:25 sthen Exp $
d6 1
a6 2
VER=			1.8.10.1
REVISION-main=		1
@


1.140
log
@tweaks to the asterisk port; currently no effective change to the packages.

- remove unused non-working patches and framework for chan_h323;
this driver is deprecated upstream anyway.

- add patches to let the alternative chan_ooh323 addon module build.
currently unused in the port, 'make configure; cd $WRKSRC; gmake menuselect'
and enable it there if you want to play.

- sync unistim patch.

- mention the IMAP flavour in DESCR (and thus bump REVISION-main).
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.139 2012/03/17 23:08:20 sthen Exp $
d117 1
d201 1
a201 1
LIB_DEPENDS-snmp=	net/net-snmp 
@


1.139
log
@Avoid a tight loop in asterisk's pbx_spool thread reported by drahn@@ under
rthread. kern_time.c:itimerfix() requires the kevent interval timer to be
<= 100M seconds otherwise it passes an EINVAL back up, giving an error
return from kevent(). The initial timestamp is (INT_MAX-cur time) i.e.
around 800M so we hit this. Workaround by clamping tv_sec to 100M sec.
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.138 2012/03/15 22:20:50 sthen Exp $
d7 1
a7 1
REVISION-main=		0
a127 1
#FLAVORS+=		h323 # XXX requires older h323
a129 8

.if ${FLAVOR:Mh323}
LIB_DEPENDS-main+=	net/h323plus
WANTLIB-main+=		SDL avutil expat h323.>=3 lber ldap ldap_r pt.>=3 sasl2
.else
CONFIGURE_ARGS+=	--with-pwlib=no \
			--with-h323=no
.endif
@


1.138
log
@SECURITY update to asterisk 1.8.10.1

AST-2012-002: stack buffer overflow (remote unauthenticated sessions).
requires a dialplan using the Milliwatt application with the 'o' option,
and internal_timing off.  Affects all 1.4+ Asterisk versions.

AST-2012-003: stack buffer overflow (remote unauth'd sessions) in HTTP
manager interface; triggered by long digest authentication strings.
Code injection possibility.  Affects 1.8+.
@
text
@d1 1
a1 3
# $OpenBSD: Makefile,v 1.137 2012/03/13 23:17:46 sthen Exp $

#CONFIGURE_ARGS+=	--without-kqueue
d7 1
@


1.137
log
@update to Asterisk 1.8.10.0

- includes the iLBC codec which now has a free copyright license; patent
licensing has a "no litigation" clause (see codecs/ilbc/LICENSE_ADDENDUM)
so mark as not permitted for CDs
@
text
@d1 3
a3 1
# $OpenBSD: Makefile,v 1.136 2012/02/27 17:12:56 sthen Exp $
d8 1
a8 1
VER=			1.8.10.0
d79 1
a79 1
LDFLAGS+= 		-L${X11BASE}/lib -L${LOCALBASE}/lib
@


1.136
log
@update to asterisk 1.8.9.3, fixes route-set regressions in SIP
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.135 2012/02/16 21:25:08 sthen Exp $
d6 1
a6 1
VER=			1.8.9.3
d11 1
a11 1
SOUNDS_CORE=		asterisk-core-sounds-en-gsm-1.4.21
d23 3
a25 2
# files." core-sounds-*: GPLv2/CC-BY-SA.
PERMIT_PACKAGE_CDROM=	Yes
d27 1
a27 1
PERMIT_DISTFILES_CDROM= Yes
d70 1
a70 1
AUTOCONF_VERSION=	2.65
@


1.135
log
@update to asterisk 1.8.9.2

- fixes deadlock in chan_agent, crash in ParkAndAnnounce, and
SIP INFO DTMF handling for non-numeric codes
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.134 2012/01/28 08:16:22 sthen Exp $
d6 1
a6 1
VER=			1.8.9.2
@


1.134
log
@update to asterisk 1.8.9.0, ok ajacoutot@@

This release has many fixes including thread locking issues,
crashes, resource leaks and others.
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.133 2012/01/20 00:18:02 sthen Exp $
d6 1
a6 1
VER=			1.8.9.0
@


1.134.2.1
log
@MFC update to asterisk 1.8.11.0, relative to previous version this
includes fixes for various crash/deadlock problems and the following
SECURITY problems:

AST-2012-002: stack buffer overflow (remote unauthenticated sessions).
requires a dialplan using the Milliwatt application with the 'o' option,
and internal_timing off.  Affects all 1.4+ Asterisk versions.

AST-2012-003: stack buffer overflow (remote unauth'd sessions) in HTTP
manager interface; triggered by long digest authentication strings.
Code injection possibility.  Affects 1.8+.
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.142 2012/04/08 22:34:51 sthen Exp $
d6 1
a6 1
VER=			1.8.11.0
d11 1
a11 1
SOUNDS_CORE=		asterisk-core-sounds-en-gsm-1.4.22
d23 2
a24 3
# files." core-sounds-*: GPLv2/CC-BY-SA. iLBC codec has BSD-like license
# terms, but also see patent notes in codecs/ilbc/LICENSE_ADDENDUM.
PERMIT_PACKAGE_CDROM=	patent licensing clauses
d26 1
a26 1
PERMIT_DISTFILES_CDROM= patent licensing clauses
d69 1
a69 1
AUTOCONF_VERSION=	2.68
d76 1
a76 1
LDFLAGS+=		-L${X11BASE}/lib -L${LOCALBASE}/lib
a114 1
			--with-pwlib=no \
d126 1
d130 8
d207 1
a207 1
LIB_DEPENDS-snmp=	net/net-snmp
@


1.134.2.2
log
@MFC asterisk SECURITY update to 1.8.11.1: (with necessary adjustment for sqlite)

* A permission escalation vulnerability in Asterisk Manager Interface.  This
would potentially allow remote authenticated users the ability to execute
commands on the system shell with the privileges of the user running the
Asterisk application.

* A heap overflow vulnerability in the Skinny Channel driver.  The keypad
button message event failed to check the length of a fixed length buffer
before appending a received digit to the end of that buffer.  A remote
authenticated user could send sufficient keypad button message events that
the buffer would be overrun.

* A remote crash vulnerability in the SIP channel driver when processing UPDATE
requests.  If a SIP UPDATE request was received indicating a connected line
update after a channel was terminated but before the final destruction of the
associated SIP dialog, Asterisk would attempt a connected line update on a
non-existing channel, causing a crash.
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.144 2012/04/23 21:35:58 sthen Exp $
d6 1
a6 1
VER=			1.8.11.1
@


1.134.2.3
log
@backport asterisk security patches for AST-2012-010 and AST-2012-011

- RTP port exhaustion (DoS) if an endpoint responds to SIP INVITEs with
provisional responses but never sends a final response.

- double free with simultaneous access to a single voicemail account.

(should have been with preceding commit which was done in patches/ so
missed the revision bump in Makefile).
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.134.2.2 2012/04/23 21:41:03 sthen Exp $
a6 1
REVISION-main=		0
@


1.133
log
@Update to Asterisk 1.8.8.2. Fixes AST-2012-001, crash affecting
configurations with video disabled and the sRTP module loaded.

Funnily enough this didn't affect the port until about an hour
ago when sRTP was enabled.
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.132 2012/01/19 21:49:56 sthen Exp $
d6 1
a6 1
VER=			1.8.8.2
d47 1
a47 1
			security/libsrtp \
@


1.132
log
@- Build Asterisk with sRTP support.
- Remove DESCR parts and PFRAG relating to currently-disabled H.323 support.
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.131 2011/12/30 22:24:35 sthen Exp $
d6 1
a6 1
VER=			1.8.8.1
a8 1
REVISION-main=		0
@


1.131
log
@update to Asterisk 1.8.8.1; fixes a regression introduced in 1.8.8.0
with local bridged calls (various effects especially coming off hold or
with moh in some instances).
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.130 2011/12/16 14:50:09 sthen Exp $
d9 1
d31 1
a31 1
WANTLIB-main += m ogg pthread spandsp sqlite3 ssl stdc++ termcap
d48 1
@


1.130
log
@update Asterisk to 1.8.8.0
- various fixes, including a range of possible deadlocks
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.129 2011/12/09 00:22:43 sthen Exp $
d6 1
a6 1
VER=			1.8.8.0
@


1.129
log
@security update to asterisk 1.8.7.2; null pointer deref with crafted SIP
packets when "automon" is enabled in features.conf. AST-2011-014
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.128 2011/11/02 08:32:17 jasper Exp $
d6 1
a6 1
VER=			1.8.7.2
@


1.128
log
@- regen WANTLIB
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.127 2011/10/17 19:35:55 sthen Exp $
d6 1
a6 1
VER=			1.8.7.1
a8 2

REVISION-snmp=		0
@


1.127
log
@SECURITY update to Asterisk 1.8.7.1, trivial remote crash in SIP affecting
all previous 1.8.x versions (uninitialized variable).
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.126 2011/10/17 10:03:51 espie Exp $
d10 2
d207 1
a207 1
WANTLIB-snmp=		c m netsnmp netsnmpagent netsnmphelpers netsnmpmibs perl util
@


1.126
log
@use bsd.port.arch.mk
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.125 2011/09/24 13:47:42 sthen Exp $
d6 1
a6 1
VER=			1.8.7.0
@


1.125
log
@update to asterisk 1.8.7.0
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.121 2011/07/12 19:54:39 sthen Exp $
d34 4
a37 1
MULTI_PACKAGES+=	-main
d129 1
a129 1
.if ${FLAVOR:L:Mh323}
d137 1
a137 1
.if ${FLAVOR:L:Mimap}
d148 1
a150 5
PSEUDO_FLAVORS+=	no_calendar
.if ${FLAVOR:L:Mno_calendar}
CONFIGURE_ARGS+=	--with-ical=no
.else
MULTI_PACKAGES+=	-calendar
d157 3
a162 5
PSEUDO_FLAVORS+=	no_ldap
.if ${FLAVOR:L:Mno_ldap}
CONFIGURE_ARGS+=	--with-ldap=no
.else
MULTI_PACKAGES+=	-ldap
d166 3
d172 1
a173 3
#.if ${FLAVOR:L:Mno_mysql}
#CONFIGURE_ARGS+=	--with-mysqlclient=no
#.else
d175 1
d179 3
a184 6
PSEUDO_FLAVORS+=	no_odbc
.if ${FLAVOR:L:Mno_odbc}
CONFIGURE_ARGS+=	--with-iodbc=no \
			--with-ltdl=no
.else
MULTI_PACKAGES+=	-odbc
d188 4
a194 5
PSEUDO_FLAVORS+=	no_pgsql
.if ${FLAVOR:L:Mno_pgsql}
CONFIGURE_ARGS+=	--with-postgres=no
.else
MULTI_PACKAGES+=	-pgsql
d198 3
a203 5
PSEUDO_FLAVORS+=	no_snmp
.if ${FLAVOR:L:Mno_snmp}
CONFIGURE_ARGS+=	--with-snmp=no
.else
MULTI_PACKAGES+=	-snmp
d207 3
a212 5
PSEUDO_FLAVORS+=	no_speex
.if ${FLAVOR:L:Mno_speex}
CONFIGURE_ARGS+=	--with-speex=no
.else
MULTI_PACKAGES+=	-speex
d216 3
d231 1
a231 1
RUN_DEPENDS$i +=	asterisk-${VER}:${PKGPATH}
@


1.124
log
@honor CFLAGS and don't force -Os or -O; ok sthen@@
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.123 2011/09/16 11:41:40 espie Exp $
d6 1
a6 1
VER=			1.8.6.0
a8 2
REVISION =		0
REVISION-main=		1
@


1.123
log
@normalize pkgpath
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.122 2011/09/09 15:29:21 sthen Exp $
d10 1
@


1.122
log
@update to asterisk 1.8.6.0
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.121 2011/07/12 19:54:39 sthen Exp $
d9 1
@


1.121
log
@update to asterisk 1.8.5.0, chan_unistim parts from & ok ian@@
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.120 2011/07/07 01:19:02 ajacoutot Exp $
d6 1
a6 1
VER=			1.8.5.0
@


1.121.2.1
log
@Patch SECURITY bug in Asterisk; trivial remote crash in SIP affecting all
previous 1.8.x versions (uninitialized variable). AST-2011-012 / CVE-2011-4063
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.121 2011/07/12 19:54:39 sthen Exp $
a6 1
REVISION-main=		0
@


1.121.2.2
log
@security; fix AST-2011-014 crash with automon enabled in features.conf and SIP
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.121.2.1 2011/10/17 19:54:16 sthen Exp $
d7 1
a7 1
REVISION-main=		1
@


1.121.2.3
log
@add upstream patches to asterisk in 5.0-stable to fix recent security problems:

AST-2012-002: stack buffer overflow (remote unauthenticated sessions).
requires a dialplan using the Milliwatt application with the 'o' option,
and internal_timing off.  Affects all 1.4+ Asterisk versions.

AST-2012-003: stack buffer overflow (remote unauth'd sessions) in HTTP
manager interface; triggered by long digest authentication strings.
Code injection possibility.  Affects 1.8+.
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.121.2.2 2011/12/09 00:22:50 sthen Exp $
d7 1
a7 1
REVISION-main=		2
@


1.120
log
@libiconv MODULE.
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.119 2011/06/29 01:15:04 sthen Exp $
d6 1
a6 1
VER=			1.8.4.4
a9 2
REVISION-main=		0

d11 1
a11 1
SOUNDS_CORE=		asterisk-core-sounds-en-gsm-1.4.20
@


1.119
log
@security update to asterisk 1.8.4.4: fix a case where invalid username
was distinguishable from incorrect password.
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.118 2011/06/27 21:15:14 sthen Exp $
d10 2
d31 1
a31 1
WANTLIB-main +=	c crypto curl execinfo gsm iconv idn iksemel
d33 1
a33 1
WANTLIB-main += tiff vorbis vorbisenc xml2 z
d35 1
a35 1
MODULES=		devel/gettext
@


1.118
log
@- add commented-out example settings for configuring a server behind nat
- be explicit in sample config that people should use strong secrets
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.117 2011/06/24 13:50:09 sthen Exp $
d6 1
a6 1
VER=			1.8.4.3
a8 1
REVISION-main=		0
@


1.117
log
@Your regularly scheduled security update to asterisk-1.8.4.3

AST-2011-008: If a remote user sends a SIP packet containing a null,
Asterisk assumes available data extends past the null to the
end of the packet when the buffer is actually truncated when
copied. This causes SIP header parsing to modify data past
the end of the buffer altering unrelated memory structures.
This vulnerability does not affect TCP/TLS connections.
-- Resolved in 1.6.2.18.1 and 1.8.4.3

AST-2011-009: A remote user sending a SIP packet containing a Contact header
with a missing left angle bracket (<) causes Asterisk to
access a null pointer.
-- Resolved in 1.8.4.3

AST-2011-010: A memory address was inadvertently transmitted over the
network via IAX2 via an option control frame and the remote party would try
to access it.
-- Resolved in 1.4.41.1, 1.6.2.18.1, and 1.8.4.3
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.116 2011/06/03 16:08:01 sthen Exp $
d9 1
@


1.116
log
@Fix asterisk build on a clean box; there is a bogus dependency on libltdl
recorded in asterisk's menuselect system, knocking out ODBC build if not
present (though this is only done, afaict, due to a missing dependency
in a unixodbc package on some linux version), so add libltdl as a
BUILD_DEPENDS.

Doesn't affect the packages, other than -odbc wasn't built before
unless you had libltdl installed, so no bump.
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.115 2011/06/02 20:10:01 sthen Exp $
d6 1
a6 1
VER=			1.8.4.2
@


1.115
log
@SECURITY update to asterisk-1.8.4.2; CVE-2011-2216:
Null pointer deref in SIP if malformed Contact headers are present.
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.114 2011/06/02 13:41:41 ajacoutot Exp $
d68 2
a69 1
			${MODGNU_AUTOMAKE_DEPENDS}
@


1.114
log
@Add a consistent header that substitutes FULLPKGNAME for the READMEs.

ok jasper@@ sthen@@
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.113 2011/05/25 20:11:02 sthen Exp $
d6 1
a6 1
VER=			1.8.4.1
a8 2

REVISION-main=		0
@


1.113
log
@Bugfix update of Asterisk to 1.8.4.1
- Fix compliance with RFC 3261 section 18.2.2. (aka Cisco phone fix)
- Resolve a change in IPv6 header parsing due to the Cisco phone fix issue.
- Resolve potential crash when using SIP TLS support.
- Improve reliability when using SIP TLS.
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.112 2011/05/11 15:07:14 sthen Exp $
d9 2
@


1.112
log
@update to 1.8.4
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.111 2011/04/27 17:42:02 sthen Exp $
d6 1
a6 1
VER=			1.8.4
@


1.111
log
@- switch to correct 1.8.3.3 tarball now it's available (vs. 1.8.3.2+patchset)
- bump -main as some rcs id's built into files changed
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.110 2011/04/21 22:28:40 sthen Exp $
d6 2
a7 4
VER=			1.8.3.3
REVISION-main=		0
DISTNAME=		asterisk-1.8.3.3
#DISTNAME=		asterisk-${VER:S/beta/-beta/:S/rc/-rc/}
@


1.110
log
@SECURITY update to 1.8.3.3

- AST-2011-006, shell access via remote authenticated manager
sessions (logged-in manager users can execute shell commands via
the manager interface without having the "system" privilege that
should be required)

- AST-2011-005, DoS with remote unauthenticated sessions (add limits
to prevent unauthenticated users from tying up all available FDs for
the manager interface, SIP-over-TCP, Skinny and the built in HTTP
server).

(updating by way of upstream patch file, the full tar.gz isn't
available yet).
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.109 2011/04/15 16:13:24 ajacoutot Exp $
d7 2
a8 1
DISTNAME=		asterisk-1.8.3.2
a9 1
PATCHFILES=		asterisk-1.8.3.3-patch.gz
@


1.109
log
@Fix build after gnutls update.

ok jasper@@ landry@@
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.108 2011/04/09 19:16:51 ian Exp $
d6 4
a9 2
VER=			1.8.3.2
DISTNAME=		asterisk-${VER:S/beta/-beta/:S/rc/-rc/}
a10 2

REVISION-main=		2
@


1.108
log
@Unbreak chan_unistim, bump. OK sthen@@ (maintainer)
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.106 2011/03/20 15:37:06 ajacoutot Exp $
d10 1
a10 1
REVISION-main=		1
d76 2
a77 1
			LDFLAGS="${LDFLAGS}"
@


1.107
log
@use correct autoconf
@
text
@d10 1
a10 1
REVISION-main=		0
@


1.106
log
@Make use of rcexec in rc_start().

ok sthen@@ (maintainer)
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.105 2011/03/17 21:38:09 sthen Exp $
d67 1
a67 1
AUTOCONF_VERSION=	2.64 # XXX 2.65 adds _'s with our m4
@


1.105
log
@update to 1.8.3.2, rerelease due to a problem with one of the fixes in 1.8.3.1.
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.104 2011/03/16 23:27:11 sthen Exp $
d9 2
@


1.104
log
@update to 1.8.3.1; fixes AST-2011-003 and AST-2011-004:
unchecked return codes (fdopen, fwrite) causing null pointer
deref / resource exhaustion.

http://downloads.asterisk.org/pub/security/AST-2011-003.html
http://downloads.asterisk.org/pub/security/AST-2011-004.html
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.103 2011/03/09 18:51:48 ajacoutot Exp $
d6 1
a6 1
VER=			1.8.3.1
@


1.103
log
@Remove now uneeded redirection.
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.102 2011/03/02 13:28:24 sthen Exp $
d6 1
a6 1
VER=			1.8.3
a8 2

REVISION-main=		0
@


1.102
log
@bugfix update to 1.8.3
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.101 2011/03/02 12:53:11 sthen Exp $
d9 2
@


1.101
log
@SECURITY update to 1.8.2.4 fixes AST-2011-002 buffer overflow
Workaround: add "t38pt_udptl = no" to the general section in sip.conf
(chan_ooh323 is also affected but we don't build that).
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.100 2011/01/20 21:44:54 sthen Exp $
d6 1
a6 1
VER=			1.8.2.4
@


1.100
log
@SECURITY update (for real this time) to 1.8.2.2; no other changes.
"Due to a failed merge, Asterisk 1.8.2.1 which should have included
the security fix did not. Asterisk 1.8.2.2 contains the the changes
which should have been included in Asterisk 1.8.2.1."  ok ajacoutot@@
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.99 2011/01/20 16:26:26 sthen Exp $
d6 1
a6 1
VER=			1.8.2.2
d228 1
a228 1
EXAMPLEFILES=		extensions.ael extensions.conf logger.conf \
@


1.100.2.1
log
@Merge Asterisk from current to -stable (mostly; we still have to
use autoconf 2.64 as 2.65 needs newer m4 than 4.9-release has).
Too many important fixes to cherrypick them, including the security
fixes below, plus some others which aren't directly security-related.

AST-2011-007 (CVE-2011-2216): Null pointer deref in SIP if
malformed Contact headers are present. Remote crash can be triggered
by anyone who can send you a SIP call.

AST-2011-006: shell access via remote authenticated manager
sessions (logged-in manager users can execute shell commands via
the manager interface without having the "system" privilege that
should be required)

AST-2011-005: DoS with remote unauthenticated sessions (add limits
to prevent unauthenticated users from tying up all available FDs for
the manager interface, SIP-over-TCP, Skinny and the built in HTTP
server).

AST-2011-003 and AST-2011-004: unchecked return codes (fdopen, fwrite)
causing null pointer deref / resource exhaustion.

AST-2011-002: buffer overflow.
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.115 2011/06/02 20:10:01 sthen Exp $
d6 1
a6 1
VER=			1.8.4.2
d65 1
a65 1
AUTOCONF_VERSION=	2.64 # XXX 2.65 adds _'s with m4 in 4.9-release
d68 1
a68 2
			${MODGNU_AUTOMAKE_DEPENDS} \
			devel/libtool,-ltdl # bogus dependencies in menuselect
d183 2
a184 1
CONFIGURE_ARGS+=	--with-iodbc=no
d228 1
a228 1
EXAMPLEFILES=		cdr.conf extensions.ael extensions.conf logger.conf \
@


1.100.2.2
log
@MFC: security update to asterisk 1.8.4.3

AST-2011-008: If a remote user sends a SIP packet containing a null,
Asterisk assumes available data extends past the null to the
end of the packet when the buffer is actually truncated when
copied. This causes SIP header parsing to modify data past
the end of the buffer altering unrelated memory structures.
This vulnerability does not affect TCP/TLS connections.
-- Resolved in 1.6.2.18.1 and 1.8.4.3

AST-2011-009: A remote user sending a SIP packet containing a Contact header
with a missing left angle bracket (<) causes Asterisk to
access a null pointer.
-- Resolved in 1.8.4.3

AST-2011-010: A memory address was inadvertently transmitted over the
network via IAX2 via an option control frame and the remote party would try
to access it.
-- Resolved in 1.4.41.1, 1.6.2.18.1, and 1.8.4.3
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.100.2.1 2011/06/03 16:10:21 sthen Exp $
d6 1
a6 1
VER=			1.8.4.3
@


1.99
log
@Cherrypicked diff from svn; fix the internal implementation of htonll/ntohll
which was incorrect and would cause IAX interoperation to break. ok jasper@@
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.98 2011/01/19 11:25:16 sthen Exp $
d6 1
a6 2
VER=			1.8.2.1
REVISION=		0
@


1.98
log
@SECURITY update to asterisk 1.8.2.1, fixes AST-2011-001 "an issue
when forming an outgoing SIP request while in pedantic mode, which
can cause a stack buffer to be made to overflow if supplied with
carefully crafted caller ID information"

http://downloads.asterisk.org/pub/security/AST-2011-001.html

This is also a major version update to the long-term support
1.8 branch, previous versions of this diff have been tested by
various ports@@ readers, thanks for testing.

Please review /usr/local/share/doc/asterisk/UPGRADE.txt
(also note that memory use has increased).

ok ajacoutot@@ jasper@@
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.97 2011/01/04 22:35:46 fgsch Exp $
d7 1
@


1.97
log
@Add rc script taken from the 1.8 update diff sent to ports@@ by sthen@@.
sthen@@ ok.
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.96 2010/11/20 19:56:47 espie Exp $
d6 2
a7 3
VER=			1.6.2.14
CORESOUNDS=		1.4.19
DISTNAME=		asterisk-${VER:S/rc/-rc/}
d9 5
a13 1
REVISION-main =		0
d29 5
d35 1
a35 4
SUBST_VARS+=		CORESOUNDS

WANTLIB-main +=	c crypto execinfo gsm iconv m ogg popt pthread
WANTLIB-main += sqlite3 ssl stdc++ termcap vorbis vorbisenc xml2 z
a39 1
			textproc/libxml \
d42 5
a46 1
			devel/popt
d50 10
a62 1
USE_GROFF =		Yes
d65 2
a66 2
AUTOCONF_VERSION=	2.63
AUTOMAKE_VERSION=	1.9
d75 1
a75 1
MAKE_ENV+=		ASTCFLAGS="${CFLAGS}" \
d77 2
a78 1
			NOISY_BUILD="Yes"
d81 1
a81 2
			--sharedstatedir=${PREFIX}/share/asterisk \
			--with-sounds-cache=no
a86 1
			--with-gtk=no \
a106 1
			--with-imap=no \
d115 1
a115 1
# to WRKSRC, 'gmake menuselect', then cd back to the port directory
a117 1
# XXX h323 is broken; requires older lib
d119 2
a120 1
#FLAVORS=		h323
d122 57
a178 6
# If using IMAP_STORAGE for voicemail, use this to pick up c-client.
# Needs to be a flavour, {FILE,ODBC,IMAP}_STORAGE are mutually exclusive.
#CONFIGURE_ARGS+=	--with-imap=system
#CPPFLAGS+=		-I${LOCALBASE}/include/c-client
#LIB_DEPENDS-main=	mail/imap-uw,-c-client
#WANTLIB-main+=		c-client
d192 11
a224 65
# curl
PSEUDO_FLAVORS+=	no_curl
.if ${FLAVOR:L:Mno_curl}
CONFIGURE_ARGS+=	--with-curl=no
.else
MULTI_PACKAGES+=	-curl
COMMENT-curl=		libCURL support for Asterisk
WANTLIB-curl=		curl crypto idn ssl z
LIB_DEPENDS-curl=	net/curl
.endif

# postgresql
PSEUDO_FLAVORS+=	no_pgsql
.if ${FLAVOR:L:Mno_pgsql}
CONFIGURE_ARGS+=	--with-postgres=no
.else
MULTI_PACKAGES+=	-pgsql
COMMENT-pgsql=		PostgreSQL support for Asterisk
WANTLIB-pgsql=		pq z
LIB_DEPENDS-pgsql=	databases/postgresql
.endif

# jabber
PSEUDO_FLAVORS+=	no_jabber
.if ${FLAVOR:L:Mno_jabber}
CONFIGURE_ARGS+=	--with-iksemel=no
.else
MULTI_PACKAGES+=	-jabber
COMMENT-jabber=		Jabber support for Asterisk
LIB_DEPENDS-jabber=	textproc/iksemel
WANTLIB-jabber=		crypto iksemel ssl
.endif

# h323
.if ${FLAVOR:L:Mh323}
LIB_DEPENDS-main+=	::net/h323plus
WANTLIB-main+=		SDL avutil expat h323.>=3 lber ldap ldap_r pt.>=3 sasl2
.else
CONFIGURE_ARGS+=	--with-pwlib=no \
			--with-h323=no
.endif

# ldap
PSEUDO_FLAVORS+=	no_ldap
.if ${FLAVOR:L:Mno_ldap}
CONFIGURE_ARGS+=	--with-ldap=no
.else
MULTI_PACKAGES+=	-ldap
COMMENT-ldap=		LDAP support for Asterisk
LIB_DEPENDS-ldap=	databases/openldap,-main
WANTLIB-ldap=		ldap
.endif

# fax
PSEUDO_FLAVORS+=	no_fax
.if ${FLAVOR:L:Mno_fax}
CONFIGURE_ARGS+=	--with-spandsp=no
.else
MULTI_PACKAGES+=	-fax
COMMENT-fax=		FAX support for Asterisk
LIB_DEPENDS-fax=	telephony/spandsp \
			graphics/tiff
WANTLIB-fax=		spandsp tiff
.endif

a237 7
# we don't really want to drag in TeX as a dependency, but at least
# allow the icons in the HTML docs to work if you already have latex2html
# installed.
pre-configure:
	perl -pi -e 's,/usr/share/latex2html,${LOCALBASE}/share/latex2html,g' \
	    ${WRKSRC}/doc/tex/asterisk/*

d239 4
a247 3
post-build:
	cd ${WRKBUILD}; ${MAKE_PROGRAM} asterisk.txt

d253 1
a253 1
	${INSTALL_DATA} `find ${WRKSRC}/doc -type f` \
d260 3
@


1.96
log
@new depends
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.95 2010/11/16 21:58:52 sthen Exp $
d10 1
@


1.95
log
@update Asterisk to 1.6.2.14
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.94 2010/10/19 07:43:05 espie Exp $
d31 7
a37 7
LIB_DEPENDS-main=	::audio/gsm \
			::audio/libogg \
			::audio/libvorbis \
			::textproc/libxml \
			::databases/sqlite3 \
			::devel/libexecinfo \
			::devel/popt
d44 1
a44 1
USE_GROFF =	Yes
d110 1
a110 1
#LIB_DEPENDS-main=	::mail/imap-uw,-c-client
d121 1
a121 1
LIB_DEPENDS-odbc=	::databases/iodbc
d133 1
a133 1
LIB_DEPENDS-snmp=	::net/net-snmp 
d144 1
a144 1
LIB_DEPENDS-speex=	:speex->=1.2rc1:audio/speex
d155 1
a155 1
LIB_DEPENDS-curl=	::net/curl
d166 1
a166 1
LIB_DEPENDS-pgsql=	::databases/postgresql
d176 1
a176 1
LIB_DEPENDS-jabber=	::textproc/iksemel
d196 1
a196 1
LIB_DEPENDS-ldap=	::databases/openldap,-main
d207 2
a208 2
LIB_DEPENDS-fax=	::telephony/spandsp \
			::graphics/tiff
d222 1
a222 1
RUN_DEPENDS$i +=	:asterisk-${VER}:${PKGPATH}
@


1.94
log
@USE_GROFF=Yes
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.93 2010/09/19 21:14:05 sthen Exp $
d6 1
a6 1
VER=			1.6.2.13
@


1.93
log
@- update Asterisk to 1.6.2.13

- upstream have prevented chan_h323 from building with pwlib>=1.19.0
as it segfaults at startup; disable the h323 flavour for now.
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.92 2010/08/27 00:48:19 sthen Exp $
d44 1
@


1.92
log
@readd missing _ from user/group names in sample config. spotted by Brad.
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.91 2010/08/17 19:53:01 sthen Exp $
d6 1
a6 2
VER=			1.6.2.11
REVISION-main=		0
d62 1
a62 1
			--with-sounds-cache=${DISTDIR}
d101 1
d103 1
a103 1
FLAVORS=		h323
@


1.91
log
@update asterisk to 1.6.2.11, loads of pretty safe bug fixes
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.90 2010/07/25 10:08:03 sthen Exp $
d7 1
@


1.90
log
@update to 1.6.2.10, switch to new LIB_DEPENDS etc.
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.89 2010/07/05 22:03:22 sthen Exp $
d6 1
a6 1
VER=			1.6.2.10
@


1.90.2.1
log
@- Add a patch to -stable to fix the AST-2011-001 security problem
(a stack buffer overflow in URI encoding, triggered by crafted caller
ID information when generating outgoing SIP calls, by the uriencode
dialplan function, and possibly with the AGI dialplan application).
http://downloads.asterisk.org/pub/security/AST-2011-001.html

- MFC: use correct user/group names in sample config.

ok william@@ ajacoutot@@
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.90 2010/07/25 10:08:03 sthen Exp $
a6 1
REVISION=		0
@


1.89
log
@adapt to our new SO_PEERCRED
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.88 2010/06/18 22:10:44 sthen Exp $
d6 1
a6 1
VER=			1.6.2.9
d9 1
a9 2
# XXX if bumping subpackages, override FULLPKGNAME-sub not just PKGNAME-sub
PKGNAME-main=		asterisk-${VER}p0
d28 10
a37 8
WANTLIB-main=		c crypto iconv m pthread ssl stdc++ termcap z
LIB_DEPENDS-main=	gsm::audio/gsm \
			ogg.>=5::audio/libogg \
			vorbis.>=5,vorbisenc.>=2::audio/libvorbis \
			xml2::textproc/libxml \
			sqlite3.>=3::databases/sqlite3 \
			execinfo::devel/libexecinfo \
			popt::devel/popt
a59 1
# basic stuff
d61 3
a63 2
			--sharedstatedir=${PREFIX}/share/asterisk
# unlikely
d78 2
d88 2
a89 3
# sometime?
CONFIGURE_ARGS+=	--with-imap=no \
			--with-jack=no \
a93 2
			--with-sdl=no \
			--with-SDL_image=no \
d104 7
d119 2
a120 1
LIB_DEPENDS-odbc=	iodbc.>=3::databases/iodbc
d130 2
a131 5
WANTLIB-snmp=		c m perl util
LIB_DEPENDS-snmp=	netsnmp.>=7::net/net-snmp \
			netsnmpagent.>=7::net/net-snmp \
			netsnmphelpers.>=7::net/net-snmp \
			netsnmpmibs.>=7::net/net-snmp
d141 2
a142 3
WANTLIB-speex=		m
LIB_DEPENDS-speex=	speex.>=7:speex->=1.2rc1:audio/speex \
			speexdsp:speex->=1.2rc1:audio/speex
d152 2
a153 2
WANTLIB-curl=		crypto idn ssl z
LIB_DEPENDS-curl=	curl.>=6::net/curl
d163 2
a164 2
WANTLIB-pgsql=		z
LIB_DEPENDS-pgsql=	pq.>=5::databases/postgresql
d174 2
a175 2
LIB_DEPENDS-jabber=	iksemel::textproc/iksemel
WANTLIB-jabber=		crypto ssl
d180 2
a181 2
LIB_DEPENDS-main+=	h323.>=3::net/h323plus
WANTLIB-main+=		SDL avutil expat lber ldap ldap_r pt.>=3 sasl2
d194 2
a195 1
LIB_DEPENDS-ldap=	ldap::databases/openldap,-main
d205 3
a207 2
LIB_DEPENDS-fax=	spandsp::telephony/spandsp \
			tiff::graphics/tiff
@


1.88
log
@update to 1.6.2.9; various crash fixes (including one with dtmf detection)
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.87 2010/06/07 20:03:55 sthen Exp $
d10 1
a10 1
PKGNAME-main=		asterisk-${VER}
@


1.87
log
@Don't ulimit -n $MAXFILES if $MAXFILES is undefined. Spotted by fgsch@@
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.86 2010/06/02 13:18:56 sthen Exp $
d6 2
a7 2
VER=			1.6.2.8
CORESOUNDS=		1.4.18
d9 2
a10 2
# XXX if bumping subpackages, override FULLPKGNAME
PKGNAME-main=		asterisk-${VER}p0
@


1.86
log
@update to 1.6.2.8
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.85 2010/05/04 23:02:58 sthen Exp $
d9 2
a10 2
# XXX if bumping, see FULLPKGNAME overrides below.
PKGNAME-main=		asterisk-${VER}
@


1.85
log
@Update to 1.6.2.7; various bugs fixed including some DTMF problems,
potential crashes in chan_sip, and a chan_local deadlock.
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.84 2010/05/04 14:41:48 sthen Exp $
d6 2
a7 5
VER=			1.6.2.7
# you can set PATCHVER=p0, p1 etc to bump everything,
# this takes care of the subpackage/flavor maze
#PATCHVER=		p4
CORESOUNDS=		1.4.17
d9 2
a10 1
PKGNAME-main=		asterisk-${VER}${PATCHVER}
a203 7
.for i in ${MULTI_PACKAGES:N-main}
# the subpackages aren't flavoured, so overwrite the default name/path
FULLPKGNAME$i ?=	asterisk$i-${VER}${PATCHVER}
FULLPKGPATH$i ?=	${PKGPATH},$i
RUN_DEPENDS$i +=	:asterisk-${VER}:${PKGPATH}
.endfor

d210 7
d229 3
@


1.84
log
@Add to UPGRADE-1.6.txt telling people that insecure=very (deprecated for
>3 years and triggering a warning in the logs) has been removed in this
version.
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.83 2010/05/04 12:42:33 sthen Exp $
d6 1
a6 1
VER=			1.6.2.6
d9 1
a9 1
PATCHVER=		p4
@


1.83
log
@- s/autoconf/gnu in CONFIGURE_STYLE to prevent running autoconf twice
- remove stray ' in pre-configure target, oops
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.82 2010/05/03 21:00:34 sthen Exp $
d9 1
a9 1
PATCHVER=		p3
@


1.82
log
@- patch icon paths in the html docs (it won't help unless you have latex2html
installed, which I won't add as a dependency just for this, but for people who
already have it, it makes the docs look nicer).

- install the sample features.conf which was @@comment'ed.
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.81 2010/04/14 08:23:38 sthen Exp $
d46 1
a46 1
CONFIGURE_STYLE=	autoconf
d223 1
a223 1
	perl -pi -e 's,/usr/share/latex2html',${LOCALBASE}/share/latex2html,g' \
@


1.81
log
@Use -pthread when checking for pthread_rwlock_timedwrlock.
No change yet, but means that the function can be used when it's
added to pthread. From Brad.
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.80 2010/04/10 12:45:35 sthen Exp $
d9 1
a9 1
PATCHVER=		p2
d218 7
@


1.80
log
@Improve the sample dialplan;

- use ${FILTER(...)} to only permit digits; dialplan injection is bad, mmmkay
- ConfBridge sample based on information from Diego Casati
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.79 2010/04/09 11:05:55 sthen Exp $
d9 1
a9 1
PATCHVER=		p1
@


1.79
log
@fix issues with unitialized address family; one when outboundproxy
is used, reported by Alexey Suslikov, one with dnsmgr when the looked-up
IP address of a peer changes (bug 15827).
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.78 2010/04/08 16:18:00 sthen Exp $
d9 1
a9 1
PATCHVER=		p0
@


1.78
log
@Update Asterisk to 1.6.2.6, which will be the only of the 1.6.x branches
receiving most updates in the future; notably, compared to the in-tree
version, this adds a portable (pthread-based) clocking source rather
than relying on a non-portable zaptel timer.

Main functions tested and working well for myself and Diego Casati (thanks!)
Note that ConfBridge (added since 1.6.0) may need more work
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.77 2010/04/02 23:18:53 sthen Exp $
d9 1
a9 1
#PATCHVER=		p0
@


1.77
log
@use autoconf 2.63
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.76 2010/04/02 19:28:45 sthen Exp $
d6 1
a6 1
VER=			1.6.0.26
d9 1
a9 1
PATCHVER=		p1
d31 1
a31 1
WANTLIB-main=		c crypto m pthread ssl stdc++ termcap z
d35 1
a114 2
CONFIGURE_ARGS+=	--with-iodbc=${LOCALBASE} \
			--with-ltdl=${LOCALBASE}
a128 1
CONFIGURE_ARGS+=	--with-netsnmp=${LOCALBASE}
d132 2
a133 3
# XXX crashes at startup (bus error)
#PSEUDO_FLAVORS+=	no_speex
#.if ${FLAVOR:L:Mno_speex}
d135 7
a141 9
#.else
#MULTI_PACKAGES+=	-speex
#COMMENT-speex=		Speex codec for Asterisk
#WANTLIB-speex=		m
#LIB_DEPENDS-speex=	speex.>=7:speex->=1.2rc1:audio/speex \
#			speexdsp:speex->=1.2rc1:audio/speex
#CONFIGURE_ARGS+=	--with-speex=${LOCALBASE} \
#			--with-speexdsp=${LOCALBASE}
#.endif
a151 1
CONFIGURE_ARGS+=	--with-curl=${LOCALBASE}
a162 1
CONFIGURE_ARGS+=	--with-postgres=${LOCALBASE}
d173 1
@


1.76
log
@add a patch from upstream, fixing build with newer sqlite
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.75 2010/03/25 12:01:47 sthen Exp $
d9 1
a9 1
PATCHVER=		p0
d46 1
a46 2
# Should be 2.63(?)
AUTOCONF_VERSION=	2.62
@


1.75
log
@update to 1.6.0.26 + a patch from a ticket upstream.
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.74 2010/03/23 21:16:53 ajacoutot Exp $
d9 1
a9 1
#PATCHVER=		p0
@


1.74
log
@Move to using h323plus and ptlib.
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.73 2010/02/26 18:42:12 espie Exp $
d6 1
a6 1
VER=			1.6.0.25
d12 1
a12 1
PKGNAME-main=		asterisk-${VER}${PATCHVER}p0
@


1.73
log
@simplify: we can set PKGNAME-main here (avoid future warning for FULLPKGPATH)
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.72 2010/02/26 12:44:14 sthen Exp $
d12 1
a12 1
PKGNAME-main=		asterisk-${VER}${PATCHVER}
d185 2
a186 3
LIB_DEPENDS-main+=	h323::net/openh323 \
			pt::devel/pwlib
WANTLIB-main+=		SDL avutil expat lber ldap ldap_r sasl2
@


1.72
log
@- SECURITY update to 1.6.0.25, fixing AST-2010-003. if you use ACL rules
with something like 'deny 0.0.0.0/0' then this affects you. workaround:
'deny 0.0.0.0/0.0.0.0'

- fix fullpkgpath's for the subpackages, they were including the flavour
and shouldn't have - fixes problems with dpb3 found by naddy. add @@pkgpath
markers relating to this fix.

ok naddy@@
(reminder, ports is not fully open, do not commit without specific permission)
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.71 2010/02/03 00:18:44 sthen Exp $
d12 1
a12 1
FULLPKGNAME-main=	asterisk-${VER}${PATCHVER}
a187 1
FULLPKGNAME-main=	asterisk-${VER}${PATCHVER}-h323
@


1.71
log
@SECURITY update to 1.6.0.22, fixing CVE-2010-0441, an unauthenticated
crash in SIP (and only this, thanks to Asterisk developers for pushing
security fixes separately from other changes).

Does not affect Asterisk 1.4 in -stable (it's in the T.38 support,
which was added in 1.6).

ok ajacoutot@@
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.70 2010/01/17 13:18:36 sthen Exp $
d6 1
a6 1
VER=			1.6.0.22
d215 2
a216 1
.for i in ${MULTI_PACKAGES:S/-main//}
d218 1
d237 1
a237 1
		${WRKSRC}/{ChangeLog,LICENSE,README,UPGRADE*.txt} \
@


1.70
log
@Update to 1.6.0.21, various bugs (including some crashes) fixed.
This also has a small change in CDR generation, it's been well tested
upstream but still this can be a touchy area to change, so it's
going in now so the first OpenBSD release with Asterisk 1.6
packages has the change already made.

ok ajacoutot@@
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.69 2009/12/21 00:19:02 fgsch Exp $
d6 1
a6 1
VER=			1.6.0.21
@


1.69
log
@Allow asterisk to change the vm password by tweaking the perms. Bump.
sthen@@ ok.
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.68 2009/12/19 00:09:37 sthen Exp $
d6 1
a6 1
VER=			1.6.0.20
d9 2
a10 2
PATCHVER=		p0
CORESOUNDS=		1.4.16
@


1.68
log
@update to 1.6.0.20
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.67 2009/12/14 04:49:24 fgsch Exp $
d9 1
a9 1
#PATCHVER=		p1
@


1.67
log
@install chan_h323.so and put h323 fragment after confdir is created.
remove extraunexec and bump. sthen@@ ok.
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.66 2009/12/13 12:23:57 sthen Exp $
d6 1
a6 1
VER=			1.6.0.19
d9 1
a9 1
PATCHVER=		p1
@


1.66
log
@missing an app_conference @@conflict
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.65 2009/12/13 12:11:29 sthen Exp $
d9 1
a9 1
PATCHVER=		p0
@


1.65
log
@Major version update to 1.6.0.19. For more information about the
upgrade, see /usr/local/share/doc/asterisk/UPGRADE-1.6.txt

Particular thanks to fgsch@@, ian@@ and Michiel van Baak for help and testing.
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.53 2009/04/05 22:37:35 sthen Exp $
d9 1
a9 1
PATCHVER=		
@


1.64
log
@SECURITY update to 1.4.27.1 for unauthenticated remote crash in RTP.
http://downloads.digium.com/pub/security/AST-2009-010.html
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.63 2009/11/19 16:17:04 sthen Exp $
d6 1
a6 1
VER=			1.4.27.1
d28 1
a28 1
MULTI_PACKAGES=		-main
d32 6
d39 2
a40 4
LIB_DEPENDS-main=	popt::devel/popt \
			gsm::audio/gsm

MASTER_SITES=		http://downloads.asterisk.org/pub/telephony/asterisk/releases/
d45 3
a47 2
CONFIGURE_STYLE=	gnu
AUTOCONF_VERSION=	2.61
d53 1
a53 1
LDFLAGS+=		-L${X11BASE}/lib -L${LOCALBASE}/lib
d57 1
a57 1
MAKE_ENV=		ASTCFLAGS="${CFLAGS}" \
d59 1
a59 1
			DEBUG=""
d61 11
a71 5
CONFIGURE_ARGS+=	--with-asterisk-user=_asterisk \
			--with-asterisk-group=_asterisk \
			--localstatedir=/var \
			--sharedstatedir=${PREFIX}/share/asterisk \
			--with-asound=no \
a72 1
			--with-kde=no \
d76 2
a77 1
			--with-popt=${LOCALBASE} \
d79 2
a80 1
			--with-qt=no \
d84 2
a85 2
			--with-vpb=no \
			--with-zaptel=no
d87 5
a91 2
CONFIGURE_ARGS+=	--with-osptk=no \
			--with-oss=no \
d93 4
a96 3
			--with-sqlite=no \
			--with-tds=no \
			--with-imap=no
d109 1
a109 1
CONFIGURE_ARGS+=	--with-odbc=no \
d115 1
a115 1
CONFIGURE_ARGS+=	--with-odbc=${LOCALBASE} \
a148 16
# ogg
PSEUDO_FLAVORS+=	no_ogg
.if ${FLAVOR:L:Mno_ogg}
CONFIGURE_ARGS+=	--with-ogg=no \
			--with-vorbis=no
.else
MULTI_PACKAGES+=	-ogg
COMMENT-ogg=		Ogg Vorbis format translator for Asterisk
WANTLIB-ogg=		m
LIB_DEPENDS-ogg=	ogg.>=5::audio/libogg \
			vorbis.>=5::audio/libvorbis \
			vorbisenc.>=2::audio/libvorbis
CONFIGURE_ARGS+=	--with-ogg=${LOCALBASE} \
			--with-vorbis=${LOCALBASE}
.endif

d176 1
a176 2
CONFIGURE_ARGS+=	--with-gnutls=no \
			--with-iksemel=no
a179 1
WANTLIB-jabber=		gcrypt gnutls gpg-error z
a180 2
CONFIGURE_ARGS+=	--with-gnutls=${LOCALBASE} \
			--with-iksemel=${LOCALBASE}
a186 3
CPPFLAGS+=		-I${LOCALBASE}/include/openh323
CONFIGURE_ARGS+=	--with-pwlib=${LOCALBASE}/lib \
			--with-h323=${LOCALBASE}/lib
a188 5

pre-build:
	cd ${WRKSRC} && ${MAKE_PROGRAM} include/asterisk/buildopts.h
	cd ${WRKSRC}/channels/h323 && ${MAKE_PROGRAM} opt

d194 21
d217 1
a217 1
RUN_DEPENDS$i +=	:asterisk-${VER}${PATCHVER}:telephony/asterisk
a220 1

a221 1

d223 2
d235 1
a235 1
		${WRKSRC}/{ChangeLog,LICENSE,README,UPGRADE.txt} \
a238 1
	${INSTALL_DATA_DIR} ${EXAMPLEDIR}
d240 4
a243 3
	${INSTALL_DATA} ${FILESDIR}/*.sample ${EXAMPLEDIR}/openbsd
	@@perl -pi -e "s|%%LOCALBASE%%|${LOCALBASE}|g;" \
		${EXAMPLEDIR}/openbsd/*
d246 1
@


1.63
log
@update to 1.4.27, I'll soon be committing a 1.6.0 version but first let's
have the latest 1.4 for people who don't want to move yet.
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.62 2009/11/04 21:51:49 sthen Exp $
d6 1
a6 1
VER=			1.4.27
@


1.62
log
@Switch to using supplied bootstrap.sh (plus a patch to stop it
from overriding supplied AUTOfoo_VERSION variables) instead of the
custom Makefile target to run autoconf.

No package change -> no bump. Discussed with fgsch in relation
to 1.6, but it makes sense here too.
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.61 2009/11/04 21:49:42 sthen Exp $
d6 1
a6 1
VER=			1.4.26.3
d10 1
a10 1
CORESOUNDS=		1.4.15
d22 1
a22 2
# files." iaxy.bin (firmware) is freely redistributable, see LICENSE.
# core-sounds-en-gsm: GPLv2/CC-BY-SA, http://bugs.digium.com/view.php?id=10144
d47 8
a54 2
CONFIGURE_ENV+=		CPPFLAGS="${CPPFLAGS} -I${LOCALBASE}/include" \
			LDFLAGS="-L${LOCALBASE}/lib"
a209 4

MAKE_ENV=		ASTCFLAGS="${CFLAGS}" \
			ASTLDFLAGS="${LDFLAGS}" \
			DEBUG=""
@


1.61
log
@SECURITY update to 1.4.26.3;

AST-2009-008: SIP responses expose valid usernames
AST-2009-009: Cross-site AJAX request (ajamdemo.html/prototype.js)
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.60 2009/09/04 00:46:35 sthen Exp $
d217 4
a220 9
	cd ${WRKSRC} && AUTOMAKE_VERSION=${AUTOMAKE_VERSION} \
	    AUTOCONF_VERSION=${AUTOCONF_VERSION} aclocal -I autoconf
	cd ${WRKSRC} && AUTOMAKE_VERSION=${AUTOMAKE_VERSION} \
	    AUTOCONF_VERSION=${AUTOCONF_VERSION} autoconf
	cd ${WRKSRC} && AUTOMAKE_VERSION=${AUTOMAKE_VERSION} \
	    AUTOCONF_VERSION=${AUTOCONF_VERSION} autoheader
	cd ${WRKSRC} && AUTOMAKE_VERSION=${AUTOMAKE_VERSION} \
	    AUTOCONF_VERSION=${AUTOCONF_VERSION} automake \
	    --add-missing --copy || true
@


1.60
log
@Update to 1.4.26.2; mitigates IAX2 denial of service AST-2009-006.

This makes an non-backwards-compatible change to the IAX2 protocol.
It can be disabled with various options, but is on by default.

IAX2 users, read http://downloads.digium.com/pub/security/AST-2009-006.html
and the new /usr/local/share/doc/asterisk/IAX2-security.pdf (available
online in http://svn.digium.com/svn/asterisk/tags/1.4.26.2/doc/).
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.59 2009/08/18 22:09:40 sthen Exp $
d6 1
a6 1
VER=			1.4.26.2
@


1.59
log
@Distfiles rerolled with different music-on-hold files.
See http://blogs.digium.com/2009/08/18/asterisk-music-on-hold-changes/
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.58 2009/08/10 23:22:31 sthen Exp $
d6 1
a6 1
VER=			1.4.26.1
d9 1
a9 1
PATCHVER=		p0
@


1.58
log
@SECURITY; http://downloads.asterisk.org/pub/security/AST-2009-005.html
Fixes sscanf without size bounds. The biggest problem affects SIP in
Asterisk 1.6.1+ (i.e. not OpenBSD ports/packages) but the update makes
sense anyway...
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.57 2009/07/21 22:05:24 sthen Exp $
d9 1
a9 1
PATCHVER=		
@


1.57
log
@bugfix update to 1.4.26; see http://www.asterisk.org/node/48610
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.56 2009/06/15 23:33:57 sthen Exp $
d6 1
a6 1
VER=			1.4.26
@


1.56
log
@- actually comment-out the (broken) speex subpackage rather than
just disable by setting the default FLAVOR; the asterisk,h323 entry
in ../Makefile picked it up. the unused pkg/*-speex files don't hurt,
so keep them around. bump PKGNAME (most likely gratuitous, but it's
cheap).
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.55 2009/06/05 23:10:40 sthen Exp $
d6 4
a9 1
V=			1.4.25.1
d11 2
a12 3
DISTNAME=		asterisk-$V
FULLPKGNAME-main=	asterisk-$Vp0
# N.B. overridden for h323 flavor below.
d117 1
a117 1
#CONFIGURE_ARGS+=	--with-speex=no
d190 1
a190 1
FULLPKGNAME-main=	asterisk-$Vp0-h323
d202 2
a203 2
FULLPKGNAME$i ?=	asterisk$i-$V
RUN_DEPENDS$i +=	:asterisk-$V:telephony/asterisk
@


1.56.2.1
log
@MFC:

SECURITY UPDATE

asterisk-1.4.27

Resolves multiple security issues

ok sthen@@ jasper@@
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.56 2009/06/15 23:33:57 sthen Exp $
d6 5
a10 7
VER=			1.4.27
# you can set PATCHVER=p0, p1 etc to bump everything,
# this takes care of the subpackage/flavor maze
PATCHVER=		
CORESOUNDS=		1.4.16
DISTNAME=		asterisk-${VER:S/rc/-rc/}
FULLPKGNAME-main=	asterisk-${VER}${PATCHVER}
d20 2
a21 1
# files." core-sounds-*: GPLv2/CC-BY-SA.
d46 2
a47 8
CPPFLAGS+=		-I${X11BASE}/include -I${LOCALBASE}/include
LDFLAGS+=		-L${X11BASE}/lib -L${LOCALBASE}/lib
CONFIGURE_ENV+=		CPPFLAGS="${CPPFLAGS}" \
			CFLAGS="${CFLAGS}" \
			LDFLAGS="${LDFLAGS}"
MAKE_ENV=		ASTCFLAGS="${CFLAGS}" \
			ASTLDFLAGS="${LDFLAGS}" \
			DEBUG=""
d115 1
a115 1
CONFIGURE_ARGS+=	--with-speex=no
d188 1
a188 1
FULLPKGNAME-main=	asterisk-${VER}${PATCHVER}-h323
d200 2
a201 2
FULLPKGNAME$i ?=	asterisk$i-${VER}${PATCHVER}
RUN_DEPENDS$i +=	:asterisk-${VER}${PATCHVER}:telephony/asterisk
d204 4
d215 9
a223 4
	cd ${WRKSRC}; \
	    AUTOMAKE_VERSION=${AUTOMAKE_VERSION} \
	    AUTOCONF_VERSION=${AUTOCONF_VERSION} \
	    ./bootstrap.sh
@


1.56.2.2
log
@MFC:

SECURITY update to 1.4.27.1 for unauthenticated remote crash in RTP.
http://downloads.digium.com/pub/security/AST-2009-010.html

and

Switch to using supplied bootstrap.sh (plus a patch to stop it
from overriding supplied AUTOfoo_VERSION variables) instead of the
custom Makefile target to run autoconf.

ok sthen@@ okidoki jasper@@
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.56.2.1 2009/11/23 03:42:45 william Exp $
d6 1
a6 1
VER=			1.4.27.1
@


1.55
log
@update to 1.4.25.1; revised fix for SECURITY issue CVE-2009-0041
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.54 2009/05/22 09:05:10 sthen Exp $
d9 1
a9 1
FULLPKGNAME-main=	asterisk-$V
d80 1
a80 1
FLAVOR?=		no_speex # XXX crashes at startup: Bus Error
d112 13
a124 12
PSEUDO_FLAVORS+=	no_speex
.if ${FLAVOR:L:Mno_speex}
CONFIGURE_ARGS+=	--with-speex=no
.else
MULTI_PACKAGES+=	-speex
COMMENT-speex=		Speex codec for Asterisk
WANTLIB-speex=		m
LIB_DEPENDS-speex=	speex.>=7:speex->=1.2beta3:audio/speex \
			speexdsp:speex->=1.2beta3:audio/speex
CONFIGURE_ARGS+=	--with-speex=${LOCALBASE} \
			--with-speexdsp=${LOCALBASE}
.endif
d188 1
a188 1
FULLPKGNAME-main=	asterisk-$V-h323
@


1.54
log
@maintenance update to 1.4.25. disable building the speex plugin by default
for now, it causes a SIGBUS at startup (and also did in the previous version)
which hasn't been tracked down yet.
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.53 2009/04/05 22:37:35 sthen Exp $
d6 1
a6 1
V=			1.4.25
@


1.53
log
@switch to external gsm library, bump package.
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.52 2009/04/02 19:37:25 sthen Exp $
d6 2
a7 1
V=			1.4.24.1
d9 1
a9 1
FULLPKGNAME-main=	asterisk-$Vp0
d28 1
d35 1
a35 1
MASTER_SITES=		http://downloads.digium.com/pub/telephony/asterisk/releases/
d80 1
a80 1
FLAVOR?=
@


1.52
log
@Minor security update to 1.4.24.1 for AST-2009-003 "SIP responses
expose valid usernames". This update changes "alwaysauthreject" to
return the same response for invalid username as it does for invalid
password.
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.51 2009/03/29 22:23:35 sthen Exp $
d8 1
a8 1
FULLPKGNAME-main=	asterisk-$V
d30 2
a31 1
LIB_DEPENDS-main=	popt::devel/popt
a51 1
			--with-gsm=internal \
@


1.51
log
@maintenance update to 1.4.24
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.50 2009/03/10 21:12:37 sthen Exp $
d6 1
a6 1
V=			1.4.24
@


1.50
log
@SECURITY; patch AST-2009-002, remote *unauthenticated* crash in SIP
where the "pedantic" option is enabled (disabled by default).

Backported rather than updated until I sort out the H323 autoconf
breakage in newer versions.
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.49 2009/01/24 11:22:26 sthen Exp $
d6 1
a6 1
V=			1.4.22.2
d8 1
a8 1
FULLPKGNAME-main=	asterisk-$Vp0
d38 4
d43 2
a44 1
CONFIGURE_ENV+=		CPPFLAGS="${CPPFLAGS} -I${LOCALBASE}/include"
d181 1
d185 1
a185 1
FULLPKGNAME-main=	asterisk-$Vp1-h323
d210 11
@


1.49
log
@SECURITY update to 1.4.22.2; updated fix for CVE-2009-0041 in IAX
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.48 2009/01/10 00:58:15 sthen Exp $
d8 2
a9 1
FULLPKGNAME-main=	asterisk-$V
d179 1
a179 1
FULLPKGNAME-main=	asterisk-$Vp0-h323
@


1.48
log
@better license marker; asterisk-core-sounds is now available under
CC-BY-SA. bump not necessary.
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.47 2009/01/08 21:04:02 sthen Exp $
d6 1
a6 1
V=			1.4.22.1
d177 1
a177 1
WANTLIB-main+=		SDL avutil expat lber ldap ldap_r ossaudio sasl2
@


1.47
log
@SECURITY update to 1.4.22.1, fixing CVE-2009-0041: remote unauthenticated
users with access to the IAX port can use it to verify validity of usernames.
No other code changes in this version.

While there, remove spurious @@user from PLIST.
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.46 2008/10/28 15:21:49 naddy Exp $
d16 4
a19 3
# GPLv2 except iaxy.bin (freely redistributable, see LICENSE)
# "Specific permission is also granted to link Asterisk with OpenSSL
# and OpenH323 and distribute the resulting binary files."
@


1.46
log
@Change "${SYSCONFDIR}" to "/etc" for files that are *always* in the
latter location.
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.45 2008/10/07 09:57:52 sthen Exp $
d6 1
a6 1
V=			1.4.22
d8 1
a8 1
FULLPKGNAME-main=	asterisk-$Vp0
@


1.45
log
@maintenance update to 1.4.22; many fixes.
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.44 2008/07/23 08:57:10 sthen Exp $
d8 1
a8 1
FULLPKGNAME-main=	asterisk-$V
@


1.44
log
@SECURITY update fixing several problems in IAX, both remotely
exploitable without authentication.

AST-2008-010: Asterisk IAX 'POKE' resource exhaustion (DoS)
AST-2008-011: Traffic amplification in IAX2, 40->1040 bytes
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.43 2008/06/30 20:03:49 sthen Exp $
d6 1
a6 1
V=			1.4.21.2
d208 2
a209 1
	${INSTALL_DATA} ${WRKSRC}/doc/* ${PREFIX}/share/doc/asterisk
@


1.43
log
@- bugfix update to 1.4.21.1, fixing a fairly major problem
introduced in 1.4.21 by correcting the order of lock and unlock
in a deadlock avoidance macro... No other changes. Not security,
but if you're running 1.4.21, you definitely want this.

- regen PLIST to remove @@bin from a symlink.
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.42 2008/06/14 16:00:10 sthen Exp $
d6 1
a6 1
V=			1.4.21.1
@


1.42
log
@Update Asterisk to 1.4.21, lots of quality-control fixes
ok ian
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.41 2008/06/02 23:33:51 sthen Exp $
d6 1
a6 1
V=			1.4.21
@


1.41
log
@- speex needs to be at least 1.2beta3 since the library was
split in two: add pkgspec, bump -speex package version

- adjust FULLPKGNAME handling so overrides can be shown clearly
at the top of the Makefile

- add space before assignment operator "FULLPKGNAME$i=" to avoid
potential ambiguity with bad values of $i

speex problem reported by jolan@@, thanks!
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.40 2008/05/27 22:14:34 sthen Exp $
d6 1
a6 1
V=			1.4.20.1
a8 1
FULLPKGNAME-speex=	asterisk-speex-$Vp0
@


1.40
log
@update to 1.4.20.1; thanks to Pedro la Peu for additional testing.
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.39 2008/05/27 20:56:12 sthen Exp $
d9 1
d111 2
a112 2
LIB_DEPENDS-speex=	speex.>=6::audio/speex \
			speexdsp::audio/speex
d190 2
a191 2
FULLPKGNAME$i=		asterisk$i-$V
RUN_DEPENDS$i=		:asterisk-$V:telephony/asterisk
@


1.39
log
@clean whitespace (spaces->tabs); "cvs di -w" shows no change
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.38 2008/05/22 19:29:50 ajacoutot Exp $
d6 1
a6 1
V=			1.4.19.2
d94 1
a94 1
WANTLIB-snmp=		c crypto kvm m perl util wrap
d110 4
a113 2
LIB_DEPENDS-speex=	speex.>=6::audio/speex
CONFIGURE_ARGS+=	--with-speex=${LOCALBASE}
@


1.38
log
@- fix WANTLIB after pwlib FLAVORs merge
- bump
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.37 2008/05/13 23:49:57 sthen Exp $
d75 1
a75 1
PSEUDO_FLAVORS+=        no_odbc
d77 1
a77 1
CONFIGURE_ARGS+=        --with-odbc=no \
d80 1
a80 1
MULTI_PACKAGES+=        -odbc
d88 1
a88 1
PSEUDO_FLAVORS+=        no_snmp
d90 1
a90 1
CONFIGURE_ARGS+=        --with-snmp=no
d92 1
a92 1
MULTI_PACKAGES+=        -snmp
d103 1
a103 1
PSEUDO_FLAVORS+=        no_speex
d105 1
a105 1
CONFIGURE_ARGS+=        --with-speex=no
d107 1
a107 1
MULTI_PACKAGES+=        -speex
d111 1
a111 1
CONFIGURE_ARGS+=        --with-speex=${LOCALBASE}
d115 1
a115 1
PSEUDO_FLAVORS+=        no_ogg
d117 1
a117 1
CONFIGURE_ARGS+=        --with-ogg=no \
d120 1
a120 1
MULTI_PACKAGES+=        -ogg
d126 1
a126 1
CONFIGURE_ARGS+=        --with-ogg=${LOCALBASE} \
d131 1
a131 1
PSEUDO_FLAVORS+=        no_curl
d133 1
a133 1
CONFIGURE_ARGS+=        --with-curl=no
d135 1
a135 1
MULTI_PACKAGES+=        -curl
d143 1
a143 1
PSEUDO_FLAVORS+=        no_pgsql
d145 1
a145 1
CONFIGURE_ARGS+=        --with-postgres=no
d147 1
a147 1
MULTI_PACKAGES+=        -pgsql
d155 1
a155 1
PSEUDO_FLAVORS+=        no_jabber
d157 1
a157 1
CONFIGURE_ARGS+=        --with-gnutls=no \
d160 1
a160 1
MULTI_PACKAGES+=        -jabber
d164 1
a164 1
CONFIGURE_ARGS+=        --with-gnutls=${LOCALBASE} \
@


1.37
log
@Update to 1.4.19.2, fixing an IAX performance problem introduced
by the security fix in the previous update. No change to other code.
Non-IAX users are unaffected.
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.36 2008/04/23 07:04:09 sthen Exp $
d174 2
a175 2
WANTLIB-main+=		expat ossaudio avutil
FULLPKGNAME-main=	asterisk-$V-h323
@


1.36
log
@SECURITY update, fixes remote amplification attack in IAX.
http://downloads.digium.com/pub/security/AST-2008-006.html

ok ian@@
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.35 2008/04/02 23:18:11 sthen Exp $
d6 1
a6 1
V=			1.4.19.1
@


1.35
log
@update to 1.4.19
ok ian@@
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.34 2008/03/19 08:18:10 sthen Exp $
d6 1
a6 1
V=			1.4.19
@


1.34
log
@SECURITY update to 1.4.18.1, fixes AST-2008-002 (buffer overflows
in RTP codec payload type handling) and AST-2008-003 (SIP channel
can make a call into the context specified in the general section
of sip.conf).  Affects all Asterisk users with SIP enabled.

This is a security update only, no changes other than these fixes.
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.33 2008/03/15 17:41:12 ajacoutot Exp $
d6 1
a6 1
V=			1.4.18.1
d8 1
a8 1
FULLPKGNAME-main=	${DISTNAME}
d175 1
a175 1
FULLPKGNAME-main=	${DISTNAME}p0-h323
@


1.33
log
@- make the h323 FLAVOR build correctly with new pwlib/h323
- add a pre-build target so that we can remove IS_INTERACTIVE
(from sthen@@)

ok sthen@@
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.32 2008/02/07 22:08:30 sthen Exp $
d6 1
a6 1
V=			1.4.18
d30 1
a30 2
MASTER_SITES=		http://downloads.digium.com/pub/telephony/asterisk/ \
			http://downloads.digium.com/pub/telephony/asterisk/old-releases/
@


1.32
log
@update asterisk to 1.4.18 (following testing during RC period)
ok jolan
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.31 2008/01/03 02:23:30 sthen Exp $
d17 2
a170 2
IS_INTERACTIVE=		Yes
# must restart build by hand.
d176 6
a181 1
FULLPKGNAME-main=	${DISTNAME}-h323
@


1.31
log
@SECURITY update, AST-2008-001, fixes remote crash triggerable by anyone
permitted to transfer SIP calls (possibly unauthenticated, depending on
config).

ok ian
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.30 2007/12/21 10:22:19 sthen Exp $
d6 1
a6 1
V=			1.4.17
@


1.30
log
@update to the asterisk release-du-jour.

ok ian's asterisk-ok-bot
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.29 2007/12/20 13:57:22 sthen Exp $
d6 1
a6 1
V=			1.4.16.2
@


1.29
log
@Update to today's asterisk release. ok ian
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.28 2007/12/19 21:07:27 sthen Exp $
d6 1
a6 1
V=			1.4.16.1
@


1.28
log
@SECURITY update to 1.4.17, fixes AST-2007-027 (passwordless sip/iax peers,
configured from "realtime" database rather than static .conf files, are not
subject to IP address restrictions).

ok ian
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.27 2007/12/01 10:11:53 sthen Exp $
d6 1
a6 1
V=			1.4.16
@


1.27
log
@SECURITY update to Asterisk 1.4.15, fixes SQL problems with
PostgreSQL drivers. AST-2007-025 (pgsql realtime) and AST-2007-026
(pgsql CDR logging).

ok jolan@@
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.26 2007/11/27 10:41:04 sthen Exp $
d6 1
a6 1
V=			1.4.15
@


1.26
log
@update Asterisk to 1.4.14 (with many bug fixes), and h323 flavor
(for interactive builds only).

ok jolan, ian
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.25 2007/10/11 08:05:18 sthen Exp $
d6 1
a6 1
V=			1.4.14
@


1.25
log
@SECURITY update for 1.4 versions (doesn't affect OpenBSD before 4.2);
fixes an overflow in IMAP voicemail storage reachable by anyone who can
send email to a VM box accessed from the phone. AST-2007-022, found by
sprintf audit.

ok ian@@
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.24 2007/10/04 11:25:44 sthen Exp $
d6 1
a6 1
V=			1.4.13
d63 1
a63 3
			--with-imap=no \
			--with-pwlib=no \
			--with-h323=no
d71 1
d165 15
@


1.24
log
@bug-fix update to 1.4.12

ok ian@@
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.23 2007/09/05 22:42:52 sthen Exp $
d6 2
a7 2
V=			1.4.12
DISTNAME=		asterisk-${V}
d28 2
a29 1
MASTER_SITES=		http://downloads.digium.com/pub/telephony/asterisk/
d169 2
a170 2
FULLPKGNAME${i}=	asterisk${i}-${V}
RUN_DEPENDS${i}=	:asterisk-${V}:telephony/asterisk
@


1.23
log
@major version update to 1.4.11, ok ian@@ jolan@@
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.22 2007/09/04 10:33:19 sthen Exp $
d6 1
a6 1
V=			1.4.11
@


1.22
log
@update my email address

ok mbalmer@@
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.21 2007/07/19 01:31:27 ian Exp $
d3 2
a4 5
COMMENT=	open source multi-protocol PBX and telephony toolkit
DISTNAME=	asterisk-1.2.22
PKGNAME=	${DISTNAME}p0
CATEGORIES=	telephony
MASTER_SITES=	http://ftp.digium.com/pub/asterisk/releases/
d6 3
a8 1
HOMEPAGE=	http://www.asterisk.org/
d10 1
a10 1
MAINTAINER=	Stuart Henderson <sthen@@openbsd.org>
d12 5
a16 3
# GPL except iaxy.bin (freely redistributable, see LICENSE)
PERMIT_DISTFILES_CDROM=	Yes
PERMIT_DISTFILES_FTP=	Yes
d19 156
a174 1
WANTLIB=		c crypto m ncurses pthread ssl z
d176 1
a176 1
MAKE_FLAGS=		CC="${CC} ${CFLAGS}"
d178 1
a178 2
NO_REGRESS=	Yes
USE_GMAKE=	Yes
d180 1
a180 1
MAKE_ENV+=	SYSCONFDIR='${SYSCONFDIR}' MAKEFLAGS+=-DWITHOUT_ZAPTEL
d184 12
a195 7
	${INSTALL_DATA_DIR} ${PREFIX}/share/examples/asterisk/default
	${INSTALL_DATA_DIR} ${PREFIX}/share/examples/asterisk/openbsd
	${INSTALL_DATA} ${WRKSRC}/{BUGS,SECURITY} ${PREFIX}/share/doc/asterisk
	${INSTALL_DATA} ${WRKSRC}/doc/README.* ${PREFIX}/share/doc/asterisk
	${INSTALL_DATA} ${WRKSRC}/doc/*.txt ${PREFIX}/share/doc/asterisk
	${INSTALL_DATA} ${WRKSRC}/configs/* ${PREFIX}/share/examples/asterisk/default
	${INSTALL_DATA} ${FILESDIR}/*.sample ${PREFIX}/share/examples/asterisk/openbsd
@


1.21
log
@Upgrade to 1.2.22 to fix several remote exploits, from Stuart, tested by me
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.20 2007/07/02 14:03:34 jolan Exp $
d5 1
d11 1
a11 1
MAINTAINER=	Stuart Henderson <stu@@spacehopper.org>
@


1.20
log
@SECURITY: update to 1.2.19, from maintainer stuart henderson

ASA-2007-013: chan_iax2.c assumes strings are null-terminated without
validating them, potential buffer overrun/information disclosure
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.19 2007/05/02 17:29:25 jolan Exp $
d3 2
a4 2
COMMENT=	"open source multi-protocol PBX and telephony toolkit"
DISTNAME=	asterisk-1.2.19
@


1.19
log
@SECURITY: update to 1.2.18 from maintainer stuart henderson

ASA-2007-011: Multiple problems in SIP channel parser handling response
codes
ASA-2007-012: Remote Crash Vulnerability in Manager Interface
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.18 2007/03/21 15:51:54 jolan Exp $
d4 1
a4 1
DISTNAME=	asterisk-1.2.18
@


1.18
log
@SECURITY: update to 1.2.17, fixes a(nother) remote DoS in chan_sip:

http://voipsa.org/pipermail/voipsec_voipsa.org/2007-March/002275.html

from maintainer stuart henderson
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.17 2007/03/15 10:56:31 jolan Exp $
d4 1
a4 1
DISTNAME=	asterisk-1.2.17
a27 1
	${INSTALL_DATA_DIR} ${PREFIX}/share/examples/asterisk/agi
a32 2
	${INSTALL_DATA} ${WRKSRC}/agi/agi-test.agi \
		${PREFIX}/share/examples/asterisk/agi
@


1.17
log
@SECURITY: update to 1.2.16 which fixes a remote DoS in chan_sip

from maintainer stuart henderson
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.16 2007/02/11 01:03:28 ian Exp $
d4 1
a4 1
DISTNAME=	asterisk-1.2.16
@


1.16
log
@1.2.14->1.2.15 from maintainer, tested on i386 & amd64.
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.15 2006/12/29 22:21:41 steven Exp $
d4 1
a4 2
DISTNAME=	asterisk-1.2.15
PKGNAME=	${DISTNAME}
@


1.16.2.1
log
@MFC:
SECURITY: update to 1.2.16 which fixes a remote DoS in chan_sip
---
SECURITY: update to 1.2.17, fixes a(nother) remote DoS in chan_sip:

http://voipsa.org/pipermail/voipsec_voipsa.org/2007-March/002275.html
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.16 2007/02/11 01:03:28 ian Exp $
d4 2
a5 1
DISTNAME=	asterisk-1.2.17
@


1.16.2.2
log
@MFC:
SECURITY: update to 1.2.18 from maintainer stuart henderson

ASA-2007-011: Multiple problems in SIP channel parser handling response
codes
ASA-2007-012: Remote Crash Vulnerability in Manager Interface
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.16.2.1 2007/05/01 16:16:42 sturm Exp $
d4 1
a4 1
DISTNAME=	asterisk-1.2.18
d28 1
d34 2
@


1.16.2.3
log
@MFC:
SECURITY: update to 1.2.19, from maintainer stuart henderson

ASA-2007-013: chan_iax2.c assumes strings are null-terminated without
validating them, potential buffer overrun/information disclosure
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.16.2.2 2007/05/05 08:23:27 sturm Exp $
d4 1
a4 1
DISTNAME=	asterisk-1.2.19
@


1.16.2.4
log
@MFC (original commit naddy@@):
- upgrade to 1.2.22 to fix several remote exploits

ok sturm@@
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.16.2.3 2007/07/06 13:52:18 sturm Exp $
d4 1
a4 1
DISTNAME=	asterisk-1.2.22
@


1.15
log
@conflicts with asterisk-sounds-<=1.2.1p2
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.14 2006/12/22 22:16:10 jolan Exp $
d3 3
a5 3
COMMENT=	"open source PBX"
DISTNAME=	asterisk-1.2.14
PKGNAME=	${DISTNAME}p0
@


1.14
log
@update to 1.2.14, from stuart henderson
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.13 2006/10/19 21:19:07 jolan Exp $
d5 1
@


1.13
log
@SECURITY: update to 1.2.13 which fixes a vulnerability in the
chan_skinny module.  for more details see:

http://www.asterisk.org/node/109

from maintainer
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.12 2006/10/18 00:18:36 jolan Exp $
d4 1
a4 1
DISTNAME=	asterisk-1.2.13
@


1.12
log
@- install IAXy firmware in order to silence warning messages, prompted
  by jcs@@

ok MAINTAINER
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.11 2006/09/24 21:09:25 jolan Exp $
d4 1
a4 2
DISTNAME=	asterisk-1.2.12.1
PKGNAME=	${DISTNAME}p0
d12 1
a12 1
# GPL
@


1.11
log
@- update to 1.2.12.1
- be careful not to pick up odbc/popt if they happened to be installed

from maintainer stuart henderson
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.10 2006/06/15 06:39:50 steven Exp $
d5 1
@


1.10
log
@fix sample config file.

from maintainer Stuart Henderson, found by Steve, murdoch-technology
at bigpond dot com.
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.9 2006/06/12 19:04:10 naddy Exp $
d4 1
a4 2
DISTNAME=	asterisk-1.2.9.1
PKGNAME=	${DISTNAME}p0
d6 1
a6 1
MASTER_SITES=	ftp://ftp.digium.com/pub/asterisk/
@


1.10.2.1
log
@sync patches and fix a vulnerability in the chan_skinny module
for more details see: http://www.asterisk.org/node/109
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.10 2006/06/15 06:39:50 steven Exp $
d5 1
a5 1
PKGNAME=	${DISTNAME}p1
d7 1
a7 1
MASTER_SITES=	http://ftp.digium.com/pub/asterisk/releases/
@


1.10.2.2
log
@security fix for a remote DoS in chan_sip

from maintainer Stuart Henderson
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.10.2.1 2006/11/01 13:45:31 sturm Exp $
d5 1
a5 1
PKGNAME=	${DISTNAME}p2
@


1.10.2.3
log
@SECURITY: fixes a(nother) remote DoS in chan_sip:

http://voipsa.org/pipermail/voipsec_voipsa.org/2007-March/002275.html

from maintainer stuart henderson
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.10.2.2 2007/03/19 21:12:42 sturm Exp $
d5 1
a5 1
PKGNAME=	${DISTNAME}p3
@


1.10.2.4
log
@Security fixes:
ASA-2007-011, http://bugs.digium.com/view.php?id=9313:
Multiple problems in SIP channel parser handling response codes

ASA-2007-012:
Remote Crash Vulnerability in Manager Interface
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.10.2.3 2007/03/23 07:26:47 sturm Exp $
d5 1
a5 1
PKGNAME=	${DISTNAME}p4
@


1.10.2.5
log
@backport a fix for ASA-2007-013:
chan_iax2.c assumes strings are null-terminated without validating them,
potential buffer overrun/information disclosure
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.10.2.4 2007/05/05 08:22:00 sturm Exp $
d5 1
a5 1
PKGNAME=	${DISTNAME}p5
@


1.10.2.6
log
@- backport some security fixes for
ASA-2007-014 - Stack Buffer Overflow in IAX2 channel driver
ASA-2007-015 - Remote Crash Vulnerability in IAX2 Channel Driver
ASA-2007-016 - Remote Crash Vulnerability in Skinny channel driver from version 1.2.22

All work and testing by Stuart Henderson

ok sturm@@
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.10.2.5 2007/07/06 13:53:36 sturm Exp $
d5 1
a5 1
PKGNAME=	${DISTNAME}p6
@


1.9
log
@SECURITY:
Update to 1.2.9.1 which addresses a security vulnerability in the IAX2
channel driver (chan_iax2). The vulnerability affects all users with
IAX2 clients that might be compromised or used by a malicious user, and
can lead to denial of service attacks and random Asterisk server crashes
via a relatively trivial exploit.

From: maintainer Stuart Henderson <stu@@spacehopper.org>
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.8 2006/02/15 06:11:39 sturm Exp $
d5 1
@


1.8
log
@use bcopy instead of memcpy to work around a gcc optimizer bug resulting
in unaligned accesses on sparc64
fix WANTLIB
honour CC, CFLAGS more or less

from Stuart Henderson <stu at spacehopper.org>
ok ian, jolan
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.7 2006/02/02 16:12:24 jolan Exp $
d4 1
a4 2
DISTNAME=	asterisk-1.2.4
PKGNAME=	${DISTNAME}p0
a30 1
	${INSTALL_DATA} ${FILESDIR}/BUGS.OpenBSD ${PREFIX}/share/doc/asterisk
@


1.8.2.1
log
@MFC:
SECURITY:
Update to 1.2.9.1 which addresses a security vulnerability in the IAX2
channel driver (chan_iax2). The vulnerability affects all users with
IAX2 clients that might be compromised or used by a malicious user, and
can lead to denial of service attacks and random Asterisk server crashes
via a relatively trivial exploit.
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.8 2006/02/15 06:11:39 sturm Exp $
d4 2
a5 1
DISTNAME=	asterisk-1.2.9.1
d32 1
@


1.8.2.2
log
@SECURITY: fix a vulnerability in the chan_skinny module.
for more details see:

http://www.asterisk.org/node/109
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.8.2.1 2006/06/15 15:34:35 sturm Exp $
a4 1
PKGNAME=	${DISTNAME}p1
d6 1
a6 1
MASTER_SITES=	http://ftp.digium.com/pub/asterisk/releases/
@


1.8.2.3
log
@security fix for a remote DoS in chan_sip

from maintainer Stuart Henderson
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.8.2.2 2006/10/20 13:54:44 sturm Exp $
d5 1
a5 1
PKGNAME=	${DISTNAME}p2
@


1.8.2.4
log
@SECURITY: fixes a(nother) remote DoS in chan_sip:

http://voipsa.org/pipermail/voipsec_voipsa.org/2007-March/002275.html

from maintainer stuart henderson
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.8.2.3 2007/03/19 21:41:35 sturm Exp $
d5 1
a5 1
PKGNAME=	${DISTNAME}p3
@


1.7
log
@bison is no longer a BUILD_DEPENDS
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.6 2006/02/02 03:41:36 todd Exp $
d5 1
d18 3
a20 1
WANTLIB=		c crypto m ncurses ossaudio pthread ssl
@


1.6
log
@Work by and tested by ian@@ and Stuart Henderson, comments by jolan@@
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.5 2005/08/15 17:36:06 jolan Exp $
a20 2

BUILD_DEPENDS=	:bison-*:devel/bison
@


1.5
log
@update to 1.0.9, ok jcs pval

most notably fixes an overflow in the management interface (which is not
enabled by default)
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.4 2005/05/09 16:50:05 jcs Exp $
d4 1
a4 1
DISTNAME=	asterisk-1.0.9
d6 1
a6 2
MASTER_SITES=	http://www.asterisk.org/html/downloads/ \
		ftp://ftp.asterisk.org/pub/telephony/asterisk/
d10 2
d24 1
a24 1
MAKE_ENV+=	SYSCONFDIR='${SYSCONFDIR}'
@


1.5.2.1
log
@MFC:
SECURITY:
Update to 1.0.11.1 which addresses a security vulnerability in the IAX2
channel driver (chan_iax2). The vulnerability affects all users with
IAX2 clients that might be compromised or used by a malicious user, and
can lead to denial of service attacks and random Asterisk server crashes
via a relatively trivial exploit.
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.5 2005/08/15 17:36:06 jolan Exp $
d4 1
a4 1
DISTNAME=	asterisk-1.0.11.1
d6 2
a7 1
MASTER_SITES=	http://ftp.digium.com/pub/telephony/asterisk/releases/
@


1.5.2.2
log
@SECURITY: update to 1.0.12 which fixes a vulnerability in the
chan_skinny module.  for more details see:

http://www.asterisk.org/node/109
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.5.2.1 2006/06/15 15:35:23 sturm Exp $
d4 1
a4 1
DISTNAME=	asterisk-1.0.12
@


1.4
log
@- drop to _asterisk user/group by default
- move some files around and change file/directory owners to support
  this
- bump pkgname

ok mr. jolan@@
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.3 2005/05/01 02:12:46 jcs Exp $
d4 1
a4 2
DISTNAME=	asterisk-1.0.7
PKGNAME=	${DISTNAME}p0
d6 2
a7 2
MASTER_SITES=	ftp://ftp.asterisk.org/pub/telephony/asterisk/ \
		http://mirrors.protection.cx/~jolan/
a10 2
MAINTAINER=	Jolan Luff <jolan@@openbsd.org>

a21 2
RUN_DEPENDS=	:mpg123-*:audio/mpg123 \
		:sox-*:audio/sox
@


1.3
log
@update to asterisk-1.0.7
- put jolan's mirror second
- RUN_DEPENDS on sox and mpg123 for music on hold
- install example indications.conf so ringing works

ok jolan@@
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.2 2004/12/05 15:15:20 alek Exp $
d5 1
@


1.2
log
@Add WANTLIB marker

ok espie@@
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.1.1.1 2004/09/26 00:38:23 jolan Exp $
d4 1
a4 1
DISTNAME=	asterisk-1.0.0
d6 2
a7 2
MASTER_SITES=	http://mirrors.protection.cx/~jolan/ \
		ftp://ftp.asterisk.org/pub/telephony/asterisk/
d24 2
@


1.1
log
@Initial revision
@
text
@d1 1
a1 1
# $OpenBSD$
d18 1
@


1.1.1.1
log
@asterisk-1.0.0, open source pbx
@
text
@@
