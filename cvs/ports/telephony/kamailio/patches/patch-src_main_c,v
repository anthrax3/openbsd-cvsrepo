head	1.2;
access;
symbols
	OPENBSD_6_2:1.2.0.2
	OPENBSD_6_2_BASE:1.2;
locks; strict;
comment	@# @;


1.2
date	2017.09.21.09.34.32;	author sthen;	state Exp;
branches;
next	1.1;
commitid	4zHkBJG59PPIdO4g;

1.1
date	2017.07.03.22.14.20;	author sthen;	state Exp;
branches;
next	;
commitid	3YCFei450KKbueMF;


desc
@@


1.2
log
@update to kamailio-5.0.3 and fix loading modules linked with srdb1, srdb2,
trie, srutils on clang arches, from Roman Kravchuk (maintainer)
@
text
@$OpenBSD: patch-src_main_c,v 1.1 2017/07/03 22:14:20 sthen Exp $
Index: src/main.c
--- src/main.c.orig
+++ src/main.c
@@@@ -1842,8 +1842,10 @@@@ int main(int argc, char** argv)
 	int proto;
 	char *options;
 	int ret;
+#ifndef HAVE_ARC4RANDOM
 	unsigned int seed;
 	int rfd;
+#endif
 	int debug_save, debug_flag;
 	int dont_fork_cnt;
 	struct name_lst* n_lst;
@@@@ -2109,6 +2111,7 @@@@ int main(int argc, char** argv)
 		goto error;
 	}
 
+#ifndef HAVE_ARC4RANDOM
 	/* seed the prng */
 	/* try to use /dev/urandom if possible */
 	seed=0;
@@@@ -2129,6 +2132,7 @@@@ try_again:
 	fastrand_seed(kam_rand());
 	srandom(kam_rand()+time(0));
 	LM_DBG("test random numbers %u %lu %u\n", kam_rand(), random(), fastrand());
+#endif
 
 	/*register builtin  modules*/
 	register_builtin_modules();
@


1.1
log
@update to Kamailio 5.0.2, from maintainer Roman Kravchuk,
plus minor wantlib cleanup by me
@
text
@d1 1
a1 1
$OpenBSD$
d5 1
a5 1
@@@@ -1845,8 +1845,10 @@@@ int main(int argc, char** argv)
d16 1
a16 1
@@@@ -2112,6 +2114,7 @@@@ int main(int argc, char** argv)
d24 1
a24 1
@@@@ -2132,6 +2135,7 @@@@ try_again:
@

