head	1.7;
access;
symbols
	OPENBSD_5_0:1.5.0.4
	OPENBSD_5_0_BASE:1.5
	OPENBSD_4_9:1.5.0.2
	OPENBSD_4_9_BASE:1.5
	OPENBSD_4_8:1.4.0.4
	OPENBSD_4_8_BASE:1.4
	OPENBSD_4_7:1.4.0.2
	OPENBSD_4_7_BASE:1.4
	OPENBSD_4_6:1.3.0.12
	OPENBSD_4_6_BASE:1.3
	OPENBSD_4_5:1.3.0.10
	OPENBSD_4_5_BASE:1.3
	OPENBSD_4_4:1.3.0.8
	OPENBSD_4_4_BASE:1.3
	OPENBSD_4_3:1.3.0.6
	OPENBSD_4_3_BASE:1.3
	OPENBSD_4_2:1.3.0.4
	OPENBSD_4_2_BASE:1.3
	OPENBSD_4_1:1.3.0.2
	OPENBSD_4_1_BASE:1.3
	OPENBSD_4_0:1.2.0.10
	OPENBSD_4_0_BASE:1.2
	OPENBSD_3_9:1.2.0.8
	OPENBSD_3_9_BASE:1.2
	OPENBSD_3_8:1.2.0.6
	OPENBSD_3_8_BASE:1.2
	OPENBSD_3_7:1.2.0.4
	OPENBSD_3_7_BASE:1.2
	OPENBSD_3_6:1.2.0.2
	OPENBSD_3_6_BASE:1.2;
locks; strict;
comment	@# @;


1.7
date	2011.11.27.13.29.35;	author jasper;	state dead;
branches;
next	1.6;

1.6
date	2011.08.31.11.24.19;	author jasper;	state Exp;
branches;
next	1.5;

1.5
date	2010.09.03.12.58.14;	author giovanni;	state Exp;
branches;
next	1.4;

1.4
date	2009.10.22.08.44.44;	author jasper;	state Exp;
branches;
next	1.3;

1.3
date	2007.01.17.19.44.19;	author jasper;	state Exp;
branches;
next	1.2;

1.2
date	2004.04.11.17.03.56;	author xsa;	state Exp;
branches;
next	1.1;

1.1
date	2004.04.11.16.43.48;	author naddy;	state Exp;
branches;
next	;


desc
@@


1.7
log
@move to bin/ and ajust CPANTEST path

ok espie@@
@
text
@#!/usr/bin/perl
# $OpenBSD: outdated-perl-ports,v 1.6 2011/08/31 11:24:19 jasper Exp $
#
# Copyright (c) 2003 Sam Smith <S@@mSmith.net>
#
# Permission to use, copy, modify, and distribute this software for any
# purpose with or without fee is hereby granted, provided that the above
# copyright notice and this permission notice appear in all copies.
#
# THE SOFTWARE IS PROVIDED "AS IS" AND THE AUTHOR DISCLAIMS ALL WARRANTIES
# WITH REGARD TO THIS SOFTWARE INCLUDING ALL IMPLIED WARRANTIES OF
# MERCHANTABILITY AND FITNESS. IN NO EVENT SHALL THE AUTHOR BE LIABLE FOR
# ANY SPECIAL, DIRECT, INDIRECT, OR CONSEQUENTIAL DAMAGES OR ANY DAMAGES
# WHATSOEVER RESULTING FROM LOSS OF USE, DATA OR PROFITS, WHETHER IN AN
# ACTION OF CONTRACT, NEGLIGENCE OR OTHER TORTIOUS ACTION, ARISING OUT OF
# OR IN CONNECTION WITH THE USE OR PERFORMANCE OF THIS SOFTWARE.

use strict;
use warnings;
use Getopt::Std;

# -d: show path to port (relative to $PORTSDIR)
# -m <maintainer>: search for a maintainer (name or address)
our ($opt_d, $opt_m);
getopts('dm:');

# packages list. Change to a different mirror if you want.
my $CPAN_packages_details="http://mirror.sov.uk.goscomb.net/CPAN/modules/02packages.details.txt.gz";

my $PORTSDIR= $ENV{PORTSDIR} || "/usr/ports"; # location of ports directory
my %Modules; # What CPAN thinks is up to date
my $line; # lines we process
my @@line; # $line run through split
my @@dir; # pkg subdir

{
	open(MODULES, "ftp -V -o - $CPAN_packages_details 2>/dev/null | gzip -cd |") 
		|| die "can't open $CPAN_packages_details: $!";
	while (<MODULES>) {
		next if (1 .. /^\s*$/); # ignore gunk before first blank line

		#example match: /Class-Autouse-0.8.tar.gz
		m#/([\w\-]+)\-([\d\.]+)(?:\_\w+\d+)?\.tar\.gz$#;

		if (defined $ENV{DEBUG}){print STDERR "$_" unless $2;}
		next unless ($2); # some things don't follow conventions

		unless ((defined $Modules{$1}) and $Modules{$1} ge $2) {
			$Modules{$1}=$2 ;
			#print STDERR "$1 maps to $2\n";
		}
	}

	open (PORTS, "< ${PORTSDIR}/INDEX") || die "can't open ${PORTSDIR}/INDEX: $!";
	while ($line=<PORTS>) {
		@@line= split /\|/, $line;
		next unless ($line =~ /^(p5\-(.+?)\-([\d\.]+)(?:p\d)?)\|/);
		# $1 has full package name in
		# $2 is the name of the perl module (the stem minus the p5- prefix)
		# $3 is the version number

		if (defined $ENV{DEBUG}){print STDERR "$1\t$2\t$3\n";}

		if ((defined $Modules{$2}) and ($Modules{$2} gt $3)) {
			if ($opt_m) {
				next unless ($line[5] =~ m/$opt_m/);
			}
			if ($opt_d) {
				@@dir = split /\//, $line[4];
				print STDOUT "Out of date: $dir[0]/$1 vs $Modules{$2}. $line[5]\n";
			} else {
				print STDOUT "Out of date: $1 vs $Modules{$2}. $line[5]\n";
			}
		}
	}	
	
}
@


1.6
log
@  add -m to search for maintainer, instead of using grepmagic.
    ok landry@@
@
text
@d2 1
a2 1
# $OpenBSD: outdated-perl-ports,v 1.5 2010/09/03 12:58:14 giovanni Exp $
@


1.5
log
@
Switch to an http mirror
ok sthen@@
@
text
@d2 1
a2 1
# $OpenBSD: outdated-perl-ports,v 1.4 2009/10/22 08:44:44 jasper Exp $
d23 3
a25 2
our $opt_d;
getopts('d');
d65 3
@


1.4
log
@- add a -d flag to show the directory in which the outdated port resides

original diff by giovanni@@, reworked by me to not alter default output
ok giovanni@@ sthen@@
@
text
@d2 1
a2 1
# $OpenBSD: outdated-perl-ports,v 1.3 2007/01/17 19:44:19 jasper Exp $
d27 1
a27 1
my $CPAN_packages_details="ftp://ftp.funet.fi/pub/languages/perl/CPAN/modules/02packages.details.txt.gz";
@


1.3
log
@zap trailing whitespace in the output
@
text
@d2 1
a2 1
# $OpenBSD: outdated-perl-ports,v 1.2 2004/04/11 17:03:56 xsa Exp $
d20 5
d33 1
d64 6
a69 1
			print STDOUT "Out of date: $1 vs $Modules{$2}. $line[5]\n";
@


1.2
log
@
- add $OpenBSD$ Id string
- minor cosmetics
@
text
@d2 1
a2 1
# $OpenBSD$
d58 1
a58 1
			print STDOUT "Out of date: $1 vs $Modules{$2}. $line[5] \n";
@


1.1
log
@Script to check for availability of newer upstream releases for perl ports.
From: Sam Smith <S@@mSmith.net>
@
text
@d2 15
a16 19

my $CPAN_packages_details="ftp://ftp.funet.fi/pub/languages/perl/CPAN/modules/02packages.details.txt.gz";  
	# packages list. Change to a different mirror if you want.

#/*
# * Copyright (c) 2003 Sam Smith <S@@mSmith.net>
# *
# * Permission to use, copy, modify, and distribute this software for any
# * purpose with or without fee is hereby granted, provided that the above
# * copyright notice and this permission notice appear in all copies.
# *
# * THE SOFTWARE IS PROVIDED "AS IS" AND THE AUTHOR DISCLAIMS ALL WARRANTIES
# * WITH REGARD TO THIS SOFTWARE INCLUDING ALL IMPLIED WARRANTIES OF
# * MERCHANTABILITY AND FITNESS. IN NO EVENT SHALL THE AUTHOR BE LIABLE FOR
# * ANY SPECIAL, DIRECT, INDIRECT, OR CONSEQUENTIAL DAMAGES OR ANY DAMAGES
# * WHATSOEVER RESULTING FROM LOSS OF USE, DATA OR PROFITS, WHETHER IN AN
# * ACTION OF CONTRACT, NEGLIGENCE OR OTHER TORTIOUS ACTION, ARISING OUT OF
# * OR IN CONNECTION WITH THE USE OR PERFORMANCE OF THIS SOFTWARE.
# */
d21 2
@

