head	1.9;
access;
symbols
	OPENBSD_6_0:1.9.0.2
	OPENBSD_6_0_BASE:1.9
	OPENBSD_5_9:1.8.0.12
	OPENBSD_5_9_BASE:1.8
	OPENBSD_5_8:1.8.0.14
	OPENBSD_5_8_BASE:1.8
	OPENBSD_5_7:1.8.0.10
	OPENBSD_5_7_BASE:1.8
	OPENBSD_5_6:1.8.0.8
	OPENBSD_5_6_BASE:1.8
	OPENBSD_5_5:1.8.0.6
	OPENBSD_5_5_BASE:1.8
	OPENBSD_5_4:1.8.0.4
	OPENBSD_5_4_BASE:1.8
	OPENBSD_5_3:1.8.0.2
	OPENBSD_5_3_BASE:1.8
	OPENBSD_5_2:1.6.0.4
	OPENBSD_5_2_BASE:1.6
	OPENBSD_5_1_BASE:1.6
	OPENBSD_5_1:1.6.0.2
	OPENBSD_5_0:1.5.0.14
	OPENBSD_5_0_BASE:1.5
	OPENBSD_4_9:1.5.0.12
	OPENBSD_4_9_BASE:1.5
	OPENBSD_4_8:1.5.0.10
	OPENBSD_4_8_BASE:1.5
	OPENBSD_4_7:1.5.0.8
	OPENBSD_4_7_BASE:1.5
	OPENBSD_4_6:1.5.0.6
	OPENBSD_4_6_BASE:1.5
	OPENBSD_4_5:1.5.0.4
	OPENBSD_4_5_BASE:1.5
	OPENBSD_4_4:1.5.0.2
	OPENBSD_4_4_BASE:1.5
	OPENBSD_4_3:1.3.0.20
	OPENBSD_4_3_BASE:1.3
	OPENBSD_4_2:1.3.0.18
	OPENBSD_4_2_BASE:1.3
	OPENBSD_4_1:1.3.0.16
	OPENBSD_4_1_BASE:1.3
	OPENBSD_4_0:1.3.0.14
	OPENBSD_4_0_BASE:1.3
	OPENBSD_3_9:1.3.0.12
	OPENBSD_3_9_BASE:1.3
	OPENBSD_3_8:1.3.0.10
	OPENBSD_3_8_BASE:1.3
	OPENBSD_3_7:1.3.0.8
	OPENBSD_3_7_BASE:1.3
	OPENBSD_3_6:1.3.0.6
	OPENBSD_3_6_BASE:1.3
	OPENBSD_3_5:1.3.0.4
	OPENBSD_3_5_BASE:1.3
	OPENBSD_3_4:1.3.0.2
	OPENBSD_3_4_BASE:1.3
	OPENBSD_3_3:1.2.0.4
	OPENBSD_3_3_BASE:1.2
	OPENBSD_3_2:1.2.0.2
	OPENBSD_3_2_BASE:1.2
	OPENBSD_3_1:1.1.0.4
	OPENBSD_3_1_BASE:1.1
	OPENBSD_3_0:1.1.0.2
	OPENBSD_3_0_BASE:1.1;
locks; strict;
comment	@# @;


1.9
date	2016.04.26.10.56.59;	author sthen;	state Exp;
branches;
next	1.8;
commitid	FbIvW5WdGqu5h4SS;

1.8
date	2012.11.19.12.19.30;	author espie;	state Exp;
branches;
next	1.7;

1.7
date	2012.09.23.08.03.55;	author matthieu;	state Exp;
branches;
next	1.6;

1.6
date	2011.10.23.22.06.01;	author matthieu;	state Exp;
branches;
next	1.5;

1.5
date	2008.05.11.19.50.55;	author espie;	state Exp;
branches;
next	1.4;

1.4
date	2008.05.11.12.05.51;	author espie;	state Exp;
branches;
next	1.3;

1.3
date	2003.07.28.17.17.05;	author sturm;	state Exp;
branches;
next	1.2;

1.2
date	2002.06.27.12.47.23;	author mpech;	state Exp;
branches;
next	1.1;

1.1
date	2001.08.25.11.23.46;	author espie;	state Exp;
branches;
next	;


desc
@@


1.9
log
@Clean up some bits missed in yesterday's systrace removal.
@
text
@#-*- mode: Fundamental; tab-width: 4; -*-
# ex:ts=4 sw=4 filetype=make:
# $OpenBSD: imake.port.mk,v 1.8 2012/11/19 12:19:30 espie Exp $
#	Based on bsd.port.mk, originally by Jordan K. Hubbard.
#	This file is in the public domain.

.if empty(CONFIGURE_STYLE:L:Mnoman)
INSTALL_TARGET +=	install.man
.endif

XMKMF ?=		xmkmf -a
XMKMF +=		-DPorts

.if !exists(${X11BASE})
IGNORE =	"uses imake, but ${X11BASE} not found"
.endif

MODIMAKE_DEPENDS = \
				 devel/imake \
				 devel/imake-cf

BUILD_DEPENDS += ${MODIMAKE_DEPENDS}

MODIMAKE_configure = \
		cd ${WRKSRC} && ${SETENV} ${MAKE_ENV} ${XMKMF};
@


1.8
log
@remove some old cruft
checked by naddy@@ for no incidence on current builds
@
text
@d3 1
a3 1
# $OpenBSD: imake.port.mk,v 1.7 2012/09/23 08:03:55 matthieu Exp $
d25 1
a25 1
		cd ${WRKSRC} && ${_SYSTRACE_CMD} ${SETENV} ${MAKE_ENV} ${XMKMF};
@


1.7
log
@Switch to imake from ports. ok landry@@.
@
text
@d3 1
a3 1
# $OpenBSD: imake.port.mk,v 1.6 2011/10/23 22:06:01 matthieu Exp $
a25 9

# Kludge
.if ${CONFIGURE_STYLE:Mimake}
MODIMAKE_pre-install = \
	${SUDO} mkdir -p ${LOCALBASE}/lib/X11; \
	if [ ! -e ${LOCALBASE}/lib/X11/app-defaults ]; then \
		${SUDO} ln -sf /etc/X11/app-defaults ${LOCALBASE}/lib/X11/app-defaults; \
	fi
.endif
@


1.6
log
@Modernize error message. Don't tell people to use a 11 years old
ports tree. ok naddy@@, espie@@.
@
text
@d3 1
a3 1
# $OpenBSD: imake.port.mk,v 1.5 2008/05/11 19:50:55 espie Exp $
d18 6
d25 2
a26 9
	if [ -e ${X11BASE}/lib/X11/config/ports.cf ] || \
		fgrep >/dev/null 2>/dev/null Ports \
			${X11BASE}/lib/X11/config/OpenBSD.cf; then \
		cd ${WRKSRC} && ${_SYSTRACE_CMD} ${SETENV} ${MAKE_ENV} ${XMKMF}; \
	else \
		echo >&2 "Error: your X installation is incomplete"; \
		echo >&2 "Please install the xshare tarball"; \
		exit 1; \
	fi
@


1.5
log
@stylistic changes
@
text
@d3 1
a3 1
# $OpenBSD: imake.port.mk,v 1.4 2008/05/11 12:05:51 espie Exp $
d24 2
a25 3
		echo >&2 "Error: your X installation is not recent enough"; \
		echo >&2 "Update to a more recent version, or use a ports tree"; \
		echo >&2 "that predates March 18, 2000"; \
@


1.4
log
@clean-up pre-install hook.
@
text
@d3 1
a3 1
# $OpenBSD: imake.port.mk,v 1.3 2003/07/28 17:17:05 sturm Exp $
d8 1
a8 1
INSTALL_TARGET+=	install.man
d11 2
a12 2
XMKMF?=			xmkmf -a
XMKMF+=			-DPorts
d15 1
a15 1
IGNORE="uses imake, but ${X11BASE} not found"
d18 1
a18 1
MODIMAKE_configure= \
d31 1
a31 1
MODIMAKE_pre-install= \
@


1.3
log
@this makes our build infrastructure systrace aware
original idea from jsyn@@, discussed and first tests at c2k3

Warning!
- this commit is different from all patches sent around, please remove
  them before updating
- due to a few bugs in systrace this is currently not ready for the casual
  porter and several ports will fail to build, you've been warned

The idea of this patch is to help a porter when developing a new port.
With systrace the configure, build and fake stages are not allowed to
open network connections or write outside some well defined directories.
This way misbehaving programs will be noticed due to logfile entries in
/var/log/messages and the port can be fixed. There is generally no need
for endusers to use this, as the checksum ensures that ports in the
future will behave the same as they did when porting. :)

To activate systrace'd port building, set USE_SYSTRACE=Yes (e.g. in
/etc/mk.conf)

tested by some people, ok espie@@
@
text
@d3 1
a3 1
# $OpenBSD: imake.port.mk,v 1.2 2002/06/27 12:47:23 mpech Exp $
d30 5
a34 5
.  if ${CONFIGURE_STYLE:Mimake}
MODIMAKE_pre_install= \
	${SUDO} mkdir -p /usr/local/lib/X11; \
	if [ ! -e /usr/local/lib/X11/app-defaults ]; then \
		${SUDO} ln -sf /etc/X11/app-defaults /usr/local/lib/X11/app-defaults; \
d36 1
a36 1
.  endif
@


1.2
log
@/var/X11/... -> /etc/X11/... From form@@.

lebel@@, naddy@@, pval@@ ok
@
text
@d3 1
a3 1
# $OpenBSD: imake.port.mk,v 1.1 2001/08/25 11:23:46 espie Exp $
d22 1
a22 1
		cd ${WRKSRC} && ${SETENV} ${MAKE_ENV} ${XMKMF}; \
@


1.1
log
@Cut out some parts of bsd.port.mk into separate modules.

This is work-in-progress. Supplemental hooks will be added when they
become necessary.

The goal is to permit separate subsystems to tweak the package building
process slightly. This should help e.g., python or qt2, for instance.

Documentation will come when it's tested more thoroughly...
@
text
@d3 1
a3 1
# $OpenBSD$
d34 1
a34 1
		${SUDO} ln -sf /var/X11/app-defaults /usr/local/lib/X11/app-defaults; \
@

