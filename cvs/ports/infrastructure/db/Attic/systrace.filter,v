head	1.53;
access;
symbols
	OPENBSD_5_9:1.51.0.2
	OPENBSD_5_9_BASE:1.51
	OPENBSD_5_8:1.45.0.6
	OPENBSD_5_8_BASE:1.45
	OPENBSD_5_7:1.45.0.2
	OPENBSD_5_7_BASE:1.45
	OPENBSD_5_6:1.43.0.2
	OPENBSD_5_6_BASE:1.43
	OPENBSD_5_5:1.39.0.2
	OPENBSD_5_5_BASE:1.39
	OPENBSD_5_4:1.38.0.2
	OPENBSD_5_4_BASE:1.38
	OPENBSD_5_3:1.36.0.2
	OPENBSD_5_3_BASE:1.36
	OPENBSD_5_2:1.35.0.2
	OPENBSD_5_2_BASE:1.35
	OPENBSD_5_1_BASE:1.34
	OPENBSD_5_1:1.34.0.2
	OPENBSD_5_0:1.29.0.2
	OPENBSD_5_0_BASE:1.29
	OPENBSD_4_9:1.28.0.2
	OPENBSD_4_9_BASE:1.28
	OPENBSD_4_8:1.27.0.4
	OPENBSD_4_8_BASE:1.27
	OPENBSD_4_7:1.27.0.2
	OPENBSD_4_7_BASE:1.27
	OPENBSD_4_6:1.26.0.4
	OPENBSD_4_6_BASE:1.26
	OPENBSD_4_5:1.26.0.2
	OPENBSD_4_5_BASE:1.26
	OPENBSD_4_4:1.25.0.2
	OPENBSD_4_4_BASE:1.25
	OPENBSD_4_3:1.24.0.6
	OPENBSD_4_3_BASE:1.24
	OPENBSD_4_2:1.24.0.4
	OPENBSD_4_2_BASE:1.24
	OPENBSD_4_1:1.24.0.2
	OPENBSD_4_1_BASE:1.24
	OPENBSD_4_0:1.21.0.2
	OPENBSD_4_0_BASE:1.21
	OPENBSD_3_9:1.16.0.4
	OPENBSD_3_9_BASE:1.16
	OPENBSD_3_8:1.16.0.2
	OPENBSD_3_8_BASE:1.16
	OPENBSD_3_7:1.15.0.2
	OPENBSD_3_7_BASE:1.15
	OPENBSD_3_6:1.13.0.2
	OPENBSD_3_6_BASE:1.13
	OPENBSD_3_5:1.10.0.2
	OPENBSD_3_5_BASE:1.10
	OPENBSD_3_4:1.2.0.2
	OPENBSD_3_4_BASE:1.2;
locks; strict;
comment	@# @;


1.53
date	2016.04.26.10.56.59;	author sthen;	state dead;
branches;
next	1.52;
commitid	FbIvW5WdGqu5h4SS;

1.52
date	2016.03.31.20.51.47;	author bluhm;	state Exp;
branches;
next	1.51;
commitid	bQNkSCp3MgA9xyNu;

1.51
date	2015.11.25.00.24.16;	author sthen;	state Exp;
branches;
next	1.50;
commitid	HSJE9IS5Lx1AYwZK;

1.50
date	2015.11.05.12.10.33;	author sthen;	state Exp;
branches;
next	1.49;
commitid	ZQLjdAXSJzNgkeGv;

1.49
date	2015.11.05.12.06.53;	author sthen;	state Exp;
branches;
next	1.48;
commitid	mI4DV0zGJqeYRMNF;

1.48
date	2015.10.24.22.28.51;	author bluhm;	state Exp;
branches;
next	1.47;
commitid	l7X3XfRwA2DFdYun;

1.47
date	2015.09.14.09.36.21;	author jasper;	state Exp;
branches;
next	1.46;
commitid	9yak4BujcPM5IJEt;

1.46
date	2015.08.23.18.35.09;	author guenther;	state Exp;
branches;
next	1.45;
commitid	Rd3UwWKQGFpREzqy;

1.45
date	2014.09.11.10.33.44;	author dcoppa;	state Exp;
branches;
next	1.44;
commitid	zqJYhhk0wRqun3xK;

1.44
date	2014.09.03.10.21.39;	author sthen;	state Exp;
branches;
next	1.43;
commitid	SBszjGdABTkTff6N;

1.43
date	2014.07.20.08.57.56;	author ajacoutot;	state Exp;
branches;
next	1.42;
commitid	bAOaHzkNexrMohT9;

1.42
date	2014.07.14.05.50.57;	author guenther;	state Exp;
branches;
next	1.41;
commitid	MtUbsSBiWt4le63v;

1.41
date	2014.06.19.14.43.05;	author giovanni;	state Exp;
branches;
next	1.40;
commitid	yZROLTaks8lJQe58;

1.40
date	2014.06.14.07.51.52;	author stsp;	state Exp;
branches;
next	1.39;
commitid	d8GT31xo0ZzZ1GtN;

1.39
date	2013.08.14.07.31.34;	author bluhm;	state Exp;
branches;
next	1.38;

1.38
date	2013.05.21.08.13.53;	author dcoppa;	state Exp;
branches;
next	1.37;

1.37
date	2013.03.12.00.30.53;	author brad;	state Exp;
branches;
next	1.36;

1.36
date	2012.11.12.10.55.17;	author dcoppa;	state Exp;
branches;
next	1.35;

1.35
date	2012.07.04.16.02.13;	author jsing;	state Exp;
branches;
next	1.34;

1.34
date	2012.01.30.16.02.24;	author ajacoutot;	state Exp;
branches;
next	1.33;

1.33
date	2012.01.20.13.27.20;	author ajacoutot;	state Exp;
branches;
next	1.32;

1.32
date	2012.01.02.12.51.53;	author ajacoutot;	state Exp;
branches;
next	1.31;

1.31
date	2011.12.28.09.39.20;	author ajacoutot;	state Exp;
branches;
next	1.30;

1.30
date	2011.09.18.23.29.51;	author matthew;	state Exp;
branches;
next	1.29;

1.29
date	2011.07.20.18.11.06;	author sthen;	state Exp;
branches;
next	1.28;

1.28
date	2010.11.03.09.17.57;	author sthen;	state Exp;
branches;
next	1.27;

1.27
date	2010.01.14.17.23.28;	author sthen;	state Exp;
branches;
next	1.26;

1.26
date	2008.12.27.19.27.14;	author sturm;	state Exp;
branches;
next	1.25;

1.25
date	2008.06.04.21.07.24;	author bernd;	state Exp;
branches;
next	1.24;

1.24
date	2006.10.29.19.25.29;	author sturm;	state Exp;
branches;
next	1.23;

1.23
date	2006.10.29.19.23.28;	author sturm;	state Exp;
branches;
next	1.22;

1.22
date	2006.09.30.22.31.20;	author steven;	state Exp;
branches;
next	1.21;

1.21
date	2006.07.02.19.17.34;	author sturm;	state Exp;
branches;
next	1.20;

1.20
date	2006.05.02.19.14.37;	author pedro;	state Exp;
branches;
next	1.19;

1.19
date	2006.04.03.21.12.06;	author sturm;	state Exp;
branches;
next	1.18;

1.18
date	2006.04.02.15.10.42;	author sturm;	state Exp;
branches;
next	1.17;

1.17
date	2006.04.02.15.02.06;	author sturm;	state Exp;
branches;
next	1.16;

1.16
date	2005.07.09.07.29.01;	author sturm;	state Exp;
branches;
next	1.15;

1.15
date	2004.11.27.11.59.25;	author sturm;	state Exp;
branches;
next	1.14;

1.14
date	2004.11.21.11.38.04;	author sturm;	state Exp;
branches;
next	1.13;

1.13
date	2004.05.31.12.27.07;	author sturm;	state Exp;
branches;
next	1.12;

1.12
date	2004.05.01.14.23.27;	author sturm;	state Exp;
branches;
next	1.11;

1.11
date	2004.04.24.07.17.44;	author sturm;	state Exp;
branches;
next	1.10;

1.10
date	2004.01.31.11.40.39;	author sturm;	state Exp;
branches;
next	1.9;

1.9
date	2004.01.24.13.02.11;	author sturm;	state Exp;
branches;
next	1.8;

1.8
date	2004.01.18.11.12.24;	author sturm;	state Exp;
branches;
next	1.7;

1.7
date	2004.01.15.22.41.37;	author sturm;	state Exp;
branches;
next	1.6;

1.6
date	2004.01.14.19.54.09;	author sturm;	state Exp;
branches;
next	1.5;

1.5
date	2004.01.04.09.07.19;	author sturm;	state Exp;
branches;
next	1.4;

1.4
date	2004.01.04.08.01.10;	author jolan;	state Exp;
branches;
next	1.3;

1.3
date	2003.11.27.20.01.49;	author sturm;	state Exp;
branches;
next	1.2;

1.2
date	2003.08.24.20.38.25;	author sturm;	state Exp;
branches;
next	1.1;

1.1
date	2003.07.28.17.17.04;	author sturm;	state Exp;
branches;
next	;


desc
@@


1.53
log
@Clean up some bits missed in yesterday's systrace removal.
@
text
@	native-__get_tcb: permit
	native-__getcwd: permit
	native-__semctl: permit
	native-__set_tcb: permit
	native-__tfork: permit
	native-__threxit: permit
	native-__thrsigdivert: permit
	native-__thrsleep: permit
	native-__thrwakeup: permit
	native-accept: permit
	native-bind: sockaddr eq "inet-[0.0.0.0]:0" then deny[eacces]
	native-bind: sockaddr match "/tmp" then permit
	native-bind: sockaddr match "/var/tmp" then permit
	native-bind: sockaddr match "${TMPDIR}" then permit
	native-bind: sockaddr match "${WRKDIR}" then permit
	native-bind: sockaddr match "/<non-existent filename>: *" then deny[enoent]
	native-break: permit
	native-chdir: permit
	native-chflags: filename match "/tmp" then permit
	native-chflags: filename match "/var/tmp" then permit
	native-chflags: filename match "${TMPDIR}" then permit
	native-chflags: filename match "${WRKDIR}" then permit
	native-chflags: filename match "/<non-existent filename>: *" then deny[enoent]
	native-chflagsat: filename match "/tmp" then permit
	native-chflagsat: filename match "/var/tmp" then permit
	native-chflagsat: filename match "${TMPDIR}" then permit
	native-chflagsat: filename match "${WRKDIR}" then permit
	native-chflagsat: filename match "/<non-existent filename>: *" then deny[enoent]
	native-chmod: filename match "/tmp" then permit
	native-chmod: filename match "/var/tmp" then permit
	native-chmod: filename match "${TMPDIR}" then permit
	native-chmod: filename match "${WRKDIR}" then permit
	native-chmod: filename match "/<non-existent filename>: *" then deny[enoent]
	native-chown: filename match "/tmp" then permit
	native-chown: filename match "/var/tmp" then permit
	native-chown: filename match "${TMPDIR}" then permit
	native-chown: filename match "${WRKDIR}" then permit
	native-chown: filename match "/<non-existent filename>: *" then deny[enoent]
	native-chroot: permit
	native-clock_getres: permit
	native-clock_gettime: permit
	native-close: permit
	native-closefrom: permit
	native-compat_43_ogetdtablesize: permit
	native-compat_43_ogetpagesize: permit
	native-compat_43_olseek: permit
	native-connect: sockaddr eq "family(0)" then permit
	native-connect: sockaddr match "/tmp" then permit
	native-connect: sockaddr match "/var/tmp" then permit
	native-connect: sockaddr match "${TMPDIR}" then permit
	native-connect: sockaddr match "${WRKDIR}" then permit
	native-connect: sockaddr match "/<non-existent filename>: *" then deny[enoent]
	native-dup: permit
	native-dup2: permit
	native-dup3: permit
	native-execve: true then permit
	native-exit: permit
	native-fchdir: permit
	native-fchflags: permit
	native-fchmod: permit
	native-fchmodat: filename match "/tmp" then permit
	native-fchmodat: filename match "/var/tmp" then permit
	native-fchmodat: filename match "${TMPDIR}" then permit
	native-fchmodat: filename match "${WRKDIR}" then permit
	native-fchmodat: filename match "/<non-existent filename>: *" then deny[enoent]
	native-fchown: permit
	native-fchownat: filename match "/tmp" then permit
	native-fchownat: filename match "/var/tmp" then permit
	native-fchownat: filename match "${TMPDIR}" then permit
	native-fchownat: filename match "${WRKDIR}" then permit
	native-fchownat: filename match "/<non-existent filename>: *" then deny[enoent]
	native-fcntl: permit
	native-flock: permit
	native-fork: permit
	native-fpathconf: permit
	native-fsread: true then permit
	native-fstat: permit
	native-fstatfs: permit
	native-fswrite: filename eq "" then deny[enoent]
	native-fswrite: filename eq "/dev/crypto" then permit
	native-fswrite: filename eq "/dev/null" then permit
	native-fswrite: filename eq "/dev/ptm" then permit
	native-fswrite: filename eq "/dev/stdout" then permit
	native-fswrite: filename eq "/dev/tty" then permit
	native-fswrite: filename eq "/dev/zero" then permit
	native-fswrite: filename match "/tmp" then permit
	native-fswrite: filename match "/var/tmp" then permit
	native-fswrite: filename match "${DISTDIR}" then permit
	native-fswrite: filename match "${PKG_TMPDIR}" then permit
	native-fswrite: filename match "${PORTSDIR}/bulk" then permit
	native-fswrite: filename match "${PORTSDIR}/packages" then permit
	native-fswrite: filename match "${TMPDIR}" then permit
	native-fswrite: filename match "${WRKDIR}" then permit
	native-fswrite: filename match "/<non-existent filename>: *" then deny[enoent]
	native-fsync: permit
	native-ftruncate: permit
	native-futimes: permit
	native-futimens: permit
	native-getdents: permit
	native-getdtablecount: permit
	native-getegid: permit
	native-getentropy: permit
	native-geteuid: permit
	native-getfsstat: permit
	native-getgid: permit
	native-getgroups: permit
	native-getlogin: permit
	native-getlogin_r: permit
	native-getpeername: permit
	native-getpgid: permit
	native-getpgrp: permit
	native-getpid: permit
	native-getppid: permit
	native-getpriority: permit
	native-getrlimit: permit
	native-getrusage: permit
	native-getsid: permit
	native-getsockname: permit
	native-getsockopt: permit
	native-getthrid: permit
	native-gettimeofday: permit
	native-getuid: permit
	native-ioctl: permit
	native-issetugid: permit
	native-kbind: permit
	native-kevent: permit
	native-kill: permit
	native-kqueue: permit
	native-lchown: filename match "/tmp" then permit
	native-lchown: filename match "/var/tmp" then permit
	native-lchown: filename match "${TMPDIR}" then permit
	native-lchown: filename match "${WRKDIR}" then permit
	native-lchown: filename match "/<non-existent filename>: *" then deny[enoent]
	native-link: filename match "/tmp" and filename[1] match "/tmp" then permit
	native-link: filename match "/var/tmp" and filename[1] match "/var/tmp" then permit
	native-link: filename match "${TMPDIR}" and filename[1] match "${TMPDIR}" then permit
	native-link: filename match "${WRKDIR}" and filename[1] match "${WRKDIR}" then permit
	native-link: filename match "/<non-existent filename>: *" then deny[enoent]
	native-linkat: filename match "/tmp" and filename[1] match "/tmp" then permit
	native-linkat: filename match "/var/tmp" and filename[1] match "/var/tmp" then permit
	native-linkat: filename match "${TMPDIR}" and filename[1] match "${TMPDIR}" then permit
	native-linkat: filename match "${WRKDIR}" and filename[1] match "${WRKDIR}" then permit
	native-linkat: filename match "/<non-existent filename>: *" then deny[enoent]
	native-listen: permit
	native-lseek: permit
	native-madvise: permit
	native-mincore: permit
	native-minherit: permit
	native-mknod: filename match "/tmp" then permit
	native-mknod: filename match "/var/tmp" then permit
	native-mknod: filename match "${TMPDIR}" then permit
	native-mknod: filename match "${WRKDIR}" then permit
	native-mknodat: filename match "/tmp" then permit
	native-mknodat: filename match "/var/tmp" then permit
	native-mknodat: filename match "${TMPDIR}" then permit
	native-mknodat: filename match "${WRKDIR}" then permit
	native-mlock: permit
	native-mlockall: permit
	native-mmap: permit
	native-mprotect: permit
	native-mquery: permit
	native-msync: permit
	native-munmap: permit
	native-nanosleep: permit
	native-pathconf: permit
	native-pipe: permit
	native-pipe2: permit
	native-pledge: permit
	native-poll: permit
	native-ppoll: permit
	native-pread: permit
	native-pselect: permit
	native-pwrite: permit
	native-quotactl: permit
	native-read: permit
	native-readv: permit
	native-recvfrom: permit
	native-recvmsg: permit
	native-rename: filename match "/tmp" and filename[1] match "/tmp" then permit
	native-rename: filename match "/tmp" and filename[1] match "/var/tmp" then permit
	native-rename: filename match "/tmp" and filename[1] match "${WRKDIR}" then permit
	native-rename: filename match "/var/tmp" and filename[1] match "/var/tmp" then permit
	native-rename: filename match "/var/tmp" and filename[1] match "${WRKDIR}" then permit
	native-rename: filename match "${TMPDIR}" and filename[1] match "${TMPDIR}" then permit
	native-rename: filename match "${TMPDIR}" and filename[1] match "${WRKDIR}" then permit
	native-rename: filename match "${WRKDIR}" and filename[1] match "${WRKDIR}" then permit
	native-rename: filename match "/<non-existent filename>: *" then deny[enoent]
	native-renameat: filename match "/tmp" and filename[1] match "/tmp" then permit
	native-renameat: filename match "/tmp" and filename[1] match "/var/tmp" then permit
	native-renameat: filename match "/tmp" and filename[1] match "${WRKDIR}" then permit
	native-renameat: filename match "/var/tmp" and filename[1] match "/var/tmp" then permit
	native-renameat: filename match "/var/tmp" and filename[1] match "${WRKDIR}" then permit
	native-renameat: filename match "${TMPDIR}" and filename[1] match "${TMPDIR}" then permit
	native-renameat: filename match "${TMPDIR}" and filename[1] match "${WRKDIR}" then permit
	native-renameat: filename match "${WRKDIR}" and filename[1] match "${WRKDIR}" then permit
	native-renameat: filename match "/<non-existent filename>: *" then deny[enoent]
	native-sched_yield: permit
	native-select: permit
	native-semctl: permit
	native-semget: permit
	native-semop: permit
	native-sendmsg: sockaddr match "/tmp" then permit
	native-sendmsg: sockaddr match "/var/tmp" then permit
	native-sendmsg: sockaddr match "${TMPDIR}" then permit
	native-sendmsg: sockaddr match "${WRKDIR}" then permit
	native-sendmsg: sockaddr match "/<non-existent filename>: *" then deny[enoent]
	native-sendmsg: sockaddr eq "<unknown>" then permit
	native-sendsyslog: permit
	native-sendto: permit
	native-setegid: permit
	native-setgid: permit
	native-setgroups: permit
	native-setitimer: permit
	native-setpgid: permit
	native-setpriority: permit
	native-setregid: permit
	native-setresgid: permit
	native-setresuid: permit
	native-setreuid: permit
	native-setrlimit: permit
	native-setsid: permit
	native-setsockopt: permit
	native-setuid: permit
	native-shmat: permit
	native-shmctl: permit
	native-shmdt: permit
	native-shmget: permit
	native-shutdown: permit
	native-sigaction: permit
	native-sigaltstack: permit
	native-sigpending: permit
	native-sigprocmask: permit
	native-sigreturn: permit
	native-sigsuspend: permit
	native-socket: permit
	native-socketpair: permit
	native-statfs: permit
	native-symlink: filename match "/tmp" then permit
	native-symlink: filename match "/var/tmp" then permit
	native-symlink: filename match "${TMPDIR}" then permit
	native-symlink: filename match "${WRKDIR}" then permit
	native-symlink: filename match "/<non-existent filename>: *" then deny[enoent]
	native-symlink: string eq "" and filename eq "" then deny[enoent]
	native-symlinkat: filename match "/tmp" then permit
	native-symlinkat: filename match "/var/tmp" then permit
	native-symlinkat: filename match "${TMPDIR}" then permit
	native-symlinkat: filename match "${WRKDIR}" then permit
	native-symlinkat: filename match "/<non-existent filename>: *" then deny[enoent]
	native-symlinkat: string eq "" and filename eq "" then deny[enoent]
	native-sync: permit
	native-sysctl: permit
	native-umask: permit
	native-utimensat: permit
	native-utimes: permit
	native-vfork: permit
	native-wait4: permit
	native-write: permit
	native-writev: permit

@


1.52
log
@Ports systrace needs getlogin_r now, sendsyslog2 has been renamed
to sendsyslog.
OK sthen@@
@
text
@@


1.51
log
@allow sendsyslog2, we already have sendsyslog
@
text
@d108 1
a208 1
	native-sendsyslog2: permit
@


1.50
log
@a couple more system calls needed by file(1): getdtablecount(2) and
sendmsg(2) with sockaddr "<unknown>". from patrick keshishian
@
text
@d208 1
@


1.49
log
@cp -p now uses chflagsat instead of chflags, found by Tati Chevron
@
text
@d100 1
d206 1
@


1.48
log
@Add pledge permit to make ports systrace work again.
OK naddy@@
@
text
@d24 5
@


1.47
log
@__sysctl got renamed to sysctl

ok sthen@@
@
text
@d161 1
@


1.46
log
@Add kbind
@
text
@a4 1
	native-__sysctl: permit
d242 1
@


1.45
log
@
permit native-dup3: unbreak systraced build of gstreamer1.

from patrick keshishian
ok sthen@@
@
text
@d119 1
@


1.44
log
@add native-pipe2, from Mark Patruck
@
text
@d49 1
d51 1
a51 1
	native-dup: permit
@


1.43
log
@No longer play with /dev/log in here either.

ok espie@@
@
text
@d159 1
@


1.42
log
@Add sendsyslog
@
text
@a43 1
	native-connect: sockaddr match "/dev/log" then permit
@


1.41
log
@
Fix ports builds with systrace after minherit addition and sort entries
ok jca@@ sthen@@
@
text
@d198 1
@


1.40
log
@Fix ports builds with systrace after getentropy addition.
ok brad sthen
@
text
@d140 2
a149 1
	native-mincore: permit
@


1.39
log
@Fix the ports build with systrace as the time_t diff has replaced
getdirentries(2) with getdents(2).
OK gsoares@@ dcoppa@@
@
text
@d97 1
@


1.38
log
@permit native-ppoll and native-pselect

ok brad@@
@
text
@d95 1
a95 1
	native-getdirentries: permit
@


1.37
log
@Allow access to /dev/ptm so posix_openpt() works.

ok sthen@@
@
text
@d159 1
d161 1
@


1.36
log
@Add "native-sigpending: permit" to avoid warnings from systrace now
that make(1) uses this function.

ok espie@@
@
text
@d78 1
@


1.35
log
@The rfork syscall is now obsolete.

ok sthen@@
@
text
@d215 1
@


1.34
log
@Remove some obsolete syscalls and add one for fpathconf.

From Brad
ok espie@@
@
text
@a182 1
	native-rfork: permit
@


1.33
log
@Update systrace.filter for rthreads syscalls renaming.

from Brad
ok espie@@
@
text
@d71 1
a154 2
	native-ogetdirentries: permit
	native-osigaltstack: permit
@


1.32
log
@Add remaining syscalls to allow rthreads to work.

from Brad
ok espie@@
@
text
@d7 4
a235 4
	native-threxit: permit
	native-thrsigdivert: permit
	native-thrsleep: permit
	native-thrwakeup: permit
@


1.31
log
@Update systrace.filter to allow rthreads to work.

from Brad
ok espie@@
@
text
@d6 1
d107 1
d181 1
d232 4
@


1.30
log
@Add rules for USE_SYSTRACE to support *at(2) system calls.

ok jasper@@, sthen@@
@
text
@d1 1
d4 1
@


1.29
log
@Permit utimensat(2) and futimens(2), as discussed with matthew@@.
Fixes ruby 1.9 build with systrace now that we have these system calls.
The other new *at system calls need to have path restrictions and will
need further work so are still prevented for now (in those cases, the
supplied paths are *relative to a certain FD*, so we can't simply
examine supplied paths).
@
text
@d50 5
d56 5
d121 5
d133 4
d167 9
d220 6
@


1.28
log
@permit native-ogetdirentries, ok aja
@
text
@d75 1
d194 1
@


1.27
log
@Permit native-mincore, at least some GNU m4 programs and clisp hit this.
ok sturm@@ ajacoutot@@
@
text
@d126 1
@


1.26
log
@get rid of warnings in yp environments by explicitly denying binding
to 0.0.0.0:0 with eaccess

from Ingo Schwarze <schwarze at usta.de>
@
text
@d117 1
@


1.25
log
@Permit native-clock_gettime.

ok sturm@@, kurt@@
@
text
@d5 1
@


1.24
log
@match sockaddr for sendmsg()
@
text
@d28 1
@


1.23
log
@permit symlinks to non-existing files (might happen when extracting an
archive)
@
text
@d148 5
a152 1
	native-sendmsg: permit
@


1.22
log
@permit semaphore related syscalls; this allows building dk-milter and
dkim-milter with systrace.

ok sturm@@
@
text
@d181 1
@


1.21
log
@permit rename() from /tmp to /var/tmp, used by latex
@
text
@d2 1
d145 3
@


1.20
log
@Permit __getcwd, noticed by uwe@@, okay sturm@@
@
text
@d134 1
@


1.19
log
@add mknod() and a little cleanup
@
text
@d1 1
@


1.18
log
@use a consistent set of paths whereever possible
this denies more manipulations outside the build area
@
text
@d7 1
d38 1
d109 4
a174 1
	native-symlink: filename match "/<non-existent filename>: *" then deny[enoent]
@


1.17
log
@don't log accept()/listen()
mkfifo() is in fswrite
add quotactl
@
text
@d4 1
d6 1
d9 15
a23 3
	native-chflags: permit
	native-chmod: permit
	native-chown: permit
d34 1
d36 1
d58 1
a58 1
	native-fswrite: filename match "${TMPDIR}" then permit
d60 1
a60 1
	native-fswrite: filename match "${WRKDIR}" then permit
d63 2
a64 1
	native-fswrite: filename match "${PKG_TMPDIR}" then permit
d94 5
a98 1
	native-lchown: permit
d100 2
d103 1
a103 1
	native-link: filename[1] match "/<non-existent filename>: *" then deny[enoent]
d126 9
a134 1
	native-rename: permit
d166 2
@


1.16
log
@permit kqueue and kevent

noticed by Ray Lai <ray at cyth.net>
@
text
@d2 1
a2 1
	native-accept: true then permit log
d81 1
a81 1
	native-listen: true then permit log
a83 1
	native-mkfifo: permit
d98 1
@


1.15
log
@deny writing empty filenames on the spot
@
text
@d74 1
d76 1
@


1.14
log
@restrict link() and symlink()
@
text
@d35 1
a35 1
	native-fswrite: filename eq "" then permit
@


1.13
log
@honour TMPDIR and PKG_TMPDIR in systrace policies

prodded by jolan@@
@
text
@d76 3
a78 1
	native-link: permit
d132 4
a135 1
	native-symlink: permit
@


1.12
log
@according to Niels, execve needs "true then permit" in order for emulation
changes to work correctly. This allows fixes for emulation issues with
some linux-compat ports (jdk, netscape).
@
text
@d4 1
d20 1
d42 1
d47 1
a47 1
	native-fswrite: filename match "/var/tmp" then permit
@


1.11
log
@permit closefrom()
@
text
@d21 1
a21 1
	native-execve: permit
@


1.10
log
@permit fswrite to empty filename, syscalls are supposed to fail on this
@
text
@d12 1
@


1.9
log
@permit osigaltstack
@
text
@d32 1
@


1.8
log
@more
@
text
@d84 1
@


1.7
log
@don't log permitted bind() and connect()
permit connect() to /dev/log
@
text
@d12 1
@


1.6
log
@permit msync() and setreuid()
@
text
@d3 1
a3 1
	native-bind: sockaddr match "/tmp" then permit log
d14 3
a16 2
	native-connect: sockaddr match "/tmp" then permit log
	native-connect: sockaddr eq "family(0)" then permit log
@


1.5
log
@use WRKDIR instead of WRKOBJDIR for systrace, as the latter is not defined
unconditionally

found by Michael Coulter <mjc at bitz dot ca>
@
text
@d79 1
d104 1
@


1.4
log
@no need for ${PORTSDIR}/{cdrom,ftp}-packages anymore

ok pval sturm
@
text
@d37 1
a37 1
	native-fswrite: filename match "${WRKOBJDIR}" then permit
@


1.3
log
@+compat_43_ogetpagesize and compat_43_olseek to allow systrace'd build
of archivers/rar on i386
+setgroups
@
text
@a38 2
	native-fswrite: filename match "${PORTSDIR}/cdrom-packages" then permit
	native-fswrite: filename match "${PORTSDIR}/ftp-packages" then permit
@


1.2
log
@+getpeername

ok naddy@@
@
text
@d12 2
d98 1
@


1.1
log
@this makes our build infrastructure systrace aware
original idea from jsyn@@, discussed and first tests at c2k3

Warning!
- this commit is different from all patches sent around, please remove
  them before updating
- due to a few bugs in systrace this is currently not ready for the casual
  porter and several ports will fail to build, you've been warned

The idea of this patch is to help a porter when developing a new port.
With systrace the configure, build and fake stages are not allowed to
open network connections or write outside some well defined directories.
This way misbehaving programs will be noticed due to logfile entries in
/var/log/messages and the port can be fixed. There is generally no need
for endusers to use this, as the checksum ensures that ports in the
future will behave the same as they did when porting. :)

To activate systrace'd port building, set USE_SYSTRACE=Yes (e.g. in
/etc/mk.conf)

tested by some people, ok espie@@
@
text
@d52 1
@

