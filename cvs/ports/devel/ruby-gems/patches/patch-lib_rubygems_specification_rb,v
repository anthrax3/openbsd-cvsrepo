head	1.2;
access;
symbols
	OPENBSD_6_1:1.1.0.12
	OPENBSD_6_1_BASE:1.1
	OPENBSD_6_0:1.1.0.10
	OPENBSD_6_0_BASE:1.1
	OPENBSD_5_9:1.1.0.6
	OPENBSD_5_9_BASE:1.1
	OPENBSD_5_8:1.1.0.8
	OPENBSD_5_8_BASE:1.1
	OPENBSD_5_7:1.1.0.4
	OPENBSD_5_7_BASE:1.1
	OPENBSD_5_6:1.1.0.2
	OPENBSD_5_6_BASE:1.1;
locks; strict;
comment	@# @;


1.2
date	2017.09.02.21.34.12;	author jeremy;	state Exp;
branches;
next	1.1;
commitid	CNZruoNJxjG8r965;

1.1
date	2014.06.25.15.38.18;	author jeremy;	state Exp;
branches;
next	;
commitid	buhPpdWoqjstIEY1;


desc
@@


1.2
log
@Backport security patches in rubygems 2.6.13 to 1.8.24. No CVE numbers,
but this fixes the following vulnerabilities:

* Fix a DNS request hijacking vulnerability.
* Fix an ANSI escape sequence vulnerability.
* Fix a DOS vulernerability in the query command.
* Fix a vulnerability in the gem installer that allowed a malicious
  gem to overwrite arbitrary files.
@
text
@$OpenBSD: patch-lib_rubygems_specification_rb,v 1.1 2014/06/25 15:38:18 jeremy Exp $

Backport fix for Gem.refresh from upstream commit
b61c621fb2e00e215bcc8ad7d9fe45433881da14.

Index: lib/rubygems/specification.rb
--- lib/rubygems/specification.rb.orig
+++ lib/rubygems/specification.rb
@@@@ -275,6 +275,12 @@@@ class Gem::Specification
 
       @@@@all = specs.values
 
+      # After a reset, make sure already loaded specs
+      # are still marked as activated.
+      specs = {}
+      Gem.loaded_specs.each_value{|s| specs[s] = true}
+      @@@@all.each{|s| s.activated = true if specs[s]}
+
       _resort!
     end
     @@@@all
@@@@ -2007,9 +2013,15 @@@@ class Gem::Specification
       end
     end
 
-    unless String === name then
+    if !name.is_a?(String) then
       raise Gem::InvalidSpecificationException,
             "invalid value for attribute name: \"#{name.inspect}\""
+    elsif name !~ /[a-zA-Z]/ then
+      raise Gem::InvalidSpecificationException,
+            "invalid value for attribute name: #{name.dump} must include at least one letter"
+    elsif name !~ /\A[a-zA-Z0-9\.\-\_]+\z/ then
+      raise Gem::InvalidSpecificationException,
+            "invalid value for attribute name: #{name.dump} can only include letters, numbers, dashes, and underscores"
     end
 
     if require_paths.empty? then
@


1.1
log
@Backport an upstream rubygems patch fixing issues with Gem.refresh.

OK ajacoutot@@
@
text
@d1 1
a1 1
$OpenBSD$
d6 3
a8 2
--- lib/rubygems/specification.rb.orig	Tue Jun 24 14:21:46 2014
+++ lib/rubygems/specification.rb	Tue Jun 24 14:21:52 2014
d22 17
@

