head	1.17;
access;
symbols
	OPENBSD_3_8:1.11.0.2
	OPENBSD_3_8_BASE:1.11
	OPENBSD_3_7:1.6.0.2
	OPENBSD_3_7_BASE:1.6
	OPENBSD_3_6:1.4.0.2
	OPENBSD_3_6_BASE:1.4;
locks; strict;
comment	@# @;


1.17
date	2006.01.04.19.48.59;	author brad;	state dead;
branches;
next	1.16;

1.16
date	2005.12.22.11.36.00;	author espie;	state Exp;
branches;
next	1.15;

1.15
date	2005.12.16.23.03.35;	author espie;	state Exp;
branches;
next	1.14;

1.14
date	2005.12.12.15.15.16;	author espie;	state Exp;
branches;
next	1.13;

1.13
date	2005.11.02.02.47.09;	author brad;	state Exp;
branches;
next	1.12;

1.12
date	2005.09.09.17.30.32;	author brad;	state Exp;
branches;
next	1.11;

1.11
date	2005.07.12.01.03.07;	author brad;	state Exp;
branches;
next	1.10;

1.10
date	2005.06.17.16.16.46;	author brad;	state Exp;
branches;
next	1.9;

1.9
date	2005.05.23.20.01.49;	author brad;	state Exp;
branches;
next	1.8;

1.8
date	2005.05.21.22.38.19;	author brad;	state Exp;
branches;
next	1.7;

1.7
date	2005.04.17.10.14.55;	author brad;	state Exp;
branches;
next	1.6;

1.6
date	2004.12.18.23.30.36;	author brad;	state Exp;
branches;
next	1.5;

1.5
date	2004.12.18.21.38.18;	author brad;	state Exp;
branches;
next	1.4;

1.4
date	2004.08.07.21.55.26;	author brad;	state Exp;
branches;
next	1.3;

1.3
date	2004.08.05.18.04.55;	author brad;	state Exp;
branches;
next	1.2;

1.2
date	2004.08.02.15.43.11;	author brad;	state Exp;
branches;
next	1.1;

1.1
date	2004.07.11.19.22.05;	author brad;	state Exp;
branches;
next	;


desc
@@


1.17
log
@Redundant patch as pointed out by jakemsr@@. The libltdl copy of ltmain.sh
will be regenerated from ltmain.in.
@
text
@$OpenBSD: patch-libltdl_ltmain_sh,v 1.16 2005/12/22 11:36:00 espie Exp $
--- libltdl/ltmain.sh.orig	Wed Aug 31 20:55:39 2005
+++ libltdl/ltmain.sh	Mon Dec 19 09:50:31 2005
@@@@ -352,6 +352,8 @@@@ func_extract_archives ()
 # Darwin sucks
 eval std_shrext=\"$shrext_cmds\"
 
+disable_libs=no
+
 # Parse our command line options once, thoroughly.
 while test "$#" -gt 0
 do
@@@@ -468,7 +470,9 @@@@ do
     preserve_args="$preserve_args $arg"
     ;;
 
-  --tag) prevopt="--tag" prev=tag ;;
+  --tag) prevopt="--tag" prev=tag
+    preserve_args="$preserve_args --tag"
+    ;;
   --tag=*)
     set tag "$optarg" ${1+"$@@"}
     shift
@@@@ -500,6 +504,18 @@@@ if test -n "$prevopt"; then
   exit $EXIT_FAILURE
 fi
 
+case $disable_libs in
+no) 
+  ;;
+shared)
+  build_libtool_libs=no
+  build_old_libs=yes
+  ;;
+static)
+  build_old_libs=`case $build_libtool_libs in yes) $echo no;; *) $echo yes;; esac`
+  ;;
+esac
+
 # If this variable is set in any of the actions, the command in it
 # will be execed at the end.  This prevents here-documents from being
 # left over by shells.
@@@@ -1089,14 +1105,15 @@@@ EOF
 	  if test -n "$link_static_flag"; then
 	    dlopen_self=$dlopen_self_static
 	  fi
+	  prefer_static_libs=yes
 	else
 	  if test -z "$pic_flag" && test -n "$link_static_flag"; then
 	    dlopen_self=$dlopen_self_static
 	  fi
+	  prefer_static_libs=built
 	fi
 	build_libtool_libs=no
 	build_old_libs=yes
-	prefer_static_libs=yes
 	break
 	;;
       esac
@@@@ -1503,6 +1520,13 @@@@ EOF
 	   continue
 	   ;;
 	 esac
+	elif test "X$arg" = "X-lresolv"; then
+	 case $host in
+	 *-*-openbsd*)
+	   # dummy library, no shared version
+	   continue
+	   ;;
+	 esac
 	fi
 	deplibs="$deplibs $arg"
 	continue
@@@@ -1984,6 +2008,17 @@@@ EOF
 	;;
     esac
     for pass in $passes; do
+      # The preopen pass in lib mode reverses $deplibs; put it back here
+      # so that -L comes before libs that need it for instance...
+      if test "$linkmode,$pass" = "lib,link"; then
+	## FIXME: Find the place where the list is rebuilt in the wrong
+	##        order, and fix it there properly
+	tmp_deplibs=
+	for deplib in $deplibs; do
+	  tmp_deplibs="$deplib $tmp_deplibs"
+	done
+	deplibs="$tmp_deplibs"
+      fi
       if test "$linkmode,$pass" = "lib,link" ||
 	 test "$linkmode,$pass" = "prog,scan"; then
 	libs="$deplibs"
@@@@ -2245,20 +2280,20 @@@@ EOF
 	    # It is a libtool convenience library, so add in its objects.
 	    convenience="$convenience $ladir/$objdir/$old_library"
 	    old_convenience="$old_convenience $ladir/$objdir/$old_library"
-	    tmp_libs=
-	    for deplib in $dependency_libs; do
-	      deplibs="$deplib $deplibs"
-              if test "X$duplicate_deps" = "Xyes" ; then
-	        case "$tmp_libs " in
-	        *" $deplib "*) specialdeplibs="$specialdeplibs $deplib" ;;
-	        esac
-              fi
-	      tmp_libs="$tmp_libs $deplib"
-	    done
 	  elif test "$linkmode" != prog && test "$linkmode" != lib; then
 	    $echo "$modename: \`$lib' is not a convenience library" 1>&2
 	    exit $EXIT_FAILURE
 	  fi
+	  tmp_libs=
+	  for deplib in $dependency_libs; do
+	    deplibs="$deplib $deplibs"
+	    if test "X$duplicate_deps" = "Xyes" ; then
+	      case "$tmp_libs " in
+	      *" $deplib "*) specialdeplibs="$specialdeplibs $deplib" ;;
+	      esac
+	    fi
+	    tmp_libs="$tmp_libs $deplib"
+	  done
 	  continue
 	fi # $pass = conv
 
@@@@ -2445,11 +2480,15 @@@@ EOF
 	fi
 
 	link_static=no # Whether the deplib will be linked statically
+	use_static_libs=$prefer_static_libs
+	if test "$use_static_libs" = built && test "$installed" = yes ; then
+	  use_static_libs=no
+	fi
 	if test -n "$library_names" &&
-	   { test "$prefer_static_libs" = no || test -z "$old_library"; }; then
+	   { test "$use_static_libs" = no || test -z "$old_library"; }; then
 	  if test "$installed" = no; then
 	    notinst_deplibs="$notinst_deplibs $lib"
-	    need_relink=yes
+	    test -z "$DESTDIR" && need_relink=yes
 	  fi
 	  # This is a shared library
 
@@@@ -2644,7 +2683,7 @@@@ EOF
 	    add_dir=
 	    add=
 	    # Finalize command for both is simple: just hardcode it.
-	    if test "$hardcode_direct" = yes; then
+	    if test "$hardcode_direct" = yes && test -f $libdir/$linklib; then
 	      add="$libdir/$linklib"
 	    elif test "$hardcode_minus_L" = yes; then
 	      add_dir="-L$libdir"
@@@@ -5932,40 +5971,6 @@@@ relink_command=\"$relink_command\""
     # Exit here if they wanted silent mode.
     test "$show" = : && exit $EXIT_SUCCESS
 
-    $echo "----------------------------------------------------------------------"
-    $echo "Libraries have been installed in:"
-    for libdir in $libdirs; do
-      $echo "   $libdir"
-    done
-    $echo
-    $echo "If you ever happen to want to link against installed libraries"
-    $echo "in a given directory, LIBDIR, you must either use libtool, and"
-    $echo "specify the full pathname of the library, or use the \`-LLIBDIR'"
-    $echo "flag during linking and do at least one of the following:"
-    if test -n "$shlibpath_var"; then
-      $echo "   - add LIBDIR to the \`$shlibpath_var' environment variable"
-      $echo "     during execution"
-    fi
-    if test -n "$runpath_var"; then
-      $echo "   - add LIBDIR to the \`$runpath_var' environment variable"
-      $echo "     during linking"
-    fi
-    if test -n "$hardcode_libdir_flag_spec"; then
-      libdir=LIBDIR
-      eval flag=\"$hardcode_libdir_flag_spec\"
-
-      $echo "   - use the \`$flag' linker flag"
-    fi
-    if test -n "$admincmds"; then
-      $echo "   - have your system administrator run these commands:$admincmds"
-    fi
-    if test -f /etc/ld.so.conf; then
-      $echo "   - have your system administrator add LIBDIR to \`/etc/ld.so.conf'"
-    fi
-    $echo
-    $echo "See any operating system documentation about shared libraries for"
-    $echo "more information, such as the ld(1) and ld.so(8) manual pages."
-    $echo "----------------------------------------------------------------------"
     exit $EXIT_SUCCESS
     ;;
 
@@@@ -6516,12 +6521,11 @@@@ exit $?
 # configuration.  But we'll never go from static-only to shared-only.
 
 # ### BEGIN LIBTOOL TAG CONFIG: disable-shared
-build_libtool_libs=no
-build_old_libs=yes
+disable_libs=shared
 # ### END LIBTOOL TAG CONFIG: disable-shared
 
 # ### BEGIN LIBTOOL TAG CONFIG: disable-static
-build_old_libs=`case $build_libtool_libs in yes) $echo no;; *) $echo yes;; esac`
+disable_libs=static
 # ### END LIBTOOL TAG CONFIG: disable-static
 
 # Local Variables:
@


1.16
log
@- remove non-existent dirs from libsearch path.
- if DESTDIR is defined, avoid relinking (relinking doesn't make sense
with the fake framework anyways).

okay brad@@, `as long as it doesn't break anything'.
@
text
@d1 1
a1 1
$OpenBSD: patch-libltdl_ltmain_sh,v 1.15 2005/12/16 23:03:35 espie Exp $
@


1.15
log
@Minor fixes:
- do not link -lresolv, even though this will be gone from -current.
- ld.so path is just /usr/lib, no /lib on OpenBSD.
@
text
@d1 1
a1 1
$OpenBSD: patch-libltdl_ltmain_sh,v 1.14 2005/12/12 15:15:16 espie Exp $
d3 1
a3 1
+++ libltdl/ltmain.sh	Thu Dec 15 19:10:15 2005
d123 1
a123 1
@@@@ -2445,8 +2480,12 @@@@ EOF
d136 5
a140 1
 	    need_relink=yes
@


1.14
log
@Fix two annoying issues (fixed upstream as well):
--tag CXX works for relink now.
--tag=disable-static/disable-shared is now independent from language tags,

thus libtool --tag=disable-static --tag CXX works.

Almost allows KDE from using libtool. Still one issue to hunt down and fix.

Okay brad@@, who reminded me about updating both ltmain.in and ltmain.sh...
@
text
@d1 1
a1 1
$OpenBSD: patch-libltdl_ltmain_sh,v 1.13 2005/11/02 02:47:09 brad Exp $
d3 1
a3 1
+++ libltdl/ltmain.sh	Wed Dec  7 09:44:14 2005
d60 15
a74 1
@@@@ -1984,6 +2001,17 @@@@ EOF
d92 1
a92 1
@@@@ -2245,20 +2273,20 @@@@ EOF
d123 1
a123 1
@@@@ -2445,8 +2473,12 @@@@ EOF
d137 1
a137 1
@@@@ -2644,7 +2676,7 @@@@ EOF
d146 1
a146 1
@@@@ -5932,40 +5964,6 @@@@ relink_command=\"$relink_command\""
d187 1
a187 1
@@@@ -6516,12 +6514,11 @@@@ exit $?
@


1.13
log
@rev 1.334.2.92

With `-static', only link statically against uninstalled libtool
libraries.  Fixes 1.5.x regression to match documented (and actual
1.4.x) behavior.

From libtool CVS
@
text
@d1 43
a43 4
$OpenBSD: patch-libltdl_ltmain_sh,v 1.12 2005/09/09 17:30:32 brad Exp $
--- libltdl/ltmain.sh.orig	Wed Aug 31 14:55:39 2005
+++ libltdl/ltmain.sh	Tue Nov  1 15:15:22 2005
@@@@ -1089,14 +1089,15 @@@@ EOF
d60 1
a60 1
@@@@ -1984,6 +1985,17 @@@@ EOF
d78 1
a78 1
@@@@ -2245,20 +2257,20 @@@@ EOF
d109 1
a109 1
@@@@ -2445,8 +2457,12 @@@@ EOF
d123 1
a123 1
@@@@ -2644,7 +2660,7 @@@@ EOF
d132 1
a132 1
@@@@ -5932,40 +5948,6 @@@@ relink_command=\"$relink_command\""
d173 15
@


1.12
log
@upgrade to libtool 1.5.20
@
text
@d1 1
a1 1
$OpenBSD: patch-libltdl_ltmain_sh,v 1.11 2005/07/12 01:03:07 brad Exp $
d3 19
a21 2
+++ libltdl/ltmain.sh	Thu Sep  1 21:44:47 2005
@@@@ -1984,6 +1984,17 @@@@ EOF
d39 1
a39 1
@@@@ -2245,20 +2256,20 @@@@ EOF
d70 15
a84 1
@@@@ -2644,7 +2655,7 @@@@ EOF
d93 1
a93 1
@@@@ -5932,40 +5943,6 @@@@ relink_command=\"$relink_command\""
@


1.11
log
@rev 1.334.2.78

When a library is installed, dependent on a convenience library, and it
involves relinking, the object files extracted from the convenience
library are not removed after the relink. This is a problem if you build
as non-root, install as root, then try to remove the build directory as
non-root; Clean up properly if relink fails; Change"$realname"U to
${realname}T to be consistent.
Missing backport of 2004-03-24 patch reported against MirLibtool
by Marc Matteo <marcm@@lectroid.net>.
@
text
@d1 4
a4 4
$OpenBSD: patch-libltdl_ltmain_sh,v 1.10 2005/06/17 16:16:46 brad Exp $
--- libltdl/ltmain.sh.orig	Mon May 16 05:39:29 2005
+++ libltdl/ltmain.sh	Mon Jul 11 18:30:08 2005
@@@@ -1985,6 +1985,17 @@@@ EOF
d22 1
a22 1
@@@@ -2246,20 +2257,20 @@@@ EOF
d53 1
a53 10
@@@@ -2409,7 +2420,7 @@@@ EOF
 	      case "$temp_rpath " in
 	      *" $dir "*) ;;
 	      *" $absdir "*) ;;
-	      *) temp_rpath="$temp_rpath $dir" ;;
+	      *) temp_rpath="$temp_rpath $absdir" ;;
 	      esac
 	    fi
 
@@@@ -2645,7 +2656,7 @@@@ EOF
d62 1
a62 60
@@@@ -2729,8 +2740,6 @@@@ EOF
 	      fi
 	    fi
 	  else
-	    convenience="$convenience $dir/$old_library"
-	    old_convenience="$old_convenience $dir/$old_library"
 	    deplibs="$dir/$old_library $deplibs"
 	    link_static=yes
 	  fi
@@@@ -4013,13 +4022,30 @@@@ EOF
 	  IFS="$save_ifs"
 	  eval cmd=\"$cmd\"
 	  $show "$cmd"
-	  $run eval "$cmd" || exit $?
+	  $run eval "$cmd" || {
+	    lt_exit=$?
+
+	    # Restore the uninstalled library and exit
+	    if test "$mode" = relink; then
+	      $run eval '(cd $output_objdir && $rm ${realname}T && $mv ${realname}U $realname)'
+	    fi
+
+	    exit $lt_exit
+	  }
 	done
 	IFS="$save_ifs"
 
 	# Restore the uninstalled library and exit
 	if test "$mode" = relink; then
 	  $run eval '(cd $output_objdir && $rm ${realname}T && $mv $realname ${realname}T && $mv "$realname"U $realname)' || exit $?
+
+	  if test -n "$convenience"; then
+	    if test -z "$whole_archive_flag_spec"; then
+	      $show "${rm}r $gentop"
+	      $run ${rm}r "$gentop"
+	    fi
+	  fi
+
 	  exit $EXIT_SUCCESS
 	fi
 
@@@@ -5619,7 +5645,16 @@@@ relink_command=\"$relink_command\""
 	    IFS="$save_ifs"
 	    eval cmd=\"$cmd\"
 	    $show "$cmd"
-	    $run eval "$cmd" || exit $?
+	    $run eval "$cmd" || {
+	      lt_exit=$?
+
+	      # Restore the uninstalled library and exit
+	      if test "$mode" = relink; then
+		$run eval '(cd $output_objdir && $rm ${realname}T && $mv ${realname}U $realname)'
+	      fi
+
+	      exit $lt_exit
+	    }
 	  done
 	  IFS="$save_ifs"
 	fi
@@@@ -5902,40 +5937,6 @@@@ relink_command=\"$relink_command\""
@


1.10
log
@rev 1.334.2.72

Add fully-qualified paths to temp_rpath rather than unqualified paths in order
to avoid possible errors when computing the fully-qualified path later.

rev 1.334.2.70

Do not add installed static litool libraries to convenience, they are not
convenience libraries.

From libtool CVS
@
text
@d1 1
a1 1
$OpenBSD: patch-libltdl_ltmain_sh,v 1.9 2005/05/23 20:01:49 brad Exp $
d3 1
a3 1
+++ libltdl/ltmain.sh	Fri Jun 17 09:52:53 2005
d80 51
a130 1
@@@@ -5902,40 +5911,6 @@@@ relink_command=\"$relink_command\""
@


1.9
log
@upgrade to libtool 1.5.18
@
text
@d1 1
a1 1
$OpenBSD: patch-libltdl_ltmain_sh,v 1.8 2005/05/21 22:38:19 brad Exp $
d3 1
a3 1
+++ libltdl/ltmain.sh	Sun May 22 16:31:34 2005
d53 9
d71 10
a80 1
@@@@ -5902,40 +5913,6 @@@@ relink_command=\"$relink_command\""
@


1.8
log
@upgrade to libtool 1.5.16
@
text
@d1 4
a4 4
$OpenBSD: patch-libltdl_ltmain_sh,v 1.7 2005/04/17 10:14:55 brad Exp $
--- libltdl/ltmain.sh.orig	Sun Apr 24 13:59:20 2005
+++ libltdl/ltmain.sh	Fri May 13 21:09:30 2005
@@@@ -1981,6 +1981,17 @@@@ EOF
d22 1
a22 1
@@@@ -2242,20 +2253,20 @@@@ EOF
d53 1
a53 1
@@@@ -2641,7 +2652,7 @@@@ EOF
d62 1
a62 1
@@@@ -5898,40 +5909,6 @@@@ relink_command=\"$relink_command\""
@


1.7
log
@upgrade to libtool 1.5.14
@
text
@d1 4
a4 16
$OpenBSD: patch-libltdl_ltmain_sh,v 1.6 2004/12/18 23:30:36 brad Exp $
--- libltdl/ltmain.sh.orig	Sat Feb 12 07:30:57 2005
+++ libltdl/ltmain.sh	Sun Apr 17 05:40:47 2005
@@@@ -112,8 +112,9 @@@@ if test "${LANG+set}" = set; then
 fi
 
 # Make sure IFS has a sensible default
-: ${IFS=" 	
-"}
+lt_nl='
+'
+IFS=" 	$lt_nl"
 
 if test "$build_libtool_libs" != yes && test "$build_old_libs" != yes; then
   $echo "$modename: not configured to build any kind of library" 1>&2
@@@@ -1989,6 +1990,17 @@@@ EOF
d22 1
a22 1
@@@@ -2250,20 +2262,20 @@@@ EOF
d53 1
a53 1
@@@@ -2649,7 +2661,7 @@@@ EOF
d62 1
a62 19
@@@@ -2852,13 +2864,13 @@@@ EOF
 	      *) continue ;;
 	      esac
 	      case " $deplibs " in
+	      *" $path "*) ;;
+	      *) deplibs="$path $deplibs" ;;
+	      esac
+	      case " $deplibs " in
 	      *" $depdepl "*) ;;
 	      *) deplibs="$depdepl $deplibs" ;;
 	      esac
-	      case " $deplibs " in
-	      *" $path "*) ;;
-	      *) deplibs="$deplibs $path" ;;
-	      esac
 	    done
 	  fi # link_all_deplibs != no
 	fi # linkmode = lib
@@@@ -5862,40 +5874,6 @@@@ relink_command=\"$relink_command\""
@


1.6
log
@rev 1.28

Propagate a convenience library's dependency libs correctly when
it is being linked into a libtool library.  Deplibs are now
propagated whether libdir is set or not.

rev 1.27

The dlpreopen pass over libraries reverses the elements in the
$deplibs list.  This causes problems when the link pass tries to
find libraries when they are located in non-standard places
denoted by -L options.  Due to the reversed order these -L options
occur after the libraries that need them, and they are not found:

(Un)Reverse $deplibs list at the start of the link pass in lib mode.

From libtool CVS
@
text
@d1 16
a16 4
$OpenBSD: patch-libltdl_ltmain_sh,v 1.5 2004/12/18 21:38:18 brad Exp $
--- libltdl/ltmain.sh.orig	Sun Sep 19 08:34:44 2004
+++ libltdl/ltmain.sh	Sat Dec 18 17:00:07 2004
@@@@ -1950,6 +1950,17 @@@@ EOF
d34 1
a34 12
@@@@ -1985,10 +1996,6 @@@@ EOF
 	    $echo "$modename: warning: \`-l' is ignored for archives/objects" 1>&2
 	    continue
 	  fi
-	  if test "$pass" = conv; then
-	    deplibs="$deplib $deplibs"
-	    continue
-	  fi
 	  name=`$echo "X$deplib" | $Xsed -e 's/^-l//'`
 	  for searchdir in $newlib_search_path $lib_search_path $sys_lib_search_path $shlib_search_path; do
 	    for search_ext in .la $std_shrext .so .a; do
@@@@ -2213,20 +2220,20 @@@@ EOF
d65 1
a65 1
@@@@ -2611,7 +2618,7 @@@@ EOF
d74 19
a92 1
@@@@ -5804,40 +5811,6 @@@@ relink_command=\"$relink_command\""
@


1.5
log
@When linking an installed libtool library on the command line
using -lfoo we need to find the library in the search paths
and add it's dependency_libs to the link in the conv pass so
that any libtool libs listed are correctly expanded in the
link pass.

From libtool CVS
@
text
@d1 1
a1 1
$OpenBSD: patch-libltdl_ltmain_sh,v 1.4 2004/08/07 21:55:26 brad Exp $
d3 20
a22 2
+++ libltdl/ltmain.sh	Sat Dec 18 16:33:27 2004
@@@@ -1985,10 +1985,6 @@@@ EOF
d33 32
a64 1
@@@@ -2611,7 +2607,7 @@@@ EOF
d73 1
a73 1
@@@@ -5804,40 +5800,6 @@@@ relink_command=\"$relink_command\""
@


1.4
log
@upgrade to libtool 1.5.8
@
text
@d1 15
a15 4
$OpenBSD: patch-libltdl_ltmain_sh,v 1.3 2004/08/05 18:04:55 brad Exp $
--- libltdl/ltmain.sh.orig	Sat Aug  7 08:12:06 2004
+++ libltdl/ltmain.sh	Sat Aug  7 17:00:48 2004
@@@@ -2611,7 +2611,7 @@@@ EOF
d24 1
a24 1
@@@@ -5804,40 +5804,6 @@@@ relink_command=\"$relink_command\""
@


1.3
log
@I'm not sure if this is the end of all the relink issues
but this is definitely an improvement on the workaround
currently in place at the moment.

From: Jacob Meuser <jakemsr at jakemsr dot com>
@
text
@d1 4
a4 26
$OpenBSD: patch-libltdl_ltmain_sh,v 1.2 2004/08/02 15:43:11 brad Exp $
--- libltdl/ltmain.sh.orig	Sun Apr 11 01:44:45 2004
+++ libltdl/ltmain.sh	Tue Aug  3 21:59:58 2004
@@@@ -2151,10 +2151,17 @@@@ EOF
 	    absdir="$libdir"
 	  fi
 	else
-	  dir="$ladir/$objdir"
-	  absdir="$abs_ladir/$objdir"
-	  # Remove this search path later
-	  notinst_path="$notinst_path $abs_ladir"
+	  if test ! -f "$ladir/$objdir/$linklib" && test -f "$abs_ladir/$linklib"; then
+	    dir="$ladir"
+	    absdir="$abs_ladir"
+	    # Remove this search path later
+	    notinst_path="$notinst_path $abs_ladir"
+	  else
+	    dir="$ladir/$objdir"
+	    absdir="$abs_ladir/$objdir"
+	    # Remove this search path later
+	    notinst_path="$notinst_path $abs_ladir"
+	  fi
 	fi # $installed = yes
 	name=`$echo "X$laname" | $Xsed -e 's/\.la$//' -e 's/^lib//'`
 
@@@@ -2468,7 +2475,7 @@@@ EOF
d13 1
a13 1
@@@@ -5824,40 +5831,6 @@@@ relink_command=\"$relink_command\""
@


1.2
log
@ltmain.in: Fix problem with .libs/.libs/libfoo.so appearing on the link line

From: libtool CVS
@
text
@d1 1
a1 1
$OpenBSD: patch-libltdl_ltmain_sh,v 1.1 2004/07/11 19:22:05 brad Exp $
d3 1
a3 1
+++ libltdl/ltmain.sh	Mon Aug  2 11:39:48 2004
d26 10
a35 9
@@@@ -2273,7 +2280,6 @@@@ EOF
 	   { test "$prefer_static_libs" = no || test -z "$old_library"; }; then
 	  if test "$installed" = no; then
 	    notinst_deplibs="$notinst_deplibs $lib"
-	    need_relink=yes
 	  fi
 	  # This is a shared library
 
@@@@ -5824,40 +5830,6 @@@@ relink_command=\"$relink_command\""
@


1.1
log
@until I can figure out this total gayness with libtool relinking
improperly then I'll just put the usual workaround in place.
@
text
@d1 26
a26 4
$OpenBSD$
--- libltdl/ltmain.sh.orig	Sun Jul 11 15:15:25 2004
+++ libltdl/ltmain.sh	Sun Jul 11 15:16:12 2004
@@@@ -2273,7 +2273,6 @@@@ EOF
d34 1
a34 1
@@@@ -5824,40 +5823,6 @@@@ relink_command=\"$relink_command\""
@

