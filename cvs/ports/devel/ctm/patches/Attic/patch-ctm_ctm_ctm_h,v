head	1.3;
access;
symbols
	OPENBSD_5_6:1.2.0.28
	OPENBSD_5_6_BASE:1.2
	OPENBSD_5_5:1.2.0.26
	OPENBSD_5_5_BASE:1.2
	OPENBSD_5_4:1.2.0.24
	OPENBSD_5_4_BASE:1.2
	OPENBSD_5_3:1.2.0.22
	OPENBSD_5_3_BASE:1.2
	OPENBSD_5_2:1.2.0.20
	OPENBSD_5_2_BASE:1.2
	OPENBSD_5_1_BASE:1.2
	OPENBSD_5_1:1.2.0.18
	OPENBSD_5_0:1.2.0.16
	OPENBSD_5_0_BASE:1.2
	OPENBSD_4_9:1.2.0.14
	OPENBSD_4_9_BASE:1.2
	OPENBSD_4_8:1.2.0.12
	OPENBSD_4_8_BASE:1.2
	OPENBSD_4_7:1.2.0.10
	OPENBSD_4_7_BASE:1.2
	OPENBSD_4_6:1.2.0.8
	OPENBSD_4_6_BASE:1.2
	OPENBSD_4_5:1.2.0.6
	OPENBSD_4_5_BASE:1.2
	OPENBSD_4_4:1.2.0.4
	OPENBSD_4_4_BASE:1.2
	OPENBSD_4_3:1.2.0.2
	OPENBSD_4_3_BASE:1.2;
locks; strict;
comment	@# @;


1.3
date	2014.09.06.11.53.05;	author armani;	state dead;
branches;
next	1.2;
commitid	804NIyitZbqZa72q;

1.2
date	2007.10.31.23.14.46;	author ajacoutot;	state Exp;
branches;
next	1.1;

1.1
date	2007.10.26.20.44.35;	author ajacoutot;	state Exp;
branches;
next	;


desc
@@


1.3
log
@Remove devel/ctm, openbsd.org/ctm.html was removed 5 years ago and upstream seems to not exist anymore

"you can nuke it" espie@@, ok jca@@
@
text
@$OpenBSD: patch-ctm_ctm_ctm_h,v 1.2 2007/10/31 23:14:46 ajacoutot Exp $
--- ctm/ctm/ctm.h.orig	Wed May  1 01:01:43 1996
+++ ctm/ctm/ctm.h	Wed Oct 31 23:35:36 2007
@@@@ -10,24 +10,27 @@@@
  *
  */
 
+#include <ctype.h>
+#include <err.h>
+#include <errno.h>
 #include <stdio.h>
 #include <stdlib.h>
-#include <unistd.h>
-#include <md5.h>
-#include <ctype.h>
 #include <string.h>
-#include <errno.h>
 #include <time.h>
+#include <unistd.h>
+#include <md5.h>
+#include <regex.h>
 #include <sys/types.h>
 #include <sys/stat.h>
 #include <sys/file.h>
 #include <sys/time.h>
 
 #define VERSION "2.0"
-#define MAXSIZE (1024*1024*10)
+#define MAXSIZE (1024*1024*100)
 
 #define SUBSUFF ".ctm"
 #define TMPSUFF ".ctmtmp"
+#define TARCMD  "tar -rf %s -T -"
 
 /* The fields... */
 #define CTM_F_MASK		0xff
@@@@ -51,12 +54,21 @@@@
 #define CTM_Q_MD5_Force		0x0800
 
 struct CTM_Syntax {
-    char	*Key;
-    int		*List;
+    char	*Key;		/* CTM key for operation */
+    int		*List;		/* List of operations */
     };
 
 extern struct CTM_Syntax Syntax[];
 
+struct CTM_Filter {
+    struct CTM_Filter	*Next;	/* next filter in the list */
+    int 		Action;	/* enable or disable */
+    regex_t 		CompiledRegex;	/* compiled regex */
+};
+
+#define	CTM_FILTER_DISABLE	0
+#define	CTM_FILTER_ENABLE	1
+
 #define Malloc malloc
 #define Free free
 #define Delete(foo) if (!foo) ; else {Free(foo); foo = 0; }
@@@@ -74,6 +86,8 @@@@ EXTERN u_char *FileName;
 EXTERN u_char *TmpDir;
 EXTERN u_char *CatPtr;
 EXTERN u_char *Buffer;
+EXTERN u_char *BackupFile;
+EXTERN u_char *TarCmd;
 
 /*
  * Paranoid -- Just in case they should be after us...
@@@@ -106,8 +120,12 @@@@ EXTERN int Verbose;
 EXTERN int Exit;
 EXTERN int Force;
 EXTERN int CheckIt;
+EXTERN int KeepIt;
+EXTERN int ListIt;
 EXTERN int SetTime;
 EXTERN struct timeval Times[2];
+EXTERN struct CTM_Filter	*FilterList;
+EXTERN struct CTM_Filter	*LastFilter;
 
 #define Exit_OK		0
 #define Exit_Garbage	1
@@@@ -118,6 +136,7 @@@@ EXTERN struct timeval Times[2];
 #define Exit_Mess	32
 #define Exit_Done	64
 #define Exit_Version	128
+#define Exit_NoMatch	256
 
 void Fatal_(int ln, char *fn, char *kind);
 #define Fatal(foo) Fatal_(__LINE__,__FILE__,foo)
@@@@ -139,6 +158,7 @@@@ u_char * Fdata(FILE *fd, int u_chars, MD5_CTX *ctx);
 
 int Pass1(FILE *fd, unsigned applied);
 int Pass2(FILE *fd);
+int PassB(FILE *fd);
 int Pass3(FILE *fd);
 
 int ctm_edit(u_char *script, int length, char *filein, char *fileout);
@


1.2
log
@- remove CVS keywords from patches

noticed by kurt@@
ok kili@@
@
text
@d1 1
a1 1
$OpenBSD$
@


1.1
log
@- use our naming scheme for patches
@
text
@d2 23
a24 3
--- ctm/ctm/ctm.h.orig	Fri Oct 26 22:39:59 2007
+++ ctm/ctm/ctm.h	Fri Oct 26 22:40:01 2007
@@@@ -26,7 +26,7 @@@@
d33 66
@

