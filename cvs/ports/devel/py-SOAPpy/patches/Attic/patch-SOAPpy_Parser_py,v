head	1.1;
access;
symbols
	OPENBSD_5_5:1.1.0.2;
locks; strict;
comment	@# @;


1.1
date	2014.06.23.12.34.15;	author jasper;	state dead;
branches
	1.1.2.1;
next	;
commitid	DzRPl2iCSGEi2TFH;

1.1.2.1
date	2014.06.23.12.34.15;	author jasper;	state Exp;
branches;
next	;
commitid	DzRPl2iCSGEi2TFH;


desc
@@


1.1
log
@file patch-SOAPpy_Parser_py was initially added on branch OPENBSD_5_5.
@
text
@@


1.1.2.1
log
@Security fix for CVE-2014-3242, SOAPpy: XML External Entity (XXE) flaw
@
text
@a0 75
$OpenBSD$

Security fix for CVE-2014-3242,
SOAPpy: XML External Entity (XXE) flaw

https://github.com/kiorky/SOAPpy/commit/a38656817c8ce7d02e117b1308328419a5d1560f

*** SOAPpy/Parser.py.orig	Sat Jan 31 05:20:05 2004
--- SOAPpy/Parser.py	Tue Jun 24 00:18:30 2014
***************
*** 1,2 ****
--- 1,3 ----
  # SOAPpy modules
+ import traceback
  from Config    import Config
***************
*** 10,11 ****
--- 11,16 ----
  from wstools.XMLname import fromXMLname
+ try:
+     from cStringIO import StringIO
+ except ImportError:
+     from StringIO import StringIO
  
***************
*** 965,972 ****
  ################################################################################
! def _parseSOAP(xml_str, rules = None):
!     try:
!         from cStringIO import StringIO
!     except ImportError:
!         from StringIO import StringIO
  
      parser = xml.sax.make_parser()
--- 970,979 ----
  ################################################################################
! class EmptyEntityResolver(xml.sax.handler.EntityResolver):
!     def resolveEntity(self, publicId, systemId):
!         return StringIO("<?xml version='1.0' encoding='UTF-8'?>")
  
+ def _parseSOAP(xml_str, rules = None, ignore_ext=None):
+     if ignore_ext is None:
+         ignore_ext = False
+ 
      parser = xml.sax.make_parser()
***************
*** 980,981 ****
--- 987,992 ----
  
+     # disable by default  entity loading on posted content
+     if ignore_ext:
+         parser.setEntityResolver(EmptyEntityResolver())
+ 
      # turn on namespace mangeling
***************
*** 987,988 ****
--- 998,1000 ----
          parser._parser = None
+         print traceback.format_exc()
          raise e
***************
*** 1002,1007 ****
  
! def parseSOAPRPC(xml_str, header = 0, body = 0, attrs = 0, rules = None):
                   #config=Config, unwrap_outer=1):
  
!     t = _parseSOAP(xml_str, rules = rules)
      p = t.body[0]
--- 1014,1019 ----
  
! def parseSOAPRPC(xml_str, header = 0, body = 0, attrs = 0, rules = None, ignore_ext=None):
                   #config=Config, unwrap_outer=1):
  
!     t = _parseSOAP(xml_str, rules = rules, ignore_ext=ignore_ext)
      p = t.body[0]
@

