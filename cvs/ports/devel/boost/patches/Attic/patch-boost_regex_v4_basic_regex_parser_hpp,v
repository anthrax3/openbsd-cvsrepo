head	1.2;
access;
symbols
	OPENBSD_4_7:1.1.0.8
	OPENBSD_4_7_BASE:1.1
	OPENBSD_4_6:1.1.0.6
	OPENBSD_4_6_BASE:1.1
	OPENBSD_4_5:1.1.0.4
	OPENBSD_4_5_BASE:1.1
	OPENBSD_4_4:1.1.0.2
	OPENBSD_4_4_BASE:1.1;
locks; strict;
comment	@# @;


1.2
date	2010.03.30.11.00.15;	author robert;	state dead;
branches;
next	1.1;

1.1
date	2008.05.27.00.52.01;	author deanna;	state Exp;
branches;
next	;


desc
@@


1.2
log
@Udpate to 1.41.0; original diff from Markus Hennecke
@
text
@$OpenBSD: patch-boost_regex_v4_basic_regex_parser_hpp,v 1.1 2008/05/27 00:52:01 deanna Exp $
--- boost/regex/v4/basic_regex_parser.hpp.orig	Wed Dec 20 12:19:05 2006
+++ boost/regex/v4/basic_regex_parser.hpp	Sun May 25 21:59:07 2008
@@@@ -777,6 +777,7 @@@@ bool basic_regex_parser<charT, traits>::parse_repeat(s
       case syntax_element_restart_continue:
       case syntax_element_jump:
       case syntax_element_startmark:
+      case syntax_element_backstep:
          // can't legally repeat any of the above:
          fail(regex_constants::error_badrepeat, m_position - m_base);
          return false;
@@@@ -1862,6 +1863,7 @@@@ bool basic_regex_parser<charT, traits>::parse_perl_ext
    if(markid == -4)
    {
       re_syntax_base* b = this->getaddress(expected_alt_point);
+      // Make sure we have exactly one alternative following this state:
       if(b->type != syntax_element_alt)
       {
          re_alt* alt = static_cast<re_alt*>(this->insert_state(expected_alt_point, syntax_element_alt, sizeof(re_alt)));
@@@@ -1870,6 +1872,15 @@@@ bool basic_regex_parser<charT, traits>::parse_perl_ext
       else if(this->getaddress(static_cast<re_alt*>(b)->alt.i, b)->type == syntax_element_alt)
       {
          fail(regex_constants::error_bad_pattern, m_position - m_base);
+         return false;
+      }
+      // check for invalid repetition of next state:
+      b = this->getaddress(expected_alt_point);
+      b = this->getaddress(static_cast<re_alt*>(b)->next.i, b);
+      if((b->type != syntax_element_assert_backref)
+         && (b->type != syntax_element_startmark))
+      {
+         fail(regex_constants::error_badrepeat, m_position - m_base);
          return false;
       }
    }
@


1.1
log
@Security - add fix from boost svn for CVE-2008-0171:

"regex/v4/perl_matcher_non_recursive.hpp in the Boost regex library
(aka Boost.Regex) in Boost 1.33 and 1.34 allows context-dependent
attackers to cause a denial of service (failed assertion and crash)
via an invalid regular expression."

ok naddy@@
@
text
@d1 1
a1 1
$OpenBSD$
@

