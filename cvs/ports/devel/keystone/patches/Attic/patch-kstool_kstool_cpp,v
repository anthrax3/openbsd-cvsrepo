head	1.2;
access;
symbols
	OPENBSD_6_0:1.1.1.1.0.2
	OPENBSD_6_0_BASE:1.1.1.1
	rpointel_20160615:1.1.1.1
	rpointel:1.1.1;
locks; strict;
comment	@# @;


1.2
date	2016.08.03.11.14.16;	author benoit;	state dead;
branches;
next	1.1;
commitid	Xilp69Qmq1iccLIw;

1.1
date	2016.06.15.19.22.31;	author rpointel;	state Exp;
branches
	1.1.1.1;
next	;
commitid	2w4nbxGsB9rZlBAy;

1.1.1.1
date	2016.06.15.19.22.31;	author rpointel;	state Exp;
branches;
next	;
commitid	2w4nbxGsB9rZlBAy;


desc
@@


1.2
log
@Update to keystone-0.9.1.

from Frederic Cambus (maintainer)
@
text
@$OpenBSD: patch-kstool_kstool_cpp,v 1.1 2016/06/15 19:22:31 rpointel Exp $
--- kstool/kstool.cpp.orig	Sun Jun  5 23:49:29 2016
+++ kstool/kstool.cpp	Sun Jun  5 23:49:45 2016
@@@@ -68,6 +68,8 @@@@ static void usage(char *prog)
     if (ks_arch_supported(KS_ARCH_SYSTEMZ)) {
         printf("        systemz:   SystemZ (S390x)\n");
     }
+
+    printf("\n");
 }
 
 int main(int argc, char **argv)
@@@@ -85,7 +87,7 @@@@ int main(int argc, char **argv)
         mode = argv[1];
 
         int flags;
-        if (-1 == (flags = fcntl(STDIN_FILENO, F_GETFL, 0)))
+        if ((flags = fcntl(STDIN_FILENO, F_GETFL, 0)) == -1)
             flags = 0;
 
         fcntl(STDIN_FILENO, F_SETFL, flags | O_NONBLOCK);
@@@@ -93,7 +95,7 @@@@ int main(int argc, char **argv)
         size_t index = 0;
 
         char buf[1024];
-        while( fgets(buf, sizeof(buf), stdin) ) {
+        while(fgets(buf, sizeof(buf), stdin)) {
             input = (char*)realloc(assembly, index + strlen(buf));
             if (!input) {
                 printf("Failed to allocate memory.");
@@@@ -104,7 +106,13 @@@@ int main(int argc, char **argv)
             index += strlen(buf);
         }
 
+        fcntl(STDIN_FILENO, F_SETFL, flags);
+
         assembly = input;
+        if (!assembly) {
+            usage(argv[0]);
+            return -1;
+        }
     } else if (argc == 3) {
 #else
     if (argc == 3) {
@


1.1
log
@Initial revision
@
text
@d1 1
a1 1
$OpenBSD$
@


1.1.1.1
log
@import keystone, a lightweight multi-platform, multi-architecture assembler
framework.
From Frederic Cambus fred[at]statdns[.]com (maintainer).
ok benoit@@

@
text
@@
