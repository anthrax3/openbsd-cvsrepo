head	1.54;
access;
symbols
	OPENBSD_5_6:1.53.0.4
	OPENBSD_5_6_BASE:1.53
	OPENBSD_5_5:1.53.0.2
	OPENBSD_5_5_BASE:1.53
	OPENBSD_5_4:1.47.0.2
	OPENBSD_5_4_BASE:1.47
	OPENBSD_5_3:1.43.0.2
	OPENBSD_5_3_BASE:1.43
	OPENBSD_5_2:1.31.0.2
	OPENBSD_5_2_BASE:1.31
	OPENBSD_5_1_BASE:1.28
	OPENBSD_5_1:1.28.0.2
	OPENBSD_5_0:1.22.0.2
	OPENBSD_5_0_BASE:1.22
	OPENBSD_4_9:1.21.0.2
	OPENBSD_4_9_BASE:1.21
	OPENBSD_4_8:1.16.0.2
	OPENBSD_4_8_BASE:1.16
	OPENBSD_4_7:1.15.0.2
	OPENBSD_4_7_BASE:1.15
	OPENBSD_4_6:1.13.0.2
	OPENBSD_4_6_BASE:1.13
	OPENBSD_4_5:1.11.0.2
	OPENBSD_4_5_BASE:1.11
	OPENBSD_4_4:1.5.0.2
	OPENBSD_4_4_BASE:1.5
	OPENBSD_4_3:1.2.0.2
	OPENBSD_4_3_BASE:1.2
	kurt_20071118:1.1.1.1
	kurt:1.1.1;
locks; strict;
comment	@# @;


1.54
date	2014.11.20.23.14.57;	author kurt;	state dead;
branches;
next	1.53;
commitid	OqMxfbqOene3RIIF;

1.53
date	2014.01.11.22.37.44;	author sthen;	state Exp;
branches;
next	1.52;

1.52
date	2014.01.09.09.59.55;	author sthen;	state Exp;
branches;
next	1.51;

1.51
date	2013.12.30.23.21.41;	author sthen;	state Exp;
branches;
next	1.50;

1.50
date	2013.11.25.14.16.22;	author sthen;	state Exp;
branches;
next	1.49;

1.49
date	2013.10.16.14.12.21;	author bluhm;	state Exp;
branches;
next	1.48;

1.48
date	2013.08.22.16.21.17;	author sthen;	state Exp;
branches;
next	1.47;

1.47
date	2013.04.15.03.01.06;	author kurt;	state Exp;
branches;
next	1.46;

1.46
date	2013.04.10.02.47.10;	author kurt;	state Exp;
branches;
next	1.45;

1.45
date	2013.03.19.19.26.45;	author kurt;	state Exp;
branches;
next	1.44;

1.44
date	2013.03.11.10.50.09;	author espie;	state Exp;
branches;
next	1.43;

1.43
date	2013.02.13.18.13.12;	author sthen;	state Exp;
branches;
next	1.42;

1.42
date	2013.02.09.14.49.50;	author sthen;	state Exp;
branches;
next	1.41;

1.41
date	2013.02.07.19.06.55;	author kurt;	state Exp;
branches;
next	1.40;

1.40
date	2013.02.03.21.03.39;	author kurt;	state Exp;
branches;
next	1.39;

1.39
date	2013.02.02.17.41.18;	author kurt;	state Exp;
branches;
next	1.38;

1.38
date	2013.02.01.15.34.35;	author kurt;	state Exp;
branches;
next	1.37;

1.37
date	2013.01.27.20.10.10;	author kurt;	state Exp;
branches;
next	1.36;

1.36
date	2012.10.24.18.44.51;	author kurt;	state Exp;
branches;
next	1.35;

1.35
date	2012.10.19.22.29.49;	author kurt;	state Exp;
branches;
next	1.34;

1.34
date	2012.09.27.21.49.58;	author naddy;	state Exp;
branches;
next	1.33;

1.33
date	2012.09.26.18.23.04;	author naddy;	state Exp;
branches;
next	1.32;

1.32
date	2012.08.04.15.06.55;	author ajacoutot;	state Exp;
branches;
next	1.31;

1.31
date	2012.05.28.13.53.18;	author fgsch;	state Exp;
branches;
next	1.30;

1.30
date	2012.03.22.18.53.15;	author kurt;	state Exp;
branches;
next	1.29;

1.29
date	2012.03.20.16.57.58;	author kurt;	state Exp;
branches;
next	1.28;

1.28
date	2011.11.01.09.32.34;	author jasper;	state Exp;
branches;
next	1.27;

1.27
date	2011.10.21.16.23.45;	author espie;	state Exp;
branches;
next	1.26;

1.26
date	2011.10.10.00.44.07;	author kurt;	state Exp;
branches;
next	1.25;

1.25
date	2011.10.08.14.13.44;	author kurt;	state Exp;
branches;
next	1.24;

1.24
date	2011.10.07.02.04.12;	author kurt;	state Exp;
branches;
next	1.23;

1.23
date	2011.10.02.13.31.03;	author ajacoutot;	state Exp;
branches;
next	1.22;

1.22
date	2011.04.09.00.38.09;	author ian;	state Exp;
branches;
next	1.21;

1.21
date	2011.02.05.23.11.18;	author ian;	state Exp;
branches;
next	1.20;

1.20
date	2010.11.27.11.54.53;	author espie;	state Exp;
branches;
next	1.19;

1.19
date	2010.11.15.19.45.59;	author espie;	state Exp;
branches;
next	1.18;

1.18
date	2010.10.24.21.10.57;	author ajacoutot;	state Exp;
branches;
next	1.17;

1.17
date	2010.10.18.17.47.53;	author espie;	state Exp;
branches;
next	1.16;

1.16
date	2010.07.02.01.43.12;	author jakemsr;	state Exp;
branches;
next	1.15;

1.15
date	2010.02.05.13.10.31;	author kurt;	state Exp;
branches;
next	1.14;

1.14
date	2009.08.10.06.31.07;	author kili;	state Exp;
branches;
next	1.13;

1.13
date	2009.05.15.17.41.04;	author kurt;	state Exp;
branches;
next	1.12;

1.12
date	2009.03.15.09.25.04;	author espie;	state Exp;
branches;
next	1.11;

1.11
date	2009.03.01.20.43.09;	author naddy;	state Exp;
branches;
next	1.10;

1.10
date	2009.01.07.13.34.21;	author kurt;	state Exp;
branches;
next	1.9;

1.9
date	2008.12.22.13.16.56;	author kurt;	state Exp;
branches;
next	1.8;

1.8
date	2008.12.21.03.59.44;	author kurt;	state Exp;
branches;
next	1.7;

1.7
date	2008.11.18.01.51.59;	author sthen;	state Exp;
branches;
next	1.6;

1.6
date	2008.10.22.16.02.24;	author kurt;	state Exp;
branches;
next	1.5;

1.5
date	2008.06.30.20.16.37;	author naddy;	state Exp;
branches;
next	1.4;

1.4
date	2008.06.28.12.34.58;	author kurt;	state Exp;
branches;
next	1.3;

1.3
date	2008.03.17.03.28.26;	author kurt;	state Exp;
branches;
next	1.2;

1.2
date	2008.01.18.16.08.05;	author kurt;	state Exp;
branches;
next	1.1;

1.1
date	2007.11.19.03.19.43;	author kurt;	state Exp;
branches
	1.1.1.1;
next	;

1.1.1.1
date	2007.11.19.03.19.43;	author kurt;	state Exp;
branches;
next	;


desc
@@


1.54
log
@Remove 1.6 from cvs. It was unlinked last release. okay sthen@@
@
text
@# $OpenBSD: Makefile,v 1.53 2014/01/11 22:37:44 sthen Exp $

SHARED_ONLY=	Yes
ONLY_FOR_ARCHS=	amd64 i386

BROKEN-i386=	guarantee(get_thread() == thread) failed: must be the same thread, quickly
# XXX if fixed, re-add i386 to ONLY_FOR_ARCHS-java in databases/db/Makefile.inc
# XXX and remove the block that changes editors/libreoffice default flavour

COMMENT-main=	Java2(TM) SE Dev Kit v${VERSION}
COMMENT-jre=	Java2(TM) SE Runtime Environment v${VERSION}
VERSION=	1.6.0.${UPDATE}
UPDATE=		32
BUILD=		b27
PKGNAME=	jdk-${VERSION}
PKGNAME-main=	jdk-${VERSION}
REVISION-main=	6
PKGNAME-jre=	jre-${VERSION}
REVISION-jre=	6

# see jaxp/jaxp.properties & jaxws/jaxws.properties 
# in ${WRKDIR} for names and download locations of extra distfiles

JDK_SRC=	openjdk-6-src-${BUILD}-26_oct_2012.tar.gz
PATCH_SET=	openjdk-6u${UPDATE}-patch-set-20130113.zip
PAXP_SRC=	jaxp144_04.zip
JAXWS_SRC=	jdk6-jaxws2_1_6-2011_06_13.zip
JAF_SRC=	jdk6-jaf-b20.zip

DISTFILES=	${JDK_SRC} ${PATCH_SET}:1 ${PAXP_SRC}:2 ${JAXWS_SRC}:3 ${JAF_SRC}:4
EXTRACT_ONLY=	${JDK_SRC} ${PATCH_SET}
DIST_SUBDIR=	jdk

CATEGORIES=	devel/jdk java

MULTI_PACKAGES=	-main -jre

FLAVORS=	with_ipv6
PSEUDO_FLAVORS=	native_bootstrap
FLAVOR?=

HOMEPAGE=	http://openjdk.java.net/

MASTER_SITES=	http://download.java.net/openjdk/jdk6/promoted/${BUILD}/ \
		http://openbsd.dead-parrot.de/distfiles/ \
		http://distfiles.nl/
MASTER_SITES1=	http://www.intricatesoftware.com/distfiles/ \
		http://openbsd.dead-parrot.de/distfiles/ \
		http://distfiles.nl/
MASTER_SITES2=  http://download.java.net/jaxp/openjdk/jdk6/ \
		http://icedtea.classpath.org/download/drops/ \
		http://openbsd.dead-parrot.de/distfiles/ \
		http://distfiles.nl/
MASTER_SITES3=  http://download.java.net/glassfish/components/jax-ws/openjdk/jdk6/ \
		http://icedtea.classpath.org/download/drops/ \
		http://openbsd.dead-parrot.de/distfiles/ \
		http://distfiles.nl/
MASTER_SITES4=  https://java.net/downloads/jax-ws/OpenJDK6/ \
		http://icedtea.classpath.org/download/drops/ \
		http://openbsd.dead-parrot.de/distfiles/ \
		http://distfiles.nl/
MASTER_SITES5=	${MASTER_SITE_APACHE:=ant/binaries/} \
		http://archive.apache.org/dist/ant/binaries/
MASTER_SITES6=	http://spacehopper.org/mirrors/

MAINTAINER=	Kurt Miller <kurt@@openbsd.org>

# GPLv2 w/CLASSPATH exception
PERMIT_PACKAGE_CDROM=	Yes

USE_GROFF=	Yes
NO_TEST=	Yes

BUILD_DEPENDS=	archivers/zip \
		archivers/unzip \
		print/cups,-libs \
		x11/openmotif
MODULES=	converters/libiconv
WANTLIB=	X11 Xext Xi Xtst c freetype m pthread sndio stdc++ z

APACHE_ANT=	apache-ant-1.8.4-bin.tar.gz
SUPDISTFILES+=	openjdk6-bootjdk-amd64-20130822.tar.gz:6 \
		openjdk6-bootjdk-i386-20130822.tar.gz:6 \
		${APACHE_ANT}:5

.if ${FLAVOR:Mnative_bootstrap}
INSTALLED!= (pkg_info -e "jdk->=1.6,<1.7" -q && echo yes) || echo no
.if ${INSTALLED:L} != "yes"
ERRORS += "Fatal: This flavor requires an installed 1.6 jdk package"
.endif
BUILD_DEPENDS+=	jdk->=1.6,<1.7:devel/jdk/1.6 \
		devel/apache-ant>=1.8.2
ALT_BOOTDIR=	${LOCALBASE}/${JDKHOME}
.else
BOOT_JDK=	openjdk6-bootjdk-${ARCH}-20130822.tar.gz
.include <bsd.port.arch.mk>
.if (${ARCH}==amd64) || (${ARCH}==i386)
DISTFILES+=	${BOOT_JDK}:6
.endif
DISTFILES+=	${APACHE_ANT}:5
EXTRACT_ONLY+=	${BOOT_JDK} ${APACHE_ANT}
MAKE_ENV+=	ANT_HOME=${WRKDIST}/apache-ant-1.8.4 \
		LD_LIBRARY_PATH=${WRKDIST}/bootjdk-libs
ALT_BOOTDIR=	${WRKDIST}/bootjdk
.endif

USE_GMAKE=	Yes

DPB_PROPERTIES=	parallel

# Don't call make -jN, instead pass MAKE_JOBS to HOTSPOT_BUILD_JOBS
PARALLEL_BUILD=	No

# Allow HOTSPOT_BUILD_JOBS to be overridden
HOTSPOT_BUILD_JOBS?= ${MAKE_JOBS}

MAKE_ENV+=	ALT_BOOTDIR=${ALT_BOOTDIR} \
		ALT_FREETYPE_HEADERS_PATH=${X11BASE}/include \
		ALT_FREETYPE_LIB_PATH=${X11BASE}/lib \
		ALT_MOTIF_DIR="${LOCALBASE}" \
		ALT_DROPS_DIR=${FULLDISTDIR} \
		ALT_PACKAGE_PATH=${LOCALBASE} \
		ALT_X11_PATH=${X11BASE} \
		ALT_CACERTS_FILE=${FILESDIR}/cacerts \
		SKIP_FASTDEBUG_BUILD=true \
		NO_DOCS=true \
		MILESTONE=fcs \
		BUILD_NUMBER=${BUILD} \
		JDK_UPDATE_VERSION=${UPDATE} \
		CC="${CC}" \
		CXX="${CXX}" \
		DEFAULT_LIBPATH="/usr/lib:${X11BASE}/lib:${LOCALBASE}/lib" \
		USER="${USER}" \
		WARNINGS_ARE_ERRORS="" \
		HOTSPOT_BUILD_JOBS=${HOTSPOT_BUILD_JOBS}

.if !${FLAVOR:Mwith_ipv6}
MAKE_ENV+=	DONT_ENABLE_IPV6=YES
.endif

JDKHOME=	jdk-1.6.0
JREHOME=	jre-1.6.0

SUBST_VARS=	JDKHOME JREHOME

.if ${MACHINE_ARCH} == "i386"
PKG_ARGS+=	-Dclient_vm=1
.else
PKG_ARGS+=	-Dclient_vm=0
.endif

# Deal with Sun's internal build structure
WRKDIST=	${WRKDIR}
OUTPUTDIR=	${WRKDIR}/build/bsd-${MACHINE_ARCH:S/i386/i586/}
JDKIMAGEDIR=	${OUTPUTDIR}/j2sdk-image
JREIMAGEDIR=	${OUTPUTDIR}/j2re-image

COPYDIRS=	hotspot/agent/src/os/linux \
		hotspot/agent/src/share/classes/sun/jvm/hotspot/debugger/linux \
		hotspot/agent/src/share/classes/sun/jvm/hotspot/debugger/linux/amd64 \
		hotspot/agent/src/share/classes/sun/jvm/hotspot/debugger/linux/x86 \
		hotspot/agent/src/share/classes/sun/jvm/hotspot/runtime/linux \
		hotspot/agent/src/share/classes/sun/jvm/hotspot/runtime/linux_amd64 \
		hotspot/agent/src/share/classes/sun/jvm/hotspot/runtime/linux_x86 \
		hotspot/src/os/linux/vm \
		hotspot/src/os_cpu/linux_x86/vm \
		hotspot/src/os_cpu/linux_zero/vm \
		hotspot/make/linux \
		hotspot/make/linux/makefiles \
		jdk/src/linux/doc/man \
		jdk/src/linux/doc/man/ja

COPYFILES=	hotspot/agent/src/share/classes/sun/jvm/hotspot/LinuxVtblAccess.java \
		corba/make/common/Defs-linux.gmk \
		corba/make/common/shared/Defs-linux.gmk \
		jdk/make/com/sun/tools/attach/mapfile-linux \
		jdk/make/common/Defs-linux.gmk \
		jdk/make/common/shared/Defs-linux.gmk \
		jdk/make/java/nio/mapfile-linux \
		jdk/make/netbeans/common/architectures/name-Linux.properties \
		jdk/make/sun/awt/mapfile-vers-linux \
		jdk/make/tools/sharing/classlist.linux \
		jdk/src/solaris/classes/java/lang/UNIXProcess.java.linux \
		jdk/src/solaris/classes/sun/awt/fontconfigs/linux.fontconfig.properties \
		jdk/src/solaris/classes/sun/tools/attach/LinuxAttachProvider.java \
		jdk/src/solaris/classes/sun/tools/attach/LinuxVirtualMachine.java \
		jdk/src/solaris/hpi/include/largefile_linux.h \
		jdk/src/solaris/native/java/net/linux_close.c \
		jdk/src/solaris/native/sun/tools/attach/LinuxVirtualMachine.c

# create initial bsd src from linux src (except for threads_solaris.c)
post-extract:
	@@for d in ${COPYDIRS}; do \
		mkdir -p `echo ${WRKDIST}/$$d | sed 's/linux/bsd/g;'`; \
		cd ${WRKDIST}/$$d; \
		for f in *; do \
			if [ -f $$f ]; then \
				t=`echo ${WRKDIST}/$$d/$$f | sed 's/linux/bsd/g; s/Linux/Bsd/g'`; \
				sed 's/linux/bsd/g; s/Linux/Bsd/g' < $$f > $$t; \
			fi; \
		done; \
	done
	@@for f in ${COPYFILES}; do \
		t=`echo $$f | sed 's/linux/bsd/g; s/Linux/Bsd/g'`; \
		sed 's/linux/bsd/g; s/Linux/Bsd/g' < ${WRKDIST}/$$f > ${WRKDIST}/$$t; \
	done
	@@sed 's/solaris/bsd/g; s/Solaris/Bsd/g' \
		< ${WRKDIST}/jdk/src/solaris/hpi/native_threads/src/threads_solaris.c \
		> ${WRKDIST}/jdk/src/solaris/hpi/native_threads/src/threads_bsd.c
	@@cp ${FILESDIR}/PLATFORM_API_BSDOS_PCM.c \
		${WRKDIR}/jdk/src/solaris/native/com/sun/media/sound
	@@perl -pi -e 's|build-policy install-limited|build-policy install-unlimited|' \
		${WRKDIST}/jdk/make/javax/crypto/Makefile

pre-patch:
	@@cd ${WRKDIR} &&  \
		${PATCH} -p0 -z .orig.u${UPDATE} --quiet < ${WRKDIR}/${PATCH_SET:R}

post-build:
	@@rm -rf ${JDKIMAGEDIR}/man/ja ${JREIMAGEDIR}/man/ja

do-install:
	${INSTALL_DATA_DIR} ${PREFIX}/${JDKHOME}
	cd ${JDKIMAGEDIR} && tar -cf - * | tar -C ${PREFIX}/${JDKHOME} -xf - 
	${INSTALL_DATA_DIR} ${PREFIX}/${JREHOME}
	cd ${JREIMAGEDIR} && tar -cf - * | tar -C ${PREFIX}/${JREHOME} -xf -

.include <bsd.port.mk>

# The bootjdk is the jdk image with some parts deleted
# and a copy of the system shared libs needed to run it.
# The parts deleted are not needed for bootstrap and would
# require more system shared libs to be saved.
build-bootjdk: ${_BUILD_COOKIE}
	@@rm -rf ${WRKDIR}/tmp
	@@mkdir -p ${WRKDIR}/tmp/bootjdk
	@@mkdir -p ${WRKDIR}/tmp/bootjdk-libs
	@@cd ${JDKIMAGEDIR} && tar -cf - * | tar -C ${WRKDIR}/tmp/bootjdk -xf - 
	@@cd ${WRKDIR}/tmp/bootjdk/bin && rm appletviewer policytool
	@@cd ${WRKDIR}/tmp/bootjdk/jre/lib/${ARCH} && rm libnpt.so libinstrument.so libsplashscreen.so xawt/libmawt.so
	@@ldd ${WRKDIR}/tmp/bootjdk/bin/unpack200 | \
		grep rlib | cut -d"/" -f 2-20 | \
		xargs -I % cp /% ${WRKDIR}/tmp/bootjdk-libs
	@@objdump -p ${WRKDIR}/tmp/bootjdk/jre/lib/${ARCH}/libfontmanager.so | \
		grep NEEDED | grep libfreetype | sed  -e 's/[[:blank:]]*NEEDED[[:blank:]]*//' | \
		xargs -I % cp ${X11BASE}/lib/% ${WRKDIR}/tmp/bootjdk-libs
	@@cd ${WRKDIR}/tmp && tar czf openjdk6-bootjdk-${ARCH}-$$(date +%Y%m%d).tar.gz bootjdk*
	@@echo "New bootjdk is located at ${WRKDIR}/tmp/openjdk6-bootjdk-${ARCH}-$$(date +%Y%m%d).tar.gz"
@


1.53
log
@additional comment reminding to switch libreoffice back if jdk is fixed
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.52 2014/01/09 09:59:55 sthen Exp $
@


1.52
log
@Disable java subpackage of databases/db on i386, java is broken there and
this knocks out many ports which rely on db.

Add a comment next to BROKEN-i386 in jdk/1.6/Makefile reminding that this
has been done.
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.51 2013/12/30 23:21:41 sthen Exp $
d8 1
@


1.51
log
@reluctantly mark BROKEN-i386; most if not all builds using packages from this
fail with the following error,

"guarantee(get_thread() == thread) failed: must be the same thread, quickly"

espie@@ agrees
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.50 2013/11/25 14:16:22 sthen Exp $
d5 1
d7 1
@


1.50
log
@kill VMEM_WARNING
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.49 2013/10/16 14:12:21 bluhm Exp $
d5 1
@


1.49
log
@Including the header file netinet6/in6_var.h from netinet/in_var.h
automatically is bad.  To change that, a few ports must be adapted.
Do an explicit #include <netinet6/in6_var.h> when it is needed.
OK ajacoutot@@
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.48 2013/08/22 16:21:17 sthen Exp $
a69 1
VMEM_WARNING=	Yes
@


1.48
log
@new amd64/i386 bootstraps for JDK; thanks to Christian Schulte for
a surprising clue about libfontconfig.so.
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.47 2013/04/15 03:01:06 kurt Exp $
d13 1
a13 1
REVISION-main=	5
d15 1
a15 1
REVISION-jre=	5
@


1.47
log
@- Remove uthreads work-around which set STDIN/OUT/ERR to non-blocking
  in child processes.
- Rebuild bootstrap jdks to eliminate the boot jdk from setting
  STDIN/OUT/ERR non-blocking when building the jdk.
Fixes intermittent build failures noted by landry@@
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.46 2013/04/10 02:47:10 kurt Exp $
d13 1
a13 1
REVISION-main=	4
d15 1
a15 1
REVISION-jre=	4
d60 1
d79 2
a80 2
SUPDISTFILES+=	openjdk6-bootjdk-amd64-20130414.tar.gz:1 \
		openjdk6-bootjdk-i386-20130414.tar.gz:1 \
d92 1
a92 1
BOOT_JDK=	openjdk6-bootjdk-${ARCH}-20130414.tar.gz
d95 1
a95 1
DISTFILES+=	${BOOT_JDK}:1
@


1.46
log
@- unbreak native_bootstrap FLAVOR by adjusting SUPDISTFILES location
- fix awt problems by including libfontconfig.so in bootstrap jdk
- remove lack of ORIGIN support work-around
- fix include path order in awt
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.45 2013/03/19 19:26:45 kurt Exp $
d13 1
a13 1
REVISION-main=	3
d15 1
a15 1
REVISION-jre=	3
d78 2
a79 2
SUPDISTFILES+=	openjdk6-bootjdk-amd64-20130409.tar.gz:1 \
		openjdk6-bootjdk-i386-20130409.tar.gz:1 \
d91 1
a91 1
BOOT_JDK=	openjdk6-bootjdk-${ARCH}-20130409.tar.gz
@


1.45
log
@- correct UnguardOnExecutionViolation which helped find a W^X
kernel bug on i386
- fix undefined symbols in libhpi.so noted by stu@@
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.44 2013/03/11 10:50:09 espie Exp $
d13 1
a13 1
REVISION-main=	2
d15 1
a15 1
REVISION-jre=	2
d77 5
d91 1
a91 2
BOOT_JDK=	openjdk6-bootjdk-${ARCH}-20130128.tar.gz
APACHE_ANT=	apache-ant-1.8.4-bin.tar.gz
a96 1
SUPDISTFILES+=	openjdk6-bootjdk-amd64-20130128.tar.gz:1 openjdk6-bootjdk-i386-20130128.tar.gz:1
d236 1
a236 1
	@@cd ${WRKDIR}/tmp/bootjdk/jre/lib/${ARCH} && rm libnpt.so libinstrument.so libsplashscreen.so xawt/libmawt.so libfontmanager.so
d240 3
@


1.44
log
@PERMIT_* / REGRESS->TEST sweep
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.43 2013/02/13 18:13:12 sthen Exp $
d13 1
a13 1
REVISION-main=	1
d15 1
a15 1
REVISION-jre=	1
@


1.43
log
@add bootstraps to SUPDISTFILES, don't use $ARCH in DISTFILES as (despite
ONLY_FOR_ARCHS) dpb still fetches the files. fixes spurious dpb errors with
!amd64/i386. ok espie@@ kurt@@
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.42 2013/02/09 14:49:50 sthen Exp $
a64 3
PERMIT_PACKAGE_FTP=	Yes
PERMIT_DISTFILES_CDROM=	Yes
PERMIT_DISTFILES_FTP=	Yes
d67 1
a67 1
NO_REGRESS=	Yes
@


1.42
log
@Don't use ${FLAVOR:L}, we only support lower-case flavours now.
OK ajacoutot@@ espie@@
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.41 2013/02/07 19:06:55 kurt Exp $
d91 6
a96 1
DISTFILES+=	${BOOT_JDK}:1 ${APACHE_ANT}:5
@


1.41
log
@- Allow HOTSPOT_BUILD_JOBS to be overridden from make env. okay jasper@@
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.40 2013/02/03 21:03:39 kurt Exp $
d80 1
a80 1
.if ${FLAVOR:L:Mnative_bootstrap}
d128 1
a128 1
.if !${FLAVOR:L:Mwith_ipv6}
@


1.40
log
@- Fix intermittent segfaults by enabling UseMembar by default.
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.38 2013/02/01 15:34:35 kurt Exp $
d105 3
d126 1
a126 1
		HOTSPOT_BUILD_JOBS=${MAKE_JOBS}
@


1.39
log
@- Fix MulticastSocket.setInterface(). Report and fix from Oliver
  Lehmann on bsd-port list.
@
text
@d13 1
a13 1
REVISION-main=	0
d15 1
a15 1
REVISION-jre=	0
@


1.38
log
@- Update to openjdk6 u32 which is licensed under the GPL and allows
  packages.
- Initial BSD patchset from FreeBSD openjdk6 port.
- New bootstrap method. Since ecj is not able to bootstrap openjdk6
  without heavy patching, use a functional bootjdk to build.
- Add a target for building the bootjdk called build-bootjdk.
- Apply IcedTea AppletHole patches for icedtea-web support.
- Backport patch to serialize gconf client access which corrects
  gconf/dbus related crashes. From Christian Schulte Upstream
  CR 7188755.
- Reapply audio support from jakemsr@@.
- Port change for CWM. Recognize CWM as a Non-Reparenting window
  manager.
- Backport various openjdk7/bsd-port upstream fixes both specific
  to OpenBSD and general.
Tested by landry@@ espie@@ and others.
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.37 2013/01/27 20:10:10 kurt Exp $
d13 1
d15 1
@


1.37
log
@- Update download location for the BSD patchset
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.36 2012/10/24 18:44:51 kurt Exp $
d3 2
a4 2
SHARED_ONLY=		Yes
ONLY_FOR_ARCHS= 	amd64 i386
d6 21
a26 53
COMMENT-main=		Java2(TM) Standard Edition Dev Kit v${V}
COMMENT-jre=		Java2(TM) Standard Edition Runtime Environment v${V}
V=			1.6.0.03
PKGNAME=		jdk-${V}
PKGNAME-main=		jdk-${V}
REVISION-main =		19
PKGNAME-jre=		jre-${V}
REVISION-jre =		19

CATEGORIES=		devel/jdk java
DPB_PROPERTIES=		parallel

MULTI_PACKAGES= 	-main -jre

HOMEPAGE=		https://jdk6.dev.java.net/

MAINTAINER=		Kurt Miller <kurt@@openbsd.org>

JRLSRC=			jdk-6u3-fcs-src-b05-jrl-24_sep_2007.jar
JRLBIN=			jdk-6u3-fcs-bin-b05-jrl-24_sep_2007.jar
JRLMOZ=			jdk-6u3-fcs-mozilla_headers-b05-unix-24_sep_2007.jar
PATCHSET=		bsd-jdk16-patches-4.tar.bz2

DISTFILES=		${JRLSRC} \
			${JRLBIN} \
			${JRLMOZ} \
			${PATCHSET}
DIST_SUBDIR=		jdk

MASTER_SITES=		http://download.java.net/jdk6/6u3/promoted/b05/

# Java Research License
# http://www.java.net/jrl.csp
PERMIT_PACKAGE_CDROM=	JRL
PERMIT_PACKAGE_FTP=	JRL
PERMIT_DISTFILES_CDROM= JRL
PERMIT_DISTFILES_FTP=	JRL

NO_REGRESS=		Yes

VMEM_WARNING=		Yes
BUILD_DEPENDS=		archivers/gtar \
			archivers/zip \
			archivers/unzip \
			archivers/bzip2 \
			print/cups,-libs \
			x11/openmotif
MODULES=		converters/libiconv gcc4
MODGCC4_VERSION=	4.6
MODGCC4_ARCHS=		*
MODGCC4_LANGS=		java
WANTLIB=		X11 Xext Xi Xtst c m ossaudio pthread \
			sndio stdc++ z
d28 1
a28 2
USE_GMAKE=		Yes
USE_GROFF =		Yes
d30 1
a30 30
# Don't call make -jN, instead pass MAKE_JOBS to HOTSPOT_BUILD_JOBS
PARALLEL_BUILD=		No

TAR=			${LOCALBASE}/bin/gtar

MAKE_ENV=		ALT_MOTIF_DIR="${LOCALBASE}" \
			ALT_CUPS_HEADERS_PATH="${LOCALBASE}/include" \
			ALT_DEVTOOLS_PATH="${LOCALBASE}/bin" \
			SKIP_FASTDEBUG_BUILD=true \
			DEV_ONLY=true \
			NO_DOCS=true \
			CC="${CC}" \
			CXX="${CXX}" \
			DEFAULT_LIBPATH="/usr/lib:${X11BASE}/lib:${LOCALBASE}/lib" \
			USER="${USER}" \
			HOTSPOT_BUILD_JOBS=${MAKE_JOBS}

# Error message for distfile.
FETCH_MANUALLY=		"You must manually fetch the distribution files, place"
FETCH_MANUALLY+=	"them in ${FULLDISTDIR} and then run make again."
FETCH_MANUALLY+=	"Get the JDK 6u3 Source file:"
FETCH_MANUALLY+=	" http://download.java.net/jdk6/6u3/promoted/b05/${JRLSRC}"
FETCH_MANUALLY+=	"and the JDK Binaries file:"
FETCH_MANUALLY+=	" http://download.java.net/jdk6/6u3/promoted/b05/${JRLBIN}"
FETCH_MANUALLY+=	"and the Mozilla Binaries file:"
FETCH_MANUALLY+=	" http://download.java.net/jdk6/6u3/promoted/b05/${JRLMOZ}"
FETCH_MANUALLY+=	""
FETCH_MANUALLY+=	"Get the BSD patchset file:"
FETCH_MANUALLY+=	" ${PATCHSET}"
FETCH_MANUALLY+=	"from http://www.intricatesoftware.com/OpenBSD/java/JDK16JRLConfirm.html"
d32 2
a33 2
FLAVORS=		no_web with_ipv6
PSEUDO_FLAVORS=		native_bootstrap
d36 1
a36 3
.if !${FLAVOR:L:Mwith_ipv6}
MAKE_ENV+=		DONT_ENABLE_IPV6=YES
.endif
d38 39
a76 2
# handle jar files in post-extract
EXTRACT_CASES+=		*.jar) true ;;
d83 3
a85 2
BUILD_DEPENDS+=		jdk->=1.6,<1.7:devel/jdk/1.6
MAKE_ENV+=		ALT_BOOTDIR="${LOCALBASE}/${JDKHOME}"
d87 7
a93 15
DISTFILES+=		bsd-jdk16-gensrc.tar.gz \
			xalan-j_2_7_0-bin.tar.gz \
			ecj-3.7.1.jar
FETCH_MANUALLY+=	"Get the file:"
FETCH_MANUALLY+=	"    bsd-jdk16-gensrc.tar.gz"
FETCH_MANUALLY+=	"from http://www.intricatesoftware.com/distfiles/bsd-jdk16-gensrc.tar.gz"
FETCH_MANUALLY+=	"Get the Apache Xalan Java file:"
FETCH_MANUALLY+=	"    xalan-j_2_7_0-bin.tar.gz"
FETCH_MANUALLY+=	"from http://archive.apache.org/dist/xml/xalan-j/"
FETCH_MANUALLY+=	"Get the Eclipse Java Compiler file:"
FETCH_MANUALLY+=	"    ecj-3.7.1.jar"
FETCH_MANUALLY+=	"from http://archive.eclipse.org/eclipse/downloads/drops/R-3.7.1-201109091335/ecj-3.7.1.jar"
MAKE_ENV+=		ALT_BOOTDIR=${WRKDIST} \
			ALT_BOOTSTRAP=yes \
			ECJ_JAR=${FULLDISTDIR}/ecj-3.7.1.jar
d96 29
a124 5
.if !${FLAVOR:L:Mno_web}
MAKE_ENV+=		BUILD_DEPLOY=true
.else
MAKE_ENV+=		BUILD_DEPLOY=false
MESSAGE=		${PKGDIR}/MESSAGE-no_web
d127 2
a128 2
JDKHOME=		jdk-1.6.0
JREHOME=		jre-1.6.0
d130 1
a130 1
SUBST_VARS=		JDKHOME JREHOME
d133 1
a133 1
PKG_ARGS+=              -Dclient_vm=1
d135 1
a135 1
PKG_ARGS+=              -Dclient_vm=0
d139 37
a175 17
WRKDIST=		${WRKDIR}
WRKSRC=         	${WRKDIR}/control/make
OUTPUTDIR=		${WRKDIR}/control/build/bsd-${MACHINE_ARCH:S/i386/i586/}
JDKIMAGEDIR=		${OUTPUTDIR}/j2sdk-image
JREIMAGEDIR=		${OUTPUTDIR}/j2re-image

.include <bsd.own.mk>

ACCEPT_JRL_LICENSE ?= No

.if ${ACCEPT_JRL_LICENSE:L} != "yes"
BROKEN += \n
BROKEN += You must read and accept Sun's JRL license located\n
BROKEN += at ${FILESDIR}/JavaResearchLicense.txt\n
BROKEN += To indicate your acceptance of the JRL add ACCEPT_JRL_LICENSE=Yes\n
BROKEN += to /etc/mk.conf and restart the build
.endif
d177 1
d179 21
a199 17
	@@rm -rf ${WRKDIR}/tmp
	@@mkdir ${WRKDIR}/tmp && \
		cd ${WRKDIR}/tmp && \
		${CC} ${CFLAGS} -o ${WRKDIR}/tmp/x_x2zip ${FILESDIR}/x_x2zip.c
.for jar in ${JRLSRC} ${JRLBIN} ${JRLMOZ}
	@@cd ${WRKDIR}/tmp && \
		unzip -qo ${FULLDISTDIR}/${jar} X_X && \
		./x_x2zip "YES I ACCEPT THE CLICK THROUGH LICENSE.  " X_X && \
		cd ${WRKDIR} && \
		unzip -q ${WRKDIR}/tmp/X_X.zip -x */lib*.so
.endfor
	@@cd ${WRKDIR} && \
		mkdir deploy/src/plugin/share/plugin && \
		mv share/plugin/mozilla_headers_18 deploy/src/plugin/share/plugin
	@@cp -f ${FILESDIR}/cacerts ${WRKDIR}/j2se/src/share/lib/security
	@@cp ${FILESDIR}/PLATFORM_API_BSDOS_PCM.c ${WRKDIR}/j2se/src/solaris/native/com/sun/media/sound/engine
	@@rm -rf ${WRKDIR}/tmp ${WRKDIR}/share
d203 1
a203 11
		${PATCH} -p0 -z .orig.bsd --quiet < ${WRKDIR}/jdk16.patches

.if !${FLAVOR:L:Mnative_bootstrap}
post-patch:
	@@cd ${WRKDIR}/bin && \
		chmod +x bootscript
.for prog in java javac javah jar
	@@cd ${WRKDIR}/bin && \
		ln -s bootscript ${prog}
.endfor
.endif
d206 1
a206 4
	@@rm -rf ${JDKIMAGEDIR}/man/ja \
		${JDKIMAGEDIR}/man/ja_JP.eucJP \
		${JREIMAGEDIR}/man/ja \
		${JREIMAGEDIR}/man/ja_JP.eucJP
a212 4
	cd ${WRKDIR} && \
		${INSTALL_DATA} JavaResearchLicense.txt ${PREFIX}/${JDKHOME}/LICENSE && \
		${INSTALL_DATA} JavaResearchLicense.txt ${PREFIX}/${JDKHOME}/jre/LICENSE && \
		${INSTALL_DATA} JavaResearchLicense.txt ${PREFIX}/${JREHOME}/LICENSE
d215 17
@


1.36
log
@Add CWM support. Ported from jdk/1.7 by Kent R. Spillner
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.35 2012/10/19 22:29:49 kurt Exp $
d92 1
a92 1
FETCH_MANUALLY+=	"from http://www.eyesbeyond.com/freebsddom/java/jdk16.html"
@


1.35
log
@Use gcj 4.6 to bootstrap instead of jamvm. okay jasper@@
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.34 2012/09/27 21:49:58 naddy Exp $
d11 1
a11 1
REVISION-main =		18
d13 1
a13 1
REVISION-jre =		18
@


1.34
log
@mark for parallel dpb building to shorten the time to libreoffice
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.33 2012/09/26 18:23:04 naddy Exp $
d11 1
a11 1
REVISION-main =		17
d13 1
a13 1
REVISION-jre =		17
d53 4
a56 1
MODULES=		converters/libiconv
a124 1
BUILD_DEPENDS+=		lang/jamvm>=1.5.4
@


1.33
log
@Permit building with MAKE_JOBS:
Don't call make -jN, instead pass MAKE_JOBS to HOTSPOT_BUILD_JOBS

ok kurt@@, espie@@
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.32 2012/08/04 15:06:55 ajacoutot Exp $
d16 1
@


1.32
log
@cups -> cups,-libs
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.31 2012/05/28 13:53:18 fgsch Exp $
d59 3
d74 1
a74 1
			HOTSPOT_BUILD_JOBS=${HOTSPOT_BUILD_JOBS}
@


1.31
log
@Fix master site for ecj-3.7.1.jar
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.30 2012/03/22 18:53:15 kurt Exp $
d50 1
a50 1
			print/cups \
@


1.30
log
@Rename internal execvpe to fix build and remove uthread gross hacks while
here. okay matthew@@ naddy@@
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.29 2012/03/20 16:57:58 kurt Exp $
d117 1
a117 1
FETCH_MANUALLY+=	"from http://download.eclipse.org/eclipse/downloads/drops/R-3.7.1-201109091335/ecj-3.7.1.jar"
@


1.29
log
@Use generic suspend resume method instead of pthread_suspend_np().
okay robert@@
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.28 2011/11/01 09:32:34 jasper Exp $
d11 1
a11 1
REVISION-main =		16
d13 1
a13 1
REVISION-jre =		16
@


1.28
log
@missing bump in -r1.24
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.27 2011/10/21 16:23:45 espie Exp $
d11 1
a11 1
REVISION-main =		15
d13 1
a13 1
REVISION-jre =		15
@


1.27
log
@CHMOD and CHOWN serve no useful purpose, they're just chown/chmod
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.26 2011/10/10 00:44:07 kurt Exp $
d11 1
a11 1
REVISION-main =		14
d13 1
a13 1
REVISION-jre =		14
@


1.26
log
@- Eliminate systrace warning during post-extract. Reported by
Vadim Zhukov <persgray@@gmail.com>.
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.25 2011/10/08 14:13:44 kurt Exp $
d187 1
a187 1
		${CHMOD} +x bootscript
@


1.25
log
@- fix typo in FETCH_MANUALLY line. From rd@@thrush.com.
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.24 2011/10/07 02:04:12 kurt Exp $
d164 1
@


1.24
log
@- switch from jdk/1.5 default bootstrap to lang/jamvm + Eclipse compiler
okay kili@@
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.23 2011/10/02 13:31:03 ajacoutot Exp $
d111 1
a111 1
FETCH_MANUALLY+=	"from http:://www.intricatesoftware.com/distfiles/bsd-jdk16-gensrc.tar.gz"
@


1.23
log
@Fix path to the shared Mozilla plugins directory.
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.22 2011/04/09 00:38:09 ian Exp $
d32 1
d53 2
a54 2
WANTLIB=		X11 Xext Xi Xtst c m ossaudio pthread pthread-stubs \
			sndio stdc++ xcb z
d106 16
a121 2
BUILD_DEPENDS+=		jdk->=1.5,<1.6:devel/jdk/1.5
MAKE_ENV+=		ALT_BOOTDIR="${LOCALBASE}/jdk-1.5.0"
d182 10
@


1.22
log
@Mention that the plugin only works with firefox35 at present.
"OK with bump" on -main sthen@@; reminded to copy text to -jre by kurt@@
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.21 2011/02/05 23:11:18 ian Exp $
d11 1
a11 1
REVISION-main =		13
d13 1
a13 1
REVISION-jre =		13
@


1.21
log
@Security Fix for DoS caused by very small subnormal double, found by Konstantin Preisser
at http://www.exploringbinary.com/java-hangs-when-converting-2-2250738585072012e-308/.
Fix from https://bugs.openjdk.java.net/show_bug.cgi?id=100119.
Ok kurt@@ (maintainer), ok & comments sthen@@, ok naddy@@, aja@@.
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.19 2010/11/15 19:45:59 espie Exp $
d11 1
a11 1
REVISION-main =		12
d13 1
a13 1
REVISION-jre =		12
@


1.20
log
@minor bumps after pkg_create fix: generate catN entry when needed.
@
text
@d11 1
a11 1
REVISION-main =		11
d13 1
a13 1
REVISION-jre =		11
@


1.19
log
@move depends to new style
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.18 2010/10/24 21:10:57 ajacoutot Exp $
d11 1
a11 1
REVISION-main =		10
d13 1
a13 1
REVISION-jre =		10
@


1.18
log
@Remove USE_X11.
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.17 2010/10/18 17:47:53 espie Exp $
d10 4
a13 2
PKGNAME-main=		jdk-${V}p10
PKGNAME-jre=		jre-${V}p10
d45 6
a50 6
BUILD_DEPENDS=		::archivers/gtar \
			::archivers/zip \
			::archivers/unzip \
			::archivers/bzip2 \
			::print/cups \
			::x11/openmotif
d56 1
a56 1
USE_GROFF =	Yes
d102 1
a102 1
BUILD_DEPENDS+=		:jdk->=1.6,<1.7:devel/jdk/1.6
d105 1
a105 1
BUILD_DEPENDS+=		:jdk->=1.5,<1.6:devel/jdk/1.5
@


1.17
log
@USE_GROFF=Yes
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.16 2010/07/02 01:43:12 jakemsr Exp $
a52 1
USE_X11=		Yes
@


1.16
log
@sndio support.  note, there are two different audio API APIs in jdk1.6,
one, HAE, is not portable to APIs that don't use file descriptors as
their handle, so it's still using ossaudio.  the other, DirectAudio,
is more portable, and is the one that this commit is converting to
sndio.  DirectAudio is preferred by jdk, and if it's supported, it will
be used.  in other words, your java apps on OpenBSD will now be using
sndio (assuing you're using jdk1.6, sndio for jdk1.7 coming soon).
just wanted to explain why this still links with libossaudio ...

ok ajacoutot
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.15 2010/02/05 13:10:31 kurt Exp $
d55 1
@


1.15
log
@Remove broken jdk17_bootstrap PSEUDO_FLAVOR. ok jasper@@ naddy@@
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.14 2009/08/10 06:31:07 kili Exp $
d10 2
a11 2
PKGNAME-main=		jdk-${V}p9
PKGNAME-jre=		jre-${V}p9
d51 1
a51 1
			stdc++ xcb z
d159 1
@


1.14
log
@WANTLIB changes after xcb addition and bump.
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.13 2009/05/15 17:41:04 kurt Exp $
d10 2
a11 2
PKGNAME-main=		jdk-${V}p8
PKGNAME-jre=		jre-${V}p8
d85 1
a85 1
PSEUDO_FLAVORS=		native_bootstrap jdk17_bootstrap
a102 8
.if ${FLAVOR:L:Mjdk17_bootstrap}
INSTALLED!= (pkg_info -e "jdk->=1.7,<1.8" -q && echo yes) || echo no
.if ${INSTALLED:L} != "yes"
ERRORS += "Fatal: This flavor requires an installed 1.7 jdk package"
.endif
BUILD_DEPENDS+=		:jdk->=1.7,<1.8:devel/jdk/1.7
MAKE_ENV+=		ALT_BOOTDIR="${LOCALBASE}/jdk-1.7.0"
.else
a104 1
.endif
@


1.13
log
@- add jdk17_bootstrap PSEUDO_FLAVOR which uses a pre-installed
jdk/1.7 package to bootstrap
- prevent users from using native_bootstrap or jdk17_bootstrap when
the required package is not pre-installed

"looks good" sthen@@
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.12 2009/03/15 09:25:04 espie Exp $
d10 2
a11 2
PKGNAME-main=		jdk-${V}p7
PKGNAME-jre=		jre-${V}p7
d50 2
a51 1
WANTLIB=		X11 Xext Xi Xtst c m ossaudio pthread stdc++ z
@


1.12
log
@more depends fixes
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.11 2009/03/01 20:43:09 naddy Exp $
d10 2
a11 2
PKGNAME-main=		jdk-${V}p6
PKGNAME-jre=		jre-${V}p6
d84 1
a84 1
PSEUDO_FLAVORS=		native_bootstrap
d95 4
d102 8
d112 1
@


1.11
log
@Java bug fix; from kurt@@
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.10 2009/01/07 13:34:21 kurt Exp $
d95 1
a95 1
BUILD_DEPENDS+=		:jdk-1.6*:devel/jdk/1.6
d98 1
a98 1
BUILD_DEPENDS+=		:jdk-1.5*:devel/jdk/1.5
@


1.10
log
@As noted on the freebsd-java list, Sun's u3 source page no longer links
to the distfiles but they are still available using full URLs. Update
FETCH_MANUALLY text to use the full URLs.
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.9 2008/12/22 13:16:56 kurt Exp $
d10 2
a11 2
PKGNAME-main=		jdk-${V}p5
PKGNAME-jre=		jre-${V}p5
@


1.9
log
@Complete SYSTEM_ZLIB build flag hooks and enable for OpenBSD.
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.8 2008/12/21 03:59:44 kurt Exp $
d73 1
a73 1
FETCH_MANUALLY+=	" ${JRLSRC}"
d75 1
a75 1
FETCH_MANUALLY+=	" ${JRLBIN}"
d77 1
a77 2
FETCH_MANUALLY+=	" ${JRLMOZ}"
FETCH_MANUALLY+=	"from http://download.java.net/jdk6/6u3/promoted/b05/index.html"
@


1.8
log
@Parellel make doesn't work for the jdk builds so instead of passing
MAKE_JOBS on allow users to set HOTSPOT_BUILD_JOBS via env.
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.7 2008/11/18 01:51:59 sthen Exp $
d10 2
a11 2
PKGNAME-main=		jdk-${V}p4
PKGNAME-jre=		jre-${V}p4
@


1.7
log
@non-native bootstrap is devel/jdk/1.5 not kaffe; update DESCR
accordingly.  ok kurt@@
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.6 2008/10/22 16:02:24 kurt Exp $
d67 1
a67 1
			HOTSPOT_BUILD_JOBS=${MAKE_JOBS}
@


1.6
log
@Limit the jdk's view of physical memory to rlimit_cur instead of
rlimit_max. This makes the jdk behave better on amd64.

okay naddy@@ ian@@
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.5 2008/06/30 20:16:37 naddy Exp $
d10 2
a11 2
PKGNAME-main=		jdk-${V}p3
PKGNAME-jre=		jre-${V}p3
@


1.5
log
@spawn only ${MAKE_JOBS} build jobs in parallel; ok kurt@@
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.4 2008/06/28 12:34:58 kurt Exp $
d10 2
a11 2
PKGNAME-main=		jdk-${V}p2
PKGNAME-jre=		jre-${V}p2
@


1.4
log
@- remove work-arounds for missing getpwuid_r now that we have it
- regen pkg files with @@bin markers
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.3 2008/03/17 03:28:26 kurt Exp $
d67 1
a67 1
			HOTSPOT_BUILD_JOBS=`sysctl -n hw.ncpu`
@


1.3
log
@- use HW_{USER|PHYS}MEM64. okay naddy@@
- update to bsd patchset 4
- for amd64, sync JVM_handle_bsd_signal with its linux counterpart from
  which it was originally derived; add two segments of code dealing with
  sigsegv fringe cases.
- update pkg/MESSAGE-* to use recent mozilla product names.
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.2 2008/01/18 16:08:05 kurt Exp $
d10 2
a11 2
PKGNAME-main=		jdk-${V}p1
PKGNAME-jre=		jre-${V}p1
@


1.2
log
@don't install libnative_chmod.so. it is an unused linux shared lib
okay ajacoutot@@
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.1.1.1 2007/11/19 03:19:43 kurt Exp $
d10 2
a11 2
PKGNAME-main=		jdk-${V}p0
PKGNAME-jre=		jre-${V}p0
d24 1
a24 1
PATCHSET=		bsd-jdk16-patches-3.tar.bz2
@


1.1
log
@Initial revision
@
text
@d1 1
a1 1
# $OpenBSD$
d10 2
a11 2
PKGNAME-main=		jdk-${V}
PKGNAME-jre=		jre-${V}
@


1.1.1.1
log
@Initial import of Java (TM) 2 SDK, Standard Edition Version 1.6.0 with
amd64 plugin support. 64-bit plugin hacking by myself and Jung-uk Kim.
Credit for the majority of the 1.6 BSD porting goes to Greg Lewis who
back ported my 1.7 hotspot patches to 1.6 and forward ported the 1.5
j2se patches to 1.6. Thanks to several testers who provided helpful
feedback. okay ian@@
@
text
@@
