head	1.5;
access;
symbols
	OPENBSD_4_5:1.4.0.10
	OPENBSD_4_5_BASE:1.4
	OPENBSD_4_4:1.4.0.6
	OPENBSD_4_4_BASE:1.4
	OPENBSD_4_3:1.4.0.4
	OPENBSD_4_3_BASE:1.4
	OPENBSD_4_2:1.4.0.2
	OPENBSD_4_2_BASE:1.4
	OPENBSD_4_1:1.3.0.4
	OPENBSD_4_1_BASE:1.3
	OPENBSD_4_0:1.3.0.2
	OPENBSD_4_0_BASE:1.3
	OPENBSD_3_9:1.2.0.4
	OPENBSD_3_9_BASE:1.2
	OPENBSD_3_8:1.2.0.2
	OPENBSD_3_8_BASE:1.2;
locks; strict;
comment	@# @;


1.5
date	2009.03.18.01.45.38;	author kurt;	state dead;
branches;
next	1.4;

1.4
date	2007.07.18.14.19.27;	author kurt;	state Exp;
branches;
next	1.3;

1.3
date	2006.03.20.14.40.25;	author kurt;	state Exp;
branches;
next	1.2;

1.2
date	2005.07.14.17.29.09;	author kurt;	state Exp;
branches;
next	1.1;

1.1
date	2005.06.03.17.27.54;	author kurt;	state Exp;
branches;
next	;


desc
@@


1.5
log
@remove 1.3 and 1.4 as per plan made last June
@
text
@$OpenBSD: patch-j2sdk1_3_1_src_solaris_hpi_green_threads_include_context_md_bsd_h,v 1.4 2007/07/18 14:19:27 kurt Exp $
--- j2sdk1.3.1/src/solaris/hpi/green_threads/include/context_md_bsd.h.orig	Wed Jul 18 09:36:12 2007
+++ j2sdk1.3.1/src/solaris/hpi/green_threads/include/context_md_bsd.h	Wed Jul 18 09:36:14 2007
@@@@ -26,6 +26,9 @@@@ typedef struct lj_ucontext {
 	context_jmpbuf_t	jmpbuf;
 #if defined(i386)
 	char		floatbuf[108];
+#elif defined(__arm__) || defined(__sparc__)
+	unsigned int    pc;     /* args for death func are stored here */
+	unsigned int    arg;    /* args for death func are stored here */
 #elif defined(__powerpc__)
 	/* We pretend the fp status & ctl reg (fpscr) is 64 bits */
 	unsigned int    pc;     /* args for death func are stored here */
@@@@ -65,6 +68,13 @@@@ typedef struct lj_ucontext {
 #define BSD_SIGNAL_MASK		21
 #define BSD_STACK_POINTER	3
 
+#elif defined(__arm__)
+
+#define BSD_MAGIC		0
+#define BSD_STACK_POINTER	23
+#define BSD_LINK_REGISTER	24
+#define BSD_SIGNAL_MASK		25
+
 #elif defined(__powerpc__)
 
 /* jmpbuf contains sigmask, then r8-31 where r11 is the LR
@@@@ -78,6 +88,13 @@@@ typedef struct lj_ucontext {
 #define BSD_STACK_POINTER	3	/* index in sigjmp_buf of SP (r10) */
 #define BSD_LINK_REGISTER	4	/* index in sigjmp_buf of LR (r11) */
 
+#elif defined(__sparc__)
+
+#define BSD_SIGNAL_MASK         1
+#define BSD_STACK_POINTER       2
+#define BSD_PC                  3
+#define BSD_nPC                 4
+
 #else
 #error architecture unsupported
 #endif
@@@@ -90,7 +107,7 @@@@ typedef lj_ucontext_t	inner_ucontext_t;
 
 typedef struct {
     unsigned int unix_errno;
-#if defined(__NetBSD__) && defined(__powerpc__)
+#if defined(__powerpc__)
     void *current_sp;
 #endif
     inner_ucontext_t lj_ucontext;
@@@@ -200,6 +217,21 @@@@ extern int netbsd_siglongjmp(sigjmp_buf env, int val);
         (contextp)->unix_errno = errno;					\
         reschedule();							\
     }									\
+}
+#elif defined(__arm__) || defined(__sparc__)
+#define getcontext(lj_ucontextp) { 				\
+    sigsetjmp((lj_ucontextp)->jmpbuf, -1); 			\
+}
+
+#define setcontext(lj_ucontextp) {		 		\
+    siglongjmp((lj_ucontextp)->jmpbuf, (int)lj_ucontextp);	\
+}
+
+#define yieldContext(contextp) {				\
+    if (!sigsetjmp((contextp)->lj_ucontext.jmpbuf, -1)) {	\
+	(contextp)->unix_errno = errno;				\
+	reschedule();						\
+    }								\
 }
 #else
 #error architecture unsupported
@


1.4
log
@regen patches
@
text
@d1 1
a1 1
$OpenBSD: patch-j2sdk1_3_1_src_solaris_hpi_green_threads_include_context_md_bsd_h,v 1.3 2006/03/20 14:40:25 kurt Exp $
@


1.3
log
@- enter 1.3.1 on sparc. due to the small datasize ulimit on sparc -Xmx60
is about as high as you can go. tomcat v4 and demos work but a bit slowly.
@
text
@d1 3
a3 3
$OpenBSD: patch-j2sdk1_3_1_src_solaris_hpi_green_threads_include_context_md_bsd_h,v 1.2 2005/07/14 17:29:09 kurt Exp $
--- j2sdk1.3.1/src/solaris/hpi/green_threads/include/context_md_bsd.h.orig	Thu Mar 16 16:42:43 2006
+++ j2sdk1.3.1/src/solaris/hpi/green_threads/include/context_md_bsd.h	Fri Mar 17 12:39:53 2006
d51 1
a51 1
@@@@ -200,6 +217,21 @@@@ extern int netbsd_siglongjmp(sigjmp_buf 
@


1.2
log
@- enable arm archs
- fix up arm/green thread patches (kurt/dale)
- remove unused native thread patches
- fix WANTLIB

okay drahn@@
@
text
@d1 3
a3 3
$OpenBSD: patch-j2sdk1_3_1_src_solaris_hpi_green_threads_include_context_md_bsd_h,v 1.1 2005/06/03 17:27:54 kurt Exp $
--- j2sdk1.3.1/src/solaris/hpi/green_threads/include/context_md_bsd.h.orig	Thu Jul  7 15:44:51 2005
+++ j2sdk1.3.1/src/solaris/hpi/green_threads/include/context_md_bsd.h	Sat Jul  9 18:09:22 2005
d8 1
a8 1
+#elif defined(__arm__)
d28 15
a42 1
@@@@ -90,7 +100,7 @@@@ typedef lj_ucontext_t	inner_ucontext_t;
d51 1
a51 1
@@@@ -200,6 +210,21 @@@@ extern int netbsd_siglongjmp(sigjmp_buf 
d56 1
a56 1
+#elif defined(__arm__)
@


1.1
log
@- Add support for powerpc. With some tips from tedu@@ and drahn@@, thanks!
- Change bootstrap method. No longer use 1.3-linux port to bootstrap.
  Use class files from a linux binary jdk and extra source and header
  files from my website.
- Remove plugin support. plugin has security issues and doesn't work
  with recent mozilla/firefox versions.
- Patches for arm native-threads are included but not enabled yet.
  I prefer to have all arches use green-threads to avoid arch specific
  pkg files. Also noticed some regressions with native-threads on i386.
  arm support from Dale Rahn (drahn@@).
- quiet pre-patch phase

okay ian@@
@
text
@d1 16
a16 6
$OpenBSD$
--- j2sdk1.3.1/src/solaris/hpi/green_threads/include/context_md_bsd.h.orig	Fri May 27 17:32:10 2005
+++ j2sdk1.3.1/src/solaris/hpi/green_threads/include/context_md_bsd.h	Fri May 27 17:38:09 2005
@@@@ -59,7 +59,7 @@@@ typedef struct lj_ucontext {
 # endif
 #define BSD_STACK_POINTER	34
d18 8
a25 2
-#elif defined(__arm32__)
+#elif defined(__arm32__) || defined(__arm__)
d27 2
a28 3
 #define BSD_FPU_MASK		0
 #define BSD_SIGNAL_MASK		21
@@@@ -90,7 +90,7 @@@@ typedef lj_ucontext_t	inner_ucontext_t;
d37 22
@

