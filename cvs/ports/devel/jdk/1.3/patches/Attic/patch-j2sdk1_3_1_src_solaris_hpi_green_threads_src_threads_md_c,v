head	1.5;
access;
symbols
	OPENBSD_4_5:1.4.0.10
	OPENBSD_4_5_BASE:1.4
	OPENBSD_4_4:1.4.0.6
	OPENBSD_4_4_BASE:1.4
	OPENBSD_4_3:1.4.0.4
	OPENBSD_4_3_BASE:1.4
	OPENBSD_4_2:1.4.0.2
	OPENBSD_4_2_BASE:1.4
	OPENBSD_4_1:1.3.0.4
	OPENBSD_4_1_BASE:1.3
	OPENBSD_4_0:1.3.0.2
	OPENBSD_4_0_BASE:1.3
	OPENBSD_3_9:1.2.0.4
	OPENBSD_3_9_BASE:1.2
	OPENBSD_3_8:1.2.0.2
	OPENBSD_3_8_BASE:1.2;
locks; strict;
comment	@# @;


1.5
date	2009.03.18.01.45.38;	author kurt;	state dead;
branches;
next	1.4;

1.4
date	2007.07.18.14.19.27;	author kurt;	state Exp;
branches;
next	1.3;

1.3
date	2006.03.20.14.40.25;	author kurt;	state Exp;
branches;
next	1.2;

1.2
date	2005.07.14.17.29.09;	author kurt;	state Exp;
branches;
next	1.1;

1.1
date	2005.06.03.17.27.54;	author kurt;	state Exp;
branches;
next	;


desc
@@


1.5
log
@remove 1.3 and 1.4 as per plan made last June
@
text
@$OpenBSD: patch-j2sdk1_3_1_src_solaris_hpi_green_threads_src_threads_md_c,v 1.4 2007/07/18 14:19:27 kurt Exp $
--- j2sdk1.3.1/src/solaris/hpi/green_threads/src/threads_md.c.orig	Wed Jul 18 09:36:12 2007
+++ j2sdk1.3.1/src/solaris/hpi/green_threads/src/threads_md.c	Wed Jul 18 09:36:14 2007
@@@@ -80,8 +80,11 @@@@ sysThreadCheckStack() 
 {
     sys_thread_t *tid = greenThreadSelf();
 
+    /* workaround a gcc optimization bug on powerpc */
+    char *currentSP = (char *)&currentSP;
+
     /* Stacks grow toward lower addresses on Solaris... */
-    if ((char *)(tid)->stack.base - (char *)&(tid) + STACK_REDZONE <
+    if ((char *)(tid)->stack.base - currentSP + STACK_REDZONE <
 	    tid->stack.size) {
 	return 1;
     } else {
@@@@ -327,17 +330,21 @@@@ start_func(void (*func)(int), start_args *args)
 
 #if defined(__FreeBSD__) || defined(__NetBSD__) || defined(__OpenBSD__) || defined(__bsdi__)
 static void
-#if defined(__NetBSD__) && defined(__powerpc__)
+#if defined(__powerpc__) || defined(__arm__) || defined(__sparc__)
 start_func(lj_ucontext_t *uc)
 #else
 start_func(void (*func)(int), start_args *args)
 #endif
 {
-#if defined(__NetBSD__) && defined(__powerpc__)
+#if defined(__powerpc__)
     start_args *args = (start_args *)uc->arg;
     void (*func)() = (void (*)())uc->pc;
     int arg = args->arg;
     CONTEXT(args->tid)->current_sp = &func;
+#elif defined(__arm__) || defined(__sparc__)
+    start_args *args = (start_args *)uc->arg;
+    void (*func)() = (void (*)())uc->pc;
+    int arg = args->arg;
 #else
     int arg = args->arg;
 #endif
@


1.4
log
@regen patches
@
text
@d1 1
a1 1
$OpenBSD: patch-j2sdk1_3_1_src_solaris_hpi_green_threads_src_threads_md_c,v 1.3 2006/03/20 14:40:25 kurt Exp $
@


1.3
log
@- enter 1.3.1 on sparc. due to the small datasize ulimit on sparc -Xmx60
is about as high as you can go. tomcat v4 and demos work but a bit slowly.
@
text
@d1 3
a3 3
$OpenBSD: patch-j2sdk1_3_1_src_solaris_hpi_green_threads_src_threads_md_c,v 1.2 2005/07/14 17:29:09 kurt Exp $
--- j2sdk1.3.1/src/solaris/hpi/green_threads/src/threads_md.c.orig	Fri Mar 17 13:49:52 2006
+++ j2sdk1.3.1/src/solaris/hpi/green_threads/src/threads_md.c	Fri Mar 17 15:07:37 2006
d17 1
a17 1
@@@@ -327,17 +330,21 @@@@ start_func(void (*func)(int), start_args
@


1.2
log
@- enable arm archs
- fix up arm/green thread patches (kurt/dale)
- remove unused native thread patches
- fix WANTLIB

okay drahn@@
@
text
@d1 3
a3 3
$OpenBSD: patch-j2sdk1_3_1_src_solaris_hpi_green_threads_src_threads_md_c,v 1.1 2005/06/03 17:27:54 kurt Exp $
--- j2sdk1.3.1/src/solaris/hpi/green_threads/src/threads_md.c.orig	Thu Jul  7 15:44:51 2005
+++ j2sdk1.3.1/src/solaris/hpi/green_threads/src/threads_md.c	Sat Jul  9 18:18:55 2005
d22 1
a22 1
+#if defined(__powerpc__) || defined(__arm__)
d34 1
a34 1
+#elif defined(__arm__)
@


1.1
log
@- Add support for powerpc. With some tips from tedu@@ and drahn@@, thanks!
- Change bootstrap method. No longer use 1.3-linux port to bootstrap.
  Use class files from a linux binary jdk and extra source and header
  files from my website.
- Remove plugin support. plugin has security issues and doesn't work
  with recent mozilla/firefox versions.
- Patches for arm native-threads are included but not enabled yet.
  I prefer to have all arches use green-threads to avoid arch specific
  pkg files. Also noticed some regressions with native-threads on i386.
  arm support from Dale Rahn (drahn@@).
- quiet pre-patch phase

okay ian@@
@
text
@d1 3
a3 3
$OpenBSD$
--- j2sdk1.3.1/src/solaris/hpi/green_threads/src/threads_md.c.orig	Fri May 27 17:40:57 2005
+++ j2sdk1.3.1/src/solaris/hpi/green_threads/src/threads_md.c	Fri May 27 17:42:24 2005
d9 1
a9 1
+    char *currentSP = &currentSP;
d17 1
a17 1
@@@@ -327,13 +330,13 @@@@ start_func(void (*func)(int), start_args
d22 1
a22 1
+#if defined(__powerpc__)
d33 8
@

