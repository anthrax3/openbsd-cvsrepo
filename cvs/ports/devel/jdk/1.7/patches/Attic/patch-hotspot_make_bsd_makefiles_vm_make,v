head	1.7;
access;
symbols
	OPENBSD_5_2:1.6.0.2
	OPENBSD_5_2_BASE:1.6
	OPENBSD_5_1_BASE:1.5
	OPENBSD_5_1:1.5.0.2
	OPENBSD_5_0:1.4.0.4
	OPENBSD_5_0_BASE:1.4
	OPENBSD_4_9:1.4.0.2
	OPENBSD_4_9_BASE:1.4
	OPENBSD_4_8:1.3.0.4
	OPENBSD_4_8_BASE:1.3
	OPENBSD_4_7:1.3.0.2
	OPENBSD_4_7_BASE:1.3
	OPENBSD_4_6:1.2.0.2
	OPENBSD_4_6_BASE:1.2
	OPENBSD_4_5:1.1.0.4
	OPENBSD_4_5_BASE:1.1;
locks; strict;
comment	@# @;


1.7
date	2013.01.14.20.16.56;	author kurt;	state dead;
branches;
next	1.6;

1.6
date	2012.03.19.19.50.57;	author kurt;	state Exp;
branches;
next	1.5;

1.5
date	2011.09.22.20.26.47;	author kurt;	state Exp;
branches;
next	1.4;

1.4
date	2011.01.11.15.47.49;	author kurt;	state Exp;
branches;
next	1.3;

1.3
date	2009.10.07.01.53.54;	author kurt;	state Exp;
branches;
next	1.2;

1.2
date	2009.05.23.03.03.24;	author kurt;	state Exp;
branches;
next	1.1;

1.1
date	2009.01.04.23.25.16;	author kurt;	state Exp;
branches;
next	;


desc
@@


1.7
log
@Update jdk 1.7 to u9 level:
- Update to u6 via patchset from upstream bsd_port and u6 source from Oracle
- Copied u6 -> u9 patchset from FreeBSD/Greg Lewis's port
- Updated classloader patch from Matthew Dempsky (matthew@@)
okay landry@@
@
text
@$OpenBSD: patch-hotspot_make_bsd_makefiles_vm_make,v 1.6 2012/03/19 19:50:57 kurt Exp $
--- hotspot/make/bsd/makefiles/vm.make.orig	Wed Mar 14 12:33:29 2012
+++ hotspot/make/bsd/makefiles/vm.make	Wed Mar 14 12:33:30 2012
@@@@ -102,6 +102,10 @@@@ ifdef DEFAULT_LIBPATH
 CPPFLAGS += -DDEFAULT_LIBPATH="\"$(DEFAULT_LIBPATH)\""
 endif
 
+ifdef SHARK_LLVM_VERSION
+CPPFLAGS += -DSHARK_LLVM_VERSION="$(SHARK_LLVM_VERSION)"
+endif
+
 # CFLAGS_WARN holds compiler options to suppress/enable warnings.
 CFLAGS += $(CFLAGS_WARN/BYFILE)
 
@


1.6
log
@Update to 1.7.0.02 (u2). Thanks to Greg Lewis <glewis@@eyesbeyond.com>
who did the bsd-port upstream update. okay espie@@, landry@@
@
text
@d1 1
a1 1
$OpenBSD: patch-hotspot_make_bsd_makefiles_vm_make,v 1.5 2011/09/22 20:26:47 kurt Exp $
@


1.5
log
@Update devel/jdk/1.7 to b147 / non-beta
- Remove Early Access now that jdk 1.7 is final
- Use a patch set for all patches from upstream repository:
  http://hg.openjdk.java.net/bsd-port/bsd-port
- Set milestone and build number to fcs b00 to match Oracle.
- Update cacerts file.
- Install unlimited crypto policy.
- Add DIST_SUBDIR=jdk.
- Include patches from icedtea-web for applet hole from
  Landry Breuil <landry@@openbsd.org> via FreeBSD OpenJDK7 port
- Include fix for Oracle bug "7070134: Hotspot crashes with
  sigsegv from PorterStemmer":
  http://hg.openjdk.java.net/hsx/hotspot-comp/hotspot/rev/4e761e7e6e12
okay landry@@ jasper@@
@
text
@d1 4
a4 4
$OpenBSD$
--- hotspot/make/bsd/makefiles/vm.make.orig	Sun Sep 18 11:09:06 2011
+++ hotspot/make/bsd/makefiles/vm.make	Sun Sep 18 14:56:19 2011
@@@@ -96,6 +96,10 @@@@ ifdef DEFAULT_LIBPATH
@


1.4
log
@Update to early access build 122. okay jasper@@
@
text
@d1 6
a6 6
$OpenBSD: patch-hotspot_make_bsd_makefiles_vm_make,v 1.3 2009/10/07 01:53:54 kurt Exp $
--- hotspot/make/bsd/makefiles/vm.make.orig	Mon Nov  1 13:15:19 2010
+++ hotspot/make/bsd/makefiles/vm.make	Mon Nov  1 13:33:41 2010
@@@@ -90,6 +90,10 @@@@ CPPFLAGS =           \
   ${JRE_VERSION}     \
   ${VM_DISTRO}
d8 2
a9 2
+ifdef DEFAULT_LIBPATH
+CPPFLAGS += -DDEFAULT_LIBPATH="\"$(DEFAULT_LIBPATH)\""
a14 106
@@@@ -100,7 +104,7 @@@@ CFLAGS += $(CFLAGS/NOEX)
 CFLAGS += $(EXTRA_CFLAGS)
 LFLAGS += $(EXTRA_CFLAGS)
 
-LIBS += -lm -ldl -lpthread
+LIBS += -lm -pthread
 
 # By default, link the *.o into the library, not the executable.
 LINK_INTO$(LINK_INTO) = LIBJVM
@@@@ -114,9 +118,15 @@@@ include $(MAKEFILES_DIR)/dtrace.make
 #----------------------------------------------------------------------
 # JVM
 
-JVM      = jvm
-LIBJVM   = lib$(JVM).so
-LIBJVM_G = lib$(JVM)$(G_SUFFIX).so
+JVM    = jvm
+ifeq ($(OS_VENDOR), Darwin)
+  LIBJVM   = lib$(JVM).dylib
+  LIBJVM_G = lib$(JVM)$(G_SUFFIX).dylib
+  CFLAGS  += -D_XOPEN_SOURCE -D_DARWIN_C_SOURCE
+else
+  LIBJVM   = lib$(JVM).so
+  LIBJVM_G = lib$(JVM)$(G_SUFFIX).so
+endif
 
 JVM_OBJ_FILES = $(Obj_Files)
 
@@@@ -137,15 +147,7 @@@@ mapfile_reorder : mapfile $(REORDERFILE)
 vm.def: $(Res_Files) $(Obj_Files)
 	sh $(GAMMADIR)/make/bsd/makefiles/build_vm_def.sh *.o > $@@
 
-ifeq ($(SHARK_BUILD), true)
-  STATIC_CXX = false
-else
-  ifeq ($(ZERO_LIBARCH), ppc64)
-    STATIC_CXX = false
-  else
-    STATIC_CXX = true
-  endif
-endif
+STATIC_CXX = false
 
 ifeq ($(LINK_INTO),AOUT)
   LIBJVM.o                 =
@@@@ -157,14 +159,21 @@@@ else
   LFLAGS_VM$(LDNOMAP)      += $(MAPFLAG:FILENAME=$(LIBJVM_MAPFILE))
   LFLAGS_VM                += $(SONAMEFLAG:SONAME=$(LIBJVM))
 
+  ifeq ($(OS_VENDOR), Darwin)
+    LFLAGS_VM += -Xlinker -rpath -Xlinker @@loader_path/.
+    LFLAGS_VM += -Xlinker -rpath -Xlinker @@loader_path/..
+    LFLAGS_VM += -Xlinker -install_name -Xlinker @@rpath/$(@@F)
+  endif
+
   # JVM is statically linked with libgcc[_s] and libstdc++; this is needed to
   # get around library dependency and compatibility issues. Must use gcc not
   # g++ to link.
   ifeq ($(STATIC_CXX), true)
     LFLAGS_VM              += $(STATIC_LIBGCC)
     LIBS_VM                += $(STATIC_STDCXX)
+    LINK_VM                = $(LINK_LIB.c)
   else
-    LIBS_VM                += -lstdc++
+    LINK_VM                = $(LINK_LIB.CC)
   endif
 
   LIBS_VM                  += $(LIBS)
@@@@ -177,7 +186,6 @@@@ ifeq ($(SHARK_BUILD), true)
   LIBS_VM   += $(LLVM_LIBS)
 endif
 
-LINK_VM = $(LINK_LIB.c)
 
 # rule for building precompiled header
 $(PRECOMPILED_HEADER): $(Precompiled_Files)
@@@@ -205,11 +213,6 @@@@ $(LD_SCRIPT): $(LIBJVM_MAPFILE)
 LD_SCRIPT_FLAG = -Wl,-T,$(LD_SCRIPT)
 endif
 
-# With more recent Redhat releases (or the cutting edge version Fedora), if
-# SEBsd is configured to be enabled, the runtime linker will fail to apply
-# the text relocation to libjvm.so considering that it is built as a non-PIC
-# DSO. To workaround that, we run chcon to libjvm.so after it is built. See 
-# details in bug 6538311.
 $(LIBJVM): $(LIBJVM.o) $(LIBJVM_MAPFILE) $(LD_SCRIPT)
 	$(QUIETLY) {                                                    \
 	    echo Linking vm...;                                         \
@@@@ -219,17 +222,6 @@@@ $(LIBJVM): $(LIBJVM.o) $(LIBJVM_MAPFILE) $(LD_SCRIPT)
 	    $(LINK_LIB.CC/POST_HOOK)                                    \
 	    rm -f $@@.1; ln -s $@@ $@@.1;                                  \
 	    [ -f $(LIBJVM_G) ] || { ln -s $@@ $(LIBJVM_G); ln -s $@@.1 $(LIBJVM_G).1; }; \
-            if [ \"$(CROSS_COMPILE_ARCH)\" = \"\" ] ; then                    \
-	      if [ -x /usr/sbin/sebsdenabled ] ; then                 \
-	        /usr/sbin/sebsdenabled;                               \
-                if [ $$? = 0 ] ; then					\
-		  /usr/bin/chcon -t textrel_shlib_t $@@;                 \
-		  if [ $$? != 0 ]; then                                 \
-		    echo "ERROR: Cannot chcon $@@";			\
-		  fi							\
-	        fi							\
-	      fi                                                        \
-            fi 								\
 	}
 
 DEST_JVM = $(JDK_LIBDIR)/$(VM_SUBDIR)/$(LIBJVM)
@


1.3
log
@Update to early access build 72 plus the following:
- sync patches with upstream repo: OpenJDK/bds-port
- fix gtk look and feel issue caused by dlopen of non-matching major
- fix other dlopen's of non-matching majors
- change max memory utilization on i386 to correct build failures
@
text
@d1 4
a4 4
$OpenBSD: patch-hotspot_make_bsd_makefiles_vm_make,v 1.2 2009/05/23 03:03:24 kurt Exp $
--- hotspot/make/bsd/makefiles/vm.make.orig	Sun Sep 27 09:39:51 2009
+++ hotspot/make/bsd/makefiles/vm.make	Sun Sep 27 10:41:35 2009
@@@@ -86,6 +86,10 @@@@ CPPFLAGS =           \
d15 1
a15 2
@@@@ -95,7 +99,7 @@@@ CFLAGS += $(CFLAGS/NOEX)
 # Extra flags from gnumake's invocation or environment
d17 1
d24 2
a25 1
@@@@ -110,7 +114,12 @@@@ include $(MAKEFILES_DIR)/dtrace.make
d28 4
a31 2
 JVM    = jvm$(G_SUFFIX)
-LIBJVM = lib$(JVM).so
d33 3
a35 2
+  LIBJVM = lib$(JVM).dylib
+  CFLAGS += -D_XOPEN_SOURCE -D_DARWIN_C_SOURCE
d37 2
a38 1
+  LIBJVM = lib$(JVM).so
d43 13
a55 5
@@@@ -124,7 +133,7 @@@@ mapfile_reorder : mapfile $(REORDERFILE)
 	rm -f $@@
 	cat $^ > $@@
 
-STATIC_CXX = true
d60 13
a72 1
@@@@ -142,14 +151,14 @@@@ else
d83 2
d91 1
a91 1
@@@@ -177,11 +186,6 @@@@ $(LD_SCRIPT): $(LIBJVM_MAPFILE)
d103 1
a103 2
@@@@ -190,15 +194,6 @@@@ $(LIBJVM): $(LIBJVM.o) $(LIBJVM_MAPFILE) $(LD_SCRIPT)
 		       $(LFLAGS_VM) -o $@@ $(LIBJVM.o) $(LIBS_VM);       \
d106 12
a117 9
-	    if [ -x /usr/sbin/sebsdenabled ] ; then                   \
-	      /usr/sbin/sebsdenabled;                                 \
-              if [ $$? = 0 ] ; then					\
-		/usr/bin/chcon -t textrel_shlib_t $@@;                   \
-		if [ $$? != 0 ]; then                                   \
-		  echo "ERROR: Cannot chcon $@@";			\
-		fi							\
-	      fi							\
-	    fi                                                          \
@


1.2
log
@- update from early access b43 to b59
- sync patches with OpenJDK's bsd_port project
- require a pre-installed package for native_bootstrap
- The new 1.7 class java.nio.channels.spi.AsynchronousChannelProvider
  is not implemented yet on BSD.
- The new 1.7 package java.nio.sctp is not included and not supported on
  OpenBD
@
text
@d1 3
a3 3
$OpenBSD: patch-hotspot_make_bsd_makefiles_vm_make,v 1.1 2009/01/04 23:25:16 kurt Exp $
--- hotspot/make/bsd/makefiles/vm.make.orig	Fri May 15 16:25:29 2009
+++ hotspot/make/bsd/makefiles/vm.make	Fri May 15 17:11:43 2009
d24 1
a24 1
@@@@ -110,7 +114,11 @@@@ include $(MAKEFILES_DIR)/dtrace.make
d31 1
d38 1
a38 1
@@@@ -124,7 +132,7 @@@@ mapfile_reorder : mapfile $(REORDERFILE)
d47 1
a47 1
@@@@ -142,14 +150,14 @@@@ else
d64 1
a64 1
@@@@ -177,11 +185,6 @@@@ $(LD_SCRIPT): $(LIBJVM_MAPFILE)
d76 1
a76 1
@@@@ -190,15 +193,6 @@@@ $(LIBJVM): $(LIBJVM.o) $(LIBJVM_MAPFILE) $(LD_SCRIPT)
@


1.1
log
@Update to early access build 42:
- sync/regen patches
- use os_bsd_x86.cpp from OpenJDK bsd-java repository plus
  Greg Lewis's fixes posted to the bsd-port-dev list
- use Xiaobin Lu's datatype corrections from OpenJDK bug
  6787106 + additional datatype corrections from me.
- use Vladimir Kozlov's bug fix from OpenJDK bug 6782820
- remove obsolete IcedTea awt binary plugs and update binary
  plug distfile
- correctly define DEVTOOLS_PATH for bsd and verify + correct
  Defs-utils.gmk locations for bsd utilities
@
text
@d1 3
a3 3
$OpenBSD$
--- hotspot/make/bsd/makefiles/vm.make.orig	Mon Dec 22 21:13:31 2008
+++ hotspot/make/bsd/makefiles/vm.make	Mon Dec 22 23:29:49 2008
d24 14
a37 1
@@@@ -124,7 +128,7 @@@@ mapfile_reorder : mapfile $(REORDERFILE)
d46 1
a46 1
@@@@ -142,14 +146,14 @@@@ else
d50 1
a50 1
+    LINK_VM = $(LINK_LIB.c)
d53 1
a53 1
+    LINK_VM = $(LINK_LIB.CC)
d63 28
@

