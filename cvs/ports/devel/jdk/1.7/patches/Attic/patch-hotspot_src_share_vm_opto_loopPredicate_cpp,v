head	1.2;
access;
symbols
	OPENBSD_5_1_BASE:1.1
	OPENBSD_5_1:1.1.0.2;
locks; strict;
comment	@# @;


1.2
date	2012.03.19.19.50.57;	author kurt;	state dead;
branches;
next	1.1;

1.1
date	2011.09.22.20.26.47;	author kurt;	state Exp;
branches;
next	;


desc
@@


1.2
log
@Update to 1.7.0.02 (u2). Thanks to Greg Lewis <glewis@@eyesbeyond.com>
who did the bsd-port upstream update. okay espie@@, landry@@
@
text
@$OpenBSD: patch-hotspot_src_share_vm_opto_loopPredicate_cpp,v 1.1 2011/09/22 20:26:47 kurt Exp $
--- hotspot/src/share/vm/opto/loopPredicate.cpp.orig	Mon Jun 27 12:14:20 2011
+++ hotspot/src/share/vm/opto/loopPredicate.cpp	Wed Sep  7 09:44:08 2011
@@@@ -817,6 +817,10 @@@@ bool PhaseIdealLoop::loop_predication_impl(IdealLoopTr
     cl = head->as_CountedLoop();
     // do nothing for iteration-splitted loops
     if (!cl->is_normal_loop()) return false;
+    // Avoid RCE if Counted loop's test is '!='.
+    BoolTest::mask bt = cl->loopexit()->test_trip();
+    if (bt != BoolTest::lt && bt != BoolTest::gt)
+      cl = NULL;
   }
 
   Node* entry = head->in(LoopNode::EntryControl);
@@@@ -958,7 +962,7 @@@@ bool PhaseIdealLoop::loop_predication_impl(IdealLoopTr
       if (TraceLoopPredicate) tty->print_cr("lower bound check if: %d", lower_bound_iff->_idx);
 
       // Test the upper bound
-      Node* upper_bound_bol = rc_predicate(loop, ctrl, scale, offset, init, limit, stride, rng, true);
+      Node* upper_bound_bol = rc_predicate(loop, lower_bound_proj, scale, offset, init, limit, stride, rng, true);
       IfNode* upper_bound_iff = upper_bound_proj->in(0)->as_If();
       _igvn.hash_delete(upper_bound_iff);
       upper_bound_iff->set_req(1, upper_bound_bol);
@


1.1
log
@Update devel/jdk/1.7 to b147 / non-beta
- Remove Early Access now that jdk 1.7 is final
- Use a patch set for all patches from upstream repository:
  http://hg.openjdk.java.net/bsd-port/bsd-port
- Set milestone and build number to fcs b00 to match Oracle.
- Update cacerts file.
- Install unlimited crypto policy.
- Add DIST_SUBDIR=jdk.
- Include patches from icedtea-web for applet hole from
  Landry Breuil <landry@@openbsd.org> via FreeBSD OpenJDK7 port
- Include fix for Oracle bug "7070134: Hotspot crashes with
  sigsegv from PorterStemmer":
  http://hg.openjdk.java.net/hsx/hotspot-comp/hotspot/rev/4e761e7e6e12
okay landry@@ jasper@@
@
text
@d1 1
a1 1
$OpenBSD$
@

