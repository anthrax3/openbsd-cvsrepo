head	1.85;
access;
symbols
	OPENBSD_6_1:1.84.0.2
	OPENBSD_6_1_BASE:1.84
	OPENBSD_6_0:1.81.0.2
	OPENBSD_6_0_BASE:1.81
	OPENBSD_5_9:1.77.0.2
	OPENBSD_5_9_BASE:1.77
	OPENBSD_5_8:1.75.0.4
	OPENBSD_5_8_BASE:1.75
	OPENBSD_5_7:1.72.0.2
	OPENBSD_5_7_BASE:1.72
	OPENBSD_5_6:1.70.0.2
	OPENBSD_5_6_BASE:1.70
	OPENBSD_5_5:1.67.0.2
	OPENBSD_5_5_BASE:1.67
	OPENBSD_5_4:1.64.0.2
	OPENBSD_5_4_BASE:1.64
	OPENBSD_5_3:1.59.0.2
	OPENBSD_5_3_BASE:1.59
	OPENBSD_5_2:1.49.0.2
	OPENBSD_5_2_BASE:1.49
	OPENBSD_5_1_BASE:1.45
	OPENBSD_5_1:1.45.0.2
	OPENBSD_5_0:1.44.0.2
	OPENBSD_5_0_BASE:1.44
	OPENBSD_4_9:1.42.0.2
	OPENBSD_4_9_BASE:1.42
	OPENBSD_4_8:1.35.0.2
	OPENBSD_4_8_BASE:1.35
	OPENBSD_4_7:1.34.0.2
	OPENBSD_4_7_BASE:1.34
	OPENBSD_4_6:1.30.0.2
	OPENBSD_4_6_BASE:1.30
	OPENBSD_4_5:1.27.0.2
	OPENBSD_4_5_BASE:1.27
	OPENBSD_4_4:1.18.0.2
	OPENBSD_4_4_BASE:1.18
	OPENBSD_4_3:1.11.0.2
	OPENBSD_4_3_BASE:1.11
	OPENBSD_4_2:1.4.0.2
	OPENBSD_4_2_BASE:1.4
	kurt_20070508:1.1.1.1
	kurt:1.1.1;
locks; strict;
comment	@# @;


1.85
date	2017.04.10.11.45.26;	author sthen;	state Exp;
branches;
next	1.84;
commitid	XDh1zlSBq0boKsHk;

1.84
date	2017.03.04.22.12.19;	author jca;	state Exp;
branches;
next	1.83;
commitid	1wqnuLqGDtbp5RC3;

1.83
date	2016.08.18.12.29.32;	author sthen;	state Exp;
branches;
next	1.82;
commitid	BphznIX5SueprTya;

1.82
date	2016.08.17.21.36.47;	author sthen;	state Exp;
branches;
next	1.81;
commitid	8LMpIPQteQweeQiP;

1.81
date	2016.06.29.16.14.40;	author espie;	state Exp;
branches;
next	1.80;
commitid	c1yQMbJbfo0CFBcL;

1.80
date	2016.05.07.20.43.10;	author sthen;	state Exp;
branches;
next	1.79;
commitid	kVHMZW343xcPdSP4;

1.79
date	2016.04.09.20.14.48;	author naddy;	state Exp;
branches;
next	1.78;
commitid	v3xsXUgHi26KLfAN;

1.78
date	2016.03.18.21.38.23;	author naddy;	state Exp;
branches;
next	1.77;
commitid	BVkebQSTXSZokeRG;

1.77
date	2015.12.03.21.24.29;	author sthen;	state Exp;
branches;
next	1.76;
commitid	qh8BBe4z9PLvLPKf;

1.76
date	2015.11.24.09.11.04;	author jasper;	state Exp;
branches;
next	1.75;
commitid	x9aAifyKiYiivEom;

1.75
date	2015.07.01.15.44.48;	author kurt;	state Exp;
branches;
next	1.74;
commitid	pYXZV5sso3manCiP;

1.74
date	2015.05.11.14.47.45;	author kurt;	state Exp;
branches;
next	1.73;
commitid	3pSdOmvVXP0NzQPm;

1.73
date	2015.05.08.09.08.44;	author espie;	state Exp;
branches;
next	1.72;
commitid	8WaxsMNN6opOzn9t;

1.72
date	2014.11.20.23.09.44;	author kurt;	state Exp;
branches;
next	1.71;
commitid	9UFS9JLUBWxJH98M;

1.71
date	2014.08.22.09.16.05;	author sthen;	state Exp;
branches;
next	1.70;
commitid	NQbhflttc5G6lcZe;

1.70
date	2014.05.07.15.42.15;	author kurt;	state Exp;
branches;
next	1.69;

1.69
date	2014.05.01.00.47.25;	author kurt;	state Exp;
branches;
next	1.68;

1.68
date	2014.04.30.13.21.00;	author kurt;	state Exp;
branches;
next	1.67;

1.67
date	2013.11.25.14.16.22;	author sthen;	state Exp;
branches;
next	1.66;

1.66
date	2013.10.30.15.23.32;	author dcoppa;	state Exp;
branches;
next	1.65;

1.65
date	2013.10.16.14.12.21;	author bluhm;	state Exp;
branches;
next	1.64;

1.64
date	2013.06.01.21.12.15;	author kurt;	state Exp;
branches
	1.64.2.1;
next	1.63;

1.63
date	2013.04.10.02.49.05;	author kurt;	state Exp;
branches;
next	1.62;

1.62
date	2013.03.29.15.08.44;	author kurt;	state Exp;
branches;
next	1.61;

1.61
date	2013.03.12.04.39.42;	author kurt;	state Exp;
branches;
next	1.60;

1.60
date	2013.03.11.10.50.09;	author espie;	state Exp;
branches;
next	1.59;

1.59
date	2013.02.09.14.49.50;	author sthen;	state Exp;
branches;
next	1.58;

1.58
date	2013.02.07.19.06.56;	author kurt;	state Exp;
branches;
next	1.57;

1.57
date	2013.02.06.22.08.33;	author kurt;	state Exp;
branches;
next	1.56;

1.56
date	2013.02.02.17.39.23;	author kurt;	state Exp;
branches;
next	1.55;

1.55
date	2013.01.24.23.14.54;	author kurt;	state Exp;
branches;
next	1.54;

1.54
date	2013.01.18.22.30.43;	author kurt;	state Exp;
branches;
next	1.53;

1.53
date	2013.01.14.20.16.56;	author kurt;	state Exp;
branches;
next	1.52;

1.52
date	2012.10.24.18.54.03;	author kurt;	state Exp;
branches;
next	1.51;

1.51
date	2012.09.26.18.23.04;	author naddy;	state Exp;
branches;
next	1.50;

1.50
date	2012.08.04.15.06.55;	author ajacoutot;	state Exp;
branches;
next	1.49;

1.49
date	2012.05.03.21.48.21;	author kurt;	state Exp;
branches;
next	1.48;

1.48
date	2012.04.18.03.41.56;	author kurt;	state Exp;
branches;
next	1.47;

1.47
date	2012.04.12.22.27.20;	author matthew;	state Exp;
branches;
next	1.46;

1.46
date	2012.03.19.19.50.56;	author kurt;	state Exp;
branches;
next	1.45;

1.45
date	2011.09.22.20.26.47;	author kurt;	state Exp;
branches;
next	1.44;

1.44
date	2011.05.03.09.35.56;	author landry;	state Exp;
branches;
next	1.43;

1.43
date	2011.05.02.07.23.17;	author landry;	state Exp;
branches;
next	1.42;

1.42
date	2011.02.05.23.11.18;	author ian;	state Exp;
branches;
next	1.41;

1.41
date	2011.01.13.22.35.52;	author kurt;	state Exp;
branches;
next	1.40;

1.40
date	2011.01.11.15.47.49;	author kurt;	state Exp;
branches;
next	1.39;

1.39
date	2010.11.27.11.54.53;	author espie;	state Exp;
branches;
next	1.38;

1.38
date	2010.11.15.19.45.59;	author espie;	state Exp;
branches;
next	1.37;

1.37
date	2010.10.18.17.47.53;	author espie;	state Exp;
branches;
next	1.36;

1.36
date	2010.09.12.16.49.09;	author jasper;	state Exp;
branches;
next	1.35;

1.35
date	2010.07.02.09.40.30;	author jakemsr;	state Exp;
branches;
next	1.34;

1.34
date	2009.10.16.02.22.26;	author kurt;	state Exp;
branches;
next	1.33;

1.33
date	2009.10.07.20.35.47;	author kili;	state Exp;
branches;
next	1.32;

1.32
date	2009.10.07.01.53.54;	author kurt;	state Exp;
branches;
next	1.31;

1.31
date	2009.08.10.06.31.07;	author kili;	state Exp;
branches;
next	1.30;

1.30
date	2009.06.10.19.01.09;	author kurt;	state Exp;
branches;
next	1.29;

1.29
date	2009.05.23.03.03.24;	author kurt;	state Exp;
branches;
next	1.28;

1.28
date	2009.03.15.09.25.04;	author espie;	state Exp;
branches;
next	1.27;

1.27
date	2009.03.01.20.43.09;	author naddy;	state Exp;
branches;
next	1.26;

1.26
date	2009.01.17.11.37.42;	author kurt;	state Exp;
branches;
next	1.25;

1.25
date	2009.01.16.16.49.29;	author kurt;	state Exp;
branches;
next	1.24;

1.24
date	2009.01.04.23.25.15;	author kurt;	state Exp;
branches;
next	1.23;

1.23
date	2008.12.22.15.06.39;	author kurt;	state Exp;
branches;
next	1.22;

1.22
date	2008.12.22.14.56.40;	author kurt;	state Exp;
branches;
next	1.21;

1.21
date	2008.12.22.13.22.12;	author kurt;	state Exp;
branches;
next	1.20;

1.20
date	2008.12.21.03.59.44;	author kurt;	state Exp;
branches;
next	1.19;

1.19
date	2008.10.22.16.02.24;	author kurt;	state Exp;
branches;
next	1.18;

1.18
date	2008.08.01.20.22.48;	author kurt;	state Exp;
branches;
next	1.17;

1.17
date	2008.06.30.20.16.37;	author naddy;	state Exp;
branches;
next	1.16;

1.16
date	2008.06.28.12.34.58;	author kurt;	state Exp;
branches;
next	1.15;

1.15
date	2008.05.05.02.51.20;	author kurt;	state Exp;
branches;
next	1.14;

1.14
date	2008.03.21.02.46.43;	author kurt;	state Exp;
branches;
next	1.13;

1.13
date	2008.03.19.20.44.18;	author kurt;	state Exp;
branches;
next	1.12;

1.12
date	2008.03.19.18.05.43;	author kurt;	state Exp;
branches;
next	1.11;

1.11
date	2008.02.26.18.26.23;	author kurt;	state Exp;
branches;
next	1.10;

1.10
date	2007.11.09.15.27.55;	author kurt;	state Exp;
branches;
next	1.9;

1.9
date	2007.11.07.17.17.41;	author kurt;	state Exp;
branches;
next	1.8;

1.8
date	2007.11.07.17.04.36;	author kurt;	state Exp;
branches;
next	1.7;

1.7
date	2007.11.07.03.53.53;	author kurt;	state Exp;
branches;
next	1.6;

1.6
date	2007.09.16.02.53.00;	author merdely;	state Exp;
branches;
next	1.5;

1.5
date	2007.09.06.15.46.18;	author kurt;	state Exp;
branches;
next	1.4;

1.4
date	2007.08.07.16.07.22;	author kurt;	state Exp;
branches;
next	1.3;

1.3
date	2007.07.13.22.52.35;	author kurt;	state Exp;
branches;
next	1.2;

1.2
date	2007.05.09.15.48.31;	author kurt;	state Exp;
branches;
next	1.1;

1.1
date	2007.05.08.17.06.18;	author kurt;	state Exp;
branches
	1.1.1.1;
next	;

1.1.1.1
date	2007.05.08.17.06.18;	author kurt;	state Exp;
branches;
next	;

1.64.2.1
date	2014.03.13.13.30.28;	author dcoppa;	state Exp;
branches;
next	;


desc
@@


1.85
log
@use LIBCXX
@
text
@# $OpenBSD: Makefile,v 1.84 2017/03/04 22:12:19 jca Exp $

ONLY_FOR_ARCHS=	i386 amd64
USE_WXNEEDED=	Yes

COMMENT-main=	Java2(TM) SE Dev Kit v${V}
COMMENT-jre=	Java2(TM) SE Runtime Environment v${V}
U=		80
V=		1.7.0.${U}
B=		b15
PKGNAME=	jdk-${V}
PKGNAME-main=	jdk-${V}
PKGNAME-jre=	jre-${V}
EPOCH=		0
REVISION=	2

JDK_SRC=	openjdk-7u40-fcs-src-b43-26_aug_2013.zip
PATCH_SET=	openjdk-7u${U}-patch-set-20150423.zip

DISTFILES=	${JDK_SRC} ${PATCH_SET}:1
EXTRACT_ONLY=	${JDK_SRC} ${PATCH_SET}
DIST_SUBDIR=	jdk

CATEGORIES=	devel/jdk java

MULTI_PACKAGES=	-main -jre

FLAVORS=	with_ipv6
PSEUDO_FLAVORS=	native_bootstrap
FLAVOR?=

HOMEPAGE=	http://openjdk.java.net/

MASTER_SITES=	http://download.java.net/openjdk/jdk7u40/promoted/b43/ \
		http://openbsd.dead-parrot.de/distfiles/ \
		https://distfiles.nl/
MASTER_SITES1=  http://www.intricatesoftware.com/distfiles/ \
		http://openbsd.dead-parrot.de/distfiles/ \
		https://distfiles.nl/
MASTER_SITES2=	https://spacehopper.org/mirrors/ \
		http://www.intricatesoftware.com/distfiles/
MASTER_SITES3=	${MASTER_SITE_APACHE:=ant/binaries/} \
		http://archive.apache.org/dist/ant/binaries/

MAINTAINER=	Kurt Miller <kurt@@openbsd.org>

# GPLv2 w/CLASSPATH exception
PERMIT_PACKAGE_CDROM=	Yes

USE_GROFF =	Yes
NO_TEST=	Yes

APACHE_ANT=	apache-ant-1.9.3-bin.tar.gz
SUPDISTFILES+=	openjdk7-bootjdk-i386-20160817.tar.gz:2 \
		openjdk7-bootjdk-amd64-20160817.tar.gz:2 \
		${APACHE_ANT}:3

.if ${FLAVOR:Mnative_bootstrap}
INSTALLED!= (pkg_info -qe "jdk->=1.7.0.00v0,<1.8v0" && echo yes) || echo no
.if ${INSTALLED:L} != "yes"
ERRORS += "Fatal: This flavor requires an installed 1.7.0.00v0 or greater jdk package"
.endif
BUILD_DEPENDS+=	jdk->=1.7.0.00v0,<1.8v0:devel/jdk/1.7 \
		devel/apache-ant>=1.8.2
ALT_BOOTDIR=	${LOCALBASE}/jdk-1.7.0
.else
BOOT_JDK=	openjdk7-bootjdk-${ARCH}-20160817.tar.gz
.include <bsd.port.arch.mk>
.if (${ARCH}==amd64) || (${ARCH}==i386)
DISTFILES+=	${BOOT_JDK}:2
.endif
DISTFILES+=	${APACHE_ANT}:3
EXTRACT_ONLY+=	${BOOT_JDK} ${APACHE_ANT}
MAKE_ENV+=	ANT_HOME=${WRKDIR}/apache-ant-1.9.3 \
		LD_LIBRARY_PATH=${WRKDIR}/bootjdk-libs
ALT_BOOTDIR=	${WRKDIR}/bootjdk
.endif

BUILD_DEPENDS+=	archivers/zip \
		archivers/unzip \
		print/cups,-libs
LIB_DEPENDS=	converters/libiconv
WANTLIB=	X11 Xext Xi Xtst Xrender c freetype iconv m pthread sndio \
		${LIBCXX} z

USE_GMAKE=	Yes

# Don't call make -jN, instead pass MAKE_JOBS to HOTSPOT_BUILD_JOBS
PARALLEL_BUILD=         No

# Allow HOTSPOT_BUILD_JOBS to be overridden
HOTSPOT_BUILD_JOBS?= ${MAKE_JOBS}

MAKE_ENV+=	ALT_BOOTDIR=${ALT_BOOTDIR} \
		ALT_FREETYPE_HEADERS_PATH=${X11BASE}/include \
		ALT_FREETYPE_LIB_PATH=${X11BASE}/lib \
		ALT_PACKAGE_PATH=${LOCALBASE} \
		ALT_X11_PATH=${X11BASE} \
		DEFAULT_LIBPATH="/usr/lib:${X11BASE}/lib:${LOCALBASE}/lib" \
		NO_DOCS=true \
		CC="${CC}" \
		CXX="${CXX}" \
		COMPILER_WARNINGS_FATAL=false \
		USERNAME=${USER} \
		MILESTONE=fcs \
		BUILD_NUMBER=${B} \
		JDK_UPDATE_VERSION=${U} \
		HOTSPOT_BUILD_JOBS=${HOTSPOT_BUILD_JOBS}

MAKE_FLAGS =	CC="${CC}" \
		CPP="${CC} -E" \
		CXX="${CXX}"

#ALL_TARGET=	debug_build

.if !${FLAVOR:Mwith_ipv6}
MAKE_ENV+=	DONT_ENABLE_IPV6="YES"
.endif

JDKHOME=	jdk-1.7.0
JREHOME=	jre-1.7.0

SUBST_VARS=	JDKHOME JREHOME

WRKDIST=	${WRKDIR}/openjdk
JVMARCH=	${MACHINE_ARCH:S/i386/i586/}
BUILDDIR=	${WRKDIST}/build/bsd-${JVMARCH}
JDKIMAGEDIR=	${BUILDDIR}/j2sdk-image
JREIMAGEDIR=	${BUILDDIR}/j2re-image
 
.if ${MACHINE_ARCH} == "i386"
PKG_ARGS+=	-Dclient_vm=1
.else
PKG_ARGS+=	-Dclient_vm=0
.endif

COPYFILES=	hotspot/src/os/linux/vm/decoder_linux.cpp \
		jdk/make/common/Defs-linux.gmk \
		jdk/make/common/shared/Defs-linux.gmk \
		jdk/make/tools/sharing/classlist.linux

# create initial bsd src from linux src
post-extract:
	@@for f in ${COPYFILES}; do \
		t=`echo $$f | sed 's/linux/bsd/g'`; \
		sed 's/linux/bsd/g; s/Linux/Bsd/g' < ${WRKDIST}/$$f > ${WRKDIST}/$$t; \
	done
	@@cp -f ${FILESDIR}/cacerts ${WRKDIST}/jdk/src/share/lib/security
	@@chmod 0644 ${WRKDIST}/jdk/src/share/lib/security/cacerts
	@@cp -f ${FILESDIR}/PLATFORM_API_BSDOS_PCM.c \
		${WRKDIST}/jdk/src/solaris/native/com/sun/media/sound
	@@cd ${WRKDIST} && \
		${PATCH} -p0 -z .orig.u${U} --quiet < ${WRKDIR}/${PATCH_SET:R}
	@@perl -pi -e 's|build-policy install-limited|build-policy install-unlimited|' \
		${WRKDIST}/jdk/make/javax/crypto/Makefile


post-build:
	@@rm -rf ${JDKIMAGEDIR}/man/ja ${JDKIMAGEDIR}/man/ja_JP.UTF-8 \
		${JREIMAGEDIR}/man/ja ${JREIMAGEDIR}/man/ja_JP.UTF-8

do-install:
	${INSTALL_DATA_DIR} ${PREFIX}/${JDKHOME}
	cd ${JDKIMAGEDIR} && tar -cf - * | tar -C ${PREFIX}/${JDKHOME} -xf - 
	${INSTALL_DATA_DIR} ${PREFIX}/${JREHOME}
	cd ${JREIMAGEDIR} && tar -cf - * | tar -C ${PREFIX}/${JREHOME} -xf -

.include <bsd.port.mk>

# The bootjdk is the jdk image with some parts deleted
# and a copy of the system shared libs needed to run it.
# The parts deleted are not needed for bootstrap and would
# require more system shared libs to be saved.
build-bootjdk: ${_BUILD_COOKIE}
	@@rm -rf ${WRKDIR}/tmp
	@@mkdir -p ${WRKDIR}/tmp/bootjdk
	@@mkdir -p ${WRKDIR}/tmp/bootjdk-libs
	@@cd ${JDKIMAGEDIR} && tar -cf - * | tar -C ${WRKDIR}/tmp/bootjdk -xf - 
	@@cd ${WRKDIR}/tmp/bootjdk && rm -rf demo sample
	@@cd ${WRKDIR}/tmp/bootjdk && rm bin/appletviewer bin/policytool jre/bin/policytool
	@@cd ${WRKDIR}/tmp/bootjdk/jre/lib/${ARCH} && rm libnpt.so libinstrument.so libsplashscreen.so libjsound.so xawt/libmawt.so
	@@LD_LIBRARY_PATH="${WRKDIR}/tmp/bootjdk/jre/lib/${ARCH}:${WRKDIR}/tmp/bootjdk/jre/lib/${ARCH}/server" \
		find ${WRKDIR}/tmp/bootjdk -type f -perm -500 -exec ldd {} \; 2>/dev/null | \
		grep rlib | cut -d"/" -f 2-20 | sort -u | grep -v "\.so$$" | \
		xargs -I % cp /% ${WRKDIR}/tmp/bootjdk-libs
	@@cd ${WRKDIR}/tmp && tar czf openjdk7-bootjdk-${ARCH}-$$(date +%Y%m%d).tar.gz bootjdk*
	@@echo "New bootjdk is located at ${WRKDIR}/tmp/openjdk7-bootjdk-${ARCH}-$$(date +%Y%m%d).tar.gz"
@


1.84
log
@Honour CC/CXX
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.83 2016/08/18 12:29:32 sthen Exp $
d84 1
a84 1
		stdc++ z
@


1.83
log
@use the centralized ld "wxneeded" wrapper for the jdk ports.
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.82 2016/08/17 21:36:47 sthen Exp $
d109 4
@


1.82
log
@mark jdk/1.7 as wxneeded (and provide new amd64/i386 bootstraps), this is
done via an ld wrapper script in ${WRKDIR}/bin because the build process is
fairly complicated and already involves several layers of patches.
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.81 2016/06/29 16:14:40 espie Exp $
d4 1
a139 2
	@@printf '#!/bin/sh\nexec /usr/bin/ld -z wxneeded $$*\n' > ${WRKDIR}/bin/ld
	@@chmod 755 ${WRKDIR}/bin/ld
@


1.81
log
@add is-branch to all trivial ports that exist as multiple branches.
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.80 2016/05/07 20:43:10 sthen Exp $
d14 1
a14 1
REVISION=	1
d53 2
a54 2
SUPDISTFILES+=	openjdk7-bootjdk-i386-20160412.tar.gz:2 \
		openjdk7-bootjdk-amd64-20160412.tar.gz:2 \
d66 1
a66 1
BOOT_JDK=	openjdk7-bootjdk-${ARCH}-20160412.tar.gz
d139 2
@


1.80
log
@new bootstraps for TIB
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.79 2016/04/09 20:14:48 naddy Exp $
d14 1
a14 1
REVISION=	0
@


1.79
log
@replace libiconv module with library dependency; no bump needed
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.78 2016/03/18 21:38:23 naddy Exp $
d53 2
a54 2
SUPDISTFILES+=	openjdk7-bootjdk-i386-20140430.tar.gz:2 \
		openjdk7-bootjdk-amd64-20140430.tar.gz:2 \
d66 1
a66 1
BOOT_JDK=	openjdk7-bootjdk-${ARCH}-20140430.tar.gz
@


1.78
log
@remove SHARED_ONLY from simple ports that use the gettext or libiconv module
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.77 2015/12/03 21:24:29 sthen Exp $
d81 3
a83 2
MODULES=	converters/libiconv
WANTLIB=	X11 Xext Xi Xtst Xrender c freetype m pthread sndio stdc++ z
@


1.77
log
@switch my distfiles mirror to https
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.76 2015/11/24 09:11:04 jasper Exp $
a2 1
SHARED_ONLY=	Yes
@


1.76
log
@switch distfiles.nl to SSL, setup with security/letsencrypt/client
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.75 2015/07/01 15:44:48 kurt Exp $
d40 1
a40 1
MASTER_SITES2=	http://spacehopper.org/mirrors/ \
@


1.75
log
@Fix unpack200 segfault due to symbol visablity.
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.74 2015/05/11 14:47:45 kurt Exp $
d36 1
a36 1
		http://distfiles.nl/
d39 1
a39 1
		http://distfiles.nl/
@


1.74
log
@- Update to 7u80 which includes Java SE Critical Patch Updates:
http://www.oracle.com/technetwork/java/javase/7u-relnotes-515228.html
- Support Gnome shell as Mutter backport from jdk8 from Christian Schulte:
http://hg.openjdk.java.net/jdk8/jdk8/jdk/rev/8530456e0091
okay sthen@@ kili@@ ajacoutot@@
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.73 2015/05/08 09:08:44 espie Exp $
d15 1
@


1.73
log
@don't depend on modes in the ports tree being what we want installed
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.72 2014/11/20 23:09:44 kurt Exp $
d8 1
a8 1
U=		71
d10 1
a10 1
B=		b14
d17 1
a17 1
PATCH_SET=	openjdk-7u${U}-patch-set-20141115.zip
@


1.72
log
@update to u71 including security fixes. okay sthen@@
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.71 2014/08/22 09:16:05 sthen Exp $
d143 1
@


1.71
log
@Update to Java 7u65, including some security fixes.
Committing on behalf of kurt@@
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.70 2014/05/07 15:42:15 kurt Exp $
d8 1
a8 1
U=		65
d10 1
a10 1
B=		b17
d17 1
a17 1
PATCH_SET=	openjdk-7u${U}-patch-set-20140723.zip
@


1.70
log
@- Unlink jdk/1.6 and make jdk/1.7 the default jdk for all java ports
- Adjust java.port.mk and cmake to use 1.7
- Adjust jdk/1.7 for pkg_add upgrades
okay sthen@@, jasper@@, ajacoutot@@
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.69 2014/05/01 00:47:25 kurt Exp $
d8 1
a8 1
U=		55
d10 1
a10 1
B=		b13
a13 2
REVISION-main=	1
REVISION-jre=	1
d17 1
a17 1
PATCH_SET=	openjdk-7u${U}-patch-set-20140428.zip
@


1.69
log
@- Change bootstrap to not depend on jdk/1.6. Builds on i386 now but
not sure if i386 is fully stable yet.
okay sthen@@
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.68 2014/04/30 13:21:00 kurt Exp $
d14 2
a15 2
REVISION-main=	0
REVISION-jre=	0
@


1.68
log
@- Update to 7u55 including several security updates
- Remove patches included in upstream repository
- Update cacerts (from FreeBSD)
- Add build-bootjdk makefile target in prep for new bootstrap
- Allow changes to LD_LIBRARY_PATH so that new bootstrap will work
okay sthen@@, dcoppa@@, ian@@
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.67 2013/11/25 14:16:22 sthen Exp $
d14 2
d41 4
d54 5
d64 2
a65 1
BUILD_DEPENDS+=	jdk->=1.7.0.00v0,<1.8v0:devel/jdk/1.7
d68 10
a77 2
BUILD_DEPENDS+=	jdk->=1.6,<1.7:devel/jdk/1.6
ALT_BOOTDIR=	${LOCALBASE}/jdk-1.6.0
d80 1
a80 2
BUILD_DEPENDS+=	devel/apache-ant>=1.8.2 \
		archivers/zip \
d94 1
a94 1
MAKE_ENV=	ALT_BOOTDIR=${ALT_BOOTDIR} \
@


1.67
log
@kill VMEM_WARNING
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.66 2013/10/30 15:23:32 dcoppa Exp $
d8 1
a8 1
U=		21
d10 1
a10 1
B=		b11
a13 1
REVISION=	2
d16 2
a17 2
JDK_SRC=	openjdk-7u6-fcs-src-b24-28_aug_2012.zip
PATCH_SET=	openjdk-7u${U}-patch-set-20130506.zip
d33 1
a33 1
MASTER_SITES=	http://www.java.net/download/openjdk/jdk7u6/promoted/${B}/ \
d145 19
@


1.66
log
@Fix DefaultAsynchronousChannelProvider.create so it does not crash
("java.lang.InternalError: platform not recognized"), but instead
creates an instance of BsdAsynchronousChannelProvider().

From FreeBSD PR 183389

okay kurt@@ (maintainer)
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.65 2013/10/16 14:12:21 bluhm Exp $
a60 1
VMEM_WARNING=	Yes
@


1.65
log
@Including the header file netinet6/in6_var.h from netinet/in_var.h
automatically is bad.  To change that, a few ports must be adapted.
Do an explicit #include <netinet6/in6_var.h> when it is needed.
OK ajacoutot@@
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.64 2013/06/01 21:12:15 kurt Exp $
d14 1
a14 1
REVISION=	1
@


1.64
log
@- Update to u21 which includes serveral security updates. okay giovanni@@
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.63 2013/04/10 02:49:05 kurt Exp $
d14 1
@


1.64.2.1
log
@Add this patch here too, so I can commit a security update for the tomcats.

Requested by, and OK jasper@@

Original commit message:

Fix DefaultAsynchronousChannelProvider.create so it does not crash
("java.lang.InternalError: platform not recognized"), but instead
creates an instance of BsdAsynchronousChannelProvider().

From FreeBSD PR 183389

okay kurt@@ (maintainer)
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.64 2013/06/01 21:12:15 kurt Exp $
a13 1
REVISION=	0
@


1.63
log
@- remove lack of ORIGIN support work-around
- remove build dir from rpath
- fix include path order in awt
- fix FontConfiguration logic for BSD
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.62 2013/03/29 15:08:44 kurt Exp $
d8 3
a10 2
V=		1.7.0.17
B=		b02
a13 2
REVISION-main=	1
REVISION-jre=	1
d17 1
a17 1
PATCH_SET=	openjdk-7u17-patch-set-20130310.zip
d89 1
a89 1
		JDK_UPDATE_VERSION=17 \
d130 1
a130 1
		${PATCH} -p0 -z .orig.u17 --quiet < ${WRKDIR}/${PATCH_SET:R}
@


1.62
log
@- Add missing symbol to mapfile to fix UnsatisfiedLinkError in jconsole.
Reported by Christian Schulte.
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.61 2013/03/12 04:39:42 kurt Exp $
d13 2
a14 2
REVISION-main=	0
REVISION-jre=	0
@


1.61
log
@- Update to 7u17 which contains multiple security corrections
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.60 2013/03/11 10:50:09 espie Exp $
d13 2
@


1.60
log
@PERMIT_* / REGRESS->TEST sweep
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.59 2013/02/09 14:49:50 sthen Exp $
d8 2
a9 2
V=		1.7.0.11
B=		b24
a11 1
REVISION-main=	2
a12 1
REVISION-jre=	2
d16 1
a16 2
PATCH_SET=	openjdk-7u10-patch-set-20130117.zip
PATCH_SET2=	openjdk-7u11-patch-set-20130118.zip
d18 2
a19 2
DISTFILES=	${JDK_SRC} ${PATCH_SET}:1 ${PATCH_SET2}:1
EXTRACT_ONLY=	${JDK_SRC} ${PATCH_SET} ${PATCH_SET2}
d88 1
a88 1
		JDK_UPDATE_VERSION=11 \
d129 1
a129 3
		${PATCH} -p0 -z .orig.u10 --quiet < ${WRKDIR}/${PATCH_SET:R}
	@@cd ${WRKDIST} && \
		${PATCH} -p0 -z .orig.u11 --quiet < ${WRKDIR}/${PATCH_SET2:R}
@


1.59
log
@Don't use ${FLAVOR:L}, we only support lower-case flavours now.
OK ajacoutot@@ espie@@
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.58 2013/02/07 19:06:56 kurt Exp $
a45 3
PERMIT_PACKAGE_FTP=	Yes
PERMIT_DISTFILES_CDROM= Yes
PERMIT_DISTFILES_FTP=	Yes
d48 1
a48 1
NO_REGRESS=	Yes
@


1.58
log
@- Allow HOTSPOT_BUILD_JOBS to be overridden from make env. okay jasper@@
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.57 2013/02/06 22:08:33 kurt Exp $
d53 1
a53 1
.if ${FLAVOR:L:Mnative_bootstrap}
d99 1
a99 1
.if !${FLAVOR:L:Mwith_ipv6}
@


1.57
log
@- Fix java.lang.UnsatisfiedLinkError: java.awt.Toolkit.initIDs by
correcting awt Makefile merge error.
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.56 2013/02/02 17:39:23 kurt Exp $
d78 2
d95 1
a95 1
		HOTSPOT_BUILD_JOBS=${MAKE_JOBS}
@


1.56
log
@- Restore poll(2) based NET_Timeout implementation that was changed
  to select(2) for MacOSX support. The select based implementation
  was causing crashes under load for at least FreeBSD.
- Fix MulticastSocket.setInterface(). Report and fix from Oliver
  Lehmann on bsd-port list.
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.55 2013/01/24 23:14:54 kurt Exp $
d12 1
a12 1
REVISION-main=	1
d14 1
a14 1
REVISION-jre=	1
@


1.55
log
@- Add missing KQueueArrayWrapper symbols to nio mapfile-bsd to correct
UnsatisfiedLinkErrors.
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.54 2013/01/18 22:30:43 kurt Exp $
d12 1
a12 1
REVISION-main=	0
d14 1
a14 1
REVISION-jre=	0
@


1.54
log
@Update to 7u11. Security: CVE-2013-0422
- Update man patchset to upstream bsd-port at u10
- u11 patchset from FreeBSD/Greg Lewis's port
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.53 2013/01/14 20:16:56 kurt Exp $
d12 1
d14 1
@


1.53
log
@Update jdk 1.7 to u9 level:
- Update to u6 via patchset from upstream bsd_port and u6 source from Oracle
- Copied u6 -> u9 patchset from FreeBSD/Greg Lewis's port
- Updated classloader patch from Matthew Dempsky (matthew@@)
okay landry@@
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.52 2012/10/24 18:54:03 kurt Exp $
d8 1
a8 1
V=		1.7.0.09
d16 2
a17 2
PATCH_SET=	openjdk-7u6-patch-set-20130111.zip
PATCH_SET2=	openjdk-7u9-patch-set-20130110.zip
d90 1
a90 1
		JDK_UPDATE_VERSION=09 \
d131 1
a131 1
		${PATCH} -p0 -z .orig.u6 --quiet < ${WRKDIR}/${PATCH_SET:R}
d133 1
a133 1
		${PATCH} -p0 -z .orig.u9 --quiet < ${WRKDIR}/${PATCH_SET2:R}
@


1.52
log
@- Restore man pages in PLIST-main. Reported by Tomas Bodzar
- Patch to serialize gconf client access which corrects gconf/dbus
related crashes. From Christian Schulte
- Patch to stop the JDK from querying the locale using the LC_MESSAGES
category. From Christian Schulte
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.51 2012/09/26 18:23:04 naddy Exp $
d8 2
a9 2
V=		1.7.0.03
B=		b13
a11 1
REVISION-main=	1
a12 1
REVISION-jre=	1
d15 3
a17 2
# see openjdk/jaxp/jaxp.properties & openjdk/jaxws/jaxws.properties 
# in ${WRKDIR} for names and download locations of extra distfiles
d19 1
a19 8
JDK_SRC=	openjdk-7u2-fcs-src-${B}-17_nov_2011.zip
JAXP_SRC=	jaxp145_01.zip
JAXWS_SRC=	jdk7-jaxws2_2_4-b04-2011_06_01.zip
JAF_SRC=	jdk7-jaf-2010_08_19.zip
PATCH_SET=	openjdk-7u2-patch-set-20120314.zip
PATCH_SET2=	openjdk-7u3-patch-set-20120417.zip

DISTFILES=	${JDK_SRC} ${JAXP_SRC}:0 ${JAXWS_SRC}:1 ${JAF_SRC}:2 ${PATCH_SET}:3 ${PATCH_SET2}:3
d33 1
a33 13
MASTER_SITES=	http://www.java.net/download/openjdk/jdk7u2/promoted/${B}/ \
		http://openbsd.dead-parrot.de/distfiles/ \
		http://distfiles.nl/
MASTER_SITES0=  http://download.java.net/jaxp/1.4.5/ \
		http://icedtea.classpath.org/download/drops/ \
		http://openbsd.dead-parrot.de/distfiles/ \
		http://distfiles.nl/
MASTER_SITES1=  http://download.java.net/glassfish/components/jax-ws/openjdk/jdk7/ \
		http://icedtea.classpath.org/download/drops/ \
		http://openbsd.dead-parrot.de/distfiles/ \
		http://distfiles.nl/
MASTER_SITES2=  http://java.net/downloads/jax-ws/JDK7/ \
		http://icedtea.classpath.org/download/drops/ \
d36 1
a36 1
MASTER_SITES3=  http://www.intricatesoftware.com/distfiles/ \
a79 1
		ALT_DROPS_DIR=${DISTDIR}/${DIST_SUBDIR} \
d86 1
d89 2
a90 2
		BUILD_NUMBER=b04 \
		JDK_UPDATE_VERSION=03 \
d116 1
a116 19
COPYDIRS=	hotspot/agent/src/os/linux \
		hotspot/agent/src/share/classes/sun/jvm/hotspot/debugger/linux \
		hotspot/agent/src/share/classes/sun/jvm/hotspot/debugger/linux/amd64 \
		hotspot/agent/src/share/classes/sun/jvm/hotspot/debugger/linux/x86 \
		hotspot/agent/src/share/classes/sun/jvm/hotspot/runtime/linux \
		hotspot/agent/src/share/classes/sun/jvm/hotspot/runtime/linux_amd64 \
		hotspot/agent/src/share/classes/sun/jvm/hotspot/runtime/linux_x86 \
		hotspot/src/os/linux/vm \
		hotspot/src/os_cpu/linux_x86/vm \
		hotspot/src/os_cpu/linux_zero/vm \
		hotspot/make/linux \
		hotspot/make/linux/makefiles \
		jdk/src/linux/doc/man \
		jdk/src/linux/doc/man/ja

COPYFILES=	hotspot/agent/src/share/classes/sun/jvm/hotspot/LinuxVtblAccess.java \
		corba/make/common/Defs-linux.gmk \
		corba/make/common/shared/Defs-linux.gmk \
		jdk/make/com/sun/tools/attach/mapfile-linux \
d119 1
a119 14
		jdk/make/java/nio/mapfile-linux \
		jdk/make/netbeans/common/architectures/name-Linux.properties \
		jdk/make/sun/awt/mapfile-vers-linux \
		jdk/make/tools/sharing/classlist.linux \
		jdk/src/solaris/classes/java/lang/UNIXProcess.java.linux \
		jdk/src/solaris/classes/sun/awt/fontconfigs/linux.fontconfig.properties \
		jdk/src/solaris/classes/sun/nio/fs/LinuxFileSystemProvider.java \
		jdk/src/solaris/classes/sun/nio/fs/LinuxFileSystem.java \
		jdk/src/solaris/classes/sun/nio/fs/LinuxFileStore.java \
		jdk/src/solaris/classes/sun/nio/fs/LinuxNativeDispatcher.java \
		jdk/src/solaris/classes/sun/tools/attach/LinuxAttachProvider.java \
		jdk/src/solaris/classes/sun/tools/attach/LinuxVirtualMachine.java \
		jdk/src/solaris/native/java/net/linux_close.c \
		jdk/src/solaris/native/sun/nio/fs/LinuxNativeDispatcher.c
a122 10
	@@for d in ${COPYDIRS}; do \
		mkdir -p `echo ${WRKDIST}/$$d | sed 's/linux/bsd/g;'`; \
		cd ${WRKDIST}/$$d; \
		for f in *; do \
			if [ -f $$f ]; then \
				t=`echo ${WRKDIST}/$$d/$$f | sed 's/linux/bsd/g; s/Linux/Bsd/g; s/LINUX/BSD/g'`; \
				sed 's/linux/bsd/g; s/Linux/Bsd/g; s/LINUX/BSD/g' < $$f > $$t; \
			fi; \
		done; \
	done
d124 2
a125 2
		t=`echo $$f | sed 's/linux/bsd/g; s/Linux/Bsd/g; s/LINUX/BSD/g'`; \
		sed 's/linux/bsd/g; s/Linux/Bsd/g; s/LINUX/BSD/g' < ${WRKDIST}/$$f > ${WRKDIST}/$$t; \
a126 1
	@@rm ${WRKDIST}/hotspot/agent/src/os/bsd/proc_service.h
d131 1
a131 1
		${PATCH} -p0 -z .orig.linux --quiet < ${WRKDIR}/${PATCH_SET:R}
d133 1
a133 1
		${PATCH} -p0 -z .orig.u2 --quiet < ${WRKDIR}/${PATCH_SET2:R}
@


1.51
log
@Permit building with MAKE_JOBS:
Don't call make -jN, instead pass MAKE_JOBS to HOTSPOT_BUILD_JOBS

ok kurt@@, espie@@
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.50 2012/08/04 15:06:55 ajacoutot Exp $
d12 1
a12 1
REVISION-main=	0
d14 1
a14 1
REVISION-jre=	0
@


1.50
log
@cups -> cups,-libs
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.49 2012/05/03 21:48:21 kurt Exp $
d93 4
d111 1
a111 1
		HOTSPOT_BUILD_JOBS=${HOTSPOT_BUILD_JOBS}
@


1.49
log
@Use -gstabs to address package growth on amd64. Noted by sthen@@ tested
by naddy@@
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.48 2012/04/18 03:41:56 kurt Exp $
d87 1
a87 1
		print/cups
@


1.48
log
@Update to 7u3 which fixes numerous security problems.
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.47 2012/04/12 22:27:20 matthew Exp $
d12 1
d14 1
@


1.47
log
@Fix our patch for ClassLoader.loadLibrary().  Make sure that we prefer
libfoo.so.10.0 over libfoo.so.9, and fix the regex to prevent false
positive matches.

ok kurt@@
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.46 2012/03/19 19:50:56 kurt Exp $
d8 1
a8 1
V=		1.7.0.02
a13 1
REVISION=	0
d23 1
d25 2
a26 2
DISTFILES=	${JDK_SRC} ${JAXP_SRC}:0 ${JAXWS_SRC}:1 ${JAF_SRC}:2 ${PATCH_SET}:3
EXTRACT_ONLY=	${JDK_SRC} ${PATCH_SET}
d103 2
a104 2
		BUILD_NUMBER=b13 \
		JDK_UPDATE_VERSION=02 \
d188 2
@


1.46
log
@Update to 1.7.0.02 (u2). Thanks to Greg Lewis <glewis@@eyesbeyond.com>
who did the bsd-port upstream update. okay espie@@, landry@@
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.45 2011/09/22 20:26:47 kurt Exp $
d14 1
@


1.45
log
@Update devel/jdk/1.7 to b147 / non-beta
- Remove Early Access now that jdk 1.7 is final
- Use a patch set for all patches from upstream repository:
  http://hg.openjdk.java.net/bsd-port/bsd-port
- Set milestone and build number to fcs b00 to match Oracle.
- Update cacerts file.
- Install unlimited crypto policy.
- Add DIST_SUBDIR=jdk.
- Include patches from icedtea-web for applet hole from
  Landry Breuil <landry@@openbsd.org> via FreeBSD OpenJDK7 port
- Include fix for Oracle bug "7070134: Hotspot crashes with
  sigsegv from PorterStemmer":
  http://hg.openjdk.java.net/hsx/hotspot-comp/hotspot/rev/4e761e7e6e12
okay landry@@ jasper@@
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.44 2011/05/03 09:35:56 landry Exp $
d8 2
a9 2
V=		1.7.0.00
B=		b147
d18 1
a18 1
JDK_SRC=	openjdk-7-fcs-src-${B}-27_jun_2011.zip
d20 1
a20 1
JAXWS_SRC=	jdk7-jaxws2_2_4-b03-2011_05_27.zip
d22 1
a22 1
PATCH_SET=	openjdk-7-patch-set-20110922.zip
d38 1
a38 1
MASTER_SITES=	http://www.java.net/download/openjdk/jdk7/promoted/${B}/ \
d102 2
a103 1
		BUILD_NUMBER=b00 \
@


1.44
log
@Duh. devel/apache-ant->=1.8.2 is not a valid pkgpath dependency spec,
devel/apache-ant>=1.8.2 is.
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.43 2011/05/02 07:23:17 landry Exp $
d6 2
a7 2
COMMENT-main=	Java2(TM) SE Dev Kit v${V} Early Access ${B}
COMMENT-jre=	Java2(TM) SE Runtime Environment v${V} Early Access ${B}
d9 1
a9 1
B=		b122
d11 2
a12 4
PKGNAME-main=	jdk-${V}${B:S/b/beta/}
REVISION-main =	1
PKGNAME-jre=	jre-${V}${B:S/b/beta/}
REVISION-jre =	1
d18 3
a20 3
JDK_SRC=	openjdk-7-ea-src-${B}-16_dec_2010.zip
JAXP_SRC=	jaxp-1_4_4.zip
JAXWS_SRC=	jdk7-jaxws2_2-2010_08_19.zip
d22 1
d24 3
a26 2
DISTFILES=	${JDK_SRC} ${JAXP_SRC}:0 ${JAXWS_SRC}:1 ${JAF_SRC}:1
EXTRACT_ONLY=	${JDK_SRC}
d41 1
a41 1
MASTER_SITES0=  https://jaxp.dev.java.net/files/documents/913/152561/ \
d45 1
a45 1
MASTER_SITES1=  http://java.net/downloads/jax-ws/JDK7/ \
d49 7
d69 1
a69 1
INSTALLED!= (pkg_info -qe "jdk->=1.7.0.00beta122v0,<1.8v0" && echo yes) || echo no
d71 1
a71 1
ERRORS += "Fatal: This flavor requires an installed 1.7.0.00beta122v0 jdk package or greater"
d73 1
a73 1
BUILD_DEPENDS+=	jdk->=1.7.0.00beta122v0,<1.8v0:devel/jdk/1.7
d93 1
a93 1
		ALT_DROPS_DIR=${DISTDIR} \
d101 2
a134 1
		hotspot/src/os/linux/launcher \
a160 1
		jdk/src/solaris/hpi/include/largefile_linux.h \
d164 1
a164 1
# create initial bsd src from linux src (except for threads_solaris.c)
d171 2
a172 2
				t=`echo ${WRKDIST}/$$d/$$f | sed 's/linux/bsd/g; s/Linux/Bsd/g'`; \
				sed 's/linux/bsd/g; s/Linux/Bsd/g' < $$f > $$t; \
d177 2
a178 2
		t=`echo $$f | sed 's/linux/bsd/g; s/Linux/Bsd/g'`; \
		sed 's/linux/bsd/g; s/Linux/Bsd/g' < ${WRKDIST}/$$f > ${WRKDIST}/$$t; \
a179 5
	@@sed 's/solaris/bsd/g; s/Solaris/Bsd/g' \
		< ${WRKDIST}/jdk/src/solaris/hpi/native_threads/src/threads_solaris.c \
		> ${WRKDIST}/jdk/src/solaris/hpi/native_threads/src/threads_bsd.c
	@@cp ${WRKDIST}/jdk/src/share/lib/security/java.security \
		${WRKDIST}/jdk/src/share/lib/security/java.security-openbsd
d184 5
d191 2
a192 1
	@@rm -rf ${JDKIMAGEDIR}/man/ja ${JREIMAGEDIR}/man/ja
@


1.43
log
@Tighten depends on apache-ant->=1.8.2, remove now unneeded ANT_HOME from
MAKE_ENV, and bump REVISIONs. From Daniel Dickman, thanks!
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.42 2011/02/05 23:11:18 ian Exp $
d74 1
a74 1
BUILD_DEPENDS+=	devel/apache-ant->=1.8.2 \
@


1.42
log
@Security Fix for DoS caused by very small subnormal double, found by Konstantin Preisser
at http://www.exploringbinary.com/java-hangs-when-converting-2-2250738585072012e-308/.
Fix from https://bugs.openjdk.java.net/show_bug.cgi?id=100119.
Ok kurt@@ (maintainer), ok & comments sthen@@, ok naddy@@, aja@@.
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.40 2011/01/11 15:47:49 kurt Exp $
d12 1
a12 1
REVISION-main =	0
d14 1
a14 1
REVISION-jre =	0
d74 1
a74 1
BUILD_DEPENDS+=	devel/apache-ant \
a88 1
		ANT_HOME=${LOCALBASE} \
@


1.41
log
@Correct snafu with pkg version going backwards. Clue bat
beating from espie@@ help and okay landry@@
@
text
@d12 1
d14 1
@


1.40
log
@Update to early access build 122. okay jasper@@
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.39 2010/11/27 11:54:53 espie Exp $
d11 3
a13 2
PKGNAME-main=	jdk-${V}${B}
PKGNAME-jre=	jre-${V}${B}
d60 1
a60 1
INSTALLED!= (pkg_info -e "jdk->=1.7,<1.8" -q && echo yes) || echo no
d62 1
a62 1
ERRORS += "Fatal: This flavor requires an installed 1.7 jdk package"
d64 1
a64 1
BUILD_DEPENDS+=	jdk->=1.7,<1.8:devel/jdk/1.7
@


1.39
log
@minor bumps after pkg_create fix: generate catN entry when needed.
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.38 2010/11/15 19:45:59 espie Exp $
d9 1
a9 3
B=		b72
DISTFILES=	openjdk-7-ea-src-${B}-17_sep_2009.zip \
		jibx_1_1_5.zip:0
a11 1
REVISION-main =	2
d13 11
a23 1
REVISION-jre =	2
d37 7
a43 2
		http://www.phil.uu.nl/~lievisse/distfiles/
MASTER_SITES0=	${MASTER_SITE_SOURCEFORGE:=jibx/} \
d76 1
a76 1
WANTLIB=	X11 Xext Xi Xtst c freetype m pthread sndio stdc++ z
d83 1
a83 1
		ALT_JIBX_LIBS_PATH=${WRKDIR}/jibx/lib \
d127 1
@


1.38
log
@move depends to new style
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.37 2010/10/18 17:47:53 espie Exp $
d14 1
a14 1
REVISION-main =	1
d16 1
a16 1
REVISION-jre =	1
@


1.37
log
@USE_GROFF=Yes
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.36 2010/09/12 16:49:09 jasper Exp $
d13 4
a16 2
PKGNAME-main=	jdk-${V}${B}p1
PKGNAME-jre=	jre-${V}${B}p1
d51 1
a51 1
BUILD_DEPENDS+=	:jdk->=1.7,<1.8:devel/jdk/1.7
d54 1
a54 1
BUILD_DEPENDS+=	:jdk->=1.6,<1.7:devel/jdk/1.6
d59 4
a62 4
BUILD_DEPENDS+=	::devel/apache-ant \
		::archivers/zip \
		::archivers/unzip \
		::print/cups
@


1.36
log
@- move distfiles/ to a proper mirroring location.
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.35 2010/07/02 09:40:30 jakemsr Exp $
d41 1
@


1.35
log
@audio support via sndio
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.34 2009/10/16 02:22:26 kurt Exp $
d31 1
a31 1
		http://www.phil.uu.nl/~lievisse/distfiles/
@


1.34
log
@- recognize cwm as a Non-Reparenting window manager for when cwm
is changed to suport NetWMName. As discussed with oga@@
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.33 2009/10/07 20:35:47 kili Exp $
d13 2
a14 2
PKGNAME-main=	jdk-${V}${B}p0
PKGNAME-jre=	jre-${V}${B}p0
d61 1
a61 1
WANTLIB=	X11 Xext Xi Xtst c freetype m pthread stdc++ z
d162 2
@


1.33
log
@Add some distfile mirrors.

ok jasper@@ kurt@@
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.32 2009/10/07 01:53:54 kurt Exp $
d13 2
a14 2
PKGNAME-main=	jdk-${V}${B}
PKGNAME-jre=	jre-${V}${B}
@


1.32
log
@Update to early access build 72 plus the following:
- sync patches with upstream repo: OpenJDK/bds-port
- fix gtk look and feel issue caused by dlopen of non-matching major
- fix other dlopen's of non-matching majors
- change max memory utilization on i386 to correct build failures
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.31 2009/08/10 06:31:07 kili Exp $
d26 6
a31 2
MASTER_SITES=	http://www.java.net/download/openjdk/jdk7/promoted/${B}/
MASTER_SITES0=	${MASTER_SITE_SOURCEFORGE:=jibx/}
@


1.31
log
@WANTLIB changes after xcb addition and bump.
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.30 2009/06/10 19:01:09 kurt Exp $
d9 2
a10 2
B=		b59
DISTFILES=	openjdk-7-ea-src-${B}-14_may_2009.zip \
d13 2
a14 2
PKGNAME-main=	jdk-${V}${B}p1
PKGNAME-jre=	jre-${V}${B}p1
@


1.30
log
@- binary plugs distfile no longer needed
- sync patches with OpenJDK7 bsd-port repository
- install a usable cacerts
- Remove Interruptible IO support
tested by ian@@ william@@
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.29 2009/05/23 03:03:24 kurt Exp $
d13 2
a14 2
PKGNAME-main=	jdk-${V}${B}p0
PKGNAME-jre=	jre-${V}${B}p0
@


1.29
log
@- update from early access b43 to b59
- sync patches with OpenJDK's bsd_port project
- require a pre-installed package for native_bootstrap
- The new 1.7 class java.nio.channels.spi.AsynchronousChannelProvider
  is not implemented yet on BSD.
- The new 1.7 package java.nio.sctp is not included and not supported on
  OpenBD
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.28 2009/03/15 09:25:04 espie Exp $
d11 1
a11 2
		jdk-7-icedtea-plugs-1.6b.tar.gz:0 \
		jibx_1_1_5.zip:1 
d13 2
a14 2
PKGNAME-main=	jdk-${V}${B}
PKGNAME-jre=	jre-${V}${B}
d27 1
a27 2
MASTER_SITES0=	http://www.intricatesoftware.com/distfiles/
MASTER_SITES1=	${MASTER_SITE_SOURCEFORGE:=jibx/}
a63 1
		ALT_BINARY_PLUGS_PATH=${WRKDIR}/jdk-7-icedtea-plugs \
d98 8
a105 1
COPYDIRS=	hotspot/src/os/linux/launcher \
d113 2
a114 1
COPYFILES=	corba/make/common/Defs-linux.gmk \
d128 1
d132 2
a133 1
		jdk/src/solaris/native/java/net/linux_close.c
d142 1
a142 1
				t=`echo ${WRKDIST}/$$d/$$f | sed 's/linux/bsd/g;'`; \
d156 2
@


1.28
log
@more depends fixes
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.27 2009/03/01 20:43:09 naddy Exp $
d9 4
a12 3
B=		b43
DISTFILES=	openjdk-7-ea-src-${B}-15_jan_2009.zip \
		jdk-7-icedtea-plugs-1.6a.tar.gz:0
d14 2
a15 2
PKGNAME-main=	jdk-${V}${B}p0
PKGNAME-jre=	jre-${V}${B}p0
d25 1
a25 1
HOMEPAGE=	https://jdk7.dev.java.net/
d29 1
d42 4
d59 1
a59 1
WANTLIB=	X11 Xext Xi Xtst c freetype m ossaudio pthread stdc++ z
d67 3
a69 1
		ALT_DEVTOOLS_PATH=${LOCALBASE}/bin \
d106 2
a107 1
		jdk/src/linux/doc/man
d111 1
d120 3
d124 3
a126 1
		jdk/src/solaris/hpi/include/largefile_linux.h
d129 1
a129 1
pre-patch:
d147 2
a151 5
	@@rm -f ${BUILDDIR}/democlasses/demo/jvmti/hprof/src/hprof_md.c.orig \
		${BUILDDIR}/impsrc/com/sun/tools/javah/Util.java.orig \
		${BUILDDIR}/langtools/build/bootstrap/classes/com/sun/tools/javah/Util.java.orig \
		${BUILDDIR}/langtools/build/classes/com/sun/tools/javah/Util.java.orig \
		${BUILDDIR}/classes/com/sun/tools/javah/Util.java.orig
@


1.27
log
@Java bug fix; from kurt@@
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.26 2009/01/17 11:37:42 kurt Exp $
d40 1
a40 1
BUILD_DEPENDS+=	:jdk-1.7.0.*:devel/jdk/1.7
d43 1
a43 1
BUILD_DEPENDS+=	:jdk-1.6.0.*:devel/jdk/1.6
@


1.26
log
@- Update to early access b43:
  http://download.java.net/jdk7/changes/jdk7-b43.html
- Remove KOI8_U char encoding which no longer applies
- Correct datatype warning in fork_and_exec()
- Sync patches
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.25 2009/01/16 16:49:29 kurt Exp $
d13 2
a14 2
PKGNAME-main=	jdk-${V}${B}
PKGNAME-jre=	jre-${V}${B}
@


1.25
log
@Various minor corrections:
- Remove some patches no longer needed
- Sync some corba and jdk makefiles with bsd-port repo
- Another datatype correction in hotspot
- Use proper scoping for clock_get* from bsd-port repo
- Use includeDB corrections from Coleen Phillimore @@ Sun
instead of my own ones. From hotspot-dev list.
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.24 2009/01/04 23:25:15 kurt Exp $
d9 2
a10 2
B=		b42
DISTFILES=	openjdk-7-ea-src-${B}-19_dec_2008.zip \
d13 2
a14 2
PKGNAME-main=	jdk-${V}${B}p0
PKGNAME-jre=	jre-${V}${B}p0
@


1.24
log
@Update to early access build 42:
- sync/regen patches
- use os_bsd_x86.cpp from OpenJDK bsd-java repository plus
  Greg Lewis's fixes posted to the bsd-port-dev list
- use Xiaobin Lu's datatype corrections from OpenJDK bug
  6787106 + additional datatype corrections from me.
- use Vladimir Kozlov's bug fix from OpenJDK bug 6782820
- remove obsolete IcedTea awt binary plugs and update binary
  plug distfile
- correctly define DEVTOOLS_PATH for bsd and verify + correct
  Defs-utils.gmk locations for bsd utilities
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.23 2008/12/22 15:06:39 kurt Exp $
d13 2
a14 2
PKGNAME-main=	jdk-${V}${B}
PKGNAME-jre=	jre-${V}${B}
@


1.23
log
@Fix WANTLIB. No cookie for me.
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.22 2008/12/22 14:56:40 kurt Exp $
d9 3
a11 3
B=		b24
DISTFILES=	openjdk7-${B}.tar.bz2 \
		jdk-7-icedtea-plugs-1.6.tar.gz
d13 2
a14 2
PKGNAME-main=	jdk-${V}${B}p6
PKGNAME-jre=	jre-${V}${B}p6
d26 2
a27 1
MASTER_SITES=	http://www.intricatesoftware.com/distfiles/
d61 1
d81 1
a81 1
WRKDIST=	${WRKDIR}/openjdk7-${B}
d96 2
a97 2
		hotspot/build/linux \
		hotspot/build/linux/makefiles \
@


1.22
log
@Fix some undefined symbols by correcting the non-static link of libjvm.
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.21 2008/12/22 13:22:12 kurt Exp $
d13 2
a14 2
PKGNAME-main=	jdk-${V}${B}p5
PKGNAME-jre=	jre-${V}${B}p5
d52 1
a52 1
WANTLIB=	X11 Xext Xi Xtst c freetype m ossaudio pthread stdc++
@


1.21
log
@Fix symbol conflict issues with eclipse by enabling the use of
version scripts. Also complete SYSTEM_ZLIB build hooks and enable
it to use system libz.
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.20 2008/12/21 03:59:44 kurt Exp $
d13 2
a14 2
PKGNAME-main=	jdk-${V}${B}p4
PKGNAME-jre=	jre-${V}${B}p4
@


1.20
log
@Parellel make doesn't work for the jdk builds so instead of passing
MAKE_JOBS on allow users to set HOTSPOT_BUILD_JOBS via env.
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.19 2008/10/22 16:02:24 kurt Exp $
d13 2
a14 2
PKGNAME-main=	jdk-${V}${B}p3
PKGNAME-jre=	jre-${V}${B}p3
@


1.19
log
@Limit the jdk's view of physical memory to rlimit_cur instead of
rlimit_max. This makes the jdk behave better on amd64.

okay naddy@@ ian@@
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.18 2008/08/01 20:22:48 kurt Exp $
d66 1
a66 1
		HOTSPOT_BUILD_JOBS=${MAKE_JOBS}
@


1.18
log
@Fix starting java via PATH. Reported by several. Debugged by Mark Peloquin
<markpeloquin at gmail.com>, fix by me.

okay pvalchev@@, espie@@
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.17 2008/06/30 20:16:37 naddy Exp $
d13 2
a14 2
PKGNAME-main=	jdk-${V}${B}p2
PKGNAME-jre=	jre-${V}${B}p2
@


1.17
log
@spawn only ${MAKE_JOBS} build jobs in parallel; ok kurt@@
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.16 2008/06/28 12:34:58 kurt Exp $
d13 2
a14 2
PKGNAME-main=	jdk-${V}${B}p1
PKGNAME-jre=	jre-${V}${B}p1
@


1.16
log
@- remove work-arounds for missing getpwuid_r now that we have it
- regen pkg files with @@bin markers
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.15 2008/05/05 02:51:20 kurt Exp $
d66 1
a66 1
		HOTSPOT_BUILD_JOBS=`sysctl -n hw.ncpu`
@


1.15
log
@- Remove -Werror from CFLAGS in hotspot so the build works with user
specified CFLAGS - noticed by steven@@
- Fix comment typo in Makefile - reported by Joachim Schipper
No change in packages so no package bump
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.14 2008/03/21 02:46:43 kurt Exp $
d13 2
a14 2
PKGNAME-main=	jdk-${V}${B}p0
PKGNAME-jre=	jre-${V}${B}p0
@


1.14
log
@- add VMEM_WARNING
- adjust memory calculations so this has a chance of building on systems
  with 256M of real memory. Reported by Dongsheng Song
- bring the the rest of IcedTea's icedtea-graphics.patch and fix typo that
  prevented interactive apps from launching. I expect I will eventually
  will want to convert over to using IcedTea in full in the future.
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.13 2008/03/19 20:44:18 kurt Exp $
d30 1
a30 1
# GLPv2 w/CLASSPATH exception
@


1.13
log
@- include the prerelease build number in the package version.
- add a description of the native_bootstrap flavor to DESCR-*
okay nikolay@@
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.12 2008/03/19 18:05:43 kurt Exp $
d13 2
a14 2
PKGNAME-main=	jdk-${V}${B}
PKGNAME-jre=	jre-${V}${B}
d46 1
@


1.12
log
@- switch to GPLv2 w/CLASSPATH exception licensed openjdk7 code
- update to early access build 24
- Use GPLv2 licensed binary plugs from the IcedTea project and parts of
  IcedTea's icedtea-copy-plugs.patch & icedtea-graphics.patch.
  For more info see:
    http://icedtea.classpath.org/wiki/Main_Page
- Enable packages since we're fully GPLv2 based now, but still not
  hooked up to bulk builds just yet.
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.11 2008/02/26 18:26:23 kurt Exp $
d13 2
a14 2
PKGNAME-main=	jdk-${V}
PKGNAME-jre=	jre-${V}
@


1.11
log
@- mark as BROKEN 'Work-in-progress and outdated' so users understand this
port is not finished yet. also remove a MASTER_SITE. okay naddy@@
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.10 2007/11/09 15:27:55 kurt Exp $
d3 2
a4 1
BROKEN+= Work-in-progress and outdated
d6 9
a14 2
SHARED_ONLY=		Yes
ONLY_FOR_ARCHS= 	i386 amd64
d16 1
a16 10
COMMENT-main=		Java2(TM) Standard Edition Dev Kit v${V}
COMMENT-jre=		Java2(TM) Standard Edition Runtime Environment v${V}
V=			1.7.0
B=			b19
D=			30_aug_2007
DISTFILES=		jdk-7-ea-src-${B}-jrl-${D}.jar \
			jdk-7-ea-bin-${B}-jrl-${D}.jar
PKGNAME=		jdk-${V}.${B}
PKGNAME-main=		jdk-${V}.${B}p0
PKGNAME-jre=		jre-${V}.${B}p0
d18 1
a18 1
CATEGORIES=		devel/jdk java
d20 9
a28 1
MULTI_PACKAGES= 	-main -jre
d30 36
a65 2
FLAVORS=		with_ipv6
FLAVOR?=
d67 1
a67 43
HOMEPAGE=		https://jdk7.dev.java.net/
MASTER_SITES=		http://www.java.net/download/jdk7/ \
			http://www.java.net/download/jdk7/archive/$B/

MAINTAINER=		Kurt Miller <kurt@@openbsd.org>

# Java Research License
# http://www.java.net/jrl.csp
PERMIT_PACKAGE_CDROM=	JRL
PERMIT_PACKAGE_FTP=	JRL
PERMIT_DISTFILES_CDROM= JRL
PERMIT_DISTFILES_FTP=	JRL

NO_REGRESS=		Yes

BUILD_DEPENDS=		:jdk-1.5.0*:devel/jdk/1.5 \
			::archivers/zip \
			::archivers/unzip \
			::print/cups
USE_MOTIF=		openmotif
MODULES=		converters/libiconv
WANTLIB=		X11 Xext Xi Xp Xt Xtst c freetype m ossaudio \
			pthread stdc++

USE_GMAKE=		Yes

ALT_BOOTDIR=		${LOCALBASE}/jdk-1.5.0

MAKE_ENV=		ALT_BOOTDIR=${ALT_BOOTDIR} \
			ALT_MOTIF_DIR=${LOCALBASE} \
			ALT_FREETYPE_HEADERS_PATH=${X11BASE}/include \
			ALT_FREETYPE_LIB_PATH=${X11BASE}/lib \
			SKIP_COMPARE_IMAGES=true \
			BUILD_INSTALL=false \
			NO_DOCS=true \
			CC="${CC}" \
			CXX="${CXX}" \
			DEFAULT_LIBPATH="/usr/lib:${X11BASE}/lib:${LOCALBASE}/lib" \
			USERNAME=${USER} \
			HOTSPOT_BUILD_JOBS=`sysctl -n hw.ncpu` \
			SKIP_FASTDEBUG_BUILD=true \
			BUILD_DEPLOY=false \
			USE_FREETYPE=true
d70 1
a70 1
MAKE_ENV+=		DONT_ENABLE_IPV6="YES"
d73 2
a74 2
JDKHOME=		jdk-1.7.0
JREHOME=		jre-1.7.0
d76 1
a76 1
SUBST_VARS=		JDKHOME JREHOME
d78 5
a82 5
WRKDIST=		${WRKDIR}
WRKBUILD=		${WRKDIST}/control/make
JVMARCH=		${MACHINE_ARCH:S/i386/i586/}
JDKIMAGEDIR=		${WRKDIST}/control/build/bsd-${JVMARCH}/j2sdk-image
JREIMAGEDIR=		${WRKDIST}/control/build/bsd-${JVMARCH}/j2re-image
d85 1
a85 1
PKG_ARGS+=		-Dclient_vm=1
d87 1
a87 1
PKG_ARGS+=		-Dclient_vm=0
d92 1
a92 2
		hotspot/src/os_cpu/linux_amd64/vm \
		hotspot/src/os_cpu/linux_i486/vm \
d95 1
a95 2
		install/make/installer/binaries/linux \
		j2se/src/linux/doc/man
d97 12
a108 39
COPYFILES=	control/make/common/Defs-linux.gmk \
		install/make/common/Defs-linux.gmk \
		j2se/make/common/Defs-linux.gmk \
		j2se/make/common/shared/Defs-linux.gmk \
		j2se/make/java/nio/mapfile-linux \
		j2se/make/netbeans/common/architectures/name-Linux.properties \
		j2se/make/sun/awt/mapfile-vers-linux \
		j2se/make/tools/sharing/classlist.linux \
		j2se/src/closed/solaris/classes/sun/awt/fontconfigs/linux.fontconfig.properties \
		j2se/src/closed/solaris/native/com/sun/media/sound/engine/HAE_API_LinuxOS.c \
		j2se/src/closed/solaris/native/com/sun/media/sound/engine/HAE_API_LinuxOS_Capture.c \
		j2se/src/solaris/classes/java/lang/UNIXProcess.java.linux \
		j2se/src/solaris/classes/sun/awt/fontconfigs/linux.fontconfig.properties \
		j2se/src/solaris/classes/sun/tools/attach/LinuxAttachProvider.java \
		j2se/src/solaris/hpi/include/largefile_linux.h

.include <bsd.own.mk>

ACCEPT_JRL_LICENSE ?= No

.if ${ACCEPT_JRL_LICENSE:L} != "yes"
BROKEN += \n
BROKEN += You must read and accept Sun's JRL license located\n
BROKEN += at ${FILESDIR}/JavaResearchLicense.txt\n
BROKEN += To indicate your acceptance of the JRL add ACCEPT_JRL_LICENSE=Yes\n
BROKEN += to /etc/mk.conf and restart the build
.endif

do-extract:
	@@rm -rf ${WRKDIR}/tmp && mkdir ${WRKDIR}/tmp && \
		${CC} ${CFLAGS} -o ${WRKDIR}/tmp/x_x2zip ${FILESDIR}/x_x2zip.c
.for jar in ${DISTFILES}
	@@cd ${WRKDIR}/tmp && \
		unzip -qo ${FULLDISTDIR}/${jar} X_X && \
		./x_x2zip "YES I ACCEPT THE CLICK THROUGH LICENSE.  " X_X && \
		cd ${WRKDIR} && \
		unzip -q ${WRKDIR}/tmp/X_X.zip -x */lib*.so
.endfor
	@@rm -rf ${WRKDIR}/tmp
d127 2
a128 2
		< ${WRKDIST}/j2se/src/solaris/hpi/native_threads/src/threads_solaris.c \
		> ${WRKDIST}/j2se/src/solaris/hpi/native_threads/src/threads_bsd.c
d131 6
a136 4
	@@rm -rf ${JDKIMAGEDIR}/man/ja \
		${JDKIMAGEDIR}/man/ja_JP.eucJP \
		${JREIMAGEDIR}/man/ja \
		${JREIMAGEDIR}/man/ja_JP.eucJP
a142 1

@


1.10
log
@s/ERRORS/BROKEN/ to fix mirror-maker per espie@@ and nikolay@@
@
text
@d1 3
a3 1
# $OpenBSD: Makefile,v 1.9 2007/11/07 17:17:41 kurt Exp $
d28 1
a28 2
			http://www.java.net/download/jdk7/archive/$B/ \
			http://www.intricatesoftware.com/distfiles/
@


1.9
log
@- another master site url
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.8 2007/11/07 17:04:36 kurt Exp $
d120 5
a124 4
ERRORS += "Fatal: you must read and accept Sun's JRL license located"
ERRORS += "at ${FILESDIR}/JavaResearchLicense.txt"
ERRORS += "To indicate your acceptance of the JRL add ACCEPT_JRL_LICENSE=Yes"
ERRORS += "to /etc/mk.conf and restart the build."
@


1.8
log
@Remove interactive license verification since it causes issues due to
lack of stdin availability when built indirectly as a depend of another
port. Instead of interactive license verification solely use the
ACCEPT_JRL_LICENSE var. If it's not correctly set error out and let the
user know what to do. Cluestick and okay espie@@
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.7 2007/11/07 03:53:53 kurt Exp $
d26 1
@


1.7
log
@- migrate forward a few necessary networking patches from 1.5 that fell
  through the cracks.
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.6 2007/09/16 02:53:00 merdely Exp $
d119 4
a122 4
IS_INTERACTIVE=	Yes
pre-extract:
	@@${SH} ${FILESDIR}/license.sh
	@@echo continuing....
@


1.6
log
@Remove quotes surrounding COMMENT*/PERMIT_*/BROKEN
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.5 2007/09/06 15:46:18 kurt Exp $
d14 2
a15 2
PKGNAME-main=		jdk-${V}.${B}
PKGNAME-jre=		jre-${V}.${B}
@


1.5
log
@Remove BROKEN and update port to b19. The port is fully 1.7 now (both
hotspot and j2se). The j2se patches are from the bsd java repositories
1.5 -> 1.6 (performed by Greg Lewis) -> 1.7 by myself. j2se patches are
in sync with 1.6 patchset 1 plus the Runtime.exec fix from Michiel Boland
via FreeBSD PR http://www.freebsd.org/cgi/query-pr.cgi?pr=115557.

Also from FreeBSD: interactive JRL license verification. By default the
port is IS_INTERACTIVE=Yes. Add ACCEPT_JRL_LICENSE=Yes to /etc/mk.conf
to permanently accept the JRL license.

At some point in the future I will work on switching this back to
OpenJDK/GPLv2 src. That largely depends on Sun's progress at removing more
of the binary plug bits so that stubbing out the remainder is less
cumbersome and time consuming.

Testing, comments and okay ian@@
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.4 2007/08/07 16:07:22 kurt Exp $
d6 2
a7 2
COMMENT-main=		"Java2(TM) Standard Edition Dev Kit v${V}"
COMMENT-jre=		"Java2(TM) Standard Edition Runtime Environment v${V}"
d32 4
a35 4
PERMIT_PACKAGE_CDROM=	"JRL"
PERMIT_PACKAGE_FTP=	"JRL"
PERMIT_DISTFILES_CDROM= "JRL"
PERMIT_DISTFILES_FTP=	"JRL"
@


1.4
log
@let's not give the impression 4.2 has a working 1.7 port. mark it BROKEN
for now. okay ian@@ naddy@@
@
text
@d1 1
a1 3
# $OpenBSD: Makefile,v 1.3 2007/07/13 22:52:35 kurt Exp $

BROKEN= "Incomplete port, 1.7 JVM + 1.5 classes"
d6 2
a7 1
COMMENT=		"Java2(TM) Standard Edition Dev Kit v${V}"
d9 2
a10 2
B=			b15
D=			05_jul_2007
d12 1
a12 2
			jdk-7-ea-bin-${B}-jrl-${D}.jar \
			jdk-7-ea-mozilla_headers-${B}-unix-${D}.jar
d14 2
d19 5
d25 2
a26 1
MASTER_SITES=		http://www.java.net/download/jdk7/
d39 1
a39 1
BUILD_DEPENDS=		:jdk->=1.5.0.11:devel/jdk/1.5 \
d41 2
a42 1
			::archivers/unzip
d45 2
a46 2
WANTLIB=		X11 Xext Xi Xp Xt Xtst c m ossaudio pthread \
			stdc++ z
d53 8
a60 1
			ALT_JDK_IMPORT_PATH=${ALT_BOOTDIR} \
d63 4
a66 1
			HOTSPOT_BUILD_JOBS=`sysctl -n hw.ncpu`
d68 3
a70 1
JDKHOME=		jdk-${V}
d72 4
a75 1
SUBST_VARS=		JDKHOME
d78 4
a81 5
WRKBUILD=		${WRKDIST}/hotspot/make
JVMARCH=		${MACHINE_ARCH:S/i386/i486/}
OUTPUTDIR1=		${WRKDIST}/hotspot/build/bsd/bsd_${JVMARCH}_compiler1
OUTPUTDIR2=		${WRKDIST}/hotspot/build/bsd/bsd_${JVMARCH}_compiler2
JNIMDH=			${WRKDIST}/hotspot/src/cpu/${JVMARCH}/vm/jni_${JVMARCH}.h
a82 1
ALL_TARGET=		product
a83 1
ALL_TARGET+=		product1
d96 1
a96 1
		j2se/src/linux
a98 3
		deploy/make/common/Defs-linux.gmk \
		deploy/make/common/Rules-linux.gmk \
		deploy/make/plugin/common/Defs-linux.gmk \
a99 1
		j2se/make/com/sun/tools/attach/mapfile-linux \
d112 12
a123 2
		j2se/src/solaris/hpi/include/largefile_linux.h \
		j2se/src/solaris/native/sun/tools/attach/LinuxVirtualMachine.c
d126 1
a126 1
	@@mkdir ${WRKDIR}/tmp && \
a138 1
	@@chmod -R +w ${WRKDIST}/hotspot
d157 6
d165 4
a168 15
	cd ${ALT_BOOTDIR} && tar -cf - * | tar -C ${PREFIX}/${JDKHOME} -xf -
	@@find ${PREFIX}/${JDKHOME} -name \*_g -or -name \*_g.so -or -name \*_g.jar | \
		xargs rm
	${INSTALL_DATA} ${WRKDIST}/hotspot/src/share/vm/services/jmm.h \
		${PREFIX}/${JDKHOME}/include
	${INSTALL_DATA} ${OUTPUTDIR2}/generated/jvmtifiles/jvmti.h \
		${PREFIX}/${JDKHOME}/include
	${INSTALL_DATA_DIR} ${PREFIX}/${JDKHOME}/include/bsd
	${INSTALL_DATA} ${JNIMDH} ${PREFIX}/${JDKHOME}/include/bsd/jni_md.h
	${INSTALL_DATA} ${OUTPUTDIR2}/product/lib{jvm,jsig}.so \
		${PREFIX}/${JDKHOME}/jre/lib/${MACHINE_ARCH}/server
.if ${MACHINE_ARCH} == "i386"
	${INSTALL_DATA} ${OUTPUTDIR1}/product/lib{jvm,jsig}.so \
		${PREFIX}/${JDKHOME}/jre/lib/${MACHINE_ARCH}/client
.endif
@


1.3
log
@- update to build 15
- switch to the JRL licensed src. why? because it will allow me to complete
the port. OpenJDK/GPLv2 src isn't complete and the parts that we don't have
are only released in binary form with a defend and indemnify clause. When
all of the jdk is GPLv2 I will switch back to OpenJDK/GPLv2 src.
- copy the Linux src files for the rest of the jdk so i can begin to patch
them. One src file is based on solaris code since that suits us better as
a starting point.
@
text
@d1 3
a3 1
# $OpenBSD: Makefile,v 1.2 2007/05/09 15:48:31 kurt Exp $
@


1.2
log
@. update to b12 sources (just building hotspot)
. adjust SIGRTMIN SIGRTMAX defines - from Jung-uk Kim <jkim@@freebsd.org>
. use SIGSEGV || SIGBUS in amd64 signal handling code
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.1.1.1 2007/05/08 17:06:18 kurt Exp $
d8 6
a13 3
B=			b12
DISTNAME=		openjdk-7-ea-src-${B}-06_may_2007
PKGNAME=		jdk-${V}p0
d17 2
a18 3
HOMEPAGE=		http://openjdk.java.net/
MASTER_SITES=		http://www.java.net/download/openjdk/40ec4ed263a6dfce13b8cf18fa046058/jdk7/promoted/${B}/
EXTRACT_SUFX=		.zip
d22 6
a27 8
# GPL2
# since this currently copies the SCSL binaries into the package
# we can't set them all to yes. when the full jdk is released
# we can.
PERMIT_PACKAGE_CDROM=	"SCSL"
PERMIT_PACKAGE_FTP=	"SCSL"
PERMIT_DISTFILES_CDROM= Yes
PERMIT_DISTFILES_FTP=	Yes
d31 3
a33 1
BUILD_DEPENDS=		:jdk->=1.5.0p30:devel/jdk/1.5
d36 1
a36 1
WANTLIB=		X11 Xext Xi Xmu Xp Xt Xtst c m ossaudio pthread \
a38 1
USE_ZIP=		Yes
d53 1
a53 1
WRKDIST=		${WRKDIR}/openjdk
d68 41
a108 6
COPYDIRS=		hotspot/src/os/linux/launcher \
			hotspot/src/os/linux/vm \
			hotspot/src/os_cpu/linux_amd64/vm \
			hotspot/src/os_cpu/linux_i486/vm \
			hotspot/build/linux \
			hotspot/build/linux/makefiles
d110 1
a110 1
# create initial bsd dirs from linux dirs
d112 1
d123 7
a129 1
	@@chmod -R +w ${WRKDIST}/hotspot
@


1.1
log
@Initial revision
@
text
@d1 1
a1 1
# $OpenBSD$
d8 3
a10 3
B=			b11
DISTNAME=		hotspot-7-ea-src-${B}-10_apr_2007
PKGNAME=		jdk-${V}
d14 2
a15 2
HOMEPAGE=		https://openjdk.dev.java.net/
MASTER_SITES=		http://www.java.net/download/openjdk/jdk7/promoted/${B}/
d52 1
a52 1
WRKDIST=		${WRKDIR}
@


1.1.1.1
log
@Initial import of jdk 1.7 (a.k.a. OpenJDK 7) work in progress. So far Sun
has released the hotspot portion of 1.7 under GPLv2. j2se and deploy
(plugin & webstart) will come later. No packages yet since j2se is copied
in from 1.5.

Note: hotspot for BSD in previous versions of the jdk were based on a
mixture of Solaris code and Linux code (for amd64). In this version I have
selected Linux as the base and only ported of small parts of the Solaris
code as needed. Using Linux code as the base has significantly reduced the
code divergence for BSD support and should make maintaining the port
easier.

okay ian@@, go for it espie@@
@
text
@@
