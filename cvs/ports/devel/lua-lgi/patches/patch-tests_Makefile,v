head	1.6;
access;
symbols
	OPENBSD_6_1:1.6.0.2
	OPENBSD_6_1_BASE:1.6
	OPENBSD_6_0:1.5.0.12
	OPENBSD_6_0_BASE:1.5
	OPENBSD_5_9:1.5.0.8
	OPENBSD_5_9_BASE:1.5
	OPENBSD_5_8:1.5.0.10
	OPENBSD_5_8_BASE:1.5
	OPENBSD_5_7:1.5.0.6
	OPENBSD_5_7_BASE:1.5
	OPENBSD_5_6:1.5.0.4
	OPENBSD_5_6_BASE:1.5
	OPENBSD_5_5:1.5.0.2
	OPENBSD_5_5_BASE:1.5
	OPENBSD_5_4:1.4.0.2
	OPENBSD_5_4_BASE:1.4
	OPENBSD_5_3:1.3.0.4
	OPENBSD_5_3_BASE:1.3
	OPENBSD_5_2:1.3.0.2
	OPENBSD_5_2_BASE:1.3;
locks; strict;
comment	@# @;


1.6
date	2017.02.28.11.32.16;	author dcoppa;	state Exp;
branches;
next	1.5;
commitid	Mdr5XMYroB79rNlA;

1.5
date	2013.12.30.08.00.03;	author jasper;	state Exp;
branches;
next	1.4;

1.4
date	2013.03.08.10.26.26;	author jasper;	state Exp;
branches;
next	1.3;

1.3
date	2012.07.19.20.06.34;	author jasper;	state Exp;
branches;
next	1.2;

1.2
date	2012.05.30.11.09.10;	author jasper;	state Exp;
branches;
next	1.1;

1.1
date	2012.05.26.08.56.44;	author jasper;	state Exp;
branches;
next	;


desc
@@


1.6
log
@
Update to lgi-0.9.1
@
text
@$OpenBSD: patch-tests_Makefile,v 1.5 2013/12/30 08:00:03 jasper Exp $

- Ensure the libraries needed by libregress.so can also be located and are preloaded.

--- tests/Makefile.orig	Tue Feb 28 11:55:06 2017
+++ tests/Makefile	Tue Feb 28 11:57:01 2017
@@@@ -26,7 +26,7 @@@@ endif
 endif
 
 PKGS = gio-2.0 cairo cairo-gobject gobject-introspection-1.0 gmodule-2.0 libffi
-LUA = lua
+LUA = ${MODLUA_BIN}
 PKG_CONFIG = pkg-config
 
 ifndef CFLAGS
@@@@ -55,7 +55,7 @@@@ clean :
 	rm -f $(REGRESS) $(REGRESS_OBJS) Regress-1.0.gir Regress-1.0.typelib
 
 check : all
-	cd .. && LD_LIBRARY_PATH=tests:$$LD_LIBRARY_PATH \
+	cd .. && LD_PRELOAD=/usr/lib/libpthread.so LD_LIBRARY_PATH=tests:$$LD_LIBRARY_PATH \
 	    GI_TYPELIB_PATH=tests:$$GI_TYPELIB_PATH \
 	    LUA_PATH=./?.lua\;`$(LUA) -e "print(package.path)"` \
 	    LUA_CPATH=./?.so\;`$(LUA) -e "print(package.cpath)"` \
@@@@ -76,7 +76,7 @@@@ Regress-1.0.gir : $(REGRESS)
 	  --namespace=Regress --nsversion=1.0				\
 	  --include=cairo-1.0 --include=Gio-2.0				\
 	  --library-path=/usr/lib --library-path=/usr/X11R6/lib		\
-	  --library-path=/usr/local/lib					\
+	  --library-path=${LOCALBASE}/lib				\
 	  $(GIDATADIR)/regress.c $(GIDATADIR)/regress.h			\
 	 -lregress
 
@


1.5
log
@update to lua-lgi-0.7.2
@
text
@d1 1
a1 1
$OpenBSD: patch-tests_Makefile,v 1.4 2013/03/08 10:26:26 jasper Exp $
d5 3
a7 3
--- tests/Makefile.orig	Mon Dec 30 08:43:45 2013
+++ tests/Makefile	Mon Dec 30 08:45:06 2013
@@@@ -24,7 +24,7 @@@@ endif
d13 1
d16 1
a16 2
 ifndef COPTFLAGS
@@@@ -52,7 +52,7 @@@@ clean :
d25 1
a25 1
@@@@ -73,7 +73,7 @@@@ Regress-1.0.gir : $(REGRESS)
d30 1
a30 1
+	  --library-path=${LOCALBASE}/lib					\
@


1.4
log
@- update to lgi-0.7.0
@
text
@d1 1
a1 1
$OpenBSD: patch-tests_Makefile,v 1.3 2012/07/19 20:06:34 jasper Exp $
d5 2
a6 2
--- tests/Makefile.orig	Sat Feb 23 10:39:13 2013
+++ tests/Makefile	Sat Feb 23 10:49:10 2013
d20 6
a25 6
-	cd .. && LD_LIBRARY_PATH=tests:$$LD_LIBRARY_PATH GI_TYPELIB_PATH=tests:$$GI_TYPELIB_PATH $(LUA) tests/test.lua
+	cd .. && LD_PRELOAD=/usr/lib/libpthread.so LD_LIBRARY_PATH=tests:$$LD_LIBRARY_PATH GI_TYPELIB_PATH=tests:$$GI_TYPELIB_PATH $(LUA) tests/test.lua
 
 $(REGRESS) : regress.o
 	$(CC) $(ALL_LDFLAGS) -o $@@ regress.o $(LIBS)
@@@@ -69,7 +69,7 @@@@ Regress-1.0.gir : $(REGRESS)
d30 1
a30 1
+	  --library-path=${LOCALBASE}/lib				\
@


1.3
log
@- update to 0.6.2
* various fixes for lua 5.2 and fixes a few memory leaks
@
text
@d1 1
a1 1
$OpenBSD: patch-tests_Makefile,v 1.2 2012/05/30 11:09:10 jasper Exp $
a2 1
First chunk:
d5 12
a16 3
--- tests/Makefile.orig	Thu Jul 19 22:00:55 2012
+++ tests/Makefile	Thu Jul 19 22:02:44 2012
@@@@ -41,7 +41,7 @@@@ clean :
d21 1
a21 1
+	cd .. &&  LD_PRELOAD=/usr/lib/libpthread.so LD_LIBRARY_PATH=tests:$$LD_LIBRARY_PATH GI_TYPELIB_PATH=tests:$$GI_TYPELIB_PATH $(LUA) tests/test.lua
d24 2
a25 2
 	$(CC) $(LDFLAGS) -o $@@ regress.o $(LIBS)
@@@@ -58,7 +58,7 @@@@ Regress-1.0.gir : $(REGRESS)
@


1.2
log
@committed upstream
@
text
@d1 1
a1 1
$OpenBSD: patch-tests_Makefile,v 1.1 2012/05/26 08:56:44 jasper Exp $
d6 2
a7 13
Second chunk:
commit 2564791c4176c19a7022762212d0afce7956e5bb
Author: Jasper Lievisse Adriaanse <jasper@@humppa.nl>
Date:   Sat May 26 11:01:00 2012 +0200

    Fix regress tests on platforms where we need to look in additional
    library directories.

    If the directory does not exist it's just silently ignored.


--- tests/Makefile.orig	Tue May 22 11:38:39 2012
+++ tests/Makefile	Sat May 26 10:54:39 2012
d13 1
a13 1
+	cd .. && LD_PRELOAD=/usr/lib/libpthread.so LD_LIBRARY_PATH=tests:$$LD_LIBRARY_PATH GI_TYPELIB_PATH=tests:$$GI_TYPELIB_PATH $(LUA) tests/test.lua
d17 1
a17 2
@@@@ -57,6 +57,8 @@@@ Regress-1.0.gir : $(REGRESS)
 	g-ir-scanner --warn-all --no-libtool --quiet --output=$@@	\
d20 2
a21 1
+	  --library-path=/usr/lib --library-path=${X11BASE}/lib		\
@


1.1
log
@- unbreak regress tests and set REGRESS_IS_INTERACTIVE=x11
@
text
@d1 1
a1 1
$OpenBSD$
d3 1
d5 12
@

