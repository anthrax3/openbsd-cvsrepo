head	1.5;
access;
symbols
	OPENBSD_5_2:1.4.0.2
	OPENBSD_5_2_BASE:1.4
	OPENBSD_5_1_BASE:1.3
	OPENBSD_5_1:1.3.0.8
	OPENBSD_5_0:1.3.0.6
	OPENBSD_5_0_BASE:1.3
	OPENBSD_4_9:1.3.0.4
	OPENBSD_4_9_BASE:1.3
	OPENBSD_4_8:1.3.0.2
	OPENBSD_4_8_BASE:1.3
	OPENBSD_4_7:1.1.0.2
	OPENBSD_4_7_BASE:1.1;
locks; strict;
comment	@# @;


1.5
date	2012.08.20.08.07.34;	author dcoppa;	state dead;
branches;
next	1.4;

1.4
date	2012.05.07.07.06.20;	author dcoppa;	state Exp;
branches;
next	1.3;

1.3
date	2010.07.12.19.19.30;	author dcoppa;	state Exp;
branches;
next	1.2;

1.2
date	2010.05.28.20.21.48;	author dcoppa;	state Exp;
branches;
next	1.1;

1.1
date	2009.09.10.13.54.47;	author landry;	state Exp;
branches;
next	;


desc
@@


1.5
log
@Garbage collect the pthread patching for CMake.

From Brad, thanks.
@
text
@$OpenBSD: patch-Modules_FindThreads_cmake,v 1.4 2012/05/07 07:06:20 dcoppa Exp $
--- Modules/FindThreads.cmake.orig	Mon Apr 30 11:43:02 2012
+++ Modules/FindThreads.cmake	Mon Apr 30 11:48:51 2012
@@@@ -43,80 +43,9 @@@@ ELSE()
     # We have pthread.h
     # Let's check for the library now.
     #
-    SET(CMAKE_HAVE_THREADS_LIBRARY)
-    IF(NOT THREADS_HAVE_PTHREAD_ARG)
-      # Check if pthread functions are in normal C library
-      CHECK_SYMBOL_EXISTS(pthread_create pthread.h CMAKE_HAVE_LIBC_CREATE)
-      IF(CMAKE_HAVE_LIBC_CREATE)
-        SET(CMAKE_THREAD_LIBS_INIT "")
-        SET(CMAKE_HAVE_THREADS_LIBRARY 1)
-        SET(Threads_FOUND TRUE)
-      ENDIF()
-
-      IF(NOT CMAKE_HAVE_THREADS_LIBRARY)
-        # Do we have -lpthreads
-        CHECK_LIBRARY_EXISTS(pthreads pthread_create "" CMAKE_HAVE_PTHREADS_CREATE)
-        IF(CMAKE_HAVE_PTHREADS_CREATE)
-          SET(CMAKE_THREAD_LIBS_INIT "-lpthreads")
-          SET(CMAKE_HAVE_THREADS_LIBRARY 1)
-          SET(Threads_FOUND TRUE)
-        ENDIF()
-
-        # Ok, how about -lpthread
-        CHECK_LIBRARY_EXISTS(pthread pthread_create "" CMAKE_HAVE_PTHREAD_CREATE)
-        IF(CMAKE_HAVE_PTHREAD_CREATE)
-          SET(CMAKE_THREAD_LIBS_INIT "-lpthread")
-          SET(CMAKE_HAVE_THREADS_LIBRARY 1)
-          SET(Threads_FOUND TRUE)
-        ENDIF()
-
-        IF(CMAKE_SYSTEM MATCHES "SunOS.*")
-          # On sun also check for -lthread
-          CHECK_LIBRARY_EXISTS(thread thr_create "" CMAKE_HAVE_THR_CREATE)
-          IF(CMAKE_HAVE_THR_CREATE)
-            SET(CMAKE_THREAD_LIBS_INIT "-lthread")
-            SET(CMAKE_HAVE_THREADS_LIBRARY 1)
-            SET(Threads_FOUND TRUE)
-          ENDIF()
-        ENDIF(CMAKE_SYSTEM MATCHES "SunOS.*")
-      ENDIF(NOT CMAKE_HAVE_THREADS_LIBRARY)
-    ENDIF(NOT THREADS_HAVE_PTHREAD_ARG)
-
-    IF(NOT CMAKE_HAVE_THREADS_LIBRARY)
-      # If we did not found -lpthread, -lpthread, or -lthread, look for -pthread
-      IF("THREADS_HAVE_PTHREAD_ARG" MATCHES "^THREADS_HAVE_PTHREAD_ARG")
-        MESSAGE(STATUS "Check if compiler accepts -pthread")
-        TRY_RUN(THREADS_PTHREAD_ARG THREADS_HAVE_PTHREAD_ARG
-          ${CMAKE_BINARY_DIR}
-          ${CMAKE_ROOT}/Modules/CheckForPthreads.c
-          CMAKE_FLAGS -DLINK_LIBRARIES:STRING=-pthread
-          COMPILE_OUTPUT_VARIABLE OUTPUT)
-
-        IF(THREADS_HAVE_PTHREAD_ARG)
-          IF(THREADS_PTHREAD_ARG MATCHES "^2$")
-            SET(Threads_FOUND TRUE)
-            MESSAGE(STATUS "Check if compiler accepts -pthread - yes")
-          ELSE()
-            MESSAGE(STATUS "Check if compiler accepts -pthread - no")
-            FILE(APPEND 
-              ${CMAKE_BINARY_DIR}${CMAKE_FILES_DIRECTORY}/CMakeError.log 
-              "Determining if compiler accepts -pthread returned ${THREADS_PTHREAD_ARG} instead of 2. The compiler had the following output:\n${OUTPUT}\n\n")
-          ENDIF()
-        ELSE()
-          MESSAGE(STATUS "Check if compiler accepts -pthread - no")
-          FILE(APPEND 
-            ${CMAKE_BINARY_DIR}${CMAKE_FILES_DIRECTORY}/CMakeError.log 
-            "Determining if compiler accepts -pthread failed with the following output:\n${OUTPUT}\n\n")
-        ENDIF()
-
-      ENDIF("THREADS_HAVE_PTHREAD_ARG" MATCHES "^THREADS_HAVE_PTHREAD_ARG")
-
-      IF(THREADS_HAVE_PTHREAD_ARG)
-        SET(Threads_FOUND TRUE)
-        SET(CMAKE_THREAD_LIBS_INIT "-pthread")
-      ENDIF()
-
-    ENDIF(NOT CMAKE_HAVE_THREADS_LIBRARY)
+    SET(CMAKE_HAVE_PTHREAD_CREATE 1)
+    SET(CMAKE_HAVE_THREADS_LIBRARY 1)
+    SET(CMAKE_THREAD_LIBS_INIT "-pthread")
   ENDIF(CMAKE_HAVE_PTHREAD_H)
 ENDIF()
 
@


1.4
log
@Update to cmake-2.8.8

OK sthen@@
@
text
@d1 1
a1 1
$OpenBSD: patch-Modules_FindThreads_cmake,v 1.3 2010/07/12 19:19:30 dcoppa Exp $
@


1.3
log
@Fix a bug with shared libraries having OUTPUT_NAME in their target
properties.

Update to cmake-2.8.2.

While here, move to new-style LIB_DEPENDS/WANTLIB.

OK espie@@, landry@@, sthen@@
@
text
@d1 4
a4 4
$OpenBSD: patch-Modules_FindThreads_cmake,v 1.2 2010/05/28 20:21:48 dcoppa Exp $
--- Modules/FindThreads.cmake.orig	Mon Jun 28 17:15:57 2010
+++ Modules/FindThreads.cmake	Mon Jul  5 11:23:18 2010
@@@@ -42,72 +42,9 @@@@ ELSE()
d10 4
a13 5
-
-      # Do we have -lpthreads
-      CHECK_LIBRARY_EXISTS(pthreads pthread_create "" CMAKE_HAVE_PTHREADS_CREATE)
-      IF(CMAKE_HAVE_PTHREADS_CREATE)
-        SET(CMAKE_THREAD_LIBS_INIT "-lpthreads")
d18 8
a25 7
-      # Ok, how about -lpthread
-      CHECK_LIBRARY_EXISTS(pthread pthread_create "" CMAKE_HAVE_PTHREAD_CREATE)
-      IF(CMAKE_HAVE_PTHREAD_CREATE)
-        SET(CMAKE_THREAD_LIBS_INIT "-lpthread")
-        SET(Threads_FOUND TRUE)
-        SET(CMAKE_HAVE_THREADS_LIBRARY 1)
-      ENDIF()
d27 4
a30 5
-      IF(CMAKE_SYSTEM MATCHES "SunOS.*")
-        # On sun also check for -lthread
-        CHECK_LIBRARY_EXISTS(thread thr_create "" CMAKE_HAVE_THR_CREATE)
-        IF(CMAKE_HAVE_THR_CREATE)
-          SET(CMAKE_THREAD_LIBS_INIT "-lthread")
a33 1
-      ENDIF(CMAKE_SYSTEM MATCHES "SunOS.*")
d35 10
@


1.2
log
@Update to cmake 2.8.1 (I also take maintainership).

"This is good, commit." espie@@
@
text
@d1 4
a4 4
$OpenBSD$
--- Modules/FindThreads.cmake.orig	Tue Apr  6 16:45:31 2010
+++ Modules/FindThreads.cmake	Tue Apr 20 10:29:32 2010
@@@@ -40,72 +40,9 @@@@ ELSE()
@


1.1
log
@Force the use of -pthread in FindThreads.cmake module. It was looking
for -lpthread first.
No fallouts in a bulk build done by jasper@@, thanks!
ok jasper@@
@
text
@d2 3
a4 5
don't test for -lpthread, so it fallbacks to -pthread
--- Modules/FindThreads.cmake.orig	Mon Jan 21 19:59:51 2008
+++ Modules/FindThreads.cmake	Fri Sep  4 10:30:59 2009
@@@@ -24,60 +24,9 @@@@ ELSE(CMAKE_HAVE_SPROC_H)
   IF(CMAKE_HAVE_PTHREAD_H)
d7 1
d10 1
d16 3
a18 1
-      ENDIF(CMAKE_HAVE_PTHREADS_CREATE)
d23 1
d25 2
a26 1
-      ENDIF(CMAKE_HAVE_PTHREAD_CREATE)
d33 2
a34 1
-        ENDIF(CMAKE_HAVE_THR_CREATE)
d36 1
d47 2
a48 1
-          OUTPUT_VARIABLE OUTPUT)
d51 1
d53 1
a53 1
-          ELSE(THREADS_PTHREAD_ARG MATCHES "^2$")
d58 2
a59 2
-          ENDIF(THREADS_PTHREAD_ARG MATCHES "^2$")
-        ELSE(THREADS_HAVE_PTHREAD_ARG)
d64 2
a65 1
-        ENDIF(THREADS_HAVE_PTHREAD_ARG)
d67 1
d69 1
d71 2
a72 2
-      ELSE(THREADS_HAVE_PTHREAD_ARG)
-      ENDIF(THREADS_HAVE_PTHREAD_ARG)
d78 1
a78 1
 ENDIF(CMAKE_HAVE_SPROC_H)
@

