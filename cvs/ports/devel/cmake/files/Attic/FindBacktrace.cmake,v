head	1.3;
access;
symbols
	OPENBSD_5_6:1.2.0.2
	OPENBSD_5_6_BASE:1.2
	OPENBSD_5_5:1.1.0.4
	OPENBSD_5_5_BASE:1.1
	OPENBSD_5_4:1.1.0.2
	OPENBSD_5_4_BASE:1.1;
locks; strict;
comment	@# @;


1.3
date	2014.09.11.10.24.38;	author dcoppa;	state dead;
branches;
next	1.2;
commitid	m0ESeGbhnaGm45G1;

1.2
date	2014.06.25.00.29.45;	author zhuk;	state Exp;
branches;
next	1.1;
commitid	DF3OsXZrygjkn6rh;

1.1
date	2013.03.21.10.21.49;	author zhuk;	state Exp;
branches;
next	;


desc
@@


1.3
log
@
Update to cmake-3.0.1

Tested in a bulk build by landry@@
OK landry@@
@
text
@# - Find provider for backtrace(3)
# Checks if OS supports backtrace(3) via either libc or custom library.
# This module defines the following variables:
#  Backtrace_HEADER       - The header file needed for backtrace(3). Cached.
#                           Could be forcibly set by user.
#  Backtrace_INCLUDE_DIRS - The include directories needed to use backtrace(3) header.
#  Backtrace_LIBRARIES    - The libraries (linker flags) needed to use backtrace(3), if any.
#  Backtrace_FOUND        - Is set if and only if backtrace(3) support detected.
#
# The following cache variables are also available to set or use:
#   Backtrace_LIBRARY     - The external library providing backtrace, if any.
#   Backtrace_INCLUDE_DIR - The directory holding the backtrace(3) header.
#
# Typical usage is to generate of header file using configure_file() with the
# contents like the following:
#  #cmakedefine01 Backtrace_FOUND
#  #if Backtrace_FOUND
#  # include <${Backtrace_HEADER}>
#  #endif
# And then reference that generated header file in actual source.

#=============================================================================
# Copyright (c) 2013, Vadim Zhukov <persgray@@gmail.com>
#
# Permission to use, copy, modify, and distribute this software for any
# purpose with or without fee is hereby granted, provided that the above
# copyright notice and this permission notice appear in all copies.
#
# THE SOFTWARE IS PROVIDED "AS IS" AND THE AUTHOR DISCLAIMS ALL WARRANTIES
# WITH REGARD TO THIS SOFTWARE INCLUDING ALL IMPLIED WARRANTIES OF
# MERCHANTABILITY AND FITNESS. IN NO EVENT SHALL THE AUTHOR BE LIABLE FOR
# ANY SPECIAL, DIRECT, INDIRECT, OR CONSEQUENTIAL DAMAGES OR ANY DAMAGES
# WHATSOEVER RESULTING FROM LOSS OF USE, DATA OR PROFITS, WHETHER IN AN
# ACTION OF CONTRACT, NEGLIGENCE OR OTHER TORTIOUS ACTION, ARISING OUT OF
# OR IN CONNECTION WITH THE USE OR PERFORMANCE OF THIS SOFTWARE.


include(CMakePushCheckState)
include(CheckSymbolExists)
include(FindPackageHandleStandardArgs)

# List of variables to be provided to find_package_handle_standard_args()
set(_Backtrace_STD_ARGS Backtrace_INCLUDE_DIR)

if(Backtrace_HEADER)
  set(_Backtrace_HEADER_TRY "${Backtrace_HEADER}")
else(Backtrace_HEADER)
  set(_Backtrace_HEADER_TRY "execinfo.h")
endif(Backtrace_HEADER)

find_path(Backtrace_INCLUDE_DIR "${_Backtrace_HEADER_TRY}")
set(Backtrace_INCLUDE_DIRS ${Backtrace_INCLUDE_DIR})

# First, check if we already have backtrace(), e.g., in libc
cmake_push_check_state(RESET)
set(CMAKE_REQUIRED_INCLUDES ${Backtrace_INCLUDE_DIRS})
check_symbol_exists("backtrace" "${_Backtrace_HEADER_TRY}" _Backtrace_SYM_FOUND)
cmake_pop_check_state()

if(_Backtrace_SYM_FOUND)
  set(Backtrace_LIBRARY)
  if(NOT Backtrace_FIND_QUIETLY)
    message(STATUS "backtrace facility detected in default set of libraries")
  endif()
else()
  # Check for external library, for non-glibc systems
  if(Backtrace_INCLUDE_DIR)
    # OpenBSD has libbacktrace renamed to libexecinfo
    find_library(Backtrace_LIBRARY "execinfo")
  elseif()     # respect user wishes
    set(_Backtrace_HEADER_TRY "backtrace.h")
    find_path(Backtrace_INCLUDE_DIR ${_Backtrace_HEADER_TRY})
    find_library(Backtrace_LIBRARY "backtrace")
  endif()

  # Prepend list with library path as it's more common practice
  set(_Backtrace_STD_ARGS Backtrace_LIBRARY ${_Backtrace_STD_ARGS})
endif()

set(Backtrace_LIBRARIES ${Backtrace_LIBRARY})
set(Backtrace_HEADER "${_Backtrace_HEADER_TRY}" CACHE STRING "Header providing backtrace(3) facility")

find_package_handle_standard_args(Backtrace FOUND_VAR Backtrace_FOUND REQUIRED_VARS ${_Backtrace_STD_ARGS})
mark_as_advanced(Backtrace_HEADER Backtrace_INCLUDE_DIR Backtrace_LIBRARY)
@


1.2
log
@Sync FindBacktrace.cmake with what's been committed upstream and what's the
Clementine actually waits for.

Pointed out, initially patched and tested by sthen@@, thanks!
@
text
@@


1.1
log
@Add hand-written FindBacktrace.cmake, a helper to find our libexecinfo and
other backtrace() implementation sources.

okayed by dcoppa@@ before lock
@
text
@d4 5
a8 4
#  BACKTRACE_HEADER       - header file needed for backtrace(3)
#  BACKTRACE_INCLUDE_DIR  - where to find ${BACKTRACE_HEADER}
#  BACKTRACE_LIBRARIES    - libraries needed for backtrace
#  BACKTRACE_FOUND        - is set if and only if backtrace(3) support detected
d10 3
d14 9
d43 7
a49 1
set(_BACKTRACE_STD_ARGS BACKTRACE_INCLUDE_DIR)
d51 2
a52 2
set(BACKTRACE_HEADER "execinfo.h")
find_path(BACKTRACE_INCLUDE_DIR ${BACKTRACE_HEADER})
d55 3
a57 3
cmake_push_check_state()
set(CMAKE_REQUIRED_INCLUDES ${CMAKE_REQUIRED_INCLUDES} ${BACKTRACE_INCLUDE_DIR})
check_symbol_exists("backtrace" "execinfo.h" _BACKTRACE_SYM_FOUND)
d60 22
a81 22
if(_BACKTRACE_SYM_FOUND)
	# Warning: CMAKE_REQUIRED_LIBRARIES could contain non-paths, so
	# don't add BACKTRACE_LIBRARIES to standard args list in this case.
	set(BACKTRACE_LIBRARIES ${CMAKE_REQUIRED_LIBRARIES})
	if(NOT BACKTRACE_FIND_QUIETLY)
		message("backtrace detected in default set of libraries: "
		        ${BACKTRACE_LIBRARIES})
	endif(NOT BACKTRACE_FIND_QUIETLY)
else(_BACKTRACE_SYM_FOUND)
	# Check for external library, for non-glibc systems
	if(BACKTRACE_INCLUDE_DIR)
		# OpenBSD has libbacktrace renamed to libexecinfo
		find_library(BACKTRACE_LIBRARIES "execinfo")
	else(BACKTRACE_INCLUDE_DIR)
		set(BACKTRACE_HEADER "backtrace.h")
		find_path(BACKTRACE_INCLUDE_DIR ${BACKTRACE_HEADER})
		find_library(BACKTRACE_LIBRARIES "backtrace")
	endif(BACKTRACE_INCLUDE_DIR)

	# Prepend list with library path as it's more common practice
	set(_BACKTRACE_STD_ARGS BACKTRACE_LIBRARIES ${_BACKTRACE_STD_ARGS})
endif(_BACKTRACE_SYM_FOUND)
d83 2
a84 2
find_package_handle_standard_args(backtrace DEFAULT_MSG ${_BACKTRACE_STD_ARGS})
mark_as_advanced(BACKTRACE_HEADER BACKTRACE_INCLUDE_DIR BACKTRACE_LIBRARIES)
@

