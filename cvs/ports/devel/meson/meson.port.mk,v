head	1.1;
access;
symbols;
locks; strict;
comment	@# @;


1.1
date	2017.04.08.13.29.22;	author ajacoutot;	state Exp;
branches;
next	;
commitid	peulxeePfeke1pwO;


desc
@@


1.1
log
@Add the meson MODULE.
It's still a bit rough around the edges but allows me to build the upcoming
libhttpseverywhere port.
@
text
@# $OpenBSD$

BUILD_DEPENDS +=	devel/meson>=0.39.1
SEPARATE_BUILD ?=	Yes

MODMESON_WANTCOLOR ?=	No
.if ${MODMESON_WANTCOLOR:L} == "no"
CONFIGURE_ENV += TERM="dumb"
.endif

.if empty(CONFIGURE_STYLE)
CONFIGURE_STYLE=	meson
.endif

.if ! empty(INSTALL_STRIP)
CONFIGURE_ARGS +=	--strip
.endif

MODMESON_configure=	${SETENV} CC="${CC}" CFLAGS="${CFLAGS}" CXX="${CXX}" \
				CXXFLAGS="${CXXFLAGS}" LDFLAGS="${LDFLAGS}" \
				LC_CTYPE="en_US.UTF-8" ${CONFIGURE_ENV} \
				${LOCALBASE}/bin/meson --buildtype=plain \
				--prefix "${PREFIX}" ${CONFIGURE_ARGS} \
				${WRKSRC} ${WRKBUILD}

.if !target(do-build)
do-build:
	${LOCALBASE}/bin/ninja -C ${WRKBUILD} -v -j ${MAKE_JOBS}
.endif

.if !target(do-install)
do-install:
	${LOCALBASE}/bin/ninja -C ${WRKBUILD} ${FAKE_TARGET}
.endif

.if !target(do-test)
do-test:
	${LOCALBASE}/bin/ninja -C ${WRKBUILD} ${TEST_TARGET}
.endif
@
