head	1.4;
access;
symbols
	OPENBSD_5_5:1.3.0.2
	OPENBSD_5_5_BASE:1.3;
locks; strict;
comment	@# @;


1.4
date	2014.03.26.08.28.15;	author ajacoutot;	state dead;
branches;
next	1.3;

1.3
date	2013.12.07.18.42.54;	author ajacoutot;	state Exp;
branches;
next	1.2;

1.2
date	2013.10.16.07.40.54;	author ajacoutot;	state dead;
branches;
next	1.1;

1.1
date	2013.09.25.12.37.07;	author ajacoutot;	state Exp;
branches;
next	;


desc
@@


1.4
log
@Update to glib2-2.40.0.
First step of the road to GNOME 3.12...

ok jasper@@
@
text
@$OpenBSD: patch-gio_gdbusobjectmanagerclient_c,v 1.3 2013/12/07 18:42:54 ajacoutot Exp $

From b9f54c4e9ad29e078c88f81ab79232d2850c72d8 Mon Sep 17 00:00:00 2001
From: Rui Matos <tiagomatos@@gmail.com>
Date: Wed, 27 Nov 2013 13:32:05 +0000
Subject: GDBusObjectManagerClient: keep the manager alive while firing signals

--- gio/gdbusobjectmanagerclient.c.orig	Tue Nov 12 06:30:27 2013
+++ gio/gdbusobjectmanagerclient.c	Sat Dec  7 19:37:33 2013
@@@@ -1006,6 +1006,7 @@@@ signal_cb (GDBusConnection *connection,
 
   //g_debug ("yay, signal_cb %s %s: %s\n", signal_name, object_path, g_variant_print (parameters, TRUE));
 
+  g_object_ref (manager);
   if (g_strcmp0 (interface_name, "org.freedesktop.DBus.Properties") == 0)
     {
       if (g_strcmp0 (signal_name, "PropertiesChanged") == 0)
@@@@ -1087,6 +1088,7 @@@@ signal_cb (GDBusConnection *connection,
           g_object_unref (interface);
         }
     }
+  g_object_unref (manager);
 
  out:
   g_clear_object (&object_proxy);
@@@@ -1243,6 +1245,7 @@@@ on_notify_g_name_owner (GObject    *object,
   new_name_owner = g_dbus_proxy_get_name_owner (manager->priv->control_proxy);
   manager->priv->name_owner = NULL;
 
+  g_object_ref (manager);
   if (g_strcmp0 (old_name_owner, new_name_owner) != 0)
     {
       GList *l;
@@@@ -1319,6 +1322,7 @@@@ on_notify_g_name_owner (GObject    *object,
 
     }
   g_free (old_name_owner);
+  g_object_unref (manager);
 }
 
 static gboolean
@@@@ -1543,6 +1547,7 @@@@ add_interfaces (GDBusObjectManagerClient *manager,
   g_mutex_unlock (&manager->priv->lock);
 
   /* now that we don't hold the lock any more, emit signals */
+  g_object_ref (manager);
   for (l = interface_added_signals; l != NULL; l = l->next)
     {
       interface_proxy = G_DBUS_PROXY (l->data);
@@@@ -1558,8 +1563,8 @@@@ add_interfaces (GDBusObjectManagerClient *manager,
                            op);
       g_signal_emit_by_name (manager, "object-added", op);
     }
+  g_object_unref (manager);
   g_object_unref (op);
-
 }
 
 static void
@@@@ -1592,6 +1597,7 @@@@ remove_interfaces (GDBusObjectManagerClient   *manager
   num_interfaces_to_remove = g_strv_length ((gchar **) interface_names);
 
   /* see if we are going to completety remove the object */
+  g_object_ref (manager);
   if (num_interfaces_to_remove == num_interfaces)
     {
       g_object_ref (op);
@@@@ -1617,6 +1623,7 @@@@ remove_interfaces (GDBusObjectManagerClient   *manager
         }
       g_object_unref (op);
     }
+  g_object_unref (manager);
  out:
   ;
 }
@


1.3
log
@GDBusObjectManagerClient: keep the manager alive while firing signals
(from upstream).
@
text
@d1 1
a1 1
$OpenBSD$
@


1.2
log
@Update to glib2-2.38.1.
@
text
@d1 1
a1 1
$OpenBSD: patch-gio_gdbusobjectmanagerclient_c,v 1.1 2013/09/25 12:37:07 ajacoutot Exp $
d3 4
a6 4
From 96df8b180b5d66696e37e4b1c21ee7cd8e69f487 Mon Sep 17 00:00:00 2001
From: James Strandboge <jamie@@strandboge.com>
Date: Tue, 24 Sep 2013 12:19:20 +0000
Subject: gio: Fix typo in the /org/freedesktop/DBus path
d8 68
a75 20
--- gio/gdbusobjectmanagerclient.c.orig	Thu Aug  8 12:00:40 2013
+++ gio/gdbusobjectmanagerclient.c	Tue Sep 24 15:32:35 2013
@@@@ -1113,7 +1113,7 @@@@ subscribe_signals (GDBusObjectManagerClient *manager,
 
       ret = g_dbus_connection_call_sync (manager->priv->connection,
                                          "org.freedesktop.DBus",
-                                         "/org/freedeskop/DBus",
+                                         "/org/freedesktop/DBus",
                                          "org.freedesktop.DBus",
                                          "AddMatch",
                                          g_variant_new ("(s)",
@@@@ -1198,7 +1198,7 @@@@ maybe_unsubscribe_signals (GDBusObjectManagerClient *m
        */
       g_dbus_connection_call (manager->priv->connection,
                               "org.freedesktop.DBus",
-                              "/org/freedeskop/DBus",
+                              "/org/freedesktop/DBus",
                               "org.freedesktop.DBus",
                               "RemoveMatch",
                               g_variant_new ("(s)",
@


1.1
log
@Major update to glib2-2.38.0 -- requirement for the WIP GNOME 3.10 update.
This and the following updates: atk, gdk-pixbuf2, pango, at-spi2-core,
at-spi2-atk, py-atspi and gtk+3 have been tested in a bulk by landry@@ (10x!)

Fallouts are:
- x11/gnome/anjuta: will be fixed within the next 2 or 3 days by the 3.10 update
- www/chromium: robert@@ is working on an update (removing -Werror should also
allow it to build)

ok landry@@ jasper@@
@
text
@d1 1
a1 1
$OpenBSD$
@

