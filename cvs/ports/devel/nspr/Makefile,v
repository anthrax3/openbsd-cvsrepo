head	1.65;
access;
symbols
	OPENBSD_6_1:1.63.0.2
	OPENBSD_6_1_BASE:1.63
	OPENBSD_6_0:1.60.0.2
	OPENBSD_6_0_BASE:1.60
	OPENBSD_5_9:1.57.0.2
	OPENBSD_5_9_BASE:1.57
	OPENBSD_5_8:1.55.0.4
	OPENBSD_5_8_BASE:1.55
	OPENBSD_5_7:1.54.0.2
	OPENBSD_5_7_BASE:1.54
	OPENBSD_5_6:1.53.0.2
	OPENBSD_5_6_BASE:1.53
	OPENBSD_5_5:1.51.0.2
	OPENBSD_5_5_BASE:1.51
	OPENBSD_5_4:1.49.0.2
	OPENBSD_5_4_BASE:1.49
	OPENBSD_5_3:1.45.0.2
	OPENBSD_5_3_BASE:1.45
	OPENBSD_5_2:1.41.0.2
	OPENBSD_5_2_BASE:1.41
	OPENBSD_5_1_BASE:1.38
	OPENBSD_5_1:1.38.0.2
	OPENBSD_5_0:1.34.0.4
	OPENBSD_5_0_BASE:1.34
	OPENBSD_4_9:1.34.0.2
	OPENBSD_4_9_BASE:1.34
	OPENBSD_4_8:1.31.0.2
	OPENBSD_4_8_BASE:1.31
	OPENBSD_4_7:1.30.0.2
	OPENBSD_4_7_BASE:1.30
	OPENBSD_4_6:1.29.0.2
	OPENBSD_4_6_BASE:1.29
	OPENBSD_4_5:1.28.0.2
	OPENBSD_4_5_BASE:1.28
	OPENBSD_4_4:1.26.0.2
	OPENBSD_4_4_BASE:1.26
	OPENBSD_4_3:1.24.0.2
	OPENBSD_4_3_BASE:1.24
	OPENBSD_4_2:1.22.0.2
	OPENBSD_4_2_BASE:1.22
	OPENBSD_4_1:1.20.0.2
	OPENBSD_4_1_BASE:1.20
	OPENBSD_4_0:1.5.0.4
	OPENBSD_4_0_BASE:1.5
	OPENBSD_3_9:1.5.0.2
	OPENBSD_3_9_BASE:1.5
	OPENBSD_3_8:1.4.0.4
	OPENBSD_3_8_BASE:1.4
	OPENBSD_3_7:1.4.0.2
	OPENBSD_3_7_BASE:1.4
	OPENBSD_3_6:1.3.0.2
	OPENBSD_3_6_BASE:1.3
	OPENBSD_3_5:1.1.1.1.0.2
	OPENBSD_3_5_BASE:1.1.1.1
	kmiller_20040129:1.1.1.1
	pvalchev:1.1.1;
locks; strict;
comment	@# @;


1.65
date	2017.05.11.15.30.37;	author sthen;	state Exp;
branches;
next	1.64;
commitid	zbF7LZ79AB56TsHK;

1.64
date	2017.04.22.11.56.11;	author landry;	state Exp;
branches;
next	1.63;
commitid	XaUG2PM2o5B8yHvk;

1.63
date	2016.10.24.09.32.41;	author landry;	state Exp;
branches;
next	1.62;
commitid	mr9yuvky4dk6wXXJ;

1.62
date	2016.10.06.12.04.40;	author landry;	state Exp;
branches;
next	1.61;
commitid	KSLBO9z1hozj1dgr;

1.61
date	2016.09.01.10.53.26;	author jasper;	state Exp;
branches;
next	1.60;
commitid	LdsIxWmxagN2Kq33;

1.60
date	2016.03.16.21.19.38;	author naddy;	state Exp;
branches;
next	1.59;
commitid	eS3Ayl3CL8hkKETd;

1.59
date	2016.03.12.07.02.16;	author mmcc;	state Exp;
branches;
next	1.58;
commitid	uo7e7jUd04945y22;

1.58
date	2016.03.01.21.02.30;	author landry;	state Exp;
branches;
next	1.57;
commitid	SA4M4a3o4FRJaXGY;

1.57
date	2015.11.23.11.31.37;	author landry;	state Exp;
branches;
next	1.56;
commitid	0y3HwUcJjk4u6p1w;

1.56
date	2015.10.30.07.58.52;	author landry;	state Exp;
branches;
next	1.55;
commitid	UeS3K4VDiujXEUR0;

1.55
date	2015.03.16.19.39.45;	author landry;	state Exp;
branches
	1.55.4.1;
next	1.54;
commitid	E2dWp233ZhTrt9El;

1.54
date	2014.09.24.18.43.39;	author landry;	state Exp;
branches;
next	1.53;
commitid	o43lqYIN2nwDWtRg;

1.53
date	2014.06.11.07.58.17;	author landry;	state Exp;
branches;
next	1.52;
commitid	5WpjA8uj4wNJ1n3A;

1.52
date	2014.03.10.20.17.27;	author landry;	state Exp;
branches;
next	1.51;

1.51
date	2013.11.13.20.54.45;	author landry;	state Exp;
branches;
next	1.50;

1.50
date	2013.10.03.19.13.35;	author landry;	state Exp;
branches;
next	1.49;

1.49
date	2013.06.23.18.36.50;	author landry;	state Exp;
branches
	1.49.2.1;
next	1.48;

1.48
date	2013.05.16.19.55.32;	author landry;	state Exp;
branches;
next	1.47;

1.47
date	2013.03.18.20.30.31;	author landry;	state Exp;
branches;
next	1.46;

1.46
date	2013.03.11.10.50.12;	author espie;	state Exp;
branches;
next	1.45;

1.45
date	2012.12.29.19.58.22;	author landry;	state Exp;
branches;
next	1.44;

1.44
date	2012.11.12.20.39.09;	author landry;	state Exp;
branches;
next	1.43;

1.43
date	2012.09.17.20.00.09;	author landry;	state Exp;
branches;
next	1.42;

1.42
date	2012.08.18.12.41.38;	author ajacoutot;	state Exp;
branches;
next	1.41;

1.41
date	2012.05.17.05.01.35;	author ajacoutot;	state Exp;
branches;
next	1.40;

1.40
date	2012.03.06.21.15.30;	author landry;	state Exp;
branches;
next	1.39;

1.39
date	2012.02.20.09.17.00;	author landry;	state Exp;
branches;
next	1.38;

1.38
date	2011.10.27.07.58.03;	author robert;	state Exp;
branches;
next	1.37;

1.37
date	2011.10.04.21.35.25;	author jasper;	state Exp;
branches;
next	1.36;

1.36
date	2011.10.03.17.54.23;	author landry;	state Exp;
branches;
next	1.35;

1.35
date	2011.08.23.20.07.08;	author landry;	state Exp;
branches;
next	1.34;

1.34
date	2011.01.15.16.58.28;	author landry;	state Exp;
branches;
next	1.33;

1.33
date	2011.01.03.13.21.04;	author landry;	state Exp;
branches;
next	1.32;

1.32
date	2010.08.30.20.12.55;	author landry;	state Exp;
branches;
next	1.31;

1.31
date	2010.03.30.11.47.33;	author jasper;	state Exp;
branches;
next	1.30;

1.30
date	2009.08.04.13.56.09;	author martynas;	state Exp;
branches;
next	1.29;

1.29
date	2009.03.23.00.50.52;	author jakemsr;	state Exp;
branches;
next	1.28;

1.28
date	2009.02.14.12.01.48;	author sthen;	state Exp;
branches;
next	1.27;

1.27
date	2008.12.15.21.26.04;	author martynas;	state Exp;
branches;
next	1.26;

1.26
date	2008.07.31.17.31.00;	author martynas;	state Exp;
branches;
next	1.25;

1.25
date	2008.07.25.00.42.33;	author martynas;	state Exp;
branches;
next	1.24;

1.24
date	2008.02.12.23.21.38;	author martynas;	state Exp;
branches;
next	1.23;

1.23
date	2007.09.16.02.53.02;	author merdely;	state Exp;
branches;
next	1.22;

1.22
date	2007.08.01.21.11.13;	author martynas;	state Exp;
branches;
next	1.21;

1.21
date	2007.05.22.18.47.14;	author ajacoutot;	state Exp;
branches;
next	1.20;

1.20
date	2007.03.06.18.30.31;	author kurt;	state Exp;
branches;
next	1.19;

1.19
date	2007.03.01.22.37.48;	author robert;	state Exp;
branches;
next	1.18;

1.18
date	2006.12.06.17.43.31;	author ajacoutot;	state Exp;
branches;
next	1.17;

1.17
date	2006.11.30.16.53.53;	author kurt;	state Exp;
branches;
next	1.16;

1.16
date	2006.11.23.10.13.33;	author ajacoutot;	state Exp;
branches;
next	1.15;

1.15
date	2006.11.23.09.36.03;	author ajacoutot;	state Exp;
branches;
next	1.14;

1.14
date	2006.11.15.17.42.24;	author kurt;	state Exp;
branches;
next	1.13;

1.13
date	2006.11.15.09.05.36;	author ajacoutot;	state Exp;
branches;
next	1.12;

1.12
date	2006.11.10.16.01.29;	author ajacoutot;	state Exp;
branches;
next	1.11;

1.11
date	2006.11.09.19.00.39;	author ajacoutot;	state Exp;
branches;
next	1.10;

1.10
date	2006.11.07.16.22.05;	author ajacoutot;	state Exp;
branches;
next	1.9;

1.9
date	2006.11.06.14.35.45;	author ajacoutot;	state Exp;
branches;
next	1.8;

1.8
date	2006.11.03.20.56.23;	author ajacoutot;	state Exp;
branches;
next	1.7;

1.7
date	2006.11.03.18.02.13;	author ajacoutot;	state Exp;
branches;
next	1.6;

1.6
date	2006.09.29.15.59.34;	author kurt;	state Exp;
branches;
next	1.5;

1.5
date	2006.01.07.19.45.35;	author bernd;	state Exp;
branches;
next	1.4;

1.4
date	2004.10.25.09.02.53;	author wilfried;	state Exp;
branches;
next	1.3;

1.3
date	2004.08.10.07.24.49;	author espie;	state Exp;
branches;
next	1.2;

1.2
date	2004.07.31.21.17.22;	author naddy;	state Exp;
branches;
next	1.1;

1.1
date	2004.01.29.21.57.53;	author pvalchev;	state Exp;
branches
	1.1.1.1;
next	;

1.1.1.1
date	2004.01.29.21.57.53;	author pvalchev;	state Exp;
branches;
next	;

1.49.2.1
date	2013.11.14.09.55.12;	author jasper;	state Exp;
branches;
next	;

1.55.4.1
date	2015.12.24.14.09.25;	author jasper;	state Exp;
branches;
next	;
commitid	hj0jQsFKKtzeY9au;


desc
@@


1.65
log
@add aarch64 to ONLY_FOR_ARCHS, missed commit when I fixed the patches
@
text
@# $OpenBSD: Makefile,v 1.64 2017/04/22 11:56:11 landry Exp $

ONLY_FOR_ARCHS=	aarch64 alpha amd64 arm i386 mips64 mips64el powerpc sparc64 hppa

COMMENT =		Netscape Portable Runtime

VER=			4.14
DISTNAME=		nspr-${VER}

SO_VERSION=		23.3
.for _lib in nspr4 plc4 plds4
SHARED_LIBS+=		${_lib} ${SO_VERSION}
.endfor

CATEGORIES=		devel

HOMEPAGE=		https://developer.mozilla.org/en-US/docs/Mozilla/Projects/NSPR

MAINTAINER=		Landry Breuil <landry@@openbsd.org>

WANTLIB=		c pthread

# MPL - Mozilla Public License
PERMIT_PACKAGE_CDROM=	Yes

MASTER_SITES =		http://ftp.mozilla.org/pub/mozilla.org/nspr/releases/v${VER}/src/

USE_GMAKE=		Yes
AUTOCONF_VERSION=	2.69
CONFIGURE_STYLE=	autoconf no-autoheader

MAKE_ENV=		SO_VERSION="${SO_VERSION}"
CONFIGURE_ENV=		${MAKE_ENV}

WRKSRC=			${WRKDIST}/nspr
MODGNU_CONFIG_GUESS_DIRS=${WRKSRC}/build/autoconf

do-test:
	${MAKE_PROGRAM} -C ${WRKSRC}/pr/tests
	${MAKE_PROGRAM} -C ${WRKSRC}/lib/tests
	@@cd ${WRKSRC}/pr/tests && ulimit -Sn 192 && env TZ=gmt \
		LD_LIBRARY_PATH=${WRKSRC}/dist/lib /bin/ksh runtests.sh
	LD_LIBRARY_PATH=${WRKSRC}/dist/lib ${WRKSRC}/lib/tests/string
	LD_LIBRARY_PATH=${WRKSRC}/dist/lib ${WRKSRC}/lib/tests/base64t

.include <bsd.port.mk>
@


1.64
log
@Update to nspr 4.14, requirement for firefox 54.

See https://groups.google.com/forum/#!topic/mozilla.dev.tech.nspr/YQyOYHnKJjA
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.63 2016/10/24 09:32:41 landry Exp $
d3 1
a3 1
ONLY_FOR_ARCHS=	alpha amd64 arm i386 mips64 mips64el powerpc sparc64 hppa
@


1.63
log
@Bugfix update to nspr 4.13.1.

Revert a change made in 4.13 cycle (pipes were made non-blocking by
default) that caused regressions in certain cases.

See
https://groups.google.com/forum/#!topic/mozilla.dev.tech.nspr/vHMBwAcu7x4
and https://bugzilla.mozilla.org/show_bug.cgi?id=1289145
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.62 2016/10/06 12:04:40 landry Exp $
d7 1
a7 1
VER=			4.13.1
@


1.62
log
@Update to nspr 4.13.

See
https://groups.google.com/forum/#!topic/mozilla.dev.tech.nspr/AhNiw22wz7U
for the small amount of changes.
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.61 2016/09/01 10:53:26 jasper Exp $
d7 1
a7 1
VER=			4.13
@


1.61
log
@retire sparc
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.60 2016/03/16 21:19:38 naddy Exp $
d7 1
a7 1
VER=			4.12
a8 1
REVISION=		0
@


1.60
log
@remove SHARED_ONLY from ports that use only the gnu module
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.59 2016/03/12 07:02:16 mmcc Exp $
d3 1
a3 1
ONLY_FOR_ARCHS=	alpha amd64 arm i386 mips64 mips64el powerpc sparc sparc64 hppa
@


1.59
log
@replace some 404ing Mozilla HOMEPAGEs

ok landry
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.58 2016/03/01 21:02:30 landry Exp $
a3 1
SHARED_ONLY =	Yes
@


1.58
log
@Update to nspr 4.12, requirement of upcoming gecko 45.

Bump minor as PR_GetEnvSecure() was added to prenv.h.

Remove now useless patch-nspr_pr_src_pthreads_ptthread_c, was merged
upstream in https://hg.mozilla.org/projects/nspr/rev/85f6c6480115
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.57 2015/11/23 11:31:37 landry Exp $
d10 1
d19 1
a19 1
HOMEPAGE=		http://www.mozilla.org/projects/nspr/index.html
@


1.57
log
@Update to nspr 4.11.

Tested in a bulk by ajacoutot@@, thanks!
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.56 2015/10/30 07:58:52 landry Exp $
d8 1
a8 1
VER=			4.11
d11 1
a11 1
SO_VERSION=		23.2
@


1.56
log
@Update to nspr 4.10.10.
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.55 2015/03/16 19:39:45 landry Exp $
d8 1
a8 1
VER=			4.10.10
@


1.55
log
@Update to nspr 4.10.8.

- https://groups.google.com/forum/#!topic/mozilla.dev.tech.nspr/6yPZqtZhHzM
- remove rwlockrank.c patch, merged in #1072454
- remove chunk of patch-nspr_pr_src_pthreads_ptthread_c, merged upstream
  in #756047. Leave chunk about pthread_set_name_np() returning void, to
be upstreamed
- use PATH_MAX instead of MAXPATHLEN in patch-nspr_pr_src_linking_prlink_c
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.54 2014/09/24 18:43:39 landry Exp $
d8 1
a8 1
VER=			4.10.8
d11 1
a11 1
SO_VERSION=		23.1
@


1.55.4.1
log
@- update to nspr-4.10.10
* minimum required version for firefox-esr 35
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.55 2015/03/16 19:39:45 landry Exp $
d8 1
a8 1
VER=			4.10.10
d11 1
a11 1
SO_VERSION=		23.2
@


1.54
log
@Update to NSPR 4.10.7.
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.53 2014/06/11 07:58:17 landry Exp $
d8 1
a8 1
VER=			4.10.7
@


1.53
log
@Update to nspr 4.10.6, required by upcoming ffx 30.

Might or might not fix security issues, noone knows as there are no
release announcements, nor changelogs. Check
http://hg.mozilla.org/projects/nspr/shortlog for a list of changes...
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.52 2014/03/10 20:17:27 landry Exp $
d8 1
a8 1
VER=			4.10.6
@


1.52
log
@Minor bugfix update to nspr 4.10.3, req'ed by future mozillas.
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.51 2013/11/13 20:54:45 landry Exp $
d8 1
a8 1
VER=			4.10.3
d30 1
a30 1
AUTOCONF_VERSION=	2.13
@


1.51
log
@SECURITY(?) update to nspr 4.10.2.

Fixes the following bugs:
Bug 927687: Avoid unsigned integer wrapping in PL_ArenaAllocate (possible CVE?, not confirmed yet)
Bug 770534: eliminate possible pointer overflow in PL_ArenaAllocate().
Bug 888546: PR_ImportUDPSocket doesn't work.

No release notes yet.
Note: This is what will be shipped within Fx 25.0.1, per #935568 & #935959.
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.50 2013/10/03 19:13:35 landry Exp $
d8 1
a8 1
VER=			4.10.2
d11 1
a11 1
SO_VERSION=		23.0
@


1.50
log
@Bugfix update to nspr 4.10.1.

Went in a bulk build without fallout.
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.49 2013/06/23 18:36:50 landry Exp $
d8 1
a8 1
VER=			4.10.1
@


1.49
log
@Update to nspr 4.10.

http://mozilla.6506.n7.nabble.com/ANNOUNCE-NSPR-4-10-Release-td280660.html

After years of sticking to CVS, upstream finally switched to hg,
changing its directory layout while here. All our patches are actually
unchanged, but got renamed/moved. CVS doesn't handle moves :)

Tested in an amd64 bulk build.
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.48 2013/05/16 19:55:32 landry Exp $
d8 1
a8 1
VER=			4.10
@


1.49.2.1
log
@Security fix for CVE-2013-5607

ok sthen@@
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.49 2013/06/23 18:36:50 landry Exp $
a9 1
REVISION=		0
@


1.48
log
@Update to nspr 4.9.6, needed by upcoming ffx 21.

NSPR 4.9.6 has the following bug fixes:
* Bug 782214: Auto detect Android API version for x86.
* Bug 807883: Add the PL_SizeOfArenaPoolExcludingPool function.
* Bug 812085: Initialize Windows CRITICAL_SECTIONs without debug info
 and with nonzero spin count.
* Bug 827271: Add support for Aarch64 (64-Bit ARM).
* Bug 841651: PR_SetThreadPriority doesn't do anything when using Bionic.

Bump minor for PL_SizeOfArenaPoolExcludingPool addition.
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.47 2013/03/18 20:30:31 landry Exp $
d8 1
a8 1
VER=			4.9.6
d11 1
a11 1
SO_VERSION=		22.3
d27 1
a27 2
MASTER_SITES=		http://ftp.eu.mozilla.org/pub/mozilla.org/nspr/releases/v${VER}/src/ \
			http://ftp.mozilla.org/pub/mozilla.org/nspr/releases/v${VER}/src/
a31 2
CONFIGURE_ARGS+=	--disable-debug \
			--with-pthreads
d36 1
a36 1
WRKSRC=			${WRKDIST}/mozilla/nsprpub
@


1.47
log
@Update to nspr 4.9.5.

After two years of discussion in bug #634793 and countless hours lost on
filing followup bugs at each type mismatch, nspr upstream finally got
convinced that on OpenBSD uint64_t was unsigned long long, and there was
no reason at all to define PRUint64 as unsigned long, happily raping the
principle of least surprise. So now that upstream behaves correctly,
remove the two pr{long,types}.h patches.

And there was much rejoicing.

Tested on sparc64/ppc/hppa/amd64, went in a bunch of bulk builds.
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.46 2013/03/11 10:50:12 espie Exp $
d8 1
a8 1
VER=			4.9.5
d11 1
a11 1
SO_VERSION=		22.2
@


1.46
log
@PERMIT_* / REGRESS->TEST sweep
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.45 2012/12/29 19:58:22 landry Exp $
d8 1
a8 1
VER=			4.9.4
@


1.45
log
@Update to nspr 4.9.4.
Tested on sparc64 & hppa, and went into an amd64 bulk build.
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.44 2012/11/12 20:39:09 landry Exp $
a25 3
PERMIT_PACKAGE_FTP=	Yes
PERMIT_DISTFILES_CDROM=	Yes
PERMIT_DISTFILES_FTP=	Yes
d42 1
a42 1
do-regress:
@


1.44
log
@Update to nspr 4.9.3.

- remove subpackages, it makes no sense to have -docs fetching its distfile
from a separate tarball. If really needed one can make a standalone port.
- remove handmade nspr.pc.in, upstream provides one
- remove handrolled install target and use the one upstream provides.
- merge PFRAG.shared back into PLIST

Tested on amd64/i386/powerpc and in a bulk build.
Needed by firefox 18.

ok sthen@@ ajacoutot@@ jasper@@
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.43 2012/09/17 20:00:09 landry Exp $
d4 1
d8 1
a8 1
VER=			4.9.3
@


1.43
log
@Update to nspr 4.9.2.

- Garbage collect patch adding -pthread hack while here.
- Improve pthread_set_name_np() call (returns void)
- Needed anyway by upcoming Mozilla 16 releases
been in a bunch of amd64 bulks, ok ajacoutot@@
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.42 2012/08/18 12:41:38 ajacoutot Exp $
d5 1
a5 2
COMMENT-main=		Netscape Portable Runtime
COMMENT-docs=		HTML Documentation for NSPR
d7 1
a7 1
VER=			4.9.2
a8 4
PKGNAME-main=		${DISTNAME}
PKGNAME-docs=		nspr-docs-${VER}
DISTFILES=		${DISTNAME}${EXTRACT_SUFX} \
			nspr-reference${EXTRACT_SUFX}:0
d10 1
a10 1
SO_VERSION=		22.1
d21 1
a21 1
WANTLIB-main=		c
a30 5
MASTER_SITES0=		http://ftp.eu.mozilla.org/pub/mozilla.org/nspr/doc/ \
			http://ftp.mozilla.org/pub/mozilla.org/nspr/doc/
MULTI_PACKAGES= -main -docs

PKG_ARCH-docs=	*
a42 20

pre-configure:
	@@cp ${FILESDIR}/nspr.pc.in ${WRKSRC}/config/

do-install:
	${INSTALL_DATA_DIR} ${PREFIX}/include/nspr
	${INSTALL_DATA_DIR} ${PREFIX}/lib/pkgconfig
	${INSTALL_DATA_DIR} ${PREFIX}/share/doc/nspr/html
	cd ${WRKSRC}/dist/include && \
		find . -type d \
			-exec ${INSTALL_DATA_DIR} ${PREFIX}/include/{} \; && \
		find . ! -type d \
			-exec ${INSTALL_DATA} {} ${PREFIX}/include/{} \;
	cd ${WRKSRC}/dist/lib && tar cfL - . | \
		(cd ${PREFIX}/lib && tar -xf -)
	cd ${WRKDIR}/nspr/reference/html && \
		pax -s ',.*/CVS.*,,' -rwvpe . ${PREFIX}/share/doc/nspr/html
	${INSTALL_SCRIPT} ${WRKSRC}/config/nspr-config ${PREFIX}/bin
	${INSTALL_DATA} ${WRKSRC}/config/nspr.pc ${PREFIX}/lib/pkgconfig
	chown -R ${SHAREOWN}:${SHAREGRP} ${PREFIX}/share/doc/nspr/html
@


1.42
log
@Remove irrelevant $FreeBSD RCS ids.
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.41 2012/05/17 05:01:35 ajacoutot Exp $
d8 1
a8 1
VER=			4.9
a10 1
REVISION-main=		1
d15 1
a15 1
SO_VERSION=		22.0
@


1.41
log
@Fix usage of the _POSIX_THREAD_PRIORITY_SCHEDULING macro.

from Brad
@
text
@d1 1
a1 2
# $OpenBSD: Makefile,v 1.40 2012/03/06 21:15:30 landry Exp $
# $FreeBSD: /repoman/r/pcvs/ports/devel/nspr/Makefile,v 1.13 2003/12/13 21:30:19 peter Exp $
@


1.40
log
@Garbage collect two patches :
- using /dev/arandom instead of /dev/urandom is not needed anymore
- #undef _POSIX_THREAD_PRIORITY_SCHEDULING is not needed since the
  switch to rthreads.
from brad.
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.39 2012/02/20 09:17:00 landry Exp $
d12 1
a12 1
REVISION-main=		0
@


1.39
log
@Update to nspr 4.9, needed for mozilla 11+.
Tested on alpha amd64 hppa i386 powerpc sparc64, no change in regression
output (well, dtoa still fails, but thats not surprising given
corresponding code is heavily patched)
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.38 2011/10/27 07:58:03 robert Exp $
d12 1
@


1.38
log
@match uint64_t and int64_t typedefs with the system ones to avoid confusion
in chrome for example

ok jasper@@
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.37 2011/10/04 21:35:25 jasper Exp $
d9 1
a9 1
VER=			4.8.9
a11 1
REVISION-main =		1
a12 1
REVISION-docs = 	0
@


1.37
log
@missing bump
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.36 2011/10/03 17:54:23 landry Exp $
d12 1
a12 1
REVISION-main =		0
@


1.36
log
@Add patch from #650772 after lengthy bikeshedding. On OpenBSD, the
.so.x.y passed to PR_LoadLibrary() is never the same as the one on
linux, since the portstree controls the .x.y, so if the first dlopen()
fails, let's strip what's after .so and retry, since ld.so is clever
enough to open the correct lib if asked for libfoo.so. Allows me to
remove smth like 40 patches in all mozilla ports. Take maintainership
while here.
discussed with deraadt@@
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.35 2011/08/23 20:07:08 landry Exp $
d14 1
@


1.35
log
@Update to nspr 4.8.9, needed by upcoming mozilla updates.
Bump major as some prtime #define were changed.
Remove a patch merged upstream (bug #622425)
ok martynas@@ rpointel@@
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.34 2011/01/15 16:58:28 landry Exp $
d12 1
d26 1
a26 1
MAINTAINER=		Martynas Venckus <martynas@@openbsd.org>
@


1.34
log
@Update to nspr 4.8.7, required by ffx4.0b8 and later, and
soon-to-be-required by stable releases in other mozilla branches.
ok sthen@@ martynas@@
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.33 2011/01/03 13:21:04 landry Exp $
d9 1
a9 1
VER=			4.8.7
d16 1
a16 1
SO_VERSION=		21.1
@


1.33
log
@Make sure that PR_GetPhysicalMemorySize() is properly implemented by
using the same code NetBSD uses. Tracked down after a report from tedu@@
about default memory cache size. Reported upstream as
https://bugzilla.mozilla.org/show_bug.cgi?id=622425
ok & tested by dcoppa@@
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.32 2010/08/30 20:12:55 landry Exp $
d9 1
a9 1
VER=			4.8.6
a11 1
REVISION-main=		0
@


1.32
log
@Update to nspr 4.8.6, required by (at least) a future firefox 4 update..
Tested in a bunch of amd64 bulk builds.
ok naddy@@ phessler@@
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.31 2010/03/30 11:47:33 jasper Exp $
d12 1
@


1.31
log
@- allow this to build on mips64*

feedback from kettenis@@
ok phessler@@
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.30 2009/08/04 13:56:09 martynas Exp $
d9 1
a9 1
VER=			4.8
d16 1
a16 1
SO_VERSION=		21.0
@


1.30
log
@update to nspr-4.8.  security.  please note, this will be needed
in stable for further mozilla-firefox security updates.
bulk build done by sthen@@.  thanks!
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.29 2009/03/23 00:50:52 jakemsr Exp $
d4 1
a4 1
ONLY_FOR_ARCHS=	alpha amd64 arm i386 powerpc sparc sparc64 hppa
@


1.29
log
@use /dev/arandom instead of /dev/urandom.  reading from /dev/urandom
is too slow.

ok martynas@@
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.28 2009/02/14 12:01:48 sthen Exp $
d9 1
a9 1
VER=			4.7.3
d11 1
a11 1
PKGNAME-main=		${DISTNAME}p0
d16 1
a16 1
SO_VERSION=		20.0
@


1.28
log
@build this on hppa; ok martynas (maintainer).
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.27 2008/12/15 21:26:04 martynas Exp $
d11 1
a11 1
PKGNAME-main=		${DISTNAME}
@


1.27
log
@NSPR 4.7.3:
- PL_ArenaFinish should zero the static variable PRCallOnceType
once.
- Missing _MD_UNLOCK() in IsFileLocal in ntio.c.
- PR_Interrupt() interrupts PR_TransmitFile() while PR_BlockInterrupt()
in effect.
- use /dev/urandom instead of /dev/random
ok naddy@@
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.26 2008/07/31 17:31:00 martynas Exp $
d4 1
a4 1
ONLY_FOR_ARCHS=	alpha amd64 arm i386 powerpc sparc sparc64
@


1.26
log
@nspr 4.7.1 ships source tarball with weird permission modes.  fix
modes for header files in the install target, so that the resulting
package is right, and non-root/wheel users are able to build apps
depending on nspr
ok kurt@@, naddy@@, pval@@
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.25 2008/07/25 00:42:33 martynas Exp $
d9 1
a9 1
VER=			4.7.1
d11 1
a11 1
PKGNAME-main=		${DISTNAME}p0
@


1.25
log
@update to nspr-4.7.1.  also needed by firefox 3.0
tested by many, both w/ mozilla 1.8 branch projects, and mozilla 1.9
"nspr and nss should go in" naddy@@
ok kurt@@
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.24 2008/02/12 23:21:38 martynas Exp $
d11 1
a11 1
PKGNAME-main=		${DISTNAME}
d62 5
a66 2
	cd ${WRKSRC}/dist/include && tar cfL - . | \
		(cd ${PREFIX}/include && tar -xf -)
@


1.24
log
@update to nspr-4.6.8;  ok kurt@@
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.23 2007/09/16 02:53:02 merdely Exp $
d9 1
a9 1
VER=			4.6.8
d16 1
a16 1
SO_VERSION=		19.0
d76 1
a76 1
		LD_LIBRARY_PATH=${WRKSRC}/dist/lib /bin/ksh runtests.ksh
@


1.23
log
@Remove quotes surrounding COMMENT*/PERMIT_*/BROKEN
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.22 2007/08/01 21:11:13 martynas Exp $
d9 1
a9 1
VER=			4.6.7
@


1.22
log
@update to 4.6.7;  ok kurt@@
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.21 2007/05/22 18:47:14 ajacoutot Exp $
d6 2
a7 2
COMMENT-main=		"Netscape Portable Runtime"
COMMENT-docs=		"HTML Documentation for NSPR"
@


1.21
log
@- give maintainership to martynas@@
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.20 2007/03/06 18:30:31 kurt Exp $
d9 1
a9 1
VER=			4.6.5
d11 2
a12 2
PKGNAME-main=		${DISTNAME}p1
PKGNAME-docs=		nspr-docs-${VER}p0
@


1.20
log
@bump SO_VERSION to 19.0 to make room for firefox -stable updates. firefox
in -stable has internal nspr and will cause issues for users who upgrade if
SO_VERSION reaches 19.0 due to the .libs package. discussed with martynas.
okay pvalchev@@
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.19 2007/03/01 22:37:48 robert Exp $
d11 2
a12 2
PKGNAME-main=		${DISTNAME}p0
PKGNAME-docs=		nspr-docs-${VER}
d25 1
a25 1
MAINTAINER=		Antoine Jacoutot <ajacoutot@@openbsd.org>
@


1.19
log
@update to version 4.6.5; from Martynas Venckus; ok pvalchev@@
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.18 2006/12/06 17:43:31 ajacoutot Exp $
d11 1
a11 1
PKGNAME-main=		${DISTNAME}
d16 1
a16 1
SO_VERSION=		18.1
@


1.18
log
@- remove substitutions in PKGNAME

talked with and ok jasper@@
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.17 2006/11/30 16:53:53 kurt Exp $
d9 1
a9 1
VER=			4.6.4
d11 1
a11 1
PKGNAME-main=		${DISTNAME}p1
d16 1
a16 1
SO_VERSION=		18.0
d75 4
a78 3
	@@cd ${WRKSRC}/pr/tests && ulimit -Sn 192 && /bin/ksh runtests.ksh
	LD_LIBRARY_PATH=${WRKSRC}/dist/lib/ ${WRKSRC}/lib/tests/string
	LD_LIBRARY_PATH=${WRKSRC}/dist/lib/ ${WRKSRC}/lib/tests/base64t
@


1.17
log
@Don't append nspr's shared lib version in PR_GetLibraryName. This fixes
missing 'Builtin Roots Module'/Authorities problem in mozilla* apps.
okay ajacoutot@@
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.16 2006/11/23 10:13:33 ajacoutot Exp $
d12 1
a12 1
PKGNAME-docs=		${DISTNAME:S/-/-docs-/}
@


1.16
log
@- add @@pkgpath to PLIST-main (oops)
- bump PKGNAME

spotted by steven@@
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.15 2006/11/23 09:36:03 ajacoutot Exp $
d11 1
a11 1
PKGNAME-main=		${DISTNAME}p0
a55 2
	perl -pi -e 's,_SO_VERSION_,${SO_VERSION},g' \
		${WRKSRC}/pr/include/md/_openbsd.h
@


1.15
log
@- update to 4.6.4
from Martynas Venckus <martynas at altroot dot org>, thanks!

ok jolan@@
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.14 2006/11/15 17:42:24 kurt Exp $
d11 1
a11 1
PKGNAME-main=		${DISTNAME}
@


1.14
log
@link in libc since we are using libc strtod and __dtoa
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.13 2006/11/15 09:05:36 ajacoutot Exp $
d6 1
a6 1
COMMENT=		"Netscape Portable Runtime"
d9 1
a9 1
VER=			4.6.3
d11 1
a11 1
PKGNAME=		${DISTNAME}p2
d16 1
a16 1
SO_VERSION=		17.0
d27 1
a27 1
WANTLIB=		c
d39 1
a39 2
MULTI_PACKAGES= -docs
SUBPACKAGE?=
d41 1
a41 3
.if defined(PACKAGING) && ${SUBPACKAGE} == "-docs"
PKG_ARCH=	*
.endif
@


1.13
log
@- add arm support (from kili@@)
- increase soft limits for regression tests and make sure the prpollml
test works (from kili@@ and kurt@@)
- enable nameshm1 regression test (disable ClientServerTest function)

ok kurt@@
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.12 2006/11/10 16:01:29 ajacoutot Exp $
d11 1
a11 1
PKGNAME=		${DISTNAME}p1
d26 2
@


1.12
log
@- add a -doc subpackage with complete HTML documentation reference

"looks good" steven@@
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.11 2006/11/09 19:00:39 ajacoutot Exp $
d4 1
a4 1
ONLY_FOR_ARCHS=	alpha amd64 i386 powerpc sparc sparc64
d78 1
a78 1
	@@cd ${WRKSRC}/pr/tests && /bin/ksh runtests.ksh
@


1.11
log
@- re-add socket regression test (but do not run IPv4->IPv6 mapping tests
  under OpenBSD)
- bump so version to 17 as Firefox 1.5.0.8 will use 16 (from wilfried@@)
- bump PKGNAME

go ahead steven@@
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.10 2006/11/07 16:22:05 ajacoutot Exp $
d7 1
d12 3
d35 8
d64 1
d69 2
d73 1
@


1.10
log
@- bump SHARED_LIBS version up to 16.0 (one more than the highest
  mozilla.org app uses now and should prevent any library issues for the
  transition to devel/nspr) ; from kurt@@ (asked by kili@@ and steven@@)
- add regression tests ; the following tests are disabled as they need
  more work: nameshm1, sema, semaerr, semaping, socket
- bump PKGNAME

ok kurt@@
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.9 2006/11/06 14:35:45 ajacoutot Exp $
d10 1
a10 1
PKGNAME=		${DISTNAME}p0
d12 1
a12 1
SO_VERSION=		16.0
@


1.9
log
@- update to latest stable version (4.6.3) - 3 years worth of changes!
- use patches from www/mozilla-firefox (should now work on all supported
  Firefox platforms)
- replaced internal strtod and dtoa implementations (patch from kurt@@)
- create and install nspr.pc (from FreeBSD)
- change MASTER_SITES, remove USE_X11, update pkg/DESCR

ok mbalmer@@ kurt@@
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.8 2006/11/03 20:56:23 ajacoutot Exp $
d10 1
d12 1
a12 1
SO_VERSION=		1.0
a40 2
NO_REGRESS=		Yes

d58 7
@


1.8
log
@- add sparc64 to ONLY_FOR_ARCHS
- take over maintainership
- bump PKGNAME

ok kurt@@
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.7 2006/11/03 18:02:13 ajacoutot Exp $
d4 1
a4 1
ONLY_FOR_ARCHS=		i386 powerpc amd64 sparc64
d8 1
a8 1
VER=			4.4.1
d10 5
a14 4
PKGNAME=		${DISTNAME}p3
SHARED_LIBS=		nspr4	1.0 \
			plc4	1.0 \
			plds4	1.0
d28 2
a29 1
MASTER_SITES=		http://ftp.mozilla.org/pub/mozilla.org/nspr/releases/v${VER}/src/
a30 1
USE_X11=		Yes
a31 1

d37 2
a38 3
MAKE_ENV=		LIBnspr4_VERSION=${LIBnspr4_VERSION} \
			LIBplc4_VERSION=${LIBplc4_VERSION} \
			LIBplds4_VERSION=${LIBplds4_VERSION}
d45 5
d52 1
d58 1
@


1.7
log
@Add support for amd64, from NetBSD

ok sturm@@
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.6 2006/09/29 15:59:34 kurt Exp $
d4 1
a4 1
ONLY_FOR_ARCHS=		i386 powerpc amd64
d10 1
a10 1
PKGNAME=		${DISTNAME}p2
d19 1
a19 1
MAINTAINER=		Kurt Miller <kurt@@openbsd.org>
@


1.6
log
@- add powerpc to ONLY_FOR_ARCHS. From Antoine Jacoutot <ajacoutot at
lphp.org>
- update MAINTAINER email while here
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.5 2006/01/07 19:45:35 bernd Exp $
d4 1
a4 1
ONLY_FOR_ARCHS=		i386 powerpc
d10 1
a10 1
PKGNAME=		${DISTNAME}p1
@


1.5
log
@SHARED_LIBS
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.4 2004/10/25 09:02:53 wilfried Exp $
d4 1
a4 2
# currently only supporting i386, but alpha sparc sparc64 are possible
ONLY_FOR_ARCHS=		i386
d10 1
a10 1
PKGNAME=		${DISTNAME}p0
d19 1
a19 1
MAINTAINER=		Kurt Miller <truk@@optonline.net>
@


1.4
log
@fix built with the new getproto*_r, ok maintainer
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.3 2004/08/10 07:24:49 espie Exp $
d11 5
d37 4
@


1.3
log
@Follow symlinks for libraries as well.
Package has been unusable since its import.
Does anybody use these things ?
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.2 2004/07/31 21:17:22 naddy Exp $
d28 2
a29 2
CONFIGURE_STYLE=	gnu
CONFIGURE_SCRIPT=	../configure
d35 2
a36 2
WRKSRC=			${WRKDIST}/mozilla/nsprpub/build
MODGNU_CONFIG_GUESS_DIRS=${WRKSRC}/autoconf
@


1.2
log
@fix up MODGNU_CONFIG_GUESS_DIRS
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.1.1.1 2004/01/29 21:57:53 pvalchev Exp $
d42 1
a42 1
	cd ${WRKSRC}/dist/lib && tar cf - . | \
@


1.1
log
@Initial revision
@
text
@d1 1
a1 1
# $OpenBSD$
d36 1
@


1.1.1.1
log
@Import of nspr-4.4.1

Netscape Portable Runtime (NSPR) provides a platform-neutral
API for system level and libc like functions. The API is used
in the Mozilla client, many of Netscape/AOL/iPlanet's and other
software offerings.

i386-only for now.

From maintainer Kurt Miller <truk@@optonline.net>
@
text
@@
