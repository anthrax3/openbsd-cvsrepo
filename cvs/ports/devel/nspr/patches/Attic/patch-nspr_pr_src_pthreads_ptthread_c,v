head	1.6;
access;
symbols
	OPENBSD_5_9:1.5.0.2
	OPENBSD_5_9_BASE:1.5
	OPENBSD_5_8:1.4.0.4
	OPENBSD_5_8_BASE:1.4
	OPENBSD_5_7:1.3.0.4
	OPENBSD_5_7_BASE:1.3
	OPENBSD_5_6:1.3.0.2
	OPENBSD_5_6_BASE:1.3
	OPENBSD_5_5:1.1.0.4
	OPENBSD_5_5_BASE:1.1
	OPENBSD_5_4:1.1.0.2
	OPENBSD_5_4_BASE:1.1;
locks; strict;
comment	@# @;


1.6
date	2016.03.01.21.02.30;	author landry;	state dead;
branches;
next	1.5;
commitid	SA4M4a3o4FRJaXGY;

1.5
date	2015.10.30.07.58.52;	author landry;	state Exp;
branches;
next	1.4;
commitid	UeS3K4VDiujXEUR0;

1.4
date	2015.03.16.19.39.45;	author landry;	state Exp;
branches
	1.4.4.1;
next	1.3;
commitid	E2dWp233ZhTrt9El;

1.3
date	2014.06.11.07.58.17;	author landry;	state Exp;
branches;
next	1.2;
commitid	5WpjA8uj4wNJ1n3A;

1.2
date	2014.03.10.20.17.27;	author landry;	state Exp;
branches;
next	1.1;

1.1
date	2013.06.23.18.36.50;	author landry;	state Exp;
branches;
next	;

1.4.4.1
date	2015.12.24.14.09.25;	author jasper;	state Exp;
branches;
next	;
commitid	hj0jQsFKKtzeY9au;


desc
@@


1.6
log
@Update to nspr 4.12, requirement of upcoming gecko 45.

Bump minor as PR_GetEnvSecure() was added to prenv.h.

Remove now useless patch-nspr_pr_src_pthreads_ptthread_c, was merged
upstream in https://hg.mozilla.org/projects/nspr/rev/85f6c6480115
@
text
@$OpenBSD: patch-nspr_pr_src_pthreads_ptthread_c,v 1.5 2015/10/30 07:58:52 landry Exp $

On OpenBSD pthread_set_name_np returns void

--- nspr/pr/src/pthreads/ptthread.c.orig	Fri Oct 16 15:22:19 2015
+++ nspr/pr/src/pthreads/ptthread.c	Wed Oct 21 08:55:29 2015
@@@@ -16,6 +16,7 @@@@
 #include "prpdce.h"
 
 #include <pthread.h>
+#include <pthread_np.h>
 #include <unistd.h>
 #include <string.h>
 #include <signal.h>
@@@@ -1752,7 +1753,8 @@@@ PR_IMPLEMENT(PRStatus) PR_SetCurrentThreadName(const c
     memcpy(thread->name, name, nameLen + 1);
 
 #if defined(OPENBSD) || defined(FREEBSD)
-    result = pthread_set_name_np(thread->id, name);
+    pthread_set_name_np(thread->id, name);
+    result = 0;
 #else /* not BSD */
     /*
      * On OSX, pthread_setname_np is only available in 10.6 or later, so test
@


1.5
log
@Update to nspr 4.10.10.
@
text
@d1 1
a1 1
$OpenBSD: patch-nspr_pr_src_pthreads_ptthread_c,v 1.4 2015/03/16 19:39:45 landry Exp $
@


1.4
log
@Update to nspr 4.10.8.

- https://groups.google.com/forum/#!topic/mozilla.dev.tech.nspr/6yPZqtZhHzM
- remove rwlockrank.c patch, merged in #1072454
- remove chunk of patch-nspr_pr_src_pthreads_ptthread_c, merged upstream
  in #756047. Leave chunk about pthread_set_name_np() returning void, to
be upstreamed
- use PATH_MAX instead of MAXPATHLEN in patch-nspr_pr_src_linking_prlink_c
@
text
@d1 1
a1 1
$OpenBSD: patch-nspr_pr_src_pthreads_ptthread_c,v 1.3 2014/06/11 07:58:17 landry Exp $
d5 2
a6 2
--- nspr/pr/src/pthreads/ptthread.c.orig	Thu Jun  5 23:42:08 2014
+++ nspr/pr/src/pthreads/ptthread.c	Wed Jun 11 07:58:34 2014
d15 1
a15 1
@@@@ -1750,7 +1755,8 @@@@ PR_IMPLEMENT(PRStatus) PR_SetCurrentThreadName(const c
@


1.4.4.1
log
@- update to nspr-4.10.10
* minimum required version for firefox-esr 35
@
text
@d1 1
a1 1
$OpenBSD: patch-nspr_pr_src_pthreads_ptthread_c,v 1.5 2015/10/30 07:58:52 landry Exp $
d5 2
a6 2
--- nspr/pr/src/pthreads/ptthread.c.orig	Fri Oct 16 15:22:19 2015
+++ nspr/pr/src/pthreads/ptthread.c	Wed Oct 21 08:55:29 2015
d15 1
a15 1
@@@@ -1752,7 +1753,8 @@@@ PR_IMPLEMENT(PRStatus) PR_SetCurrentThreadName(const c
@


1.3
log
@Update to nspr 4.10.6, required by upcoming ffx 30.

Might or might not fix security issues, noone knows as there are no
release announcements, nor changelogs. Check
http://hg.mozilla.org/projects/nspr/shortlog for a list of changes...
@
text
@d1 4
a4 4
$OpenBSD: patch-nspr_pr_src_pthreads_ptthread_c,v 1.2 2014/03/10 20:17:27 landry Exp $
Don't only check for _POSIX_THREAD_PRIORITY_SCHEDULING being defined, but check that it's > 0
on openbsd/rthreads it's -1 atm.
https://bugzilla.mozilla.org/show_bug.cgi?id=756047
a14 11
@@@@ -36,6 +37,10 @@@@
 #endif
 #endif
 
+#if defined(_POSIX_THREAD_PRIORITY_SCHEDULING) && !(_POSIX_THREAD_PRIORITY_SCHEDULING > 0)
+#undef _POSIX_THREAD_PRIORITY_SCHEDULING
+#endif
+
 /*
  * Record whether or not we have the privilege to set the scheduling
  * policy and priority of threads.  0 means that privilege is available.
@


1.2
log
@Minor bugfix update to nspr 4.10.3, req'ed by future mozillas.
@
text
@d1 1
a1 1
$OpenBSD: patch-nspr_pr_src_pthreads_ptthread_c,v 1.1 2013/06/23 18:36:50 landry Exp $
d5 2
a6 2
--- nspr/pr/src/pthreads/ptthread.c.orig	Mon Jan 27 20:37:44 2014
+++ nspr/pr/src/pthreads/ptthread.c	Sun Feb 16 14:53:32 2014
d26 1
a26 1
@@@@ -1733,7 +1738,8 @@@@ PR_IMPLEMENT(PRStatus) PR_SetCurrentThreadName(const c
@


1.1
log
@Update to nspr 4.10.

http://mozilla.6506.n7.nabble.com/ANNOUNCE-NSPR-4-10-Release-td280660.html

After years of sticking to CVS, upstream finally switched to hg,
changing its directory layout while here. All our patches are actually
unchanged, but got renamed/moved. CVS doesn't handle moves :)

Tested in an amd64 bulk build.
@
text
@d1 1
a1 1
$OpenBSD$
d5 2
a6 2
--- nspr/pr/src/pthreads/ptthread.c.orig	Tue May 28 23:39:29 2013
+++ nspr/pr/src/pthreads/ptthread.c	Wed Jun 12 21:26:28 2013
d26 1
a26 1
@@@@ -1719,7 +1724,8 @@@@ PR_IMPLEMENT(PRStatus) PR_SetCurrentThreadName(const c
@

