head	1.34;
access;
symbols
	OPENBSD_6_1:1.34.0.2
	OPENBSD_6_1_BASE:1.34
	OPENBSD_6_0:1.32.0.2
	OPENBSD_6_0_BASE:1.32
	OPENBSD_5_9:1.30.0.2
	OPENBSD_5_9_BASE:1.30
	OPENBSD_5_8:1.29.0.4
	OPENBSD_5_8_BASE:1.29
	OPENBSD_5_7:1.23.0.4
	OPENBSD_5_7_BASE:1.23
	OPENBSD_5_6:1.23.0.2
	OPENBSD_5_6_BASE:1.23
	OPENBSD_5_5:1.20.0.2
	OPENBSD_5_5_BASE:1.20
	OPENBSD_5_4:1.15.0.2
	OPENBSD_5_4_BASE:1.15
	OPENBSD_5_3:1.11.0.2
	OPENBSD_5_3_BASE:1.11
	OPENBSD_5_2:1.3.0.2
	OPENBSD_5_2_BASE:1.3
	landry_20120407:1.1.1.1
	landry:1.1.1;
locks; strict;
comment	@# @;


1.34
date	2016.08.20.08.37.12;	author jasper;	state Exp;
branches;
next	1.33;
commitid	hJLS7TeBkduJAt8x;

1.33
date	2016.08.13.10.43.02;	author jasper;	state Exp;
branches;
next	1.32;
commitid	e9VTHqB3NEFopGSs;

1.32
date	2016.03.20.16.12.24;	author naddy;	state Exp;
branches;
next	1.31;
commitid	guiZq8cnNbVyyHzx;

1.31
date	2016.03.12.07.02.16;	author mmcc;	state Exp;
branches;
next	1.30;
commitid	uo7e7jUd04945y22;

1.30
date	2015.10.08.21.19.22;	author sthen;	state Exp;
branches;
next	1.29;
commitid	pVDZUjJm7yyuQSI1;

1.29
date	2015.05.28.10.17.23;	author pascal;	state Exp;
branches;
next	1.28;
commitid	020U4lCPk8wUkCOz;

1.28
date	2015.04.17.12.57.11;	author jasper;	state Exp;
branches;
next	1.27;
commitid	QmrwjDopA5uOZLqy;

1.27
date	2015.04.06.08.48.54;	author ajacoutot;	state Exp;
branches;
next	1.26;
commitid	NRHjNkqiNIW4UrBU;

1.26
date	2015.04.05.23.28.13;	author ajacoutot;	state Exp;
branches;
next	1.25;
commitid	YT7roKfnDoQoQTyF;

1.25
date	2015.03.19.20.02.53;	author landry;	state Exp;
branches;
next	1.24;
commitid	ChrT8dX8z1b2Oo4d;

1.24
date	2015.03.19.19.27.57;	author landry;	state Exp;
branches;
next	1.23;
commitid	C0wQ6dPk0W9yE0NT;

1.23
date	2014.05.19.10.28.39;	author ajacoutot;	state Exp;
branches;
next	1.22;

1.22
date	2014.03.26.16.05.38;	author ajacoutot;	state Exp;
branches;
next	1.21;

1.21
date	2014.03.26.10.11.01;	author landry;	state Exp;
branches;
next	1.20;

1.20
date	2013.11.25.14.16.22;	author sthen;	state Exp;
branches;
next	1.19;

1.19
date	2013.09.27.17.32.51;	author ajacoutot;	state Exp;
branches;
next	1.18;

1.18
date	2013.09.10.06.18.41;	author ajacoutot;	state Exp;
branches;
next	1.17;

1.17
date	2013.08.11.09.09.03;	author landry;	state Exp;
branches;
next	1.16;

1.16
date	2013.08.10.12.41.39;	author landry;	state Exp;
branches;
next	1.15;

1.15
date	2013.04.14.08.15.59;	author ajacoutot;	state Exp;
branches;
next	1.14;

1.14
date	2013.04.01.11.54.39;	author kettenis;	state Exp;
branches;
next	1.13;

1.13
date	2013.03.11.10.50.31;	author espie;	state Exp;
branches;
next	1.12;

1.12
date	2013.03.05.10.27.38;	author sthen;	state Exp;
branches;
next	1.11;

1.11
date	2013.02.12.20.02.53;	author landry;	state Exp;
branches;
next	1.10;

1.10
date	2013.01.21.20.02.09;	author bcallah;	state Exp;
branches;
next	1.9;

1.9
date	2012.12.06.15.43.21;	author jasper;	state Exp;
branches;
next	1.8;

1.8
date	2012.11.12.20.45.32;	author landry;	state Exp;
branches;
next	1.7;

1.7
date	2012.09.29.07.17.47;	author landry;	state Exp;
branches;
next	1.6;

1.6
date	2012.09.18.18.05.16;	author ajacoutot;	state Exp;
branches;
next	1.5;

1.5
date	2012.09.17.06.00.09;	author ajacoutot;	state Exp;
branches;
next	1.4;

1.4
date	2012.08.20.12.51.55;	author ajacoutot;	state Exp;
branches;
next	1.3;

1.3
date	2012.07.07.22.46.19;	author ajacoutot;	state Exp;
branches;
next	1.2;

1.2
date	2012.04.08.17.21.26;	author ajacoutot;	state Exp;
branches;
next	1.1;

1.1
date	2012.04.07.13.48.18;	author landry;	state Exp;
branches
	1.1.1.1;
next	;

1.1.1.1
date	2012.04.07.13.48.18;	author landry;	state Exp;
branches;
next	;


desc
@@


1.34
log
@set USE_WXNEEDED for sqlports' sake; patch-config_config_mk is still needed.
@
text
@# $OpenBSD: Makefile,v 1.33 2016/08/13 10:43:02 jasper Exp $

# jsapi-tests crashes in js::MarkRangeConservatively() on hppa (SIGSEGV in js/src/jsgc.cpp:1142)
# jsapi-tests crashes in js::Bindings::switchToScriptStorage() on alpha (SIGBUS in jsutil.h:235)
# jsapi-tests crashes in js::Bindings::switchToScriptStorage() on sparc64 & mips64 (SIGBUS in jsutil.h:33)
# but let's keep them to build more packages
ONLY_FOR_ARCHS =	alpha amd64 i386 hppa mips64el mips64 powerpc sparc64

COMMENT =		Mozilla C implementation of JavaScript

MOZILLA_VERSION =	24
SUBST_VARS +=		MOZILLA_VERSION

DISTNAME =		mozjs-${MOZILLA_VERSION}.2.0
EXTRACT_SUFX =		.tar.bz2
PKGNAME =		spidermonkey-${MOZILLA_VERSION}.2.0
PKGSPEC =		spidermonkey->=24.0,<25.0
REVISION =		5

SO_VERSION =		0.0
SHARED_LIBS =		mozjs-24 ${SO_VERSION}
CATEGORIES =		devel

HOMEPAGE =		https://developer.mozilla.org/en-US/docs/Mozilla/Projects/SpiderMonkey
MASTER_SITES =		http://ftp.mozilla.org/pub/mozilla.org/js/
#https://groups.google.com/forum/#!topic/mozilla.dev.tech.js-engine/h6pw_gCCsfU

# MPL
PERMIT_PACKAGE_CDROM=	Yes

MODULES =		lang/python

# sync with games/0ad/base x11/gnome/builder x11/gnome/shell x11/gnome/gjs
MODULES +=		gcc4
MODGCC4_ARCHS =		*
MODGCC4_LANGS =		c c++

WANTLIB += c m pthread readline nspr4 ncurses plc4 plds4 z

MODPY_RUNDEP =		No
TEST_DEPENDS =		${MODPY_RUN_DEPENDS}
LIB_DEPENDS =		devel/nspr

# XXX: see patches/patch-config_config_mk
USE_WXNEEDED =		Yes

WRKDIST =		${WRKDIR}/${DISTNAME}/js/src
USE_GMAKE =		yes
CONFIGURE_STYLE =	gnu
CONFIGURE_ARGS =	--with-pthread \
			--with-system-nspr \
			--enable-readline \
			--enable-ctypes \
			--disable-intl-api \
			--enable-threadsafe

CONFIGURE_ENV +=	SO_VERSION="${SO_VERSION}" \
			MOZILLA_VERSION="${MOZILLA_VERSION}" \
			LIBS=-lncurses

post-install:
	rm ${PREFIX}/lib/libmozjs-${MOZILLA_VERSION}.a
.ifndef DEBUG
	${STRIP} ${PREFIX}/bin/js${MOZILLA_VERSION}
	${STRIP} ${PREFIX}/lib/libmozjs-${MOZILLA_VERSION}.so.${LIBmozjs-24_VERSION}
.endif

.include <bsd.port.mk>
@


1.33
log
@mark wxneeded

ok landry@@ (moral MAINTAINER)
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.32 2016/03/20 16:12:24 naddy Exp $
d43 3
@


1.32
log
@drop SHARED_ONLY from python and ruby ports
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.31 2016/03/12 07:02:16 mmcc Exp $
d18 1
a18 1
REVISION =		4
@


1.31
log
@replace some 404ing Mozilla HOMEPAGEs

ok landry
@
text
@d1 1
a1 3
# $OpenBSD: Makefile,v 1.30 2015/10/08 21:19:22 sthen Exp $

SHARED_ONLY =		Yes
@


1.30
log
@Bump some ports which reference if_msghdr in their source, so that package
updates are triggered. This is following the struct if_data ABI change a few
days ago; if_msghdr has an embedded if_data.  Some may be unnecessary, but
some are definitely needed and bumps are cheaper than debugging.
Problem reported with wpa_supplicant by Mikolaj Kucharski.
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.29 2015/05/28 10:17:23 pascal Exp $
d20 1
a20 1
REVISION =		3
d26 1
a26 1
HOMEPAGE =		http://www.mozilla.org/js/spidermonkey/
@


1.29
log
@gcc4 bumps, reminded by aja@@
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.28 2015/04/17 12:57:11 jasper Exp $
d20 1
a20 1
REVISION =		2
@


1.28
log
@trailing whitespace
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.27 2015/04/06 08:48:54 ajacoutot Exp $
d20 1
a20 1
REVISION =		1
@


1.27
log
@Keep in sync.
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.26 2015/04/05 23:28:13 ajacoutot Exp $
d17 1
a17 1
EXTRACT_SUFX =		.tar.bz2 
@


1.26
log
@amd64 should not be special; just use gcc4 as the other archs.
Needed for upcoming gnome-builder port.
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.25 2015/03/19 20:02:53 landry Exp $
d35 1
@


1.25
log
@remove comment not meaning anything anymore, pointed out by ajacoutot@@
@
text
@d1 3
a3 1
# $OpenBSD: Makefile,v 1.24 2015/03/19 19:27:57 landry Exp $
a4 2
SHARED_ONLY=	Yes
# based on ffx 24 engine
d11 1
a11 1
COMMENT =	Mozilla C implementation of JavaScript
d14 2
d17 1
d20 1
a20 1
REVISION =		0
d22 3
a24 3
SO_VERSION =	0.0
SHARED_LIBS =	mozjs-24 ${SO_VERSION}
CATEGORIES =	devel
d26 2
a27 2
HOMEPAGE =	http://www.mozilla.org/js/spidermonkey/
MASTER_SITES =	http://ftp.mozilla.org/pub/mozilla.org/js/
d29 1
a29 1
EXTRACT_SUFX=	.tar.bz2 
d33 4
a36 5
MODULES =	lang/python
# necessary glue to build with the correct compiler after fx 17
# sync with x11/gnome/gjs and x11/gnome/shell
MODULES +=		gcc4 lang/clang
MODGCC4_ARCHS =		powerpc sparc64 alpha i386 hppa
a37 4
MODCLANG_ARCHS =	amd64
MODCLANG_LANGS =	c c++

WANTLIB += c m pthread readline nspr4 ncurses plc4 plds4 stdc++ z
d39 1
a39 3
MODPY_RUNDEP =	No
TEST_DEPENDS = ${MODPY_RUN_DEPENDS}
LIB_DEPENDS =	devel/nspr
d41 3
a43 1
SUBST_VARS +=	MOZILLA_VERSION
d45 2
a46 2
WRKDIST =	${WRKDIR}/${DISTNAME}/js/src
USE_GMAKE =	yes
@


1.24
log
@Tentatively enable on hppa, fixing the build with a oneliner..
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.23 2014/05/19 10:28:39 ajacoutot Exp $
a8 1
# XXX: sync with net/libproxy and x11/gtk+3
@


1.23
log
@strip(1) when building without DEBUG.
Drop the static archive, it's not used by anything.

This saves us 500M per pkg...
ok jasper@@ landry@@ (maintainer)
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.22 2014/03/26 16:05:38 ajacoutot Exp $
d35 1
a35 1
MODGCC4_ARCHS =		powerpc sparc64 alpha i386
@


1.22
log
@These 3 need to be in sync wrt to compiler MODULE.
Add missing MODGCC4_LANGS to the gnome ports while here.

ok jasper@@
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.21 2014/03/26 10:11:01 landry Exp $
d18 1
d61 7
@


1.21
log
@Update to spidermonkey 24.2.0.

Somewhat tested on amd64/sparc64, now requires a decent compiler so will
only build anyway on i386/amd64/sparc64/powerpc with 4.8 and maaaybe
alpha/hppa via 4.6. Let's be crazy and use clang on amd64, tough shit
for mips64(el).

Required by the GNOME steamroller, with prodding from the hobbits.
Stuff depending on it (polkit/gjs) will soon be updated to work with it.
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.20 2013/11/25 14:16:22 sthen Exp $
d32 1
@


1.20
log
@kill VMEM_WARNING
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.19 2013/09/27 17:32:51 ajacoutot Exp $
d4 1
a4 1
# based on ffx 17 engine
d14 4
a17 5
MOZILLA_VERSION =	17.0
DISTNAME =		mozjs17.0.0
PKGNAME =		spidermonkey-${MOZILLA_VERSION}
PKGSPEC =		spidermonkey->=17.0,<18.0
REVISION =		0
d20 1
a20 1
SHARED_LIBS =	mozjs-17.0 ${SO_VERSION}
d25 2
a26 1

d30 8
a39 1
MODULES =	lang/python
d53 1
@


1.19
log
@Remove devel/gconf2 from comment.
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.18 2013/09/10 06:18:41 ajacoutot Exp $
a30 2

VMEM_WARNING =	Yes
@


1.18
log
@Restore the stack alignment patch that was lost during the last update.
This fixes crashes in firefox, gnome-shell,... on i386.

reported by Christian Schulte.
figured out by kettenis@@ and guenther@@
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.17 2013/08/11 09:09:03 landry Exp $
d9 1
a9 1
# XXX: sync with devel/gconf2, net/libproxy and x11/gtk+3
@


1.17
log
@Fix build on sparc64/hppa/alpha/mips64*.

- resurrect most of patch-ctypes*
- fix pagesize for alpha/sparc64/mips64 in patch-gc_Heap_h
- patch-assembler* from bcallah@@

As advertised, most of this is broken at runtime, but it's not that worse than previously.
# jsapi-tests crashes in js::MarkRangeConservatively() on hppa (SIGSEGV in js/src/jsgc.cpp:1142)
# jsapi-tests crashes in js::Bindings::switchToScriptStorage() on alpha (SIGBUS in jsutil.h:235)
# jsapi-tests crashes in js::Bindings::switchToScriptStorage() on sparc64 & mips64 (SIGBUS in jsutil.h:33)
-
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.16 2013/08/10 12:41:39 landry Exp $
d18 1
@


1.16
log
@Update devel/spidermonkey to 17.0, matching the JS engine from firefox 17

- adjust PKGSPEC to match the new versions.
- gnome 3.10 will soon start relying on it, depending ports will be
  fixed in a short moment.
- library is now mosjs-17.0.
- remove lots of patches merged upstream (see bug #735599)
- only remaining patch to jsval.h backported from #618485 for sparc64.
- tested on i386/macppc/amd64/sparc64, alpha/mips64* & hppa will be
  tested soon.
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.15 2013/04/14 08:15:59 ajacoutot Exp $
d4 4
a7 3
# based on ffx 17 engine, broken at runtime on sparc64
# jsapi-tests crashes in js::MarkRangeConservatively() on hppa
# some tests crash on mips64 
@


1.15
log
@Add libproxy to the watch list.
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.14 2013/04/01 11:54:39 kettenis Exp $
d4 1
a4 2

# 1.8.5 is based on ffx 10 engine, broken at runtime on sparc64
d13 2
a14 2
MOZILLA_VERSION =	1.8.5
DISTNAME =		js185-1.0.0
d16 1
a16 2
PKGSPEC =		spidermonkey->=1.8,<1.9
REVISION =		6
d19 1
a19 1
SHARED_LIBS =	mozjs185 ${SO_VERSION}
d28 1
a28 1
WANTLIB += c m pthread readline nspr4 ncurses plc4 plds4 stdc++
a31 8
.if ${MACHINE_ARCH} == "i386"
PKG_ARGS+=	-Djit=1 -Damd64=0
.elif ${MACHINE_ARCH} == "amd64"
PKG_ARGS+=	-Djit=1 -Damd64=1
.else
PKG_ARGS+=	-Djit=0 -Damd64=0
.endif

a34 1
BUILD_DEPENDS =	archivers/zip
a36 2
MODGNU_CONFIG_GUESS_DIRS=${WRKSRC} ${WRKSRC}/ctypes/libffi

d39 1
a39 1
WRKDIST =	${WRKDIR}/js-${MOZILLA_VERSION}/js/src
d41 2
a42 2
CONFIGURE_STYLE =	autoconf no-autoheader
CONFIGURE_ARGS =	--with-pthreads \
@


1.14
log
@Fix stack alignment on i386.

ok jasper@@, ajacoutot@@
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.13 2013/03/11 10:50:31 espie Exp $
d4 1
d9 1
a9 1
# XXX: sync with x11/gtk+3 and devel/gconf2
@


1.13
log
@PERMIT_* / REGRESS->TEST sweep
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.12 2013/03/05 10:27:38 sthen Exp $
d17 1
a17 1
REVISION =		5
@


1.12
log
@add note about devel/gconf2
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.11 2013/02/12 20:02:53 landry Exp $
a27 3
PERMIT_PACKAGE_FTP=	Yes
PERMIT_DISTFILES_CDROM=	Yes
PERMIT_DISTFILES_FTP=	Yes
d43 1
a43 1
REGRESS_DEPENDS = ${MODPY_RUN_DEPENDS}
@


1.11
log
@Enable spidermonkey on alpha & hppa.

It works flawlessly on alpha, crashes right away on hppa, but it's not
worse than sparc64 in that regard, so maybe that'll allow more stuff to
build on those archs.

ok sthen@@ ajacoutot@@
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.10 2013/01/21 20:02:09 bcallah Exp $
d8 1
a8 1
# XXX: sync with x11/gtk+3
@


1.10
log
@Welcome mips64* to the JavaScript world.
Help and edits from landry@@

ok landry@@
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.9 2012/12/06 15:43:21 jasper Exp $
d5 3
a7 1
# but let's keep it to build more packages
d9 1
a9 1
ONLY_FOR_ARCHS =	amd64 i386 mips64el mips64 powerpc sparc64
@


1.9
log
@actually, use ONLY_FOR_ARCHS-cups; prompted by landry@@

ok aja@@
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.8 2012/11/12 20:45:32 landry Exp $
d7 1
a7 1
ONLY_FOR_ARCHS =	amd64 i386 powerpc sparc64
d15 1
a15 1
REVISION =		4
@


1.8
log
@Bump all ports depending on nspr to account for the devel/nspr,-main ->
devel/nspr pkgpath change. While here, make sure mozilla ports depend on
the latest and greatest via mozilla.port.mk.
Tested in a bulk build..
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.7 2012/09/29 07:17:47 landry Exp $
d6 1
@


1.7
log
@Mark as ONLY_FOR_ARCHS=amd64 i386 powerpc sparc64, since there's little
luck it build or ever work on other archs. Maybe sparc, mips64*, alpha
or arm someday ?
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.6 2012/09/18 18:05:16 ajacoutot Exp $
d14 1
a14 1
REVISION =		3
@


1.6
log
@Add VMEM_WARNING.
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.5 2012/09/17 06:00:09 ajacoutot Exp $
d4 3
@


1.5
log
@Sync the jsnativestack patch with the one in Firefox which is actually
more correct than this one.

ok landry@@
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.4 2012/08/20 12:51:55 ajacoutot Exp $
d27 2
@


1.4
log
@s/--with-pthread/--with-pthreads
Add MODGNU_CONFIG_GUESS_DIRS.
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.3 2012/07/07 22:46:19 ajacoutot Exp $
d11 1
a11 1
REVISION =		2
@


1.3
log
@Don't compile with -DJS_C_STRINGS_ARE_UTF8. It is not the default, other
OSes do not enable it and our locale support is poor.
This actually unbreaks the whole javascript gang in GNOME (gjs...).
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.2 2012/04/08 17:21:26 ajacoutot Exp $
d11 1
a11 1
REVISION =		1
d26 2
d41 2
a42 1
WANTLIB =	c m pthread readline nspr4 ncurses plc4 plds4 stdc++
d49 1
a49 1
CONFIGURE_ARGS =	--with-pthread \
@


1.2
log
@Use PKGSPEC to make sure the 2 spidermonkey ports are differentiated
when checking for dependencies.

ok landry@@
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.1.1.1 2012/04/07 13:48:18 landry Exp $
d11 1
a11 1
REVISION =		0
d54 1
a54 2
			LIBS=-lncurses \
			CPPFLAGS=-DJS_C_STRINGS_ARE_UTF8
@


1.1
log
@Initial revision
@
text
@d1 1
a1 1
# $OpenBSD$
d10 2
@


1.1.1.1
log
@Import devel/spidermonkey 1.8.5

- built from the official upstream release
- needed for upcoming gnome/js update
- this is not an update to lang/spidermonkey, as that new version was
  built upon Ffx 4 js engine and probably only works on amd64/i386/ppc.
It builds on sparc64 but is broken at runtime. Not marking BROKEN-* to
allow depending ports to build. Other archs untested.
- special care was taken to ensure it doesnt conflict with
  lang/spidermonkey (install versionned binaries/headers..)
- ports wanting to use it should use devel/spidermonkey>=1.8,<1.9 to
  ensure the correct version is picked up

Tested in an amd64 bulk build.
ok/prodding ajacoutot@@
@
text
@@
