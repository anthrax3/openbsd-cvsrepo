head	1.2;
access;
symbols
	OPENBSD_5_5:1.1.0.2
	OPENBSD_5_5_BASE:1.1;
locks; strict;
comment	@# @;


1.2
date	2014.03.26.10.11.01;	author landry;	state dead;
branches;
next	1.1;

1.1
date	2013.08.11.09.09.04;	author landry;	state Exp;
branches;
next	;


desc
@@


1.2
log
@Update to spidermonkey 24.2.0.

Somewhat tested on amd64/sparc64, now requires a decent compiler so will
only build anyway on i386/amd64/sparc64/powerpc with 4.8 and maaaybe
alpha/hppa via 4.6. Let's be crazy and use clang on amd64, tough shit
for mips64(el).

Required by the GNOME steamroller, with prodding from the hobbits.
Stuff depending on it (polkit/gjs) will soon be updated to work with it.
@
text
@$OpenBSD: patch-gc_Heap_h,v 1.1 2013/08/11 09:09:04 landry Exp $
alpha & sparc64 has 8k pagesize too
assume all mips64 have 16k pagesize..
--- gc/Heap.h.orig	Mon Feb 11 22:33:22 2013
+++ gc/Heap.h	Sun Aug 11 08:06:15 2013
@@@@ -108,8 +108,10 @@@@ struct Cell
  * Bug 692267: Move page size definition to gc/Memory.h and include it
  *             directly once jsgc.h is no longer an installed header.
  */
-#if defined(SOLARIS) && (defined(__sparc) || defined(__sparcv9))
+#if defined(SOLARIS) && (defined(__sparc) || defined(__sparcv9)) || defined(__alpha__) || defined (__sparc64__)
 const size_t PageShift = 13;
+#elif defined(__mips64__)
+const size_t PageShift = 14;
 #else
 const size_t PageShift = 12;
 #endif
@


1.1
log
@Fix build on sparc64/hppa/alpha/mips64*.

- resurrect most of patch-ctypes*
- fix pagesize for alpha/sparc64/mips64 in patch-gc_Heap_h
- patch-assembler* from bcallah@@

As advertised, most of this is broken at runtime, but it's not that worse than previously.
# jsapi-tests crashes in js::MarkRangeConservatively() on hppa (SIGSEGV in js/src/jsgc.cpp:1142)
# jsapi-tests crashes in js::Bindings::switchToScriptStorage() on alpha (SIGBUS in jsutil.h:235)
# jsapi-tests crashes in js::Bindings::switchToScriptStorage() on sparc64 & mips64 (SIGBUS in jsutil.h:33)
-
@
text
@d1 1
a1 1
$OpenBSD$
@

