head	1.6;
access;
symbols
	OPENBSD_5_5:1.5.0.2
	OPENBSD_5_5_BASE:1.5
	OPENBSD_5_4:1.3.0.4
	OPENBSD_5_4_BASE:1.3
	OPENBSD_5_3:1.3.0.2
	OPENBSD_5_3_BASE:1.3
	OPENBSD_5_2:1.1.1.1.0.2
	OPENBSD_5_2_BASE:1.1.1.1
	landry_20120407:1.1.1.1
	landry:1.1.1;
locks; strict;
comment	@# @;


1.6
date	2014.03.26.10.11.01;	author landry;	state dead;
branches;
next	1.5;

1.5
date	2013.08.11.09.09.03;	author landry;	state Exp;
branches;
next	1.4;

1.4
date	2013.08.10.12.41.39;	author landry;	state dead;
branches;
next	1.3;

1.3
date	2013.02.12.20.02.53;	author landry;	state Exp;
branches;
next	1.2;

1.2
date	2013.01.21.20.02.09;	author bcallah;	state Exp;
branches;
next	1.1;

1.1
date	2012.04.07.13.48.18;	author landry;	state Exp;
branches
	1.1.1.1;
next	;

1.1.1.1
date	2012.04.07.13.48.18;	author landry;	state Exp;
branches;
next	;


desc
@@


1.6
log
@Update to spidermonkey 24.2.0.

Somewhat tested on amd64/sparc64, now requires a decent compiler so will
only build anyway on i386/amd64/sparc64/powerpc with 4.8 and maaaybe
alpha/hppa via 4.6. Let's be crazy and use clang on amd64, tough shit
for mips64(el).

Required by the GNOME steamroller, with prodding from the hobbits.
Stuff depending on it (polkit/gjs) will soon be updated to work with it.
@
text
@$OpenBSD: patch-Makefile_in,v 1.5 2013/08/11 09:09:03 landry Exp $
Disable YARR_JIT on mips64, not the same ABI ?
--- Makefile.in.orig	Sat Aug 10 22:14:07 2013
+++ Makefile.in	Sat Aug 10 22:14:37 2013
@@@@ -328,7 +328,7 @@@@ CPPSRCS += ExecutableAllocatorOS2.cpp \
            $(NONE)
 endif
 
-ifneq (,$(filter arm% sparc %86 x86_64 mips%,$(TARGET_CPU)))
+ifneq (,$(filter arm% sparc %86 x86_64 mips,$(TARGET_CPU)))
 ENABLE_YARR_JIT = 1
 DEFINES += -DENABLE_YARR_JIT=1
 
@


1.5
log
@Fix build on sparc64/hppa/alpha/mips64*.

- resurrect most of patch-ctypes*
- fix pagesize for alpha/sparc64/mips64 in patch-gc_Heap_h
- patch-assembler* from bcallah@@

As advertised, most of this is broken at runtime, but it's not that worse than previously.
# jsapi-tests crashes in js::MarkRangeConservatively() on hppa (SIGSEGV in js/src/jsgc.cpp:1142)
# jsapi-tests crashes in js::Bindings::switchToScriptStorage() on alpha (SIGBUS in jsutil.h:235)
# jsapi-tests crashes in js::Bindings::switchToScriptStorage() on sparc64 & mips64 (SIGBUS in jsutil.h:33)
-
@
text
@d1 1
a1 1
$OpenBSD$
@


1.4
log
@Update devel/spidermonkey to 17.0, matching the JS engine from firefox 17

- adjust PKGSPEC to match the new versions.
- gnome 3.10 will soon start relying on it, depending ports will be
  fixed in a short moment.
- library is now mosjs-17.0.
- remove lots of patches merged upstream (see bug #735599)
- only remaining patch to jsval.h backported from #618485 for sparc64.
- tested on i386/macppc/amd64/sparc64, alpha/mips64* & hppa will be
  tested soon.
@
text
@d1 6
a6 5
$OpenBSD: patch-Makefile_in,v 1.3 2013/02/12 20:02:53 landry Exp $
Don't do the horrible symlink dance
--- Makefile.in.orig	Thu Mar 31 21:08:36 2011
+++ Makefile.in	Fri Jan 18 22:20:16 2013
@@@@ -95,7 +95,7 @@@@ MODULE_OPTIMIZE_FLAGS = -O2 -ip
a7 1
 else # not INTEL_CXX
d9 4
a12 2
-MODULE_OPTIMIZE_FLAGS = -O3 -fstrict-aliasing
+MODULE_OPTIMIZE_FLAGS = -fstrict-aliasing
a13 47
 # We normally want -fomit-frame-pointer, but we want an explicit
 # -fno-omit-frame-pointer if we're using a sampling profiler.
@@@@ -382,7 +382,7 @@@@ CPPSRCS += 	checks.cc \
 # END enclude sources for V8 dtoa
 #############################################
 
-ifeq (,$(filter-out powerpc sparc,$(TARGET_CPU)))
+ifeq (,$(filter-out powerpc alpha hppa mips64 mips64el sparc sparc64,$(TARGET_CPU)))
 
 VPATH +=	$(srcdir)/assembler \
 		$(srcdir)/assembler/wtf \
@@@@ -852,10 +852,11 @@@@ install:: $(pkg_config_files)
 	$(SYSINSTALL) $(IFLAGS1) $^ $(DESTDIR)$(libdir)/pkgconfig
 
 install:: $(INSTALLED_HEADERS)
-	$(SYSINSTALL) $^ $(DESTDIR)$(includedir)/$(MODULE)
+	$(SYSINSTALL) $^ $(DESTDIR)$(includedir)/$(MODULE)-$(MOZILLA_VERSION)
 
 install:: $(SCRIPTS)
-	$(SYSINSTALL) $^ $(DESTDIR)$(bindir)
+	install js-config $(DESTDIR)$(bindir)/js-config-$(MOZILLA_VERSION)
+	install js $(DESTDIR)$(bindir)/js-$(MOZILLA_VERSION)
 
 ifeq (,$(HOST_BIN_SUFFIX))
 ifeq (.dylib,$(DLL_SUFFIX))
@@@@ -871,7 +872,7 @@@@ else
 SHLIB_ANY_VER   := $(DESTDIR)$(libdir)/$(SHARED_LIBRARY)
 SHLIB_ABI_VER   := $(DESTDIR)$(libdir)/$(SHARED_LIBRARY).$(SRCREL_ABI_VERSION)
 SHLIB_EXACT_VER := $(DESTDIR)$(libdir)/$(SHARED_LIBRARY).$(SRCREL_VERSION)
-$(SHARED_LIBRARY): EXTRA_DSO_LDOPTS += -Wl,-soname,$(notdir $(SHLIB_ABI_VER))
+$(SHARED_LIBRARY): EXTRA_DSO_LDOPTS += -Wl,-soname,$(SHARED_LIBRARY)
 endif
 endif
 
@@@@ -885,12 +886,6 @@@@ ifeq (,$(HOST_BIN_SUFFIX))
 	@@[ ! -h $(SHLIB_ANY_VER) ] || rm -f $(SHLIB_ANY_VER)
 endif
 	$(SYSINSTALL) $(SHARED_LIBRARY) $(DESTDIR)$(libdir)
-ifeq (,$(HOST_BIN_SUFFIX))
-	mv -f $(SHLIB_ANY_VER) $(SHLIB_EXACT_VER)
-	@@[ ! -h $(SHLIB_ABI_VER) ] || rm -f $(SHLIB_ABI_VER)
-	ln -s $(SHLIB_EXACT_VER) $(SHLIB_ABI_VER)
-	ln -s $(SHLIB_ABI_VER) $(SHLIB_ANY_VER)
-endif
 endif
 ifneq (,$(IMPORT_LIBRARY))
 	$(SYSINSTALL) $(IMPORT_LIBRARY) $(DESTDIR)$(libdir)
@


1.3
log
@Enable spidermonkey on alpha & hppa.

It works flawlessly on alpha, crashes right away on hppa, but it's not
worse than sparc64 in that regard, so maybe that'll allow more stuff to
build on those archs.

ok sthen@@ ajacoutot@@
@
text
@d1 1
a1 1
$OpenBSD: patch-Makefile_in,v 1.2 2013/01/21 20:02:09 bcallah Exp $
@


1.2
log
@Welcome mips64* to the JavaScript world.
Help and edits from landry@@

ok landry@@
@
text
@d1 1
a1 1
$OpenBSD: patch-Makefile_in,v 1.1.1.1 2012/04/07 13:48:18 landry Exp $
d19 1
a19 1
+ifeq (,$(filter-out powerpc mips64 mips64el sparc sparc64,$(TARGET_CPU)))
@


1.1
log
@Initial revision
@
text
@d1 1
a1 1
$OpenBSD$
d4 1
a4 1
+++ Makefile.in	Thu Apr  5 11:56:13 2012
d19 1
a19 1
+ifeq (,$(filter-out powerpc sparc sparc64,$(TARGET_CPU)))
@


1.1.1.1
log
@Import devel/spidermonkey 1.8.5

- built from the official upstream release
- needed for upcoming gnome/js update
- this is not an update to lang/spidermonkey, as that new version was
  built upon Ffx 4 js engine and probably only works on amd64/i386/ppc.
It builds on sparc64 but is broken at runtime. Not marking BROKEN-* to
allow depending ports to build. Other archs untested.
- special care was taken to ensure it doesnt conflict with
  lang/spidermonkey (install versionned binaries/headers..)
- ports wanting to use it should use devel/spidermonkey>=1.8,<1.9 to
  ensure the correct version is picked up

Tested in an amd64 bulk build.
ok/prodding ajacoutot@@
@
text
@@
