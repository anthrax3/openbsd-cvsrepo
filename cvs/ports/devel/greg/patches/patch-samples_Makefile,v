head	1.1;
branch	1.1.1;
access;
symbols
	OPENBSD_6_0:1.1.1.1.0.8
	OPENBSD_6_0_BASE:1.1.1.1
	OPENBSD_5_9:1.1.1.1.0.4
	OPENBSD_5_9_BASE:1.1.1.1
	OPENBSD_5_8:1.1.1.1.0.6
	OPENBSD_5_8_BASE:1.1.1.1
	OPENBSD_5_7:1.1.1.1.0.2
	OPENBSD_5_7_BASE:1.1.1.1
	bcallah_20150112:1.1.1.1
	bcallah:1.1.1;
locks; strict;
comment	@# @;


1.1
date	2015.01.12.05.51.22;	author bcallah;	state Exp;
branches
	1.1.1.1;
next	;
commitid	5jpo7cidG4BYBJHL;

1.1.1.1
date	2015.01.12.05.51.22;	author bcallah;	state Exp;
branches;
next	;
commitid	5jpo7cidG4BYBJHL;


desc
@@



1.1
log
@Initial revision
@
text
@$OpenBSD$

Clean up so "make test" works at top level, all expected binaries
are built with -DYY_MAIN.  Fix the clean target.

--- samples/Makefile.orig	Tue Oct  8 22:39:24 2013
+++ samples/Makefile	Fri Jan  2 14:31:43 2015
@@@@ -1,6 +1,6 @@@@
-EXAMPLES = test rule accept wc dc dcv calc basic
+EXAMPLES = test rule accept wc dc dcv calc basic erract
 
-CFLAGS = -g -O3
+CFLAGS += -g -DYY_MAIN
 
 DIFF = diff
 TEE = cat >
@@@@ -9,7 +9,7 @@@@ all : $(EXAMPLES)
 
 test : .FORCE
 	../greg -o test.leg.c test.leg
-	$(CC) $(CFLAGS) -o test test.c
+	$(CC) $(CFLAGS) -o test test.leg.c
 	echo 'ab.ac.ad.ae.afg.afh.afg.afh.afi.afj.' | ./$@@ | $(TEE) $@@.out
 	$(DIFF) $@@.ref $@@.out
 	rm -f $@@.out
@@@@ -17,7 +17,7 @@@@ test : .FORCE
 
 rule : .FORCE
 	../greg -o rule.leg.c rule.leg
-	$(CC) $(CFLAGS) -o rule rule.c
+	$(CC) $(CFLAGS) -o rule rule.leg.c
 	echo 'abcbcdabcbcdabcbcdabcbcd' | ./$@@ | $(TEE) $@@.out
 	$(DIFF) $@@.ref $@@.out
 	rm -f $@@.out
@@@@ -25,7 +25,7 @@@@ rule : .FORCE
 
 accept : .FORCE
 	../greg -o accept.leg.c accept.leg
-	$(CC) $(CFLAGS) -o accept accept.c
+	$(CC) $(CFLAGS) -o accept accept.leg.c
 	echo 'abcbcdabcbcdabcbcdabcbcd' | ./$@@ | $(TEE) $@@.out
 	$(DIFF) $@@.ref $@@.out
 	rm -f $@@.out
@@@@ -41,7 +41,7 @@@@ wc : .FORCE
 
 dc : .FORCE
 	../greg -o dc.leg.c dc.leg
-	$(CC) $(CFLAGS) -o dc dc.c
+	$(CC) $(CFLAGS) -o dc dc.leg.c
 	echo '  2  *3 *(3+ 4) ' | ./dc | $(TEE) $@@.out
 	$(DIFF) $@@.ref $@@.out
 	rm -f $@@.out
@@@@ -49,7 +49,7 @@@@ dc : .FORCE
 
 dcv : .FORCE
 	../greg -o dcv.leg.c dcv.leg
-	$(CC) $(CFLAGS) -o dcv dcv.c
+	$(CC) $(CFLAGS) -o dcv dcv.leg.c
 	echo 'a = 6;  b = 7;  a * b' | ./dcv | $(TEE) $@@.out
 	$(DIFF) $@@.ref $@@.out
 	rm -f $@@.out
@@@@ -71,8 +71,12 @@@@ basic : .FORCE
 	rm -f $@@.out
 	@@echo
 
+erract : .FORCE
+	../greg -o erract.leg.c erract.leg
+	$(CC) $(CFLAGS) -o erract erract.leg.c
+
 clean : .FORCE
-	rm -f *~ *.o *.[pl]eg.[cd] $(EXAMPLES)
+	rm -f *~ *.o *.[pl]eg.[cd] *.out $(EXAMPLES)
 	rm -rf *.dSYM
 
 spotless : clean
@


1.1.1.1
log
@Import devel/greg
ok benoit@@, tweaks and ok sthen@@

greg is a recursive-descent parser generator based on Ian Piumarta's
peg/leg.  It implements a formalism called Parsing Expression Grammars.
@
text
@@
