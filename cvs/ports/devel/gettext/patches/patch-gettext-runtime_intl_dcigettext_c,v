head	1.7;
access;
symbols
	OPENBSD_6_2:1.7.0.14
	OPENBSD_6_2_BASE:1.7
	OPENBSD_6_1:1.7.0.12
	OPENBSD_6_1_BASE:1.7
	OPENBSD_6_0:1.7.0.10
	OPENBSD_6_0_BASE:1.7
	OPENBSD_5_9:1.7.0.6
	OPENBSD_5_9_BASE:1.7
	OPENBSD_5_8:1.7.0.8
	OPENBSD_5_8_BASE:1.7
	OPENBSD_5_7:1.7.0.4
	OPENBSD_5_7_BASE:1.7
	OPENBSD_5_6:1.7.0.2
	OPENBSD_5_6_BASE:1.7
	OPENBSD_5_5:1.6.0.6
	OPENBSD_5_5_BASE:1.6
	OPENBSD_5_4:1.6.0.4
	OPENBSD_5_4_BASE:1.6
	OPENBSD_5_3:1.6.0.2
	OPENBSD_5_3_BASE:1.6
	OPENBSD_5_2:1.4.0.2
	OPENBSD_5_2_BASE:1.4
	OPENBSD_5_1_BASE:1.2
	OPENBSD_5_1:1.2.0.8
	OPENBSD_5_0:1.2.0.6
	OPENBSD_5_0_BASE:1.2
	OPENBSD_4_9:1.2.0.4
	OPENBSD_4_9_BASE:1.2
	OPENBSD_4_8:1.2.0.2
	OPENBSD_4_8_BASE:1.2
	OPENBSD_4_7:1.1.0.8
	OPENBSD_4_7_BASE:1.1
	OPENBSD_4_6:1.1.0.6
	OPENBSD_4_6_BASE:1.1
	OPENBSD_4_5:1.1.0.4
	OPENBSD_4_5_BASE:1.1
	OPENBSD_4_4:1.1.0.2
	OPENBSD_4_4_BASE:1.1;
locks; strict;
comment	@# @;


1.7
date	2014.07.10.20.42.28;	author naddy;	state Exp;
branches;
next	1.6;
commitid	Bn4OaWj7EwQikiaT;

1.6
date	2013.01.21.22.08.52;	author naddy;	state Exp;
branches;
next	1.5;

1.5
date	2012.08.04.14.33.14;	author naddy;	state Exp;
branches;
next	1.4;

1.4
date	2012.07.30.15.37.10;	author naddy;	state Exp;
branches;
next	1.3;

1.3
date	2012.07.13.19.43.18;	author naddy;	state Exp;
branches;
next	1.2;

1.2
date	2010.07.03.03.23.22;	author naddy;	state Exp;
branches;
next	1.1;

1.1
date	2008.06.13.04.56.34;	author naddy;	state Exp;
branches;
next	;


desc
@@


1.7
log
@update to 0.19.1 so we don't fall behind
@
text
@$OpenBSD: patch-gettext-runtime_intl_dcigettext_c,v 1.6 2013/01/21 22:08:52 naddy Exp $
--- gettext-runtime/intl/dcigettext.c.orig	Tue Apr 15 03:52:10 2014
+++ gettext-runtime/intl/dcigettext.c	Tue Jul  8 23:49:09 2014
@@@@ -505,6 +505,7 @@@@ DCIGETTEXT (const char *domainname, const char *msgid1
   const char *localename;
 #endif
   size_t domainname_len;
+  size_t xdomainname_len;
 
   /* If no real MSGID is given return NULL.  */
   if (msgid1 == NULL)
@@@@ -625,6 +626,7 @@@@ DCIGETTEXT (const char *domainname, const char *msgid1
 	  /* We have a relative path.  Make it absolute now.  */
 	  size_t dirname_len = strlen (dirname) + 1;
 	  size_t path_max;
+	  size_t resolved_dirname_len;
 	  char *resolved_dirname;
 	  char *ret;
 
@@@@ -633,7 +635,8 @@@@ DCIGETTEXT (const char *domainname, const char *msgid1
 
 	  for (;;)
 	    {
-	      resolved_dirname = (char *) alloca (path_max + dirname_len);
+	      resolved_dirname_len = path_max + dirname_len;
+	      resolved_dirname = (char *) alloca (resolved_dirname_len);
 	      ADD_BLOCK (block_list, tmp_dirname);
 
 	      __set_errno (0);
@@@@ -650,7 +653,8 @@@@ DCIGETTEXT (const char *domainname, const char *msgid1
 	       error but simply return the default string.  */
 	    goto return_untranslated;
 
-	  stpcpy (stpcpy (strchr (resolved_dirname, '\0'), "/"), dirname);
+	  strlcat (resolved_dirname, "/", resolved_dirname_len);
+	  strlcat (resolved_dirname, dirname, resolved_dirname_len);
 	  dirname = resolved_dirname;
 	}
 #ifndef IN_LIBGLOCALE
@@@@ -668,13 +672,14 @@@@ DCIGETTEXT (const char *domainname, const char *msgid1
 #endif
 
   domainname_len = strlen (domainname);
-  xdomainname = (char *) alloca (strlen (categoryname)
-				 + domainname_len + 5);
+  xdomainname_len = strlen (categoryname) + domainname_len + 5;
+  xdomainname = (char *) alloca (xdomainname_len);
   ADD_BLOCK (block_list, xdomainname);
 
-  stpcpy ((char *) mempcpy (stpcpy (stpcpy (xdomainname, categoryname), "/"),
-			    domainname, domainname_len),
-	  ".mo");
+  strlcpy (xdomainname, categoryname, xdomainname_len);
+  strlcat (xdomainname, "/", xdomainname_len);
+  strlcat (xdomainname, domainname, xdomainname_len);
+  strlcat (xdomainname, ".mo", xdomainname_len);
 
   /* Creating working area.  */
   single_locale = (char *) alloca (strlen (categoryvalue) + 1);
@@@@ -772,13 +777,17 @@@@ DCIGETTEXT (const char *domainname, const char *msgid1
 		  /* Create a new entry and add it to the search tree.  */
 		  size_t msgid_len;
 		  size_t size;
+#ifdef HAVE_PER_THREAD_LOCALE
+		  size_t localename_len;
+#endif
 		  struct known_translation_t *newp;
 
 		  msgid_len = strlen (msgid1) + 1;
 		  size = offsetof (struct known_translation_t, msgid)
 			 + msgid_len + domainname_len + 1;
 #ifdef HAVE_PER_THREAD_LOCALE
-		  size += strlen (localename) + 1;
+		  localename_len = strlen (localename);
+		  size += localename_len + 1;
 #endif
 		  newp = (struct known_translation_t *) malloc (size);
 		  if (newp != NULL)
@@@@ -794,7 +803,7 @@@@ DCIGETTEXT (const char *domainname, const char *msgid1
 		      memcpy (new_domainname, domainname, domainname_len + 1);
 #ifdef HAVE_PER_THREAD_LOCALE
 		      new_localename = new_domainname + domainname_len + 1;
-		      strcpy (new_localename, localename);
+		      memcpy (new_localename, localename, localename_len + 1);
 #endif
 		      newp->domainname = new_domainname;
 		      newp->category = category;
@


1.6
log
@maintenance update to 0.18.2
@
text
@d1 3
a3 3
$OpenBSD: patch-gettext-runtime_intl_dcigettext_c,v 1.5 2012/08/04 14:33:14 naddy Exp $
--- gettext-runtime/intl/dcigettext.c.orig	Tue Dec  4 07:28:58 2012
+++ gettext-runtime/intl/dcigettext.c	Wed Jan 16 23:06:10 2013
d60 1
a60 1
@@@@ -767,13 +772,17 @@@@ DCIGETTEXT (const char *domainname, const char *msgid1
d79 1
a79 1
@@@@ -789,7 +798,7 @@@@ DCIGETTEXT (const char *domainname, const char *msgid1
@


1.5
log
@Replace stpcpy() calls to silence ld warnings.
Fix missing string termination in _nl_make_l10nflist(), with Christian
Schulte.
@
text
@d1 4
a4 4
$OpenBSD: patch-gettext-runtime_intl_dcigettext_c,v 1.3 2012/07/13 19:43:18 naddy Exp $
--- gettext-runtime/intl/dcigettext.c.orig	Sat Dec 26 14:42:37 2009
+++ gettext-runtime/intl/dcigettext.c	Tue Jul 10 20:08:14 2012
@@@@ -507,6 +507,7 @@@@ DCIGETTEXT (const char *domainname, const char *msgid1
d12 1
a12 1
@@@@ -627,6 +628,7 @@@@ DCIGETTEXT (const char *domainname, const char *msgid1
d20 1
a20 1
@@@@ -635,7 +637,8 @@@@ DCIGETTEXT (const char *domainname, const char *msgid1
d30 1
a30 1
@@@@ -652,7 +655,8 @@@@ DCIGETTEXT (const char *domainname, const char *msgid1
d40 1
a40 1
@@@@ -670,13 +674,14 @@@@ DCIGETTEXT (const char *domainname, const char *msgid1
d60 1
a60 1
@@@@ -769,13 +774,17 @@@@ DCIGETTEXT (const char *domainname, const char *msgid1
d79 1
a79 1
@@@@ -791,7 +800,7 @@@@ DCIGETTEXT (const char *domainname, const char *msgid1
@


1.4
log
@revert stpcpy() removal which introduced at least one string handling bug
ok jasper@@
@
text
@d1 60
a60 4
$OpenBSD$
--- gettext-runtime/intl/dcigettext.c.orig	Mon Jun 28 20:23:14 2010
+++ gettext-runtime/intl/dcigettext.c	Mon Jun 28 20:25:07 2010
@@@@ -769,13 +769,17 @@@@ DCIGETTEXT (const char *domainname, const char *msgid1
d79 1
a79 1
@@@@ -791,7 +795,7 @@@@ DCIGETTEXT (const char *domainname, const char *msgid1
@


1.3
log
@replace stpcpy() calls to silence ld warnings; ok sthen@@
@
text
@d1 4
a4 60
$OpenBSD: patch-gettext-runtime_intl_dcigettext_c,v 1.2 2010/07/03 03:23:22 naddy Exp $
--- gettext-runtime/intl/dcigettext.c.orig	Sat Dec 26 14:42:37 2009
+++ gettext-runtime/intl/dcigettext.c	Tue Jul 10 20:08:14 2012
@@@@ -507,6 +507,7 @@@@ DCIGETTEXT (const char *domainname, const char *msgid1
   const char *localename;
 #endif
   size_t domainname_len;
+  size_t xdomainname_len;
 
   /* If no real MSGID is given return NULL.  */
   if (msgid1 == NULL)
@@@@ -627,6 +628,7 @@@@ DCIGETTEXT (const char *domainname, const char *msgid1
 	  /* We have a relative path.  Make it absolute now.  */
 	  size_t dirname_len = strlen (dirname) + 1;
 	  size_t path_max;
+	  size_t resolved_dirname_len;
 	  char *resolved_dirname;
 	  char *ret;
 
@@@@ -635,7 +637,8 @@@@ DCIGETTEXT (const char *domainname, const char *msgid1
 
 	  for (;;)
 	    {
-	      resolved_dirname = (char *) alloca (path_max + dirname_len);
+	      resolved_dirname_len = path_max + dirname_len;
+	      resolved_dirname = (char *) alloca (resolved_dirname_len);
 	      ADD_BLOCK (block_list, tmp_dirname);
 
 	      __set_errno (0);
@@@@ -652,7 +655,8 @@@@ DCIGETTEXT (const char *domainname, const char *msgid1
 	       error but simply return the default string.  */
 	    goto return_untranslated;
 
-	  stpcpy (stpcpy (strchr (resolved_dirname, '\0'), "/"), dirname);
+	  strlcat (resolved_dirname, "/", resolved_dirname_len);
+	  strlcat (resolved_dirname, dirname, resolved_dirname_len);
 	  dirname = resolved_dirname;
 	}
 #ifndef IN_LIBGLOCALE
@@@@ -670,13 +674,14 @@@@ DCIGETTEXT (const char *domainname, const char *msgid1
 #endif
 
   domainname_len = strlen (domainname);
-  xdomainname = (char *) alloca (strlen (categoryname)
-				 + domainname_len + 5);
+  xdomainname_len = strlen (categoryname) + domainname_len + 5;
+  xdomainname = (char *) alloca (xdomainname_len);
   ADD_BLOCK (block_list, xdomainname);
 
-  stpcpy ((char *) mempcpy (stpcpy (stpcpy (xdomainname, categoryname), "/"),
-			    domainname, domainname_len),
-	  ".mo");
+  strlcpy (xdomainname, categoryname, xdomainname_len);
+  strlcat (xdomainname, "/", xdomainname_len);
+  strlcat (xdomainname, domainname, xdomainname_len);
+  strlcat (xdomainname, ".mo", xdomainname_len);
 
   /* Creating working area.  */
   single_locale = (char *) alloca (strlen (categoryvalue) + 1);
@@@@ -769,13 +774,17 @@@@ DCIGETTEXT (const char *domainname, const char *msgid1
d23 1
a23 1
@@@@ -791,7 +800,7 @@@@ DCIGETTEXT (const char *domainname, const char *msgid1
@


1.2
log
@update to 0.18.1
@
text
@d1 60
a60 4
$OpenBSD: patch-gettext-runtime_intl_dcigettext_c,v 1.1 2008/06/13 04:56:34 naddy Exp $
--- gettext-runtime/intl/dcigettext.c.orig	Mon Jun 28 20:23:14 2010
+++ gettext-runtime/intl/dcigettext.c	Mon Jun 28 20:25:07 2010
@@@@ -769,13 +769,17 @@@@ DCIGETTEXT (const char *domainname, const char *msgid1
d79 1
a79 1
@@@@ -791,7 +795,7 @@@@ DCIGETTEXT (const char *domainname, const char *msgid1
@


1.1
log
@Update to 0.17.
The major new functionality in this release is colorization support
in the message catalog tools.
ok brad@@
@
text
@d1 4
a4 5
$OpenBSD$
--- gettext-runtime/intl/dcigettext.c.orig	Sun Oct 21 20:41:41 2007
+++ gettext-runtime/intl/dcigettext.c	Mon Jun  2 22:58:10 2008
@@@@ -774,12 +774,16 @@@@ DCIGETTEXT (const char *domainname, const char *msgid1
 		{
d6 1
d13 1
d23 1
a23 1
@@@@ -794,7 +798,7 @@@@ DCIGETTEXT (const char *domainname, const char *msgid1
@

