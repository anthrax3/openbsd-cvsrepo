head	1.5;
access;
symbols
	OPENBSD_4_5:1.4.0.22
	OPENBSD_4_5_BASE:1.4
	OPENBSD_4_4:1.4.0.20
	OPENBSD_4_4_BASE:1.4
	OPENBSD_4_3:1.4.0.18
	OPENBSD_4_3_BASE:1.4
	OPENBSD_4_2:1.4.0.16
	OPENBSD_4_2_BASE:1.4
	OPENBSD_4_1:1.4.0.14
	OPENBSD_4_1_BASE:1.4
	OPENBSD_4_0:1.4.0.12
	OPENBSD_4_0_BASE:1.4
	OPENBSD_3_9:1.4.0.10
	OPENBSD_3_9_BASE:1.4
	OPENBSD_3_8:1.4.0.8
	OPENBSD_3_8_BASE:1.4
	OPENBSD_3_7:1.4.0.6
	OPENBSD_3_7_BASE:1.4
	OPENBSD_3_6:1.4.0.4
	OPENBSD_3_6_BASE:1.4
	OPENBSD_3_5:1.4.0.2
	OPENBSD_3_5_BASE:1.4
	naddy_20031103:1.1.1.1
	naddy:1.1.1;
locks; strict;
comment	@# @;


1.5
date	2009.06.01.23.05.32;	author benoit;	state dead;
branches;
next	1.4;

1.4
date	2004.02.14.15.09.44;	author avsm;	state Exp;
branches;
next	1.3;

1.3
date	2004.01.30.01.01.11;	author naddy;	state Exp;
branches;
next	1.2;

1.2
date	2004.01.14.22.19.29;	author naddy;	state Exp;
branches;
next	1.1;

1.1
date	2003.11.03.01.02.36;	author naddy;	state Exp;
branches
	1.1.1.1;
next	;

1.1.1.1
date	2003.11.03.01.02.36;	author naddy;	state Exp;
branches;
next	;


desc
@@


1.5
log
@- update gputils to 0.13.7
- remove patches & regen PLIST
- change maintainer (timeout old maintainer)
- update testsuite

ok ajacoutot@@
@
text
@$OpenBSD: patch-libgputils_gparchive_c,v 1.4 2004/02/14 15:09:44 avsm Exp $
--- libgputils/gparchive.c.orig	2004-01-09 08:10:37.000000000 +0000
+++ libgputils/gparchive.c	2004-02-13 20:02:41.000000000 +0000
@@@@ -50,7 +50,7 @@@@ gp_archive_member_name(gp_archive_type *
   char name[256];
   char *end;
 
-  sscanf(archive->header.ar_name, "%s/", name);
+  sscanf(archive->header.ar_name, "%255s/", name);
   end = strchr(&name[0], '/');
   if (end != NULL) 
     *end = '\0';
@@@@ -73,7 +73,7 @@@@ gp_archive_list_members(gp_archive_type 
     archive = archive->next;
 
   while (archive != NULL) {
-    sscanf(archive->header.ar_name, "%s/", name);
+    sscanf(archive->header.ar_name, "%255s/", name);
     sscanf(archive->header.ar_date, "%il", &date);
     sscanf(archive->header.ar_size, "%il", &size);
     end = strchr(&name[0], '/');
@@@@ -99,7 +99,7 @@@@ gp_archive_find_member(gp_archive_type *
     archive = archive->next;
 
   while (archive != NULL) {
-    sscanf(archive->header.ar_name, "%s/", name);
+    sscanf(archive->header.ar_name, "%255s/", name);
     end = strrchr(&name[0], '/');
     if (end != NULL) 
       *end = '\0';
@@@@ -183,16 +183,16 @@@@ gp_archive_add_member(gp_archive_type *a
 
   timer = (int)time(NULL);
   
-  sprintf(name, "%s/", objectname);
-  sprintf(date, "%il", timer);
-  sprintf(size, "%lil", newobject->size);
+  snprintf(name, sizeof(name), "%s/", objectname);
+  snprintf(date, sizeof(date), "%il", timer);
+  snprintf(size, sizeof(size), "%lil", newobject->size);
 
   /* FIXME:  These functions over right the 0x20 that the header is filled 
      with. */ 
-  strncpy(&newmember->header.ar_name[0], &name[0], 256);
-  strncpy(&newmember->header.ar_date[0], &date[0], 12);
-  strncpy(&newmember->header.ar_size[0], &size[0], 10);
-  strncpy(&newmember->header.ar_fmag[0], ARMAG, 2);
+  strlcpy(newmember->header.ar_name, &name[0], sizeof(newmember->header.ar_name));
+  strlcpy(newmember->header.ar_date, &date[0], sizeof(newmember->header.ar_date));
+  strlcpy(newmember->header.ar_size, &size[0], sizeof(newmember->header.ar_size));
+  strlcpy(newmember->header.ar_fmag, ARMAG, sizeof(newmember->header.ar_fmag));
 
   oldmember = gp_archive_find_member(archive, objectname);
   
@@@@ -231,9 +231,9 @@@@ gp_archive_extract_member(gp_archive_typ
   /* if the object doesn't have an extension, add one.  This is done for
      some libs generated with other tools.  It should not be necessary
      for libs generated by gplib. */
-  strcpy(filename, objectname);
+  strlcpy(filename, objectname, sizeof(filename));
   if (strrchr(filename, '.') == NULL)
-    strcat(filename, ".o");
+    strlcat(filename, ".o", sizeof(filename));
 
   output_file = fopen(filename, "wb");
   if (output_file == NULL) {
@@@@ -413,7 +413,7 @@@@ gp_archive_make_index(gp_archive_type *a
     archive = archive->next;
         
   while (archive != NULL) {
-    sscanf(archive->header.ar_name, "%s/", name);
+    sscanf(archive->header.ar_name, "%255s/", name);
     end = strchr(&name[0], '/');
     if (end != NULL) 
       *end = '\0';
@@@@ -461,17 +461,25 @@@@ gp_archive_add_index(struct symbol_table
 
   /* create a new member for the index and place it in the archive */
   newmember = (gp_archive_type *)malloc(sizeof(*newmember));
+  if (!newmember) {
+    err(1, NULL);
+    exit(1);
+  }
   newmember->file = (char *)malloc(sizeof(char)*indexsize);
+  if(!newmember->file) {
+    err(1, NULL);
+    exit(1);
+  }
   newmember->next = NULL;  
 
   /* fill in the archive header */
   memset(&newmember->header, 0x20, AR_HDR_SIZ); /* fill the header with space */
 
   newmember->header.ar_name[0] = '/';
-  sprintf(size, "%lil", indexsize);
+  snprintf(size, sizeof(size), "%lil", indexsize);
 
-  strncpy(&newmember->header.ar_size[0], &size[0], 10);
-  strncpy(&newmember->header.ar_fmag[0], ARMAG, 2);
+  strlcpy(newmember->header.ar_size, &size[0], sizeof(newmember->header.ar_size));
+  strlcpy(newmember->header.ar_fmag, ARMAG, sizeof(newmember->header.ar_fmag));
 
   newmember->next = archive;
   archive = newmember;
@@@@ -494,8 +502,10 @@@@ gp_archive_add_index(struct symbol_table
 
   /* write the symbol names to the member */
   for (i = 0; i < table->count; i++) {
-    strcpy(ptr, get_symbol_name(lst[i]));
-    ptr += strlen(get_symbol_name(lst[i])) + 1;
+    const char*  symbol_name = get_symbol_name(lst[i]);
+    const size_t symbol_len  = strlen(symbol_name) + 1;
+    memcpy(ptr, symbol_name, symbol_len);
+    ptr += symbol_len;
   }
   
   return archive;
@@@@ -602,7 +612,7 @@@@ gp_archive_print_table(struct symbol_tab
     member = get_symbol_annotation(lst[i]);
     assert(member != NULL);
     /* determine the archive member name */
-    sscanf(member->header.ar_name, "%s/", name);
+    sscanf(member->header.ar_name, "%255s/", name);
     end = strchr(&name[0], '/');
     if (end != NULL) 
       *end = '\0';
@


1.4
log
@fix sscanf off-by-ones, spotted with -Wbounded
maintainer ok
@
text
@d1 1
a1 1
$OpenBSD: patch-libgputils_gparchive_c,v 1.3 2004/01/30 01:01:11 naddy Exp $
@


1.3
log
@update to 0.12.0; from Andrew Dalgleish <openbsd@@ajd.net.au>
@
text
@d1 3
a3 3
$OpenBSD: patch-libgputils_gparchive_c,v 1.2 2004/01/14 22:19:29 naddy Exp $
--- libgputils/gparchive.c.orig	2004-01-09 19:10:37.000000000 +1100
+++ libgputils/gparchive.c	2004-01-25 20:36:31.000000000 +1100
d9 1
a9 1
+  sscanf(archive->header.ar_name, "%256s/", name);
d18 1
a18 1
+    sscanf(archive->header.ar_name, "%256s/", name);
d27 1
a27 1
+    sscanf(archive->header.ar_name, "%256s/", name);
d72 1
a72 1
+    sscanf(archive->header.ar_name, "%256s/", name);
d123 1
a123 1
+    sscanf(member->header.ar_name, "%256s/", name);
@


1.2
log
@update to 0.11.8; from Andrew Dalgleish <openbsd@@ajd.net.au>
@
text
@d1 3
a3 3
$OpenBSD: patch-libgputils_gparchive_c,v 1.1.1.1 2003/11/03 01:02:36 naddy Exp $
--- libgputils/gparchive.c.orig	2003-03-31 16:49:39.000000000 +1000
+++ libgputils/gparchive.c	2003-11-23 12:55:02.000000000 +1100
d31 1
a31 1
@@@@ -182,16 +182,16 @@@@ gp_archive_add_member(gp_archive_type *a
d55 1
a55 1
@@@@ -230,9 +230,9 @@@@ gp_archive_extract_member(gp_archive_typ
d67 1
a67 1
@@@@ -412,7 +412,7 @@@@ gp_archive_make_index(gp_archive_type *a
d76 1
a76 1
@@@@ -460,17 +460,25 @@@@ gp_archive_add_index(struct symbol_table
d105 1
a105 1
@@@@ -493,8 +501,10 @@@@ gp_archive_add_index(struct symbol_table
d118 1
a118 1
@@@@ -601,7 +611,7 @@@@ gp_archive_print_table(struct symbol_tab
@


1.1
log
@Initial revision
@
text
@d1 1
a1 1
$OpenBSD$
d3 1
a3 1
+++ libgputils/gparchive.c	2003-10-14 23:08:45.000000000 +1000
d105 14
a118 1
@@@@ -601,7 +609,7 @@@@ gp_archive_print_table(struct symbol_tab
@


1.1.1.1
log
@Import gputils 0.11.7.
Submitted by Andrew Dalgleish <openbsd@@ajd.net.au>.

GPUTILS is a collection of tools for the Microchip (TM) PIC
microcontrollers. It includes gpasm, gplink, and gplib.
@
text
@@
