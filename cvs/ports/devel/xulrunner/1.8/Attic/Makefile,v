head	1.10;
access;
symbols
	OPENBSD_4_8:1.4.0.2
	OPENBSD_4_8_BASE:1.4
	OPENBSD_4_7:1.2.0.2
	OPENBSD_4_7_BASE:1.2
	martynas_20090728:1.1.1.1
	martynas:1.1.1;
locks; strict;
comment	@# @;


1.10
date	2010.10.24.13.28.44;	author landry;	state dead;
branches;
next	1.9;

1.9
date	2010.10.22.19.24.47;	author landry;	state Exp;
branches;
next	1.8;

1.8
date	2010.10.15.08.32.21;	author landry;	state Exp;
branches;
next	1.7;

1.7
date	2010.10.11.08.12.31;	author jasper;	state Exp;
branches;
next	1.6;

1.6
date	2010.09.26.07.42.03;	author espie;	state Exp;
branches;
next	1.5;

1.5
date	2010.09.12.17.58.51;	author landry;	state Exp;
branches;
next	1.4;

1.4
date	2010.07.11.14.55.56;	author landry;	state Exp;
branches;
next	1.3;

1.3
date	2010.06.20.19.44.40;	author landry;	state Exp;
branches;
next	1.2;

1.2
date	2009.08.10.06.31.08;	author kili;	state Exp;
branches;
next	1.1;

1.1
date	2009.07.27.21.36.01;	author martynas;	state Exp;
branches
	1.1.1.1;
next	;

1.1.1.1
date	2009.07.27.21.36.01;	author martynas;	state Exp;
branches;
next	;


desc
@@


1.10
log
@So long, xulrunner 1.8. You were nice in the firefox 2.0 days, but your
last release was nearly two years ago, you're crippled by security
issues, abandoned by your parents in favor of your younger brother,
and those days nothing uses you anymore. RIP in the attic..
agreed by jasper@@ and phessler@@
happiness ensues...
@
text
@# $OpenBSD: Makefile,v 1.9 2010/10/22 19:24:47 landry Exp $

VERSION=		1.8.1.19
REVISION-main=		9
REVISION-devel=		9
DIRECTORY=		xulrunner

SO_VERSION=		2.0
# NOTE: Must bump minor version if any shlib's are removed from the
# components dir to avoid pkg_add -r issues.
.for _lib in auth autoconfig cookie fileview gtkembedmoz mozjs nullplugin \
	permissions pipboot pipnss pippki system-pref transformiix \
	universalchardet unixprintplugin websrvcs xmlextras xpcom xul xulutil
SHARED_LIBS+=		${_lib}	${SO_VERSION}
.endfor

CONFIGURE_ARGS+=	--with-system-png=${LOCALBASE} \
			--enable-system-sqlite		\
			--enable-system-cairo		\
			--enable-default-toolkit=gtk2

MOB=			${WRKSRC}/dist/bin
MOZ=			${PREFIX}/${DIRECTORY}

DATADIRS=		chrome defaults icons res components greprefs plugins
DISTDIRS=		idl include
TOOLS=			TestGtkEmbed xpcshell xpt_link mozilla-xremote-client \
			xpicleanup xulrunner-bin nsinstall xpidl \
			xulrunner-stub regxpcom xpt_dump

WANTLIB-main+=		Xft

pre-configure:
	@@perl -pi -e 's|_LOCALBASE_|${LOCALBASE}|g; s|_X11BASE_|${X11BASE}|g' \
		${WRKSRC}/js/src/xpconnect/shell/Makefile.in \
		${WRKSRC}/xulrunner/app/mozilla.in \
		${WRKSRC}/xulrunner/setup/nsXULAppInstall.js
	@@perl -pi -e 's|_SO_VERSION_|${SO_VERSION}|g' \
		${WRKSRC}/xpcom/components/nsNativeComponentLoader.cpp

do-install:
	cd ${WRKSRC}/dist && \
		find ${DISTDIRS} -type d \
			-exec ${INSTALL_DATA_DIR} ${MOZ}/{} \; && \
		find ${DISTDIRS} ! -type d \
			-exec ${INSTALL_DATA} {} ${MOZ}/{} \;
	cd ${MOB} && \
		find ${DATADIRS} -type d \
			-exec ${INSTALL_DATA_DIR} ${MOZ}/{} \; && \
		find ${DATADIRS} ! -type d \
			-exec ${INSTALL_DATA} -m 644 {} ${MOZ}/{} \; && \
		${INSTALL_PROGRAM} ${TOOLS} ${MOZ}
	${INSTALL_DATA} ${MOB}/*.so.${SO_VERSION} ${MOZ}
	${INSTALL_DATA} ${WRKSRC}/dist/lib/libxpcomglue.a \
		${WRKSRC}/dist/lib/libxpcomglue_s.a ${MOZ}
	${INSTALL_DATA} ${WRKSRC}/LICENSE ${MOZ}
	${INSTALL_SCRIPT} ${MOB}/xulrunner ${MOB}/xulrunner-config \
		${PREFIX}/bin/
	${INSTALL_SCRIPT} ${MOB}/run-mozilla.sh ${MOZ}
	${INSTALL_DATA_DIR} ${PREFIX}/lib/pkgconfig
	${INSTALL_DATA} ${WRKBUILD}/build/unix/*.pc \
		${FILESDIR}/xulrunner-embedding.pc ${PREFIX}/lib/pkgconfig
	@@perl -pi -e 's|!!PREFIX!!|${TRUEPREFIX}|g; ' \
		-e 's|!!VERSION!!|${VERSION}|g; ' \
		${PREFIX}/lib/pkgconfig/xulrunner-embedding.pc

.include <bsd.port.mk>
@


1.9
log
@Refix WANTLIB, X11-xcb shouldn't be here. Bump REVISION.
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.8 2010/10/15 08:32:21 landry Exp $
@


1.8
log
@Build xulrunner 1.9.2.x against bundled cairo, and fix WANTLIB while
here. Keep building xulrunner 1.8.x against systemwide cairo, as it
doesn't build with bundled cairo, because systemwide pango is too
recent and uses structs not defined in bundled cairo headers.
Too bad for the remaining xl 1.8 users, gtk-vnc-plugin and swt-browser..
if they fail, be my guest, fix them.
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.7 2010/10/11 08:12:31 jasper Exp $
d4 2
a5 2
REVISION-main=		8
REVISION-devel=		8
@


1.7
log
@- fix WANTLIB after cairo update.
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.6 2010/09/26 07:42:03 espie Exp $
d4 2
a5 2
REVISION-main=		7
REVISION-devel=		7
d19 1
@


1.6
log
@fix  nonsense in conflicts.
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.5 2010/09/12 17:58:51 landry Exp $
d4 2
a5 2
REVISION-main=		6
REVISION-devel=		6
@


1.5
log
@Chase mozilla-firefox update and bump xulrunner to 1.9.2.9.
Switch to use internal sqlite as now mozilla needs SQLITE_SECURE_DELETE
set, and there's no way we're going to do that with systemwide sqlite.
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.4 2010/07/11 14:55:56 landry Exp $
d4 2
a5 2
REVISION-main=		5
REVISION-devel=		5
@


1.4
log
@Switch to newer LIB_DEPENDS/WANTLIB/REVISION, remove PATCHLEVEL.
symlink libxpcomglue{,_s}_pic.a to libxpcomglue{,_s}.a so that #@@#@@!@@$
libtool correctly links with the xpcom glue. Adjust libxul{-embedding}.pc
to return the appropriate _pic lib.
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.3 2010/06/20 19:44:40 landry Exp $
d18 1
@


1.3
log
@Fix WANTLIBs and bump PKGNAME.
Prodded by/ok sthen@@
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.2 2009/08/10 06:31:08 kili Exp $
d4 2
a5 1
PATCHLEVEL=		p5
@


1.2
log
@WANTLIB changes after xcb addition and bump.
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.1.1.1 2009/07/27 21:36:01 martynas Exp $
d4 1
a4 1
PATCHLEVEL=		p4
d27 2
@


1.1
log
@Initial revision
@
text
@d1 1
a1 1
# $OpenBSD$
d4 1
a4 1
PATCHLEVEL=		p3
@


1.1.1.1
log
@import xulrunner 1.9, and implement infrastructure for multiple
xulrunners.  this was necessary for smooth migration, since we want
plugins work for mozilla 1.8 branch too (seamonkey, thunderbird);
they are upwards-compatible if built against 1.8.  however, some
new applications started to depend on 1.9, and also other (non-plugin)
apps will start to migrate so that the old xulrunner can go away
requested by many;  bulk build & pkgpath & bump done by sthen@@
@
text
@@
