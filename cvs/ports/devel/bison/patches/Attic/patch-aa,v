head	1.4;
access;
symbols
	OPENBSD_2_9:1.3.0.6
	OPENBSD_2_9_BASE:1.3
	OPENBSD_2_8:1.3.0.4
	OPENBSD_2_8_BASE:1.3
	OPENBSD_2_7:1.3.0.2
	OPENBSD_2_7_BASE:1.3
	OPENBSD_2_6:1.1.0.6
	OPENBSD_2_6_BASE:1.1
	OPENBSD_2_5:1.1.0.4
	OPENBSD_2_5_BASE:1.1
	OPENBSD_2_4:1.1.0.2
	OPENBSD_2_4_BASE:1.1;
locks; strict;
comment	@# @;


1.4
date	2001.07.13.01.55.59;	author brad;	state dead;
branches;
next	1.3;

1.3
date	99.11.22.15.37.52;	author turan;	state Exp;
branches;
next	1.2;

1.2
date	99.11.22.09.09.10;	author kevlo;	state Exp;
branches;
next	1.1;

1.1
date	98.04.25.23.39.03;	author angelos;	state Exp;
branches;
next	;


desc
@@


1.4
log
@upgrade to bison 1.28
@
text
@*** files.c.orig	Sun Oct 15 16:01:30 1995
--- files.c	Sat Apr 25 19:36:49 1998
***************
*** 60,66 ****
  
  extern int noparserflag;
  
! extern char	*mktemp();	/* So the compiler won't complain */
  extern char	*getenv();
  extern void	perror();
  FILE	*tryopen();	/* This might be a good idea */
--- 60,66 ----
  
  extern int noparserflag;
  
! extern int	mkstemp();	/* So the compiler won't complain */
  extern char	*getenv();
  extern void	perror();
  FILE	*tryopen();	/* This might be a good idea */
***************
*** 237,257 ****
    tmpdefsfile = mktemp(stringappend(tmp_base, tmp_len, "deXXXXXX"));
  #else
    if (! noparserflag)
!     actfile = mktemp(stringappend(tmp_base, tmp_len, "act.XXXXXX"));
!   tmpattrsfile = mktemp(stringappend(tmp_base, tmp_len, "attrs.XXXXXX"));
!   tmptabfile = mktemp(stringappend(tmp_base, tmp_len, "tab.XXXXXX"));
!   tmpdefsfile = mktemp(stringappend(tmp_base, tmp_len, "defs.XXXXXX"));
  #endif /* not MSDOS */
  
    if (! noparserflag)
      faction = tryopen(actfile, "w+");
    fattrs = tryopen(tmpattrsfile,"w+");
    ftable = tryopen(tmptabfile, "w+");
  
    if (definesflag)
      {
        defsfile = stringappend(name_base, base_length, ".h");
        fdefines = tryopen(tmpdefsfile, "w+");
      }
  
  #ifndef MSDOS
--- 237,292 ----
    tmpdefsfile = mktemp(stringappend(tmp_base, tmp_len, "deXXXXXX"));
  #else
    if (! noparserflag)
!   {
!     actfile = stringappend(tmp_base, tmp_len, "act.XXXXXX");
!     faction = fdopen(mkstemp(actfile), "w+");
!     if (faction == NULL)
!     {
!       fprintf(stderr, "%s: ", program_name);
!       perror(actfile);
!       done(2);
! 
!     }
!   }  
!   tmpattrsfile = stringappend(tmp_base, tmp_len, "attrs.XXXXXX");
!   fattrs = fdopen(mkstemp(tmpattrsfile), "w+");
!   if (fattrs == NULL)
!   {
!       fprintf(stderr, "%s: ", program_name);
!       perror(tmpattrsfile);
!       done(2);
!   }
!   tmptabfile = stringappend(tmp_base, tmp_len, "tab.XXXXXX");
!   ftable = fdopen(mkstemp(tmptabfile), "w+");
!   if (ftable == NULL)
!   {
!       fprintf(stderr, "%s: ", program_name);
!       perror(tmptabfile);
!       done(2);
!   }
!   tmpdefsfile = stringappend(tmp_base, tmp_len, "defs.XXXXXX");
  #endif /* not MSDOS */
  
+ /*
    if (! noparserflag)
      faction = tryopen(actfile, "w+");
    fattrs = tryopen(tmpattrsfile,"w+");
    ftable = tryopen(tmptabfile, "w+");
+ */
  
    if (definesflag)
      {
        defsfile = stringappend(name_base, base_length, ".h");
+ /*
        fdefines = tryopen(tmpdefsfile, "w+");
+ */
+       fdefines = fdopen(mkstemp(tmpdefsfile), "w+");
+       if (fdefines == NULL)
+       {
+         fprintf(stderr, "%s: ", program_name);
+         perror(tmpdefsfile);
+         done(2);
+       }
      }
  
  #ifndef MSDOS
@


1.3
log
@revert 1.28 -> 1.27.  Version numbers are still locked.
@
text
@@


1.2
log
@Update to version 1.28.
@
text
@d1 92
a92 65
--- src/files.c.orig	Mon Nov 22 16:50:21 1999
+++ src/files.c	Mon Nov 22 16:59:09 1999
@@@@ -76,7 +76,7 @@@@
 
 extern int noparserflag;
 
-extern char	*mktemp();	/* So the compiler won't complain */
+extern int	mkstemp();	/* So the compiler won't complain */
 extern char	*getenv();
 extern void	perror();
 
@@@@ -276,21 +276,55 @@@@
   tmpdefsfile = mktemp(stringappend(tmp_base, tmp_len, "deXXXXXX"));
 #else
   if (! noparserflag)
-    actfile = mktemp(stringappend(tmp_base, tmp_len, "act.XXXXXX"));
-  tmpattrsfile = mktemp(stringappend(tmp_base, tmp_len, "attrs.XXXXXX"));
-  tmptabfile = mktemp(stringappend(tmp_base, tmp_len, "tab.XXXXXX"));
-  tmpdefsfile = mktemp(stringappend(tmp_base, tmp_len, "defs.XXXXXX"));
+   {
+     actfile = stringappend(tmp_base, tmp_len, "act.XXXXXX");
+     faction = fdopen(mkstemp(actfile), "w+");
+     if (faction == NULL)
+     {
+       fprintf(stderr, "%s: ", program_name);
+       perror(actfile);
+       done(2);
+ 
+     }
+   }  
+   tmpattrsfile = stringappend(tmp_base, tmp_len, "attrs.XXXXXX");
+   fattrs = fdopen(mkstemp(tmpattrsfile), "w+");
+   if (fattrs == NULL)
+   {
+       fprintf(stderr, "%s: ", program_name);
+       perror(tmpattrsfile);
+       done(2);
+   }
+   tmptabfile = stringappend(tmp_base, tmp_len, "tab.XXXXXX");
+   ftable = fdopen(mkstemp(tmptabfile), "w+");
+   if (ftable == NULL)
+   {
+       fprintf(stderr, "%s: ", program_name);
+       perror(tmptabfile);
+       done(2);
+   }
+   tmpdefsfile = stringappend(tmp_base, tmp_len, "defs.XXXXXX");
 #endif /* not MSDOS */
 
+/*
   if (! noparserflag)
     faction = tryopen(actfile, "w+");
   fattrs = tryopen(tmpattrsfile,"w+");
   ftable = tryopen(tmptabfile, "w+");
-
+*/
   if (definesflag)
     {
       defsfile = stringappend(name_base, base_length, ".h");
+/*
       fdefines = tryopen(tmpdefsfile, "w+");
+*/
+      fdefines = fdopen(mkstemp(tmpdefsfile), "w+");
+      if (fdefines == NULL)
+      {
d97 3
a99 3
     }
 
 #if !(defined (MSDOS) || (defined(_WIN32) && !defined(__CYGWIN32__)))
@


1.1
log
@mktemp->mkstemp patch
@
text
@d1 65
a65 92
*** files.c.orig	Sun Oct 15 16:01:30 1995
--- files.c	Sat Apr 25 19:36:49 1998
***************
*** 60,66 ****
  
  extern int noparserflag;
  
! extern char	*mktemp();	/* So the compiler won't complain */
  extern char	*getenv();
  extern void	perror();
  FILE	*tryopen();	/* This might be a good idea */
--- 60,66 ----
  
  extern int noparserflag;
  
! extern int	mkstemp();	/* So the compiler won't complain */
  extern char	*getenv();
  extern void	perror();
  FILE	*tryopen();	/* This might be a good idea */
***************
*** 237,257 ****
    tmpdefsfile = mktemp(stringappend(tmp_base, tmp_len, "deXXXXXX"));
  #else
    if (! noparserflag)
!     actfile = mktemp(stringappend(tmp_base, tmp_len, "act.XXXXXX"));
!   tmpattrsfile = mktemp(stringappend(tmp_base, tmp_len, "attrs.XXXXXX"));
!   tmptabfile = mktemp(stringappend(tmp_base, tmp_len, "tab.XXXXXX"));
!   tmpdefsfile = mktemp(stringappend(tmp_base, tmp_len, "defs.XXXXXX"));
  #endif /* not MSDOS */
  
    if (! noparserflag)
      faction = tryopen(actfile, "w+");
    fattrs = tryopen(tmpattrsfile,"w+");
    ftable = tryopen(tmptabfile, "w+");
  
    if (definesflag)
      {
        defsfile = stringappend(name_base, base_length, ".h");
        fdefines = tryopen(tmpdefsfile, "w+");
      }
  
  #ifndef MSDOS
--- 237,292 ----
    tmpdefsfile = mktemp(stringappend(tmp_base, tmp_len, "deXXXXXX"));
  #else
    if (! noparserflag)
!   {
!     actfile = stringappend(tmp_base, tmp_len, "act.XXXXXX");
!     faction = fdopen(mkstemp(actfile), "w+");
!     if (faction == NULL)
!     {
!       fprintf(stderr, "%s: ", program_name);
!       perror(actfile);
!       done(2);
! 
!     }
!   }  
!   tmpattrsfile = stringappend(tmp_base, tmp_len, "attrs.XXXXXX");
!   fattrs = fdopen(mkstemp(tmpattrsfile), "w+");
!   if (fattrs == NULL)
!   {
!       fprintf(stderr, "%s: ", program_name);
!       perror(tmpattrsfile);
!       done(2);
!   }
!   tmptabfile = stringappend(tmp_base, tmp_len, "tab.XXXXXX");
!   ftable = fdopen(mkstemp(tmptabfile), "w+");
!   if (ftable == NULL)
!   {
!       fprintf(stderr, "%s: ", program_name);
!       perror(tmptabfile);
!       done(2);
!   }
!   tmpdefsfile = stringappend(tmp_base, tmp_len, "defs.XXXXXX");
  #endif /* not MSDOS */
  
+ /*
    if (! noparserflag)
      faction = tryopen(actfile, "w+");
    fattrs = tryopen(tmpattrsfile,"w+");
    ftable = tryopen(tmptabfile, "w+");
+ */
  
    if (definesflag)
      {
        defsfile = stringappend(name_base, base_length, ".h");
+ /*
        fdefines = tryopen(tmpdefsfile, "w+");
+ */
+       fdefines = fdopen(mkstemp(tmpdefsfile), "w+");
+       if (fdefines == NULL)
+       {
d70 3
a72 3
      }
  
  #ifndef MSDOS
@

