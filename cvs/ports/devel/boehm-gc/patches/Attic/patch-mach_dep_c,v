head	1.5;
access;
symbols
	OPENBSD_5_3:1.4.0.24
	OPENBSD_5_3_BASE:1.4
	OPENBSD_5_2:1.4.0.22
	OPENBSD_5_2_BASE:1.4
	OPENBSD_5_1_BASE:1.4
	OPENBSD_5_1:1.4.0.20
	OPENBSD_5_0:1.4.0.18
	OPENBSD_5_0_BASE:1.4
	OPENBSD_4_9:1.4.0.16
	OPENBSD_4_9_BASE:1.4
	OPENBSD_4_8:1.4.0.14
	OPENBSD_4_8_BASE:1.4
	OPENBSD_4_7:1.4.0.12
	OPENBSD_4_7_BASE:1.4
	OPENBSD_4_6:1.4.0.10
	OPENBSD_4_6_BASE:1.4
	OPENBSD_4_5:1.4.0.8
	OPENBSD_4_5_BASE:1.4
	OPENBSD_4_4:1.4.0.6
	OPENBSD_4_4_BASE:1.4
	OPENBSD_4_3:1.4.0.4
	OPENBSD_4_3_BASE:1.4
	OPENBSD_4_2:1.4.0.2
	OPENBSD_4_2_BASE:1.4
	OPENBSD_4_1:1.3.0.14
	OPENBSD_4_1_BASE:1.3
	OPENBSD_4_0:1.3.0.12
	OPENBSD_4_0_BASE:1.3
	OPENBSD_3_9:1.3.0.10
	OPENBSD_3_9_BASE:1.3
	OPENBSD_3_8:1.3.0.8
	OPENBSD_3_8_BASE:1.3
	OPENBSD_3_7:1.3.0.6
	OPENBSD_3_7_BASE:1.3
	OPENBSD_3_6:1.3.0.4
	OPENBSD_3_6_BASE:1.3
	OPENBSD_3_5:1.3.0.2
	OPENBSD_3_5_BASE:1.3
	OPENBSD_3_4:1.2.0.4
	OPENBSD_3_4_BASE:1.2
	OPENBSD_3_3:1.2.0.2
	OPENBSD_3_3_BASE:1.2
	OPENBSD_3_2:1.1.0.2
	OPENBSD_3_2_BASE:1.1;
locks; strict;
comment	@# @;


1.5
date	2013.06.01.21.05.28;	author kurt;	state dead;
branches;
next	1.4;

1.4
date	2007.07.14.22.16.17;	author kili;	state Exp;
branches;
next	1.3;

1.3
date	2003.10.15.12.58.11;	author todd;	state Exp;
branches;
next	1.2;

1.2
date	2002.10.26.13.25.26;	author todd;	state Exp;
branches;
next	1.1;

1.1
date	2002.08.27.15.41.30;	author todd;	state Exp;
branches;
next	;


desc
@@


1.5
log
@- Update to 7.2d. Tested on i386, amd64, sparc64, macppc, hppa and alpha.
okay and testing by sthen, landry, thanks!
@
text
@$OpenBSD: patch-mach_dep_c,v 1.4 2007/07/14 22:16:17 kili Exp $
--- mach_dep.c.orig	Wed Jul 11 12:46:22 2007
+++ mach_dep.c	Wed Jul 11 12:58:50 2007
@@@@ -159,7 +159,7 @@@@ void GC_push_regs()
 # undef HAVE_PUSH_REGS
 #endif
 
-#if !defined(HAVE_PUSH_REGS) && defined(UNIX_LIKE)
+#if !defined(HAVE_PUSH_REGS) && defined(UNIX_LIKE) && !defined(OPENBSD)
 # include <ucontext.h>
 #endif
 
@@@@ -174,7 +174,7 @@@@ void GC_with_callee_saves_pushed(void (*fn)(ptr_t, voi
 
 #   if defined(HAVE_PUSH_REGS)
       GC_push_regs();
-#   elif defined(UNIX_LIKE) && !defined(DARWIN) && !defined(ARM32)
+#   elif defined(UNIX_LIKE) && !defined(DARWIN) && !defined(ARM32) && !defined(OPENBSD)
       /* Older versions of Darwin seem to lack getcontext(). */
       /* ARM Linux often doesn't support a real getcontext(). */
       ucontext_t ctxt;
@


1.4
log
@
Update to 7.0.

Most work done by kurt@@, who got bleeding eyes and has been trapped
into pthread issues because some of us (me and Stuart Henderson)
were slopyy and applied some patches only partial. A big sorry to
kurt@@ for this waste of time!

Tested by many. Intermediate ok's (IIRC) from kurt@@, naddy@@ and todd@@.
@
text
@d1 1
a1 1
$OpenBSD$
@


1.3
log
@Thanks to marius at monkey dot org for unbreaking this port.
Thanks to Andrew Delgleish for updating this to 6.2
patches submitted upstream.
@
text
@d1 21
a21 12
$OpenBSD: patch-mach_dep_c,v 1.2 2002/10/26 13:25:26 todd Exp $
--- mach_dep.c.orig	2003-06-06 04:50:30.000000000 +1000
+++ mach_dep.c	2003-10-15 13:42:32.000000000 +1000
@@@@ -456,7 +456,7 @@@@ ptr_t cold_gc_frame;
 /* the stack.	Return sp.						*/
 # ifdef SPARC
     asm("	.seg 	\"text\"");
-#   if defined(SVR4) || defined(NETBSD)
+#   if defined(SVR4) || defined(NETBSD) || defined(__ELF__)
       asm("	.globl	GC_save_regs_in_stack");
       asm("GC_save_regs_in_stack:");
       asm("	.type GC_save_regs_in_stack,#function");
@


1.2
log
@thanks to drahn@@ update to gc6.1 (misc bugfixes, I've heard good things, etc,
best of all, you can drop this in on shared archs as a replacement for 6.0,
I've tested opencm and w3m)
@
text
@d1 4
a4 4
$OpenBSD$
--- mach_dep.c.orig	Wed Jul 31 17:12:03 2002
+++ mach_dep.c	Fri Oct 25 11:53:09 2002
@@@@ -446,7 +446,7 @@@@ ptr_t cold_gc_frame;
d8 2
a9 2
-#   ifdef SVR4
+#   if defined(SVR4) || defined(__ELF__)
@


1.1
log
@update to 6.0
misc pieces from art@@, pval@@, and myself
@
text
@d2 3
a4 3
--- mach_dep.c.orig	Wed Jun 27 22:54:23 2001
+++ mach_dep.c	Wed Jul 31 05:04:41 2002
@@@@ -462,7 +462,7 @@@@ ptr_t cold_gc_frame;
@

