head	1.5;
access;
symbols
	OPENBSD_3_1:1.4.0.6
	OPENBSD_3_1_BASE:1.4
	OPENBSD_3_0:1.4.0.4
	OPENBSD_3_0_BASE:1.4
	OPENBSD_2_9_TRACKING_SWITCH:1.4
	OPENBSD_2_9:1.4.0.2
	OPENBSD_2_9_BASE:1.4
	OPENBSD_2_8:1.3.0.6
	OPENBSD_2_8_BASE:1.3
	OPENBSD_2_7:1.3.0.4
	OPENBSD_2_7_BASE:1.3
	OPENBSD_2_6:1.3.0.2
	OPENBSD_2_6_BASE:1.3
	NIKLAS_990419:1.1.1.1
	NIKLAS:1.1.1;
locks; strict;
comment	@# @;


1.5
date	2002.08.27.15.41.30;	author todd;	state dead;
branches;
next	1.4;

1.4
date	2001.03.26.09.25.36;	author wilfried;	state Exp;
branches;
next	1.3;

1.3
date	99.04.20.09.01.32;	author niklas;	state Exp;
branches;
next	1.2;

1.2
date	99.04.19.21.54.39;	author niklas;	state Exp;
branches;
next	1.1;

1.1
date	99.04.19.21.34.05;	author niklas;	state Exp;
branches
	1.1.1.1;
next	;

1.1.1.1
date	99.04.19.21.34.05;	author niklas;	state Exp;
branches;
next	;


desc
@@


1.5
log
@update to 6.0
misc pieces from art@@, pval@@, and myself
@
text
@--- Makefile.orig	Thu Aug 21 02:17:10 1997
+++ Makefile	Fri Mar 23 14:43:41 2001
@@@@ -7,15 +7,41 @@@@
 #      	 and runs some tests of collector and cords.  Does not add cords or
 #	 c++ interface to gc.a
 # cord/de - builds dumb editor based on cords.
-CC=cc
-CXX=CC
+#CC=cc
+#CXX=CC
 AS=as
 #  The above doesn't work with gas, which doesn't run cpp.
 #  Define AS as `gcc -c -x assembler-with-cpp' instead.
 #  Under Irix 6, you will have to specify the ABI for as if you specify
 #  it for the C compiler.
 
-CFLAGS= -O -DNO_SIGNALS -DALL_INTERIOR_POINTERS -DATOMIC_UNCOLLECTABLE -DNO_EXECUTE_PERMISSION -DSILENT
+# We want this to be a drop-in linkable library, hence the -DREDIRECT.
+# The new c++-t and c++-nt (test and notest) are because we don't want
+# to fill anyone's log with leak messages! - MMCG
+
+CFLAGS+= -DNO_SIGNALS -DALL_INTERIOR_POINTERS -DATOMIC_UNCOLLECTABLE \
+		-DNO_EXECUTE_PERMISSION -DSILENT -DREDIRECT_MALLOC=GC_malloc
+
+LEAKFLAGS=$(CFLAGS) -DFIND_LEAK
+
+all: gc.a gctest
+
+OpenBSD-pkg-all: obsd-libgc.a obsd-libleak.a
+
+obsd-libgc.a:
+	make CFLAGS="$(CFLAGS)" clean c++-t
+	mv gc.a obsd-libgc.a
+
+obsd-libleak.a:
+	make CFLAGS="$(LEAKFLAGS)" clean c++-nt
+	mv gc.a obsd-libleak.a
+
+OpenBSD-pkg-install: OpenBSD-pkg-all
+	${CP} obsd-libgc.a libgc.a
+	${CP} obsd-libleak.a libleak.a
+	${INSTALL_DATA} libleak.a libgc.a ${PREFIX}/lib
+	${INSTALL_DATA} gc.h gc_cpp.h ${PREFIX}/include
+	${INSTALL_MAN} gc.man ${PREFIX}/man/man3/gc.3
 
 # Setjmp_test may yield overly optimistic results when compiled
 # without optimization.
@@@@ -100,7 +126,6 @@@@
     -DDONT_ADD_BYTE_AT_END -DALL_INTERIOR_POINTERS
 #   Flags for building libgc.a -- the last two are required.
 
-CXXFLAGS= $(CFLAGS) 
 AR= ar
 RANLIB= ranlib
 
@@@@ -162,8 +187,6 @@@@
 # not time-critical anyway.
 # Set SPECIALCFLAGS to -q nodirect_code on Encore.
 
-all: gc.a gctest
-
 pcr: PCR-Makefile gc_private.h gc_hdrs.h gc.h config.h mach_dep.o $(SRCS)
 	make -f PCR-Makefile depend
 	make -f PCR-Makefile
@@@@ -210,13 +233,18 @@@@
 	./if_mach HP_PA "" $(CXX) $(CXXFLAGS) -o test_cpp $(srcdir)/test_cpp.cc gc_cpp.o gc.a -ldld
 	./if_not_there test_cpp $(CXX) $(CXXFLAGS) -o test_cpp $(srcdir)/test_cpp.cc gc_cpp.o gc.a `./threadlibs`
 
+c++-t: c++
+	./test_cpp 1
+
+c++-nt: c++
+	@@echo "Use ./test_cpp 1 to test the leak library"
+
 c++: gc_cpp.o $(srcdir)/gc_cpp.h test_cpp
 	rm -f on_sparc_sunos5
 	./if_mach SPARC SUNOS5 touch on_sparc_sunos5
 	./if_mach SPARC SUNOS5 $(AR) rus gc.a gc_cpp.o
 	./if_not_there on_sparc_sunos5 $(AR) ru gc.a gc_cpp.o
 	./if_not_there on_sparc_sunos5 $(RANLIB) gc.a || cat /dev/null
-	./test_cpp 1
 	echo > c++
 
 dyn_load_sunos53.o: dyn_load.c
@


1.4
log
@respect CC/CFLAGS, ok naddy@@
@
text
@@


1.3
log
@Fix memleaks in the memleak library :-)  Also debug the libs by default
since if we are doing this kind of debugging we really might want to inspect
the library internals too.
@
text
@d2 3
a4 2
+++ Makefile	Tue Apr 20 09:43:01 1999
@@@@ -8,14 +8,40 @@@@
d7 1
a7 1
 CC=cc
d9 2
a10 1
+CXX=c++
d22 1
a22 1
+CFLAGS= -g -O -DNO_SIGNALS -DALL_INTERIOR_POINTERS -DATOMIC_UNCOLLECTABLE \
d48 9
a56 1
@@@@ -162,8 +188,6 @@@@
d65 1
a65 1
@@@@ -210,13 +234,18 @@@@
@


1.2
log
@sorry committed from the wrong dir, missed some patches
@
text
@d2 1
a2 1
+++ Makefile	Mon Apr 19 23:34:04 1999
d20 1
a20 1
+CFLAGS= -O -DNO_SIGNALS -DALL_INTERIOR_POINTERS -DATOMIC_UNCOLLECTABLE \
@


1.1
log
@Initial revision
@
text
@d1 11
a11 3
--- Makefile.orig	Wed Aug 20 17:17:10 1997
+++ Makefile	Mon Apr  6 03:21:15 1998
@@@@ -15,7 +15,33 @@@@
@


1.1.1.1
log
@Boehm's garbage collector for C & C++, can also find memleaks.
@
text
@@
