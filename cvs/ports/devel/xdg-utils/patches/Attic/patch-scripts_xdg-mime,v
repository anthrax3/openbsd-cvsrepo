head	1.8;
access;
symbols
	OPENBSD_5_6:1.7.0.10
	OPENBSD_5_6_BASE:1.7
	OPENBSD_5_5:1.7.0.8
	OPENBSD_5_5_BASE:1.7
	OPENBSD_5_4:1.7.0.6
	OPENBSD_5_4_BASE:1.7
	OPENBSD_5_3:1.7.0.4
	OPENBSD_5_3_BASE:1.7
	OPENBSD_5_2:1.7.0.2
	OPENBSD_5_2_BASE:1.7
	OPENBSD_5_1_BASE:1.6
	OPENBSD_5_1:1.6.0.8
	OPENBSD_5_0:1.6.0.6
	OPENBSD_5_0_BASE:1.6
	OPENBSD_4_9:1.6.0.4
	OPENBSD_4_9_BASE:1.6
	OPENBSD_4_8:1.6.0.2
	OPENBSD_4_8_BASE:1.6
	OPENBSD_4_7:1.5.0.4
	OPENBSD_4_7_BASE:1.5
	OPENBSD_4_6:1.5.0.2
	OPENBSD_4_6_BASE:1.5
	OPENBSD_4_5:1.4.0.2
	OPENBSD_4_5_BASE:1.4
	ajacoutot_20081030:1.1.1.1
	ajacoutot:1.1.1;
locks; strict;
comment	@# @;


1.8
date	2014.08.28.10.26.21;	author ajacoutot;	state dead;
branches;
next	1.7;
commitid	Frtw9s8VeEV9DBnq;

1.7
date	2012.04.09.09.39.15;	author ajacoutot;	state Exp;
branches;
next	1.6;

1.6
date	2010.05.28.12.41.26;	author ajacoutot;	state Exp;
branches;
next	1.5;

1.5
date	2009.04.25.08.11.13;	author ajacoutot;	state Exp;
branches;
next	1.4;

1.4
date	2009.02.09.13.32.10;	author ajacoutot;	state Exp;
branches;
next	1.3;

1.3
date	2009.01.28.09.53.02;	author ajacoutot;	state Exp;
branches;
next	1.2;

1.2
date	2008.11.01.19.30.07;	author ajacoutot;	state Exp;
branches;
next	1.1;

1.1
date	2008.10.30.14.28.36;	author ajacoutot;	state Exp;
branches
	1.1.1.1;
next	;

1.1.1.1
date	2008.10.30.14.28.36;	author ajacoutot;	state Exp;
branches;
next	;


desc
@@


1.8
log
@Update to xdg-utils-1.1.0rc2 + fixes from upstream.
Committing now since these utilities tend to break after an update in very
subtle ways...
@
text
@$OpenBSD: patch-scripts_xdg-mime,v 1.7 2012/04/09 09:39:15 ajacoutot Exp $
--- scripts/xdg-mime.orig	Sat Jan  1 11:03:14 2011
+++ scripts/xdg-mime	Mon Apr  9 10:42:20 2012
@@@@ -676,11 +676,14 @@@@ defapp_generic()
     [ -n "$xdg_user_dir" ] || xdg_user_dir="$HOME/.local/share"
     xdg_user_dir="$xdg_user_dir/$xdg_dir_name"
     xdg_system_dirs="$XDG_DATA_DIRS"
-    [ -n "$xdg_system_dirs" ] || xdg_system_dirs=/usr/local/share/:/usr/share/
+    [ -n "$xdg_system_dirs" ] || xdg_system_dirs=${LOCALBASE}/share/:/usr/share/
 
     for x in `echo "$xdg_user_dir:$xdg_system_dirs" | sed 's/:/ /g'`; do
        DEBUG 2 "Checking $x/applications/defaults.list"
        trader_result=`grep "$MIME=" $x/applications/defaults.list 2> /dev/null | cut -d '=' -f 2 | cut -d ';' -f 1`
+       if [ -z "$trader_result" ] ; then
+          trader_result=`grep "$MIME=" $x/applications/mimeinfo.cache  2> /dev/null | cut -d '=' -f 2 | cut -d ';' -f 1`
+       fi
        if [ -n "$trader_result" ] ; then
           echo $trader_result
           exit_success
@@@@ -952,7 +955,7 @@@@ xdg_user_dir="$XDG_DATA_HOME"
 xdg_user_dir="$xdg_user_dir/$xdg_dir_name"
 
 xdg_system_dirs="$XDG_DATA_DIRS"
-[ -n "$xdg_system_dirs" ] || xdg_system_dirs=/usr/local/share/:/usr/share/
+[ -n "$xdg_system_dirs" ] || xdg_system_dirs=${LOCALBASE}/share/:/usr/share/
 for x in `echo $xdg_system_dirs | sed 's/:/ /g'`; do
     if [ -w $x/$xdg_dir_name ] ; then
         [ x"$mode" = x"system" ] && xdg_base_dir="$x/mime"
@@@@ -984,7 +987,7 @@@@ DEBUG 3 "kde_global_dir: $kde_global_dir"
 # TODO: Gnome legacy support
 # See http://forums.fedoraforum.org/showthread.php?t=26875
 gnome_user_dir="$HOME/.gnome/apps"
-gnome_global_dir=/usr/share/gnome/apps
+gnome_global_dir=${LOCALBASE}/share/gnome/apps
 [ -w $gnome_global_dir ] || gnome_global_dir=
 DEBUG 3 "gnome_user_dir: $gnome_user_dir"
 DEBUG 3 "gnome_global_dir: $gnome_global_dir"
@


1.7
log
@Update to xdg-utils-1.1.0rc1.
The 1.0 serie hasn't seen an update for 5 years and this release
contains lots of fixes for new version desktops.

While here, remove the hook stuff; that is what aliases or ~/bin are for.
@
text
@d1 1
a1 1
$OpenBSD: patch-scripts_xdg-mime,v 1.6 2010/05/28 12:41:26 ajacoutot Exp $
@


1.6
log
@We don't provide a share/applications/defaults.list file so use
mimeinfo.cache instead (and this file actually contains mimes we do
suport).
Fix typo in xdg-open.

Fixes xdg-open and xdg-mime issues dcoppa@@ reported.
ok dcoppa@@
@
text
@d1 4
a4 4
$OpenBSD: patch-scripts_xdg-mime,v 1.5 2009/04/25 08:11:13 ajacoutot Exp $
--- scripts/xdg-mime.orig	Sun Jun 24 21:57:57 2007
+++ scripts/xdg-mime	Fri May 28 14:17:21 2010
@@@@ -557,11 +557,14 @@@@ defapp_generic()
d20 1
a20 1
@@@@ -827,7 +830,7 @@@@ xdg_user_dir="$XDG_DATA_HOME"
d29 1
a29 1
@@@@ -859,7 +862,7 @@@@ DEBUG 3 "kde_global_dir: $kde_global_dir"
a37 9
@@@@ -1076,7 +1079,7 @@@@ END {
 
         # No quotes around $mimetypes
         for x in $mimetypes ; do 
-            if grep '^# Installed by xdg-mime' $kde_dir/$x.desktop &>/dev/null ; then
+            if grep '^# Installed by xdg-mime' $kde_dir/$x.desktop >/dev/null 2>&1; then
                 DEBUG 1 "Removing $kde_dir/$x.desktop (KDE 3.x support)"
                 rm -f $kde_dir/$x.desktop
             fi
@


1.5
log
@- remove workaround now that we have file(1) -i
@
text
@d1 1
a1 1
$OpenBSD: patch-scripts_xdg-mime,v 1.4 2009/02/09 13:32:10 ajacoutot Exp $
d3 2
a4 2
+++ scripts/xdg-mime	Mon Feb  9 13:54:06 2009
@@@@ -557,7 +557,7 @@@@ defapp_generic()
d13 8
a20 1
@@@@ -827,7 +827,7 @@@@ xdg_user_dir="$XDG_DATA_HOME"
d29 1
a29 1
@@@@ -859,7 +859,7 @@@@ DEBUG 3 "kde_global_dir: $kde_global_dir"
d38 1
a38 1
@@@@ -1076,7 +1076,7 @@@@ END {
@


1.4
log
@- remove bashism
@
text
@d1 1
a1 6
$OpenBSD: patch-scripts_xdg-mime,v 1.3 2009/01/28 09:53:02 ajacoutot Exp $

The file(1) call needs to be changed because the '-i' switch does not
exist under OpenBSD.
Remove a bashism.

a3 11
@@@@ -483,8 +483,8 @@@@ info_gnome()
 
 info_generic()
 {
-    DEBUG 1 "Running /usr/bin/file -i \"$1\"" 
-    /usr/bin/file -i "$1" 2> /dev/null | cut -d ":" -f 2 | sed s/"^ "//
+    DEBUG 1 "Running /usr/bin/file -bNs \"$1\""
+    /usr/bin/file -bNs "$1" 2> /dev/null | cut -d "," -f 1 | sed s/"^ "//
 
     exit_success
 }
@


1.3
log
@- the file(1) call needs to be changed as the '-i' switch does not exist
under OpenBSD... because chl@@ is a slacker ;)
This will not give completely the intended output, but at least it will
be closer than getting file(1) usage().
@
text
@d1 1
a1 1
$OpenBSD: patch-scripts_xdg-mime,v 1.2 2008/11/01 19:30:07 ajacoutot Exp $
d5 1
d8 1
a8 1
+++ scripts/xdg-mime	Wed Jan 28 10:54:32 2009
d47 9
@


1.2
log
@- merge xdg enhancements from productivity/thinkingrock
(support custom user hooks and create "open" and "email" links)

suggested by, feedback from and ok sturm@@
@
text
@d1 5
a5 1
$OpenBSD: patch-scripts_xdg-mime,v 1.1.1.1 2008/10/30 14:28:36 ajacoutot Exp $
d7 12
a18 1
+++ scripts/xdg-mime	Fri Oct 31 01:02:11 2008
@


1.1
log
@Initial revision
@
text
@d1 3
a3 3
$OpenBSD$
--- scripts/xdg-mime.orig	Thu Oct 30 14:51:30 2008
+++ scripts/xdg-mime	Thu Oct 30 14:52:24 2008
@


1.1.1.1
log
@Import xdg-utils-1.0.2

Xdg-utils is a set of command line tools that assist applications with a
variety of desktop integration tasks.  About half of the tools focus on
tasks commonly required during the installation of a desktop application
and the other half focuses on integration with the desktop environment
while the application is running.

based on an unfinished port from landry@@
ok landry@@
@
text
@@
