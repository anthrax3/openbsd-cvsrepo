head	1.10;
access;
symbols
	OPENBSD_5_6:1.9.0.2
	OPENBSD_5_6_BASE:1.9
	OPENBSD_5_5:1.8.0.6
	OPENBSD_5_5_BASE:1.8
	OPENBSD_5_4:1.8.0.4
	OPENBSD_5_4_BASE:1.8
	OPENBSD_5_3:1.8.0.2
	OPENBSD_5_3_BASE:1.8
	OPENBSD_5_2:1.7.0.2
	OPENBSD_5_2_BASE:1.7
	OPENBSD_5_1_BASE:1.6
	OPENBSD_5_1:1.6.0.4
	OPENBSD_5_0:1.6.0.2
	OPENBSD_5_0_BASE:1.6
	OPENBSD_4_9:1.4.0.4
	OPENBSD_4_9_BASE:1.4
	OPENBSD_4_8:1.4.0.2
	OPENBSD_4_8_BASE:1.4
	OPENBSD_4_7:1.3.0.2
	OPENBSD_4_7_BASE:1.3
	OPENBSD_4_6:1.2.0.4
	OPENBSD_4_6_BASE:1.2
	OPENBSD_4_5:1.2.0.2
	OPENBSD_4_5_BASE:1.2;
locks; strict;
comment	@# @;


1.10
date	2014.08.28.10.26.21;	author ajacoutot;	state dead;
branches;
next	1.9;
commitid	Frtw9s8VeEV9DBnq;

1.9
date	2014.06.02.09.25.33;	author stsp;	state Exp;
branches;
next	1.8;
commitid	azjY0HOnrs0Ua7Qd;

1.8
date	2013.01.04.11.42.18;	author ajacoutot;	state Exp;
branches;
next	1.7;

1.7
date	2012.04.09.09.39.15;	author ajacoutot;	state Exp;
branches;
next	1.6;

1.6
date	2011.05.19.18.35.43;	author ajacoutot;	state Exp;
branches;
next	1.5;

1.5
date	2011.03.28.07.12.05;	author ajacoutot;	state Exp;
branches;
next	1.4;

1.4
date	2010.05.28.12.41.26;	author ajacoutot;	state Exp;
branches;
next	1.3;

1.3
date	2009.08.15.23.14.15;	author ajacoutot;	state Exp;
branches;
next	1.2;

1.2
date	2008.11.26.17.49.39;	author ajacoutot;	state Exp;
branches;
next	1.1;

1.1
date	2008.11.01.19.30.07;	author ajacoutot;	state Exp;
branches;
next	;


desc
@@


1.10
log
@Update to xdg-utils-1.1.0rc2 + fixes from upstream.
Committing now since these utilities tend to break after an update in very
subtle ways...
@
text
@$OpenBSD: patch-scripts_xdg-open,v 1.9 2014/06/02 09:25:33 stsp Exp $

Make xdg-open work with toad(8) under KDE4.
Fix sed(1) usage (i.e. !GNU sed).

--- scripts/xdg-open.orig	Sat Jan  1 11:03:14 2011
+++ scripts/xdg-open	Sat May 31 19:33:38 2014
@@@@ -304,6 +304,7 @@@@ fi
 detectDE()
 {
     if [ x"$KDE_FULL_SESSION" = x"true" ]; then DE=kde;
+    elif `dbus-send --print-reply --dest=org.freedesktop.DBus /org/freedesktop/DBus org.freedesktop.DBus.GetNameOwner string:org.kde.KWin > /dev/null 2>&1` ; then DE=kde;
     elif [ x"$GNOME_DESKTOP_SESSION_ID" != x"" ]; then DE=gnome;
     elif `dbus-send --print-reply --dest=org.freedesktop.DBus /org/freedesktop/DBus org.freedesktop.DBus.GetNameOwner string:org.gnome.SessionManager > /dev/null 2>&1` ; then DE=gnome;
     elif xprop -root _DT_SAVE_MODE 2> /dev/null | grep ' = \"xfce4\"$' >/dev/null 2>&1; then DE=xfce;
@@@@ -384,14 +385,14 @@@@ open_xfce()
 
 open_generic_xdg_mime()
 {
-    filetype=`xdg-mime query filetype "$1" | sed "s/;.*//"`
+    filetype=`xdg-mime query filetype "$1" | sed "s/[ ;].*//"`
     default=`xdg-mime query default "$filetype"`
     if [ -n "$default" ] ; then
         xdg_user_dir="$XDG_DATA_HOME"
         [ -n "$xdg_user_dir" ] || xdg_user_dir="$HOME/.local/share"
 
         xdg_system_dirs="$XDG_DATA_DIRS"
-        [ -n "$xdg_system_dirs" ] || xdg_system_dirs=/usr/local/share/:/usr/share/
+        [ -n "$xdg_system_dirs" ] || xdg_system_dirs=${LOCALBASE}/share/:/usr/share/
 
         for x in `echo "$xdg_user_dir:$xdg_system_dirs" | sed 's/:/ /g'`; do
             local file="$x/applications/$default"
@@@@ -526,7 +527,7 @@@@ fi
 if [ x"$BROWSER" = x"" ]; then
     BROWSER=links2:links:lynx:w3m
     if [ -n "$DISPLAY" ]; then
-        BROWSER=firefox:mozilla:epiphany:konqueror:chromium-browser:google-chrome:$BROWSER
+        BROWSER=firefox:chrome:seamonkey:mozilla:epiphany:midori:konqueror:opera:firefox35:firefox36:${BROWSER}
     fi
 fi
 
@


1.9
log
@Fix xdg-open for KDE4 such that devices mounted by sysutils/toad open
up in the dolphin file manager rather than in the default web browser.
ok ajacoutot, tested by Fabian Raetz
@
text
@d1 1
a1 1
$OpenBSD: patch-scripts_xdg-open,v 1.8 2013/01/04 11:42:18 ajacoutot Exp $
@


1.8
log
@Fix sed(1) usage to open the proper application according to its mime
type.

breakage reported by edd@@, fixed by sthen@@
@
text
@d1 1
a1 1
$OpenBSD: patch-scripts_xdg-open,v 1.7 2012/04/09 09:39:15 ajacoutot Exp $
d3 1
d7 10
a16 2
+++ scripts/xdg-open	Fri Jan  4 12:33:10 2013
@@@@ -384,14 +384,14 @@@@ open_xfce()
d33 1
a33 1
@@@@ -526,7 +526,7 @@@@ fi
@


1.7
log
@Update to xdg-utils-1.1.0rc1.
The 1.0 serie hasn't seen an update for 5 years and this release
contains lots of fixes for new version desktops.

While here, remove the hook stuff; that is what aliases or ~/bin are for.
@
text
@d1 4
a4 1
$OpenBSD: patch-scripts_xdg-open,v 1.6 2011/05/19 18:35:43 ajacoutot Exp $
d6 10
a15 2
+++ scripts/xdg-open	Mon Apr  9 11:13:15 2012
@@@@ -391,7 +391,7 @@@@ open_generic_xdg_mime()
@


1.6
log
@Merge a part from upstream commit that prefers gvfs-open over gnome-open so
that xdg-open works in both gnome2 and gnome3.
@
text
@d1 19
a19 36
$OpenBSD: patch-scripts_xdg-open,v 1.5 2011/03/28 07:12:05 ajacoutot Exp $

Merge part of:
From 79fe2261b0025b36515d17d3c22c162bf1c7efb3 Mon Sep 17 00:00:00 2001
From: Rex Dieter <rdieter@@math.unl.edu>
Date: Fri, 16 Oct 2009 17:10:55 +0000
Subject: * prefer gvfs-open over gnome-open

--- scripts/xdg-open.orig	Sun Jun 24 21:58:01 2007
+++ scripts/xdg-open	Thu May 19 20:24:15 2011
@@@@ -338,7 +338,11 @@@@ open_kde()
 
 open_gnome()
 {
-    gnome-open "$1"
+    if gvfs-open --help 2>/dev/null 1>&2; then
+        gvfs-open "$1"
+    else
+        gnome-open "$1"
+    fi
 
     if [ $? -eq 0 ]; then
         exit_success
@@@@ -364,7 +368,9 @@@@ open_generic()
     for browser in $BROWSER; do
         if [ x"$browser" != x"" ]; then
 
-            browser_with_arg=`echo "$browser" | sed s#%s#"$1"#`
+            browser_with_arg=`printf "$browser" "$1" 2>/dev/null`
+            if [ $? -ne 0 ]; then browser_with_arg=$browser;
+            fi
 
             if [ x"$browser_with_arg" = x"$browser" ]; then "$browser" "$1";
             else $browser_with_arg;
@@@@ -403,12 +409,21 @@@@ if [ -z "${url}" ] ; then
     exit_failure_syntax "file or URL argument missing"
a21 19
+if which xdg-open-hook > /dev/null 2> /dev/null; then
+    xdg-open-hook "$url"
+    if [ $? -eq 0 ]; then
+        exit_success
+    else
+        exit_failure_operation_failed
+    fi
+fi
+
 detectDE
 
 if [ x"$DE" = x"" ]; then
     # if BROWSER variable is not set, check some well known browsers instead
     if [ x"$BROWSER" = x"" ]; then
-        BROWSER=firefox:mozilla:netscape
+        BROWSER=firefox:chrome:midori:xxxterm:seamonkey:epiphany:opera:dillo:conkeror:kazehakase:konqueror:firefox36:firefox35
     fi
     DE=generic
 fi
@


1.5
log
@Extend the BROWSER list.
@
text
@d1 8
a8 1
$OpenBSD: patch-scripts_xdg-open,v 1.4 2010/05/28 12:41:26 ajacoutot Exp $
d10 15
a24 2
+++ scripts/xdg-open	Mon Mar 28 08:58:36 2011
@@@@ -364,7 +364,9 @@@@ open_generic()
d35 1
a35 1
@@@@ -403,12 +405,21 @@@@ if [ -z "${url}" ] ; then
@


1.4
log
@We don't provide a share/applications/defaults.list file so use
mimeinfo.cache instead (and this file actually contains mimes we do
suport).
Fix typo in xdg-open.

Fixes xdg-open and xdg-mime issues dcoppa@@ reported.
ok dcoppa@@
@
text
@d1 1
a1 1
$OpenBSD: patch-scripts_xdg-open,v 1.3 2009/08/15 23:14:15 ajacoutot Exp $
d3 1
a3 1
+++ scripts/xdg-open	Sun Aug 16 01:11:30 2009
d34 1
a34 1
+        BROWSER=firefox:seamonkey:epiphany:opera:mozilla:netscape
@


1.3
log
@Fix xdg-open when the URL passed contains a '#' (Freedesktop Bug 23319).

from FreeBSD
@
text
@d1 1
a1 1
$OpenBSD: patch-scripts_xdg-open,v 1.2 2008/11/26 17:49:39 ajacoutot Exp $
d9 2
a10 2
+            browser_with_args=`printf "$browser" "$1" 2>/dev/null`
+            if [ $? -ne 0 ]; then browser_with_args=$browser;
@


1.2
log
@- enhance default browsers list
@
text
@d1 1
a1 1
$OpenBSD: patch-scripts_xdg-open,v 1.1 2008/11/01 19:30:07 ajacoutot Exp $
d3 13
a15 2
+++ scripts/xdg-open	Wed Nov 26 18:44:57 2008
@@@@ -403,12 +403,21 @@@@ if [ -z "${url}" ] ; then
@


1.1
log
@- merge xdg enhancements from productivity/thinkingrock
(support custom user hooks and create "open" and "email" links)

suggested by, feedback from and ok sturm@@
@
text
@d1 4
a4 4
$OpenBSD$
--- scripts/xdg-open.orig	Thu Oct 30 19:38:11 2008
+++ scripts/xdg-open	Thu Oct 30 19:38:32 2008
@@@@ -403,6 +403,15 @@@@ if [ -z "${url}" ] ; then
d20 7
@

