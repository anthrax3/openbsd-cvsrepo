head	1.3;
access;
symbols
	OPENBSD_6_2:1.3.0.2
	OPENBSD_6_2_BASE:1.3
	OPENBSD_6_1:1.1.0.2
	OPENBSD_6_1_BASE:1.1;
locks; strict;
comment	@# @;


1.3
date	2017.06.14.17.11.20;	author rsadowski;	state Exp;
branches;
next	1.2;
commitid	ykbvylx8BO3GgXGt;

1.2
date	2017.04.28.16.00.10;	author rsadowski;	state Exp;
branches;
next	1.1;
commitid	fnPtEQvAIsnRtVhR;

1.1
date	2016.12.26.15.26.01;	author zhuk;	state Exp;
branches;
next	;
commitid	XmPt7TJzRACn3W7R;


desc
@@


1.3
log
@update qt-creator to 4.3.0

Take maintainership.

PLIST tweak and ok from zhuk@@
@
text
@$OpenBSD: patch-src_shared_qbs_src_lib_corelib_tools_processutils_cpp,v 1.2 2017/04/28 16:00:10 rsadowski Exp $
Index: src/shared/qbs/src/lib/corelib/tools/processutils.cpp
--- src/shared/qbs/src/lib/corelib/tools/processutils.cpp.orig
+++ src/shared/qbs/src/lib/corelib/tools/processutils.cpp
@@@@ -49,6 +49,11 @@@@
 #   include "fileinfo.h"
 #   include <unistd.h>
 #   include <cstdio>
+#elif defined(Q_OS_OPENBSD)
+#   include <sys/param.h>
+#   include <sys/sysctl.h>
+#   include <fcntl.h>
+#   include <kvm.h>
 #elif defined(Q_OS_BSD4)
 # include <QtCore/qfile.h>
 #   include <sys/cdefs.h>
@@@@ -94,6 +99,19 @@@@ QString processNameByPid(qint64 pid)
     sprintf(exePath, "/proc/%lld/exe", pid);
     readlink(exePath, buf, sizeof(buf));
     return FileInfo::fileName(QString::fromUtf8(buf));
+#elif defined(Q_OS_OPENBSD)
+    kvm_t *kd = kvm_open(NULL, NULL, NULL, KVM_NO_FILES, NULL);
+    if (!kd)
+        return QString();
+    int cnt;
+    struct kinfo_proc *kp = kvm_getprocs(kd, KERN_PROC_PID, pid, sizeof(*kp), &cnt);
+    if (!kp || cnt < 1) {
+        kvm_close(kd);
+        return QString();
+    }
+    QString name = QString::fromUtf8(kp->p_comm);
+    kvm_close(kd);
+    return name;
 #elif defined(Q_OS_BSD4)
 # if defined(Q_OS_NETBSD)
     struct kinfo_proc2 kp;
@


1.2
log
@update to qt-creator 4.2.2

- bump some SHARED_LIBS (nm(1) checks)
- remove qch_docs target and all -docindex BUILD_DEPENDS as
  qtdeclarative loop workaround
- improve licence tag; thanks Caspar Schutijser
- Fix WANTLIB
- NO_TEST
- remove qtwebkit as LIB_DEPENDS and add ass RUN_DEPENDS
- fix one tab

ok sthen@@ landry@@, tested by Caspar Schutijser, thnaks!
@
text
@d1 4
a4 3
$OpenBSD: patch-src_shared_qbs_src_lib_corelib_tools_processutils_cpp,v 1.1 2016/12/26 15:26:01 zhuk Exp $
--- src/shared/qbs/src/lib/corelib/tools/processutils.cpp.orig	Thu Jan  5 18:01:57 2017
+++ src/shared/qbs/src/lib/corelib/tools/processutils.cpp	Thu Jan 26 23:22:01 2017
d15 1
a15 1
 # include <QFile>
@


1.1
log
@Nobody loves you, qt-creator, except three people: Caspar Schutijser,
Rafael Sadowski and me.

So lets move on and put it in. Nowadays there is no point in having
a separate qt-creator with support for older Qt's, and 4.1.0 works
with egdb at least.

Most of the work was done by Caspar, last rollup from Rafael, commit by me.
@
text
@d1 4
a4 4
$OpenBSD$
--- src/shared/qbs/src/lib/corelib/tools/processutils.cpp.orig	Fri Aug 19 09:23:24 2016
+++ src/shared/qbs/src/lib/corelib/tools/processutils.cpp	Fri Dec 16 09:57:01 2016
@@@@ -40,6 +40,11 @@@@
d16 1
a16 1
@@@@ -85,6 +90,19 @@@@ QString processNameByPid(qint64 pid)
@

