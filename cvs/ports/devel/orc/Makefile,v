head	1.21;
access;
symbols
	OPENBSD_6_1:1.20.0.6
	OPENBSD_6_1_BASE:1.20
	OPENBSD_6_0:1.20.0.4
	OPENBSD_6_0_BASE:1.20
	OPENBSD_5_9:1.20.0.2
	OPENBSD_5_9_BASE:1.20
	OPENBSD_5_8:1.19.0.4
	OPENBSD_5_8_BASE:1.19
	OPENBSD_5_7:1.18.0.4
	OPENBSD_5_7_BASE:1.18
	OPENBSD_5_6:1.18.0.2
	OPENBSD_5_6_BASE:1.18
	OPENBSD_5_5:1.17.0.2
	OPENBSD_5_5_BASE:1.17
	OPENBSD_5_4:1.16.0.2
	OPENBSD_5_4_BASE:1.16
	OPENBSD_5_3:1.14.0.2
	OPENBSD_5_3_BASE:1.14
	OPENBSD_5_2:1.13.0.4
	OPENBSD_5_2_BASE:1.13
	OPENBSD_5_1_BASE:1.13
	OPENBSD_5_1:1.13.0.2
	OPENBSD_5_0:1.10.0.2
	OPENBSD_5_0_BASE:1.10
	OPENBSD_4_9:1.7.0.2
	OPENBSD_4_9_BASE:1.7
	OPENBSD_4_8:1.5.0.2
	OPENBSD_4_8_BASE:1.5
	brad-20100325:1.1.1.1
	sthen:1.1.1;
locks; strict;
comment	@# @;


1.21
date	2017.09.25.09.16.12;	author robert;	state Exp;
branches;
next	1.20;
commitid	xOeDnABBxynvFYIF;

1.20
date	2015.10.25.08.45.10;	author ajacoutot;	state Exp;
branches;
next	1.19;
commitid	Y3uuI2n0jOzawkyV;

1.19
date	2015.04.09.20.47.15;	author sthen;	state Exp;
branches;
next	1.18;
commitid	k8aSyIWLJxYEPnMn;

1.18
date	2014.04.23.19.35.26;	author brad;	state Exp;
branches;
next	1.17;

1.17
date	2013.10.05.19.54.45;	author brad;	state Exp;
branches;
next	1.16;

1.16
date	2013.03.21.08.45.16;	author ajacoutot;	state Exp;
branches;
next	1.15;

1.15
date	2013.03.11.10.50.12;	author espie;	state Exp;
branches;
next	1.14;

1.14
date	2012.08.26.07.17.20;	author ajacoutot;	state Exp;
branches;
next	1.13;

1.13
date	2012.01.27.09.44.11;	author ajacoutot;	state Exp;
branches;
next	1.12;

1.12
date	2011.10.17.09.06.54;	author ajacoutot;	state Exp;
branches;
next	1.11;

1.11
date	2011.10.04.06.45.41;	author ajacoutot;	state Exp;
branches;
next	1.10;

1.10
date	2011.08.01.20.50.10;	author naddy;	state Exp;
branches;
next	1.9;

1.9
date	2011.04.05.08.09.00;	author sthen;	state Exp;
branches;
next	1.8;

1.8
date	2011.03.26.10.05.24;	author sthen;	state Exp;
branches;
next	1.7;

1.7
date	2011.01.18.11.37.40;	author landry;	state Exp;
branches;
next	1.6;

1.6
date	2010.11.19.08.58.18;	author jasper;	state Exp;
branches;
next	1.5;

1.5
date	2010.07.21.20.30.21;	author sthen;	state Exp;
branches;
next	1.4;

1.4
date	2010.04.10.11.11.06;	author sthen;	state Exp;
branches;
next	1.3;

1.3
date	2010.04.09.21.56.05;	author sthen;	state Exp;
branches;
next	1.2;

1.2
date	2010.04.03.00.21.14;	author sthen;	state Exp;
branches;
next	1.1;

1.1
date	2010.03.25.10.23.26;	author sthen;	state Exp;
branches
	1.1.1.1;
next	;

1.1.1.1
date	2010.03.25.10.23.26;	author sthen;	state Exp;
branches;
next	;


desc
@@


1.21
log
@Unbreak autoconf checks with clang by not using nested functions
in the checks.

Someone clearly did not read the autoconf documentation because
using the following functions with a function declaration inside
the body will end up declaring a function inside a function.

- AC_TRY_COMPILE( [], [ int main() { return 0; } ],
- AC_LANG_PROGRAM([[]], [[int main (void) { return 0; }]])],
- AC_TRY_LINK([], [int main (void) { return 0; }],

Result:

int
main ()
{
int main (void) { return 0; }
  ;
  return 0;
}

nested functions is a gcc extension which is not supported by
clang.

test.c:4:17: error: function definition is not allowed here
int main (void) { return 0; }
                ^
1 error generated.

This causes tests to fail in the configure scripts resulting in
missing compile and link time flags from the builds.

This resulted in weird behaviour of several software, like gnome
hanging completely due to gtk+3 not being built properly.

This change intrudces the following fixes:

- remove int main() declaration from AC_TRY_COMPILE, AC_LANG_PROGRAM, AC_TRY_LINK
  as it comes with a declaration already, and people misused them

- change to use AC_LANG_SOURCE when needed in case a complete source block is specified

Most of the changes are in configure.(ac|in), however there were some cases
where autoconf is either broken or the build failed because of an autoconf
generated configure script. Everytihng else is switched to autoconf, so
the maintainers can go ahead and upstream these diffs.

There are more to come, we are continously checking the tree for these issues
and in the future the infrastructure will error if such a case is found.
@
text
@# $OpenBSD: Makefile,v 1.20 2015/10/25 08:45:10 ajacoutot Exp $

COMMENT=	library and toolset to operate arrays of data

DISTNAME=	orc-0.4.24
CATEGORIES=	devel
MASTER_SITES=	http://gstreamer.freedesktop.org/src/orc/
EXTRACT_SUFX=	.tar.xz

REVISION=	0

SHARED_LIBS=	orc-0.4		6.0 \
		orc-test-0.4	5.0

HOMEPAGE=	http://code.entropywave.com/projects/orc/

MAINTAINER=	Brad Smith <brad@@comstyle.com>

# BSD
PERMIT_PACKAGE_CDROM=	Yes

WANTLIB=	c m pthread

USE_GMAKE=	Yes
CONFIGURE_STYLE= autoconf
AUTOCONF_VERSION= 2.69

.include <bsd.port.mk>
@


1.20
log
@Update to orc-0.4.24.

from Brad (maintainer)
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.19 2015/04/09 20:47:15 sthen Exp $
d9 2
@


1.19
log
@update to orc-0.4.23, from Brad (maintainer)
"The orc update was also Ok'd by ajacoutot@@"
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.18 2014/04/23 19:35:26 brad Exp $
d5 1
a5 1
DISTNAME=	orc-0.4.23
@


1.18
log
@Update to orc 0.4.19.

ok ajacoutot@@
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.17 2013/10/05 19:54:45 brad Exp $
d5 1
a5 1
DISTNAME=	orc-0.4.19
d8 1
d10 2
a11 2
SHARED_LIBS=	orc-0.4		5.0 \
		orc-test-0.4	4.0
@


1.17
log
@Update to orc 0.4.18.

Re-enable the AltiVec backend. This might need to be disabled again but
it is being enabled to receive some testing in the wild so speak.

ok ajacoutot@@
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.16 2013/03/21 08:45:16 ajacoutot Exp $
d5 1
a5 1
DISTNAME=	orc-0.4.18
d7 1
a7 1
MASTER_SITES=	http://code.entropywave.com/download/orc/
@


1.16
log
@USE_LIBTOOL=Yes is the default now.
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.15 2013/03/11 10:50:12 espie Exp $
d5 1
a5 2
DISTNAME=	orc-0.4.16
REVISION=	2
d9 2
a10 2
SHARED_LIBS=	orc-0.4		4.0 \
		orc-test-0.4	3.0
d23 1
a23 7
AUTOCONF_VERSION= 2.67

# XXX segfault in orc_audio_convert_unpack_float_32() with Altivec when
# playing a video.
.if ${MACHINE_ARCH} == "powerpc"
CONFIGURE_ARGS=	--enable-backend=none
.endif
@


1.15
log
@PERMIT_* / REGRESS->TEST sweep
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.14 2012/08/26 07:17:20 ajacoutot Exp $
a22 1
USE_LIBTOOL=	Yes
@


1.14
log
@Remove -pthread patching and sync a bit closer to a pending patch
for upstream since the original project is missing libpthread
linking all together.

from Brad (maintainer)
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.13 2012/01/27 09:44:11 ajacoutot Exp $
a18 3
PERMIT_PACKAGE_FTP=	Yes
PERMIT_DISTFILES_CDROM=	Yes
PERMIT_DISTFILES_FTP=	Yes
@


1.13
log
@Disable altivec for powerpc for now as it segfaults.

ok Brad (maintainer) sthen@@
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.12 2011/10/17 09:06:54 ajacoutot Exp $
d6 1
a6 1
REVISION=	1
d22 1
@


1.12
log
@Fix lack of nopl support.

from Brad (maintainer)
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.11 2011/10/04 06:45:41 ajacoutot Exp $
d6 1
a6 1
REVISION=	0
d28 6
@


1.11
log
@Update to orc-0.4.16.

from Brad (maintainer)
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.10 2011/08/01 20:50:10 naddy Exp $
d6 1
@


1.10
log
@Make sure the log buffer is initialized to a valid zero-length string.
ok Brad sthen@@
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.9 2011/04/05 08:09:00 sthen Exp $
d5 1
a5 2
DISTNAME=	orc-0.4.11
REVISION=	1
d9 2
a10 2
SHARED_LIBS=	orc-0.4		3.0 \
		orc-test-0.4	2.0
d26 1
a26 1
AUTOCONF_VERSION= 2.65
@


1.9
log
@Fix PowerPC support, from upstream via Brad. Allows removing forced -O0
(always nice for code which is supposed to run fast). Tested by landry@@
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.8 2011/03/26 10:05:24 sthen Exp $
d6 1
a6 1
REVISION=	0
@


1.8
log
@Bump ports which should be using newer autoconf to 2.65;
config.h files checked.  From Brad.
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.7 2011/01/18 11:37:40 landry Exp $
d6 1
a27 6

# Workaround for a known issue with the
# PowerPC AltiVec backend.
.if ${MACHINE_ARCH} == "powerpc"
CFLAGS+=	-O0
.endif
@


1.7
log
@Switch those back to use an autoconf version that's actually known to
produce working results (ie not 2.65). Use 2.64 at brad's request.
ok ajacoutot@@ sthen@@
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.6 2010/11/19 08:58:18 jasper Exp $
d26 1
a26 2
# Should be 2.65
AUTOCONF_VERSION= 2.64
@


1.6
log
@- update orc to 0.4.11

from brad
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.5 2010/07/21 20:30:21 sthen Exp $
d26 2
a27 1
AUTOCONF_VERSION= 2.65
@


1.5
log
@Update orc to 0.4.6, patched to avoid opcodes not available on our
supported arm systems. From Brad, with some prodding from ajacoutot,
many opcodes worked out by me the slow way.
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.4 2010/04/10 11:11:06 sthen Exp $
d5 1
a5 1
DISTNAME=	orc-0.4.6
d9 2
a10 2
SHARED_LIBS=	orc-0.4		2.0 \
		orc-test-0.4	1.0
d27 6
@


1.4
log
@let this build on arm; from Brad
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.3 2010/04/09 21:56:05 sthen Exp $
d5 1
a5 2
DISTNAME=	orc-0.4.4
PKGNAME=	${DISTNAME}p0
d9 2
a10 3
SHARED_LIBS=	orc-0.4		1.0 \
		orc-float-0.4	0.0 \
		orc-test-0.4	0.1
d23 1
d26 1
a26 1
AUTOCONF_VERSION= 2.64
@


1.3
log
@update orc to 0.4.4, from Brad
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.2 2010/04/03 00:21:14 sthen Exp $
d6 1
@


1.2
log
@use newer autoconf, from Brad
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.1.1.1 2010/03/25 10:23:26 sthen Exp $
d5 1
a5 2
DISTNAME=	orc-0.4.3
PKGNAME=	${DISTNAME}p0
d9 1
a9 1
SHARED_LIBS+=	orc-0.4		0.0 \
d11 1
a11 2
		orc-pixel-0.4	0.0 \
		orc-test-0.4	0.0
d26 1
a26 1
AUTOCONF_VERSION= 2.63
@


1.1
log
@Initial revision
@
text
@d1 1
a1 1
# $OpenBSD$
d6 1
d28 1
a28 2
# Should be 2.63
AUTOCONF_VERSION= 2.62
@


1.1.1.1
log
@Import devel/orc, from Brad with a patch from me to drop ARM machines
back to the generic support rather than trying to use the asm backend
which appears to be broken upstream.

Orc is a library and set of tools for compiling and executing
very simple programs that operate on arrays of data.  The "language"
is a generic assembly language that represents many of the features
available in SIMD architectures, including saturated addition and
subtraction, and many arithmetic operations.
@
text
@@
