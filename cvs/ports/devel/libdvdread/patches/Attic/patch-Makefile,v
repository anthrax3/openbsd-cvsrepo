head	1.3;
access;
symbols
	OPENBSD_5_6:1.2.0.8
	OPENBSD_5_6_BASE:1.2
	OPENBSD_5_5:1.2.0.6
	OPENBSD_5_5_BASE:1.2
	OPENBSD_5_4:1.2.0.4
	OPENBSD_5_4_BASE:1.2
	OPENBSD_5_3:1.2.0.2
	OPENBSD_5_3_BASE:1.2
	OPENBSD_5_2:1.1.0.2
	OPENBSD_5_2_BASE:1.1;
locks; strict;
comment	@# @;


1.3
date	2014.11.29.07.35.40;	author brad;	state dead;
branches;
next	1.2;
commitid	LCdTS0M0S3fQyN2g;

1.2
date	2013.02.02.11.47.47;	author espie;	state Exp;
branches;
next	1.1;

1.1
date	2012.05.03.06.51.07;	author ajacoutot;	state Exp;
branches;
next	;


desc
@@


1.3
log
@Update to libdvdread 5.0.0.
@
text
@$OpenBSD: patch-Makefile,v 1.2 2013/02/02 11:47:47 espie Exp $
--- Makefile.orig	Wed Dec 31 09:43:03 2008
+++ Makefile	Sat Feb  2 12:22:44 2013
@@@@ -16,7 +16,7 @@@@ CFLAGS += -DHAVE_CONFIG_H -DHAVE_DLFCN_H
 L=libdvdread
 DVDREAD_L=libdvdread
 DVDREAD_LIB = $(DVDREAD_L).a
-DVDREAD_SHLIB = $(DVDREAD_L).so
+DVDREAD_SHLIB = $(DVDREAD_L).so.$(LIBDVDREAD_VERSION)
 VPATH+= $(SRC_PATH_BARE)/src
 DVDREAD_HEADERS = src/dvdread/dvd_reader.h \
 	src/dvdread/ifo_print.h \
@@@@ -47,13 +47,13 @@@@ DVDREAD_DEPS= ${DVDREAD_OBJS:%.o=%.d}
 BUILDDEPS = Makefile config.mak
 
 ifeq ($(BUILD_SHARED),yes)
-all:	$(SHLIB) $(DVDREAD_SHLIB) dvdread-config pkgconfig
-install: $(SHLIB) $(DVDREAD_SHLIB) install-shared install-dvdread-config install-pkgconfig
+all:	$(DVDREAD_SHLIB) dvdread-config pkgconfig
+install: $(DVDREAD_SHLIB) install-shared install-dvdread-config install-pkgconfig
 endif
 
 ifeq ($(BUILD_STATIC),yes)
-all:	$(LIB) $(DVDREAD_LIB) dvdread-config pkgconfig
-install: $(LIB) $(DVDREAD_LIB) install-static install-dvdread-config install-pkgconfig
+all:	$(DVDREAD_LIB) dvdread-config pkgconfig
+install: $(DVDREAD_LIB) install-static install-dvdread-config install-pkgconfig
 endif
 
 install: install-headers
@@@@ -78,7 +78,7 @@@@ ${DVDREAD_LIB}: version.h $(DVDREAD_OBJS) $(BUILDDEPS)
 	cd $(.OBJDIR) && $(RANLIB) $@@
 
 ${DVDREAD_SHLIB}: version.h $(DVDREAD_SHOBJS) $(BUILDDEPS)
-	cd $(.OBJDIR) && $(CC) $(SHLDFLAGS) $(LDFLAGS) -ldl -Wl,-soname=$(DVDREAD_SHLIB).$(SHLIB_MAJOR) -o $@@ $(DVDREAD_SHOBJS)
+	cd $(.OBJDIR) && $(CC) $(SHLDFLAGS) -fPIC $(LDFLAGS) -o $@@ $(DVDREAD_SHOBJS) -ldvdcss
 
 .c.so:	$(BUILDDEPS)
 	cd $(.OBJDIR) && $(CC) -fPIC -DPIC -MD $(CFLAGS) -c -o $@@ $<
@@@@ -93,29 +93,16 @@@@ install-headers:
 	install -d $(DESTDIR)$(dvdread_incdir)
 	install -m 644 $(DVDREAD_HEADERS) $(DESTDIR)$(dvdread_incdir)
 
-install-shared: $(SHLIB)
+install-shared: $(DVDREAD_SHLIB)
 	install -d $(DESTDIR)$(shlibdir)
 
-	install $(INSTALLSTRIP) -m 755 $(.OBJDIR)/$(SHLIB) \
-		$(DESTDIR)$(shlibdir)/$(SHLIB).$(SHLIB_VERSION)
+	install -m 755 $(.OBJDIR)/$(DVDREAD_SHLIB) \
+		$(DESTDIR)$(shlibdir)
 
-	cd $(DESTDIR)$(shlibdir) && \
-		ln -sf $(SHLIB).$(SHLIB_VERSION) $(SHLIB).$(SHLIB_MAJOR)
-	cd $(DESTDIR)$(shlibdir) && \
-		ln -sf $(SHLIB).$(SHLIB_MAJOR) $(SHLIB)
-
-	install $(INSTALLSTRIP) -m 755 $(.OBJDIR)/$(DVDREAD_SHLIB) \
-		$(DESTDIR)$(shlibdir)/$(DVDREAD_SHLIB).$(SHLIB_VERSION)
-	cd $(DESTDIR)$(shlibdir) && \
-		ln -sf $(DVDREAD_SHLIB).$(SHLIB_VERSION) $(DVDREAD_SHLIB).$(SHLIB_MAJOR)
-	cd $(DESTDIR)$(shlibdir) && \
-		ln -sf $(DVDREAD_SHLIB).$(SHLIB_MAJOR) $(DVDREAD_SHLIB)
-
-install-static: $(LIB)
+install-static: $(DVDREAD_LIB)
 	install -d $(DESTDIR)$(libdir)
 
-	install $(INSTALLSTRIP) -m 755 $(.OBJDIR)/$(LIB) $(DESTDIR)$(libdir)/$(LIB)
-	install $(INSTALLSTRIP) -m 755 $(.OBJDIR)/$(DVDREAD_LIB) $(DESTDIR)$(libdir)/$(DVDREAD_LIB)
+	install -m 755 $(.OBJDIR)/$(DVDREAD_LIB) $(DESTDIR)$(libdir)/$(DVDREAD_LIB)
 
 
 # Clean targets
@


1.2
log
@directly link with dvdcss, we've been run-depending on it for ages anyhows.
@
text
@d1 1
a1 1
$OpenBSD: patch-Makefile,v 1.1 2012/05/03 06:51:07 ajacoutot Exp $
@


1.1
log
@Update to libdvdread-4.2.0.

from Brad, ok sthen@@
@
text
@d1 3
a3 3
$OpenBSD$
--- Makefile.orig	Wed Dec 31 03:43:03 2008
+++ Makefile	Fri Dec 16 03:45:55 2011
d36 1
a36 1
+	cd $(.OBJDIR) && $(CC) $(SHLDFLAGS) -fPIC $(LDFLAGS) -o $@@ $(DVDREAD_SHOBJS)
@

