head	1.3;
access;
symbols
	OPENBSD_6_1:1.3.0.10
	OPENBSD_6_1_BASE:1.3
	OPENBSD_6_0:1.3.0.8
	OPENBSD_6_0_BASE:1.3
	OPENBSD_5_9:1.3.0.4
	OPENBSD_5_9_BASE:1.3
	OPENBSD_5_8:1.3.0.6
	OPENBSD_5_8_BASE:1.3
	OPENBSD_5_7:1.3.0.2
	OPENBSD_5_7_BASE:1.3
	OPENBSD_5_6:1.2.0.10
	OPENBSD_5_6_BASE:1.2
	OPENBSD_5_5:1.2.0.8
	OPENBSD_5_5_BASE:1.2
	OPENBSD_5_4:1.2.0.6
	OPENBSD_5_4_BASE:1.2
	OPENBSD_5_3:1.2.0.4
	OPENBSD_5_3_BASE:1.2
	OPENBSD_5_2:1.2.0.2
	OPENBSD_5_2_BASE:1.2
	OPENBSD_5_1_BASE:1.1.1.1
	OPENBSD_5_1:1.1.1.1.0.30
	OPENBSD_5_0:1.1.1.1.0.28
	OPENBSD_5_0_BASE:1.1.1.1
	OPENBSD_4_9:1.1.1.1.0.26
	OPENBSD_4_9_BASE:1.1.1.1
	OPENBSD_4_8:1.1.1.1.0.24
	OPENBSD_4_8_BASE:1.1.1.1
	OPENBSD_4_7:1.1.1.1.0.22
	OPENBSD_4_7_BASE:1.1.1.1
	OPENBSD_4_6:1.1.1.1.0.20
	OPENBSD_4_6_BASE:1.1.1.1
	OPENBSD_4_5:1.1.1.1.0.18
	OPENBSD_4_5_BASE:1.1.1.1
	OPENBSD_4_4:1.1.1.1.0.16
	OPENBSD_4_4_BASE:1.1.1.1
	OPENBSD_4_3:1.1.1.1.0.14
	OPENBSD_4_3_BASE:1.1.1.1
	OPENBSD_4_2:1.1.1.1.0.12
	OPENBSD_4_2_BASE:1.1.1.1
	OPENBSD_4_1:1.1.1.1.0.10
	OPENBSD_4_1_BASE:1.1.1.1
	OPENBSD_4_0:1.1.1.1.0.8
	OPENBSD_4_0_BASE:1.1.1.1
	OPENBSD_3_9:1.1.1.1.0.6
	OPENBSD_3_9_BASE:1.1.1.1
	OPENBSD_3_8:1.1.1.1.0.4
	OPENBSD_3_8_BASE:1.1.1.1
	OPENBSD_3_7:1.1.1.1.0.2
	OPENBSD_3_7_BASE:1.1.1.1
	sturm_20050111:1.1.1.1
	sturm:1.1.1;
locks; strict;
comment	@# @;


1.3
date	2014.11.19.23.55.05;	author naddy;	state Exp;
branches;
next	1.2;
commitid	S1B4yoPqnjyUQsXu;

1.2
date	2012.07.20.12.03.50;	author jasper;	state Exp;
branches;
next	1.1;

1.1
date	2005.01.11.07.11.00;	author sturm;	state Exp;
branches
	1.1.1.1;
next	;

1.1.1.1
date	2005.01.11.07.11.00;	author sturm;	state Exp;
branches;
next	;


desc
@@


1.3
log
@fix for perl 5.20, which has dropped the "do $subr()" construct; ok espie@@
@
text
@$OpenBSD: patch-automake_in,v 1.2 2012/07/20 12:03:50 jasper Exp $

Fix insecure permissions for directories in distfile build tree. CVE-2009-4029

--- automake.in.orig	Sat Jul 27 22:55:58 2002
+++ automake.in	Thu Nov 20 00:05:32 2014
@@@@ -983,7 +983,7 @@@@ sub finish_languages
 
 	# Compute the function name of the finisher and then call it.
 	$name = 'lang_' . $lang . '_finish';
-	do $name ();
+	&$name ();
     }
 
     # If the project is entirely C++ or entirely Fortran 77, don't
@@@@ -1144,7 +1144,7 @@@@ sub handle_single_transform_list
 		# Found the language, so see what it says.
 		local ($subr) = 'lang_' . $lang . '_rewrite';
 		# Note: computed subr call.
-		local ($r) = do $subr ($base, $extension);
+		local ($r) = &$subr ($base, $extension);
 		# Skip this entry if we were asked not to process it.
 		next if ! $r;
 
@@@@ -2012,7 +2012,7 @@@@ sub handle_texinfo
 	# dependency list.
 	@@texi_deps = ();
 	push (@@texi_deps, $info_cursor);
-	push (@@texi_deps, $vtexi) if $vtexi;
+	push (@@texi_deps, '$(srcdir)/'.$vtexi) if $vtexi;
 
 	# Canonicalize name first.
 	($canonical = $infobase) =~ tr/A-Za-z0-9_/_/c;
@@@@ -2336,7 +2336,7 @@@@ sub handle_dist_worker
 	# Create dist directory.
 	$output_rules .= ("\t-rm -rf \$(distdir)\n"
 			  . "\tmkdir \$(distdir)\n"
-			  . "\t-chmod 777 \$(distdir)\n");
+			  . "\t-chmod 755 \$(distdir)\n");
     }
 
     # Only run automake in `dist' target if --include-deps and
@@@@ -2468,7 +2468,7 @@@@ sub handle_dist_worker
 	     . "\t" . '    test -d $(distdir)/$$subdir ' . "\\\n"
 	     . "\t" . '    || mkdir $(distdir)/$$subdir ' . "\\\n"
 	     . "\t" . '    || exit 1; ' . "\\\n"
-	     . "\t" . '    chmod 777 $(distdir)/$$subdir; ' . "\\\n"
+	     . "\t" . '    chmod 755 $(distdir)/$$subdir; ' . "\\\n"
 	     . "\t" . '    (cd $$subdir'
 	     . ' && $(MAKE) $(AM_MAKEFLAGS) top_distdir=../$('
 	     . (($relative_dir eq '.') ? 'distdir' : 'top_distdir')
@


1.2
log
@Apply patches for two security issues:
- Fix insecure permissions for directories in distfile build tree. CVE-2009-4029
- Fix insecure permissions used for the top of the distfile build tree. CVE-2012-3386

This was already tested in a bulk build by me as part of a larger diff

from brad
ok aja@@ sthen@@ espie@@
@
text
@d1 1
a1 1
$OpenBSD: patch-automake_in,v 1.1.1.1 2005/01/11 07:11:00 sturm Exp $
d5 20
a24 2
--- automake.in.orig	Sat Jul 27 16:55:58 2002
+++ automake.in	Thu Jul 19 16:04:18 2012
@


1.1
log
@Initial revision
@
text
@d1 6
a6 3
$OpenBSD: patch-automake_in,v 1.8 2001/08/27 14:01:47 espie Exp $
--- automake.in.orig	Sun Jul 15 12:47:28 2001
+++ automake.in	Fri Aug 17 12:47:25 2001
d16 18
@


1.1.1.1
log
@bring automake in line with autoconf

w/ help from mbalmer@@
@
text
@@
