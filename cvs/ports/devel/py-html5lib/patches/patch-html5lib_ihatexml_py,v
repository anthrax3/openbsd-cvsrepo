head	1.1;
access;
symbols
	OPENBSD_6_0:1.1.0.2
	OPENBSD_6_0_BASE:1.1;
locks; strict;
comment	@# @;


1.1
date	2016.05.02.18.10.09;	author danj;	state Exp;
branches;
next	;
commitid	hc8lurOGCKi5HzlC;


desc
@@


1.1
log
@backport fixes for the tests with newer textproc/py-lxml

from new maintainer Sean Levy, ok landry@@
@
text
@$OpenBSD$

Backport of patch for comment issue:
https://github.com/html5lib/html5lib-python/commit/0c551c9519e47f76f8f185089ed71cb9539b6e00
--- html5lib/ihatexml.py.orig	Fri Apr 22 18:44:14 2016
+++ html5lib/ihatexml.py	Fri Apr 22 18:45:49 2016
@@@@ -225,6 +225,9 @@@@ class InfosetFilter(object):
             while "--" in data:
                 warnings.warn("Comments cannot contain adjacent dashes", DataLossWarning)
                 data = data.replace("--", "- -")
+            if data.endswith("-"):
+                warnings.warn("Comments cannot end in a dash", DataLossWarning)
+                data += " "
         return data
 
     def coerceCharacters(self, data):
@
