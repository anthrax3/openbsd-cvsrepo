head	1.2;
access;
symbols
	OPENBSD_6_0:1.1.0.2
	OPENBSD_6_0_BASE:1.1;
locks; strict;
comment	@# @;


1.2
date	2016.07.30.14.22.43;	author ajacoutot;	state dead;
branches;
next	1.1;
commitid	43FQ9m7i4JIHW29f;

1.1
date	2016.07.22.12.27.42;	author sthen;	state Exp;
branches;
next	;
commitid	UMcBk2fKDWMKrbt4;


desc
@@


1.2
log
@Update to libidn-1.33.
@
text
@$OpenBSD: patch-lib_idna_c,v 1.1 2016/07/22 12:27:42 sthen Exp $

Backport security fixes from libidn 1.33
https://lists.gnu.org/archive/html/help-libidn/2016-07/msg00009.html

--- lib/idna.c.orig	Sat Aug  1 14:07:20 2015
+++ lib/idna.c	Thu Jul 21 17:08:52 2016
@@@@ -212,6 +212,11 @@@@ step3:
       }
     if (i < 64)
       out[i] = '\0';
+    else
+      {
+	free (src);
+	return IDNA_INVALID_LENGTH;
+      }
     if (inasciirange)
       goto step8;
   }
@@@@ -266,7 +271,7 @@@@ step3:
 
 step8:
   free (src);
-  if (strlen (out) < 1 || strlen (out) > 63)
+  if (strlen (out) < 1)
     return IDNA_INVALID_LENGTH;
 
   return IDNA_SUCCESS;
@


1.1
log
@Backport code fixes to devel/libidn from r1.33; out-of-bounds reads,
memory leak and a crash with invalid UTF-8. Not doing the full update
this late before release as they also updated gnulib and m4 files.
Thanks naddy@@ for autoconf help.
https://lists.gnu.org/archive/html/help-libidn/2016-07/msg00009.html

ok naddy
@
text
@d1 1
a1 1
$OpenBSD$
@

