head	1.8;
access;
symbols
	OPENBSD_6_2:1.8.0.4
	OPENBSD_6_2_BASE:1.8
	OPENBSD_6_1:1.8.0.2
	OPENBSD_6_1_BASE:1.8
	OPENBSD_6_0:1.7.0.6
	OPENBSD_6_0_BASE:1.7
	OPENBSD_5_9:1.7.0.2
	OPENBSD_5_9_BASE:1.7
	OPENBSD_5_8:1.7.0.4
	OPENBSD_5_8_BASE:1.7
	OPENBSD_5_7:1.5.0.2
	OPENBSD_5_7_BASE:1.5
	OPENBSD_5_6:1.3.0.2
	OPENBSD_5_6_BASE:1.3
	OPENBSD_5_5:1.1.1.1.0.2
	OPENBSD_5_5_BASE:1.1.1.1
	benoit_20140124:1.1.1.1
	benoit:1.1.1;
locks; strict;
comment	@# @;


1.8
date	2016.10.03.07.39.59;	author feinerer;	state Exp;
branches;
next	1.7;
commitid	BeEtu6vwuYyX5zz0;

1.7
date	2015.05.09.06.50.02;	author benoit;	state Exp;
branches;
next	1.6;
commitid	Y7CCSvTxUpdWl03u;

1.6
date	2015.03.15.17.32.48;	author benoit;	state Exp;
branches;
next	1.5;
commitid	7hqMBGG1o91n9OzI;

1.5
date	2015.02.04.07.33.11;	author benoit;	state Exp;
branches;
next	1.4;
commitid	ej18lr807Up4JjAs;

1.4
date	2014.11.19.21.59.31;	author benoit;	state Exp;
branches;
next	1.3;
commitid	vOqf1YaoQgcDKqOa;

1.3
date	2014.04.04.09.57.39;	author benoit;	state Exp;
branches;
next	1.2;

1.2
date	2014.03.16.09.45.32;	author benoit;	state Exp;
branches;
next	1.1;

1.1
date	2014.01.24.22.47.46;	author benoit;	state Exp;
branches
	1.1.1.1;
next	;

1.1.1.1
date	2014.01.24.22.47.46;	author benoit;	state Exp;
branches;
next	;


desc
@@


1.8
log
@Fix SONAME so that binaries built with -lcapstone can actually find the library.

ok benoit@@
@
text
@$OpenBSD: patch-Makefile,v 1.7 2015/05/09 06:50:02 benoit Exp $

1. Do not force some compilation flags.
2. Set library version, respecting OpenBSD policy.
3. Avoid duplication of defines, linked to (2).
4. Do not use $(INSTALL_*) at the build stage.

--- Makefile.orig	Fri May  8 11:06:59 2015
+++ Makefile	Sat May  9 08:34:16 2015
@@@@ -30,7 +30,7 @@@@ ifneq (,$(findstring yes,$(CAPSTONE_DIET)))
 CFLAGS ?= -Os
 CFLAGS += -DCAPSTONE_DIET
 else
-CFLAGS ?= -O3
+CFLAGS ?= 
 endif
 
 ifneq (,$(findstring yes,$(CAPSTONE_X86_ATT_DISABLE)))
@@@@ -82,8 +82,11 @@@@ INSTALL_DATA ?= $(INSTALL_BIN) -m0644
 INSTALL_LIB ?= $(INSTALL_BIN) -m0755
 
 LIBNAME = capstone
+LIBVER ?= 0.0.0
+ifdef LIB$(LIBNAME)_VERSION
+LIBVER = $(LIB$(LIBNAME)_VERSION)
+endif
 
-
 DEP_ARM =
 DEP_ARM += arch/ARM/ARMGenAsmWriter.inc
 DEP_ARM += arch/ARM/ARMGenDisassemblerTables.inc
@@@@ -282,7 +285,7 @@@@ else
 EXT = so
 VERSION_EXT = $(EXT).$(API_MAJOR)
 AR_EXT = a
-$(LIBNAME)_LDFLAGS += -Wl,-soname,lib$(LIBNAME).$(VERSION_EXT)
+$(LIBNAME)_LDFLAGS += -Wl,-soname,lib$(LIBNAME).$(EXT).$(LIBVER)
 endif
 endif
 endif
@@@@ -293,7 +296,7 @@@@ LIBRARY = $(BLDIR)/$(LIBNAME).$(EXT)
 else ifeq ($(IS_CYGWIN),1)
 LIBRARY = $(BLDIR)/$(LIBNAME).$(EXT)
 else	# *nix
-LIBRARY = $(BLDIR)/lib$(LIBNAME).$(EXT)
+LIBRARY = $(BLDIR)/lib$(LIBNAME).$(EXT).$(LIBVER)
 CFLAGS += -fvisibility=hidden
 endif
 endif
@@@@ -320,7 +323,7 @@@@ else
 	cd tests && $(MAKE) BUILDDIR=$(BLDIR)
 endif
 ifeq ($(CAPSTONE_SHARED),yes)
-	$(INSTALL_DATA) $(LIBRARY) $(BLDIR)/tests/
+	cp $(LIBRARY) $(BLDIR)/tests/
 endif
 endif
 
@@@@ -367,13 +370,9 @@@@ endif
 install: $(PKGCFGF) $(ARCHIVE) $(LIBRARY)
 	mkdir -p $(LIBDIR)
 ifeq ($(CAPSTONE_SHARED),yes)
-	$(INSTALL_LIB) $(LIBRARY) $(LIBDIR)
-ifneq ($(VERSION_EXT),)
-	cd $(LIBDIR) && \
-	mv lib$(LIBNAME).$(EXT) lib$(LIBNAME).$(VERSION_EXT) && \
-	ln -s lib$(LIBNAME).$(VERSION_EXT) lib$(LIBNAME).$(EXT)
+	$(INSTALL_LIBRARY) $(LIBRARY) $(LIBDIR)
+	$(INSTALL_DATA) $(ARCHIVE) $(LIBDIR)
 endif
-endif
 ifeq ($(CAPSTONE_STATIC),yes)
 	$(INSTALL_DATA) $(ARCHIVE) $(LIBDIR)
 endif
@@@@ -383,13 +382,12 @@@@ endif
 	$(INSTALL_DATA) $(PKGCFGF) $(PKGCFGDIR)/
 
 uninstall:
-	rm -rf $(INCDIR)/$(LIBNAME)
-	rm -f $(LIBDIR)/lib$(LIBNAME).*
-	rm -f $(PKGCFGDIR)/$(LIBNAME).pc
+	rm -f $(LIBDIR)/$(LIBRARY)
+	rm -f $(LIBDIR)/$(ARCHIVE)
+	rm -f $(LIBDIR)/pkgconfig/$(PKGCFGF)
 
 clean:
-	rm -f $(LIBOBJ)
-	rm -f $(BLDIR)/lib$(LIBNAME).* $(BLDIR)/$(LIBNAME).*
+	rm -f $(LIBOBJ) $(ARCHIVE) $(LIBRARY)
 	rm -f $(PKGCFGF)
 
 ifeq (,$(findstring yes,$(CAPSTONE_BUILD_CORE_ONLY)))
@


1.7
log
@Update to capstone-3.0.3.
@
text
@d1 1
a1 1
$OpenBSD: patch-Makefile,v 1.6 2015/03/15 17:32:48 benoit Exp $
d37 1
a37 1
+$(LIBNAME)_LDFLAGS += -Wl,-soname,lib$(LIBNAME)
@


1.6
log
@Update to capstone-3.0.2.
@
text
@d1 1
a1 1
$OpenBSD$
d8 3
a10 3
--- Makefile.orig	Wed Mar 11 07:51:16 2015
+++ Makefile	Sat Mar 14 11:38:13 2015
@@@@ -30,7 +30,7 @@@@
d19 1
a19 1
@@@@ -78,8 +78,11 @@@@
d32 1
a32 1
@@@@ -278,7 +281,7 @@@@
d41 1
a41 1
@@@@ -289,7 +292,7 @@@@
d50 1
a50 1
@@@@ -316,7 +319,7 @@@@
d59 1
a59 1
@@@@ -363,13 +366,9 @@@@
d75 1
a75 1
@@@@ -379,13 +378,12 @@@@
@


1.5
log
@Update to capstone-3.0.1.
@
text
@d1 1
a1 1
$OpenBSD: patch-Makefile,v 1.4 2014/11/19 21:59:31 benoit Exp $
d8 3
a10 3
--- Makefile.orig	Tue Feb  3 15:41:07 2015
+++ Makefile	Wed Feb  4 08:05:44 2015
@@@@ -30,7 +30,7 @@@@ ifneq (,$(findstring yes,$(CAPSTONE_DIET)))
d19 1
a19 1
@@@@ -78,8 +78,11 @@@@ INSTALL_DATA ?= $(INSTALL_BIN) -m0644
d32 1
a32 1
@@@@ -278,7 +281,7 @@@@ else
d41 1
a41 1
@@@@ -289,7 +292,7 @@@@ LIBRARY = $(BLDIR)/$(LIBNAME).$(EXT)
d47 1
d50 1
a50 2
 
@@@@ -315,7 +318,7 @@@@ else
d59 1
a59 1
@@@@ -362,13 +365,9 @@@@ endif
d75 1
a75 1
@@@@ -378,13 +377,12 @@@@ endif
@


1.4
log
@Update to capstone-3.0.
@
text
@d1 1
a1 1
$OpenBSD$
d8 3
a10 3
--- Makefile.orig	Wed Nov 19 10:56:04 2014
+++ Makefile	Wed Nov 19 22:14:42 2014
@@@@ -30,7 +30,7 @@@@
d19 1
a19 1
@@@@ -78,8 +78,11 @@@@
d32 1
a32 1
@@@@ -278,7 +281,7 @@@@
d41 1
a41 1
@@@@ -289,7 +292,7 @@@@
d50 1
a50 1
@@@@ -314,7 +317,7 @@@@
d57 1
d59 1
a59 2
 ifeq ($(CAPSTONE_SHARED),yes)
@@@@ -360,13 +363,9 @@@@
d75 1
a75 1
@@@@ -376,13 +375,12 @@@@
d91 2
a92 2
 	cd tests && $(MAKE) clean
 	rm -f $(BLDIR)/tests/lib$(LIBNAME).$(EXT)
@


1.3
log
@Update capstone to 2.1.2.
@
text
@d8 8
a15 4
--- Makefile.orig	Tue Apr  1 04:22:54 2014
+++ Makefile	Fri Apr  4 08:10:20 2014
@@@@ -16,7 +16,7 @@@@
 STRIP = $(CROSS)strip
d18 2
a19 6
-CFLAGS += -fPIC -O3 -Wall -Iinclude
+CFLAGS += -fPIC -Wall -Iinclude
 
 ifeq ($(USE_SYS_DYN_MEM),yes)
 CFLAGS += -DUSE_SYS_DYN_MEM
@@@@ -59,6 +59,10 @@@@
d28 1
a28 1
 
d30 3
a32 1
@@@@ -199,12 +203,16 @@@@
d36 4
a39 2
-LDFLAGS += -Wl,-soname,lib$(LIBNAME).$(VERSION_EXT)
+LDFLAGS += -Wl,-soname,lib$(LIBNAME)
d41 6
d50 7
a56 7
+ifeq ($(LIBVER),)
 LIBRARY = lib$(LIBNAME).$(EXT)
+else
+LIBRARY = lib$(LIBNAME).$(EXT).$(LIBVER)
+endif
 ARCHIVE = lib$(LIBNAME).$(AR_EXT)
 PKGCFGF = $(LIBNAME).pc
d58 3
a60 10
@@@@ -212,7 +220,7 @@@@
 
 all: $(LIBRARY) $(ARCHIVE) $(PKGCFGF)
 	$(MAKE) -C tests
-	$(INSTALL_DATA) lib$(LIBNAME).$(EXT) tests
+	cp $(LIBRARY) tests
 
 $(LIBRARY): $(LIBOBJ)
 	$(CC) $(LDFLAGS) $(LIBOBJ) -o $(LIBRARY)
@@@@ -248,13 +256,8 @@@@
d62 2
a63 3
 	# remove potential broken old libs
 	rm -f $(LIBDIR)/lib$(LIBNAME).*
-	$(INSTALL_LIB) lib$(LIBNAME).$(EXT) $(LIBDIR)
a67 2
-endif
-	$(INSTALL_DATA) lib$(LIBNAME).$(AR_EXT) $(LIBDIR)
d70 7
a76 4
 	mkdir -p $(INCDIR)/$(LIBNAME)
 	$(INSTALL_DATA) include/*.h $(INCDIR)/$(LIBNAME)
 	mkdir -p $(PKGCFCGDIR)
@@@@ -262,11 +265,12 @@@@
d79 1
a79 1
 	rm -rf $(INCDIR)/$(LIBNAME)
d81 1
a81 1
-	rm -f $(PKGCFCGDIR)/$(LIBNAME).pc
d87 2
a88 1
-	rm -f $(LIBOBJ) lib$(LIBNAME).*
d91 2
a92 2
 	$(MAKE) -C bindings/python clean
 	$(MAKE) -C bindings/java clean
@


1.2
log
@Update capstone to 2.1.1.
@
text
@d8 2
a9 2
--- Makefile.orig	Tue Mar 11 04:41:09 2014
+++ Makefile	Fri Mar 14 07:52:13 2014
d19 2
a20 2
@@@@ -44,6 +44,10 @@@@
 INSTALL_LIBRARY ?= $(INSTALL_BIN) -m0755
d30 3
a32 1
@@@@ -180,12 +184,16 @@@@
d34 1
a34 3
 API_MAJOR=$(shell echo `grep -e CS_API_MAJOR include/capstone.h | grep -v = | awk '{print $$3}'` | awk '{print $$1}')
 
-LDFLAGS += -Wl,-soname,lib$(LIBNAME)$(API_MAJOR)
d48 1
a48 1
@@@@ -193,7 +201,7 @@@@
d57 1
a57 3
@@@@ -244,8 +252,8 @@@@
 
 install: $(PKGCFGF) $(ARCHIVE) $(LIBRARY)
d59 8
a66 1
-	$(INSTALL_LIBRARY) lib$(LIBNAME).$(EXT) $(LIBDIR)
d73 1
a73 1
@@@@ -253,12 +261,12 @@@@
d77 1
a77 2
-	rm -f $(LIBDIR)/lib$(LIBNAME).$(EXT)
-	rm -f $(LIBDIR)/lib$(LIBNAME).$(AR_EXT)
a86 1
 	rm -f include/diet.h
d88 1
@


1.1
log
@Initial revision
@
text
@d2 1
d7 4
a10 3
--- Makefile.orig	Wed Jan 22 14:33:35 2014
+++ Makefile	Fri Jan 24 13:53:48 2014
@@@@ -15,7 +15,7 @@@@ RANLIB = $(CROSS)ranlib
d19 1
a19 1
@@@@ -43,6 +43,10 @@@@ INSTALL_DATA ?= $(INSTALL_BIN) -m0644
d28 9
a36 3
 LIBOBJ =
 LIBOBJ += cs.o utils.o SStream.o MCInstrDesc.o MCRegisterInfo.o
@@@@ -120,7 +124,11 @@@@ endif
d48 1
a48 1
@@@@ -130,7 +138,7 @@@@ VERSION=$(shell echo `grep -e PKG_MAJOR -e PKG_MINOR C
d57 1
a57 1
@@@@ -152,8 +160,8 @@@@ $(PKGCFGF):
d67 2
a68 2
 	mkdir -p $(LIBDIR)/pkgconfig
@@@@ -161,12 +169,12 @@@@ install: $(PKGCFGF) $(ARCHIVE) $(LIBRARY)
d74 1
a74 1
-	rm -f $(LIBDIR)/pkgconfig/$(LIBNAME).pc
d83 1
a84 1
 	$(MAKE) -C bindings/java clean
@


1.1.1.1
log
@Import capstone.

Capstone is a lightweight multi-platform, multi-architecture disassembly
framework.

tweaks and ok zhuk@@
@
text
@@
