head	1.7;
access;
symbols
	OPENBSD_5_6:1.6.0.4
	OPENBSD_5_6_BASE:1.6
	OPENBSD_5_5:1.6.0.2
	OPENBSD_5_5_BASE:1.6
	OPENBSD_5_3:1.4.0.2
	OPENBSD_5_3_BASE:1.4
	OPENBSD_5_2:1.1.0.2
	OPENBSD_5_2_BASE:1.1;
locks; strict;
comment	@# @;


1.7
date	2014.10.13.09.13.31;	author dcoppa;	state dead;
branches;
next	1.6;
commitid	QqD1u0uXMd6wQ7Va;

1.6
date	2013.09.19.16.03.27;	author miod;	state Exp;
branches;
next	1.5;

1.5
date	2013.04.23.18.59.53;	author dcoppa;	state dead;
branches;
next	1.4;

1.4
date	2012.12.28.18.27.23;	author dcoppa;	state Exp;
branches;
next	1.3;

1.3
date	2012.08.21.13.22.50;	author dcoppa;	state Exp;
branches;
next	1.2;

1.2
date	2012.08.14.07.11.09;	author jasper;	state Exp;
branches;
next	1.1;

1.1
date	2012.04.11.13.57.17;	author naddy;	state Exp;
branches;
next	;


desc
@@


1.7
log
@
Bugfixing update to libev-4.19

Thanks sthen@@ for the ag search results
@
text
@$OpenBSD: patch-ev_c,v 1.6 2013/09/19 16:03:27 miod Exp $

Teach libev about m68k, m88k and sh.

--- ev.c.orig	Fri Mar  1 11:10:48 2013
+++ ev.c	Wed Sep  4 14:49:57 2013
@@@@ -637,6 +637,12 @@@@ struct signalfd_siginfo
       #define ECB_MEMORY_FENCE_RELEASE __asm__ __volatile__ ("")
     #elif defined __ia64__
       #define ECB_MEMORY_FENCE         __asm__ __volatile__ ("mf"       : : : "memory")
+    #elif defined __m68k__
+      #define ECB_MEMORY_FENCE         __asm__ __volatile__ (""         : : : "memory")
+    #elif defined __m88k__
+      #define ECB_MEMORY_FENCE         __asm__ __volatile__ ("tb1 0,%%r0,128" : : : "memory")
+    #elif defined __sh__
+      #define ECB_MEMORY_FENCE         __asm__ __volatile__ (""         : : : "memory")
     #endif
   #endif
 #endif
@@@@ -1053,6 +1059,9 @@@@ ecb_inline ecb_bool ecb_little_endian (void) { return 
     || defined __alpha__ \
     || defined __hppa__ \
     || defined __ia64__ \
+    || defined __m68k__ \
+    || defined __m88k__ \
+    || defined __sh__ \
     || defined _M_IX86 || defined _M_AMD64 || defined _M_IA64
   #define ECB_STDFP 1
   #include <string.h> /* for memcpy */
@


1.6
log
@Add support for m68k, m88k and sh.
ok dcoppa@@ schmorp (upstream)
@
text
@d1 1
a1 1
$OpenBSD$
@


1.5
log
@Update to libev-4.15.
While here, merge PFRAG.shared into PLIST.

OK sthen@@
@
text
@d1 1
a1 1
$OpenBSD: patch-ev_c,v 1.4 2012/12/28 18:27:23 dcoppa Exp $
d3 1
a3 1
Add support for OpenBSD/alpha and OpenBSD/mips64 (latter from ev.c -r1.412).
d5 12
a16 34
Add support for OpenBSD/hppa

--- ev.c.orig	Sat Feb  4 20:09:52 2012
+++ ev.c	Fri Dec 28 19:16:35 2012
@@@@ -559,12 +559,12 @@@@ struct signalfd_siginfo
   #if ECB_GCC_VERSION(2,5) || defined(__INTEL_COMPILER) || (__llvm__ && __GNUC__) || __SUNPRO_C >= 0x5110 || __SUNPRO_CC >= 0x5110
     #if __i386 || __i386__
       #define ECB_MEMORY_FENCE         __asm__ __volatile__ ("lock; orb $0, -1(%%esp)" : : : "memory")
-      #define ECB_MEMORY_FENCE_ACQUIRE ECB_MEMORY_FENCE /* non-lock xchg might be enough */
-      #define ECB_MEMORY_FENCE_RELEASE do { } while (0) /* unlikely to change in future cpus */
+      #define ECB_MEMORY_FENCE_ACQUIRE __asm__ __volatile__ ("" : : : "memory")
+      #define ECB_MEMORY_FENCE_RELEASE __asm__ __volatile__ ("")
     #elif __amd64 || __amd64__ || __x86_64 || __x86_64__
       #define ECB_MEMORY_FENCE         __asm__ __volatile__ ("mfence" : : : "memory")
-      #define ECB_MEMORY_FENCE_ACQUIRE __asm__ __volatile__ ("lfence" : : : "memory")
-      #define ECB_MEMORY_FENCE_RELEASE __asm__ __volatile__ ("sfence") /* play safe - not needed in any current cpu */
+      #define ECB_MEMORY_FENCE_ACQUIRE __asm__ __volatile__ ("" : : : "memory")
+      #define ECB_MEMORY_FENCE_RELEASE __asm__ __volatile__ ("")
     #elif __powerpc__ || __ppc__ || __powerpc64__ || __ppc64__
       #define ECB_MEMORY_FENCE         __asm__ __volatile__ ("sync" : : : "memory")
     #elif defined(__ARM_ARCH_6__ ) || defined(__ARM_ARCH_6J__ ) \
@@@@ -579,6 +579,15 @@@@ struct signalfd_siginfo
       #define ECB_MEMORY_FENCE_RELEASE __asm__ __volatile__ ("membar #LoadStore |             #StoreStore")
     #elif defined(__s390__) || defined(__s390x__)
       #define ECB_MEMORY_FENCE         __asm__ __volatile__ ("bcr 15,0" : : : "memory")
+    #elif defined(__mips__)
+      #define ECB_MEMORY_FENCE         __asm__ __volatile__ ("sync" : : : "memory")
+    #elif defined(__alpha__)
+      #define ECB_MEMORY_FENCE         __asm__ __volatile__ ("mb" : : : "memory")
+    #elif defined(__hppa__)
+      #define ECB_MEMORY_FENCE         __asm__ __volatile__ ("" : : : "memory")
+      #define ECB_MEMORY_FENCE_RELEASE __asm__ __volatile__ ("")
+    #elif defined(__ia64__)
+      #define ECB_MEMORY_FENCE         __asm__ __volatile__ ("mf" : : : "memory")
d20 10
@


1.4
log
@Sync with upstream cvs.
@
text
@d1 1
a1 1
$OpenBSD: patch-ev_c,v 1.3 2012/08/21 13:22:50 dcoppa Exp $
@


1.3
log
@Add support for hppa (and unbreak build)

Problem reported by landry@@
Cluestick from kettenis@@
@
text
@d1 1
a1 1
$OpenBSD: patch-ev_c,v 1.2 2012/08/14 07:11:09 jasper Exp $
d8 19
a26 2
+++ ev.c	Tue Aug 21 14:14:58 2012
@@@@ -579,6 +579,12 @@@@ struct signalfd_siginfo
d35 4
a38 1
+      #define ECB_MEMORY_FENCE         __asm__ __volatile__ ("sync" : : : "memory")
@


1.2
log
@add support for mips64, from upstream

ok dcoppa@@ (MAINTAINER)
@
text
@d1 1
a1 1
$OpenBSD: patch-ev_c,v 1.1 2012/04/11 13:57:17 naddy Exp $
d5 2
d8 2
a9 2
+++ ev.c	Fri Jul 27 14:30:52 2012
@@@@ -579,6 +579,10 @@@@ struct signalfd_siginfo
d17 2
@


1.1
log
@define a memory fence primitive for alpha to enable building on that arch
@
text
@d1 7
a7 4
$OpenBSD$
--- ev.c.orig	Wed Apr 11 13:06:15 2012
+++ ev.c	Wed Apr 11 13:19:45 2012
@@@@ -579,6 +579,8 @@@@ struct signalfd_siginfo
d11 2
@

