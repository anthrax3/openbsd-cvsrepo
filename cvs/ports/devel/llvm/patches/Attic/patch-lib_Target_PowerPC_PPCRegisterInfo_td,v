head	1.3;
access;
symbols
	OPENBSD_5_6:1.1.0.2
	OPENBSD_5_6_BASE:1.1;
locks; strict;
comment	@# @;


1.3
date	2014.12.30.22.41.09;	author brad;	state dead;
branches;
next	1.2;
commitid	J87oAFRZWWKVCyo6;

1.2
date	2014.12.30.22.25.47;	author brad;	state Exp;
branches;
next	1.1;
commitid	iVCH6tQUkcQbh7zN;

1.1
date	2014.07.10.22.46.37;	author brad;	state Exp;
branches;
next	;
commitid	QWL9Lg9Nbr4j1VZM;


desc
@@


1.3
log
@r223708
[PowerPC] Don't use a non-allocatable register to implement the 'cc' alias
@
text
@$OpenBSD: patch-lib_Target_PowerPC_PPCRegisterInfo_td,v 1.2 2014/12/30 22:25:47 brad Exp $

r205630
Add a full condition code register to make the "cc" clobber work

gcc inline asm supports specifying "cc" as a clobber of all condition
registers. Add just enough modeling of the full register to make this work.
Fixed PR19326.

r223328
[PowerPC] 'cc' should be an alias only to 'cr0'

We had mistakenly believed that GCC's 'cc' referred to the entire
condition-code register (cr0 through cr7) -- and implemented this in r205630 to
fix PR19326, but 'cc' is actually an alias only to 'cr0'. This is causing LLVM
to clobber too much with legacy code with inline asm using the 'cc' clobber.

Fixes PR21451.

--- lib/Target/PowerPC/PPCRegisterInfo.td.orig	Sun Mar  2 21:57:39 2014
+++ lib/Target/PowerPC/PPCRegisterInfo.td	Tue Dec 30 17:17:52 2014
@@@@ -144,6 +144,11 @@@@ def CR6 : CR<6, "cr6", [CR6LT, CR6GT, CR6EQ, CR6UN]>, 
 def CR7 : CR<7, "cr7", [CR7LT, CR7GT, CR7EQ, CR7UN]>, DwarfRegNum<[75, 75]>;
 }
 
+// An alias for "cr0" used by GCC.
+def CC : PPCReg<"cc">, DwarfRegAlias<CR0> {
+  let Aliases = [CR0];
+}
+
 // Link register
 def LR  : SPR<8, "lr">, DwarfRegNum<[-2, 65]>;
 //let Aliases = [LR] in
@@@@ -233,3 +238,8 @@@@ def VRSAVERC : RegisterClass<"PPC", [i32], 32, (add VR
 def CARRYRC : RegisterClass<"PPC", [i32], 32, (add CARRY)> {
   let CopyCost = -1;
 }
+
+def CCRC : RegisterClass<"PPC", [i32], 32, (add CC)> {
+  let isAllocatable = 0;
+}
+
@


1.2
log
@r223328
[PowerPC] 'cc' should be an alias only to 'cr0'
@
text
@d1 1
a1 1
$OpenBSD: patch-lib_Target_PowerPC_PPCRegisterInfo_td,v 1.1 2014/07/10 22:46:37 brad Exp $
@


1.1
log
@Bring in fixes from 3.4.1 / 3.4.2 that do not already exist in the
3.5 snapshot (which around 60% of them did)..

r203025, r203050, r203054, r203281, r203581, r203719, r203818, r204155, r204304,
r205067, r205630, r205738, r207990, r208501.

ok matthew@@
@
text
@d1 1
a1 1
$OpenBSD$
d10 10
d21 2
a22 2
+++ lib/Target/PowerPC/PPCRegisterInfo.td	Sat Jun 14 04:13:52 2014
@@@@ -144,6 +144,13 @@@@ def CR6 : CR<6, "cr6", [CR6LT, CR6GT, CR6EQ, CR6UN]>, 
d26 1
a26 3
+// The full condition-code register. This is not modeled fully, but defined
+// here primarily, for compatibility with gcc, to allow the inline asm "cc"
+// clobber specification to work.
d28 1
a28 1
+  let Aliases = [CR0, CR1, CR2, CR3, CR4, CR5, CR6, CR7];
d34 1
a34 1
@@@@ -233,3 +240,8 @@@@ def VRSAVERC : RegisterClass<"PPC", [i32], 32, (add VR
@

