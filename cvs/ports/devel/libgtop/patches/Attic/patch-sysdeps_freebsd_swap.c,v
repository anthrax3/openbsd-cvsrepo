head	1.4;
access;
symbols
	OPENBSD_4_1:1.3.0.22
	OPENBSD_4_1_BASE:1.3
	OPENBSD_4_0:1.3.0.20
	OPENBSD_4_0_BASE:1.3
	OPENBSD_3_9:1.3.0.18
	OPENBSD_3_9_BASE:1.3
	OPENBSD_3_8:1.3.0.16
	OPENBSD_3_8_BASE:1.3
	OPENBSD_3_7:1.3.0.14
	OPENBSD_3_7_BASE:1.3
	OPENBSD_3_6:1.3.0.12
	OPENBSD_3_6_BASE:1.3
	OPENBSD_3_5:1.3.0.10
	OPENBSD_3_5_BASE:1.3
	OPENBSD_3_4:1.3.0.8
	OPENBSD_3_4_BASE:1.3
	OPENBSD_3_3:1.3.0.6
	OPENBSD_3_3_BASE:1.3
	OPENBSD_3_2:1.3.0.4
	OPENBSD_3_2_BASE:1.3
	OPENBSD_3_1:1.3.0.2
	OPENBSD_3_1_BASE:1.3
	OPENBSD_3_0:1.2.0.2
	OPENBSD_3_0_BASE:1.2
	libgtop_1_0_12:1.1.1.1
	todd:1.1.1;
locks; strict;
comment	@ * @;


1.4
date	2007.05.01.20.54.25;	author bernd;	state dead;
branches;
next	1.3;

1.3
date	2001.11.27.23.07.02;	author todd;	state Exp;
branches;
next	1.2;

1.2
date	2001.09.19.14.37.49;	author naddy;	state Exp;
branches;
next	1.1;

1.1
date	2001.09.13.20.45.46;	author todd;	state Exp;
branches
	1.1.1.1;
next	;

1.1.1.1
date	2001.09.13.20.45.46;	author todd;	state Exp;
branches;
next	;


desc
@@


1.4
log
@Remove some old and broken gnome-1.x stuff.

ok robert@@, sturm@@, steven@@, espie@@
@
text
@$OpenBSD: patch-sysdeps_freebsd_swap.c,v 1.3 2001/11/27 23:07:02 todd Exp $
--- sysdeps/freebsd/swap.c.orig	Sun Feb 13 16:47:59 2000
+++ sysdeps/freebsd/swap.c	Mon Aug 27 17:02:38 2001
@@@@ -69,9 +69,9 @@@@ static struct nlist nlst [] = {
 };
 #endif
 
-#elif defined(__NetBSD__)
+#elif defined(__NetBSD__) || defined(OpenBSD)
 
-#if (__NetBSD_Version__ >= 104000000)
+#if (__NetBSD_Version__ >= 104000000) || defined(OpenBSD)
 #include <uvm/uvm_extern.h>
 #include <sys/swap.h>
 #else
@@@@ -80,7 +80,7 @@@@ static struct nlist nlst [] = {
 
 #endif
 
-#if defined(__NetBSD__) && (__NetBSD_Version__ >= 104000000)
+#if (defined(__NetBSD__) && (__NetBSD_Version__ >= 104000000)) || defined(OpenBSD)
 static int mib_uvmexp [] = { CTL_VM, VM_UVMEXP };
 #else
 /* nlist structure for kernel access */
@@@@ -111,7 +111,7 @@@@ glibtop_init_swap_p (glibtop *server)
 #endif
 #endif
 
-#if !(defined(__NetBSD__) && (__NetBSD_Version__ >= 104000000))
+#if !(defined(__NetBSD__) && (__NetBSD_Version__ >= 104000000)) && !defined(OpenBSD)
 	if (kvm_nlist (server->machine.kd, nlst2) < 0) {
 		glibtop_warn_io_r (server, "kvm_nlist (cnt)");
 		return;
@@@@ -151,14 +151,16 @@@@ glibtop_get_swap_p (glibtop *server, gli
 
 #elif defined(__bsdi__)	
 	struct swapstats swap;
-#elif defined(__NetBSD__)
+#elif defined(__NetBSD__) || defined(OpenBSD)
 	struct swapent *swaplist;
+	long blocksize;
+	int hlen;
 #endif
 
 	int nswap, i;
 	int avail = 0, inuse = 0;
 
-#if defined(__NetBSD__) && (__NetBSD_Version__ >= 104000000)
+#if (defined(__NetBSD__) && (__NetBSD_Version__ >= 104000000)) || defined(OpenBSD)
 	struct uvmexp uvmexp;
 	size_t length_uvmexp;
 #else
@@@@ -175,7 +177,7 @@@@ glibtop_get_swap_p (glibtop *server, gli
 	if (server->sysdeps.swap == 0)
 		return;
 
-#if defined(__NetBSD__) && (__NetBSD_Version__ >= 104000000)
+#if (defined(__NetBSD__) && (__NetBSD_Version__ >= 104000000)) || defined(OpenBSD)
 	length_uvmexp = sizeof (uvmexp);
 	if (sysctl (mib_uvmexp, 2, &uvmexp, &length_uvmexp, NULL, 0)) {
 		glibtop_warn_io_r (server, "sysctl (uvmexp)");
@@@@ -199,7 +201,7 @@@@ glibtop_get_swap_p (glibtop *server, gli
 		buf->pagein = vmm.v_swappgsin - swappgsin;
 		buf->pageout = vmm.v_swappgsout - swappgsout;
 #else
-#if defined(__NetBSD__) && (__NetBSD_Version__ >= 104000000)
+#if (defined(__NetBSD__) && (__NetBSD_Version__ >= 104000000)) || defined(OpenBSD)
 		buf->pagein = uvmexp.swapins - swappgsin;
 		buf->pageout = uvmexp.swapouts - swappgsout;
 #else
@@@@ -213,7 +215,7 @@@@ glibtop_get_swap_p (glibtop *server, gli
         swappgsin = vmm.v_swappgsin;
 	swappgsout = vmm.v_swappgsout;
 #else
-#if defined(__NetBSD__) && (__NetBSD_Version__ >= 104000000)
+#if (defined(__NetBSD__) && (__NetBSD_Version__ >= 104000000)) || defined(OpenBSD)
 	swappgsin = uvmexp.swapins;
 	swappgsout = uvmexp.swapouts;
 #else
@@@@ -393,7 +395,7 @@@@ glibtop_get_swap_p (glibtop *server, gli
 
 	buf->total = swap.swap_total;
 
-#elif defined(__NetBSD__)
+#elif defined(__NetBSD__) || defined(OpenBSD)
 
 	nswap = swapctl (SWAP_NSWAP, NULL, 0);
 	if (nswap < 0) {
@@@@ -418,9 +420,10 @@@@ glibtop_get_swap_p (glibtop *server, gli
 
 	buf->flags = _glibtop_sysdeps_swap;
 
-	buf->used = inuse;
-	buf->free = avail;
+	(char *)getbsize (&hlen, &blocksize);
 
-	buf->total = inuse + avail;
+	buf->total = avail * blocksize;
+	buf->used = inuse * blocksize;
+	buf->free = buf->total - buf->used;
 #endif
 }
@


1.3
log
@Security update for libgtop to libgtop-1.0.13:

The Laboratory intexxia found a remote exploitable format string
vulnerability in libgtop_daemon which could cause privilege escalation
on a remote system.

The libgtop_daemon is not running by default if you run GNOME.

New since last version:

- security fix
- update for parallel install with libgtop-2.0
+ Only install shared libraries on shared arches.

From maintainer (Nils Nordman <nino@@nforced.com>).
@
text
@d1 1
a1 1
$OpenBSD$
@


1.2
log
@- fix message catalog installation
- sync libtool patches
- UVM is no longer an option
- remove useless install message
- add RCS Ids, clean up
@
text
@@


1.1
log
@Initial revision
@
text
@d1 1
@


1.1.1.1
log
@portable library for obtaining system information
@
text
@@
