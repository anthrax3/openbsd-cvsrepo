head	1.6;
access;
symbols
	OPENBSD_4_1:1.5.0.12
	OPENBSD_4_1_BASE:1.5
	OPENBSD_4_0:1.5.0.10
	OPENBSD_4_0_BASE:1.5
	OPENBSD_3_9:1.5.0.8
	OPENBSD_3_9_BASE:1.5
	OPENBSD_3_8:1.5.0.6
	OPENBSD_3_8_BASE:1.5
	OPENBSD_3_7:1.5.0.4
	OPENBSD_3_7_BASE:1.5
	OPENBSD_3_6:1.5.0.2
	OPENBSD_3_6_BASE:1.5
	OPENBSD_3_5:1.4.0.10
	OPENBSD_3_5_BASE:1.4
	OPENBSD_3_4:1.4.0.8
	OPENBSD_3_4_BASE:1.4
	OPENBSD_3_3:1.4.0.6
	OPENBSD_3_3_BASE:1.4
	OPENBSD_3_2:1.4.0.4
	OPENBSD_3_2_BASE:1.4
	OPENBSD_3_1:1.4.0.2
	OPENBSD_3_1_BASE:1.4
	OPENBSD_3_0:1.2.0.2
	OPENBSD_3_0_BASE:1.2
	libgtop_1_0_12:1.1.1.1
	todd:1.1.1;
locks; strict;
comment	@ * @;


1.6
date	2007.05.01.20.54.25;	author bernd;	state dead;
branches;
next	1.5;

1.5
date	2004.08.09.15.00.56;	author espie;	state Exp;
branches;
next	1.4;

1.4
date	2001.11.27.23.07.02;	author todd;	state Exp;
branches;
next	1.3;

1.3
date	2001.11.13.09.03.25;	author wilfried;	state Exp;
branches;
next	1.2;

1.2
date	2001.09.19.14.37.49;	author naddy;	state Exp;
branches;
next	1.1;

1.1
date	2001.09.13.20.45.46;	author todd;	state Exp;
branches
	1.1.1.1;
next	;

1.1.1.1
date	2001.09.13.20.45.46;	author todd;	state Exp;
branches;
next	;


desc
@@


1.6
log
@Remove some old and broken gnome-1.x stuff.

ok robert@@, sturm@@, steven@@, espie@@
@
text
@$OpenBSD: patch-sysdeps_freebsd_procmem.c,v 1.5 2004/08/09 15:00:56 espie Exp $
--- sysdeps/freebsd/procmem.c.orig	Mon Nov 26 23:37:59 2001
+++ sysdeps/freebsd/procmem.c	Mon Aug  9 16:47:10 2004
@@@@ -31,8 +31,6 @@@@
 #include <sys/param.h>
 #include <sys/proc.h>
 #include <sys/resource.h>
-#include <vm/vm_object.h>
-#include <vm/vm_map.h>
 
 #include <sys/vnode.h>
 #include <ufs/ufs/quota.h>
@@@@ -43,9 +41,8 @@@@
 #include <sys/user.h>
 #endif
 #include <sys/sysctl.h>
-#include <vm/vm.h>
 
-#if defined(__NetBSD__) && (__NetBSD_Version__ >= 104000000)
+#if (defined(__NetBSD__) && (__NetBSD_Version__ >= 104000000)) || defined(OpenBSD)
 /* Fixme ... */
 #undef _KERNEL
 #define _UVM_UVM_AMAP_I_H_ 1
@@@@ -61,10 +58,8 @@@@ static const unsigned long _glibtop_sysd
 (1L << GLIBTOP_PROC_MEM_RSS_RLIM);
 
 static const unsigned long _glibtop_sysdeps_proc_mem_share =
-#if defined(__NetBSD__) && (__NetBSD_Version__ >= 104000000)
+#if (defined(__NetBSD__) && (__NetBSD_Version__ >= 104000000)) || defined(OpenBSD) || defined(__FreeBSD__)
 (1L << GLIBTOP_PROC_MEM_SHARE);
-#elif defined(__FreeBSD__)
-(1L << GLIBTOP_PROC_MEM_SHARE);
 #else
 0;
 #endif
@@@@ -111,7 +106,7 @@@@ glibtop_get_proc_mem_p (glibtop *server,
 	struct kinfo_proc *pinfo;
 	struct vm_map_entry entry, *first;
 	struct vmspace *vms, vmspace;
-#if defined(__NetBSD__) && (__NetBSD_Version__ >= 104000000)
+#if (defined(__NetBSD__) && (__NetBSD_Version__ >= 104000000)) || defined(OpenBSD)
 	struct vnode vnode;
 	struct inode inode;
 #else
@@@@ -196,7 +191,7 @@@@ glibtop_get_proc_mem_p (glibtop *server,
  			continue;
 #endif
 #else
-#if defined(__NetBSD__) && (__NetBSD_Version__ >= 104000000)
+#if (defined(__NetBSD__) && (__NetBSD_Version__ >= 104000000)) || defined(OpenBSD)
  		if (UVM_ET_ISSUBMAP (&entry))
 			continue;
 #else
@@@@ -205,7 +200,7 @@@@ glibtop_get_proc_mem_p (glibtop *server,
 #endif
 #endif
 
-#if defined(__NetBSD__) && (__NetBSD_Version__ >= 104000000)
+#if (defined(__NetBSD__) && (__NetBSD_Version__ >= 104000000)) || defined(OpenBSD)
 		if (!entry.object.uvm_obj)
 			continue;
 
@@@@ -232,16 +227,15 @@@@ glibtop_get_proc_mem_p (glibtop *server,
 #endif
 		/* If the object is of type vnode, add its size */
 
-#if defined(__NetBSD__) && (__NetBSD_Version__ >= 104000000)
-		if (!vnode.v_uvm.u_flags & UVM_VNODE_VALID)
-			continue;
+#if (defined(__NetBSD__) && (__NetBSD_Version__ >= 104000000)) || defined(OpenBSD)
 
 		if ((vnode.v_type != VREG) || (vnode.v_tag != VT_UFS) ||
 		    !vnode.v_data) continue;
 
-		/* Reference count must be at least two. */
-		if (vnode.v_uvm.u_obj.uo_refs <= 1)
-			continue;
+
+               /* Reference count must be at least two. */
+               if (vnode.v_usecount <= 1)
+                       continue;
 
 		buf->share += pagetok (vnode.v_uvm.u_obj.uo_npages) << LOG1024;
 #endif
@


1.5
log
@new plist, ditch INSTALL script.
@
text
@d1 1
a1 1
$OpenBSD: patch-sysdeps_freebsd_procmem.c,v 1.4 2001/11/27 23:07:02 todd Exp $
@


1.4
log
@Security update for libgtop to libgtop-1.0.13:

The Laboratory intexxia found a remote exploitable format string
vulnerability in libgtop_daemon which could cause privilege escalation
on a remote system.

The libgtop_daemon is not running by default if you run GNOME.

New since last version:

- security fix
- update for parallel install with libgtop-2.0
+ Only install shared libraries on shared arches.

From maintainer (Nils Nordman <nino@@nforced.com>).
@
text
@d1 1
a1 1
$OpenBSD: patch-sysdeps_freebsd_procmem.c,v 1.3 2001/11/13 09:03:25 wilfried Exp $
d3 1
a3 1
+++ sysdeps/freebsd/procmem.c	Tue Nov 27 21:30:45 2001
d24 1
a24 1
@@@@ -61,9 +58,7 @@@@ static const unsigned long _glibtop_sysd
a28 2
-(1L << GLIBTOP_PROC_MEM_SHARE);
-#elif defined(__FreeBSD__)
d31 2
d35 1
@


1.3
log
@don't use vm/vm.h, from maintainer
@
text
@d1 3
a3 3
$OpenBSD$
--- sysdeps/freebsd/procmem.c.orig	Thu May 27 20:56:49 1999
+++ sysdeps/freebsd/procmem.c	Mon Nov 12 20:53:53 2001
d62 1
a62 1
@@@@ -232,7 +227,7 @@@@ glibtop_get_proc_mem_p (glibtop *server,
d67 2
a69 2
 		if (!vnode.v_uvm.u_flags & UVM_VNODE_VALID)
 			continue;
d71 13
@


1.2
log
@- fix message catalog installation
- sync libtool patches
- UVM is no longer an option
- remove useless install message
- add RCS Ids, clean up
@
text
@d3 1
a3 1
+++ sysdeps/freebsd/procmem.c	Mon Aug 27 17:24:33 2001
d13 3
a15 1
@@@@ -45,7 +43,7 @@@@
d17 1
a17 1
 #include <vm/vm.h>
d24 1
a24 1
@@@@ -61,9 +59,7 @@@@ static const unsigned long _glibtop_sysd
d35 1
a35 1
@@@@ -111,7 +107,7 @@@@ glibtop_get_proc_mem_p (glibtop *server,
d44 1
a44 1
@@@@ -196,7 +192,7 @@@@ glibtop_get_proc_mem_p (glibtop *server,
d53 1
a53 1
@@@@ -205,7 +201,7 @@@@ glibtop_get_proc_mem_p (glibtop *server,
d62 1
a62 1
@@@@ -232,7 +228,7 @@@@ glibtop_get_proc_mem_p (glibtop *server,
@


1.1
log
@Initial revision
@
text
@d1 1
@


1.1.1.1
log
@portable library for obtaining system information
@
text
@@
