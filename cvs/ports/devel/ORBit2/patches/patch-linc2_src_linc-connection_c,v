head	1.1;
access;
symbols
	OPENBSD_6_1:1.1.0.16
	OPENBSD_6_1_BASE:1.1
	OPENBSD_6_0:1.1.0.14
	OPENBSD_6_0_BASE:1.1
	OPENBSD_5_9:1.1.0.10
	OPENBSD_5_9_BASE:1.1
	OPENBSD_5_8:1.1.0.12
	OPENBSD_5_8_BASE:1.1
	OPENBSD_5_7:1.1.0.8
	OPENBSD_5_7_BASE:1.1
	OPENBSD_5_6:1.1.0.6
	OPENBSD_5_6_BASE:1.1
	OPENBSD_5_5:1.1.0.4
	OPENBSD_5_5_BASE:1.1
	OPENBSD_5_4:1.1.0.2
	OPENBSD_5_4_BASE:1.1;
locks; strict;
comment	@# @;


1.1
date	2013.05.14.12.44.41;	author ajacoutot;	state Exp;
branches;
next	;


desc
@@


1.1
log
@Bug fix and reliability patches from upstream.
@
text
@$OpenBSD$

From 26371ccfe0728b8bdd3f8ae3109d22645e385525 Mon Sep 17 00:00:00 2001
From: Kjartan Maraas <kmaraas@@gnome.org>
Date: Tue, 14 May 2013 11:53:52 +0000
Subject: Commit patch from bug #662623 to fix connection failures on heavily loaded systems. Patch from Red Hat support.

--- linc2/src/linc-connection.c.orig	Tue Feb  9 13:05:35 2010
+++ linc2/src/linc-connection.c	Tue May 14 14:40:34 2013
@@@@ -651,8 +651,12 @@@@ link_connection_do_initiate (LinkConnection        *cn
 		fix_permissions (service);
 	}
 #endif
-
+retry:
 	LINK_TEMP_FAILURE_RETRY_SOCKET (connect (fd, saddr, saddr_len), rv);
+	if (rv == -1L && errno == EAGAIN) {
+		g_usleep (10000);
+		goto retry;
+	}
 #ifdef HAVE_WINSOCK2_H
 	if (rv == SOCKET_ERROR) {
 		if ((options & LINK_CONNECTION_NONBLOCKING) &&
@
