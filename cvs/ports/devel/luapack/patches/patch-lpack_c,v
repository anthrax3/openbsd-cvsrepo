head	1.2;
access;
symbols
	OPENBSD_6_1:1.2.0.4
	OPENBSD_6_1_BASE:1.2
	OPENBSD_6_0:1.2.0.2
	OPENBSD_6_0_BASE:1.2
	OPENBSD_5_9:1.1.0.10
	OPENBSD_5_9_BASE:1.1
	OPENBSD_5_8:1.1.0.12
	OPENBSD_5_8_BASE:1.1
	OPENBSD_5_7:1.1.0.8
	OPENBSD_5_7_BASE:1.1
	OPENBSD_5_6:1.1.0.6
	OPENBSD_5_6_BASE:1.1
	OPENBSD_5_5:1.1.0.4
	OPENBSD_5_5_BASE:1.1
	OPENBSD_5_4:1.1.0.2
	OPENBSD_5_4_BASE:1.1;
locks; strict;
comment	@# @;


1.2
date	2016.06.11.14.10.06;	author jca;	state Exp;
branches;
next	1.1;
commitid	abADKcxg8qpJtTU7;

1.1
date	2013.05.30.15.37.56;	author jasper;	state Exp;
branches;
next	;


desc
@@


1.2
log
@Restore lua51 compat
@
text
@$OpenBSD: patch-lpack_c,v 1.1 2013/05/30 15:37:56 jasper Exp $

Unbreak with lua 5.2.

--- lpack.c.orig	Mon Jul 31 18:19:59 2006
+++ lpack.c	Tue May 17 09:18:25 2016
@@@@ -100,7 +100,11 @@@@ static int l_unpack(lua_State *L) 		/** unpack(s,f,[in
  const char *s=luaL_checkstring(L,1);
  const char *f=luaL_checkstring(L,2);
  int i=luaL_optnumber(L,3,1)-1;
+#if LUA_VERSION_NUM <= 501
  size_t len=lua_strlen(L,1);
+#else
+ size_t len=lua_rawlen(L,1);
+#endif
  int n=0;
  int swap=0;
  lua_pushnil(L);
@@@@ -251,7 +255,7 @@@@ static int l_pack(lua_State *L) 		/** pack(f,...) */
  return 1;
 }
 
-static const luaL_reg R[] =
+static const luaL_Reg R[] =
 {
 	{"pack",	l_pack},
 	{"unpack",	l_unpack},
@


1.1
log
@unbreak with lua 5.2
@
text
@d1 1
a1 1
$OpenBSD$
d5 3
a7 3
--- lpack.c.orig	Thu May 30 19:26:28 2013
+++ lpack.c	Thu May 30 19:30:59 2013
@@@@ -100,7 +100,7 @@@@ static int l_unpack(lua_State *L) 		/** unpack(s,f,[in
d11 3
a13 1
- size_t len=lua_strlen(L,1);
d15 1
d19 1
a19 1
@@@@ -251,7 +251,7 @@@@ static int l_pack(lua_State *L) 		/** pack(f,...) */
@

