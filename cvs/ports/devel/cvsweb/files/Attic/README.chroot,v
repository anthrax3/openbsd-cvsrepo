head	1.9;
access;
symbols
	OPENBSD_4_8:1.8.0.4
	OPENBSD_4_8_BASE:1.8
	OPENBSD_4_7:1.8.0.2
	OPENBSD_4_7_BASE:1.8
	OPENBSD_4_6:1.6.0.2
	OPENBSD_4_6_BASE:1.6
	OPENBSD_4_5:1.5.0.2
	OPENBSD_4_5_BASE:1.5
	OPENBSD_4_4:1.4.0.10
	OPENBSD_4_4_BASE:1.4
	OPENBSD_4_3:1.4.0.8
	OPENBSD_4_3_BASE:1.4
	OPENBSD_4_2:1.4.0.6
	OPENBSD_4_2_BASE:1.4
	OPENBSD_4_1:1.4.0.4
	OPENBSD_4_1_BASE:1.4
	OPENBSD_4_0:1.4.0.2
	OPENBSD_4_0_BASE:1.4
	OPENBSD_3_9:1.3.0.4
	OPENBSD_3_9_BASE:1.3
	OPENBSD_3_8:1.3.0.2
	OPENBSD_3_8_BASE:1.3
	OPENBSD_3_7:1.2.0.4
	OPENBSD_3_7_BASE:1.2
	OPENBSD_3_6:1.2.0.2
	OPENBSD_3_6_BASE:1.2
	OPENBSD_3_5:1.1.0.2
	OPENBSD_3_5_BASE:1.1;
locks; strict;
comment	@# @;


1.9
date	2010.11.13.09.24.52;	author ajacoutot;	state dead;
branches;
next	1.8;

1.8
date	2009.11.25.19.54.19;	author naddy;	state Exp;
branches;
next	1.7;

1.7
date	2009.10.29.08.19.07;	author giovanni;	state Exp;
branches;
next	1.6;

1.6
date	2009.06.02.04.38.35;	author naddy;	state Exp;
branches;
next	1.5;

1.5
date	2009.02.17.09.04.07;	author giovanni;	state Exp;
branches;
next	1.4;

1.4
date	2006.07.12.19.26.11;	author naddy;	state Exp;
branches;
next	1.3;

1.3
date	2005.05.24.00.05.56;	author naddy;	state Exp;
branches;
next	1.2;

1.2
date	2004.08.09.18.20.59;	author xsa;	state Exp;
branches;
next	1.1;

1.1
date	2003.12.30.03.38.09;	author jolan;	state Exp;
branches;
next	;


desc
@@


1.9
log
@Move to pkg-readmes.
@
text
@# $OpenBSD: README.chroot,v 1.8 2009/11/25 19:54:19 naddy Exp $
# Author: Jolan Luff <jolan@@openbsd.org>

In order to make CVSweb operate in a chroot environment, it is
necessary to copy all of the relevant tools, libraries, and perl modules
that CVSweb employs into /var/www.

First, create the basic directory structure:

$ cd /var/www
# mkdir tmp usr
# chown www:www tmp	(needs to be writeable for the www user)

$ cd /var/www/usr
# mkdir -p {bin,lib,libdata/perl5,libexec}

$ cd /var/www/usr/libdata/perl5
# mkdir -p {File,IPC,Time,warnings,`machine`-openbsd/5.10.1}

The "annotate" function requires this empty file:

NOTE: You can create an actual null device instead, but that will
not work if the filesystem is mounted with the nodev option, and
it is not required for cvsweb.

$ cd /var/www/dev
# touch null

Now, the required binaries:

$ cd /var/www/usr/bin
# cp -p /usr/bin/{co,cvs,diff,perl,rcsdiff,rlog,uname} .

Next, the libraries that the binaries are linked to:

NOTE: Wildcards will, of course, copy any old, unused libraries that are
lurking around (for example, from an upgrade):

$ cd /var/www/usr/lib
# cp -p /usr/lib/lib{c,crypto,des,gssapi,krb5,m,perl,util,z}.so* .

Now, the run-time link-editor:

$ cd /var/www/usr/libexec
# cp -p /usr/libexec/ld.so .

And finally, the perl modules:

$ cd /var/www/usr/libdata/perl5
# cp -p /usr/libdata/perl5/{Carp,Exporter,Symbol,base,integer}.pm .
# cp -p /usr/libdata/perl5/{strict,warnings,vars,constant}.pm .
# cp -p /usr/libdata/perl5/File/Basename.pm ./File/
# cp -p /usr/libdata/perl5/IPC/Open{2,3}.pm ./IPC/
# cp -p /usr/libdata/perl5/Time/Local.pm ./Time/
# cp -p /usr/libdata/perl5/warnings/register.pm ./warnings/

$ cd /var/www/usr/libdata/perl5/`machine`-openbsd/5.10.1
# cp -p /usr/libdata/perl5/`machine`-openbsd/5.10.1/{Config,Cwd}.pm .
# cp -p /usr/libdata/perl5/`machine`-openbsd/5.10.1/Config_{git,heavy}.pl .

Editing cvsweb and cvsweb.conf
------------------------------

The cvsweb program itself and cvsweb.conf both assume Apache is not
running in a chroot environment, so we need to change some default paths
so they are relative to /var/www.

In /var/www/cgi-bin/cvsweb:

for ("$mydir/cvsweb.conf", '/var/www/conf/cvsweb/cvsweb.conf') {
for ("$mydir/cvsweb.conf", '/conf/cvsweb/cvsweb.conf') {

In /var/www/conf/cvsweb/cvsweb.conf:

Change CVSrepositories to reflect the location of the directories which
contain CVSROOT.  This example shows a local repository NFS mounted over
loopback into /var/www/cvs, since the directory must be relative to
/var/www, we use /cvs.

@@CVSrepositories = (
	'local'   => ['Local Repository', '/home/cvs'],	      (default)
	'local'   => ['Local Repository', '/cvs'],	      (chroot)

And the same idea for $mimetypes:

$mime_types = '/var/www/conf/mime.types';		       (default)
$mime_types = '/conf/mime.types';			       (chroot)
@


1.8
log
@update chroot instructions; ok jasper@@, landry@@
@
text
@d1 1
a1 1
# $OpenBSD: README.chroot,v 1.7 2009/10/29 08:19:07 giovanni Exp $
@


1.7
log
@
Fix README.chroot after perl upgrade
remove naddy@@ as maintainer per his request
ok naddy@@
@
text
@d1 1
a1 1
# $OpenBSD: README.chroot,v 1.6 2009/06/02 04:38:35 naddy Exp $
d11 1
a11 1
# mkdir {tmp,usr}
d20 9
d59 1
@


1.6
log
@catch up with latest Perl demands; from Nathan Houghton <natex84@@gmail.com>
@
text
@d1 1
a1 1
# $OpenBSD: README.chroot,v 1.5 2009/02/17 09:04:07 giovanni Exp $
d18 1
a18 1
# mkdir -p {File,IPC,Time,warnings,`machine`-openbsd/5.10.0}
d48 2
a49 2
$ cd /var/www/usr/libdata/perl5/`machine`-openbsd/5.10.0
# cp -p /usr/libdata/perl5/`machine`-openbsd/5.10.0/{Config,Cwd}.pm .
@


1.5
log
@
Fix README.Chroot after perl upgrade to 5.10
ok naddy@@
@
text
@d1 1
a1 1
# $OpenBSD: README.chroot,v 1.4 2006/07/12 19:26:11 naddy Exp $
d42 1
a42 1
# cp -p /usr/libdata/perl5/{strict,warnings,vars}.pm .
@


1.4
log
@Sync CVSweb installation instructions with Perl reality on current
OpenBSD systems; from Moritz Grimm <mlist@@scapa.dnsalias.net>.
@
text
@d1 1
a1 1
# $OpenBSD: README.chroot,v 1.3 2005/05/24 00:05:56 naddy Exp $
d18 1
a18 1
# mkdir -p {File,IPC,Time,warnings,`machine`-openbsd/5.8.8}
d48 2
a49 2
$ cd /var/www/usr/libdata/perl5/`machine`-openbsd/5.8.8
# cp -p /usr/libdata/perl5/`machine`-openbsd/5.8.8/{Config,Cwd}.pm .
@


1.3
log
@Sync chroot instructions with perl version.
From: Lawrence Teo <lcteo@@uncc.edu>
@
text
@d1 1
a1 1
# $OpenBSD: README.chroot,v 1.2 2004/08/09 18:20:59 xsa Exp $
d18 1
a18 1
# mkdir -p {File,IPC,Time,warnings,`machine`-openbsd/5.8.6}
d48 2
a49 2
$ cd /var/www/usr/libdata/perl5/`machine`-openbsd/5.8.6
# cp -p /usr/libdata/perl5/`machine`-openbsd/5.8.6/{Config,Cwd}.pm .
@


1.2
log
@
sync with our current perl version; okay jolan@@ naddy@@.
@
text
@d1 1
a1 1
# $OpenBSD: README.chroot,v 1.1 2003/12/30 03:38:09 jolan Exp $
d18 1
a18 1
# mkdir -p {File,IPC,Time,warnings,`machine`-openbsd/5.8.5}
d48 2
a49 2
$ cd /var/www/usr/libdata/perl5/`machine`-openbsd/5.8.5
# cp -p /usr/libdata/perl5/`machine`-openbsd/5.8.5/{Config,Cwd}.pm .
@


1.1
log
@add cvsweb-in-chroot document, to be installed when it can be done in a
non-hacky way.

ok naddy@@
@
text
@d1 1
a1 1
# $OpenBSD$
d18 1
a18 1
# mkdir -p {File,IPC,Time,warnings,`machine`-openbsd/5.8.2}
d48 2
a49 2
$ cd /var/www/usr/libdata/perl5/`machine`-openbsd/5.8.2
# cp -p /usr/libdata/perl5/`machine`-openbsd/5.8.2/{Config,Cwd}.pm .
@

