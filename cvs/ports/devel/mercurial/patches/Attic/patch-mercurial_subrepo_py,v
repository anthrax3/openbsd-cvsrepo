head	1.1;
access;
symbols
	OPENBSD_5_9:1.1.0.2;
locks; strict;
comment	@# @;


1.1
date	2016.06.27.16.39.28;	author jasper;	state dead;
branches
	1.1.2.1;
next	;
commitid	TTxpUw5imnimb97H;

1.1.2.1
date	2016.06.27.16.39.28;	author jasper;	state Exp;
branches;
next	;
commitid	TTxpUw5imnimb97H;


desc
@@


1.1
log
@file patch-mercurial_subrepo_py was initially added on branch OPENBSD_5_9.
@
text
@@


1.1.2.1
log
@security fixes for CVE-2016-3069, CVE-2016-3105, CVE-2016-3630, CVE-2016-3068

ok rpointel@@ (MAINTAINER)
@
text
@a0 19
$OpenBSD$

Security fix for CVE-2016-3068
https://selenic.com/repo/hg-stable/rev/34d43cb85de8

--- mercurial/subrepo.py.orig	Mon Jun 27 15:24:51 2016
+++ mercurial/subrepo.py	Mon Jun 27 15:25:15 2016
@@@@ -1374,6 +1374,11 @@@@ class gitsubrepo(abstractsubrepo):
         are not supported and very probably fail.
         """
         self.ui.debug('%s: git %s\n' % (self._relpath, ' '.join(commands)))
+        if env is None:
+            env = os.environ.copy()
+        # fix for Git CVE-2015-7545
+        if 'GIT_ALLOW_PROTOCOL' not in env:
+            env['GIT_ALLOW_PROTOCOL'] = 'file:git:http:https:ssh'
         # unless ui.quiet is set, print git's stderr,
         # which is mostly progress and useful info
         errpipe = None
@

