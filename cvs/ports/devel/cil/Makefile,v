head	1.34;
access;
symbols
	OPENBSD_6_2:1.34.0.4
	OPENBSD_6_2_BASE:1.34
	OPENBSD_6_1:1.34.0.2
	OPENBSD_6_1_BASE:1.34
	OPENBSD_6_0:1.33.0.2
	OPENBSD_6_0_BASE:1.33
	OPENBSD_5_9:1.32.0.4
	OPENBSD_5_9_BASE:1.32
	OPENBSD_5_8:1.32.0.6
	OPENBSD_5_8_BASE:1.32
	OPENBSD_5_7:1.32.0.2
	OPENBSD_5_7_BASE:1.32
	OPENBSD_5_6:1.30.0.6
	OPENBSD_5_6_BASE:1.30
	OPENBSD_5_5:1.30.0.4
	OPENBSD_5_5_BASE:1.30
	OPENBSD_5_4:1.30.0.2
	OPENBSD_5_4_BASE:1.30
	OPENBSD_5_3:1.29.0.2
	OPENBSD_5_3_BASE:1.29
	OPENBSD_5_2:1.20.0.8
	OPENBSD_5_2_BASE:1.20
	OPENBSD_5_1_BASE:1.20
	OPENBSD_5_1:1.20.0.6
	OPENBSD_5_0:1.20.0.4
	OPENBSD_5_0_BASE:1.20
	OPENBSD_4_9:1.20.0.2
	OPENBSD_4_9_BASE:1.20
	OPENBSD_4_8:1.18.0.6
	OPENBSD_4_8_BASE:1.18
	OPENBSD_4_7:1.18.0.4
	OPENBSD_4_7_BASE:1.18
	OPENBSD_4_6:1.18.0.2
	OPENBSD_4_6_BASE:1.18
	OPENBSD_4_5:1.15.0.4
	OPENBSD_4_5_BASE:1.15
	OPENBSD_4_4:1.15.0.2
	OPENBSD_4_4_BASE:1.15
	OPENBSD_4_3:1.14.0.2
	OPENBSD_4_3_BASE:1.14
	OPENBSD_4_2:1.13.0.4
	OPENBSD_4_2_BASE:1.13
	OPENBSD_4_1:1.13.0.2
	OPENBSD_4_1_BASE:1.13
	OPENBSD_4_0:1.12.0.2
	OPENBSD_4_0_BASE:1.12
	OPENBSD_3_9:1.11.0.2
	OPENBSD_3_9_BASE:1.11
	OPENBSD_3_8:1.8.0.2
	OPENBSD_3_8_BASE:1.8
	OPENBSD_3_7:1.5.0.2
	OPENBSD_3_7_BASE:1.5
	OPENBSD_3_6:1.4.0.2
	OPENBSD_3_6_BASE:1.4
	avsm_2004-Jun-20:1.1.1.1
	avsm:1.1.1;
locks; strict;
comment	@# @;


1.34
date	2017.03.03.20.26.41;	author jca;	state Exp;
branches;
next	1.33;
commitid	4XBuHil277ruhYcF;

1.33
date	2016.03.22.19.17.30;	author mmcc;	state Exp;
branches;
next	1.32;
commitid	kWnNdb4uPuXUtWRw;

1.32
date	2014.09.07.16.14.43;	author chrisz;	state Exp;
branches;
next	1.31;
commitid	Y4WKNz3i3A7AX74W;

1.31
date	2014.08.22.22.49.07;	author kili;	state Exp;
branches;
next	1.30;
commitid	EuOaFLY1ck9pjbE0;

1.30
date	2013.03.11.10.50.02;	author espie;	state Exp;
branches;
next	1.29;

1.29
date	2013.01.02.09.12.57;	author ajacoutot;	state Exp;
branches;
next	1.28;

1.28
date	2013.01.02.08.34.32;	author ajacoutot;	state Exp;
branches;
next	1.27;

1.27
date	2012.12.04.06.54.25;	author chrisz;	state Exp;
branches;
next	1.26;

1.26
date	2012.11.30.19.08.05;	author chrisz;	state Exp;
branches;
next	1.25;

1.25
date	2012.11.27.22.28.53;	author chrisz;	state Exp;
branches;
next	1.24;

1.24
date	2012.11.25.23.46.36;	author sthen;	state Exp;
branches;
next	1.23;

1.23
date	2012.09.30.09.16.36;	author sthen;	state Exp;
branches;
next	1.22;

1.22
date	2012.08.26.20.17.42;	author avsm;	state Exp;
branches;
next	1.21;

1.21
date	2012.08.18.22.00.56;	author avsm;	state Exp;
branches;
next	1.20;

1.20
date	2010.12.07.14.57.19;	author dcoppa;	state Exp;
branches;
next	1.19;

1.19
date	2010.11.12.17.17.27;	author dcoppa;	state Exp;
branches;
next	1.18;

1.18
date	2009.06.20.22.05.11;	author avsm;	state Exp;
branches;
next	1.17;

1.17
date	2009.04.03.21.30.50;	author sturm;	state Exp;
branches;
next	1.16;

1.16
date	2009.03.11.21.20.27;	author avsm;	state Exp;
branches;
next	1.15;

1.15
date	2008.05.19.07.43.42;	author bernd;	state Exp;
branches;
next	1.14;

1.14
date	2007.09.16.02.52.58;	author merdely;	state Exp;
branches;
next	1.13;

1.13
date	2006.12.26.22.39.31;	author avsm;	state Exp;
branches;
next	1.12;

1.12
date	2006.05.28.15.44.14;	author avsm;	state Exp;
branches;
next	1.11;

1.11
date	2005.10.18.19.09.46;	author espie;	state Exp;
branches;
next	1.10;

1.10
date	2005.10.16.15.52.31;	author avsm;	state Exp;
branches;
next	1.9;

1.9
date	2005.09.22.12.53.15;	author avsm;	state Exp;
branches;
next	1.8;

1.8
date	2005.05.27.21.46.23;	author avsm;	state Exp;
branches;
next	1.7;

1.7
date	2005.05.27.06.31.52;	author avsm;	state Exp;
branches;
next	1.6;

1.6
date	2005.05.09.13.52.38;	author avsm;	state Exp;
branches;
next	1.5;

1.5
date	2004.11.23.11.22.01;	author espie;	state Exp;
branches;
next	1.4;

1.4
date	2004.08.10.20.41.47;	author xsa;	state Exp;
branches;
next	1.3;

1.3
date	2004.06.22.20.57.25;	author avsm;	state Exp;
branches;
next	1.2;

1.2
date	2004.06.21.18.53.12;	author avsm;	state Exp;
branches;
next	1.1;

1.1
date	2004.06.20.16.08.28;	author avsm;	state Exp;
branches
	1.1.1.1;
next	;

1.1.1.1
date	2004.06.20.16.08.28;	author avsm;	state Exp;
branches;
next	;


desc
@@


1.34
log
@Honour CC
@
text
@# $OpenBSD: Makefile,v 1.33 2016/03/22 19:17:30 mmcc Exp $

# build system needs per-arch tweaks and is very unfriendly to
# bytecode-only builds. powerpc nativecode is currently broken.
ONLY_FOR_ARCHS = amd64 i386

COMMENT=	framework for analysis and transformation of C
CATEGORIES =	devel lang

DISTNAME =	cil-1.5.1
REVISION =      6
EXTRACT_SUFX =	.tar.gz
MASTER_SITES =	${MASTER_SITE_SOURCEFORGE:=cil/}

HOMEPAGE=	https://cil-project.github.io/cil/

# BSD license
PERMIT_PACKAGE_CDROM=	Yes

WANTLIB=		c curses m pthread

MODULES =		lang/ocaml
BUILD_DEPENDS=		sysutils/findlib

CONFIGURE_STYLE =	autoconf no-autoheader
AUTOCONF_VERSION =	2.69
USE_GMAKE =		yes
ALL_TARGET =		setup
TEST_TARGET =	check

OURFILES =		kerneltrace.ml nullint.ml randomvars.ml
CONFIGURE_ARGS =	EXTRAFEATURES="${OURFILES:R}"
P5SITE =		libdata/perl5/site_perl
P5INST =		${PREFIX}/${P5SITE}
SUBST_VARS +=		P5SITE
GCC =			/usr/bin/gcc# cant use CC in case it's set to cilly

MAKE_FLAGS =		CC="${CC}"

.include <bsd.port.arch.mk>
.if ${MACHINE_ARCH} == powerpc
PKG_ARGS += -Dtarget=ppc_OPENBSD
.else
# used for amd64 and i386
PKG_ARGS += -Dtarget=x86_OPENBSD
.endif

post-extract:
	cp ${FILESDIR}/*.ml ${WRKSRC}/src/ext

post-install:
	${INSTALL_SCRIPT} ${WRKBUILD}/bin/cilly ${PREFIX}/bin
	${INSTALL_SCRIPT} ${WRKBUILD}/bin/patcher ${PREFIX}/bin
	${INSTALL_DATA_DIR} ${PREFIX}/libexec/cil
	${INSTALL_PROGRAM} \
		${WRKBUILD}/obj/*_OPENBSD/machdep-ml.exe \
		${PREFIX}/libexec/cil
	${INSTALL_DATA_DIR} ${P5INST}/CIL
	mv ${PREFIX}/lib/*.pm ${P5INST}/CIL/
	sed -e 's,@@CILLIBDIR@@,${LOCALBASE}/${P5SITE}/CIL,g' \
	    ${P5INST}/CIL/CilConfig.pm > ${P5INST}/CilConfig.pm

.include <bsd.port.mk>
@


1.33
log
@replace broken HOMEPAGE

from Daniel Jakots
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.32 2014/09/07 16:14:43 chrisz Exp $
d37 2
@


1.32
log
@no support for bytecode, therefore don't try building on powerpc
for the time being.
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.31 2014/08/22 22:49:07 kili Exp $
d11 1
a11 1
REVISION =      5
d15 1
a15 1
HOMEPAGE=	http://kerneis.github.com/cil/
@


1.31
log
@More bumps due to lang/ocaml pkgname change.
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.30 2013/03/11 10:50:02 espie Exp $
d3 3
a5 2
# build system needs per-arch tweaks
ONLY_FOR_ARCHS = amd64 i386 powerpc
@


1.30
log
@PERMIT_* / REGRESS->TEST sweep
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.29 2013/01/02 09:12:57 ajacoutot Exp $
d10 1
a10 1
REVISION =      4
@


1.29
log
@ARCH -> MACHINE_ARCH to unbreak.
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.28 2013/01/02 08:34:32 ajacoutot Exp $
a17 3
PERMIT_PACKAGE_FTP=	Yes
PERMIT_DISTFILES_CDROM=	Yes
PERMIT_DISTFILES_FTP=	Yes
d28 1
a28 1
REGRESS_TARGET =	check
@


1.28
log
@This is BROKEN on powerpc.
/usr/local/libexec/cil/obj/x86_OPENBSD/cilly.asm.exe does not exist
/usr/local/libexec/cil/obj/x86_OPENBSD/cilly.byte.exe does not exist
@
text
@d1 1
a1 3
# $OpenBSD: Makefile,v 1.27 2012/12/04 06:54:25 chrisz Exp $

BROKEN-powerpc = x86_OPENBSD/cilly.asm.exe does not exist
d41 1
a41 1
.if ${ARCH} == powerpc
@


1.27
log
@update HOMEPAGE

ok by @@jasper and @@avsm
@
text
@d1 3
a3 1
# $OpenBSD: Makefile,v 1.26 2012/11/30 19:08:05 chrisz Exp $
@


1.26
log
@Update lang/ocaml to 4.00.1.
Make all ocaml ports depend on the version of ocaml they were built with.
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.25 2012/11/27 22:28:53 chrisz Exp $
d10 1
a10 1
REVISION =      3
d14 1
a14 1
HOMEPAGE=	http://www.eecs.berkeley.edu/~necula/cil/
@


1.25
log
@unbreak for i386, amd64 and powerpc.

OK sthen@@, jasper@@

bsd.port.arch.mk is now needed again for .if ${ARCH} == ...
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.24 2012/11/25 23:46:36 sthen Exp $
d10 1
a10 1
REVISION =      2
@


1.24
log
@mark this as BROKEN for now; ok aja@@
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.23 2012/09/30 09:16:36 sthen Exp $
d3 2
a4 4
BROKEN = amd64: cilly fails at runtime (bad paths). !amd64: packaging broken.

# until tested on others, even though bytecode is produced
ONLY_FOR_ARCHS =	${OCAML_NATIVE_ARCHS}
d10 1
a10 1
REVISION =      1
d21 1
d38 9
a46 1
GCC =			/usr/bin/gcc  # cant use CC in case it's set to cilly
d56 1
a56 1
		${WRKBUILD}/obj/x86_LINUX/machdep-ml*.exe \
d60 2
a61 7
	sed -e 's,@@CILHOME@@,${LOCALBASE},g' \
	     -e 's,@@CILLIBDIR@@,${LOCALBASE}/${P5SITE}/CIL,g' \
	     -e 's,@@ARCHOS@@,libexec/cil,g' \
             -e 's,@@DEFAULT_CIL_MODE@@,GNUCC,g' \
	     -e 's,@@CC@@,${GCC},g' < \
	    ${WRKSRC}/bin/CilConfig.pm.in > ${P5INST}/CilConfig.pm

@


1.23
log
@don't .include <bsd.port.arch.mk> just to get definitions from arch-defines
@
text
@d1 3
a3 1
# $OpenBSD: Makefile,v 1.22 2012/08/26 20:17:42 avsm Exp $
@


1.22
log
@cil: add a missing BUILD_DEPENDS on findlib, bump REVISION
noticed by naddy@@
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.21 2012/08/18 22:00:56 avsm Exp $
a3 1
.include <bsd.port.arch.mk>
@


1.21
log
@update to cil-1.5.1
* BROKEN on all non-native archs for now
* new MASTER_SITE
* clean up Makefile
* remove obsolete patch
* update PLIST
From: Christopher Zimmermann <madroach@@gmerlin.de>
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.20 2010/12/07 14:57:19 dcoppa Exp $
d11 1
d25 1
@


1.20
log
@Fix build with upcoming ocaml update.

OK landry@@
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.19 2010/11/12 17:17:27 dcoppa Exp $
d4 2
a5 1
ONLY_FOR_ARCHS=	i386 amd64 powerpc
d8 5
a13 3
DISTNAME=	cil-1.3.6
REVISION=	3
CATEGORIES=	devel lang
a14 1
MASTER_SITES=	${HOMEPAGE}/distrib/
d23 1
a23 4
MODULES=	lang/ocaml
WRKDIST=	${WRKDIR}/cil

OURFILES=	nullint kerneltrace randomvars
d25 12
a36 9
CONFIGURE_STYLE= autoconf no-autoheader
AUTOCONF_VERSION= 2.61
USE_GMAKE= yes
ALL_TARGET= setup
CONFIGURE_ARGS= EXTRAFEATURES="${OURFILES}"
P5SITE= libdata/perl5/site_perl
P5INST= ${PREFIX}/${P5SITE}
SUBST_VARS+= P5SITE
GCC=/usr/bin/gcc  # cant use CC in case it's set to cilly
d39 1
a39 3
.for i in ${OURFILES}
	@@cp ${FILESDIR}/$i.ml ${WRKSRC}/src/ext
.endfor
d41 3
a43 1
pre-install:
d45 3
d49 1
a49 2

post-install:
a56 10
	${INSTALL_SCRIPT} ${WRKBUILD}/bin/cilly ${PREFIX}/bin
	${INSTALL_SCRIPT} ${WRKBUILD}/bin/patcher ${PREFIX}/bin

.for i in Cilly KeptFile OutputFile TempFile
	${INSTALL_DATA} ${WRKSRC}/lib/${i}.pm ${P5INST}/CIL
.endfor

.for i in machdep.exe cilly.byte.exe cilly.asm.exe
	${INSTALL_PROGRAM} ${WRKBUILD}/obj/x86_LINUX/${i} ${PREFIX}/libexec/cil
.endfor
@


1.19
log
@
HOMEPAGE has been changed long ago.
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.18 2009/06/20 22:05:11 avsm Exp $
d9 1
a9 1
REVISION=	2
a12 2

MAINTAINER=	Anil Madhavapeddy <avsm@@openbsd.org>
@


1.18
log
@update to ocaml-3.11.1 and bump dependent package PKGNAMEs
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.17 2009/04/03 21:30:50 sturm Exp $
d9 1
a9 1
PKGNAME=	${DISTNAME}p1
d11 2
a12 1
MASTER_SITES=	http://manju.cs.berkeley.edu/cil/distrib/
a13 1
HOMEPAGE=	http://manju.cs.berkeley.edu/cil/
@


1.17
log
@bump after ocaml update
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.16 2009/03/11 21:20:27 avsm Exp $
d9 1
a9 1
PKGNAME=	${DISTNAME}p0
@


1.16
log
@update to cil-1.3.6
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.15 2008/05/19 07:43:42 bernd Exp $
d9 1
@


1.15
log
@Build on powerpc and not just macppc now that we have socppc.

from brad@@
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.14 2007/09/16 02:52:58 merdely Exp $
d8 1
a8 2
DISTNAME=	cil-1.3.5
PKGNAME=	${DISTNAME}p0
d27 2
a28 2
CONFIGURE_STYLE= autoconf
AUTOCONF_VERSION= 2.52
@


1.14
log
@Remove quotes surrounding COMMENT*/PERMIT_*/BROKEN
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.13 2006/12/26 22:39:31 avsm Exp $
d4 1
a4 1
ONLY_FOR_ARCHS=	i386 amd64 macppc
@


1.13
log
@bump PKGNAME on ocaml ports for recent ocaml-3.09.3 dependency change
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.12 2006/05/28 15:44:14 avsm Exp $
d6 1
a6 1
COMMENT=	"framework for analysis and transformation of C"
@


1.12
log
@update to cil-1.3.5, lots of nice fixes to parsing gcc/msvc code
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.11 2005/10/18 19:09:46 espie Exp $
d9 1
a9 1
PKGNAME=	${DISTNAME}
@


1.11
log
@needless use of pre-fake
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.10 2005/10/16 15:52:31 avsm Exp $
d8 2
a9 2
DISTNAME=	cil-1.3.3
PKGNAME=	${DISTNAME}p0
d26 2
d32 1
a37 2
OURFILES=	nullint kerneltrace randomvars

d48 2
a49 2
	sed -e 's,@@CILHOME@@/lib,${LOCALBASE}/${P5SITE}/CIL,g' \
	     -e 's,@@CILHOME@@,${LOCALBASE},g' \
d55 2
a56 2
	${INSTALL_PROGRAM} ${WRKBUILD}/bin/cilly ${PREFIX}/bin
	${INSTALL_PROGRAM} ${WRKBUILD}/bin/patcher ${PREFIX}/bin
@


1.10
log
@- remove patch that is duplicated in distro
- trim configure patch for dup
- bump PKGNAME
From <andreas@@zzlevo.net>
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.9 2005/09/22 12:53:15 avsm Exp $
d42 1
a42 1
pre-fake:
@


1.9
log
@update to cil-1.3.3
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.8 2005/05/27 21:46:23 avsm Exp $
d9 1
@


1.8
log
@Add in a --dorandomvars which sets local variables to values other than
0 to try and find bugs which depend on them being initalized to 0.

Also turn off the other transformations by default (use --dokerneltrace
or --donullint)

Go get em Chad.
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.7 2005/05/27 06:31:52 avsm Exp $
d8 1
a8 1
DISTNAME=	cil-1.3.2
@


1.7
log
@Add a 'kernel function call tracer' to automatically insert a call to
log() to certain functions in the kernel to help debugging.

An example use when building a kernel would be:
$ make CC='/usr/local/bin/cilly --trace-regexp=^cache_ --trace-level=0'
to instrument all functions starting with cache_* to notify syslog at
emergency log level.  The output also includes the contents of any
char/int/long arguments (pointers and structs not followed yet, too
verbose).

A full kernel build doesnt quite work with CIL yet so use selectively.
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.6 2005/05/09 13:52:38 avsm Exp $
d34 2
d37 3
a39 2
	@@cp ${FILESDIR}/nullint.ml ${WRKSRC}/src/ext
	@@cp ${FILESDIR}/kerneltrace.ml ${WRKSRC}/src/ext
@


1.6
log
@update to cil-1.3.2
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.5 2004/11/23 11:22:01 espie Exp $
d36 1
@


1.5
log
@WANTLIB markers
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.4 2004/08/10 20:41:47 xsa Exp $
d8 1
a8 1
DISTNAME=	cil-1.2.5
d45 1
@


1.4
log
@
more new-style MODULES.
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.3 2004/06/22 20:57:25 avsm Exp $
d20 1
@


1.3
log
@CIL also works on macppc now, hurrah
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.2 2004/06/21 18:53:12 avsm Exp $
d21 1
a21 1
MODULES=	ocaml
@


1.2
log
@add a simple NULL/int comparison checker to CIL
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.1.1.1 2004/06/20 16:08:28 avsm Exp $
d4 1
a4 1
ONLY_FOR_ARCHS=	i386 amd64
@


1.1
log
@Initial revision
@
text
@d1 1
a1 1
# $OpenBSD$
d32 3
@


1.1.1.1
log
@initial import of cil-1.2.5
--
CIL (C Intermediate Language) is a high-level representation along
with a set of tools that permit easy analysis and source-to-source
transformation of C programs.

CIL is both lower-level than abstract-syntax trees, by clarifying
ambiguous constructs and removing redundant ones, and also higher-level
than typical intermediate languages designed for compilation, by
maintaining types and a close relationship with the source program.
The main advantage of CIL is that it compiles all valid C programs
into a few core constructs with a very clean semantics. Also CIL
has a syntax-directed type system that makes it easy to analyze and
manipulate C programs. Furthermore, the CIL front-end is able to
process not only ANSI-C programs but also those using Microsoft C
or GNU C extensions.

@
text
@@
