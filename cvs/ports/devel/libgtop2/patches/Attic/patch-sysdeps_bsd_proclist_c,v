head	1.2;
access;
symbols
	OPENBSD_4_9:1.1.0.14
	OPENBSD_4_9_BASE:1.1
	OPENBSD_4_8:1.1.0.12
	OPENBSD_4_8_BASE:1.1
	OPENBSD_4_7:1.1.0.10
	OPENBSD_4_7_BASE:1.1
	OPENBSD_4_6:1.1.0.8
	OPENBSD_4_6_BASE:1.1
	OPENBSD_4_5:1.1.0.6
	OPENBSD_4_5_BASE:1.1
	OPENBSD_4_4:1.1.0.4
	OPENBSD_4_4_BASE:1.1
	OPENBSD_4_3:1.1.0.2
	OPENBSD_4_3_BASE:1.1;
locks; strict;
comment	@# @;


1.2
date	2011.05.23.18.09.10;	author jasper;	state dead;
branches;
next	1.1;

1.1
date	2008.02.09.16.52.25;	author ajacoutot;	state Exp;
branches;
next	;


desc
@@


1.2
log
@the openbsd code has diverged too much from the freebsd and generic bsd code
to be easily maintainable. so instead move it to files/ for now untill it
gets incorporated upstream.

discussed with aja@@
@
text
@$OpenBSD: patch-sysdeps_bsd_proclist_c,v 1.1 2008/02/09 16:52:25 ajacoutot Exp $
--- sysdeps/bsd/proclist.c.orig	Fri Dec 28 19:03:21 2007
+++ sysdeps/bsd/proclist.c	Fri Dec 28 19:16:25 2007
@@@@ -56,11 +56,15 @@@@ _glibtop_init_proclist_p (glibtop *server)
 	server->sysdeps.proclist = _glibtop_sysdeps_proclist;
 }
 
-unsigned *
+pid_t *
 glibtop_get_proclist_p (glibtop *server, glibtop_proclist *buf,
 			gint64 real_which, gint64 arg)
 {
+#if defined(__OpenBSD__)
+	struct kinfo_proc2 *pinfo;
+#else
 	struct kinfo_proc *pinfo;
+#endif
 	unsigned *pids = NULL;
 	int which, count;
 	int i,j;
@@@@ -72,7 +76,12 @@@@ glibtop_get_proclist_p (glibtop *server, glibtop_procl
 	which = (int)(real_which & GLIBTOP_KERN_PROC_MASK);
 
 	/* Get the process data */
-	pinfo = kvm_getprocs (server->machine.kd, which, arg, &count);
+#if defined(__OpenBSD__)
+	pinfo = kvm_getproc2 (server->machine.kd, which, arg,
+			      sizeof (*pinfo), &count);
+#else
+ 	pinfo = kvm_getprocs (server->machine.kd, which, arg, &count);
+#endif
 	if ((pinfo == NULL) || (count < 1)) {
 		glibtop_warn_io_r (server, "kvm_getprocs (proclist)");
 		return NULL;
@@@@ -88,6 +97,12 @@@@ glibtop_get_proclist_p (glibtop *server, glibtop_procl
 #define PROC_STAT	ki_stat
 #define PROC_RUID	ki_ruid
 #define PROC_PID	ki_pid
+
+#elif defined(__OpenBSD__)
+
+#define PROC_STAT	p_stat
+#define PROC_RUID	p_ruid
+#define PROC_PID	p_pid
 
 #else
 #define PROC_STAT	kp_proc.p_stat
@


1.1
log
@- update to 2.20.1
Note that it does not work better than previous in-tree version but it
will give us a better base to fix it.

joint work with jasper@@
most patches adapted from NetBSD
fsusage patch from naddy@@

ok jasper@@
@
text
@d1 1
a1 1
$OpenBSD$
@

