head	1.5;
access;
symbols
	OPENBSD_5_5:1.4.0.2
	OPENBSD_5_5_BASE:1.4
	OPENBSD_5_4:1.2.0.8
	OPENBSD_5_4_BASE:1.2
	OPENBSD_5_3:1.2.0.6
	OPENBSD_5_3_BASE:1.2
	OPENBSD_5_2:1.2.0.4
	OPENBSD_5_2_BASE:1.2
	OPENBSD_5_1_BASE:1.2
	OPENBSD_5_1:1.2.0.2
	OPENBSD_5_0:1.1.0.8
	OPENBSD_5_0_BASE:1.1
	OPENBSD_4_9:1.1.0.6
	OPENBSD_4_9_BASE:1.1
	OPENBSD_4_8:1.1.0.4
	OPENBSD_4_8_BASE:1.1
	OPENBSD_4_7:1.1.0.2
	OPENBSD_4_7_BASE:1.1;
locks; strict;
comment	@# @;


1.5
date	2014.04.29.06.27.57;	author jasper;	state dead;
branches;
next	1.4;

1.4
date	2014.02.03.13.50.32;	author ajacoutot;	state Exp;
branches;
next	1.3;

1.3
date	2014.02.01.18.11.43;	author ajacoutot;	state Exp;
branches;
next	1.2;

1.2
date	2011.09.18.11.24.59;	author jasper;	state Exp;
branches;
next	1.1;

1.1
date	2009.11.02.20.19.06;	author jasper;	state Exp;
branches;
next	;


desc
@@


1.5
log
@update to libgtop-2.30.0
@
text
@$OpenBSD: patch-sysdeps_common_mountlist_c,v 1.4 2014/02/03 13:50:32 ajacoutot Exp $

RM at next release.

--- sysdeps/common/mountlist.c.orig	Sat Jul 27 14:40:23 2013
+++ sysdeps/common/mountlist.c	Sat Feb  1 18:39:20 2014
@@@@ -52,7 +52,9 @@@@ static struct mount_entry *read_filesystem_list (void)
 
 #if defined (MOUNTED_GETFSSTAT)	/* __alpha running OSF_1 */
 #  include <sys/mount.h>
-#  include <sys/fs_types.h>
+#  if defined(HAVE_SYS_FSTYP_H)
+#    include <sys/fs_types.h>
+#  endif /* HAVE_SYS_FSTYP_H */
 #endif /* MOUNTED_GETFSSTAT */
 
 #ifdef MOUNTED_GETMNTENT1	/* 4.3BSD, SunOS, HP-UX, Dynix, Irix.  */
@@@@ -298,7 +300,11 @@@@ read_filesystem_list (void)
 
 #ifdef MOUNTED_GETMNTINFO	/* 4.4BSD.  */
   {
+#if defined(STAT_STATVFS)
+    struct statvfs *fsp;
+#else
     struct statfs *fsp;
+#endif /* STAT_STATVFS */
     int entries;
 
     entries = getmntinfo (&fsp, MNT_NOWAIT);
@@@@ -374,7 +380,12 @@@@ read_filesystem_list (void)
 	me = (struct mount_entry *) g_malloc (sizeof (struct mount_entry));
 	me->me_devname = g_strdup (stats[counter].f_mntfromname);
 	me->me_mountdir = g_strdup (stats[counter].f_mntonname);
+/* XXX */
+#if defined(__OpenBSD__)
+	me->me_type = g_strdup (stats[counter].f_fstypename);
+#else
 	me->me_type = g_strdup (mnt_names[stats[counter].f_type]);
+#endif
 	me->me_dev = (dev_t) -1;	/* Magic; means not known yet. */
 	me->me_next = NULL;
 
@


1.4
log
@Explicitely mark all files that can be removed when the next release is out.
@
text
@d1 1
a1 1
$OpenBSD: patch-sysdeps_common_mountlist_c,v 1.3 2014/02/01 18:11:43 ajacoutot Exp $
@


1.3
log
@Better handling of p_wchan and drop useless mfs chunk.
@
text
@d1 4
a4 1
$OpenBSD: patch-sysdeps_common_mountlist_c,v 1.2 2011/09/18 11:24:59 jasper Exp $
@


1.2
log
@allow monitoring mfs partitions too
@
text
@d1 3
a3 3
$OpenBSD: patch-sysdeps_common_mountlist_c,v 1.1 2009/11/02 20:19:06 jasper Exp $
--- sysdeps/common/mountlist.c.orig	Wed Jun  1 17:40:47 2011
+++ sysdeps/common/mountlist.c	Sun Sep 18 13:22:28 2011
a39 10
@@@@ -545,7 +556,9 @@@@ static gboolean ignore_mount_entry(const struct mount_
 		"devpts",
 		"fusectl",
 		"linprocfs",
+#ifndef __OpenBSD__
 		"mfs",
+#endif
 		"mntfs",
 		"mqueue",
 		"none",
@


1.1
log
@- fix a check in configure and first stab at working mountlist.
@
text
@d1 3
a3 3
$OpenBSD$
--- sysdeps/common/mountlist.c.orig	Thu Oct 29 00:26:32 2009
+++ sysdeps/common/mountlist.c	Thu Oct 29 00:50:16 2009
d40 10
@

