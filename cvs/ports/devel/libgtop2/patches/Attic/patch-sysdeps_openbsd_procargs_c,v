head	1.12;
access;
symbols
	OPENBSD_5_9:1.11.0.2
	OPENBSD_5_9_BASE:1.11
	OPENBSD_5_5:1.9.0.2
	OPENBSD_5_5_BASE:1.9
	OPENBSD_5_4:1.6.0.8
	OPENBSD_5_4_BASE:1.6
	OPENBSD_5_3:1.6.0.6
	OPENBSD_5_3_BASE:1.6
	OPENBSD_5_2:1.6.0.4
	OPENBSD_5_2_BASE:1.6
	OPENBSD_5_1_BASE:1.6
	OPENBSD_5_1:1.6.0.2;
locks; strict;
comment	@# @;


1.12
date	2016.04.20.06.20.38;	author jasper;	state dead;
branches;
next	1.11;
commitid	t93j0n2r5bzxZbbK;

1.11
date	2016.01.12.16.38.29;	author ajacoutot;	state Exp;
branches;
next	1.10;
commitid	DGHaDj6t1ZCXgkak;

1.10
date	2014.04.29.06.27.57;	author jasper;	state dead;
branches;
next	1.9;

1.9
date	2014.02.08.10.58.20;	author ajacoutot;	state Exp;
branches;
next	1.8;

1.8
date	2014.02.08.10.55.31;	author ajacoutot;	state Exp;
branches;
next	1.7;

1.7
date	2013.08.26.08.43.15;	author ajacoutot;	state dead;
branches;
next	1.6;

1.6
date	2012.01.22.11.55.10;	author ajacoutot;	state Exp;
branches;
next	1.5;

1.5
date	2012.01.09.17.39.19;	author ajacoutot;	state Exp;
branches;
next	1.4;

1.4
date	2012.01.09.17.22.15;	author robert;	state Exp;
branches;
next	1.3;

1.3
date	2012.01.09.16.45.20;	author robert;	state Exp;
branches;
next	1.2;

1.2
date	2011.09.18.11.46.16;	author jasper;	state Exp;
branches;
next	1.1;

1.1
date	2011.09.17.17.43.44;	author jasper;	state Exp;
branches;
next	;


desc
@@


1.12
log
@update to libgtop-2.34.0
@
text
@$OpenBSD: patch-sysdeps_openbsd_procargs_c,v 1.11 2016/01/12 16:38:29 ajacoutot Exp $

From de408a6bba216ebcbc47f902e4add54e8ad7008f Mon Sep 17 00:00:00 2001
From: Antoine Jacoutot <ajacoutot@@gnome.org>
Date: Tue, 12 Jan 2016 17:14:20 +0100
Subject: openbsd: only PID 1 is special (init)

--- sysdeps/openbsd/procargs.c.orig	Mon Aug 17 20:59:37 2015
+++ sysdeps/openbsd/procargs.c	Tue Jan 12 17:23:41 2016
@@@@ -56,11 +56,8 @@@@ glibtop_get_proc_args_p (glibtop *server, glibtop_proc
 
 	memset (buf, 0, sizeof (glibtop_proc_args));
 
-	/*
-	 * Don't bother with PIDs below 20, because everything below this
-	 * number is highly likely to be a kernel thread.
-	 */
-	if (pid < 19) return NULL;
+	/* Ignore init */
+	if (pid < 2) return NULL;
 
 	glibtop_suid_enter (server);
 
@


1.11
log
@openbsd: only PID 1 is special (upstream)
@
text
@d1 1
a1 1
$OpenBSD$
@


1.10
log
@update to libgtop-2.30.0
@
text
@d1 1
a1 1
$OpenBSD: patch-sysdeps_openbsd_procargs_c,v 1.9 2014/02/08 10:58:20 ajacoutot Exp $
d3 4
a6 1
RM at next release.
d8 16
a23 11
--- sysdeps/openbsd/procargs.c.orig	Sat Feb  8 11:23:14 2014
+++ sysdeps/openbsd/procargs.c	Sat Feb  8 11:25:28 2014
@@@@ -69,7 +69,7 @@@@ glibtop_get_proc_args_p (glibtop *server, glibtop_proc
 	/* Get the process data */
 	pinfo = kvm_getprocs (server->machine.kd, KERN_PROC_PID, pid,
 			       sizeof (*pinfo), &count);
-	if ((pinfo == NULL) || (count < 1)) {
+	if (pinfo == NULL) {
 		glibtop_suid_leave (server);
 		glibtop_warn_io_r (server, "kvm_getprocs (%d)", pid);
 		return NULL;
@


1.9
log
@Add comment to drop these patches when a new libgtop2 release is out.
@
text
@d1 1
a1 1
$OpenBSD: patch-sysdeps_openbsd_procargs_c,v 1.8 2014/02/08 10:55:31 ajacoutot Exp $
@


1.8
log
@Drop unecessary checks and bring glibtop_get_proc_segment from FreeBSD.
@
text
@d1 4
a4 1
$OpenBSD$
@


1.7
log
@Update to libgtop2-2.28.5.
No noticeable changes besides our patches being integrated upstream.
@
text
@d1 4
a4 37
$OpenBSD: patch-sysdeps_openbsd_procargs_c,v 1.6 2012/01/22 11:55:10 ajacoutot Exp $

From b11aa1517e203e36a8901f03ea57c50a25dfbfc7 Mon Sep 17 00:00:00 2001
From: Antoine Jacoutot <ajacoutot@@gnome.org>
Date: Sun, 22 Jan 2012 11:47:49 +0000
Subject: OpenBSD: kinfo_proc2 -> kinfo_proc

commit dd46d6a00e4af444d423383abbc538436a170e2b
Author: Jasper Lievisse Adriaanse <jasper@@humppa.nl>
Date:   Sun Sep 18 13:42:13 2011 +0200
Don't bother with PIDs below 20 as they are highly likely to be kernel threads anyway.

--- sysdeps/openbsd/procargs.c.orig	Sun Jul 24 21:13:56 2011
+++ sysdeps/openbsd/procargs.c	Mon Jan  9 18:37:24 2012
@@@@ -49,7 +49,7 @@@@ char *
 glibtop_get_proc_args_p (glibtop *server, glibtop_proc_args *buf,
 			 pid_t pid, unsigned max_len)
 {
-	struct kinfo_proc2 *pinfo;
+	struct kinfo_proc *pinfo;
 	char *retval, **args, **ptr;
 	size_t size = 0, pos = 0;
 	int count;
@@@@ -58,13 +58,16 @@@@ glibtop_get_proc_args_p (glibtop *server, glibtop_proc
 
 	memset (buf, 0, sizeof (glibtop_proc_args));
 
-	/* swapper, init, pagedaemon, vmdaemon, update - this doen't work. */
-	if (pid < 5) return NULL;
+	/*
+	 * Don't bother with PIDs below 20, because everything below this
+	 * number is highly likely to be a kernel thread.
+	 */
+	if (pid < 19) return NULL;
 
 	glibtop_suid_enter (server);
 
d6 1
a6 2
-	pinfo = kvm_getproc2 (server->machine.kd, KERN_PROC_PID, pid,
+	pinfo = kvm_getprocs (server->machine.kd, KERN_PROC_PID, pid,
d8 2
a9 1
 	if ((pinfo == NULL) || (count < 1)) {
d11 1
a11 1
@@@@ -72,7 +75,7 @@@@ glibtop_get_proc_args_p (glibtop *server, glibtop_proc
a12 7
 	}
 
-	args = kvm_getargv2 (server->machine.kd, pinfo, max_len);
+	args = kvm_getargv (server->machine.kd, pinfo, max_len);
 	if (args == NULL) {
 		glibtop_suid_leave (server);
 		glibtop_warn_io_r (server, "kvm_getargv (%d)", pid);
@


1.6
log
@Sync patches after upstream commit.
Remove bogus patch (indentical).

no pkg change
@
text
@d1 1
a1 1
$OpenBSD: patch-sysdeps_openbsd_procargs_c,v 1.5 2012/01/09 17:39:19 ajacoutot Exp $
@


1.5
log
@tsk tsk tsk.
@
text
@d1 6
a6 1
$OpenBSD: patch-sysdeps_openbsd_procargs_c,v 1.4 2012/01/09 17:22:15 robert Exp $
d11 1
a11 2

    Don't bother with PIDs below 20 as they are highly likely to be kernel threads anyway.
@


1.4
log
@s/kvm_getprocss/kvm_getprocs/g in unused code and warning messages
@
text
@d1 1
a1 1
$OpenBSD: patch-sysdeps_openbsd_procargs_c,v 1.3 2012/01/09 16:45:20 robert Exp $
d9 2
a10 2
--- sysdeps/openbsd/procargs.c.orig	Sun Jul 24 13:13:56 2011
+++ sysdeps/openbsd/procargs.c	Mon Jan  9 09:31:58 2012
d20 1
a20 1
@@@@ -58,21 +58,24 @@@@ glibtop_get_proc_args_p (glibtop *server, glibtop_proc
d40 1
a40 2
-		glibtop_warn_io_r (server, "kvm_getprocs (%d)", pid);
+		glibtop_warn_io_r (server, "kvm_getprocs (%d)", pid);
@


1.3
log
@fix after kinfo_proc2 removal
@
text
@d1 1
a1 1
$OpenBSD: patch-sysdeps_openbsd_procargs_c,v 1.2 2011/09/18 11:46:16 jasper Exp $
d41 1
a41 1
+		glibtop_warn_io_r (server, "kvm_getprocss (%d)", pid);
@


1.2
log
@sync, no functional change
@
text
@d1 1
a1 1
$OpenBSD: patch-sysdeps_openbsd_procargs_c,v 1.1 2011/09/17 17:43:44 jasper Exp $
d9 12
a20 3
--- sysdeps/openbsd/procargs.c.orig	Sat Sep 17 18:58:14 2011
+++ sysdeps/openbsd/procargs.c	Sat Sep 17 18:59:23 2011
@@@@ -58,8 +58,11 @@@@ glibtop_get_proc_args_p (glibtop *server, glibtop_proc
d34 16
@


1.1
log
@don't bother getting info from kernel threads
@
text
@d1 8
a8 1
$OpenBSD$
@

