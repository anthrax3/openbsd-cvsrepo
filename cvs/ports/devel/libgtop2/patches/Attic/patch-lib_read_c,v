head	1.5;
access;
symbols
	OPENBSD_4_0:1.4.0.6
	OPENBSD_4_0_BASE:1.4
	OPENBSD_3_9:1.4.0.4
	OPENBSD_3_9_BASE:1.4
	OPENBSD_3_8:1.4.0.2
	OPENBSD_3_8_BASE:1.4
	OPENBSD_3_7:1.3.0.2
	OPENBSD_3_7_BASE:1.3
	OPENBSD_3_6:1.1.0.2
	OPENBSD_3_6_BASE:1.1;
locks; strict;
comment	@# @;


1.5
date	2007.01.18.19.31.34;	author jasper;	state dead;
branches;
next	1.4;

1.4
date	2005.05.25.23.28.16;	author marcm;	state Exp;
branches;
next	1.3;

1.3
date	2004.12.11.17.41.53;	author marcm;	state Exp;
branches;
next	1.2;

1.2
date	2004.12.10.20.33.59;	author marcm;	state Exp;
branches;
next	1.1;

1.1
date	2004.08.01.06.06.35;	author marcm;	state Exp;
branches;
next	;


desc
@@


1.5
log
@update libgtop2 to 2.14.6

based on work by Alexander Wirt <alexander.wirt@@credativ.de>

ok ajacoutot@@
@
text
@$OpenBSD: patch-lib_read_c,v 1.4 2005/05/25 23:28:16 marcm Exp $
--- lib/read.c.orig	Tue Feb 15 04:48:33 2005
+++ lib/read.c	Mon Apr 11 19:56:33 2005
@@@@ -22,6 +22,7 @@@@
 */
 
 #include <config.h>
+#include <errno.h>
 #include <glibtop/read.h>
 #include <glibtop/error.h>
 #include "libgtop-i18n.h"
@@@@ -56,14 +57,18 @@@@ glibtop_read_l (glibtop *server, size_t 
 	fprintf (stderr, "LIBRARY: really reading %d bytes.\n", size);
 #endif
 
+retry:
 	if (server->socket) {
 		do_read (server->socket, buf, size);
 	} else {
-		if(read (server->input [0], buf, size) < 0)
+		if(read (server->input [0], buf, size) < 0) {
+			if (errno == EINTR)
+				goto retry;
 			glibtop_error_io_r (
 				server,
 				ngettext ("read %d byte",
 					  "read %d bytes", size),
 				size);
+		}
 	}
 }
@


1.4
log
@Up to 2.10.1 for Gnome 2.10.1.
@
text
@d1 1
a1 1
$OpenBSD: patch-lib_read_c,v 1.3 2004/12/11 17:41:53 marcm Exp $
@


1.3
log
@CVS wasn't kind to this commit :).  Remove the zero length patches,
fix another patch that was lost in the update, oh and what the heck
update the version again.
@
text
@d1 3
a3 3
$OpenBSD: patch-lib_read_c,v 1.1 2004/08/01 06:06:35 marcm Exp $
--- lib/read.c.orig	Sun Oct 10 10:21:57 2004
+++ lib/read.c	Fri Dec 10 17:04:00 2004
d10 1
d12 1
a12 2
 
@@@@ -55,14 +56,18 @@@@ glibtop_read_l (glibtop *server, size_t 
@


1.2
log
@Update the supporting Gnome ports to their Gnome 2.8 versions.

ORBit2      2.10.2 -> 2.12.0
atk          1.6.1 -> 1.8.0
gconf-editor 2.6.2 -> 2.8.2
gconf2       2.6.2 -> 2.8.1
libIDL       0.8.3 -> 0.8.4
libgsf      1.10.0 -> 1.11.1
libgtop2     2.6.0 -> 2.8.1
libwnck      2.6.2 -> 2.8.1
pango        1.4.1 -> 1.6.0
startup-notification 0.5 -> 0.7

Real work done by Francois Briere.
@
text
@d1 31
@


1.1
log
@Update to 2.6.0.  Get rid of the custom OpenBSD support from the
former nino@@ that has been a part of this port for some time.
Updates to the internal API finally broke it, but a huge thanks
to Nils for his work there (thanks Nils!).

Now we use the Free/NetBSD support as a base and patch from there :).
@
text
@a0 29
$OpenBSD$
--- lib/read.c.orig	Thu Mar  4 07:29:12 2004
+++ lib/read.c	Sat Jul 31 13:01:08 2004
@@@@ -22,6 +22,7 @@@@
 */
 
 #include <config.h>
+#include <errno.h>
 #include <glibtop/read.h>
 #include "libgtop-i18n.h"
 
@@@@ -68,12 +69,16 @@@@ glibtop_read_l (glibtop *server, size_t 
 	fprintf (stderr, "LIBRARY: really reading %d bytes.\n", size);
 #endif
 
+retry:
 	if (server->socket) {
 		do_read (server->socket, buf, size);
 	} else {
 		ret = read (server->input [0], buf, size);
 	}
 
-	if (ret < 0)
+	if (ret < 0) {
+		if (errno == EINTR)
+			goto retry;
 		glibtop_error_io_r (server, ngettext ("read %d byte", "read %d bytes", size), size);
+	}
 }
@

