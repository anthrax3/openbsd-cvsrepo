head	1.12;
access;
symbols
	OPENBSD_6_1:1.12.0.4
	OPENBSD_6_1_BASE:1.12
	OPENBSD_6_0:1.12.0.2
	OPENBSD_6_0_BASE:1.12
	OPENBSD_5_9:1.11.0.20
	OPENBSD_5_9_BASE:1.11
	OPENBSD_5_8:1.11.0.22
	OPENBSD_5_8_BASE:1.11
	OPENBSD_5_7:1.11.0.18
	OPENBSD_5_7_BASE:1.11
	OPENBSD_5_6:1.11.0.16
	OPENBSD_5_6_BASE:1.11
	OPENBSD_5_5:1.11.0.14
	OPENBSD_5_5_BASE:1.11
	OPENBSD_5_4:1.11.0.12
	OPENBSD_5_4_BASE:1.11
	OPENBSD_5_3:1.11.0.10
	OPENBSD_5_3_BASE:1.11
	OPENBSD_5_2:1.11.0.8
	OPENBSD_5_2_BASE:1.11
	OPENBSD_5_1_BASE:1.11
	OPENBSD_5_1:1.11.0.6
	OPENBSD_5_0:1.11.0.4
	OPENBSD_5_0_BASE:1.11
	OPENBSD_4_9:1.11.0.2
	OPENBSD_4_9_BASE:1.11
	OPENBSD_4_8:1.10.0.4
	OPENBSD_4_8_BASE:1.10
	OPENBSD_4_7:1.10.0.2
	OPENBSD_4_7_BASE:1.10
	OPENBSD_4_3:1.7.0.2
	OPENBSD_4_3_BASE:1.7
	OPENBSD_4_2:1.6.0.2
	OPENBSD_4_2_BASE:1.6
	OPENBSD_4_1:1.5.0.10
	OPENBSD_4_1_BASE:1.5
	OPENBSD_4_0:1.5.0.8
	OPENBSD_4_0_BASE:1.5
	OPENBSD_3_9:1.5.0.6
	OPENBSD_3_9_BASE:1.5
	OPENBSD_3_8:1.5.0.4
	OPENBSD_3_8_BASE:1.5
	OPENBSD_3_7:1.5.0.2
	OPENBSD_3_7_BASE:1.5
	OPENBSD_3_6:1.4.0.2
	OPENBSD_3_6_BASE:1.4
	OPENBSD_3_5:1.3.0.2
	OPENBSD_3_5_BASE:1.3
	OPENBSD_3_4:1.2.0.2
	OPENBSD_3_4_BASE:1.2
	OPENBSD_3_3:1.1.1.1.0.2
	OPENBSD_3_3_BASE:1.1.1.1
	todd_20030131:1.1.1.1
	todd:1.1.1;
locks; strict;
comment	@# @;


1.12
date	2016.03.01.09.24.20;	author ajacoutot;	state Exp;
branches;
next	1.11;
commitid	XfaTIvXPpDB0Mzbu;

1.11
date	2010.11.14.14.16.43;	author ajacoutot;	state Exp;
branches;
next	1.10;

1.10
date	2009.11.07.08.41.15;	author ajacoutot;	state Exp;
branches;
next	1.9;

1.9
date	2009.10.24.10.23.02;	author ajacoutot;	state Exp;
branches;
next	1.8;

1.8
date	2008.07.25.13.42.57;	author ajacoutot;	state dead;
branches;
next	1.7;

1.7
date	2007.11.10.14.08.16;	author jasper;	state Exp;
branches;
next	1.6;

1.6
date	2007.04.24.12.53.38;	author jasper;	state Exp;
branches;
next	1.5;

1.5
date	2004.12.30.04.30.12;	author marcm;	state Exp;
branches;
next	1.4;

1.4
date	2004.06.23.03.23.48;	author marcm;	state Exp;
branches;
next	1.3;

1.3
date	2003.10.07.05.47.57;	author marcm;	state Exp;
branches;
next	1.2;

1.2
date	2003.06.12.19.37.27;	author marcm;	state Exp;
branches;
next	1.1;

1.1
date	2003.01.31.18.26.49;	author todd;	state Exp;
branches
	1.1.1.1;
next	;

1.1.1.1
date	2003.01.31.18.26.49;	author todd;	state Exp;
branches;
next	;


desc
@@


1.12
log
@Merge a lot of fixes from upstream.
@
text
@$OpenBSD: patch-gconf_gconftool_c,v 1.11 2010/11/14 14:16:43 ajacoutot Exp $

From 0780809731c8ab1c364202b1900d3df106b28626 Mon Sep 17 00:00:00 2001
From: Robert Ancell <robert.ancell@@canonical.com>
Date: Wed, 14 Oct 2015 10:09:49 +0100
Subject: Fix some compiler warnings

https://bugzilla.gnome.org/show_bug.cgi?id=328697
(patch from Fedora)

--- gconf/gconftool.c.orig	Tue Aug 16 04:59:31 2011
+++ gconf/gconftool.c	Mon Feb 29 10:02:10 2016
@@@@ -578,8 +578,6 @@@@ main (int argc, char** argv)
   bindtextdomain (GETTEXT_PACKAGE,GCONF_LOCALE_DIR);
   textdomain (GETTEXT_PACKAGE);
 
-  g_thread_init (NULL);
-
   _gconf_init_i18n ();
   
   context = g_option_context_new (N_("- Tool to manipulate a GConf configuration"));
@@@@ -4081,6 +4079,8 @@@@ do_makefile_install(GConfEngine* conf, const gchar** a
 
       ++args;
     }
+
+  g_spawn_command_line_sync ("/usr/bin/pkill -TERM -f " GCONF_SERVERDIR "/" GCONFD "2>/dev/null", NULL, NULL, NULL, NULL);
 
   retval |= do_sync (conf);
   return retval;
@


1.11
log
@Redirect stderr to /dev/null for the pkill(1) exec.
That is needed because one may want to install packages while running
on a ramdisk kernel which does not have kvm_getproc2().

discussed with robert@@
@
text
@d1 6
a6 1
$OpenBSD: patch-gconf_gconftool_c,v 1.10 2009/11/07 08:41:15 ajacoutot Exp $
d11 13
a23 3
--- gconf/gconftool.c.orig	Sat Oct 24 11:30:21 2009
+++ gconf/gconftool.c	Sat Oct 24 11:32:58 2009
@@@@ -4082,6 +4082,8 @@@@ do_makefile_install(GConfEngine* conf, const gchar** a
d26 2
a28 2
+  g_spawn_command_line_sync ("/usr/bin/pkill -TERM -f " GCONF_SERVERDIR "/" GCONFD "2>/dev/null", NULL, NULL, NULL, NULL);
+
a30 1
 }
@


1.10
log
@Really kill the gconfd-2 process when gconftool-2 runs.
@
text
@d1 1
a1 1
$OpenBSD: patch-gconf_gconftool_c,v 1.9 2009/10/24 10:23:02 ajacoutot Exp $
d12 1
a12 1
+  g_spawn_command_line_sync ("/usr/bin/pkill -TERM -f " GCONF_SERVERDIR "/" GCONFD, NULL, NULL, NULL, NULL);
@


1.9
log
@Major update to gconf2-2.28.0.
LDAP and policykit support are disabled.
Bring a patch from Fedora so that the gconf daemon gets killed when
gconftool-2 is run; this should fix some applications startup after first
installation.

ok jasper@@
@
text
@d1 1
a1 1
$OpenBSD$
d12 1
a12 1
+  g_spawn_command_line_sync ("/usr/bin/pkill -TERM " GCONF_SERVERDIR "/" GCONFD, NULL, NULL, NULL, NULL);
@


1.8
log
@- fix GCONF_ETCDIR
before this change it wasn't possible to add mandatory settings without
tweaking gconf
- while here, rework the way we build this port so we can drop some
patching
@
text
@d1 9
a9 4
$OpenBSD: patch-gconf_gconftool_c,v 1.7 2007/11/10 14:08:16 jasper Exp $
--- gconf/gconftool.c.orig	Wed Aug  1 07:36:59 2007
+++ gconf/gconftool.c	Fri Oct 19 13:55:59 2007
@@@@ -4182,7 +4182,7 @@@@ do_get_default_source (const gchar** args)
d12 5
a16 6
   /* Use default database */
-  source = g_strconcat("xml:merged:", GCONF_ETCDIR, "/gconf.xml.defaults", NULL);
+  source = g_strconcat("xml:merged:", "/var/db/gconf/gconf.xml.defaults", NULL);
   g_print ("%s\n", source);
   g_free(source);
 
@


1.7
log
@- update gconf2 to 2.20.1
- fix license marker
- switch to use gnome.port.mk

ok martynas@@
@
text
@d1 1
a1 1
$OpenBSD: patch-gconf_gconftool_c,v 1.6 2007/04/24 12:53:38 jasper Exp $
@


1.6
log
@update gconf2 to 2.18.0.1

based on diffs by alek@@

ok martynas@@
@
text
@d1 4
a4 4
$OpenBSD$
--- gconf/gconftool.c.orig	Fri Mar  2 23:10:13 2007
+++ gconf/gconftool.c	Thu Apr 19 20:32:10 2007
@@@@ -4049,7 +4049,7 @@@@ do_get_default_source (const gchar** args)
@


1.5
log
@Fix the libtool patching here.  -pthread handling was screwy and in
one rare case it showed up.  Regen remaining patches and lose the po
Makefile one.
@
text
@d1 4
a4 4
$OpenBSD: patch-gconf_gconftool_c,v 1.4 2004/06/23 03:23:48 marcm Exp $
--- gconf/gconftool.c.orig	Mon Aug 30 00:35:33 2004
+++ gconf/gconftool.c	Wed Dec 22 18:48:43 2004
@@@@ -4008,7 +4008,7 @@@@ do_get_default_source (const gchar** arg
d8 2
a9 2
-  source = g_strconcat("xml::", GCONF_ETCDIR, "/gconf.xml.defaults", NULL);
+  source = g_strconcat(GCONF_CONFIG_SOURCE, NULL);
@


1.4
log
@Updates to gconf-editor, gconf2, libglade2 and libwnck in support
of Gnome 2.6.
@
text
@d1 4
a4 4
$OpenBSD: patch-gconf_gconftool_c,v 1.3 2003/10/07 05:47:57 marcm Exp $
--- gconf/gconftool.c.orig	2004-04-05 13:14:33.000000000 -0600
+++ gconf/gconftool.c	2004-06-19 21:36:49.000000000 -0600
@@@@ -3989,7 +3989,7 @@@@ do_get_default_source (const gchar** arg
@


1.3
log
@Update GNOME support ports to their Gnome 2.4 versions...

ORBit2    2.6.3 -> 2.8.1
gconf2    2.2.1 -> 2.4.0.1
libgtop2  2.0.2 -> 2.0.5
libwnck   2.2.2 -> 2.4.0.1
vte       0.10.29 -> 0.11.10

Also removes devel/linc since it has been rolled into devel/ORBit2.
@
text
@d1 4
a4 4
$OpenBSD: patch-gconf_gconftool_c,v 1.2 2003/06/12 19:37:27 marcm Exp $
--- gconf/gconftool.c.orig	2003-09-08 14:00:34.000000000 -0700
+++ gconf/gconftool.c	2003-09-10 07:09:29.000000000 -0700
@@@@ -3978,7 +3978,7 @@@@ do_get_default_source (const gchar** arg
@


1.2
log
@Update to 2.2.0 in support of Gnome 2.2.1

ok jolan@@
@
text
@d1 4
a4 4
$OpenBSD: patch-gconf_gconftool_c,v 1.1.1.1 2003/01/31 18:26:49 todd Exp $
--- gconf/gconftool.c.orig	Wed Sep 18 19:04:30 2002
+++ gconf/gconftool.c	Wed Apr 30 20:14:27 2003
@@@@ -2702,7 +2702,7 @@@@ do_get_default_source (const gchar** arg
d10 1
a10 1
   printf("%s\n", source);
@


1.1
log
@Initial revision
@
text
@d1 4
a4 4
$OpenBSD$
--- gconf/gconftool.c.orig	Wed Jun 12 13:32:24 2002
+++ gconf/gconftool.c	Sun Aug 18 20:38:39 2002
@@@@ -2683,7 +2683,7 @@@@ do_get_default_source (const gchar** arg
@


1.1.1.1
log
@Import gconf2-1.2.1
--
GConf is a configuration database system, functionally similar to the
Windows registry but lots better.

For more information about GConf and the GNOME project, visit:

WWW: http://www.gnome.org/projects/gconf/

From marcm for gnome2
@
text
@@
