head	1.7;
access;
symbols
	OPENBSD_5_4:1.6.0.2
	OPENBSD_5_4_BASE:1.6
	OPENBSD_5_1_BASE:1.3
	OPENBSD_5_1:1.3.0.2;
locks; strict;
comment	@# @;


1.7
date	2013.09.26.06.27.49;	author jasper;	state dead;
branches;
next	1.6;

1.6
date	2013.03.29.14.57.09;	author jasper;	state Exp;
branches;
next	1.5;

1.5
date	2013.03.28.19.32.11;	author jasper;	state Exp;
branches;
next	1.4;

1.4
date	2012.03.29.06.29.08;	author ajacoutot;	state dead;
branches;
next	1.3;

1.3
date	2011.11.18.11.11.33;	author jasper;	state Exp;
branches;
next	1.2;

1.2
date	2011.11.17.15.51.47;	author jasper;	state Exp;
branches;
next	1.1;

1.1
date	2011.11.17.11.39.49;	author jasper;	state Exp;
branches;
next	;


desc
@@


1.7
log
@- update to gobject-introspection-1.38.0
@
text
@$OpenBSD: patch-giscanner_shlibs_py,v 1.6 2013/03/29 14:57:09 jasper Exp $

From 49b80bb567115b95c1051d2f01da7679e4e08154 Mon Sep 17 00:00:00 2001
From: Jasper Lievisse Adriaanse <jasper@@humppa.nl>
Date: Thu, 28 Mar 2013 10:49:01 +0000
Subject: Unbreak giscanner on OpenBSD.

Commit 9a1e0c63c13f3567e75553d2d07dd914d5b81287 broke this as
os.name doesn't return 'OpenBSD', but 'posix'

https://bugzilla.gnome.org/show_bug.cgi?id=696765

--- giscanner/shlibs.py.orig	Tue Dec 18 17:27:16 2012
+++ giscanner/shlibs.py	Thu Mar 28 11:45:22 2013
@@@@ -68,7 +68,7 @@@@ def _resolve_non_libtool(options, binary, libraries):
     if not libraries:
         return []
 
-    if os.name == 'OpenBSD':
+    if platform.platform().startswith('OpenBSD'):
         # Hack for OpenBSD when using the ports' libtool which uses slightly
         # different directories to store the libraries in. So rewite binary.args[0]
         # by inserting '.libs/'.
@


1.6
log
@pushed upstream, no pkg change.
@
text
@d1 1
a1 1
$OpenBSD: patch-giscanner_shlibs_py,v 1.5 2013/03/28 19:32:11 jasper Exp $
@


1.5
log
@- update to gobject-introspection 1.36.0

ok aja@@
@
text
@d1 9
a9 1
$OpenBSD$
@


1.4
log
@Update to gobject-introspection-1.31.22.
@
text
@d1 1
a1 1
$OpenBSD: patch-giscanner_shlibs_py,v 1.3 2011/11/18 11:11:33 jasper Exp $
d3 1
a3 3
commit d4c5a6482b0c2cc8b6f55ca9dce62d7652451942
Author: Jasper Lievisse Adriaanse <jasper@@humppa.nl>
Date:   Fri Nov 18 12:01:22 2011 +0100
d5 3
a7 17
    OpenBSD uses it's own libtool implementation which breaks giscanner in certain
    situations. So adjust resolve_non_libtool() in this case.
    
    https://bugzilla.gnome.org/show_bug.cgi?id=664282

--- giscanner/shlibs.py.orig	Fri Jun 10 17:36:50 2011
+++ giscanner/shlibs.py	Fri Nov 18 11:59:34 2011
@@@@ -22,6 +22,7 @@@@
 import re
 import platform
 import subprocess
+import os
 
 from .utils import get_libtool_command, extract_libtool_shlib
 
@@@@ -66,6 +67,19 @@@@ def _ldd_library_pattern(library_name):
 def _resolve_non_libtool(options, binary, libraries):
a9 13
+
+    if os.uname()[0] == 'OpenBSD':
+        # Hack for OpenBSD when using the ports' libtool which uses slightly
+        # different directories to store the libraries in. So rewite binary.args[0]
+        # by inserting '.libs/'.
+        old_argdir = binary.args[0]
+        new_libsdir = os.path.join(os.path.dirname(binary.args[0]), '.libs/')
+        new_lib = new_libsdir + os.path.basename(binary.args[0])
+        if os.path.exists(new_lib):
+            binary.args[0] = new_lib
+            os.putenv('LD_LIBRARY_PATH', new_libsdir)
+        else:
+            binary.args[0] = old_argdir
d11 5
a15 2
     args = []
     libtool = get_libtool_command(options)
@


1.3
log
@Adjust patch a bit with upstream feedback
@
text
@d1 1
a1 1
$OpenBSD: patch-giscanner_shlibs_py,v 1.2 2011/11/17 15:51:47 jasper Exp $
@


1.2
log
@Adjust a bit to make it committable upstream.
@
text
@d1 1
a1 1
$OpenBSD: patch-giscanner_shlibs_py,v 1.1 2011/11/17 11:39:49 jasper Exp $
d3 8
a10 1
https://bugzilla.gnome.org/show_bug.cgi?id=664282
d13 1
a13 1
+++ giscanner/shlibs.py	Thu Nov 17 16:39:51 2011
d32 1
a32 1
+        new_libsdir = os.path.dirname(binary.args[0]) + '/.libs/'
@


1.1
log
@*Finally* fix the issue where certain ports using GI and our ports libtool
would fail to build and had to switch to gnu libtool.
@
text
@d1 4
a4 1
$OpenBSD$
d6 1
a6 1
+++ giscanner/shlibs.py	Wed Nov 16 19:24:06 2011
d15 1
a15 1
@@@@ -66,6 +67,18 @@@@ def _ldd_library_pattern(library_name):
d20 12
a31 11
+    # Hack for OpenBSD when using the ports' libtool which uses slightly
+    # different directories to store the libraries in. So rewite binary.args[0]
+    # by inserting '.libs/'.
+    old_argdir = binary.args[0]
+    new_libsdir = os.path.dirname(binary.args[0]) + '/.libs/'
+    new_lib = new_libsdir + os.path.basename(binary.args[0])
+    if os.path.exists(new_lib):
+        binary.args[0] = new_lib
+        os.putenv('LD_LIBRARY_PATH', new_libsdir)
+    else:
+        binary.args[0] = old_argdir
@

