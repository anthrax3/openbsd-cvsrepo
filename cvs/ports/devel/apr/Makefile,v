head	1.39;
access;
symbols
	OPENBSD_6_0:1.39.0.2
	OPENBSD_6_0_BASE:1.39
	OPENBSD_5_9:1.37.0.2
	OPENBSD_5_9_BASE:1.37
	OPENBSD_5_8:1.37.0.4
	OPENBSD_5_8_BASE:1.37
	OPENBSD_5_7:1.36.0.2
	OPENBSD_5_7_BASE:1.36
	OPENBSD_5_6:1.34.0.2
	OPENBSD_5_6_BASE:1.34
	OPENBSD_5_5:1.33.0.2
	OPENBSD_5_5_BASE:1.33
	OPENBSD_5_4:1.31.0.2
	OPENBSD_5_4_BASE:1.31
	OPENBSD_5_3:1.28.0.2
	OPENBSD_5_3_BASE:1.28
	OPENBSD_5_2:1.27.0.2
	OPENBSD_5_2_BASE:1.27
	OPENBSD_5_1_BASE:1.25
	OPENBSD_5_1:1.25.0.2
	OPENBSD_5_0:1.24.0.2
	OPENBSD_5_0_BASE:1.24
	OPENBSD_4_9:1.23.0.2
	OPENBSD_4_9_BASE:1.23
	OPENBSD_4_8:1.22.0.4
	OPENBSD_4_8_BASE:1.22
	OPENBSD_4_7:1.22.0.2
	OPENBSD_4_7_BASE:1.22
	OPENBSD_4_6:1.20.0.6
	OPENBSD_4_6_BASE:1.20
	OPENBSD_4_5:1.20.0.4
	OPENBSD_4_5_BASE:1.20
	OPENBSD_4_4:1.20.0.2
	OPENBSD_4_4_BASE:1.20
	OPENBSD_4_3:1.19.0.2
	OPENBSD_4_3_BASE:1.19
	OPENBSD_4_2:1.12.0.2
	OPENBSD_4_2_BASE:1.12
	OPENBSD_4_1:1.7.0.2
	OPENBSD_4_1_BASE:1.7
	OPENBSD_4_0:1.4.0.4
	OPENBSD_4_0_BASE:1.4
	OPENBSD_3_9:1.4.0.2
	OPENBSD_3_9_BASE:1.4
	OPENBSD_3_8:1.3.0.4
	OPENBSD_3_8_BASE:1.3
	OPENBSD_3_7:1.3.0.2
	OPENBSD_3_7_BASE:1.3
	alek_20041128:1.1.1.1
	alek:1.1.1;
locks; strict;
comment	@# @;


1.39
date	2016.03.11.20.28.23;	author naddy;	state Exp;
branches;
next	1.38;
commitid	UYLP8TE6V7RS2GhJ;

1.38
date	2016.03.09.19.11.35;	author naddy;	state Exp;
branches;
next	1.37;
commitid	FReQDMR3LOKmB7Hq;

1.37
date	2015.04.29.16.22.12;	author stsp;	state Exp;
branches;
next	1.36;
commitid	KCRRv3BWCoUZ1NcC;

1.36
date	2015.01.18.21.27.08;	author claudio;	state Exp;
branches;
next	1.35;
commitid	4yq3fPp6D2ih0IIc;

1.35
date	2015.01.10.19.22.16;	author stsp;	state Exp;
branches;
next	1.34;
commitid	d4I0yM3QhgnU2RfV;

1.34
date	2014.04.12.17.05.58;	author stsp;	state Exp;
branches;
next	1.33;

1.33
date	2013.11.25.11.37.15;	author sthen;	state Exp;
branches;
next	1.32;

1.32
date	2013.11.03.07.52.01;	author ajacoutot;	state Exp;
branches;
next	1.31;

1.31
date	2013.07.11.08.36.28;	author espie;	state Exp;
branches;
next	1.30;

1.30
date	2013.03.21.08.45.14;	author ajacoutot;	state Exp;
branches;
next	1.29;

1.29
date	2013.03.11.10.50.00;	author espie;	state Exp;
branches;
next	1.28;

1.28
date	2012.12.21.12.13.35;	author sthen;	state Exp;
branches;
next	1.27;

1.27
date	2012.06.26.19.35.30;	author kili;	state Exp;
branches;
next	1.26;

1.26
date	2012.04.28.09.48.17;	author stsp;	state Exp;
branches;
next	1.25;

1.25
date	2011.11.18.10.11.32;	author espie;	state Exp;
branches;
next	1.24;

1.24
date	2011.06.15.19.13.48;	author sthen;	state Exp;
branches;
next	1.23;

1.23
date	2010.11.15.19.45.56;	author espie;	state Exp;
branches;
next	1.22;

1.22
date	2009.11.07.18.08.14;	author william;	state Exp;
branches;
next	1.21;

1.21
date	2009.08.06.22.20.21;	author steven;	state Exp;
branches;
next	1.20;

1.20
date	2008.07.25.20.25.59;	author sthen;	state Exp;
branches
	1.20.4.1
	1.20.6.1;
next	1.19;

1.19
date	2007.10.30.16.56.45;	author steven;	state Exp;
branches;
next	1.18;

1.18
date	2007.10.30.16.47.50;	author steven;	state Exp;
branches;
next	1.17;

1.17
date	2007.09.20.10.17.21;	author steven;	state Exp;
branches;
next	1.16;

1.16
date	2007.09.16.02.52.56;	author merdely;	state Exp;
branches;
next	1.15;

1.15
date	2007.09.11.19.16.47;	author steven;	state Exp;
branches;
next	1.14;

1.14
date	2007.09.07.20.12.55;	author steven;	state Exp;
branches;
next	1.13;

1.13
date	2007.09.04.21.46.25;	author steven;	state Exp;
branches;
next	1.12;

1.12
date	2007.07.05.16.01.28;	author steven;	state Exp;
branches;
next	1.11;

1.11
date	2007.04.26.16.05.01;	author kurt;	state Exp;
branches;
next	1.10;

1.10
date	2007.04.01.20.03.07;	author kurt;	state Exp;
branches;
next	1.9;

1.9
date	2007.03.28.06.47.57;	author steven;	state Exp;
branches;
next	1.8;

1.8
date	2007.03.24.13.46.47;	author todd;	state Exp;
branches;
next	1.7;

1.7
date	2006.11.03.10.56.44;	author alek;	state Exp;
branches;
next	1.6;

1.6
date	2006.10.28.11.19.20;	author espie;	state Exp;
branches;
next	1.5;

1.5
date	2006.10.04.09.30.00;	author alek;	state Exp;
branches;
next	1.4;

1.4
date	2006.01.06.13.14.28;	author bernd;	state Exp;
branches;
next	1.3;

1.3
date	2005.01.20.18.48.54;	author alek;	state Exp;
branches;
next	1.2;

1.2
date	2004.12.09.01.12.13;	author kevlo;	state Exp;
branches;
next	1.1;

1.1
date	2004.11.28.14.27.38;	author alek;	state Exp;
branches
	1.1.1.1;
next	;

1.1.1.1
date	2004.11.28.14.27.38;	author alek;	state Exp;
branches;
next	;

1.20.4.1
date	2009.08.16.01.50.40;	author william;	state Exp;
branches;
next	;

1.20.6.1
date	2009.11.10.03.31.57;	author william;	state Exp;
branches;
next	;


desc
@@


1.39
log
@garbage collect CONFIGURE_SHARED
@
text
@# $OpenBSD: Makefile,v 1.38 2016/03/09 19:11:35 naddy Exp $

COMMENT=	Apache Portable Runtime

V=		1.5.2
DISTNAME=	apr-$V
SHARED_LIBS +=	apr-1             5.0     # .5.0

CATEGORIES=	devel

MAINTAINER=	Stefan Sperling <stsp@@openbsd.org>

HOMEPAGE=	http://apr.apache.org/

# Apache License 2.0
PERMIT_PACKAGE_CDROM=	Yes

WANTLIB += pthread

MASTER_SITES=	${MASTER_SITE_APACHE:=apr/}

CONFIGURE_STYLE=gnu
CONFIGURE_ARGS=	--includedir=${LOCALBASE}/include/apr-1/ \
		--with-installbuilddir=${LOCALBASE}/lib/apr-1/ \
		--enable-other-child \
		--enable-threads \
		--enable-pool-debug=yes \
		ac_cv_prog_AWK=awk

pre-install:
	rm -f ${WRKSRC}/libtool

.include <bsd.port.mk>
@


1.38
log
@remove substituted uses of CONFIGURE_SHARED, NO_SHARED_LIBS
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.37 2015/04/29 16:22:12 stsp Exp $
d23 1
a23 2
CONFIGURE_ARGS=	${CONFIGURE_SHARED} \
		--includedir=${LOCALBASE}/include/apr-1/ \
@


1.37
log
@update to APR-1.5.2
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.36 2015/01/18 21:27:08 claudio Exp $
a23 1
		${CONFIGURE_SHARED:S/-shared/-dso/} \
@


1.36
log
@While accept() is inheriting O_NONBLOCK it is not the case in the accept4()
case. So only inherit O_NONBLOCK if accept4() is not used. Without this
apache 2.4 blocks forever when using keepalive. OK stsp@@
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.35 2015/01/10 19:22:16 stsp Exp $
d5 1
a5 2
V=		1.5.0
REVISION=	1
@


1.35
log
@Sync PLIST of devel/apr. It was missing some headers added in APR 1.5.
found by and ok claudio@@
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.34 2014/04/12 17:05:58 stsp Exp $
d6 1
a6 1
REVISION=	0
@


1.34
log
@Update APR to 1.5.0.

Enable APR memory pool debugging, which has the desirable side effect
of making APR memory pools a thin layer around malloc() and free() and
thus benefit from related exploit mitigation. APR will also overwrite
memory with a poison byte before freeing like malloc's J flag does.

ok sthen@@
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.33 2013/11/25 11:37:15 sthen Exp $
d6 1
@


1.33
log
@merge PFRAG.shared into PLIST, and regen distinfo, ok stsp@@
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.32 2013/11/03 07:52:01 ajacoutot Exp $
d5 1
a5 1
V=		1.4.6
d7 1
a7 2
REVISION=	3
SHARED_LIBS +=	apr-1             4.6     # .4.6
d29 1
@


1.32
log
@No need for /-lpthread/-pthread
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.31 2013/07/11 08:36:28 espie Exp $
d7 1
a7 1
REVISION=	2
@


1.31
log
@might fix compile on vax: the configure script refuses to proceed if
DSO is not found.

BUT, if you explicitly ask for --disable-dso, it keeps going and builds
something. Go figure...
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.30 2013/03/21 08:45:14 ajacoutot Exp $
d7 1
a7 1
REVISION=	1
@


1.30
log
@USE_LIBTOOL=Yes is the default now.
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.29 2013/03/11 10:50:00 espie Exp $
d25 1
@


1.29
log
@PERMIT_* / REGRESS->TEST sweep
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.28 2012/12/21 12:13:35 sthen Exp $
a22 1
USE_LIBTOOL=	Yes
@


1.28
log
@sync wantlib
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.27 2012/06/26 19:35:30 kili Exp $
a17 3
PERMIT_PACKAGE_FTP=	Yes
PERMIT_DISTFILES_CDROM=	Yes
PERMIT_DISTFILES_FTP=	Yes
@


1.27
log
@Bump to force an update after the move of our libtool from ports
to src. Otherwise people who have apr already installed won't get
an update, leading to apr-1-config --apr-libtool still saying
/usr/ports/infrastructure/bin/libtool, which in turn causes (at
least) a build of www/apache-httpd to fail.

ok espie@@
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.26 2012/04/28 09:48:17 stsp Exp $
d7 1
a7 1
REVISION=	0
d21 2
@


1.26
log
@Update to APR-1.4.6. Enable threads by default and remove the 'mt' flavour.
Grab maintainership.
ok sthen
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.25 2011/11/18 10:11:32 espie Exp $
d7 1
@


1.25
log
@FLAVOR:L and such things
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.24 2011/06/15 19:13:48 sthen Exp $
d5 1
a5 1
V=		1.2.11
d7 1
a7 3
FULLPKGNAME=	apr${MT}-$V
REVISION=	5
SHARED_LIBS +=	apr-1${MT}             3.0     # .2.11
d11 1
a11 1
MAINTAINER=	Aleksander Piotrowski <alek@@openbsd.org>
d26 2
a27 2
		--includedir=${LOCALBASE}/include/apr-1${MT}/ \
		--with-installbuilddir=${LOCALBASE}/lib/apr-1${MT}/ \
d29 1
a30 18

FLAVORS=	mt
FLAVOR?=

SUBST_VARS+=	MT

.if ${FLAVOR:Mmt}
MT=-mt
CONFIGURE_ARGS+=	--enable-threads

post-install:
	sed 's/{APR_LIBNAME}/{APR_LIBNAME}-mt/g' ${WRKSRC}/apr-config.out > ${PREFIX}/bin/apr-1-mt-config

.else
MT=
CONFIGURE_ARGS+=	--disable-threads
.endif
MAKE_ENV+=	MT=${MT}
@


1.24
log
@The installed apr-util on my desktop dates from before nawk was removed
from base causing a build failure in apr-util (as there's been nothing
changed since then to trigger an update). Set cache value to autoconf
to make sure nawk isn't picked up if for some reason it's hanging
around, though the REVISION bump alone is probably enough to take
care of most problems.
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.23 2010/11/15 19:45:56 espie Exp $
d38 1
a38 1
.if ${FLAVOR:L:Mmt}
@


1.23
log
@move depends to new style
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.22 2009/11/07 18:08:14 william Exp $
d8 1
a8 1
REVISION =	4
d30 2
a31 1
		--enable-other-child
@


1.22
log
@Bump to p4, because I mistakenly put that in 4.5-stable.  This is
to keep future updates working; no other changes.

ok steven@@ jasper@@
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.21 2009/08/06 22:20:21 steven Exp $
d7 2
a8 1
FULLPKGNAME=	apr${MT}-$Vp4
@


1.21
log
@security fix for CVE-2009-2412

https://svn.apache.org/viewvc?view=rev&revision=800732

from Stefan Sperling
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.19 2007/10/30 16:56:45 steven Exp $
d7 1
a7 1
FULLPKGNAME=	apr${MT}-$Vp3
@


1.20
log
@shared library and PKGNAME bumps due to use of isinf/isnan/nan
following libc/libm changes
@
text
@d7 1
a7 1
FULLPKGNAME=	apr${MT}-$Vp2
@


1.20.6.1
log
@MFC:

SECURITY FIX

Resolves CVE-2009-2412:

https://svn.apache.org/viewvc?view=rev&revision=800732

from Stefan Sperling
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.20 2008/07/25 20:25:59 sthen Exp $
d7 1
a7 1
FULLPKGNAME=	apr${MT}-$Vp4
@


1.20.4.1
log
@MFC:

SECURITY FIX

Resolves CVE-2009-2412:

https://svn.apache.org/viewvc?view=rev&revision=800732

from Stefan Sperling
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.20 2008/07/25 20:25:59 sthen Exp $
d7 1
a7 1
FULLPKGNAME=	apr${MT}-$Vp4
@


1.19
log
@bump pkgname again
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.18 2007/10/30 16:47:50 steven Exp $
d7 2
a8 2
FULLPKGNAME=	apr${MT}-$Vp1
SHARED_LIBS +=	apr-1${MT}             2.11     # .2.11
@


1.18
log
@use the libtool we want, and don't install your own.
also make apr-config --apr-libtool return the right thing.
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.17 2007/09/20 10:17:21 steven Exp $
d7 1
a7 1
FULLPKGNAME=	apr${MT}-$Vp0
@


1.17
log
@update to 1.2.11

tested and ok merdely@@, simon@@
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.16 2007/09/16 02:52:56 merdely Exp $
d7 1
a7 1
FULLPKGNAME=	apr${MT}-$V
d48 3
@


1.16
log
@Remove quotes surrounding COMMENT*/PERMIT_*/BROKEN
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.15 2007/09/11 19:16:47 steven Exp $
d5 4
a8 3
DISTNAME=	apr-1.2.9
FULLPKGNAME=	apr${MT}-1.2.9p0
SHARED_LIBS +=	apr-1${MT}             2.9     # .2.9
@


1.15
log
@revert FULLPKGNAME change so unflavored and mt flavor can coexist again
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.14 2007/09/07 20:12:55 steven Exp $
d3 1
a3 1
COMMENT=	"Apache Portable Runtime"
@


1.14
log
@bump pkgname because of DESCR changes
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.13 2007/09/04 21:46:25 steven Exp $
d6 1
a6 1
PKGNAME=	${DISTNAME}p0
@


1.13
log
@add flavor description
change flavored pkgname to the default, like apr-util
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.12 2007/07/05 16:01:28 steven Exp $
d6 1
@


1.12
log
@update to 1.2.9

ok simon@@
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.11 2007/04/26 16:05:01 kurt Exp $
a5 1
FULLPKGNAME=	apr${MT}-1.2.9
@


1.11
log
@the accept retry change was rejected upstream. applications that use apr
have to retry upon EINTR instead of apr doing for them.
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.10 2007/04/01 20:03:07 kurt Exp $
d5 3
a7 4
DISTNAME=	apr-1.2.7
PKGNAME=	${DISTNAME}p2
FULLPKGNAME=	apr${MT}-1.2.7p2
SHARED_LIBS +=	apr-1${MT}             2.7     # .2.7
@


1.10
log
@per POSIX accept(2) can return EINTR so have apr_socket_accept() retry
when this happens. http://issues.apache.org/bugzilla/show_bug.cgi?id=41975
fixes issues noticed while testing tomcat-native. regen patches and distinfo
while here.  "looks ok" steven@@
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.9 2007/03/28 06:47:57 steven Exp $
d6 2
a7 2
PKGNAME=	${DISTNAME}p1
FULLPKGNAME=	apr${MT}-1.2.7p1
@


1.9
log
@we don't have FAKE_ENV
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.8 2007/03/24 13:46:47 todd Exp $
d6 2
a7 2
PKGNAME=	${DISTNAME}p0
FULLPKGNAME=	apr${MT}-1.2.7p0
@


1.8
log
@add mt flavor that can co-exist with the default non-mt flavor
ok kurt@@
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.7 2006/11/03 10:56:44 alek Exp $
a47 1
FAKE_ENV+=	MT=${MT}
@


1.7
log
@Use MASTER_SITE_APACHE
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.6 2006/10/28 11:19:20 espie Exp $
d6 3
a8 1
SHARED_LIBS +=	apr-1                2.7      # .2.7
d27 22
a48 3
		--with-installbuilddir=${LOCALBASE}/lib/apr-1/ \
		--enable-other-child \
		--disable-threads
@


1.6
log
@a few more SHARED_LIBS reformat
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.5 2006/10/04 09:30:00 alek Exp $
d20 1
a20 2
MASTER_SITES=	http://www.apache.org/dist/apr/ \
		http://www.eu.apache.org/dist/apr/
@


1.5
log
@update to 1.2.7; mostly from dlg@@
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.4 2006/01/06 13:14:28 bernd Exp $
d6 1
a6 1
SHARED_LIBS=	apr-1 2.7
@


1.4
log
@SHARED_LIBS, USE_LIBTOOL
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.3 2005/01/20 18:48:54 alek Exp $
d5 2
a6 3
DISTNAME=	apr-1.0.1
PKGNAME=	apr-1.0.1p2
SHARED_LIBS=	apr-1 0.1
@


1.3
log
@- Disable threads
- Bump PKGNAME

help & ok msf@@
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.2 2004/12/09 01:12:13 kevlo Exp $
d6 3
a8 1
PKGNAME=	apr-1.0.1p1
d24 1
@


1.2
log
@- disable thread support, it's broken in p5-SVN. Discussed with alek@@
- bump PKGNAME
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.1.1.1 2004/11/28 14:27:38 alek Exp $
d6 1
a6 1
PKGNAME=	apr-1.0.1p0
d25 2
a26 1
		--enable-other-child
@


1.1
log
@Initial revision
@
text
@d1 1
a1 1
# $OpenBSD$
d6 1
a24 1
		--enable-threads \
@


1.1.1.1
log
@Import APR 1.0.1

The Apache Portable Run-time mission is to provide a library of
routines that allows programmers to write a program once and be
able to compile it anywhere.

ok naddy@@
@
text
@@
