head	1.3;
access;
symbols
	OPENBSD_2_9:1.1.1.1.0.2
	OPENBSD_2_9_BASE:1.1.1.1
	obecian_2001-Apr-19:1.1.1.1
	obecian:1.1.1;
locks; strict;
comment	@# @;


1.3
date	2001.06.23.19.05.40;	author pvalchev;	state dead;
branches;
next	1.2;

1.2
date	2001.05.08.05.02.44;	author pvalchev;	state Exp;
branches;
next	1.1;

1.1
date	2001.04.19.18.55.40;	author obecian;	state Exp;
branches
	1.1.1.1;
next	;

1.1.1.1
date	2001.04.19.18.55.40;	author obecian;	state Exp;
branches;
next	;


desc
@@


1.3
log
@Upgrade to SDL-1.2.1
Various improvements, including OpenBSD native audio.

* Fix audio device path.  This has caused audio not to work without the
esd flavor before, many people (including me) had link to /dev/dsp because
of linux emulation programs and haven't noticed the problem.
* Fix OSS audio.
* Sync libtool patches
* Properly include @@SYSTEM_LIBS@@ in sdl-config to ensure proper linking
of SDL applications.
@
text
@$OpenBSD: patch-src_cdrom_openbsd_SDL_syscdrom_c,v 1.2 2001/05/08 05:02:44 pvalchev Exp $
--- src/cdrom/openbsd/SDL_syscdrom.c.orig	Sat Feb 10 00:20:04 2001
+++ src/cdrom/openbsd/SDL_syscdrom.c	Fri Mar 30 08:44:02 2001
@@@@ -36,6 +36,7 @@@@ static char rcsid =
 #include <string.h>
 #include <errno.h>
 #include <unistd.h>
+#include <sys/ioctl.h>
 #include <sys/cdio.h>
 
 #include "SDL_error.h"
@@@@ -64,7 +65,8 @@@@ static void SDL_SYS_CDClose(SDL_CD *cdro
 
 /* Some ioctl() errno values which occur when the tray is empty */
 #define ERRNO_TRAYEMPTY(errno)	\
-	((errno == EIO) || (errno == ENOENT) || (errno == EINVAL))
+	((errno == EIO) || (errno == ENOENT) || (errno == EINVAL) || \
+	 (errno == ENODEV))
 
 /* Check a drive to see if it is a CD-ROM */
 static int CheckDrive(char *drive, struct stat *stbuf)
@@@@ -96,6 +98,8 @@@@ static int CheckDrive(char *drive, struc
 			}
 			close(cdfd);
 		}
+		else if (ERRNO_TRAYEMPTY(errno))
+			is_cd = 1;
 	}
 	return(is_cd);
 }
@@@@ -137,7 +141,11 @@@@ static void AddDrive(char *drive, struct
 int  SDL_SYS_CDInit(void)
 {
 	static char *checklist[] = {
+#ifdef __OpenBSD__
+		"?0 cd?c", "cdrom", NULL
+#else
 		"?0 cd?c", "?0 acd?c", "cdrom", NULL
+#endif
 	};
 	char *SDLcdrom;
 	int i, j, exists;
@


1.2
log
@cd?a -> cd?c which is the more likely place for a cdrom.
Proposed by d@@ via obecian@@.
@
text
@d1 1
a1 1
$OpenBSD: patch-src_cdrom_openbsd_SDL_syscdrom_c,v 1.1.1.1 2001/04/19 18:55:40 obecian Exp $
@


1.1
log
@Initial revision
@
text
@d1 1
a1 1
$OpenBSD: update-patches,v 1.3 2000/06/09 17:08:37 espie Exp $
d36 1
a36 1
+		"?0 cd?a", "cdrom", NULL
@


1.1.1.1
log
@sdl-1.2.0 - Simple DirectMedia Layer
@
text
@@
