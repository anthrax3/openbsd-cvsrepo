head	1.1;
access;
symbols
	OPENBSD_4_9:1.1.0.4
	OPENBSD_4_8:1.1.0.2;
locks; strict;
comment	@# @;


1.1
date	2011.03.03.20.55.23;	author stsp;	state dead;
branches
	1.1.2.1
	1.1.4.1;
next	;

1.1.2.1
date	2011.03.03.20.55.23;	author stsp;	state Exp;
branches;
next	;

1.1.4.1
date	2011.06.01.22.26.19;	author stsp;	state Exp;
branches;
next	;


desc
@@


1.1
log
@file patch-subversion_mod_dav_svn_version_c was initially added on branch OPENBSD_4_8.
@
text
@@


1.1.4.1
log
@Apply patches for CVE-2011-0715, CVE-2011-1752, CVE-2011-1783,
and CVE-2011-1921 to 4.9-stable branch.
ok landry jasper sthen
@
text
@a0 19
$OpenBSD$
CVE-2011-0715
--- subversion/mod_dav_svn/version.c.orig	Mon May 30 15:19:00 2011
+++ subversion/mod_dav_svn/version.c	Mon May 30 15:16:13 2011
@@@@ -1172,11 +1172,13 @@@@ dav_svn__push_locks(dav_resource *resource,
   svn_error_t *serr;
 
   serr = svn_fs_get_access(&fsaccess, resource->info->repos->fs);
-  if (serr)
+  if (serr || !fsaccess)
     {
       /* If an authenticated user name was attached to the request,
          then dav_svn_get_resource() should have already noticed and
          created an fs_access_t in the filesystem.  */
+      if (serr == NULL)
+        serr = svn_error_create(SVN_ERR_FS_LOCK_OWNER_MISMATCH, NULL, NULL);
       return dav_svn__sanitize_error(serr, "Lock token(s) in request, but "
                                      "missing an user name", HTTP_BAD_REQUEST,
                                      resource->info->r);
@


1.1.2.1
log
@SECURITY FIX (CVE-2011-0715)
http://subversion.apache.org/security/CVE-2011-0715-advisory.txt
ok jasper landry
@
text
@a0 19
$OpenBSD$
http://subversion.apache.org/security/CVE-2011-0715-advisory.txt
--- subversion/mod_dav_svn/version.c.orig	Mon Nov  3 04:15:17 2008
+++ subversion/mod_dav_svn/version.c	Thu Feb 24 12:56:10 2011
@@@@ -1172,11 +1172,13 @@@@ dav_svn__push_locks(dav_resource *resource,
   svn_error_t *serr;
 
   serr = svn_fs_get_access(&fsaccess, resource->info->repos->fs);
-  if (serr)
+  if (serr || !fsaccess)
     {
       /* If an authenticated user name was attached to the request,
          then dav_svn_get_resource() should have already noticed and
          created an fs_access_t in the filesystem.  */
+      if (serr == NULL)
+        serr = svn_error_create(SVN_ERR_FS_LOCK_OWNER_MISMATCH, NULL, NULL);
       return dav_svn__sanitize_error(serr, "Lock token(s) in request, but "
                                      "missing an user name", HTTP_BAD_REQUEST,
                                      resource->info->r);
@

