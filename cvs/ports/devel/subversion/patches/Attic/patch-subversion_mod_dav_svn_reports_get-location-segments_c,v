head	1.1;
access;
symbols
	OPENBSD_5_7:1.1.0.4
	OPENBSD_5_6:1.1.0.2;
locks; strict;
comment	@# @;


1.1
date	2014.12.17.13.55.14;	author stsp;	state dead;
branches
	1.1.2.1
	1.1.4.1;
next	;
commitid	agz3SmjY4S0jrjGC;

1.1.2.1
date	2014.12.17.13.55.14;	author stsp;	state Exp;
branches;
next	1.1.2.2;
commitid	agz3SmjY4S0jrjGC;

1.1.2.2
date	2015.04.02.19.35.56;	author stsp;	state Exp;
branches;
next	;
commitid	w5cSUqS8ttMouyFc;

1.1.4.1
date	2015.08.21.09.17.00;	author stsp;	state Exp;
branches;
next	;
commitid	tbhnJLpszknm0XLS;


desc
@@


1.1
log
@file patch-subversion_mod_dav_svn_reports_get-location-segments_c was initially added on branch OPENBSD_5_6.
@
text
@@


1.1.4.1
log
@Patch several problems in devel/subversion for 5.7-stable:
CVE-2015-0202, CVE-2015-0248, CVE-2015-0251, CVE-2015-3187
@
text
@a0 47
$OpenBSD$
http://subversion.apache.org/security/CVE-2015-0248-advisory.txt
--- subversion/mod_dav_svn/reports/get-location-segments.c.orig	Fri Dec  5 22:18:06 2014
+++ subversion/mod_dav_svn/reports/get-location-segments.c	Thu Apr  2 20:51:16 2015
@@@@ -181,17 +181,36 @@@@ dav_svn__get_location_segments_report(const dav_resour
                                   "Not all parameters passed.",
                                   SVN_DAV_ERROR_NAMESPACE,
                                   SVN_DAV_ERROR_TAG);
-  if (SVN_IS_VALID_REVNUM(start_rev)
-      && SVN_IS_VALID_REVNUM(end_rev)
-      && (end_rev > start_rev))
+
+  /* No START_REV or PEG_REVISION?  We'll use HEAD. */
+  if (!SVN_IS_VALID_REVNUM(start_rev) || !SVN_IS_VALID_REVNUM(peg_revision))
+    {
+      svn_revnum_t youngest;
+
+      serr = svn_fs_youngest_rev(&youngest, resource->info->repos->fs,
+                                 resource->pool);
+      if (serr != NULL)
+        return dav_svn__convert_err(serr, HTTP_INTERNAL_SERVER_ERROR,
+                                    "Could not determine youngest revision",
+                                    resource->pool);
+
+      if (!SVN_IS_VALID_REVNUM(start_rev))
+        start_rev = youngest;
+      if (!SVN_IS_VALID_REVNUM(peg_revision))
+        peg_revision = youngest;
+    }
+
+  /* No END_REV?  We'll use 0. */
+  if (!SVN_IS_VALID_REVNUM(end_rev))
+    end_rev = 0;
+
+  if (end_rev > start_rev)
     return dav_svn__new_error_tag(resource->pool, HTTP_BAD_REQUEST, 0,
                                   "End revision must not be younger than "
                                   "start revision",
                                   SVN_DAV_ERROR_NAMESPACE,
                                   SVN_DAV_ERROR_TAG);
-  if (SVN_IS_VALID_REVNUM(peg_revision)
-      && SVN_IS_VALID_REVNUM(start_rev)
-      && (start_rev > peg_revision))
+  if (start_rev > peg_revision)
     return dav_svn__new_error_tag(resource->pool, HTTP_BAD_REQUEST, 0,
                                   "Start revision must not be younger than "
                                   "peg revision",
@


1.1.2.1
log
@For 5.6-stable: Add Subversion patches for CVE-2014-3580 and CVE-2014-8108,
two remotely triggerable crashes in mod_dav_svn.
@
text
@a0 14
$OpenBSD$
CVE-2014-3580
--- subversion/mod_dav_svn/reports/get-location-segments.c.orig	Sun May  1 04:31:30 2011
+++ subversion/mod_dav_svn/reports/get-location-segments.c	Wed Dec 17 13:31:13 2014
@@@@ -123,6 +123,9 @@@@ dav_svn__get_location_segments_report(const dav_resour
   struct location_segment_baton location_segment_baton;
 
   /* Sanity check. */
+  if (!resource->info->repos_path)
+    return dav_svn__new_error(resource->pool, HTTP_BAD_REQUEST, 0,
+                              "The request does not specify a repository path");
   ns = dav_svn__find_ns(doc->namespaces, SVN_XML_NAMESPACE);
   if (ns == -1)
     {
@


1.1.2.2
log
@5.6-stable patches for Apache Subversion CVE-2015-0202, CVE-2015-0248,
and CVS-2015-0251. test + ok jasper
@
text
@d1 4
a4 4
$OpenBSD: patch-subversion_mod_dav_svn_reports_get-location-segments_c,v 1.1.2.1 2014/12/17 13:55:14 stsp Exp $
CVE-2014-3580, CVE-2015-0248
--- subversion/mod_dav_svn/reports/get-location-segments.c.orig	Thu Apr  2 15:20:59 2015
+++ subversion/mod_dav_svn/reports/get-location-segments.c	Thu Apr  2 15:20:34 2015
a14 43
@@@@ -178,17 +181,36 @@@@ dav_svn__get_location_segments_report(const dav_resour
                                   "Not all parameters passed.",
                                   SVN_DAV_ERROR_NAMESPACE,
                                   SVN_DAV_ERROR_TAG);
-  if (SVN_IS_VALID_REVNUM(start_rev)
-      && SVN_IS_VALID_REVNUM(end_rev)
-      && (end_rev > start_rev))
+
+  /* No START_REV or PEG_REVISION?  We'll use HEAD. */
+  if (!SVN_IS_VALID_REVNUM(start_rev) || !SVN_IS_VALID_REVNUM(peg_revision))
+    {
+      svn_revnum_t youngest;
+
+      serr = svn_fs_youngest_rev(&youngest, resource->info->repos->fs,
+                                 resource->pool);
+      if (serr != NULL)
+        return dav_svn__convert_err(serr, HTTP_INTERNAL_SERVER_ERROR,
+                                    "Could not determine youngest revision",
+                                    resource->pool);
+
+      if (!SVN_IS_VALID_REVNUM(start_rev))
+        start_rev = youngest;
+      if (!SVN_IS_VALID_REVNUM(peg_revision))
+        peg_revision = youngest;
+    }
+
+  /* No END_REV?  We'll use 0. */
+  if (!SVN_IS_VALID_REVNUM(end_rev))
+    end_rev = 0;
+
+  if (end_rev > start_rev)
     return dav_svn__new_error_tag(resource->pool, HTTP_BAD_REQUEST, 0,
                                   "End revision must not be younger than "
                                   "start revision",
                                   SVN_DAV_ERROR_NAMESPACE,
                                   SVN_DAV_ERROR_TAG);
-  if (SVN_IS_VALID_REVNUM(peg_revision)
-      && SVN_IS_VALID_REVNUM(start_rev)
-      && (start_rev > peg_revision))
+  if (start_rev > peg_revision)
     return dav_svn__new_error_tag(resource->pool, HTTP_BAD_REQUEST, 0,
                                   "Start revision must not be younger than "
                                   "peg revision",
@


