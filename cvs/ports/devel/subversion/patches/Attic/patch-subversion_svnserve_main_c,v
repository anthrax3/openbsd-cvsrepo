head	1.3;
access;
symbols
	OPENBSD_5_4:1.3.0.6
	OPENBSD_5_3:1.3.0.4
	OPENBSD_4_8:1.3.0.2
	OPENBSD_4_0:1.2.0.4
	OPENBSD_4_0_BASE:1.2
	OPENBSD_3_9:1.2.0.2
	OPENBSD_3_9_BASE:1.2;
locks; strict;
comment	@# @;


1.3
date	2006.09.30.06.23.58;	author steven;	state dead;
branches
	1.3.2.1
	1.3.4.1
	1.3.6.1;
next	1.2;

1.2
date	2006.01.27.10.20.56;	author alek;	state Exp;
branches;
next	1.1;

1.1
date	2005.11.30.19.45.08;	author sturm;	state Exp;
branches;
next	;

1.3.2.1
date	2010.12.01.14.17.35;	author jasper;	state Exp;
branches;
next	;

1.3.4.1
date	2013.05.31.21.00.53;	author stsp;	state Exp;
branches;
next	1.3.4.2;

1.3.4.2
date	2013.08.31.08.46.30;	author stsp;	state Exp;
branches;
next	;

1.3.6.1
date	2013.10.30.12.54.22;	author jasper;	state Exp;
branches;
next	;


desc
@@


1.3
log
@update to subversion 1.4.0

for details, read http://subversion.tigris.org/svn_1.4_releasenotes.html

from maintainer Sigfred Haversen <bsdlist at mumak.com>

go ahead pval
@
text
@$OpenBSD: patch-subversion_svnserve_main_c,v 1.2 2006/01/27 10:20:56 alek Exp $
--- subversion/svnserve/main.c.orig	Sun Jan  8 14:11:28 2006
+++ subversion/svnserve/main.c	Sun Jan  8 14:13:38 2006
@@@@ -215,7 +215,7 @@@@ static void * APR_THREAD_FUNC serve_thre
 static svn_error_t *
 check_lib_versions(void)
 {
-  static const svn_version_checklist_t checklist[] =
+  static svn_version_checklist_t checklist[] =
     {
       { "svn_subr",  svn_subr_version },
       { "svn_repos", svn_repos_version },
@


1.3.6.1
log
@Security fixes for CVE-2013-4131, CVE-2013-2112, CVE-2013-4277

ok stsp@@ (MAINTAINER)
@
text
@d1 12
a12 15
$OpenBSD: patch-subversion_svnserve_main_c,v 1.3.4.2 2013/08/31 08:46:30 stsp Exp $
CVE-2013-2112, CVE-2013-4277
--- subversion/svnserve/main.c.orig	Wed May 22 06:01:52 2013
+++ subversion/svnserve/main.c	Mon Oct 28 12:01:01 2013
@@@@ -403,8 +403,9 @@@@ static svn_error_t *write_pid_file(const char *filenam
   const char *contents = apr_psprintf(pool, "%" APR_PID_T_FMT "\n",
                                              getpid());
 
+  SVN_ERR(svn_io_remove_file2(filename, TRUE, pool));
   SVN_ERR(svn_io_file_open(&file, filename,
-                           APR_WRITE | APR_CREATE | APR_TRUNCATE,
+                           APR_WRITE | APR_CREATE | APR_EXCL,
                            APR_OS_DEFAULT, pool));
   SVN_ERR(svn_io_file_write_full(file, contents, strlen(contents), NULL,
                                  pool));
@


1.3.4.1
log
@For 5.3-stable: Add patches for CVE-2013-1968 and CVE-2013-2112.
@
text
@d1 12
a12 15
$OpenBSD$
CVE-2013-2112
--- subversion/svnserve/main.c.orig	Tue Oct 16 06:03:13 2012
+++ subversion/svnserve/main.c	Fri May 31 22:15:46 2013
@@@@ -928,7 +928,9 @@@@ int main(int argc, const char *argv[])
                                          connection_pool) == APR_CHILD_DONE)
             ;
         }
-      if (APR_STATUS_IS_EINTR(status))
+      if (APR_STATUS_IS_EINTR(status)
+          || APR_STATUS_IS_ECONNABORTED(status)
+          || APR_STATUS_IS_ECONNRESET(status))
         {
           svn_pool_destroy(connection_pool);
           continue;
@


1.3.4.2
log
@For 5.3-stable: Patch for CVE-2013-4277 (symlink attack on svnserve's PID file).
@
text
@d1 2
a2 2
$OpenBSD: patch-subversion_svnserve_main_c,v 1.3.4.1 2013/05/31 21:00:53 stsp Exp $
CVE-2013-2112, CVE-2013-4277
d4 2
a5 13
+++ subversion/svnserve/main.c	Sat Aug 31 00:14:19 2013
@@@@ -369,8 +369,9 @@@@ static svn_error_t *write_pid_file(const char *filenam
   const char *contents = apr_psprintf(pool, "%" APR_PID_T_FMT "\n",
                                              getpid());
 
+  SVN_ERR(svn_io_remove_file2(filename, TRUE, pool));
   SVN_ERR(svn_io_file_open(&file, filename,
-                           APR_WRITE | APR_CREATE | APR_TRUNCATE,
+                           APR_WRITE | APR_CREATE | APR_EXCL,
                            APR_OS_DEFAULT, pool));
   SVN_ERR(svn_io_file_write_full(file, contents, strlen(contents), NULL,
                                  pool));
@@@@ -928,7 +929,9 @@@@ int main(int argc, const char *argv[])
@


1.3.2.1
log
@Backport fixes for
bugs which can cause client-initiated crashes on the server.
Any server is affected, no matter which protocol (http[s]://,
svn[+ssh]://) is used.

original diff from stsp@@.
ok sthen@@
@
text
@d1 12
a12 37
$OpenBSD$
Fix blame -g server-side memory leaks.
http://svn.apache.org/viewvc?view=revision&revision=1033228
--- subversion/svnserve/main.c.orig	Tue Mar 16 02:28:01 2010
+++ subversion/svnserve/main.c	Wed Nov 24 18:02:08 2010
@@@@ -356,6 +356,7 @@@@ int main(int argc, const char *argv[])
   apr_sockaddr_t *sa;
   apr_pool_t *pool;
   apr_pool_t *connection_pool;
+  apr_allocator_t *allocator;
   svn_error_t *err;
   apr_getopt_t *os;
   int opt;
@@@@ -747,10 +748,22 @@@@ int main(int argc, const char *argv[])
         return ERROR_SUCCESS;
 #endif
 
+      /* If we are using fulltext caches etc., we will allocate many large
+         chunks of memory of various sizes outside the cachde for those
+         fulltexts. Make sure, we use the memory wisely: use an allocator
+         that causes memory fragments to be given back to the OS early. */
+
+      if (apr_allocator_create(&allocator))
+        return EXIT_FAILURE;
+
+      apr_allocator_max_free_set(allocator, SVN_ALLOCATOR_RECOMMENDED_MAX_FREE);
+
       /* Non-standard pool handling.  The main thread never blocks to join
          the connection threads so it cannot clean up after each one.  So
          separate pools, that can be cleared at thread exit, are used */
-      connection_pool = svn_pool_create(NULL);
+
+      connection_pool = svn_pool_create_ex(NULL, allocator);
+      apr_allocator_owner_set(allocator, connection_pool);
 
       status = apr_socket_accept(&usock, sock, connection_pool);
       if (handling_mode == connection_mode_fork)
@


1.2
log
@Update to 1.3.0

From Sigfred Haversen <bsdlist@@mumak.com>

ok steven@@
@
text
@d1 1
a1 1
$OpenBSD$
@


1.1
log
@work around around a bug on alpha (in binutils?), where some relocations
end up in .rodata

solution from kurt@@, closes ports/4569
@
text
@d2 3
a4 3
--- subversion/svnserve/main.c.orig	Tue Nov 29 14:28:06 2005
+++ subversion/svnserve/main.c	Tue Nov 29 14:28:15 2005
@@@@ -213,7 +213,7 @@@@ static void * APR_THREAD_FUNC serve_thre
@

