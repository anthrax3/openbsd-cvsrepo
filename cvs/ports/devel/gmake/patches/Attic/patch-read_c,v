head	1.2;
access;
symbols
	OPENBSD_5_4:1.1.0.10
	OPENBSD_5_4_BASE:1.1
	OPENBSD_5_3:1.1.0.8
	OPENBSD_5_3_BASE:1.1
	OPENBSD_5_2:1.1.0.6
	OPENBSD_5_2_BASE:1.1
	OPENBSD_5_1_BASE:1.1
	OPENBSD_5_1:1.1.0.4
	OPENBSD_5_0:1.1.0.2
	OPENBSD_5_0_BASE:1.1;
locks; strict;
comment	@# @;


1.2
date	2013.10.30.23.08.56;	author brad;	state dead;
branches;
next	1.1;

1.1
date	2011.04.20.20.51.41;	author naddy;	state Exp;
branches;
next	;


desc
@@


1.2
log
@Upgrade to gmake 4.0.

Bulk build tested by landry@@

ok sthen@@
@
text
@$OpenBSD: patch-read_c,v 1.1 2011/04/20 20:51:41 naddy Exp $

Fix Savannah bug #30612: handling of archive references with >1 object.

--- read.c.orig	Tue Jul 13 03:20:42 2010
+++ read.c	Fri Apr 15 20:47:37 2011
@@@@ -3028,7 +3028,7 @@@@ parse_file_seq (char **stringp, unsigned int size, int
             {
               /* This looks like the first element in an open archive group.
                  A valid group MUST have ')' as the last character.  */
-              const char *e = p + nlen;
+              const char *e = p;
               do
                 {
                   e = next_token (e);
@@@@ -3084,19 +3084,19 @@@@ parse_file_seq (char **stringp, unsigned int size, int
          Go to the next item in the string.  */
       if (flags & PARSEFS_NOGLOB)
         {
-          NEWELT (concat (2, prefix, tp));
+          NEWELT (concat (2, prefix, tmpbuf));
           continue;
         }
 
       /* If we get here we know we're doing glob expansion.
          TP is a string in tmpbuf.  NLEN is no longer used.
          We may need to do more work: after this NAME will be set.  */
-      name = tp;
+      name = tmpbuf;
 
       /* Expand tilde if applicable.  */
-      if (tp[0] == '~')
+      if (tmpbuf[0] == '~')
 	{
-	  tildep = tilde_expand (tp);
+	  tildep = tilde_expand (tmpbuf);
 	  if (tildep != 0)
             name = tildep;
 	}
@@@@ -3152,7 +3152,10 @@@@ parse_file_seq (char **stringp, unsigned int size, int
             else
               {
                 /* We got a chain of items.  Attach them.  */
-                (*newp)->next = found;
+                if (*newp)
+                  (*newp)->next = found;
+                else
+                  *newp = found;
 
                 /* Find and set the new end.  Massage names if necessary.  */
                 while (1)
@


1.1
log
@Update gmake to 3.82, including two important upstream fixes.
This version has some backward incompatibilities.  All affected
ports in the tree have been fixed in advance.
@
text
@d1 1
a1 1
$OpenBSD$
@

