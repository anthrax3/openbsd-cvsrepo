head	1.3;
access;
symbols
	OPENBSD_2_7:1.1.1.1.0.10
	OPENBSD_2_7_BASE:1.1.1.1
	OPENBSD_2_6:1.1.1.1.0.8
	OPENBSD_2_6_BASE:1.1.1.1
	OPENBSD_2_5:1.1.1.1.0.6
	OPENBSD_2_5_BASE:1.1.1.1
	OPENBSD_2_4:1.1.1.1.0.4
	OPENBSD_2_4_BASE:1.1.1.1
	OPENBSD_2_3:1.1.1.1.0.2
	OPENBSD_2_3_BASE:1.1.1.1
	xcept2_1_2:1.1.1.1
	xcept:1.1.1;
locks; strict;
comment	@# @;


1.3
date	2000.09.03.16.25.05;	author espie;	state dead;
branches;
next	1.2;

1.2
date	2000.06.14.22.22.28;	author angelos;	state Exp;
branches;
next	1.1;

1.1
date	97.12.31.16.50.28;	author joey;	state Exp;
branches
	1.1.1.1;
next	;

1.1.1.1
date	97.12.31.16.50.28;	author joey;	state Exp;
branches
	1.1.1.1.10.1;
next	;

1.1.1.1.10.1
date	2000.09.15.04.47.07;	author marc;	state Exp;
branches;
next	;


desc
@@


1.3
log
@Make this look like an OpenBSD port.
Mark as unbroken.
@
text
@--- xcept/makefile.orig	Fri May 13 12:19:55 1994
+++ xcept/makefile	Sun Sep  1 14:27:37 1996
@@@@ -48,23 +48,31 @@@@
 #   should be displayed in the scripts menu. (Only used when not
 #   overridden by enironment variable XCEPTSCRIPTS or by command line
 #   option '-S').
-SCRIPTSDIR = /usr/local/btx
+SCRIPTSDIR = ${PREFIX}/lib/xcept
 
 
 #define compiler and X11 include+library pathes 
-CC	= gcc
-XINC	= -I/usr/X386/include
-XLIB	= -L/usr/X386/lib
+#CC	= gcc
+XINC	= -I${X11BASE}/include
+XLIB	= -L${X11BASE}/lib
 #WARN	= -W -Wunused -Wswitch -Wcomment -Wshadow -Wpointer-arith -Wcast-qual
 
 
 #define location of the xcept binary and online manual (for 'make install').
 OWNER	= bin
-GROUP	= uucp
-MODE	= 755
+GROUP	= bin
+BINMODE	= 755
-BINDIR	= /usr/local/bin
-MANDIR	= /usr/local/man/manl
+BINDIR	= ${PREFIX}/bin
+MANDIR	= ${PREFIX}/man/man1
+MANMODE = 644
 
+.ifdef NOMANCOMPRESS
+MANPAGE = xcept.1
+.else
+MANPAGE = xcept.1.gz
+MANCOMPRESS = gzip -c -9
+MANCLEAN = ${MANPAGE}
+.endif
 
 
 
@@@@ -73,7 +81,7 @@@@
 DEFS	= -DDEFAULTCEPTHOSTNAME=\"$(SERVERHOST)\"      \
 	  -DDEFAULTSOCKETPORT=$(SERVERPORT)           \
 	  -DXCEPTSCRIPTS_DEFAULTPATH=\"$(SCRIPTSDIR)\"		
-CFLAGS	= $(XINC) $(WARN) $(DEFS)
+CFLAGS	+= $(XINC) $(WARN) $(DEFS)
 
 
 SRCS = 	xcept.c xfont.c rawfont.c xwin.c layer6.c socket.c buttons.c \
@@@@ -84,34 +92,31 @@@@
 
 
 
-all:		xcept
+all:		xcept ${MANPAGE}
 
 xcept:		$(OBJS)
-		@@echo 'linking $@@'
-		@@$(CC) $(OBJS) -o xcept $(XLIB) -lX11 -lnsl -lsocket /usr/ucblib/libucb.a
+		$(CC) $(OBJS) -o xcept $(XLIB) -lX11
 
 $(OBJS):
-		@@echo 'compiling $*.c'
-		@@$(CC) $(CFLAGS) -c $*.c
+		$(CC) $(CFLAGS) -c $*.c
 
 
 tags:		$(SRCS)
 		etags -e $(SRCS)
 
-install:	xcept
-		strip xcept
-		mv xcept $(BINDIR)
-		-chown $(OWNER) $(BINDIR)/xcept
-		-chgrp $(GROUP) $(BINDIR)/xcept
-		chmod $(MODE)   $(BINDIR)/xcept
-		cp xcept.1 $(MANDIR)
-		-chown $(OWNER) $(MANDIR)/xcept.1
-		-chgrp $(GROUP) $(MANDIR)/xcept.1
-		chmod 644       $(MANDIR)/xcept.1
-
+.ifndef NOMANCOMPRESS
+${MANPAGE}: xcept.1
+	${MANCOMPRESS} < xcept.1 > ${MANPAGE}
+.endif
+
+install:	all
+		${INSTALL} -c -o ${OWNER} -g ${GROUP} -m ${BINMODE} xcept\
+		${BINDIR}/xcept
+		${INSTALL} -c -o ${OWNER} -g ${GROUP} -m ${MANMODE}\
+		${MANPAGE} ${MANDIR}/${MANPAGE}
 
 clean:
-		@@rm -f $(OBJS) xcept
+		@@rm -f $(OBJS) xcept ${MANCLEAN}
 
 
 
--- xcept/script.c.orig	Fri Sep 24 16:07:29 1993
+++ xcept/script.c	Sun Sep  1 14:08:13 1996
@@@@ -809,7 +809,6 @@@@
    if(a->value == b->value)
       return error("pc: %d - variables don't differ!\n",pc);
    len = strlen(a->value) + strlen(b->value) + 1;
-   free(a->value);
    if(!(a->value = ralloc(a->value,len))) return errorp("realloc\n");
    strcat(a->value,b->value);
    
@@@@ -1082,7 +1082,8 @@@@
 	    printf( "%s", b->value );
 	    fflush(stdout);
 	 }
-	 gets(tmpstr); 
+	 fgets(tmpstr, 300, stdin); 
+	 if ((ptr = strchr(tmpstr, '\n'))) *ptr = '\0';
    }
    else if(visible) {
       if(echo) {
@@@@ -1105,7 +1106,8 @@@@
 	 }
 	 printf("?  ");
 	 fflush(stdout);
-	 gets(tmpstr); 
+	 fgets(tmpstr, 300, stdin); 
+	 if ((ptr = strchr(tmpstr, '\n'))) *ptr = '\0';
 	 if( !strlen(tmpstr) ) strncpy( tmpstr, c->value, sizeof(tmpstr)-1 );
       }
    }
--- xcept/xcept.c.orig	Mon Apr 25 16:13:26 1994
+++ xcept/xcept.c	Sun Sep  1 14:01:54 1996
@@@@ -945,7 +945,6 @@@@
 int perr, p1, p2, p3, p4, p5, p6, p7, p8;
 {
    extern int errno;
-   extern char *sys_errlist[];
    static char errstr[200];
 
    if(!visible) {
@


1.2
log
@Fix installation and fake.
@
text
@@


1.1
log
@Initial revision
@
text
@d8 1
a8 1
+SCRIPTSDIR = /usr/local/lib/xcept
d27 1
a27 1
 BINDIR	= /usr/local/bin
d29 2
a30 1
+MANDIR	= /usr/local/man/man1
@


1.1.1.1
log
@
xcept
@
text
@@


1.1.1.1.10.1
log
@bring comms as of cut-over date into 2.7 branch
@
text
@d8 1
a8 1
+SCRIPTSDIR = ${PREFIX}/lib/xcept
d27 1
a27 1
-BINDIR	= /usr/local/bin
d29 1
a29 2
+BINDIR	= ${PREFIX}/bin
+MANDIR	= ${PREFIX}/man/man1
@

