head	1.5;
access;
symbols
	OPENBSD_6_0:1.5.0.8
	OPENBSD_6_0_BASE:1.5
	OPENBSD_5_9:1.5.0.4
	OPENBSD_5_9_BASE:1.5
	OPENBSD_5_8:1.5.0.6
	OPENBSD_5_8_BASE:1.5
	OPENBSD_5_7:1.5.0.2
	OPENBSD_5_7_BASE:1.5
	OPENBSD_5_6:1.3.0.26
	OPENBSD_5_6_BASE:1.3
	OPENBSD_5_5:1.3.0.24
	OPENBSD_5_5_BASE:1.3
	OPENBSD_5_4:1.3.0.22
	OPENBSD_5_4_BASE:1.3
	OPENBSD_5_3:1.3.0.20
	OPENBSD_5_3_BASE:1.3
	OPENBSD_5_2:1.3.0.18
	OPENBSD_5_2_BASE:1.3
	OPENBSD_5_1_BASE:1.3
	OPENBSD_5_1:1.3.0.16
	OPENBSD_5_0:1.3.0.14
	OPENBSD_5_0_BASE:1.3
	OPENBSD_4_9:1.3.0.12
	OPENBSD_4_9_BASE:1.3
	OPENBSD_4_8:1.3.0.10
	OPENBSD_4_8_BASE:1.3
	OPENBSD_4_7:1.3.0.8
	OPENBSD_4_7_BASE:1.3
	OPENBSD_4_6:1.3.0.6
	OPENBSD_4_6_BASE:1.3
	OPENBSD_4_5:1.3.0.4
	OPENBSD_4_5_BASE:1.3
	OPENBSD_4_4:1.3.0.2
	OPENBSD_4_4_BASE:1.3
	OPENBSD_4_3:1.2.0.12
	OPENBSD_4_3_BASE:1.2
	OPENBSD_4_2:1.2.0.10
	OPENBSD_4_2_BASE:1.2
	OPENBSD_4_1:1.2.0.8
	OPENBSD_4_1_BASE:1.2
	OPENBSD_4_0:1.2.0.6
	OPENBSD_4_0_BASE:1.2
	OPENBSD_3_9:1.2.0.4
	OPENBSD_3_9_BASE:1.2
	OPENBSD_3_8:1.2.0.2
	OPENBSD_3_8_BASE:1.2
	OPENBSD_3_7:1.1.0.8
	OPENBSD_3_7_BASE:1.1
	OPENBSD_3_6:1.1.0.6
	OPENBSD_3_6_BASE:1.1
	OPENBSD_3_5:1.1.0.4
	OPENBSD_3_5_BASE:1.1
	OPENBSD_3_4:1.1.0.2
	OPENBSD_3_4_BASE:1.1;
locks; strict;
comment	@# @;


1.5
date	2014.10.07.22.14.17;	author sthen;	state Exp;
branches;
next	1.4;
commitid	a1IT1kguOal23Uj8;

1.4
date	2014.09.08.16.12.11;	author sthen;	state Exp;
branches;
next	1.3;
commitid	e1jNM87A2LcUOgkW;

1.3
date	2008.06.21.11.29.25;	author sthen;	state Exp;
branches;
next	1.2;

1.2
date	2005.08.02.07.25.47;	author pvalchev;	state Exp;
branches;
next	1.1;

1.1
date	2003.05.26.20.20.53;	author pvalchev;	state Exp;
branches;
next	;


desc
@@


1.5
log
@update conserver to 8.2.0, and make some port changes ...

- Switch to using unix domain sockets instead of network sockets for
comms between "console" client and "conserver" server. This is a compile-
time toggle and disables network sockets. Uses SO_PEERCRED for access
control so it's possible to do per-user acls in conserver without
the need to re-enter user passwords.

- Add a flavour to use network sockets for those that need it (i.e.
running the client on a different machine to the server).

- Tweaks to pkg-readme explaining the above.
@
text
@$OpenBSD: patch-conserver_consent_c,v 1.4 2014/09/08 16:12:11 sthen Exp $
--- conserver/consent.c.orig	Sun Apr 20 08:14:49 2014
+++ conserver/consent.c	Tue Oct  7 16:49:57 2014
@@@@ -521,7 +521,8 @@@@ SetupTty(CONSENT *pCE, int fd)
     if (0 != tcgetattr(1, &n_tio)) {
 	exit(EX_OSERR);
     }
-    n_tio.c_iflag &= ~(IGNCR | IUCLC);
+
+    n_tio.c_iflag &= ~(IGNCR);
     n_tio.c_iflag |= ICRNL;
     if (pCE->ixon == FLAGTRUE)
 	n_tio.c_iflag |= IXON;
@@@@ -529,10 +530,8 @@@@ SetupTty(CONSENT *pCE, int fd)
 	n_tio.c_iflag |= IXANY;
     if (pCE->ixoff == FLAGTRUE)
 	n_tio.c_iflag |= IXOFF;
-    n_tio.c_oflag &=
-	~(OLCUC | ONOCR | ONLRET | OFILL | NLDLY | CRDLY | TABDLY | BSDLY);
     n_tio.c_oflag |= OPOST | ONLCR;
-    n_tio.c_lflag &= ~(XCASE | NOFLSH | ECHOK | ECHONL);
+    n_tio.c_lflag &= ~(NOFLSH|ECHOK|ECHONL);
     n_tio.c_lflag |= ISIG | ICANON | ECHO;
     n_tio.c_cc[VEOF] = '\004';
     n_tio.c_cc[VEOL] = '\000';
@


1.4
log
@update to conserver 8.1.20, add more notes for upgrading users on how to
unbreak things following the uid change
@
text
@d1 4
a4 4
$OpenBSD: patch-conserver_consent_c,v 1.3 2008/06/21 11:29:25 sthen Exp $
--- conserver/consent.c.orig	Fri Apr  4 06:34:13 2014
+++ conserver/consent.c	Tue Sep  2 20:24:00 2014
@@@@ -557,7 +557,8 @@@@ SetupTty(pCE, fd)
d14 1
a14 1
@@@@ -565,10 +566,8 @@@@ SetupTty(pCE, fd)
@


1.3
log
@Update conserver to 8.1.16, which fixes some bugs, rolls in
pvalchev's strcpy->strlcpy diffs, and adds some new functionality
(see http://www.conserver.com/CHANGES for more details).
Our /etc/services now includes a definition for conserver,
so no need to mention it in the package installation message.

ok pvalchev (maintainer).
@
text
@d1 6
a6 6
$OpenBSD: patch-conserver_consent_c,v 1.2 2005/08/02 07:25:47 pvalchev Exp $
--- conserver/consent.c.orig	Mon Apr  9 16:52:28 2007
+++ conserver/consent.c	Fri Oct 12 11:29:17 2007
@@@@ -587,7 +587,8 @@@@ VirtDev(pCE)
 	Error("[%s] tcgetattr(0): %s", pCE->server, strerror(errno));
 	Bye(EX_OSERR);
d14 1
a14 1
@@@@ -595,10 +596,8 @@@@ VirtDev(pCE)
@


1.2
log
@update to conserver-8.1.11 with help from aanriot
@
text
@d1 4
a4 4
$OpenBSD$
--- conserver/consent.c.orig	Thu Jun 23 23:28:58 2005
+++ conserver/consent.c	Thu Jun 23 23:30:52 2005
@@@@ -528,7 +528,8 @@@@ VirtDev(pCE)
d14 1
a14 1
@@@@ -536,10 +537,8 @@@@ VirtDev(pCE)
@


1.1
log
@Update to conserver-7.2.7. many many changes to list, see http://www.conserver.com
some minor tweaks may still be coming
@
text
@d2 4
a5 14
--- conserver/consent.c.orig	Sun Apr  6 06:32:41 2003
+++ conserver/consent.c	Sat May 24 14:14:43 2003
@@@@ -45,8 +45,8 @@@@
 #include <sys/file.h>
 #include <sys/stat.h>
 #include <fcntl.h>
-#include <arpa/inet.h>
 #include <netinet/in.h>
+#include <arpa/inet.h>
 #include <netdb.h>
 #include <stdio.h>
 #include <ctype.h>
@@@@ -508,12 +508,11 @@@@ VirtDev(pCE)
 	      strerror(errno));
d11 7
a17 1
     n_tio.c_iflag |= ICRNL | IXON | IXANY;
@

