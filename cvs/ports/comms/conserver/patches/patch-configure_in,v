head	1.5;
access;
symbols
	OPENBSD_6_0:1.5.0.4
	OPENBSD_6_0_BASE:1.5
	OPENBSD_5_9:1.5.0.2
	OPENBSD_5_9_BASE:1.5
	OPENBSD_5_8:1.4.0.6
	OPENBSD_5_8_BASE:1.4
	OPENBSD_5_7:1.4.0.2
	OPENBSD_5_7_BASE:1.4
	OPENBSD_4_3:1.2.0.12
	OPENBSD_4_3_BASE:1.2
	OPENBSD_4_2:1.2.0.10
	OPENBSD_4_2_BASE:1.2
	OPENBSD_4_1:1.2.0.8
	OPENBSD_4_1_BASE:1.2
	OPENBSD_4_0:1.2.0.6
	OPENBSD_4_0_BASE:1.2
	OPENBSD_3_9:1.2.0.4
	OPENBSD_3_9_BASE:1.2
	OPENBSD_3_8:1.2.0.2
	OPENBSD_3_8_BASE:1.2
	OPENBSD_3_7:1.1.0.8
	OPENBSD_3_7_BASE:1.1
	OPENBSD_3_6:1.1.0.6
	OPENBSD_3_6_BASE:1.1
	OPENBSD_3_5:1.1.0.4
	OPENBSD_3_5_BASE:1.1
	OPENBSD_3_4:1.1.0.2
	OPENBSD_3_4_BASE:1.1;
locks; strict;
comment	@# @;


1.5
date	2015.08.11.21.13.14;	author sthen;	state Exp;
branches;
next	1.4;
commitid	9hl79octDlLWtXEa;

1.4
date	2014.10.07.22.14.17;	author sthen;	state Exp;
branches;
next	1.3;
commitid	a1IT1kguOal23Uj8;

1.3
date	2008.06.21.11.29.25;	author sthen;	state dead;
branches;
next	1.2;

1.2
date	2005.08.02.07.25.47;	author pvalchev;	state Exp;
branches;
next	1.1;

1.1
date	2003.05.26.20.20.53;	author pvalchev;	state Exp;
branches;
next	;


desc
@@


1.5
log
@add a flavour to build comms/conserver with internal IPMI console support
@
text
@$OpenBSD: patch-configure_in,v 1.4 2014/10/07 22:14:17 sthen Exp $
--- configure.in.orig	Thu Apr 17 22:55:38 2014
+++ configure.in	Thu Jul 30 16:52:11 2015
@@@@ -413,14 +413,14 @@@@ AC_ARG_WITH(uds,
 			    AC_TRY_COMPILE([#include <sys/types.h>
 				    #include <sys/socket.h>],
 				    [
-struct ucred u;
+struct sockpeercred u;
 u.uid = 0;
 #if !defined(SO_PEERCRED)
 #error "no SO_PEERCRED defined"
 #endif
 				    ],
 				    [AC_MSG_RESULT(yes)
-				     AC_DEFINE(UDS_CRED_STYPE, ucred, [Defined to UDS credential structure name])
+				     AC_DEFINE(UDS_CRED_STYPE, sockpeercred, [Defined to UDS credential structure name])
 				     AC_DEFINE(UDS_CRED_UID, uid, [Defined to UDS credential structure uid field])
 				     AC_DEFINE(UDS_CRED_SO, SO_PEERCRED, [Defined to UDS credential socket option])
 				     AC_DEFINE(TRUST_UDS_CRED)],
@@@@ -428,18 +428,34 @@@@ u.uid = 0;
 					AC_TRY_COMPILE([#include <sys/types.h>
 						#include <sys/socket.h>],
 						[
+struct ucred u;
+u.euid = 0;
+#if !defined(SO_PEERCRED)
+#error "no SO_PEERCRED defined"
+#endif
+						],
+				    		[AC_MSG_RESULT(yes)
+				     		AC_DEFINE(UDS_CRED_STYPE, ucred, [Defined to UDS credential structure name])
+				     		AC_DEFINE(UDS_CRED_UID, uid, [Defined to UDS credential structure uid field])
+				     		AC_DEFINE(UDS_CRED_SO, SO_PEERCRED, [Defined to UDS credential socket option])
+				     		AC_DEFINE(TRUST_UDS_CRED)],
+						[
+							AC_TRY_COMPILE([#include <sys/types.h>
+								#include <sys/socket.h>],
+								[
 struct peercred_struct u;
 u.euid = 0;
 #if !defined(SO_PEERID)
 #error "no SO_PEERID defined"
 #endif
-						],
-						[AC_MSG_RESULT(yes)
-						 AC_DEFINE(UDS_CRED_STYPE, peercred_struct, [Defined to UDS credential structure name])
-						 AC_DEFINE(UDS_CRED_UID, euid, [Defined to UDS credential structure uid field])
-						 AC_DEFINE(UDS_CRED_SO, SO_PEERID, [Defined to UDS credential socket option])
-						 AC_DEFINE(TRUST_UDS_CRED)],
-						[AC_MSG_RESULT(no)])
+								],
+								[AC_MSG_RESULT(yes)
+								 AC_DEFINE(UDS_CRED_STYPE, peercred_struct, [Defined to UDS credential structure name])
+								 AC_DEFINE(UDS_CRED_UID, euid, [Defined to UDS credential structure uid field])
+								 AC_DEFINE(UDS_CRED_SO, SO_PEERID, [Defined to UDS credential socket option])
+								 AC_DEFINE(TRUST_UDS_CRED)],
+								[AC_MSG_RESULT(no)]),
+						    ])
 				    ])
 			    ;;
 			*)
@@@@ -653,27 +669,26 @@@@ AC_ARG_WITH(freeipmi,
 		FREEIPMILDFLAGS="-L$withval/lib -R$withval/lib"
 	    fi
 	else
-	    FREEIPMICPPFLAGS=""
-	    FREEIPMILDFLAGS=""
+	    FREEIPMICPPFLAGS="`pkg-config --cflags libfreeipmi`"
+	    FREEIPMILDFLAGS="`pkg-config --libs libfreeipmi`"
 	fi
 
 	oCPPFLAGS="$CPPFLAGS"
 	oLDFLAGS="$LDFLAGS"
 	oLIBS="$LIBS"
 	have_freeipmi=no
-
 	CPPFLAGS="$CPPFLAGS $FREEIPMICPPFLAGS"
 	LDFLAGS="$LDFLAGS $FREEIPMILDFLAGS"
 
 	AC_CHECK_HEADER([ipmiconsole.h],
-	    [LIBS="$LIBS -lipmiconsole"
+	    [LIBS="$LIBS `pkg-config --libs libipmiconsole`"
 	    AC_MSG_CHECKING(for freeipmi libraries -lipmiconsole)
 	    AC_TRY_LINK([#include <ipmiconsole.h>
 		],[ipmiconsole_ctx_fd(0)],
 		[AC_MSG_RESULT(yes)
 		cons_with_freeipmi="YES"
 		AC_DEFINE(HAVE_FREEIPMI)
-		CONSLIBS="$CONSLIBS -lipmiconsole"
+		CONSLIBS="$CONSLIBS `pkg-config --libs libipmiconsole`"
 		have_freeipmi=yes],
 		[AC_MSG_RESULT(no)])],)
 
@


1.4
log
@update conserver to 8.2.0, and make some port changes ...

- Switch to using unix domain sockets instead of network sockets for
comms between "console" client and "conserver" server. This is a compile-
time toggle and disables network sockets. Uses SO_PEERCRED for access
control so it's possible to do per-user acls in conserver without
the need to re-enter user passwords.

- Add a flavour to use network sockets for those that need it (i.e.
running the client on a different machine to the server).

- Tweaks to pkg-readme explaining the above.
@
text
@d1 3
a3 3
$OpenBSD$
--- configure.in.orig	Fri Apr 18 05:55:38 2014
+++ configure.in	Tue Oct  7 21:24:43 2014
d63 32
@


1.3
log
@Update conserver to 8.1.16, which fixes some bugs, rolls in
pvalchev's strcpy->strlcpy diffs, and adds some new functionality
(see http://www.conserver.com/CHANGES for more details).
Our /etc/services now includes a definition for conserver,
so no need to mention it in the package installation message.

ok pvalchev (maintainer).
@
text
@d1 62
a62 12
$OpenBSD: patch-configure_in,v 1.2 2005/08/02 07:25:47 pvalchev Exp $
--- configure.in.orig	Thu Jun 23 23:10:15 2005
+++ configure.in	Thu Jun 23 23:10:59 2005
@@@@ -326,7 +326,7 @@@@ if test "$ac_cv_sys_posix_termios" != "y
     AC_MSG_ERROR([POSIX termios interface required])
 fi
 
-AC_CHECK_HEADERS(unistd.h getopt.h sys/vlimit.h sys/resource.h ttyent.h sys/ttold.h sys/uio.h sys/ioctl_compat.h usersec.h sys/select.h stropts.h sys/audit.h shadow.h sys/time.h crypt.h sysexits.h types.h sys/sockio.h sys/param.h)
+AC_CHECK_HEADERS(unistd.h getopt.h sys/vlimit.h sys/resource.h ttyent.h sys/ttold.h sys/uio.h sys/types.h sys/param.h sys/proc.h sys/ioctl_compat.h usersec.h sys/select.h stropts.h sys/audit.h shadow.h sys/time.h crypt.h sysexits.h types.h)
 dnl sys/proc.h needs sys/param.h on openbsd, apparently
 AC_CHECK_HEADERS(sys/proc.h, [], [],
 [#if HAVE_SYS_PARAM_H
@


1.2
log
@update to conserver-8.1.11 with help from aanriot
@
text
@d1 1
a1 1
$OpenBSD$
@


1.1
log
@Update to conserver-7.2.7. many many changes to list, see http://www.conserver.com
some minor tweaks may still be coming
@
text
@d2 4
a5 4
--- configure.in.orig	Sat May 24 13:54:37 2003
+++ configure.in	Sat May 24 13:55:07 2003
@@@@ -231,7 +231,7 @@@@ if test "$ac_cv_header_termios_h" != "ye
   fi
d8 1
a8 1
-AC_CHECK_HEADERS(unistd.h getopt.h sys/vlimit.h sys/resource.h ttyent.h sys/ttold.h sys/uio.h sys/proc.h sys/ioctl_compat.h usersec.h sys/select.h stropts.h sys/audit.h shadow.h sys/time.h crypt.h sysexits.h types.h)
d10 3
a12 3
 AC_HEADER_TIME
 AC_HEADER_SYS_WAIT
 AC_TYPE_MODE_T
@

