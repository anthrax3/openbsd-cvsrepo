head	1.4;
access;
symbols
	OPENBSD_6_1:1.4.0.14
	OPENBSD_6_1_BASE:1.4
	OPENBSD_6_0:1.4.0.12
	OPENBSD_6_0_BASE:1.4
	OPENBSD_5_9:1.4.0.8
	OPENBSD_5_9_BASE:1.4
	OPENBSD_5_8:1.4.0.10
	OPENBSD_5_8_BASE:1.4
	OPENBSD_5_7:1.4.0.6
	OPENBSD_5_7_BASE:1.4
	OPENBSD_5_6:1.4.0.4
	OPENBSD_5_6_BASE:1.4
	OPENBSD_5_5:1.4.0.2
	OPENBSD_5_5_BASE:1.4
	OPENBSD_5_4:1.3.0.4
	OPENBSD_5_4_BASE:1.3
	OPENBSD_5_3:1.3.0.2
	OPENBSD_5_3_BASE:1.3
	OPENBSD_5_2:1.2.0.4
	OPENBSD_5_2_BASE:1.2
	OPENBSD_5_1_BASE:1.2
	OPENBSD_5_1:1.2.0.2
	OPENBSD_5_0:1.1.0.20
	OPENBSD_5_0_BASE:1.1
	OPENBSD_4_9:1.1.0.18
	OPENBSD_4_9_BASE:1.1
	OPENBSD_4_8:1.1.0.16
	OPENBSD_4_8_BASE:1.1
	OPENBSD_4_7:1.1.0.14
	OPENBSD_4_7_BASE:1.1
	OPENBSD_4_6:1.1.0.12
	OPENBSD_4_6_BASE:1.1
	OPENBSD_4_5:1.1.0.10
	OPENBSD_4_5_BASE:1.1
	OPENBSD_4_4:1.1.0.8
	OPENBSD_4_4_BASE:1.1
	OPENBSD_4_3:1.1.0.6
	OPENBSD_4_3_BASE:1.1
	OPENBSD_4_2:1.1.0.4
	OPENBSD_4_2_BASE:1.1
	OPENBSD_4_1:1.1.0.2
	OPENBSD_4_1_BASE:1.1;
locks; strict;
comment	@# @;


1.4
date	2013.08.07.19.16.48;	author naddy;	state Exp;
branches;
next	1.3;

1.3
date	2012.12.07.15.16.49;	author naddy;	state Exp;
branches;
next	1.2;

1.2
date	2011.11.14.19.33.34;	author naddy;	state Exp;
branches;
next	1.1;

1.1
date	2006.12.14.21.19.19;	author naddy;	state Exp;
branches;
next	;


desc
@@


1.4
log
@remove workarounds for gcc 2.95
@
text
@$OpenBSD: patch-wy60_c,v 1.3 2012/12/07 15:16:49 naddy Exp $
--- wy60.c.orig	Sat Feb  3 05:07:20 2007
+++ wy60.c	Wed Dec  5 21:09:50 2012
@@@@ -5333,7 +5333,9 @@@@ static int forkPty(int *fd, char *name) {
 
   /* Try to let the standard C library open a pty pair for us                */
 #if HAVE_GRANTPT
-#if HAVE_GETPT
+#if HAVE_POSIX_OPENPT
+  master             = posix_openpt(O_RDWR|O_NOCTTY);
+#elif HAVE_GETPT
   master             = getpt();
 #else
   master             = open("/dev/ptmx", O_RDWR);
@


1.3
log
@use posix_openpt(3)
@
text
@d1 1
a1 4
$OpenBSD: patch-wy60_c,v 1.2 2011/11/14 19:33:34 naddy Exp $

Don't mix mixed declarations and code, for gcc2.95.

a3 11
@@@@ -3347,9 +3347,9 @@@@ static void userInputReceived(int pty, const char *buf
   for (i = 0; i < count; i++) {
     char ch                  = buffer[i];
 
-    logHostKey(ch);
     KeyDefs *nextKeySequence = currentKeySequence
                                ? currentKeySequence->down : keyDefinitions;
+    logHostKey(ch);
 
 
     for (;;) {
@


1.2
log
@maintenance update to 2.0.9
@
text
@d1 1
a1 1
$OpenBSD: patch-wy60_c,v 1.1 2006/12/14 21:19:19 naddy Exp $
d5 2
a6 2
--- wy60.c.orig	Mon Nov 14 20:08:56 2011
+++ wy60.c	Mon Nov 14 20:10:07 2011
d18 11
@


1.1
log
@proactively fix building with gcc4; problem reported on FreeBSD
@
text
@d1 14
a14 5
$OpenBSD$
--- wy60.c.orig	Thu Dec 14 21:06:17 2006
+++ wy60.c	Thu Dec 14 21:36:54 2006
@@@@ -59,6 +59,17 @@@@ typedef struct ScreenBuffer {
 } ScreenBuffer;
d17 1
a17 89
+static void flushConsole(void);
+static void gotoXYforce(int x, int y);
+static void putCapability(const char *capability);
+static int  putConsole(int ch);
+static void putGraphics(char ch);
+static void showCursor(int flag);
+static void updateAttributes(void);
+static void failure(int exitCode, const char *message, ...);
+static void processSignal(int signalNumber, int pid, int pty);
+
+
 static int            euid, egid, uid, gid, oldStylePty, streamsIO, jobControl;
 static char           ptyName[40];
 static struct termios defaultTermios;
@@@@ -260,7 +271,6 @@@@ static void logCharacters(int mode, cons
       logFd            = -1;
   }
   if (logFd >= 0) {
-    static void flushConsole(void);
     int  header[4];
 
     gettimeofday(&timeValue, 0);
@@@@ -295,7 +305,6 @@@@ static void logHostCharacter(int mode, c
   }
 
   if (logFd >= 0) {
-    static void flushConsole(void);
     char buffer[80];
 
     if (isatty(logFd))
@@@@ -369,8 +378,6 @@@@ static void logDecode(const char *format
 
 static void logDecodeFlush(void) {
   if (_decodeFd >= 0) {
-    static void flushConsole(void);
-
     if (isatty(_decodeFd))
       strcat(_decodeBuffer, "\x1B[39m");
     strcat(_decodeBuffer, "\r\n");
@@@@ -2203,14 +2210,6 @@@@ static ScreenBuffer *adjustScreenBuffer(
 
 
 static void displayCurrentScreenBuffer(void) {
-  static void flushConsole(void);
-  static void gotoXYforce(int x, int y);
-  static void putCapability(const char *capability);
-  static int  putConsole(int ch);
-  static void putGraphics(char ch);
-  static void showCursor(int flag);
-  static void updateAttributes(void);
-
   int x, y, lastAttributes      = -1;
   int oldX                      = currentBuffer->cursorX;
   int oldY                      = currentBuffer->cursorY;
@@@@ -2346,8 +2345,6 @@@@ static int putConsole(int ch) {
 
 
 static void putCapability(const char *capability) {
-  static void failure(int exitCode, const char *message, ...);
-
   if (!capability || !strcmp(capability, "@@"))
     failure(127, "Terminal has insufficient capabilities");
   logHostString(capability);
@@@@ -2756,8 +2753,6 @@@@ static void setPage(int page) {
 
 
 static void putGraphics(char ch) {
-  static void updateAttributes(void);
-
   if (ch == '\x02')
     graphicsMode                  = 1;
   else if (ch == '\x03')
@@@@ -2839,7 +2834,6 @@@@ static void showCursor(int flag) {
 
 
 static void executeExternalProgram(const char *argv[]) {
-  static void failure(int exitCode, const char *message, ...);
   int    pid, status;
 
   if ((pid = fork()) < 0) {
@@@@ -2886,8 +2880,6 @@@@ static void executeExternalProgram(const
 
 
 static void requestNewGeometry(int pty, int width, int height) {
-  static void processSignal(int signalNumber, int pid, int pty);
-
   logDecode("setScreenSize(%d,%d)", width, height);
 
   if (screenWidth != width || screenHeight != height) {
@

