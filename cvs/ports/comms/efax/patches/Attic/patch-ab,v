head	1.3;
access;
symbols
	OPENBSD_3_1:1.2.0.12
	OPENBSD_3_1_BASE:1.2
	OPENBSD_3_0:1.2.0.10
	OPENBSD_3_0_BASE:1.2
	OPENBSD_2_9_TRACKING_SWITCH:1.2
	OPENBSD_2_9:1.2.0.8
	OPENBSD_2_9_BASE:1.2
	OPENBSD_2_8:1.2.0.6
	OPENBSD_2_8_BASE:1.2
	OPENBSD_2_7:1.2.0.4
	OPENBSD_2_7_BASE:1.2
	OPENBSD_2_6:1.2.0.2
	OPENBSD_2_6_BASE:1.2
	OPENBSD_2_5:1.1.0.4
	OPENBSD_2_5_BASE:1.1
	OPENBSD_2_4:1.1.0.2
	OPENBSD_2_4_BASE:1.1;
locks; strict;
comment	@# @;


1.3
date	2002.07.17.22.45.09;	author lebel;	state dead;
branches;
next	1.2;

1.2
date	99.08.19.20.52.28;	author downsj;	state Exp;
branches;
next	1.1;

1.1
date	98.09.06.22.39.52;	author ian;	state Exp;
branches;
next	;


desc
@@


1.3
log
@respect ${CC} and rename patches
@
text
@*** efax.c.orig	Sat Mar 27 06:24:10 1999
--- efax.c	Thu Aug 19 13:33:41 1999
***************
*** 606,612 ****
    if ( ckfmt ( header, 6 ) )
      msg ( "W too many %%d escapes in header format string \"%s\"", header ) ;
    else
!     sprintf ( headerbuf, header, page, pages, page, pages, page, pages ) ;
    msg ("I header:[%s]", headerbuf ) ;
        
    done = err = ttymode ( mf, SEND ) ; 
--- 606,612 ----
    if ( ckfmt ( header, 6 ) )
      msg ( "W too many %%d escapes in header format string \"%s\"", header ) ;
    else
!     snprintf ( headerbuf, sizeof headerbuf, header, page, pages, page, pages, page, pages ) ;
    msg ("I header:[%s]", headerbuf ) ;
        
    done = err = ttymode ( mf, SEND ) ; 
***************
*** 1658,1664 ****
      err = rdpage ( inf, dp, &ppm, local, &changed ) ;
  
      if ( ! err && changed ) {
!       sprintf ( buf, c20 ? "+FIS=%d,%d,%d,%d" : "+FDIS=%d,%d,%d,%d", 
  	       local[0], local[1], local[2], local[3] ) ;
        ckcmd ( mf, 0, buf, TO_FT, OK ) ;
        if ( gethsc ( &hsc, &err ) ) {
--- 1658,1665 ----
      err = rdpage ( inf, dp, &ppm, local, &changed ) ;
  
      if ( ! err && changed ) {
!       snprintf ( buf, sizeof buf,
!       	       c20 ? "+FIS=%d,%d,%d,%d" : "+FDIS=%d,%d,%d,%d", 
  	       local[0], local[1], local[2], local[3] ) ;
        ckcmd ( mf, 0, buf, TO_FT, OK ) ;
        if ( gethsc ( &hsc, &err ) ) {
***************
*** 1816,1822 ****
    int err=0, hsc=-1 ;
    char c, dsbuf [ 128 ], *p ;
  
!   sprintf ( dsbuf, nowait ? "D%.126s;" : "D%.127s" , s ) ;
    msg ( "Idialing %s", dsbuf+1 ) ;
  
    c = cmd ( f, dsbuf, TO_A ) ;
--- 1817,1823 ----
    int err=0, hsc=-1 ;
    char c, dsbuf [ 128 ], *p ;
  
!   snprintf ( dsbuf, sizeof dsbuf, nowait ? "D%.126s;" : "D%.127s" , s ) ;
    msg ( "Idialing %s", dsbuf+1 ) ;
  
    c = cmd ( f, dsbuf, TO_A ) ;
***************
*** 1944,1950 ****
  	if ( ckfmt ( getty, 6 ) ) {
  	  err = msg ( "E3 too many %%d escapes in command (%s)", getty ) ;
  	} else {
! 	  sprintf ( buf, getty, crate, crate, crate, crate, crate, crate ) ;
  	  msg ( "Iexec'ing /bin/sh -c \"%s\"" , buf ) ;
  	  execl ( "/bin/sh" , "sh" , "-c" , buf , (void*) 0 ) ; 
  	  err = msg ( "ES2exec failed:" ) ;
--- 1945,1951 ----
  	if ( ckfmt ( getty, 6 ) ) {
  	  err = msg ( "E3 too many %%d escapes in command (%s)", getty ) ;
  	} else {
! 	  snprintf ( buf, sizeof buf, getty, crate, crate, crate, crate, crate, crate ) ;
  	  msg ( "Iexec'ing /bin/sh -c \"%s\"" , buf ) ;
  	  execl ( "/bin/sh" , "sh" , "-c" , buf , (void*) 0 ) ; 
  	  err = msg ( "ES2exec failed:" ) ;
***************
*** 1963,1969 ****
  	char buf [ MAXGETTY ] ;
  	if ( ckfmt ( vcmd, 6 ) ) {
  	} else {
! 	  sprintf ( buf, vcmd, f->fd, f->fd, f->fd, f->fd, f->fd, f->fd ) ;
  	  msg ( "Iexec'ing /bin/sh -c \"%s\"" , buf ) ;
  	  execl ( "/bin/sh" , "sh" , "-c" , buf , (void*) 0 ) ; 
  	  err = msg ( "ES2exec failed:" ) ;
--- 1964,1970 ----
  	char buf [ MAXGETTY ] ;
  	if ( ckfmt ( vcmd, 6 ) ) {
  	} else {
! 	  snprintf ( buf, sizeof buf, vcmd, f->fd, f->fd, f->fd, f->fd, f->fd, f->fd ) ;
  	  msg ( "Iexec'ing /bin/sh -c \"%s\"" , buf ) ;
  	  execl ( "/bin/sh" , "sh" , "-c" , buf , (void*) 0 ) ; 
  	  err = msg ( "ES2exec failed:" ) ;
***************
*** 2090,2102 ****
      }
  
      if ( capsset ) {
!       sprintf ( buf, c20 ? "+FCC=%d,%d,%d,%d,%d,%d,%d,%d" : 
  		"+FDCC=%d,%d,%d,%d,%d,%d,%d,%d", 
  		c[0], c[1], c[2], c[3], c[4], c[5], c[6], c[7] ) ;
        ckcmd ( mf, 0, buf, -t, OK ) ;
      }
      
!     sprintf ( buf, c20 ? "+FLI=\"%.*s\"" : "+FLID=\"%.*s\"" , 
  	     CMDBUFSIZE-9, id ) ;
      ckcmd ( mf, 0, buf, -t, OK ) ;
  
--- 2091,2103 ----
      }
  
      if ( capsset ) {
!       snprintf ( buf, sizeof buf, c20 ? "+FCC=%d,%d,%d,%d,%d,%d,%d,%d" : 
  		"+FDCC=%d,%d,%d,%d,%d,%d,%d,%d", 
  		c[0], c[1], c[2], c[3], c[4], c[5], c[6], c[7] ) ;
        ckcmd ( mf, 0, buf, -t, OK ) ;
      }
      
!     snprintf ( buf, sizeof buf, c20 ? "+FLI=\"%.*s\"" : "+FLID=\"%.*s\"" , 
  	     CMDBUFSIZE-9, id ) ;
      ckcmd ( mf, 0, buf, -t, OK ) ;
  
***************
*** 2104,2110 ****
  
        ckcmd ( mf, 0, c20 ? "+FSP=1" : "+FSPL=1", -t, OK ) ;
  
!       sprintf ( buf, c20 ? "+FPI=\"%.*s\"" : "+FCIG=\"%.*s\"" , 
  	       CMDBUFSIZE-9, id ) ;
        ckcmd ( mf, 0, buf, -t, OK ) ;
  
--- 2105,2111 ----
  
        ckcmd ( mf, 0, c20 ? "+FSP=1" : "+FSPL=1", -t, OK ) ;
  
!       snprintf(buf, sizeof buf, c20 ? "+FPI=\"%.*s\"" : "+FCIG=\"%.*s\"" , 
  	       CMDBUFSIZE-9, id ) ;
        ckcmd ( mf, 0, buf, -t, OK ) ;
  
***************
*** 2209,2215 ****
  	msg("Wlocal ID (%s) truncated to %d characters", nxtoptarg, IDLEN ) ;
        if ( strspn ( nxtoptarg, " +0123456789" ) != strlen ( nxtoptarg ) )
  	msg("Wlocal ID (%s) has non-standard characters", nxtoptarg ) ;
!       sprintf ( localid, "%*.*s", IDLEN, IDLEN, nxtoptarg ) ;
        break ;
      case 'i': 
        if ( nicmd[0] < MAXICMD ) icmd[0][ nicmd[0]++ ] = nxtoptarg ;
--- 2210,2216 ----
  	msg("Wlocal ID (%s) truncated to %d characters", nxtoptarg, IDLEN ) ;
        if ( strspn ( nxtoptarg, " +0123456789" ) != strlen ( nxtoptarg ) )
  	msg("Wlocal ID (%s) has non-standard characters", nxtoptarg ) ;
!       snprintf ( localid, sizeof localid, "%*.*s", IDLEN, IDLEN, nxtoptarg ) ;
        break ;
      case 'i': 
        if ( nicmd[0] < MAXICMD ) icmd[0][ nicmd[0]++ ] = nxtoptarg ;
***************
*** 2307,2313 ****
      char tmp [ MAXLINELEN ] ;
      now = time ( 0 ) ;
      strftime ( tmp, MAXLINELEN, "%c %%s   P. %%%%d", localtime ( &now ) ) ;
!     sprintf ( header = headerbuf, tmp, localid ) ;
    }
  
    if ( ! err ) {
--- 2308,2314 ----
      char tmp [ MAXLINELEN ] ;
      now = time ( 0 ) ;
      strftime ( tmp, MAXLINELEN, "%c %%s   P. %%%%d", localtime ( &now ) ) ;
!     snprintf ( header = headerbuf, sizeof headerbuf, tmp, localid ) ;
    }
  
    if ( ! err ) {
@


1.2
log
@Update to 0.9.
@
text
@@


1.1
log
@Initial checkin of EFax, a simpler FAX package good for single-user unices.
@
text
@d1 2
a2 2
*** efax.c.orig	Sat Sep  5 14:33:25 1998
--- efax.c	Sat Sep  5 14:40:41 1998
d4 1
a4 1
*** 565,571 ****
d12 1
a12 1
--- 565,571 ----
d21 2
a22 2
*** 1552,1558 ****
      if ( done ) continue ;
d24 1
a24 1
      if ( changed ) {
d28 7
a34 6
        if ( gethsc ( &hsc, &err ) ) continue ;
--- 1552,1558 ----
      if ( done ) continue ;
  
      if ( changed ) {
!       snprintf ( buf, sizeof buf, c20 ? "+FIS=%d,%d,%d,%d" : "+FDIS=%d,%d,%d,%d", 
d37 1
a37 1
        if ( gethsc ( &hsc, &err ) ) continue ;
d39 1
a39 1
*** 1697,1703 ****
d41 1
a41 1
    char c, dsbuf [ 128 ] ;
d47 1
a47 1
--- 1697,1703 ----
d49 1
a49 1
    char c, dsbuf [ 128 ] ;
d56 1
a56 1
*** 1820,1826 ****
d64 1
a64 1
--- 1820,1826 ----
d73 1
a73 1
*** 1839,1845 ****
d81 1
a81 1
--- 1839,1845 ----
d90 2
a91 1
*** 1894,1905 ****
d93 6
a98 6
      ckcmd ( mf, &err, "+FCR=1", t, OK ) ;
  
!     sprintf ( buf, c20 ? "+FCC=%d,%d,%d,%d,%d,%d,%d,%d" : 
  	     "+FDCC=%d,%d,%d,%d,%d,%d,%d,%d", 
  	     c[0], c[1], c[2], c[3], c[4], c[5], c[6], c[7] ) ;
      ckcmd ( mf, 0, buf, -t, OK ) ;
d104 2
a105 1
--- 1894,1905 ----
d107 6
a112 6
      ckcmd ( mf, &err, "+FCR=1", t, OK ) ;
  
!     snprintf ( buf, sizeof buf, c20 ? "+FCC=%d,%d,%d,%d,%d,%d,%d,%d" : 
  	     "+FDCC=%d,%d,%d,%d,%d,%d,%d,%d", 
  	     c[0], c[1], c[2], c[3], c[4], c[5], c[6], c[7] ) ;
      ckcmd ( mf, 0, buf, -t, OK ) ;
d119 1
a119 1
*** 1907,1913 ****
d127 1
a127 1
--- 1907,1913 ----
d136 1
a136 1
*** 1989,1995 ****
d144 1
a144 1
--- 1989,1995 ----
d153 1
a153 1
*** 2089,2095 ****
d160 2
a161 2
    sigf = &faxdev ;		/* make global so can clean up on signal */
--- 2089,2095 ----
d168 1
a168 1
    sigf = &faxdev ;		/* make global so can clean up on signal */
@

