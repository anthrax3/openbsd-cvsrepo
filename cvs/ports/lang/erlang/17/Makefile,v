head	1.18;
access;
symbols
	OPENBSD_6_2:1.18.0.2
	OPENBSD_6_2_BASE:1.18
	OPENBSD_6_1:1.14.0.2
	OPENBSD_6_1_BASE:1.14
	OPENBSD_6_0:1.13.0.2
	OPENBSD_6_0_BASE:1.13
	OPENBSD_5_9:1.12.0.2
	OPENBSD_5_9_BASE:1.12
	OPENBSD_5_8:1.10.0.4
	OPENBSD_5_8_BASE:1.10;
locks; strict;
comment	@# @;


1.18
date	2017.07.26.22.45.25;	author sthen;	state Exp;
branches;
next	1.17;
commitid	tD4MFrpYYDDL2UFT;

1.17
date	2017.07.16.19.18.59;	author espie;	state Exp;
branches;
next	1.16;
commitid	tt0GhWK5c4uf9ILG;

1.16
date	2017.04.24.13.35.23;	author sthen;	state Exp;
branches;
next	1.15;
commitid	ibKiLqebCodKxJbP;

1.15
date	2017.04.10.11.46.22;	author sthen;	state Exp;
branches;
next	1.14;
commitid	BLsh88fJB8thZTwY;

1.14
date	2016.09.01.10.53.27;	author jasper;	state Exp;
branches;
next	1.13;
commitid	LdsIxWmxagN2Kq33;

1.13
date	2016.06.29.16.14.41;	author espie;	state Exp;
branches;
next	1.12;
commitid	c1yQMbJbfo0CFBcL;

1.12
date	2015.11.27.19.19.02;	author jasper;	state Exp;
branches;
next	1.11;
commitid	W1qbqkl6HUe3C6qu;

1.11
date	2015.10.28.19.18.31;	author jasper;	state Exp;
branches;
next	1.10;
commitid	HEEeJ7SAXBoL9up8;

1.10
date	2015.07.11.11.00.55;	author jasper;	state Exp;
branches;
next	1.9;
commitid	VaVqQQtV2AEqke9O;

1.9
date	2015.07.09.19.46.39;	author jasper;	state Exp;
branches;
next	1.8;
commitid	OfJHHzSctAxuOXrh;

1.8
date	2015.06.27.12.17.59;	author jasper;	state Exp;
branches;
next	1.7;
commitid	SHg2lPnLvTgh3u4P;

1.7
date	2015.06.26.07.33.18;	author jasper;	state Exp;
branches;
next	1.6;
commitid	F72JlmOW1lEpBfZZ;

1.6
date	2015.06.25.15.06.33;	author jasper;	state Exp;
branches;
next	1.5;
commitid	RiDdaM2kevMOTYwn;

1.5
date	2015.06.25.13.16.08;	author jasper;	state Exp;
branches;
next	1.4;
commitid	j76t3576lMCSfTg1;

1.4
date	2015.06.23.20.51.58;	author jasper;	state Exp;
branches;
next	1.3;
commitid	b2x8HgVX1IHTgKwz;

1.3
date	2015.06.23.19.41.20;	author jasper;	state Exp;
branches;
next	1.2;
commitid	NTJ1n52g45Lt4irQ;

1.2
date	2015.06.23.19.33.50;	author jasper;	state Exp;
branches;
next	1.1;
commitid	tc8hCknHaAU4axQf;

1.1
date	2015.06.23.16.43.38;	author jasper;	state Exp;
branches;
next	;
commitid	gOcyT83nJ7rtwL53;


desc
@@


1.18
log
@bump LIBCXX/LIBECXX/COMPILER_LIBCXX ports.
@
text
@# $OpenBSD: Makefile,v 1.17 2017/07/16 19:18:59 espie Exp $

BROKEN-alpha=	beam/erl_process.c:6692: internal compiler error: in final_scan_insn, at final.c:2449
BROKEN-hppa =	error: No native atomic implementation found.

COMMENT-main=	${COMMENT}
COMMENT-wx=	WxWidgets bindings for Erlang

V=		17.5
MAJ_V=		17
EPOCH=		0
DISTNAME=	otp_src_$V
PKGNAME-main=	erlang-$V
PKGNAME-wx=	erlang-wx-$V

REVISION-main=	8
REVISION-wx=	2

VERSION_SPEC=	>=17v0,<18v0
PKGSPEC-main=	erlang-${VERSION_SPEC}
PKGSPEC-wx=	erlang-wx-${VERSION_SPEC}

BUILD_DEPENDS+=	textproc/libxslt

CONFIGURE_ARGS=	--without-jinterface	\
		--without-odbc		\
		--enable-threads 	\
		--enable-kernel-poll \
		--disable-hipe \
		--enable-smp-support

MULTI_PACKAGES = -main -wx

WANTLIB =	m pthread
WANTLIB-main =	${WANTLIB} c crypto ncurses util

WANTLIB-wx += ${WANTLIB} GL GLU ${COMPILER_LIBCXX} wx_base wx_base_xml wx_gtk2_adv
WANTLIB-wx += wx_gtk2_aui wx_gtk2_core wx_gtk2_gl wx_gtk2_html wx_gtk2_stc
WANTLIB-wx += wx_gtk2_xrc

LIB_DEPENDS-wx +=x11/wxWidgets>=2.8.12p10
RUN_DEPENDS-wx =${BASE_PKGPATH},-main>=${MAJ_V}

DOC_DIR=	${PREFIX}/lib/erlang${MAJ_V}/
FAKE_FLAGS =	libdir_suffix="/erlang${MAJ_V}"

# Use the target 'gen-versions' to update this list
ERL_VERSIONS=	\
ASN1_VSN	3.0.4 \
COMMON_TEST_VSN	1.10 \
COMPILER_VSN	5.0.4 \
COSEVENTDOMAIN_VSN	1.1.14 \
COSEVENT_VSN	2.1.15 \
COSFILETRANSFER_VSN	1.1.16 \
COSNOTIFICATION_VSN	1.1.21 \
COSPROPERTY_VSN	1.1.17 \
COSTIME_VSN	1.1.14 \
COSTRANSACTIONS_VSN	1.2.14 \
CRYPTO_VSN	3.5 \
DEBUGGER_VSN	4.0.3 \
DIALYZER_VSN	2.7.4 \
DIAMETER_VSN	1.9 \
EDOC_VSN	0.7.16 \
EI_VSN	3.7.20 \
ELDAP_VSN	1.1.1 \
EMACS_VSN	2.7.0 \
ERL_DOCGEN_VSN	0.3.7 \
ERL_INTERFACE_VSN	3.7.20 \
ET_VSN	1.5 \
EUNIT_VSN	2.2.9 \
GS_VSN	1.5.16 \
HIPE_VSN	3.11.3 \
IC_VSN	4.3.6 \
INETS_VSN	5.10.6 \
JINTERFACE_VSN	1.5.12 \
KERNEL_VSN	3.2 \
MEGACO_VSN	3.17.3 \
MNESIA_VSN	4.12.5 \
OBSERVER_VSN	2.0.4 \
ODBC_VSN	2.10.22 \
ORBER_VSN	3.7.1 \
OSE_VSN	1.0.2 \
OS_MON_VSN	2.3.1 \
OTP_MIBS_VSN	1.0.10 \
PARSETOOLS_VSN	2.0.12 \
PERCEPT_VSN	0.8.10 \
PUBLIC_KEY_VSN	0.23 \
RELTOOL_VSN	0.6.6 \
RUNTIME_TOOLS_VSN	1.8.16 \
SASL_VSN	2.4.1 \
SNMP_VSN	5.1.1 \
SSH_VSN	3.2 \
SSL_VSN	6.0 \
STDLIB_VSN	2.4 \
SYNTAX_TOOLS_VSN	1.6.18 \
TEST_SERVER_VSN	3.8 \
TOOLS_VSN	2.7.2 \
TYPER_VSN	0.9.8 \
WX_VSN	1.3.3 \
XMERL_VSN	1.3.7 \
WEBTOOL_VSN	0.8.10 \
ERTS_VSN	6.4

SYSTEM_VSN=	${V:R}

.include <bsd.port.mk>
@


1.17
log
@use COMPILER_LIBCXX where applicable
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.16 2017/04/24 13:35:23 sthen Exp $
d16 2
a17 2
REVISION-main=	7
REVISION-wx=	1
@


1.16
log
@fix "ordered comparison between pointer and zero"
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.15 2017/04/10 11:46:22 sthen Exp $
d37 1
a37 1
WANTLIB-wx += ${WANTLIB} GL GLU ${LIBCXX} wx_base wx_base_xml wx_gtk2_adv
@


1.15
log
@use LIBCXX
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.14 2016/09/01 10:53:27 jasper Exp $
d16 1
a16 1
REVISION-main=	6
@


1.14
log
@retire sparc
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.13 2016/06/29 16:14:41 espie Exp $
d37 1
a37 1
WANTLIB-wx += ${WANTLIB} GL GLU stdc++ wx_base wx_base_xml wx_gtk2_adv
@


1.13
log
@add is-branch to all trivial ports that exist as multiple branches.
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.12 2015/11/27 19:19:02 jasper Exp $
a4 1
BROKEN-sparc=	Requires v9|v9a|v9b; requested architecture is sparclite.
@


1.12
log
@remove html documentation from the erlang packages, but keep the manpages. the
html documentation is available online (http://www.erlang.org/erldoc) where
it's searchable (offline it isn't).
This saves about 18M for -main (1/3rd) and 14M for -wx.
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.11 2015/10/28 19:18:31 jasper Exp $
d17 2
a18 2
REVISION-main=	5
REVISION-wx=	0
@


1.11
log
@- fix symlink for erl_call
- add erl_call to _MODERL_LINKS
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.10 2015/07/11 11:00:55 jasper Exp $
d17 2
a18 1
REVISION-main=	4
@


1.10
log
@missed bump; spotted by nigel@@
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.9 2015/07/09 19:46:39 jasper Exp $
d17 1
a17 1
REVISION-main=	3
@


1.9
log
@- unbreak linking of wx bindings now that wxwidgets has been fixed
- move all wx and observer bits into a wx subpackage

this shrinks the main package by about 18M
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.8 2015/06/27 12:17:59 jasper Exp $
d17 1
a17 1
REVISION-main=	2
@


1.8
log
@missing BDEP on libxslt
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.7 2015/06/26 07:33:18 jasper Exp $
d7 3
d12 1
d14 4
a17 4
PKGNAME=	erlang-$V
REVISION=	2
EPOCH=		0
PKGSPEC=	erlang->=17v0,<18v0
d19 3
a21 1
WANTLIB=	c crypto m ncurses pthread util
d31 12
@


1.7
log
@mark SHARED_ONLY
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.6 2015/06/25 15:06:33 jasper Exp $
d16 2
@


1.6
log
@add missing @@mandir annotation
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.5 2015/06/25 13:16:08 jasper Exp $
d11 1
a11 1
REVISION=	1
@


1.5
log
@- de-conflict erlang versions so they can be installed along-side
* erlang now gets installed into lib/erlang${MAJOR}/ and binaries get a ${MAJOR} suffix
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.4 2015/06/23 20:51:58 jasper Exp $
d11 1
a11 1
REVISION=	0
@


1.4
log
@- cleanup CONFIGURE_ARGS:
* use correct switch to disable jinterface and odbc and remove now bogus pre-configure target
- sort gen-versions output
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.3 2015/06/23 19:41:20 jasper Exp $
d8 1
d11 1
d24 2
a25 1
DOC_DIR=	${PREFIX}/lib/erlang
a84 9

post-install:
	@@ln -sf ../lib/erlang/lib/${EI}/bin/erl_call ${PREFIX}/bin/erl_call
	tar zxf ${FULLDISTDIR}/otp_doc_man_${V}.tar.gz -C ${DOC_DIR}
	tar zxf ${FULLDISTDIR}/otp_doc_html_${V}.tar.gz -C ${DOC_DIR}
	rm -r ${DOC_DIR}/lib/${JINTERFACE}
	rm -r ${DOC_DIR}/lib/${ODBC}
	rm -r ${DOC_DIR}/man/man7/*MIB.7
	rm -r ${DOC_DIR}/man/man7/*TM.7
@


1.3
log
@move configure-related bits
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.2 2015/06/23 19:33:50 jasper Exp $
d15 2
a16 2
CONFIGURE_ARGS=	--disable-jinterface	\
		--disable-odbc		\
d26 54
a79 54
ELDAP_VSN       1.1.1 \
COSEVENT_VSN    2.1.15 \
OSE_VSN 1.0.2 \
ODBC_VSN        2.10.22 \
EMACS_VSN       2.7.0 \
TOOLS_VSN       2.7.2 \
DEBUGGER_VSN    4.0.3 \
COSTIME_VSN     1.1.14 \
OBSERVER_VSN    2.0.4 \
COMPILER_VSN    5.0.4 \
IC_VSN  4.3.6 \
JINTERFACE_VSN  1.5.12 \
ET_VSN  1.5 \
OTP_MIBS_VSN    1.0.10 \
INETS_VSN       5.10.6 \
TYPER_VSN       0.9.8 \
TEST_SERVER_VSN 3.8 \
EDOC_VSN        0.7.16 \
SSH_VSN 3.2 \
COSFILETRANSFER_VSN     1.1.16 \
SNMP_VSN        5.1.1 \
ASN1_VSN        3.0.4 \
SYNTAX_TOOLS_VSN        1.6.18 \
XMERL_VSN       1.3.7 \
RELTOOL_VSN     0.6.6 \
ORBER_VSN       3.7.1 \
DIAMETER_VSN    1.9 \
CRYPTO_VSN      3.5 \
COSTRANSACTIONS_VSN     1.2.14 \
WX_VSN  1.3.3 \
MEGACO_VSN      3.17.3 \
ERL_DOCGEN_VSN  0.3.7 \
GS_VSN  1.5.16 \
EI_VSN  3.7.20 \
ERL_INTERFACE_VSN       3.7.20 \
DIALYZER_VSN    2.7.4 \
PERCEPT_VSN     0.8.10 \
HIPE_VSN        3.11.3 \
SSL_VSN 6.0 \
KERNEL_VSN      3.2 \
RUNTIME_TOOLS_VSN       1.8.16 \
COMMON_TEST_VSN 1.10 \
EUNIT_VSN       2.2.9 \
PUBLIC_KEY_VSN  0.23 \
PARSETOOLS_VSN  2.0.12 \
SASL_VSN        2.4.1 \
COSPROPERTY_VSN 1.1.17 \
STDLIB_VSN      2.4 \
COSEVENTDOMAIN_VSN      1.1.14 \
OS_MON_VSN      2.3.1 \
COSNOTIFICATION_VSN     1.1.21 \
MNESIA_VSN      4.12.5 \
WEBTOOL_VSN     0.8.10 \
ERTS_VSN        6.4
a81 13

# special cases
EI=		erl_interface-${EI_VSN}
COSEVENT=	cosEvent-${COSEVENT_VSN}
COSEVENTDOMAIN=	cosEventDomain-${COSEVENTDOMAIN_VSN}
COSFILETRANSFER=cosFileTransfer-${COSFILETRANSFER_VSN}
COSNOTIFICATION=cosNotification-${COSNOTIFICATION_VSN}
COSPROPERTY=	cosProperty-${COSPROPERTY_VSN}
COSTIME=	cosTime-${COSTIME_VSN}
COSTRANSACTIONS=cosTransactions-${COSTRANSACTIONS_VSN}

post-configure:
	@@touch ${WRKSRC}/lib/odbc/SKIP
@


1.2
log
@- move gen-versions target and related bits to Makefile.inc
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.1 2015/06/23 16:43:38 jasper Exp $
a12 2
DPB_PROPERTIES+=tag:erlang17

a20 7

CONFIGURE_STYLE=autoconf no-autoheader
CONFIGURE_ENV=	LDFLAGS="${LDFLAGS} -pthread"
AUTOCONF_VERSION=2.59
AUTOCONF_DIR=	${WRKSRC} ${WRKSRC}/erts
MODGNU_CONFIG_GUESS_DIRS=	${WRKSRC}/erts/autoconf \
				${WRKSRC}/lib/erl_interface/src/auxdir
@


1.1
log
@- add erlang 17.5, which is incompatible with erlang 16.
- right now both versions conflict, which may be resolved in the future

ok sthen@@
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.55 2014/12/28 14:28:34 jasper Exp $
a23 1
USE_GMAKE=	Yes
a34 1
SYSTEM_VSN      17.5 \
a89 6
.for _n _v in ${ERL_VERSIONS}
${_n}=${_v}
${_n:S/_VSN//}=${_n:S/_VSN//:L}-${_v}
SUBST_VARS+=${_n:S/_VSN//}
.endfor

a90 1
SUBST_VARS+=	SYSTEM_VSN
a112 8

# Special maintainer target, scan through vsn.mk files and build 'ERL_VERSIONS'
# list
gen-versions: extract
	@@echo "SYSTEM_VSN\t`cat ${WRKSRC}/OTP_VERSION` \\"
	@@find ${WRKSRC} -name 'vsn.mk' -exec awk '/_VSN +=/ { print $$1"\t"$$3 " \\" }' {} \; | grep -v 'PRE_' | grep -v 'APP_' | sed 's/DOCB_VSN/DOCBUILDER_VSN/'
	@@find ${WRKSRC} -name 'vsn.mk' -exec awk -F'=' '/_VSN=/ { print $$1"\t"$$2 " \\" }' {} \; | grep -v 'PRE_' | grep -v 'APP_'
	@@grep VSN ${WRKSRC}/erts/vsn.mk |awk '/^VSN/ { print "ERTS_VSN\t" $$3 }'
@

