head	1.2;
access;
symbols
	OPENBSD_5_0:1.1.0.2
	OPENBSD_5_0_BASE:1.1;
locks; strict;
comment	@# @;


1.2
date	2011.12.23.13.40.13;	author jasper;	state dead;
branches;
next	1.1;

1.1
date	2011.07.05.20.07.30;	author landry;	state Exp;
branches;
next	;


desc
@@


1.2
log
@- update to R14B04
- fix conflict with speech-dispatcher
- fix gen-versions target
- i386 ethread compat

update to R14B04 from dlg@@, rest by piotr sikora and me
tested with rabbitmq and ejabberd on amd64; sparc64 is still happy too

maintainer timed-out
@
text
@$OpenBSD: patch-erts_emulator_test_time_SUITE_erl,v 1.1 2011/07/05 20:07:30 landry Exp $
--- erts/emulator/test/time_SUITE.erl.orig
+++ erts/emulator/test/time_SUITE.erl
@@@@ -34,6 +34,8 @@@@
  	 consistency/1,
 	 now/1, now_unique/1, now_update/1, timestamp/1]).

+-export([local_to_univ_utc/1]).
+
 -include("test_server.hrl").

 -export([linear_time/1]).
@@@@ -53,7 +55,40 @@@@
 -define(dst_timezone, 2).

 all(suite) -> [univ_to_local, local_to_univ,
-	       bad_univ_to_local, bad_local_to_univ, consistency, now, timestamp].
+	       local_to_univ_utc,
+	       bad_univ_to_local, bad_local_to_univ,
+	       consistency, now, timestamp].
+
+local_to_univ_utc(suite) ->
+    [];
+local_to_univ_utc(doc) ->
+    ["Test that DST = true on timezones without DST is ignored"];
+local_to_univ_utc(Config) when is_list(Config) ->
+    case os:type() of
+       {unix,_} ->
+           %% TZ variable has a meaning
+           ?line {ok, Node} =
+               test_server:start_node(local_univ_utc,peer,
+                                      [{args, "-env TZ UTC"}]),
+           ?line {{2008,8,1},{0,0,0}} =
+               rpc:call(Node,
+                        erlang,localtime_to_universaltime,
+                        [{{2008, 8, 1}, {0, 0, 0}},
+                         false]),
+           ?line {{2008,8,1},{0,0,0}} =
+               rpc:call(Node,
+                        erlang,localtime_to_universaltime,
+                        [{{2008, 8, 1}, {0, 0, 0}},
+                         true]),
+           ?line [{{2008,8,1},{0,0,0}}] =
+               rpc:call(Node,
+                        calendar,local_time_to_universal_time_dst,
+                        [{{2008, 8, 1}, {0, 0, 0}}]),
+           ?line test_server:stop_node(Node),
+           ok;
+       _ ->
+           {skip,"Only valid on Unix"}
+    end.


 %% Tests conversion from univeral to local time.
@


1.1
log
@Backport https://github.com/erlang/otp/commit/7e6fe78278c203c3756ce0d6bf23a6bd6cf7bb5d
From Piotr Sikora, Fixes a crasher in timezone handling with MochiWeb.
@
text
@d1 1
a1 1
$OpenBSD$
@

