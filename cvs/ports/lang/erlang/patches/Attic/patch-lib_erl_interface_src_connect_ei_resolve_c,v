head	1.2;
access;
symbols
	OPENBSD_5_0:1.1.0.2
	OPENBSD_5_0_BASE:1.1;
locks; strict;
comment	@# @;


1.2
date	2011.12.23.13.40.13;	author jasper;	state dead;
branches;
next	1.1;

1.1
date	2011.07.01.08.26.24;	author dcoppa;	state Exp;
branches;
next	;


desc
@@


1.2
log
@- update to R14B04
- fix conflict with speech-dispatcher
- fix gen-versions target
- i386 ethread compat

update to R14B04 from dlg@@, rest by piotr sikora and me
tested with rabbitmq and ejabberd on amd64; sparc64 is still happy too

maintainer timed-out
@
text
@$OpenBSD: patch-lib_erl_interface_src_connect_ei_resolve_c,v 1.1 2011/07/01 08:26:24 dcoppa Exp $

Align ei buffer according to size of pointers
(unbreak Erlang/OTP on sparc64)

--- lib/erl_interface/src/connect/ei_resolve.c.orig	Fri Jul  1 09:44:20 2011
+++ lib/erl_interface/src/connect/ei_resolve.c	Fri Jul  1 09:47:17 2011
@@@@ -185,7 +185,12 @@@@ static int verify_dns_configuration(void) 
  * align: increment buf until it is dword-aligned, reduce len by same amount.
  * advance:  increment buf by n bytes, reduce len by same amount .
  */
-#define align_buf(buf,len) for (;(((unsigned)buf)&0x3); (buf)++, len--)
+#if defined SIZEOF_VOID_P
+#define ALIGNBYTES (SIZEOF_VOID_P - 1)
+#else
+#define ALIGNBYTES (sizeof(void*) - 1)
+#endif
+#define align_buf(buf,len) for (;(((unsigned)buf) & ALIGNBYTES); (buf)++, len--)
 #define advance_buf(buf,len,n) ((buf)+=(n),(len)-=(n))
 
 /* "and now the tricky part..." */
@


1.1
log
@Unbreak Erlang/OTP on sparc64 (fix a misaligned memory access).

This is not my patch, but a modified one
(https://github.com/erlang/otp/commit/7092c4a41ac0d38ae457c2dc768aa542337d8b8c)
that has been committed upstream by Bjorn-Egil Dahlberg of the
Erlang/OTP team at Ericsson: thanks!

OK landry@@
@
text
@d1 1
a1 1
$OpenBSD$
@

