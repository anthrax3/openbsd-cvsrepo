head	1.9;
access;
symbols
	OPENBSD_3_6:1.8.0.4
	OPENBSD_3_6_BASE:1.8
	OPENBSD_3_5:1.8.0.2
	OPENBSD_3_5_BASE:1.8
	OPENBSD_3_4:1.6.0.6
	OPENBSD_3_4_BASE:1.6
	OPENBSD_3_3:1.6.0.4
	OPENBSD_3_3_BASE:1.6
	OPENBSD_3_2:1.6.0.2
	OPENBSD_3_2_BASE:1.6
	OPENBSD_2_9_TRACKING_SWITCH:1.2;
locks; strict;
comment	@# @;


1.9
date	2005.02.20.01.24.32;	author espie;	state dead;
branches;
next	1.8;

1.8
date	2004.01.31.15.23.58;	author espie;	state Exp;
branches;
next	1.7;

1.7
date	2004.01.31.14.58.03;	author espie;	state dead;
branches;
next	1.6;

1.6
date	2002.09.14.10.14.51;	author espie;	state Exp;
branches;
next	1.5;

1.5
date	2002.08.30.08.33.14;	author espie;	state Exp;
branches;
next	1.4;

1.4
date	2002.05.27.16.58.29;	author espie;	state Exp;
branches;
next	1.3;

1.3
date	2001.08.22.09.03.04;	author espie;	state dead;
branches;
next	1.2;

1.2
date	2001.07.13.14.06.56;	author espie;	state Exp;
branches;
next	1.1;

1.1
date	2001.07.09.10.26.20;	author espie;	state Exp;
branches;
next	;


desc
@@


1.9
log
@bye bye
@
text
@$OpenBSD: patch-gcc_config_i386_openbsd_h,v 1.8 2004/01/31 15:23:58 espie Exp $
--- gcc/config/i386/openbsd.h.orig	2002-10-21 00:37:10.000000000 +0200
+++ gcc/config/i386/openbsd.h	2003-11-11 15:33:52.000000000 +0100
@@@@ -29,6 +29,7 @@@@ Boston, MA 02111-1307, USA.  */
 #define TARGET_OS_CPP_BUILTINS()		\
   do						\
     {						\
+    	OPENBSD_OS_CPP_BUILTINS_COMMON();	\
 	builtin_define ("__unix__");		\
 	builtin_define ("__OpenBSD__");		\
 	builtin_assert ("system=unix");		\
@@@@ -101,3 +102,19 @@@@ Boston, MA 02111-1307, USA.  */
 
 /* OpenBSD gas currently does not support quad, so do not use it.  */
 #undef ASM_QUAD
+
+#define TRANSFER_FROM_TRAMPOLINE					\
+extern void __enable_execute_stack (void *);				\
+void									\
+__enable_execute_stack (addr)						\
+     void *addr;							\
+{									\
+  long size = getpagesize ();						\
+  long mask = ~(size-1);						\
+  char *page = (char *) (((long) addr) & mask); 			\
+  char *end  = (char *) ((((long) (addr + TRAMPOLINE_SIZE)) & mask) + size); \
+								      \
+  /* 7 is PROT_READ | PROT_WRITE | PROT_EXEC */ 			\
+  if (mprotect (page, end - page, 7) < 0)				\
+    perror ("mprotect of trampoline code");				\
+}
@


1.8
log
@forgot a few patches... grrr.
@
text
@d1 1
a1 1
$OpenBSD: patch-gcc_config_i386_openbsd_h,v 1.2 2003/11/13 19:09:47 espie Exp $
@


1.7
log
@switch to gcc 3.3.2 as a stable port
okay naddy@@
@
text
@d1 12
a12 4
$OpenBSD: patch-gcc_config_i386_openbsd_h,v 1.6 2002/09/14 10:14:51 espie Exp $
--- gcc/config/i386/openbsd.h.orig	Tue May 28 23:29:47 2002
+++ gcc/config/i386/openbsd.h	Thu Sep 12 14:52:17 2002
@@@@ -103,3 +103,24 @@@@ Boston, MA 02111-1307, USA.  */
a15 5
+
+#undef FINALIZE_TRAMPOLINE
+#define FINALIZE_TRAMPOLINE(TRAMP) \
+  emit_library_call(gen_rtx_SYMBOL_REF (Pmode, "__enable_execute_stack"), \
+		    0, VOIDmode, 1, memory_address (SImode, (TRAMP)), Pmode)
@


1.6
log
@Update to gcc 3.2, remove integrated patches.
Fix packing lists, including missing %%SHARED%%.
@
text
@d1 1
a1 1
$OpenBSD: patch-gcc_config_i386_openbsd_h,v 1.5 2002/08/30 08:33:14 espie Exp $
@


1.5
log
@Add non-exec trampoline stub (mprotect stack).
Fixes ada build.
@
text
@d1 4
a4 4
$OpenBSD: patch-gcc_config_i386_openbsd_h,v 1.4 2002/05/27 16:58:29 espie Exp $
--- gcc/config/i386/openbsd.h.orig	Wed Oct 17 03:39:47 2001
+++ gcc/config/i386/openbsd.h	Thu Aug 29 20:40:53 2002
@@@@ -95,26 +95,32 @@@@ Boston, MA 02111-1307, USA.  */
d6 2
a7 27
 #undef ASM_PREFERRED_EH_DATA_FORMAT
 
-/* Assembler format: alignment output.  */
-
-/* A C statement to output to the stdio stream FILE an assembler
-   command to advance the location counter to a multiple of 1<<LOG
-   bytes if it is within MAX_SKIP bytes.
-
-   This will be used to align code labels according to Intel 
-   recommendations, in prevision of binutils upgrade.  */
-#ifdef HAVE_GAS_MAX_SKIP_P2ALIGN
-#define ASM_OUTPUT_MAX_SKIP_ALIGN(FILE,LOG,MAX_SKIP)			\
-  do {									\
-    if ((LOG) != 0) {							\
-      if ((MAX_SKIP) == 0) fprintf ((FILE), "\t.p2align %d\n", (LOG));	\
-      else fprintf ((FILE), "\t.p2align %d,,%d\n", (LOG), (MAX_SKIP));	\
-    }									\
-  } while (0)
-#endif
 
 /* Note that we pick up ASM_OUTPUT_MI_THUNK from unix.h.  */
 
 #undef ASM_COMMENT_START
 #define ASM_COMMENT_START ";#"
 
+/* OpenBSD gas currently does not support quad, so do not use it.  */
+#undef ASM_QUAD
@


1.4
log
@Update to gcc 3.1, should compile at least on i386.
@
text
@d1 1
a1 1
$OpenBSD$
d3 2
a4 2
+++ gcc/config/i386/openbsd.h	Fri May 17 02:23:03 2002
@@@@ -95,26 +95,11 @@@@ Boston, MA 02111-1307, USA.  */
d33 21
@


1.3
log
@3.0.1 is out. Remove integrated patches.
Tweak packing-lists.
Put USE_GMAKE in for now...
@
text
@d1 4
a4 6
$OpenBSD: patch-gcc_config_i386_openbsd_h,v 1.2 2001/07/13 14:06:56 espie Exp $
--- gcc/config/i386/openbsd.h.orig	Sun May 20 21:49:17 2001
+++ gcc/config/i386/openbsd.h	Fri Jul 13 16:03:53 2001
@@@@ -114,6 +114,8 @@@@ Boston, MA 02111-1307, USA.  */
    configuration files...  */
 #define DWARF2_UNWIND_INFO 0
d6 1
a6 3
+#undef ASM_PREFERRED_EH_DATA_FORMAT
+
 /* Assembler format: alignment output.  */
d8 17
a24 3
 /* A C statement to output to the stdio stream FILE an assembler
@@@@ -133,3 +135,7 @@@@ Boston, MA 02111-1307, USA.  */
 #endif
d27 6
a32 4
+
+#undef ASM_COMMENT_START
+#define ASM_COMMENT_START ";#"
+
@


1.2
log
@Some fixes:
- patch libstdc++-v3/libmath to unconfuse libtool.
- sparc needs the same fix as i386 to not emit bogus frame info.
@
text
@d1 1
a1 1
$OpenBSD: patch-gcc_config_i386_openbsd_h,v 1.1 2001/07/09 10:26:20 espie Exp $
@


1.1
log
@
Slightly better configuration:
- add patches from OpenBSD-current, to multilib libgcc as -fpic
- fix asm emitting code on i386, to avoid dwarf2 stuff. Similar patches
may be needed for other a.out arches...
- fix comment on i386.
- add -L/usr/lib/debug.
- finish -shared support.

Misc. configury:
- try to ensure libffi, libjava, fastjar will configure. So far, ld dumps
core in libjava though...

Use gmake for now, as it does not build completely with our make...

Still missing shared library pieces...
@
text
@d1 1
a1 1
$OpenBSD: update-patches,v 1.4 2001/03/31 22:54:41 espie Exp $
d3 11
a13 2
+++ gcc/config/i386/openbsd.h	Mon Jul  9 08:39:47 2001
@@@@ -133,3 +133,8 @@@@ Boston, MA 02111-1307, USA.  */
a20 1
+#undef ASM_PREFERRED_EH_DATA_FORMAT
@

