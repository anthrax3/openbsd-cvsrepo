head	1.84;
access;
symbols
	OPENBSD_3_6:1.81.0.4
	OPENBSD_3_6_BASE:1.81
	OPENBSD_3_5:1.81.0.2
	OPENBSD_3_5_BASE:1.81
	OPENBSD_3_4:1.80.0.2
	OPENBSD_3_4_BASE:1.80
	OPENBSD_3_3:1.73.0.2
	OPENBSD_3_3_BASE:1.73
	OPENBSD_3_2:1.68.0.2
	OPENBSD_3_2_BASE:1.68
	OPENBSD_3_1:1.54.0.2
	OPENBSD_3_1_BASE:1.54
	OPENBSD_3_0:1.50.0.2
	OPENBSD_3_0_BASE:1.50
	OPENBSD_2_9_TRACKING_SWITCH:1.45
	OPENBSD_2_9:1.36.0.4
	OPENBSD_2_9_BASE:1.36
	OPENBSD_2_8:1.36.0.2
	OPENBSD_2_8_BASE:1.36
	OPENBSD_2_7:1.33.0.2
	OPENBSD_2_7_BASE:1.33
	OPENBSD_2_6:1.24.0.2
	OPENBSD_2_6_BASE:1.24
	OPENBSD_2_5:1.20.0.2
	OPENBSD_2_5_BASE:1.20
	OPENBSD_2_4:1.4.0.2
	OPENBSD_2_4_BASE:1.4
	rel1_1b:1.1.1.1
	OpenBSD-ports:1.1.1;
locks; strict;
comment	@# @;


1.84
date	2005.02.20.01.24.31;	author espie;	state dead;
branches;
next	1.83;

1.83
date	2004.10.20.09.14.40;	author espie;	state Exp;
branches;
next	1.82;

1.82
date	2004.09.15.19.06.57;	author espie;	state Exp;
branches;
next	1.81;

1.81
date	2004.01.31.14.58.03;	author espie;	state Exp;
branches;
next	1.80;

1.80
date	2003.06.30.12.19.23;	author espie;	state Exp;
branches;
next	1.79;

1.79
date	2003.06.27.23.02.45;	author espie;	state Exp;
branches;
next	1.78;

1.78
date	2003.06.26.15.00.14;	author espie;	state Exp;
branches;
next	1.77;

1.77
date	2003.06.26.00.22.01;	author espie;	state Exp;
branches;
next	1.76;

1.76
date	2003.06.26.00.19.50;	author espie;	state Exp;
branches;
next	1.75;

1.75
date	2003.06.16.17.25.19;	author sturm;	state Exp;
branches;
next	1.74;

1.74
date	2003.06.10.15.43.20;	author brad;	state Exp;
branches;
next	1.73;

1.73
date	2003.02.16.14.26.07;	author espie;	state Exp;
branches;
next	1.72;

1.72
date	2003.02.15.14.38.27;	author espie;	state Exp;
branches;
next	1.71;

1.71
date	2002.11.25.15.37.59;	author brad;	state Exp;
branches;
next	1.70;

1.70
date	2002.11.24.11.52.32;	author espie;	state Exp;
branches;
next	1.69;

1.69
date	2002.10.05.09.40.58;	author espie;	state Exp;
branches;
next	1.68;

1.68
date	2002.09.30.20.52.45;	author naddy;	state Exp;
branches;
next	1.67;

1.67
date	2002.09.28.19.19.51;	author brad;	state Exp;
branches;
next	1.66;

1.66
date	2002.09.25.19.44.32;	author lebel;	state Exp;
branches;
next	1.65;

1.65
date	2002.09.25.17.20.23;	author lebel;	state Exp;
branches;
next	1.64;

1.64
date	2002.09.17.22.16.25;	author todd;	state Exp;
branches;
next	1.63;

1.63
date	2002.09.17.12.56.19;	author espie;	state Exp;
branches;
next	1.62;

1.62
date	2002.09.14.10.59.44;	author avsm;	state Exp;
branches;
next	1.61;

1.61
date	2002.09.14.10.14.50;	author espie;	state Exp;
branches;
next	1.60;

1.60
date	2002.06.07.01.38.59;	author drahn;	state Exp;
branches;
next	1.59;

1.59
date	2002.06.05.23.31.06;	author espie;	state Exp;
branches;
next	1.58;

1.58
date	2002.05.30.08.57.32;	author espie;	state Exp;
branches;
next	1.57;

1.57
date	2002.05.29.01.02.39;	author espie;	state Exp;
branches;
next	1.56;

1.56
date	2002.05.28.01.13.46;	author espie;	state Exp;
branches;
next	1.55;

1.55
date	2002.05.27.16.58.29;	author espie;	state Exp;
branches;
next	1.54;

1.54
date	2002.03.24.22.47.39;	author brad;	state Exp;
branches;
next	1.53;

1.53
date	2002.01.05.11.00.03;	author espie;	state Exp;
branches;
next	1.52;

1.52
date	2002.01.01.01.21.18;	author espie;	state Exp;
branches;
next	1.51;

1.51
date	2001.10.31.18.46.28;	author espie;	state Exp;
branches;
next	1.50;

1.50
date	2001.10.08.19.10.03;	author espie;	state Exp;
branches;
next	1.49;

1.49
date	2001.09.28.06.02.13;	author pvalchev;	state Exp;
branches;
next	1.48;

1.48
date	2001.09.15.11.51.35;	author espie;	state Exp;
branches;
next	1.47;

1.47
date	2001.09.10.23.55.13;	author miod;	state Exp;
branches;
next	1.46;

1.46
date	2001.08.22.09.03.04;	author espie;	state Exp;
branches;
next	1.45;

1.45
date	2001.08.10.22.58.56;	author naddy;	state Exp;
branches;
next	1.44;

1.44
date	2001.07.13.14.06.53;	author espie;	state Exp;
branches;
next	1.43;

1.43
date	2001.07.13.11.24.22;	author naddy;	state Exp;
branches;
next	1.42;

1.42
date	2001.07.10.09.38.32;	author espie;	state Exp;
branches;
next	1.41;

1.41
date	2001.07.09.10.26.18;	author espie;	state Exp;
branches;
next	1.40;

1.40
date	2001.07.04.18.24.46;	author espie;	state Exp;
branches;
next	1.39;

1.39
date	2001.07.04.15.37.20;	author espie;	state Exp;
branches;
next	1.38;

1.38
date	2001.07.04.15.07.28;	author espie;	state Exp;
branches;
next	1.37;

1.37
date	2001.05.06.01.27.55;	author lebel;	state Exp;
branches;
next	1.36;

1.36
date	2000.10.22.15.42.27;	author espie;	state Exp;
branches;
next	1.35;

1.35
date	2000.10.10.00.40.46;	author espie;	state Exp;
branches;
next	1.34;

1.34
date	2000.09.12.16.15.44;	author brad;	state Exp;
branches;
next	1.33;

1.33
date	2000.04.09.17.36.48;	author espie;	state Exp;
branches;
next	1.32;

1.32
date	2000.03.24.23.28.13;	author espie;	state Exp;
branches;
next	1.31;

1.31
date	2000.03.05.18.30.30;	author espie;	state Exp;
branches;
next	1.30;

1.30
date	2000.02.22.17.08.41;	author espie;	state Exp;
branches;
next	1.29;

1.29
date	2000.02.15.05.04.37;	author turan;	state Exp;
branches;
next	1.28;

1.28
date	2000.02.12.08.02.22;	author turan;	state Exp;
branches;
next	1.27;

1.27
date	2000.02.12.00.43.59;	author espie;	state Exp;
branches;
next	1.26;

1.26
date	2000.02.11.01.10.04;	author espie;	state Exp;
branches;
next	1.25;

1.25
date	2000.02.02.17.02.39;	author espie;	state Exp;
branches;
next	1.24;

1.24
date	99.09.17.11.42.05;	author espie;	state Exp;
branches;
next	1.23;

1.23
date	99.09.06.15.38.26;	author espie;	state Exp;
branches;
next	1.22;

1.22
date	99.08.22.17.28.42;	author espie;	state Exp;
branches;
next	1.21;

1.21
date	99.08.22.15.50.38;	author espie;	state Exp;
branches;
next	1.20;

1.20
date	99.04.02.22.49.19;	author espie;	state Exp;
branches;
next	1.19;

1.19
date	99.03.25.21.51.27;	author espie;	state Exp;
branches;
next	1.18;

1.18
date	99.03.21.07.51.08;	author espie;	state Exp;
branches;
next	1.17;

1.17
date	99.03.09.20.27.51;	author espie;	state Exp;
branches;
next	1.16;

1.16
date	99.03.09.17.22.51;	author espie;	state Exp;
branches;
next	1.15;

1.15
date	99.03.09.17.12.05;	author espie;	state Exp;
branches;
next	1.14;

1.14
date	99.03.02.04.41.04;	author marc;	state Exp;
branches;
next	1.13;

1.13
date	99.02.26.17.48.37;	author espie;	state Exp;
branches;
next	1.12;

1.12
date	99.02.26.16.18.43;	author espie;	state Exp;
branches;
next	1.11;

1.11
date	99.02.21.04.26.13;	author marc;	state Exp;
branches;
next	1.10;

1.10
date	99.02.18.02.37.33;	author marc;	state Exp;
branches;
next	1.9;

1.9
date	99.01.09.16.53.22;	author espie;	state Exp;
branches;
next	1.8;

1.8
date	98.12.23.02.45.07;	author espie;	state Exp;
branches;
next	1.7;

1.7
date	98.12.19.00.57.57;	author espie;	state Exp;
branches;
next	1.6;

1.6
date	98.12.10.12.24.21;	author d;	state Exp;
branches;
next	1.5;

1.5
date	98.12.04.00.24.31;	author espie;	state Exp;
branches;
next	1.4;

1.4
date	98.10.13.14.52.34;	author espie;	state Exp;
branches;
next	1.3;

1.3
date	98.10.11.14.08.23;	author espie;	state Exp;
branches;
next	1.2;

1.2
date	98.10.02.18.51.24;	author espie;	state Exp;
branches;
next	1.1;

1.1
date	98.09.26.08.53.03;	author espie;	state Exp;
branches
	1.1.1.1;
next	;

1.1.1.1
date	98.09.26.08.53.03;	author espie;	state Exp;
branches;
next	;


desc
@@


1.84
log
@bye bye
@
text
@# $OpenBSD: Makefile,v 1.83 2004/10/20 09:14:40 espie Exp $

ONLY_FOR_ARCHS=	alpha i386 m68k sparc sparc64 powerpc vax

MAKE_GXX=Yes
MAKE_FORTRAN=Yes
MAKE_OBJC=Yes
# Java is still mostly broken (boehm-gc)

.if ${MACHINE_ARCH} == "i386"
MAKE_JAVA=Yes
#MAKE_ADA=Yes
#AS_PATH=/usr/bin/as
#LD_PATH=/usr/bin/ld
.endif

MAKE_GXX?=No
MAKE_FORTRAN?=No
MAKE_OBJC?=No
MAKE_JAVA?=No
MAKE_ADA?=No

MYDIR=lang/egcs/stable

# This is a configuration file for gcc

COM=		'GNU compiler collection'
COMMENT=	${COM}: core C compiler
COMMENT-c++ =	${COM}: C++ compiler
COMMENT-estdc=	${COM}: C++ compiler library
COMMENT-g77=	${COM}: f77 compiler
COMMENT-java=	${COM}: java compiler
COMMENT-objc=	${COM}: obj C compiler
COMMENT-ada=	${COM}: Ada compiler

PKGNAME=	gcc-$V
PKGNAME-c++ =	g++-$V
PKGNAME-estdc =	libstdc++-$V
PKGNAME-g77=	g77-$V
PKGNAME-java=	gcj-$V
PKGNAME-objc=	gobjc-$V
PKGNAME-ada=	gnat-$V

BUILD_DEPENDS=	::devel/autoconf/2.13
BUILD_DEPENDS+=	::devel/metaauto
SUBPACKAGE?=
.if ${MAKE_JAVA:L} == "yes"
.  if !defined(PACKAGING) || ${SUBPACKAGE} == "-java"
LIB_DEPENDS+=gc::devel/boehm-gc
.  endif
.endif

# This can be patched out, apart from java that wants a pure parser.
BUILD_DEPENDS+= :bison-*:devel/bison

CATEGORIES=	lang 
MAINTAINER=	Marc Espie <espie@@openbsd.org>


PERMIT_PACKAGE_FTP=Yes
PERMIT_DISTFILES_FTP=Yes
PERMIT_PACKAGE_CDROM=Yes
PERMIT_DISTFILES_CDROM=Yes

# user configuration section

# see files/tests for precise testing procedure


.if ${MAKE_JAVA:L} == "yes"
MAKE_GXX=Yes
.endif

MULTI_PACKAGES=
# No sub packages description
DESCR=${PKGDIR}/DESCR

REGRESS_DEPENDS=::devel/dejagnu

# No way around it, java wants a pure parser
.if ${MAKE_JAVA:L} == "yes"
BUILD_DEPENDS+=:bison-*:devel/bison
.endif

#### fetch section

V=3.3.2
DIRECTORY=releases/${DISTNAME}/
DISTNAME=   gcc-$V

# getting the right archives where they should be
MASTER_SITE_SUBDIR=${LATEST_DATE}

DIST_SUBDIR=egcs

DISTFILES=  gcc-$V.tar.bz2

SITES=	

SITES+= ftp://ftp.uvsq.fr/pub/gcc/${DIRECTORY}
SITES+= ftp://ftp.grolier.fr/pub/egcs/${DIRECTORY}
SITES+= ftp://gd.tuwien.ac.at/gnu/gcc/${DIRECTORY}
SITES+= ftp://chardonnay.elis.rug.ac.be/pub/mirrors/gcc.cygnus.com/pub/gcc/${DIRECTORY}
SITES+= ftp://gd.tuwien.ac.at/gnu/gcc/${DIRECTORY}
SITES+=	ftp://egcs.cygnus.com/pub/egcs/${DIRECTORY} 
SITES+= ftp://ftp.goof.com/pub/pcg/egcs/${DIRECTORY}
SITES+= ftp://go.cygnus.com/pub/ftp.cygnus.com/egcs/${DIRECTORY}
SITES+= ftp://cambridge.cygnus.com/pub/egcs/${DIRECTORY}
SITES+= ftp://sunsite.doc.ic.ac.uk/Mirrors/egcs.cygnus.com/pub/egcs/${DIRECTORY}

SITES+= ftp://ftp.gts.cz/pub/MIRRORS/ftp.cygnus.com/pub/egcs/${DIRECTORY}
SITES+= ftp://sunsite.auc.dk/pub/egcs/${DIRECTORY}
SITES+= ftp://ftp.fu-berlin.de/unix/languages/egcs/egcs/${DIRECTORY}
SITES+= ftp://ftp.gwdg.de/pub/cygnus/egcs/${DIRECTORY}
SITES+= ftp://ftp.mpi-sb.mpg.de/pub/gnu/mirror/egcs.cygnus.com/egcs/${DIRECTORY}
SITES+= ftp://ftp.uni-trier.de/pub/languages/c/implementation/egcs/${DIRECTORY}
SITES+= ftp://ftp.sunet.se/pub/gnu/egcs/${DIRECTORY}
SITES+= ftp://ftp.unicamp.br/pub/gnu/=EXTRA=/cygnus/egcs/${DIRECTORY}
SITES+= ftp://ftp.lbi.ro/mirrors/ftp.cygnus.com/pub/egcs/${DIRECTORY}
SITES+= ftp://ftp.ntua.gr/pub/gnu/egcs/${DIRECTORY}
SITES+= ftp://ftp.nluug.nl/pub/languages/egcs/${DIRECTORY}
SITES+= ftp://ftp.dti.ad.jp/pub/lang/egcs/${DIRECTORY}
SITES+= ftp://ftp.win.or.jp/pub/lang/egcs/${DIRECTORY}
SITES+= ftp://ftp.telewaynet.ad.jp/pub/lang/egcs/${DIRECTORY}
SITES+= ftp://ftp.lab.kdd.co.jp/lang/egcs/${DIRECTORY}
SITES+= ftp://ftp.crc.ca/pub/packages/egcs/${DIRECTORY}
SITES+= ftp://ftp.nc.orc.ru/pub/egcs/${DIRECTORY}
SITES+= ftp://ftp.u-aizu.ac.jp/pub/lang/C/pcg/egcs/${DIRECTORY}
SITES+= ftp://ftp.maisel.int-evry.fr/pub/linux/pentium/egcs/${DIRECTORY}
SITES+= ftp://ftp.yggdrasil.com/mirrors/site/egcs.cygnus.com/pub/egcs/${DIRECTORY}
SITES+= ftp://unix.hensa.ac.uk/mirrors/egcs.cygnus.com/pub/egcs/${DIRECTORY}

# Can't contact those, maybe they work ?
SITES+= ftp://sunsite.mff.cuni.cz/pub/GNU/egcs/${DIRECTORY}
SITES+= ftp://sunsite.icm.edu.pl/pub/programming/egcs/${DIRECTORY}
SITES+= ftp://ftp.task.gda.pl/mirror/egcs.cygnus.com/pub/egcs/${DIRECTORY}
SITES+= ftp://ftp.lca.uevora.pt/pub/egcs/${DIRECTORY}
SITES+= ftp://cair-archive.kaist.ac.kr/pub/gnu/egcs/${DIRECTORY}
SITES+= ftp://linux.ihep.su/pub/cygnus/egcs/${DIRECTORY}
SITES+= ftp://linux.cis.nctu.edu.tw/pub/packages/pcg/egcs/${DIRECTORY}
SITES+= ftp://ftp.ninemoons.com/pub/mirrors/egcs/${DIRECTORY}

# Only contains empty gcc-3.0 directory - maybe it gets updated at 
# some point?
SITES+= ftp://ftp.funet.fi/mirrors/ftp.cygnus.com/pub/egcs/${DIRECTORY}

# Bad mirrors (no snapshot)
# ftp.lip6.fr, ftp.ilog.fr, ftp.irisa.fr
# No route to host
# mirrors.aarnet.edu.au
#SITES+=	ftp://ftp.lip6.fr/pub/egcs/${DIRECTORY}
#SITES+= ftp://ftp.ilog.fr/pub/Mirrors/egcs/${DIRECTORY}
#SITES+= ftp://ftp.irisa.fr/pub/mirrors/egcs.cygwin.com/gcc/${DIRECTORY}
MASTER_SITES=${SITES:S/%DATE%/${LATEST_DATE}/}

# add a possible next snapshot

#### 
# Patch section

#ac_dirs=gcc libiberty libstdc++-v3 libf2c/libI77 libffi fastjar libjava
ac_dirs=gcc libiberty libf2c/libI77 libffi fastjar libjava
rm_dirs=zlib texinfo boehm-gc

# get openbsd configuration files where they should be
post-patch:
#	cp -R ${FILESDIR}/config/* ${WRKSRC}
#	cp -R ${FILESDIR}/include/* ${WRKSRC}/gcc/ginclude
	cp ${FILESDIR}/config/gcc/config/i386/openbsdelf.h \
	    ${WRKSRC}/gcc/config/i386/openbsdelf.h 
	cp ${FILESDIR}/config/gcc/config/exec-stack.h \
	    ${WRKSRC}/gcc/config/exec-stack.h 
	cd ${WRKSRC} && contrib/gcc_update --touch
# rebuild configure files after patching, then move source around !!!
# XXX: don't try to autoconf the main configure file, it's not autoconf.
#	cd ${WRKSRC}/libstdc++-v3 && PATH=${PORTPATH} AUTOCONF_VERSION=2.13 autoheader
.for ac_dir in ${ac_dirs}
	cd ${WRKSRC}/${ac_dir} && PATH=${PORTPATH} AUTOCONF_VERSION=2.13 autoconf
.endfor
	cd ${WRKSRC} && rm -rf ${rm_dirs}




####
# configure section
#
# define AS_PATH/LD_PATH is you don't want to use the default as/ld.
# This should not be used for regular releases, but if you're using this
# snapshot, you know what you're doing, don't you ?

CONFIGURE_STYLE=	gnu
MODGNU_CONFIG_GUESS_DIRS=	${WRKSRC} ${WRKSRC}/gcc

LANGS=c
.if ${MAKE_GXX:L} == "yes"
LANGS:=${LANGS},c++
MULTI_PACKAGES+=-c++ -estdc
.endif
.if ${MAKE_FORTRAN:L} == "yes"
LANGS:=${LANGS},f77
MULTI_PACKAGES+=-g77
.endif
.if ${MAKE_OBJC:L} == "yes"
LANGS:=${LANGS},objc
MULTI_PACKAGES+=-objc
.endif
.if ${MAKE_JAVA:L} == "yes"
LANGS:=${LANGS},java
MULTI_PACKAGES+=-java
CONFIGURE_ARGS+=--enable-java-gc=system-boehm
.endif
.if ${MAKE_ADA:L} == "yes"
LANGS:=${LANGS},ada
MULTI_PACKAGES+=-ada

CONFIGURE_ENV=ADAC=${LOCALBASE}/bin/egcc GNATBIND=${LOCALBASE}/bin/gnatbind
MAKE_ENV=ADAC=${LOCALBASE}/bin/egcc GNATBIND=${LOCALBASE}/bin/gnatbind
CC=${LOCALBASE}/bin/egcc
BUILD_DEPENDS+=:gnat-*:lang/egcs/stable,-ada
.endif
CONFIGURE_ENV+=am_cv_func_iconv=no

# Note: the configure target passes CFLAGS to the configure script anyways.

CFLAGS=-O2 -g


CONFIGURE_ARGS= --verbose --program-transform-name=s,^,e, \
--disable-nls  --with-system-zlib

# This is needed, as internal cpp is no longer compatible with the
# visible beast
CONFIGURE_ARGS+=--enable-cpp
CONFIGURE_ARGS+=--enable-languages=${LANGS}

.if ${MAKE_JAVA:L} == "yes"
CONFIGURE_ARGS+=--enable-sjlj-exceptions

.endif


# if you wish to try your luck
#CONFIGURE_ARGS+= --enable-threads=posix

.if defined(AS_PATH)
CONFIGURE_ARGS += --with-as=${AS_PATH}
.else
CONFIGURE_ARGS += --with-gnu-as 
.endif

.if defined(LD_PATH)
CONFIGURE_ARGS += --with-ld=${LD_PATH}
.else
CONFIGURE_ARGS += --with-gnu-ld 
.endif

CONFIGURE_ARGS += ${CONFIGURE_SHARED}

SEPARATE_BUILD=concurrent



####
# build section
# Issues without gmake:
# stuff doesn't get passed thru correctly to libtool in multi-do
# libstdc++-v3 wants gmake
# java wants gmake
USE_GMAKE= yes

# you shouldn't skip bootstrap unless you know what you're doing
# use bootstrap-lean if you're pressed for space
ALL_TARGET=bootstrap
#ALL_TARGET=bootstrap3
# ALL_TARGET=bootstrap-lean
MAKE_FLAGS=libstdc___la_LDFLAGS='-version-info 31:0:0 -lm'

# desactivate the fixincludes mechanism by supplying a script which does
# nothing
pre-build:
	sed -e s,@@WRKBUILD@@,${WRKBUILD}, -e s,@@FILESDIR@@,${FILESDIR}, \
	${FILESDIR}/fixinc.sh.m4 >${WRKSRC}/gcc/fixinc/openbsd-special
	chmod a+x ${WRKSRC}/gcc/fixinc/openbsd-special
	echo "cp ${WRKSRC}/gcc/fixinc/openbsd-special ${WRKBUILD}/gcc/fixinc.sh" >${WRKSRC}/gcc/fixinc/mkfixinc.sh

####
# Install & tests section 

post-build:
		# avoid packaging include copies along...
	find ${WRKBUILD} -name \*.orig|xargs rm
.if ${MAKE_ADA:L} == "yes"
	cd ${WRKBUILD}/gcc && env ${MAKE_ENV} ${MAKE_PROGRAM} ${MAKE_FLAGS} gnatlib_and_tools
.endif


post-install:
	-ldconfig -U ${PREFIX}/lib ${PREFIX}/lib/. ${PREFIX}/lib/fpic ${PREFIX}/lib/nof

# Tests still need to be performed at the end of install, I don't know why.

REGRESS_DEPENDS+=::${MYDIR}
.if ${MAKE_GXX:L} == "yes"
REGRESS_DEPENDS+=::${MYDIR},-c++,-estdc
.endif
.if ${MAKE_FORTRAN:L} == "yes"
REGRESS_DEPENDS+=::${MYDIR},-g77
.endif
.if ${MAKE_OBJC:L} == "yes"
REGRESS_DEPENDS+=::${MYDIR},-objc
.endif
.if ${MAKE_JAVA:L} == "yes"
REGRESS_DEPENDS+=::${MYDIR},-java
.endif
.if ${MAKE_ADA:L} == "yes"
REGRESS_DEPENDS+=::${MYDIR},-ada
.endif

TEST_RESULT=${WRKBUILD}/test.result

do-regress:
	@@cd ${WRKBUILD}; ulimit -c 0; \
	${MAKE_ENV} ${MAKE_PROGRAM} -k -f ${MAKE_FILE} check && \
	${WRKSRC}/contrib/test_summary >${TEST_RESULT}
	@@echo "Please send the tests results to the gcc project"
	@@echo "By invoking make send-results"

send-results: 
	[ -f ${TEST_RESULT} ] && sh ${TEST_RESULT}


.if ${MACHINE_ARCH} == "m68k" || ${MACHINE_ARCH} == "sparc"
PKG_ARGS+=-DPIC=1
.else
PKG_ARGS+=-DPIC=0
.endif

.if ${MACHINE_ARCH} == "powerpc"
PKG_ARGS+=-DPPC=1
.else
PKG_ARGS+=-DPPC=0
.endif

GCC_NAME=${WRKBUILD}/gcc/xgcc

.if defined(PACKAGING) && defined(SUBPACKAGE)
.  if !empty(SUBPACKAGE) && ${SUBPACKAGE} != "-estdc"
RUN_DEPENDS+=::${MYDIR}
.  endif
.  if ${SUBPACKAGE} == "-c++"
RUN_DEPENDS+=::${MYDIR},-estdc
.  endif
.endif

CONFIG=${MACHINE_ARCH}-unknown-openbsd${OSREV}
SUBST_VARS=CONFIG V
.include <bsd.port.mk>

@


1.83
log
@don't refer to deleted dir (from Alex Piotrowski)
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.82 2004/09/15 19:06:57 espie Exp $
@


1.82
log
@new style PLIST. new style fragments.
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.81 2004/01/31 14:58:03 espie Exp $
d23 1
a23 1
MYDIR=lang/egcs/snapshot
@


1.81
log
@switch to gcc 3.3.2 as a stable port
okay naddy@@
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.98 2003/11/19 10:07:04 espie Exp $
d334 1
a334 1
SED_PLIST=|sed -e '/^IFPIC:/s///'
d336 1
a336 1
SED_PLIST=|sed -e '/^IFPIC:/d'
d340 1
a340 1
SED_PLIST+=|sed -e '/^IFPPC:/s///'
d342 1
a342 1
SED_PLIST+=|sed -e '/^IFPPC:/d'
@


1.80
log
@Minor update, gcc 3.2.3. Only bug-fixes.
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.79 2003/06/27 23:02:45 espie Exp $
d3 1
a3 1
ONLY_FOR_ARCHS=	alpha i386 m68k sparc sparc64 powerpc
a8 2
MAKE_JAVA=No

d11 1
a12 1
MAKE_ADA=No
a14 2
.else
MAKE_ADA=No
d17 8
a30 1
COMMENT-chill=	${COM}: Chill compiler
a38 1
PKGNAME-chill=	gchill-$V
d46 6
d70 1
a70 1
.if defined(MAKE_JAVA) && ${MAKE_JAVA:L} == "yes"
d81 1
a81 1
.if defined(MAKE_JAVA) && ${MAKE_JAVA:L} == "yes"
d87 1
a87 1
V=3.2.3
d163 1
a163 1
rm_dirs=zlib texinfo #boehm-gc
d196 1
a196 1
.if defined(MAKE_GXX) && ${MAKE_GXX:L} == "yes"
d200 1
a200 1
.if defined(MAKE_FORTRAN) && ${MAKE_FORTRAN:L} == "yes"
d204 1
a204 1
.if defined(MAKE_OBJC) && ${MAKE_OBJC:L} == "yes"
d208 1
a208 1
.if defined(MAKE_JAVA) && ${MAKE_JAVA:L} == "yes"
d213 1
a213 1
.if defined(MAKE_ADA) && ${MAKE_ADA:L} == "yes"
d237 1
a237 1
.if defined(MAKE_JAVA) && ${MAKE_JAVA:L} == "yes"
a239 3
# For boehm-gc
#CONFIGURE_ENV+= LDFLAGS="${LDFLAGS} -L/usr/local/lib -lgc"
#CONFIGURE_ENV+= CPPFLAGS="${CPPFLAGS} -I/usr/local/include"
d266 4
a269 2
# should work without gmake. If it turns out to be needed, this must be 
# reported to MAINTAINER.
d293 1
a293 3
	mkdir -p ${WRKBUILD}/gcc/include/machine
	cp ${FILESDIR}/include/machine/ansi.h ${WRKBUILD}/gcc/include/machine
.if defined(MAKE_ADA) && ${MAKE_ADA:L} == "yes"
d303 3
a305 3
REGRESS_DEPENDS+=::lang/egcs/stable
.if defined(MAKE_GXX) && ${MAKE_GXX:L} == "yes"
REGRESS_DEPENDS+=::lang/egcs/stable,-c++,-estdc
d307 2
a308 2
.if defined(MAKE_FORTRAN) && ${MAKE_FORTRAN:L} == "yes"
REGRESS_DEPENDS+=::lang/egcs/stable,-g77
d310 2
a311 2
.if defined(MAKE_OBJC) && ${MAKE_OBJC:L} == "yes"
REGRESS_DEPENDS+=::lang/egcs/stable,-objc
d313 2
a314 2
.if defined(MAKE_JAVA) && ${MAKE_JAVA:L} == "yes"
REGRESS_DEPENDS+=::lang/egcs/stable,-java
d316 2
a317 2
.if defined(MAKE_ADA) && ${MAKE_ADA:L} == "yes"
REGRESS_DEPENDS+=::lang/egcs/stable,-ada
d349 1
a349 1
RUN_DEPENDS+=::lang/egcs/stable
d352 1
a352 1
RUN_DEPENDS+=::lang/egcs/stable,-estdc
@


1.79
log
@autoheader/autoconf doesn't regen config.h.in in libstdc++-v3 correctly.
Do not attempt it until it's fixed.
There's currently no patch that requires this anyways...
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.78 2003/06/26 15:00:14 espie Exp $
d33 2
a34 2
PKGNAME=	gcc-$Vp0
PKGNAME-c++ =	g++-$Vp0
d79 1
a79 1
V=3.2.2
@


1.78
log
@Reactivate objc and Fortran, as these work...
C++ really is a problem.
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.77 2003/06/26 00:22:01 espie Exp $
a14 3
MAKE_GXX=No
MAKE_FORTRAN=Yes
MAKE_OBJC=Yes
d153 2
a154 1
ac_dirs=gcc libiberty libstdc++-v3 libf2c/libI77 libffi fastjar libjava
d168 1
a168 1
	cd ${WRKSRC}/libstdc++-v3 && PATH=${PORTPATH} AUTOCONF_VERSION=2.13 autoheader
@


1.77
log
@Don't build C++, Fortran, Objective-C yet on i386.
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.76 2003/06/26 00:19:50 espie Exp $
d16 2
a17 2
MAKE_FORTRAN=No
MAKE_OBJC=No
@


1.76
log
@Preliminary work at making it run on i386-ELF.
From dale and me.
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.75 2003/06/16 17:25:19 sturm Exp $
d5 3
a7 3
MAKE_GXX=No
MAKE_FORTRAN=No
MAKE_OBJC=No
d15 3
d330 1
a330 1
.if ${MACHINE_ARCH} == "7386" || ${MACHINE_ARCH} == "m68k" || ${MACHINE_ARCH} == "sparc"
@


1.75
log
@add dummy -fno-stack-protector to gcc/g++, does nothing
bump version on gcc/g++ packages
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.74 2003/06/10 15:43:20 brad Exp $
d5 3
a7 3
MAKE_GXX=Yes
MAKE_FORTRAN=Yes
MAKE_OBJC=Yes
d13 2
a14 1
MAKE_ADA=Yes
d160 4
d327 1
a327 1
.if ${MACHINE_ARCH} == "i386" || ${MACHINE_ARCH} == "m68k" || ${MACHINE_ARCH} == "sparc"
@


1.74
log
@lang/egcs/dejagnu -> devel/dejagnu
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.73 2003/02/16 14:26:07 espie Exp $
d32 2
a33 2
PKGNAME=	gcc-$V
PKGNAME-c++ =	g++-$V
@


1.73
log
@heh, ldconfig matches dir names.
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.72 2003/02/15 14:38:27 espie Exp $
d69 1
a69 1
REGRESS_DEPENDS=::lang/egcs/dejagnu
@


1.72
log
@Update to gcc 3.2.2 and fix autoconf issue
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.71 2002/11/25 15:37:59 brad Exp $
d288 1
a288 1
	-ldconfig -U ${PREFIX}/lib ${PREFIX}/lib/fpic ${PREFIX}/lib/nof
@


1.71
log
@add crtsavres.o to PLIST if on powerpc
--
espie@@ & drahn@@ ok
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.70 2002/11/24 11:52:32 espie Exp $
d8 2
d14 2
a15 2
# Java is still mostly broken (boehm-gc)
MAKE_JAVA=Yes
a16 1
MAKE_JAVA=No
d41 2
a42 1
BUILD_DEPENDS=	::devel/autoconf
d78 1
a78 1
V=3.2.1
d162 1
a162 1
	cd ${WRKSRC}/libstdc++-v3 && PATH=${PORTPATH} autoheader
d164 1
a164 1
	cd ${WRKSRC}/${ac_dir} && PATH=${PORTPATH} autoconf
d178 1
a178 1
CONFIGURE_STYLE=	gnu dest
d197 1
d233 1
a233 1
#CONFIGURE_ARGS+= --enable-threads=yes
a264 2

FAKE_FLAGS=DESTDIR=${WRKINST}
@


1.70
log
@Update to 3.2.1
Remove a large number of `speed-up patches' as they are likely to be
the cause for sparc64 and friends issues.
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.69 2002/10/05 09:40:58 espie Exp $
d85 1
a85 1
DISTFILES=  gcc-3.2.1.tar.bz2
d326 7
@


1.69
log
@non-insane name for libstdc++.
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.68 2002/09/30 20:52:45 naddy Exp $
a4 1
MAKE_ADA=Yes
d9 3
d14 1
a14 2

.if ${MACHINE_ARCH} != "i386"
d76 1
a76 1
V=3.2
d85 1
a85 1
DISTFILES=  gcc-3.2.tar.bz2
@


1.68
log
@Split libestdc into a separate package so we can add a dependency
for ports built with g++-3.  From pvalchev@@ and yours truly; ok pvalchev@@
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.67 2002/09/28 19:19:51 brad Exp $
d32 1
a32 1
PKGNAME-estdc =	libestdc-$V
@


1.67
log
@remove another dir from the linker cache durring post-install
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.66 2002/09/25 19:44:32 lebel Exp $
d23 1
d32 1
a44 1
NEED_VERSION=	1.474
d181 1
a181 1
MULTI_PACKAGES+=-c++
d292 1
a292 1
REGRESS_DEPENDS+=::lang/egcs/stable,-c++
d328 1
a328 1
.  if !empty(SUBPACKAGE)
d330 3
@


1.66
log
@in fact, it should be everything other than i386 that disable java and ada;
from brad@@
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.65 2002/09/25 17:20:23 lebel Exp $
d285 1
a285 1
	-ldconfig -U ${PREFIX}/lib ${PREFIX}/lib/fpic
@


1.65
log
@Make gcc 3.2 build by default on sparc64 by desactivating ada and java;
pval@@ ok
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.64 2002/09/17 22:16:25 todd Exp $
d13 1
a13 1
.if ${MACHINE_ARCH:Msparc64} 
@


1.64
log
@tweak autoconf to be a .for construct, rm to be a list of files; ok espie@@
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.63 2002/09/17 12:56:19 espie Exp $
d13 4
@


1.63
log
@make sure to bootstrap with ada i ada is requested.
disable libiconv entirely.
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.62 2002/09/14 10:59:44 avsm Exp $
d144 3
a153 2
	cd ${WRKSRC}/gcc && PATH=${PORTPATH} autoconf
	cd ${WRKSRC}/libiberty && PATH=${PORTPATH} autoconf
d155 4
a158 7
	cd ${WRKSRC}/libstdc++-v3 && PATH=${PORTPATH} autoconf
	cd ${WRKSRC}/libf2c/libI77 && PATH=${PORTPATH} autoconf
	cd ${WRKSRC}/libffi && PATH=${PORTPATH} autoconf
	cd ${WRKSRC}/fastjar && PATH=${PORTPATH} autoconf
	cd ${WRKSRC}/libjava && PATH=${PORTPATH} autoconf
	cd ${WRKSRC} && rm -rf texinfo
	cd ${WRKSRC} && rm -rf zlib
d216 4
@


1.62
log
@correct MASTER_SITE
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.61 2002/09/14 10:14:50 espie Exp $
d198 2
d201 1
a217 1
#CC=${LOCALBASE}/bin/egcc
@


1.61
log
@Update to gcc 3.2, remove integrated patches.
Fix packing lists, including missing %%SHARED%%.
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.60 2002/06/07 01:38:59 drahn Exp $
d83 1
a83 1
SITES+= ftp://ftp.uvsq.fr/pub/egcs/${DIRECTORY}
@


1.60
log
@Changes to allow gcc3.1 to build on powerpc (macppc), likely some of the
mods are wrong, work in progress.
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.59 2002/06/05 23:31:06 espie Exp $
d70 1
a70 1
V=3.1
d79 1
a79 1
DISTFILES=  gcc-3.1${EXTRACT_SUFX}
d215 1
@


1.59
log
@bad V. One is OSREV, the other is truely V.
Use CONFIG=${MACHINE_ARCH}-unknown-openbsd${OSREV} instead.
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.58 2002/05/30 08:57:32 espie Exp $
d3 1
a3 1
ONLY_FOR_ARCHS=	alpha i386 m68k sparc sparc64
@


1.58
log
@clean-up Makefile, add test sections.
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.57 2002/05/29 01:02:39 espie Exp $
d5 1
a5 1
#MAKE_ADA=Yes
d323 2
a324 1
SUBST_VARS=V OSREV
@


1.57
log
@Ada build infrastructure.
Note that Ada needs an ada compiler to bootstrap....

Binary packages soon to appear for i386.
@
text
@d1 3
a3 1
# $OpenBSD: Makefile,v 1.56 2002/05/28 01:13:46 espie Exp $
a4 1
ONLY_FOR_ARCHS=	alpha i386 m68k sparc
d6 7
d14 1
a14 1
# This is a configuration file for egcs
a32 2
# we could remove this dependency by patching configure, but this is not
# reasonable...
d35 1
a35 1
# This should be patched out later.
d53 1
a53 4
# cygnus packaging scheme is now working, though it is weird.
# namely, testsuite holds all the tests. g++-tests no longer exists,
# and g77-tests only holds duplicates from the main testsuite archive.
#MAKE_TESTS=yes
d55 1
a55 3
MAKE_FORTRAN=Yes
MAKE_OBJC=Yes
MAKE_JAVA=Yes
a308 4
#USE_GMAKE=Yes
#SED_PLIST=|sed -e s/@@GCCARCH@@/`${GCC_NAME} -dumpmachine`/ \
#	-e s/@@VERSION@@/`${GCC_NAME} -dumpversion`/ \
#	-e 's/@@COREPKG@@/${DISTNAME}-core/'
d310 5
@


1.56
log
@Seems that java is compiling alright too...

ada will be a tougher matter...
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.55 2002/05/27 16:58:29 espie Exp $
d4 1
d15 1
d23 1
a52 2
# we don't care about chill
#MAKE_CHILL=yes
d175 1
a175 1
.if defined(MAKE_GXX)
d179 1
a179 1
.if defined(MAKE_FORTRAN)
d183 1
a183 4
.if defined(MAKE_CHILL)
LANGS.=${LANGS},CHILL
.endif
.if defined(MAKE_OBJC)
d187 1
a187 1
.if defined(MAKE_JAVA)
d191 7
a203 2
#CONFIGURE_ENV=ADAC=${WRKDIR}/bin/adac GNATBIND=${WRKDIR}/bin/gnatbind
#MAKE_ENV=ADAC=${WRKDIR}/bin/adac GNATBIND=${WRKDIR}/bin/gnatbind
d212 1
a212 1
.if defined(MAKE_JAVA)
d269 4
d280 1
a280 1
.if defined(MAKE_GXX)
d283 1
a283 1
.if defined(MAKE_FORTRAN)
d286 1
a286 1
.if defined(MAKE_OBJC)
d289 1
a289 1
.if defined(MAKE_JAVA)
d292 2
a293 2
.if defined(MAKE_CHILL)
REGRESS_DEPENDS+=::lang/egcs/stable,-chill
@


1.55
log
@Update to gcc 3.1, should compile at least on i386.
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.54 2002/03/24 22:47:39 brad Exp $
d53 1
a53 1
#MAKE_JAVA=Yes
d191 1
d199 2
@


1.54
log
@don't bother trying to build on unsupported archs
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.53 2002/01/05 11:00:03 espie Exp $
d68 1
a68 1
V=3.0.3
d77 1
a77 1
DISTFILES=  gcc-3.0.3${EXTRACT_SUFX}
d199 1
a199 1
--disable-nls 
d264 2
@


1.53
log
@switch to real 3.0.3 distrib, the 3.0.2 + 3.0.2-3.0.3 patch was only
because of faulty net connectivity.
@
text
@d1 3
a3 1
# $OpenBSD: Makefile,v 1.52 2002/01/01 01:21:18 espie Exp $
@


1.52
log
@3.0.3, at least working on i386.
Rename libstdc++ to libestdc++ to avoid confusion with /usr/src
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.51 2001/10/31 18:46:28 espie Exp $
d75 1
a75 2
DISTFILES=  gcc-3.0.2${EXTRACT_SUFX}
PATCHFILES=	gcc-3.0.2-3.0.3.diff.bz2
a138 6

pre-patch:
	cd ${WRKDIR} && mv gcc-3.0.2 gcc-3.0.3

PATCH_DIST_STRIP=-p1

@


1.51
log
@gcc 3.0.2. Some patches gone.
Rename packages for various reasons.
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.50 2001/10/08 19:10:03 espie Exp $
d66 1
a66 1
V=3.0.2
d75 2
a76 1
DISTFILES=  gcc-$V${EXTRACT_SUFX}
d140 6
@


1.50
log
@fit tests into regress framework.
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.49 2001/09/28 06:02:13 pvalchev Exp $
d13 6
a18 6
PKGNAME=	${DISTNAME}-core
PKGNAME-c++ =	${DISTNAME}-c++
PKGNAME-chill=	${DISTNAME}-chill
PKGNAME-g77=	${DISTNAME}-g77
PKGNAME-java=	${DISTNAME}-java
PKGNAME-objc=	${DISTNAME}-objc
d25 1
a25 1
BUILD_DEPENDS+= bison:bison-*:devel/bison
d66 1
a66 1
V=3.0.1
d286 1
a286 1
	${MAKE_ENV} make -f ${MAKE_FILE} check && \
d303 1
a303 1
RUN_DEPENDS+=egcc::lang/egcs/stable
@


1.49
log
@CONFIGURE_STYLE=gnu w/ proper MODGNU_CONFIG_GUESS_DIRS
needed for the powerpc -> macppc name change
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.48 2001/09/15 11:51:35 espie Exp $
d5 1
a5 1
COM=		'GNU compiler collection (experimental)'
d22 1
a22 1
BUILD_DEPENDS=	autoconf::devel/autoconf
d28 1
a28 1
NEED_VERSION=	1.420
a31 2
# experimental port, changes once a week, don't bother remirroring distfiles.

a36 8
# Testers for the new configurations:
# Jason L.Wright & Marco S.Hyman for sparc,
# Michael Shalayeff for hppa,
# Wim Van Deputte for alpha,
# Steve Murphree for m88k,
# Per Fogelstrom and Todd Miller for mips,
# Dale Rahn for rs6000.

d57 1
a57 3
.if defined(MAKE_TESTS) && ${MAKE_TESTS:L} == "yes"
BUILD_DEPENDS+=	runtest::lang/egcs/dejagnu
.endif
d61 1
a61 1
BUILD_DEPENDS+=bison:bison-*:devel/bison
a170 2
#CONFIGURE_SCRIPT=../source/configure

d262 1
d264 18
a281 1
.if defined(MAKE_TESTS)
d284 2
a285 2
post-install:
	@@(cd ${WRKBUILD}; ulimit -c 0; \
d287 1
a287 1
	${WRKSRC}/contrib/test_summary >${TEST_RESULT})
a292 2
.else
.endif
@


1.48
log
@shared libs
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.47 2001/09/10 23:55:13 miod Exp $
d181 1
@


1.47
log
@Typos
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.46 2001/08/22 09:03:04 espie Exp $
d57 1
a57 1
#MAKE_FORTRAN=Yes
d60 1
a60 1
#MAKE_OBJC=Yes
d166 1
d254 1
d304 1
a304 1
SUBST_VARS=OSREV V
@


1.46
log
@3.0.1 is out. Remove integrated patches.
Tweak packing-lists.
Put USE_GMAKE in for now...
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.45 2001/08/10 22:58:56 naddy Exp $
d43 2
a44 2
# Steve Murphee for m88k,
# Per Fogelstrom and Todd Millert for mips,
@


1.45
log
@needs USE_GMAKE
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.44 2001/07/13 14:06:53 espie Exp $
d28 1
a28 1
NEED_VERSION=	1.419
d57 1
a57 1
MAKE_FORTRAN=Yes
d60 1
a60 1
MAKE_OBJC=Yes
d78 1
a78 1
LATEST=3.0
d80 1
a80 1
DISTNAME=   gcc-${LATEST}
d87 1
a87 1
DISTFILES=  gcc-${LATEST}${EXTRACT_SUFX}
a238 1
#WRKBUILD=${WRKDIR}/build-${MACHINE_ARCH}
d302 1
@


1.44
log
@Some fixes:
- patch libstdc++-v3/libmath to unconfuse libtool.
- sparc needs the same fix as i386 to not emit bogus frame info.
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.43 2001/07/13 11:24:22 naddy Exp $
d247 1
a247 1
#USE_GMAKE= yes
@


1.43
log
@MASTER_SITES fix by Heikki Korpela <heko@@saitti.net>:
- Add ftp.funet.fi and ftp.sunet.se mirrors where available.
- Remove broken ftp.funet.fi references.
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.42 2001/07/10 09:38:32 espie Exp $
d247 1
a247 1
USE_GMAKE= yes
@


1.42
log
@Oops... Heikki, Fries.
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.41 2001/07/09 10:26:18 espie Exp $
a116 1
SITES+= ftp://ftp.funet.fi/mirrors/ftp.cygnus.com/pub/egcs/${DIRECTORY}
d133 4
@


1.41
log
@
Slightly better configuration:
- add patches from OpenBSD-current, to multilib libgcc as -fpic
- fix asm emitting code on i386, to avoid dwarf2 stuff. Similar patches
may be needed for other a.out arches...
- fix comment on i386.
- add -L/usr/lib/debug.
- finish -shared support.

Misc. configury:
- try to ensure libffi, libjava, fastjar will configure. So far, ld dumps
core in libjava though...

Use gmake for now, as it does not build completely with our make...

Still missing shared library pieces...
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.40 2001/07/04 18:24:46 espie Exp $
d294 2
a295 1
.if defined(PACKAGING) && !empty(SUBPACKAGE)
d297 1
@


1.40
log
@Needs a recent version for MACHINE_ARCH to be substituted.
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.39 2001/07/04 15:37:20 espie Exp $
d3 1
a3 1
# This is a configuration file for egcs, snapshot flavor
d57 1
a57 1
#MAKE_FORTRAN=Yes
d60 1
a60 1
#MAKE_OBJC=Yes
d161 1
d187 1
d194 1
d213 4
d244 1
a244 1
#USE_GMAKE= yes
d288 3
a290 3
SED_PLIST=|sed -e s/@@GCCARCH@@/`${GCC_NAME} -dumpmachine`/ \
	-e s/@@VERSION@@/`${GCC_NAME} -dumpversion`/ \
	-e 's/@@COREPKG@@/${DISTNAME}-core/'
d293 4
@


1.39
log
@Fix DIRECTORY for fetch
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.38 2001/07/04 15:07:28 espie Exp $
d28 1
a28 1
NEED_VERSION=	1.361
@


1.38
log
@Preliminary port of gcc 3.0.

Currently, bootstraps C and C++ on i386.

This is definitely not complete yet. Lots of libtool patches, and local
changes to 2.95.3 (such as proper -shared support) are missing,
but this should allow people to start banging on it.
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.84 2001/03/21 14:44:01 wilfried Exp $
d79 1
a79 1
DIRECTORY=release/%DATE%/
@


1.37
log
@lang: integrate COMMENT, bump NEED_VERSION.
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.36 2000/10/22 15:42:27 espie Exp $
d3 1
a3 1
COMMENT=	"experimental GNU C, C++, f77..., release flavor"
d5 14
a18 1
# This is a configuration file for egcs, stable release.
d24 3
d28 3
a30 3
NEED_VERSION=	1.402
FAKE=No
EXTRACT_SUFX=	.tar.bz2
d32 1
a32 1
MAINTAINER=	Marc Espie <espie@@openbsd.org>
d34 4
a37 6
#	GPL
PERMIT_PACKAGE_CDROM=	Yes
PERMIT_PACKAGE_FTP=	Yes
PERMIT_DISTFILES_CDROM=	Yes
PERMIT_DISTFILES_FTP=	Yes
COMES_WITH= 2.6
d56 18
a73 8
MAKE_GXX=yes
MAKE_FORTRAN=yes
MAKE_CHILL=yes
MAKE_OBJC=yes
MAKE_JAVA=yes

.if defined(MAKE_TESTS)
BUILD_DEPENDS+=	runtest::devel/dejagnu
a75 3
# if you want/need to use the mammoth archive. 
ONE_ARCHIVE=yes

a76 1
VERSION= 2.95.1
d78 3
a80 1
DIRECTORY=egcs/releases/%SUBDIR%/
d83 1
a83 2
MASTER_SITE_SUBDIR=gcc-2.95.1
DISTNAME= gcc-${VERSION}
d87 3
a89 3
.if defined(ONE_ARCHIVE)
DISTFILES= gcc-${VERSION}${EXTRACT_SUFX}
.else
d91 52
a142 20
DISTFILES=	gcc-core-${VERSION}${EXTRACT_SUFX}
.if defined(MAKE_GXX)
DISTFILES+=     gcc-g++-${VERSION}${EXTRACT_SUFX}
.endif
#.if defined(MAKE_TESTS)
#DISTFILES+=gcc-tests-${VERSION}${EXTRACT_SUFX}
#.endif
.if defined(MAKE_FORTRAN)
DISTFILES+=gcc-g77-${VERSION}${EXTRACT_SUFX}
.endif
.if defined(MAKE_JAVA)
DISTFILES+=gcc-java-${VERSION}${EXTRACT_SUFX}
.endif
.if defined(MAKE_OBJC)
DISTFILES+=gcc-objc-${VERSION}${EXTRACT_SUFX}
.endif
.if defined(MAKE_CHILL)
DISTFILES+=gcc-chill-${VERSION}${EXTRACT_SUFX}
.endif
.endif
d144 1
a144 49
MASTER_SITES=	ftp://egcs.cygnus.com/pub/${DIRECTORY} 
MASTER_SITES+=	ftp://ftp.lip6.fr/pub/${DIRECTORY}
MASTER_SITES+=	ftp://mirror.aarnet.edu.au/pub/${DIRECTORY}
MASTER_SITES+= ftp://go.cygnus.com/pub/ftp.cygnus.com/${DIRECTORY}
MASTER_SITES+= ftp://ftp.goof.com/pub/pcg/${DIRECTORY}
MASTER_SITES+= ftp://cambridge.cygnus.com/pub/${DIRECTORY}
MASTER_SITES+= ftp://ftp.ninemoons.com/pub/mirrors/${DIRECTORY}
MASTER_SITES+= ftp://sunsite.doc.ic.ac.uk/Mirrors/egcs.cygnus.com/pub/${DIRECTORY}
MASTER_SITES+= ftp://gd.tuwien.ac.at/gnu/${DIRECTORY}
MASTER_SITES+= ftp://ftp.ilog.fr/pub/Mirrors/${DIRECTORY}
MASTER_SITES+= ftp://ftp.irisa.fr/pub/mirrors/${DIRECTORY}
MASTER_SITES+= ftp://ftp.gts.cz/pub/MIRRORS/ftp.cygnus.com/pub/${DIRECTORY}
MASTER_SITES+= ftp://sunsite.auc.dk/pub/${DIRECTORY}
MASTER_SITES+= ftp://ftp.fu-berlin.de/unix/languages/${DIRECTORY}
MASTER_SITES+= ftp://ftp.gwdg.de/pub/cygnus/${DIRECTORY}
MASTER_SITES+= ftp://ftp.mpi-sb.mpg.de/pub/gnu/mirror/egcs.cygnus.com/${DIRECTORY}
MASTER_SITES+= ftp://ftp.uni-trier.de/pub/languages/c/implementation/${DIRECTORY}
MASTER_SITES+= ftp://ftp.sunet.se/pub/gnu/${DIRECTORY}
MASTER_SITES+= ftp://ftp.unicamp.br/pub/gnu/=EXTRA=/cygnus/${DIRECTORY}
MASTER_SITES+= ftp://ftp.lbi.ro/mirrors/ftp.cygnus.com/pub/${DIRECTORY}
MASTER_SITES+= ftp://ftp.ntua.gr/pub/gnu/${DIRECTORY}
MASTER_SITES+= ftp://ftp.nluug.nl/pub/languages/${DIRECTORY}
MASTER_SITES+= ftp://ftp.dti.ad.jp/pub/lang/${DIRECTORY}
MASTER_SITES+= ftp://ftp.win.or.jp/pub/lang/${DIRECTORY}
MASTER_SITES+= ftp://ftp.telewaynet.ad.jp/pub/lang/${DIRECTORY}
MASTER_SITES+= ftp://ftp.lab.kdd.co.jp/lang/${DIRECTORY}
MASTER_SITES+= ftp://ftp.funet.fi/mirrors/ftp.cygnus.com/pub/${DIRECTORY}
MASTER_SITES+= ftp://ftp.crc.ca/pub/packages/egcs/%SUBDIR%/
MASTER_SITES+= ftp://ftp.nc.orc.ru/pub/${DIRECTORY}
MASTER_SITES+= ftp://ftp.u-aizu.ac.jp/pub/lang/C/pcg/${DIRECTORY}
MASTER_SITES+= ftp://ftp.maisel.int-evry.fr/pub/linux/pentium/${DIRECTORY}
MASTER_SITES+= ftp://ftp.yggdrasil.com/mirrors/site/egcs.cygnus.com/pub/${DIRECTORY}
MASTER_SITES+= ftp://unix.hensa.ac.uk/mirrors/egcs.cygnus.com/pub/${DIRECTORY}

# couldn't contact those, maybe they work ?
MASTER_SITES+= ftp://sunsite.mff.cuni.cz/pub/GNU/${DIRECTORY}
MASTER_SITES+= ftp://sunsite.icm.edu.pl/pub/programming/${DIRECTORY}
MASTER_SITES+= ftp://ftp.task.gda.pl/mirror/egcs.cygnus.com/pub/${DIRECTORY}
MASTER_SITES+= ftp://ftp.lca.uevora.pt/pub/${DIRECTORY}
MASTER_SITES+= ftp://cair-archive.kaist.ac.kr/pub/gnu/${DIRECTORY}
MASTER_SITES+= ftp://linux.ihep.su/pub/cygnus/${DIRECTORY}
MASTER_SITES+= ftp://linux.cis.nctu.edu.tw/pub/packages/pcg/${DIRECTORY}

# Misc bug sections
pre-fetch:
.if (${MACHINE_ARCH} == "i386")
	@@(cd /tmp && /usr/bin/as -k ${FILESDIR}/gas-bug/test-i386-gas.s) || \
	(echo "Your gas has a bug, see ${FILESDIR}/gas-bug for details"; exit 1)
.endif
a148 17
PATCH_LIST=patch-core-*
.if defined(MAKE_GXX)
PATCH_LIST+=patch-g++-*
.endif
.if defined(MAKE_OBJC)
PATCH_LIST+=patch-objc-*
.endif
.if defined(MAKE_CHILL)
PATCH_LIST+=patch-chill-*
.endif
.if defined(MAKE_FORTRAN)
PATCH_LIST+=patch-g77-*
.endif
.if defined(MAKE_JAVA)
PATCH_LIST+=patch-java-*
.endif

d151 3
a153 4
		# avoid packaging include copies along...
	find ${WRKSRC} -name \*.orig|xargs rm
	cp -R ${FILESDIR}/config/* ${WRKSRC}
	rm -rf ${WRKSRC}/texinfo 
d156 11
a166 2
	cd ${WRKSRC}/gcc && PATH=${PORTPATH} autoreconf
	cd ${WRKSRC}/libiberty && PATH=${PORTPATH} autoreconf
d171 3
d175 3
a177 1
CONFIGURE_STYLE=gnu
d181 2
a182 1
LANGS+=c++
d185 1
a185 1
LANGS+=f77
d188 1
a188 1
LANGS+=CHILL
d191 1
a191 1
LANGS+=objc
d194 1
a194 1
LANGS+=java
d197 3
a199 1
CONFIGURE_ENV=LANGUAGES='${LANGS}'  
d201 3
a203 4
CONFIGURE_ARGS=--verbose --with-gnu-ld --with-gnu-as \
--program-transform-name=s,^,e, \
--disable-subdir-texinfo \
--disable-nls
d208 11
d220 7
a226 1
CONFIGURE_ARGS+=${CONFIGURE_SHARED}
a227 2
# Not really stable yet
# CONFIGURE_ARGS+= --enable-threads=yes
d229 3
a238 5
# desactivate the fixincludes mechanism by supplying a script which does
# nothing
pre-build:
	echo "#!/bin/sh" >${WRKBUILD}/gcc/fixinc.sh

d242 1
d244 10
a253 6
# XXX we need to override do-build to get the warnings from within make
do-build:
	@@(cd ${WRKBUILD}; \
	${MAKE_ENV} ${MAKE_PROGRAM} ${MAKE_FLAGS} -f Makefile ${ALL_TARGET} 2>warnings) || \
	(echo "*** Make bootstrap failed."; \
	echo "*** Look at ${WRKBUILD}/warnings for errors"; exit 1)
d258 7
a264 2
# Tests no longer need to be performed at the end of install, this
# was a bug in libstdc++/openbsd.ml
d268 1
a268 1
post-build:
d270 1
a270 1
	${MAKE_ENV} ${MAKE_PROGRAM} ${MAKE_FLAGS} -f Makefile check && \
d272 1
a272 1
	@@echo "Please send the tests results to the egcs project"
d277 1
d280 4
a283 18
PLIST=${WRKBUILD}/PLIST

M4FLAGS=-Uinclude -DDISTNAME=${DISTNAME}
.if defined(MAKE_GXX)
M4FLAGS+= -DGXX
.endif
.if defined(MAKE_FORTRAN)
M4FLAGS+= -DFORTRAN
.endif
.if defined(MAKE_CHILL)
M4FLAGS+= -DCHILL
.endif
.if defined(MAKE_OBJC)
M4FLAGS+= -DOBJC
.endif
.if defined(MAKE_JAVA)
M4FLAGS+= -DJAVA
.endif
a285 4
pre-install:
	${M4} ${M4FLAGS} -DARCH=`${GCC_NAME} -dumpmachine` \
	-DVERSION=`${GCC_NAME} -dumpversion` \
	<${FILESDIR}/PLIST.template >${PLIST}
a288 3
.if !defined(NO_SHARED_LIBS)
M4FLAGS+= -DDYNAMIC
.endif
@


1.36
log
@Kill
FAKE=Yes
HAS_CONFIGURE, GNU_CONFIGURE, USE_IMAKE, NO_INSTALL_MANPAGES, USE_AUTOCONF
and bump NEED_VERSION accordingly.
@
text
@d1 3
a3 1
# $OpenBSD: Makefile,v 1.35 2000/10/10 00:40:46 espie Exp $
d12 1
a12 1
NEED_VERSION=	 1.328
@


1.35
log
@Fix my address. Dust off details.
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.34 2000/09/12 16:15:44 brad Exp $
d174 1
a174 1
GNU_CONFIGURE=	yes
d195 1
a195 2
CONFIGURE_ARGS= --prefix=${PREFIX} \
--verbose --with-gnu-ld --with-gnu-as \
@


1.34
log
@use new extraction framework: remove USE_BZIP2 and set EXTRACT_SUFX
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.33 2000/04/09 17:36:48 espie Exp $
d14 1
a14 1
MAINTAINER=	espie@@openbsd.org
d16 1
a16 1
LICENSE_TYPE=		GPL
@


1.33
log
@explicit FAKE=No, so that we can turn FAKE on by default.
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.32 2000/03/24 23:28:13 espie Exp $
d10 1
a10 1
NEED_VERSION=	 1.230
d12 1
a60 1
USE_BZIP2=yes
@


1.32
log
@Introduce :: in *_DEPENDS as a place holder for a package spec
Bump NEED_VERSION.
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.31 2000/03/05 18:30:30 espie Exp $
d11 1
@


1.31
log
@PORTSDIR no longer needed in *DEPENDS.
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.30 2000/02/22 17:08:41 espie Exp $
d7 1
a7 1
BUILD_DEPENDS=	autoconf:devel/autoconf
d10 1
a10 1
NEED_VERSION=	1.223
d45 1
a45 1
BUILD_DEPENDS+=	runtest:devel/dejagnu
@


1.30
log
@MAKEFILE-> MAKE_FILE
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.29 2000/02/15 05:04:37 turan Exp $
a4 3
# it only works right with a recent bsd.port.mk.
NEED_VERSION=1.195

d7 1
a7 1
BUILD_DEPENDS=	autoconf:${PORTSDIR}/devel/autoconf
d10 3
a12 1
MAINTAINER=	Marc.Espie@@openbsd.org
d15 4
a18 4
PERMIT_PACKAGE_CDROM=	YES
PERMIT_PACKAGE_FTP=	YES
PERMIT_DISTFILES_CDROM=	YES
PERMIT_DISTFILES_FTP=	YES
d45 1
a45 1
BUILD_DEPENDS+=	runtest:${PORTSDIR}/devel/dejagnu
@


1.29
log
@espie will not shut up about this, DISTF -> DISTFILES, PKG -> PACKAGE
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.28 2000/02/12 08:02:22 turan Exp $
d229 1
a229 1
	${MAKE_ENV} ${MAKE_PROGRAM} ${MAKE_FLAGS} -f ${MAKEFILE} ${ALL_TARGET} 2>warnings) || \
d243 1
a243 1
	${MAKE_ENV} ${MAKE_PROGRAM} ${MAKE_FLAGS} -f ${MAKEFILE} check && \
@


1.28
log
@gpl licenses
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.27 2000/02/12 00:43:59 espie Exp $
d16 4
a19 4
PERMIT_PKG_CDROM=	YES
PERMIT_PKG_FTP=		YES
PERMIT_DISTF_CDROM=	YES
PERMIT_DISTF_FTP=	YES
@


1.27
log
@Change MAKE_FLAGS to remove the -f.

Actually reading the Makefiles proved that about one third of them was
confused about this already...
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.26 2000/02/11 01:10:04 espie Exp $
d14 6
@


1.26
log
@Kill a large set of deprecated variables.
Thoroughly unsubtle, most mkdir -p should probably be INSTALL* at
*install stage, and echo/ECHO_MSG is somewhat unsorted.

It's quite possible I missed a few automated changes...
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.25 2000/02/02 17:02:39 espie Exp $
d6 1
a6 1
NEED_VERSION=1.175
d223 1
a223 1
	${MAKE_ENV} ${MAKE_PROGRAM} ${MAKE_FLAGS} ${MAKEFILE} ${ALL_TARGET} 2>warnings) || \
d237 1
a237 1
	${MAKE_ENV} ${MAKE_PROGRAM} ${MAKE_FLAGS} ${MAKEFILE} check && \
@


1.25
log
@Kill most instances of PATCH_SITES
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.24 1999/09/17 11:42:05 espie Exp $
d130 1
a130 1
	(${ECHO} "Your gas has a bug, see ${FILESDIR}/gas-bug for details"; ${FALSE})
d156 3
a158 3
	find ${WRKSRC} -name \*.orig|xargs ${RM}
	${CP} -R ${FILESDIR}/config/* ${WRKSRC}
	${RM} -rf ${WRKSRC}/texinfo 
d225 1
a225 1
	echo "*** Look at ${WRKBUILD}/warnings for errors"; ${FALSE})
d239 2
a240 2
	@@${ECHO} "Please send the tests results to the egcs project"
	@@${ECHO} "By invoking make send-results"
@


1.24
log
@COMES_WITH...
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.23 1999/09/06 15:38:26 espie Exp $
d6 1
a6 1
NEED_VERSION=1.73
a124 2

PATCH_SITES= ${MASTER_SITES}
@


1.23
log
@Fix Makefile thinko.
Add newest patches from current version and OpenBSD src tree.
Synch various things, should compile now.
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.22 1999/08/22 17:28:42 espie Exp $
d14 1
@


1.22
log
@Update description, pkg name, and packing list.
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.21 1999/08/22 15:50:38 espie Exp $
d52 1
a52 1
DISTNAME= egcc-${VERSION}
@


1.21
log
@Move from egcs-stable and update to gcc-2.95.1
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.20 1999/04/02 22:49:19 espie Exp $
d52 1
a52 1
DISTNAME= gcc-${VERSION}
@


1.20
log
@*Now* we don't make tests.
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.19 1999/03/25 21:51:27 espie Exp $
d15 7
a21 3
# These are the only archs that don't exhibit problems right out of the
# box right now. see egcs-snapshot for credits
# If you use another platform, go to egcs-snapshot instead
d23 3
a25 1
ONLY_FOR_ARCHS = i386 sparc m68k alpha
a26 1
# user configuration section
d28 3
a30 1
# see files/tests for testing procedure
d34 1
d36 1
a36 3
# not in the 1.1.x releases
#MAKE_CHILL=yes
#MAKE_JAVA=yes
d43 1
a43 2
# XXX: I'm not sure partial archives work
#ONE_ARCHIVE=yes
d46 1
a46 1
VERSION= 1.1.2
d51 3
a53 2
MASTER_SITE_SUBDIR=egcs-1.1.2
DISTNAME= egcs-${VERSION}
d58 1
a58 1
DISTFILES= egcs-${VERSION}${EXTRACT_SUFX}
d61 1
a61 1
DISTFILES=	egcs-core-${VERSION}${EXTRACT_SUFX}
d63 1
a63 1
DISTFILES+=     egcs-g++-${VERSION}${EXTRACT_SUFX}
d65 5
a69 2
.if defined(MAKE_TESTS)
DISTFILES+=egcs-tests-${VERSION}${EXTRACT_SUFX}
d71 2
a72 2
.if defined(MAKE_FORTRAN)
DISTFILES+=egcs-g77-${VERSION}${EXTRACT_SUFX}
d75 4
a78 1
DISTFILES+=egcs-objc-${VERSION}${EXTRACT_SUFX}
d127 7
d156 2
d160 4
a163 9
.if !defined(MAKE_GXX)
	-${RM} -rf ${WRKSRC}/gcc/cp ${WRKSRC}/libstdc++ ${WRKSRC}/libio
.endif
.if !defined(MAKE_FORTRAN)
	-${RM} -rf ${WRKSRC}/gcc/f ${WRKSRC}/libf2c
.endif
.if !defined(MAKE_OBJC)
	-${RM} -rf ${WRKSRC}/gcc/objc
.endif
d171 19
a189 1
CONFIGURE_ENV=CFLAGS=-O2
d192 7
a198 1
--program-transform-name=s,^,e,
d204 1
a204 8

SEPARATE_BUILD=simple

# rebuild configure files after patching, then move source around !!!
# XXX: don't try to autoconf the main configure file, it's not autoconf.
pre-configure:
	cd ${WRKSRC}/gcc && PATH=${PORTPATH} autoreconf
	cd ${WRKSRC}/libiberty && PATH=${PORTPATH} autoreconf
d212 5
d231 11
a241 2
# Tests should be performed at the end of install, since they depend upon
# having the correct flavor of libstdc++.so.
d243 2
a244 4
.if defined(MAKE_TESTS)
post-install:
	@@(cd ${WRKBUILD}; \
	${MAKE_ENV} ${MAKE_PROGRAM} ${MAKE_FLAGS} ${MAKEFILE} check)
d266 1
d268 2
a269 2
	${M4} ${M4FLAGS} -DARCH=`${WRKSRC}/config.guess` \
	-DVERSION=`${SED} -e 's/.*\"\(egcs-[0-9.]*\) .*/\1/' <${WRKSRC}/gcc/version.c` \
@


1.19
log
@move tests to the post-install stage, to grab the right flavor of
libstdc++.

Adjust PLIST for the right libstdc++ version.
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.18 1999/03/21 07:51:08 espie Exp $
d24 1
a24 1
MAKE_TESTS=no
@


1.18
log
@forgot that one...
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.17 1999/03/09 20:27:51 espie Exp $
d162 3
a182 4
.if defined(MAKE_TESTS)
ALL_TARGET+=check
.endif

d187 2
a188 2
	(echo "Make bootstrap failed."; \
	echo "Don't forget to look at ${WRKBUILD}/warnings"; ${FALSE})
d191 10
a200 1
# Install section
@


1.17
log
@Remove conflicts... somedays I hate cvs. Thanks marc@@ !
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.16 1999/03/09 17:22:51 espie Exp $
d38 1
a38 1
ONE_ARCHIVE=yes
d41 1
a41 2
VERSION= 1.1.2-pre2
PREPATCH= 1.1.2-pre3
d43 1
a43 1
DIRECTORY=egcs/%SUBDIR%/
d46 1
a46 5
MASTER_SITE_SUBDIR=snapshots/egcs-1.1.2-prerelease
PATCH_SITE_SUBDIR=snapshots/egcs-1.1.2-prerelease
.if defined(PREPATCH)
DISTNAME= egcs-${PREPATCH}
.else
a47 1
.endif
a50 2
PATCH_DIST_STRIP=-p1

a114 29
# prepare for new release
.if defined(PREPATCH)
.if defined(ONE_ARCHIVE)
PATCHFILES+= egcs-${VERSION}-${PREPATCH}.diff.gz
.else

PATCHFILES+= egcs-core-${VERSION}-${PREPATCH}.diff.gz
.if defined(MAKE_GXX)
PATCHFILES+= egcs-g++-${VERSION}-${PREPATCH}.diff.gz
.endif
.if defined(MAKE_TESTS)
PATCHFILES+= egcs-tests-${VERSION}-${PREPATCH}.diff.gz
.endif
.if defined(MAKE_FORTRAN)
PATCHFILES+= egcs-g77-${VERSION}-${PREPATCH}.diff.gz
.endif
.if defined(MAKE_OBJC)
PATCHFILES+= egcs-objc-${VERSION}-${PREPATCH}.diff.gz
.endif
.endif

.endif

# synch the date
.if defined(PREPATCH)
post-extract:
	${MV} ${WRKDIR}/egcs-${VERSION} ${WRKSRC}
.endif

d162 1
a162 1
SEPARATE_BUILD=yes
@


1.16
log
@Missed those
@
text
@d1 1
a1 11
<<<<<<< Makefile
# $OpenBSD: Makefile,v 1.11 1999/02/21 04:26:13 marc Exp $
=======
# OpenBSD makefile for:	egcs
# Version required:	release 1.1.1, preparing for 1.1.2
# Date created:		25 sep 98
# Whom:			Marc Espie
#
# $OpenBSD: Makefile,v 1.15 1999/03/09 17:12:05 espie Exp $
#
>>>>>>> 1.12
a14 3
<<<<<<< Makefile
NEED_VERSION=	1.67
=======
a17 1
>>>>>>> 1.12
@


1.15
log
@Update to 1.1.2-prerelease 3.
Remove all files that ARE in egcs-1.1.2-prerelease 3
@
text
@d1 3
d9 1
a9 1
# $OpenBSD: Makefile,v 1.14 1999/03/02 04:41:04 marc Exp $
d11 1
d25 3
d31 1
@


1.14
log
@fix earlier bogus changes to Makefile where a value that
was defined in bsd.port.mk was checked before bsd.port.mk was included;
this should make ports with optional shared libs build on the alpha,
again.  However, chages require the latest bsd.port.mk
@
text
@d6 1
a6 1
# $OpenBSD: Makefile,v 1.13 1999/02/26 17:48:37 espie Exp $
d48 1
a48 1
#PREPATCH= 1.1.2-pre1
d205 1
a205 1
WRKBUILD=${WRKDIR}/build-${MACHINE_ARCH}
@


1.13
log
@Temporary: prerelease does live in the snapshot directory
@
text
@d6 1
a6 1
# $OpenBSD: Makefile,v 1.12 1999/02/26 16:18:43 espie Exp $
d12 1
a12 1
NEED_VERSION=1.64
d203 1
a203 3
.if !defined(NO_SHARED_LIBS)
CONFIGURE_ARGS+=--enable-shared
.endif
a254 3
.if !defined(NO_SHARED_LIBS)
M4FLAGS+= -DDYNAMIC
.endif
d262 4
@


1.12
log
@Prepare for 1.1.2 release
@
text
@d6 1
a6 1
# $OpenBSD: Makefile,v 1.9 1999/01/09 16:53:22 espie Exp $
d53 1
a53 1
MASTER_SITE_SUBDIR=releases/egcs-${VERSION}
@


1.11
log
@needs version 1.64 (or later) of bsd.port.mk
to build/install correctly; PLIST.noshared
@
text
@d2 1
a2 1
# Version required:	release 1.1b, plus pre-rel 1.1.1 patch 1/2
d6 1
a6 1
# $OpenBSD: Makefile,v 1.10 1999/02/18 02:37:33 marc Exp $
d11 7
d21 3
a23 1
NEED_VERSION=	1.64
d25 1
a25 3
# this will improve over time as more and more architectures are handled
# with some help from Jason L. Wright for sparc...
ONLY_FOR_ARCHS = i386 sparc m68k
d34 1
a34 2

# not yet in 1.1.1
d42 2
a43 1
# if you want/need to use the mammoth archive
d46 15
a60 3
VERSION=1.1.1
DISTNAME=	egcs-${VERSION}
DIRECTORY=egcs/releases/%SUBDIR%/
d62 2
a63 1
MASTER_SITE_SUBDIR=${DISTNAME}
a75 1
# to be added...
a83 2
MAKE_ENV+=LANGUAGES="c proto gcov objc"

d128 29
a156 1
PATCH_DIST_STRIP=-p1
a195 6
# we could remove the dependency on autoconf by patching configure, 
# but this is not reasonable...

USE_AUTOCONF=yes
AUTOCONF_DIR=${WRKDIR}/source/gcc

d198 1
a198 3
CONFIGURE_SCRIPT=../source/configure

#CONFIGURE_ENV=CFLAGS=-O2
d207 3
a209 1
# move source around after rebuilding configure file.
d212 2
a213 2
	-${MV} ${WRKSRC} ${WRKDIR}/source
	${MKDIR} ${WRKSRC}
d218 1
a218 1
# reported to the egcs folks
d221 2
d224 1
d231 4
a234 2
	@@(cd ${WRKSRC}; ${MAKE_ENV} ${MAKE_PROGRAM} ${MAKE_FLAGS} ${MAKEFILE} ${ALL_TARGET} 2>warnings)

d239 1
a239 1
PLIST=${WRKDIR}/PLIST
d257 1
a257 1
.if (${MACHINE_ARCH}) != "alpha")
d262 2
a263 2
	${M4} ${M4FLAGS} -DARCH=`${WRKDIR}/source/config.guess` \
	-DVERSION=`${SED} -e 's/.*\"\(egcs-[0-9.]*\) .*/\1/' <${WRKDIR}/source/gcc/version.c` \
@


1.10
log
@use NO_SHARED_LIBS instead of test for alpha;
use PLIST.noshared instead of PLIST.alpha
@
text
@d6 1
a6 1
# $OpenBSD: Makefile,v 1.9 1999/01/09 16:53:22 espie Exp $
d13 2
@


1.9
log
@There apparently is a bug in gas that makes it necessary to bootstrap
with standard CFLAGS (-g -O2).
@
text
@d6 1
a6 1
# $OpenBSD: Makefile,v 1.8 1998/12/23 02:45:07 espie Exp $
d164 1
a164 1
.if (${MACHINE_ARCH} != "alpha")
@


1.8
log
@*Use* the AUTOCONF macros I added to bsd.port.mk.
Thanks jason@@ for reminding me...
@
text
@d6 1
a6 1
# $OpenBSD: Makefile,v 1.7 1998/12/19 00:57:57 espie Exp $
d9 1
a9 2
# This is a configuration file for egcs, stable release
# right now, we only configure i386.
d159 1
a159 1
CONFIGURE_ENV=CFLAGS=-O2
@


1.7
log
@Mirrors & finicking
@
text
@d6 1
a6 1
# $OpenBSD: Makefile,v 1.6 1998/12/10 12:24:21 d Exp $
a11 4
# we could remove this dependency by patching configure, but this is not
# reasonable...
BUILD_DEPENDS=	autoconf:${PORTSDIR}/devel/autoconf

d150 6
d169 1
a169 1
# rebuild configure file after patching, then move source around !!!
a171 1
	cd ${WRKSRC}/gcc && autoconf
@


1.6
log
@australians have mirrors too
@
text
@d6 1
a6 1
# $OpenBSD: Makefile,v 1.5 1998/12/04 00:24:31 espie Exp $
d26 1
a26 1
MAKE_TESTS=yes
d40 1
a40 1
#ONE_ARCHIVE=yes
d48 4
d66 1
d68 1
a80 1
MASTER_SITES+= ftp://sunsite.mff.cuni.cz/pub/GNU/${DIRECTORY}
a86 2
MASTER_SITES+= ftp://sunsite.icm.edu.pl/pub/programming/${DIRECTORY}
MASTER_SITES+= ftp://ftp.task.gda.pl/mirror/egcs.cygnus.com/pub/${DIRECTORY}
a88 1
MASTER_SITES+= ftp://ftp.lca.uevora.pt/pub/${DIRECTORY}
a89 1
MASTER_SITES+= ftp://moshpit.cygnus.com/pub/${DIRECTORY}
a95 1
MASTER_SITES+= ftp://cair-archive.kaist.ac.kr/pub/gnu/${DIRECTORY}
d97 1
a97 1
MASTER_SITES+= ftp://ftp.crc.ca/pub/packages/${DIRECTORY}
d99 11
a110 2
MASTER_SITES+= ftp://ftp.goof.com/pub/pcg/${DIRECTORY}
MASTER_SITES+= ftp://ftp.u-aizu.ac.jp/pub/lang/C/pcg/${DIRECTORY}
a111 1
MASTER_SITES+= ftp://ftp.maisel.int-evry.fr/pub/linux/pentium/${DIRECTORY}
d113 1
a113 1
PATCH_SITE= ${MASTER_SITES}
a114 3
#PATCHFILES= egcs-1.1b-1.1.1-prerelease.diff.gz
#PATCHFILES+= egcs-1.1.1-prerelease-1.1.1-prerelease-2.diff.gz
#PATCHFILES+= egcs-1.1.1-prerelease-2-1.1.1-prerelease-3.diff.gz
@


1.5
log
@Update to release 1.1.1
@
text
@d6 1
a6 1
# $OpenBSD: Makefile,v 1.4 1998/10/13 14:52:34 espie Exp $
d66 1
@


1.4
log
@Clean-up.
@
text
@d2 1
a2 1
# Version required:	release 1.1b
d6 1
a6 1
# $OpenBSD: Makefile,v 1.3 1998/10/11 14:08:23 espie Exp $
d10 1
a10 2
# right now, we only configure i386, C and C++.
# g77 and objc didn't make it for 2.4.
d12 12
a23 2
DISTNAME=	egcs-1.1b
DIRECTORY=egcs/releases/egcs-1.1b/
a24 2
DISTFILES=	egcs-core-1.1b${EXTRACT_SUFX}
DISTFILES+=     egcs-g++-1.1b${EXTRACT_SUFX}
d26 29
a54 1
#DISTFILES+=egcs-tests-1.1b${EXTRACT_SUFX}
d56 7
a62 2
#DISTFILES+=egcs-g77-1.1b${EXTRACT_SUFX}
#DISTFILES+=egcs-objc-1.1b${EXTRACT_SUFX}
a63 1
CATEGORIES=	lang 
d104 25
a128 1
MAINTAINER=	Marc.Espie@@openbsd.org
d130 13
a142 1
BUILD_DEPENDS=	autoconf:${PORTSDIR}/devel/autoconf
d144 3
a146 2
# will improve over time as more and more architectures are handled
ONLY_FOR_ARCHS = i386 amiga atari hp300 mac68k mvme68k
a148 5
USE_GMAKE= yes

# don't make bootstrap if you're impatient/you know what you're doing
# use bootstrap-lean if you don't have room.
ALL_TARGET=bootstrap
d156 1
d161 1
a161 6
# get openbsd configuration files where they should be
post-patch:
	cp -R ${FILESDIR}/config/* ${WRKSRC}
	rm -rf ${WRKSRC}/texinfo

# rebuild configure file after patching, then move file around !!!
a162 1
# + kludge to build in a separate directory.
d165 13
a177 2
	mv ${WRKSRC} ${WRKDIR}/source
	mkdir ${WRKSRC}
d179 28
a206 7
# use the same trick that's used for emacs
pre-install:
.if (${MACHINE_ARCH} != "alpha")
	${RM} -f ${PKGDIR}/PLIST
	${SED} -e "s/ARCH/`${WRKDIR}/source/config.guess`/" ${FILESDIR}/PLIST.template >${PKGDIR}/PLIST
.else
	cp ${FILESDIR}/PLIST.alpha ${PKGDIR}/PLIST
d208 1
a208 1
	
d210 4
@


1.3
log
@Tentative configurations for some more architectures,
Fix buglet: PLIST generated from template, shouldn't be in repo.

Add large list of mirrors to Makefile, change config slightly.
Man/info pages installed under nicer names.
@
text
@d6 1
a6 1
# $OpenBSD: Makefile,v 1.2 1998/10/02 18:51:24 espie Exp $
d83 1
a83 1
--verbose --with-gnu-ld ---with-gnu-as \
@


1.2
log
@Some files moved around to accommodate libstdc++ config.
i386 setup checked, initial m68k setup (not yet tested).
@
text
@d6 1
a6 1
# $OpenBSD: Makefile,v 1.1.1.1 1998/09/26 08:53:03 espie Exp $
d11 1
d20 3
d27 37
d83 1
a83 1
--verbose \
@


1.1
log
@Initial revision
@
text
@d2 1
a2 1
# Version required:	egcs release 1.1b
d6 1
a6 1
# $OpenBSD$
d17 3
d26 1
a26 2
# Should be CONFIGURE_DEPENDS, if we had it
DEPENDS=  ${PORTSDIR}/devel/autoconf:${PORTSDIR}/devel/autoconf
d28 2
a29 1
ONLY_FOR_ARCHS= i386
a32 1
MAKE_ENV="CFLAGS=-O2"
d38 1
a38 2
# should remove --enable-shared for alpha
# use --enable-haifa- on some archs (alpha, sparc, pa-risc)
d40 7
a46 2
CONFIGURE_ARGS=--verbose --enable-shared --program-prefix=e
INSTALL_TARGET=	install
d49 2
a50 2
post-extract:
	cp -R files/* ${WRKSRC}
a52 5
# we should change libstdc++ name so that we will get the right one
post-patch:
	
CONFIGURE_SCRIPT=../source/configure

d57 1
a57 1
	cd ${WRKSRC}/gcc && /usr/local/bin/autoconf
d61 10
@


1.1.1.1
log
@egcs ports, stable release flavor
@
text
@@
