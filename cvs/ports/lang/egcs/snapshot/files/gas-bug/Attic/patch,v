head	1.2;
access;
symbols
	OPENBSD_2_6:1.1.0.2
	OPENBSD_2_6_BASE:1.1;
locks; strict;
comment	@# @;


1.2
date	99.11.24.00.15.05;	author espie;	state dead;
branches;
next	1.1;

1.1
date	99.04.28.15.40.26;	author espie;	state Exp;
branches;
next	;


desc
@@


1.2
log
@Argh. I was SURE I had repaired that port WEEKS ago.
So, here goes.

- retrieve a recent snapshot of egcs, to justify the port's existence,
- remove outdated fixes, now that we're synching with 2.6,
- update patches to deal with the current snapshot,
- get a description that matches better what's going on,
- add fixed include files to match the new varargs handling (complexity
is now within gcc, instead of arch-dependent include files).

Builds on i386, at least.
@
text
@--- /usr/src/gnu/usr.bin/gas/config/tc-i386.c.orig	Sat Jan 23 01:18:15 1999
+++ /usr/src/gnu/usr.bin/gas/config/tc-i386.c	Fri Apr 23 03:53:02 1999
@@@@ -35,11 +35,8 @@@@
 #include "obstack.h"
 #include "opcode/i386.h"
 
-#ifdef KLUDGE
+/* real name for the assembler, translate from C _GLOBAL_OFFSET_TABLE_ */
 #define GLOBAL_OFFSET_TABLE_NAME "__GLOBAL_OFFSET_TABLE_"
-#else
-#define GLOBAL_OFFSET_TABLE_NAME "_GLOBAL_OFFSET_TABLE_"
-#endif
 
 /* one more argument for fix_new */
 #ifdef PIC
@@@@ -2259,16 +2256,18 @@@@
 char *name;
 {
 #ifdef PIC
-#ifdef KLUDGE
-	/* HACK:
-	 * Sun's ld expects __GLOBAL_OFFSET_TABLE_,
-	 * gcc generates _GLOBAL_OFFSET_TABLE_
-	 * should probably fix ld - new SVR4 style??
+	/* gcc bug work-around:
+	 * old versions of gcc don't heed YES_UNDERSCORES,
+	 * and always generate _GLOBAL_OFFSET_TABLE_.
+	 * On OpenBSD, this is a bug, as this collides with
+	 * the user namespace.
+	 *
+	 * This code will no longer be needed once the switch to a recent 
+	 * egcs is complete.
 	 */
 	if (*name == '_' && *(name+1) == 'G' &&
 				strcmp(name, "_GLOBAL_OFFSET_TABLE_") == 0)
-		return symbol_find("__GLOBAL_OFFSET_TABLE_");
-#endif
+		return symbol_find(GLOBAL_OFFSET_TABLE_NAME);
 #endif
 	return 0;
 }
@


1.1
log
@Update to 19990418 snapshot

A few odds and end fixed with PLIST.template

Framework to detect the gas i386 problem

Removed bogus patch
@
text
@@

