head	1.2;
access;
symbols
	OPENBSD_3_1:1.1.0.12
	OPENBSD_3_1_BASE:1.1
	OPENBSD_3_0:1.1.0.10
	OPENBSD_3_0_BASE:1.1
	OPENBSD_2_9_TRACKING_SWITCH:1.1
	OPENBSD_2_9:1.1.0.8
	OPENBSD_2_9_BASE:1.1
	OPENBSD_2_8:1.1.0.6
	OPENBSD_2_8_BASE:1.1
	OPENBSD_2_7:1.1.0.4
	OPENBSD_2_7_BASE:1.1
	OPENBSD_2_6:1.1.0.2
	OPENBSD_2_6_BASE:1.1;
locks; strict;
comment	@# @;


1.2
date	2002.06.05.23.58.49;	author espie;	state dead;
branches;
next	1.1;

1.1
date	99.05.18.17.07.17;	author espie;	state Exp;
branches;
next	;


desc
@@


1.2
log
@Resurrect snapshot port, easy to do,since it's the gcc 3.1 branch.
@
text
@With this small patch, ldd does shut up (somewhat) when faced with
dynamic libraries.

The reason is that, when you build a dynamic library through gcc standard
interface, collect2 will try to invoke ldd on dynamic libraries
(which ldd should handle, but doesn't right now), and will abort if ldd
returns 1.

So we warn, but let ldd return 0 in such a case.

Index: ldd.c
===================================================================
RCS file: /cvs/src/gnu/usr.bin/ld/ldd/ldd.c,v
retrieving revision 1.4
diff -u -r1.4 ldd.c
--- ldd.c	1998/03/26 19:46:55	1.4
+++ ldd.c	1999/05/18 15:28:16
@@@@ -105,8 +105,20 @@@@
 			argv++;
 			continue;
 		}
-		if (read(fd, &hdr, sizeof hdr) != sizeof hdr
-		    || (N_GETFLAG(hdr) & EX_DPMASK) != EX_DYNAMIC
+		if (read(fd, &hdr, sizeof hdr) != sizeof hdr) {
+			warnx("%s: not a dynamic executable", *argv);
+			(void)close(fd);
+			rval |= 1;
+			argv++;
+			continue;
+		}
+		if ((N_GETFLAG(hdr) & EX_DPMASK) == (EX_DYNAMIC | EX_PIC)) {
+			warnx("%s: no support for dynamic libraries", *argv);
+			(void)close(fd);
+			argv++;
+			continue;
+		}
+		if ((N_GETFLAG(hdr) & EX_DPMASK) != EX_DYNAMIC
 #if 1 /* Compatibility */
 		    || hdr.a_entry < N_PAGSIZ(hdr)
 #endif
@


1.1
log
@19990517 compiles and tests okay.

The recent changes to collect2 (needed by java) mean ldd must be updated,
the Makefile now checks for that problem.
@
text
@@

