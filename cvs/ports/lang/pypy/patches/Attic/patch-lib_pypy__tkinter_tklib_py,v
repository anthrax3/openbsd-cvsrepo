head	1.5;
access;
symbols
	OPENBSD_5_8:1.4.0.4
	OPENBSD_5_8_BASE:1.4
	OPENBSD_5_7:1.3.0.2
	OPENBSD_5_7_BASE:1.3
	OPENBSD_5_6:1.2.0.4
	OPENBSD_5_6_BASE:1.2
	OPENBSD_5_5:1.2.0.2
	OPENBSD_5_5_BASE:1.2;
locks; strict;
comment	@# @;


1.5
date	2015.08.27.14.21.32;	author edd;	state dead;
branches;
next	1.4;
commitid	oxndeSulbO73DyBb;

1.4
date	2015.04.05.11.15.08;	author edd;	state Exp;
branches;
next	1.3;
commitid	ZyyeSXYFAv4ixIAl;

1.3
date	2014.12.13.13.53.18;	author edd;	state Exp;
branches;
next	1.2;
commitid	bAdnz0ZeFi4qGodj;

1.2
date	2013.12.04.21.56.21;	author edd;	state Exp;
branches;
next	1.1;

1.1
date	2013.09.19.08.39.31;	author sthen;	state Exp;
branches;
next	;


desc
@@


1.5
log
@Update PyPy to 2.6.0.

Thanks sthen@@ for hosting the bootstrap.

OK jca@@
@
text
@$OpenBSD: patch-lib_pypy__tkinter_tklib_py,v 1.4 2015/04/05 11:15:08 edd Exp $
--- lib_pypy/_tkinter/tklib.py.orig	Mon Mar 23 16:17:54 2015
+++ lib_pypy/_tkinter/tklib.py	Thu Apr  2 19:25:50 2015
@@@@ -119,9 +119,9 @@@@ void Tcl_FindExecutable(char *argv0);
 # XXX find a better way to detect paths
 # XXX pick up CPPFLAGS and LDFLAGS and add to these paths?
 if sys.platform.startswith("openbsd"):
-    incdirs = ['/usr/local/include/tcl8.5', '/usr/local/include/tk8.5', '/usr/X11R6/include']
-    linklibs = ['tk85', 'tcl85']
-    libdirs = ['/usr/local/lib', '/usr/X11R6/lib']
+    incdirs = ['${MODTCL_INCDIR}', '${MODTK_INCDIR}', '${X11BASE}/include']
+    linklibs = ['${MODTK_LIB}', '${MODTCL_LIB}']
+    libdirs = ['${LOCALBASE}/lib', '${X11BASE}/lib']
 elif sys.platform.startswith("freebsd"):
     incdirs = ['/usr/local/include/tcl8.6', '/usr/local/include/tk8.6', '/usr/local/include/X11', '/usr/local/include']
     linklibs = ['tk86', 'tcl86']
@


1.4
log
@Update lang/pypy to 2.5.1.

OK sthen@@, thanks.
@
text
@d1 1
a1 1
$OpenBSD: patch-lib_pypy__tkinter_tklib_py,v 1.3 2014/12/13 13:53:18 edd Exp $
@


1.3
log
@Update to PyPy-2.4.0.

OK benoit@@
@
text
@d1 4
a4 4
$OpenBSD: patch-lib_pypy__tkinter_tklib_py,v 1.2 2013/12/04 21:56:21 edd Exp $
--- lib_pypy/_tkinter/tklib.py.orig	Mon Sep 22 18:34:11 2014
+++ lib_pypy/_tkinter/tklib.py	Fri Oct 10 13:16:29 2014
@@@@ -118,9 +118,9 @@@@ void Tcl_FindExecutable(char *argv0);
@


1.2
log
@Update to PyPy-2.2.1 and remove dependency upon libcompat.a and headers.

Tested by naddy@@.

OK naddy@@ and juanfra@@.
@
text
@d1 4
a4 4
$OpenBSD$
--- lib_pypy/_tkinter/tklib.py.orig	Fri Nov 15 19:44:50 2013
+++ lib_pypy/_tkinter/tklib.py	Mon Dec  2 11:23:02 2013
@@@@ -109,9 +109,9 @@@@ int Tk_GetNumMainWindows();
@


1.1
log
@update to pypy 2.1, testing/help edd@@ and Laurie Tratt (maintainer)
@
text
@d2 9
a10 31

Patch in OpenBSD paths. Applied upstream, albeit without ports vars:
https://bugs.pypy.org/issue1531

Also allow tkinter to use a single threaded TCL.
From upstream a2cfb94ccff5

--- lib_pypy/_tkinter/tklib.py.orig	Thu Aug  1 10:57:52 2013
+++ lib_pypy/_tkinter/tklib.py	Sun Sep 15 20:22:30 2013
@@@@ -1,6 +1,7 @@@@
 # C bindings with libtcl and libtk.
 
 from cffi import FFI
+import sys
 
 tkffi = FFI()
 
@@@@ -18,6 +19,8 @@@@ char *get_tcl_version();
 #define TCL_EVAL_DIRECT ...
 #define TCL_EVAL_GLOBAL ...
 
+#define TCL_DONT_WAIT ...
+
 typedef unsigned short Tcl_UniChar;
 typedef ... Tcl_Interp;
 typedef ...* Tcl_ThreadId;
@@@@ -102,6 +105,15 @@@@ int Tcl_DoOneEvent(int flags);
 int Tk_GetNumMainWindows();
 """)
 
+if sys.platform.startswith("openbsd"):
d12 1
a12 1
+    linklibs = ['tk85', 'tcl85']
d14 3
a16 18
+else:
+    incdirs=['/usr/include/tcl'],
+    linklibs=['tcl', 'tk'],
+    libdirs = []
+
 tklib = tkffi.verify("""
 #include <tcl.h>
 #include <tk.h>
@@@@ -109,6 +121,7 @@@@ tklib = tkffi.verify("""
 char *get_tk_version() { return TK_VERSION; }
 char *get_tcl_version() { return TCL_VERSION; }
 """,
-include_dirs=['/usr/include/tcl'],
-libraries=['tcl', 'tk'],
+include_dirs=incdirs,
+libraries=linklibs,
+library_dirs = libdirs
 )
@

