head	1.6;
access;
symbols
	OPENBSD_5_0:1.5.0.12
	OPENBSD_5_0_BASE:1.5
	OPENBSD_4_9:1.5.0.10
	OPENBSD_4_9_BASE:1.5
	OPENBSD_4_8:1.5.0.8
	OPENBSD_4_8_BASE:1.5
	OPENBSD_4_7:1.5.0.6
	OPENBSD_4_7_BASE:1.5
	OPENBSD_4_6:1.5.0.4
	OPENBSD_4_6_BASE:1.5
	OPENBSD_4_5:1.5.0.2
	OPENBSD_4_5_BASE:1.5
	OPENBSD_4_4:1.4.0.8
	OPENBSD_4_4_BASE:1.4
	OPENBSD_4_3:1.4.0.6
	OPENBSD_4_3_BASE:1.4
	OPENBSD_4_2:1.4.0.4
	OPENBSD_4_2_BASE:1.4
	OPENBSD_4_1:1.4.0.2
	OPENBSD_4_1_BASE:1.4
	OPENBSD_4_0:1.3.0.2
	OPENBSD_4_0_BASE:1.3
	OPENBSD_3_9:1.2.0.2
	OPENBSD_3_9_BASE:1.2
	OPENBSD_3_8:1.1.1.1.0.2
	OPENBSD_3_8_BASE:1.1.1.1
	alek_20050607:1.1.1.1
	alek:1.1.1;
locks; strict;
comment	@# @;


1.6
date	2011.12.20.13.08.07;	author fgsch;	state dead;
branches;
next	1.5;

1.5
date	2009.01.01.21.03.27;	author djm;	state Exp;
branches;
next	1.4;

1.4
date	2006.11.01.20.38.37;	author alek;	state Exp;
branches;
next	1.3;

1.3
date	2006.04.18.17.29.35;	author alek;	state Exp;
branches;
next	1.2;

1.2
date	2005.10.12.02.41.41;	author fgsch;	state Exp;
branches;
next	1.1;

1.1
date	2005.06.07.01.12.58;	author alek;	state Exp;
branches
	1.1.1.1;
next	;

1.1.1.1
date	2005.06.07.01.12.58;	author alek;	state Exp;
branches;
next	;


desc
@@


1.6
log
@RIP python2.4.
jasper@@ ok
@
text
@$OpenBSD: patch-Modules_socketmodule_c,v 1.5 2009/01/01 21:03:27 djm Exp $
--- Modules/socketmodule.c.orig	Wed Oct 11 02:20:41 2006
+++ Modules/socketmodule.c	Fri Dec 26 12:27:16 2008
@@@@ -72,9 +72,6 @@@@ Local naming conventions:
 
 #include "Python.h"
 
-#undef MAX
-#define MAX(x, y) ((x) < (y) ? (y) : (x))
-
 /* Socket object documentation */
 PyDoc_STRVAR(sock_doc,
 "socket([family[, type[, proto]]]) -> socket object\n\
@@@@ -1807,10 +1804,15 @@@@ internal_connect(PySocketSockObject *s, struct sockadd
 
 	if (s->sock_timeout > 0.0) {
 		if (res < 0 && errno == EINPROGRESS && IS_SELECTABLE(s)) {
+			socklen_t res_size = sizeof res;
+			int save_errno;
+
 			timeout = internal_select(s, 1);
-			res = connect(s->sock_fd, addr, addrlen);
-			if (res < 0 && errno == EISCONN)
-				res = 0;
+			save_errno = errno;
+			(void)getsockopt(s->sock_fd, SOL_SOCKET, SO_ERROR,
+			    &res, &res_size);
+			errno = save_errno;
+			res = res ? -1 : 0;
 		}
 	}
 
@@@@ -3307,7 +3309,7 @@@@ socket_inet_aton(PyObject *self, PyObject *args)
 
 #if !defined(HAVE_INET_ATON) || defined(USE_INET_ATON_WEAKLINK)
 	/* Have to use inet_addr() instead */
-	unsigned long packed_addr;
+	int packed_addr;
 #endif
 	char *ip_addr;
 
@


1.5
log
@Updates and garbage collect all three Python ports:

    2.4.4 => 2.4.8
    2.5.2 => 2.5.4
    2.6 => 2.6.1

Python 2.4 and 2.5 lose their build knobs to match 2.6.

Removes no longer needed Python 2.5 security patches backported
from the release25-maint SVN branch.

Remove the -bz2 subpackage from all three versions. It is silly
to make a subpackage to avoid depending on something tiny and
compatibly licensed.

Python 2.4 and 2.5 lose their -expat subpackages; expat has been
in base for some time.

Python 2.5 loses its sqlite subpackge. Again, sqlite is tiny,
compatibly licensed and is depended upon by more and more
applications. This brings it into line with the 2.6 version.

Rework all three version's handling of setup.py. Rather than regex
replacing LOCALBASE and X11BASE into setup.py post-configure, these
are passed in though environment variables. Will save hours of
frustrated cursing familiar to anyone who has accidently used the
update-patches target after configure and had to go back and redo
all the substitutions.

Rework the patching of setup.py for 2.4 and 2.5 to be more like
what we do for 2.6. I.e. keep the diff minimal and avoid deleting
huge blocks of code, so the diff has a chance of applying without
massive hand-editing each patch release.

Fix .py paths in installed .pyc files (patch from eric@@)

feedback from several, particularly eric@@, ajacoutot@@ and Ingo
Schwarze; "get it in" ajacoutot@@
@
text
@d1 1
a1 1
$OpenBSD: patch-Modules_socketmodule_c,v 1.4 2006/11/01 20:38:37 alek Exp $
@


1.4
log
@Update to 2.4.4; add bz2 subpacakge; switch to setup.py; redo PLISTs
@
text
@d1 3
a3 3
$OpenBSD: patch-Modules_socketmodule_c,v 1.3 2006/04/18 17:29:35 alek Exp $
--- Modules/socketmodule.c.orig	Tue Oct 10 18:20:41 2006
+++ Modules/socketmodule.c	Sat Oct 21 15:06:39 2006
d14 1
a14 1
@@@@ -1807,10 +1804,15 @@@@ internal_connect(PySocketSockObject *s, 
d33 1
a33 1
@@@@ -3307,7 +3309,7 @@@@ socket_inet_aton(PyObject *self, PyObjec
@


1.3
log
@Update to 2.4.3
@
text
@d1 4
a4 4
$OpenBSD: patch-Modules_socketmodule_c,v 1.2 2005/10/12 02:41:41 fgsch Exp $
--- Modules/socketmodule.c.orig	Mon Feb 20 10:42:37 2006
+++ Modules/socketmodule.c	Mon Apr 17 20:33:22 2006
@@@@ -63,9 +63,6 @@@@ Local naming conventions:
d14 1
a14 1
@@@@ -1757,10 +1754,15 @@@@ internal_connect(PySocketSockObject *s, 
d33 3
a35 3
@@@@ -3252,7 +3254,7 @@@@ socket_inet_aton(PyObject *self, PyObjec
 	struct in_addr buf;
 #else
@


1.2
log
@fix bug #1019808 and bump package. maintainer@@ ok.
@
text
@d1 3
a3 3
$OpenBSD: patch-Modules_socketmodule_c,v 1.1.1.1 2005/06/07 01:12:58 alek Exp $
--- Modules/socketmodule.c.orig	Sun Nov  7 11:24:25 2004
+++ Modules/socketmodule.c	Mon Oct  3 13:54:53 2005
d14 1
a14 1
@@@@ -1736,10 +1733,15 @@@@ internal_connect(PySocketSockObject *s, 
d17 1
a17 1
 		if (res < 0 && errno == EINPROGRESS) {
d33 1
a33 1
@@@@ -3220,7 +3222,7 @@@@ socket_inet_aton(PyObject *self, PyObjec
@


1.1
log
@Initial revision
@
text
@d1 3
a3 3
$OpenBSD: patch-Modules_socketmodule_c,v 1.2 2004/08/11 08:11:50 xsa Exp $
--- Modules/socketmodule.c.orig	Sun Nov  7 15:24:25 2004
+++ Modules/socketmodule.c	Thu Dec 30 22:46:12 2004
d14 20
a33 1
@@@@ -3220,7 +3217,7 @@@@ socket_inet_aton(PyObject *self, PyObjec
@


1.1.1.1
log
@Import python 2.4

Python is an interpreted, interactive, object-oriented
programming language that combines remarkable power with
very clear syntax.

tested by djm@@ and mpech@@ (but more tests are needed!)
mbalmer@@ and xsa@@ want it to go in
@
text
@@
