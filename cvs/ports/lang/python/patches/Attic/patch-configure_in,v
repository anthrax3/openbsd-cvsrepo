head	1.4;
access;
symbols
	OPENBSD_3_0:1.1.0.2
	OPENBSD_3_0_BASE:1.1;
locks; strict;
comment	@# @;


1.4
date	2002.02.15.19.42.19;	author matt;	state dead;
branches;
next	1.3;

1.3
date	2001.10.28.01.52.44;	author brad;	state Exp;
branches;
next	1.2;

1.2
date	2001.10.27.03.01.53;	author brad;	state Exp;
branches;
next	1.1;

1.1
date	2001.10.18.18.52.52;	author naddy;	state Exp;
branches;
next	;


desc
@@


1.4
log
@Python 2.1.2 and Python 2.2.

Major changes:

- no more threads flavor, threads is now the default.

- subpackage modules that depend on other packages instead of having
largely redundant flavors (unless platform has no shared libs, then
flavors count again)

- shared libpython stuff disabled until someone can figure out why
it makes Zope crash
@
text
@--- configure.in.orig	Mon Jul 16 12:07:26 2001
+++ configure.in	Fri Oct 26 23:48:10 2001
@@@@ -599,7 +599,20 @@@@ then
 	Linux*) LDSHARED="gcc -shared";;
 	dgux*) LDSHARED="ld -G";;
 	BSD/OS*/4*) LDSHARED="gcc -shared";;
-	OpenBSD*) LDSHARED="ld -Bshareable";;
+	OpenBSD*)
+		if [[ "`$CC -dM -E - </dev/null | grep __ELF__`" != "" ]]
+		then
+			LDSHARED='$(CC) -shared $(CCSHARED)'
+		else
+			case `uname -r` in
+			[01].* | 2.[[0-7]] | 2.[[0-7]].*)
+			  LDSHARED="ld -Bshareable"
+			  ;;
+			*)
+			  LDSHARED='$(CC) -shared $(CCSHARED)'
+			  ;;
+			esac
+		fi;;
 	NetBSD*)
 		if [[ "`$CC -dM -E - </dev/null | grep __ELF__`" != "" ]]
 		then
@@@@ -642,8 +655,7 @@@@ then
 		 fi;;
 	Linux*) CCSHARED="-fPIC";;
 	BSD/OS*/4*) CCSHARED="-fpic";;
-	OpenBSD*) CCSHARED="-fpic";;
-	FreeBSD*|NetBSD*) CCSHARED="-fPIC";;
+	FreeBSD*|NetBSD*|OpenBSD*) CCSHARED="-fPIC";;
 	UnixWare*)
 		if test "$GCC" = "yes"
 		then CCSHARED="-fPIC"
@@@@ -681,7 +693,7 @@@@ then
 	UnixWare*) LINKFORSHARED="-dy -Bdynamic -Wl,-Bexport";;
 	SCO_SV*) LINKFORSHARED="-Bdynamic -dy -Wl,-Bexport";;
 	ReliantUNIX*) LINKFORSHARED="-W1 -Blargedynsym";;
-	FreeBSD*|NetBSD*) 
+	FreeBSD*|NetBSD*|OpenBSD*) 
 		if [[ "`$CC -dM -E - </dev/null | grep __ELF__`" != "" ]]
 		then
 			LINKFORSHARED="-Wl,--export-dynamic"
@@@@ -813,14 +825,28 @@@@ if test "$with_threads" = "no"
 then
     USE_THREAD_MODULE="#"
 else
+    have_threads=no
     if test "$ac_sys_system" = "UnixWare"
      then
+	have_threads=yes
 	CC="${CC} -Kthread"
 	LIBOBJS="$LIBOBJS thread.o"
 	AC_DEFINE(WITH_THREAD)
 	AC_DEFINE(_POSIX_THREADS)
 	USE_THREAD_MODULE=""
-    else
+    fi
+    if test "$have_threads" = "no" -a "$ac_sys_system" = "OpenBSD"
+     then
+	have_threads=yes
+	LIBS="-pthread $LIBS"
+	LIBOBJS="$LIBOBJS thread.o"
+	AC_DEFINE(WITH_THREAD)
+	AC_DEFINE(_REENTRANT)
+	AC_DEFINE(_POSIX_THREADS)
+	USE_THREAD_MODULE=""
+    fi
+    if test "$have_threads" = "no"
+     then
 	if test ! -z "$with_threads" -a -d "$with_threads"
 	then LDFLAGS="$LDFLAGS -L$with_threads"
 	fi
@


1.3
log
@deal with threads properly on OpenBSD.
@
text
@@


1.2
log
@- only enable threads FLAVOR by default on i386.
- mark threads usage BROKEN on anything other than i386 for now.
- suggest using env when trying to set FLAVOR variable from command line.
- simplify Makefile a bit and push some of it out into the autoconf script where it properly
belongs.
@
text
@d2 2
a3 2
+++ configure.in	Fri Oct 26 14:00:22 2001
@@@@ -599,7 +599,20 @@@@
d25 1
a25 1
@@@@ -642,8 +655,7 @@@@
d35 1
a35 1
@@@@ -681,7 +693,7 @@@@
d44 30
@


1.1
log
@fix on ELF architectures; from drahn@@
@
text
@d1 3
a3 4
$OpenBSD$
--- configure.in.orig	Mon Jul 16 11:07:26 2001
+++ configure.in	Tue Oct 16 13:51:30 2001
@@@@ -599,7 +599,8 @@@@ then
d8 14
a21 2
+        OpenBSD*/2.[0-7]*) LDSHARED="ld -Bshareable";;
+	OpenBSD*) LDSHARED="cc -shared";;
d25 11
a35 1
@@@@ -681,7 +682,7 @@@@ then
@

