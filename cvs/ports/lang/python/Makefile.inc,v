head	1.121;
access;
symbols
	OPENBSD_6_1:1.121.0.2
	OPENBSD_6_1_BASE:1.121
	OPENBSD_6_0:1.115.0.2
	OPENBSD_6_0_BASE:1.115
	OPENBSD_5_9:1.111.0.2
	OPENBSD_5_9_BASE:1.111
	OPENBSD_5_8:1.110.0.4
	OPENBSD_5_8_BASE:1.110
	OPENBSD_5_7:1.109.0.2
	OPENBSD_5_7_BASE:1.109
	OPENBSD_5_6:1.106.0.2
	OPENBSD_5_6_BASE:1.106
	OPENBSD_5_5:1.104.0.2
	OPENBSD_5_5_BASE:1.104
	OPENBSD_5_4:1.103.0.2
	OPENBSD_5_4_BASE:1.103
	OPENBSD_5_3:1.93.0.2
	OPENBSD_5_3_BASE:1.93
	OPENBSD_5_2:1.92.0.2
	OPENBSD_5_2_BASE:1.92
	OPENBSD_5_1_BASE:1.89
	OPENBSD_5_1:1.89.0.2
	OPENBSD_5_0:1.81.0.2
	OPENBSD_5_0_BASE:1.81
	OPENBSD_4_9:1.73.0.2
	OPENBSD_4_9_BASE:1.73
	OPENBSD_4_8:1.64.0.4
	OPENBSD_4_8_BASE:1.64
	OPENBSD_4_7:1.64.0.2
	OPENBSD_4_7_BASE:1.64
	OPENBSD_4_6:1.59.0.2
	OPENBSD_4_6_BASE:1.59
	OPENBSD_4_5:1.57.0.2
	OPENBSD_4_5_BASE:1.57
	OPENBSD_4_4:1.55.0.2
	OPENBSD_4_4_BASE:1.55
	OPENBSD_4_3:1.54.0.2
	OPENBSD_4_3_BASE:1.54
	OPENBSD_4_2:1.47.0.2
	OPENBSD_4_2_BASE:1.47
	OPENBSD_4_1:1.45.0.2
	OPENBSD_4_1_BASE:1.45
	OPENBSD_4_0:1.37.0.2
	OPENBSD_4_0_BASE:1.37
	OPENBSD_3_9:1.35.0.2
	OPENBSD_3_9_BASE:1.35
	OPENBSD_3_8:1.32.0.2
	OPENBSD_3_8_BASE:1.32
	OPENBSD_3_7:1.30.0.2
	OPENBSD_3_7_BASE:1.30
	OPENBSD_3_6:1.22.0.2
	OPENBSD_3_6_BASE:1.22
	OPENBSD_3_5:1.18.0.2
	OPENBSD_3_5_BASE:1.18
	OPENBSD_3_4:1.9.0.2
	OPENBSD_3_4_BASE:1.9
	OPENBSD_3_3:1.8.0.2
	OPENBSD_3_3_BASE:1.8
	OPENBSD_3_2:1.7.0.2
	OPENBSD_3_2_BASE:1.7
	OPENBSD_3_1:1.4.0.2
	OPENBSD_3_1_BASE:1.4;
locks; strict;
comment	@# @;


1.121
date	2017.02.20.11.04.27;	author phessler;	state Exp;
branches;
next	1.120;
commitid	IDSxBxKKAUxblHFC;

1.120
date	2017.02.17.10.01.28;	author phessler;	state Exp;
branches;
next	1.119;
commitid	hH7kqRvfwnujgfTd;

1.119
date	2016.12.26.19.41.45;	author rpointel;	state Exp;
branches;
next	1.118;
commitid	ERQuvPH3R4WKsI9J;

1.118
date	2016.09.23.09.16.55;	author sthen;	state Exp;
branches;
next	1.117;
commitid	XLnI6AbHAmyVU5mO;

1.117
date	2016.08.18.12.50.42;	author jasper;	state Exp;
branches;
next	1.116;
commitid	scNQBgJrs1SrTo5Q;

1.116
date	2016.08.12.09.55.28;	author jasper;	state Exp;
branches;
next	1.115;
commitid	MkU1fNAfy6mfUXi7;

1.115
date	2016.05.11.22.43.49;	author naddy;	state Exp;
branches;
next	1.114;
commitid	Cc0wPXxsybIujucK;

1.114
date	2016.04.06.11.29.25;	author naddy;	state Exp;
branches;
next	1.113;
commitid	pMyfQtQ2QekwQt7p;

1.113
date	2016.03.16.20.02.11;	author naddy;	state Exp;
branches;
next	1.112;
commitid	GN6lKbKd2o6JAOX1;

1.112
date	2016.03.10.11.50.13;	author naddy;	state Exp;
branches;
next	1.111;
commitid	jyYyxI4cQA4JapGp;

1.111
date	2015.10.08.07.18.24;	author rpointel;	state Exp;
branches;
next	1.110;
commitid	KUQdKClcRlnjPbpJ;

1.110
date	2015.04.17.07.58.12;	author phessler;	state Exp;
branches;
next	1.109;
commitid	AmsShgXioKYXIB8f;

1.109
date	2015.02.01.12.52.53;	author ratchov;	state Exp;
branches;
next	1.108;
commitid	hne6T3UHEsOCh7fW;

1.108
date	2015.01.22.23.03.31;	author naddy;	state Exp;
branches;
next	1.107;
commitid	E3VOcl50SzaauwFI;

1.107
date	2014.11.05.12.09.07;	author naddy;	state Exp;
branches;
next	1.106;
commitid	uHZ6wfVN57msPrhd;

1.106
date	2014.04.13.07.11.10;	author rpointel;	state Exp;
branches;
next	1.105;

1.105
date	2014.03.09.20.23.44;	author rpointel;	state Exp;
branches;
next	1.104;

1.104
date	2013.10.27.18.32.55;	author fgsch;	state Exp;
branches;
next	1.103;

1.103
date	2013.06.04.08.02.20;	author fgsch;	state Exp;
branches;
next	1.102;

1.102
date	2013.05.30.14.46.31;	author ajacoutot;	state Exp;
branches;
next	1.101;

1.101
date	2013.05.22.12.36.03;	author fgsch;	state Exp;
branches;
next	1.100;

1.100
date	2013.05.18.04.13.16;	author fgsch;	state Exp;
branches;
next	1.99;

1.99
date	2013.05.07.08.03.42;	author fgsch;	state Exp;
branches;
next	1.98;

1.98
date	2013.04.28.00.49.11;	author fgsch;	state Exp;
branches;
next	1.97;

1.97
date	2013.04.13.22.31.42;	author fgsch;	state Exp;
branches;
next	1.96;

1.96
date	2013.03.31.21.35.26;	author bcallah;	state Exp;
branches;
next	1.95;

1.95
date	2013.03.11.12.27.54;	author sthen;	state Exp;
branches;
next	1.94;

1.94
date	2013.03.11.11.20.28;	author espie;	state Exp;
branches;
next	1.93;

1.93
date	2012.08.23.19.19.17;	author sthen;	state Exp;
branches;
next	1.92;

1.92
date	2012.05.09.06.21.12;	author ajacoutot;	state Exp;
branches;
next	1.91;

1.91
date	2012.04.27.08.18.59;	author rpointel;	state Exp;
branches;
next	1.90;

1.90
date	2012.04.23.17.15.18;	author espie;	state Exp;
branches;
next	1.89;

1.89
date	2011.12.20.13.08.06;	author fgsch;	state Exp;
branches;
next	1.88;

1.88
date	2011.12.08.08.17.28;	author espie;	state Exp;
branches;
next	1.87;

1.87
date	2011.12.07.15.14.22;	author naddy;	state Exp;
branches;
next	1.86;

1.86
date	2011.10.18.06.46.24;	author espie;	state Exp;
branches;
next	1.85;

1.85
date	2011.09.28.16.59.33;	author fgsch;	state Exp;
branches;
next	1.84;

1.84
date	2011.09.27.21.27.36;	author sthen;	state Exp;
branches;
next	1.83;

1.83
date	2011.09.21.14.37.28;	author fgsch;	state Exp;
branches;
next	1.82;

1.82
date	2011.09.06.20.58.08;	author rpointel;	state Exp;
branches;
next	1.81;

1.81
date	2011.07.18.15.32.18;	author naddy;	state Exp;
branches;
next	1.80;

1.80
date	2011.07.16.20.22.48;	author sthen;	state Exp;
branches;
next	1.79;

1.79
date	2011.05.30.21.11.44;	author rpointel;	state Exp;
branches;
next	1.78;

1.78
date	2011.05.23.06.42.02;	author jasper;	state Exp;
branches;
next	1.77;

1.77
date	2011.05.03.17.52.04;	author rpointel;	state Exp;
branches;
next	1.76;

1.76
date	2011.05.03.17.14.43;	author fgsch;	state Exp;
branches;
next	1.75;

1.75
date	2011.04.24.09.19.01;	author rpointel;	state Exp;
branches;
next	1.74;

1.74
date	2011.04.12.19.28.13;	author kili;	state Exp;
branches;
next	1.73;

1.73
date	2010.11.26.14.50.10;	author espie;	state Exp;
branches;
next	1.72;

1.72
date	2010.11.22.09.23.59;	author espie;	state Exp;
branches;
next	1.71;

1.71
date	2010.11.17.08.05.18;	author espie;	state Exp;
branches;
next	1.70;

1.70
date	2010.11.15.20.55.24;	author sthen;	state Exp;
branches;
next	1.69;

1.69
date	2010.11.07.19.12.42;	author espie;	state Exp;
branches;
next	1.68;

1.68
date	2010.10.28.08.22.11;	author fgsch;	state Exp;
branches;
next	1.67;

1.67
date	2010.10.24.21.24.04;	author ajacoutot;	state Exp;
branches;
next	1.66;

1.66
date	2010.09.16.22.34.08;	author fgsch;	state Exp;
branches;
next	1.65;

1.65
date	2010.09.03.19.20.06;	author sthen;	state Exp;
branches;
next	1.64;

1.64
date	2010.02.25.11.02.39;	author phessler;	state Exp;
branches;
next	1.63;

1.63
date	2010.02.09.12.23.59;	author jasper;	state Exp;
branches;
next	1.62;

1.62
date	2009.11.22.22.53.19;	author jasper;	state Exp;
branches;
next	1.61;

1.61
date	2009.09.22.21.31.00;	author ajacoutot;	state Exp;
branches;
next	1.60;

1.60
date	2009.08.10.17.31.07;	author kili;	state Exp;
branches;
next	1.59;

1.59
date	2009.06.25.01.49.54;	author jolan;	state Exp;
branches;
next	1.58;

1.58
date	2009.03.09.23.09.19;	author espie;	state Exp;
branches;
next	1.57;

1.57
date	2009.01.01.21.03.27;	author djm;	state Exp;
branches;
next	1.56;

1.56
date	2008.10.18.11.55.57;	author djm;	state Exp;
branches;
next	1.55;

1.55
date	2008.05.10.17.10.24;	author deanna;	state Exp;
branches;
next	1.54;

1.54
date	2008.02.27.00.30.47;	author djm;	state Exp;
branches;
next	1.53;

1.53
date	2008.01.04.17.48.36;	author espie;	state Exp;
branches;
next	1.52;

1.52
date	2007.10.30.13.35.18;	author steven;	state Exp;
branches;
next	1.51;

1.51
date	2007.10.25.21.05.33;	author steven;	state Exp;
branches;
next	1.50;

1.50
date	2007.10.20.06.55.54;	author espie;	state Exp;
branches;
next	1.49;

1.49
date	2007.09.26.14.02.23;	author alek;	state Exp;
branches;
next	1.48;

1.48
date	2007.09.16.00.27.06;	author merdely;	state Exp;
branches;
next	1.47;

1.47
date	2007.05.07.15.43.33;	author jasper;	state Exp;
branches;
next	1.46;

1.46
date	2007.04.28.10.06.24;	author bernd;	state Exp;
branches;
next	1.45;

1.45
date	2007.01.10.16.57.56;	author steven;	state Exp;
branches;
next	1.44;

1.44
date	2006.11.24.20.48.23;	author steven;	state Exp;
branches;
next	1.43;

1.43
date	2006.11.13.11.20.25;	author steven;	state Exp;
branches;
next	1.42;

1.42
date	2006.11.08.19.00.19;	author djm;	state Exp;
branches;
next	1.41;

1.41
date	2006.11.01.21.11.55;	author alek;	state Exp;
branches;
next	1.40;

1.40
date	2006.10.10.19.08.06;	author alek;	state Exp;
branches;
next	1.39;

1.39
date	2006.10.02.20.29.40;	author alek;	state Exp;
branches;
next	1.38;

1.38
date	2006.10.02.18.54.09;	author alek;	state Exp;
branches;
next	1.37;

1.37
date	2006.08.03.19.56.08;	author espie;	state Exp;
branches;
next	1.36;

1.36
date	2006.07.28.22.36.41;	author steven;	state Exp;
branches;
next	1.35;

1.35
date	2005.12.27.19.41.21;	author alek;	state Exp;
branches;
next	1.34;

1.34
date	2005.12.17.12.45.39;	author alek;	state Exp;
branches;
next	1.33;

1.33
date	2005.11.11.09.45.29;	author alek;	state Exp;
branches;
next	1.32;

1.32
date	2005.06.06.20.47.04;	author alek;	state Exp;
branches;
next	1.31;

1.31
date	2005.05.23.20.39.36;	author alek;	state Exp;
branches;
next	1.30;

1.30
date	2005.03.03.23.20.47;	author alek;	state Exp;
branches;
next	1.29;

1.29
date	2005.02.24.13.20.41;	author alek;	state Exp;
branches;
next	1.28;

1.28
date	2005.01.12.21.31.06;	author sturm;	state Exp;
branches;
next	1.27;

1.27
date	2004.12.30.12.06.22;	author espie;	state Exp;
branches;
next	1.26;

1.26
date	2004.12.21.11.30.39;	author espie;	state Exp;
branches;
next	1.25;

1.25
date	2004.11.16.02.10.56;	author espie;	state Exp;
branches;
next	1.24;

1.24
date	2004.11.04.22.16.07;	author alek;	state Exp;
branches;
next	1.23;

1.23
date	2004.09.15.19.16.08;	author espie;	state Exp;
branches;
next	1.22;

1.22
date	2004.08.08.15.38.00;	author xsa;	state Exp;
branches;
next	1.21;

1.21
date	2004.05.15.06.43.23;	author sturm;	state Exp;
branches;
next	1.20;

1.20
date	2004.04.18.12.13.58;	author sturm;	state Exp;
branches;
next	1.19;

1.19
date	2004.04.06.02.39.23;	author brad;	state Exp;
branches;
next	1.18;

1.18
date	2004.03.04.17.49.26;	author espie;	state Exp;
branches;
next	1.17;

1.17
date	2004.02.27.21.04.50;	author pvalchev;	state Exp;
branches;
next	1.16;

1.16
date	2004.01.14.19.51.40;	author sturm;	state Exp;
branches;
next	1.15;

1.15
date	2004.01.08.21.11.22;	author sturm;	state Exp;
branches;
next	1.14;

1.14
date	2003.12.31.17.40.20;	author sturm;	state Exp;
branches;
next	1.13;

1.13
date	2003.12.31.12.05.22;	author sturm;	state Exp;
branches;
next	1.12;

1.12
date	2003.12.30.17.05.30;	author sturm;	state Exp;
branches;
next	1.11;

1.11
date	2003.12.27.23.36.09;	author jose;	state Exp;
branches;
next	1.10;

1.10
date	2003.12.13.15.03.07;	author sturm;	state Exp;
branches;
next	1.9;

1.9
date	2003.06.02.15.13.42;	author brad;	state Exp;
branches;
next	1.8;

1.8
date	2002.10.08.02.52.25;	author brad;	state Exp;
branches;
next	1.7;

1.7
date	2002.07.09.12.32.34;	author matt;	state Exp;
branches
	1.7.2.1;
next	1.6;

1.6
date	2002.05.13.23.31.25;	author espie;	state Exp;
branches;
next	1.5;

1.5
date	2002.05.11.21.35.13;	author matt;	state Exp;
branches;
next	1.4;

1.4
date	2002.03.23.04.34.22;	author matt;	state Exp;
branches
	1.4.2.1;
next	1.3;

1.3
date	2002.02.25.21.25.37;	author matt;	state Exp;
branches;
next	1.2;

1.2
date	2002.02.15.19.55.14;	author matt;	state Exp;
branches;
next	1.1;

1.1
date	2002.02.15.19.42.18;	author matt;	state Exp;
branches;
next	;

1.4.2.1
date	2002.10.11.23.50.40;	author brad;	state Exp;
branches;
next	;

1.7.2.1
date	2002.10.08.03.08.45;	author brad;	state Exp;
branches;
next	;


desc
@@


1.121
log
@10 years ago, we needed to build python with c++ to make sure modules
with native c++ code worked fine.  We no longer need to do that, and
llvm errors out with the non-sensical combination of "c++ -std=c99".

this fixes the python build on arm64

tested by sthen@@ in an i386 bulk, thanks!

OK sthen@@, rpointel@@ (maintainer)
@
text
@# $OpenBSD: Makefile.inc,v 1.120 2017/02/17 10:01:28 phessler Exp $

# IMPORTANT!  If you make any changes to the Python ports, be sure
# to also update files/CHANGES.OpenBSD for your change.  This is a
# requirement of the PSF license, if it constitutes a change to
# Python itself.

COMMENT-main =	interpreted object-oriented programming language
COMMENT-bsddb =	Berkeley db module for Python
COMMENT-gdbm =	GNU dbm module for Python
COMMENT-idle =	IDE for Python
COMMENT-tests =	Python test suite
COMMENT-tkinter = tk GUI module for Python
COMMENT-tools =	extra tools for Python

DISTNAME =	Python-${VERSION}${PATCHLEVEL}
PKGNAME-main =	python-${VERSION}${PATCHLEVEL}
PKGSPEC-main =	python-${VERSION_SPEC}
PKGNAME-bsddb =	python-bsddb-${VERSION}${PATCHLEVEL}
PKGSPEC-bsddb =	python-bsddb-${VERSION_SPEC}
PKGNAME-gdbm =	python-gdbm-${VERSION}${PATCHLEVEL}
PKGSPEC-gdbm =	python-gdbm-${VERSION_SPEC}
PKGNAME-idle =	python-idle-${VERSION}${PATCHLEVEL}
PKGSPEC-idle =	python-idle-${VERSION_SPEC}
PKGNAME-tests =	python-tests-${VERSION}${PATCHLEVEL}
PKGSPEC-tests =	python-tests-${VERSION_SPEC}
PKGNAME-tkinter = python-tkinter-${VERSION}${PATCHLEVEL}
PKGSPEC-tkinter = python-tkinter-${VERSION_SPEC}
PKGNAME-tools =	python-tools-${VERSION}${PATCHLEVEL}
PKGSPEC-tools =	python-tools-${VERSION_SPEC}

CATEGORIES =	lang
MASTER_SITES =	http://www.python.org/ftp/${PSUBDIR}/ \
		http://sunsite.informatik.rwth-aachen.de/python/ftp/${PSUBDIR}/
PSUBDIR ?=	python/${VERSION}${PATCHLEVEL}
EXTRACT_SUFX =	.tgz

HOMEPAGE =	http://www.python.org/

MAINTAINER =	Remi Pointel <rpointel@@openbsd.org>

# PSF license <http://www.python.org/${VERSION}/license.html>
# A summary of changes to Python is required to be distributed
PERMIT_PACKAGE_CDROM =	Yes

.if ${VERSION} == "2.7"
LIB_SUFX =	
MULTI_PACKAGES =	-main -tests -tools -gdbm -idle -tkinter -bsddb
.else
LIB_SUFX =		m
MULTI_PACKAGES =	-main -tests -gdbm -idle -tkinter
.endif

# Python 2.7 lists BSD db 4.6.x as unstable on most architectures (see
# setup.py:allow_db_version). XXX revisit if databases/db/v4 is updated to 4.7
.if ${VERSION} == "2.7"
ONLY_FOR_ARCHS-bsddb=	amd64 i386
.endif

# All subpackages depend on the main python package.

RUN_DEPENDS =		${FULLPKGNAME-main}:lang/python/${VERSION},-main
LIB_DEPENDS =

LIB_DEPENDS-main =	archivers/bzip2 \
			databases/sqlite3 \
			devel/libffi \
			devel/gettext
RUN_DEPENDS-main =
WANTLIB-main =		bz2 c crypto expat ffi intl m ncursesw panelw pthread \
			readline sqlite3 ssl stdc++ util z
.if ${VERSION} != "2.7"
LIB_DEPENDS-main +=	archivers/xz
WANTLIB-main +=		lzma
.endif

WANTLIB-tests =
WANTLIB-tools =

LIB_DEPENDS-bsddb =	lang/python/${VERSION},-main
.if ${MACHINE_ARCH} == "i386" || ${MACHINE_ARCH} == "amd64"
# XXX recursion: if we have java, then db/v4 depends on libxml
LIB_DEPENDS-bsddb +=	databases/db/v4,no_tcl,no_java,bootstrap
.else
LIB_DEPENDS-bsddb +=	databases/db/v4
.endif
WANTLIB-bsddb =		lib/db4/db>=4 pthread python${VERSION}${LIB_SUFX}

LIB_DEPENDS-gdbm =	databases/gdbm \
			lang/python/${VERSION},-main
WANTLIB-gdbm =		gdbm>=3 pthread python${VERSION}${LIB_SUFX}

RUN_DEPENDS-idle =	lang/python/${VERSION},-tkinter \
			${RUN_DEPENDS}
WANTLIB-idle =

MODULES +=		x11/tk
# Tcl/Tk version needs to be in sync with patch-setup_py's one
MODTK_VERSION =		8.5
LIB_DEPENDS-tkinter =	lang/python/${VERSION},-main \
			${MODTK_LIB_DEPENDS}
WANTLIB-tkinter =	X11 pthread python${VERSION}${LIB_SUFX} \
			${MODTK_WANTLIB}

AUTOCONF_VERSION =	2.69

CONFIGURE_STYLE =	autoconf
CONFIGURE_ARGS +=	--enable-shared
# --srcdir is needed for systrace to work correctly
CONFIGURE_ARGS +=	--srcdir=${WRKSRC} \
			--with-fpectl \
			--with-threads \
			--enable-ipv6 \
			--with-system-expat \
			--with-system-ffi

CONFIGURE_ENV += OPT='${CFLAGS} -fPIC' CPPFLAGS='-I${LOCALBASE}/include' \
		LDFLAGS='-L${LOCALBASE}/lib/' SVNVERSION=no \
		LOCALBASE=${LOCALBASE} X11BASE=${X11BASE}
MAKE_ENV +=	LOCALBASE=${LOCALBASE} X11BASE=${X11BASE}
MAKE_FLAGS +=	LD_LIBRARY_PATH=${WRKSRC} PATH="${WRKDIST}:${PORTPATH}"
MAKE_FLAGS +=	LDFLAGS='-L${WRKSRC}'
FAKE_FLAGS +=	RANLIB=:

# Python itself is clean, but some extensions e.g. py-cryptography
# and QtWebKit require W|X mappings.
USE_WXNEEDED = Yes

.if ${VERSION} == "3.6"
ALL_TARGET =	all
.else
ALL_TARGET =	all ./Lib/plat-openbsd6
.endif

post-extract:
	rm -r ${WRKDIST}/Modules/expat

post-patch:
	${SUBST_CMD} ${WRKSRC}/configure.ac

post-configure:
	@@cd ${WRKSRC} && ${MAKE_PROGRAM} Makefile

ADJ_FILES = ${WRKSRC}/Tools/scripts/pydoc*
.if ${VERSION} == "2.7"
ADJ_FILES += ${WRKSRC}/Tools/scripts/2to3
.endif

post-build:
	perl -pi -e \
		's@@#! */usr/bin/env +python@@#!${PREFIX}/bin/python${VERSION}@@' \
		${ADJ_FILES}

post-install:
.if ${VERSION} == "2.7"
	${INSTALL_SCRIPT} ${WRKSRC}/Tools/scripts/pydoc \
		${PREFIX}/bin/pydoc${VERSION}
	@@sed -e "s,@@VERSION@@,${VERSION},g" -e "s,@@LOCALBASE@@,${LOCALBASE},g" \
		${FILESDIR}/idle > ${WRKSRC}/idle
	${INSTALL_SCRIPT} ${WRKSRC}/idle ${PREFIX}/bin/idle${VERSION}
	@@cd ${WRKSRC}; tar -cf - Tools | (cd ${PREFIX}/lib/python${VERSION}; \
		tar -xf -)
	${INSTALL_SCRIPT} ${WRKSRC}/Tools/scripts/2to3 \
		${PREFIX}/bin/python${VERSION}-2to3
.endif
	${INSTALL_DATA_DIR} ${PREFIX}/share/doc/python${VERSION}
	${INSTALL_DATA} ${FILESDIR}/CHANGES.OpenBSD \
		${PREFIX}/share/doc/python${VERSION}/CHANGES.OpenBSD

TEST_TARGET=	test
TEST_FLAGS=	"EXTRATESTOPTS=-w"
# Some regress tests write to $HOME
PORTHOME=	${WRKDIR}
@


1.120
log
@remove a sparc leftover
@
text
@d1 1
a1 1
# $OpenBSD: Makefile.inc,v 1.119 2016/12/26 19:41:45 rpointel Exp $
a113 1
			--with-cxx_main \
@


1.119
log
@adapt ALL_TARGET for Python 3.6.
@
text
@d1 1
a1 1
# $OpenBSD: Makefile.inc,v 1.118 2016/09/23 09:16:55 sthen Exp $
a116 4

.if ${MACHINE_ARCH:Msparc}
CFLAGS+=-O0
.endif
@


1.118
log
@Cope with moving sqlite3 back to ports.
@
text
@d1 1
a1 1
# $OpenBSD: Makefile.inc,v 1.117 2016/08/18 12:50:42 jasper Exp $
d134 3
d138 1
@


1.117
log
@switch to USE_WXNEEDED
@
text
@d1 1
a1 1
# $OpenBSD: Makefile.inc,v 1.116 2016/08/12 09:55:28 jasper Exp $
d66 1
@


1.116
log
@annotate python interpreters with wxneeded; while python itself is clean there
are various ports that aren't (e.g. py-cryptography and py-qt5 (QtWebKit)).

obviously not a long-term "fix" but helps to keep moving forward

ok jca@@ sthen@@ rpointel@@ (MAINTAINER)
@
text
@d1 1
a1 1
# $OpenBSD: Makefile.inc,v 1.115 2016/05/11 22:43:49 naddy Exp $
d126 3
d131 1
a131 2
MAKE_FLAGS +=	LDFLAGS='-L${WRKSRC} -Wl,-z,wxneeded'
FAKE_FLAGS +=	RANLIB=:
@


1.115
log
@fix build after OpenBSD 5.x -> 6.x transition
@
text
@d1 1
a1 1
# $OpenBSD: Makefile.inc,v 1.114 2016/04/06 11:29:25 naddy Exp $
d126 3
a128 1
MAKE_FLAGS +=	LDFLAGS='-L${WRKSRC}'
@


1.114
log
@replace gettext module with library dependency; ok rpointel@@
@
text
@d1 1
a1 1
# $OpenBSD: Makefile.inc,v 1.113 2016/03/16 20:02:11 naddy Exp $
d129 1
a129 1
ALL_TARGET =	all ./Lib/plat-openbsd5
@


1.113
log
@removing SHARED_ONLY is safe here
@
text
@d1 1
a1 1
# $OpenBSD: Makefile.inc,v 1.112 2016/03/10 11:50:13 naddy Exp $
a59 2
MODULES +=		devel/gettext

d67 1
a67 1
			${MODGETTEXT_LIB_DEPENDS}
d69 2
a70 3
WANTLIB-main =		bz2 c crypto expat ffi m ncursesw panelw pthread \
			readline sqlite3 ssl stdc++ util z \
			${MODGETTEXT_WANTLIB}
@


1.112
log
@requires --enable-shared
@
text
@d1 1
a1 1
# $OpenBSD: Makefile.inc,v 1.111 2015/10/08 07:18:24 rpointel Exp $
a6 2

SHARED_ONLY=	Yes
@


1.111
log
@python != 2.7 depends on archivers/xz; spotted by nigel@@ (thanks).
bump revision for python 3.5.
@
text
@d1 1
a1 1
# $OpenBSD: Makefile.inc,v 1.110 2015/04/17 07:58:12 phessler Exp $
d112 1
a112 1
CONFIGURE_ARGS +=	${CONFIGURE_SHARED}
@


1.110
log
@use lower optimization levels, so compiles work on sparc
@
text
@d1 1
a1 1
# $OpenBSD: Makefile.inc,v 1.109 2015/02/01 12:52:53 ratchov Exp $
d76 1
a76 1
.if ${VERSION} == "3.4"
@


1.109
log
@Stop installing python 2.7 ossaudiodev module. It's not present
in recent versions of python most probably because it doesn't make sense
to expose non-portable low-level ioctl's to scripts (PyAudio & PyGame
are much better choices).

ok brad, aja and sthen ok'd first version of this diff
@
text
@d1 1
a1 1
# $OpenBSD: Makefile.inc,v 1.108 2015/01/22 23:03:31 naddy Exp $
d121 4
@


1.108
log
@Drop USE_GROFF from subdir: trivial formatting differences only.
@
text
@d1 1
a1 1
# $OpenBSD: Makefile.inc,v 1.107 2014/11/05 12:09:07 naddy Exp $
d76 1
a76 3
.if ${VERSION} == "2.7"
WANTLIB-main +=		ossaudio
.elif ${VERSION} == "3.4"
@


1.107
log
@remove python 3.3 leftovers; ok rpointel@@
@
text
@d1 1
a1 1
# $OpenBSD: Makefile.inc,v 1.106 2014/04/13 07:11:10 rpointel Exp $
a109 2

USE_GROFF =	Yes
@


1.106
log
@understand Python 3.4.
@
text
@d1 1
a1 1
# $OpenBSD: Makefile.inc,v 1.105 2014/03/09 20:23:44 rpointel Exp $
d78 1
a78 1
.elif ${VERSION} == "3.3" || ${VERSION} == "3.4"
@


1.105
log
@Activate locale.bindtextdomain in Python.
ok aja@@.
@
text
@d1 1
a1 1
# $OpenBSD: Makefile.inc,v 1.104 2013/10/27 18:32:55 fgsch Exp $
d78 1
a78 1
.elif ${VERSION} == "3.3"
@


1.104
log
@- Merge ctypes fragment into main now that libffi is fixed
- Remove uneeded diff after the time_t change
- Clean things a bit
- Bump revisions

tested by rpointel@@, sthen@@ and myself. ok by them and jasper@@
@
text
@d1 1
a1 1
# $OpenBSD: Makefile.inc,v 1.103 2013/06/04 08:02:20 fgsch Exp $
d126 1
a126 1
CONFIGURE_ENV += OPT='${CFLAGS} -fPIC' \
@


1.103
log
@GC python 2.5.  Thanks to zhuk who made this possible.
@
text
@d1 1
a1 1
# $OpenBSD: Makefile.inc,v 1.102 2013/05/30 14:46:31 ajacoutot Exp $
d10 7
a16 7
COMMENT-main=	interpreted object-oriented programming language
COMMENT-bsddb=	Berkeley db module for Python
COMMENT-gdbm=	GNU dbm module for Python
COMMENT-idle=	IDE for Python
COMMENT-tests=	Python test suite
COMMENT-tkinter=tk GUI module for Python
COMMENT-tools=	extra tools for Python
d34 2
a35 2
CATEGORIES=	lang
MASTER_SITES=	http://www.python.org/ftp/${PSUBDIR}/ \
d37 2
a38 2
PSUBDIR?=	python/${VERSION}${PATCHLEVEL}
EXTRACT_SUFX=	.tgz
d40 1
a40 1
HOMEPAGE=	http://www.python.org/
d46 1
a46 1
PERMIT_PACKAGE_CDROM=	Yes
d50 1
a50 1
MULTI_PACKAGES=	-main -tests -tools -gdbm -idle -tkinter -bsddb
d52 2
a53 2
LIB_SUFX =	m
MULTI_PACKAGES=	-main -tests -gdbm -idle -tkinter
d66 2
a67 2
RUN_DEPENDS=		${FULLPKGNAME-main}:lang/python/${VERSION},-main
LIB_DEPENDS=
d70 1
d73 1
a73 1
WANTLIB-main =		bz2 c crypto expat m ncursesw panelw pthread \
a110 10
# The ctypes module depends of devel/libffi, not supported on all platforms
.if ${MACHINE_ARCH:Marm}
PKG_ARGS+=	-Dctypes=0
.else
PKG_ARGS+=	-Dctypes=1
LIB_DEPENDS-main += devel/libffi
CONFIGURE_ARGS +=	--with-system-ffi
WANTLIB-main +=	ffi
.endif

d115 2
a116 2
CONFIGURE_STYLE=	autoconf
CONFIGURE_ARGS+=	${CONFIGURE_SHARED}
d118 7
a124 2
CONFIGURE_ARGS+=	--with-fpectl --with-threads --srcdir=${WRKSRC}
CONFIGURE_ARGS+=	--enable-ipv6
d126 1
a126 1
CONFIGURE_ENV+= OPT='${CFLAGS} -fPIC' \
d129 4
a132 4
MAKE_ENV+=	LOCALBASE=${LOCALBASE} X11BASE=${X11BASE}
MAKE_FLAGS+=	LD_LIBRARY_PATH=${WRKSRC} PATH="${WRKDIST}:${PORTPATH}"
MAKE_FLAGS+=	LDFLAGS='-L${WRKSRC}'
FAKE_FLAGS+=	RANLIB=:
@


1.102
log
@3.2 -> 3.3
@
text
@d1 1
a1 1
# $OpenBSD: Makefile.inc,v 1.101 2013/05/22 12:36:03 fgsch Exp $
d48 1
a48 1
.if ${VERSION} < 3.3
d75 1
a75 1
.if ${VERSION} < 3.3
a109 8
.if ${VERSION} == "2.5"
.if ${PROPERTIES:Mlp64}
PKG_ARGS+=	-Dmm=0
.else
PKG_ARGS+=	-Dmm=1
.endif
.endif

d122 1
a122 1
AUTOCONF_VERSION ?=	2.69
d160 1
a160 1
.if ${VERSION} < 3.3
d168 2
a173 4
.if ${VERSION} == "2.7"
	${INSTALL_SCRIPT} ${WRKSRC}/Tools/scripts/2to3 \
		${PREFIX}/bin/python${VERSION}-2to3
.endif
@


1.101
log
@Add missing dependencies and sync wantlib.
prompted by and ok ajacoutot@@
@
text
@d1 1
a1 1
# $OpenBSD: Makefile.inc,v 1.100 2013/05/18 04:13:16 fgsch Exp $
d48 1
a48 1
.if ${VERSION} < 3.2
d75 1
a75 1
.if ${VERSION} < 3.2
d168 1
a168 1
.if ${VERSION} < 3.2
@


1.100
log
@- update what tests should be skipped
- add missing dependency on archivers/xz
- temporarily fix timeval's tv_sec handling
- bump

ajacoutot@@ jasper@@ sthen@@ ok as part of a larger diff.
@
text
@d1 1
a1 1
# $OpenBSD: Makefile.inc,v 1.99 2013/05/07 08:03:42 fgsch Exp $
d62 2
d69 2
a70 1
LIB_DEPENDS-main =	archivers/bzip2
d72 6
a77 6
WANTLIB-main =		ssl panelw m crypto c util z readline pthread \
			ncursesw stdc++ expat ossaudio bz2
LIB_DEPENDS-main +=	
WANTLIB-main +=		sqlite3

.if ${VERSION} == "3.3"
d82 3
d92 1
a93 1
WANTLIB-bsddb =		lib/db4/db>=4 python${VERSION}${LIB_SUFX} c pthread
d96 6
a101 3
WANTLIB-gdbm =		gdbm>=3 python${VERSION}${LIB_SUFX} c pthread
RUN_DEPENDS-idle =	${RUN_DEPENDS} \
			lang/python/${VERSION},-tkinter
d105 4
a108 4
LIB_DEPENDS-tkinter =	${MODTK_LIB_DEPENDS} \
			lang/python/${VERSION},-main
WANTLIB-tkinter =	X11 ${MODTK_WANTLIB} python${VERSION}${LIB_SUFX}
WANTLIB-tkinter +=	c pthread
d110 1
a110 1
.if ${VERSION} < 3.2
@


1.99
log
@remove djm and put rpointel as the maintainer for 2.5 and 2.7 as well.
discussed with djm.
@
text
@d1 1
a1 1
# $OpenBSD: Makefile.inc,v 1.98 2013/04/28 00:49:11 fgsch Exp $
d73 5
@


1.98
log
@- change post-patch to use configure.ac
- set default autoconf version to 2.69
- explicitly set tk version to 8.5. prompted by sthen.
@
text
@d1 1
a1 1
# $OpenBSD: Makefile.inc,v 1.97 2013/04/13 22:31:42 fgsch Exp $
d42 1
a42 1
MAINTAINER=	Damien Miller <djm@@openbsd.org>
@


1.97
log
@Update python 2.7 to 2.7.4.

This is a slighly different version that I sent that includes an updated
kqueue diff that works with python 2 and 3 and puts test_bsddb and
test_bsddb3 back on the skip list as they're not built outside amd64
and i386.

Only 2 tests are known to fail: test_kqueue (broken) and test_threading
(failing on 2.7.3, under investigation but likely broken). If something
else fails please send your test.log.

Tested on a bulk by landry, sparc64 by brad, ppc gonzalo and amd64 by me.
@
text
@d1 1
a1 1
# $OpenBSD: Makefile.inc,v 1.96 2013/03/31 21:35:26 bcallah Exp $
a87 1
# XXX Tcl/Tk version number handled in patch-setup_py
d89 2
d116 2
d138 1
a138 1
	${SUBST_CMD} ${WRKSRC}/configure.in
@


1.96
log
@Fix a hardcoded INSTSONAME, which happens to be wrong for Python 2.7
Bump everyone's REVISION.
ok sthen@@
@
text
@d1 1
a1 1
# $OpenBSD: Makefile.inc,v 1.95 2013/03/11 12:27:54 sthen Exp $
a96 1
PATCH_LIST =		patch-* sup64-*
a124 4
.if ${VERSION} < 3.2
MAKE_FLAGS+=	LDLIBRARY=libpython${VERSION}.so.${LIBpython${VERSION}_VERSION}
MAKE_FLAGS+=	INSTSONAME=libpython${VERSION}.so.${LIBpython${VERSION}_VERSION}
.endif
d129 1
a129 1
ALL_TARGET?=	everything ./Lib/plat-openbsd5
@


1.95
log
@PERMIT_*
@
text
@d1 1
a1 1
# $OpenBSD: Makefile.inc,v 1.94 2013/03/11 11:20:28 espie Exp $
d138 3
@


1.94
log
@PERMIT_* / REGRESS->TEST sweep
@
text
@d1 1
a1 1
# $OpenBSD: Makefile.inc,v 1.93 2012/08/23 19:19:17 sthen Exp $
a46 2
PERMIT_PACKAGE_FTP=	Yes
PERMIT_DISTFILES_FTP=	Yes
@


1.93
log
@sync wantlib
@
text
@d1 1
a1 1
# $OpenBSD: Makefile.inc,v 1.92 2012/05/09 06:21:12 ajacoutot Exp $
a47 1
PERMIT_DISTFILES_CDROM=	Yes
d172 2
a173 2
REGRESS_TARGET=	test
REGRESS_FLAGS=	"EXTRATESTOPTS=-w"
@


1.92
log
@Don't overwrite THREAD_STACK_SIZE but use the default.

ok fgsch@@
@
text
@d1 1
a1 1
# $OpenBSD: Makefile.inc,v 1.91 2012/04/27 08:18:59 rpointel Exp $
d85 1
a85 1
WANTLIB-bsddb =		lib/db4/db>=4 python${VERSION}${LIB_SUFX}
d88 1
a88 1
WANTLIB-gdbm =		gdbm>=3 python${VERSION}${LIB_SUFX}
d96 1
@


1.91
log
@Update Python 2.7.2 to 2.7.3.
ok mpi@@, gonzalo@@. tested in a bulk build by landry@@.
@
text
@d1 1
a1 1
# $OpenBSD: Makefile.inc,v 1.90 2012/04/23 17:15:18 espie Exp $
d124 1
a124 4
# THREAD_STACK_SIZE value might be changed by particular python release
THREAD_STACK_SIZE?=0x20000

CONFIGURE_ENV+= OPT='${CFLAGS} -DTHREAD_STACK_SIZE=${THREAD_STACK_SIZE} -fPIC' \
@


1.90
log
@first pass at handling sqlite3 move
@
text
@d1 1
a1 1
# $OpenBSD: Makefile.inc,v 1.89 2011/12/20 13:08:06 fgsch Exp $
d133 1
@


1.89
log
@RIP python2.4.
jasper@@ ok
@
text
@d1 1
a1 1
# $OpenBSD: Makefile.inc,v 1.88 2011/12/08 08:17:28 espie Exp $
d74 1
a74 1
LIB_DEPENDS-main +=	databases/sqlite3
@


1.88
log
@PROPERTIES is now available from Makefile.inc, update infra/
@
text
@d1 1
a1 1
# $OpenBSD: Makefile.inc,v 1.87 2011/12/07 15:14:22 naddy Exp $
a73 1
.if ${VERSION} != "2.4"
a75 1
.endif
d107 1
a107 1
.if ${VERSION} == "2.4" || ${MACHINE_ARCH:Marm}
@


1.87
log
@rather than trying to list all LP64 architectures, get this from
bsd.port.arch.mk; ok espie@@ djm@@
@
text
@d1 1
a1 1
# $OpenBSD: Makefile.inc,v 1.86 2011/10/18 06:46:24 espie Exp $
a97 2

.include <bsd.port.arch.mk>
@


1.86
log
@fix build: prevent infinite recursion thru python.
also annotate gamin for bootstrap property, and mark haddock,no_deps as
a "real flavor", since it's only used for bootstrap anyways AND significantly
changes the build.
@
text
@d1 1
a1 1
# $OpenBSD: Makefile.inc,v 1.85 2011/09/28 16:59:33 fgsch Exp $
d99 2
d102 1
a102 2
.if ${MACHINE_ARCH} == "alpha" || ${MACHINE_ARCH} == "amd64" || \
    ${MACHINE_ARCH} == "sparc64" || ${MACHINE_ARCH:Mmips64*}
@


1.85
log
@python 2.6 is not longer but comment still valid for 2.7 so update accordingly.
@
text
@d1 1
a1 1
# $OpenBSD: Makefile.inc,v 1.84 2011/09/27 21:27:36 sthen Exp $
d79 8
a86 2
LIB_DEPENDS-bsddb =	databases/db/v4 \
			lang/python/${VERSION},-main
@


1.84
log
@let Python use PKGSPEC infrastructure, discussed with and variable name
suggestion from fgsch@@
@
text
@d1 1
a1 1
# $OpenBSD: Makefile.inc,v 1.83 2011/09/21 14:37:28 fgsch Exp $
d59 1
a59 1
# Python 2.6 lists BSD db 4.6.x as unstable on most architectures (see
@


1.83
log
@Merge in support for python3.
remi@@ sthen@@ ok
@
text
@d1 1
a1 1
# $OpenBSD: Makefile.inc,v 1.82 2011/09/06 20:58:08 rpointel Exp $
d18 16
a33 8
DISTNAME=	Python-${VERSION}${PATCHLEVEL}
PKGNAME-main=	python-${VERSION}${PATCHLEVEL}
PKGNAME-bsddb=	python-bsddb-${VERSION}${PATCHLEVEL}
PKGNAME-gdbm=	python-gdbm-${VERSION}${PATCHLEVEL}
PKGNAME-idle=	python-idle-${VERSION}${PATCHLEVEL}
PKGNAME-tests=	python-tests-${VERSION}${PATCHLEVEL}
PKGNAME-tkinter=	python-tkinter-${VERSION}${PATCHLEVEL}
PKGNAME-tools=	python-tools-${VERSION}${PATCHLEVEL}
@


1.82
log
@Use system libffi on Python 2.5 and 2.7 (except on arm).
ok jasper@@ landry@@ sthen@@.
@
text
@d1 1
a1 1
# $OpenBSD: Makefile.inc,v 1.81 2011/07/18 15:32:18 naddy Exp $
d43 2
d46 4
d53 1
a53 1
.if ${VERSION} == "2.6" || ${VERSION} == "2.7"
d66 1
a66 1
.if ${VERSION} == "2.5" || ${VERSION} == "2.6" || ${VERSION} == "2.7"
d73 1
a73 1
WANTLIB-bsddb =		lib/db4/db>=4 python${VERSION}
d76 1
a76 1
WANTLIB-gdbm =		gdbm>=3 python${VERSION}
d83 1
a83 1
WANTLIB-tkinter =	X11 ${MODTK_WANTLIB} python${VERSION}
d85 1
d93 1
d120 1
d122 1
d135 2
a136 2
ADJ_FILES = ${WRKSRC}/Tools/scripts/pydoc
.if ${VERSION} == "2.6" || ${VERSION} == "2.7"
d146 1
d154 1
d158 1
a158 1
.if ${VERSION} == "2.6" || ${VERSION} == "2.7"
@


1.81
log
@fix build after after 4.9->5.0; with help from rpointel@@
@
text
@d1 1
a1 1
# $OpenBSD: Makefile.inc,v 1.80 2011/07/16 20:22:48 sthen Exp $
d87 4
a90 8
# XXX fix ctypes on powerpc for python2.6
# The ctypes module is not supported on all platforms (in particular, ARM)
.if ${VERSION} == "2.5" || ${VERSION} == "2.6" || ${VERSION} == "2.7"
.  if ${MACHINE_ARCH} == "i386" || ${MACHINE_ARCH} == "amd64" || \
      ${MACHINE_ARCH} == "sparc" || ${MACHINE_ARCH} == "sparc64" || \
      ${MACHINE_ARCH} == "alpha" || ${MACHINE_ARCH} == "m68k" || \
      ${MACHINE_ARCH:Mmips64*} || \
      ( ${MACHINE_ARCH} == "powerpc" && ( ${VERSION} != "2.6" && ${VERSION} != "2.7" ) )
d92 3
a94 3
.  else
PKG_ARGS+=	-Dctypes=0
.  endif
@


1.80
log
@Replace a dead MASTER_SITES mirror with a working one.
@
text
@d1 1
a1 1
# $OpenBSD: Makefile.inc,v 1.79 2011/05/30 21:11:44 rpointel Exp $
d121 1
a121 1
ALL_TARGET?=	everything ./Lib/plat-openbsd4
@


1.79
log
@Correct the wrong value of LDFLAGS (certain ports will need WANTLIB += ${MODPY_WANTLIB}).

Thanks for fgsch@@ for his patch-Modules_selectmodule_c to correct SIGBUS error on sparc64 (test_kqueue.py).

It's time make bulks of Python2.7 on as many archs as we can.

Thanks a lot.

ok sthen@@ aja@@
@
text
@d1 1
a1 1
# $OpenBSD: Makefile.inc,v 1.78 2011/05/23 06:42:02 jasper Exp $
d28 1
a28 1
		http://python.mirrors.pair.com/pub/${PSUBDIR}/
@


1.78
log
@Remove python-mode.el, it's now part of the emacs-python package.
It wasn't distributed anymore in the python distfile starting from 2.7 anymore.

Please install the emacs-python pacakge to continue using the functionality.

ok rpointel@@
@
text
@d1 1
a1 1
# $OpenBSD: Makefile.inc,v 1.77 2011/05/03 17:52:04 rpointel Exp $
d65 6
a70 4
LIB_DEPENDS-bsddb =	databases/db/v4
WANTLIB-bsddb =		lib/db4/db>=4
LIB_DEPENDS-gdbm =	databases/gdbm
WANTLIB-gdbm =		gdbm>=3
d75 3
a77 2
LIB_DEPENDS-tkinter =	${MODTK_LIB_DEPENDS}
WANTLIB-tkinter =	X11 ${MODTK_WANTLIB}
d113 1
a113 1
		LDFLAGS='-L${WRKSRC}' SVNVERSION=no \
d118 1
@


1.77
log
@Removed AUTOCONF_VERSION?= now we have the correct AUTOCONF_VERSION in each version of Python.
From Brad, ok sthen@@.
@
text
@d1 1
a1 1
# $OpenBSD: Makefile.inc,v 1.76 2011/05/03 17:14:43 fgsch Exp $
a145 5
.if ${VERSION} == "2.5" || ${VERSION} == "2.6"
	${INSTALL_DATA_DIR} ${PREFIX}/share/emacs/site-lisp
	${INSTALL_DATA} ${WRKSRC}/Misc/python-mode.el \
		${PREFIX}/share/emacs/site-lisp/python-mode-${VERSION}.el
.endif
@


1.76
log
@adjust interpreter path for 2to3 and install it under pythonVERSION-2to3.
discussed with rpointel, rpointel sthen martynas ok.
@
text
@d1 1
a1 1
# $OpenBSD: Makefile.inc,v 1.75 2011/04/24 09:19:01 rpointel Exp $
a99 1
AUTOCONF_VERSION?=	2.61
@


1.75
log
@Prepare import of python 2.7.
(Not linked to the build, and not made the default python).
ok landry@@, fgsch@@.
@
text
@d1 1
a1 1
# $OpenBSD: Makefile.inc,v 1.74 2011/04/12 19:28:13 kili Exp $
d126 5
d134 1
a134 1
		${WRKSRC}/Tools/scripts/pydoc
d151 4
@


1.74
log
@Whenever a package installs a script using #!/usr/bin/env, god kills
a kitten.

Let pydoc${VERSION} use #!${LOCALBASE}/bin/python${VERSION} instead
of $!/usr/bin/env python${VERSION}.

ok rpointel@@, sthen@@ (after some discussion wether post-build is
the proper target for this or not)
@
text
@d1 1
a1 1
# $OpenBSD: Makefile.inc,v 1.73 2010/11/26 14:50:10 espie Exp $
d47 1
a47 1
.if ${VERSION} == "2.6"
d60 1
a60 1
.if ${VERSION} == "2.5" || ${VERSION} == "2.6"
d86 1
a86 1
.if ${VERSION} == "2.5" || ${VERSION} == "2.6"
d91 1
a91 1
      ( ${MACHINE_ARCH} == "powerpc" && ${VERSION} != "2.6" )
@


1.73
log
@since db/v4 has db->=4,<5 as default, no need to specify it explicitly
@
text
@d1 1
a1 1
# $OpenBSD: Makefile.inc,v 1.72 2010/11/22 09:23:59 espie Exp $
d125 5
@


1.72
log
@missed some
@
text
@d1 1
a1 1
# $OpenBSD: Makefile.inc,v 1.71 2010/11/17 08:05:18 espie Exp $
d65 1
a65 1
LIB_DEPENDS-bsddb =	db->=4,<5:databases/db/v4
@


1.71
log
@new depends
@
text
@d1 1
a1 1
# $OpenBSD: Makefile.inc,v 1.70 2010/11/15 20:55:24 sthen Exp $
d53 1
a53 1
RUN_DEPENDS=		:${FULLPKGNAME-main}:lang/python/${VERSION},-main
@


1.70
log
@use tk.port.mk and move -tkinter to a more recent version of Tcl/Tk.
reads fine to fgsch@@
@
text
@d1 1
a1 1
# $OpenBSD: Makefile.inc,v 1.69 2010/11/07 19:12:42 espie Exp $
d56 1
a56 1
LIB_DEPENDS-main =	::archivers/bzip2
d61 1
a61 1
LIB_DEPENDS-main +=	::databases/sqlite3
d65 4
a68 4
LIB_DEPENDS-bsddb =	:db->=4,<5:databases/db/v4
WANTLIB-bsddb =		lib/db4/db.>=4
LIB_DEPENDS-gdbm =	::databases/gdbm
WANTLIB-gdbm =		gdbm.>=3
d70 1
a70 1
			::lang/python/${VERSION},-tkinter
@


1.69
log
@convert WANTLIB on geo/lang
@
text
@d1 1
a1 1
# $OpenBSD: Makefile.inc,v 1.68 2010/10/28 08:22:11 fgsch Exp $
d71 4
a74 3
LIB_DEPENDS-tkinter =	:tcl->=8.4,<8.5:lang/tcl/8.4 \
			:tk->=8.4,<8.5:x11/tk/8.4
WANTLIB-tkinter =	X11 tcl84 tk84
@


1.68
log
@Simplify and switch to REVISION.
From Alexandr Shadchin (firstname dot lastname at gmail dot com).
martynas@@ ok.
@
text
@d1 1
a1 1
# $OpenBSD: Makefile.inc,v 1.67 2010/10/24 21:24:04 ajacoutot Exp $
d56 4
a59 4
LIB_DEPENDS-main=	bz2::archivers/bzip2
RUN_DEPENDS-main=
WANTLIB-main=		ssl panelw m crypto c util z readline pthread \
			ncursesw stdc++ expat ossaudio
d61 2
a62 1
LIB_DEPENDS-main+=	sqlite3::databases/sqlite3
d65 5
a69 3
LIB_DEPENDS-bsddb=	lib/db4/db.>=4:db->=4,<5:databases/db/v4
LIB_DEPENDS-gdbm=	gdbm.>=3::databases/gdbm
RUN_DEPENDS-idle=	${RUN_DEPENDS} \
d71 3
a73 3
LIB_DEPENDS-tkinter=	tcl84:tcl->=8.4,<8.5:lang/tcl/8.4 \
			tk84:tk->=8.4,<8.5:x11/tk/8.4
WANTLIB-tkinter=	X11
@


1.67
log
@Remove USE_X11.
@
text
@d1 1
a1 1
# $OpenBSD: Makefile.inc,v 1.66 2010/09/16 22:34:08 fgsch Exp $
a17 1
PKGNAME-main=	python-${VERSION}${PATCHLEVEL}${PKG_PATCHLEVEL}
d19 7
d53 1
a53 1
RUN_DEPENDS=		:python-${VERSION}${PATCHLEVEL}${PKG_PATCHLEVEL}:lang/python/${VERSION},-main
d72 3
a74 8
FULLPKGNAME-bsddb=	python-bsddb-${VERSION}${PATCHLEVEL}${PKG_PATCHLEVEL}
FULLPKGNAME-gdbm=	python-gdbm-${VERSION}${PATCHLEVEL}${PKG_PATCHLEVEL}
FULLPKGNAME-idle=	python-idle-${VERSION}${PATCHLEVEL}${PKG_PATCHLEVEL}
FULLPKGNAME-tests=	python-tests-${VERSION}${PATCHLEVEL}${PKG_PATCHLEVEL}
FULLPKGNAME-tkinter=	python-tkinter-${VERSION}${PATCHLEVEL}${PKG_PATCHLEVEL}
FULLPKGNAME-tools=	python-tools-${VERSION}${PATCHLEVEL}${PKG_PATCHLEVEL}

.if ${MACHINE_ARCH} == "alpha" || ${MACHINE_ARCH} == "amd64" || ${MACHINE_ARCH} == "sparc64" || ${MACHINE_ARCH:Mmips64*}
d94 1
d96 1
a96 1
AUTOCONF_VERSION?=	2.59
d116 3
d134 3
a136 3
		${INSTALL_DATA_DIR} ${PREFIX}/share/emacs/site-lisp
		${INSTALL_DATA} ${WRKSRC}/Misc/python-mode.el \
			${PREFIX}/share/emacs/site-lisp/python-mode-${VERSION}.el
a142 1

@


1.66
log
@Update WANTLIB after ncurses update. While here remove unneeded pthread-stubs
and xcb from -tkinter.  With help from sthen@@
@
text
@d1 1
a1 1
# $OpenBSD: Makefile.inc,v 1.65 2010/09/03 19:20:06 sthen Exp $
a92 1
USE_X11=		Yes
@


1.65
log
@When knocking out a MULTI_PACKAGE on some arch, keep listing it in
MULTI_PACKAGES, and add an (ONLY|NOT)_FOR_ARCHS-subpkg=somearch, rather
than changing contents of the MULTI_PACKAGES variable.

Fixes dpb builds on !amd64/i386, because the bsddb package was
knocked out on other arch.

'please unfuck the fucking mess people only testing on i386 and
amd64 did' landry@@
@
text
@d1 1
a1 1
# $OpenBSD: Makefile.inc,v 1.64 2010/02/25 11:02:39 phessler Exp $
d52 2
a53 2
WANTLIB-main=		ssl panel m crypto c util z readline pthread \
			ncurses stdc++ expat ossaudio
d64 1
a64 1
WANTLIB-tkinter=	X11 pthread-stubs xcb
@


1.64
log
@Allow Python to build on loongson.  Bring in some libffi fixes, inspired
by jasper@@'s fixes to the libffi port.

Mark mips64 (aka, sgi) as BROKEN, as the build fails.  We'll look closer
at this after unlock.

OK jasper@@

ports is unlocked for a while only for those who have been informed.
@
text
@d1 1
a1 1
# $OpenBSD: Makefile.inc,v 1.63 2010/02/09 12:23:59 jasper Exp $
d37 1
a37 1
MULTI_PACKAGES=	-main -tests -tools -gdbm -idle -tkinter
d41 2
a42 3
.if ${VERSION} != "2.6" || \
    ${MACHINE_ARCH} == "amd64" || ${MACHINE_ARCH} == "i386"
MULTI_PACKAGES+=-bsddb
@


1.63
log
@- extend archtecture tests for mips64el

ok naddy@@ phessler@@
@
text
@d1 1
a1 1
# $OpenBSD: Makefile.inc,v 1.62 2009/11/22 22:53:19 jasper Exp $
d74 1
a74 1
.if ${MACHINE_ARCH} == "alpha" || ${MACHINE_ARCH} == "amd64" || ${MACHINE_ARCH} == "sparc64"
@


1.62
log
@- minor tweaks for mips64, none of the versions fully build, but at least
they're somewhat getting there.
- with the added patch, 2.5 gets as far as 2.6, and then fails terribly.

ok djm@@ (MAINTAINER)
@
text
@d1 1
a1 1
# $OpenBSD: Makefile.inc,v 1.61 2009/09/22 21:31:00 ajacoutot Exp $
d86 1
a86 1
      ${MACHINE_ARCH} == "mips64" || \
@


1.61
log
@Unbreak packaging of python2.6 on powerpc; ctypes module will need more
work.

ok djm@@
@
text
@d1 1
a1 1
# $OpenBSD: Makefile.inc,v 1.60 2009/08/10 17:31:07 kili Exp $
d86 1
@


1.60
log
@WANTLIB changes after xcb addition and bump.

For some unknown reason, I forgot to commit lang/*
this morning.
@
text
@d1 1
a1 1
# $OpenBSD: Makefile.inc,v 1.59 2009/06/25 01:49:54 jolan Exp $
d80 1
d86 1
a86 1
      ${MACHINE_ARCH} == "powerpc"
@


1.59
log
@avoid conflict in -tools subpackage
@
text
@d1 1
a1 1
# $OpenBSD: Makefile.inc,v 1.58 2009/03/09 23:09:19 espie Exp $
d65 1
a65 1
WANTLIB-tkinter=	X11
@


1.58
log
@a few spec fixes and assorted pkg bumps, more to come.
@
text
@d1 1
a1 1
# $OpenBSD: Makefile.inc,v 1.57 2009/01/01 21:03:27 djm Exp $
d131 1
a131 1
			${PREFIX}/share/emacs/site-lisp
@


1.57
log
@Updates and garbage collect all three Python ports:

    2.4.4 => 2.4.8
    2.5.2 => 2.5.4
    2.6 => 2.6.1

Python 2.4 and 2.5 lose their build knobs to match 2.6.

Removes no longer needed Python 2.5 security patches backported
from the release25-maint SVN branch.

Remove the -bz2 subpackage from all three versions. It is silly
to make a subpackage to avoid depending on something tiny and
compatibly licensed.

Python 2.4 and 2.5 lose their -expat subpackages; expat has been
in base for some time.

Python 2.5 loses its sqlite subpackge. Again, sqlite is tiny,
compatibly licensed and is depended upon by more and more
applications. This brings it into line with the 2.6 version.

Rework all three version's handling of setup.py. Rather than regex
replacing LOCALBASE and X11BASE into setup.py post-configure, these
are passed in though environment variables. Will save hours of
frustrated cursing familiar to anyone who has accidently used the
update-patches target after configure and had to go back and redo
all the substitutions.

Rework the patching of setup.py for 2.4 and 2.5 to be more like
what we do for 2.6. I.e. keep the diff minimal and avoid deleting
huge blocks of code, so the diff has a chance of applying without
massive hand-editing each patch release.

Fix .py paths in installed .pyc files (patch from eric@@)

feedback from several, particularly eric@@, ajacoutot@@ and Ingo
Schwarze; "get it in" ajacoutot@@
@
text
@d1 1
a1 1
# $OpenBSD: Makefile.inc,v 1.56 2008/10/18 11:55:57 djm Exp $
d59 1
a59 1
LIB_DEPENDS-bsddb=	lib/db4/db.>=4:db-4.*:databases/db/v4
d63 2
a64 2
LIB_DEPENDS-tkinter=	tcl84:tcl-8.4.*:lang/tcl/8.4 \
			tk84:tk-8.4.*:x11/tk/8.4
@


1.56
log
@Prepare for Python-2.6

Flip default ALL_TARGET to the one that will be used for current
and future (>=2.5) Python releases, move old default down into
2.3 and 2.4 Makefiles

Turn on a verbose retry when regress tests fail; saves messing with
LD_LIBRARY_PATH incantations to get them to rerun

Take maintainership
@
text
@d1 1
a1 1
# $OpenBSD: Makefile.inc,v 1.55 2008/05/10 17:10:24 deanna Exp $
a10 1
COMMENT-expat=	expat module for Python
a13 1
COMMENT-mpz=	GNU arbitrary magnitude integer module for Python
a16 2
COMMENT-sqlite=	sqlite database module for Python
COMMENT-bz2=	bz2 module for Python
d37 7
a43 6
.if ${VERSION} == "2.6"
# Build knobs are no longer supported
PSEUDO_FLAVORS=
.else
PSEUDO_FLAVORS=	no_expat no_gdbm no_idle no_mpz no_tkinter no_bsddb no_bz2 \
		no_sqlite
a45 4
FLAVOR?=

MULTI_PACKAGES=	-main -tests -tools

d48 1
a48 1
RUN_DEPENDS=	:python-${VERSION}${PATCHLEVEL}${PKG_PATCHLEVEL}:lang/python/${VERSION},-main
d51 1
d53 4
a56 4
WANTLIB-main=	ssl panel m crypto c util z readline pthread ncurses stdc++
.if ${VERSION} == "2.6"
WANTLIB-main+=		expat ossaudio
LIB_DEPENDS-main=	sqlite3.>=8.7::databases/sqlite3
a60 1
LIB_DEPENDS-bz2=	bz2::archivers/bzip2
a65 65
LIB_DEPENDS-mpz=	gmp::devel/gmp
WANTLIB-expat=		expat
LIB_DEPENDS-sqlite=	sqlite3.>=8.7::databases/sqlite3

SETUP_PY=	"s,!!LOCALBASE!!,${LOCALBASE},g" \
		"s,!!X11BASE!!,${X11BASE},g"

.if empty(FLAVOR:L:Mno_bsddb) && (${VERSION} == "2.5" || ${VERSION} == "2.6")
# Python 2.6 lists BSD db 4.6.x as unstable on most architectures (see
# setup.py:allow_db_version). XXX revisit if databases/db/v4 is updated to 4.7
. if ${VERSION} != "2.6" || \
     ( ${MACHINE_ARCH} == "amd64" || ${MACHINE_ARCH} == "i386" )
SETUP_PY+=	"s,!!USE_BSDDB!!,1,g"
MULTI_PACKAGES+=-bsddb
. endif
.else
SETUP_PY+=	"s,!!USE_BSDDB!!,0,g"
.endif

.if empty(FLAVOR:L:Mno_gdbm)
SETUP_PY+=	"s,!!USE_GDBM!!,1,g"
MULTI_PACKAGES+=-gdbm
.else
SETUP_PY+=	"s,!!USE_GDBM!!,0,g"
.endif

.if empty(FLAVOR:L:Mno_bz2)
SETUP_PY+=	"s,!!USE_BZ2!!,1,g"
MULTI_PACKAGES+=-bz2
.else
SETUP_PY+=	"s,!!USE_BZ2!!,0,g"
.endif

.if empty(FLAVOR:L:Mno_idle) && empty(FLAVOR:L:Mno_tkinter)
MULTI_PACKAGES+=-idle
.endif

.if empty(FLAVOR:L:Mno_tkinter)
USE_X11=	Yes
SETUP_PY+=	"s,!!USE_TKINTER!!,1,g"
MULTI_PACKAGES+=-tkinter
.else
SETUP_PY+=	"s,!!USE_TKINTER!!,0,g"
.endif

.if empty(FLAVOR:L:Mno_mpz) && ${VERSION} == "2.3"
SETUP_PY+=	"s,!!USE_MPZ!!,1,g"
MULTI_PACKAGES+=-mpz
.else
SETUP_PY+=	"s,!!USE_MPZ!!,0,g"
.endif

.if empty(FLAVOR:L:Mno_expat) && ${VERSION} != "2.6"
SETUP_PY+=	"s,!!USE_EXPAT!!,1,g"
MULTI_PACKAGES+=-expat
.else
SETUP_PY+=	"s,!!USE_EXPAT!!,0,g"
.endif

.if empty(FLAVOR:L:Mno_sqlite) && ${VERSION} == "2.5"
SETUP_PY+=	"s,!!USE_SQLITE!!,1,g"
MULTI_PACKAGES+=-sqlite
.else
SETUP_PY+=	"s,!!USE_SQLITE!!,0,g"
.endif
a66 1
FULLPKGNAME-expat=	python-expat-${VERSION}${PATCHLEVEL}${PKG_PATCHLEVEL}
a69 1
FULLPKGNAME-mpz=	python-mpz-${VERSION}${PATCHLEVEL}${PKG_PATCHLEVEL}
a72 17
FULLPKGNAME-sqlite=	python-sqlite-${VERSION}${PATCHLEVEL}${PKG_PATCHLEVEL}
FULLPKGNAME-bz2=	python-bz2-${VERSION}${PATCHLEVEL}${PKG_PATCHLEVEL}

AUTOCONF_VERSION?=2.59
CONFIGURE_STYLE=autoconf
CONFIGURE_ARGS+=${CONFIGURE_SHARED}
# --srcdir is needed for systrace to work correctly
CONFIGURE_ARGS+=--with-fpectl --with-threads --srcdir=${WRKSRC}
CONFIGURE_ARGS+=--enable-ipv6

# THREAD_STACK_SIZE value might be changed by particular python release
THREAD_STACK_SIZE?=0x20000

REGRESS_TARGET=	test
REGRESS_FLAGS=	"EXTRATESTOPTS=-w"
# Some regress tests write to $HOME
PORTHOME=	${WRKDIR}
d92 12
d105 5
a109 4
		LDFLAGS='-L${WRKSRC}' \
		SVNVERSION=no
MAKE_FLAGS+=	LDLIBRARY=libpython${VERSION}.so.${LIBpython${VERSION}_VERSION} \
		LD_LIBRARY_PATH=${WRKSRC} PATH="${WRKDIST}:${PORTPATH}"
a115 3
	for i in ${SETUP_PY}; do \
		perl -pi -e "$$i" ${WRKSRC}/setup.py; \
	done
d133 5
@


1.55
log
@Let 2.5 install python-mode for emacs.

ok mbalmer@@
@
text
@d1 1
a1 1
# $OpenBSD: Makefile.inc,v 1.54 2008/02/27 00:30:47 djm Exp $
d32 1
a32 1
MAINTAINER=	Aleksander Piotrowski <alek@@openbsd.org>
d41 4
d47 2
d60 4
d80 5
a84 1
.if empty(FLAVOR:L:Mno_bsddb) && ${VERSION} == "2.5"
d87 1
d125 1
a125 1
.if empty(FLAVOR:L:Mno_expat)
d161 3
d172 1
a172 1
.if ${VERSION} == "2.5"
d190 1
a190 1
ALL_TARGET?=	all ${WRKSRC}/Lib/plat-openbsd4
d209 1
a209 1
.if ${VERSION} == 2.5
@


1.54
log
@python-2.5.2

tested with a full ports build by naddy@@ ok pvalchev@@
@
text
@d1 1
a1 1
# $OpenBSD: Makefile.inc,v 1.53 2008/01/04 17:48:36 espie Exp $
d191 6
@


1.53
log
@tweak FAKE_FLAGS semantics to saner defaults.
@
text
@d1 1
a1 1
# $OpenBSD: Makefile.inc,v 1.52 2007/10/30 13:35:18 steven Exp $
d27 1
a27 1
PSUBDIR=	python/${VERSION}${PATCHLEVEL}
d172 1
a172 1
ALL_TARGET=	all ${WRKSRC}/Lib/plat-openbsd4
@


1.52
log
@build bsddb interface only with python 2.5, since older python versions
ship a bsddb that doesn't work with berkeley db > 4.2.

discussed with sturm and sthen
@
text
@d1 1
a1 1
# $OpenBSD: Makefile.inc,v 1.51 2007/10/25 21:05:33 steven Exp $
d170 1
a170 2
FAKE_FLAGS+=	LDLIBRARY=libpython${VERSION}.so.${LIBpython${VERSION}_VERSION} \
		LD_LIBRARY_PATH=${WRKSRC} RANLIB=:
@


1.51
log
@db.=4 -> db.>=4  in preparation of db4 update

ok sthen@@
@
text
@d1 1
a1 1
# $OpenBSD: Makefile.inc,v 1.50 2007/10/20 06:55:54 espie Exp $
d70 1
a70 1
.if empty(FLAVOR:L:Mno_bsddb)
@


1.50
log
@hidden build depend on subversion, if it's around
@
text
@d1 1
a1 1
# $OpenBSD: Makefile.inc,v 1.49 2007/09/26 14:02:23 alek Exp $
d55 1
a55 1
LIB_DEPENDS-bsddb=	lib/db4/db.=4:db-4.*:databases/db/v4
@


1.49
log
@AUTOCONF_VERSION is supposed to be overwritten for particular version of python so replace = with ?= in Makefile.inc to make it possible; ok sturm@@, steven@@
@
text
@d1 1
a1 1
# $OpenBSD: Makefile.inc,v 1.48 2007/09/16 00:27:06 merdely Exp $
d166 2
a167 1
		LDFLAGS='-L${WRKSRC}'
@


1.48
log
@Remove surrounding quotes in COMMENT*/PERMIT_*/BROKEN
@
text
@d1 1
a1 1
# $OpenBSD: Makefile.inc,v 1.47 2007/05/07 15:43:33 jasper Exp $
d135 1
a135 1
AUTOCONF_VERSION=2.59
@


1.47
log
@fix WANTLIB/LIB_DEPENDS

ok alek@@ mbalmer@@
@
text
@d1 1
a1 1
# $OpenBSD: Makefile.inc,v 1.46 2007/04/28 10:06:24 bernd Exp $
d10 11
a20 11
COMMENT-main=	"interpreted object-oriented programming language"
COMMENT-expat=	"expat module for Python"
COMMENT-bsddb=	"Berkeley db module for Python"
COMMENT-gdbm=	"GNU dbm module for Python"
COMMENT-idle=	"IDE for Python"
COMMENT-mpz=	"GNU arbitrary magnitude integer module for Python"
COMMENT-tests=	"Python test suite"
COMMENT-tkinter="tk GUI module for Python"
COMMENT-tools=	"extra tools for Python"
COMMENT-sqlite=	"sqlite database module for Python"
COMMENT-bz2=	"bz2 module for Python"
@


1.46
log
@Use xenocara expat.
@
text
@d1 1
a1 1
# $OpenBSD: Makefile.inc,v 1.45 2007/01/10 16:57:56 steven Exp $
d60 3
a62 2
LIB_DEPENDS-tkinter=	tk84:tk-8.4.*:x11/tk/8.4
WANTLIB-tkinter=	tcl84 X11
@


1.45
log
@- update to python 2.3.6
- build python with CXX, fixes problems with extensions that use CXX
  such as the py-wxWidgets problem spotted by john.danks at gmail.com

from alek@@ some time ago
@
text
@d1 1
a1 1
# $OpenBSD: Makefile.inc,v 1.44 2006/11/24 20:48:23 steven Exp $
d63 1
a63 1
LIB_DEPENDS-expat=	expat.>=4.0:expat->=1.95.6:textproc/expat
@


1.44
log
@new MULTI_PACKAGES
@
text
@d1 1
a1 1
# $OpenBSD: Makefile.inc,v 1.43 2006/11/13 11:20:25 steven Exp $
d53 1
a53 1
WANTLIB-main=	ssl panel m crypto c util z readline pthread ncurses
@


1.43
log
@USE_X11
@
text
@d1 1
a1 1
# $OpenBSD: Makefile.inc,v 1.42 2006/11/08 19:00:19 djm Exp $
d10 1
a10 1
COMMENT=	"interpreted object-oriented programming language"
d22 1
a22 1
PKGNAME=	python-${VERSION}${PATCHLEVEL}${PKG_PATCHLEVEL}
d45 1
a45 2
MULTI_PACKAGES=	-tests -tools
SUBPACKAGE?=
d49 1
a49 3
.if defined(PACKAGING)
.  if !empty(SUBPACKAGE)
RUN_DEPENDS=	:python-${VERSION}${PATCHLEVEL}${PKG_PATCHLEVEL}:lang/python/${VERSION}
d51 14
a64 4
.  else
WANTLIB=	ssl panel m crypto c util z readline pthread ncurses
.  endif 
.endif
a71 3
.  if !defined(PACKAGING) || ${SUBPACKAGE} == "-bsddb"
LIB_DEPENDS+=	lib/db4/db.=4:db-4.*:databases/db/v4
.  endif
a78 3
.  if !defined(PACKAGING) || ${SUBPACKAGE} == "-gdbm"
LIB_DEPENDS+=	gdbm.>=3::databases/gdbm
.  endif
a85 3
.  if !defined(PACKAGING) || ${SUBPACKAGE} == "-bz2"
LIB_DEPENDS+=	bz2::archivers/bzip2
.  endif
a93 10
.if defined(PACKAGING)
.  if ${SUBPACKAGE} == "-idle"
RUN_DEPENDS+=	::lang/python/${VERSION},-tkinter
LIB_DEPENDS=
.  endif
.  if ${SUBPACKAGE} == "-tools" || ${SUBPACKAGE} == "-test"
LIB_DEPENDS=
.  endif
.endif

a97 4
.  if !defined(PACKAGING) || ${SUBPACKAGE} == "-tkinter"
LIB_DEPENDS+=	tk84:tk-8.4.*:x11/tk/8.4
WANTLIB=	tcl84 X11
.  endif
a104 3
.  if !defined(PACKAGING) || ${SUBPACKAGE} == "-mpz"
LIB_DEPENDS+=	gmp::devel/gmp
.  endif
a111 3
.  if !defined(PACKAGING) || ${SUBPACKAGE} == "-expat"
LIB_DEPENDS+=	expat.>=4.0:expat->=1.95.6:textproc/expat
.  endif
a118 3
.  if !defined(PACKAGING) || ${SUBPACKAGE} == "-sqlite"
LIB_DEPENDS+=	sqlite3.>=8.7::databases/sqlite3
.  endif
@


1.42
log
@fix compilation on ARM, where the ctypes module is not supported by
moving it into a new PFRAG; feedback and ok alek@@
@
text
@d1 1
a1 1
# $OpenBSD: Makefile.inc,v 1.41 2006/11/01 21:11:55 alek Exp $
d107 1
@


1.41
log
@Switch from Setup files to setup.py; add new subpackages
@
text
@d1 1
a1 1
# $OpenBSD: Makefile.inc,v 1.40 2006/10/10 19:08:06 alek Exp $
d174 12
@


1.40
log
@SHARED_ONLY, part one
@
text
@d1 1
a1 1
# $OpenBSD: Makefile.inc,v 1.39 2006/10/02 20:29:40 alek Exp $
d19 2
d41 2
a42 1
PSEUDO_FLAVORS=	no_expat no_gdbm no_idle no_mpz no_tkinter no_bsddb
a47 2
LIB_DEPENDS=	bz2::archivers/bzip2

d55 1
a55 2
WANTLIB=	ssl curses termcap panel m crypto c util z readline pthread \
		ncurses stdc++
d59 3
d63 2
a64 2
SETUP_LOCAL+=		Setup.bsddb
MULTI_PACKAGES+=	-bsddb
d66 1
a66 1
LIB_DEPENDS+=		lib/db4/db.=4:db-4.*:databases/db/v4
d68 2
d73 2
a74 2
SETUP_LOCAL+=		Setup.gdbm
MULTI_PACKAGES+=	-gdbm
d76 11
a86 1
LIB_DEPENDS+=		gdbm.>=3::databases/gdbm
d88 2
d93 1
a93 1
MULTI_PACKAGES+=	-idle
d96 8
a103 2
.if defined(PACKAGING) && ${SUBPACKAGE} == "-idle"
RUN_DEPENDS+=		::lang/python/${VERSION},-tkinter
d107 2
a108 3
SETUP_LOCAL+=		Setup.tkinter
PKG_ARGS+=		-Dtkinter=1
MULTI_PACKAGES+=	-tkinter
d110 2
a111 2
LIB_DEPENDS+=		tk84:tk-8.4.*:x11/tk/8.4
WANTLIB=		tcl84 X11
d114 1
a114 1
PKG_ARGS+=		-Dtkinter=0
d118 2
a119 2
SETUP_LOCAL+=		Setup.mpz
MULTI_PACKAGES+= 	-mpz
d121 1
a121 1
LIB_DEPENDS+=		gmp::devel/gmp
d123 2
d128 2
a129 2
SETUP_LOCAL+=		Setup.expat
MULTI_PACKAGES+= 	-expat
d131 1
a131 1
LIB_DEPENDS+=		expat.>=4.0:expat->=1.95.6:textproc/expat
d133 12
d155 2
d158 3
a160 3
AUTOCONF_VERSION=	2.57
CONFIGURE_STYLE=	autoconf
CONFIGURE_ARGS+=	${CONFIGURE_SHARED}
d162 2
a163 2
CONFIGURE_ARGS+=	--with-fpectl --with-threads --srcdir=${WRKSRC}
CONFIGURE_ARGS+=	--enable-ipv6
d166 1
a166 1
THREAD_STACK_SIZE?=    0x20000
a170 1
NO64BIT=	\#
a185 5
	@@sed -e 's,@@NO64BIT@@,${NO64BIT},g'   \
		${FILESDIR}/Setup > ${WRKSRC}/Modules/Setup
.for file in ${SETUP_LOCAL}
	@@cat ${FILESDIR}/${file} >> ${WRKSRC}/Modules/Setup.local
.endfor
d187 3
@


1.39
log
@Set PKG_ARGS while setting NO64BIT
@
text
@d1 1
a1 1
# $OpenBSD: Makefile.inc,v 1.38 2006/10/02 18:54:09 alek Exp $
d8 2
d39 1
a39 1
FLAVORS=	no_expat no_gdbm no_idle no_mpz no_tkinter no_bsddb
a58 6
# On architectures with shared libs, no_xxx flavors are a convenient
# way to avoid pulling in dependencies, and don't actually show up
# in the final package names.  On architectures without shared libs,
# no_xxx flavors dictate what gets linked into the Python binary.

# this cannot be put into 2.3/Makefile due to NO_SHARED_LIBS vs MULTI_PACKAGES
a59 1
BUILD_DEPENDS+=		::databases/db/v4
a60 1
.  if !defined(NO_SHARED_LIBS) || ${NO_SHARED_LIBS:U} != YES
d62 1
a62 1
.  else
a66 4
.if defined(PACKAGING) && ${SUBPACKAGE} == "-bsddb"
LIB_DEPENDS=		lib/db4/db.=4:db-4.*:databases/db/v4
.endif

a67 1
BUILD_DEPENDS+=		::databases/gdbm
a68 1
.  if !defined(NO_SHARED_LIBS) || ${NO_SHARED_LIBS:U} != YES
d70 1
a70 1
.  else
a74 4
.if defined(PACKAGING) && ${SUBPACKAGE} == "-gdbm"
LIB_DEPENDS=		gdbm.>=3::databases/gdbm
.endif

a75 1
.  if !defined(NO_SHARED_LIBS) || ${NO_SHARED_LIBS:U} != YES
a76 1
.  endif
a83 1
BUILD_DEPENDS+=		::x11/tk/8.4
a85 1
.  if !defined(NO_SHARED_LIBS) || ${NO_SHARED_LIBS:U} != YES
d87 1
a87 1
.  else
d89 1
a94 5
.if defined(PACKAGING) && ${SUBPACKAGE} == "-tkinter"
LIB_DEPENDS=		tk84:tk-8.4.*:x11/tk/8.4
WANTLIB=		tcl84 X11
.endif

a95 1
BUILD_DEPENDS+=		::devel/gmp
a96 1
.  if !defined(NO_SHARED_LIBS) || ${NO_SHARED_LIBS:U} != YES
d98 1
a98 1
.  else
a102 4
.if defined(PACKAGING) && ${SUBPACKAGE} == "-mpz"
LIB_DEPENDS=		gmp::devel/gmp
.endif

a103 2
.  if ${VERSION} == "2.3"
BUILD_DEPENDS+=		::textproc/expat
a104 2
.  endif
.  if !defined(NO_SHARED_LIBS) || ${NO_SHARED_LIBS:U} != YES
d106 1
a106 1
.  else if ${VERSION} == "2.3"
a110 11
.if defined(PACKAGING) && ${SUBPACKAGE} == "-expat" && ${VERSION} == "2.3"
LIB_DEPENDS=		expat.>=4.0:expat->=1.95.6:textproc/expat
.endif

# Strip off no_xxx flavors from the package name if we are not
# building the "monster" Python for platforms without shared libraries.

.if !defined(NO_SHARED_LIBS) || ${NO_SHARED_LIBS:U} != YES
FULLPKGNAME=${PKGNAME}${FLAVOR_EXT:S/-no_bsddb//:S/-no_expat//:S/-no_gdbm//:S/-no_idle//:S/-no_mpz//:S/-no_tkinter//}
.endif

a138 4
.if defined(NO_SHARED_LIBS) && ${NO_SHARED_LIBS:U} == YES
NOSHARED=	\#
CONFIGURE_ENV+=	OPT='${CFLAGS}' LDFLAGS='-L${WRKSRC}'
.else
a144 1
.endif
d149 1
a149 2
	@@sed -e 's,@@NOSHARED@@,${NOSHARED},g' \
	     -e 's,@@NO64BIT@@,${NO64BIT},g'   \
d152 1
a152 2
	@@sed -e 's,@@NOSHARED@@,${NOSHARED},g' \
		${FILESDIR}/${file} >> ${WRKSRC}/Modules/Setup.local
@


1.38
log
@Zap no_tests and no_tools flavors.  Packages -tools and -tests don't
depend on other packages besides main python package so there is no reason
to not to build them by default.
@
text
@d1 1
a1 1
# $OpenBSD: Makefile.inc,v 1.37 2006/08/03 19:56:08 espie Exp $
d179 1
a179 4
.endif

.if defined(NO64BIT)
PKG_ARGS+=-Dmm=0
d181 1
a181 1
PKG_ARGS+=-Dmm=1
@


1.37
log
@more new lib specs
@
text
@d1 1
a1 1
# $OpenBSD: Makefile.inc,v 1.36 2006/07/28 22:36:41 steven Exp $
d37 1
a37 2
FLAVORS=	no_expat no_gdbm no_idle no_mpz no_tkinter no_bsddb \
		no_tests no_tools
d40 1
a40 1
MULTI_PACKAGES?=
a42 8
.if empty(FLAVOR:L:Mno_tests)
MULTI_PACKAGES+=-tests
.endif

.if empty(FLAVOR:L:Mno_tools)
MULTI_PACKAGES+=-tools
.endif

d153 1
a153 1
FULLPKGNAME=${PKGNAME}${FLAVOR_EXT:S/-no_bsddb//:S/-no_expat//:S/-no_gdbm//:S/-no_idle//:S/-no_mpz//:S/-no_tkinter//:S/-no_tools//:S/-no_tests//}
@


1.36
log
@unbreak python build on 4.0, bump PKGNAMEs.

"fine" sturm@@, "ok if it works" alek@@
@
text
@d1 1
a1 1
# $OpenBSD: Makefile.inc,v 1.35 2005/12/27 19:41:21 alek Exp $
d92 1
a92 1
LIB_DEPENDS+=		gdbm.3::databases/gdbm
d97 1
a97 1
LIB_DEPENDS=		gdbm.3::databases/gdbm
d150 1
a150 1
LIB_DEPENDS+=		expat.4.0:expat->=1.95.6:textproc/expat
d155 1
a155 1
LIB_DEPENDS=		expat.4.0:expat->=1.95.6:textproc/expat
@


1.35
log
@- Better RUN_DEPENDS for subpackages
- Use SHARED_LIBS
- Bump PKGNAMEs

spotted by naddy@@ and sturm@@
SHARED_LIBS tips from espie@@
@
text
@d1 1
a1 1
# $OpenBSD: Makefile.inc,v 1.34 2005/12/17 12:45:39 alek Exp $
d208 1
a208 1
ALL_TARGET=	all ${WRKSRC}/Lib/plat-openbsd3
@


1.34
log
@- Add no_tests and no_tools FLAVORS, just like it's mentioned in DESCR file
- Better RUN_DEPENDS for subpackages
- Build expat subpackage for all versions of python
@
text
@d1 1
a1 1
# $OpenBSD: Makefile.inc,v 1.33 2005/11/11 09:45:29 alek Exp $
d58 1
a58 1
RUN_DEPENDS=	:python-${VERSION}${PATCHLEVEL}:lang/python/${VERSION}
d202 1
a202 1
MAKE_FLAGS+=	MAJOR=0 MINOR=0 LDLIBRARY=libpython${VERSION}.so.0.0 \
d204 1
a204 1
FAKE_FLAGS+=	MAJOR=0 MINOR=0 LDLIBRARY=libpython${VERSION}.so.0.0 \
a227 5
	${INSTALL_DATA} ${WRKSRC}/libpython${VERSION}.a \
		${PREFIX}/lib/python${VERSION}/config
	@@if [ -f ${PREFIX}/lib/python${VERSION}/config/libpython${VERSION}.so.0.0 ]; then \
		cd ${PREFIX}/lib && ln -s python${VERSION}/config/libpython${VERSION}.so.0.0; \
	fi
a230 1

@


1.33
log
@Fix MASTER_SITES
@
text
@d1 1
a1 1
# $OpenBSD: Makefile.inc,v 1.32 2005/06/06 20:47:04 alek Exp $
d37 2
a38 1
FLAVORS+=	no_expat no_gdbm no_idle no_mpz no_tkinter no_bsddb
d41 1
a41 1
MULTI_PACKAGES=	-tests -tools
d44 8
d58 1
a58 1
RUN_DEPENDS=	::lang/python/${VERSION}
d142 2
a143 1
.if empty(FLAVOR:L:Mno_expat) && ${VERSION} == "2.3"
d146 1
d149 1
a149 1
.  else
d154 1
a154 1
.if defined(PACKAGING) && ${SUBPACKAGE} == "-expat"
d162 1
a162 1
FULLPKGNAME=${PKGNAME}${FLAVOR_EXT:S/-no_bsddb//:S/-no_expat//:S/-no_gdbm//:S/-no_idle//:S/-no_mpz//:S/-no_tkinter//}
@


1.32
log
@Mpz and expat modules only work with python 2.3
@
text
@d1 1
a1 1
# $OpenBSD: Makefile.inc,v 1.31 2005/05/23 20:39:36 alek Exp $
d21 2
a22 3
MASTER_SITES=	ftp://ftp.python.org/pub/${PSUBDIR}/ \
		http://python.mirrors.pair.com/ftp/${PSUBDIR}/ \
		http://python.mirrors.ilisys.com.au/ftp/${PSUBDIR}/
@


1.31
log
@- Move stuff around in preparation for python 2.4
- Better WANTLIB marker for base package
@
text
@d1 1
a1 1
# $OpenBSD: Makefile.inc,v 1.30 2005/03/03 23:20:47 alek Exp $
d105 1
a105 1
PKG_ARGS+=-Dtkinter=1
d112 1
a112 1
PKG_ARGS+=-Dtkinter=0
d120 1
a120 1
.if empty(FLAVOR:L:Mno_mpz)
d134 1
a134 1
.if empty(FLAVOR:L:Mno_expat)
@


1.30
log
@Better dependencies for (sub)packages
@
text
@d1 1
a1 1
# $OpenBSD: Makefile.inc,v 1.29 2005/02/24 13:20:41 alek Exp $
d10 1
d38 1
a38 1
FLAVORS+=	no_expat no_gdbm no_idle no_mpz no_tkinter
d44 2
d54 1
a54 1
		${WANTLIB-extra}
d64 1
a64 1
.if ${VERSION} == "2.3" &&  empty(FLAVOR:L:Mno_bsddb)
d156 1
d164 2
a165 1
CONFIGURE_STYLE?=	autoconf dest no-autoheader
d169 1
@


1.29
log
@Add/fix WANTLIB markers
@
text
@d1 1
a1 1
# $OpenBSD: Makefile.inc,v 1.28 2005/01/12 21:31:06 sturm Exp $
d45 5
a49 3
.if defined(PACKAGING) && !empty(SUBPACKAGE)
RUN_DEPENDS=		::lang/python/${VERSION}
.else
d52 1
d72 1
a72 1
LIB_DEPENDS+=		lib/db4/db.=4:db-4.*:databases/db/v4
d86 1
a86 1
LIB_DEPENDS+=		gdbm.3::databases/gdbm
d113 1
a113 1
LIB_DEPENDS+=		tk84:tk-8.4.*:x11/tk/8.4
d128 1
a128 1
LIB_DEPENDS+=		gmp::devel/gmp
d142 1
a142 1
LIB_DEPENDS+=		expat.4.0:expat->=1.95.6:textproc/expat
@


1.28
log
@better and consistent LIB_DEPENDS on db; this fixes a few possible
build time failures, where the wrong version of db could be found
@
text
@d1 1
a1 1
# $OpenBSD: Makefile.inc,v 1.27 2004/12/30 12:06:22 espie Exp $
d47 3
d111 1
@


1.27
log
@repair some dependency paths.
@
text
@d1 1
a1 1
# $OpenBSD: Makefile.inc,v 1.26 2004/12/21 11:30:39 espie Exp $
d61 1
a61 1
LIB_DEPENDS+=		lib/db4/db.4:db-4.*:databases/db/v4
d66 1
a66 1
LIB_DEPENDS+=		lib/db4/db.4:db-4.*:databases/db/v4
@


1.26
log
@fix dependency.
@
text
@d1 1
a1 1
# $OpenBSD: Makefile.inc,v 1.25 2004/11/16 02:10:56 espie Exp $
d66 1
a66 1
LIB_DEPENDS+=		lib/db4/db.4::databases/db/v4
@


1.25
log
@Fix tk dependency
@
text
@d1 1
a1 1
# $OpenBSD: Makefile.inc,v 1.24 2004/11/04 22:16:07 alek Exp $
d61 1
a61 1
LIB_DEPENDS+=		lib/db4/db.4::databases/db/v4
@


1.24
log
@Update my email address

ok pvalchev@@
@
text
@d1 1
a1 1
# $OpenBSD: Makefile.inc,v 1.23 2004/09/15 19:16:08 espie Exp $
d100 1
a100 1
LIB_DEPENDS+=		tk84::x11/tk/8.4
d107 1
a107 1
LIB_DEPENDS+=		tk84::x11/tk/8.4
@


1.23
log
@new plists.
some fragment games with python.
@
text
@d1 1
a1 1
# $OpenBSD: Makefile.inc,v 1.22 2004/08/08 15:38:00 xsa Exp $
d28 1
a28 1
MAINTAINER=	Aleksander Piotrowski <aleksander.piotrowski@@nic.com.pl>
@


1.22
log
@
increase THREAD_STACK_SIZE for use with www/zope;
>From: MAINTAINER.
@
text
@d1 1
a1 1
# $OpenBSD: Makefile.inc,v 1.21 2004/05/15 06:43:23 sturm Exp $
d96 1
a98 2
SED_PLIST+=		| sed -e '/^%%tkinter%%/d' \
			| sed -e '/^%%tkinter_no_shared%%/r${PKGDIR}/PFRAG-tkinter.no_shared' -e '//d'
a99 1
SED_PLIST+=		| sed -e '/^%%tkinter%%/r${PKGDIR}/PFRAG-tkinter.no_shared' -e '//d'
d103 1
a103 1
SED_PLIST+=		| sed -e '/^%%tkinter%%/d'
d168 1
a168 1
SED_PLIST+=-e '/%%mm%%/d'
d170 1
a170 1
SED_PLIST+=-e '/%%mm%%/r${PKGDIR}/PFRAG.mm' -e '//d'
@


1.21
log
@fix srcdir to ${WRKSRC} in order to fix build with systrace
@
text
@d1 1
a1 1
# $OpenBSD: Makefile.inc,v 1.20 2004/04/18 12:13:58 sturm Exp $
d160 3
d179 1
a179 1
CONFIGURE_ENV+= OPT='${CFLAGS} -DTHREAD_STACK_SIZE=0x20000 -fPIC' \
@


1.20
log
@- teach makesetup about -pthread
- better pthread handling in configure
- find python binary when running regression tests, even when no python
  is installed

from maintainer Aleksander Piotrowski <aleksander.piotrowski at nic.com.pl>
@
text
@d1 1
a1 1
# $OpenBSD: Makefile.inc,v 1.19 2004/04/06 02:39:23 brad Exp $
d157 2
a158 1
CONFIGURE_ARGS+=	--with-fpectl --with-threads
d184 1
a184 1
ALL_TARGET=	all ./Lib/plat-openbsd3
@


1.19
log
@add amd64, another 64bit target.
@
text
@d1 1
a1 1
# $OpenBSD: Makefile.inc,v 1.18 2004/03/04 17:49:26 espie Exp $
d178 1
a178 1
		LD_LIBRARY_PATH=${WRKSRC}
@


1.18
log
@explicitly tag no-autoheader some ports for which re-running it after autoconf
is a problem.
@
text
@d1 1
a1 1
# $OpenBSD: Makefile.inc,v 1.17 2004/02/27 21:04:50 pvalchev Exp $
d161 1
a161 1
.if ${MACHINE_ARCH} == "alpha" || ${MACHINE_ARCH} == "sparc64" || ${MACHINE_ARCH} == "amd64"
@


1.17
log
@fix amd64; from maintainer Aleksander Piotrowski <aleksander.piotrowski@@nic.com.pl>
@
text
@d1 1
a1 1
# $OpenBSD: Makefile.inc,v 1.16 2004/01/14 19:51:40 sturm Exp $
d155 1
a155 1
CONFIGURE_STYLE?=	autoconf dest
@


1.16
log
@better db4 LIB_DEPENDS
@
text
@d1 1
a1 1
# $OpenBSD: Makefile.inc,v 1.15 2004/01/08 21:11:22 sturm Exp $
d161 1
a161 1
.if ${MACHINE_ARCH} == "alpha" || ${MACHINE_ARCH} == "sparc64"
@


1.15
log
@fix braino in PATCH_LIST handling
@
text
@d1 1
a1 1
# $OpenBSD: Makefile.inc,v 1.14 2003/12/31 17:40:20 sturm Exp $
d54 1
a54 3
# this cannot be put into 2.3/Makefile due to NO_SHARED_LIBS being
# only defined in bsd.port.mk but MULTI_PACKAGES being already used
# in there, too
d61 1
a61 1
LIB_DEPENDS+=		db.4::databases/db/v4
d66 1
a66 1
LIB_DEPENDS+=		db.4:db->=4.1.25p0:databases/db/v4
@


1.14
log
@adapt to python 2.3
new subpackage -bsddb for python 2.3 only
@
text
@d1 1
a1 1
# $OpenBSD: Makefile.inc,v 1.13 2003/12/31 12:05:22 sturm Exp $
d163 1
a163 5
.if ${MACHINE_ARCH} == "alpha"
PATCH_LIST=	patch-* sup64-*
NO64BIT=	\#
.elif ${MACHINE_ARCH} == "sparc64"
PATCH_LIST=	patch-* sup64-* gcc-*
@


1.13
log
@this is a generic 64bit diff that applies to alpha, too
@
text
@d1 1
a1 1
# $OpenBSD: Makefile.inc,v 1.12 2003/12/30 17:05:30 sturm Exp $
d37 1
a37 1
FLAVORS=	no_expat no_gdbm no_idle no_mpz no_tkinter
d54 17
d146 1
a146 1
FULLPKGNAME=${PKGNAME}${FLAVOR_EXT:S/-no_expat//:S/-no_gdbm//:S/-no_idle//:S/-no_mpz//:S/-no_tkinter//}
d157 1
a157 1
CONFIGURE_STYLE=	autoconf dest
@


1.12
log
@more cleanups in preparation for 2.2 update and 2.3 import from
Aleksander Piotrowski <aleksander dot piotrowski at nic dot com dot pl>

- fix MASTER_SITES
- --without-pymalloc is not needed in 2.1 and 2.2 as it is disabled by default
  this will allow using it in 2.3
- some PREFIX -> LOCALBASE cleanup
- patch distributed pydoc instead of providing our own 3-liner
- some improvements on sparc64
- teach regression suite about openbsd
- regen some patch files
@
text
@d1 1
a1 1
# $OpenBSD: Makefile.inc,v 1.11 2003/12/27 23:36:09 jose Exp $
d146 5
a150 1
.if ${MACHINE_ARCH} == "alpha" || ${MACHINE_ARCH} == "sparc64"
a169 4
.endif

.if ${MACHINE_ARCH} == "sparc64"
PATCH_LIST=	patch-* gcc-*
@


1.11
log
@update to tcl/tk 8.4, ok brad@@ naddy@@
@
text
@d1 1
a1 1
# $OpenBSD: Makefile.inc,v 1.10 2003/12/13 15:03:07 sturm Exp $
d21 3
a23 3
		ftp://python.mirrors.netnumina.com/python/pub/${PSUBDIR}/ \
		http://www.linux.org.hk/mirror/python/ftp/${PSUBDIR}/
PSUBDIR= python/${VERSION}${PATCHLEVEL}
d117 1
a117 1
LIB_DEPENDS+=		expat::textproc/expat
d122 1
a122 1
LIB_DEPENDS+=		expat::textproc/expat
d140 3
a142 3
CONFIGURE_STYLE= autoconf dest
CONFIGURE_ARGS+= ${CONFIGURE_SHARED}
CONFIGURE_ARGS+= --with-fpectl --with-threads --without-pymalloc
d168 4
a173 2
patch:

d185 2
a186 1
	${INSTALL_SCRIPT} ${FILESDIR}/pydoc ${PREFIX}/bin/pydoc${VERSION}
a189 1
	@@strip ${PREFIX}/bin/python
@


1.10
log
@new packages -gdbm (GNU DBM support) and -idle (split from -tools)

from new maintainer Aleksander Piotrowski
<aleksander dot piotrowski at nic dot com dot pl>

more to come
@
text
@d1 1
a1 1
# $OpenBSD: Makefile.inc,v 1.9 2003/06/02 15:13:42 brad Exp $
d79 1
a79 1
BUILD_DEPENDS+=		::x11/tk/8.3
d87 1
a87 1
LIB_DEPENDS+=		tk83::x11/tk/8.3
d94 1
a94 1
LIB_DEPENDS+=		tk83::x11/tk/8.3
@


1.9
log
@the MAINTAINER should have been removed some time ago.
@
text
@d1 1
a1 1
# $OpenBSD: Makefile.inc,v 1.8 2002/10/08 02:52:25 brad Exp $
d9 4
d14 1
a15 3
COMMENT-mpz=	"GNU arbitrary magnitude integer module for Python"
COMMENT-tkinter="tk GUI module for Python"
COMMENT-expat=	"expat module for Python"
d28 2
d37 1
a37 1
FLAVORS=	no_mpz no_tkinter no_expat
d54 24
d129 1
a129 1
FULLPKGNAME=${PKGNAME}${FLAVOR_EXT:S/-no_mpz//:S/-no_tkinter//:S/-no_expat//}
d132 4
d137 1
a138 3
FULLPKGNAME-mpz=	python-mpz-${VERSION}${PATCHLEVEL}${PKG_PATCHLEVEL}
FULLPKGNAME-tkinter=	python-tkinter-${VERSION}${PATCHLEVEL}${PKG_PATCHLEVEL}
FULLPKGNAME-expat=	python-expat-${VERSION}${PATCHLEVEL}${PKG_PATCHLEVEL}
d184 3
@


1.8
log
@Fix security issue with Python 2.1/2.2

Zack Weinberg found a vulnerability in the way the exevpe() method
from the os.py module uses a temporary file name. A file which
supposedly should not exist is created in a unsafe way and the method
tries to execute it. The objective of such code is to discover what
error the operating system returns in a portable way.

By exploiting this vulnerability a local attacker can execute
arbitrary code with the privileges of the user running python code
which uses the execvpe() method.

http://python.org/sf/590294
http://python.org/sf/601077
@
text
@d1 1
a1 1
# $OpenBSD: Makefile.inc,v 1.7 2002/07/09 12:32:34 matt Exp $
a24 2

MAINTAINER=	Chris Humphries <chumphries@@drauku.net>
@


1.7
log
@taken by Chris Humphries <chumphries@@drauku.net>
@
text
@d1 1
a1 1
# $OpenBSD: Makefile.inc,v 1.6 2002/05/13 23:31:25 espie Exp $
d15 1
a15 1
PKGNAME=	python-${VERSION}${PATCHLEVEL}
d106 5
a110 5
FULLPKGNAME-tests=	python-tests-${VERSION}${PATCHLEVEL}
FULLPKGNAME-tools=	python-tools-${VERSION}${PATCHLEVEL}
FULLPKGNAME-mpz=	python-mpz-${VERSION}${PATCHLEVEL}
FULLPKGNAME-tkinter=	python-tkinter-${VERSION}${PATCHLEVEL}
FULLPKGNAME-expat=	python-expat-${VERSION}${PATCHLEVEL}
@


1.7.2.1
log
@Fix security issue with Python 2.1/2.2

Zack Weinberg found a vulnerability in the way the exevpe() method
from the os.py module uses a temporary file name. A file which
supposedly should not exist is created in a unsafe way and the method
tries to execute it. The objective of such code is to discover what
error the operating system returns in a portable way.

By exploiting this vulnerability a local attacker can execute
arbitrary code with the privileges of the user running python code
which uses the execvpe() method.

http://python.org/sf/590294
http://python.org/sf/601077
@
text
@d1 1
a1 1
# $OpenBSD: Makefile.inc,v 1.7 2002/07/09 12:32:34 matt Exp $
d15 1
a15 1
PKGNAME=	python-${VERSION}${PATCHLEVEL}${PKG_PATCHLEVEL}
d106 5
a110 5
FULLPKGNAME-tests=	python-tests-${VERSION}${PATCHLEVEL}${PKG_PATCHLEVEL}
FULLPKGNAME-tools=	python-tools-${VERSION}${PATCHLEVEL}${PKG_PATCHLEVEL}
FULLPKGNAME-mpz=	python-mpz-${VERSION}${PATCHLEVEL}${PKG_PATCHLEVEL}
FULLPKGNAME-tkinter=	python-tkinter-${VERSION}${PATCHLEVEL}${PKG_PATCHLEVEL}
FULLPKGNAME-expat=	python-expat-${VERSION}${PATCHLEVEL}${PKG_PATCHLEVEL}
@


1.6
log
@More MASTER_SITES_SUBDIR out
@
text
@d1 1
a1 1
# $OpenBSD: Makefile.inc,v 1.5 2002/05/11 21:35:13 matt Exp $
a17 1
NEED_VERSION=	1.527
d26 1
a26 1
MAINTAINER=	Matt Behrens <matt@@openbsd.org>
@


1.5
log
@- 2.2 -> 2.2.1
- annotate patches submitted to Python patch tracker
- 100% license compliance: install CHANGES.OpenBSD file
@
text
@d1 1
a1 1
# $OpenBSD: Makefile.inc,v 1.4 2002/03/23 04:34:22 matt Exp $
d19 4
a22 4
MASTER_SITES=	ftp://ftp.python.org/pub/%SUBDIR%/ \
		ftp://python.mirrors.netnumina.com/python/pub/%SUBDIR%/ \
		http://www.linux.org.hk/mirror/python/ftp/%SUBDIR%/
MASTER_SITE_SUBDIR= python/${VERSION}${PATCHLEVEL}
@


1.4
log
@fix dependencies
- subpackage @@pkgdep -> RUN_DEPENDS
- no no_tkinter shouldn't unconditionally add LIB_DEPENDS of tk
@
text
@d1 6
a6 1
# $OpenBSD: Makefile.inc,v 1.3 2002/02/25 21:25:37 matt Exp $
d9 1
a9 1
COMMENT-tests=	"Python testsuite"
d18 1
a18 1
NEED_VERSION=	1.504
d29 2
d48 4
a51 4
# On architectures with shared libs, no_xxx flavors are pretty much
# a convenient way to avoid pulling in dependencies, and don't actually
# show up in the final package names.  On architectures without shared
# libs, some no_xxx flavors mean something.
d62 1
d69 1
a69 1
LIB_DEPENDS=		tk83::x11/tk/8.3
d83 1
a83 1
LIB_DEPENDS=		gmp::devel/gmp
d97 1
a97 1
LIB_DEPENDS=		expat::textproc/expat
d100 2
a101 1
# Strip off no_xxx flavors from the package name.
d110 2
a111 2
FULLPKGNAME-tkinter=	python-tkinter-${VERSION}${PATCHLEVEL}${FLAVOR_EXT}
FULLPKGNAME-expat=	python-expat-${VERSION}${PATCHLEVEL}${FLAVOR_EXT}
d165 3
@


1.4.2.1
log
@Fix security issue with Python 2.1/2.2

Zack Weinberg found a vulnerability in the way the exevpe() method
from the os.py module uses a temporary file name. A file which
supposedly should not exist is created in a unsafe way and the method
tries to execute it. The objective of such code is to discover what
error the operating system returns in a portable way.

By exploiting this vulnerability a local attacker can execute
arbitrary code with the privileges of the user running python code
which uses the execvpe() method.

http://python.org/sf/590294
http://python.org/sf/601077
@
text
@d1 1
a1 1
# $OpenBSD: Makefile.inc,v 1.4 2002/03/23 04:34:22 matt Exp $
d4 1
a4 1
COMMENT-tests=	"Python test suite"
d10 1
a10 1
PKGNAME=	python-${VERSION}${PATCHLEVEL}${PKG_PATCHLEVEL}
d41 4
a44 4
# On architectures with shared libs, no_xxx flavors are a convenient
# way to avoid pulling in dependencies, and don't actually show up
# in the final package names.  On architectures without shared libs,
# no_xxx flavors dictate what gets linked into the Python binary.
a54 1
LIB_DEPENDS+=		tk83::x11/tk/8.3
d61 1
a61 1
LIB_DEPENDS+=		tk83::x11/tk/8.3
d75 1
a75 1
LIB_DEPENDS+=		gmp::devel/gmp
d89 1
a89 1
LIB_DEPENDS+=		expat::textproc/expat
d92 1
a92 2
# Strip off no_xxx flavors from the package name if we are not
# building the "monster" Python for platforms without shared libraries.
d98 5
a102 5
FULLPKGNAME-tests=	python-tests-${VERSION}${PATCHLEVEL}${PKG_PATCHLEVEL}
FULLPKGNAME-tools=	python-tools-${VERSION}${PATCHLEVEL}${PKG_PATCHLEVEL}
FULLPKGNAME-mpz=	python-mpz-${VERSION}${PATCHLEVEL}${PKG_PATCHLEVEL}
FULLPKGNAME-tkinter=	python-tkinter-${VERSION}${PATCHLEVEL}${PKG_PATCHLEVEL}
FULLPKGNAME-expat=	python-expat-${VERSION}${PATCHLEVEL}${PKG_PATCHLEVEL}
@


1.3
log
@Restore shared libpython.  The problem was that pthreads' 64k stack
size is not adequate for some of the complex processing that Zope
does, and -fPIC was aggravating that condition.  Now, if we're using
shared libs, up the stack size to 128k.

Also remove some stray files that never should have been committed
in the first place.
@
text
@d1 1
a1 1
# $OpenBSD: Makefile.inc,v 1.2 2002/02/15 19:55:14 matt Exp $
d35 6
d47 1
a47 1
LIB_DEPENDS+=		tk83::x11/tk/8.3
d61 1
a61 1
LIB_DEPENDS+=	tk83::x11/tk/8.3
d65 1
a65 1
BUILD_DEPENDS+=		gmp::devel/gmp
d75 1
a75 1
LIB_DEPENDS+=		gmp::devel/gmp
d79 1
a79 1
BUILD_DEPENDS+=		expat::textproc/expat
d89 1
a89 1
LIB_DEPENDS+=		expat::textproc/expat
@


1.2
log
@test code crept in, oops
@
text
@d1 1
a1 1
# $OpenBSD: Makefile.inc,v 1.1 2002/02/15 19:42:18 matt Exp $
a100 1
CONFIGURE_ENV+=  LDFLAGS='-L${WRKSRC}' OPT='${CFLAGS}' # -fPIC == Zope crash
d116 8
a123 7
#CONFIGURE_ENV+=  OPT='${CFLAGS} -fPIC' LDFLAGS='-L${WRKSRC}'
#.else
#CONFIGURE_ENV+= OPT='${CFLAGS} -fPIC' LDFLAGS='-L${WRKSRC}'
#MAKE_FLAGS+= MAJOR=0 MINOR=0 LDLIBRARY=libpython2.1.so.0.0 \
#	LD_LIBRARY_PATH=${WRKSRC}
#FAKE_FLAGS+= MAJOR=0 MINOR=0 LDLIBRARY=libpython2.1.so.0.0 \
#	LD_LIBRARY_PATH=${WRKSRC} RANLIB=:
d126 1
a126 1
#ALL_TARGET=	all ./Lib/plat-openbsd3
d145 5
a149 5
#	${INSTALL_DATA} ${WRKSRC}/libpython${VERSION}.a \
#		${PREFIX}/lib/python${VERSION}/config
#	@@if [ -f ${PREFIX}/lib/python${VERSION}/config/libpython${VERSION}.so.0.0 ]; then \
#		cd ${PREFIX}/lib && ln -s python${VERSION}/config/libpython${VERSION}.so.0.0; \
#	fi
@


1.1
log
@Python 2.1.2 and Python 2.2.

Major changes:

- no more threads flavor, threads is now the default.

- subpackage modules that depend on other packages instead of having
largely redundant flavors (unless platform has no shared libs, then
flavors count again)

- shared libpython stuff disabled until someone can figure out why
it makes Zope crash
@
text
@d1 1
a1 1
# $OpenBSD$
d101 1
a101 2
#CONFIGURE_ENV+=  LDFLAGS='-L${WRKSRC}' OPT='${CFLAGS}' # -fPIC == Zope crash
CONFIGURE_ENV+=  LDFLAGS='-L${WRKSRC}' OPT='${CFLAGS} -fPIC -DPIC'
@

