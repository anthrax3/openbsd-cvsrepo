head	1.7;
access;
symbols
	OPENBSD_5_3:1.6.0.18
	OPENBSD_5_3_BASE:1.6
	OPENBSD_5_2:1.6.0.16
	OPENBSD_5_2_BASE:1.6
	OPENBSD_5_1_BASE:1.6
	OPENBSD_5_1:1.6.0.14
	OPENBSD_5_0:1.6.0.12
	OPENBSD_5_0_BASE:1.6
	OPENBSD_4_9:1.6.0.10
	OPENBSD_4_9_BASE:1.6
	OPENBSD_4_8:1.6.0.8
	OPENBSD_4_8_BASE:1.6
	OPENBSD_4_7:1.6.0.6
	OPENBSD_4_7_BASE:1.6
	OPENBSD_4_6:1.6.0.4
	OPENBSD_4_6_BASE:1.6
	OPENBSD_4_5:1.6.0.2
	OPENBSD_4_5_BASE:1.6
	OPENBSD_4_4:1.5.0.2
	OPENBSD_4_4_BASE:1.5
	OPENBSD_4_3:1.4.0.2
	OPENBSD_4_3_BASE:1.4
	OPENBSD_4_2:1.2.0.2
	OPENBSD_4_2_BASE:1.2
	OPENBSD_4_1:1.1.0.2
	OPENBSD_4_1_BASE:1.1;
locks; strict;
comment	@# @;


1.7
date	2013.06.04.08.02.20;	author fgsch;	state dead;
branches;
next	1.6;

1.6
date	2009.01.01.21.03.27;	author djm;	state Exp;
branches;
next	1.5;

1.5
date	2008.06.09.12.34.55;	author espie;	state Exp;
branches;
next	1.4;

1.4
date	2008.02.27.00.30.47;	author djm;	state Exp;
branches;
next	1.3;

1.3
date	2007.11.03.11.16.21;	author espie;	state Exp;
branches;
next	1.2;

1.2
date	2007.04.24.23.32.47;	author djm;	state Exp;
branches;
next	1.1;

1.1
date	2006.11.01.20.59.18;	author alek;	state Exp;
branches;
next	;


desc
@@


1.7
log
@GC python 2.5.  Thanks to zhuk who made this possible.
@
text
@$OpenBSD: patch-Makefile_pre_in,v 1.6 2009/01/01 21:03:27 djm Exp $
--- Makefile.pre.in.orig	Mon Sep 22 10:22:44 2008
+++ Makefile.pre.in	Mon Dec 15 20:13:03 2008
@@@@ -332,6 +332,8 @@@@ LIBRARY_OBJS=	\
 #########################################################################
 # Rules
 
+everything: all $(srcdir)/Lib/$(PLATDIR)
+
 # Default target
 all:		$(BUILDPYTHON) oldsharedmods sharedmods
 
@@@@ -340,6 +342,7 @@@@ $(BUILDPYTHON):	Modules/python.o $(LIBRARY) $(LDLIBRAR
 		$(LINKCC) $(LDFLAGS) $(LINKFORSHARED) -o $@@ \
 			Modules/python.o \
 			$(BLDLIBRARY) $(LIBS) $(MODLIBS) $(SYSLIBS) $(LDLAST)
+			-lpython$(VERSION) $(LIBS) $(MODLIBS) $(SYSLIBS) $(LDLAST)
 
 platform: $(BUILDPYTHON)
 	$(RUNSHARED) ./$(BUILDPYTHON) -E -c 'import sys ; from distutils.util import get_platform ; print get_platform()+"-"+sys.version[0:3]' >platform
@@@@ -376,6 +379,11 @@@@ libpython$(VERSION).so: $(LIBRARY_OBJS)
 libpython$(VERSION).sl: $(LIBRARY_OBJS)
 	$(LDSHARED) $(LDFLAGS) -o $@@ $(LIBRARY_OBJS) $(SHLIBS) $(LIBC) $(LIBM) $(LDLAST)
 
+# This rule for OpenBSD...
+$(LDLIBRARY):      $(LIBRARY)
+	$(LDSHARED) -o $@@ $(LIBRARY_OBJS)
+
+
 # This rule is here for OPENSTEP/Rhapsody/MacOSX. It builds a temporary
 # minimal framework (not including the Lib directory and such) in the current
 # directory.
@@@@ -658,14 +666,13 @@@@ bininstall:	altbininstall
 	then rm -f $(DESTDIR)$(BINDIR)/$(PYTHON); \
 	else true; \
 	fi
-	(cd $(DESTDIR)$(BINDIR); $(LN) python$(VERSION)$(EXE) $(PYTHON))
 	-rm -f $(DESTDIR)$(BINDIR)/python-config
 	(cd $(DESTDIR)$(BINDIR); $(LN) -s python$(VERSION)-config python-config)
 
 # Install the interpreter with $(VERSION) affixed
 # This goes into $(exec_prefix)
 altbininstall:	$(BUILDPYTHON)
-	@@for i in $(BINDIR) $(LIBDIR); \
+	@@for i in $(BINDIR) $(LIBDIR) $(LIBPL); \
 	do \
 		if test ! -d $(DESTDIR)$$i; then \
 			echo "Creating directory $$i"; \
@@@@ -674,14 +681,12 @@@@ altbininstall:	$(BUILDPYTHON)
 		fi; \
 	done
 	$(INSTALL_PROGRAM) $(BUILDPYTHON) $(DESTDIR)$(BINDIR)/python$(VERSION)$(EXE)
-	if test -f libpython$(VERSION)$(SO); then \
+	if test -f $(LDLIBRARY); then \
 		if test "$(SO)" = .dll; then \
 			$(INSTALL_SHARED) libpython$(VERSION)$(SO) $(DESTDIR)$(BINDIR); \
 		else \
-			$(INSTALL_SHARED) libpython$(VERSION)$(SO) $(DESTDIR)$(LIBDIR)/$(INSTSONAME); \
-			if test libpython$(VERSION)$(SO) != $(INSTSONAME); then \
-				(cd $(DESTDIR)$(LIBDIR); $(LN) -sf $(INSTSONAME) libpython$(VERSION)$(SO)); \
-			fi \
+			$(INSTALL_SHARED) $(LDLIBRARY) $(DESTDIR)$(LIBPL)/$(LDLIBRARY); \
+			(cd $(DESTDIR)$(LIBDIR); $(LN) -s python$(VERSION)/config/$(LDLIBRARY)); \
 		fi; \
 	else	true; \
 	fi
@@@@ -697,7 +702,7 @@@@ maninstall:
 		fi; \
 	done
 	$(INSTALL_DATA) $(srcdir)/Misc/python.man \
-		$(DESTDIR)$(MANDIR)/man1/python.1
+		$(DESTDIR)$(MANDIR)/man1/python$(VERSION).1
 
 # Install the library
 PLATDIR=	plat-$(MACHDEP)
@@@@ -725,7 +730,7 @@@@ LIBSUBDIRS=	lib-tk site-packages test test/output test
 		distutils distutils/command distutils/tests $(XMLLIBSUBDIRS) \
 		setuptools setuptools/command setuptools/tests setuptools.egg-info \
 		curses $(MACHDEPS)
-libinstall:	$(BUILDPYTHON) $(srcdir)/Lib/$(PLATDIR)
+libinstall:	$(srcdir)/Lib/$(PLATDIR)
 	@@for i in $(SCRIPTDIR) $(LIBDEST); \
 	do \
 		if test ! -d $(DESTDIR)$$i; then \
@@@@ -799,8 +804,8 @@@@ libinstall:	$(BUILDPYTHON) $(srcdir)/Lib/$(PLATDIR)
 		-x badsyntax $(DESTDIR)$(LIBDEST)/site-packages
 
 # Create the PLATDIR source directory, if one wasn't distributed..
-$(srcdir)/Lib/$(PLATDIR):
-	mkdir $(srcdir)/Lib/$(PLATDIR)
+$(srcdir)/Lib/$(PLATDIR): $(BUILDPYTHON)
+	mkdir -p $(srcdir)/Lib/$(PLATDIR)
 	cp $(srcdir)/Lib/plat-generic/regen $(srcdir)/Lib/$(PLATDIR)/regen
 	export PATH; PATH="`pwd`:$$PATH"; \
 	export PYTHONPATH; PYTHONPATH="`pwd`/Lib"; \
@


1.6
log
@Updates and garbage collect all three Python ports:

    2.4.4 => 2.4.8
    2.5.2 => 2.5.4
    2.6 => 2.6.1

Python 2.4 and 2.5 lose their build knobs to match 2.6.

Removes no longer needed Python 2.5 security patches backported
from the release25-maint SVN branch.

Remove the -bz2 subpackage from all three versions. It is silly
to make a subpackage to avoid depending on something tiny and
compatibly licensed.

Python 2.4 and 2.5 lose their -expat subpackages; expat has been
in base for some time.

Python 2.5 loses its sqlite subpackge. Again, sqlite is tiny,
compatibly licensed and is depended upon by more and more
applications. This brings it into line with the 2.6 version.

Rework all three version's handling of setup.py. Rather than regex
replacing LOCALBASE and X11BASE into setup.py post-configure, these
are passed in though environment variables. Will save hours of
frustrated cursing familiar to anyone who has accidently used the
update-patches target after configure and had to go back and redo
all the substitutions.

Rework the patching of setup.py for 2.4 and 2.5 to be more like
what we do for 2.6. I.e. keep the diff minimal and avoid deleting
huge blocks of code, so the diff has a chance of applying without
massive hand-editing each patch release.

Fix .py paths in installed .pyc files (patch from eric@@)

feedback from several, particularly eric@@, ajacoutot@@ and Ingo
Schwarze; "get it in" ajacoutot@@
@
text
@d1 1
a1 1
$OpenBSD: patch-Makefile_pre_in,v 1.5 2008/06/09 12:34:55 espie Exp $
@


1.5
log
@fix intermitent race condition, no reason for ./Lib/plat-openbsd4
to match $(srcdir)/Lib/plat-openbsd4 except by accident...
@
text
@d1 3
a3 3
$OpenBSD: patch-Makefile_pre_in,v 1.4 2008/02/27 00:30:47 djm Exp $
--- Makefile.pre.in.orig	Wed Dec  5 21:43:57 2007
+++ Makefile.pre.in	Mon Jun  9 14:23:39 2008
d23 1
a23 1
 	$(LDSHARED) -o $@@ $(LIBRARY_OBJS) $(SHLIBS) $(LIBC) $(LIBM)
@


1.4
log
@python-2.5.2

tested with a full ports build by naddy@@ ok pvalchev@@
@
text
@d1 13
a13 4
$OpenBSD: patch-Makefile_pre_in,v 1.3 2007/11/03 11:16:21 espie Exp $
--- Makefile.pre.in.orig	Thu Dec  6 07:43:57 2007
+++ Makefile.pre.in	Fri Feb 15 11:55:22 2008
@@@@ -340,6 +340,7 @@@@ $(BUILDPYTHON):	Modules/python.o $(LIBRARY) $(LDLIBRAR
d21 1
a21 1
@@@@ -376,6 +377,11 @@@@ libpython$(VERSION).so: $(LIBRARY_OBJS)
d33 1
a33 1
@@@@ -658,14 +664,13 @@@@ bininstall:	altbininstall
d49 1
a49 1
@@@@ -674,14 +679,12 @@@@ altbininstall:	$(BUILDPYTHON)
d67 1
a67 1
@@@@ -697,7 +700,7 @@@@ maninstall:
d76 1
a76 1
@@@@ -725,7 +728,7 @@@@ LIBSUBDIRS=	lib-tk site-packages test test/output test
d85 1
a85 1
@@@@ -799,8 +802,8 @@@@ libinstall:	$(BUILDPYTHON) $(srcdir)/Lib/$(PLATDIR)
@


1.3
log
@nail down build order for parallel build.
tested through a bulk build by sturm@@
@
text
@d1 4
a4 4
$OpenBSD: patch-Makefile_pre_in,v 1.2 2007/04/24 23:32:47 djm Exp $
--- Makefile.pre.in.orig	Fri Dec  8 21:46:13 2006
+++ Makefile.pre.in	Mon Oct 29 22:18:11 2007
@@@@ -337,6 +337,7 @@@@ $(BUILDPYTHON):	Modules/python.o $(LIBRARY) $(LDLIBRAR
d12 1
a12 1
@@@@ -373,6 +374,11 @@@@ libpython$(VERSION).so: $(LIBRARY_OBJS)
d24 1
a24 1
@@@@ -650,13 +656,12 @@@@ bininstall:	altbininstall
d29 2
a30 1
 	(cd $(DESTDIR)$(BINDIR); $(LN) -sf python$(VERSION)-config python-config)
d40 1
a40 1
@@@@ -665,14 +670,12 @@@@ altbininstall:	$(BUILDPYTHON)
d58 1
a58 1
@@@@ -688,7 +691,7 @@@@ maninstall:
d67 1
a67 1
@@@@ -716,7 +719,7 @@@@ LIBSUBDIRS=	lib-tk site-packages test test/output test
d76 1
a76 1
@@@@ -790,8 +793,8 @@@@ libinstall:	$(BUILDPYTHON) $(srcdir)/Lib/$(PLATDIR)
@


1.2
log
@python-2.5.1
@
text
@d1 3
a3 3
$OpenBSD: patch-Makefile_pre_in,v 1.1 2006/11/01 20:59:18 alek Exp $
--- Makefile.pre.in.orig	Sat Dec  9 07:46:13 2006
+++ Makefile.pre.in	Fri Apr 20 13:29:23 2007
d66 20
@


1.1
log
@Python 2.5
@
text
@d1 4
a4 4
$OpenBSD$
--- Makefile.pre.in.orig	Mon Jul 31 02:20:10 2006
+++ Makefile.pre.in	Mon Sep 18 06:31:10 2006
@@@@ -337,6 +337,7 @@@@ $(BUILDPYTHON):	Modules/python.o $(LIBRA
@

