head	1.4;
access;
symbols
	OPENBSD_3_7:1.3.0.12
	OPENBSD_3_7_BASE:1.3
	OPENBSD_3_6:1.3.0.10
	OPENBSD_3_6_BASE:1.3
	OPENBSD_3_5:1.3.0.8
	OPENBSD_3_5_BASE:1.3
	OPENBSD_3_4:1.3.0.6
	OPENBSD_3_4_BASE:1.3
	OPENBSD_3_3:1.3.0.4
	OPENBSD_3_3_BASE:1.3
	OPENBSD_3_2:1.3.0.2
	OPENBSD_3_2_BASE:1.3
	OPENBSD_3_1:1.1.0.2
	OPENBSD_3_1_BASE:1.1;
locks; strict;
comment	@# @;


1.4
date	2005.05.17.17.53.25;	author alek;	state dead;
branches;
next	1.3;

1.3
date	2002.05.12.19.32.41;	author matt;	state Exp;
branches;
next	1.2;

1.2
date	2002.05.11.21.35.13;	author matt;	state Exp;
branches;
next	1.1;

1.1
date	2002.02.15.19.42.18;	author matt;	state Exp;
branches;
next	;


desc
@@


1.4
log
@Remove old version as we have newer ones.

ok mbalmer@@, krw@@ (and others too)
@
text
@$OpenBSD: patch-configure_in,v 1.3 2002/05/12 19:32:41 matt Exp $

        This has been submitted to the Python team as part of patch
        554718.

--- configure.in.orig	Thu Dec 27 16:55:46 2001
+++ configure.in	Mon Jan 14 12:15:41 2002
@@@@ -614,7 +614,20 @@@@ then
 	Linux*) LDSHARED="gcc -shared";;
 	dgux*) LDSHARED="ld -G";;
 	BSD/OS*/4*) LDSHARED="gcc -shared";;
-	OpenBSD*) LDSHARED="ld -Bshareable";;
+	OpenBSD*)
+		if [[ "`$CC -dM -E - </dev/null | grep __ELF__`" != "" ]]
+		then
+			LDSHARED='$(CC) -shared $(CCSHARED) ${LDFLAGS}'
+		else
+			case `uname -r` in
+			[01].* | 2.[[0-7]] | 2.[[0-7]].*)
+			  LDSHARED="ld -Bshareable ${LDFLAGS}"
+			  ;;
+			*)
+			  LDSHARED='$(CC) -shared $(CCSHARED) ${LDFLAGS}'
+			  ;;
+			esac
+		fi;;
 	NetBSD*)
 		if [[ "`$CC -dM -E - </dev/null | grep __ELF__`" != "" ]]
 		then
@@@@ -657,8 +670,7 @@@@ then
 		 fi;;
 	Linux*) CCSHARED="-fPIC";;
 	BSD/OS*/4*) CCSHARED="-fpic";;
-	OpenBSD*) CCSHARED="-fpic";;
-	FreeBSD*|NetBSD*) CCSHARED="-fPIC";;
+	FreeBSD*|NetBSD*|OpenBSD*) CCSHARED="-fPIC";;
 	UnixWare*)
 		if test "$GCC" = "yes"
 		then CCSHARED="-fPIC"
@@@@ -696,7 +708,7 @@@@ then
 	UnixWare*) LINKFORSHARED="-dy -Bdynamic -Wl,-Bexport";;
 	SCO_SV*) LINKFORSHARED="-Bdynamic -dy -Wl,-Bexport";;
 	ReliantUNIX*) LINKFORSHARED="-W1 -Blargedynsym";;
-	FreeBSD*|NetBSD*) 
+	FreeBSD*|NetBSD*|OpenBSD*) 
 		if [[ "`$CC -dM -E - </dev/null | grep __ELF__`" != "" ]]
 		then
 			LINKFORSHARED="-Wl,--export-dynamic"
@@@@ -828,15 +840,29 @@@@ if test "$with_threads" = "no"
 then
     USE_THREAD_MODULE="#"
 else
+    have_threads=no
     if test "$ac_sys_system" = "UnixWare"
      then
+	have_threads=yes
 	CC="${CC} -Kthread"
 	LIBOBJS="$LIBOBJS thread.o"
 	AC_DEFINE(WITH_THREAD)
 	AC_DEFINE(_POSIX_THREADS)
 	posix_threads=yes
 	USE_THREAD_MODULE=""
-    else
+    fi
+    if test "$have_threads" = "no" -a "$ac_sys_system" = "OpenBSD"
+     then
+	have_threads=yes
+	LIBS="-pthread $LIBS"
+	LIBOBJS="$LIBOBJS thread.o"
+	AC_DEFINE(WITH_THREAD)
+	AC_DEFINE(_REENTRANT)
+	AC_DEFINE(_POSIX_THREADS)
+	USE_THREAD_MODULE=""
+    fi
+    if test "$have_threads" = "no"
+     then
 	if test ! -z "$with_threads" -a -d "$with_threads"
 	then LDFLAGS="$LDFLAGS -L$with_threads"
 	fi
@


1.3
log
@> Changes by:     brad@@cvs.openbsd.org    2002/05/11 19:05:49
>
> Modified files:
>         lang/python/2.2/patches: patch-configure_in
>
> Log message:
> fixes for shared lib support

if it's good enough for 2.2, it's good enough for 2.1
@
text
@d1 1
a1 1
$OpenBSD: patch-configure_in,v 1.2 2002/05/11 21:35:13 matt Exp $
@


1.2
log
@- 2.2 -> 2.2.1
- annotate patches submitted to Python patch tracker
- 100% license compliance: install CHANGES.OpenBSD file
@
text
@d1 1
a1 1
$OpenBSD$
d16 1
a16 1
+			LDSHARED='$(CC) -shared $(CCSHARED)'
d20 1
a20 1
+			  LDSHARED="ld -Bshareable"
d23 1
a23 1
+			  LDSHARED='$(CC) -shared $(CCSHARED)'
@


1.1
log
@Python 2.1.2 and Python 2.2.

Major changes:

- no more threads flavor, threads is now the default.

- subpackage modules that depend on other packages instead of having
largely redundant flavors (unless platform has no shared libs, then
flavors count again)

- shared libpython stuff disabled until someone can figure out why
it makes Zope crash
@
text
@d1 5
@

