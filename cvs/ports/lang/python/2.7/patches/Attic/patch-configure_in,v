head	1.10;
access;
symbols
	OPENBSD_5_3:1.8.0.4
	OPENBSD_5_3_BASE:1.8
	OPENBSD_5_2:1.8.0.2
	OPENBSD_5_2_BASE:1.8
	OPENBSD_5_1_BASE:1.6
	OPENBSD_5_1:1.6.0.2
	OPENBSD_5_0:1.5.0.2
	OPENBSD_5_0_BASE:1.5
	rpointel_20110424:1.1.1.1
	rpointel:1.1.1;
locks; strict;
comment	@# @;


1.10
date	2013.04.13.22.31.42;	author fgsch;	state dead;
branches;
next	1.9;

1.9
date	2013.03.31.21.35.26;	author bcallah;	state Exp;
branches;
next	1.8;

1.8
date	2012.04.27.08.18.59;	author rpointel;	state Exp;
branches;
next	1.7;

1.7
date	2012.02.27.19.30.46;	author rpointel;	state Exp;
branches;
next	1.6;

1.6
date	2011.12.10.19.06.03;	author naddy;	state Exp;
branches;
next	1.5;

1.5
date	2011.07.07.21.32.39;	author jasper;	state Exp;
branches;
next	1.4;

1.4
date	2011.07.06.12.05.56;	author jasper;	state Exp;
branches;
next	1.3;

1.3
date	2011.05.07.09.35.13;	author fgsch;	state Exp;
branches;
next	1.2;

1.2
date	2011.04.26.19.42.31;	author rpointel;	state Exp;
branches;
next	1.1;

1.1
date	2011.04.24.09.31.44;	author rpointel;	state Exp;
branches
	1.1.1.1;
next	;

1.1.1.1
date	2011.04.24.09.31.44;	author rpointel;	state Exp;
branches;
next	;


desc
@@


1.10
log
@Update python 2.7 to 2.7.4.

This is a slighly different version that I sent that includes an updated
kqueue diff that works with python 2 and 3 and puts test_bsddb and
test_bsddb3 back on the skip list as they're not built outside amd64
and i386.

Only 2 tests are known to fail: test_kqueue (broken) and test_threading
(failing on 2.7.3, under investigation but likely broken). If something
else fails please send your test.log.

Tested on a bulk by landry, sparc64 by brad, ppc gonzalo and amd64 by me.
@
text
@$OpenBSD: patch-configure_in,v 1.9 2013/03/31 21:35:26 bcallah Exp $

Wrong value of LDSHARED in sysconfig, cf http://bugs.python.org/issue10547
Fix wrong value of INSTSONAME. SOVERSION defaults to 1.0 which leads to
INSTSONAME being libpython2.7.so.1.0, which is incorrect.
This breaks linking for ports that look for INSTSONAME in their configure
stage.

--- configure.in.orig	Mon Apr  9 19:07:36 2012
+++ configure.in	Sun Mar 31 15:38:58 2013
@@@@ -787,6 +787,9 @@@@ if test $enable_shared = "yes"; then
 	      FreeBSD*)
 		SOVERSION=`echo $SOVERSION|cut -d "." -f 1`
 		;;
+	      OpenBSD*)
+		SOVERSION=${LIBpython2.7_VERSION}
+		;;
 	  esac
 	  INSTSONAME="$LDLIBRARY".$SOVERSION
 	  ;;
@@@@ -2057,9 +2060,10 @@@@ AC_CHECK_LIB(dld, shl_load)	# Dynamic linking for HP-U
 
 # only check for sem_init if thread support is requested
 if test "$with_threads" = "yes" -o -z "$with_threads"; then
-    AC_SEARCH_LIBS(sem_init, pthread rt posix4) # 'Real Time' functions on Solaris
+#    AC_SEARCH_LIBS(sem_init, pthread rt posix4) # 'Real Time' functions on Solaris
 						# posix4 on Solaris 2.6
 						# pthread (first!) on Linux
+	LIBS="-pthread ${LIBS}"
 fi
 
 # check if we need libintl for locale functions
@


1.9
log
@Fix a hardcoded INSTSONAME, which happens to be wrong for Python 2.7
Bump everyone's REVISION.
ok sthen@@
@
text
@d1 1
a1 1
$OpenBSD: patch-configure_in,v 1.8 2012/04/27 08:18:59 rpointel Exp $
@


1.8
log
@Update Python 2.7.2 to 2.7.3.
ok mpi@@, gonzalo@@. tested in a bulk build by landry@@.
@
text
@d1 1
a1 1
$OpenBSD: patch-configure_in,v 1.7 2012/02/27 19:30:46 rpointel Exp $
d4 4
d9 13
a21 3
--- configure.in.orig	Tue Apr 10 01:07:36 2012
+++ configure.in	Fri Apr 13 07:45:44 2012
@@@@ -2057,9 +2057,10 @@@@ AC_CHECK_LIB(dld, shl_load)	# Dynamic linking for HP-U
@


1.7
log
@Update Python to 2.7.2 and remove hacks for old pthread.
ok fgsch@@ and aja@@.
@
text
@d1 1
a1 1
$OpenBSD: patch-configure_in,v 1.6 2011/12/10 19:06:03 naddy Exp $
d5 3
a7 12
--- configure.in.orig	Sat Jun 11 17:46:28 2011
+++ configure.in	Sun Feb 19 19:10:29 2012
@@@@ -324,7 +324,7 @@@@ case $ac_sys_system/$ac_sys_release in
     # As this has a different meaning on Linux, only define it on OpenBSD
     AC_DEFINE(_BSD_SOURCE, 1, [Define on OpenBSD to activate all library features])
     ;;
-  OpenBSD/4.@@<:@@789@@:>@@)
+  OpenBSD/4.@@<:@@789@@:>@@ | OpenBSD/5.*)
     # OpenBSD undoes our definition of __BSD_VISIBLE if _XOPEN_SOURCE is
     # also defined. This can be overridden by defining _BSD_SOURCE
     # As this has a different meaning on Linux, only define it on OpenBSD
@@@@ -2049,9 +2049,10 @@@@ AC_CHECK_LIB(dld, shl_load)	# Dynamic linking for HP-U
@


1.6
log
@./configure[7897]: LIBS: not found

Don't introduce a syntax error in configure; sh(1) is not make(1)
and here the expansion happens in sh.  ok rpointel@@
@
text
@d1 1
a1 1
$OpenBSD: patch-configure_in,v 1.5 2011/07/07 21:32:39 jasper Exp $
d5 3
a7 3
--- configure.in.orig	Mon Nov  1 02:47:19 2010
+++ configure.in	Thu Jul  7 22:57:06 2011
@@@@ -331,7 +331,7 @@@@ case $ac_sys_system/$ac_sys_release in
d16 1
a16 36
@@@@ -1850,30 +1850,14 @@@@ then
 	BSD/OS*/4*)
 		LDSHARED="gcc -shared"
 		LDCXXSHARED="g++ -shared";;
-	FreeBSD*)
+	FreeBSD*|OpenBSD*)
 		if [[ "`$CC -dM -E - </dev/null | grep __ELF__`" != "" ]]
 		then
-			LDSHARED='$(CC) -shared ${LDFLAGS}'
-			LDCXXSHARED='$(CXX) -shared ${LDFLAGS}'
+			LDSHARED='$(CC) -shared'
+			LDCXXSHARED='$(CXX) -shared'
 		else
-			LDSHARED="ld -Bshareable ${LDFLAGS}"
+			LDSHARED="ld -Bshareable"
 		fi;;
-	OpenBSD*)
-		if [[ "`$CC -dM -E - </dev/null | grep __ELF__`" != "" ]]
-		then
-				LDSHARED='$(CC) -shared $(CCSHARED) ${LDFLAGS}'
-				LDCXXSHARED='$(CXX) -shared $(CCSHARED) ${LDFLAGS}'
-		else
-				case `uname -r` in
-				[[01]].* | 2.[[0-7]] | 2.[[0-7]].*)
-				   LDSHARED="ld -Bshareable ${LDFLAGS}"
-				   ;;
-				*)
-				   LDSHARED='$(CC) -shared $(CCSHARED) ${LDFLAGS}'
-				   LDCXXSHARED='$(CXX) -shared $(CCSHARED) ${LDFLAGS}'
-				   ;;
-				esac
-		fi;;
 	NetBSD*|DragonFly*)
 		LDSHARED="cc -shared ${LDFLAGS}"
 		LDCXXSHARED="c++ -shared ${LDFLAGS}";;
@@@@ -2035,9 +2019,10 @@@@ AC_CHECK_LIB(dld, shl_load)	# Dynamic linking for HP-U
@


1.5
log
@recognize openbsd5, may need some more work
@
text
@d1 1
a1 1
$OpenBSD: patch-configure_in,v 1.4 2011/07/06 12:05:56 jasper Exp $
d59 1
a59 1
+	LIBS="-pthread $(LIBS)"
@


1.4
log
@regen
@
text
@d1 1
a1 1
$OpenBSD: patch-configure_in,v 1.3 2011/05/07 09:35:13 fgsch Exp $
d6 10
a15 1
+++ configure.in	Wed Jul  6 14:05:42 2011
@


1.3
log
@make the comments more prominent.
@
text
@d1 1
a1 1
$OpenBSD: patch-configure_in,v 1.2 2011/04/26 19:42:31 rpointel Exp $
d6 2
a7 2
+++ configure.in	Tue Apr 26 20:24:50 2011
@@@@ -1850,30 +1850,14 @@@@
d42 1
a42 1
@@@@ -2035,9 +2019,10 @@@@
@


1.2
log
@Added 2 patch to permit to 'make regress' without blocking...
Used @@unittest.skip instead of commenting out the test.
Corrected wrong value of LDSHARED in sysconfig, cf http://bugs.python.org/issue10547.
Bump REVISION.
ok landry@@ (thanks).
@
text
@d1 4
a4 2
$OpenBSD: patch-configure_in,v 1.1.1.1 2011/04/24 09:31:44 rpointel Exp $
wrong value of LDSHARED in sysconfig, cf http://bugs.python.org/issue10547
@


1.1
log
@Initial revision
@
text
@d1 2
a2 1
$OpenBSD$
d4 2
a5 2
+++ configure.in	Mon Mar 28 11:53:19 2011
@@@@ -1850,7 +1850,7 @@@@
d13 4
a16 2
 			LDSHARED='$(CC) -shared ${LDFLAGS}'
@@@@ -1858,22 +1858,6 @@@@
d18 2
a19 1
 			LDSHARED="ld -Bshareable ${LDFLAGS}"
@


1.1.1.1
log
@Import Python 2.7.1.
Thanks a lot to landry@@, fgsch@@ for feedback.
Need tests before doing this version the default.

@
text
@@
