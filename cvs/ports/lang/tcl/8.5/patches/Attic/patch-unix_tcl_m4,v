head	1.5;
access;
symbols
	OPENBSD_5_0:1.4.0.4
	OPENBSD_5_0_BASE:1.4
	OPENBSD_4_9:1.4.0.2
	OPENBSD_4_9_BASE:1.4
	OPENBSD_4_5:1.2.0.2
	OPENBSD_4_5_BASE:1.2
	OPENBSD_4_4:1.1.1.1.0.2
	OPENBSD_4_4_BASE:1.1.1.1
	deanna_20080425:1.1.1.1
	deanna:1.1.1;
locks; strict;
comment	@# @;


1.5
date	2011.10.17.15.18.39;	author stu;	state dead;
branches;
next	1.4;

1.4
date	2011.01.05.16.13.53;	author stu;	state Exp;
branches;
next	1.3;

1.3
date	2009.04.24.21.13.13;	author sthen;	state dead;
branches;
next	1.2;

1.2
date	2008.10.01.19.47.40;	author steven;	state Exp;
branches;
next	1.1;

1.1
date	2008.04.25.14.10.47;	author deanna;	state Exp;
branches
	1.1.1.1;
next	;

1.1.1.1
date	2008.04.25.14.10.47;	author deanna;	state Exp;
branches;
next	;


desc
@@


1.5
log
@Update to 8.5.10, remove patches for changes that have gone upstream,
rework pkg-readme to conform to new template, update man.conf patch,
move man dir to Tcl's lib dir, properly preprocess man pages.
Bump major due to function signature change in tcllib.

ok sebastiap@@, sthen@@
@
text
@$OpenBSD: patch-unix_tcl_m4,v 1.4 2011/01/05 16:13:53 stu Exp $
--- unix/tcl.m4.orig	Wed Sep  8 13:40:48 2010
+++ unix/tcl.m4	Mon Dec  6 14:13:49 2010
@@@@ -1522,17 +1522,37 @@@@ dnl AC_CHECK_TOOL(AR, ar)
 	    TCL_LIB_VERSIONS_OK=nodots
 	    ;;
 	OpenBSD-*)
-	    CFLAGS_OPTIMIZE='-O2'
-	    SHLIB_CFLAGS="-fPIC"
-	    SHLIB_LD='${CC} -shared ${SHLIB_CFLAGS}'
-	    SHLIB_LD_LIBS='${LIBS}'
-	    SHLIB_SUFFIX=".so"
-	    DL_OBJS="tclLoadDl.o"
-	    DL_LIBS=""
-	    AS_IF([test $doRpath = yes], [
-		CC_SEARCH_FLAGS='-Wl,-rpath,${LIB_RUNTIME_DIR}'])
-	    LD_SEARCH_FLAGS=${CC_SEARCH_FLAGS}
-	    SHARED_LIB_SUFFIX='${TCL_TRIM_DOTS}.so.${SHLIB_VERSION}'
+	    arch=`arch -s`
+	    case "$arch" in
+	    m88k|vax)
+		# Equivalent using configure option --disable-load
+		# Step 4 will set the necessary variables
+		DL_OBJS=""
+		;;
+	    *)
+		SHLIB_CFLAGS="-fPIC"
+		SHLIB_LD='${CC} -shared ${SHLIB_CFLAGS}'
+		SHLIB_LD_LIBS='${LIBS}'
+		SHLIB_SUFFIX=".so"
+		DL_OBJS="tclLoadDl.o"
+		DL_LIBS=""
+		AS_IF([test $doRpath = yes], [
+		    CC_SEARCH_FLAGS='-Wl,-rpath,${LIB_RUNTIME_DIR}'])
+		LD_SEARCH_FLAGS=${CC_SEARCH_FLAGS}
+		SHARED_LIB_SUFFIX='${TCL_TRIM_DOTS}.so.${SHLIB_VERSION}'
+		;;
+	    esac
+	    case "$arch" in
+	    m88k|vax)
+		CFLAGS_OPTIMIZE="-O1"
+		;;
+	    sh)
+		CFLAGS_OPTIMIZE="-O0"
+		;;
+	    *)
+		CFLAGS_OPTIMIZE="-O2"
+		;;
+	    esac
 	    AC_CACHE_CHECK([for ELF], tcl_cv_ld_elf, [
 		AC_EGREP_CPP(yes, [
 #ifdef __ELF__
@@@@ -1543,10 +1563,10 @@@@ dnl AC_CHECK_TOOL(AR, ar)
 		LDFLAGS=-Wl,-export-dynamic
 	    ], [LDFLAGS=""])
 	    AS_IF([test "${TCL_THREADS}" = "1"], [
-		# OpenBSD builds and links with -pthread, never -lpthread.
+		# On OpenBSD:	Compile with -pthread
+		#		Don't link with -lpthread
 		LIBS=`echo $LIBS | sed s/-lpthread//`
 		CFLAGS="$CFLAGS -pthread"
-		SHLIB_CFLAGS="$SHLIB_CFLAGS -pthread"
 	    ])
 	    # OpenBSD doesn't do version numbers with dots.
 	    UNSHARED_LIB_SUFFIX='${TCL_TRIM_DOTS}.a'
@


1.4
log
@Upgrade to 8.5.9. Newer, cleaner layout, consolidate
include files into one dir, simplify modules dirs layout,
improved building wrt threads/compiler flags, etc.

ok landry@@, sebastiap@@
@
text
@d1 1
a1 1
$OpenBSD$
@


1.3
log
@update to Tcl/Tk 8.5.7, from maintainer Stuart Cassoff
@
text
@d1 4
a4 39
$OpenBSD: patch-unix_tcl_m4,v 1.2 2008/10/01 19:47:40 steven Exp $
--- unix/tcl.m4.orig	Thu Aug 14 13:31:38 2008
+++ unix/tcl.m4	Wed Sep 10 09:49:17 2008
@@@@ -1140,7 +1140,7 @@@@ AC_DEFUN([SC_CONFIG_CFLAGS], [
     CFLAGS_DEBUG=-g
     CFLAGS_OPTIMIZE=-O
     AS_IF([test "$GCC" = yes], [
-	CFLAGS_WARNING="-Wall -Wno-implicit-int"
+	CFLAGS_WARNING="-Wall"
     ], [CFLAGS_WARNING=""])
     TCL_NEEDS_EXP_FILE=0
     TCL_BUILD_EXP_FILE=""
@@@@ -1155,6 +1155,8 @@@@ dnl AC_CHECK_TOOL(AR, ar)
     LD_LIBRARY_PATH_VAR="LD_LIBRARY_PATH"
     PLAT_OBJS=""
     PLAT_SRCS=""
+    LDAIX_SRC=""
+    AS_IF([test x"${SHLIB_VERSION}" = x],[SHLIB_VERSION="1.0"])
     case $system in
 	AIX-*)
 	    AS_IF([test "${TCL_THREADS}" = "1" -a "$GCC" != "yes"], [
@@@@ -1214,6 +1216,7 @@@@ dnl AC_CHECK_TOOL(AR, ar)
 		LD_SEARCH_FLAGS=${CC_SEARCH_FLAGS}
 		TCL_NEEDS_EXP_FILE=1
 		TCL_EXPORT_FILE_SUFFIX='${VERSION}.exp'
+		LDAIX_SRC='$(UNIX_DIR)/ldAix'
 	    ])
 
 	    # AIX v<=4.1 has some different flags than 4.2+
@@@@ -1521,7 +1524,7 @@@@ dnl AC_CHECK_TOOL(AR, ar)
 	    AS_IF([test $tcl_cv_ld_elf = yes], [
 		SHARED_LIB_SUFFIX='${TCL_TRIM_DOTS}.so'
 	    ], [
-		SHARED_LIB_SUFFIX='${TCL_TRIM_DOTS}.so.1.0'
+		SHARED_LIB_SUFFIX='${TCL_TRIM_DOTS}.so.${SHLIB_VERSION}'
 	    ])
 
 	    # Ancient FreeBSD doesn't handle version numbers with dots.
@@@@ -1530,6 +1533,7 @@@@ dnl AC_CHECK_TOOL(AR, ar)
d8 42
a49 10
+	    CFLAGS_OPTIMIZE="-O2"
 	    SHLIB_CFLAGS="-fPIC"
 	    SHLIB_LD='${CC} -shared ${SHLIB_CFLAGS}'
 	    SHLIB_LD_LIBS='${LIBS}'
@@@@ -1539,7 +1543,7 @@@@ dnl AC_CHECK_TOOL(AR, ar)
 	    AS_IF([test $doRpath = yes], [
 		CC_SEARCH_FLAGS='-Wl,-rpath,${LIB_RUNTIME_DIR}'])
 	    LD_SEARCH_FLAGS=${CC_SEARCH_FLAGS}
-	    SHARED_LIB_SUFFIX='${TCL_TRIM_DOTS}.so.1.0'
+	    SHARED_LIB_SUFFIX='${TCL_TRIM_DOTS}.so.${SHLIB_VERSION}'
d53 12
a64 6
@@@@ -1848,7 +1852,7 @@@@ dnl AC_CHECK_TOOL(AR, ar)
 	    # requires an extra version number at the end of .so file names.
 	    # So, the library has to have a name like libtcl75.so.1.0
 
-	    SHARED_LIB_SUFFIX='${TCL_TRIM_DOTS}.so.1.0'
+	    SHARED_LIB_SUFFIX='${TCL_TRIM_DOTS}.so.${SHLIB_VERSION}'
a65 10
 	    TCL_LIB_VERSIONS_OK=nodots
 	    ;;
@@@@ -2112,6 +2116,7 @@@@ dnl # preprocessing tests use only CPPFLAGS.
     AC_SUBST(DL_OBJS)
     AC_SUBST(PLAT_OBJS)
     AC_SUBST(PLAT_SRCS)
+    AC_SUBST(LDAIX_SRC)
     AC_SUBST(CFLAGS)
     AC_SUBST(CFLAGS_DEBUG)
     AC_SUBST(CFLAGS_OPTIMIZE)
@


1.2
log
@update to 8.5.4 and various port cleanups
add README file for tcl/tk on OpenBSD

all from maintainer Stuart Cassoff
@
text
@d1 1
a1 1
$OpenBSD$
@


1.1
log
@Initial revision
@
text
@d2 38
a39 3
--- unix/tcl.m4.orig	Tue Feb  5 12:00:35 2008
+++ unix/tcl.m4	Mon Mar 24 00:57:23 2008
@@@@ -1534,26 +1534,43 @@@@ dnl AC_CHECK_TOOL(AR, ar)
d43 8
a50 9
-	    SHLIB_CFLAGS="-fPIC"
-	    SHLIB_LD='${CC} -shared ${SHLIB_CFLAGS}'
-	    SHLIB_LD_LIBS='${LIBS}'
-	    SHLIB_SUFFIX=".so"
-	    DL_OBJS="tclLoadDl.o"
-	    DL_LIBS=""
-	    AS_IF([test $doRpath = yes], [
-		CC_SEARCH_FLAGS='-Wl,-rpath,${LIB_RUNTIME_DIR}'])
-	    LD_SEARCH_FLAGS=${CC_SEARCH_FLAGS}
d52 3
a54 28
-	    AC_CACHE_CHECK([for ELF], tcl_cv_ld_elf, [
-		AC_EGREP_CPP(yes, [
+	    case `arch -s` in
+	    m88k|vax)
+		SHLIB_CFLAGS=""
+		SHLIB_LD="echo tclLdAout $CC \{$SHLIB_CFLAGS\} | `pwd`/tclsh -r"
+		SHLIB_LD_LIBS='${LIBS}'
+		SHLIB_SUFFIX=".a"
+		DL_OBJS="tclLoadAout.o"
+		DL_LIBS=""
+		LDFLAGS=""
+		CC_SEARCH_FLAGS='-L${LIB_RUNTIME_DIR}'
+		LD_SEARCH_FLAGS=${CC_SEARCH_FLAGS}
+		SHARED_LIB_SUFFIX='${TCL_TRIM_DOTS}.a'
+		;;
+	    *)
+		SHLIB_CFLAGS="-fPIC"
+		SHLIB_LD="${CC} -shared ${SHLIB_CFLAGS}"
+		SHLIB_LD_LIBS='${LIBS}'
+		SHLIB_SUFFIX=".so"
+		DL_OBJS="tclLoadDl.o"
+		DL_LIBS=""
+		AS_IF([test $doRpath = yes], [
+		    CC_SEARCH_FLAGS='-Wl,-rpath,${LIB_RUNTIME_DIR}'])
+		LD_SEARCH_FLAGS=${CC_SEARCH_FLAGS}
+		SHARED_LIB_SUFFIX='${TCL_TRIM_DOTS}.so.${LIBtcl85_VERSION}'
+		AC_CACHE_CHECK([for ELF], tcl_cv_ld_elf, [
+		    AC_EGREP_CPP(yes, [
d56 6
a61 16
 	yes
 #endif
-		], tcl_cv_ld_elf=yes, tcl_cv_ld_elf=no)])
-	    AS_IF([test $tcl_cv_ld_elf = yes], [
-		LDFLAGS=-Wl,-export-dynamic
-	    ], [LDFLAGS=""])
-
+		    ], tcl_cv_ld_elf=yes, tcl_cv_ld_elf=no)])
+		AS_IF([test $tcl_cv_ld_elf = yes], [
+		    LDFLAGS=-Wl,-export-dynamic
+		], [LDFLAGS=""])
+		;;
+	    esac
+	    CFLAGS_WARNING="-Wall"
+	    CFLAGS_OPTIMIZE="-O2"
 	    # OpenBSD doesn't do version numbers with dots.
d64 9
@


1.1.1.1
log
@import tcl 8.5

Highlights of Tcl 8.5

    * Speed: 8.5 now runs 10% faster than 8.4 with bytecode
      improvements, object caching and reduced memory usage.
    * Bignums: Tcl now supports arbitrary-precision integers,
      which improves math operations on large integers.
    * Safer interps: Tcl's powerful safe interpreter mechanism
      now has improved control of time and command limits in
      slave interpreters.
    * clock command: More robust implementation of command for
      specifying time, with significant l10n and i18n
      improvements.
    * dict command: New data structure that allows access to
      data by value rather than a variable name, which is
      substantially faster.
    * Additional improvements: Faster list search, new and
      improved mathematics procedures, anonymous procedures, new
      ways to package Tcl extensions, Tcl-level custom channel
      types, file and line location information for each
      command, and more.

from Stuart Cassoff (MAINTAINER)

ok steven@@

@
text
@@
