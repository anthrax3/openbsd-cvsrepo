head	1.3;
access;
symbols
	OPENBSD_4_8:1.2.0.2
	OPENBSD_4_8_BASE:1.2
	OPENBSD_4_7:1.1.0.2
	OPENBSD_4_7_BASE:1.1;
locks; strict;
comment	@# @;


1.3
date	2011.01.05.16.13.53;	author stu;	state dead;
branches;
next	1.2;

1.2
date	2010.06.07.18.12.05;	author jasper;	state Exp;
branches;
next	1.1;

1.1
date	2009.11.22.22.58.30;	author jasper;	state Exp;
branches;
next	;


desc
@@


1.3
log
@Upgrade to 8.5.9. Newer, cleaner layout, consolidate
include files into one dir, simplify modules dirs layout,
improved building wrt threads/compiler flags, etc.

ok landry@@, sebastiap@@
@
text
@$OpenBSD: patch-generic_tclStrToD_c,v 1.2 2010/06/07 18:12:05 jasper Exp $
--- generic/tclStrToD.c.orig	Thu Jul 16 22:50:54 2009
+++ generic/tclStrToD.c	Thu Jun  3 21:56:48 2010
@@@@ -73,7 +73,7 @@@@ typedef unsigned int fpu_control_t __attribute__ ((__m
  * MIPS floating-point units need special settings in control registers
  * to use gradual underflow as we expect.
  */
-#if defined(__mips)
+#if defined(__sgi) && defined(_COMPILER_VERSION)
 #include <sys/fpu.h>
 #endif
 /*
@@@@ -947,12 +947,14 @@@@ TclParseNumber(
 	case sINFIN:
 	case sINFINI:
 	case sINFINIT:
+#ifdef IEEE_FLOATING_POINT
 	case sN:
 	case sNA:
 	case sNANPAREN:
 	case sNANHEX:
 	    Tcl_Panic("TclParseNumber: bad acceptState %d parsing '%s'",
 		    acceptState, bytes);
+#endif
 
 	case BINARY:
 	    shift = numTrailZeros;
@@@@ -1134,11 +1136,13 @@@@ TclParseNumber(
 	    objPtr->typePtr = &tclDoubleType;
 	    break;
 
+#ifdef IEEE_FLOATING_POINT
 	case sNAN:
 	case sNANFINISH:
 	    objPtr->internalRep.doubleValue = MakeNaN(signum, significandWide);
 	    objPtr->typePtr = &tclDoubleType;
 	    break;
+#endif
 
 	case INITIAL:
 	    /* This case only to silence compiler warning */
@@@@ -2166,7 +2170,7 @@@@ TclInitDoubleConversion(void)
     } bitwhack;
 #endif
 
-#if defined(__mips)
+#if defined(__sgi) && defined(_COMPILER_VERSION)
     union fpc_csr mipsCR;
 
     mipsCR.fc_word = get_fpc_csr();
@


1.2
log
@- make mips64 a bit happier, still fails on vax though

from sebastian reitenbach
ok stuart cassoff (maintainer)
@
text
@d1 1
a1 1
$OpenBSD: patch-generic_tclStrToD_c,v 1.1 2009/11/22 22:58:30 jasper Exp $
@


1.1
log
@- fix build on mips64
@
text
@d1 3
a3 3
$OpenBSD$
--- generic/tclStrToD.c.orig	Sun Nov 22 13:37:00 2009
+++ generic/tclStrToD.c	Sun Nov 22 13:39:08 2009
d9 1
a9 1
+#if defined(__mips) && !defined(__OpenBSD__)
d13 30
a42 1
@@@@ -2166,7 +2166,7 @@@@ TclInitDoubleConversion(void)
d47 1
a47 1
+#if defined(__mips) && !defined(__OpenBSD__)
@

