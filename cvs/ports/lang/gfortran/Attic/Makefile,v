head	1.36;
access;
symbols
	OPENBSD_6_0:1.35.0.2
	OPENBSD_6_0_BASE:1.35
	OPENBSD_5_9:1.32.0.2
	OPENBSD_5_9_BASE:1.32
	OPENBSD_5_8:1.31.0.4
	OPENBSD_5_8_BASE:1.31
	OPENBSD_5_7:1.29.0.2
	OPENBSD_5_7_BASE:1.29
	OPENBSD_5_6:1.27.0.2
	OPENBSD_5_6_BASE:1.27
	OPENBSD_5_5:1.25.0.2
	OPENBSD_5_5_BASE:1.25
	OPENBSD_5_4:1.22.0.2
	OPENBSD_5_4_BASE:1.22
	OPENBSD_5_3:1.18.0.2
	OPENBSD_5_3_BASE:1.18
	OPENBSD_5_2:1.14.0.2
	OPENBSD_5_2_BASE:1.14
	OPENBSD_5_1_BASE:1.12
	OPENBSD_5_1:1.12.0.2
	OPENBSD_5_0:1.11.0.2
	OPENBSD_5_0_BASE:1.11
	OPENBSD_4_9:1.9.0.2
	OPENBSD_4_9_BASE:1.9
	steven-20101010:1.1.1.1
	steven:1.1.1;
locks; strict;
comment	@# @;


1.36
date	2016.08.25.15.42.20;	author dcoppa;	state dead;
branches;
next	1.35;
commitid	RePdFa2fRR1lD9Py;

1.35
date	2016.05.12.01.17.13;	author naddy;	state Exp;
branches;
next	1.34;
commitid	yWplpZyyaU1NC3LP;

1.34
date	2016.04.26.22.23.24;	author naddy;	state Exp;
branches;
next	1.33;
commitid	1PG08uruXS3Va2G5;

1.33
date	2016.03.11.20.07.49;	author naddy;	state Exp;
branches;
next	1.32;
commitid	2plBeQwqdkxJp7aF;

1.32
date	2015.12.20.00.16.27;	author naddy;	state Exp;
branches;
next	1.31;
commitid	7FwUBfDRx93p0qtP;

1.31
date	2015.06.17.20.03.11;	author sthen;	state Exp;
branches;
next	1.30;
commitid	ASHe8W1wzY7eB3KC;

1.30
date	2015.03.19.20.25.26;	author naddy;	state Exp;
branches;
next	1.29;
commitid	zN8twHQGaJf3YJpT;

1.29
date	2015.01.02.14.26.12;	author sthen;	state Exp;
branches;
next	1.28;
commitid	opt64GLzbD0TGQDJ;

1.28
date	2014.12.30.21.50.24;	author landry;	state Exp;
branches;
next	1.27;
commitid	S07Q8URJzYgrU6Yg;

1.27
date	2014.07.16.12.35.23;	author espie;	state Exp;
branches;
next	1.26;
commitid	C2ydepHwgMXxFvHx;

1.26
date	2014.03.23.17.30.19;	author pascal;	state Exp;
branches;
next	1.25;

1.25
date	2014.01.18.20.56.53;	author pascal;	state Exp;
branches;
next	1.24;

1.24
date	2014.01.12.22.16.02;	author pascal;	state Exp;
branches;
next	1.23;

1.23
date	2014.01.12.14.58.30;	author naddy;	state Exp;
branches;
next	1.22;

1.22
date	2013.07.07.21.25.30;	author naddy;	state Exp;
branches;
next	1.21;

1.21
date	2013.05.02.07.36.01;	author ajacoutot;	state Exp;
branches;
next	1.20;

1.20
date	2013.03.21.08.46.32;	author ajacoutot;	state Exp;
branches;
next	1.19;

1.19
date	2013.03.11.11.20.27;	author espie;	state Exp;
branches;
next	1.18;

1.18
date	2013.02.01.16.34.36;	author naddy;	state Exp;
branches;
next	1.17;

1.17
date	2012.12.21.18.13.08;	author landry;	state Exp;
branches;
next	1.16;

1.16
date	2012.10.07.20.09.44;	author landry;	state Exp;
branches;
next	1.15;

1.15
date	2012.09.01.00.00.32;	author pascal;	state Exp;
branches;
next	1.14;

1.14
date	2012.06.21.13.56.57;	author sthen;	state Exp;
branches;
next	1.13;

1.13
date	2012.03.29.13.38.40;	author sthen;	state Exp;
branches;
next	1.12;

1.12
date	2012.01.13.00.55.14;	author naddy;	state Exp;
branches;
next	1.11;

1.11
date	2011.07.18.19.06.36;	author naddy;	state Exp;
branches;
next	1.10;

1.10
date	2011.06.21.20.17.53;	author naddy;	state Exp;
branches;
next	1.9;

1.9
date	2011.01.15.01.09.43;	author naddy;	state Exp;
branches;
next	1.8;

1.8
date	2010.11.28.21.30.37;	author jasper;	state Exp;
branches;
next	1.7;

1.7
date	2010.11.17.08.05.17;	author espie;	state Exp;
branches;
next	1.6;

1.6
date	2010.11.07.19.12.42;	author espie;	state Exp;
branches;
next	1.5;

1.5
date	2010.11.06.10.18.38;	author espie;	state Exp;
branches;
next	1.4;

1.4
date	2010.10.19.19.46.12;	author naddy;	state Exp;
branches;
next	1.3;

1.3
date	2010.10.18.19.20.41;	author espie;	state Exp;
branches;
next	1.2;

1.2
date	2010.10.14.08.03.46;	author jasper;	state Exp;
branches;
next	1.1;

1.1
date	2010.10.10.17.39.06;	author steven;	state Exp;
branches
	1.1.1.1;
next	;

1.1.1.1
date	2010.10.10.17.39.06;	author steven;	state Exp;
branches;
next	;


desc
@@


1.36
log
@
Send gfortran to the Attic

ok naddy@@
@
text
@# $OpenBSD: Makefile,v 1.35 2016/05/12 01:17:13 naddy Exp $

ONLY_FOR_ARCHS = ${GCC4_ARCHS}
SYSV =		4.2.1

BROKEN-hppa =	port not contributed
BROKEN-alpha =	configure: error: cannot run C compiled programs.
COMMENT-main =	GNU fortran 77 and fortran 95 compiler
COMMENT-lib =	GNU fortran library

V =		4.2.1
PKGNAME =	gfortran-$V
PKGNAME-main =	gfortran-$V
PKGNAME-lib =	libgfortran-$V
SHARED_LIBS =	gfortran	2.0

REVISION = 16
REVISION-lib = 18

CATEGORIES =	lang math

PERMIT_PACKAGE_CDROM =	Yes

HOMEPAGE =	http://gcc.gnu.org/wiki/GFortran

CONFIG =	${MACHINE_ARCH}-unknown-openbsd${OSREV}
SUBST_VARS +=	CONFIG V

MASTER_SITES =	${MASTER_SITE_GCC:=releases/gcc-$V/}

DISTNAME =	gcc-$V
DISTFILES =	${DISTNAME}.tar.bz2
DIST_SUBDIR =	gcc

USE_GMAKE =	Yes

MULTI_PACKAGES =	-main -lib

WANTLIB-main =		c iberty iconv gmp mpfr
LIB_DEPENDS-main =	devel/mpfr \
			converters/libiconv
WANTLIB-lib =
LIB_DEPENDS-lib =
RUN_DEPENDS-main =	${BASE_PKGPATH},-lib

TEST_DEPENDS =	devel/dejagnu \
			devel/autogen

BUILD_DEPENDS += devel/bison

post-extract:
	echo "# This file automatically generated" >> ${WRKSRC}/libversions
.for l v in ${SHARED_LIBS}
	echo "LIB$l_LTVERSION = -version-info ${v:S/./:/}" >> ${WRKSRC}/libversions
.endfor

CONFIGURE_STYLE =	gnu
MODGNU_CONFIG_GUESS_DIRS =	${WRKSRC} ${WRKSRC}/gcc

LANGS = fortran
CONFIGURE_ENV += am_cv_func_iconv=no
CONFIGURE_ENV += ac_cv_prog_CONFIGURED_M4=/usr/bin/m4
CONFIGURE_ENV += ac_cv_prog_GFORTRAN_FOR_TARGET=no

MAKE_FLAGS =	LIBIBERTY_INCLUDES=${LIBIBERTY_INCLUDES} \
		BUILD_LIBIBERTY=-liberty \
		LIBIBERTY=-liberty \
		LIBDEPS= \
		INSTALL_LIBGCC= LIBGCC= USE_COLLECT2= \
		COMPILERS=f951 \
		LANGUAGES=fortran

# Note: the configure target passes CFLAGS to the configure script anyways.
CFLAGS = -O2

CONFIGURE_ARGS += \
	--verbose \
	--disable-nls  \
	--disable-checking \
	--with-system-zlib \
	--disable-libmudflap \
	--disable-libgomp \
	--disable-tls \
	--with-as=/usr/bin/as \
	--with-ld=/usr/bin/ld \
	--with-gnu-ld \
	--with-gnu-as \
	--enable-threads=posix \
	--enable-wchar_t \
	--enable-languages=${LANGS} \
	--with-gmp=${LOCALBASE} \
	--with-mpfr=${LOCALBASE} \
	--disable-libssp \
	--disable-bootstrap \
	--with-gnu-as \
	--with-gnu-ld \
	--disable-cpp

SEPARATE_BUILD = Yes

.if ${MACHINE_ARCH} == "amd64"
PKG_ARGS += -DPIC=1
.else
PKG_ARGS += -DPIC=0
.endif

post-install:
	ln -sf /usr/lib/gcc-lib/${CONFIG}/${SYSV}/libgcc.a ${PREFIX}/lib/gcc/${CONFIG}/$V/libgcc.a
	ln -sf /usr/lib/gcc-lib/${CONFIG}/${SYSV}/cc1 ${PREFIX}/libexec/gcc/${CONFIG}/$V/cc1
	${INSTALL_MAN} ${WRKBUILD}/gcc/doc/gfortran.1 ${PREFIX}/man/man1/gfortran.1

.include <bsd.port.mk>
@


1.35
log
@bump for plist changes 5.9 -> 6.0
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.34 2016/04/26 22:23:24 naddy Exp $
@


1.34
log
@replace libiconv module
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.33 2016/03/11 20:07:49 naddy Exp $
d17 2
a18 2
REVISION = 15
REVISION-lib = 17
@


1.33
log
@garbage collect CONFIGURE_SHARED
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.32 2015/12/20 00:16:27 naddy Exp $
d18 1
a18 1
REVISION-lib = 16
d39 1
a39 3
MODULES =		converters/libiconv

WANTLIB-main =		${MODLIBICONV_WANTLIB} c iberty gmp mpfr
d41 1
a41 1
			${MODLIBICONV_LIB_DEPENDS}
@


1.32
log
@bump for plist changes 5.8 -> 5.9
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.31 2015/06/17 20:03:11 sthen Exp $
d99 1
a99 2
	--disable-cpp \
	${CONFIGURE_SHARED}
@


1.31
log
@port REVISION bumps as base has moved to 5.8
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.30 2015/03/19 20:25:26 naddy Exp $
d17 2
a18 2
REVISION = 14
REVISION-lib = 15
@


1.30
log
@fold lib-only PFRAG.shared into PLIST, and some related cleanups
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.29 2015/01/02 14:26:12 sthen Exp $
d17 2
a18 2
REVISION = 13
REVISION-lib = 14
d31 1
a31 1
DISTNAME =   	gcc-$V
d48 1
a48 1
TEST_DEPENDS = 	devel/dejagnu \
@


1.29
log
@bump REVISION for 5.7
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.28 2014/12/30 21:50:24 landry Exp $
d18 1
@


1.28
log
@Mark BROKEN-alpha a bunch of ports that reliably failed (!) to build in
the past 3 bulks, or forever.

Various reasons: no d^Hrecent compiler available, base gcc generating
nice internal compiler errors, no atomic ops, etc, etc.

While here, mark all webkits as BROKEN-hppa, since this also requires
clang or g++ 4.7. Our g++ 4.8 port only builds on
i386|amd64|powerpc|sparc64 anyway...

if you're interested^Wbored to death, full past logs at
http://build-failures.rhaalovely.net/alpha/...
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.27 2014/07/16 12:35:23 espie Exp $
d17 1
a17 1
REVISION = 12
@


1.27
log
@more 5.6 bumps
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.26 2014/03/23 17:30:19 pascal Exp $
d7 1
@


1.26
log
@Switch GCC in ports to PIE by default on powerpc.
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.25 2014/01/18 20:56:53 pascal Exp $
d16 1
a16 1
REVISION = 11
@


1.25
log
@Unbreak on powerpc by syncing backend with base.

ok landry@@
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.24 2014/01/12 22:16:02 pascal Exp $
d16 1
a16 1
REVISION = 10
@


1.24
log
@Switch ports gcc to PIE on i386.

ok sthen@@
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.23 2014/01/12 14:58:30 naddy Exp $
a3 1
BROKEN-powerpc = Segmentation fault during build
@


1.23
log
@bump for plist changes 5.4 -> 5.5
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.22 2013/07/07 21:25:30 naddy Exp $
d17 1
a17 1
REVISION = 9
@


1.22
log
@bump for plist changes 5.3 -> 5.4
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.21 2013/05/02 07:36:01 ajacoutot Exp $
d17 1
a17 1
REVISION = 8
@


1.21
log
@Mark BROKEN on powerpc.
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.20 2013/03/21 08:46:32 ajacoutot Exp $
d17 1
a17 1
REVISION = 7
@


1.20
log
@USE_LIBTOOL=Yes is the default now.
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.19 2013/03/11 11:20:27 espie Exp $
d4 1
@


1.19
log
@PERMIT_* / REGRESS->TEST sweep
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.18 2013/02/01 16:34:36 naddy Exp $
a32 1
USE_LIBTOOL =	Yes
@


1.18
log
@bump for plist changes 5.2 -> 5.3
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.17 2012/12/21 18:13:08 landry Exp $
a19 2
PERMIT_PACKAGE_FTP =	Yes
PERMIT_DISTFILES_FTP =	Yes
a20 1
PERMIT_DISTFILES_CDROM =Yes
d47 1
a47 1
REGRESS_DEPENDS = 	devel/dejagnu \
@


1.17
log
@Mark as BROKEN-hppa: never built there.
There should probably be a easy fix, but that'd involve a brave soul digging
into the patch maze.
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.16 2012/10/07 20:09:44 landry Exp $
d16 1
a16 1
REVISION = 6
@


1.16
log
@Sync the config/openbsd.h and config/sparc/openbsd64.h patches with
respectively r1.9 and r1.6 of base gcc ones adding #define
NO_IMPLICIT_EXTERN_C. While here add the missing #define
NO_UNSAFE_BUILTINS to gfortran/gcc 4.2, Bump all REVISIONs.
ok sthen@@
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.15 2012/09/01 00:00:32 pascal Exp $
d6 1
@


1.15
log
@Patch GCC and derived ports to use PIE by default on the same architectures it
is enabled on in base; except for gcc 3.3, which does not have PIE support and
therefore needs to pass -nopie to the linker.

Also, sync powerpc pthread specs with base.  From Brad.

ok naddy@@
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.14 2012/06/21 13:56:57 sthen Exp $
d15 1
a15 1
REVISION = 5
@


1.14
log
@bump for plist changes 5.1 -> 5.2
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.13 2012/03/29 13:38:40 sthen Exp $
d15 1
a15 1
REVISION = 4
@


1.13
log
@Change SEPARATE_BUILD=(concurrent|simple) to Yes; bsd.port.mk doesn't
make a distinction between these.  ok aja@@ dcoppa@@
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.12 2012/01/13 00:55:14 naddy Exp $
d15 1
a15 2
REVISION-main = 3
REVISION-lib =	3
@


1.12
log
@bump revision for plist changes 5.0 -> 5.1
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.11 2011/07/18 19:06:36 naddy Exp $
d104 1
a104 1
SEPARATE_BUILD = simple
@


1.11
log
@bump revision for plist changes 4.9 -> 5.0
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.10 2011/06/21 20:17:53 naddy Exp $
d15 2
a16 2
REVISION-main = 2
REVISION-lib =	2
@


1.10
log
@simply install the source man page
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.9 2011/01/15 01:09:43 naddy Exp $
d15 2
a16 2
REVISION-main = 1
REVISION-lib =	1
@


1.9
log
@bump revision for plist changes 4.8 -> 4.9
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.8 2010/11/28 21:30:37 jasper Exp $
d115 1
a115 1
	mandoc ${WRKBUILD}/gcc/doc/gfortran.1 >${PREFIX}/man/cat1/gfortran.0
@


1.8
log
@- add missing conflict markers between g95 and (lib)gfortran.

ok steven@@
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.7 2010/11/17 08:05:17 espie Exp $
d15 2
a16 2
REVISION-main = 0
REVISION-lib =	0
@


1.7
log
@new depends
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.6 2010/11/07 19:12:42 espie Exp $
d14 3
@


1.6
log
@convert WANTLIB on geo/lang
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.5 2010/11/06 10:18:38 espie Exp $
d41 1
a41 1
LIB_DEPENDS-main =	::devel/mpfr \
d45 1
a45 1
RUN_DEPENDS-main =	::${BASE_PKGPATH},-lib
d47 2
a48 2
REGRESS_DEPENDS = 	::devel/dejagnu \
			::devel/autogen
d50 1
a50 1
BUILD_DEPENDS += :bison-*:devel/bison
@


1.5
log
@convert libiconv to new wantlib
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.4 2010/10/19 19:46:12 naddy Exp $
d40 2
a41 2
WANTLIB-main =		${MODLIBICONV_WANTLIB} c iberty gmp
LIB_DEPENDS-main =	mpfr::devel/mpfr \
@


1.4
log
@no need for groff, we explicitly use mandoc
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.3 2010/10/18 19:20:41 espie Exp $
d40 1
a40 1
WANTLIB-main =		c iberty gmp
d43 1
@


1.3
log
@USE_GROFF=Yes
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.2 2010/10/14 08:03:46 jasper Exp $
a34 1
USE_GROFF =	Yes
@


1.2
log
@- use global MASTER_SITE_GCC
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.1.1.1 2010/10/10 17:39:06 steven Exp $
d35 1
@


1.1
log
@Initial revision
@
text
@d1 1
a1 1
# $OpenBSD$
a25 13

MASTER_SITE_GCC += ftp://gcc.gnu.org/pub/gcc/
MASTER_SITE_GCC += ftp://ftp.uvsq.fr/pub/gcc/
MASTER_SITE_GCC += ftp://gd.tuwien.ac.at/gnu/gcc/
MASTER_SITE_GCC += ftp://gd.tuwien.ac.at/gnu/gcc/
MASTER_SITE_GCC += ftp://ftp.fu-berlin.de/unix/languages/gcc/
MASTER_SITE_GCC += ftp://ftp.gwdg.de/pub/linux/gcc/
MASTER_SITE_GCC += ftp://ftp.mpi-sb.mpg.de/pub/gnu/mirror/gcc.gnu.org/pub/gcc/
MASTER_SITE_GCC += ftp://ftp.sunet.se/pub/gnu/gcc/
MASTER_SITE_GCC += ftp://ftp.ntua.gr/pub/gnu/gcc/
MASTER_SITE_GCC += ftp://ftp.nluug.nl/pub/languages/gcc/
MASTER_SITE_GCC += ftp://ftp.dti.ad.jp/pub/lang/gcc/
MASTER_SITE_GCC += ftp://sunsite.icm.edu.pl/pub/programming/egcs/
@


1.1.1.1
log
@import separate port of gfortran 4.2.1, in sync with the base compiler.
meant to be used on archs that have gcc4 in base, this doesn't require a
full gcc build from ports, and provides libgfortran as a subpackage.

idea from espie some months ago.
@
text
@@
