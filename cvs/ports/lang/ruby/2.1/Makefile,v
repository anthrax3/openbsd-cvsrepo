head	1.26;
access;
symbols
	OPENBSD_6_0:1.23.0.2
	OPENBSD_6_0_BASE:1.23
	OPENBSD_5_9:1.17.0.2
	OPENBSD_5_9_BASE:1.17
	OPENBSD_5_8:1.15.0.4
	OPENBSD_5_8_BASE:1.15
	OPENBSD_5_7:1.13.0.2
	OPENBSD_5_7_BASE:1.13
	OPENBSD_5_6:1.7.0.2
	OPENBSD_5_6_BASE:1.7
	OPENBSD_5_5:1.4.0.2
	OPENBSD_5_5_BASE:1.4
	jeremy_2014-Jan-03:1.1.1.1
	jeremy:1.1.1;
locks; strict;
comment	@# @;


1.26
date	2016.11.04.17.03.29;	author jeremy;	state Exp;
branches;
next	1.25;
commitid	6NEB0BJfBliJTo3p;

1.25
date	2016.09.01.14.23.58;	author jeremy;	state Exp;
branches;
next	1.24;
commitid	lxH8rPq0pLJAEECJ;

1.24
date	2016.08.19.19.09.34;	author jeremy;	state Exp;
branches;
next	1.23;
commitid	9VhI2kMdFGNKcRa8;

1.23
date	2016.07.15.15.53.05;	author jeremy;	state Exp;
branches;
next	1.22;
commitid	J7Wr9v5DZaPhA8g4;

1.22
date	2016.07.15.15.39.04;	author jeremy;	state Exp;
branches;
next	1.21;
commitid	fY3F87G0mPqpIT2h;

1.21
date	2016.06.29.16.14.42;	author espie;	state Exp;
branches;
next	1.20;
commitid	c1yQMbJbfo0CFBcL;

1.20
date	2016.04.07.14.24.30;	author jeremy;	state Exp;
branches;
next	1.19;
commitid	sNZiQvcTwrdDIsnx;

1.19
date	2016.03.30.16.47.34;	author visa;	state Exp;
branches;
next	1.18;
commitid	2FcdrAHQRh1KQhqd;

1.18
date	2016.02.29.20.46.54;	author jeremy;	state Exp;
branches;
next	1.17;
commitid	JkjyEbujZnqp0jTC;

1.17
date	2015.12.18.17.39.25;	author jeremy;	state Exp;
branches;
next	1.16;
commitid	uS4XWexeyGwW1ihW;

1.16
date	2015.08.22.15.13.41;	author jeremy;	state Exp;
branches;
next	1.15;
commitid	FoCwCLC5Pv6N3709;

1.15
date	2015.06.29.18.55.03;	author jeremy;	state Exp;
branches
	1.15.4.1;
next	1.14;
commitid	ZSu9FOSGfcImiO4D;

1.14
date	2015.04.15.21.59.38;	author jeremy;	state Exp;
branches;
next	1.13;
commitid	b38b5JXXtUgRgp8u;

1.13
date	2015.02.17.17.18.22;	author jeremy;	state Exp;
branches
	1.13.2.1;
next	1.12;
commitid	RiT8cvXYtnMPpiW2;

1.12
date	2014.11.15.11.36.14;	author sebastia;	state Exp;
branches;
next	1.11;
commitid	kbKR4WYuDMFQWScP;

1.11
date	2014.11.14.17.37.52;	author jeremy;	state Exp;
branches;
next	1.10;
commitid	B5yEoxgiQ8Kzhop2;

1.10
date	2014.11.01.04.53.09;	author jeremy;	state Exp;
branches;
next	1.9;
commitid	cb18tzSW9HVWNDMS;

1.9
date	2014.10.15.02.06.36;	author jeremy;	state Exp;
branches;
next	1.8;
commitid	YbqGQnpgercW6GRD;

1.8
date	2014.09.22.15.15.41;	author jeremy;	state Exp;
branches;
next	1.7;
commitid	ffV02bTjJPwa9v8O;

1.7
date	2014.05.12.00.20.41;	author jeremy;	state Exp;
branches
	1.7.2.1;
next	1.6;

1.6
date	2014.03.18.07.25.53;	author jasper;	state Exp;
branches;
next	1.5;

1.5
date	2014.03.11.20.10.40;	author jeremy;	state Exp;
branches;
next	1.4;

1.4
date	2014.02.12.22.41.43;	author jeremy;	state Exp;
branches
	1.4.2.1;
next	1.3;

1.3
date	2014.01.11.22.29.31;	author jeremy;	state Exp;
branches;
next	1.2;

1.2
date	2014.01.08.18.31.03;	author jeremy;	state Exp;
branches;
next	1.1;

1.1
date	2014.01.03.17.51.52;	author jeremy;	state Exp;
branches
	1.1.1.1;
next	;

1.1.1.1
date	2014.01.03.17.51.52;	author jeremy;	state Exp;
branches;
next	;

1.4.2.1
date	2014.11.17.10.21.50;	author jasper;	state Exp;
branches;
next	;
commitid	pGV5LpHnyFLnV1OJ;

1.7.2.1
date	2014.11.17.10.15.29;	author jasper;	state Exp;
branches;
next	1.7.2.2;
commitid	ZLz9L4D7WtOtgDkN;

1.7.2.2
date	2015.04.16.18.48.53;	author jeremy;	state Exp;
branches;
next	;
commitid	SvtHb7S3fP5jbSUW;

1.13.2.1
date	2015.04.21.10.32.42;	author jasper;	state Exp;
branches;
next	1.13.2.2;
commitid	lReEEhWci49O9H8q;

1.13.2.2
date	2015.06.30.07.51.30;	author jasper;	state Exp;
branches;
next	;
commitid	RxUuSElzM4b0qJqT;

1.15.4.1
date	2015.12.24.11.21.09;	author jasper;	state Exp;
branches;
next	;
commitid	jqoi1yLUecUexpum;


desc
@@


1.26
log
@Add a couple directories to the PLIST

These directories are needed to that installing a ruby gem ext port and
then remove the ruby package doesn't leave directories around. This is
only a partial fix, the ruby gem ext ports all need a similar fix.

Problem pointed out by and feedback from pirofti@@
@
text
@# $OpenBSD: Makefile,v 1.25 2016/09/01 14:23:58 jeremy Exp $

COMMENT-main =		object oriented script language with threads
COMMENT-gdbm =		gdbm interface for ruby
COMMENT-tk =		tk interface for ruby
COMMENT-ri_docs =	ri documentation files for ruby

VERSION =		2.1.9
RUBYLIBREV =		2.1
DISTNAME =		ruby-${VERSION}

SHARED_LIBS =		ruby21	1.2
PKGNAME-main =		ruby-${VERSION}
PKGNAME-gdbm =		ruby21-gdbm-${VERSION}
PKGNAME-tk =		ruby21-tk-${VERSION}
PKGNAME-ri_docs =	ruby21-ri_docs-${VERSION}

REVISION-main =		3
PKG_ARCH-ri_docs =	*
WANTLIB-ri_docs =	# empty

NEXTVER =		2.2
PKGSPEC-main =		ruby->=${RUBYLIBREV},<${NEXTVER}

CONFIGURE_ARGS =	--program-suffix=21 \
			--with-soname=ruby21 \
			--with-ruby-version=minor \
			--with-mantype=doc \
			--enable-pthread \
			--enable-ipv6 \
			--disable-option-checking

CONFIGURE_ENV =		LIBruby21_VERSION=${LIBruby21_VERSION} \
			ac_cv_prog_DOXYGEN="" \
			ac_cv_prog_DOT="" \
			DLDFLAGS="-L${LOCALBASE}/lib"

MAKE_ENV =		DLDFLAGS="-I${LOCALBASE}/lib"

ALL_TARGET =		V=1 main
INSTALL_TARGET =	V=1 install-nodoc

WANTLIB-main =		c crypto ffi gmp m ncurses pthread readline ssl \
			util yaml z
LIB_DEPENDS-main =	devel/gmp \
			devel/libyaml \
			devel/libffi

PSEUDO_FLAVORS=		no_tk no_ri_docs bootstrap
# Do not build the RI docs on slow arches
# on alpha and hppa: miniruby abort trap when generating rdoc
.if ${MACHINE_ARCH:Malpha} || ${MACHINE_ARCH:Marm} || ${MACHINE_ARCH:Mhppa}
FLAVOR?=		no_ri_docs bootstrap
.else
FLAVOR?=
.endif

MULTI_PACKAGES =	-main -gdbm -tk -ri_docs
.include <bsd.port.arch.mk>

WANTLIB-gdbm =		c m gdbm gmp pthread ruby21
LIB_DEPENDS-gdbm =	databases/gdbm \
			devel/gmp \
			lang/ruby/${REV},-main>=${VERSION},<${NEXTVER}
RUN_DEPENDS-gdbm =

.if ${BUILD_PACKAGES:M-tk}
CONFIGURE_ARGS+=	--with-tcl-include=${LOCALBASE}/include/tcl8.5 \
			--with-tk-include=${LOCALBASE}/include/tk8.5 \
			--with-tcllib=tcl85 \
			--with-tklib=tk85 \
			--with-X11-dir=${X11BASE}
WANTLIB-tk =		X11 c gmp m pthread ruby21 tcl85 tk85
LIB_DEPENDS-tk =	tk->=8.5,<8.6:x11/tk/8.5 \
			devel/gmp \
			lang/ruby/${REV},-main>=${VERSION},<${NEXTVER}
RUN_DEPENDS-tk =
.endif

.if ${BUILD_PACKAGES:M-ri_docs}
ALL_TARGET +=		rdoc
INSTALL_TARGET +=	install-doc
.endif

SUBST_VARS +=		VERSION RUBYLIBREV

TEST_DEPENDS =		${FULLPKGNAME-main}:${BUILD_PKGPATH}

pre-install:
	find ${WRKSRC} -name '*.orig' -print0 | xargs -0r rm
	${INSTALL_DATA_DIR} ${PREFIX}/share/doc/ruby \
		${PREFIX}/lib/ruby/gems/${RUBYLIBREV}/extensions/${SUB} \
		${PREFIX}/lib/ruby/gems/${RUBYLIBREV}/extensions/${SUB}/${RUBYLIBREV}

post-install:
	${FIX_RBCONFIG}

do-test:
	-cd ${WRKSRC} && make test-sample
	-cd ${WRKSRC} && make btest-ruby
	cd ${WRKSRC} && make test-all TESTOPTS="-v -q -x test/ruby/test_io.rb \
		-x test/net/http/test_http.rb"

.include <bsd.port.mk>
@


1.25
log
@Remove references to sparc and vax
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.24 2016/08/19 19:09:34 jeremy Exp $
d18 1
a18 1
REVISION-main =		2
d91 3
a93 1
	${INSTALL_DATA_DIR} ${PREFIX}/share/doc/ruby
@


1.24
log
@Add USE_WXNEEDED to ruby, to get devel/ruby-therubyracer working

Original diff from awolk@@, OK sthen@@

Change to use USE_WXNEEDED by me
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.23 2016/07/15 15:53:05 jeremy Exp $
d52 1
a52 1
.if ${MACHINE_ARCH:Malpha} || ${MACHINE_ARCH:Marm} || ${MACHINE_ARCH:Mhppa} || ${MACHINE_ARCH:Msparc} || ${MACHINE_ARCH:Mvax}
@


1.23
log
@Fix REVISION-main bumps
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.22 2016/07/15 15:39:04 jeremy Exp $
d18 1
a18 1
REVISION-main =		1
@


1.22
log
@Use shadow versions of password functions
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.21 2016/06/29 16:14:42 espie Exp $
d18 1
a18 1
REVISION-main =		0
a20 2

REVISION-main =		0
@


1.21
log
@add is-branch to all trivial ports that exist as multiple branches.
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.20 2016/04/07 14:24:30 jeremy Exp $
d21 2
@


1.20
log
@Update to ruby 2.1.9
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.19 2016/03/30 16:47:34 visa Exp $
d18 1
@


1.19
log
@Re-enable on mips64.

OK jasper@@
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.18 2016/02/29 20:46:54 jeremy Exp $
d8 1
a8 1
VERSION =		2.1.8
@


1.18
log
@Make dpb not try to build -ri_docs subpackages on slow arches

The previous way was bogus.  Use bsd.port.arch.mk to remove
MULTI_PACKAGES instead of having the lack of no_* FLAVOR add them.

Change the no_x11 PSUEDO_FLAVOR to no_tk, since what it does is turn
off the -tk subpackage.

Remove post-install target from Makefile.inc, and use a manually
post-install in every version.  This is necessary due to
bsd.port.arch.mk usage.

Noticed by tobiasu@@
Guidance from espie@@
@
text
@d1 1
a1 3
# $OpenBSD: Makefile,v 1.17 2015/12/18 17:39:25 jeremy Exp $

BROKEN-mips64 =		miniruby spins on rbconfig.rb
@


1.17
log
@Update to ruby 2.1.8, fixing CVE-2015-7551

Bump lib minor due to added function.  Drop a couple of patches
included upstream.
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.16 2015/08/22 15:13:41 jeremy Exp $
d50 1
a50 1
PSEUDO_FLAVORS=		no_x11 no_ri_docs
d54 1
a54 1
FLAVOR?=		no_ri_docs
d59 2
a60 1
MULTI_PACKAGES =	-main -gdbm
d68 1
a68 2
.if !${FLAVOR:Mno_x11}
MULTI_PACKAGES+=	-tk
d81 1
a81 2
.if !${FLAVOR:Mno_ri_docs}
MULTI_PACKAGES +=	-ri_docs
d93 3
@


1.16
log
@Update to 2.1.7
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.15 2015/06/29 18:55:03 jeremy Exp $
d10 1
a10 1
VERSION =		2.1.7
d14 1
a14 1
SHARED_LIBS =		ruby21	1.1
@


1.15
log
@Add fixes for CVE-2015-3900 and CVE-2015-4020

OK jasper@@
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.14 2015/04/15 21:59:38 jeremy Exp $
d10 1
a10 1
VERSION =		2.1.6
a19 1
REVISION-main =		0
@


1.15.4.1
log
@Security fix for CVE-2015-7551
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.15 2015/06/29 18:55:03 jeremy Exp $
d20 1
a20 1
REVISION-main =		1
@


1.14
log
@Update to ruby 2.1.6

Fixes overly permissive matching of hostnames, CVE-2015-1855.
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.13 2015/02/17 17:18:22 jeremy Exp $
d20 1
@


1.13
log
@Add --with-mantype=doc to CONFIGURE_ARGS, to install mdoc manuals
instead of man manuals.  Fixes man rake22, which was broken before.
Remove USE_GROFF as mandoc formats the manuals properly.

While here, fix the xargs usage in pre-install to handle cases
where fake is run after being cleaned.

Issue with rake22 man page reported by naddy@@
Detailed analysis and --with-mantype=doc change from schwarze@@
xargs fix from me
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.12 2014/11/15 11:36:14 sebastia Exp $
d10 1
a10 1
VERSION =		2.1.5
d14 1
a14 1
SHARED_LIBS =		ruby21	1.0
a18 2

REVISION-main =		0
@


1.13.2.1
log
@Backport fix for regression introduced by fix for CVE-2013-4073
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.13 2015/02/17 17:18:22 jeremy Exp $
d20 1
a20 1
REVISION-main =		1
@


1.13.2.2
log
@Security fixes for CVE-2015-3900 and CVE-2015-4020

with jeremy@@
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.13.2.1 2015/04/21 10:32:42 jasper Exp $
d20 1
a20 1
REVISION-main =		2
@


1.12
log
@make the no_ri_docs FLAVOR the default on alpha and hppa, tested with
running puppet on those.

OK jasper@@, jeremy@@
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.11 2014/11/14 17:37:52 jeremy Exp $
d20 2
d31 1
a45 2
USE_GROFF =		Yes

d94 1
a94 1
	find ${WRKSRC} -name '*.orig' -print0 | xargs -0 rm
@


1.11
log
@Update to ruby 2.1.5, fixing CVE-2014-8090

OK jasper@@
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.10 2014/11/01 04:53:09 jeremy Exp $
a2 2
BROKEN-hppa =		miniruby abort trap when generating rdoc
BROKEN-alpha =		miniruby abort trap when generating rdoc
d53 2
a54 1
.if ${MACHINE_ARCH:Marm} || ${MACHINE_ARCH:Msparc} || ${MACHINE_ARCH:Mvax}
@


1.10
log
@Update to ruby 2.1.4

Bump lib major due to struct change.

Add VERSION to SUBST_VARS, since test-unit gem version always matches it.

Remove configure patch for issue fixed upstream.
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.9 2014/10/15 02:06:36 jeremy Exp $
d12 1
a12 1
VERSION =		2.1.4
@


1.9
log
@Allow gem install to work for gems with C extensions.  As a bonus,
remove the need to use FAKE_AS_ROOT = always-wrap.

landry@@ phessler@@ naddy@@ in favor
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.8 2014/09/22 15:15:41 jeremy Exp $
d12 1
a12 1
VERSION =		2.1.3
d16 1
a16 1
SHARED_LIBS =		ruby21	0.0
a20 1
REVISION-main =		0
d89 1
a89 1
SUBST_VARS +=		RUBYLIBREV
@


1.8
log
@Update to ruby 2.1.3.

Add patch to work around bash-specific syntax in configure.
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.7 2014/05/12 00:20:41 jeremy Exp $
d21 1
a95 2

post-install:
@


1.7
log
@Update to ruby 2.1.2

OK gsoares@@
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.6 2014/03/18 07:25:53 jasper Exp $
d12 1
a12 1
VERSION =		2.1.2
@


1.7.2.1
log
@security fix for CVE-2014-8090

committing on behalf of jeremy@@
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.7 2014/05/12 00:20:41 jeremy Exp $
a20 1
REVISION-main =		0
@


1.7.2.2
log
@Add patch to fix overly permissive matching of hostnames, CVE-2015-1855.
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.7.2.1 2014/11/17 10:15:29 jasper Exp $
d21 1
a21 1
REVISION-main =		1
@


1.6
log
@mark broken on mips64
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.5 2014/03/11 20:10:40 jeremy Exp $
d12 1
a12 1
VERSION =		2.1.1
@


1.5
log
@Update to ruby 2.1.1

Remove some patches applied upstream.
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.4 2014/02/12 22:41:43 jeremy Exp $
d5 1
@


1.4
log
@Unbreak ruby 1.9+ on sparc64 by disabling the peephole optimizer, which
was the cause of the previous occassional segfaults.

Thanks to landry@@ for access to a sparc64 box

OK landry@@, sthen@@, naddy@@
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.3 2014/01/11 22:29:31 jeremy Exp $
d11 1
a11 1
VERSION =		2.1.0
a19 2

REVISION-main =		0
@


1.4.2.1
log
@security fix for CVE-2014-8090

committing on behalf of jeremy@@
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.4 2014/02/12 22:41:43 jeremy Exp $
d21 1
a21 1
REVISION-main =		1
@


1.3
log
@Make gem extension directory not include ruby tiny version, to avoid
issues when updating to 2.1.1.
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.2 2014/01/08 18:31:03 jeremy Exp $
a2 1
BROKEN-sparc64	=	segfaults during build
@


1.2
log
@Update MASTER_SITES for ruby, as the previous locations no longer work.
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.1.1.1 2014/01/03 17:51:52 jeremy Exp $
d21 2
@


1.1
log
@Initial revision
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.6 2013/07/17 15:52:55 jeremy Exp $
a20 2

MASTER_SITES =		http://cache.ruby-lang.org/pub/ruby/${RUBYLIBREV}/
@


1.1.1.1
log
@Import ruby 2.1.0

OK landry@@
@
text
@@
