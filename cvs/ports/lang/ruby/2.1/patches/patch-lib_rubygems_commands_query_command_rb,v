head	1.1;
access;
symbols;
locks; strict;
comment	@# @;


1.1
date	2017.09.02.21.32.07;	author jeremy;	state Exp;
branches;
next	;
commitid	94YOOD1Vdp1TrWjQ;


desc
@@


1.1
log
@Backport security patch from ruby 2.2 to ruby 2.1.  Fixes the following
security vulnerabilities:

* Fix a DNS request hijacking vulnerability.
* Fix an ANSI escape sequence vulnerability.
* Fix a DOS vulernerability in the query command.
* Fix a vulnerability in the gem installer that allowed a malicious
  gem to overwrite arbitrary files.
@
text
@$OpenBSD$

Index: lib/rubygems/commands/query_command.rb
--- lib/rubygems/commands/query_command.rb.orig
+++ lib/rubygems/commands/query_command.rb
@@@@ -218,7 +218,7 @@@@ is too hard to use.
         end
       end
 
-      output << make_entry(matching_tuples, platforms)
+      output << clean_text(make_entry(matching_tuples, platforms))
     end
   end
 
@@@@ -336,7 +336,8 @@@@ is too hard to use.
   end
 
   def spec_summary entry, spec
-    entry << "\n\n" << format_text(spec.summary, 68, 4)
+    summary = truncate_text(spec.summary, "the summary for #{spec.full_name}")
+    entry << "\n\n" << format_text(summary, 68, 4)
   end
 
 end
@
