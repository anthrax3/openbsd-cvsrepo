head	1.3;
access;
symbols
	OPENBSD_4_2:1.2.0.4
	OPENBSD_4_2_BASE:1.2
	OPENBSD_4_1:1.2.0.2
	OPENBSD_4_1_BASE:1.2
	OPENBSD_3_9:1.1.0.4
	OPENBSD_4_0:1.1.0.2;
locks; strict;
comment	@# @;


1.3
date	2007.12.27.18.32.33;	author bernd;	state dead;
branches;
next	1.2;

1.2
date	2006.12.04.13.26.51;	author bernd;	state Exp;
branches;
next	1.1;

1.1
date	2006.11.02.12.46.13;	author bernd;	state Exp;
branches
	1.1.2.1
	1.1.4.1;
next	;

1.1.2.1
date	2006.11.04.11.09.24;	author sturm;	state Exp;
branches;
next	1.1.2.2;

1.1.2.2
date	2006.12.05.07.24.26;	author sturm;	state Exp;
branches;
next	;

1.1.4.1
date	2006.11.04.11.46.17;	author sturm;	state Exp;
branches;
next	1.1.4.2;

1.1.4.2
date	2006.12.05.06.05.27;	author sturm;	state Exp;
branches;
next	;


desc
@@


1.3
log
@Update to ruby-1.8.6 patchlevel 111.

This is a long overdue update which contains lots of bug fixes and some
security fixes.

Take over maintainership from msf@@.

Tested by many. Thank you very much!

ok jcs@@, msf@@
@
text
@$OpenBSD: patch-lib_cgi_rb,v 1.2 2006/12/04 13:26:51 bernd Exp $

Security fix for CVE-2006-5467 from ruby CVS. Should be fixed in >1.8.5.

http://rubyforge.org/pipermail/mongrel-users/2006-October/001946.html
http://www.securityfocus.com/bid/20777/info

--- lib/cgi.rb.orig	Tue Aug 22 11:38:19 2006
+++ lib/cgi.rb	Mon Dec  4 12:25:09 2006
@@@@ -967,6 +967,7 @@@@ class CGI
     def read_multipart(boundary, content_length)
       params = Hash.new([])
       boundary = "--" + boundary
+      quoted_boundary = Regexp.quote(boundary, "n")
       buf = ""
       bufsize = 10 * 1024
       boundary_end=""
@@@@ -998,7 +999,7 @@@@ class CGI
         end
         body.binmode if defined? body.binmode
 
-        until head and /#{boundary}(?:#{EOL}|--)/n.match(buf)
+        until head and /#{quoted_boundary}(?:#{EOL}|--)/n.match(buf)
 
           if (not head) and /#{EOL}#{EOL}/n.match(buf)
             buf = buf.sub(/\A((?:.|\n)*?#{EOL})#{EOL}/n) do
@@@@ -1018,14 +1019,14 @@@@ class CGI
               else
                 stdinput.read(content_length)
               end
-          if c.nil?
+          if c.nil? || c.empty?
             raise EOFError, "bad content body"
           end
           buf.concat(c)
           content_length -= c.size
         end
 
-        buf = buf.sub(/\A((?:.|\n)*?)(?:[\r\n]{1,2})?#{boundary}([\r\n]{1,2}|--)/n) do
+        buf = buf.sub(/\A((?:.|\n)*?)(?:[\r\n]{1,2})?#{quoted_boundary}([\r\n]{1,2}|--)/n) do
           body.print $1
           if "--" == $2
             content_length = -1
@


1.2
log
@Fix some more security problems in cgi.rb.

ok msf@@
@
text
@d1 1
a1 1
$OpenBSD: patch-lib_cgi_rb,v 1.1 2006/11/02 12:46:13 bernd Exp $
@


1.1
log
@Security fix for CVE-2006-5467 from ruby CVS.

More info:
http://rubyforge.org/pipermail/mongrel-users/2006-October/001946.html
http://www.securityfocus.com/bid/20777/info

ok msf@@
@
text
@d1 1
a1 1
$OpenBSD$
d8 20
a27 3
--- lib/cgi.rb.orig	Tue Oct 31 11:56:58 2006
+++ lib/cgi.rb	Tue Oct 31 11:59:48 2006
@@@@ -1018,7 +1018,7 @@@@ class CGI
d36 8
@


1.1.4.1
log
@MFC:
Security fix for CVE-2006-5467 from ruby CVS.

More info:
http://rubyforge.org/pipermail/mongrel-users/2006-October/001946.html
http://www.securityfocus.com/bid/20777/info
@
text
@d1 1
a1 1
$OpenBSD: patch-lib_cgi_rb,v 1.1 2006/11/02 12:46:13 bernd Exp $
@


1.1.4.2
log
@MFC:
Fix some more security problems in cgi.rb.
@
text
@d1 1
a1 1
$OpenBSD: patch-lib_cgi_rb,v 1.2 2006/12/04 13:26:51 bernd Exp $
d8 3
a10 20
--- lib/cgi.rb.orig	Fri Oct  7 03:01:22 2005
+++ lib/cgi.rb	Tue Dec  5 07:04:55 2006
@@@@ -967,6 +967,7 @@@@ class CGI
     def read_multipart(boundary, content_length)
       params = Hash.new([])
       boundary = "--" + boundary
+      quoted_boundary = Regexp.quote(boundary, "n")
       buf = ""
       bufsize = 10 * 1024
 
@@@@ -997,7 +998,7 @@@@ class CGI
         end
         body.binmode if defined? body.binmode
 
-        until head and /#{boundary}(?:#{EOL}|--)/n.match(buf)
+        until head and /#{quoted_boundary}(?:#{EOL}|--)/n.match(buf)
 
           if (not head) and /#{EOL}#{EOL}/n.match(buf)
             buf = buf.sub(/\A((?:.|\n)*?#{EOL})#{EOL}/n) do
@@@@ -1017,14 +1018,14 @@@@ class CGI
a18 8
           content_length -= c.size
         end
 
-        buf = buf.sub(/\A((?:.|\n)*?)(?:[\r\n]{1,2})?#{boundary}([\r\n]{1,2}|--)/n) do
+        buf = buf.sub(/\A((?:.|\n)*?)(?:[\r\n]{1,2})?#{quoted_boundary}([\r\n]{1,2}|--)/n) do
           body.print $1
           if "--" == $2
             content_length = -1
@


1.1.2.1
log
@MFC:
Security fix for CVE-2006-5467 from ruby CVS.

More info:
http://rubyforge.org/pipermail/mongrel-users/2006-October/001946.html
http://www.securityfocus.com/bid/20777/info
@
text
@d1 1
a1 1
$OpenBSD: patch-lib_cgi_rb,v 1.1 2006/11/02 12:46:13 bernd Exp $
d8 3
a10 3
--- lib/cgi.rb.orig	Fri Oct  7 03:01:22 2005
+++ lib/cgi.rb	Sat Nov  4 11:59:47 2006
@@@@ -1017,7 +1017,7 @@@@ class CGI
@


1.1.2.2
log
@MFC:
Fix some more security problems in cgi.rb.
@
text
@d1 1
a1 1
$OpenBSD: patch-lib_cgi_rb,v 1.2 2006/12/04 13:26:51 bernd Exp $
d8 3
a10 20
--- lib/cgi.rb.orig	Tue Aug 22 11:38:19 2006
+++ lib/cgi.rb	Mon Dec  4 12:25:09 2006
@@@@ -967,6 +967,7 @@@@ class CGI
     def read_multipart(boundary, content_length)
       params = Hash.new([])
       boundary = "--" + boundary
+      quoted_boundary = Regexp.quote(boundary, "n")
       buf = ""
       bufsize = 10 * 1024
       boundary_end=""
@@@@ -998,7 +999,7 @@@@ class CGI
         end
         body.binmode if defined? body.binmode
 
-        until head and /#{boundary}(?:#{EOL}|--)/n.match(buf)
+        until head and /#{quoted_boundary}(?:#{EOL}|--)/n.match(buf)
 
           if (not head) and /#{EOL}#{EOL}/n.match(buf)
             buf = buf.sub(/\A((?:.|\n)*?#{EOL})#{EOL}/n) do
@@@@ -1018,14 +1019,14 @@@@ class CGI
a18 8
           content_length -= c.size
         end
 
-        buf = buf.sub(/\A((?:.|\n)*?)(?:[\r\n]{1,2})?#{boundary}([\r\n]{1,2}|--)/n) do
+        buf = buf.sub(/\A((?:.|\n)*?)(?:[\r\n]{1,2})?#{quoted_boundary}([\r\n]{1,2}|--)/n) do
           body.print $1
           if "--" == $2
             content_length = -1
@


