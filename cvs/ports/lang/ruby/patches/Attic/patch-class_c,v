head	1.6;
access;
symbols
	OPENBSD_4_8:1.5.0.8
	OPENBSD_4_8_BASE:1.5
	OPENBSD_4_7:1.5.0.6
	OPENBSD_4_7_BASE:1.5
	OPENBSD_4_5:1.5.0.4
	OPENBSD_4_6:1.5.0.2
	OPENBSD_4_6_BASE:1.5;
locks; strict;
comment	@# @;


1.6
date	2010.09.23.22.04.13;	author jeremy;	state dead;
branches;
next	1.5;

1.5
date	2009.06.16.09.12.44;	author bernd;	state Exp;
branches
	1.5.4.1;
next	1.4;

1.4
date	2009.04.27.10.54.09;	author bernd;	state Exp;
branches;
next	1.3;

1.3
date	2009.03.07.12.30.17;	author bernd;	state Exp;
branches;
next	1.2;

1.2
date	2009.02.03.21.15.28;	author bernd;	state dead;
branches;
next	1.1;

1.1
date	2009.01.31.09.54.31;	author bernd;	state Exp;
branches;
next	;

1.5.4.1
date	2009.08.19.01.18.10;	author william;	state Exp;
branches;
next	;


desc
@@


1.6
log
@Remove files that I checked out with -r HEAD
@
text
@$OpenBSD: patch-class_c,v 1.5 2009/06/16 09:12:44 bernd Exp $

Fix usage of short-named constants.

http://svn.ruby-lang.org/cgi-bin/viewvc.cgi?view=rev&revision=18485
http://svn.ruby-lang.org/cgi-bin/viewvc.cgi?view=rev&revision=22679
https://bugs.launchpad.net/ubuntu/+source/ruby1.8/+bug/282302

--- class.c.orig	Fri Jan 16 02:58:45 2009
+++ class.c	Wed Jun 10 06:44:43 2009
@@@@ -153,7 +153,7 @@@@ rb_singleton_class_clone(obj)
 		data.klass = obj;
 		break;
 	      default:
-		data.klass = 0;
+		data.klass = Qnil;
 		break;
 	    }
 
@


1.5
log
@Security update to ruby-1.8.6-p369.

Fixes a denial of service vulnerability in the BigDecimal
standard library of Ruby.

http://www.ruby-lang.org/en/news/2009/06/09/dos-vulnerability-in-bigdecimal/
@
text
@d1 1
a1 1
$OpenBSD: patch-class_c,v 1.4 2009/04/27 10:54:09 bernd Exp $
@


1.5.4.1
log
@MFC:

SECURITY FIX

ruby-1.8.6-p369

Resolves many security issues and bugs

Does not contain the arandom change in -current.

ok robert@@, discussed with bernd@@ (thanks!)
@
text
@d1 1
a1 1
$OpenBSD: patch-class_c,v 1.5 2009/06/16 09:12:44 bernd Exp $
@


1.4
log
@Update to ruby-1.8.6.368.

Including security fixes for CVE-2008-1447 and CVE-2007-1558.

Tested by Jeremy Evans, jcs@@, sturm@@ and msf@@. Thank you!
@
text
@d1 1
a1 1
$OpenBSD: patch-class_c,v 1.3 2009/03/07 12:30:17 bernd Exp $
d9 3
a11 3
--- class.c.orig	Sat Jun 28 12:27:21 2008
+++ class.c	Mon Mar  2 13:17:52 2009
@@@@ -150,7 +153,7 @@@@ rb_singleton_class_clone(obj)
@


1.3
log
@Bring back the fix for short-named constants.
This previous problems should be gone now.
(ruby svn r18485 and r22679)

Thanks to Jeremy Evans!
@
text
@d1 1
a1 1
$OpenBSD$
a10 12
@@@@ -62,7 +62,10 @@@@ clone_method(mid, body, data)
     NODE *fbody = body->nd_body;
 
     if (fbody && nd_type(fbody) == NODE_SCOPE) {
-	fbody = rb_copy_node_scope(fbody, ruby_cref);
+	NODE *cref = (NODE*)fbody->nd_rval;
+
+	if (cref) cref = cref->nd_next;
+	fbody = rb_copy_node_scope(fbody, NEW_CREF(data->klass, cref));
     }
     st_insert(data->tbl, mid, (st_data_t)NEW_METHOD(fbody, body->nd_noex));
     return ST_CONTINUE;
@


1.2
log
@Revert last "fix". I causes problems with some Ruby code which worked before.
@
text
@d1 1
a1 1
$OpenBSD: patch-class_c,v 1.1 2009/01/31 09:54:31 bernd Exp $
d6 1
d10 1
a10 1
+++ class.c	Tue Jan 27 09:46:14 2009
d23 9
@


1.1
log
@Fix usage of short-named constants. (ruby svn r18485)

From msf@@.
@
text
@d1 1
a1 1
$OpenBSD$
@

