head	1.1;
access;
symbols
	OPENBSD_5_3:1.1.0.2;
locks; strict;
comment	@# @;


1.1
date	2013.05.20.20.14.29;	author jeremy;	state dead;
branches
	1.1.2.1;
next	;

1.1.2.1
date	2013.05.20.20.14.29;	author jeremy;	state Exp;
branches;
next	;


desc
@@


1.1
log
@file patch-ext_fiddle_function_c was initially added on branch OPENBSD_5_3.
@
text
@@


1.1.2.1
log
@Add fix for CVE-2013-2065: Object taint bypassing in DL and Fiddle

Requested by jasper@@
@
text
@a0 22
$OpenBSD$

Fix CVE-2013-2065.

--- ext/fiddle/function.c.orig	Thu Dec 20 01:45:19 2012
+++ ext/fiddle/function.c	Mon May 20 05:54:19 2013
@@@@ -101,6 +101,15 @@@@ function_call(int argc, VALUE argv[], VALUE self)
 
     TypedData_Get_Struct(self, ffi_cif, &function_data_type, cif);
 
+    if (rb_safe_level() >= 1) {
+	for (i = 0; i < argc; i++) {
+	    VALUE src = argv[i];
+	    if (OBJ_TAINTED(src)) {
+		rb_raise(rb_eSecurityError, "tainted parameter not allowed");
+	    }
+	}
+    }
+
     values = xcalloc((size_t)argc + 1, (size_t)sizeof(void *));
     generic_args = xcalloc((size_t)argc, (size_t)sizeof(fiddle_generic));
 
@

