head	1.52;
access;
symbols
	OPENBSD_5_8:1.51.0.4
	OPENBSD_5_8_BASE:1.51
	OPENBSD_5_7:1.50.0.2
	OPENBSD_5_7_BASE:1.50
	OPENBSD_5_6:1.45.0.2
	OPENBSD_5_6_BASE:1.45
	OPENBSD_5_5:1.43.0.2
	OPENBSD_5_5_BASE:1.43
	OPENBSD_5_4:1.38.0.2
	OPENBSD_5_4_BASE:1.38
	OPENBSD_5_3:1.35.0.2
	OPENBSD_5_3_BASE:1.35
	OPENBSD_5_2:1.26.0.2
	OPENBSD_5_2_BASE:1.26
	OPENBSD_5_1_BASE:1.22
	OPENBSD_5_1:1.22.0.2
	OPENBSD_5_0:1.15.0.2
	OPENBSD_5_0_BASE:1.15
	OPENBSD_4_9:1.11.0.2
	OPENBSD_4_9_BASE:1.11;
locks; strict;
comment	@# @;


1.52
date	2015.08.29.16.25.39;	author jeremy;	state dead;
branches;
next	1.51;
commitid	WYYJd508S3pt2o6T;

1.51
date	2015.04.15.21.58.16;	author jeremy;	state Exp;
branches
	1.51.4.1;
next	1.50;
commitid	f7uSAf7SQUJZjAQo;

1.50
date	2015.02.17.17.18.21;	author jeremy;	state Exp;
branches
	1.50.2.1;
next	1.49;
commitid	RiT8cvXYtnMPpiW2;

1.49
date	2014.11.14.17.40.42;	author jeremy;	state Exp;
branches;
next	1.48;
commitid	w5QYSuruGtyf3NLy;

1.48
date	2014.11.07.15.18.56;	author dcoppa;	state Exp;
branches;
next	1.47;
commitid	DecmTKF6COjtxd8D;

1.47
date	2014.11.01.04.56.09;	author jeremy;	state Exp;
branches;
next	1.46;
commitid	OLKRNFo0COVmX4gE;

1.46
date	2014.10.15.02.06.35;	author jeremy;	state Exp;
branches;
next	1.45;
commitid	YbqGQnpgercW6GRD;

1.45
date	2014.06.25.15.38.39;	author jeremy;	state Exp;
branches
	1.45.2.1;
next	1.44;
commitid	YlfEcXPhXr6QxoVQ;

1.44
date	2014.03.11.20.07.07;	author jeremy;	state Exp;
branches;
next	1.43;

1.43
date	2014.02.12.22.41.43;	author jeremy;	state Exp;
branches
	1.43.2.1;
next	1.42;

1.42
date	2014.01.06.02.25.33;	author jeremy;	state Exp;
branches;
next	1.41;

1.41
date	2013.11.25.14.16.23;	author sthen;	state Exp;
branches;
next	1.40;

1.40
date	2013.11.24.02.24.35;	author jeremy;	state Exp;
branches;
next	1.39;

1.39
date	2013.09.04.18.15.19;	author landry;	state Exp;
branches;
next	1.38;

1.38
date	2013.07.17.15.51.09;	author jeremy;	state Exp;
branches
	1.38.2.1;
next	1.37;

1.37
date	2013.05.17.20.08.35;	author jeremy;	state Exp;
branches;
next	1.36;

1.36
date	2013.03.11.11.20.28;	author espie;	state Exp;
branches;
next	1.35;

1.35
date	2013.02.23.01.22.26;	author jeremy;	state Exp;
branches
	1.35.2.1;
next	1.34;

1.34
date	2013.02.07.19.02.20;	author jeremy;	state Exp;
branches;
next	1.33;

1.33
date	2013.01.23.18.18.41;	author jeremy;	state Exp;
branches;
next	1.32;

1.32
date	2012.12.11.22.20.02;	author jeremy;	state Exp;
branches;
next	1.31;

1.31
date	2012.11.28.21.46.42;	author landry;	state Exp;
branches;
next	1.30;

1.30
date	2012.11.20.16.52.32;	author jeremy;	state Exp;
branches;
next	1.29;

1.29
date	2012.10.24.22.49.05;	author jeremy;	state Exp;
branches;
next	1.28;

1.28
date	2012.10.08.13.17.11;	author jeremy;	state Exp;
branches;
next	1.27;

1.27
date	2012.08.23.19.19.17;	author sthen;	state Exp;
branches;
next	1.26;

1.26
date	2012.04.27.18.40.02;	author jeremy;	state Exp;
branches;
next	1.25;

1.25
date	2012.03.30.19.03.24;	author phessler;	state Exp;
branches;
next	1.24;

1.24
date	2012.03.08.12.13.01;	author ajacoutot;	state Exp;
branches;
next	1.23;

1.23
date	2012.02.28.00.20.41;	author jeremy;	state Exp;
branches;
next	1.22;

1.22
date	2011.12.02.14.36.15;	author espie;	state Exp;
branches;
next	1.21;

1.21
date	2011.11.17.11.47.12;	author jeremy;	state Exp;
branches;
next	1.20;

1.20
date	2011.11.15.00.04.15;	author jeremy;	state Exp;
branches;
next	1.19;

1.19
date	2011.11.09.19.23.35;	author jeremy;	state Exp;
branches;
next	1.18;

1.18
date	2011.11.08.23.38.57;	author jeremy;	state Exp;
branches;
next	1.17;

1.17
date	2011.09.16.10.31.21;	author espie;	state Exp;
branches;
next	1.16;

1.16
date	2011.09.12.18.02.34;	author naddy;	state Exp;
branches;
next	1.15;

1.15
date	2011.07.19.17.08.54;	author jeremy;	state Exp;
branches;
next	1.14;

1.14
date	2011.07.18.19.06.37;	author naddy;	state Exp;
branches;
next	1.13;

1.13
date	2011.05.25.18.20.43;	author jasper;	state Exp;
branches;
next	1.12;

1.12
date	2011.03.07.18.59.18;	author jeremy;	state Exp;
branches;
next	1.11;

1.11
date	2011.01.15.01.09.43;	author naddy;	state Exp;
branches
	1.11.2.1;
next	1.10;

1.10
date	2011.01.06.04.04.37;	author jeremy;	state Exp;
branches;
next	1.9;

1.9
date	2010.11.26.14.44.27;	author espie;	state Exp;
branches;
next	1.8;

1.8
date	2010.11.24.21.28.04;	author jeremy;	state Exp;
branches;
next	1.7;

1.7
date	2010.11.17.08.05.18;	author espie;	state Exp;
branches;
next	1.6;

1.6
date	2010.11.06.10.18.38;	author espie;	state Exp;
branches;
next	1.5;

1.5
date	2010.10.24.21.24.04;	author ajacoutot;	state Exp;
branches;
next	1.4;

1.4
date	2010.10.18.19.20.42;	author espie;	state Exp;
branches;
next	1.3;

1.3
date	2010.10.12.15.39.06;	author jeremy;	state Exp;
branches;
next	1.2;

1.2
date	2010.10.06.18.43.11;	author jeremy;	state Exp;
branches;
next	1.1;

1.1
date	2010.09.23.21.58.50;	author jeremy;	state Exp;
branches;
next	;

1.11.2.1
date	2011.03.09.16.04.57;	author jasper;	state Exp;
branches;
next	1.11.2.2;

1.11.2.2
date	2011.05.25.18.21.18;	author jasper;	state Exp;
branches;
next	;

1.35.2.1
date	2013.05.20.20.14.29;	author jeremy;	state Exp;
branches;
next	1.35.2.2;

1.35.2.2
date	2013.07.18.18.57.35;	author jeremy;	state Exp;
branches;
next	;

1.38.2.1
date	2013.11.26.13.49.05;	author jasper;	state Exp;
branches;
next	1.38.2.2;

1.38.2.2
date	2014.01.06.09.36.32;	author jasper;	state Exp;
branches;
next	;

1.43.2.1
date	2014.11.17.10.21.49;	author jasper;	state Exp;
branches;
next	;
commitid	pGV5LpHnyFLnV1OJ;

1.45.2.1
date	2014.11.17.10.15.29;	author jasper;	state Exp;
branches;
next	1.45.2.2;
commitid	ZLz9L4D7WtOtgDkN;

1.45.2.2
date	2015.04.16.18.48.53;	author jeremy;	state Exp;
branches;
next	;
commitid	SvtHb7S3fP5jbSUW;

1.50.2.1
date	2015.04.21.10.32.41;	author jasper;	state Exp;
branches;
next	;
commitid	lReEEhWci49O9H8q;

1.51.4.1
date	2015.12.24.11.07.57;	author jasper;	state Exp;
branches;
next	;
commitid	6kc0dxBPZGDFkoCJ;


desc
@@


1.52
log
@Send lang/ruby/1.9 to the Attic, now that we are no longer building
extension libraries for ruby 2.0 by default.

OK jasper@@
@
text
@# $OpenBSD: Makefile,v 1.51 2015/04/15 21:58:16 jeremy Exp $

BROKEN-alpha =		miniruby abort trap when generating rdoc

COMMENT-main =		object oriented script language with threads
COMMENT-gdbm =		gdbm interface for ruby
COMMENT-dbm =		Berkley DB interface for ruby
COMMENT-tk =		tk interface for ruby
COMMENT-ri_docs =	ri documentation files for ruby

VERSION =		1.9.3
PATCHLEVEL =		551
RUBYLIBREV =		1.9.1

SHARED_LIBS =		ruby19 1.1
PKGNAME-main =		ruby-${VERSION}.${PATCHLEVEL}
PKGNAME-gdbm =		ruby-gdbm-${VERSION}.${PATCHLEVEL}
PKGNAME-dbm =		ruby-dbm-${VERSION}.${PATCHLEVEL}
PKGNAME-tk =		ruby-tk-${VERSION}.${PATCHLEVEL}
PKGNAME-ri_docs =	ruby-ri_docs-${VERSION}.${PATCHLEVEL}

REVISION-main =		2

PKG_ARCH-ri_docs =	*
WANTLIB-ri_docs =	# empty

PKGSPEC-main =		ruby->=1.9,<1.10

CONFIGURE_ARGS =	--program-suffix=19 \
			--with-soname=ruby19 \
			--with-mantype=doc \
			--enable-pthread \
			--enable-ipv6 \
			--disable-option-checking

CONFIGURE_ENV =		LIBruby19_VERSION=${LIBruby19_VERSION} \
			ac_cv_prog_DOXYGEN="" \
			ac_cv_prog_DOT=""

ALL_TARGET =		V=1 main
INSTALL_TARGET =	V=1 install-nodoc

MODULES =		converters/libiconv

WANTLIB-main =		c crypto ffi m ncurses ncursesw pthread readline ssl \
			termcap util yaml z ${MODLIBICONV_WANTLIB}
LIB_DEPENDS-main =	${MODLIBICONV_LIB_DEPENDS} \
			devel/libyaml \
			devel/libffi
RUN_DEPENDS-main =	${MODLIBICONV_RUN_DEPENDS}

PSEUDO_FLAVORS=		no_x11 no_ri_docs
# Do not build the RI docs on slow arches
.if ${MACHINE_ARCH:Marm} || ${MACHINE_ARCH:Msparc} || ${MACHINE_ARCH:Mvax}
FLAVOR?=		no_ri_docs
.else
FLAVOR?=
.endif

MULTI_PACKAGES =	-main -gdbm -dbm

WANTLIB-gdbm =		c m gdbm pthread ruby19
LIB_DEPENDS-gdbm =	databases/gdbm \
			lang/ruby/${REV},-main>=${VERSION}.${PATCHLEVEL},<1.10
RUN_DEPENDS-gdbm =	

WANTLIB-dbm =		c m pthread ruby19
LIB_DEPENDS-dbm =	lang/ruby/${REV},-main>=${VERSION}.${PATCHLEVEL},<1.10
RUN_DEPENDS-dbm =	
 
.if !${FLAVOR:Mno_x11}
MULTI_PACKAGES+=	-tk
CONFIGURE_ARGS+=	--with-tcl-include=${PREFIX}/include/tcl8.5 \
			--with-tk-include=${PREFIX}/include/tk8.5 \
			--with-tcllib=tcl85 \
			--with-tklib=tk85 \
			--with-X11-dir=${X11BASE}
WANTLIB-tk =		X11 c m pthread ruby19 tcl85 tk85
LIB_DEPENDS-tk =	tk->=8.5,<8.6:x11/tk/8.5 \
			lang/ruby/${REV},-main>=${VERSION}.${PATCHLEVEL},<1.10
RUN_DEPENDS-tk =	
.endif

.if !${FLAVOR:Mno_ri_docs}
MULTI_PACKAGES +=	-ri_docs
ALL_TARGET +=		rdoc
INSTALL_TARGET +=	install-doc
.endif

SUBST_VARS +=		RUBYLIBREV

TEST_DEPENDS =	${FULLPKGNAME-main}:${BUILD_PKGPATH}

pre-install:
	${INSTALL_DATA_DIR} ${PREFIX}/share/doc/ruby

do-test:
	-cd ${WRKSRC} && make test-sample
	-cd ${WRKSRC} && make btest-ruby
	cd ${WRKSRC} && make test-all

.include <bsd.port.mk>
@


1.51
log
@Add patch to fix overly permissive matching of hostnames, CVE-2015-1855.
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.50 2015/02/17 17:18:21 jeremy Exp $
@


1.51.4.1
log
@Security fix for CVE-2015-7551
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.51 2015/04/15 21:58:16 jeremy Exp $
d22 1
a22 1
REVISION-main =		3
@


1.50
log
@Add --with-mantype=doc to CONFIGURE_ARGS, to install mdoc manuals
instead of man manuals.  Fixes man rake22, which was broken before.
Remove USE_GROFF as mandoc formats the manuals properly.

While here, fix the xargs usage in pre-install to handle cases
where fake is run after being cleaned.

Issue with rake22 man page reported by naddy@@
Detailed analysis and --with-mantype=doc change from schwarze@@
xargs fix from me
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.49 2014/11/14 17:40:42 jeremy Exp $
d22 1
a22 1
REVISION-main =		1
@


1.50.2.1
log
@Backport fix for regression introduced by fix for CVE-2013-4073
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.50 2015/02/17 17:18:21 jeremy Exp $
d22 1
a22 1
REVISION-main =		2
@


1.49
log
@Update to ruby 1.9.3-p551, fixing CVE-2014-8090

OK jasper@@
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.48 2014/11/07 15:18:56 dcoppa Exp $
d22 1
a22 1
REVISION-main =		0
d31 1
a43 1
USE_GROFF =		Yes
@


1.48
log
@
Use MAKE or make from ENV to override rbconfig's make.

Backported from 2.1: https://github.com/rubygems/rubygems/commit/f2bad74dda8d8e463a092905f29c943c962d5e68

ok landry@@, jeremy@@ (maintainer)
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.47 2014/11/01 04:56:09 jeremy Exp $
d12 1
a12 1
PATCHLEVEL =		550
@


1.47
log
@Update to ruby 1.9.3-p550

Allow external C extensions to be installed via gem install.
This was missed earlier when changes were made to other ruby
versions.
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.46 2014/10/15 02:06:35 jeremy Exp $
d21 2
@


1.46
log
@Allow gem install to work for gems with C extensions.  As a bonus,
remove the need to use FAKE_AS_ROOT = always-wrap.

landry@@ phessler@@ naddy@@ in favor
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.45 2014/06/25 15:38:39 jeremy Exp $
d12 1
a12 1
PATCHLEVEL =		545
a20 1
REVISION-main =		1
d92 1
a92 1
post-install:
@


1.45
log
@Backport an upstream rubygems patch fixing issues with Gem.refresh.

OK ajacoutot@@
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.44 2014/03/11 20:07:07 jeremy Exp $
d21 1
a21 1
REVISION-main =		0
@


1.45.2.1
log
@security fix for CVE-2014-8090

committing on behalf of jeremy@@
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.45 2014/06/25 15:38:39 jeremy Exp $
d21 1
a21 1
REVISION-main =		1
@


1.45.2.2
log
@Add patch to fix overly permissive matching of hostnames, CVE-2015-1855.
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.45.2.1 2014/11/17 10:15:29 jasper Exp $
d21 1
a21 1
REVISION-main =		2
@


1.44
log
@Update to ruby 1.9.3-p545

Remove rubygems security patch applied upstream.
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.43 2014/02/12 22:41:43 jeremy Exp $
d21 1
@


1.43
log
@Unbreak ruby 1.9+ on sparc64 by disabling the peephole optimizer, which
was the cause of the previous occassional segfaults.

Thanks to landry@@ for access to a sparc64 box

OK landry@@, sthen@@, naddy@@
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.42 2014/01/06 02:25:33 jeremy Exp $
d12 1
a12 1
PATCHLEVEL =		484
a24 2
REVISION-main =		0

d73 2
@


1.43.2.1
log
@security fix for CVE-2014-8090

committing on behalf of jeremy@@
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.43 2014/02/12 22:41:43 jeremy Exp $
d25 1
a25 1
REVISION-main =		1
@


1.42
log
@Add patch to fix algorithmic complexity vulnerabilities CVE-2013-4287
and CVE-2013-4363 in rubygems.
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.41 2013/11/25 14:16:23 sthen Exp $
a2 1
BROKEN-sparc64 =	doesnt reliably build, and depending ports randomly fail to build
@


1.41
log
@kill VMEM_WARNING
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.40 2013/11/24 02:24:35 jeremy Exp $
d25 2
@


1.40
log
@Update to ruby 1.9.3p484, fixing heap overflow in floating point parser
(CVE-2013-4164).
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.39 2013/09/04 18:15:19 landry Exp $
a84 1
VMEM_WARNING =		Yes
@


1.39
log
@Mark as BROKEN-alpha: miniruby abort trap when generating rdoc
(it never actually built/packaged)
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.38 2013/07/17 15:51:09 jeremy Exp $
d13 1
a13 1
PATCHLEVEL =		448
@


1.38
log
@Update to ruby 1.9.3-p448, fixing CVE-2013-4073, with extra patches
backported to fix a regression and restore a function that would
have caused a major bump of libruby19.so. Bumping the minor
libruby19.so due to added functions.
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.37 2013/05/17 20:08:35 jeremy Exp $
d4 1
@


1.38.2.1
log
@backport security fix for CVE-2013-4164

ok sthen@@
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.38 2013/07/17 15:51:09 jeremy Exp $
a20 2

REVISION-main =		0
@


1.38.2.2
log
@security fix for CVE-2013-{4287,4363}
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.38.2.1 2013/11/26 13:49:05 jasper Exp $
d22 1
a22 1
REVISION-main =		1
@


1.37
log
@Update to ruby 1.9.3-p429, with a security fix for CVE-2013-2065
and other minor bugfixes.

Patch bug that crept into build system, already fixed upstream.
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.36 2013/03/11 11:20:28 espie Exp $
d12 1
a12 1
PATCHLEVEL =		429
d15 1
a15 1
SHARED_LIBS =		ruby19 1.0
@


1.36
log
@PERMIT_* / REGRESS->TEST sweep
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.35 2013/02/23 01:22:26 jeremy Exp $
d12 1
a12 1
PATCHLEVEL =		392
@


1.35
log
@Update to ruby 1.9.3-p392, fixing CVE-2013-0269 and a DoS
vulnerability in REXML.

OK jasper@@ sthen@@
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.34 2013/02/07 19:02:20 jeremy Exp $
d89 1
a89 1
REGRESS_DEPENDS =	${FULLPKGNAME-main}:${BUILD_PKGPATH}
d94 1
a94 1
do-regress:
@


1.35.2.1
log
@Add fix for CVE-2013-2065: Object taint bypassing in DL and Fiddle

Requested by jasper@@
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.35 2013/02/23 01:22:26 jeremy Exp $
a23 2

REVISION-main =		0
@


1.35.2.2
log
@Backport security fix for CVE-2013-4073 from ruby svn r41676, along with
fix for regression from r42016.

OK jasper@@
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.35.2.1 2013/05/20 20:14:29 jeremy Exp $
d25 1
a25 1
REVISION-main =		1
@


1.34
log
@Update to ruby 1.9.3-p385.
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.33 2013/01/23 18:18:41 jeremy Exp $
d12 1
a12 1
PATCHLEVEL =		385
@


1.33
log
@Update to ruby 1.9.3-p374.
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.32 2012/12/11 22:20:02 jeremy Exp $
d12 1
a12 1
PATCHLEVEL =		374
@


1.32
log
@In the dbm subpackage, drop dependency on databases/db/v4.  Since ruby
1.9.3, ruby uses the libc dbopen support as the backend for the
dbm extension.
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.31 2012/11/28 21:46:42 landry Exp $
d12 1
a12 1
PATCHLEVEL =		327
a20 2

REVISION-dbm =		0
@


1.31
log
@Mark as BROKEN-sparc64, it doesnt reliably build, and some depending ports
randomly fail to build too. Someone with interest in sparc64 should look
into it, in the meantime it messes up bulk builds.
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.30 2012/11/20 16:52:32 jeremy Exp $
d22 2
d67 2
a68 3
WANTLIB-dbm =		c m db pthread ruby19
LIB_DEPENDS-dbm =	databases/db/v4 \
			lang/ruby/${REV},-main>=${VERSION}.${PATCHLEVEL},<1.10
@


1.30
log
@Update to ruby 1.9.3-p327.
@
text
@d1 3
a3 1
# $OpenBSD: Makefile,v 1.29 2012/10/24 22:49:05 jeremy Exp $
@


1.29
log
@Update to ruby 1.9.3-p286.  Remove security patch included in new
version.  Switch rubygems to handle building of C extension
gems as non-root in more cases.

OK jcs@@
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.28 2012/10/08 13:17:11 jeremy Exp $
d10 1
a10 1
PATCHLEVEL =		286
d60 1
a60 1
			lang/ruby/${REV},-main>=${VERSION}.${PATCHLEVEL}
d65 1
a65 1
			lang/ruby/${REV},-main>=${VERSION}.${PATCHLEVEL}
d75 1
a75 1
			lang/ruby/${REV},-main>=${VERSION}.${PATCHLEVEL}
@


1.28
log
@Backport security fix and test for it from ruby SVN revision 37068.

OK jasper@@
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.27 2012/08/23 19:19:17 sthen Exp $
d10 1
a10 1
PATCHLEVEL =		194
a12 6
REVISION-main =		0
REVISION-dbm =		0
REVISION-gdbm =		0
REVISION-tk =		0
REVISION-ri_docs =	0

d89 3
@


1.27
log
@sync wantlib
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.26 2012/04/27 18:40:02 jeremy Exp $
d13 1
@


1.26
log
@Update to ruby 1.9.3-p194.  Fixes SSL security issues when installing
gems, and has other significant bugfixes.
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.25 2012/03/30 19:03:24 phessler Exp $
d13 5
d25 2
a26 1
PKG_ARCH-ri_docs=	*
d63 1
a63 1
WANTLIB-gdbm =		c m gdbm ruby19
d68 1
a68 1
WANTLIB-dbm =		c m db ruby19
d78 1
a78 1
WANTLIB-tk =		X11 c m ruby19 tcl85 tk85
@


1.25
log
@do not generate RI docs on the "slow" arches.  This takes far too long,
and too much memory.

OK jeremy@@
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.24 2012/03/08 12:13:01 ajacoutot Exp $
d10 1
a10 1
PATCHLEVEL =		125
a18 2

REVISION-main =		0
@


1.24
log
@Garbage collect the /dev/arandom patches.

from Brad
ok landry@@ sthen@@
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.23 2012/02/28 00:20:41 jeremy Exp $
d50 4
d55 1
@


1.23
log
@Update 1.9.3p125, removing some patches included upstream.
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.22 2011/12/02 14:36:15 espie Exp $
d19 2
@


1.22
log
@bye bye FLAVOR:L
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.21 2011/11/17 11:47:12 jeremy Exp $
d10 1
a10 1
PATCHLEVEL =		0
a18 3

REVISION-main =		0
REVISION-ri_docs=	0
@


1.21
log
@Don't show the VMEM_WARNING when building ruby with the no_ri_docs
PSUEDO_FLAVOR, since the ri docs are the only thing that takes a
lot of memory.

OK ajacoutot@@
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.20 2011/11/15 00:04:15 jeremy Exp $
d65 1
a65 1
.if !${FLAVOR:L:Mno_x11}
d76 1
a76 1
.if !${FLAVOR:L:Mno_ri_docs}
@


1.20
log
@Add no_ri_docs PSUEDO_FLAVOR to skip building the ri documentation,
which should allow building on arches without enough memory to
generate the ri files.  Also, set PKG_ARCH=* for the ri_docs
subpackage, so that such arches can still use the documentation,
idea from sthen@@. Original idea for PSUEDO_FLAVOR from phessler@@.

OK sthen@@
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.19 2011/11/09 19:23:35 jeremy Exp $
d80 1
@


1.19
log
@Backport svn revision 33693, fixes threading bootstrap test failure.
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.18 2011/11/08 23:38:57 jeremy Exp $
d21 3
d37 2
a38 2
ALL_TARGET =		all V=1
INSTALL_TARGET =	install-all V=1
d50 1
a50 1
PSEUDO_FLAVORS=		no_x11
d53 1
a53 1
MULTI_PACKAGES =	-main -gdbm -dbm -ri_docs
d74 6
@


1.18
log
@Update to ruby 1.9.3p0.  Adds significant speed improvements and quite
a few new features.  A few of our patches were accepted upstream.

Add an -ri_docs multipackage to hold the ri documentation files.  These
aren't used very often, slow down installation significantly, and bloat
the package.

This also fixes the conflict marker for the -tk multipackage.
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.17 2011/09/16 10:31:21 espie Exp $
d19 2
@


1.17
log
@normalize pkgpath
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.16 2011/09/12 18:02:34 naddy Exp $
d4 4
a7 3
COMMENT-gdbm =		gdbm interface for Ruby
COMMENT-dbm =		Berkley DB interface for Ruby
COMMENT-tk=		tk interface for ruby
d9 2
a10 2
VERSION =		1.9.2
PATCHLEVEL =		290
d13 1
a13 1
SHARED_LIBS =		ruby19 0.0
d18 1
a18 2

REVISION-dbm =		1
d28 6
a33 1
CONFIGURE_ENV =		LIBruby19_VERSION=${LIBruby19_VERSION}
d48 1
a48 1
MULTI_PACKAGES =	-main -gdbm -dbm
d52 1
a52 1
			lang/ruby/${REV},-main
d57 1
a57 1
			lang/ruby/${REV},-main
d67 1
a67 1
			lang/ruby/${REV},-main
a72 4
# Known threading bootstraptest failures on i386 and macppc
# Occassional threading bootstrap failure on amd64
# Known endian issues in fiddle/dl on sparc64
# Known encoding related failure in one REXML test
@


1.16
log
@bump all (sub)packages that depend on db/v4; requested by and help from espie@@
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.15 2011/07/19 17:08:54 jeremy Exp $
d18 1
a18 1
REVISION-dbm =		0
@


1.15
log
@Update to 1.9.2p290.

Make regress run all three regression test suites.  Before,
later regression test suites wouldn't be run if earlier ones
were not successful, which stopped the main test suite from
running on i386, macppc, and possibly other arches.

Override the arch setting to remove OpenBSD version from it,
so ports don't have to be bumped when OpenBSD version changes.

OK landry@@, jcs@@
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.14 2011/07/18 19:06:37 naddy Exp $
d17 2
@


1.14
log
@bump revision for plist changes 4.9 -> 5.0
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.13 2011/05/25 18:20:43 jasper Exp $
d9 1
a9 1
PATCHLEVEL =		180
a17 5
REVISION-main = 	1
REVISION-gdbm =		0
REVISION-dbm =		0
REVISION-tk =		0

d31 2
a32 2
WANTLIB-main =		c crypto ffi m ncurses pthread readline ssl termcap \
			util yaml z ${MODLIBICONV_WANTLIB}
d64 2
d67 1
d69 1
a69 1
# Known bugs in OpenSSL extension on sparc64
d71 5
a75 1
SUBST_VARS +=		RUBYLIBREV
@


1.13
log
@Security fix for CVE-2011-0188
Ruby BigDecimal Integer Truncation Vulnerability

Fix from upstream svn. Only 64-bit hosts are affected.

ok jeremy@@ (MAINTAINER)
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.12 2011/03/07 18:59:18 jeremy Exp $
d18 4
a21 1
REVISION-main = 	0
@


1.12
log
@Bump to ruby 1.9.2p180, fixing a security vulnerability:

* FileUtils is vulnerable to symlink race attacks

OK jasper@@
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.11 2011/01/15 01:09:43 naddy Exp $
d17 2
@


1.11
log
@bump revision for plist changes 4.8 -> 4.9
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.10 2011/01/06 04:04:37 jeremy Exp $
d9 1
a9 1
PATCHLEVEL =		136
a16 4
REVISION-main =		0
REVISION-gdbm =		0
REVISION-dbm =		0
REVISION-tk =		0
@


1.11.2.1
log
@Security fix for CVE-2011-1004

ok jeremy@@ (MAINTAINER)
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.11 2011/01/15 01:09:43 naddy Exp $
d17 1
a17 1
REVISION-main =		1
@


1.11.2.2
log
@Security fix for CVE-2011-0188
Ruby BigDecimal Integer Truncation Vulnerability

Fix from upstream svn. Only 64-bit hosts are affected.

ok jeremy@@ (MAINTAINER)
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.11.2.1 2011/03/09 16:04:57 jasper Exp $
d17 1
a17 1
REVISION-main =		2
@


1.10
log
@Update ruby 1.9 port to 1.9.2p136, only minor bugfixes.  A couple of
our patches were accepted upstream.  While here, fix REGRESS_DEPENDS.

OK landry@@
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.9 2010/11/26 14:44:27 espie Exp $
d17 4
@


1.9
log
@default db-* for db/v4 is incorrect, set PKGSPEC=db->=4,<5, bump packages
with erroneous depends.
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.8 2010/11/24 21:28:04 jeremy Exp $
d9 1
a9 2
REVISION =		0
PATCHLEVEL =		0
a17 5
REVISION-main =		1
REVISION-gdbm =		0
REVISION-dbm =		1
REVISION-tk =		0

d67 1
a67 1
REGRESS_DEPENDS =	${FULLPKGNAME}:${BUILD_PKGPATH}
@


1.8
log
@Add a PKGSPEC entry to restrict ports depending on lang/ruby/1.9 to
depend on ruby-1.9 and not ruby-1.8.  This PKGSPEC is slightly
different from the previous one used in ruby.port.mk, so all
dependent ports need to be REVISION bumped (which will happen soon).
In addition, since the subpackages depend on the -main package and
also had a slightly different pkgspec, they need to be bumped as well.

In addition, the -main package is also being bumped for the inclusion
of a patch for Addrinfo that fixes a failing IPv6 UDP regression test.

OK landry@@
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.7 2010/11/17 08:05:18 espie Exp $
d21 1
a21 1
REVISION-dbm =		0
@


1.7
log
@new depends
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.6 2010/11/06 10:18:38 espie Exp $
d19 6
a24 1
REVISION-main =		0
d51 1
a51 1
			ruby->=1.9,<=1.10:lang/ruby/${REV},-main
d56 1
a56 1
			ruby->=1.9,<=1.10:lang/ruby/${REV},-main
d66 1
a66 1
			ruby->=1.9,<=1.10:lang/ruby/${REV},-main
a69 1
# Known failure in Addrinfo IPv6 UDP loopack test on all arch
d73 1
a73 1
REGRESS_DEPENDS =	ruby->=1.9,<=1.10:${BUILD_PKGPATH}
@


1.6
log
@convert libiconv to new wantlib
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.5 2010/10/24 21:24:04 ajacoutot Exp $
d30 1
a30 1
USE_GROFF =	Yes
d35 2
a36 2
			::devel/libyaml \
			::devel/libffi
d45 2
a46 2
LIB_DEPENDS-gdbm =	::databases/gdbm \
			:ruby->=1.9,<=1.10:lang/ruby/${REV},-main
d50 2
a51 2
LIB_DEPENDS-dbm =	::databases/db/v4 \
			:ruby->=1.9,<=1.10:lang/ruby/${REV},-main
d60 2
a61 2
LIB_DEPENDS-tk =	:tk->=8.5,<8.6:x11/tk/8.5 \
			:ruby->=1.9,<=1.10:lang/ruby/${REV},-main
d69 1
a69 1
REGRESS_DEPENDS =	:ruby->=1.9,<=1.10:${BUILD_PKGPATH}
@


1.5
log
@Remove USE_X11.
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.4 2010/10/18 19:20:42 espie Exp $
d33 1
a33 1
			util yaml z
@


1.4
log
@USE_GROFF=Yes
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.3 2010/10/12 15:39:06 jeremy Exp $
a54 1
USE_X11=		Yes
@


1.3
log
@Modify FileUtils.mkdir_p to behave more like mkdir(1) -p. Instead of
attempting to create all intermediate directories and rescuing failures,
don't attempt to create directories that already exist.  Fixes systrace
warnings when building ruby ports.

ok landry
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.2 2010/10/06 18:43:11 jeremy Exp $
d30 1
@


1.2
log
@This adds an ugly hack to make gem install --user-install work
for gems with native extensions. Without this, it calls
/usr/bin/install -o root -g bin as a regular user, which fails due
to permission issues. This removes the -o root -g bin, so it can
succeed as a regular user.

This same patch was recently added to devel/ruby-gems, which is
specific to ruby 1.8.  ruby 1.9 ships with ruby-gems, so the
patch needs to be included here as well.

OK landry@@
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.1 2010/09/23 21:58:50 jeremy Exp $
d18 2
@


1.1
log
@Split the lang/ruby port into separate ports for ruby 1.8 and ruby
1.9, similar to how the lang/python ports are handled.  ruby 1.8
now installs as ruby18 and ruby 1.9 installs as ruby19.  The
included MESSAGE files for both ports let you know the symlinks to
set up if you want to make that version the default system ruby.

Split port originally started by bernd@@, many changes since by me,
help and support from jcs@@, landry@@, jasper@@, and sthen@@.

This causes a large amount of fallout in dependent ruby ports,
which will be committed shortly.

OK jcs@@, landry@@, jasper@@, sthen@@
@
text
@d1 1
a1 1
# $OpenBSD$
d9 1
@

