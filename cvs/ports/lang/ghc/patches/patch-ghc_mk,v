head	1.11;
access;
symbols
	OPENBSD_6_2:1.11.0.8
	OPENBSD_6_2_BASE:1.11
	OPENBSD_6_1:1.11.0.6
	OPENBSD_6_1_BASE:1.11
	OPENBSD_6_0:1.11.0.4
	OPENBSD_6_0_BASE:1.11
	OPENBSD_5_9:1.11.0.2
	OPENBSD_5_9_BASE:1.11
	OPENBSD_5_8:1.10.0.6
	OPENBSD_5_8_BASE:1.10
	OPENBSD_5_7:1.10.0.2
	OPENBSD_5_7_BASE:1.10
	OPENBSD_5_6:1.8.0.6
	OPENBSD_5_6_BASE:1.8
	OPENBSD_5_5:1.8.0.4
	OPENBSD_5_5_BASE:1.8
	OPENBSD_5_4:1.8.0.2
	OPENBSD_5_4_BASE:1.8
	OPENBSD_5_3:1.7.0.2
	OPENBSD_5_3_BASE:1.7
	OPENBSD_5_2:1.6.0.4
	OPENBSD_5_2_BASE:1.6
	OPENBSD_5_1_BASE:1.6
	OPENBSD_5_1:1.6.0.2
	OPENBSD_5_0:1.5.0.2
	OPENBSD_5_0_BASE:1.5
	OPENBSD_4_9:1.2.0.4
	OPENBSD_4_9_BASE:1.2
	OPENBSD_4_8:1.2.0.2
	OPENBSD_4_8_BASE:1.2;
locks; strict;
comment	@# @;


1.11
date	2015.09.19.07.42.56;	author kili;	state Exp;
branches;
next	1.10;
commitid	wrrXExsbhXWvHmhw;

1.10
date	2015.01.01.19.25.36;	author kili;	state Exp;
branches;
next	1.9;
commitid	xydU2twmNfvEHbae;

1.9
date	2014.11.22.20.23.23;	author kili;	state Exp;
branches;
next	1.8;
commitid	f8HFLM9LK5anF9Xl;

1.8
date	2013.07.18.21.43.23;	author kili;	state Exp;
branches;
next	1.7;

1.7
date	2012.09.02.19.53.46;	author kili;	state Exp;
branches;
next	1.6;

1.6
date	2011.08.21.21.38.04;	author kili;	state Exp;
branches;
next	1.5;

1.5
date	2011.04.25.22.06.43;	author kili;	state Exp;
branches;
next	1.4;

1.4
date	2011.04.23.08.40.41;	author kili;	state Exp;
branches;
next	1.3;

1.3
date	2011.04.11.14.30.33;	author kili;	state Exp;
branches;
next	1.2;

1.2
date	2010.06.15.15.34.03;	author kili;	state Exp;
branches;
next	1.1;

1.1
date	2010.04.22.21.49.37;	author kili;	state Exp;
branches;
next	;


desc
@@


1.11
log
@Update to ghc-7.10.2.

Updates to all hs-* ports related to meta/haskell-platform will
follow soon. Other hs-* ports will be fixed during the next days.
@
text
@$OpenBSD: patch-ghc_mk,v 1.10 2015/01/01 19:25:36 kili Exp $

Fix the bindist-list (for building the bootstrapper); without this,
gtar creates an archive which our tar can't extract.

--- ghc.mk.orig	Tue Jul 21 15:52:50 2015
+++ ghc.mk	Sun Aug  9 17:35:52 2015
@@@@ -1024,6 +1024,8 @@@@ unix-binary-dist-prep:
 	echo "UseSystemLibFFI    = $(UseSystemLibFFI)"    >> $(BIN_DIST_MK)
 	cd $(BIN_DIST_PREP_DIR) && autoreconf
 	$(call removeFiles,$(BIN_DIST_PREP_TAR))
+	sed 's@@/\./@@/@@g' bindist-list | sort -u > bindist-list.new
+	mv bindist-list.new bindist-list
 # h means "follow symlinks", e.g. if aclocal.m4 is a symlink to a source
 # tree then we want to include the real file, not a symlink to it
 	cd bindistprep && "$(TAR_CMD)" hcf - -T ../bindist-list | $(TAR_COMP_CMD) -c > ../$(BIN_DIST_PREP_TAR_COMP)
@


1.10
log
@Bugfix udpate to ghc-7.8.4.
Also, use a new(er) bootstrapper; note that we have to use 7.8.3
for this, because if the built ghc and the bootstrapper have identical
versions, things will fail badly. May be it's not the ghc but the
cabal version which is problematic, but at the moment, I really
don'y call about *this* problem.
Still marked as broken. I hope to send promised diffs and new ports
for discussion tomorrow and then enable ghc and haskell-platform
on monday.
@
text
@d1 1
a1 1
$OpenBSD: patch-ghc_mk,v 1.9 2014/11/22 20:23:23 kili Exp $
d6 3
a8 3
--- ghc.mk.orig	Thu Jul 10 06:27:16 2014
+++ ghc.mk	Sun Nov  2 21:50:31 2014
@@@@ -1007,6 +1007,8 @@@@ unix-binary-dist-prep:
@


1.9
log
@Update to ghc-7.8.3, but mark as broken until all other
hs ports are done.

Please note that it still doesn't use shared libraries, so
still no ghci (and a lot of hs-ports not buildable) on i386.
@
text
@d1 1
a1 1
$OpenBSD: patch-ghc_mk,v 1.8 2013/07/18 21:43:23 kili Exp $
d12 2
a13 2
+	sed 's@@/\./@@/@@g' ${BIN_DIST_LIST} | sort -u > ${BIN_DIST_LIST}.new
+	mv ${BIN_DIST_LIST}.new ${BIN_DIST_LIST}
@


1.8
log
@Update to ghc-7.6.3, revert my last two obsolete changes and
mark it as broken until all depending ports have been updated.
@
text
@d1 1
a1 7
$OpenBSD: patch-ghc_mk,v 1.7 2012/09/02 19:53:46 kili Exp $

Include utf8-string and xhtml for now, because of dependencies.
Including *any* of those INTREE_ONLY_PACKAGES in the ghc packages
wasn't the brightest idea I had (see mtl library hell). The two
libraries left can and will be replaced by separate ports when
needed.
d6 2
a7 11
--- ghc.mk.orig	Thu Apr 18 23:22:46 2013
+++ ghc.mk	Sun Jul  7 16:03:47 2013
@@@@ -310,7 +310,7 @@@@ endif
 # They do not say "this package will be built"; see $(PACKAGES_xx) for that
 
 # Packages that are built but not installed
-PKGS_THAT_ARE_INTREE_ONLY := haskeline transformers terminfo utf8-string xhtml
+PKGS_THAT_ARE_INTREE_ONLY := haskeline transformers terminfo
 
 PKGS_THAT_ARE_DPH := \
     dph/dph-base \
d9 1
a9 1
 	echo "GHC_CABAL_INPLACE  = utils/ghc-cabal/dist-install/build/tmp/ghc-cabal" >> $(BIN_DIST_MK)
d16 1
a16 1
 	cd bindistprep && "$(TAR_CMD)" hcf - -T ../$(BIN_DIST_LIST) | bzip2 -c > ../$(BIN_DIST_PREP_TAR_BZ2)
@


1.7
log
@Update to ghc-7.4.2, but keep it marked as broken (and not only for amd64).

Most of the -nopie changes are from pascal@@ (thanks); I only had to
merge them for ghc-7.4 and tweak configure and mk/config.mk.in.
@
text
@d1 1
a1 1
$OpenBSD: patch-ghc_mk,v 1.6 2011/08/21 21:38:04 kili Exp $
d12 2
a13 2
--- ghc.mk.orig	Wed Feb  1 19:10:32 2012
+++ ghc.mk	Sat Jun  9 20:44:38 2012
d18 2
a19 2
-PKGS_THAT_ARE_INTREE_ONLY := haskeline mtl terminfo utf8-string xhtml
+PKGS_THAT_ARE_INTREE_ONLY := haskeline mtl terminfo
d23 1
a23 1
@@@@ -973,6 +973,8 @@@@ unix-binary-dist-prep:
@


1.6
log
@Some bindist tweaks. No change for regular builds, but necessary
for the bootstrap target i'm curremtly working on.
@
text
@d1 1
a1 1
$OpenBSD: patch-ghc_mk,v 1.5 2011/04/25 22:06:43 kili Exp $
d12 3
a14 3
--- ghc.mk.orig	Mon Jun 13 19:10:05 2011
+++ ghc.mk	Sat Aug 20 20:14:19 2011
@@@@ -290,7 +290,7 @@@@ include rules/bindist.mk
d18 2
a19 2
-INTREE_ONLY_PACKAGES := haskeline mtl terminfo utf8-string xhtml
+INTREE_ONLY_PACKAGES := haskeline mtl terminfo
d21 3
a23 3
 # Packages that, if present, must be built by the stage2 compiler,
 # because they use TH and/or annotations, or depend on other stage2
@@@@ -1037,6 +1037,8 @@@@ unix-binary-dist-prep:
d26 1
a26 1
 	"$(RM)" $(RM_OPTS) $(BIN_DIST_PREP_TAR)
@


1.5
log
@Bye bye haskeline,
mtl and terminfo don't really rhyme.

yes | sed 's/./I shall not touch INTREE_ONLY_PACKAGES in ghc.mk./;100q'

But keep utf8-string and xhtml for now.
@
text
@d1 1
a1 1
$OpenBSD: patch-ghc_mk,v 1.4 2011/04/23 08:40:41 kili Exp $
d9 5
a13 2
--- ghc.mk.orig	Sat Mar 26 19:10:06 2011
+++ ghc.mk	Mon Apr 25 17:21:44 2011
d23 9
@


1.4
log
@Adjust comment about mtl-1 included in the ghc package; there's
only one port left that doesn't work with mtl-2.
@
text
@d1 1
a1 1
$OpenBSD: patch-ghc_mk,v 1.3 2011/04/11 14:30:33 kili Exp $
d3 5
a7 6
I don't see the point in not installing libraries that are required
by the build (and by several external haskell libraries we have or
will have in the ports tree). Note that the mtl package is outdated;
we keep it only because devel/hs-atom doesn't (yet) t work with the
(new) mtl-2 in devel/hs-mtl. mtl-1 will be disabled after devel/hs-atom
has been updated (which I leave to jasper@@).
d9 2
a10 2
--- ghc.mk.orig	Wed Dec 15 19:10:07 2010
+++ ghc.mk	Sun Dec 26 17:18:11 2010
d16 1
a16 1
+INTREE_ONLY_PACKAGES :=
@


1.3
log
@Update to 7.0.3.

ok jasper@@ (who also gave an ok to all the depending updates).
@
text
@d1 1
a1 1
$OpenBSD: patch-ghc_mk,v 1.2 2010/06/15 15:34:03 kili Exp $
d6 3
a8 2
we keep it only because some ports don't work with the (new) mtl-2
in devel/hs-mtl.
@


1.2
log
@Update to ghc-6.12.3 (bugfix release), plus some minor changes:

- Use integer-gmp again.

- Cleanout the extracted bootstrap directory right after installing it
  to save some disk space.

- Use ${MAKE_ENV} instead ${MODGHC_SETUP_CONF_ENV} in ghc.port.mk (in
  do-configure, use both).

- Don't compile Setup.l?hs, just use the interpreter (runghc) in
  ghc.port.mk. This speeds up the build of most ports depending on
  ghc and using a cabal-style build.

Necessary bumps and WANTLIB changes in ports using ghc will follow
later this evening.
@
text
@d1 1
a1 1
$OpenBSD: patch-ghc_mk,v 1.1 2010/04/22 21:49:37 kili Exp $
d5 3
a7 1
will have in the ports tree).
d9 4
a12 5
--- ghc.mk.orig	Tue May 25 20:10:08 2010
+++ ghc.mk	Wed May 26 20:30:13 2010
@@@@ -844,7 +844,7 @@@@ INSTALLED_GHC_REAL=$(DESTDIR)$(bindir)/ghc.exe
 INSTALLED_GHC_PKG_REAL=$(DESTDIR)$(bindir)/ghc-pkg.exe
 endif
d14 3
a16 3
-INSTALLED_PACKAGES = $(filter-out haskeline mtl terminfo utf8-string,$(PACKAGES))
+INSTALLED_PACKAGES = $(PACKAGES)
 HIDDEN_PACKAGES = ghc-binary
d18 2
a19 1
 define set_INSTALL_DISTDIR
@


1.1
log
@
Update to 6.12.2.

Many thanks to Darrin Chandler and dcoppa@@ for testing, reporting about
broken stuff, missing dependencies here and in ports depending on ghc.

Notes and rants:

- Bootstrapping is done using precompiled binaries, since .hc
  bootstrapping still doesn't work. I really hate this.

  THIS MEANS THAT GHC IS NOW AND WILL STAY LEGACY-ONLY (i386 and amd64)

  At least until someone fixes it. I tried for more than two year
  (well, only in my spare time and during my vacations) and failed.

- libgmp is currently disabled, because I didn't yet hack the GHC build
  system to use the system libgmp instead of the patched one included
  in GHC.

- The haddock ncluded in the ghc distfile is replaced by the version
  of haddock found in devel/haddock. Haddock itself is @@commented
  in the ghc PLIST. Unfortunately, this needs an ugly hack that
  introduces an otherwise useless pseudo flavor `no_deps' in
  devel/haddock.

- CLDouble has been removed from GHC some time ago, because it was
  an alias for double (AFAIK there's now support for long double
  in GHC). As this isn't a really big problem, it currently breaks
  c2hs, which I'll mark broken temporarily before committing the
  ghc update.

- The external codeset defaults to latin1 (suggested by Simon Marlow)
  and can be overridden by setting the HS_ENCODING to any codeset
  supported by libiconv.

- ghc.port.mk still needs some love, especially for letting a port add
  additional parameters to certain invocations of ${MODGHC_SETUP_PROG}.
@
text
@d1 1
a1 1
$OpenBSD$
d7 3
a9 3
--- ghc.mk.orig	Wed Mar 31 20:10:09 2010
+++ ghc.mk	Fri Apr  2 09:47:24 2010
@@@@ -841,7 +841,7 @@@@ INSTALLED_GHC_REAL=$(DESTDIR)$(bindir)/ghc.exe
@

