head	1.7;
access;
symbols
	OPENBSD_6_1:1.7.0.6
	OPENBSD_6_1_BASE:1.7
	OPENBSD_6_0:1.7.0.4
	OPENBSD_6_0_BASE:1.7
	OPENBSD_5_9:1.7.0.2
	OPENBSD_5_9_BASE:1.7
	OPENBSD_5_8:1.6.0.6
	OPENBSD_5_8_BASE:1.6
	OPENBSD_5_7:1.6.0.2
	OPENBSD_5_7_BASE:1.6
	OPENBSD_5_6:1.5.0.6
	OPENBSD_5_6_BASE:1.5
	OPENBSD_5_5:1.5.0.4
	OPENBSD_5_5_BASE:1.5
	OPENBSD_5_4:1.5.0.2
	OPENBSD_5_4_BASE:1.5
	OPENBSD_5_3:1.4.0.2
	OPENBSD_5_3_BASE:1.4
	OPENBSD_5_2:1.3.0.6
	OPENBSD_5_2_BASE:1.3
	OPENBSD_5_1_BASE:1.3
	OPENBSD_5_1:1.3.0.4
	OPENBSD_5_0:1.3.0.2
	OPENBSD_5_0_BASE:1.3
	OPENBSD_4_9:1.2.0.4
	OPENBSD_4_9_BASE:1.2
	OPENBSD_4_8:1.2.0.2
	OPENBSD_4_8_BASE:1.2;
locks; strict;
comment	@# @;


1.7
date	2015.09.19.07.42.57;	author kili;	state Exp;
branches;
next	1.6;
commitid	wrrXExsbhXWvHmhw;

1.6
date	2014.11.22.20.23.23;	author kili;	state Exp;
branches;
next	1.5;
commitid	f8HFLM9LK5anF9Xl;

1.5
date	2013.07.18.21.43.24;	author kili;	state Exp;
branches;
next	1.4;

1.4
date	2012.09.02.19.53.46;	author kili;	state Exp;
branches;
next	1.3;

1.3
date	2011.04.11.14.30.33;	author kili;	state Exp;
branches;
next	1.2;

1.2
date	2010.06.15.15.34.03;	author kili;	state Exp;
branches;
next	1.1;

1.1
date	2010.04.22.21.49.37;	author kili;	state Exp;
branches;
next	;


desc
@@


1.7
log
@Update to ghc-7.10.2.

Updates to all hs-* ports related to meta/haskell-platform will
follow soon. Other hs-* ports will be fixed during the next days.
@
text
@$OpenBSD: patch-testsuite_driver_testlib_py,v 1.6 2014/11/22 20:23:23 kili Exp $
--- testsuite/driver/testlib.py.orig	Tue Jul 21 15:52:50 2015
+++ testsuite/driver/testlib.py	Sun Aug  9 17:35:53 2015
@@@@ -1634,6 +1634,13 @@@@ def compare_outputs( kind, normaliser, expected_file, 
     actual_raw = read_no_crs(actual_file)
     actual_str = normaliser(actual_raw)
 
+    # Strip OpenBSDs linker warnings about strcpy(3) & friends.
+    if config.os == 'openbsd':
+        actual_str = re.sub('.*: In function .*:\n+(.*:[0-9]+:[0-9]+:\n)?:? *warning: .* is .* misused, please use .*\n',
+                            '', actual_str)
+        actual_str = re.sub('.*/libgmp\.so\.[0-9]*\.[0-9]*: warning: .* is .* misused, please use .*\n',
+                            '', actual_str)
+
     if expected_str == actual_str:
         return 1
     else:
@@@@ -1657,13 +1664,13 @@@@ def compare_outputs( kind, normaliser, expected_file, 
         # This does mean that the diff might contain changes that
         # would be normalised away.
         if (config.verbose >= 1):
-            r = os.system( 'diff -uw ' + expected_file_for_diff + \
+            r = os.system( 'diff -auw ' + expected_file_for_diff + \
                                    ' ' + actual_file )
 
             # If for some reason there were no non-whitespace differences,
             # then do a full diff
             if r == 0:
-                r = os.system( 'diff -u ' + expected_file_for_diff + \
+                r = os.system( 'diff -au ' + expected_file_for_diff + \
                                       ' ' + actual_file )
 
         if config.accept:
@


1.6
log
@Update to ghc-7.8.3, but mark as broken until all other
hs ports are done.

Please note that it still doesn't use shared libraries, so
still no ghci (and a lot of hs-ports not buildable) on i386.
@
text
@d1 4
a4 4
$OpenBSD: patch-testsuite_driver_testlib_py,v 1.5 2013/07/18 21:43:24 kili Exp $
--- testsuite/driver/testlib.py.orig	Thu Jul 10 06:27:16 2014
+++ testsuite/driver/testlib.py	Sun Nov  2 22:08:03 2014
@@@@ -1604,6 +1604,13 @@@@ def compare_outputs( kind, normaliser, expected_file, 
d18 1
a18 1
@@@@ -1627,13 +1634,13 @@@@ def compare_outputs( kind, normaliser, expected_file, 
@


1.5
log
@Update to ghc-7.6.3, revert my last two obsolete changes and
mark it as broken until all depending ports have been updated.
@
text
@d1 4
a4 4
$OpenBSD: patch-testsuite_driver_testlib_py,v 1.4 2012/09/02 19:53:46 kili Exp $
--- testsuite/driver/testlib.py.orig	Thu Apr 18 23:44:31 2013
+++ testsuite/driver/testlib.py	Sun Jul  7 16:00:36 2013
@@@@ -1563,6 +1563,13 @@@@ def compare_outputs( kind, normaliser, expected_file, 
d18 1
a18 2
@@@@ -1585,13 +1592,13 @@@@ def compare_outputs( kind, normaliser, expected_file, 
         # (including newlines) so the diff would be hard to read.
d21 4
a24 3
-        r = os.system( 'diff -uw ' + expected_file_for_diff + \
+        r = os.system( 'diff -auw ' + expected_file_for_diff + \
                                ' ' + actual_file )
d26 6
a31 6
         # If for some reason there were no non-whitespace differences,
         # then do a full diff
         if r == 0:
-            r = os.system( 'diff -u ' + expected_file_for_diff + \
+            r = os.system( 'diff -au ' + expected_file_for_diff + \
                                   ' ' + actual_file )
@


1.4
log
@Update to ghc-7.4.2, but keep it marked as broken (and not only for amd64).

Most of the -nopie changes are from pascal@@ (thanks); I only had to
merge them for ghc-7.4 and tweak configure and mk/config.mk.in.
@
text
@d1 4
a4 4
$OpenBSD: patch-testsuite_driver_testlib_py,v 1.3 2011/04/11 14:30:33 kili Exp $
--- testsuite/driver/testlib.py.orig	Wed Feb  1 19:11:16 2012
+++ testsuite/driver/testlib.py	Sat Jun  9 21:39:34 2012
@@@@ -1472,6 +1472,13 @@@@ def compare_outputs( kind, normaliser, expected_file, 
d18 1
a18 1
@@@@ -1494,13 +1501,13 @@@@ def compare_outputs( kind, normaliser, expected_file, 
@


1.3
log
@Update to 7.0.3.

ok jasper@@ (who also gave an ok to all the depending updates).
@
text
@d1 4
a4 4
$OpenBSD: patch-testsuite_driver_testlib_py,v 1.2 2010/06/15 15:34:03 kili Exp $
--- testsuite/driver/testlib.py.orig	Sun Dec 19 12:03:03 2010
+++ testsuite/driver/testlib.py	Sun Dec 19 12:46:34 2010
@@@@ -1285,6 +1285,13 @@@@ def compare_outputs( kind, normaliser, extra_normalise
d15 10
a24 10
     if extra_normaliser(expected_str) != extra_normaliser(actual_str):
         print 'Actual ' + kind + ' output differs from expected:'
 
@@@@ -1299,13 +1306,13 @@@@ def compare_outputs( kind, normaliser, extra_normalise
 
         # Ignore whitespace when diffing. We should only get to this
         # point if there are non-whitespace differences
-        r = os.system( 'diff -uw ' + expected_normalised_file + \
+        r = os.system( 'diff -auw ' + expected_normalised_file + \
                                ' ' + actual_normalised_file )
d29 3
a31 3
-            r = os.system( 'diff -u ' + expected_normalised_file + \
+            r = os.system( 'diff -au ' + expected_normalised_file + \
                                   ' ' + actual_normalised_file )
@


1.2
log
@Update to ghc-6.12.3 (bugfix release), plus some minor changes:

- Use integer-gmp again.

- Cleanout the extracted bootstrap directory right after installing it
  to save some disk space.

- Use ${MAKE_ENV} instead ${MODGHC_SETUP_CONF_ENV} in ghc.port.mk (in
  do-configure, use both).

- Don't compile Setup.l?hs, just use the interpreter (runghc) in
  ghc.port.mk. This speeds up the build of most ports depending on
  ghc and using a cabal-style build.

Necessary bumps and WANTLIB changes in ports using ghc will follow
later this evening.
@
text
@d1 4
a4 4
$OpenBSD: patch-testsuite_driver_testlib_py,v 1.1 2010/04/22 21:49:37 kili Exp $
--- testsuite/driver/testlib.py.orig	Wed May 26 19:53:30 2010
+++ testsuite/driver/testlib.py	Thu May 27 18:40:14 2010
@@@@ -1224,6 +1224,13 @@@@ def compare_outputs( kind, normaliser, extra_normalise
d18 1
a18 1
@@@@ -1238,13 +1245,13 @@@@ def compare_outputs( kind, normaliser, extra_normalise
@


1.1
log
@
Update to 6.12.2.

Many thanks to Darrin Chandler and dcoppa@@ for testing, reporting about
broken stuff, missing dependencies here and in ports depending on ghc.

Notes and rants:

- Bootstrapping is done using precompiled binaries, since .hc
  bootstrapping still doesn't work. I really hate this.

  THIS MEANS THAT GHC IS NOW AND WILL STAY LEGACY-ONLY (i386 and amd64)

  At least until someone fixes it. I tried for more than two year
  (well, only in my spare time and during my vacations) and failed.

- libgmp is currently disabled, because I didn't yet hack the GHC build
  system to use the system libgmp instead of the patched one included
  in GHC.

- The haddock ncluded in the ghc distfile is replaced by the version
  of haddock found in devel/haddock. Haddock itself is @@commented
  in the ghc PLIST. Unfortunately, this needs an ugly hack that
  introduces an otherwise useless pseudo flavor `no_deps' in
  devel/haddock.

- CLDouble has been removed from GHC some time ago, because it was
  an alias for double (AFAIK there's now support for long double
  in GHC). As this isn't a really big problem, it currently breaks
  c2hs, which I'll mark broken temporarily before committing the
  ghc update.

- The external codeset defaults to latin1 (suggested by Simon Marlow)
  and can be overridden by setting the HS_ENCODING to any codeset
  supported by libiconv.

- ghc.port.mk still needs some love, especially for letting a port add
  additional parameters to certain invocations of ${MODGHC_SETUP_PROG}.
@
text
@d1 4
a4 4
$OpenBSD$
--- testsuite/driver/testlib.py.orig	Thu Apr 15 15:23:09 2010
+++ testsuite/driver/testlib.py	Fri Apr 16 16:02:57 2010
@@@@ -1224,6 +1224,12 @@@@ def compare_outputs( kind, normaliser, extra_normalise
d10 3
a12 1
+        actual_str = re.sub('.*: In function .*:\n: warning: .* is .* misused, please use .*\n',
a14 1
+
d18 1
a18 1
@@@@ -1238,13 +1244,13 @@@@ def compare_outputs( kind, normaliser, extra_normalise
@

