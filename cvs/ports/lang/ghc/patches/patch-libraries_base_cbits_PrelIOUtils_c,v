head	1.3;
access;
symbols
	OPENBSD_6_0:1.3.0.4
	OPENBSD_6_0_BASE:1.3
	OPENBSD_5_9:1.3.0.2
	OPENBSD_5_9_BASE:1.3
	OPENBSD_5_8:1.2.0.20
	OPENBSD_5_8_BASE:1.2
	OPENBSD_5_7:1.2.0.16
	OPENBSD_5_7_BASE:1.2
	OPENBSD_5_6:1.2.0.14
	OPENBSD_5_6_BASE:1.2
	OPENBSD_5_5:1.2.0.12
	OPENBSD_5_5_BASE:1.2
	OPENBSD_5_4:1.2.0.10
	OPENBSD_5_4_BASE:1.2
	OPENBSD_5_3:1.2.0.8
	OPENBSD_5_3_BASE:1.2
	OPENBSD_5_2:1.2.0.6
	OPENBSD_5_2_BASE:1.2
	OPENBSD_5_1_BASE:1.2
	OPENBSD_5_1:1.2.0.4
	OPENBSD_5_0:1.2.0.2
	OPENBSD_5_0_BASE:1.2
	OPENBSD_4_9:1.1.0.4
	OPENBSD_4_9_BASE:1.1
	OPENBSD_4_8:1.1.0.2
	OPENBSD_4_8_BASE:1.1;
locks; strict;
comment	@# @;


1.3
date	2015.09.19.07.42.57;	author kili;	state Exp;
branches;
next	1.2;
commitid	wrrXExsbhXWvHmhw;

1.2
date	2011.04.11.14.30.33;	author kili;	state Exp;
branches;
next	1.1;

1.1
date	2010.04.22.21.49.37;	author kili;	state Exp;
branches;
next	;


desc
@@


1.3
log
@Update to ghc-7.10.2.

Updates to all hs-* ports related to meta/haskell-platform will
follow soon. Other hs-* ports will be fixed during the next days.
@
text
@$OpenBSD: patch-libraries_base_cbits_PrelIOUtils_c,v 1.2 2011/04/11 14:30:33 kili Exp $

We have very limited locale support so used latin1 as default codeset
which can be overridden by the environment variable `HS_ENCODING'.

--- libraries/base/cbits/PrelIOUtils.c.orig	Tue Dec 23 03:31:10 2014
+++ libraries/base/cbits/PrelIOUtils.c	Sun Aug  9 17:35:52 2015
@@@@ -19,27 +19,13 @@@@ void debugBelch2(const char*s, char *t)
     debugBelch(s,t);
 }
 
-#if defined(HAVE_LIBCHARSET)
-#  include <libcharset.h>
-#elif defined(HAVE_LANGINFO_H)
-#  include <langinfo.h>
-#endif
-
 #if !defined(mingw32_HOST_OS)
+#include <stdlib.h>
+#include <string.h>
 const char* localeEncoding(void)
 {
-#if defined(HAVE_LIBCHARSET)
-    return locale_charset();
-
-#elif defined(HAVE_LANGINFO_H)
-    return nl_langinfo(CODESET);
-
-#else
-#warning Depending on the unportable behavior of GNU iconv due to absence of both libcharset and langinfo.h
-    /* GNU iconv accepts "" to mean the current locale's
-     * encoding. Warning: This isn't portable.
-     */
-    return "";
-#endif
+	char *l;
+	l = getenv("HS_ENCODING");
+	return l != NULL ? l : "latin1";
 }
 #endif
@


1.2
log
@Update to 7.0.3.

ok jasper@@ (who also gave an ok to all the depending updates).
@
text
@d1 1
a1 1
$OpenBSD: patch-libraries_base_cbits_PrelIOUtils_c,v 1.1 2010/04/22 21:49:37 kili Exp $
d6 3
a8 3
--- libraries/base/cbits/PrelIOUtils.c.orig	Sun Dec 19 13:14:39 2010
+++ libraries/base/cbits/PrelIOUtils.c	Sun Dec 19 13:18:39 2010
@@@@ -24,28 +24,14 @@@@ void debugBelch2(const char*s, char *t)
a40 1
 
@


1.1
log
@
Update to 6.12.2.

Many thanks to Darrin Chandler and dcoppa@@ for testing, reporting about
broken stuff, missing dependencies here and in ports depending on ghc.

Notes and rants:

- Bootstrapping is done using precompiled binaries, since .hc
  bootstrapping still doesn't work. I really hate this.

  THIS MEANS THAT GHC IS NOW AND WILL STAY LEGACY-ONLY (i386 and amd64)

  At least until someone fixes it. I tried for more than two year
  (well, only in my spare time and during my vacations) and failed.

- libgmp is currently disabled, because I didn't yet hack the GHC build
  system to use the system libgmp instead of the patched one included
  in GHC.

- The haddock ncluded in the ghc distfile is replaced by the version
  of haddock found in devel/haddock. Haddock itself is @@commented
  in the ghc PLIST. Unfortunately, this needs an ugly hack that
  introduces an otherwise useless pseudo flavor `no_deps' in
  devel/haddock.

- CLDouble has been removed from GHC some time ago, because it was
  an alias for double (AFAIK there's now support for long double
  in GHC). As this isn't a really big problem, it currently breaks
  c2hs, which I'll mark broken temporarily before committing the
  ghc update.

- The external codeset defaults to latin1 (suggested by Simon Marlow)
  and can be overridden by setting the HS_ENCODING to any codeset
  supported by libiconv.

- ghc.port.mk still needs some love, especially for letting a port add
  additional parameters to certain invocations of ${MODGHC_SETUP_PROG}.
@
text
@d1 1
a1 1
$OpenBSD$
d6 5
a10 3
--- libraries/base/cbits/PrelIOUtils.c.orig	Tue Apr 13 20:10:09 2010
+++ libraries/base/cbits/PrelIOUtils.c	Mon Apr 19 23:12:08 2010
@@@@ -26,10 +26,13 @@@@ void debugBelch2(const char*s, char *t)
d12 7
a18 3
 // Use a C wrapper for this because we avoid hsc2hs in base
 #if HAVE_LANGINFO_H
-#include <langinfo.h>
d21 1
a21 1
 char *localeEncoding (void)
d23 4
d28 8
@

