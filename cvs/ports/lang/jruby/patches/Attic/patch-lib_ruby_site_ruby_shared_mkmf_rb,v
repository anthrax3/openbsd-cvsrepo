head	1.4;
access;
symbols
	OPENBSD_5_3:1.3.0.6
	OPENBSD_5_3_BASE:1.3
	OPENBSD_5_2:1.3.0.4
	OPENBSD_5_2_BASE:1.3
	OPENBSD_5_1_BASE:1.3
	OPENBSD_5_1:1.3.0.2
	OPENBSD_5_0:1.2.0.2
	OPENBSD_5_0_BASE:1.2;
locks; strict;
comment	@# @;


1.4
date	2013.03.19.23.43.06;	author jeremy;	state dead;
branches;
next	1.3;

1.3
date	2011.11.08.23.58.08;	author jeremy;	state Exp;
branches;
next	1.2;

1.2
date	2011.07.19.17.57.47;	author jeremy;	state Exp;
branches;
next	1.1;

1.1
date	2011.03.18.23.01.22;	author jeremy;	state Exp;
branches;
next	;


desc
@@


1.4
log
@Update to jruby 1.7.3.

Drop support for C extensions (which were always expiremental).
Use jruby.jar instead of jruby-complete.jar, for a more typical
jruby installation.
@
text
@$OpenBSD: patch-lib_ruby_site_ruby_shared_mkmf_rb,v 1.3 2011/11/08 23:58:08 jeremy Exp $
--- lib/ruby/site_ruby/shared/mkmf.rb.orig	Tue Oct 25 08:07:12 2011
+++ lib/ruby/site_ruby/shared/mkmf.rb	Sun Oct 30 21:08:59 2011
@@@@ -1764,8 +1764,8 @@@@ def init_mkmf(config = CONFIG)
   $CFLAGS = with_config("cflags", arg_config("CFLAGS", config["CFLAGS"])).dup
   $ARCH_FLAG = with_config("arch_flag", arg_config("ARCH_FLAG", config["ARCH_FLAG"])).dup
   $CPPFLAGS = with_config("cppflags", arg_config("CPPFLAGS", config["CPPFLAGS"])).dup
-  $LDFLAGS = with_config("ldflags", arg_config("LDFLAGS", config["LDFLAGS"])).dup
-  $INCFLAGS = "-I$(topdir) -I$(hdrdir) -I$(srcdir)"
+  $LDFLAGS = with_config("ldflags", arg_config("LDFLAGS", config["LDFLAGS"])).dup + " -L${LOCALBASE}/lib"
+  $INCFLAGS = "-I$(topdir) -I$(hdrdir) -I$(srcdir) -I${LOCALBASE}/include"
   $DLDFLAGS = with_config("dldflags", arg_config("DLDFLAGS", config["DLDFLAGS"])).dup
   $LIBEXT = config['LIBEXT'].dup
   $OBJEXT = config["OBJEXT"].dup
@


1.3
log
@Update to JRuby 1.6.5.

Make jruby binary not segfault if PATH isn't set correctly.

Remove rubygems hacks, since they are no longer necessary now
that the versions of rubygems for the other ruby interpreters
are > 1.3.7.

No longer ship the ri documentation files with JRuby.  JRuby
ships with a broken ri binary anyway (requires the rdoc gem to
work), and almost all users of JRuby have MRI ruby installed
and can use its ri binary.
@
text
@d1 1
a1 1
$OpenBSD: patch-lib_ruby_site_ruby_shared_mkmf_rb,v 1.2 2011/07/19 17:57:47 jeremy Exp $
@


1.2
log
@Update to 1.6.3.  Make bin/jruby a compiled file instead of a bash
script, so it can now be used in shebang lines.  Remove the
building of nailgun, since nailgun support is now part of the
jruby binary.

This requires patching the included jruby-launcher gem to make a
similar change we used to make to the jruby.bash script, to set the
JAVA_HOME environment so things work correctly.

Also, create the SITEARCHDIR directory by default.

OK jcs@@
@
text
@d1 14
a14 17
$OpenBSD: patch-lib_ruby_site_ruby_shared_mkmf_rb,v 1.1 2011/03/18 23:01:22 jeremy Exp $
--- lib/ruby/site_ruby/shared/mkmf.rb.orig	Thu Jul  7 11:19:34 2011
+++ lib/ruby/site_ruby/shared/mkmf.rb	Mon Jul 11 21:32:16 2011
@@@@ -1372,11 +1372,11 @@@@ LIBRUBYARG_STATIC = #$LIBRUBYARG_STATIC
 
 RUBY_EXTCONF_H = #{$extconf_h}
 CFLAGS   = #{$static ? '' : CONFIG['CCDLFLAGS']} #$CFLAGS #$ARCH_FLAG
-INCFLAGS = -I. #$INCFLAGS
+INCFLAGS = -I. -I${LOCALBASE}/include #$INCFLAGS
 DEFS     = #{CONFIG['DEFS']}
 CPPFLAGS = #{extconf_h}#{$CPPFLAGS}
 CXXFLAGS = $(CFLAGS) #{CONFIG['CXXFLAGS']}
-ldflags  = #{$LDFLAGS}
+ldflags  = -L${LOCALBASE}/lib #{$LDFLAGS}
 dldflags = #{$DLDFLAGS}
 archflag = #{$ARCH_FLAG}
 DLDFLAGS = $(ldflags) $(dldflags) $(archflag)
@


1.1
log
@Update jruby to 1.6.0.  This version adds ruby 1.9 syntax support,
as well as experimental C extension support, and many other
significant new features.

Bump required memory to 384MB, should fix occassional memory
errors when building.

Use the jruby-complete.jar instead of the jruby.jar, seems
to be necessary for C extension support to work correctly.

RSpec is no longer bundled.  Additionally, the extra 1.5.3
distfile is no longer needed as the changes have been included
upstream.

OK landry@@
@
text
@d1 4
a4 4
$OpenBSD$
--- lib/ruby/site_ruby/shared/mkmf.rb.orig	Fri Mar 18 14:26:30 2011
+++ lib/ruby/site_ruby/shared/mkmf.rb	Fri Mar 18 14:29:23 2011
@@@@ -1362,11 +1362,11 @@@@ LIBRUBYARG_STATIC = #$LIBRUBYARG_STATIC
@

