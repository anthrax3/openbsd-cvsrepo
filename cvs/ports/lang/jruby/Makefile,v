head	1.67;
access;
symbols
	OPENBSD_6_1:1.62.0.2
	OPENBSD_6_1_BASE:1.62
	OPENBSD_6_0:1.57.0.2
	OPENBSD_6_0_BASE:1.57
	OPENBSD_5_9:1.55.0.2
	OPENBSD_5_9_BASE:1.55
	OPENBSD_5_8:1.53.0.4
	OPENBSD_5_8_BASE:1.53
	OPENBSD_5_7:1.49.0.2
	OPENBSD_5_7_BASE:1.49
	OPENBSD_5_6:1.43.0.2
	OPENBSD_5_6_BASE:1.43
	OPENBSD_5_5:1.41.0.2
	OPENBSD_5_5_BASE:1.41
	OPENBSD_5_4:1.37.0.2
	OPENBSD_5_4_BASE:1.37
	OPENBSD_5_3:1.34.0.2
	OPENBSD_5_3_BASE:1.34
	OPENBSD_5_2:1.32.0.2
	OPENBSD_5_2_BASE:1.32
	OPENBSD_5_1_BASE:1.30
	OPENBSD_5_1:1.30.0.2
	OPENBSD_5_0:1.22.0.2
	OPENBSD_5_0_BASE:1.22
	OPENBSD_4_9:1.17.0.2
	OPENBSD_4_9_BASE:1.17
	OPENBSD_4_8:1.9.0.4
	OPENBSD_4_8_BASE:1.9
	OPENBSD_4_7:1.9.0.2
	OPENBSD_4_7_BASE:1.9
	OPENBSD_4_6:1.7.0.2
	OPENBSD_4_6_BASE:1.7
	OPENBSD_4_5:1.5.0.4
	OPENBSD_4_5_BASE:1.5
	OPENBSD_4_4:1.5.0.2
	OPENBSD_4_4_BASE:1.5
	bernd_2008-jun-18:1.1.1.1
	bernd:1.1.1;
locks; strict;
comment	@# @;


1.67
date	2017.09.02.21.36.55;	author jeremy;	state Exp;
branches;
next	1.66;
commitid	Wvr86l9X5vhv98pv;

1.66
date	2017.07.26.22.45.25;	author sthen;	state Exp;
branches;
next	1.65;
commitid	tD4MFrpYYDDL2UFT;

1.65
date	2017.07.16.19.18.59;	author espie;	state Exp;
branches;
next	1.64;
commitid	tt0GhWK5c4uf9ILG;

1.64
date	2017.06.21.15.38.00;	author jeremy;	state Exp;
branches;
next	1.63;
commitid	zw0XbwDCBjBjVfF4;

1.63
date	2017.04.10.11.46.22;	author sthen;	state Exp;
branches;
next	1.62;
commitid	BLsh88fJB8thZTwY;

1.62
date	2017.03.08.16.32.25;	author jeremy;	state Exp;
branches
	1.62.2.1;
next	1.61;
commitid	RFZaUjSeK2WFV1kW;

1.61
date	2017.01.16.21.34.54;	author jeremy;	state Exp;
branches;
next	1.60;
commitid	p8PuvTL6TKVWXYni;

1.60
date	2016.11.19.04.56.27;	author jeremy;	state Exp;
branches;
next	1.59;
commitid	Xf5ZAxfISPZfnlqA;

1.59
date	2016.09.19.21.38.39;	author jeremy;	state Exp;
branches;
next	1.58;
commitid	ShrSoLXaMUmcgdHl;

1.58
date	2016.09.10.13.03.41;	author ajacoutot;	state Exp;
branches;
next	1.57;
commitid	4KcvAK91uGdTLejD;

1.57
date	2016.05.27.17.04.35;	author jeremy;	state Exp;
branches;
next	1.56;
commitid	c1KIK2uxBxGNIyAI;

1.56
date	2016.03.18.23.12.18;	author naddy;	state Exp;
branches;
next	1.55;
commitid	KZAl4KEiw6a3Jixw;

1.55
date	2015.10.26.15.29.39;	author jeremy;	state Exp;
branches;
next	1.54;
commitid	3tmYiiu1VOPBMqrK;

1.54
date	2015.09.05.14.48.53;	author jeremy;	state Exp;
branches;
next	1.53;
commitid	RJbXGf3UlPopG19r;

1.53
date	2015.07.28.21.55.32;	author jeremy;	state Exp;
branches;
next	1.52;
commitid	qXXjtHIDQN07JGN0;

1.52
date	2015.07.26.04.40.16;	author jeremy;	state Exp;
branches;
next	1.51;
commitid	AyM7apnVNX5zUHuA;

1.51
date	2015.07.15.22.19.23;	author jeremy;	state Exp;
branches;
next	1.50;
commitid	XUI7zONZWqXMXa10;

1.50
date	2015.05.14.15.38.25;	author jeremy;	state Exp;
branches;
next	1.49;
commitid	P9DMmeeqmk5TYNXq;

1.49
date	2015.02.01.17.34.21;	author jeremy;	state Exp;
branches;
next	1.48;
commitid	AQ9LTtQ372DvjBN0;

1.48
date	2014.12.10.17.00.01;	author jeremy;	state Exp;
branches;
next	1.47;
commitid	dvPFvUAxjy7ESTTV;

1.47
date	2014.11.08.19.59.18;	author jeremy;	state Exp;
branches;
next	1.46;
commitid	va5SJAKwFKFx5G7A;

1.46
date	2014.10.01.06.20.06;	author jasper;	state Exp;
branches;
next	1.45;
commitid	yUA7p5TcgG25OWkt;

1.45
date	2014.09.27.20.37.04;	author jasper;	state Exp;
branches;
next	1.44;
commitid	oTC6gMA4fDuqlb4C;

1.44
date	2014.09.22.15.17.01;	author jeremy;	state Exp;
branches;
next	1.43;
commitid	mRML24z8rsKnOuY1;

1.43
date	2014.06.27.15.26.02;	author jeremy;	state Exp;
branches;
next	1.42;
commitid	EXqOI3kIhSWl9ojO;

1.42
date	2014.05.18.15.43.54;	author jeremy;	state Exp;
branches;
next	1.41;

1.41
date	2013.12.19.21.39.50;	author jeremy;	state Exp;
branches;
next	1.40;

1.40
date	2013.10.26.23.41.04;	author jeremy;	state Exp;
branches;
next	1.39;

1.39
date	2013.10.15.02.36.21;	author jeremy;	state Exp;
branches;
next	1.38;

1.38
date	2013.08.22.21.35.57;	author sthen;	state Exp;
branches;
next	1.37;

1.37
date	2013.05.17.20.14.49;	author jeremy;	state Exp;
branches;
next	1.36;

1.36
date	2013.03.19.23.43.06;	author jeremy;	state Exp;
branches;
next	1.35;

1.35
date	2013.03.11.11.20.27;	author espie;	state Exp;
branches;
next	1.34;

1.34
date	2012.09.24.17.07.39;	author jeremy;	state Exp;
branches;
next	1.33;

1.33
date	2012.08.23.19.19.16;	author sthen;	state Exp;
branches;
next	1.32;

1.32
date	2012.05.04.20.15.53;	author jeremy;	state Exp;
branches;
next	1.31;

1.31
date	2012.04.04.20.23.59;	author jeremy;	state Exp;
branches;
next	1.30;

1.30
date	2012.01.05.02.10.06;	author jeremy;	state Exp;
branches;
next	1.29;

1.29
date	2011.12.09.21.46.15;	author jeremy;	state Exp;
branches;
next	1.28;

1.28
date	2011.11.14.12.00.04;	author jeremy;	state Exp;
branches;
next	1.27;

1.27
date	2011.11.14.11.38.16;	author jeremy;	state Exp;
branches;
next	1.26;

1.26
date	2011.11.08.23.47.20;	author jeremy;	state Exp;
branches;
next	1.25;

1.25
date	2011.09.16.10.31.21;	author espie;	state Exp;
branches;
next	1.24;

1.24
date	2011.08.30.17.16.36;	author jasper;	state Exp;
branches;
next	1.23;

1.23
date	2011.08.26.22.11.47;	author jeremy;	state Exp;
branches;
next	1.22;

1.22
date	2011.07.19.17.57.47;	author jeremy;	state Exp;
branches;
next	1.21;

1.21
date	2011.06.02.00.11.50;	author jeremy;	state Exp;
branches;
next	1.20;

1.20
date	2011.04.18.21.25.20;	author jeremy;	state Exp;
branches;
next	1.19;

1.19
date	2011.04.02.16.56.42;	author ajacoutot;	state Exp;
branches;
next	1.18;

1.18
date	2011.03.18.23.01.22;	author jeremy;	state Exp;
branches;
next	1.17;

1.17
date	2011.01.13.22.35.52;	author kurt;	state Exp;
branches;
next	1.16;

1.16
date	2010.12.06.16.32.17;	author jeremy;	state Exp;
branches;
next	1.15;

1.15
date	2010.11.26.02.43.32;	author jeremy;	state Exp;
branches;
next	1.14;

1.14
date	2010.11.22.15.49.14;	author jeremy;	state Exp;
branches;
next	1.13;

1.13
date	2010.11.19.15.57.43;	author jeremy;	state Exp;
branches;
next	1.12;

1.12
date	2010.11.17.08.05.17;	author espie;	state Exp;
branches;
next	1.11;

1.11
date	2010.11.07.16.37.42;	author jeremy;	state Exp;
branches;
next	1.10;

1.10
date	2010.10.28.01.45.44;	author jeremy;	state Exp;
branches;
next	1.9;

1.9
date	2010.02.03.12.59.24;	author jasper;	state Exp;
branches;
next	1.8;

1.8
date	2009.08.09.11.18.59;	author bernd;	state Exp;
branches;
next	1.7;

1.7
date	2009.04.26.09.38.25;	author sthen;	state Exp;
branches;
next	1.6;

1.6
date	2009.03.11.23.22.49;	author sthen;	state Exp;
branches;
next	1.5;

1.5
date	2008.07.22.07.35.45;	author bernd;	state Exp;
branches;
next	1.4;

1.4
date	2008.07.21.11.17.33;	author bernd;	state Exp;
branches;
next	1.3;

1.3
date	2008.07.10.23.31.40;	author bernd;	state Exp;
branches;
next	1.2;

1.2
date	2008.06.23.20.33.19;	author bernd;	state Exp;
branches;
next	1.1;

1.1
date	2008.06.17.22.27.41;	author bernd;	state Exp;
branches
	1.1.1.1;
next	;

1.1.1.1
date	2008.06.17.22.27.41;	author bernd;	state Exp;
branches;
next	;

1.62.2.1
date	2017.09.07.17.22.47;	author jeremy;	state Exp;
branches;
next	;
commitid	a70T4hWDAfXNnxOW;


desc
@@


1.67
log
@Apply security patches in rubygems 2.6.13 to JRuby, based on the
upstream patch provided by ruby-core for ruby 2.4.

No CVE numbers, but this fixes the following vulnerabilities:

* Fix a DNS request hijacking vulnerability.
* Fix an ANSI escape sequence vulnerability.
* Fix a DOS vulernerability in the query command.
* Fix a vulnerability in the gem installer that allowed a malicious
  gem to overwrite arbitrary files.
@
text
@# $OpenBSD: Makefile,v 1.66 2017/07/26 22:45:25 sthen Exp $

# Runtime failures on i386 in IO#pos and IO#rewind
ONLY_FOR_ARCHS = amd64

COMMENT =	pure-Java implementation of the Ruby language

V =		9.1.12.0
DISTNAME =	jruby-bin-${V}
PKGNAME =	jruby-${V}
CATEGORIES =	lang lang/ruby
DISTFILES =	${DISTNAME}.tar.gz \
		jnr-jffi-1.2.2-0-g4c196bb.tar.gz:0 \
		${JRUBY_LAUNCHER_GEM}:1
REVISION =	1

HOMEPAGE =	http://www.jruby.org/

MAINTAINER =	Jeremy Evans <jeremy@@openbsd.org>

# EPLv1/GPLv2/LGPLv2.1/Ruby/MIT/BSD/Apache/CPL
PERMIT_PACKAGE_CDROM =	Yes

MASTER_SITES =	http://jruby.org.s3.amazonaws.com/downloads/${V}/
MASTER_SITES0 =	http://www.distfiles.nl/
MASTER_SITES1 =	${MASTER_SITE_RUBYGEMS}

MODULES =	java
MODJAVA_VER =	1.8+
MODJAVA_JRERUN = Yes
USE_GMAKE =	Yes

WANTLIB =	c m pthread ${COMPILER_LIBCXX}

BUILD_DEPENDS =	devel/apache-ant \
		shells/bash \
		${RUN_DEPENDS}
RUN_DEPENDS =	java/javaPathHelper

MAKE_ENV =	JAVA_HOME=${JAVA_HOME} MAKE=${MAKE_PROGRAM}

JRUBY_HOME =	${PREFIX}/jruby

WRKDIST =	${WRKDIR}/jruby-${V}
ANT_CMD =	${SETENV} ${MAKE_ENV} PATH=${JAVA_HOME}/bin:${PATH} \
			${LOCALBASE}/bin/ant
JFFI_HOME =	${WRKDIST}/jffi
JFFI_ARCH =	${MACHINE_ARCH:S/amd64/x86_64/}-OpenBSD
FFI_ARCH =	${JFFI_ARCH:L}
JRUBY_LAUNCHER_GEM = jruby-launcher-1.1.1-java.gem
SUBST_VARS =	JRUBY_HOME JFFI_ARCH FFI_ARCH RAKE_V RDOC_V JAVA_HOME

post-extract:
	mv ${WRKDIR}/jnr-jffi* ${JFFI_HOME}
	# Unpack the jruby-launcher gem, since it needs to be patched
	cd ${WRKSRC} && mkdir jruby-launcher \
		&& cd jruby-launcher && tar zxf ../../data.tar.gz \
		&& rm -f ../../data.tar.gz
	cp ${WRKSRC}/lib/ruby/gems/shared/gems/*/bin/* ${WRKSRC}/bin/

do-configure:
	${SUBST_CMD} ${WRKSRC}/jruby-launcher/jrubyexe.cpp \
		${WRKSRC}/jruby-launcher/unixlauncher.cpp
	cd ${WRKSRC}/jruby-launcher/ && ${SET_ENV} ${MAKE_ENV} \
		../bin/jruby extconf.rb
	perl -pi -e '$$. == 1 && s|^.*env j?ruby.*$$|\#!${LOCALBASE}/bin/jruby|;' \
                -e '$$. == 1 && s|^.*bin/j?ruby.*$$|\#!${LOCALBASE}/bin/jruby|;' \
                -e 'close ARGV if eof;' ${WRKSRC}/bin/!(*.*)

do-build:
	cd ${JFFI_HOME} && ${ANT_CMD} jar
	rm -rf ${WRKSRC}/lib/jni
	mkdir -p ${WRKSRC}/lib/jni/${JFFI_ARCH}
	cp ${JFFI_HOME}/build/jni/libjffi-1.2.so \
		${WRKSRC}/lib/jni/${JFFI_ARCH}
	cd ${WRKSRC}/lib/ruby/stdlib/ffi/platform && \
		rm -r !(${FFI_ARCH}|*.ffi)
	cd ${WRKSRC}/jruby-launcher/ && gmake && mv jruby ../bin

do-install:
	ln -s ${TRUEPREFIX}/jruby/bin/jruby ${PREFIX}/bin/jruby
	${INSTALL_DATA_DIR} ${JRUBY_HOME}
	${INSTALL_DATA_DIR} ${JRUBY_HOME}/bin
	for file in ast gem jgem jirb jirb_swing jruby rake rdoc ri testrb; \
	  do ${INSTALL_SCRIPT} ${WRKBUILD}/bin/$$file ${JRUBY_HOME}/bin/$$file; \
	done
	${INSTALL_DATA_DIR} ${JRUBY_HOME}/lib
	cd ${WRKBUILD}/lib && tar -cf - * | \
		tar -C ${JRUBY_HOME}/lib -xf -
	mkdir -p ${JRUBY_HOME}/lib/ruby/{1.8,1.9,2.0}/site_ruby
	find ${JRUBY_HOME}/lib -name '*.orig' -print0 | xargs -0r rm
	find ${JRUBY_HOME}/lib -name '*.beforesubst' -print0 | xargs -0r rm
	mv ${JRUBY_HOME}/lib/ruby/gems/{shared,1.8}
	ln -s 1.8 ${JRUBY_HOME}/lib/ruby/gems/shared
	chown -R ${SHAREOWN}:${SHAREGRP} ${JRUBY_HOME}/lib

# JRuby doesn't ship tests in the binary distribution
# Try running the database/ruby-sequel,jruby tests after an update
NO_TEST =	Yes

.include <bsd.port.mk>
@


1.66
log
@bump LIBCXX/LIBECXX/COMPILER_LIBCXX ports.
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.65 2017/07/16 19:18:59 espie Exp $
d15 1
a15 1
REVISION =	0
@


1.65
log
@use COMPILER_LIBCXX where applicable
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.64 2017/06/21 15:38:00 jeremy Exp $
d15 1
@


1.64
log
@Update to JRuby 9.1.12.0
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.63 2017/04/10 11:46:22 sthen Exp $
d32 1
a32 1
WANTLIB =	c m pthread ${LIBCXX}
@


1.63
log
@use LIBCXX
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.62 2017/03/08 16:32:25 jeremy Exp $
d8 1
a8 1
V =		9.1.8.0
@


1.62
log
@Update to JRuby 9.1.8.0

Fix hardcoding of gcc and g++.
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.61 2017/01/16 21:34:54 jeremy Exp $
d32 1
a32 1
WANTLIB =	c m pthread stdc++
@


1.62.2.1
log
@Apply rubygems 2.6.13 security patches
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.62 2017/03/08 16:32:25 jeremy Exp $
a14 2

REVISION =	0
@


1.61
log
@Update to JRuby 9.1.7.0
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.60 2016/11/19 04:56:27 jeremy Exp $
d8 1
a8 1
V =		9.1.7.0
@


1.60
log
@Update to JRuby 9.1.6.0
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.59 2016/09/19 21:38:39 jeremy Exp $
d8 1
a8 1
V =		9.1.6.0
@


1.59
log
@Update to JRuby 9.1.5.0
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.58 2016/09/10 13:03:41 ajacoutot Exp $
d8 1
a8 1
V =		9.1.5.0
@


1.58
log
@First pass at pre-entively fixing ports that would break once guenther's header
pollution diff is in.

lang/squeak/vm does not build but it's due to the recent audio changes
games/xbattle: also fixes some conflicting implicit decl
print/hplip: also fixes some conflicting implicit decl
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.57 2016/05/27 17:04:35 jeremy Exp $
d8 1
a8 1
V =		9.1.1.0
a14 1
REVISION =	0
@


1.57
log
@Update JRuby to 9.1.1.0

This changes the ruby version JRuby supports to 2.3, so update ruby.port.mk
to match.
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.56 2016/03/18 23:12:18 naddy Exp $
d15 1
@


1.56
log
@remove SHARED_ONLY from ports that only use modules that neither set nor
read this variable
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.55 2015/10/26 15:29:39 jeremy Exp $
d8 1
a8 1
V =		9.0.3.0
a48 2
RAKE_V =	10.1.0
RDOC_V =	4.0.1
@


1.55
log
@Update to JRuby 9.0.3.0
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.54 2015/09/05 14:48:53 jeremy Exp $
a4 2

SHARED_ONLY =	Yes
@


1.54
log
@Update to JRuby 9.0.1.0
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.53 2015/07/28 21:55:32 jeremy Exp $
d10 1
a10 1
V =		9.0.1.0
@


1.53
log
@Set ONLY_FOR_ARCHS = amd64, due to runtime issues on i386

OK jasper@@
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.52 2015/07/26 04:40:16 jeremy Exp $
d10 1
a10 1
V =		9.0.0.0
@


1.52
log
@Update to JRuby 9.0.0.0

Bump jdk dependency to 1.8.0

Help and OK jasper@@
@
text
@d1 4
a4 1
# $OpenBSD: Makefile,v 1.51 2015/07/15 22:19:23 jeremy Exp $
@


1.51
log
@Update to jruby 1.7.21

This removes a lot of the gems that were temporarily shipped with JRuby.

OK jasper@@
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.50 2015/05/14 15:38:25 jeremy Exp $
d7 1
a7 1
V =		1.7.21
d27 1
a27 1
MODJAVA_VER =	1.7+
d50 2
a51 2
JRUBY_LAUNCHER_GEM = jruby-launcher-1.0.19-java.gem
SUBST_VARS =	JRUBY_HOME JFFI_ARCH FFI_ARCH RAKE_V RDOC_V
d76 1
a76 1
	cd ${WRKSRC}/lib/ruby/shared/ffi/platform && \
@


1.50
log
@Update to jruby 1.7.20

OK jasper@@
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.49 2015/02/01 17:34:21 jeremy Exp $
d7 1
a7 1
V =		1.7.20
a59 2
	find ${WRKSRC}/lib/ruby/gems/shared/gems/{axiom-types,descendants_tracker}-* \
		-type f -print0 | xargs -0 chmod 664
@


1.49
log
@Update to jruby 1.7.19
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.48 2014/12/10 17:00:01 jeremy Exp $
d7 1
a7 1
V =		1.7.19
@


1.48
log
@Update to JRuby 1.7.17

Stop overriding the internal jnr-posix implementation, as the patches
in our copy have been merged upstream.  This also means we can drop the
zip/unzip BDEPs.

OK jasper@@
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.47 2014/11/08 19:59:18 jeremy Exp $
d7 1
a7 1
V =		1.7.17
@


1.47
log
@Update the embedded jnr-posix library, fixes File.utime on i386.
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.46 2014/10/01 06:20:06 jasper Exp $
d7 1
a7 1
V =		1.7.16
a12 1
		jnr-posix-3.0.7-SNAPSHOT.tar.gz:0 \
a13 1
REVISION =	1
d33 1
a33 3
BUILD_DEPENDS =	archivers/unzip \
		archivers/zip \
		devel/apache-ant \
a54 1
	cd ${WRKSRC} && unzip ${WRKDIR}/jnr-posix.jar
a72 1
	cd ${WRKSRC} && ${LOCALBASE}/bin/zip -r lib/jruby.jar jnr/posix/
@


1.46
log
@- switch to a newer jnr-posix jar based on 3.0.7-SNAPSHOT
- also shuffle MASTER_SITES a bit

ok jeremy@@
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.45 2014/09/27 20:37:04 jasper Exp $
d13 1
a13 1
		jnr-posix-20140930.tar.gz:0 \
d15 1
a15 1
REVISION =	0
@


1.45
log
@- update to jruby-1.7.16

ok jeremy@@ who had the same diff
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.44 2014/09/22 15:17:01 jeremy Exp $
d13 3
a15 2
		jnr-posix.20130822.tar.gz:1 \
		${JRUBY_LAUNCHER_GEM}:2
d26 1
a26 2
MASTER_SITES1 =	http://spacehopper.org/mirrors/
MASTER_SITES2 =	${MASTER_SITE_RUBYGEMS}
@


1.44
log
@Update to jruby 1.7.15.

Fix bad file modes in newly included gems.
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.43 2014/06/27 15:26:02 jeremy Exp $
d7 1
a7 1
V =		1.7.15
@


1.43
log
@Update to JRuby 1.7.13.
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.42 2014/05/18 15:43:54 jeremy Exp $
d7 1
a7 1
V =		1.7.13
d65 2
@


1.42
log
@Update to JRuby 1.7.12.
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.41 2013/12/19 21:39:50 jeremy Exp $
d7 1
a7 1
V =		1.7.12
@


1.41
log
@Update to JRuby 1.7.9

Work around upstream regression causing rake/rdoc/ri to not work by
copying the real executables over the rubygems shims.

Fix the #! lines on the executables.

The old ant based tests no longer work, and the new maven tests
require downloading tons of packages at runtime, so punt and mark
NO_TEST=Yes and stop downloading the -src tarball.
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.40 2013/10/26 23:41:04 jeremy Exp $
d7 1
a7 1
V =		1.7.9
d53 1
a53 1
RDOC_V =	4.0.1	
@


1.40
log
@Update to jruby 1.7.6. Add maven as a test dependency, since it is
required to run the tests.  Remove rubygems patch as it was applied
upstream.
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.39 2013/10/15 02:36:21 jeremy Exp $
d7 1
a7 1
V =		1.7.6
a11 1
		jruby-src-${V}.tar.gz \
d52 2
a53 1
RAKE_V =		10.1.0
d55 1
a55 1
SUBST_VARS =	JRUBY_HOME JFFI_ARCH FFI_ARCH RAKE_V
d64 1
d71 3
d103 3
a105 9
ANT_TEST_CMD =	${SETENV} ${MAKE_ENV} HOME=${WRKBUILD} \
			PATH=${JAVA_HOME}/bin:${PATH} \
			ANT_OPTS="-Xms512m -Xmx512m" \
			${LOCALBASE}/bin/ant
TEST_DEPENDS =	devel/ruby-rspec/rspec,jruby \
		devel/maven
# Tests run: 363, Failures: 7, Errors: 11, Skipped: 0
do-test:
	-cd ${WRKSRC} && ${ANT_TEST_CMD} test
@


1.39
log
@Update to jruby-1.7.5.  Upstream changed to a maven-based src build
system that downloads 190+ .jar files at build time.  Switch to using
the binary distribution, since there is no point compiling java source
code to java bytecode when we can use the precompiled java bytecode.

Use our custom jnr-posix distfile with 64-bit time_t support by
directly patching jruby.jar.

Add jruby-launcher gem as a separate distfile, but since we only need
the binary, compile it manually and don't install the gem.

Still keep the src distfile for the tests, because the binary distfile
doesn't include them.

Add patch to work around rubygems regression with .files in the root
of the gem not getting installed (already accepted upstream).
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.38 2013/08/22 21:35:57 sthen Exp $
d7 1
a7 1
V =		1.7.5
d103 2
a104 1
TEST_DEPENDS =	devel/ruby-rspec/rspec,jruby
@


1.38
log
@switch jruby to a modified jnr-posix.jar fixing post-64-bit time_t,
this is an interim fix until it's handled upstream. jar from & ok jeremy@@
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.37 2013/05/17 20:14:49 jeremy Exp $
d7 2
a8 3
V =		1.7.4
REVISION =	0
DISTNAME =	jruby-src-${V}
d12 1
d14 2
a15 1
		jnr-posix.20130822.tar.gz:1
d21 1
a21 1
# CPL/GPLv2/LGPLv2.1/GPLv3/LGPLv3
d27 1
d36 3
a38 1
BUILD_DEPENDS =	devel/apache-ant \
d53 3
a55 3
RAKE_V =	10.0.3
JRUBY_LAUNCHER_V =	1.0.15
SUBST_VARS =	JRUBY_HOME JFFI_ARCH FFI_ARCH RAKE_V JRUBY_LAUNCHER_V
d59 1
a59 1
	mv ${WRKDIR}/jnr-posix.jar ${WRKSRC}/build_lib/
d61 3
a63 4
	cp ${WRKSRC}/build_lib/jruby-launcher-${JRUBY_LAUNCHER_V}-java{,-orig}.gem
	cd ${WRKSRC} && mkdir jruby-launcher && tar xf \
		build_lib/jruby-launcher-${JRUBY_LAUNCHER_V}-java.gem \
		&& cd jruby-launcher && tar zxf ../data.tar.gz
d65 1
a65 1
pre-configure:
d68 2
a69 6
	# Rebuild the jruby-launcher gem
	cd ${WRKSRC}/jruby-launcher && find . -type f \! -name '*.orig'  -print | \
		pax -wz -s '/^\.\///' -f ../data.tar.gz
	cd ${WRKSRC} && tar cf \
		build_lib/jruby-launcher-${JRUBY_LAUNCHER_V}-java.gem \
		data.tar.gz metadata.gz
d72 6
a77 7
	cd ${JFFI_HOME} && ${ANT_CMD} jar test && \
		cp dist/jffi-*-OpenBSD.jar ${WRKDIST}/build_lib
	cd ${WRKSRC} && ${ANT_CMD}

post-build:
	${SUBST_CMD} ${WRKSRC}/bin/jruby
	cd ${WRKSRC}/lib/native && rm -r !(${JFFI_ARCH}*)
d79 2
a80 1
	  rm -r !(${FFI_ARCH}|*.ffi)
d86 1
a86 1
	for file in ast gem jgem jirb jirb_swing jruby jrubyc rdoc ri testrb; \
a92 5
	${SET_ENV} ${MAKE_ENV} PATH=${JRUBY_HOME}/bin:$$PATH HOME=${WRKBUILD} \
		make=${LOCALBASE}/bin/gmake ${PREFIX}/jruby/bin/jruby \
		${PREFIX}/jruby/bin/gem install --local --no-rdoc --no-ri \
		${WRKBUILD}/build_lib/rake-${RAKE_V}.gem \
		${WRKBUILD}/build_lib/jruby-launcher-${JRUBY_LAUNCHER_V}-java.gem 
d100 5
a104 9
				PATH=${JAVA_HOME}/bin:${PATH} \
				ANT_OPTS="-Xms512m -Xmx512m" \
				${LOCALBASE}/bin/ant
# Expected test failures:
#   4 Failures in JRubyTestSuite
#   1 Failure in MainTestSuite
#   1 Failure in MRITestSuite
# spec task disabled by default as it needs network access to download
# the latest specs.
a106 1
	#cd ${WRKSRC} && ${ANT_TEST_CMD} spec
@


1.37
log
@Update to jruby 1.7.4.  Make sure site_ruby directory is created
in correct location.  Fix test target.  Remove unneeded patch
to bash script.
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.36 2013/03/19 23:43:06 jeremy Exp $
d8 1
d13 2
a14 1
		jnr-jffi-1.2.2-0-g4c196bb.tar.gz:0
d25 1
d55 1
@


1.36
log
@Update to jruby 1.7.3.

Drop support for C extensions (which were always expiremental).
Use jruby.jar instead of jruby-complete.jar, for a more typical
jruby installation.
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.35 2013/03/11 11:20:27 espie Exp $
d7 1
a7 1
V =		1.7.3
d89 1
a89 1
	mkdir -p ${JRUBY_HOME}/lib/ruby/site_ruby/{1.8/java,1.9}
d111 3
a113 3
do-regress:
	-cd ${WRKSRC} && ${ANT_REGRESS_CMD} test
	#cd ${WRKSRC} && ${ANT_REGRESS_CMD} spec
@


1.35
log
@PERMIT_* / REGRESS->TEST sweep
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.34 2012/09/24 17:07:39 jeremy Exp $
d7 1
a7 1
V =		1.6.8
d12 1
a12 1
		wmeissner-jffi-1.0.2-0-ge0d10e9.tar.gz:0
a20 2
WANTLIB += c m pthread stdc++

d22 1
a22 1
MASTER_SITES0 =	http://distfiles.bsdfrog.org/
d29 2
d36 2
a37 3
MAKE_ENV =	JAVA_HOME=${JAVA_HOME} ANT_OPTS="-Xms434m -Xmx434m" \
			MAKE=${MAKE_PROGRAM}
			
d46 2
a47 2
RAKE_V =	0.8.7
JRUBY_LAUNCHER_V =	1.0.8
d51 1
a51 1
	mv ${WRKDIR}/wmeissner-jffi-e0d10e9 ${JFFI_HOME}
d59 1
a59 2
	${SUBST_CMD} ${WRKSRC}/lib/ruby/site_ruby/shared/mkmf.rb \
		${WRKSRC}/jruby-launcher/jrubyexe.cpp \
a66 1
	rm ${WRKSRC}/lib/ruby/site_ruby/shared/mkmf.rb.orig
a71 5
	cd ${WRKSRC}/cext/src && \
		${SETENV} ${MAKE_ENV} \
		PATH=$$PATH:/usr/local/jdk-1.7.0/bin \
		${MAKE_PROGRAM}
	cd ${WRKSRC} && ${ANT_CMD} jar-complete
a74 1
	rm ${WRKSRC}/lib/jruby.jar
d76 1
a76 3
	cd ${WRKSRC}/cext/src/ && tar -cf - include | \
		tar -C ${WRKSRC}/lib/native -xf -
	cd ${WRKSRC}/lib/ruby/site_ruby/shared/ffi/platform && \
d89 1
a89 3
	cd ${WRKBUILD} && rm -rf share/ri/1.8/system/* share/ri.jar
	cd ${WRKBUILD} && tar -cf - share | \
		tar -C ${JRUBY_HOME} -xf -
d95 5
a99 2
	mkdir -p ${JRUBY_HOME}/lib/ruby/site_ruby/1.8/java
	chown -R ${SHAREOWN}:${SHAREGRP} ${JRUBY_HOME}/lib ${JRUBY_HOME}/share
d103 1
d111 3
a113 4
do-test:
	rm -f ${WRKSRC}/lib/jruby-complete.jar
	-cd ${WRKSRC} && ${ANT_TEST_CMD} test
	#cd ${WRKSRC} && ${ANT_TEST_CMD} spec
@


1.34
log
@Update to jruby 1.6.8.
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.33 2012/08/23 19:19:16 sthen Exp $
a19 3
PERMIT_PACKAGE_FTP =	Yes
PERMIT_DISTFILES_CDROM = Yes
PERMIT_DISTFILES_FTP =	Yes
d111 1
a111 1
ANT_REGRESS_CMD =	${SETENV} ${MAKE_ENV} HOME=${WRKBUILD} \
d120 1
a120 1
do-regress:
d122 2
a123 2
	-cd ${WRKSRC} && ${ANT_REGRESS_CMD} test
	#cd ${WRKSRC} && ${ANT_REGRESS_CMD} spec
@


1.33
log
@sync wantlib
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.32 2012/05/04 20:15:53 jeremy Exp $
d7 1
a7 1
V =		1.6.7.2
a9 1
REVISION =	0
@


1.32
log
@Update to jruby 1.6.7.2, only change is a rubygems update to work
fix SSL security issues when installing gems.
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.31 2012/04/04 20:23:59 jeremy Exp $
d10 1
d25 2
a33 2

WANTLIB =	c m stdc++
@


1.31
log
@Update to jruby 1.6.7.
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.30 2012/01/05 02:10:06 jeremy Exp $
d7 1
a7 1
V =		1.6.7
@


1.30
log
@Update to 1.6.5.1, fixing the denial of service vulnerability
described in CERT-2011-003.
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.29 2011/12/09 21:46:15 jeremy Exp $
d7 1
a7 1
V =		1.6.5.1
@


1.29
log
@Setup symlink to jruby/bin/jruby at bin/jruby, so that jruby is usable
without any modifications to PATH.  To run an ruby program that is
installed in jruby's bin directory (which no longer needs to be in the
PATH), use jruby -S program.
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.28 2011/11/14 12:00:04 jeremy Exp $
d7 1
a7 1
V =		1.6.5
a9 1
REVISION =	0
@


1.28
log
@Don't run spec task during regress

The spec task requires network access via git, which is not allowed.
Since git isn't needed anymore for regress, remove it from
REGRESS_DEPENDS.  The spec task is just commented out in case somone
wants to run it manually.
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.27 2011/11/14 11:38:16 jeremy Exp $
d10 1
d65 1
d95 1
@


1.27
log
@Make regress tests work.

Set JAVA_HOME and PATH and disable forking so java doesn't crash when
running the test and spec tasks.  Don't install the jruby-launcher gem
when running the test and spec tasks, as it fails.

Regress depend on git when running the specs, as it needs to download
current rubyspecs for the spec task.

Delete the jruby-complete.jar file and just use the jruby.jar file
when running the specs, as otherwise you get additional test failures
and warnings.

Switch to SUBST_CMD while here now that has been fixed. Also, bump
the memory limits by 50M as 384M doesn't seem to be enough in all
cases.
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.26 2011/11/08 23:47:20 jeremy Exp $
a111 1
REGRESS_DEPENDS =	devel/git
d119 2
a120 2
# 41 spec failures, 2 errors, but this grabs the latest specs via git, so it
# can change.
d124 1
a124 1
	cd ${WRKSRC} && ${ANT_REGRESS_CMD} spec
@


1.26
log
@Update to JRuby 1.6.5.

Make jruby binary not segfault if PATH isn't set correctly.

Remove rubygems hacks, since they are no longer necessary now
that the versions of rubygems for the other ruby interpreters
are > 1.3.7.

No longer ship the ri documentation files with JRuby.  JRuby
ships with a broken ri binary anyway (requires the rdoc gem to
work), and almost all users of JRuby have MRI ruby installed
and can use its ri binary.
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.25 2011/09/16 10:31:21 espie Exp $
d39 1
a39 1
MAKE_ENV =	JAVA_HOME=${JAVA_HOME} ANT_OPTS="-Xms384m -Xmx384m" \
d45 2
a46 1
ANT_CMD =	${SETENV} ${MAKE_ENV} ${LOCALBASE}/bin/ant
d63 1
a63 3
	# SUBST_CMD causes problems because $\( -> $(
	perl -pi -e 's,\$$\{LOCALBASE\},'${LOCALBASE}',g' \
		${WRKSRC}/lib/ruby/site_ruby/shared/mkmf.rb \
d112 10
d123 3
a125 2
	cd ${WRKSRC} && ${ANT_CMD} test
	cd ${WRKSRC} && ${ANT_CMD} spec
@


1.25
log
@normalize pkgpath
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.24 2011/08/30 17:16:36 jasper Exp $
d7 1
a7 1
V =		1.6.4
a10 1
REVISION =	1
d62 4
a71 3
	# SUBST_CMD causes problems because $\( -> $(
	perl -pi -e 's,\$$\{LOCALBASE\},'${LOCALBASE}',' \
		${WRKSRC}/lib/ruby/site_ruby/shared/mkmf.rb
d102 1
d108 2
a109 1
		${WRKBUILD}/build_lib/{rake*,jruby-launcher*-java}.gem 
@


1.24
log
@- bump REVISION after recent java.port.mk change
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.23 2011/08/26 22:11:47 jeremy Exp $
d11 1
a11 1
REVISION =	0
@


1.23
log
@Update to JRuby 1.6.4
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.22 2011/07/19 17:57:47 jeremy Exp $
d11 1
@


1.22
log
@Update to 1.6.3.  Make bin/jruby a compiled file instead of a bash
script, so it can now be used in shebang lines.  Remove the
building of nailgun, since nailgun support is now part of the
jruby binary.

This requires patching the included jruby-launcher gem to make a
similar change we used to make to the jruby.bash script, to set the
JAVA_HOME environment so things work correctly.

Also, create the SITEARCHDIR directory by default.

OK jcs@@
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.21 2011/06/02 00:11:50 jeremy Exp $
d7 1
a7 1
V =		1.6.3
d50 1
a50 1
JRUBY_LAUNCHER_V =	1.0.7
@


1.21
log
@Update to version 1.6.2.
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.20 2011/04/18 21:25:20 jeremy Exp $
d7 1
a7 1
V =		1.6.2
d35 1
d37 1
a37 2
RUN_DEPENDS =	java/javaPathHelper \
		shells/bash
d50 2
a51 1
SUBST_VARS =	JRUBY_HOME JFFI_ARCH FFI_ARCH RAKE_V
d55 5
d62 6
d69 2
a70 1
	perl -pi -e 's,\$$\{LOCALBASE\},'${LOCALBASE}',' ${WRKSRC}/lib/ruby/site_ruby/shared/mkmf.rb
a80 3
	cd ${WRKSRC}/tool/nailgun && \
		${SETENV} ${CONFIGURE_ENV} ./configure && \
		${SETENV} ${MAKE_ENV} ${MAKE_PROGRAM}
d104 5
a108 7
		make=${LOCALBASE}/bin/gmake \
		${PREFIX}/jruby/bin/jruby ${PREFIX}/jruby/bin/gem install \
		--local --no-rdoc --no-ri ${WRKBUILD}/build_lib/rake*.gem
	${INSTALL_DATA_DIR} ${JRUBY_HOME}/tool/nailgun
	${INSTALL_PROGRAM} ${WRKSRC}/tool/nailgun/ng ${JRUBY_HOME}/tool/nailgun
	chown -R ${SHAREOWN}:${SHAREGRP} ${JRUBY_HOME}/lib ${JRUBY_HOME}/share \
		${JRUBY_HOME}/tool
@


1.20
log
@Update to JRuby 1.6.1.

OK ajacoutot@@
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.19 2011/04/02 16:56:42 ajacoutot Exp $
d7 1
a7 1
V =		1.6.1
@


1.19
log
@Simplify: use my distfiles subdomain.
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.18 2011/03/18 23:01:22 jeremy Exp $
d7 1
a7 1
V =		1.6.0
@


1.18
log
@Update jruby to 1.6.0.  This version adds ruby 1.9 syntax support,
as well as experimental C extension support, and many other
significant new features.

Bump required memory to 384MB, should fix occassional memory
errors when building.

Use the jruby-complete.jar instead of the jruby.jar, seems
to be necessary for C extension support to work correctly.

RSpec is no longer bundled.  Additionally, the extra 1.5.3
distfile is no longer needed as the changes have been included
upstream.

OK landry@@
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.17 2011/01/13 22:35:52 kurt Exp $
d25 1
a25 1
MASTER_SITES0 =	http://www.bsdfrog.org/OpenBSD/distfiles/
@


1.17
log
@Correct snafu with pkg version going backwards. Clue bat
beating from espie@@ help and okay landry@@
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.16 2010/12/06 16:32:17 jeremy Exp $
d7 1
a7 1
V =		1.5.6
a9 1
REVISION=	0
d12 1
a12 2
		wmeissner-jffi-1.0.2-0-ge0d10e9.tar.gz:0 \
		jruby-1.5.3-ffi-${MACHINE_ARCH}.tar.gz:0
d24 1
a24 1
MASTER_SITES =	http://jruby.org.s3.amazonaws.com/downloads/$V/
d32 1
a32 1
WANTLIB =	c
d35 1
a35 1
		shells/bash
d39 3
a41 1
MAKE_ENV =	JAVA_HOME=${JAVA_HOME} ANT_OPTS="-Xms256m -Xmx256m"
d47 4
a50 3
JFFI_ARCH=	${MACHINE_ARCH:S/amd64/x86_64/}-OpenBSD
FFI_ARCH=	${JFFI_ARCH:L}
SUBST_VARS =	JRUBY_HOME JFFI_ARCH FFI_ARCH
d54 5
a58 3
	mkdir -p ${WRKSRC}/lib/ruby/site_ruby/shared/ffi/platform/${FFI_ARCH}
	mv ${WRKDIR}/jruby-1.5.3/lib/ruby/site_ruby/shared/ffi/platform/${FFI_ARCH}/* \
		${WRKSRC}/lib/ruby/site_ruby/shared/ffi/platform/${FFI_ARCH}/
d63 6
a68 4
	@@cd ${WRKSRC} && rm \
	  src/org/jruby/runtime/invokedynamic/InvokeDynamicSupport.java
	@@cd ${WRKSRC} && ${ANT_CMD}
	@@cd ${WRKSRC}/tool/nailgun && \
d71 1
d74 6
a79 3
	@@${SUBST_CMD} ${WRKBUILD}/bin/jruby
	@@cd ${WRKSRC}/lib/native && rm -r !(*OpenBSD*)
	@@cd ${WRKSRC}/lib/ruby/site_ruby/shared/ffi/platform && \
d93 4
a96 3
	${SET_ENV} ${MAKE_ENV} PATH=${JRUBY_HOME}/bin:$$PATH \
		${PREFIX}/jruby/bin/gem install --no-rdoc --no-ri \
		${WRKBUILD}/build_lib/{rake,rspec}*.gem
@


1.16
log
@Bump version to 1.5.6.

OK landry@@
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.15 2010/11/26 02:43:32 jeremy Exp $
d10 1
@


1.15
log
@Install the binaries with the same names as upstream, fixes building
ruby gem ports with the jruby FLAVOR in some cases.

Don't install the rdoc for the rake and rspec gems, for better
consistency with other ruby gem ports.

Add a @@comment file to PLIST to fix update-plist adding a file that
shouldn't be in the package.

OK landry@@
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.14 2010/11/22 15:49:14 jeremy Exp $
d7 1
a7 1
V =		1.5.5
a9 1
REVISION =	1
@


1.14
log
@Fix build on amd64.  Bump for safety because i386 package could have
changed.

OK landry@@
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.13 2010/11/19 15:57:43 jeremy Exp $
d10 1
a10 1
REVISION =	0
d76 2
a77 5
	for file in jgem jirb jirb_swing jruby jrubyc; do \
	  ${INSTALL_SCRIPT} ${WRKBUILD}/bin/$$file ${JRUBY_HOME}/bin/$$file; \
	done
	for file in ast rdoc ri; do \
	  ${INSTALL_SCRIPT} ${WRKBUILD}/bin/$$file ${JRUBY_HOME}/bin/j$$file; \
d85 1
a85 1
		${PREFIX}/jruby/bin/jgem install \
a86 3
	for file in autospec rake spec; do \
	  ln ${JRUBY_HOME}/bin/$$file ${JRUBY_HOME}/bin/j$$file; \
	done
@


1.13
log
@Update from 1.5.3 to 1.5.5.

OK landry@@
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.12 2010/11/17 08:05:17 espie Exp $
d10 1
d53 2
a54 1
	mv ${WRKDIR}/jruby-1.5.3/lib/ruby/site_ruby/shared/ffi/platform/${FFI_ARCH}/*.rb \
@


1.12
log
@new depends
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.11 2010/11/07 16:37:42 jeremy Exp $
d7 1
a7 1
V =		1.5.3
a9 1
REVISION =	0
d13 1
a13 1
		jruby-${V}-ffi-${MACHINE_ARCH}.tar.gz:0
d52 2
@


1.11
log
@Fix build on a clean system and add a patch to make JRuby work with
more FFI libraries.

OK landry@@, bernd@@
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.10 2010/10/28 01:45:44 jeremy Exp $
d36 4
a39 4
BUILD_DEPENDS =	::devel/apache-ant \
		::shells/bash
RUN_DEPENDS =	::java/javaPathHelper \
		::shells/bash
@


1.10
log
@Update lang/jruby from 1.3.1 to 1.5.3.  Numerous improvements including
performance increases and ruby 1.8.7 support. ffi support now works in
simple cases.  It now works on amd64 as well.  I'm taking over
maintenance from bernd@@.

ok landry
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.9 2010/02/03 12:59:24 jasper Exp $
d10 1
d32 1
d36 2
a37 1
BUILD_DEPENDS =	::devel/apache-ant
d84 2
a85 1
	${SET_ENV} ${MAKE_ENV} ${PREFIX}/jruby/bin/jruby -S gem install \
@


1.9
log
@face reality, it's i386 only and the build is badly broken on anything else

agreed by sthen@@ and bernd@@
@
text
@d1 1
a1 3
# $OpenBSD: Makefile,v 1.8 2009/08/09 11:18:59 bernd Exp $

ONLY_FOR_ARCHS = i386
d7 1
a7 1
V =		1.3.1
d11 3
d17 1
a17 1
MAINTAINER =	Bernd Ahlers <bernd@@openbsd.org>
d19 1
a19 1
# CPL/GPL/LGPL
d25 2
a26 1
MASTER_SITES =	http://dist.codehaus.org/jruby/${V}/
d38 1
a38 1
MAKE_ENV =	JAVA_HOME=${JAVA_HOME} ANT_OPTS="-Xmx64m -XX:MaxPermSize=64m"
d42 5
a46 5
SUBST_VARS =	JRUBY_HOME

# disable regress tests for now. i have to figure out how to run them
# properly
NO_REGRESS =	Yes
d49 1
a49 3
	@@cd ${WRKSRC}/lib/native && ls -1 | fgrep -v openbsd | xargs -r rm -rf
	@@cd ${WRKSRC}/lib/ruby/1.8/ffi/platform && \
		ls -1 | fgrep -v openbsd | xargs -r rm -rf
d52 8
a59 2
	@@cd ${WRKSRC} && ${SETENV} ${MAKE_ENV} ${LOCALBASE}/bin/ant
	@@cd ${WRKSRC}/tool/nailgun && ${SETENV} ${MAKE_ENV} ${MAKE_PROGRAM}
d63 3
d70 6
a75 10
	${INSTALL_SCRIPT} ${WRKBUILD}/bin/autospec ${JRUBY_HOME}/bin/jautospec
	${INSTALL_SCRIPT} ${WRKBUILD}/bin/jgem ${JRUBY_HOME}/bin
	${INSTALL_SCRIPT} ${WRKBUILD}/bin/jirb ${JRUBY_HOME}/bin
	${INSTALL_SCRIPT} ${WRKBUILD}/bin/jirb_swing ${JRUBY_HOME}/bin
	${INSTALL_SCRIPT} ${WRKBUILD}/bin/jruby ${JRUBY_HOME}/bin
	${INSTALL_SCRIPT} ${WRKBUILD}/bin/jrubyc ${JRUBY_HOME}/bin
	${INSTALL_SCRIPT} ${WRKBUILD}/bin/rake ${JRUBY_HOME}/bin/jrake
	${INSTALL_SCRIPT} ${WRKBUILD}/bin/rdoc ${JRUBY_HOME}/bin/jrdoc
	${INSTALL_SCRIPT} ${WRKBUILD}/bin/ri ${JRUBY_HOME}/bin/jri
	${INSTALL_SCRIPT} ${WRKBUILD}/bin/spec ${JRUBY_HOME}/bin/jspec
d81 5
d90 4
@


1.8
log
@Major update to jruby-1.3.1.

All JRuby stuff is now living in ${LOCALBASE}/jruby to prevent
problems with rubygem conflicts and to reduce the patches for
the port.
@
text
@d1 3
a3 1
# $OpenBSD: Makefile,v 1.7 2009/04/26 09:38:25 sthen Exp $
@


1.7
log
@pkgname bumps following java.port.mk r1.18, pointed out by espie@@
@
text
@d1 3
a3 1
# $OpenBSD: Makefile,v 1.6 2009/03/11 23:22:49 sthen Exp $
d7 1
a7 2
V =		1.1.3
RUBY_REV =	1.8
d9 1
a9 1
PKGNAME =	jruby-${V}p2
d22 1
a22 1
MASTER_SITES =	http://dist.codehaus.org/jruby/
d25 1
a25 1
MODJAVA_VER =	1.5+
d28 2
d31 2
a32 1
RUN_DEPENDS =	::java/javaPathHelper
d34 2
a35 2
MAKE_ENV =	JAVA_HOME=${JAVA_HOME} 
JRUBY_LIBDIR =	${PREFIX}/lib/jruby
d38 1
a38 1
SUBST_VARS =	JRUBY_LIBDIR RUBY_REV
d44 4
a47 3
pre-build:
	@@${SUBST_CMD} ${WRKSRC}/src/org/jruby/runtime/load/LoadService.java \
		${WRKSRC}/src/org/jruby/libraries/RbConfigLibrary.java
d51 1
d57 13
a69 10
	${INSTALL_SCRIPT} ${WRKBUILD}/bin/jgem ${PREFIX}/bin
	${INSTALL_SCRIPT} ${WRKBUILD}/bin/jirb ${PREFIX}/bin
	${INSTALL_SCRIPT} ${WRKBUILD}/bin/jirb_swing ${PREFIX}/bin
	${INSTALL_SCRIPT} ${WRKBUILD}/bin/jruby ${PREFIX}/bin
	${INSTALL_SCRIPT} ${WRKBUILD}/bin/jrubyc ${PREFIX}/bin
	${INSTALL_SCRIPT} ${WRKBUILD}/bin/rake ${PREFIX}/bin/jrake
	${INSTALL_SCRIPT} ${WRKBUILD}/bin/rdoc ${PREFIX}/bin/jrdoc
	${INSTALL_SCRIPT} ${WRKBUILD}/bin/ri ${PREFIX}/bin/jri
	${INSTALL_SCRIPT} ${WRKBUILD}/bin/spec ${PREFIX}/bin/jspec
	${INSTALL_DATA_DIR} ${JRUBY_LIBDIR}
d71 7
a77 2
		tar -C ${JRUBY_LIBDIR} -xf -
	chown -R ${SHAREOWN}:${SHAREGRP} ${JRUBY_LIBDIR}
@


1.6
log
@bump pkgname following java dep change
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.5 2008/07/22 07:35:45 bernd Exp $
d8 1
a8 1
PKGNAME =	jruby-${V}p1
@


1.5
log
@Rerolled distfile. Noticed by sturm@@.
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.4 2008/07/21 11:17:33 bernd Exp $
d8 1
a8 1
PKGNAME =	jruby-${V}p0
@


1.4
log
@Update to jruby-1.1.3.

Includes some fixes for problems reported by Yannick Francois
and Jeremy Evans. Thanks guys!
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.3 2008/07/10 23:31:40 bernd Exp $
d8 1
a8 1
PKGNAME =	jruby-${V}
@


1.3
log
@Fix substitution of JRUBY_LIBDIR so jruby works again.

Reported by Jeremy Evans and Yannick Francois. Thank you!
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.2 2008/06/23 20:33:19 bernd Exp $
d5 1
a5 1
V =		1.1.2
d8 1
a8 1
PKGNAME =	jruby-${V}p0
d41 2
a42 1
	@@${SUBST_CMD} ${WRKSRC}/src/org/jruby/runtime/load/LoadService.java
@


1.2
log
@Replace a stupid PATH setting with the correct JAVA_HOME in MAKE_ENV.
This should solve build problems noticed by naddy.

help & ok kurt@@
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.1.1.1 2008/06/17 22:27:41 bernd Exp $
d8 1
a8 1
PKGNAME =	jruby-${V}
d46 1
a46 1
pre-install:
@


1.1
log
@Initial revision
@
text
@d1 1
a1 1
# $OpenBSD$
d30 1
a30 1
MAKE_ENV =	PATH="\$PATH:${JAVA_HOME}/bin"
@


1.1.1.1
log
@Initial import of jruby-1.1.2.

JRuby is an 100% pure-Java implementation of the Ruby programming language.

JRuby is tightly integrated with Java to allow the embedding of the
interpreter into any Java application with full two-way access between the
Java and the Ruby code.

help & testing kurt@@, ian@@ and sturm@@

ok kurt@@
@
text
@@
