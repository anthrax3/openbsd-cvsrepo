head	1.38;
access;
symbols
	OPENBSD_6_1:1.37.0.2
	OPENBSD_6_1_BASE:1.37
	OPENBSD_6_0:1.36.0.2
	OPENBSD_6_0_BASE:1.36
	OPENBSD_5_9:1.34.0.2
	OPENBSD_5_9_BASE:1.34
	OPENBSD_5_8:1.32.0.4
	OPENBSD_5_8_BASE:1.32
	OPENBSD_5_7:1.31.0.2
	OPENBSD_5_7_BASE:1.31
	OPENBSD_5_6:1.30.0.2
	OPENBSD_5_6_BASE:1.30
	OPENBSD_5_5:1.27.0.2
	OPENBSD_5_5_BASE:1.27
	OPENBSD_5_4:1.23.0.2
	OPENBSD_5_4_BASE:1.23
	OPENBSD_5_3:1.20.0.2
	OPENBSD_5_3_BASE:1.20
	OPENBSD_5_2:1.17.0.2
	OPENBSD_5_2_BASE:1.17
	OPENBSD_5_1_BASE:1.15
	OPENBSD_5_1:1.15.0.2
	OPENBSD_5_0:1.13.0.2
	OPENBSD_5_0_BASE:1.13
	OPENBSD_4_9:1.11.0.2
	OPENBSD_4_9_BASE:1.11
	OPENBSD_4_8:1.7.0.2
	OPENBSD_4_8_BASE:1.7
	ports:1.1.1.1
	espie:1.1.1;
locks; strict;
comment	@# @;


1.38
date	2017.04.29.06.22.05;	author espie;	state Exp;
branches;
next	1.37;
commitid	HAqYiJqsrYWmBAC4;

1.37
date	2017.03.04.21.59.55;	author sthen;	state Exp;
branches;
next	1.36;
commitid	nhvOH4eNwFCqyURR;

1.36
date	2016.05.12.01.17.13;	author naddy;	state Exp;
branches;
next	1.35;
commitid	yWplpZyyaU1NC3LP;

1.35
date	2016.03.09.18.48.07;	author naddy;	state Exp;
branches;
next	1.34;
commitid	xvL8UJgkwLsjMIbW;

1.34
date	2015.12.20.00.16.27;	author naddy;	state Exp;
branches;
next	1.33;
commitid	7FwUBfDRx93p0qtP;

1.33
date	2015.12.03.21.24.30;	author sthen;	state Exp;
branches;
next	1.32;
commitid	qh8BBe4z9PLvLPKf;

1.32
date	2015.06.17.20.03.11;	author sthen;	state Exp;
branches;
next	1.31;
commitid	ASHe8W1wzY7eB3KC;

1.31
date	2015.01.02.14.26.12;	author sthen;	state Exp;
branches;
next	1.30;
commitid	opt64GLzbD0TGQDJ;

1.30
date	2014.07.16.09.11.43;	author espie;	state Exp;
branches;
next	1.29;
commitid	kI47fXE5HK4uEJKT;

1.29
date	2014.03.23.17.30.19;	author pascal;	state Exp;
branches;
next	1.28;

1.28
date	2014.03.19.13.53.29;	author jasper;	state Exp;
branches;
next	1.27;

1.27
date	2014.01.12.22.16.02;	author pascal;	state Exp;
branches;
next	1.26;

1.26
date	2014.01.12.14.58.30;	author naddy;	state Exp;
branches;
next	1.25;

1.25
date	2013.12.30.22.02.25;	author pascal;	state Exp;
branches;
next	1.24;

1.24
date	2013.08.09.11.02.28;	author naddy;	state Exp;
branches;
next	1.23;

1.23
date	2013.07.07.21.25.29;	author naddy;	state Exp;
branches;
next	1.22;

1.22
date	2013.03.13.21.23.49;	author miod;	state Exp;
branches;
next	1.21;

1.21
date	2013.03.11.11.20.27;	author espie;	state Exp;
branches;
next	1.20;

1.20
date	2013.02.01.16.34.36;	author naddy;	state Exp;
branches;
next	1.19;

1.19
date	2012.11.13.22.34.04;	author nigel;	state Exp;
branches;
next	1.18;

1.18
date	2012.09.01.00.00.32;	author pascal;	state Exp;
branches;
next	1.17;

1.17
date	2012.06.21.16.17.40;	author naddy;	state Exp;
branches;
next	1.16;

1.16
date	2012.06.21.13.56.57;	author sthen;	state Exp;
branches;
next	1.15;

1.15
date	2012.01.13.00.55.14;	author naddy;	state Exp;
branches;
next	1.14;

1.14
date	2011.11.17.14.29.48;	author sthen;	state Exp;
branches;
next	1.13;

1.13
date	2011.07.18.19.06.36;	author naddy;	state Exp;
branches;
next	1.12;

1.12
date	2011.06.21.20.17.53;	author naddy;	state Exp;
branches;
next	1.11;

1.11
date	2011.01.15.01.09.43;	author naddy;	state Exp;
branches;
next	1.10;

1.10
date	2010.10.19.19.46.12;	author naddy;	state Exp;
branches;
next	1.9;

1.9
date	2010.10.18.19.20.41;	author espie;	state Exp;
branches;
next	1.8;

1.8
date	2010.09.28.09.09.15;	author jasper;	state Exp;
branches;
next	1.7;

1.7
date	2010.08.01.09.26.51;	author espie;	state Exp;
branches;
next	1.6;

1.6
date	2010.08.01.08.45.16;	author eric;	state Exp;
branches;
next	1.5;

1.5
date	2010.07.24.23.05.08;	author naddy;	state Exp;
branches;
next	1.4;

1.4
date	2010.07.08.23.50.39;	author naddy;	state Exp;
branches;
next	1.3;

1.3
date	2010.05.28.21.28.16;	author naddy;	state Exp;
branches;
next	1.2;

1.2
date	2010.05.25.05.04.29;	author ajacoutot;	state Exp;
branches;
next	1.1;

1.1
date	2010.05.24.22.43.57;	author espie;	state Exp;
branches
	1.1.1.1;
next	;

1.1.1.1
date	2010.05.24.22.43.57;	author espie;	state Exp;
branches;
next	;


desc
@@


1.38
log
@get libgcc location in a simpler way that also works with clang.
fixes dependent ports
@
text
@# $OpenBSD: Makefile,v 1.37 2017/03/04 21:59:55 sthen Exp $

V =			3.3.6
PKGNAME =		g77-$V
REVISION =		12
EPOCH =			1
DISTFILES =		g77-openbsd-3.3.6.tgz

CONFIG =		${MACHINE_ARCH}-unknown-openbsd${OSREV}
SUBST_VARS +=		CONFIG V
SYSV =			4.2.1
SYSLIBPATH =		/usr/lib/gcc-lib/${CONFIG}/${SYSV}
LIBDIR =		${PREFIX}/lib/gcc-lib/${CONFIG}/$V

.if ${MACHINE_ARCH} == "m88k"
PKG_ARGS += -DPIC=1
.else
PKG_ARGS += -DPIC=0
.endif

COMMENT =		GNU fortran 77 compiler
CATEGORIES =		lang math
MASTER_SITES =		https://spacehopper.org/mirrors/

PERMIT_PACKAGE_CDROM =	Yes

RUN_DEPENDS =		devel/libf2c
TEST_DEPENDS =		devel/dejagnu \
			devel/libf2c

WRKDIST =		${WRKDIR}/g77
CONFIGURE_SCRIPT =	${WRKDIST}/gcc/configure

SEPARATE_BUILD =	Yes
LIBIBERTY_INCLUDES =	${WRKDIST}/libiberty/include

GNUCFLAGS =		${CFLAGS} ${COPTS} -DOPENBSD_NATIVE \
			-I${LIBIBERTY_INCLUDES}

CONFIGURE_STYLE =	gnu

MAKE_FLAGS =		CFLAGS="${GNUCFLAGS}" \
			CC="${CC}" LDFLAGS="${LDSTATIC}" \
			DEMANGLER_PROG= \
			DEMANGLE_H= \
			LIBIBERTY_INCLUDES=${LIBIBERTY_INCLUDES} \
			LIBGCC2_INCLUDES=-I${LIBIBERTY_INCLUDES} \
			BUILD_LIBIBERTY=-liberty \
			LIBIBERTY=-liberty \
			HOST_LIBDEPS= \
			LIBDEPS= \
			build_infodir=. \
			INSTALL_LIBGCC= LIBGCC= \
			COMPILERS=f771 \
			USE_COLLECT2= \
			LANGUAGES=f77

CONFIGURE_ENV = INSTALL_PROGRAM="${INSTALL} ${INSTALL_COPY} ${INSTALL_STRIP}" \
			CPPFLAGS=-I${LIBIBERTY_INCLUDES}

CONFIGURE_ARGS =	--with-gnu-as --with-gnu-ld \
			--with-local-prefix=${PREFIX} ${CF} \
			--with-gxx-include-dir=dummy \
			-enable-languages='f77' \
			--disable-cpp --disable-nls \
			--enable-__cxa_atexit \

ALL_TARGET =		all doc
INSTALL_TARGET =	install-common f77.install-info f77.install-normal

post-install:
	ln -sf ${SYSLIBPATH}/libgcc.a ${LIBDIR}/libgcc.a
.if ${MACHINE_ARCH} == "m88k"
	mkdir ${LIBDIR}/fpic
	ln -sf ${SYSLIBPATH}/fpic/libgcc.a ${LIBDIR}/fpic/libgcc.a
	mkdir ${LIBDIR}/fPIC
	ln -sf ${SYSLIBPATH}/fPIC/libgcc.a ${LIBDIR}/fPIC/libgcc.a
.endif
	ln -s ${SYSLIBPATH}/cc1 ${LIBDIR}/cc1
	${INSTALL_MAN} ${WRKBUILD}/f/g77.1 ${PREFIX}/man/man1/g77.1
	cd ${PREFIX}/man/man1 && ln -f g77.1 f77.1
	cd ${PREFIX}/bin && ln -f g77 f77

WANTLIB =		c iberty

pre-test:
	ln -sf ${SYSLIBPATH}/libgcc.a ${WRKBUILD}/libgcc.a
	ln -s ${SYSLIBPATH}/cc1 ${WRKBUILD}/cc1

.include <bsd.port.mk>
@


1.37
log
@bump ports with openbsd version number in filenames
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.36 2016/05/12 01:17:13 naddy Exp $
d12 1
a12 1
SYSLIBPATH =		 `cc -v 2>&1| sed -n -e '/gcc-lib/s%^[^/]*\(/.*\)/[^/]*%\1%p'`
@


1.36
log
@bump for plist changes 5.9 -> 6.0
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.35 2016/03/09 18:48:07 naddy Exp $
d5 1
a5 1
REVISION =		11
@


1.35
log
@m68k is long dead
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.34 2015/12/20 00:16:27 naddy Exp $
d5 1
a5 1
REVISION =		10
@


1.34
log
@bump for plist changes 5.8 -> 5.9
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.33 2015/12/03 21:24:30 sthen Exp $
d73 1
a73 1
.if ${MACHINE_ARCH} == "m68k" || ${MACHINE_ARCH} == "m88k"
@


1.33
log
@switch my distfiles mirror to https
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.32 2015/06/17 20:03:11 sthen Exp $
d5 1
a5 1
REVISION =		9
@


1.32
log
@port REVISION bumps as base has moved to 5.8
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.31 2015/01/02 14:26:12 sthen Exp $
d23 1
a23 1
MASTER_SITES =		http://spacehopper.org/mirrors/
@


1.31
log
@bump REVISION for 5.7
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.30 2014/07/16 09:11:43 espie Exp $
d5 1
a5 1
REVISION =		8
d7 1
a7 1
DISTFILES = 		g77-openbsd-3.3.6.tgz
d9 2
a10 2
CONFIG = 		${MACHINE_ARCH}-unknown-openbsd${OSREV}
SUBST_VARS += 		CONFIG V
d25 1
a25 1
PERMIT_PACKAGE_CDROM = 	Yes
d34 1
a34 1
SEPARATE_BUILD = 	Yes
d40 1
a40 1
CONFIGURE_STYLE = 	gnu
d42 1
a42 1
MAKE_FLAGS = 		CFLAGS="${GNUCFLAGS}" \
d61 1
a61 1
CONFIGURE_ARGS = 	--with-gnu-as --with-gnu-ld \
d68 2
a69 2
ALL_TARGET = 		all doc
INSTALL_TARGET = 	install-common f77.install-info f77.install-normal
@


1.30
log
@bump for 5.6beta
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.29 2014/03/23 17:30:19 pascal Exp $
d5 1
a5 1
REVISION =		7
@


1.29
log
@Switch GCC in ports to PIE by default on powerpc.
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.28 2014/03/19 13:53:29 jasper Exp $
d5 1
a5 1
REVISION =		6
@


1.28
log
@more assorted m68k related cleanups
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.27 2014/01/12 22:16:02 pascal Exp $
d5 1
a5 1
REVISION =		5
@


1.27
log
@Switch ports gcc to PIE on i386.

ok sthen@@
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.26 2014/01/12 14:58:30 naddy Exp $
d15 1
a15 1
.if ${MACHINE_ARCH} == "m68k" || ${MACHINE_ARCH} == "m88k"
@


1.26
log
@bump for plist changes 5.4 -> 5.5
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.25 2013/12/30 22:02:25 pascal Exp $
d5 1
a5 1
REVISION =		4
@


1.25
log
@Use __guard_local instead of __guard; fixes math/octave build after __guard
removal.

ok matthew@@ brad@@
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.24 2013/08/09 11:02:28 naddy Exp $
d5 1
a5 1
REVISION =		3
@


1.24
log
@remove last mentions of GCC2_ARCHS variable
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.23 2013/07/07 21:25:29 naddy Exp $
d5 1
a5 1
REVISION =		2
@


1.23
log
@bump for plist changes 5.3 -> 5.4
@
text
@d1 1
a1 3
# $OpenBSD: Makefile,v 1.22 2013/03/13 21:23:49 miod Exp $

NOT_FOR_ARCHS =		${GCC2_ARCHS}
d28 1
a28 1
TEST_DEPENDS =	devel/dejagnu \
@


1.22
log
@Update g77 to the in-tree 3.3.6 codebase, bringing support for m68k and m88k.
All previous patches have also been applied, and a new distribution tarball
has been created.
ok sthen@@; help naddy@@ espie@@
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.21 2013/03/11 11:20:27 espie Exp $
d7 1
a7 1
REVISION =		1
@


1.21
log
@PERMIT_* / REGRESS->TEST sweep
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.20 2013/02/01 16:34:36 naddy Exp $
d5 1
a5 1
V =			3.3.5
d7 3
a9 3
REVISION =		7
EPOCH =			0
DISTFILES = 		g77-openbsd.tgz
d15 7
a41 1
VAXHOST_CFLAGS =	-DIN_GCC -DOPENBSD_NATIVE -DHAVE_CONFIG_H -O0
a59 4
.if ${MACHINE_ARCH} == "vax"
MAKE_FLAGS +=		HOST_CFLAGS="${VAXHOST_CFLAGS}"
.endif

d74 8
a81 2
	ln -sf ${SYSLIBPATH}/libgcc.a ${PREFIX}/lib/gcc-lib/${CONFIG}/$V/libgcc.a
	ln -s ${SYSLIBPATH}/cc1 ${PREFIX}/lib/gcc-lib/${CONFIG}/$V/cc1
@


1.20
log
@bump for plist changes 5.2 -> 5.3
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.19 2012/11/13 22:34:04 nigel Exp $
a19 1
PERMIT_DISTFILES_CDROM = Yes
a20 2
PERMIT_DISTFILES_FTP =	Yes
PERMIT_PACKAGE_FTP =	Yes
d23 1
a23 1
REGRESS_DEPENDS =	devel/dejagnu \
d80 1
a80 1
pre-regress:
@


1.19
log
@Add runtime and regress dependencies, fix being able to run regression
tests. As per sthen@@ comments mip64el left out, and NOT-ARCH left.

Ok sthen@@
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.18 2012/09/01 00:00:32 pascal Exp $
d7 1
a7 1
REVISION =		6
@


1.18
log
@Patch GCC and derived ports to use PIE by default on the same architectures it
is enabled on in base; except for gcc 3.3, which does not have PIE support and
therefore needs to pass -nopie to the linker.

Also, sync powerpc pthread specs with base.  From Brad.

ok naddy@@
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.17 2012/06/21 16:17:40 naddy Exp $
d7 1
a7 1
REVISION =		5
d14 1
d25 4
d75 2
a76 2
	ln -sf /usr/lib/gcc-lib/${CONFIG}/${SYSV}/libgcc.a ${PREFIX}/lib/gcc-lib/${CONFIG}/$V/libgcc.a
	ln -s /usr/lib/gcc-lib/${CONFIG}/${SYSV}/cc1 ${PREFIX}/lib/gcc-lib/${CONFIG}/$V/cc1
d82 4
@


1.17
log
@GCC3 is gone, we don't need to deal with it any longer; ok sthen@@
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.16 2012/06/21 13:56:57 sthen Exp $
d7 1
a7 1
REVISION =		4
@


1.16
log
@bump for plist changes 5.1 -> 5.2
@
text
@d1 1
a1 8
# $OpenBSD: Makefile,v 1.15 2012/01/13 00:55:14 naddy Exp $

.include <bsd.own.mk>
.  if ${COMPILER_VERSION:L:Mgcc4*}
SYSV=			4.2.1
.  else
SYSV=			3.3.5
.  endif
d13 1
a24 3
.if ${COMPILER_VERSION:L:Mgcc4*}
PATCH_LIST=		gcc4-* patch-*
.endif
@


1.15
log
@bump revision for plist changes 5.0 -> 5.1
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.14 2011/11/17 14:29:48 sthen Exp $
d14 1
a14 1
REVISION =		3
@


1.14
log
@NOT_FOR_ARCHS, from viq
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.13 2011/07/18 19:06:36 naddy Exp $
d14 1
a14 1
REVISION =		2
@


1.13
log
@bump revision for plist changes 4.9 -> 5.0
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.12 2011/06/21 20:17:53 naddy Exp $
d10 1
a10 1
NOT_FOR_ARCHES =	${GCC2_ARCHS}
@


1.12
log
@simply install the source man page
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.11 2011/01/15 01:09:43 naddy Exp $
d14 1
a14 1
REVISION =		1
@


1.11
log
@bump revision for plist changes 4.8 -> 4.9
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.10 2010/10/19 19:46:12 naddy Exp $
d81 2
a82 2
	mandoc ${WRKBUILD}/f/g77.1 >${PREFIX}/man/cat1/g77.0
	cd ${PREFIX}/man/cat1 && ln -f g77.0 f77.0
@


1.10
log
@no need for groff, we explicitly use mandoc
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.9 2010/10/18 19:20:41 espie Exp $
d14 1
a14 1
REVISION =		0
@


1.9
log
@USE_GROFF=Yes
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.8 2010/09/28 09:09:15 jasper Exp $
a34 1
USE_GROFF =	Yes
@


1.8
log
@- bump after gcc4 switch of mips64
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.7 2010/08/01 09:26:51 espie Exp $
d35 1
@


1.7
log
@change epoch, so that it "updates" g77 from 3.3.6.
weird, but will avoid conflicts with libf2c ;(
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.6 2010/08/01 08:45:16 eric Exp $
d14 1
@


1.6
log
@crtsavres fix taken from src.
fixes py-numpy on macppc

ok ajacoutot@@
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.5 2010/07/24 23:05:08 naddy Exp $
d14 1
a14 1
REVISION =		4
@


1.5
log
@bump PKGNAME for PLIST changes 4.7 -> 4.8
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.4 2010/07/08 23:50:39 naddy Exp $
d14 1
a14 1
REVISION =		3
@


1.4
log
@bump after gcc3->gcc4 switch on several archs
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.3 2010/05/28 21:28:16 naddy Exp $
d13 2
a14 1
PKGNAME =		g77-$Vp2
@


1.3
log
@make sure __GNUC__ etc are defined on gcc3 platforms; from espie@@
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.2 2010/05/25 05:04:29 ajacoutot Exp $
d13 1
a13 1
PKGNAME =		g77-$Vp1
@


1.2
log
@full-stop.
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.1.1.1 2010/05/24 22:43:57 espie Exp $
d13 1
a13 1
PKGNAME =		g77-$Vp0
d29 3
@


1.1
log
@Initial revision
@
text
@d1 1
a1 1
# $OpenBSD$
d13 1
a13 1
PKGNAME =		g77-$V
@


1.1.1.1
log
@g77 port, from gcc 3.3.5
@
text
@@
