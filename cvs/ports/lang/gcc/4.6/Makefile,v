head	1.94;
access;
symbols
	OPENBSD_6_1:1.94.0.2
	OPENBSD_6_1_BASE:1.94
	OPENBSD_6_0:1.90.0.2
	OPENBSD_6_0_BASE:1.90
	OPENBSD_5_9:1.84.0.2
	OPENBSD_5_9_BASE:1.84
	OPENBSD_5_8:1.82.0.4
	OPENBSD_5_8_BASE:1.82
	OPENBSD_5_7:1.78.0.2
	OPENBSD_5_7_BASE:1.78
	OPENBSD_5_6:1.76.0.2
	OPENBSD_5_6_BASE:1.76
	OPENBSD_5_5:1.70.0.2
	OPENBSD_5_5_BASE:1.70
	OPENBSD_5_4:1.58.0.2
	OPENBSD_5_4_BASE:1.58
	OPENBSD_5_3:1.49.0.2
	OPENBSD_5_3_BASE:1.49
	OPENBSD_5_2:1.28.0.2
	OPENBSD_5_2_BASE:1.28
	OPENBSD_5_1_BASE:1.15
	OPENBSD_5_1:1.15.0.2
	pascal_20111114:1.1.1.1
	pascal:1.1.1;
locks; strict;
comment	@# @;


1.94
date	2017.03.04.21.59.55;	author sthen;	state Exp;
branches;
next	1.93;
commitid	nhvOH4eNwFCqyURR;

1.93
date	2016.09.02.12.14.06;	author dcoppa;	state Exp;
branches;
next	1.92;
commitid	p2ej0pFerZ10XmZo;

1.92
date	2016.09.01.11.01.32;	author jasper;	state Exp;
branches;
next	1.91;
commitid	sEY0fCnB5Wk8Us9R;

1.91
date	2016.08.21.21.01.03;	author sthen;	state Exp;
branches;
next	1.90;
commitid	DZnFZTtuuha8M9S2;

1.90
date	2016.07.14.07.20.28;	author tobiasu;	state Exp;
branches;
next	1.89;
commitid	rHGJ3UlIIyhoQ2M6;

1.89
date	2016.06.29.16.14.41;	author espie;	state Exp;
branches;
next	1.88;
commitid	c1yQMbJbfo0CFBcL;

1.88
date	2016.06.08.17.04.56;	author jca;	state Exp;
branches;
next	1.87;
commitid	AZpYuq9w0tlSgVU2;

1.87
date	2016.06.08.17.04.03;	author jca;	state Exp;
branches;
next	1.86;
commitid	0VV3ukjfhlR3Djkj;

1.86
date	2016.05.12.01.17.13;	author naddy;	state Exp;
branches;
next	1.85;
commitid	yWplpZyyaU1NC3LP;

1.85
date	2016.03.11.19.59.15;	author naddy;	state Exp;
branches;
next	1.84;
commitid	pguKLBEFv33DrgKU;

1.84
date	2015.12.20.00.16.27;	author naddy;	state Exp;
branches;
next	1.83;
commitid	7FwUBfDRx93p0qtP;

1.83
date	2015.12.03.21.24.30;	author sthen;	state Exp;
branches;
next	1.82;
commitid	qh8BBe4z9PLvLPKf;

1.82
date	2015.07.02.00.22.18;	author zhuk;	state Exp;
branches;
next	1.81;
commitid	kQjpoPVPrWhnKgK3;

1.81
date	2015.06.17.20.03.11;	author sthen;	state Exp;
branches;
next	1.80;
commitid	ASHe8W1wzY7eB3KC;

1.80
date	2015.05.22.11.31.16;	author ajacoutot;	state Exp;
branches;
next	1.79;
commitid	2khjHXfpTaOuNVcx;

1.79
date	2015.03.19.20.23.57;	author naddy;	state Exp;
branches;
next	1.78;
commitid	K8U7RlU9EGrqxYJY;

1.78
date	2015.02.12.16.15.28;	author brad;	state Exp;
branches;
next	1.77;
commitid	ZQ0gbBn3VOFlQc9I;

1.77
date	2015.01.02.14.26.12;	author sthen;	state Exp;
branches;
next	1.76;
commitid	opt64GLzbD0TGQDJ;

1.76
date	2014.07.16.14.35.38;	author naddy;	state Exp;
branches;
next	1.75;
commitid	ggJpOpSoHu6RJsj1;

1.75
date	2014.05.01.23.08.26;	author tobiasu;	state Exp;
branches;
next	1.74;

1.74
date	2014.04.27.21.50.55;	author tobiasu;	state Exp;
branches;
next	1.73;

1.73
date	2014.04.23.11.34.49;	author pascal;	state Exp;
branches;
next	1.72;

1.72
date	2014.03.10.21.33.17;	author espie;	state Exp;
branches;
next	1.71;

1.71
date	2014.03.10.21.11.49;	author landry;	state Exp;
branches;
next	1.70;

1.70
date	2014.02.07.01.27.21;	author tobiasu;	state Exp;
branches;
next	1.69;

1.69
date	2014.01.15.20.16.03;	author brad;	state Exp;
branches;
next	1.68;

1.68
date	2014.01.12.22.16.02;	author pascal;	state Exp;
branches;
next	1.67;

1.67
date	2014.01.12.14.58.30;	author naddy;	state Exp;
branches;
next	1.66;

1.66
date	2013.11.25.14.16.23;	author sthen;	state Exp;
branches;
next	1.65;

1.65
date	2013.11.22.19.58.40;	author brad;	state Exp;
branches;
next	1.64;

1.64
date	2013.09.19.21.14.56;	author tobiasu;	state Exp;
branches;
next	1.63;

1.63
date	2013.09.16.21.16.17;	author sthen;	state Exp;
branches;
next	1.62;

1.62
date	2013.09.16.10.55.00;	author espie;	state Exp;
branches;
next	1.61;

1.61
date	2013.09.16.10.28.15;	author espie;	state Exp;
branches;
next	1.60;

1.60
date	2013.08.16.07.37.18;	author tobiasu;	state Exp;
branches;
next	1.59;

1.59
date	2013.08.14.07.56.25;	author sthen;	state Exp;
branches;
next	1.58;

1.58
date	2013.07.18.16.54.08;	author tobiasu;	state Exp;
branches;
next	1.57;

1.57
date	2013.07.07.21.25.29;	author naddy;	state Exp;
branches;
next	1.56;

1.56
date	2013.06.18.20.24.29;	author sthen;	state Exp;
branches;
next	1.55;

1.55
date	2013.06.13.06.44.08;	author landry;	state Exp;
branches;
next	1.54;

1.54
date	2013.06.07.07.54.23;	author pascal;	state Exp;
branches;
next	1.53;

1.53
date	2013.05.18.19.45.11;	author pascal;	state Exp;
branches;
next	1.52;

1.52
date	2013.05.03.23.13.49;	author tobiasu;	state Exp;
branches;
next	1.51;

1.51
date	2013.03.21.08.46.32;	author ajacoutot;	state Exp;
branches;
next	1.50;

1.50
date	2013.03.11.11.20.27;	author espie;	state Exp;
branches;
next	1.49;

1.49
date	2013.02.04.11.37.09;	author pascal;	state Exp;
branches;
next	1.48;

1.48
date	2013.02.01.16.34.36;	author naddy;	state Exp;
branches;
next	1.47;

1.47
date	2013.01.28.01.03.05;	author tobiasu;	state Exp;
branches;
next	1.46;

1.46
date	2013.01.23.18.26.55;	author pascal;	state Exp;
branches;
next	1.45;

1.45
date	2013.01.20.02.23.40;	author tobiasu;	state Exp;
branches;
next	1.44;

1.44
date	2013.01.18.19.09.58;	author bcallah;	state Exp;
branches;
next	1.43;

1.43
date	2013.01.16.19.28.48;	author pascal;	state Exp;
branches;
next	1.42;

1.42
date	2012.12.28.14.32.01;	author espie;	state Exp;
branches;
next	1.41;

1.41
date	2012.12.26.16.15.19;	author naddy;	state Exp;
branches;
next	1.40;

1.40
date	2012.11.06.00.57.43;	author tobiasu;	state Exp;
branches;
next	1.39;

1.39
date	2012.10.17.19.58.21;	author kurt;	state Exp;
branches;
next	1.38;

1.38
date	2012.10.07.20.09.44;	author landry;	state Exp;
branches;
next	1.37;

1.37
date	2012.09.28.15.02.29;	author pascal;	state Exp;
branches;
next	1.36;

1.36
date	2012.09.26.17.36.46;	author naddy;	state Exp;
branches;
next	1.35;

1.35
date	2012.09.03.13.24.58;	author pascal;	state Exp;
branches;
next	1.34;

1.34
date	2012.09.01.00.00.32;	author pascal;	state Exp;
branches;
next	1.33;

1.33
date	2012.08.29.20.53.32;	author sthen;	state Exp;
branches;
next	1.32;

1.32
date	2012.08.28.23.39.12;	author sthen;	state Exp;
branches;
next	1.31;

1.31
date	2012.08.25.18.22.54;	author pascal;	state Exp;
branches;
next	1.30;

1.30
date	2012.08.23.19.19.16;	author sthen;	state Exp;
branches;
next	1.29;

1.29
date	2012.08.20.12.35.41;	author pascal;	state Exp;
branches;
next	1.28;

1.28
date	2012.07.01.18.28.40;	author pascal;	state Exp;
branches;
next	1.27;

1.27
date	2012.06.21.13.56.57;	author sthen;	state Exp;
branches;
next	1.26;

1.26
date	2012.05.14.23.39.39;	author pascal;	state Exp;
branches;
next	1.25;

1.25
date	2012.05.07.10.34.33;	author pascal;	state Exp;
branches;
next	1.24;

1.24
date	2012.05.04.08.47.55;	author pascal;	state Exp;
branches;
next	1.23;

1.23
date	2012.04.23.14.16.34;	author pascal;	state Exp;
branches;
next	1.22;

1.22
date	2012.04.09.11.55.53;	author pascal;	state Exp;
branches;
next	1.21;

1.21
date	2012.04.02.15.28.04;	author pascal;	state Exp;
branches;
next	1.20;

1.20
date	2012.04.02.08.51.30;	author pascal;	state Exp;
branches;
next	1.19;

1.19
date	2012.03.31.20.02.03;	author pascal;	state Exp;
branches;
next	1.18;

1.18
date	2012.03.07.20.39.37;	author kurt;	state Exp;
branches;
next	1.17;

1.17
date	2012.02.28.20.00.16;	author pascal;	state Exp;
branches;
next	1.16;

1.16
date	2012.02.16.21.30.15;	author pascal;	state Exp;
branches;
next	1.15;

1.15
date	2012.02.03.17.01.17;	author landry;	state Exp;
branches;
next	1.14;

1.14
date	2012.01.26.13.17.22;	author pascal;	state Exp;
branches;
next	1.13;

1.13
date	2012.01.24.19.19.27;	author espie;	state Exp;
branches;
next	1.12;

1.12
date	2012.01.23.17.04.10;	author espie;	state Exp;
branches;
next	1.11;

1.11
date	2012.01.23.15.34.01;	author espie;	state Exp;
branches;
next	1.10;

1.10
date	2011.12.11.21.11.37;	author pascal;	state Exp;
branches;
next	1.9;

1.9
date	2011.12.08.17.40.55;	author pascal;	state Exp;
branches;
next	1.8;

1.8
date	2011.11.23.20.55.11;	author pascal;	state Exp;
branches;
next	1.7;

1.7
date	2011.11.19.22.19.53;	author pascal;	state Exp;
branches;
next	1.6;

1.6
date	2011.11.15.15.48.13;	author pascal;	state Exp;
branches;
next	1.5;

1.5
date	2011.11.15.00.42.52;	author pascal;	state Exp;
branches;
next	1.4;

1.4
date	2011.11.14.22.55.10;	author pascal;	state Exp;
branches;
next	1.3;

1.3
date	2011.11.14.17.34.35;	author pascal;	state Exp;
branches;
next	1.2;

1.2
date	2011.11.14.13.41.16;	author sthen;	state Exp;
branches;
next	1.1;

1.1
date	2011.11.14.13.00.55;	author pascal;	state Exp;
branches
	1.1.1.1;
next	;

1.1.1.1
date	2011.11.14.13.00.55;	author pascal;	state Exp;
branches;
next	;


desc
@@


1.94
log
@bump ports with openbsd version number in filenames
@
text
@# $OpenBSD: Makefile,v 1.93 2016/09/02 12:14:06 dcoppa Exp $

#ONLY_FOR_ARCHS = alpha amd64 hppa i386 powerpc sparc64
# ignore arches that have a more recent gcc port
ONLY_FOR_ARCHS = alpha
DPB_PROPERTIES = parallel

V = 4.6.4
FULL_VERSION = $V
FULL_PKGVERSION = $V

ADASTRAP_LIBC-i386 = 73.0
ADASTRAP-i386 = adastrap-i386-$V-4.tar.xz
ADASTRAP_LIBC-amd64 = 73.0
ADASTRAP-amd64 = adastrap-amd64-$V-4.tar.xz
ADASTRAP_LIBC-sparc64 = 73.0
ADASTRAP-sparc64 = adastrap-sparc64-$V-4.tar.xz
ADASTRAP_LIBC-hppa = 74.1
ADASTRAP-hppa = adastrap-hppa-$V-4.tar.xz
ADASTRAP_LIBC-alpha = 74.0
ADASTRAP-alpha = adastrap-alpha-$V-4.tar.xz

PKGNAME-main =  gcc-${FULL_PKGVERSION}
PKGNAME-c++ =   g++-${FULL_PKGVERSION}
PKGNAME-estdc = libstdc++-${FULL_PKGVERSION}
PKGNAME-f95 =   g95-${FULL_PKGVERSION}
PKGNAME-java =  gcj-${FULL_PKGVERSION}
PKGNAME-objc =  gobjc-${FULL_PKGVERSION}
PKGNAME-ada =   gnat-${FULL_PKGVERSION}
PKGNAME-go =	gccgo-${FULL_PKGVERSION}
PKGSPEC-main = gcc->=4.6,<4.7

REVISION = 21

SHARED_LIBS =	estdc++		14.0 \
		gfortran	3.0 \
		gcj		1.0 \
		gcj-tools	1.0 \
		gij		1.0 \
		objc		3.0 \
		ssp		1.0 \
		lto_plugin      0.0 \
		go		0.0


PSEUDO_FLAVORS = no_c++ no_f95 no_objc no_java no_ada no_go full
FLAVOR ?= 

ONLY_FOR_ARCHS-ada = i386 amd64 sparc64 hppa alpha
ONLY_FOR_ARCHS-java = amd64 i386 sparc64
NOT_FOR_ARCHS-go = alpha hppa mips64el

MULTI_PACKAGES = -main -f95 -objc -java -c++ -estdc -ada -go

.include <bsd.port.arch.mk>

# kill both C++ subpackages
.if !${BUILD_PACKAGES:M-c++}
BUILD_PACKAGES := ${BUILD_PACKAGES:N-estdc}
.endif

DISTNAME =   	gcc-${FULL_VERSION}
DISTFILES =	${DISTNAME}.tar.bz2
# there's no ecj-4.6.jar
ECJ =		ecj-4.5.jar
SUPDISTFILES =	${ADASTRAP-i386}:0 ${ADASTRAP-amd64}:0 ${ADASTRAP-sparc64}:0 \
		${ADASTRAP-hppa}:0 ${ADASTRAP-alpha}:0 ${ECJ}:1
EXTRACT_ONLY =	${DISTNAME}.tar.bz2


BUILD_DEPENDS +=	devel/bison \
			devel/libexecinfo

TEST_DEPENDS = 	devel/dejagnu \
			devel/autogen

MASTER_SITES =	${MASTER_SITE_GCC:=releases/gcc-$(FULL_VERSION)/}
MASTER_SITES0 =	https://spacehopper.org/mirrors/ http://distfiles.tmux.org/adastrap/
MASTER_SITES1 =	ftp://sources.redhat.com/pub/java/

LANGS = c
.if ${BUILD_PACKAGES:M-c++}
LANGS := ${LANGS},c++
TEST_DEPENDS += 	${BUILD_PKGPATH},-estdc>=4.6,<4.7
.endif
.if ${BUILD_PACKAGES:M-f95}
LANGS := ${LANGS},fortran
.endif
.if ${BUILD_PACKAGES:M-objc}
LANGS := ${LANGS},objc
.endif
.if ${BUILD_PACKAGES:M-java}
LANGS := ${LANGS},java
DISTFILES +=		${ECJ}:1
BUILD_DEPENDS +=	archivers/zip>=2.3p0
CONFIGURE_ARGS +=	--enable-libgcj --without-jar
.endif
.if ${BUILD_PACKAGES:M-ada}
LANGS := ${LANGS},ada
DISTFILES += ${ADASTRAP-${MACHINE_ARCH}}:0
EXTRACT_ONLY += ${ADASTRAP-${MACHINE_ARCH}}
EXTRA_ENV += ADAC=${WRKDIR}/bin/egcc GNATBIND=${WRKDIR}/bin/gnatbind

. if ${MACHINE_ARCH} == "alpha"
# ICE in combine.c on alpha at -O2
EXTRA_ENV += ADA_CFLAGS="-O1"
. endif

CC = ${WRKDIR}/bin/egcc
TEST_DEPENDS += ${BUILD_PKGPATH},-ada
.endif
.if ${BUILD_PACKAGES:M-go}
LANGS := ${LANGS},go
.endif

CONFIGURE_STYLE =		gnu
MODGNU_CONFIG_GUESS_DIRS =	${WRKSRC} ${WRKSRC}/gcc

EXTRA_ENV += am_cv_func_iconv=no JAR=no
EXTRA_ENV += ac_cv_prog_M4=/usr/bin/m4
EXTRA_ENV += ac_cv_header_magic_h=no
EXTRA_ENV += lt_cv_path_SED=/usr/bin/sed
EXTRA_ENV += STRIP=/usr/bin/strip
MAKE_FLAGS +=	 ac_cv_path_mkdir=/bin/mkdir

CONFIGURE_ENV += ${EXTRA_ENV}
MAKE_ENV += ${EXTRA_ENV}

# Note: the configure target passes CFLAGS to the configure script anyways.

CFLAGS = -O2

CONFIGURE_ARGS += \
	--verbose \
	--program-transform-name=s,^,e, \
	--disable-nls  \
	--disable-checking \
	--with-system-zlib \
	--disable-libmudflap \
	--disable-libgomp \
	--disable-tls \
	--with-gnu-ld \
	--with-gnu-as \
	--enable-threads=posix \
	--enable-wchar_t \
	--with-gmp="${LOCALBASE}" \
	--disable-libstdcxx-pch \
	--enable-languages=${LANGS}

# This is needed, as internal cpp is no longer compatible with the
# visible beast
CONFIGURE_ARGS += --enable-cpp


SEPARATE_BUILD = flavored

USE_GMAKE = yes
MAKE_FLAGS += --print-directory

.if ${FLAVOR:Mfull}
# you shouldn't skip bootstrap unless you know what you're doing
# use bootstrap-lean if you're pressed for space
ALL_TARGET = bootstrap
.else
# skip the stage2/stage3 bullshit under normal circumstances
ALL_TARGET = bootstrap2
.endif

MAKE_FLAGS += libstdc___la_LDFLAGS='-version-info 31:0:0 -lm'

.if ${MACHINE_ARCH} == "amd64"
PIC = 1
PKG_ARGS += -DPIC=1
.else
PIC = 0
PKG_ARGS += -DPIC=0
.endif

.if ${MACHINE_ARCH} == "powerpc"
PKG_ARGS += -DPPC=1
.else
PKG_ARGS += -DPPC=0
.endif

.if ${MACHINE_ARCH} == "i386" || ${MACHINE_ARCH} == "amd64"
PKG_ARGS += -DI386=1
.else
PKG_ARGS += -DI386=0
.endif

RUN_DEPENDS =		${BUILD_PKGPATH},-main
WANTLIB =		c gmp m mpc mpfr z

RUN_DEPENDS-main =
RUN_DEPENDS-estdc =

RUN_DEPENDS-c++ =	${RUN_DEPENDS} \
			${BUILD_PKGPATH},-estdc>=4.6,<4.7
RUN_DEPENDS-ada =	${FULLPKGNAME-main}:${BUILD_PKGPATH}
WANTLIB-estdc =		m
WANTLIB-f95 =		${WANTLIB}
WANTLIB-java =		${WANTLIB} pthread
WANTLIB-go =		${WANTLIB} pthread

LIB_DEPENDS +=		devel/gmp>=4.2 \
			devel/mpfr \
			devel/libmpc
LIB_DEPENDS-estdc =

.if ${MACHINE_ARCH:Mamd64}
CONFIG = x86_64-unknown-openbsd${OSREV}
.endif

post-extract:
.for f in egcc gnatbind gnatmake gnatlink
	echo "#! /bin/sh" >${WRKDIR}/bin/$f
	echo 'GNAT_ROOT=${WRKDIR}/bootstrap GCC_ROOT=${WRKDIR}/bootstrap LD_LIBRARY_PATH=${WRKDIR}/bootstrap/system-libs exec ${WRKDIR}/bootstrap/bin/$f "$$@@"' >>${WRKDIR}/bin/$f
	chmod a+x ${WRKDIR}/bin/$f
.endfor
	rm -rf ${WRKDIR}/bootstrap/lib/gcc/*-unknown-openbsd*/$V/include-fixed
	ln -sf /usr/bin/nm ${WRKDIR}/bin/enm
	echo "# This file automatically generated" >> ${WRKSRC}/libversions
.for l v in ${SHARED_LIBS}
	echo "LIB$l_LTVERSION = -version-info ${v:S/./:/}" >> \
		${WRKSRC}/libversions
.endfor
.if ${BUILD_PACKAGES:M-java}
	cp ${FULLDISTDIR}/${ECJ} ${WRKSRC}/ecj.jar
.endif

post-install:
.if ${BUILD_PACKAGES:M-ada}
	chown -R ${SHAREOWN}:${SHAREGRP} ${PREFIX}/lib/gcc/*/$V/adainclude
	chown -R ${SHAREOWN}:${SHAREGRP} ${PREFIX}/lib/gcc/*/$V/adalib
.endif
.if ${BUILD_PACKAGES:M-f95}
	ln -sf ${TRUEPREFIX}/bin/egfortran ${PREFIX}/bin/gfortran
	ln -sf ${TRUEPREFIX}/bin/${CONFIG}-egfortran ${PREFIX}/bin/${CONFIG}-gfortran
.endif
	chown -R ${SHAREOWN}:${SHAREGRP} ${PREFIX}/lib/gcc/*/$V/include
	chown -R ${SHAREOWN}:${SHAREGRP} ${PREFIX}/lib/gcc/*/$V/include-fixed
	chown ${BINOWN}:${BINGRP} ${PREFIX}/lib/gcc/${CONFIG}/${V}/libgcc.a
	chown ${BINOWN}:${BINGRP} ${PREFIX}/lib/gcc/${CONFIG}/${V}/libgcov.a
.if ${PIC} == "1"
	chown ${BINOWN}:${BINGRP} ${PREFIX}/lib/gcc/${CONFIG}/${V}/fpic/libgcc.a
	chown ${BINOWN}:${BINGRP} \
		${PREFIX}/lib/gcc/${CONFIG}/${V}/fpic/libgcov.a
.endif

.include <bsd.port.mk>

ADA_PACKAGE = ${PACKAGE_REPOSITORY}/${MACHINE_ARCH}/all/${FULLPKGNAME-ada}.tgz
GCC_PACKAGE = ${PACKAGE_REPOSITORY}/${MACHINE_ARCH}/all/${FULLPKGNAME-main}.tgz

adastrap: ${ADA_PACKAGE} ${GCC_PACKAGE}
.if !defined(ADASTRAP_LIBC-${MACHINE_ARCH})
	@@echo 1>&2 "Error: you must specify a libc to bundle"
	@@exit 1
.else
	mkdir -p ${WRKDIR}/prepare/bootstrap/system-libs
	cp /usr/lib/libc.so.${ADASTRAP_LIBC-${MACHINE_ARCH}} \
		${WRKDIR}/prepare/bootstrap/system-libs
	cd ${WRKDIR}/prepare/bootstrap && tar zxf ${ADA_PACKAGE}
	cd ${WRKDIR}/prepare/bootstrap && tar zxf ${GCC_PACKAGE}
	rm -rf ${WRKDIR}/prepare/bootstrap/{+*,info,man}
	rm -rf ${WRKDIR}/prepare/bootstrap/lib/gcc/*-unknown-openbsd*/$V/include-fixed
	if ! ldd ${WRKDIR}/prepare/bootstrap/bin/egcc | \
		fgrep libc.so.${ADASTRAP_LIBC-${MACHINE_ARCH}} >/dev/null; then \
		echo 1>&2 "Error: adastrap egcc linked against wrong libc"; \
		exit 1; \
	fi
	cd ${WRKDIR}/prepare && tar cf - bootstrap | \
		xz > ${FULLDISTDIR}/${ADASTRAP-${MACHINE_ARCH}}
.endif

@


1.93
log
@
Add a "bin/gfortran" symlink pointing to "bin/egfortran"

OK pascal@@ (maintainer)
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.92 2016/09/01 11:01:32 jasper Exp $
d33 1
a33 1
REVISION = 20
@


1.92
log
@more sparc leftovers
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.91 2016/08/21 21:01:03 sthen Exp $
d33 1
a33 1
REVISION = 19
d235 4
@


1.91
log
@Don't hardcode path to "ld" in ports gcc, allowing USE_WXNEEDED to override
"ld" with a wrapper script. Do the same for "as" for consistency as suggested
by naddy. Various versions of this OK'd by dcoppa and pascal.
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.90 2016/07/14 07:20:28 tobiasu Exp $
d171 1
a171 1
.if ${MACHINE_ARCH} == "sparc"  || ${MACHINE_ARCH} == "amd64"
@


1.90
log
@Sync startfile spec, fixes egcc -static to link against rcrt0

ok stefan@@ pascal@@ naddy@@
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.89 2016/06/29 16:14:41 espie Exp $
d33 1
a33 1
REVISION = 18
a141 2
	--with-as=/usr/bin/as \
	--with-ld=/usr/bin/ld \
@


1.89
log
@add is-branch to all trivial ports that exist as multiple branches.
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.88 2016/06/08 17:04:56 jca Exp $
d33 1
a33 3
REVISION = 17
REVISION-java = 18
REVISION-go = 18
@


1.88
log
@Don't hardcode the most recent gcc version
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.87 2016/06/08 17:04:03 jca Exp $
d33 3
a35 3
REVISION = 16
REVISION-java = 17
REVISION-go = 17
@


1.87
log
@Disable libffi W^X violations in gcc-4.6 too, ok sthen@@
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.86 2016/05/12 01:17:13 naddy Exp $
d4 1
a4 1
# ignore arches that have a valid 4.8 port
@


1.86
log
@bump for plist changes 5.9 -> 6.0
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.85 2016/03/11 19:59:15 naddy Exp $
d34 2
@


1.85
log
@garbage collect CONFIGURE_SHARED
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.84 2015/12/20 00:16:27 naddy Exp $
d33 1
a33 1
REVISION = 15
@


1.84
log
@bump for plist changes 5.8 -> 5.9
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.83 2015/12/03 21:24:30 sthen Exp $
a155 1
CONFIGURE_ARGS += ${CONFIGURE_SHARED}
@


1.83
log
@switch my distfiles mirror to https
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.82 2015/07/02 00:22:18 zhuk Exp $
d33 1
a33 1
REVISION = 14
@


1.82
log
@Remove extra @@pkgpath markers. They were relevant for GCC 4.2, which was not
MULTI_PACKAGEd initially, but not for later ones.

Feedback and 4.9 part okay from sthen@@.
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.81 2015/06/17 20:03:11 sthen Exp $
d78 1
a78 1
MASTER_SITES0 =	http://spacehopper.org/mirrors/ http://distfiles.tmux.org/adastrap/
@


1.81
log
@port REVISION bumps as base has moved to 5.8
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.80 2015/05/22 11:31:16 ajacoutot Exp $
d33 1
a33 1
REVISION = 13
@


1.80
log
@"/usr/local/lib/pkgconfig/" is part of mtree(8).
Packages should not own this dir to prevent its deletion or a warning that it
cannot be removed because it's not empty at pkg_delete(1) time.
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.79 2015/03/19 20:23:57 naddy Exp $
d33 1
a33 2
REVISION = 11
REVISION-java = 12
@


1.79
log
@Fold PFRAG.shared into PLIST as was done for gcc 4.8 and 4.9.
This only builds on select archs that have shared libraries anyway.
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.78 2015/02/12 16:15:28 brad Exp $
d34 1
@


1.78
log
@Disable 4.6 on hppa.

ok pascal@@ tobiasu@@
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.77 2015/01/02 14:26:12 sthen Exp $
d33 1
a33 1
REVISION = 10
@


1.77
log
@bump REVISION for 5.7
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.76 2014/07/16 14:35:38 naddy Exp $
d5 1
a5 1
ONLY_FOR_ARCHS = alpha hppa
@


1.76
log
@bump for plist changes 5.5 -> 5.6
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.75 2014/05/01 23:08:26 tobiasu Exp $
d33 1
a33 8
REVISION-main =	9
REVISION-c++ =	6
#REVISION-estdc =
REVISION-f95 =	5
REVISION-java =	5
REVISION-objc =	4
REVISION-ada =	9
REVISION-go =	5
@


1.75
log
@Add gnat for alpha. Because we can.

ok pascal@@
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.74 2014/04/27 21:50:55 tobiasu Exp $
d33 2
a34 2
REVISION-main =	8
REVISION-c++ =	5
d36 5
a40 5
REVISION-f95 =	4
REVISION-java =	4
REVISION-objc =	3
REVISION-ada =	8
REVISION-go =	4
@


1.74
log
@Provide hppa adastrap for GNAT. Hehe...
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.73 2014/04/23 11:34:49 pascal Exp $
d20 2
d33 1
a33 1
REVISION-main =	7
d39 1
a39 1
REVISION-ada =	7
d56 1
a56 1
ONLY_FOR_ARCHS-ada = i386 amd64 sparc64 hppa
d74 1
a74 1
		${ADASTRAP-hppa}:0 ${ECJ}:1
d110 6
@


1.73
log
@Fix after gets() removal (note that this is only built on alpha and hppa).

ok landry@@
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.72 2014/03/10 21:33:17 espie Exp $
d18 2
d54 1
a54 1
ONLY_FOR_ARCHS-ada = i386 amd64 sparc64
d72 1
a72 1
		${ECJ}:1
@


1.72
log
@document what's actually going on
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.71 2014/03/10 21:11:49 landry Exp $
d30 1
a30 1
REVISION-c++ =	4
@


1.71
log
@Only build 4.6 on alpha/hppa. Lots of cpu cycles saved on other archs!
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.70 2014/02/07 01:27:21 tobiasu Exp $
d3 2
@


1.70
log
@Repair time/delay/duration time_t issues in gnat. All direct imports of
C functions have been modified to use same-size types on both sides.
There are no checks in gcc to make sure the types match, and it happily
trashes the stack or reads bogus data without this fix.

The C shim in gnatlib is still casting down to long (by design), thus
gnat is not 2038-proof on 32 bit architectures. Fixing this is an
ongoing project, but I'm running out of time for this release.

Getting the timezone offset is now supported; the unused usleep
procedure that snuck in from FreeBSD support got removed.

Tested on all supported architectures, plus new bootstraps due to the
stack trashing, just in case...

Conceptually fine with brad@@
deraadt@@ is unhappy with the partial solution, fixing this remains a
high priority todo
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.69 2014/01/15 20:16:03 brad Exp $
d3 1
a3 1
ONLY_FOR_ARCHS = alpha amd64 hppa i386 powerpc sparc64
@


1.69
log
@Enable PIE by default on alpha to match the base compiler.

ok pascal@@ sthen@@
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.68 2014/01/12 22:16:02 pascal Exp $
d10 6
a15 6
ADASTRAP_LIBC-i386 = 70.0
ADASTRAP-i386 = adastrap-i386-$V-3.tar.xz
ADASTRAP_LIBC-amd64 = 70.0
ADASTRAP-amd64 = adastrap-amd64-$V-3.tar.xz
ADASTRAP_LIBC-sparc64 = 70.0
ADASTRAP-sparc64 = adastrap-sparc64-$V-3.tar.xz
d33 1
a33 1
REVISION-ada =	6
@


1.68
log
@Switch ports gcc to PIE on i386.

ok sthen@@
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.67 2014/01/12 14:58:30 naddy Exp $
d27 2
a28 2
REVISION-main =	6
REVISION-c++ =	3
d30 5
a34 5
REVISION-f95 =	3
REVISION-java =	3
REVISION-objc =	2
REVISION-ada =	5
REVISION-go =	3
@


1.67
log
@bump for plist changes 5.4 -> 5.5
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.66 2013/11/25 14:16:23 sthen Exp $
d27 2
a28 2
REVISION-main =	5
REVISION-c++ =	2
d30 5
a34 5
REVISION-f95 =	2
REVISION-java =	2
REVISION-objc =	1
REVISION-ada =	4
REVISION-go =	2
@


1.66
log
@kill VMEM_WARNING
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.65 2013/11/22 19:58:40 brad Exp $
d27 2
a28 2
REVISION-main =	4
REVISION-c++ =	1
d30 5
a34 5
REVISION-f95 =	1
REVISION-java =	1
REVISION-objc =	0
REVISION-ada =	3
REVISION-go =	1
@


1.65
log
@As was commited to the base GCC have the compiler use collect2 when
linking instead of calling the linker directly.

ok pascal@@
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.64 2013/09/19 21:14:56 tobiasu Exp $
a97 1
VMEM_WARNING =		Yes
@


1.64
log
@New sparc64 adastrap
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.63 2013/09/16 21:16:17 sthen Exp $
d27 2
a28 2
REVISION-main =	3
REVISION-c++ =	0
d30 2
a31 2
REVISION-f95 =	0
REVISION-java =	0
d33 2
a34 2
REVISION-ada =	2
REVISION-go =	0
@


1.63
log
@new i386 bootstraps
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.62 2013/09/16 10:55:00 espie Exp $
d15 1
a15 1
ADASTRAP-sparc64 = adastrap-sparc64-$V-2.tar.xz
@


1.62
log
@new adastrap for amd64 WITHOUT the fixed-includes

(and moved an rm out of a loop)
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.61 2013/09/16 10:28:15 espie Exp $
d11 1
a11 1
ADASTRAP-i386 = adastrap-i386-$V-2.tar.xz
@


1.61
log
@fix gcc build, make sure it doesn't rely on bootstrapped old
fixed includes
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.60 2013/08/16 07:37:18 tobiasu Exp $
d13 1
a13 1
ADASTRAP-amd64 = adastrap-amd64-$V-2.tar.xz
a216 1
	rm -rf ${WRKDIR}/bootstrap/lib/gcc/*-unknown-openbsd*/$V/include-fixed
d219 1
@


1.60
log
@New adastraps for sparc64.
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.59 2013/08/14 07:56:25 sthen Exp $
d27 1
a27 1
REVISION-main =	2
d33 1
a33 1
REVISION-ada =	1
d217 1
d261 1
@


1.59
log
@new bootstraps for amd64/i386, on a temporary mirror for now.
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.58 2013/07/18 16:54:08 tobiasu Exp $
d14 2
a15 2
ADASTRAP_LIBC-sparc64 = 68.3
ADASTRAP-sparc64 = adastrap-sparc64-$V-1.tar.xz
@


1.58
log
@ * Use SJLJ exections instead of ZCX in the hope of fixing
   intermittent build problems. Exception style affects Ada only.
 * Add better tasking support and sync OpenBSD specific changes from 4.8.
 * Call __errno() from librthread when using pthreads (Tero Koskinen)
 * Enable shared library support for OpenBSD (Tero Koskinen)

bulk tested by landry@@ and sthen@@
ok pascal@@

sorry for the delay guys
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.57 2013/07/07 21:25:29 naddy Exp $
d10 4
a13 4
ADASTRAP_LIBC-i386 = 68.4
ADASTRAP-i386 = adastrap-i386-$V-1.tar.xz
ADASTRAP_LIBC-amd64 = 68.3
ADASTRAP-amd64 = adastrap-amd64-$V-1.tar.xz
d79 1
a79 1
MASTER_SITES0 =	http://distfiles.tmux.org/adastrap/
@


1.57
log
@bump for plist changes 5.3 -> 5.4
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.56 2013/06/18 20:24:29 sthen Exp $
d10 4
a13 4
ADASTRAP_LIBC-i386 = 68.2
ADASTRAP-i386 = adastrap-i386-$V-0.tar.xz
ADASTRAP_LIBC-amd64 = 67.0
ADASTRAP-amd64 = adastrap-amd64-$V-0.tar.xz
d15 1
a15 1
ADASTRAP-sparc64 = adastrap-sparc64-$V-0.tar.xz
d27 1
a27 1
REVISION-main =	1
d33 1
a33 1
REVISION-ada =	0
@


1.56
log
@regen PLIST to unbreak following kerberosV update; com_err.h no longer
needs to be "fixed."  ok pascal@@
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.55 2013/06/13 06:44:08 landry Exp $
a8 1
REVISION-main = 0
d26 9
@


1.55
log
@Fix gcc's on sparc64 by using a regen'ed ada boostrap. From tobiasu@@
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.54 2013/06/07 07:54:23 pascal Exp $
d9 1
@


1.54
log
@Update to GCC 4.6.4.  tested by and adastrap-sparc64 built by tobiasu@@
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.51 2013/03/21 08:46:32 ajacoutot Exp $
d14 1
a14 1
ADASTRAP_LIBC-sparc64 = 68.2
@


1.53
log
@Don't pass -g in CFLAGS; it increases the size of ${WRKBUILD} to over 4G and
thus prevents building it in tmpfs under this threshold.

prompted by/ok espie@@
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.52 2013/05/03 23:13:49 tobiasu Exp $
d6 1
a6 1
V = 4.6.3
d10 1
a10 1
ADASTRAP_LIBC-i386 = 63.0
d12 1
a12 1
ADASTRAP_LIBC-amd64 = 66.0
d14 1
a14 1
ADASTRAP_LIBC-sparc64 = 66.0
a25 9

REVISION-main = 15
REVISION-c++ = 14
REVISION-estdc = 10
REVISION-f95 = 14
REVISION-java = 15
REVISION-objc = 14
REVISION-ada = 16
REVISION-go = 14
@


1.52
log
@Sync 4.8 changes to 4.7 and 4.6

- Absolute path for STRIP
- Enable ncpu detection in gnatlib
- Force sequential "make install" target
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.51 2013/03/21 08:46:32 ajacoutot Exp $
d127 1
a127 1
CFLAGS = -O2 -g
@


1.51
log
@USE_LIBTOOL=Yes is the default now.
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.50 2013/03/11 11:20:27 espie Exp $
d33 1
a33 1
REVISION-ada = 15
d119 1
@


1.50
log
@PERMIT_* / REGRESS->TEST sweep
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.49 2013/02/04 11:37:09 pascal Exp $
a70 1
USE_LIBTOOL =	Yes
@


1.49
log
@sync hppa LINK_SPEC; ok brad@@

no bumps for 4.7 as it doesn't build there
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.48 2013/02/01 16:34:36 naddy Exp $
d76 1
a76 1
REGRESS_DEPENDS = 	devel/dejagnu \
d86 1
a86 1
REGRESS_DEPENDS += 	${BUILD_PKGPATH},-estdc>=4.6,<4.7
d107 1
a107 1
REGRESS_DEPENDS += ${BUILD_PKGPATH},-ada
@


1.48
log
@bump for plist changes 5.2 -> 5.3
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.47 2013/01/28 01:03:05 tobiasu Exp $
d27 2
a28 2
REVISION-main = 14
REVISION-c++ = 13
d30 5
a34 5
REVISION-f95 = 13
REVISION-java = 14
REVISION-objc = 13
REVISION-ada = 14
REVISION-go = 13
@


1.47
log
@Remove sparc, m68k, and vax from the list of working architectures.
Their respective gcc backend ports are unfinished and broken.

ok pascal@@
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.46 2013/01/23 18:26:55 pascal Exp $
d27 2
a28 2
REVISION-main = 13
REVISION-c++ = 12
d30 5
a34 5
REVISION-f95 = 12
REVISION-java = 13
REVISION-objc = 12
REVISION-ada = 13
REVISION-go = 12
@


1.46
log
@Add alpha support (without -go).  Takes 14h to build.

tested by and ok naddy@@
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.45 2013/01/20 02:23:40 tobiasu Exp $
d3 1
a3 1
ONLY_FOR_ARCHS = alpha amd64 hppa i386 powerpc sparc sparc64
@


1.45
log
@"Fix" parallel make install by forcing gmake to only run 1 job. It's not
pretty and we would like to have a better fix, but for now it should suffice.

ok naddy@@, sthen@@
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.44 2013/01/18 19:09:58 bcallah Exp $
d3 1
a3 1
ONLY_FOR_ARCHS = amd64 hppa i386 powerpc sparc sparc64
d52 1
a52 1
NOT_FOR_ARCHS-go = hppa mips64el
@


1.44
log
@More mips64el check-in. Add mips64el to NOT_FOR_ARCHS-go. ld fails: Bad final value
ok jasper@@ pascal@@
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.43 2013/01/16 19:28:48 pascal Exp $
a4 2
# race condition in fake
PARALLEL_INSTALL = No
d157 1
@


1.43
log
@Add hppa support.  Still a bit rough around the edges: Some optimisations
(-foptimize-sibling-calls and -freorder-blocks) cause segfaults during build,
so don't include them in -O2 on hppa.  Also, -go is not supported.

requested by and ok brad@@ and tested on one of his machines
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.42 2012/12/28 14:32:01 espie Exp $
d54 1
a54 1
NOT_FOR_ARCHS-go = hppa
@


1.42
log
@a little overkill on autoconf override magic...
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.41 2012/12/26 16:15:19 naddy Exp $
d3 1
a3 1
ONLY_FOR_ARCHS = amd64 i386 powerpc sparc sparc64
d54 1
@


1.41
log
@do not run parallel fake until the race condition there has been fixed
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.40 2012/11/06 00:57:43 tobiasu Exp $
d120 1
@


1.40
log
@Add Ada support on amd64 and sparc64

Also unbreak and improve adastrap generation
Cleanup bootstrap libc handling

ok pascal@@
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.39 2012/10/17 19:58:21 kurt Exp $
d5 2
@


1.39
log
@Fix boehm-gc and increase gcj default thread stack size. Makes gjc work
well enough to bootstrap devel/jdk/1.6. okay pascal@@ jasper@@
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.38 2012/10/07 20:09:44 landry Exp $
d9 7
a15 3
BOOTSTRAP_GEN = 0
LIBC_VERSION = 63.0
ADASTRAP = adastrap-i386-$V-${BOOTSTRAP_GEN}.tar.xz
d27 1
a27 1
REVISION-main = 12
d33 1
a33 1
REVISION-ada = 12
d50 1
a50 1
ONLY_FOR_ARCHS-ada = i386
d66 2
a67 1
SUPDISTFILES =	${ADASTRAP}:0 ${ECJ}:1
d102 2
a103 2
DISTFILES += ${ADASTRAP}:0
EXTRACT_ONLY += ${ADASTRAP}
d195 1
a221 5
.if ${BUILD_PACKAGES:M-ada}
	# XXX cheat a bit
	cd ${WRKDIR}/bootstrap/system-libs && ln -sf libc.so.${LIBC_VERSION} libc.so.61.0
	${WRKDIR}/bin/egcc -v # if this fails, you must extract suitable libraries from the relevant OpenBSD release or use the no_ada FLAVOR.
.endif
d243 2
a244 2
ADA_PACKAGE = ${PACKAGE_REPOSITORY}/i386/all/${PKGNAME-ada}.tgz
GCC_PACKAGE = ${PACKAGE_REPOSITORY}/i386/all/${PKGNAME-main}.tgz
d247 1
a247 1
.if !defined(LIBC_VERSION)
d252 2
a253 1
	cp /usr/lib/libc.so.${LIBC_VERSION} ${WRKDIR}/prepare/bootstrap/system-libs
d257 5
d263 1
a263 1
		xz > ${FULLDISTDIR}/${ADASTRAP}
@


1.38
log
@Sync the config/openbsd.h and config/sparc/openbsd64.h patches with
respectively r1.9 and r1.6 of base gcc ones adding #define
NO_IMPLICIT_EXTERN_C. While here add the missing #define
NO_UNSAFE_BUILTINS to gfortran/gcc 4.2, Bump all REVISIONs.
ok sthen@@
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.37 2012/09/28 15:02:29 pascal Exp $
d27 1
a27 1
REVISION-java = 12
@


1.37
log
@Unify MASTER_SITES for adastrap; they're now all hosted by Tobias Ulmer on
tmux.org.  Makes gnat bootstrapping work a little easier for him.
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.36 2012/09/26 17:36:46 naddy Exp $
d23 8
a30 8
REVISION-main = 11
REVISION-c++ = 11
REVISION-estdc = 9
REVISION-f95 = 11
REVISION-java = 11
REVISION-objc = 11
REVISION-ada = 11
REVISION-go = 11
@


1.36
log
@Add DPB_PROPERTIES=parallel for some big ports.
Required to make full use of the amd64 package building cluster.
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.35 2012/09/03 13:24:58 pascal Exp $
d74 1
a74 2
MASTER_SITES0 =	http://spacehopper.org/mirrors/
#MASTER_SITES0 = ftp://quatramaran.ens.fr/pub/espie/
@


1.35
log
@Make gcc 4.[67] use __guard_local instead of __guard.  From Brad.

ok matthew@@
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.34 2012/09/01 00:00:32 pascal Exp $
d4 1
@


1.34
log
@Patch GCC and derived ports to use PIE by default on the same architectures it
is enabled on in base; except for gcc 3.3, which does not have PIE support and
therefore needs to pass -nopie to the linker.

Also, sync powerpc pthread specs with base.  From Brad.

ok naddy@@
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.33 2012/08/29 20:53:32 sthen Exp $
d22 2
a23 2
REVISION-main = 10
REVISION-c++ = 10
d25 5
a29 5
REVISION-f95 = 10
REVISION-java = 10
REVISION-objc = 10
REVISION-ada = 10
REVISION-go = 10
@


1.33
log
@missing bump, pointed out by nigel@@
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.32 2012/08/28 23:39:12 sthen Exp $
d22 8
a29 1
REVISION = 9
d138 1
@


1.32
log
@sync OBSD_LIB_SPEC in the ports tree compilers with the updated one
in base; from Brad
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.31 2012/08/25 18:22:54 pascal Exp $
d22 1
a22 8
REVISION-main = 5
REVISION-c++ = 8
REVISION-estdc = 4
REVISION-f95 = 5
REVISION-java = 6
REVISION-objc = 5
REVISION-ada = 5
REVISION-go = 6
@


1.31
log
@Set PKGSPEC-main to be more strict about versions (>=4.6,<4.7) of the -main
package.  g++ et alii should always depend on a matching gcc.  Same solution as
for 4.7 by espie@@.

found by and ok aja@@
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.30 2012/08/23 19:19:16 sthen Exp $
d182 1
a182 1
WANTLIB =		c gmp mpc mpfr z
d189 4
a192 4
WANTLIB-estdc =		c m
WANTLIB-f95 =		${WANTLIB} m
WANTLIB-java =		${WANTLIB} m pthread
WANTLIB-go =		${WANTLIB} m pthread
@


1.30
log
@sync wantlib
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.29 2012/08/20 12:35:41 pascal Exp $
d20 1
d22 2
a23 2
REVISION-main = 4
REVISION-c++ = 7
d25 5
a29 5
REVISION-f95 = 4
REVISION-java = 5
REVISION-objc = 4
REVISION-ada = 4
REVISION-go = 5
@


1.29
log
@Sync -pthread semantics with base gcc.  From Brad.

ok matthew@@
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.28 2012/07/01 18:28:40 pascal Exp $
d23 1
a23 1
REVISION-estdc = 3
d28 1
a28 1
REVISION-go = 4
d188 1
a188 1
WANTLIB-estdc =		m
d191 1
a191 1
WANTLIB-go =		${WANTLIB} m
@


1.28
log
@Deal with hidden dependencies libmagic and libexecinfo, found by Mikolaj
Kucharski:
- disable detection of magic.h
- record build dependency on devel/libexecinfo.  Note that this affects only
  profiling features of libstdc++, enabled by defining _GLIBCXX_PROFILE.

ok espie@@
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.27 2012/06/21 13:56:57 sthen Exp $
d21 2
a22 2
REVISION-main = 3
REVISION-c++ = 6
d24 5
a28 5
REVISION-f95 = 3
REVISION-java = 4
REVISION-objc = 3
REVISION-ada = 3
REVISION-go = 3
@


1.27
log
@bump for plist changes 5.1 -> 5.2
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.26 2012/05/14 23:39:39 pascal Exp $
d22 1
a22 1
REVISION-c++ = 5
d65 2
a66 1
BUILD_DEPENDS +=	devel/bison
d111 1
@


1.26
log
@Fix build with Brad's sysconf(3) diff, found by naddy@@ in his bulk build.
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.25 2012/05/07 10:34:33 pascal Exp $
d21 8
a28 8
REVISION-main = 2
REVISION-c++ = 4
REVISION-estdc = 2
REVISION-f95 = 2
REVISION-java = 3
REVISION-objc = 2
REVISION-ada = 2
REVISION-go = 2
@


1.25
log
@Don't hardcode GC_nprocs to 1 in boehm-gc, but get it from sysconf instead,
following a similar change in devel/boehm-gc.
From Brad.

ok kurt@@
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.24 2012/05/04 08:47:55 pascal Exp $
d22 1
a22 1
REVISION-c++ = 3
@


1.24
log
@Do not let different versions of libstdc++ conflict with each other.  At the
same time, make sure that g++ is never installed alongside a higher version
of libstdc++, so that stuff will always link to the correct library.

feedback espie@@ and kurt@@, ok kurt@@
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.23 2012/04/23 14:16:34 pascal Exp $
d25 1
a25 1
REVISION-java = 2
@


1.23
log
@- define _REENTRANT, not _POSIX_THREADS for -pthread
- sync kprintf formats with base

looks ok to kurt@@
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.22 2012/04/09 11:55:53 pascal Exp $
d22 2
a23 2
REVISION-c++ = 2
REVISION-estdc = 1
@


1.22
log
@Defaulting to march=i486 in the compiler doesn't help much if the driver
overrides that setting.  Sync both to use i486.  Fixes libreoffice and chromium
on i386, tested by both me and naddy@@.
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.21 2012/04/02 15:28:04 pascal Exp $
d21 2
a22 2
REVISION-main = 1
REVISION-c++ = 1
d24 5
a28 5
REVISION-f95 = 1
REVISION-java = 1
REVISION-objc = 1
REVISION-ada = 1
REVISION-go = 1
d109 1
a109 1
EXTRA_ENV += ac_cv_prog_CONFIGURED_M4=/usr/bin/m4
@


1.21
log
@Apply the same fix as to base gcc wrt -fident.

ok espie@@
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.20 2012/04/02 08:51:30 pascal Exp $
d21 8
a28 8
REVISION-main = 0
REVISION-c++ = 0
REVISION-estdc = 0
REVISION-f95 = 0
REVISION-java = 0
REVISION-objc = 0
REVISION-ada = 0
REVISION-go = 0
@


1.20
log
@Previous commit actually fixed gcc 4.6 on sparc64; just fix one stupid typo.
Tested on one of weerd@@'s machines (thanks).

Also, update TODO.

ok espie@@
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.19 2012/03/31 20:02:03 pascal Exp $
d20 9
@


1.19
log
@Update to gcc 4.6.3.

Also, sync a bit with base gcc:
- disable unsafe builtins
- disable -Wpointer-sign in -Wall
- move -fstrict-aliasing to -O3, disable -fstrict-overflow and
  -fdelete-null-pointer-checks
- enable -Wsystem-headers
- default to march=i486 on i386
- fix crtsavres on powerpc
- sync sparc64 config
- implement -Wvariable-decl, -Wstack-larger-than-N (alpha, amd64, i386, sparc,
  sparc64), -Wtrampolines, -ftrampolines
- default to -fno-ident
- fix -rdynamic by passing -export-dynamic to ld(1)

some bits from Brad, others from me.

tested by myself and jsg@@, adastrap now hosted by sthen@@ (thanks).

ok jsg@@ sthen@@
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.18 2012/03/07 20:39:37 kurt Exp $
a3 1
BROKEN-sparc64 = gengtype looping infinitely
@


1.18
log
@enable __cxa_atexit. okay pascal@@
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.17 2012/02/28 20:00:16 pascal Exp $
d6 1
a6 1
V = 4.6.2
d9 2
a10 2
BOOTSTRAP_GEN = 4
LIBC_VERSION = 60.1
a21 9
REVISION-main = 1
REVISION-c++ =	1
REVISION-estdc =1
REVISION-f95 =	0
REVISION-java =	1
REVISION-objc =	0
REVISION-ada =	0
REVISION-go =	0

d63 2
a64 2
#MASTER_SITES0 =	http://spacehopper.org/mirrors/
MASTER_SITES0 = ftp://quatramaran.ens.fr/pub/espie/
d230 2
a231 2
ADA_PACKAGE = ${PACKAGE_REPOSITORY}/i386/all/${PKGNAME-ada}${PKG_SUFX}
GCC_PACKAGE = ${PACKAGE_REPOSITORY}/i386/all/${PKGNAME-main}${PKG_SUFX}
@


1.17
log
@fix boehm-gc with rthreads for gcc 4.6. based on kurt@@'s work.

ok espie@@
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.16 2012/02/16 21:30:15 pascal Exp $
d22 3
a24 3
REVISION-main = 0
REVISION-c++ =	0
REVISION-estdc =0
@


1.16
log
@- modify stack protection to work with our native libc routines, passing the
  function name to __stack_smash_handler.  Only supported for "c-family"
  languages at the moment.
- enable it per default on archs where FRAME_GROWS_DOWNWARD
- remove obsolete comment about adastrap needing a specific libc
- -java actually needs a runtime dep on -main for -lgcc

ok espie@@
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.15 2012/02/03 17:01:17 landry Exp $
d26 1
a26 1
REVISION-java =	0
@


1.15
log
@Mark gcc 4.6 as BROKEN-sparc64, gengtype loops infinitely.
ok espie@@ sthen@@
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.14 2012/01/26 13:17:22 pascal Exp $
a9 1
# XXX this needs libc.so.61.0 to build on i386
d22 9
a183 1
RUN_DEPENDS-java =
@


1.14
log
@- bump libestdc++ following the bump in gcc 4.2
- deal with ldconfig shitz being run at fake install everywhere
- fix sprintf/strcpy usage in libestdc++ so we don't get a warning every time
  we compile a C++ program

Everything brought up by espie@@.
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.13 2012/01/24 19:19:27 espie Exp $
d4 1
@


1.13
log
@fix for !i386, sorry
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.12 2012/01/23 17:04:10 espie Exp $
d22 1
a22 1
SHARED_LIBS =	estdc++		12.0 \
@


1.12
log
@as discussed with pascal, make build more reproducible, by enforcing
CONFIG_SITE even if the FSF says no.

Also, finally get rid of the stage3 build/comparison, since apart from
taking build time, it's not really THAT useful unless you're specifically
debugging gcc.
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.11 2012/01/23 15:34:01 espie Exp $
a193 2
	# XXX cheat a bit
	cd ${WRKDIR}/bootstrap/system-libs && ln -sf libc.so.${LIBC_VERSION} libc.so.61.0
d206 2
@


1.11
log
@like for 4.2, bundle a libc with adastrap.
cheat a bit: bundle the libc from 5.0, and pretend it's the one we built
with... (to be cleaned next time someone bootstraps ada)
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.10 2011/12/11 21:11:37 pascal Exp $
d33 1
a33 1
PSEUDO_FLAVORS = no_c++ no_f95 no_objc no_java no_ada no_go
d82 1
a82 1
CONFIGURE_ARGS +=	--enable-libgcj
d89 1
a89 2
CONFIGURE_ENV = ADAC=${WRKDIR}/bin/egcc GNATBIND=${WRKDIR}/bin/gnatbind
MAKE_ENV = ADAC=${WRKDIR}/bin/egcc GNATBIND=${WRKDIR}/bin/gnatbind
d100 2
a101 2
CONFIGURE_ENV += am_cv_func_iconv=no
CONFIGURE_ENV += ac_cv_prog_CONFIGURED_M4=/usr/bin/m4
d104 3
d139 1
d143 4
@


1.10
log
@don't pick up gmkdir
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.9 2011/12/08 17:40:55 pascal Exp $
d8 1
a8 1
BOOTSTRAP_GEN = 3
d10 1
d63 2
a64 1
MASTER_SITES0 =	http://spacehopper.org/mirrors/
d187 2
d191 1
a191 1
	echo 'GNAT_ROOT=${WRKDIR}/bootstrap GCC_ROOT=${WRKDIR}/bootstrap exec ${WRKDIR}/bootstrap/bin/$f "$$@@"' >>${WRKDIR}/bin/$f
d194 1
a194 1
	ln -s /usr/bin/nm ${WRKDIR}/bin/enm
d200 3
d228 6
a233 1
	mkdir -p ${WRKDIR}/prepare/bootstrap
d239 1
@


1.9
log
@- fix openbsd threads in boehm-gc; fixes egcj-dbtool (or, for that matter,
any gcj-compiled program)
- link boehm-gc with -pthread
- download and install ecj.jar (required by gcj)
- plist fixes
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.8 2011/11/23 20:55:11 pascal Exp $
d101 1
d139 1
a139 1
MAKE_FLAGS = libstdc___la_LDFLAGS='-version-info 31:0:0 -lm'
@


1.8
log
@zap pthread from WANTLIB-go.  nothing but libgo needed it.
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.7 2011/11/19 22:19:53 pascal Exp $
d49 4
a52 1
SUPDISTFILES =	${ADASTRAP}:0
d63 1
d78 1
d86 1
d180 1
a180 1
CONFIG=x86_64-unknown-openbsd${OSREV}
d195 3
@


1.7
log
@- add Go support (only tested on amd64, but I'd be surprised if it broke
  anywhere else.  The only thing not supported yet is tracing using ptrace(2).
- clean up Makefile and restructure a bit
- VMEM_WARNING when -java is built
- some minor PLIST tweaks

ok espie@@
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.6 2011/11/15 15:48:13 pascal Exp $
d166 1
a166 1
WANTLIB-go =		${WANTLIB} m pthread
@


1.6
log
@disable on alpha. It will only build if/when it switches to gcc4, due to
missing builtins.
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.5 2011/11/15 00:42:52 pascal Exp $
a3 1
#BROKEN=adjust for types changes
d19 1
a19 1
#PKGNAME-go =	gccgo-${FULL_PKGVERSION}
d28 2
a29 1
		lto_plugin      0.0
d32 1
a32 1
PSEUDO_FLAVORS = no_c++ no_f95 no_objc no_java no_ada
d36 1
a36 2
ONLY_FOR_ARCHS-java = amd64 sparc64 i386
#ONLY_FOR_ARCHS-go = amd64 i386			# XXX
d38 1
a38 1
MULTI_PACKAGES = -main -f95 -objc -java -c++ -estdc -ada
d47 2
a48 1
DISTFILES =  ${DISTNAME}.tar.bz2
d53 1
a53 2
BUILD_DEPENDS += devel/bison

a57 3
DISTNAME =   	gcc-${FULL_VERSION}


a60 3
CONFIGURE_STYLE =	gnu
MODGNU_CONFIG_GUESS_DIRS =	${WRKSRC} ${WRKSRC}/gcc

d64 1
a64 1
REGRESS_DEPENDS += 	libstdc++->=4.6,<4.7:${BUILD_PKGPATH},-estdc
d74 3
a76 2
BUILD_DEPENDS += archivers/zip>=2.3p0
CONFIGURE_ARGS += --enable-libgcj
d86 3
a88 3
#.if ${BUILD_PACKAGES:M-go}
#LANGS := ${LANGS},go
#.endif
d90 2
a91 11
post-extract:
.for f in egcc gnatbind gnatmake gnatlink
	echo "#! /bin/sh" >${WRKDIR}/bin/$f
	echo 'GNAT_ROOT=${WRKDIR}/bootstrap GCC_ROOT=${WRKDIR}/bootstrap exec ${WRKDIR}/bootstrap/bin/$f "$$@@"' >>${WRKDIR}/bin/$f
	chmod a+x ${WRKDIR}/bin/$f
.endfor
	ln -s /usr/bin/nm ${WRKDIR}/bin/enm
	echo "# This file automatically generated" >> ${WRKSRC}/libversions
.for l v in ${SHARED_LIBS}
	echo "LIB$l_LTVERSION = -version-info ${v:S/./:/}" >> ${WRKSRC}/libversions
.endfor
a99 1

d115 1
a115 1
	--with-gmp=${LOCALBASE} \
a133 1

d154 2
a155 2
RUN_DEPENDS =		gcc-${FULL_PKGVERSION}:${BUILD_PKGPATH}
WANTLIB =		c
d161 2
a162 3
RUN_DEPENDS-c++ =	${RUN_DEPENDS} libstdc++->=4.6,<4.7:${BUILD_PKGPATH},-estdc
WANTLIB-main =		${WANTLIB} gmp mpc mpfr z
WANTLIB-c++ =		${WANTLIB} gmp mpc mpfr z
d164 3
a166 3
WANTLIB-f95 =		${WANTLIB} gmp m mpc mpfr z
WANTLIB-java =		${WANTLIB} gmp m mpc mpfr pthread z
WANTLIB-objc =		${WANTLIB} gmp mpc mpfr z
d177 13
d201 2
a202 1
	chown ${BINOWN}:${BINGRP} ${PREFIX}/lib/gcc/${CONFIG}/${V}/fpic/libgcov.a
d215 2
a216 1
	cd ${WRKDIR}/prepare && tar cf - bootstrap | xz > ${FULLDISTDIR}/${ADASTRAP}
@


1.5
log
@move down the post-install in order to be able to tell if we're a PIC arch,
so that I can fix the ownership of some libraries. Also, get rid of a trace
of m68k support.
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.4 2011/11/14 22:55:10 pascal Exp $
d3 1
a3 1
ONLY_FOR_ARCHS = alpha amd64 i386 powerpc sparc sparc64
@


1.4
log
@make no_f95 pseudo-flavour work
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.3 2011/11/14 17:34:35 pascal Exp $
d3 1
a3 1
ONLY_FOR_ARCHS = alpha amd64 i386 powerpc sparc sparc64 
a107 7
post-install:
.if ${BUILD_PACKAGES:M-ada}
	chown -R ${SHAREOWN}:${SHAREGRP} ${PREFIX}/lib/gcc/*/$V/adainclude
	chown -R ${SHAREOWN}:${SHAREGRP} ${PREFIX}/lib/gcc/*/$V/adalib
.endif
	chown -R ${SHAREOWN}:${SHAREGRP} ${PREFIX}/lib/gcc/*/$V/include
	chown -R ${SHAREOWN}:${SHAREGRP} ${PREFIX}/lib/gcc/*/$V/include-fixed
d151 2
a152 1
.if ${MACHINE_ARCH} == "m68k" || ${MACHINE_ARCH} == "sparc"  || ${MACHINE_ARCH} == "amd64"
d155 1
d193 14
@


1.3
log
@bump major library versions, as discussed with espie@@.
Disable on vax and m68k (I don't think it makes sense there ...), and sort archs
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.2 2011/11/14 13:41:16 sthen Exp $
a74 1
CONFIGURE_ARGS += --with-gmp=${LOCALBASE}
d138 1
@


1.2
log
@i'm mirroring the adastrap file for 4.6, adjust MASTER_SITES0
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.1.1.1 2011/11/14 13:00:55 pascal Exp $
d3 1
a3 1
ONLY_FOR_ARCHS = alpha i386 m68k sparc sparc64 powerpc vax amd64
d22 7
a28 7
SHARED_LIBS =	estdc++		11.0 \
		gfortran	2.0 \
		gcj		0.0 \
		gcj-tools	0.0 \
		gij		0.0 \
		objc		2.0 \
		ssp		0.0 \
@


1.1
log
@Initial revision
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.66 2011/10/04 07:08:54 espie Exp $
d63 1
a63 1
MASTER_SITES0 =	ftp://quatramaran.ens.fr/pub/espie/
@


1.1.1.1
log
@now import for real, sorry ...
@
text
@@
