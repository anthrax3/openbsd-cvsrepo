head	1.4;
access;
symbols
	OPENBSD_5_8:1.3.0.10
	OPENBSD_5_8_BASE:1.3
	OPENBSD_5_7:1.3.0.6
	OPENBSD_5_7_BASE:1.3
	OPENBSD_5_6:1.3.0.4
	OPENBSD_5_6_BASE:1.3
	OPENBSD_5_5:1.3.0.2
	OPENBSD_5_5_BASE:1.3
	OPENBSD_5_4:1.2.0.2
	OPENBSD_5_4_BASE:1.2
	pascal_20130804:1.1.1.1
	pascal:1.1.1;
locks; strict;
comment	@# @;


1.4
date	2015.09.10.08.23.54;	author pascal;	state dead;
branches;
next	1.3;
commitid	ovY05rVdcfWNuWWc;

1.3
date	2014.02.07.01.31.41;	author tobiasu;	state Exp;
branches;
next	1.2;

1.2
date	2013.04.12.10.01.47;	author tobiasu;	state Exp;
branches;
next	1.1;

1.1
date	2013.04.08.08.20.24;	author pascal;	state Exp;
branches
	1.1.1.1;
next	;

1.1.1.1
date	2013.04.08.08.20.24;	author pascal;	state Exp;
branches;
next	;


desc
@@


1.4
log
@tedu gcc 4.8

ok sthen@@ tobiasu@@
@
text
@$OpenBSD: patch-gcc_ada_adaint_c,v 1.3 2014/02/07 01:31:41 tobiasu Exp $
--- gcc/ada/adaint.c.orig	Wed Feb  6 13:01:20 2013
+++ gcc/ada/adaint.c	Mon Jan 20 01:31:47 2014
@@@@ -1463,8 +1463,9 @@@@ __gnat_file_time_fd (int fd)
 /* Set the file time stamp.  */
 
 void
-__gnat_set_file_time_name (char *name, time_t time_stamp)
+__gnat_set_file_time_name (char *name, OS_Time ts)
 {
+  time_t time_stamp = (time_t) ts;
 #if defined (__vxworks)
 
 /* Code to implement __gnat_set_file_time_name for these systems.  */
@@@@ -2467,7 +2468,8 @@@@ __gnat_number_of_cpus (void)
 {
   int cores = 1;
 
-#if defined (linux) || defined (sun) || defined (AIX) || defined (__APPLE__)
+#if defined (linux) || defined (sun) || defined (AIX) || defined (__APPLE__) ||\
+  defined (__OpenBSD__)
   cores = (int) sysconf (_SC_NPROCESSORS_ONLN);
 
 #elif defined (__hpux__)
@@@@ -3855,3 +3857,9 @@@@ void __gnat_cpu_set (int cpu, size_t count ATTRIBUTE_U
 #ifdef __cplusplus
 }
 #endif
+
+const char *
+fname_as_string(int pretty_p __attribute__((__unused__)))
+{
+	return NULL;
+}
@


1.3
log
@Repair time/delay/duration time_t issues in gnat. All direct imports of
C functions have been modified to use same-size types on both sides.
There are no checks in gcc to make sure the types match, and it happily
trashes the stack or reads bogus data without this fix.

The C shim in gnatlib is still casting down to long (by design), thus
gnat is not 2038-proof on 32 bit architectures. Fixing this is an
ongoing project, but I'm running out of time for this release.

Getting the timezone offset is now supported; the unused usleep
procedure that snuck in from FreeBSD support got removed.

Tested on all supported architectures, plus new bootstraps due to the
stack trashing, just in case...

Conceptually fine with brad@@
deraadt@@ is unhappy with the partial solution, fixing this remains a
high priority todo
@
text
@d1 1
a1 1
$OpenBSD: patch-gcc_ada_adaint_c,v 1.2 2013/04/12 10:01:47 tobiasu Exp $
@


1.2
log
@Add Ada support for sparc64.

Use SJLJ exceptions instead of ZCX because gcc produces broken code
for the later. Enable ncpu detection in the runtime for all archs.

ok pascal@@
@
text
@d1 1
a1 1
$OpenBSD: patch-gcc_ada_adaint_c,v 1.1.1.1 2013/04/08 08:20:24 pascal Exp $
d3 13
a15 2
+++ gcc/ada/adaint.c	Wed Apr 10 01:42:27 2013
@@@@ -2467,7 +2467,8 @@@@ __gnat_number_of_cpus (void)
d25 1
a25 1
@@@@ -3855,3 +3856,9 @@@@ void __gnat_cpu_set (int cpu, size_t count ATTRIBUTE_U
@


1.1
log
@Initial revision
@
text
@d1 14
a14 4
$OpenBSD: patch-gcc_ada_adaint_c,v 1.1.1.1 2012/04/23 15:56:41 pascal Exp $
--- gcc/ada/adaint.c.orig	Thu Jan  3 11:09:24 2013
+++ gcc/ada/adaint.c	Sat Jan 12 13:27:07 2013
@@@@ -3855,3 +3855,9 @@@@ void __gnat_cpu_set (int cpu, size_t count ATTRIBUTE_U
@


1.1.1.1
log
@Import gcc 4.8.

For a full Changelog, see: http://gcc.gnu.org/gcc-4.8/changes.html

Tested by me on amd64, i386 and powerpc and by brad@@ on sparc64.

Adds support for -java on powerpc.  -faggressive-loop-optimizations is
disabled by default in the port, and the default debugging format changed
to DWARF2 (instead of 4).

tweaks and ok tobiasu@@
@
text
@@
