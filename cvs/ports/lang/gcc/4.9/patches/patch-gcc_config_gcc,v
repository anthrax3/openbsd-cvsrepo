head	1.9;
access;
symbols
	OPENBSD_6_0:1.7.0.4
	OPENBSD_6_0_BASE:1.7
	OPENBSD_5_9:1.7.0.2
	OPENBSD_5_9_BASE:1.7
	OPENBSD_5_8:1.6.0.4
	OPENBSD_5_8_BASE:1.6
	OPENBSD_5_7:1.5.0.2
	OPENBSD_5_7_BASE:1.5
	OPENBSD_5_6:1.1.1.1.0.2
	OPENBSD_5_6_BASE:1.1.1.1
	pascal_20140626:1.1.1.1
	pascal:1.1.1;
locks; strict;
comment	@# @;


1.9
date	2016.09.15.10.22.10;	author pascal;	state Exp;
branches;
next	1.8;
commitid	4SxNgGHN5MHnP8uD;

1.8
date	2016.09.01.17.30.33;	author pascal;	state Exp;
branches;
next	1.7;
commitid	89C4KSGtZfazLOn6;

1.7
date	2015.09.16.10.59.25;	author pascal;	state Exp;
branches;
next	1.6;
commitid	LTQaAAiVme26p4nH;

1.6
date	2015.07.19.21.22.49;	author pascal;	state Exp;
branches;
next	1.5;
commitid	nzWj593KjXmgljOW;

1.5
date	2014.11.20.19.54.40;	author pascal;	state Exp;
branches;
next	1.4;
commitid	PXOKb6wtLMa1GZnE;

1.4
date	2014.11.12.10.56.59;	author tobiasu;	state Exp;
branches;
next	1.3;
commitid	WoBcSdgLkHQQGkFt;

1.3
date	2014.08.25.09.57.04;	author tobiasu;	state Exp;
branches;
next	1.2;
commitid	RO4dcLjbUpWDv8QX;

1.2
date	2014.08.18.07.42.11;	author pascal;	state Exp;
branches;
next	1.1;
commitid	XotHT24xfq7v9ugc;

1.1
date	2014.06.26.16.30.17;	author pascal;	state Exp;
branches
	1.1.1.1;
next	;
commitid	P7PY1UTti0Albpwh;

1.1.1.1
date	2014.06.26.16.30.17;	author pascal;	state Exp;
branches;
next	;
commitid	P7PY1UTti0Albpwh;


desc
@@


1.9
log
@Convert to arm EABI.  Drop ada support for now until someone re-bootstraps it.
@
text
@$OpenBSD: patch-gcc_config_gcc,v 1.8 2016/09/01 17:30:33 pascal Exp $
--- gcc/config.gcc.orig	Mon Mar 14 11:03:12 2016
+++ gcc/config.gcc	Wed Sep 14 17:07:21 2016
@@@@ -771,6 +771,14 @@@@ case ${target} in
       default_use_cxa_atexit=yes
       ;;
   esac
+  case ${target} in
+    *-*-openbsd[0-3].*|*-*-openbsd4.[012])
+      # keep default of no cxa_atexit support for these older releases
+      ;;
+    *)
+      default_use_cxa_atexit=yes
+      ;;
+  esac
   ;;
 *-*-openbsd*)
   tmake_file="t-openbsd"
@@@@ -951,7 +959,7 @@@@ alpha*-*-netbsd*)
 		       alpha/elf.opt"
 	;;
 alpha*-*-openbsd*)
-	tm_defines="${tm_defines} OBSD_HAS_DECLARE_FUNCTION_NAME OBSD_HAS_DECLARE_FUNCTION_SIZE OBSD_HAS_DECLARE_OBJECT"
+	tm_defines="${tm_defines} OBSD_HAS_DECLARE_FUNCTION_NAME OBSD_HAS_DECLARE_FUNCTION_SIZE OBSD_HAS_DECLARE_OBJECT PIE_DEFAULT=2"
 	tm_file="elfos.h alpha/alpha.h alpha/elf.h openbsd.h openbsd-stdint.h alpha/openbsd.h openbsd-libpthread.h"
 	extra_options="${extra_options} openbsd.opt alpha/elf.opt"
 	# default x-alpha is only appropriate for dec-osf.
@@@@ -1018,6 +1026,12 @@@@ arm*-*-netbsdelf*)
 	extra_options="${extra_options} netbsd.opt netbsd-elf.opt"
 	tmake_file="${tmake_file} arm/t-arm"
 	;;
+arm-*-openbsd*)
+	tm_file="dbxelf.h elfos.h arm/elf.h arm/aout.h arm/openbsd1.h arm/arm.h openbsd.h openbsd-libpthread.h arm/openbsd.h"
+	extra_options="${extra_options} openbsd.opt"
+	tmake_file="${tmake_file} arm/t-arm arm/t-bpabi"
+	set
+	;;
 arm*-*-linux-*)			# ARM GNU/Linux with ELF
 	tm_file="dbxelf.h elfos.h gnu-user.h linux.h linux-android.h glibc-stdint.h arm/elf.h arm/linux-gas.h arm/linux-elf.h"
 	extra_options="${extra_options} linux-android.opt"
@@@@ -1206,6 +1220,7 @@@@ hppa*-*-linux*)
 	;;
 hppa*-*-openbsd*)
 	target_cpu_default="MASK_PA_11"
+	tm_defines="${tm_defines} PIE_DEFAULT=1"
 	tm_file="${tm_file} dbxelf.h elfos.h openbsd.h openbsd-stdint.h openbsd-libpthread.h \
 		 pa/pa-openbsd.h pa/pa32-regs.h pa/pa32-openbsd.h"
 	extra_options="${extra_options} openbsd.opt"
@@@@ -1380,6 +1395,7 @@@@ i[34567]86-*-openbsd2.*|i[34567]86-*openbsd3.[0123])
 	use_collect2=yes
 	;;
 i[34567]86-*-openbsd*)
+	tm_defines="${tm_defines} PIE_DEFAULT=1"
 	tm_file="${tm_file} i386/unix.h i386/att.h dbxelf.h elfos.h"
 	tm_file="${tm_file} openbsd.h openbsd-stdint.h openbsd-libpthread.h i386/openbsdelf.h"
 	extra_options="${extra_options} openbsd.opt"
@@@@ -1387,6 +1403,7 @@@@ i[34567]86-*-openbsd*)
 	gnu_ld=yes
 	;;
 x86_64-*-openbsd*)
+	tm_defines="${tm_defines} PIE_DEFAULT=1"
 	tm_file="${tm_file} i386/unix.h i386/att.h dbxelf.h elfos.h"
 	tm_file="${tm_file} openbsd.h openbsd-stdint.h openbsd-libpthread.h i386/x86-64.h i386/openbsdelf.h"
 	extra_options="${extra_options} openbsd.opt"
@@@@ -1946,6 +1963,18 @@@@ microblaze*-*-elf)
 	cxx_target_objs="${cxx_target_objs} microblaze-c.o"
 	tmake_file="${tmake_file} microblaze/t-microblaze"
         ;;
+mips64-*-openbsd*)
+       set
+       tm_file="dbxelf.h elfos.h openbsd.h mips/mips.h mips/openbsd.h openbsd-libpthread.h"
+       tm_defines="MIPS_ISA_DEFAULT=3 MIPS_ABI_DEFAULT=ABI_64 PIE_DEFAULT=1"
+       extra_options="${extra_options} openbsd.opt"
+       ;;
+mips64el-*-openbsd*)
+       set
+       tm_file="dbxelf.h elfos.h openbsd.h mips/mips.h mips/openbsd.h openbsd-libpthread.h"
+       tm_defines="MIPS_ISA_DEFAULT=3 MIPS_ABI_DEFAULT=ABI_64 TARGET_ENDIAN_DEFAULT=0 PIE_DEFAULT=1"
+       extra_options="${extra_options} openbsd.opt"
+       ;;
 mips*-*-netbsd*)			# NetBSD/mips, either endian.
 	target_cpu_default="MASK_ABICALLS"
 	tm_file="elfos.h ${tm_file} mips/elf.h netbsd.h netbsd-elf.h mips/netbsd.h"
@@@@ -2173,11 +2202,12 @@@@ picochip-*)
 	use_gcc_stdint=wrap
 	tmake_file="picochip/t-picochip t-pnt16-warn"
         ;;
-# port not yet contributed
-#powerpc-*-openbsd*)
-#	tmake_file="${tmake_file} rs6000/t-fprules"
-#	extra_headers=
-#	;;
+powerpc-*-openbsd*)
+	tm_defines="${tm_defines} PIE_DEFAULT=2"
+	tm_file="rs6000/secureplt.h ${tm_file} dbxelf.h elfos.h openbsd.h openbsd-libpthread.h freebsd-spec.h rs6000/sysv4.h rs6000/openbsd.h"
+	tmake_file="${tmake_file} rs6000/t-openbsd"
+	extra_options="${extra_options} rs6000/sysv4.opt openbsd.opt"
+	;;
 powerpc-*-darwin*)
 	extra_options="${extra_options} rs6000/darwin.opt"
 	case ${target} in
@@@@ -2747,11 +2777,19 @@@@ sparc64-*-netbsd*)
 	extra_options="${extra_options} sparc/long-double-switch.opt"
 	tmake_file="${tmake_file} sparc/t-sparc sparc/t-netbsd64"
 	;;
+sparc-*-openbsd*)
+	tm_file="${tm_file} dbxelf.h elfos.h openbsd.h openbsd-libpthread.h sparc/sysv4.h sparc/openbsd.h"
+	extra_options="${extra_options} openbsd.opt"
+	gas=yes
+	gnu_ld=yes
+	with_cpu=v7
+	tmake_file="${tmake_file} sparc/t-sparc"
+	;;
 sparc64-*-openbsd*)
+	tm_defines="${tm_defines} PIE_DEFAULT=2"
 	tm_file="sparc/openbsd1-64.h ${tm_file} dbxelf.h elfos.h sparc/sysv4.h sparc/sp64-elf.h"
 	tm_file="${tm_file} openbsd.h openbsd-stdint.h openbsd-libpthread.h sparc/openbsd64.h"
 	extra_options="${extra_options} openbsd.opt"
-	extra_options="${extra_options}"
 	gas=yes gnu_ld=yes
 	with_cpu=ultrasparc
 	tmake_file="${tmake_file} sparc/t-sparc"
@@@@ -2938,6 +2976,12 @@@@ case ${target} in
     else
       arch=i386
     fi
+    cpu=generic
+    arch_without_sse2=yes
+    arch_without_64bit=yes
+    ;;
+  i386-*-openbsd*)
+    arch=i486
     cpu=generic
     arch_without_sse2=yes
     arch_without_64bit=yes
@


1.8
log
@Update to GCC 4.9.4.

No fallout in naddy@@'s bulk.
@
text
@d1 1
a1 1
$OpenBSD: patch-gcc_config_gcc,v 1.7 2015/09/16 10:59:25 pascal Exp $
d3 1
a3 1
+++ gcc/config.gcc	Sat Aug  6 19:19:04 2016
d33 1
a33 1
+	tm_file="dbxelf.h elfos.h arm/elf.h arm/aout.h arm/arm.h openbsd.h openbsd-libpthread.h arm/openbsd.h"
d35 1
a35 1
+	tmake_file="${tmake_file} arm/t-arm"
@


1.7
log
@Enable secure PLT by default on PowerPC in ports GCC.
@
text
@d1 3
a3 3
$OpenBSD: patch-gcc_config_gcc,v 1.6 2015/07/19 21:22:49 pascal Exp $
--- gcc/config.gcc.orig	Thu May 21 22:50:59 2015
+++ gcc/config.gcc	Tue Aug 25 21:42:44 2015
d65 1
a65 1
@@@@ -1949,6 +1966,18 @@@@ microblaze*-*-elf)
d84 1
a84 1
@@@@ -2176,11 +2205,12 @@@@ picochip-*)
d102 1
a102 1
@@@@ -2750,11 +2780,19 @@@@ sparc64-*-netbsd*)
d123 1
a123 1
@@@@ -2941,6 +2979,12 @@@@ case ${target} in
@


1.6
log
@Bugfix update to 4.9.3.
@
text
@d1 1
a1 1
$OpenBSD: patch-gcc_config_gcc,v 1.5 2014/11/20 19:54:40 pascal Exp $
d3 1
a3 1
+++ gcc/config.gcc	Sat Jun 27 11:26:33 2015
d95 1
a95 1
+	tm_file="${tm_file} dbxelf.h elfos.h openbsd.h openbsd-libpthread.h freebsd-spec.h rs6000/sysv4.h rs6000/openbsd.h"
@


1.5
log
@Update to 4.9.2.  Finally gets rid of gfortran patches.

Tested on everything except sparc, adastraps mirrored by and ok tobiasu@@
@
text
@d1 3
a3 3
$OpenBSD: patch-gcc_config_gcc,v 1.4 2014/11/12 10:56:59 tobiasu Exp $
--- gcc/config.gcc.orig	Wed Sep 17 16:16:02 2014
+++ gcc/config.gcc	Sat Nov 15 16:52:32 2014
d102 1
a102 1
@@@@ -2740,11 +2770,19 @@@@ sparc64-*-netbsd*)
d123 1
a123 1
@@@@ -2931,6 +2969,12 @@@@ case ${target} in
@


1.4
log
@Add ARM support to gcc 4.9

Marked broken because it uses instructions the default binutils don't
understand. The port itself seems to work.

I will probably post the update instructions to arm@@ for those that are
interested in playing with this.

ok pascal@@ a long time ago
@
text
@d1 3
a3 3
$OpenBSD: patch-gcc_config_gcc,v 1.3 2014/08/25 09:57:04 tobiasu Exp $
--- gcc/config.gcc.orig	Mon Jun 16 10:15:35 2014
+++ gcc/config.gcc	Wed Sep 24 19:08:40 2014
d19 1
a19 1
@@@@ -945,7 +953,7 @@@@ alpha*-*-netbsd*)
d28 1
a28 1
@@@@ -1012,6 +1020,12 @@@@ arm*-*-netbsdelf*)
d41 1
a41 1
@@@@ -1201,6 +1215,7 @@@@ hppa*-*-linux*)
d49 1
a49 1
@@@@ -1375,6 +1390,7 @@@@ i[34567]86-*-openbsd2.*|i[34567]86-*openbsd3.[0123])
d57 1
a57 1
@@@@ -1382,6 +1398,7 @@@@ i[34567]86-*-openbsd*)
d65 1
a65 1
@@@@ -1944,6 +1961,18 @@@@ microblaze*-*-elf)
d84 1
a84 1
@@@@ -2167,11 +2196,12 @@@@ picochip-*)
d102 1
a102 1
@@@@ -2731,11 +2761,19 @@@@ sparc64-*-netbsd*)
d123 1
a123 1
@@@@ -2922,6 +2960,12 @@@@ case ${target} in
@


1.3
log
@Add sparc backend to gcc 4.9.1

Build time: 3.5 days @@ 150MHz
I do take 200MHz HyperSPARC and memory donations :-)

OK pascal@@
@
text
@d1 1
a1 1
$OpenBSD: patch-gcc_config_gcc,v 1.2 2014/08/18 07:42:11 pascal Exp $
d3 1
a3 1
+++ gcc/config.gcc	Thu Aug 21 14:20:04 2014
d28 14
a41 1
@@@@ -1201,6 +1209,7 @@@@ hppa*-*-linux*)
d49 1
a49 1
@@@@ -1375,6 +1384,7 @@@@ i[34567]86-*-openbsd2.*|i[34567]86-*openbsd3.[0123])
d57 1
a57 1
@@@@ -1382,6 +1392,7 @@@@ i[34567]86-*-openbsd*)
d65 1
a65 1
@@@@ -1944,6 +1955,18 @@@@ microblaze*-*-elf)
d84 1
a84 1
@@@@ -2167,11 +2190,12 @@@@ picochip-*)
d102 1
a102 1
@@@@ -2731,11 +2755,19 @@@@ sparc64-*-netbsd*)
d123 1
a123 1
@@@@ -2922,6 +2954,12 @@@@ case ${target} in
@


1.2
log
@Update to GCC 4.9.1 + fix for CVE-2014-5044.  As usual, sparc64 adastrap
generated by tobiasu@@, thanks!
@
text
@d1 1
a1 1
$OpenBSD: patch-gcc_config_gcc,v 1.1.1.1 2014/06/26 16:30:17 pascal Exp $
d3 1
a3 1
+++ gcc/config.gcc	Wed Jul 16 18:37:32 2014
d89 2
a90 1
@@@@ -2732,6 +2756,7 @@@@ sparc64-*-netbsd*)
d93 8
d106 5
a110 1
@@@@ -2922,6 +2947,12 @@@@ case ${target} in
@


1.1
log
@Initial revision
@
text
@d1 3
a3 3
$OpenBSD: patch-gcc_config_gcc,v 1.1.1.1 2013/04/08 08:20:25 pascal Exp $
--- gcc/config.gcc.orig	Wed Mar 12 11:13:07 2014
+++ gcc/config.gcc	Wed Jun 11 21:06:18 2014
d71 1
a71 1
@@@@ -2168,11 +2191,12 @@@@ picochip-*)
d89 1
a89 1
@@@@ -2733,6 +2757,7 @@@@ sparc64-*-netbsd*)
d97 1
a97 1
@@@@ -2923,6 +2948,12 @@@@ case ${target} in
@


1.1.1.1
log
@Import GCC 4.9, sparc64 test and ok tobiasu@@
@
text
@@
