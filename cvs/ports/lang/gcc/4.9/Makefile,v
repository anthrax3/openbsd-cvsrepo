head	1.48;
access;
symbols
	OPENBSD_6_1:1.47.0.2
	OPENBSD_6_1_BASE:1.47
	OPENBSD_6_0:1.33.0.2
	OPENBSD_6_0_BASE:1.33
	OPENBSD_5_9:1.26.0.2
	OPENBSD_5_9_BASE:1.26
	OPENBSD_5_8:1.17.0.4
	OPENBSD_5_8_BASE:1.17
	OPENBSD_5_7:1.12.0.2
	OPENBSD_5_7_BASE:1.12
	OPENBSD_5_6:1.3.0.2
	OPENBSD_5_6_BASE:1.3
	pascal_20140626:1.1.1.1
	pascal:1.1.1;
locks; strict;
comment	@# @;


1.48
date	2017.06.07.23.34.02;	author brynet;	state Exp;
branches;
next	1.47;
commitid	7XsuswH2A0fSAUjj;

1.47
date	2017.03.04.21.59.55;	author sthen;	state Exp;
branches;
next	1.46;
commitid	nhvOH4eNwFCqyURR;

1.46
date	2017.01.02.15.52.20;	author pascal;	state Exp;
branches;
next	1.45;
commitid	2Q1gPRDW0xGt2YHg;

1.45
date	2016.11.15.10.04.58;	author sthen;	state Exp;
branches;
next	1.44;
commitid	KSz7j5O7NsCzYOKY;

1.44
date	2016.11.11.20.13.43;	author naddy;	state Exp;
branches;
next	1.43;
commitid	288bYAXdIQRwWTGx;

1.43
date	2016.11.11.19.43.17;	author naddy;	state Exp;
branches;
next	1.42;
commitid	0J5OxDn4O44O8aXy;

1.42
date	2016.10.19.01.07.32;	author visa;	state Exp;
branches;
next	1.41;
commitid	zMVJxDlBW5VzWAiA;

1.41
date	2016.09.18.15.05.15;	author pascal;	state Exp;
branches;
next	1.40;
commitid	p4HlL0A39DFC51a1;

1.40
date	2016.09.15.10.22.10;	author pascal;	state Exp;
branches;
next	1.39;
commitid	4SxNgGHN5MHnP8uD;

1.39
date	2016.09.12.09.37.09;	author pascal;	state Exp;
branches;
next	1.38;
commitid	zZvaGvDoOrGB8O9N;

1.38
date	2016.09.06.10.14.24;	author pascal;	state Exp;
branches;
next	1.37;
commitid	zu4eDzJldCgcllA1;

1.37
date	2016.09.02.12.14.06;	author dcoppa;	state Exp;
branches;
next	1.36;
commitid	p2ej0pFerZ10XmZo;

1.36
date	2016.09.01.17.30.33;	author pascal;	state Exp;
branches;
next	1.35;
commitid	89C4KSGtZfazLOn6;

1.35
date	2016.09.01.10.56.58;	author jasper;	state Exp;
branches;
next	1.34;
commitid	rwkuU64NWSHV8Z1C;

1.34
date	2016.08.21.21.01.03;	author sthen;	state Exp;
branches;
next	1.33;
commitid	DZnFZTtuuha8M9S2;

1.33
date	2016.07.14.07.22.31;	author tobiasu;	state Exp;
branches;
next	1.32;
commitid	tJZesWLhyP8qZcZs;

1.32
date	2016.06.29.16.14.41;	author espie;	state Exp;
branches;
next	1.31;
commitid	c1yQMbJbfo0CFBcL;

1.31
date	2016.05.28.16.06.14;	author sthen;	state Exp;
branches;
next	1.30;
commitid	60vMLGABlJao9SRG;

1.30
date	2016.05.12.01.17.13;	author naddy;	state Exp;
branches;
next	1.29;
commitid	yWplpZyyaU1NC3LP;

1.29
date	2016.05.07.12.40.57;	author pascal;	state Exp;
branches;
next	1.28;
commitid	Fec0PsLcTwj1Q99H;

1.28
date	2016.03.24.13.16.32;	author jsg;	state Exp;
branches;
next	1.27;
commitid	xE7UhwS7EbxDTal2;

1.27
date	2016.03.11.19.59.15;	author naddy;	state Exp;
branches;
next	1.26;
commitid	pguKLBEFv33DrgKU;

1.26
date	2015.12.20.00.16.27;	author naddy;	state Exp;
branches;
next	1.25;
commitid	7FwUBfDRx93p0qtP;

1.25
date	2015.12.05.22.00.29;	author tobiasu;	state Exp;
branches;
next	1.24;
commitid	BVkGXvahEnuHSWWM;

1.24
date	2015.12.03.21.24.30;	author sthen;	state Exp;
branches;
next	1.23;
commitid	qh8BBe4z9PLvLPKf;

1.23
date	2015.09.24.22.29.58;	author tobiasu;	state Exp;
branches;
next	1.22;
commitid	BPJlFiP747TPeumN;

1.22
date	2015.09.24.08.51.48;	author sthen;	state Exp;
branches;
next	1.21;
commitid	jtNz2ZQbMMAtzn66;

1.21
date	2015.09.16.10.59.25;	author pascal;	state Exp;
branches;
next	1.20;
commitid	LTQaAAiVme26p4nH;

1.20
date	2015.09.11.08.07.44;	author pascal;	state Exp;
branches;
next	1.19;
commitid	yTDsFkNNfxRNQsoA;

1.19
date	2015.09.09.16.05.29;	author pascal;	state Exp;
branches;
next	1.18;
commitid	0BppZITK5fiC13jK;

1.18
date	2015.08.18.10.16.55;	author sthen;	state Exp;
branches;
next	1.17;
commitid	svvdXCklpfmdIwME;

1.17
date	2015.08.06.18.38.34;	author sthen;	state Exp;
branches;
next	1.16;
commitid	S8oe3toNlZy7gFr2;

1.16
date	2015.07.19.21.22.49;	author pascal;	state Exp;
branches;
next	1.15;
commitid	nzWj593KjXmgljOW;

1.15
date	2015.07.02.00.22.18;	author zhuk;	state Exp;
branches;
next	1.14;
commitid	kQjpoPVPrWhnKgK3;

1.14
date	2015.06.17.20.03.11;	author sthen;	state Exp;
branches;
next	1.13;
commitid	ASHe8W1wzY7eB3KC;

1.13
date	2015.05.22.11.31.16;	author ajacoutot;	state Exp;
branches;
next	1.12;
commitid	2khjHXfpTaOuNVcx;

1.12
date	2015.02.17.12.04.44;	author tobiasu;	state Exp;
branches;
next	1.11;
commitid	uFB3s9SV6geLLhES;

1.11
date	2015.02.10.22.04.54;	author brad;	state Exp;
branches;
next	1.10;
commitid	mIdx7aEpoZd5eG9d;

1.10
date	2015.02.03.20.32.12;	author pascal;	state Exp;
branches;
next	1.9;
commitid	LzgH25QAJKFopjkX;

1.9
date	2015.01.02.14.26.12;	author sthen;	state Exp;
branches;
next	1.8;
commitid	opt64GLzbD0TGQDJ;

1.8
date	2014.11.27.17.23.08;	author naddy;	state Exp;
branches;
next	1.7;
commitid	LnlHWlMikE5t5ljX;

1.7
date	2014.11.20.19.54.40;	author pascal;	state Exp;
branches;
next	1.6;
commitid	PXOKb6wtLMa1GZnE;

1.6
date	2014.11.12.10.56.59;	author tobiasu;	state Exp;
branches;
next	1.5;
commitid	WoBcSdgLkHQQGkFt;

1.5
date	2014.08.25.09.57.04;	author tobiasu;	state Exp;
branches;
next	1.4;
commitid	RO4dcLjbUpWDv8QX;

1.4
date	2014.08.18.07.42.11;	author pascal;	state Exp;
branches;
next	1.3;
commitid	XotHT24xfq7v9ugc;

1.3
date	2014.07.16.12.35.23;	author espie;	state Exp;
branches;
next	1.2;
commitid	C2ydepHwgMXxFvHx;

1.2
date	2014.06.26.21.01.37;	author sthen;	state Exp;
branches;
next	1.1;
commitid	EA2zM5O4CNiL0Z5A;

1.1
date	2014.06.26.16.30.15;	author pascal;	state Exp;
branches
	1.1.1.1;
next	;
commitid	P7PY1UTti0Albpwh;

1.1.1.1
date	2014.06.26.16.30.15;	author pascal;	state Exp;
branches;
next	;
commitid	P7PY1UTti0Albpwh;


desc
@@


1.48
log
@Backport, or rather forward port, a fix for the broken stack-protector on amd64.

This mirrors a change made to base gcc4.2 by martynas@@ in 2014.

https://marc.info/?l=openbsd-ports&m=149656580518245&w=2

Includes an independent fix from upstream for gcc6, currently unlinked
from builds

Also, stop installing libssp as it broken on OpenBSD as it tries to use gets()

pirofti@@ ok'd an earlier version, suggestions from sthen@@
"doesn't look dangerous" espie@@
"pretty astounding" deraadt@@
@
text
@# $OpenBSD: Makefile,v 1.47 2017/03/04 21:59:55 sthen Exp $

ONLY_FOR_ARCHS = amd64 arm hppa i386 mips64 mips64el powerpc sparc64
DPB_PROPERTIES = parallel

V = 4.9.4
REVISION = 5
FULL_VERSION = $V
FULL_PKGVERSION = $V

ADASTRAP_LIBC-amd64 = 89.2
ADASTRAP_LIBM-amd64 = 10.0
ADASTRAP-amd64 = adastrap-amd64-$V-1.tar.xz
ADASTRAP_LIBC-arm = 88.0
ADASTRAP_LIBM-arm = 9.0
ADASTRAP-arm = adastrap-arm-$V-0.tar.xz
ADASTRAP_LIBC-hppa = 89.2
ADASTRAP_LIBM-hppa = 10.0
ADASTRAP-hppa = adastrap-hppa-$V-0.tar.xz
ADASTRAP_LIBC-i386 = 89.2
ADASTRAP_LIBM-i386 = 10.0
ADASTRAP-i386 = adastrap-i386-$V-1.tar.xz
ADASTRAP_LIBC-mips64 = 89.2
ADASTRAP_LIBM-mips64 = 10.0
ADASTRAP-mips64 = adastrap-mips64-$V-1.tar.xz
ADASTRAP_LIBC-powerpc = 89.2
ADASTRAP_LIBM-powerpc = 10.0
ADASTRAP-powerpc = adastrap-powerpc-$V-1.tar.xz
ADASTRAP_LIBC-sparc64 = 89.2
ADASTRAP_LIBM-sparc64 = 10.0
ADASTRAP-sparc64 = adastrap-sparc64-$V-1.tar.xz

PKGNAME-main =  gcc-${FULL_PKGVERSION}
PKGNAME-libs =	gcc-libs-${FULL_PKGVERSION}
PKGNAME-c++ =   g++-${FULL_PKGVERSION}
PKGNAME-f95 =   g95-${FULL_PKGVERSION}
PKGNAME-java =  gcj-${FULL_PKGVERSION}
PKGNAME-objc =  gobjc-${FULL_PKGVERSION}
PKGNAME-ada =   gnat-${FULL_PKGVERSION}
PKGSPEC-main = gcc->=4.9,<4.10

SHARED_LIBS =	estdc++		17.1 \
		gfortran	6.1 \
		gcj		4.1 \
		gcj-tools	4.0 \
		gij		4.1 \
		objc		6.1 \
		lto_plugin      3.1 \
		go		3.0 \
		itm		2.1 \
		atomic		1.1 \
		quadmath	1.1 \
		cilkrts		0.1

PSEUDO_FLAVORS = no_java no_ada full
FLAVOR ?= 

ONLY_FOR_ARCHS-ada = amd64 hppa i386 mips64 powerpc sparc64
ONLY_FOR_ARCHS-java = amd64 i386 sparc64

MULTI_PACKAGES = -main -libs -f95 -objc -c++ -java -ada

MAINTAINER =	Pascal Stumpf <pascal@@stumpf.co>

.include <bsd.port.arch.mk>

DISTNAME =   	gcc-${FULL_VERSION}
DISTFILES =	${DISTNAME}.tar.bz2
# there's no ecj-4.9.jar
ECJ =		ecj-4.5.jar
SUPDISTFILES =	${ADASTRAP-amd64}:0 ${ADASTRAP-arm}:0 ${ADASTRAP-hppa}:0 \
		${ADASTRAP-i386}:0 ${ADASTRAP-mips64}:0 ${ADASTRAP-powerpc}:0 \
		${ADASTRAP-sparc64}:0 ${ECJ}:1
EXTRACT_ONLY =	${DISTNAME}.tar.bz2

BUILD_DEPENDS +=	devel/bison \
			devel/libexecinfo

.if ${MACHINE_ARCH} == "mips64" || ${MACHINE_ARCH} == "mips64el"
BUILD_DEPENDS +=	textproc/gsed
.endif

TEST_DEPENDS = 	devel/dejagnu \
		devel/autogen \
		${BUILD_PKGPATH},-libs>=4.9,<4.10

MASTER_SITES =	${MASTER_SITE_GCC:=releases/gcc-$(FULL_VERSION)/}
MASTER_SITES0 =	https://distfiles.stumpf.co/ \
		https://spacehopper.org/mirrors/ \
		http://distfiles.tmux.org/adastrap/ \
		https://distfiles.bsdfrog.org/
MASTER_SITES1 =	ftp://sources.redhat.com/pub/java/

LANGS = c,c++,fortran,objc
.if ${BUILD_PACKAGES:M-java}
LANGS := ${LANGS},java
DISTFILES +=		${ECJ}:1
BUILD_DEPENDS +=	archivers/zip>=2.3p0
CONFIGURE_ARGS +=	--enable-libgcj --without-jar
.endif
.if ${BUILD_PACKAGES:M-ada}
LANGS := ${LANGS},ada
DISTFILES += ${ADASTRAP-${MACHINE_ARCH}}:0
EXTRACT_ONLY += ${ADASTRAP-${MACHINE_ARCH}}
EXTRA_ENV += ADAC=${WRKDIR}/bin/egcc GNATBIND=${WRKDIR}/bin/gnatbind
CC = ${WRKDIR}/bin/egcc
CXX = ${WRKDIR}/bin/eg++
TEST_DEPENDS += ${BUILD_PKGPATH},-ada
.endif

CONFIGURE_STYLE =		gnu
MODGNU_CONFIG_GUESS_DIRS =	${WRKSRC} ${WRKSRC}/gcc

EXTRA_ENV += am_cv_func_iconv=no JAR=no
EXTRA_ENV += ac_cv_prog_M4=/usr/bin/m4
EXTRA_ENV += ac_cv_header_magic_h=no
EXTRA_ENV += lt_cv_path_SED=/usr/bin/sed
EXTRA_ENV += STRIP=/usr/bin/strip
MAKE_FLAGS +=	 ac_cv_path_mkdir=/bin/mkdir

CONFIGURE_ENV += ${EXTRA_ENV}
MAKE_ENV += ${EXTRA_ENV}

# Note: the configure target passes CFLAGS to the configure script anyways.

CFLAGS = -O2 -g

CONFIGURE_ARGS += \
	--verbose \
	--program-transform-name=s,^,e, \
	--disable-nls  \
	--with-system-zlib \
	--disable-libmudflap \
	--disable-libgomp \
	--disable-tls \
	--with-gnu-ld \
	--with-gnu-as \
	--enable-threads=posix \
	--enable-wchar_t \
	--with-gmp="${LOCALBASE}" \
	--enable-languages=${LANGS} \
	--disable-libstdcxx-pch

# This is needed, as internal cpp is no longer compatible with the
# visible beast
CONFIGURE_ARGS += --enable-cpp


SEPARATE_BUILD = flavored

USE_GMAKE = yes

.if ${FLAVOR:Mfull}
# you shouldn't skip bootstrap unless you know what you're doing
# use bootstrap-lean if you're pressed for space
ALL_TARGET = bootstrap
.else
# skip the stage2/stage3 bullshit under normal circumstances
ALL_TARGET = bootstrap2
.endif

MAKE_FLAGS += libstdc___la_LDFLAGS='-version-info 31:0:0 -lm'

.for _a in ${ONLY_FOR_ARCHS}
PKG_ARGS += -D${_a}=0
.endfor

PKG_ARGS += -D${MACHINE_ARCH}=1

.if ${MACHINE_ARCH} == "i386" || ${MACHINE_ARCH} == "amd64"
PKG_ARGS += -DX86=1
.else
PKG_ARGS += -DX86=0
.endif

.if ${MACHINE_ARCH} == "alpha" || ${MACHINE_ARCH} == "arm" || \
	${MACHINE_ARCH} == "amd64" || ${MACHINE_ARCH} == "i386" || \
	${MACHINE_ARCH} == "powerpc" || ${MACHINE_ARCH} == "sh" || \
	${MACHINE_ARCH} == "sparc64"
PKG_ARGS += -DITM=1
.else
PKG_ARGS += -DITM=0
.endif

# depends on __float128
.if ${MACHINE_ARCH} == "amd64" || ${MACHINE_ARCH} == "i386"
PKG_ARGS += -DQUADMATH=1
.else
PKG_ARGS +=-DQUADMATH=0
.endif

.if ${MACHINE_ARCH} == "amd64" || ${MACHINE_ARCH} == "i386"
PKG_ARGS += -DCILKRTS=1
.else
PKG_ARGS += -DCILKRTS=0
.endif

RUN_DEPENDS =		${BUILD_PKGPATH},-main
WANTLIB =		c gmp m mpc mpfr z

RUN_DEPENDS-main =	${BUILD_PKGPATH},-libs
RUN_DEPENDS-libs =

WANTLIB-java =		${WANTLIB} pthread
WANTLIB-main =		${WANTLIB}
WANTLIB-ada =		${WANTLIB} pthread util
WANTLIB-libs =		m pthread

LIB_DEPENDS +=		devel/gmp>=6.1.1 \
			devel/mpfr \
			devel/libmpc
LIB_DEPENDS-libs =

.if ${MACHINE_ARCH:Mamd64}
CONFIG = x86_64-unknown-openbsd${OSREV}
.endif

post-extract:
.for f in egcc eg++
	echo "#! /bin/sh" >${WRKDIR}/bin/$f
	echo 'GNAT_ROOT=${WRKDIR}/bootstrap GCC_ROOT=${WRKDIR}/bootstrap LD_LIBRARY_PATH=${WRKDIR}/bootstrap/system-libs exec ${WRKDIR}/bootstrap/bin/$f "$$@@"' >>${WRKDIR}/bin/$f
	chmod a+x ${WRKDIR}/bin/$f
.endfor
.for f in gnatbind gnatmake gnatlink
	echo "#! /bin/sh" >${WRKDIR}/bin/$f
	echo 'GNAT_ROOT=${WRKDIR}/bootstrap GCC_ROOT=${WRKDIR}/bootstrap LD_LIBRARY_PATH=${WRKDIR}/bootstrap/system-libs exec ${WRKDIR}/bootstrap/bin/$f "$$@@"' >>${WRKDIR}/bin/$f
	chmod a+x ${WRKDIR}/bin/$f
.endfor
	rm -rf ${WRKDIR}/bootstrap/lib/gcc/*-unknown-openbsd*/$V/include-fixed
	ln -sf /usr/bin/nm ${WRKDIR}/bin/enm
	echo "# This file automatically generated" >> ${WRKSRC}/libversions
.for l v in ${SHARED_LIBS}
	echo "LIB$l_LTVERSION = -version-info ${v:S/./:/}" >> \
		${WRKSRC}/libversions
.endfor
.if ${BUILD_PACKAGES:M-java}
	cp ${FULLDISTDIR}/${ECJ} ${WRKSRC}/ecj.jar
.endif
.if ${BUILD_PACKAGES:M-ada}
	perl -pi -e 's,^#define (_GLIBCXX_HAVE_GETS) .*,/* #undef $$1 */,' \
		${WRKDIR}/bootstrap/include/c++/*/*/bits/c++config.h
.endif

post-install:
.if ${BUILD_PACKAGES:M-ada}
	chown -R ${SHAREOWN}:${SHAREGRP} ${PREFIX}/lib/gcc/*/$V/adainclude
	chown -R ${SHAREOWN}:${SHAREGRP} ${PREFIX}/lib/gcc/*/$V/adalib
.endif
.if ${BUILD_PACKAGES:M-f95}
	ln -sf ${TRUEPREFIX}/bin/egfortran ${PREFIX}/bin/gfortran
	ln -sf ${TRUEPREFIX}/bin/${CONFIG}-egfortran ${PREFIX}/bin/${CONFIG}-gfortran
.endif
	chown -R ${SHAREOWN}:${SHAREGRP} ${PREFIX}/lib/gcc/*/$V/include
	chown -R ${SHAREOWN}:${SHAREGRP} ${PREFIX}/lib/gcc/*/$V/include-fixed
	chown ${BINOWN}:${BINGRP} ${PREFIX}/lib/gcc/${CONFIG}/${V}/libgcc.a
	chown ${BINOWN}:${BINGRP} ${PREFIX}/lib/gcc/${CONFIG}/${V}/libgcov.a

.include <bsd.port.mk>

ADA_PACKAGE = ${PACKAGE_REPOSITORY}/${MACHINE_ARCH}/all/${FULLPKGNAME-ada}.tgz
GCC_PACKAGE = ${PACKAGE_REPOSITORY}/${MACHINE_ARCH}/all/${FULLPKGNAME-main}.tgz
GXX_PACKAGE = ${PACKAGE_REPOSITORY}/${MACHINE_ARCH}/all/${FULLPKGNAME-c++}.tgz

adastrap: ${ADA_PACKAGE} ${GCC_PACKAGE} ${GXX_PACKAGE}
.if !defined(ADASTRAP_LIBC-${MACHINE_ARCH}) || \
	!defined(ADASTRAP_LIBM-${MACHINE_ARCH})
	@@echo 1>&2 "Error: you must specify libc and libm to bundle"
	@@exit 1
.else
	mkdir -p ${WRKDIR}/prepare/bootstrap/system-libs
	cp /usr/lib/libc.so.${ADASTRAP_LIBC-${MACHINE_ARCH}} \
		${WRKDIR}/prepare/bootstrap/system-libs
	cp /usr/lib/libm.so.${ADASTRAP_LIBM-${MACHINE_ARCH}} \
		${WRKDIR}/prepare/bootstrap/system-libs
	cd ${WRKDIR}/prepare/bootstrap && tar zxf ${ADA_PACKAGE}
	cd ${WRKDIR}/prepare/bootstrap && tar zxf ${GCC_PACKAGE}
	cd ${WRKDIR}/prepare/bootstrap && tar zxf ${GXX_PACKAGE}
	rm -rf ${WRKDIR}/prepare/bootstrap/{+*,info,man,share}
	rm -rf ${WRKDIR}/prepare/bootstrap/lib/gcc/*-unknown-openbsd*/$V/include-fixed
	if ! ldd ${WRKDIR}/prepare/bootstrap/bin/egcc | \
		fgrep libc.so.${ADASTRAP_LIBC-${MACHINE_ARCH}} >/dev/null; then \
		echo 1>&2 "Error: adastrap egcc linked against unbundled libc"; \
		exit 1; \
	fi
	if ! ldd ${WRKDIR}/prepare/bootstrap/bin/egcc | \
		fgrep libm.so.${ADASTRAP_LIBM-${MACHINE_ARCH}} >/dev/null; then \
		echo 1>&2 "Error: adastrap egcc linked against unbundled libm"; \
		exit 1; \
	fi
	cd ${WRKDIR}/prepare && tar cf - bootstrap | \
		xz > ${FULLDISTDIR}/${ADASTRAP-${MACHINE_ARCH}}
.endif

@


1.47
log
@bump ports with openbsd version number in filenames
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.46 2017/01/02 15:52:20 pascal Exp $
d7 1
a7 1
REVISION = 4
d42 3
a44 3
SHARED_LIBS =	estdc++		17.0 \
		gfortran	6.0 \
		gcj		4.0 \
d46 3
a48 4
		gij		4.0 \
		objc		6.0 \
		ssp		4.0 \
		lto_plugin      3.0 \
d50 4
a53 4
		itm		2.0 \
		atomic		1.0 \
		quadmath	1.0 \
		cilkrts		0.0
@


1.46
log
@Regen bootstraps and re-enable ada for hppa, mips64, powerpc and sparc64.
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.45 2016/11/15 10:04:58 sthen Exp $
d7 1
a7 1
REVISION = 3
@


1.45
log
@bump LIB_DEPENDS for adastrap/gmp update
from tobiasu, ok dcoppa (+ REVISION bump from me)
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.44 2016/11/11 20:13:43 naddy Exp $
d17 3
a19 3
ADASTRAP_LIBC-hppa = 80.0
ADASTRAP_LIBM-hppa = 9.0
ADASTRAP-hppa = adastrap-hppa-4.9.3-0.tar.xz
d25 7
a31 7
ADASTRAP-mips64 = adastrap-mips64-$V-0.tar.xz
ADASTRAP_LIBC-powerpc = 88.0
ADASTRAP_LIBM-powerpc = 9.0
ADASTRAP-powerpc = adastrap-powerpc-$V-0.tar.xz
ADASTRAP_LIBC-sparc64 = 88.0
ADASTRAP_LIBM-sparc64 = 9.0
ADASTRAP-sparc64 = adastrap-sparc64-$V-0.tar.xz
d59 1
a59 1
ONLY_FOR_ARCHS-ada = amd64 i386
d89 1
a89 1
MASTER_SITES0 =	http://distfiles.stumpf.co/ \
@


1.44
log
@pascal@@ suggests to disable Ada on various archs until new bootstraps
are available
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.43 2016/11/11 19:43:17 naddy Exp $
d7 1
a7 1
REVISION = 2
d210 1
a210 1
LIB_DEPENDS +=		devel/gmp>=4.2 \
@


1.43
log
@new Ada bootstraps on amd64 and i386; required for gmp and mpfr update
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.42 2016/10/19 01:07:32 visa Exp $
d59 1
a59 1
ONLY_FOR_ARCHS-ada = amd64 hppa i386 mips64 powerpc sparc64
@


1.42
log
@regen mips64 adastrap

ok pascal@@
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.41 2016/09/18 15:05:15 pascal Exp $
d11 3
a13 3
ADASTRAP_LIBC-amd64 = 88.0
ADASTRAP_LIBM-amd64 = 9.0
ADASTRAP-amd64 = adastrap-amd64-$V-0.tar.xz
d20 3
a22 3
ADASTRAP_LIBC-i386 = 89.0
ADASTRAP_LIBM-i386 = 9.0
ADASTRAP-i386 = adastrap-i386-$V-0.tar.xz
@


1.41
log
@Bump default -march for ARM to pcore (armv6k), but disallow unaligned access.
Required to build clang.

prompted by patrick@@/kettenis@@
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.40 2016/09/15 10:22:10 pascal Exp $
d23 3
a25 3
ADASTRAP_LIBC-mips64 = 83.0
ADASTRAP_LIBM-mips64 = 9.0
ADASTRAP-mips64 = adastrap-mips64-4.9.3-0.tar.xz
@


1.40
log
@Convert to arm EABI.  Drop ada support for now until someone re-bootstraps it.
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.39 2016/09/12 09:37:09 pascal Exp $
d7 1
a7 1
REVISION = 1
@


1.39
log
@regen ppc adastrap
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.38 2016/09/06 10:14:24 pascal Exp $
d7 1
a7 1
REVISION = 0
d59 1
a59 1
ONLY_FOR_ARCHS-ada = amd64 arm hppa i386 mips64 powerpc sparc64
@


1.38
log
@regen i386 bootstrap
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.37 2016/09/02 12:14:06 dcoppa Exp $
d26 1
a26 1
ADASTRAP_LIBC-powerpc = 83.0
d28 1
a28 1
ADASTRAP-powerpc = adastrap-powerpc-4.9.3-0.tar.xz
@


1.37
log
@
Add a "bin/gfortran" symlink pointing to "bin/egfortran"

OK pascal@@ (maintainer)
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.36 2016/09/01 17:30:33 pascal Exp $
d20 1
a20 1
ADASTRAP_LIBC-i386 = 80.0
d22 1
a22 1
ADASTRAP-i386 = adastrap-i386-4.9.3-0.tar.xz
@


1.36
log
@Update to GCC 4.9.4.

No fallout in naddy@@'s bulk.
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.35 2016/09/01 10:56:58 jasper Exp $
d7 1
d249 4
@


1.35
log
@retire sparc support and sync distinfo accordingly
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.34 2016/08/21 21:01:03 sthen Exp $
d6 1
a6 2
V = 4.9.3
REVISION = 10
d10 1
a10 1
ADASTRAP_LIBC-amd64 = 80.0
d13 1
a13 1
ADASTRAP_LIBC-arm = 84.1
d18 1
a18 1
ADASTRAP-hppa = adastrap-hppa-$V-0.tar.xz
d21 1
a21 1
ADASTRAP-i386 = adastrap-i386-$V-0.tar.xz
d24 1
a24 1
ADASTRAP-mips64 = adastrap-mips64-$V-0.tar.xz
d27 2
a28 2
ADASTRAP-powerpc = adastrap-powerpc-$V-0.tar.xz
ADASTRAP_LIBC-sparc64 = 80.0
d88 2
a89 1
MASTER_SITES0 =	https://spacehopper.org/mirrors/ \
@


1.34
log
@Don't hardcode path to "ld" in ports gcc, allowing USE_WXNEEDED to override
"ld" with a wrapper script. Do the same for "as" for consistency as suggested
by naddy. Various versions of this OK'd by dcoppa and pascal.
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.33 2016/07/14 07:22:31 tobiasu Exp $
d3 1
a3 1
ONLY_FOR_ARCHS = amd64 arm hppa i386 mips64 mips64el powerpc sparc sparc64
a28 3
ADASTRAP_LIBC-sparc = 83.0
ADASTRAP_LIBM-sparc = 9.0
ADASTRAP-sparc = adastrap-sparc-$V-0.tar.xz
d59 1
a59 1
ONLY_FOR_ARCHS-ada = amd64 arm hppa i386 mips64 powerpc sparc sparc64
d74 1
a74 1
		${ADASTRAP-sparc}:0 ${ADASTRAP-sparc64}:0 ${ECJ}:1
d179 1
a179 1
	${MACHINE_ARCH} == "sparc" || ${MACHINE_ARCH} == "sparc64"
@


1.33
log
@Sync startfile spec, fixes egcc -static to link against rcrt0

ok stefan@@ pascal@@ naddy@@
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.32 2016/06/29 16:14:41 espie Exp $
d7 1
a7 1
REVISION = 9
a138 2
	--with-as=/usr/bin/as \
	--with-ld=/usr/bin/ld \
@


1.32
log
@add is-branch to all trivial ports that exist as multiple branches.
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.31 2016/05/28 16:06:14 sthen Exp $
d7 1
a7 2
REVISION = 7
REVISION-java = 8
@


1.31
log
@Apply the libffi patch to avoid PROT_WRITE | PROT_EXEC mappings to the
copy of libffi in lang/gcc/4.9. Bump -java REVISION (this is only used for
java and gccgo, and we don't build gccgo).  ok jca@@ pascal@@
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.30 2016/05/12 01:17:13 naddy Exp $
d7 2
a8 2
REVISION = 6
REVISION-java = 7
@


1.30
log
@bump for plist changes 5.9 -> 6.0
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.29 2016/05/07 12:40:57 pascal Exp $
d8 1
@


1.29
log
@Update my mail address.
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.28 2016/03/24 13:16:32 jsg Exp $
d7 1
a7 1
REVISION = 5
@


1.28
log
@Change the default gcc arm arch target from strongarm (armv4) to
arm9e (armv5te w/o xscale extensions).  We no longer support anything
less than armv5te and this allows some additional instructions.

-mthumb-interwork remains off by default.

Same change made to base gcc works here as well.

ok pascal@@
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.27 2016/03/11 19:59:15 naddy Exp $
d7 1
a7 1
REVISION = 4
d67 1
a67 1
MAINTAINER =	Pascal Stumpf <Pascal.Stumpf@@cubes.de>
@


1.27
log
@garbage collect CONFIGURE_SHARED
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.26 2015/12/20 00:16:27 naddy Exp $
d7 1
a7 1
REVISION = 3
@


1.26
log
@bump for plist changes 5.8 -> 5.9
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.25 2015/12/05 22:00:29 tobiasu Exp $
a152 1
CONFIGURE_ARGS += ${CONFIGURE_SHARED}
@


1.25
log
@Finally activate ARM support in gcc 4.9, includes Ada of course..

Remember to update binutils first

ok pascal
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.24 2015/12/03 21:24:30 sthen Exp $
d7 1
a7 1
REVISION = 2
@


1.24
log
@switch my distfiles mirror to https
@
text
@d1 1
a1 3
# $OpenBSD: Makefile,v 1.23 2015/09/24 22:29:58 tobiasu Exp $

BROKEN-arm = needs binutils-2.17
d14 3
d62 1
a62 1
ONLY_FOR_ARCHS-ada = amd64 hppa i386 mips64 powerpc sparc sparc64
d75 3
a77 3
SUPDISTFILES =	${ADASTRAP-amd64}:0 ${ADASTRAP-hppa}:0 ${ADASTRAP-i386}:0 \
		${ADASTRAP-mips64}:0 ${ADASTRAP-powerpc}:0 ${ADASTRAP-sparc}:0 \
		${ADASTRAP-sparc64}:0 ${ECJ}:1
@


1.23
log
@Ada support for mips64, powerpc and sparc

- mips64el bits included, need access to bootstrap machine
- sync system-openbsd-*.ads, remove obsolete stuff

Building on sparc requires a recent (21/09) kernel
Tested on hppa mips64 powerpc sparc and sparc64

ok pascal@@
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.22 2015/09/24 08:51:48 sthen Exp $
d91 1
a91 1
MASTER_SITES0 =	http://spacehopper.org/mirrors/ \
@


1.22
log
@Move gcc's .la files into the gcc-libs package, they are required for linking.
Build problem noticed with epiphany which doesn't itself need gcc4 but uses
libraries which do.  ok ajacoutot@@ pascal@@
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.21 2015/09/16 10:59:25 pascal Exp $
d13 6
d22 9
a30 3
ADASTRAP_LIBC-amd64 = 80.0
ADASTRAP_LIBM-amd64 = 9.0
ADASTRAP-amd64 = adastrap-amd64-$V-0.tar.xz
a33 3
ADASTRAP_LIBC-hppa = 80.0
ADASTRAP_LIBM-hppa = 9.0
ADASTRAP-hppa = adastrap-hppa-$V-0.tar.xz
d61 1
a61 1
ONLY_FOR_ARCHS-ada = amd64 i386 sparc64 hppa
d74 3
a76 2
SUPDISTFILES =	${ADASTRAP-amd64}:0 ${ADASTRAP-i386}:0 ${ECJ}:1 \
		${ADASTRAP-sparc64}:0 ${ADASTRAP-hppa}:0
@


1.21
log
@Enable secure PLT by default on PowerPC in ports GCC.
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.20 2015/09/11 08:07:44 pascal Exp $
d9 1
a9 1
REVISION = 1
@


1.20
log
@Let's unlock some more ports failures on obscure architectures.

mips64(el) support for gcc 4.9.  Thanks to kettenis@@ for fixing binutils bugs!
no ada support yet though, sorry.
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.19 2015/09/09 16:05:29 pascal Exp $
d9 1
a9 1
REVISION = 0
@


1.19
log
@Clean up PSEUDO_FLAVORS: c++ hasn't been optional in a long time, objc and
fortran are required since the gcc-libs conversion (and don't need much time
to build anyway).  Finally, go will never be supported in 4.9.

prompted by sthen@@ a while ago
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.18 2015/08/18 10:16:55 sthen Exp $
d5 1
a5 1
ONLY_FOR_ARCHS = amd64 arm hppa i386 powerpc sparc sparc64
d71 4
@


1.18
log
@add a comment pointing out that NO_xx flavours are broken, to avoid people
trying to do a quick build by disabling things they don't need, only to have
it fail when packaging -libs
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.17 2015/08/06 18:38:34 sthen Exp $
a32 2
# needs [gs]etcontext
#PKGNAME-go =	gccgo-${FULL_PKGVERSION}
d49 1
a49 4
# XXX the BUILD_PACKAGES / PSEUDO_FLAVORS setup is broken because
# XXX the no_* flavours disable building files which are included in
# XXX the common -libs package.
PSEUDO_FLAVORS = no_c++ no_f95 no_objc no_java no_ada no_go full
a60 5
# kill both C++ subpackages
.if !${BUILD_PACKAGES:M-c++}
BUILD_PACKAGES := ${BUILD_PACKAGES:N-estdc}
.endif

d73 2
a74 1
		devel/autogen
d82 1
a82 11
LANGS = c
.if ${BUILD_PACKAGES:M-c++}
LANGS := ${LANGS},c++
TEST_DEPENDS += 	${BUILD_PKGPATH},-libs>=4.9,<4.10
.endif
.if ${BUILD_PACKAGES:M-f95}
LANGS := ${LANGS},fortran
.endif
.if ${BUILD_PACKAGES:M-objc}
LANGS := ${LANGS},objc
.endif
a97 3
#.if ${BUILD_PACKAGES:M-go}
#LANGS := ${LANGS},go
#.endif
@


1.17
log
@Disable code added in GCC 4.9.3 which passes ".machine ppc" to the assembler;
this breaks builds when -maltivec is used, including Mozilla ports.

Borrowed from a commit to the Amiga development tools project,
https://github.com/sba1/adtools/commit/b24ae065714a2390d7718d2c348fe5cfa40c2b48

ok landry@@ mpi@@ naddy@@
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.16 2015/07/19 21:22:49 pascal Exp $
d51 3
a53 1

@


1.16
log
@Bugfix update to 4.9.3.
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.15 2015/07/02 00:22:18 zhuk Exp $
d9 1
@


1.15
log
@Remove extra @@pkgpath markers. They were relevant for GCC 4.2, which was not
MULTI_PACKAGEd initially, but not for later ones.

Feedback and 4.9 part okay from sthen@@.
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.14 2015/06/17 20:03:11 sthen Exp $
d8 1
a8 1
V = 4.9.2
d12 1
a12 1
ADASTRAP_LIBC-i386 = 78.1
d14 2
a15 2
ADASTRAP-i386 = adastrap-i386-$V-1.tar.xz
ADASTRAP_LIBC-amd64 = 78.1
d17 2
a18 2
ADASTRAP-amd64 = adastrap-amd64-$V-1.tar.xz
ADASTRAP_LIBC-sparc64 = 78.1
d20 2
a21 2
ADASTRAP-sparc64 = adastrap-sparc64-$V-1.tar.xz
ADASTRAP_LIBC-hppa = 78.1
d23 1
a23 1
ADASTRAP-hppa = adastrap-hppa-$V-1.tar.xz
a34 8

REVISION-main =	5
REVISION-libs =	2
REVISION-c++ =	2
REVISION-f95 =	2
REVISION-java =	3
REVISION-objc =	2
REVISION-ada =	3
@


1.14
log
@port REVISION bumps as base has moved to 5.8
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.13 2015/05/22 11:31:16 ajacoutot Exp $
d36 1
a36 1
REVISION-main =	4
@


1.13
log
@"/usr/local/lib/pkgconfig/" is part of mtree(8).
Packages should not own this dir to prevent its deletion or a warning that it
cannot be removed because it's not empty at pkg_delete(1) time.
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.12 2015/02/17 12:04:44 tobiasu Exp $
d36 7
a42 7
REVISION-main =	3
REVISION-libs =	1
REVISION-c++ =	1
REVISION-f95 =	1
REVISION-java =	2
REVISION-objc =	1
REVISION-ada =	2
@


1.12
log
@Add memcpy() workaround and reenable Ada support
Rename all egnat* binaries back to gnat*, sync with 4.8
Add hppa Ada support
Delete debug patch for a linker issue solved some time ago

funktioniert pascal@@
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.11 2015/02/10 22:04:54 brad Exp $
d40 1
a40 1
REVISION-java =	1
@


1.11
log
@Copy over from 4.8.. Stop running the fixincludes script.

ok pascal@@
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.10 2015/02/03 20:32:12 pascal Exp $
d12 1
a12 1
ADASTRAP_LIBC-i386 = 77.2
d14 2
a15 2
ADASTRAP-i386 = adastrap-i386-$V-0.tar.xz
ADASTRAP_LIBC-amd64 = 77.2
d17 2
a18 2
ADASTRAP-amd64 = adastrap-amd64-$V-0.tar.xz
ADASTRAP_LIBC-sparc64 = 77.2
d20 4
a23 1
ADASTRAP-sparc64 = adastrap-sparc64-$V-0.tar.xz
d36 1
a36 1
REVISION-main =	2
d42 1
a42 1
REVISION-ada =	1
d62 1
a62 2
# XXX broken with memcpy that checks for overlap
ONLY_FOR_ARCHS-ada = #amd64 i386 sparc64
d81 1
a81 1
		${ADASTRAP-sparc64}:0
d244 1
a244 1
	echo 'GNAT_ROOT=${WRKDIR}/bootstrap GCC_ROOT=${WRKDIR}/bootstrap LD_LIBRARY_PATH=${WRKDIR}/bootstrap/system-libs exec ${WRKDIR}/bootstrap/bin/e$f "$$@@"' >>${WRKDIR}/bin/$f
@


1.10
log
@Finally fix newer GCC on hppa by removing --disable-checking from
CONFIGURE_ARGS.  While it may have had some value in the past, nowadays it's
just another (essentially untested) deviation from the mainstream.

Also:
* Restore -fstrict-aliasing and -fstrict-overflow behaviour
* Support -rdynamic on hppa
* libatomic is actually supported on every POSIX system, so remove useless
  PFRAGs.

Tested on amd64, hppa and sparc64; ok tobiasu@@
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.9 2015/01/02 14:26:12 sthen Exp $
d33 1
a33 1
REVISION-main =	1
@


1.9
log
@bump REVISION for 5.7
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.8 2014/11/27 17:23:08 naddy Exp $
d5 1
a5 1
ONLY_FOR_ARCHS = amd64 arm i386 powerpc sparc sparc64
d33 7
a39 1
REVISION =	0
a144 1
	--disable-checking \
a198 9
.endif

.if ${MACHINE_ARCH} == "alpha" || ${MACHINE_ARCH} == "arm" || \
	${MACHINE_ARCH} == "amd64" || ${MACHINE_ARCH} == "i386" || \
	${MACHINE_ARCH} == "powerpc" || ${MACHINE_ARCH} == "sh" || \
	${MACHINE_ARCH} == "sparc" || ${MACHINE_ARCH} == "sparc64"
PKG_ARGS += -DATOMIC=1
.else
PKG_ARGS += -DATOMIC=0
@


1.8
log
@temporarily disable Ada: it is broken with a strict memcpy that
checks for overlap; ok pascal@@
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.7 2014/11/20 19:54:40 pascal Exp $
d32 2
@


1.7
log
@Update to 4.9.2.  Finally gets rid of gfortran patches.

Tested on everything except sparc, adastraps mirrored by and ok tobiasu@@
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.6 2014/11/12 10:56:59 tobiasu Exp $
d51 2
a52 1
ONLY_FOR_ARCHS-ada = amd64 i386 sparc64
@


1.6
log
@Add ARM support to gcc 4.9

Marked broken because it uses instructions the default binutils don't
understand. The port itself seems to work.

I will probably post the update instructions to arm@@ for those that are
interested in playing with this.

ok pascal@@ a long time ago
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.5 2014/08/25 09:57:04 tobiasu Exp $
d5 1
a5 1
ONLY_FOR_ARCHS = amd64 i386 powerpc sparc sparc64 arm
d8 1
a8 1
V = 4.9.1
d12 1
a12 1
ADASTRAP_LIBC-i386 = 77.0
d15 1
a15 1
ADASTRAP_LIBC-amd64 = 77.0
d18 1
a18 1
ADASTRAP_LIBC-sparc64 = 77.0
@


1.5
log
@Add sparc backend to gcc 4.9.1

Build time: 3.5 days @@ 150MHz
I do take 200MHz HyperSPARC and memory donations :-)

OK pascal@@
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.4 2014/08/18 07:42:11 pascal Exp $
d3 3
a5 1
ONLY_FOR_ARCHS = amd64 i386 powerpc sparc sparc64
@


1.4
log
@Update to GCC 4.9.1 + fix for CVE-2014-5044.  As usual, sparc64 adastrap
generated by tobiasu@@, thanks!
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.22 2013/11/25 14:16:23 sthen Exp $
d3 1
a3 1
ONLY_FOR_ARCHS = amd64 i386 powerpc sparc64
@


1.3
log
@more 5.6 bumps
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.2 2014/06/26 21:01:37 sthen Exp $
d6 1
a6 1
V = 4.9.0
d10 1
a10 1
ADASTRAP_LIBC-i386 = 75.0
d13 1
a13 1
ADASTRAP_LIBC-amd64 = 75.0
d16 1
a16 1
ADASTRAP_LIBC-sparc64 = 76.0
a29 7
REVISION-main = 0
REVISION-libs = 0
REVISION-c++ = 0
REVISION-f95 = 0
REVISION-java = 0
REVISION-objc = 0
REVISION-ada = 0
d63 1
a63 1
DISTNAME =	gcc-${FULL_VERSION}
d74 1
a74 1
TEST_DEPENDS =	devel/dejagnu \
@


1.2
log
@whitespace commit, test cvsync
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.1.1.1 2014/06/26 16:30:15 pascal Exp $
d30 7
@


1.1
log
@Initial revision
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.22 2013/11/25 14:16:23 sthen Exp $
d63 1
a63 1
DISTNAME =   	gcc-${FULL_VERSION}
d74 1
a74 1
TEST_DEPENDS = 	devel/dejagnu \
@


1.1.1.1
log
@Import GCC 4.9, sparc64 test and ok tobiasu@@
@
text
@@
