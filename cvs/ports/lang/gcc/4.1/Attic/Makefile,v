head	1.24;
access;
symbols
	OPENBSD_5_1_BASE:1.22
	OPENBSD_5_1:1.22.0.4
	OPENBSD_5_0:1.22.0.2
	OPENBSD_5_0_BASE:1.22
	OPENBSD_4_9:1.21.0.2
	OPENBSD_4_9_BASE:1.21
	OPENBSD_4_8:1.19.0.8
	OPENBSD_4_8_BASE:1.19
	OPENBSD_4_7:1.19.0.6
	OPENBSD_4_7_BASE:1.19
	OPENBSD_4_6:1.19.0.4
	OPENBSD_4_6_BASE:1.19
	OPENBSD_4_5:1.19.0.2
	OPENBSD_4_5_BASE:1.19
	OPENBSD_4_4:1.18.0.4
	OPENBSD_4_4_BASE:1.18
	OPENBSD_4_3:1.18.0.2
	OPENBSD_4_3_BASE:1.18
	OPENBSD_4_2:1.16.0.2
	OPENBSD_4_2_BASE:1.16
	OPENBSD_4_1:1.15.0.2
	OPENBSD_4_1_BASE:1.15
	OPENBSD_4_0:1.12.0.2
	OPENBSD_4_0_BASE:1.12
	OPENBSD_3_9:1.10.0.2
	OPENBSD_3_9_BASE:1.10
	OPENBSD_3_8:1.7.0.2
	OPENBSD_3_8_BASE:1.7
	OPENBSD_3_7:1.2.0.2
	OPENBSD_3_7_BASE:1.2
	gcc:1.1.1.1
	FSF:1.1.1;
locks; strict;
comment	@# @;


1.24
date	2012.04.23.15.17.56;	author pascal;	state dead;
branches;
next	1.23;

1.23
date	2012.03.29.13.38.40;	author sthen;	state Exp;
branches;
next	1.22;

1.22
date	2011.03.07.18.59.56;	author ajacoutot;	state Exp;
branches;
next	1.21;

1.21
date	2010.11.28.21.30.37;	author jasper;	state Exp;
branches;
next	1.20;

1.20
date	2010.10.18.19.20.41;	author espie;	state Exp;
branches;
next	1.19;

1.19
date	2008.09.11.19.22.05;	author martynas;	state Exp;
branches;
next	1.18;

1.18
date	2007.12.20.16.11.35;	author ajacoutot;	state Exp;
branches;
next	1.17;

1.17
date	2007.09.16.00.27.05;	author merdely;	state Exp;
branches;
next	1.16;

1.16
date	2007.04.01.16.44.19;	author sturm;	state Exp;
branches;
next	1.15;

1.15
date	2006.11.01.23.57.24;	author naddy;	state Exp;
branches;
next	1.14;

1.14
date	2006.10.20.11.03.38;	author espie;	state Exp;
branches;
next	1.13;

1.13
date	2006.10.06.12.42.42;	author kurt;	state Exp;
branches;
next	1.12;

1.12
date	2006.03.06.16.40.59;	author espie;	state Exp;
branches;
next	1.11;

1.11
date	2006.03.05.22.11.15;	author espie;	state Exp;
branches;
next	1.10;

1.10
date	2006.01.14.11.47.20;	author espie;	state Exp;
branches;
next	1.9;

1.9
date	2005.09.11.22.04.41;	author espie;	state Exp;
branches;
next	1.8;

1.8
date	2005.09.11.07.40.59;	author espie;	state Exp;
branches;
next	1.7;

1.7
date	2005.08.04.14.51.36;	author espie;	state Exp;
branches;
next	1.6;

1.6
date	2005.06.13.19.54.30;	author espie;	state Exp;
branches;
next	1.5;

1.5
date	2005.05.29.13.26.49;	author espie;	state Exp;
branches;
next	1.4;

1.4
date	2005.05.21.10.34.43;	author espie;	state Exp;
branches;
next	1.3;

1.3
date	2005.05.16.11.14.36;	author espie;	state Exp;
branches;
next	1.2;

1.2
date	2005.03.07.16.30.06;	author espie;	state Exp;
branches;
next	1.1;

1.1
date	2005.02.28.15.12.45;	author espie;	state Exp;
branches
	1.1.1.1;
next	;

1.1.1.1
date	2005.02.28.15.12.45;	author espie;	state Exp;
branches;
next	;


desc
@@


1.24
log
@tedu old versions of gcc

ok kurt@@ espie@@ sthen@@
@
text
@# $OpenBSD: Makefile,v 1.23 2012/03/29 13:38:40 sthen Exp $

ONLY_FOR_ARCHS=	alpha i386 m68k sparc sparc64 powerpc vax
#BROKEN=adjust for types changes

V=4.1.1
DATE=20060303
FULL_VERSION=4.1-${DATE}
FULL_PKGVERSION=4.1.${DATE}

PKGNAME-main=	gcc-${FULL_PKGVERSION}
PKGNAME-c++ =	g++-${FULL_PKGVERSION}
PKGNAME-estdc=	libstdc++-${FULL_PKGVERSION}
PKGNAME-g77=	g77-${FULL_PKGVERSION}
PKGNAME-f95=	g95-${FULL_PKGVERSION}
PKGNAME-java=	gcj-${FULL_PKGVERSION}
PKGNAME-objc=	gobjc-${FULL_PKGVERSION}
PKGNAME-ada=	gnat-${FULL_PKGVERSION}
SHARED_LIBS=	estdc++		7.0 \
		gfortran	2.0 \
		-org-w3c-dom	1.0 \
		-org-xml-sax	1.0 \
		gcj		5.0 \
		objc		2.0 \
		objc_gc		2.0 \
		ssp		0.0

REVISION-main=	1
REVISION-c++=	0
REVISION-estdc= 0
REVISION-g77=	0
REVISION-f95=	1
REVISION-java=	0
REVISION-objc=	0
REVISION-ada=	0

MAINTAINER=	Marc Espie <espie@@openbsd.org>
USE_GROFF =	Yes

MAKE_GXX=Yes
MAKE_FORTRAN=Yes
MAKE_OBJC=Yes
#MAKE_JAVA=Yes
.if ${MACHINE_ARCH} == "i386"
MAKE_ADA=Yes
.endif

MAKE_GXX?=No
MAKE_FORTRAN?=No
MAKE_OBJC?=No
MAKE_JAVA?=No
MAKE_ADA?=No


BUILD_DEPENDS+= :autoconf-2.59*:devel/autoconf/2.59
BUILD_DEPENDS+=	devel/metaauto
USE_LIBTOOL=	Yes

SUBPACKAGE?=
WANTLIB=c
.if ${SUBPACKAGE} == "-estdc"
WANTLIB+=m
.endif

.if ${MAKE_JAVA:L} == "yes"
.  if !defined(PACKAGING) || ${SUBPACKAGE} == "-java"
LIB_DEPENDS += devel/boehm-gc
WANTLIB += gc
.  endif
.endif

# This can be patched out, apart from java that wants a pure parser.
BUILD_DEPENDS+= :bison-*:devel/bison


.if ${MAKE_JAVA:L} == "yes"
MAKE_GXX=Yes
.endif

MULTI_PACKAGES=

REGRESS_DEPENDS=devel/dejagnu

# No way around it, java wants a pure parser
.if ${MAKE_JAVA:L} == "yes"
BUILD_DEPENDS+=:bison-*:devel/bison
.endif


DISTNAME=   	gcc-${FULL_VERSION}


DISTFILES=  ${DISTNAME}.tar.bz2
#SUPDISTFILES=adastrap-i386-4.0-20050102-1.tgz:0
SUPDISTFILES=adastrap-i386-3.3.6-4.tgz:0

MASTER_SITES=	${MASTER_SITE_GCC:=snapshots/$(FULL_VERSION)/}
MASTER_SITES0=	ftp://quatramaran.ens.fr/pub/espie/

CONFIGURE_STYLE=	gnu
MODGNU_CONFIG_GUESS_DIRS=	${WRKSRC} ${WRKSRC}/gcc

LANGS=c
.if ${MAKE_GXX:L} == "yes"
LANGS:=${LANGS},c++
MULTI_PACKAGES+=-c++ -estdc
.endif
.if ${MAKE_FORTRAN:L} == "yes"
LANGS:=${LANGS},f95
MULTI_PACKAGES+=-f95
CONFIGURE_ARGS+=--with-gmp=${LOCALBASE}
.endif
.if ${MAKE_OBJC:L} == "yes"
LANGS:=${LANGS},objc
MULTI_PACKAGES+=-objc
.endif
.if ${MAKE_JAVA:L} == "yes"
LANGS:=${LANGS},java
#MULTI_PACKAGES+=-java
CONFIGURE_ARGS+=--enable-java-gc=system-boehm
.endif
.if ${MAKE_ADA:L} == "yes"
LANGS:=${LANGS},ada
MULTI_PACKAGES+=-ada
#DISTFILES+=adastrap-${MACHINE_ARCH}-4.0-20050102-1.tgz:0
DISTFILES+=adastrap-${MACHINE_ARCH}-3.3.6-4.tgz:0
CONFIGURE_ENV=ADAC=${WRKDIR}/bin/egcc GNATBIND=${WRKDIR}/bin/gnatbind
MAKE_ENV=ADAC=${WRKDIR}/bin/egcc GNATBIND=${WRKDIR}/bin/gnatbind
CC=${WRKDIR}/bin/egcc
.endif

post-extract:
.if ${MAKE_ADA:L} == "yes"
.  for f in egcc gnatbind gnatmake gnatlink
	echo "#! /bin/sh" >${WRKDIR}/bin/$f
	echo 'GNAT_ROOT=${WRKDIR}/bootstrap GCC_ROOT=${WRKDIR}/bootstrap exec ${WRKDIR}/bootstrap/bin/$f "$$@@"' >>${WRKDIR}/bin/$f
	chmod a+x ${WRKDIR}/bin/$f
.  endfor
	ln -s /usr/bin/nm ${WRKDIR}/bin/enm
.endif
	echo "# This file automatically generated" >> ${WRKSRC}/libversions
.for l v in ${SHARED_LIBS}
	echo "LIB$l_LTVERSION = -version-info ${v:S/./:/}" >> ${WRKSRC}/libversions
.endfor

CONFIGURE_ENV+=am_cv_func_iconv=no
CONFIGURE_ENV+=ac_cv_prog_CONFIGURED_M4=/usr/bin/m4

# Note: the configure target passes CFLAGS to the configure script anyways.

CFLAGS=-O2 -g


CONFIGURE_ARGS+= \
	--verbose \
	--program-transform-name=s,^,e, \
	--disable-nls  \
	--disable-checking \
	--with-system-zlib \
	--disable-libmudflap \
	--disable-libmudflap \
	--with-as=/usr/bin/as \
	--with-ld=/usr/bin/ld \
	--with-gnu-ld \
	--with-gnu-as \
	--enable-languages=${LANGS}

# This is needed, as internal cpp is no longer compatible with the
# visible beast
CONFIGURE_ARGS+=--enable-cpp

.if ${MAKE_JAVA:L} == "yes"
CONFIGURE_ARGS+=--enable-sjlj-exceptions
.endif


# if you wish to try your luck
#CONFIGURE_ARGS+= --enable-threads=posix

CONFIGURE_ARGS += --with-gnu-as 
CONFIGURE_ARGS += --with-gnu-ld 
CONFIGURE_ARGS += ${CONFIGURE_SHARED}

post-patch:
	cd ${WRKDIST}/libstdc++-v3 && AUTOCONF_VERSION=2.59 autoconf

SEPARATE_BUILD=Yes

USE_GMAKE= yes

# you shouldn't skip bootstrap unless you know what you're doing
# use bootstrap-lean if you're pressed for space
ALL_TARGET=bootstrap

MAKE_FLAGS=libstdc___la_LDFLAGS='-version-info 31:0:0 -lm'


.if ${MACHINE_ARCH} == "m68k" || ${MACHINE_ARCH} == "sparc"
PKG_ARGS+=-DPIC=1
.else
PKG_ARGS+=-DPIC=0
.endif

.if ${MACHINE_ARCH} == "powerpc"
PKG_ARGS+=-DPPC=1
.else
PKG_ARGS+=-DPPC=0
.endif

SUBPACKAGE?=
.if defined(PACKAGING)
.  if !empty(SUBPACKAGE) && ${SUBPACKAGE} != "-estdc"
RUN_DEPENDS+=${PKGPATH}
.  endif
.  if ${SUBPACKAGE} == "-c++"
RUN_DEPENDS+=:gcc-${FULL_PKGVERSION}:${PKGPATH},-estdc
.  endif
.endif
.if !defined(PACKAGING) || ${SUBPACKAGE} == "-f95"
LIB_DEPENDS+=gmp:gmp->=4.2:devel/gmp
LIB_DEPENDS += devel/mpfr
WANTLIB += mpfr
.endif

.include <bsd.port.mk>

@


1.23
log
@Change SEPARATE_BUILD=(concurrent|simple) to Yes; bsd.port.mk doesn't
make a distinction between these.  ok aja@@ dcoppa@@
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.22 2011/03/07 18:59:56 ajacoutot Exp $
@


1.22
log
@New style *_DEPENDS (untested, these ports are broken anyway).
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.21 2010/11/28 21:30:37 jasper Exp $
d187 1
a187 1
SEPARATE_BUILD=concurrent
@


1.21
log
@- add missing conflict markers between g95 and (lib)gfortran.

ok steven@@
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.20 2010/10/18 19:20:41 espie Exp $
d56 1
a56 1
BUILD_DEPENDS+=	::devel/metaauto
d67 2
a68 1
LIB_DEPENDS+=gc::devel/boehm-gc
d82 1
a82 1
REGRESS_DEPENDS=::devel/dejagnu
d213 1
a213 1
RUN_DEPENDS+=::${PKGPATH}
d221 2
a222 1
LIB_DEPENDS+=mpfr::devel/mpfr
@


1.20
log
@USE_GROFF=Yes
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.19 2008/09/11 19:22:05 martynas Exp $
d11 8
a18 8
PKGNAME=	gcc-${FULL_PKGVERSION}p1
PKGNAME-c++ =	g++-${FULL_PKGVERSION}p0
PKGNAME-estdc=	libstdc++-${FULL_PKGVERSION}p0
PKGNAME-g77=	g77-${FULL_PKGVERSION}p0
PKGNAME-f95=	g95-${FULL_PKGVERSION}p0
PKGNAME-java=	gcj-${FULL_PKGVERSION}p0
PKGNAME-objc=	gobjc-${FULL_PKGVERSION}p0
PKGNAME-ada=	gnat-${FULL_PKGVERSION}p0
d27 9
@


1.19
log
@our math.h does not need quirks for gcc anymore.  fix-includes
script does not produce math.h, and just uses the system one, so
remove it from PLIST.  makes gccs package again.  spotted&ok naddy@@
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.18 2007/12/20 16:11:35 ajacoutot Exp $
d29 1
@


1.18
log
@- add a common DESCR for all GCC versions (and their subpackages) ;
except for version 3.3 which already has a specific one ;
versions 3.4, 4.0 and 4.1 have been broken for a while so no bump

ok espie@@
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.17 2007/09/16 00:27:05 merdely Exp $
d11 1
a11 1
PKGNAME=	gcc-${FULL_PKGVERSION}p0
@


1.17
log
@Remove surrounding quotes in COMMENT*/PERMIT_*/BROKEN
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.16 2007/04/01 16:44:19 sturm Exp $
a69 2
# No sub packages description
DESCR=${PKGDIR}/DESCR
@


1.16
log
@really depend on specified autoconf/automake version
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.15 2006/11/01 23:57:24 naddy Exp $
d4 1
a4 1
#BROKEN='adjust for types changes'
@


1.15
log
@switch -f95 gmp dependency to gmp and mpfr
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.14 2006/10/20 11:03:38 espie Exp $
d45 1
a45 1
BUILD_DEPENDS+= ::devel/autoconf/2.59
@


1.14
log
@bump ada bootstrap for libc changes
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.13 2006/10/06 12:42:42 kurt Exp $
d15 1
d211 2
a212 1
LIB_DEPENDS+=gmp:gmp->=4.1.4:devel/gmp
@


1.13
log
@correct defines for SIZE_TYPE and PTRDIFF_TYPE which fixes this error:
http://gcc.gnu.org/bugzilla/show_bug.cgi?id=28582
"error: 'operator new' takes type 'size_t' ('unsigned int') as first
parameter". help from kettenis@@, okay espie@@
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.12 2006/03/06 16:40:59 espie Exp $
d85 1
a85 1
SUPDISTFILES=adastrap-i386-3.3.6-3.tgz:0
d116 1
a116 1
DISTFILES+=adastrap-${MACHINE_ARCH}-3.3.6-3.tgz:0
@


1.12
log
@update adabootstrap files to -current.
noticed by steven@@
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.11 2006/03/05 22:11:15 espie Exp $
d10 8
@


1.11
log
@post-release version.
disable mudflap for now, as it is not compiling for us.
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.10 2006/01/14 11:47:20 espie Exp $
d77 1
a77 1
SUPDISTFILES=adastrap-i386-3.3.6-2.tgz:0
d108 1
a108 1
DISTFILES+=adastrap-${MACHINE_ARCH}-3.3.6-2.tgz:0
@


1.10
log
@mark gccs as broken for now.
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.9 2005/09/11 22:04:41 espie Exp $
d4 1
a4 1
BROKEN='adjust for types changes'
d6 2
a7 2
V=4.1.0
DATE=20050909
d10 8
d77 1
a77 1
SUPDISTFILES=adastrap-i386-3.3.6-1.tgz:0
d108 1
a108 1
DISTFILES+=adastrap-${MACHINE_ARCH}-3.3.6-1.tgz:0
d112 1
d115 2
a116 1
.for f in egcc gnatbind gnatmake gnatlink
d120 6
a126 1
	ln -s /usr/bin/nm ${WRKDIR}/bin/enm
a127 1
.endif
d142 2
a143 1
	--enable-libmudflap \
@


1.9
log
@update to a recent snapshot. USE_LIBTOOL.
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.8 2005/09/11 07:40:59 espie Exp $
d4 1
@


1.8
log
@fix package names.
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.7 2005/08/04 14:51:36 espie Exp $
d6 3
a8 2
FULL_VERSION=4.1-20050730
FULL_PKGVERSION=4.1.20050730
d29 2
@


1.7
log
@update to most recent gcc 4.1 snapshot.
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.6 2005/06/13 19:54:30 espie Exp $
d7 1
d179 1
a179 1
RUN_DEPENDS+=::${PKGPATH},-estdc
@


1.6
log
@bump to new snap
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.5 2005/05/29 13:26:49 espie Exp $
d6 1
a6 1
FULL_VERSION=4.1-20050611
d15 1
a15 1
#MAKE_ADA=Yes
d106 1
d124 4
@


1.5
log
@more recent snapshot
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.4 2005/05/21 10:34:43 espie Exp $
d6 1
a6 1
FULL_VERSION=4.1-20050528
d11 2
a12 2
#MAKE_FORTRAN=Yes
#MAKE_OBJC=Yes
d64 1
a64 1
SUPDISTFILES=adastrap-i386-3.3.5-1.tgz:0
d95 1
a95 1
DISTFILES+=adastrap-${MACHINE_ARCH}-3.3.5-1.tgz:0
@


1.4
log
@switch to a more recent snapshot. Needs recent m4 to rebuild configure
correctly.
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.3 2005/05/16 11:14:36 espie Exp $
d6 1
a6 1
FULL_VERSION=4.1-20050515
@


1.3
log
@get PKGNAMEs to bump correctly.
With the recent svscanf change, stdio no longer gets tweaked.
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.2 2005/03/07 16:30:06 espie Exp $
d6 1
a6 1
FULL_VERSION=4.1-20050327
a59 1
PKGNAME=	${DISTNAME}p0
@


1.2
log
@more recent snap
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.12 2005/02/27 21:27:12 espie Exp $
d6 1
a6 1
FULL_VERSION=4.1-20050306
d59 2
a60 1
DISTNAME=   gcc-${FULL_VERSION}
@


1.1
log
@Initial revision
@
text
@d6 1
a6 1
FULL_VERSION=4.1-20050227
a24 1
BUILD_DEPENDS=	::devel/autoconf/2.13
@


1.1.1.1
log
@yep, 4.0 got branched, so now there are 4.1 snapshots.

Just put this in and don't activate it yet... this makes gcc 4.1
available for people who want to play with it, but it hasn't really
diverged from 4.0 so far...
@
text
@@
