head	1.6;
access;
symbols
	OPENBSD_6_1:1.5.0.2
	OPENBSD_6_1_BASE:1.5
	jeremy_2016-Nov-05:1.1.1.1
	jeremy:1.1.1;
locks; strict;
comment	@# @;


1.6
date	2017.09.23.10.15.28;	author sthen;	state Exp;
branches;
next	1.5;
commitid	irqG7B4T9wWXsbn6;

1.5
date	2017.03.04.05.09.15;	author jeremy;	state Exp;
branches;
next	1.4;
commitid	QG8lyd6EIFuuaW6v;

1.4
date	2017.02.27.21.33.43;	author jca;	state Exp;
branches;
next	1.3;
commitid	JdcNuBwwYXy6yxUb;

1.3
date	2017.02.27.21.27.01;	author jca;	state Exp;
branches;
next	1.2;
commitid	AXp3NhSbmcAktkcz;

1.2
date	2016.12.02.13.35.00;	author jca;	state Exp;
branches;
next	1.1;
commitid	oT8PTZmgHNhaUhJ4;

1.1
date	2016.11.05.22.31.28;	author jeremy;	state Exp;
branches
	1.1.1.1;
next	;
commitid	yHGnU64A8aUuR67e;

1.1.1.1
date	2016.11.05.22.31.28;	author jeremy;	state Exp;
branches;
next	;
commitid	yHGnU64A8aUuR67e;


desc
@@


1.6
log
@add WANTLIB
@
text
@# $OpenBSD: Makefile,v 1.5 2017/03/04 05:09:15 jeremy Exp $

BROKEN-sparc64 =	Bus error (core dumped)

COMMENT =		lightweight, embeddable implementation of ruby

VERSION =		1.2.0
DISTNAME =		mruby-${VERSION}
REVISION =		1
CATEGORIES =		lang
HOMEPAGE =		https://github.com/mruby/mruby

# MIT
PERMIT_PACKAGE_CDROM =	Yes

WANTLIB += c m ncurses readline termcap

MASTER_SITES =		https://github.com/mruby/mruby/archive/
DISTFILES =		${DISTNAME}-${VERSION}.tar.gz{${VERSION}.tar.gz}

MODULES =		lang/ruby
BUILD_DEPENDS =		devel/bison \
			lang/ruby/${MODRUBY_REV}

MAKE_ENV =		CC="${CC}" \
			LD="${CC}"

NO_CONFIGURE =		Yes
SUBST_VARS =		RUBY

do-build:
	cd ${WRKSRC} && ${SETENV} ${MAKE_ENV} ${RUBY} ./minirake --verbose

do-install:
	${INSTALL_PROGRAM} ${WRKSRC}/bin/* ${PREFIX}/bin/
	${INSTALL_DATA_DIR} ${PREFIX}/{lib,include,share/doc}/mruby/ 
	cp -R ${WRKSRC}/mrb{lib,gems} ${PREFIX}/lib/mruby/
	cp -R ${WRKSRC}/include/* ${PREFIX}/include
	${INSTALL_DATA} ${WRKSRC}/doc/guides/* ${PREFIX}/share/doc/mruby/ 

do-test:
	${SUBST_CMD} ${WRKSRC}/tasks/mruby_build.rake
	cd ${WRKSRC} && ${RUBY} ./minirake test

.include <bsd.port.mk>
@


1.5
log
@Disable debug build by default.

Also, only build the version shipping with the package, instead of also
building other versions.

OK jca@@
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.4 2017/02/27 21:33:43 jca Exp $
d9 1
a9 1
REVISION =		0
d15 2
@


1.4
log
@Show build commands, re-add -W* compile flags

The default is still a debug build.  Is that intended?

"cc" -O2 -pipe -std=gnu99 -Wall -Werror-implicit-function-declaration \
-Wdeclaration-after-statement -Wwrite-strings -g3 -O0 -DMRB_ENABLE_DEBUG_HOOK \
-DMRBGEM_MRUBY_BIN_DEBUGGER_VERSION=0.0.0 ...

Added Files: CVS: patches/patch-tasks_toolchains_gcc_rake
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.3 2017/02/27 21:27:01 jca Exp $
d9 1
@


1.3
log
@Respect CC
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.2 2016/12/02 13:35:00 jca Exp $
d29 1
a29 1
	cd ${WRKSRC} && ${SETENV} ${MAKE_ENV} ${RUBY} ./minirake
@


1.2
log
@Broken on sparc64

http://build-failures.rhaalovely.net//sparc64/2016-11-21/lang/mruby.log
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.1.1.1 2016/11/05 22:31:28 jeremy Exp $
d22 3
d29 1
a29 1
	cd ${WRKSRC} && ${RUBY} ./minirake
@


1.1
log
@Initial revision
@
text
@d1 3
a3 1
# $OpenBSD: Makefile,v 1.45 2015/12/20 15:40:17 naddy Exp $
@


1.1.1.1
log
@Import mruby 1.2.0

mruby is a lightweight, easy to embed version of ruby.

Help from juanfra@@ and pirofti@@
OK juanfra@@
@
text
@@
