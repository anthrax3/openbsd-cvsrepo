head	1.26;
access;
symbols
	OPENBSD_6_1:1.25.0.2
	OPENBSD_6_1_BASE:1.25
	OPENBSD_6_0:1.22.0.2
	OPENBSD_6_0_BASE:1.22
	OPENBSD_5_9:1.21.0.4
	OPENBSD_5_9_BASE:1.21
	OPENBSD_5_8:1.21.0.6
	OPENBSD_5_8_BASE:1.21
	OPENBSD_5_7:1.21.0.2
	OPENBSD_5_7_BASE:1.21
	OPENBSD_5_6:1.20.0.4
	OPENBSD_5_6_BASE:1.20
	OPENBSD_5_5:1.20.0.2
	OPENBSD_5_5_BASE:1.20
	OPENBSD_5_4:1.18.0.2
	OPENBSD_5_4_BASE:1.18
	OPENBSD_5_3:1.17.0.2
	OPENBSD_5_3_BASE:1.17
	OPENBSD_5_2:1.15.0.2
	OPENBSD_5_2_BASE:1.15
	OPENBSD_5_1_BASE:1.14
	OPENBSD_5_1:1.14.0.6
	OPENBSD_5_0:1.14.0.4
	OPENBSD_5_0_BASE:1.14
	OPENBSD_4_9:1.14.0.2
	OPENBSD_4_9_BASE:1.14
	OPENBSD_4_8:1.11.0.2
	OPENBSD_4_8_BASE:1.11
	OPENBSD_4_7:1.10.0.2
	OPENBSD_4_7_BASE:1.10
	OPENBSD_4_6:1.9.0.6
	OPENBSD_4_6_BASE:1.9
	OPENBSD_4_5:1.9.0.4
	OPENBSD_4_5_BASE:1.9
	OPENBSD_4_4:1.9.0.2
	OPENBSD_4_4_BASE:1.9
	OPENBSD_4_3:1.7.0.2
	OPENBSD_4_3_BASE:1.7
	OPENBSD_4_2:1.5.0.8
	OPENBSD_4_2_BASE:1.5
	OPENBSD_4_1:1.5.0.6
	OPENBSD_4_1_BASE:1.5
	OPENBSD_4_0:1.5.0.4
	OPENBSD_4_0_BASE:1.5
	OPENBSD_3_9:1.5.0.2
	OPENBSD_3_9_BASE:1.5
	OPENBSD_3_8:1.4.0.2
	OPENBSD_3_8_BASE:1.4
	OPENBSD_3_7:1.3.0.2
	OPENBSD_3_7_BASE:1.3
	OPENBSD_3_6:1.2.0.2
	OPENBSD_3_6_BASE:1.2;
locks; strict;
comment	@# @;


1.26
date	2017.05.06.17.15.20;	author espie;	state Exp;
branches;
next	1.25;
commitid	R50vkExCk3YZzpuS;

1.25
date	2017.03.04.02.03.55;	author jca;	state Exp;
branches;
next	1.24;
commitid	8MSmfCxeczF01xcE;

1.24
date	2016.09.11.16.30.11;	author ratchov;	state Exp;
branches;
next	1.23;
commitid	FsoAzgkLjeDvNDDq;

1.23
date	2016.09.10.13.03.41;	author ajacoutot;	state Exp;
branches;
next	1.22;
commitid	4KcvAK91uGdTLejD;

1.22
date	2016.03.23.21.58.11;	author naddy;	state Exp;
branches;
next	1.21;
commitid	MWaMMZrgHxuKpBbb;

1.21
date	2015.01.22.13.11.44;	author naddy;	state Exp;
branches;
next	1.20;
commitid	adTjm7A45LkE8cUN;

1.20
date	2014.02.11.07.49.58;	author stu;	state Exp;
branches;
next	1.19;

1.19
date	2013.12.30.12.35.22;	author landry;	state Exp;
branches;
next	1.18;

1.18
date	2013.03.21.08.33.52;	author landry;	state Exp;
branches;
next	1.17;

1.17
date	2013.01.29.23.52.28;	author brad;	state Exp;
branches;
next	1.16;

1.16
date	2013.01.08.15.59.05;	author sthen;	state Exp;
branches;
next	1.15;

1.15
date	2012.03.29.13.38.40;	author sthen;	state Exp;
branches;
next	1.14;

1.14
date	2010.11.17.08.05.18;	author espie;	state Exp;
branches;
next	1.13;

1.13
date	2010.10.24.21.24.04;	author ajacoutot;	state Exp;
branches;
next	1.12;

1.12
date	2010.10.18.19.20.42;	author espie;	state Exp;
branches;
next	1.11;

1.11
date	2010.05.19.14.23.02;	author espie;	state Exp;
branches;
next	1.10;

1.10
date	2009.08.10.17.31.07;	author kili;	state Exp;
branches;
next	1.9;

1.9
date	2008.07.23.11.44.15;	author espie;	state Exp;
branches;
next	1.8;

1.8
date	2008.07.23.11.17.22;	author espie;	state Exp;
branches;
next	1.7;

1.7
date	2008.01.04.17.48.36;	author espie;	state Exp;
branches;
next	1.6;

1.6
date	2007.09.16.00.27.06;	author merdely;	state Exp;
branches;
next	1.5;

1.5
date	2005.10.02.13.16.23;	author espie;	state Exp;
branches;
next	1.4;

1.4
date	2005.08.27.19.27.57;	author pvalchev;	state Exp;
branches;
next	1.3;

1.3
date	2005.02.23.19.14.49;	author alek;	state Exp;
branches
	1.3.2.1;
next	1.2;

1.2
date	2004.07.21.15.42.09;	author espie;	state Exp;
branches
	1.2.2.1;
next	1.1;

1.1
date	2004.07.21.11.19.30;	author espie;	state Exp;
branches;
next	;

1.2.2.1
date	2005.09.12.19.20.54;	author sturm;	state Exp;
branches;
next	;

1.3.2.1
date	2005.09.12.19.26.55;	author sturm;	state Exp;
branches;
next	;


desc
@@


1.26
log
@let it build with clang
@
text
@# $OpenBSD: Makefile,v 1.25 2017/03/04 02:03:55 jca Exp $

COMMENT =	smalltalk system, vm

SRCV =		1
DISTFILES =	Squeak-$V-${SRCV}.src.tar.gz

PKGNAME =	squeak-vm-$V.${SRCV}
REVISION =	7

WRKDIST =	${WRKDIR}/Squeak-$V-${SRCV}
WRKSRC =	${WRKDIST}/platforms/unix/config

SEPARATE_BUILD =	Yes

MASTER_SITES =	${SQUEAK_SITE}unix-linux/

RUN_DEPENDS =		squeak-sources-${SOURCEV}:lang/squeak/sources

CONFIGURE_STYLE =	gnu
AUTOCONF_VERSION =	2.60
DESTDIRNAME =		ROOT
CONFIGURE_ENV =		LDFLAGS="-lpthread ${LDFLAGS}" RANLIB=ranlib \
			ac_cv_socklen_t=yes
USE_GMAKE =		Yes
USE_LIBTOOL =		No
NO_TEST =		Yes

WANTLIB =		GL X11 m c SM util Xext ICE Xrender Xt pthread \
			pthread-stubs xcb
FULLV =			$V-${SRCV}

# XXX gnu-interp doesn't work with pie.
#.if ${MACHINE_ARCH} != "powerpc"
#MAKE_FLAGS +=		INTERP=gnu-interp
#.endif

MAKE_FLAGS +=		docdir=${PREFIX}/share/doc/squeak \
			CC="${CC}" \
			LD="${CC}"
DESTDIRNAME =		ROOT
SUBST_VARS +=		FULLV
CFLAGS +=		-fgnu89-inline

pre-build:
	@@perl -pi -e s,dprintf,debugprintf, ${WRKDIST}/platforms/unix/vm/*.c
	@@perl -pi -e s,"define dprintf","define debugprintf", ${WRKDIST}/platforms/unix/vm/debug.h

.include <bsd.port.mk>
@


1.25
log
@Honour CC
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.24 2016/09/11 16:30:11 ratchov Exp $
d43 1
@


1.24
log
@Disable audio; unbreaks the build. Audio is not fixable as there are
LP64 problems preventing from implementing proper audio backend.

suggested by and ok naddy@@
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.22 2016/03/23 21:58:11 naddy Exp $
d38 3
a40 1
MAKE_FLAGS +=		docdir=${PREFIX}/share/doc/squeak
@


1.23
log
@First pass at pre-entively fixing ports that would break once guenther's header
pollution diff is in.

lang/squeak/vm does not build but it's due to the recent audio changes
games/xbattle: also fixes some conflicting implicit decl
print/hplip: also fixes some conflicting implicit decl
@
text
@d9 1
a9 1
REVISION =	6
a40 5

post-extract:
	# start with the sun sound-plugin that we'll patch
	mkdir ${WRKDIST}/platforms/unix/vm-sound-OpenBSD
	cd ${WRKDIST}/platforms/unix && cp vm-sound-Sun/acinclude.m4 vm-sound-OpenBSD && cp vm-sound-Sun/sqUnixSoundSun.c vm-sound-OpenBSD/sqUnixSoundOpenBSD.c
@


1.22
log
@g/c PFRAG.shared
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.21 2015/01/22 13:11:44 naddy Exp $
d9 1
a9 1
REVISION =	5
@


1.21
log
@Drop USE_GROFF since groff and mandoc produce identical output.
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.20 2014/02/11 07:49:58 stu Exp $
d9 1
a9 1
REVISION =	4
@


1.20
log
@Quick fix for gnu-interp not working with pie.

ok espie@@
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.19 2013/12/30 12:35:22 landry Exp $
a25 1
USE_GROFF =		Yes
@


1.19
log
@Set NO_TEST=Yes, because well, it has no tests.
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.18 2013/03/21 08:33:52 landry Exp $
d9 1
a9 1
REVISION =	3
d34 4
a37 3
.if ${MACHINE_ARCH} != "powerpc"
MAKE_FLAGS +=		INTERP=gnu-interp
.endif
@


1.18
log
@Explicitely set USE_LIBTOOL=No for ports we know don't work with our
libtool.
Joint work with ajacoutot@@
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.17 2013/01/29 23:52:28 brad Exp $
d28 1
@


1.17
log
@Rename dprintf macro to debugprintf so as to not conflict with POSIX
function name.

ok sthen@@
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.16 2013/01/08 15:59:05 sthen Exp $
d27 1
@


1.16
log
@link squeak with -lpthread; it's needed for, at least, some X things. ok espie@@
- this fixes basic operation of scratch, though there are still issues
@
text
@d1 1
a1 2
# $OpenBSD: Makefile,v 1.15 2012/03/29 13:38:40 sthen Exp $

d9 1
a9 1
REVISION =	2
d18 2
d45 3
a47 1
RUN_DEPENDS =		squeak-sources-${SOURCEV}:lang/squeak/sources
@


1.15
log
@Change SEPARATE_BUILD=(concurrent|simple) to Yes; bsd.port.mk doesn't
make a distinction between these.  ok aja@@ dcoppa@@
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.14 2010/11/17 08:05:18 espie Exp $
d7 1
a7 1
DISTFILES =	Squeak-$V-${SRCV}.src.tar.gz 
d10 1
a10 1
REVISION =	1
d22 1
a22 1
CONFIGURE_ENV =		RANLIB=ranlib \
@


1.14
log
@new depends
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.13 2010/10/24 21:24:04 ajacoutot Exp $
d15 1
a15 1
SEPARATE_BUILD =	simple
@


1.13
log
@Remove USE_X11.
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.12 2010/10/18 19:20:42 espie Exp $
d9 2
a10 1
PKGNAME =	squeak-vm-$V.${SRCV}p1
d25 1
a25 1
USE_GROFF =	Yes
d44 1
a44 1
RUN_DEPENDS =		:squeak-sources-${SOURCEV}:lang/squeak/sources
@


1.12
log
@USE_GROFF=Yes
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.11 2010/05/19 14:23:02 espie Exp $
a23 1
USE_X11 =		Yes
@


1.11
log
@cheat a bit, tell configure we have socklen_t, even though sys/socket.h
alone won't get it.
fixes gcc4
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.10 2009/08/10 17:31:07 kili Exp $
d25 1
@


1.10
log
@WANTLIB changes after xcb addition and bump.

For some unknown reason, I forgot to commit lang/*
this morning.
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.9 2008/07/23 11:44:15 espie Exp $
d21 2
a22 1
CONFIGURE_ENV =		RANLIB=ranlib
@


1.9
log
@fix wantlib, bump pkgname
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.8 2008/07/23 11:17:22 espie Exp $
d9 1
a9 1
PKGNAME =	squeak-vm-$V.${SRCV}p0
d25 2
a26 1
WANTLIB =		GL X11 m c SM util Xext ICE Xrender Xt pthread
@


1.8
log
@finally update squeak to a more recent version.
as far as I know this should work on 64 bit systems.
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.7 2008/01/04 17:48:36 espie Exp $
d9 1
a9 1
PKGNAME =	squeak-vm-$V.${SRCV}
d25 1
a25 1
WANTLIB =		GL X11 m c SM util Xext ICE
@


1.7
log
@tweak FAKE_FLAGS semantics to saner defaults.
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.6 2007/09/16 00:27:06 merdely Exp $
d4 1
a4 1
COMMENT=	smalltalk system, vm
d6 2
d9 1
a9 1
DISTFILES=Squeak-$V-${SRC_V}.src.tar.gz 
d11 2
a12 1
PKGNAME=squeak-vm-$V.${SRC_V}
d14 1
a14 2
WRKDIST=${WRKDIR}/Squeak-$V-${SRC_V}
WRKSRC=${WRKDIST}/platforms/unix/config
d16 1
a16 1
SEPARATE_BUILD=simple
d18 6
a23 6
CONFIGURE_STYLE=gnu
AUTOCONF_VERSION=2.57
DESTDIRNAME=ROOT
CONFIGURE_ENV=RANLIB=ranlib
USE_GMAKE=yes
USE_X11=yes
d25 2
a26 1
WANTLIB=GL X11 m c SM util Xext ICE
d29 1
a29 1
MAKE_FLAGS+=INTERP=gnu-interp
d32 3
a34 2
MAKE_FLAGS+=docdir=${PREFIX}/share/doc/squeak
DESTDIRNAME=	ROOT
d37 1
d39 1
a39 1
	cp ${FILESDIR}/vm-sound-OpenBSD/{acinclude.m4,sqUnixSoundOpenBSD.c} ${WRKDIST}/platforms/unix/vm-sound-OpenBSD
d41 1
a41 2
RUN_DEPENDS=	:squeak-image-$V.*:lang/squeak/image \
		:squeak-sources-${MAJOR}:lang/squeak/sources
@


1.6
log
@Remove surrounding quotes in COMMENT*/PERMIT_*/BROKEN
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.5 2005/10/02 13:16:23 espie Exp $
d30 1
a30 1
FAKE_FLAGS=${MAKE_FLAGS} ROOT=${WRKINST}
@


1.5
log
@update to 3.7.7... still no 64 bits support.
clean-up a few minor details.
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.4 2005/08/27 19:27:57 pvalchev Exp $
d4 1
a4 1
COMMENT=	"smalltalk system, vm"
@


1.4
log
@fix pcre vulnerability; ok naddy
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.3 2005/02/23 19:14:49 alek Exp $
d9 1
a9 1
PKGNAME=squeak-vm-$V.${SRC_V}p1
@


1.3
log
@sources/
- Add PKG_ARCH
- Bump PKGNAME

vm/
- Add WANTLIB marker
- Remove wrong PKG_ARCH
- Bump PKGNAME

yeah espie@@
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.2 2004/07/21 15:42:09 espie Exp $
d9 1
a9 1
PKGNAME=squeak-vm-$V.${SRC_V}p0
@


1.3.2.1
log
@MFC:
fix pcre vulnerability;

ok brad@@
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.3 2005/02/23 19:14:49 alek Exp $
d9 1
a9 1
PKGNAME=squeak-vm-$V.${SRC_V}p1
@


1.2
log
@resurrect sound support, and clean up a little bit.
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.1 2004/07/21 11:19:30 espie Exp $
d9 1
a9 2
PKGNAME=squeak-vm-$V.${SRC_V}
PKG_ARCH=*
d22 2
@


1.2.2.1
log
@MFC:
fix pcre vulnerability;

ok brad@@
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.2 2004/07/21 15:42:09 espie Exp $
d9 1
a9 1
PKGNAME=squeak-vm-$V.${SRC_V}p1
@


1.1
log
@Basic update to squeak 3.6.
Modify port structure to create several packages more closely based
on distribution (and this is actually simpler to manage).
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.7 2004/05/17 15:04:03 espie Exp $
d18 1
d30 4
@

