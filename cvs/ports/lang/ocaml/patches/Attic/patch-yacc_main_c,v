head	1.6;
access;
symbols
	OPENBSD_4_8:1.5.0.18
	OPENBSD_4_8_BASE:1.5
	OPENBSD_4_7:1.5.0.16
	OPENBSD_4_7_BASE:1.5
	OPENBSD_4_6:1.5.0.14
	OPENBSD_4_6_BASE:1.5
	OPENBSD_4_5:1.5.0.12
	OPENBSD_4_5_BASE:1.5
	OPENBSD_4_4:1.5.0.10
	OPENBSD_4_4_BASE:1.5
	OPENBSD_4_3:1.5.0.8
	OPENBSD_4_3_BASE:1.5
	OPENBSD_4_2:1.5.0.6
	OPENBSD_4_2_BASE:1.5
	OPENBSD_4_1:1.5.0.4
	OPENBSD_4_1_BASE:1.5
	OPENBSD_4_0:1.5.0.2
	OPENBSD_4_0_BASE:1.5
	OPENBSD_3_9:1.4.0.4
	OPENBSD_3_9_BASE:1.4
	OPENBSD_3_8:1.4.0.2
	OPENBSD_3_8_BASE:1.4
	OPENBSD_3_7:1.3.0.6
	OPENBSD_3_7_BASE:1.3
	OPENBSD_3_6:1.3.0.4
	OPENBSD_3_6_BASE:1.3
	OPENBSD_3_5:1.3.0.2
	OPENBSD_3_5_BASE:1.3
	OPENBSD_3_4:1.2.0.6
	OPENBSD_3_4_BASE:1.2
	OPENBSD_3_3:1.2.0.4
	OPENBSD_3_3_BASE:1.2
	OPENBSD_3_2:1.2.0.2
	OPENBSD_3_2_BASE:1.2
	OPENBSD_3_1:1.1.0.4
	OPENBSD_3_1_BASE:1.1
	OPENBSD_3_0:1.1.0.2
	OPENBSD_3_0_BASE:1.1;
locks; strict;
comment	@# @;


1.6
date	2010.12.07.15.01.35;	author dcoppa;	state dead;
branches;
next	1.5;

1.5
date	2006.05.28.15.28.54;	author avsm;	state Exp;
branches;
next	1.4;

1.4
date	2005.05.09.13.50.41;	author avsm;	state Exp;
branches;
next	1.3;

1.3
date	2003.12.31.17.05.28;	author sturm;	state Exp;
branches;
next	1.2;

1.2
date	2002.08.25.20.44.40;	author naddy;	state Exp;
branches;
next	1.1;

1.1
date	2001.08.22.00.32.00;	author angelos;	state Exp;
branches;
next	;


desc
@@


1.6
log
@Update to ocaml-3.12.0

Maintainer timeout.

OK landry@@, jasper@@
@
text
@--- yacc/main.c.orig	Mon Jan 23 17:38:43 2006
+++ yacc/main.c	Tue May  2 11:34:56 2006
@@@@ -55,6 +55,14 @@@@ char *text_file_name;
 char *union_file_name;
 char *verbose_file_name;
 
+#if defined(__OpenBSD__)
+#define HAVE_MKSTEMP
+#endif
+
+#ifdef HAVE_MKSTEMP
+int action_fd = -1, entry_fd = -1, text_fd = -1, union_fd = -1;
+#endif
+
 FILE *action_file;      /*  a temp file, used to save actions associated    */
                         /*  with rules until the parser is written          */
 FILE *entry_file;
@@@@ -93,16 +101,29 @@@@ char  *rassoc;
 short **derives;
 char *nullable;
 
+#if !defined(HAVE_MKSTEMP)
 extern char *mktemp(char *);
+#endif
 extern char *getenv(const char *);
 
 
 void done(int k)
 {
+#ifdef HAVE_MKSTEMP
+    if (action_fd != -1)
+       unlink(action_file_name);
+    if (entry_fd != -1)
+       unlink(entry_file_name);
+    if (text_fd != -1)
+       unlink(text_file_name);
+    if (union_fd != -1)
+       unlink(union_file_name);
+#else
     if (action_file) { fclose(action_file); unlink(action_file_name); }
     if (entry_file) { fclose(entry_file); unlink(entry_file_name); }
     if (text_file) { fclose(text_file); unlink(text_file_name); }
     if (union_file) { fclose(union_file); unlink(union_file_name); }
+#endif
     if (output_file && k > 0) {
       fclose(output_file); unlink(output_file_name);
     }
@@@@ -302,11 +323,26 @@@@ void create_file_names(void)
     union_file_name[len + 5] = 'u';
 
 #ifndef NO_UNIX
+#ifdef HAVE_MKSTEMP
+    action_fd = mkstemp(action_file_name);
+    if (action_fd == -1)
+        open_error(action_file_name);
+    entry_fd = mkstemp(entry_file_name);
+    if (entry_fd == -1)                 
+        open_error(entry_file_name);
+    text_fd = mkstemp(text_file_name);
+    if (text_fd == -1)
+        open_error(text_file_name);
+    union_fd = mkstemp(union_file_name);
+    if (union_fd == -1)
+        open_error(union_file_name);
+#else
     mktemp(action_file_name);
     mktemp(entry_file_name);
     mktemp(text_file_name);
     mktemp(union_file_name);
 #endif
+#endif
 
     len = strlen(file_prefix);
 
@@@@ -347,15 +383,27 @@@@ void open_files(void)
             open_error(input_file_name);
     }
 
+#ifdef HAVE_MKSTEMP
+    action_file = fdopen(action_fd, "w");
+#else
     action_file = fopen(action_file_name, "w");
+#endif
     if (action_file == 0)
         open_error(action_file_name);
 
+#ifdef HAVE_MKSTEMP
+    entry_file = fdopen(entry_fd, "w");
+#else
     entry_file = fopen(entry_file_name, "w");
+#endif
     if (entry_file == 0)
         open_error(entry_file_name);
 
+#ifdef HAVE_MKSTEMP
+    text_file = fdopen(text_fd, "w");
+#else
     text_file = fopen(text_file_name, "w");
+#endif
     if (text_file == 0)
         open_error(text_file_name);
 
@@@@ -371,7 +419,11 @@@@ void open_files(void)
         defines_file = fopen(defines_file_name, "w");
         if (defines_file == 0)
             open_error(defines_file_name);
+#ifdef HAVE_MKSTEMP
+        union_file = fdopen(union_fd, "w");
+#else
         union_file = fopen(union_file_name, "w");
+#endif
         if (union_file ==  0)
             open_error(union_file_name);
     }
@


1.5
log
@upgrade to ocaml-3.09.2, sturm@@ ok
@
text
@@


1.4
log
@upgrade to ocaml-3.08.3, tested on many architectures by krw@@
@
text
@d1 3
a3 3
--- yacc/main.c.orig	Thu Apr 22 00:26:05 2004
+++ yacc/main.c	Tue Oct  5 20:54:00 2004
@@@@ -53,6 +53,14 @@@@ char *text_file_name;
d18 1
a18 1
@@@@ -91,16 +99,29 @@@@ char  *rassoc;
d48 1
a48 1
@@@@ -293,11 +314,26 @@@@ void create_file_names(void)
d75 1
a75 1
@@@@ -338,15 +374,27 @@@@ void open_files(void)
d103 1
a103 1
@@@@ -362,7 +410,11 @@@@ void open_files(void)
@


1.3
log
@update to ocaml 3.07
@
text
@d1 3
a3 3
--- yacc/main.c.orig	2003-09-03 15:25:48.000000000 +0200
+++ yacc/main.c	2003-09-29 22:56:21.000000000 +0200
@@@@ -52,6 +52,14 @@@@ char *text_file_name;
d18 1
a18 1
@@@@ -90,16 +98,29 @@@@ char  *rassoc;
d48 1
a48 1
@@@@ -292,11 +313,26 @@@@ void create_file_names(void)
d75 1
a75 1
@@@@ -337,15 +373,27 @@@@ void open_files(void)
d103 1
a103 1
@@@@ -361,7 +409,11 @@@@ void open_files(void)
@


1.2
log
@Update to 3.06 which includes camlp4.
From Nikolay Sturm <sturm@@sec.informatik.tu-darmstadt.de>.
@
text
@d1 3
a3 3
--- yacc/main.c.orig	Thu Jul 12 14:54:23 2001
+++ yacc/main.c	Mon Aug 12 21:33:04 2002
@@@@ -51,6 +51,14 @@@@ char *text_file_name;
d18 1
a18 1
@@@@ -89,16 +97,29 @@@@ char  *rassoc;
d48 1
a48 1
@@@@ -283,11 +304,26 @@@@ void create_file_names(void)
d75 1
a75 1
@@@@ -328,15 +364,27 @@@@ void open_files(void)
d103 1
a103 1
@@@@ -352,7 +400,11 @@@@ void open_files(void)
@


1.1
log
@Update to ocaml 3.02 --- from bk@@rt.fm
@
text
@d1 3
a3 3
--- yacc/main.c.orig	Sun Aug 19 21:38:43 2001
+++ yacc/main.c	Sun Aug 19 21:52:36 2001
@@@@ -51,6 +51,14 @@@@
d18 1
a18 1
@@@@ -89,16 +97,29 @@@@
d48 1
a48 1
@@@@ -283,11 +304,26 @@@@
d75 1
a75 1
@@@@ -328,15 +364,27 @@@@
d103 1
a103 1
@@@@ -352,7 +400,11 @@@@
@

