head	1.7;
access;
symbols
	OPENBSD_3_5:1.4.0.2
	OPENBSD_3_5_BASE:1.4
	OPENBSD_3_4:1.3.0.4
	OPENBSD_3_4_BASE:1.3
	OPENBSD_3_3:1.3.0.2
	OPENBSD_3_3_BASE:1.3;
locks; strict;
comment	@# @;


1.7
date	2004.08.10.20.39.38;	author xsa;	state dead;
branches;
next	1.6;

1.6
date	2004.06.22.18.15.58;	author avsm;	state Exp;
branches;
next	1.5;

1.5
date	2004.06.22.18.14.44;	author avsm;	state Exp;
branches;
next	1.4;

1.4
date	2004.03.05.21.54.36;	author avsm;	state Exp;
branches;
next	1.3;

1.3
date	2002.11.26.20.11.24;	author sturm;	state Exp;
branches;
next	1.2;

1.2
date	2002.11.22.15.13.42;	author sturm;	state Exp;
branches;
next	1.1;

1.1
date	2002.11.13.21.42.15;	author naddy;	state Exp;
branches;
next	;


desc
@@


1.7
log
@
prepare for new-style MODULES. ok sturm@@.
@
text
@# $OpenBSD: ocaml.port.mk,v 1.6 2004/06/22 18:15:58 avsm Exp $

# regular file usage for bytecode:
# PLIST               -- bytecode base files
# PFRAG.foo           -- bytecode files for FLAVOR == foo
# PFRAG.no-foo        -- bytecode files for FLAVOR != foo
# extended file usage for nativecode:
# PFRAG.native        -- nativecode base files
# PFRAG.native.foo    -- nativecode files for FLAVOR == foo
# PFRAG.native.no-foo -- nativecode files for FLAVOR != foo

.if ${MACHINE_ARCH} == "alpha" || ${MACHINE_ARCH} == "i386" || \
	${MACHINE_ARCH} == "sparc" || ${MACHINE_ARCH} == "amd64" || \
	${MACHINE_ARCH} == "powerpc"
MODOCAML_NATIVE=Yes

# include nativecode base files
SED_PLIST+=	|sed -e '/^%%native%%$$/r${PKGDIR}/PFRAG.native' -e '//d'

# create sed substitution for nativecode FLAVORS
.  if !empty(FLAVORS)
.    for _i in ${FLAVORS:L}
.      if empty(FLAVOR:L:M${_i})
SED_PLIST+=	|sed -e '/^!%%native\.${_i}%%$$/r${PKGDIR}/PFRAG.native.no-${_i}' -e '//d' -e '/^%%native\.${_i}%%$$/d'
.      else
SED_PLIST+=	|sed -e '/^!%%native\.${_i}%%$$/d' -e '/^%%native\.${_i}%%$$/r${PKGDIR}/PFRAG.native.${_i}' -e '//d' 
.      endif
.    endfor
.  endif

.else

MODOCAML_NATIVE=No
RUN_DEPENDS+=	::lang/ocaml

# remove native base file entry from PLIST
SED_PLIST+=	|sed -e '/^%%native%%$$/d'

# remove nativecode FLAVOR entries from PLIST
.  if !empty(FLAVORS)
.    for _i in ${FLAVORS:L}
SED_PLIST+=	|sed -e '/^!%%native\.${_i}%%$$/d' -e '/^%%native\.${_i}%%$$/d'
.    endfor
.  endif
.endif

BUILD_DEPENDS+=	::lang/ocaml
@


1.6
log
@oops
@
text
@d1 1
a1 1
# $OpenBSD: ocaml.port.mk,v 1.5 2004/06/22 18:14:44 avsm Exp $
@


1.5
log
@support native code compilation (ocamlopt) on macppc as well, for nordin@@
to hack on
@
text
@d1 1
a1 1
# $OpenBSD: ocaml.port.mk,v 1.4 2004/03/05 21:54:36 avsm Exp $
d13 1
a13 1
	${MACHINE_ARCH} == "sparc" || ${MACHINE_ARCH} == "amd64" ||
@


1.4
log
@support native code compilation on amd64, resulting in crazy fast ocaml
sturm@@, pvalchev@@ ok
@
text
@d1 1
a1 1
# $OpenBSD: ocaml.port.mk,v 1.3 2002/11/26 20:11:24 sturm Exp $
d13 2
a14 1
	${MACHINE_ARCH} == "sparc" || ${MACHINE_ARCH} == "amd64"
@


1.3
log
@This adds support for flavored ocaml ports.

Because of the distinction between nativecode and bytecodefiles in ocaml-
ports, special filenames have to be used for flavors. These are documented
in the modul.

naddy@@ OK
@
text
@d1 1
a1 1
# $OpenBSD: ocaml.port.mk,v 1.2 2002/11/22 15:13:42 sturm Exp $
d13 1
a13 1
	${MACHINE_ARCH} == "sparc"
@


1.2
log
@{RUN,BUILD}_DEPENDS+= :ocaml-*:lang/ocaml -> ::lang/ocaml
@
text
@d1 1
a1 1
# $OpenBSD: ocaml.port.mk,v 1.1 2002/11/13 21:42:15 naddy Exp $
d3 8
a10 1
# use PFRAG.native for extra files produced by the native code compiler
d15 2
d18 12
d31 1
d34 2
d37 7
@


1.1
log
@First cut at OCaml module.
From: Nikolay Sturm <sturm@@sec.informatik.tu-darmstadt.de>
@
text
@d1 1
a1 1
# $OpenBSD: $
d11 1
a11 1
RUN_DEPENDS+=	:ocaml-*:lang/ocaml
d15 1
a15 1
BUILD_DEPENDS+=	:ocaml-*:lang/ocaml
@

