head	1.1;
access;
symbols
	OPENBSD_5_5:1.1.0.2;
locks; strict;
comment	@# @;


1.1
date	2014.05.22.11.22.46;	author jasper;	state dead;
branches
	1.1.2.1;
next	;

1.1.2.1
date	2014.05.22.11.22.46;	author jasper;	state Exp;
branches;
next	;


desc
@@


1.1
log
@file patch-srfi-4_scm was initially added on branch OPENBSD_5_5.
@
text
@@


1.1.2.1
log
@security fix for CVE-2014-3776,
buffer overflow in "read-u8vector!" procedure leads to DoS or arbitrary code exec
@
text
@a0 28
$OpenBSD$

Security fix for CVE-2014-3776,
buffer overflow in "read-u8vector!" procedure leads to DoS or arbitrary code exec

http://code.call-cc.org/cgi-bin/gitweb.cgi?p=chicken-core.git;a=commit;h=1d06ce7e21c7e903ca5dca11fda6fcf2cc52de5e

--- srfi-4.scm.orig	Thu May 22 08:53:14 2014
+++ srfi-4.scm	Thu May 22 08:53:47 2014
@@@@ -615,12 +615,12 @@@@ EOF
   (##sys#check-port port 'read-u8vector!)
   (##sys#check-exact start 'read-u8vector!)
   (##sys#check-structure dest 'u8vector 'read-u8vector!)
-  (let ((dest (##sys#slot dest 1)))
-    (when n
-      (##sys#check-exact n 'read-u8vector!)
-      (when (fx> (fx+ start n) (##sys#size dest))
-	(set! n (fx- (##sys#size dest) start))))
-    (##sys#read-string! n dest port start) ) )
+  (when n (##sys#check-exact n 'read-u8vector!))
+  (let* ((dest (##sys#slot dest 1))
+	 (size (##sys#size dest)))
+    (unless (and n (fx<= (fx+ start n) size))
+      (set! n (fx- size start)))
+    (##sys#read-string! n dest port start)))
 
 (define read-u8vector
   (let ((open-output-string open-output-string)
@

