head	1.1;
access;
symbols
	OPENBSD_6_1:1.1.0.6
	OPENBSD_6_1_BASE:1.1
	OPENBSD_6_0:1.1.0.4
	OPENBSD_6_0_BASE:1.1
	OPENBSD_5_9:1.1.0.2
	OPENBSD_5_9_BASE:1.1;
locks; strict;
comment	@# @;


1.1
date	2016.02.06.23.30.25;	author sthen;	state Exp;
branches;
next	;
commitid	0LmiRy9TojIATE7G;


desc
@@


1.1
log
@security update to php-5.6.18, fixes include crashes, integer overflows,
and updating the bundled pcre (also security fixes).

add patches to use arc4random_buf instead of /dev/urandom (which is
typically not available on a normal OpenBSD php installation, with very
bad fallbacks in some cases).

testing of arc4random bits from martijn@@, ok robert@@
@
text
@$OpenBSD$

Perhaps the whole function can be replaced, but we have to start somewhere.

--- ext/session/session.c.orig.port	Mon Feb  1 23:04:02 2016
+++ ext/session/session.c	Mon Feb  1 23:48:25 2016
@@@@ -346,7 +346,11 @@@@ PHPAPI char *php_session_create_id(PS_CREATE_SID_ARGS)
 	efree(buf);
 
 	if (PS(entropy_length) > 0) {
-#ifdef PHP_WIN32
+#if defined(__OpenBSD__)
+		unsigned char rbuf[2048];
+		size_t toread = PS(entropy_length);
+		arc4random_buf(rbuf, MIN(toread, sizeof(rbuf)));
+#elif defined(PHP_WIN32)
 		unsigned char rbuf[2048];
 		size_t toread = PS(entropy_length);
 
@
