head	1.3;
access;
symbols
	OPENBSD_5_9:1.2.0.2
	OPENBSD_5_9_BASE:1.2
	OPENBSD_5_8:1.2.0.4
	OPENBSD_5_8_BASE:1.2;
locks; strict;
comment	@# @;


1.3
date	2016.04.28.18.06.46;	author sthen;	state dead;
branches;
next	1.2;
commitid	i47ZnKZZ6MYLicYj;

1.2
date	2015.07.19.20.09.58;	author sthen;	state Exp;
branches;
next	1.1;
commitid	GlEQTT3n05nhYeQZ;

1.1
date	2015.07.18.20.54.19;	author sthen;	state Exp;
branches;
next	;
commitid	ZVrt2IIDtqwGsmyl;


desc
@@


1.3
log
@5.4
@
text
@$OpenBSD: patch-ext_openssl_xp_ssl_c,v 1.2 2015/07/19 20:09:58 sthen Exp $
--- ext/openssl/xp_ssl.c.orig.port	Sat Jul 18 13:58:31 2015
+++ ext/openssl/xp_ssl.c	Sat Jul 18 14:52:03 2015
@@@@ -339,9 +339,14 @@@@ static inline int php_openssl_setup_crypto(php_stream 
 			break;
 #endif
 		case STREAM_CRYPTO_METHOD_SSLv3_CLIENT:
+#ifdef OPENSSL_NO_SSL3
+			php_error_docref(NULL TSRMLS_CC, E_WARNING, "SSLv3 support is not compiled into the OpenSSL library PHP is linked against");
+			return -1;
+#else
 			sslsock->is_client = 1;
 			method = SSLv3_client_method();
 			break;
+#endif
 		case STREAM_CRYPTO_METHOD_TLS_CLIENT:
 			sslsock->is_client = 1;
 			method = TLSv1_client_method();
@@@@ -351,9 +356,14 @@@@ static inline int php_openssl_setup_crypto(php_stream 
 			method = SSLv23_server_method();
 			break;
 		case STREAM_CRYPTO_METHOD_SSLv3_SERVER:
+#ifdef OPENSSL_NO_SSL3
+			php_error_docref(NULL TSRMLS_CC, E_WARNING, "SSLv3 support is not compiled into the OpenSSL library PHP is linked against");
+			return -1;
+#else
 			sslsock->is_client = 0;
 			method = SSLv3_server_method();
 			break;
+#endif
 		case STREAM_CRYPTO_METHOD_SSLv2_SERVER:
 #ifdef OPENSSL_NO_SSL2
 			php_error_docref(NULL TSRMLS_CC, E_WARNING, "SSLv2 support is not compiled into the OpenSSL library PHP is linked against");
@


1.2
log
@fix typo
@
text
@d1 1
a1 1
$OpenBSD: patch-ext_openssl_xp_ssl_c,v 1.1 2015/07/18 20:54:19 sthen Exp $
@


1.1
log
@guard SSLv3_*_method with OPENSSL_NO_SSL3, same as php 5.6 does
(if you use SSL/TLS in php, you really should be using 5.6+)
(...if you use php at all,   "                           " )
@
text
@d1 1
a1 1
$OpenBSD$
d10 1
a10 1
+			Return -1;
d25 1
a25 1
+			Return -1;
@

