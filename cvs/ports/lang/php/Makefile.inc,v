head	1.96;
access;
symbols
	OPENBSD_6_2:1.96.0.2
	OPENBSD_6_2_BASE:1.96
	OPENBSD_6_1:1.91.0.2
	OPENBSD_6_1_BASE:1.91
	OPENBSD_6_0:1.86.0.2
	OPENBSD_6_0_BASE:1.86
	OPENBSD_5_9:1.72.0.2
	OPENBSD_5_9_BASE:1.72
	OPENBSD_5_8:1.65.0.4
	OPENBSD_5_8_BASE:1.65
	OPENBSD_5_7:1.63.0.2
	OPENBSD_5_7_BASE:1.63
	OPENBSD_5_6:1.55.0.2
	OPENBSD_5_6_BASE:1.55
	OPENBSD_5_5:1.50.0.2
	OPENBSD_5_5_BASE:1.50
	OPENBSD_5_4:1.44.0.2
	OPENBSD_5_4_BASE:1.44
	OPENBSD_5_3:1.36.0.2
	OPENBSD_5_3_BASE:1.36
	OPENBSD_5_2:1.31.0.2
	OPENBSD_5_2_BASE:1.31
	OPENBSD_5_1_BASE:1.26
	OPENBSD_5_1:1.26.0.2
	OPENBSD_5_0:1.18.0.2
	OPENBSD_5_0_BASE:1.18
	OPENBSD_4_9:1.6.0.2
	OPENBSD_4_9_BASE:1.6
	OPENBSD_4_8:1.2.0.2
	OPENBSD_4_8_BASE:1.2
	robert_20100627:1.1.1.1
	robert:1.1.1;
locks; strict;
comment	@# @;


1.96
date	2017.08.24.10.03.25;	author sthen;	state Exp;
branches;
next	1.95;
commitid	OqHxuwYewIOecOVm;

1.95
date	2017.07.16.19.18.59;	author espie;	state Exp;
branches;
next	1.94;
commitid	tt0GhWK5c4uf9ILG;

1.94
date	2017.06.12.11.48.34;	author sthen;	state Exp;
branches;
next	1.93;
commitid	yH2wqSvHTqG7Em8H;

1.93
date	2017.04.26.08.15.05;	author sthen;	state Exp;
branches;
next	1.92;
commitid	iK74sUPTRwf5ZPIH;

1.92
date	2017.04.10.11.46.22;	author sthen;	state Exp;
branches;
next	1.91;
commitid	BLsh88fJB8thZTwY;

1.91
date	2017.01.26.23.04.16;	author sthen;	state Exp;
branches;
next	1.90;
commitid	5KKS6HEkei4Omtey;

1.90
date	2017.01.24.00.40.13;	author jca;	state Exp;
branches;
next	1.89;
commitid	CbWu214RkjaUOcHi;

1.89
date	2017.01.05.16.59.31;	author jca;	state Exp;
branches;
next	1.88;
commitid	dOwdN2MK3rPhqQwm;

1.88
date	2016.11.04.11.35.19;	author sthen;	state Exp;
branches;
next	1.87;
commitid	Gg5LRcnQlqj5M3F7;

1.87
date	2016.10.31.15.05.51;	author robert;	state Exp;
branches;
next	1.86;
commitid	eET11f3rUN4BSw9f;

1.86
date	2016.06.25.18.55.11;	author sthen;	state Exp;
branches;
next	1.85;
commitid	uGLFWW0dHh4btAw3;

1.85
date	2016.06.22.21.18.32;	author sthen;	state Exp;
branches;
next	1.84;
commitid	63hh4VGYx1HyCcWp;

1.84
date	2016.04.28.18.19.23;	author sthen;	state Exp;
branches;
next	1.83;
commitid	pOf6eYvOvaEiZswL;

1.83
date	2016.04.28.18.09.37;	author sthen;	state Exp;
branches;
next	1.82;
commitid	fXVFWVmkfptWbTkB;

1.82
date	2016.04.28.18.06.46;	author sthen;	state Exp;
branches;
next	1.81;
commitid	i47ZnKZZ6MYLicYj;

1.81
date	2016.04.19.06.19.41;	author sthen;	state Exp;
branches;
next	1.80;
commitid	HljBk9DUyaAFzHkr;

1.80
date	2016.04.18.09.45.52;	author sthen;	state Exp;
branches;
next	1.79;
commitid	Ix2olg4HBtWBE3Qr;

1.79
date	2016.04.13.11.42.59;	author naddy;	state Exp;
branches;
next	1.78;
commitid	6TDAtqv456sfxiTt;

1.78
date	2016.04.10.19.38.13;	author naddy;	state Exp;
branches;
next	1.77;
commitid	krnUranfaxUXZv5d;

1.77
date	2016.04.08.20.25.51;	author robert;	state Exp;
branches;
next	1.76;
commitid	GUSGBGo7o59V9C0z;

1.76
date	2016.03.17.16.58.01;	author sthen;	state Exp;
branches;
next	1.75;
commitid	BPwE7xSto31yXzVp;

1.75
date	2016.03.17.16.54.12;	author sthen;	state Exp;
branches;
next	1.74;
commitid	t4OU6dRIiRL0yDM4;

1.74
date	2016.03.16.20.02.11;	author naddy;	state Exp;
branches;
next	1.73;
commitid	GN6lKbKd2o6JAOX1;

1.73
date	2016.03.12.20.23.35;	author naddy;	state Exp;
branches;
next	1.72;
commitid	zqHt6g7owckvbOiv;

1.72
date	2016.02.01.21.53.06;	author sthen;	state Exp;
branches;
next	1.71;
commitid	FC3tzOC0pxGWprm3;

1.71
date	2016.01.07.18.06.45;	author sthen;	state Exp;
branches;
next	1.70;
commitid	H4kokcanIaMGNWvF;

1.70
date	2015.12.15.23.02.49;	author ajacoutot;	state Exp;
branches;
next	1.69;
commitid	gPARbzvwNkQzc9ar;

1.69
date	2015.12.14.17.59.28;	author robert;	state Exp;
branches;
next	1.68;
commitid	jO6C9hStsUwmszIM;

1.68
date	2015.11.06.18.31.45;	author sthen;	state Exp;
branches;
next	1.67;
commitid	bxfqqxWYDTbKolvQ;

1.67
date	2015.10.14.19.36.01;	author robert;	state Exp;
branches;
next	1.66;
commitid	BPcspjWq1zilTHfi;

1.66
date	2015.09.18.09.18.22;	author sthen;	state Exp;
branches;
next	1.65;
commitid	x1OqzrB6vMfHx6Ez;

1.65
date	2015.07.30.09.46.18;	author robert;	state Exp;
branches;
next	1.64;
commitid	J1cb6EIhxytPnha4;

1.64
date	2015.04.03.12.21.20;	author schwarze;	state Exp;
branches;
next	1.63;
commitid	PAYYljd3Dv5bZGp8;

1.63
date	2014.11.19.09.41.05;	author brad;	state Exp;
branches;
next	1.62;
commitid	nEDZOmTIcpKPZlwL;

1.62
date	2014.11.15.10.17.44;	author robert;	state Exp;
branches;
next	1.61;
commitid	VcYTCuRa27ydXnLY;

1.61
date	2014.11.06.20.22.12;	author sthen;	state Exp;
branches;
next	1.60;
commitid	iK2fZMSVwq6iHDGh;

1.60
date	2014.11.06.17.34.33;	author sthen;	state Exp;
branches;
next	1.59;
commitid	RG11JOeSvpyBzKPi;

1.59
date	2014.10.28.13.07.47;	author sthen;	state Exp;
branches;
next	1.58;
commitid	L9dG0bsPgKgVQ7M1;

1.58
date	2014.10.28.12.46.21;	author sthen;	state Exp;
branches;
next	1.57;
commitid	eGp0HFI1mA7frYyk;

1.57
date	2014.10.18.20.31.11;	author sthen;	state Exp;
branches;
next	1.56;
commitid	snE9tldJjsPCwIun;

1.56
date	2014.09.13.18.09.21;	author brad;	state Exp;
branches;
next	1.55;
commitid	PpbRjVZdAmlrmi8q;

1.55
date	2014.04.23.08.39.58;	author edd;	state Exp;
branches
	1.55.2.1;
next	1.54;

1.54
date	2014.04.21.15.35.34;	author sthen;	state Exp;
branches;
next	1.53;

1.53
date	2014.04.21.14.19.52;	author sthen;	state Exp;
branches;
next	1.52;

1.52
date	2014.03.27.14.04.34;	author sthen;	state Exp;
branches;
next	1.51;

1.51
date	2014.03.13.17.33.27;	author sthen;	state Exp;
branches;
next	1.50;

1.50
date	2014.01.16.23.17.32;	author sthen;	state Exp;
branches
	1.50.2.1;
next	1.49;

1.49
date	2013.10.24.18.20.39;	author landry;	state Exp;
branches;
next	1.48;

1.48
date	2013.10.17.09.11.34;	author ajacoutot;	state Exp;
branches;
next	1.47;

1.47
date	2013.08.08.18.59.26;	author robert;	state Exp;
branches;
next	1.46;

1.46
date	2013.08.08.18.53.36;	author robert;	state Exp;
branches;
next	1.45;

1.45
date	2013.08.08.14.25.43;	author robert;	state Exp;
branches;
next	1.44;

1.44
date	2013.06.20.06.54.38;	author ajacoutot;	state Exp;
branches;
next	1.43;

1.43
date	2013.06.17.19.30.33;	author ajacoutot;	state Exp;
branches;
next	1.42;

1.42
date	2013.06.12.20.36.33;	author brad;	state Exp;
branches;
next	1.41;

1.41
date	2013.06.03.02.46.57;	author naddy;	state Exp;
branches;
next	1.40;

1.40
date	2013.05.25.00.33.09;	author brad;	state Exp;
branches;
next	1.39;

1.39
date	2013.04.18.08.38.54;	author sthen;	state Exp;
branches;
next	1.38;

1.38
date	2013.03.11.12.27.54;	author sthen;	state Exp;
branches;
next	1.37;

1.37
date	2013.03.11.11.20.28;	author espie;	state Exp;
branches;
next	1.36;

1.36
date	2013.02.09.14.49.51;	author sthen;	state Exp;
branches;
next	1.35;

1.35
date	2012.11.30.12.56.02;	author sthen;	state Exp;
branches;
next	1.34;

1.34
date	2012.11.28.10.47.12;	author sthen;	state Exp;
branches;
next	1.33;

1.33
date	2012.09.27.16.45.51;	author ajacoutot;	state Exp;
branches;
next	1.32;

1.32
date	2012.08.23.19.19.17;	author sthen;	state Exp;
branches;
next	1.31;

1.31
date	2012.06.27.19.28.52;	author naddy;	state Exp;
branches;
next	1.30;

1.30
date	2012.06.21.06.58.51;	author ajacoutot;	state Exp;
branches;
next	1.29;

1.29
date	2012.06.16.12.51.06;	author sthen;	state Exp;
branches;
next	1.28;

1.28
date	2012.04.28.08.34.56;	author sthen;	state Exp;
branches;
next	1.27;

1.27
date	2012.04.23.17.15.18;	author espie;	state Exp;
branches;
next	1.26;

1.26
date	2012.01.25.11.17.22;	author sthen;	state Exp;
branches
	1.26.2.1;
next	1.25;

1.25
date	2012.01.21.23.34.35;	author sthen;	state Exp;
branches;
next	1.24;

1.24
date	2012.01.13.17.59.07;	author sthen;	state Exp;
branches;
next	1.23;

1.23
date	2011.11.17.12.52.27;	author robert;	state Exp;
branches;
next	1.22;

1.22
date	2011.11.08.10.25.48;	author sthen;	state Exp;
branches;
next	1.21;

1.21
date	2011.10.02.11.16.19;	author espie;	state Exp;
branches;
next	1.20;

1.20
date	2011.10.02.10.56.16;	author espie;	state Exp;
branches;
next	1.19;

1.19
date	2011.08.27.13.13.13;	author robert;	state Exp;
branches;
next	1.18;

1.18
date	2011.07.22.10.19.23;	author sthen;	state Exp;
branches
	1.18.2.1;
next	1.17;

1.17
date	2011.07.15.12.57.42;	author robert;	state Exp;
branches;
next	1.16;

1.16
date	2011.07.14.12.40.48;	author robert;	state Exp;
branches;
next	1.15;

1.15
date	2011.07.09.00.41.44;	author robert;	state Exp;
branches;
next	1.14;

1.14
date	2011.07.08.17.45.08;	author robert;	state Exp;
branches;
next	1.13;

1.13
date	2011.07.06.23.56.08;	author ajacoutot;	state Exp;
branches;
next	1.12;

1.12
date	2011.06.18.19.49.50;	author sthen;	state Exp;
branches;
next	1.11;

1.11
date	2011.05.12.14.30.12;	author robert;	state Exp;
branches;
next	1.10;

1.10
date	2011.03.26.10.23.13;	author sthen;	state Exp;
branches;
next	1.9;

1.9
date	2011.03.21.18.29.07;	author ajacoutot;	state Exp;
branches;
next	1.8;

1.8
date	2011.03.15.19.49.42;	author jasper;	state Exp;
branches;
next	1.7;

1.7
date	2011.03.08.23.45.47;	author ajacoutot;	state Exp;
branches;
next	1.6;

1.6
date	2011.01.17.19.30.26;	author sthen;	state Exp;
branches;
next	1.5;

1.5
date	2011.01.05.09.31.22;	author robert;	state Exp;
branches;
next	1.4;

1.4
date	2010.11.17.08.05.18;	author espie;	state Exp;
branches;
next	1.3;

1.3
date	2010.09.10.10.42.17;	author robert;	state Exp;
branches;
next	1.2;

1.2
date	2010.07.21.17.04.29;	author steven;	state Exp;
branches;
next	1.1;

1.1
date	2010.06.27.20.28.44;	author robert;	state Exp;
branches
	1.1.1.1;
next	;

1.1.1.1
date	2010.06.27.20.28.44;	author robert;	state Exp;
branches;
next	;

1.18.2.1
date	2011.11.08.10.27.04;	author sthen;	state Exp;
branches;
next	;

1.26.2.1
date	2012.05.08.21.35.02;	author sthen;	state Exp;
branches;
next	1.26.2.2;

1.26.2.2
date	2012.05.09.15.20.26;	author sthen;	state Exp;
branches;
next	;

1.50.2.1
date	2014.10.22.12.24.34;	author robert;	state Exp;
branches;
next	1.50.2.2;
commitid	l8sYxvAjq1InPtYH;

1.50.2.2
date	2014.11.18.08.25.11;	author robert;	state Exp;
branches;
next	;
commitid	xgrbR4IpwVnBGbws;

1.55.2.1
date	2014.10.22.12.23.08;	author robert;	state Exp;
branches;
next	;
commitid	QstwVZIHILQ7Q6Od;


desc
@@


1.96
log
@Let php-intl RUN_DEPENDS on icu4c,-wwwdata. (was supposed to be in previous commit,
but I missed Makefile.inc from the command line when committing).
@
text
@# $OpenBSD: Makefile.inc,v 1.95 2017/07/16 19:18:59 espie Exp $

BROKEN-hppa=	no __sync_bool_compare_and_swap support nor asm fallback

COMMENT-main=		server-side HTML-embedded scripting language
COMMENT-fastcgi=	stand-alone FastCGI version of PHP

PKGNAME-main?=		php-${V}
PKGNAME-fastcgi?=	php-fastcgi-${V}

DISTFILES?=		php-${V}.tar.bz2

DISTNAME?=		php-${V}
CATEGORIES=		lang www

MAINTAINER=		Robert Nagy <robert@@openbsd.org>
HOMEPAGE=		http://www.php.net/

MASTER_SITES=		http://se.php.net/distributions/ \
			http://us.php.net/distributions/ \
			http://no.php.net/distributions/ \
			http://uk.php.net/distributions/
MASTER_SITES0=		https://download.suhosin.org/

# UPGRADERS: please read BOTH the PHP and Zend licenses
# and make sure they are safe before an upgrade
PERMIT_PACKAGE_CDROM=   Yes

MODULES+=		gcc4
# for atomic builtins
MODGCC4_ARCHS+=		arm
MODGCC4_LANGS+=		c++

MODPHP_CONFIG_PATH=	/var/www/conf

# where the main php module is stored (outside the chroot)
APACHE_MODULE_SUBDIR=	lib/php-${PV}
APACHE_MODULE_DIR=	${LOCALBASE}/${APACHE_MODULE_SUBDIR}

# where the PEAR and extension modules are (inside the chroot)
CHROOT_DIR?=		/var/www
MODULES_SUBDIR=		lib/php-${PV}/modules
MODULES_DIR=		${LOCALBASE}/${MODULES_SUBDIR}

INI_TEMPLATES?=		development production

# XXX use the bundled libtool because it needs some specific options we
# don't have.
USE_LIBTOOL?=		No

.if ${PV} != "7.0"
FLAVORS=		no_suhosin
.endif
FLAVOR?=

PATCHORIG=		.orig.port
CONFIGURE_STYLE=	autoconf
AUTOCONF_VERSION?=	2.69
CONFIGURE_ENV+=		CFLAGS="${CFLAGS} -I${LOCALBASE}/include -pthread" \
			LDFLAGS="-L${LOCALBASE}/lib -pthread" \
			EXTENSION_DIR=${MODULES_DIR} \
			COMPILER_LIBCXX="${LIBCXX}" \
			lt_cv_path_SED=/usr/bin/sed
# configure detects us as having decimal fp support but it's not built in
# in libgcc. https://bugs.php.net/bug.php?id=68114
CONFIGURE_ENV+=		ac_cv_decimal_fp_supported=no
MAKE_ENV=               ${CONFIGURE_ENV}

CONFIGURE_ARGS+=	--enable-shared \
			--disable-static \
			--disable-rpath \
			--with-config-file-path=${SYSCONFDIR} \
			--enable-inline-optimization \
			--with-pic \
			--with-pear=${LOCALBASE}/share/php-${PV} \
			--with-config-file-scan-dir=${SYSCONFDIR}/php-${PV} \
			--with-pdo-sqlite \
			--enable-sqlite-utf8 \
			--with-sqlite3 \
			--program-suffix=-${PV}

# readline is broken in PHP-5.3
.if ${PV} != 5.3
CONFIGURE_ARGS +=	--with-readline
.endif

# apache module
CONFIGURE_ARGS+=	--with-apxs2=${LOCALBASE}/sbin/apxs2
BUILD_DEPENDS+=		www/apache-httpd

# default included extensions
CONFIGURE_ARGS+= 	--with-openssl \
			--with-zlib \
			--enable-xml \
			--enable-wddx \
			--enable-cli \
			--with-iconv=${LOCALBASE} \
			--with-gettext=${LOCALBASE} \
			--enable-bcmath \
			--enable-session \
			--enable-calendar \
			--enable-ctype \
			--enable-ftp \
			--with-pcre-regex \
			--enable-sockets \
			--enable-sysvmsg \
			--enable-sysvsem \
			--enable-sysvshm \
			--enable-mbstring \
			--enable-exif \
			--enable-zend-multibyte \
			--enable-fastcgi \
			--enable-fpm \
			--with-fpm-user=www \
			--with-fpm-group=www

TEST_TARGET=		test
TEST_FLAGS=		NO_INTERACTION=1

MULTI_PACKAGES+=	-main -fastcgi

#
# Loadable php extensions by name that are included in all versions
#

# bz2
MULTI_PACKAGES+=	-bz2
COMMENT-bz2=		bzip2 compression extensions for php5
CONFIGURE_ARGS+=	--with-bz2=shared,${LOCALBASE}
LIB_DEPENDS-bz2=	archivers/bzip2
WANTLIB-bz2=		bz2>=10 pthread

# curl
MULTI_PACKAGES+=	-curl
COMMENT-curl=		curl URL library extensions for php5
CONFIGURE_ARGS+=	--with-curl=shared,${LOCALBASE}
LIB_DEPENDS-curl=	net/curl
WANTLIB-curl=		pthread crypto nghttp2 ssl z curl>=2

# dba
MULTI_PACKAGES+=	-dba
COMMENT-dba=		dba GDBM access extensions for php5
CONFIGURE_ARGS+=	--enable-dba=shared --with-gdbm=${LOCALBASE}
LIB_DEPENDS-dba=	databases/gdbm
WANTLIB-dba=		gdbm>=2 pthread

# gd
MULTI_PACKAGES+=	-gd
COMMENT-gd=		image manipulation extensions for php5
LIB_DEPENDS-gd=		graphics/jpeg \
			graphics/png
.if ${PV} != "7.0"
LIB_DEPENDS-gd+=	devel/t1lib
WANTLIB-gd+=		t1>=5
.endif
WANTLIB-gd+=		z jpeg>=62 png>=3 pthread X11 Xpm freetype
CONFIGURE_ARGS+=	--with-gd=shared \
			--with-jpeg-dir=${LOCALBASE} \
			--with-png-dir=${LOCALBASE} \
			--with-zlib-dir=/usr \
			--with-t1lib=${LOCALBASE} \
			--with-freetype-dir=${X11BASE} \
			--with-xpm-dir=${X11BASE}

# gmp
MULTI_PACKAGES+=	-gmp
COMMENT-gmp=		gmp math library support for php5
CONFIGURE_ARGS+=	--with-gmp=shared,${LOCALBASE}
LIB_DEPENDS-gmp=	devel/gmp
WANTLIB-gmp=		gmp>=4 pthread

# intl
MULTI_PACKAGES+=	-intl
COMMENT-intl=		intl library support for php5
CONFIGURE_ARGS+=	--enable-intl=shared \
			--with-icu-dir=${LOCALBASE}
LIB_DEPENDS-intl=	textproc/icu4c
RUN_DEPENDS-intl=	textproc/icu4c,-wwwdata
WANTLIB-intl=		${COMPILER_LIBCXX} icudata icui18n icuio icuuc m pthread

# imap
MULTI_PACKAGES+=	-imap
COMMENT-imap=		imap, pop3 and nntp extensions for php5
CONFIGURE_ARGS+=	--with-imap=shared,${LOCALBASE} \
			--with-imap-ssl
LIB_DEPENDS-imap=	mail/alpine,-c-client
WANTLIB-imap=		pthread crypto ssl c-client>=5

# ldap
MULTI_PACKAGES+=	-ldap
COMMENT-ldap=		ldap protocol extensions for php5
CONFIGURE_ARGS+=	--with-ldap=shared,${LOCALBASE}
LIB_DEPENDS-ldap=	databases/openldap
WANTLIB-ldap=		pthread ldap>=2 lber

# mcrypt
MULTI_PACKAGES+=	-mcrypt
COMMENT-mcrypt=		mcrypt encryption/decryption extensions for php5
CONFIGURE_ARGS+=	--with-mcrypt=shared,${LOCALBASE}
LIB_DEPENDS-mcrypt=	security/libmcrypt devel/libtool,-ltdl
WANTLIB-mcrypt=		mcrypt ltdl>=1 pthread

.if ${PV} != "7.0"
# mysql
MULTI_PACKAGES+=	-mysql
COMMENT-mysql=		mysql database access extensions for php5
CONFIGURE_ARGS+=	--with-mysql=shared,${LOCALBASE}
LIB_DEPENDS-mysql=	databases/mariadb
WANTLIB-mysql=		pthread lib/mysql/mysqlclient
.endif

# mysqli
MULTI_PACKAGES+=	-mysqli
COMMENT-mysqli=		mysql database access extensions for php5
CONFIGURE_ARGS+=	--with-mysqli=shared,${LOCALBASE}/bin/mysql_config
LIB_DEPENDS-mysqli=	databases/mariadb
WANTLIB-mysqli=		crypto m pthread ssl z lib/mysql/mysqlclient

# odbc
MULTI_PACKAGES+=	-odbc
COMMENT-odbc=		odbc database access extensions for php5
CONFIGURE_ARGS+=        --with-iodbc=shared,${LOCALBASE}
LIB_DEPENDS-odbc=	databases/iodbc
WANTLIB-odbc=		iodbc>=2 pthread
.if ${PV} != "5.3"
WANTLIB-odbc+=		iodbcinst
.endif

# pcntl
MULTI_PACKAGES+=	-pcntl
COMMENT-pcntl=		PCNTL extensions for php5
CONFIGURE_ARGS+=	--enable-pcntl=shared
LIB_DEPENDS-pcntl=
WANTLIB-pcntl=		pthread

# pdo-mysql
MULTI_PACKAGES+=	-pdo_mysql
COMMENT-pdo_mysql=	PDO mysql database access extensions for php5
CONFIGURE_ARGS+=	--with-pdo-mysql=shared,${LOCALBASE}
LIB_DEPENDS-pdo_mysql=	databases/mariadb
WANTLIB-pdo_mysql=	crypto m pthread ssl z lib/mysql/mysqlclient

# pdo-pgsql
MULTI_PACKAGES+=	-pdo_pgsql
COMMENT-pdo_pgsql=	PDO database access extensions for php5
CONFIGURE_ARGS+=        --with-pdo-pgsql=shared,${LOCALBASE}
LIB_DEPENDS-pdo_pgsql=	databases/postgresql
WANTLIB-pdo_pgsql=	pq>=2 pthread

# pgsql
MULTI_PACKAGES+=	-pgsql
COMMENT-pgsql=		pgsql database access extensions for php5
CONFIGURE_ARGS+=	--with-pgsql=shared,${LOCALBASE}
LIB_DEPENDS-pgsql=	databases/postgresql
WANTLIB-pgsql=		pq>=2 pthread

# pspell
MULTI_PACKAGES+=	-pspell
COMMENT-pspell=		pspell library extensions for php5
CONFIGURE_ARGS+=	--with-pspell=shared,${LOCALBASE}
LIB_DEPENDS-pspell=	textproc/aspell/core
WANTLIB-pspell=		aspell>=16 pspell>=16 pthread

# shmop
MULTI_PACKAGES+=	-shmop
COMMENT-shmop=		shared memory extensions for php5
CONFIGURE_ARGS+=	--enable-shmop=shared,${LOCALBASE}
LIB_DEPENDS-shmop=
WANTLIB-shmop=		pthread

# soap
MULTI_PACKAGES+=	-soap
COMMENT-soap=		SOAP functions for php5
CONFIGURE_ARGS+=	--enable-soap=shared,${LOCALBASE}
LIB_DEPENDS-soap=	textproc/libxml
WANTLIB-soap=		iconv m pthread z xml2>=8 lzma

# snmp
MULTI_PACKAGES+=	-snmp
COMMENT-snmp=		snmp protocol extensions for php5
CONFIGURE_ARGS+=	--with-snmp=shared,${LOCALBASE} --enable-ucd-snmp-hack
LIB_DEPENDS-snmp=	net/net-snmp
WANTLIB-snmp=		crypto m netsnmp>=6.2 pthread

.if ${PV} != "7.0"
# sybase-ct
MULTI_PACKAGES+=	-sybase_ct
COMMENT-sybase_ct=	sybase database access extensions for php5
CONFIGURE_ARGS+=	--with-sybase-ct=shared,${LOCALBASE}
LIB_DEPENDS-sybase_ct=	databases/freetds
WANTLIB-sybase_ct=	ct pthread
.endif

# pdo-dblib
MULTI_PACKAGES+=	-pdo_dblib
COMMENT-pdo_dblib=	PDO DB-LIB support for php5
CONFIGURE_ARGS+=        --with-pdo-dblib=shared,${LOCALBASE}
LIB_DEPENDS-pdo_dblib=	databases/freetds
WANTLIB-pdo_dblib=	sybdb>=6 pthread

.if ${PV} != "7.0"
# mssql
MULTI_PACKAGES+=	-mssql
COMMENT-mssql=		microsoft sql access extensions for php5
CONFIGURE_ARGS+=        --with-mssql=shared,${LOCALBASE}
LIB_DEPENDS-mssql=	databases/freetds
WANTLIB-mssql=		sybdb>=6 pthread
.endif

# tidy
MULTI_PACKAGES+=	-tidy
COMMENT-tidy=		tidy HTML cleaner bindings
CONFIGURE_ARGS+=	--with-tidy=shared,${LOCALBASE}
LIB_DEPENDS-tidy=	www/tidyp
WANTLIB-tidy=		tidyp pthread

# xml-rpc
MULTI_PACKAGES+=	-xmlrpc
COMMENT-xmlrpc=		XML RPC functions for php5
CONFIGURE_ARGS+=	--with-xmlrpc=shared
LIB_DEPENDS-xmlrpc=	textproc/libxml
WANTLIB-xmlrpc=		iconv m z xml2>=8 pthread lzma

# xsl
MULTI_PACKAGES+=	-xsl
COMMENT-xsl=		XSL functions for php5
CONFIGURE_ARGS+=	--with-xsl=shared --enable-dom
LIB_DEPENDS-xsl=	textproc/libxslt
WANTLIB-xsl=		iconv m xml2 z xslt>=3 exslt pthread lzma

# zip
MULTI_PACKAGES+=	-zip
COMMENT-zip=		zip functions for php5
CONFIGURE_ARGS+=	--enable-zip=shared,${LOCALBASE}
LIB_DEPENDS-zip=
WANTLIB-zip=		z pthread

# some variables to substitute
SUBST_VARS=	MODPHP_CONFIG_PATH SV PV ^MODULE_NAME
PHP_VERSION=	${V}
SV=		${PV:S/.//}

.for i in TRUEPREFIX MODULES_DIR PHP_VERSION APACHE_MODULE_DIR
PHPXS_SUBST+= -e 's,${i},${${i}},'
.endfor

WANTLIB-main+=		c crypto iconv intl lzma m pthread ssl xml2>=8 z
WANTLIB-main+=		ncurses readline ${COMPILER_LIBCXX}

# php 5.4/5.5 : WANTLIB-main += ${COMPILER_LIBCXX}
WANTLIB-fastcgi=	${WANTLIB-main}
LIB_DEPENDS-main=	devel/gettext \
			textproc/libxml
RUN_DEPENDS-main=	mail/femail,-chroot
LIB_DEPENDS-fastcgi=	${LIB_DEPENDS-main}
RUN_DEPENDS-fastcgi=

SUHOSIN_V=		0.9.38
.if ${FLAVOR:Mno_suhosin} || ${PV} == "7.0"
SUPDISTFILES=		suhosin-${SUHOSIN_V}.tar.gz:0
.else
DISTFILES+=		suhosin-${SUHOSIN_V}.tar.gz:0
PATCH_LIST=		patch-* suhosin-*
CONFIGURE_ARGS+=	--enable-suhosin

pre-patch:
	@@mv ${WRKDIR}/suhosin-${SUHOSIN_V} ${WRKSRC}/ext/suhosin
.endif

pre-fake:
	${INSTALL_DATA_DIR} ${PREFIX}/${APACHE_MODULE_SUBDIR}/modules

INSTALL_TARGET=	install-headers install-build install-programs
DESTDIRNAME=	INSTALL_ROOT

pre-configure:
	${SUBST_CMD} ${WRKSRC}/main/php_ini.c
	@@perl -pi -e "s,OPENBSD_PEAR_ROOT,'${CHROOT_DIR}/pear',g;" \
		-e "s,OPENBSD_PREFIX,${TRUEPREFIX},;" \
		${WRKSRC}/scripts/phpize.in \
		${WRKSRC}/scripts/php-config.in

.for i in ${MULTI_PACKAGES:N-main:N-fastcgi:S/-//g}
MODULE_NAME-${i}=	${i}
DESCR-${i}=		${.CURDIR}/../files/DESCR-${i}
PKGNAME-${i}=		php-${i}-${V}
.if ${V:M5.4*}
PKGSPEC-${i}=		php-${i}->=5.4,<5.5
.elif ${V:M5.5*}
PKGSPEC-${i}=		php-${i}->=5.5,<5.6
.elif ${V:M5.6*}
PKGSPEC-${i}=		php-${i}->=5.6,<5.7
.elif ${V:M7.0*}
PKGSPEC-${i}=		php-${i}->=7.0,<7.1
.endif
RUN_DEPENDS-${i}+=	php-${V}:lang/php/${PV}
.endfor

DESCR-main=		${.CURDIR}/../files/DESCR-main
DESCR-fastcgi=		${.CURDIR}/../files/DESCR-fastcgi

post-install:
	${SUBST_DATA} ${.CURDIR}/../files/README-main \
		${PREFIX}/share/doc/pkg-readmes/${FULLPKGNAME-main}
	${INSTALL_DATA} ${WRKBUILD}/.libs/libphp${PV:C/\.[0-9]$//}.so \
		${PREFIX}/${APACHE_MODULE_SUBDIR}/
	${INSTALL_DATA_DIR} ${WRKINST}/${CHROOT_DIR}/conf/php-${PV}.sample
	${INSTALL_DATA_DIR} ${PREFIX}/share/examples/php-${PV}
	${INSTALL_PROGRAM} ${WRKBUILD}/sapi/cli/php ${PREFIX}/bin/php-${PV}
	${INSTALL_PROGRAM} ${WRKBUILD}/sapi/cgi/php-cgi ${PREFIX}/bin/php-fastcgi-${PV}
	${INSTALL_PROGRAM} ${WRKBUILD}/sapi/fpm/php-fpm ${PREFIX}/sbin/php-fpm-${PV}
	${INSTALL_MAN} ${WRKBUILD}/sapi/fpm/php-fpm.8 ${PREFIX}/man/man8/php-fpm-${PV}.8
	${INSTALL_DATA} ${WRKBUILD}/sapi/fpm/php-fpm.conf \
		${PREFIX}/share/examples/php-${PV}/php-fpm.conf
.if ${PV} == "7.0"
	cat ${WRKBUILD}/sapi/fpm/www.conf >> \
		${PREFIX}/share/examples/php-${PV}/php-fpm.conf
.endif

	${INSTALL_DATA} ${.CURDIR}/../files/php.conf \
		${PREFIX}/share/examples/php-${PV}/php.conf
	@@perl -pi -e "s,!!PREFIX!!,${TRUEPREFIX},g;s,!!PV!!,${PV},g;s,!!MV!!,${PV:R},g" \
		${PREFIX}/share/examples/php-${PV}/php.conf

.for m in ${MULTI_PACKAGES:N-main:N-fastcgi:S/-//g}
	${INSTALL_DATA} ${WRKBUILD}/modules/${m}.so \
		${PREFIX}/${MODULES_SUBDIR}/${m}.so
	echo "extension=${m}.so" > \
		${PREFIX}/share/examples/php-${PV}/${m}.ini
.endfor
	if [ -f ${WRKBUILD}/modules/opcache.so ]; then \
		${INSTALL_DATA} ${WRKBUILD}/modules/opcache.so \
		    ${PREFIX}/${MODULES_SUBDIR}/opcache.so; \
		echo "zend_extension=opcache.so" > \
		    ${PREFIX}/share/examples/php-${PV}/opcache.ini; fi
	${INSTALL_DATA_DIR} ${WRKINST}/${CHROOT_DIR}/etc
	echo "www:*:67:67::0:0:dummy user to appease c-client:/nonexistent:/sbin/nologin" > \
		${WRKINST}/${CHROOT_DIR}/etc/master.passwd.imap
	pwd_mkdb -d ${WRKINST}/${CHROOT_DIR}/etc master.passwd.imap

.for i in ${INI_TEMPLATES}
	@@sed -e 's,MODULES_DIR,${MODULES_DIR},' \
	     -e 's,OPENBSD_INCLUDE_PATH,/pear/lib:${CHROOT_DIR}/pear/lib,' \
		<${WRKSRC}/php.ini-${i} \
		>${PREFIX}/share/examples/php-${PV}/php.ini-${i}
.endfor
	${INSTALL_MAN} ${WRKSRC}/sapi/cli/php.1 ${PREFIX}/man/man1/php-${PV}.1
@


1.95
log
@use COMPILER_LIBCXX where applicable
@
text
@d1 1
a1 1
# $OpenBSD: Makefile.inc,v 1.94 2017/06/12 11:48:34 sthen Exp $
d178 1
@


1.94
log
@update to php-7.0.20, sync -intl WANTLIB
ok robert@@
@
text
@d1 1
a1 1
# $OpenBSD: Makefile.inc,v 1.93 2017/04/26 08:15:05 sthen Exp $
d62 1
a62 1
			LIBCXX="${LIBCXX}" \
d178 1
a178 1
WANTLIB-intl=		${LIBCXX} icudata icui18n icuio icuuc m pthread
d347 1
a347 1
WANTLIB-main+=		ncurses readline ${LIBCXX}
d349 1
a349 1
# php 5.4/5.5 : WANTLIB-main += ${LIBCXX}
@


1.93
log
@Don't hardcode libstdc++, pass it in from LIBCXX. Fixes build of Apache module
on libc++ arches (otherwise the nonexistent -lstdc++ caused libtool to generate
a static library instead of shared .so module). ok robert@@
@
text
@d1 1
a1 1
# $OpenBSD: Makefile.inc,v 1.92 2017/04/10 11:46:22 sthen Exp $
d178 1
a178 1
WANTLIB-intl=		icudata icui18n icuio icuuc pthread
@


1.92
log
@use LIBCXX
@
text
@d1 1
a1 1
# $OpenBSD: Makefile.inc,v 1.91 2017/01/26 23:04:16 sthen Exp $
d62 1
@


1.91
log
@disable pcre jit in php/7.0 with a CONFIGURE_ARGS, move the BROKEN-alpha out
from Makefile.inc to 5.5 / 5.6 / 5.7, allowing 7.0 a chance to build there.
ok robert@@
@
text
@d1 1
a1 1
# $OpenBSD: Makefile.inc,v 1.90 2017/01/24 00:40:13 jca Exp $
d346 1
a346 1
WANTLIB-main+=		ncurses readline stdc++
d348 1
a348 1
# php 5.4/5.5 : WANTLIB-main += stdc++
@


1.90
log
@BROKEN on alpha: pcre_jit_compile.c:65:2: error: #error Unsupported architecture
@
text
@d1 1
a1 2
# $OpenBSD: Makefile.inc,v 1.89 2017/01/05 16:59:31 jca Exp $
#
a2 1
BROKEN-alpha=	pcre_jit_compile.c:65:2: error: #error Unsupported architecture
@


1.89
log
@Use lang/gcc for atomic builtins on arm.

Similar diff from jsg@@, ok sthen@@ phessler@@
@
text
@d1 1
a1 1
# $OpenBSD: Makefile.inc,v 1.88 2016/11/04 11:35:19 sthen Exp $
d4 1
@


1.88
log
@sync WANTLIB (and in one case, add gettext to LIB_DEPENDS) in dependent ports
now that internationalised domain name support has been removed from net/curl
@
text
@d1 1
a1 1
# $OpenBSD: Makefile.inc,v 1.87 2016/10/31 15:05:51 robert Exp $
d29 5
@


1.87
log
@fix wantlib for some subpackages
@
text
@d1 1
a1 1
# $OpenBSD: Makefile.inc,v 1.86 2016/06/25 18:55:11 sthen Exp $
d133 1
a133 1
WANTLIB-curl=		pthread crypto idn nghttp2 ssl z curl>=2
@


1.86
log
@update to php-7.0.8 and fix FLAVORS handling to properly knock out no_suhosin
ok robert@@
@
text
@d1 1
a1 1
# $OpenBSD: Makefile.inc,v 1.85 2016/06/22 21:18:32 sthen Exp $
d270 1
a270 1
WANTLIB-soap=		iconv m pthread z xml2>=8
d316 1
a316 1
WANTLIB-xmlrpc=		iconv m z xml2>=8 pthread
d323 1
a323 1
WANTLIB-xsl=		iconv m xml2 z xslt>=3 exslt pthread
@


1.85
log
@fix no_suhosin build problem reported by Devin Ceartas
update to php-5.5.36, 5.6.22, 7.0.7
@
text
@d1 1
a1 1
# $OpenBSD: Makefile.inc,v 1.84 2016/04/28 18:19:23 sthen Exp $
d47 1
d49 1
@


1.84
log
@revert the revert: burn apache1 php modules, @@pkgpath is set so that updates
work from -ap2. ok robert
@
text
@d1 1
a1 1
# $OpenBSD: Makefile.inc,v 1.82 2016/04/28 18:06:46 sthen Exp $
d355 1
@


1.83
log
@oops, revert, too soon (the dangers of cvs ci -m)
@
text
@d1 1
a1 1
# $OpenBSD: Makefile.inc,v 1.81 2016/04/19 06:19:41 sthen Exp $
d47 1
a47 1
FLAVORS=		ap2 no_suhosin
d80 1
a80 1
.if ${FLAVOR:Map2} || ${PV} == "7.0"
a82 5
.else
# doesn't use apache-module.port.mk so MODAPACHE_APXS not available
CONFIGURE_ARGS+=	--with-apxs=${LOCALBASE}/sbin/apxs
BUILD_DEPENDS+=		www/apache-httpd-openbsd
.endif
a373 4
.if ${FLAVOR:Map2}
MULTI_PACKAGES :=       ${MULTI_PACKAGES:N-fastcgi}
.endif

a377 3
# don't build separate plugins for -ap2
FULLPKGNAME-${i}=	php-${i}-${V}${FLAVOR_EXT:S/-ap2//}
FULLPKGPATH-${i}=	${PKGPATH},-${i}${FLAVOR_EXT:S/-ap2//:S/-/,/g}
@


1.82
log
@5.4
@
text
@d47 1
a47 1
FLAVORS=		no_suhosin
d80 1
a80 1
# apache module
d83 5
d379 4
d387 3
@


1.81
log
@fix regex, from nigel@@
@
text
@d1 1
a1 1
# $OpenBSD: Makefile.inc,v 1.80 2016/04/18 09:45:52 sthen Exp $
d47 1
a47 1
FLAVORS=		ap2 no_suhosin
d80 1
a80 1
.if ${FLAVOR:Map2} || ${PV} == "7.0"
a82 5
.else
# doesn't use apache-module.port.mk so MODAPACHE_APXS not available
CONFIGURE_ARGS+=	--with-apxs=${LOCALBASE}/sbin/apxs
BUILD_DEPENDS+=		www/apache-httpd-openbsd
.endif
a373 4
.if ${FLAVOR:Map2}
MULTI_PACKAGES :=       ${MULTI_PACKAGES:N-fastcgi}
.endif

a377 3
# don't build separate plugins for -ap2
FULLPKGNAME-${i}=	php-${i}-${V}${FLAVOR_EXT:S/-ap2//}
FULLPKGPATH-${i}=	${PKGPATH},-${i}${FLAVOR_EXT:S/-ap2//:S/-/,/g}
@


1.80
log
@Don't hardcode 'php5' in config file and DESCRs, there is php7 now.
Reported and initial diff from Frank Groeneveld, revised by me, ok robert@@
@
text
@d1 1
a1 1
# $OpenBSD: Makefile.inc,v 1.79 2016/04/13 11:42:59 naddy Exp $
d425 1
a425 1
	@@perl -pi -e "s,!!PREFIX!!,${TRUEPREFIX},g;s,!!PV!!,${PV},g;s,!!MV!!,${PV:R}" \
@


1.79
log
@Replace iconv and gettext modules.
Clean up the dependencies of the -main and -fastcgi subpackages.
ok sthen@@ robert@@
@
text
@d1 1
a1 1
# $OpenBSD: Makefile.inc,v 1.78 2016/04/10 19:38:13 naddy Exp $
d425 1
a425 1
	@@perl -pi -e "s,!!PREFIX!!,${TRUEPREFIX},g;s,!!PV!!,${PV},g" \
@


1.78
log
@remove leftovers from the -fpm subpackage; ok sthen@@ robert@@
@
text
@d1 1
a1 1
# $OpenBSD: Makefile.inc,v 1.77 2016/04/08 20:25:51 robert Exp $
d273 1
a273 1
WANTLIB-soap=		${MODLIBICONV_WANTLIB} m pthread z xml2>=8
d319 1
a319 1
WANTLIB-xmlrpc=		${MODLIBICONV_WANTLIB} m z xml2>=8 pthread
d326 1
a326 1
WANTLIB-xsl=		${MODLIBICONV_WANTLIB} m xml2 z xslt>=3 exslt pthread
d344 1
a344 3
MODULES=		converters/libiconv devel/gettext

WANTLIB-main+=		c crypto lzma m pthread ssl xml2>=8 z ${MODGETTEXT_WANTLIB}
d349 3
a351 3
LIB_DEPENDS-main=	textproc/libxml
RUN_DEPENDS-main=	${MODGETTEXT_RUN_DEPENDS} \
			mail/femail,-chroot
d353 1
@


1.77
log
@add more exceptions for php-7.0
@
text
@d1 1
a1 1
# $OpenBSD: Makefile.inc,v 1.76 2016/03/17 16:58:01 sthen Exp $
d381 1
a381 1
MULTI_PACKAGES :=       ${MULTI_PACKAGES:N-fpm:N-fastcgi}
d384 1
a384 1
.for i in ${MULTI_PACKAGES:N-main:N-fastcgi:N-fpm:S/-//g}
d429 1
a429 1
.for m in ${MULTI_PACKAGES:N-main:N-fastcgi:N-fpm:S/-//g}
@


1.76
log
@oops, revert pieces which shouldn't have been in previous commit
@
text
@d1 1
a1 1
# $OpenBSD: Makefile.inc,v 1.74 2016/03/16 20:02:11 naddy Exp $
d53 2
a54 2
CONFIGURE_ENV=          CFLAGS="${CFLAGS} -I${LOCALBASE}/include -pthread" \
                        LDFLAGS="-L${LOCALBASE}/lib -pthread" \
d80 1
a80 1
.if ${FLAVOR:Map2}
d82 1
a82 1
BUILD_DEPENDS=		www/apache-httpd
d86 1
a86 1
BUILD_DEPENDS=		www/apache-httpd-openbsd
d357 1
a357 1
.if ${FLAVOR:Mno_suhosin}
@


1.75
log
@update to php-7.0.4, ok robert@@
@
text
@d53 1
a53 1
CONFIGURE_ENV=          CFLAGS="${CFLAGS} -I${LOCALBASE}/include -DZEND_MM_HEAP_PROTECTION -pthread" \
@


1.74
log
@removing SHARED_ONLY is safe here
@
text
@d1 1
a1 1
# $OpenBSD: Makefile.inc,v 1.73 2016/03/12 20:23:35 naddy Exp $
d53 1
a53 1
CONFIGURE_ENV=          CFLAGS="${CFLAGS} -I${LOCALBASE}/include -pthread" \
@


1.73
log
@remove NO_SHARED_ARCHS
@
text
@d1 1
a1 1
# $OpenBSD: Makefile.inc,v 1.72 2016/02/01 21:53:06 sthen Exp $
a28 2

SHARED_ONLY=		Yes
@


1.72
log
@move php MESSAGE/UNMESSAGE to a README instead, fleshed out with a
little more information about how to use it with different web servers.
feedback/OK jasper@@ aja@@, bumps etc to follow.
@
text
@d1 1
a1 1
# $OpenBSD: Makefile.inc,v 1.71 2016/01/07 18:06:45 sthen Exp $
a4 4

# This port currently only works with archs supporting dynamic loading
# and has Apache that supports DSO's.
NOT_FOR_ARCHS=		${NO_SHARED_ARCHS}
@


1.71
log
@merge php-fpm into the main php packages, making things easier for
httpd/nginx/lighttpd users.  ok robert@@
@
text
@d1 1
a1 1
# $OpenBSD: Makefile.inc,v 1.70 2015/12/15 23:02:49 ajacoutot Exp $
a392 2
MESSAGE-${i}=		${.CURDIR}/../files/MESSAGE-ext
UNMESSAGE-${i}=		${.CURDIR}/../files/UNMESSAGE-ext
a410 2
MESSAGE-main=		${.CURDIR}/../files/MESSAGE-main
UNMESSAGE-main=		${.CURDIR}/../files/UNMESSAGE-main
d413 2
@


1.70
log
@Unbreak.
@
text
@d1 1
a1 1
# $OpenBSD: Makefile.inc,v 1.69 2015/12/14 17:59:28 robert Exp $
d116 4
a119 1
			--enable-fastcgi
d124 1
a124 12
MULTI_PACKAGES+=	-main -fastcgi -fpm

# fpm
PKGNAME-fpm?=		php-fpm-${V}
COMMENT-fpm=		stand-alone FPM version of PHP
CONFIGURE_ARGS+=	--enable-fpm \
			--with-fpm-user=www \
			--with-fpm-group=www
LIB_DEPENDS-fpm=	${LIB_DEPENDS-main}
WANTLIB-fpm=		${WANTLIB-main}
RUN_DEPENDS-fpm=	${RUN_DEPENDS-main} \
			php-${V}:lang/php/${PV}
@


1.69
log
@add support for php-7.0 and remove the remaining 5.3 references
ok ajacoutot@@
@
text
@d1 1
a1 1
# $OpenBSD: Makefile.inc,v 1.68 2015/11/06 18:31:45 sthen Exp $
d361 1
@


1.68
log
@WANTLIB sync, missed from the big batch of curl nghttp2
@
text
@d1 1
a1 1
# $OpenBSD: Makefile.inc,v 1.67 2015/10/14 19:36:01 robert Exp $
d163 6
a168 3
			graphics/png \
			devel/t1lib
WANTLIB-gd=		z jpeg>=62 png>=3 t1>=5 pthread X11 Xpm freetype
d214 1
d221 1
d296 1
d303 1
d312 1
d319 1
a361 4
.if ${PV} != "5.3"
WANTLIB-main+=		ncurses readline stdc++
.endif

d406 1
a406 3
.if ${V:M5.3*}
PKGSPEC-${i}=		php-${i}->=5.3,<5.4
.elif ${V:M5.4*}
d412 2
d424 1
a424 1
	${INSTALL_DATA} ${WRKBUILD}/.libs/libphp5.so \
d434 4
@


1.67
log
@Re-introduce the suhosin extension and the no_suhosin flavor as well
which can be used to disable the suhosin extension in the php packages.

We are not going to build this flavor by default because people should
use suhosin by default, but in some corner-cases if someone wants to disable
it, the flavor can be used.

Also move some variables and the sybase_ct subpackage from the Makefiles
to the shared one, there is no need to have the same data in 3 different
Makefiles.
@
text
@d1 1
a1 1
# $OpenBSD: Makefile.inc,v 1.66 2015/09/18 09:18:22 sthen Exp $
d150 1
a150 1
WANTLIB-curl=		pthread crypto idn ssl z curl>=2
@


1.66
log
@de-conflict php-fpm packages, ok robert@@

Heads up! The rc script has changed name:

  sed -i s/php_fpm/php56_fpm/g /etc/rc.conf.local
@
text
@d1 4
a4 1
# $OpenBSD: Makefile.inc,v 1.65 2015/07/30 09:46:18 robert Exp $
d28 1
d47 7
a53 1
FLAVORS=		ap2
d291 7
d363 11
@


1.65
log
@remove all references to the suhosin patch
@
text
@d1 1
a1 1
# $OpenBSD: Makefile.inc,v 1.64 2015/04/03 12:21:20 schwarze Exp $
d324 1
a324 1
SUBST_VARS=	MODPHP_CONFIG_PATH PV ^MODULE_NAME
d326 1
@


1.64
log
@Drop USE_GROFF (no significant difference in output for any of the versions).
No bump needed.
@
text
@d1 1
a1 1
# $OpenBSD: Makefile.inc,v 1.63 2014/11/19 09:41:05 brad Exp $
a20 3
SUHOSIN_V=		0.9.33
SUHOSIN_PHPV?=		${V}

a24 4
MASTER_SITES0=		http://spacehopper.org/mirrors/ \
			http://download.suhosin.org/ \
			http://blade2k.humppa.hu/ \
			${_MASTER_SITE_FREEBSD}
a43 3
.if ${PV} == "5.3"
FLAVORS+=		no_suhosin
.endif
d53 1
a53 1
# configure detects us as having decimal fp support but it's not built in 
a344 15

.if ${PV} == "5.3"
.  if ${FLAVOR:Mno_suhosin}
SUPDISTFILES=		suhosin-${SUHOSIN_V}.tgz:0 \
			suhosin-patch-${SUHOSIN_PHPV}-${SUHOSIN_P_V}.patch.gz:0
.  else
DISTFILES+=		suhosin-${SUHOSIN_V}.tgz:0
PATCHFILES=		suhosin-patch-${SUHOSIN_PHPV}-${SUHOSIN_P_V}.patch.gz:0
PATCH_DIST_STRIP=	-p1
CONFIGURE_ARGS+=	--enable-suhosin

pre-patch:
	@@mv ${WRKDIR}/suhosin-${SUHOSIN_V} ${WRKSRC}/ext/suhosin
.  endif
.endif
@


1.63
log
@Add the missing PKGSPEC for 5.6.

ok robert@@
@
text
@d1 1
a1 1
# $OpenBSD: Makefile.inc,v 1.62 2014/11/15 10:17:44 robert Exp $
a55 1
USE_GROFF=		Yes
@


1.62
log
@fix lib-depends and prepare for php-5.6
@
text
@d1 1
a1 1
# $OpenBSD: Makefile.inc,v 1.61 2014/11/06 20:22:12 sthen Exp $
d404 2
@


1.61
log
@As reported by Mike <gmail/lesniewskister>, php 5.5 opcache isn't included
in the packages - it was already built, we just didn't install it.
@
text
@d1 1
a1 1
# $OpenBSD: Makefile.inc,v 1.60 2014/11/06 17:34:33 sthen Exp $
d51 1
a51 1
.if ${PV} != "5.4" && ${PV} != "5.5"
d188 1
a188 1
WANTLIB-intl=		icudata icui18n icuio icuuc m pthread
d231 4
a234 1
WANTLIB-odbc=		iodbcinst iodbc>=2 pthread
d344 6
a349 1
WANTLIB-main+=		c crypto m pthread ssl xml2>=8 z ${MODGETTEXT_WANTLIB}
d357 1
a357 1
.if ${PV} != "5.4" && ${PV} != "5.5"
@


1.60
log
@Since we got rid of 5.2, all versions of php in tree now support fpm and
pcntl, so move the Makefile parts up to Makefile.inc. Looks ok to robert@@
@
text
@d1 1
a1 1
# $OpenBSD: Makefile.inc,v 1.59 2014/10/28 13:07:47 sthen Exp $
d428 5
@


1.59
log
@remove useless conditional, we don't have 5.2 any more
@
text
@d1 1
a1 1
# $OpenBSD: Makefile.inc,v 1.58 2014/10/28 12:46:21 sthen Exp $
d122 12
a133 1
MULTI_PACKAGES+=	-main -fastcgi
d233 7
d381 1
a381 1
.for i in ${MULTI_PACKAGES:N-main:N-fastcgi:N-fpm:N-pcntl:S/-//g}
@


1.58
log
@use .elif, not .else if - this caused the wrong PKGSPEC to be used for
php/5.5 subpackages. plist_db says a REVISION bump is not needed.
@
text
@d1 1
a1 1
# $OpenBSD: Makefile.inc,v 1.57 2014/10/18 20:31:11 sthen Exp $
a393 2

.if ${V:M5.3*} || ${V:M5.4*} || ${V:M5.5*}
a397 1
.endif
@


1.57
log
@update to php 5.4.34, 5.5.18
ok robert@@ who also had a diff for this but forgot to commit it :)
@
text
@d1 1
a1 1
# $OpenBSD: Makefile.inc,v 1.56 2014/09/13 18:09:21 brad Exp $
d374 1
a374 1
.else if ${V:M5.4*}
d376 1
a376 1
.else if ${V:M5.5*}
@


1.56
log
@Switch from using MySQL to using MariaDB attempt #2. MariaDB is a drop-in replacement.

ok sthen@@
@
text
@d1 1
a1 1
# $OpenBSD: Makefile.inc,v 1.55 2014/04/23 08:39:58 edd Exp $
d62 5
a66 1
			EXTENSION_DIR=${MODULES_DIR} lt_cv_path_SED=/usr/bin/sed
@


1.55
log
@Enable readline support in PHP-5.4 and PHP-5.5.

(But not in PHP-5.3, since readline support is broken and EOL).

OK sthen@@, with input from ajacoutot@@, thanks.
@
text
@d1 1
a1 1
# $OpenBSD: Makefile.inc,v 1.54 2014/04/21 15:35:34 sthen Exp $
d201 2
a202 2
LIB_DEPENDS-mysql=	databases/mysql
WANTLIB-mysql=		pthread lib/mysql/mysqlclient>=10
d208 2
a209 2
LIB_DEPENDS-mysqli=	databases/mysql
WANTLIB-mysqli=		crypto m pthread ssl z lib/mysql/mysqlclient>=10
d222 2
a223 2
LIB_DEPENDS-pdo_mysql=	databases/mysql
WANTLIB-pdo_mysql=	crypto m pthread ssl z lib/mysql/mysqlclient>=10
@


1.55.2.1
log
@security update to 5.4.34
6 security-related bugs were fixed in this release,
including fixes for CVE-2014-3668, CVE-2014-3669 and CVE-2014-3670.
Also, a fix for OpenSSL which produced regressions was reverted

ok jasper@@
@
text
@d1 1
a1 1
# $OpenBSD: Makefile.inc,v 1.55 2014/04/23 08:39:58 edd Exp $
d62 1
a62 5
			EXTENSION_DIR=${MODULES_DIR} \
			lt_cv_path_SED=/usr/bin/sed
# configure detects us as having decimal fp support but it's not built in
# in libgcc. https://bugs.php.net/bug.php?id=68114
CONFIGURE_ENV+=		ac_cv_decimal_fp_supported=no
@


1.54
log
@also zap gssapi, spotted by aja
@
text
@d1 1
a1 1
# $OpenBSD: Makefile.inc,v 1.53 2014/04/21 14:19:52 sthen Exp $
d77 5
@


1.53
log
@sync wantlib
@
text
@d1 1
a1 1
# $OpenBSD: Makefile.inc,v 1.52 2014/03/27 14:04:34 sthen Exp $
d314 1
a314 2
WANTLIB-main+=		c crypto ssl z pthread gssapi xml2>=8 \
			m ${MODGETTEXT_WANTLIB}
@


1.52
log
@fix WANTLIB
@
text
@d1 1
a1 1
# $OpenBSD: Makefile.inc,v 1.51 2014/03/13 17:33:27 sthen Exp $
d174 1
a174 1
			--with-imap-ssl --with-kerberos
d176 1
a176 2
WANTLIB-imap=		pthread crypto gssapi krb5 ssl c-client>=5 \
			asn1 com_err heimbase roken wind
d314 2
a315 3
WANTLIB-main+=		c crypto ssl z pthread gssapi krb5 xml2>=8 \
			m asn1 com_err heimbase roken \
			wind ${MODGETTEXT_WANTLIB}
@


1.51
log
@handle httpd move, originally from florian@@, tweaks by me
@
text
@d1 1
a1 1
# $OpenBSD: Makefile.inc,v 1.50 2014/01/16 23:17:32 sthen Exp $
d212 1
a212 2
WANTLIB-odbc=		iodbc>=2 pthread
# php 5.4/5.5 : WANTLIB-odbc+=iodbcinst
d315 1
a315 1
WANTLIB-main=		c crypto ssl z pthread gssapi krb5 xml2>=8 \
@


1.50
log
@php 5.4 now uses autoconf 2.69 upstream, pointed out by Donovan Watteau,
adjust AUTOCONF_VERSION to match.
@
text
@d1 1
a1 1
# $OpenBSD: Makefile.inc,v 1.49 2013/10/24 18:20:39 landry Exp $
d82 3
a84 1
CONFIGURE_ARGS+=	--with-apxs=/usr/sbin/apxs
@


1.50.2.1
log
@security update 5.4.34
6 security-related bugs were fixed in this release,
including fixes for CVE-2014-3668, CVE-2014-3669 and CVE-2014-3670.
Also, a fix for OpenSSL which produced regressions was reverted

ok jasper@@
@
text
@d1 1
a1 1
# $OpenBSD: Makefile.inc,v 1.50 2014/01/16 23:17:32 sthen Exp $
d62 1
a62 5
			EXTENSION_DIR=${MODULES_DIR} \
			lt_cv_path_SED=/usr/bin/sed
# configure detects us as having decimal fp support but it's not built in
# in libgcc. https://bugs.php.net/bug.php?id=68114
CONFIGURE_ENV+=		ac_cv_decimal_fp_supported=no
@


1.50.2.2
log
@security update to 5.4.35; includes fixes for CVE-2014-3710

ok jasper@@
@
text
@d1 1
a1 1
# $OpenBSD: Makefile.inc,v 1.50.2.1 2014/10/22 12:24:34 robert Exp $
d214 1
a214 1
WANTLIB-odbc+=		iodbc>=2 pthread
d318 1
a318 1
WANTLIB-main+=		c crypto ssl z pthread gssapi krb5 xml2>=8 \
@


1.49
log
@Add an -intl subpackage for the php intl extension using ICU.
ok robert@@ (maintainer)
@
text
@d1 1
a1 1
# $OpenBSD: Makefile.inc,v 1.48 2013/10/17 09:11:34 ajacoutot Exp $
d59 1
a59 1
AUTOCONF_VERSION?=	2.13
@


1.48
log
@Fix deps after re-alpine -> alpine.
@
text
@d1 1
a1 1
# $OpenBSD: Makefile.inc,v 1.47 2013/08/08 18:59:26 robert Exp $
d160 8
d211 1
d317 1
@


1.47
log
@remove php 5.2 references and default to 5.4
@
text
@d1 1
a1 1
# $OpenBSD: Makefile.inc,v 1.46 2013/08/08 18:53:36 robert Exp $
d165 1
a165 1
LIB_DEPENDS-imap=	mail/re-alpine,-c-client
@


1.46
log
@WANTLIB cleanups (packages are bumped already) and add back sqlite3 support
to -main
@
text
@d1 1
a1 1
# $OpenBSD: Makefile.inc,v 1.45 2013/08/08 14:25:43 robert Exp $
d355 1
a355 3
.if ${V:M5.2*}
PKGSPEC-${i}=		php-${i}->=5.2,<5.3
.else if ${V:M5.3*}
d357 4
@


1.45
log
@there is no suhosin for 5.4 and 5.5 so remove that for those
versions and also remove the sqlite flavor from the common
Makefile because it gets moved to 5.3
@
text
@d1 1
a1 1
# $OpenBSD: Makefile.inc,v 1.44 2013/06/20 06:54:38 ajacoutot Exp $
a72 1
			--program-suffix=-${PV} \
d74 3
a76 1
			--enable-sqlite-utf8
d122 1
a122 1
WANTLIB-bz2=		bz2>=10 c pthread
d129 1
a129 1
WANTLIB-curl=		c pthread crypto idn ssl z curl>=2 ${MODGETTEXT_WANTLIB}
d136 1
a136 1
WANTLIB-dba=		c gdbm>=2 pthread
d144 1
a144 1
WANTLIB-gd=		z jpeg>=62 png>=3 t1>=5 c pthread X11 Xpm freetype
d158 1
a158 1
WANTLIB-gmp=		c gmp>=4 pthread
d166 1
a166 1
WANTLIB-imap=		c pthread crypto gssapi krb5 ssl c-client>=5 \
d174 1
a174 1
WANTLIB-ldap=		c pthread ldap>=2 lber
d181 1
a181 1
WANTLIB-mcrypt=		c mcrypt ltdl>=1 pthread
d188 1
a188 1
WANTLIB-mysql=		c pthread lib/mysql/mysqlclient>=10
d195 1
a195 1
WANTLIB-mysqli=		c crypto m pthread ssl z lib/mysql/mysqlclient>=10
d202 1
a202 1
WANTLIB-odbc=		c iodbc>=2 pthread
d209 1
a209 1
WANTLIB-pdo_mysql=	c crypto m pthread ssl z lib/mysql/mysqlclient>=10
d216 1
a216 1
WANTLIB-pdo_pgsql=	c pq>=2 pthread
d223 1
a223 1
WANTLIB-pgsql=		c pq>=2 pthread
d230 1
a230 1
WANTLIB-pspell=		aspell>=16 c pspell>=16 pthread
d237 1
a237 1
WANTLIB-shmop=		c pthread
d244 1
a244 1
WANTLIB-soap=		${MODLIBICONV_WANTLIB} c m pthread z xml2>=8
d251 1
a251 1
WANTLIB-snmp=		c crypto m netsnmp>=6.2 pthread
d258 1
a258 1
WANTLIB-pdo_dblib=	sybdb>=6 c pthread
d265 1
a265 1
WANTLIB-mssql=		sybdb>=6 c pthread
d272 1
a272 1
WANTLIB-tidy=		tidyp c pthread
d279 1
a279 1
WANTLIB-xmlrpc=		${MODLIBICONV_WANTLIB} m z xml2>=8 c pthread
d286 1
a286 1
WANTLIB-xsl=		${MODLIBICONV_WANTLIB} m xml2 z xslt>=3 exslt c pthread
d293 1
a293 1
WANTLIB-zip=		z c pthread
@


1.44
log
@Unbreak after hx509 and ntlm removal from Kerberos.
@
text
@d1 1
a1 1
# $OpenBSD: Makefile.inc,v 1.43 2013/06/17 19:30:33 ajacoutot Exp $
d50 4
a53 1
FLAVORS=		ap2 no_suhosin
d59 1
a59 1
AUTOCONF_VERSION=	2.13
a251 7
# sqlite
MULTI_PACKAGES+=	-sqlite
COMMENT-sqlite=		sqlite database access extensions for php5
CONFIGURE_ARGS+=	--with-sqlite=shared,${LOCALBASE} --enable-sqlite-utf8
LIB_DEPENDS-sqlite=	databases/sqlite
WANTLIB-sqlite=		sqlite>=8 c pthread

d313 2
a314 1
.if ${FLAVOR:Mno_suhosin}
d317 1
a317 1
.else
d325 1
d330 2
a331 1
INSTALL_TARGET= install-headers install-build install-programs
d374 4
a377 1
.if ${V:M5.3*}
d381 1
@


1.43
log
@Unbreak with new Heimdal; get rid of self-cooked krb5-config since we
have it in base now.
@
text
@d1 1
a1 1
# $OpenBSD: Makefile.inc,v 1.42 2013/06/12 20:36:33 brad Exp $
d163 1
a163 1
			asn1 com_err heimbase heimntlm hx509 roken wind
d309 1
a309 1
			m asn1 com_err heimbase heimntlm hx509 roken \
@


1.42
log
@Revert back to using MySQL 5.1 for the time being. MariaDB 5.5 introduces
a new libmysqlclient non-blocking API which utilizes co-routines. The X86
specific GCC ASM co-routine support hid the fact that there was an issue.
The only fallback code so far is POSIX user contexts which OpenBSD does not
support.

Input from and Ok sthen@@ jasper@@
@
text
@d1 1
a1 1
# $OpenBSD: Makefile.inc,v 1.41 2013/06/03 02:46:57 naddy Exp $
d160 1
a160 1
			--with-kerberos=/usr --with-imap-ssl
d162 2
a163 1
WANTLIB-imap=		c pthread crypto gssapi krb5 ssl c-client>=5
d309 2
a310 1
			m ${MODGETTEXT_WANTLIB}
@


1.41
log
@cope with new png include layout
@
text
@d1 1
a1 1
# $OpenBSD: Makefile.inc,v 1.40 2013/05/25 00:33:09 brad Exp $
d182 1
a182 1
LIB_DEPENDS-mysql=	databases/mariadb
d189 1
a189 1
LIB_DEPENDS-mysqli=	databases/mariadb
d203 1
a203 1
LIB_DEPENDS-pdo_mysql=	databases/mariadb
@


1.40
log
@Switch from using MySQL to using MariaDB. MariaDB is a drop-in replacement.


ok sthen aja
@
text
@d1 1
a1 1
# $OpenBSD: Makefile.inc,v 1.39 2013/04/18 08:38:54 sthen Exp $
a140 1
CONFIGURE_ENV+=		CPPFLAGS="-I${LOCALBASE}/include/libpng"
@


1.39
log
@update to PHP 5.3.24 and switch 5.3 to tar.bz2 distfiles
ok (and original diff for 5.3.23) william@@, maintainer timeout
@
text
@d1 1
a1 1
# $OpenBSD: Makefile.inc,v 1.38 2013/03/11 12:27:54 sthen Exp $
d183 1
a183 1
LIB_DEPENDS-mysql=	databases/mysql
d190 1
a190 1
LIB_DEPENDS-mysqli=	databases/mysql
d204 1
a204 1
LIB_DEPENDS-pdo_mysql=	databases/mysql
@


1.38
log
@PERMIT_*
@
text
@d1 1
a1 1
# $OpenBSD: Makefile.inc,v 1.37 2013/03/11 11:20:28 espie Exp $
d13 1
a13 1
DISTFILES=		php-${V}.tar.gz
@


1.37
log
@PERMIT_* / REGRESS->TEST sweep
@
text
@d1 1
a1 1
# $OpenBSD: Makefile.inc,v 1.36 2013/02/09 14:49:51 sthen Exp $
a35 2
PERMIT_PACKAGE_FTP=     Yes
PERMIT_DISTFILES_FTP=   Yes
@


1.36
log
@Don't use ${FLAVOR:L}, we only support lower-case flavours now.
OK ajacoutot@@ espie@@
@
text
@d1 1
a1 1
# $OpenBSD: Makefile.inc,v 1.35 2012/11/30 12:56:02 sthen Exp $
a36 1
PERMIT_DISTFILES_CDROM= Yes
d106 2
a107 2
REGRESS_TARGET=		test
REGRESS_FLAGS=		NO_INTERACTION=1
@


1.35
log
@For the ap2 flavour, strip the unwanted subpackages from MULTI_PACKAGES rather
than BUILD_PACKAGES (which is for pseudo-flavours). Reported by naddy.
@
text
@d1 1
a1 1
# $OpenBSD: Makefile.inc,v 1.34 2012/11/28 10:47:12 sthen Exp $
d77 1
a77 1
.if ${FLAVOR:L:Map2}
d319 1
a319 1
.if ${FLAVOR:L:Mno_suhosin}
d344 1
a344 1
.if ${FLAVOR:L:Map2}
@


1.34
log
@- update to PHP 5.3.19, with a re-rolled suhosin patch (the last official
one has a patch conflict due to copyright date changes)

- don't build pointless -ap2 flavoured subpackages (modules, fpm, fastcgi)

ok robert@@ (maintainer)
@
text
@d1 1
a1 1
# $OpenBSD: Makefile.inc,v 1.33 2012/09/27 16:45:51 ajacoutot Exp $
d343 4
@


1.33
log
@Use c-client from re-alpine (php-imap).
@
text
@d1 1
a1 1
# $OpenBSD: Makefile.inc,v 1.32 2012/08/23 19:19:17 sthen Exp $
d28 2
a29 1
MASTER_SITES0=		http://download.suhosin.org/ \
d350 3
@


1.32
log
@sync wantlib
@
text
@d1 1
a1 1
# $OpenBSD: Makefile.inc,v 1.31 2012/06/27 19:28:52 naddy Exp $
d164 1
a164 1
LIB_DEPENDS-imap=	mail/imap-uw,-c-client
@


1.31
log
@remove gcc3 workaround
@
text
@d1 1
a1 1
# $OpenBSD: Makefile.inc,v 1.30 2012/06/21 06:58:51 ajacoutot Exp $
d120 1
a120 1
WANTLIB-bz2=		bz2>=10
d127 1
a127 1
WANTLIB-curl=		crypto idn ssl z curl>=2 ${MODGETTEXT_WANTLIB}
d134 1
a134 1
WANTLIB-dba=		gdbm>=2
d142 1
a142 1
WANTLIB-gd=		z jpeg>=62 png>=3 t1>=5
d149 2
a150 3
			--with-freetype-dir=${X11BASE}
CONFIGURE_ARGS+=	--with-xpm-dir=${X11BASE}
WANTLIB-gd+=		X11 Xpm freetype
d157 1
a157 1
WANTLIB-gmp=		gmp>=4
d165 1
a165 1
WANTLIB-imap=		crypto gssapi krb5 ssl c-client>=5
d172 1
a172 1
WANTLIB-ldap=		ldap>=2 lber
d179 1
a179 1
WANTLIB-mcrypt=		mcrypt ltdl>=1
d186 1
a186 1
WANTLIB-mysql=		lib/mysql/mysqlclient>=10
d193 1
a193 1
WANTLIB-mysqli=		crypto m ssl z lib/mysql/mysqlclient>=10
d200 1
a200 1
WANTLIB-odbc=		iodbc>=2
d207 1
a207 1
WANTLIB-pdo_mysql=	crypto m ssl z lib/mysql/mysqlclient>=10
d214 1
a214 1
WANTLIB-pdo_pgsql=	pq>=2
d221 1
a221 1
WANTLIB-pgsql=		pq>=2
d228 1
a228 1
WANTLIB-pspell=		aspell>=16 pspell>=16
d235 1
a235 1
WANTLIB-shmop=
d242 1
a242 1
WANTLIB-soap=		${MODLIBICONV_WANTLIB} m z xml2>=8
d249 1
a249 1
WANTLIB-snmp=		crypto m netsnmp>=6.2
d256 1
a256 1
WANTLIB-sqlite=		sqlite>=8
d263 1
a263 1
WANTLIB-pdo_dblib=	sybdb>=6
d270 1
a270 1
WANTLIB-mssql=		sybdb>=6
d277 1
a277 1
WANTLIB-tidy=		tidyp
d284 1
a284 1
WANTLIB-xmlrpc=		${MODLIBICONV_WANTLIB} m z xml2>=8
d291 1
a291 1
WANTLIB-xsl=		${MODLIBICONV_WANTLIB} m xml2 z xslt>=3 exslt
d298 1
a298 1
WANTLIB-zip=		z
@


1.30
log
@Merge pdo_sqlite into the core package; we have sqlite3 in base now.

input/ok sthen@@ robert@@ (maintainer)
@
text
@d1 1
a1 1
# $OpenBSD: Makefile.inc,v 1.29 2012/06/16 12:51:06 sthen Exp $
a51 4
.if ${COMPILER_VERSION:L:Mgcc3}
PHP_LDFLAGS=		-lstdc++ -lm
.endif

d60 1
a60 1
                        LDFLAGS="-L${LOCALBASE}/lib ${PHP_LDFLAGS} -pthread" \
@


1.29
log
@update to PHP 5.3.14, "please do" robert@@
- also build the zip extension, from wen heping
@
text
@d1 1
a1 1
# $OpenBSD: Makefile.inc,v 1.28 2012/04/28 08:34:56 sthen Exp $
d76 3
a78 1
			--program-suffix=-${PV}
a219 7

# pdo-sqlite
MULTI_PACKAGES+=	-pdo_sqlite
COMMENT-pdo_sqlite=	PDO sqlite database access extensions for php5
CONFIGURE_ARGS+=	--with-pdo-sqlite=shared,${LOCALBASE} --enable-sqlite-utf8
LIB_DEPENDS-pdo_sqlite=	
WANTLIB-pdo_sqlite=	sqlite3>=8
@


1.28
log
@Let php-config-5.[23] --php-binary report the correct path. This fixes
regression tests in pecl ports.  Part of my pecl.port.mk work which was
OK'd by jasper@@ (maintainer timeout).
@
text
@d1 1
a1 1
# $OpenBSD: Makefile.inc,v 1.27 2012/04/23 17:15:18 espie Exp $
d24 2
a25 2
MASTER_SITES=		http://us2.php.net/distributions/ \
			http://se.php.net/distributions/ \
d129 1
a129 1
WANTLIB-curl=		crypto idn ssl z curl>=2
d302 7
@


1.27
log
@first pass at handling sqlite3 move
@
text
@d1 1
a1 1
# $OpenBSD: Makefile.inc,v 1.26 2012/01/25 11:17:22 sthen Exp $
d341 2
a342 1
	@@perl -pi -e "s,OPENBSD_PEAR_ROOT,'${CHROOT_DIR}/pear',g" \
@


1.26
log
@Update the Suhosin extension to 0.9.33 fixing CVE-2012-0807.
Stack overflow, only affects a very specific and unusual non-default
configuration: transparent cookie encryption enabled, HTTP response
splitting protection disabled, *and* a PHP application must allow
unfiltered user input to header() in order to be affected.

Good write-up at http://seclists.org/fulldisclosure/2012/Jan/295
ok robert@@
@
text
@d1 1
a1 1
# $OpenBSD: Makefile.inc,v 1.25 2012/01/21 23:34:35 sthen Exp $
d223 1
a223 1
LIB_DEPENDS-pdo_sqlite=	databases/sqlite3
@


1.26.2.1
log
@MFC update from PHP 5.3.10 to 5.3.13, this includes SECURITY fixes for
CVE-2012-2311, CVE-2012-1172, CVE-2012-0831, etc.
@
text
@d1 1
a1 1
# $OpenBSD: Makefile.inc,v 1.26 2012/01/25 11:17:22 sthen Exp $
a341 1
		-e "s,OPENBSD_PREFIX,${TRUEPREFIX},;" \
@


1.26.2.2
log
@Fix missing semicolon in -stable commit pointed out by Scott McEachern, thanks!
@
text
@d1 1
a1 1
# $OpenBSD: Makefile.inc,v 1.26.2.1 2012/05/08 21:35:02 sthen Exp $
d341 1
a341 1
	@@perl -pi -e "s,OPENBSD_PEAR_ROOT,'${CHROOT_DIR}/pear',g;" \
@


1.25
log
@update php-5.3 to 5.3.9
- SECURITY fixes: CVE-2012-0057 CVE-2011-4566 CVE-2012-0788 CVE-2012-0789
- sync WANTLIB for php-5.2 while there

ok robert@@
@
text
@d1 1
a1 1
# $OpenBSD: Makefile.inc,v 1.24 2012/01/13 17:59:07 sthen Exp $
d21 1
a21 1
SUHOSIN_V=		0.9.32.1
d322 1
a322 1
SUPDISTFILES=		suhosin-${SUHOSIN_V}.tar.gz:0 \
d325 1
a325 1
DISTFILES+=		suhosin-${SUHOSIN_V}.tar.gz:0
@


1.24
log
@- set SHARED_ONLY and roll PFRAG.shared-main into PLIST-main

- uncomment a couple of lines in the default php-fpm.conf so you
don't have to make any changes before it will start up

- add missing crypt_blowfish.h header to PLIST-main

ok robert@@
@
text
@d1 1
a1 1
# $OpenBSD: Makefile.inc,v 1.23 2011/11/17 12:52:27 robert Exp $
d28 2
a29 2
MASTER_SITES0=		http://blade2k.humppa.hu/ \
			http://download.suhosin.org/ \
d259 1
a259 1
WANTLIB-snmp=		crypto netsnmp>=6.2
@


1.23
log
@enable the pcntl extension to replace pecl-pcntl
@
text
@d1 1
a1 1
# $OpenBSD: Makefile.inc,v 1.22 2011/11/08 10:25:48 sthen Exp $
d38 2
@


1.22
log
@replace dead entry in MASTER_SITES0
@
text
@d1 1
a1 1
# $OpenBSD: Makefile.inc,v 1.21 2011/10/02 11:16:19 espie Exp $
d343 1
a343 1
.for i in ${MULTI_PACKAGES:N-main:N-fastcgi:N-fpm:S/-//g}
@


1.21
log
@... make no_suhosin a full flavor
@
text
@d1 1
a1 1
# $OpenBSD: Makefile.inc,v 1.20 2011/10/02 10:56:16 espie Exp $
d30 1
a30 1
			http://didy.avioc.org/FreeBSD/ports/distfiles/
@


1.20
log
@you've got to be kidding me
@
text
@d1 1
a1 1
# $OpenBSD: Makefile.inc,v 1.19 2011/08/27 13:13:13 robert Exp $
d54 1
a54 1
FLAVORS=		ap2
@


1.19
log
@update php/5.3 to 5.3.8 and enable fpm support. the original fpm diff
was from william@@ but i had a slightly different approach of implementing
it in the port itself.
@
text
@d1 1
a1 1
# $OpenBSD: Makefile.inc,v 1.18 2011/07/22 10:19:23 sthen Exp $
a54 1
PSEUDO_FLAVORS+=	no_suhosin
@


1.18
log
@Use PKGSPEC to set the correct PHP version in ports which depend on modules.
Otherwise a port wanting php-mysql-5.3 was matching an installed php-mysql-5.2
package. ok robert@@, bumps to follow.
@
text
@d1 1
a1 1
# $OpenBSD: Makefile.inc,v 1.17 2011/07/15 12:57:42 robert Exp $
d344 1
a344 1
.for i in ${MULTI_PACKAGES:N-main:N-fastcgi:S/-//g}
d370 4
d379 1
a379 1
.for m in ${MULTI_PACKAGES:N-main:N-fastcgi:S/-//g}
@


1.18.2.1
log
@replace dead entry in MASTER_SITES0
@
text
@d1 1
a1 1
# $OpenBSD: Makefile.inc,v 1.18 2011/07/22 10:19:23 sthen Exp $
d30 1
a30 1
			${_MASTER_SITE_FREEBSD}
@


1.17
log
@fastcgi is hard without fastcgi support so enable it
@
text
@d1 1
a1 1
# $OpenBSD: Makefile.inc,v 1.16 2011/07/14 12:40:48 robert Exp $
d350 5
@


1.16
log
@make sure to read the correct php configuraion file, noticed by ajacoutot@@
@
text
@d1 1
a1 1
# $OpenBSD: Makefile.inc,v 1.15 2011/07/09 00:41:44 robert Exp $
d105 1
@


1.15
log
@fix fastcgi path
@
text
@d1 1
a1 1
# $OpenBSD: Makefile.inc,v 1.14 2011/07/08 17:45:08 robert Exp $
d39 1
a39 2
PHP_CONFIG_PATH=	/var/www/conf
PHP_CONFIG_FILE=	${PHP_CONFIG_PATH}/php-${PV}.ini
d70 1
a70 1
			--with-config-file-path=${PHP_CONFIG_PATH} \
d302 1
a302 1
SUBST_VARS=	PHP_CONFIG_FILE PHP_CONFIG_PATH PV ^MODULE_NAME
d305 1
a305 1
.for i in TRUEPREFIX PHP_CONFIG_FILE MODULES_DIR PHP_VERSION APACHE_MODULE_DIR
d338 1
@


1.14
log
@add new master site and remove REVISIONs
@
text
@d1 1
a1 1
# $OpenBSD: Makefile.inc,v 1.13 2011/07/06 23:56:08 ajacoutot Exp $
d363 1
a363 1
	${INSTALL_PROGRAM} ${WRKBUILD}/sapi/cgi/php-cgi ${PREFIX}/bin/php-fastcgi${PV}
@


1.13
log
@Use the libiconv|gettext MODULE.
@
text
@d1 1
a1 1
# $OpenBSD: Makefile.inc,v 1.12 2011/06/18 19:49:50 sthen Exp $
a12 5
REVISION-main=		0
REVISION-soap=		0
REVISION-xmlrpc=	0
REVISION-xsl=		0

d29 2
a30 1
			http://download.suhosin.org/
@


1.12
log
@Use PATCHORIG, regen patches and rename the files which didn't match the
normal update-patches filenames. This avoids update-patches picking up the
.orig files in PHP distfiles and make it easier to keep in-sync. ok robert@@
@
text
@d1 1
a1 1
# $OpenBSD: Makefile.inc,v 1.11 2011/05/12 14:30:12 robert Exp $
d13 5
d255 1
a255 1
WANTLIB-soap=		iconv m z xml2>=8
d297 1
a297 1
WANTLIB-xmlrpc=		iconv m z xml2>=8
d304 1
a304 1
WANTLIB-xsl=		iconv m xml2 z xslt>=3 exslt
d314 1
a314 1
MODULES=		devel/gettext
d316 2
a317 2
WANTLIB-main=		c crypto ssl z pthread gssapi iconv krb5 xml2>=8 \
			intl m
@


1.11
log
@fix update from www/php5
@
text
@d1 1
a1 1
# $OpenBSD: Makefile.inc,v 1.10 2011/03/26 10:23:13 sthen Exp $
d59 1
@


1.10
log
@don't pick up an installed gsed; problem noticed by landry@@, ok robert@@
@
text
@d1 1
a1 1
# $OpenBSD: Makefile.inc,v 1.9 2011/03/21 18:29:07 ajacoutot Exp $
d165 1
a165 1
WANTLIB-imap=		crypto gssapi krb5 ssl c-client>=5 z
@


1.9
log
@Add femail,-chroot as a RUN_DEPENDS for php*-core. It is super small and
is nice to have around from the start.

Idea from sthen@@

ok robert@@ (maintainer)
@
text
@d1 1
a1 1
# $OpenBSD: Makefile.inc,v 1.8 2011/03/15 19:49:42 jasper Exp $
d63 1
a63 1
			EXTENSION_DIR=${MODULES_DIR}
@


1.8
log
@- switch from www/tidy to www/tidyp which is API compatible

ok sthen@@
@
text
@d1 1
a1 1
# $OpenBSD: Makefile.inc,v 1.7 2011/03/08 23:45:47 ajacoutot Exp $
d314 2
@


1.7
log
@Fix rcs ids.
@
text
@d1 1
a1 1
# $OpenBSD$
d283 2
a284 2
LIB_DEPENDS-tidy=	www/tidy
WANTLIB-tidy=		tidy
@


1.6
log
@security update to 5.2.17/5.3.5; note that this port is still unlinked and WIP
ok robert@@
@
text
@d1 1
a1 1
# $OpenBSD
@


1.5
log
@update both to their current version 5.3.4 and 5.2.16 and fix wantlibs.
update patches while here
@
text
@d22 1
d165 1
a165 1
WANTLIB-imap=		crypto gssapi krb5 ssl c-client>=5
d318 1
a318 1
			suhosin-patch-${V}-${SUHOSIN_P_V}.patch.gz:0
d321 1
a321 1
PATCHFILES=		suhosin-patch-${V}-${SUHOSIN_P_V}.patch.gz:0
@


1.4
log
@new depends
@
text
@d21 2
d57 1
d107 1
a107 1
MULTI_PACKAGES=	-main -fastcgi
d118 1
a118 1
WANTLIB-bz2 =		${WANTLIB} bz2>=10
d125 1
a125 1
WANTLIB-curl=		${WANTLIB} crypto idn ssl z curl>=2
d132 1
a132 1
WANTLIB-dba =		${WANTLIB} gdbm>=2
d140 1
a140 1
WANTLIB-gd=		${WANTLIB} z jpeg>=62 png>=3 t1>=5
d156 1
a156 1
WANTLIB-gmp =		${WANTLIB} gmp>=4
d164 1
a164 1
WANTLIB-imap=		${WANTLIB} crypto gssapi krb5 ssl c-client>=5
d171 1
a171 1
WANTLIB-ldap =		${WANTLIB} ldap>=2 lber
d178 1
a178 1
WANTLIB-mcrypt =	${WANTLIB} mcrypt ltdl>=1
d185 1
a185 1
WANTLIB-mysql =		${WANTLIB} lib/mysql/mysqlclient>=10
d192 1
a192 1
WANTLIB-mysqli=		${WANTLIB} crypto ssl z lib/mysql/mysqlclient>=10
d199 1
a199 1
WANTLIB-odbc =		iodbc>=2
d206 1
a206 1
WANTLIB-pdo_mysql=	${WANTLIB} crypto ssl z lib/mysql/mysqlclient>=10
d213 1
a213 1
WANTLIB-pdo_pgsql =	${WANTLIB} pq>=2
d220 1
a220 1
WANTLIB-pdo_sqlite =	${WANTLIB} sqlite3>=8
d227 1
a227 1
WANTLIB-pgsql =		${WANTLIB} pq>=2
d234 1
a234 1
WANTLIB-pspell =	aspell>=16 pspell>=16
d241 1
d248 1
a248 1
WANTLIB-soap=		${WANTLIB} z iconv xml2>=8
d255 1
a255 1
WANTLIB-snmp =		${WANTLIB} netsnmp>=6.2
d262 1
a262 1
WANTLIB-sqlite =	${WANTLIB} sqlite>=8
d269 1
a269 1
WANTLIB-pdo_dblib =	${WANTLIB} sybdb>=6
d276 1
a276 1
WANTLIB-pdo_dblib =	${WANTLIB} sybdb>=6
d283 1
a283 1
WANTLIB-pdo_dblib =	${WANTLIB} tidy
d290 1
a290 1
WANTLIB-xmlrpc=		${WANTLIB} iconv z xml2>=8
d297 1
a297 1
WANTLIB-xsl=		${WANTLIB} iconv xml2 z xslt>=3 exslt
a308 1
WANTLIB=		m stdc++
d310 1
a310 1
			${WANTLIB}
d316 1
a316 1
SUPDISTFILES=		suhosin-${SUHOSIN_V}.tgz:0 \
d319 1
a319 1
DISTFILES+=		suhosin-${SUHOSIN_V}.tgz:0
@


1.3
log
@update this php port to 5.2.14 too
@
text
@d74 1
a74 1
BUILD_DEPENDS=		::www/apache-httpd
d114 2
a115 1
LIB_DEPENDS-bz2=	bz2.>=10::archivers/bzip2
d121 2
a122 2
LIB_DEPENDS-curl=	curl.>=2::net/curl
WANTLIB-curl=		${WANTLIB} crypto idn ssl z
d128 2
a129 1
LIB_DEPENDS-dba=	gdbm.>=2::databases/gdbm
d134 4
a137 4
LIB_DEPENDS-gd=		jpeg.>=62::graphics/jpeg \
			png.>=3::graphics/png \
			t1.>=5::devel/t1lib
WANTLIB-gd=		${WANTLIB} z
d152 2
a153 1
LIB_DEPENDS-gmp=	gmp.>=4::devel/gmp
d160 2
a161 2
LIB_DEPENDS-imap=	c-client.>=5::mail/imap-uw,-c-client
WANTLIB-imap=		${WANTLIB} crypto gssapi krb5 ssl
d167 2
a168 1
LIB_DEPENDS-ldap=	ldap.>=2,lber::databases/openldap
d174 2
a175 1
LIB_DEPENDS-mcrypt=	mcrypt::security/libmcrypt ltdl.>=1::devel/libtool,-ltdl
d181 2
a182 1
LIB_DEPENDS-mysql=	lib/mysql/mysqlclient.>=10::databases/mysql
d188 2
a189 2
LIB_DEPENDS-mysqli=	lib/mysql/mysqlclient.>=10::databases/mysql
WANTLIB-mysqli=		${WANTLIB} crypto ssl z
d195 2
a196 1
LIB_DEPENDS-odbc=	iodbc.>=2::databases/iodbc
d202 2
a203 2
LIB_DEPENDS-pdo_mysql=	lib/mysql/mysqlclient.>=10::databases/mysql
WANTLIB-pdo_mysql=	${WANTLIB} crypto ssl z
d209 2
a210 1
LIB_DEPENDS-pdo_pgsql=	pq.>=2:postgresql-client-*:databases/postgresql
d216 2
a217 1
LIB_DEPENDS-pdo_sqlite=	sqlite3.>=8::databases/sqlite3
d223 2
a224 1
LIB_DEPENDS-pgsql=	pq.>=2:postgresql-client-*:databases/postgresql
d230 2
a231 1
LIB_DEPENDS-pspell=	aspell.>=16.0,pspell.>=16.0::textproc/aspell/core
d243 2
a244 2
LIB_DEPENDS-soap=	xml2.>=8::textproc/libxml
WANTLIB-soap=		${WANTLIB} z iconv
d250 2
a251 1
LIB_DEPENDS-snmp=	netsnmp.>=6.2::net/net-snmp
d257 2
a258 1
LIB_DEPENDS-sqlite=	sqlite.>=8::databases/sqlite
d264 2
a265 1
LIB_DEPENDS-pdo_dblib=	sybdb.>=6::databases/freetds
d271 2
a272 1
LIB_DEPENDS-mssql=	sybdb.>=6::databases/freetds
d278 2
a279 1
LIB_DEPENDS-tidy=	tidy::www/tidy
d285 2
a286 2
LIB_DEPENDS-xmlrpc=	xml2.>=8::textproc/libxml
WANTLIB-xmlrpc=		${WANTLIB} iconv z
d292 2
a293 2
LIB_DEPENDS-xsl=	xslt.>=3,exslt::textproc/libxslt
WANTLIB-xsl=		${WANTLIB} iconv xml2 z
d306 2
a307 1
WANTLIB-main=		c crypto ssl z pthread gssapi iconv krb5 ${WANTLIB}
d309 1
a309 1
LIB_DEPENDS-main=	xml2.>=8::textproc/libxml
d341 1
a341 1
RUN_DEPENDS-${i}+=	:php-${V}:lang/php/${PV}
@


1.2
log
@drop USE_GCC3 here as well.

from brad
@
text
@d10 2
a11 2
PKGNAME-main=		php-${V}
PKGNAME-fastcgi=	php-fastcgi-${V}
@


1.1
log
@Initial revision
@
text
@d47 1
a47 3
USE_GCC3 ?= No
COMPILER_VERSION ?= gcc2
.if ${USE_GCC3:L:Myes} || ${COMPILER_VERSION:L:Mgcc[34]*}
@


1.1.1.1
log
@Import a reworked port of php to lang/php. The basic difference is that
there are no core and extensions packages anymore, everything is built by
the main ports itself and the package names have changed to php-${V} or
php-mysql-${V} for modules.

The new ports allows you to install all of the php versions just like python
so you can actually run different webservers with different versions of php
because you can't load two modules to one. You can only do that with fastcgi.

The port tries to share all the files that can be shared and the different
extensions are located in the local version's Makefile instead of Makefile.inc.

The other change is that *all* of the configuration has moved to /etc out
of /var/www because that was a realy stupid concept, since apache if you
use it chrooted, will load all of the extensions before doing the actual
chroot.

This port is not linked to the build yet because several issues have to
be resolved first, like providing a way to update from php5-* packages,
and probably other things that do not come into my mind right now,
because the Bullfrog is making me crazy.
@
text
@@
