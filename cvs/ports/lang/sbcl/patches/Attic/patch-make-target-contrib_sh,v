head	1.5;
access;
symbols
	OPENBSD_5_8:1.4.0.10
	OPENBSD_5_8_BASE:1.4
	OPENBSD_5_7:1.4.0.6
	OPENBSD_5_7_BASE:1.4
	OPENBSD_5_6:1.4.0.4
	OPENBSD_5_6_BASE:1.4
	OPENBSD_5_5:1.4.0.2
	OPENBSD_5_5_BASE:1.4
	OPENBSD_5_4:1.2.0.4
	OPENBSD_5_4_BASE:1.2
	OPENBSD_5_3:1.2.0.2
	OPENBSD_5_3_BASE:1.2
	OPENBSD_5_2:1.1.0.6
	OPENBSD_5_2_BASE:1.1
	OPENBSD_5_1_BASE:1.1
	OPENBSD_5_1:1.1.0.4
	OPENBSD_5_0:1.1.0.2
	OPENBSD_5_0_BASE:1.1;
locks; strict;
comment	@# @;


1.5
date	2015.08.11.21.41.04;	author jasper;	state dead;
branches;
next	1.4;
commitid	YlPwm1yXpgmSmZ1E;

1.4
date	2013.12.10.17.37.54;	author joshe;	state Exp;
branches;
next	1.3;

1.3
date	2013.09.15.16.34.00;	author jca;	state Exp;
branches;
next	1.2;

1.2
date	2012.08.11.23.02.23;	author pascal;	state Exp;
branches;
next	1.1;

1.1
date	2011.07.08.11.42.09;	author jasper;	state Exp;
branches;
next	;


desc
@@


1.5
log
@- update to sbcl-1.2.14

based on an initial update by Manuel Giraud
maintainer timed-out
@
text
@$OpenBSD: patch-make-target-contrib_sh,v 1.4 2013/12/10 17:37:54 joshe Exp $

Allow the makefile target to be overridden so that the contribs may be
built first (perhaps under USE_SYSTRACE=Yes) and the tests run later
in do-regress.

--- make-target-contrib.sh.orig	Sat Nov 30 06:28:18 2013
+++ make-target-contrib.sh	Sun Dec  8 18:03:12 2013
@@@@ -73,7 +73,7 @@@@ for i in $contribs_to_build; do
     test -f obj/asdf-cache/$i/test-passed.test-report && rm obj/asdf-cache/$i/test-passed.test-report
     mkdir -p obj/asdf-cache/$i/
     # hack to get exit codes right.
-    if $GNUMAKE -C contrib/$i test < /dev/null 2>&1 && touch obj/asdf-cache/$i/test-passed.test-report ; then
+    if $GNUMAKE -C contrib/$i ${SBCL_CONTRIB_TARGET:-test} < /dev/null 2>&1 && touch obj/asdf-cache/$i/test-passed.test-report ; then
 	:
     else
 	exit $?
@


1.4
log
@Update lang/sbcl to 1.1.14

ok krw@@ jturner@@
@
text
@d1 1
a1 1
$OpenBSD: patch-make-target-contrib_sh,v 1.3 2013/09/15 16:34:00 jca Exp $
@


1.3
log
@Fix struct timeval representation leading to build failures, and remove
BROKEN-i386.  This makes sbcl usable on i386 again.  ok krw@@
@
text
@d1 1
a1 1
$OpenBSD: patch-make-target-contrib_sh,v 1.2 2012/08/11 23:02:23 pascal Exp $
d3 3
a5 3
Only run the contrib tests if $RUN_CONTRIB_TESTS is not empty.  This
allows the contribs to be build when USE_SYSTRACE=Yes, and the tests
to be run later in do-regress.
d7 5
a11 25
--- make-target-contrib.sh.orig	Sun Jun  2 15:12:40 2013
+++ make-target-contrib.sh	Sun Sep 15 03:26:47 2013
@@@@ -44,6 +44,7 @@@@ export SBCL SBCL_BUILDING_CONTRIB
 # as SB-RT and SB-GROVEL, but FIXME: there's probably a better
 # solution.  -- CSR, 2003-05-30
 
+if [ -z "$RUN_CONTRIB_TESTS" ]; then
 find contrib/ \( -name '*.fasl' -o \
                  -name '*.FASL' -o \
                  -name 'foo.c' -o \
@@@@ -58,6 +59,11 @@@@ find contrib/ \( -name '*.fasl' -o \
 
 find output -name 'building-contrib.*' -print | xargs rm -f
 
+make_target=all
+else
+make_target=test
+fi
+
 # Ignore all source registries.
 CL_SOURCE_REGISTRY='(:source-registry :ignore-inherited-configuration)'
 export CL_SOURCE_REGISTRY
@@@@ -75,7 +81,7 @@@@ for i in $contribs_to_build; do
     # export INSTALL_DIR=$SBCL_HOME/`basename $i `
     test -f $i/test-passed && rm $i/test-passed
d13 2
a14 2
-    if $GNUMAKE -C $i test 2>&1 && touch $i/test-passed ; then
+    if $GNUMAKE -C $i $make_target 2>&1 && touch $i/test-passed ; then
@


1.2
log
@Neither of these ports can use PIE.

ok naddy@@
@
text
@d1 1
a1 1
$OpenBSD: patch-make-target-contrib_sh,v 1.1 2011/07/08 11:42:09 jasper Exp $
d7 3
a9 3
--- make-target-contrib.sh.orig	Mon Dec  5 00:09:01 2011
+++ make-target-contrib.sh	Sat Aug 11 16:55:34 2012
@@@@ -43,6 +43,7 @@@@ export SBCL SBCL_BUILDING_CONTRIB
d17 1
a17 1
@@@@ -57,6 +58,11 @@@@ find contrib/ \( -name '*.fasl' -o \
d29 1
a29 1
@@@@ -74,7 +80,7 @@@@ for i in $contribs_to_build; do
@


1.1
log
@- fix patch names, no binary change
- regen a patch while here
@
text
@d1 1
a1 1
$OpenBSD$
d7 2
a8 2
--- make-target-contrib.sh.orig	Mon May  9 04:49:39 2011
+++ make-target-contrib.sh	Fri Jul  8 13:39:44 2011
d29 1
a29 1
@@@@ -66,7 +72,7 @@@@ for i in contrib/*; do
@

