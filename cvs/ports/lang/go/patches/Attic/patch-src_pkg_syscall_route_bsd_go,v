head	1.2;
access;
symbols
	OPENBSD_5_5:1.1.0.2
	OPENBSD_5_5_BASE:1.1;
locks; strict;
comment	@# @;


1.2
date	2014.07.25.13.36.55;	author jsing;	state dead;
branches;
next	1.1;
commitid	di0P39dYOpcucHPg;

1.1
date	2013.12.02.15.35.49;	author jsing;	state Exp;
branches;
next	;


desc
@@


1.2
log
@Update lang/go to version 1.3.

ok matthew@@ naddy@@ sthen@@
@
text
@$OpenBSD: patch-src_pkg_syscall_route_bsd_go,v 1.1 2013/12/02 15:35:49 jsing Exp $
--- src/pkg/syscall/route_bsd.go.orig	Fri Nov 29 08:38:29 2013
+++ src/pkg/syscall/route_bsd.go	Mon Dec  2 13:06:54 2013
@@@@ -199,13 +199,20 @@@@ func (m *InterfaceAddrMessage) sockaddr() (sas []Socka
 // ParseRoutingMessage parses b as routing messages and returns the
 // slice containing the RoutingMessage interfaces.
 func ParseRoutingMessage(b []byte) (msgs []RoutingMessage, err error) {
+	msgCount := 0
 	for len(b) >= anyMessageLen {
+		msgCount++
 		any := (*anyMessage)(unsafe.Pointer(&b[0]))
 		if any.Version != RTM_VERSION {
-			return nil, EINVAL
+			b = b[any.Msglen:]
+			continue
 		}
 		msgs = append(msgs, any.toRoutingMessage(b))
 		b = b[any.Msglen:]
+	}
+	// We failed to parse any of the messages - version mismatch?
+	if msgCount > 0 && len(msgs) == 0 {
+		return nil, EINVAL
 	}
 	return msgs, nil
 }
@


1.1
log
@Update lang/go to Go 1.2.

ok sthen@@
@
text
@d1 1
a1 1
$OpenBSD$
@

