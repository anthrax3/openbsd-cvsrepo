head	1.4;
access;
symbols
	OPENBSD_5_7:1.3.0.2
	OPENBSD_5_7_BASE:1.3
	OPENBSD_5_6:1.2.0.2
	OPENBSD_5_6_BASE:1.2
	OPENBSD_5_5:1.1.0.2
	OPENBSD_5_5_BASE:1.1;
locks; strict;
comment	@# @;


1.4
date	2015.07.16.00.27.57;	author juanfra;	state dead;
branches;
next	1.3;
commitid	uH5PzJeKD0zIfciF;

1.3
date	2014.11.11.23.51.51;	author juanfra;	state Exp;
branches;
next	1.2;
commitid	jJZWunEk9OSNbvdS;

1.2
date	2014.07.15.00.13.16;	author juanfra;	state Exp;
branches;
next	1.1;
commitid	8iEk5M6ckSx38uNs;

1.1
date	2014.01.16.01.49.32;	author juanfra;	state Exp;
branches;
next	;


desc
@@


1.4
log
@-racket
@
text
@$OpenBSD: patch-src_racket_src_gmp_gmplonglong_h,v 1.3 2014/11/11 23:51:51 juanfra Exp $

This patch changes some platforms to use the C code because these days
racket is mostly tested on amd64/i386 on other OS and this can help us in
the effort to port racket to other platforms.

--- src/racket/src/gmp/gmplonglong.h.orig	Thu Apr 17 21:58:42 2014
+++ src/racket/src/gmp/gmplonglong.h	Tue Jul 15 01:31:10 2014
@@@@ -96,6 +96,12 @@@@ MA 02111-1307, USA. */
    If any of these macros are left undefined for a particular CPU,
    C macros are used.  */
 
+/* These days only i386 and amd64 are widely tested */
+#if !defined(__i386__) || !defined(__x86_64__)
+# define MZ_GMP_NO_ASM 1
+# define NO_ASM 1
+#endif
+
 #ifndef MZ_GMP_NO_ASM
 
 /* The CPUs come in alphabetical order below.
@


1.3
log
@Update to racket 6.1.1.

The installation of the shared lib is not recommended by upstream and
nobody is using it, so I'm removing the lib from the package.
@
text
@d1 1
a1 1
$OpenBSD: patch-src_racket_src_gmp_gmplonglong_h,v 1.2 2014/07/15 00:13:16 juanfra Exp $
@


1.2
log
@- Unbreak racket after the last header changes. Spotted by sthen@@.
- Add minimal support for powerpc (broken). Tested on Jan Stary's macppc. Thanks!
- The additional changes are a WIP for the next version.
- Enable the assembler code again in gmplonglong for i386 and amd64.
@
text
@d1 1
a1 1
$OpenBSD: patch-src_racket_src_gmp_gmplonglong_h,v 1.1 2014/01/16 01:49:32 juanfra Exp $
d13 1
a13 1
+/* These days only i386 and amd64 are tested */
@


1.1
log
@Racket doesn't build on i386 with clang. Spotted by sthen@@.

The offending code is the i386 assembler within gmplonglong.h.
Using the same C code used by amd64, the interpreter builds but
it breaks the racket math libs. I tried to fix the bug backporting
some fixes related to gmp or clang from the racket repo but nothing
worked.

GCC 4.6 fixes also the crashes with the udp.rktl test but doesn't
break the math lib, so I'm changing the port to use the ports GCC.
Obviously there is some broken code on racket but I need more
time to find it.

I've included an additional patch for the gmp version included
with racket. The version is pretty old and only has assembler
code for old CPUs while the racket developers mostly only test
their code on amd64. Now racket uses the C code used by amd64
for every platform.

ok brad@@ sthen@@
@
text
@d1 1
a1 1
$OpenBSD$
d3 2
a4 5
Racket uses an old version of gmp. It's so old even doesn't include
assembler code for amd64, where racket uses C.

This patch changes every platform to use the C code because these days
racket is mostly tested on amd64 on other OS and this can help us in
d7 3
a9 3
--- src/racket/src/gmp/gmplonglong.h.orig	Fri Jan 10 04:35:39 2014
+++ src/racket/src/gmp/gmplonglong.h	Fri Jan 10 04:36:33 2014
@@@@ -96,6 +96,7 @@@@ MA 02111-1307, USA. */
d13 6
a18 1
+#define MZ_GMP_NO_ASM 1
@

