head	1.23;
access;
symbols
	OPENBSD_6_0:1.23.0.4
	OPENBSD_6_0_BASE:1.23
	OPENBSD_5_9:1.23.0.2
	OPENBSD_5_9_BASE:1.23
	OPENBSD_5_8:1.22.0.12
	OPENBSD_5_8_BASE:1.22
	OPENBSD_5_7:1.22.0.8
	OPENBSD_5_7_BASE:1.22
	OPENBSD_5_6:1.22.0.6
	OPENBSD_5_6_BASE:1.22
	OPENBSD_5_5:1.22.0.4
	OPENBSD_5_5_BASE:1.22
	OPENBSD_5_4:1.22.0.2
	OPENBSD_5_4_BASE:1.22
	OPENBSD_5_3:1.21.0.4
	OPENBSD_5_3_BASE:1.21
	OPENBSD_5_2:1.21.0.2
	OPENBSD_5_2_BASE:1.21
	OPENBSD_5_1_BASE:1.20
	OPENBSD_5_1:1.20.0.2
	OPENBSD_5_0:1.17.0.2
	OPENBSD_5_0_BASE:1.17
	OPENBSD_4_9:1.16.0.2
	OPENBSD_4_9_BASE:1.16
	OPENBSD_4_8:1.13.0.2
	OPENBSD_4_8_BASE:1.13
	OPENBSD_4_7:1.6.0.2
	OPENBSD_4_7_BASE:1.6
	OPENBSD_4_6:1.5.0.4
	OPENBSD_4_6_BASE:1.5
	OPENBSD_4_5:1.5.0.2
	OPENBSD_4_5_BASE:1.5;
locks; strict;
comment	@# @;


1.23
date	2015.10.03.11.53.44;	author robert;	state Exp;
branches;
next	1.22;
commitid	Qu7fVLbJQ0CAaeEB;

1.22
date	2013.07.02.08.36.16;	author espie;	state Exp;
branches;
next	1.21;

1.21
date	2012.03.09.10.59.11;	author espie;	state Exp;
branches;
next	1.20;

1.20
date	2011.10.03.11.00.58;	author jasper;	state Exp;
branches;
next	1.19;

1.19
date	2011.10.02.15.21.44;	author ajacoutot;	state Exp;
branches;
next	1.18;

1.18
date	2011.09.28.13.56.03;	author espie;	state Exp;
branches;
next	1.17;

1.17
date	2011.05.03.10.40.59;	author ajacoutot;	state Exp;
branches;
next	1.16;

1.16
date	2011.01.16.16.45.10;	author ajacoutot;	state Exp;
branches;
next	1.15;

1.15
date	2010.11.17.08.05.18;	author espie;	state Exp;
branches;
next	1.14;

1.14
date	2010.09.16.18.53.29;	author ajacoutot;	state Exp;
branches;
next	1.13;

1.13
date	2010.07.05.09.13.05;	author espie;	state Exp;
branches;
next	1.12;

1.12
date	2010.07.05.06.16.58;	author ajacoutot;	state Exp;
branches;
next	1.11;

1.11
date	2010.05.15.09.37.48;	author ajacoutot;	state Exp;
branches;
next	1.10;

1.10
date	2010.04.08.13.36.13;	author ajacoutot;	state Exp;
branches;
next	1.9;

1.9
date	2010.04.05.10.39.35;	author robert;	state Exp;
branches;
next	1.8;

1.8
date	2010.04.05.01.15.00;	author robert;	state Exp;
branches;
next	1.7;

1.7
date	2010.04.05.01.02.57;	author robert;	state Exp;
branches;
next	1.6;

1.6
date	2009.12.17.13.59.42;	author ajacoutot;	state Exp;
branches;
next	1.5;

1.5
date	2008.10.24.15.07.13;	author jasper;	state Exp;
branches;
next	1.4;

1.4
date	2008.10.24.15.05.03;	author robert;	state Exp;
branches;
next	1.3;

1.3
date	2008.10.24.14.49.44;	author robert;	state Exp;
branches;
next	1.2;

1.2
date	2008.10.16.21.47.10;	author jasper;	state Exp;
branches;
next	1.1;

1.1
date	2008.10.16.16.00.27;	author robert;	state Exp;
branches;
next	;


desc
@@


1.23
log
@update to mono-4.0.4.1 and introduce the MODMONO_GMCS_COMPAT flag
in the mono module because upstream has merged all the compilers
into mcs
@
text
@# $OpenBSD: mono.port.mk,v 1.22 2013/07/02 08:36:16 espie Exp $

# XXX list in infrastructure/mk/arch-defines.mk
# XXX arm powerpc (no support for sigcontext)
ONLY_FOR_ARCHS?=	${MONO_ARCHS}

CATEGORIES+=		lang/mono

CONFIGURE_ENV+=		MONO_SHARED_DIR=${TMPDIR}
MAKE_FLAGS+=		MONO_SHARED_DIR=${TMPDIR}

MODMONO_BUILD_DEPENDS=	lang/mono
MODMONO_RUN_DEPENDS=	lang/mono

MODMONO_DEPS?=		Yes
MODMONO_GMCS_COMPAT?=	No

.if ${MODMONO_DEPS:L} != "no"
BUILD_DEPENDS+=		${MODMONO_BUILD_DEPENDS}
RUN_DEPENDS+=		${MODMONO_RUN_DEPENDS}
.endif

# A list of files where we have to remove the stupid hardcoded .[0-9] major
# version from library names.
DLLMAP_FILES?=

.if defined(MODMONO_NANT) && ${MODMONO_NANT:L} == "yes"
NANT?=		nant
NANT_FLAGS?=

BUILD_DEPENDS+= devel/nant

MODMONO_BUILD_TARGET=	cd ${WRKSRC} && ${MAKE_FLAGS} ${NANT} ${NANT_FLAGS}
MODMONO_INSTALL_TARGET=	cd ${WRKSRC} && ${MAKE_FLAGS} ${NANT} ${NANT_FLAGS} \
	-D:prefix="${PREFIX}" install

.  if !target(do-build)
do-build:
	@@${MODMONO_BUILD_TARGET}
.  endif

.  if !target(do-install)
do-install:
	@@${MODMONO_INSTALL_TARGET}
.  endif

.endif

.if ${MODMONO_GMCS_COMPAT:L} != "no"
pre-extract:
	@@ln -fs ${LOCALBASE}/bin/mcs ${WRKDIR}/bin/gmcs
.endif

post-configure:
	@@for i in ${DLLMAP_FILES}; do \
		perl -pi -e 's,\.so(\.[0-9]+)+,\.so,g' ${WRKSRC}/$$i; done
@


1.22
log
@convert to using intermediate *TARGET, as discussed with a few people.
(the waf version actually works, contrary to my former patch, as
CONFIGURE_STYLE must be set before modules)
@
text
@d1 1
a1 1
# $OpenBSD: mono.port.mk,v 1.21 2012/03/09 10:59:11 espie Exp $
d16 1
d24 1
a24 1
# version from library names. 
d47 5
@


1.21
log
@synch comment with reality
@
text
@d1 1
a1 1
# $OpenBSD: mono.port.mk,v 1.20 2011/10/03 11:00:58 jasper Exp $
d32 2
a33 2
MODMONO_BUILD_TARGET=	@@cd ${WRKSRC} && ${MAKE_FLAGS} ${NANT} ${NANT_FLAGS}
MODMONO_INSTALL_TARGET=	@@cd ${WRKSRC} && ${MAKE_FLAGS} ${NANT} ${NANT_FLAGS} \
d38 1
a38 1
	${MODMONO_BUILD_TARGET}
d43 1
a43 1
	${MODMONO_INSTALL_TARGET}
@


1.20
log
@- rename USE_NANT to MODMONO_NANT and change it to use yes/no instead of
  merely checking if it's defined.
- define MODMONO_(BUILD,INSTALL)_TARGET which can be used if
  do-(build,install) are already defined.

ok robert@@
@
text
@d1 1
a1 1
# $OpenBSD: mono.port.mk,v 1.19 2011/10/02 15:21:44 ajacoutot Exp $
d3 1
a3 1
# XXX see bsd.port.arch.mk
@


1.19
log
@Remove MODMONO_ONLY_FOR_ARCHS, it's unused.

discussed with espie@@
@
text
@d1 1
a1 1
# $OpenBSD: mono.port.mk,v 1.18 2011/09/28 13:56:03 espie Exp $
d26 1
a26 1
.if defined(USE_NANT)
d32 4
d38 1
a38 1
	@@cd ${WRKSRC} && ${MAKE_FLAGS} ${NANT} ${NANT_FLAGS}
d43 1
a43 1
	@@cd ${WRKSRC} && ${MAKE_FLAGS} ${NANT} ${NANT_FLAGS} -D:prefix="${PREFIX}" install
@


1.18
log
@reuse value from bsd.port.arch.mk
@
text
@d1 1
a1 1
# $OpenBSD: mono.port.mk,v 1.17 2011/05/03 10:40:59 ajacoutot Exp $
d5 1
a5 2
MODMONO_ONLY_FOR_ARCHS=	${MONO_ARCHS} 
ONLY_FOR_ARCHS?=	${MODMONO_ONLY_FOR_ARCHS}
@


1.17
log
@And once again, fix the DLLMAP_FILES regex.
@
text
@d1 1
a1 1
# $OpenBSD: mono.port.mk,v 1.16 2011/01/16 16:45:10 ajacoutot Exp $
d3 3
a5 1
MODMONO_ONLY_FOR_ARCHS=	i386 amd64 # XXX arm powerpc (no support for sigcontext)
@


1.16
log
@Better regex, with robert@@
@
text
@d1 1
a1 1
# $OpenBSD: mono.port.mk,v 1.15 2010/11/17 08:05:18 espie Exp $
d45 1
a45 1
		perl -pi -e 's,\.so(\.[0-9])+,\.so,g' ${WRKSRC}/$$i; done
@


1.15
log
@new depends
@
text
@d1 1
a1 1
# $OpenBSD: mono.port.mk,v 1.14 2010/09/16 18:53:29 ajacoutot Exp $
d45 1
a45 1
		perl -pi -e 's,\.so\.[0-9]+,\.so,g' ${WRKSRC}/$$i; done
@


1.14
log
@Remove powerpc from mono supported arches.
It builds but there is no support for sigcontext and mono crashes right on
startup. No need to loose time building this...

input and ok robert@@
@
text
@d1 1
a1 1
# $OpenBSD: mono.port.mk,v 1.13 2010/07/05 09:13:05 espie Exp $
d11 2
a12 2
MODMONO_BUILD_DEPENDS=	::lang/mono
MODMONO_RUN_DEPENDS=	::lang/mono
d29 1
a29 1
BUILD_DEPENDS+= ::devel/nant
@


1.13
log
@MODMONO_ONLY_FOR_ARCHS
zap () subshells
@
text
@d1 1
a1 1
# $OpenBSD: mono.port.mk,v 1.12 2010/07/05 06:16:58 ajacoutot Exp $
d3 1
a3 1
MODMONO_ONLY_FOR_ARCHS=	i386 amd64 powerpc # XXX arm
@


1.12
log
@ONLY_FOR_ARCHS is already part of the mono MODULE.
@
text
@d1 1
a1 1
# $OpenBSD: mono.port.mk,v 1.11 2010/05/15 09:37:48 ajacoutot Exp $
d3 2
a4 1
ONLY_FOR_ARCHS?=	i386 amd64 powerpc # XXX arm
d33 1
a33 1
	@@(cd ${WRKSRC}; ${MAKE_FLAGS} ${NANT} ${NANT_FLAGS})
d38 1
a38 1
	@@(cd ${WRKSRC}; ${MAKE_FLAGS} ${NANT} ${NANT_FLAGS} -D:prefix="${PREFIX}" install)
@


1.11
log
@Fix substitution for DLLMAP_FILES.
This makes sure we catch all the stupid so.X stuffs.

ok robert@@
@
text
@d1 1
a1 1
# $OpenBSD: mono.port.mk,v 1.10 2010/04/08 13:36:13 ajacoutot Exp $
d3 1
a3 1
ONLY_FOR_ARCHS?=	i386 amd64 powerpc
@


1.10
log
@Add MODMONO_{BUILD,RUN}_DEPENDS so other ports can use it.

ok robert@@
@
text
@d1 1
a1 1
# $OpenBSD: mono.port.mk,v 1.9 2010/04/05 10:39:35 robert Exp $
d44 1
a44 1
		perl -pi -e 's,\.so\.[0-9],\.so,g' ${WRKSRC}/$$i; done
@


1.9
log
@Move lang/mono dependency to mono.port.mk
@
text
@d1 1
a1 1
# $OpenBSD: mono.port.mk,v 1.8 2010/04/05 01:15:00 robert Exp $
d10 3
d16 2
a17 2
BUILD_DEPENDS+=		::lang/mono
RUN_DEPENDS+=		::lang/mono
@


1.8
log
@add ONLY_FOR_ARCHS here
@
text
@d1 1
a1 1
# $OpenBSD: mono.port.mk,v 1.7 2010/04/05 01:02:57 robert Exp $
d9 7
@


1.7
log
@Enable shared handles and add USE_NANT to mono.port.mk to use NAnt
to build stuff
@
text
@d1 3
a3 1
# $OpenBSD: mono.port.mk,v 1.6 2009/12/17 13:59:42 ajacoutot Exp $
@


1.6
log
@Better regex.
@
text
@d1 1
a1 1
# $OpenBSD: mono.port.mk,v 1.5 2008/10/24 15:07:13 jasper Exp $
d11 18
@


1.5
log
@- use ${TMPDIR} instead of "/tmp"

ok robert@@
@
text
@d1 1
a1 1
# $OpenBSD: mono.port.mk,v 1.4 2008/10/24 15:05:03 robert Exp $
d14 1
a14 1
		perl -pi -e "s,.so.[0-9],.so,g" ${WRKSRC}/$$i; done
@


1.4
log
@add MONO_SHARED_DIR=/tmp to CONFIGURE_ENV too
@
text
@d1 1
a1 1
# $OpenBSD: mono.port.mk,v 1.3 2008/10/24 14:49:44 robert Exp $
d5 2
a6 2
CONFIGURE_ENV+=		MONO_SHARED_DIR=/tmp
MAKE_FLAGS+=		MONO_SHARED_DIR=/tmp
@


1.3
log
@Add MONO_SHARED_DIR=/tmp to the MAKE_FLAGS so the ports using this
module won't try to write to /root/.wapi
@
text
@d1 1
a1 1
# $OpenBSD: mono.port.mk,v 1.2 2008/10/16 21:47:10 jasper Exp $
d5 1
@


1.2
log
@- set CATEGORIES+=lang/mono via mono.port.mk, instead of every port doing
it themselves. like other modules do too.
@
text
@d1 1
a1 1
# $OpenBSD: mono.port.mk,v 1.1 2008/10/16 16:00:27 robert Exp $
d4 2
@


1.1
log
@- fix the pkg-config files and introduce a mono module that removes
all of the hardcoded library versions from the files that we provide
in each mono-* port
- install example config files
@
text
@d1 3
a3 1
# $OpenBSD$
@

