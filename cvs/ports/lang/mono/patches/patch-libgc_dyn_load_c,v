head	1.3;
access;
symbols
	OPENBSD_6_2:1.3.0.4
	OPENBSD_6_2_BASE:1.3
	OPENBSD_6_1:1.3.0.2
	OPENBSD_6_1_BASE:1.3
	OPENBSD_6_0:1.2.0.8
	OPENBSD_6_0_BASE:1.2
	OPENBSD_5_9:1.2.0.4
	OPENBSD_5_9_BASE:1.2
	OPENBSD_5_8:1.2.0.6
	OPENBSD_5_8_BASE:1.2
	OPENBSD_5_7:1.2.0.2
	OPENBSD_5_7_BASE:1.2
	OPENBSD_5_6:1.1.0.2
	OPENBSD_5_6_BASE:1.1;
locks; strict;
comment	@# @;


1.3
date	2016.11.07.15.22.38;	author ajacoutot;	state Exp;
branches;
next	1.2;
commitid	VoSH4ndWuPT3uL11;

1.2
date	2014.12.29.10.49.12;	author robert;	state Exp;
branches;
next	1.1;
commitid	sXBuhXfgcPHWPwW0;

1.1
date	2014.07.09.11.39.17;	author robert;	state Exp;
branches;
next	;
commitid	rfOnxOCfdtnXRGha;


desc
@@


1.3
log
@Pass --without-sigaltstack instead of patching.
Remove checks for old OpenBSD.

ok robert@@ (maintainer)
@
text
@$OpenBSD: patch-libgc_dyn_load_c,v 1.2 2014/12/29 10:49:12 robert Exp $
--- libgc/dyn_load.c.orig	Mon Nov  7 13:45:18 2016
+++ libgc/dyn_load.c	Mon Nov  7 13:45:52 2016
@@@@ -396,7 +396,8 @@@@ GC_bool GC_register_main_static_data()
 
 # if (defined(LINUX) || defined (__GLIBC__) || defined(NACL)) /* Are others OK here, too? */ \
      && (__GLIBC__ > 2 || (__GLIBC__ == 2 && __GLIBC_MINOR__ > 2) \
-         || (__GLIBC__ == 2 && __GLIBC_MINOR__ == 2 && defined(DT_CONFIG))) 
+         || (__GLIBC__ == 2 && __GLIBC_MINOR__ == 2 && defined(DT_CONFIG)))  \
+     || defined(OPENBSD)
 
 /* We have the header files for a glibc that includes dl_iterate_phdr.	*/
 /* It may still not be available in the library on the target system.   */
@


1.2
log
@update to 3.10.0
@
text
@d1 4
a4 18
$OpenBSD$
--- libgc/dyn_load.c.orig	Sun Dec 28 16:23:54 2014
+++ libgc/dyn_load.c	Sun Dec 28 16:24:45 2014
@@@@ -91,6 +91,13 @@@@
 #   define ELFSIZE ARCH_ELFSIZE
 #endif
 
+#if defined(OPENBSD)
+# include <sys/param.h>
+# if OpenBSD >= 200519
+#   define HAVE_DL_ITERATE_PHDR
+# endif
+#endif /* OPENBSD */
+
 #if (defined(LINUX) || defined(NACL)) && defined(__ELF__) || defined(SCO_ELF) || \
     (defined(FREEBSD) && defined(__ELF__)) || defined(DGUX) || \
     (defined(OPENBSD) && defined(__ELF__)) || \
@@@@ -396,7 +403,8 @@@@ GC_bool GC_register_main_static_data()
d9 1
a9 1
+         || (__GLIBC__ == 2 && __GLIBC_MINOR__ == 2 && defined(DT_CONFIG))) \
@


1.1
log
@update to mono-3.4.0
@
text
@d2 2
a3 2
--- libgc/dyn_load.c.orig	Tue Jul  8 11:42:14 2014
+++ libgc/dyn_load.c	Tue Jul  8 12:52:49 2014
d18 1
a18 3
@@@@ -394,9 +401,10 @@@@ GC_bool GC_register_main_static_data()
 /* For glibc 2.2.4+.  Unfortunately, it doesn't work for older	*/
 /* versions.  Thanks to Jakub Jelinek for most of the code.	*/
d20 1
a20 2
-# if (defined(LINUX) || defined(NACL)) /* Are others OK here, too? */ \
+# if ((defined(LINUX) || defined(NACL)) /* Are others OK here, too? */ \
d23 1
a23 1
+         || (__GLIBC__ == 2 && __GLIBC_MINOR__ == 2 && defined(DT_CONFIG)))) \
a27 8
@@@@ -439,7 +447,6 @@@@ static int GC_register_dynlib_callback(info, size, ptr
 /* Return TRUE if we succeed, FALSE if dl_iterate_phdr wasn't there. */
 
 #pragma weak dl_iterate_phdr
-
 GC_bool GC_register_dynamic_libraries_dl_iterate_phdr()
 {
   if (dl_iterate_phdr) {
@

