head	1.1;
access;
symbols
	OPENBSD_6_1:1.1.0.6
	OPENBSD_6_1_BASE:1.1
	OPENBSD_6_0:1.1.0.4
	OPENBSD_6_0_BASE:1.1
	OPENBSD_5_9:1.1.0.2
	OPENBSD_5_9_BASE:1.1;
locks; strict;
comment	@# @;


1.1
date	2016.01.29.20.12.04;	author abieber;	state Exp;
branches;
next	;
commitid	qI9YnmqKmCmi0CqS;


desc
@@


1.1
log
@Add in node-pledge module so users can require() it out of the box.
Build against openssl in ports.
Update to latest stable release of node.

OK giovanni@@
@
text
@$OpenBSD$
--- Makefile.orig	Wed Dec 23 09:53:36 2015
+++ Makefile	Wed Jan 27 14:13:12 2016
@@@@ -59,7 +59,7 @@@@ config.gypi: configure
 		$(error No $@@, please run ./configure first)
 	fi
 
-install: all
+install: all build-pledge
 	$(PYTHON) tools/install.py $@@ '$(DESTDIR)' '$(PREFIX)'
 
 uninstall:
@@@@ -131,6 +131,12 @@@@ test/addons/.buildstamp: $(ADDONS_BINDING_GYPS) | test
 # Just goes to show that recursive make really is harmful...
 # TODO(bnoordhuis) Force rebuild after gyp or node-gyp update.
 build-addons: $(NODE_EXE) test/addons/.buildstamp
+
+build-pledge: $(NODE_EXE)
+	$(NODE) deps/npm/node_modules/node-gyp/bin/node-gyp rebuild \
+		--directory="deps/npm/node_modules/node-pledge" \
+		--nodedir="$(shell pwd)" && \
+	$(RM) -rf deps/npm/node_modules/node-pledge/build/Release/{.deps,../Makefile,obj.target}
 
 test-gc: all test/gc/node_modules/weak/build/Release/weakref.node
 	$(PYTHON) tools/test.py --mode=release gc
@
