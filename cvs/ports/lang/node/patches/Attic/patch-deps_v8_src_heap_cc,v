head	1.5;
access;
symbols
	OPENBSD_5_8:1.4.0.10
	OPENBSD_5_8_BASE:1.4
	OPENBSD_5_7:1.4.0.6
	OPENBSD_5_7_BASE:1.4
	OPENBSD_5_6:1.4.0.4
	OPENBSD_5_6_BASE:1.4
	OPENBSD_5_5:1.4.0.2
	OPENBSD_5_5_BASE:1.4
	OPENBSD_5_2:1.2.0.2
	OPENBSD_5_2_BASE:1.2
	jasper_20122305:1.1.1.1
	jasper:1.1.1;
locks; strict;
comment	@# @;


1.5
date	2015.10.24.02.46.47;	author abieber;	state dead;
branches;
next	1.4;
commitid	ed5E7Ght7haAuPfD;

1.4
date	2013.10.22.15.29.14;	author abieber;	state Exp;
branches;
next	1.3;

1.3
date	2012.12.05.00.40.28;	author abieber;	state dead;
branches;
next	1.2;

1.2
date	2012.06.28.08.30.28;	author jasper;	state Exp;
branches;
next	1.1;

1.1
date	2012.05.23.15.11.43;	author jasper;	state Exp;
branches
	1.1.1.1;
next	;

1.1.1.1
date	2012.05.23.15.11.43;	author jasper;	state Exp;
branches;
next	;


desc
@@


1.5
log
@Finally update node to the latest version, lots of changes:
 - Use internal OpenSSL (no LibreSSL :( )
 - Remove node.port.mk as there are no longer any modules in ports.
 - Remove various patches that are now upstream.
 - Fix some tests by telling test.py the fully qualified path to node
 - Add gcc as a RUN dep for building native node modules.
 - Clean up Makefile a bit.

OK juanfra@@
@
text
@$OpenBSD: patch-deps_v8_src_heap_cc,v 1.4 2013/10/22 15:29:14 abieber Exp $
--- deps/v8/src/heap.cc.orig	Mon Sep 30 14:52:48 2013
+++ deps/v8/src/heap.cc	Tue Oct  8 09:25:37 2013
@@@@ -5888,6 +5888,29 @@@@ bool Heap::ConfigureHeap(int max_semispace_size,
   initial_semispace_size_ = Min(initial_semispace_size_, max_semispace_size_);
   external_allocation_limit_ = 16 * max_semispace_size_;
 
+  intptr_t max_virtual = OS::MaxVirtualMemory();
+
+  if (max_virtual > 0) {
+    intptr_t half = max_virtual >> 1;
+    intptr_t quarter = max_virtual >> 2;
+    // If we have limits on the amount of virtual memory we can use then we may
+    // be forced to lower the allocation limits.  We reserve one quarter of the
+    // memory for young space and off-heap data.  The rest is distributed as
+    // described below.
+    if (code_range_size_ > 0) {
+      // Reserve a quarter of the memory for the code range.  The old space
+      // heap gets the remaining half.  There is some unavoidable double
+      // counting going on here since the heap size is measured in committed
+      // virtual memory and the code range is only reserved virtual memory.
+      code_range_size_ = Min(code_range_size_, quarter);
+      max_old_generation_size_ = Min(max_old_generation_size_, half);
+    } else {
+      // Reserve three quarters of the memory for the old space heap including
+      // the executable code.
+      max_old_generation_size_ = Min(max_old_generation_size_, half + quarter);
+    }
+  }
+
   // The old generation is paged and needs at least one page for each space.
   int paged_space_count = LAST_PAGED_SPACE - FIRST_PAGED_SPACE + 1;
   max_old_generation_size_ = Max(static_cast<intptr_t>(paged_space_count *
@


1.4
log
@Bring node up to 0.10.20
	- use internal libv8

OK sthen@@
@
text
@d1 1
a1 1
$OpenBSD$
@


1.3
log
@Update node to use lang/libv8

OK jeremy@@
@
text
@d1 4
a4 4
$OpenBSD: patch-deps_v8_src_heap_cc,v 1.2 2012/06/28 08:30:28 jasper Exp $
--- deps/v8/src/heap.cc.orig	Wed Jun 20 09:32:21 2012
+++ deps/v8/src/heap.cc	Wed Jun 20 09:33:24 2012
@@@@ -5777,6 +5777,30 @@@@ bool Heap::ConfigureHeap(int max_semispace_size,
d6 1
a6 1
   external_allocation_limit_ = 10 * max_semispace_size_;
a29 1
+
@


1.2
log
@- update node to 0.8.0
* please see this blog post for more details on the changes:
  http://blog.nodejs.org/2012/06/25/node-v0-8-0/
  * the migration wiki can be consulted to port your code to node 0.8:
    https://github.com/joyent/node/wiki/API-changes-between-v0.6-and-v0.8
    - expose node-gyp, so it's now installed into ${LOCALBASE}/bin/ too

    from aaron bieber with tweaks by me
    ok jeremy@@
@
text
@d1 1
a1 1
$OpenBSD: patch-deps_v8_src_heap_cc,v 1.1.1.1 2012/05/23 15:11:43 jasper Exp $
@


1.1
log
@Initial revision
@
text
@d1 4
a4 4
$OpenBSD: patch-deps_v8_src_heap_cc,v 1.5 2012/05/07 18:11:29 jasper Exp $
--- deps/v8/src/heap.cc.orig	Fri May  4 22:12:52 2012
+++ deps/v8/src/heap.cc	Mon May  7 20:09:43 2012
@@@@ -5032,6 +5032,29 @@@@ bool Heap::ConfigureHeap(int max_semispace_size,
d31 4
a34 3
   // The old generation is paged.
   max_old_generation_size_ = RoundUp(max_old_generation_size_, Page::kPageSize);
 
@


1.1.1.1
log
@re-import node into lang, www was poorly chosen at the time of import

from aaron bieber (MAINTAINER), with cluestick hitting by espie@@ 
as discussed with and ok sthen@@

@
text
@@
