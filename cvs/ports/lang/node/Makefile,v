head	1.57;
access;
symbols
	OPENBSD_6_1:1.56.0.2
	OPENBSD_6_1_BASE:1.56
	OPENBSD_6_0:1.47.0.2
	OPENBSD_6_0_BASE:1.47
	OPENBSD_5_9:1.42.0.2
	OPENBSD_5_9_BASE:1.42
	OPENBSD_5_8:1.33.0.6
	OPENBSD_5_8_BASE:1.33
	OPENBSD_5_7:1.33.0.2
	OPENBSD_5_7_BASE:1.33
	OPENBSD_5_6:1.30.0.2
	OPENBSD_5_6_BASE:1.30
	OPENBSD_5_5:1.27.0.2
	OPENBSD_5_5_BASE:1.27
	OPENBSD_5_4:1.20.0.2
	OPENBSD_5_4_BASE:1.20
	OPENBSD_5_3:1.15.0.2
	OPENBSD_5_3_BASE:1.15
	OPENBSD_5_2:1.5.0.2
	OPENBSD_5_2_BASE:1.5
	jasper_20122305:1.1.1.1
	jasper:1.1.1;
locks; strict;
comment	@# @;


1.57
date	2017.05.26.09.52.16;	author espie;	state Exp;
branches;
next	1.56;
commitid	vgLvzNzPdcKkFXCg;

1.56
date	2017.03.24.22.23.10;	author abieber;	state Exp;
branches;
next	1.55;
commitid	KtM9fu19JP2CmMzw;

1.55
date	2017.02.26.18.50.05;	author abieber;	state Exp;
branches;
next	1.54;
commitid	EOWGvLcWdo8AfUko;

1.54
date	2017.01.23.16.47.04;	author abieber;	state Exp;
branches;
next	1.53;
commitid	xBUY4sNTydDQXYd6;

1.53
date	2016.12.31.20.46.18;	author jca;	state Exp;
branches;
next	1.52;
commitid	MLjs8GaK7TVbxZWP;

1.52
date	2016.09.10.13.03.41;	author ajacoutot;	state Exp;
branches;
next	1.51;
commitid	4KcvAK91uGdTLejD;

1.51
date	2016.08.25.15.59.58;	author jasper;	state Exp;
branches;
next	1.50;
commitid	MV0PXv5dIk0GVzmC;

1.50
date	2016.08.25.08.42.08;	author jasper;	state Exp;
branches;
next	1.49;
commitid	DWamKx3ik0l0jIUR;

1.49
date	2016.08.17.01.05.38;	author abieber;	state Exp;
branches;
next	1.48;
commitid	DrfnShQJMqrQxALz;

1.48
date	2016.08.03.13.56.56;	author abieber;	state Exp;
branches;
next	1.47;
commitid	xiAwSfMVz2vsrtkc;

1.47
date	2016.05.27.23.11.53;	author abieber;	state Exp;
branches;
next	1.46;
commitid	07KKHfbMNueFArwZ;

1.46
date	2016.05.09.15.43.06;	author abieber;	state Exp;
branches;
next	1.45;
commitid	4UmJomPhbrHeTtnN;

1.45
date	2016.04.19.18.38.06;	author abieber;	state Exp;
branches;
next	1.44;
commitid	f8AFBRq8uuJcWHo1;

1.44
date	2016.03.12.02.50.36;	author abieber;	state Exp;
branches;
next	1.43;
commitid	iiDBpiGhWU1X1QrQ;

1.43
date	2016.02.28.20.12.51;	author abieber;	state Exp;
branches;
next	1.42;
commitid	z3ohrfBjBLh62J8V;

1.42
date	2016.02.11.23.05.01;	author abieber;	state Exp;
branches
	1.42.2.1;
next	1.41;
commitid	eDhXlwcc53miy2qb;

1.41
date	2016.01.29.20.12.04;	author abieber;	state Exp;
branches;
next	1.40;
commitid	qI9YnmqKmCmi0CqS;

1.40
date	2016.01.08.16.50.13;	author abieber;	state Exp;
branches;
next	1.39;
commitid	v4kHNdQef82y82Es;

1.39
date	2016.01.01.04.47.05;	author abieber;	state Exp;
branches;
next	1.38;
commitid	u4Gbjeq9E6gFqfpT;

1.38
date	2015.12.28.16.08.33;	author mpi;	state Exp;
branches;
next	1.37;
commitid	rueJPRKEYNPm6R19;

1.37
date	2015.12.21.19.27.05;	author abieber;	state Exp;
branches;
next	1.36;
commitid	I3kMRLKZr6Zry2E3;

1.36
date	2015.11.14.17.26.05;	author abieber;	state Exp;
branches;
next	1.35;
commitid	rkdu0UxDdJ9P1bQF;

1.35
date	2015.10.27.11.58.01;	author sthen;	state Exp;
branches;
next	1.34;
commitid	l8uIxTxnfl387W2C;

1.34
date	2015.10.24.02.46.47;	author abieber;	state Exp;
branches;
next	1.33;
commitid	ed5E7Ght7haAuPfD;

1.33
date	2015.02.03.15.48.20;	author abieber;	state Exp;
branches;
next	1.32;
commitid	5C56FmbwDdTNcDWF;

1.32
date	2014.09.24.18.17.27;	author abieber;	state Exp;
branches;
next	1.31;
commitid	6cr0nykzWq5p7l9Z;

1.31
date	2014.09.09.14.01.26;	author jasper;	state Exp;
branches;
next	1.30;
commitid	jTEiNf9H1eWuVYsb;

1.30
date	2014.07.10.19.54.57;	author landry;	state Exp;
branches
	1.30.2.1;
next	1.29;
commitid	wVkQldhGtxqCKYpN;

1.29
date	2014.05.12.01.34.55;	author abieber;	state Exp;
branches;
next	1.28;

1.28
date	2014.05.06.03.10.08;	author abieber;	state Exp;
branches;
next	1.27;

1.27
date	2014.01.20.19.42.00;	author abieber;	state Exp;
branches
	1.27.2.1;
next	1.26;

1.26
date	2013.12.06.15.14.16;	author abieber;	state Exp;
branches;
next	1.25;

1.25
date	2013.12.04.20.20.52;	author abieber;	state Exp;
branches;
next	1.24;

1.24
date	2013.11.25.14.16.23;	author sthen;	state Exp;
branches;
next	1.23;

1.23
date	2013.10.23.22.00.17;	author abieber;	state Exp;
branches;
next	1.22;

1.22
date	2013.10.22.15.29.13;	author abieber;	state Exp;
branches;
next	1.21;

1.21
date	2013.08.11.17.12.13;	author abieber;	state Exp;
branches;
next	1.20;

1.20
date	2013.06.27.13.47.03;	author abieber;	state Exp;
branches
	1.20.2.1;
next	1.19;

1.19
date	2013.06.17.23.51.28;	author abieber;	state Exp;
branches;
next	1.18;

1.18
date	2013.05.24.13.43.41;	author abieber;	state Exp;
branches;
next	1.17;

1.17
date	2013.03.11.11.20.28;	author espie;	state Exp;
branches;
next	1.16;

1.16
date	2013.03.04.14.29.24;	author abieber;	state Exp;
branches;
next	1.15;

1.15
date	2013.01.27.03.56.06;	author abieber;	state Exp;
branches
	1.15.2.1;
next	1.14;

1.14
date	2013.01.13.14.53.40;	author abieber;	state Exp;
branches;
next	1.13;

1.13
date	2012.12.12.16.51.23;	author abieber;	state Exp;
branches;
next	1.12;

1.12
date	2012.12.06.22.51.08;	author abieber;	state Exp;
branches;
next	1.11;

1.11
date	2012.12.05.00.40.27;	author abieber;	state Exp;
branches;
next	1.10;

1.10
date	2012.09.28.01.04.14;	author abieber;	state Exp;
branches;
next	1.9;

1.9
date	2012.09.26.17.22.36;	author abieber;	state Exp;
branches;
next	1.8;

1.8
date	2012.09.14.22.40.20;	author abieber;	state Exp;
branches;
next	1.7;

1.7
date	2012.08.30.01.13.32;	author abieber;	state Exp;
branches;
next	1.6;

1.6
date	2012.08.23.17.29.44;	author abieber;	state Exp;
branches;
next	1.5;

1.5
date	2012.07.10.00.45.10;	author abieber;	state Exp;
branches
	1.5.2.1;
next	1.4;

1.4
date	2012.07.09.13.54.54;	author abieber;	state Exp;
branches;
next	1.3;

1.3
date	2012.06.28.08.30.28;	author jasper;	state Exp;
branches;
next	1.2;

1.2
date	2012.06.06.20.33.50;	author sthen;	state Exp;
branches;
next	1.1;

1.1
date	2012.05.23.15.11.43;	author jasper;	state Exp;
branches
	1.1.1.1;
next	;

1.1.1.1
date	2012.05.23.15.11.43;	author jasper;	state Exp;
branches;
next	;

1.5.2.1
date	2013.01.15.15.22.57;	author abieber;	state Exp;
branches;
next	;

1.15.2.1
date	2013.10.29.13.11.29;	author jasper;	state Exp;
branches;
next	;

1.20.2.1
date	2013.10.30.12.51.28;	author jasper;	state Exp;
branches;
next	;

1.27.2.1
date	2014.09.09.14.49.56;	author jasper;	state Exp;
branches;
next	;
commitid	rfA0z77R17dgjjPs;

1.30.2.1
date	2014.09.18.15.19.06;	author jasper;	state Exp;
branches;
next	;
commitid	aO1SAAEcAjPxoL0c;

1.42.2.1
date	2016.06.28.16.39.31;	author abieber;	state Exp;
branches;
next	;
commitid	gkg4srbqAMyFwcmI;


desc
@@


1.57
log
@use the MODGCC4* variables instead of hardcoding dependencies.
convert to WANT_CXX even though it might not work yet.
bump the ports that didn't even the full spec
@
text
@# $OpenBSD: Makefile,v 1.56 2017/03/24 22:23:10 abieber Exp $

# XXX:
# - Needs __ARM_NR_cacheflush (or the like) to work on arm-based ports.
# - Needs bundled libcares as arpa/nameser.h does not include ns_t_a.

ONLY_FOR_ARCHS =	amd64 i386

USE_WXNEEDED =		Yes

COMMENT =		V8 JavaScript for clients and servers

NODE_VERSION =		v6.10.1

PLEDGE_VER =		1.1.0
DISTFILES =		node-pledge-{}${PLEDGE_VER}.tar.gz:0 ${DISTNAME}.tar.gz

DISTNAME =		node-${NODE_VERSION}
PKGNAME =		${DISTNAME:S/v//g}
REVISION =		0

MASTER_SITES0 =		https://github.com/qbit/node-pledge/archive/

CATEGORIES =		lang devel

HOMEPAGE =		http://nodejs.org/

MAINTAINER =		Aaron Bieber <abieber@@openbsd.org>

# MIT
PERMIT_PACKAGE_CDROM =	Yes

MASTER_SITES =		${HOMEPAGE}dist/${NODE_VERSION}/

MODULES =		lang/python

WANT_CXX =		base gcc

WANTLIB += c execinfo kvm m pthread util z ${LIBECXX}

LIB_DEPENDS =		devel/libexecinfo

USE_GMAKE =		Yes

BUILD_DEPENDS =		sysutils/flock

RUN_DEPENDS =		devel/gmake \
			${MODGCC4_CPPDEP} \
			sysutils/flock

TEST_TARGET =		test
CONFIGURE_STYLE =	simple

# libpath and includes aren't picked up, but I added them here as a note.
# The patch for node.gyp is where they are actually being set.
CONFIGURE_ARGS =	--prefix=${PREFIX} \
			--shared-zlib

SUBST_VARS += 		DISTNAME
SUBST_VARS += 		DISTFILES
SUBST_VARS += 		EXTRACT_SUFX
SUBST_VARS += 		LOCALBASE
SUBST_VARS += 		PREFIX
SUBST_VARS +=		WRKDIST

MAKE_ENV +=		V=1 CXX="${CXX}" CXXFLAGS="${CXXFLAGS}" \
			LDFLAGS="-L${LOCALBASE}/lib -L${X11BASE}/lib"

do-extract:
	mkdir ${WRKSRC}; \
	tar -C ${WRKDIR} -zxf ${FULLDISTDIR}/${DISTNAME}.tar.gz && \
	tar -C ${WRKSRC}/deps/npm/node_modules/ -zxf \
		${FULLDISTDIR}/node-pledge-${PLEDGE_VER}.tar.gz && \
	mv ${WRKSRC}/deps/npm/node_modules/node-pledge-${PLEDGE_VER} \
		${WRKSRC}/deps/npm/node_modules/node-pledge

pre-configure:
	@@# Bad practice, but prevents a whole stack of patches.
	ln -sf ${LOCALBASE}/bin/python${MODPY_VERSION} ${WRKDIR}/bin/python
	${SUBST_CMD} ${WRKDIST}/lib/module.js \
		${WRKDIST}/deps/npm/bin/node-gyp-bin/node-gyp \
		${WRKDIST}/deps/npm/node_modules/node-gyp/lib/configure.js \
		${WRKDIST}/deps/npm/node_modules/node-gyp/lib/install.js \
		${WRKDIST}/node.gyp \
		${WRKDIST}/common.gypi \
		${WRKDIST}/tools/test.py

post-install:
	${MODPY_BIN} ${MODPY_LIBDIR}/compileall.py \
		${PREFIX}/lib/node_modules/npm/node_modules/node-gyp/gyp
	${INSTALL_DATA_DIR} ${PREFIX}/share/node
	${INSTALL_DATA} ${FULLDISTDIR}/${DISTNAME}.tar.gz \
		${PREFIX}/share/node/${DISTNAME}.tar.gz
	ln -s ${TRUEPREFIX}/lib/node_modules/npm/bin/node-gyp-bin/node-gyp \
		${PREFIX}/bin/node-gyp;
	cd ${PREFIX}/lib/node_modules/npm/node_modules && for x in *; do \
		mv $$x ../..; \
		ln -s ../../$$x $$x; \
	done

.include <bsd.port.mk>
@


1.56
log
@bump node to the latest, has some nice speed improvements!

OK fcambus@@
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.55 2017/02/26 18:50:05 abieber Exp $
d20 1
d35 1
a35 2
MODULES =		gcc4 \
			lang/python
d37 1
a37 2
MODGCC4_LANGS =		c c++
MODGCC4_ARCHS =		*
d39 1
a39 1
WANTLIB += c execinfo kvm m pthread util z
d48 1
a48 1
			lang/gcc/${MODGCC4_VERSION},-c++ \
@


1.55
log
@Bump node to the latest. Full changelog:
https://github.com/nodejs/node/blob/master/doc/changelogs/CHANGELOG_V6.md#6.10.0

OK ajacoutot@@
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.54 2017/01/23 16:47:04 abieber Exp $
d13 1
a13 1
NODE_VERSION =		v6.10.0
@


1.54
log
@Bump node to latest. Tested on amd64 and i386.

- fix Makefile layout
- back to using internal openssl :(

Rough OK from awolk@@, OK fcambus@@
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.53 2016/12/31 20:46:18 jca Exp $
d13 1
a13 1
NODE_VERSION =		v6.9.4
@


1.53
log
@Doesn't build on powerpc: Illegal instruction (core dumped)
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.52 2016/09/10 13:03:41 ajacoutot Exp $
d7 1
a7 1
ONLY_FOR_ARCHS=	amd64 i386
d9 1
a9 1
USE_WXNEEDED =	Yes
d11 1
a11 1
COMMENT=	V8 JavaScript for clients and servers
d13 1
a13 2
NODE_VERSION=	v4.4.7
REVISION=	2
d15 2
a16 2
PLEDGE_VER=	1.1.0
DISTFILES=	node-pledge-{}${PLEDGE_VER}.tar.gz:0 ${DISTNAME}.tar.gz
d18 2
a19 2
DISTNAME=	node-${NODE_VERSION}
PKGNAME=	${DISTNAME:S/v//g}
d21 1
a21 1
MASTER_SITES0=	https://github.com/qbit/node-pledge/archive/
d23 1
a23 1
CATEGORIES=	lang devel
d25 1
a25 1
HOMEPAGE=	http://nodejs.org/
d27 1
a27 1
MAINTAINER=	Aaron Bieber <abieber@@openbsd.org>
d30 1
a30 1
PERMIT_PACKAGE_CDROM=	Yes
d32 1
a32 1
MASTER_SITES=	${HOMEPAGE}dist/${NODE_VERSION}/
d34 2
a35 2
MODULES=	gcc4 \
		lang/python
d37 2
a38 2
MODGCC4_LANGS =	c c++
MODGCC4_ARCHS =	*
d40 1
a40 2
WANTLIB += c execinfo lib/eopenssl/crypto lib/eopenssl/ssl kvm m pthread
WANTLIB += util z
d42 1
a42 2
LIB_DEPENDS=	devel/libexecinfo \
		security/openssl
d44 1
a44 1
USE_GMAKE=	Yes
d46 1
a46 1
BUILD_DEPENDS=	sysutils/flock
d48 3
a50 3
RUN_DEPENDS=	devel/gmake \
		lang/gcc/${MODGCC4_VERSION},-c++ \
		sysutils/flock
d52 2
a53 2
TEST_TARGET=		test
CONFIGURE_STYLE=	simple
d57 2
a58 12
CONFIGURE_ARGS=	--prefix=${PREFIX} \
		--shared-openssl \
		--shared-openssl-includes=${LOCALBASE}/include/eopenssl \
		--shared-openssl-libpath=${LOCALBASE}/lib/eopenssl \
		--shared-zlib

SUBST_VARS+= 	DISTNAME
SUBST_VARS+= 	DISTFILES
SUBST_VARS+= 	EXTRACT_SUFX
SUBST_VARS+= 	LOCALBASE
SUBST_VARS+= 	PREFIX
SUBST_VARS+= 	WRKDIST
d60 9
a68 2
MAKE_ENV+=	V=1 CXX="${CXX}" CXXFLAGS="${CXXFLAGS}" \
		LDFLAGS="-L${LOCALBASE}/lib -L${X11BASE}/lib"
@


1.52
log
@First pass at pre-entively fixing ports that would break once guenther's header
pollution diff is in.

lang/squeak/vm does not build but it's due to the recent audio changes
games/xbattle: also fixes some conflicting implicit decl
print/hplip: also fixes some conflicting implicit decl
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.51 2016/08/25 15:59:58 jasper Exp $
d7 1
a7 1
ONLY_FOR_ARCHS=	amd64 i386 powerpc
@


1.51
log
@once more with an updated gcc; drop the workarounds and XXX comments

spotted by naddy@@
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.50 2016/08/25 08:42:08 jasper Exp $
d14 1
a14 1
REVISION=	1
@


1.50
log
@add USE_WXNEEDED (for sqlports purposes) as it doesn't work yet here (see comment)
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.49 2016/08/17 01:05:38 abieber Exp $
a8 1
# XXX: see MAKE_ENV below. at least mksnapshot gets built w/o wxneeded
d14 1
a14 1
REVISION=	0
d74 1
a74 1
		LDFLAGS="-L${LOCALBASE}/lib -L${X11BASE}/lib -Wl,-z,wxneeded"
@


1.49
log
@100% more wxneeded! Also fix for the man page that snuck in!

Tested on amd64 and i386

OK jca@@
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.48 2016/08/03 13:56:56 abieber Exp $
d8 3
@


1.48
log
@Update node to the latest.

Full ChangeLog:
https://github.com/nodejs/node/blob/master/doc/changelogs/CHANGELOG_V4.md#4.4.7

OK juanfra@@
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.47 2016/05/27 23:11:53 abieber Exp $
d12 1
d71 2
a72 1
MAKE_ENV+=	V=1 CXX="${CXX}" CXXFLAGS="${CXXFLAGS}"
@


1.47
log
@Bump node to the latest. Full changelog here:
https://github.com/nodejs/node/blob/v4.4.5/CHANGELOG.md

OK awolk@@
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.46 2016/05/09 15:43:06 abieber Exp $
d11 1
a11 1
NODE_VERSION=	v4.4.5
@


1.46
log
@Update to the latest. Patch from David CARLIER <devnexen@@gmail.com>

Tested by myself and awolk@@.

OK awolk@@
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.45 2016/04/19 18:38:06 abieber Exp $
d11 1
a11 1
NODE_VERSION=	v4.4.4
@


1.45
log
@Update node to the latest.

Full changelog here:
https://github.com/nodejs/node/blob/v4.4.3/CHANGELOG.md

OK giovanni
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.44 2016/03/12 02:50:36 abieber Exp $
d11 1
a11 1
NODE_VERSION=	v4.4.3
@


1.44
log
@Update to latest. Nothing special.

ChageLog: https://github.com/nodejs/node/blob/v4.4.0/CHANGELOG.md

OK awolk@@
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.43 2016/02/28 20:12:51 abieber Exp $
d11 1
a11 1
NODE_VERSION=	v4.4.0
d35 2
a36 2
MODGCC4_LANGS =         c c++
MODGCC4_ARCHS =         *
@


1.43
log
@Update to latest node, tested on amd64 by myself and awolk@@

OK awolk@@
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.42 2016/02/11 23:05:01 abieber Exp $
d11 1
a11 1
NODE_VERSION=	v4.3.1
@


1.42
log
@Update for security fixes. Tested on amd64 and i386.

OK sthen@@
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.41 2016/01/29 20:12:04 abieber Exp $
d11 1
a11 1
NODE_VERSION=	v4.3.0
@


1.42.2.1
log
@Backport fix for CVE-2016-1669:

https://github.com/nodejs/node/commit/134c3b3977

  Fix overflow issue in Zone::New

  When requesting a large allocation near the end of the address space,
  the computation could overflow and erroneously *not* grow the Zone
  as required.

	BUG=chromium:606115
	LOG=y

OK awolk@@
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.42 2016/02/11 23:05:01 abieber Exp $
a11 1
REVISION=	0
@


1.41
log
@Add in node-pledge module so users can require() it out of the box.
Build against openssl in ports.
Update to latest stable release of node.

OK giovanni@@
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.40 2016/01/08 16:50:13 abieber Exp $
d11 1
a11 1
NODE_VERSION=	v4.2.6
@


1.40
log
@Teach npm how to use eg++. This removes the need to do things like:
  env CXX=eg++ npm install nativemodule

OK jasper@@
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.39 2016/01/01 04:47:05 abieber Exp $
d11 4
a14 2
NODE_VERSION=	v4.2.4
REVISION=	0
d19 2
d38 2
a39 1
WANTLIB += c execinfo kvm m pthread util z
d41 2
a42 1
LIB_DEPENDS=	devel/libexecinfo
d55 2
d58 3
d63 1
d65 1
d72 7
a78 1
NO_CCACHE=	Yes
d84 1
d87 1
d92 5
a96 3
	${INSTALL_DATA_DIR} ${PREFIX}/lib/node
	${INSTALL_DATA} ${FULLDISTDIR}/${DISTFILES} \
		${PREFIX}/lib/node/${DISTFILES}
a102 2
	cd ${PREFIX}/include/node/openssl/archs; rm -rf \
		{VC,aix,darwin,linux,solaris}*
@


1.39
log
@Update to the latest version.

Full changelog here:
https://github.com/nodejs/node/blob/v4.2.4/CHANGELOG.md

OK juanfra@@
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.38 2015/12/28 16:08:33 mpi Exp $
d12 1
@


1.38
log
@Add 'powerpc' to ONLY_FOR_ARCHS.

Node builds and runs just fine on macppc since v8 has ppc support.

ok abieber@@
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.37 2015/12/21 19:27:05 abieber Exp $
d11 1
a11 1
NODE_VERSION=	v4.2.3
@


1.37
log
@Update to the lastest version. Add two new patches:

patches/patch-deps_uv_src_unix_openbsd_c is from Fabian Raetz
<fabian.raetz@@gmail.com>, it was sent upstream as well. It will be included
in one of the next libuv releases.
patches/patch-deps_v8_src_globals_h is from robert@@'s v8 patches (slightly
modified), recommended by sthen@@.

OK jturner@@
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.36 2015/11/14 17:26:05 abieber Exp $
d7 1
a7 1
ONLY_FOR_ARCHS=	amd64 i386
@


1.36
log
@Update node to the latest LTS.

Full changelog: https://github.com/nodejs/node/blob/v4.2.2/CHANGELOG.md

OK ajacoutot@@
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.35 2015/10/27 11:58:01 sthen Exp $
d11 1
a11 1
NODE_VERSION=	v4.2.2
@


1.35
log
@This doesn't use NODE_ARCH any more, so remove it, rm some other-OS include
files that aren't needed, and regen plist which fixes a packaging problem
with i386. Cleanup unused CFLAGS from SUBST_VARS as well, and switch run dep
to g++ instead of gcc. OK abieber@@
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.34 2015/10/24 02:46:47 abieber Exp $
d11 1
a11 2
NODE_VERSION=	v4.2.1
REVISION=	0
@


1.34
log
@Finally update node to the latest version, lots of changes:
 - Use internal OpenSSL (no LibreSSL :( )
 - Remove node.port.mk as there are no longer any modules in ports.
 - Remove various patches that are now upstream.
 - Fix some tests by telling test.py the fully qualified path to node
 - Add gcc as a RUN dep for building native node modules.
 - Clean up Makefile a bit.

OK juanfra@@
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.33 2015/02/03 15:48:20 abieber Exp $
d12 1
a37 5
NODE_ARCH=	i386
.if ${MACHINE_ARCH} == "amd64"
NODE_ARCH=	x86_64
.endif

d43 1
a43 1
		lang/gcc/${MODGCC4_VERSION} \
a51 1
SUBST_VARS+=	CFLAGS
a53 1
SUBST_VARS+= 	NODE_ARCH
d80 2
a81 1

@


1.33
log
@Bump node to almost the latest.

ChangeLog: https://raw.githubusercontent.com/joyent/node/v0.10.35/ChangeLog

"do it" aja@@
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.32 2014/09/24 18:17:27 abieber Exp $
d11 1
a11 1
NODE_VERSION=	v0.10.35
d27 2
a28 1
MODULES=	lang/python
d30 4
a33 1
WANTLIB +=	c crypto execinfo kvm m pthread ssl stdc++ util z
d37 5
d44 1
a44 2
BUILD_DEPENDS=	devel/gyp \
		sysutils/flock
a45 1
# node-gyp uses it at runtime
d47 1
a47 1
		devel/gyp \
d50 4
a53 3
TEST_TARGET= test
CONFIGURE_STYLE= simple
CONFIGURE_ARGS= --openssl-use-sys \
d57 3
d61 1
a61 2
SUBST_VARS+= 	LOCALBASE
SUBST_VARS+= 	DISTFILES
d63 1
a63 1
MAKE_ENV+=	V=1 CXX=c++ CCFLAGS+="${CFLAGS}" CXXFLAGS="${CXXFLAGS}"
d73 2
a74 1
		${WRKDIST}/common.gypi
@


1.32
log
@Update to 0.10.32 which removes the need for isolate.h diff.

goahead from landry@@ and jasper@@
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.31 2014/09/09 14:01:26 jasper Exp $
d11 1
a11 1
NODE_VERSION=	v0.10.32
@


1.31
log
@Security fix for CVE-2014-5256

ok abieber@@ (MAINTAINER)
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.30 2014/07/10 19:54:57 landry Exp $
d11 1
a11 2
NODE_VERSION=	v0.10.28
REVISION=	2
@


1.30
log
@Properly implement process.memoryUsage() via sysctl() on KERN_PROC_PID
instead of using kvm_open.
ok abieber@@ (MAINTAINER)
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.29 2014/05/12 01:34:55 abieber Exp $
d12 1
a12 1
REVISION=	1
@


1.30.2.1
log
@Security fix for CVE-2014-5256
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.30 2014/07/10 19:54:57 landry Exp $
d12 1
a12 1
REVISION=	2
@


1.29
log
@Get shasum from dist tarball vs downloaded shasum file. Fixes USE_SYSTRACE.

OK sthen@@
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.28 2014/05/06 03:10:08 abieber Exp $
d12 1
a12 1
REVISION=	0
@


1.28
log
@Update node to 0.10.28
Changelog: https://raw.githubusercontent.com/joyent/node/v0.10.28/ChangeLog

OK jturner@@
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.27 2014/01/20 19:42:00 abieber Exp $
d12 1
@


1.27
log
@update node to 0.10.24 which has a few fixes for cve-2013-6639 and
cve-2013-6640.

OK jasper@@
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.26 2013/12/06 15:14:16 abieber Exp $
d11 1
a11 1
NODE_VERSION=	v0.10.24
@


1.27.2.1
log
@Security fix for CVE-2014-5256
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.27 2014/01/20 19:42:00 abieber Exp $
a14 1
REVISION=	0
@


1.26
log
@Unbreak node - forgot to add gyp as a build dep.

OK naddy@@
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.25 2013/12/04 20:20:52 abieber Exp $
d11 1
a11 1
NODE_VERSION=	v0.10.22
@


1.25
log
@Update node to the lastest version.

OK jasper@@
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.24 2013/11/25 14:16:23 sthen Exp $
d35 2
a36 1
BUILD_DEPENDS=	sysutils/flock
@


1.24
log
@kill VMEM_WARNING
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.23 2013/10/23 22:00:17 abieber Exp $
d11 1
a11 1
NODE_VERSION=	v0.10.21
@


1.23
log
@Bring node to the latest version which has a fix for this:
http://www.openwall.com/lists/oss-security/2013/10/19/4

OK bcallah@@
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.22 2013/10/22 15:29:13 abieber Exp $
a27 2

VMEM_WARNING=	Yes
@


1.22
log
@Bring node up to 0.10.20
	- use internal libv8

OK sthen@@
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.21 2013/08/11 17:12:13 abieber Exp $
d11 1
a11 1
NODE_VERSION=	v0.10.20
@


1.21
log
@Make gyp a run dep for node. I think the lack of this is causing the node-*
failures that keep randomly happening.

OK landry@@
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.20 2013/06/27 13:47:03 abieber Exp $
d11 1
a11 2
NODE_VERSION=	v0.10.12
REVISION=	0
d31 1
a31 1
WANTLIB +=	c crypto execinfo kvm m pthread ssl stdc++ util v8 z
d33 1
a33 2
LIB_DEPENDS=	devel/libexecinfo \
		lang/libv8
d47 1
a47 2
		--shared-zlib \
		--shared-v8
@


1.20
log
@Update node to 0.10.12

OK jturner@@
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.19 2013/06/17 23:51:28 abieber Exp $
d12 1
d43 1
@


1.20.2.1
log
@Security fix for CVE-2013-4450, NodeJS: HTTP Pipelining DoS
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.20 2013/06/27 13:47:03 abieber Exp $
a13 1
REVISION=	0
@


1.19
log
@Fix to make npm not try and chmod symlinked modules. Sent upstream as well:
https://github.com/isaacs/npm/pull/3575

OK sthen@@
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.18 2013/05/24 13:43:41 abieber Exp $
d11 1
a11 2
NODE_VERSION=	v0.10.7
REVISION=	0
@


1.18
log
@Bump node.js to the latest version.

OK jeremy@@
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.17 2013/03/11 11:20:28 espie Exp $
d12 1
@


1.17
log
@PERMIT_* / REGRESS->TEST sweep
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.16 2013/03/04 14:29:24 abieber Exp $
d11 1
a11 1
NODE_VERSION=	v0.8.21
a43 3
MODPY_ADJ_FILES= tools/node-waf \
		tools/waf-light

d68 1
a68 2
	${MODPY_BIN} ${MODPY_LIBDIR}/compileall.py \
		${PREFIX}/lib/node/wafadmin
@


1.16
log
@upgrade to 0.8.21

OK jasper@@
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.15 2013/01/27 03:56:06 abieber Exp $
a23 3
PERMIT_PACKAGE_FTP=	Yes
PERMIT_DISTFILES_CDROM=	Yes
PERMIT_DISTFILES_FTP=	Yes
d47 1
a47 1
REGRESS_TARGET= test
@


1.15
log
@Update node to 0.8.18

OK sthen@@
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.14 2013/01/13 14:53:40 abieber Exp $
d11 1
a11 1
NODE_VERSION=	v0.8.18
@


1.15.2.1
log
@Security fix for CVE-2013-4450, NodeJS: HTTP Pipelining DoS
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.15 2013/01/27 03:56:06 abieber Exp $
a11 1
REVISION=	0
@


1.14
log
@Upgrade node to 0.8.17
- remove two of our patches

OK jasper@@
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.13 2012/12/12 16:51:23 abieber Exp $
d11 1
a11 1
NODE_VERSION=	v0.8.17
@


1.13
log
@Update lang/node to 0.8.15

OK jeremy@@
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.12 2012/12/06 22:51:08 abieber Exp $
d11 1
a11 1
NODE_VERSION=	v0.8.15
@


1.12
log
@Add v8 to WANTLIB
Add lang/libv8 to LIB_DEPENDS
Remove lang/libv8 from BUILD_DEPENDS

OK sthen@@
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.11 2012/12/05 00:40:27 abieber Exp $
d11 1
a11 1
NODE_VERSION=	v0.8.11
a14 2

REVISION=1
@


1.11
log
@Update node to use lang/libv8

OK jeremy@@
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.10 2012/09/28 01:04:14 abieber Exp $
d16 1
a16 1
REVISION=0
d36 1
a36 1
WANTLIB +=	c crypto execinfo kvm m pthread ssl stdc++ util z
d38 2
a39 1
LIB_DEPENDS=	devel/libexecinfo
d43 1
a43 2
BUILD_DEPENDS=	sysutils/flock \
		lang/libv8
@


1.10
log
@Update node to 0.8.11

  -Fix stat() size reporting for large files

OK sthen@@
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.9 2012/09/26 17:22:36 abieber Exp $
d16 2
d42 3
a44 1
BUILD_DEPENDS=	sysutils/flock
d55 2
a56 1
		--shared-zlib
d60 1
d72 2
a73 1
		${WRKDIST}/deps/npm/node_modules/node-gyp/lib/install.js
@


1.9
log
@- update node to 0.8.10

OK jeremy@@, jasper@@
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.8 2012/09/14 22:40:20 abieber Exp $
d11 1
a11 1
NODE_VERSION=	v0.8.10
@


1.8
log
@- update node to 0.8.9

OK jasper@@
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.7 2012/08/30 01:13:32 abieber Exp $
d11 1
a11 1
NODE_VERSION=	v0.8.9
@


1.7
log
@- upgrade node to 0.8.8
OK sthen@@, jasper@@
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.6 2012/08/23 17:29:44 abieber Exp $
d11 1
a11 1
NODE_VERSION=	v0.8.8
@


1.6
log
@- update node to 0.8.7
- add @@mandir to plist
OK sthen@@, jasper@@
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.5 2012/07/10 00:45:10 abieber Exp $
d11 1
a11 1
NODE_VERSION=	v0.8.7
@


1.5
log
@- update node to 0.8.2
- really remove @@extraunexec

ok sthen@@, jeremy@@
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.4 2012/07/09 13:54:54 abieber Exp $
d11 1
a11 1
NODE_VERSION=	v0.8.2
@


1.5.2.1
log
@add a fix for 32bit size/index overflow
 - https://github.com/joyent/node/commit/ed825f488867d7586bee6ca4feb5fe5b0461775e

OK jasper@@
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.5 2012/07/10 00:45:10 abieber Exp $
a11 1
REVISION=	0
@


1.4
log
@- update node to 0.8.1
- remove @@extraunexec

ok jeremy@@, sthen@@
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.3 2012/06/28 08:30:28 jasper Exp $
d11 1
a11 1
NODE_VERSION=	v0.8.1
@


1.3
log
@- update node to 0.8.0
* please see this blog post for more details on the changes:
  http://blog.nodejs.org/2012/06/25/node-v0-8-0/
  * the migration wiki can be consulted to port your code to node 0.8:
    https://github.com/joyent/node/wiki/API-changes-between-v0.6-and-v0.8
    - expose node-gyp, so it's now installed into ${LOCALBASE}/bin/ too

    from aaron bieber with tweaks by me
    ok jeremy@@
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.2 2012/06/06 20:33:50 sthen Exp $
d11 1
a11 1
NODE_VERSION=	v0.8.0
d20 1
a20 1
MAINTAINER=	Aaron Bieber <deftly@@gmail.com>
@


1.2
log
@update to Node 0.6.19, from maintainer Aaron Bieber
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.1.1.1 2012/05/23 15:11:43 jasper Exp $
d11 2
a12 1
NODE_VERSION=	v0.6.19
d40 1
d45 1
a45 2
MODPY_ADJ_FILES=wscript \
		tools/node-waf \
d50 2
d57 1
a57 1
MAKE_ENV+=	CXX=c++ CCFLAGS+="${CFLAGS}" CXXFLAGS="${CXXFLAGS}"
d73 6
@


1.1
log
@Initial revision
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.38 2012/05/15 17:37:34 jasper Exp $
d11 1
a11 1
NODE_VERSION=	v0.6.18
a13 1
REVISION=	0
@


1.1.1.1
log
@re-import node into lang, www was poorly chosen at the time of import

from aaron bieber (MAINTAINER), with cluestick hitting by espie@@ 
as discussed with and ok sthen@@

@
text
@@
