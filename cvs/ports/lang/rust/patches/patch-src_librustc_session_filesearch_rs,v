head	1.5;
access;
symbols
	OPENBSD_6_1:1.4.0.2
	OPENBSD_6_1_BASE:1.4
	OPENBSD_6_0:1.2.0.2
	OPENBSD_6_0_BASE:1.2;
locks; strict;
comment	@# @;


1.5
date	2017.07.31.13.19.13;	author danj;	state Exp;
branches;
next	1.4;
commitid	Lhxz2MNPfiKEauR6;

1.4
date	2017.02.15.12.52.35;	author landry;	state Exp;
branches;
next	1.3;
commitid	NM74A8PX4zxQ5FFL;

1.3
date	2016.08.31.08.33.19;	author landry;	state Exp;
branches;
next	1.2;
commitid	rjCKCwuvdXGdhOcu;

1.2
date	2016.05.29.07.26.46;	author semarie;	state Exp;
branches;
next	1.1;
commitid	roUcrlyczCPIKJzh;

1.1
date	2016.05.25.06.39.35;	author semarie;	state Exp;
branches;
next	;
commitid	MXspGwnScCXVczTc;


desc
@@


1.5
log
@Update to rust-1.19.0

It now includes cargo

From semarie (maintainer)
@
text
@$OpenBSD: patch-src_librustc_session_filesearch_rs,v 1.4 2017/02/15 12:52:35 landry Exp $
fallback to LOCALBASE as default sysroot.
Index: src/librustc/session/filesearch.rs
--- src/librustc/session/filesearch.rs.orig
+++ src/librustc/session/filesearch.rs
@@@@ -166,7 +166,10 @@@@ pub fn get_or_default_sysroot() -> PathBuf {
                 None => bug!("can't determine value for sysroot")
             }
         }
-        Err(ref e) => panic!(format!("failed to get current_exe: {}", e))
+        Err(ref e) => match option_env!("LOCALBASE") {
+            Some(dir) => return PathBuf::from(dir),
+            None => panic!(format!("failed to get current_exe: {}", e))
+        }
     }
 }
 
@


1.4
log
@Update to rust 1.15.1.

- switch to rustbuild build system instead of configure (the world
  definitely needed one more build system!)
- the build still takes +INF hours, this is being investigated

Note that rust will be a hard-requirement for gecko 54... sigh.

Tested by semarie@@ and myself on i386 & amd64.

All the hard work and countless build hours by semarie@@, thanks!
@
text
@d1 1
a1 1
$OpenBSD: patch-src_librustc_session_filesearch_rs,v 1.3 2016/08/31 08:33:19 landry Exp $
d3 11
a13 10
--- src/librustc/session/filesearch.rs.orig	Mon Jul  4 20:04:09 2016
+++ src/librustc/session/filesearch.rs	Tue Jul  5 19:01:38 2016
@@@@ -161,7 +161,10 @@@@ pub fn get_or_default_sysroot() -> PathBuf {
 
     match canonicalize(env::current_exe().ok()) {
         Some(mut p) => { p.pop(); p.pop(); p }
-        None => bug!("can't determine value for sysroot")
+        None => match option_env!("LOCALBASE") {
+            Some(dir) => PathBuf::from(dir),
+            None => bug!("can't determine value for sysroot"),
@


1.3
log
@Update to rust 1.11.0, from semarie@@, thanks!
All tests passing here.
@
text
@d1 2
a2 2
$OpenBSD: patch-src_librustc_session_filesearch_rs,v 1.2 2016/05/29 07:26:46 semarie Exp $
fallback to CFG_PREFIX as default sysroot.
d10 1
a10 1
+        None => match option_env!("CFG_PREFIX") {
@


1.2
log
@lang/rust update to 1.9.0

- changes in Makefile to make it compute itself the RUST_HASH value

- use new configure option --disable-codegen-tests as with don't have FileCheck
  (from llvm) binary. remove the patches in configure and src/compiletest/runtest.rs

- disable (for now) two news tests added with unix socket support, that doesn't
  pass. I will investigate them later.

- disable run-pass/backtrace test. The support of libbacktrace has been remove
  recently.
@
text
@d1 1
a1 1
$OpenBSD$
d3 3
a5 3
--- src/librustc/session/filesearch.rs.orig	Mon May 23 18:29:00 2016
+++ src/librustc/session/filesearch.rs	Tue May 24 06:08:20 2016
@@@@ -162,7 +162,10 @@@@ pub fn get_or_default_sysroot() -> PathBuf {
@


1.1
log
@lang/rust: fallback to LOCALBASE for sysroot

- std::env::current_exe() returns an error instead of returning wrong
  pathname (no complete, but rust build scripts makes (bad)
  assumptions that I couldn't patch for now).

- rustc / rustdoc to use CFG_PREFIX (configure --prefix value) when
  std::env::current_exe() return an error

- remove the installed wrapper used to pass --sysroot argument to
  rustc (the wrapper was used for workaround the problem differently
  for rustc, but didn't resolv the problem for rustdoc as it doesn't
  have --sysroot argument).

looks ok edd@@
@
text
@d3 2
a4 2
--- src/librustc/session/filesearch.rs.orig	Fri May  6 06:30:18 2016
+++ src/librustc/session/filesearch.rs	Fri May  6 06:31:04 2016
d9 1
a9 1
-        None => panic!("can't determine value for sysroot")
d12 1
a12 1
+            None => panic!("can't determine value for sysroot"),
@

