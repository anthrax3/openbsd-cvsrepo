head	1.3;
access;
symbols
	OPENBSD_6_1:1.2.0.2
	OPENBSD_6_1_BASE:1.2;
locks; strict;
comment	@# @;


1.3
date	2017.05.05.11.40.29;	author landry;	state dead;
branches;
next	1.2;
commitid	Vk0ki6dvK3m2aqtF;

1.2
date	2017.02.15.12.52.35;	author landry;	state Exp;
branches;
next	1.1;
commitid	NM74A8PX4zxQ5FFL;

1.1
date	2017.02.02.08.02.50;	author landry;	state Exp;
branches;
next	;
commitid	yNH1Zudd7906Mr5F;


desc
@@


1.3
log
@Update to rust 1.17.0, from semarie@@

Use ports llvm instead of building the bundled copy (yay!)
More work needed to actually build with clang ...
@
text
@$OpenBSD: patch-src_llvm_include_llvm_Support_Threading_h,v 1.2 2017/02/15 12:52:35 landry Exp $
https://github.com/llvm-mirror/llvm/commit/f92d91a710f48a26e44451f18f0081b6af0670b7
--- src/llvm/include/llvm/Support/Threading.h.orig	Wed Dec 21 00:36:08 2016
+++ src/llvm/include/llvm/Support/Threading.h	Sun Jan 29 09:20:53 2017
@@@@ -20,11 +20,11 @@@@
 #include <ciso646> // So we can check the C++ standard lib macros.
 #include <functional>
 
-// We use std::call_once on all Unix platforms except for NetBSD with
-// libstdc++. That platform has a bug they are working to fix, and they'll
-// remove the NetBSD checks once fixed.
-#if defined(LLVM_ON_UNIX) &&                                                   \
-    !(defined(__NetBSD__) && !defined(_LIBCPP_VERSION)) && !defined(__ppc__)
+// std::call_once from libc++ is used on all Unix platforms. Other
+// implementations like libstdc++ are known to have problems on NetBSD,
+// OpenBSD and PowerPC.
+#if defined(LLVM_ON_UNIX) && (defined(_LIBCPP_VERSION) ||                      \
+    !(defined(__NetBSD__) || defined(__OpenBSD__) || defined(__ppc__)))
 #define LLVM_THREADING_USE_STD_CALL_ONCE 1
 #else
 #define LLVM_THREADING_USE_STD_CALL_ONCE 0
@


1.2
log
@Update to rust 1.15.1.

- switch to rustbuild build system instead of configure (the world
  definitely needed one more build system!)
- the build still takes +INF hours, this is being investigated

Note that rust will be a hard-requirement for gecko 54... sigh.

Tested by semarie@@ and myself on i386 & amd64.

All the hard work and countless build hours by semarie@@, thanks!
@
text
@d1 1
a1 1
$OpenBSD: patch-src_llvm_include_llvm_Support_Threading_h,v 1.1 2017/02/02 08:02:50 landry Exp $
@


1.1
log
@Temporarly switch rust to build with embedded llvm.

rust doesnt build yet with llvm 4.0, which should be soon updated in the
portstree. Upstream rust support for llvm 4.0 is in the pipe.

From semarie@@
@
text
@d1 2
a2 1
$OpenBSD$
@

