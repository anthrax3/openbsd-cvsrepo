head	1.2;
access;
symbols
	OPENBSD_5_4:1.1.0.12
	OPENBSD_5_4_BASE:1.1
	OPENBSD_5_3:1.1.0.10
	OPENBSD_5_3_BASE:1.1
	OPENBSD_5_2:1.1.0.8
	OPENBSD_5_2_BASE:1.1
	OPENBSD_5_1_BASE:1.1
	OPENBSD_5_1:1.1.0.6
	OPENBSD_5_0:1.1.0.4
	OPENBSD_5_0_BASE:1.1
	OPENBSD_4_9:1.1.0.2
	OPENBSD_4_9_BASE:1.1;
locks; strict;
comment	@# @;


1.2
date	2013.10.26.23.44.58;	author jeremy;	state dead;
branches;
next	1.1;

1.1
date	2011.01.21.16.36.53;	author jeremy;	state Exp;
branches;
next	;


desc
@@


1.2
log
@Major update to rubinius 2.1.1.  Start using LLVM again as this
version supports the in-tree LLVM.
@
text
@$OpenBSD: patch-lib_zlib_rb_ffi,v 1.1 2011/01/21 16:36:53 jeremy Exp $

OpenBSD uses off_t instead of unsigned long for the total_in and
total_out struct members, so it works on files >4GB.  Rubinius has
harcoded ulong instead of checking, as ulong is what most other
OSes use.

--- lib/zlib.rb.ffi.orig	Thu Jan 20 11:45:11 2011
+++ lib/zlib.rb.ffi	Thu Jan 20 11:45:15 2011
@@@@ -245,11 +245,11 @@@@ module Zlib
         s.name "struct z_stream_s"
         s.field :next_in,   :pointer
         s.field :avail_in,  :uint
-        s.field :total_in,  :ulong
+        s.field :total_in,  :off_t
 
         s.field :next_out,  :pointer
         s.field :avail_out, :uint
-        s.field :total_out, :ulong
+        s.field :total_out, :off_t
 
         s.field :msg,       :string
         s.field :state,     :pointer
@


1.1
log
@Fix zlib ffi driver on 32-bit big endian platforms.  Fixes gem
installation on macppc.  Thanks to ajacoutot@@ for access to a macppc
machine.

OK ajacoutot@@, jasper@@
@
text
@d1 1
a1 1
$OpenBSD$
@

