head	1.7;
access;
symbols
	OPENBSD_6_0:1.7.0.14
	OPENBSD_6_0_BASE:1.7
	OPENBSD_5_9:1.7.0.10
	OPENBSD_5_9_BASE:1.7
	OPENBSD_5_8:1.7.0.12
	OPENBSD_5_8_BASE:1.7
	OPENBSD_5_7:1.7.0.8
	OPENBSD_5_7_BASE:1.7
	OPENBSD_5_6:1.7.0.6
	OPENBSD_5_6_BASE:1.7
	OPENBSD_5_5:1.7.0.4
	OPENBSD_5_5_BASE:1.7
	OPENBSD_5_4:1.7.0.2
	OPENBSD_5_4_BASE:1.7
	OPENBSD_5_3:1.6.0.2
	OPENBSD_5_3_BASE:1.6
	ports:1.1.1.1
	espie:1.1.1;
locks; strict;
comment	@# @;


1.7
date	2013.03.11.12.05.19;	author espie;	state Exp;
branches;
next	1.6;

1.6
date	2013.01.21.15.26.20;	author espie;	state Exp;
branches;
next	1.5;

1.5
date	2012.11.06.14.49.28;	author espie;	state Exp;
branches;
next	1.4;

1.4
date	2012.11.06.08.19.02;	author espie;	state Exp;
branches;
next	1.3;

1.3
date	2012.11.05.20.27.52;	author espie;	state Exp;
branches;
next	1.2;

1.2
date	2012.11.03.09.41.55;	author espie;	state Exp;
branches;
next	1.1;

1.1
date	2012.11.01.09.58.05;	author espie;	state Exp;
branches
	1.1.1.1;
next	;

1.1.1.1
date	2012.11.01.09.58.05;	author espie;	state Exp;
branches;
next	;


desc
@@


1.7
log
@extra
@
text
@# $OpenBSD: xenocara.port.mk,v 1.6 2013/01/21 15:26:20 espie Exp $

CATEGORIES = base xenocara
COMMENT = Xenocara ${COMPONENT}
FLAT = ${COMPONENT:S/\//./g:C/-([0-9])/_\1/g}
VERSION ?= 2
DISTNAME = xc-${FLAT}-${VERSION}
DISTFILES =

PERMIT_PACKAGE_CDROM=   Yes

LOCATION = ${PACKAGE_REPOSITORY}/${MACHINE_ARCH}/components
REV = ${OSREV:S/.//}

MAKE_FLAGS = XOBJDIR=${WRKDIR}/obj
FAKE_FLAGS += RELEASEDIR=${LOCATION}
SUBST_VARS += COMPONENT
PKGDIR ?= ${PORTSDIR}/base/xenocara/pkg
CFLAGS += -I${INCBASE}${X11BASE}/include
CXXFLAGS += -I${INCBASE}${X11BASE}/include

ALL_TARGET ?= depend all
FAKE_TARGET ?= install
XENOCARA_COMPONENT =	Yes

BUILD_DEPENDS = ${XDEPS:S,^,base/xenocara/,}
RUN_DEPENDS = ${BUILD_DEPENDS}
COMPONENT_TYPE ?=

.if ${COMPONENT_TYPE:Mlib}
PKG_ARGS += -DLIB=1
.else
PKG_ARGS += -DLIB=0
.endif

.if defined(FONTSDIRS) && !empty(FONTSDIRS)
PKG_ARGS += -DFONT=1
SUBST_VARS += FONTSDIRS
.else
PKG_ARGS += -DFONT=0
.endif

.if ${COMPONENT} != "share/mk"
BUILD_DEPENDS += base/xenocara/share/mk
.endif
RUN_DEPENDS += base/bootstrap

MANIFEST = ${PREFIX}/libdata/base/${FULLPKGNAME}.manifest

XINCDIRS = GL/internal X11/ICE X11/PM X11/SM X11/Xaw X11/Xcursor \
	X11/Xft X11/Xmu X11/Xtrans X11/bitmaps X11/dri \
	X11/extensions X11/fonts X11/pixmaps fontconfig \
	freetype2/freetype/config \
	freetype2/freetype/internal/services pixman-1 xcb xorg

INCBASE = ${WRKDIR}/incbase

.if defined(XCVS_CO)
WRKSRC ?= ${WRKDIR}/xenocara/${COMPONENT}
.  if !target(post-extract)
post-extract:
	cd ${WRKDIR} && ${XCVS_CO} -P xenocara/${COMPONENT} ${EXTRA_SRC}
.  endif
.else
WRKSRC ?= ${XSRCDIR}/${COMPONENT}
.endif

# handling of includes AND obj
.if !target(post-patch)
post-patch:
	mkdir -p ${WRKDIR}/obj
	cd ${WRKSRC} && ${MAKE} -f ${MAKE_FILE} ${MAKE_FLAGS} obj
.endif
.if !target(pre-configure)
pre-configure:
.  for i in ${XINCDIRS}
	mkdir -p ${INCBASE}${X11BASE}/include/$i
.  endfor
	cd ${WRKSRC} && ${MAKE} -f ${MAKE_FILE} ${MAKE_FLAGS} includes DESTDIR=${INCBASE} INSTALL_DATA='cp -fp'
.endif

# XXX this doesn't work yet, no idea why
#.if "${MAKE_FILE}" == "Makefile.bsd-wrapper" && !target(do-configure)
#do-configure:
#	cd ${WRKSRC} && ${SUDO} ${MAKE} -f ${MAKE_FILE} ${MAKE_FLAGS} config.status
#.endif

.if !target(pre-install)
pre-install:
	cd ${WRKINST} && find . -print >${WRKDIR}/badlist
# I should be able to say FAKE_TARGET=includes install
# but at least freetype is broken in such a way that this doesn't work at all
	cd ${WRKSRC} && ${SUDO} ${MAKE} -f ${MAKE_FILE} ${MAKE_FLAGS} includes DESTDIR=${WRKINST}
.endif

.if !target(post-install)
post-install:
	mkdir -p ${LOCATION}
	@@cd ${WRKINST} && find . -print |fgrep -v -e /fonts.dir -e /fonts.scale >goodlist
	@@echo ./goodlist >>${WRKDIR}/badlist
	mkdir -p ${PREFIX}/libdata/base
	@@sort ${WRKINST}/goodlist ${WRKDIR}/badlist |uniq -u >${MANIFEST}
	@@a=`mktemp ${LOCATION}/${FLAT}.tgz.XXXXXX`; \
	cd ${WRKINST} && \
	    tar zcf $$a -I ${MANIFEST}; \
	echo xc-${FLAT} $$a >${PREFIX}/libdata/base/${FULLPKGNAME}.gen
.endif
@


1.6
log
@don't know if that's a new dep, or if I missed it previously.
found out because I suddenly find myself without any X installation ?
@
text
@d1 1
a1 1
# $OpenBSD: xenocara.port.mk,v 1.5 2012/11/06 14:49:28 espie Exp $
a10 3
PERMIT_PACKAGE_FTP=     Yes
PERMIT_DISTFILES_CDROM= Yes
PERMIT_DISTFILES_FTP=   Yes
@


1.5
log
@lol thinko
@
text
@d1 1
a1 1
# $OpenBSD: xenocara.port.mk,v 1.4 2012/11/06 08:19:02 espie Exp $
d6 1
a6 1
VERSION ?= 1
@


1.4
log
@allow a tweak to XCVS_CO usage to allow for extracting further source.
Allows GL, xcb, xkeyboard-config to reach out into their dist/ directory,
and kdrive to reuse the xserver material (might be smarter to multi-package
xserver/kdrive ? though kdrive is not exactly quick to build)
@
text
@d1 1
a1 1
# $OpenBSD: xenocara.port.mk,v 1.3 2012/11/05 20:27:52 espie Exp $
d41 1
a41 1
SUBST_VARS += ${FONTSDIRS}
@


1.3
log
@give fonts/lib a better chance to work when starting from scratch:
- don't save fonts.dir, regenerate.
- run ldconfig after installing a lib.
- mark pixman as not for vax/landisk.
@
text
@d1 1
a1 1
# $OpenBSD: xenocara.port.mk,v 1.2 2012/11/03 09:41:55 espie Exp $
d65 1
a65 1
	cd ${WRKDIR} && ${XCVS_CO} -P xenocara/${COMPONENT}
@


1.2
log
@forgot to relink release, fix it so that we try to build it.
pieces to try to compile directly from cvs (but xenocara needs to
stop reaching out in share/mk for that to work)
move xmessage to necessary build components, as some windowmaker widget
tests for its presence.
@
text
@d1 1
a1 1
# $OpenBSD: xenocara.port.mk,v 1.1.1.1 2012/11/01 09:58:05 espie Exp $
d6 1
a6 1
VERSION ?= 0
d31 14
d102 1
a102 1
	@@cd ${WRKINST} && find . -print >goodlist
@


1.1
log
@Initial revision
@
text
@d1 1
a1 1
# $OpenBSD$
d47 7
a53 8
# XXX can't work because of Makefile.bsd-wrapper vs Makefile
#.if defined(XCVS_CO)
#WRKSRC ?= ${WRKDIR}/xenocara/${COMPONENT}
#.  if !target(post-extract)
#post-extract:
#	cd ${WRKDIR} && ${XCVS_CO} -P xenocara/${COMPONENT}
#.  endif
#.else
a54 4
#.endif

.if exists(${WRKSRC}/Makefile.bsd-wrapper)
MAKE_FILE = Makefile.bsd-wrapper
d68 1
a68 1
	cd ${WRKSRC} && ${MAKE} -f ${MAKE_FILE} ${MAKE_FLAGS} includes DESTDIR=${INCBASE} INSTALL_DATA='cp -f'
@


1.1.1.1
log
@experimental work: build xenocara components as "packages" and hook them
into dpb.
not 100% ready yet, committed to keep working in tree.
@
text
@@
