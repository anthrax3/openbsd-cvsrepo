head	1.3;
access;
symbols
	OPENBSD_6_1:1.3.0.22
	OPENBSD_6_1_BASE:1.3
	OPENBSD_6_0:1.3.0.20
	OPENBSD_6_0_BASE:1.3
	OPENBSD_5_9:1.3.0.16
	OPENBSD_5_9_BASE:1.3
	OPENBSD_5_8:1.3.0.18
	OPENBSD_5_8_BASE:1.3
	OPENBSD_5_7:1.3.0.14
	OPENBSD_5_7_BASE:1.3
	OPENBSD_5_6:1.3.0.12
	OPENBSD_5_6_BASE:1.3
	OPENBSD_5_5:1.3.0.10
	OPENBSD_5_5_BASE:1.3
	OPENBSD_5_4:1.3.0.8
	OPENBSD_5_4_BASE:1.3
	OPENBSD_5_3:1.3.0.6
	OPENBSD_5_3_BASE:1.3
	OPENBSD_5_2:1.3.0.4
	OPENBSD_5_2_BASE:1.3
	OPENBSD_5_1_BASE:1.3
	OPENBSD_5_1:1.3.0.2
	OPENBSD_5_0:1.2.0.14
	OPENBSD_5_0_BASE:1.2
	OPENBSD_4_9:1.2.0.12
	OPENBSD_4_9_BASE:1.2
	OPENBSD_4_8:1.2.0.10
	OPENBSD_4_8_BASE:1.2
	OPENBSD_4_7:1.2.0.8
	OPENBSD_4_7_BASE:1.2
	OPENBSD_4_6:1.2.0.6
	OPENBSD_4_6_BASE:1.2
	OPENBSD_4_5:1.2.0.4
	OPENBSD_4_5_BASE:1.2
	OPENBSD_4_4:1.2.0.2
	OPENBSD_4_4_BASE:1.2
	OPENBSD_4_3:1.1.0.2
	OPENBSD_4_3_BASE:1.1;
locks; strict;
comment	@# @;


1.3
date	2011.09.02.15.44.46;	author naddy;	state Exp;
branches;
next	1.2;

1.2
date	2008.05.28.20.03.13;	author naddy;	state Exp;
branches;
next	1.1;

1.1
date	2007.08.25.13.51.08;	author naddy;	state Exp;
branches;
next	;


desc
@@


1.3
log
@maintenance update to 1.14; ok Brad
@
text
@$OpenBSD: patch-lib_relocatable_c,v 1.2 2008/05/28 20:03:13 naddy Exp $
--- lib/relocatable.c.orig	Thu Sep  1 18:08:15 2011
+++ lib/relocatable.c	Thu Sep  1 18:21:29 2011
@@@@ -446,16 +446,20 @@@@ relocate (const char *pathname)
   if (orig_prefix != NULL && curr_prefix != NULL
       && strncmp (pathname, orig_prefix, orig_prefix_len) == 0)
     {
+      char *result;
+      size_t len;
+
       if (pathname[orig_prefix_len] == '\0')
         {
           /* pathname equals orig_prefix.  */
-          char *result = (char *) xmalloc (strlen (curr_prefix) + 1);
+          len = strlen (curr_prefix) + 1;
+          result = (char *) xmalloc (len);
 
 #ifdef NO_XMALLOC
           if (result != NULL)
 #endif
             {
-              strcpy (result, curr_prefix);
+              strlcpy (result, curr_prefix, len);
               return result;
             }
         }
@@@@ -463,15 +467,16 @@@@ relocate (const char *pathname)
         {
           /* pathname starts with orig_prefix.  */
           const char *pathname_tail = &pathname[orig_prefix_len];
-          char *result =
-            (char *) xmalloc (curr_prefix_len + strlen (pathname_tail) + 1);
+          len = curr_prefix_len + strlen (pathname_tail) + 1;
+          result = (char *) xmalloc (len);
 
 #ifdef NO_XMALLOC
           if (result != NULL)
 #endif
             {
               memcpy (result, curr_prefix, curr_prefix_len);
-              strcpy (result + curr_prefix_len, pathname_tail);
+              result[curr_prefix_len] = '\0';
+              strlcat (result, pathname_tail, len);
               return result;
             }
         }
@


1.2
log
@overdue maintenance update to 1.12; ok brad@@
@
text
@d1 16
a16 14
$OpenBSD: patch-lib_relocatable_c,v 1.1 2007/08/25 13:51:08 naddy Exp $
--- lib/relocatable.c.orig	Tue Oct 31 14:48:27 2006
+++ lib/relocatable.c	Wed May 21 17:55:51 2008
@@@@ -448,15 +448,19 @@@@ relocate (const char *pathname)
 	{
 	  /* pathname starts with orig_prefix.  */
 	  const char *pathname_tail = &pathname[orig_prefix_len];
-	  char *result =
-	    (char *) xmalloc (curr_prefix_len + strlen (pathname_tail) + 1);
+	  size_t len;
+	  char *result;
+	  
+	  len = curr_prefix_len + strlen (pathname_tail) + 1;
+	  result = (char *) xmalloc (len);
d19 1
a19 1
 	  if (result != NULL)
d21 26
a46 8
 	    {
 	      memcpy (result, curr_prefix, curr_prefix_len);
-	      strcpy (result + curr_prefix_len, pathname_tail);
+	      result[curr_prefix_len] = '\0';
+	      strlcat (result, pathname_tail, len);
 	      return result;
 	    }
 	}
@


1.1
log
@strl* fixes corresponding to those in devel/gettext; ok brad
@
text
@d1 4
a4 4
$OpenBSD$
--- lib/relocatable.c.orig	Fri Aug  1 18:24:10 2003
+++ lib/relocatable.c	Wed Aug  1 19:31:16 2007
@@@@ -429,15 +429,19 @@@@ relocate (const char *pathname)
@

