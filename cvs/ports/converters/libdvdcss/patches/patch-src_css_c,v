head	1.5;
access;
symbols
	OPENBSD_6_2:1.5.0.10
	OPENBSD_6_2_BASE:1.5
	OPENBSD_6_1:1.5.0.8
	OPENBSD_6_1_BASE:1.5
	OPENBSD_6_0:1.5.0.6
	OPENBSD_6_0_BASE:1.5
	OPENBSD_5_9:1.5.0.2
	OPENBSD_5_9_BASE:1.5
	OPENBSD_5_8:1.5.0.4
	OPENBSD_5_8_BASE:1.5
	OPENBSD_5_7:1.4.0.2
	OPENBSD_5_7_BASE:1.4
	OPENBSD_5_6:1.3.0.6
	OPENBSD_5_6_BASE:1.3
	OPENBSD_5_5:1.3.0.4
	OPENBSD_5_5_BASE:1.3
	OPENBSD_5_4:1.3.0.2
	OPENBSD_5_4_BASE:1.3
	OPENBSD_5_3:1.2.0.4
	OPENBSD_5_3_BASE:1.2
	OPENBSD_5_2:1.2.0.2
	OPENBSD_5_2_BASE:1.2
	OPENBSD_5_1_BASE:1.1
	OPENBSD_5_1:1.1.0.2;
locks; strict;
comment	@# @;


1.5
date	2015.04.27.12.16.02;	author ajacoutot;	state Exp;
branches;
next	1.4;
commitid	PfcPNi6Nvg6oe5zr;

1.4
date	2014.11.29.07.38.18;	author brad;	state Exp;
branches;
next	1.3;
commitid	sCBU2ZBlW8fz9pOW;

1.3
date	2013.03.23.23.28.14;	author brad;	state Exp;
branches;
next	1.2;

1.2
date	2012.05.03.06.50.09;	author ajacoutot;	state Exp;
branches;
next	1.1;

1.1
date	2011.08.29.09.54.51;	author espie;	state Exp;
branches;
next	;


desc
@@


1.5
log
@Update to libdvdcss-1.3.99.
Tested with mplayer / mpv / ogle and xine-lib.

from brad
@
text
@$OpenBSD: patch-src_css_c,v 1.4 2014/11/29 07:38:18 brad Exp $
--- src/css.c.orig	Tue Jan 27 08:56:05 2015
+++ src/css.c	Tue Feb 10 14:33:01 2015
@@@@ -230,10 +230,13 @@@@ int dvdcss_title ( dvdcss_t dvdcss, int i_block )
         {
             char psz_key[PSZ_KEY_SIZE];
             unsigned int k0, k1, k2, k3, k4;
+            int n;
 
-            psz_key[PSZ_KEY_SIZE - 1] = '\0';
+            memset(psz_key, 0, sizeof psz_key);
+            n = read( i_fd, psz_key, PSZ_KEY_SIZE - 1 );
+            close( i_fd );
 
-            if( read( i_fd, psz_key, PSZ_KEY_SIZE - 1 ) == PSZ_KEY_SIZE - 1
+            if( n == PSZ_KEY_SIZE - 1
                  && sscanf( psz_key, "%x:%x:%x:%x:%x",
                             &k0, &k1, &k2, &k3, &k4 ) == 5 )
             {
@@@@ -247,9 +250,12 @@@@ int dvdcss_title ( dvdcss_t dvdcss, int i_block )
                 /* Don't try to save it again */
                 b_cache = 0;
                 i_ret = 1;
+            } 
+            else if (n > 0 && strcmp(psz_key, PACKAGE_VERSION "\n") == 0) 
+            {
+                /* didn't crack it, negative caching */
+                return -1;
             }
-
-            close( i_fd );
         }
     }
 
@@@@ -263,6 +269,15 @@@@ int dvdcss_title ( dvdcss_t dvdcss, int i_block )
         {
             print_error( dvdcss, "fatal error in Video Title Set (VTS) "
                                  "Content Scrambling System (CSS) key" );
+            i_fd = open( dvdcss->psz_cachefile, O_RDWR|O_CREAT, 0644 );
+            if( i_fd >= 0 )
+            {
+                char message[sizeof(PACKAGE_VERSION) + 3];
+
+                sprintf( message, "%s\n", PACKAGE_VERSION);
+                write( i_fd, message, strlen(message) );
+                close( i_fd );
+            }
             return i_ret;
         }
 
@


1.4
log
@Update to libdvdcss 1.3.0.
@
text
@d1 4
a4 4
$OpenBSD: patch-src_css_c,v 1.3 2013/03/23 23:28:14 brad Exp $
--- src/css.c.orig	Sun Mar 17 10:45:09 2013
+++ src/css.c	Wed Oct 22 20:09:31 2014
@@@@ -221,10 +221,13 @@@@ int _dvdcss_title ( dvdcss_t dvdcss, int i_block )
d20 1
a20 1
@@@@ -238,9 +241,12 @@@@ int _dvdcss_title ( dvdcss_t dvdcss, int i_block )
d35 1
a35 2
@@@@ -252,6 +258,15 @@@@ int _dvdcss_title ( dvdcss_t dvdcss, int i_block )
         if( i_ret < 0 )
d37 2
a38 1
             print_error( dvdcss, "fatal error in VTS CSS key" );
@


1.3
log
@Update to libdvdcss 1.2.13.

ok sthen@@
@
text
@d1 4
a4 4
$OpenBSD: patch-src_css_c,v 1.2 2012/05/03 06:50:09 ajacoutot Exp $
--- src/css.c.orig	Tue Feb 26 03:08:35 2013
+++ src/css.c	Sun Mar 10 22:29:29 2013
@@@@ -219,10 +219,13 @@@@ int _dvdcss_title ( dvdcss_t dvdcss, int i_block )
d6 1
a6 1
             char psz_key[KEY_SIZE * 3];
d10 1
a10 1
-            psz_key[KEY_SIZE * 3 - 1] = '\0';
d12 1
a12 1
+            n = read( i_fd, psz_key, KEY_SIZE * 3 - 1 );
d15 2
a16 2
-            if( read( i_fd, psz_key, KEY_SIZE * 3 - 1 ) == KEY_SIZE * 3 - 1
+            if( n == KEY_SIZE * 3 - 1
d20 1
a20 1
@@@@ -236,9 +239,12 @@@@ int _dvdcss_title ( dvdcss_t dvdcss, int i_block )
d35 1
a35 1
@@@@ -250,6 +256,15 @@@@ int _dvdcss_title ( dvdcss_t dvdcss, int i_block )
@


1.2
log
@Update to libdvdcss-1.2.12.

from Brad, ok sthen@@
@
text
@d1 4
a4 4
$OpenBSD: patch-src_css_c,v 1.1 2011/08/29 09:54:51 espie Exp $
--- src/css.c.orig	Mon Nov 14 05:00:53 2011
+++ src/css.c	Mon Dec 12 05:39:54 2011
@@@@ -218,10 +218,13 @@@@ int _dvdcss_title ( dvdcss_t dvdcss, int i_block )
d20 1
a20 1
@@@@ -235,9 +238,12 @@@@ int _dvdcss_title ( dvdcss_t dvdcss, int i_block )
d35 1
a35 1
@@@@ -249,6 +255,15 @@@@ int _dvdcss_title ( dvdcss_t dvdcss, int i_block )
d38 1
a38 1
             print_error( dvdcss, "fatal error in vts css key" );
@


1.1
log
@update to 1.2.10, add negative caching to keys
@
text
@d1 4
a4 4
$OpenBSD$
--- src/css.c.orig	Fri Aug 29 20:42:47 2008
+++ src/css.c	Sun Aug 28 15:26:39 2011
@@@@ -172,10 +172,13 @@@@ int _dvdcss_title ( dvdcss_t dvdcss, int i_block )
d20 1
a20 1
@@@@ -189,9 +192,12 @@@@ int _dvdcss_title ( dvdcss_t dvdcss, int i_block )
d35 1
a35 1
@@@@ -203,6 +209,15 @@@@ int _dvdcss_title ( dvdcss_t dvdcss, int i_block )
@

