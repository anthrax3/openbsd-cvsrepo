head	1.2;
access;
symbols
	OPENBSD_5_9:1.1.0.6
	OPENBSD_5_9_BASE:1.1
	OPENBSD_5_7:1.1.0.4
	OPENBSD_5_8:1.1.0.2;
locks; strict;
comment	@# @;


1.2
date	2016.03.14.19.46.12;	author ajacoutot;	state dead;
branches;
next	1.1;
commitid	ZypCecrzOxeE8g1E;

1.1
date	2015.09.16.09.18.13;	author ajacoutot;	state Exp;
branches
	1.1.2.1
	1.1.4.1;
next	;
commitid	PEOP5ubHLhtcX6y5;

1.1.2.1
date	2015.09.16.11.16.44;	author jasper;	state Exp;
branches;
next	;
commitid	CsrVZj67iJuahhlE;

1.1.4.1
date	2015.09.16.11.16.53;	author jasper;	state Exp;
branches;
next	;
commitid	vx84FGNAvSnETZKj;


desc
@@


1.2
log
@Major update to qemu-2.5.0.
Please direct any runtime fallout to Brad.

from Brad (maintainer)
@
text
@$OpenBSD: patch-include_hw_virtio_virtio-access_h,v 1.1 2015/09/16 09:18:13 ajacoutot Exp $

virtio-net: unbreak any layout

Commit 032a74a1c0fcdd5fd1c69e56126b4c857ee36611
("virtio-net: byteswap virtio-net header") breaks any layout by
requiring out_sg[0].iov_len >= n->guest_hdr_len. Fixing this by
copying header to temporary buffer if swap is needed, and then use
this buffer as part of out_sg.

Fixes 032a74a1c0fcdd5fd1c69e56126b4c857ee36611
("virtio-net: byteswap virtio-net header")

--- include/hw/virtio/virtio-access.h.orig	Wed Sep 16 03:17:28 2015
+++ include/hw/virtio/virtio-access.h	Wed Sep 16 03:18:03 2015
@@@@ -126,6 +126,15 @@@@ static inline uint64_t virtio_ldq_p(VirtIODevice *vdev
     }
 }
 
+static inline bool virtio_needs_swap(VirtIODevice *vdev)
+{
+#ifdef HOST_WORDS_BIGENDIAN
+    return virtio_access_is_big_endian(vdev) ? false : true;
+#else
+    return virtio_access_is_big_endian(vdev) ? true : false;
+#endif
+}
+
 static inline uint16_t virtio_tswap16(VirtIODevice *vdev, uint16_t s)
 {
 #ifdef HOST_WORDS_BIGENDIAN
@


1.1
log
@SECURITY: CVE-2015-5278, CVE-2015-5279, CVE-2015-6815
Some more fixes, mostly security related.

from Brad (maintainer)
@
text
@d1 1
a1 1
$OpenBSD$
@


1.1.4.1
log
@Security fixes for CVE-2015-5278, CVE-2015-5279, CVE-2015-6815,
as well as several other reliability fixes
@
text
@d1 1
a1 1
$OpenBSD: patch-include_hw_virtio_virtio-access_h,v 1.1 2015/09/16 09:18:13 ajacoutot Exp $
@


1.1.2.1
log
@Security fixes for CVE-2015-5278, CVE-2015-5279, CVE-2015-6815,
as well as several other reliability fixes
@
text
@d1 1
a1 1
$OpenBSD: patch-include_hw_virtio_virtio-access_h,v 1.1 2015/09/16 09:18:13 ajacoutot Exp $
@

