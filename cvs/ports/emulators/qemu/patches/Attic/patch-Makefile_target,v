head	1.13;
access;
symbols
	OPENBSD_4_7:1.12.0.8
	OPENBSD_4_7_BASE:1.12
	OPENBSD_4_6:1.12.0.6
	OPENBSD_4_6_BASE:1.12
	OPENBSD_4_5:1.12.0.4
	OPENBSD_4_5_BASE:1.12
	OPENBSD_4_4:1.12.0.2
	OPENBSD_4_4_BASE:1.12
	OPENBSD_4_3:1.11.0.4
	OPENBSD_4_3_BASE:1.11
	OPENBSD_4_2:1.11.0.2
	OPENBSD_4_2_BASE:1.11
	OPENBSD_4_1:1.10.0.2
	OPENBSD_4_1_BASE:1.10
	OPENBSD_4_0:1.9.0.2
	OPENBSD_4_0_BASE:1.9
	OPENBSD_3_9:1.7.0.2
	OPENBSD_3_9_BASE:1.7
	OPENBSD_3_8:1.2.0.2
	OPENBSD_3_8_BASE:1.2
	OPENBSD_3_7:1.1.1.1.0.2
	OPENBSD_3_7_BASE:1.1.1.1
	todd_20050307:1.1.1.1
	todd:1.1.1;
locks; strict;
comment	@# @;


1.13
date	2010.05.27.17.55.05;	author fgsch;	state dead;
branches;
next	1.12;

1.12
date	2008.04.28.22.52.38;	author todd;	state Exp;
branches;
next	1.11;

1.11
date	2007.05.01.12.55.14;	author todd;	state Exp;
branches;
next	1.10;

1.10
date	2006.12.22.17.31.45;	author todd;	state Exp;
branches;
next	1.9;

1.9
date	2006.06.08.14.33.38;	author todd;	state Exp;
branches;
next	1.8;

1.8
date	2006.04.10.21.10.05;	author todd;	state Exp;
branches;
next	1.7;

1.7
date	2006.02.16.16.27.44;	author todd;	state Exp;
branches;
next	1.6;

1.6
date	2005.12.27.07.56.15;	author todd;	state Exp;
branches;
next	1.5;

1.5
date	2005.11.03.18.41.55;	author fgsch;	state Exp;
branches;
next	1.4;

1.4
date	2005.10.25.03.25.44;	author todd;	state Exp;
branches;
next	1.3;

1.3
date	2005.09.26.20.47.56;	author todd;	state Exp;
branches;
next	1.2;

1.2
date	2005.08.11.01.15.17;	author todd;	state Exp;
branches;
next	1.1;

1.1
date	2005.03.07.16.41.28;	author todd;	state Exp;
branches
	1.1.1.1;
next	;

1.1.1.1
date	2005.03.07.16.41.28;	author todd;	state Exp;
branches;
next	;


desc
@@


1.13
log
@Update to qemu 0.12.3. Work in progress so not linked to the tree yet.
@
text
@$OpenBSD: patch-Makefile_target,v 1.12 2008/04/28 22:52:38 todd Exp $
--- Makefile.target.orig	Sun Jan  6 14:38:41 2008
+++ Makefile.target	Wed Apr  9 23:28:03 2008
@@@@ -136,11 +136,11 @@@@ endif
 endif
 endif
 
-ifeq ($(ARCH),x86_64)
-  ifneq ($(CONFIG_SOLARIS),yes)
-    BASE_LDFLAGS+=-Wl,-T,$(SRC_PATH)/$(ARCH).ld
-  endif
-endif
+#ifeq ($(ARCH),x86_64)
+#  ifneq ($(CONFIG_SOLARIS),yes)
+#    BASE_LDFLAGS+=-Wl,-T,$(SRC_PATH)/$(ARCH).ld
+#  endif
+#endif
 
 ifeq ($(ARCH),ppc)
 CPPFLAGS+= -D__powerpc__
@@@@ -188,7 +188,7 @@@@ BASE_LDFLAGS+=-Wl,-G0 -Wl,-T,$(SRC_PATH)/$(ARCH).ld
 endif
 
 ifeq ($(ARCH),arm)
-OP_CFLAGS+=-mno-sched-prolog -fno-omit-frame-pointer
+OP_CFLAGS+=-mno-sched-prolog -fno-omit-frame-pointer -mapcs-frame
 BASE_LDFLAGS+=-Wl,-T,$(SRC_PATH)/$(ARCH).ld
 endif
 
@@@@ -215,6 +215,16 @@@@ BASE_LDFLAGS+=-Wl,-T,$(SRC_PATH)/$(ARCH)el.ld
 endif
 endif
 
+# Very important for this 'ifeq' block to be after other
+# OP_CFLAGS= .. constructs above
+ifeq ($(shell uname -s),OpenBSD)
+OP_CFLAGS+= -fno-stack-protector
+endif
+
+ifdef CONFIG_OSS_LIBRARY
+LIBS+=-lossaudio
+endif
+
 ifeq ($(CONFIG_DARWIN),yes)
 LIBS+=-lmx
 endif
@@@@ -232,6 +242,7 @@@@ OP_LDFLAGS+=$(OS_LDFLAGS) $(ARCH_LDFLAGS)
 #########################################################
 
 CPPFLAGS+=-D_GNU_SOURCE -D_FILE_OFFSET_BITS=64 -D_LARGEFILE_SOURCE
+#CPPFLAGS+= -DDEBUG_GDB -DDEBUG -DDEBUG_KBD -DDEBUG_MOUSE
 LIBS+=-lm
 ifndef CONFIG_USER_ONLY
 LIBS+=-lz
@@@@ -537,7 +548,7 @@@@ endif
 ifndef CONFIG_DARWIN
 ifndef CONFIG_WIN32
 ifndef CONFIG_SOLARIS
-VL_LIBS+=-lutil
+#VL_LIBS+=-lutil
 endif
 endif
 endif
@@@@ -557,12 +568,12 @@@@ ifeq ($(ARCH),sparc64)
   endif
 endif
 
-ifeq ($(ARCH),x86_64)
-  VL_LDFLAGS+=-m64
-  ifneq ($(CONFIG_SOLARIS),yes)
-    VL_LDFLAGS+=-Wl,-T,$(SRC_PATH)/$(ARCH).ld
-  endif
-endif
+#ifeq ($(ARCH),x86_64)
+#  VL_LDFLAGS+=-m64
+#  ifneq ($(CONFIG_SOLARIS),yes)
+#    VL_LDFLAGS+=-Wl,-T,$(SRC_PATH)/$(ARCH).ld
+#  endif
+#endif
 
 ifdef CONFIG_WIN32
 SDL_LIBS := $(filter-out -mwindows, $(SDL_LIBS)) -mconsole
@


1.12
log
@o update to 0.9.1, lots from brad@@
o see http://qemu.org/changelog.html for details
o see README.OpenBSD for an intro to qemu on OpenBSD
o disable broken arm host support for now
@
text
@d1 1
a1 1
$OpenBSD: patch-Makefile_target,v 1.11 2007/05/01 12:55:14 todd Exp $
@


1.11
log
@update to 0.9.0, thanks to all who gave feedback
see http://qemu.org/changelog.html for details
new in OpenBSD, support for raw block devices
@
text
@d1 21
a21 4
$OpenBSD$
--- Makefile.target.orig	Mon Feb  5 17:01:54 2007
+++ Makefile.target	Tue Apr  3 08:21:24 2007
@@@@ -150,7 +150,7 @@@@ BASE_LDFLAGS+=-Wl,-G0 -Wl,-T,$(SRC_PATH)/$(ARCH).ld
d30 2
a31 2
@@@@ -163,6 +163,12 @@@@ ifeq ($(ARCH),mips)
 BASE_LDFLAGS+=-Wl,-T,$(SRC_PATH)/$(ARCH).ld
d40 8
a47 4
 ifeq ($(HAVE_GCC3_OPTIONS),yes)
 # very important to generate a return at the end of every operation
 OP_CFLAGS+=-fno-reorder-blocks -fno-optimize-sibling-calls
@@@@ -182,6 +188,7 @@@@ OP_CFLAGS+=$(OS_CFLAGS)
d55 1
a55 11
@@@@ -329,6 +336,9 @@@@ endif
 
 SOUND_HW = sb16.o es1370.o
 AUDIODRV = audio.o noaudio.o wavaudio.o
+ifdef CONFIG_OSS_LIBRARY
+LIBS += -lossaudio
+endif
 ifdef CONFIG_SDL
 AUDIODRV += sdlaudio.o
 endif
@@@@ -440,7 +450,7 @@@@ endif
d59 3
a61 2
-VL_LIBS=-lutil -lrt
+#VL_LIBS=-lutil -lrt
d64 2
d67 16
@


1.10
log
@update qemu to 0.8.2, from brad@@

See http://fabrice.bellard.free.fr/qemu/changelog.html for details.
@
text
@d1 4
a4 15
$OpenBSD: patch-Makefile_target,v 1.9 2006/06/08 14:33:38 todd Exp $
--- Makefile.target.orig	Sat Jul 22 13:23:34 2006
+++ Makefile.target	Mon Dec 18 17:16:21 2006
@@@@ -17,8 +17,9 @@@@ ifdef CONFIG_USER_ONLY
 VPATH+=:$(SRC_PATH)/linux-user
 DEFINES+=-I$(SRC_PATH)/linux-user -I$(SRC_PATH)/linux-user/$(TARGET_ARCH)
 endif
-CFLAGS=-Wall -O2 -g -fno-strict-aliasing
+#CFLAGS=-Wall -O2 -g -fno-strict-aliasing
 #CFLAGS+=-Werror
+CFLAGS+= -ggdb
 LDFLAGS=-g
 LIBS=
 HELPER_CFLAGS=$(CFLAGS)
@@@@ -144,7 +145,7 @@@@ LDFLAGS+=-Wl,-G0 -Wl,-T,$(SRC_PATH)/ia64
d8 3
a10 3
-OP_CFLAGS=$(CFLAGS) -mno-sched-prolog -fno-omit-frame-pointer
+OP_CFLAGS=$(CFLAGS) -mno-sched-prolog -fno-omit-frame-pointer -mapcs-frame
 LDFLAGS+=-Wl,-T,$(SRC_PATH)/arm.ld
d13 2
a14 2
@@@@ -153,6 +154,12 @@@@ OP_CFLAGS=$(CFLAGS) -fomit-frame-pointer
 LDFLAGS+=-Wl,-T,m68k.ld
d26 1
a26 1
@@@@ -166,6 +173,7 @@@@ endif
d29 2
a30 2
 DEFINES+=-D_GNU_SOURCE -D_FILE_OFFSET_BITS=64 -D_LARGEFILE_SOURCE
+DEFINES+= #-DDEBUG_GDB -DDEBUG -DDEBUG_KBD -DDEBUG_MOUSE
d34 1
a34 1
@@@@ -297,6 +305,9 @@@@ endif
d44 1
a44 1
@@@@ -403,7 +414,7 @@@@ endif
@


1.9
log
@update to 0.8.1, see http://qemu.org/changelog.html for details
@
text
@d1 3
a3 3
$OpenBSD: patch-Makefile_target,v 1.8 2006/04/10 21:10:05 todd Exp $
--- Makefile.target.orig	Wed May  3 15:32:58 2006
+++ Makefile.target	Thu May 11 20:49:55 2006
d15 1
a15 1
@@@@ -132,7 +133,7 @@@@ LDFLAGS+=-Wl,-G0 -Wl,-T,$(SRC_PATH)/ia64
d24 1
a24 1
@@@@ -141,6 +142,12 @@@@ OP_CFLAGS=$(CFLAGS) -fomit-frame-pointer
d37 1
a37 1
@@@@ -154,6 +161,7 @@@@ endif
d45 1
a45 1
@@@@ -280,6 +288,9 @@@@ endif
d55 7
a61 7
@@@@ -316,7 +327,7 @@@@ ifeq ($(TARGET_BASE_ARCH), i386)
 # Hardware support
 VL_OBJS+= ide.o pckbd.o ps2.o vga.o $(SOUND_HW) dma.o $(AUDIODRV)
 VL_OBJS+= fdc.o mc146818rtc.o serial.o i8259.o i8254.o pcspk.o pc.o
-VL_OBJS+= cirrus_vga.o mixeng.o apic.o parallel.o
+VL_OBJS+= cirrus_vga.o mixeng.o apic.o parallel.o pcnet.o
 DEFINES += -DHAS_AUDIO
a62 7
 ifeq ($(TARGET_BASE_ARCH), ppc)
@@@@ -492,7 +503,7 @@@@ clean:
 
 install: all 
 ifneq ($(PROGS),)
-	$(INSTALL) -m 755 -s $(PROGS) "$(DESTDIR)$(bindir)"
+	$(INSTALL) -m 755 -s $(PROGS) "${PREFIX}/bin/"
a63 2
 
 ifneq ($(wildcard .depend),)
@


1.8
log
@fixes from various
o permit auto tun# allocation
o do not destroy trunk# to permit multiple qemu sessions to use the same trunk#
  in the sample qemu-ifup script
o fix building on zaurus
o detect case where no tun# is available, Nicholas Marriott
o bump pkgname
@
text
@d1 3
a3 3
$OpenBSD: patch-Makefile_target,v 1.7 2006/02/16 16:27:44 todd Exp $
--- Makefile.target.orig	Mon Dec 19 16:51:53 2005
+++ Makefile.target	Mon Feb 20 21:21:20 2006
d15 1
a15 1
@@@@ -137,7 +138,7 @@@@ LDFLAGS+=-Wl,-G0 -Wl,-T,$(SRC_PATH)/ia64
d24 1
a24 1
@@@@ -146,6 +147,12 @@@@ OP_CFLAGS=$(CFLAGS) -fomit-frame-pointer
d37 1
a37 1
@@@@ -159,6 +166,7 @@@@ endif
d45 1
a45 1
@@@@ -275,6 +283,9 @@@@ VL_OBJS+=block-cow.o block-qcow.o aes.o 
d55 1
a55 1
@@@@ -308,7 +319,7 @@@@ ifeq ($(TARGET_BASE_ARCH), i386)
d57 2
a58 2
 VL_OBJS+= ide.o ne2000.o pckbd.o ps2.o vga.o $(SOUND_HW) dma.o $(AUDIODRV)
 VL_OBJS+= fdc.o mc146818rtc.o serial.o i8259.o i8254.o pc.o
d64 1
a64 1
@@@@ -462,7 +473,7 @@@@ clean:
d68 2
a69 2
-	install -m 755 -s $(PROGS) "$(bindir)"
+	install -m 755 -s $(PROGS) "$(PREFIX)/bin/"
@


1.7
log
@from Andrew Dalgleish openbsd at ajd dot net dot au
o sample qemu-ifup
o permit -net tap,ifname=/dev/tun1 to actually use tun1
from Reyk Floeter reyk at openbsd dot org
o re-enable pcnet

bump PKGNAME
@
text
@d1 1
a1 1
$OpenBSD: patch-Makefile_target,v 1.6 2005/12/27 07:56:15 todd Exp $
d3 2
a4 2
+++ Makefile.target	Tue Feb 14 15:04:27 2006
@@@@ -17,7 +17,7 @@@@ ifdef CONFIG_USER_ONLY
d11 1
d14 2
a15 1
@@@@ -137,7 +137,7 @@@@ LDFLAGS+=-Wl,-G0 -Wl,-T,$(SRC_PATH)/ia64
d24 1
a24 1
@@@@ -146,6 +146,12 @@@@ OP_CFLAGS=$(CFLAGS) -fomit-frame-pointer
d37 1
a37 1
@@@@ -159,6 +165,7 @@@@ endif
d45 1
a45 1
@@@@ -275,6 +282,9 @@@@ VL_OBJS+=block-cow.o block-qcow.o aes.o 
d55 1
a55 1
@@@@ -308,7 +318,7 @@@@ ifeq ($(TARGET_BASE_ARCH), i386)
d64 1
a64 1
@@@@ -462,7 +472,7 @@@@ clean:
@


1.6
log
@update to 0.8.0, see qemu.org for full ChangeLog
for OpenBSD, amd64 simulation on i386 appars to work ok now
@
text
@d1 1
a1 1
$OpenBSD: patch-Makefile_target,v 1.5 2005/11/03 18:41:55 fgsch Exp $
d3 1
a3 1
+++ Makefile.target	Tue Dec 20 11:18:25 2005
d35 1
a35 1
@@@@ -159,6 +165,8 @@@@ endif
a38 1
+
d43 1
a43 1
@@@@ -275,6 +283,9 @@@@ VL_OBJS+=block-cow.o block-qcow.o aes.o 
d53 10
a62 1
@@@@ -462,7 +473,7 @@@@ clean:
@


1.5
log
@workaround to make qemu happy on amd64 until a better and more correct
fix is applied.
sturm@@ ok, maintainer ok a previous more generic approach.
@
text
@d1 3
a3 3
$OpenBSD: patch-Makefile_target,v 1.4 2005/10/25 03:25:44 todd Exp $
--- Makefile.target.orig	Sun Sep  4 14:11:31 2005
+++ Makefile.target	Tue Oct 25 02:44:17 2005
d13 10
a22 1
@@@@ -138,6 +138,12 @@@@ OP_CFLAGS=$(CFLAGS) -fomit-frame-pointer
d35 1
a35 1
@@@@ -151,6 +157,8 @@@@ endif
d44 4
a47 4
@@@@ -269,7 +277,10 @@@@ AUDIODRV += sdlaudio.o
 endif
 ifdef CONFIG_OSS
 AUDIODRV += ossaudio.o
a49 1
 endif
d51 2
a52 8
 
 pc.o: DEFINES := -DUSE_SB16 $(DEFINES)
 
@@@@ -288,6 +299,7 @@@@ ifeq ($(TARGET_BASE_ARCH), i386)
 VL_OBJS+= ide.o ne2000.o pckbd.o vga.o $(SOUND_HW) dma.o $(AUDIODRV)
 VL_OBJS+= fdc.o mc146818rtc.o serial.o i8259.o i8254.o pc.o
 VL_OBJS+= cirrus_vga.o mixeng.o apic.o parallel.o
+VL_OBJS+= pcnet.o
d54 1
a54 3
 ifeq ($(TARGET_BASE_ARCH), ppc)
 VL_OBJS+= ppc.o ide.o ne2000.o pckbd.o vga.o $(SOUND_HW) dma.o $(AUDIODRV)
@@@@ -427,7 +439,7 @@@@ clean:
@


1.4
log
@update to qemu 0.7.2
@
text
@d1 3
a3 3
$OpenBSD: patch-Makefile_target,v 1.3 2005/09/26 20:47:56 todd Exp $
--- Makefile.target.orig	Sun Sep  4 12:11:31 2005
+++ Makefile.target	Mon Oct 24 21:59:30 2005
a12 18
@@@@ -61,7 +61,7 @@@@ ifeq ($(ARCH),i386)
 CFLAGS+=-fomit-frame-pointer
 OP_CFLAGS=$(CFLAGS) -mpreferred-stack-boundary=2
 ifeq ($(HAVE_GCC3_OPTIONS),yes)
-OP_CFLAGS+= -falign-functions=0 -fno-gcse
+OP_CFLAGS+= -falign-functions=0 -fno-gcse -mfpmath=387
 else
 OP_CFLAGS+= -malign-functions=0
 endif
@@@@ -83,7 +83,7 @@@@ endif
 endif
 
 ifeq ($(ARCH),x86_64)
-OP_CFLAGS=$(CFLAGS) -falign-functions=0
+OP_CFLAGS=$(CFLAGS) -falign-functions=0 -mfpmath=387
 LDFLAGS+=-Wl,-T,$(SRC_PATH)/x86_64.ld
 endif
 
@


1.3
log
@o add patch to permit osx x86 guest to run
o fix Makefile.target to add -fno-stack-protector for op.o for all archs,
  noted, debugged, and tested by Antoine Jacoutot on macppc, thanks!
o bump PKGNAME
@
text
@d1 3
a3 3
$OpenBSD: patch-Makefile_target,v 1.2 2005/08/11 01:15:17 todd Exp $
--- Makefile.target.orig	Sun Jul 24 13:52:08 2005
+++ Makefile.target	Mon Sep 26 13:06:13 2005
d13 18
@


1.2
log
@update to 0.7.1 (http://qemu.org/changelog.html)
add pcnet nic support
@
text
@d1 1
a1 1
$OpenBSD: patch-Makefile_target,v 1.1.1.1 2005/03/07 16:41:28 todd Exp $
d3 1
a3 1
+++ Makefile.target	Wed Aug 10 16:00:09 2005
d13 2
a14 2
@@@@ -66,6 +66,10 @@@@ else
 OP_CFLAGS+= -malign-functions=0
d17 2
d23 4
a26 4
 ifdef TARGET_GPROF
 USE_I386_LD=y
 endif
@@@@ -151,6 +155,8 @@@@ endif
d35 1
a35 1
@@@@ -269,7 +275,10 @@@@ AUDIODRV += sdlaudio.o
d46 1
a46 1
@@@@ -288,6 +297,7 @@@@ ifeq ($(TARGET_BASE_ARCH), i386)
d54 1
a54 1
@@@@ -427,7 +437,7 @@@@ clean:
@


1.1
log
@Initial revision
@
text
@d1 4
a4 4
$OpenBSD$
--- Makefile.target.orig	Tue Feb 22 13:27:14 2005
+++ Makefile.target	Tue Mar  1 17:22:05 2005
@@@@ -14,7 +14,7 @@@@ ifdef CONFIG_USER_ONLY
d13 1
a13 1
@@@@ -127,6 +127,11 @@@@ else
a20 1
+
d24 10
a33 1
@@@@ -312,7 +317,10 @@@@ AUDIODRV += sdlaudio.o
d44 9
a52 10
@@@@ -404,7 +412,7 @@@@ gen-op.h: op.o $(DYNGEN)
 	$(DYNGEN) -g -o $@@ $<
 
 op.o: op.c
-	$(CC) $(OP_CFLAGS) $(DEFINES) -c -o $@@ $<
+	$(CC) $(OP_CFLAGS) $(DEFINES) -fno-stack-protector -c -o $@@ $<
 
 helper.o: helper.c
 	$(CC) $(HELPER_CFLAGS) $(DEFINES) -c -o $@@ $<
@@@@ -439,7 +447,7 @@@@ clean:
d57 1
a57 1
+	install -m 755 -s $(PROGS) $(PREFIX)/bin/
@


1.1.1.1
log
@Import qemu snapshot from 2005-02-27

QEMU is a generic and open source processor emulator 
which achieves a good emulation speed by using dynamic translation.

QEMU has two operating modes:

* Full system emulation. In this mode, QEMU emulates 
a full system (for example a PC), including a processor and 
various peripherials. It can be used to launch different
Operating Systems without rebooting the PC or to debug system code.

* User mode emulation (Linux host only). In this mode, 

.. many thanks for feedback from many people, and for Lars Hansson and 
   Michael Schmidt for posting early work on the port of qemu to ports@@

For now, only for macppc and i386, as these are currently the only archs
that have reported success building qemu.
QEMU can launch Linux processes compiled for one CPU on another CPU. 
@
text
@@
