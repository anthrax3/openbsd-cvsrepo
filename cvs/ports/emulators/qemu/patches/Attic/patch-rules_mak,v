head	1.4;
access;
symbols
	OPENBSD_5_3:1.3.0.2
	OPENBSD_5_3_BASE:1.3
	OPENBSD_4_8:1.1.0.2
	OPENBSD_4_8_BASE:1.1;
locks; strict;
comment	@# @;


1.4
date	2013.03.20.00.46.01;	author brad;	state dead;
branches;
next	1.3;

1.3
date	2013.02.02.23.51.45;	author brad;	state Exp;
branches;
next	1.2;

1.2
date	2010.11.22.11.32.01;	author fgsch;	state dead;
branches;
next	1.1;

1.1
date	2010.05.27.17.55.05;	author fgsch;	state Exp;
branches;
next	;


desc
@@


1.4
log
@Upgrade to QEMU 1.4.0. Enable the VNC TLS support.

Tested by todd@@ kirby@@ sthen@@ and OK kirby@@ sthen@@
@
text
@$OpenBSD: patch-rules_mak,v 1.3 2013/02/02 23:51:45 brad Exp $

Build option ROM .S files with separate preprocessor and
assembler steps because the C compiler could be unsuitable.

--- rules.mak.orig	Sat Feb  2 12:44:07 2013
+++ rules.mak	Sat Feb  2 12:44:47 2013
@@@@ -25,8 +25,11 @@@@ else
 	$(call quiet-command,$(LIBTOOL) --mode=compile --quiet --tag=CC $(CC) $(QEMU_INCLUDES) $(QEMU_CFLAGS) $(QEMU_DGFLAGS) $(CFLAGS) -c -o $@@ $<,"  lt CC $@@")
 endif
 
-%.o: %.S
-	$(call quiet-command,$(CC) $(QEMU_INCLUDES) $(QEMU_CFLAGS) $(QEMU_DGFLAGS) $(CFLAGS) -c -o $@@ $<,"  AS    $(TARGET_DIR)$@@")
+%.asm: %.S
+	$(call quiet-command,$(CPP) $(QEMU_INCLUDES) $(QEMU_CFLAGS) $(QEMU_DGFLAGS) $(CFLAGS) -o $@@ $<,"  CPP   $(TARGET_DIR)$@@")
+
+%.o: %.asm
+	$(call quiet-command,$(AS) $(ASFLAGS) -o $@@ $<,"  AS    $(TARGET_DIR)$@@")
 
 %.o: %.m
 	$(call quiet-command,$(OBJCC) $(QEMU_INCLUDES) $(QEMU_CFLAGS) $(QEMU_DGFLAGS) $(CFLAGS) -c -o $@@ $<,"  OBJC  $(TARGET_DIR)$@@")
@


1.3
log
@- Build option ROM .S files with separate preprocessor and
  assembler steps because the C compiler could be unsuitable.
- When the pxa2xx performance counter related cp14 registers were converted
  from a switch-statement implementation to the new table driven cpregs
  format in commit dc2a9045c, the crn and crm values for all these
  registers were accidentally transposed. Fixes being able to boot
  OpenBSD/zaurus.

ok sthen@@
@
text
@d1 1
a1 1
$OpenBSD$
@


1.2
log
@Update to qemu 0.13.0. fmt README and sync with reality.
with input and ok sthen@@
@
text
@d1 10
a10 6
$OpenBSD: patch-rules_mak,v 1.1 2010/05/27 17:55:05 fgsch Exp $
--- rules.mak.orig	Mon Mar  8 22:53:58 2010
+++ rules.mak	Mon Mar  8 22:54:18 2010
@@@@ -31,7 +31,7 @@@@ LINK = $(call quiet-command,$(CC) $(QEMU_CFLAGS) $(CFL
 %.a:
 	$(call quiet-command,rm -f $@@ && $(AR) rcs $@@ $^,"  AR    $(TARGET_DIR)$@@")
d12 7
a18 2
-quiet-command = $(if $(V),$1,$(if $(2),@@echo $2 && $1, @@$1))
+quiet-command = $1
d20 2
a21 2
 # cc-option
 # Usage: CFLAGS+=$(call cc-option, -falign-functions=0, -malign-functions=0)
@


1.1
log
@Update to qemu 0.12.3. Work in progress so not linked to the tree yet.
@
text
@d1 1
a1 1
$OpenBSD$
@

