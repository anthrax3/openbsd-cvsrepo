head	1.2;
access;
symbols
	robert_20170913:1.1.1.1 robert:1.1.1;
locks; strict;
comment	@# @;


1.2
date	2017.09.15.13.20.35;	author robert;	state Exp;
branches;
next	1.1;
commitid	ov9plJzyu6NUqr81;

1.1
date	2017.09.13.10.38.42;	author robert;	state Exp;
branches
	1.1.1.1;
next	;
commitid	EUPcYe0im3Fq9qvW;

1.1.1.1
date	2017.09.13.10.38.42;	author robert;	state Exp;
branches;
next	;
commitid	EUPcYe0im3Fq9qvW;


desc
@@


1.2
log
@update to 3.4.0.849 and enable more plugins like the spellchecker
@
text
@# $OpenBSD: Makefile,v 1.1.1.1 2017/09/13 10:38:42 robert Exp $

COMMENT=	next generation web interface for Kopano

WAPP_VERSION=	3.4.0

PLUGINS_WITH_DEFCONF= \
		contactfax-${WAPP_VERSION}.${MINOR}-${RPMVER} \
		desktopnotifications-2.0.0.7-6.4 \
		filepreviewer-2.0.0.13-8.1 \
		gmaps-${WAPP_VERSION}.${MINOR}-${RPMVER} \
		intranet-0.1-24.1 \
		pimfolder-${WAPP_VERSION}.${MINOR}-${RPMVER} \
		titlecounter-${WAPP_VERSION}.${MINOR}-${RPMVER}
		

PLUGINS=	${PLUGINS_WITH_DEFCONF} \
		folderwidgets-${WAPP_VERSION}.${MINOR}-${RPMVER} \
		quickitems-${WAPP_VERSION}.${MINOR}-${RPMVER}

MINOR=		849
RPMVER=		563.1
PKGNAME=	kopano-webapp-${WAPP_VERSION}.${MINOR}

EXTRACT_SUFX=	# empty

.for _dfile in ${PLUGINS}
EDISTFILES+=    kopano-webapp-plugin-${_dfile}.noarch.rpm
.endfor
EDISTFILES+=    kopano-webapp-lang-${WAPP_VERSION}.${MINOR}-${RPMVER}.noarch.rpm
EXTRACT_ONLY=   ${EDISTFILES:C/:[0-9]$//}

DISTFILES+=	kopano-webapp-${WAPP_VERSION}.${MINOR}-${RPMVER}.noarch.rpm \
		kopano-webapp-plugin-spell-2.0.0.2-5.1.noarch.rpm \
		kopano-webapp-plugin-spell-de-at-2.0.0.0-2.4.noarch.rpm \
		kopano-webapp-plugin-spell-de-ch-2.0.0.0-2.4.noarch.rpm \
		kopano-webapp-plugin-spell-de-de-2.0.0.0-2.4.noarch.rpm \
		kopano-webapp-plugin-spell-en-gb-2.0.0.0-2.4.noarch.rpm \
		kopano-webapp-plugin-spell-en-us-2.0.0.0-2.4.noarch.rpm \
		kopano-webapp-plugin-spell-es-es-2.0.0.0-2.4.noarch.rpm \
		kopano-webapp-plugin-spell-fr-fr-2.0.0.0-2.4.noarch.rpm \
		kopano-webapp-plugin-spell-it-1.0.0-15.4.noarch.rpm \
		kopano-webapp-plugin-spell-nl-2.0.0.0-2.4.noarch.rpm \
		kopano-webapp-plugin-spell-pl-pl-2.0.0.0-7.4.noarch.rpm \
		${EDISTFILES}

MASTER_SITES=	http://nerd.hu/distfiles/kopano-webapp/

CATEGORIES=	mail www

MODULES=	lang/php

MODPHP_BUILDDEP=No
MODPHP_RUNDEP=	No

BUILD_DEPENDS=	converters/rpm2cpio
RUN_DEPENDS=	mail/kopano/core,-mapi # php-mapi

NO_BUILD=	Yes
NO_TEST=	Yes
PKG_ARCH=	*

WRKDIST=	${WRKDIR}
PREFIX=		${VARBASE}/www
INSTDIR=	${PREFIX}/kopano-webapp
TINSTDIR=	${TRUEPREFIX}/kopano-webapp

SUBST_VARS=	INSTDIR TINSTDIR

do-extract:
.for _dfile in ${DISTFILES}
	cd ${WRKDIR} && \
		${LOCALBASE}/bin/rpm2cpio ${FULLDISTDIR}/${_dfile} | cpio -id
.endfor

pre-configure:
	${SUBST_CMD} ${WRKSRC}/etc/kopano/webapp/config.php

do-install:
	cp -Rp ${WRKSRC}/usr/share/kopano-webapp ${PREFIX}
	rm ${INSTDIR}/config.php
	${SUBST_CMD} -m 0644 -c ${FILESDIR}/kopano-webapp.conf \
		${INSTDIR}/kopano-webapp.conf.dist
	cat ${WRKSRC}/etc/kopano/webapp/config.php > \
		${INSTDIR}/config.php.dist

	rm ${INSTDIR}/plugins/spellchecker/config.php
	cat ${WRKSRC}/etc/kopano/webapp/config-spellchecker.php > \
		${INSTDIR}/plugins/spellchecker/config.php.dist

.for _c in ${PLUGINS_WITH_DEFCONF:C/-.*//}
	rm ${INSTDIR}/plugins/${_c}/config.php
	cat ${WRKSRC}/etc/kopano/webapp/config-${_c}.php > \
		${INSTDIR}/plugins/${_c}/config.php.dist
.endfor

	chown -R ${SHAREOWN}:${SHAREGRP} ${INSTDIR}

.include <bsd.port.mk>
@


1.1
log
@Initial revision
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.23 2016/08/12 08:09:34 robert Exp $
d8 8
a15 3
		contactfax \
		gmaps \
		pimfolder
d18 2
a19 2
		folderwidgets \
		quickitems
d21 3
a23 3
MINOR=		836
RPMVER=		550.1
PKGNAME=	kopano-webapp-${WAPP_VERSION}
d28 1
a28 1
EDISTFILES+=    kopano-webapp-plugin-${_dfile}-${WAPP_VERSION}.${MINOR}-${RPMVER}.noarch.rpm
d34 11
d87 5
a91 1
.for _c in ${PLUGINS_WITH_DEFCONF}
@


1.1.1.1
log
@import of kopano-{core,mapi,webapp}-8.3.5.1335

Kopano is a replacement of the deprecated Zarafa (ZCP) suite.

Joint work with pirofti@@

For upgrading please refer to the README.

ok ajacoutot@@
@
text
@@
