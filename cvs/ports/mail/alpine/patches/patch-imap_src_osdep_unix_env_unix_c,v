head	1.3;
access;
symbols
	OPENBSD_6_0:1.3.0.2
	OPENBSD_6_0_BASE:1.3
	OPENBSD_5_9:1.2.0.4
	OPENBSD_5_9_BASE:1.2
	OPENBSD_5_8:1.2.0.6
	OPENBSD_5_8_BASE:1.2
	OPENBSD_5_7:1.2.0.2
	OPENBSD_5_7_BASE:1.2
	OPENBSD_5_6:1.1.0.4
	OPENBSD_5_6_BASE:1.1
	OPENBSD_5_5:1.1.0.2
	OPENBSD_5_5_BASE:1.1;
locks; strict;
comment	@# @;


1.3
date	2016.07.10.11.55.21;	author ajacoutot;	state Exp;
branches;
next	1.2;
commitid	z5d1nBYCZyNp45NM;

1.2
date	2015.01.27.13.38.05;	author ajacoutot;	state Exp;
branches;
next	1.1;
commitid	k1CfpROGwOFCH9yP;

1.1
date	2013.10.17.09.08.08;	author ajacoutot;	state Exp;
branches;
next	;


desc
@@


1.3
log
@Fix imap authentication.

from Anthony La Porte
@
text
@$OpenBSD: patch-imap_src_osdep_unix_env_unix_c,v 1.2 2015/01/27 13:38:05 ajacoutot Exp $
--- imap/src/osdep/unix/env_unix.c.orig	Mon Jan 12 05:12:25 2015
+++ imap/src/osdep/unix/env_unix.c	Sun Jul 10 11:38:07 2016
@@@@ -644,11 +644,11 @@@@ long server_input_wait (long seconds)
 static struct passwd *pwuser (unsigned char *user)
 {
   unsigned char *s;
-  struct passwd *pw = getpwnam (user);
+  struct passwd *pw = getpwnam_shadow (user);
   if (!pw) {			/* failed, see if any uppercase characters */
     for (s = user; *s && ((*s < 'A') || (*s > 'Z')); s++);
     if (*s) {			/* yes, try all lowercase form */
-      pw = getpwnam (s = lcase (cpystr (user)));
+      pw = getpwnam_shadow (s = lcase (cpystr (user)));
       fs_give ((void **) &s);
     }
   }
@@@@ -967,15 +967,12 @@@@ char *myhomedir ()
 static char *mymailboxdir ()
 {
   char *home = myhomedir ();
-				/* initialize if first time */
-  if (!myMailboxDir && myHomeDir) {
     if (mailsubdir) {
       char tmp[MAILTMPLEN];
       sprintf (tmp,"%s/%s",home,mailsubdir);
       myMailboxDir = cpystr (tmp);/* use pre-defined subdirectory of home */
     }
     else myMailboxDir = cpystr (home);
-  }
   return myMailboxDir ? myMailboxDir : "";
 }
 
@


1.2
log
@Update to alpine-2.20.
(c-client-2.20, imap-uw-2.20, mailutil-uw-2.20, pico-5.07, pilot-2.99)

input, test and ok sthen@@
@
text
@d1 17
a17 3
$OpenBSD: patch-imap_src_osdep_unix_env_unix_c,v 1.1 2013/10/17 09:08:08 ajacoutot Exp $
--- imap/src/osdep/unix/env_unix.c.orig	Mon Jan 12 06:12:25 2015
+++ imap/src/osdep/unix/env_unix.c	Tue Jan 27 08:57:49 2015
@


1.1
log
@Update to alpine-2.11.
New upstream, re-alpine is dead...
@
text
@d1 4
a4 4
$OpenBSD: patch-imap_src_osdep_unix_env_unix_c,v 1.1.1.1 2012/09/27 15:09:53 ajacoutot Exp $
--- imap/src/osdep/unix/env_unix.c.orig	Sat Oct  2 10:37:57 2010
+++ imap/src/osdep/unix/env_unix.c	Sun Sep 23 11:28:37 2012
@@@@ -963,15 +963,12 @@@@ char *myhomedir ()
@

