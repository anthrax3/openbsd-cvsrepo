head	1.2;
access;
symbols;
locks; strict;
comment	@# @;


1.2
date	2017.02.09.14.43.04;	author giovanni;	state dead;
branches;
next	1.1;
commitid	g9JGhWXcn6wv92NB;

1.1
date	2016.09.04.11.40.25;	author giovanni;	state Exp;
branches;
next	;
commitid	373GnugpridGnMdk;


desc
@@


1.2
log
@bugfix update to 0.67.0
patch committed upstream
@
text
@$OpenBSD: patch-userdb_userdbpw_c,v 1.1 2016/09/04 11:40:25 giovanni Exp $
--- userdb/userdbpw.c.orig	Sat Aug 27 16:11:25 2016
+++ userdb/userdbpw.c	Sat Aug 27 17:55:57 2016
@@@@ -33,6 +33,7 @@@@
 #include	"libhmac/hmac.h"
 #endif
 
+#include	<pwd.h>
 #include	<string.h>
 #include	<stdio.h>
 #include	<signal.h>
@@@@ -102,6 +103,7 @@@@ int	n=1;
 int	md5=0;
 char	buf[BUFSIZ];
 char	salt[9];
+char	*cryptsalt;
 #if	HAVE_HMAC
 struct hmac_hashinfo	*hmac=0;
 #endif
@@@@ -244,7 +246,8 @@@@ struct hmac_hashinfo	*hmac=0;
 #endif
 
 #if	HAVE_CRYPT
-	printf("%s\n", crypt(buf, salt));
+	cryptsalt=bcrypt_gensalt(8);
+	printf("%s\n", crypt(buf, cryptsalt));
 	fflush(stdout);
 #endif
 	return (0);
@


1.1
log
@unbreak userdbpw(8), spotted by Stanley Lieber, thanks
@
text
@d1 1
a1 1
$OpenBSD$
@

