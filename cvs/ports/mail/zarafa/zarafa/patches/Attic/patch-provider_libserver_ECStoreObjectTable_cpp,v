head	1.4;
access;
symbols
	OPENBSD_4_9:1.2.0.2
	OPENBSD_4_9_BASE:1.2
	OPENBSD_4_8:1.1.0.2
	OPENBSD_4_8_BASE:1.1;
locks; strict;
comment	@# @;


1.4
date	2011.06.02.12.46.37;	author ajacoutot;	state dead;
branches;
next	1.3;

1.3
date	2011.03.03.13.16.05;	author ajacoutot;	state Exp;
branches;
next	1.2;

1.2
date	2010.08.31.17.57.21;	author ajacoutot;	state Exp;
branches;
next	1.1;

1.1
date	2010.06.30.02.46.48;	author ajacoutot;	state Exp;
branches;
next	;


desc
@@


1.4
log
@MAJOR update to zarafa-7.0.0 (RC1).
Committing now because this version performs _much_ better than what we
currently have in tree (see HOMEPAGE for details).

Quick&dirty upgrade steps (but you should follow the README):
------------------------------------------------------------------------
# /etc/rc.d/zarafa stop
===> Make sure _all_ zarafa processes are stopped and BACKUP YOUR DB!
# pkg_add -u zarafa zarafa-webaccess zarafa-libvmime
===> merge configuration (compare /usr/local/share/examples/zarara/*.cfg
with their counterparts under /etc/zarafa/.
# /usr/local/bin/zarafa-server
===> this will only do sanity checks but not start the server
# pkg_add py-mysql
# python2.6 /usr/local/share/doc/zarafa/zarafa7-upgrade
# /etc/rc.d/zarafa start
------------------------------------------------------------------------

tested by robert@@ and myself
ok robert@@
@
text
@$OpenBSD: patch-provider_libserver_ECStoreObjectTable_cpp,v 1.3 2011/03/03 13:16:05 ajacoutot Exp $
--- provider/libserver/ECStoreObjectTable.cpp.orig	Mon Jan 24 16:55:05 2011
+++ provider/libserver/ECStoreObjectTable.cpp	Tue Jan 25 12:56:18 2011
@@@@ -657,7 +657,9 @@@@ ECRESULT ECStoreObjectTable::CopyDatabaseRowToSOAPProp
 	unsigned int ulLastPos;
 	unsigned int ulColId = 0;
 	std::string strData;
+#ifndef __OpenBSD__
 	locale_t loc = createlocale(LC_NUMERIC, "C");
+#endif
 	
 	if(lpSession == NULL || lpsMapKey == NULL)
 	{
@@@@ -709,7 +711,11 @@@@ ECRESULT ECStoreObjectTable::CopyDatabaseRowToSOAPProp
 			break;
 		case PT_R4:
  			lpPropVal->__union = SOAP_UNION_propValData_flt;
+#ifndef __OpenBSD__
 			lpPropVal->Value.flt = (float)strtod_l(lpDBRow[ulColId], NULL, loc);
+#else
+			lpPropVal->Value.flt = (float)strtod(lpDBRow[ulColId], NULL);
+#endif
 			break;
 		case PT_BOOLEAN:
  			lpPropVal->__union = SOAP_UNION_propValData_b;
@@@@ -717,7 +723,11 @@@@ ECRESULT ECStoreObjectTable::CopyDatabaseRowToSOAPProp
 			break;
 		case PT_DOUBLE:
  			lpPropVal->__union = SOAP_UNION_propValData_dbl;
+#ifndef __OpenBSD__
 			lpPropVal->Value.dbl = strtod_l(lpDBRow[ulColId], NULL, loc);
+#else
+			lpPropVal->Value.dbl = strtod(lpDBRow[ulColId], NULL);
+#endif
 			break;
 		case PT_CURRENCY:
 			lpPropVal->Value.hilo = s_alloc<hiloLong>(soap);
@@@@ -727,7 +737,11 @@@@ ECRESULT ECStoreObjectTable::CopyDatabaseRowToSOAPProp
 			break;
 		case PT_APPTIME:
  			lpPropVal->__union = SOAP_UNION_propValData_dbl;
+#ifndef __OpenBSD__
 			lpPropVal->Value.dbl = strtod_l(lpDBRow[ulColId], NULL, loc);
+#else
+			lpPropVal->Value.dbl = strtod(lpDBRow[ulColId], NULL);
+#endif
 			break;
 		case PT_SYSTIME:
 			lpPropVal->Value.hilo = s_alloc<hiloLong>(soap);
@@@@ -820,7 +834,11 @@@@ ECRESULT ECStoreObjectTable::CopyDatabaseRowToSOAPProp
 			{
 				ParseMVProp(lpDBRow[ulColId], lpDBLen[ulColId], &ulLastPos, &strData);
 
+#ifndef __OpenBSD__
 				lpPropVal->Value.mvflt.__ptr[j] = (float)strtod_l(strData.c_str(), NULL, loc);
+#else
+				lpPropVal->Value.mvflt.__ptr[j] = (float)strtod(strData.c_str(), NULL);
+#endif
 			}
 			break;
 		case PT_MV_APPTIME:
@@@@ -840,7 +858,11 @@@@ ECRESULT ECStoreObjectTable::CopyDatabaseRowToSOAPProp
 			{
 				ParseMVProp(lpDBRow[ulColId], lpDBLen[ulColId], &ulLastPos, &strData);
 
+#ifndef __OpenBSD__
 				lpPropVal->Value.mvdbl.__ptr[j] = strtod_l(strData.c_str(), NULL, loc);
+#else
+				lpPropVal->Value.mvdbl.__ptr[j] = strtod(strData.c_str(), NULL);
+#endif
 			}
 			break;
 		case PT_MV_CURRENCY:
@@@@ -948,7 +970,9 @@@@ ECRESULT ECStoreObjectTable::CopyDatabaseRowToSOAPProp
 	} 
 
 exit:
+#ifndef __OpenBSD__
 	freelocale(loc);
+#endif
 	return er;
 }
 
@


1.3
log
@Update to zarafa-6.40.5.
Complete changelog available at:
    http://download.zarafa.com/community/final/6.40/changelog-6.40.txt

Several documentation and configuration tweaks.
@
text
@d1 1
a1 1
$OpenBSD: patch-provider_libserver_ECStoreObjectTable_cpp,v 1.2 2010/08/31 17:57:21 ajacoutot Exp $
@


1.2
log
@Update to zarafa-6.40.2.
Complete changelog available at:
http://download.zarafa.com/zarafa/release/docs/changelog.en.txt
@
text
@d1 4
a4 4
$OpenBSD: patch-provider_libserver_ECStoreObjectTable_cpp,v 1.1 2010/06/30 02:46:48 ajacoutot Exp $
--- provider/libserver/ECStoreObjectTable.cpp.orig	Mon Aug 30 13:01:48 2010
+++ provider/libserver/ECStoreObjectTable.cpp	Tue Aug 31 15:14:05 2010
@@@@ -655,7 +655,9 @@@@ ECRESULT ECStoreObjectTable::CopyDatabaseRowToSOAPProp
d14 1
a14 1
@@@@ -707,7 +709,11 @@@@ ECRESULT ECStoreObjectTable::CopyDatabaseRowToSOAPProp
d26 1
a26 1
@@@@ -715,7 +721,11 @@@@ ECRESULT ECStoreObjectTable::CopyDatabaseRowToSOAPProp
d38 1
a38 1
@@@@ -725,7 +735,11 @@@@ ECRESULT ECStoreObjectTable::CopyDatabaseRowToSOAPProp
d50 1
a50 1
@@@@ -818,7 +832,11 @@@@ ECRESULT ECStoreObjectTable::CopyDatabaseRowToSOAPProp
d62 1
a62 1
@@@@ -838,7 +856,11 @@@@ ECRESULT ECStoreObjectTable::CopyDatabaseRowToSOAPProp
d74 1
a74 1
@@@@ -946,7 +968,9 @@@@ ECRESULT ECStoreObjectTable::CopyDatabaseRowToSOAPProp
@


1.1
log
@*MAJOR* version update to zarafa-6.40.0.
Read the complete changelog here:
http://download.zarafa.com/zarafa/release/docs/changelog.en.txt

Upgrade documentation is available at:
http://doc.zarafa.com/6.40/Administrator_Manual/en-US/html-single/index.html#_performing_the_upgrade

zarafa-libical has been removed, current version from ports works fine
for zarafa needs.

php5-mapi has been merged into zarafa-webaccess.
@
text
@d1 4
a4 4
$OpenBSD$
--- provider/libserver/ECStoreObjectTable.cpp.orig	Tue Jun 29 01:35:04 2010
+++ provider/libserver/ECStoreObjectTable.cpp	Tue Jun 29 01:04:14 2010
@@@@ -644,7 +644,9 @@@@ ECRESULT ECStoreObjectTable::CopyDatabaseRowToSOAPProp
d14 1
a14 1
@@@@ -696,7 +698,11 @@@@ ECRESULT ECStoreObjectTable::CopyDatabaseRowToSOAPProp
d26 1
a26 1
@@@@ -704,7 +710,11 @@@@ ECRESULT ECStoreObjectTable::CopyDatabaseRowToSOAPProp
d38 1
a38 1
@@@@ -714,7 +724,11 @@@@ ECRESULT ECStoreObjectTable::CopyDatabaseRowToSOAPProp
d50 1
a50 1
@@@@ -807,7 +821,11 @@@@ ECRESULT ECStoreObjectTable::CopyDatabaseRowToSOAPProp
d62 1
a62 1
@@@@ -827,7 +845,11 @@@@ ECRESULT ECStoreObjectTable::CopyDatabaseRowToSOAPProp
d74 1
a74 1
@@@@ -935,7 +957,9 @@@@ ECRESULT ECStoreObjectTable::CopyDatabaseRowToSOAPProp
@

