head	1.6;
access;
symbols
	OPENBSD_3_4:1.3.0.2
	OPENBSD_3_4_BASE:1.3
	OPENBSD_3_3:1.1.0.6
	OPENBSD_3_3_BASE:1.1
	OPENBSD_3_1:1.1.0.4
	OPENBSD_3_2:1.1.0.2;
locks; strict;
comment	@# @;


1.6
date	2004.03.04.06.34.11;	author kevlo;	state dead;
branches;
next	1.5;

1.5
date	2003.11.13.05.55.56;	author kevlo;	state Exp;
branches;
next	1.4;

1.4
date	2003.11.03.06.15.15;	author kevlo;	state Exp;
branches;
next	1.3;

1.3
date	2003.07.16.10.32.14;	author kevlo;	state Exp;
branches;
next	1.2;

1.2
date	2003.04.14.08.26.20;	author kevlo;	state Exp;
branches;
next	1.1;

1.1
date	2003.01.30.07.57.26;	author kevlo;	state Exp;
branches
	1.1.2.1
	1.1.4.1;
next	;

1.1.2.1
date	2003.02.16.18.42.53;	author margarida;	state Exp;
branches;
next	;

1.1.4.1
date	2003.02.17.00.11.08;	author margarida;	state Exp;
branches;
next	;


desc
@@


1.6
log
@upgrade to 2.30
@
text
@$OpenBSD: patch-cgi-bin_openwebmail_ow-shared_pl,v 1.5 2003/11/13 05:55:56 kevlo Exp $
--- cgi-bin/openwebmail/ow-shared.pl.orig	Sun Nov  9 10:06:44 2003
+++ cgi-bin/openwebmail/ow-shared.pl	Thu Nov 13 10:40:47 2003
@@@@ -368,14 +368,14 @@@@
 ###################### USERENV_INIT ###################
 # init user globals, switch euid
 sub userenv_init {
-   load_rawconf(\%config_raw, "$SCRIPT_DIR/etc/openwebmail.conf.default");
-   readconf(\%config, \%config_raw, "$SCRIPT_DIR/etc/openwebmail.conf");
+   load_rawconf(\%config_raw, "%%SYSCONFDIR%%/openwebmail/openwebmail.conf.default");
+   readconf(\%config, \%config_raw, "%%SYSCONFDIR%%/openwebmail/openwebmail.conf");
    readlang($config{'default_language'});	# so %lang... can be used in error msg
 
    if ($config{'smtpauth'}) {	# load smtp auth user/pass
-      readconf(\%config, \%config_raw, "$SCRIPT_DIR/etc/smtpauth.conf");
+      readconf(\%config, \%config_raw, "%%SYSCONFDIR%%/openwebmail/smtpauth.conf");
       if ($config{'smtpauth_username'} eq "" || $config{'smtpauth_password'} eq "") {
-         openwebmailerror(__FILE__, __LINE__, "$SCRIPT_DIR/etc/smtpauth.conf $lang_err{'param_fmterr'}");
+         openwebmailerror(__FILE__, __LINE__, "%%SYSCONFDIR%%/openwebmail/smtpauth.conf $lang_err{'param_fmterr'}");
       }
    }
 
@


1.5
log
@upgrade to version 2.21
@
text
@d1 1
a1 1
$OpenBSD$
@


1.4
log
@upgrade to version 2.20
@
text
@d1 5
a5 4
$OpenBSD: patch-cgi-bin_openwebmail_ow-shared_pl,v 1.3 2003/07/16 10:32:14 kevlo Exp $
--- cgi-bin/openwebmail/ow-shared.pl.orig	Mon Jun 16 18:12:48 2003
+++ cgi-bin/openwebmail/ow-shared.pl	Wed Jul 16 18:00:18 2003
@@@@ -264,16 +264,16 @@@@ sub openwebmail_exit {
d8 4
a11 7
    if (!defined(%default_config_raw)) {	# read default only once if persistent mode
-      readconf(\%default_config, \%default_config_raw, "$SCRIPT_DIR/etc/openwebmail.conf.default");
+      readconf(\%default_config, \%default_config_raw, "%%SYSCONFDIR%%/openwebmail/openwebmail.conf.default");
    }
    %config=%default_config; %config_raw =%default_config_raw;
-   readconf(\%config, \%config_raw, "$SCRIPT_DIR/etc/openwebmail.conf") if (-f "$SCRIPT_DIR/etc/openwebmail.conf");
+   readconf(\%config, \%config_raw, "%%SYSCONFDIR%%/openwebmail/openwebmail.conf") if (-f "%%SYSCONFDIR%%/openwebmail/openwebmail.conf");
@


1.3
log
@update to 2.10
@
text
@d1 1
a1 1
$OpenBSD$
d9 1
a9 1
+      readconf(\%default_config, \%default_config_raw, "/var/www/conf/openwebmail/openwebmail.conf.default");
d13 1
a13 1
+   readconf(\%config, \%config_raw, "/var/www/conf/openwebmail/openwebmail.conf") if (-f "/var/www/conf/openwebmail/openwebmail.conf");
d18 1
a18 1
+      readconf(\%config, \%config_raw, "/var/www/conf/openwebmail/smtpauth.conf");
d21 1
a21 1
+         openwebmailerror(__FILE__, __LINE__, "/var/www/conf/openwebmail/smtpauth.conf $lang_err{'param_fmterr'}");
@


1.2
log
@upgrade to version 2.00
@
text
@d1 6
a6 6
$OpenBSD: patch-cgi-bin_openwebmail_ow-shared_pl,v 1.1 2003/01/30 07:57:26 kevlo Exp $
--- cgi-bin/openwebmail/ow-shared.pl.orig	Mon Mar 24 22:22:32 2003
+++ cgi-bin/openwebmail/ow-shared.pl	Mon Apr 14 13:03:33 2003
@@@@ -214,10 +214,10 @@@@
 sub openwebmail_init {
    clearvars();
d9 1
a9 1
+      readconf(\%default_config, \%default_config_raw, "%%SYSCONFDIR%%/openwebmail/openwebmail.conf.default");
d13 2
a14 1
+   readconf(\%config, \%config_raw, "%%SYSCONFDIR%%/openwebmail/openwebmail.conf") if (-f "%%SYSCONFDIR%%/openwebmail/openwebmail.conf");
d16 1
a16 6
    # setuid is required if mailspool is located in system directory
    if ( $>!=0 &&
@@@@ -243,9 +243,9 @@@@
    readconf(\%config, \%config_raw, "$config{'ow_sitesconfdir'}/$logindomain") if ( -f "$config{'ow_sitesconfdir'}/$logindomain");
 
    if ($config{'smtpauth'}) {
d18 1
a18 1
+      readconf(\%config, \%config_raw, "%%SYSCONFDIR%%/openwebmail/smtpauth.conf");
d20 2
a21 2
-         openwebmailerror("Invalid username/password in $SCRIPT_DIR/etc/smtpauth.conf");
+         openwebmailerror("Invalid username/password in %%SYSCONFDIR%%/openwebmail/smtpauth.conf");
d24 1
a24 1
    loadauth($config{'auth_module'});
@


1.1
log
@upgrade to version 1.81 and fix security bugs :
http://openwebmail.org/openwebmail/download/cert/advisories/SA-02:01.txt
@
text
@d1 4
a4 6
$OpenBSD$
--- cgi-bin/openwebmail/ow-shared.pl.orig	Tue Nov 26 12:20:51 2002
+++ cgi-bin/openwebmail/ow-shared.pl	Thu Jan 30 14:45:08 2003
@@@@ -125,8 +125,8 @@@@ use vars qw($_OFFSET $_FROM $_TO $_DATE 
 ###################### OPENWEBMAIL_INIT ###################
 # init routine to set globals, switch euid
d6 6
a11 1
-   readconf(\%config, \%config_raw, "$SCRIPT_DIR/etc/openwebmail.conf.default");
d13 6
a18 8
+   readconf(\%config, \%config_raw, "/var/www/conf/openwebmail/openwebmail.conf.default");
+   readconf(\%config, \%config_raw, "/var/www/conf/openwebmail/openwebmail.conf") if (-f "/var/www/conf/openwebmail/openwebmail.conf");
    # setuid is required if mails is located in user's dir
    if ( $>!=0 && ($config{'use_homedirspools'}||$config{'use_homedirfolders'}) ) {
       print "Content-type: text/html\n\n'$0' must setuid to root"; exit 0;
@@@@ -231,6 +231,9 @@@@ sub openwebmail_init {
 sub readconf {
    my ($r_config, $r_config_raw, $configfile)=@@_;
d20 6
a25 7
+   if ($configfile=~/\.\./) {  # .. in path is not allowed for higher security
+      openwebmailerror("Invalid config file path $configfile");
+   }
    # read config
    open(CONFIG, $configfile) or
       openwebmailerror("Couldn't open config file $configfile");
@@@@ -340,6 +343,12 @@@@ sub readconf {
d28 1
a28 10
 
+   # remove / and .. from variables that will be used in require statement for security
+   foreach $key ( 'default_language', 'auth_module') {
+       ${$r_config}{$key} =~ s|/||g;
+       ${$r_config}{$key} =~ s|\.\.||g;
+    
+   }
    # untaint pathname variable defined in openwebmail.conf
    foreach $key ( 'smtpserver', 'auth_module', 'virtusertable',
                   'mailspooldir', 'homedirspoolname', 'homedirfolderdirname',
@


1.1.4.1
log
@MFC:
Update to version 1.81 and fix security bugs:
http://openwebmail.org/openwebmail/download/cert/advisories/SA-02:01.txt

brad@@ ok
@
text
@d1 1
a1 1
$OpenBSD: patch-cgi-bin_openwebmail_ow-shared_pl,v 1.1.2.1 2003/02/16 18:42:53 margarida Exp $
@


1.1.2.1
log
@MFC:
Update to version 1.81 and fix security bugs:
http://openwebmail.org/openwebmail/download/cert/advisories/SA-02:01.txt

brad@@ ok
@
text
@d1 1
a1 1
$OpenBSD: patch-cgi-bin_openwebmail_ow-shared_pl,v 1.1 2003/01/30 07:57:26 kevlo Exp $
@

