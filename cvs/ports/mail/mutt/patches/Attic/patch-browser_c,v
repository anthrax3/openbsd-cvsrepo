head	1.2;
access;
symbols
	OPENBSD_2_9_TRACKING_SWITCH:1.1;
locks; strict;
comment	@# @;


1.2
date	2001.08.20.19.45.00;	author lebel;	state dead;
branches;
next	1.1;

1.1
date	2001.05.27.21.30.30;	author lebel;	state Exp;
branches;
next	;


desc
@@


1.2
log
@We are splitting mutt into mutt/stable and mutt/snapshot.

These will be imported in a jiffy.
@
text
@$OpenBSD: patch-browser_c,v 1.1 2001/05/27 21:30:30 lebel Exp $
--- browser.c.orig	Mon Jul 10 06:32:54 2000
+++ browser.c	Fri May 25 08:55:40 2001
@@@@ -22,6 +22,7 @@@@
 #include "buffy.h"
 #include "mapping.h"
 #include "sort.h"
+#include "mx.h"
 #include "mailbox.h"
 #include "browser.h"
 #ifdef USE_IMAP
@@@@ -350,6 +351,21 @@@@ static void init_state (struct browser_s
     menu->data = state->entry;
 }
 
+static void check_maildir_times (BUFFY *buf, struct stat *st)
+{
+  char buffer[_POSIX_PATH_MAX + SHORT_STRING];
+  struct stat s;
+  
+  if(!buf || buf->magic != M_MAILDIR)
+    return;
+
+  snprintf (buffer, sizeof (buffer), "%s/tmp", buf->path);
+  if (lstat (buffer, &s) != 0)
+    return;
+  
+  st->st_mtime = s.st_mtime;
+}
+
 static int examine_directory (MUTTMENU *menu, struct browser_state *state,
 			      const char *d, const char *prefix)
 {
@@@@ -402,6 +418,7 @@@@ static int examine_directory (MUTTMENU *
     tmp = Incoming;
     while (tmp && mutt_strcmp (buffer, tmp->path))
       tmp = tmp->next;
+    check_maildir_times (tmp, &s);      
     add_folder (menu, state, de->d_name, &s, (tmp) ? tmp->new : 0);
   }
   closedir (dp);  
@@@@ -440,6 +457,7 @@@@ static int examine_mailboxes (MUTTMENU *
     strfcpy (buffer, NONULL(tmp->path), sizeof (buffer));
     mutt_pretty_mailbox (buffer);
 
+    check_maildir_times (tmp, &s);      
     add_folder (menu, state, buffer, &s, tmp->new);
   }
   while ((tmp = tmp->next));
@


1.1
log
@add a new FLAVOR to mutt, "compressed" that add compressed folder support
to mutt via a patch provided by Roland Rosenfeld <roland@@spinnaker.de>,
located at http://www.spinnaker.de/mutt/compressed/.

Also, add a patch to browser.c to handle proper handling of timestamp in
folder view of Maildir forlders.

Okayed by fgsch@@
@
text
@d1 1
a1 1
$OpenBSD$
@

