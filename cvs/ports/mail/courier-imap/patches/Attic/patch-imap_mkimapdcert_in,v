head	1.8;
access;
symbols
	OPENBSD_4_9:1.7.0.6
	OPENBSD_4_9_BASE:1.7
	OPENBSD_4_8:1.7.0.4
	OPENBSD_4_8_BASE:1.7
	OPENBSD_4_7:1.7.0.2
	OPENBSD_4_7_BASE:1.7
	OPENBSD_4_6:1.6.0.12
	OPENBSD_4_6_BASE:1.6
	OPENBSD_4_5:1.6.0.10
	OPENBSD_4_5_BASE:1.6
	OPENBSD_4_4:1.6.0.8
	OPENBSD_4_4_BASE:1.6
	OPENBSD_4_3:1.6.0.6
	OPENBSD_4_3_BASE:1.6
	OPENBSD_4_2:1.6.0.4
	OPENBSD_4_2_BASE:1.6
	OPENBSD_4_1:1.6.0.2
	OPENBSD_4_1_BASE:1.6
	OPENBSD_4_0:1.5.0.10
	OPENBSD_4_0_BASE:1.5
	OPENBSD_3_9:1.5.0.8
	OPENBSD_3_9_BASE:1.5
	OPENBSD_3_8:1.5.0.6
	OPENBSD_3_8_BASE:1.5
	OPENBSD_3_7:1.5.0.4
	OPENBSD_3_7_BASE:1.5
	OPENBSD_3_6:1.5.0.2
	OPENBSD_3_6_BASE:1.5
	OPENBSD_3_5:1.4.0.12
	OPENBSD_3_5_BASE:1.4
	OPENBSD_3_4:1.4.0.10
	OPENBSD_3_4_BASE:1.4
	OPENBSD_3_3:1.4.0.8
	OPENBSD_3_3_BASE:1.4
	OPENBSD_3_2:1.4.0.6
	OPENBSD_3_2_BASE:1.4
	OPENBSD_3_1:1.4.0.4
	OPENBSD_3_1_BASE:1.4
	OPENBSD_3_0:1.4.0.2
	OPENBSD_3_0_BASE:1.4
	OPENBSD_2_9_TRACKING_SWITCH:1.3
	OPENBSD_2_9:1.3.0.2
	OPENBSD_2_9_BASE:1.3
	OPENBSD_2_8:1.2.0.2
	OPENBSD_2_8_BASE:1.2
	OPENBSD_2_7:1.1.0.2;
locks; strict;
comment	@# @;


1.8
date	2011.05.09.09.30.26;	author giovanni;	state dead;
branches;
next	1.7;

1.7
date	2009.10.28.14.20.19;	author giovanni;	state Exp;
branches;
next	1.6;

1.6
date	2006.11.03.16.19.56;	author mbalmer;	state Exp;
branches;
next	1.5;

1.5
date	2004.07.01.12.19.35;	author avsm;	state Exp;
branches;
next	1.4;

1.4
date	2001.09.30.23.15.57;	author avsm;	state Exp;
branches;
next	1.3;

1.3
date	2000.12.29.18.51.57;	author avsm;	state Exp;
branches;
next	1.2;

1.2
date	2000.10.01.13.27.14;	author avsm;	state Exp;
branches;
next	1.1;

1.1
date	2000.08.10.21.12.49;	author danh;	state Exp;
branches;
next	;


desc
@@


1.8
log
@
Update to 4.9.1, utf-8 support completely rewritten and some bug fixes.
@
text
@$OpenBSD: patch-imap_mkimapdcert_in,v 1.7 2009/10/28 14:20:19 giovanni Exp $
--- imap/mkimapdcert.in.orig	Sun Nov  4 21:49:58 2007
+++ imap/mkimapdcert.in	Mon Jun 15 15:30:20 2009
@@@@ -17,42 +17,43 @@@@ else
 fi
 
 prefix="@@prefix@@"
+SSLDIR="/etc/ssl/private"
 
-if test -f @@mydatadir@@/imapd.pem
+if test -f ${SSLDIR}/imapd.pem
 then
-	echo "@@mydatadir@@/imapd.pem already exists."
+	echo "${SSLDIR}/imapd.pem already exists."
 	exit 1
 fi
 
 umask 077
 
 cleanup() {
-	rm -f @@mydatadir@@/imapd.pem
-	rm -f @@mydatadir@@/imapd.rand
-	rm -f @@mydatadir@@/imapd.key
-	rm -f @@mydatadir@@/imapd.cert
+	rm -f ${SSLDIR}/imapd.pem
+	rm -f ${SSLDIR}/imapd.rand
+	rm -f ${SSLDIR}/imapd.key
+	rm -f ${SSLDIR}/imapd.cert
 	exit 1
 }
 
-cd @@mydatadir@@
+cd ${SSLDIR}
 
 if test "@@ssllib@@" = "openssl"
 then
-	cp /dev/null @@mydatadir@@/imapd.pem
-	chmod 600 @@mydatadir@@/imapd.pem
-	chown @@mailuser@@ @@mydatadir@@/imapd.pem
+	cp /dev/null ${SSLDIR}/imapd.pem
+	chmod 600 ${SSLDIR}/imapd.pem
+	chown @@mailuser@@ ${SSLDIR}/imapd.pem
 
-	dd if=@@RANDOMV@@ of=@@mydatadir@@/imapd.rand count=1 2>/dev/null
+	dd if=@@RANDOMV@@ of=${SSLDIR}/imapd.rand count=1 2>/dev/null
 	@@OPENSSL@@ req -new -x509 -days 365 -nodes \
-		  -config @@sysconfdir@@/imapd.cnf -out @@mydatadir@@/imapd.pem -keyout @@mydatadir@@/imapd.pem || cleanup
-	@@OPENSSL@@ gendh -rand @@mydatadir@@/imapd.rand 512 >>@@mydatadir@@/imapd.pem || cleanup
-	@@OPENSSL@@ x509 -subject -dates -fingerprint -noout -in @@mydatadir@@/imapd.pem || cleanup
-	rm -f @@mydatadir@@/imapd.rand
+		  -config @@sysconfdir@@/imapd.cnf -out ${SSLDIR}/imapd.pem -keyout ${SSLDIR}/imapd.pem || cleanup
+	@@OPENSSL@@ gendh -rand ${SSLDIR}/imapd.rand 512 >>${SSLDIR}/imapd.pem || cleanup
+	@@OPENSSL@@ x509 -subject -dates -fingerprint -noout -in ${SSLDIR}/imapd.pem || cleanup
+	rm -f ${SSLDIR}/imapd.rand
 else
-	cp /dev/null @@mydatadir@@/imapd.key
-	chmod 600 @@mydatadir@@/imapd.key
-	cp /dev/null @@mydatadir@@/imapd.cert
-	chmod 600 @@mydatadir@@/imapd.cert
+	cp /dev/null ${SSLDIR}/imapd.key
+	chmod 600 ${SSLDIR}/imapd.key
+	cp /dev/null ${SSLDIR}/imapd.cert
+	chmod 600 ${SSLDIR}/imapd.cert
 
 	@@CERTTOOL@@ --generate-privkey --outfile imapd.key
 	@@CERTTOOL@@ --generate-self-signed --load-privkey imapd.key --outfile imapd.cert --template @@sysconfdir@@/imapd.cnf
@


1.7
log
@
Update to 4.6.0 and take maintainership
ok landry@@
@
text
@d1 1
a1 1
$OpenBSD: patch-imap_mkimapdcert_in,v 1.6 2006/11/03 16:19:56 mbalmer Exp $
@


1.6
log
@Update to courier-imap 4.1.1.  If you used courier-imap before, you should
now also use courier-authlib (which is new) as the authentication stuff
has been moved there.

This should make our courier system again faily complete, we have been
running this code for almost a year.
@
text
@d1 5
a5 5
$OpenBSD$
--- imap/mkimapdcert.in.orig	Mon Aug  1 00:35:38 2005
+++ imap/mkimapdcert.in	Mon Aug  1 00:37:31 2005
@@@@ -12,28 +12,29 @@@@
 test -x @@OPENSSL@@ || exit 0
d10 1
a10 1
-if test -f @@datadir@@/imapd.pem
d13 1
a13 1
-	echo "@@datadir@@/imapd.pem already exists."
a18 6
-cp /dev/null @@datadir@@/imapd.pem
-chmod 600 @@datadir@@/imapd.pem
-chown @@mailuser@@ @@datadir@@/imapd.pem
+cp /dev/null ${SSLDIR}/imapd.pem
+chmod 600 ${SSLDIR}/imapd.pem
+chown @@mailuser@@ ${SSLDIR}/imapd.pem
d21 4
a24 2
-	rm -f @@datadir@@/imapd.pem
-	rm -f @@datadir@@/imapd.rand
d27 2
d32 1
a32 2
-cd @@datadir@@
-dd if=@@RANDOMV@@ of=@@datadir@@/imapd.rand count=1 2>/dev/null
d34 33
a66 10
+dd if=@@RANDOMV@@ of=${SSLDIR}/imapd.rand count=1 2>/dev/null
 @@OPENSSL@@ req -new -x509 -days 365 -nodes \
-	-config @@sysconfdir@@/imapd.cnf -out @@datadir@@/imapd.pem -keyout @@datadir@@/imapd.pem || cleanup
-@@OPENSSL@@ gendh -rand @@datadir@@/imapd.rand 512 >>@@datadir@@/imapd.pem || cleanup
-@@OPENSSL@@ x509 -subject -dates -fingerprint -noout -in @@datadir@@/imapd.pem || cleanup
-rm -f @@datadir@@/imapd.rand
+	-config @@sysconfdir@@/imapd.cnf -out ${SSLDIR}/imapd.pem -keyout ${SSLDIR}/imapd.pem || cleanup
+@@OPENSSL@@ gendh -rand ${SSLDIR}/imapd.rand 512 >>${SSLDIR}/imapd.pem || cleanup
+@@OPENSSL@@ x509 -subject -dates -fingerprint -noout -in ${SSLDIR}/imapd.pem || cleanup
+rm -f ${SSLDIR}/imapd.rand
@


1.5
log
@update to courier-imap-3.05, from David Gwynne <loki at animata.net>
@
text
@d2 3
a4 3
--- imap/mkimapdcert.in.orig	2004-05-16 14:41:01.000000000 +1000
+++ imap/mkimapdcert.in	2004-05-16 14:52:55.000000000 +1000
@@@@ -12,27 +12,28 @@@@
d18 1
@


1.4
log
@- upgrade to courier-imap-1.3.11
- install authmysqlrc and authldaprc in the relevant flavors
- depend on gdbm now, and force usage of it (danh@@)
@
text
@d1 5
a5 6
$OpenBSD: patch-imap_mkimapdcert_in,v 1.3 2000/12/29 18:51:57 avsm Exp $
--- imap/mkimapdcert.in.orig	Sun Aug 26 15:57:55 2001
+++ imap/mkimapdcert.in	Sun Sep 30 22:32:35 2001
@@@@ -9,30 +9,29 @@@@
 # IMAP over SSL.  Normally this script would get called by an automatic
 # package installation routine.
a6 2
-test -x @@OPENSSL@@ || exit 0
-
@


1.3
log
@- upgrade to courier-imap-1.3.0

- regenerate patches and name them consistently.  Note that the
  configuration file format and names have changed with this release

- add an INSTALL shell fragment to detect old versions of the config
files and warn the user to regenerate them

- config files now live in /etc/courier-imap, as they are very
  generic names, and this avoid conflict with other imap daemons

Summary of changes:

This release fixes some bugs in the POP3 server, adds optional
support for gb2312 and big5 text search, and introduces a new
configuration file format.

The new configuration file format will allow future upgrades
to automatically preserve the existing system configuration data,
instead of installing a default set of configuration files
@
text
@d1 4
a4 4
$OpenBSD: patch-imap_mkimapdcert_in,v 1.2 2000/10/01 13:27:14 avsm Exp $
--- imap/mkimapdcert.in.orig	Mon Sep 18 11:14:24 2000
+++ imap/mkimapdcert.in	Fri Dec 29 15:14:10 2000
@@@@ -9,29 +9,27 @@@@
d9 3
a11 1
+SSLDIR=/etc/ssl/private
a12 2
-prefix="@@prefix@@"
-
d36 1
d38 1
d46 1
a46 1
+@@OPENSSL@@ gendh -rand ${SSLDIR}/imapd.rand 512 >> ${SSLDIR}/imapd.pem || cleanup
@


1.2
log
@- update to v1.1
  (notable changes: better locking, improved RC scripts, THREAD semantics
   updated to latest IETF draft, unicode support, bug fixes)
- bump NEED_VERSION, MAINTAINER real name added
- regenerate RC patch
- PLIST tweaked to not delete libexec/authlib, which is being
  used by other applications now (e.g. vmailmgr)
@
text
@d1 4
a4 4
$OpenBSD$
--- imap/mkimapdcert.in.orig	Sun Oct  1 13:49:22 2000
+++ imap/mkimapdcert.in	Sun Oct  1 14:00:26 2000
@@@@ -9,29 +9,25 @@@@
d9 2
a10 1
-
d14 1
a14 1
+if test -f @@sysconfdir@@/ssl/private/imapd.pem
d17 1
a17 1
+	echo "@@sysconfdir@@/ssl/private/imapd.pem already exists."
d24 3
a26 3
+cp /dev/null @@sysconfdir@@/ssl/private/imapd.pem
+chmod 600 @@sysconfdir@@/ssl/private/imapd.pem
+chown @@mailuser@@ @@sysconfdir@@/ssl/private/imapd.pem
d31 2
a32 2
+	rm -f @@sysconfdir@@/ssl/private/imapd.pem
+	rm -f @@sysconfdir@@/ssl/private/imapd.rand
d37 1
a37 1
+dd if=@@RANDOMV@@ of=@@sysconfdir@@/ssl/private/imapd.rand count=1 2>/dev/null
d43 4
a46 4
+	-config @@sysconfdir@@/imapd.cnf -out @@sysconfdir@@/ssl/private/imapd.pem -keyout @@sysconfdir@@/ssl/private/imapd.pem || cleanup
+@@OPENSSL@@ gendh -rand @@sysconfdir@@/ssl/private/imapd.rand 512 >>@@sysconfdir@@/ssl/private/imapd.pem || cleanup
+@@OPENSSL@@ x509 -subject -dates -fingerprint -noout -in @@sysconfdir@@/ssl/private/imapd.pem || cleanup
+rm -f @@sysconfdir@@/ssl/private/imapd.rand
@


1.1
log
@update to version 0.99 from maintainer
@
text
@d1 6
a6 5
$OpenBSD: update-patches,v 1.3 2000/06/09 17:08:37 espie Exp $
--- imap/mkimapdcert.in.orig	Sun Jul  9 14:27:21 2000
+++ imap/mkimapdcert.in	Thu Aug 10 14:44:02 2000
@@@@ -12,20 +12,24 @@@@
 test -x @@OPENSSL@@ || exit 0
d8 3
a10 1
 prefix="@@prefix@@"
d13 1
a13 2
+certdir=@@sysconfdir@@/ssl/private
+if test -f ${certdir}/imapd.pem
d16 1
a16 1
+	echo "${certdir}/imapd.pem already exists."
a18 8
+if test -f ${certdir}/imapd.rand
+then
+	echo "${certdir}/imapd.rand exists - delete it to continue."
+	exit 1
+fi
+cp /dev/null ${certdir}/imapd.pem
+chmod 600 ${certdir}/imapd.pem
+chown @@mailuser@@ ${certdir}/imapd.pem
d23 12
a34 1
-
d36 1
a36 1
+dd if=@@RANDOMV@@ of=${certdir}/imapd.rand count=1 2>/dev/null
d38 3
a40 3
-	-config @@sysconfdir@@/imapd.cnf -out @@datadir@@/imapd.pem -keyout @@datadir@@/imapd.pem
-@@OPENSSL@@ gendh -rand @@datadir@@/imapd.rand 512 >>@@datadir@@/imapd.pem
-@@OPENSSL@@ x509 -subject -dates -fingerprint -noout -in @@datadir@@/imapd.pem
d42 4
a45 4
+	-config @@sysconfdir@@/imapd.cnf -out ${certdir}/imapd.pem -keyout ${certdir}/imapd.pem
+@@OPENSSL@@ gendh -rand ${certdir}/imapd.rand 512 >>${certdir}/imapd.pem
+@@OPENSSL@@ x509 -subject -dates -fingerprint -noout -in ${certdir}/imapd.pem
+rm -f ${certdir}/imapd.rand
@

