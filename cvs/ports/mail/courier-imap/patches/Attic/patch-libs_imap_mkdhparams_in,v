head	1.2;
access;
symbols
	OPENBSD_5_8:1.1.0.4
	OPENBSD_5_8_BASE:1.1;
locks; strict;
comment	@# @;


1.2
date	2015.08.27.09.33.17;	author giovanni;	state dead;
branches;
next	1.1;
commitid	FZBR7dDzhwKJ2Xds;

1.1
date	2015.04.28.07.20.02;	author giovanni;	state Exp;
branches;
next	;
commitid	zFDmor9pDTgy1RVX;


desc
@@


1.2
log
@Bugfix update to 4.16.2
some patches committed upstream
remove @@samples that end up under /var/run, requested by ajacoutot
@
text
@$OpenBSD: patch-libs_imap_mkdhparams_in,v 1.1 2015/04/28 07:20:02 giovanni Exp $
--- libs/imap/mkdhparams.in.orig	Sat Oct 11 17:50:22 2014
+++ libs/imap/mkdhparams.in	Sun Apr 26 01:12:12 2015
@@@@ -7,6 +7,12 @@@@
 
 # Override from the environment
 
+@@OPENSSL@@ version | grep LibreSSL 1>/dev/null
+if test $? = 0
+then
+	LIBRESSL=1
+fi
+
 if test "$TLS_DHPARAMS" = ""
 then
 	TLS_DHPARAMS="@@certsdir@@/dhparams.pem"
@@@@ -36,9 +42,14 @@@@ then
 	BITS=2048
     fi
 
-    dd if=@@RANDOMV@@ of=$TLS_DHPARAMS.rand.tmp count=1 2>/dev/null
-    @@OPENSSL@@ dhparam -rand $TLS_DHPARAMS.rand.tmp -outform PEM $BITS >$TLS_DHPARAMS.tmp
-    rm -f $TLS_DHPARAMS.rand.tmp
+    if test "$LIBRESSL" = 0
+    then
+        dd if=@@RANDOMV@@ of=$TLS_DHPARAMS.rand.tmp count=1 2>/dev/null
+        @@OPENSSL@@ dhparam -rand $TLS_DHPARAMS.rand.tmp -outform PEM $BITS >$TLS_DHPARAMS.tmp
+        rm -f $TLS_DHPARAMS.rand.tmp
+    else
+        @@OPENSSL@@ dhparam -outform PEM $BITS >$TLS_DHPARAMS.tmp
+    fi
     mv -f $TLS_DHPARAMS.tmp $TLS_DHPARAMS
 else
     if test "$BITS" = ""
@


1.1
log
@Update to 4.16.0
remove a couple of patches committed upstream
add 2 patches (committed upstream) to fix a use-after-free and to let
mkdhparams(8) work with LibreSSL
ok jca@@ on a similar diff
@
text
@d1 1
a1 1
$OpenBSD$
@

