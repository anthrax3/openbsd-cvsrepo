head	1.4;
access;
symbols
	OPENBSD_4_5:1.1.0.2
	OPENBSD_4_5_BASE:1.1;
locks; strict;
comment	@# @;


1.4
date	2010.06.20.13.53.56;	author sthen;	state dead;
branches;
next	1.3;

1.3
date	2010.03.31.19.37.31;	author sthen;	state Exp;
branches;
next	1.2;

1.2
date	2009.03.17.09.09.10;	author sthen;	state dead;
branches;
next	1.1;

1.1
date	2009.02.14.10.27.58;	author sthen;	state Exp;
branches
	1.1.2.1;
next	;

1.1.2.1
date	2009.09.23.03.37.03;	author william;	state dead;
branches;
next	;


desc
@@


1.4
log
@update to 0.2.12 from Brad (maintainer)
@
text
@$OpenBSD: patch-src_lib-storage_index_maildir_maildir-mail_c,v 1.3 2010/03/31 19:37:31 sthen Exp $
--- src/lib-storage/index/maildir/maildir-mail.c.orig	Thu Mar 25 22:15:28 2010
+++ src/lib-storage/index/maildir/maildir-mail.c	Thu Mar 25 22:17:18 2010
@@@@ -154,7 +154,7 @@@@ static int maildir_mail_get_save_date(struct mail *_ma
 		return -1;
 
 	*date_r = data->save_date = st.st_ctime;
-	return data->save_date;
+	return 0;
 }
 
 static int
@


1.3
log
@add a bugfix patch from upstream; from Brad
@
text
@d1 1
a1 1
$OpenBSD$
@


1.2
log
@maintenance update to Dovecot 1.1.12 plus a couple of post-release
patches from the upstream repo - from Brad (maintainer).
@
text
@d1 12
a12 22
$OpenBSD: patch-src_lib-storage_index_maildir_maildir-mail_c,v 1.1 2009/02/14 10:27:58 sthen Exp $
--- src/lib-storage/index/maildir/maildir-mail.c.orig	Tue Jan  6 09:33:51 2009
+++ src/lib-storage/index/maildir/maildir-mail.c	Fri Feb 13 17:48:55 2009
@@@@ -485,8 +485,16 @@@@ static void maildir_mail_set_cache_corrupted(struct ma
 					       _mail->uid, &flags);
 		if (maildir_filename_get_size(fname, MAILDIR_EXTRA_VIRTUAL_SIZE,
 					      &size)) {
-			i_error("Maildir filename has wrong W value: %s/%s",
-				mbox->path, fname);
+			const char *subdir =
+				(flags & MAILDIR_UIDLIST_REC_FLAG_NEW_DIR) != 0 ?
+				"new" : "cur";
+			mail_storage_set_critical(_mail->box->storage,
+				"Maildir filename has wrong W= value, "
+				"can't fix it automatically: %s/%s/%s",
+				mbox->path, subdir, fname);
+			/* don't bother setting cache corrupted since it
+			   doesn't fix anything. */
+			return;
 		} else if (maildir_uidlist_lookup_ext(mbox->uidlist, _mail->uid,
 				MAILDIR_UIDLIST_REC_EXT_VSIZE) != NULL) {
 			maildir_uidlist_set_ext(mbox->uidlist, _mail->uid,
@


1.1
log
@log the correct filename in an error message; from upstream repo via Brad
@
text
@d1 1
a1 1
$OpenBSD$
@


1.1.2.1
log
@MFC:

- SECURITY update of dovecot-sieve (based on the Cyrus sieve library)
- bugfix update of dovecot

originally from brad@@, -stable diff partly from sthen@@, thanks!

ok brad@@ (MAINTAINER)
@
text
@d1 1
a1 1
$OpenBSD: patch-src_lib-storage_index_maildir_maildir-mail_c,v 1.1 2009/02/14 10:27:58 sthen Exp $
@


