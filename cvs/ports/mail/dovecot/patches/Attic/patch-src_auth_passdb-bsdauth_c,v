head	1.4;
access;
symbols
	OPENBSD_5_4:1.3.0.4
	OPENBSD_5_4_BASE:1.3
	OPENBSD_5_3:1.3.0.2
	OPENBSD_5_3_BASE:1.3;
locks; strict;
comment	@# @;


1.4
date	2013.08.13.00.29.58;	author brad;	state dead;
branches;
next	1.3;

1.3
date	2012.11.25.00.58.38;	author halex;	state Exp;
branches;
next	1.2;

1.2
date	2009.11.10.23.20.22;	author sthen;	state dead;
branches;
next	1.1;

1.1
date	2009.10.30.11.43.48;	author sthen;	state Exp;
branches;
next	;


desc
@@


1.4
log
@Update to Dovecot 2.2.5.

ok sthen@@
@
text
@$OpenBSD: patch-src_auth_passdb-bsdauth_c,v 1.3 2012/11/25 00:58:38 halex Exp $
--- src/auth/passdb-bsdauth.c.orig	Sun Feb 12 17:55:54 2012
+++ src/auth/passdb-bsdauth.c	Mon Oct 29 22:42:37 2012
@@@@ -18,6 +18,7 @@@@ bsdauth_verify_plain(struct auth_request *request, con
 		    verify_plain_callback_t *callback)
 {
 	struct passwd pw;
+	const char *type;
 	int result;
 
 	auth_request_log_debug(request, "bsdauth", "lookup");
@@@@ -35,7 +36,8 @@@@ bsdauth_verify_plain(struct auth_request *request, con
 	}
 
 	/* check if the password is valid */
-	result = auth_userokay(request->user, NULL, NULL,
+	type = t_strdup_printf("auth-%s", request->service);
+	result = auth_userokay(request->user, NULL, t_strdup_noconst(type),
 			       t_strdup_noconst(password));
 
 	/* clear the passwords from memory */
@


1.3
log
@missing file from last commit
@
text
@d1 1
a1 1
$OpenBSD$
@


1.2
log
@Update to 1.1.20, from Brad.
@
text
@d1 9
a9 5
$OpenBSD: patch-src_auth_passdb-bsdauth_c,v 1.1 2009/10/30 11:43:48 sthen Exp $
--- src/auth/passdb-bsdauth.c.orig	Thu Oct 29 23:16:41 2009
+++ src/auth/passdb-bsdauth.c	Thu Oct 29 23:17:43 2009
@@@@ -54,6 +54,7 @@@@ bsdauth_preinit(struct auth_passdb *auth_passdb, const
 	struct passdb_module *module;
d11 3
a13 2
 	module = p_new(auth_passdb->auth->pool, struct passdb_module, 1);
+	module->default_pass_scheme = "PLAIN"; /* same reason as PAM */
d15 7
a21 2
 	if (strncmp(args, "cache_key=", 10) == 0) {
 		module->cache_key =
@


1.1
log
@Add some patches from upstream. From Brad.
@
text
@d1 1
a1 1
$OpenBSD$
@

