head	1.2;
access;
symbols;
locks; strict;
comment	@# @;


1.2
date	2010.06.20.13.53.56;	author sthen;	state dead;
branches;
next	1.1;

1.1
date	2010.05.02.22.42.44;	author sthen;	state Exp;
branches;
next	;


desc
@@


1.2
log
@update to 0.2.12 from Brad (maintainer)
@
text
@$OpenBSD: patch-src_imap_imap-fetch-body_c,v 1.1 2010/05/02 22:42:44 sthen Exp $
--- src/imap/imap-fetch-body.c.orig	Sun May  2 16:56:51 2010
+++ src/imap/imap-fetch-body.c	Sun May  2 16:57:42 2010
@@@@ -274,6 +274,8 @@@@ static int fetch_stream_send_direct(struct imap_fetch_
 				"%"PRIuUOFF_T" vs %"PRIuUOFF_T,
 				ctx->cur_name, mailbox_get_name(ctx->mail->box),
 				ctx->mail->uid, ctx->cur_offset, ctx->cur_size);
+			mail_set_cache_corrupted(ctx->mail,
+						 ctx->cur_size_field);
 			client_disconnect(ctx->client, "FETCH failed");
 			return -1;
 		}
@


1.1
log
@add a patch from upstream via Brad:
imap: If FETCH notices cached message size is wrong, mark cache corrupted
@
text
@d1 1
a1 1
$OpenBSD$
@

