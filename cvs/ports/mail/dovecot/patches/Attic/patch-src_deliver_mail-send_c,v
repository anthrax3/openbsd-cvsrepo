head	1.2;
access;
symbols;
locks; strict;
comment	@# @;


1.2
date	2010.06.20.13.53.56;	author sthen;	state dead;
branches;
next	1.1;

1.1
date	2010.04.14.08.28.54;	author sthen;	state Exp;
branches;
next	;


desc
@@


1.2
log
@update to 0.2.12 from Brad (maintainer)
@
text
@$OpenBSD: patch-src_deliver_mail-send_c,v 1.1 2010/04/14 08:28:54 sthen Exp $
--- src/deliver/mail-send.c.orig	Sat Apr 10 19:03:50 2010
+++ src/deliver/mail-send.c	Sat Apr 10 19:05:09 2010
@@@@ -61,6 +61,9 @@@@ int mail_send_rejection(struct mail *mail, const char 
     size_t size;
     int ret;
 
+    if (mail_get_first_header(mail, "Message-ID", &orig_msgid) < 0)
+	    orig_msgid = NULL;
+
     if (mail_get_first_header(mail, "Auto-Submitted", &value) > 0 &&
 	strcasecmp(value, "no") != 0) {
 	    i_info("msgid=%s: Auto-submitted message discarded: %s",
@@@@ -69,8 +72,6 @@@@ int mail_send_rejection(struct mail *mail, const char 
 	    return 0;
     }
 
-    if (mail_get_first_header(mail, "Message-ID", &orig_msgid) < 0)
-	    orig_msgid = NULL;
     return_addr = deliver_get_return_address(mail);
     if (return_addr == NULL) {
 	    i_info("msgid=%s: Return-Path missing, rejection reason: %s",
@


1.1
log
@fix a crash in deliver, from upstream via Brad
@
text
@d1 1
a1 1
$OpenBSD$
@

