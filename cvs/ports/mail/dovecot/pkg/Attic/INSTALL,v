head	1.6;
access;
symbols
	OPENBSD_3_6:1.4.0.2
	OPENBSD_3_6_BASE:1.4
	OPENBSD_3_5:1.3.0.2
	OPENBSD_3_5_BASE:1.3
	OPENBSD_3_4:1.2.0.2
	OPENBSD_3_4_BASE:1.2
	jolan_2003-jul-14:1.1.1.1
	jolan:1.1.1;
locks; strict;
comment	@# @;


1.6
date	2004.11.24.21.10.53;	author alek;	state dead;
branches;
next	1.5;

1.5
date	2004.09.15.09.09.41;	author espie;	state Exp;
branches;
next	1.4;

1.4
date	2004.06.23.04.50.00;	author brad;	state Exp;
branches;
next	1.3;

1.3
date	2003.11.05.03.42.06;	author jolan;	state Exp;
branches;
next	1.2;

1.2
date	2003.07.23.06.03.01;	author jolan;	state Exp;
branches
	1.2.2.1;
next	1.1;

1.1
date	2003.07.14.23.44.28;	author jolan;	state Exp;
branches
	1.1.1.1;
next	;

1.1.1.1
date	2003.07.14.23.44.28;	author jolan;	state Exp;
branches;
next	;

1.2.2.1
date	2004.05.28.21.23.22;	author brad;	state Exp;
branches;
next	;


desc
@@


1.6
log
@- Move notice from INSTALL to MESSAGE
- Replace (DE)INSTALL with @@sample, @@new(group|user)
- Bump PKGNAME

ok naddy@@ brad@@
@
text
@#!/bin/sh
# $OpenBSD: INSTALL,v 1.5 2004/09/15 09:09:41 espie Exp $
#
# Pre/post-installation setup of Dovecot

PATH=/bin:/usr/bin:/sbin:/usr/sbin
PREFIX=${PKG_PREFIX:-/usr/local}
SYSCONFDIR=${SYSCONFDIR:-/etc}
CONFIG_FILE=$SYSCONFDIR/dovecot.conf
SSL_DIR=/etc/ssl
SSL_FILE=$SSL_DIR/dovecot-openssl.cnf
SAMPLE_CONFIG_DIR=$PREFIX/share/examples/dovecot
SAMPLE_CONFIG_FILE=$SAMPLE_CONFIG_DIR/dovecot-example.conf
SAMPLE_SSL_FILE=$SAMPLE_CONFIG_DIR/dovecot-openssl.cnf
DOVECOTDIR=/var/dovecot
DOVECOTUSER=_dovecot
DOVECOTGROUP=_dovecot
ID=518

do_usergroup_install()
{
  # Create Dovecot user and group
  groupinfo -e $DOVECOTGROUP
  if [ $? -eq 0 ]; then
    echo "===> Using $DOVECOTGROUP group for Dovecot"
  else
    echo "===> Creating $DOVECOTGROUP group for Dovecot"
    groupadd -g $ID $DOVECOTGROUP
  fi
  userinfo -e $DOVECOTUSER
  if [ $? -eq 0 ]; then
    echo "===> Using $DOVECOTUSER user for Dovecot"
  else
    echo "===> Creating $DOVECOTUSER user for Dovecot"
    useradd -g $DOVECOTGROUP -d /nonexistent -L daemon -c 'Dovecot Account' -s /sbin/nologin -u $ID $DOVECOTUSER
  fi
}


do_ssl_install()
{
    echo
    echo "+---------------"
    echo "| Files to facilitate the generation of a self-signed"
    echo "| certificate and key for Dovecot have been installed:"
    echo "| $SSL_FILE	(Edit this accordingly!)"
    echo "| $PREFIX/sbin/dovecot-mkcert.sh"
    echo "|"
    echo "| If this has been or will be accomplished by other means,"
    echo "| use the following paths for the files:"
    echo "| $SSL_DIR/dovecotcert.pem"
    echo "| $SSL_DIR/private/dovecot.pem"
    echo "+---------------"
    echo
}

do_var_install()
{
	install -d -o root -g wheel -m 700 $DOVECOTDIR
	install -d -o root -g $DOVECOTGROUP -m 750 $DOVECOTDIR/login
}

if [ $# -ne 2 ]; then
    echo "usage: $0 distname { PRE-INSTALL | POST-INSTALL }" >&2
    exit 1
fi

case $2 in
    PRE-INSTALL)
	do_usergroup_install
	;;
    POST-INSTALL)
            do_ssl_install $1
	if [ ! -d $DOVECOTDIR ]; then
	    do_var_install
	fi
	;;
    *)
	echo "usage: $0 distname { PRE-INSTALL | POST-INSTALL }" >&2
	exit 1
	;;
esac

exit 0
@


1.5
log
@new style plists.
@
text
@d2 1
a2 1
# $OpenBSD: INSTALL,v 1.4 2004/06/23 04:50:00 brad Exp $
@


1.4
log
@@@extra and some cleaning
@
text
@d2 1
a2 1
# $OpenBSD: INSTALL,v 1.3 2003/11/05 03:42:06 jolan Exp $
a38 33
do_config_notice()
{
    echo
    echo "+---------------"
    echo "| The existing $1 configuration file $CONFIG_FILE"
    echo "| has NOT been changed. You may want to compare it to the"
    echo "| current sample file $SAMPLE_CONFIG_FILE,"
    echo "| and update your configuration as needed."
    echo "+---------------"
}

do_ssl_notice()
{
    echo
    echo "+---------------"
    echo "| The existing $1 configuration file $SSL_FILE"
    echo "| has NOT been changed. You may want to compare it to the"
    echo "| current sample file $SAMPLE_SSL_FILE,"
    echo "| and update your configuration as needed."
    echo "+---------------"
    echo
}

do_config_install()
{
    install -o root -g wheel -m 644 $SAMPLE_CONFIG_FILE $CONFIG_FILE
    echo
    echo "+---------------"
    echo "| A $1 configuration file has been installed to:"
    echo "| $CONFIG_FILE.  Please view this file and"
    echo "| adjust it to suit your needs."
    echo "+---------------"
}
a41 1
    install -o root -g wheel -m 644 $SAMPLE_SSL_FILE $SSL_FILE
a72 6
	if [ ! -f $CONFIG_FILE ]; then
	    do_config_install $1
	else
	    do_config_notice $1
	fi
        if [ ! -f $SSL_FILE ]; then
a73 3
        else
            do_ssl_notice $1
        fi
@


1.3
log
@- initialize /var/dovecot/login via INSTALL to quell a warning about it
  not existing (and thus be created by dovecot itself)
- incorporate upstream patch which prevents some partial BODY[part]
  fetches from possibly returning data incorrectly
- bump PKGNAME
@
text
@d2 4
a5 1
# $OpenBSD: INSTALL,v 1.2 2003/07/23 06:03:01 jolan Exp $
d9 1
a9 1
CONFIG_FILE=${SYSCONFDIR}/dovecot.conf
d22 4
a25 2
  if groupinfo -e $DOVECOTGROUP; then
    echo "===> Using $DOVECOTGROUP group for dovecot"
d27 1
a27 1
    echo "===> Creating $DOVECOTGROUP group for dovecot"
d30 3
a32 2
  if userinfo -e $DOVECOTUSER; then
    echo "===> Using $DOVECOTUSER user for dovecot"
d34 1
a34 1
    echo "===> Creating $DOVECOTUSER user for dovecot"
a96 2
# verify proper execution
#
a101 2
# Verify/process the command
#
@


1.2
log
@incorporate megadiff from the author which allows mmaping of index data
on openbsd, related to pr/3291.  bump PKGNAME
@
text
@d2 1
a2 1
# $OpenBSD: INSTALL,v 1.1.1.1 2003/07/14 23:44:28 jolan Exp $
d12 1
d85 6
d115 3
@


1.2.2.1
log
@MFC:
upgrade to Dovecot 0.99.10.5

Dovecot 0.99.10.{4,5} fix some possible mail box corruption issues.
@
text
@d2 1
a2 1
# $OpenBSD: INSTALL,v 1.3 2003/11/05 03:42:06 jolan Exp $
a11 1
DOVECOTDIR=/var/dovecot
a83 6
do_var_install()
{
	install -d -o root -g wheel -m 700 $DOVECOTDIR
	install -d -o root -g $DOVECOTGROUP -m 750 $DOVECOTDIR/login
}

a107 3
	if [ ! -d $DOVECOTDIR ]; then
	    do_var_install
	fi
@


1.1
log
@Initial revision
@
text
@d2 1
a2 1
# $OpenBSD$
a17 1
  # Create Opennap user and group
@


1.1.1.1
log
@import of dovecot-0.99.10, an imap(s)/pop3(s) server.
@
text
@@
