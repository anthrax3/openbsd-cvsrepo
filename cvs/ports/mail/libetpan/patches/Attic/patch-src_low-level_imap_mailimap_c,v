head	1.2;
access;
symbols
	OPENBSD_4_3:1.1.0.4
	OPENBSD_4_3_BASE:1.1
	OPENBSD_4_2:1.1.0.2
	OPENBSD_4_2_BASE:1.1;
locks; strict;
comment	@# @;


1.2
date	2008.04.23.21.01.04;	author landry;	state dead;
branches;
next	1.1;

1.1
date	2007.05.04.23.33.05;	author deanna;	state Exp;
branches;
next	;


desc
@@


1.2
log
@Update to libetpan 0.54, from maintainer Ulrich Kahl
With tweaks by myself and feedback from ajacoutot@@

ok ajacoutot@@ pyr@@
@
text
@$OpenBSD: patch-src_low-level_imap_mailimap_c,v 1.1 2007/05/04 23:33:05 deanna Exp $
--- src/low-level/imap/mailimap.c.orig	Tue Apr 17 00:23:20 2007
+++ src/low-level/imap/mailimap.c	Tue Apr 17 00:25:52 2007
@@@@ -2458,18 +2458,22 @@@@ static int parse_greeting(mailimap * session,
   greeting_store(session, greeting);
 
   if (greeting->gr_type == MAILIMAP_GREETING_RESP_COND_BYE) {
-    if (mmap_string_assign(session->imap_response_buffer,
-            greeting->gr_data.gr_bye->rsp_text->rsp_text) == NULL)
-      return MAILIMAP_ERROR_MEMORY;
+    if (greeting->gr_data.gr_bye->rsp_text->rsp_text != NULL) {
+      if (mmap_string_assign(session->imap_response_buffer,
+              greeting->gr_data.gr_bye->rsp_text->rsp_text) == NULL)
+        return MAILIMAP_ERROR_MEMORY;
+    }
 
     session->imap_response = session->imap_response_buffer->str;
     
     return MAILIMAP_ERROR_DONT_ACCEPT_CONNECTION;
   }
 
-  if (mmap_string_assign(session->imap_response_buffer,
-          greeting->gr_data.gr_auth->rsp_text->rsp_text) == NULL)
-    return MAILIMAP_ERROR_MEMORY;
+  if (greeting->gr_data.gr_auth->rsp_text->rsp_text != NULL) {
+    if (mmap_string_assign(session->imap_response_buffer,
+            greeting->gr_data.gr_auth->rsp_text->rsp_text) == NULL)
+      return MAILIMAP_ERROR_MEMORY;
+  }
 
   session->imap_response = session->imap_response_buffer->str;
 
@


1.1
log
@Fix an imap crash with a patch from libetpan CVS.

From brad, ok ckuethe.
@
text
@d1 1
a1 1
$OpenBSD$
@

