head	1.1;
access;
symbols
	OPENBSD_6_1:1.1.0.2;
locks; strict;
comment	@# @;


1.1
date	2017.05.17.07.31.20;	author pirofti;	state dead;
branches
	1.1.2.1;
next	;
commitid	CiKRuINZWmLPHv0T;

1.1.2.1
date	2017.05.17.07.31.20;	author pirofti;	state Exp;
branches;
next	;
commitid	CiKRuINZWmLPHv0T;


desc
@@


1.1
log
@file patch-src_low-level_imf_mailimf_c was initially added on branch OPENBSD_6_1.
@
text
@@


1.1.2.1
log
@Backport net/libetpan CVE-2017-8825 fix from danj@@.

OK danj@@, jca@@.
@
text
@a0 32
$OpenBSD$

Fix CVE-2017-8825 null dereference vulnerability in MIME handling

--- src/low-level/imf/mailimf.c.orig	Thu May 26 08:27:47 2016
+++ src/low-level/imf/mailimf.c	Tue May 16 19:17:24 2017
@@@@ -3083,6 +3083,7 @@@@ static int mailimf_group_parse(const char * message, s
   struct mailimf_group * group;
   int r;
   int res;
+  clist * list;
 
   cur_token = * indx;
 
@@@@ -3108,6 +3109,17 @@@@ static int mailimf_group_parse(const char * message, s
     r = mailimf_cfws_parse(message, length, &cur_token);
     if ((r != MAILIMF_NO_ERROR) && (r != MAILIMF_ERROR_PARSE)) {
       res = r;
+      goto free_display_name;
+    }
+    list = clist_new();
+    if (list == NULL) {
+      res = MAILIMF_ERROR_MEMORY;
+      goto free_display_name;
+    }
+    mailbox_list = mailimf_mailbox_list_new(list);
+    if (mailbox_list == NULL) {
+      res = MAILIMF_ERROR_MEMORY;
+      clist_free(list);
       goto free_display_name;
     }
     break;
@

