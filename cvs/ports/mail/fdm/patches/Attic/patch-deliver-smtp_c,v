head	1.2;
access;
symbols
	OPENBSD_5_3:1.1.0.4
	OPENBSD_5_3_BASE:1.1
	OPENBSD_5_2:1.1.0.2
	OPENBSD_5_2_BASE:1.1;
locks; strict;
comment	@# @;


1.2
date	2013.03.06.15.12.03;	author benoit;	state dead;
branches;
next	1.1;

1.1
date	2012.03.22.10.47.14;	author sthen;	state Exp;
branches;
next	;


desc
@@


1.2
log
@- update fdm to 1.7
- update patches and PLIST
- add pre-build

from Sergey Bronnikov, ok nicm@@ (maintainer)
@
text
@$OpenBSD: patch-deliver-smtp_c,v 1.1 2012/03/22 10:47:14 sthen Exp $

From r1.58 upstream: properly escape . when delivering to SMTP.

--- deliver-smtp.c.orig	Sun Dec 14 21:34:06 2008
+++ deliver-smtp.c	Wed Mar 21 22:59:50 2012
@@@@ -160,8 +160,11 @@@@ deliver_smtp_deliver(struct deliver_ctx *dctx, struct 
 				goto error;
 			line_init(m, &ptr, &len);
 			while (ptr != NULL) {
-				if (len > 1)
+				if (len > 1) {
+					if (*ptr == '.')
+						io_write(io, ".", 1);
 					io_write(io, ptr, len - 1);
+				}
 				io_writeline(io, NULL);
 
 				/* Update if necessary. */
@


1.1
log
@Add a patch to fdm to escape . in SMTP delivery as per RFC2821.
From nicm's repo, which is a better fix than my original diff.  OK nicm@@
@
text
@d1 1
a1 1
$OpenBSD$
@

