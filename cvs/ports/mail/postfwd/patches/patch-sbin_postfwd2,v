head	1.2;
access;
symbols
	OPENBSD_6_0:1.2.0.14
	OPENBSD_6_0_BASE:1.2
	OPENBSD_5_9:1.2.0.10
	OPENBSD_5_9_BASE:1.2
	OPENBSD_5_8:1.2.0.12
	OPENBSD_5_8_BASE:1.2
	OPENBSD_5_7:1.2.0.8
	OPENBSD_5_7_BASE:1.2
	OPENBSD_5_6:1.2.0.6
	OPENBSD_5_6_BASE:1.2
	OPENBSD_5_5:1.2.0.4
	OPENBSD_5_5_BASE:1.2
	OPENBSD_5_4:1.2.0.2
	OPENBSD_5_4_BASE:1.2;
locks; strict;
comment	@# @;


1.2
date	2013.07.18.08.48.01;	author giovanni;	state Exp;
branches;
next	1.1;

1.1
date	2013.07.17.07.36.06;	author giovanni;	state Exp;
branches;
next	;


desc
@@


1.2
log
@
Fix rc scripts for real and put pid where it belongs
ok william@@ ajacoutot@@
@
text
@$OpenBSD: patch-sbin_postfwd2,v 1.1 2013/07/17 07:36:06 giovanni Exp $
--- sbin/postfwd2.orig	Thu Apr 18 22:31:27 2013
+++ sbin/postfwd2	Wed Jul 17 14:37:37 2013
@@@@ -61,7 +61,7 @@@@ our %postfwd_settings = (
 		umask		 => "0177",
 	},
 	master => {
-		pid_file         => "/var/tmp/$NAME-master.pid",
+		pid_file         => "/var/run/$NAME-master.pid",
 		watchdog	 => 60,
 		failures	 => 7,
 		respawn		 => 4,
@


1.1
log
@
Fix stop and reload case in rc script.
with and ok william@@
@
text
@d1 12
a12 11
$OpenBSD$
--- sbin/postfwd2.orig	Tue Jul 16 09:50:25 2013
+++ sbin/postfwd2	Tue Jul 16 09:51:58 2013
@@@@ -3167,6 +3167,7 @@@@ map { $postfwd_settings{$_}{check} = ($postfwd_setting
 # terminate at -k or --kill
 if (defined $options{'term'}) {
 	kill "TERM", get_master_pid();
+        unlink $postfwd_settings{master}{pid_file} if (-T $postfwd_settings{master}{pid_file});
 	exit (0);
 # reload at --reload
 } elsif (defined $options{'hup'}) {
@

