head	1.2;
access;
symbols
	OPENBSD_5_9:1.1.0.4
	OPENBSD_5_9_BASE:1.1
	OPENBSD_5_8:1.1.0.2;
locks; strict;
comment	@# @;


1.2
date	2016.03.01.05.18.57;	author mmcc;	state dead;
branches;
next	1.1;
commitid	1zAe5O40N5nHsXJO;

1.1
date	2015.11.04.17.51.18;	author jca;	state Exp;
branches
	1.1.2.1;
next	;
commitid	HOxenDySmscXBqRF;

1.1.2.1
date	2015.11.27.01.53.02;	author mmcc;	state Exp;
branches;
next	;
commitid	HjXJLLZhIhNLSBR0;


desc
@@


1.2
log
@update to mail/imapfilter 2.6.6

ok jturner@@
@
text
@$OpenBSD: patch-src_socket_c,v 1.1 2015/11/04 17:51:18 jca Exp $

Cope with SSLv3 removal.

--- src/socket.c.orig	Wed Sep 30 22:55:26 2015
+++ src/socket.c	Mon Nov  2 22:47:35 2015
@@@@ -16,8 +16,10 @@@@
 #include "imapfilter.h"
 #include "session.h"
 
-
-SSL_CTX *ssl3ctx, *ssl23ctx, *tls1ctx;
+SSL_CTX *ssl23ctx, *tls1ctx;
+#ifndef OPENSSL_NO_SSL3_METHOD
+SSL_CTX *ssl3ctx;
+#endif
 #if OPENSSL_VERSION_NUMBER >= 0x01000100fL
 SSL_CTX *tls11ctx, *tls12ctx;
 #endif
@@@@ -95,7 +97,12 @@@@ open_secure_connection(session *ssn)
 	if (!ssn->sslproto) {
 		ctx = ssl23ctx;
 	} else if (!strcasecmp(ssn->sslproto, "ssl3")) {
+#ifndef OPENSSL_NO_SSL3_METHOD
 		ctx = ssl3ctx;
+#else
+		error("protocol SSLv3 not supported\n");
+		goto fail;
+#endif
 	} else if (!strcasecmp(ssn->sslproto, "tls1")) {
 		ctx = tls1ctx;
 	} else if (!strcasecmp(ssn->sslproto, "tls1.1")) {
@


1.1
log
@Update to imapfilter-2.6.3, adapt SSLv3 patches.

Initial diff from mmcc@@, ok mpi@@ sthen@@
@
text
@d1 1
a1 1
$OpenBSD$
@


1.1.2.1
log
@Update from 2.6.1 to 2.6.3. This fixes a bug that makes cert mismatches
non-fatal:

https://github.com/lefcha/imapfilter/commit/0526dee062c28257a14f2ed7afca49a9a384e4aa

Also fixes the system cert location bug.   ok jca@@
@
text
@d1 1
a1 1
$OpenBSD: patch-src_socket_c,v 1.1 2015/11/04 17:51:18 jca Exp $
@

