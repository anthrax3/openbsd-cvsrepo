head	1.2;
access;
symbols
	OPENBSD_3_7:1.1.0.6
	OPENBSD_3_7_BASE:1.1
	OPENBSD_3_5:1.1.0.4
	OPENBSD_3_6:1.1.0.2;
locks; strict;
comment	@# @;


1.2
date	2005.06.23.07.34.56;	author djm;	state dead;
branches;
next	1.1;

1.1
date	2005.02.10.14.58.06;	author jakob;	state Exp;
branches
	1.1.2.1
	1.1.4.1;
next	;

1.1.2.1
date	2005.02.12.12.07.38;	author robert;	state Exp;
branches;
next	;

1.1.4.1
date	2005.02.12.12.08.37;	author robert;	state Exp;
branches;
next	;


desc
@@


1.2
log
@mailman-2.16; ok jakob@@
@
text
@$OpenBSD: patch-Mailman_Cgi_private_py,v 1.1 2005/02/10 14:58:06 jakob Exp $
--- Mailman/Cgi/private.py.orig	Sat Feb  8 08:13:50 2003
+++ Mailman/Cgi/private.py	Thu Feb 10 15:50:22 2005
@@@@ -1,4 +1,4 @@@@
-# Copyright (C) 1998-2003 by the Free Software Foundation, Inc.
+# Copyright (C) 1998-2005 by the Free Software Foundation, Inc.
 #
 # This program is free software; you can redistribute it and/or
 # modify it under the terms of the GNU General Public License
@@@@ -35,13 +35,17 @@@@ from Mailman.Logging.Syslog import syslo
 _ = i18n._
 i18n.set_language(mm_cfg.DEFAULT_SERVER_LANGUAGE)
 
+SLASH = '/'
 
+
 
 def true_path(path):
     "Ensure that the path is safe by removing .."
-    path = path.replace('../', '')
-    path = path.replace('./', '')
-    return path[1:]
+    parts = path.split(SLASH)
+    safe = [x for x in parts if x not in ('.', '..')]
+    if parts <> safe:
+        syslog('mischief', 'Directory traversal attack thwarted')
+    return SLASH.join(safe)[1:]
 
 
 
@


1.1
log
@critical security update (CAN-2005-0202)
@
text
@d1 1
a1 1
$OpenBSD$
@


1.1.4.1
log
@SECURITY:
fix a directory traversal vulnerability
http://www.vuxml.org/openbsd/b735b5b2-7b7c-11d9-b18e-080020fe8945.html

ok brad@@
@
text
@@


1.1.2.1
log
@SECURITY:
fix a directory traversal vulnerability
http://www.vuxml.org/openbsd/b735b5b2-7b7c-11d9-b18e-080020fe8945.html

ok brad@@
@
text
@@

