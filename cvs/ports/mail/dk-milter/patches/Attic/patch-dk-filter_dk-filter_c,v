head	1.2;
access;
symbols
	OPENBSD_4_2:1.1.1.1.0.6
	OPENBSD_4_2_BASE:1.1.1.1
	OPENBSD_4_1:1.1.1.1.0.4
	OPENBSD_4_1_BASE:1.1.1.1
	OPENBSD_4_0:1.1.1.1.0.2
	OPENBSD_4_0_BASE:1.1.1.1
	jakob_20060731:1.1.1.1
	jakob:1.1.1;
locks; strict;
comment	@# @;


1.2
date	2007.11.19.07.10.08;	author jakob;	state dead;
branches;
next	1.1;

1.1
date	2006.07.31.12.35.07;	author jakob;	state Exp;
branches
	1.1.1.1;
next	;

1.1.1.1
date	2006.07.31.12.35.07;	author jakob;	state Exp;
branches;
next	;


desc
@@


1.2
log
@bye bye historical port
@
text
@$OpenBSD: patch-dk-filter_dk-filter_c,v 1.1 2006/07/31 12:35:07 jakob Exp $
--- dk-filter/dk-filter.c.orig	Fri May 19 23:42:05 2006
+++ dk-filter/dk-filter.c	Tue Jun 20 09:03:16 2006
@@@@ -2782,7 +2782,7 @@@@ main(int argc, char **argv)
 	const char *args = CMDLINEOPTS;
 	FILE *f;
 	char *be = NULL;
-	char *become = NULL;
+	char *become = "_dk-milter";
 	char *domlist = NULL;
 	char *mtalist = NULL;
 	char *p;
@@@@ -3492,6 +3492,20 @@@@ main(int argc, char **argv)
 		}
 
 		(void) endpwent();
+
+		if (setgid(pw->pw_gid) != 0)
+		{
+			if (dolog)
+			{
+				syslog(LOG_ERR, "setgid(): %s",
+				       strerror(errno));
+			}
+
+			fprintf(stderr, "%s: setgid(): %s\n", progname,
+			        strerror(errno));
+
+			return EX_NOPERM;
+		}
 
 		if (setuid(pw->pw_uid) != 0)
 		{
@


1.1
log
@Initial revision
@
text
@d1 1
a1 1
$OpenBSD$
@


1.1.1.1
log
@The dk-milter package is an open source implementation of the DomainKeys
sender authentication system proposed by Yahoo!, Inc.
@
text
@@
