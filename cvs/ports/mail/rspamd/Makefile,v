head	1.39;
access;
symbols
	OPENBSD_6_1:1.31.0.2
	OPENBSD_6_1_BASE:1.31
	OPENBSD_6_0:1.19.0.2
	OPENBSD_6_0_BASE:1.19
	OPENBSD_5_9:1.11.0.2
	OPENBSD_5_9_BASE:1.11
	sthen_20151009:1.1.1.1
	sthen:1.1.1;
locks; strict;
comment	@# @;


1.39
date	2017.07.09.07.47.10;	author landry;	state Exp;
branches;
next	1.38;
commitid	wMMBOI81B4bHWHSp;

1.38
date	2017.06.29.12.00.38;	author landry;	state Exp;
branches;
next	1.37;
commitid	5KSyJP24XoB3YuqV;

1.37
date	2017.05.28.09.35.26;	author jasper;	state Exp;
branches;
next	1.36;
commitid	Rz76LTHEJ0zOIkj9;

1.36
date	2017.05.17.13.30.05;	author sthen;	state Exp;
branches;
next	1.35;
commitid	shwhowag5XlS1rPL;

1.35
date	2017.05.05.08.58.01;	author sthen;	state Exp;
branches;
next	1.34;
commitid	gnEvRNxqNRwd83PC;

1.34
date	2017.04.22.10.50.22;	author sthen;	state Exp;
branches;
next	1.33;
commitid	WMNqjz428yP3zC7Q;

1.33
date	2017.04.13.09.36.36;	author sthen;	state Exp;
branches;
next	1.32;
commitid	4RbB02X2fB6y1qXd;

1.32
date	2017.04.04.20.52.13;	author sthen;	state Exp;
branches;
next	1.31;
commitid	8BfNUw2AmR8HmZDh;

1.31
date	2017.03.18.15.02.14;	author sthen;	state Exp;
branches;
next	1.30;
commitid	HQNjmpqQVSzMub5i;

1.30
date	2017.03.08.17.02.13;	author sthen;	state Exp;
branches;
next	1.29;
commitid	A890MNPdF6wiuQcz;

1.29
date	2017.02.17.10.13.57;	author sthen;	state Exp;
branches;
next	1.28;
commitid	DPTjjtyHvvgVjd5Y;

1.28
date	2017.01.28.10.18.52;	author sthen;	state Exp;
branches;
next	1.27;
commitid	GYRRBQxx4aGAejLs;

1.27
date	2017.01.10.12.28.52;	author sthen;	state Exp;
branches;
next	1.26;
commitid	rG5Iv43zJaMBAo3z;

1.26
date	2016.12.02.15.19.42;	author sthen;	state Exp;
branches;
next	1.25;
commitid	jQTRBwly7or1dDHC;

1.25
date	2016.12.02.14.59.09;	author sthen;	state Exp;
branches;
next	1.24;
commitid	L2nb5nxOsjF5KTHZ;

1.24
date	2016.11.29.12.15.21;	author sthen;	state Exp;
branches;
next	1.23;
commitid	CNcHFEUk2EwYOptM;

1.23
date	2016.10.02.19.17.38;	author edd;	state Exp;
branches;
next	1.22;
commitid	wJ524DQXrFsKkokX;

1.22
date	2016.09.23.09.16.56;	author sthen;	state Exp;
branches;
next	1.21;
commitid	XLnI6AbHAmyVU5mO;

1.21
date	2016.09.12.09.48.37;	author edd;	state Exp;
branches;
next	1.20;
commitid	E7di75op8BYcIz2l;

1.20
date	2016.09.04.15.53.12;	author landry;	state Exp;
branches;
next	1.19;
commitid	dxSpFo8pyUflrBKX;

1.19
date	2016.06.25.12.33.46;	author sthen;	state Exp;
branches;
next	1.18;
commitid	e53RT2XdO4hNTkHe;

1.18
date	2016.06.13.12.05.58;	author naddy;	state Exp;
branches;
next	1.17;
commitid	9NRrTceE25VIYVuc;

1.17
date	2016.06.13.09.22.42;	author ajacoutot;	state Exp;
branches;
next	1.16;
commitid	48uKoEqY2UjYLvSu;

1.16
date	2016.05.27.09.18.14;	author sthen;	state Exp;
branches;
next	1.15;
commitid	GheqJMbHWIwZIxgU;

1.15
date	2016.03.18.23.12.18;	author naddy;	state Exp;
branches;
next	1.14;
commitid	KZAl4KEiw6a3Jixw;

1.14
date	2016.02.25.20.24.55;	author sthen;	state Exp;
branches;
next	1.13;
commitid	PJYEUKQdVwCK643G;

1.13
date	2016.02.25.16.04.54;	author landry;	state Exp;
branches;
next	1.12;
commitid	JqXYZHZleJIGhOM1;

1.12
date	2016.02.25.00.47.55;	author sthen;	state Exp;
branches;
next	1.11;
commitid	amDaCn6p3CbhFxiB;

1.11
date	2016.02.01.14.45.41;	author sthen;	state Exp;
branches;
next	1.10;
commitid	2ubQo3qYV7WQLNSy;

1.10
date	2016.01.22.13.32.31;	author sthen;	state Exp;
branches;
next	1.9;
commitid	3QOdfep8f5QUNdTU;

1.9
date	2016.01.19.01.14.51;	author sthen;	state Exp;
branches;
next	1.8;
commitid	iEGWVeykwJ99QWIT;

1.8
date	2016.01.16.10.39.59;	author ajacoutot;	state Exp;
branches;
next	1.7;
commitid	INxGjjEBsx9CKdFd;

1.7
date	2016.01.14.22.58.42;	author ajacoutot;	state Exp;
branches;
next	1.6;
commitid	IubyPaiU7CBaDBOP;

1.6
date	2015.12.29.20.50.30;	author sthen;	state Exp;
branches;
next	1.5;
commitid	KI9Qys64lMMOywpw;

1.5
date	2015.11.16.12.12.11;	author sthen;	state Exp;
branches;
next	1.4;
commitid	ZiySWJShRz4EC60h;

1.4
date	2015.11.16.12.10.20;	author sthen;	state Exp;
branches;
next	1.3;
commitid	qDg7J5qSIcLtuHzl;

1.3
date	2015.10.28.09.57.35;	author sthen;	state Exp;
branches;
next	1.2;
commitid	5SsvBRr3GPXSKrf8;

1.2
date	2015.10.17.19.35.51;	author sthen;	state Exp;
branches;
next	1.1;
commitid	BzkT4JHRdYvAHlS5;

1.1
date	2015.10.09.16.09.17;	author sthen;	state Exp;
branches
	1.1.1.1;
next	;
commitid	fTxmpHhud3V1d0SA;

1.1.1.1
date	2015.10.09.16.09.17;	author sthen;	state Exp;
branches;
next	;
commitid	fTxmpHhud3V1d0SA;


desc
@@


1.39
log
@Update to rspamd 1.6.2, from 'Akai'

See https://github.com/vstakhov/rspamd/releases/tag/1.6.2
@
text
@# $OpenBSD: Makefile,v 1.38 2017/06/29 12:00:38 landry Exp $

COMMENT=	event-driven spam filtering system in C/Lua

GH_ACCOUNT=	vstakhov
GH_PROJECT=	rspamd
GH_TAGNAME=	1.6.2

CATEGORIES=	mail

HOMEPAGE=	https://rspamd.com/

# Apache License 2.0
PERMIT_PACKAGE_CDROM=	Yes

WANTLIB += c crypto event fann glib-2.0 gthread-2.0 icudata icui18n icuuc
WANTLIB += intl luajit-5.1 m magic pcre pthread sqlite3 ssl

MODULES=	devel/cmake
LIB_DEPENDS=	databases/sqlite3 \
		devel/libmagic \
		devel/gettext \
		devel/glib2 \
		devel/pcre \
		lang/luajit \
		math/fann \
		textproc/icu4c
BUILD_DEPENDS +=devel/ragel
# /var/rspamd needs to exist for tests to run
TEST_DEPENDS = ${FULLPKGNAME}:${FULLPKGPATH}
TEST_DEPENDS +=	databases/redis \
		sysutils/py-psutil \
		textproc/py-demjson \
		devel/py-robotframework

CONFIGURE_ARGS+=-DOPENBSD_BUILD=1 \
		-DCMAKE_C_OPT_FLAGS="${CFLAGS}" \
		-DCONFDIR="${SYSCONFDIR}/rspamd" \
		-DDBDIR="${LOCALSTATEDIR}/rspamd" \
		-DLOGDIR="${LOCALSTATEDIR}/log/rspamd" \
		-DMANDIR="${PREFIX}/man" \
		-DRUNDIR="${LOCALSTATEDIR}/run/rspamd" \
		-DRSPAMD_USER="_rspamd" \
		-DRSPAMD_GROUP="_rspamd"

# Make sure we pick up the base libevent, never the ports one!
CONFIGURE_ARGS +=	-DLIBEVENT_ROOT_DIR=/usr
# Make sure you have no rspamd or redis instances running and note that the
# test suite uses the network.
#
# In the event of failing tests, look at log.html in ${WRKSRC}
do-test:
	cd ${WRKSRC} && \
		env RSPAMADM=${WRKBUILD}/src/rspamadm/rspamadm \
		RSPAMC=${WRKBUILD}/src/client/rspamc \
		RSPAMD=/usr/local/bin/rspamd \
		${LOCALBASE}/bin/robot \
		test/functional/cases

# no trailing crlf
post-extract:
	for i in hiredis http-parser lc-btrie libottery; do \
	    echo >> ${WRKSRC}/contrib/$$i/CMakeLists.txt; done

pre-configure:
	${SUBST_CMD} ${WRKSRC}/interface/README.md

post-install:
	${INSTALL_DATA_DIR} ${PREFIX}/share/examples/rspamd
	mv ${WRKINST}${SYSCONFDIR}/rspamd/* ${PREFIX}/share/examples/rspamd
	rm ${PREFIX}/share/rspamd/www/README.md.{beforesubst,orig}

.include <bsd.port.mk>
@


1.38
log
@Update to rspamd 1.6.1.

rmilter support is now deprecated, see
https://rspamd.com/announce/2017/06/12/rspamd-1.6.0.html. Drop gd
dependency following upstream.

ok sthen@@
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.37 2017/05/28 09:35:26 jasper Exp $
d7 1
a7 1
GH_TAGNAME=	1.6.1
@


1.37
log
@update to rspamd-1.5.8

ok sthen@@
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.36 2017/05/17 13:30:05 sthen Exp $
d7 1
a7 1
GH_TAGNAME=	1.5.8
d16 1
a16 1
WANTLIB += c crypto event fann gd glib-2.0 gthread-2.0 icudata icui18n icuuc
a24 1
		graphics/gd \
@


1.36
log
@fix @@sample filename:

 share/examples/rspamd/redirectors.inc
-@@sample ${SYSCONFDIR}/rspamd/redirections.inc
+@@sample ${SYSCONFDIR}/rspamd/redirectors.inc
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.35 2017/05/05 08:58:01 sthen Exp $
d7 1
a7 2
GH_TAGNAME=	1.5.7
REVISION=	0
@


1.35
log
@update to rspamd-1.5.7, upstream switched to github for distfiles
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.34 2017/04/22 10:50:22 sthen Exp $
d8 1
@


1.34
log
@Update to rspamd-1.5.6, same diff me and Brad.
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.33 2017/04/13 09:36:36 sthen Exp $
d5 3
a7 2
DISTNAME=	rspamd-1.5.6
EXTRACT_SUFX=	.tar.xz
a17 2

MASTER_SITES=	https://rspamd.com/downloads/
@


1.33
log
@update to rspamd-1.5.5, from Brad
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.32 2017/04/04 20:52:13 sthen Exp $
d5 1
a5 1
DISTNAME=	rspamd-1.5.5
@


1.32
log
@update to rspamd-1.5.4, from Brad
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.31 2017/03/18 15:02:14 sthen Exp $
d5 1
a5 1
DISTNAME=	rspamd-1.5.4
@


1.31
log
@update to rspamd-1.5.3, from Brad
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.30 2017/03/08 17:02:13 sthen Exp $
d5 1
a5 1
DISTNAME=	rspamd-1.5.3
@


1.30
log
@update to rspamd-1.5.2, from Brad
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.29 2017/02/17 10:13:57 sthen Exp $
d5 1
a5 1
DISTNAME=	rspamd-1.5.2
@


1.29
log
@update to rspamd-1.4.4, from Brad
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.28 2017/01/28 10:18:52 sthen Exp $
d5 1
a5 1
DISTNAME=	rspamd-1.4.4
d15 2
a16 2
WANTLIB += c crypto event gio-2.0 glib-2.0 gmime-2.6 gmodule-2.0 gobject-2.0
WANTLIB += luajit-5.1 m magic pcre pthread sqlite3 ssl
d20 1
a20 2
MODULES=	devel/cmake \
		devel/gettext
d23 1
d26 1
d28 2
a29 1
		mail/gmime
@


1.28
log
@update to rspamd-1.4.3, from Brad.
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.27 2017/01/10 12:28:52 sthen Exp $
d5 1
a5 1
DISTNAME=	rspamd-1.4.3
@


1.27
log
@update to rspamd-1.4.2, from Brad
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.26 2016/12/02 15:19:42 sthen Exp $
d5 1
a5 1
DISTNAME=	rspamd-1.4.2
@


1.26
log
@get rid of some forced -O3
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.25 2016/12/02 14:59:09 sthen Exp $
d5 1
a5 2
DISTNAME=	rspamd-1.4.1
REVISION=	0
@


1.25
log
@update to rspamd-1.4.1
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.24 2016/11/29 12:15:21 sthen Exp $
d5 2
a6 1
DISTNAME =	rspamd-1.4.1
d38 1
d60 5
@


1.24
log
@update to rspamd-1.4.0, from Brad
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.23 2016/10/02 19:17:38 edd Exp $
d5 1
a5 1
DISTNAME =	rspamd-1.4.0
@


1.23
log
@mail/rspamd: Backport some patches to fix two crashes I encountered.

OK jca@@
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.22 2016/09/23 09:16:56 sthen Exp $
d5 1
a5 2
DISTNAME =	rspamd-1.3.5
REVISION =	0
a6 1
REVISION =	0
@


1.22
log
@Cope with moving sqlite3 back to ports.
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.21 2016/09/12 09:48:37 edd Exp $
d6 1
@


1.21
log
@Update to rspamd-1.3.5.

Also use the robot test suite, now that all of the dependencies are ported.

Thanks to upstream for working with us to get this working smoothly on OpenBSD.

Input from sthen@@ and giovanni@@, tested by giovanni@@ and gilles@@.

OK giovanni@@, thanks.
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.20 2016/09/04 15:53:12 landry Exp $
d7 1
d23 2
a24 1
LIB_DEPENDS=	devel/libmagic \
@


1.20
log
@Remove BROKEN-macppc marker, it now builds fine there.

The cpuid rdrand runtime detection asm code was guarded for x86 only in
https://github.com/vstakhov/rspamd/commit/3ed4cae07ea2adfea3fe5eb4070dcf59f9e11f5d
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.19 2016/06/25 12:33:46 sthen Exp $
d5 1
a5 1
DISTNAME=	rspamd-1.2.8
d27 7
d44 13
a56 5
# XXX Known problems:
# - tests currently need clang as an assembler due to use of AVX.
# - if aio test is run after dns test, it hangs:
# ${WRKBUILD}/test/rspamd-test -p /rspamd/aio -p /rspamd/dns     
TEST_TARGET=	run-test
@


1.19
log
@update to rspamd-1.2.8, from Brad
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.18 2016/06/13 12:05:58 naddy Exp $
a2 1
BROKEN-macppc=	error: unknown register name 'edx' in 'asm'
@


1.18
log
@no more devel/gmime subpackages
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.17 2016/06/13 09:22:42 ajacoutot Exp $
d6 1
a6 1
DISTNAME=	rspamd-1.2.7
a7 1
REVISION=	0
@


1.17
log
@Bump after the devel/gmime mono subpackage removal.
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.16 2016/05/27 09:18:14 sthen Exp $
d28 1
a28 1
		mail/gmime,-main
@


1.16
log
@update to rspamd-1.2.7, from Brad
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.15 2016/03/18 23:12:18 naddy Exp $
d8 1
@


1.15
log
@remove SHARED_ONLY from ports that only use modules that neither set nor
read this variable
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.14 2016/02/25 20:24:55 sthen Exp $
d6 1
a6 1
DISTNAME=	rspamd-1.1.4
d16 1
a16 1
WANTLIB += c crypto event gio-2.0 glib-2.0 gmime-2.6 gobject-2.0
@


1.14
log
@license is now Apache 2.0; update marker
@
text
@d1 1
a1 3
# $OpenBSD: Makefile,v 1.13 2016/02/25 16:04:54 landry Exp $

SHARED_ONLY=	Yes
@


1.13
log
@BROKEN-macppc= error: unknown register name 'edx' in 'asm'
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.12 2016/02/25 00:47:55 sthen Exp $
d15 1
a15 1
# BSD
@


1.12
log
@update to rspamd-1.1.4
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.11 2016/02/01 14:45:41 sthen Exp $
d5 1
@


1.11
log
@update to rspamd-1.1.2
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.10 2016/01/22 13:32:31 sthen Exp $
d7 1
a7 1
DISTNAME=	rspamd-1.1.2
@


1.10
log
@update to rspamd-1.1.1, from Brad
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.9 2016/01/19 01:14:51 sthen Exp $
d7 1
a7 1
DISTNAME=	rspamd-1.1.1
d51 1
@


1.9
log
@update to rspamd 1.1.0, from Brad.
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.8 2016/01/16 10:39:59 ajacoutot Exp $
d7 1
a7 1
DISTNAME=	rspamd-1.1.0
@


1.8
log
@Install /var/run/rspamd in rc_pre().

from Brad
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.7 2016/01/14 22:58:42 ajacoutot Exp $
d7 1
a7 1
DISTNAME=	rspamd-1.0.11
a8 1
REVISION=	1
d18 1
a18 1
WANTLIB += hiredis luajit-5.1 m pcre pthread sqlite3 ssl
d24 1
a24 1
LIB_DEPENDS=	databases/libhiredis \
@


1.7
log
@Don;'t @@sample stuffs under /var/run; it gets removed at boot time.
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.6 2015/12/29 20:50:30 sthen Exp $
d9 1
a9 1
REVISION=	0
@


1.6
log
@update to rspamd-1.0.11, from Brad
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.5 2015/11/16 12:12:11 sthen Exp $
d9 1
@


1.5
log
@add notes about known problems seen in tests
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.4 2015/11/16 12:10:20 sthen Exp $
d7 1
a7 1
DISTNAME=	rspamd-1.0.10
@


1.4
log
@update to rspamd-1.0.10, from Brad
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.3 2015/10/28 09:57:35 sthen Exp $
d39 4
@


1.3
log
@update to rspamd-1.0.9
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.2 2015/10/17 19:35:51 sthen Exp $
d7 1
a7 1
DISTNAME=	rspamd-1.0.9
@


1.2
log
@update to rspamd-1.0.6, from Brad
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.1.1.1 2015/10/09 16:09:17 sthen Exp $
d7 1
a7 1
DISTNAME=	rspamd-1.0.6
@


1.1
log
@Initial revision
@
text
@d1 1
a1 1
# $OpenBSD$
d7 1
a7 1
DISTNAME=	rspamd-1.0.4
@


1.1.1.1
log
@import ports/mail/rspamd, joint work with brad - not yet perfect, but in
good enough shape to continue in tree.  tweak/ok giovanni@@.

Rspamd is an advanced spam filtering system that allows evaluation of messages
by a number of rules including regular expressions, statistical analysis and
custom services such as URL black lists. Each message is analysed by rspamd and
given a spam score.

According to this spam score and the user's settings rspamd recommends an action
for the MTA to apply to the message- for example to pass, reject or add a
header. Rspamd is designed to process hundreds of messages per second
simultaneously and has a number of features available.
@
text
@@
