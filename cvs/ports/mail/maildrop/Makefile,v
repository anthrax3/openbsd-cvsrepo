head	1.66;
access;
symbols
	OPENBSD_6_1:1.56.0.2
	OPENBSD_6_1_BASE:1.56
	OPENBSD_6_0:1.54.0.2
	OPENBSD_6_0_BASE:1.54
	OPENBSD_5_9:1.53.0.2
	OPENBSD_5_9_BASE:1.53
	OPENBSD_5_8:1.52.0.4
	OPENBSD_5_8_BASE:1.52
	OPENBSD_5_7:1.51.0.2
	OPENBSD_5_7_BASE:1.51
	OPENBSD_5_6:1.49.0.2
	OPENBSD_5_6_BASE:1.49
	OPENBSD_5_5:1.48.0.2
	OPENBSD_5_5_BASE:1.48
	OPENBSD_5_4:1.44.0.2
	OPENBSD_5_4_BASE:1.44
	OPENBSD_5_3:1.43.0.2
	OPENBSD_5_3_BASE:1.43
	OPENBSD_5_2:1.41.0.4
	OPENBSD_5_2_BASE:1.41
	OPENBSD_5_1_BASE:1.41
	OPENBSD_5_1:1.41.0.2
	OPENBSD_5_0:1.40.0.2
	OPENBSD_5_0_BASE:1.40
	OPENBSD_4_9:1.38.0.2
	OPENBSD_4_9_BASE:1.38
	OPENBSD_4_8:1.34.0.2
	OPENBSD_4_8_BASE:1.34
	OPENBSD_4_7:1.31.0.2
	OPENBSD_4_7_BASE:1.31
	OPENBSD_4_6:1.26.0.6
	OPENBSD_4_6_BASE:1.26
	OPENBSD_4_5:1.26.0.4
	OPENBSD_4_5_BASE:1.26
	OPENBSD_4_4:1.26.0.2
	OPENBSD_4_4_BASE:1.26
	OPENBSD_4_3:1.25.0.2
	OPENBSD_4_3_BASE:1.25
	OPENBSD_4_2:1.24.0.4
	OPENBSD_4_2_BASE:1.24
	OPENBSD_4_1:1.24.0.2
	OPENBSD_4_1_BASE:1.24
	OPENBSD_4_0:1.19.0.2
	OPENBSD_4_0_BASE:1.19
	OPENBSD_3_9:1.18.0.4
	OPENBSD_3_9_BASE:1.18
	OPENBSD_3_8:1.18.0.2
	OPENBSD_3_8_BASE:1.18
	OPENBSD_3_7:1.15.0.2
	OPENBSD_3_7_BASE:1.15
	OPENBSD_3_6:1.13.0.6
	OPENBSD_3_6_BASE:1.13
	OPENBSD_3_5:1.13.0.4
	OPENBSD_3_5_BASE:1.13
	OPENBSD_3_4:1.13.0.2
	OPENBSD_3_4_BASE:1.13
	OPENBSD_3_3:1.11.0.2
	OPENBSD_3_3_BASE:1.11
	OPENBSD_3_2:1.10.0.2
	OPENBSD_3_2_BASE:1.10
	OPENBSD_3_1:1.8.0.4
	OPENBSD_3_1_BASE:1.8
	OPENBSD_3_0:1.8.0.2
	OPENBSD_3_0_BASE:1.8
	OPENBSD_2_9_TRACKING_SWITCH:1.7
	OPENBSD_2_9:1.5.0.2
	OPENBSD_2_9_BASE:1.5
	OPENBSD_2_8:1.1.1.1.0.2
	OPENBSD_2_8_BASE:1.1.1.1
	avsm_2000-Oct-09:1.1.1.1
	avsm:1.1.1;
locks; strict;
comment	@# @;


1.66
date	2017.09.29.19.32.18;	author naddy;	state Exp;
branches;
next	1.65;
commitid	eHEZ1OtSjDJbw5Lz;

1.65
date	2017.09.29.16.54.24;	author ajacoutot;	state Exp;
branches;
next	1.64;
commitid	5v31CR2lU7ODdWSS;

1.64
date	2017.09.27.13.20.02;	author giovanni;	state Exp;
branches;
next	1.63;
commitid	zyTvd13DcDW7CCQy;

1.63
date	2017.09.26.17.37.51;	author giovanni;	state Exp;
branches;
next	1.62;
commitid	X1dKVPedndKr1CNM;

1.62
date	2017.08.04.23.17.27;	author giovanni;	state Exp;
branches;
next	1.61;
commitid	uYrtGaGo25N0u9yr;

1.61
date	2017.07.26.22.45.26;	author sthen;	state Exp;
branches;
next	1.60;
commitid	tD4MFrpYYDDL2UFT;

1.60
date	2017.07.23.09.26.28;	author espie;	state Exp;
branches;
next	1.59;
commitid	FZPR2Emws5uDqXzb;

1.59
date	2017.07.16.19.18.59;	author espie;	state Exp;
branches;
next	1.58;
commitid	tt0GhWK5c4uf9ILG;

1.58
date	2017.06.02.08.56.32;	author schwarze;	state Exp;
branches;
next	1.57;
commitid	AhsDVcSXbPx6AHfy;

1.57
date	2017.04.10.11.46.22;	author sthen;	state Exp;
branches;
next	1.56;
commitid	BLsh88fJB8thZTwY;

1.56
date	2017.02.09.14.47.43;	author giovanni;	state Exp;
branches;
next	1.55;
commitid	5bpYyBWbFGFiGvdc;

1.55
date	2016.09.02.09.19.36;	author giovanni;	state Exp;
branches;
next	1.54;
commitid	5ycUwagI5Uc7mjXy;

1.54
date	2016.05.30.19.09.18;	author jasper;	state Exp;
branches;
next	1.53;
commitid	FK1W7j9UC7xFRQGZ;

1.53
date	2015.08.27.09.35.16;	author giovanni;	state Exp;
branches;
next	1.52;
commitid	FgYnAlMKF6a51ZY1;

1.52
date	2015.04.28.07.24.43;	author giovanni;	state Exp;
branches;
next	1.51;
commitid	qH3w9dzgAgANPmAo;

1.51
date	2014.11.22.22.20.09;	author sthen;	state Exp;
branches;
next	1.50;
commitid	ztGcFPtTGv2pmfvI;

1.50
date	2014.11.20.19.26.34;	author sthen;	state Exp;
branches;
next	1.49;
commitid	YFacFHxcuXu9mnDu;

1.49
date	2014.06.05.21.04.51;	author giovanni;	state Exp;
branches;
next	1.48;
commitid	xjDUpxYFqHop8Shi;

1.48
date	2013.11.07.07.09.00;	author ajacoutot;	state Exp;
branches;
next	1.47;

1.47
date	2013.10.24.15.18.00;	author ajacoutot;	state Exp;
branches;
next	1.46;

1.46
date	2013.10.13.20.18.08;	author naddy;	state Exp;
branches;
next	1.45;

1.45
date	2013.10.13.19.47.46;	author naddy;	state Exp;
branches;
next	1.44;

1.44
date	2013.03.11.11.23.51;	author espie;	state Exp;
branches;
next	1.43;

1.43
date	2013.02.09.14.49.51;	author sthen;	state Exp;
branches;
next	1.42;

1.42
date	2012.09.04.11.33.35;	author gonzalo;	state Exp;
branches;
next	1.41;

1.41
date	2011.09.16.10.31.21;	author espie;	state Exp;
branches;
next	1.40;

1.40
date	2011.06.09.13.24.13;	author giovanni;	state Exp;
branches;
next	1.39;

1.39
date	2011.05.09.09.32.19;	author giovanni;	state Exp;
branches;
next	1.38;

1.38
date	2010.11.19.07.23.06;	author espie;	state Exp;
branches;
next	1.37;

1.37
date	2010.11.11.10.54.02;	author espie;	state Exp;
branches;
next	1.36;

1.36
date	2010.11.06.16.07.00;	author espie;	state Exp;
branches;
next	1.35;

1.35
date	2010.10.18.19.59.16;	author espie;	state Exp;
branches;
next	1.34;

1.34
date	2010.07.08.20.32.01;	author jasper;	state Exp;
branches;
next	1.33;

1.33
date	2010.07.08.16.35.58;	author giovanni;	state Exp;
branches;
next	1.32;

1.32
date	2010.04.21.07.23.58;	author giovanni;	state Exp;
branches;
next	1.31;

1.31
date	2010.02.26.18.52.57;	author espie;	state Exp;
branches;
next	1.30;

1.30
date	2010.01.29.12.03.09;	author jasper;	state Exp;
branches;
next	1.29;

1.29
date	2009.12.22.11.21.33;	author giovanni;	state Exp;
branches;
next	1.28;

1.28
date	2009.10.28.14.21.38;	author giovanni;	state Exp;
branches;
next	1.27;

1.27
date	2009.09.15.17.37.21;	author jasper;	state Exp;
branches;
next	1.26;

1.26
date	2008.05.07.20.02.47;	author mbalmer;	state Exp;
branches
	1.26.6.1;
next	1.25;

1.25
date	2007.09.16.00.17.05;	author merdely;	state Exp;
branches;
next	1.24;

1.24
date	2007.02.08.11.28.46;	author bernd;	state Exp;
branches;
next	1.23;

1.23
date	2006.11.26.11.36.32;	author espie;	state Exp;
branches;
next	1.22;

1.22
date	2006.11.16.21.48.21;	author mbalmer;	state Exp;
branches;
next	1.21;

1.21
date	2006.11.03.15.15.02;	author mbalmer;	state Exp;
branches;
next	1.20;

1.20
date	2006.11.03.13.50.54;	author mbalmer;	state Exp;
branches;
next	1.19;

1.19
date	2006.08.03.13.09.09;	author espie;	state Exp;
branches;
next	1.18;

1.18
date	2005.08.16.18.28.55;	author espie;	state Exp;
branches;
next	1.17;

1.17
date	2005.08.13.18.19.32;	author espie;	state Exp;
branches;
next	1.16;

1.16
date	2005.03.26.18.31.45;	author joel;	state Exp;
branches;
next	1.15;

1.15
date	2005.01.02.10.44.03;	author alek;	state Exp;
branches;
next	1.14;

1.14
date	2004.12.06.23.06.01;	author mbalmer;	state Exp;
branches;
next	1.13;

1.13
date	2003.05.03.00.02.26;	author avsm;	state Exp;
branches;
next	1.12;

1.12
date	2003.03.31.13.43.17;	author avsm;	state Exp;
branches;
next	1.11;

1.11
date	2002.12.29.15.12.31;	author fgsch;	state Exp;
branches;
next	1.10;

1.10
date	2002.07.08.21.50.44;	author avsm;	state Exp;
branches;
next	1.9;

1.9
date	2002.05.13.23.31.25;	author espie;	state Exp;
branches;
next	1.8;

1.8
date	2001.09.30.22.35.44;	author avsm;	state Exp;
branches;
next	1.7;

1.7
date	2001.06.12.17.06.38;	author avsm;	state Exp;
branches;
next	1.6;

1.6
date	2001.05.10.23.05.01;	author avsm;	state Exp;
branches;
next	1.5;

1.5
date	2001.04.10.00.23.01;	author avsm;	state Exp;
branches;
next	1.4;

1.4
date	2001.03.06.08.52.00;	author avsm;	state Exp;
branches;
next	1.3;

1.3
date	2001.02.09.12.22.44;	author avsm;	state Exp;
branches;
next	1.2;

1.2
date	2000.11.30.15.08.26;	author avsm;	state Exp;
branches;
next	1.1;

1.1
date	2000.10.09.22.29.05;	author avsm;	state Exp;
branches
	1.1.1.1;
next	;

1.1.1.1
date	2000.10.09.22.29.05;	author avsm;	state Exp;
branches;
next	;

1.26.6.1
date	2010.02.14.03.46.39;	author william;	state Exp;
branches;
next	;


desc
@@


1.66
log
@run autotools before configure, not during build
@
text
@# $OpenBSD: Makefile,v 1.65 2017/09/29 16:54:24 ajacoutot Exp $

COMMENT-main=		mail delivery agent with filtering abilities
COMMENT-utils=		quota tools for the Courier mail suite

V=			2.9.0
REVISION=		0
DISTNAME=		maildrop-$V
PKGNAME-main=		maildrop-$V
FULLPKGNAME-utils=	courier-utils-$V
FULLPKGPATH-utils=	mail/maildrop,-utils
CATEGORIES=		mail

HOMEPAGE=		http://www.courier-mta.org/maildrop/
MAINTAINER=		Giovanni Bechis <giovanni@@openbsd.org>

MASTER_SITES=		${MASTER_SITE_SOURCEFORGE:=courier/}
EXTRACT_SUFX=		.tar.bz2

FLAVORS=		postfix no_trashquota
FLAVOR?=

MULTI_PACKAGES=		-main -utils

# GPLv3
PERMIT_PACKAGE_CDROM=	Yes

COMPILER =		gcc

CONFIGURE_STYLE=	gnu

CONFIGURE_ENV=		LDFLAGS="-L${LOCALBASE}/lib" \
			CPPFLAGS="${CFLAGS:C/ *$//} -I${LOCALBASE}/include" \
			ac_cv_header_fam_h=no \
			ac_cv_lib_fam_FAMOpen=no \
			ac_cv_lib_db_dbopen=no \
			ac_cv_func_dbopen=no
MAKE_ENV=		INCLUDES="-I${LOCALBASE}/include" \
			CPPFLAGS="-I${LOCALBASE}/include" \
			ac_cv_header_fam_h=no ac_cv_lib_fam_FAMOpen=no

# do not pick up Berkeley DB in bdbobj
CONFIGURE_ENV+=		ac_cv_lib_db_dbopen=no \
			ac_cv_lib_db_db_open=no \
			ac_cv_lib_db_db_env_create=no \
			ac_cv_func_dbopen=no

CONFIGURE_ARGS=		--sysconfdir=${SYSCONFDIR}/courier \
			--with-etcdir=${SYSCONFDIR}/courier \
			--datadir=${PREFIX}/share/doc \
			--enable-static \
			--with-db=gdbm \
			--enable-maildrop-gid=_courier \
			--enable-maildrop-uid=_courier \
			--enable-syslog=1 \
			--enable-restrict-trusted=1 \
			--enable-keep-fromline=1 \
			--enable-use-flock=1 \
			--enable-use-dotlock=1 \
			--enable-authlib \
			--with-dirsync \
			--enable-maildirquota \
			--with-default-maildrop="./Maildir"

.if ${FLAVOR:Mpostfix}
CONFIGURE_ARGS+=	--enable-sendmail=/usr/local/sbin/sendmail
CONFIGURE_ARGS+=	--enable-trusted-users="root _courier _postfix"
CONFIGURE_ARGS+=	--enable-trusted-groups="wheel _courier _postdrop"
# this sets the default version as postfix/stable if postfix is not
# already installed, but matches postfix-* so can still be installed
# alongside postfix/snapshot.
RUN_DEPENDS-main=	mail/postfix/stable
.else
CONFIGURE_ARGS+=	--enable-sendmail=/usr/sbin/sendmail
CONFIGURE_ARGS+=	--enable-trusted-users="root _courier"
CONFIGURE_ARGS+=	--enable-trusted-groups="wheel _courier"
.endif

.if ${FLAVOR:Mno_trashquota}
CONFIGURE_ARGS+=	--without-trashquota
.else
CONFIGURE_ARGS+=	--with-trashquota
.endif

MODULES=		devel/gettext

AUTOCONF_VERSION=	2.69
AUTOMAKE_VERSION=	1.15
BUILD_DEPENDS=		devel/libtool \
			${MODGNU_AUTOCONF_DEPENDS} \
			${MODGNU_AUTOMAKE_DEPENDS}

LIB_DEPENDS=		devel/libidn \
			mail/courier-unicode>=2.0

WANTLIB =		c idn courier-unicode

WANTLIB-main=		${WANTLIB} gdbm m ${COMPILER_LIBCXX} gdbm>=3 pcre>=1 courierauth
LIB_DEPENDS-main=	${LIB_DEPENDS} \
			databases/gdbm \
			devel/pcre \
			mail/courier-authlib

DOCFILES=		README \
			INSTALL \
			UPGRADE \
			README.postfix \
			maildroptips.txt \
			libs/maildir/README.sharedfolders.txt \
			libs/maildir/README.maildirquota.txt \
			libs/maildir/quotawarnmsg

# only libs/rfc822/configure.ac is patched
pre-configure:
	cd ${WRKSRC}/libs/rfc822 && \
	    AUTOCONF_VERSION=${AUTOCONF_VERSION} \
	    AUTOMAKE_VERSION=${AUTOMAKE_VERSION} autoreconf

post-install:
	${INSTALL_DATA_DIR} ${PREFIX}/share/doc/maildrop
.for f in ${DOCFILES}
	${INSTALL_DATA} ${WRKSRC}/$f ${PREFIX}/share/doc/maildrop/
.endfor

.include <bsd.port.mk>
@


1.65
log
@Needs devel/libtool for autohell.
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.64 2017/09/27 13:20:02 giovanni Exp $
d30 1
a30 7
AUTOCONF_VERSION=	2.69
AUTOMAKE_VERSION=	1.15
# only libs/rfc822/configure.ac is patched
AUTOCONF_DIR=           ${WRKSRC}/libs/rfc822
CONFIGURE_STYLE=	autoconf automake
# AC_PROG_LIBTOOL
BUILD_DEPENDS +=	devel/libtool
d87 6
d112 6
@


1.64
log
@missing automake build_depends
spotted by naddy@@
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.63 2017/09/26 17:37:51 giovanni Exp $
d35 2
@


1.63
log
@Unbreak autoconf check with clang by not using nested functions
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.62 2017/08/04 23:17:27 giovanni Exp $
a29 1
CONFIGURE_STYLE=	autoconf
d31 1
d34 1
@


1.62
log
@Update to 2.9.0
ok porwise sthen@@ on a similar diff
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.61 2017/07/26 22:45:26 sthen Exp $
d7 1
d30 5
a34 1
CONFIGURE_STYLE=	gnu
@


1.61
log
@bump LIBCXX/LIBECXX/COMPILER_LIBCXX ports.
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.60 2017/07/23 09:26:28 espie Exp $
d6 1
a6 1
V=			2.8.5
a10 1
REVISION =		2
d27 2
d86 1
a86 1
			mail/courier-unicode>=1.3
@


1.60
log
@add pthread to COMPILER_LIBCXX.
white lie, but it allows clang and gcc to be more similar
bump accordingly.
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.59 2017/07/16 19:18:59 espie Exp $
d11 1
a11 1
REVISION =		1
@


1.59
log
@use COMPILER_LIBCXX where applicable
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.58 2017/06/02 08:56:32 schwarze Exp $
d11 1
a11 1
REVISION=		0
@


1.58
log
@Drop USE_GROFF and bump.
Mandoc now handles DocBook lists implemented with \h.
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.57 2017/04/10 11:46:22 sthen Exp $
d89 1
a89 1
WANTLIB-main=		${WANTLIB} gdbm m ${LIBCXX} gdbm>=3 pcre>=1 courierauth
@


1.57
log
@use LIBCXX
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.56 2017/02/09 14:47:43 giovanni Exp $
d11 1
a93 2

USE_GROFF=		Yes
@


1.56
log
@bugfix update to 2.8.5
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.55 2016/09/02 09:19:36 giovanni Exp $
d88 1
a88 1
WANTLIB-main=		${WANTLIB} gdbm m stdc++ gdbm>=3 pcre>=1 courierauth
@


1.55
log
@bugfix update to 2.8.4
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.54 2016/05/30 19:09:18 jasper Exp $
d6 1
a6 1
V=			2.8.4
@


1.54
log
@simplify post-install which as a side-effect won't mask failure to install
non-existent files.

ok giovanni@@ (MAINTAINER)
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.53 2015/08/27 09:35:16 giovanni Exp $
d6 1
a6 1
V=			2.8.3
@


1.53
log
@Bugfix update to 2.8.3
a patch has been commmitted upstream
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.52 2015/04/28 07:24:43 giovanni Exp $
a60 10
DOCFILES=		${WRKSRC}/README \
			${WRKSRC}/INSTALL \
			${WRKSRC}/UPGRADE \
			${WRKSRC}/README.postfix \
			${WRKSRC}/maildroptips.txt \
			${WRKSRC}/libs/maildir/README.sharedfolders.txt \
			${WRKSRC}/libs/maildir/README.maildirquota.txt \
			${WRKSRC}/libs/maildir/quotawarnmsg


d96 9
d107 3
a109 5
	@@for i in ${DOCFILES}; do \
	    if [ -f $$i ]; then \
		${INSTALL_DATA} $$i ${PREFIX}/share/doc/maildrop ;\
	    fi \
	done
@


1.52
log
@Update to 2.8.1
remove a patche committed upstream
add a patch (committed upstream) to fix a use-after-free
ok jca@@ on a similar diff
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.51 2014/11/22 22:20:09 sthen Exp $
d6 1
a6 1
V=			2.8.1
d94 1
a94 1
			mail/courier-unicode
d96 1
a96 1
WANTLIB =		c idn unicode
@


1.51
log
@remove some USE_LIBTOOL=Yes that crept back in (this is now the default)
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.50 2014/11/20 19:26:34 sthen Exp $
d6 1
a6 2
V=			2.7.1
REVISION=		0
d93 2
a94 1
LIB_DEPENDS=		devel/libidn
d96 1
a96 1
WANTLIB =		c idn
a112 2
	${INSTALL_DATA} ${WRKSRC}/libs/unicode/README \
	    ${PREFIX}/share/doc/maildrop/README.unicode.txt
@


1.50
log
@set RUN_DEPENDS-main instead of RUN_DEPENDS (propagated to -util) for maildrop;
fixes a problem apparent now that the postfix flavour is built by default
reported by nigel@@ also seen by myself. ok aja@@ nigel@@ giovanni@@
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.49 2014/06/05 21:04:51 giovanni Exp $
a104 1
USE_LIBTOOL=		Yes
@


1.49
log
@
Update to 2.7.1, bugs fixed and utf-8 improvements
Add a no_trashquota flavor to keep it in sync with mail/courier-imap
Take maintainership
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.48 2013/11/07 07:09:00 ajacoutot Exp $
d7 1
d9 1
a9 1
PKGNAME-main=		maildrop-${V}
d76 4
a79 1
RUN_DEPENDS=		mail/postfix/stable
@


1.48
log
@Remove SECURITY files. They have served their purpose in the past but
have become pretty useless nowadays (and the pkg tools do not display
them anyway).
Some which contained valuable information have been turned into READMEs.

ok jasper@@ sthen@@
input/ok naddy@@
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.47 2013/10/24 15:18:00 ajacoutot Exp $
d6 1
a6 1
V=			2.5.5
a12 3
REVISION-main=		1
REVISION-utils=		0

d14 1
d19 1
a19 1
FLAVORS=		postfix
a23 1

d29 6
d66 3
a68 3
			${WRKSRC}/maildir/README.sharedfolders.txt \
			${WRKSRC}/maildir/README.maildirquota.txt \
			${WRKSRC}/maildir/quotawarnmsg
d82 6
d100 3
d110 1
a110 1
	${INSTALL_DATA} ${WRKSRC}/unicode/README \
@


1.47
log
@No need for the libiconv NODULE when we already have the gettext one.
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.46 2013/10/13 20:18:08 naddy Exp $
d13 1
a13 1
REVISION-main=		0
a99 4
	@@sed -e s#!!PREFIX!!#${TRUEPREFIX}#g ${FILESDIR}/SECURITY > \
		${WRKBUILD}/SECURITY
	${INSTALL_DATA} ${WRKBUILD}/SECURITY \
	    ${PREFIX}/share/doc/maildrop/
@


1.46
log
@We don't include Berkeley DB support, so don't pick it up when
configuring the bdbobj test program.
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.45 2013/10/13 19:47:46 naddy Exp $
d13 3
d79 1
a79 2
MODULES=		converters/libiconv \
			devel/gettext
@


1.45
log
@remove various cruft that appears to have been blindly carried over
from version to version
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.44 2013/03/11 11:23:51 espie Exp $
d31 6
@


1.44
log
@PERMIT_* / REGRESS->TEST sweep
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.43 2013/02/09 14:49:51 sthen Exp $
d29 1
a29 1
			CPPFLAGS="${CFLAGS:C/ *$//} -I${LOCALBASE}/include" \
a30 3
MAKE_ENV=		INCLUDES="-I${LOCALBASE}/include"

SUBST_VARS=             MAILDROPCONF
@


1.43
log
@Don't use ${FLAVOR:L}, we only support lower-case flavours now.
OK ajacoutot@@ espie@@
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.42 2012/09/04 11:33:35 gonzalo Exp $
a25 3
PERMIT_PACKAGE_FTP=	Yes
PERMIT_DISTFILES_CDROM=	Yes
PERMIT_DISTFILES_FTP=	Yes
@


1.42
log
@Update for Maildrop to 2.5.5:

* rfc2045/rfc2045reply.c (mkreply): Fix copying of the contents
  of the original message.
* rfc2045/reformime.c (do_print_info): rfc2231_udecodeDisposition()
  failure is not fatal.
* rfc2045/reformime.c (get_suitable_filename): Ditto.
* rfc2045/reformime.c (main2): Fixed segfault on some arches
  from an initial null given to strtok.
* mailbot: add "feedback" and "replyfeedback" formats,
  generating RFC 5965-formatted feedback report. -a option attaches the
  entire original message, instead of only its headers, for "replydsn",
  "feedback", and "replyfeedback" formats.

Ok giovanni@@
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.41 2011/09/16 10:31:21 espie Exp $
d65 1
a65 1
.if ${FLAVOR:L:Mpostfix}
@


1.41
log
@normalize pkgpath
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.40 2011/06/09 13:24:13 giovanni Exp $
d6 1
a6 1
V=			2.5.4
a8 1
REVISION-main =		0
a34 1
USE_GROFF =		Yes
@


1.40
log
@
Bugfix update to 2.5.4
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.39 2011/05/09 09:32:19 giovanni Exp $
d9 1
@


1.39
log
@
Update to 2.5.3
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.38 2010/11/19 07:23:06 espie Exp $
d6 1
a6 1
V=			2.5.3
@


1.38
log
@new depends
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.37 2010/11/11 10:54:02 espie Exp $
d6 1
a6 1
V=			2.5.0
a8 1
REVISION-main =		0
@


1.37
log
@a few email WANTLIBs
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.36 2010/11/06 16:07:00 espie Exp $
d71 1
a71 1
RUN_DEPENDS=		::mail/postfix/stable
d81 1
a81 1
LIB_DEPENDS=		::devel/libidn
d85 1
a85 1
WANTLIB-main=		${WANTLIB} gdbm m stdc++ gdbm.>=3 pcre.>=1 courierauth
d87 3
a89 3
			::databases/gdbm \
			::devel/pcre \
			::mail/courier-authlib
@


1.36
log
@move gettext to new WANTLIB
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.35 2010/10/18 19:59:16 espie Exp $
d8 2
a9 1
PKGNAME-main=		maildrop-${V}p0
d36 1
a36 1
USE_GROFF =	Yes
d81 1
a81 1
LIB_DEPENDS=		idn::devel/libidn
d83 1
a83 1
WANTLIB =		c
d85 1
a85 1
WANTLIB-main=		${WANTLIB} gdbm m stdc++
d87 3
a89 3
			gdbm.>=3::databases/gdbm \
			pcre.>=1::devel/pcre \
			courierauth::mail/courier-authlib
@


1.35
log
@USE_GROFF=Yes
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.34 2010/07/08 20:32:01 jasper Exp $
d82 1
a82 1
WANTLIB-utils=		c
d84 1
a84 1
WANTLIB-main=		c gdbm m stdc++
@


1.34
log
@- prevent maildrop from appending a newline to mbox files before delivering
new messages. which would alter the final message in the mbox; which mutt,
among others wasn't fond of.

from debian via nima hoda.
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.33 2010/07/08 16:35:58 giovanni Exp $
d35 1
@


1.33
log
@
Update to 2.5.0 plus a patch from upstream to prevent a segfault
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.32 2010/04/21 07:23:58 giovanni Exp $
d8 1
a8 1
PKGNAME-main=		maildrop-$V
@


1.32
log
@
Update to 2.4.3
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.31 2010/02/26 18:52:57 espie Exp $
d6 1
a6 1
V=			2.4.3
d76 5
d84 2
a85 1
LIB_DEPENDS-main=	gdbm.>=3::databases/gdbm \
@


1.31
log
@fix FULLPKGPATH
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.30 2010/01/29 12:03:09 jasper Exp $
d6 1
a6 1
V=			2.2.0
d8 2
a9 2
PKGNAME-main=		maildrop-$Vp1
FULLPKGNAME-utils=	courier-utils-$Vp0
d82 1
@


1.30
log
@Security fix for CVE-2010-0301, "maildrop Privilege Escalation
Security Issue". patch from upstream cvs.

ok ajacoutot@@
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.29 2009/12/22 11:21:33 giovanni Exp $
d9 2
a10 1
FULLPKGNAME-utils=	courier-utils-$V
@


1.29
log
@
Don't pull libfam during configure, spotted by Joachim Shipper,
help and ok sthen@@
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.28 2009/10/28 14:21:38 giovanni Exp $
d8 1
a8 1
PKGNAME-main=		maildrop-$Vp0
@


1.28
log
@
Update to 2.2.0
ok landry@@
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.27 2009/09/15 17:37:21 jasper Exp $
d8 1
a8 1
PKGNAME-main=		maildrop-$V
d31 2
a32 1
			CPPFLAGS="${CFLAGS:C/ *$//} -I${LOCALBASE}/include"
@


1.27
log
@remove marc balmer as maintainer of all of his ports, to take away the
illusion marc still maintains them. as requested by himself.
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.26 2008/05/07 20:02:47 mbalmer Exp $
d6 1
a6 1
V=			2.0.4
d8 2
a9 2
PKGNAME-main=		maildrop-$Vp0
FULLPKGNAME-utils=	courier-utils-$Vp0
d23 1
a23 1
# GPL
@


1.26
log
@Maintenance update to maildrop 2.0.4.
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.25 2007/09/16 00:17:05 merdely Exp $
d8 2
a9 2
PKGNAME-main=		maildrop-$V
FULLPKGNAME-utils=	courier-utils-$V
a12 1
MAINTAINER=		Marc Balmer <mbalmer@@openbsd.org>
@


1.26.6.1
log
@MFC:

SECURITY FIX

Resolves CVE-2010-0301

ok jasper@@
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.26 2008/05/07 20:02:47 mbalmer Exp $
d8 1
a8 1
PKGNAME-main=		maildrop-$Vp0
@


1.25
log
@Remove surrounding quotes in COMMENT*/PERMIT_*
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.24 2007/02/08 11:28:46 bernd Exp $
d6 1
a6 1
V=			2.0.2
d8 2
a9 2
PKGNAME-main=		maildrop-$Vp2
FULLPKGNAME-utils=	courier-utils-$Vp1
@


1.24
log
@The -utils subpackage conflicts with courier-imap.
(courier-imap already has the @@conflict marker.)
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.23 2006/11/26 11:36:32 espie Exp $
d3 2
a4 2
COMMENT-main=		"mail delivery agent with filtering abilities"
COMMENT-utils=		"quota tools for the Courier mail suite"
@


1.23
log
@new MULTI_PACKAGES
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.22 2006/11/16 21:48:21 mbalmer Exp $
d9 1
a9 1
FULLPKGNAME-utils=	courier-utils-$Vp0
@


1.22
log
@Fix some file ownership.  Problem found and reported by steven@@, thanks!
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.21 2006/11/03 15:15:02 mbalmer Exp $
d3 1
a3 1
COMMENT=		"mail delivery agent with filtering abilities"
d6 4
a9 2
DISTNAME=		maildrop-2.0.2
PKGNAME=		${DISTNAME}p1
d21 1
a21 2
MULTI_PACKAGES=		-utils
SUBPACKAGE?=
a22 1
FULLPKGNAME-utils=	${DISTNAME:S/maildrop/courier-utils/}p0
d75 4
a78 6
.if defined(PACKAGING) && $(SUBPACKAGE) == "-utils"
LIB_DEPENS=
WANTLIB+=		c
.else
WANTLIB+=		c gdbm m stdc++
LIB_DEPENDS+=		gdbm.>=3::databases/gdbm \
a80 2
.endif

@


1.21
log
@Fix user id.
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.20 2006/11/03 13:50:54 mbalmer Exp $
d7 1
a7 1
PKGNAME=		${DISTNAME}p0
@


1.20
log
@Part one of the update to maildrop-2.0.2.
@
text
@d1 1
a1 1
# $OpenBSD$
d7 1
d22 1
a22 1
FULLPKGNAME-utils=	${DISTNAME:S/maildrop/courier-utils/}
@


1.19
log
@new lib specs
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.18 2005/08/16 18:28:55 espie Exp $
d3 2
a4 2
COMMENT=	"local mail delivery agent with filtering abilities"
COMMENT-utils=	"userdb and quota tools for the Courier mail suite"
d6 2
a7 3
VERSION=	1.7.0
DISTNAME=	maildrop-${VERSION}
CATEGORIES=    	mail
d9 2
a10 2
HOMEPAGE=	http://www.courier-mta.org/maildrop/
MAINTAINER=	Marc Balmer <mbalmer@@openbsd.org>
d12 2
a13 2
MASTER_SITES=  	${MASTER_SITE_SOURCEFORGE:=courier/}
EXTRACT_SUFX=	.tar.bz2
d15 1
a15 1
FLAVORS=	ldap mysql
d18 1
a18 1
MULTI_PACKAGES=	-utils
d21 1
a21 1
FULLPKGNAME-utils= courier-utils-${VERSION}p2
a28 2
LIB_DEPENDS=            gdbm.>=3::databases/gdbm

d30 2
a31 1
CONFIGURE_ENV=		LDFLAGS="-L${LOCALBASE}/lib" 
a32 14
CONFIGURE_ARGS=		--datadir=${PREFIX}/share/doc \
			--enable-sendmail=/usr/sbin/sendmail \
			--enable-maildrop-gid=bin \
			--disable-tempdir --enable-restricted-trusted=1 \
			--enable-syslog=1 --with-etcdir=${SYSCONFDIR} \
			--with-db=gdbm --enable-userdb --enable-maildirquota

DOCFILES=		README INSTALL UPGRADE README.postfix

.if ${FLAVOR:L:Mldap}
LIB_DEPENDS+=		ldap,lber::databases/openldap
CONFIGURE_ARGS+=	--enable-maildropldap \
			--with-ldapconfig=${SYSCONFDIR}/maildropldap.config 
.endif
d34 38
a71 4
.if ${FLAVOR:L:Mmysql}
LIB_DEPENDS+=           mysqlclient::databases/mysql
CONFIGURE_ARGS+=        --enable-maildropmysql
WANTLIB=		crypto ssl z
d75 1
a75 1
LIB_DEPENDS=
d78 4
a81 1
WANTLIB+=		c m stdc++
d86 11
a96 11
.for i in ${DOCFILES}
	${INSTALL_DATA} ${WRKSRC}/$i ${PREFIX}/share/doc/maildrop
.endfor
.if ${FLAVOR:L:Mldap}
	${INSTALL_DATA_DIR} ${PREFIX}/share/examples/maildrop
	${INSTALL_DATA} ${WRKSRC}/maildropldap.config ${PREFIX}/share/examples/maildrop
.endif
.if ${FLAVOR:L:Mmysql}
	${INSTALL_DATA_DIR} ${PREFIX}/share/examples/maildrop
	${INSTALL_DATA} ${WRKSRC}/maildropmysql.config ${PREFIX}/share/examples/maildrop
.endif
@


1.18
log
@fix conflicts with 3.6 packages, thus allowing updates.

Okay pvalchev@@
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.17 2005/08/13 18:19:32 espie Exp $
d30 1
a30 1
LIB_DEPENDS=            gdbm.3::databases/gdbm
@


1.17
log
@missing dirs in PLIST
okay pvalchev@@
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.16 2005/03/26 18:31:45 joel Exp $
d22 1
a22 1
FULLPKGNAME-utils= courier-utils-${VERSION}p1
@


1.16
log
@typo.

ok pvalchev@@
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.15 2005/01/02 10:44:03 alek Exp $
d22 1
a22 1
FULLPKGNAME-utils= courier-utils-${VERSION}p0
@


1.15
log
@- Add WANTLIB marker
- Fix LIB_DEPENDS (and bump PKGNAME) for -utils
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.14 2004/12/06 23:06:01 mbalmer Exp $
d40 1
a40 1
			-with-db=gdbm --enable-userdb --enable-maildirquota
@


1.14
log
@Updated to version 1.7.0 and added an ldap and mysql flavor.

ok naddy@@
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.13 2003/05/03 00:02:26 avsm Exp $
d22 1
a22 1
FULLPKGNAME-utils= courier-utils-${VERSION}
d53 8
@


1.13
log
@update to maildrop-1.5.3
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.12 2003/03/31 13:43:17 avsm Exp $
d6 2
a7 2
V=		1.5.3
DISTNAME=	maildrop-${V}
d10 2
a11 2
HOMEPAGE=	http://www.flounder.net/~mrsam/maildrop/
MAINTAINER=	Anil Madhavapeddy <avsm@@openbsd.org>
d16 3
d22 1
a22 1
FULLPKGNAME-utils= courier-utils-${V}
d30 1
a30 1
LIB_DEPENDS=           gdbm.3::databases/gdbm
d44 11
d60 8
@


1.12
log
@Split maildrop into a new courier-utils subpackage which contains common
support files for userdb, softquota and maildir support.

tested by grange@@ before ports lock
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.11 2002/12/29 15:12:31 fgsch Exp $
d6 1
a6 1
V=		1.5.2
@


1.11
log
@and more.
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.10 2002/07/08 21:50:44 avsm Exp $
d4 1
d6 2
a7 1
DISTNAME=	maildrop-1.4.0
d14 6
d27 2
a28 1
SEPARATE_BUILD=		concurrent
d30 2
d36 2
a37 1
			--enable-syslog=1
@


1.10
log
@Update to maildrop-1.4.0

Noticed by Toni Mueller <support@@oeko.net>
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.9 2002/05/13 23:31:25 espie Exp $
a6 1
NEED_VERSION=	1.463
@


1.9
log
@More MASTER_SITES_SUBDIR out
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.8 2001/09/30 22:35:44 avsm Exp $
d5 1
a5 1
DISTNAME=	maildrop-1.3.4
@


1.8
log
@update to maildrop-1.3.4
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.7 2001/06/12 17:06:38 avsm Exp $
d12 1
a12 2
MASTER_SITES=  	${MASTER_SITE_SOURCEFORGE}
MASTER_SITE_SUBDIR=	courier
@


1.7
log
@Update to maildrop-1.3.3 (minor bug fixes)

Enable syslog logging; prodded by Hans Guenter Weigand <weigand@@hus-soft.de>
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.6 2001/05/10 23:05:01 avsm Exp $
d5 1
a5 1
DISTNAME=	maildrop-1.3.3
d7 1
a7 1
NEED_VERSION=	1.391
@


1.6
log
@upgrade to maildrop-1.3.2

Major change is the 'mailbot' for autoresponder creation
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.5 2001/04/10 00:23:01 avsm Exp $
d5 1
a5 1
DISTNAME=	maildrop-1.3.2
d26 2
a27 1
			--disable-tempdir --enable-restricted-trusted=1
@


1.5
log
@integrate COMMENT
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.4 2001/03/06 08:52:00 avsm Exp $
d3 1
a3 1
COMMENT=	local mail delivery agent with filtering abilities
d5 1
a5 1
DISTNAME=	maildrop-1.3.1
@


1.4
log
@Update to maildrop-1.3.1

Documentation updates only.
@
text
@d1 3
a3 1
# $OpenBSD: Makefile,v 1.3 2001/02/09 12:22:44 avsm Exp $
d7 1
a7 1
NEED_VERSION=	1.351
@


1.3
log
@- update to maildrop-1.3.0
- bump NEED_VERSION
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.2 2000/11/30 15:08:26 avsm Exp $
d3 1
a3 1
DISTNAME=	maildrop-1.3.0
@


1.2
log
@- update to maildrop-1.2.2
- bump NEED_VERSION
- remove maildirmake from PLIST due to conflicts
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.1.1.1 2000/10/09 22:29:05 avsm Exp $
d3 1
a3 1
DISTNAME=	maildrop-1.2.2
d5 1
a5 1
NEED_VERSION=	1.340
@


1.1
log
@Initial revision
@
text
@d1 1
a1 1
# $OpenBSD: Makefile.template,v 1.22 2000/06/09 17:19:46 espie Exp $
d3 1
a3 1
DISTNAME=	maildrop-1.2
d5 1
a5 1
NEED_VERSION=	1.338
@


1.1.1.1
log
@import maildrop-1.2

This one has been pending for around two months because
it installs root suid files.  The port strips these out
by default, and pkg/SECURITY has details on if they need
to be reenabled. qmail at least doesnt need it, others can
probably be configured to not.
(naddy@@ and avsm@@ discussed this)
--

maildrop is a replacement for your local mail delivery agent. It
reads a mail message from standard input, then delivers the message
to your mailbox. maildrop knows how to deliver mail to mbox-style
mailboxes, and maildirs.

maildrop will optionally read instructions from a file, which
describes how to filter incoming mail. Instructions can be provided
having mail delivered to alternate mailboxes, or forwarded somewhere
else. Unlike procmail, maildrop uses a structured filtering language.

maildrop is written in C++, and is significantly larger than procmail
in compiled form.  However, it uses resources much more efficiently.
Unlike procmail, maildrop will not read a 10 megabyte mail message
into memory. Large messages are saved in a temporary file, and are
filtered from the temporary file.

@
text
@@
