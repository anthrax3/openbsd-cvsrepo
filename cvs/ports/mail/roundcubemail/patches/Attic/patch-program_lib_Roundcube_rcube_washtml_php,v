head	1.1;
access;
symbols
	OPENBSD_5_6:1.1.0.2;
locks; strict;
comment	@# @;


1.1
date	2015.04.13.14.37.05;	author jasper;	state dead;
branches
	1.1.2.1;
next	;
commitid	Uzmn5npg2NBc5Aiu;

1.1.2.1
date	2015.04.13.14.37.05;	author jasper;	state Exp;
branches;
next	;
commitid	Uzmn5npg2NBc5Aiu;


desc
@@


1.1
log
@file patch-program_lib_Roundcube_rcube_washtml_php was initially added on branch OPENBSD_5_6.
@
text
@@


1.1.2.1
log
@Security fix for CVE-2015-1433, XSS issue in style attribute handling
(only 5.6 is affected)

ok sthen@@
@
text
@a0 18
$OpenBSD$

Security fix for CVE-2015-1433
http://www.openwall.com/lists/oss-security/2015/01/31/6

--- program/lib/Roundcube/rcube_washtml.php.orig	Mon Apr 13 14:30:10 2015
+++ program/lib/Roundcube/rcube_washtml.php	Mon Apr 13 14:31:15 2015
@@@@ -243,8 +243,8 @@@@ class rcube_washtml
                 $t .= ' ' . $key . '="' . htmlspecialchars($value, ENT_QUOTES) . '"';
             }
             else if ($key == 'style' && ($style = $this->wash_style($value))) {
-                $quot = strpos($style, '"') !== false ? "'" : '"';
-                $t .= ' style=' . $quot . $style . $quot;
+              // replace double quotes to prevent syntax error and XSS issues (#1490227)
+              $t .= ' style="' . str_replace('"', '&quot;', $style) . '"';
             }
             else if ($key == 'background' || ($key == 'src' && strtolower($node->tagName) == 'img')) { //check tagName anyway
                 if (($src = $this->config['cid_map'][$value])
@

