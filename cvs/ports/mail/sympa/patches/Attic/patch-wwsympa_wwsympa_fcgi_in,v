head	1.1;
access;
symbols
	OPENBSD_5_6:1.1.0.2;
locks; strict;
comment	@# @;


1.1
date	2015.01.30.15.21.31;	author jasper;	state dead;
branches
	1.1.2.1;
next	;
commitid	hb3tiNpUdGu64F8V;

1.1.2.1
date	2015.01.30.15.21.31;	author jasper;	state Exp;
branches;
next	;
commitid	hb3tiNpUdGu64F8V;


desc
@@


1.1
log
@file patch-wwsympa_wwsympa_fcgi_in was initially added on branch OPENBSD_5_6.
@
text
@@


1.1.2.1
log
@Security fix for CVE-2015-1306
@
text
@a0 25
$OpenBSD$

Security fix for CVE-2015-1306
https://sourcesup.renater.fr/scm/viewvc.php/branches/sympa-6.1-branch/wwsympa/wwsympa.fcgi.in?root=sympa&r1=11562&r2=11778

--- wwsympa/wwsympa.fcgi.in.orig	Fri Jan 30 14:45:31 2015
+++ wwsympa/wwsympa.fcgi.in	Fri Jan 30 14:46:11 2015
@@@@ -15517,9 +15517,14 @@@@ sub do_compose_mail {
 	 $pages_url = $in{'url'};
 	 
 	 # parse return the MIME::Lite part to send 
-	 my $MIMEmail = $mailHTML->parse($pages_url); 
-
-	 $in{'body'} = $MIMEmail->as_string;
+         $mailHTML->{_AGENT}->protocols_allowed(['http', 'https', 'ftp', 'nntp']);
+         my $MIMEmail = eval { $mailHTML->parse($pages_url) };
+         if ($MIMEmail) {
+             $in{'body'} = $MIMEmail->as_string;
+         } else {
+             report::reject_report_web('user', 'wrong_value', {'argument' => 'url'}, $param->{'action'});
+             return undef;
+         }
 	 
      }else{
 	 
@

