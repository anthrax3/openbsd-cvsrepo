head	1.3;
access;
symbols
	OPENBSD_6_1:1.3.0.28
	OPENBSD_6_1_BASE:1.3
	OPENBSD_6_0:1.3.0.26
	OPENBSD_6_0_BASE:1.3
	OPENBSD_5_9:1.3.0.22
	OPENBSD_5_9_BASE:1.3
	OPENBSD_5_8:1.3.0.24
	OPENBSD_5_8_BASE:1.3
	OPENBSD_5_7:1.3.0.20
	OPENBSD_5_7_BASE:1.3
	OPENBSD_5_6:1.3.0.18
	OPENBSD_5_6_BASE:1.3
	OPENBSD_5_5:1.3.0.16
	OPENBSD_5_5_BASE:1.3
	OPENBSD_5_4:1.3.0.14
	OPENBSD_5_4_BASE:1.3
	OPENBSD_5_3:1.3.0.12
	OPENBSD_5_3_BASE:1.3
	OPENBSD_5_2:1.3.0.10
	OPENBSD_5_2_BASE:1.3
	OPENBSD_5_1_BASE:1.3
	OPENBSD_5_1:1.3.0.8
	OPENBSD_5_0:1.3.0.6
	OPENBSD_5_0_BASE:1.3
	OPENBSD_4_9:1.3.0.4
	OPENBSD_4_9_BASE:1.3
	OPENBSD_4_8:1.3.0.2
	OPENBSD_4_8_BASE:1.3
	OPENBSD_4_7:1.1.0.24
	OPENBSD_4_7_BASE:1.1
	OPENBSD_4_6:1.1.0.22
	OPENBSD_4_6_BASE:1.1
	OPENBSD_4_5:1.1.0.20
	OPENBSD_4_5_BASE:1.1
	OPENBSD_4_4:1.1.0.18
	OPENBSD_4_4_BASE:1.1
	OPENBSD_4_3:1.1.0.16
	OPENBSD_4_3_BASE:1.1
	OPENBSD_4_2:1.1.0.14
	OPENBSD_4_2_BASE:1.1
	OPENBSD_4_1:1.1.0.12
	OPENBSD_4_1_BASE:1.1
	OPENBSD_4_0:1.1.0.10
	OPENBSD_4_0_BASE:1.1
	OPENBSD_3_9:1.1.0.8
	OPENBSD_3_9_BASE:1.1
	OPENBSD_3_8:1.1.0.6
	OPENBSD_3_8_BASE:1.1
	OPENBSD_3_7:1.1.0.4
	OPENBSD_3_7_BASE:1.1
	OPENBSD_3_6:1.1.0.2
	OPENBSD_3_6_BASE:1.1;
locks; strict;
comment	@# @;


1.3
date	2010.06.30.01.55.08;	author kevlo;	state Exp;
branches;
next	1.2;

1.2
date	2010.05.23.15.57.34;	author espie;	state Exp;
branches;
next	1.1;

1.1
date	2004.06.25.04.46.34;	author xsa;	state Exp;
branches;
next	;


desc
@@


1.3
log
@We have strndup(3) now; pointed out by ajacoutot@@
Where here, silent compiler warning

ok ajacoutot@@
@
text
@$OpenBSD: patch-bulk_mailer_c,v 1.2 2010/05/23 15:57:34 espie Exp $
--- bulk_mailer.c.orig	Thu May 25 03:34:33 2000
+++ bulk_mailer.c	Tue Jun 29 14:23:23 2010
@@@@ -95,6 +95,8 @@@@
 #include <sysexits.h>
 #include <errno.h>
 #include <time.h>
+#include <stdlib.h>
+#include <unistd.h>
 #ifdef HAVE_STRING_H
 #include <string.h>
 #endif
@@@@ -122,9 +124,6 @@@@ char *strdup();
 char *strchr();
 char *strrchr();
 #endif
-char *malloc ();
-char *realloc ();
-char *mktemp ();
 
 /*
  * (default) max different domains per envelope.
@@@@ -292,23 +291,6 @@@@ char *str;
 
 
 /*
- * copy the first 'len' characters of a string into malloc'ed
- * memory, appending a NUL to the copy.
- */
-
-static char *
-strndup (str, len)
-char *str;
-int len;
-{
-    char *result = malloc_or_else (len + 1);
-
-    strncpy (result, str, len);
-    result[len] = '\0';
-    return result;
-}
-
-/*
  * sort by case-folded reversed domain
  */
 
@@@@ -337,15 +319,15 @@@@ char *addr;
 {
     char *at;
     char *ptr;
-    char *domain;
+ /* char *domain; */
     char tempbuf[1024];
-    char c;
+ /* char c; */
 
     /*
      * make sure there's room in the buffer.
      */
     if (num_addrs >= num_addr_slots) {
-	struct address *new;
+    /* struct address *new; */
 	
 	num_addr_slots += 1000;
 	if (address_list == NULL)
@@@@ -353,7 +335,7 @@@@ char *addr;
 		malloc_or_else (num_addr_slots * sizeof (struct address));
 	else
 	    address_list = (struct address *)
-		realloc_or_else (address_list,
+		realloc_or_else ((char *) address_list,
 				 num_addr_slots * sizeof (struct address));
     }
 
@@@@ -985,7 +967,7 @@@@ static int
 copy_message (out, in)
 FILE *out, *in;
 {
-    int c;
+ /* int c; */
     char linebuf[32*1024];
     int has_valid_approved_hdr = 0;
     int has_resent_to_hdr = 0;
@@@@ -1218,14 +1200,14 @@@@ FILE *out, *in;
      */
     lines = 0;
     while (fgets (linebuf, sizeof (linebuf), in) != NULL) {
-	if (lines < 5 && 
+	if (lines < 5 && (
 	    /*
 	     * these often occur in English-text unsubscribe requests
 	     */
 	    contains (linebuf, "delete me") ||
 	    contains (linebuf, "remove me") ||
 	    contains (linebuf, "subscribe") ||
-	    contains (linebuf, "unsubscribe"))
+	    contains (linebuf, "unsubscribe")))
 	    saw_command = 1;
 	++lines;
 	fputs (linebuf, out);
@@@@ -1326,13 +1308,13 @@@@ main (argc, argv)
 int argc;
 char *argv[];
 {
-    int i;
+ /* int i; */
     FILE *fp;
     FILE *tmp;
     static char template[] = "/tmp/blkXXXXXX";
     char *tempname;
-    int c;
-    char buf[1024];
+ /* int c; */
+ /* char buf[1024]; */
 
     while (argc > 1 && (*argv[1] == '-' || *argv[1] == '+')) {
 	if (strcmp (argv[1], "-comment") == 0 && argc > 2) {
@@@@ -1513,8 +1495,8 @@@@ char *argv[];
 	exit (EX_OSFILE);
     }
 
-    tempname = mktemp (template);
-    tmp = fopen (template, "w");
+    tmp = fdopen (mkstemp(template), "w");
+    tempname = strdup(template);
     switch (copy_message (tmp, stdin)) {
 
     case HAS_EMBEDDED_COMMAND:
@@@@ -1592,4 +1574,5 @@@@ char *argv[];
 	
 	exit (EX_OK);
     }
+    exit (EX_OK);
 }
@


1.2
log
@zap redundant prototypes, fixes gcc4
@
text
@d1 3
a3 3
$OpenBSD: patch-bulk_mailer_c,v 1.1 2004/06/25 04:46:34 xsa Exp $
--- bulk_mailer.c.orig	Wed May 24 21:34:33 2000
+++ bulk_mailer.c	Sun May 23 17:56:30 2010
d23 1
a23 3
@@@@ -296,6 +295,7 @@@@ char *str;
  * memory, appending a NUL to the copy.
  */
a24 9
+/*
 static char *
 strndup (str, len)
 char *str;
@@@@ -307,6 +307,7 @@@@ int len;
     result[len] = '\0';
     return result;
 }
+*/
d27 17
d45 3
a47 1
@@@@ -337,15 +338,15 @@@@ char *addr;
d66 10
a75 1
@@@@ -985,7 +986,7 @@@@ static int
d84 1
a84 1
@@@@ -1218,14 +1219,14 @@@@ FILE *out, *in;
d101 1
a101 1
@@@@ -1326,13 +1327,13 @@@@ main (argc, argv)
d118 1
a118 1
@@@@ -1513,8 +1514,8 @@@@ char *argv[];
d129 1
a129 1
@@@@ -1592,4 +1593,5 @@@@ char *argv[];
@


1.1
log
@
- respect CC and CFLAGS
- use BSD_INSTALL_* in patch-Makefile_in
- sync patches while there
okay kevlo@@.
@
text
@d1 3
a3 3
$OpenBSD$
--- bulk_mailer.c.orig	Wed May 24 13:34:33 2000
+++ bulk_mailer.c	Fri Jun 25 00:44:11 2004
d13 11
a23 1
@@@@ -296,6 +298,7 @@@@ char *str;
d31 1
a31 1
@@@@ -307,6 +310,7 @@@@ int len;
d39 1
a39 1
@@@@ -337,15 +341,15 @@@@ char *addr;
d58 1
a58 1
@@@@ -985,7 +989,7 @@@@ static int
d67 1
a67 1
@@@@ -1218,14 +1222,14 @@@@ FILE *out, *in;
d84 1
a84 1
@@@@ -1326,13 +1330,13 @@@@ main (argc, argv)
d101 1
a101 1
@@@@ -1513,8 +1517,8 @@@@ char *argv[];
d112 1
a112 1
@@@@ -1592,4 +1596,5 @@@@ char *argv[];
@

