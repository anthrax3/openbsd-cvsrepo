head	1.61;
access;
symbols
	OPENBSD_6_2:1.61.0.2
	OPENBSD_6_2_BASE:1.61
	OPENBSD_6_1:1.58.0.2
	OPENBSD_6_1_BASE:1.58
	OPENBSD_6_0:1.55.0.2
	OPENBSD_6_0_BASE:1.55
	OPENBSD_5_9:1.54.0.2
	OPENBSD_5_9_BASE:1.54
	OPENBSD_5_8:1.52.0.4
	OPENBSD_5_8_BASE:1.52
	OPENBSD_5_7:1.51.0.2
	OPENBSD_5_7_BASE:1.51
	OPENBSD_5_6:1.49.0.2
	OPENBSD_5_6_BASE:1.49
	OPENBSD_5_5:1.48.0.2
	OPENBSD_5_5_BASE:1.48
	OPENBSD_5_4:1.46.0.2
	OPENBSD_5_4_BASE:1.46
	OPENBSD_5_3:1.39.0.2
	OPENBSD_5_3_BASE:1.39
	OPENBSD_5_2:1.38.0.2
	OPENBSD_5_2_BASE:1.38
	OPENBSD_5_1_BASE:1.36
	OPENBSD_5_1:1.36.0.2
	OPENBSD_5_0:1.33.0.2
	OPENBSD_5_0_BASE:1.33
	OPENBSD_4_9:1.32.0.2
	OPENBSD_4_9_BASE:1.32
	OPENBSD_4_8:1.25.0.2
	OPENBSD_4_8_BASE:1.25
	OPENBSD_4_7:1.24.0.6
	OPENBSD_4_7_BASE:1.24
	OPENBSD_4_6:1.24.0.4
	OPENBSD_4_6_BASE:1.24
	OPENBSD_4_5:1.24.0.2
	OPENBSD_4_5_BASE:1.24
	OPENBSD_4_4:1.23.0.4
	OPENBSD_4_4_BASE:1.23
	OPENBSD_4_3:1.23.0.2
	OPENBSD_4_3_BASE:1.23
	OPENBSD_4_2:1.21.0.4
	OPENBSD_4_2_BASE:1.21
	OPENBSD_4_1:1.21.0.2
	OPENBSD_4_1_BASE:1.21
	OPENBSD_4_0:1.19.0.2
	OPENBSD_4_0_BASE:1.19
	OPENBSD_3_9:1.9.0.2
	OPENBSD_3_9_BASE:1.9
	OPENBSD_3_8:1.3.0.4
	OPENBSD_3_8_BASE:1.3
	OPENBSD_3_7:1.3.0.2
	OPENBSD_3_7_BASE:1.3
	jakob_20050111:1.1.1.1
	jakob:1.1.1;
locks; strict;
comment	@# @;


1.61
date	2017.07.26.22.45.25;	author sthen;	state Exp;
branches;
next	1.60;
commitid	tD4MFrpYYDDL2UFT;

1.60
date	2017.07.16.19.18.59;	author espie;	state Exp;
branches;
next	1.59;
commitid	tt0GhWK5c4uf9ILG;

1.59
date	2017.04.10.11.46.22;	author sthen;	state Exp;
branches;
next	1.58;
commitid	BLsh88fJB8thZTwY;

1.58
date	2016.09.24.08.15.16;	author sthen;	state Exp;
branches;
next	1.57;
commitid	FOkuJ4vmCsxkKS5K;

1.57
date	2016.09.24.08.12.11;	author sthen;	state Exp;
branches;
next	1.56;
commitid	nb76gIJmOrHeFJV1;

1.56
date	2016.09.23.09.16.56;	author sthen;	state Exp;
branches;
next	1.55;
commitid	XLnI6AbHAmyVU5mO;

1.55
date	2016.03.16.21.19.38;	author naddy;	state Exp;
branches;
next	1.54;
commitid	eS3Ayl3CL8hkKETd;

1.54
date	2015.08.25.07.30.29;	author ajacoutot;	state Exp;
branches;
next	1.53;
commitid	x3rR2VHR7RvISfgT;

1.53
date	2015.08.12.22.27.32;	author sthen;	state Exp;
branches;
next	1.52;
commitid	SHEFBfUb4YY8KIkG;

1.52
date	2015.05.22.11.31.16;	author ajacoutot;	state Exp;
branches;
next	1.51;
commitid	2khjHXfpTaOuNVcx;

1.51
date	2014.11.22.22.20.09;	author sthen;	state Exp;
branches;
next	1.50;
commitid	ztGcFPtTGv2pmfvI;

1.50
date	2014.09.13.18.09.21;	author brad;	state Exp;
branches;
next	1.49;
commitid	PpbRjVZdAmlrmi8q;

1.49
date	2014.04.21.18.40.13;	author sthen;	state Exp;
branches;
next	1.48;

1.48
date	2013.09.18.06.30.23;	author landry;	state Exp;
branches
	1.48.2.1;
next	1.47;

1.47
date	2013.09.14.17.12.10;	author landry;	state Exp;
branches;
next	1.46;

1.46
date	2013.06.20.08.26.13;	author ajacoutot;	state Exp;
branches;
next	1.45;

1.45
date	2013.06.20.06.54.36;	author ajacoutot;	state Exp;
branches;
next	1.44;

1.44
date	2013.06.17.19.28.36;	author ajacoutot;	state Exp;
branches;
next	1.43;

1.43
date	2013.06.12.20.36.33;	author brad;	state Exp;
branches;
next	1.42;

1.42
date	2013.05.25.00.33.09;	author brad;	state Exp;
branches;
next	1.41;

1.41
date	2013.03.21.08.46.32;	author ajacoutot;	state Exp;
branches;
next	1.40;

1.40
date	2013.03.11.11.23.50;	author espie;	state Exp;
branches;
next	1.39;

1.39
date	2012.12.23.13.25.11;	author sthen;	state Exp;
branches;
next	1.38;

1.38
date	2012.04.23.17.15.18;	author espie;	state Exp;
branches;
next	1.37;

1.37
date	2012.03.29.13.38.40;	author sthen;	state Exp;
branches;
next	1.36;

1.36
date	2011.12.02.14.36.15;	author espie;	state Exp;
branches;
next	1.35;

1.35
date	2011.11.14.19.20.52;	author rpointel;	state Exp;
branches;
next	1.34;

1.34
date	2011.09.16.10.31.21;	author espie;	state Exp;
branches;
next	1.33;

1.33
date	2011.05.11.12.57.48;	author jasper;	state Exp;
branches;
next	1.32;

1.32
date	2010.11.19.07.23.06;	author espie;	state Exp;
branches;
next	1.31;

1.31
date	2010.11.11.18.20.52;	author espie;	state Exp;
branches;
next	1.30;

1.30
date	2010.11.10.13.12.02;	author espie;	state Exp;
branches;
next	1.29;

1.29
date	2010.11.10.10.23.36;	author espie;	state Exp;
branches;
next	1.28;

1.28
date	2010.10.28.09.13.16;	author steven;	state Exp;
branches;
next	1.27;

1.27
date	2010.10.18.19.59.15;	author espie;	state Exp;
branches;
next	1.26;

1.26
date	2010.09.22.06.54.22;	author landry;	state Exp;
branches;
next	1.25;

1.25
date	2010.04.12.08.37.38;	author jasper;	state Exp;
branches;
next	1.24;

1.24
date	2008.12.11.00.46.01;	author todd;	state Exp;
branches;
next	1.23;

1.23
date	2007.12.21.14.42.23;	author todd;	state Exp;
branches;
next	1.22;

1.22
date	2007.09.06.19.15.13;	author naddy;	state Exp;
branches;
next	1.21;

1.21
date	2006.11.11.13.36.30;	author mbalmer;	state Exp;
branches;
next	1.20;

1.20
date	2006.10.18.05.12.35;	author aanriot;	state Exp;
branches;
next	1.19;

1.19
date	2006.08.18.12.27.19;	author steven;	state Exp;
branches;
next	1.18;

1.18
date	2006.08.03.19.56.08;	author espie;	state Exp;
branches;
next	1.17;

1.17
date	2006.08.03.13.09.09;	author espie;	state Exp;
branches;
next	1.16;

1.16
date	2006.06.19.19.13.54;	author steven;	state Exp;
branches;
next	1.15;

1.15
date	2006.06.08.14.41.08;	author todd;	state Exp;
branches;
next	1.14;

1.14
date	2006.05.15.12.01.25;	author todd;	state Exp;
branches;
next	1.13;

1.13
date	2006.04.28.01.13.36;	author brad;	state Exp;
branches;
next	1.12;

1.12
date	2006.04.20.15.59.42;	author aanriot;	state Exp;
branches;
next	1.11;

1.11
date	2006.03.25.15.03.08;	author todd;	state Exp;
branches;
next	1.10;

1.10
date	2006.03.23.17.17.40;	author todd;	state Exp;
branches;
next	1.9;

1.9
date	2006.02.15.05.58.19;	author david;	state Exp;
branches;
next	1.8;

1.8
date	2006.01.22.04.10.42;	author brad;	state Exp;
branches;
next	1.7;

1.7
date	2005.12.26.13.17.35;	author steven;	state Exp;
branches;
next	1.6;

1.6
date	2005.11.30.08.33.16;	author jakob;	state Exp;
branches;
next	1.5;

1.5
date	2005.11.23.08.52.48;	author jakob;	state Exp;
branches;
next	1.4;

1.4
date	2005.10.26.06.18.38;	author jakob;	state Exp;
branches;
next	1.3;

1.3
date	2005.02.13.17.55.48;	author alek;	state Exp;
branches;
next	1.2;

1.2
date	2005.02.02.19.21.52;	author jakob;	state Exp;
branches;
next	1.1;

1.1
date	2005.01.11.16.06.04;	author jakob;	state Exp;
branches
	1.1.1.1;
next	;

1.1.1.1
date	2005.01.11.16.06.04;	author jakob;	state Exp;
branches;
next	;

1.48.2.1
date	2014.05.12.12.10.58;	author jasper;	state Exp;
branches;
next	;


desc
@@


1.61
log
@bump LIBCXX/LIBECXX/COMPILER_LIBCXX ports.
@
text
@# $OpenBSD: Makefile,v 1.60 2017/07/16 19:18:59 espie Exp $

COMMENT-main =	anti-spam filter
COMMENT-pgsql =	PostgreSQL driver for dspam
COMMENT-mysql =	MySQL driver for dspam

VERSION =	3.10.2
DISTNAME =	dspam-${VERSION}
REVISION-main =	6
REVISION-mysql = 5
REVISION-pgsql = 4

PKGNAME-main =	${PKGNAME}
.for p in pgsql mysql
PKGNAME-$p =	dspam-$p-${VERSION}
# non-flavoured db backend packages
FULLPKGNAME-$p = dspam-$p-${VERSION}
FULLPKGPATH-$p = ${PKGPATH},-$p
.endfor

SHARED_LIBS =	dspam	9.0
CATEGORIES =	mail

MASTER_SITES =	${MASTER_SITE_SOURCEFORGE:=dspam/}

HOMEPAGE =	http://dspam.nuclearelephant.com/

MAINTAINER =	Todd T. Fries <todd@@OpenBSD.org>

# AGPLv3/BSD/GPLv2
PERMIT_PACKAGE_CDROM =	Yes

MULTI_PACKAGES = -main -mysql -pgsql

WANTLIB =	m pthread
WANTLIB-main += ${WANTLIB} c sqlite3

LIBTOOL_FLAGS =		--tag=disable-static
CONFIGURE_STYLE =	gnu
SEPARATE_BUILD =	Yes
CONFIGURE_ARGS +=	--with-dspam-home=/var/dspam \
			--with-dspam-home-owner=_dspam \
			--with-dspam-home-group=_dspam \
			--with-dspam-home-mode=0755 \
			--with-dspam-owner=root \
			--with-dspam-group=bin \
			--with-dspam-mode=0555 \
			--with-storage-driver=sqlite3_drv,mysql_drv,pgsql_drv,hash_drv \
			--with-mysql-includes=${LOCALBASE}/include/mysql \
			--with-mysql-libraries=${LOCALBASE}/lib/mysql \
			--with-pgsql-includes=${LOCALBASE}/include/postgresql \
			--with-pgsql-libraries=${LOCALBASE}/lib \
			--with-sqlite-includes=${LOCALBASE}/include \
			--with-sqlite-libraries=${LOCALBASE}/lib \
			--enable-virtual-users \
			--enable-preferences-extension \
			--enable-daemon \
			--enable-long-usernames

EXAMPLESDIR =	${PREFIX}/share/examples/dspam

FLAVORS =	clamav ldap domainscale largescale
FLAVOR ?=

. if ${FLAVOR:Mlargescale} && ${FLAVOR:Mdomainscale}
ERRORS += "Fatal: choose either domainscale or largescale, not both"
. endif

LIB_DEPENDS-mysql =	${LIB_DEPENDS} ${PKGNAME-main}:mail/dspam,-main \
			databases/mariadb
WANTLIB-mysql =		${WANTLIB} crypto dspam z ssl ${COMPILER_LIBCXX} lib/mysql/mysqlclient

LIB_DEPENDS-pgsql =	${LIB_DEPENDS} ${PKGNAME-main}:mail/dspam,-main \
			databases/postgresql
WANTLIB-pgsql =		${WANTLIB} c crypto dspam pq ssl

LIB_DEPENDS-main =	${LIB_DEPENDS} \
			databases/sqlite3

.if ${FLAVOR:Mclamav}
CONFIGURE_ARGS +=	--enable-clamav
RUN_DEPENDS-main +=	security/clamav
.endif

.if ${FLAVOR:Mldap}
CONFIGURE_ARGS +=	--enable-external-lookup
CONFIGURE_ENV =		CPPFLAGS="-I${LOCALBASE}/include" \
			LDFLAGS="-L${LOCALBASE}/lib"
LIB_DEPENDS +=		databases/openldap
WANTLIB +=		crypto ssl sasl2 ldap-2.4 lber-2.4
.endif

.if ${FLAVOR:Mdomainscale}
CONFIGURE_ARGS +=	--enable-domain-scale
.else
CONFIGURE_ARGS +=	--disable-domain-scale
.endif

.if ${FLAVOR:Mlargescale}
CONFIGURE_ARGS +=	--enable-large-scale
.else
CONFIGURE_ARGS +=	--disable-large-scale
.endif

post-install:
	${INSTALL_DATA_DIR} ${EXAMPLESDIR}
	${INSTALL_DATA} ${WRKBUILD}/src/dspam.conf \
		${PREFIX}/share/examples/dspam/dspam.conf
	${INSTALL_DATA_DIR} ${PREFIX}/share/doc/dspam
	${INSTALL_DATA} ${WRKSRC}/{README,UPGRADING,RELEASE.NOTES,doc/*.txt} \
		${PREFIX}/share/doc/dspam
.for DRIVER in mysql sqlite pgsql
	${INSTALL_DATA_DIR} ${EXAMPLESDIR}/${DRIVER}
	${INSTALL_DATA} ${WRKSRC}/src/tools.${DRIVER}_drv/*.sql \
		${EXAMPLESDIR}/${DRIVER}
.endfor

.include <bsd.port.mk>
@


1.60
log
@use COMPILER_LIBCXX where applicable
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.59 2017/04/10 11:46:22 sthen Exp $
d9 3
a11 3
REVISION-main =	5
REVISION-mysql = 4
REVISION-pgsql = 3
@


1.59
log
@use LIBCXX
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.58 2016/09/24 08:15:16 sthen Exp $
d71 1
a71 1
WANTLIB-mysql =		${WANTLIB} crypto dspam z ssl ${LIBCXX} lib/mysql/mysqlclient
@


1.58
log
@use slightly more uniform Makefile formatting
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.57 2016/09/24 08:12:11 sthen Exp $
d71 1
a71 1
WANTLIB-mysql =		${WANTLIB} crypto dspam z ssl stdc++ lib/mysql/mysqlclient
@


1.57
log
@Fix dspam's LIB_DEPENDS/WANTLIB to unbreak ldap flavour following sqlite3 move.
Stop using groff, there are now only unimportant whitespace/date format changes.
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.56 2016/09/23 09:16:56 sthen Exp $
d8 5
a12 1
DISTNAME =	dspam-3.10.2
a19 3
REVISION-main =		5
REVISION-mysql =	4
REVISION-pgsql =	3
d34 2
a35 1
WANTLIB = m pthread
d38 1
a38 1
LIBTOOL_FLAGS =	--tag=disable-static
d40 1
a40 1
SEPARATE_BUILD =		Yes
d63 1
a63 1
FLAVOR?=
d69 1
a69 1
LIB_DEPENDS-mysql=	${LIB_DEPENDS} ${PKGNAME-main}:mail/dspam,-main \
d71 1
a71 1
WANTLIB-mysql=		${WANTLIB} crypto dspam z ssl stdc++ lib/mysql/mysqlclient
d73 1
a73 1
LIB_DEPENDS-pgsql=	${LIB_DEPENDS} ${PKGNAME-main}:mail/dspam,-main \
d75 1
a75 1
WANTLIB-pgsql=		${WANTLIB} c crypto dspam pq ssl
d77 1
a77 1
LIB_DEPENDS-main=	${LIB_DEPENDS} \
d82 1
a82 1
RUN_DEPENDS-main+=	security/clamav
d110 2
a111 1
	${INSTALL_DATA} ${WRKSRC}/{README,UPGRADING,RELEASE.NOTES,doc/*.txt} ${PREFIX}/share/doc/dspam
a116 1

@


1.56
log
@Cope with moving sqlite3 back to ports.
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.55 2016/03/16 21:19:38 naddy Exp $
d16 3
a18 3
REVISION-main =		4
REVISION-mysql =	3
REVISION-pgsql =	2
d33 1
a33 1
WANTLIB = crypto m pthread
a36 2
LIB_DEPENDS-main+=	databases/sqlite3
USE_GROFF =		Yes
d69 1
a69 1
WANTLIB-mysql=		${WANTLIB} dspam z ssl stdc++ lib/mysql/mysqlclient
d73 4
a76 1
WANTLIB-pgsql=		${WANTLIB} c dspam pq ssl
d80 1
a80 2
LIB_DEPENDS-main+=	security/clamav
WANTLIB-main+=		clamav>=1
d88 1
a88 1
WANTLIB +=		ssl sasl2 ldap-2.4 lber-2.4
@


1.55
log
@remove SHARED_ONLY from ports that use only the gnu module
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.54 2015/08/25 07:30:29 ajacoutot Exp $
d16 1
a16 2
REVISION =		1
REVISION-main =		3
d18 1
d37 1
d53 2
@


1.54
log
@/var/run content is already removed by /etc/rc, so no need to handle that in
the package. If a /var/run/foo directory must exist for proper start of a
software, then the rc.d script should take care of it.
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.53 2015/08/12 22:27:32 sthen Exp $
a21 1
SHARED_ONLY =	Yes
@


1.53
log
@sync WANTLIB
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.52 2015/05/22 11:31:16 ajacoutot Exp $
d17 1
a17 1
REVISION-main =		2
@


1.52
log
@"/usr/local/lib/pkgconfig/" is part of mtree(8).
Packages should not own this dir to prevent its deletion or a warning that it
cannot be removed because it's not empty at pkg_delete(1) time.
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.51 2014/11/22 22:20:09 sthen Exp $
d18 1
a18 1
REVISION-mysql =	2
d69 1
a69 1
WANTLIB-mysql=		${WANTLIB} dspam z ssl lib/mysql/mysqlclient
@


1.51
log
@remove some USE_LIBTOOL=Yes that crept back in (this is now the default)
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.50 2014/09/13 18:09:21 brad Exp $
d17 1
@


1.50
log
@Switch from using MySQL to using MariaDB attempt #2. MariaDB is a drop-in replacement.

ok sthen@@
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.49 2014/04/21 18:40:13 sthen Exp $
a35 1
USE_LIBTOOL =		Yes
@


1.49
log
@sync wantlib and make the ldap flavour actually use ldap
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.48 2013/09/18 06:30:23 landry Exp $
a8 1
REVISION =	1
d16 2
d68 1
a68 1
			databases/mysql
@


1.48
log
@Dont use BUILD_PKGPATH in LIB_DEPENDS-{mysql,pgsql} since FLAVORs end up
there and confuse PLIST_DB later on. plain mail/dspam works.
Bump corresponding REVISIONs.
Reported by & hints from sthen@@, thanks!
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.47 2013/09/14 17:12:10 landry Exp $
d3 7
a9 6
COMMENT-main=	anti-spam filter
COMMENT-pgsql=	PostgreSQL driver for dspam
COMMENT-mysql=	MySQL driver for dspam

VERSION=	3.10.2
DISTNAME=	dspam-3.10.2
a16 2
REVISION-mysql =	0
REVISION-pgsql =	0
d18 2
a19 2
SHARED_LIBS=	dspam	9.0
CATEGORIES=	mail
d22 1
a22 1
MASTER_SITES=	${MASTER_SITE_SOURCEFORGE:=dspam/}
d24 1
a24 1
HOMEPAGE=	http://dspam.nuclearelephant.com/
d26 1
a26 1
MAINTAINER=     Todd T. Fries <todd@@OpenBSD.org>
d29 1
a29 1
PERMIT_PACKAGE_CDROM=	Yes
d32 1
a32 1
WANTLIB = m pthread
d35 1
a35 1
USE_LIBTOOL=		Yes
d38 3
a40 3
CONFIGURE_STYLE=	gnu
SEPARATE_BUILD=		Yes
CONFIGURE_ARGS+=	--with-dspam-home=/var/dspam \
d57 1
a57 1
EXAMPLESDIR=	${PREFIX}/share/examples/dspam
d59 1
a59 1
FLAVORS=	clamav ldap domainscale largescale
d63 1
a63 1
ERRORS+= "Fatal: choose either domainscale or largescale, not both"
d66 1
a66 1
LIB_DEPENDS-mysql=	${PKGNAME-main}:mail/dspam,-main \
d68 1
a68 1
WANTLIB-mysql=		${WANTLIB} dspam z ssl crypto lib/mysql/mysqlclient
d70 1
a70 1
LIB_DEPENDS-pgsql=	${PKGNAME-main}:mail/dspam,-main \
d72 1
a72 1
WANTLIB-pgsql=		${WANTLIB} c com_err crypto dspam pq ssl
d75 3
a77 3
CONFIGURE_ARGS+=	--enable-clamav
LIB_DEPENDS-main+=		security/clamav
WANTLIB-main +=		clamav>=1
d81 2
a82 2
CONFIGURE_ARGS+=	--enable-ldap
CONFIGURE_ENV=		CPPFLAGS="-I${LOCALBASE}/include" \
d84 2
a85 3
LIB_DEPENDS-main+=		databases/openldap
WANTLIB-main+=		crypto ssl sasl2 asn1 com_err gssapi krb5 \
			ldap-2.4 lber-2.4 heimbase roken wind
d89 1
a89 1
CONFIGURE_ARGS+=	--enable-domain-scale
d91 1
a91 1
CONFIGURE_ARGS+=	--disable-domain-scale
d95 1
a95 1
CONFIGURE_ARGS+=	--enable-large-scale
d97 1
a97 1
CONFIGURE_ARGS+=	--disable-large-scale
@


1.48.2.1
log
@bump after clamav update which had a major lib bump

discussed with/ok aja@@
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.48 2013/09/18 06:30:23 landry Exp $
a15 1
REVISION-main  =	0
@


1.47
log
@Update to dspam 3.10.2.

- remove 6 out of the 10 flavors maze, only keep the ones that make
  sense (ie clamav, ldap, domainscale & largescale)
- build pgsql & mysql drivers as subpackages, as $DEITY intended
- @@pkgpath & PFRAG.[flavor]-main tweaks from sthen@@ (thanks!)
- remove init_pwent_cache() patch until i can make some sense of it
- remove painful strlcpy patches
- add patches to fix pgsql support with PSQL > 9.1 from
  http://sourceforge.net/p/dspam/bug-tracker/112/ &
http://sourceforge.net/p/dspam/bug-tracker/141
- add an rc script running dspam --daemon as _dspam
- patch default dspam.conf to trust user _dspam (pointed out by jca@@;
  thanks!) and to use port 2424 by default. Taken from debian.

Discussed at length with todd@@ (MAINTAINER), been running on amd64 with
pgsql &| sqlite backend since a while, also tested on sqlite/ppc.

Some tweaks might still be needed (a README ? Fix some weird crashers ?),
but at least it's better than what we had for the past years.
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.46 2013/06/20 08:26:13 ajacoutot Exp $
d16 3
d67 1
a67 1
LIB_DEPENDS-mysql=	${PKGNAME-main}:${BUILD_PKGPATH},-main \
d71 1
a71 1
LIB_DEPENDS-pgsql=	${PKGNAME-main}:${BUILD_PKGPATH},-main \
@


1.46
log
@No need for pthread.
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.45 2013/06/20 06:54:36 ajacoutot Exp $
d3 14
a16 6
COMMENT=	anti-spam filter

VERSION=	3.8.0
DISTNAME=	dspam-${VERSION}
REVISION=	9
SHARED_LIBS=	dspam	8.0
d18 1
d20 1
a20 1
MASTER_SITES=	http://dspam.nuclearelephant.com/sources/
d26 1
a26 1
# GPL
d29 3
a31 1
WANTLIB += c m
d33 2
d45 8
a54 6
DOCS=		${WRKSRC}/README ${WRKSRC}/UPGRADING ${WRKSRC}/RELEASE.NOTES \
		${WRKSRC}/doc/courier.txt ${WRKSRC}/doc/exim.txt \
		${WRKSRC}/doc/markov.txt ${WRKSRC}/doc/pop3filter.txt \
		${WRKSRC}/doc/postfix.txt ${WRKSRC}/doc/qmail.txt \
		${WRKSRC}/doc/relay.txt ${WRKSRC}/doc/sendmail.txt

a55 1
DAEMON_SUPPORT=
d57 2
a58 3
FLAVORS=	sqlite3 sqlite mysql pgsql hash clamav ldap preferences \
		domainscale largescale
FLAVOR?=	sqlite3
d64 7
a70 49
.for d in sqlite3 sqlite mysql pgsql hash
.  if ${FLAVOR:M$d}
DRIVER ?= $d
.    if ${DRIVER} != "$d"
ERRORS += "Fatal: choose either mysql or pgsql or sqlite or sqlite3 or hash"
.    endif
.  endif
.endfor

.if !defined(DRIVER)
DRIVER = sqlite3
FLAVOR += sqlite3
.endif

.if ${DRIVER} == "mysql"
CONFIGURE_ARGS+=	--with-storage-driver=mysql_drv \
			--with-mysql-includes=${LOCALBASE}/include/mysql \
			--with-mysql-libraries=${LOCALBASE}/lib/mysql \
			--enable-virtual-users
LIB_DEPENDS+=		databases/mysql
WANTLIB+=		z ssl crypto lib/mysql/mysqlclient>=14
.elif ${DRIVER} == "pgsql"
CONFIGURE_ARGS+=	--with-storage-driver=pgsql_drv \
			--with-pgsql-includes=${LOCALBASE}/include/postgresql \
			--with-pgsql-libraries=${LOCALBASE}/lib \
			--enable-virtual-users
LIB_DEPENDS+=		databases/postgresql
WANTLIB +=		pq>=4 com_err crypto ssl
.elif ${DRIVER} == "hash"
CONFIGURE_ARGS+=	--with-storage-driver=hash_drv
.elif ${DRIVER} == "sqlite"
CONFIGURE_ARGS+=	--with-storage-driver=sqlite_drv \
			--with-sqlite-includes=${LOCALBASE}/include \
			--with-sqlite-libraries=${LOCALBASE}/lib
LIB_DEPENDS+=		databases/sqlite
WANTLIB +=		sqlite>=8
.elif ${DRIVER} == "sqlite3"
CONFIGURE_ARGS+=	--with-storage-driver=sqlite3_drv \
			--with-sqlite-includes=${LOCALBASE}/include \
			--with-sqlite-libraries=${LOCALBASE}/lib
WANTLIB +=		sqlite3>=8
DRIVER =		sqlite
.endif

.if ${DRIVER} != "sqlite"
DAEMON_SUPPORT=		Yes
CONFIGURE_ARGS+=	--enable-daemon
WANTLIB+=		pthread
.endif
d74 2
a75 2
LIB_DEPENDS+=		security/clamav
WANTLIB +=		clamav>=1
d82 3
a84 8
LIB_DEPENDS+=		databases/openldap
WANTLIB+=		crypto ssl sasl2 asn1 com_err gssapi krb5 \
			ldap-2.4 lber-2.4 heimbase \
			roken wind
.endif

.if ${FLAVOR:Mpreferences}
CONFIGURE_ARGS+=	--enable-preferences-extension
d104 2
a105 2
	${INSTALL_DATA} ${DOCS} ${PREFIX}/share/doc/dspam
.if ${DRIVER} != "hash"
d109 2
a110 3
	${INSTALL_DATA} ${WRKSRC}/doc/${DRIVER}_drv.txt \
		${PREFIX}/share/doc/dspam
.endif
@


1.45
log
@Unbreak after hx509 and ntlm removal from Kerberos.
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.44 2013/06/17 19:28:36 ajacoutot Exp $
d7 1
a7 1
REVISION=	8
d114 1
a114 1
			pthread roken wind
@


1.44
log
@Some trivial WANTLIB and tweaks to unbreak after the Heimdal update.
Stop hardcoding the Kerberos libs and use krb5-config(1).
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.43 2013/06/12 20:36:33 brad Exp $
d7 1
a7 1
REVISION=	7
d113 1
a113 1
			ldap-2.4 lber-2.4 heimbase heimntlm hx509 \
@


1.43
log
@Revert back to using MySQL 5.1 for the time being. MariaDB 5.5 introduces
a new libmysqlclient non-blocking API which utilizes co-routines. The X86
specific GCC ASM co-routine support hid the fact that there was an issue.
The only fallback code so far is POSIX user contexts which OpenBSD does not
support.

Input from and Ok sthen@@ jasper@@
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.42 2013/05/25 00:33:09 brad Exp $
d7 1
a7 1
REVISION=	6
d113 2
a114 1
			ldap-2.4 lber-2.4
@


1.42
log
@Switch from using MySQL to using MariaDB. MariaDB is a drop-in replacement.


ok sthen aja
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.41 2013/03/21 08:46:32 ajacoutot Exp $
d7 1
a7 1
REVISION=	5
d70 1
a70 1
LIB_DEPENDS+=		databases/mariadb
@


1.41
log
@USE_LIBTOOL=Yes is the default now.
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.40 2013/03/11 11:23:50 espie Exp $
d7 1
a7 1
REVISION=	4
a64 1

d70 1
a70 1
LIB_DEPENDS+=		databases/mysql
@


1.40
log
@PERMIT_* / REGRESS->TEST sweep
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.39 2012/12/23 13:25:11 sthen Exp $
a21 1
USE_LIBTOOL=		Yes
@


1.39
log
@sync wantlib
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.38 2012/04/23 17:15:18 espie Exp $
a18 3
PERMIT_PACKAGE_FTP=	Yes
PERMIT_DISTFILES_CDROM=	Yes
PERMIT_DISTFILES_FTP=	Yes
@


1.38
log
@first pass at handling sqlite3 move
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.37 2012/03/29 13:38:40 sthen Exp $
d7 1
a7 1
REVISION=	3
d22 2
a23 1
WANTLIB=		c m
d83 1
a83 1
WANTLIB +=		pq>=4
d118 1
a118 1
			ldap>=8 lber>=8
@


1.37
log
@Change SEPARATE_BUILD=(concurrent|simple) to Yes; bsd.port.mk doesn't
make a distinction between these.  ok aja@@ dcoppa@@
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.36 2011/12/02 14:36:15 espie Exp $
d7 1
a7 1
REVISION=	2
a94 1
LIB_DEPENDS+=		databases/sqlite3
@


1.36
log
@bye bye FLAVOR:L
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.35 2011/11/14 19:20:52 rpointel Exp $
d27 1
a27 1
SEPARATE_BUILD=		concurrent
@


1.35
log
@DEPBASE->LOCALBASE.
ok todd@@ (maintainer).
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.34 2011/09/16 10:31:21 espie Exp $
d50 1
a50 1
. if ${FLAVOR:L:Mlargescale} && ${FLAVOR:L:Mdomainscale}
d55 1
a55 1
.  if ${FLAVOR:L:M$d}
d106 1
a106 1
.if ${FLAVOR:L:Mclamav}
d112 1
a112 1
.if ${FLAVOR:L:Mldap}
d121 1
a121 1
.if ${FLAVOR:L:Mpreferences}
d125 1
a125 1
.if ${FLAVOR:L:Mdomainscale}
d131 1
a131 1
.if ${FLAVOR:L:Mlargescale}
@


1.34
log
@normalize pkgpath
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.33 2011/05/11 12:57:48 jasper Exp $
d114 2
a115 2
CONFIGURE_ENV=		CPPFLAGS="-I${DEPBASE}/include" \
			LDFLAGS="-L${DEPBASE}/lib"
@


1.33
log
@Sanitize some @@unexec/@@extraunexec calls to rm: move them up in the
PLIST and delete everything under the @@sample'd directory instead of the
directory itself to prevent a warning from pkg_delete(1) trying to
remove a non existing directory and to help preventing left-over files
and directories.

ok aja@@
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.32 2010/11/19 07:23:06 espie Exp $
d7 1
a7 1
REVISION=	1
@


1.32
log
@new depends
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.31 2010/11/11 18:20:52 espie Exp $
d7 1
a7 1
REVISION=	0
@


1.31
log
@set DRIVER=sqlite when sqlite3 or sqlite, as noticed by landry.
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.30 2010/11/10 13:12:02 espie Exp $
d74 2
a75 2
LIB_DEPENDS+=		::databases/mysql
WANTLIB+=		z ssl crypto lib/mysql/mysqlclient.>=14
d81 2
a82 2
LIB_DEPENDS+=		:postgresql-client-*:databases/postgresql
WANTLIB +=		pq.>=4
d89 2
a90 2
LIB_DEPENDS+=		::databases/sqlite
WANTLIB +=		sqlite.>=8
d95 2
a96 2
LIB_DEPENDS+=		::databases/sqlite3
WANTLIB +=		sqlite3.>=8
d108 2
a109 2
LIB_DEPENDS+=		::security/clamav
WANTLIB +=		clamav.>=1
d116 1
a116 1
LIB_DEPENDS+=		::databases/openldap
d118 1
a118 1
			ldap.>=8 lber.>=8
@


1.30
log
@fix (charles smith)
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.29 2010/11/10 10:23:36 espie Exp $
d97 1
d100 1
a100 1
.if !${DRIVER:Msqlite*}
@


1.29
log
@switch to new WANTLIB, clean-up the mess, make those errors actually BE
errors.
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.28 2010/10/28 09:13:16 steven Exp $
d54 1
a54 1
.for d in mysql sqlite mysql pgsql hash sqlite3
@


1.28
log
@builds fine with openbsd libtool
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.26 2010/09/22 06:54:22 landry Exp $
d25 1
a25 1
USE_GROFF =	Yes
a43 1
DRIVER=
d50 16
a65 3
.if ${FLAVOR:L:Mmysql}
.if !empty(DRIVER)
ERRORS+=		choose either mysql or pgsql or sqlite or sqlite3 or hash
d67 3
d74 3
a76 9
LIB_DEPENDS+=		lib/mysql/mysqlclient.>=14::databases/mysql
DRIVER=			mysql
WANTLIB+=		z ssl crypto
.endif

.if ${FLAVOR:L:Mpgsql}
.if !empty(DRIVER)
ERRORS+=		choose either mysql or pgsql or sqlite or sqlite3 or hash
.endif
d81 3
a83 8
LIB_DEPENDS+=		pq.>=4:postgresql-client-*:databases/postgresql
DRIVER=			pgsql
.endif

.if ${FLAVOR:L:Mhash}
.if !empty(DRIVER)
ERRORS+=		choose either mysql or pgsql or sqlite or sqlite3 or hash
.endif
d85 1
a85 7
DRIVER=			hash
.endif

.if ${FLAVOR:L:Msqlite}
.if !empty(DRIVER)
ERRORS+=		choose either mysql or pgsql or sqlite or sqlite3 or hash
.endif
d89 3
a91 10
LIB_DEPENDS+=		sqlite.>=8::databases/sqlite
DRIVER=			sqlite
.endif

.if ${FLAVOR:L:Msqlite3} || empty(DRIVER)
.if !empty(DRIVER)
ERRORS+=		choose either mysql or pgsql or sqlite or sqlite3 or hash
.else
FLAVOR+=		sqlite3
.endif
d95 2
a96 2
LIB_DEPENDS+=		sqlite3.>=8::databases/sqlite3
DRIVER=			sqlite
d99 1
a99 1
.if empty(FLAVOR:L:Msqlite3) && empty(FLAVOR:L:Msqlite)
d101 2
d107 2
a108 1
LIB_DEPENDS+=		clamav.>=1::security/clamav
d115 3
a117 7
LIB_DEPENDS+=		ldap.>=8,lber.>=8::databases/openldap
WANTLIB+=		crypto ssl sasl2 asn1 com_err gssapi krb5
.endif

.if !empty(DAEMON_SUPPORT)
CONFIGURE_ARGS+=	--enable-daemon
WANTLIB+=		pthread
a125 3
. if ${FLAVOR:L:Mlargescale}
ERRORS+=		choose either domainscale or largescale, not both
. endif
a131 3
. if ${FLAVOR:L:Mdomainscale}
ERRORS+=		choose either domainscale or largescale, not both
. endif
@


1.27
log
@USE_GROFF=Yes
@
text
@d24 1
a24 2
# XXX missing -lkrb5 in pgsql flavor ?
USE_LIBTOOL=		gnu
@


1.26
log
@Force the use of gnu libtool. Our ports libtool doesn't seem to add
-lkrb5 (among others) when building the pgsql flavor.
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.25 2010/04/12 08:37:38 jasper Exp $
d26 1
@


1.25
log
@- use ERRORS, and not BROKEN here.
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.24 2008/12/11 00:46:01 todd Exp $
d7 1
a7 1
PKGNAME=	${DISTNAME}p0
d24 2
a25 1
USE_LIBTOOL=		Yes
@


1.24
log
@o Add 'domainscale' and 'largescale' flavors from
  Antti Harri iku(at)kameli(dot)openbsd(dot)fi
o Fix PostgreSQL escaping from
  Jeff Ross jross(at)openvistas(dot)net
bump PKGNAME
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.23 2007/12/21 14:42:23 todd Exp $
d52 1
a52 1
BROKEN=			choose either mysql or pgsql or sqlite or sqlite3 or hash
d65 1
a65 1
BROKEN=			choose either mysql or pgsql or sqlite or sqlite3 or hash
d77 1
a77 1
BROKEN=			choose either mysql or pgsql or sqlite or sqlite3 or hash
d85 1
a85 1
BROKEN=			choose either mysql or pgsql or sqlite or sqlite3 or hash
d96 1
a96 1
BROKEN=			choose either mysql or pgsql or sqlite or sqlite3 or hash
d136 1
a136 1
BROKEN=			choose either domainscale or largescale, not both
d145 1
a145 1
BROKEN=			choose either domainscale or largescale, not both
@


1.23
log
@o update to dspam 3.8.0 mostly from brad@@
o fix dspamc that was busted in the 3.8.0 release, verified to work via testing
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.22 2007/09/06 19:15:13 naddy Exp $
d7 1
d46 2
a47 1
FLAVORS=	sqlite3 sqlite mysql pgsql hash clamav ldap preferences
d131 18
@


1.22
log
@sync FLAVORS and DESCR; from Pierre Riteau
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.21 2006/11/11 13:36:30 mbalmer Exp $
d5 1
a5 1
VERSION=	3.6.8
d7 1
a7 2
PKGNAME=	${DISTNAME}p4
SHARED_LIBS=	dspam	7.0
d23 1
a25 3

USE_LIBTOOL=		Yes

@


1.21
log
@Fix WANTLIB in ldap FLAVOR.
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.20 2006/10/18 05:12:35 aanriot Exp $
d3 1
a3 1
COMMENT=	"anti-spam filter"
d7 1
a7 1
PKGNAME=	${DISTNAME}p3
@


1.20
log
@- install a config file in ${SYSCONFDIR} by default.
- install /var/* directories with @@sample.
- bump PKGNAME.

ok todd@@
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.19 2006/08/18 12:27:19 steven Exp $
d7 1
a7 1
PKGNAME=	${DISTNAME}p2
d122 1
a122 1
WANTLIB+=		crypto ssl sasl2
@


1.19
log
@add missing directory.

ok espie@@
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.18 2006/08/03 19:56:08 espie Exp $
d7 1
a7 1
PKGNAME=	${DISTNAME}p1
@


1.18
log
@more new lib specs
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.17 2006/08/03 13:09:09 espie Exp $
d7 1
a7 1
PKGNAME=	${DISTNAME}p0
@


1.17
log
@new lib specs
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.16 2006/06/19 19:13:54 steven Exp $
d59 1
a59 1
LIB_DEPENDS+=		lib/mysql/mysqlclient.14::databases/mysql
@


1.16
log
@add missing WANTLIBs for ldap flavor.  ok todd@@
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.15 2006/06/08 14:41:08 todd Exp $
d72 1
a72 1
LIB_DEPENDS+=		pq.4:postgresql-client-*:databases/postgresql
d91 1
a91 1
LIB_DEPENDS+=		sqlite.8::databases/sqlite
d104 1
a104 1
LIB_DEPENDS+=		sqlite3.8::databases/sqlite3
d114 1
a114 1
LIB_DEPENDS+=		clamav.1::security/clamav
d121 1
a121 1
LIB_DEPENDS+=		ldap.8,lber.8::databases/openldap
@


1.15
log
@update to 3.6.8, from Frank Denis
- fixes the PostgreSQL backend that failed to connect
- allows clients to link against libdspam when LDAP is turned on
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.14 2006/05/15 12:01:25 todd Exp $
d7 1
d122 1
@


1.14
log
@update to 3.6.6, provided by Frank Dennis

This is a maintenance release that fixes two critical bugs:
  BUGFIX: When using logfile, write errors result in segfault
  BUGFIX: MySQLUIDInSignature causes segfault on retrain
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.13 2006/04/28 01:13:36 brad Exp $
d5 1
a5 1
VERSION=	3.6.6
@


1.13
log
@upgrade to dspam 3.6.5; from Frank Denis
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.12 2006/04/20 15:59:42 aanriot Exp $
d5 1
a5 1
VERSION=	3.6.5
d47 1
a47 1
FLAVORS=	sqlite3 sqlite mysql pgsql hash clamav ldap
d126 4
@


1.12
log
@- remove MODGNU_SHARED_LIBS workaround.
- use ${SYSCONFDIR} with the @@extra file.
- bump PKGNAME.

ok todd@@
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.11 2006/03/25 15:03:08 todd Exp $
d5 1
a5 1
VERSION=	3.6.4
a6 1
PKGNAME=	dspam-${VERSION}p1
@


1.11
log
@bump pkgname, gently reminded by strum@@
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.10 2006/03/23 17:17:40 todd Exp $
d7 2
a8 4
PKGNAME=	dspam-${VERSION}p0
SHARED_LIBS=		dspam	7.0
MODGNU_SHARED_LIBS=	dspam	''
LIBdspam_ALIAS=		realdspam
@


1.10
log
@take maintainership, ok jakob@@
update to 3.6.4
(see http://dspam.nuclearelephant.com/text/RELEASE-3.6.4.txt for details)
Additionally:
- fix a typo in a printf
- give postgresql a chance of decent performance
- timeout at 15min not 5min per message by default
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.9 2006/02/15 05:58:19 david Exp $
d7 1
@


1.9
log
@correctly spell postgresql in DESCR; bump PKGNAME; ok sturm@@
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.8 2006/01/22 04:10:42 brad Exp $
d5 1
a5 1
VERSION=	3.6.3
a6 1
PKGNAME=	${DISTNAME}p0
d16 1
a16 1
MAINTAINER=     Jakob Schlyter <jakob@@openbsd.org>
@


1.8
log
@upgrade to dspam 3.6.3; from Frank Denis
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.7 2005/12/26 13:17:35 steven Exp $
d7 1
@


1.7
log
@SHARED_LIBS
ok sturm@@
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.6 2005/11/30 08:33:16 jakob Exp $
d5 1
a5 1
VERSION=	3.6.2
@


1.6
log
@update to v3.6.2; from Frank Denis
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.5 2005/11/23 08:52:48 jakob Exp $
d7 3
@


1.5
log
@update to v3.6.1; contributed by Frank Denis
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.4 2005/10/26 06:18:38 jakob Exp $
d5 1
a5 1
VERSION=	3.6.1
d25 2
d44 1
d106 4
a116 1
LIB_DEPENDS+=		ldap_r.8,lber.8::databases/openldap
d119 1
d122 1
a122 1
.if empty(FLAVOR:L:Msqlite3) && empty(FLAVOR:L:Msqlite)
d124 1
@


1.4
log
@upgrade to dspam 3.6.0; work by Frank Denis, tested by several
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.3 2005/02/13 17:55:48 alek Exp $
d5 1
a5 1
VERSION=	3.6.0
d43 1
a43 1
FLAVORS=	sqlite3 sqlite mysql pgsql hash daemon clamav ldap
d86 1
a86 1
LIB_DEPENDS=		sqlite::databases/sqlite
d99 1
a99 1
LIB_DEPENDS=		sqlite3::databases/sqlite3
d105 1
a105 1
LIB_DEPENDS=		clamav.1::security/clamav
d110 1
a110 1
LIB_DEPENDS=		ldap_r.7,lber.7::databases/openldap
d115 1
a115 7
.if ${FLAVOR:L:Mdaemon}
.if ${FLAVOR:L:Msqlite3}
BROKEN=			daemon mode is currently incompatible with sqlite3
.endif
.if ${FLAVOR:L:Msqlite}
BROKEN=			daemon mode is currently incompatible with sqlite
.endif
@


1.3
log
@Add WANTLIB marker
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.2 2005/02/02 19:21:52 jakob Exp $
d5 1
a5 1
VERSION=	3.2.6
d34 6
a39 1
DOCS=		${WRKSRC}/README ${WRKSRC}/README.*
d43 2
a44 13
FLAVORS=	sqlite mysql pgsql
FLAVOR?=	sqlite

.if ${FLAVOR:L:Msqlite}
.if !empty(DRIVER)
BROKEN=			choose either mysql or pgsql or sqlite
.endif
CONFIGURE_ARGS+=	--with-storage-driver=sqlite_drv \
			--with-sqlite-includes=${LOCALBASE}/include \
			--with-sqlite-libraries=${LOCALBASE}/lib
LIB_DEPENDS=		sqlite.8.6::databases/sqlite
DRIVER=			sqlite
.endif
d48 1
a48 1
BROKEN=			choose either mysql or pgsql or sqlite
d54 1
a54 1
LIB_DEPENDS+=		lib/mysql/mysqlclient.10::databases/mysql
d61 1
a61 1
BROKEN=			choose either mysql or pgsql or sqlite
d67 1
a67 1
LIB_DEPENDS+=		pq.3:postgresql-client-*:databases/postgresql
d71 54
d127 2
a128 3
	${INSTALL_DATA} ${WRKBUILD}/dspam.conf ${PREFIX}/share/examples/dspam/dspam.conf
	${INSTALL_DATA} ${WRKSRC}/tools.${DRIVER}_drv/README ${EXAMPLESDIR}/README.${DRIVER}
	${INSTALL_DATA} ${WRKSRC}/tools.${DRIVER}_drv/*.sql ${EXAMPLESDIR}
d131 7
@


1.2
log
@3.2.6
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.1.1.1 2005/01/11 16:06:04 jakob Exp $
d20 1
d62 1
@


1.1
log
@Initial revision
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.90 2004/05/10 06:14:43 jakob Exp $
d5 1
a5 1
VERSION=	3.2.4
@


1.1.1.1
log
@DSPAM is an open-source, freely available anti-spam solution designed to 
combat unsolicited commercial email using advanced statistical analysis. 
@
text
@@
