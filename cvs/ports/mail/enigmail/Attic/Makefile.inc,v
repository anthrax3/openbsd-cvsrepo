head	1.7;
access;
symbols
	OPENBSD_4_9:1.5.0.2
	OPENBSD_4_9_BASE:1.5
	OPENBSD_4_8:1.1.1.1.0.2
	OPENBSD_4_8_BASE:1.1.1.1
	landry_20100727:1.1.1.1
	landry:1.1.1;
locks; strict;
comment	@# @;


1.7
date	2011.07.28.20.36.56;	author landry;	state dead;
branches;
next	1.6;

1.6
date	2011.07.24.07.35.14;	author landry;	state Exp;
branches;
next	1.5;

1.5
date	2010.11.26.07.51.00;	author espie;	state Exp;
branches;
next	1.4;

1.4
date	2010.11.22.09.23.59;	author espie;	state Exp;
branches;
next	1.3;

1.3
date	2010.10.24.21.25.12;	author ajacoutot;	state Exp;
branches;
next	1.2;

1.2
date	2010.08.25.06.34.50;	author ajacoutot;	state Exp;
branches;
next	1.1;

1.1
date	2010.07.27.20.18.24;	author landry;	state Exp;
branches
	1.1.1.1;
next	;

1.1.1.1
date	2010.07.27.20.18.24;	author landry;	state Exp;
branches;
next	;


desc
@@


1.7
log
@Garbage collect mail/enigmail, it's now built as subpackages of
mail/mozilla-thunderbird and www/seamonkey.
@
text
@# $OpenBSD: Makefile.inc,v 1.6 2011/07/24 07:35:14 landry Exp $

SHARED_ONLY =	Yes

DISTNAME =	enigmail-${VERSION}
CATEGORIES =	mail security

HOMEPAGE =	http://enigmail.mozdev.org/

# mozilla public license or GPL
PERMIT_PACKAGE_CDROM =	Yes
PERMIT_PACKAGE_FTP =	Yes
PERMIT_DISTFILES_CDROM=	Yes
PERMIT_DISTFILES_FTP =	Yes

MASTER_SITES =	http://www.mozilla-enigmail.org/download/source/

BUILD_DEPENDS =	${MOZAPP_PKGSTEM}:${MOZAPP_PKGPATH}:configure \
		archivers/unzip
RUN_DEPENDS =	security/gnupg
LIB_DEPENDS =	${MOZAPP_PKGPATH},-main
WANTLIB =	c m nspr4 plc4 plds4 stdc++ ${MOZAPP_DIR}/xpcom ${MOZAPP_DIR}/xul ${MOZAPP_DIR}/mozalloc

USE_GMAKE =	Yes
NO_REGRESS =	Yes

MOZBASE =	${WRKDIR}/${MOZAPP_PKGPATH}/comm-${MOZAPP_BRANCH}
MOZBIN =	${MOZBASE}/mozilla/dist/bin
WRKDIST =	${WRKDIR}/enigmail
WRKSRC =	${MOZBASE}/mailnews/extensions/enigmail

GLOBALDIR =	${PREFIX}/${MOZAPP_DIR}/extensions/${GUID}
GNU_ARCH =	${MACHINE_ARCH:S/amd64/x86_64/}

# unzip ${ENIGMAIL_XPI} and inspect install.rdf for GUID
GUID =		{847b3a00-7ab1-11d4-8f02-006008948af5}
SUBST_VARS =	GUID

post-extract:
	# strip off the TARGET_XPCOM_ABI variable part
	perl -pi -e 's|(genxpi.*) (\$$\(TARGET_XPCOM_ABI\))|\1 "\2"|g' \
		${WRKDIST}/Makefile.in
	# strip xpcomABI from platform and ABI in chrome.manifest
	perl -pi -e 's|[-_]?\$${xpcomAbi}||g ; s| ABI=.\$${platform}.||g' ${WRKDIST}/genxpi
	mv ${WRKDIST} ${MOZBASE}/mailnews/extensions

do-build:
	cd ${MOZBASE}/mozilla && ${SETENV} ${MAKE_ENV} ${MAKE_PROGRAM} tier_base
	cd ${MOZBASE}/mozilla && ${SETENV} ${MAKE_ENV} ${MAKE_PROGRAM} tier_js
	cd ${MOZBASE}/mozilla && ${SETENV} ${MAKE_ENV} ${MAKE_PROGRAM} tier_platform
	cd ${MOZBASE} && ${SETENV} ${MAKE_ENV} ${MAKE_PROGRAM} export
	cd ${WRKSRC} && ./makemake -r
	# hax: switch to jar format to generate enigmail.jar
	perl -pi -e 's|MOZ_CHROME_FILE_FORMAT.*|MOZ_CHROME_FILE_FORMAT=jar|' ${MOZBASE}/config/autoconf.mk
	cd ${WRKSRC} && ${SETENV} ${MAKE_ENV} ${MAKE_PROGRAM}
	cd ${WRKSRC} && ${SETENV} ${MAKE_ENV} ${MAKE_PROGRAM} xpi

do-install:
	${INSTALL_DATA_DIR} ${GLOBALDIR}
	unzip -q ${MOZBIN}/${ENIGMAIL_XPI} -d ${GLOBALDIR}
	# enigmail 1.2 works in seamonkey 2.2 so adjust install.rdf
	perl -pi -e 's|<em:maxVersion>2.1.*</em:maxVersion>|<em:maxVersion>2.2.*</em:maxVersion>|' ${GLOBALDIR}/install.rdf
@


1.6
log
@Update to enigmail-1.2 and enigmail-seamonkey-1.2, following/compatible
with Tb 5.0 and Sm 2.2 updates. Ensure we depend on the correct version
of those, hack a bit the chrome.manifest to ensure the libs are found.
Tested by Nigel Taylor, thanks!
@
text
@d1 1
a1 1
# $OpenBSD: Makefile.inc,v 1.5 2010/11/26 07:51:00 espie Exp $
@


1.5
log
@make use of PKGSPEC to simplify depends, requires most recent security/gnupg
to compile correctly
@
text
@d1 1
a1 1
# $OpenBSD: Makefile.inc,v 1.4 2010/11/22 09:23:59 espie Exp $
d18 1
a18 1
BUILD_DEPENDS =	${MOZAPP_PKGPATH}:configure \
d22 1
a22 1
WANTLIB =	c m nspr4 plc4 plds4 stdc++ ${MOZAPP_DIR}/xpcom ${MOZAPP_DIR}/xpcom_core
d40 2
a41 1
	@@perl -pi -e 's|(genxpi.*) (\$$\(TARGET_XPCOM_ABI\))|\1 "\2"|g' \
d43 3
a45 2
	@@perl -pi -e 's|[-_]?\$${xpcomAbi}||g' ${WRKDIST}/genxpi
	@@mv ${WRKDIST} ${MOZBASE}/mailnews/extensions
d48 9
a56 8
	@@cd ${MOZBASE} && ${SETENV} ${MAKE_ENV} ${MAKE_PROGRAM} export
	@@cd ${MOZBASE}/mozilla/modules/libreg && ${SETENV} ${MAKE_ENV} ${MAKE_PROGRAM}
	@@cd ${MOZBASE}/mozilla/xpcom/string && ${SETENV} ${MAKE_ENV} ${MAKE_PROGRAM}
	@@cd ${MOZBASE}/mozilla/xpcom && ${SETENV} ${MAKE_ENV} ${MAKE_PROGRAM}
	@@cd ${MOZBASE}/mozilla/xpcom/obsolete && ${SETENV} ${MAKE_ENV} ${MAKE_PROGRAM}
	@@cd ${WRKSRC} && ./makemake -r
	@@cd ${WRKSRC} && ${SETENV} ${MAKE_ENV} ${MAKE_PROGRAM}
	@@cd ${WRKSRC} && ${SETENV} ${MAKE_ENV} ${MAKE_PROGRAM} xpi
d61 2
a62 2
	cp ${GLOBALDIR}/platform/OpenBSD*/components/lib*.so.* \
		${GLOBALDIR}/components/
@


1.4
log
@missed some
@
text
@d1 1
a1 1
# $OpenBSD: Makefile.inc,v 1.3 2010/10/24 21:25:12 ajacoutot Exp $
d20 1
a20 1
RUN_DEPENDS =	security/gnupg<2
@


1.3
log
@Remove USE_X11.
@
text
@d1 1
a1 1
# $OpenBSD: Makefile.inc,v 1.2 2010/08/25 06:34:50 ajacoutot Exp $
d18 4
a21 4
BUILD_DEPENDS =	::${MOZAPP_PKGPATH}:configure \
		::archivers/unzip
RUN_DEPENDS =	:gnupg-<2:security/gnupg
LIB_DEPENDS =	::${MOZAPP_PKGPATH},-main
@


1.2
log
@Force dependency on gnupg1 since gnupg2 has the same PKGNAME, it can
create some depency mess.
The long term solution is to update+merge gnupg2 into gnupg1 but for now
at least we have a clean dependency chain.

looks ok to jasper@@ and pea@@
@
text
@d1 1
a1 1
# $OpenBSD: Makefile.inc,v 1.1.1.1 2010/07/27 20:18:24 landry Exp $
a23 1
USE_X11 =	Yes
@


1.1
log
@Initial revision
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.27 2010/07/18 18:49:01 naddy Exp $
d20 1
a20 1
RUN_DEPENDS =	::security/gnupg
@


1.1.1.1
log
@Reimport enigmail, this time as two ports, sharing most stuff through
Makefile.inc :
- enigmail-1.1.2 for thunderbird
- enigmail-seamonkey-1.0.1p1 for seamonkey
@
text
@@
