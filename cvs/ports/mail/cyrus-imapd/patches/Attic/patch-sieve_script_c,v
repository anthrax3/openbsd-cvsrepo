head	1.2;
access;
symbols
	OPENBSD_4_6:1.2.0.4
	OPENBSD_4_5:1.2.0.2;
locks; strict;
comment	@# @;


1.2
date	2009.09.10.07.20.01;	author ajacoutot;	state dead;
branches
	1.2.2.1
	1.2.4.1;
next	1.1;

1.1
date	2009.09.03.18.51.52;	author ajacoutot;	state Exp;
branches;
next	;

1.2.2.1
date	2009.09.15.02.42.37;	author william;	state Exp;
branches;
next	;

1.2.4.1
date	2009.11.10.02.56.51;	author william;	state Exp;
branches;
next	;


desc
@@


1.2
log
@Update to cyrus-imapd-2.3.15

Fix the potential buffer overflow vulnerability described in CERT
VU#336053 (we already had an upstream patch for this in our 2.3.14 pkg).
This release also brings several non-critical bugfixes and feature
enhancements.
@
text
@$OpenBSD: patch-sieve_script_c,v 1.1 2009/09/03 18:51:52 ajacoutot Exp $

Fix overflow in action_string buffer.

--- sieve/script.c.orig	Mon Mar 24 21:08:46 2008
+++ sieve/script.c	Thu Sep  3 20:45:15 2009
@@@@ -688,7 +688,7 @@@@ static int do_sieve_error(int ret,
 	ret |= keep_ret;
         if (keep_ret == SIEVE_OK)
             snprintf(actions_string+strlen(actions_string),
-		     sizeof(actions_string)-strlen(actions_string),
+		     ACTIONS_STRING_LEN-strlen(actions_string),
 		     "Kept\n");
 	else {
 	    implicit_keep = 0;	/* don't try an implicit keep again */
@@@@ -742,7 +742,7 @@@@ static int do_action_list(sieve_interp_t *interp,
 	    
 	    if (ret == SIEVE_OK)
 		snprintf(actions_string+strlen(actions_string),
-			 sizeof(actions_string)-strlen(actions_string), 
+			 ACTIONS_STRING_LEN-strlen(actions_string), 
 			 "Rejected with: %s\n", a->u.rej.msg);
 
 	    break;
@@@@ -757,7 +757,7 @@@@ static int do_action_list(sieve_interp_t *interp,
 
 	    if (ret == SIEVE_OK)
 		snprintf(actions_string+strlen(actions_string),
-			 sizeof(actions_string)-strlen(actions_string),
+			 ACTIONS_STRING_LEN-strlen(actions_string),
 			 "Filed into: %s\n",a->u.fil.mailbox);
 	    break;
 	case ACTION_KEEP:
@@@@ -770,7 +770,7 @@@@ static int do_action_list(sieve_interp_t *interp,
 			       &errmsg);
 	    if (ret == SIEVE_OK)
 		snprintf(actions_string+strlen(actions_string),
-			 sizeof(actions_string)-strlen(actions_string),
+			 ACTIONS_STRING_LEN-strlen(actions_string),
 			 "Kept\n");
 	    break;
 	case ACTION_REDIRECT:
@@@@ -783,7 +783,7 @@@@ static int do_action_list(sieve_interp_t *interp,
 				   &errmsg);
 	    if (ret == SIEVE_OK)
 		snprintf(actions_string+strlen(actions_string),
-			 sizeof(actions_string)-strlen(actions_string),
+			 ACTIONS_STRING_LEN-strlen(actions_string),
 			 "Redirected to %s\n", a->u.red.addr);
 	    break;
 	case ACTION_DISCARD:
@@@@ -794,7 +794,7 @@@@ static int do_action_list(sieve_interp_t *interp,
 				      &errmsg);
 	    if (ret == SIEVE_OK)
 		snprintf(actions_string+strlen(actions_string),
-			 sizeof(actions_string)-strlen(actions_string),
+			 ACTIONS_STRING_LEN-strlen(actions_string),
 			 "Discarded\n");
 	    break;
 
@@@@ -820,12 +820,12 @@@@ static int do_action_list(sieve_interp_t *interp,
 
 		    if (ret == SIEVE_OK)
 			snprintf(actions_string+strlen(actions_string),
-				 sizeof(actions_string)-strlen(actions_string),
+				 ACTIONS_STRING_LEN-strlen(actions_string),
 				 "Sent vacation reply\n");
 
 		} else if (ret == SIEVE_DONE) {
 		    snprintf(actions_string+strlen(actions_string),
-			     sizeof(actions_string)-strlen(actions_string),
+			     ACTIONS_STRING_LEN-strlen(actions_string),
 			     "Vacation reply suppressed\n");
 
 		    ret = SIEVE_OK;
@


1.2.4.1
log
@MFC security patch only:

Fix overflow in action_string buffer.

ok ajacoutot@@
@
text
@d1 1
a1 1
$OpenBSD$
@


1.2.2.1
log
@MFC security patch only:

Fix overflow in action_string buffer.

ok jasper@@
@
text
@@


1.1
log
@SECURITY.
Fix overflow in action_string buffer.
@
text
@d1 1
a1 1
$OpenBSD$
@

