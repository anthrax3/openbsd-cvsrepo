head	1.3;
access;
symbols
	OPENBSD_4_1:1.2.0.4
	OPENBSD_4_1_BASE:1.2
	OPENBSD_4_0:1.2.0.2
	OPENBSD_4_0_BASE:1.2;
locks; strict;
comment	@# @;


1.3
date	2007.03.31.09.33.21;	author ajacoutot;	state dead;
branches;
next	1.2;

1.2
date	2006.04.15.08.15.01;	author alek;	state Exp;
branches;
next	1.1;

1.1
date	2006.04.08.20.46.20;	author sturm;	state Exp;
branches;
next	;


desc
@@


1.3
log
@- update to cyrus-imapd-2.3.8
upgrade notes: http://cyrusimap.web.cmu.edu/imapd/install-upgrade.html
@
text
@$OpenBSD: patch-imap_fetchnews_c,v 1.2 2006/04/15 08:15:01 alek Exp $
--- imap/fetchnews.c.orig	Wed Mar 23 01:40:11 2005
+++ imap/fetchnews.c	Mon Apr 10 19:20:13 2006
@@@@ -60,6 +60,7 @@@@
 #include "cyrusdb.h"
 #include "exitcodes.h"
 #include "global.h"
+#include "gmtoff.h"
 #include "lock.h"
 #include "prot.h"
 #include "xmalloc.h"
@@@@ -388,6 +389,7 @@@@ int main(int argc, char *argv[])
 	       &ctime.tm_hour, &ctime.tm_min, &ctime.tm_sec);
 	ctime.tm_year -= 1900;
 	ctime.tm_mon--;
+	ctime.tm_isdst = -1;
 
 	/* read the previous timestamp */
 	if (!sfile[0]) {
@@@@ -417,6 +419,7 @@@@ int main(int argc, char *argv[])
 	/* ask for new articles */
 	if (stamp) stamp -= 180; /* adjust back 3 minutes */
 	ptime = gmtime(&stamp);
+	ptime->tm_isdst = -1;
 	strftime(buf, sizeof(buf), datefmt, ptime);
 	prot_printf(pout, "NEWNEWS %s %s GMT\r\n", wildmat, buf);
 	
@@@@ -433,7 +436,7 @@@@ int main(int argc, char *argv[])
 	   We can't change this, otherwise we'd be incompatible
 	   with an old localtime timestamp.
 	*/
-	stamp -= timezone;
+	stamp += gmtoff_of(&ctime, stamp);
     }
 
     if (!newnews) {
@


1.2
log
@- Fix timezone handling in fetchnews
- Add NO_REGRESS
- Bump PKGNAME

From Antoine Jacoutot <ajacoutot@@lphp.org> (MAINTAINER)
@
text
@d1 1
a1 1
$OpenBSD$
@


1.1
log
@update to cyrus-imapd 2.2.13

from maintainer Antoine Jacoutot <ajacoutot at lphp.org>
@
text
@d2 27
a28 3
--- imap/fetchnews.c.orig	Tue Apr  4 09:21:43 2006
+++ imap/fetchnews.c	Tue Apr  4 09:21:59 2006
@@@@ -433,7 +433,7 @@@@ int main(int argc, char *argv[])
d33 1
a33 1
+	stamp -= (time_t) timezone;
@

