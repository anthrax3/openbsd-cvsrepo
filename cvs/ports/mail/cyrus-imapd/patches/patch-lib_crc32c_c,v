head	1.1;
access;
symbols;
locks; strict;
comment	@# @;


1.1
date	2017.07.25.12.08.36;	author jca;	state Exp;
branches;
next	;
commitid	mGclox1TyhaHY8Pn;


desc
@@


1.1
log
@Avoid __builtin_bswap32, not available with gcc-4.2.1

Fixes cyrus-imapd build on at least sparc64:

  http://build-failures.rhaalovely.net//sparc64/2017-07-07/mail/cyrus-imapd.log
@
text
@$OpenBSD$

gcc-4.2.1 doesn't have __builtin_bswap32

Index: lib/crc32c.c
--- lib/crc32c.c.orig
+++ lib/crc32c.c
@@@@ -595,7 +595,7 @@@@ static const uint32_t crc32c_lookup[4][256] = {
 /* swap endianness */
 static uint32_t swap(uint32_t x)
 {
-#if defined(__GNUC__) || defined(__clang__)
+#if (defined(__GNUC__) && (__GNUC__ > 4 || (__GNUC__ == 4 && __GNUC_MINOR__ >= 3))) || defined(__clang__)
     return __builtin_bswap32(x);
 #else
     return (x >> 24) |
@
