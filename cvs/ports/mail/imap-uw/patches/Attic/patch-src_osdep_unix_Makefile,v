head	1.12;
access;
symbols
	OPENBSD_5_2:1.11.0.4
	OPENBSD_5_2_BASE:1.11
	OPENBSD_5_1_BASE:1.11
	OPENBSD_5_1:1.11.0.2
	OPENBSD_5_0:1.10.0.4
	OPENBSD_5_0_BASE:1.10
	OPENBSD_4_9:1.10.0.2
	OPENBSD_4_9_BASE:1.10
	OPENBSD_4_8:1.9.0.12
	OPENBSD_4_8_BASE:1.9
	OPENBSD_4_7:1.9.0.10
	OPENBSD_4_7_BASE:1.9
	OPENBSD_4_6:1.9.0.8
	OPENBSD_4_6_BASE:1.9
	OPENBSD_4_5:1.9.0.6
	OPENBSD_4_5_BASE:1.9
	OPENBSD_4_4:1.9.0.4
	OPENBSD_4_4_BASE:1.9
	OPENBSD_4_3:1.9.0.2
	OPENBSD_4_3_BASE:1.9
	OPENBSD_4_2:1.7.0.4
	OPENBSD_4_2_BASE:1.7
	OPENBSD_4_1:1.7.0.2
	OPENBSD_4_1_BASE:1.7
	OPENBSD_4_0:1.6.0.6
	OPENBSD_4_0_BASE:1.6
	OPENBSD_3_9:1.6.0.4
	OPENBSD_3_9_BASE:1.6
	OPENBSD_3_8:1.6.0.2
	OPENBSD_3_8_BASE:1.6
	OPENBSD_3_7:1.5.0.6
	OPENBSD_3_7_BASE:1.5
	OPENBSD_3_6:1.5.0.4
	OPENBSD_3_6_BASE:1.5
	OPENBSD_3_5:1.5.0.2
	OPENBSD_3_5_BASE:1.5
	OPENBSD_3_4:1.4.0.4
	OPENBSD_3_4_BASE:1.4
	OPENBSD_3_3:1.4.0.2
	OPENBSD_3_3_BASE:1.4
	OPENBSD_3_2:1.3.0.2
	OPENBSD_3_2_BASE:1.3
	OPENBSD_3_1:1.2.0.2
	OPENBSD_3_1_BASE:1.2
	OPENBSD_3_0:1.1.0.2
	OPENBSD_3_0_BASE:1.1;
locks; strict;
comment	@# @;


1.12
date	2012.09.27.15.11.17;	author ajacoutot;	state dead;
branches;
next	1.11;

1.11
date	2011.11.06.09.03.28;	author ajacoutot;	state Exp;
branches;
next	1.10;

1.10
date	2010.10.23.19.39.46;	author jsg;	state Exp;
branches;
next	1.9;

1.9
date	2008.01.03.10.52.25;	author ajacoutot;	state Exp;
branches;
next	1.8;

1.8
date	2007.10.30.10.12.41;	author ajacoutot;	state Exp;
branches;
next	1.7;

1.7
date	2006.12.01.14.40.00;	author jakob;	state Exp;
branches;
next	1.6;

1.6
date	2005.07.29.17.30.11;	author jakob;	state Exp;
branches;
next	1.5;

1.5
date	2003.10.05.22.00.00;	author jakob;	state Exp;
branches;
next	1.4;

1.4
date	2002.10.05.15.22.27;	author jakob;	state Exp;
branches;
next	1.3;

1.3
date	2002.09.18.08.19.06;	author jakob;	state Exp;
branches
	1.3.2.1;
next	1.2;

1.2
date	2001.11.18.19.49.22;	author jakob;	state Exp;
branches
	1.2.2.1;
next	1.1;

1.1
date	2001.09.24.22.01.49;	author jakob;	state Exp;
branches;
next	;

1.2.2.1
date	2002.12.09.20.26.26;	author jakob;	state Exp;
branches;
next	;

1.3.2.1
date	2002.11.21.22.45.27;	author naddy;	state Exp;
branches;
next	;


desc
@@


1.12
log
@Remove, these ports are superseded by mail/re-alpine.
@
text
@$OpenBSD: patch-src_osdep_unix_Makefile,v 1.11 2011/11/06 09:03:28 ajacoutot Exp $

--- src/osdep/unix/Makefile.orig	Sat Jul 23 02:20:10 2011
+++ src/osdep/unix/Makefile	Sun Nov  6 09:59:50 2011
@@@@ -42,7 +42,7 @@@@ IP=4
 # -O3 seems to be safe, but empirical observation from our local expert
 # indicates that in some (many?) cases -O3 code runs slower than -O2.
 
-GCCOPTLEVEL= -O2
+GCCOPTLEVEL=
 
 
 # Try to have some consistency in GCC builds.  We want optimization, but we
@@@@ -54,9 +54,9 @@@@ GCC4CFLAGS= $(GCCCFLAGS) -Wno-pointer-sign
 
 # Extended flags needed for SSL.  You may need to modify.
 
-SSLDIR=/usr/local/ssl
-SSLCERTS=$(SSLDIR)/certs
-SSLKEYS=$(SSLCERTS)
+SSLDIR=/usr
+SSLCERTS=/etc/ssl
+SSLKEYS=$(SSLCERTS)/private
 SSLINCLUDE=$(SSLDIR)/include
 SSLLIB=$(SSLDIR)/lib
 
@@@@ -82,7 +82,7 @@@@ AFSDIR=/usr/afsws
 AFSCFLAGS=-I$(AFSDIR)/include
 AFSLIB=$(AFSDIR)/lib
 AFSLDFLAGS=-L$(AFSLIB)/afs -L$(AFSLIB) -L$(AFSDIR)/domestic/lib\
- -lkauth -lprot -lubik -lauth -lrxkad -lrx -llwp -ldes -lcom_err\
+ -lkauth -lprot -lubik -lauth -lrxkad -lrx -llwp -lcom_err\
  $(AFSLIB)/afs/util.a -laudit -lsys
 # AFSLDFLAGS may also need -L/usr/ucblib -lucb
 DCECFLAGS= -DDCE_MINIMAL -DPASSWD_OVERRIDE=\"/opt/pop3/passwd/passwd\"
@@@@ -147,6 +147,8 @@@@ DEFAULTAUTHENTICATORS=ext md5 pla log
 DEFAULTDRIVERS=imap nntp pop3 mix mx mbx tenex mtx mh mmdf unix news phile
 CHUNKSIZE=65536
 
+.SUFFIXES: .o .so
+
 # Normally no need to change any of these
 
 ARCHIVE=c-client.a
@@@@ -154,6 +156,7 @@@@ BINARIES=osdep.o mail.o misc.o newsrc.o smanager.o utf
  dummy.o pseudo.o netmsg.o flstring.o fdstring.o \
  rfc822.o nntp.o smtp.o imap4r1.o pop3.o \
  unix.o mbx.o mmdf.o tenex.o mtx.o news.o phile.o mh.o mx.o mix.o
+SOBINARIES=$(BINARIES:.o=.so)
 CFLAGS=-g
 
 CAT=cat
@@@@ -162,6 +165,11 @@@@ MV=mv
 RM=rm -rf
 SH=sh
 
+.if ${MACHINE_ARCH} == "sparc64" || ${MACHINE_ARCH} == "sparc"
+PICFLAG= -fPIC
+.else
+PICFLAG= -fpic
+.endif
 
 # Primary build command
 
@@@@ -281,6 +289,7 @@@@ bso:	# OpenBSD
 	 SPOOLDIR=/var \
 	 ACTIVEFILE=/usr/local/news/lib/active \
 	 RSHPATH=/usr/bin/rsh \
+	 LOCKPGM=$(PREFIX)/libexec/mlock \
 	 BASECFLAGS="$(GCCCFLAGS)"
 
 cvx:	# Convex
@@@@ -853,23 +862,33 @@@@ vu2:	# VAX Ultrix 2.3, etc.
 
 # Build it!
 
+.if defined(NO_SHARED_LIBS) && ${NO_SHARED_LIBS:L} == "yes"
 build:	clean once $(ARCHIVE)
-
 all:	$(ARCHIVE)
+.else
+build: clean once $(ARCHIVE) $(SHLIB)
+all:   $(ARCHIVE) $(SHLIB)
+.endif
 
 $(ARCHIVE): $(BINARIES)
 	sh -c '$(RM) $(ARCHIVE) || true'
 	@@$(CAT) ARCHIVE
 	@@$(SH) ARCHIVE
 
+$(SHLIB): $(SOBINARIES)
+	$(CC) -shared $(PICFLAG) -o $(SHLIB) $(SOBINARIES)
+
+
 .c.o:
 	`$(CAT) CCTYPE` -c `$(CAT) CFLAGS` $*.c
 
+.c.so:
+	`$(CAT) CCTYPE` -c `$(CAT) CFLAGS` $(PICFLAG) -DPIC $(@@:.so=.c) -o $@@
 
 # Cleanup
 
 clean:
-	sh -c '$(RM) auths.c crexcl.c ip_unix.c linkage.[ch] siglocal.c osdep*.[ch] *.o ARCHIVE *FLAGS *TYPE $(ARCHIVE) || true'
+	sh -c '$(RM) auths.c crexcl.c linkage.[ch] siglocal.c osdep*.[ch] *.o *.so ARCHIVE *FLAGS *TYPE $(ARCHIVE) $(SHLIB) || true'
 
 
 # Dependencies
@@@@ -904,7 +923,7 @@@@ utf8aux.o: mail.h misc.h osdep.h utf8.h
 
 # OS-dependent
 
-osdep.o:mail.h misc.h env.h fs.h ftl.h nl.h tcp.h \
+OSDEPS=	mail.h misc.h env.h fs.h ftl.h nl.h tcp.h \
 	osdep.h env_unix.h tcp_unix.h \
 	osdep.c env_unix.c fs_unix.c ftl_unix.c nl_unix.c tcp_unix.c ip_unix.c\
 	auths.c crexcl.c flockcyg.c flocklnx.c flocksim.c fsync.c \
@@@@ -918,12 +937,12 @@@@ osdep.o:mail.h misc.h env.h fs.h ftl.h nl.h tcp.h \
 	write.c sslstdio.c \
 	strerror.c strpbrk.c strstr.c strtok.c strtoul.c \
 	OSCFLAGS
-	@@echo Building OS-dependent module
-	@@echo If you get No such file error messages for files x509.h, ssl.h,
-	@@echo pem.h, buffer.h, bio.h, and crypto.h, that means that OpenSSL
-	@@echo is not installed on your system.  Either install OpenSSL first
-	@@echo or build with command: make `$(CAT) OSTYPE` SSLTYPE=none
-	`$(CAT) CCTYPE` -c `$(CAT) CFLAGS` `$(CAT) OSCFLAGS` -c osdep.c
+
+osdep.o: $(OSDEPS)
+	`$(CAT) CCTYPE` -c `$(CAT) CFLAGS` `$(CAT) OSCFLAGS` osdep.c
+
+osdep.so: $(OSDEPS)
+	`$(CAT) CCTYPE` -c `$(CAT) CFLAGS` `$(CAT) OSCFLAGS` $(PICFLAG) -DPIC osdep.c -o $@@
 
 osdep.c: osdepbas.c osdepckp.c osdeplog.c osdepssl.c
 	$(CAT) osdepbas.c osdepckp.c osdeplog.c osdepssl.c > osdep.c
@


1.11
log
@Update to imap-uw-2007f.
@
text
@d1 1
a1 1
$OpenBSD: patch-src_osdep_unix_Makefile,v 1.10 2010/10/23 19:39:46 jsg Exp $
@


1.10
log
@no need to link libdes for kerberos
ok ajacoutot@@
@
text
@d1 1
a1 1
$OpenBSD: patch-src_osdep_unix_Makefile,v 1.9 2008/01/03 10:52:25 ajacoutot Exp $
d3 2
a4 2
--- src/osdep/unix/Makefile.orig	Wed Jun  4 20:18:34 2008
+++ src/osdep/unix/Makefile	Sat Oct 16 14:17:08 2010
d65 1
a65 1
@@@@ -273,6 +281,7 @@@@ bso:	# OpenBSD
d73 1
a73 1
@@@@ -845,23 +854,33 @@@@ vu2:	# VAX Ultrix 2.3, etc.
d109 1
a109 1
@@@@ -896,7 +915,7 @@@@ utf8aux.o: mail.h misc.h osdep.h utf8.h
d118 1
a118 1
@@@@ -910,12 +929,12 @@@@ osdep.o:mail.h misc.h env.h fs.h ftl.h nl.h tcp.h \
@


1.9
log
@- update to imap-2007
@
text
@d1 1
a1 1
$OpenBSD: patch-src_osdep_unix_Makefile,v 1.8 2007/10/30 10:12:41 ajacoutot Exp $
d3 2
a4 2
--- src/osdep/unix/Makefile.orig	Mon Dec 17 23:10:24 2007
+++ src/osdep/unix/Makefile	Thu Jan  3 10:58:07 2008
d27 9
@


1.8
log
@- update to the latest stable version (2006j2)
- take over maintainership (ok jacob@@)
- add a new c-client subpackage to replace old mail/c-client which was
built from pine sources

feedbacks from sthen@@ and simon@@
testing and ok robert@@
@
text
@d1 1
a1 1
$OpenBSD: patch-src_osdep_unix_Makefile,v 1.7 2006/12/01 14:40:00 jakob Exp $
d3 2
a4 2
--- src/osdep/unix/Makefile.orig	Sun Jun 17 17:37:44 2007
+++ src/osdep/unix/Makefile	Sat Oct 27 23:23:52 2007
d27 1
a27 1
@@@@ -142,6 +142,8 @@@@ DEFAULTAUTHENTICATORS=ext md5 pla log
d36 1
a36 1
@@@@ -149,6 +151,7 @@@@ BINARIES=osdep.o mail.o misc.o newsrc.o smanager.o utf
d44 1
a44 1
@@@@ -157,6 +160,11 @@@@ MV=mv
d56 1
a56 1
@@@@ -268,6 +276,7 @@@@ bso:	# OpenBSD
d64 1
a64 1
@@@@ -840,23 +849,33 @@@@ vu2:	# VAX Ultrix 2.3, etc.
d100 1
a100 1
@@@@ -891,7 +910,7 @@@@ utf8aux.o: mail.h misc.h osdep.h utf8.h
d109 1
a109 1
@@@@ -905,12 +924,12 @@@@ osdep.o:mail.h misc.h env.h fs.h ftl.h nl.h tcp.h \
@


1.7
log
@update to imap-uw release 2006c1
@
text
@d1 1
a1 1
$OpenBSD: patch-src_osdep_unix_Makefile,v 1.6 2005/07/29 17:30:11 jakob Exp $
d3 2
a4 2
--- src/osdep/unix/Makefile.orig	Mon Oct 23 23:35:38 2006
+++ src/osdep/unix/Makefile	Wed Nov 22 11:56:23 2006
d14 114
@


1.6
log
@move to imap-2004e. SSL keys moved to /etc/ssl/private as described in ssl(8)
@
text
@d1 1
a1 1
$OpenBSD: patch-src_osdep_unix_Makefile,v 1.5 2003/10/05 22:00:00 jakob Exp $
d3 3
a5 3
--- src/osdep/unix/Makefile.orig	Sat Apr 30 22:51:13 2005
+++ src/osdep/unix/Makefile	Fri Jul 29 19:27:10 2005
@@@@ -36,14 +36,14 @@@@ IP=4
d13 1
a13 11
 # Extended flags needed for SSL.  You may need to modify.
 
-SSLDIR=/usr/local/ssl
-SSLCERTS=$(SSLDIR)/certs
-SSLKEYS=$(SSLCERTS)
+SSLDIR=/usr
+SSLCERTS=/etc/ssl
+SSLKEYS=$(SSLCERTS)/private
 SSLINCLUDE=$(SSLDIR)/include
 SSLLIB=$(SSLDIR)/lib
 
@


1.5
log
@update to imap-2002e, minor release (stability fixes)
@
text
@d1 1
a1 1
$OpenBSD: patch-src_osdep_unix_Makefile,v 1.4 2002/10/05 15:22:27 jakob Exp $
d3 9
a11 3
--- src/osdep/unix/Makefile.orig	Tue Jul 15 03:24:24 2003
+++ src/osdep/unix/Makefile	Sun Oct  5 23:45:11 2003
@@@@ -28,8 +28,8 @@@@ SSLTYPE=nopwd
d17 1
d20 1
a20 1
 SSLKEYS=$(SSLCERTS)
a22 6
@@@@ -235,7 +235,7 @@@@ bso:	# OpenBSD
 	 SPOOLDIR=/var \
 	 ACTIVEFILE=/usr/local/news/lib/active \
 	 RSHPATH=/usr/bin/rsh \
-	 BASECFLAGS="-O2 -pipe"
+	 BASECFLAGS="-pipe"
a23 2
 cvx:	# Convex
 	$(BUILD) `$(CAT) SPECIALS` OS=$@@ \
@


1.4
log
@update to rc7, -stable will be update once we have a final release
@
text
@d1 1
a1 1
$OpenBSD: patch-src_osdep_unix_Makefile,v 1.3 2002/09/18 08:19:06 jakob Exp $
d3 2
a4 2
--- src/osdep/unix/Makefile.orig	Tue Oct  1 21:31:19 2002
+++ src/osdep/unix/Makefile	Sat Oct  5 17:12:58 2002
d13 1
d16 1
a16 2
 
@@@@ -234,7 +234,7 @@@@ bso:	# OpenBSD
@


1.3
log
@- update to imap release 2002rc6
- conflict with courier-imap and courier-pop3
- imaputils-uw moved into imap-uw package, also availible as subpackage
@
text
@d1 1
a1 1
$OpenBSD: patch-src_osdep_unix_Makefile,v 1.2 2001/11/18 19:49:22 jakob Exp $
d3 3
a5 3
--- src/osdep/unix/Makefile.orig	Sat Mar  2 06:50:36 2002
+++ src/osdep/unix/Makefile	Sun Sep  8 14:55:23 2002
@@@@ -28,8 +28,8 @@@@ SSLTYPE=none
@


1.3.2.1
log
@MFC:
maintenance update to release version
requested by jakob@@
@
text
@d1 1
a1 1
$OpenBSD$
d3 3
a5 3
--- src/osdep/unix/Makefile.orig	Tue Oct  1 21:31:19 2002
+++ src/osdep/unix/Makefile	Sat Oct  5 17:12:58 2002
@@@@ -28,8 +28,8 @@@@ SSLTYPE=nopwd
@


1.2
log
@simplify patch, shared library tweeks no longer needed
@
text
@d1 1
a1 1
$OpenBSD: patch-src_osdep_unix_Makefile,v 1.1 2001/09/24 22:01:49 jakob Exp $
d3 3
a5 3
--- src/osdep/unix/Makefile.orig	Tue Jul  3 08:02:10 2001
+++ src/osdep/unix/Makefile	Sun Aug 26 12:49:37 2001
@@@@ -28,8 +28,8 @@@@
d16 1
a16 1
@@@@ -234,7 +237,7 @@@@
@


1.2.2.1
log
@update to imap release 2002a.DEV.SNAP-0212051126 aka 2002.234, fixes
post-login buffer overflow.
@
text
@d1 1
a1 1
$OpenBSD: patch-src_osdep_unix_Makefile,v 1.3.2.1 2002/11/21 22:45:27 naddy Exp $
d3 3
a5 3
--- src/osdep/unix/Makefile.orig	Tue Oct  1 21:31:19 2002
+++ src/osdep/unix/Makefile	Sat Oct  5 17:12:58 2002
@@@@ -28,8 +28,8 @@@@ SSLTYPE=nopwd
d16 1
a16 1
@@@@ -234,7 +234,7 @@@@ bso:	# OpenBSD
@


1.1
log
@update to version 2001.313
- no longer depend on c-client
- enable gssapi (kerberos5) support
@
text
@d1 1
a1 1
$OpenBSD$
a15 24
@@@@ -107,6 +107,7 @@@@
 DEFAULTAUTHENTICATORS=md5 pla log
 DEFAULTDRIVERS=imap nntp pop3 mh mx mbx tenex mtx mmdf unix news phile
 
+.SUFFIXES: .o .so
 
 # Normally no need to change any of these
 
@@@@ -115,6 +116,7 @@@@
  dummy.o pseudo.o netmsg.o flstring.o fdstring.o \
  rfc822.o nntp.o smtp.o imap4r1.o pop3.o \
  unix.o mbox.o mbx.o mmdf.o tenex.o mtx.o news.o phile.o mh.o mx.o
+SOBINARIES=$(BINARIES:.o=.so)
 CFLAGS=-g
 
 CAT=cat
@@@@ -123,6 +125,7 @@@@
 RM=rm -rf
 SH=sh
 
+PICFLAG= -fpic
 
 # Primary build command
 
a24 56
@@@@ -762,23 +765,29 @@@@
 
 # Build it!
 
-build:	clean once $(ARCHIVE)
+build:	clean once $(ARCHIVE) $(SHLIB)
 
-all:	$(ARCHIVE)
+all:	$(ARCHIVE) $(SHLIB)
 
 $(ARCHIVE): $(BINARIES)
 	sh -c '$(RM) $(ARCHIVE) || true'
 	@@$(CAT) ARCHIVE
 	@@$(SH) ARCHIVE
 
+$(SHLIB): $(SOBINARIES)
+	$(CC) -shared $(PICFLAG) -o $(SHLIB) $(SOBINARIES)
+
 .c.o:
 	`$(CAT) CCTYPE` -c `$(CAT) CFLAGS` $*.c
 
+.c.so:
+	`$(CAT) CCTYPE` -c `$(CAT) CFLAGS` $(PICFLAG) -DPIC $(@@:.so=.c) -o $@@
+
 
 # Cleanup
 
 clean:
-	sh -c '$(RM) auths.c crexcl.c nfstest.c linkage.[ch] siglocal.c osdep*.[ch] *.o ARCHIVE *FLAGS *TYPE $(ARCHIVE) || true'
+	sh -c '$(RM) auths.c crexcl.c nfstest.c linkage.[ch] siglocal.c osdep*.[ch] *.o *.so ARCHIVE *FLAGS *TYPE $(ARCHIVE) $(SHLIB) || true'
 
 
 # Dependencies
@@@@ -812,7 +821,7 @@@@
 
 # OS-dependent
 
-osdep.o:mail.h misc.h env.h fs.h ftl.h nl.h tcp.h \
+OSDEPS=	mail.h misc.h env.h fs.h ftl.h nl.h tcp.h \
 	osdep.h env_unix.h tcp_unix.h \
 	osdep.c env_unix.c fs_unix.c ftl_unix.c nl_unix.c tcp_unix.c \
 	auths.c crexcl.c flocksim.c nfstest.c flcksafe.c fsync.c gethstid.c \
@@@@ -824,7 +833,12 @@@@
 	write.c sslstdio.c \
 	strerror.c strpbrk.c strstr.c strtok.c strtoul.c \
 	OSCFLAGS
-	`$(CAT) CCTYPE` -c `$(CAT) CFLAGS` `$(CAT) OSCFLAGS` -c osdep.c
+
+osdep.o: $(OSDEPS)
+	`$(CAT) CCTYPE` -c `$(CAT) CFLAGS` `$(CAT) OSCFLAGS` osdep.c
+
+osdep.so: $(OSDEPS)
+	`$(CAT) CCTYPE` -c `$(CAT) CFLAGS` `$(CAT) OSCFLAGS` $(PICFLAG) -DPIC osdep.c -o $@@
 
 osdep.c: osdepbas.c osdepckp.c osdeplog.c osdepssl.c
 	$(CAT) osdepbas.c osdepckp.c osdeplog.c osdepssl.c > osdep.c
@

