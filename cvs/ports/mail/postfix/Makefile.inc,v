head	1.92;
access;
symbols
	OPENBSD_6_1:1.92.0.2
	OPENBSD_6_1_BASE:1.92
	OPENBSD_6_0:1.91.0.8
	OPENBSD_6_0_BASE:1.91
	OPENBSD_5_9:1.91.0.4
	OPENBSD_5_9_BASE:1.91
	OPENBSD_5_8:1.91.0.6
	OPENBSD_5_8_BASE:1.91
	OPENBSD_5_7:1.91.0.2
	OPENBSD_5_7_BASE:1.91
	OPENBSD_5_6:1.89.0.6
	OPENBSD_5_6_BASE:1.89
	OPENBSD_5_5:1.89.0.4
	OPENBSD_5_5_BASE:1.89
	OPENBSD_5_4:1.89.0.2
	OPENBSD_5_4_BASE:1.89
	OPENBSD_5_3:1.86.0.2
	OPENBSD_5_3_BASE:1.86
	OPENBSD_5_2:1.85.0.2
	OPENBSD_5_2_BASE:1.85
	OPENBSD_5_1_BASE:1.83
	OPENBSD_5_1:1.83.0.2
	OPENBSD_5_0:1.81.0.2
	OPENBSD_5_0_BASE:1.81
	OPENBSD_4_9:1.76.0.2
	OPENBSD_4_9_BASE:1.76
	OPENBSD_4_8:1.70.0.4
	OPENBSD_4_8_BASE:1.70
	OPENBSD_4_7:1.70.0.2
	OPENBSD_4_7_BASE:1.70
	OPENBSD_4_6:1.69.0.2
	OPENBSD_4_6_BASE:1.69
	OPENBSD_4_5:1.68.0.6
	OPENBSD_4_5_BASE:1.68
	OPENBSD_4_4:1.68.0.4
	OPENBSD_4_4_BASE:1.68
	OPENBSD_4_3:1.68.0.2
	OPENBSD_4_3_BASE:1.68
	OPENBSD_4_2:1.64.0.2
	OPENBSD_4_2_BASE:1.64
	OPENBSD_4_1:1.62.0.2
	OPENBSD_4_1_BASE:1.62
	OPENBSD_4_0:1.56.0.2
	OPENBSD_4_0_BASE:1.56
	OPENBSD_3_9:1.52.0.2
	OPENBSD_3_9_BASE:1.52
	OPENBSD_3_8:1.50.0.2
	OPENBSD_3_8_BASE:1.50
	OPENBSD_3_7:1.48.0.2
	OPENBSD_3_7_BASE:1.48
	OPENBSD_3_6:1.40.0.2
	OPENBSD_3_6_BASE:1.40
	OPENBSD_3_5:1.35.0.2
	OPENBSD_3_5_BASE:1.35
	OPENBSD_3_4:1.29.0.2
	OPENBSD_3_4_BASE:1.29
	OPENBSD_3_3:1.25.0.2
	OPENBSD_3_3_BASE:1.25
	OPENBSD_3_2:1.18.0.2
	OPENBSD_3_2_BASE:1.18
	OPENBSD_3_1:1.15.0.2
	OPENBSD_3_1_BASE:1.15
	OPENBSD_3_0:1.8.0.2
	OPENBSD_3_0_BASE:1.8
	OPENBSD_2_9_TRACKING_SWITCH:1.5
	OPENBSD_2_9:1.4.0.2
	OPENBSD_2_9_BASE:1.4
	OPENBSD_2_8:1.3.0.2
	OPENBSD_2_8_BASE:1.3;
locks; strict;
comment	@# @;


1.92
date	2016.09.23.09.16.56;	author sthen;	state Exp;
branches;
next	1.91;
commitid	XLnI6AbHAmyVU5mO;

1.91
date	2014.09.13.18.09.21;	author brad;	state Exp;
branches;
next	1.90;
commitid	PpbRjVZdAmlrmi8q;

1.90
date	2014.08.25.09.43.10;	author brad;	state Exp;
branches;
next	1.89;
commitid	wRP00PO5SqurDm9T;

1.89
date	2013.06.12.20.36.33;	author brad;	state Exp;
branches;
next	1.88;

1.88
date	2013.05.25.00.33.10;	author brad;	state Exp;
branches;
next	1.87;

1.87
date	2013.03.11.11.23.53;	author espie;	state Exp;
branches;
next	1.86;

1.86
date	2013.02.09.14.49.51;	author sthen;	state Exp;
branches;
next	1.85;

1.85
date	2012.05.16.14.40.08;	author sthen;	state Exp;
branches;
next	1.84;

1.84
date	2012.04.23.17.15.18;	author espie;	state Exp;
branches;
next	1.83;

1.83
date	2011.12.01.10.26.52;	author sthen;	state Exp;
branches;
next	1.82;

1.82
date	2011.11.13.16.20.00;	author sthen;	state Exp;
branches;
next	1.81;

1.81
date	2011.05.09.21.56.13;	author sthen;	state Exp;
branches;
next	1.80;

1.80
date	2011.03.10.12.07.24;	author sthen;	state Exp;
branches;
next	1.79;

1.79
date	2011.03.09.10.45.27;	author sthen;	state Exp;
branches;
next	1.78;

1.78
date	2011.03.07.13.00.53;	author sthen;	state Exp;
branches;
next	1.77;

1.77
date	2011.03.06.09.36.29;	author jakob;	state Exp;
branches;
next	1.76;

1.76
date	2011.01.07.19.22.06;	author sthen;	state Exp;
branches;
next	1.75;

1.75
date	2010.11.22.09.28.34;	author espie;	state Exp;
branches;
next	1.74;

1.74
date	2010.11.19.07.23.09;	author espie;	state Exp;
branches;
next	1.73;

1.73
date	2010.11.11.10.57.40;	author espie;	state Exp;
branches;
next	1.72;

1.72
date	2010.08.31.06.03.32;	author jakob;	state Exp;
branches;
next	1.71;

1.71
date	2010.08.22.09.04.29;	author jakob;	state Exp;
branches;
next	1.70;

1.70
date	2009.07.18.20.26.18;	author naddy;	state Exp;
branches;
next	1.69;

1.69
date	2009.03.17.19.32.44;	author sthen;	state Exp;
branches;
next	1.68;

1.68
date	2008.02.29.12.25.22;	author jakob;	state Exp;
branches;
next	1.67;

1.67
date	2008.02.01.16.37.09;	author jakob;	state Exp;
branches;
next	1.66;

1.66
date	2007.10.25.21.05.33;	author steven;	state Exp;
branches;
next	1.65;

1.65
date	2007.09.16.00.17.06;	author merdely;	state Exp;
branches;
next	1.64;

1.64
date	2007.05.31.10.19.00;	author espie;	state Exp;
branches;
next	1.63;

1.63
date	2007.03.19.10.24.51;	author ajacoutot;	state Exp;
branches;
next	1.62;

1.62
date	2006.11.20.19.57.34;	author jakob;	state Exp;
branches;
next	1.61;

1.61
date	2006.11.19.21.17.45;	author jakob;	state Exp;
branches;
next	1.60;

1.60
date	2006.11.13.07.45.05;	author jakob;	state Exp;
branches;
next	1.59;

1.59
date	2006.10.25.22.44.09;	author jolan;	state dead;
branches;
next	1.58;

1.58
date	2006.10.18.17.42.28;	author sturm;	state Exp;
branches;
next	1.57;

1.57
date	2006.10.12.08.36.16;	author jakob;	state Exp;
branches;
next	1.56;

1.56
date	2006.08.03.23.15.57;	author espie;	state Exp;
branches;
next	1.55;

1.55
date	2006.08.03.19.56.08;	author espie;	state Exp;
branches;
next	1.54;

1.54
date	2006.07.17.08.52.13;	author jakob;	state Exp;
branches;
next	1.53;

1.53
date	2006.06.07.20.43.08;	author jakob;	state Exp;
branches;
next	1.52;

1.52
date	2005.09.16.01.06.52;	author brad;	state Exp;
branches;
next	1.51;

1.51
date	2005.09.12.14.34.57;	author krw;	state Exp;
branches;
next	1.50;

1.50
date	2005.05.06.16.35.41;	author brad;	state Exp;
branches;
next	1.49;

1.49
date	2005.04.08.20.16.31;	author jakob;	state Exp;
branches;
next	1.48;

1.48
date	2005.03.10.07.26.27;	author jakob;	state Exp;
branches
	1.48.2.1;
next	1.47;

1.47
date	2005.03.07.18.26.39;	author brad;	state Exp;
branches;
next	1.46;

1.46
date	2004.12.29.07.05.07;	author jakob;	state Exp;
branches;
next	1.45;

1.45
date	2004.12.28.09.27.13;	author jakob;	state Exp;
branches;
next	1.44;

1.44
date	2004.12.28.09.00.46;	author jakob;	state Exp;
branches;
next	1.43;

1.43
date	2004.12.28.08.25.34;	author jakob;	state Exp;
branches;
next	1.42;

1.42
date	2004.11.24.07.40.54;	author jakob;	state Exp;
branches;
next	1.41;

1.41
date	2004.10.18.06.48.31;	author jakob;	state Exp;
branches;
next	1.40;

1.40
date	2004.07.26.22.44.40;	author jakob;	state Exp;
branches;
next	1.39;

1.39
date	2004.06.22.05.20.12;	author brad;	state Exp;
branches;
next	1.38;

1.38
date	2004.06.10.21.22.25;	author jakob;	state Exp;
branches;
next	1.37;

1.37
date	2004.04.25.10.36.39;	author jakob;	state Exp;
branches;
next	1.36;

1.36
date	2004.04.01.08.11.17;	author jakob;	state Exp;
branches;
next	1.35;

1.35
date	2004.02.16.07.37.46;	author djm;	state Exp;
branches;
next	1.34;

1.34
date	2004.01.14.17.30.59;	author jakob;	state Exp;
branches;
next	1.33;

1.33
date	2004.01.02.12.18.05;	author jakob;	state Exp;
branches;
next	1.32;

1.32
date	2004.01.02.11.26.19;	author jakob;	state Exp;
branches;
next	1.31;

1.31
date	2004.01.02.05.11.08;	author brad;	state Exp;
branches;
next	1.30;

1.30
date	2003.11.24.18.52.05;	author jakob;	state Exp;
branches;
next	1.29;

1.29
date	2003.08.16.06.57.50;	author pvalchev;	state Exp;
branches;
next	1.28;

1.28
date	2003.06.23.19.11.11;	author sturm;	state Exp;
branches;
next	1.27;

1.27
date	2003.05.01.15.46.38;	author sturm;	state Exp;
branches;
next	1.26;

1.26
date	2003.04.10.18.08.56;	author jsyn;	state Exp;
branches;
next	1.25;

1.25
date	2003.03.16.05.55.51;	author pvalchev;	state Exp;
branches;
next	1.24;

1.24
date	2003.03.02.05.37.24;	author david;	state Exp;
branches;
next	1.23;

1.23
date	2003.01.13.15.44.36;	author jakob;	state Exp;
branches;
next	1.22;

1.22
date	2003.01.06.11.30.16;	author jakob;	state Exp;
branches;
next	1.21;

1.21
date	2003.01.01.13.11.23;	author jakob;	state Exp;
branches;
next	1.20;

1.20
date	2002.12.25.11.48.46;	author jakob;	state Exp;
branches;
next	1.19;

1.19
date	2002.10.27.17.21.39;	author naddy;	state Exp;
branches;
next	1.18;

1.18
date	2002.09.07.19.09.05;	author jakob;	state Exp;
branches;
next	1.17;

1.17
date	2002.05.15.06.20.04;	author jakob;	state Exp;
branches;
next	1.16;

1.16
date	2002.04.19.21.11.57;	author jakob;	state Exp;
branches;
next	1.15;

1.15
date	2002.01.25.08.14.29;	author jakob;	state Exp;
branches;
next	1.14;

1.14
date	2001.11.28.09.35.14;	author jakob;	state Exp;
branches;
next	1.13;

1.13
date	2001.11.15.07.36.35;	author jakob;	state Exp;
branches;
next	1.12;

1.12
date	2001.11.11.13.48.17;	author espie;	state Exp;
branches;
next	1.11;

1.11
date	2001.10.26.18.40.23;	author jakob;	state Exp;
branches;
next	1.10;

1.10
date	2001.10.25.21.35.38;	author jakob;	state Exp;
branches;
next	1.9;

1.9
date	2001.10.24.12.22.45;	author espie;	state Exp;
branches;
next	1.8;

1.8
date	2001.09.28.23.35.18;	author jakob;	state Exp;
branches;
next	1.7;

1.7
date	2001.09.28.23.32.47;	author jakob;	state Exp;
branches;
next	1.6;

1.6
date	2001.09.14.23.48.45;	author jakob;	state Exp;
branches;
next	1.5;

1.5
date	2001.05.29.06.11.36;	author jakob;	state Exp;
branches;
next	1.4;

1.4
date	2001.03.24.19.55.49;	author jakob;	state Exp;
branches
	1.4.2.1;
next	1.3;

1.3
date	2000.10.05.21.08.38;	author jakob;	state Exp;
branches;
next	1.2;

1.2
date	2000.10.05.20.58.34;	author jakob;	state Exp;
branches;
next	1.1;

1.1
date	2000.09.25.21.02.29;	author jakob;	state Exp;
branches;
next	;

1.4.2.1
date	2001.05.29.12.12.59;	author naddy;	state Exp;
branches;
next	;

1.48.2.1
date	2005.08.31.19.51.41;	author sturm;	state Exp;
branches;
next	;


desc
@@


1.92
log
@Cope with moving sqlite3 back to ports.
@
text
@# $OpenBSD: Makefile.inc,v 1.91 2014/09/13 18:09:21 brad Exp $

COMMENT=	fast, secure sendmail replacement

DISTNAME=	postfix-${VERSION}
PKGNAME=	postfix-${VERSION:S/-/./}
CATEGORIES=	mail

MASTER_SITE_POSTFIX= \
		http://ftp.porcupine.org/mirrors/postfix-release/ \
		http://de.postfix.org/ftpmirror/ \
		http://mirror.tje.me.uk/pub/mirrors/postfix-release/ \
		http://mirror.postfix.jp/postfix-release/ \
		ftp://ftp.porcupine.org/mirrors/postfix-release/ \
		ftp://ftp.cs.uu.nl/mirror/postfix/postfix-release/

DIST_SUBDIR=	postfix
DISTFILES=	${DISTNAME}${EXTRACT_SUFX}

HOMEPAGE=	http://www.postfix.org/

MAINTAINER=	Brad Smith <brad@@comstyle.com>

PERMIT_PACKAGE_CDROM=	cannot be sold, see section 4 of license
PERMIT_PACKAGE_FTP=	yes
PERMIT_DISTFILES_FTP=	yes

LIB_DEPENDS+=	devel/pcre

MAKE_DEBUG?=
MAKE_CCARGS+=	-I. -I../../include
MAKE_CCARGS+=	-DDEF_CONFIG_DIR=\"${SYSCONFDIR}/postfix\"
MAKE_CCARGS+=	-DDEF_DATA_DIR=\"/var/postfix\"
MAKE_CCARGS+=	-DHAS_SQLITE
MAKE_CCARGS+=	-DUSE_TLS
MAKE_CCARGS+=	-DUSE_SASL_AUTH
# no UTF-8 support for now
MAKE_CCARGS+=	-DNO_EAI
MAKE_AUXLIBS+=	-lssl -lcrypto -lsqlite3 -pthread

WANTLIB=	c crypto pcre pthread sqlite3 ssl
LIB_DEPENDS+=	databases/sqlite3

ALL_TARGET=	default

NO_TEST=	Yes

FLAVORS+=	sasl2 ldap mysql pgsql db4
FLAVOR?=

.if ${FLAVOR:Msasl2}
LIB_DEPENDS+=	security/cyrus-sasl2
WANTLIB+=	sasl2
MAKE_CCARGS+=	-DUSE_CYRUS_SASL -I${LOCALBASE}/include -I${LOCALBASE}/include/sasl
MAKE_AUXLIBS+=	-L${LOCALBASE}/lib -lsasl2
.endif

.if ${FLAVOR:Mldap}
LIB_DEPENDS+=	databases/openldap>=2,<3
WANTLIB+=	ldap>=2 lber
MAKE_CCARGS+=	-DHAS_LDAP -I${LOCALBASE}/include
MAKE_AUXLIBS+=	-L${LOCALBASE}/lib -lldap -llber
.endif

.if ${FLAVOR:Mmysql}
LIB_DEPENDS+=	databases/mariadb
WANTLIB+=	lib/mysql/mysqlclient
MAKE_CCARGS+=	-DHAS_MYSQL -I${LOCALBASE}/include/mysql
MAKE_AUXLIBS+=	-L${LOCALBASE}/lib/mysql -lmysqlclient
.endif

.if ${FLAVOR:Mpgsql}
LIB_DEPENDS+=	databases/postgresql
WANTLIB+=	pq>=3
MAKE_CCARGS+=	-DHAS_PGSQL -I${LOCALBASE}/include/postgresql
MAKE_AUXLIBS+=	-L${LOCALBASE}/lib -lpq
.endif

.if ${FLAVOR:Mdb4}
LIB_DEPENDS+=	databases/db/v4>=4,<5
WANTLIB+=	lib/db4/db>=4
MAKE_CCARGS+=	-I${LOCALBASE}/include/db4
MAKE_AUXLIBS+=	-L${LOCALBASE}/lib/db4 -ldb
.endif

pre-configure:
	@@perl -pi -e 's,/cyrus/bin,${LOCALBASE}/libexec/cyrus-imapd,g' \
		${WRKSRC}/conf/master.cf

do-configure:
	@@cd ${WRKSRC}; ${MAKE_PROGRAM} makefiles \
		CC="${CC}" OPT="${CFLAGS}" DEBUG="${MAKE_DEBUG}" \
		CCARGS='${MAKE_CCARGS}' AUXLIBS="${MAKE_AUXLIBS}"

do-install:
	${INSTALL_DATA_DIR} ${PREFIX}/share/examples/postfix
	@@(cd ${WRKSRC}; sh postfix-install \
		-non-interactive \
		mail_owner=_postfix \
		setgid_group=_postdrop \
		install_root=${WRKINST} \
		data_directory=/var/postfix \
		queue_directory=/var/spool/postfix \
		daemon_directory=${TRUEPREFIX}/libexec/postfix \
		command_directory=${TRUEPREFIX}/sbin \
		sendmail_path=${TRUEPREFIX}/sbin/sendmail \
		newaliases_path=${TRUEPREFIX}/sbin/newaliases \
		mailq_path=${TRUEPREFIX}/sbin/mailq \
		manpage_directory=${TRUEPREFIX}/man \
		readme_directory=${TRUEPREFIX}/share/doc/postfix/readme \
		html_directory=${TRUEPREFIX}/share/doc/postfix/html \
		)
	${INSTALL_SCRIPT} ${FILESDIR}/postfix-enable ${PREFIX}/sbin
	${INSTALL_SCRIPT} ${FILESDIR}/postfix-disable ${PREFIX}/sbin
	${INSTALL_SCRIPT} ${FILESDIR}/postfix-install ${PREFIX}/sbin
	${INSTALL_SCRIPT} ${WRKSRC}/auxiliary/qshape/qshape.pl ${PREFIX}/sbin/qshape
	${INSTALL_MAN} ${WRKSRC}/man/man1/qshape.1 ${PREFIX}/man/man1
	@@mv ${WRKINST}${SYSCONFDIR}/postfix/* ${PREFIX}/share/examples/postfix
	@@rm -fr ${WRKINST}/var/postfix
	@@rm -fr ${WRKINST}/var/spool/postfix
	@@chown -h ${BINOWN}:${BINGRP} ${PREFIX}/{sbin,libexec/postfix}/*
	@@chown -R ${MANOWN}:${MANGRP} ${PREFIX}/man
	@@chown -R ${SHAREOWN}:${SHAREGRP} ${PREFIX}/share
@


1.91
log
@Switch from using MySQL to using MariaDB attempt #2. MariaDB is a drop-in replacement.

ok sthen@@
@
text
@d1 1
a1 1
# $OpenBSD: Makefile.inc,v 1.90 2014/08/25 09:43:10 brad Exp $
d42 1
@


1.90
log
@Don't try to utilize libicu4c if it is installed.
@
text
@d1 1
a1 1
# $OpenBSD: Makefile.inc,v 1.89 2013/06/12 20:36:33 brad Exp $
d65 2
a66 2
LIB_DEPENDS+=	databases/mysql
WANTLIB+=	lib/mysql/mysqlclient>=10
@


1.89
log
@Revert back to using MySQL 5.1 for the time being. MariaDB 5.5 introduces
a new libmysqlclient non-blocking API which utilizes co-routines. The X86
specific GCC ASM co-routine support hid the fact that there was an issue.
The only fallback code so far is POSIX user contexts which OpenBSD does not
support.

Input from and Ok sthen@@ jasper@@
@
text
@d1 1
a1 1
# $OpenBSD: Makefile.inc,v 1.88 2013/05/25 00:33:10 brad Exp $
d37 2
@


1.88
log
@Switch from using MySQL to using MariaDB. MariaDB is a drop-in replacement.


ok sthen aja
@
text
@d1 1
a1 1
# $OpenBSD: Makefile.inc,v 1.87 2013/03/11 11:23:53 espie Exp $
d63 1
a63 1
LIB_DEPENDS+=	databases/mariadb
@


1.87
log
@PERMIT_* / REGRESS->TEST sweep
@
text
@d1 1
a1 1
# $OpenBSD: Makefile.inc,v 1.86 2013/02/09 14:49:51 sthen Exp $
d63 1
a63 1
LIB_DEPENDS+=	databases/mysql
@


1.86
log
@Don't use ${FLAVOR:L}, we only support lower-case flavours now.
OK ajacoutot@@ espie@@
@
text
@d1 1
a1 1
# $OpenBSD: Makefile.inc,v 1.85 2012/05/16 14:40:08 sthen Exp $
a25 1
PERMIT_DISTFILES_CDROM=	cannot be sold, see section 4 of license
d43 1
a43 1
NO_REGRESS=	Yes
@


1.85
log
@Roll sqlite support into the main package; there's no point having it
as an optional flavour now that sqlite is in base. From Brad.
@
text
@d1 1
a1 1
# $OpenBSD: Makefile.inc,v 1.84 2012/04/23 17:15:18 espie Exp $
d49 1
a49 1
.if ${FLAVOR:L:Msasl2}
d56 1
a56 1
.if ${FLAVOR:L:Mldap}
d63 1
a63 1
.if ${FLAVOR:L:Mmysql}
d70 1
a70 1
.if ${FLAVOR:L:Mpgsql}
d77 1
a77 1
.if ${FLAVOR:L:Mdb4}
@


1.84
log
@first pass at handling sqlite3 move
@
text
@d1 1
a1 1
# $OpenBSD: Makefile.inc,v 1.83 2011/12/01 10:26:52 sthen Exp $
d35 1
d38 1
a38 1
MAKE_AUXLIBS+=	-lssl -lcrypto
d40 1
a40 1
WANTLIB=	c crypto ssl pcre
d46 1
a46 1
FLAVORS+=	sasl2 ldap mysql pgsql db4 sqlite
a81 6
.endif

.if ${FLAVOR:L:Msqlite}
WANTLIB+=	pthread sqlite3
MAKE_CCARGS+=	-DHAS_SQLITE -I${LOCALBASE}/include
MAKE_AUXLIBS+=	-L${LOCALBASE}/lib -lsqlite3 -pthread
@


1.83
log
@Update postfix -snapshot to 20111129. Based on a diff for 1122 from Brad,
updated to 1129 by me and OK Brad.
@
text
@d1 1
a1 1
# $OpenBSD: Makefile.inc,v 1.82 2011/11/13 16:20:00 sthen Exp $
a83 1
LIB_DEPENDS+=	databases/sqlite3
@


1.82
log
@fix building on a clean machine (broken due to changes in postconf) -
reported by nigel@@, ok Brad.
@
text
@d1 1
a1 1
# $OpenBSD: Makefile.inc,v 1.81 2011/05/09 21:56:13 sthen Exp $
d101 1
a101 1
	@@(cd ${WRKSRC}; env SYSCONFDIR=${SYSCONFDIR} sh postfix-install \
@


1.81
log
@SECURITY update to 2.8.3 (postfix/stable) / 2.9-20110501 (postfix/snapshot).

See http://www.postfix.org/CVE-2011-1720.html for info: this is a memory
corruption bug affecting users of -sasl2 packages who have enabled SASL
using auth mechanisms other than PLAIN/LOGIN. (This is not an especially
common configuration as the affected mechanisms require keeping plaintext
passwords on mail servers).

OK jasper@@, Brad (maintainer).
@
text
@d1 1
a1 1
# $OpenBSD: Makefile.inc,v 1.80 2011/03/10 12:07:24 sthen Exp $
d101 1
a101 1
	@@(cd ${WRKSRC}; sh postfix-install \
@


1.80
log
@whitespace cleanup, don't hide do-install targets with @@; from Brad
add HTTP URL as first entry in MASTER_SITES; from me, ok Brad
@
text
@d1 1
a1 1
# $OpenBSD: Makefile.inc,v 1.79 2011/03/09 10:45:27 sthen Exp $
d11 3
a14 3
		ftp://ftp.merit.edu/postfix/ \
		ftp://ftp.sunet.se/pub/unix/mail/postfix/ \
		ftp://ftp.tau.ac.il/pub/unix/mail/postfix/ \
@


1.79
log
@switch to more compact LIB_DEPENDS style and drop the explicit
HAS_PCRE (makedefs picks this up automatically from pcre-config now).
from Brad.
@
text
@d1 1
a1 1
# $OpenBSD: Makefile.inc,v 1.78 2011/03/07 13:00:53 sthen Exp $
d5 2
a6 2
DISTNAME ?=	postfix-${VERSION}
PKGNAME ?=	postfix-${VERSION:S/-/./}
d9 2
a10 1
MASTER_SITE_POSTFIX=\
d29 1
a29 1
LIB_DEPENDS +=	devel/pcre
d31 7
a37 7
MAKE_DEBUG ?=
MAKE_CCARGS +=	-I. -I../../include
MAKE_CCARGS +=	-DDEF_CONFIG_DIR=\"${SYSCONFDIR}/postfix\"
MAKE_CCARGS +=	-DDEF_DATA_DIR=\"/var/postfix\"
MAKE_CCARGS +=	-DUSE_TLS
MAKE_CCARGS +=	-DUSE_SASL_AUTH
MAKE_AUXLIBS +=	-lssl -lcrypto
d45 2
a46 2
FLAVORS +=	sasl2 ldap mysql pgsql db4 sqlite
FLAVOR ?=
d49 4
a52 4
LIB_DEPENDS +=	security/cyrus-sasl2
WANTLIB +=	sasl2
MAKE_CCARGS +=	-DUSE_CYRUS_SASL -I${LOCALBASE}/include -I${LOCALBASE}/include/sasl
MAKE_AUXLIBS +=	-L${LOCALBASE}/lib -lsasl2
d56 4
a59 4
LIB_DEPENDS +=	databases/openldap>=2,<3
WANTLIB +=	ldap>=2 lber
MAKE_CCARGS +=	-DHAS_LDAP -I${LOCALBASE}/include
MAKE_AUXLIBS +=	-L${LOCALBASE}/lib -lldap -llber
d63 4
a66 4
LIB_DEPENDS +=	databases/mysql
WANTLIB +=	lib/mysql/mysqlclient>=10
MAKE_CCARGS +=	-DHAS_MYSQL -I${LOCALBASE}/include/mysql
MAKE_AUXLIBS +=	-L${LOCALBASE}/lib/mysql -lmysqlclient
d70 4
a73 4
LIB_DEPENDS +=	databases/postgresql
WANTLIB +=	pq>=3
MAKE_CCARGS +=	-DHAS_PGSQL -I${LOCALBASE}/include/postgresql
MAKE_AUXLIBS +=	-L${LOCALBASE}/lib -lpq
d77 4
a80 4
LIB_DEPENDS +=	databases/db/v4>=4,<5
WANTLIB +=	lib/db4/db>=4
MAKE_CCARGS +=	-I${LOCALBASE}/include/db4
MAKE_AUXLIBS +=	-L${LOCALBASE}/lib/db4 -ldb
d84 4
a87 4
LIB_DEPENDS +=	databases/sqlite3
WANTLIB +=	pthread sqlite3
MAKE_CCARGS +=	-DHAS_SQLITE -I${LOCALBASE}/include
MAKE_AUXLIBS +=	-L${LOCALBASE}/lib -lsqlite3 -pthread
d100 1
d117 5
a121 6
	@@${INSTALL_SCRIPT} ${FILESDIR}/postfix-enable ${PREFIX}/sbin
	@@${INSTALL_SCRIPT} ${FILESDIR}/postfix-disable ${PREFIX}/sbin
	@@${INSTALL_SCRIPT} ${FILESDIR}/postfix-install ${PREFIX}/sbin
	@@${INSTALL_SCRIPT} ${WRKSRC}/auxiliary/qshape/qshape.pl ${PREFIX}/sbin/qshape
	@@${INSTALL_MAN} ${WRKSRC}/man/man1/qshape.1 ${PREFIX}/man/man1
	@@${INSTALL_DATA_DIR} ${PREFIX}/share/examples/postfix
@


1.78
log
@switch maintainer to Brad, suggested by jakob@@ (current maintainer).
@
text
@d1 1
a1 1
# $OpenBSD: Makefile.inc,v 1.77 2011/03/06 09:36:29 jakob Exp $
d28 2
d31 1
d35 1
a43 7
MAKE_CCARGS +=	-DUSE_SASL_AUTH

# always include pcre
LIB_DEPENDS +=	devel/pcre
MAKE_CCARGS +=	-DHAS_PCRE -I${LOCALBASE}/include
MAKE_AUXLIBS +=	-L${LOCALBASE}/lib -lpcre

d50 1
a50 1
MAKE_CCARGS +=	-I${LOCALBASE}/include -I${LOCALBASE}/include/sasl -DUSE_CYRUS_SASL
d55 1
a55 1
LIB_DEPENDS +=	openldap-client->=2,<3:databases/openldap
d57 1
a57 1
MAKE_CCARGS +=	-I${LOCALBASE}/include -DHAS_LDAP
d64 1
a64 1
MAKE_CCARGS +=	-I${LOCALBASE}/include/mysql -DHAS_MYSQL
d71 1
a71 1
MAKE_CCARGS +=	-I${LOCALBASE}/include/postgresql -DHAS_PGSQL
d76 1
a76 1
LIB_DEPENDS +=	db->=4,<5:databases/db/v4
d85 1
a85 1
MAKE_CCARGS +=	-I${LOCALBASE}/include -DHAS_SQLITE
@


1.77
log
@add global sqlite flavour
@
text
@d1 1
a1 1
# $OpenBSD: Makefile.inc,v 1.76 2011/01/07 19:22:06 sthen Exp $
d21 1
a21 1
MAINTAINER=	Jakob Schlyter <jakob@@openbsd.org>
@


1.76
log
@Install the unformatted manpages; mandoc has no problem with these,
and moving back to the unformatted pages fixes warnings from the
installation script (which does not expect the pages to be preformatted).
Problem noted by Brad and myself, possible fix suggested by me, diff
from Brad, ok jakob@@ (maintainer).
@
text
@d1 1
a1 1
# $OpenBSD: Makefile.inc,v 1.75 2010/11/22 09:28:34 espie Exp $
d47 1
a47 1
FLAVORS +=	sasl2 ldap mysql pgsql db4
@


1.75
log
@missed some
@
text
@d1 1
a1 1
# $OpenBSD: Makefile.inc,v 1.74 2010/11/19 07:23:09 espie Exp $
a5 3
.if defined(PATCHLEVEL)
PKGNAME ?=	postfix-${VERSION:S/-/./}p${PATCHLEVEL}
.else
a6 1
.endif
@


1.74
log
@new depends
@
text
@d1 1
a1 1
# $OpenBSD: Makefile.inc,v 1.73 2010/11/11 10:57:40 espie Exp $
d47 1
a47 1
LIB_DEPENDS +=	::devel/pcre
@


1.73
log
@WANTLIB conversion
@
text
@d1 1
a1 1
# $OpenBSD: Makefile.inc,v 1.72 2010/08/31 06:03:32 jakob Exp $
d55 1
a55 1
LIB_DEPENDS +=	::security/cyrus-sasl2
d62 2
a63 2
LIB_DEPENDS +=	:openldap-client->=2,<3:databases/openldap
WANTLIB +=	ldap.>=2 lber
d69 2
a70 2
LIB_DEPENDS +=	::databases/mysql
WANTLIB +=	lib/mysql/mysqlclient.>=10
d76 2
a77 2
LIB_DEPENDS +=	:postgresql-client-*:databases/postgresql
WANTLIB +=	pq.>=3
d83 2
a84 2
LIB_DEPENDS +=	:db->=4,<5:databases/db/v4
WANTLIB +=	lib/db4/db.>=4
d90 1
a90 1
LIB_DEPENDS +=	::databases/sqlite3
@


1.72
log
@add sqlite flavour; from brad
@
text
@d1 1
a1 1
# $OpenBSD: Makefile.inc,v 1.71 2010/08/22 09:04:29 jakob Exp $
d5 1
a5 1
DISTNAME?=	postfix-${VERSION}
d7 1
a7 1
PKGNAME?=	postfix-${VERSION:S/-/./}p${PATCHLEVEL}
d9 1
a9 1
PKGNAME?=	postfix-${VERSION:S/-/./}
d32 5
a36 5
MAKE_DEBUG?=
MAKE_CCARGS+=	-DDEF_CONFIG_DIR=\"${SYSCONFDIR}/postfix\"
MAKE_CCARGS+=	-DDEF_DATA_DIR=\"/var/postfix\"
MAKE_CCARGS+=	-DUSE_TLS
MAKE_AUXLIBS+=	-lssl -lcrypto
d38 1
a38 1
WANTLIB=	c crypto ssl
d44 1
a44 1
MAKE_CCARGS+=	-DUSE_SASL_AUTH
d47 3
a49 3
LIB_DEPENDS+=	pcre::devel/pcre
MAKE_CCARGS+=	-DHAS_PCRE -I${LOCALBASE}/include
MAKE_AUXLIBS+=	-L${LOCALBASE}/lib -lpcre
d51 2
a52 2
FLAVORS+=	sasl2 ldap mysql pgsql db4
FLAVOR?=
d55 4
a58 3
LIB_DEPENDS+=	sasl2::security/cyrus-sasl2
MAKE_CCARGS+=	-I${LOCALBASE}/include -I${LOCALBASE}/include/sasl -DUSE_CYRUS_SASL
MAKE_AUXLIBS+=	-L${LOCALBASE}/lib -lsasl2
d62 4
a65 3
LIB_DEPENDS+=	ldap.>=2,lber:openldap-client->=2,<3:databases/openldap
MAKE_CCARGS+=	-I${LOCALBASE}/include -DHAS_LDAP
MAKE_AUXLIBS+=	-L${LOCALBASE}/lib -lldap -llber
d69 4
a72 3
LIB_DEPENDS+=	lib/mysql/mysqlclient.>=10::databases/mysql
MAKE_CCARGS+=	-I${LOCALBASE}/include/mysql -DHAS_MYSQL
MAKE_AUXLIBS+=	-L${LOCALBASE}/lib/mysql -lmysqlclient
d76 4
a79 3
LIB_DEPENDS+=	pq.>=3:postgresql-client-*:databases/postgresql
MAKE_CCARGS+=	-I${LOCALBASE}/include/postgresql -DHAS_PGSQL
MAKE_AUXLIBS+=	-L${LOCALBASE}/lib -lpq
d83 4
a86 3
LIB_DEPENDS+=	lib/db4/db.>=4:db->=4,<5:databases/db/v4
MAKE_CCARGS+=	-I${LOCALBASE}/include/db4
MAKE_AUXLIBS+=	-L${LOCALBASE}/lib/db4 -ldb
d90 4
a93 4
WANTLIB+=	pthread
LIB_DEPENDS+=	sqlite3::databases/sqlite3
MAKE_CCARGS+=	-I${LOCALBASE}/include -DHAS_SQLITE
MAKE_AUXLIBS+=	-L${LOCALBASE}/lib -lsqlite3 -pthread
@


1.71
log
@Remove overriding of FD_SETSIZE since this hasn't had any effect since
Postfix had switched to kqueue() a long time ago. No binary package change.
@
text
@d1 1
a1 1
# $OpenBSD: Makefile.inc,v 1.70 2009/07/18 20:26:18 naddy Exp $
d82 7
@


1.70
log
@fix db dependency for db4 flavor and bump; ok jakob@@
@
text
@d1 1
a1 1
# $OpenBSD: Makefile.inc,v 1.69 2009/03/17 19:32:44 sthen Exp $
a32 1
MAKE_CCARGS?=	-DFD_SETSIZE=2048
@


1.69
log
@fix depends, bump
@
text
@d1 1
a1 1
# $OpenBSD: Makefile.inc,v 1.68 2008/02/29 12:25:22 jakob Exp $
d80 1
a80 1
LIB_DEPENDS+=	lib/db4/db.>=4:db-4.*:databases/db/v4
@


1.68
log
@fixed default data directory; from brad@@
@
text
@d1 1
a1 1
# $OpenBSD: Makefile.inc,v 1.67 2008/02/01 16:37:09 jakob Exp $
d62 1
a62 1
LIB_DEPENDS+=	ldap.>=2,lber:openldap-client-2.*:databases/openldap
@


1.67
log
@separate data and queue directory
@
text
@d1 1
a1 1
# $OpenBSD: Makefile.inc,v 1.66 2007/10/25 21:05:33 steven Exp $
d35 1
@


1.66
log
@db.=4 -> db.>=4  in preparation of db4 update

ok sthen@@
@
text
@d1 1
a1 1
# $OpenBSD: Makefile.inc,v 1.65 2007/09/16 00:17:06 merdely Exp $
d99 2
d117 1
@


1.65
log
@Remove surrounding quotes in COMMENT*/PERMIT_*
@
text
@d1 1
a1 1
# $OpenBSD: Makefile.inc,v 1.64 2007/05/31 10:19:00 espie Exp $
d79 1
a79 1
LIB_DEPENDS+=	lib/db4/db.=4:db-4.*:databases/db/v4
@


1.64
log
@move stuff into MESSAGE when it belongs, and rename the rest of the INSTALL
script to a file inside postfix.

That way, the last INSTALL script dies.

okay jakob@@, alek@@
@
text
@d1 1
a1 1
# $OpenBSD: Makefile.inc,v 1.63 2007/03/19 10:24:51 ajacoutot Exp $
d3 1
a3 1
COMMENT=	"fast, secure sendmail replacement"
d27 1
a27 1
PERMIT_PACKAGE_CDROM=	"cannot be sold, see section 4 of license"
d29 1
a29 1
PERMIT_DISTFILES_CDROM=	"cannot be sold, see section 4 of license"
@


1.63
log
@- fix path to cyrus deliver
- bump PKGNAME using PATCHLEVEL

ok simon@@
@
text
@d1 1
a1 1
# $OpenBSD: Makefile.inc,v 1.62 2006/11/20 19:57:34 jakob Exp $
d110 1
@


1.62
log
@finally(?) fix PKGNAME without patchlevel
@
text
@d1 1
a1 1
# $OpenBSD: Makefile.inc,v 1.61 2006/11/19 21:17:45 jakob Exp $
d83 4
@


1.61
log
@fix PKGNAME for snapshots
@
text
@d1 1
a1 1
# $OpenBSD: Makefile.inc,v 1.60 2006/11/13 07:45:05 jakob Exp $
d8 2
@


1.60
log
@reintroduce common Makefile (previously removed by approved commit)
upgrade snapshot version
bump package version for stable version
@
text
@d1 1
a1 1
# $OpenBSD: Makefile.inc,v 1.58 2006/10/18 17:42:28 sturm Exp $
d7 1
a7 1
PKGNAME?=	postfix-${VERSION}p${PATCHLEVEL}
@


1.59
log
@repair respecting of SYSCONFDIR, SYSCONFDIR wasn't being set properly
due to all the guts of the ports being in Makefile.inc
@
text
@d6 3
a8 1
PKGNAME?=	postfix-${VERSION:S/-/./}p0
@


1.58
log
@when you change the package, you HAVE to bump PKGNAME
i don't understand why people fall into this trap again and again and again
@
text
@d1 1
a1 1
# $OpenBSD: Makefile.inc,v 1.57 2006/10/12 08:36:16 jakob Exp $
@


1.57
log
@add db4 flavour; contributed by Wilbern Cobb
@
text
@d1 1
a1 1
# $OpenBSD: Makefile.inc,v 1.56 2006/08/03 23:15:57 espie Exp $
d6 1
a6 1
PKGNAME?=	postfix-${VERSION:S/-/./}
@


1.56
log
@new style specs
@
text
@d1 1
a1 1
# $OpenBSD: Makefile.inc,v 1.55 2006/08/03 19:56:08 espie Exp $
d47 1
a47 1
FLAVORS+=	sasl2 ldap mysql pgsql
d72 6
@


1.55
log
@more new lib specs
@
text
@d1 1
a1 1
# $OpenBSD: Makefile.inc,v 1.54 2006/07/17 08:52:13 jakob Exp $
d63 1
a63 1
LIB_DEPENDS+=	lib/mysql/mysqlclient.10::databases/mysql
d69 1
a69 1
LIB_DEPENDS+=	pq.3:postgresql-client-*:databases/postgresql
@


1.54
log
@upgrade to postfix 2.3.0; from brad@@
@
text
@d1 1
a1 1
# $OpenBSD: Makefile.inc,v 1.53 2006/06/07 20:43:08 jakob Exp $
d57 1
a57 1
LIB_DEPENDS+=	ldap.2,lber:openldap-client-2.*:databases/openldap
@


1.53
log
@fix DISTNAME
@
text
@d1 1
a1 1
# $OpenBSD: Makefile.inc,v 1.52 2005/09/16 01:06:52 brad Exp $
d40 2
d52 1
a52 1
MAKE_CCARGS+=	-I${LOCALBASE}/include -I${LOCALBASE}/include/sasl -DUSE_SASL_AUTH 
@


1.52
log
@The IPv6/TLS patch was removed 6 months ago so remove the
unused post-patch target.
@
text
@d1 1
a1 1
# $OpenBSD: Makefile.inc,v 1.51 2005/09/12 14:34:57 krw Exp $
d5 1
a5 1
DISTNAME=	postfix-${VERSION}
@


1.51
log
@New posix compliant xargs needs '-r' in case there aren't any files to
remove.

ok jakob@@
@
text
@d1 1
a1 1
# $OpenBSD: Makefile.inc,v 1.50 2005/05/06 16:35:41 brad Exp $
a70 3

post-patch:
	@@find ${WRKSRC} -type f -name '*.bak.orig' -print | xargs -r rm
@


1.50
log
@sync PLIST and bump PKGNAME
@
text
@d1 1
a1 1
# $OpenBSD: Makefile.inc,v 1.49 2005/04/08 20:16:31 jakob Exp $
d73 1
a73 1
	@@find ${WRKSRC} -type f -name '*.bak.orig' -print | xargs rm
@


1.49
log
@fix owner/group after install
@
text
@d1 1
a1 1
# $OpenBSD: Makefile.inc,v 1.48 2005/03/10 07:26:27 jakob Exp $
d6 1
a6 1
PKGNAME=	postfix-${VERSION:S/-/./}
@


1.48
log
@remove old target for IPv6 dependencies
@
text
@d1 1
a1 1
# $OpenBSD: Makefile.inc,v 1.47 2005/03/07 18:26:39 brad Exp $
d102 3
@


1.48.2.1
log
@updated packages for these ports where not build in a sane environment
bump PKGNAME for fixed packages
@
text
@d1 1
a1 1
# $OpenBSD: Makefile.inc,v 1.48 2005/03/10 07:26:27 jakob Exp $
d6 1
a6 1
PKGNAME?=	postfix-${VERSION:S/-/./}
@


1.47
log
@Postfix 2.2.0RC2 and 2.3 20050304 snapshot.

ok MAINTAINER
@
text
@d1 1
a1 1
# $OpenBSD: Makefile.inc,v 1.46 2004/12/29 07:05:07 jakob Exp $
a73 6

post-install:
.if defined(IPV6VERSION) && defined(IPV6POSTFIX)
	@@${INSTALL_DATA_DIR} ${PREFIX}/share/doc/postfix/tls
	@@${INSTALL_DATA} ${WRKSRC}/pfixtls/doc/* ${PREFIX}/share/doc/postfix/tls
.endif
@


1.46
log
@remove unneeded WANTLIBs
@
text
@d1 1
a1 1
# $OpenBSD: Makefile.inc,v 1.45 2004/12/28 09:27:13 jakob Exp $
d5 2
a15 2
MASTER_SITES0=	http://www.ipnet6.org/postfix/download/

d19 1
a19 3
.if defined(IPV6VERSION) && defined(IPV6POSTFIX)
PATCHFILES+=	tls+ipv6-${IPV6VERSION}-pf-${IPV6POSTFIX}.patch.gz:0
.endif
d21 1
a21 1
HOMEPAGE=	http://www.postfix.org/
d31 1
a31 2
MAKE_CCARGS+=	-DHAS_SSL	# -stable
MAKE_CCARGS+=	-DUSE_TLS	# -snapshot
a35 8
TLSHOMEPAGE=	http://www.aet.tu-cottbus.de/personen/jaenicke/pfixtls/
SUBST_VARS+=	TLSHOMEPAGE

IPV6HOMEPAGE=	http://www.ipnet6.org/postfix/
SUBST_VARS+=	IPV6HOMEPAGE

PATCH_DIST_STRIP=-p1

a70 1

@


1.45
log
@WANTLIB
@
text
@d1 1
a1 1
# $OpenBSD: Makefile.inc,v 1.44 2004/12/28 09:00:46 jakob Exp $
a54 1
WANTLIB+=	pcre
a62 1
WANTLIB+=	sasl2
a68 1
WANTLIB+=	ldap
a74 1
WANTLIB+=	mysqlclient
a80 1
WANTLIB+=	pq
@


1.44
log
@snapshot uses -DUSE_TLS for TLS
@
text
@d1 1
a1 1
# $OpenBSD: Makefile.inc,v 1.43 2004/12/28 08:25:34 jakob Exp $
d37 2
d55 1
d64 1
d71 1
d78 1
d85 1
@


1.43
log
@only install separate tls docs if we use tls patches
@
text
@d1 1
a1 1
# $OpenBSD: Makefile.inc,v 1.42 2004/11/24 07:40:54 jakob Exp $
d33 2
a34 1
MAKE_CCARGS+=	-DHAS_SSL
@


1.42
log
@only include IPv6/TLS patch if defined as next major version will include this
@
text
@d1 1
a1 1
# $OpenBSD: Makefile.inc,v 1.41 2004/10/18 06:48:31 jakob Exp $
d85 1
d88 1
@


1.41
log
@fix parameter speling error
@
text
@d1 1
a1 1
# $OpenBSD: Makefile.inc,v 1.40 2004/07/26 22:44:40 jakob Exp $
d18 2
d21 1
@


1.40
log
@fix postgres dependency
@
text
@d1 1
a1 1
# $OpenBSD: Makefile.inc,v 1.39 2004/06/22 05:20:12 brad Exp $
d99 1
a99 1
		newalises_path=${TRUEPREFIX}/sbin/newaliases \
@


1.39
log
@upgrade Postfix ports to latest releases, 2.1.3 and 2.2-20040616 as well
as installing qshape.

ok MAINTAINER
@
text
@d1 1
a1 1
# $OpenBSD: Makefile.inc,v 1.38 2004/06/10 21:22:25 jakob Exp $
d72 1
a72 1
LIB_DEPENDS+=	pq.3:postgresql-clients-7.*:databases/postgresql
@


1.38
log
@consolidate IPv6/TLS patching
@
text
@d1 1
a1 1
# $OpenBSD: Makefile.inc,v 1.37 2004/04/25 10:36:39 jakob Exp $
d107 2
@


1.37
log
@move to postfix release 2.1 and snapshot 2.2

- enable SMTP over SSL/TLS by default
- enable IPv6 by default
- enable PRE by default
- keep sasl2/ldap/mysql/pgsql as flavours
@
text
@d1 1
a1 1
# $OpenBSD: Makefile.inc,v 1.36 2004/04/01 08:11:17 jakob Exp $
d14 2
d18 1
d30 10
a39 1
MAKE_AUXLIBS?=
d77 7
@


1.36
log
@kill sasl (v1, not v2) flavour
@
text
@d1 1
a1 1
# $OpenBSD: Makefile.inc,v 1.35 2004/02/16 07:37:46 djm Exp $
a18 6
TLSHOMEPAGE=	http://www.aet.tu-cottbus.de/personen/jaenicke/pfixtls/
SUBST_VARS+=	TLSHOMEPAGE

IPV6HOMEPAGE=	http://www.ipnet6.org/postfix/
SUBST_VARS+=	IPV6HOMEPAGE

d33 1
a33 4
FLAVORS+=	pcre sasl2 ldap mysql tls ipv6
FLAVOR?=

.if ${FLAVOR:L:Mpcre}
d37 3
a39 3
.else
MAKE_CCARGS+=	-DNO_PCRE
.endif
d59 4
a62 56
.if ${FLAVOR:L:Mtls}
MAKE_CCARGS+=	-DHAS_SSL
MAKE_AUXLIBS+=	-lssl -lcrypto

.if ${FLAVOR:L:Mipv6}
.if defined(IPV6VERSION)
PKGNAME:=		${PKGNAME}.ipv6+tlsr${IPV6VERSION}
IPV6TLSDISTNAME=	tls+ipv6-${IPV6VERSION}-pf-${IPV6PFIXVERSION}
IPV6TLSPATCH=		${IPV6TLSDISTNAME}.patch.gz
DISTFILES+=		${IPV6TLSPATCH}:1
MASTER_SITES1=		ftp://ftp.stack.nl/pub/postfix/tls+ipv6/${IPV6VERSION}/

post-patch-tls:
	@@echo "===>  Applying IPv6+TLS patches for ${FULLPKGNAME}"
	@@mv ${WRKDIST}/conf/master.cf ${WRKDIST}/conf/master.cf.save
	@@cp ${WRKDIST}/conf/master.cf.orig ${WRKDIST}/conf/master.cf
	@@cd ${WRKDIST} && gzcat ${DISTDIR}/postfix/${IPV6TLSPATCH} | \
		${PATCH} -st -p1
	@@mv ${WRKDIST}/conf/master.cf.save ${WRKDIST}/conf/master.cf
	@@rm ${WRKDIST}/conf/master.cf.orig
	@@cd ${WRKDIST} && ${PATCH} -st -p0 < ${FILESDIR}/patch-tls-master.cf

post-install-tls:
	${INSTALL_DATA_DIR} ${PREFIX}/share/doc/postfix/tls
	${INSTALL_DATA} ${WRKSRC}/pfixtls/doc/* ${PREFIX}/share/doc/postfix/tls

.else
BROKEN=         "TLS+IPv6 patches not yet available for this version"
.endif

.else

.if defined(TLSVERSION)
PKGNAME:=	${PKGNAME}.tls${TLSVERSION}
TLSDISTNAME=	pfixtls-${TLSVERSION}-${TLSPFIXVERSION}-${TLSSSLVERSION}
MASTER_SITES0=	ftp://ftp.aet.tu-cottbus.de/pub/postfix_tls/ \
		ftp://ftp.aet.tu-cottbus.de/pub/postfix_tls/old/
DISTFILES+=	${TLSDISTNAME}${EXTRACT_SUFX}:0

post-patch-tls:
	@@echo "===>  Applying TLS patches for ${FULLPKGNAME}"
	@@mv ${WRKDIST}/conf/master.cf ${WRKDIST}/conf/master.cf.save
	@@cp ${WRKDIST}/conf/master.cf.orig ${WRKDIST}/conf/master.cf
	@@cd ${WRKDIST} && ${PATCH} -st -p1 < ${WRKDIR}/${TLSDISTNAME}/pfixtls.diff
	@@mv ${WRKDIST}/conf/master.cf.save ${WRKDIST}/conf/master.cf
	@@rm ${WRKDIST}/conf/master.cf.orig
	@@cd ${WRKDIST} && ${PATCH} -st -p0 < ${FILESDIR}/patch-tls-master.cf

post-install-tls:
	${INSTALL_DATA_DIR} ${PREFIX}/share/doc/postfix/tls
	${INSTALL_DATA} ${WRKDIR}/${TLSDISTNAME}/doc/* \
		${PREFIX}/share/doc/postfix/tls

.else
BROKEN=         "TLS patches not yet available for this version"
.endif
a64 23
.else

.if ${FLAVOR:L:Mipv6}
.if defined(IPV6VERSION)
PKGNAME:=		${PKGNAME}.ipv6r${IPV6VERSION}
IPV6DISTNAME=		ipv6-${IPV6VERSION}-pf-${IPV6PFIXVERSION}
MASTER_SITES1=		ftp://ftp.stack.nl/pub/postfix/tls+ipv6/${IPV6VERSION}/
PATCHFILES+=		${IPV6DISTNAME}.patch.gz:1
PATCH_DIST_STRIP=	-p1
.else
BROKEN=         "IPv6 patches not yet available for this version"
.endif
.endif

post-patch-tls:
post-install-tls:

.endif

post-patch: post-patch-tls
	@@rm ${WRKDIST}/conf/*.orig

post-install: post-install-tls
d67 1
a67 1
	cd ${WRKSRC}; ${MAKE_PROGRAM} makefiles \
d72 1
a72 1
	(cd ${WRKSRC}; sh postfix-install \
d74 2
a81 2
		mail_owner=_postfix \
		setgid_group=_postdrop \
d84 1
d86 5
a90 8
	${INSTALL_SCRIPT} ${FILESDIR}/postfix-enable ${PREFIX}/sbin
	${INSTALL_SCRIPT} ${FILESDIR}/postfix-disable ${PREFIX}/sbin
	${INSTALL_DATA_DIR} ${PREFIX}/share/examples/postfix
	mv ${WRKINST}${SYSCONFDIR}/postfix/* ${PREFIX}/share/examples/postfix
	${INSTALL_DATA_DIR} ${PREFIX}/share/doc/postfix/html
	${INSTALL_DATA} ${WRKSRC}/html/*.html ${PREFIX}/share/doc/postfix/html
	${INSTALL_DATA} ${WRKSRC}/html/*.gif ${PREFIX}/share/doc/postfix/html
	rm -fr ${WRKINST}/var/spool/postfix
@


1.35
log
@Support combined TLS+IPv6 patch when using FLAVOR="tls ipv6"; ok jakob@@
@
text
@d1 1
a1 1
# $OpenBSD: Makefile.inc,v 1.34 2004/01/14 17:30:59 jakob Exp $
d39 1
a39 1
FLAVORS+=	pcre sasl sasl2 ldap mysql tls ipv6
a47 6
.endif

.if ${FLAVOR:L:Msasl}
LIB_DEPENDS+=	sasl::security/cyrus-sasl
MAKE_CCARGS+=	-I${LOCALBASE}/include -I${LOCALBASE}/include/sasl -DUSE_SASL_AUTH 
MAKE_AUXLIBS+=	-L${LOCALBASE}/lib -lsasl -lkrb
@


1.34
log
@prepare for IPv6 support
@
text
@d1 1
a1 1
# $OpenBSD: Makefile.inc,v 1.32 2004/01/02 11:26:19 jakob Exp $
d75 31
a112 3
MAKE_CCARGS+=	-DHAS_SSL
MAKE_AUXLIBS+=	-lssl -lcrypto

d126 1
d130 2
a132 3
post-patch-tls:
post-install-tls:
.endif
d138 1
a138 1
MASTER_SITES1=		http://www.ipnet6.org/postfix/download/
a143 1
.else
d146 3
a148 2
.if ${FLAVOR:L:Mtls} && ${FLAVOR:L:Mipv6}
BROKEN=         "Can not do both TLS and IPv6 (yet)"
a149 1

@


1.33
log
@supress messages from tls patching
@
text
@d22 3
d39 1
a39 1
FLAVORS+=	pcre sasl sasl2 ldap mysql tls
a76 1

a77 1

a79 1

d89 1
a89 1
	@@cd ${WRKDIST} && ${PATCH} -s -p1 < ${WRKDIR}/${TLSDISTNAME}/pfixtls.diff
d92 1
a92 1
	@@cd ${WRKDIST} && ${PATCH} -s -p0 < ${FILESDIR}/patch-tls-master.cf
d105 18
@


1.32
log
@tidy tls flavour
@
text
@d1 1
a1 1
# $OpenBSD: Makefile.inc,v 1.31 2004/01/02 05:11:08 brad Exp $
d86 7
a92 6
	mv ${WRKDIST}/conf/master.cf ${WRKDIST}/conf/master.cf.save
	cp ${WRKDIST}/conf/master.cf.orig ${WRKDIST}/conf/master.cf
	cd ${WRKDIST} && patch -p1 < ${WRKDIR}/${TLSDISTNAME}/pfixtls.diff
	mv ${WRKDIST}/conf/master.cf.save ${WRKDIST}/conf/master.cf
	rm ${WRKDIST}/conf/master.cf.orig
	cd ${WRKDIST} && patch -p0 < ${FILESDIR}/patch-tls-master.cf
d107 1
a107 1
	rm ${WRKDIST}/conf/*.orig
@


1.31
log
@better LIB_DEPENDS entries for MySQL
@
text
@d1 1
a1 1
# $OpenBSD: Makefile.inc,v 1.30 2003/11/24 18:52:05 jakob Exp $
d15 1
d29 1
d80 1
a80 2
DISTFILES=	${DISTNAME}${EXTRACT_SUFX} \
		${TLSDISTNAME}${EXTRACT_SUFX}:0
d85 1
a85 1
post-patch:
a91 1
	rm ${WRKDIST}/conf/*.orig
d93 1
a93 1
post-install:
d101 5
a105 1
post-patch:
a106 1
.endif
d108 1
a108 1
MAKE_CCARGS+=	-DDEF_CONFIG_DIR=\"${SYSCONFDIR}/postfix\"
@


1.30
log
@TLS cleanup
@
text
@d1 1
a1 1
# $OpenBSD: Makefile.inc,v 1.29 2003/08/16 06:57:50 pvalchev Exp $
d64 1
a64 1
LIB_DEPENDS+=	mysqlclient.10:mysql-client-3.23.*:databases/mysql
@


1.29
log
@cope with new (future) patch behaviour; no response from maintainer
@
text
@d1 1
a1 1
# $OpenBSD: Makefile.inc,v 1.28 2003/06/23 19:11:11 sturm Exp $
d72 2
@


1.28
log
@new user naming schema

bump PKGNAME where necessary

rohee@@ ok leafnode
"you don't have to wait for oks" pval@@
@
text
@d1 1
a1 1
# $OpenBSD: Makefile.inc,v 1.27 2003/05/01 15:46:38 sturm Exp $
d87 1
@


1.27
log
@don't hardcode /etc, use SYSCONFDIR

"looks ok" jakob (maintainer)
@
text
@d1 1
a1 1
# $OpenBSD: Makefile.inc,v 1.26 2003/04/10 18:08:56 jsyn Exp $
d118 2
a119 2
		mail_owner=postfix \
		setgid_group=postdrop \
@


1.26
log
@quote COMMENTs; ok naddy@@
@
text
@d1 1
a1 1
# $OpenBSD: Makefile.inc,v 1.25 2003/03/16 05:55:51 pvalchev Exp $
d102 2
d107 1
a107 1
		CCARGS="${MAKE_CCARGS}" AUXLIBS="${MAKE_AUXLIBS}"
d126 1
a126 1
	mv ${WRKINST}/etc/postfix/* ${PREFIX}/share/examples/postfix
@


1.25
log
@no, this cannot go to the CD, see section 4 of the license.
pointed out by margarida@@
@
text
@d1 1
a1 1
# $OpenBSD: Makefile.inc,v 1.24 2003/03/02 05:37:24 david Exp $
d3 1
a3 1
COMMENT=	fast, secure sendmail replacement
@


1.24
log
@fix more spelling errors/typos
ok pvalchev@@
@
text
@d1 1
a1 1
# $OpenBSD: Makefile.inc,v 1.23 2003/01/13 15:44:36 jakob Exp $
d21 1
a21 1
PERMIT_PACKAGE_CDROM=	yes
d23 1
a23 1
PERMIT_DISTFILES_CDROM=	yes
@


1.23
log
@force NO_PCRE
@
text
@d1 1
a1 1
# $OpenBSD: Makefile.inc,v 1.22 2003/01/06 11:30:16 jakob Exp $
d95 1
a95 1
BROKEN=         "TLS patches not yet availible for this version"
@


1.22
log
@mark broken for flavour tls if no patches defined
@
text
@d1 1
a1 1
# $OpenBSD: Makefile.inc,v 1.21 2003/01/01 13:11:23 jakob Exp $
d39 1
a39 1
MAKE_CCARGS+=	-I${LOCALBASE}/include -DHAS_PCRE
d41 2
@


1.21
log
@fix mysql dep
@
text
@d1 1
a1 1
# $OpenBSD: Makefile.inc,v 1.20 2002/12/25 11:48:46 jakob Exp $
d34 1
a34 4
FLAVORS+=	pcre sasl sasl2 ldap mysql
.if defined(TLSVERSION)
FLAVORS+=	tls
.endif
d68 1
d92 3
@


1.20
log
@add global sasl2 option (for postfix v2)
@
text
@d1 1
a1 1
# $OpenBSD: Makefile.inc,v 1.19 2002/10/27 17:21:39 naddy Exp $
d65 1
a65 1
LIB_DEPENDS+=	lib/mysql/mysqlclient.10:mysql-client-3.23.*:databases/mysql
@


1.19
log
@No regression tests available.
@
text
@d1 1
a1 1
# $OpenBSD: Makefile.inc,v 1.18 2002/09/07 19:09:05 jakob Exp $
d34 1
a34 1
FLAVORS+=	pcre sasl ldap mysql
d50 6
@


1.18
log
@nuke NEED_VERSION
@
text
@d1 1
a1 1
# $OpenBSD: Makefile.inc,v 1.17 2002/05/15 06:20:04 jakob Exp $
d31 2
@


1.17
log
@kill MASTER_SITE_SUBDIR
@
text
@d1 1
a1 1
# $OpenBSD: Makefile.inc,v 1.16 2002/04/19 21:11:57 jakob Exp $
a5 1
NEED_VERSION=	1.528
@


1.16
log
@only enable tls flavour if TLSVERSION is set
@
text
@d1 1
a1 1
# $OpenBSD: Makefile.inc,v 1.15 2002/01/25 08:14:29 jakob Exp $
d6 1
a6 1
NEED_VERSION=	1.491
d8 6
a13 5
MASTER_SITES=	ftp://ftp.porcupine.org/mirrors/postfix-release/%SUBDIR%/ \
		ftp://ftp.merit.edu/postfix/%SUBDIR%/ \
		ftp://ftp.sunet.se/pub/unix/mail/postfix/%SUBDIR%/ \
		ftp://ftp.tau.ac.il/pub/unix/mail/postfix/%SUBDIR%/ \
		ftp://ftp.cs.uu.nl/mirror/postfix/postfix-release/%SUBDIR%/
@


1.15
log
@update to postfix v1.1.1
@
text
@d1 1
a1 1
# $OpenBSD: Makefile.inc,v 1.14 2001/11/28 09:35:14 jakob Exp $
d32 4
a35 1
FLAVORS+=	pcre sasl ldap mysql tls
@


1.14
log
@add ref to Postfix/TLS webpage
@
text
@d1 1
a1 1
# $OpenBSD: Makefile.inc,v 1.13 2001/11/15 07:36:35 jakob Exp $
d8 2
a9 1
MASTER_SITES=	ftp://ftp.merit.edu/postfix/%SUBDIR%/ \
d27 1
a27 1
MAKE_CCARGS?=
d60 2
d94 13
a106 4
	${INSTALL_PROGRAM_DIR} ${PREFIX}/libexec/postfix
	${INSTALL_DATA_DIR} ${PREFIX}/share/doc/postfix
	${INSTALL_DATA_DIR} ${PREFIX}/share/examples/postfix
	${INSTALL_PROGRAM} ${WRKSRC}/bin/* ${PREFIX}/sbin
d109 6
a114 8
	${INSTALL_PROGRAM} ${WRKSRC}/libexec/* ${PREFIX}/libexec/postfix
	${INSTALL_DATA} ${WRKSRC}/conf/* ${PREFIX}/share/examples/postfix
	@@(cd ${WRKSRC}/man; \
	  for mandir in man[0-9]; do \
	     ${INSTALL_MAN} $$mandir/* ${PREFIX}/man/$$mandir; \
	  done)
	${INSTALL_DATA} ${WRKSRC}/html/*.html ${PREFIX}/share/doc/postfix
	${INSTALL_DATA} ${WRKSRC}/html/*.gif ${PREFIX}/share/doc/postfix
@


1.13
log
@bump NEED_VERSION
@
text
@d1 1
a1 1
# $OpenBSD: Makefile.inc,v 1.12 2001/11/11 13:48:17 espie Exp $
d17 3
a60 2

TLSHOMEPAGE=	http://www.aet.tu-cottbus.de/personen/jaenicke/pfixtls/
@


1.12
log
@Complete mysql depends
@
text
@d1 1
a1 1
# $OpenBSD: Makefile.inc,v 1.11 2001/10/26 18:40:23 jakob Exp $
d6 1
a6 1
NEED_VERSION=	1.474
@


1.11
log
@add ref to tls webpage
@
text
@d1 1
a1 1
# $OpenBSD: Makefile.inc,v 1.10 2001/10/25 21:35:38 jakob Exp $
d50 1
a50 1
LIB_DEPENDS+=	mysqlclient.10:mysql-client-3.23.*:databases/mysql
@


1.10
log
@add tls flavour
@
text
@d1 1
a1 1
# $OpenBSD: Makefile.inc,v 1.9 2001/10/24 12:22:45 espie Exp $
d58 2
@


1.9
log
@Complete lib dependencies
@
text
@d1 1
a1 1
# $OpenBSD: Makefile.inc,v 1.8 2001/09/28 23:35:18 jakob Exp $
d28 1
a28 1
FLAVORS=	pcre sasl ldap mysql
d53 27
@


1.8
log
@add mysql flavour
@
text
@d1 1
a1 1
# $OpenBSD: Makefile.inc,v 1.6 2001/09/14 23:48:45 jakob Exp $
d6 1
a6 1
NEED_VERSION=	1.363
d44 1
a44 1
LIB_DEPENDS+=	ldap.2:openldap-client-2.*:databases/openldap
@


1.7
log
@move common flavours into shared Makefile.inc
@
text
@d28 1
a28 1
FLAVORS=	pcre sasl ldap
d47 6
@


1.6
log
@move MAINTAINER to */Makefile
@
text
@d1 1
a1 1
# $OpenBSD: Makefile.inc,v 1.5 2001/05/29 06:11:36 jakob Exp $
d27 21
@


1.5
log
@respect CC and CFLAGS
@
text
@d1 1
a1 1
# $OpenBSD: Makefile.inc,v 1.4 2001/03/24 19:55:49 jakob Exp $
a15 2

MAINTAINER=	Jakob Schlyter <jakob@@openbsd.org>
@


1.4
log
@move COMMENT into Makefile & touch NEED_VERSION
@
text
@d1 1
a1 1
# $OpenBSD: Makefile.inc,v 1.3 2000/10/05 21:08:38 jakob Exp $
d24 1
d32 1
@


1.4.2.1
log
@MFC:
respect CC and CFLAGS
@
text
@d1 1
a1 1
# $OpenBSD: Makefile.inc,v 1.5 2001/05/29 06:11:36 jakob Exp $
a23 1
MAKE_DEBUG?=
a30 1
		CC="${CC}" OPT="${CFLAGS}" DEBUG="${MAKE_DEBUG}" \
@


1.3
log
@- remove MAKE_FLAGS
- add do-configure target
@
text
@d1 3
a3 1
# $OpenBSD: Makefile.inc,v 1.2 2000/10/05 20:58:34 jakob Exp $
d6 1
a6 1
NEED_VERSION=	1.310
@


1.2
log
@make MAKE_FLAGS additive
@
text
@d1 1
a1 1
# $OpenBSD: Makefile.inc,v 1.1 2000/09/25 21:02:29 jakob Exp $
d22 2
a23 2
MAKE_FLAGS+=	CC="${CC}" DEBUG="" OPT="${CFLAGS}" \
		OPTS="CC=\"${CC}\" DEBUG=\"\" OPT=\"${CFLAGS}\""
d26 4
@


1.1
log
@split port into stable and snapshot versions
@
text
@d1 1
a1 1
# $OpenBSD$
d22 1
a22 1
MAKE_FLAGS=	CC="${CC}" DEBUG="" OPT="${CFLAGS}" \
@

