head	1.5;
access;
symbols
	OPENBSD_6_1:1.5.0.2
	OPENBSD_6_1_BASE:1.5
	OPENBSD_6_0:1.4.0.4
	OPENBSD_6_0_BASE:1.4
	OPENBSD_5_9:1.4.0.2
	OPENBSD_5_9_BASE:1.4
	OPENBSD_5_8:1.2.0.4
	OPENBSD_5_8_BASE:1.2
	ajacoutot_20150721:1.1.1.1
	ajacoutot:1.1.1;
locks; strict;
comment	@# @;


1.5
date	2017.02.27.23.08.14;	author jca;	state Exp;
branches;
next	1.4;
commitid	68tBA1dCD0c6lgCK;

1.4
date	2015.12.11.06.34.38;	author pirofti;	state Exp;
branches;
next	1.3;
commitid	1FkgUCaOUBI1Nfq7;

1.3
date	2015.12.04.20.47.53;	author landry;	state Exp;
branches;
next	1.2;
commitid	gYqs83JS5RzGVA58;

1.2
date	2015.07.20.23.21.07;	author ajacoutot;	state Exp;
branches;
next	1.1;
commitid	A4mu03g2zBSYbyKw;

1.1
date	2015.07.20.23.10.35;	author ajacoutot;	state Exp;
branches
	1.1.1.1;
next	;
commitid	D863XYEmqwmpin3O;

1.1.1.1
date	2015.07.20.23.10.35;	author ajacoutot;	state Exp;
branches;
next	;
commitid	D863XYEmqwmpin3O;


desc
@@


1.5
log
@Respect CXX
@
text
@# $OpenBSD: Makefile,v 1.4 2015/12/11 06:34:38 pirofti Exp $

BROKEN-hppa=	undefined refs to dtrsv/dgemv/dtrsm/dgemm/dger in libumfpack.a

COMMENT=		suite of sparse matrix algorithms

DISTNAME=		SuiteSparse-4.4.6
PKGNAME=		${DISTNAME:L}

CATEGORIES=		math

HOMEPAGE=		http://faculty.cse.tamu.edu/davis/suitesparse.html

MAINTAINER=		Paul Irofti <pirofti@@openbsd.org>

SO_VERSION=		2.1
.for _lib in \
amd btf camd ccolamd cholmod colamd csparse cxsparse klu ldl rbio spqr \
suitesparseconfig umfpack
SHARED_LIBS +=		${_lib} ${SO_VERSION}
.endfor

# GPLv2 - LGPLv2.1
PERMIT_PACKAGE_CDROM=	Yes

WANTLIB += ${MODFORTRAN_WANTLIB} blas lapack m

MASTER_SITES=		http://faculty.cse.tamu.edu/davis/SuiteSparse/

MODULES=		fortran

BUILD_DEPENDS=		${MODFORTRAN_BUILD_DEPENDS}
LIB_DEPENDS=		${MODFORTRAN_LIB_DEPENDS} \
			math/lapack

ALL_TARGET=		default
NO_TEST=		Yes
SUBST_VARS=		WRKINST
USE_GMAKE=		Yes
WRKDIST=		${WRKDIR}/SuiteSparse

MAKE_FLAGS=		CFLAGS="${CFLAGS} -fPIC" \
			CXX="${CXX}"

pre-configure:
	${SUBST_CMD} ${WRKSRC}/SuiteSparse_config/SuiteSparse_config.mk

post-build:
	# build shared libraries
	cd ${WRKSRC}/SuiteSparse_config && \
		${AR} x libsuitesparseconfig.a
	cd ${WRKSRC} && \
		${CC} -shared -o \
			libsuitesparseconfig.so.${LIBsuitesparseconfig_VERSION} \
			SuiteSparse_config/*.o -lm

	cd ${WRKSRC} && \
		${CC} -shared -o libamd.so.${LIBamd_VERSION} \
			AMD/Lib/*.o \
			libsuitesparseconfig.so.${LIBsuitesparseconfig_VERSION} \
			-lm

	cd ${WRKSRC} && \
		${CC} -shared -o libbtf.so.${LIBbtf_VERSION} \
			BTF/Lib/*.o

	cd ${WRKSRC} && \
		${CC} -shared -o libcamd.so.${LIBcamd_VERSION} \
			CAMD/Lib/*.o \
			libsuitesparseconfig.so.${LIBsuitesparseconfig_VERSION} \
			-lm

	cd ${WRKSRC} && \
		${CC} -shared -o libcolamd.so.${LIBcolamd_VERSION} \
			COLAMD/Lib/*.o \
			libsuitesparseconfig.so.${LIBsuitesparseconfig_VERSION} \
			-lm

	cd ${WRKSRC} && \
		${CC} -shared -o libccolamd.so.${LIBccolamd_VERSION} \
			CCOLAMD/Lib/*.o \
			libsuitesparseconfig.so.${LIBsuitesparseconfig_VERSION} \
			-lm

	cd ${WRKSRC} && \
		${CC} -shared -o libcholmod.so.${LIBcholmod_VERSION} \
			CHOLMOD/Lib/*.o libamd.so.${LIBamd_VERSION} \
			libcamd.so.${LIBcamd_VERSION} \
			libcolamd.so.${LIBcolamd_VERSION} \
			libccolamd.so.${LIBccolamd_VERSION} \
			libsuitesparseconfig.so.${LIBsuitesparseconfig_VERSION} \
			-lm -L${LOCALBASE}/lib -lblas -lg2c -llapack

	cd ${WRKSRC} && \
		${CC} -shared -o libcsparse.so.${LIBcsparse_VERSION} \
			CSparse/Lib/*.o -lm

	cd ${WRKSRC} && \
		${CC} -shared -o libcxsparse.so.${LIBcxsparse_VERSION} \
			CXSparse/Lib/*.o -lm

	cd ${WRKSRC} && \
		${CC} -shared -o libklu.so.${LIBklu_VERSION} \
			KLU/Lib/*.o libamd.so.${LIBamd_VERSION} \
			libbtf.so.${LIBbtf_VERSION} \
			libsuitesparseconfig.so.${LIBsuitesparseconfig_VERSION} \
			-lm

	cd ${WRKSRC} && \
		${CC} -shared -o libldl.so.${LIBldl_VERSION} \
			LDL/Lib/*.o -lm

	cd ${WRKSRC} && \
		${CC} -shared -o libumfpack.so.${LIBumfpack_VERSION} \
			UMFPACK/Lib/*.o libamd.so.${LIBamd_VERSION} \
			libcholmod.so.${LIBcholmod_VERSION} \
			libsuitesparseconfig.so.${LIBsuitesparseconfig_VERSION} \
			-lm -L${LOCALBASE}/lib -lblas -lg2c -llapack

	cd ${WRKSRC} && \
		${CC} -shared -o libspqr.so.${LIBspqr_VERSION} \
			SPQR/Lib/*.o libcholmod.so.${LIBcholmod_VERSION} \
			libsuitesparseconfig.so.${LIBsuitesparseconfig_VERSION} \
			-lm -L${LOCALBASE}/lib -lblas -lg2c -llapack

	cd ${WRKSRC} && \
		${CC} -shared -o librbio.so.${LIBrbio_VERSION} \
			RBio/Lib/*.o \
			libsuitesparseconfig.so.${LIBsuitesparseconfig_VERSION} \
			-lm

post-install:
	# remove versionned static archives, links and libcerbla
	# (not meant to be shipped)
	rm ${PREFIX}/lib/*.a
	for i in `find ${WRKBUILD} -type f -name '*.a'`; do \
		${INSTALL_DATA} $${i} ${PREFIX}/lib/; \
	done
	rm ${PREFIX}/lib/libcerbla.a
	
	${INSTALL_DATA} ${WRKBUILD}/lib*.so.?.? ${PREFIX}/lib/

.include <bsd.port.mk>
@


1.4
log
@Update suitesparse to 4.4.6

OK feinerer@@, ajacoutot@@, jasper@@, benoit@@
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.3 2015/12/04 20:47:53 landry Exp $
d42 2
a43 1
MAKE_FLAGS=		CFLAGS="${CFLAGS} -fPIC"
@


1.3
log
@Mark BROKEN-hppa for reliable BROKEN-ness (gcc ICEs, undefined refs to
atomics, various horrors)
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.2 2015/07/20 23:21:07 ajacoutot Exp $
d7 1
a7 1
DISTNAME=		SuiteSparse-4.4.4
d16 1
a16 1
SO_VERSION=		2.0
@


1.2
log
@Indent.
@
text
@d1 3
a3 1
# $OpenBSD: Makefile,v 1.1.1.1 2015/07/20 23:10:35 ajacoutot Exp $
@


1.1
log
@Initial revision
@
text
@d1 1
a1 1
# $OpenBSD$
d46 1
d50 2
a51 1
		${CC} -shared -o libsuitesparseconfig.so.${LIBsuitesparseconfig_VERSION} \
d56 3
a58 1
			AMD/Lib/*.o libsuitesparseconfig.so.${LIBsuitesparseconfig_VERSION} -lm
d66 3
a68 1
			CAMD/Lib/*.o libsuitesparseconfig.so.${LIBsuitesparseconfig_VERSION} -lm
d72 3
a74 1
			COLAMD/Lib/*.o libsuitesparseconfig.so.${LIBsuitesparseconfig_VERSION} -lm
d78 3
a80 1
			CCOLAMD/Lib/*.o libsuitesparseconfig.so.${LIBsuitesparseconfig_VERSION} -lm
d84 6
a89 4
			CHOLMOD/Lib/*.o libamd.so.${LIBamd_VERSION} libcamd.so.${LIBcamd_VERSION} \
			libcolamd.so.${LIBcolamd_VERSION} libccolamd.so.${LIBccolamd_VERSION} \
			libsuitesparseconfig.so.${LIBsuitesparseconfig_VERSION} -lm \
			-L${LOCALBASE}/lib -lblas -lg2c -llapack
d101 4
a104 2
			KLU/Lib/*.o libamd.so.${LIBamd_VERSION} libbtf.so.${LIBbtf_VERSION} \
			libsuitesparseconfig.so.${LIBsuitesparseconfig_VERSION} -lm
d112 4
a115 3
			UMFPACK/Lib/*.o libamd.so.${LIBamd_VERSION} libcholmod.so.${LIBcholmod_VERSION} \
			libsuitesparseconfig.so.${LIBsuitesparseconfig_VERSION} -lm \
			-L${LOCALBASE}/lib -lblas -lg2c -llapack
d120 2
a121 2
			libsuitesparseconfig.so.${LIBsuitesparseconfig_VERSION} -lm \
			-L${LOCALBASE}/lib -lblas -lg2c -llapack
d125 3
a127 1
			RBio/Lib/*.o libsuitesparseconfig.so.${LIBsuitesparseconfig_VERSION} -lm
@


1.1.1.1
log
@Import suitesparse-4.4.4.

SuiteSparse is a suite of sparse matrix algorithms, including:
<...>

req. by and ok pirofti@@
@
text
@@
