head	1.3;
access;
symbols
	OPENBSD_4_1:1.2.0.2
	OPENBSD_4_1_BASE:1.2
	OPENBSD_4_0:1.1.0.4
	OPENBSD_4_0_BASE:1.1
	OPENBSD_3_9:1.1.0.2
	OPENBSD_3_9_BASE:1.1;
locks; strict;
comment	@# @;


1.3
date	2007.04.26.20.26.12;	author mbalmer;	state dead;
branches;
next	1.2;

1.2
date	2006.11.11.18.52.12;	author mbalmer;	state Exp;
branches;
next	1.1;

1.1
date	2005.10.08.09.47.37;	author mbalmer;	state Exp;
branches;
next	;


desc
@@


1.3
log
@R-2.5.0
@
text
@$OpenBSD: patch-src_main_Renviron_c,v 1.2 2006/11/11 18:52:12 mbalmer Exp $
--- src/main/Renviron.c.orig	Mon Apr 10 00:19:51 2006
+++ src/main/Renviron.c	Tue Oct  3 20:04:28 2006
@@@@ -126,10 +126,12 @@@@ static void Putenv(char *a, char *b)
 {
     char *buf, *value, *p, *q, quote='\0';
     int inquote = 0;
+    size_t slen;
 
-    buf = (char *) malloc((strlen(a) + strlen(b) + 2) * sizeof(char));
+    slen = strlen(a) + strlen(b) + 2;    
+    buf = (char *) malloc(slen);
     if(!buf) R_Suicide("allocation failure in reading Renviron");
-    strcpy(buf, a); strcat(buf, "=");
+    strlcpy(buf, a, slen); strlcat(buf, "=", slen);
     value = buf+strlen(buf);
 
     /* now process the value */
@@@@ -181,7 +183,8 @@@@ static int process_Renviron(char *filena
 	if(!(p = Rf_strchr(s, '='))) {
 	    errs++;
 	    if(strlen(msg) < MSG_SIZE) {
-		strcat(msg, "\n      "); strcat(msg, s);
+		strlcat(msg, "\n      ", sizeof(msg));
+		strlcat(msg, s, sizeof(msg));
 	    }
 	    continue;
 	}
@@@@ -193,7 +196,7 @@@@ static int process_Renviron(char *filena
     }
     fclose(fp);
     if (errs) {
-	strcat(msg, "\n   They were ignored\n");
+	strlcat(msg, "\n   They were ignored\n", sizeof(msg));
 	R_ShowMessage(msg);
     }
     return 1;
@@@@ -210,10 +213,10 @@@@ void process_system_Renviron()
         R_ShowMessage("path to system Renviron is too long: skipping");
         return;
     }
-    strcpy(buf, R_Home);
-    strcat(buf, "/etc/");
-    strcat(buf, R_ARCH);
-    strcat(buf, "/Renviron");
+    strlcpy(buf, R_Home, sizeof(buf));
+    strlcat(buf, "/etc/", sizeof(buf));
+    strlcat(buf, R_ARCH, sizeof(buf));
+    strlcat(buf, "/Renviron", sizeof(buf));
 #else
     if(strlen(R_Home) + strlen("/etc/Renviron") > PATH_MAX - 1) {
 	R_ShowMessage("path to system Renviron is too long: skipping");
@@@@ -239,7 +242,7 @@@@ void process_site_Renviron ()
 	R_ShowMessage("path to Renviron.site is too long: skipping");
 	return;
     }
-    snprintf(buf, PATH_MAX, "%s/etc/Renviron.site", R_Home);
+    snprintf(buf, sizeof(buf), "%s/etc/Renviron.site", R_Home);
     process_Renviron(buf);
 }
 
@@@@ -259,7 +262,7 @@@@ void process_user_Renviron()
 	s = getenv("R_USER");
 	if(!s) s = getenv("HOME");
 	if(!s) return;
-	snprintf(buf, 1024, "%s/.Renviron", s);
+	snprintf(buf, sizeof(buf), "%s/.Renviron", s);
 	s = buf;
     }
 #endif
@


1.2
log
@Update to R 2.4.0, a clone of S.  Written in C.
@
text
@d1 1
a1 1
$OpenBSD: patch-src_main_Renviron_c,v 1.1 2005/10/08 09:47:37 mbalmer Exp $
@


1.1
log
@Update to version 2.1.1 and take maintainership.

For more information, see release information on
http://www.r-project.org/

with help from bernd@@ and ok robert@@,bernd@@
@
text
@d1 4
a4 4
$OpenBSD$
--- src/main/Renviron.c.orig	Mon Apr 18 13:34:05 2005
+++ src/main/Renviron.c	Wed Aug 10 16:13:14 2005
@@@@ -67,10 +67,12 @@@@ static void Putenv(char *a, char *b)
d19 1
a19 10
@@@@ -108,7 +110,7 @@@@ static int process_Renviron(char *filena
     int errs = 0;
 
     if (!filename || !(fp = fopen(filename, "r"))) return 0;
-    snprintf(msg, MSG_SIZE+50, 
+    snprintf(msg, sizeof(msg), 
 	     "\n   File %s contains invalid line(s)", filename);
 
     while(fgets(sm, BUF_SIZE, fp)) {
@@@@ -118,7 +120,8 @@@@ static int process_Renviron(char *filena
d29 1
a29 1
@@@@ -130,7 +133,7 @@@@ static int process_Renviron(char *filena
d38 3
a40 3
@@@@ -146,8 +149,8 @@@@ void process_system_Renviron()
 	R_ShowMessage("path to system Renviron is too long: skipping");
 	return;
d43 3
a45 1
-    strcat(buf, "/etc/Renviron");
d47 7
a53 5
+    strlcat(buf, "/etc/Renviron", sizeof(buf));
     if(!process_Renviron(buf))
 	R_ShowMessage("cannot find system Renviron");
 }
@@@@ -165,7 +168,7 @@@@ void process_site_Renviron ()
d62 9
@

