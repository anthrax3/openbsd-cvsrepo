head	1.1;
access;
symbols
	OPENBSD_6_2:1.1.0.44
	OPENBSD_6_2_BASE:1.1
	OPENBSD_6_1:1.1.0.42
	OPENBSD_6_1_BASE:1.1
	OPENBSD_6_0:1.1.0.40
	OPENBSD_6_0_BASE:1.1
	OPENBSD_5_9:1.1.0.36
	OPENBSD_5_9_BASE:1.1
	OPENBSD_5_8:1.1.0.38
	OPENBSD_5_8_BASE:1.1
	OPENBSD_5_7:1.1.0.34
	OPENBSD_5_7_BASE:1.1
	OPENBSD_5_6:1.1.0.32
	OPENBSD_5_6_BASE:1.1
	OPENBSD_5_5:1.1.0.30
	OPENBSD_5_5_BASE:1.1
	OPENBSD_5_4:1.1.0.28
	OPENBSD_5_4_BASE:1.1
	OPENBSD_5_3:1.1.0.26
	OPENBSD_5_3_BASE:1.1
	OPENBSD_5_2:1.1.0.24
	OPENBSD_5_2_BASE:1.1
	OPENBSD_5_1_BASE:1.1
	OPENBSD_5_1:1.1.0.22
	OPENBSD_5_0:1.1.0.20
	OPENBSD_5_0_BASE:1.1
	OPENBSD_4_9:1.1.0.18
	OPENBSD_4_9_BASE:1.1
	OPENBSD_4_8:1.1.0.16
	OPENBSD_4_8_BASE:1.1
	OPENBSD_4_7:1.1.0.14
	OPENBSD_4_7_BASE:1.1
	OPENBSD_4_6:1.1.0.12
	OPENBSD_4_6_BASE:1.1
	OPENBSD_4_5:1.1.0.10
	OPENBSD_4_5_BASE:1.1
	OPENBSD_4_4:1.1.0.8
	OPENBSD_4_4_BASE:1.1
	OPENBSD_4_3:1.1.0.6
	OPENBSD_4_3_BASE:1.1
	OPENBSD_4_2:1.1.0.4
	OPENBSD_4_2_BASE:1.1
	OPENBSD_4_1:1.1.0.2
	OPENBSD_4_1_BASE:1.1;
locks; strict;
comment	@# @;


1.1
date	2006.10.29.23.14.43;	author ian;	state Exp;
branches;
next	;


desc
@@


1.1
log
@strcpy->strlcpy; add minimal regress and remove NO_REGRESS; rename old patches
to new naming convention; bump pkg.
@
text
@--- makefile.orig	Sun Oct 29 17:03:34 2006
+++ makefile	Sun Oct 29 17:11:52 2006
@@@@ -1,29 +1,38 @@@@
 YFLAGS = -d
-CFLAGS = -g
+#CFLAGS = -g
 
 SRC = hoc.y hoc.h code.c init.c math.c symbol.c
 OBJS = hoc.o code.o init.o math.o symbol.o
 
 hoc:	$(OBJS)
-	$(CC) $(CFLAGS) $(OBJS) -lstdio -lm -o hoc
+	$(CC) $(CFLAGS) $(OBJS) -lm -o hoc
 
 hoc.o code.o init.o symbol.o:	hoc.h
 
 code.o init.o symbol.o:	x.tab.h
 
+.if ${MACHINE_ARCH} == "i386"
+code.o: code.c
+	$(CC) $(CFLAGS) -O0 -c code.c 
+.endif
+
 x.tab.h:	y.tab.h
 	-cmp -s x.tab.h y.tab.h || cp y.tab.h x.tab.h
 
-pr:	$(SRC)
-	@@prcan $?
-	@@touch pr
-
 install:	hoc
 	cp hoc /usr/bin
 	strip /usr/bin/hoc
 
+y.tab.h y.tab.c: hoc.y
+	yacc ${YFLAGS} hoc.y
+
 clean:
 	rm -f $(OBJS) [xy].tab.[ch]  hoc
 
 bundle:
 	@@bundle $(SRC) makefile README
+
+# a few basic tests
+regress:
+	echo 2/3 | hoc | grep '^0.66666666*7$$' >/dev/null
+	echo 'x=22/7\nprint x' | hoc | grep '^3.142857' >/dev/null
@
