head	1.3;
access;
symbols
	OPENBSD_6_2:1.3.0.4
	OPENBSD_6_2_BASE:1.3
	OPENBSD_6_1:1.3.0.2
	OPENBSD_6_1_BASE:1.3
	OPENBSD_6_0:1.2.0.4
	OPENBSD_6_0_BASE:1.2
	OPENBSD_5_9:1.2.0.2
	OPENBSD_5_9_BASE:1.2;
locks; strict;
comment	@# @;


1.3
date	2016.08.14.16.29.20;	author jca;	state Exp;
branches;
next	1.2;
commitid	hzuojYU7AJDd860n;

1.2
date	2016.01.31.22.29.37;	author sthen;	state Exp;
branches;
next	1.1;
commitid	QvNaX4l26nMG3WDW;

1.1
date	2016.01.27.10.36.00;	author jasper;	state Exp;
branches;
next	;
commitid	9Bayk4NrUSDHGouW;


desc
@@


1.3
log
@Update to p7zip-16.02

Remove patches for security fixes now included in upstream tarball.

From maintainer Josh Grosse.
@
text
@$OpenBSD: patch-CPP_7zip_Bundles_SFXCon_SfxCon_cpp,v 1.2 2016/01/31 22:29:37 sthen Exp $

Pledge self-extracting archives

--- CPP/7zip/Bundles/SFXCon/SfxCon.cpp.orig	Fri May 20 04:38:40 2016
+++ CPP/7zip/Bundles/SFXCon/SfxCon.cpp	Fri Jul 15 07:49:33 2016
@@@@ -250,6 +250,21 @@@@ int Main2(
   #endif
 )
 {
+
+#ifndef EXTERNAL_CODECS
+
+#ifdef PLEDGE_DEBUG
+  printf("pledge: 7za 7zr SFX\n");
+#endif //PLEDGE_DEBUG
+
+  if (pledge("stdio rpath wpath cpath fattr tty", NULL) == -1) {
+    perror("pledge");
+    exit(2);
+  }
+
+#endif
+
+
   #if defined(_WIN32) && !defined(UNDER_CE)
   SetFileApisToOEM();
   #endif
@@@@ -372,6 +387,20 @@@@ int Main2(
       HRESULT result = codecs->Load();
       if (result != S_OK)
         throw CSystemException(result);
+#ifdef EXTERNAL_CODECS
+
+#ifdef PLEDGE_DEBUG
+
+      printf("pledge: 7z SFX\n");
+
+#endif //PLEDGE_DEBUG
+
+      if (pledge("stdio rpath wpath cpath fattr tty", NULL) == -1) {
+	perror("pledge");
+	exit(2);
+      }
+
+#endif
     }
 
     if (command.CommandType != NCommandType::kList)
@


1.2
log
@p7zip needs to pledge tty as well (in standard and SFX archives), it's needed
for password entry. Reported by Andre S, debugging tb@@, fix from Josh Grosse.
ok tb@@
@
text
@d1 1
a1 1
$OpenBSD: patch-CPP_7zip_Bundles_SFXCon_SfxCon_cpp,v 1.1 2016/01/27 10:36:00 jasper Exp $
d5 2
a6 2
--- CPP/7zip/Bundles/SFXCon/SfxCon.cpp.orig	Sat Sep  5 16:22:56 2015
+++ CPP/7zip/Bundles/SFXCon/SfxCon.cpp	Sun Jan 24 15:59:24 2016
d29 4
a32 5
@@@@ -371,6 +386,19 @@@@ int Main2(
     HRESULT result = codecs->Load();
     if (result != S_OK)
       throw CSystemException(result);
+
d36 3
a38 1
+  printf("pledge: 7z SFX\n");
d41 4
a44 4
+  if (pledge("stdio rpath wpath cpath fattr tty", NULL) == -1) {
+    perror("pledge");
+    exit(2);
+  }
d47 1
a49 1
     {
@


1.1
log
@- extend pledge to handle self-extracting archives and the remaining main binaries

from Josh Grosse (MAINTAINER) and brynet@@
ok brynet@@ sthen@@
@
text
@d1 1
a1 1
$OpenBSD$
d18 1
a18 1
+  if (pledge("stdio rpath wpath cpath fattr", NULL) == -1) {
d40 1
a40 1
+  if (pledge("stdio rpath wpath cpath fattr", NULL) == -1) {
@

