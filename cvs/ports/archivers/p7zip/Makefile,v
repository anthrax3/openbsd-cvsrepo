head	1.39;
access;
symbols
	OPENBSD_6_1:1.38.0.2
	OPENBSD_6_1_BASE:1.38
	OPENBSD_6_0:1.35.0.2
	OPENBSD_6_0_BASE:1.35
	OPENBSD_5_9:1.31.0.2
	OPENBSD_5_9_BASE:1.31
	OPENBSD_5_8:1.24.0.4
	OPENBSD_5_8_BASE:1.24
	OPENBSD_5_7:1.23.0.2
	OPENBSD_5_7_BASE:1.23
	OPENBSD_5_6:1.22.0.6
	OPENBSD_5_6_BASE:1.22
	OPENBSD_5_5:1.22.0.4
	OPENBSD_5_5_BASE:1.22
	OPENBSD_5_4:1.22.0.2
	OPENBSD_5_4_BASE:1.22
	OPENBSD_5_3:1.20.0.2
	OPENBSD_5_3_BASE:1.20
	OPENBSD_5_2:1.19.0.4
	OPENBSD_5_2_BASE:1.19
	OPENBSD_5_1_BASE:1.19
	OPENBSD_5_1:1.19.0.2
	OPENBSD_5_0:1.15.0.2
	OPENBSD_5_0_BASE:1.15
	OPENBSD_4_9:1.14.0.2
	OPENBSD_4_9_BASE:1.14
	OPENBSD_4_8:1.12.0.2
	OPENBSD_4_8_BASE:1.12
	OPENBSD_4_7:1.11.0.4
	OPENBSD_4_7_BASE:1.11
	OPENBSD_4_6:1.11.0.2
	OPENBSD_4_6_BASE:1.11
	OPENBSD_4_5:1.10.0.2
	OPENBSD_4_5_BASE:1.10
	OPENBSD_4_4:1.8.0.2
	OPENBSD_4_4_BASE:1.8
	OPENBSD_4_3:1.7.0.2
	OPENBSD_4_3_BASE:1.7
	OPENBSD_4_2:1.3.0.2
	OPENBSD_4_2_BASE:1.3
	steven-20070420:1.1.1.1
	steven:1.1.1;
locks; strict;
comment	@# @;


1.39
date	2017.04.10.11.45.22;	author sthen;	state Exp;
branches;
next	1.38;
commitid	XDh1zlSBq0boKsHk;

1.38
date	2017.01.11.13.44.33;	author jasper;	state Exp;
branches;
next	1.37;
commitid	61VLFHZUokYLlN6N;

1.37
date	2016.11.21.21.49.25;	author juanfra;	state Exp;
branches;
next	1.36;
commitid	jLlzBeM1jpMFXJYA;

1.36
date	2016.08.14.16.29.20;	author jca;	state Exp;
branches;
next	1.35;
commitid	hzuojYU7AJDd860n;

1.35
date	2016.05.30.21.22.50;	author sthen;	state Exp;
branches
	1.35.2.1;
next	1.34;
commitid	hu9G1ubjzQFQSRwe;

1.34
date	2016.04.12.23.13.22;	author sthen;	state Exp;
branches;
next	1.33;
commitid	JN0luTaWnfSidvOJ;

1.33
date	2016.04.10.19.53.09;	author naddy;	state Exp;
branches;
next	1.32;
commitid	iapjxAfShqoMiIMH;

1.32
date	2016.03.16.16.46.31;	author naddy;	state Exp;
branches;
next	1.31;
commitid	4Ekn8nPgVVHWLTwe;

1.31
date	2016.02.04.10.38.26;	author tb;	state Exp;
branches
	1.31.2.1;
next	1.30;
commitid	8O9t8JV6KRlUaDL5;

1.30
date	2016.01.31.22.29.37;	author sthen;	state Exp;
branches;
next	1.29;
commitid	QvNaX4l26nMG3WDW;

1.29
date	2016.01.27.10.36.00;	author jasper;	state Exp;
branches;
next	1.28;
commitid	9Bayk4NrUSDHGouW;

1.28
date	2016.01.22.13.39.08;	author sthen;	state Exp;
branches;
next	1.27;
commitid	Sl3FWeoDjIdLmEJ9;

1.27
date	2016.01.22.13.38.37;	author sthen;	state Exp;
branches;
next	1.26;
commitid	GudY3kKl54V4AqU9;

1.26
date	2015.11.16.22.52.08;	author jca;	state Exp;
branches;
next	1.25;
commitid	pORj1WEtS3ex4XoG;

1.25
date	2015.10.21.10.45.08;	author sthen;	state Exp;
branches;
next	1.24;
commitid	IQaHuQI6JSDON8QS;

1.24
date	2015.03.16.17.20.40;	author juanfra;	state Exp;
branches
	1.24.4.1;
next	1.23;
commitid	WgBklxfqX3w6bjaj;

1.23
date	2014.10.30.23.42.19;	author sthen;	state Exp;
branches;
next	1.22;
commitid	rEVYD0VBUzdSAZ1L;

1.22
date	2013.03.19.19.03.12;	author espie;	state Exp;
branches;
next	1.21;

1.21
date	2013.03.10.22.28.04;	author espie;	state Exp;
branches;
next	1.20;

1.20
date	2012.10.15.15.18.31;	author sthen;	state Exp;
branches;
next	1.19;

1.19
date	2011.12.18.09.01.19;	author ajacoutot;	state Exp;
branches;
next	1.18;

1.18
date	2011.12.04.23.24.20;	author naddy;	state Exp;
branches;
next	1.17;

1.17
date	2011.10.17.11.13.19;	author espie;	state Exp;
branches;
next	1.16;

1.16
date	2011.10.12.08.37.39;	author jasper;	state Exp;
branches;
next	1.15;

1.15
date	2011.03.21.12.54.17;	author sthen;	state Exp;
branches;
next	1.14;

1.14
date	2010.11.15.00.22.45;	author espie;	state Exp;
branches;
next	1.13;

1.13
date	2010.10.18.16.47.00;	author espie;	state Exp;
branches;
next	1.12;

1.12
date	2010.06.20.15.54.35;	author sthen;	state Exp;
branches;
next	1.11;

1.11
date	2009.06.08.09.12.40;	author sthen;	state Exp;
branches;
next	1.10;

1.10
date	2009.02.15.08.02.19;	author steven;	state Exp;
branches;
next	1.9;

1.9
date	2008.11.30.22.24.54;	author steven;	state Exp;
branches;
next	1.8;

1.8
date	2008.06.10.03.24.37;	author sthen;	state Exp;
branches;
next	1.7;

1.7
date	2007.12.16.11.22.29;	author sthen;	state Exp;
branches;
next	1.6;

1.6
date	2007.12.04.12.13.21;	author steven;	state Exp;
branches;
next	1.5;

1.5
date	2007.09.15.10.14.33;	author espie;	state Exp;
branches;
next	1.4;

1.4
date	2007.09.10.10.52.40;	author eric;	state Exp;
branches;
next	1.3;

1.3
date	2007.05.29.21.55.05;	author steven;	state Exp;
branches;
next	1.2;

1.2
date	2007.05.08.17.59.15;	author naddy;	state Exp;
branches;
next	1.1;

1.1
date	2007.04.20.17.50.05;	author steven;	state Exp;
branches
	1.1.1.1;
next	;

1.1.1.1
date	2007.04.20.17.50.05;	author steven;	state Exp;
branches;
next	;

1.24.4.1
date	2016.05.30.21.24.14;	author sthen;	state Exp;
branches;
next	;
commitid	A2GW5CGqwyeKhjsZ;

1.31.2.1
date	2016.05.30.21.23.45;	author sthen;	state Exp;
branches;
next	;
commitid	eMXqGpekBxwdRmHV;

1.35.2.1
date	2016.11.21.21.54.38;	author juanfra;	state Exp;
branches;
next	;
commitid	dfZxwNdpsBrSsTJy;


desc
@@


1.39
log
@use LIBCXX
@
text
@# $OpenBSD: Makefile,v 1.38 2017/01/11 13:44:33 jasper Exp $

COMMENT-main=	file archiver with high compression ratio
COMMENT-rar=	rar modules for p7zip

V=		16.02
REVISION-main=	1
REVISION-rar=	0
DISTNAME=	p7zip_${V}_src_all
PKGNAME=	p7zip-${V}
PKGNAME-main=	p7zip-${V}
PKGNAME-rar=	p7zip-rar-${V}
CATEGORIES=	archivers

HOMEPAGE=	http://sourceforge.net/projects/p7zip/

MAINTAINER=	Josh Grosse <josh@@jggimi.net>

# LGPL, except unRar plugin which is licensed as Freeware
PERMIT_PACKAGE_CDROM-rar=	no fee
PERMIT_PACKAGE_CDROM=		Yes
PERMIT_PACKAGE_FTP=		Yes

# uses pledge()
WANTLIB=	m pthread ${LIBCXX}
WANTLIB-main=	${WANTLIB} c
WANTLIB-rar=	${WANTLIB}

MASTER_SITES=	${MASTER_SITE_SOURCEFORGE:=p7zip/}
EXTRACT_SUFX=	.tar.bz2

MULTI_PACKAGES=	-main -rar

RUN_DEPENDS-rar= ${BASE_PKGPATH},-main

WRKDIST=	${WRKDIR}/p7zip_${V}

USE_GMAKE=	Yes
MAKE_FILE=	makefile
MAKE_FLAGS=	MYCC="${CC}" MYCXX="${CXX}" \
		MYCFLAGS="${CFLAGS}" MYCXXFLAGS="${CXXFLAGS}"

ALL_TARGET=	all3
TEST_TARGET=	all_test

do-configure:
	cp ${WRKSRC}/makefile.openbsd ${WRKSRC}/makefile.machine

do-install:
	@@cd ${WRKBUILD} && ${SETENV} ${MAKE_ENV} PREFIX=${TRUEPREFIX} \
		DESTDIR=${DESTDIR} /bin/sh install.sh
	@@chmod -R u=rwX,g=rX ${PREFIX}/share/doc/p7zip

.include <bsd.port.mk>
@


1.38
log
@update maintainer e-mail

from Josh Grosse
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.37 2016/11/21 21:49:25 juanfra Exp $
d25 1
a25 1
WANTLIB=	m pthread stdc++
@


1.37
log
@CVE-2016-9296: Null pointer dereference

https://cve.mitre.org/cgi-bin/cvename.cgi?name=CVE-2016-9296

From Josh Grosse (MAINTAINER)
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.36 2016/08/14 16:29:20 jca Exp $
d7 2
a8 1
REVISION-main=	0
d17 1
a17 1
MAINTAINER=	Josh Grosse <josh@@jggimi.homeip.net>
@


1.36
log
@Update to p7zip-16.02

Remove patches for security fixes now included in upstream tarball.

From maintainer Josh Grosse.
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.35 2016/05/30 21:22:50 sthen Exp $
d7 1
@


1.35
log
@Security fix for p7zip; CVE-2016-2334 and CVE-2016-2335.
From Josh Grosse.
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.34 2016/04/12 23:13:22 sthen Exp $
d6 1
a6 1
V=		15.14.1
a9 1
REVISION-main=	1
@


1.35.2.1
log
@CVE-2016-9296: Null pointer dereference

https://cve.mitre.org/cgi-bin/cvename.cgi?name=CVE-2016-9296

From Josh Grosse (MAINTAINER)
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.35 2016/05/30 21:22:50 sthen Exp $
d10 1
a10 1
REVISION-main=	2
@


1.34
log
@Use HW_PHYSMEM64 to retrieve memory, from Josh Grosse (maintainer). I found
this with a distfiles search following graphics/darktable fix earlier, and
Josh fixed my fix (I missed an ifdef, and he also found places which needed
a ps pledge after enabling this).
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.33 2016/04/10 19:53:09 naddy Exp $
d10 1
a10 1
REVISION-main=	0
@


1.33
log
@Update: 15.09 -> 15.14.1

While here removes some trailing whitespace in pkg/DESCR-main noted
by portcheck(1).

From maintainer Josh Grosse.
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.32 2016/03/16 16:46:31 naddy Exp $
d10 1
@


1.32
log
@remove SHARED_ONLY from ports that don't use any MODULES
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.31 2016/02/04 10:38:26 tb Exp $
d6 1
a6 2
V=		15.09
REVISION=	4
@


1.31
log
@Further pledge(2) fallout due to password protected archives.
Listing or checking the integrity may call readpassphrase(3)
and thus requires a "tty" promise.

Report and fix by provided by Andre S, thanks!

ok czarkoff@@, Josh Grosse (MAINTAINER)
@
text
@d1 1
a1 3
# $OpenBSD: Makefile,v 1.30 2016/01/31 22:29:37 sthen Exp $

SHARED_ONLY=	Yes
@


1.31.2.1
log
@Security fix for p7zip; CVE-2016-2334 and CVE-2016-2335.
From Josh Grosse.
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.31 2016/02/04 10:38:26 tb Exp $
d9 1
a9 1
REVISION=	5
@


1.30
log
@p7zip needs to pledge tty as well (in standard and SFX archives), it's needed
for password entry. Reported by Andre S, debugging tb@@, fix from Josh Grosse.
ok tb@@
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.29 2016/01/27 10:36:00 jasper Exp $
d9 1
a9 1
REVISION=	3
@


1.29
log
@- extend pledge to handle self-extracting archives and the remaining main binaries

from Josh Grosse (MAINTAINER) and brynet@@
ok brynet@@ sthen@@
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.28 2016/01/22 13:39:08 sthen Exp $
d9 1
a9 1
REVISION=	2
@


1.28
log
@add a "# uses pledge()" marker for ease of finding it again
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.27 2016/01/22 13:38:37 sthen Exp $
d9 1
a9 1
REVISION=	1
@


1.27
log
@pledge p7zip, from maintainer Josh Grosse (thanks for digging into this Josh!).
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.26 2015/11/16 22:52:08 jca Exp $
d25 1
@


1.26
log
@Expand ifdefs to build on most if not all OpenBSD architectures.

The solution isn't very nice but is the least intrusive right now; and
you can only find portability bugs in programs that do build.  As
suggested by naddy@@, something based on endian.h would probably be
nicer.

ok sthen@@, Josh Grosse (maintainer)
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.25 2015/10/21 10:45:08 sthen Exp $
d9 1
a9 1
REVISION=	0
@


1.25
log
@update to p7zip-15.09, from maintainer Josh Grosse
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.24 2015/03/16 17:20:40 juanfra Exp $
d9 1
@


1.24
log
@Update to p7zip 9.38.1. From Josh Grosse (MAINTAINER).
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.23 2014/10/30 23:42:19 sthen Exp $
d8 1
a8 1
V=		9.38.1
@


1.24.4.1
log
@Security fix for p7zip; CVE-2016-2334 and CVE-2016-2335.
From Josh Grosse.
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.24 2015/03/16 17:20:40 juanfra Exp $
a8 1
REVISION=	0
@


1.23
log
@chown to set permissions to avoid needing root to "make clean" after build
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.22 2013/03/19 19:03:12 espie Exp $
d8 1
a8 1
V=		9.20.1
a12 2
REVISION-main=	1
REVISION-rar=	1
@


1.22
log
@more explicit PERMIT_* setup, going to strengthen the rules for multi-packages
a wee little bit.
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.21 2013/03/10 22:28:04 espie Exp $
d13 1
a13 1
REVISION-main=	0
d53 1
@


1.21
log
@regress -> test
PERMIT_* cleanup
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.20 2012/10/15 15:18:31 sthen Exp $
d24 1
@


1.20
log
@zap trailing whitespace in files where it's present on PERMIT_* lines
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.19 2011/12/18 09:01:19 ajacoutot Exp $
a23 3
PERMIT_PACKAGE_FTP=		Yes
PERMIT_DISTFILES_CDROM=		no fee
PERMIT_DISTFILES_FTP=		Yes
d44 1
a44 1
REGRESS_TARGET=	all_test
@


1.19
log
@Remove USE_GROFF from ports where mandoc doesn't have any ERRORs and
formatting looks Ok.

from Brad
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.18 2011/12/04 23:24:20 naddy Exp $
d24 1
a24 1
PERMIT_PACKAGE_FTP=		Yes 
d26 1
a26 1
PERMIT_DISTFILES_FTP=		Yes 
@


1.18
log
@remove a workaround that is no longer required for alpha/gcc4
(and in fact not even alpha/gcc3)
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.17 2011/10/17 11:13:19 espie Exp $
a41 1
USE_GROFF=	Yes
@


1.17
log
@MACHINE_ARCH is always available, no need to move bsd.port.mk just for it.
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.16 2011/10/12 08:37:39 jasper Exp $
d13 2
a14 1
REVISION-rar=	0
a46 6
# unaligned access error in NCompress::NPPMD::CInfo::CreateSuccessors()
.if ${MACHINE_ARCH} == "alpha"
CXXFLAGS:=     ${CXXFLAGS:N-O*}
.endif


a57 1

@


1.16
log
@regen WANTLIB
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.15 2011/03/21 12:54:17 sthen Exp $
d46 6
a63 4
# unaligned access error in NCompress::NPPMD::CInfo::CreateSuccessors()
.if ${MACHINE_ARCH} == "alpha"
CXXFLAGS:=     ${CXXFLAGS:N-O*}
.endif
@


1.15
log
@update to 9.20.1, from maintainer Josh Grosse
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.14 2010/11/15 00:22:45 espie Exp $
d13 1
d27 3
a29 2
WANTLIB-main=	c m pthread stdc++
WANTLIB-rar=	pthread
@


1.14
log
@convert to new style depends
zap default spec that are not needed
convert libspecs as well
convert p* to REVISION.

No package changes
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.13 2010/10/18 16:47:00 espie Exp $
d8 1
a8 1
V=		9.13
d39 1
a39 1
USE_GROFF =	Yes
a48 1
	cp ${WRKSRC}/makefile.parallel_jobs ${WRKSRC}/makefile
@


1.13
log
@USE_GROFF=Yes
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.12 2010/06/20 15:54:35 sthen Exp $
d34 1
a34 1
RUN_DEPENDS-rar=::archivers/p7zip,-main
@


1.12
log
@pudate to 9.13, Josh Grosse (maintainer) ok
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.11 2009/06/08 09:12:40 sthen Exp $
d39 1
@


1.11
log
@update to 9.04; from Josh Grosse (maintainer).
version numbering scheme changed to match 7-Zip.
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.10 2009/02/15 08:02:19 steven Exp $
d8 1
a8 1
V=		9.04
@


1.10
log
@update to 4.65

from maintainer Josh Grosse
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.9 2008/11/30 22:24:54 steven Exp $
d8 1
a8 1
V=		4.65
@


1.9
log
@update to 4.61

from maintainer Josh Grosse
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.7 2007/12/16 11:22:29 sthen Exp $
d8 1
a8 1
V=		4.61
@


1.8
log
@update to 4.58 and fix homepage, from maintainer Josh Grosse with
tweaks by me. Changelog notes speed optimizations, bug fixes, utf8
support for .zip filenames, .lzma unpack added.
@
text
@d8 1
a8 1
V=		4.58
@


1.7
log
@update to 4.57 from MAINTAINER, Josh Grosse

ok steven
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.6 2007/12/04 12:13:21 steven Exp $
d8 1
a8 1
V=		4.57
d15 1
a15 1
HOMEPAGE=	http://www.7-zip.org/
@


1.6
log
@update to 4.55

from maintainer Josh Grosse
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.5 2007/09/15 10:14:33 espie Exp $
d8 1
a8 1
V=		4.55
@


1.5
log
@zap all quotes in COMMENT/PERMIT_*
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.4 2007/09/10 10:52:40 eric Exp $
d8 1
a8 1
V=		4.53
@


1.4
log
@- update to 4.53 from maintainer Josh Grosse
- remove quotes from COMMENT

ok sthen@@
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.3 2007/05/29 21:55:05 steven Exp $
d20 1
a20 1
PERMIT_PACKAGE_CDROM-rar=	"no fee"
d23 1
a23 1
PERMIT_DISTFILES_CDROM=		"no fee"
@


1.3
log
@update to 4.47

from maintainer Josh Grosse, also tested by Stuart Henderson
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.2 2007/05/08 17:59:15 naddy Exp $
d5 2
a6 2
COMMENT-main=	"file archiver with high compression ratio"
COMMENT-rar=	"rar modules for p7zip"
d8 1
a8 1
V=		4.47
d38 1
d48 1
@


1.2
log
@update to 4.45; from maintainer Josh Grosse
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.1.1.1 2007/04/20 17:50:05 steven Exp $
d8 1
a8 1
V=		4.45
d43 1
a43 1
REGRESS_TARGET=	test
@


1.1
log
@Initial revision
@
text
@d1 1
a1 1
# $OpenBSD$
d8 1
a8 1
V=		4.44
@


1.1.1.1
log
@import p7zip 4.44

p7zip is a port of 7-zip for *nix platforms.
7-zip is a file archiver with a high compression ratio.

from Josh Grosse <josh at jggimi.homeip.net> and
Stuart Henderson <stu at spacehopper.org>

with testing, feedback, and ok from naddy@@
@
text
@@
