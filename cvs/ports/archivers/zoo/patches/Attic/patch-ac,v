head	1.3;
access;
symbols
	OPENBSD_3_9:1.2.0.26
	OPENBSD_3_9_BASE:1.2
	OPENBSD_3_8:1.2.0.24
	OPENBSD_3_8_BASE:1.2
	OPENBSD_3_7:1.2.0.22
	OPENBSD_3_7_BASE:1.2
	OPENBSD_3_6:1.2.0.20
	OPENBSD_3_6_BASE:1.2
	OPENBSD_3_5:1.2.0.18
	OPENBSD_3_5_BASE:1.2
	OPENBSD_3_4:1.2.0.16
	OPENBSD_3_4_BASE:1.2
	OPENBSD_3_3:1.2.0.14
	OPENBSD_3_3_BASE:1.2
	OPENBSD_3_2:1.2.0.12
	OPENBSD_3_2_BASE:1.2
	OPENBSD_3_1:1.2.0.10
	OPENBSD_3_1_BASE:1.2
	OPENBSD_3_0:1.2.0.8
	OPENBSD_3_0_BASE:1.2
	OPENBSD_2_9_TRACKING_SWITCH:1.2
	OPENBSD_2_9:1.2.0.6
	OPENBSD_2_9_BASE:1.2
	OPENBSD_2_8:1.2.0.4
	OPENBSD_2_8_BASE:1.2
	OPENBSD_2_7:1.2.0.2
	OPENBSD_2_7_BASE:1.2
	OPENBSD_2_6:1.1.0.8
	OPENBSD_2_6_BASE:1.1
	OPENBSD_2_5:1.1.0.6
	OPENBSD_2_5_BASE:1.1
	OPENBSD_2_4:1.1.0.4
	OPENBSD_2_4_BASE:1.1
	OPENBSD_2_3:1.1.0.2
	OPENBSD_2_3_BASE:1.1;
locks; strict;
comment	@# @;


1.3
date	2006.04.07.07.40.18;	author pvalchev;	state dead;
branches;
next	1.2;

1.2
date	99.12.16.04.31.40;	author brad;	state Exp;
branches;
next	1.1;

1.1
date	97.11.25.20.14.48;	author angelos;	state Exp;
branches;
next	;


desc
@@


1.3
log
@update-patches
@
text
@--- zoopack.c.orig	Fri Apr 30 23:59:21 1993
+++ zoopack.c	Wed Dec 15 23:08:44 1999
@@@@ -78,6 +78,9 @@@@
 int curr_dir = 0;									/* create backup in curr dir */
 static char partial_msg[] =
    "Partially packed archive left in %s.\n";
+#if defined(__OpenBSD__)
+int tempfd;
+#endif
 
 #ifdef FATTR
 unsigned long zoofattr;							/* zoo archive protection */
@@@@ -171,8 +174,11 @@@@
 } else {
    strcpy (temp_file, xes);
 }
-mktemp (temp_file);                    /* ... and make unique */
-new_file = zoocreate (temp_file);
+tempfd = mkstemp (temp_file);                    /* ... and make unique */
+if (tempfd == -1)
+   prterror ('f', "Could not create temporary file %s.\n", temp_file);
+new_file = fdopen(tempfd, "w+");
+/*new_file = zoocreate (temp_file); */
 if (new_file == NOFILE)
    prterror ('f', "Could not create temporary file %s.\n", temp_file);
 
@


1.2
log
@- replace ugliness in install target with BSD_INSTALL macros
- convert patches to unified diffs
- add patch to suppress some warnings
@
text
@@


1.1
log
@Remove race condition of mktemp().
@
text
@d1 26
a26 36
*** zoopack.c.orig	Tue Nov 25 15:02:41 1997
--- zoopack.c	Tue Nov 25 15:10:46 1997
***************
*** 78,83 ****
--- 78,86 ----
  int curr_dir = 0;									/* create backup in curr dir */
  static char partial_msg[] =
     "Partially packed archive left in %s.\n";
+ #if defined(__OpenBSD__)
+ int tempfd;
+ #endif
  
  #ifdef FATTR
  unsigned long zoofattr;							/* zoo archive protection */
***************
*** 171,178 ****
  } else {
     strcpy (temp_file, xes);
  }
! mktemp (temp_file);                    /* ... and make unique */
! new_file = zoocreate (temp_file);
  if (new_file == NOFILE)
     prterror ('f', "Could not create temporary file %s.\n", temp_file);
  
--- 174,184 ----
  } else {
     strcpy (temp_file, xes);
  }
! tempfd = mkstemp (temp_file);                    /* ... and make unique */
! if (tempfd == -1)
!    prterror ('f', "Could not create temporary file %s.\n", temp_file);
! new_file = fdopen(tempfd, "w+");
! /*new_file = zoocreate (temp_file); */
  if (new_file == NOFILE)
     prterror ('f', "Could not create temporary file %s.\n", temp_file);
  
@

