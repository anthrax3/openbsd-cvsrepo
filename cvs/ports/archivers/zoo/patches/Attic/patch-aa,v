head	1.4;
access;
symbols
	OPENBSD_3_9:1.3.0.26
	OPENBSD_3_9_BASE:1.3
	OPENBSD_3_8:1.3.0.24
	OPENBSD_3_8_BASE:1.3
	OPENBSD_3_7:1.3.0.22
	OPENBSD_3_7_BASE:1.3
	OPENBSD_3_6:1.3.0.20
	OPENBSD_3_6_BASE:1.3
	OPENBSD_3_5:1.3.0.18
	OPENBSD_3_5_BASE:1.3
	OPENBSD_3_4:1.3.0.16
	OPENBSD_3_4_BASE:1.3
	OPENBSD_3_3:1.3.0.14
	OPENBSD_3_3_BASE:1.3
	OPENBSD_3_2:1.3.0.12
	OPENBSD_3_2_BASE:1.3
	OPENBSD_3_1:1.3.0.10
	OPENBSD_3_1_BASE:1.3
	OPENBSD_3_0:1.3.0.8
	OPENBSD_3_0_BASE:1.3
	OPENBSD_2_9_TRACKING_SWITCH:1.3
	OPENBSD_2_9:1.3.0.6
	OPENBSD_2_9_BASE:1.3
	OPENBSD_2_8:1.3.0.4
	OPENBSD_2_8_BASE:1.3
	OPENBSD_2_7:1.3.0.2
	OPENBSD_2_7_BASE:1.3
	OPENBSD_2_6:1.2.0.8
	OPENBSD_2_6_BASE:1.2
	OPENBSD_2_5:1.2.0.6
	OPENBSD_2_5_BASE:1.2
	OPENBSD_2_4:1.2.0.4
	OPENBSD_2_4_BASE:1.2
	OPENBSD_2_3:1.2.0.2
	OPENBSD_2_3_BASE:1.2;
locks; strict;
comment	@# @;


1.4
date	2006.04.07.07.40.18;	author pvalchev;	state dead;
branches;
next	1.3;

1.3
date	99.12.16.04.31.40;	author brad;	state Exp;
branches;
next	1.2;

1.2
date	97.11.25.20.13.31;	author angelos;	state Exp;
branches;
next	1.1;

1.1
date	97.11.24.20.07.54;	author angelos;	state Exp;
branches;
next	;


desc
@@


1.4
log
@update-patches
@
text
@--- bsd.c.orig	Sat May  1 00:21:53 1993
+++ bsd.c	Wed Dec 15 23:08:42 1999
@@@@ -69,8 +69,16 @@@@
 }
 
 /* Function gettz() returns the offset from GMT in seconds */
-long gettz()
+long gettz(t)
+#if defined(__OpenBSD__)
+time_t t;
+#else
+long t;
+#endif
 {
+#if defined(__FreeBSD__) || defined(__OpenBSD__) || defined(__NetBSD__)
+   return -localtime(&t)->tm_gmtoff;
+#else
 #define SEC_IN_DAY	(24L * 60L * 60L)
 #define INV_VALUE		(SEC_IN_DAY + 1L)
 	static long retval = INV_VALUE;	     /* cache, init to impossible value */
@@@@ -95,6 +103,7 @@@@
 	retval = -tm->tm_gmtoff;
 #endif
 	return retval;
+#endif
 }
 
 /* Standard UNIX-compatible time routines */
@@@@ -103,15 +112,19 @@@@
 /* Standard UNIX-specific file attribute routines */
 #include "nixmode.i"
 
+#if defined(__FreeBSD__) || defined(__OpenBSD__) || defined(__NetBSD__)
+#include <unistd.h>
+#else
 #ifndef SEEK_CUR
 # define  SEEK_CUR    1
 #endif
+#endif
 
 /* Truncate a file. */
 int zootrunc(f) FILE *f;
 {
-	extern long lseek();
-	long seekpos;
+	extern off_t lseek();
+	off_t seekpos;
 	int fd = fileno(f);
 	seekpos = lseek(fd, 0L, SEEK_CUR);
 	if (seekpos >= 0)
@


1.3
log
@- replace ugliness in install target with BSD_INSTALL macros
- convert patches to unified diffs
- add patch to suppress some warnings
@
text
@@


1.2
log
@Fix warnings.
@
text
@d1 50
a50 240
*** bsd.c.orig	Sat May  1 00:21:53 1993
--- bsd.c	Tue Nov 25 14:51:06 1997
***************
*** 69,76 ****
  }
  
  /* Function gettz() returns the offset from GMT in seconds */
! long gettz()
  {
  #define SEC_IN_DAY	(24L * 60L * 60L)
  #define INV_VALUE		(SEC_IN_DAY + 1L)
  	static long retval = INV_VALUE;	     /* cache, init to impossible value */
--- 69,84 ----
  }
  
  /* Function gettz() returns the offset from GMT in seconds */
! long gettz(t)
! #if defined(__OpenBSD__)
! time_t t;
! #else
! long t;
! #endif
  {
+ #if defined(__FreeBSD__) || defined(__OpenBSD__) || defined(__NetBSD__)
+    return -localtime(&t)->tm_gmtoff;
+ #else
  #define SEC_IN_DAY	(24L * 60L * 60L)
  #define INV_VALUE		(SEC_IN_DAY + 1L)
  	static long retval = INV_VALUE;	     /* cache, init to impossible value */
***************
*** 95,100 ****
--- 103,109 ----
  	retval = -tm->tm_gmtoff;
  #endif
  	return retval;
+ #endif
  }
  
  /* Standard UNIX-compatible time routines */
***************
*** 103,117 ****
  /* Standard UNIX-specific file attribute routines */
  #include "nixmode.i"
  
  #ifndef SEEK_CUR
  # define  SEEK_CUR    1
  #endif
  
  /* Truncate a file. */
  int zootrunc(f) FILE *f;
  {
! 	extern long lseek();
! 	long seekpos;
  	int fd = fileno(f);
  	seekpos = lseek(fd, 0L, SEEK_CUR);
  	if (seekpos >= 0)
--- 112,130 ----
  /* Standard UNIX-specific file attribute routines */
  #include "nixmode.i"
  
+ #if defined(__FreeBSD__) || defined(__OpenBSD__) || defined(__NetBSD__)
+ #include <unistd.h>
+ #else
  #ifndef SEEK_CUR
  # define  SEEK_CUR    1
  #endif
+ #endif
  
  /* Truncate a file. */
  int zootrunc(f) FILE *f;
  {
! 	extern off_t lseek();
! 	off_t seekpos;
  	int fd = fileno(f);
  	seekpos = lseek(fd, 0L, SEEK_CUR);
  	if (seekpos >= 0)
*** misc2.c.old	Thu Aug  8 09:34:48 1991
--- misc2.c	Thu Jan  5 05:37:06 1995
***************
*** 314,323 ****
  {
  	long diff_tz;
  	long longtime;
  	if (direntry->tz == NO_TZ)		/* none stored */
  		return;
! 	diff_tz = (long) direntry->tz * (3600/4) - gettz(); /* diff. in seconds */
! 	longtime = mstonix (direntry->date, direntry->time) + diff_tz; /* adj tz */
  	mstime (longtime, &direntry->date, &direntry->time);
  }
  #endif /* GETTZ */
--- 314,325 ----
  {
  	long diff_tz;
  	long longtime;
+ 	long t;
  	if (direntry->tz == NO_TZ)		/* none stored */
  		return;
! 	t = mstonix (direntry->date, direntry->time);
! 	diff_tz = (long) direntry->tz * (3600/4) - gettz(t); /* diff. in seconds */
! 	longtime = t + diff_tz; /* adj tz */
  	mstime (longtime, &direntry->date, &direntry->time);
  }
  #endif /* GETTZ */
*** nixtime.i.old	Thu Aug  8 09:34:57 1991
--- nixtime.i	Thu Jan  5 05:16:28 1995
***************
*** 52,58 ****
  	long mstonix();
  	long gettz();
  	long utimbuf[2];
! 	utimbuf[0] = utimbuf[1] = gettz() + mstonix (date, time);
  	return (utime (path, utimbuf));
  }
  
--- 52,59 ----
  	long mstonix();
  	long gettz();
  	long utimbuf[2];
! 	long t = mstonix (date, time);
! 	utimbuf[0] = utimbuf[1] = t + gettz(t);
  	return (utime (path, utimbuf));
  }
  
*** zoolist.c.old	Thu Aug  8 09:36:09 1991
--- zoolist.c	Thu Jan  5 05:41:47 1995
***************
*** 539,548 ****
  {
  	long gettz();
  	int diff_tz;				/* timezone difference */
  	if (file_tz == NO_TZ) 	/* if no timezone stored ..*/
  		printf ("   ");			/* .. just pad with blanks */
  	else {
! 		diff_tz = (file_tz / 4) - (int) (gettz() / 3600);
  		if (diff_tz == 0)
  			printf ("   ");					/* print nothing if same */
  		else if (diff_tz > 0)			/* else print signed difference */
--- 539,550 ----
  {
  	long gettz();
  	int diff_tz;				/* timezone difference */
+ 	long t;
  	if (file_tz == NO_TZ) 	/* if no timezone stored ..*/
  		printf ("   ");			/* .. just pad with blanks */
  	else {
! 		time(&t);
! 		diff_tz = (file_tz / 4) - (int) (gettz(t) / 3600);
  		if (diff_tz == 0)
  			printf ("   ");					/* print nothing if same */
  		else if (diff_tz > 0)			/* else print signed difference */
*** zoofns.h.bak	Thu Aug  8 09:36:02 1991
--- zoofns.h	Thu Jan  5 06:03:04 1995
***************
*** 94,100 ****
--- 94,104 ----
  void fixslash PARMS ((char *));
  void makelist PARMS ((int, char *[], char *[], int, char *, char *, char *, int *));
  void memerr PARMS ((unsigned int));
+ #ifdef STDARG
+ void prterror(int level, char *format, ...);
+ #else
  void prterror PARMS ((int, char *, ...));
+ #endif
  void rootname PARMS ((char *, char *));
  void skip_files PARMS ((ZOOFILE, unsigned int *, unsigned int *, int *,
                    char [], long *));
*** options.h.orig	Sat May  1 08:27:59 1993
--- options.h	Thu Jan  5 06:51:56 1995
***************
*** 96,102 ****
  #define NIXTIME
  #define NIXFNAME
  #define NEEDCTYP
- #define NOENUM
  #define REN_STDC
  #define SETBUF
  #define GETTZ
--- 96,101 ----
***************
*** 110,115 ****
--- 109,115 ----
  #define ANSI_PROTO
  #define VOIDPTR		void *
  #else
+ #define NOENUM
  #define NOSTRCHR /* not really needed for 4.3BSD */
  #define T_SIGNAL	int
  #define VARARGS
*** zooadd2.c.orig	Sat Jul 20 02:38:10 1991
--- zooadd2.c	Thu Jan  5 06:55:40 1995
***************
*** 258,269 ****
  register struct direntry *direntry;
  {
  #ifdef GETTZ
  	long gettz();
  #endif
     direntry->zoo_tag = ZOO_TAG;
     direntry->type = 2;                  /* type is now 2 */
  #ifdef GETTZ
! 	direntry->tz = gettz() / (15 * 60); /* seconds => 15-min units */
  #else
     direntry->tz = NO_TZ;                /* timezone unknown */
  #endif
--- 258,272 ----
  register struct direntry *direntry;
  {
  #ifdef GETTZ
+ 	long mstonix();
  	long gettz();
+ 	long t;
  #endif
     direntry->zoo_tag = ZOO_TAG;
     direntry->type = 2;                  /* type is now 2 */
  #ifdef GETTZ
! 	t = mstonix (direntry->date, direntry->time);
! 	direntry->tz = gettz(t) / (15 * 60); /* seconds => 15-min units */
  #else
     direntry->tz = NO_TZ;                /* timezone unknown */
  #endif
*** ar.h.orig	Sat May  1 00:04:22 1993
--- ar.h	Tue Nov 25 14:47:57 1997
***************
*** 15,25 ****
--- 15,29 ----
  /* uchar should be 8 bits or more */
  /* typedef unsigned char  uchar;   -- already in zoo.h */
  
+ #if !(defined(__FreeBSD__) && __FreeBSD__ < 3) && !defined(__OpenBSD__) && !defined(__NetBSD__)
  typedef unsigned int   uint;    /* 16 bits or more */
  #if !defined(__386BSD__) || !defined(_TYPES_H_)
  typedef unsigned short ushort;  /* 16 bits or more */
  #endif
+ #endif
+ #if !(defined(__OpenBSD__))
  typedef unsigned long  ulong;   /* 32 bits or more */
+ #endif
  
  /* T_UINT16 must be #defined in options.h to be 
  a 16-bit unsigned integer type */
@


1.1
log
@Add zoo port.
@
text
@d1 2
a2 2
*** bsd.c.old	Thu Aug  8 09:34:07 1991
--- bsd.c	Thu Jan  5 05:20:03 1995
d13 1
a13 1
--- 69,80 ----
d18 3
d22 1
d31 4
a34 4
*** 83,88 ****
--- 87,93 ----
  	/* Timezone fix thanks to Bill Davidsen <wedu@@ge-crd.ARPA> */
  	retval = tzp.tz_minuteswest * 60 - tzp.tz_dsttime * 3600L;
d41 1
a41 1
*** 91,105 ****
d57 1
a57 1
--- 96,114 ----
d221 2
a222 2
*** ar.h.orig	Sat May  1 08:04:22 1993
--- ar.h	Thu Jan  5 07:05:36 1995
d224 2
a225 2
*** 15,23 ****
--- 15,25 ----
d233 1
d235 1
a235 1
  #endif
d237 1
d239 2
@
