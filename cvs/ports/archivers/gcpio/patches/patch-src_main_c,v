head	1.4;
access;
symbols
	OPENBSD_6_0:1.4.0.4
	OPENBSD_6_0_BASE:1.4
	OPENBSD_5_9:1.4.0.2
	OPENBSD_5_9_BASE:1.4
	OPENBSD_5_8:1.3.0.8
	OPENBSD_5_8_BASE:1.3
	OPENBSD_5_6:1.3.0.4
	OPENBSD_5_7:1.3.0.2
	OPENBSD_4_1:1.1.0.6
	OPENBSD_4_1_BASE:1.1
	OPENBSD_4_0:1.1.0.4
	OPENBSD_4_0_BASE:1.1
	OPENBSD_3_9:1.1.0.2
	OPENBSD_3_9_BASE:1.1;
locks; strict;
comment	@# @;


1.4
date	2015.09.17.20.16.49;	author naddy;	state Exp;
branches;
next	1.3;
commitid	LSQA2hSb03IcYnZB;

1.3
date	2015.03.31.15.36.52;	author naddy;	state Exp;
branches
	1.3.2.1
	1.3.4.1;
next	1.2;
commitid	2ATlUkZrXvt3nbGs;

1.2
date	2007.04.17.19.46.42;	author naddy;	state dead;
branches;
next	1.1;

1.1
date	2005.10.20.21.45.18;	author naddy;	state Exp;
branches
	1.1.2.1
	1.1.4.1
	1.1.6.1;
next	;

1.1.2.1
date	2007.04.19.13.47.06;	author sturm;	state dead;
branches;
next	;

1.1.4.1
date	2007.04.19.14.26.57;	author sturm;	state dead;
branches;
next	;

1.1.6.1
date	2007.05.01.16.37.56;	author sturm;	state dead;
branches;
next	;

1.3.2.1
date	2015.03.31.17.19.37;	author naddy;	state Exp;
branches;
next	;
commitid	NnVrKcAFUjoWE1Yb;

1.3.4.1
date	2015.03.31.17.47.02;	author naddy;	state Exp;
branches;
next	;
commitid	7Z6Erp1glhgnAeOI;


desc
@@


1.4
log
@Update to 2.12, but retain local fix for CVE-2015-1197.
Grab maintainer.
@
text
@$OpenBSD: patch-src_main_c,v 1.3 2015/03/31 15:36:52 naddy Exp $

CVE-2015-1197: cpio directory traversal

--- src/main.c.orig	Sat Sep 12 12:57:30 2015
+++ src/main.c	Wed Sep 16 23:22:21 2015
@@@@ -61,7 +61,8 @@@@ enum cpio_options {
   TO_STDOUT_OPTION,
   RENUMBER_INODES_OPTION,
   IGNORE_DEVNO_OPTION,
-  DEVICE_INDEPENDENT_OPTION
+  DEVICE_INDEPENDENT_OPTION,
+  EXTRACT_OVER_SYMLINKS
 };
 
 const char *program_authors[] =
@@@@ -243,6 +244,8 @@@@ static struct argp_option options[] = {
    N_("Create leading directories where needed"), GRID+1 },
   {"no-preserve-owner", NO_PRESERVE_OWNER_OPTION, 0, 0,
    N_("Do not change the ownership of the files"), GRID+1 },
+  {"extract-over-symlinks", EXTRACT_OVER_SYMLINKS, 0, 0,
+   N_("Force writing over symbolic links"), GRID+1 },
   {"unconditional", 'u', NULL, 0,
    N_("Replace all files unconditionally"), GRID+1 },
   {"sparse", SPARSE_OPTION, NULL, 0,
@@@@ -430,6 +433,10 @@@@ crc newc odc bin ustar tar (all-caps also recognized)"
 	USAGE_ERROR ((0, 0,  
 		      _("--no-preserve-owner cannot be used with --owner")));
       no_chown_flag = true;
+      break;
+
+    case EXTRACT_OVER_SYMLINKS:		        /* --extract-over-symlinks */
+      extract_over_symlinks = true;
       break;
 
     case 'o':		/* Copy-out mode.  */
@


1.3
log
@CVE-2014-9112: Heap-based buffer overflow in the process_copy_in
function allows remote attackers to cause a denial of service via
a large block value in a cpio archive.
Fix from a series of upstream commits by Sergey Poznyakoff, via Debian.

CVE-2015-1197: cpio, when using the --no-absolute-filenames option,
allows local users to write to arbitrary files via a symlink attack
on a file in an archive.
Fix from Vitezslav Cizek after 3.5 years of gestation in the SUSE
bug tracker, via Debian.

Also apply an upstream fix for some regression tests while here.
@
text
@d1 1
a1 1
$OpenBSD$
d5 8
a12 8
--- src/main.c.orig	Fri Feb 12 12:35:09 2010
+++ src/main.c	Sun Mar 29 21:11:10 2015
@@@@ -57,7 +57,8 @@@@ enum cpio_options {
   FORCE_LOCAL_OPTION,            
   DEBUG_OPTION,                  
   BLOCK_SIZE_OPTION,             
-  TO_STDOUT_OPTION
+  TO_STDOUT_OPTION,
d17 1
a17 1
@@@@ -222,6 +223,8 @@@@ static struct argp_option options[] = {
d26 3
a28 3
@@@@ -410,6 +413,10 @@@@ crc newc odc bin ustar tar (all-caps also recognized)"
 	error (PAXEXIT_FAILURE, 0, 
                _("--no-preserve-owner cannot be used with --owner"));
@


1.3.4.1
log
@CVE-2014-9112: Heap-based buffer overflow in the process_copy_in
function allows remote attackers to cause a denial of service via
a large block value in a cpio archive.
Fix from a series of upstream commits by Sergey Poznyakoff, via Debian.

CVE-2015-1197: cpio, when using the --no-absolute-filenames option,
allows local users to write to arbitrary files via a symlink attack
on a file in an archive.
Fix from Vitezslav Cizek after 3.5 years of gestation in the SUSE
bug tracker, via Debian.

Also apply an upstream fix for some regression tests while here.

ok sthen@@
@
text
@d1 1
a1 1
$OpenBSD: patch-src_main_c,v 1.3 2015/03/31 15:36:52 naddy Exp $
@


1.3.2.1
log
@CVE-2014-9112: Heap-based buffer overflow in the process_copy_in
function allows remote attackers to cause a denial of service via
a large block value in a cpio archive.
Fix from a series of upstream commits by Sergey Poznyakoff, via Debian.

CVE-2015-1197: cpio, when using the --no-absolute-filenames option,
allows local users to write to arbitrary files via a symlink attack
on a file in an archive.
Fix from Vitezslav Cizek after 3.5 years of gestation in the SUSE
bug tracker, via Debian.

Also apply an upstream fix for some regression tests while here.
@
text
@d1 1
a1 1
$OpenBSD: patch-src_main_c,v 1.3 2015/03/31 15:36:52 naddy Exp $
@


1.2
log
@Update to 2.7:
* Improved error checking and diagnostics
* Fixed CAN-1999-1572
* Allow to use --sparse in both copy-in and copy-pass.
* Fix bug that eventually caused copying out the same hard-linked file
several times to archive.

From: Rui Reis
@
text
@d1 14
a14 5
$OpenBSD: patch-src_main_c,v 1.1 2005/10/20 21:45:18 naddy Exp $
--- src/main.c.orig	Tue Nov 23 01:42:18 2004
+++ src/main.c	Thu Oct 20 21:57:59 2005
@@@@ -740,7 +740,6 @@@@ main (int argc, char *argv[])
   textdomain (PACKAGE);
d16 19
a34 12
   program_name = argv[0];
-  umask (0);
 
 #ifdef __TURBOC__
   _fmode = O_BINARY;		/* Put stdin and stdout in binary mode.  */
@@@@ -751,6 +750,7 @@@@ main (int argc, char *argv[])
 #endif
 
   process_args (argc, argv);
+  umask (0);
 
   initialize_buffers ();
d36 1
@


1.1
log
@Update to 2.6, which brings I18N support.
Also include Debian/Ubuntu patches for CAN-2005-1111 (chmod races) and
CAN-2005-1229 (path traversal).
@
text
@d1 1
a1 1
$OpenBSD$
@


1.1.6.1
log
@MFC:
Update to 2.7:
* Improved error checking and diagnostics
* Fixed CAN-1999-1572
* Allow to use --sparse in both copy-in and copy-pass.
* Fix bug that eventually caused copying out the same hard-linked file
several times to archive.
@
text
@d1 1
a1 1
$OpenBSD: patch-src_main_c,v 1.1 2005/10/20 21:45:18 naddy Exp $
@


1.1.4.1
log
@MFC:
Update to 2.7:
* Improved error checking and diagnostics
* Fixed CAN-1999-1572
* Allow to use --sparse in both copy-in and copy-pass.
* Fix bug that eventually caused copying out the same hard-linked file
several times to archive.
@
text
@d1 1
a1 1
$OpenBSD: patch-src_main_c,v 1.1 2005/10/20 21:45:18 naddy Exp $
@


1.1.2.1
log
@MFC:
* Improved error checking and diagnostics
* Fixed CAN-1999-1572
* Allow to use --sparse in both copy-in and copy-pass.
* Fix bug that eventually caused copying out the same hard-linked file
several times to archive.
@
text
@d1 1
a1 1
$OpenBSD: patch-src_main_c,v 1.1 2005/10/20 21:45:18 naddy Exp $
@


