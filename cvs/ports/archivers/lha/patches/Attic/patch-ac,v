head	1.3;
access;
symbols
	OPENBSD_3_0:1.2.0.10
	OPENBSD_3_0_BASE:1.2
	OPENBSD_2_9_TRACKING_SWITCH:1.2
	OPENBSD_2_9:1.2.0.8
	OPENBSD_2_9_BASE:1.2
	OPENBSD_2_8:1.2.0.6
	OPENBSD_2_8_BASE:1.2
	OPENBSD_2_7:1.2.0.4
	OPENBSD_2_7_BASE:1.2
	OPENBSD_2_6:1.2.0.2
	OPENBSD_2_6_BASE:1.2
	OPENBSD_2_5:1.1.0.6
	OPENBSD_2_5_BASE:1.1
	OPENBSD_2_4:1.1.0.4
	OPENBSD_2_4_BASE:1.1
	OPENBSD_2_3:1.1.0.2
	OPENBSD_2_3_BASE:1.1;
locks; strict;
comment	@# @;


1.3
date	2002.02.04.22.16.17;	author naddy;	state dead;
branches;
next	1.2;

1.2
date	99.09.04.22.28.42;	author brad;	state Exp;
branches;
next	1.1;

1.1
date	97.11.25.20.50.02;	author angelos;	state Exp;
branches;
next	;


desc
@@


1.3
log
@- Add build flags missing from previous update.
- Remove again extraneous documentation that is of no interest to
  users of the compiled package.
- Prune inappropriate verbiage from description.
- Disallow CDROM distribution according to old description.
- Rename patches.
- General clean-up.
@
text
@--- src/lhadd.c.orig	Sat Sep  4 18:10:14 1999
+++ src/lhadd.c	Sat Sep  4 18:14:30 1999
@@@@ -270,13 +270,35 @@@@
 {
 	int             old_umask;
 	FILE           *afp;
+	int		tempfd;
+
+  #ifdef TMP_FILENAME_TEMPLATE
+	  if (extract_directory == NULL) {
+		  strcpy(temporary_name, TMP_FILENAME_TEMPLATE);
+	  }
+	  else {
+		  sprintf(temporary_name, "%s/lhXXXXXX", extract_directory);
+	  }
+	  tempfd = mkstemp(temporary_name);
+  #else
+	  char		 *p, *s;
+
+	  strcpy(temporary_name, archive_name);
+	  for (p = temporary_name, s = (char *) 0; *p; p++)
+		  if (*p == '/')
+			  s = p;
+	  strcpy((s ? s + 1 : temporary_name), "lhXXXXXX");
+	  tempfd = mkstemp(temporary_name);
+  #endif
+	if (tempfd == -1)
+	  return NULL;
 
-	build_temporary_name();
 	signal(SIGINT, interrupt);
 	signal(SIGHUP, interrupt);
 
 	old_umask = umask(077);
-	afp = xfopen(temporary_name, WRITE_BINARY);
+	/*afp = xfopen(temporary_name, WRITE_BINARY);*/
+	afp = fdopen(tempfd, "w+");
 	remove_temporary_at_error = TRUE;
 	temporary_fp = afp;
 	umask(old_umask);
@


1.2
log
@upgrade to lha 1.14f
@
text
@@


1.1
log
@Oops, forgot to add before commit this one.
@
text
@d1 40
a40 53
*** src/lhadd.c.orig	Tue Nov 25 15:33:47 1997
--- src/lhadd.c	Tue Nov 25 15:29:32 1997
***************
*** 275,287 ****
  {
  	int             old_umask;
  	FILE           *afp;
  
! 	build_temporary_name();
  	signal(SIGINT, interrupt);
  	signal(SIGHUP, interrupt);
  
  	old_umask = umask(077);
! 	afp = xfopen(temporary_name, WRITE_BINARY);
  	remove_temporary_at_error = TRUE;
  	temporary_fp = afp;
  	umask(old_umask);
--- 275,309 ----
  {
  	int             old_umask;
  	FILE           *afp;
+ 	int 		tempfd;
  
! #ifdef TMP_FILENAME_TEMPLATE
!         if (extract_directory == NULL) {
!                 strcpy(temporary_name, TMP_FILENAME_TEMPLATE);
!         }
!         else {
!                 sprintf(temporary_name, "%s/lhXXXXXX", extract_directory);
!         }
!         tempfd = mkstemp(temporary_name);
! #else
!         char           *p, *s;
! 
!         strcpy(temporary_name, archive_name);
!         for (p = temporary_name, s = (char *) 0; *p; p++)
!                 if (*p == '/')
!                         s = p;
!         strcpy((s ? s + 1 : temporary_name), "lhXXXXXX");
!         tempfd = mkstemp(temporary_name);
! #endif
! 	if (tempfd == -1)
! 	  return NULL;
! 	
  	signal(SIGINT, interrupt);
  	signal(SIGHUP, interrupt);
  
  	old_umask = umask(077);
! 	/*afp = xfopen(temporary_name, WRITE_BINARY);*/
! 	afp = fdopen(tempfd, "w+");
  	remove_temporary_at_error = TRUE;
  	temporary_fp = afp;
  	umask(old_umask);
@

