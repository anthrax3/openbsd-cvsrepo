head	1.5;
access;
symbols
	OPENBSD_6_1:1.4.0.2
	OPENBSD_6_1_BASE:1.4
	OPENBSD_6_0:1.3.0.6
	OPENBSD_6_0_BASE:1.3
	OPENBSD_5_9:1.3.0.2
	OPENBSD_5_9_BASE:1.3
	OPENBSD_5_8:1.3.0.4
	OPENBSD_5_8_BASE:1.3
	OPENBSD_5_7:1.1.0.2
	OPENBSD_5_7_BASE:1.1;
locks; strict;
comment	@# @;


1.5
date	2017.06.27.01.35.20;	author sthen;	state Exp;
branches;
next	1.4;
commitid	9GbF4ACeofL09JTj;

1.4
date	2017.01.05.22.04.37;	author sthen;	state Exp;
branches;
next	1.3;
commitid	7FBqvH5sSBnMehNf;

1.3
date	2015.07.18.21.25.12;	author sthen;	state Exp;
branches;
next	1.2;
commitid	9D7LyIH9FumHzO8L;

1.2
date	2015.05.15.15.32.00;	author sthen;	state Exp;
branches;
next	1.1;
commitid	cqJZoFHsPJqITy0B;

1.1
date	2015.01.12.15.23.09;	author sthen;	state Exp;
branches;
next	;
commitid	jGGjrfFmu2QaQmon;


desc
@@


1.5
log
@update to lz4-1.7.5 + upstream patch for https://github.com/lz4/lz4/issues/369
which reads a byte from invalid memory, crashing tests on OpenBSD. Info at
https://github.com/lz4/lz4/commit/6ad3a983dbf3a25273e04051d29022c72c469cd5
@
text
@$OpenBSD: patch-lib_Makefile,v 1.4 2017/01/05 22:04:37 sthen Exp $
Index: lib/Makefile
--- lib/Makefile.orig
+++ lib/Makefile
@@@@ -83,8 +83,8 @@@@ all32: all
 liblz4.a: *.c
 ifeq ($(BUILD_STATIC),yes)
 	@@echo compiling static library
-	@@$(CC) $(CPPFLAGS) $(CFLAGS) -c $^
-	@@$(AR) rcs $@@ *.o
+	$(CC) $(CPPFLAGS) $(CFLAGS) -c $^
+	$(AR) rcs $@@ *.o
 endif
 
 $(LIBLZ4): *.c
@@@@ -93,10 +93,7 @@@@ ifneq (,$(filter Windows%,$(OS)))
 	@@$(CC) $(FLAGS) -DLZ4_DLL_EXPORT=1 -shared $^ -o dll\$@@.dll
 	dlltool -D dll\liblz4.dll -d dll\liblz4.def -l dll\liblz4.lib
 else
-	@@$(CC) $(FLAGS) -shared $^ -fPIC $(SONAME_FLAGS) -o $@@
-	@@echo creating versioned links
-	@@ln -sf $@@ liblz4.$(SHARED_EXT_MAJOR)
-	@@ln -sf $@@ liblz4.$(SHARED_EXT)
+	$(CC) $(FLAGS) -shared $^ -fPIC $(SONAME_FLAGS) -o $@@
 endif
 
 liblz4: $(LIBLZ4)
@


1.4
log
@update to lz4-1.7.4.2 (not 1.7.5 yet as it segfaults during tests)
@
text
@d1 5
a5 4
$OpenBSD: patch-lib_Makefile,v 1.3 2015/07/18 21:25:12 sthen Exp $
--- lib/Makefile.orig	Tue Nov 22 20:34:17 2016
+++ lib/Makefile	Tue Jan  3 21:49:02 2017
@@@@ -86,8 +86,8 @@@@ all32: all
d15 2
a16 2
 liblz4: *.c
@@@@ -96,10 +96,7 @@@@ ifneq (,$(filter Windows%,$(OS)))
d20 1
a20 1
-	@@$(CC) $(FLAGS) -shared $^ -fPIC $(SONAME_FLAGS) -o $@@.$(SHARED_EXT_VER)
d22 3
a24 3
-	@@ln -sf $@@.$(SHARED_EXT_VER) $@@.$(SHARED_EXT_MAJOR)
-	@@ln -sf $@@.$(SHARED_EXT_VER) $@@.$(SHARED_EXT)
+	$(CC) $(FLAGS) -shared $^ -fPIC $(SONAME_FLAGS) -o $@@.$(SHARED_EXT_VER)
d27 1
a27 10
 clean:
@@@@ -110,7 +107,7 @@@@ clean:
 #------------------------------------------------------------------------
 #make install is validated only for Linux, OSX, kFreeBSD, Hurd and
 #FreeBSD targets
-ifneq (,$(filter $(shell uname),Linux Darwin GNU/kFreeBSD GNU FreeBSD))
+ifneq (,$(filter $(shell uname),Linux Darwin GNU/kFreeBSD GNU FreeBSD OpenBSD))
 
 liblz4.pc: liblz4.pc.in Makefile
 	@@echo creating pkgconfig
@


1.3
log
@update to LZ4 r131
@
text
@d1 6
a6 6
$OpenBSD: patch-lib_Makefile,v 1.2 2015/05/15 15:32:00 sthen Exp $
--- lib/Makefile.orig	Mon Jun 29 03:48:37 2015
+++ lib/Makefile	Sat Jul 18 15:18:45 2015
@@@@ -66,13 +66,10 @@@@ all: liblz4
 
 liblz4: lz4.c lz4hc.c lz4frame.c xxhash.c
d9 1
a9 1
-	@@$(AR) rcs liblz4.a lz4.o lz4hc.o lz4frame.o xxhash.o
d11 9
a19 3
+	$(AR) rcs liblz4.a lz4.o lz4hc.o lz4frame.o xxhash.o
 	@@echo compiling dynamic library $(LIBVER)
-	@@$(CC) $(CPPFLAGS) $(CFLAGS) $(LDFLAGS) -shared $^ -fPIC $(SONAME_FLAGS) -o $@@.$(SHARED_EXT_VER)
d23 2
a24 1
+	$(CC) $(CPPFLAGS) $(CFLAGS) $(LDFLAGS) -shared $^ -fPIC $(SONAME_FLAGS) -o $@@.$(SHARED_EXT_VER)
d27 1
a27 3
 	@@rm -f core *.o *.a *.$(SHARED_EXT) *.$(SHARED_EXT).* liblz4.pc
@@@@ -81,7 +78,7 @@@@ clean:
 
d29 4
a32 3
 #make install is validated only for Linux, OSX, kFreeBSD and Hurd targets
-ifneq (,$(filter $(shell uname),Linux Darwin GNU/kFreeBSD GNU))
+ifneq (,$(filter $(shell uname),Linux Darwin GNU/kFreeBSD GNU OpenBSD))
a35 11
@@@@ -94,9 +91,7 @@@@ liblz4.pc: liblz4.pc.in Makefile
 install: liblz4 liblz4.pc
 	@@install -d -m 755 $(DESTDIR)$(LIBDIR)/pkgconfig/ $(DESTDIR)$(INCLUDEDIR)/
 	@@install -m 755 liblz4.$(SHARED_EXT_VER) $(DESTDIR)$(LIBDIR)/liblz4.$(SHARED_EXT_VER)
-	@@cp -a liblz4.$(SHARED_EXT_MAJOR) $(DESTDIR)$(LIBDIR)
-	@@cp -a liblz4.$(SHARED_EXT) $(DESTDIR)$(LIBDIR)
-	@@cp -a liblz4.pc $(DESTDIR)$(LIBDIR)/pkgconfig/
+	@@install -m 644 liblz4.pc $(DESTDIR)$(LIBDIR)/pkgconfig/
 	@@install -m 644 liblz4.a $(DESTDIR)$(LIBDIR)/liblz4.a
 	@@install -m 644 lz4.h $(DESTDIR)$(INCLUDEDIR)/lz4.h
 	@@install -m 644 lz4hc.h $(DESTDIR)$(INCLUDEDIR)/lz4hc.h
@


1.2
log
@update to lz4-r129
@
text
@d1 3
a3 3
$OpenBSD: patch-lib_Makefile,v 1.1 2015/01/12 15:23:09 sthen Exp $
--- lib/Makefile.orig	Thu May  7 12:23:39 2015
+++ lib/Makefile	Fri May 15 14:50:22 2015
d8 1
a8 1
-	@@$(CC) $(CPPFLAGS) $(CFLAGS) -fPIC -c $^
d10 1
a10 1
+	$(CC) $(CPPFLAGS) $(CFLAGS) -fPIC -c $^
@


1.1
log
@update to lz4 r127
@
text
@d1 4
a4 4
$OpenBSD$
--- lib/Makefile.orig	Fri Dec 19 08:51:32 2014
+++ lib/Makefile	Mon Jan 12 00:32:39 2015
@@@@ -67,13 +67,10 @@@@ all: liblz4
d8 1
a8 1
-	@@$(CC) $(CPPFLAGS) $(CFLAGS) -c $^
d10 1
a10 1
+	$(CC) $(CPPFLAGS) $(CFLAGS) -c $^
d21 1
a21 1
@@@@ -82,7 +79,7 @@@@ clean:
d30 1
a30 1
@@@@ -95,9 +92,7 @@@@ liblz4.pc: liblz4.pc.in Makefile
@

