head	1.3;
access;
symbols;
locks; strict;
comment	@# @;


1.3
date	2014.10.05.07.37.23;	author jasper;	state dead;
branches;
next	1.2;
commitid	9lHAzFhuIV1R67P3;

1.2
date	2014.09.26.08.24.19;	author jasper;	state Exp;
branches;
next	1.1;
commitid	1ZhVYuvhNus9cIwU;

1.1
date	2014.09.15.08.21.39;	author jasper;	state Exp;
branches;
next	;
commitid	R0aPENU1xetJ4l7s;


desc
@@


1.3
log
@- update to portroach-1.2.0
* many fixes and tweaks (sorting, scanning, cleanups), see: http://portroach.openbsd.org/
@
text
@$OpenBSD: patch-portroach_pl,v 1.2 2014/09/26 08:24:19 jasper Exp $
--- portroach.pl.orig	Sun Sep  7 14:54:20 2014
+++ portroach.pl	Fri Sep 26 10:23:41 2014
@@@@ -1421,7 +1421,7 @@@@ sub GenerateHTML
 	finish_sql($dbh, \%sths);
 	$dbh->disconnect;
 
-	if ($settings{output_json}) {
+	if ($settings{output_type} =~ /(json|dynamic)/) {
 	    open(my $fh, '>', "$settings{html_data_dir}/json/restricted.json") or die $!;
 	    print $fh JSON::encode_json(\@@results);
 	    close($fh);
@@@@ -1474,7 +1474,7 @@@@ sub MailMaintainers
 	while (my ($addr) = $sths{maildata_select}->fetchrow_array) {
 		my $msg;
 		my $ports = 0;
-		$sths{portdata_findnewnew}->execute($addr);
+		$sths{portdata_findnewnew}->execute("%<${addr}>%");
 		$template->applyglobal({maintainer => lc $addr});
 
 		while (my $port = $sths{portdata_findnewnew}->fetchrow_hashref) {
@


1.2
log
@apply patch from upstream to unbreak writing restricted.json
@
text
@d1 1
a1 1
$OpenBSD: patch-portroach_pl,v 1.1 2014/09/15 08:21:39 jasper Exp $
@


1.1
log
@backport fix from upstream git to unbreak sending mail
@
text
@d1 12
a12 3
$OpenBSD$
--- portroach.pl.orig	Mon Sep 15 10:20:00 2014
+++ portroach.pl	Mon Sep 15 10:20:02 2014
@

