head	1.4;
access;
symbols
	OPENBSD_6_0:1.4.0.4
	OPENBSD_6_0_BASE:1.4
	OPENBSD_5_9:1.4.0.2
	OPENBSD_5_9_BASE:1.4
	OPENBSD_5_8:1.3.0.4
	OPENBSD_5_7:1.3.0.2
	OPENBSD_3_3:1.1.0.4
	OPENBSD_3_4:1.1.0.2;
locks; strict;
comment	@# @;


1.4
date	2015.09.11.14.04.59;	author jasper;	state Exp;
branches;
next	1.3;
commitid	wUf5CJdIcTDSWayH;

1.3
date	2015.09.01.12.05.19;	author jasper;	state Exp;
branches
	1.3.2.1
	1.3.4.1;
next	1.2;
commitid	bRvUglty6rVy0UXr;

1.2
date	2004.01.17.05.34.28;	author brad;	state dead;
branches;
next	1.1;

1.1
date	2003.12.04.23.27.07;	author margarida;	state Exp;
branches
	1.1.2.1
	1.1.4.1;
next	;

1.1.2.1
date	2003.12.04.23.47.11;	author margarida;	state Exp;
branches;
next	;

1.1.4.1
date	2003.12.13.04.08.50;	author margarida;	state Exp;
branches;
next	;

1.3.2.1
date	2015.09.01.12.07.08;	author jasper;	state Exp;
branches;
next	;
commitid	lky2dtk5590tavn6;

1.3.4.1
date	2015.09.01.12.07.39;	author jasper;	state Exp;
branches;
next	;
commitid	yOgR1IKeawHeNA55;


desc
@@


1.4
log
@add CVE number
@
text
@$OpenBSD: patch-ansi_c,v 1.3 2015/09/01 12:05:19 jasper Exp $

Security fix for CVE-2015-6806,
screen: Stack overflow due to deep recursion causing process freeze

--- ansi.c.orig	Fri Dec  5 14:57:05 2003
+++ ansi.c	Tue Sep  1 14:03:33 2015
@@@@ -2425,13 +2425,13 @@@@ int n, ys, ye, bce;
     return;
   if (n > 0)
     {
+      if (ye - ys + 1 < n)
+	n = ye - ys + 1;
       if (n > 256)
 	{
 	  MScrollV(p, n - 256, ys, ye, bce);
 	  n = 256;
 	}
-      if (ye - ys + 1 < n)
-	n = ye - ys + 1;
 #ifdef COPY_PASTE
       if (compacthist)
 	{
@@@@ -2482,14 +2482,14 @@@@ int n, ys, ye, bce;
     }
   else
     {
-      if (n < -256)
-	{
-	  MScrollV(p, n + 256, ys, ye, bce);
-	  n = -256;
-	}
       n = -n;
       if (ye - ys + 1 < n)
 	n = ye - ys + 1;
+      if (n > 256)
+	{
+	  MScrollV(p, - (n - 256), ys, ye, bce);
+	  n = 256;
+	}
 
       ml = p->w_mlines + ye;
       /* Clear lines */
@


1.3
log
@Fix stack overflow due to too deep recursion; from upstream
@
text
@d1 1
a1 1
$OpenBSD$
d3 2
a4 2
http://seclists.org/oss-sec/2015/q3/462
http://git.savannah.gnu.org/cgit/screen.git/commit/?h=screen-v4&id=b7484c224738247b510ed0d268cd577076958f1b
@


1.3.4.1
log
@Fix stack overflow due to too deep recursion; from upstream
@
text
@d1 1
a1 1
$OpenBSD: patch-ansi_c,v 1.3 2015/09/01 12:05:19 jasper Exp $
@


1.3.2.1
log
@Fix stack overflow due to too deep recursion; from upstream
@
text
@d1 1
a1 1
$OpenBSD: patch-ansi_c,v 1.3 2015/09/01 12:05:19 jasper Exp $
@


1.2
log
@upgrade to screen 4.0.2
@
text
@d1 43
a43 12
$OpenBSD: patch-ansi_c,v 1.1 2003/12/04 23:27:07 margarida Exp $
--- ansi.c.orig	2003-11-28 00:27:43.000000000 +0000
+++ ansi.c	2003-11-28 00:28:29.000000000 +0000
@@@@ -559,7 +559,7 @@@@ register int len;
 	    {
 	    case '0': case '1': case '2': case '3': case '4':
 	    case '5': case '6': case '7': case '8': case '9':
-	      if (curr->w_NumArgs < MAXARGS)
+	      if (curr->w_NumArgs >= 0 && curr->w_NumArgs < MAXARGS)
 		{
 		  if (curr->w_args[curr->w_NumArgs] < 100000000)
 		    curr->w_args[curr->w_NumArgs] =
@


1.1
log
@Reliability fix:
Buffer overflow in GNU screen allows privilege escalation for local users.
It also has some potential for attackers getting control of another user's
screen.  Transfer of approximately two gigabytes of data is required to
exploit this vulnerability.
Usually screen is installed either setgid-utmp or setuid-root but this DOES
NOT happen on OpenBSD, thus the reliability fix.

ok brad@@
@
text
@d1 1
a1 1
$OpenBSD$
@


1.1.4.1
log
@Reliability fix MFC:
Buffer overflow in GNU screen allows privilege escalation for local users.
It also has some potential for attackers getting control of another user's
screen.  Transfer of approximately two gigabytes of data is required to
exploit this vulnerability.
Usually screen is installed either setgid-utmp or setuid-root but this DOES
NOT happen on OpenBSD, thus the reliability fix.
@
text
@d2 3
a4 3
--- ansi.c.orig	Mon Aug 19 11:25:31 2002
+++ ansi.c	Sat Dec 13 03:59:57 2003
@@@@ -581,7 +581,7 @@@@ register int len;
@


1.1.2.1
log
@Reliability fix MFC:
Buffer overflow in GNU screen allows privilege escalation for local users.
It also has some potential for attackers getting control of another user's
screen.  Transfer of approximately two gigabytes of data is required to
exploit this vulnerability.
Usually screen is installed either setgid-utmp or setuid-root but this DOES
NOT happen on OpenBSD, thus the reliability fix.

ok brad@@ pvalchev@@
@
text
@@

