head	1.2;
access;
symbols
	OPENBSD_5_5:1.1.0.36
	OPENBSD_5_5_BASE:1.1
	OPENBSD_5_4:1.1.0.34
	OPENBSD_5_4_BASE:1.1
	OPENBSD_5_3:1.1.0.32
	OPENBSD_5_3_BASE:1.1
	OPENBSD_5_2:1.1.0.30
	OPENBSD_5_2_BASE:1.1
	OPENBSD_5_1_BASE:1.1
	OPENBSD_5_1:1.1.0.28
	OPENBSD_5_0:1.1.0.26
	OPENBSD_5_0_BASE:1.1
	OPENBSD_4_9:1.1.0.24
	OPENBSD_4_9_BASE:1.1
	OPENBSD_4_8:1.1.0.22
	OPENBSD_4_8_BASE:1.1
	OPENBSD_4_7:1.1.0.20
	OPENBSD_4_7_BASE:1.1
	OPENBSD_4_6:1.1.0.18
	OPENBSD_4_6_BASE:1.1
	OPENBSD_4_5:1.1.0.16
	OPENBSD_4_5_BASE:1.1
	OPENBSD_4_4:1.1.0.14
	OPENBSD_4_4_BASE:1.1
	OPENBSD_4_3:1.1.0.12
	OPENBSD_4_3_BASE:1.1
	OPENBSD_4_2:1.1.0.10
	OPENBSD_4_2_BASE:1.1
	OPENBSD_4_1:1.1.0.8
	OPENBSD_4_1_BASE:1.1
	OPENBSD_4_0:1.1.0.6
	OPENBSD_4_0_BASE:1.1
	OPENBSD_3_9:1.1.0.4
	OPENBSD_3_9_BASE:1.1
	OPENBSD_3_8:1.1.0.2
	OPENBSD_3_8_BASE:1.1;
locks; strict;
comment	@# @;


1.2
date	2014.07.11.17.02.56;	author ajacoutot;	state dead;
branches;
next	1.1;
commitid	HKumgKgP0iHnd1Zj;

1.1
date	2005.05.31.09.09.30;	author db;	state Exp;
branches;
next	;


desc
@@


1.2
log
@Remove, I doubt anyone can prove what we currently have actually works.

ok sthen@@
@
text
@#!/bin/sh
#
# $OpenBSD: gpgzip,v 1.1 2005/05/31 09:09:30 db Exp $
#
# AMANDA gzip wrapper for GPG encrypted backups
# modified version from jaf@@uchicago.edu

# enable for debugging
#set -x

# Set default configuration variables and locations for binaries
config="@@SYSCONFDIR@@/amanda/amanda.gpg.conf"
debug_bin="/usr/bin/logger"

gzip_bin="/usr/bin/gzip"
gzip_flags="$@@"

gpg_bin="@@LOCALBASE@@/bin/gpg"
gpg_encrypt_flags="--no-tty --batch --no-secmem-warning --no-verbose -e"
gpg_decrypt_flags="--no-verbose --no-greeting --no-secmem-warning \
		   --no-tty --batch -d"


# Encrypt the data stream and feed it to gzip for final compression.
# NOTE: gpg will compress the data by default with the first supported
# algorithm found in the recipient key settings, defaults to zlib, ZIP.
# Encrypting the files first is suboptimal for further compression, but
# otherwise gpg will complain about tapered data when restoring with
# the AMANDA utilities.
dump() {
    ${gpg_bin} --homedir=${gpg_home} -r ${gpg_id} \
        ${gpg_encrypt_flags} | \
        ${gzip_bin} ${gzip_flags} >&1
}

# Unzip and decrypt the data stream
restore() {
    ${gzip_bin} ${gzip_flags} | \
	${gpg_bin} ${gpg_decrypt_flags} --homedir=${gpg_home} \
	-r ${gpg_id} >&1
}


# Sane environment?
if [ ! -f ${config} ]; then
    ${debug_bin} "Configuration file ${config} not found."
    exit 1
else
    . ${config}
    if [ "$gpg_id" = "" ]; then
	${debug_bin} "ERROR: gpg_id variable not set in ${config}."
	exit 1
    elif [ "$gpg_home" = "" ]; then
	${debug_bin} "ERROR: gpg_home variable not set in ${config}."
	exit 1
    fi
fi

# Called with -dc as argument for restore. Checking for d will suffice.
while getopts "d" arg
do
	case $arg in
	    d)  
	    	restore
		break
		;;
	    *)
	    	dump
		break
		;;
	esac
done

exit 0
@


1.1
log
@update to version 2.4.5; add db flavor for large AMANDA databases;
add gpg flavor for encrypted backups; move documentation to multipackage

ok sturm@@, maintainer
@
text
@d3 1
a3 1
# $OpenBSD$
@

