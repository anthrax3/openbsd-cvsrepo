head	1.4;
access;
symbols
	OPENBSD_5_6:1.3.0.8
	OPENBSD_5_6_BASE:1.3
	OPENBSD_5_5:1.3.0.6
	OPENBSD_5_5_BASE:1.3
	OPENBSD_5_4:1.3.0.4
	OPENBSD_5_4_BASE:1.3
	OPENBSD_5_3:1.3.0.2
	OPENBSD_5_3_BASE:1.3
	OPENBSD_4_5:1.1.0.10
	OPENBSD_4_5_BASE:1.1
	OPENBSD_4_4:1.1.0.8
	OPENBSD_4_4_BASE:1.1
	OPENBSD_4_3:1.1.0.6
	OPENBSD_4_3_BASE:1.1
	OPENBSD_4_2:1.1.0.4
	OPENBSD_4_2_BASE:1.1
	OPENBSD_4_1:1.1.0.2
	OPENBSD_4_1_BASE:1.1;
locks; strict;
comment	@# @;


1.4
date	2014.08.25.15.20.19;	author chrisz;	state dead;
branches;
next	1.3;
commitid	6BvEz6ub6gqZgyTj;

1.3
date	2013.01.03.14.30.57;	author chrisz;	state Exp;
branches;
next	1.2;

1.2
date	2009.03.11.21.31.39;	author avsm;	state dead;
branches;
next	1.1;

1.1
date	2006.12.26.23.09.32;	author avsm;	state Exp;
branches;
next	;


desc
@@


1.4
log
@Upgrade findlib to 1.5.2.
 * Don't use MODULES = lang/ocaml, because with 4.02 we will
   need to build findlib without camlp4, which will depend
   on findlib.
 * Remove patches accepted upstream.
 * Add one patch from upstream to fix building without
   ocamlfind in path yet and respecting PREFIX.

OK avsm@@
@
text
@$OpenBSD: patch-configure,v 1.3 2013/01/03 14:30:57 chrisz Exp $
--- configure.orig	Mon Jul  9 11:29:16 2012
+++ configure	Mon Dec 31 13:43:10 2012
@@@@ -116,6 +116,7 @@@@ ocaml_sitelib=""
 ocamlfind_config=""
 with_toolbox=0
 with_topfind=1
+custom=-custom
 system=""
 
 while [ "$#" != "0" ]; do
@@@@ -132,6 +133,9 @@@@ while [ "$#" != "0" ]; do
         -config) ocamlfind_config=$2
 	         shift 2
 		 ;;
+        -no-custom) custom=
+	         shift
+		 ;;
 	-cygpath) system=mingw
 	         shift
 		 ;;
@@@@ -153,6 +157,7 @@@@ while [ "$#" != "0" ]; do
 		  echo "  -mandir path         where manual pages are installed" 1>&2
 		  echo "  -sitelib path        set the location of the site-specific packages" 1>&2
                   echo "  -config path         set the location of the configuration file" 1>&2
+		  echo "  -no-custom           don't link in custom runtime mode" 1>&2
 		  echo "  -system <systype>    override system type (esp. mingw and win32)" 1>&2
 		  echo "  -with-toolbox        also build the toolbox" 1>&2
 		  echo "  -no-topfind          don't install topfind script into stdlib directory" 1>&2
@@@@ -536,6 +541,7 @@@@ echo "OCAMLFIND_CONF=${ocamlfind_config}" >>Makefile.c
 echo "OCAML_AUTOLINK=${ocaml_autolink}" >>Makefile.config
 echo "OCAML_REMOVE_DIRECTORY=${have_remdir}" >>Makefile.config
 echo "EXEC_SUFFIX=${exec_suffix}" >>Makefile.config
+echo "CUSTOM=${custom}" >>Makefile.config
 echo "PARTS=${parts}" >>Makefile.config
 echo "INSTALL_TOPFIND=${with_topfind}" >>Makefile.config
 echo "USE_CYGPATH=${use_cygpath}" >>Makefile.config
@@@@ -572,6 +578,12 @@@@ if [ $with_toolbox -gt 0 ]; then
     echo "Toolbox:                   yes"
 else
     echo "Toolbox:                   no"
+fi
+
+if [ -z "$custom" ]; then
+    echo "Link custom runtime:       no"
+else
+    echo "Link custom runtime:       yes"
 fi
 
 echo
@


1.3
log
@- on bytecode-archs build executable without custom runtime
- use /etc/findlib.conf instead of /usr/local/share/examples/findlib.conf.
- add commented out option to enable ocamldoc.opt by default to findlib.conf

OK jasper@@, anil@@ (maintainer)
@
text
@d1 1
a1 1
$OpenBSD$
@


1.2
log
@update to findlib-1.2.4
@
text
@d1 9
a9 6
$OpenBSD: patch-configure,v 1.1 2006/12/26 23:09:32 avsm Exp $
--- configure.orig	Tue Dec 26 21:59:27 2006
+++ configure	Tue Dec 26 22:00:00 2006
@@@@ -264,25 +264,8 @@@@ fi
 ######################################################################
 # Test the threading model
d11 38
a48 21
-echo "Testing threading model..."
-
-if ocamlc -vmthread >/dev/null 2>/dev/null; then
-    :
-else
-    echo "The -vmthread switch is not supported: Your ocaml version is too old!"
-    exit 1
-fi
-
-rm -f itest-aux/simple
-ocamlc -w a -custom -thread -o itest-aux/simple unix.cma threads.cma itest-aux/simple_threads.ml \
-    >itest-aux/err.out 2>&1
-output=`cat itest-aux/err.out`
-
-if [ -z "$output" ]; then
-    ocaml_threads="posix"
-else
-    ocaml_threads="vm"
-fi
+echo "Setting threading model to posix..."
+ocaml_threads="posix"
d50 1
a50 2
 ######################################################################
 # Does this version of OCaml support autolinking?
@


1.1
log
@Fix findlib to correctly detect posix threading instead of vm threads for
ocaml apps compiled using it.

Issue was that the configure script which tried threads gets confused by
the spurious OpenBSD linker warnings about sprintf and falls back to VM
threads.

Bump PKGNAME, and trim an unneeded line from PLIST while here.

Reported by Adam Montague <amontague@@siriushosting.com> and
Ivan M Makarenko <I.Makarenko@@zsttk.ru>.
@
text
@d1 1
a1 1
$OpenBSD$
@

