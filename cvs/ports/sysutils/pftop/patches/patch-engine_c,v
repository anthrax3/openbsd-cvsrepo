head	1.2;
access;
symbols
	OPENBSD_6_1:1.2.0.6
	OPENBSD_6_1_BASE:1.2
	OPENBSD_6_0:1.2.0.4
	OPENBSD_6_0_BASE:1.2
	OPENBSD_5_9:1.2.0.2
	OPENBSD_5_9_BASE:1.2
	OPENBSD_5_8:1.1.0.32
	OPENBSD_5_8_BASE:1.1
	OPENBSD_5_7:1.1.0.28
	OPENBSD_5_7_BASE:1.1
	OPENBSD_5_6:1.1.0.26
	OPENBSD_5_6_BASE:1.1
	OPENBSD_5_5:1.1.0.24
	OPENBSD_5_5_BASE:1.1
	OPENBSD_5_4:1.1.0.22
	OPENBSD_5_4_BASE:1.1
	OPENBSD_5_3:1.1.0.20
	OPENBSD_5_3_BASE:1.1
	OPENBSD_5_2:1.1.0.18
	OPENBSD_5_2_BASE:1.1
	OPENBSD_5_1_BASE:1.1
	OPENBSD_5_1:1.1.0.16
	OPENBSD_5_0:1.1.0.14
	OPENBSD_5_0_BASE:1.1
	OPENBSD_4_9:1.1.0.12
	OPENBSD_4_9_BASE:1.1
	OPENBSD_4_8:1.1.0.10
	OPENBSD_4_8_BASE:1.1
	OPENBSD_4_7:1.1.0.8
	OPENBSD_4_7_BASE:1.1
	OPENBSD_4_6:1.1.0.6
	OPENBSD_4_6_BASE:1.1
	OPENBSD_4_5:1.1.0.4
	OPENBSD_4_5_BASE:1.1
	OPENBSD_4_4:1.1.0.2
	OPENBSD_4_4_BASE:1.1;
locks; strict;
comment	@# @;


1.2
date	2015.11.21.01.51.50;	author sthen;	state Exp;
branches;
next	1.1;
commitid	Ezs9vfk9sDf6037u;

1.1
date	2008.06.13.00.38.12;	author canacar;	state Exp;
branches;
next	;


desc
@@


1.2
log
@don't use CIRCLEQ
@
text
@$OpenBSD: patch-engine_c,v 1.1 2008/06/13 00:38:12 canacar Exp $
--- engine.c.orig	Wed Nov  7 06:35:44 2007
+++ engine.c	Sat Nov 21 01:51:04 2015
@@@@ -34,11 +34,11 @@@@
 #endif
 
 /* circular linked list of views */
-CIRCLEQ_HEAD(view_list, view_ent) view_head =
-				  CIRCLEQ_HEAD_INITIALIZER(view_head);
+TAILQ_HEAD(view_list, view_ent) view_head =
+				  TAILQ_HEAD_INITIALIZER(view_head);
 struct view_ent {
 	field_view *view;
-	CIRCLEQ_ENTRY(view_ent) entries;
+	TAILQ_ENTRY(view_ent) entries;
 };
 
 int delay = 5;
@@@@ -510,7 +510,7 @@@@ add_view(field_view *fv)
 		return;
 
 	ent->view = fv;
-	CIRCLEQ_INSERT_TAIL(&view_head, ent, entries);
+	TAILQ_INSERT_TAIL(&view_head, ent, entries);
 
 	if (curr_view == NULL)
 		set_curr_view(ent);
@@@@ -526,7 +526,7 @@@@ set_view(char *opt)
 	if (opt == NULL || (len = strlen(opt)) == 0)
 		return 1;
 
-	CIRCLEQ_FOREACH(ve, &view_head, entries) {
+	TAILQ_FOREACH(ve, &view_head, entries) {
 		v = ve->view;
 		if (strncasecmp(opt, v->name, len) == 0) {
 			if (vm)
@@@@ -548,7 +548,7 @@@@ foreach_view(void (*callback)(field_view *))
 {
 	struct view_ent *ve;
 
-	CIRCLEQ_FOREACH(ve, &view_head, entries) {
+	TAILQ_FOREACH(ve, &view_head, entries) {
 		callback(ve->view);
 	}
 }
@@@@ -560,7 +560,7 @@@@ set_view_hotkey(int ch)
 	field_view *v;
 	int key = tolower(ch);
 
-	CIRCLEQ_FOREACH(ve, &view_head, entries) {
+	TAILQ_FOREACH(ve, &view_head, entries) {
 		v = ve->view;
 		if (key == v->hotkey) {
 			set_curr_view(ve);
@@@@ -576,12 +576,12 @@@@ next_view(void)
 {
 	struct view_ent *ve;
 
-	if (CIRCLEQ_EMPTY(&view_head) || curr_view_ent == NULL)
+	if (TAILQ_EMPTY(&view_head) || curr_view_ent == NULL)
 		return;
 
-	ve = CIRCLEQ_NEXT(curr_view_ent, entries);
-	if (ve == CIRCLEQ_END(&view_head))
-		ve = CIRCLEQ_FIRST(&view_head);
+	ve = TAILQ_NEXT(curr_view_ent, entries);
+	if (ve == NULL)
+		ve = TAILQ_FIRST(&view_head);
 
 	set_curr_view(ve);
 }
@@@@ -591,12 +591,12 @@@@ prev_view(void)
 {
 	struct view_ent *ve;
 
-	if (CIRCLEQ_EMPTY(&view_head) || curr_view_ent == NULL)
+	if (TAILQ_EMPTY(&view_head) || curr_view_ent == NULL)
 		return;
 
-	ve = CIRCLEQ_PREV(curr_view_ent, entries);
-	if (ve == CIRCLEQ_END(&view_head))
-		ve = CIRCLEQ_LAST(&view_head);
+	ve = TAILQ_PREV(curr_view_ent, view_list, entries);
+	if (ve == NULL)
+		ve = TAILQ_LAST(&view_head, view_list);
 
 	set_curr_view(ve);
 }
@@@@ -808,6 +808,9 @@@@ void
 next_order(void)
 {
 	order_type *o, *oc;
+
+	if (curr_view->mgr->order_list == NULL)
+		return;
 
 	oc = curr_view->mgr->order_curr;
 
@


1.1
log
@Make pftop build again after the lates pf changes. Filtering against
'gateway' addres/ports does not work (yet) due to the address handling
changes in pf. Other functionality should work. Also fixes two minor
bugs reported by many.  Suggestions and ok naddy@@
@
text
@d1 90
a90 4
$OpenBSD$
--- engine.c.orig	Tue Nov  6 23:35:44 2007
+++ engine.c	Thu Jun 12 17:49:32 2008
@@@@ -809,6 +809,9 @@@@ next_order(void)
d93 1
a93 1
 
d96 1
a96 1
+
a98 1
 	for (o = curr_view->mgr->order_list; o->name != NULL; o++) {
@

