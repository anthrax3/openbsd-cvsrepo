head	1.2;
access;
symbols
	OPENBSD_6_0:1.2.0.8
	OPENBSD_6_0_BASE:1.2
	OPENBSD_5_9:1.2.0.4
	OPENBSD_5_9_BASE:1.2
	OPENBSD_5_8:1.2.0.6
	OPENBSD_5_8_BASE:1.2
	OPENBSD_5_7:1.2.0.2
	OPENBSD_5_7_BASE:1.2
	OPENBSD_5_6:1.1.1.1.0.40
	OPENBSD_5_6_BASE:1.1.1.1
	OPENBSD_5_5:1.1.1.1.0.38
	OPENBSD_5_5_BASE:1.1.1.1
	OPENBSD_5_4:1.1.1.1.0.36
	OPENBSD_5_4_BASE:1.1.1.1
	OPENBSD_5_3:1.1.1.1.0.34
	OPENBSD_5_3_BASE:1.1.1.1
	OPENBSD_5_2:1.1.1.1.0.32
	OPENBSD_5_2_BASE:1.1.1.1
	OPENBSD_5_1_BASE:1.1.1.1
	OPENBSD_5_1:1.1.1.1.0.30
	OPENBSD_5_0:1.1.1.1.0.28
	OPENBSD_5_0_BASE:1.1.1.1
	OPENBSD_4_9:1.1.1.1.0.26
	OPENBSD_4_9_BASE:1.1.1.1
	OPENBSD_4_8:1.1.1.1.0.24
	OPENBSD_4_8_BASE:1.1.1.1
	OPENBSD_4_7:1.1.1.1.0.22
	OPENBSD_4_7_BASE:1.1.1.1
	OPENBSD_4_6:1.1.1.1.0.20
	OPENBSD_4_6_BASE:1.1.1.1
	OPENBSD_4_5:1.1.1.1.0.18
	OPENBSD_4_5_BASE:1.1.1.1
	OPENBSD_4_4:1.1.1.1.0.16
	OPENBSD_4_4_BASE:1.1.1.1
	OPENBSD_4_3:1.1.1.1.0.14
	OPENBSD_4_3_BASE:1.1.1.1
	OPENBSD_4_2:1.1.1.1.0.12
	OPENBSD_4_2_BASE:1.1.1.1
	OPENBSD_4_1:1.1.1.1.0.10
	OPENBSD_4_1_BASE:1.1.1.1
	OPENBSD_4_0:1.1.1.1.0.8
	OPENBSD_4_0_BASE:1.1.1.1
	OPENBSD_3_9:1.1.1.1.0.6
	OPENBSD_3_9_BASE:1.1.1.1
	OPENBSD_3_8:1.1.1.1.0.4
	OPENBSD_3_8_BASE:1.1.1.1
	OPENBSD_3_7:1.1.1.1.0.2
	OPENBSD_3_7_BASE:1.1.1.1
	alek_20041225:1.1.1.1
	alek:1.1.1;
locks; strict;
comment	@# @;


1.2
date	2014.09.16.18.57.32;	author espie;	state Exp;
branches;
next	1.1;
commitid	piKd8DvjRCWe9D6S;

1.1
date	2004.12.25.10.34.14;	author alek;	state Exp;
branches
	1.1.1.1;
next	;

1.1.1.1
date	2004.12.25.10.34.14;	author alek;	state Exp;
branches;
next	;


desc
@@


1.2
log
@byebye dkstats.h, you were not needed
@
text
@$OpenBSD: patch-hot-babe_c,v 1.1.1.1 2004/12/25 10:34:14 alek Exp $
--- hot-babe.c.orig	Sun Dec  5 15:59:38 2004
+++ hot-babe.c	Tue Sep 16 12:56:16 2014
@@@@ -19,6 +19,13 @@@@
 #include <unistd.h>
 #include <stdlib.h>
 #include <string.h>
+#ifdef __OpenBSD__
+#include <sys/param.h>
+#include <sys/sched.h>
+#include <sys/sysctl.h>
+#include <fcntl.h>
+#include <nlist.h>
+#endif
 #ifdef __FreeBSD__
 #include <sys/time.h>
 #include <sys/resource.h>
@@@@ -99,6 +106,13 @@@@ static int system_cpu(void)
   long cp_time[CPUSTATES];
   size_t len = sizeof(cp_time);
 #endif
+#ifdef __OpenBSD__
+  long load, total, oload, ototal;
+  long ab, ac, ad, ae, af;
+  long cp_time[CPUSTATES];
+  size_t len = sizeof(cp_time);
+  static int mib[] = { CTL_KERN, KERN_CPTIME };
+#endif
 
 #ifdef __linux__
   stat = fopen("/proc/stat", "r");
@@@@ -114,6 +128,16 @@@@ static int system_cpu(void)
   ad = cp_time[CP_SYS];
   ae = cp_time[CP_IDLE];
 #endif
+#ifdef __OpenBSD__
+  if (sysctl(mib, 2, &cp_time, &len, NULL, 0) < 0) {
+          (void)fprintf(stderr, "Cannot get kern.cp_time");
+  }
+  ab = cp_time[CP_USER];
+  ac = cp_time[CP_NICE];
+  ad = cp_time[CP_SYS];
+  ae = cp_time[CP_IDLE];
+  af = cp_time[CP_INTR];
+#endif
 
 
   /* Find out the CPU load */
@@@@ -122,6 +146,10 @@@@ static int system_cpu(void)
   load = ab + ad;  /* cpu.user + cpu.sys; */
   if(!bm.noNice) load += ac;
   total = ab + ac + ad + ae;  /* cpu.total; */
+#ifdef __OpenBSD__
+  load += af;
+  total += af;
+#endif
 
   i = bm.loadIndex;
   oload = bm.load[i];
@


1.1
log
@Initial revision
@
text
@d1 4
a4 4
$OpenBSD$
--- hot-babe.c.orig	Thu Dec 16 18:38:18 2004
+++ hot-babe.c	Thu Dec 16 18:42:12 2004
@@@@ -19,6 +19,14 @@@@
a11 1
+#include <sys/dkstat.h>
d18 1
a18 1
@@@@ -99,6 +107,13 @@@@ static int system_cpu(void)
d32 1
a32 1
@@@@ -114,6 +129,16 @@@@ static int system_cpu(void)
d49 1
a49 1
@@@@ -122,6 +147,10 @@@@ static int system_cpu(void)
@


1.1.1.1
log
@Import hot-babe 0.2.2

Hot-babe is a small graphical utility which displays the system activity
in a very special way.

From Jan Lindblom <cl0wn@@ludd.ltu.se>

help and ok xsa@@, mbalmer@@
@
text
@@
