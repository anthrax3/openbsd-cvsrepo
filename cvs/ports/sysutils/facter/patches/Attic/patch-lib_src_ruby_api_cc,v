head	1.6;
access;
symbols
	OPENBSD_5_9:1.5.0.2
	OPENBSD_5_9_BASE:1.5
	OPENBSD_5_8:1.5.0.4
	OPENBSD_5_8_BASE:1.5
	jasper_20150107:1.1.1.1
	jasper:1.1.1;
locks; strict;
comment	@# @;


1.6
date	2016.05.30.15.07.58;	author jasper;	state dead;
branches;
next	1.5;
commitid	mTPWHYxdzRBIjhfj;

1.5
date	2015.07.23.08.06.28;	author jasper;	state Exp;
branches;
next	1.4;
commitid	5WgcQJui5MfB8tna;

1.4
date	2015.07.16.16.31.52;	author jasper;	state Exp;
branches;
next	1.3;
commitid	Dsbyl0esZMg20fcn;

1.3
date	2015.07.16.15.52.01;	author jasper;	state Exp;
branches;
next	1.2;
commitid	ybsAzjC4ZEAT81AO;

1.2
date	2015.07.16.04.45.18;	author jasper;	state dead;
branches;
next	1.1;
commitid	ZHqhrZmdj0dmACZK;

1.1
date	2015.07.01.09.13.33;	author jasper;	state Exp;
branches
	1.1.1.1;
next	;
commitid	AzuxiPcee4dP8LWS;

1.1.1.1
date	2015.07.01.09.13.33;	author jasper;	state Exp;
branches;
next	;
commitid	AzuxiPcee4dP8LWS;


desc
@@


1.6
log
@long overdue update to facter-3.1.7; all our patches have been merged upstream
however some new patches are needed to deal with the split-off leatherman lib.
@
text
@$OpenBSD: patch-lib_src_ruby_api_cc,v 1.5 2015/07/23 08:06:28 jasper Exp $

- Initialize the ruby loadpath so that rbconfig.rb gets loaded.
  https://github.com/puppetlabs/facter/pull/1059

--- lib/src/ruby/api.cc.orig	Tue Jul 21 11:31:28 2015
+++ lib/src/ruby/api.cc	Thu Jul 23 01:25:11 2015
@@@@ -96,6 +96,7 @@@@ namespace facter { namespace ruby {
         LOAD_SYMBOL(ruby_init),
         LOAD_SYMBOL(ruby_options),
         LOAD_SYMBOL(ruby_cleanup),
+        LOAD_SYMBOL(ruby_init_loadpath),
         _library(move(library))
     {
     }
@@@@ -155,6 +156,8 @@@@ namespace facter { namespace ruby {
         } else {
             ruby_init();
         }
+
+        ruby_init_loadpath();
 
         LOG_INFO("using ruby version %1% to resolve custom facts.", to_string(rb_const_get(*rb_cObject, rb_intern("RUBY_VERSION"))));
 
@


1.5
log
@- update to facter-3.0.2
@
text
@d1 1
a1 1
$OpenBSD: patch-lib_src_ruby_api_cc,v 1.4 2015/07/16 16:31:52 jasper Exp $
@


1.4
log
@submitted upstream
@
text
@d1 1
a1 1
$OpenBSD: patch-lib_src_ruby_api_cc,v 1.3 2015/07/16 15:52:01 jasper Exp $
d6 3
a8 3
--- lib/src/ruby/api.cc.orig	Thu Jun 25 17:47:38 2015
+++ lib/src/ruby/api.cc	Thu Jul 16 09:46:32 2015
@@@@ -98,6 +98,7 @@@@ namespace facter { namespace ruby {
d16 1
a16 1
@@@@ -157,6 +158,8 @@@@ namespace facter { namespace ruby {
@


1.3
log
@when loading the ruby library it was only doing ruby_init(), but it didn't
setup the load path at all. this caused it to fail loading 'rbconfig'.

with jeremy@@
@
text
@d1 1
a1 1
$OpenBSD$
d3 2
a4 1
Initialize the ruby loadpath ($:) so that rbconfig.rb gets loaded.
@


1.2
log
@pass the location of libruby at configure time, since we define the version
of ruby that'll be used anyway. drop a patch that did the dynamic lookup accordingly
@
text
@d1 17
a17 4
$OpenBSD: patch-lib_src_ruby_api_cc,v 1.1 2015/07/01 09:13:33 jasper Exp $
--- lib/src/ruby/api.cc.orig	Fri Jun 26 01:47:38 2015
+++ lib/src/ruby/api.cc	Mon Jun 29 22:50:15 2015
@@@@ -478,7 +478,7 @@@@ namespace facter { namespace ruby {
d19 4
a23 6
         // Search the path for ruby.exe and query it for the location of its library.
-        string ruby = execution::which("ruby");
+        string ruby = execution::which("ruby${MODRUBY_BINREV}");
         if (ruby.empty()) {
             LOG_DEBUG("ruby could not be found on the PATH.");
             return library;
@


1.1
log
@Initial revision
@
text
@d1 1
a1 1
$OpenBSD$
@


1.1.1.1
log
@import facter-3.0.1

Native implementation of facter functionality in C++11, providing:
  - a shared library which gather facts about the system
  - an executable for standalone command line usage
  - a ruby file to enable require 'facter'
Facter is especially useful for retrieving things like operating system
names, hardware characteristics, IP addresses, MAC addresses, and SSH
keys.

Note that this port doesn't provide all the facts that sysutils/ruby-facter
does right now, but that's being worked on. therefore it's not used by
puppet yet.

feedback/ok aja@@
@
text
@@
