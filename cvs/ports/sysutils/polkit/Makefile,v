head	1.67;
access;
symbols
	OPENBSD_6_2:1.67.0.2
	OPENBSD_6_2_BASE:1.67
	OPENBSD_6_1:1.66.0.4
	OPENBSD_6_1_BASE:1.66
	OPENBSD_6_0:1.66.0.2
	OPENBSD_6_0_BASE:1.66
	OPENBSD_5_9:1.65.0.2
	OPENBSD_5_9_BASE:1.65
	OPENBSD_5_8:1.65.0.4
	OPENBSD_5_8_BASE:1.65
	OPENBSD_5_7:1.60.0.2
	OPENBSD_5_7_BASE:1.60
	OPENBSD_5_6:1.58.0.2
	OPENBSD_5_6_BASE:1.58
	OPENBSD_5_5:1.49.0.2
	OPENBSD_5_5_BASE:1.49
	OPENBSD_5_4:1.46.0.2
	OPENBSD_5_4_BASE:1.46
	OPENBSD_5_3:1.41.0.2
	OPENBSD_5_3_BASE:1.41
	OPENBSD_5_2:1.32.0.2
	OPENBSD_5_2_BASE:1.32
	OPENBSD_5_1_BASE:1.30
	OPENBSD_5_1:1.30.0.2
	OPENBSD_5_0:1.25.0.2
	OPENBSD_5_0_BASE:1.25
	OPENBSD_4_9:1.12.0.2
	OPENBSD_4_9_BASE:1.12
	OPENBSD_4_8:1.6.0.2
	OPENBSD_4_8_BASE:1.6
	ajacoutot_20100701:1.1.1.1
	ajacoutot:1.1.1;
locks; strict;
comment	@# @;


1.67
date	2017.04.16.15.37.41;	author ajacoutot;	state Exp;
branches;
next	1.66;
commitid	nMptnqcidIL6LF1Y;

1.66
date	2016.03.11.20.28.32;	author naddy;	state Exp;
branches;
next	1.65;
commitid	UYLP8TE6V7RS2GhJ;

1.65
date	2015.07.19.00.31.29;	author ajacoutot;	state Exp;
branches;
next	1.64;
commitid	rjroKBh6iwDEuzWC;

1.64
date	2015.07.16.17.45.37;	author ajacoutot;	state Exp;
branches;
next	1.63;
commitid	xFt5wDZUa2tZDFg8;

1.63
date	2015.07.03.06.42.27;	author ajacoutot;	state Exp;
branches;
next	1.62;
commitid	G0jaLtbt6OWP5rIj;

1.62
date	2015.07.03.05.57.26;	author ajacoutot;	state Exp;
branches;
next	1.61;
commitid	DvY95B91Lz26JB2I;

1.61
date	2015.04.04.09.30.30;	author ajacoutot;	state Exp;
branches;
next	1.60;
commitid	QSLndtZiU46ysFLn;

1.60
date	2014.09.13.16.36.54;	author ajacoutot;	state Exp;
branches
	1.60.2.1;
next	1.59;
commitid	N2TalFGi4jKRwS2u;

1.59
date	2014.08.17.06.47.39;	author ajacoutot;	state Exp;
branches;
next	1.58;
commitid	sBoaatSsAAMfVVkg;

1.58
date	2014.03.27.17.51.07;	author ajacoutot;	state Exp;
branches;
next	1.57;

1.57
date	2014.03.27.06.51.38;	author ajacoutot;	state Exp;
branches;
next	1.56;

1.56
date	2014.03.26.14.56.23;	author ajacoutot;	state Exp;
branches;
next	1.55;

1.55
date	2014.03.26.12.18.08;	author ajacoutot;	state Exp;
branches;
next	1.54;

1.54
date	2014.03.16.09.16.27;	author ajacoutot;	state Exp;
branches;
next	1.53;

1.53
date	2014.03.11.20.32.46;	author espie;	state Exp;
branches;
next	1.52;

1.52
date	2014.03.10.19.54.24;	author ajacoutot;	state Exp;
branches;
next	1.51;

1.51
date	2014.03.10.18.18.27;	author ajacoutot;	state Exp;
branches;
next	1.50;

1.50
date	2014.03.09.22.26.56;	author ajacoutot;	state Exp;
branches;
next	1.49;

1.49
date	2014.01.19.10.30.53;	author ajacoutot;	state Exp;
branches;
next	1.48;

1.48
date	2013.09.22.18.35.58;	author ajacoutot;	state Exp;
branches;
next	1.47;

1.47
date	2013.08.10.12.43.51;	author ajacoutot;	state Exp;
branches;
next	1.46;

1.46
date	2013.05.30.18.22.05;	author ajacoutot;	state Exp;
branches
	1.46.2.1;
next	1.45;

1.45
date	2013.04.15.16.50.14;	author ajacoutot;	state Exp;
branches;
next	1.44;

1.44
date	2013.03.30.12.20.28;	author ajacoutot;	state Exp;
branches;
next	1.43;

1.43
date	2013.03.21.08.48.54;	author ajacoutot;	state Exp;
branches;
next	1.42;

1.42
date	2013.03.11.11.41.32;	author espie;	state Exp;
branches;
next	1.41;

1.41
date	2013.02.19.16.09.15;	author ajacoutot;	state Exp;
branches
	1.41.2.1;
next	1.40;

1.40
date	2013.01.10.13.53.24;	author ajacoutot;	state Exp;
branches;
next	1.39;

1.39
date	2012.11.22.17.37.35;	author ajacoutot;	state Exp;
branches;
next	1.38;

1.38
date	2012.11.20.14.11.48;	author ajacoutot;	state Exp;
branches;
next	1.37;

1.37
date	2012.09.27.17.26.05;	author ajacoutot;	state Exp;
branches;
next	1.36;

1.36
date	2012.09.21.14.48.06;	author ajacoutot;	state Exp;
branches;
next	1.35;

1.35
date	2012.09.19.13.03.58;	author ajacoutot;	state Exp;
branches;
next	1.34;

1.34
date	2012.09.19.12.39.34;	author ajacoutot;	state Exp;
branches;
next	1.33;

1.33
date	2012.09.01.14.36.58;	author ajacoutot;	state Exp;
branches;
next	1.32;

1.32
date	2012.04.28.10.52.08;	author ajacoutot;	state Exp;
branches;
next	1.31;

1.31
date	2012.02.16.22.28.23;	author ajacoutot;	state Exp;
branches;
next	1.30;

1.30
date	2011.12.16.08.16.55;	author ajacoutot;	state Exp;
branches;
next	1.29;

1.29
date	2011.11.17.14.07.14;	author jasper;	state Exp;
branches;
next	1.28;

1.28
date	2011.11.17.11.42.31;	author jasper;	state Exp;
branches;
next	1.27;

1.27
date	2011.09.16.11.41.40;	author espie;	state Exp;
branches;
next	1.26;

1.26
date	2011.08.17.16.59.27;	author ajacoutot;	state Exp;
branches;
next	1.25;

1.25
date	2011.07.12.18.38.38;	author ajacoutot;	state Exp;
branches;
next	1.24;

1.24
date	2011.06.07.14.52.32;	author ajacoutot;	state Exp;
branches;
next	1.23;

1.23
date	2011.06.02.17.09.32;	author kili;	state Exp;
branches;
next	1.22;

1.22
date	2011.06.02.13.41.41;	author ajacoutot;	state Exp;
branches;
next	1.21;

1.21
date	2011.06.01.12.23.53;	author ajacoutot;	state Exp;
branches;
next	1.20;

1.20
date	2011.05.22.13.34.19;	author ajacoutot;	state Exp;
branches;
next	1.19;

1.19
date	2011.05.21.05.00.07;	author ajacoutot;	state Exp;
branches;
next	1.18;

1.18
date	2011.05.16.17.30.31;	author ajacoutot;	state Exp;
branches;
next	1.17;

1.17
date	2011.04.28.13.09.07;	author ajacoutot;	state Exp;
branches;
next	1.16;

1.16
date	2011.04.07.11.12.12;	author ajacoutot;	state Exp;
branches;
next	1.15;

1.15
date	2011.04.02.16.56.42;	author ajacoutot;	state Exp;
branches;
next	1.14;

1.14
date	2011.03.13.18.56.55;	author ajacoutot;	state Exp;
branches;
next	1.13;

1.13
date	2011.03.13.07.33.37;	author ajacoutot;	state Exp;
branches;
next	1.12;

1.12
date	2010.11.22.09.38.08;	author espie;	state Exp;
branches;
next	1.11;

1.11
date	2010.11.20.17.22.42;	author espie;	state Exp;
branches;
next	1.10;

1.10
date	2010.10.28.10.02.05;	author steven;	state Exp;
branches;
next	1.9;

1.9
date	2010.10.23.17.04.51;	author ajacoutot;	state Exp;
branches;
next	1.8;

1.8
date	2010.10.19.07.43.02;	author espie;	state Exp;
branches;
next	1.7;

1.7
date	2010.09.28.17.57.23;	author ajacoutot;	state Exp;
branches;
next	1.6;

1.6
date	2010.07.18.15.41.22;	author ajacoutot;	state Exp;
branches;
next	1.5;

1.5
date	2010.07.16.10.04.10;	author ajacoutot;	state Exp;
branches;
next	1.4;

1.4
date	2010.07.08.15.20.45;	author ajacoutot;	state Exp;
branches;
next	1.3;

1.3
date	2010.07.05.07.42.43;	author ajacoutot;	state Exp;
branches;
next	1.2;

1.2
date	2010.07.02.21.47.43;	author ajacoutot;	state Exp;
branches;
next	1.1;

1.1
date	2010.07.01.07.46.21;	author ajacoutot;	state Exp;
branches
	1.1.1.1;
next	;

1.1.1.1
date	2010.07.01.07.46.21;	author ajacoutot;	state Exp;
branches;
next	;

1.41.2.1
date	2013.09.22.18.34.36;	author ajacoutot;	state Exp;
branches;
next	;

1.46.2.1
date	2013.10.30.12.51.00;	author jasper;	state Exp;
branches;
next	;

1.60.2.1
date	2015.07.03.06.52.45;	author ajacoutot;	state Exp;
branches;
next	;
commitid	Gin6w15UpxQjzlQ4;


desc
@@


1.67
log
@Fix a few memory leaks (via Fedora).
@
text
@# $OpenBSD: Makefile,v 1.66 2016/03/11 20:28:32 naddy Exp $

COMMENT=	framework for granting privileged operations to users

DISTNAME=	polkit-0.113
REVISION=	4

SHARED_LIBS +=  polkit-gobject-1	2.0 # .0.0
SHARED_LIBS +=  polkit-agent-1		2.0 # .0.0

CATEGORIES=	sysutils security

HOMEPAGE=	http://www.freedesktop.org/wiki/Software/polkit

MAINTAINER=	Antoine Jacoutot <ajacoutot@@openbsd.org>

# GPLv2+
PERMIT_PACKAGE_CDROM=	Yes

WANTLIB += c expat gio-2.0 glib-2.0 gobject-2.0 mozjs-17.0 pthread

MASTER_SITES=	http://www.freedesktop.org/software/polkit/releases/

MODULES=	devel/gettext \
		lang/python \
		textproc/intltool

# man pages
BUILD_DEPENDS+=	textproc/docbook-xsl

LIB_DEPENDS=	devel/glib2 \
		devel/mozjs17

# /usr/local/share/dbus-1/system-services/
RUN_DEPENDS +=	x11/dbus,-suid

CONFIGURE_STYLE= gnu
CONFIGURE_ENV=	CPPFLAGS="-I${LOCALBASE}/include" \
		LDFLAGS="-L${LOCALBASE}/lib"
CONFIGURE_ARGS=	--disable-libsystemd-login \
		--mandir=${PREFIX}/man \
		--enable-introspection \
		--enable-man-pages \
		--enable-examples \
		--with-os-type=openbsd \
		--with-authfw=bsdauth \
		--with-polkitd-user=_polkitd

# fgetgrent, fgetpwent
CONFIGURE_ARGS += --disable-test

MODPY_BUILDDEP=	No
MODPY_RUNDEP=	No
USE_GMAKE=	Yes

FAKE_FLAGS=	sysconfdir=${PREFIX}/share/examples/polkit

### Remove when updating to a newer release with integrated bsd_auth(3) support.
AUTOCONF_VERSION=2.69
AUTOMAKE_VERSION=1.11
BUILD_DEPENDS +=${MODGNU_AUTOMAKE_DEPENDS} \
		${MODGNU_AUTOCONF_DEPENDS} \
		devel/gettext \
		devel/gobject-introspection
# AUTOCONF needs AM_PROG_LIBTOOL
BUILD_DEPENDS+=	devel/libtool
###


pre-configure:
	perl -pi \
		-e "s,/usr/bin/pkexec,${PREFIX}/bin/pkexec,g;" \
		-e "s,/usr/bin/python,${MODPY_BIN},g;" \
		-e "s,/usr/bin/my-pk-test,${PREFIX}/bin/my-pk-test,g;" \
		-e "s,/usr/share/polkit-1,${PREFIX}/share/polkit-1,g;" \
		-e "s,/etc/polkit-1,${SYSCONFDIR}/polkit-1,g;" \
		-e "s,/usr/bin/bash,${LOCALBASE}/bin/bash,g;" \
		-e "s,/usr/bin/cat,/bin/cat,g;" \
		-e "s,/usr/bin/pk-example-frobnicate,${PREFIX}/bin/pk-example,g;" \
		-e "s,>/etc<,>${SYSCONFDIR}<,g;" \
		-e "s,>/usr<,>${PREFIX}<,g" \
		${WRKSRC}/docs/man/pkexec.xml \
		${WRKSRC}/docs/man/polkit.xml \
		${WRKSRC}/docs/extensiondir.xml \
		${WRKSRC}/src/examples/org.freedesktop.policykit.examples.pkexec.policy.in

	cd ${WRKSRC} && \
		AUTOMAKE_VERSION=${AUTOMAKE_VERSION} \
		AUTOCONF_VERSION=${AUTOCONF_VERSION} \
		${LOCALBASE}/bin/autoreconf

.include <bsd.port.mk>
@


1.66
log
@garbage collect CONFIGURE_SHARED
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.65 2015/07/19 00:31:29 ajacoutot Exp $
d6 1
a6 1
REVISION=	3
@


1.65
log
@Sync with BZ.
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.64 2015/07/16 17:45:37 ajacoutot Exp $
d40 1
a40 2
CONFIGURE_ARGS=	${CONFIGURE_SHARED} \
		--disable-libsystemd-login \
@


1.64
log
@Sync with the patch in fd.o BZ.
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.63 2015/07/03 06:42:27 ajacoutot Exp $
d6 1
a6 1
REVISION=	2
@


1.63
log
@Fix runtime and bump to be ahead of (upcoming) stable.
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.62 2015/07/03 05:57:26 ajacoutot Exp $
d6 1
a6 1
REVISION=	1
@


1.62
log
@SECURITY update to polkit-0.113.
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.61 2015/04/04 09:30:30 ajacoutot Exp $
d6 1
@


1.61
log
@These need to RUN_DEPENDS on x11/dbus,-suid now.
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.60 2014/09/13 16:36:54 ajacoutot Exp $
d5 1
a5 2
DISTNAME=	polkit-0.112
REVISION=	8
@


1.60
log
@--disable-gtk-doc is handled by the infrastructure now.
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.59 2014/08/17 06:47:39 ajacoutot Exp $
d6 1
a6 1
REVISION=	7
d33 3
@


1.60.2.1
log
@SECURITY update to polkit-0.113.

Fixes CVE-2015-4625, a local privilege escalation due to predictable
authentication session cookie values. Thanks to Tavis Ormandy, Google Project
Zero for reporting this issue. For the future, authentication agents are
encouraged to use PolkitAgentSession instead of using the D-Bus agent response
API directly.

Fixes CVE-2015-3256, various memory corruption vulnerabilities in use of the
JavaScript interpreter, possibly leading to local privilege escalation.

Fixes CVE-2015-3255, a memory corruption vulnerability in handling duplicate
action IDs, possibly leading to local privilege escalation. Thanks to
Laurent Bigonville for reporting this issue.

Fixes CVE-2015-3218, which allowed any local user to crash polkitd. Thanks to
Tavis Ormandy, Google Project Zero, for reporting this issue.
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.60 2014/09/13 16:36:54 ajacoutot Exp $
d5 2
a6 2
DISTNAME=	polkit-0.113
REVISION=	0
@


1.59
log
@Merge a couple of fixes from upstream.
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.58 2014/03/27 17:51:07 ajacoutot Exp $
a37 1
		--disable-gtk-doc \
a48 6

# If one of these tools is found at configure stage, it might be used,
# no matter whether we use --disable-gtk-doc or not.
CONFIGURE_ENV +=ac_cv_path_GTKDOC_CHECK="" \
		ac_cv_path_GTKDOC_REBASE="" \
		ac_cv_path_GTKDOC_MKPDF=""
@


1.58
log
@It makes no sense to explicitely depend on x11/dbus; nowadays dbus will
almost end up in any dependency chain and if we start adding run_depends on
it, we'll beed to do it for a hundre ports or so.
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.57 2014/03/27 06:51:38 ajacoutot Exp $
d6 1
a6 1
REVISION=	6
@


1.57
log
@BUILD_DEPENDS -> BUILD_DEPENDS+

fix an issue reported by nigel@@
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.56 2014/03/26 14:56:23 ajacoutot Exp $
d6 1
a6 1
REVISION=	5
a29 2

RUN_DEPENDS=	x11/dbus
@


1.56
log
@Drop gtk-doc from build_depends.

req. by espie@@
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.55 2014/03/26 12:18:08 ajacoutot Exp $
d68 1
a68 1
BUILD_DEPENDS=	${MODGNU_AUTOMAKE_DEPENDS} \
@


1.55
log
@Move from devel/spidermonkey to devel/mozjs17.
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.54 2014/03/16 09:16:27 ajacoutot Exp $
d6 1
a6 1
REVISION=	4
a27 9
BUILD_DEPENDS=	${MODGNU_AUTOMAKE_DEPENDS} \
		${MODGNU_AUTOCONF_DEPENDS} \
		devel/gettext \
		devel/gobject-introspection

# AUTOCONF needs AM_PROG_LIBTOOL and ENABLE_GTK_DOC
BUILD_DEPENDS+=	devel/libtool \
		textproc/gtk-doc

a35 3
AUTOCONF_VERSION=2.69
AUTOMAKE_VERSION=1.11

d64 12
@


1.54
log
@Circular dependency with textproc/gtk-doc is gone.
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.53 2014/03/11 20:32:46 espie Exp $
d6 1
a6 1
REVISION=	3
d43 1
a43 1
		devel/spidermonkey>=17.0,<18.0
@


1.53
log
@make tree build again
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.52 2014/03/10 19:54:24 ajacoutot Exp $
d6 1
a6 1
REVISION=	2
d34 2
a35 1
BUILD_DEPENDS+=	devel/libtool
d37 1
@


1.52
log
@Fix warnings to please espie@@
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.51 2014/03/10 18:18:27 ajacoutot Exp $
d34 1
a34 2
BUILD_DEPENDS+=	devel/libtool \
		textproc/gtk-doc
@


1.51
log
@Unbreak: needs textproc/gtk-doc; the dependency loop is gone so this is
safe.

reported by espie@@
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.50 2014/03/09 22:26:56 ajacoutot Exp $
d6 1
a6 1
REVISION=	1
d45 1
a45 1
AUTOMAKE_VERSION=1.10
@


1.50
log
@Merge some build patches from upstream and add BZ URLs.
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.49 2014/01/19 10:30:53 ajacoutot Exp $
d33 3
a35 2
# needs AM_PROG_LIBTOOL
BUILD_DEPENDS+=	devel/libtool
a36 2
# We do no want to depends on gtk-doc as it creates a dependency loop:
# polkit -> gtk-doc -> yelp -> gconf2 -> polkit
@


1.49
log
@Fix a memory leak (upstream).
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.48 2013/09/22 18:35:58 ajacoutot Exp $
d6 1
a6 1
REVISION=	0
d45 1
a45 1
AUTOCONF_VERSION= 2.68
a47 2
MODGNU_CONFIG_GUESS_DIRS= ${WRKSRC} ${WRKSRC}/test/mocklibc

d62 3
d78 12
a89 1
	${SUBST_CMD} ${WRKSRC}/docs/man/pkexec.xml \
d93 1
@


1.48
log
@SECURITY update to polkit-0.112.
CVE-2013-4288: Local Privilege Escalation Vulnerability.
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.47 2013/08/10 12:43:51 ajacoutot Exp $
d6 1
@


1.47
log
@Fix with mozjs-17.0 (devel/spidermonkey).
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.46 2013/05/30 18:22:05 ajacoutot Exp $
d5 1
a5 2
DISTNAME=	polkit-0.111
REVISION=	0
@


1.46
log
@Update to polkit-0.111.
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.45 2013/04/15 16:50:14 ajacoutot Exp $
d6 1
d20 1
a20 1
WANTLIB += c expat gio-2.0 glib-2.0 gobject-2.0 mozjs185 pthread
d43 1
a43 1
		devel/spidermonkey
@


1.46.2.1
log
@SECURITY fix for CVE-2013-4288: Local Privilege Escalation Vulnerability.
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.46 2013/05/30 18:22:05 ajacoutot Exp $
a5 1
REVISION=	0
@


1.45
log
@Remove fdatasync(2) patch.
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.44 2013/03/30 12:20:28 ajacoutot Exp $
d5 1
a5 2
DISTNAME=	polkit-0.110
REVISION=	2
d19 1
a19 1
WANTLIB += c expat gio-2.0 glib-2.0 gmodule-2.0 gobject-2.0 pthread
d23 3
a25 2
MODULES=	textproc/intltool \
		lang/python
d30 1
a30 7
		devel/gobject-introspection \
		devel/spidermonkey

RUN_DEPENDS=	x11/dbus

# dlopen() libmozjs185.so
RUN_DEPENDS +=	devel/spidermonkey
d39 4
a42 1
LIB_DEPENDS=	devel/glib2
a71 1
USE_GROFF=	Yes
@


1.44
log
@Drop useless readme.
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.43 2013/03/21 08:48:54 ajacoutot Exp $
d6 1
a6 1
REVISION=	1
@


1.43
log
@USE_LIBTOOL=Yes is the default now.
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.42 2013/03/11 11:41:32 espie Exp $
d6 1
a6 1
REVISION=	0
@


1.42
log
@PERMIT_* / REGRESS->TEST sweep
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.41 2013/02/19 16:09:15 ajacoutot Exp $
a37 1
USE_LIBTOOL=	Yes
@


1.41
log
@Unbreak rule parsing by opening the proper libmozjs.

spotted by landry@@
ok landry@@ jasper@@
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.40 2013/01/10 13:53:24 ajacoutot Exp $
a17 2
PERMIT_DISTFILES_CDROM=	Yes
PERMIT_DISTFILES_FTP=	Yes
a18 1
PERMIT_PACKAGE_FTP=	Yes
@


1.41.2.1
log
@SECURITY fix for CVE-2013-4288: Local Privilege Escalation Vulnerability.
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.41 2013/02/19 16:09:15 ajacoutot Exp $
d6 1
a6 1
REVISION=	1
@


1.40
log
@Bugfix update to polkit-0.110.
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.39 2012/11/22 17:37:35 ajacoutot Exp $
d6 1
@


1.39
log
@Include gmodule-2.0 to avoid linker errors; from upstream.
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.38 2012/11/20 14:11:48 ajacoutot Exp $
d5 1
a5 2
DISTNAME=	polkit-0.108
REVISION=	0
@


1.38
log
@Major update to polkit-0.108.
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.35 2012/09/19 13:03:58 ajacoutot Exp $
d6 1
@


1.37
log
@docbook-xsl already comes with libxslt.
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.36 2012/09/21 14:48:06 ajacoutot Exp $
d5 1
a5 2
DISTNAME=	polkit-0.105
REVISION=	0
d7 2
a8 3
SHARED_LIBS +=  polkit-gobject-1	1.0 # .0.0
SHARED_LIBS +=  polkit-backend-1	1.0 # .0.0
SHARED_LIBS +=  polkit-agent-1		1.0 # .0.0
d22 1
a22 1
WANTLIB += c expat gio-2.0 glib-2.0 gobject-2.0 pthread
d26 2
a27 1
MODULES=	textproc/intltool
d31 3
a33 1
		devel/gobject-introspection
d37 3
d60 1
a60 1
		--disable-systemd \
a63 1
		--enable-verbose-mode \
d66 2
a67 1
		--with-authfw=bsdauth
d75 2
d84 2
a85 1
		${WRKSRC}/actions/org.freedesktop.policykit.policy.in \
a86 7
	perl -pi -e 's,lib/polkit-1,db/polkit-1,g' \
		${WRKSRC}/configure.ac \
		${WRKSRC}/docs/man/pklocalauthority.xml \
		${WRKSRC}/docs/polkit/html/PolkitBackendLocalAuthority.html \
		${WRKSRC}/docs/polkit/html/pklocalauthority.8.html \
		${WRKSRC}/src/polkitbackend/polkitbackendlocalauthority.c \
		${WRKSRC}/test/polkitbackend/polkitbackendlocalauthoritytest.c
a90 9

post-install:
	${INSTALL_DATA} ${FILESDIR}/60-desktop-policy.conf \
		${PREFIX}/share/examples/polkit/polkit-1/localauthority.conf.d/
	# @@sample'd under /var/db/polkit-1
	${INSTALL_DATA_DIR} ${PREFIX}/share/examples/polkit/var/
	mv ${WRKINST}/var/lib ${PREFIX}/share/examples/polkit/var/db
	${INSTALL_DATA} ${FILESDIR}/10-desktop-policy.pkla \
		${PREFIX}/share/examples/polkit/var/db/polkit-1/localauthority/10-vendor.d/
@


1.36
log
@Stupid autohell is stupid...
The situation is this: even when we --disable-gtk-doc, if gtk-doc is
actually installed at configure stage, tools like gtkdoc-rebase will be
picked up and run during the install target. That is bad because the
gtk-doc package may have been removed by then, especially during dpb(1)
bulks (we explicitely disable support for it so why should it stay...).

So for now, let's add the following env to configure whenever we use
--disable-gtk-doc, until a bettersolution is found...
CONFIGURE_ENV +=ac_cv_path_GTKDOC_CHECK="" \
		ac_cv_path_GTKDOC_REBASE="" \
		ac_cv_path_GTKDOC_MKPDF=""
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.35 2012/09/19 13:03:58 ajacoutot Exp $
d42 1
a42 2
BUILD_DEPENDS+=	textproc/libxslt \
		textproc/docbook-xsl
@


1.35
log
@Forgot this chunk in previous.
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.34 2012/09/19 12:39:34 ajacoutot Exp $
d65 6
@


1.34
log
@Update to polkit-0.105.
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.33 2012/09/01 14:36:58 ajacoutot Exp $
d6 1
@


1.33
log
@register-plist did not catch the devel/glib2 -main -> empty change.
espie asked me in such a nice way to fix this that I'm bumping all ports
that have a direct dependency on glib2.
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.32 2012/04/28 10:52:08 ajacoutot Exp $
d5 1
a5 2
DISTNAME=	polkit-0.104
REVISION=	0
d13 1
a13 1
HOMEPAGE=	http://www.freedesktop.org/wiki/Software/PolicyKit
d23 1
a23 2
WANTLIB += c expat ffi gio-2.0 glib-2.0 gmodule-2.0 gobject-2.0
WANTLIB += gthread-2.0 pcre pthread z
d25 1
a25 1
MASTER_SITES=	http://hal.freedesktop.org/releases/
d27 1
a27 2
MODULES=	textproc/intltool \
		devel/gettext
d48 2
@


1.32
log
@--localstatedir=/var is the default now.
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.31 2012/02/16 22:28:23 ajacoutot Exp $
d6 1
@


1.31
log
@Update to polkit-0.104.
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.30 2011/12/16 08:16:55 ajacoutot Exp $
a56 1
		--localstatedir=/var \
@


1.30
log
@Update to polkit-0.103.

from Amit Kulkarni
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.29 2011/11/17 14:07:14 jasper Exp $
d5 1
a5 1
DISTNAME=	polkit-0.103
d56 1
d75 7
a87 2
	${INSTALL_DATA_DIR} \
		${PREFIX}/share/examples/polkit/var/db/polkit-1/localauthority/10-vendor.d
d90 3
@


1.29
log
@- this needs the gnu libtool autoconf macros
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.28 2011/11/17 11:42:31 jasper Exp $
d5 1
a5 2
DISTNAME=	polkit-0.102
REVISION=	0
d23 2
a24 2
WANTLIB += c expat gio-2.0 glib-2.0 gmodule-2.0 gobject-2.0 gthread-2.0
WANTLIB += pcre pthread z
@


1.28
log
@- move away from gnu libtool now that gobject-introspection has been fixed.
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.27 2011/09/16 11:41:40 espie Exp $
d40 1
a40 1
#BUILD_DEPENDS+=	devel/libtool
@


1.27
log
@normalize pkgpath
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.26 2011/08/17 16:59:27 ajacoutot Exp $
d38 1
a38 3
# XXX: the libtool wrapper script is passed as argument to g-ir-scanner,
# instead of the actual library
USE_LIBTOOL=	gnu
@


1.26
log
@Bugfix update to polkit-0.102.
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.25 2011/07/12 18:38:38 ajacoutot Exp $
d6 1
@


1.25
log
@We use /var/db/polkit-1, not /var/lib/...
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.24 2011/06/07 14:52:32 ajacoutot Exp $
d5 1
a5 2
DISTNAME=	polkit-0.101
REVISION=	6
@


1.24
log
@Extend README a bit more.
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.23 2011/06/02 17:09:32 kili Exp $
d6 1
a6 1
REVISION=	5
@


1.23
log
@--disable-silent-rules is now added to CONFIGURE_ARGS per default,
if CONFIGURE_STYLE = gnu.
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.22 2011/06/02 13:41:41 ajacoutot Exp $
d6 1
a6 1
REVISION=	4
@


1.22
log
@Add a consistent header that substitutes FULLPKGNAME for the READMEs.

ok jasper@@ sthen@@
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.21 2011/06/01 12:23:53 ajacoutot Exp $
a58 1
		--disable-silent-rules \
@


1.21
log
@MESSAGE -> README and greatly extend documentation in the process.
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.20 2011/05/22 13:34:19 ajacoutot Exp $
d6 1
a6 1
REVISION=	3
@


1.20
log
@Add missing CATEGORY.
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.19 2011/05/21 05:00:07 ajacoutot Exp $
d6 1
a6 1
REVISION=	2
@


1.19
log
@Add RUN_DEPENDS on x11/dbus and add missing @@sample dirs.
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.18 2011/05/16 17:30:31 ajacoutot Exp $
d6 1
a6 1
REVISION=	1
d12 1
a12 1
CATEGORIES=	sysutils
@


1.18
log
@Remove part of this patch which is not needed.
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.17 2011/04/28 13:09:07 ajacoutot Exp $
d6 1
a6 1
REVISION=	0
d35 2
@


1.17
log
@Update to polkit-0.101.
Merge several patches from upstream to fix CVE-2011-1485.

ok jasper@@
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.16 2011/04/07 11:12:12 ajacoutot Exp $
d6 1
d36 3
d40 1
a40 1
BUILD_DEPENDS+=	devel/libtool
d49 1
a49 1
AUTOCONF_VERSION= 2.64
d57 1
a68 4

# XXX: the libtool wrapper script is passed as argument to g-ir-scanner,
# instead of the actual library
USE_LIBTOOL=	gnu
@


1.16
log
@Add introspection support (needed for on-going GNOME 3 work).
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.15 2011/04/02 16:56:42 ajacoutot Exp $
d5 1
a5 2
DISTNAME=	polkit-0.97
REVISION=	6
d7 3
a9 3
SHARED_LIBS +=  polkit-gobject-1	0.0 # .0.0
SHARED_LIBS +=  polkit-backend-1	0.0 # .0.0
SHARED_LIBS +=  polkit-agent-1		0.0 # .0.0
d23 2
a24 2
WANTLIB += c dbus-1 dbus-glib-1 expat gio-2.0 glib-2.0 gmodule-2.0
WANTLIB += gobject-2.0 gthread-2.0 pcre pthread z eggdbus-1
d26 1
a26 2
#MASTER_SITES=	http://hal.freedesktop.org/releases/
MASTER_SITES=	http://distfiles.bsdfrog.org/
d35 1
a35 1
# needs libtoolize
d43 1
a43 1
LIB_DEPENDS=	devel/eggdbus
d45 2
a46 2
AUTOCONF_VERSION= 2.62
AUTOMAKE_VERSION=1.9
d50 1
a50 2
		LDFLAGS="-L${LOCALBASE}/lib" \
		CC=${CC} CFLAGS="${CFLAGS}"
d52 1
d55 1
a58 2
		--disable-gtk-doc \
		--enable-introspection \
d75 1
a75 3

do-configure:
	cd ${WRKSRC} && env AUTOCONF_VERSION=${AUTOCONF_VERSION} \
d77 2
a78 1
		${CONFIGURE_ENV} ./autogen.sh ${CONFIGURE_ARGS}
@


1.15
log
@Simplify: use my distfiles subdomain.
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.14 2011/03/13 18:56:55 ajacoutot Exp $
d6 1
a6 1
REVISION=	5
d34 3
a36 1
		${MODGNU_AUTOCONF_DEPENDS}
d61 1
a61 1
		--disable-introspection \
d66 5
a70 2
USE_LIBTOOL=	Yes
USE_GROFF =	Yes
@


1.14
log
@Meh, fix the other half... spotted by Anthony J. Bentley.
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.13 2011/03/13 07:33:37 ajacoutot Exp $
d28 1
a28 1
MASTER_SITES=	http://www.bsdfrog.org/OpenBSD/distfiles/
@


1.13
log
@Grammar, from Anthony J. Bentley.
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.12 2010/11/22 09:38:08 espie Exp $
d6 1
a6 1
REVISION=	4
@


1.12
log
@missed a few depends
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.11 2010/11/20 17:22:42 espie Exp $
d6 1
a6 1
REVISION=	3
@


1.11
log
@new depends
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.10 2010/10/28 10:02:05 steven Exp $
d36 1
a36 1
BUILD_DEPENDS+=	::devel/libtool
@


1.10
log
@this builds fine with openbsd libtool so set USE_LIBTOOL=yes

however auto* needs libtoolize or some other libtool macros, therefore add
a build dependency on gnu libtool
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.9 2010/10/23 17:04:51 ajacoutot Exp $
d40 2
a41 2
BUILD_DEPENDS+=	::textproc/libxslt \
		::textproc/docbook-xsl
d43 1
a43 1
LIB_DEPENDS=	::devel/eggdbus
@


1.9
log
@Add a missing @@sample directory.
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.8 2010/10/19 07:43:02 espie Exp $
d35 2
d64 1
a64 2
# XXX needs libtoolize
USE_LIBTOOL=	gnu
@


1.8
log
@USE_GROFF=Yes
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.7 2010/09/28 17:57:23 ajacoutot Exp $
d6 1
a6 1
REVISION=	2
@


1.7
log
@Set USE_LIBTOOL to gnu for now as it needs libtoolize.
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.6 2010/07/18 15:41:22 ajacoutot Exp $
d64 1
@


1.6
log
@From upstream 779c0153fc0bd3c2e302dac1979d17638f054229:
Configuration reload on every query.
Set has_data to true after the data is loaded to prevent excessive
reloading of config files.
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.5 2010/07/16 10:04:10 ajacoutot Exp $
d62 2
a63 1
USE_LIBTOOL=	Yes
@


1.5
log
@Fix some warnings.
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.4 2010/07/08 15:20:45 ajacoutot Exp $
d6 1
a6 1
PKGNAME=	${DISTNAME}p1
d25 1
a25 1
WANTLIB += gobject-2.0 gthread-2.0 pcre pthread z
d41 1
a41 1
LIB_DEPENDS=	eggdbus-1::devel/eggdbus
@


1.4
log
@Remove build_depends on gtk-doc. First we don't use it
(--disable-gtk-doc) and more important, it creates a dependency loop as
reported by Markus Lude.
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.3 2010/07/05 07:42:43 ajacoutot Exp $
d6 1
a6 1
PKGNAME=	${DISTNAME}p0
@


1.3
log
@Fix directory installation paths.
Add sample policies adapted from Fedora. These are not installed by
default, you can install them manually or use them as starting point for
writing new policies.
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.2 2010/07/02 21:47:43 ajacoutot Exp $
d6 1
d33 1
a33 2
BUILD_DEPENDS=	::textproc/gtk-doc \
		${MODGNU_AUTOMAKE_DEPENDS} \
d35 5
@


1.2
log
@Add missing BUILD_DEPENDS, spotted by pirofti@@.
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.1.1.1 2010/07/01 07:46:21 ajacoutot Exp $
d72 2
d76 2
@


1.1
log
@Initial revision
@
text
@d1 1
a1 1
# $OpenBSD$
d32 1
a32 2
BUILD_DEPENDS=	::textproc/libxslt \
		::textproc/docbook-xsl \
@


1.1.1.1
log
@Import polkit-0.97.

PolicyKit is an application-level toolkit for defining and handling the
policy that allows unprivileged processes to speak to privileged
processes. It is a framework for centralizing the decision making
process with respect to granting access to privileged operations for
unprivileged applications. PolicyKit is specifically targeting
applications in rich desktop environments on multi-user UNIX-like
operating systems. It does not imply or rely on any exotic kernel
features.


bsd_auth(3) support is based on the Slackware Linux shadow
authentication port.
Several patches from FreeBSD and NetBSD.

*While basic functionnality works, this is NOT hooked up yet as more
things are coming*
@
text
@@
