head	1.3;
access;
symbols
	OPENBSD_5_5:1.2.0.4
	OPENBSD_5_5_BASE:1.2
	OPENBSD_5_4:1.2.0.2;
locks; strict;
comment	@# @;


1.3
date	2014.04.04.14.31.26;	author jasper;	state dead;
branches;
next	1.2;

1.2
date	2013.12.12.21.12.38;	author jasper;	state Exp;
branches
	1.2.2.1;
next	1.1;

1.1
date	2013.12.04.09.20.56;	author jasper;	state Exp;
branches;
next	;

1.2.2.1
date	2013.12.15.19.44.32;	author jasper;	state Exp;
branches;
next	;


desc
@@


1.3
log
@update to puppet-3.5.0, please refer to the release notes for detailed
information about the changes:
http://docs.puppetlabs.com/puppet/latest/reference/release_notes.html#puppet-350
@
text
@$OpenBSD: patch-lib_puppet_provider_mount_rb,v 1.2 2013/12/12 21:12:38 jasper Exp $

From 87b7299ab42f8714661b419d10cb48a45c226def Mon Sep 17 00:00:00 2001
From: Jasper Lievisse Adriaanse <jasper@@humppa.nl>
Date: Wed, 13 Nov 2013 15:58:41 +0100
Subject: [PATCH] On systems without "-o remount", use "-o update" except for AIX.

--- lib/puppet/provider/mount.rb.orig	Thu Dec 12 10:06:05 2013
+++ lib/puppet/provider/mount.rb	Thu Dec 12 10:07:41 2013
@@@@ -27,6 +27,13 @@@@ module Puppet::Provider::Mount
     info "Remounting"
     if resource[:remounts] == :true
       mountcmd "-o", "remount", resource[:name]
+    elsif ["FreeBSD", "DragonFly", "OpenBSD"].include?(Facter.value(:operatingsystem))
+      if self.options && !self.options.empty?
+        options = self.options + ",update"
+      else
+        options = "update"
+      end
+      mountcmd "-o", options, resource[:name]
     else
       unmount
       mount
@


1.2
log
@committed upstream + merge in a tweak that went in along with it.
@
text
@d1 1
a1 1
$OpenBSD$
@


1.2.2.1
log
@update puppet to 3.3.2

this allows OpenBSD 5.4 agents to work correctly again with a puppet master
unning -current. puppet 3.3 has a new reporting format as well as support
for ensure => latest for packages. now one can use the same manifest for
5.4 and -current again.

note: libshadow was not imported into 5.4 so managing user passwords won't
work on 5.4 still.

discussed with sthen@@
@
text
@d1 1
a1 1
$OpenBSD: patch-lib_puppet_provider_mount_rb,v 1.2 2013/12/12 21:12:38 jasper Exp $
@


1.1
log
@sync with upstream pr; use -o update on openbsd for remounts.
@
text
@d3 4
a6 2
(#23141) Rework 'remounts' for BSDs
https://github.com/puppetlabs/puppet/pull/2062
d8 3
a10 4
--- lib/puppet/provider/mount.rb.orig	Wed Dec  4 09:40:01 2013
+++ lib/puppet/provider/mount.rb	Wed Dec  4 09:43:14 2013
@@@@ -26,7 +26,12 @@@@ module Puppet::Provider::Mount
   def remount
d13 2
a14 1
-      mountcmd "-o", "remount", resource[:name]
d18 1
a18 1
+       options = "update"
@

