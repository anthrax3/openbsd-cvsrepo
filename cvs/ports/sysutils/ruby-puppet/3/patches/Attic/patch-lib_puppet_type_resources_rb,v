head	1.6;
access;
symbols
	OPENBSD_5_6:1.5.0.2
	OPENBSD_5_6_BASE:1.5
	OPENBSD_5_5:1.2.0.2
	OPENBSD_5_5_BASE:1.2
	OPENBSD_5_4:1.1.0.2
	OPENBSD_5_4_BASE:1.1;
locks; strict;
comment	@# @;


1.6
date	2014.09.07.18.16.42;	author jasper;	state dead;
branches;
next	1.5;
commitid	STfu20c85fpA9ykS;

1.5
date	2014.06.04.07.48.23;	author jasper;	state Exp;
branches;
next	1.4;
commitid	Mt30wzwBda1Vw9nY;

1.4
date	2014.05.15.20.17.16;	author jasper;	state Exp;
branches;
next	1.3;

1.3
date	2014.04.17.15.27.50;	author jasper;	state Exp;
branches;
next	1.2;

1.2
date	2013.09.13.07.20.30;	author jasper;	state Exp;
branches;
next	1.1;

1.1
date	2013.04.16.13.25.52;	author jasper;	state Exp;
branches
	1.1.2.1;
next	;

1.1.2.1
date	2013.12.15.19.44.32;	author jasper;	state Exp;
branches;
next	;


desc
@@


1.6
log
@- update to puppet-3.7.0
* https://docs.puppetlabs.com/puppet/3.7/reference/release_notes.html

testing/ok sebastia@@
@
text
@$OpenBSD: patch-lib_puppet_type_resources_rb,v 1.5 2014/06/04 07:48:23 jasper Exp $

From e69fa60ac14c35e8826f93224258a0a4f45a57df Mon Sep 17 00:00:00 2001
From: Jasper Lievisse Adriaanse <jasper@@humppa.nl>
Date: Thu, 17 Apr 2014 17:12:36 +0200
Subject: [PATCH 1/2] (PUP-2454) Use 999 as the max system uid for certain operating systems.

--- lib/puppet/type/resources.rb.orig	Thu May 22 20:48:04 2014
+++ lib/puppet/type/resources.rb	Wed Jun  4 09:34:35 2014
@@@@ -39,7 +39,7 @@@@ Puppet::Type.newtype(:resources) do
 
   newparam(:unless_system_user) do
     desc "This keeps system users from being purged.  By default, it
-      does not purge users whose UIDs are less than or equal to 500, but you can specify
+      does not purge users whose UIDs are less than 500 or 1000, depending on operating system, but you can specify
       a different UID as the inclusive limit."
 
     newvalues(:true, :false, /^\d+$/)
@@@@ -49,7 +49,7 @@@@ Puppet::Type.newtype(:resources) do
       when /^\d+/
         Integer(value)
       when :true, true
-        500
+        @@resource.system_users_max_uid
       when :false, false
         false
       when Integer; value
@@@@ -60,7 +60,7 @@@@ Puppet::Type.newtype(:resources) do
 
     defaultto {
       if @@resource[:name] == "user"
-        500
+        @@resource.system_users_max_uid
       else
         nil
       end
@@@@ -159,5 +159,14 @@@@ Puppet::Type.newtype(:resources) do
 
   def system_users
     %w{root nobody bin noaccess daemon sys}
+  end
+
+  def system_users_max_uid
+    case Facter.value(:osfamily)
+    when 'Debian', 'OpenBSD', 'FreeBSD'
+      999
+    else
+      499
+    end
   end
 end
@


1.5
log
@sync patch with what has been committed upstream
@
text
@d1 1
a1 1
$OpenBSD$
@


1.4
log
@* update to puppet 3.6.0
- release notes at http://docs.puppetlabs.com/puppet/3.6/reference/release_notes.html
- please note that this release deprecates the use of "config file
  environments". if you haven't already done so, please switch to "directory
  environments" as explained here: http://docs.puppetlabs.com/puppet/latest/reference/environments.html
@
text
@d1 1
a1 1
$OpenBSD: patch-lib_puppet_type_resources_rb,v 1.3 2014/04/17 15:27:50 jasper Exp $
d3 1
a3 1
From 535e748d2f0c102d0b5041988480e2ef237cd10f Mon Sep 17 00:00:00 2001
d6 1
a6 1
Subject: [PATCH] User ID's below 1000, not 500, are generally considered system users on OpenBSD.
d8 12
a19 3
--- lib/puppet/type/resources.rb.orig	Thu May 15 01:10:29 2014
+++ lib/puppet/type/resources.rb	Thu May 15 21:07:14 2014
@@@@ -49,7 +49,11 @@@@ Puppet::Type.newtype(:resources) do
d24 1
a24 5
+        if Facter.value('operatingsystem') != 'OpenBSD'
+          500
+        else
+          1000
+        end
d28 1
a28 1
@@@@ -60,7 +64,11 @@@@ Puppet::Type.newtype(:resources) do
d33 1
a33 5
+        if Facter.value('operatingsystem') != 'OpenBSD'
+          500
+        else
+          1000
+        end
d37 15
@


1.3
log
@submitted upstream
@
text
@d1 1
a1 1
$OpenBSD: patch-lib_puppet_type_resources_rb,v 1.2 2013/09/13 07:20:30 jasper Exp $
d8 3
a10 3
--- lib/puppet/type/resources.rb.orig	Tue Sep 10 00:15:46 2013
+++ lib/puppet/type/resources.rb	Wed Sep 11 23:30:18 2013
@@@@ -47,7 +47,11 @@@@ Puppet::Type.newtype(:resources) do
d23 1
a23 1
@@@@ -58,7 +62,11 @@@@ Puppet::Type.newtype(:resources) do
@


1.2
log
@- update to puppet-3.3.0
* all openbsd package provider features were merged upstream
@
text
@d1 1
a1 1
$OpenBSD: patch-lib_puppet_type_resources_rb,v 1.1 2013/04/16 13:25:52 jasper Exp $
d3 4
a6 3
User ID's below 1000 are considered "system users" on OpenBSD,
eventhough we lack the concept of "system users". Puppet uses
this to determine if a user can be purged.
@


1.1
log
@adjust the uid puppet looks at to determine if a user is a "system user" to 1000.
this then gets used to purge all non-system users, whether this is a good idea is
left as an exercise to the user.

ok aja@@ (MAINTAINER)
@
text
@d1 1
a1 1
$OpenBSD$
d7 3
a9 3
--- lib/puppet/type/resources.rb.orig	Sat Mar  9 00:03:46 2013
+++ lib/puppet/type/resources.rb	Tue Apr 16 14:30:08 2013
@@@@ -46,7 +46,11 @@@@ Puppet::Type.newtype(:resources) do
d22 1
a22 1
@@@@ -57,7 +61,11 @@@@ Puppet::Type.newtype(:resources) do
@


1.1.2.1
log
@update puppet to 3.3.2

this allows OpenBSD 5.4 agents to work correctly again with a puppet master
unning -current. puppet 3.3 has a new reporting format as well as support
for ensure => latest for packages. now one can use the same manifest for
5.4 and -current again.

note: libshadow was not imported into 5.4 so managing user passwords won't
work on 5.4 still.

discussed with sthen@@
@
text
@d1 1
a1 1
$OpenBSD: patch-lib_puppet_type_resources_rb,v 1.2 2013/09/13 07:20:30 jasper Exp $
d7 3
a9 3
--- lib/puppet/type/resources.rb.orig	Tue Sep 10 00:15:46 2013
+++ lib/puppet/type/resources.rb	Wed Sep 11 23:30:18 2013
@@@@ -47,7 +47,11 @@@@ Puppet::Type.newtype(:resources) do
d22 1
a22 1
@@@@ -58,7 +62,11 @@@@ Puppet::Type.newtype(:resources) do
@


