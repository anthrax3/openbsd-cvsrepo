head	1.4;
access;
symbols;
locks; strict;
comment	@# @;


1.4
date	2014.08.25.08.00.37;	author jasper;	state dead;
branches;
next	1.3;
commitid	O7rrDc6vTFpea7XF;

1.3
date	2014.08.15.13.29.10;	author jasper;	state Exp;
branches;
next	1.2;
commitid	bU7WSP5nRRzoDX8P;

1.2
date	2014.05.15.20.17.16;	author jasper;	state dead;
branches;
next	1.1;

1.1
date	2014.04.18.22.07.36;	author jasper;	state Exp;
branches;
next	;


desc
@@


1.4
log
@rewrite the service provider to use rcctl, shrinking the code by about 75% percent..
..while retaining some of the puppet-intrinsic quirks where a service won't
be restarted if the flags change. that's still under investigation.

this does however now allow for valid resources that would previously fail:
service { 'multicast_host': enable => true}
or
service { 'ipsec': enable => true}
@
text
@$OpenBSD: patch-lib_puppet_type_service_rb,v 1.3 2014/08/15 13:29:10 jasper Exp $

https://github.com/puppetlabs/puppet/pull/2978

--- lib/puppet/type/service.rb.orig	Mon Jun  9 23:08:19 2014
+++ lib/puppet/type/service.rb	Fri Aug 15 15:28:38 2014
@@@@ -80,6 +80,9 @@@@ module Puppet
       end
 
       newvalue(:running, :event => :service_started, :invalidate_refreshes => true) do
+        # Ensure flags are written out before starting the service as it may
+        # need to read it's flags from the filesystem.
+        @@resource.flush if @@resource.provider.flaggable?
         provider.start
       end
 
@


1.3
log
@Ensure flags are written out before starting the service as it may
need to read it's flags from the filesystem.
@
text
@d1 1
a1 1
$OpenBSD$
@


1.2
log
@* update to puppet 3.6.0
- release notes at http://docs.puppetlabs.com/puppet/3.6/reference/release_notes.html
- please note that this release deprecates the use of "config file
  environments". if you haven't already done so, please switch to "directory
  environments" as explained here: http://docs.puppetlabs.com/puppet/latest/reference/environments.html
@
text
@d1 1
a1 1
$OpenBSD: patch-lib_puppet_type_service_rb,v 1.1 2014/04/18 22:07:36 jasper Exp $
d3 1
a3 4
From a25e2cc2ef72d2549c84a91d75c587ecbfabfe4f Mon Sep 17 00:00:00 2001
From: Zach Leslie <zach@@puppetlabs.com>
Date: Tue, 14 Jan 2014 11:19:53 -0800
Subject: [PATCH] (PUP-2143) Implement :enableable for OpenBSD service provider
d5 4
a8 12
--- lib/puppet/type/service.rb.orig	Wed Apr 16 01:06:55 2014
+++ lib/puppet/type/service.rb	Sat Apr 19 00:00:54 2014
@@@@ -37,6 +37,8 @@@@ module Puppet
 
     feature :controllable, "The provider uses a control variable."
 
+    feature :flaggable, "The provider can pass flags to the service."
+
     newproperty(:enable, :required_features => :enableable) do
       desc "Whether a service should be enabled to start at boot.
         This property behaves quite differently depending on the platform;
@@@@ -95,6 +97,10 @@@@ module Puppet
d10 5
a14 1
         event
a15 5
+    end
+
+    newproperty(:flags, :required_features => :flaggable) do
+      desc "Specify a string of flags to pass to the startup script."
     end
a16 1
     newparam(:binary) do
@


1.1
log
@merge a patch from upstream which overhauls the service provider for openbsd

this allows for proper :ensure (enable/disable) and setting flags for services.
@
text
@d1 1
a1 1
$OpenBSD$
@

