head	1.8;
access;
symbols
	OPENBSD_6_1:1.6.0.2
	OPENBSD_6_1_BASE:1.6
	OPENBSD_6_0:1.2.0.2
	OPENBSD_6_0_BASE:1.2
	jsg_20160529:1.1.1.1
	jsg:1.1.1;
locks; strict;
comment	@# @;


1.8
date	2017.07.08.03.25.40;	author jsg;	state Exp;
branches;
next	1.7;
commitid	zcrvLdhzVqEdKeK0;

1.7
date	2017.05.05.10.49.28;	author jsg;	state Exp;
branches;
next	1.6;
commitid	1uA7efT6slZcyO4J;

1.6
date	2017.02.20.07.03.42;	author jsg;	state Exp;
branches;
next	1.5;
commitid	bouWBbASTLrOGbEm;

1.5
date	2016.12.12.03.43.30;	author jsg;	state Exp;
branches;
next	1.4;
commitid	yfKn1MQLNRwKcTRx;

1.4
date	2016.10.04.03.26.22;	author jsg;	state Exp;
branches;
next	1.3;
commitid	8Q7qW8XuiDh2xk8d;

1.3
date	2016.07.30.14.34.14;	author jsg;	state Exp;
branches;
next	1.2;
commitid	Hg8RaglEUdTgyvbB;

1.2
date	2016.07.17.15.09.39;	author jsg;	state Exp;
branches;
next	1.1;
commitid	LBnT7RDjB1Hd0DNS;

1.1
date	2016.05.29.02.07.26;	author jsg;	state Exp;
branches
	1.1.1.1;
next	;
commitid	ONyreQwo9VpHlaOu;

1.1.1.1
date	2016.05.29.02.07.26;	author jsg;	state Exp;
branches;
next	;
commitid	ONyreQwo9VpHlaOu;


desc
@@


1.8
log
@update dtb to linux 4.12
@
text
@# $OpenBSD: Makefile,v 1.7 2017/05/05 10:49:28 jsg Exp $

ONLY_FOR_ARCHS=	${GCC4_ARCHS} ${CLANG_ARCHS}

COMMENT=	Device Tree Blobs
DISTNAME=	linux-4.12
PKGNAME=	${DISTNAME:S/linux/dtb/}
CATEGORIES=	sysutils
HOMEPAGE=	http://www.devicetree.org
MAINTAINER=	Jonathan Gray <jsg@@openbsd.org>

# dual GPL/BSD
PERMIT_PACKAGE_CDROM=	Yes

MASTER_SITES=	https://cdn.kernel.org/pub/linux/kernel/v4.x/
EXTRACT_SUFX=	.tar.xz
PKG_ARCH=	*

MODULES=	lang/clang
MODCLANG_ARCHS=	${GCC4_ARCHS}
BUILD_DEPENDS=	devel/dtc
NO_TEST=	Yes

ARCHS= arm arm64 mips powerpc

do-build:
.for ARCH in ${ARCHS}
	cd ${WRKSRC}/arch/${ARCH}/boot/dts ; \
        for vendor in `find . -type d ! -name include` ; do \
	    cd ${WRKSRC}/arch/${ARCH}/boot/dts/$$vendor ; \
	    for dts in `ls *.dts` ; do \
	        clang-cpp -nostdinc -I . -I include -I${WRKSRC}/include \
		    -I ${WRKSRC}/scripts/dtc/include-prefixes \
		    -undef -D__DTS__ -x assembler-with-cpp $$dts \
		    | dtc -I dts -O dtb -o `echo "$$dts" \
		    | sed -e 's/\.dts$$/\.dtb/'` - ; \
	    done ; \
	done
.endfor

do-install:
	${INSTALL_DATA_DIR} ${PREFIX}/share/dtb
.for ARCH in ${ARCHS}
	${INSTALL_DATA_DIR} ${PREFIX}/share/dtb/${ARCH}
	cd ${WRKSRC}/arch/${ARCH}/boot/dts ; \
	for vendor in `find . -type d ! -name include` ; do \
	    ${INSTALL_DATA_DIR} ${PREFIX}/share/dtb/${ARCH}/$$vendor ; \
	    cd ${WRKSRC}/arch/${ARCH}/boot/dts/$$vendor ; \
	    for dtb in `ls *.dtb` ; do \
		${INSTALL_DATA} ${WRKSRC}/arch/${ARCH}/boot/dts/$$vendor/$$dtb \
		    ${PREFIX}/share/dtb/${ARCH}/$$vendor ; \
	    done ; \
	done
.endfor

.include <bsd.port.mk>
@


1.7
log
@update dtb to linux 4.11

Switch from using ports gcc to clang.  Base gcc can't be used as the
preprocessor doesn't handle '#' not being in the first column.

Problem in initial patch spotted by and ok sthen@@
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.6 2017/02/20 07:03:42 jsg Exp $
d6 1
a6 1
DISTNAME=	linux-4.11
d33 1
@


1.6
log
@update dtb to linux 4.10
@
text
@d1 3
a3 1
# $OpenBSD: Makefile,v 1.5 2016/12/12 03:43:30 jsg Exp $
d6 1
a6 1
DISTNAME=	linux-4.10
d19 2
a20 2
MODULES=	gcc4
MODGCC4_ARCHS=	*
d32 1
a32 1
	        ecpp -nostdinc -I . -I include -I${WRKSRC}/include \
@


1.5
log
@update dtb to linux 4.9
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.4 2016/10/04 03:26:22 jsg Exp $
d4 1
a4 1
DISTNAME=	linux-4.9
@


1.4
log
@update dtb to linux 4.8

This adds "allwinner,sun8i-h3-ccu" to existing allwinner h3 dtbs that
H3 support in -current requires.

And notably adds new dtbs for:
imx6q-utilite-pro
sun7i-a20-bananapi-m1-plus
sun8i-h3-bananapi-m2-plus
bcm2837-rpi-3-b

Tested on cubox, bbb and panda.
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.3 2016/07/30 14:34:14 jsg Exp $
d4 1
a4 1
DISTNAME=	linux-4.8
@


1.3
log
@update to linux 4.7
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.2 2016/07/17 15:09:39 jsg Exp $
d4 1
a4 1
DISTNAME=	linux-4.7
@


1.2
log
@The armv7 fdt console selection tries to find /chosen/stdout-path and
falls back to /aliases/serial0.

Add patches to set stdout-path for dts files that don't set stdout-path
and are known to use a serial device other than serial0 as a console.

Confirmed to restore console output on pandaboard es by abieber@@

ok sthen@@ naddy@@
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.1.1.1 2016/05/29 02:07:26 jsg Exp $
d4 1
a4 2
DISTNAME=	linux-4.6
REVISION=	0
@


1.1
log
@Initial revision
@
text
@d1 1
a1 1
# $OpenBSD$
d5 1
@


1.1.1.1
log
@Add a port to build Device Tree Blobs (DTBs) for various
ARM/MIPS/PowerPC boards.  DTBs are binary representations of Flattened
Device Trees (FDTs) that describe hardware properties such as memory
ranges, interrupts and processors.

DTB files are used by U-Boot and other firmware interfaces to provide
this information to the kernel.

Feedback from jca@@ and sthen@@.  ok sthen@@
@
text
@@
