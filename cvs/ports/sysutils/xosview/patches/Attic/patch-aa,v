head	1.8;
access;
symbols
	OPENBSD_2_7:1.7.0.4
	OPENBSD_2_7_BASE:1.7
	OPENBSD_2_6:1.7.0.2
	OPENBSD_2_6_BASE:1.7
	OPENBSD_2_5:1.5.0.2
	OPENBSD_2_5_BASE:1.5
	OPENBSD_2_4:1.1.1.1.0.2
	OPENBSD_2_4_BASE:1.1.1.1
	form_980507:1.1.1.1
	form:1.1.1;
locks; strict;
comment	@# @;


1.8
date	2000.07.17.16.24.46;	author form;	state dead;
branches;
next	1.7;

1.7
date	99.07.09.15.39.54;	author form;	state Exp;
branches
	1.7.4.1;
next	1.6;

1.6
date	99.07.01.22.07.44;	author form;	state Exp;
branches;
next	1.5;

1.5
date	98.11.24.02.54.29;	author form;	state Exp;
branches;
next	1.4;

1.4
date	98.11.23.04.41.50;	author form;	state dead;
branches;
next	1.3;

1.3
date	98.11.23.04.19.09;	author form;	state Exp;
branches;
next	1.2;

1.2
date	98.11.20.06.23.38;	author form;	state dead;
branches;
next	1.1;

1.1
date	98.05.07.05.22.37;	author form;	state Exp;
branches
	1.1.1.1;
next	;

1.1.1.1
date	98.05.07.05.22.37;	author form;	state Exp;
branches;
next	;

1.7.4.1
date	2000.09.15.05.18.38;	author marc;	state dead;
branches;
next	;


desc
@@


1.8
log
@upgrade to 1.7.4
@
text
@# $OpenBSD: patch-aa,v 1.7 1999/07/09 15:39:54 form Exp $

--- bsd/kernel.cc.orig	Fri Jul  9 22:17:49 1999
+++ bsd/kernel.cc	Fri Jul  9 22:21:52 1999
@@@@ -67,7 +67,11 @@@@
 
 #ifdef HAVE_SWAPCTL
 #include <unistd.h>		/*  For swapctl proto.  */
+#ifdef XOSVIEW_OPENBSD
+#include <sys/swap.h>
+#else
 #include <vm/vm_swap.h>		/*  For swapent, SWAP_*.  */
+#endif
 #include <stdlib.h>		/*  For malloc(), free().  */
 #endif
 
@@@@ -153,9 +157,9 @@@@
 { "_eintrcnt" },
 #define EINTRCNT_SYM_INDEX 	8
 
-#if defined(XOSVIEW_OPENBSD) && (defined(pc532) || defined(i386))
+#if defined(XOSVIEW_OPENBSD) && (defined(__pc532__) || defined(__i386__))
 
-# ifdef i386
+# ifdef __i386__
 { "_intrhand" },
 #define INTRHAND_SYM_INDEX    9
 { "_intrstray" },
@@@@ -750,7 +754,7 @@@@
 }
 
 /*  ---------------------- Interrupt Meter stuff  -----------------  */
-#if (!defined(XOSVIEW_OPENBSD) || !(defined(pc532) && defined(i386))) && !defined(XOSVIEW_BSDI)
+#if (!defined(XOSVIEW_OPENBSD) || !(defined(__pc532__) && defined(__i386__))) && !defined(XOSVIEW_BSDI)
 static unsigned long kvm_intrcnt[128];// guess at space needed
 #endif
 
@@@@ -770,9 +774,9 @@@@
 BSDIntrInit() {
     OpenKDIfNeeded();
 
-#if defined(XOSVIEW_OPENBSD) && defined(i386)
+#if defined(XOSVIEW_OPENBSD) && defined(__i386__)
     return ValidSymbol(INTRHAND_SYM_INDEX) && ValidSymbol(INTRSTRAY_SYM_INDEX);
-#elif defined (XOSVIEW_OPENBSD) && defined(pc532)
+#elif defined (XOSVIEW_OPENBSD) && defined(__pc532__)
     return ValidSymbol(IVP_SYM_INDEX);
 #elif defined (XOSVIEW_BSDI)
 #if _BSDI_VERSION >= 199802 /* BSD/OS 4.x */
@@@@ -785,7 +789,7 @@@@
 #endif
 }
 
-#if (!defined(XOSVIEW_OPENBSD) || !(defined(pc532) || defined(i386))) && !defined (XOSVIEW_BSDI)
+#if (!defined(XOSVIEW_OPENBSD) || !(defined(__pc532__) || defined(__i386__))) && !defined (XOSVIEW_BSDI)
 int
 BSDNumInts() {
   int nintr;
@@@@ -846,8 +850,8 @@@@
   //  counts.  We'll just use the intrcnt array here.  If anyone
   //  has problems, please mail me.  bgrayson
   {
-#if defined(XOSVIEW_OPENBSD) && (defined(pc532) || defined(i386))
-# ifdef i386
+#if defined(XOSVIEW_OPENBSD) && (defined(__pc532__) || defined(__i386__))
+# ifdef __i386__
   struct intrhand *intrhand[16], *ihp, ih;
   int intrstray[16];
 
@@@@ -868,8 +872,8 @@@@
       ihp = ih.ih_next;
     }
   }
-# endif /* i386 */
-# ifdef pc532
+# endif /* __i386__ */
+# ifdef __pc532__
   struct iv ivt[32], *ivp = ivt;
 
   safe_kvm_read(nlst[IVP_SYM_INDEX].n_value, ivp, sizeof(ivt));
@@@@ -879,15 +883,15 @@@@
     else
       intrCount[i] = 0;
   }
-# endif /* pc532 */
-#else /* XOSVIEW_OPENBSD && (pc532 || i386) */
+# endif /* __pc532__ */
+#else /* XOSVIEW_OPENBSD && (__pc532__ || __i386__) */
     int nintr = BSDNumInts();
     safe_kvm_read(nlst[INTRCNT_SYM_INDEX].n_value, kvm_intrcnt,
       sizeof(long)*nintr);
     for (int i=0;i<nintr;i++) {
       intrCount[i] = kvm_intrcnt[i];
     }
-#endif /* XOSVIEW_OPENBSD && (pc532 || i386) */
+#endif /* XOSVIEW_OPENBSD && (__pc532__ || __i386__) */
   }
   return;
 #endif
@


1.7
log
@Update to 1.7.2.
@
text
@d1 1
a1 1
# $OpenBSD: patch-aa,v 1.6 1999/07/01 22:07:44 form Exp $
@


1.7.4.1
log
@bring sysutils as of cut-over date into 2.7 branch
@
text
@d1 1
a1 1
# $OpenBSD: patch-aa,v 1.7 1999/07/09 15:39:54 form Exp $
@


1.6
log
@update to 1.7.0.b.
@
text
@d1 1
a1 1
# $OpenBSD: $
d3 2
a4 2
--- bsd/kernel.cc.orig	Tue Feb 16 20:09:21 1999
+++ bsd/kernel.cc	Fri Jul  2 04:46:10 1999
d17 1
a17 1
@@@@ -110,9 +114,9 @@@@
d29 1
a29 1
@@@@ -661,7 +665,7 @@@@
d33 2
a34 2
-#if !defined(XOSVIEW_OPENBSD) || !(defined(pc532) && defined(i386))
+#if !defined(XOSVIEW_OPENBSD) || !(defined(__pc532__) || defined(__i386__))
d38 1
a38 2
@@@@ -672,16 +676,16 @@@@
 int
d41 1
d48 3
a50 2
 #else
     return ValidSymbol(INTRCNT_SYM_INDEX) && ValidSymbol(EINTRCNT_SYM_INDEX);
d54 2
a55 2
-#if !defined(XOSVIEW_OPENBSD) || !(defined(pc532) || defined(i386))
+#if !defined(XOSVIEW_OPENBSD) || !(defined(__pc532__) || defined(__i386__))
d59 1
a59 10
@@@@ -702,7 +706,7 @@@@
 # endif
 #endif
 }
-#endif /* XOSVIEW_OPENBSD */
+#endif /* XOSVIEW_OPENBSD && !(__i386__ || __pc532__) */
 
 void
 BSDGetIntrStats (unsigned long intrCount[NUM_INTR]) {
@@@@ -727,8 +731,8 @@@@
d70 1
a70 1
@@@@ -749,8 +753,8 @@@@
d81 1
a81 1
@@@@ -760,15 +764,15 @@@@
@


1.5
log
@add interrupt meter support. mark as BROKEN for /alpha
@
text
@d1 107
a107 138
*** bsd/kernel.cc.orig	Fri Sep 25 02:21:30 1998
--- bsd/kernel.cc	Mon Nov 23 10:12:36 1998
***************
*** 32,37 ****
--- 32,41 ----
  #include <sys/disk.h>		/*  For disk statistics.  */
  #endif
  
+ #ifdef XOSVIEW_OPENBSD
+ #include "obsdintr.h"		/* XXX: got from 2.4 */
+ #endif
+ 
  #include <sys/socket.h>         /*  These two are needed for the  */
  #include <net/if.h>             /*    NetMeter helper functions.  */
  #if defined(XOSVIEW_FREEBSD) && (__FreeBSD_version >= 300000)
***************
*** 104,114 ****
--- 108,134 ----
  
  #endif /* XOSVIEW_FREEBSD */
  
+ #if defined(XOSVIEW_OPENBSD) && (defined(pc532) || defined(i386))
+ 
+ # ifdef i386
+ { "_intrhand" },
+ #define INTRHAND_SYM_INDEX	7
+ { "_intrstray" },
+ #define INTRSTRAY_SYM_INDEX	8
+ # else
+ { "_ivt" },
+ #define IVT_SYM_INDEX		7
+ # endif
+ 
+ #else /* XOSVIEW_OPENBSD && (pc532 || i386) */
+ 
  { "_intrcnt" },
  #define INTRCNT_SYM_INDEX 	7
  { "_eintrcnt" },
  #define EINTRCNT_SYM_INDEX 	8
  
+ #endif /* XOSVIEW_OPENBSD && (pc532 || i386) */
+ 
    {NULL}
  };
  
***************
*** 441,447 ****
--- 461,470 ----
  }
  
  /*  ---------------------- Interrupt Meter stuff  -----------------  */
+ #if !defined(XOSVIEW_OPENBSD) || !(defined(pc532) && defined(i386))
  static unsigned long kvm_intrcnt[128];// guess at space needed
+ #endif
+ 
  #ifdef XOSVIEW_FREEBSD
  static unsigned long kvm_intrptrs[NUM_INTR];
  #endif
***************
*** 449,457 ****
--- 472,487 ----
  int
  BSDIntrInit() {
      OpenKDIfNeeded(); 
+ #if defined(XOSVIEW_OPENBSD) && defined(i386)
+     return ValidSymbol(INTRHAND_SYM_INDEX) && ValidSymbol(INTRSTRAY_SYM_INDEX);
+ #elif defined (XOSVIEW_OPENBSD) && defined(pc532)
+     return ValidSymbol(IVP_SYM_INDEX);
+ #else
      return ValidSymbol(INTRCNT_SYM_INDEX) && ValidSymbol(EINTRCNT_SYM_INDEX);
+ #endif
  }
  
+ #if !defined(XOSVIEW_OPENBSD) || !(defined(pc532) || defined(i386))
  int BSDNumInts() {
    int nintr;
    OpenKDIfNeeded(); 
***************
*** 471,476 ****
--- 501,507 ----
  # endif
  #endif
  }
+ #endif /* XOSVIEW_OPENBSD */
  
  void
  BSDGetIntrStats (unsigned long intrCount[NUM_INTR])
***************
*** 496,507 ****
--- 527,574 ----
    //  counts.  We'll just use the intrcnt array here.  If anyone
    //  has problems, please mail me.  bgrayson
    {
+ #if defined(XOSVIEW_OPENBSD) && (defined(pc532) || defined(i386))
+ # ifdef i386
+   struct intrhand *intrhand[16], *ihp, ih;
+   int intrstray[16];
+ 
+   safe_kvm_read(nlst[INTRHAND_SYM_INDEX].n_value, intrhand,
+     sizeof(intrhand));
+   safe_kvm_read(nlst[INTRSTRAY_SYM_INDEX].n_value, intrstray,
+     sizeof(intrstray));
+ 
+   for (int i=0;i<16;i++) {
+     ihp = intrhand[i];
+     intrCount[i] = 0;
+     while (ihp) {
+       if (kvm_read(kd, (u_long)ihp, &ih, sizeof(ih)) != sizeof(ih)) {
+         fprintf(stderr, "Error: kvm_read(): %s\n", kvm_geterr(kd));
+         exit(1);
+       }
+       intrCount[i] = ih.ih_count;
+       ihp = ih.ih_next;
+     }
+   }
+ # endif /* i386 */
+ # ifdef pc532
+   struct iv ivt[32], *ivp = ivt;
+ 
+   safe_kvm_read(nlst[IVP_SYM_INDEX].n_value, ivp, sizeof(ivt));
+   for (int i=0;i<16;i++,ivp++) {
+     if (ivp->iv_vec && ivp->iv_use)
+       intrCount[i] = ivp->iv_cnt;
+     else
+       intrCount[i] = 0;
+   }
+ # endif /* pc532 */
+ #else /* XOSVIEW_OPENBSD && (pc532 || i386) */
      int nintr = BSDNumInts();
      safe_kvm_read(nlst[INTRCNT_SYM_INDEX].n_value, kvm_intrcnt,
        sizeof(long)*nintr);
      for (int i=0;i<nintr;i++) {
        intrCount[i] = kvm_intrcnt[i];
      }
+ #endif /* XOSVIEW_OPENBSD && (pc532 || i386) */
    }
    return;
  #endif
@


1.4
log
@remove interrupt meter support until it will be tested on non-i386
@
text
@@


1.3
log
@add OpenBSD interrupt meter support; untested on non-i386 platforms
@
text
@@


1.2
log
@update to 1.6.2.a
@
text
@d1 2
a2 2
*** configure.orig	Thu May  7 11:58:32 1998
--- configure	Thu May  7 11:59:36 1998
d4 4
a7 1
*** 1320,1334 ****
d9 130
a138 31
   ;;
  ##  Also check for versions that have not been tested.
! netbsd*)  echo "configure: warning: 
  ***************  Warning  *****************
    xosview has not been tested on $host_os.
!   So far, it is known to work on the following NetBSD versions:
      netbsd1.0
      netbsd1.1
      netbsd1.2
      netbsd1.2.1
      netbsd1.3
    If it works for version $host_os, please send mail to:
  	bgrayson@@ece.utexas.edu.
    If this message is in error, also notify bgrayson -- we're new
--- 1320,1335 ----
  
   ;;
  ##  Also check for versions that have not been tested.
! netbsd*|openbsd*)  echo "configure: warning: 
  ***************  Warning  *****************
    xosview has not been tested on $host_os.
!   So far, it is known to work on the following NetBSD/OpenBSD versions:
      netbsd1.0
      netbsd1.1
      netbsd1.2
      netbsd1.2.1
      netbsd1.3
+     openbsd2.3
    If it works for version $host_os, please send mail to:
  	bgrayson@@ece.utexas.edu.
    If this message is in error, also notify bgrayson -- we're new
@


1.1
log
@Initial revision
@
text
@@


1.1.1.1
log
@xosview 1.5.1, X11 system load, cpu/mem/swap/disk utilisation monitor
@
text
@@
