head	1.5;
access;
symbols
	OPENBSD_6_1:1.5.0.2
	OPENBSD_6_1_BASE:1.5;
locks; strict;
comment	@# @;


1.5
date	2017.03.26.17.06.29;	author kettenis;	state Exp;
branches;
next	1.4;
commitid	GTzJ3inEcfXiVmJn;

1.4
date	2017.03.24.22.37.53;	author sthen;	state Exp;
branches;
next	1.3;
commitid	0eTSnJvNXfeCNjoB;

1.3
date	2017.03.23.23.36.57;	author sthen;	state Exp;
branches;
next	1.2;
commitid	YWsGjYMZiZlq8MhJ;

1.2
date	2017.03.23.23.31.51;	author sthen;	state Exp;
branches;
next	1.1;
commitid	eGTJim7faEzFs0VE;

1.1
date	2017.03.23.08.05.00;	author sthen;	state Exp;
branches;
next	;
commitid	nGsr6VGd73aOgZQw;


desc
@@


1.5
log
@Implement minimal support for the OpenBSD VMM PCI host bridge.  This merely
prevents seabios from clobbering the pci interrupt line register.

ok sthen@@, mlarkin@@
@
text
@# $OpenBSD: Makefile,v 1.4 2017/03/24 22:37:53 sthen Exp $

FW_DRIVER=	vmm
FW_VER=		1.10.2
REVISION=	2
DISTNAME=	seabios-${FW_VER}

HOMEPAGE=	https://www.seabios.org/

MASTER_SITES=	https://code.coreboot.org/p/seabios/downloads/get/

# LGPLv3 but distributed via fw_update/firmware.openbsd.org so disable
# normal packaging.
PERMIT_PACKAGE_CDROM=	firmware
PERMIT_PACKAGE_FTP=	firmware
PERMIT_DISTFILES_FTP=	Yes

NO_BUILD=	No

MODULES=	lang/python
CONFIGURE_STYLE= x # workaround python.port.mk
MODPY_RUNDEP=	No
USE_GMAKE=	Yes

.if defined(REVISION)
EXTRAVERSION=	p${REVISION}-OpenBSD-vmm
.else
EXTRAVERSION=	-OpenBSD-vmm
.endif

MAKE_FLAGS=	PYTHON="${MODPY_BIN}" V=1 EXTRAVERSION="${EXTRAVERSION}" \
		LD32BIT_FLAG=-melf_i386_obsd LD="${LD} -nopie -znorelro" 

pre-build:
	cp ${FILESDIR}/config ${WRKSRC}/.config

do-install:
	 ${INSTALL_DATA} ${WRKSRC}/out/bios.bin ${PREFIX}/firmware/vmm-bios
	 ${INSTALL_DATA} ${WRKSRC}/COPYING.LESSER \
	    ${PREFIX}/firmware/vmm-bios-license

.include <bsd.port.mk>
@


1.4
log
@diable CONFIG_PS2PORT, req by mlarkin
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.3 2017/03/23 23:36:57 sthen Exp $
d5 1
a5 1
REVISION=	1
@


1.3
log
@don't bother building and throwing away a default-config bios
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.2 2017/03/23 23:31:51 sthen Exp $
d5 1
a5 1
REVISION=	0
@


1.2
log
@- actually use the config file, reyk@@ noticed that the produced files were wrong
- use the "clean build" mechanism to avoid including hostname/time in the built file
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.1 2017/03/23 08:05:00 sthen Exp $
d34 1
a34 2
post-build:
	mv ${WRKSRC}/out/bios.bin ${WRKSRC}/out/default-bios.bin
a35 1
	cd ${WRKSRC} && ${SETENV} ${MAKE_ENV} ${MAKE_PROGRAM} ${MAKE_TARGET} ${MAKE_FLAGS}
@


1.1
log
@Import SeaBIOS for use with vmm(4). done as a "firmware" port, so that
fw_update will be able to be modified to install it on suitable systems.
Based on SeaBIOS config/Makefile from mlarkin and a non-"firmware" port
from jca, looks good to jca deraadt.
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.4 2016/01/11 12:38:05 jasper Exp $
d5 1
d24 14
a37 1
MAKE_FLAGS=	PYTHON="${MODPY_BIN}" LD="${LD} -nopie -znorelro" V=1
@

