head	1.6;
access;
symbols
	OPENBSD_6_0:1.6.0.4
	OPENBSD_6_0_BASE:1.6
	OPENBSD_5_9:1.6.0.2
	OPENBSD_5_9_BASE:1.6
	jasper_20131312:1.1.1.1
	jasper:1.1.1;
locks; strict;
comment	@# @;


1.6
date	2015.11.19.15.01.47;	author jasper;	state Exp;
branches;
next	1.5;
commitid	tk3vgTP5YSV1ILB6;

1.5
date	2014.12.01.19.30.19;	author jasper;	state dead;
branches;
next	1.4;
commitid	QluVtAqXWeVahALx;

1.4
date	2014.10.30.14.10.07;	author jasper;	state Exp;
branches;
next	1.3;
commitid	dx46xwDFOedjV2GW;

1.3
date	2014.10.30.12.20.30;	author jasper;	state Exp;
branches;
next	1.2;
commitid	7jv1KV8tpIKFNhZu;

1.2
date	2013.12.18.22.10.09;	author jasper;	state dead;
branches;
next	1.1;

1.1
date	2013.12.13.07.50.53;	author jasper;	state Exp;
branches
	1.1.1.1;
next	;

1.1.1.1
date	2013.12.13.07.50.53;	author jasper;	state Exp;
branches;
next	;


desc
@@


1.6
log
@getpwnam -> getpwnam_shadow
@
text
@$OpenBSD$
--- pwd/shadow.c.orig	Thu Nov 19 15:51:37 2015
+++ pwd/shadow.c	Thu Nov 19 15:56:27 2015
@@@@ -92,7 +92,11 @@@@ rb_shadow_getspnam(VALUE self, VALUE name)
 
   if( TYPE(name) != T_STRING )
     rb_raise(rb_eException,"argument must be a string.");
+#ifdef __OpenBSD__
+  entry = getpwnam_shadow(StringValuePtr(name));
+#else
   entry = getpwnam(StringValuePtr(name));
+#endif
 
   if( entry == NULL )
     return Qnil;
@


1.5
log
@- update to 2.4.0
* the patches for loginclass have been merged upstream
@
text
@d1 4
a4 14
$OpenBSD: patch-pwd_shadow_c,v 1.4 2014/10/30 14:10:07 jasper Exp $

Add new sp_loginclass field to retrieve the user's login class.
https://github.com/apalmblad/ruby-shadow/pull/22

--- pwd/shadow.c.orig	Thu Oct 30 11:16:01 2014
+++ pwd/shadow.c	Thu Oct 30 11:26:02 2014
@@@@ -66,6 +66,7 @@@@ static VALUE convert_pw_struct( struct passwd *entry )
          INT2FIX(difftime(entry->pw_change, 0) / (24*60*60)), /* pw_change */
          INT2FIX(difftime(entry->pw_expire, 0) / (24*60*60)), /* sp_expire */
          Qnil, /* sp_flag */
+         rb_tainted_str_new2(entry->pw_class), /* sp_loginclass, user access class */
          NULL);
 }
d6 10
a15 10
@@@@ -107,7 +108,8 @@@@ Init_shadow()
                                      "sp_namp","sp_pwdp","sp_lstchg",
                                      "sp_min","sp_max","sp_warn",
                                      "sp_inact","pw_change",
-                                     "sp_expire","sp_flag", NULL);
+                                     "sp_expire","sp_flag",
+				     "sp_loginclass", NULL);
   rb_sGroupEntry = rb_struct_define("GroupEntry",
                                     "sg_name","sg_passwd",
                                     "sg_adm","sg_mem",NULL);
@


1.4
log
@add link to upstream pr
@
text
@d1 1
a1 1
$OpenBSD: patch-pwd_shadow_c,v 1.3 2014/10/30 12:20:30 jasper Exp $
@


1.3
log
@add new sp_loginclass field to retrieve the user's login class

ok sebastia@@
@
text
@d1 1
a1 1
$OpenBSD$
d4 1
@


1.2
log
@bump to ruby-shadow-2.3.2
* no functional change as it just merges patches/ into a release
@
text
@d1 1
a1 1
$OpenBSD: patch-pwd_shadow_c,v 1.1 2013/12/13 07:50:53 jasper Exp $
d3 1
a3 4
From d8c613cdb17edf9628fa10569ba31562fae67fcf Mon Sep 17 00:00:00 2001
From: Adam Palmblad <adam.palmblad@@teampages.com>
Date: Fri, 15 Nov 2013 09:46:05 -0800
Subject: [PATCH] Attempt to resolve BSD make issues.
d5 9
a13 4
--- pwd/shadow.c.orig	Thu Jan  1 01:00:00 1970
+++ pwd/shadow.c	Thu Dec 12 21:41:53 2013
@@@@ -17,8 +17,8 @@@@
 #define PWTYPE  struct passwd
d15 10
a24 8
 #include "ruby.h"
-#ifdef RUBY19
-#include <ruby/io.h>
+#ifdef HAVE_RUBY_IO_H
+#include "ruby/io.h"
 #else
 #include "rubyio.h"
 #endif
@


1.1
log
@Initial revision
@
text
@d1 1
a1 1
$OpenBSD$
@


1.1.1.1
log
@import ruby-shadow-2.3.1

This module provides access to shadow passwords on Linux, OSX, FreeBSD,
OpenBSD and Solaris.

ok aja@@
@
text
@@
