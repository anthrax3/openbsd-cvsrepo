head	1.5;
access;
symbols
	jasper_20131312:1.1.1.1 jasper:1.1.1;
locks; strict;
comment	@# @;


1.5
date	2014.12.01.19.30.19;	author jasper;	state dead;
branches;
next	1.4;
commitid	QluVtAqXWeVahALx;

1.4
date	2014.10.30.14.10.07;	author jasper;	state Exp;
branches;
next	1.3;
commitid	dx46xwDFOedjV2GW;

1.3
date	2014.10.30.12.20.30;	author jasper;	state Exp;
branches;
next	1.2;
commitid	7jv1KV8tpIKFNhZu;

1.2
date	2013.12.18.22.10.09;	author jasper;	state dead;
branches;
next	1.1;

1.1
date	2013.12.13.07.50.53;	author jasper;	state Exp;
branches
	1.1.1.1;
next	;

1.1.1.1
date	2013.12.13.07.50.53;	author jasper;	state Exp;
branches;
next	;


desc
@@


1.5
log
@- update to 2.4.0
* the patches for loginclass have been merged upstream
@
text
@$OpenBSD: patch-shadow_shadow_c,v 1.4 2014/10/30 14:10:07 jasper Exp $

Add new sp_loginclass field to retrieve the user's login class.
https://github.com/apalmblad/ruby-shadow/pull/22

--- shadow/shadow.c.orig	Thu Oct 30 11:15:58 2014
+++ shadow/shadow.c	Thu Oct 30 11:26:38 2014
@@@@ -44,6 +44,7 @@@@ static VALUE convert_pw_struct( struct spwd *entry ) 
                       Qnil, /* used by BSD, pw_change, date when the password expires, in days since Jan 1, 1970 */
 		      INT2FIX(entry->sp_expire),
 		      INT2FIX(entry->sp_flag),
+		      rb_tainted_str_new2(entry->pw_class),
 		      NULL);
 };
 static VALUE
@@@@ -158,6 +159,7 @@@@ rb_shadow_putspent(VALUE self, VALUE entry, VALUE file
   centry.sp_inact = FIX2INT(val[6]);
   centry.sp_expire = FIX2INT(val[8]);
   centry.sp_flag = FIX2INT(val[9]);
+  centry.sp_loginclass = StringValuePtr(val[10]);
 
   result = putspent(&centry,cfile);
 
@@@@ -243,7 +245,9 @@@@ Init_shadow()
   rb_sPasswdEntry = rb_struct_define("PasswdEntry",
 				     "sp_namp","sp_pwdp","sp_lstchg",
 				     "sp_min","sp_max","sp_warn",
-				     "sp_inact", "pw_change", "sp_expire","sp_flag", NULL);
+				     "sp_inact", "pw_change",
+				     "sp_expire","sp_flag",
+				     "sp_loginclass", NULL);
   rb_sGroupEntry = rb_struct_define("GroupEntry",
 				    "sg_name","sg_passwd",
 				    "sg_adm","sg_mem",NULL);
@


1.4
log
@add link to upstream pr
@
text
@d1 1
a1 1
$OpenBSD: patch-shadow_shadow_c,v 1.3 2014/10/30 12:20:30 jasper Exp $
@


1.3
log
@add new sp_loginclass field to retrieve the user's login class

ok sebastia@@
@
text
@d1 1
a1 1
$OpenBSD$
d4 1
@


1.2
log
@bump to ruby-shadow-2.3.2
* no functional change as it just merges patches/ into a release
@
text
@d1 1
a1 1
$OpenBSD: patch-shadow_shadow_c,v 1.1 2013/12/13 07:50:53 jasper Exp $
d3 1
a3 4
From d8c613cdb17edf9628fa10569ba31562fae67fcf Mon Sep 17 00:00:00 2001
From: Adam Palmblad <adam.palmblad@@teampages.com>
Date: Fri, 15 Nov 2013 09:46:05 -0800
Subject: [PATCH] Attempt to resolve BSD make issues.
d5 15
a19 3
--- shadow/shadow.c.orig	Thu Jan  1 01:00:00 1970
+++ shadow/shadow.c	Thu Dec 12 21:41:53 2013
@@@@ -9,8 +9,8 @@@@
d21 13
a33 9
 #include <shadow.h>
 #include "ruby.h"
-#ifdef RUBY19
-#include <ruby/io.h>
+#ifdef HAVE_RUBY_IO_H
+#include "ruby/io.h"
 #else
 #include "rubyio.h"
 #endif
@


1.1
log
@Initial revision
@
text
@d1 1
a1 1
$OpenBSD$
@


1.1.1.1
log
@import ruby-shadow-2.3.1

This module provides access to shadow passwords on Linux, OSX, FreeBSD,
OpenBSD and Solaris.

ok aja@@
@
text
@@
