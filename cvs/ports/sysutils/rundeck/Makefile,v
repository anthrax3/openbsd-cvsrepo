head	1.10;
access;
symbols
	OPENBSD_6_1:1.8.0.2
	OPENBSD_6_1_BASE:1.8
	jasper_20161010:1.1.1.1
	jasper:1.1.1;
locks; strict;
comment	@# @;


1.10
date	2017.05.27.13.55.59;	author ajacoutot;	state Exp;
branches;
next	1.9;
commitid	SykG6k6P85X3Gc2i;

1.9
date	2017.04.21.13.27.47;	author kurt;	state Exp;
branches;
next	1.8;
commitid	lfz5IYSiUvvvq1Ub;

1.8
date	2017.01.24.20.40.06;	author sthen;	state Exp;
branches;
next	1.7;
commitid	ugykf8OWBN4rj0kN;

1.7
date	2016.11.21.20.05.28;	author jasper;	state Exp;
branches;
next	1.6;
commitid	ZSfzyC89NzKGkypc;

1.6
date	2016.11.13.18.44.20;	author jasper;	state Exp;
branches;
next	1.5;
commitid	eUD6rcLuQtkKB9vb;

1.5
date	2016.10.11.17.05.33;	author jasper;	state Exp;
branches;
next	1.4;
commitid	OpXQHLfAItwWAXzz;

1.4
date	2016.10.11.05.53.55;	author jasper;	state Exp;
branches;
next	1.3;
commitid	J83CgFTGBETE1f88;

1.3
date	2016.10.11.05.52.45;	author jasper;	state Exp;
branches;
next	1.2;
commitid	Pm3LZ9P0WnpMe5cA;

1.2
date	2016.10.10.20.10.56;	author jasper;	state Exp;
branches;
next	1.1;
commitid	d5vq976bCSruMWkw;

1.1
date	2016.10.10.17.19.47;	author jasper;	state Exp;
branches
	1.1.1.1;
next	;
commitid	o25YbYCyNCdaPsWC;

1.1.1.1
date	2016.10.10.17.19.47;	author jasper;	state Exp;
branches;
next	;
commitid	o25YbYCyNCdaPsWC;


desc
@@


1.10
log
@I forgot the bump commit...
@
text
@# $OpenBSD: Makefile,v 1.9 2017/04/21 13:27:47 kurt Exp $

COMMENT=		job scheduler and runbook automation

V=			2.6.11
DISTNAME=		rundeck-launcher-${V}
PKGNAME=		rundeck-${V}
REVISION=		1

CATEGORIES=		sysutils

HOMEPAGE=		http://rundeck.org/

MAINTAINER=		Jasper Lievisse Adriaanse <jasper@@openbsd.org>

# Apache 2.0
PERMIT_PACKAGE_CDROM=	Yes

MASTER_SITES=		http://download.rundeck.org/jar/
EXTRACT_SUFX=		.jar
EXTRACT_ONLY=		# empty

MODULES=		java
MODJAVA_VER=		1.7+
MODJAVA_JRERUN=		Yes

RUN_DEPENDS=		java/javaPathHelper

NO_TEST=		Yes
PKG_ARCH=		*

WRKDIST=		${WRKDIR}/rundeck-${V}

PREFIX =		${VARBASE}
RDECK_BASE =		${PREFIX}/rundeck
SUBST_VARS +=		RDECK_BASE

CONFIG_FILES =		server/exp/webapp/WEB-INF/classes/log4j.properties \
			server/config/rundeck-config.properties \
			server/config/jaas-loginmodule.conf
TOOLS =			dispatch rd-acl rd-jobs rd-project rd-queue \
			rd-setup run

do-extract:
	mkdir -p ${WRKDIST}
	cd ${WRKSRC} && \
		${JAVA_HOME}/bin/java -jar ${FULLDISTDIR}/${DISTNAME}${EXTRACT_SUFX} \
		--installonly -b .

do-build:
	sed -i -e "s,^grails.serverURL=.*,grails.serverURL=http://localhost:4440," \
		-e "s,^rdeck.base=.*,rdeck.base=${PREFIX}/rundeck," \
		${WRKSRC}/server/config/rundeck-config.properties
.for c in ${CONFIG_FILES}
	sed -i "s,$$(readlink -f ${WRKDIST}),${PREFIX}/rundeck,g" ${WRKSRC}/$c
.endfor
.for t in ${TOOLS}
	sed -i 's,^#!/bin/bash,#!/bin/sh,' ${WRKSRC}/tools/bin/$t
.endfor

# First we install the modified configuration files and scripts. These files
# are not overwritten when the jar unpacks itself into ${RDECK_BASE}
do-install:
	${INSTALL_DATA_DIR} ${RDECK_BASE}/{etc/,tools/bin}
.for c in ${CONFIG_FILES}
	${INSTALL_DATA_DIR} ${RDECK_BASE}/$$(dirname ${c})
	${INSTALL_DATA} ${WRKSRC}/$c ${RDECK_BASE}/$c
.endfor
.for t in ${TOOLS}
	${INSTALL_SCRIPT} ${WRKSRC}/tools/bin/$t ${RDECK_BASE}/tools/bin/
.endfor
	for f in ${FILESDIR}/*; do \
		if [ -f $$f ]; then \
			${SUBST_CMD} -m ${SHAREMODE} -c $$f \
				${RDECK_BASE}/etc/$$(basename $$f).dist; \
		fi; \
	done
	${INSTALL_DATA} ${DISTDIR}/${DISTNAME}${EXTRACT_SUFX} \
		${RDECK_BASE}/rundeck-launcher.jar

.include <bsd.port.mk>
@


1.9
log
@- disconnect devel/jdk/1.7 from the build
- adjust java.port.mk so all 1.7 and lower ports now build with 1.8
- bump revision on affected ports
okay sthen@@, ian@@, landry@@
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.8 2017/01/24 20:40:06 sthen Exp $
d8 1
a8 1
REVISION=		0
@


1.8
log
@don't fail to build if the directory already exists.
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.7 2016/11/21 20:05:28 jasper Exp $
d8 1
@


1.7
log
@update to rundeck-2.6.11
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.6 2016/11/13 18:44:20 jasper Exp $
d44 1
a44 1
	mkdir ${WRKDIST}
@


1.6
log
@update to rundeck-2.6.10
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.5 2016/10/11 17:05:33 jasper Exp $
d5 1
a5 1
V=			2.6.10
@


1.5
log
@drop NO_BUILD and "fake" a do-build target so we have JAVA_HOME and actually
have a BDEP on jdk.

spotted by naddy@@ and nigel@@
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.4 2016/10/11 05:53:55 jasper Exp $
d5 1
a5 1
V=			2.6.9
a6 1
REVISION=		1
@


1.4
log
@@@sample log4j-properties file as cli-log4j-properties, which is used by the
tools scripts.
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.3 2016/10/11 05:52:45 jasper Exp $
a28 1
NO_BUILD=		Yes
d47 1
a47 1
		${LOCALBASE}/jdk-1.7.0/bin/java -jar ${FULLDISTDIR}/${DISTNAME}${EXTRACT_SUFX} \
d50 1
a50 1
do-configure:
@


1.3
log
@- adjust hashbang line for toolsscripts
- split do-extract into two targets, one that actually extracts and one that
  only substitutes (do-configure)
- don't install ${FILESDIR}/CVS/

ok aja@@
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.2 2016/10/10 20:10:56 jasper Exp $
d7 1
a7 1
REVISION=		0
@


1.2
log
@use working master site; spotted by naddy@@
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.1.1.1 2016/10/10 17:19:47 jasper Exp $
d7 1
d42 2
d50 2
d58 3
d62 2
a63 2
# First we install the modified configuration files. These files are not
# overwritten when the jar unpacks itself into ${RDECK_BASE}
d65 1
a65 1
	${INSTALL_DATA_DIR} ${RDECK_BASE}/etc/
d70 3
d74 4
a77 2
		${SUBST_CMD} -m ${SHAREMODE} -c $$f \
			${RDECK_BASE}/etc/$$(basename $$f).dist; \
@


1.1
log
@Initial revision
@
text
@d1 1
a1 1
# $OpenBSD$
d18 1
a18 1
MASTER_SITES=		http://dl.bintray.com/rundeck/rundeck-maven/
@


1.1.1.1
log
@import rundeck-2.6.9

Job scheduler and runbook automation. Enable self-service access to
existing scripts and tools.

joint work with/OK aja@@
@
text
@@
