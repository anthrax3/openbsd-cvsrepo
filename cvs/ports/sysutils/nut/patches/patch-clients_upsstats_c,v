head	1.8;
access;
symbols
	OPENBSD_6_1:1.8.0.28
	OPENBSD_6_1_BASE:1.8
	OPENBSD_6_0:1.8.0.26
	OPENBSD_6_0_BASE:1.8
	OPENBSD_5_9:1.8.0.22
	OPENBSD_5_9_BASE:1.8
	OPENBSD_5_8:1.8.0.24
	OPENBSD_5_8_BASE:1.8
	OPENBSD_5_7:1.8.0.20
	OPENBSD_5_7_BASE:1.8
	OPENBSD_5_6:1.8.0.18
	OPENBSD_5_6_BASE:1.8
	OPENBSD_5_5:1.8.0.16
	OPENBSD_5_5_BASE:1.8
	OPENBSD_5_4:1.8.0.14
	OPENBSD_5_4_BASE:1.8
	OPENBSD_5_3:1.8.0.12
	OPENBSD_5_3_BASE:1.8
	OPENBSD_5_2:1.8.0.10
	OPENBSD_5_2_BASE:1.8
	OPENBSD_5_1_BASE:1.8
	OPENBSD_5_1:1.8.0.8
	OPENBSD_5_0:1.8.0.6
	OPENBSD_5_0_BASE:1.8
	OPENBSD_4_9:1.8.0.4
	OPENBSD_4_9_BASE:1.8
	OPENBSD_4_8:1.8.0.2
	OPENBSD_4_8_BASE:1.8
	OPENBSD_4_7:1.7.0.4
	OPENBSD_4_7_BASE:1.7
	OPENBSD_4_6:1.7.0.2
	OPENBSD_4_6_BASE:1.7
	OPENBSD_4_5:1.6.0.2
	OPENBSD_4_5_BASE:1.6
	OPENBSD_4_4:1.5.0.4
	OPENBSD_4_4_BASE:1.5
	OPENBSD_4_3:1.5.0.2
	OPENBSD_4_3_BASE:1.5
	OPENBSD_4_2:1.4.0.2
	OPENBSD_4_2_BASE:1.4
	OPENBSD_4_1:1.3.0.10
	OPENBSD_4_1_BASE:1.3
	OPENBSD_4_0:1.3.0.8
	OPENBSD_4_0_BASE:1.3
	OPENBSD_3_9:1.3.0.6
	OPENBSD_3_9_BASE:1.3
	OPENBSD_3_8:1.3.0.4
	OPENBSD_3_8_BASE:1.3
	OPENBSD_3_7:1.3.0.2
	OPENBSD_3_7_BASE:1.3
	OPENBSD_3_6:1.2.0.4
	OPENBSD_3_6_BASE:1.2
	OPENBSD_3_5:1.2.0.2
	OPENBSD_3_5_BASE:1.2
	OPENBSD_3_4:1.1.0.4
	OPENBSD_3_4_BASE:1.1
	OPENBSD_3_3:1.1.0.2
	OPENBSD_3_3_BASE:1.1;
locks; strict;
comment	@# @;


1.8
date	2010.03.31.22.11.11;	author sthen;	state Exp;
branches;
next	1.7;

1.7
date	2009.04.03.15.40.12;	author sthen;	state Exp;
branches;
next	1.6;

1.6
date	2008.09.08.19.38.30;	author martynas;	state Exp;
branches;
next	1.5;

1.5
date	2008.01.30.20.55.59;	author mbalmer;	state Exp;
branches;
next	1.4;

1.4
date	2007.05.18.12.22.46;	author henning;	state Exp;
branches;
next	1.3;

1.3
date	2004.09.27.03.10.24;	author marcm;	state Exp;
branches;
next	1.2;

1.2
date	2004.02.09.06.48.48;	author marcm;	state Exp;
branches;
next	1.1;

1.1
date	2003.01.16.23.42.18;	author marcm;	state Exp;
branches;
next	;


desc
@@


1.8
log
@update to 2.4.3, tested by Denny White and Aaron Stellman

note that with USB UPS, you may have to allow permissions on
further ugen subdevices (e.g. ugen0.01 as well as ugen0.00).
@
text
@$OpenBSD: patch-clients_upsstats_c,v 1.7 2009/04/03 15:40:12 sthen Exp $
--- clients/upsstats.c.orig	Thu Feb 11 21:43:13 2010
+++ clients/upsstats.c	Sat Mar 20 23:18:11 2010
@@@@ -844,7 +844,7 @@@@ static void display_template(const char *tfn)
 {
 	char	fn[SMALLBUF], buf[LARGEBUF];	
 
-	snprintf(fn, sizeof(fn), "%s/%s", confpath(), tfn);
+	snprintf(fn, sizeof(fn), "%s/%s", cgiconfpath(), tfn);
 
 	tf = fopen(fn, "r");
 
@@@@ -964,7 +964,7 @@@@ static void load_hosts_conf(void)
 	char	fn[SMALLBUF];
 	PCONF_CTX_t	ctx;
 
-	snprintf(fn, sizeof(fn), "%s/hosts.conf", CONFPATH);
+	snprintf(fn, sizeof(fn), "%s/hosts.conf", cgiconfpath());
 
 	pconf_init(&ctx, upsstats_hosts_err);
 
@


1.7
log
@update to 2.4.1, code cleanup and adds support for a bunch of new
UPS and also now preliminary support for PDUs.

ok mbalmer (maintainer),
"commit and we fix in-tree if i run into issues" henning
@
text
@d1 4
a4 4
$OpenBSD: patch-clients_upsstats_c,v 1.6 2008/09/08 19:38:30 martynas Exp $
--- clients/upsstats.c.orig	Tue Feb 17 09:20:43 2009
+++ clients/upsstats.c	Wed Mar 18 21:27:43 2009
@@@@ -835,7 +835,7 @@@@ static void display_template(const char *tfn)
d13 1
a13 1
@@@@ -955,7 +955,7 @@@@ static void load_hosts_conf(void)
@


1.6
log
@update to nut-2.2.2, which contains the old agiler driver from 2.2.0
(now called agiler-old)
upses such as the below can now work again:
{0x0665, 0x5161, &agiler_old_subdriver},        /* Belkin F6C1200-UNV */
{0x06da, 0x0003, &agiler_old_subdriver},        /* Mustek Powermust */
{0x0f03, 0x0001, &agiler_old_subdriver},        /* Unitek Alpha 1200Sx *
ok sthen@@
@
text
@d1 4
a4 4
$OpenBSD: patch-clients_upsstats_c,v 1.5 2008/01/30 20:55:59 mbalmer Exp $
--- clients/upsstats.c.orig	Fri Feb 22 21:21:11 2008
+++ clients/upsstats.c	Wed Aug 27 17:18:49 2008
@@@@ -825,7 +825,7 @@@@ static void display_template(const char *tfn)
d13 1
a13 1
@@@@ -957,7 +957,7 @@@@ static void load_hosts_conf(void)
@


1.5
log
@Update to nut ver. 2.2.1.

requested by and ok henning
@
text
@d1 4
a4 4
$OpenBSD: patch-clients_upsstats_c,v 1.4 2007/05/18 12:22:46 henning Exp $
--- clients/upsstats.c.orig	Sat May 26 16:24:26 2007
+++ clients/upsstats.c	Wed Aug  1 12:59:05 2007
@@@@ -824,7 +824,7 @@@@ static void display_template(const char *tfn)
d13 1
a13 1
@@@@ -956,7 +956,7 @@@@ static void load_hosts_conf(void)
@


1.4
log
@update to 2.0.5 + a fix to make bcmxcp work correctly again
partially from and ok mbalmer
@
text
@d1 4
a4 4
$OpenBSD: patch-clients_upsstats_c,v 1.3 2004/09/27 03:10:24 marcm Exp $
--- clients/upsstats.c.orig	Wed Nov  8 03:08:45 2006
+++ clients/upsstats.c	Fri May 18 13:54:23 2007
@@@@ -830,7 +830,7 @@@@ static void display_template(const char *tfn)
d13 1
a13 1
@@@@ -970,7 +970,7 @@@@ static void load_hosts_conf(void)
d15 1
a15 1
 	PCONF_CTX	ctx;
@


1.3
log
@Update to the 2.0 tree of Nut.

This is a feature release so if you're upgrading, take a look at the
release notes here:

http://random.networkupstools.org/source/2.0/new-2.0.0.txt
@
text
@d1 4
a4 4
$OpenBSD: patch-clients_upsstats_c,v 1.2 2004/02/09 06:48:48 marcm Exp $
--- clients/upsstats.c.orig	Mon Sep 29 21:50:10 2003
+++ clients/upsstats.c	Thu Sep 16 08:48:42 2004
@@@@ -658,7 +658,7 @@@@ static void display_template(const char 
d13 1
a13 1
@@@@ -715,7 +715,7 @@@@ static void load_hosts_conf(void)
@


1.2
log
@Update to 1.4.1.

In addition to the standard bugfixes, this is a major port rewrite.
The port now uses a '_ups' user and the CGIs created can now run under
either chrooted Apache or non-chrooted Apache.
@
text
@d1 4
a4 4
$OpenBSD$
--- clients/upsstats.c.orig	2004-01-03 14:54:09.000000000 -0800
+++ clients/upsstats.c	2004-01-03 14:54:42.000000000 -0800
@@@@ -621,7 +621,7 @@@@ static void display_template(const char 
d13 1
a13 1
@@@@ -678,7 +678,7 @@@@ static void load_hosts_conf(void)
@


1.1
log
@Update to 1.2.1, a substantial update from 1.0.0.

Changes are listed here:
http://www.exploits.org/nut/release/1.2/new-1.2.1.txt

ok sturm@@
@
text
@d2 3
a4 3
--- clients/upsstats.c.orig	Tue Oct 29 07:12:42 2002
+++ clients/upsstats.c	Sun Dec 29 18:10:20 2002
@@@@ -594,7 +594,7 @@@@ static void display_template(const char 
d8 2
a9 2
-	snprintf(fn, sizeof(fn), "%s/%s", CONFPATH, tfn);
+	snprintf(fn, sizeof(fn), "%s/%s", CGICONFPATH, tfn);
d13 1
a13 2
@@@@ -670,7 +670,7 @@@@ static void load_hosts_conf(void)
 {
d15 1
d18 3
a20 3
+	snprintf(fn, sizeof(fn), "%s/hosts.conf", CGICONFPATH);
 	parseconf(fn, hosts_conf_args, hosts_conf_error);
 }
@

