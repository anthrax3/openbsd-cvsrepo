head	1.2;
access;
symbols
	OPENBSD_5_7:1.1.0.2
	OPENBSD_5_7_BASE:1.1;
locks; strict;
comment	@# @;


1.2
date	2015.06.03.17.34.49;	author ajacoutot;	state dead;
branches;
next	1.1;
commitid	5H1aumINNHrFfH4z;

1.1
date	2015.01.04.16.16.53;	author matthieu;	state Exp;
branches;
next	;
commitid	qaOhQeVO0Ju0Pkcf;


desc
@@


1.2
log
@Update to deja-dup-34.0.
@
text
@$OpenBSD: patch-libdeja_tools_duplicity_DuplicityPlugin_vala,v 1.1 2015/01/04 16:16:53 matthieu Exp $

Fix from dejadup upstreams for duplicity version parsing
http://bazaar.launchpad.net/~deja-dup-hackers/deja-dup/34/revision/1543/libdeja/tools/duplicity/DuplicityPlugin.vala

--- libdeja/tools/duplicity/DuplicityPlugin.vala.orig	Fri Jan 24 17:07:35 2014
+++ libdeja/tools/duplicity/DuplicityPlugin.vala	Sat Jan  3 22:58:43 2015
@@@@ -35,13 +35,17 @@@@
   {
     string output;
     Process.spawn_command_line_sync("duplicity --version", out output, null, null);
+    var tokens = output.split(" ");
 
-    var tokens = output.split(" ", 2);
-    if (tokens == null || tokens[0] == null || tokens[1] == null)
+    if (tokens == null || tokens.length < 2 )
       throw new SpawnError.FAILED(_("Could not understand duplicity version."));
 
-    // First token is 'duplicity' and is ignorable.  Second looks like '0.5.03'
-    var version_string = tokens[1].strip();
+    // in version 0.6.25, the output fro duplicity --version changed and the string
+    // "duplicity major.minor.micro" is not preceded by a deprecation warning
+    // as a consequence, the substring "major.minor.micro" is now
+    // always the penultimate token (the last one always being null)
+
+    var version_string = tokens[tokens.length - 1].strip();
     int major, minor, micro;
     if (!DejaDup.parse_version(version_string, out major, out minor, out micro))
       throw new SpawnError.FAILED(_("Could not understand duplicity version ‘%s’.").printf(version_string));
@


1.1
log
@Add patch from Adrien Bak to handle newer duplicity --version format.
ok ajacoutot@@, brad@@
@
text
@d1 1
a1 1
$OpenBSD$
@

