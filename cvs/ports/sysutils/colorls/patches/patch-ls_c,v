head	1.17;
access;
symbols
	OPENBSD_6_1:1.17.0.2
	OPENBSD_6_1_BASE:1.17
	OPENBSD_6_0:1.16.0.2
	OPENBSD_6_0_BASE:1.16
	OPENBSD_5_9:1.15.0.2
	OPENBSD_5_9_BASE:1.15
	OPENBSD_5_8:1.14.0.4
	OPENBSD_5_8_BASE:1.14
	OPENBSD_5_7:1.13.0.14
	OPENBSD_5_7_BASE:1.13
	OPENBSD_5_6:1.13.0.12
	OPENBSD_5_6_BASE:1.13
	OPENBSD_5_5:1.13.0.10
	OPENBSD_5_5_BASE:1.13
	OPENBSD_5_4:1.13.0.8
	OPENBSD_5_4_BASE:1.13
	OPENBSD_5_3:1.13.0.6
	OPENBSD_5_3_BASE:1.13
	OPENBSD_5_2:1.13.0.4
	OPENBSD_5_2_BASE:1.13
	OPENBSD_5_1_BASE:1.13
	OPENBSD_5_1:1.13.0.2
	OPENBSD_5_0:1.11.0.8
	OPENBSD_5_0_BASE:1.11
	OPENBSD_4_9:1.11.0.6
	OPENBSD_4_9_BASE:1.11
	OPENBSD_4_8:1.11.0.4
	OPENBSD_4_8_BASE:1.11
	OPENBSD_4_7:1.11.0.2
	OPENBSD_4_7_BASE:1.11
	OPENBSD_4_6:1.10.0.4
	OPENBSD_4_6_BASE:1.10
	OPENBSD_4_5:1.10.0.2
	OPENBSD_4_5_BASE:1.10
	OPENBSD_4_4:1.9.0.6
	OPENBSD_4_4_BASE:1.9
	OPENBSD_4_3:1.9.0.4
	OPENBSD_4_3_BASE:1.9
	OPENBSD_4_2:1.9.0.2
	OPENBSD_4_2_BASE:1.9
	OPENBSD_4_1:1.8.0.4
	OPENBSD_4_1_BASE:1.8
	OPENBSD_4_0:1.8.0.2
	OPENBSD_4_0_BASE:1.8
	OPENBSD_3_9:1.7.0.4
	OPENBSD_3_9_BASE:1.7
	OPENBSD_3_8:1.7.0.2
	OPENBSD_3_8_BASE:1.7
	OPENBSD_3_7:1.6.0.2
	OPENBSD_3_7_BASE:1.6
	OPENBSD_3_6:1.5.0.2
	OPENBSD_3_6_BASE:1.5
	OPENBSD_3_5:1.4.0.4
	OPENBSD_3_5_BASE:1.4
	OPENBSD_3_4:1.4.0.2
	OPENBSD_3_4_BASE:1.4
	OPENBSD_3_3:1.3.0.2
	OPENBSD_3_3_BASE:1.3
	OPENBSD_3_2:1.2.0.4
	OPENBSD_3_2_BASE:1.2
	OPENBSD_3_1:1.2.0.2
	OPENBSD_3_1_BASE:1.2
	naddy_20011105:1.1.1.1
	naddy:1.1.1;
locks; strict;
comment	@# @;


1.17
date	2016.08.05.19.52.19;	author naddy;	state Exp;
branches;
next	1.16;
commitid	IjFvjijjenYDa3ra;

1.16
date	2016.04.06.18.53.16;	author naddy;	state Exp;
branches;
next	1.15;
commitid	iZKQK6rYc9TPfgx3;

1.15
date	2015.10.30.14.12.42;	author bentley;	state Exp;
branches;
next	1.14;
commitid	ter5pKuw1bz400Js;

1.14
date	2015.06.18.20.43.01;	author naddy;	state Exp;
branches;
next	1.13;
commitid	fNbRFFWBIaPNKPp3;

1.13
date	2011.11.12.12.31.21;	author naddy;	state Exp;
branches;
next	1.12;

1.12
date	2011.09.22.08.28.56;	author stsp;	state Exp;
branches;
next	1.11;

1.11
date	2009.10.29.20.10.39;	author naddy;	state Exp;
branches;
next	1.10;

1.10
date	2009.02.14.16.39.28;	author naddy;	state Exp;
branches;
next	1.9;

1.9
date	2007.08.11.17.52.11;	author naddy;	state Exp;
branches;
next	1.8;

1.8
date	2006.05.27.04.35.21;	author naddy;	state Exp;
branches;
next	1.7;

1.7
date	2005.06.21.18.26.21;	author naddy;	state Exp;
branches;
next	1.6;

1.6
date	2005.02.27.17.37.46;	author naddy;	state Exp;
branches;
next	1.5;

1.5
date	2004.05.28.22.03.49;	author naddy;	state Exp;
branches;
next	1.4;

1.4
date	2003.08.27.00.41.51;	author naddy;	state Exp;
branches;
next	1.3;

1.3
date	2003.01.20.01.45.14;	author naddy;	state Exp;
branches;
next	1.2;

1.2
date	2002.01.23.01.27.32;	author naddy;	state Exp;
branches;
next	1.1;

1.1
date	2001.11.05.18.55.28;	author naddy;	state Exp;
branches
	1.1.1.1;
next	;

1.1.1.1
date	2001.11.05.18.55.28;	author naddy;	state Exp;
branches;
next	;


desc
@@


1.17
log
@sync with OpenBSD 6.0
@
text
@$OpenBSD: patch-ls_c,v 1.16 2016/04/06 18:53:16 naddy Exp $
--- ls.c.orig	Fri Aug  5 21:32:46 2016
+++ ls.c	Fri Aug  5 21:41:30 2016
@@@@ -50,6 +50,10 @@@@
 #include <limits.h>
 #include <locale.h>
 #include <util.h>
+#ifdef COLORLS
+#include <termcap.h>
+#include <signal.h>
+#endif
 
 #include "ls.h"
 #include "extern.h"
@@@@ -92,6 +96,15 @@@@ int f_statustime;		/* use time of last mode change */
 int f_stream;			/* stream format */
 int f_type;			/* add type character for non-regular files */
 int f_typedir;			/* add type character for directories */
+#ifdef COLORLS
+int f_color;			/* add type in color for non-regular files */
+ 
+char *ansi_bgcol;		/* ANSI sequence to set background color */
+char *ansi_fgcol;		/* ANSI sequence to set foreground color */
+char *ansi_coloff;		/* ANSI sequence to reset colors */
+char *attrs_off;		/* ANSI sequence to turn off attributes */
+char *enter_bold;		/* ANSI sequence to set color to bold mode */
+#endif
 
 int rval;
 
@@@@ -103,6 +116,11 @@@@ ls_main(int argc, char *argv[])
 	int ch, fts_options, notused;
 	int kflag = 0;
 	char *p;
+#ifdef COLORLS
+	char termcapbuf[1024];	/* termcap definition buffer */
+	char tcapbuf[512];	/* capability buffer */
+	char *bp = tcapbuf;
+#endif
 
 #ifndef SMALL
 	setlocale(LC_CTYPE, "");
@@@@ -124,7 +142,11 @@@@ ls_main(int argc, char *argv[])
 	if (termwidth == 0)
 		termwidth = 80;
 
+#ifdef COLORLS
+	if (pledge("stdio rpath getpw tty", NULL) == -1)
+#else
 	if (pledge("stdio rpath getpw", NULL) == -1)
+#endif
 		err(1, "pledge");
 
 	/* Root is -A automatically. */
@@@@ -132,7 +154,7 @@@@ ls_main(int argc, char *argv[])
 		f_listdot = 1;
 
 	fts_options = FTS_PHYSICAL;
-	while ((ch = getopt(argc, argv, "1ACFHLRSTacdfghiklmnopqrstux")) != -1) {
+	while ((ch = getopt(argc, argv, "1ACFGHLRSTacdfghiklmnopqrstux")) != -1) {
 		switch (ch) {
 		/*
 		 * The -1, -C and -l, -m, -n and -x options all override each
@@@@ -186,6 +208,9 @@@@ ls_main(int argc, char *argv[])
 		case 'F':
 			f_type = 1;
 			break;
+		case 'G':
+			setenv("CLICOLOR", "", 1);
+			break;
 		case 'H':
 			fts_options |= FTS_COMFOLLOW;
 			break;
@@@@ -258,19 +283,59 @@@@ ls_main(int argc, char *argv[])
 	if (f_grouponly == -1)
 		f_grouponly = 0;
 
+	/* Enabling of colours is conditional on the environment. */
+	if (getenv("CLICOLOR") &&
+	    (isatty(STDOUT_FILENO) || getenv("CLICOLOR_FORCE")))
+#ifdef COLORLS
+		if (tgetent(termcapbuf, getenv("TERM")) == 1) {
+			ansi_fgcol = tgetstr("AF", &bp);
+			ansi_bgcol = tgetstr("AB", &bp);
+			attrs_off = tgetstr("me", &bp);
+			enter_bold = tgetstr("md", &bp);
+
+			/* To switch colours off use 'op' if
+			 * available, otherwise use 'oc', or
+			 * don't do colours at all. */
+			ansi_coloff = tgetstr("op", &bp);
+			if (!ansi_coloff)
+				ansi_coloff = tgetstr("oc", &bp);
+			if (ansi_fgcol && ansi_bgcol && ansi_coloff)
+				f_color = 1;
+		}
+#else
+		warnx("color support not compiled in");
+#endif /*COLORLS*/
+ 
+#ifdef COLORLS
+	if (f_color) {
+		(void)signal(SIGINT, colorquit);
+		(void)signal(SIGQUIT, colorquit);
+		parsecolors(getenv("LSCOLORS"));
+	}
+#endif
+
 	/*
 	 * If not -F, -i, -l, -p, -S, -s or -t options, don't require stat
-	 * information.
+	 * information, unless in color mode in which case we do
+	 * need this to determine which colors to display.
 	 */
 	if (!f_longform && !f_inode && !f_size && !f_type && !f_typedir &&
+#ifdef COLORLS
+	    !f_color &&
+#endif
 	    sortkey == BY_NAME)
 		fts_options |= FTS_NOSTAT;
 
 	/*
 	 * If not -F, -d or -l options, follow any symbolic links listed on
-	 * the command line.
+	 * the command line, unless in color mode in which case we need to
+	 * distinguish file type for a symbolic link itself and its target.
 	 */
-	if (!f_longform && !f_listdir && !f_type)
+	if (!f_longform && !f_listdir && !f_type
+#ifdef COLORLS
+	    && !f_color
+#endif
+	    )
 		fts_options |= FTS_COMFOLLOW;
 
 	/* If -l or -s, figure out block size. */
@


1.16
log
@Update to 5.9, which has pledge(2) and UTF-8 improvements.
From Lauri Tirkkonen <lotheac@@iki.fi>.
@
text
@d1 3
a3 3
$OpenBSD: patch-ls_c,v 1.15 2015/10/30 14:12:42 bentley Exp $
--- ls.c.orig	Tue Dec  1 19:36:13 2015
+++ ls.c	Wed Apr  6 20:33:39 2016
d33 1
a33 1
 	int kflag = 0, width = 0;
d43 3
a45 3
@@@@ -128,7 +146,11 @@@@ ls_main(int argc, char *argv[])
 			termwidth = width;
 	}
d55 1
a55 1
@@@@ -136,7 +158,7 @@@@ ls_main(int argc, char *argv[])
d64 1
a64 1
@@@@ -190,6 +212,9 @@@@ ls_main(int argc, char *argv[])
d74 1
a74 1
@@@@ -262,19 +287,59 @@@@ ls_main(int argc, char *argv[])
@


1.15
log
@Calculate Unicode column widths correctly.

ok naddy@@ (maintainer)
@
text
@d1 6
a6 13
$OpenBSD: patch-ls_c,v 1.14 2015/06/18 20:43:01 naddy Exp $
--- ls.c.orig	Mon Mar 31 14:54:37 2014
+++ ls.c	Thu Oct 29 01:00:04 2015
@@@@ -42,12 +42,17 @@@@
 #include <errno.h>
 #include <fts.h>
 #include <grp.h>
+#include <locale.h>
 #include <pwd.h>
 #include <stdio.h>
 #include <stdlib.h>
 #include <string.h>
 #include <unistd.h>
d15 1
a15 1
@@@@ -90,6 +95,15 @@@@ int f_statustime;		/* use time of last mode change */
d31 1
a31 1
@@@@ -101,7 +115,14 @@@@ ls_main(int argc, char *argv[])
d33 1
a33 1
 	int kflag = 0;
d41 15
a55 6
+	setlocale(LC_CTYPE, "");
+
 	/* Terminal defaults to -Cq, non-terminal defaults to -1. */
 	if (isatty(STDOUT_FILENO)) {
 		if ((p = getenv("COLUMNS")) != NULL)
@@@@ -122,7 +143,7 @@@@ ls_main(int argc, char *argv[])
d64 1
a64 1
@@@@ -176,6 +197,9 @@@@ ls_main(int argc, char *argv[])
d74 1
a74 1
@@@@ -248,19 +272,59 @@@@ ls_main(int argc, char *argv[])
a136 11
@@@@ -463,8 +527,8 @@@@ display(FTSENT *p, FTSENT *list)
 				continue;
 			}
 		}
-		if (cur->fts_namelen > maxlen)
-			maxlen = cur->fts_namelen;
+		if (strwidth(cur->fts_name) > maxlen)
+			maxlen = strwidth(cur->fts_name);
 		if (needstats) {
 			sp = cur->fts_statp;
 			if (sp->st_blocks > maxblock)
@


1.14
log
@Sync with FreeBSD: When doing "ls -G /path/to/symlink", use the symlink
color instead of the color of the link target.
@
text
@d1 3
a3 3
$OpenBSD: patch-ls_c,v 1.13 2011/11/12 12:31:21 naddy Exp $
--- ls.c.orig	Mon Mar 31 22:54:37 2014
+++ ls.c	Thu Jun 18 22:35:05 2015
d135 11
@


1.13
log
@sync with OPENBSD_5_0 (-H switch)
@
text
@d1 3
a3 3
$OpenBSD: patch-ls_c,v 1.12 2011/09/22 08:28:56 stsp Exp $
--- ls.c.orig	Fri Mar  4 22:03:19 2011
+++ ls.c	Sat Nov 12 13:17:42 2011
d72 1
a72 1
@@@@ -248,11 +272,46 @@@@ ls_main(int argc, char *argv[])
d120 15
@


1.12
log
@Add support for displaying multi-byte filenames to colorls.
ok naddy
@
text
@d1 3
a3 3
$OpenBSD: patch-ls_c,v 1.11 2009/10/29 20:10:39 naddy Exp $
--- ls.c.orig	Tue Oct 19 16:28:14 2010
+++ ls.c	Thu Sep 22 09:41:24 2011
d57 2
a58 2
-	while ((ch = getopt(argc, argv, "1ACFLRSTacdfghiklmnopqrstux")) != -1) {
+	while ((ch = getopt(argc, argv, "1ACFGLRSTacdfghiklmnopqrstux")) != -1) {
d69 4
a72 4
 		case 'L':
 			fts_options &= ~FTS_PHYSICAL;
 			fts_options |= FTS_LOGICAL;
@@@@ -245,11 +269,46 @@@@ ls_main(int argc, char *argv[])
@


1.11
log
@sync with 4.6 and drop mention of xterm-xfree86
@
text
@d1 11
a11 4
$OpenBSD: patch-ls_c,v 1.10 2009/02/14 16:39:28 naddy Exp $
--- ls.c.orig	Wed Oct 28 00:59:21 2009
+++ ls.c	Thu Oct 29 20:21:13 2009
@@@@ -48,6 +48,10 @@@@
d22 1
a22 1
@@@@ -90,6 +94,15 @@@@ int f_statustime;		/* use time of last mode change */
d38 1
a38 1
@@@@ -101,6 +114,11 @@@@ ls_main(int argc, char *argv[])
d48 2
d52 2
a53 1
@@@@ -122,7 +140,7 @@@@ ls_main(int argc, char *argv[])
d62 1
a62 1
@@@@ -176,6 +194,9 @@@@ ls_main(int argc, char *argv[])
d72 1
a72 1
@@@@ -245,11 +266,46 @@@@ ls_main(int argc, char *argv[])
@


1.10
log
@sync with -current ls
@
text
@d1 4
a4 4
$OpenBSD: patch-ls_c,v 1.9 2007/08/11 17:52:11 naddy Exp $
--- ls.c.orig	Sat Feb 14 17:24:38 2009
+++ ls.c	Sat Feb 14 17:28:28 2009
@@@@ -62,6 +62,10 @@@@ static char rcsid[] = "$OpenBSD: ls.c,v 1.33 2008/12/3
d15 1
a15 1
@@@@ -104,6 +108,15 @@@@ int f_statustime;		/* use time of last mode change */
d31 1
a31 1
@@@@ -115,6 +128,11 @@@@ ls_main(int argc, char *argv[])
d43 1
a43 1
@@@@ -132,7 +150,7 @@@@ ls_main(int argc, char *argv[])
d52 1
a52 1
@@@@ -186,6 +204,9 @@@@ ls_main(int argc, char *argv[])
d62 1
a62 1
@@@@ -255,11 +276,46 @@@@ ls_main(int argc, char *argv[])
@


1.9
log
@sync with 4.2
@
text
@d1 4
a4 4
$OpenBSD: patch-ls_c,v 1.8 2006/05/27 04:35:21 naddy Exp $
--- ls.c.orig	Mon May  7 20:39:28 2007
+++ ls.c	Sat Aug 11 19:28:48 2007
@@@@ -62,6 +62,10 @@@@ static char rcsid[] = "$OpenBSD: ls.c,v 1.29 2007/05/0
d51 2
a52 2
 		 * The -1, -C and -l, -m and -x options all override each
@@@@ -185,6 +203,9 @@@@ ls_main(int argc, char *argv[])
d62 1
a62 1
@@@@ -254,11 +275,46 @@@@ ls_main(int argc, char *argv[])
@


1.8
log
@sync with 3.9
@
text
@d1 4
a4 4
$OpenBSD: patch-ls_c,v 1.7 2005/06/21 18:26:21 naddy Exp $
--- ls.c.orig	Sat May 27 04:58:46 2006
+++ ls.c	Sat May 27 05:55:02 2006
@@@@ -62,6 +62,10 @@@@ static char rcsid[] = "$OpenBSD: ls.c,v 
d15 1
a15 1
@@@@ -103,6 +107,15 @@@@ int f_statustime;		/* use time of last m
d31 1
a31 1
@@@@ -114,6 +127,11 @@@@ ls_main(int argc, char *argv[])
d43 1
a43 1
@@@@ -131,7 +149,7 @@@@ ls_main(int argc, char *argv[])
d52 1
a52 1
@@@@ -176,6 +194,9 @@@@ ls_main(int argc, char *argv[])
d62 3
a64 3
@@@@ -240,11 +261,46 @@@@ ls_main(int argc, char *argv[])
 	argc -= optind;
 	argv += optind;
@


1.7
log
@sync with system ls(1)
@
text
@d1 3
a3 3
$OpenBSD: patch-ls_c,v 1.6 2005/02/27 17:37:46 naddy Exp $
--- ls.c.orig	Tue Jun 21 20:05:48 2005
+++ ls.c	Tue Jun 21 20:16:37 2005
d15 2
a16 2
@@@@ -105,6 +109,15 @@@@ int f_stream;			/* stream format */
 int f_dirname;			/* if precede with directory name */
d31 1
a31 1
@@@@ -116,6 +129,11 @@@@ ls_main(int argc, char *argv[])
d43 1
a43 1
@@@@ -133,7 +151,7 @@@@ ls_main(int argc, char *argv[])
d52 1
a52 1
@@@@ -178,6 +196,9 @@@@ ls_main(int argc, char *argv[])
d62 1
a62 1
@@@@ -242,11 +263,46 @@@@ ls_main(int argc, char *argv[])
@


1.6
log
@synchronize with latest OpenBSD and FreeBSD ls; cosmetic changes only
@
text
@d1 3
a3 3
$OpenBSD: patch-ls_c,v 1.5 2004/05/28 22:03:49 naddy Exp $
--- ls.c.orig	Sun Feb 27 18:09:26 2005
+++ ls.c	Sun Feb 27 18:20:27 2005
d15 2
a16 1
@@@@ -106,7 +110,16 @@@@ int f_dirname;			/* if precede with dire
a18 1
 int f_whiteout;			/* show whiteout entries */
d21 1
a21 1
 
d28 1
a28 1
+
d31 1
a31 2
 int
@@@@ -117,6 +130,11 @@@@ ls_main(int argc, char *argv[])
d43 1
a43 1
@@@@ -134,7 +152,7 @@@@ ls_main(int argc, char *argv[])
d47 2
a48 2
-	while ((ch = getopt(argc, argv, "1ACFLRSTWacdfghiklmnopqrstux")) != -1) {
+	while ((ch = getopt(argc, argv, "1ACFGLRSTWacdfghiklmnopqrstux")) != -1) {
d52 1
a52 1
@@@@ -179,6 +197,9 @@@@ ls_main(int argc, char *argv[])
d62 1
a62 1
@@@@ -246,11 +267,46 @@@@ ls_main(int argc, char *argv[])
@


1.5
log
@Sync with -current ls to make the field width agree for long listings with
human-readable sizes.
@
text
@d1 3
a3 3
$OpenBSD: patch-ls_c,v 1.4 2003/08/27 00:41:51 naddy Exp $
--- ls.c.orig	2004-05-28 23:50:09.000000000 +0200
+++ ls.c	2004-05-28 23:54:03.000000000 +0200
d15 1
a15 1
@@@@ -106,6 +110,15 @@@@ int f_dirname;			/* if precede with dire
d21 1
a21 1
+
d28 1
a28 1
 
d31 1
@


1.4
log
@sync with 3.4 and FreeBSD
@
text
@d1 4
a4 5
$OpenBSD: patch-ls_c,v 1.3 2003/01/20 01:45:14 naddy Exp $
--- ls.c.orig	2003-08-27 00:37:00.000000000 +0200
+++ ls.c	2003-08-27 00:47:19.000000000 +0200
@@@@ -61,6 +61,10 @@@@ static char rcsid[] = "$OpenBSD: ls.c,v 
 #include <stdlib.h>
d7 1
d15 1
a15 1
@@@@ -105,6 +109,15 @@@@ int f_dirname;			/* if precede with dire
d31 1
a31 1
@@@@ -116,6 +129,11 @@@@ ls_main(int argc, char *argv[])
d43 1
a43 1
@@@@ -133,7 +151,7 @@@@ ls_main(int argc, char *argv[])
d52 1
a52 1
@@@@ -178,6 +196,9 @@@@ ls_main(int argc, char *argv[])
d62 1
a62 1
@@@@ -245,11 +266,46 @@@@ ls_main(int argc, char *argv[])
@


1.3
log
@Update to OpenBSD 3.2 base and FreeBSD 5.0 color code.
Add -h flag (human readable sizes).  Link statically, just in case.
@
text
@d1 4
a4 4
$OpenBSD: patch-ls_c,v 1.2 2002/01/23 01:27:32 naddy Exp $
--- ls.c.orig	Mon Jan 20 00:08:15 2003
+++ ls.c	Mon Jan 20 01:51:13 2003
@@@@ -65,6 +65,10 @@@@ static char rcsid[] = "$OpenBSD: ls.c,v 
d15 1
a15 9
@@@@ -89,6 +93,7 @@@@ int f_accesstime;		/* use time of last a
 int f_column;			/* columnated format */
 int f_columnacross;		/* columnated format, sorted across */
 int f_flags;			/* show flags associated with a file */
+int f_humanval;			/* show human-readable file sizes */
 int f_inode;			/* print inode */
 int f_listdir;			/* list actual directory, not contents */
 int f_listdot;			/* list files beginning with . */
@@@@ -108,6 +113,15 @@@@ int f_dirname;			/* if precede with dire
d31 2
a32 1
@@@@ -122,6 +136,12 @@@@ ls_main(argc, argv)
a34 1
 
d40 1
a40 1
+
d43 1
a43 2
 		if ((p = getenv("COLUMNS")) != NULL)
@@@@ -138,7 +158,7 @@@@ ls_main(argc, argv)
d47 1
a47 1
-	while ((ch = getopt(argc, argv, "1ACFLRSTWacdfgiklmnopqrstux")) != -1) {
d52 1
a52 1
@@@@ -183,6 +203,9 @@@@ ls_main(argc, argv)
d62 1
a62 11
@@@@ -206,6 +229,9 @@@@ ls_main(argc, argv)
 			break;
 		case 'g':		/* Compatibility with 4.3BSD. */
 			break;
+		case 'h':
+			f_humanval = 1;
+			break;
 		case 'i':
 			f_inode = 1;
 			break;
@@@@ -247,11 +273,46 @@@@ ls_main(argc, argv)
d88 1
a88 1
+
@


1.2
log
@sync with color code in FreeBSD-CURRENT
@
text
@d1 4
a4 4
$OpenBSD: patch-ls_c,v 1.1.1.1 2001/11/05 18:55:28 naddy Exp $
--- ls.c.orig	Mon Oct 15 22:12:15 2001
+++ ls.c	Wed Jan 23 01:00:42 2002
@@@@ -63,6 +63,10 @@@@ static char rcsid[] = "$OpenBSD: ls.c,v 
d15 9
a23 1
@@@@ -109,6 +113,15 @@@@ int f_dirname;			/* if precede with dire
d39 1
a39 1
@@@@ -123,6 +136,12 @@@@ ls_main(argc, argv)
d44 2
a45 2
+	char termcapbuf[1024];		/* termcap definition buffer */
+	char tcapbuf[512];		/* capability buffer */
d52 1
a52 1
@@@@ -139,7 +158,7 @@@@ ls_main(argc, argv)
d57 1
a57 1
+	while ((ch = getopt(argc, argv, "1ACFGLRSTWacdfgiklmnopqrstux")) != -1) {
d61 1
a61 1
@@@@ -184,6 +203,9 @@@@ ls_main(argc, argv)
d71 11
a81 1
@@@@ -248,11 +270,46 @@@@ ls_main(argc, argv)
d97 1
a97 1
+			 don't do colours at all. */
d105 1
a105 1
+		(void)fprintf(stderr, "Color support not compiled in.\n");
@


1.1
log
@Initial revision
@
text
@d1 1
a1 1
$OpenBSD$
d3 1
a3 1
+++ ls.c	Tue Oct 16 22:38:21 2001
d15 1
a15 1
@@@@ -109,6 +113,13 @@@@ int f_dirname;			/* if precede with dire
d25 2
d31 1
a31 1
@@@@ -123,6 +134,12 @@@@ ls_main(argc, argv)
d44 1
a44 1
@@@@ -139,7 +156,7 @@@@ ls_main(argc, argv)
d53 1
a53 1
@@@@ -184,6 +201,9 @@@@ ls_main(argc, argv)
d63 1
a63 1
@@@@ -248,11 +268,44 @@@@ ls_main(argc, argv)
d74 2
d92 2
a93 2
+		(void) signal(SIGINT, colorquit);
+		(void) signal(SIGQUIT, colorquit);
@


1.1.1.1
log
@Import colorls.

This is a simple hack, taken from FreeBSD, to OpenBSD's ls(1) to
use ANSI sequences to display file attributes in color.
@
text
@@
