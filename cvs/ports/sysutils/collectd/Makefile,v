head	1.50;
access;
symbols
	OPENBSD_6_1:1.46.0.2
	OPENBSD_6_1_BASE:1.46
	OPENBSD_6_0:1.38.0.2
	OPENBSD_6_0_BASE:1.38
	OPENBSD_5_9:1.35.0.2
	OPENBSD_5_9_BASE:1.35
	OPENBSD_5_8:1.32.0.4
	OPENBSD_5_8_BASE:1.32
	OPENBSD_5_7:1.27.0.2
	OPENBSD_5_7_BASE:1.27
	OPENBSD_5_6:1.22.0.2
	OPENBSD_5_6_BASE:1.22
	OPENBSD_5_5:1.21.0.2
	OPENBSD_5_5_BASE:1.21
	OPENBSD_5_4:1.19.0.2
	OPENBSD_5_4_BASE:1.19
	OPENBSD_5_3:1.15.0.2
	OPENBSD_5_3_BASE:1.15
	OPENBSD_5_2:1.13.0.2
	OPENBSD_5_2_BASE:1.13
	OPENBSD_5_1_BASE:1.12
	OPENBSD_5_1:1.12.0.2
	OPENBSD_5_0:1.10.0.2
	OPENBSD_5_0_BASE:1.10
	OPENBSD_4_9:1.9.0.2
	OPENBSD_4_9_BASE:1.9
	OPENBSD_4_8:1.5.0.2
	OPENBSD_4_8_BASE:1.5
	landry_20100623:1.1.1.1
	landry:1.1.1;
locks; strict;
comment	@# @;


1.50
date	2017.07.08.17.37.36;	author ajacoutot;	state Exp;
branches;
next	1.49;
commitid	reqrRB2Q2IQ6viWG;

1.49
date	2017.06.29.00.33.59;	author danj;	state Exp;
branches;
next	1.48;
commitid	FylFwm7cb8GbPoDx;

1.48
date	2017.06.12.17.22.42;	author danj;	state Exp;
branches;
next	1.47;
commitid	H164rcTAy2A2EHPv;

1.47
date	2017.04.30.17.52.15;	author landry;	state Exp;
branches;
next	1.46;
commitid	aLXmn1s7ZN10Bw1g;

1.46
date	2017.02.18.17.33.51;	author ajacoutot;	state Exp;
branches
	1.46.2.1;
next	1.45;
commitid	kjw4RQ4AAUYktD89;

1.45
date	2017.02.18.17.32.37;	author ajacoutot;	state Exp;
branches;
next	1.44;
commitid	bw6Y0vDo3oixdVWL;

1.44
date	2016.12.12.17.55.24;	author landry;	state Exp;
branches;
next	1.43;
commitid	AA0uUdlZRPnmg3Vk;

1.43
date	2016.12.04.16.56.53;	author jca;	state Exp;
branches;
next	1.42;
commitid	tOWzytmgr8lch7nR;

1.42
date	2016.12.03.11.44.41;	author landry;	state Exp;
branches;
next	1.41;
commitid	qj4URm0Db8feFZOv;

1.41
date	2016.12.02.15.50.29;	author jca;	state Exp;
branches;
next	1.40;
commitid	mADlZHEPibAUHfk6;

1.40
date	2016.11.07.10.51.36;	author sthen;	state Exp;
branches;
next	1.39;
commitid	bXhLeQYbQdffqUSF;

1.39
date	2016.11.04.11.35.20;	author sthen;	state Exp;
branches;
next	1.38;
commitid	Gg5LRcnQlqj5M3F7;

1.38
date	2016.06.13.09.12.40;	author landry;	state Exp;
branches;
next	1.37;
commitid	i1EY2nNVfBI2xXZF;

1.37
date	2016.04.22.15.27.45;	author sthen;	state Exp;
branches;
next	1.36;
commitid	p44DJZdGI7w9b4g1;

1.36
date	2016.03.20.16.12.26;	author naddy;	state Exp;
branches;
next	1.35;
commitid	guiZq8cnNbVyyHzx;

1.35
date	2015.10.30.12.59.16;	author sthen;	state Exp;
branches;
next	1.34;
commitid	vVZOehVa6DiEPxJL;

1.34
date	2015.10.05.16.29.01;	author sthen;	state Exp;
branches;
next	1.33;
commitid	AqjFzXOPaoxpieFE;

1.33
date	2015.08.12.22.27.31;	author sthen;	state Exp;
branches;
next	1.32;
commitid	SHEFBfUb4YY8KIkG;

1.32
date	2015.07.31.12.06.18;	author landry;	state Exp;
branches;
next	1.31;
commitid	ObMO1OkfbRwAOn4L;

1.31
date	2015.07.27.14.53.38;	author landry;	state Exp;
branches;
next	1.30;
commitid	qjuOX6RZ3CCpDOM8;

1.30
date	2015.07.23.07.33.17;	author landry;	state Exp;
branches;
next	1.29;
commitid	mFWJoll0XLJ4Rcdj;

1.29
date	2015.06.10.10.43.29;	author sthen;	state Exp;
branches;
next	1.28;
commitid	ooMDYDVOJETzXFwR;

1.28
date	2015.05.03.10.41.34;	author landry;	state Exp;
branches;
next	1.27;
commitid	BzZlj0UFCQtjwhCF;

1.27
date	2015.01.22.20.26.43;	author naddy;	state Exp;
branches;
next	1.26;
commitid	z5rpjRfvUoyAfWNP;

1.26
date	2014.12.01.09.07.12;	author landry;	state Exp;
branches;
next	1.25;
commitid	yx8QDPZlts7onRPD;

1.25
date	2014.10.26.20.43.56;	author landry;	state Exp;
branches;
next	1.24;
commitid	Pqs7fyn0icDUbscJ;

1.24
date	2014.09.25.20.10.13;	author landry;	state Exp;
branches;
next	1.23;
commitid	ZsuZqR6aoW7tRgVV;

1.23
date	2014.09.13.18.09.22;	author brad;	state Exp;
branches;
next	1.22;
commitid	PpbRjVZdAmlrmi8q;

1.22
date	2014.04.21.13.33.08;	author ajacoutot;	state Exp;
branches;
next	1.21;

1.21
date	2014.01.24.20.40.17;	author landry;	state Exp;
branches;
next	1.20;

1.20
date	2013.11.06.20.45.48;	author kili;	state Exp;
branches;
next	1.19;

1.19
date	2013.06.12.20.36.34;	author brad;	state Exp;
branches;
next	1.18;

1.18
date	2013.05.25.00.33.10;	author brad;	state Exp;
branches;
next	1.17;

1.17
date	2013.03.21.08.48.53;	author ajacoutot;	state Exp;
branches;
next	1.16;

1.16
date	2013.03.11.11.41.29;	author espie;	state Exp;
branches;
next	1.15;

1.15
date	2012.09.25.11.37.35;	author naddy;	state Exp;
branches;
next	1.14;

1.14
date	2012.09.23.19.33.02;	author jasper;	state Exp;
branches;
next	1.13;

1.13
date	2012.04.28.10.52.08;	author ajacoutot;	state Exp;
branches;
next	1.12;

1.12
date	2011.11.18.01.08.01;	author sthen;	state Exp;
branches;
next	1.11;

1.11
date	2011.09.16.11.41.39;	author espie;	state Exp;
branches;
next	1.10;

1.10
date	2011.07.07.00.22.37;	author ajacoutot;	state Exp;
branches;
next	1.9;

1.9
date	2010.11.29.20.20.41;	author jasper;	state Exp;
branches;
next	1.8;

1.8
date	2010.11.20.17.22.40;	author espie;	state Exp;
branches;
next	1.7;

1.7
date	2010.10.19.07.43.00;	author espie;	state Exp;
branches;
next	1.6;

1.6
date	2010.09.07.11.12.05;	author landry;	state Exp;
branches;
next	1.5;

1.5
date	2010.08.08.07.41.40;	author landry;	state Exp;
branches;
next	1.4;

1.4
date	2010.07.22.14.40.49;	author landry;	state Exp;
branches;
next	1.3;

1.3
date	2010.06.29.20.17.18;	author landry;	state Exp;
branches;
next	1.2;

1.2
date	2010.06.24.06.53.36;	author landry;	state Exp;
branches;
next	1.1;

1.1
date	2010.06.23.18.04.26;	author landry;	state Exp;
branches
	1.1.1.1;
next	;

1.1.1.1
date	2010.06.23.18.04.26;	author landry;	state Exp;
branches;
next	;

1.46.2.1
date	2017.06.12.17.20.45;	author danj;	state Exp;
branches;
next	;
commitid	oasVFJ76aWantPF4;


desc
@@


1.50
log
@Make the rc.d script match our style and remove obvious comment.
While here, remove the gettext MODULE.
@
text
@# $OpenBSD: Makefile,v 1.49 2017/06/29 00:33:59 danj Exp $

COMMENT-main =		system metrics collection engine
COMMENT-mysql =		collectd mysql plugin
COMMENT-pgsql =		collectd postgresql plugin
COMMENT-rrdtool =	collectd rrdtool plugin
COMMENT-snmp =		collectd snmp plugin
COMMENT-virt =		collectd libvirt plugin
COMMENT-python =	collectd python plugin
COMMENT-memcachec =	collectd memcachec plugin
COMMENT-nut =		collectd nut plugin
COMMENT-riemann =	collectd riemann plugin

V =			5.7.2
DISTNAME =		collectd-$V
PKGNAME-main =		collectd-$V
PKGNAME-mysql =		collectd-mysql-$V
PKGNAME-pgsql =		collectd-pgsql-$V
PKGNAME-rrdtool =	collectd-rrdtool-$V
PKGNAME-snmp =		collectd-snmp-$V
PKGNAME-virt =		collectd-virt-$V
PKGNAME-python =	collectd-python-$V
PKGNAME-memcachec =	collectd-memcachec-$V
PKGNAME-nut =		collectd-nut-$V
PKGNAME-riemann =	collectd-riemann-$V
CATEGORIES =		sysutils

REVISION-main =		1
REVISION =		0

HOMEPAGE =		http://www.collectd.org/
SHARED_LIBS +=		collectdclient 1.0

# GPLv2
PERMIT_PACKAGE_CDROM =	Yes

MASTER_SITES =		${HOMEPAGE}/files/
EXTRACT_SUFX =		.tar.bz2

MODULES =		lang/python
MODPY_RUNDEP =		No

MULTI_PACKAGES =	-main -mysql -pgsql -rrdtool -snmp -virt -python -memcachec -nut -riemann

WANTLIB-mysql =		crypto m ssl z mysqlclient_r pthread
LIB_DEPENDS-mysql =	databases/mariadb
RUN_DEPENDS-mysql =	collectd-$V:${BASE_PKGPATH},-main

WANTLIB-pgsql =		pq pthread
LIB_DEPENDS-pgsql =	databases/postgresql
RUN_DEPENDS-pgsql =	collectd-$V:${BASE_PKGPATH},-main

WANTLIB-rrdtool =	X11 Xext Xrender c cairo expat ffi fontconfig \
			freetype glib-2.0 gobject-2.0 \
			graphite2 gthread-2.0 harfbuzz iconv intl lzma m \
			pango-1.0 pangocairo-1.0 pangoft2-1.0 pcre \
			pixman-1 png pthread pthread-stubs rrd xcb \
			xcb-render xcb-shm xml2 z
LIB_DEPENDS-rrdtool =	net/rrdtool
RUN_DEPENDS-rrdtool =	collectd-$V:${BASE_PKGPATH},-main

WANTLIB-snmp =		crypto netsnmp pthread
LIB_DEPENDS-snmp =	net/net-snmp
RUN_DEPENDS-snmp =	collectd-$V:${BASE_PKGPATH},-main

LIB_DEPENDS-virt =	sysutils/libvirt
WANTLIB-virt =		avahi-client avahi-common c dbus-1 ffi gmp gnutls hogweed \
			nettle p11-kit ssh2 tasn1 util virt crypto curl iconv \
			idn2 intl lzma m nghttp2 pthread ssl unistring xml2 z
RUN_DEPENDS-virt =	collectd-$V:${BASE_PKGPATH},-main

LIB_DEPENDS-python =	${MODPY_LIB_DEPENDS}
WANTLIB-python =	${MODPY_WANTLIB} pthread m util
RUN_DEPENDS-python =	collectd-$V:${BASE_PKGPATH},-main \
			${MODPY_RUN_DEPENDS}

LIB_DEPENDS-memcachec =	devel/libmemcached
WANTLIB-memcachec =	m memcached sasl2 pthread
RUN_DEPENDS-memcachec =	collectd-$V:${BASE_PKGPATH},-main

LIB_DEPENDS-nut =	nut->=2.7.3p0:sysutils/nut
RUN_DEPENDS-nut =	collectd-$V:${BASE_PKGPATH},-main
WANTLIB-nut =		crypto pthread ssl upsclient

LIB_DEPENDS-riemann =	sysutils/riemann-c-client
WANTLIB-riemann =	c gmp gnutls ffi hogweed intl iconv idn2 nettle \
			protobuf-c p11-kit pthread riemann-client tasn1 \
			unistring z
RUN_DEPENDS-riemann =	collectd-$V:${BASE_PKGPATH},-main

LIB_DEPENDS +=	net/curl \
		net/liboping \
		textproc/libxml \
		sysutils/libstatgrab \
		security/libgcrypt \
		devel/libtool,-ltdl \
		devel/libyajl

WANTLIB += c crypto gpg-error kvm curl xml2 ltdl lzma oping nghttp2
WANTLIB += m pcap pthread ssl xml2 z statgrab gcrypt iconv intl
WANTLIB += yajl

CONFIGURE_STYLE =	gnu
# uses -export-symbol-regex
USE_LIBTOOL=		gnu
LIBTOOL_FLAGS =	--tag=disable-static
CONFIGURE_ARGS +=--with-ltdl-include=${LOCALBASE}/include \
		--with-ltdl-lib=${LOCALBASE}/lib \
		--with-librrd=${LOCALBASE} \
		--with-libstatgrab=${LOCALBASE} \
		--with-libnetsnmp=${LOCALBASE} \
		--with-python=${MODPY_BIN} \
		--with-libprotobuf-c=no \
		--enable-all-plugins=no

# no, varnishapi.h not in our varnish package
#		--with-libvarnish=${LOCALBASE}

ENABLED_PLUGINS =	apache apcups ascent bind cpu csv curl curl_xml \
			df disk dns email exec filecount interface load \
			logfile match_empty_counter match_hashed match_regex \
			match_timediff match_value memcached memory mysql \
			network nginx ntpd olsrd openvpn ping postgresql powerdns \
			processes rrdtool rrdcached snmp swap syslog table tail tail_csv \
			target_notification target_replace target_scale \
			target_set target_v5upgrade tcpconns teamspeak2 ted unixsock uptime \
			users uuid write_http write_graphite pf python virt memcachec nut \
			aggregation curl_json log_logstash memcached \
			threshold write_log write_riemann

.for _plugin in ${ENABLED_PLUGINS}
CONFIGURE_ARGS += --enable-${_plugin}
.endfor

CONFIGURE_ENV +=	PYTHON_CONFIG='${LOCALBASE}/bin/python${MODPY_VERSION}-config' \
			CPPFLAGS='-I${LOCALBASE}/include' \
			LDFLAGS='-L${LOCALBASE}/lib -L${X11BASE}/lib -pthread'

.include <bsd.port.mk>
@


1.49
log
@Enlarge some buffers because 2048 is not enough to get getgrnam_r result.
Also fix errno handling in exec.c. Many thanks to jca@@ for the help.

"if it builds, ship it" jca@@
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.48 2017/06/12 17:22:42 danj Exp $
d27 2
d40 1
a40 1
MODULES =		devel/gettext lang/python
d100 1
a100 1
WANTLIB += m pcap pthread ssl xml2 z statgrab gcrypt ${MODGETTEXT_WANTLIB}
@


1.48
log
@Security update to collectd-5.7.2, fixes CVE-2017-7401

Tested by Pavel Korovin
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.47 2017/04/30 17:52:15 landry Exp $
d27 1
@


1.47
log
@Update to collectd 5.7.1, from Pavel Korovin, thanks !

See https://collectd.org/wiki/index.php/Version_5.7
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.46 2017/02/18 17:33:51 ajacoutot Exp $
d14 1
a14 1
V =			5.7.1
d66 1
a66 1
			idn2 intl lzma m nghttp2 pthread ssl xml2 z
d75 1
a75 1
WANTLIB-memcachec =	memcached sasl2 pthread
d83 3
a85 2
WANTLIB-riemann =	c gmp gnutls ffi hogweed intl iconv idn2 \
			nettle protobuf-c p11-kit pthread riemann-client tasn1 z
@


1.46
log
@Missed bump.
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.45 2017/02/18 17:32:37 ajacoutot Exp $
d14 1
a14 2
REVISION-main =		2
V =			5.6.2
a26 9
REVISION-memcachec =	0
REVISION-mysql =	0
REVISION-nut =		0
REVISION-pgsql =	0
REVISION-python =	0
REVISION-riemann =	0
REVISION-rrdtool =	0
REVISION-snmp =		0
REVISION-virt =		0
@


1.46.2.1
log
@Backport patch for CVE-2017-7401
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.46 2017/02/18 17:33:51 ajacoutot Exp $
d14 1
a14 1
REVISION-main =		3
@


1.45
log
@idn -> idn2 after gnutls WANTLIB change.
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.44 2016/12/12 17:55:24 landry Exp $
d14 1
a14 1
REVISION-main =		1
d28 9
@


1.44
log
@Ugly bandaid: bump CMDLINE_BUFFER_SIZE to 16k instead of defaulting to
4k, i'm hitting "processes plugin: Command line did not fit into
buffer." warning way too much and this spams logs. Better solution would
be to dynamically alloc the array on the fly as-needed like top/ps
does..
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.43 2016/12/04 16:56:53 jca Exp $
d67 1
a67 1
			idn intl lzma m nghttp2 pthread ssl xml2 z
d84 1
a84 1
WANTLIB-riemann =	c gmp gnutls ffi hogweed intl iconv idn \
@


1.43
log
@Unbreak the kvm(3) calls used by the processes and tcpconns plugins.

- patch the correct kvm_open call to use KVM_NO_FILES.  Also, use
  kvm_openfiles instead, as was probably intended
- add a new implementation for tcpconns, based on kvm_getfiles instead
  of peeking at kernel memory

ok landry@@
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.42 2016/12/03 11:44:41 landry Exp $
d14 1
a14 1
REVISION-main =		0
@


1.42
log
@Update to collectd 5.6.2.

- put the write_riemann plugin in its own subpackage, depending on
  riemann-c-client.
- disable protobuf-c detection/dependency, used by two plugins we dont
  enable (pinba and grpc)
- fix some WANTLIB
- the processes and tcpconns plugin still seem to be busted, calling
  kvm_openfiles with O_RDONLY|KVM_NO_FILES is apparently not enough.
Interestingly, swap plugin (using the same code) works ?

Based on a diff from Pavel Korovin for 5.6.1, thanks!
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.41 2016/12/02 15:50:29 jca Exp $
d14 1
@


1.41
log
@Use KVM_NO_FILES to unbreak processes and swap plugins.

The tcpconns plugin needs more work, using kvm_getfiles(3) or sysctl(3).
Prodded by landry@@
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.40 2016/11/07 10:51:36 sthen Exp $
d12 1
d14 1
a14 3
V =			5.5.1
REVISION-main =		1
REVISION-virt =		1
d25 1
d35 1
d40 1
a40 1
MULTI_PACKAGES =	-main -mysql -pgsql -rrdtool -snmp -virt -python -memcachec -nut
d59 1
a59 1
WANTLIB-snmp =		crypto netsnmp m pthread
d70 1
a70 1
WANTLIB-python =	${MODPY_WANTLIB} pthread
d82 5
d93 1
a93 2
		devel/libyajl \
		devel/protobuf-c>=1.0.1
d97 1
a97 1
WANTLIB += protobuf-c yajl
d107 1
a107 1
		--with-libnetsnmp=${LOCALBASE}/bin/net-snmp-config \
d109 1
d131 2
a132 1
CONFIGURE_ENV +=	CPPFLAGS='-I${LOCALBASE}/include' \
@


1.40
log
@sync WANTLIB (readding idn to some where I was overzealous, plus some lzma/pthread)
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.39 2016/11/04 11:35:20 sthen Exp $
d14 1
a14 1
REVISION-main =		0
@


1.39
log
@sync WANTLIB (and in one case, add gettext to LIB_DEPENDS) in dependent ports
now that internationalised domain name support has been removed from net/curl
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.38 2016/06/13 09:12:40 landry Exp $
d15 1
a15 1
REVISION-virt =		0
d65 1
a65 1
			intl lzma m nghttp2 pthread ssl xml2 z
@


1.38
log
@Update to collectd 5.5.1.

Remove patches merged upstream, add patch to fix the build from
https://github.com/collectd/collectd/issues/1674
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.37 2016/04/22 15:27:45 sthen Exp $
d14 2
d65 1
a65 1
			idn intl lzma m nghttp2 pthread ssl xml2 z
d90 1
a90 1
WANTLIB += c crypto gpg-error idn kvm curl xml2 ltdl lzma oping nghttp2
@


1.37
log
@handle rrdtool lib change that I missed in collectd when I looked at
sqlports results (thanks nigel for pointing out), sync other wantlib
while there.
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.36 2016/03/20 16:12:26 naddy Exp $
d13 1
a13 9
V =			5.5.0
REVISION-main =		3
REVISION-nut =		0
REVISION-rrdtool =	1
REVISION-virt =		1
REVISION-python =	0
REVISION-memcachec =	0
REVISION-pgsql =	0
REVISION-mysql =	0
d116 1
a116 1
			aggregation curl_json fhcount log_logstash memcached \
@


1.36
log
@drop SHARED_ONLY from python and ruby ports
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.35 2015/10/30 12:59:16 sthen Exp $
d16 1
a16 1
REVISION-rrdtool =	0
d18 4
d47 1
a47 1
WANTLIB-mysql =		crypto m ssl z mysqlclient_r stdc++ pthread
d51 1
a51 1
WANTLIB-pgsql =		pq pthread crypto ssl
d56 1
a56 1
			freetype glib-2.0 gmodule-2.0 gobject-2.0 \
d59 1
a59 1
			pixman-1 png pthread pthread-stubs rrd_th xcb \
d75 1
a75 1
WANTLIB-python =	${MODPY_WANTLIB} util m pthread
d80 1
a80 1
WANTLIB-memcachec =	memcached sasl2 m pthread
@


1.35
log
@sync WANTLIB (curl+nghttp2)
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.34 2015/10/05 16:29:01 sthen Exp $
a31 1
SHARED_ONLY =		Yes
@


1.34
log
@REVISION bumps following the additional member in struct if_data,
to make sure packages get updated
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.33 2015/08/12 22:27:31 sthen Exp $
d14 1
a14 1
REVISION-main =		2
d17 1
a17 1
REVISION-virt =		0
d68 1
a68 1
			idn intl lzma m pthread ssl xml2 z
d93 1
a93 1
WANTLIB += c crypto gpg-error idn kvm curl xml2 ltdl lzma oping
@


1.33
log
@sync WANTLIB
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.32 2015/07/31 12:06:18 landry Exp $
d14 1
a14 1
REVISION-main =		1
d16 1
a16 1
REVISION-rrdtool =		0
@


1.32
log
@Backport fix for https://github.com/collectd/collectd/issues/1094

ok sthen@@
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.31 2015/07/27 14:53:38 landry Exp $
d15 3
d52 1
a52 1
WANTLIB-rrdtool =	X11 Xext Xrender cairo expat ffi fontconfig \
d66 1
a66 1
WANTLIB-virt =		avahi-client avahi-common dbus-1 ffi gmp gnutls hogweed \
d82 1
a82 1
WANTLIB-nut =		upsclient
@


1.31
log
@Fix previous, collectd failed to load its plugins and really wants to
use gnu libtool with -export-symbol-regex when linking them, otherwise
it fails to find module_register. While here fix PKGLOCALSTATEDIR and
PIDFILE in src/daemon/Makefile.in.
Somehow, my limited testing on powerpc didnt show this failure at all..

All this from Pavel Korovin, thanks!
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.30 2015/07/23 07:33:17 landry Exp $
d14 1
a14 1
REVISION-main =		0
@


1.30
log
@Update to collectd 5.5.0.

Enable aggregation, curl_json, fhcount, log_logstash, memcached,
threshold, write_log & write_riemann plugins.
Add dependencies on devel/libyajl for curl_json & log_logstash and
devel/protobuf-c for write_riemann.
Add a README explaining how to run the daemon as _collectd user in case
you dont need the dns and ping plugins (the only ones requiring root).
Lots of patches merged upstream.

From Pavel Korovin with small tweaks by me, tested here on ppc.
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.29 2015/06/10 10:43:29 sthen Exp $
d14 1
d95 2
a96 2
# wants to use -export-symbol-regex, but that doesnt change anything at runtime?
#USE_LIBTOOL=		gnu
@


1.29
log
@bump REVISIONs following DIOCGETSTATUS ABI change
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.28 2015/05/03 10:41:34 landry Exp $
d13 1
a13 2
V =			5.4.2
REVISION-main =		0
d85 3
a87 1
		devel/libtool,-ltdl
d91 1
d94 2
d116 3
a118 1
			users uuid write_http write_graphite pf python libvirt memcachec nut
@


1.28
log
@Update to collectd 5.4.2.

See https://github.com/collectd/collectd/releases/tag/collectd-5.4.2 for details.

Enable memcachec, libvirt, python and nut plugins, each in its subpackage.

ok ajacoutot@@
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.27 2015/01/22 20:26:43 naddy Exp $
d14 1
@


1.27
log
@Drop USE_GROFF: trivial page footer and acceptable formatting differences
only.
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.26 2014/12/01 09:07:12 landry Exp $
d8 4
d13 1
a13 1
V =			5.4.1
d20 4
a25 3
REVISION-main =		1
REVISION-rrdtool =	1

d35 2
a36 1
MODULES =		devel/gettext
d38 1
a38 1
MULTI_PACKAGES =	-main -mysql -pgsql -rrdtool -snmp
d61 19
d97 1
a97 1
		--without-python \
d100 3
d111 1
a111 1
			users uuid write_http write_graphite pf
@


1.26
log
@Enable the ping plugin via liboping.

Update PLISTs while here and add lzma to WANTLIBs (added via curl)
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.25 2014/10/26 20:43:56 landry Exp $
a66 1
USE_GROFF =	Yes
@


1.25
log
@Enable the processes & rrdcached plugins.

whack processes.c to use the same codepaths as freebsd's, taking into
account kinfo_proc differences.. to be properly pushed upstream.
Tested on ppc & amd64.
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.24 2014/09/25 20:10:13 landry Exp $
d18 2
a19 2
REVISION-main =		0
REVISION-rrdtool =	0
d44 1
a44 1
			graphite2 gthread-2.0 harfbuzz iconv intl m \
d56 1
d62 1
a62 1
WANTLIB += c crypto gpg-error idn kvm curl xml2 ltdl
d80 1
a80 1
			network nginx ntpd olsrd openvpn postgresql powerdns \
@


1.24
log
@Long awaited update to collectd 5.4.1.

- remove useless MESSAGE, provide an rc script instead
- enable pf, target_v5upgrade, tail_csv and write_graphite plugins
- backport fixes from FreeBSD and NetBSD to build with newer libstatgrab
  (upstream collectd github ticket #445)
- remove the check and inclusion of pcap-bpf.h, we dont have/need it
- users of the previous 4.x version should refer to
  https://collectd.org/wiki/index.php/V4_to_v5_migration_guide for the
upgrade path.

tested on ppc & amd64.
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.23 2014/09/13 18:09:22 brad Exp $
d18 3
d80 1
a80 1
			rrdtool snmp swap syslog table tail tail_csv \
@


1.23
log
@Switch from using MySQL to using MariaDB attempt #2. MariaDB is a drop-in replacement.

ok sthen@@
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.22 2014/04/21 13:33:08 ajacoutot Exp $
d9 1
a9 1
V =			4.10.2
a17 6
REVISION-main=		4
REVISION-mysql =	4
REVISION-pgsql =	3
REVISION-rrdtool =	2
REVISION-snmp =		1

d19 1
a19 1
SHARED_LIBS +=		collectdclient 0.0
d31 1
a31 1
WANTLIB-mysql =		crypto m ssl z mysqlclient pthread
d77 1
a77 1
			rrdtool snmp swap syslog table tail \
d79 2
a80 2
			target_set tcpconns teamspeak2 ted unixsock uptime \
			users uuid write_http
@


1.22
log
@Sync wantlib after kerberos removal from postgresql.
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.21 2014/01/24 20:40:17 landry Exp $
d19 1
a19 1
REVISION-mysql =	3
d38 1
a38 1
LIB_DEPENDS-mysql =	databases/mysql
@


1.21
log
@Install the example collectd.conf with 644 mode, and use @@mode 640 for
the @@sample version.
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.20 2013/11/06 20:45:48 kili Exp $
d20 1
a20 1
REVISION-pgsql =	2
d41 1
a41 2
WANTLIB-pgsql =		asn1 com_err crypto heimbase krb5 pq pthread \
			roken ssl wind
@


1.20
log
@Unbreak after rrdtool update, While here tweak WANTLIB-*
a little bit.

ok sthen@@
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.19 2013/06/12 20:36:34 brad Exp $
d18 1
a18 1
REVISION-main=		3
@


1.19
log
@Revert back to using MySQL 5.1 for the time being. MariaDB 5.5 introduces
a new libmysqlclient non-blocking API which utilizes co-routines. The X86
specific GCC ASM co-routine support hid the fact that there was an issue.
The only fallback code so far is POSIX user contexts which OpenBSD does not
support.

Input from and Ok sthen@@ jasper@@
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.18 2013/05/25 00:33:10 brad Exp $
d20 2
a21 2
REVISION-pgsql =	1
REVISION-rrdtool =	1
d41 2
a42 1
WANTLIB-pgsql =		pq com_err crypto pthread ssl
d46 6
a51 1
WANTLIB-rrdtool =	art_lgpl_2 freetype m png z rrd_th pthread
@


1.18
log
@Switch from using MySQL to using MariaDB. MariaDB is a drop-in replacement.


ok sthen aja
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.17 2013/03/21 08:48:53 ajacoutot Exp $
d19 1
a19 1
REVISION-mysql =	2
d38 1
a38 1
LIB_DEPENDS-mysql =	databases/mariadb
@


1.17
log
@USE_LIBTOOL=Yes is the default now.
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.16 2013/03/11 11:41:29 espie Exp $
d19 1
a19 1
REVISION-mysql =	1
d38 1
a38 1
LIB_DEPENDS-mysql =	databases/mysql
@


1.16
log
@PERMIT_* / REGRESS->TEST sweep
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.15 2012/09/25 11:37:35 naddy Exp $
a62 1
USE_LIBTOOL =		Yes
@


1.15
log
@actually bump subpackage
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.14 2012/09/23 19:33:02 jasper Exp $
a29 3
PERMIT_PACKAGE_FTP =	Yes
PERMIT_DISTFILES_CDROM =Yes
PERMIT_DISTFILES_FTP =	Yes
@


1.14
log
@remove -lpthread vs. -pthread patches/chunks
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.13 2012/04/28 10:52:08 ajacoutot Exp $
d21 1
a21 1
REVISION-rrtool =	1
@


1.13
log
@--localstatedir=/var is the default now.
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.12 2011/11/18 01:08:01 sthen Exp $
d18 5
a22 5
REVISION-main=		2
REVISION-mysql =	0
REVISION-pgsql =	0
REVISION-rrtool =	0
REVISION-snmp =		0
d40 1
a40 1
WANTLIB-mysql =		crypto m ssl z mysqlclient
d44 1
a44 1
WANTLIB-pgsql =		pq
d48 1
a48 1
WANTLIB-rrdtool =	art_lgpl_2 freetype m png z rrd_th
d52 1
a52 1
WANTLIB-snmp =		crypto netsnmp
@


1.12
log
@bump; net/if.h changes (missed with the last batch)
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.11 2011/09/16 11:41:39 espie Exp $
a73 1
		--localstatedir=/var \
@


1.11
log
@normalize pkgpath
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.10 2011/07/07 00:22:37 ajacoutot Exp $
d18 1
a18 1
REVISION-main=		1
@


1.10
log
@Use the gettext MODULE
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.9 2010/11/29 20:20:41 jasper Exp $
d18 5
a22 1
REVISION-main=		0
@


1.9
log
@SECURITY UPDATE of collectd to 4.10.2, among the regular bugfixes is a fix
for SA42393, collectd "cu_rrd_create_file()" Denial of Service Vulnerability.

ok landry@@
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.8 2010/11/20 17:22:40 espie Exp $
d18 2
d32 1
a32 1
MODULES =		converters/libiconv
d58 2
a59 2
WANTLIB += c crypto gpg-error idn intl kvm curl xml2 ltdl
WANTLIB += m pcap pthread ssl xml2 z statgrab gcrypt
@


1.8
log
@new depends
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.7 2010/10/19 07:43:00 espie Exp $
d9 1
a9 1
V =			4.10.1
@


1.7
log
@USE_GROFF=Yes
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.6 2010/09/07 11:12:05 landry Exp $
d35 2
a36 2
LIB_DEPENDS-mysql =	::databases/mysql
RUN_DEPENDS-mysql =	:collectd-$V:${BASE_PKGPATH},-main
d39 2
a40 2
LIB_DEPENDS-pgsql =	::databases/postgresql
RUN_DEPENDS-pgsql =	:collectd-$V:${BASE_PKGPATH},-main
d43 2
a44 2
LIB_DEPENDS-rrdtool =	::net/rrdtool
RUN_DEPENDS-rrdtool =	:collectd-$V:${BASE_PKGPATH},-main
d47 2
a48 2
LIB_DEPENDS-snmp =	::net/net-snmp
RUN_DEPENDS-snmp =	:collectd-$V:${BASE_PKGPATH},-main
d50 5
a54 5
LIB_DEPENDS +=	::net/curl \
		::textproc/libxml \
		::sysutils/libstatgrab \
		::security/libgcrypt \
		::devel/libtool,-ltdl
@


1.6
log
@Update to collectd 4.10.1, from Simon Kuhnle, thanks!
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.5 2010/08/08 07:41:40 landry Exp $
d62 1
@


1.5
log
@Make snmp/rrdtool/pgsql/mysql subpackages RUN_DEPENDS on -main
subpackage, same version. It makes very little sense to only install a
plugin.. bump corresponding REVISIONs.
With tweaks from sthen@@, agreed by espie@@
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.4 2010/07/22 14:40:49 landry Exp $
d9 1
a9 1
V =			4.10.0
a11 1
REVISION-main =		2
a12 1
REVISION-mysql =	2
a13 1
REVISION-pgsql =	2
a14 1
REVISION-rrdtool =	2
a15 1
REVISION-snmp =		2
@


1.4
log
@Make sure netinet/in.h is included before arpa/inet.h.
Fixes build with -Wsystem-headers. While here use REVISION/fix DEPENDS
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.3 2010/06/29 20:17:18 landry Exp $
d14 1
a14 1
REVISION-mysql =	1
d16 1
a16 1
REVISION-pgsql =	1
d18 1
a18 1
REVISION-rrdtool =	1
d20 1
a20 1
REVISION-snmp =		1
d41 1
d45 1
d49 1
d53 1
@


1.3
log
@Oops. collectd-snmp manpage doesnt belong to -main, and it's already in
-snmp. Fixes conflicts between pkgs.
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.2 2010/06/24 06:53:36 landry Exp $
d11 10
a20 5
PKGNAME-main =		collectd-$Vp1
PKGNAME-mysql =		collectd-mysql-$Vp0
PKGNAME-pgsql =		collectd-pgsql-$Vp0
PKGNAME-rrdtool =	collectd-rrdtool-$Vp0
PKGNAME-snmp=		collectd-snmp-$Vp0
d39 2
a40 2
WANTLIB-mysql =		crypto m ssl z
LIB_DEPENDS-mysql =	mysqlclient::databases/mysql
d42 2
a43 2
WANTLIB-pgsql =
LIB_DEPENDS-pgsql =	pq::databases/postgresql
d45 2
a46 2
WANTLIB-rrdtool =       art_lgpl_2 freetype m png z
LIB_DEPENDS-rrdtool =   rrd_th::net/rrdtool
d48 8
d57 2
a58 11
WANTLIB-snmp =		crypto
LIB_DEPENDS-snmp =	netsnmp::net/net-snmp

LIB_DEPENDS +=	curl::net/curl \
		xml2::textproc/libxml \
		statgrab::sysutils/libstatgrab \
		gcrypt::security/libgcrypt \
		ltdl::devel/libtool,-ltdl

WANTLIB += c crypto gpg-error idn intl kvm
WANTLIB += m pcap pthread ssl xml2 z
@


1.2
log
@Full stop for DESCR-files, pass --disable-static to LIBTOOL_FLAGS, and
@@comment .la for plugins. Bump PKGNAMEs.
prodded by/ok ajacoutot@@
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.1.1.1 2010/06/23 18:04:26 landry Exp $
d11 1
a11 1
PKGNAME-main =		collectd-$Vp0
@


1.1
log
@Initial revision
@
text
@d1 1
a1 1
# $OpenBSD$
d11 5
a15 5
PKGNAME-main =		collectd-$V
PKGNAME-mysql =		collectd-mysql-$V
PKGNAME-pgsql =		collectd-pgsql-$V
PKGNAME-rrdtool =	collectd-rrdtool-$V
PKGNAME-snmp=		collectd-snmp-$V
d58 1
@


1.1.1.1
log
@Import of collectd 4.10, yet another monitoring daemon :

collectd gathers statistics about the system it is running on and stores
this information. Those statistics can then be used to find current
performance bottlenecks (i.e. performance analysis) and predict future
system load (i.e. capacity planning). Or if you just want pretty graphs
of your private server and are fed up with some homegrown solution
you're at the right place, too ;).

Reworked by bernd@@ to use MULTI_PACKAGES instead of FLAVORS, thanks!
With feedback from Nico Szalay.

ok bernd@@
@
text
@@
