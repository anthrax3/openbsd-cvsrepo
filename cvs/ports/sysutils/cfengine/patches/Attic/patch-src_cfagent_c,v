head	1.6;
access;
symbols
	OPENBSD_4_2:1.5.0.8
	OPENBSD_4_2_BASE:1.5
	OPENBSD_4_1:1.5.0.6
	OPENBSD_4_1_BASE:1.5
	OPENBSD_4_0:1.5.0.4
	OPENBSD_4_0_BASE:1.5
	OPENBSD_3_9:1.5.0.2
	OPENBSD_3_9_BASE:1.5
	OPENBSD_3_8:1.4.0.2
	OPENBSD_3_8_BASE:1.4
	OPENBSD_3_7:1.3.0.2
	OPENBSD_3_7_BASE:1.3
	OPENBSD_3_6:1.2.0.2
	OPENBSD_3_6_BASE:1.2;
locks; strict;
comment	@# @;


1.6
date	2007.10.12.20.12.19;	author sturm;	state dead;
branches;
next	1.5;

1.5
date	2005.10.27.21.47.28;	author sturm;	state Exp;
branches;
next	1.4;

1.4
date	2005.07.21.15.16.46;	author aanriot;	state Exp;
branches;
next	1.3;

1.3
date	2004.10.01.21.22.15;	author sturm;	state Exp;
branches;
next	1.2;

1.2
date	2004.08.08.14.02.11;	author sturm;	state Exp;
branches;
next	1.1;

1.1
date	2004.06.17.11.21.42;	author sturm;	state Exp;
branches;
next	;


desc
@@


1.6
log
@update to cfengine 2.2.1
simplify port drastically by removing str* patches, these might be
revived one day as an external patch

no objections from maintainer
@
text
@$OpenBSD: patch-src_cfagent_c,v 1.5 2005/10/27 21:47:28 sturm Exp $
--- src/cfagent.c.orig	Wed Sep 21 16:06:14 2005
+++ src/cfagent.c	Fri Oct 21 16:35:54 2005
@@@@ -205,7 +205,7 @@@@ void Initialize(int argc,char *argv[])
   unsigned char s[16];
   char ebuff[CF_EXPANDSIZE];
   
-strcpy(VDOMAIN,CF_START_DOMAIN);
+(void)strlcpy(VDOMAIN,CF_START_DOMAIN,sizeof(VDOMAIN));
 
 PreLockState();
 
@@@@ -218,7 +218,7 @@@@ VMAILSERVER[0] = '\0';
 ALLCLASSBUFFER[0] = '\0';
 VREPOSITORY = strdup("\0");
 
-strcpy(METHODNAME,"cf-nomethod"); 
+(void)strlcpy(METHODNAME,"cf-nomethod",sizeof(METHODNAME)); 
 METHODREPLYTO[0] = '\0';
 METHODFOR[0] = '\0';
  
@@@@ -226,8 +226,8 @@@@ METHODFOR[0] = '\0';
 re_syntax_options |= RE_INTERVALS;
 #endif
  
-strcpy(VINPUTFILE,"cfagent.conf");
-strcpy(VNFSTYPE,"nfs");
+(void)strlcpy(VINPUTFILE,"cfagent.conf",CF_BUFSIZE);
+(void)strlcpy(VNFSTYPE,"nfs",sizeof(VNFSTYPE));
 
 IDClasses();
  
@@@@ -270,27 +270,28 @@@@ for (i = 1; i < argc; i++)
 
  /* XXX Initialize workdir for non privileged users */
 
- strcpy(CFWORKDIR,WORKDIR);
+ (void)strlcpy(CFWORKDIR,WORKDIR,sizeof(CFWORKDIR));
 
  if (getuid() > 0)
     {
     char *homedir;
     if ((homedir = getenv("HOME")) != NULL)
        {
-       strcpy(CFWORKDIR,homedir);
-       strcat(CFWORKDIR,"/.cfagent");
+       (void)strlcpy(CFWORKDIR,homedir,sizeof(CFWORKDIR));
+       (void)strlcat(CFWORKDIR,"/.cfagent",sizeof(CFWORKDIR));
        }
     }
  
- sprintf(ebuff,"%s/state/cf_procs",CFWORKDIR);
+ (void)snprintf(ebuff,sizeof(ebuff),"%s/state/cf_procs",CFWORKDIR);
  
  if (stat(ebuff,&statbuf) == -1)
     {
     CreateEmptyFile(ebuff);
     }
  
- strcpy(VLOGDIR,CFWORKDIR); 
- strcpy(VLOCKDIR,VLOGDIR);  /* Same since 2.0.a8 */
+ (void)strlcpy(VLOGDIR,CFWORKDIR,CF_BUFSIZE); 
+ (void)strlcpy(VLOCKDIR,VLOGDIR,CF_BUFSIZE);  /* Same since 2.0.a8 */
+
  
  OpenSSL_add_all_algorithms();
  ERR_load_crypto_strings();
@@@@ -323,8 +324,8 @@@@ if (NOPRECONFIG)
    return;
    }
 
-strcpy(VPREFIX,"cfengine:");
-strcat(VPREFIX,VUQNAME);
+(void)strlcpy(VPREFIX,"cfengine:",40);
+(void)strlcat(VPREFIX,VUQNAME, 40);
  
 if ((sp=getenv(CF_INPUTSVAR)) != NULL)
    {
@@@@ -617,8 +618,8 @@@@ if (strlen(ebuff) != 0)
    }
 else
    {
-   strcpy(VPREFIX,"cfengine:");
-   strcat(VPREFIX,VUQNAME);
+   (void)strlcpy(VPREFIX,"cfengine:",40);
+   (void)strlcat(VPREFIX,VUQNAME,40);
    }
 
 p2 = SortItemListNames(VHEAP);
@@@@ -765,7 +766,7 @@@@ if (VACTIONSEQ == NULL)
    Warning("perhaps cfagent.conf/update.conf have not yet been set up?");
    }
 
-sprintf(id,"%d",geteuid());   /* get effective user id */
+(void)snprintf(id,sizeof(id),"%d",geteuid());   /* get effective user id */
 
 if (VACCESSLIST != NULL && !IsItemIn(VACCESSLIST,id))
    {
@@@@ -920,7 +921,7 @@@@ if (OptionIs(CONTEXTID,"DryRun",true))
 
 if (GetMacroValue(CONTEXTID,"BinaryPaddingChar"))
    {
-   strcpy(ebuff,GetMacroValue(CONTEXTID,"BinaryPaddingChar"));
+   (void)strlcpy(ebuff,GetMacroValue(CONTEXTID,"BinaryPaddingChar"),sizeof(ebuff));
    
    if (ebuff[0] == '\\')
       {
@@@@ -1520,7 +1521,7 @@@@ while (*sp != '\0')
       {
       VIFELAPSED = VDEFAULTIFELAPSED;
       VEXPIREAFTER = VDEFAULTEXPIREAFTER;
-      strcpy(actiontxt,cbuff);
+      (void)strlcpy(actiontxt,cbuff,sizeof(actiontxt));
       continue;
       }
    else
@@@@ -1861,8 +1862,8 @@@@ for (ip = VHEAP; ip != NULL; ip=ip->next
       else
          {
          size++; /* Allow for : separator */
-         strcat(ALLCLASSBUFFER,ip->name);
-         strcat(ALLCLASSBUFFER,":");
+         (void)strlcat(ALLCLASSBUFFER,ip->name,sizeof(ALLCLASSBUFFER));
+         (void)strlcat(ALLCLASSBUFFER,":",sizeof(ALLCLASSBUFFER));
          }
 
       fprintf(fp,"%s\n",ip->name);
@@@@ -1881,8 +1882,8 @@@@ for (ip = VHEAP; ip != NULL; ip=ip->next
       else
          {
          size++; /* Allow for : separator */
-         strcat(ALLCLASSBUFFER,ip->name);
-         strcat(ALLCLASSBUFFER,":");         
+         (void)strlcat(ALLCLASSBUFFER,ip->name,sizeof(ALLCLASSBUFFER));
+         (void)strlcat(ALLCLASSBUFFER,":",sizeof(ALLCLASSBUFFER));
          }
       
       fprintf(fp,"%s\n",ip->name);
@


1.5
log
@update to 2.1.16, removing sbin/vicf which seems to have a security
problem but is not used anywhere and will probably be removed from
cfengine

from maintainer William Yodlowsky <bsd at openbsd.rutgers.edu>
@
text
@d1 1
a1 1
$OpenBSD: patch-src_cfagent_c,v 1.4 2005/07/21 15:16:46 aanriot Exp $
@


1.4
log
@update to 2.1.15, from William Yodlowsky (maintainer).

inputs and ok naddy@@
@
text
@d1 4
a4 4
$OpenBSD: patch-src_cfagent_c,v 1.3 2004/10/01 21:22:15 sturm Exp $
--- src/cfagent.c.orig	Thu Apr  7 15:29:49 2005
+++ src/cfagent.c	Fri Jul 15 12:24:00 2005
@@@@ -206,7 +206,7 @@@@ void Initialize(int argc,char *argv[])
d13 1
a13 1
@@@@ -219,7 +219,7 @@@@ VMAILSERVER[0] = '\0';
d22 1
a22 1
@@@@ -227,8 +227,8 @@@@ METHODFOR[0] = '\0';
d33 1
a33 1
@@@@ -271,27 +271,28 @@@@ for (i = 1; i < argc; i++)
d68 1
a68 1
@@@@ -324,8 +325,8 @@@@ if (NOPRECONFIG)
d79 1
a79 1
@@@@ -618,8 +619,8 @@@@ if (strlen(ebuff) != 0)
d90 1
a90 1
@@@@ -766,7 +767,7 @@@@ if (VACTIONSEQ == NULL)
d99 1
a99 1
@@@@ -921,7 +922,7 @@@@ if (OptionIs(CONTEXTID,"DryRun",true))
d108 1
a108 10
@@@@ -1106,7 +1107,7 @@@@ if ((tloc = time((time_t *)NULL)) == -1)
 
 CFSTARTTIME = tloc;
 
-snprintf(vbuff,CF_BUFSIZE,"%s",ctime(&tloc));
+snprintf(vbuff,CF_MAXVARSIZE,"%s",ctime(&tloc));
 
 Verbose("Reference time set to %s\n",ctime(&tloc));
 
@@@@ -1491,7 +1492,7 @@@@ while (*sp != '\0')
d117 1
a117 1
@@@@ -1926,8 +1927,8 @@@@ for (ip = VHEAP; ip != NULL; ip=ip->next
d128 1
a128 1
@@@@ -1946,8 +1947,8 @@@@ for (ip = VHEAP; ip != NULL; ip=ip->next
@


1.3
log
@unbreak and update to 2.1.10

from maintainer William Yodlowsky <bsd at openbsd.rutgers.edu>
@
text
@d1 4
a4 4
$OpenBSD$
--- src/cfagent.c.orig	Sat Aug 14 00:14:19 2004
+++ src/cfagent.c	Fri Oct  1 23:14:46 2004
@@@@ -217,7 +217,7 @@@@ void Initialize(int argc,char *argv[])
d12 2
a13 2
  
@@@@ -231,7 +231,7 @@@@ VDEFAULTROUTE[0] = '\0';
d22 1
a22 1
@@@@ -239,8 +239,8 @@@@ METHODFOR[0] = '\0';
d33 18
a50 3
@@@@ -281,15 +281,15 @@@@ for (i = 1; i < argc; i++)
  VIFELAPSED = VDEFAULTIFELAPSED;
  TRAVLINKS = false;
d52 2
a53 2
- sprintf(ebuff,"%s/state/cf_procs",WORKDIR);
+ (void)snprintf(ebuff,sizeof(ebuff),"%s/state/cf_procs",WORKDIR);
d60 1
a60 1
- strcpy(VLOGDIR,WORKDIR); 
d62 1
a62 1
+ (void)strlcpy(VLOGDIR,WORKDIR,CF_BUFSIZE); 
d64 1
d68 1
a68 1
@@@@ -318,8 +318,8 @@@@ if (NOPRECONFIG)
d79 1
a79 1
@@@@ -605,8 +605,8 @@@@ if (strlen(ebuff) != 0)
d90 1
a90 1
@@@@ -747,7 +747,7 @@@@ if (VACTIONSEQ == NULL)
d99 1
a99 1
@@@@ -897,7 +897,7 @@@@ if (OptionIs(CONTEXTID,"DryRun",true))
d108 1
a108 1
@@@@ -1075,7 +1075,7 @@@@ if ((tloc = time((time_t *)NULL)) == -1)
d117 1
a117 1
@@@@ -1438,7 +1438,7 @@@@ while (*sp != '\0')
d126 1
a126 1
@@@@ -1859,8 +1859,8 @@@@ for (ip = VHEAP; ip != NULL; ip=ip->next
d137 1
a137 1
@@@@ -1879,8 +1879,8 @@@@ for (ip = VHEAP; ip != NULL; ip=ip->next
@


1.2
log
@update to cfengine 2.1.7p1

from maintainer William Yodlowsky <bsd at openbsd.rutgers.edu>
@
text
@d1 3
a3 3
$OpenBSD: patch-src_cfagent_c,v 1.1 2004/06/17 11:21:42 sturm Exp $
--- src/cfagent.c.orig	Wed Jun 23 17:58:01 2004
+++ src/cfagent.c	Mon Aug  2 13:30:32 2004
d21 2
a22 2
 METHODRETURNVARS[0] = '\0';
@@@@ -241,8 +241,8 @@@@ METHODRETURNCLASSES[0] = '\0';
d33 1
a33 1
@@@@ -283,15 +283,15 @@@@ for (i = 1; i < argc; i++)
d52 1
a52 1
@@@@ -320,8 +320,8 @@@@ if (NOPRECONFIG)
d63 1
a63 1
@@@@ -608,8 +608,8 @@@@ if (strlen(ebuff) != 0)
d74 1
a74 1
@@@@ -750,7 +750,7 @@@@ if (VACTIONSEQ == NULL)
d83 1
a83 1
@@@@ -900,7 +900,7 @@@@ if (OptionIs(CONTEXTID,"DryRun",true))
d92 1
a92 1
@@@@ -1078,7 +1078,7 @@@@ if ((tloc = time((time_t *)NULL)) == -1)
d101 1
a101 1
@@@@ -1441,7 +1441,7 @@@@ while (*sp != '\0')
d110 2
a111 1
@@@@ -1841,8 +1841,8 @@@@ for (ip = VHEAP; ip != NULL; ip=ip->next
d114 4
d119 5
a123 8
-      strcat(ALLCLASSBUFFER,ip->name);
-      strcat(ALLCLASSBUFFER,":");
+      (void)strlcat(ALLCLASSBUFFER,ip->name,sizeof(ALLCLASSBUFFER));
+      (void)strlcat(ALLCLASSBUFFER,":",sizeof(ALLCLASSBUFFER));
       }
    }
  
@@@@ -1861,8 +1861,8 @@@@ for (ip = VHEAP; ip != NULL; ip=ip->next
d125 4
d131 1
a131 7
-      strcat(ALLCLASSBUFFER,ip->name);
-      strcat(ALLCLASSBUFFER,":");
+      (void)strlcat(ALLCLASSBUFFER,ip->name,sizeof(ALLCLASSBUFFER));
+      (void)strlcat(ALLCLASSBUFFER,":",sizeof(ALLCLASSBUFFER));
       }
     }
  
@


1.1
log
@revive cfengine port

this is version 2.1.6, from and maintained by
William Yodlowsky <bsd at openbsd.rutgers.edu>
@
text
@d1 4
a4 4
$OpenBSD$
--- src/cfagent.c.orig	Sat Apr 17 16:10:58 2004
+++ src/cfagent.c	Thu Jun 17 12:54:38 2004
@@@@ -214,7 +214,7 @@@@ void Initialize(int argc,char *argv[])
d12 2
a13 2
 SetSignals(); 
@@@@ -229,7 +229,7 @@@@ VDEFAULTROUTE[0] = '\0';
d20 1
d22 1
a22 2
 METHODRETURNCLASSES[0] = '\0';
@@@@ -238,8 +238,8 @@@@ METHODRETURNCLASSES[0] = '\0';
d33 1
a33 1
@@@@ -280,7 +280,7 @@@@ for (i = 1; i < argc; i++)
a41 1
@@@@ -287,8 +287,8 @@@@ for (i = 1; i < argc; i++)
d52 1
a52 1
@@@@ -317,8 +317,8 @@@@ if (NOPRECONFIG)
d63 1
a63 1
@@@@ -605,8 +605,8 @@@@ if (strlen(ebuff) != 0)
d73 2
a74 2
 
@@@@ -744,7 +744,7 @@@@ if (VACTIONSEQ == NULL)
d83 1
a83 1
@@@@ -888,7 +888,7 @@@@ if (OptionIs(CONTEXTID,"DryRun",true))
d92 1
a92 1
@@@@ -1066,7 +1066,7 @@@@ if ((tloc = time((time_t *)NULL)) == -1)
d101 1
a101 1
@@@@ -1429,7 +1429,7 @@@@ while (*sp != '\0')
d110 1
a110 1
@@@@ -1828,8 +1828,8 @@@@ for (ip = VHEAP; ip != NULL; ip=ip->next
d121 1
a121 1
@@@@ -1848,8 +1848,8 @@@@ for (ip = VHEAP; ip != NULL; ip=ip->next
@

