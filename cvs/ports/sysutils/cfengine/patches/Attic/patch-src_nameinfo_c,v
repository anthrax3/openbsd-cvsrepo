head	1.6;
access;
symbols
	OPENBSD_4_2:1.5.0.8
	OPENBSD_4_2_BASE:1.5
	OPENBSD_4_1:1.5.0.6
	OPENBSD_4_1_BASE:1.5
	OPENBSD_4_0:1.5.0.4
	OPENBSD_4_0_BASE:1.5
	OPENBSD_3_9:1.5.0.2
	OPENBSD_3_9_BASE:1.5
	OPENBSD_3_8:1.4.0.2
	OPENBSD_3_8_BASE:1.4
	OPENBSD_3_7:1.3.0.2
	OPENBSD_3_7_BASE:1.3
	OPENBSD_3_6:1.2.0.2
	OPENBSD_3_6_BASE:1.2;
locks; strict;
comment	@# @;


1.6
date	2007.10.12.20.12.19;	author sturm;	state dead;
branches;
next	1.5;

1.5
date	2005.10.27.21.47.28;	author sturm;	state Exp;
branches;
next	1.4;

1.4
date	2005.07.21.15.16.47;	author aanriot;	state Exp;
branches;
next	1.3;

1.3
date	2004.10.01.21.22.15;	author sturm;	state Exp;
branches;
next	1.2;

1.2
date	2004.08.08.14.02.11;	author sturm;	state Exp;
branches;
next	1.1;

1.1
date	2004.06.17.11.21.43;	author sturm;	state Exp;
branches;
next	;


desc
@@


1.6
log
@update to cfengine 2.2.1
simplify port drastically by removing str* patches, these might be
revived one day as an external patch

no objections from maintainer
@
text
@$OpenBSD: patch-src_nameinfo_c,v 1.5 2005/10/27 21:47:28 sturm Exp $
--- src/nameinfo.c.orig	Tue Jul 26 08:26:33 2005
+++ src/nameinfo.c	Fri Oct 21 16:35:56 2005
@@@@ -59,6 +59,7 @@@@ void GetNameInfo()
   time_t tloc;
   struct hostent *hp;
   struct sockaddr_in cin;
+  size_t buflen;
 #ifdef AIX
   char real_version[_SYS_NMLN];
 #endif
@@@@ -127,12 +128,13 @@@@ for (i = 0; CLASSATTRIBUTES[i][0] != '\0
       }
    }
 
-if ((sp = malloc(strlen(VSYSNAME.nodename)+1)) == NULL)
+buflen = strlen(VSYSNAME.nodename) + 1;
+if ((sp = malloc(buflen)) == NULL)
    {
    FatalError("malloc failure in initialize()");
    }
 
-strcpy(sp,VSYSNAME.nodename);
+(void)strlcpy(sp,VSYSNAME.nodename,buflen);
 SetDomainName(sp);
 
 for (sp2=sp; *sp2 != '\0'; sp2++)  /* Add some domain hierarchy classes */
@@@@ -204,7 +206,7 @@@@ if (VERBOSE || DEBUG || D2 || D3)
    }
 
 
-sprintf(VBUFF,"%d_bit",sizeof(long)*8);
+(void)snprintf(VBUFF,sizeof(VBUFF),"%d_bit",sizeof(long)*8);
 AddClassToHeap(VBUFF);
 Verbose("Additional hard class defined as: %s\n",CanonifyName(VBUFF));
 
@@@@ -285,8 +287,8 @@@@ if (! found)
    CfLog(cferror,"Cfengine: I don't understand what architecture this is!","");
    }
 
-strcpy(VBUFF,"compiled_on_"); 
-strcat(VBUFF,CanonifyName(AUTOCONF_SYSNAME));
+(void)strlcpy(VBUFF,"compiled_on_",sizeof(VBUFF)); 
+(void)strlcat(VBUFF,CanonifyName(AUTOCONF_SYSNAME),sizeof(VBUFF));
 
 AddClassToHeap(CanonifyName(VBUFF));
 
@@@@ -303,7 +305,7 @@@@ else
    memset(&cin,0,sizeof(cin));
    cin.sin_addr.s_addr = ((struct in_addr *)(hp->h_addr))->s_addr;
    Verbose("Address given by nameserver: %s\n",inet_ntoa(cin.sin_addr));
-   strcpy(VIPADDRESS,inet_ntoa(cin.sin_addr));
+   (void)strlcpy(VIPADDRESS,inet_ntoa(cin.sin_addr),18);
    
    for (i=0; hp->h_aliases[i]!= NULL; i++)
       {
@@@@ -414,7 +416,7 @@@@ for (j = 0,len = 0,ifp = list.ifc_req; l
             }
          
          /* Old style compat */
-         strcpy(ip,inet_ntoa(sin->sin_addr));
+         (void)strlcpy(ip,inet_ntoa(sin->sin_addr),sizeof(ip));
          AppendItem(&IPADDRESSES,ip,"");
          
          for (sp = ip+strlen(ip)-1; *sp != '.'; sp--)
@@@@ -425,8 +427,8 @@@@ for (j = 0,len = 0,ifp = list.ifc_req; l
          
             
          /* New style */
-         strcpy(ip,"ipv4_");
-         strcat(ip,inet_ntoa(sin->sin_addr));
+         (void)strlcpy(ip,"ipv4_",sizeof(ip));
+         (void)strlcat(ip,inet_ntoa(sin->sin_addr),sizeof(ip));
          AddClassToHeap(CanonifyName(ip));
          snprintf(name,CF_MAXVARSIZE-1,"ipv4[%s]",CanonifyName(ifp->ifr_name));
          AddMacroValue(CONTEXTID,name,inet_ntoa(sin->sin_addr));
@@@@ -567,9 +569,9 @@@@ void AddNetworkClass(char *netmask) /* F
   if ((nm.s_addr = inet_addr(netmask)) != -1 && (ip.s_addr = inet_addr(VIPADDRESS)) != -1)
      {
      ip.s_addr &= nm.s_addr; /* Will not work with IPv6 */
-     strcpy(ipbuf,inet_ntoa(ip));
+     (void)strlcpy(ipbuf,inet_ntoa(ip),sizeof(ipbuf));
      
-     strcpy(nmbuf,inet_ntoa(nm));
+     (void)strlcpy(nmbuf,inet_ntoa(nm),sizeof(nmbuf));
      
      while( (sp = strrchr(nmbuf,'.')) && strcmp(sp,".0") == 0 )
         {
@@@@ -592,22 +594,22 @@@@ void SetDomainName(char *sp)           /
 
 if (gethostname(fqn, sizeof(fqn)) != -1)
    {
-   strcpy(VFQNAME,fqn);
-   strcpy(buffer,VFQNAME);
+   (void)strlcpy(VFQNAME,fqn,CF_MAXVARSIZE);
+   (void)strlcpy(buffer,VFQNAME,sizeof(buffer));
    AddClassToHeap(CanonifyName(buffer));
    AddClassToHeap(CanonifyName(ToLowerStr(buffer)));
 
    if (strstr(fqn,"."))
       {
       ptr = strchr(fqn, '.');
-      strcpy(VDOMAIN, ++ptr);
+      (void)strlcpy(VDOMAIN, ++ptr, sizeof(VDOMAIN));
       }
    }
 
 if (strstr(VFQNAME,".") == 0 && (strcmp(VDOMAIN,CF_START_DOMAIN) != 0))
    {
-   strcat(VFQNAME,".");
-   strcat(VFQNAME,VDOMAIN);
+   (void)strlcat(VFQNAME,".",CF_MAXVARSIZE);
+   (void)strlcat(VFQNAME,VDOMAIN,CF_MAXVARSIZE);
    }
 
 AddClassToHeap(CanonifyName(VDOMAIN));
@


1.5
log
@update to 2.1.16, removing sbin/vicf which seems to have a security
problem but is not used anywhere and will probably be removed from
cfengine

from maintainer William Yodlowsky <bsd at openbsd.rutgers.edu>
@
text
@d1 1
a1 1
$OpenBSD: patch-src_nameinfo_c,v 1.4 2005/07/21 15:16:47 aanriot Exp $
@


1.4
log
@update to 2.1.15, from William Yodlowsky (maintainer).

inputs and ok naddy@@
@
text
@d1 3
a3 3
$OpenBSD: patch-src_nameinfo_c,v 1.3 2004/10/01 21:22:15 sturm Exp $
--- src/nameinfo.c.orig	Wed May 25 03:29:36 2005
+++ src/nameinfo.c	Fri Jul 15 12:24:01 2005
d57 1
a57 1
@@@@ -411,7 +413,7 @@@@ for (j = 0,len = 0,ifp = list.ifc_req; l
d66 1
a66 1
@@@@ -422,8 +424,8 @@@@ for (j = 0,len = 0,ifp = list.ifc_req; l
d77 1
a77 1
@@@@ -544,9 +546,9 @@@@ void AddNetworkClass(char *netmask) /* F
d89 1
a89 1
@@@@ -569,22 +571,22 @@@@ void SetDomainName(char *sp)           /
@


1.3
log
@unbreak and update to 2.1.10

from maintainer William Yodlowsky <bsd at openbsd.rutgers.edu>
@
text
@d1 3
a3 3
$OpenBSD$
--- src/nameinfo.c.orig	Tue Aug 17 08:54:14 2004
+++ src/nameinfo.c	Fri Oct  1 23:14:49 2004
d12 1
a12 1
@@@@ -129,12 +130,13 @@@@ for (i = 0; CLASSATTRIBUTES[i][0] != '\0
d27 2
a28 2
 for (sp2=sp; *sp2 != '\0'; sp2++)  /* Truncate fully qualified name */
@@@@ -190,7 +192,7 @@@@ if (VERBOSE || DEBUG || D2 || D3)
d37 1
a37 1
@@@@ -259,8 +261,8 @@@@ if (! found)
d48 1
a48 1
@@@@ -277,7 +279,7 @@@@ else
d57 1
a57 1
@@@@ -385,7 +387,7 @@@@ for (j = 0,len = 0,ifp = list.ifc_req; l
d66 1
a66 1
@@@@ -396,8 +398,8 @@@@ for (j = 0,len = 0,ifp = list.ifc_req; l
d77 1
a77 1
@@@@ -505,9 +507,9 @@@@ void AddNetworkClass(char *netmask) /* F
d89 1
a89 1
@@@@ -530,22 +532,22 @@@@ void SetDomainName(char *sp)           /
@


1.2
log
@update to cfengine 2.1.7p1

from maintainer William Yodlowsky <bsd at openbsd.rutgers.edu>
@
text
@d1 3
a3 3
$OpenBSD: patch-src_nameinfo_c,v 1.1 2004/06/17 11:21:43 sturm Exp $
--- src/nameinfo.c.orig	Wed Jun 23 17:55:31 2004
+++ src/nameinfo.c	Mon Aug  2 13:30:36 2004
d57 21
a77 21
@@@@ -382,7 +384,7 @@@@ for (j = 0,len = 0,ifp = list.ifc_req; l
                   }
                
                /* Old style compat */
-               strcpy(ip,inet_ntoa(sin->sin_addr));
+               (void)strlcpy(ip,inet_ntoa(sin->sin_addr),sizeof(ip));
                AppendItem(&IPADDRESSES,ip,"");
                
                for (sp = ip+strlen(ip)-1; *sp != '.'; sp--)
@@@@ -393,8 +395,8 @@@@ for (j = 0,len = 0,ifp = list.ifc_req; l
                
                
                /* New style */
-               strcpy(ip,"ipv4_");
-               strcat(ip,inet_ntoa(sin->sin_addr));
+               (void)strlcpy(ip,"ipv4_",sizeof(ip));
+               (void)strlcat(ip,inet_ntoa(sin->sin_addr),sizeof(ip));
                AddClassToHeap(CanonifyName(ip));
                snprintf(name,CF_MAXVARSIZE-1,"ipv4[%s]",CanonifyName(ifp->ifr_name));
                AddMacroValue(CONTEXTID,name,inet_ntoa(sin->sin_addr));
@@@@ -503,9 +505,9 @@@@ void AddNetworkClass(char *netmask) /* F
d89 1
a89 1
@@@@ -528,22 +530,22 @@@@ void SetDomainName(char *sp)           /
@


1.1
log
@revive cfengine port

this is version 2.1.6, from and maintained by
William Yodlowsky <bsd at openbsd.rutgers.edu>
@
text
@d1 4
a4 4
$OpenBSD$
--- src/nameinfo.c.orig	Sat May  1 09:40:45 2004
+++ src/nameinfo.c	Thu Jun 17 12:54:40 2004
@@@@ -53,6 +53,7 @@@@ void GetNameInfo()
d12 1
a12 1
@@@@ -123,12 +124,13 @@@@ for (i = 0; CLASSATTRIBUTES[i][0] != '\0
d28 1
a28 1
@@@@ -184,7 +186,7 @@@@ if (VERBOSE || DEBUG || D2 || D3)
d37 1
a37 1
@@@@ -253,8 +255,8 @@@@ if (! found)
d48 1
a48 1
@@@@ -271,7 +273,7 @@@@ else
d57 1
a57 1
@@@@ -376,7 +378,7 @@@@ for (j = 0,len = 0,ifp = list.ifc_req; l
d66 1
a66 1
@@@@ -387,8 +389,8 @@@@ for (j = 0,len = 0,ifp = list.ifc_req; l
d77 1
a77 1
@@@@ -498,9 +500,9 @@@@ void AddNetworkClass(char *netmask) /* F
d89 1
a89 1
@@@@ -523,8 +525,8 @@@@ void SetDomainName(char *sp)           /
a99 1
@@@@ -531,14 +533,14 @@@@ if (gethostname(fqn, sizeof(fqn)) != -1)
@

