head	1.6;
access;
symbols
	OPENBSD_4_2:1.5.0.8
	OPENBSD_4_2_BASE:1.5
	OPENBSD_4_1:1.5.0.6
	OPENBSD_4_1_BASE:1.5
	OPENBSD_4_0:1.5.0.4
	OPENBSD_4_0_BASE:1.5
	OPENBSD_3_9:1.5.0.2
	OPENBSD_3_9_BASE:1.5
	OPENBSD_3_8:1.4.0.2
	OPENBSD_3_8_BASE:1.4
	OPENBSD_3_7:1.3.0.2
	OPENBSD_3_7_BASE:1.3
	OPENBSD_3_6:1.2.0.2
	OPENBSD_3_6_BASE:1.2;
locks; strict;
comment	@# @;


1.6
date	2007.10.12.20.12.19;	author sturm;	state dead;
branches;
next	1.5;

1.5
date	2005.10.27.21.47.28;	author sturm;	state Exp;
branches;
next	1.4;

1.4
date	2005.07.21.15.16.47;	author aanriot;	state Exp;
branches;
next	1.3;

1.3
date	2004.10.01.21.22.15;	author sturm;	state Exp;
branches;
next	1.2;

1.2
date	2004.08.08.14.02.11;	author sturm;	state Exp;
branches;
next	1.1;

1.1
date	2004.06.17.11.21.43;	author sturm;	state Exp;
branches;
next	;


desc
@@


1.6
log
@update to cfengine 2.2.1
simplify port drastically by removing str* patches, these might be
revived one day as an external patch

no objections from maintainer
@
text
@$OpenBSD: patch-src_image_c,v 1.5 2005/10/27 21:47:28 sturm Exp $
--- src/image.c.orig	Thu Aug 18 12:02:59 2005
+++ src/image.c	Fri Oct 21 16:35:55 2005
@@@@ -59,8 +59,8 @@@@ for (ip = VRPCPEERLIST; ip != NULL; ip =
       }
    else
       {
-      strcat(client,".");
-      strcat(client,VDOMAIN);
+      (void)strlcat(client,".",sizeof(client));
+      (void)strlcat(client,VDOMAIN,sizeof(client));
       }
    
    Verbose(" Hailing remote peer %s\n",client);
@@@@ -81,8 +81,8 @@@@ for (ip = VRPCPEERLIST; ip != NULL; ip =
    MINUSMASK = 0377;
    IMAGEBACKUP = 'n';
    ENCRYPT = 'y';
-   strcpy(IMAGEACTION,"fix");
-   strcpy(CLASSBUFF,"any");
+   (void)strlcpy(IMAGEACTION,"fix",CF_BUFSIZE);
+   (void)strlcpy(CLASSBUFF,"any",CF_BUFSIZE);
    snprintf(VUIDNAME,CF_MAXVARSIZE,"%d",getuid());
    snprintf(VGIDNAME,CF_MAXVARSIZE,"%d",getgid());
    IMGCOMP = '>';
@@@@ -193,7 +193,7 @@@@ for (dirp = cfreaddir(dirh,ip); dirp != 
       return;
       }
 
-   strcat(newto,dirp->d_name);
+   (void)strlcat(newto,dirp->d_name,sizeof(newto));
 
    if (TRAVLINKS || ip->linktype == 'n')
       {
@@@@ -364,9 +364,9 @@@@ for (itp = VMOUNTLIST; itp != NULL; itp=
          continue;
          }
 
-      strcpy(homedir,itp->name);
+      (void)strlcpy(homedir,itp->name,sizeof(homedir));
       AddSlash(homedir);
-      strcat(homedir,dirp->d_name);
+      (void)strlcat(homedir,dirp->d_name,sizeof(homedir));
 
       if (! IsHomeDir(homedir))
          {
@@@@ -387,10 +387,10 @@@@ for (itp = VMOUNTLIST; itp != NULL; itp=
             continue;
             }
 
-         strcpy(username,dirp2->d_name);
-         strcpy(dest,homedir);
+         (void)strlcpy(username,dirp2->d_name,sizeof(username));
+         (void)strlcpy(dest,homedir,sizeof(dest));
          AddSlash(dest);
-         strcat(dest,dirp2->d_name);
+         (void)strlcat(dest,dirp2->d_name,sizeof(dest));
          
          if (strlen(ip->destination) > 4)
             {
@@@@ -403,7 +403,7 @@@@ for (itp = VMOUNTLIST; itp != NULL; itp=
                }
             else
                {
-               strcat(dest,(ip->destination)+strlen("home/"));
+               (void)strlcat(dest,(ip->destination)+strlen("home/"),sizeof(dest));
                }
             }
          
@@@@ -505,9 +505,9 @@@@ if ((ip->gid)->gid == (gid_t)-1)
 
 if (S_ISDIR(sourcestatbuf.st_mode))
    {
-   strcpy(sourcedir,source);
+   (void)strlcpy(sourcedir,source,sizeof(sourcedir));
    AddSlash(sourcedir);
-   strcpy(destdir,destination);
+   (void)strlcpy(destdir,destination,sizeof(destdir));
    AddSlash(destdir);
 
    if ((dirh = cfopendir(sourcedir,ip)) == NULL)
@@@@ -539,22 +539,22 @@@@ if (S_ISDIR(sourcestatbuf.st_mode))
          continue;
          }
 
-      strcpy(sourcefile, sourcedir);
+      (void)strlcpy(sourcefile, sourcedir, sizeof(sourcefile));
       
       if (BufferOverflow(sourcefile,dirp->d_name))
          {
          FatalError("Culprit: CheckImage");
          }
       
-      strcat(sourcefile, dirp->d_name);
-      strcpy(destfile, destdir);
+      (void)strlcat(sourcefile, dirp->d_name, sizeof(sourcefile));
+      (void)strlcpy(destfile, destdir, sizeof(destfile));
       
       if (BufferOverflow(destfile,dirp->d_name))
          {
          FatalError("Culprit: CheckImage");
          }
       
-      strcat(destfile, dirp->d_name);
+      (void)strlcat(destfile, dirp->d_name, sizeof(destfile));
       
       if (cflstat(sourcefile,&sourcestatbuf,ip) == -1)
          {
@@@@ -575,8 +575,8 @@@@ if (S_ISDIR(sourcestatbuf.st_mode))
    return;
    }
  
- strcpy(sourcefile,source);
- strcpy(destfile,destination);
+ (void)strlcpy(sourcefile,source,sizeof(sourcefile));
+ (void)strlcpy(destfile,destination,sizeof(destfile));
  
  ImageCopy(sourcefile,destfile,sourcestatbuf,ip);
  (ip->uid)->uid = save_uid;
@@@@ -1011,7 +1011,7 @@@@ if (ip->linktype != 'n')
       
       if (ip->linktype == 'a' && linkbuf[0] != '/')      /* Not absolute path - must fix */
          {
-         strcpy(VBUFF,sourcefile);
+         (void)strlcpy(VBUFF,sourcefile,sizeof(VBUFF));
          ChopLastNode(VBUFF);
          AddSlash(VBUFF);
          strncat(VBUFF,linkbuf,CF_BUFSIZE-1);
@@@@ -1399,7 +1399,7 @@@@ for (sp = ip->cache; sp != NULL; sp=sp->
   else
      {
      memset(linkbuf,0,buffsize);
-     strcpy(linkbuf,sp->cf_readlink);
+     (void)strlcpy(linkbuf,sp->cf_readlink,buffsize);
      return 0;
      }
   }
@@@@ -1587,13 +1587,13 @@@@ if (BufferOverflow(dest,CF_NEW))
    printf(" culprit: CopyReg\n");
    return false;
    }
-strcpy(new,dest);
+(void)strlcpy(new,dest,sizeof(new));
 
 #ifdef DARWIN
    }
 #endif
 
-strcat(new,CF_NEW);
+(void)strlcat(new,CF_NEW,sizeof(new));
 
 if (remote)
    {
@@@@ -1632,22 +1632,22 @@@@ if (IMAGEBACKUP != 'n')
    time_t STAMPNOW;
    STAMPNOW = time((time_t *)NULL);
    
-   sprintf(stamp, "_%d_%s", CFSTARTTIME, CanonifyName(ctime(&STAMPNOW)));
+   (void)snprintf(stamp, sizeof(stamp), "_%d_%s", CFSTARTTIME, CanonifyName(ctime(&STAMPNOW)));
 
    if (BufferOverflow(dest,stamp))
       {
       printf(" culprit: CopyReg\n");
       return false;
       }
-   strcpy(backup,dest);
+   (void)strlcpy(backup,dest,sizeof(backup));
 
    if (IMAGEBACKUP == 's')
       {
-      strcat(backup,stamp);
+      (void)strlcat(backup,stamp,sizeof(backup));
       }
 
    /* rely on prior BufferOverflow() and on strlen(CF_SAVED) < CF_BUFFERMARGIN */
-   strcat(backup,CF_SAVED);
+   (void)strlcat(backup,CF_SAVED,sizeof(backup));
 
    if (IsItemIn(VREPOSLIST,backup))
       {
@


1.5
log
@update to 2.1.16, removing sbin/vicf which seems to have a security
problem but is not used anywhere and will probably be removed from
cfengine

from maintainer William Yodlowsky <bsd at openbsd.rutgers.edu>
@
text
@d1 1
a1 1
$OpenBSD: patch-src_image_c,v 1.4 2005/07/21 15:16:47 aanriot Exp $
@


1.4
log
@update to 2.1.15, from William Yodlowsky (maintainer).

inputs and ok naddy@@
@
text
@d1 3
a3 3
$OpenBSD: patch-src_image_c,v 1.3 2004/10/01 21:22:15 sturm Exp $
--- src/image.c.orig	Sun May 29 07:04:05 2005
+++ src/image.c	Fri Jul 15 12:24:01 2005
d26 1
a26 1
@@@@ -190,7 +190,7 @@@@ for (dirp = cfreaddir(dirh,ip); dirp != 
d35 1
a35 1
@@@@ -361,9 +361,9 @@@@ for (itp = VMOUNTLIST; itp != NULL; itp=
d47 1
a47 1
@@@@ -384,10 +384,10 @@@@ for (itp = VMOUNTLIST; itp != NULL; itp=
d61 1
a61 1
@@@@ -400,7 +400,7 @@@@ for (itp = VMOUNTLIST; itp != NULL; itp=
d70 1
a70 1
@@@@ -502,9 +502,9 @@@@ if ((ip->gid)->gid == (gid_t)-1)
d82 1
a82 1
@@@@ -536,22 +536,22 @@@@ if (S_ISDIR(sourcestatbuf.st_mode))
d109 1
a109 1
@@@@ -572,8 +572,8 @@@@ if (S_ISDIR(sourcestatbuf.st_mode))
d120 1
a120 1
@@@@ -1008,7 +1008,7 @@@@ if (ip->linktype != 'n')
d129 1
a129 1
@@@@ -1396,7 +1396,7 @@@@ for (sp = ip->cache; sp != NULL; sp=sp->
d138 1
a138 1
@@@@ -1584,13 +1584,13 @@@@ if (BufferOverflow(dest,CF_NEW))
d154 1
a154 1
@@@@ -1629,22 +1629,22 @@@@ if (IMAGEBACKUP != 'n')
@


1.3
log
@unbreak and update to 2.1.10

from maintainer William Yodlowsky <bsd at openbsd.rutgers.edu>
@
text
@d1 26
a26 26
$OpenBSD$
--- src/image.c.orig	Thu Aug 12 22:16:20 2004
+++ src/image.c	Fri Oct  1 23:14:48 2004
@@@@ -57,8 +57,8 @@@@ Banner("Looking for remote method collab
        }
     else
        {
-       strcat(client,".");
-       strcat(client,VDOMAIN);
+       (void)strlcat(client,".",sizeof(client));
+       (void)strlcat(client,VDOMAIN,sizeof(client));
        }
 
     Verbose(" Hailing remote peer %s\n",client);
@@@@ -81,8 +81,8 @@@@ Banner("Looking for remote method collab
     MINUSMASK = 0377;
     IMAGEBACKUP = 'n';
     ENCRYPT = 'y';
-    strcpy(IMAGEACTION,"fix");
-    strcpy(CLASSBUFF,"any");
+    (void)strlcpy(IMAGEACTION,"fix",CF_BUFSIZE);
+    (void)strlcpy(CLASSBUFF,"any",CF_BUFSIZE);
     snprintf(VUIDNAME,CF_MAXVARSIZE,"%d",getuid());
     snprintf(VGIDNAME,CF_MAXVARSIZE,"%d",getgid());
     IMGCOMP = '>';
@@@@ -189,7 +189,7 @@@@ for (dirp = cfreaddir(dirh,ip); dirp != 
d35 1
a35 1
@@@@ -360,9 +360,9 @@@@ for (itp = VMOUNTLIST; itp != NULL; itp=
d47 1
a47 1
@@@@ -383,10 +383,10 @@@@ for (itp = VMOUNTLIST; itp != NULL; itp=
d61 1
a61 1
@@@@ -399,7 +399,7 @@@@ for (itp = VMOUNTLIST; itp != NULL; itp=
d70 1
a70 1
@@@@ -501,9 +501,9 @@@@ if ((ip->gid)->gid == (gid_t)-1)
d82 1
a82 1
@@@@ -535,22 +535,22 @@@@ if (S_ISDIR(sourcestatbuf.st_mode))
d109 1
a109 1
@@@@ -571,8 +571,8 @@@@ if (S_ISDIR(sourcestatbuf.st_mode))
d120 1
a120 1
@@@@ -1007,7 +1007,7 @@@@ if (ip->linktype != 'n')
d129 1
a129 1
@@@@ -1383,7 +1383,7 @@@@ for (sp = ip->cache; sp != NULL; sp=sp->
d138 1
a138 1
@@@@ -1571,13 +1571,13 @@@@ if (BufferOverflow(dest,CF_NEW))
d154 1
a154 1
@@@@ -1616,22 +1616,22 @@@@ if (IMAGEBACKUP != 'n')
@


1.2
log
@update to cfengine 2.1.7p1

from maintainer William Yodlowsky <bsd at openbsd.rutgers.edu>
@
text
@d1 3
a3 3
$OpenBSD: patch-src_image_c,v 1.1 2004/06/17 11:21:43 sturm Exp $
--- src/image.c.orig	Fri Apr 30 11:20:19 2004
+++ src/image.c	Mon Aug  2 13:30:34 2004
d120 1
a120 1
@@@@ -1005,7 +1005,7 @@@@ if (ip->linktype != 'n')
d129 1
a129 1
@@@@ -1381,7 +1381,7 @@@@ for (sp = ip->cache; sp != NULL; sp=sp->
d138 1
a138 1
@@@@ -1569,13 +1569,13 @@@@ if (BufferOverflow(dest,CF_NEW))
d154 1
a154 1
@@@@ -1614,22 +1614,22 @@@@ if (IMAGEBACKUP != 'n')
@


1.1
log
@revive cfengine port

this is version 2.1.6, from and maintained by
William Yodlowsky <bsd at openbsd.rutgers.edu>
@
text
@d1 3
a3 3
$OpenBSD$
--- src/image.c.orig	Fri Apr 30 17:20:19 2004
+++ src/image.c	Thu Jun 17 12:54:39 2004
d82 1
a82 1
@@@@ -535,7 +535,7 @@@@ if (S_ISDIR(sourcestatbuf.st_mode))
a90 1
@@@@ -542,8 +542,8 @@@@ if (S_ISDIR(sourcestatbuf.st_mode))
a100 1
@@@@ -550,7 +550,7 @@@@ if (S_ISDIR(sourcestatbuf.st_mode))
d154 1
a154 1
@@@@ -1614,7 +1614,7 @@@@ if (IMAGEBACKUP != 'n')
a162 1
@@@@ -1621,15 +1621,15 @@@@ if (IMAGEBACKUP != 'n')
@

