head	1.3;
access;
symbols
	OPENBSD_4_2:1.2.0.10
	OPENBSD_4_2_BASE:1.2
	OPENBSD_4_1:1.2.0.8
	OPENBSD_4_1_BASE:1.2
	OPENBSD_4_0:1.2.0.6
	OPENBSD_4_0_BASE:1.2
	OPENBSD_3_9:1.2.0.4
	OPENBSD_3_9_BASE:1.2
	OPENBSD_3_8:1.2.0.2
	OPENBSD_3_8_BASE:1.2
	OPENBSD_3_7:1.1.0.4
	OPENBSD_3_7_BASE:1.1
	OPENBSD_3_6:1.1.0.2
	OPENBSD_3_6_BASE:1.1;
locks; strict;
comment	@# @;


1.3
date	2007.10.12.20.12.19;	author sturm;	state dead;
branches;
next	1.2;

1.2
date	2005.07.21.15.16.47;	author aanriot;	state Exp;
branches;
next	1.1;

1.1
date	2004.06.17.11.21.43;	author sturm;	state Exp;
branches;
next	;


desc
@@


1.3
log
@update to cfengine 2.2.1
simplify port drastically by removing str* patches, these might be
revived one day as an external patch

no objections from maintainer
@
text
@$OpenBSD: patch-src_patches_c,v 1.2 2005/07/21 15:16:47 aanriot Exp $
--- src/patches.c.orig	Tue Feb  8 06:50:02 2005
+++ src/patches.c	Fri Jul 15 12:24:01 2005
@@@@ -135,7 +135,7 @@@@ if (gethostname(buffer,CF_BUFSIZE) == -1
    exit(1);
    }
 
-strcpy(sys->nodename,buffer);
+(void)strlcpy(sys->nodename,buffer,sizeof(sys->nodename));
 
 if (strcmp(buffer,AUTOCONF_HOSTNAME) != 0)
    {
@@@@ -143,10 +143,10 @@@@ if (strcmp(buffer,AUTOCONF_HOSTNAME) != 
    Verbose("This host does not have uname, so I can't tell if it is the exact same OS\n");
    }
 
-strcpy(sys->sysname,AUTOCONF_SYSNAME);
-strcpy(sys->release,"cfengine-had-to-guess");
-strcpy(sys->machine,"missing-uname(2)");
-strcpy(sys->version,"unknown");
+(void)strlcpy(sys->sysname,AUTOCONF_SYSNAME,sizeof(sys->sysname));
+(void)strlcpy(sys->release,"cfengine-had-to-guess",sizeof(sys->release));
+(void)strlcpy(sys->machine,"missing-uname(2)",sizeof(sys->machine));
+(void)strlcpy(sys->version,"unknown",sizeof(sys->version));
 
 
   /* Extract a version number if possible */
@@@@ -155,8 +155,8 @@@@ for (sp = sys->sysname; *sp != '\0'; sp+
    {
    if (isdigit(*sp))
       {
-      strcpy(sys->release,sp);
-      strcpy(sys->version,sp);
+      (void)strlcpy(sys->release,sp,sizeof(sys->release));
+      (void)strlcpy(sys->version,sp,sizeof(sys->version));
       *sp = '\0';
       break;
       }
@@@@ -205,6 +205,7 @@@@ return NULL;
 #ifndef HAVE_STRDUP
 
 char *strdup(char *str)
+size_t buflen;
 
 { char *sp;
  
@@@@ -213,13 +214,14 @@@@ if (str == NULL)
    return NULL;
    }
 
-if ((sp = malloc(strlen(str)+1)) == NULL)
+buflen = strlen(str) + 1;
+if ((sp = malloc(buflen)) == NULL)
    {
    perror("malloc");
    return NULL;
    }
 
-strcpy(sp,str);
+(void)strlcpy(sp,str,buflen);
 return sp; 
 }
 
@@@@ -271,7 +273,7 @@@@ char *strerror(int err)
 
 { static char buffer[20];
 
-sprintf(buffer,"Error number %d\n",err);
+(void)snprintf(buffer,sizeof(buffer),"Error number %d\n",err);
 return buffer; 
 }
 
@


1.2
log
@update to 2.1.15, from William Yodlowsky (maintainer).

inputs and ok naddy@@
@
text
@d1 1
a1 1
$OpenBSD: patch-src_patches_c,v 1.1 2004/06/17 11:21:43 sturm Exp $
@


1.1
log
@revive cfengine port

this is version 2.1.6, from and maintained by
William Yodlowsky <bsd at openbsd.rutgers.edu>
@
text
@d1 4
a4 4
$OpenBSD$
--- src/patches.c.orig	2004-06-10 10:50:04.000000000 -0400
+++ src/patches.c	2004-06-10 11:32:49.000000000 -0400
@@@@ -134,7 +134,7 @@@@ if (gethostname(buffer,CF_BUFSIZE) == -1
d13 1
a13 1
@@@@ -142,10 +142,10 @@@@ if (strcmp(buffer,AUTOCONF_HOSTNAME) != 
d28 1
a28 1
@@@@ -154,8 +154,8 @@@@ for (sp = sys->sysname; *sp != '\0'; sp+
d39 1
a39 1
@@@@ -204,6 +204,7 @@@@ return NULL;
d47 1
a47 1
@@@@ -212,13 +213,14 @@@@ if (str == NULL)
d64 1
a64 1
@@@@ -270,7 +272,7 @@@@ char *strerror(int err)
@

