head	1.6;
access;
symbols
	OPENBSD_4_2:1.5.0.8
	OPENBSD_4_2_BASE:1.5
	OPENBSD_4_1:1.5.0.6
	OPENBSD_4_1_BASE:1.5
	OPENBSD_4_0:1.5.0.4
	OPENBSD_4_0_BASE:1.5
	OPENBSD_3_9:1.5.0.2
	OPENBSD_3_9_BASE:1.5
	OPENBSD_3_8:1.4.0.2
	OPENBSD_3_8_BASE:1.4
	OPENBSD_3_7:1.3.0.2
	OPENBSD_3_7_BASE:1.3
	OPENBSD_3_6:1.2.0.2
	OPENBSD_3_6_BASE:1.2;
locks; strict;
comment	@# @;


1.6
date	2007.10.12.20.12.19;	author sturm;	state dead;
branches;
next	1.5;

1.5
date	2005.10.27.21.47.28;	author sturm;	state Exp;
branches;
next	1.4;

1.4
date	2005.07.21.15.16.46;	author aanriot;	state Exp;
branches;
next	1.3;

1.3
date	2004.10.01.21.22.15;	author sturm;	state Exp;
branches;
next	1.2;

1.2
date	2004.08.08.14.02.11;	author sturm;	state Exp;
branches;
next	1.1;

1.1
date	2004.06.17.11.21.43;	author sturm;	state Exp;
branches;
next	;


desc
@@


1.6
log
@update to cfengine 2.2.1
simplify port drastically by removing str* patches, these might be
revived one day as an external patch

no objections from maintainer
@
text
@$OpenBSD: patch-src_edittools_c,v 1.5 2005/10/27 21:47:28 sturm Exp $
--- src/edittools.c.orig	Thu Jun 30 06:05:48 2005
+++ src/edittools.c	Fri Oct 21 16:35:55 2005
@@@@ -74,7 +74,7 @@@@ for (dirp = readdir(dirh); dirp != NULL;
       continue;
       }
 
-   strcpy(pcwd,name);                                   /* Assemble pathname */
+   (void)strlcpy(pcwd,name,sizeof(pcwd));                                   /* Assemble pathname */
    AddSlash(pcwd);
 
    if (BufferOverflow(pcwd,dirp->d_name))
@@@@ -82,7 +82,7 @@@@ for (dirp = readdir(dirh); dirp != NULL;
       return true;
       }
 
-   strcat(pcwd,dirp->d_name);
+   (void)strlcat(pcwd,dirp->d_name,sizeof(pcwd));
 
    if (!FileObjectFilter(pcwd,&statbuf,ptr->filters,editfiles))
       {
@@@@ -190,9 +190,9 @@@@ for (ip = VMOUNTLIST; ip != NULL; ip=ip-
          continue;
          }
 
-      strcpy(homedir,ip->name);
+      (void)strlcpy(homedir,ip->name,sizeof(homedir));
       AddSlash(homedir);
-      strcat(homedir,dirp->d_name);
+      (void)strlcat(homedir,dirp->d_name,sizeof(homedir));
 
       if (! IsHomeDir(homedir))
          {
@@@@ -213,12 +213,12 @@@@ for (ip = VMOUNTLIST; ip != NULL; ip=ip-
             continue;
             }
          
-         strcpy(dest,homedir);
+         (void)strlcpy(dest,homedir,sizeof(dest));
          AddSlash(dest);
-         strcat(dest,dirp2->d_name);
+         (void)strlcat(dest,dirp2->d_name,sizeof(dest));
          AddSlash(dest);
          sp = ptr->fname + strlen("home/");
-         strcat(dest,sp);
+         (void)strlcat(dest,sp,sizeof(dest));
          
          if (stat(dest,&statbuf))
             {
@@@@ -276,7 +276,7 @@@@ if (lstat(filename,&statbuf) != -1)
       
       if (linkname[0] != '/')
          {
-         strcpy(realname,filename);
+         (void)strlcpy(realname,filename,sizeof(realname));
          ChopLastNode(realname);
          AddSlash(realname);
          }
@@@@ -299,7 +299,7 @@@@ if (lstat(filename,&statbuf) != -1)
             }
          }
       
-      strcat(realname,linkname);
+      (void)strlcat(realname,linkname,sizeof(realname));
       
       if (!FileObjectFilter(realname,&statbuf2,ptr->filters,editfiles))
          {
@@@@ -406,8 +406,8 @@@@ NUMBEROFEDITS = 0;
 EDITVERBOSE = VERBOSE;
 CURRENTLINENUMBER = 1;
 CURRENTLINEPTR = filestart;
-strcpy(COMMENTSTART,"# ");
-strcpy(COMMENTEND,"");
+(void)strlcpy(COMMENTSTART,"# ",CF_MAXVARSIZE);
+(void)strlcpy(COMMENTEND,"",CF_MAXVARSIZE);
 EDITGROUPLEVEL = 0;
 SEARCHREPLACELEVEL = 0;
 FOREACHLEVEL = 0;
@@@@ -1355,6 +1355,7 @@@@ return true;
 int ReplaceEditLineWith (char *string)
 
 { char *sp;
+  size_t splen;
 
 if (strcmp(string,CURRENTLINEPTR->name) == 0)
    {
@@@@ -1362,14 +1363,15 @@@@ if (strcmp(string,CURRENTLINEPTR->name) 
    return true;
    }
 
-if ((sp = malloc(strlen(string)+1)) == NULL)
+splen = strlen(string)+1;
+if ((sp = malloc(splen)) == NULL)
    {
    printf("Memory allocation failed in ReplaceEditLineWith, aborting edit.\n");
    return false;
    }
 
 EditVerbose("Replacing line %d with %10s...\n",CURRENTLINENUMBER,string);
-strcpy(sp,string);
+(void)strlcpy(sp,string,splen);
 free (CURRENTLINEPTR->name);
 CURRENTLINEPTR->name = sp;
 NUMBEROFEDITS++;
@@@@ -2078,10 +2080,10 @@@@ int SaveBinaryFile(char *file,off_t size
 Debug("SaveBinaryFile(%s,%d)\n",file,size);
 Verbose("Saving %s\n",file);
  
-strcpy(new,file);
-strcat(new,CF_NEW);
-strcpy(backup,file);
-strcat(backup,CF_EDITED);
+(void)strlcpy(new,file,sizeof(new));
+(void)strlcat(new,CF_NEW,sizeof(new));
+(void)strlcpy(backup,file,sizeof(backup));
+(void)strlcat(backup,CF_EDITED,sizeof(backup));
  
 unlink(new);  /* To avoid link attacks */
  
@


1.5
log
@update to 2.1.16, removing sbin/vicf which seems to have a security
problem but is not used anywhere and will probably be removed from
cfengine

from maintainer William Yodlowsky <bsd at openbsd.rutgers.edu>
@
text
@d1 1
a1 1
$OpenBSD: patch-src_edittools_c,v 1.4 2005/07/21 15:16:46 aanriot Exp $
@


1.4
log
@update to 2.1.15, from William Yodlowsky (maintainer).

inputs and ok naddy@@
@
text
@d1 3
a3 3
$OpenBSD: patch-src_edittools_c,v 1.3 2004/10/01 21:22:15 sturm Exp $
--- src/edittools.c.orig	Tue Feb  8 06:50:01 2005
+++ src/edittools.c	Fri Jul 15 12:24:01 2005
d68 1
a68 1
@@@@ -405,8 +405,8 @@@@ NUMBEROFEDITS = 0;
d79 1
a79 1
@@@@ -1354,6 +1354,7 @@@@ return true;
d87 1
a87 1
@@@@ -1361,14 +1362,15 @@@@ if (strcmp(string,CURRENTLINEPTR->name) 
d105 1
a105 1
@@@@ -2077,10 +2079,10 @@@@ int SaveBinaryFile(char *file,off_t size
@


1.3
log
@unbreak and update to 2.1.10

from maintainer William Yodlowsky <bsd at openbsd.rutgers.edu>
@
text
@d1 3
a3 3
$OpenBSD$
--- src/edittools.c.orig	Wed Aug 11 22:50:07 2004
+++ src/edittools.c	Fri Oct  1 23:14:47 2004
d68 1
a68 1
@@@@ -401,8 +401,8 @@@@ NUMBEROFEDITS = 0;
d79 1
a79 1
@@@@ -1329,6 +1329,7 @@@@ return true;
d87 1
a87 1
@@@@ -1336,14 +1337,15 @@@@ if (strcmp(string,CURRENTLINEPTR->name) 
d105 1
a105 1
@@@@ -2048,10 +2050,10 @@@@ int SaveBinaryFile(char *file,off_t size
@


1.2
log
@update to cfengine 2.1.7p1

from maintainer William Yodlowsky <bsd at openbsd.rutgers.edu>
@
text
@d1 3
a3 3
$OpenBSD: patch-src_edittools_c,v 1.1 2004/06/17 11:21:43 sturm Exp $
--- src/edittools.c.orig	Wed Jun 23 17:38:13 2004
+++ src/edittools.c	Mon Aug  2 13:30:34 2004
d68 1
a68 1
@@@@ -402,8 +402,8 @@@@ NUMBEROFEDITS = 0;
d79 1
a79 1
@@@@ -1330,6 +1330,7 @@@@ return true;
d87 1
a87 1
@@@@ -1337,14 +1338,15 @@@@ if (strcmp(string,CURRENTLINEPTR->name) 
d105 1
a105 1
@@@@ -2050,10 +2052,10 @@@@ int SaveBinaryFile(char *file,off_t size
@


1.1
log
@revive cfengine port

this is version 2.1.6, from and maintained by
William Yodlowsky <bsd at openbsd.rutgers.edu>
@
text
@d1 3
a3 3
$OpenBSD$
--- src/edittools.c.orig	Thu Apr 22 21:34:19 2004
+++ src/edittools.c	Thu Jun 17 12:54:38 2004
d68 1
a68 1
@@@@ -401,8 +401,8 @@@@ NUMBEROFEDITS = 0;
d79 1
a79 1
@@@@ -1303,6 +1303,7 @@@@ return true;
d87 1
a87 1
@@@@ -1310,7 +1311,8 @@@@ if (strcmp(string,CURRENTLINEPTR->name) 
a96 1
@@@@ -1317,7 +1319,7 @@@@ if ((sp = malloc(strlen(string)+1)) == N
d105 1
a105 1
@@@@ -2023,10 +2025,10 @@@@ int SaveBinaryFile(char *file,off_t size
@

