head	1.5;
access;
symbols
	OPENBSD_4_2:1.4.0.8
	OPENBSD_4_2_BASE:1.4
	OPENBSD_4_1:1.4.0.6
	OPENBSD_4_1_BASE:1.4
	OPENBSD_4_0:1.4.0.4
	OPENBSD_4_0_BASE:1.4
	OPENBSD_3_9:1.4.0.2
	OPENBSD_3_9_BASE:1.4
	OPENBSD_3_8:1.3.0.2
	OPENBSD_3_8_BASE:1.3
	OPENBSD_3_7:1.2.0.2
	OPENBSD_3_7_BASE:1.2
	OPENBSD_3_6:1.1.0.2
	OPENBSD_3_6_BASE:1.1;
locks; strict;
comment	@# @;


1.5
date	2007.10.12.20.12.19;	author sturm;	state dead;
branches;
next	1.4;

1.4
date	2005.10.27.21.47.28;	author sturm;	state Exp;
branches;
next	1.3;

1.3
date	2005.07.21.15.16.46;	author aanriot;	state Exp;
branches;
next	1.2;

1.2
date	2004.10.01.21.22.15;	author sturm;	state Exp;
branches;
next	1.1;

1.1
date	2004.06.17.11.21.43;	author sturm;	state Exp;
branches;
next	;


desc
@@


1.5
log
@update to cfengine 2.2.1
simplify port drastically by removing str* patches, these might be
revived one day as an external patch

no objections from maintainer
@
text
@$OpenBSD: patch-src_cfrun_c,v 1.4 2005/10/27 21:47:28 sturm Exp $
--- src/cfrun.c.orig	Wed Aug 10 05:01:17 2005
+++ src/cfrun.c	Thu Oct 27 23:06:44 2005
@@@@ -234,7 +234,7 @@@@ for (i = 1; i < argc; i++) 
 
   /* XXX Initialize workdir for non privileged users */
 
- strcpy(CFWORKDIR,WORKDIR);
+ (void)strlcpy(CFWORKDIR,WORKDIR,sizeof(CFWORKDIR));
 
  if (getuid() > 0)
     {
@@@@ -242,7 +242,7 @@@@ for (i = 1; i < argc; i++) 
     if ((homedir = getenv("HOME")) != NULL)
        {
        strncpy(CFWORKDIR,homedir,CF_BUFSIZE-16);
-       strcat(CFWORKDIR,"/.cfagent");
+       (void)strlcat(CFWORKDIR,"/.cfagent",sizeof(CFWORKDIR));
        }
     }
 
@@@@ -255,14 +255,15 @@@@ for (i = 1; i < argc; i++) 
  
  Debug("FQNAME = %s, WORKDIR = %s\n",VFQNAME,WORKDIR);
  
- sprintf(VPREFIX,"cfrun:%s",VFQNAME);
+ (void)snprintf(VPREFIX,40,"cfrun:%s",VFQNAME);
  
  
 /* Read hosts file */
  
  umask(077);
- strcpy(VLOCKDIR,CFWORKDIR);
- strcpy(VLOGDIR,CFWORKDIR); 
+ (void)strlcpy(VLOCKDIR,CFWORKDIR,CF_BUFSIZE);
+ (void)strlcpy(VLOGDIR,CFWORKDIR,CF_BUFSIZE); 
+
  
  OpenSSL_add_all_algorithms();
  ERR_load_crypto_strings();
@@@@ -296,7 +297,7 @@@@ CONN = NewAgentConn();
 
 if (storeinfile)
    {
-   sprintf(filebuffer, "%s/%s", OUTPUTDIR, host);
+   (void)snprintf(filebuffer, sizeof(filebuffer), "%s/%s", OUTPUTDIR, host);
    if ((fp = fopen(filebuffer, "w")) == NULL)
       {
       return false;
@@@@ -566,10 +567,10 @@@@ if (!strchr(VCFRUNHOSTS, '/'))
    {
    if ((sp=getenv(CF_INPUTSVAR)) != NULL)
       {
-      strcpy(filename,sp);
+      (void)strlcpy(filename,sp,sizeof(filename));
       if (filename[strlen(filename)-1] != '/')
          {
-         strcat(filename,"/");
+         (void)strlcat(filename,"/",sizeof(filename));
          }
       }
    else
@@@@ -578,7 +579,7 @@@@ if (!strchr(VCFRUNHOSTS, '/'))
       }
    }
  
-strcat(filename,cfg_fic);
+(void)strlcat(filename,cfg_fic,sizeof(filename));
 
 if ((fp = fopen(filename,"r")) == NULL)      /* Open root file */
    {
@@@@ -603,7 +604,7 @@@@ while (!feof(fp))
 
    if (strncmp(line,"hostnamekeys",6) == 0)
       {
-      char buf[16];
+      char buf[296];
       buf[0] = '\0';
       sscanf(line,"hostnamekeys = %295[^# \n]",buf);
       Verbose("Hostname keys\n");
@@@@ -714,8 +715,8 @@@@ while (!feof(fp))
 
    if ((!strstr(buffer,".")) && (strlen(VDOMAIN) > 0))
       {
-      strcat(buffer,".");
-      strcat(buffer,VDOMAIN);
+      (void)strlcat(buffer,".",sizeof(buffer));
+      (void)strlcat(buffer,VDOMAIN,sizeof(buffer));
       }
       
    if (!IsItemIn(VCFRUNHOSTLIST,buffer))
@@@@ -773,8 +774,8 @@@@ for (ip = VCFRUNCLASSES; ip != NULL; ip 
       memset(sendbuffer,0,CF_BUFSIZE);
       }
    
-   strcat(sendbuffer,ip->name);
-   strcat(sendbuffer," ");
+   (void)strlcat(sendbuffer,ip->name,CF_BUFSIZE);
+   (void)strlcat(sendbuffer," ",CF_BUFSIZE);
 
    sp += strlen(ip->name)+1;
    used += strlen(ip->name)+1;
@@@@ -793,7 +794,7 @@@@ if (used + strlen(CFD_TERMINATOR) +2 > C
    memset(sendbuffer,0,CF_BUFSIZE);
    }
    
-sprintf(sp, "%s", CFD_TERMINATOR);
+(void)snprintf(sp, CF_BUFSIZE, "%s", CFD_TERMINATOR);
 
 if (SendTransaction(sd,sendbuffer,0,CF_DONE) == -1)
    {
@


1.4
log
@update to 2.1.16, removing sbin/vicf which seems to have a security
problem but is not used anywhere and will probably be removed from
cfengine

from maintainer William Yodlowsky <bsd at openbsd.rutgers.edu>
@
text
@d1 1
a1 1
$OpenBSD: patch-src_cfrun_c,v 1.3 2005/07/21 15:16:46 aanriot Exp $
@


1.3
log
@update to 2.1.15, from William Yodlowsky (maintainer).

inputs and ok naddy@@
@
text
@d1 4
a4 4
$OpenBSD: patch-src_cfrun_c,v 1.2 2004/10/01 21:22:15 sturm Exp $
--- src/cfrun.c.orig	Tue Feb  8 06:50:01 2005
+++ src/cfrun.c	Fri Jul 15 12:24:01 2005
@@@@ -233,7 +233,7 @@@@ for (i = 1; i < argc; i++) 
d13 1
a13 1
@@@@ -241,7 +241,7 @@@@ for (i = 1; i < argc; i++) 
d22 1
a22 1
@@@@ -254,14 +254,15 @@@@ for (i = 1; i < argc; i++) 
d41 1
a41 1
@@@@ -295,7 +296,7 @@@@ CONN = NewAgentConn();
d67 2
a68 2
-strcat(filename,VCFRUNHOSTS);
+(void)strlcat(filename,VCFRUNHOSTS,sizeof(filename));
d72 10
a81 1
@@@@ -705,8 +706,8 @@@@ while (!feof(fp))
d92 1
a92 1
@@@@ -764,8 +765,8 @@@@ for (ip = VCFRUNCLASSES; ip != NULL; ip 
d103 1
a103 1
@@@@ -784,7 +785,7 @@@@ if (used + strlen(CFD_TERMINATOR) +2 > C
@


1.2
log
@unbreak and update to 2.1.10

from maintainer William Yodlowsky <bsd at openbsd.rutgers.edu>
@
text
@d1 20
a20 4
$OpenBSD$
--- src/cfrun.c.orig	Mon Aug  2 21:46:03 2004
+++ src/cfrun.c	Fri Oct  1 23:17:38 2004
@@@@ -245,23 +245,23 @@@@ if (uname(&VSYSNAME) == -1)
d22 3
a24 11
 if ((strlen(VDOMAIN) > 0) && !strchr(VSYSNAME.nodename,'.'))
    {
-   sprintf(VFQNAME,"%s.%s",VSYSNAME.nodename,VDOMAIN);
+   (void)snprintf(VFQNAME,CF_MAXVARSIZE,"%s.%s",VSYSNAME.nodename,VDOMAIN);
    }
 else
    {
-   sprintf(VFQNAME,"%s",VSYSNAME.nodename);
+   (void)snprintf(VFQNAME,CF_MAXVARSIZE,"%s",VSYSNAME.nodename);
    }   
 */
d26 2
a27 1
 Debug("FQNAME = %s\n",VFQNAME);
a28 2
-sprintf(VPREFIX,"cfrun:%s",VFQNAME);
+(void)snprintf(VPREFIX,40,"cfrun:%s",VFQNAME);
d31 11
a41 10
 
 umask(077);
-strcpy(VLOCKDIR,WORKDIR);
-strcpy(VLOGDIR,WORKDIR); 
+(void)strlcpy(VLOCKDIR,WORKDIR,CF_BUFSIZE);
+(void)strlcpy(VLOGDIR,WORKDIR,CF_BUFSIZE); 
 
 OpenSSL_add_all_algorithms();
 ERR_load_crypto_strings();
@@@@ -294,7 +294,7 @@@@ CONN = NewAgentConn();
d50 1
a50 1
@@@@ -564,10 +564,10 @@@@ if (!strchr(VCFRUNHOSTS, '/'))
d63 1
a63 1
@@@@ -576,7 +576,7 @@@@ if (!strchr(VCFRUNHOSTS, '/'))
d72 1
a72 10
@@@@ -601,7 +601,7 @@@@ while (!feof(fp))
 
    if (strncmp(line,"hostnamekeys",6) == 0)
       {
-      char buf[16];
+      char buf[296];
       buf[0] = '\0';
       sscanf(line,"hostnamekeys = %295[^# \n]",buf);
       Verbose("Hostname keys\n");
@@@@ -703,8 +703,8 @@@@ while (!feof(fp))
d83 1
a83 1
@@@@ -762,8 +762,8 @@@@ for (ip = VCFRUNCLASSES; ip != NULL; ip 
d94 1
a94 1
@@@@ -782,7 +782,7 @@@@ if (used + strlen(CFD_TERMINATOR) +2 > C
@


1.1
log
@revive cfengine port

this is version 2.1.6, from and maintained by
William Yodlowsky <bsd at openbsd.rutgers.edu>
@
text
@d2 3
a4 3
--- src/cfrun.c.orig	2004-04-17 10:11:04.000000000 -0400
+++ src/cfrun.c	2004-06-10 22:32:35.000000000 -0400
@@@@ -242,23 +242,23 @@@@ if (uname(&VSYSNAME) == -1)
d18 1
a18 1
  Debug("FQNAME = %s\n",VFQNAME);
d33 1
a33 1
@@@@ -292,7 +292,7 @@@@ CONN = NewAgentConn();
d42 1
a42 1
@@@@ -562,10 +562,10 @@@@ if (!strchr(VCFRUNHOSTS, '/'))
d55 1
a55 1
@@@@ -574,7 +574,7 @@@@ if (!strchr(VCFRUNHOSTS, '/'))
d64 10
a73 1
@@@@ -687,8 +687,8 @@@@ while (!feof(fp))
d84 1
a84 1
@@@@ -746,8 +746,8 @@@@ for (ip = VCFRUNCLASSES; ip != NULL; ip 
d95 1
a95 1
@@@@ -766,7 +766,7 @@@@ if (used + strlen(CFD_TERMINATOR) +2 > C
@

