head     1.1;
branch   1.1.1;
access   ;
symbols  ajacoutot_20170401:1.1.1.1 ajacoutot:1.1.1;
locks    ; strict;
comment  @# @;


1.1
date     2017.01.04.09.05.40;  author ajacoutot;  state Exp;
branches 1.1.1.1;
next     ;
commitid        QlwnakFWKe9FcBri;

1.1.1.1
date     2017.01.04.09.05.40;  author ajacoutot;  state Exp;
branches ;
next     ;
commitid        QlwnakFWKe9FcBri;


desc
@@



1.1
log
@Initial revision
@
text
@$OpenBSD$
--- agent/fileutil/fileutil_unix.go.orig	Tue Jan  3 10:22:57 2017
+++ agent/fileutil/fileutil_unix.go	Tue Jan  3 10:23:50 2017
@@@@ -81,13 +81,13 @@@@ func GetDiskSpaceInfo() (diskSpaceInfo DiskSpaceInfo, 
 	syscall.Statfs(wd, &stat)
 
 	// get block size
-	bSize := uint64(stat.Bsize)
+	bSize := uint64(stat.F_bsize)
 
 	// return DiskSpaceInfo with calculated bytes
 	return DiskSpaceInfo{
-		AvailBytes: (int64)(stat.Bavail * bSize), // available space = # of available blocks * block size
-		FreeBytes:  (int64)(stat.Bfree * bSize),  // free space = # of free blocks * block size
-		TotalBytes: (int64)(stat.Blocks * bSize), // total space = # of total blocks * block size
+		AvailBytes: (int64)((uint64)(stat.F_bavail) * bSize), // available space = # of available blocks * block size
+		FreeBytes:  (int64)(stat.F_bfree * bSize),  // free space = # of free blocks * block size
+		TotalBytes: (int64)(stat.F_blocks * bSize), // total space = # of total blocks * block size
 	}, nil
 }
 
@


1.1.1.1
log
@Import amazon-ssm-agent-1.2.290.0.

The Amazon EC2 Simple Systems Manager (SSM) Agent is software developed for the
Simple Systems Manager Service. The SSM Agent is the primary component of a
feature called Run Command.
<...>

ok robert@@
@
text
@@
