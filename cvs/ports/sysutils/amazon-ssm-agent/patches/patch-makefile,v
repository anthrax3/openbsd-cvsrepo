head	1.5;
access;
symbols
	OPENBSD_6_2:1.5.0.2
	OPENBSD_6_2_BASE:1.5
	OPENBSD_6_1:1.1.1.1.0.2
	OPENBSD_6_1_BASE:1.1.1.1
	ajacoutot_20170401:1.1.1.1
	ajacoutot:1.1.1;
locks; strict;
comment	@# @;


1.5
date	2017.09.15.07.20.56;	author ajacoutot;	state Exp;
branches;
next	1.4;
commitid	jRxmY4CZVmTOSlXT;

1.4
date	2017.08.17.12.24.30;	author ajacoutot;	state Exp;
branches;
next	1.3;
commitid	bTvW73eGx5HmGhwb;

1.3
date	2017.05.28.11.49.39;	author ajacoutot;	state Exp;
branches;
next	1.2;
commitid	lson7M55WfPIJRIp;

1.2
date	2017.05.28.09.25.31;	author ajacoutot;	state Exp;
branches;
next	1.1;
commitid	NdFDEvrbVnfF5wxN;

1.1
date	2017.01.04.09.05.40;	author ajacoutot;	state Exp;
branches
	1.1.1.1;
next	;
commitid	QlwnakFWKe9FcBri;

1.1.1.1
date	2017.01.04.09.05.40;	author ajacoutot;	state Exp;
branches;
next	;
commitid	QlwnakFWKe9FcBri;


desc
@@


1.5
log
@Update to amazon-ssm-agent-2.1.4.0.
@
text
@$OpenBSD: patch-makefile,v 1.4 2017/08/17 12:24:30 ajacoutot Exp $
Index: makefile
--- makefile.orig
+++ makefile
@@@@ -36,12 +36,12 @@@@ export BRAZIL_BUILD
 
 checkstyle::
 #   Run checkstyle script
-	$(BGO_SPACE)/Tools/src/checkstyle.sh
+#	$(BGO_SPACE)/Tools/src/checkstyle.sh
 
 coverage:: build-linux
 	$(BGO_SPACE)/Tools/src/coverage.sh github.com/aws/amazon-ssm-agent/agent/...
 
-build:: build-linux build-freebsd build-windows build-linux-386 build-windows-386 build-arm
+build:: build-linux build-freebsd build-openbsd build-windows build-linux-386 build-windows-386 build-arm
 
 prepack:: cpy-plugins prepack-linux prepack-linux-386 prepack-windows prepack-windows-386 prepack-arm
 
@@@@ -126,6 +126,22 @@@@ build-freebsd: checkstyle copy-src pre-build
 			$(BGO_SPACE)/agent/cli-main/cli-main.go
 	GOOS=freebsd GOARCH=amd64 $(GO_BUILD) -ldflags "-s -w" -o $(BGO_SPACE)/bin/freebsd_amd64/ssm-document-worker -v \
 								$(BGO_SPACE)/agent/framework/processor/executer/outofproc/worker/main.go
+
+.PHONY: build-openbsd
+build-openbsd: checkstyle copy-src pre-build
+	@@echo "Build for openbsd agent"
+	GOOS=openbsd GOARCH=amd64 go build -ldflags "-s -w" -o $(BGO_SPACE)/bin/openbsd_amd64/amazon-ssm-agent -v \
+	$(BGO_SPACE)/agent/agent.go $(BGO_SPACE)/agent/agent_unix.go $(BGO_SPACE)/agent/agent_parser.go
+	GOOS=openbsd GOARCH=amd64 $(GO_BUILD) -ldflags "-s -w" -o $(BGO_SPACE)/bin/openbsd_amd64/ssm-cli -v \
+            $(BGO_SPACE)/agent/cli-main/cli-main.go
+
+.PHONY: build-openbsd-386
+build-openbsd-386: checkstyle copy-src pre-build
+	@@echo "Build for openbsd agent"
+	GOOS=openbsd GOARCH=386 go build -ldflags "-s -w" -o $(BGO_SPACE)/bin/openbsd_386/amazon-ssm-agent -v \
+	$(BGO_SPACE)/agent/agent.go $(BGO_SPACE)/agent/agent_unix.go $(BGO_SPACE)/agent/agent_parser.go
+	GOOS=openbsd GOARCH=386 $(GO_BUILD) -ldflags "-s -w" -o $(BGO_SPACE)/bin/openbsd_386/ssm-cli -v \
+	$(BGO_SPACE)/agent/cli-main/cli-main.go
 
 .PHONY: build-darwin
 build-darwin: checkstyle copy-src pre-build
@


1.4
log
@Update to amazon-ssm-agent-2.0.913.0.
@
text
@d1 1
a1 1
$OpenBSD: patch-makefile,v 1.3 2017/05/28 11:49:39 ajacoutot Exp $
d20 5
a24 4
@@@@ -121,6 +121,14 @@@@ build-freebsd: checkstyle copy-src pre-build
 	GOOS=freebsd GOARCH=amd64 $(GO_BUILD) -ldflags "-s -w" -o $(BGO_SPACE)/bin/freebsd_amd64/ssm-cli -v \
             $(BGO_SPACE)/agent/cli-main/cli-main.go
 
a32 8
 .PHONY: build-darwin
 build-darwin: checkstyle copy-src pre-build
 	@@echo "Rebuild for darwin agent"
@@@@ -150,6 +158,14 @@@@ build-linux-386: checkstyle copy-src pre-build
 	$(BGO_SPACE)/agent/update/updater/updater.go $(BGO_SPACE)/agent/update/updater/updater_unix.go
 	GOOS=linux GOARCH=386 $(GO_BUILD) -ldflags "-s -w" -o $(BGO_SPACE)/bin/linux_386/ssm-cli -v \
         $(BGO_SPACE)/agent/cli-main/cli-main.go
+
d39 1
a39 1
+            $(BGO_SPACE)/agent/cli-main/cli-main.go
d41 2
a42 2
 .PHONY: build-darwin-386
 build-darwin-386: checkstyle copy-src pre-build
@


1.3
log
@Add support for i386.
@
text
@d1 1
a1 1
$OpenBSD: patch-makefile,v 1.2 2017/05/28 09:25:31 ajacoutot Exp $
d15 2
a16 2
-build:: build-linux build-freebsd build-windows build-linux-386 build-windows-386
+build:: build-linux build-freebsd build-openbsd build-windows build-linux-386 build-openbsd-386 build-windows-386
d18 1
a18 1
 prepack:: cpy-plugins prepack-linux prepack-linux-386 prepack-windows prepack-windows-386
@


1.2
log
@Update to amazon-ssm-agent-2.0.790.0.
@
text
@d1 1
a1 1
$OpenBSD: patch-makefile,v 1.1.1.1 2017/01/04 09:05:40 ajacoutot Exp $
d16 1
a16 1
+build:: build-linux build-freebsd build-openbsd build-windows build-linux-386 build-windows-386
d20 1
a20 3
@@@@ -119,6 +119,14 @@@@ build-freebsd: checkstyle copy-src pre-build
 	GOOS=freebsd GOARCH=amd64 go build -ldflags "-s -w" -o $(BGO_SPACE)/bin/freebsd_amd64/amazon-ssm-agent -v \
 	$(BGO_SPACE)/agent/agent.go $(BGO_SPACE)/agent/agent_unix.go $(BGO_SPACE)/agent/agent_parser.go
d22 2
a23 2
+            $(BGO_SPACE)/agent/cli-main/cli-main.go
+
d30 17
a46 1
             $(BGO_SPACE)/agent/cli-main/cli-main.go
d48 2
a49 1
 .PHONY: build-darwin
@


1.1
log
@Initial revision
@
text
@d1 5
a5 18
$OpenBSD$

From f5807f6ca41abe547d1e84f835965ca5f526c5d4 Mon Sep 17 00:00:00 2001
From: Melonia Mendonca <meloniam@@amazon.com>
Date: Thu, 21 Jul 2016 17:29:07 -0700
Subject: [PATCH] Copying version files only if build file path exists

--- makefile.orig	Wed Jul 20 20:08:03 2016
+++ makefile	Tue Jan  3 12:58:11 2017
@@@@ -6,6 +6,7 @@@@ ifneq ("$(wildcard $(BUILDFILE_PATH))","")
 	GOTEMPPATH := $(BGO_SPACE)/build/private
 	GOTEMPCOPYPATH := $(GOTEMPPATH)/src/github.com/aws/amazon-ssm-agent
 	GOPATH := $(GOTEMPPATH):$(BGO_SPACE)/vendor:$(GOPATH)
+	TEMPVERSIONPATH := $(GOTEMPCOPYPATH)/agent/version
 	FINALIZE := $(shell command -v bgo-final 2>/dev/null)
 
 else
@@@@ -27,12 +28,12 @@@@ export GOPATH
d15 2
a16 4
-build:: build-linux build-windows build-linux-386 build-windows-386
+build:: build-linux build-openbsd build-windows build-linux-386 build-windows-386
 
 prepack:: prepack-linux prepack-linux-386 prepack-windows prepack-windows-386
d18 1
a18 13
@@@@ -63,9 +64,12 @@@@ pre-build:
 	cp $(BGO_SPACE)/seelog_windows.xml.template $(BGO_SPACE)/bin/
 	cp $(BGO_SPACE)/VERSION $(BGO_SPACE)/bin/
 	cp $(BGO_SPACE)/agent/integration-cli/integration-cli.json $(BGO_SPACE)/bin/
-	# Copying the version files that were generated in pre-build
+ifneq ("$(wildcard $(BUILDFILE_PATH))","")
+	@@echo "Copying version files generated in pre-build "
+	mkdir -p $(TEMPVERSIONPATH)
 	cp $(BGO_SPACE)/VERSION $(GOTEMPCOPYPATH)
-	cp $(BGO_SPACE)/agent/version/version.go $(GOTEMPCOPYPATH)/agent/version/
+	cp $(BGO_SPACE)/agent/version/version.go $(TEMPVERSIONPATH)
+endif
 	exit 0
d20 2
a21 2
 .PHONY: build-linux
@@@@ -75,6 +79,19 @@@@ build-linux: checkstyle copy-src pre-build
d23 2
a24 2
 	GOOS=linux GOARCH=amd64 go build -ldflags "-s -w" -o $(BGO_SPACE)/bin/linux_amd64/updater -v \
 	$(BGO_SPACE)/agent/update/updater/updater.go $(BGO_SPACE)/agent/update/updater/updater_unix.go
d31 2
a32 7
+
+install-openbsd:
+	@@echo "Install for openbsd agent"
+	install -m 555 $(BGO_SPACE)/bin/openbsd_amd64/amazon-ssm-agent $(DESTDIR)$(PREFIX)/sbin/
+	mkdir -p $(DESTDIR)$(SYSCONFDIR)/amazon/ssm
+	install -m 644 $(BGO_SPACE)/bin/amazon-ssm-agent.json.template $(DESTDIR)$(SYSCONFDIR)/amazon/ssm
+	install -m 644 $(BGO_SPACE)/bin/seelog_unix.xml $(DESTDIR)$(SYSCONFDIR)/amazon/ssm/seelog_unix.xml.template
a34 1
 build-darwin: checkstyle copy-src pre-build
@


1.1.1.1
log
@Import amazon-ssm-agent-1.2.290.0.

The Amazon EC2 Simple Systems Manager (SSM) Agent is software developed for the
Simple Systems Manager Service. The SSM Agent is the primary component of a
feature called Run Command.
<...>

ok robert@@
@
text
@@
