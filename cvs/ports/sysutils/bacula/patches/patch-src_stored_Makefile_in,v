head	1.6;
access;
symbols
	OPENBSD_6_2:1.6.0.2
	OPENBSD_6_2_BASE:1.6
	OPENBSD_6_1:1.5.0.6
	OPENBSD_6_1_BASE:1.5
	OPENBSD_6_0:1.5.0.4
	OPENBSD_6_0_BASE:1.5
	OPENBSD_5_9:1.5.0.2
	OPENBSD_5_9_BASE:1.5
	OPENBSD_5_8:1.4.0.8
	OPENBSD_5_8_BASE:1.4
	OPENBSD_5_7:1.4.0.4
	OPENBSD_5_7_BASE:1.4
	OPENBSD_5_6:1.4.0.2
	OPENBSD_5_6_BASE:1.4
	OPENBSD_5_5:1.3.0.8
	OPENBSD_5_5_BASE:1.3
	OPENBSD_5_4:1.3.0.6
	OPENBSD_5_4_BASE:1.3
	OPENBSD_5_3:1.3.0.4
	OPENBSD_5_3_BASE:1.3
	OPENBSD_5_2:1.3.0.2
	OPENBSD_5_2_BASE:1.3
	OPENBSD_5_1_BASE:1.2
	OPENBSD_5_1:1.2.0.2;
locks; strict;
comment	@# @;


1.6
date	2017.07.07.16.01.58;	author sthen;	state Exp;
branches;
next	1.5;
commitid	F2yJoaTOBG2uYjSx;

1.5
date	2015.08.15.07.50.02;	author ajacoutot;	state Exp;
branches;
next	1.4;
commitid	DcwQCoBvkpVxpEev;

1.4
date	2014.04.19.09.44.11;	author ajacoutot;	state Exp;
branches;
next	1.3;

1.3
date	2012.03.08.17.34.34;	author sthen;	state Exp;
branches;
next	1.2;

1.2
date	2011.12.12.09.15.09;	author sthen;	state Exp;
branches;
next	1.1;

1.1
date	2011.11.24.09.29.55;	author ajacoutot;	state Exp;
branches;
next	;


desc
@@


1.6
log
@Major update to Bacula-9.0.0: note that this requires a database schema
change, so follow the usual upgrade documentation. This is still compatible
with older File Daemons (clients).
@
text
@$OpenBSD$

Index: src/stored/Makefile.in
--- src/stored/Makefile.in.orig
+++ src/stored/Makefile.in
@@@@ -136,7 +136,7 @@@@ libbacsd.la: Makefile $(LIBBACSD_LOBJS)
 	@@echo "Making $@@ ..."
 	$(LIBTOOL_LINK) $(CXX) $(DEFS) $(DEBUG) $(LDFLAGS) -o $@@ \
 	  $(TOKYOCABINET_LIBS) $(LIBBACSD_LOBJS) \
-	  -export-dynamic -rpath $(libdir) -release $(LIBBACSD_LT_RELEASE)
+	  -export-dynamic -rpath $(libdir)
 
 #
 # Loadable driver
@@@@ -144,11 +144,11 @@@@ libbacsd.la: Makefile $(LIBBACSD_LOBJS)
 drivers: bacula-sd-cloud-driver.la bacula-sd-aligned-driver.la
 
 bacula-sd-cloud-driver.la: Makefile $(CLOUD_LOBJS)
-	 $(LIBTOOL_LINK) $(CXX) $(LDFLAGS) -shared $(CLOUD_LOBJS) -o $@@ $(S3_LIBS) -rpath $(libdir) -module -export-dynamic -release $(LIBBACSD_LT_RELEASE)
+	 $(LIBTOOL_LINK) $(CXX) $(LDFLAGS) -shared $(CLOUD_LOBJS) -o $@@ $(S3_LIBS) -rpath $(libdir) -module -export-dynamic
 
 bacula-sd-aligned-driver.la: Makefile $(ALIGNED_LOBJS)
 	 $(LIBTOOL_LINK) $(CXX) $(LDFLAGS) -shared $(ALIGNED_LOBJS) -o $@@ -rpath $(plugindir) \
-	     -module -export-dynamic -release $(LIBBACSD_LT_RELEASE)
+	     -module -export-dynamic
 
 
 bsdjson: Makefile $(JSONOBJS) ../lib/libbaccfg$(DEFAULT_ARCHIVE_TYPE) ../lib/libbac$(DEFAULT_ARCHIVE_TYPE)
@


1.5
log
@Update to bacula-client-7.2.0.
README parts from sthen@@

ok sthen@@
@
text
@d1 28
a28 13
$OpenBSD: patch-src_stored_Makefile_in,v 1.4 2014/04/19 09:44:11 ajacoutot Exp $
--- src/stored/Makefile.in.orig	Thu Aug 13 15:52:24 2015
+++ src/stored/Makefile.in	Fri Aug 14 10:16:42 2015
@@@@ -193,9 +193,6 @@@@ install: all
 	fi; \
 	echo "${INSTALL_CONFIG} $$srcconf ${DESTDIR}${sysconfdir}/$$destconf"; \
 	${INSTALL_CONFIG} $$srcconf ${DESTDIR}${sysconfdir}/$$destconf
-	@@if test "x${sd_group}" != "x"; then \
-	   chgrp -f ${sd_group} ${DESTDIR}${sysconfdir}/$$destconf; \
-	fi
 	@@if test -f static-bacula-sd; then \
 	   $(LIBTOOL_INSTALL) $(INSTALL_PROGRAM) static-bacula-sd $(DESTDIR)$(sbindir)/static-bacula-sd; \
 	fi
@


1.4
log
@Major update to Bacula 7.0.2.
Some info at:
http://blog.bacula.org/p710/
http://blog.bacula.org/release-7-0-2/

Now builds with our libtool(1).

While there's a huge amount of changes, existing setups "should" just
work without any modification.

tested by sthen@@ and myself
ok sthen@@, my new co-maintainer :-)
@
text
@d1 4
a4 4
$OpenBSD: patch-src_stored_Makefile_in,v 1.3 2012/03/08 17:34:34 sthen Exp $
--- src/stored/Makefile.in.orig	Sat Mar 29 09:00:03 2014
+++ src/stored/Makefile.in	Fri Apr  4 22:13:11 2014
@@@@ -189,9 +189,6 @@@@ install: all
@


1.3
log
@fix builds on a system which doesn't have already-existing _bacula users/groups.
spotted by naddy@@, ok merdely@@ aja@@
@
text
@d1 4
a4 68
$OpenBSD: patch-src_stored_Makefile_in,v 1.2 2011/12/12 09:15:09 sthen Exp $

Reorder LDFLAGS (prefer -L.libs over /usr/local/lib) so that bacula can
be rebuilt while already installed.

--- src/stored/Makefile.in.orig	Tue Feb 21 15:59:33 2012
+++ src/stored/Makefile.in	Wed Mar  7 22:15:20 2012
@@@@ -95,12 +95,12 @@@@ all: Makefile bacula-sd @@STATIC_SD@@ bls bextract bscan
 
 bacula-sd: Makefile $(SDOBJS) ../lib/libbacpy$(DEFAULT_ARCHIVE_TYPE) ../lib/libbaccfg$(DEFAULT_ARCHIVE_TYPE) ../lib/libbac$(DEFAULT_ARCHIVE_TYPE)
 	@@echo "Linking $@@ ..."
-	$(LIBTOOL_LINK) $(CXX) $(WLDFLAGS) $(LDFLAGS) -L../lib -o $@@ $(SDOBJS) $(ZLIBS) \
+	$(LIBTOOL_LINK) $(CXX) -L../lib $(WLDFLAGS) $(LDFLAGS) -o $@@ $(SDOBJS) $(ZLIBS) \
 	   -lbacpy -lbaccfg -lbac -lm $(PYTHON_LIBS) $(DLIB) $(LIBS) $(WRAPLIBS) \
 	$(GETTEXT_LIBS) $(OPENSSL_LIBS) $(CAP_LIBS)
 
 static-bacula-sd: Makefile $(SDOBJS) ../lib/libbacpy$(DEFAULT_ARCHIVE_TYPE) ../lib/libbaccfg$(DEFAULT_ARCHIVE_TYPE) ../lib/libbac$(DEFAULT_ARCHIVE_TYPE)
-	$(LIBTOOL_LINK) $(CXX) $(WLDFLAGS) $(LDFLAGS) -static -L../lib -o $@@ $(SDOBJS) $(ZLIBS) \
+	$(LIBTOOL_LINK) $(CXX) -static -L../lib $(WLDFLAGS) $(LDFLAGS) -o $@@ $(SDOBJS) $(ZLIBS) \
 	   -lbacpy -lbaccfg -lbac -lm $(PYTHON_LIBS) $(DLIB) $(LIBS) $(WRAPLIBS) \
 	$(GETTEXT_LIBS) $(OPENSSL_LIBS) $(CAP_LIBS)
 	strip $@@
@@@@ -111,7 +111,7 @@@@ btape.o: btape.c
 	   -I$(basedir) $(DINCLUDE) $(CFLAGS) $<
 
 btape: Makefile  $(TAPEOBJS) ../lib/libbac$(DEFAULT_ARCHIVE_TYPE) ../lib/libbaccfg$(DEFAULT_ARCHIVE_TYPE)
-	$(LIBTOOL_LINK) $(CXX) $(TTOOL_LDFLAGS) $(LDFLAGS) -L../lib -o $@@ $(TAPEOBJS) \
+	$(LIBTOOL_LINK) $(CXX) $(TTOOL_LDFLAGS) -L../lib $(LDFLAGS) -o $@@ $(TAPEOBJS) \
 	   -lbaccfg -lbac $(DLIB) -lm $(LIBS) $(GETTEXT_LIBS) $(OPENSSL_LIBS)
 
 bls.o:	bls.c
@@@@ -121,7 +121,7 @@@@ bls.o:	bls.c
 
 bls:	Makefile $(BLSOBJS) ../findlib/libbacfind$(DEFAULT_ARCHIVE_TYPE) ../lib/libbaccfg$(DEFAULT_ARCHIVE_TYPE) ../lib/libbac$(DEFAULT_ARCHIVE_TYPE)
 	@@echo "Compiling $<"
-	$(LIBTOOL_LINK) $(CXX) $(TTOOL_LDFLAGS) $(LDFLAGS) -L../lib -L../findlib -o $@@ $(BLSOBJS) $(DLIB) \
+	$(LIBTOOL_LINK) $(CXX) $(TTOOL_LDFLAGS) -L../lib -L../findlib $(LDFLAGS) -o $@@ $(BLSOBJS) $(DLIB) \
 	   -lbacfind -lbaccfg -lbac -lm $(LIBS) $(GETTEXT_LIBS) $(OPENSSL_LIBS)
 
 bextract.o: bextract.c
@@@@ -131,7 +131,7 @@@@ bextract.o: bextract.c
 
 bextract: Makefile $(BEXTOBJS) ../findlib/libbacfind$(DEFAULT_ARCHIVE_TYPE) ../lib/libbaccfg$(DEFAULT_ARCHIVE_TYPE) ../lib/libbac$(DEFAULT_ARCHIVE_TYPE)
 	@@echo "Compiling $<"
-	$(LIBTOOL_LINK) $(CXX) $(TTOOL_LDFLAGS) $(LDFLAGS) -L../lib -L../findlib -o $@@ $(BEXTOBJS) $(DLIB) $(ZLIBS) $(LZOLIBS) \
+	$(LIBTOOL_LINK) $(CXX) $(TTOOL_LDFLAGS) -L../lib -L../findlib $(LDFLAGS) -o $@@ $(BEXTOBJS) $(DLIB) $(ZLIBS) $(LZOLIBS) \
 	   -lbacfind -lbaccfg -lbac -lm $(LIBS) $(GETTEXT_LIBS) $(OPENSSL_LIBS)
 
 bscan.o: bscan.c
@@@@ -141,7 +141,7 @@@@ bscan.o: bscan.c
 
 bscan:	Makefile $(SCNOBJS) ../findlib/libbacfind$(DEFAULT_ARCHIVE_TYPE) ../lib/libbaccfg$(DEFAULT_ARCHIVE_TYPE) \
 	../cats/libbacsql$(DEFAULT_ARCHIVE_TYPE) ../cats/libbaccats$(DEFAULT_ARCHIVE_TYPE)
-	$(LIBTOOL_LINK) $(CXX) $(TTOOL_LDFLAGS) $(LDFLAGS) -L../lib -L../cats -L../findlib -o $@@ $(SCNOBJS) \
+	$(LIBTOOL_LINK) $(CXX) $(TTOOL_LDFLAGS) -L../lib -L../cats -L../findlib $(LDFLAGS) -o $@@ $(SCNOBJS) \
 	   -lbacsql -lbaccats $(DB_LIBS) $(ZLIBS) -lbacfind -lbaccfg -lbac -lm $(LIBS) $(GETTEXT_LIBS) $(OPENSSL_LIBS)
 
 bcopy.o: bcopy.c
@@@@ -150,7 +150,7 @@@@ bcopy.o: bcopy.c
 	   -I$(basedir) $(DINCLUDE) $(CFLAGS) $<
 
 bcopy:	Makefile $(COPYOBJS) ../findlib/libbacfind$(DEFAULT_ARCHIVE_TYPE) ../lib/libbaccfg$(DEFAULT_ARCHIVE_TYPE) ../lib/libbac$(DEFAULT_ARCHIVE_TYPE)
-	$(LIBTOOL_LINK) $(CXX) $(TTOOL_LDFLAGS) $(LDFLAGS) -L../lib -o $@@ $(COPYOBJS) \
+	$(LIBTOOL_LINK) $(CXX) $(TTOOL_LDFLAGS) -L../lib $(LDFLAGS) -o $@@ $(COPYOBJS) \
 	   -lbaccfg -lbac -lm $(LIBS) $(GETTEXT_LIBS) $(OPENSSL_LIBS)
 
 Makefile: $(srcdir)/Makefile.in $(topdir)/config.status
@@@@ -173,9 +173,6 @@@@ install: all
@


1.2
log
@update Bacula to 5.2.2 (mostly bugfixes)

- Switch default flavour used by the port to pgsql; this is generally the
best-tested backend and gets the most testing. Setup isn't really
much more complicated than the old default in the port (sqlite) and
you don't really want to run into limitations and have to convert
it later. Doesn't affect packages as all flavours are built anyway.

ok ajacoutot@@ merdely@@ (maintainer)
@
text
@d1 1
a1 1
$OpenBSD: patch-src_stored_Makefile_in,v 1.1 2011/11/24 09:29:55 ajacoutot Exp $
d6 2
a7 2
--- src/stored/Makefile.in.orig	Sat Nov 26 14:08:12 2011
+++ src/stored/Makefile.in	Sun Dec  4 11:52:17 2011
d68 10
@


1.1
log
@Reorder LDFLAGS (prefer -L.libs over /usr/local/lib) so that bacula can
be rebuilt while already installed.
Also use gnu LIBTOOL, ours doesn't work correctly.
@
text
@d1 1
a1 1
$OpenBSD$
d6 3
a8 3
--- src/stored/Makefile.in.orig	Wed Nov 23 16:32:14 2011
+++ src/stored/Makefile.in	Wed Nov 23 16:34:53 2011
@@@@ -93,12 +93,12 @@@@ all: Makefile bacula-sd @@STATIC_SD@@ bls bextract bscan
d23 1
a23 1
@@@@ -109,7 +109,7 @@@@ btape.o: btape.c
d32 1
a32 1
@@@@ -119,7 +119,7 @@@@ bls.o:	bls.c
d41 1
a41 1
@@@@ -129,7 +129,7 @@@@ bextract.o: bextract.c
d50 1
a50 1
@@@@ -139,7 +139,7 @@@@ bscan.o: bscan.c
d59 1
a59 1
@@@@ -148,7 +148,7 @@@@ bcopy.o: bcopy.c
@

