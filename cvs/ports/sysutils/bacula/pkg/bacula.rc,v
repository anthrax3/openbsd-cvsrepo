head	1.4;
access;
symbols
	OPENBSD_6_1:1.4.0.6
	OPENBSD_6_1_BASE:1.4
	OPENBSD_6_0:1.4.0.4
	OPENBSD_6_0_BASE:1.4
	OPENBSD_5_9:1.4.0.2
	OPENBSD_5_9_BASE:1.4
	OPENBSD_5_8:1.3.0.6
	OPENBSD_5_8_BASE:1.3
	OPENBSD_5_7:1.3.0.2
	OPENBSD_5_7_BASE:1.3
	OPENBSD_5_6:1.1.0.6
	OPENBSD_5_6_BASE:1.1
	OPENBSD_5_5:1.1.0.4
	OPENBSD_5_5_BASE:1.1
	OPENBSD_5_4:1.1.0.2
	OPENBSD_5_4_BASE:1.1;
locks; strict;
comment	@ * @;


1.4
date	2015.11.29.15.50.20;	author ajacoutot;	state Exp;
branches;
next	1.3;
commitid	R4zDyQEPMusoKaj3;

1.3
date	2015.02.18.20.55.11;	author sthen;	state Exp;
branches;
next	1.2;
commitid	C8tPKSEVWfvUMniO;

1.2
date	2014.12.08.10.57.09;	author ajacoutot;	state Exp;
branches;
next	1.1;
commitid	pz71RdO0gxd0iylf;

1.1
date	2013.05.03.18.40.32;	author sthen;	state Exp;
branches;
next	;


desc
@@


1.4
log
@daemon_timeout is not passed to the child scripts either.
@
text
@#!/bin/sh
#
# $OpenBSD: bacula.rc,v 1.3 2015/02/18 20:55:11 sthen Exp $

# "meta" script running the following rc.d(8) scripts with the given argument;
# note that daemon_flags, daemon_user, daemon_timeout and daemon_class are not
# passed to the child scripts.

if [ "$1" = restart ]; then
	$0 stop && $0 start
	exit
fi

if [ "$1" = stop ]; then
	# stop the FD first so that SD will fail jobs and update catalog
	_pkg_scripts="bacula_fd bacula_sd bacula_dir"
else
	_pkg_scripts="bacula_sd bacula_fd bacula_dir"
fi

for _i in ${_pkg_scripts}; do
	if [[ -x ${RCDIR}/${_i} ]]; then
		${RCDIR}/${_i} $@@ || exit $?
	fi
done
@


1.3
log
@Adjust the "meta" rc-scripts (these are used in ports with multiple daemons
which should all be started/stopped together), previously "restart" would
restart each sub-daemon in turn, but actually it should stop all daemons
and only then start them again. Additionally, as suggested by ajacoutot,
stop the procedure and return an error if stopping one of the rc scripts
failed.  ok ajacoutot@@ rpe@@

(as done for a couple of other ports; bacula was actually the one I wanted
to fix this on but missed the earlier commit ;)
@
text
@d3 1
a3 1
# $OpenBSD: bacula.rc,v 1.2 2014/12/08 10:57:09 ajacoutot Exp $
d6 2
a7 2
# note that daemon_flags, daemon_user and daemon_class are not passed to
# the child scripts.
@


1.2
log
@Make all meta rc.d scripts consistent.
While here, unbreak when options are passed (e.g. /etc/rc.d/foobar -df start)

ok sthen@@
@
text
@d3 1
a3 1
# $OpenBSD: bacula.rc,v 1.1 2013/05/03 18:40:32 sthen Exp $
d9 5
d21 5
a25 1
for _i in ${_pkg_scripts}; do [[ -x ${RCDIR}/${_i} ]] && ${RCDIR}/${_i} $@@; done
@


1.1
log
@add a meta rc.d script for bacula, modelled after samba's, to start and
stop the various daemons together in order suggested by upstream's scripts.
ok ajacoutot@@
@
text
@d3 1
a3 1
# $OpenBSD$
d16 1
a16 1
for _i in ${_pkg_scripts}; do [[ -x ${RCDIR}/${_i} ]] && ${RCDIR}/${_i} $1; done
@

