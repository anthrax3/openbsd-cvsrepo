head	1.18;
access;
symbols
	OPENBSD_6_2:1.18.0.8
	OPENBSD_6_2_BASE:1.18
	OPENBSD_6_1:1.18.0.6
	OPENBSD_6_1_BASE:1.18
	OPENBSD_6_0:1.18.0.4
	OPENBSD_6_0_BASE:1.18
	OPENBSD_5_9:1.18.0.2
	OPENBSD_5_9_BASE:1.18
	OPENBSD_5_8:1.17.0.4
	OPENBSD_5_8_BASE:1.17
	OPENBSD_5_7:1.15.0.2
	OPENBSD_5_7_BASE:1.15
	OPENBSD_5_6:1.11.0.2
	OPENBSD_5_6_BASE:1.11
	OPENBSD_5_5:1.8.0.4
	OPENBSD_5_5_BASE:1.8
	OPENBSD_5_4:1.8.0.2
	OPENBSD_5_4_BASE:1.8
	OPENBSD_5_3:1.3.0.2
	OPENBSD_5_3_BASE:1.3
	OPENBSD_5_2:1.2.0.2
	OPENBSD_5_2_BASE:1.2
	OPENBSD_5_1_BASE:1.1
	OPENBSD_5_1:1.1.0.2;
locks; strict;
comment	@# @;


1.18
date	2015.08.15.07.50.02;	author ajacoutot;	state Exp;
branches;
next	1.17;
commitid	DcwQCoBvkpVxpEev;

1.17
date	2015.07.07.14.44.58;	author sthen;	state Exp;
branches;
next	1.16;
commitid	3ip2eKfpCQusYvJT;

1.16
date	2015.07.06.11.25.36;	author sthen;	state Exp;
branches;
next	1.15;
commitid	fXrDP8itzF5x6yPc;

1.15
date	2014.11.14.08.39.41;	author ajacoutot;	state Exp;
branches;
next	1.14;
commitid	gXHyAM3LlyxFbxvL;

1.14
date	2014.11.14.08.26.50;	author jasper;	state Exp;
branches;
next	1.13;
commitid	xJQdTrk2QZbBS0dU;

1.13
date	2014.11.04.16.46.03;	author ajacoutot;	state Exp;
branches;
next	1.12;
commitid	hL9z8ABekcbqskzK;

1.12
date	2014.09.14.05.58.07;	author ajacoutot;	state Exp;
branches;
next	1.11;
commitid	Wm0mDRCXhQhfZWj1;

1.11
date	2014.07.10.13.09.07;	author ajacoutot;	state Exp;
branches;
next	1.10;
commitid	Xpirey71VpT09196;

1.10
date	2014.06.13.13.34.38;	author ajacoutot;	state Exp;
branches;
next	1.9;
commitid	SwWdxgh63eEG2Vq9;

1.9
date	2014.04.19.09.44.11;	author ajacoutot;	state Exp;
branches;
next	1.8;

1.8
date	2013.06.06.13.57.48;	author ajacoutot;	state Exp;
branches;
next	1.7;

1.7
date	2013.06.05.16.23.14;	author ajacoutot;	state Exp;
branches;
next	1.6;

1.6
date	2013.06.05.16.12.05;	author ajacoutot;	state Exp;
branches;
next	1.5;

1.5
date	2013.06.05.15.05.01;	author ajacoutot;	state Exp;
branches;
next	1.4;

1.4
date	2013.06.05.14.30.23;	author ajacoutot;	state Exp;
branches;
next	1.3;

1.3
date	2013.01.15.12.46.53;	author ajacoutot;	state Exp;
branches;
next	1.2;

1.2
date	2012.06.16.07.08.55;	author robert;	state Exp;
branches;
next	1.1;

1.1
date	2011.11.17.23.45.56;	author ajacoutot;	state Exp;
branches;
next	;


desc
@@


1.18
log
@Update to bacula-client-7.2.0.
README parts from sthen@@

ok sthen@@
@
text
@$OpenBSD: README-server,v 1.17 2015/07/07 14:44:58 sthen Exp $

+-----------------------------------------------------------------------
| Running ${FULLPKGNAME} on OpenBSD
+-----------------------------------------------------------------------

Note: If upgrading from a version older than 7.2.0, a database upgrade
is necessary (see the ${TRUEPREFIX}/libexec/bacula/update_* scripts).
Also, the Director and Storage Daemons must be upgraded at the same
time, but older File Daemons can be used with 7.2.x.

The official Bacula documentation can be found at:
    http://blog.bacula.org/documentation/documentation/

Setting up the database for the Bacula Director
===============================================

In this documentation, it is assumed the PostgreSQL administrator user
is 'postgres' and the MariaDB one is 'root'; adapt accordingly to your
setup.
Replace 'dbpassword' with the bacula DB user password (configured in
${SYSCONFDIR}/bacula-dir.conf).

While SQLite3 may be of interest for quickly testing a setup, it is
not advised to use it in production but rather go for a full RDBMS
like PostgreSQL or MariaDB.

PostgreSQL
----------
Assuming you have an administrative account named `postgres',
you can create the 'bacula' user like this:

    $ createuser -U postgres --pwprompt --no-superuser \
      --createdb --no-createrole bacula

Creating the database and tables:
    $ cd ${TRUEPREFIX}/libexec/bacula
    $ ./create_postgresql_database -U bacula
    $ ./make_postgresql_tables postgresql -U bacula
    $ ./grant_postgresql_privileges -U bacula

Upgrading the schema following a Bacula version upgrade:
    $ cd ${TRUEPREFIX}/libexec/bacula
    $ ./update_postgresql_tables -U bacula

MariaDB
-------
Creating the DB, table and bacula user.
    $ cd ${TRUEPREFIX}/libexec/bacula
    $ ./create_mysql_database -u root -p
    $ ./make_mysql_tables -u root -p
    $ ./grant_mysql_privileges -u root -p

Setting up the bacula DB user password.
    $ mysql -u root -p bacula
    MariaDB [bacula]> SET PASSWORD FOR 'bacula'@@'localhost' = PASSWORD('dbpassword');
    MariaDB [bacula]> QUIT

Upgrading the schema following a Bacula version upgrade:
    $ cd ${TRUEPREFIX}/libexec/bacula
    $ ./update_mysql_tables -U bacula

SQLite3
-------
Creating the DB and tables (default to ${LOCALSTATEDIR}/bacula.db).
    # cd ${TRUEPREFIX}/libexec/bacula
    # su -m _bacula -c ./make_sqlite3_tables

Upgrading the schema following a Bacula version upgrade:
    # cd ${TRUEPREFIX}/libexec/bacula
    # su -m _bacula -c ./update_sqlite3_tables

Device permissions
==================

The storage daemon needs access to its storage device(s):

* when backup is stored on disk, the mount points must be accessible in
rw mode by the "_bacula-sd" user (and/or the "_bacula" group).

* when backup is stored on tape, the corresponding device node(s) must
be accessible in rw mode by the "_bacula-sd" user (and/or the "_bacula"
group); alternatively the "_bacula-sd" user can be added to the
"operator" group instead.
e.g. for an autochanger, add the following lines in rc.conf.local(8)
chgrp _bacula /dev/ch0
chgrp _bacula /dev/nrst0
@


1.17
log
@use su -m instead of -s /bin/sh, suggested by millert
add some missing -c
@
text
@d1 1
a1 1
$OpenBSD: README-server,v 1.16 2015/07/06 11:25:36 sthen Exp $
d7 1
a7 1
Note: If upgrading from a version older than 5.2.0, a database upgrade
d10 1
a10 1
time, but older File Daemons can be used with 5.2.x.
d25 2
a26 2
usually not advised to use it in production but rather go for a full
RDBMS like PostgreSQL or MariaDB.
d42 4
d59 4
d68 4
@


1.16
log
@Remove use of sudo from pkg READMEs in a few ports as packages and their
instructions are meant to work on a fresh install.

- easy cases: replace some '$ sudo somecommand' with '# somecommand'
(while there I've swapped some "${RCDIR}/foo start" with "rcctl foo start").

- replace some 'sudo -u user somecommand foo bar' with
'su -s /bin/sh user "/path/to/somecommand foo bar"' and similar.
Not pretty with the -s, but many of the uids that need to run
these commands have /sbin/nologin as their usual shell.
@
text
@d1 1
a1 1
$OpenBSD: README-server,v 1.15 2014/11/14 08:39:41 ajacoutot Exp $
d59 1
a59 1
    # su -s /bin/sh _bacula ./make_sqlite3_tables
@


1.15
log
@Last commit was not enough.
@
text
@d1 1
a1 1
$OpenBSD: README-server,v 1.14 2014/11/14 08:26:50 jasper Exp $
d58 2
a59 2
    $ cd ${TRUEPREFIX}/libexec/bacula
    $ sudo -u _bacula ./make_sqlite3_tables
@


1.14
log
@fixup instructions to initialize the database tables

ok sthen@@ (MAINTAINER)
@
text
@d1 1
a1 1
$OpenBSD: README-server,v 1.13 2014/11/04 16:46:03 ajacoutot Exp $
a29 1

d38 3
a40 3
    $ ./create_bacula_database -U bacula
    $ ./make_bacula_tables postgresql -U bacula
    $ ./grant_bacula_privileges -U bacula
a43 1

d46 3
a48 3
    $ ./create_bacula_database -u root -p
    $ ./make_bacula_tables mysql -u root -p
    $ ./grant_bacula_privileges -u root -p
a56 1

d59 1
a59 1
    $ sudo -u _bacula ./make_bacula_tables sqlite3
@


1.13
log
@Simplify.
@
text
@d1 1
a1 1
$OpenBSD: README-server,v 1.12 2014/09/14 05:58:07 ajacoutot Exp $
d40 1
a40 1
    $ ./make_bacula_tables -U bacula
d49 1
a49 1
    $ ./make_bacula_tables -u root -p
d62 1
a62 1
    $ sudo -u _bacula ./make_bacula_tables
@


1.12
log
@MySQL -> MariaDB in READMEs.
@
text
@d1 1
a1 1
$OpenBSD: README-server,v 1.11 2014/07/10 13:09:07 ajacoutot Exp $
d54 1
a54 2
    MariaDB [bacula]> GRANT ALL PRIVILEGES ON `bacula` . *
        -> TO 'bacula'@@'localhost' IDENTIFIED BY 'dbpassword';
@


1.11
log
@rc.conf.local is in man(1) section 8, at least for now.
@
text
@d1 1
a1 1
$OpenBSD: README-server,v 1.10 2014/06/13 13:34:38 ajacoutot Exp $
d19 1
a19 1
is 'postgres' and the MySQL one is 'root'; adapt accordingly to your
d26 1
a26 1
RDBMS like PostgreSQL or MySQL.
d43 2
a44 2
MySQL
-----
d54 1
a54 1
    mysql> GRANT ALL PRIVILEGES ON `bacula` . *
d56 1
a56 1
    mysql> QUIT
@


1.10
log
@Fix path to doc.
@
text
@d1 1
a1 1
$OpenBSD: README-server,v 1.9 2014/04/19 09:44:11 ajacoutot Exp $
d77 1
a77 1
e.g. for an autochanger, add the following lines in rc.conf.local(5)
@


1.9
log
@Major update to Bacula 7.0.2.
Some info at:
http://blog.bacula.org/p710/
http://blog.bacula.org/release-7-0-2/

Now builds with our libtool(1).

While there's a huge amount of changes, existing setups "should" just
work without any modification.

tested by sthen@@ and myself
ok sthen@@, my new co-maintainer :-)
@
text
@d1 1
a1 1
$OpenBSD: README-server,v 1.8 2013/06/06 13:57:48 ajacoutot Exp $
d13 1
a13 1
    http://bacula.org/5.2.x-manuals/en/main/main/index.html
@


1.8
log
@Revert the mysql->MariaDB blurb in the READMEs.
It seems the MariaDB move will be reverted.
@
text
@d1 1
a1 1
$OpenBSD: README-server,v 1.7 2013/06/05 16:23:14 ajacoutot Exp $
d22 1
a22 1
${BACULACONF}/bacula-dir.conf).
d61 1
a61 1
Creating the DB and tables (default to ${BACULASTATE}/bacula.db).
@


1.7
log
@"operator" can be used as well.
@
text
@d1 1
a1 1
$OpenBSD: README-server,v 1.6 2013/06/05 16:12:05 ajacoutot Exp $
d54 3
a56 3
    MariaDB [bacula]> GRANT ALL PRIVILEGES ON `bacula` . *
                   -> TO 'bacula'@@'localhost' IDENTIFIED BY 'dbpassword';
    MariaDB [bacula]> QUIT
@


1.6
log
@Clearer.
@
text
@d1 1
a1 1
$OpenBSD: README-server,v 1.5 2013/06/05 15:05:01 ajacoutot Exp $
d75 2
a76 1
group).
@


1.5
log
@Fix up permissions for tape devices versus autochangers.
@
text
@d1 1
a1 1
$OpenBSD: README-server,v 1.4 2013/06/05 14:30:23 ajacoutot Exp $
d68 1
a68 1
The Bacula user needs access to its storage device(s):
d71 1
a71 1
rw mode by the "_bacula-sd" user.
d74 2
a75 2
be accessible in rw mode by the "_bacula-sd" user and the autochanger
device by the "_bacula" user.
d78 1
a78 1
chgrp _bacula-sd /dev/nrst0
@


1.4
log
@mysql -> MariaDB
@
text
@d1 1
a1 1
$OpenBSD: README-server,v 1.3 2013/01/15 12:46:53 ajacoutot Exp $
d74 2
a75 1
be accessible in rw mode by the "_bacula" user.
d78 1
a78 1
chgrp _bacula /dev/nrst0
@


1.3
log
@Document device permissions.

ok sthen@@
@
text
@d1 1
a1 1
$OpenBSD: README-server,v 1.2 2012/06/16 07:08:55 robert Exp $
d54 3
a56 3
    mysql> GRANT ALL PRIVILEGES ON `bacula` . *
        -> TO 'bacula'@@'localhost' IDENTIFIED BY 'dbpassword';
    mysql> QUIT
@


1.2
log
@Rework the PgSQL part of the documentation in order to setup proper
permissions of the database while creating it.

ok ajacoutot@@, sthen@@, merdely@@
@
text
@d1 1
a1 1
$OpenBSD: README-server,v 1.1 2011/11/17 23:45:56 ajacoutot Exp $
d64 14
@


1.1
log
@Major update to bacula 5.2.1.

As usual with major version bump, do not forget to run the upgrade
script corresponding to your DB.
A new README is provided in the package.

Tested by sthen@@ and myself.
"Don't wait on me" merdely@@ (maintainer)

ok sthen@@
@
text
@d1 1
a1 1
$OpenBSD$
d31 7
a37 1
Creating the DB, table and bacula user.
d39 3
a41 8
    $ ./create_bacula_database -U postgres
    $ ./make_bacula_tables -U postgres
    $ ./grant_bacula_privileges -U postgres

Setting up the bacula DB user password.
    $ psql -U postgres
    postgres=# alter user bacula with password 'dbpassword';
    postgres=# \q
@

