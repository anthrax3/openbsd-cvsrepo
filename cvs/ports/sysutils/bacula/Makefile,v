head	1.110;
access;
symbols
	OPENBSD_6_1:1.106.0.2
	OPENBSD_6_1_BASE:1.106
	OPENBSD_6_0:1.97.0.2
	OPENBSD_6_0_BASE:1.97
	OPENBSD_5_9:1.94.0.2
	OPENBSD_5_9_BASE:1.94
	OPENBSD_5_8:1.90.0.4
	OPENBSD_5_8_BASE:1.90
	OPENBSD_5_7:1.87.0.2
	OPENBSD_5_7_BASE:1.87
	OPENBSD_5_6:1.79.0.2
	OPENBSD_5_6_BASE:1.79
	OPENBSD_5_5:1.69.0.2
	OPENBSD_5_5_BASE:1.69
	OPENBSD_5_4:1.66.0.2
	OPENBSD_5_4_BASE:1.66
	OPENBSD_5_3:1.54.0.2
	OPENBSD_5_3_BASE:1.54
	OPENBSD_5_2:1.48.0.2
	OPENBSD_5_2_BASE:1.48
	OPENBSD_5_1_BASE:1.38
	OPENBSD_5_1:1.38.0.2
	OPENBSD_5_0:1.29.0.2
	OPENBSD_5_0_BASE:1.29
	OPENBSD_4_9:1.27.0.2
	OPENBSD_4_9_BASE:1.27
	OPENBSD_4_8:1.22.0.2
	OPENBSD_4_8_BASE:1.22
	OPENBSD_4_7:1.19.0.2
	OPENBSD_4_7_BASE:1.19
	OPENBSD_4_6:1.14.0.2
	OPENBSD_4_6_BASE:1.14
	OPENBSD_4_5:1.13.0.2
	OPENBSD_4_5_BASE:1.13
	OPENBSD_4_4:1.10.0.4
	OPENBSD_4_4_BASE:1.10
	OPENBSD_4_3:1.10.0.2
	OPENBSD_4_3_BASE:1.10
	OPENBSD_4_2:1.2.0.2
	OPENBSD_4_2_BASE:1.2
	robert20070720:1.1.1.1
	robert:1.1.1;
locks; strict;
comment	@# @;


1.110
date	2017.07.16.19.20.57;	author espie;	state Exp;
branches;
next	1.109;
commitid	E9WZHiB3Q5YEtwRn;

1.109
date	2017.07.14.21.43.22;	author sthen;	state Exp;
branches;
next	1.108;
commitid	6AwejDusMztqVYoi;

1.108
date	2017.07.07.16.01.58;	author sthen;	state Exp;
branches;
next	1.107;
commitid	F2yJoaTOBG2uYjSx;

1.107
date	2017.04.10.11.46.33;	author sthen;	state Exp;
branches;
next	1.106;
commitid	HY6VNZxjJWzKQFDV;

1.106
date	2017.03.16.11.04.35;	author sthen;	state Exp;
branches;
next	1.105;
commitid	OyaOq3W4M64CprI9;

1.105
date	2017.03.13.09.42.57;	author sthen;	state Exp;
branches;
next	1.104;
commitid	fT6V8KCJs4PRy4K8;

1.104
date	2017.02.16.17.16.19;	author sthen;	state Exp;
branches;
next	1.103;
commitid	VxbCRreBOHTm51p6;

1.103
date	2016.11.02.21.08.29;	author sthen;	state Exp;
branches;
next	1.102;
commitid	MRO1nLIKtjZ1g1j5;

1.102
date	2016.10.11.21.26.10;	author sthen;	state Exp;
branches;
next	1.101;
commitid	tEEbvM1vV84aIFkc;

1.101
date	2016.10.11.19.19.45;	author sthen;	state Exp;
branches;
next	1.100;
commitid	kLeLUXFUndXqCZ37;

1.100
date	2016.10.11.13.27.28;	author sthen;	state Exp;
branches;
next	1.99;
commitid	Vp53K4OIlghYapaT;

1.99
date	2016.09.23.09.16.57;	author sthen;	state Exp;
branches;
next	1.98;
commitid	XLnI6AbHAmyVU5mO;

1.98
date	2016.07.30.21.43.24;	author sthen;	state Exp;
branches;
next	1.97;
commitid	VHBZkgd7t8M3HLHY;

1.97
date	2016.07.08.12.59.13;	author sthen;	state Exp;
branches;
next	1.96;
commitid	MtPxPw6CpurOsNPU;

1.96
date	2016.06.06.14.10.57;	author sthen;	state Exp;
branches;
next	1.95;
commitid	cveGO9Q88BqDyU4p;

1.95
date	2016.03.18.21.38.25;	author naddy;	state Exp;
branches;
next	1.94;
commitid	BVkebQSTXSZokeRG;

1.94
date	2016.01.19.22.51.09;	author sthen;	state Exp;
branches;
next	1.93;
commitid	14u3fTpCWO7OUNMR;

1.93
date	2015.11.29.15.50.20;	author ajacoutot;	state Exp;
branches;
next	1.92;
commitid	R4zDyQEPMusoKaj3;

1.92
date	2015.10.17.10.30.16;	author ajacoutot;	state Exp;
branches;
next	1.91;
commitid	ZEfkdgsnAeQCFVTf;

1.91
date	2015.08.15.07.50.02;	author ajacoutot;	state Exp;
branches;
next	1.90;
commitid	DcwQCoBvkpVxpEev;

1.90
date	2015.07.15.15.53.48;	author sthen;	state Exp;
branches;
next	1.89;
commitid	T2rFx6avGoypcAnm;

1.89
date	2015.07.07.14.44.58;	author sthen;	state Exp;
branches;
next	1.88;
commitid	3ip2eKfpCQusYvJT;

1.88
date	2015.07.06.11.25.36;	author sthen;	state Exp;
branches;
next	1.87;
commitid	fXrDP8itzF5x6yPc;

1.87
date	2015.02.18.20.55.11;	author sthen;	state Exp;
branches;
next	1.86;
commitid	C8tPKSEVWfvUMniO;

1.86
date	2014.12.08.10.57.09;	author ajacoutot;	state Exp;
branches;
next	1.85;
commitid	pz71RdO0gxd0iylf;

1.85
date	2014.11.14.08.39.41;	author ajacoutot;	state Exp;
branches;
next	1.84;
commitid	gXHyAM3LlyxFbxvL;

1.84
date	2014.11.14.08.26.50;	author jasper;	state Exp;
branches;
next	1.83;
commitid	xJQdTrk2QZbBS0dU;

1.83
date	2014.11.04.16.46.03;	author ajacoutot;	state Exp;
branches;
next	1.82;
commitid	hL9z8ABekcbqskzK;

1.82
date	2014.09.14.05.58.07;	author ajacoutot;	state Exp;
branches;
next	1.81;
commitid	Wm0mDRCXhQhfZWj1;

1.81
date	2014.09.13.18.09.22;	author brad;	state Exp;
branches;
next	1.80;
commitid	PpbRjVZdAmlrmi8q;

1.80
date	2014.08.14.06.52.59;	author ajacoutot;	state Exp;
branches;
next	1.79;
commitid	SWEgo0VEo1kHfm7f;

1.79
date	2014.07.10.13.09.06;	author ajacoutot;	state Exp;
branches;
next	1.78;
commitid	Xpirey71VpT09196;

1.78
date	2014.06.23.07.57.48;	author ajacoutot;	state Exp;
branches;
next	1.77;
commitid	Z2DUPze9Hz2boD65;

1.77
date	2014.06.13.15.31.21;	author ajacoutot;	state Exp;
branches;
next	1.76;
commitid	XFQpO5fiedhGLmpj;

1.76
date	2014.06.13.13.34.38;	author ajacoutot;	state Exp;
branches;
next	1.75;
commitid	SwWdxgh63eEG2Vq9;

1.75
date	2014.06.04.14.40.08;	author ajacoutot;	state Exp;
branches;
next	1.74;
commitid	966YiqenyqgpxoNl;

1.74
date	2014.05.21.10.12.34;	author ajacoutot;	state Exp;
branches;
next	1.73;

1.73
date	2014.04.21.22.12.07;	author ajacoutot;	state Exp;
branches;
next	1.72;

1.72
date	2014.04.19.10.26.55;	author sthen;	state Exp;
branches;
next	1.71;

1.71
date	2014.04.19.09.44.11;	author ajacoutot;	state Exp;
branches;
next	1.70;

1.70
date	2014.03.24.18.19.21;	author ajacoutot;	state Exp;
branches;
next	1.69;

1.69
date	2014.01.28.09.02.12;	author ajacoutot;	state Exp;
branches;
next	1.68;

1.68
date	2014.01.28.08.50.58;	author ajacoutot;	state Exp;
branches;
next	1.67;

1.67
date	2014.01.19.09.54.18;	author ajacoutot;	state Exp;
branches;
next	1.66;

1.66
date	2013.06.12.20.36.34;	author brad;	state Exp;
branches;
next	1.65;

1.65
date	2013.06.06.13.57.48;	author ajacoutot;	state Exp;
branches;
next	1.64;

1.64
date	2013.06.05.16.23.14;	author ajacoutot;	state Exp;
branches;
next	1.63;

1.63
date	2013.06.05.16.12.05;	author ajacoutot;	state Exp;
branches;
next	1.62;

1.62
date	2013.06.05.15.05.01;	author ajacoutot;	state Exp;
branches;
next	1.61;

1.61
date	2013.06.05.14.30.23;	author ajacoutot;	state Exp;
branches;
next	1.60;

1.60
date	2013.05.25.00.33.10;	author brad;	state Exp;
branches;
next	1.59;

1.59
date	2013.05.03.18.40.32;	author sthen;	state Exp;
branches;
next	1.58;

1.58
date	2013.04.12.10.39.04;	author ajacoutot;	state Exp;
branches;
next	1.57;

1.57
date	2013.03.21.15.04.18;	author ajacoutot;	state Exp;
branches;
next	1.56;

1.56
date	2013.03.11.11.41.29;	author espie;	state Exp;
branches;
next	1.55;

1.55
date	2013.03.02.13.54.52;	author ajacoutot;	state Exp;
branches;
next	1.54;

1.54
date	2013.01.15.12.46.52;	author ajacoutot;	state Exp;
branches;
next	1.53;

1.53
date	2013.01.11.22.15.31;	author sthen;	state Exp;
branches;
next	1.52;

1.52
date	2012.11.09.16.39.51;	author sthen;	state Exp;
branches;
next	1.51;

1.51
date	2012.10.01.10.34.54;	author ajacoutot;	state Exp;
branches;
next	1.50;

1.50
date	2012.09.14.08.14.30;	author ajacoutot;	state Exp;
branches;
next	1.49;

1.49
date	2012.08.04.15.17.06;	author ajacoutot;	state Exp;
branches;
next	1.48;

1.48
date	2012.07.17.09.31.21;	author sthen;	state Exp;
branches
	1.48.2.1;
next	1.47;

1.47
date	2012.07.09.18.40.58;	author sthen;	state Exp;
branches;
next	1.46;

1.46
date	2012.07.04.12.02.56;	author ajacoutot;	state Exp;
branches;
next	1.45;

1.45
date	2012.06.28.19.24.56;	author ajacoutot;	state Exp;
branches;
next	1.44;

1.44
date	2012.06.16.07.08.55;	author robert;	state Exp;
branches;
next	1.43;

1.43
date	2012.04.23.17.15.19;	author espie;	state Exp;
branches;
next	1.42;

1.42
date	2012.04.04.21.30.56;	author merdely;	state Exp;
branches;
next	1.41;

1.41
date	2012.04.03.10.05.47;	author sthen;	state Exp;
branches;
next	1.40;

1.40
date	2012.03.08.17.34.34;	author sthen;	state Exp;
branches;
next	1.39;

1.39
date	2012.03.06.20.11.33;	author sthen;	state Exp;
branches;
next	1.38;

1.38
date	2011.12.12.09.15.09;	author sthen;	state Exp;
branches;
next	1.37;

1.37
date	2011.11.27.17.02.25;	author ajacoutot;	state Exp;
branches;
next	1.36;

1.36
date	2011.11.25.11.00.27;	author ajacoutot;	state Exp;
branches;
next	1.35;

1.35
date	2011.11.24.09.57.38;	author ajacoutot;	state Exp;
branches;
next	1.34;

1.34
date	2011.11.24.09.29.55;	author ajacoutot;	state Exp;
branches;
next	1.33;

1.33
date	2011.11.17.23.45.56;	author ajacoutot;	state Exp;
branches;
next	1.32;

1.32
date	2011.10.21.17.04.23;	author espie;	state Exp;
branches;
next	1.31;

1.31
date	2011.09.20.08.01.20;	author landry;	state Exp;
branches;
next	1.30;

1.30
date	2011.09.16.11.41.39;	author espie;	state Exp;
branches;
next	1.29;

1.29
date	2011.07.14.15.02.18;	author naddy;	state Exp;
branches;
next	1.28;

1.28
date	2011.03.21.17.06.23;	author ajacoutot;	state Exp;
branches;
next	1.27;

1.27
date	2010.11.20.17.22.40;	author espie;	state Exp;
branches;
next	1.26;

1.26
date	2010.10.19.07.43.00;	author espie;	state Exp;
branches;
next	1.25;

1.25
date	2010.10.12.19.47.06;	author robert;	state Exp;
branches;
next	1.24;

1.24
date	2010.09.24.21.10.16;	author steven;	state Exp;
branches;
next	1.23;

1.23
date	2010.09.22.06.56.57;	author landry;	state Exp;
branches;
next	1.22;

1.22
date	2010.08.05.13.32.27;	author merdely;	state Exp;
branches;
next	1.21;

1.21
date	2010.07.20.14.38.39;	author merdely;	state Exp;
branches;
next	1.20;

1.20
date	2010.03.28.16.05.25;	author ajacoutot;	state Exp;
branches;
next	1.19;

1.19
date	2010.01.19.14.50.51;	author sthen;	state Exp;
branches;
next	1.18;

1.18
date	2009.12.22.12.51.52;	author sthen;	state Exp;
branches;
next	1.17;

1.17
date	2009.11.08.01.26.08;	author merdely;	state Exp;
branches;
next	1.16;

1.16
date	2009.10.02.02.34.05;	author merdely;	state Exp;
branches;
next	1.15;

1.15
date	2009.08.10.06.34.29;	author kili;	state Exp;
branches;
next	1.14;

1.14
date	2009.06.19.11.13.39;	author sthen;	state Exp;
branches;
next	1.13;

1.13
date	2009.01.12.21.17.07;	author sthen;	state Exp;
branches;
next	1.12;

1.12
date	2008.11.04.21.32.44;	author sthen;	state Exp;
branches;
next	1.11;

1.11
date	2008.10.19.03.44.42;	author merdely;	state Exp;
branches;
next	1.10;

1.10
date	2008.02.16.21.22.41;	author merdely;	state Exp;
branches;
next	1.9;

1.9
date	2008.02.07.02.53.35;	author merdely;	state Exp;
branches;
next	1.8;

1.8
date	2007.10.09.15.39.17;	author merdely;	state Exp;
branches;
next	1.7;

1.7
date	2007.09.14.14.58.58;	author merdely;	state Exp;
branches;
next	1.6;

1.6
date	2007.09.11.20.26.45;	author merdely;	state Exp;
branches;
next	1.5;

1.5
date	2007.09.05.07.57.33;	author merdely;	state Exp;
branches;
next	1.4;

1.4
date	2007.09.01.19.19.41;	author merdely;	state Exp;
branches;
next	1.3;

1.3
date	2007.08.28.17.51.08;	author espie;	state Exp;
branches;
next	1.2;

1.2
date	2007.07.22.21.20.08;	author robert;	state Exp;
branches;
next	1.1;

1.1
date	2007.07.20.11.02.14;	author robert;	state Exp;
branches
	1.1.1.1;
next	;

1.1.1.1
date	2007.07.20.11.02.14;	author robert;	state Exp;
branches;
next	;

1.48.2.1
date	2012.09.15.10.42.29;	author sthen;	state Exp;
branches;
next	;


desc
@@


1.110
log
@...and those last 5, which got updated while I was creating the diff
@
text
@# $OpenBSD: Makefile,v 1.109 2017/07/14 21:43:22 sthen Exp $

# XXX building this port while a version is already installed on the
# system will lead to unexpected hidden dependencies!!!

COMMENT-main=		network backup solution (client)
COMMENT-server=		network backup solution (server)
COMMENT-bat=		network backup solution (gui-client)
COMMENT-mysql=		Bacula libbaccats support for MySQL
COMMENT-pgsql=		Bacula libbaccats support for PostgreSQL
COMMENT-sqlite3=	Bacula libbaccats support for SQLite3

V=			9.0.1
DISTNAME=		bacula-$V
PKGNAME-main=		bacula-client-$V
PKGNAME-server=		bacula-server-$V
PKGNAME-bat=		bacula-bat-$V
PKGNAME-mysql=		bacula-mysql-$V
PKGNAME-pgsql=		bacula-pgsql-$V
PKGNAME-sqlite3=	bacula-sqlite3-$V

CATEGORIES=		sysutils

SHARED_LIBS +=  bac                  7.0
SHARED_LIBS +=  baccfg               7.0
SHARED_LIBS +=  bacfind              6.0
SHARED_LIBS +=  bacsd                1.0
SHARED_LIBS +=  bacsql               6.0

BACCATS_LIBV =	4.0
SHARED_LIBS +=  baccats              ${BACCATS_LIBV}
SHARED_LIBS +=  baccats-mysql        ${BACCATS_LIBV}
SHARED_LIBS +=  baccats-postgresql   ${BACCATS_LIBV}
SHARED_LIBS +=  baccats-sqlite3      ${BACCATS_LIBV}

MASTER_SITES=		${MASTER_SITE_SOURCEFORGE:=bacula/}
HOMEPAGE=		http://www.bacula.org/

MAINTAINER=		Stuart Henderson <sthen@@openbsd.org>

WANTLIB += c pthread crypto ssl z m ${COMPILER_LIBCXX}

# AGPLv3 with exception for OpenSSL (majority),
# FDL (docs), LGPL (some libraries), and PD
# http://www.bacula.org/7.0.x-manuals/en/main/Bacula_Copyright_Trademark_.html
PERMIT_PACKAGE_CDROM=	Yes

MODULES=		devel/gettext

LOCALSTATEDIR=		${BASELOCALSTATEDIR}/bacula
SYSCONFDIR=		${BASESYSCONFDIR}/bacula

PATCHORIG=		.orig.port
CONFIGURE_STYLE=	gnu
USE_GMAKE=		Yes
NO_TEST=		Yes

PSEUDO_FLAVORS=		no_bat
FLAVOR?=

MULTI_PACKAGES=		-main -server -bat -mysql -pgsql -sqlite3

CONFIGURE_ARGS=		--enable-smartalloc \
			--docdir=${PREFIX}/share/doc/bacula \
			--htmldir=${PREFIX}/share/doc/bacula/html \
			--with-dir-user=_bacula \
			--with-dir-group=_bacula \
			--with-sd-user=_bacula-sd \
			--with-sd-group=_bacula \
			--with-scriptdir=${PREFIX}/libexec/bacula \
			--with-fd-user=root \
			--with-fd-group=wheel \
			--with-pid-dir=/var/run \
			--with-subsys-dir=${LOCALSTATEDIR} \
			--with-working-dir=${LOCALSTATEDIR} \
			--with-bsrdir=${LOCALSTATEDIR} \
			--with-logdir=${LOCALSTATEDIR} \
			--with-sbin-perm=755 \
			--without-x \
			--disable-nls \
			--disable-conio \
			--enable-readline \
			--with-readline=/usr \
			--with-openssl \
			--with-basename=bacula \
			--with-hostname=bacula.domain.tld

# build support for all DBs at once,
# the libbaccats pkg will decide DB support on a system
CONFIGURE_ARGS +=	--with-mysql \
			--with-postgresql \
			--with-sqlite3

MAKE_FLAGS=		NO_ECHO=
LIBTOOL_FLAGS=		--tag=disable-static

CONFIGURE_ENV=		CPPFLAGS="-I${LOCALBASE}/include" \
			LDFLAGS="-L${LOCALBASE}/lib" \
			CONFIG_SITE=${PORTSDIR}/infrastructure/db/config.site \
			MTX=/bin/chio \
			PKG_CONFIG_LIBDIR="${LOCALBASE}/lib/qt4/pkgconfig:${LOCALBASE}/lib/qt4" \
			QMAKE=${LOCALBASE}/bin/qmake4

# configure mistakenly assumes xattr support if it finds any of the
# openat() family of functions, so poison the autoconf cache.
# None of these functions are used outside the code for Solaris xattr 
# as of 5.0.2.
.for ac_func in openat fstatat unlinkat fchownat futimesat
CONFIGURE_ENV +=	ac_cv_func_${ac_func}=no
.endfor

WANTLIB-main += ${WANTLIB} lzo2 ncurses readline
LIB_DEPENDS-main=	${LIB_DEPENDS} \
			archivers/lzo2

WANTLIB-server += ${WANTLIB} bac baccats baccfg bacfind lzo2
LIB_DEPENDS-server=	${LIB_DEPENDS} \
			sysutils/bacula,-main \
			bacula-pgsql-*|bacula-mysql-*|bacula-sqlite3-*:sysutils/bacula,-pgsql

WANTLIB-pgsql += pq crypto m ssl ${COMPILER_LIBCXX}
LIB_DEPENDS-pgsql +=	databases/postgresql

WANTLIB-mysql += mysqlclient_r crypto m pthread ssl ${COMPILER_LIBCXX} z
LIB_DEPENDS-mysql +=	databases/mariadb

WANTLIB-sqlite3 += sqlite3 m pthread ${COMPILER_LIBCXX}
LIB_DEPENDS-sqlite3=	databases/sqlite3

WANTLIB-bat += ${WANTLIB}
WANTLIB-bat += ICE QtCore QtGui SM X11 Xext Xi Xinerama Xrender bac
WANTLIB-bat += baccfg bacfind expat fontconfig freetype xcb pthread-stubs
WANTLIB-bat += ffi glib-2.0 gobject-2.0 gthread-2.0 pcre png
RUN_DEPENDS-bat=	${RUN_DEPENDS} \
			devel/desktop-file-utils
LIB_DEPENDS-bat=	${LIB_DEPENDS} \
			x11/qt4 \
			sysutils/bacula,-main

.include <bsd.port.arch.mk>
.if !${BUILD_PACKAGES:M-bat}
CONFIGURE_ARGS +=	--disable-bat
.else
CONFIGURE_ARGS +=	--enable-bat
.endif

pre-configure:
	${SUBST_CMD} ${WRKSRC}/manpages/bat.1 \
		${WRKSRC}/src/qt-console/main.cpp \
		${WRKSRC}/scripts/bat.desktop.in

post-install:
	${INSTALL_DATA_DIR} ${PREFIX}/share/examples/bacula
	${INSTALL_SCRIPT_DIR} ${PREFIX}/libexec/bacula/updatedb
	${INSTALL_SCRIPT} ${WRKSRC}/updatedb/* ${PREFIX}/libexec/bacula/updatedb
	${INSTALL_SCRIPT} ${WRKSRC}/examples/autochangers/chio-changer-openbsd \
		${PREFIX}/libexec/bacula/chio-changer-openbsd.dist
	rm ${PREFIX}/libexec/bacula/updatedb/update*.in
	rm ${PREFIX}/lib/libbaccats.la
	mv ${PREFIX}/libexec/bacula/query.sql{,.dist}
	mv ${PREFIX}/libexec/bacula/mtx-changer.conf{,.dist}
	rm ${PREFIX}/sbin/bacula
# does nothing
	cd ${PREFIX}/libexec/bacula/updatedb && rm update_bacula_tables_8_to_9
# unneeded: SQLite2
	cd ${PREFIX}/libexec/bacula/updatedb && rm update_sqlite_tables_4_to_5 \
		update_sqlite_tables_5_to_6 update_sqlite_tables_6_to_7 \
		update_sqlite_tables_7_to_8 update_sqlite_tables_8_to_9
.if ${BUILD_PACKAGES:M-bat}
	${INSTALL_DATA_DIR} ${PREFIX}/share/pixmaps
	${INSTALL_DATA} ${WRKSRC}/src/qt-console/images/bat_icon.png \
		${PREFIX}/share/pixmaps
	${INSTALL_DATA_DIR} ${PREFIX}/share/applications
	${INSTALL_DATA} ${WRKSRC}/scripts/bat.desktop ${PREFIX}/share/applications
.else
	rm ${PREFIX}/man/man1/bat.1
.endif
	mv ${WRKINST}/etc/bacula/* ${PREFIX}/share/examples/bacula/
	rmdir ${WRKINST}/{etc,var}/bacula

.include <bsd.port.mk>
@


1.109
log
@update to bacula-9.0.1
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.108 2017/07/07 16:01:58 sthen Exp $
d121 1
a121 1
WANTLIB-pgsql += pq crypto m ssl ${LIBCXX}
d124 1
a124 1
WANTLIB-mysql += mysqlclient_r crypto m pthread ssl ${LIBCXX} z
d127 1
a127 1
WANTLIB-sqlite3 += sqlite3 m pthread ${LIBCXX}
@


1.108
log
@Major update to Bacula-9.0.0: note that this requires a database schema
change, so follow the usual upgrade documentation. This is still compatible
with older File Daemons (clients).
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.107 2017/04/10 11:46:33 sthen Exp $
d13 1
a13 1
V=			9.0.0
d41 1
a41 1
WANTLIB += c pthread crypto ssl z m ${LIBCXX}
@


1.107
log
@use LIBCXX
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.106 2017/03/16 11:04:35 sthen Exp $
d13 1
a13 1
V=			7.4.7
d24 5
a28 4
SHARED_LIBS +=  bac                  6.0
SHARED_LIBS +=  baccfg               6.0
SHARED_LIBS +=  bacfind              5.1
SHARED_LIBS +=  bacsql               5.0
d30 1
a30 1
BACCATS_LIBV =	3.0
d53 1
d95 1
d159 1
a159 1
	rm ${PREFIX}/lib/libbaccats.{a,la}
@


1.106
log
@update to Bacula 7.4.7
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.105 2017/03/13 09:42:57 sthen Exp $
d40 1
a40 1
WANTLIB += c pthread crypto ssl z m stdc++
d118 1
a118 1
WANTLIB-pgsql += pq crypto m ssl stdc++
d121 1
a121 1
WANTLIB-mysql += mysqlclient_r crypto m pthread ssl stdc++ z
d124 1
a124 1
WANTLIB-sqlite3 += sqlite3 m pthread stdc++
@


1.105
log
@update to bacula-7.4.6
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.104 2017/02/16 17:16:19 sthen Exp $
d13 1
a13 1
V=			7.4.6
@


1.104
log
@update to bacula-7.4.5, patched to avoid an FD segfault.
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.103 2016/11/02 21:08:29 sthen Exp $
d13 1
a13 1
V=			7.4.5
@


1.103
log
@fix WANTLIB-sqlite3, missing pthread
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.102 2016/10/11 21:26:10 sthen Exp $
d13 1
a13 3
V=			7.4.4pl0
DISTFILES=		${DISTNAME}{bacula-7.4.4}.tar.gz
WRKDIST=		${WRKDIR}/bacula-7.4.4
a20 1
REVISION-sqlite3=	0
@


1.102
log
@missed WRKDIST, from nigel@@
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.101 2016/10/11 19:19:45 sthen Exp $
d23 1
d127 1
a127 1
WANTLIB-sqlite3 += sqlite3 m stdc++
@


1.101
log
@Use a new distfile for bacula, upstream rerolled it to change some
printf formatting. Reported by naddy@@ nigel@@
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.100 2016/10/11 13:27:28 sthen Exp $
d15 1
@


1.100
log
@update to bacula-7.4.4
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.99 2016/09/23 09:16:57 sthen Exp $
d13 2
a14 1
V=			7.4.4
@


1.99
log
@Cope with moving sqlite3 back to ports.
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.98 2016/07/30 21:43:24 sthen Exp $
d13 1
a13 1
V=			7.4.3
a20 1
REVISION-sqlite3=	0
@


1.98
log
@update to bacula-7.4.3
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.97 2016/07/08 12:59:13 sthen Exp $
d21 1
a124 1
LIB_DEPENDS-sqlite3=	#empty
d126 1
@


1.97
log
@bugfix update to Bacula 7.4.2
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.96 2016/06/06 14:10:57 sthen Exp $
d13 1
a13 1
V=			7.4.2
@


1.96
log
@update to bacula-7.4.1
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.95 2016/03/18 21:38:25 naddy Exp $
d13 1
a13 1
V=			7.4.1
d35 1
a35 2
MASTER_SITES=		http://www.bacula.org/downloads/Bacula-$V/ \
			${MASTER_SITE_SOURCEFORGE:=bacula/}
@


1.95
log
@remove SHARED_ONLY from simple ports that use the gettext or libiconv module
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.94 2016/01/19 22:51:09 sthen Exp $
d13 1
a13 1
V=			7.4.0
@


1.94
log
@update to Bacula 7.4.0, "this version consists of more backports from
Bacula Enterprise 8.4 as well quite a few bug fixes (28) as a number of
new features".

Database schema has not changed and older FDs should remain compatible
with this version.

http://www.bacula.org/7.4.x-manuals/en/main/New_Features_in_7_4_0.html
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.93 2015/11/29 15:50:20 ajacoutot Exp $
a4 2

SHARED_ONLY=		Yes
@


1.93
log
@daemon_timeout is not passed to the child scripts either.
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.92 2015/10/17 10:30:16 ajacoutot Exp $
d15 1
a15 1
V=			7.2.0
a23 2
REVISION=		1

d26 3
a28 3
SHARED_LIBS +=  bac                  5.0
SHARED_LIBS +=  baccfg               5.0
SHARED_LIBS +=  bacfind              5.0
d37 2
a38 1
MASTER_SITES=		${MASTER_SITE_SOURCEFORGE:=bacula/}
@


1.92
log
@Drop myself from MAINTAINER and leave the baby to Stuart ;-)

ok sthen@@
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.91 2015/08/15 07:50:02 ajacoutot Exp $
d24 1
a24 1
REVISION=		0
@


1.91
log
@Update to bacula-client-7.2.0.
README parts from sthen@@

ok sthen@@
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.90 2015/07/15 15:53:48 sthen Exp $
d24 2
d42 1
a42 2
MAINTAINER=		Stuart Henderson <sthen@@openbsd.org> \
			Antoine Jacoutot <ajacoutot@@openbsd.org>
@


1.90
log
@Adjust pexp to cope with rc.subr(8) change.
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.89 2015/07/07 14:44:58 sthen Exp $
d15 1
a15 1
V=			7.0.5
a23 4
REVISION-main=		2
REVISION-server=	6
REVISION-mysql=		0

a164 2
# broken: tries to run scripts from /etc
	cd ${PREFIX}/libexec/bacula/updatedb && rm update_bdb_tables_8_to_9
@


1.89
log
@use su -m instead of -s /bin/sh, suggested by millert
add some missing -c
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.88 2015/07/06 11:25:36 sthen Exp $
d24 2
a25 2
REVISION-main=		1
REVISION-server=	5
@


1.88
log
@Remove use of sudo from pkg READMEs in a few ports as packages and their
instructions are meant to work on a fresh install.

- easy cases: replace some '$ sudo somecommand' with '# somecommand'
(while there I've swapped some "${RCDIR}/foo start" with "rcctl foo start").

- replace some 'sudo -u user somecommand foo bar' with
'su -s /bin/sh user "/path/to/somecommand foo bar"' and similar.
Not pretty with the -s, but many of the uids that need to run
these commands have /sbin/nologin as their usual shell.
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.87 2015/02/18 20:55:11 sthen Exp $
d25 1
a25 1
REVISION-server=	4
@


1.87
log
@Adjust the "meta" rc-scripts (these are used in ports with multiple daemons
which should all be started/stopped together), previously "restart" would
restart each sub-daemon in turn, but actually it should stop all daemons
and only then start them again. Additionally, as suggested by ajacoutot,
stop the procedure and return an error if stopping one of the rc scripts
failed.  ok ajacoutot@@ rpe@@

(as done for a couple of other ports; bacula was actually the one I wanted
to fix this on but missed the earlier commit ;)
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.86 2014/12/08 10:57:09 ajacoutot Exp $
d25 1
a25 1
REVISION-server=	3
@


1.86
log
@Make all meta rc.d scripts consistent.
While here, unbreak when options are passed (e.g. /etc/rc.d/foobar -df start)

ok sthen@@
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.85 2014/11/14 08:39:41 ajacoutot Exp $
d24 1
a24 1
REVISION-main=		0
@


1.85
log
@Last commit was not enough.
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.84 2014/11/14 08:26:50 jasper Exp $
d24 1
@


1.84
log
@fixup instructions to initialize the database tables

ok sthen@@ (MAINTAINER)
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.83 2014/11/04 16:46:03 ajacoutot Exp $
d24 1
a24 1
REVISION-server=	2
@


1.83
log
@Simplify.
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.82 2014/09/14 05:58:07 ajacoutot Exp $
d24 1
a24 1
REVISION-server=	1
@


1.82
log
@MySQL -> MariaDB in READMEs.
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.81 2014/09/13 18:09:22 brad Exp $
d24 1
a24 1
REVISION-server=	0
@


1.81
log
@Switch from using MySQL to using MariaDB attempt #2. MariaDB is a drop-in replacement.

ok sthen@@
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.80 2014/08/14 06:52:59 ajacoutot Exp $
d23 2
@


1.80
log
@Update to bacula-client-7.0.5.
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.79 2014/07/10 13:09:06 ajacoutot Exp $
d23 1
d126 1
a126 1
LIB_DEPENDS-mysql +=	databases/mysql
@


1.79
log
@rc.conf.local is in man(1) section 8, at least for now.
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.78 2014/06/23 07:57:48 ajacoutot Exp $
d15 1
a15 1
V=			7.0.4
a22 4

REVISION-server=	3
REVISION-main=		1
REVISION-bat=		1
@


1.78
log
@Completely rework the way this port is handled. Drop all FLAVORs and
move to MULTI_PACKAGEs (the no_bat PSEUDO_FLAVOR is still available).
This modifies the packages as:
bacula-client	- no change
bacula-server	- the server part, now unflavored and depends on a proper SQL package support
bacula-bat	- no change
bacula-mysql	- new, MySQL support for bacula-server
bacula-pgsql	- new, PostgreSQL support for bacula-server
bacula-sqlite3	- new, SQLite3 support for bacula-server

All SQL support packages conflict with each others.
For users of mysql and sqlite3, a manual step will be needed to properly
upgrade bacula-server; sthen@@ will take care of this in current.html.

Tested by myself and sthen@@
ok sthen@@
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.77 2014/06/13 15:31:21 ajacoutot Exp $
d24 1
a24 1
REVISION-server=	2
@


1.77
log
@Fix some default values.
@
text
@d1 4
a4 1
# $OpenBSD: Makefile,v 1.76 2014/06/13 13:34:38 ajacoutot Exp $
d11 3
d17 1
a17 2
FULLPKGNAME-main=	bacula-client-$V
FULLPKGPATH-main=	${PKGPATH},-main
d19 9
a27 2
FULLPKGNAME-bat=	bacula-bat-$V
FULLPKGPATH-bat=	${PKGPATH},-bat
a29 4
REVISION-server=	1
REVISION-main=		0
REVISION-bat=		0

d37 3
d63 2
a64 2
PSEUDO_FLAVORS=		no_bat no_server
FLAVORS=		pgsql mysql sqlite3
d66 1
a66 5
.if !defined(FLAVOR) || empty(FLAVOR)
FLAVOR =		pgsql
.endif

MULTI_PACKAGES=		-main -server -bat
d71 4
d93 6
d113 1
a113 1
CONFIGURE_ENV+=		ac_cv_func_${ac_func}=no
d116 3
a118 1
.include <bsd.port.arch.mk>
d120 1
a120 1
WANTLIB-server += ${WANTLIB} bac baccfg bacfind lzo2
d122 2
a123 1
			sysutils/bacula,-main
d125 2
a126 10
.if !${BUILD_PACKAGES:M-server}
CONFIGURE_ARGS+=	--enable-client-only \
			--disable-build-dird \
			--disable-build-stored
.else
SHARED_LIBS +=		baccats-${BACKEND} ${BACCATS_LIBV}
CONFIGURE_ARGS+=	--with-dir-user=_bacula \
			--with-dir-group=_bacula \
			--with-sd-user=_bacula-sd \
			--with-sd-group=_bacula
d128 2
a129 32
.  if ${FLAVOR:Mpgsql}
WANTLIB-server += pq>=2
CONFIGURE_ARGS+=	--with-postgresql
LIB_DEPENDS-server+=	databases/postgresql
BACKEND +=		postgresql
.  else
CONFIGURE_ARGS+=	--without-postgresql
.  endif

.  if ${FLAVOR:Mmysql}
WANTLIB-server += mysqlclient_r>=18
CONFIGURE_ARGS+=	--with-mysql \
			--enable-batch-insert
LIB_DEPENDS-server+=	databases/mysql
BACKEND+=		mysql
.  else
CONFIGURE_ARGS+=	--without-mysql
.  endif

.  if ${FLAVOR:Msqlite3}
WANTLIB-server += sqlite3>=8
CONFIGURE_ARGS+=	--with-sqlite3
BACKEND+=		sqlite3
.  else
CONFIGURE_ARGS+=	--without-sqlite3
.  endif

SUBST_VARS+=		BACKEND
.  if !defined(BACKEND) || (${BACKEND} != "mysql" && ${BACKEND} != "sqlite3" && ${BACKEND} != "postgresql")
ERRORS+=		"Fatal: choose one of pgsql or mysql or sqlite3"
.  endif
.endif # server
d131 2
a132 3
WANTLIB-main += ${WANTLIB} lzo2 ncurses readline
LIB_DEPENDS-main=	${LIB_DEPENDS} \
			archivers/lzo2
d144 1
d146 1
a146 1
CONFIGURE_ARGS+=	--disable-bat
d148 1
a148 1
CONFIGURE_ARGS+=	--enable-bat
a157 1
.if ${BUILD_PACKAGES:M-server}
d163 1
a163 3
	rm ${PREFIX}/lib/libbaccats.*
	cd ${PREFIX}/lib && \
		ln -sf libbaccats-${BACKEND}.so.${LIBbaccats_VERSION} libbaccats.so.${LIBbaccats_VERSION}
d166 9
a174 1
.endif
a183 1
	rm ${PREFIX}/sbin/bacula
@


1.76
log
@Fix path to doc.
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.75 2014/06/04 14:40:08 ajacoutot Exp $
d18 3
a20 1
REVISION-server=	0
d70 2
a71 1
			--with-archivedir=/tmp \
a73 3
			--without-smtp-host \
			--without-job-email \
			--without-dump-email \
d80 1
a80 1
			--with-hostname=bacula
@


1.75
log
@Update to bacula-client-7.0.4.
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.74 2014/05/21 10:12:34 ajacoutot Exp $
d17 2
@


1.74
log
@Update to bacula 7.0.3.

ok sthen@@
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.73 2014/04/21 22:12:07 ajacoutot Exp $
d9 1
a9 1
V=			7.0.3
@


1.73
log
@Sync wantlib after kerberos support got removed from postgresql.
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.72 2014/04/19 10:26:55 sthen Exp $
d9 1
a9 1
V=			7.0.2
a17 2
REVISION-server=	1

d154 1
@


1.72
log
@tweak sample bacula-sd.conf; fix a couple of changer device names
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.71 2014/04/19 09:44:11 ajacoutot Exp $
a9 1
REVISION-server=	0
d18 2
d117 1
a117 1
WANTLIB-server += pq>=2 asn1 com_err heimbase krb5 roken wind
@


1.71
log
@Major update to Bacula 7.0.2.
Some info at:
http://blog.bacula.org/p710/
http://blog.bacula.org/release-7-0-2/

Now builds with our libtool(1).

While there's a huge amount of changes, existing setups "should" just
work without any modification.

tested by sthen@@ and myself
ok sthen@@, my new co-maintainer :-)
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.70 2014/03/24 18:19:21 ajacoutot Exp $
d10 1
@


1.70
log
@Drop now unneeded CONFIGURE_ARGS.
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.69 2014/01/28 09:02:12 ajacoutot Exp $
d9 1
a9 1
V=			5.2.13
d18 4
a21 2
REVISION-main=		3
REVISION-server=	6
d23 1
a23 7
# XXX build fails if a previous version is installed
SHARED_LIBS +=  bac                  4.0
SHARED_LIBS +=  baccfg               4.0
SHARED_LIBS +=  bacpy                4.0
SHARED_LIBS +=  bacfind              4.0
SHARED_LIBS +=  bacsql               4.0
BACCATS_LIBV =	2.0
d29 2
a30 1
MAINTAINER=		Antoine Jacoutot <ajacoutot@@openbsd.org>
d36 1
a36 1
# http://bacula.org/en/dev-manual/main/main/Bacula_Copyright_Trademark_.html
d41 6
a46 9
BACULACONF=		/etc/bacula
BACULASTATE=		/var/bacula
SUBST_VARS=		BACULACONF BACULASTATE TRUEPREFIX

CONFIGURE_STYLE=	simple
USE_GMAKE=		yes
USE_GROFF=		yes
USE_LIBTOOL=		gnu# ports libtool passes libtool-only parameters to linker
NO_TEST=		yes
a57 3
			--prefix=${PREFIX} \
			--mandir=${PREFIX}/man \
			--infodir=${PREFIX}/info \
a59 1
			--sysconfdir=${BACULACONF} \
a60 1
			--localstatedir=${BACULASTATE} \
d64 2
a65 2
			--with-subsys-dir=${BACULASTATE} \
			--with-working-dir=${BACULASTATE} \
a71 3
			--disable-gnome \
			--disable-bwx-console \
			--disable-tray-monitor \
d99 1
a99 1
WANTLIB-server += ${WANTLIB} bac baccfg bacfind bacpy lzo2
d115 1
a115 1
WANTLIB-server += pq>=2
d194 1
a195 1
	rm ${PREFIX}/man/man1/bacula-{bwxconsole,tray-monitor}.1
@


1.69
log
@Revert previous; I am being morning-stupid, the client runs as root...
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.68 2014/01/28 08:50:58 ajacoutot Exp $
a79 1
			--without-tcp-wrappers \
@


1.68
log
@gecos: Bacula Director -> Bacula Daemon -- since this user is used on both
the director and the client.
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.67 2014/01/19 09:54:18 ajacoutot Exp $
d18 1
a18 1
REVISION-main=		2
@


1.67
log
@Set @@mode explicitely.
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.66 2013/06/12 20:36:34 brad Exp $
d18 1
a18 1
REVISION-main=		1
@


1.66
log
@Revert back to using MySQL 5.1 for the time being. MariaDB 5.5 introduces
a new libmysqlclient non-blocking API which utilizes co-routines. The X86
specific GCC ASM co-routine support hid the fact that there was an issue.
The only fallback code so far is POSIX user contexts which OpenBSD does not
support.

Input from and Ok sthen@@ jasper@@
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.65 2013/06/06 13:57:48 ajacoutot Exp $
a9 1
REVISION-main=		0
d18 1
@


1.65
log
@Revert the mysql->MariaDB blurb in the READMEs.
It seems the MariaDB move will be reverted.
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.64 2013/06/05 16:23:14 ajacoutot Exp $
d19 1
a19 1
REVISION-server=	5
d142 1
a142 1
LIB_DEPENDS-server+=	databases/mariadb
@


1.64
log
@"operator" can be used as well.
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.63 2013/06/05 16:12:05 ajacoutot Exp $
d19 1
a19 1
REVISION-server=	4
@


1.63
log
@Clearer.
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.62 2013/06/05 15:05:01 ajacoutot Exp $
d19 1
a19 1
REVISION-server=	3
@


1.62
log
@Fix up permissions for tape devices versus autochangers.
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.61 2013/06/05 14:30:23 ajacoutot Exp $
d19 1
a19 1
REVISION-server=	2
@


1.61
log
@mysql -> MariaDB
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.60 2013/05/25 00:33:10 brad Exp $
d19 1
a19 1
REVISION-server=	1
@


1.60
log
@Switch from using MySQL to using MariaDB. MariaDB is a drop-in replacement.


ok sthen aja
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.59 2013/05/03 18:40:32 sthen Exp $
d19 1
a19 1
REVISION-server=	0
@


1.59
log
@add a meta rc.d script for bacula, modelled after samba's, to start and
stop the various daemons together in order suggested by upstream's scripts.
ok ajacoutot@@
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.58 2013/04/12 10:39:04 ajacoutot Exp $
d19 2
d142 1
a142 1
LIB_DEPENDS-server+=	databases/mysql
@


1.58
log
@Update to bacula-5.2.13.

ok sthen@@
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.57 2013/03/21 15:04:18 ajacoutot Exp $
d10 1
@


1.57
log
@Take MAINTAINER.

suggested by and ok merdely@@ (current maintainer)
ok sthen@@
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.56 2013/03/11 11:41:29 espie Exp $
d9 1
a9 1
V=			5.2.12
a17 4
REVISION-server=	2
REVISION-main=		0
REVISION-bat=		0

d39 2
d112 2
a113 1
LIB_DEPENDS-server=	sysutils/bacula,-main
d160 2
a161 1
LIB_DEPENDS-main=	archivers/lzo2
d165 5
a169 3
WANTLIB-bat += baccfg bacfind expat fontconfig freetype xcb
RUN_DEPENDS-bat=	devel/desktop-file-utils
LIB_DEPENDS-bat=	x11/qt4 \
@


1.56
log
@PERMIT_* / REGRESS->TEST sweep
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.55 2013/03/02 13:54:52 ajacoutot Exp $
d18 3
a20 1
REVISION-server=	1
d34 1
a34 1
MAINTAINER=		Michael Erdely <merdely@@openbsd.org>
@


1.55
log
@Implement "listall" for the autochanger chio(1) script; has been committed
upstream already.

ok sthen@@ merdely@@ (maintainer)
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.54 2013/01/15 12:46:52 ajacoutot Exp $
a39 3
PERMIT_PACKAGE_FTP=	Yes
PERMIT_DISTFILES_CDROM=	Yes
PERMIT_DISTFILES_FTP=	Yes
d49 1
a49 1
NO_REGRESS=		yes
@


1.54
log
@Document device permissions.

ok sthen@@
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.53 2013/01/11 22:15:31 sthen Exp $
d18 1
a18 1
REVISION-server=	0
@


1.53
log
@update to Bacula 5.2.12, ok aja@@ merdely@@
- minor bugfix (and rolling in a more important fix we already had in patches)
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.52 2012/11/09 16:39:51 sthen Exp $
d17 2
@


1.52
log
@trailing space in USE_LIBTOOL
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.51 2012/10/01 10:34:54 ajacoutot Exp $
d9 1
a9 1
V=			5.2.11
a16 2

REVISION-server=	0
@


1.51
log
@Fix the autochanger script to work when a device has several empty slots.
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.50 2012/09/14 08:14:30 ajacoutot Exp $
d51 1
a51 1
USE_LIBTOOL=		gnu # ports libtool passes libtool-only parameters to linker
@


1.50
log
@Update to bacula-5.2.11.

ok sthen@@
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.49 2012/08/04 15:17:06 ajacoutot Exp $
d17 2
@


1.49
log
@No need to add FULLPKGNAME-main to SUBST_VARS now that the infrastructure
does the right thing; thanks espie@@ !
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.48 2012/07/17 09:31:21 sthen Exp $
d9 1
a9 2
V=			5.2.10
REVISION-main=		1
d185 1
a185 1
	${SUBST_CMD} -o ${BINOWN} -g ${BINGRP} -c ${FILESDIR}/chio-changer-openbsd \
@


1.48
log
@Fix README-main, pointed out by "Jiri B" on ports@@.  ok merdely aja
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.47 2012/07/09 18:40:58 sthen Exp $
d10 1
a10 1
REVISION-main=		0
d45 1
a45 1
SUBST_VARS=		BACULACONF BACULASTATE TRUEPREFIX FULLPKGNAME-main
@


1.48.2.1
log
@MFC bacula update (security fix CVE-2012-4430); ok ajacoutot@@

This is a problem with console ACLs which was allowing access to certain
functionality and e.g. dump resources which should have been restricted.
Problem only affects people who have configured console ACLs.
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.50 2012/09/14 08:14:30 ajacoutot Exp $
d9 2
a10 1
V=			5.2.11
d45 1
a45 1
SUBST_VARS=		BACULACONF BACULASTATE TRUEPREFIX
d186 1
a186 1
	${INSTALL_SCRIPT} ${WRKSRC}/examples/autochangers/chio-changer-openbsd \
@


1.47
log
@update to Bacula 5.2.10, ok aja@@ merdely@@
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.46 2012/07/04 12:02:56 ajacoutot Exp $
d10 1
d45 1
a45 1
SUBST_VARS=		BACULACONF BACULASTATE TRUEPREFIX
@


1.46
log
@Rename our autochanger to chio-autochanger-openbsd and fix a couple of
bugs in it. All functions successfully tested (only listall is not
implemented yet).
While here, set the default tape device to /dev/nrst0.

ok sthen@@
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.45 2012/06/28 19:24:56 ajacoutot Exp $
d9 1
a9 1
V=			5.2.6
a17 4
REVISION-main=		4
REVISION-server=	6
REVISION-bat=		4

d19 6
a24 6
SHARED_LIBS +=  bac                  3.0
SHARED_LIBS +=  baccfg               3.0
SHARED_LIBS +=  bacpy                3.0
SHARED_LIBS +=  bacfind              3.0
SHARED_LIBS +=  bacsql               3.0
BACCATS_LIBV =	1.0
@


1.45
log
@Add a chio-changer script in replacement for the mtx-changer script.
Adapted from NetBSD pkgsrc and FreeBSD ports.
@@sample the script so that people can apply local modifications if
needed.

Tested on an LTO-4, 8 slots.

Why do all chio(1) behave differently!!!???

ok sthen@@ merdely@@ (maintainer)
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.43 2012/04/23 17:15:19 espie Exp $
d18 3
a20 3
REVISION-main=		3
REVISION-server=	5
REVISION-bat=		3
d189 2
a190 2
	${SUBST_CMD} -o ${BINOWN} -g ${BINGRP} -c ${FILESDIR}/chio-changer \
		${PREFIX}/libexec/bacula/chio-changer.dist
@


1.44
log
@Rework the PgSQL part of the documentation in order to setup proper
permissions of the database while creating it.

ok ajacoutot@@, sthen@@, merdely@@
@
text
@a9 2
REVISION=		3
REVISION-server=	4
d18 4
d189 2
@


1.43
log
@first pass at handling sqlite3 move
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.42 2012/04/04 21:30:56 merdely Exp $
d11 1
@


1.42
log
@Move some files from PLIST to PLIST-server so that `FLAVOR=no_server make`
works again.
Conflict with older versions of the client.
Make mtx-changer.conf @@sample-able so we don't overwrite on update.

ok & help from sthen and aja
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.41 2012/04/03 10:05:47 sthen Exp $
d10 1
a10 1
REVISION=		2
a148 1
LIB_DEPENDS-server+=	databases/sqlite3
@


1.41
log
@Adjust new user creation in Bacula which had some duplication between
packages which depend on each other:

- only create the _bacula user in -main (client parts)
- only create the _bacula-sd user in -server

Change _bacula's home dir from /var/bacula to /nonexistent.
/var/bacula needs to be writable by the _bacula group and since
/usr/libexec/security actually checks that user home dirs are
group-writable, whereas /etc/security just checked if the user
home dir was a writable *file*(!), it whines every day for
every machine with bacula client installed. (This will only
affect new installations so if you're annoyed by these mails
too, just vipw and change it by hand).

ok ajacoutot@@ merdely@@
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.40 2012/03/08 17:34:34 sthen Exp $
d10 1
a10 1
REVISION=		1
d191 2
a205 1
	mv ${PREFIX}/libexec/bacula/query.sql{,.dist}
@


1.40
log
@fix builds on a system which doesn't have already-existing _bacula users/groups.
spotted by naddy@@, ok merdely@@ aja@@
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.39 2012/03/06 20:11:33 sthen Exp $
d10 1
a10 1
REVISION=		0
d131 1
a131 1
BACKEND += 		postgresql
d190 1
a190 1
		ln -sf libbaccats-${BACKEND}.so.${LIBbaccats_VERSION} libbaccats.so.${LIBbaccats_VERSION} 
@


1.39
log
@update to Bacula 5.2.6, ok ajacoutot@@ merdely@@
- don't use ports libtool, it passes invalid flags to the linker
- since libbaccats-${BACKEND} must have the same .so version as
libbaccats, use a variable to make sure they are kept in-sync
- mark as being SHARED_ONLY and sync/merge plists
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.38 2011/12/12 09:15:09 sthen Exp $
d10 1
@


1.38
log
@update Bacula to 5.2.2 (mostly bugfixes)

- Switch default flavour used by the port to pgsql; this is generally the
best-tested backend and gets the most testing. Setup isn't really
much more complicated than the old default in the port (sqlite) and
you don't really want to run into limitations and have to convert
it later. Doesn't affect packages as all flavours are built anyway.

ok ajacoutot@@ merdely@@ (maintainer)
@
text
@d1 3
a3 1
# $OpenBSD: Makefile,v 1.37 2011/11/27 17:02:25 ajacoutot Exp $
d9 1
a9 1
V=			5.2.2
d18 8
a25 6
SHARED_LIBS +=  bac                  2.0      # 5.2.1
SHARED_LIBS +=  baccfg               2.0      # 5.2.1
SHARED_LIBS +=  bacpy                2.0      # 5.2.1
SHARED_LIBS +=  bacfind              2.0      # 5.2.1
SHARED_LIBS +=  bacsql               2.0      # 5.2.1
SHARED_LIBS +=  baccats              0.0      # 5.2.1
d49 1
a49 1
USE_LIBTOOL=		yes
d120 1
a120 1
SHARED_LIBS +=		baccats-${BACKEND} 0.0 # sync with LIBbaccats_VERSION
d127 1
a127 1
WANTLIB-server += pq>=2 com_err
d203 1
@


1.37
log
@Remove uneeded patch for alpha; tested by naddy@@
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.36 2011/11/25 11:00:27 ajacoutot Exp $
d7 1
a7 1
V=			5.2.1
a15 4
REVISION-main=		2
REVISION-server=	2
REVISION-bat=		2

d52 1
a52 1
FLAVOR =		sqlite3
@


1.36
log
@Unfuck post-install target and use our libtool.
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.35 2011/11/24 09:57:38 ajacoutot Exp $
d16 3
a18 3
REVISION-main=		1
REVISION-server=	1
REVISION-bat=		1
@


1.35
log
@tyop, spotted by jasper@@
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.34 2011/11/24 09:29:55 ajacoutot Exp $
d16 3
a18 3
REVISION-main=		0
REVISION-server=	0
REVISION-bat=		0
d49 1
a51 4
# XXX gnu is needed to be able to build several -server FLAVORS
# while bacula-client is already installed
USE_LIBTOOL=		gnu

d127 1
a127 1
WANTLIB-server += pq>=2
a182 2
	${INSTALL_DATA} ${WRKINST}/etc/bacula/bacula-fd.conf \
		${PREFIX}/share/examples/bacula/
a191 5
	if [ -f ${PREFIX}/lib/libbac.so.${LIBbac_VERSION} ] ; then \
		${INSTALL_PROGRAM} ${WRKSRC}/src/qt-console/.libs/bat ${PREFIX}/sbin/; \
	else \
		${INSTALL_PROGRAM} ${WRKSRC}/src/qt-console/bat ${PREFIX}/sbin/; \
	fi
@


1.34
log
@Reorder LDFLAGS (prefer -L.libs over /usr/local/lib) so that bacula can
be rebuilt while already installed.
Also use gnu LIBTOOL, ours doesn't work correctly.
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.33 2011/11/17 23:45:56 ajacoutot Exp $
d53 1
a53 1
USE_LIBTOOL=		yes
@


1.33
log
@Major update to bacula 5.2.1.

As usual with major version bump, do not forget to run the upgrade
script corresponding to your DB.
A new README is provided in the package.

Tested by sthen@@ and myself.
"Don't wait on me" merdely@@ (maintainer)

ok sthen@@
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.32 2011/10/21 17:04:23 espie Exp $
d16 4
a47 1
USE_LIBTOOL=		yes
d51 4
d130 1
a130 1
WANTLIB-server += pq>=2 com_err
@


1.32
log
@use bsd.port.arch.mk to handle pseudo-flavors
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.31 2011/09/20 08:01:20 landry Exp $
d7 1
a7 1
V=			5.0.2
d16 6
a21 9
REVISION-main=		3
REVISION-server=	3
REVISION-bat=		1

SHARED_LIBS +=		bac		1.0 # .1.0
SHARED_LIBS +=		baccfg		1.0 # .1.0
SHARED_LIBS +=		bacpy		1.0 # .1.0
SHARED_LIBS +=		bacfind		1.0 # .1.0
SHARED_LIBS +=		bacsql		1.0 # .1.0
d28 1
a28 1
WANTLIB=		c pthread crypto ssl z m stdc++
d30 1
a30 1
# GPLv2 with exception for OpenSSL (majority),
d32 1
a32 1
# http://bacula.org/en/dev-manual/Bacula_Copyri_Tradem_Licens.html
a37 1
SD_USER=		_bacula-sd
d40 1
a40 1
SUBST_VARS=		SD_USER BACULACONF BACULASTATE TRUEPREFIX
d45 1
a45 1
USE_GROFF =		Yes
d66 2
a77 1
			--without-qwt \
d84 1
d90 2
a91 2
CONFIGURE_ENV+=		CPPFLAGS="-I/usr/include/readline \
			-I${LOCALBASE}/include" \
d93 1
a93 2
			PTHREAD_CFLAGS="${PTHREAD_CFLAGS}" \
			PTHREAD_LIBS="${PTHREAD_LIBS}" \
d95 2
a96 5
			TAPEDRIVE=/dev/rst0 \
			CONFIG_SITE=${PORTSDIR}/infrastructure/db/config.site \
			QMAKEBIN4=qmake4 \
			QMAKE=${LOCALBASE}/bin/${QMAKEBIN4} \
			PKG_CONFIG_LIBDIR="${LOCALBASE}/lib/qt4/pkgconfig:${LOCALBASE}/lib/qt4"
d108 1
a108 1
WANTLIB-server=		${WANTLIB} bac baccfg bacfind bacpy readline termcap
d116 1
d119 1
a119 1
			--with-sd-user=${SD_USER} \
d123 1
a124 1
WANTLIB-server+=	pq>=2
d132 1
a134 1
WANTLIB-server+=	mysqlclient_r>=18
d142 1
a143 1
WANTLIB-server+=	sqlite3>=8
d156 2
a157 1
LIB_DEPENDS-main=
d159 3
a161 1
WANTLIB-bat +=		QtCore QtGui bac baccfg c crypto m pthread ssl stdc++
a181 4
	${INSTALL_DATA} ${WRKINST}/etc/bacula/bacula-dir.conf \
		${WRKINST}/etc/bacula/bacula-sd.conf \
		${WRKINST}/etc/bacula/bconsole.conf \
		${PREFIX}/share/examples/bacula/
d184 4
a194 2
	${INSTALL_DATA} ${WRKINST}/etc/bacula/bat.conf \
		${PREFIX}/share/examples/bacula/
d200 2
d203 3
@


1.31
log
@Apply the same fix as net/zabbix after pkgpath normalization. Ensure FLAVOR
is set to something in the case another ports (webacula in that case) asks
bacula for its pkgpath. Hints from espie@@
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.30 2011/09/16 11:41:39 espie Exp $
a32 2
MULTI_PACKAGES=		-main

d54 2
a55 2
FLAVOR?=		sqlite3
.if empty(FLAVOR)
d59 2
d112 6
a117 1
.if ${FLAVOR:L:Mno_server}
a121 3
MULTI_PACKAGES+=	-server
WANTLIB-server=		${WANTLIB} bac baccfg bacfind bacpy readline termcap
LIB_DEPENDS-server=	sysutils/bacula,-main
d127 1
a127 5
BACKEND=
.if ${FLAVOR:L:Mpgsql}
.if !empty(BACKEND)
ERRORS+=		"Fatal: choose either pgsql or mysql or sqlite3"
.endif
d131 2
a132 2
BACKEND=		postgresql
.else
d134 1
a134 1
.endif
d136 1
a136 4
.if ${FLAVOR:L:Mmysql}
.if !empty(BACKEND)
ERRORS+=		"Fatal: choose either pgsql or mysql or sqlite3"
.endif
d141 2
a142 2
BACKEND=		mysql
.else
d144 1
a144 1
.endif
d146 1
a146 4
.if ${FLAVOR:L:Msqlite3}
.if !empty(BACKEND)
ERRORS+=		"Fatal: choose either pgsql or mysql or sqlite3"
.endif
d150 2
a151 2
BACKEND=		sqlite3
.else
d153 1
a153 1
.endif
d156 4
a159 4
.if empty(BACKEND)
ERRORS+=		"Fatal: choose either pgsql or mysql or sqlite3"
.endif
.endif # if no_server
a162 4
.if ${FLAVOR:L:Mno_bat}
CONFIGURE_ARGS+=	--disable-bat
.else
CONFIGURE_ARGS+=	--enable-bat
a163 1
MULTI_PACKAGES+=	-bat
d167 5
d183 1
a183 1
.if !${FLAVOR:L:Mno_server}
d191 1
a191 1
.if !${FLAVOR:L:Mno_bat}
@


1.30
log
@normalize pkgpath
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.29 2011/07/14 15:02:18 naddy Exp $
d57 3
@


1.29
log
@configure mistakenly assumes xattr support if it finds any of the
openat() family of functions, so poison the autoconf cache.
None of these functions are used outside the code for Solaris xattr.
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.28 2011/03/21 17:06:23 ajacoutot Exp $
d16 3
a18 3
REVISION-main=		2
REVISION-server=	2
REVISION-bat=		0
@


1.28
log
@Add rc scripts and adapt documentation accordingly.

maintainer timeout
ok sthen@@
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.27 2010/11/20 17:22:40 espie Exp $
d100 8
@


1.27
log
@new depends
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.26 2010/10/19 07:43:00 espie Exp $
d16 2
a17 2
REVISION-main=		1
REVISION-server=	1
a170 3
post-extract:
	@@cp ${FILESDIR}/README-*.OpenBSD ${WRKSRC}/

d174 1
a174 2
		${WRKSRC}/scripts/bat.desktop.in \
		${WRKSRC}/README-client.OpenBSD ${WRKSRC}/README-server.OpenBSD
a179 3
	${INSTALL_DATA_DIR} ${PREFIX}/share/doc/bacula
	${INSTALL_DATA} ${WRKSRC}/README-client.OpenBSD \
			${PREFIX}/share/doc/bacula/
a184 3
	${INSTALL_DATA} ${WRKSRC}/README-server.OpenBSD \
			${PREFIX}/share/doc/bacula/
	chown -R ${SHAREOWN}:${SHAREGRP} ${PREFIX}/share/doc/bacula
@


1.26
log
@USE_GROFF=Yes
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.25 2010/10/12 19:47:06 robert Exp $
d51 1
a51 1
USE_GROFF =	Yes
d108 1
a108 1
LIB_DEPENDS-server=	::sysutils/bacula,-main
d120 2
a121 2
WANTLIB-server+=	pq.>=2
LIB_DEPENDS-server+=	:postgresql-client-*:databases/postgresql
d133 2
a134 2
WANTLIB-server+=	mysqlclient_r.>=18
LIB_DEPENDS-server+=	::databases/mysql
d145 2
a146 2
WANTLIB-server+=	sqlite3.>=8
LIB_DEPENDS-server+=	::databases/sqlite3
d166 3
a168 3
RUN_DEPENDS-bat=	::devel/desktop-file-utils
LIB_DEPENDS-bat=	::x11/qt4 \
			::sysutils/bacula,-main
@


1.25
log
@Check for EVP_PKEY_encrypt_old in by linking toe automagic test program
to -lcrypto and -lss. This fixes bacula "autodetecting" the OpenSSL version.

bump pkgnames
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.24 2010/09/24 21:10:16 steven Exp $
d51 1
@


1.24
log
@no longer requires gnu libtool
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.22 2010/08/05 13:32:27 merdely Exp $
d16 3
a18 2
REVISION-main=		0
REVISION-server=	0
@


1.23
log
@Use gnu libtool, the infamous '.libs/bat vs bat' issue is back when
using ports libtool. To be revisited.
@
text
@d49 1
a49 2
# XXX .libs/bat vs bat issue on nfs ?
USE_LIBTOOL=		gnu
@


1.22
log
@Fix links to documentation in MESSAGE-{main,server}.

From Jiri B.
ok sthen@@
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.21 2010/07/20 14:38:39 merdely Exp $
d49 2
a50 1
USE_LIBTOOL=		yes
@


1.21
log
@Update bacula to 5.0.2.

Fixes the weird install issues with the bat binary

New features can be found here:
http://www.bacula.org/5.0.x-manuals/en/main/main/New_Features_in_5_0_0.html

Thanks to sthen for help with the new wantlib/lib_depends stuff,
removing the sqlite flavor, ...

Thanks to giovanni for pointing out a ${TRUEPREFIX} -> /usr/local that
crept into one of my patch files.

ok sthen@@
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.20 2010/03/28 16:05:25 ajacoutot Exp $
d15 3
@


1.20
log
@s/LOCALBASE/TRUEPREFIX/

ok merdely@@ (maintainer)
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.19 2010/01/19 14:50:51 sthen Exp $
d7 1
a7 1
V=			3.0.3
d9 1
a9 1
FULLPKGNAME-main=	bacula-client-$Vp0
d12 1
a12 1
FULLPKGNAME-bat=	bacula-bat-$Vp1
d16 5
a20 5
SHARED_LIBS +=		bac		0.0 # .1.0
SHARED_LIBS +=		baccfg		0.0 # .1.0
SHARED_LIBS +=		bacpy		0.0 # .1.0
SHARED_LIBS +=		bacfind		0.0 # .1.0
SHARED_LIBS +=		bacsql		0.0 # .1.0
d50 1
a50 1
FLAVORS=		pgsql mysql sqlite3 sqlite
d92 2
a93 1
			QMAKEQT4=${LOCALBASE}/bin/qmake4 \
d102 2
a103 2
WANTLIB-server=		${WANTLIB} readline termcap
LIB_DEPENDS-server=	bac,baccfg,bacfind,bacpy::sysutils/bacula,-main
d112 1
a112 1
ERRORS+=		"Fatal: choose either pgsql or mysql or sqlite or sqlite3"
d115 2
a116 1
LIB_DEPENDS-server+=	pq.>=2:postgresql-client-*:databases/postgresql
d124 1
a124 1
ERRORS+=		"Fatal: choose either pgsql or mysql or sqlite or sqlite3"
d128 2
a129 1
LIB_DEPENDS-server+=	mysqlclient_r.>=18::databases/mysql
d137 1
a137 1
ERRORS+=		"Fatal: choose either pgsql or mysql or sqlite or sqlite3"
d140 2
a141 1
LIB_DEPENDS-server+=	sqlite3.>=8::databases/sqlite3
a146 10
.if ${FLAVOR:L:Msqlite}
.if !empty(BACKEND)
ERRORS+=		"Fatal: choose either pgsql or mysql or sqlite or sqlite3"
.endif
CONFIGURE_ARGS+=	--with-sqlite
LIB_DEPENDS-server+=	sqlite::databases/sqlite
BACKEND=		sqlite
.else
CONFIGURE_ARGS+=	--without-sqlite
.endif
a147 1

d149 1
a149 1
ERRORS+=		"Fatal: choose either pgsql or mysql or sqlite or sqlite3"
d159 1
a159 3
WANTLIB-bat=		${WANTLIB} ICE SM X11 Xau Xdmcp Xext Xi Xinerama \
			Xrender expat fontconfig freetype gobject-2.0 glib-2.0 \
			gthread-2.0 iconv intl pcre png pthread-stubs xcb
d162 2
a163 2
LIB_DEPENDS-bat=	QtCore,QtGui::x11/qt4 \
			bac,baccfg::sysutils/bacula,-main
d194 5
a198 1
	${INSTALL_PROGRAM} ${WRKSRC}/src/qt-console/.libs/bat ${PREFIX}/sbin/
@


1.19
log
@Move %%SHARED%% up in the plist; it was in an @@group _bacula @@mode 640
section so the libraries weren't accessible by a normal user. These libs
were split off from the individual binaries in the last major update of
bacula (between openbsd 4.6 and 4.7) meaning that users not in group
_bacula would be unable to use the admin applications.

ok jasper@@ merdely@@
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.18 2009/12/22 12:51:52 sthen Exp $
d12 1
a12 1
FULLPKGNAME-bat=	bacula-bat-$Vp0
@


1.18
log
@Use @@unexec-delete instead of @@unexec for the *-update-* goos.
prodded by espie@@
discussed with espie@@ ajacoutot@@ landry@@
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.17 2009/11/08 01:26:08 merdely Exp $
d9 1
a9 1
FULLPKGNAME-main=	bacula-client-$V
@


1.17
log
@Update to 3.0.3.  Add a patch to fix build on alpha.

ok sthen@@
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.16 2009/10/02 02:34:05 merdely Exp $
d12 1
a12 1
FULLPKGNAME-bat=	bacula-bat-$V
@


1.16
log
@Update bacula to 3.0.2:
	* Shared objects
	* Virtual backups
	* Duplicate Job Control
	* TLS Authentication
	* Exclude Dir Containing = <filename-string>
	* Plugins including Exchange 2003/2007 Plugin
	* libdbi backend abstraction
	* Bat enhancements

Upgrading from 2.4.4 to 3.0.2 requires updating the database using
/usr/local/libexec/bacula/update_bacula_database.  Database upgrades
from older databases can be done with other scripts in
/usr/local/libexec/bacula/updatedb.  You can determine your database
version in mysql and postgresql with 'select * from version'.

As sthen@@ reminded me and the documentation points out, when upgrading
between major versions (2.x.x -> 3.x.x), you should upgrade all of your
components at the same time due to protocol changes.

a *lot* of help from and ok sthen@@
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.15 2009/08/10 06:34:29 kili Exp $
d7 1
a7 1
V=			3.0.2
@


1.15
log
@WANTLIB changes after xcb addition and bump.
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.14 2009/06/19 11:13:39 sthen Exp $
d7 1
a7 1
V=			2.4.4
d12 1
a12 1
FULLPKGNAME-bat=	bacula-bat-$Vp1
d16 6
d31 2
a32 1
# GPL (majority), LGPL (some libraries) and PD
d46 1
d57 2
d79 3
a81 1
			--with-openssl
d83 1
d96 3
a98 1
CONFIGURE_ARGS+=	--enable-client-only
d102 1
d113 2
a114 5
CONFIGURE_ARGS+=	--with-postgresql \
			--without-mysql \
			--without-sqlite \
			--without-sqlite3
LIB_DEPENDS+=		pq.>=2:postgresql-client-*:databases/postgresql
d124 1
a124 4
CONFIGURE_ARGS+=	--without-postgresql \
			--with-mysql \
			--without-sqlite \
			--without-sqlite3 \
d126 1
a126 1
LIB_DEPENDS+=		mysqlclient_r.>=18::databases/mysql
d136 2
a137 5
CONFIGURE_ARGS+=	--without-postgresql \
			--without-mysql \
			--without-sqlite \
			--with-sqlite3
LIB_DEPENDS+=		sqlite3.>=8::databases/sqlite3
d147 2
a148 5
CONFIGURE_ARGS+=	--without-postgresql \
			--without-mysql \
			--with-sqlite \
			--without-sqlite3
LIB_DEPENDS+=		sqlite::databases/sqlite
d166 3
a168 4
WANTLIB-bat=		${WANTLIB} ICE SM X11 Xext
WANTLIB-bat+=		Xi Xinerama Xrender expat fontconfig freetype
WANTLIB-bat+=		glib-2.0 gobject-2.0 gthread-2.0 iconv intl png
WANTLIB-bat+=		pthread-stubs xcb
d170 3
a172 1
LIB_DEPENDS-bat=	QtCore,QtGui::x11/qt4
d181 1
d198 3
d203 1
a203 1
	${INSTALL_PROGRAM} ${WRKSRC}/src/qt-console/bat ${PREFIX}/sbin/
d206 5
@


1.14
log
@fix -bat WANTLIB, bump -bat
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.13 2009/01/12 21:17:07 sthen Exp $
d12 1
a12 1
FULLPKGNAME-bat=	bacula-bat-$Vp0
d165 1
@


1.13
log
@"important bug fix" update to 2.4.4
ok merdely@@ (maintainer).
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.12 2008/11/04 21:32:44 sthen Exp $
d12 1
a12 1
FULLPKGNAME-bat=	bacula-bat-$V
d163 2
a164 2
WANTLIB-bat+=		Xi Xinerama Xrandr Xrender fontconfig freetype
WANTLIB-bat+=		glib-2.0 gthread-2.0 iconv intl png
@


1.12
log
@apply dist patch from upstream; 'We recently found and corrected a
serious bug in Bacula that causes jobs to be orphaned or "stuck" in
the director during the pruning process'. Bacula users are advised
to upgrade their directors.

ok merdely
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.11 2008/10/19 03:44:42 merdely Exp $
d7 1
a7 1
V=			2.4.3
d11 1
a11 1
PKGNAME-server=		bacula-server-$Vp0
a15 2
PATCHFILES=		2.4.3-orphaned-jobs.patch

d162 1
a162 1
WANTLIB-bat=		${WANTLIB} ICE SM X11 Xcursor Xext Xfixes
@


1.11
log
@Update to bacula 2.4.3.
Add no_server PSEUDO_FLAVOR
Reorganize the Makefile some.
Remove dependency on qwt.
Set FULLPKGPATH for -main and -bat to remove backend dependencies
   (found by and solution from naddy@@)
Use SUBST_CMD.

ok jdixon@@, okan@@
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.10 2008/02/16 21:22:41 merdely Exp $
d11 1
a11 1
PKGNAME-server=		bacula-server-$V
d15 2
@


1.10
log
@Fix _bacula-sd uid.  Bump package names.

Pointed out by sthen@@
"reads fine" jasper@@
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.9 2008/02/07 02:53:35 merdely Exp $
d5 1
d7 1
a7 1
V=			2.2.8
d9 5
a13 2
FULLPKGNAME-main=	bacula-client-$Vp0
PKGNAME-server=		bacula-server-$Vp0
a21 1
WANTLIB-server=		${WANTLIB} readline termcap
d23 1
a23 1
MULTI_PACKAGES=		-main -server
d35 1
a35 1
SUBST_VARS=		SD_USER BACULACONF BACULASTATE
d41 1
d55 1
a55 4
			--with-dir-user=_bacula \
			--with-dir-group=_bacula \
			--with-sd-user=${SD_USER} \
			--with-sd-group=_bacula \
d62 1
d82 10
d116 1
a116 1
LIB_DEPENDS+=		lib/mysql/mysqlclient.>=10::databases/mysql
d154 1
a157 1
PSEUDO_FLAVORS+=	no_bat
d159 1
a159 2
CONFIGURE_ARGS+=	--disable-bat \
			--without-qwt
d161 4
a164 6
CONFIGURE_ARGS+=	--enable-bat \
			--with-qwt=${LOCALBASE}
FULLPKGNAME-bat=	bacula-bat-$Vp0
WANTLIB-bat=		${WANTLIB} ICE QtCore QtGui SM X11 Xcursor Xext Xfixes
WANTLIB-bat+=		Xi Xinerama Xrandr Xrender fontconfig freetype glib-2.0
WANTLIB-bat+=		gthread-2.0 iconv intl png
d166 1
a166 2
LIB_DEPENDS-bat=	qwt.>=5::x11/qwt
COMMENT-bat=		network backup solution (gui-client)
d169 3
d173 3
a175 2
	perl -pi -e "s%!!BACULACONF!!%${BACULACONF}%" \
		${WRKSRC}/manpages/bat.1 ${WRKSRC}/src/qt-console/main.cpp
d179 6
a185 1
		${WRKINST}/etc/bacula/bacula-fd.conf \
d189 3
a191 7
	${INSTALL_DATA_DIR} ${PREFIX}/share/doc/bacula
	perl -pe "s%!!TRUEPREFIX!!%${TRUEPREFIX}%g,s%!!BACULACONF!!%${BACULACONF}%g" \
		${FILESDIR}/README-client.OpenBSD > \
		${PREFIX}/share/doc/bacula/README-client.OpenBSD
	perl -pe "s%!!TRUEPREFIX!!%${TRUEPREFIX}%g,s%!!BACULACONF!!%${BACULACONF}%g,s%!!SD_USER!!%${SD_USER}%g" \
		${FILESDIR}/README-server.OpenBSD > \
		${PREFIX}/share/doc/bacula/README-server.OpenBSD
@


1.9
log
@Update bacula to 2.2.8.

Bacula changelog:
http://bacula.svn.sourceforge.net/viewvc/bacula/branches/Branch-2.2/bacula/ChangeLog?revision=6309&view=markup

Major port change in this version:
-main subpackage is now bacula-client
-server subpackage remains bacula-server
-bat subpackage is new bacula admin tool
-client subpackage goes away.

If the old -main subpackage was installed, the upgrade path is to
install both bacula-client and bacula-server.

Lots of input and assistance from sthen and okan.
ok okan;  "if it works for you, go for it" sthen
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.5 2007/09/05 07:57:33 merdely Exp $
d8 2
a9 2
FULLPKGNAME-main=	bacula-client-$V
PKGNAME-server=		bacula-server-$V
d152 1
a152 1
FULLPKGNAME-bat=	bacula-bat-$V
@


1.8
log
@Set the default FileSet in bacula-dir.conf to something that exists (/).
Found by Jacob Yocom-Piatt
"looks ok" steven@@
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.7 2007/09/14 14:58:58 merdely Exp $
d3 1
a3 2
COMMENT-main=		network backup solution
COMMENT-client=		network backup solution (client)
d6 4
a9 5
VERSION=		2.0.3
DISTNAME=		bacula-${VERSION}
PKGNAME-main=		${DISTNAME}p3
FULLPKGNAME-client=	bacula-client-${VERSION}p3
PKGNAME-server=		bacula-server-${VERSION}p4
a10 3
DIST_SUBDIR=		bacula
PATCHFILES=		${VERSION}-restore.patch
PATCH_DIST_ARGS=	-d ${WRKSRC}/src/stored --quiet
a12 1

a18 1
WANTLIB-main=		${WANTLIB} readline termcap
d20 1
a20 1
MULTI_PACKAGES=		-main -client -server
d22 2
a23 2
# Modified GPLv2
# http://bacula.org/dev-manual/Bacula_Copyri_Tradem_Licens.html
d29 1
d32 1
a32 1
SUBST_VARS=		BACULACONF BACULASTATE
d53 2
a54 2
			--with-sd-user=root \
			--with-sd-group=wheel \
d62 1
a62 1
			--disable-wx-console \
d76 3
a78 1
			CONFIG_SITE=${PORTSDIR}/infrastructure/db/config.site
d102 2
a103 1
			--without-sqlite3
d143 21
a163 1
LIB_DEPENDS-client=
d172 12
@


1.7
log
@Added vendor supplied PATCHFILE to fix restore bug #935
(http://marc.info/?l=bacula-announce&m=118937444909561&w=2)
This only affects bacula-sd.

tweaks and ok sthen@@, ok steven@@
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.6 2007/09/11 20:26:45 merdely Exp $
d9 1
a9 1
PKGNAME-main=		${DISTNAME}p2
d11 1
a11 1
PKGNAME-server=		bacula-server-${VERSION}p3
@


1.6
log
@Fix permissions on scripts/binaries from 754 to 755.
Bump package names.

ok steven@@
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.5 2007/09/05 07:57:33 merdely Exp $
d9 1
a9 1
PKGNAME-main=		${DISTNAME}p1
d11 1
a11 1
PKGNAME-server=		bacula-server-${VERSION}p2
d13 3
@


1.5
log
@Fix client to create /var/bacula directory.  Prompted by robert@@

ok robert@@, simon@@
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.4 2007/09/01 19:19:41 merdely Exp $
d9 3
a11 3
PKGNAME-main=		${DISTNAME}p0
FULLPKGNAME-client=	bacula-client-${VERSION}p2
PKGNAME-server=		bacula-server-${VERSION}p1
d58 1
@


1.4
log
@Update my email address.
ok simon@@
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.3 2007/08/28 17:51:08 espie Exp $
d10 1
a10 1
FULLPKGNAME-client=	bacula-client-${VERSION}p1
@


1.3
log
@fix FLAVORS/MULTI_PACKAGES mess.
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.2 2007/07/22 21:20:08 robert Exp $
d9 3
a11 3
PKGNAME-main=		${DISTNAME}
FULLPKGNAME-client=	bacula-client-${VERSION}p0
PKGNAME-server=		bacula-server-${VERSION}p0
d18 1
a18 1
MAINTAINER=		Michael Erdely <mike@@erdelynet.com>
@


1.2
log
@bacula does not have regression tests

from MAINTAINER
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.1.1.1 2007/07/20 11:02:14 robert Exp $
d10 2
a11 2
FULLPKGNAME-client=	${DISTNAME:S/-/-client-/}
PKGNAME-server=		${DISTNAME:S/-/-server-/}
d22 1
d141 2
@


1.1
log
@Initial revision
@
text
@d1 1
a1 1
# $OpenBSD$
d38 1
@


1.1.1.1
log
@import of bacula 2.0.3;

Bacula is a set of computer programs that permit you (or the system
administrator) to manage backup, recovery, and verification of
computer data across a network of computers of different kinds.
In technical terms, it is a network Client/Server based backup program.
Bacula is relatively easy to use and efficient, while offering many
advanced storage management features that make it easy to find and
recover lost or damaged files. Due to its modular design, Bacula is
scalable from small single computer systems to systems consisting of
hundreds of computers located over a large network.

from Mike Erdely <mike@@erdelynet.com>
@
text
@@
