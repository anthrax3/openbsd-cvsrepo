head	1.1;
access;
symbols
	OPENBSD_6_0:1.1.0.2
	OPENBSD_6_0_BASE:1.1;
locks; strict;
comment	@# @;


1.1
date	2016.05.18.08.05.11;	author landry;	state Exp;
branches;
next	;
commitid	wKOwXXKJJOqE5YDq;


desc
@@


1.1
log
@Add patches to fix browsing errors with perl 5.22 (use of defined.. see
https://bugzilla.redhat.com/show_bug.cgi?id=1259481) and backup failures
with smbclient > 4.2 (see https://bugzilla.redhat.com/show_bug.cgi?id=1294761)
@
text
@$OpenBSD$

Fix errors with smb >= 4.2

https://bugzilla.redhat.com/show_bug.cgi?id=1294761
https://bugs.debian.org/cgi-bin/bugreport.cgi?bug=820963

--- lib/BackupPC/Xfer/Smb.pm.orig	Mon Jan 12 01:19:53 2015
+++ lib/BackupPC/Xfer/Smb.pm	Wed May 18 10:01:30 2016
@@@@ -230,7 +230,9 @@@@ sub readOutput
             $t->{byteCnt} += $2;
             $t->{fileCnt}++;
             $t->{XferLOG}->write(\"$_\n") if ( $t->{logLevel} >= 1 );
-        } elsif ( /^\s*tar: dumped \d+ files/ ) {
+        } elsif ( /^\s*tar: dumped \d+ files/
+                    || /Total bytes received: \d+/i
+		) {
             $t->{xferOK} = 1;
             $t->{XferLOG}->write(\"$_\n") if ( $t->{logLevel} >= 0 );
         } elsif ( /^\s*tar: restored \d+ files/ ) {
@@@@ -270,6 +272,7 @@@@ sub readOutput
         } elsif ( /^\s*directory \\/i ) {
             $t->{XferLOG}->write(\"$_\n") if ( $t->{logLevel} >= 2 );
         } elsif ( /smb: \\>/
+                || /^tar:\d+/
                 || /^\s*added interface/i
                 || /^\s*tarmode is now/i
                 || /^\s*Total bytes written/i
@
