head	1.4;
access;
symbols
	OPENBSD_6_2:1.4.0.14
	OPENBSD_6_2_BASE:1.4
	OPENBSD_6_1:1.4.0.12
	OPENBSD_6_1_BASE:1.4
	OPENBSD_6_0:1.4.0.10
	OPENBSD_6_0_BASE:1.4
	OPENBSD_5_9:1.4.0.6
	OPENBSD_5_9_BASE:1.4
	OPENBSD_5_8:1.4.0.8
	OPENBSD_5_8_BASE:1.4
	OPENBSD_5_7:1.4.0.4
	OPENBSD_5_7_BASE:1.4
	OPENBSD_5_6:1.4.0.2
	OPENBSD_5_6_BASE:1.4
	OPENBSD_5_5:1.3.0.6
	OPENBSD_5_5_BASE:1.3
	OPENBSD_5_4:1.3.0.4
	OPENBSD_5_4_BASE:1.3
	OPENBSD_5_3:1.3.0.2
	OPENBSD_5_3_BASE:1.3
	OPENBSD_5_2:1.2.0.6
	OPENBSD_5_2_BASE:1.2
	OPENBSD_5_1_BASE:1.2
	OPENBSD_5_1:1.2.0.4
	OPENBSD_5_0:1.2.0.2
	OPENBSD_5_0_BASE:1.2
	OPENBSD_4_9:1.1.0.6
	OPENBSD_4_9_BASE:1.1
	OPENBSD_4_8:1.1.0.4
	OPENBSD_4_8_BASE:1.1
	OPENBSD_4_7:1.1.0.2
	OPENBSD_4_7_BASE:1.1;
locks; strict;
comment	@# @;


1.4
date	2014.07.09.10.45.16;	author sthen;	state Exp;
branches;
next	1.3;
commitid	1jOrBYUwUm89nA4P;

1.3
date	2012.12.18.21.38.12;	author sthen;	state Exp;
branches;
next	1.2;

1.2
date	2011.07.06.13.41.29;	author jasper;	state Exp;
branches;
next	1.1;

1.1
date	2010.01.19.15.25.21;	author okan;	state Exp;
branches;
next	;


desc
@@


1.4
log
@fix following header changes, drop USE_GROFF while there
@
text
@$OpenBSD: patch-machdep_nbsd-44_c,v 1.3 2012/12/18 21:38:12 sthen Exp $
--- machdep/nbsd-44.c.orig	Mon Apr  8 03:35:21 2002
+++ machdep/nbsd-44.c	Wed Jul  9 11:42:01 2014
@@@@ -36,6 +36,7 @@@@ static char rcsid[] = "$Id: nbsd-44.c,v 1.6 2002/04/05
 #include <signal.h>
 #include <stdlib.h>
 #include <ctype.h>
+#include <errno.h>
 
 #include <sys/resource.h>
 
@@@@ -172,6 +173,7 @@@@ REAL_REGEX_FUNCS
  * Now, set up everything we need to write a GetProc() routine.
  */
 
+#include <sys/proc.h>
 #include <sys/user.h>
 #include <sys/sysctl.h>
 
@@@@ -210,6 +212,28 @@@@ static	int	pidmapsiz = sizeof(pidmap) / sizeof(pidmap[
 #define	_PROC_UID(p)	(p)->ki_uid
 #endif
 #endif	/* __FreeBSD__ */
+
+#if defined(__OpenBSD__)
+#define	_SYSCTL_ARG	KERN_PROC
+#define	_SYSCTL_NMIB	6
+#define	_SYSCTL_PROC	kinfo_proc
+#define	_SYSCTL_MIBINIT(m)			\
+	m[0] = CTL_KERN;			\
+	m[1] = KERN_PROC;			\
+	m[2] = KERN_PROC_ALL;			\
+	m[3] = 0;				\
+	m[4] = sizeof(struct _SYSCTL_PROC);	\
+	m[5] = 0
+#define	_SYSCTL_MIBPROC(m,sz)			\
+	m[5] = (sz) / sizeof(struct _SYSCTL_PROC)
+
+#define	_PROC_COMM(p)	(p)->p_comm
+#define	_PROC_FLAG(p)	(p)->p_flag
+#define	_PROC_PID(p)	(p)->p_pid
+#define	_PROC_STAT(p)	(p)->p_stat
+#define	_PROC_TDEV(p)	(p)->p_tdev
+#define	_PROC_UID(p)	(p)->p_uid
+#endif
 
 #if defined(__NetBSD_Version__) && defined(KERN_PROC2)
 #define	_SYSCTL_ARG	KERN_PROC2
@


1.3
log
@cope with sysctl.h changes
@
text
@d1 12
a12 4
$OpenBSD: patch-machdep_nbsd-44_c,v 1.2 2011/07/06 13:41:29 jasper Exp $
--- machdep/nbsd-44.c.orig	Sun Apr  7 20:35:21 2002
+++ machdep/nbsd-44.c	Thu Dec  6 15:28:10 2012
@@@@ -172,6 +172,7 @@@@ REAL_REGEX_FUNCS
d20 1
a20 1
@@@@ -210,6 +211,28 @@@@ static	int	pidmapsiz = sizeof(pidmap) / sizeof(pidmap[
@


1.2
log
@- move away from old kinfo_proc2
@
text
@d1 13
a13 4
$OpenBSD: patch-machdep_nbsd-44_c,v 1.1 2010/01/19 15:25:21 okan Exp $
--- machdep/nbsd-44.c.orig	Mon Apr  8 04:35:21 2002
+++ machdep/nbsd-44.c	Wed Jul  6 15:40:43 2011
@@@@ -211,6 +211,28 @@@@ static	int	pidmapsiz = sizeof(pidmap) / sizeof(pidmap[
d16 1
a16 1
 
d38 1
a38 1
+
a40 1
 #define	_SYSCTL_NMIB	6
@


1.1
log
@adapt for KERN_PROC2; regen plist

ok sthen@@
@
text
@d1 4
a4 4
$OpenBSD$
--- machdep/nbsd-44.c.orig	Mon Jan 18 16:52:28 2010
+++ machdep/nbsd-44.c	Mon Jan 18 16:53:28 2010
@@@@ -211,7 +211,7 @@@@ static	int	pidmapsiz = sizeof(pidmap) / sizeof(pidmap[
d8 23
a30 2
-#if defined(__NetBSD_Version__) && defined(KERN_PROC2)
+#if defined(KERN_PROC2)
a32 1
 #define	_SYSCTL_PROC	kinfo_proc2
@

