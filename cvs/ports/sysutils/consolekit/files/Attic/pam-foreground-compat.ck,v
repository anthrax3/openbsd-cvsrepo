head	1.3;
access;
symbols
	OPENBSD_5_4:1.2.0.2
	OPENBSD_5_4_BASE:1.2
	OPENBSD_5_3:1.1.0.12
	OPENBSD_5_3_BASE:1.1
	OPENBSD_5_2:1.1.0.10
	OPENBSD_5_2_BASE:1.1
	OPENBSD_5_1_BASE:1.1
	OPENBSD_5_1:1.1.0.8
	OPENBSD_5_0:1.1.0.6
	OPENBSD_5_0_BASE:1.1
	OPENBSD_4_9:1.1.0.4
	OPENBSD_4_9_BASE:1.1
	OPENBSD_4_8:1.1.0.2
	OPENBSD_4_8_BASE:1.1;
locks; strict;
comment	@# @;


1.3
date	2013.12.30.08.52.08;	author ajacoutot;	state dead;
branches;
next	1.2;

1.2
date	2013.04.05.06.59.11;	author ajacoutot;	state Exp;
branches;
next	1.1;

1.1
date	2010.06.27.22.15.38;	author ajacoutot;	state Exp;
branches;
next	;


desc
@@


1.3
log
@Drop /var/run/console management patches, calls to session.d's
session_active_changed are not supported since a while.
That fixes a race condition where connecting to ConsoleKit could fail
which would lead to several issues (unable to unlock screen, reboot...).
@
text
@#!/bin/sh
TAGDIR=/var/run/console

[ -n "${CK_SESSION_USER_UID}" ] || exit 1
[ "${CK_SESSION_IS_LOCAL}" = "true" ] || exit 0

TAGFILE="${TAGDIR}/`getent passwd ${CK_SESSION_USER_UID} | cut -f 1 -d:`"

if [ "$1" = "session_added" ]; then
    mkdir -p "${TAGDIR}"
    echo "${CK_SESSION_ID}" >> "${TAGFILE}"
fi

if [ "$1" = "session_removed" ] && [ -e "${TAGFILE}" ]; then
    sed -e "\%^${CK_SESSION_ID}\$%d" "${TAGFILE}" > "${TAGFILE}.tmp"
    mv "${TAGFILE}.tmp" "${TAGFILE}"
    [ -s "${TAGFILE}" ] || rm -f "${TAGFILE}"
fi
@


1.2
log
@Fix sed(1) usage in pam-foreground-compat.ck.
@
text
@@


1.1
log
@Update to consolekit-0.4.1.
WIP, need uncommited stuffs and does wrong things for now, so it is still
marked as BROKEN.
@
text
@d3 1
a3 1
 
d5 4
a8 3
 
TAGFILE="${TAGDIR}/$(getent passwd ${CK_SESSION_USER_UID} | cut -f 1 -d:)"
 
d10 2
a11 2
  mkdir -p "${TAGDIR}"
  echo "${CK_SESSION_ID}" >> "$TAGFILE"
d13 5
a17 4
 
if [ "$1" = "session_removed" ] && [ -e "$TAGFILE" ]; then
 sed -i "\%^$CK_SESSION_ID\$%d" "${TAGFILE}"
 [ -s "${TAGFILE}" ] || rm -f "${TAGFILE}"
@

