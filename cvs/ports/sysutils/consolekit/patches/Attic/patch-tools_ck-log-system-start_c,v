head	1.5;
access;
symbols
	OPENBSD_5_9:1.4.0.2
	OPENBSD_5_9_BASE:1.4
	OPENBSD_5_8:1.2.0.6
	OPENBSD_5_8_BASE:1.2
	OPENBSD_5_7:1.2.0.2
	OPENBSD_5_7_BASE:1.2
	OPENBSD_5_6:1.1.0.14
	OPENBSD_5_6_BASE:1.1
	OPENBSD_5_5:1.1.0.12
	OPENBSD_5_5_BASE:1.1
	OPENBSD_5_4:1.1.0.10
	OPENBSD_5_4_BASE:1.1
	OPENBSD_5_3:1.1.0.8
	OPENBSD_5_3_BASE:1.1
	OPENBSD_5_2:1.1.0.6
	OPENBSD_5_2_BASE:1.1
	OPENBSD_5_1_BASE:1.1
	OPENBSD_5_1:1.1.0.4
	OPENBSD_5_0:1.1.0.2
	OPENBSD_5_0_BASE:1.1;
locks; strict;
comment	@# @;


1.5
date	2016.03.19.17.51.34;	author ajacoutot;	state dead;
branches;
next	1.4;
commitid	YLaTybgOKFQv2GEb;

1.4
date	2016.01.21.06.43.37;	author ajacoutot;	state Exp;
branches;
next	1.3;
commitid	bMWC9d6SAIeHxNWO;

1.3
date	2015.08.15.11.12.54;	author ajacoutot;	state dead;
branches;
next	1.2;
commitid	RKWZWmWhKNwhuQQN;

1.2
date	2014.11.27.09.38.22;	author ajacoutot;	state Exp;
branches;
next	1.1;
commitid	oD5B2Fc2vHIt4ytZ;

1.1
date	2011.04.28.13.08.33;	author ajacoutot;	state Exp;
branches;
next	;


desc
@@


1.5
log
@Update to consolekit2-1.0.2.
@
text
@$OpenBSD: patch-tools_ck-log-system-start_c,v 1.4 2016/01/21 06:43:37 ajacoutot Exp $

From 845cc7cfa7566f673736723143dfb7db714ece24 Mon Sep 17 00:00:00 2001
From: Michal Sekletar <msekleta@@redhat.com>
Date: Mon, 18 Jan 2016 17:37:41 +0100
Subject: [PATCH] Fix undefined behavior

--- tools/ck-log-system-start.c.orig	Wed Jan 13 10:12:10 2016
+++ tools/ck-log-system-start.c	Thu Jan 21 07:37:14 2016
@@@@ -249,7 +249,7 @@@@ main (int    argc,
 
         event.type = CK_LOG_EVENT_SYSTEM_START;
         g_get_current_time (&event.timestamp);
-        e = (CkLogSystemStartEvent *) &event;
+        e = (CkLogSystemStartEvent *) &event.event;
 
         if (uname (&uts) == 0) {
                 e->kernel_release = uts.release;
@


1.4
log
@When assigning session to active VT prefer graphical sessions (upstream).
Fix undefined behavior (upstream).
@
text
@d1 1
a1 1
$OpenBSD$
@


1.3
log
@Move to the ConsoleKit2 project and update to the newly released stable version:
consolekit2-1.0.0.
Committing early in the cycle to have time to catch any regression.
@
text
@d1 15
a15 4
$OpenBSD: patch-tools_ck-log-system-start_c,v 1.2 2014/11/27 09:38:22 ajacoutot Exp $
--- tools/ck-log-system-start.c.orig	Fri Jul 19 06:15:28 2013
+++ tools/ck-log-system-start.c	Thu Nov 27 10:34:39 2014
@@@@ -41,7 +41,9 @@@@
d17 2
a18 26
 #define DEFAULT_LOG_FILENAME LOCALSTATEDIR "/log/ConsoleKit/history"
 
+#ifdef __linux__
 #define LINUX_KERNEL_CMDLINE "/proc/cmdline"
+#endif
 
 /* Adapted from auditd auditd-event.c */
 static gboolean
@@@@ -162,6 +164,7 @@@@ write_log_for_event (CkLogEvent *event)
 static char *
 get_boot_arguments (void)
 {
+#if defined(__linux__)
         char *contents;
         gboolean res;
 
@@@@ -178,6 +181,9 @@@@ get_boot_arguments (void)
         }
 
         return contents;
+#else
+        return NULL;
+#endif
 }
 
 int
@


1.2
log
@Sync a few cleanups from the ConsoleKit2 project.
@
text
@d1 1
a1 1
$OpenBSD: patch-tools_ck-log-system-start_c,v 1.1 2011/04/28 13:08:33 ajacoutot Exp $
@


1.1
log
@Update to consolekit-0.4.4.
Make sure we don't try and use /proc.
s/KERN_PROC2/KERN_PROC

ok jasper@@
@
text
@d1 3
a3 3
$OpenBSD$
--- tools/ck-log-system-start.c.orig	Fri Sep  3 15:54:31 2010
+++ tools/ck-log-system-start.c	Wed Apr 27 20:01:29 2011
d14 2
a15 1
@@@@ -163,6 +165,7 @@@@ static char *
d18 1
a19 1
+#ifdef __linux__
d22 1
a22 4
         contents = NULL;
@@@@ -176,6 +179,9 @@@@ get_boot_arguments (void)
         } else {
                 g_strchomp (contents);
d24 2
d27 1
a27 1
+        contents = NULL;
d29 1
d31 1
a31 2
         return contents;
 }
@

