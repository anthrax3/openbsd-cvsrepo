head	1.2;
access;
symbols
	OPENBSD_5_8:1.1.0.20
	OPENBSD_5_8_BASE:1.1
	OPENBSD_5_7:1.1.0.16
	OPENBSD_5_7_BASE:1.1
	OPENBSD_5_6:1.1.0.14
	OPENBSD_5_6_BASE:1.1
	OPENBSD_5_5:1.1.0.12
	OPENBSD_5_5_BASE:1.1
	OPENBSD_5_4:1.1.0.10
	OPENBSD_5_4_BASE:1.1
	OPENBSD_5_3:1.1.0.8
	OPENBSD_5_3_BASE:1.1
	OPENBSD_5_2:1.1.0.6
	OPENBSD_5_2_BASE:1.1
	OPENBSD_5_1_BASE:1.1
	OPENBSD_5_1:1.1.0.4
	OPENBSD_5_0:1.1.0.2
	OPENBSD_5_0_BASE:1.1;
locks; strict;
comment	@# @;


1.2
date	2015.08.15.11.12.54;	author ajacoutot;	state dead;
branches;
next	1.1;
commitid	RKWZWmWhKNwhuQQN;

1.1
date	2011.04.28.13.08.33;	author ajacoutot;	state Exp;
branches;
next	;


desc
@@


1.2
log
@Move to the ConsoleKit2 project and update to the newly released stable version:
consolekit2-1.0.0.
Committing early in the cycle to have time to catch any regression.
@
text
@$OpenBSD: patch-tools_ck-collect-session-info_c,v 1.1 2011/04/28 13:08:33 ajacoutot Exp $

XXX revert 4f88228f31a63c026c424a92827f26ad7535275c
The Kit people assume the world runs Linux and PAM, see
https://bugs.freedesktop.org/show_bug.cgi?id=28377

--- tools/ck-collect-session-info.c.orig	Fri Sep  3 15:54:31 2010
+++ tools/ck-collect-session-info.c	Sat Dec  4 12:18:34 2010
@@@@ -274,7 +274,8 @@@@ fill_x11_info (SessionInfo *si)
         si->x11_display_device = ck_process_stat_get_tty (xorg_stat);
         ck_process_stat_free (xorg_stat);
 
-        /* don't set is-local here - let the daemon do that */
+        si->is_local = TRUE;
+        si->is_local_is_set = TRUE;
 
         g_free (si->remote_host_name);
         si->remote_host_name = NULL;
@@@@ -302,6 +303,13 @@@@ fill_session_info (SessionInfo *si)
         ck_process_stat_free (stat);
 
         fill_x11_info (si);
+
+        if (! si->is_local_is_set) {
+                /* FIXME: how should we set this? */
+                /* non x11 sessions must be local I guess */
+                si->is_local = TRUE;
+                si->is_local_is_set = TRUE;
+        }
 
         res = ck_unix_pid_get_login_session_id (si->pid, &si->login_session_id);
         if (! res) {
@


1.1
log
@Update to consolekit-0.4.4.
Make sure we don't try and use /proc.
s/KERN_PROC2/KERN_PROC

ok jasper@@
@
text
@d1 1
a1 1
$OpenBSD$
@

