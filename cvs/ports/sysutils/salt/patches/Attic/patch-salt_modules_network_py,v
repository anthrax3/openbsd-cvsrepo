head	1.6;
access;
symbols
	OPENBSD_5_7:1.4.0.2
	OPENBSD_5_7_BASE:1.4;
locks; strict;
comment	@# @;


1.6
date	2015.05.07.09.15.55;	author ajacoutot;	state dead;
branches;
next	1.5;
commitid	SwUliQR8dTPaJwzy;

1.5
date	2015.03.27.14.40.04;	author ajacoutot;	state Exp;
branches;
next	1.4;
commitid	Gcr89g4lZ3BcuGb9;

1.4
date	2015.01.16.13.19.48;	author ajacoutot;	state Exp;
branches;
next	1.3;
commitid	l1qaoWaTD8eUURBn;

1.3
date	2015.01.07.09.57.39;	author ajacoutot;	state Exp;
branches;
next	1.2;
commitid	ljrBzwpr23CjpR5G;

1.2
date	2014.09.02.17.18.55;	author ajacoutot;	state Exp;
branches;
next	1.1;
commitid	rpydUm4DHSmllnK2;

1.1
date	2014.09.02.14.01.51;	author ajacoutot;	state Exp;
branches;
next	;
commitid	iLabIzoO2OGRH45e;


desc
@@


1.6
log
@Update to salt-2015.5.0.
@
text
@$OpenBSD: patch-salt_modules_network_py,v 1.5 2015/03/27 14:40:04 ajacoutot Exp $

https://github.com/saltstack/salt/commit/294ea72d9419e69f3f613e951a7cfd5f4840c66f

--- salt/modules/network.py.orig	Wed Mar 25 00:26:39 2015
+++ salt/modules/network.py	Fri Mar 27 15:38:04 2015
@@@@ -419,7 +419,12 @@@@ def arp():
         comps = line.split()
         if len(comps) < 4:
             continue
-        ret[comps[3]] = comps[1].strip('(').strip(')')
+        if not __grains__['kernel'] == 'OpenBSD':
+           ret[comps[3]] = comps[1].strip('(').strip(')')
+        else:
+           if comps[0] == 'Host' or comps[1] == '(incomplete)':
+               continue
+           ret[comps[1]] = comps[0]
     return ret
 
 
@@@@ -613,6 +618,9 @@@@ def mod_hostname(hostname):
                     fh.write(i)
     elif __grains__['os_family'] == 'Debian':
         with salt.utils.fopen('/etc/hostname', 'w') as fh:
+            fh.write(hostname + '\n')
+    elif __grains__['os_family'] == 'OpenBSD':
+        with salt.utils.fopen('/etc/myname', 'w') as fh:
             fh.write(hostname + '\n')
 
     return True
@


1.5
log
@Update to salt-2014.7.3.
@
text
@d1 1
a1 1
$OpenBSD: patch-salt_modules_network_py,v 1.4 2015/01/16 13:19:48 ajacoutot Exp $
@


1.4
log
@Update to salt-2014.7.1.
@
text
@d1 1
a1 1
$OpenBSD: patch-salt_modules_network_py,v 1.3 2015/01/07 09:57:39 ajacoutot Exp $
d5 3
a7 3
--- salt/modules/network.py.orig	Wed Jan 14 19:38:21 2015
+++ salt/modules/network.py	Fri Jan 16 13:29:58 2015
@@@@ -417,7 +417,12 @@@@ def arp():
d21 1
a21 1
@@@@ -611,6 +616,9 @@@@ def mod_hostname(hostname):
@


1.3
log
@Update to salt-2014.7.0.
@
text
@d1 1
a1 1
$OpenBSD: patch-salt_modules_network_py,v 1.2 2014/09/02 17:18:55 ajacoutot Exp $
d5 2
a6 2
--- salt/modules/network.py.orig	Mon Nov  3 20:38:21 2014
+++ salt/modules/network.py	Wed Jan  7 10:41:10 2015
d21 1
a21 1
@@@@ -613,6 +618,9 @@@@ def mod_hostname(hostname):
@


1.2
log
@All patches have been committed upstream.
@
text
@d1 1
a1 1
$OpenBSD: patch-salt_modules_network_py,v 1.1 2014/09/02 14:01:51 ajacoutot Exp $
d5 3
a7 3
--- salt/modules/network.py.orig	Fri Aug  1 20:38:41 2014
+++ salt/modules/network.py	Tue Sep  2 15:52:59 2014
@@@@ -413,7 +413,12 @@@@ def arp():
d21 4
a24 30
@@@@ -568,17 +573,22 @@@@ def mod_hostname(hostname):
     f.write(hostfile)
     f.close()
 
-    #3.modify /etc/sysconfig/network
-    f = open('/etc/sysconfig/network', 'r')
-    str_network = f.read()
-    list_network = str_network.splitlines()
-    cmd = 'HOSTNAME={0}'.format(hostname)
-    for k in list_network:
-        if k.startswith('HOSTNAME'):
-            num = list_network.index(k)
-            list_network[num] = cmd
-    networkfile = '\n'.join(list_network)
-    f = open('/etc/sysconfig/network', 'w')
-    f.write(networkfile)
-    f.close()
+    # Modify the /etc/sysconfig/network configuration file to set the
+    # new hostname
+    if __grains__['os_family'] == 'RedHat':
+        network_c = salt.utils.fopen('/etc/sysconfig/network', 'r').readlines()
+
+        with salt.utils.fopen('/etc/sysconfig/network', 'w') as fh:
+            for i in network_c:
+                if i.startswith('HOSTNAME'):
+                    fh.write('HOSTNAME={0}\n'.format(hostname))
+                else:
+                    fh.write(i)
+    elif __grains__['os_family'] == 'Debian':
+        with salt.utils.fopen('/etc/hostname', 'w') as fh:
d28 2
a29 2
+            fh.write(hostname + '\n')
+
@


1.1
log
@Fix arp() and mod_hostname() to work on OpenBSD.
@
text
@d1 1
a1 1
$OpenBSD$
d3 1
a3 1
https://github.com/saltstack/salt/pull/15430
@

