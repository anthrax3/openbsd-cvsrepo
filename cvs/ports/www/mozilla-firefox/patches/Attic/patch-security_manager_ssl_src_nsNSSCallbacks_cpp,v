head	1.3;
access;
symbols
	OPENBSD_4_9:1.2.0.2;
locks; strict;
comment	@# @;


1.3
date	2011.04.29.07.58.10;	author landry;	state dead;
branches;
next	1.2;

1.2
date	2011.03.30.21.39.14;	author landry;	state Exp;
branches
	1.2.2.1;
next	1.1;

1.1
date	2011.03.24.11.41.11;	author landry;	state Exp;
branches;
next	;

1.2.2.1
date	2011.04.27.02.55.44;	author william;	state Exp;
branches;
next	;


desc
@@


1.3
log
@Update to mozilla-firefox 4.0.1.
Fixes MFSA 2011-12, 2011-17, 2011-18.
@
text
@$OpenBSD: patch-security_manager_ssl_src_nsNSSCallbacks_cpp,v 1.2 2011/03/30 21:39:14 landry Exp $
https://bugzilla.mozilla.org/show_bug.cgi?id=644012
--- security/manager/ssl/src/nsNSSCallbacks.cpp.orig	Thu Mar 24 11:30:28 2011
+++ security/manager/ssl/src/nsNSSCallbacks.cpp	Thu Mar 24 11:31:40 2011
@@@@ -1012,8 +1012,11 @@@@ SECStatus PR_CALLBACK AuthCertificateCallback(void* cl
   nsNSSShutDownPreventionLock locker;
 
   CERTCertificate *serverCert = SSL_PeerCertificate(fd);
+  CERTCertificateCleaner serverCertCleaner(serverCert);
+
   if (serverCert && 
       serverCert->serialNumber.data &&
+      serverCert->issuerName &&
       !strcmp(serverCert->issuerName, 
         "CN=UTN-USERFirst-Hardware,OU=http://www.usertrust.com,O=The USERTRUST Network,L=Salt Lake City,ST=UT,C=US")) {
 
@@@@ -1056,8 +1059,6 @@@@ SECStatus PR_CALLBACK AuthCertificateCallback(void* cl
   // We want to remember the CA certs in the temp db, so that the application can find the
   // complete chain at any time it might need it.
   // But we keep only those CA certs in the temp db, that we didn't already know.
-  
-  CERTCertificateCleaner serverCertCleaner(serverCert);
 
   if (serverCert) {
     nsNSSSocketInfo* infoObject = (nsNSSSocketInfo*) fd->higher->secret;
@


1.2
log
@Lo and behold, update to mozilla-firefox 4.0 !
Too much changes to list them, just enjoy it. Thanks to the ones who
tested the betas/rc.
ok jasper@@
@
text
@d1 1
a1 1
$OpenBSD$
@


1.2.2.1
log
@SECURITY UPDATE to mozilla-firefox-3.6.16

ok jasper landry

thanks to landry for doing all the work in -current's www/firefox36,
which this was based on.
@
text
@d3 3
a5 3
--- security/manager/ssl/src/nsNSSCallbacks.cpp.orig	Thu Mar 24 01:18:45 2011
+++ security/manager/ssl/src/nsNSSCallbacks.cpp	Thu Mar 24 01:20:00 2011
@@@@ -1007,8 +1007,11 @@@@ SECStatus PR_CALLBACK AuthCertificateCallback(void* cl
d17 1
a17 1
@@@@ -1051,8 +1054,6 @@@@ SECStatus PR_CALLBACK AuthCertificateCallback(void* cl
@


1.1
log
@Assorted fixes for:
https://bugzilla.mozilla.org/show_bug.cgi?id=643137 (crash on sparc64
when displaying opentypes fonts, fix from tobias ulmer)
https://bugzilla.mozilla.org/show_bug.cgi?id=644012 (crash on ssl certs
with empty issuer name, pointed our by roberth at openbsd dot pap dot st
and mikolaj kucharski)
@
text
@d3 3
a5 3
--- security/manager/ssl/src/nsNSSCallbacks.cpp.orig	Thu Mar 24 01:18:45 2011
+++ security/manager/ssl/src/nsNSSCallbacks.cpp	Thu Mar 24 01:20:00 2011
@@@@ -1007,8 +1007,11 @@@@ SECStatus PR_CALLBACK AuthCertificateCallback(void* cl
d17 1
a17 1
@@@@ -1051,8 +1054,6 @@@@ SECStatus PR_CALLBACK AuthCertificateCallback(void* cl
@

