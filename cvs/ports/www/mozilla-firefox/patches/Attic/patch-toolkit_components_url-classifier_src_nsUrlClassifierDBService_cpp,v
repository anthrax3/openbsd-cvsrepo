head	1.3;
access;
symbols
	OPENBSD_4_7:1.1.0.6
	OPENBSD_4_7_BASE:1.1
	OPENBSD_4_6:1.1.0.4
	OPENBSD_4_6_BASE:1.1
	OPENBSD_4_5:1.1.0.2
	OPENBSD_4_5_BASE:1.1;
locks; strict;
comment	@# @;


1.3
date	2010.04.26.19.55.58;	author landry;	state dead;
branches;
next	1.2;

1.2
date	2010.03.31.15.46.12;	author naddy;	state Exp;
branches;
next	1.1;

1.1
date	2008.11.20.23.41.32;	author martynas;	state Exp;
branches;
next	;


desc
@@


1.3
log
@Update www/mozilla-firefox from 3.0.19 to 3.6.3, merging the wip done in
www/firefox36 mostly by martynas@@ and naddy@@.
Note that the java plugin from devel/jdk currently doesn't work with this
version of firefox, in the meantime users really needed it will have to
use www/firefox35.
ok naddy@@
@
text
@$OpenBSD: patch-toolkit_components_url-classifier_src_nsUrlClassifierDBService_cpp,v 1.2 2010/03/31 15:46:12 naddy Exp $
--- toolkit/components/url-classifier/src/nsUrlClassifierDBService.cpp.orig	Mon Mar  8 19:47:53 2010
+++ toolkit/components/url-classifier/src/nsUrlClassifierDBService.cpp	Tue Mar 30 21:54:19 2010
@@@@ -2029,8 +2029,20 @@@@ nsUrlClassifierDBServiceWorker::GetShaEntries(PRUint32
           return NS_ERROR_FAILURE;
         }
         const nsCSubstring& str = Substring(chunk, start, 4);
+#if 0
+        // You can't just cast a char* to an int* and access through it
         const PRUint32 *p = reinterpret_cast<const PRUint32*>(str.BeginReading());
         entry->mAddChunkId = PR_ntohl(*p);
+#else
+        // the old-school way...
+        union {
+          PRUint32 i;
+          char c[4];
+        } u;
+
+        memcpy(u.c, reinterpret_cast<const char *>(str.BeginReading()), 4);
+        entry->mAddChunkId = PR_ntohl(u.i);
+#endif
         if (entry->mAddChunkId == 0) {
           NS_WARNING("Received invalid chunk number.");
           return NS_ERROR_FAILURE;
@@@@ -2058,8 +2070,20 @@@@ nsUrlClassifierDBServiceWorker::GetShaEntries(PRUint32
 
         if (chunkType == CHUNK_SUB) {
           const nsCSubstring& str = Substring(chunk, start, 4);
+#if 0
+          // You can't just cast a char* to an int* and access through it
           const PRUint32 *p = reinterpret_cast<const PRUint32*>(str.BeginReading());
           entry->mAddChunkId = PR_ntohl(*p);
+#else
+          // the old-school way...
+          union {
+            PRUint32 i;
+            char c[4];
+          } u;
+
+          memcpy(u.c, reinterpret_cast<const char *>(str.BeginReading()), 4);
+          entry->mAddChunkId = PR_ntohl(u.i);
+#endif
           if (entry->mAddChunkId == 0) {
             NS_WARNING("Received invalid chunk number.");
             return NS_ERROR_FAILURE;
@


1.2
log
@SECURITY update to 3.0.19:
MFSA 2010-20 Chrome privilege escalation via forced URL drag and drop
MFSA 2010-19 Dangling pointer vulnerability in nsPluginArray
MFSA 2010-18 Dangling pointer vulnerability in nsTreeContentView
MFSA 2010-17 Remote code execution with use-after-free in nsTreeSelection
MFSA 2010-16 Crashes with evidence of memory corruption
@
text
@d1 1
a1 1
$OpenBSD: patch-toolkit_components_url-classifier_src_nsUrlClassifierDBService_cpp,v 1.1 2008/11/20 23:41:32 martynas Exp $
@


1.1
log
@it is the right time to update to mozilla-firefox-3.0.4, which has
been tested good enough, and i've fixed all the issues i'm aware
of.  furthermore 2.0 branch has basically reached eol, since there
will be only one minor update (2.0.0.19)
discussed with kurt@@, naddy@@ and porters
pkgname change handling help naddy@@
ok naddy@@
@
text
@d1 4
a4 4
$OpenBSD: patch-toolkit_components_url-classifier_src_nsUrlClassifierDBService_cpp,v 1.2 2008/09/24 19:25:40 martynas Exp $
--- toolkit/components/url-classifier/src/nsUrlClassifierDBService.cpp.orig	Mon Aug 25 23:59:14 2008
+++ toolkit/components/url-classifier/src/nsUrlClassifierDBService.cpp	Tue Sep 23 20:37:33 2008
@@@@ -2023,8 +2023,20 @@@@ nsUrlClassifierDBServiceWorker::GetShaEntries(PRUint32
d25 1
a25 1
@@@@ -2052,8 +2064,20 @@@@ nsUrlClassifierDBServiceWorker::GetShaEntries(PRUint32
@

