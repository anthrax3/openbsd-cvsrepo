head	1.2;
access;
symbols;
locks; strict;
comment	@# @;


1.2
date	2014.07.24.18.03.00;	author landry;	state dead;
branches;
next	1.1;
commitid	k2YGqYP6dSDkuIKd;

1.1
date	2014.06.26.13.40.59;	author sthen;	state Exp;
branches;
next	;
commitid	LATo2UFAj5sUdilS;


desc
@@


1.2
log
@Update to firefox 31.0.

- See https://www.mozilla.org/en-US/firefox/31.0/releasenotes/
- Fixes MFSA 2014-56->66
- rm/add aboutcerterror/aboutCertError.xhtml patch, corresponding code
  moved - i'm still pondering why we keep that patch..
- remove patch-browser_branding_official_Makefile_in, merged (#992613)
- remove chunk 1 of patch-configure_in, merged (#991686)
- improve skia/i386/sse3 patches from #1028827, for something simpler and
  closer to what will be commited upstream
- fix README to point users to gstreamer1-plugins-libav instead of
  gstreamer-ffmpeg, reminded by jturner@@ a while ago

ok sthen@@ jasper@@ naddy@@
@
text
@$OpenBSD: patch-gfx_skia_trunk_src_opts_opts_check_SSE2_cpp,v 1.1 2014/06/26 13:40:59 sthen Exp $

- we need to disable SSSE3 due to old binutils.

- what is the point in having a cpuid check if you're going to
ignore it if the build machine has SSSE3?!

--- gfx/skia/trunk/src/opts/opts_check_SSE2.cpp.orig	Thu Jun 26 05:12:11 2014
+++ gfx/skia/trunk/src/opts/opts_check_SSE2.cpp	Thu Jun 26 05:12:11 2014
@@@@ -70,7 +70,7 @@@@ static inline void getcpuid(int info_type, int info[4]
 #endif
 #endif
 
-#if defined(__x86_64__) || defined(_WIN64) || SK_CPU_SSE_LEVEL >= SK_CPU_SSE_LEVEL_SSE2
+#if defined(__x86_64__) || defined(_WIN64)
 /* All x86_64 machines have SSE2, or we know it's supported at compile time,  so don't even bother checking. */
 static inline bool hasSSE2() {
     return true;
@@@@ -84,19 +84,11 @@@@ static inline bool hasSSE2() {
 }
 #endif
 
-#if SK_CPU_SSE_LEVEL >= SK_CPU_SSE_LEVEL_SSSE3
-/* If we know SSSE3 is supported at compile time, don't even bother checking. */
 static inline bool hasSSSE3() {
-    return true;
-}
-#else
-
-static inline bool hasSSSE3() {
     int cpu_info[4] = { 0 };
     getcpuid(1, cpu_info);
     return (cpu_info[2] & 0x200) != 0;
 }
-#endif
 
 static bool cachedHasSSE2() {
     static bool gHasSSE2 = hasSSE2();
@@@@ -121,6 +113,7 @@@@ void SkBitmapProcState::platformConvolutionProcs(SkCon
 }
 
 void SkBitmapProcState::platformProcs() {
+#if 0
     if (cachedHasSSSE3()) {
         if (fSampleProc32 == S32_opaque_D32_filter_DX) {
             fSampleProc32 = S32_opaque_D32_filter_DX_SSSE3;
@@@@ -134,6 +127,9 @@@@ void SkBitmapProcState::platformProcs() {
             fSampleProc32 = S32_alpha_D32_filter_DXDY_SSSE3;
         }
     } else if (cachedHasSSE2()) {
+#else
+    if (cachedHasSSSE3() || cachedHasSSE2()) {
+#endif
         if (fSampleProc32 == S32_opaque_D32_filter_DX) {
             fSampleProc32 = S32_opaque_D32_filter_DX_SSE2;
         } else if (fSampleProc32 == S32_alpha_D32_filter_DX) {
@


1.1
log
@Work around Firefox build failure on i386 occurring since skia was updated
in 30.0, see https://bugzilla.mozilla.org/show_bug.cgi?id=1028827.

Remove some "if build machine has SSE2/SSSE3 then don't bother with cpuid
feature checks at runtime" pieces.

ok jasper@@ (landry is away for a few days).
@
text
@d1 1
a1 1
$OpenBSD$
@

