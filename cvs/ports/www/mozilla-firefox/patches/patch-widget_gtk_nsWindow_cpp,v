head	1.1;
access;
symbols;
locks; strict;
comment	@# @;


1.1
date	2017.02.21.19.53.55;	author landry;	state Exp;
branches;
next	;
commitid	nd64jQefPeCMF5uG;


desc
@@


1.1
log
@Backport fix for #1335827 - frequent crashes with "ABORT:
RenderFreePicture: RenderBadPicture", reported and testing by semarie@@
@
text
@$OpenBSD$

https://hg.mozilla.org/integration/mozilla-inbound/raw-rev/97795c1d467d

--- widget/gtk/nsWindow.cpp.orig	Mon Jan 16 17:16:53 2017
+++ widget/gtk/nsWindow.cpp	Tue Feb 21 20:51:54 2017
@@@@ -727,6 +727,12 @@@@ nsWindow::Destroy()
     // destroys the the gl context attached to it).
     DestroyCompositor();
 
+#ifdef MOZ_X11
+    // Ensure any resources assigned to the window get cleaned up first
+    // to avoid double-freeing.
+    mSurfaceProvider.CleanupResources();
+#endif
+
     ClearCachedResources();
 
     g_signal_handlers_disconnect_by_func(gtk_settings_get_default(),
@
