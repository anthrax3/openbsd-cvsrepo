head	1.8;
access;
symbols
	OPENBSD_6_1:1.7.0.2
	OPENBSD_6_1_BASE:1.7
	OPENBSD_6_0:1.4.0.2
	OPENBSD_6_0_BASE:1.4
	OPENBSD_5_9:1.1.0.2
	OPENBSD_5_9_BASE:1.1;
locks; strict;
comment	@# @;


1.8
date	2017.04.20.06.12.58;	author landry;	state Exp;
branches;
next	1.7;
commitid	WUt99C6A8mADidu3;

1.7
date	2017.03.07.15.31.38;	author landry;	state Exp;
branches
	1.7.2.1;
next	1.6;
commitid	TBtrve6ZlRazGi25;

1.6
date	2017.01.24.21.33.09;	author landry;	state Exp;
branches;
next	1.5;
commitid	nWPQGTUORNhJi9af;

1.5
date	2016.08.02.17.50.03;	author landry;	state Exp;
branches;
next	1.4;
commitid	C4uQzGWx3WTtTKku;

1.4
date	2016.06.08.20.33.02;	author landry;	state Exp;
branches;
next	1.3;
commitid	o8aDQea7N3JsqnJh;

1.3
date	2016.04.27.13.50.27;	author landry;	state Exp;
branches;
next	1.2;
commitid	15LuhcSbzffxjAi3;

1.2
date	2016.03.14.20.48.43;	author landry;	state Exp;
branches;
next	1.1;
commitid	RRyzzZuPWgdXYfVi;

1.1
date	2015.09.24.20.21.15;	author landry;	state Exp;
branches;
next	;
commitid	ZpTmiMdCoguHXVvL;

1.7.2.1
date	2017.04.20.19.44.46;	author landry;	state Exp;
branches;
next	;
commitid	FPZjxs6KRlLvhncc;


desc
@@


1.8
log
@Update to firefox 53.0.

See https://www.mozilla.org/en-US/firefox/53.0/releasenotes/ and
https://www.mozilla.org/en-US/security/advisories/mfsa2017-10/.

- Now depends on rust and cargo to build.
- Remove patch-browser_installer_Makefile_in, sdk was removed in #1333826
- Ship a small distribution.ini to show package source in about dialog
- Add a blurb from Michael Reed about installing ffmpeg package to play
HTML5 audio/video.

Tested by several
@
text
@$OpenBSD: patch-storage_mozStorageConnection_cpp,v 1.7 2017/03/07 15:31:38 landry Exp $

set secure_delete PRAGMA on by default, instead of using internal sqlite copy
https://bugzilla.mozilla.org/show_bug.cgi?id=546162

--- storage/mozStorageConnection.cpp.orig	Tue Mar  7 01:57:32 2017
+++ storage/mozStorageConnection.cpp	Wed Mar  8 16:56:49 2017
@@@@ -781,6 +781,13 @@@@ Connection::initializeInternal()
     return convertResultCode(srv);
   }
 
+  srv = ::sqlite3_exec(mDBConn, "PRAGMA secure_delete = ON", NULL, NULL, NULL);
+  if (srv != SQLITE_OK) {
+    ::sqlite3_close(mDBConn);
+    mDBConn = nullptr;
+    return convertResultCode(srv);
+  }
+
   // Set the synchronous PRAGMA, according to the preference.
   switch (Service::getSynchronousPref()) {
     case 2:
@


1.7
log
@Update mozilla-firefox to 52.0.

See https://www.mozilla.org/en-US/firefox/52.0/releasenotes/

Remove patch for #1335827, merged upstream.

Note that this release removes support for NPAPI plugins (java, etc..) -
users relying on those should migrate to firefox-esr, where NPAPI
plugins will be supported for the lifetime of 52esr branch.

Tested by several, thanks!
@
text
@d1 1
a1 1
$OpenBSD: patch-storage_mozStorageConnection_cpp,v 1.6 2017/01/24 21:33:09 landry Exp $
d6 3
a8 3
--- storage/mozStorageConnection.cpp.orig	Mon Jan 23 17:13:59 2017
+++ storage/mozStorageConnection.cpp	Sat Feb 18 15:15:27 2017
@@@@ -782,6 +782,13 @@@@ Connection::initializeInternal()
@


1.7.2.1
log
@MFC: update to firefox 53.0.

Over time i'll see if i keep doing this in -stable or give up.
"Stable" packages for i386 and amd64 available at https://packages.rhaalovely.net/
signed with https://packages.rhaalovely.net/landry-mozilla-pkg.pub

Changes from -current include:
- dont bump SO_VERSION
- build against bundled nss/nspr (53 wants nss 3.29.5)
- add selected patches from devel/nspr and security/nss
- build against bundled hunspell (53 wants 1.6)
- add BDEP on rust/cargo
@
text
@d1 1
a1 1
$OpenBSD: patch-storage_mozStorageConnection_cpp,v 1.7 2017/03/07 15:31:38 landry Exp $
d6 3
a8 3
--- storage/mozStorageConnection.cpp.orig	Tue Mar  7 01:57:32 2017
+++ storage/mozStorageConnection.cpp	Wed Mar  8 16:56:49 2017
@@@@ -781,6 +781,13 @@@@ Connection::initializeInternal()
@


1.6
log
@Update to firefox 51.0.

See https://www.mozilla.org/en-US/firefox/51.0/releasenotes/ and MFSA
2017-01 (https://www.mozilla.org/en-US/security/advisories/mfsa2017-01/)

Remove patch-netwerk_protocol_http_Http2Session_cpp (#1290037)
@
text
@d1 1
a1 1
$OpenBSD: patch-storage_mozStorageConnection_cpp,v 1.5 2016/08/02 17:50:03 landry Exp $
d6 3
a8 3
--- storage/mozStorageConnection.cpp.orig	Mon Nov 14 17:12:26 2016
+++ storage/mozStorageConnection.cpp	Thu Nov 17 08:14:22 2016
@@@@ -747,6 +747,13 @@@@ Connection::initializeInternal()
@


1.5
log
@Update to firefox 48.0.

- See https://www.mozilla.org/en-US/firefox/48.0/releasenotes/
- Fixes MFSA 2016-62->84
- See
  https://blog.mozilla.org/blog/2016/08/02/exciting-improvements-in-firefox-for-desktop-and-android/
for user-facing changes
- Switch CONFIGURE_STYLE to simple as it's really not a gnu script
  anymore..
- Remove gtk 3.20 jumbo patch, most gtk3 issues are either fixed or
  being worked on, and the patch isnt maintainable
- Remove patch-gfx_skia_moz_build, it isn't needed anymore on i386, and
  SSE2 will soon be a hard runtime requirement anyway
- Remove patch-media_libcubeb_src_cubeb_sndio_c, merged upstream (#1153151 & #1153179)
- Remove
  patch-toolkit_components_protobuf_src_google_protobuf_stubs_atomicops_h,
merged upstream (#1192556)
- Note that WebRT was removed
@
text
@d1 1
a1 1
$OpenBSD: patch-storage_mozStorageConnection_cpp,v 1.4 2016/06/08 20:33:02 landry Exp $
d6 3
a8 3
--- storage/mozStorageConnection.cpp.orig	Mon Jun  6 22:14:55 2016
+++ storage/mozStorageConnection.cpp	Wed Jun  8 22:49:21 2016
@@@@ -733,6 +733,13 @@@@ Connection::initializeInternal()
@


1.4
log
@Update patch fuzz. Even if this patch is now useless since we build
against bundled sqlite, let's keep it around for a while in case...
@
text
@d1 1
a1 1
$OpenBSD: patch-storage_mozStorageConnection_cpp,v 1.3 2016/04/27 13:50:27 landry Exp $
d6 3
a8 3
--- storage/mozStorageConnection.cpp.orig	Wed Jun  1 06:11:47 2016
+++ storage/mozStorageConnection.cpp	Wed Jun  8 21:43:09 2016
@@@@ -728,6 +728,13 @@@@ Connection::initializeInternal()
@


1.3
log
@Update to firefox 46.0.

- See https://www.mozilla.org/en-US/firefox/46.0/releasenotes/
- Fixes MFSA 2016-39 -> 48
- Switch to use Gtk3 by default (finally!), following the upstream move
- Add a jumbo patch from Fedora to fix several issues with Gtk 3.20
  (#1234158)
- Leave WebRTC enabled. The code builds, sort-of works, sound support
  is not really there, but this way ppl will dogfood/test it. If you
  encounter issues, go to bugzilla.mozilla.org and get involved with
  upstream.
- If you want to disable WebRTC, just toggle media.peerconnection.enabled
  to false in about:config.
- Stop using systemwide sqlite, build the bundled one instead. Simpler,
  as it often forced us to update sqlite in base...
- Add patch from #1239550 to fix the build in ffvpx
- Backport two cubeb patches from ratchov@@ already commited upstream
  (#1153151 & #1153179)
- Remove the obsolete gstreamer section from README, from Brad (and others)
@
text
@d1 1
a1 1
$OpenBSD: patch-storage_mozStorageConnection_cpp,v 1.2 2016/03/14 20:48:43 landry Exp $
d6 3
a8 3
--- storage/mozStorageConnection.cpp.orig	Thu Mar 10 04:02:24 2016
+++ storage/mozStorageConnection.cpp	Mon Mar 14 22:59:55 2016
@@@@ -744,6 +744,13 @@@@ Connection::initializeInternal()
@


1.2
log
@Update to firefox 45.0.

- See https://www.mozilla.org/en-US/firefox/45.0/releasenotes/
- Fixes MFSA 2016-16->38
- libmozgnome was removed upstream
- gtk3 is still not enabled by default upstream
- Remove dependency on gstreamer1, ffmpeg/libavcodec is opened on the fly
if available, as tested by naddy@@

Sidenote: no, i havent looked at i386/llvm breakage yet. i386 is the new vax.
@
text
@d1 1
a1 1
$OpenBSD: patch-storage_mozStorageConnection_cpp,v 1.1 2015/09/24 20:21:15 landry Exp $
d6 3
a8 3
--- storage/mozStorageConnection.cpp.orig	Mon Feb  1 23:40:47 2016
+++ storage/mozStorageConnection.cpp	Tue Feb  2 09:28:55 2016
@@@@ -743,6 +743,13 @@@@ Connection::initializeInternal()
@


1.1
log
@Update to firefox 41.0.

- See https://www.mozilla.org/en-US/firefox/41.0/releasenotes/
- Fixes MFSA 2015-96->114
- Add patch to workaround build failure on 32-bits (#1192556)
- Note that powerpc still fails due to the same issue but a
 hack^Wworkaround hasnt been found yet.

Firefox 42 will probably default to build with Gtk3.
@
text
@d1 1
a1 1
$OpenBSD$
d6 3
a8 3
--- storage/mozStorageConnection.cpp.orig	Thu Aug 20 23:25:02 2015
+++ storage/mozStorageConnection.cpp	Mon Aug 24 09:26:52 2015
@@@@ -785,6 +785,13 @@@@ Connection::initializeInternal()
@

