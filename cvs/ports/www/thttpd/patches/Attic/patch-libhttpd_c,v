head	1.2;
access;
symbols
	OPENBSD_3_3:1.2.0.4
	OPENBSD_3_4:1.2.0.2;
locks; strict;
comment	@# @;


1.2
date	2003.10.27.09.37.21;	author jakob;	state dead;
branches
	1.2.2.1
	1.2.4.1;
next	1.1;

1.1
date	2003.10.05.21.27.21;	author jakob;	state Exp;
branches;
next	;

1.2.2.1
date	2003.11.08.00.39.32;	author margarida;	state Exp;
branches;
next	;

1.2.4.1
date	2003.11.08.00.40.42;	author margarida;	state Exp;
branches;
next	;


desc
@@


1.2
log
@update to thttpd v2.24, mostly small bugfixes
@
text
@$OpenBSD: patch-libhttpd_c,v 1.1 2003/10/05 21:27:21 jakob Exp $
--- libhttpd.c.orig	Mon May 27 03:22:26 2002
+++ libhttpd.c	Sun Oct  5 23:23:21 2003
@@@@ -818,7 +818,7 @@@@ defang( char* str, char* dfstr, int dfsi
     char* cp2;
 
     for ( cp1 = str, cp2 = dfstr;
-	  *cp1 != '\0' && cp2 - dfstr < dfsize - 1;
+	  *cp1 != '\0' && cp2 - dfstr < dfsize - 5;
 	  ++cp1, ++cp2 )
 	{
 	switch ( *cp1 )
@


1.2.4.1
log
@SECURITY fixes:
-- It has been discovered that if thttpd is used for virtual
hosting, and an attacker supplies a specially crafted ``Host:''
header with a pathname instead of a hostname, thttpd will reveal
information about the host system.  Hence, an attacker can browse
the entire disk.
--  thttpd has a remote overflow which allows an attacker to
partially overwrite the EBP register and hencely execute arbitrary
code.
http://www.securityfocus.com/archive/1/342784
http://www.texonet.com/advisories/TEXONET-20030908.txt

Bump package name.
@
text
@d1 3
a3 3
$OpenBSD$
--- libhttpd.c.orig	Mon May 27 02:22:26 2002
+++ libhttpd.c	Fri Nov  7 02:06:57 2003
a12 12
@@@@ -2096,6 +2096,11 @@@@ httpd_parse_request( httpd_conn* hc )
 		cp = strchr( hc->hdrhost, ':' );
 		if ( cp != (char*) 0 )
 		    *cp = '\0';
+ 		if ( strchr( hc->hdrhost, '/' ) != (char*) 0 )
+ 		    {
+ 		    httpd_send_err( hc, 400, httpd_err400title, "", httpd_err400form, "" );
+ 		    return -1;
+ 		    }
 		}
 	    else if ( strncasecmp( buf, "Accept:", 7 ) == 0 )
 		{
@


1.2.2.1
log
@SECURITY fixes:
-- It has been discovered that if thttpd is used for virtual
hosting, and an attacker supplies a specially crafted ``Host:''
header with a pathname instead of a hostname, thttpd will reveal
information about the host system.  Hence, an attacker can browse
the entire disk.
--  thttpd has a remote overflow which allows an attacker to
partially overwrite the EBP register and hencely execute arbitrary
code.
http://www.securityfocus.com/archive/1/342784
http://www.texonet.com/advisories/TEXONET-20030908.txt

Bump package name.
@
text
@d1 3
a3 3
$OpenBSD$
--- libhttpd.c.orig	2003-11-06 16:37:31.000000000 -0500
+++ libhttpd.c	2003-11-06 16:39:21.000000000 -0500
a12 12
@@@@ -2096,6 +2096,11 @@@@ httpd_parse_request( httpd_conn* hc )
 		cp = strchr( hc->hdrhost, ':' );
 		if ( cp != (char*) 0 )
 		    *cp = '\0';
+ 		if ( strchr( hc->hdrhost, '/' ) != (char*) 0 )
+ 		    {
+ 		    httpd_send_err( hc, 400, httpd_err400title, "", httpd_err400form, "" );
+ 		    return -1;
+ 		    }
 		}
 	    else if ( strncasecmp( buf, "Accept:", 7 ) == 0 )
 		{
@


1.1
log
@fix buffer overflow; from NetBSD PR#22863 via Gabriel Kihlman
@
text
@d1 1
a1 1
$OpenBSD$
@

