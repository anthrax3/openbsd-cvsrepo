head	1.4;
access;
symbols
	OPENBSD_4_6:1.1.0.2
	OPENBSD_4_6_BASE:1.1;
locks; strict;
comment	@# @;


1.4
date	2011.12.20.22.27.28;	author sthen;	state dead;
branches;
next	1.3;

1.3
date	2011.10.07.20.04.39;	author sthen;	state Exp;
branches;
next	1.2;

1.2
date	2009.10.27.23.02.11;	author sthen;	state dead;
branches;
next	1.1;

1.1
date	2009.06.22.09.28.07;	author sthen;	state Exp;
branches
	1.1.2.1;
next	;

1.1.2.1
date	2009.12.05.22.43.33;	author william;	state dead;
branches;
next	;


desc
@@


1.4
log
@update to lighttpd 1.4.30, from Brad (maintainer).
@
text
@$OpenBSD: patch-src_mod_status_c,v 1.3 2011/10/07 20:04:39 sthen Exp $

Fix mod_status bug: always showed "0/0" in the "Read" column for uploads.

--- src/mod_status.c.orig	Fri Oct  7 00:04:52 2011
+++ src/mod_status.c	Fri Oct  7 00:05:16 2011
@@@@ -487,7 +487,7 @@@@ static handler_t mod_status_handle_server_status_html(
 
 		buffer_append_string_len(b, CONST_STR_LEN("</td><td class=\"int\">"));
 
-		if (con->request.content_length) {
+		if (c->request.content_length) {
 			buffer_append_long(b, c->request_content_queue->bytes_in);
 			buffer_append_string_len(b, CONST_STR_LEN("/"));
 			buffer_append_long(b, c->request.content_length);
@


1.3
log
@Fix mod_status bug: always showed "0/0" in the "Read" column for uploads.
From Brad.
@
text
@d1 1
a1 1
$OpenBSD$
@


1.2
log
@update to 1.4.24, from Brad (maintainer).
@
text
@d1 7
a7 38
$OpenBSD: patch-src_mod_status_c,v 1.1 2009/06/22 09:28:07 sthen Exp $
--- src/mod_status.c.orig	Sun Jun 21 22:03:52 2009
+++ src/mod_status.c	Sun Jun 21 22:08:42 2009
@@@@ -438,7 +438,7 @@@@ static handler_t mod_status_handle_server_status_html(
 
 	buffer_append_string_len(b, CONST_STR_LEN(
 		"<hr />\n<pre><b>legend</b>\n"
-		". = connect, C = close, E = hard error\n"
+		". = connect, C = close, E = hard error, k = keep-alive\n"
 		"r = read, R = read-POST, W = write, h = handle-request\n"
 		"q = request-start,  Q = request-end\n"
 		"s = response-start, S = response-end\n"));
@@@@ -449,8 +449,14 @@@@ static handler_t mod_status_handle_server_status_html(
 
 	for (j = 0; j < srv->conns->used; j++) {
 		connection *c = srv->conns->ptr[j];
-		const char *state = connection_get_short_state(c->state);
+		const char *state;
 
+		if (CON_STATE_READ == c->state && c->request.orig_uri->used > 0) {
+			state = "k";
+		} else {
+			state = connection_get_short_state(c->state);
+		}
+
 		buffer_append_string_len(b, state, 1);
 
 		if (((j + 1) % 50) == 0) {
@@@@ -497,7 +503,11 @@@@ static handler_t mod_status_handle_server_status_html(
 
 		buffer_append_string_len(b, CONST_STR_LEN("</td><td class=\"string\">"));
 
-		buffer_append_string(b, connection_get_state(c->state));
+		if (CON_STATE_READ == c->state && c->request.orig_uri->used > 0) {
+			buffer_append_string_len(b, CONST_STR_LEN("keep-alive"));
+		} else {
+			buffer_append_string(b, connection_get_state(c->state));
+		}
d11 5
@


1.1
log
@Add information about keep-alive connections to mod_status.
From upstream repo, via Brad.
@
text
@d1 1
a1 1
$OpenBSD$
@


1.1.2.1
log
@MFC:

lighttpd-1.4.25

bugfix / stability update

requested by Brad, MAINTAINER

ok Brad, jasper@@
@
text
@d1 1
a1 1
$OpenBSD: patch-src_mod_status_c,v 1.1 2009/06/22 09:28:07 sthen Exp $
@


