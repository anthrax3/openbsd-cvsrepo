head	1.3;
access;
symbols
	OPENBSD_6_2:1.3.0.4
	OPENBSD_6_2_BASE:1.3
	OPENBSD_6_1:1.3.0.2
	OPENBSD_6_1_BASE:1.3;
locks; strict;
comment	@# @;


1.3
date	2017.02.12.11.19.46;	author ajacoutot;	state Exp;
branches;
next	1.2;
commitid	kTfJxyr6KIR4Mqh2;

1.2
date	2010.08.23.22.44.10;	author sthen;	state dead;
branches;
next	1.1;

1.1
date	2010.08.18.11.16.55;	author sthen;	state Exp;
branches;
next	;


desc
@@


1.3
log
@Use level-triggered kqueue(). https://redmine.lighttpd.net/issues/2788

from brad (maintainer)
@
text
@$OpenBSD$

Use level-triggered kqueue(). https://redmine.lighttpd.net/issues/2788

--- src/fdevent_freebsd_kqueue.c.orig	Sat Feb 11 13:12:42 2017
+++ src/fdevent_freebsd_kqueue.c	Sat Feb 11 13:13:31 2017
@@@@ -75,14 +75,14 @@@@ static int fdevent_freebsd_kqueue_event_set(fdevents *
 	if (events == oevents) return fd;
 
 	if (addevents & FDEVENT_IN)  {
-		EV_SET(&kev[n], fd, EVFILT_READ, EV_ADD|EV_CLEAR, 0, 0, NULL);
+		EV_SET(&kev[n], fd, EVFILT_READ, EV_ADD, 0, 0, NULL);
 		n++;
 	} else if (delevents & FDEVENT_IN) {
 		EV_SET(&kev[n], fd, EVFILT_READ, EV_DELETE, 0, 0, NULL);
 		n++;
 	}
 	if (addevents & FDEVENT_OUT)  {
-		EV_SET(&kev[n], fd, EVFILT_WRITE, EV_ADD|EV_CLEAR, 0, 0, NULL);
+		EV_SET(&kev[n], fd, EVFILT_WRITE, EV_ADD, 0, 0, NULL);
 		n++;
 	} else if (delevents & FDEVENT_OUT) {
 		EV_SET(&kev[n], fd, EVFILT_WRITE, EV_DELETE, 0, 0, NULL);
@


1.2
log
@update lighttpd to 1.4.28 (a couple of small changes only); from Brad.
@
text
@d1 8
a8 6
$OpenBSD: patch-src_fdevent_freebsd_kqueue_c,v 1.1 2010/08/18 11:16:55 sthen Exp $
--- src/fdevent_freebsd_kqueue.c.orig	Sun Aug 15 22:23:45 2010
+++ src/fdevent_freebsd_kqueue.c	Sun Aug 15 22:24:59 2010
@@@@ -39,12 +39,15 @@@@ static int fdevent_freebsd_kqueue_event_del(fdevents *
 		NULL, 0,
 		&ts);
d10 7
a16 7
+	/* Ignore errors for now, as we remove for READ and WRITE without knowing what was registered */
+#if 0
 	if (ret == -1) {
 		log_error_write(ev->srv, __FILE__, __LINE__, "SS",
 			"kqueue event delete failed: ", strerror(errno));
 
 		return -1;
d18 6
a23 4
+#endif
 
 	return -1;
 }
@


1.1
log
@lighttpd 1.4.27; various fixes/cleanup. From Brad, small conf tweak from me.
@
text
@d1 1
a1 1
$OpenBSD$
@

