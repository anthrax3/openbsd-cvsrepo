head	1.22;
access;
symbols
	OPENBSD_5_8:1.20.0.4
	OPENBSD_5_8_BASE:1.20
	OPENBSD_5_7:1.19.0.2
	OPENBSD_5_7_BASE:1.19
	OPENBSD_5_6:1.18.0.4
	OPENBSD_5_6_BASE:1.18
	OPENBSD_5_5:1.18.0.2
	OPENBSD_5_5_BASE:1.18
	OPENBSD_5_4:1.15.0.2
	OPENBSD_5_4_BASE:1.15
	OPENBSD_5_3:1.13.0.2
	OPENBSD_5_3_BASE:1.13
	OPENBSD_5_2:1.9.0.2
	OPENBSD_5_2_BASE:1.9
	OPENBSD_5_1_BASE:1.5
	OPENBSD_5_1:1.5.0.2
	OPENBSD_5_0:1.2.0.2
	OPENBSD_5_0_BASE:1.2
	OPENBSD_4_9:1.1.0.2
	OPENBSD_4_9_BASE:1.1;
locks; strict;
comment	@# @;


1.22
date	2015.09.28.09.30.39;	author landry;	state dead;
branches;
next	1.21;
commitid	9TyLRwkD7ZhnhGgh;

1.21
date	2015.09.19.13.03.15;	author landry;	state Exp;
branches;
next	1.20;
commitid	7O8kHDziPyi0MQXe;

1.20
date	2015.03.16.20.00.29;	author landry;	state Exp;
branches;
next	1.19;
commitid	71CpytinYZAgGe5d;

1.19
date	2014.09.09.21.27.17;	author landry;	state Exp;
branches;
next	1.18;
commitid	QBOfzQIodOXPY6Bg;

1.18
date	2013.12.12.19.58.39;	author landry;	state Exp;
branches;
next	1.17;

1.17
date	2013.10.31.08.01.32;	author landry;	state Exp;
branches;
next	1.16;

1.16
date	2013.08.08.07.02.38;	author landry;	state Exp;
branches;
next	1.15;

1.15
date	2013.07.11.16.23.39;	author landry;	state Exp;
branches;
next	1.14;

1.14
date	2013.04.06.14.48.10;	author landry;	state Exp;
branches;
next	1.13;

1.13
date	2013.01.11.23.17.32;	author landry;	state Exp;
branches;
next	1.12;

1.12
date	2012.11.24.10.36.20;	author landry;	state Exp;
branches;
next	1.11;

1.11
date	2012.10.10.21.03.40;	author landry;	state Exp;
branches;
next	1.10;

1.10
date	2012.09.01.14.10.03;	author landry;	state Exp;
branches;
next	1.9;

1.9
date	2012.06.11.15.38.33;	author landry;	state Exp;
branches;
next	1.8;

1.8
date	2012.04.30.15.38.09;	author landry;	state Exp;
branches;
next	1.7;

1.7
date	2012.03.16.21.38.33;	author landry;	state Exp;
branches;
next	1.6;

1.6
date	2012.02.20.20.20.00;	author landry;	state Exp;
branches;
next	1.5;

1.5
date	2011.12.08.00.39.18;	author nigel;	state Exp;
branches;
next	1.4;

1.4
date	2011.10.03.21.07.39;	author landry;	state Exp;
branches;
next	1.3;

1.3
date	2011.08.23.20.25.25;	author landry;	state Exp;
branches;
next	1.2;

1.2
date	2011.07.24.07.31.57;	author landry;	state Exp;
branches;
next	1.1;

1.1
date	2011.01.14.22.56.11;	author landry;	state Exp;
branches;
next	;


desc
@@


1.22
log
@Update to seamonkey 2.38 & lightning-seamonkey 4.3, chasing firefox 41.

- See http://www.seamonkey-project.org/releases/seamonkey2.38/
- Lotsa MFSA fixed since 2.35, refer to the firefox list
- shuffle patches moving around and add i386 fix
@
text
@$OpenBSD: patch-mozilla_storage_src_mozStorageConnection_cpp,v 1.21 2015/09/19 13:03:15 landry Exp $
force the use of secure_delete instead of using internal sqlite copy
--- mozilla/storage/src/mozStorageConnection.cpp.orig	Wed Sep  2 11:27:15 2015
+++ mozilla/storage/src/mozStorageConnection.cpp	Fri Sep 18 22:11:54 2015
@@@@ -713,6 +713,13 @@@@ Connection::initializeInternal(nsIFile* aDatabaseFile)
     return convertResultCode(srv);
   }
 
+  srv = ::sqlite3_exec(mDBConn, "PRAGMA secure_delete = ON", NULL, NULL, NULL);
+  if (srv != SQLITE_OK) {
+    ::sqlite3_close(mDBConn);
+    mDBConn = nullptr;
+    return convertResultCode(srv);
+  }
+
   // Set the synchronous PRAGMA, according to the preference.
   switch (Service::getSynchronousPref()) {
     case 2:
@


1.21
log
@Update to seamonkey 2.35 / lightning-seamonkey 4.0.

- See http://www.seamonkey-project.org/releases/seamonkey2.35/
- Now uses Gecko 38 as firefox-esr. Note that 2.38 is in beta..
@
text
@d1 1
a1 1
$OpenBSD: patch-mozilla_storage_src_mozStorageConnection_cpp,v 1.20 2015/03/16 20:00:29 landry Exp $
@


1.20
log
@Update to seamonkey 2.33 / lightning-seamonkey 3.8.

- See http://www.seamonkey-project.org/releases/seamonkey2.33/
- Fixes MFSA 2015-11->27
- widget code moved, move nsPrintSettingsImpl.cpp patch around
@
text
@d1 1
a1 1
$OpenBSD: patch-mozilla_storage_src_mozStorageConnection_cpp,v 1.19 2014/09/09 21:27:17 landry Exp $
d3 3
a5 3
--- mozilla/storage/src/mozStorageConnection.cpp.orig	Mon Mar  9 06:34:18 2015
+++ mozilla/storage/src/mozStorageConnection.cpp	Mon Mar  9 19:59:03 2015
@@@@ -700,6 +700,13 @@@@ Connection::initializeInternal(nsIFile* aDatabaseFile)
@


1.19
log
@(Long awaited) update to seamonkey 2.29 / lightning 3.4.

- See http://www.seamonkey-project.org/releases/seamonkey2.29/
- this is based on gecko 32, so contains all the new changes since gecko
  20 (which was the basis for seamonkey 2.26)
- remove patches to fix lightning display (merged in #1001985)
- remove mozilla/browser/components/certerror/content/aboutCertError.xhtml,
boring patch.
- add intl/icu patch from #990196
- remove
  patch-mozilla_toolkit_components_downloads_nsDownloadManager_cpp and
patch-mozilla_xpcom_io_SpecialSystemDirectory_cpp, they neved made any
sense to me and this is the wrong place to modify this.
@
text
@d1 1
a1 1
$OpenBSD: patch-mozilla_storage_src_mozStorageConnection_cpp,v 1.18 2013/12/12 19:58:39 landry Exp $
d3 3
a5 3
--- mozilla/storage/src/mozStorageConnection.cpp.orig	Fri Sep  5 07:37:07 2014
+++ mozilla/storage/src/mozStorageConnection.cpp	Mon Sep  8 20:34:50 2014
@@@@ -696,6 +696,13 @@@@ Connection::initializeInternal(nsIFile* aDatabaseFile)
@


1.18
log
@Update to seamonkey 2.23.

- See http://www.seamonkey-project.org/releases/seamonkey2.23/
- Fixes MFSA-2013-104 -> 117 (all but 105, in fact)
- remove patch-ipc_chromium_src_base_dir_reader_bsd_h (#909005),
  the getdents() patch has been merged upstream.
- temporarly add a config/config.mk patch to reinstate XPIDL_LINK,
  fallout from http://hg.mozilla.org/releases/comm-release/rev/a6ab55f00e21
  (this is needed for enigmail to build fine.)
@
text
@d1 1
a1 1
$OpenBSD: patch-mozilla_storage_src_mozStorageConnection_cpp,v 1.17 2013/10/31 08:01:32 landry Exp $
d3 3
a5 3
--- mozilla/storage/src/mozStorageConnection.cpp.orig	Sat Dec  7 16:13:21 2013
+++ mozilla/storage/src/mozStorageConnection.cpp	Sun Dec  8 11:09:52 2013
@@@@ -677,6 +677,13 @@@@ Connection::initializeInternal(nsIFile* aDatabaseFile)
@


1.17
log
@Update to seamonkey 2.22/lightning 2.7b1/enigmail 1.6.

- see http://www.seamonkey-project.org/releases/seamonkey2.22/
- fixes MFSA 2013-93 -> 102 (99 didnt affect SM)
- add gstreamer patch from #927898
- remove genxpi enigmail patch, merged upstream
@
text
@d1 1
a1 1
$OpenBSD: patch-mozilla_storage_src_mozStorageConnection_cpp,v 1.16 2013/08/08 07:02:38 landry Exp $
d3 3
a5 3
--- mozilla/storage/src/mozStorageConnection.cpp.orig	Thu Oct 17 05:48:40 2013
+++ mozilla/storage/src/mozStorageConnection.cpp	Thu Oct 17 13:27:08 2013
@@@@ -687,6 +687,13 @@@@ Connection::initializeInternal(nsIFile* aDatabaseFile)
@


1.16
log
@Update to seamonkey 2.20 / lightning 2.5b1

- see http://www.seamonkey-project.org/releases/seamonkey2.20/
- fixes MFSA-2013-63->75 (all but 66, 71 & 74, rly)
- use disable-debug-symbols on ppc too :(
- fix enigmail RDEP to depend on -main, otherwise it can be installed
  without sm, and this doesnt make much sense..
@
text
@d1 1
a1 1
$OpenBSD: patch-mozilla_storage_src_mozStorageConnection_cpp,v 1.15 2013/07/11 16:23:39 landry Exp $
d3 3
a5 3
--- mozilla/storage/src/mozStorageConnection.cpp.orig	Mon Jul  8 09:48:33 2013
+++ mozilla/storage/src/mozStorageConnection.cpp	Fri Jul 12 19:28:52 2013
@@@@ -602,6 +602,13 @@@@ Connection::initializeInternal(nsIFile* aDatabaseFile)
@


1.15
log
@Update to seamonkey 2.19 / enigmail 1.5.2 / lightning 2.4b1.

- See http://www.seamonkey-project.org/releases/seamonkey2.19/
- Fixes more or less the same list of MFSA fixed in ffx 22
- Finally back on track after missing 2.18 due to build infra issues
- Add a patch to workaround #886095 (which puzzled me for 3 weeks)
- remove no longer needed sydneyaudio patches
- add TERM=xterm hack to workaround mozbuild issue
- reenable clang on i386, using --disable-debug-symbols
- sync patch-mozilla_gfx_thebes_gfxPlatform_cpp which the one from ffx
@
text
@d1 1
a1 1
$OpenBSD: patch-mozilla_storage_src_mozStorageConnection_cpp,v 1.14 2013/04/06 14:48:10 landry Exp $
d3 3
a5 3
--- mozilla/storage/src/mozStorageConnection.cpp.orig	Thu Jun 20 06:35:20 2013
+++ mozilla/storage/src/mozStorageConnection.cpp	Sat Jun 22 14:43:04 2013
@@@@ -601,6 +601,13 @@@@ Connection::initializeInternal(nsIFile* aDatabaseFile)
@


1.14
log
@Update to seamonkey 2.17.

- See http://www.seamonkey-project.org/releases/seamonkey2.17/
- Fixes MFSA 2013-30->40
- switch back to use clang on i386, now that llvm got fixed there
- backport libffi i386 fix (TODO: switch to systemwide libffi if possible)
- nicer fix to avoid installing the sdk lib/headers
@
text
@d1 1
a1 1
$OpenBSD: patch-mozilla_storage_src_mozStorageConnection_cpp,v 1.13 2013/01/11 23:17:32 landry Exp $
d3 3
a5 3
--- mozilla/storage/src/mozStorageConnection.cpp.orig	Mon Feb 25 03:47:09 2013
+++ mozilla/storage/src/mozStorageConnection.cpp	Sat Mar  9 20:30:22 2013
@@@@ -617,6 +617,13 @@@@ Connection::initializeInternal(nsIFile* aDatabaseFile)
@


1.13
log
@Update to seamonkey 2.15/enigmail 1.5.0/lightning 2.0beta1

- see http://www.seamonkey-project.org/releases/seamonkey2.15/
- fixes MFSA 2013-01 -> 20
- build with clang on i386/amd64 and with gcc 4.6 on powerpc. Required
since upstream dropped support for gcc < 4.4.
- don't build against systemwide jpeg anymore since it now needs its
internal libjpeg-turbo.
- add a stub method to sydney_audio_sndio.c in post-patch.
- add patch-mozilla_toolkit_mozapps_installer_packager_mk to fix a tar
  vs $(TAR) usage (bug #815793)
- remove patch-ipc_chromium_src_base_atomicops_h, not needed anymore
- remove enigmail genxpi patch, and to a SUBST_VARS dance with an
XPCOM_ABI variable for the consistent naming of the new internal
libsuprocess ipc lib.
- add an enigmail patch to link with -shared
@
text
@d1 1
a1 1
$OpenBSD: patch-mozilla_storage_src_mozStorageConnection_cpp,v 1.12 2012/11/24 10:36:20 landry Exp $
d3 3
a5 3
--- mozilla/storage/src/mozStorageConnection.cpp.orig	Thu Dec 20 05:56:01 2012
+++ mozilla/storage/src/mozStorageConnection.cpp	Wed Jan  2 20:39:30 2013
@@@@ -567,6 +567,13 @@@@ Connection::initialize(nsIFile *aDatabaseFile,
@


1.12
log
@Update to seamonkey 2.14/enigmail 1.4.6/lightning 1.9b1.

- see http://www.seamonkey-project.org/releases/seamonkey2.14/ for details.
- tidy up WANTLIB/CONFIGURE_ARGS
- enable the gio/libnotify interaction. If libnotify is found at
  runtime, a popup will show incoming messages notification/download complete.
- install an icon in pixmaps/ for the desktop file, like in ffx/tb
- fix desktop file Exec line so that an argument can be passed to seamonkey
- remove patch-mozilla_browser_app_profile_firefox_js, this is spar^Wseamonkey!
- for the other patches removed/added, same comments as for ffx apply
@
text
@d1 1
a1 1
$OpenBSD: patch-mozilla_storage_src_mozStorageConnection_cpp,v 1.11 2012/10/10 21:03:40 landry Exp $
d3 3
a5 3
--- mozilla/storage/src/mozStorageConnection.cpp.orig	Sat Oct 20 23:17:03 2012
+++ mozilla/storage/src/mozStorageConnection.cpp	Sun Oct 21 12:22:08 2012
@@@@ -554,6 +554,13 @@@@ Connection::initialize(nsIFile *aDatabaseFile,
@


1.11
log
@Update to seamonkey 2.13/enigmail 1.4.5/lightning 1.8b1.

- see http://www.seamonkey-project.org/releases/seamonkey2.13/ for details
- remove patch-mozilla_build_unix_mozilla_in, useless since bin/seamonkey
is not a script anymore since a while
- remove patch-mozilla_build_unix_run-mozilla_sh, seamonkey can be directly
debugged in gdb now. update README accordingly
- fix plugin path in README
@
text
@d1 1
a1 1
$OpenBSD: patch-mozilla_storage_src_mozStorageConnection_cpp,v 1.10 2012/09/01 14:10:03 landry Exp $
d3 3
a5 3
--- mozilla/storage/src/mozStorageConnection.cpp.orig	Fri Aug 31 07:56:38 2012
+++ mozilla/storage/src/mozStorageConnection.cpp	Sun Sep  2 12:45:42 2012
@@@@ -551,6 +551,13 @@@@ Connection::initialize(nsIFile *aDatabaseFile,
d12 1
a12 1
+    mDBConn = nsnull;
@


1.10
log
@Update to seamonkey 2.12.

- see http://www.seamonkey-project.org/releases/seamonkey2.12/
- garbage collect nsSound.cpp, the original one uses libcanberra
properly and thus sndio.
- remove patch from #750620, merged upstream (mfbt/double-conversion)
- remove patches from #691898, merged upstream (yarr jit ppc)
- remove useless crashreporter patch, we don't have breakpad
@
text
@d1 1
a1 1
$OpenBSD: patch-mozilla_storage_src_mozStorageConnection_cpp,v 1.9 2012/06/11 15:38:33 landry Exp $
d3 3
a5 3
--- mozilla/storage/src/mozStorageConnection.cpp.orig	Mon Aug 27 06:49:30 2012
+++ mozilla/storage/src/mozStorageConnection.cpp	Sat Sep  1 02:00:15 2012
@@@@ -663,6 +663,13 @@@@ Connection::initialize(nsIFile *aDatabaseFile,
@


1.9
log
@Update to seamonkey 2.10.

See http://www.seamonkey-project.org/releases/seamonkey2.10/ for details
- Update lightning to 1.5b1 and enigmail to 1.4.2
- add the rpath hack to workaround #668869
- dont make packaging warnings errors (#763181)
@
text
@d1 1
a1 1
$OpenBSD: patch-mozilla_storage_src_mozStorageConnection_cpp,v 1.9 2012/04/30 15:32:06 landry Exp $
d3 3
a5 3
--- mozilla/storage/src/mozStorageConnection.cpp.orig	Fri May 18 06:11:03 2012
+++ mozilla/storage/src/mozStorageConnection.cpp	Fri May 18 09:27:59 2012
@@@@ -700,6 +700,13 @@@@ Connection::initialize(nsIFile *aDatabaseFile,
@


1.8
log
@Update to seamonkey 2.9.1/lightning 1.4b1/enigmail 1.5pre.

- See http://www.seamonkey-project.org/releases/seamonkey2.9/
- add patch-suite_installer_Makefile_in to avoid installing the SDk
  (corollary of Tb's patch-mail_installer_Makefile_in)
- use MOZ_DEBUG_FLAGS="-Os" on ppc as done in Tb to avoid a
  relocation overflow when linking libxul on ppc (reminded by aja@@)
@
text
@d1 1
a1 1
$OpenBSD: patch-mozilla_storage_src_mozStorageConnection_cpp,v 1.8 2012/03/16 21:35:25 landry Exp $
d3 3
a5 3
--- mozilla/storage/src/mozStorageConnection.cpp.orig	Sat Apr 21 00:40:23 2012
+++ mozilla/storage/src/mozStorageConnection.cpp	Wed Apr 25 17:50:16 2012
@@@@ -701,6 +701,13 @@@@ Connection::initialize(nsIFile *aDatabaseFile,
@


1.7
log
@Update to seamonkey 2.8. (and enigmail 1.4/lightning 1.3b1)
- Fixes MFSA 2012-12->19
- see http://www.seamonkey-project.org/releases/seamonkey2.8/
- complete patchset for #691898, still fixes build on ppc (and hopefully
commited in firefox 14...)
- add patchset from #706955, workarounds #669050 (xpcshell hangs during
make install and chokes on CSPUtils.csm, threads related..)
- remove obsolete/commited patches
@
text
@d1 1
a1 1
$OpenBSD: patch-mozilla_storage_src_mozStorageConnection_cpp,v 1.7 2012/01/11 01:19:43 nigel Exp $
d3 3
a5 3
--- mozilla/storage/src/mozStorageConnection.cpp.orig	Fri Mar  9 21:29:39 2012
+++ mozilla/storage/src/mozStorageConnection.cpp	Sat Mar 10 13:20:27 2012
@@@@ -642,6 +642,13 @@@@ Connection::initialize(nsIFile *aDatabaseFile,
@


1.6
log
@Update to seamonkey 2.7.2.

Same comments as for thunderbird, and remove i18n xpis from the port,
they bring 20Mb to the package without reason and will be better as
no-arch in www/seamonkey-i18n.
@
text
@d3 3
a5 3
--- mozilla/storage/src/mozStorageConnection.cpp.orig	Thu Dec 15 01:22:57 2011
+++ mozilla/storage/src/mozStorageConnection.cpp	Mon Dec 19 22:30:27 2011
@@@@ -593,6 +593,13 @@@@ Connection::initialize(nsIFile *aDatabaseFile,
@


1.5
log
@Update seamonkey 2.4.1 to 2.5, enimail to 1.3.4 and lightning.

Ok mpi@@
@
text
@d1 1
a1 1
$OpenBSD: patch-mozilla_storage_src_mozStorageConnection_cpp,v 1.4 2011/10/03 21:07:39 landry Exp $
d3 3
a5 3
--- mozilla/storage/src/mozStorageConnection.cpp.orig	Mon Nov  7 21:08:24 2011
+++ mozilla/storage/src/mozStorageConnection.cpp	Mon Nov 21 23:10:24 2011
@@@@ -591,6 +591,13 @@@@ Connection::initialize(nsIFile *aDatabaseFile,
@


1.4
log
@Update to seamonkey 2.4.1.
@
text
@d1 1
a1 1
$OpenBSD: patch-mozilla_storage_src_mozStorageConnection_cpp,v 1.3 2011/08/23 20:25:25 landry Exp $
d3 3
a5 3
--- mozilla/storage/src/mozStorageConnection.cpp.orig	Sat Sep 17 03:34:56 2011
+++ mozilla/storage/src/mozStorageConnection.cpp	Mon Sep 19 10:35:58 2011
@@@@ -595,6 +595,13 @@@@ Connection::initialize(nsIFile *aDatabaseFile,
@


1.3
log
@Update to seamonkey 2.3/lightning 1.0b5/enigmail 1.3
See http://www.seamonkey-project.org/releases/seamonkey2.3/.
Remove patches merges upstream, enigmail update lifted from nigel@@'s tb update
@
text
@d1 1
a1 1
$OpenBSD: patch-mozilla_storage_src_mozStorageConnection_cpp,v 1.2 2011/07/24 07:31:57 landry Exp $
d3 3
a5 3
--- mozilla/storage/src/mozStorageConnection.cpp.orig	Mon Aug  1 04:57:47 2011
+++ mozilla/storage/src/mozStorageConnection.cpp	Thu Aug  4 23:24:42 2011
@@@@ -555,6 +555,13 @@@@ Connection::initialize(nsIFile *aDatabaseFile,
@


1.2
log
@Update to seamonkey 2.2, based on Firefox/Thunderbird/Gecko 5.
See http://www.seamonkey-project.org/releases/seamonkey2.2/ for details.
- sync ipc patches from Firefox
- remove a bunch of useless patches
- install under lib/seamonkey-2.2 instead of using our homegrown install
  target.
- install langpacks as plain xpi instead of unzipping them, greatly
  shrinking PLIST
@
text
@d1 1
a1 1
$OpenBSD: patch-mozilla_storage_src_mozStorageConnection_cpp,v 1.2 2011/03/02 14:44:19 landry Exp $
d3 3
a5 3
--- mozilla/storage/src/mozStorageConnection.cpp.orig	Mon Feb 21 12:47:11 2011
+++ mozilla/storage/src/mozStorageConnection.cpp	Wed Mar  2 10:29:08 2011
@@@@ -384,6 +384,13 @@@@ Connection::initialize(nsIFile *aDatabaseFile)
@


1.1
log
@Add same PRAGMA secure_delete patch to seamonkey and ffx35 for the sake
of consistency, and build against systemwide sqlite.
@
text
@d1 7
a7 6
$OpenBSD$
--- mozilla/storage/src/mozStorageConnection.cpp.orig	Tue Nov 23 21:19:55 2010
+++ mozilla/storage/src/mozStorageConnection.cpp	Wed Jan 12 11:09:43 2011
@@@@ -184,6 +184,13 @@@@ mozStorageConnection::Initialize(nsIFile *aDatabaseFil
         return ConvertResultCode(srv);
     }
d9 6
a14 6
+    srv = sqlite3_exec(mDBConn, "PRAGMA secure_delete = ON", NULL, NULL, NULL);
+    if (srv != SQLITE_OK) {
+      sqlite3_close(mDBConn);
+      mDBConn = nsnull;
+      return ConvertResultCode(srv);
+    }
d16 3
a18 3
     // Set the synchronous PRAGMA, according to the pref
     nsCOMPtr<nsIPrefBranch> pref(do_GetService(NS_PREFSERVICE_CONTRACTID));
     PRInt32 synchronous = 1; // Default to NORMAL if pref not set
@

