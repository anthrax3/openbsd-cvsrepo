head	1.3;
access;
symbols;
locks; strict;
comment	@# @;


1.3
date	2013.12.12.19.58.39;	author landry;	state dead;
branches;
next	1.2;

1.2
date	2013.08.16.10.26.02;	author sthen;	state Exp;
branches;
next	1.1;

1.1
date	2013.08.15.10.42.51;	author sthen;	state Exp;
branches;
next	;


desc
@@


1.3
log
@Update to seamonkey 2.23.

- See http://www.seamonkey-project.org/releases/seamonkey2.23/
- Fixes MFSA-2013-104 -> 117 (all but 105, in fact)
- remove patch-ipc_chromium_src_base_dir_reader_bsd_h (#909005),
  the getdents() patch has been merged upstream.
- temporarly add a config/config.mk patch to reinstate XPIDL_LINK,
  fallout from http://hg.mozilla.org/releases/comm-release/rev/a6ab55f00e21
  (this is needed for enigmail to build fine.)
@
text
@$OpenBSD: patch-mozilla_ipc_chromium_src_base_dir_reader_bsd_h,v 1.2 2013/08/16 10:26:02 sthen Exp $
--- mozilla/ipc/chromium/src/base/dir_reader_bsd.h.orig	Sat Aug  3 21:05:29 2013
+++ mozilla/ipc/chromium/src/base/dir_reader_bsd.h	Wed Aug 14 15:48:59 2013
@@@@ -59,19 +59,11 @@@@ class DirReaderBSD {
     if (offset_ != size_)
       return true;
 
-#ifdef OS_OPENBSD
-    const int r = getdirentries(fd_, buf_, sizeof(buf_), basep_);
-#else
     const int r = getdents(fd_, buf_, sizeof(buf_));
-#endif
     if (r == 0)
       return false;
     if (r == -1) {
-#ifdef OS_OPENBSD
-      DLOG(ERROR) << "getdirentries returned an error: " << errno;
-#else
       DLOG(ERROR) << "getdents returned an error: " << errno;
-#endif
       return false;
     }
     size_ = r;
@@@@ -99,9 +91,6 @@@@ class DirReaderBSD {
  private:
   const int fd_;
   char buf_[512];
-#ifdef OS_OPENBSD
-  off_t *basep_;
-#endif
   size_t offset_, size_;
 
   DISALLOW_COPY_AND_ASSIGN(DirReaderBSD);
@


1.2
log
@remove interim prototype for getdents() now that it's in base
@
text
@d1 1
a1 1
$OpenBSD: patch-mozilla_ipc_chromium_src_base_dir_reader_bsd_h,v 1.1 2013/08/15 10:42:51 sthen Exp $
@


1.1
log
@fix firefox/seamonkey build on post-flag-day -current:

- use getdents(2) now that we have it; previously OpenBSD was special-cased
to use getdirentries(2) instead.

- interim fix: declare getdents() to allow firefox/seamonkey to build on
-current until consensus has been reached on return types/adding to system
headers.

discussed with landry@@, clues from guenther@@.
@
text
@d1 1
a1 1
$OpenBSD$
d4 1
a4 16
@@@@ -14,6 +14,14 @@@@
 #include <stdint.h>
 #include <unistd.h>
 
+#ifdef __cplusplus
+extern "C" {
+#endif
+    int getdents(int, void *, unsigned long);
+#ifdef __cplusplus
+}
+#endif
+
 #include "base/logging.h"
 #include "base/eintr_wrapper.h"
 
@@@@ -59,19 +67,11 @@@@ class DirReaderBSD {
d24 1
a24 1
@@@@ -99,9 +99,6 @@@@ class DirReaderBSD {
@

