head	1.7;
access;
symbols
	OPENBSD_6_0:1.7.0.6
	OPENBSD_6_0_BASE:1.7
	OPENBSD_5_9:1.7.0.2
	OPENBSD_5_9_BASE:1.7
	OPENBSD_5_8:1.7.0.4
	OPENBSD_5_8_BASE:1.7
	OPENBSD_5_7:1.6.0.2
	OPENBSD_5_7_BASE:1.6
	OPENBSD_5_6:1.4.0.2
	OPENBSD_5_6_BASE:1.4
	OPENBSD_5_5:1.3.0.2
	OPENBSD_5_5_BASE:1.3
	OPENBSD_5_4:1.1.0.2
	OPENBSD_5_4_BASE:1.1;
locks; strict;
comment	@# @;


1.7
date	2015.05.20.15.32.54;	author ajacoutot;	state Exp;
branches;
next	1.6;
commitid	xJOF76FfGW7vXv8h;

1.6
date	2015.01.10.00.38.39;	author ajacoutot;	state Exp;
branches;
next	1.5;
commitid	6GNZjB621kuzFsEK;

1.5
date	2014.08.26.21.31.03;	author ajacoutot;	state Exp;
branches;
next	1.4;
commitid	AvZQls8sW8IRAp8T;

1.4
date	2014.03.25.06.25.45;	author landry;	state Exp;
branches
	1.4.2.1;
next	1.3;

1.3
date	2013.11.14.16.47.00;	author ajacoutot;	state Exp;
branches;
next	1.2;

1.2
date	2013.10.06.14.03.44;	author landry;	state Exp;
branches;
next	1.1;

1.1
date	2013.04.13.09.11.02;	author landry;	state Exp;
branches;
next	;

1.4.2.1
date	2015.01.12.13.21.59;	author ajacoutot;	state Exp;
branches;
next	;
commitid	XKidCOC6ZDYP6zNT;


desc
@@


1.7
log
@Update to webkit-2.4.9.
@
text
@$OpenBSD: patch-Source_WTF_wtf_Platform_h,v 1.6 2015/01/10 00:38:39 ajacoutot Exp $

https://bugs.webkit.org/show_bug.cgi?id=113638
https://bugs.webkit.org/show_bug.cgi?id=129839
https://bugs.webkit.org/show_bug.cgi?id=126502
https://bugs.webkit.org/show_bug.cgi?id=128898
https://bugs.webkit.org/show_bug.cgi?id=128549
https://bugs.webkit.org/show_bug.cgi?id=129963

http://trac.webkit.org/changeset/164220

sparc defines/code was removed upstream in:
http://trac.webkit.org/changeset/159817

last chunk needed to build on ppc/sparc64, otherwise yarr jit and
assembler is enabled (because of llint cloop) but there's no asm
for those

--- Source/WTF/wtf/Platform.h.orig	Wed May 20 11:03:24 2015
+++ Source/WTF/wtf/Platform.h	Wed May 20 15:23:50 2015
@@@@ -71,6 +71,12 @@@@
 #define WTF_CPU_BIG_ENDIAN 1
 #endif
 
+/* CPU(SPARC64) - Sun Sparc64 */
+#if defined(__sparc64__)
+#define WTF_CPU_SPARC64 1
+#define WTF_CPU_BIG_ENDIAN 1
+#endif
+
 /* CPU(IA64) - Itanium / IA-64 */
 #if defined(__ia64__)
 #define WTF_CPU_IA64 1
@@@@ -330,7 +336,7 @@@@
 
 #endif /* ARM */
 
-#if CPU(ARM) || CPU(MIPS) || CPU(SH4)
+#if CPU(ARM) || CPU(MIPS) || CPU(SH4) || CPU(SPARC64)
 #define WTF_CPU_NEEDS_ALIGNED_ACCESS 1
 #endif
 
@@@@ -658,7 +664,8 @@@@
     || CPU(S390X) \
     || CPU(MIPS64) \
     || CPU(PPC64) \
-    || CPU(PPC64LE)
+    || CPU(PPC64LE) \
+    || CPU(SPARC64)
 #define WTF_USE_JSVALUE64 1
 #else
 #define WTF_USE_JSVALUE32_64 1
@@@@ -725,7 +732,7 @@@@
    low-level interpreter. */
 #if !defined(ENABLE_LLINT) \
     && ENABLE(JIT) \
-    && (OS(DARWIN) || OS(LINUX) || OS(FREEBSD) || OS(HURD)) \
+    && (OS(DARWIN) || OS(LINUX) || OS(FREEBSD) || OS(OPENBSD) || OS(HURD)) \
     && (PLATFORM(MAC) || PLATFORM(IOS) || PLATFORM(GTK)) \
     && (CPU(X86) || CPU(X86_64) || CPU(ARM_THUMB2) || CPU(ARM_TRADITIONAL) || CPU(ARM64) || CPU(MIPS) || CPU(SH4))
 #define ENABLE_LLINT 1
@@@@ -733,7 +740,7 @@@@
 
 #if !defined(ENABLE_DFG_JIT) && ENABLE(JIT) && !COMPILER(MSVC)
 /* Enable the DFG JIT on X86 and X86_64. */
-#if (CPU(X86) || CPU(X86_64)) && (OS(DARWIN) || OS(LINUX) || OS(FREEBSD) || OS(HURD))
+#if (CPU(X86) || CPU(X86_64)) && (OS(DARWIN) || OS(LINUX) || OS(FREEBSD) || OS(OPENBSD) || OS(HURD))
 #define ENABLE_DFG_JIT 1
 #endif
 /* Enable the DFG JIT on ARMv7.  Only tested on iOS and Qt/GTK+ Linux. */
@@@@ -824,7 +831,7 @@@@
 #define ENABLE_REGEXP_TRACING 0
 
 /* Yet Another Regex Runtime - turned on by default for JIT enabled ports. */
-#if !defined(ENABLE_YARR_JIT) && (ENABLE(JIT) || ENABLE(LLINT_C_LOOP))
+#if !defined(ENABLE_YARR_JIT) && ENABLE(JIT)
 #define ENABLE_YARR_JIT 1
 
 /* Setting this flag compares JIT results with interpreter results. */
@


1.6
log
@Update to webkit-2.4.8.
@
text
@d1 1
a1 1
$OpenBSD: patch-Source_WTF_wtf_Platform_h,v 1.5 2014/08/26 21:31:03 ajacoutot Exp $
a2 2
Add defines for sparc64/mips64.
Disable yarr jit on anything not having a jit
a4 5

sparc defines/code was removed upstream in 
http://trac.webkit.org/changeset/159817

chunk 4
d6 3
a9 1
chunk 5
a10 2
https://bugs.webkit.org/show_bug.cgi?id=128898
(also check https://bugs.webkit.org/show_bug.cgi?id=128549)
d12 2
a13 1
https://bugs.webkit.org/show_bug.cgi?id=129963 for dfg_jit/llint
d19 2
a20 2
--- Source/WTF/wtf/Platform.h.orig	Wed Jan  7 10:45:42 2015
+++ Source/WTF/wtf/Platform.h	Fri Jan  9 18:32:23 2015
d34 1
a34 18
@@@@ -82,9 +88,14 @@@@
 
 /* CPU(MIPS) - MIPS 32-bit */
 /* Note: Only O32 ABI is tested, so we enable it for O32 ABI for now.  */
-#if (defined(mips) || defined(__mips__) || defined(MIPS) || defined(_MIPS_)) \
-    && defined(_ABIO32)
+#if (defined(mips) || defined(__mips__) || defined(MIPS) || defined(_MIPS_) || defined(__mips64__))
+#if defined(_ABIO32)
 #define WTF_CPU_MIPS 1
+#endif
+#if defined(__mips64__)
+#define	WTF_CPU_MIPS64	1
+#define	USE_SYSTEM_MALLOC 1
+#endif
 #if defined(__MIPSEB__)
 #define WTF_CPU_BIG_ENDIAN 1
 #endif
@@@@ -327,7 +338,7 @@@@
d39 1
a39 1
+#if CPU(ARM) || CPU(MIPS) || CPU(SH4) || CPU(MIPS64) || CPU(SPARC64)
d43 1
a43 2
@@@@ -656,7 +667,9 @@@@
     || CPU(ARM64) \
d45 1
d49 1
a49 2
+    || CPU(SPARC64) \
+    || CPU(MIPS64)
d53 1
a53 1
@@@@ -723,7 +736,7 @@@@
d62 1
a62 1
@@@@ -731,7 +744,7 @@@@
d71 1
a71 1
@@@@ -822,7 +835,7 @@@@
@


1.5
log
@Update to webkit-2.4.5.

ok landry@@
@
text
@d1 1
a1 1
$OpenBSD: patch-Source_WTF_wtf_Platform_h,v 1.4 2014/03/25 06:25:45 landry Exp $
d25 2
a26 2
--- Source/WTF/wtf/Platform.h.orig	Mon Aug 25 14:50:32 2014
+++ Source/WTF/wtf/Platform.h	Tue Aug 26 13:55:22 2014
d81 2
a82 2
-    && (OS(DARWIN) || OS(LINUX) || OS(FREEBSD)) \
+    && (OS(DARWIN) || OS(LINUX) || OS(FREEBSD) || OS(OPENBSD)) \
d89 3
a91 3
 /* Enable the DFG JIT on X86 and X86_64.  Only tested on Mac, GNU/Linux and FreeBSD. */
-#if (CPU(X86) || CPU(X86_64)) && (OS(DARWIN) || OS(LINUX) || OS(FREEBSD))
+#if (CPU(X86) || CPU(X86_64)) && (OS(DARWIN) || OS(LINUX) || OS(FREEBSD) || OS(OPENBSD))
@


1.4
log
@Update to webkit 2.4.0.

See http://webkitgtk.org/2014/03/24/webkitgtk2.4.0-released.html. Note
that Webkit2 API is still broken, on OpenBSD(and FreeBSD) and this might
be the last release shipping the Webkit1 API.
Pass -DLOG_DISABLED=0 to CPPFLAGS to somewhat allow debugging.
Use the same ruby version on sparc64 as other archs now that they're
more reliable.

Remove some patches merged upstream, and add links to upstream bz for
most of the remaining patches.

Note: this needs gnu/usr.bin/binutils/include/opcode/i386.h r1.15 to
build. And gcc 4.8 (and python, ruby & perl :)
Built numerous times on amd64/ppc/sparc64 (broken at runtime on the last
two, but that's not a regression from 2.2..) and went in a bunch of
bulks.
@
text
@d1 1
a1 1
$OpenBSD: patch-Source_WTF_wtf_Platform_h,v 1.3 2013/11/14 16:47:00 ajacoutot Exp $
d25 2
a26 2
--- Source/WTF/wtf/Platform.h.orig	Mon Mar  3 09:11:49 2014
+++ Source/WTF/wtf/Platform.h	Sat Mar  8 22:59:04 2014
d57 1
a57 1
@@@@ -313,7 +324,7 @@@@
d66 1
a66 2
@@@@ -641,6 +652,8 @@@@
     || CPU(ALPHA) \
d69 3
d73 1
a73 2
+    || CPU(MIPS64) \
     || CPU(PPC64)
d76 2
a77 1
@@@@ -708,7 +721,7 @@@@
d86 1
a86 1
@@@@ -716,7 +729,7 @@@@
d95 1
a95 1
@@@@ -807,7 +820,7 @@@@
@


1.4.2.1
log
@SECURITY update to webkit-2.4.8v1.
CVE-2014-1344, CVE-2014-1384, CVE-2014-1385, CVE-2014-1386, CVE-2014-1387,
CVE-2014-1388, CVE-2014-1389, CVE-2014-1390.
@
text
@d1 1
a1 1
$OpenBSD: patch-Source_WTF_wtf_Platform_h,v 1.4 2014/03/25 06:25:45 landry Exp $
d25 2
a26 2
--- Source/WTF/wtf/Platform.h.orig	Wed Jan  7 10:45:42 2015
+++ Source/WTF/wtf/Platform.h	Mon Jan 12 10:46:59 2015
d57 1
a57 1
@@@@ -327,7 +338,7 @@@@
d66 1
a66 1
@@@@ -655,6 +666,8 @@@@
d72 1
a72 2
     || CPU(PPC64) \
     || CPU(PPC64LE)
d74 2
a75 1
@@@@ -723,7 +736,7 @@@@
d79 1
a79 1
-    && (OS(DARWIN) || OS(LINUX) || OS(FREEBSD) || OS(HURD)) \
d84 1
a84 1
@@@@ -731,7 +744,7 @@@@
d87 3
a89 3
 /* Enable the DFG JIT on X86 and X86_64. */
-#if (CPU(X86) || CPU(X86_64)) && (OS(DARWIN) || OS(LINUX) || OS(FREEBSD) || OS(HURD))
+#if (CPU(X86) || CPU(X86_64)) && (OS(DARWIN) || OS(LINUX) || OS(FREEBSD) || OS(OPENBSD) || OS(HURD))
d93 1
a93 1
@@@@ -822,7 +835,7 @@@@
@


1.3
log
@Update to webkit-2.2.2.

ok landry@@
@
text
@d1 1
a1 1
$OpenBSD: patch-Source_WTF_wtf_Platform_h,v 1.2 2013/10/06 14:03:44 landry Exp $
d3 1
a3 1
Add defines for mips64*/hppa.
d6 1
d8 33
a40 3
--- Source/WTF/wtf/Platform.h.orig	Mon Nov 11 10:21:52 2013
+++ Source/WTF/wtf/Platform.h	Thu Nov 14 09:38:50 2013
@@@@ -83,9 +83,14 @@@@
d57 1
a57 13
@@@@ -125,6 +130,11 @@@@
 #define WTF_CPU_SH4 1
 #endif
 
+/* CPU(HPPA) - HP-PA */
+#if defined(__hppa__)
+#define WTF_CPU_HPPA 1
+#endif
+
 /* CPU(SPARC32) - SPARC 32-bit */
 #if defined(__sparc) && !defined(__arch64__) || defined(__sparcv8)
 #define WTF_CPU_SPARC32 1
@@@@ -323,7 +333,7 @@@@
d61 2
a62 2
-#if CPU(ARM) || CPU(MIPS) || CPU(SH4) || CPU(SPARC)
+#if CPU(ARM) || CPU(MIPS) || CPU(SH4) || CPU(SPARC) || CPU(MIPS64) || CPU(SPARC64)
d66 1
a66 1
@@@@ -689,7 +699,8 @@@@
d68 1
a68 1
     || CPU(SPARC64) \
d70 3
a72 3
-    || CPU(PPC64)
+    || CPU(PPC64) \
+    || CPU(MIPS64)
d75 19
a93 2
 #define WTF_USE_JSVALUE32_64 1
@@@@ -855,7 +866,7 @@@@
d97 2
a98 2
-#if !defined(ENABLE_YARR_JIT) && (ENABLE(JIT) || ENABLE(LLINT_C_LOOP)) && !(OS(QNX) && PLATFORM(QT))
+#if !defined(ENABLE_YARR_JIT) && (ENABLE(JIT)) && !(OS(QNX) && PLATFORM(QT))
a101 9
@@@@ -864,7 +875,7 @@@@
 
 /* If either the JIT or the RegExp JIT is enabled, then the Assembler must be
    enabled as well: */
-#if ENABLE(JIT) || ENABLE(YARR_JIT)
+#if ENABLE(JIT)
 #if defined(ENABLE_ASSEMBLER) && !ENABLE_ASSEMBLER
 #error "Cannot enable the JIT or RegExp JIT without enabling the Assembler"
 #else
@


1.2
log
@Update to webkit 2.2.0.

- Now depends on newer gcc, use 4.6 by default.
- Enable webkit2 api in the gtk3 FLAVOR. Still broken/erratic behaviour at
  runtime, but at least this will allow people to debug it, and it's
  required by newer GNOMEs anyway. Provide MiniBrowser for debugging purposes.
- add hack from bug #118732 to workaround the fact that our binutils
  doesnt support 'ar T'
- update patches from #103128 to tentatively fix powerpc runtime
- force-disable YARR_JIT & ASSEMBLE on archs without JIT (ie anything
  besides i386/amd64) via Platform.h patch instead of JSC_CPPFLAGS (which
  doesnt work anymore anyway)
- add a bunch of patches to fix build (missing includes etc) in the WebKit2
  source tree

Tested in an amd64 bulk build, runtime-tested previous betas on
i386/amd64, test-built on powerpc and sparc64. Things might still be
broken at runtime on powerpc, but at least it allows more GNOME things
to be updated.
@
text
@d1 1
a1 1
$OpenBSD: patch-Source_WTF_wtf_Platform_h,v 1.1 2013/04/13 09:11:02 landry Exp $
d7 3
a9 3
--- Source/WTF/wtf/Platform.h.orig	Fri Sep 20 09:24:34 2013
+++ Source/WTF/wtf/Platform.h	Fri Oct  4 07:56:33 2013
@@@@ -82,9 +82,14 @@@@
d26 1
a26 1
@@@@ -124,6 +129,11 @@@@
d38 1
a38 1
@@@@ -322,7 +332,7 @@@@
d47 1
a47 1
@@@@ -688,7 +698,8 @@@@
d57 1
a57 1
@@@@ -854,7 +865,7 @@@@
d66 1
a66 1
@@@@ -863,7 +874,7 @@@@
@


1.1
log
@Major update to webkit 2.0.0.

- add ruby to BDEPS. Webkit build system now uses autohell, python, ruby and perl \o/
- set MODRUBY_REV = 1.8 on sparc64 since 1.9 is broken there
- disable WebKit2 support, it needs shm_open()/shm_unlink()
- switch from gstreamer-0.10 to gstreamer1
- force-disable JIT/ASSEMBLER on non-jit archs, builds fails otherwise (bug #113638)
- only build NumberPrototype.cpp with -O0 on sparc64, not the damn whole thing
- use -Wl,--relax on ppc otherwise linking fails
- move some patches around since JavaScriptCore/wtf moved to WTF/wtf
- dont uselessly rerun make within make during install, gmake blows
- blindly backport upstream r144077 to fix mips64 build
- backport bits of #103128 & r145551 to fix powerpc build
- backport r147967 & more to fix bashisms in configure
- bug #109932 forced the use of gcc >= 4.7 or clang >= 3.0, but this is
  only for WebKit2 so loosen the check atm

Tested working fine on amd64 & i386, went in bulk builds, known broken
at runtime on ppc (being worked on. or not.) should build on mips64el
(and maybe even run!) and sparc64 (wont run! ever! nothing new here..),
but 'someone' will care about the poor exotic archs and fix'em, right ?

After too much prodding from the gnome maintainers who desperately need it
@
text
@d1 1
a1 1
$OpenBSD$
d3 3
a5 1
Allow webkit to build and run on mips64
d7 3
a9 3
--- Source/WTF/wtf/Platform.h.orig	Tue Mar  5 09:57:37 2013
+++ Source/WTF/wtf/Platform.h	Fri Mar  8 00:57:25 2013
@@@@ -76,9 +76,14 @@@@
d26 1
a26 1
@@@@ -118,6 +123,11 @@@@
d38 1
a38 1
@@@@ -314,7 +324,7 @@@@
d47 1
a47 1
@@@@ -744,7 +754,8 @@@@
d57 18
@

