head	1.16;
access;
symbols
	OPENBSD_6_1:1.6.0.2
	OPENBSD_6_1_BASE:1.6
	landry_20161113:1.1.1.1
	attila:1.1.1;
locks; strict;
comment	@# @;


1.16
date	2017.08.24.09.45.23;	author sthen;	state Exp;
branches;
next	1.15;
commitid	PnxiRKB45Z5BPng8;

1.15
date	2017.08.09.06.24.26;	author landry;	state Exp;
branches;
next	1.14;
commitid	vrm9yOIt9cfFlJzz;

1.14
date	2017.08.08.10.22.55;	author landry;	state Exp;
branches;
next	1.13;
commitid	TSIEvUDfJ4dnvHl7;

1.13
date	2017.07.26.22.45.32;	author sthen;	state Exp;
branches;
next	1.12;
commitid	tD4MFrpYYDDL2UFT;

1.12
date	2017.07.26.20.50.39;	author sthen;	state Exp;
branches;
next	1.11;
commitid	OxSXcGZsgFNStKKE;

1.11
date	2017.06.14.05.23.10;	author landry;	state Exp;
branches;
next	1.10;
commitid	8bpW5n0PzKqVOaCl;

1.10
date	2017.05.31.08.08.17;	author espie;	state Exp;
branches;
next	1.9;
commitid	ij92FtFXiSiT1ani;

1.9
date	2017.05.11.01.26.37;	author danj;	state Exp;
branches;
next	1.8;
commitid	G5dLgPN8jXmpNhZQ;

1.8
date	2017.04.12.18.46.52;	author landry;	state Exp;
branches;
next	1.7;
commitid	tMr2WqqHqtyrJyP5;

1.7
date	2017.04.12.18.12.33;	author landry;	state Exp;
branches;
next	1.6;
commitid	obesxEciJRtUmDBz;

1.6
date	2017.02.18.16.22.54;	author landry;	state Exp;
branches;
next	1.5;
commitid	zwUjsBRx9XMscqD4;

1.5
date	2017.01.31.13.48.18;	author landry;	state Exp;
branches;
next	1.4;
commitid	baTjCNV8SyW4vNF1;

1.4
date	2017.01.24.21.27.28;	author landry;	state Exp;
branches;
next	1.3;
commitid	Z4lmQdBuNlbTAYET;

1.3
date	2016.12.24.20.15.06;	author landry;	state Exp;
branches;
next	1.2;
commitid	QHovXl9hb4LZcESf;

1.2
date	2016.12.02.08.18.18;	author landry;	state Exp;
branches;
next	1.1;
commitid	po04Vu95AMw6J5YA;

1.1
date	2016.11.13.21.15.43;	author landry;	state Exp;
branches
	1.1.1.1;
next	;
commitid	3xth9IUho9fHyTWj;

1.1.1.1
date	2016.11.13.21.15.43;	author landry;	state Exp;
branches;
next	;
commitid	3xth9IUho9fHyTWj;


desc
@@


1.16
log
@bump; textproc/icu4c now uses multi-packages for -wwwdata
@
text
@# $OpenBSD: Makefile,v 1.15 2017/08/09 06:24:26 landry Exp $
# Some of this comes from www/firefox-esr as apropos, since Tor
# browser is a fork of ESR.  It is a good idea to look at that
# Makefile when editing this one (ESR versions not always the same).

COMMENT =		modified version of Firefox ESR for browsing over Tor
ONLY_FOR_ARCHS =	amd64 i386

MOZILLA_VERSION =	${TB_VERSION}
REVISION =		0
MOZILLA_PROJECT =	${BROWSER_NAME}
MOZILLA_CODENAME =	browser

MASTER_SITES = 		https://github.com/${GH_ACCOUNT}/${GH_PROJECT}/archive/
EXTRACT_SUFX = 		.tar.gz
DIST_SUBDIR = 		${BROWSER_NAME}
WRKDIST = 		${WRKDIR}/${GH_PROJECT}-${GH_TAGNAME:C/^v//}

PATCHORIG =		.pat.orig

GH_PROJECT =		torb
GH_TAGNAME =		v${TB_VERSION}-esr52.2.0

PKGNAME =		${TB_PREFIX}-browser-${TB_VERSION}
DISTNAME =		${GH_TAGNAME}
REVISION =		1

SO_VERSION =		2.0
MOZILLA_LIBS =		xul lgpllibs mozavcodec mozavutil
MOZILLA_LIBS +=		freebl3 nss3 nssckbi nssdbm3
MOZILLA_LIBS +=		nssutil3 smime3 softokn3 ssl3
MOZILLA_LIBS +=		mozsqlite3

# mozilla public license
PERMIT_PACKAGE_CDROM=	Yes

MODULES =		www/mozilla lang/python

MODPY_RUNDEP =		No

COMPILER =		clang
MODCLANG_ARCHS =	amd64 i386

MOZILLA_USE_BUNDLED_NSS =	Yes
MOZILLA_USE_BUNDLED_LIBEVENT = 	Yes
MOZILLA_USE_BUNDLED_SQLITE =	Yes

WANTLIB +=		X11-xcb xcb xcb-shm intl iconv ${LIBECXX}

LIB_DEPENDS +=		devel/gettext

# Regression tests are too hard to adapt to run here
NO_TEST =		Yes

CONFIGURE_STYLE =	simple
CONFIGURE_ARGS +=	--prefix=${PREFIX}

# for nss build system
MAKE_ENV +=		BUILD_OPT=1 \
			LOCALBASE="${LOCALBASE}" \
			NSS_ENABLE_ECC=1 \
			XCFLAGS="-I${LOCALBASE}/include ${CFLAGS}"
BUILD_DEPENDS +=	devel/py-virtualenv

# to be able to link when building with clang on i386
.if ${MACHINE_ARCH} == "i386"
CONFIGURE_ARGS +=	--disable-debug-symbols
.endif

CONFIGURE_ARGS +=	--with-app-name=${BROWSER_NAME} 		\
			--with-tor-browser-version=${TB_VERSION}	\
			--disable-tor-browser-update

# relies on pulseaudio for sound and broken at runtime
#CONFIGURE_ARGS +=	--disable-webrtc

RUN_DEPENDS +=		net/tor>=0.3.0.9

# bug 857628
CONFIGURE_ARGS +=	--enable-pie

post-patch:
	# hack config/baseconfig.mk to not use MOZ_APP_VERSION in a few places
	sed -i.bak -e 's/-$$(MOZ_APP_VERSION)/-${TB_VERSION}/'	\
		${WRKSRC}/config/baseconfig.mk
	# drop in the sh front end to python Mozilla now uses
	cp ${FILESDIR}/configure ${WRKSRC}
	chmod +x ${WRKSRC}/configure
	cp ${FILESDIR}/configure ${WRKSRC}/js/src
	chmod +x ${WRKSRC}/js/src/configure

BROWSER_DIR = ${PREFIX}/lib/${BROWSER_NAME}-${TB_VERSION}
BROWSER_CFG = ${BROWSER_DIR}/${BROWSER_NAME}.cfg

post-install:
	# install prefs, bookmarks, app config file for Tor browser
	${INSTALL_DATA_DIR} ${BROWSER_DIR}/browser/defaults/preferences
	${SUBST_DATA} ${FILESDIR}/all-openbsd.js \
	  ${BROWSER_DIR}/browser/defaults/preferences/all-openbsd.js
	${INSTALL_DATA_DIR} ${BROWSER_DIR}/browser/defaults/profile
	${INSTALL_DATA} ${FILESDIR}/bookmarks.html \
	  ${BROWSER_DIR}/browser/defaults/profile
	# put tor-browser.cfg together
	(sed -e 's/^#/\/\/#/' < ${FILESDIR}/extension-overrides.js; \
	 cat ${FILESDIR}/tor-browser-cfg-tail.js) > ${BROWSER_CFG}
	chown ${SHAREOWN}:${SHAREGRP} ${BROWSER_CFG}
	chmod ${SHAREMODE} ${BROWSER_CFG}
	# install distribution.ini file
	${INSTALL_DATA_DIR} ${BROWSER_DIR}/distribution
	echo "[Global]\nid=OpenBSD\nversion=${OSREV}\nabout=Packaged by ${MAINTAINER}\n" > \
		${BROWSER_DIR}/distribution/distribution.ini
	# install desktop file
	${INSTALL_DATA_DIR} ${PREFIX}/share/applications/
	${SUBST_DATA} ${FILESDIR}/${BROWSER_NAME}.desktop \
		${PREFIX}/share/applications/${BROWSER_NAME}.desktop
	# install icon for desktop file
	${INSTALL_DATA_DIR} ${PREFIX}/share/pixmaps/
	${INSTALL_DATA} ${BROWSER_DIR}/browser/icons/mozicon128.png \
		${PREFIX}/share/pixmaps/${BROWSER_NAME}.png
	# link default48.png to default.png to be used by default
	# by non-icccm compliant wm
	ln -f ${BROWSER_DIR}/browser/chrome/icons/default/default{48,}.png

.include <bsd.port.mk>
@


1.15
log
@Set ONLY_FOR_ARCHS to reduce kittens genocide
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.14 2017/08/08 10:22:55 landry Exp $
d10 1
@


1.14
log
@Bump REVISION after mozilla.port.mk changes.
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.13 2017/07/26 22:45:32 sthen Exp $
d7 1
@


1.13
log
@bump LIBCXX/LIBECXX/COMPILER_LIBCXX ports.
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.12 2017/07/26 20:50:39 sthen Exp $
d24 1
a24 1
REVISION =		0
@


1.12
log
@update to tor-browser 7.0.2 and related extensions. from attila (maintainer).
also fixes build on a clang+libc++ system.

there's a possible issue where the bookmark toolbar uses firefox defaults -
to be investigated further, committing early as the previous version doesn't
package any more.
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.11 2017/06/14 05:23:10 landry Exp $
d24 1
@


1.11
log
@Bump REVISIONs for mozilla.port.mk changes.
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.10 2017/05/31 08:08:17 espie Exp $
d17 2
d20 1
a20 1
GH_TAGNAME =		v${TB_VERSION}-esr45.9.0
a23 1
REVISION = 0
d25 2
a26 2
SO_VERSION =		1.0
MOZILLA_LIBS =		browsercomps xul lgpllibs
d36 5
a43 1
MOZILLA_AUTOCONF_DIRS +=	. js/src
d45 1
a45 1
MODPY_RUNDEP =		No
d47 1
a47 3
# necessary glue to build with the correct compiler after fx 17
COMPILER =		clang
MODCLANG_ARCHS =	amd64 i386
d52 3
a59 7

CONFIGURE_STYLE =	autoconf no-autoheader

LIB_DEPENDS +=		devel/gettext>=0.10.38 	\
			converters/libiconv
WANTLIB +=		intl>=5 iconv>=6

d62 2
a63 2
# to be able to link when building with clang on i386 or gcc on ppc
.if ${MACHINE_ARCH} == "i386" || ${MACHINE_ARCH} == "powerpc"
d69 1
a69 2
			--disable-tor-browser-update			\
			--enable-tor-brower-data-in-home-dir
d72 1
a72 3
CONFIGURE_ARGS +=	--disable-webrtc

CONFIGURE_ARGS +=	--disable-gstreamer
d74 1
a74 1
RUN_DEPENDS +=		net/tor>=0.2.9.10
a78 4
# there are sometimes .orig files in the source, messes with update-patches
post-extract:
	-find ${WRKSRC} -name '*.orig' -exec rm {} \;

d83 5
d105 4
@


1.10
log
@switch everything to new COMPILER idiom, even stuff that won't build with clang
yet, but at least that part is done.
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.9 2017/05/11 01:26:37 danj Exp $
d22 1
@


1.9
log
@Update to tor-browser 6.5.2, from MAINTAINER Sean Levy

Prodded by landry@@, looks good to edd@@
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.8 2017/04/12 18:46:52 landry Exp $
d42 1
a42 1
MODULES +=		lang/clang
a43 1
MODCLANG_LANGS =	c c++
@


1.8
log
@Update to tor-browser 6.5.1, from MAINTAINER Sean Levy

- update tor-browser to 6.5.1, based off firefox esr45.8.0
- update https-everywhere to 5.2.11
- update torbutton to 1.9.6.14
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.7 2017/04/12 18:12:33 landry Exp $
d18 1
a18 1
GH_TAGNAME =		v${TB_VERSION}-esr45.8.0
@


1.7
log
@Fix WANTLIB and bump REVISION for all ports depending on hunspell.

While here enforce dependency on hunspell 1.6 in mozilla.port.mk, as
it's a requirement for 53.
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.6 2017/02/18 16:22:54 landry Exp $
d18 1
a18 1
GH_TAGNAME =		v${TB_VERSION}-esr45.7.0
a21 1
REVISION = 		0
d78 1
a78 1
RUN_DEPENDS +=		net/tor>=0.2.9.9p0
@


1.6
log
@Consolidate textproc/icu4c common dependency into mozilla.port.mk, and
allow to build against bundled icu4c by setting MOZILLA_USE_BUNDLED_ICU.
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.5 2017/01/31 13:48:18 landry Exp $
d22 1
@


1.5
log
@Update to Tor Browser 6.5, from MAINTAINER.

includes:
- tor-browser 6.5.0 based on firefox esr 45.7.0
- depends on tor 0.2.9.9
- https-everywhere 5.2.9
- noscript 2.9.5.3
- tor-launcher 0.2.10.3
- torbutton 1.9.6.12
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.4 2017/01/24 21:27:28 landry Exp $
a74 5

# bug #1064665
LIB_DEPENDS +=		textproc/icu4c
CONFIGURE_ARGS += 	--with-system-icu
WANTLIB += 		icudata icui18n icuuc
@


1.4
log
@Bump REVISION for ports that depend on nss and/or nspr via mozilla.port.mk
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.3 2016/12/24 20:15:06 landry Exp $
d18 1
a18 1
GH_TAGNAME =		v${TB_VERSION}-esr45.6.0
a21 1
REVISION =		0
d83 1
a83 1
RUN_DEPENDS +=		net/tor>=0.2.8.7
@


1.3
log
@Update to tor-browser 6.0.8.

Contains:
- esr fork base updated to 45.6.0
- https-everywhere updated to 5.2.8
- torbutton updated to 1.9.5.13

From MAINTAINER attila / stalphonsos / com
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.2 2016/12/02 08:18:18 landry Exp $
d22 1
@


1.2
log
@Update to tor-browser 6.0.7, patching CVE-2016-9079 (Use-after-free in
SVG Animation).
updates:
- https-everywhere to 5.2.7
- noscript to 2.9.5.2
- tor-launcher to 0.2.9.4
- torbutton to 1.9.5.12

From MAINTAINER attila // stalphonsos // com.
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.1.1.1 2016/11/13 21:15:43 landry Exp $
d18 1
a18 1
GH_TAGNAME =		v${TB_VERSION}-esr45.5.1
@


1.1
log
@Initial revision
@
text
@d1 1
a1 1
# $OpenBSD$
d18 1
a18 1
GH_TAGNAME =		v${TB_VERSION}-esr45.4.0
@


1.1.1.1
log
@Import (finally!) Tor Browser 6.0.5.

All the credit goes to Sean Levy - attila at stalphonsos dot com, from
the tor BSD diversity project, https://torbsd.github.io/ - who
spent countless hours polishing and improving this out of tree.

This bundles 5 ports:
* tb-browser, a Firefox ESR fork
* torbutton 1.9.5.7, a button to configure parameters
* tor-launcher 0.2.9.3, to manage a tor instance
* tb-noscript 2.9.0.14, a well known js blocker
* tb-https-everwhere 5.2.4, try to force https where possible

Note that the extensions are installed within tb-browser directory and
won't work as-is in a regular Firefox instance.

======================================================================
Tor Browser (TB) is a customized version of Firefox Extended Service
Release built specifically for internet browsing over the Tor
anonymity network.

TB's configuration aims to mitigate attacks on a client's anonymity,
including determining the client's actual IP address and browser
fingerprinting.  Other aspects of Firefox have also been patched
to plug privacy leaks in ways not possible any other way.

TB includes custom Firefox add-ons only meant for TB, including
NoScript, HTTPS Everywhere, TorButton and Tor-Launcher.  This package
provides merely the modified version of Firefox ESR.  Please install
the tor-browser meta-package to make sure you have everything installed
correctly.

Remember that there are no perfect privacy or anonymity solutions, and
this includes TB.  As always you must pay attention and in many cases
modify your behavior to ensure your privacy online.  Note that JS is
blocked everywhere by default in TB using NoScript.
======================================================================

On a personal note (as a Mozilla developer), i'll just add that Tor
Browser is heavily patched in various ways, so think before putting your
browsing habits in someone's hands - read
https://www.torproject.org/projects/torbrowser/design/ to make up your
mind.

Of course, having this in the ports tree doesn't mean that the OpenBSD
project specifically endorses or recommends usage of Tor or Tor Browser.
If you want to keep your privacy, *use your brain* or stay offline.

ok danj@@
@
text
@@
