head	1.22;
access;
symbols
	OPENBSD_4_0:1.21.0.2
	OPENBSD_4_0_BASE:1.21
	OPENBSD_3_9:1.18.0.2
	OPENBSD_3_9_BASE:1.18
	OPENBSD_3_8:1.16.0.2
	OPENBSD_3_8_BASE:1.16
	OPENBSD_3_7:1.15.0.2
	OPENBSD_3_7_BASE:1.15
	OPENBSD_3_6:1.12.0.2
	OPENBSD_3_6_BASE:1.12
	OPENBSD_3_5:1.11.0.2
	OPENBSD_3_5_BASE:1.11
	OPENBSD_3_4:1.9.0.2
	OPENBSD_3_4_BASE:1.9
	OPENBSD_3_3:1.8.0.2
	OPENBSD_3_3_BASE:1.8
	OPENBSD_3_2:1.7.0.2
	OPENBSD_3_2_BASE:1.7
	OPENBSD_3_1:1.5.0.2
	OPENBSD_3_1_BASE:1.5
	reinhard_20020105:1.1.1.1
	reinhard:1.1.1;
locks; strict;
comment	@# @;


1.22
date	2006.10.25.18.19.32;	author kurt;	state dead;
branches;
next	1.21;

1.21
date	2006.08.13.16.14.25;	author kurt;	state Exp;
branches;
next	1.20;

1.20
date	2006.08.10.18.26.23;	author kurt;	state Exp;
branches;
next	1.19;

1.19
date	2006.08.03.19.37.04;	author kurt;	state Exp;
branches;
next	1.18;

1.18
date	2005.12.13.17.35.45;	author kurt;	state Exp;
branches;
next	1.17;

1.17
date	2005.12.06.17.07.02;	author ian;	state Exp;
branches;
next	1.16;

1.16
date	2005.06.17.21.34.20;	author kurt;	state Exp;
branches;
next	1.15;

1.15
date	2005.03.15.22.46.21;	author kurt;	state Exp;
branches;
next	1.14;

1.14
date	2005.03.05.23.31.58;	author kurt;	state Exp;
branches;
next	1.13;

1.13
date	2005.02.02.19.37.30;	author kurt;	state Exp;
branches;
next	1.12;

1.12
date	2004.06.05.17.46.35;	author naddy;	state Exp;
branches;
next	1.11;

1.11
date	2004.01.03.13.36.03;	author sturm;	state Exp;
branches;
next	1.10;

1.10
date	2003.12.15.21.21.18;	author sturm;	state Exp;
branches;
next	1.9;

1.9
date	2003.05.12.18.02.45;	author sturm;	state Exp;
branches;
next	1.8;

1.8
date	2002.10.11.14.36.21;	author reinhard;	state Exp;
branches;
next	1.7;

1.7
date	2002.09.26.23.59.44;	author brad;	state Exp;
branches
	1.7.2.1;
next	1.6;

1.6
date	2002.08.02.16.14.27;	author naddy;	state Exp;
branches;
next	1.5;

1.5
date	2002.04.04.11.28.39;	author reinhard;	state Exp;
branches
	1.5.2.1;
next	1.4;

1.4
date	2002.03.29.11.10.54;	author reinhard;	state Exp;
branches;
next	1.3;

1.3
date	2002.03.21.14.21.30;	author brad;	state Exp;
branches;
next	1.2;

1.2
date	2002.02.15.09.31.03;	author reinhard;	state Exp;
branches;
next	1.1;

1.1
date	2002.01.05.15.29.25;	author reinhard;	state Exp;
branches
	1.1.1.1;
next	;

1.1.1.1
date	2002.01.05.15.29.25;	author reinhard;	state Exp;
branches;
next	;

1.5.2.1
date	2002.09.28.01.37.58;	author brad;	state Exp;
branches;
next	1.5.2.2;

1.5.2.2
date	2002.10.12.00.27.29;	author brad;	state Exp;
branches;
next	;

1.7.2.1
date	2002.10.16.14.30.56;	author brad;	state Exp;
branches;
next	;


desc
@@


1.22
log
@replaced by www/tomcat
@
text
@# $OpenBSD: Makefile,v 1.21 2006/08/13 16:14:25 kurt Exp $

COMMENT=	"Java servlet 2.3 and Java server pages 1.2 server"
COMMENT-examples="example applications and documentation"

V=		4.1.31
DISTNAME=	jakarta-tomcat-${V}
PKGNAME=	${DISTNAME}p4
PKGNAME-examples=jakarta-tomcat-examples-${V}p4
CATEGORIES=	www

MASTER_SITES=	${MASTER_SITE_APACHE:=tomcat/tomcat-4/v$V/bin/} \
		http://archive.apache.org/dist/tomcat/tomcat-4/archive/v${V}/bin/

HOMEPAGE=	http://tomcat.apache.org/

MAINTAINER=	Kurt Miller <kurt@@openbsd.org>

MULTI_PACKAGES=	-examples
SUBPACKAGE?=

MODULES=	java
MODJAVA_VER=	1.3+

BUILD_DEPENDS=	::archivers/gtar

RUN_DEPENDS=	::java/javaPathHelper

.if defined(PACKAGING) && ${SUBPACKAGE} == "-examples"
PREFIX=		${CATALINA_BASE}
RUN_DEPENDS=    ::www/jakarta-tomcat/v4
.endif

# Apache Software License 2.0
PERMIT_PACKAGE_CDROM=	Yes
PERMIT_PACKAGE_FTP=	Yes
PERMIT_DISTFILES_CDROM=	Yes
PERMIT_DISTFILES_FTP=	Yes

TAR=		${LOCALBASE}/bin/gtar

NO_BUILD=	Yes
NO_REGRESS=	Yes

CONFDIR=	${SYSCONFDIR}/tomcat
CATALINA_BASE=	/var/tomcat
SAMPLEDIR=	${PREFIX}/share/examples/tomcat
SUBST_VARS+=	DISTNAME CONFDIR CATALINA_BASE

do-install:
	${INSTALL_DATA_DIR} ${PREFIX}/${DISTNAME}
	cd ${WRKDIST} && \
		tar cf - bin common server `find * -prune -type f` | \
		tar -C ${PREFIX}/${DISTNAME} -xf -
	${INSTALL_DATA_DIR} ${SAMPLEDIR}
	${INSTALL_DATA} ${WRKDIST}/conf/* ${SAMPLEDIR}
	${INSTALL_DATA_DIR} ${WRKINST}/${CATALINA_BASE}
	cd ${WRKDIST} && \
		tar cf - webapps | \
		tar -C ${WRKINST}/${CATALINA_BASE} -xf -
	find ${WRKINST} -name \*.orig -or -name \*.bat -or -name \*.exe | \
		xargs rm
	@@perl -pi -e 's,%%SYSCONFDIR%%,${SYSCONFDIR},' \
		${PREFIX}/${DISTNAME}/bin/setclasspath.sh
	@@perl -pi -e 's,%%PREFIX%%,${TRUEPREFIX},;s,%%DISTNAME%%,${DISTNAME},' \
		${WRKINST}/${CATALINA_BASE}/webapps/admin.xml \
		${WRKINST}/${CATALINA_BASE}/webapps/manager.xml
	@@sed -e 's,%%PREFIX%%,${TRUEPREFIX},' \
		-e 's,%%DISTNAME%%,${DISTNAME},' \
		-e 's,%%SYSCONFDIR%%,${SYSCONFDIR},' \
		-e 's,%%CATALINA_BASE%%,${CATALINA_BASE},' \
		< ${FILESDIR}/README.OpenBSD \
		> ${PREFIX}/${DISTNAME}/README.OpenBSD
	@@sed -e 's,%%PREFIX%%,${TRUEPREFIX},' \
		-e 's,%%DISTNAME%%,${DISTNAME},' \
		-e 's,%%CATALINA_BASE%%,${CATALINA_BASE},' \
		< ${FILESDIR}/tomcat.rc > ${SAMPLEDIR}/tomcat.rc

.include "bsd.port.mk"
@


1.21
log
@javaPathHelper should be in RUN_DEPENDS not BUILD_DEPENDS. okay nikolay@@
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.20 2006/08/10 18:26:23 kurt Exp $
@


1.20
log
@pkg bump all 1.3 and 1.4 java ports that haven't been yet since the
java.port.mk changes. okay naddy@@
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.19 2006/08/03 19:37:04 kurt Exp $
d8 2
a9 2
PKGNAME=	${DISTNAME}p3
PKGNAME-examples=jakarta-tomcat-examples-${V}p3
d25 3
a27 2
BUILD_DEPENDS=	::archivers/gtar \
		::java/javaPathHelper
@


1.19
log
@convert tomcat.rc script to use javaPathHelper for JAVA_HOME
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.18 2005/12/13 17:35:45 kurt Exp $
d8 2
a9 2
PKGNAME=	${DISTNAME}p2
PKGNAME-examples=jakarta-tomcat-examples-${V}p2
@


1.18
log
@fix MASTER_SITES. no pkg bump
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.17 2005/12/06 17:07:02 ian Exp $
d8 2
a9 2
PKGNAME=	${DISTNAME}p1
PKGNAME-examples=jakarta-tomcat-examples-${V}p1
d25 2
a26 1
BUILD_DEPENDS=	::archivers/gtar
a74 1
		-e 's,%%JAVA_HOME%%,${JAVA_HOME},' \
@


1.17
log
@New homepage, ok kurt@@
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.16 2005/06/17 21:34:20 kurt Exp $
d12 2
a13 2
MASTER_SITES=	${MASTER_SITE_APACHE:=jakarta/tomcat-4/v$V/bin/} \
		http://archive.apache.org/dist/jakarta/tomcat-4/archive/v${V}/bin/
@


1.16
log
@- begin using java MODULE
- bump pkgnames
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.15 2005/03/15 22:46:21 kurt Exp $
d15 1
a15 1
HOMEPAGE=	http://jakarta.apache.org/
@


1.15
log
@- put back ONLY_FOR_ARCHS=i386 to avoid packages being built on !i386
  (the jvm as a RUN_DEPEND is not enough to prevent packages from being
   created)

okay naddy@@
@
text
@d1 1
a1 4
# $OpenBSD: Makefile,v 1.14 2005/03/05 23:31:58 kurt Exp $

# Requires a JVM
ONLY_FOR_ARCHS=	i386
d8 2
a9 2
PKGNAME=	${DISTNAME}p0
PKGNAME-examples=jakarta-tomcat-examples-${V}p0
d22 3
a25 3

JAVA_HOME=	${LOCALBASE}/jdk1.3.1-linux
RUN_DEPENDS=	:jdk*->=1.3:devel/jdk/1.3-linux
@


1.14
log
@- kill INSTALL
- move examples and docs to sub-package

ok nikolay
@
text
@d1 4
a4 1
# $OpenBSD: Makefile,v 1.13 2005/02/02 19:37:30 kurt Exp $
@


1.13
log
@overhaul of v4 and an update to 4.1.31

okay ian@@, no objection naddy@@
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.12 2004/06/05 17:46:35 naddy Exp $
d4 1
d8 2
d19 3
d27 5
d46 1
a46 1
SUBST_VARS+=	DISTNAME CONFDIR CATALINA_BASE SAMPLEDIR
d54 2
d57 2
a58 2
		tar cf - conf webapps | \
		tar -C ${SAMPLEDIR} -xf -
d64 2
a65 1
		${SAMPLEDIR}/webapps/admin.xml ${SAMPLEDIR}/webapps/manager.xml
d69 1
d75 2
a76 1
		< ${FILESDIR}/tomcat.rc > ${SAMPLEDIR}/conf/tomcat.rc
@


1.12
log
@- maintenance update to 4.1.30
- allow run depend to resolve to native JDK
- DESCR revision

From: Kurt Miller <truk@@optonline.net>
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.11 2004/01/03 13:36:03 sturm Exp $
d5 1
a5 4
# Requires a JVM
ONLY_FOR_ARCHS=	i386

V=		4.1.30
d14 3
a16 1
MAINTAINER=	Kurt Miller <truk@@apache.org>
a18 1
BUILD_DEPENDS=	::archivers/gtar
d21 1
a21 1
# Apache Software License
d33 3
a35 5
DIRS=		bin common conf server shared temp webapps work
DOCS=		LICENSE README.txt RELEASE-NOTES-4.1.txt RELEASE-PLAN-4.1.txt \
		RUNNING.txt
TOMCATDIR=	/var/tomcat
SUBST_VARS=	TOMCATDIR CONFDIR DISTNAME
a38 1
	cd ${WRKDIST} && ${INSTALL_DATA} ${DOCS} ${PREFIX}/${DISTNAME}
d40 15
a54 3
		tar cf - ${DIRS} | (cd ${PREFIX}/${DISTNAME} && tar -xf -)
	@@sed -e 's,y0y0y0,${TRUEPREFIX}/${DISTNAME},' \
		-e 's,y0y0y1,${SYSCONFDIR},' \
d56 5
a60 6
		> ${PREFIX}/${DISTNAME}/conf/README.OpenBSD
	@@sed -e 's,y0y0y0,${TRUEPREFIX}/${DISTNAME},' \
		-e 's,y0y0y1,${JAVA_HOME},' \
		< ${FILESDIR}/tomcat.rc > ${PREFIX}/${DISTNAME}/conf/tomcat.rc
	@@perl -pi -e 's,y0y0y0,${SYSCONFDIR},' \
		${PREFIX}/${DISTNAME}/bin/setclasspath.sh
@


1.11
log
@new maintainer Kurt Miller <truk at apache dot org>
no response from reinhard@@ in a long time
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.10 2003/12/15 21:21:18 sturm Exp $
d8 1
a8 1
V=		4.1.29
d19 1
a19 2
JDK_VERSION=	1.3.1-linux
JAVA_HOME=	${LOCALBASE}/jdk${JDK_VERSION}
d21 1
a21 1
RUN_DEPENDS=	:jdk-linux->1.3:devel/jdk/1.3-linux
@


1.10
log
@update to jakarta-tomcat 4.1.29

from Kurt Miller <truk at optonline dot net>
this was discussed with reinhard@@ (maintainer) during lock, was then
forgotten and now he is unreachable
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.9 2003/05/12 18:02:45 sturm Exp $
d17 1
a17 1
MAINTAINER=	Reinhard J. Sammer <reinhard@@openbsd.org>
@


1.9
log
@- don't hardcode /etc, use SYSCONFDIR instead
- don't change SYSCONFDIR, use CONFDIR/SUBST_VARS instead and if neccessary
  use "CONFIGURE_STYLE=gnu old" and explicitly set --sysconfdir=${CONFDIR}
a few more to come...
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.8 2002/10/11 14:36:21 reinhard Exp $
d8 1
a8 1
V=		4.0.6
d11 3
a13 2
MASTER_SITES=	http://jakarta.apache.org/builds/jakarta-tomcat-4.0/release/v${V}/bin/
EXTRACT_SUFX=	.zip
d21 1
d30 2
a34 2
CONF_FILES=catalina.policy server-noexamples.xml.config server.xml \
tomcat-users.xml web.xml
d36 3
a38 6
DIRS=		bin classes common conf lib server webapps
DOCS=LICENSE RELEASE-NOTES-4.0-B1.txt RELEASE-NOTES-4.0-B2.txt \
RELEASE-NOTES-4.0-B3.txt RELEASE-NOTES-4.0-B4.txt RELEASE-NOTES-4.0-B5.txt \
RELEASE-NOTES-4.0-B6.txt RELEASE-NOTES-4.0-B7.txt RELEASE-NOTES-4.0-RC1.txt \
RELEASE-NOTES-4.0-RC2.txt RELEASE-NOTES-4.0.1-B1.txt RELEASE-NOTES-4.0.1.txt \
RELEASE-NOTES-4.0.txt RELEASE-PLAN-4.0.1.txt RELEASE-PLAN-4.0.txt RUNNING.txt
a41 3
post-patch:
	@@cd ${WRKDIST}/conf && perl -pi -e 's,\r,,g' ${CONF_FILES}

a44 1
	cd ${WRKDIST}/bin && chmod +x *.sh	# for .zip file
d47 9
a55 3
	${INSTALL_DATA} ${FILESDIR}/README.OpenBSD ${PREFIX}/${DISTNAME}/conf
	rm -f ${PREFIX}/${DISTNAME}/bin/catalina.sh.orig \
		${PREFIX}/${DISTNAME}/conf/server.xml.orig
@


1.8
log
@SECURITY update to v4.0.6

A security vulnerability has been confirmed to exist in Apache Tomcat
4.0.x releases (including Tomcat 4.0.5), which allows to use a specially
crafted URL to return the unprocessed source of a JSP page, or, under
special circumstances, a static resource which would otherwise have been
protected by security constraint, without the need for being properly
authenticated. This is based on a variant of the exploit that was
disclosed on 09/24/2002.
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.7 2002/09/26 23:59:44 brad Exp $
d33 1
a33 1
CONFDIR=	/etc/tomcat
@


1.7
log
@upgrade to Tomcat 4.0.5, fixes recent security issue.
--
From: Luiz Gustavo <gustavo@@shoptime.com>
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.6 2002/08/02 16:14:27 naddy Exp $
d8 1
a8 1
V=		4.0.5
@


1.7.2.1
log
@MFC:
SECURITY update to v4.0.6

A security vulnerability has been confirmed to exist in Apache Tomcat
4.0.x releases (including Tomcat 4.0.5), which allows to use a specially
crafted URL to return the unprocessed source of a JSP page, or, under
special circumstances, a static resource which would otherwise have been
protected by security constraint, without the need for being properly
authenticated. This is based on a variant of the exploit that was
disclosed on 09/24/2002.
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.7 2002/09/26 23:59:44 brad Exp $
d8 1
a8 1
V=		4.0.6
@


1.6
log
@replace verbatim control characters
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.5 2002/04/04 11:28:39 reinhard Exp $
d8 1
a8 1
V=		4.0.2
a10 1
NEED_VERSION=	1.516
d47 4
a50 4
	@@${INSTALL_DATA_DIR} ${PREFIX}/${DISTNAME}
	@@cd ${WRKDIST} && ${INSTALL_DATA} ${DOCS} ${PREFIX}/${DISTNAME}
	@@cd ${WRKDIST}/bin && chmod +x *.sh	# for .zip file
	@@cd ${WRKDIST} && \
d52 3
a54 1
	@@${INSTALL_DATA} ${FILESDIR}/README.OpenBSD ${PREFIX}/${DISTNAME}/conf
@


1.5
log
@fix $JAVA_HOME; thx & ok brad@@
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.4 2002/03/29 11:10:54 reinhard Exp $
d45 1
a45 1
	@@cd ${WRKDIST}/conf && perl -pi -e 's,,,g' ${CONF_FILES}
@


1.5.2.1
log
@MFC:
upgrade to Tomcat 4.0.5, fixes recent security issue.
--
From: Luiz Gustavo <gustavo@@shoptime.com>
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.5 2002/04/04 11:28:39 reinhard Exp $
d8 1
a8 1
V=		4.0.5
d45 1
a45 1
	@@cd ${WRKDIST}/conf && perl -pi -e 's,\r,,g' ${CONF_FILES}
d48 4
a51 4
	${INSTALL_DATA_DIR} ${PREFIX}/${DISTNAME}
	cd ${WRKDIST} && ${INSTALL_DATA} ${DOCS} ${PREFIX}/${DISTNAME}
	cd ${WRKDIST}/bin && chmod +x *.sh	# for .zip file
	cd ${WRKDIST} && \
d53 1
a53 3
	${INSTALL_DATA} ${FILESDIR}/README.OpenBSD ${PREFIX}/${DISTNAME}/conf
	rm -f ${PREFIX}/${DISTNAME}/bin/catalina.sh.orig \
		${PREFIX}/${DISTNAME}/conf/server.xml.orig
@


1.5.2.2
log
@MFC:
SECURITY update to v4.0.6

A security vulnerability has been confirmed to exist in Apache Tomcat
4.0.x releases (including Tomcat 4.0.5), which allows to use a specially
crafted URL to return the unprocessed source of a JSP page, or, under
special circumstances, a static resource which would otherwise have been
protected by security constraint, without the need for being properly
authenticated. This is based on a variant of the exploit that was
disclosed on 09/24/2002.
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.5.2.1 2002/09/28 01:37:58 brad Exp $
d8 1
a8 1
V=		4.0.6
@


1.4
log
@use jdk-1.3; thx ian@@, nino@@
*) bump NEED_VERSION
*) fix docs location

with jdk-1.2 tomcat breaks with:
Starting service Tomcat-Standalone
Apache Tomcat/4.0.2
SIGSEGV   11*  segmentation violation
        stackpointer=0xdfbfcbdc
OUCH: nested memory code, to 1 levels.
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.3 2002/03/21 14:21:30 brad Exp $
d19 1
a19 1
JDK_VERSION=	1.3-linux
d21 1
a21 1
RUN_DEPENDS=	:jdk-linux->1.3:devel/jdk/${JDK_VERSION}
@


1.3
log
@These ports are only useable on i386.
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.2 2002/02/15 09:31:03 reinhard Exp $
d11 1
a11 1
NEED_VERSION=	1.504
d19 1
a19 1
JDK_VERSION=	1.2-blackdown
d21 1
a21 1
RUN_DEPENDS=	:jdk-blackdown-*:devel/jdk/${JDK_VERSION}
@


1.2
log
@update to jakarta-tomcat 4.0.2
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.1.1.1 2002/01/05 15:29:25 reinhard Exp $
d3 4
a6 1
COMMENT=	"java servlet 2.3 and java server pages 1.2 server"
@


1.1
log
@Initial revision
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.5 2001/11/20 10:14:56 reinhard Exp $
d5 1
a5 1
V=		4.0.1
d8 1
a8 1
NEED_VERSION=	1.500
@


1.1.1.1
log
@jakarta-tomcat v4
@
text
@@
