head	1.2;
access;
symbols
	OPENBSD_5_2:1.1.0.6
	OPENBSD_5_2_BASE:1.1
	OPENBSD_5_1_BASE:1.1
	OPENBSD_5_1:1.1.0.4
	OPENBSD_5_0:1.1.0.2
	OPENBSD_5_0_BASE:1.1;
locks; strict;
comment	@# @;


1.2
date	2012.12.04.21.10.12;	author landry;	state dead;
branches;
next	1.1;

1.1
date	2011.08.02.19.24.38;	author naddy;	state Exp;
branches;
next	;


desc
@@


1.2
log
@Retire www/firefox35.

You served us well but you're EOL'ed upstream since 18 months, and your
only reason d'etre was the java plugin from jdk 1.6. But those days this
one doesnt receive updates from oracle, and icedtea-web seems to do a
good job at running java crapplets.
Users will be upgraded for free to www/mozilla-firefox !

General agreement/yays from ajacoutot@@ tobiasu@@ dcoppa@@ krw@@ kurt@@
@
text
@$OpenBSD: patch-modules_libimg_png_pngerror_c,v 1.1 2011/08/02 19:24:38 naddy Exp $

Fix for CVE-2011-2691 backported from png 1.2.45.

--- modules/libimg/png/pngerror.c.orig	Mon Aug  1 18:35:26 2011
+++ modules/libimg/png/pngerror.c	Mon Aug  1 18:38:38 2011
@@@@ -84,11 +84,11 @@@@ void PNGAPI
 png_err(png_structp png_ptr)
 {
    if (png_ptr != NULL && png_ptr->error_fn != NULL)
-      (*(png_ptr->error_fn))(png_ptr, '\0');
+      (*(png_ptr->error_fn))(png_ptr, "");
 
    /* If the custom handler doesn't exist, or if it returns,
       use the default handler, which will not return. */
-   png_default_error(png_ptr, '\0');
+   png_default_error(png_ptr, "");
 }
 #endif /* PNG_NO_ERROR_TEXT */
 
@@@@ -168,8 +168,13 @@@@ png_format_buffer(png_structp png_ptr, png_charp buffe
    {
       buffer[iout++] = ':';
       buffer[iout++] = ' ';
-      png_memcpy(buffer + iout, error_message, PNG_MAX_ERROR_TEXT);
-      buffer[iout + PNG_MAX_ERROR_TEXT - 1] = '\0';
+
+      iin = 0;
+      while (iin < PNG_MAX_ERROR_TEXT-1 && error_message[iin] != '\0')
+         buffer[iout++] = error_message[iin++];
+
+      /* iin < PNG_MAX_ERROR_TEXT, so the following is safe: */
+      buffer[iout] = '\0';
    }
 }
 
@


1.1
log
@Fix for CVE-2011-2691 in the included apng, backported from png 1.2.45.
with landry@@
@
text
@d1 1
a1 1
$OpenBSD$
@

