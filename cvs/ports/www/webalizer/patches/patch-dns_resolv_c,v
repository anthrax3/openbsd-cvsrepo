head	1.5;
access;
symbols
	OPENBSD_6_0:1.5.0.24
	OPENBSD_6_0_BASE:1.5
	OPENBSD_5_9:1.5.0.20
	OPENBSD_5_9_BASE:1.5
	OPENBSD_5_8:1.5.0.22
	OPENBSD_5_8_BASE:1.5
	OPENBSD_5_7:1.5.0.18
	OPENBSD_5_7_BASE:1.5
	OPENBSD_5_6:1.5.0.16
	OPENBSD_5_6_BASE:1.5
	OPENBSD_5_5:1.5.0.14
	OPENBSD_5_5_BASE:1.5
	OPENBSD_5_4:1.5.0.12
	OPENBSD_5_4_BASE:1.5
	OPENBSD_5_3:1.5.0.10
	OPENBSD_5_3_BASE:1.5
	OPENBSD_5_2:1.5.0.8
	OPENBSD_5_2_BASE:1.5
	OPENBSD_5_1_BASE:1.5
	OPENBSD_5_1:1.5.0.6
	OPENBSD_5_0:1.5.0.4
	OPENBSD_5_0_BASE:1.5
	OPENBSD_4_9:1.5.0.2
	OPENBSD_4_9_BASE:1.5
	OPENBSD_4_8:1.4.0.12
	OPENBSD_4_8_BASE:1.4
	OPENBSD_4_7:1.4.0.10
	OPENBSD_4_7_BASE:1.4
	OPENBSD_4_6:1.4.0.8
	OPENBSD_4_6_BASE:1.4
	OPENBSD_4_5:1.4.0.6
	OPENBSD_4_5_BASE:1.4
	OPENBSD_4_4:1.4.0.4
	OPENBSD_4_4_BASE:1.4
	OPENBSD_4_3:1.4.0.2
	OPENBSD_4_3_BASE:1.4
	OPENBSD_4_2:1.3.0.24
	OPENBSD_4_2_BASE:1.3
	OPENBSD_4_1:1.3.0.22
	OPENBSD_4_1_BASE:1.3
	OPENBSD_4_0:1.3.0.20
	OPENBSD_4_0_BASE:1.3
	OPENBSD_3_9:1.3.0.18
	OPENBSD_3_9_BASE:1.3
	OPENBSD_3_8:1.3.0.16
	OPENBSD_3_8_BASE:1.3
	OPENBSD_3_7:1.3.0.14
	OPENBSD_3_7_BASE:1.3
	OPENBSD_3_6:1.3.0.12
	OPENBSD_3_6_BASE:1.3
	OPENBSD_3_5:1.3.0.10
	OPENBSD_3_5_BASE:1.3
	OPENBSD_3_4:1.3.0.8
	OPENBSD_3_4_BASE:1.3
	OPENBSD_3_3:1.3.0.6
	OPENBSD_3_3_BASE:1.3
	OPENBSD_3_1:1.3.0.4
	OPENBSD_3_2:1.3.0.2
	OPENBSD_3_2_BASE:1.3;
locks; strict;
comment	@# @;


1.5
date	2011.01.05.08.19.18;	author giovanni;	state Exp;
branches;
next	1.4;

1.4
date	2008.01.30.20.06.48;	author mbalmer;	state Exp;
branches;
next	1.3;

1.3
date	2002.04.17.16.17.45;	author danh;	state Exp;
branches
	1.3.4.1;
next	1.2;

1.2
date	2000.10.08.00.32.45;	author danh;	state dead;
branches;
next	1.1;

1.1
date	2000.09.01.16.38.51;	author danh;	state Exp;
branches;
next	;

1.3.4.1
date	2002.12.10.15.20.56;	author brad;	state Exp;
branches;
next	;


desc
@@


1.5
log
@
Update to 2.23.03.28 and take maintainership
ok benoit@@
@
text
@$OpenBSD: patch-dns_resolv_c,v 1.4 2008/01/30 20:06:48 mbalmer Exp $
--- dns_resolv.c.orig	Mon Oct  4 19:30:36 2010
+++ dns_resolv.c	Mon Jan  3 11:45:53 2011
@@@@ -244,7 +244,7 @@@@ int dns_resolver(void *log_fp)
          continue;                        /* go get next record if any    */
       }
 
-      strcpy(tmp_buf, buffer);            /* save buffer in case of error */
+      strlcpy(tmp_buf, buffer, sizeof(tmp_buf));            /* save buffer in case of error */
       if(parse_record(buffer))            /* parse the record             */
       {
          struct addrinfo hints, *ares;
@@@@ -418,8 +418,8 @@@@ static void process_list(DNODEPTR l_list)
                      {
                         /* If long hostname, take max domain name part */
                         if ((size = strlen(hbuf)) > MAXHOST-2)
-                           strcpy(child_buf,(hbuf+(size-MAXHOST+1)));
-                        else strcpy(child_buf, hbuf);
+                           strlcpy(child_buf,(hbuf+(size-MAXHOST+1)),sizeof(child_buf));
+                        else strlcpy(child_buf, hbuf,sizeof(child_buf));
                         size = strlen(child_buf);
                      }
                      else
@


1.4
log
@Switch to webalizer xtended by Patrick Frei, which adds IPv6 support and
detailed http 404 error reports.  Webalizer author hinted me at this,
he does not intend to update. danh@@ is ok with the maintainer change.

ok stehn, okan.
@
text
@d1 5
a5 13
$OpenBSD: patch-dns_resolv_c,v 1.3 2002/04/17 16:17:45 danh Exp $
--- dns_resolv.c.orig	Mon Aug  6 18:29:25 2007
+++ dns_resolv.c	Wed Jan 30 13:24:39 2008
@@@@ -158,7 +158,7 @@@@ void resolve_dns(struct log_struct *log_rec)
       case  0:
       {
          memcpy(&alignedRecord, response.data, sizeof(struct dnsRecord));
-         strncpy (log_rec->hostname,
+         strlcpy (log_rec->hostname,
                   ((struct dnsRecord *)response.data)->hostName,
                   MAXHOST);
          log_rec->hostname[MAXHOST-1]=0;
@@@@ -269,7 +269,7 @@@@ int dns_resolver(void *log_fp)
d8 1
a8 2
       memset(tmp_buf, 0, sizeof(tmp_buf));
-      strncpy(tmp_buf, buffer, sizeof(tmp_buf)-1);            /* save buffer in case of error */
d13 2
a14 2
@@@@ -460,8 +460,8 @@@@ static void process_list(DNODEPTR l_list)
 
@


1.3
log
@update to webalizer 2.01-10
* bump NEED_VERSION
* security fix: buffer overflow in DNS resolver
* includes other bugfixes
* some strcpy/strncpy/sprintf calls changed to strlcpy/snprintf
@
text
@d1 4
a4 4
$OpenBSD$
--- dns_resolv.c.orig	Wed Apr 17 11:45:23 2002
+++ dns_resolv.c	Wed Apr 17 11:46:53 2002
@@@@ -153,7 +153,7 @@@@ void resolve_dns(struct log_struct *log_
d12 2
a13 3
          log_rec->hostname[MAXHOST]=0;
@@@@ -263,7 +263,7 @@@@ int dns_resolver(void *log_fp)
          continue;                        /* go get next record if any    */
d16 3
a18 2
-      strcpy(tmp_buf, buffer);            /* save buffer in case of error */
+      strlcpy(tmp_buf, buffer, sizeof tmp_buf);            /* save buffer in case of error */
d21 2
a22 2
          if((log_rec.addr.s_addr = inet_addr(log_rec.hostname)) != INADDR_NONE)
@@@@ -446,8 +446,8 @@@@ static void process_list(DNODEPTR l_list
d25 5
a29 5
                         if ((size = strlen(res_ent->h_name)) > MAXHOST-2)
-                           strcpy(child_buf,(res_ent->h_name+(size-MAXHOST+1)));
-                        else strcpy(child_buf, res_ent->h_name);
+                           strlcpy(child_buf,(res_ent->h_name+(size-MAXHOST+1)),sizeof child_buf);
+                        else strlcpy(child_buf, res_ent->h_name, sizeof child_buf);
@


1.3.4.1
log
@MFC:
update to webalizer 2.01-10
* security fix: buffer overflow in DNS resolver
* includes other bugfixes
* some strcpy/strncpy/sprintf calls changed to strlcpy/snprintf
--
From: Nick Nauwelaerts <nick@@nauwelaerts.net>
@
text
@d1 1
a1 1
$OpenBSD: patch-dns_resolv_c,v 1.3 2002/04/17 16:17:45 danh Exp $
@


1.2
log
@upgrade to 2.01-05; remove unneeded patches
@
text
@d1 15
a15 22
$OpenBSD: patch-dns_resolv_c,v 1.1 2000/09/01 16:38:51 danh Exp $
--- dns_resolv.c.orig	Fri Mar 24 17:31:59 2000
+++ dns_resolv.c	Fri Sep  1 12:15:04 2000
@@@@ -42,6 +42,7 @@@@
 #include <string.h>
 #include <unistd.h>                           /* normal stuff             */
 #include <ctype.h>
+#include <sys/param.h>
 #include <sys/utsname.h>
 #include <sys/times.h>
 #include <zlib.h>
@@@@ -60,6 +61,13 @@@@
 #ifndef _SYS_TYPES_H
 #include <sys/types.h>
 #endif
+
+/* include <sys/socket.h> on 4.4BSD systems */
+#ifdef BSD4_4
+#include <errno.h>
+#include <sys/types.h>
+#include <sys/socket.h>
+#endif /* BSD4_4 */
d17 16
a32 2
 /* some systems need this */
 #ifdef HAVE_MATH_H
@


1.1
log
@fixed DNS problem reported by mips@@perigord.com.  --enable-dns argument to
configure does not properly define USE_DNS.
@
text
@d1 1
a1 1
$OpenBSD: patch-dns_resolv_c,v 1.1 2000/09/01 16:30:23 danh Exp $
@

