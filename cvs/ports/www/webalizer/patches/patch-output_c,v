head	1.3;
access;
symbols
	OPENBSD_6_1:1.3.0.26
	OPENBSD_6_1_BASE:1.3
	OPENBSD_6_0:1.3.0.24
	OPENBSD_6_0_BASE:1.3
	OPENBSD_5_9:1.3.0.20
	OPENBSD_5_9_BASE:1.3
	OPENBSD_5_8:1.3.0.22
	OPENBSD_5_8_BASE:1.3
	OPENBSD_5_7:1.3.0.18
	OPENBSD_5_7_BASE:1.3
	OPENBSD_5_6:1.3.0.16
	OPENBSD_5_6_BASE:1.3
	OPENBSD_5_5:1.3.0.14
	OPENBSD_5_5_BASE:1.3
	OPENBSD_5_4:1.3.0.12
	OPENBSD_5_4_BASE:1.3
	OPENBSD_5_3:1.3.0.10
	OPENBSD_5_3_BASE:1.3
	OPENBSD_5_2:1.3.0.8
	OPENBSD_5_2_BASE:1.3
	OPENBSD_5_1_BASE:1.3
	OPENBSD_5_1:1.3.0.6
	OPENBSD_5_0:1.3.0.4
	OPENBSD_5_0_BASE:1.3
	OPENBSD_4_9:1.3.0.2
	OPENBSD_4_9_BASE:1.3
	OPENBSD_4_8:1.2.0.12
	OPENBSD_4_8_BASE:1.2
	OPENBSD_4_7:1.2.0.10
	OPENBSD_4_7_BASE:1.2
	OPENBSD_4_6:1.2.0.8
	OPENBSD_4_6_BASE:1.2
	OPENBSD_4_5:1.2.0.6
	OPENBSD_4_5_BASE:1.2
	OPENBSD_4_4:1.2.0.4
	OPENBSD_4_4_BASE:1.2
	OPENBSD_4_3:1.2.0.2
	OPENBSD_4_3_BASE:1.2
	OPENBSD_4_2:1.1.0.24
	OPENBSD_4_2_BASE:1.1
	OPENBSD_4_1:1.1.0.22
	OPENBSD_4_1_BASE:1.1
	OPENBSD_4_0:1.1.0.20
	OPENBSD_4_0_BASE:1.1
	OPENBSD_3_9:1.1.0.18
	OPENBSD_3_9_BASE:1.1
	OPENBSD_3_8:1.1.0.16
	OPENBSD_3_8_BASE:1.1
	OPENBSD_3_7:1.1.0.14
	OPENBSD_3_7_BASE:1.1
	OPENBSD_3_6:1.1.0.12
	OPENBSD_3_6_BASE:1.1
	OPENBSD_3_5:1.1.0.10
	OPENBSD_3_5_BASE:1.1
	OPENBSD_3_4:1.1.0.8
	OPENBSD_3_4_BASE:1.1
	OPENBSD_3_3:1.1.0.6
	OPENBSD_3_3_BASE:1.1
	OPENBSD_3_1:1.1.0.4
	OPENBSD_3_2:1.1.0.2
	OPENBSD_3_2_BASE:1.1;
locks; strict;
comment	@# @;


1.3
date	2011.01.05.08.19.18;	author giovanni;	state Exp;
branches;
next	1.2;

1.2
date	2008.01.30.20.06.48;	author mbalmer;	state Exp;
branches;
next	1.1;

1.1
date	2002.04.17.16.17.45;	author danh;	state Exp;
branches
	1.1.4.1;
next	;

1.1.4.1
date	2002.12.10.15.20.56;	author brad;	state Exp;
branches;
next	;


desc
@@


1.3
log
@
Update to 2.23.03.28 and take maintainership
ok benoit@@
@
text
@$OpenBSD: patch-output_c,v 1.2 2008/01/30 20:06:48 mbalmer Exp $
--- output.c.orig	Thu Dec 30 14:52:23 2010
+++ output.c	Mon Jan  3 11:50:14 2011
@@@@ -321,8 +321,8 @@@@ int write_month_html()
    /* fill in filenames */
    snprintf(html_fname,sizeof(html_fname),"usage_%04d%02d.%s",
             cur_year,cur_month,html_ext);
-   sprintf(png1_fname,"daily_usage_%04d%02d.png",cur_year,cur_month);
-   sprintf(png2_fname,"hourly_usage_%04d%02d.png",cur_year,cur_month);
+   snprintf(png1_fname, sizeof(png1_fname), "daily_usage_%04d%02d.png",cur_year,cur_month);
+   snprintf(png2_fname, sizeof(png2_fname), "hourly_usage_%04d%02d.png",cur_year,cur_month);
 
    /* create PNG images for web page */
    if (daily_graph)
@@@@ -2707,7 +2707,7 @@@@ void top_ctry_table()
       }
       snprintf(pie_title,sizeof(pie_title),"%s %s %d",
                msg_ctry_use,l_month[cur_month-1],cur_year);
-      sprintf(pie_fname,"ctry_usage_%04d%02d.png",cur_year,cur_month);
+      snprintf(pie_fname, sizeof(pie_fname), "ctry_usage_%04d%02d.png",cur_year,cur_month);
 
       pie_chart(pie_fname,pie_title,t_hit,pie_data,pie_legend);  /* do it   */
 
@@@@ -3366,7 +3366,7 @@@@ int write_main_index()
             --i; // reduce loop-counter to keep the number of required months
             continue;
          }
-         sprintf(filename,"usage_%04d%02d.%s",last_year, last_month, html_ext);
+         snprintf(filename, sizeof(filename), "usage_%04d%02d.%s",last_year, last_month, html_ext);
          if (stat(filename, &st)==0) // check if file exists
          {
             fprintf(out_fp,"<TD WIDTH=\"16.66%%\"><A HREF=\"usage_%04d%02d.%s\">" \
@


1.2
log
@Switch to webalizer xtended by Patrick Frei, which adds IPv6 support and
detailed http 404 error reports.  Webalizer author hinted me at this,
he does not intend to update. danh@@ is ok with the maintainer change.

ok stehn, okan.
@
text
@d1 26
a26 21
$OpenBSD: patch-output_c,v 1.1 2002/04/17 16:17:45 danh Exp $
--- output.c.orig	Tue Aug  7 13:28:49 2007
+++ output.c	Wed Jan 30 13:42:20 2008
@@@@ -38,6 +38,7 @@@@
 #include <ctype.h>
 #include <sys/utsname.h>
 #include <sys/times.h>
+#include <sys/socket.h>
 #include <stddef.h>
 
 /* ensure limits */
@@@@ -569,7 +570,7 @@@@ void month_links()
    char index_fname[256];
    
    fprintf(out_fp,"<SMALL>\n");
-   sprintf(index_fname,"index.%s",html_ext);
+   snprintf(index_fname,sizeof index_fname, "index.%s",html_ext);
    fprintf(out_fp, "<A HREF=\"%s\">[%s]</A>\n", index_fname, msg_hlnk_in);
    if (ntop_notfound && response[21].count)
       fprintf(out_fp,"<A HREF=\"#ERRORSTATS\">[%s]</A>\n",msg_hlnk_nf);
@@@@ -818,8 +819,8 @@@@ void month_total_table()
d28 5
a32 24
       }
 
-      sprintf(pie_title,"%s %s %d",msg_mtot_rc,l_month[cur_month-1],cur_year);
-      sprintf(pie_fname,"responses_%04d%02d.png",cur_year,cur_month);
+      snprintf(pie_title,sizeof pie_title,"%s %s %d",msg_mtot_rc,l_month[cur_month-1],cur_year);
+      snprintf(pie_fname,sizeof pie_fname,"responses_%04d%02d.png",cur_year,cur_month);
       
       pie_chart(pie_fname,pie_title,t_hit,pie_data,pie_legend);
       
@@@@ -971,12 +972,12 @@@@ int all_errors_page()
    int i;
 
    /* generate file name */
-   sprintf(error_fname,"error_%04d%02d.%s",cur_year,cur_month,html_ext);
+   snprintf(error_fname,sizeof error_fname,"error_%04d%02d.%s",cur_year,cur_month,html_ext);
 
    /* open file */
    if ( (out_fp=open_out_file(error_fname))==NULL ) return 0;
 
-   sprintf(buffer,"%s %d - %s",l_month[cur_month-1],cur_year,msg_h_url);
+   snprintf(buffer,sizeof buffer,"%s %d - %s",l_month[cur_month-1],cur_year,msg_h_url);
    write_html_head(buffer, out_fp);
 
    fprintf(out_fp,"<FONT SIZE=\"-1\"></CENTER><PRE>\n");
@


1.1
log
@update to webalizer 2.01-10
* bump NEED_VERSION
* security fix: buffer overflow in DNS resolver
* includes other bugfixes
* some strcpy/strncpy/sprintf calls changed to strlcpy/snprintf
@
text
@d1 23
a23 34
$OpenBSD$
--- output.c.orig	Wed Apr 17 11:19:13 2002
+++ output.c	Wed Apr 17 11:24:20 2002
@@@@ -295,14 +295,14 @@@@ int write_month_html()
    hist_lday[i]  =  l_day;
 
    /* fill in filenames */
-   sprintf(html_fname,"usage_%04d%02d.%s",cur_year,cur_month,html_ext);
-   sprintf(png1_fname,"daily_usage_%04d%02d.png",cur_year,cur_month);
-   sprintf(png2_fname,"hourly_usage_%04d%02d.png",cur_year,cur_month);
+   snprintf(html_fname,sizeof html_fname,"usage_%04d%02d.%s",cur_year,cur_month,html_ext);
+   snprintf(png1_fname,sizeof png1_fname,"daily_usage_%04d%02d.png",cur_year,cur_month);
+   snprintf(png2_fname,sizeof png2_fname,"hourly_usage_%04d%02d.png",cur_year,cur_month);
 
    /* create PNG images for web page */
    if (daily_graph)
    {
-      sprintf(dtitle,"%s %s %d",msg_hmth_du,l_month[cur_month-1],cur_year);
+      snprintf(dtitle,sizeof dtitle,"%s %s %d",msg_hmth_du,l_month[cur_month-1],cur_year);
       month_graph6 (  png1_fname,          /* filename          */
                       dtitle,              /* graph title       */
                       cur_month,           /* graph month       */
@@@@ -317,7 +317,7 @@@@ int write_month_html()
 
    if (hourly_graph)
    {
-      sprintf(htitle,"%s %s %d",msg_hmth_hu,l_month[cur_month-1],cur_year);
+      snprintf(htitle,sizeof htitle,"%s %s %d",msg_hmth_hu,l_month[cur_month-1],cur_year);
       day_graph3(    png2_fname,
                      htitle,
                      th_hit,
@@@@ -329,7 +329,7 @@@@ int write_month_html()
    /* first, open the file */
    if ( (out_fp=open_out_file(html_fname))==NULL ) return 1;
d25 9
a33 7
-   sprintf(buffer,"%s %d",l_month[cur_month-1],cur_year);
+   snprintf(buffer,sizeof buffer,"%s %d",l_month[cur_month-1],cur_year);
    write_html_head(buffer, out_fp);
    month_links();
    month_total_table();
@@@@ -938,12 +938,12 @@@@ int all_sites_page(u_long h_reg, u_long 
    int      i=(h_grp)?1:0;
d36 2
a37 2
-   sprintf(site_fname,"site_%04d%02d.%s",cur_year,cur_month,html_ext);
+   snprintf(site_fname,sizeof site_fname,"site_%04d%02d.%s",cur_year,cur_month,html_ext);
d40 1
a40 16
    if ( (out_fp=open_out_file(site_fname))==NULL ) return 0;
 
-   sprintf(buffer,"%s %d - %s",l_month[cur_month-1],cur_year,msg_h_sites);
+   snprintf(buffer,sizeof buffer,"%s %d - %s",l_month[cur_month-1],cur_year,msg_h_sites);
    write_html_head(buffer, out_fp);
 
    fprintf(out_fp,"<FONT SIZE=\"-1\"></CENTER><PRE>\n");
@@@@ -1143,12 +1143,12 @@@@ int all_urls_page(u_long u_reg, u_long u
    int      i=(u_grp)?1:0;
 
    /* generate file name */
-   sprintf(url_fname,"url_%04d%02d.%s",cur_year,cur_month,html_ext);
+   snprintf(url_fname,sizeof url_fname,"url_%04d%02d.%s",cur_year,cur_month,html_ext);
 
    /* open file */
    if ( (out_fp=open_out_file(url_fname))==NULL ) return 0;
a46 143
@@@@ -1414,12 +1414,12 @@@@ int all_refs_page(u_long r_reg, u_long r
    int      i=(r_grp)?1:0;
 
    /* generate file name */
-   sprintf(ref_fname,"ref_%04d%02d.%s",cur_year,cur_month,html_ext);
+   snprintf(ref_fname,sizeof ref_fname,"ref_%04d%02d.%s",cur_year,cur_month,html_ext);
 
    /* open file */
    if ( (out_fp=open_out_file(ref_fname))==NULL ) return 0;
 
-   sprintf(buffer,"%s %d - %s",l_month[cur_month-1],cur_year,msg_h_ref);
+   snprintf(buffer,sizeof buffer,"%s %d - %s",l_month[cur_month-1],cur_year,msg_h_ref);
    write_html_head(buffer, out_fp);
 
    fprintf(out_fp,"<FONT SIZE=\"-1\"></CENTER><PRE>\n");
@@@@ -1566,12 +1566,12 @@@@ int all_agents_page(u_long a_reg, u_long
    int      i=(a_grp)?1:0;
 
    /* generate file name */
-   sprintf(agent_fname,"agent_%04d%02d.%s",cur_year,cur_month,html_ext);
+   snprintf(agent_fname,sizeof agent_fname,"agent_%04d%02d.%s",cur_year,cur_month,html_ext);
 
    /* open file */
    if ( (out_fp=open_out_file(agent_fname))==NULL ) return 0;
 
-   sprintf(buffer,"%s %d - %s",l_month[cur_month-1],cur_year,msg_h_agent);
+   snprintf(buffer,sizeof buffer,"%s %d - %s",l_month[cur_month-1],cur_year,msg_h_agent);
    write_html_head(buffer, out_fp);
 
    fprintf(out_fp,"<FONT SIZE=\"-1\"></CENTER><PRE>\n");
@@@@ -1700,12 +1700,12 @@@@ int all_search_page(u_long tot_num, u_lo
    if (!tot_num) return 0;
 
    /* generate file name */
-   sprintf(search_fname,"search_%04d%02d.%s",cur_year,cur_month,html_ext);
+   snprintf(search_fname,sizeof search_fname,"search_%04d%02d.%s",cur_year,cur_month,html_ext);
 
    /* open file */
    if ( (out_fp=open_out_file(search_fname))==NULL ) return 0;
 
-   sprintf(buffer,"%s %d - %s",l_month[cur_month-1],cur_year,msg_h_search);
+   snprintf(buffer,sizeof buffer,"%s %d - %s",l_month[cur_month-1],cur_year,msg_h_search);
    write_html_head(buffer, out_fp);
 
    fprintf(out_fp,"<FONT SIZE=\"-1\"></CENTER><PRE>\n");
@@@@ -1843,12 +1843,12 @@@@ int all_users_page(u_long i_reg, u_long 
    int      i=(i_grp)?1:0;
 
    /* generate file name */
-   sprintf(user_fname,"user_%04d%02d.%s",cur_year,cur_month,html_ext);
+   snprintf(user_fname,sizeof user_fname,"user_%04d%02d.%s",cur_year,cur_month,html_ext);
 
    /* open file */
    if ( (out_fp=open_out_file(user_fname))==NULL ) return 0;
 
-   sprintf(buffer,"%s %d - %s",l_month[cur_month-1],cur_year,msg_h_uname);
+   snprintf(buffer,sizeof buffer,"%s %d - %s",l_month[cur_month-1],cur_year,msg_h_uname);
    write_html_head(buffer, out_fp);
 
    fprintf(out_fp,"<FONT SIZE=\"-1\"></CENTER><PRE>\n");
@@@@ -1998,8 +1998,8 @@@@ void top_ctry_table()
          pie_data[i]=top_ctrys[i]->count;           /* load the array       */
          pie_legend[i]=top_ctrys[i]->desc;
       }
-      sprintf(pie_title,"%s %s %d",msg_ctry_use,l_month[cur_month-1],cur_year);
-      sprintf(pie_fname,"ctry_usage_%04d%02d.png",cur_year,cur_month);
+      snprintf(pie_title,sizeof pie_title,"%s %s %d",msg_ctry_use,l_month[cur_month-1],cur_year);
+      snprintf(pie_fname,sizeof pie_fname,"ctry_usage_%04d%02d.png",cur_year,cur_month);
 
       pie_chart(pie_fname,pie_title,t_hit,pie_data,pie_legend);  /* do it   */
 
@@@@ -2063,7 +2063,7 @@@@ void dump_all_sites()
    u_long   cnt=a_ctr;
 
    /* generate file name */
-   sprintf(filename,"%s/site_%04d%02d.%s",
+   snprintf(filename,sizeof filename,"%s/site_%04d%02d.%s",
       (dump_path)?dump_path:".",cur_year,cur_month,dump_ext);
 
    /* open file */
@@@@ -2106,7 +2106,7 @@@@ void dump_all_urls()
    u_long   cnt=a_ctr;
 
    /* generate file name */
-   sprintf(filename,"%s/url_%04d%02d.%s",
+   snprintf(filename,sizeof filename,"%s/url_%04d%02d.%s",
       (dump_path)?dump_path:".",cur_year,cur_month,dump_ext);
 
    /* open file */
@@@@ -2146,7 +2146,7 @@@@ void dump_all_refs()
    u_long   cnt=a_ctr;
 
    /* generate file name */
-   sprintf(filename,"%s/ref_%04d%02d.%s",
+   snprintf(filename,sizeof filename,"%s/ref_%04d%02d.%s",
       (dump_path)?dump_path:".",cur_year,cur_month,dump_ext);
 
    /* open file */
@@@@ -2185,7 +2185,7 @@@@ void dump_all_agents()
    u_char   cnt=a_ctr;
 
    /* generate file name */
-   sprintf(filename,"%s/agent_%04d%02d.%s",
+   snprintf(filename,sizeof filename,"%s/agent_%04d%02d.%s",
       (dump_path)?dump_path:".",cur_year,cur_month,dump_ext);
 
    /* open file */
@@@@ -2224,7 +2224,7 @@@@ void dump_all_users()
    u_long   cnt=a_ctr;
 
    /* generate file name */
-   sprintf(filename,"%s/user_%04d%02d.%s",
+   snprintf(filename,sizeof filename,"%s/user_%04d%02d.%s",
       (dump_path)?dump_path:".",cur_year,cur_month,dump_ext);
 
    /* open file */
@@@@ -2267,7 +2267,7 @@@@ void dump_all_search()
    u_char   cnt=a_ctr;
 
    /* generate file name */
-   sprintf(filename,"%s/search_%04d%02d.%s",
+   snprintf(filename,sizeof filename,"%s/search_%04d%02d.%s",
       (dump_path)?dump_path:".",cur_year,cur_month,dump_ext);
 
    /* open file */
@@@@ -2312,7 +2312,7 @@@@ int write_main_index()
 
    if (verbose>1) printf("%s\n",msg_gen_sum);
 
-   sprintf(buffer,"%s %s",msg_main_us,hname);
+   snprintf(buffer,sizeof buffer,"%s %s",msg_main_us,hname);
 
    for (i=0;i<12;i++)                   /* get last month in history */
    {
@@@@ -2338,7 +2338,7 @@@@ int write_main_index()
                    hist_visit);         /* data set 6        */
 
    /* now do html stuff... */
-   sprintf(index_fname,"index.%s",html_ext);
+   snprintf(index_fname,sizeof index_fname,"index.%s",html_ext);
 
    if ( (out_fp=fopen(index_fname,"w")) == NULL)
    {
@


1.1.4.1
log
@MFC:
update to webalizer 2.01-10
* security fix: buffer overflow in DNS resolver
* includes other bugfixes
* some strcpy/strncpy/sprintf calls changed to strlcpy/snprintf
--
From: Nick Nauwelaerts <nick@@nauwelaerts.net>
@
text
@d1 1
a1 1
$OpenBSD: patch-output_c,v 1.1 2002/04/17 16:17:45 danh Exp $
@

