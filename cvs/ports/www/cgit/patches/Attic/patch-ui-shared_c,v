head	1.1;
access;
symbols
	OPENBSD_5_8:1.1.0.2;
locks; strict;
comment	@# @;


1.1
date	2016.01.15.10.41.13;	author jasper;	state dead;
branches
	1.1.2.1;
next	;
commitid	ZwmhQmdOVfFkHNCY;

1.1.2.1
date	2016.01.15.10.41.13;	author jasper;	state Exp;
branches;
next	;
commitid	ZwmhQmdOVfFkHNCY;


desc
@@


1.1
log
@file patch-ui-shared_c was initially added on branch OPENBSD_5_8.
@
text
@@


1.1.2.1
log
@Address multiple security issues: CVE-2016-1899, CVE-2016-1900, CVE-2016-1901.
With additional hardening related to CVE-2016-1899.
@
text
@a0 21
$OpenBSD$

Security fix for CVE-2016-1900

--- ui-shared.c.orig	Fri Mar 13 16:22:11 2015
+++ ui-shared.c	Fri Jan 15 11:33:08 2016
@@@@ -675,9 +675,11 @@@@ void cgit_print_http_headers(void)
 		htmlf("Content-Type: %s\n", ctx.page.mimetype);
 	if (ctx.page.size)
 		htmlf("Content-Length: %zd\n", ctx.page.size);
-	if (ctx.page.filename)
-		htmlf("Content-Disposition: inline; filename=\"%s\"\n",
-		      ctx.page.filename);
+	if (ctx.page.filename) {
+		html("Content-Disposition: inline; filename=\"");
+		html_header_arg_in_quotes(ctx.page.filename);
+		html("\"\n");
+	}
 	if (!ctx.env.authenticated)
 		html("Cache-Control: no-cache, no-store\n");
 	htmlf("Last-Modified: %s\n", http_date(ctx.page.modified));
@

