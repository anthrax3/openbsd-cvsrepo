head	1.1;
access;
symbols
	OPENBSD_5_8:1.1.0.2;
locks; strict;
comment	@# @;


1.1
date	2016.01.15.10.41.13;	author jasper;	state dead;
branches
	1.1.2.1;
next	;
commitid	ZwmhQmdOVfFkHNCY;

1.1.2.1
date	2016.01.15.10.41.13;	author jasper;	state Exp;
branches;
next	;
commitid	ZwmhQmdOVfFkHNCY;


desc
@@


1.1
log
@file patch-html_c was initially added on branch OPENBSD_5_8.
@
text
@@


1.1.2.1
log
@Address multiple security issues: CVE-2016-1899, CVE-2016-1900, CVE-2016-1901.
With additional hardening related to CVE-2016-1899.
@
text
@a0 39
$OpenBSD$

Security fix for CVE-2016-1900

--- html.c.orig	Fri Mar 13 16:22:11 2015
+++ html.c	Fri Jan 15 11:33:08 2016
@@@@ -252,6 +252,32 @@@@ void html_url_arg(const char *txt)
 		html(txt);
 }
 
+void html_header_arg_in_quotes(const char *txt)
+{
+	const char *t = txt;
+	while (t && *t) {
+		unsigned char c = *t;
+		const char *e = NULL;
+		if (c == '\\')
+			e = "\\\\";
+		else if (c == '\r')
+			e = "\\r";
+		else if (c == '\n')
+			e = "\\n";
+		else if (c == '"')
+			e = "\\\"";
+		if (e) {
+			html_raw(txt, t - txt);
+			html(e);
+			txt = t + 1;
+		}
+		t++;
+	}
+	if (t != txt)
+		html(txt);
+
+}
+
 void html_hidden(const char *name, const char *value)
 {
 	html("<input type='hidden' name='");
@

