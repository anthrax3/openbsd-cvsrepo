head	1.8;
access;
symbols
	OPENBSD_6_1:1.8.0.2
	OPENBSD_6_1_BASE:1.8
	OPENBSD_6_0:1.7.0.2
	OPENBSD_6_0_BASE:1.7
	OPENBSD_5_9:1.4.0.2
	OPENBSD_5_9_BASE:1.4
	OPENBSD_5_8:1.2.0.4
	OPENBSD_5_8_BASE:1.2;
locks; strict;
comment	@# @;


1.8
date	2016.10.27.18.30.41;	author robert;	state Exp;
branches;
next	1.7;
commitid	lED1Oks5HVh03mCa;

1.7
date	2016.05.28.14.49.39;	author robert;	state Exp;
branches;
next	1.6;
commitid	e1vpcgKLVeZdUbdR;

1.6
date	2016.04.27.12.46.16;	author robert;	state Exp;
branches;
next	1.5;
commitid	yOrwVI71D7bLHmrO;

1.5
date	2016.03.23.20.13.07;	author robert;	state Exp;
branches;
next	1.4;
commitid	2hNT21XsdisESysQ;

1.4
date	2016.02.15.18.07.53;	author robert;	state Exp;
branches;
next	1.3;
commitid	R0eKGRSW56iYyJ8K;

1.3
date	2015.08.12.10.56.13;	author robert;	state Exp;
branches;
next	1.2;
commitid	WokHnx1ONPqT4wiW;

1.2
date	2015.05.26.17.37.40;	author robert;	state Exp;
branches;
next	1.1;
commitid	imvK5OAjfFzbGwip;

1.1
date	2015.05.06.14.27.24;	author robert;	state Exp;
branches;
next	;
commitid	0TVTUxEI0BYra21v;


desc
@@


1.8
log
@update to 54.0
@
text
@$OpenBSD: patch-third_party_WebKit_Source_platform_heap_StackFrameDepth_cpp,v 1.7 2016/05/27 06:28:21 robert Exp $
--- third_party/WebKit/Source/platform/heap/StackFrameDepth.cpp.orig.port	Wed May 25 04:54:37 2016
+++ third_party/WebKit/Source/platform/heap/StackFrameDepth.cpp	Thu May 26 08:09:48 2016
@@@@ -13,6 +13,10 @@@@
 #elif defined(__GLIBC__)
 extern "C" void* __libc_stack_end;  // NOLINT
 #endif
+#if OS(OPENBSD)
+#include <sys/signal.h>
+#include <pthread_np.h>
+#endif
 
 namespace blink {
 
@@@@ -104,6 +108,8 @@@@ size_t StackFrameDepth::getUnderestimatedStackSize()
     //    low as 512k.
     //
     return 512 * 1024;
+#elif OS(OPENBSD)
+    return 512 * 1024;
 #elif OS(MACOSX)
     // pthread_get_stacksize_np() returns too low a value for the main thread on
     // OSX 10.9, http://mail.openjdk.java.net/pipermail/hotspot-dev/2013-October/011369.html
@@@@ -135,12 +141,18 @@@@ size_t StackFrameDepth::getUnderestimatedStackSize()
 
 void* StackFrameDepth::getStackStart()
 {
-#if defined(__GLIBC__) || OS(ANDROID) || OS(FREEBSD)
+#if defined(__GLIBC__) || OS(ANDROID) || OS(FREEBSD) || OS(OPENBSD)
     pthread_attr_t attr;
     int error;
 #if OS(FREEBSD)
     pthread_attr_init(&attr);
     error = pthread_attr_get_np(pthread_self(), &attr);
+#elif OS(OPENBSD)
+    stack_t ss;
+    void *base;
+    error = pthread_stackseg_np(pthread_self(), &ss);
+    base = (void*)((size_t) ss.ss_sp - ss.ss_size);
+    return reinterpret_cast<Address>(base) + ss.ss_size;
 #else
     error = pthread_getattr_np(pthread_self(), &attr);
 #endif
@


1.7
log
@update to 51.1
@
text
@@


1.6
log
@update to iridium-50.0 and sync recent changes with chromium
@
text
@d1 3
a3 3
$OpenBSD: patch-third_party_WebKit_Source_platform_heap_StackFrameDepth_cpp,v 1.6 2016/04/16 19:08:46 robert Exp $
--- third_party/WebKit/Source/platform/heap/StackFrameDepth.cpp.orig.port	Thu Apr 14 14:07:45 2016
+++ third_party/WebKit/Source/platform/heap/StackFrameDepth.cpp	Thu Apr 14 20:00:25 2016
d15 1
a15 1
@@@@ -115,6 +119,8 @@@@ size_t StackFrameDepth::getUnderestimatedStackSize()
d24 1
a24 1
@@@@ -146,12 +152,18 @@@@ size_t StackFrameDepth::getUnderestimatedStackSize()
@


1.5
log
@update to 49.0
@
text
@d1 3
a3 3
$OpenBSD: patch-third_party_WebKit_Source_platform_heap_StackFrameDepth_cpp,v 1.5 2016/03/06 10:51:14 robert Exp $
--- third_party/WebKit/Source/platform/heap/StackFrameDepth.cpp.orig.port	Wed Feb 24 21:01:34 2016
+++ third_party/WebKit/Source/platform/heap/StackFrameDepth.cpp	Sat Mar  5 19:54:47 2016
d15 4
a18 4
@@@@ -95,6 +99,8 @@@@ size_t StackFrameDepth::getUnderestimatedStackSize()
 #endif
 
     return 0;
d20 1
a20 1
+    return 0;
d24 1
a24 1
@@@@ -126,12 +132,18 @@@@ size_t StackFrameDepth::getUnderestimatedStackSize()
@


1.4
log
@update to 48.1 (based on the latest stable chromium which contains security
fixes as well)

ok naddy@@ sthen@@
@
text
@d1 4
a4 4
$OpenBSD: patch-third_party_WebKit_Source_platform_heap_StackFrameDepth_cpp,v 1.4 2016/01/23 18:49:31 robert Exp $
--- third_party/WebKit/Source/platform/heap/StackFrameDepth.cpp.orig.port	Wed Jan 20 21:01:25 2016
+++ third_party/WebKit/Source/platform/heap/StackFrameDepth.cpp	Fri Jan 22 19:58:59 2016
@@@@ -14,6 +14,10 @@@@
d15 1
a15 1
@@@@ -96,7 +100,7 @@@@ size_t StackFrameDepth::getUnderestimatedStackSize()
d19 6
a24 6
-#elif OS(MACOSX)
+#elif OS(MACOSX) || OS(OPENBSD)
     // FIXME: pthread_get_stacksize_np() returns shorter size than actual stack
     // size for the main thread on Mavericks(10.9).
     return 0;
@@@@ -110,12 +114,18 @@@@ size_t StackFrameDepth::getUnderestimatedStackSize()
@


1.3
log
@update to iridium-44.0 and also incorporate a patch from dcoppa@@
for the startup script that still had references to chromium directories.
@
text
@d1 3
a3 3
$OpenBSD: patch-third_party_WebKit_Source_platform_heap_StackFrameDepth_cpp,v 1.3 2015/07/23 13:44:04 robert Exp $
--- third_party/WebKit/Source/platform/heap/StackFrameDepth.cpp.orig.port	Wed Jul 15 22:31:13 2015
+++ third_party/WebKit/Source/platform/heap/StackFrameDepth.cpp	Wed Jul 22 08:37:30 2015
d15 1
a15 1
@@@@ -93,7 +97,7 @@@@ size_t StackFrameDepth::getUnderestimatedStackSize()
d24 1
a24 1
@@@@ -114,12 +118,18 @@@@ size_t StackFrameDepth::getUnderestimatedStackSize()
@


1.2
log
@update to 43.1
@
text
@d1 3
a3 3
$OpenBSD: patch-third_party_WebKit_Source_platform_heap_StackFrameDepth_cpp,v 1.2 2015/05/24 15:51:53 robert Exp $
--- third_party/WebKit/Source/platform/heap/StackFrameDepth.cpp.orig.port	Thu May 14 00:49:00 2015
+++ third_party/WebKit/Source/platform/heap/StackFrameDepth.cpp	Fri May 22 23:50:07 2015
d15 1
a15 1
@@@@ -84,7 +88,7 @@@@ size_t StackFrameDepth::getUnderestimatedStackSize()
d24 1
a24 1
@@@@ -105,12 +109,18 @@@@ size_t StackFrameDepth::getUnderestimatedStackSize()
@


1.1
log
@update to iridium-browser-42.0
@
text
@d1 3
a3 3
$OpenBSD: patch-third_party_WebKit_Source_platform_heap_StackFrameDepth_cpp,v 1.1 2015/04/27 16:38:25 robert Exp $
--- third_party/WebKit/Source/platform/heap/StackFrameDepth.cpp.orig.port	Wed Apr 15 09:41:19 2015
+++ third_party/WebKit/Source/platform/heap/StackFrameDepth.cpp	Wed Apr 22 22:49:42 2015
d15 2
a16 1
@@@@ -39,7 +43,7 @@@@ void StackFrameDepth::configureLimit()
d18 7
a24 8
 size_t StackFrameDepth::getUnderestimatedStackSize()
 {
-#if defined(__GLIBC__) || OS(ANDROID) || OS(FREEBSD)
+#if defined(__GLIBC__) || OS(ANDROID) || OS(FREEBSD) || OS(OPENBSD)
     // We cannot get the stack size in these platforms because
     // pthread_getattr_np() can fail for the main thread.
     // This is OK because ThreadState::current() doesn't use the stack size
@@@@ -63,12 +67,18 @@@@ size_t StackFrameDepth::getUnderestimatedStackSize()
@

