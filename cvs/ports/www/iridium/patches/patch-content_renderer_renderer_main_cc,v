head	1.9;
access;
symbols
	OPENBSD_6_2:1.9.0.2
	OPENBSD_6_2_BASE:1.9
	OPENBSD_6_1:1.7.0.2
	OPENBSD_6_1_BASE:1.7
	OPENBSD_6_0:1.6.0.2
	OPENBSD_6_0_BASE:1.6
	OPENBSD_5_9:1.3.0.2
	OPENBSD_5_9_BASE:1.3;
locks; strict;
comment	@# @;


1.9
date	2017.04.28.22.22.36;	author robert;	state Exp;
branches;
next	1.8;
commitid	hEiDsbcK5ON7rnmo;

1.8
date	2017.04.19.05.16.47;	author robert;	state Exp;
branches;
next	1.7;
commitid	jpW2BiKwA9H7U7d6;

1.7
date	2016.10.27.18.30.41;	author robert;	state Exp;
branches;
next	1.6;
commitid	lED1Oks5HVh03mCa;

1.6
date	2016.05.28.14.49.39;	author robert;	state Exp;
branches;
next	1.5;
commitid	e1vpcgKLVeZdUbdR;

1.5
date	2016.04.27.12.46.16;	author robert;	state Exp;
branches;
next	1.4;
commitid	yOrwVI71D7bLHmrO;

1.4
date	2016.03.23.20.13.07;	author robert;	state Exp;
branches;
next	1.3;
commitid	2hNT21XsdisESysQ;

1.3
date	2016.02.15.18.07.53;	author robert;	state Exp;
branches;
next	1.2;
commitid	R0eKGRSW56iYyJ8K;

1.2
date	2016.02.01.15.09.01;	author robert;	state Exp;
branches;
next	1.1;
commitid	y13gJFCxfcrc1u7F;

1.1
date	2016.01.07.07.26.40;	author robert;	state Exp;
branches;
next	;
commitid	TBD9NMbFa6lHNIhT;


desc
@@


1.9
log
@update to 58.0
@
text
@$OpenBSD: patch-content_renderer_renderer_main_cc,v 1.12 2017/04/28 14:21:00 robert Exp $
--- content/renderer/renderer_main.cc.orig.port	Fri Apr 28 07:33:33 2017
+++ content/renderer/renderer_main.cc	Fri Apr 28 09:32:21 2017
@@@@ -34,6 +34,7 @@@@
 #include "ppapi/features/features.h"
 #include "third_party/WebKit/public/platform/scheduler/renderer/renderer_scheduler.h"
 #include "third_party/skia/include/core/SkGraphics.h"
+#include "third_party/skia/include/ports/SkFontConfigInterface.h"
 #include "ui/base/ui_base_switches.h"
 
 #if defined(OS_ANDROID)
@@@@ -62,6 +63,12 @@@@
 #include "ui/ozone/public/client_native_pixmap_factory.h"
 #endif
 
+#if defined(OS_BSD)
+#include "content/browser/renderer_host/render_sandbox_host_linux.h"
+#include "content/common/font_config_ipc_linux.h"
+#include "content/common/sandbox_linux/sandbox_linux.h"
+#endif
+
 namespace content {
 namespace {
 // This function provides some ways to test crash and assertion handling
@@@@ -171,9 +178,13 @@@@ int RendererMain(const MainFunctionParams& parameters)
   // is OK.
   InitializeWebRtcModule();
 #endif
+#if defined(OS_BSD)
+  SkFontConfigInterface::SetGlobal(
+      new FontConfigIPC(GetSandboxFD()))->unref();
+#endif
 
   {
-#if defined(OS_WIN) || defined(OS_MACOSX)
+#if defined(OS_WIN) || defined(OS_MACOSX) || defined(OS_BSD)
     // TODO(markus): Check if it is OK to unconditionally move this
     // instruction down.
     auto render_process = RenderProcessImpl::Create();
@@@@ -183,7 +194,7 @@@@ int RendererMain(const MainFunctionParams& parameters)
     bool run_loop = true;
     if (!no_sandbox)
       run_loop = platform.EnableSandbox();
-#if defined(OS_POSIX) && !defined(OS_MACOSX)
+#if defined(OS_POSIX) && !defined(OS_MACOSX) && !defined(OS_BSD)
     auto render_process = RenderProcessImpl::Create();
     RenderThreadImpl::Create(std::move(main_message_loop),
                              std::move(renderer_scheduler));
@


1.8
log
@update to 57.0
@
text
@d1 3
a3 3
$OpenBSD: patch-content_renderer_renderer_main_cc,v 1.11 2017/03/14 12:18:54 robert Exp $
--- content/renderer/renderer_main.cc.orig.port	Thu Mar  9 21:04:32 2017
+++ content/renderer/renderer_main.cc	Fri Mar 10 07:46:23 2017
d12 1
a12 1
@@@@ -62,6 +63,11 @@@@
d17 1
a17 1
+#include "content/common/child_process_sandbox_support_impl_linux.h"
d19 1
d25 1
a25 1
@@@@ -171,9 +177,13 @@@@ int RendererMain(const MainFunctionParams& parameters)
d39 2
a40 2
     RenderProcessImpl render_process;
@@@@ -183,7 +193,7 @@@@ int RendererMain(const MainFunctionParams& parameters)
d46 1
a46 1
     RenderProcessImpl render_process;
@


1.7
log
@update to 54.0
@
text
@d1 5
a5 5
$OpenBSD: patch-content_renderer_renderer_main_cc,v 1.10 2016/10/26 06:22:08 robert Exp $
--- content/renderer/renderer_main.cc.orig.port	Wed Oct 12 21:02:59 2016
+++ content/renderer/renderer_main.cc	Wed Oct 19 12:56:05 2016
@@@@ -32,6 +32,7 @@@@
 #include "content/renderer/renderer_main_platform_delegate.h"
d12 1
a12 1
@@@@ -60,6 +61,11 @@@@
d24 1
a24 1
@@@@ -169,9 +175,13 @@@@ int RendererMain(const MainFunctionParams& parameters)
d39 1
a39 1
@@@@ -181,7 +191,7 @@@@ int RendererMain(const MainFunctionParams& parameters)
@


1.6
log
@update to 51.1
@
text
@d1 4
a4 5
$OpenBSD: patch-content_renderer_renderer_main_cc,v 1.8 2016/05/27 06:28:21 robert Exp $
--- content/renderer/renderer_main.cc.orig.port	Wed May 25 21:01:02 2016
+++ content/renderer/renderer_main.cc	Thu May 26 08:09:46 2016
@@@@ -31,6 +31,7 @@@@
 #include "content/renderer/render_thread_impl.h"
d6 1
d12 1
a12 1
@@@@ -59,6 +60,11 @@@@
d24 1
a24 1
@@@@ -170,9 +176,13 @@@@ int RendererMain(const MainFunctionParams& parameters)
d39 1
a39 1
@@@@ -182,7 +192,7 @@@@ int RendererMain(const MainFunctionParams& parameters)
@


1.5
log
@update to iridium-50.0 and sync recent changes with chromium
@
text
@d1 4
a4 4
$OpenBSD: patch-content_renderer_renderer_main_cc,v 1.7 2016/04/16 19:08:46 robert Exp $
--- content/renderer/renderer_main.cc.orig.port	Wed Apr 13 22:59:47 2016
+++ content/renderer/renderer_main.cc	Thu Apr 14 08:25:12 2016
@@@@ -33,6 +33,7 @@@@
d12 1
a12 1
@@@@ -61,6 +62,11 @@@@
d24 1
a24 1
@@@@ -190,9 +196,13 @@@@ int RendererMain(const MainFunctionParams& parameters)
d39 1
a39 1
@@@@ -202,7 +212,7 @@@@ int RendererMain(const MainFunctionParams& parameters)
@


1.4
log
@update to 49.0
@
text
@d1 4
a4 4
$OpenBSD: patch-content_renderer_renderer_main_cc,v 1.6 2016/03/06 10:51:14 robert Exp $
--- content/renderer/renderer_main.cc.orig.port	Wed Feb 24 21:01:32 2016
+++ content/renderer/renderer_main.cc	Thu Mar  3 09:43:26 2016
@@@@ -34,6 +34,7 @@@@
d12 2
a13 2
@@@@ -66,6 +67,11 @@@@
 #include "content/common/mojo/mojo_shell_connection_impl.h"
d24 1
a24 1
@@@@ -201,9 +207,13 @@@@ int RendererMain(const MainFunctionParams& parameters)
d39 1
a39 1
@@@@ -213,7 +223,7 @@@@ int RendererMain(const MainFunctionParams& parameters)
@


1.3
log
@update to 48.1 (based on the latest stable chromium which contains security
fixes as well)

ok naddy@@ sthen@@
@
text
@d1 4
a4 4
$OpenBSD: patch-content_renderer_renderer_main_cc,v 1.5 2016/01/31 20:45:29 robert Exp $
--- content/renderer/renderer_main.cc.orig.port	Wed Jan 27 18:00:49 2016
+++ content/renderer/renderer_main.cc	Sun Jan 31 21:40:09 2016
@@@@ -28,6 +28,7 @@@@
d12 2
a13 2
@@@@ -56,6 +57,11 @@@@
 #include "ui/ozone/public/client_native_pixmap_factory.h"
d24 1
a24 1
@@@@ -183,9 +189,13 @@@@ int RendererMain(const MainFunctionParams& parameters)
d39 1
a39 1
@@@@ -195,7 +205,7 @@@@ int RendererMain(const MainFunctionParams& parameters)
d46 2
a47 2
     RenderThreadImpl::Create(main_message_loop.Pass(),
                              renderer_scheduler.Pass());
@


1.2
log
@switch to libjpeg_turbo and merge the sandbox font handling patches from
chromium
@
text
@d1 3
a3 3
$OpenBSD: patch-content_renderer_renderer_main_cc,v 1.1 2016/01/07 07:26:40 robert Exp $
--- content/renderer/renderer_main.cc.orig.port	Tue Dec 15 21:05:11 2015
+++ content/renderer/renderer_main.cc	Mon Feb  1 08:34:12 2016
d24 1
a24 1
@@@@ -180,9 +186,13 @@@@ int RendererMain(const MainFunctionParams& parameters)
d39 1
a39 1
@@@@ -192,7 +202,7 @@@@ int RendererMain(const MainFunctionParams& parameters)
@


1.1
log
@pledge(2) iridium as well by syncing with the chromium port
@
text
@d1 26
a26 4
$OpenBSD$
--- content/renderer/renderer_main.cc.orig.port	Sun Jan  3 21:44:36 2016
+++ content/renderer/renderer_main.cc	Sun Jan  3 21:44:58 2016
@@@@ -182,7 +182,7 @@@@ int RendererMain(const MainFunctionParams& parameters)
d28 4
d39 1
a39 1
@@@@ -192,7 +192,7 @@@@ int RendererMain(const MainFunctionParams& parameters)
@

