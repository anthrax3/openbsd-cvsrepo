head	1.3;
access;
symbols
	OPENBSD_6_2:1.3.0.8
	OPENBSD_6_2_BASE:1.3
	OPENBSD_6_1:1.3.0.6
	OPENBSD_6_1_BASE:1.3
	OPENBSD_6_0:1.3.0.4
	OPENBSD_6_0_BASE:1.3
	OPENBSD_5_9:1.3.0.2
	OPENBSD_5_9_BASE:1.3
	OPENBSD_5_1_BASE:1.1
	OPENBSD_5_1:1.1.0.2;
locks; strict;
comment	@# @;


1.3
date	2015.09.12.08.09.05;	author robert;	state Exp;
branches;
next	1.2;
commitid	Bp4K546TQGStnU1i;

1.2
date	2012.03.06.20.35.20;	author sthen;	state dead;
branches;
next	1.1;

1.1
date	2011.10.25.19.07.56;	author jasper;	state Exp;
branches;
next	;


desc
@@


1.3
log
@unbreak phpldapadmin with php-5.{5,6}
@
text
@$OpenBSD$
--- lib/functions.php.orig	Mon Oct  1 08:54:14 2012
+++ lib/functions.php	Sat Sep 12 09:46:59 2015
@@@@ -2127,7 +2127,7 @@@@ function password_types() {
  *        crypt, ext_des, md5crypt, blowfish, md5, sha, smd5, ssha, sha512, or clear.
  * @@return string The hashed password.
  */
-function password_hash($password_clear,$enc_type) {
+function password_hash_custom($password_clear,$enc_type) {
 	if (DEBUG_ENABLED && (($fargs=func_get_args())||$fargs='NOARGS'))
 		debug_log('Entered (%%)',1,0,__FILE__,__LINE__,__METHOD__,$fargs);
 
@@@@ -2318,7 +2318,7 @@@@ function password_check($cryptedpassword,$plainpasswor
 
 		# SHA crypted passwords
 		case 'sha':
-			if (strcasecmp(password_hash($plainpassword,'sha'),'{SHA}'.$cryptedpassword) == 0)
+			if (strcasecmp(password_hash_custom($plainpassword,'sha'),'{SHA}'.$cryptedpassword) == 0)
 				return true;
 			else
 				return false;
@@@@ -2327,7 +2327,7 @@@@ function password_check($cryptedpassword,$plainpasswor
 
 		# MD5 crypted passwords
 		case 'md5':
-			if( strcasecmp(password_hash($plainpassword,'md5'),'{MD5}'.$cryptedpassword) == 0)
+			if( strcasecmp(password_hash_custom($plainpassword,'md5'),'{MD5}'.$cryptedpassword) == 0)
 				return true;
 			else
 				return false;
@@@@ -2392,7 +2392,7 @@@@ function password_check($cryptedpassword,$plainpasswor
 
 		# SHA512 crypted passwords
 		case 'sha512':
-			if (strcasecmp(password_hash($plainpassword,'sha512'),'{SHA512}'.$cryptedpassword) == 0)
+			if (strcasecmp(password_hash_custom($plainpassword,'sha512'),'{SHA512}'.$cryptedpassword) == 0)
 				return true;
 			else
 				return false;
@@@@ -2564,13 +2564,24 @@@@ function dn_unescape($dn) {
 	if (is_array($dn)) {
 		$a = array();
 
-		foreach ($dn as $key => $rdn)
-			$a[$key] = preg_replace('/\\\([0-9A-Fa-f]{2})/e',"''.chr(hexdec('\\1')).''",$rdn);
+		foreach ($dn as $key => $rdn) {
+			$a[$key] = preg_replace_callback('/\\\([0-9A-Fa-f]{2})/',
+				function ($m) {
+					return ''.chr(hexdec('\\1')).'';
+				},
+				$rdn
+			);
+		}
 
 		return $a;
 
 	} else {
-		return preg_replace('/\\\([0-9A-Fa-f]{2})/e',"''.chr(hexdec('\\1')).''",$dn);
+		 return  preg_replace_callback('/\\\([0-9A-Fa-f]{2})/',
+			 function ($m) {
+				return ''.chr(hexdec('\\1')).'';
+			},
+			$dn
+		);
 	}
 }
 
@


1.2
log
@update to phpLDAPadmin 1.2.2 which rolls in 2 of the 3 security patches in
the port.  there will likely be more fixes to this soon, see
https://sourceforge.net/tracker/?func=detail&aid=3497660&group_id=61828&atid=498546
@
text
@d1 10
a10 11
$OpenBSD: patch-lib_functions_php,v 1.1 2011/10/25 19:07:56 jasper Exp $

From 76e6dad13ef77c5448b8dfed1a61e4acc7241165 Mon Sep 17 00:00:00 2001
From: Deon George <wurley@@users.sf.net>
Date: Thu, 6 Oct 2011 09:03:20 +1100
Subject: [PATCH] SF Bug #3417184 - PHP Code Injection Vulnerability

--- lib/functions.php.orig	Tue Oct 25 21:05:21 2011
+++ lib/functions.php	Tue Oct 25 21:05:31 2011
@@@@ -1003,8 +1003,9 @@@@ function masort(&$data,$sortby,$rev=0) {
 	if (defined('DEBUG_ENABLED') && DEBUG_ENABLED && (($fargs=func_get_args())||$fargs='NOARGS'))
d13 1
a13 5
-	# if the array to sort is null or empty
-	if (! $data) return;
+       # if the array to sort is null or empty, or if we have some nasty chars
+       if (! preg_match('/^[a-zA-Z0-9_]+(\([a-zA-Z0-9_,]*\))?$/',$sortby) || ! $data)
+               return;
d15 52
a66 1
 	static $CACHE = array();
@


1.1
log
@Security fixes for SA46551,
phpLDAPadmin Cross-Site Scripting and Code Injection Vulnerabilities
@
text
@d1 1
a1 1
$OpenBSD$
@

