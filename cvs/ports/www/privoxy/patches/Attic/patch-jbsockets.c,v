head	1.3;
access;
symbols
	OPENBSD_4_3:1.2.0.20
	OPENBSD_4_3_BASE:1.2
	OPENBSD_4_2:1.2.0.18
	OPENBSD_4_2_BASE:1.2
	OPENBSD_4_1:1.2.0.16
	OPENBSD_4_1_BASE:1.2
	OPENBSD_4_0:1.2.0.14
	OPENBSD_4_0_BASE:1.2
	OPENBSD_3_9:1.2.0.12
	OPENBSD_3_9_BASE:1.2
	OPENBSD_3_8:1.2.0.10
	OPENBSD_3_8_BASE:1.2
	OPENBSD_3_7:1.2.0.8
	OPENBSD_3_7_BASE:1.2
	OPENBSD_3_6:1.2.0.6
	OPENBSD_3_6_BASE:1.2
	OPENBSD_3_5:1.2.0.4
	OPENBSD_3_5_BASE:1.2
	OPENBSD_3_4:1.2.0.2
	OPENBSD_3_4_BASE:1.2
	OPENBSD_3_3:1.1.0.2
	OPENBSD_3_3_BASE:1.1;
locks; strict;
comment	@ * @;


1.3
date	2008.04.04.02.21.29;	author merdely;	state dead;
branches;
next	1.2;

1.2
date	2003.04.01.20.52.59;	author sturm;	state Exp;
branches;
next	1.1;

1.1
date	2003.02.24.06.44.26;	author pvalchev;	state Exp;
branches;
next	;


desc
@@


1.3
log
@Update to 3.0.8.
Take over MAINTAINER-ship (discussed with ckuethe, old MAINTAINER)
Remove patches that were included upstream.

ok wcmaier@@, ckuethe@@, sturm@@
@
text
@$OpenBSD: patch-jbsockets.c,v 1.2 2003/04/01 20:52:59 sturm Exp $
--- jbsockets.c.orig	Thu Mar  6 22:41:04 2003
+++ jbsockets.c	Sat Mar 29 18:40:39 2003
@@@@ -237,7 +237,7 @@@@ const char jbsockets_rcs[] = "$Id: jbsoc
 
 #endif
 
-#ifdef OSX_DARWIN
+#if defined(OSX_DARWIN) || defined(__OpenBSD__)
 #include <pthread.h>
 #include "jcc.h"
 /* jcc.h is for mutex semaphores only */
@@@@ -723,7 +723,7 @@@@ int accept_connection(struct client_stat
       {
          host = NULL;
       }
-#elif defined(OSX_DARWIN)
+#elif defined(OSX_DARWIN) || defined(__OpenBSD__)
       pthread_mutex_lock(&gethostbyaddr_mutex);
       host = gethostbyaddr((const char *)&server.sin_addr, 
                            sizeof(server.sin_addr), AF_INET);
@@@@ -802,7 +802,7 @@@@ unsigned long resolve_hostname_to_ip(con
       {
          hostp = NULL;
       }
-#elif OSX_DARWIN
+#elif defined(OSX_DARWIN) || defined(__OpenBSD__)
       pthread_mutex_lock(&gethostbyname_mutex);
       hostp = gethostbyname(host);
       pthread_mutex_unlock(&gethostbyname_mutex);
@


1.2
log
@update to 3.0.2

- fixes two memory leaks, one serious
- quite some filter changes, upgraders beware!
- for details, see http://www.privoxy.org/announce.txt

from MAINTAINER
@
text
@d1 1
a1 1
$OpenBSD: patch-jbsockets.c,v 1.1 2003/02/24 06:44:26 pvalchev Exp $
@


1.1
log
@fix DNS resolution by using thread-safe functions; patch from marc@@
bump PKGNAME. from maintainer Dan Weeks
@
text
@d1 4
a4 4
$OpenBSD$
--- jbsockets.c.orig	Sun May 26 16:41:27 2002
+++ jbsockets.c	Thu Feb 13 13:44:58 2003
@@@@ -185,6 +185,7 @@@@ const char jbsockets_rcs[] = "$Id: jbsoc
d6 1
a6 1
 #include "config.h"
d8 7
a14 5
+#include <pthread.h>
 #include <stdlib.h>
 #include <stdio.h>
 #include <string.h>
@@@@ -710,8 +711,13 @@@@ int accept_connection(struct client_stat
d17 6
a22 12
 #else
-      host = gethostbyaddr((const char *)&server.sin_addr, 
-                           sizeof(server.sin_addr), AF_INET);
+		{
+				  static pthread_mutex_t mutex = PTHREAD_MUTEX_INITIALIZER;
+				  pthread_mutex_lock(&mutex);
+				  host = gethostbyaddr((const char *)&server.sin_addr, 
+											  sizeof(server.sin_addr), AF_INET);
+				  pthread_mutex_unlock(&mutex);
+		}
 #endif
       if (host == NULL)
a23 1
@@@@ -784,7 +790,12 @@@@ unsigned long resolve_hostname_to_ip(con
d26 5
a30 11
 #else
-      hostp = gethostbyname(host);
+		{
+				  static pthread_mutex_t mutex = PTHREAD_MUTEX_INITIALIZER;
+				  pthread_mutex_lock(&mutex);
+				  hostp = gethostbyname(host);
+				  pthread_mutex_unlock(&mutex);
+		}
 #endif /* def HAVE_GETHOSTBYNAME_R_(6|5|3)_ARGS */
       if (hostp == NULL)
       {
@

