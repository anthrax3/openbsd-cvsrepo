head	1.5;
access;
symbols
	OPENBSD_5_9:1.4.0.4
	OPENBSD_5_9_BASE:1.4
	OPENBSD_5_8:1.4.0.6
	OPENBSD_5_8_BASE:1.4
	OPENBSD_5_7:1.4.0.2
	OPENBSD_5_7_BASE:1.4
	OPENBSD_5_6:1.3.0.12
	OPENBSD_5_6_BASE:1.3
	OPENBSD_5_5:1.3.0.10
	OPENBSD_5_5_BASE:1.3
	OPENBSD_5_4:1.3.0.8
	OPENBSD_5_4_BASE:1.3
	OPENBSD_5_3:1.3.0.6
	OPENBSD_5_3_BASE:1.3
	OPENBSD_5_2:1.3.0.4
	OPENBSD_5_2_BASE:1.3
	OPENBSD_5_1_BASE:1.3
	OPENBSD_5_1:1.3.0.2
	OPENBSD_5_0:1.2.0.12
	OPENBSD_5_0_BASE:1.2
	OPENBSD_4_9:1.2.0.10
	OPENBSD_4_9_BASE:1.2
	OPENBSD_4_8:1.2.0.8
	OPENBSD_4_8_BASE:1.2
	OPENBSD_4_7:1.2.0.6
	OPENBSD_4_7_BASE:1.2
	OPENBSD_4_6:1.2.0.4
	OPENBSD_4_6_BASE:1.2
	OPENBSD_4_5:1.2.0.2
	OPENBSD_4_5_BASE:1.2
	OPENBSD_4_4:1.1.1.1.0.6
	OPENBSD_4_4_BASE:1.1.1.1
	OPENBSD_4_3:1.1.1.1.0.4
	OPENBSD_4_3_BASE:1.1.1.1
	OPENBSD_4_2:1.1.1.1.0.2
	OPENBSD_4_2_BASE:1.1.1.1
	robert_20070320:1.1.1.1
	robert:1.1.1;
locks; strict;
comment	@# @;


1.5
date	2016.04.01.18.46.06;	author sthen;	state dead;
branches;
next	1.4;
commitid	80YllD0oDPOwc9KE;

1.4
date	2014.10.30.11.57.59;	author sthen;	state Exp;
branches;
next	1.3;
commitid	q85bzuCfe2cEtZgk;

1.3
date	2011.11.16.13.29.14;	author robert;	state Exp;
branches;
next	1.2;

1.2
date	2008.08.22.14.48.53;	author robert;	state Exp;
branches;
next	1.1;

1.1
date	2007.03.19.23.13.23;	author robert;	state Exp;
branches
	1.1.1.1;
next	;

1.1.1.1
date	2007.03.19.23.13.23;	author robert;	state Exp;
branches;
next	;


desc
@@


1.5
log
@Switch pear to a newer version. We previously used a tarball with a slightly
modified version of the go-pear php script but this was awkward to generate
and newer versions no longer support recent PHP. So instead I have changed
to using an unmodified go-pear.phar archive (mirrored to include a version
number, but there are no changes to the upstream file).

go-pear.phar is normally interactive and doesn't allow presetting parameters
or just piping a simple list of answers, so I am driving it with Expect.pm
instead.

Some bumps/updates to follow as XML-Util moved to the main pear distro.

ok robert@@
@
text
@$OpenBSD: patch-go-pear,v 1.4 2014/10/30 11:57:59 sthen Exp $
--- go-pear.orig	Wed Oct 29 14:15:56 2014
+++ go-pear	Wed Oct 29 14:16:09 2014
@@@@ -50,7 +50,7 @@@@ define('WEBINSTALLER', ($sapi_name != 'cli' && !(subst
 ini_set('track_errors', true);
 ini_set('html_errors', WEBINSTALLER);
 ini_set('magic_quotes_runtime', false);
-error_reporting( E_ALL & ~E_NOTICE);
+error_reporting( E_ALL & ~E_NOTICE & ~E_DEPRECATED );
 
 define('WINDOWS', (substr(PHP_OS, 0, 3) == 'WIN'));
 define('GO_PEAR_VER', '1.1.2');
@@@@ -116,7 +116,7 @@@@ $bootstrap_pkgs = array( // uses URL like http://pear.
 );
 
 $installer_packages = array(
-    'PEAR',
+    'PEAR-stable',
     'Structures_Graph-stable',
     'Archive_Tar-stable',
     'Console_Getopt-stable',
@@@@ -251,6 +251,7 @@@@ if (WEBINSTALLER) {
     // Anything past this step has something to do with the installation    
 }
 
+/*
 if (!WEBINSTALLER) {
     $tty = WINDOWS ? @@fopen('\con', 'r') : @@fopen('/dev/tty', 'r');
 
@@@@ -294,6 +295,7 @@@@ If you wish to abort, press Control-C now, or press En
         $http_proxy = $tmp;
     }
 }
+*/
 
 $origpwd = getcwd();
 
@@@@ -346,6 +348,7 @@@@ we strongly recommand to use it.
     }
 }
 
+/*
 while (!WEBINSTALLER) {
     print "
 Below is a suggested file layout for your new PEAR installation.  To
@@@@ -428,6 +431,7 @@@@ If you have a CLI (or CGI) php.exe available, we stron
         }
     }
 }
+*/
 
 ####
 # Installation stuff
@@@@ -562,6 +566,7 @@@@ if (WEBINSTALLER) {
     }
 }
 
+/*
 if (!WEBINSTALLER) {
     $msg = "The following PEAR packages are bundled with PHP: " .
         implode(', ', array_keys($pfc_packages));
@@@@ -571,17 +576,19 @@@@ if (!WEBINSTALLER) {
     $install_optional_packages = array();
     print "\n";
 }
+*/
 
 ####
 # Download
 ####
 
 if (function_exists('set_include_path')) {
-   set_include_path($ptmp);
+   set_include_path($ptmp . PATH_SEPARATOR . "%%BUNDLEDIR%%");
 } else {
-   ini_set('include_path', $ptmp);
+   ini_set('include_path', $ptmp . PATH_SEPARATOR . "%%BUNDLEDIR%%");
 }
 
+/*
 if (!extension_loaded('zlib') && !WEBINSTALLER) { // In Web context we could be in multithread env which makes dl() end up with a fatal error.
     if (WINDOWS) {
         @@dl('php_zlib.dll');
@@@@ -606,18 +613,21 @@@@ print "Loading zlib: ".($have_gzip ? 'ok' : 'failed').
 if (!$have_gzip) {
     print "Downloading uncompressed packages\n";
 };
+*/
 
 if ($install_pfc) {
     $to_install = array_merge($installer_packages, array_keys($pfc_packages));
 } else {
     $to_install = $installer_packages;
 
+/*
     // webinstaller allows to choose pfc packages individually
     foreach ($pfc_packages as $pkg => $desc) {
         if (in_array($pkg, $install_optional_packages)) {
             array_push($to_install, $pkg);
         }
     }
+*/
 }
 
 // gopear_bundle usage
@@@@ -655,9 +665,9 @@@@ if (is_dir($php_dir)) {
 if ($nobootstrap) {
     print('Using previously install ... ');
     if (function_exists('set_include_path')) {
-        set_include_path($php_dir);
+        set_include_path($php_dir . PATH_SEPARATOR . "%%BUNDLEDIR%%");
     } else {
-        ini_set('include_path', $php_dir);
+        ini_set('include_path', $php_dir . PATH_SEPARATOR . "%%BUNDLEDIR%%");
     }
     include_once 'PEAR.php';
     print "ok\n";
@@@@ -750,7 +760,7 @@@@ include_once "PEAR/Registry.php";
 if (WEBINSTALLER || isset($_SERVER['argv'][1]) && $_SERVER['argv'][1] == 'local') {
     $config = &PEAR_Config::singleton($prefix."/pear.conf", '');
 } else {
-    $config = &PEAR_Config::singleton();
+    $config = &PEAR_Config::singleton($prefix."/etc/pear.conf", '');
 }
 
 
@@@@ -768,11 +778,13 @@@@ $config->store();
 $registry = new PEAR_Registry($php_dir);
 PEAR_Command::setFrontendType('CLI');
 
+/*
 PEAR::staticPushErrorHandling(PEAR_ERROR_DIE); //fail silently
 $ch_cmd = &PEAR_Command::factory('update-channels', $config);
 $ch_cmd->run('update-channels', $options, array());
 PEAR::staticPopErrorHandling(); // reset error handling
 unset($ch_cmd);
+*/
 
 
 print "\n".'Installing selected packages..................'."\n";
@@@@ -821,7 +833,7 @@@@ displayHTMLProgress($progress = 99);
 
 
 // Base installation finished
-
+/*
 ini_restore("include_path");
 
 if (!WEBINSTALLER) {
@@@@ -980,6 +992,8 @@@@ if ( WINDOWS ) {
 if (WINDOWS && !WEBINSTALLER) {
     win32CreateRegEnv();
 }
+*/
+
 // Set of functions following
 /**
  * Parse the given dirname
@@@@ -1418,19 +1432,18 @@@@ function detect_install_dirs($_prefix = null) {
         }
     } else {
         if ($_prefix === null) {
-            #$prefix    = dirname(PHP_BINDIR);
-            $prefix    = dirname(__FILE__);
+            $prefix    = '%%PREFIX%%';
         } else {
             $prefix = $_prefix;
         }
         $bin_dir   = '$prefix/bin';
         #$php_dir   = '$prefix/share/pear';
-        $php_dir   = '$prefix/PEAR';
-        $doc_dir   = '$php_dir/docs';
-        $data_dir  = '$php_dir/data';
-        $test_dir  = '$php_dir/tests';
-        $temp_dir   = '$prefix/temp';
-
+        $php_dir   = '$prefix/pear/lib';
+        $doc_dir   = '$prefix/share/doc/pear';
+        $data_dir  = '$prefix/pear/data';
+        $test_dir  = '$prefix/pear/tests';
+        $temp_dir   = '%%TMPDIR%%';
+/*
         // check if the user has installed PHP with PHP or GNU layout
         if (@@is_dir("$prefix/lib/php/.registry")) {
             $php_dir = '$prefix/lib/php';
@@@@ -1442,6 +1455,7 @@@@ function detect_install_dirs($_prefix = null) {
         } elseif (@@is_dir("$prefix/share/php/.registry")) {
             $php_dir = '$prefix/share/php';
         }
+*/
     }
 }
 
@


1.4
log
@update to pear 1.9.5, ok robert@@

tarball is hand-updated from the previous one. the updated dependencies
mean this now works with php 5.5. tested with all of pecl-* and pear-*,
all good with 5.4, only APC fails with 5.5 (and it's no longer supported
there; PHP 5.5 has its own opcode cache anyway)
@
text
@d1 1
a1 1
$OpenBSD: patch-go-pear,v 1.3 2011/11/16 13:29:14 robert Exp $
@


1.3
log
@update to 1.9.4
@
text
@d1 3
a3 3
$OpenBSD: patch-go-pear,v 1.2 2008/08/22 14:48:53 robert Exp $
--- go-pear.orig	Sun Nov  6 20:54:16 2011
+++ go-pear	Wed Nov 16 14:12:55 2011
@


1.2
log
@update to pear 1.7.2 which is the current stable
version.
@
text
@d1 23
a23 5
$OpenBSD: patch-go-pear,v 1.1.1.1 2007/03/19 23:13:23 robert Exp $
--- go-pear.orig	Mon Sep 10 19:21:57 2007
+++ go-pear	Tue May 20 15:51:12 2008
@@@@ -308,6 +308,7 @@@@ if (WEBINSTALLER) {
     $install_pfc = $_SESSION['go-pear']['install_pfc'];
d30 1
a30 1
@@@@ -351,6 +352,7 @@@@ If you wish to abort, press Control-C now, or press En
d38 1
a38 1
@@@@ -423,6 +425,7 @@@@ we strongly recommand to use it.
d46 1
a46 1
@@@@ -505,6 +508,7 @@@@ If you have a CLI (or CGI) php.exe available, we stron
d52 3
a54 3
 foreach ($config_vars as $n => $var) {
     for ($m = 1; $m <= count($config_vars); $m++) {
@@@@ -574,6 +578,7 @@@@ Run this script as $root or pick another location.\n")
d61 3
a63 3
         implode(', ', $pfc_packages);
@@@@ -582,6 +587,7 @@@@ if (!WEBINSTALLER) {
     $install_pfc = !stristr(fgets($tty, 1024), "n");
d70 8
a77 2
@@@@ -593,6 +599,7 @@@@ if (function_exists('set_include_path')) {
    ini_set('include_path', $ptmp);
d84 1
a84 1
@@@@ -617,6 +624,7 @@@@ print "Loading zlib: ".($have_gzip ? 'ok' : 'failed').
d91 28
a118 2
     $to_install = array_merge($installer_packages, $pfc_packages);
@@@@ -776,7 +784,7 @@@@ include_once "PEAR/Registry.php";
d127 16
a142 1
@@@@ -812,6 +820,7 @@@@ displayHTMLProgress($progress = 99);
d145 1
a145 1
 
d150 1
a150 1
@@@@ -969,6 +978,7 @@@@ if ( WINDOWS ) {
d155 1
d159 1
a159 1
@@@@ -1403,17 +1413,17 @@@@ function detect_install_dirs($_prefix = null) {
d163 3
a165 2
-            $prefix    = dirname(PHP_BINDIR);
+            $prefix    = "%%PREFIX%%";
d170 2
a171 1
-        $php_dir   = '$prefix/share/pear';
d181 1
a181 1
+        $temp_dir   = '/tmp';
d186 1
a186 1
@@@@ -1425,6 +1435,7 @@@@ function detect_install_dirs($_prefix = null) {
a193 5
@@@@ -2530,3 +2541,4 @@@@ php.ini <$pathIni> include_path updated.
     }
     return true;
 }
+?>
@


1.1
log
@Initial revision
@
text
@d1 3
a3 3
$OpenBSD$
--- go-pear.orig	Tue Feb  6 18:30:15 2007
+++ go-pear	Mon Mar 19 12:23:42 2007
d12 1
a12 1
@@@@ -351,6 +352,7 @@@@ If you wish to abort, press Control-C no
d28 1
a28 1
@@@@ -505,6 +508,7 @@@@ If you have a CLI (or CGI) php.exe avail
d36 1
a36 1
@@@@ -573,6 +577,7 @@@@ Run this script as $root or pick another
d44 1
a44 1
@@@@ -581,6 +586,7 @@@@ if (!WEBINSTALLER) {
d52 1
a52 1
@@@@ -592,6 +598,7 @@@@ if (function_exists('set_include_path'))
d60 1
a60 1
@@@@ -616,6 +623,7 @@@@ print "Loading zlib: ".($have_gzip ? 'ok
d68 1
a68 21
@@@@ -710,19 +718,6 @@@@ if (in_array('Getopt.php', $local_dir)) 
 }
 print "ok\n";
 
-print 'Bootstrapping: Console_Getopt.........';
-$r = 'RELEASE_' . ereg_replace('[^A-Za-z0-9]', '_', substr(substr($tarball['Console_Getopt'], 15), 0, -4));
-$url = "http://cvs.php.net/viewcvs.cgi/pear-core/Console/Getopt.php?view=co&pathrev=PEAR_1_4";
-mkdir('Console', 0700);
-if (in_array('Getopt.php', $local_dir)) {
-    copy(dirname(__FILE__).'/go-pear-bundle/Getopt.php', 'Console/Getopt.php');
-    echo "(local) ";
-} else {
-    download_url($url, 'Console/Getopt.php', $http_proxy);
-    echo "(remote) ";
-}
-print "ok\n";
-
 if ($install_pfc) {
     foreach ($pfc_packages as $pkg) {
         foreach($local_dir as $file) {
@@@@ -788,7 +783,7 @@@@ include_once "PEAR/Registry.php";
d77 1
a77 1
@@@@ -824,6 +819,7 @@@@ displayHTMLProgress($progress = 99);
d85 1
a85 1
@@@@ -981,6 +977,7 @@@@ if ( WINDOWS ) {
d91 3
a93 3
 
 // {{{ download_url()
@@@@ -1377,17 +1374,17 @@@@ function detect_install_dirs($_prefix = 
d118 1
a118 1
@@@@ -1399,6 +1396,7 @@@@ function detect_install_dirs($_prefix = 
d126 1
a126 1
@@@@ -2504,3 +2502,4 @@@@ php.ini <$pathIni> include_path updated.
@


1.1.1.1
log
@import of pear-1.5.0;

This port is going to replace the -pear subpackage of www/php5/core.
We have been planning this for a long time now.
Currently is not hooked to the builds, because it needs more testing.
@
text
@@
