head	1.24;
access;
symbols
	OPENBSD_6_1:1.24.0.4
	OPENBSD_6_1_BASE:1.24
	OPENBSD_6_0:1.24.0.2
	OPENBSD_6_0_BASE:1.24
	OPENBSD_5_9:1.23.0.2
	OPENBSD_5_9_BASE:1.23
	OPENBSD_5_8:1.22.0.4
	OPENBSD_5_8_BASE:1.22
	OPENBSD_5_7:1.20.0.2
	OPENBSD_5_7_BASE:1.20
	OPENBSD_5_6:1.18.0.4
	OPENBSD_5_6_BASE:1.18
	OPENBSD_5_5:1.18.0.2
	OPENBSD_5_5_BASE:1.18
	OPENBSD_5_4:1.17.0.2
	OPENBSD_5_4_BASE:1.17
	OPENBSD_5_3:1.15.0.6
	OPENBSD_5_3_BASE:1.15
	OPENBSD_5_2:1.15.0.4
	OPENBSD_5_2_BASE:1.15
	OPENBSD_5_1_BASE:1.15
	OPENBSD_5_1:1.15.0.2
	OPENBSD_5_0:1.11.0.2
	OPENBSD_5_0_BASE:1.11
	OPENBSD_4_9:1.8.0.2
	OPENBSD_4_9_BASE:1.8
	OPENBSD_4_8:1.6.0.8
	OPENBSD_4_8_BASE:1.6
	OPENBSD_4_7:1.6.0.6
	OPENBSD_4_7_BASE:1.6
	OPENBSD_4_6:1.6.0.4
	OPENBSD_4_6_BASE:1.6
	OPENBSD_4_5:1.6.0.2
	OPENBSD_4_5_BASE:1.6
	OPENBSD_4_4:1.5.0.4
	OPENBSD_4_4_BASE:1.5
	OPENBSD_4_3:1.5.0.2
	OPENBSD_4_3_BASE:1.5
	OPENBSD_4_2:1.4.0.2
	OPENBSD_4_2_BASE:1.4
	robert_20070320:1.1.1.1
	robert:1.1.1;
locks; strict;
comment	@# @;


1.24
date	2016.04.01.18.46.06;	author sthen;	state Exp;
branches;
next	1.23;
commitid	80YllD0oDPOwc9KE;

1.23
date	2015.12.03.21.24.32;	author sthen;	state Exp;
branches;
next	1.22;
commitid	qh8BBe4z9PLvLPKf;

1.22
date	2015.06.06.09.03.50;	author kili;	state Exp;
branches;
next	1.21;
commitid	HLyOiHj0Rnijp5t9;

1.21
date	2015.06.05.06.00.22;	author robert;	state Exp;
branches;
next	1.20;
commitid	PS9YXjRm9KQkIZjT;

1.20
date	2014.11.06.17.13.40;	author sthen;	state Exp;
branches;
next	1.19;
commitid	ig1O4RkSPXzTZYwZ;

1.19
date	2014.10.30.11.57.58;	author sthen;	state Exp;
branches;
next	1.18;
commitid	q85bzuCfe2cEtZgk;

1.18
date	2013.08.12.04.11.21;	author robert;	state Exp;
branches;
next	1.17;

1.17
date	2013.07.05.09.34.35;	author jasper;	state Exp;
branches;
next	1.16;

1.16
date	2013.03.11.11.44.47;	author espie;	state Exp;
branches;
next	1.15;

1.15
date	2011.12.20.15.21.30;	author giovanni;	state Exp;
branches;
next	1.14;

1.14
date	2011.11.16.15.56.37;	author robert;	state Exp;
branches;
next	1.13;

1.13
date	2011.11.16.13.29.13;	author robert;	state Exp;
branches;
next	1.12;

1.12
date	2011.09.16.12.00.07;	author espie;	state Exp;
branches;
next	1.11;

1.11
date	2011.07.11.06.22.49;	author robert;	state Exp;
branches;
next	1.10;

1.10
date	2011.07.08.18.40.45;	author robert;	state Exp;
branches;
next	1.9;

1.9
date	2011.07.08.18.23.17;	author robert;	state Exp;
branches;
next	1.8;

1.8
date	2010.11.22.08.36.52;	author espie;	state Exp;
branches;
next	1.7;

1.7
date	2010.08.31.08.15.45;	author ajacoutot;	state Exp;
branches;
next	1.6;

1.6
date	2008.08.22.14.48.53;	author robert;	state Exp;
branches;
next	1.5;

1.5
date	2007.09.13.14.30.23;	author sthen;	state Exp;
branches;
next	1.4;

1.4
date	2007.05.31.10.32.08;	author kili;	state Exp;
branches;
next	1.3;

1.3
date	2007.05.07.13.46.59;	author bernd;	state Exp;
branches;
next	1.2;

1.2
date	2007.03.20.11.12.22;	author robert;	state Exp;
branches;
next	1.1;

1.1
date	2007.03.19.23.13.23;	author robert;	state Exp;
branches
	1.1.1.1;
next	;

1.1.1.1
date	2007.03.19.23.13.23;	author robert;	state Exp;
branches;
next	;


desc
@@


1.24
log
@Switch pear to a newer version. We previously used a tarball with a slightly
modified version of the go-pear php script but this was awkward to generate
and newer versions no longer support recent PHP. So instead I have changed
to using an unmodified go-pear.phar archive (mirrored to include a version
number, but there are no changes to the upstream file).

go-pear.phar is normally interactive and doesn't allow presetting parameters
or just piping a simple list of answers, so I am driving it with Expect.pm
instead.

Some bumps/updates to follow as XML-Util moved to the main pear distro.

ok robert@@
@
text
@# $OpenBSD: Makefile,v 1.23 2015/12/03 21:24:32 sthen Exp $

COMMENT-main=	base classes for common PHP tasks
COMMENT-utils=	utilities for managing pear extensions

VERSION=	1.10.1
DISTNAME=	go-pear-${VERSION}
PKGNAME=	pear-${VERSION}
EXTRACT_SUFX=	.phar
EXTRACT_ONLY=
PKGNAME-main=	pear-${VERSION}
PKGNAME-utils=	pear-utils-${VERSION}
WRKDIST=	${WRKDIR}
CATEGORIES=	www devel

HOMEPAGE=	http://pear.php.net/
MASTER_SITES=	https://spacehopper.org/mirrors/

MAINTAINER=	Robert Nagy <robert@@openbsd.org>

PERMIT_PACKAGE_CDROM=	Yes

MULTI_PACKAGES=		-main -utils

MODULES=		lang/php
BUILD_DEPENDS=		${_MODPHP_BUILD_DEPENDS}
RUN_DEPENDS-main=	www/pear,-utils

# Most of pear have to live in /var/www where apache is chroot'ed to.
PREFIX-main=	${VARBASE}/www
PREFIX-utils=	/usr/local

NO_TEST=	Yes

BUILD_DEPENDS=	devel/p5-Expect
SUBST_VARS=	MODPHP_BIN

do-extract:
	cp ${FULLDISTDIR}/${DISTFILES} ${WRKSRC}/go-pear.phar

do-build:
	cd ${WRKSRC}; perl ${FILESDIR}/run-go-pear ${WRKINST} ${PREFIX} ${MODPHP_BIN}

do-install:
	@@find ${WRKINST}${PREFIX-main} -name "*.php" -exec perl -pi -e "s,${WRKINST},,g" {} \;
	@@find ${WRKINST}${PREFIX-utils}/bin -type f -exec perl -pi -e "s,${WRKINST},,g" {} \;

	@@for _f in patch-usr_local_bin_pear patch-usr_local_bin_peardev \
		patch-usr_local_bin_pecl patch-var_www_pear_lib_PEAR_Config_php; do \
		patch -d ${WRKINST} < ${FILESDIR}/$${_f}; done
	@@find ${WRKINST}/usr/local/bin -type f -exec ${SUBST_CMD} {} \;
	@@perl -pi -e "s,OPENBSD_PEAR_ROOT,'${PREFIX-main}/pear',g" \
		${WRKINST}${PREFIX-main}/pear/lib/PEAR/Config.php
	@@touch ${WRKINST}${PREFIX-main}/pear/.lock
	@@touch ${WRKINST}${PREFIX-main}/pear/lib/.lock
	@@rm ${PREFIX}/bin/{pear,peardev,pecl}{.beforesubst,.orig}*
	@@rmdir ${WRKINST}${PREFIX-main}/pear/{cfg,htdocs}

.include <bsd.port.mk>
@


1.23
log
@switch my distfiles mirror to https
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.22 2015/06/06 09:03:50 kili Exp $
d6 6
a11 3
VERSION=	1.9.5
DISTNAME=	pear-${VERSION}
PKGNAME-main=	${DISTNAME}
d13 1
a14 2
REVISION-main=	0
REVISION-utils=	1
a32 1
NO_BUILD=	Yes
d35 1
d38 5
a42 4
pre-fake:
	@@perl -pi -e "s,%%BUNDLEDIR%%,${WRKSRC}/go-pear-bundle,g" ${WRKSRC}/go-pear
	@@perl -pi -e "s,%%PREFIX%%,${WRKINST}${PREFIX-main},g" ${WRKSRC}/go-pear
	@@perl -pi -e "s,%%TMPDIR%%,${TMPDIR}/go-pear,g" ${WRKSRC}/go-pear
a44 6
	@@${MODPHP_BIN} -q ${WRKSRC}/go-pear

	@@mv ${WRKINST}${PREFIX-main}/bin ${WRKINST}${PREFIX-utils}/
	@@mv ${WRKINST}${PREFIX-main}/share/doc/pear ${WRKINST}${PREFIX-utils}/share/doc/
	@@rm -rf ${WRKINST}${PREFIX-main}/share ${WRKINST}${PREFIX-main}/etc

d56 2
@


1.22
log
@Bump REVISION-utils for real, and replace REVISION by REVISION-main.
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.21 2015/06/05 06:00:22 robert Exp $
d15 1
a15 1
MASTER_SITES=	http://spacehopper.org/mirrors/
@


1.21
log
@bump revision due to the change of the default php version to 5.6
ok aja@@
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.20 2014/11/06 17:13:40 sthen Exp $
a6 1
REVISION=	0
d11 2
a12 1
REVISION-utils=	0
@


1.20
log
@bump REVISION for php version switch
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.19 2014/10/30 11:57:58 sthen Exp $
d12 1
@


1.19
log
@update to pear 1.9.5, ok robert@@

tarball is hand-updated from the previous one. the updated dependencies
mean this now works with php 5.5. tested with all of pecl-* and pear-*,
all good with 5.4, only APC fails with 5.5 (and it's no longer supported
there; PHP 5.5 has its own opcode cache anyway)
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.18 2013/08/12 04:11:21 robert Exp $
d7 1
@


1.18
log
@bump REVISION due to the php update
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.17 2013/07/05 09:34:35 jasper Exp $
d6 1
a6 1
VERSION=	1.9.4
a11 2
REVISION=	2

d13 1
a13 1
MASTER_SITES=	http://blade2k.humppa.hu/
@


1.17
log
@use ${VARBASE} instead of hardcoding /var
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.16 2013/03/11 11:44:47 espie Exp $
d12 1
a12 1
REVISION=	1
@


1.16
log
@PERMIT_* / REGRESS->TEST sweep
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.15 2011/12/20 15:21:30 giovanni Exp $
d28 1
a28 1
PREFIX-main=	/var/www
@


1.15
log
@
Let pear install modules even with USE_SYSTRACE=Yes
spotted an ok sthen@@
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.14 2011/11/16 15:56:37 robert Exp $
a19 3
PERMIT_PACKAGE_FTP=	Yes
PERMIT_DISTFILES_CDROM=	Yes
PERMIT_DISTFILES_FTP=	Yes
d32 1
a32 1
NO_REGRESS=	Yes
@


1.14
log
@switch php to version 5.3 by default
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.13 2011/11/16 13:29:13 robert Exp $
d12 1
a12 1
REVISION=	0
d61 1
@


1.13
log
@update to 1.9.4
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.12 2011/09/16 12:00:07 espie Exp $
d11 2
@


1.12
log
@normalize pkgpath
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.11 2011/07/11 06:22:49 robert Exp $
d6 1
a6 1
VERSION=	1.7.2
a11 5
EXTRACT_SUFX=	.tar.bz2

REVISION-main=	2
REVISION-utils=	3

d13 1
a13 2
MASTER_SITES=	http://freebsd.unixfreunde.de/sources/ \
		${MASTER_SITE_FREEBSD_LOCAL:=miwi/}
d37 5
d43 1
a43 2
	@@perl -pi -e "s,%%PREFIX%%,${WRKINST}${PREFIX-main},g" ${WRKSRC}/go-pear
	@@${MODPHP_BIN} -nq ${WRKSRC}/go-pear
d52 1
a52 1
	for _f in patch-usr_local_bin_pear patch-usr_local_bin_peardev \
d55 1
a55 1
	find ${WRKINST}/usr/local/bin -type f -exec ${SUBST_CMD} {} \;
@


1.11
log
@unbreak after MODPHP_BUILDDEP support
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.10 2011/07/08 18:40:45 robert Exp $
d15 1
a15 1
REVISION-utils=	2
@


1.10
log
@cope with changed php binary path
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.9 2011/07/08 18:23:17 robert Exp $
d14 2
a15 2
REVISION-main=	1
REVISION-utils=	1
d31 1
@


1.9
log
@switch to lang/php
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.8 2010/11/22 08:36:52 espie Exp $
d14 2
a15 2
REVISION-main=	0
REVISION-utils=	0
d40 2
d50 1
a50 1
	@@find ${WRKINST}${PREFIX-main} -name "*.php" -exec perl -pi -e "s,${WRKINST},,g" {} \; 
d53 4
a56 1
	@@patch -d ${WRKINST}${PREFIX-main}/pear < ${FILESDIR}/patch-lib_PEAR_Config_php
@


1.8
log
@new depends
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.7 2010/08/31 08:15:45 ajacoutot Exp $
d14 3
d30 2
a31 3
BUILD_DEPENDS=		www/php5/core
RUN_DEPENDS-main=	www/php5/core \
			www/pear,-utils
d42 1
a42 1
	@@${LOCALBASE}/bin/php -nq ${WRKSRC}/go-pear
@


1.7
log
@Remove PKGNAME=${DISTNAME} constructs where possible, as this is the
default anyway.

ok jasper@@
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.6 2008/08/22 14:48:53 robert Exp $
d27 3
a29 3
BUILD_DEPENDS=		:php5-core-*:www/php5/core
RUN_DEPENDS-main=	:php5-core-*:www/php5/core \
			::www/pear,-utils
@


1.6
log
@update to pear 1.7.2 which is the current stable
version.
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.5 2007/09/13 14:30:23 sthen Exp $
a7 1
PKGNAME=	${DISTNAME}
@


1.5
log
@fix pear build with safe_mode=on in php.ini by using -n to ignore
the ini file. package version not bumped as no plist_db conflicts or
package change (it just failed to build if safe mode was enabled in
/var/www/conf/php.ini).

checked pear modules and stuff.

"please build all the pear modules and stuff if it works
ok robert@@"
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.4 2007/05/31 10:32:08 kili Exp $
d6 1
a6 1
VERSION=	1.5.0
d9 2
a10 2
PKGNAME-main=	${DISTNAME}p1
PKGNAME-utils=	pear-utils-${VERSION}p0
d16 2
a17 1
MASTER_SITES=	${MASTER_SITE_FREEBSD_LOCAL:=ale/}
d53 1
@


1.4
log
@
Don't use RUN_DEPENDS=${BUILD_DEPENDS}.
I think that was the last one in the tree.

ok robert@@
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.3 2007/05/07 13:46:59 bernd Exp $
d3 2
a4 2
COMMENT-main=	"base classes for common PHP tasks"
COMMENT-utils=	"utilities for managing pear extensions"
d40 1
a40 1
	@@${LOCALBASE}/bin/php -q ${WRKSRC}/go-pear
@


1.3
log
@Add @@conflict markers. robert@@ will teach php4 how to use the pear port
later.

ok robert@@
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.2 2007/03/20 11:12:22 robert Exp $
d9 1
a9 1
PKGNAME-main=	${DISTNAME}p0
d28 1
a28 1
RUN_DEPENDS-main=	${BUILD_DEPENDS} \
@


1.2
log
@do not install the pear.conf file as it is not needed and it just
breaks things
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.1.1.1 2007/03/19 23:13:23 robert Exp $
d9 2
a10 2
PKGNAME-main=	${DISTNAME}
PKGNAME-utils=	pear-utils-${VERSION}
@


1.1
log
@Initial revision
@
text
@d1 1
a1 1
# $OpenBSD$
a43 1
	@@mv ${WRKINST}${PREFIX-main}/etc/pear.conf ${WRKINST}${PREFIX-utils}/share/doc/pear
@


1.1.1.1
log
@import of pear-1.5.0;

This port is going to replace the -pear subpackage of www/php5/core.
We have been planning this for a long time now.
Currently is not hooked to the builds, because it needs more testing.
@
text
@@
