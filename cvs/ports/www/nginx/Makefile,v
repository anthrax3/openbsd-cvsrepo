head	1.112;
access;
symbols
	OPENBSD_6_1:1.108.0.2
	OPENBSD_6_1_BASE:1.108
	OPENBSD_6_0:1.98.0.2
	OPENBSD_6_0_BASE:1.98
	OPENBSD_5_9:1.89.0.2
	OPENBSD_5_9_BASE:1.89
	OPENBSD_5_8:1.81.0.4
	OPENBSD_5_8_BASE:1.81
	OPENBSD_5_7:1.72.0.2
	OPENBSD_5_7_BASE:1.72
	OPENBSD_5_6:1.54.0.4
	OPENBSD_5_6_BASE:1.54
	OPENBSD_5_5:1.54.0.2
	OPENBSD_5_5_BASE:1.54
	OPENBSD_5_4:1.53.0.4
	OPENBSD_5_4_BASE:1.53
	OPENBSD_5_3:1.53.0.2
	OPENBSD_5_3_BASE:1.53
	OPENBSD_5_2:1.52.0.2
	OPENBSD_5_2_BASE:1.52
	OPENBSD_5_1_BASE:1.48
	OPENBSD_5_1:1.48.0.2
	OPENBSD_5_0:1.42.0.2
	OPENBSD_5_0_BASE:1.42
	OPENBSD_4_9:1.37.0.2
	OPENBSD_4_9_BASE:1.37
	OPENBSD_4_8:1.25.0.2
	OPENBSD_4_8_BASE:1.25
	OPENBSD_4_7:1.24.0.2
	OPENBSD_4_7_BASE:1.24
	OPENBSD_4_6:1.17.0.2
	OPENBSD_4_6_BASE:1.17
	OPENBSD_4_5:1.11.0.2
	OPENBSD_4_5_BASE:1.11
	OPENBSD_4_4:1.8.0.2
	OPENBSD_4_4_BASE:1.8
	OPENBSD_4_3:1.5.0.2
	OPENBSD_4_3_BASE:1.5
	merdely_20070904:1.1.1.1
	merdely:1.1.1;
locks; strict;
comment	@# @;


1.112
date	2017.07.26.22.45.31;	author sthen;	state Exp;
branches;
next	1.111;
commitid	tD4MFrpYYDDL2UFT;

1.111
date	2017.07.16.19.19.03;	author espie;	state Exp;
branches;
next	1.110;
commitid	tt0GhWK5c4uf9ILG;

1.110
date	2017.07.02.16.47.46;	author robert;	state Exp;
branches;
next	1.109;
commitid	zix4g9mkTprGee7Q;

1.109
date	2017.04.10.11.46.35;	author sthen;	state Exp;
branches;
next	1.108;
commitid	HY6VNZxjJWzKQFDV;

1.108
date	2017.01.31.16.36.21;	author sthen;	state Exp;
branches;
next	1.107;
commitid	7teslJUzGN9I9ErB;

1.107
date	2017.01.29.14.38.43;	author sthen;	state Exp;
branches;
next	1.106;
commitid	gwOTHMQ126JQ2XiH;

1.106
date	2017.01.29.14.38.00;	author sthen;	state Exp;
branches;
next	1.105;
commitid	lI1aurkABZZ5YszW;

1.105
date	2017.01.09.15.56.27;	author naddy;	state Exp;
branches;
next	1.104;
commitid	ND13vLq7Qf37Z0Al;

1.104
date	2017.01.08.19.38.12;	author robert;	state Exp;
branches;
next	1.103;
commitid	Br7WJVl93zmJ6pJW;

1.103
date	2017.01.08.19.37.13;	author robert;	state Exp;
branches;
next	1.102;
commitid	vCT1SZMmuZDT1ImS;

1.102
date	2016.11.04.22.13.43;	author jeremy;	state Exp;
branches;
next	1.101;
commitid	Oee7bZXxLwPn3r9t;

1.101
date	2016.10.26.08.06.59;	author robert;	state Exp;
branches;
next	1.100;
commitid	UN53HdoGxnicQLJg;

1.100
date	2016.09.07.16.54.56;	author jeremy;	state Exp;
branches;
next	1.99;
commitid	NCi2n2otVI1t3jVh;

1.99
date	2016.08.14.10.52.07;	author jasper;	state Exp;
branches;
next	1.98;
commitid	QrYaEElhFSKbNJnZ;

1.98
date	2016.06.02.13.22.52;	author robert;	state Exp;
branches;
next	1.97;
commitid	AkqnrWI1Bhk3rvET;

1.97
date	2016.05.06.15.07.38;	author jasper;	state Exp;
branches;
next	1.96;
commitid	oRPGa0aoXRQm16BR;

1.96
date	2016.04.27.21.20.05;	author robert;	state Exp;
branches;
next	1.95;
commitid	oUpUpGD3viOiVwNG;

1.95
date	2016.04.20.18.42.12;	author robert;	state Exp;
branches;
next	1.94;
commitid	PL2LOOhD85vRqXoN;

1.94
date	2016.04.18.22.45.10;	author tj;	state Exp;
branches;
next	1.93;
commitid	35asX1IHSo587Pbe;

1.93
date	2016.04.06.16.06.28;	author robert;	state Exp;
branches;
next	1.92;
commitid	Ws4XuTo6v4p7sKyb;

1.92
date	2016.04.01.18.18.21;	author robert;	state Exp;
branches;
next	1.91;
commitid	8xB1L46bgKPfRuOp;

1.91
date	2016.02.27.12.47.32;	author robert;	state Exp;
branches;
next	1.90;
commitid	Qstge1zKQsq3Drkh;

1.90
date	2016.02.25.02.19.14;	author jsg;	state Exp;
branches;
next	1.89;
commitid	7EqluVlje3WtS3zf;

1.89
date	2016.01.26.20.42.56;	author robert;	state Exp;
branches
	1.89.2.1;
next	1.88;
commitid	ITxeAFQONlLGhGZ8;

1.88
date	2015.12.09.16.46.01;	author robert;	state Exp;
branches;
next	1.87;
commitid	WHxe5Ib7vzfbp38Y;

1.87
date	2015.12.02.10.21.48;	author ajacoutot;	state Exp;
branches;
next	1.86;
commitid	eLNpMtaGK1F3nU5F;

1.86
date	2015.11.20.19.49.45;	author jca;	state Exp;
branches;
next	1.85;
commitid	EGs64ugemEl473zK;

1.85
date	2015.11.18.20.39.50;	author sthen;	state Exp;
branches;
next	1.84;
commitid	irxh8PySumX7viSd;

1.84
date	2015.11.02.08.19.36;	author robert;	state Exp;
branches;
next	1.83;
commitid	aOsODAsZnqgL0z7a;

1.83
date	2015.09.22.16.50.02;	author robert;	state Exp;
branches;
next	1.82;
commitid	qHZ1HieLKHcJPiYs;

1.82
date	2015.08.20.08.58.14;	author robert;	state Exp;
branches;
next	1.81;
commitid	ma0fIW68ZgogsKKq;

1.81
date	2015.07.29.17.21.11;	author ajacoutot;	state Exp;
branches
	1.81.4.1;
next	1.80;
commitid	U0XB73P9BN60eE4s;

1.80
date	2015.07.26.01.34.53;	author jeremy;	state Exp;
branches;
next	1.79;
commitid	0Vf1RxwNUXBeSMNZ;

1.79
date	2015.07.17.00.06.32;	author sthen;	state Exp;
branches;
next	1.78;
commitid	h2uhlWlhhfiag0gc;

1.78
date	2015.07.15.22.35.43;	author ajacoutot;	state Exp;
branches;
next	1.77;
commitid	ZnUKzT1FeCGM48kI;

1.77
date	2015.07.14.19.10.45;	author robert;	state Exp;
branches;
next	1.76;
commitid	cLvQBxUU08ZuW80B;

1.76
date	2015.06.19.05.41.35;	author robert;	state Exp;
branches;
next	1.75;
commitid	dULd9hl5RjVWRw4e;

1.75
date	2015.06.01.14.00.24;	author robert;	state Exp;
branches;
next	1.74;
commitid	64ElcGAepyt1eKx6;

1.74
date	2015.04.14.17.39.18;	author robert;	state Exp;
branches;
next	1.73;
commitid	QEHSs5u3oelJdHRc;

1.73
date	2015.03.31.18.20.20;	author robert;	state Exp;
branches;
next	1.72;
commitid	Tm9XyCyOu2DczLCJ;

1.72
date	2015.02.12.17.55.55;	author sthen;	state Exp;
branches
	1.72.2.1;
next	1.71;
commitid	Gu6GGpDUPa2SzKJP;

1.71
date	2015.01.02.19.32.39;	author robert;	state Exp;
branches;
next	1.70;
commitid	lJxqUuM2GNz0xACU;

1.70
date	2014.12.10.16.44.32;	author sthen;	state Exp;
branches;
next	1.69;
commitid	bOKkrgQB0xtw8ydo;

1.69
date	2014.12.08.17.07.07;	author robert;	state Exp;
branches;
next	1.68;
commitid	8oD6SPkqImLwbsro;

1.68
date	2014.11.09.20.46.19;	author sthen;	state Exp;
branches;
next	1.67;
commitid	tbvnFjONwcsR85Ct;

1.67
date	2014.11.08.00.02.45;	author sthen;	state Exp;
branches;
next	1.66;
commitid	mj8hZpbHvm0gZA8e;

1.66
date	2014.10.31.14.40.59;	author robert;	state Exp;
branches;
next	1.65;
commitid	5OV3UuDOQap8YzIP;

1.65
date	2014.10.23.12.13.12;	author sthen;	state Exp;
branches;
next	1.64;
commitid	jQCiePNARms9IfsU;

1.64
date	2014.10.09.18.46.44;	author jeremy;	state Exp;
branches;
next	1.63;
commitid	NeIsAfU2hbWCQuLg;

1.63
date	2014.10.08.02.32.43;	author jeremy;	state Exp;
branches;
next	1.62;
commitid	pcEBygN4WNdRlpmI;

1.62
date	2014.10.05.11.43.53;	author robert;	state Exp;
branches;
next	1.61;
commitid	vfG6TiwHMIBuOUPk;

1.61
date	2014.09.21.14.00.16;	author robert;	state Exp;
branches;
next	1.60;
commitid	fynSnk5LcEOq1z9T;

1.60
date	2014.09.16.18.37.57;	author robert;	state Exp;
branches;
next	1.59;
commitid	EcXpa3N3ioig4jDx;

1.59
date	2014.09.09.14.05.48;	author sthen;	state Exp;
branches;
next	1.58;
commitid	w2JJgh9xh2JAWyXg;

1.58
date	2014.09.09.13.48.28;	author sthen;	state Exp;
branches;
next	1.57;
commitid	vtDVj30kfNFKowNU;

1.57
date	2014.08.27.06.46.49;	author ajacoutot;	state Exp;
branches;
next	1.56;
commitid	EgWPCQ6ECli0Ppnk;

1.56
date	2014.08.26.19.48.06;	author robert;	state Exp;
branches;
next	1.55;
commitid	Rxd8gSExVfEEQmSV;

1.55
date	2014.08.26.19.43.58;	author robert;	state Exp;
branches;
next	1.54;
commitid	Y2vy3KpSALTztMGt;

1.54
date	2014.01.06.16.47.32;	author ajacoutot;	state Exp;
branches;
next	1.53;

1.53
date	2012.09.11.16.01.45;	author sthen;	state Exp;
branches;
next	1.52;

1.52
date	2012.04.17.13.00.28;	author gsoares;	state Exp;
branches;
next	1.51;

1.51
date	2012.03.16.00.44.06;	author william;	state Exp;
branches;
next	1.50;

1.50
date	2012.02.19.15.02.08;	author robert;	state Exp;
branches;
next	1.49;

1.49
date	2012.02.18.16.40.18;	author sthen;	state Exp;
branches;
next	1.48;

1.48
date	2012.01.18.10.00.52;	author sthen;	state Exp;
branches
	1.48.2.1;
next	1.47;

1.47
date	2011.12.13.18.39.38;	author jeremy;	state Exp;
branches;
next	1.46;

1.46
date	2011.11.15.19.17.15;	author sthen;	state Exp;
branches;
next	1.45;

1.45
date	2011.11.14.19.24.48;	author robert;	state Exp;
branches;
next	1.44;

1.44
date	2011.10.13.12.09.57;	author jasper;	state Exp;
branches;
next	1.43;

1.43
date	2011.09.06.00.54.47;	author william;	state Exp;
branches;
next	1.42;

1.42
date	2011.06.14.03.08.05;	author william;	state Exp;
branches;
next	1.41;

1.41
date	2011.05.17.03.31.00;	author william;	state Exp;
branches;
next	1.40;

1.40
date	2011.04.09.01.21.55;	author william;	state Exp;
branches;
next	1.39;

1.39
date	2011.03.09.19.37.47;	author ajacoutot;	state Exp;
branches;
next	1.38;

1.38
date	2011.03.09.18.51.49;	author ajacoutot;	state Exp;
branches;
next	1.37;

1.37
date	2010.12.27.14.50.24;	author ajacoutot;	state Exp;
branches;
next	1.36;

1.36
date	2010.12.24.10.40.06;	author ajacoutot;	state Exp;
branches;
next	1.35;

1.35
date	2010.12.11.08.05.38;	author ajacoutot;	state Exp;
branches;
next	1.34;

1.34
date	2010.11.22.08.36.49;	author espie;	state Exp;
branches;
next	1.33;

1.33
date	2010.11.10.08.18.18;	author sthen;	state Exp;
branches;
next	1.32;

1.32
date	2010.11.08.23.50.31;	author jeremy;	state Exp;
branches;
next	1.31;

1.31
date	2010.11.04.23.33.45;	author sthen;	state Exp;
branches;
next	1.30;

1.30
date	2010.11.04.07.54.51;	author ajacoutot;	state Exp;
branches;
next	1.29;

1.29
date	2010.11.04.07.39.44;	author robert;	state Exp;
branches;
next	1.28;

1.28
date	2010.11.04.01.41.11;	author dlg;	state Exp;
branches;
next	1.27;

1.27
date	2010.09.25.03.34.40;	author william;	state Exp;
branches;
next	1.26;

1.26
date	2010.08.31.20.05.21;	author edd;	state Exp;
branches;
next	1.25;

1.25
date	2010.06.17.03.35.37;	author william;	state Exp;
branches;
next	1.24;

1.24
date	2010.03.01.04.04.50;	author william;	state Exp;
branches;
next	1.23;

1.23
date	2009.11.23.04.35.11;	author william;	state Exp;
branches;
next	1.22;

1.22
date	2009.10.30.00.42.17;	author william;	state Exp;
branches;
next	1.21;

1.21
date	2009.10.26.13.32.02;	author okan;	state Exp;
branches;
next	1.20;

1.20
date	2009.09.16.22.53.08;	author william;	state Exp;
branches;
next	1.19;

1.19
date	2009.08.20.20.40.11;	author bernd;	state Exp;
branches;
next	1.18;

1.18
date	2009.08.12.00.11.57;	author william;	state Exp;
branches;
next	1.17;

1.17
date	2009.06.24.07.38.30;	author sthen;	state Exp;
branches
	1.17.2.1;
next	1.16;

1.16
date	2009.06.23.20.24.12;	author sthen;	state Exp;
branches;
next	1.15;

1.15
date	2009.06.04.04.06.43;	author william;	state Exp;
branches;
next	1.14;

1.14
date	2009.05.23.22.33.44;	author sthen;	state Exp;
branches;
next	1.13;

1.13
date	2009.05.21.11.44.08;	author steven;	state Exp;
branches;
next	1.12;

1.12
date	2009.03.22.20.19.32;	author steven;	state Exp;
branches;
next	1.11;

1.11
date	2008.12.26.17.30.23;	author steven;	state Exp;
branches
	1.11.2.1;
next	1.10;

1.10
date	2008.12.07.20.08.55;	author merdely;	state Exp;
branches;
next	1.9;

1.9
date	2008.09.01.15.47.43;	author sthen;	state Exp;
branches;
next	1.8;

1.8
date	2008.05.13.18.46.07;	author merdely;	state Exp;
branches;
next	1.7;

1.7
date	2008.05.07.23.08.24;	author merdely;	state Exp;
branches;
next	1.6;

1.6
date	2008.03.29.13.50.39;	author bernd;	state Exp;
branches;
next	1.5;

1.5
date	2008.02.17.18.54.48;	author bernd;	state Exp;
branches;
next	1.4;

1.4
date	2007.12.31.02.20.01;	author okan;	state Exp;
branches;
next	1.3;

1.3
date	2007.10.08.19.23.43;	author merdely;	state Exp;
branches;
next	1.2;

1.2
date	2007.09.22.21.06.05;	author sthen;	state Exp;
branches;
next	1.1;

1.1
date	2007.09.04.21.58.26;	author merdely;	state Exp;
branches
	1.1.1.1;
next	;

1.1.1.1
date	2007.09.04.21.58.26;	author merdely;	state Exp;
branches;
next	;

1.11.2.1
date	2009.09.19.01.40.15;	author william;	state Exp;
branches;
next	;

1.17.2.1
date	2009.11.02.01.46.41;	author william;	state Exp;
branches;
next	1.17.2.2;

1.17.2.2
date	2009.11.26.01.42.36;	author william;	state Exp;
branches;
next	1.17.2.3;

1.17.2.3
date	2009.12.05.23.14.40;	author william;	state Exp;
branches;
next	;

1.48.2.1
date	2012.04.17.13.04.34;	author gsoares;	state Exp;
branches;
next	;

1.72.2.1
date	2016.01.28.14.41.19;	author robert;	state Exp;
branches;
next	;
commitid	vDM5DLAz5aDP6KWU;

1.81.4.1
date	2016.01.28.12.11.49;	author robert;	state Exp;
branches;
next	;
commitid	y6YUuejDJTrROdGE;

1.89.2.1
date	2016.06.04.09.17.17;	author robert;	state Exp;
branches;
next	;
commitid	ngX2y0JG2xE4qM0s;


desc
@@


1.112
log
@bump LIBCXX/LIBECXX/COMPILER_LIBCXX ports.
@
text
@# $OpenBSD: Makefile,v 1.111 2017/07/16 19:19:03 espie Exp $

BROKEN-arm=	src/core/ngx_rwlock.c:116:2: error: \#error ngx_atomic_cmp_set() is not defined!
BROKEN-hppa=	src/core/ngx_rwlock.c:116:2: error: \#error ngx_atomic_cmp_set() is not defined!

COMMENT-main=		robust and small HTTP server and mail proxy server
COMMENT-image_filter=	nginx image filter module
COMMENT-geoip=		nginx GeoIP module
COMMENT-xslt=		nginx XSLT filter module
COMMENT-mailproxy=	nginx mail proxy module
COMMENT-stream=		nginx TCP/UDP proxy module
COMMENT-naxsi=		nginx web application firewall module
COMMENT-lua=		nginx lua scripting module
COMMENT-perl=		nginx perl scripting module
COMMENT-passenger=	nginx passenger (ruby/python/nodejs) integration module

VERSION=	1.12.0
DISTNAME=	nginx-${VERSION}
CATEGORIES=	www

PKGNAME-main=		${DISTNAME}
PKGNAME-image_filter=	nginx-image_filter-${VERSION}
PKGNAME-geoip=		nginx-geoip-${VERSION}
PKGNAME-xslt=		nginx-xslt-${VERSION}
PKGNAME-mailproxy= 	nginx-mailproxy-${VERSION}
PKGNAME-stream=		nginx-stream-${VERSION}
PKGNAME-naxsi=		nginx-naxsi-${VERSION}
PKGNAME-lua=		nginx-lua-${VERSION}
PKGNAME-perl=		nginx-perl-${VERSION}
PKGNAME-passenger=	nginx-passenger-${VERSION}
REVISION-geoip=		0
REVISION-image_filter=	0
REVISION-mailproxy=     0
REVISION-main=		0
REVISION-naxsi=		0
REVISION-passenger=	0
REVISION-perl=		0
REVISION-stream=	0
REVISION-xslt=		0

MASTER_SITES=	http://nginx.org/download/
MASTER_SITES0=	https://github.com/simpl/ngx_devel_kit/archive/
MASTER_SITES1=	https://github.com/nbs-system/naxsi/archive/
MASTER_SITES2=	https://github.com/openresty/lua-nginx-module/archive/
MASTER_SITES3=	https://raw.githubusercontent.com/rnagy/nginx_chroot_patch/master/

DISTFILES=	${DISTNAME}${EXTRACT_SUFX} \
		ngx_devel_kit-v0.3.0.tar.gz{v0.3.0.tar.gz}:0 \
		naxsi-0.55.1.tar.gz{0.55.1.tar.gz}:1 \
		lua-nginx-module-v0.10.6.tar.gz{v0.10.6.tar.gz}:2

HOMEPAGE=	http://nginx.org/

MAINTAINER=	Robert Nagy <robert@@openbsd.org>, \
		William Yodlowsky <william@@openbsd.org>

# BSD-like
PERMIT_PACKAGE_CDROM=	yes

# XXX -lua removed following libressl api change; re-add to
# MULTI_PACKAGES when this is worked-around
MULTI_PACKAGES =	-main -image_filter -geoip -xslt -mailproxy -stream -naxsi -perl -passenger	# -lua

FLAVOR ?=
PSEUDO_FLAVORS =	no_lua

.include <bsd.port.arch.mk>

WANTLIB-main=		c z pcre ssl crypto
WANTLIB-mailproxy=
WANTLIB-stream=
WANTLIB-image_filter=	gd
WANTLIB-geoip=		GeoIP
WANTLIB-xslt=		exslt xml2 xslt
WANTLIB-naxsi=
WANTLIB-lua=		${MODLUA_WANTLIB} m
WANTLIB-perl=		c m perl
WANTLIB-passenger=	m pthread ${COMPILER_LIBCXX}

BUILD_DEPENDS+=		${MODRUBY_PKG_PREFIX}-passenger-*:www/ruby-passenger

LIB_DEPENDS-main=	devel/pcre
LIB_DEPENDS-xslt=	textproc/libxml \
			textproc/libxslt
LIB_DEPENDS-image_filter=graphics/gd
LIB_DEPENDS-geoip=	net/GeoIP

RUN_DEPENDS-main=	# blank (override addition from lua.port.mk)
RUN_DEPENDS-mailproxy=	www/nginx,-main=${VERSION}
RUN_DEPENDS-stream=	www/nginx,-main=${VERSION}
RUN_DEPENDS-image_filter=www/nginx,-main=${VERSION}
RUN_DEPENDS-geoip=	www/nginx,-main=${VERSION}
RUN_DEPENDS-xslt=	www/nginx,-main=${VERSION}
RUN_DEPENDS-naxsi=	www/nginx,-main=${VERSION}
RUN_DEPENDS-lua=	www/nginx,-main=${VERSION}
RUN_DEPENDS-perl=	www/nginx,-main=${VERSION}
RUN_DEPENDS-passenger=	www/nginx,-main=${VERSION} \
			ruby-passenger-*|ruby21-passenger-*|ruby22-passenger-*|ruby23-passenger-*:www/ruby-passenger

NGINX_DIR=	/var/www
SUBST_VARS=	NGINX_DIR
NGINX_MODULES_DIR=	${NGINX_DIR}/modules

PREFIX-mailproxy=	${NGINX_MODULES_DIR}
PREFIX-stream=		${NGINX_MODULES_DIR}
PREFIX-image_filter=	${NGINX_MODULES_DIR}
PREFIX-geoip=		${NGINX_MODULES_DIR}
PREFIX-xslt=		${NGINX_MODULES_DIR}
PREFIX-lua=		${NGINX_MODULES_DIR}
PREFIX-passenger=	${NGINX_MODULES_DIR}

CFLAGS+=	-Wall -Wpointer-arith \
		-I "${LOCALBASE}/include/libxml2" \
		-I "${LOCALBASE}/include" \
		-L "${X11BASE}/lib"

MODULES+=		lang/ruby
MODRUBY_BUILDDEP=	No
MODRUBY_RUNDEP=		No

PATCHFILES+=		nginx-${VERSION}-chroot.patch:3
PATCH_DIST_STRIP=	-p1

CONFIGURE_STYLE=	simple

.if ${BUILD_PACKAGES:M-lua}
MODULES+=		lang/lua
CONFIGURE_ENV+=		MODLUA_INCL_DIR=${MODLUA_INCL_DIR} \
			MODLUA_LIB=${MODLUA_LIB}
CONFIGURE_ARGS+=	--add-dynamic-module=${WRKSRC}/lua-nginx-module
.endif

CONFIGURE_ARGS+=	--prefix=${NGINX_DIR} \
			--conf-path=${SYSCONFDIR}/nginx/nginx.conf \
			--sbin-path=${PREFIX}/sbin/nginx \
			--pid-path=/var/run/nginx.pid \
			--lock-path=/var/run/nginx.lock \
			--http-log-path=logs/access.log \
			--error-log-path=logs/error.log \
			--http-client-body-temp-path=${NGINX_DIR}/cache/client_body_temp \
			--http-proxy-temp-path=${NGINX_DIR}/cache/proxy_temp \
			--http-fastcgi-temp-path=${NGINX_DIR}/cache/fastcgi_temp \
			--http-scgi-temp-path=${NGINX_DIR}/cache/scgi_temp \
			--http-uwsgi-temp-path=${NGINX_DIR}/cache/uwsgi_temp \
			--user=www \
			--group=www \
			--with-http_image_filter_module=dynamic \
			--with-http_geoip_module=dynamic \
			--with-http_gzip_static_module \
			--with-http_gunzip_module \
			--with-http_perl_module=dynamic \
			--with-http_realip_module \
			--with-http_slice_module \
			--with-http_ssl_module \
			--with-http_stub_status_module \
			--with-http_v2_module \
			--with-http_xslt_module=dynamic \
			--with-mail=dynamic \
			--with-ipv6 \
			--with-stream=dynamic \
			--add-dynamic-module=${WRKSRC}/naxsi/naxsi_src/ \
			--add-dynamic-module=${WRKSRC}/ngx_devel_kit \
			--add-dynamic-module=${LOCALBASE}/lib/phusion-passenger${GEM_BIN_SUFFIX}/src/nginx_module

SUBSTFILES=		conf/nginx.conf \
			lua-nginx-module/config

NO_TEST=		Yes
ALL_TARGET=

pre-patch:
	cd ${WRKSRC} && \
	    mv ../naxsi-* naxsi
	cd ${WRKSRC} && \
	    mv ../ngx_devel_kit-* ngx_devel_kit && \
	    mv ../lua-nginx-module-* lua-nginx-module

pre-configure:
	@@cd ${WRKSRC} && ${SUBST_CMD} ${SUBSTFILES}

do-install:
	${INSTALL_DATA_DIR} ${PREFIX}/share/nginx/
	${INSTALL_PROGRAM} ${WRKSRC}/objs/nginx ${PREFIX}/sbin
	${INSTALL_MAN} ${WRKSRC}/objs/nginx.8 ${PREFIX}/man/man8/
.for i in koi-win koi-utf win-utf mime.types nginx.conf \
	fastcgi_params scgi_params uwsgi_params
	${INSTALL_DATA} ${WRKSRC}/conf/${i} ${PREFIX}/share/nginx/
.endfor
	${INSTALL_DATA} ${WRKSRC}/naxsi/naxsi_config/naxsi_core.rules \
		${PREFIX}/share/nginx/
	${INSTALL_DATA_DIR} ${PREFIX}/share/nginx/html/
	${INSTALL_DATA} ${WRKSRC}/html/* ${PREFIX}/share/nginx/html/
	${INSTALL_DATA_DIR} ${WRKINST}/var/www/modules/
	${INSTALL_DATA} ${WRKSRC}/objs/*.so ${WRKINST}/var/www/modules/
	${INSTALL_DATA_DIR} ${PREFIX}/libdata/perl5/site_perl/${ARCH}-openbsd/auto/
	${INSTALL_DATA} ${WRKSRC}/objs/src/http/modules/perl/blib/lib/nginx.pm \
		${PREFIX}/libdata/perl5/site_perl/${ARCH}-openbsd/
	${INSTALL_DATA} ${WRKSRC}/objs/src/http/modules/perl/blib/arch/auto/nginx/nginx.so \
		${PREFIX}/libdata/perl5/site_perl/${ARCH}-openbsd/

.include <bsd.port.mk>
@


1.111
log
@use COMPILER_LIBCXX where applicable
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.110 2017/07/02 16:47:46 robert Exp $
d31 9
@


1.110
log
@update to 1.12.0
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.109 2017/04/10 11:46:35 sthen Exp $
d69 1
a69 1
WANTLIB-passenger=	m pthread ${LIBCXX}
@


1.109
log
@use LIBCXX
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.108 2017/01/31 16:36:21 sthen Exp $
d17 1
a17 1
VERSION=	1.10.2
a30 4

REVISION-main=	2
REVISION-perl=	0
REVISION-passenger=	0
@


1.108
log
@Disable lua in nginx differently; whilst FLAVOR?=no_lua was working for manual
builds it was unsuccessful in DPB (at least without changing ../Makefile to
add the pseudo-flavour).

While there, overwrite RUN_DEPENDS-main to avoid adding a run dependency on
lua to the main package (existing problem).
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.107 2017/01/29 14:38:43 sthen Exp $
d73 1
a73 1
WANTLIB-passenger=	m pthread stdc++
@


1.107
log
@add a comment next to FLAVOR?= explaining why
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.106 2017/01/29 14:38:00 sthen Exp $
d32 1
a32 1
REVISION-main=	1
d55 3
a57 1
MULTI_PACKAGES =	-main -image_filter -geoip -xslt -mailproxy -stream -naxsi -lua -perl -passenger
d59 1
a59 2
# t build the lua module for now, it fails following libressl changes
FLAVOR ?=		no_lua
d83 1
@


1.106
log
@add no_lua pseudo-flavour to disable building the nginx lua module.
use it by default for now, ngx_http_lua_ssl_ocsp.c cannot be built following
libressl changes (it sets tlsext_status_expected which moved to the internal
struct).  ok robert@@
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.105 2017/01/09 15:56:27 naddy Exp $
d57 1
@


1.105
log
@changing COMMENT requires a REVISION bump
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.104 2017/01/08 19:38:12 robert Exp $
d57 5
d109 1
a109 1
MODULES+=		lang/ruby lang/lua
d117 3
d122 3
a154 1
			--add-dynamic-module=${WRKSRC}/lua-nginx-module \
@


1.104
log
@enable ngx_http_gunzip_module by default; from frantisek holop
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.103 2017/01/08 19:37:13 robert Exp $
d33 2
@


1.103
log
@whitesplace cleanup; from frantisek holop
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.102 2016/11/04 22:13:43 jeremy Exp $
d32 1
a32 1
REVISION-main=	0
d129 1
@


1.102
log
@Update nginx to use new dynamic modules feature

Switch all extrnal modules to be dynamic modules, and update them to use the
latest versions.  Use separate subpackages for all dynamic modules, so you
can easily choose which nginx features you want without rebuilding nginx
with a specific combination of FLAVORs.

Switch all internal modules that can be built dynamically to use dynamic
modules.

Start building the image_filter, geoip, perl, and xlst modules as dynamic
modules.

This requires changes to your nginx configuration if you were previously
using a FLAVORed version of nginx, or using the mail or stream features.

OK robert@@ (MAINTAINER)
positive feedback from william@@ (MAINTAINER), landry@@, sthen@@
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.101 2016/10/26 08:06:59 robert Exp $
d14 2
a15 2
COMMENT-perl=		nginx perl scripting module		
COMMENT-passenger=	nginx passenger (ruby/python/nodejs) integration module		
d56 2
a57 2
WANTLIB-mailproxy=	
WANTLIB-stream=		
d60 2
a61 2
WANTLIB-xslt=		exslt xml2 xslt 
WANTLIB-naxsi=		
@


1.101
log
@update to 1.10.2
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.100 2016/09/07 16:54:56 jeremy Exp $
d6 10
a15 1
COMMENT=	robust and small HTTP server and mail proxy server
d21 13
d35 1
a35 1
MASTER_SITES0=	http://dropbox.eait.uq.edu.au/uqdgwynn/distfiles/
d37 1
a37 1
MASTER_SITES2=	http://nerd.hu/distfiles/
d40 5
d53 14
a66 1
WANTLIB=	c crypto pcre ssl z
d68 16
a83 1
LIB_DEPENDS+=	devel/pcre
d87 1
a87 1
CFLAGS+=	-Wall -Wpointer-arith
d89 12
a100 2
FLAVORS=	lua mailproxy naxsi passenger
FLAVOR?=
d102 6
a107 14
.if !${FLAVOR:Mpassenger}
CFLAGS+=	-Werror
.endif

FLAVOR_COMMA=	${FLAVOR_EXT:S/-/,/g}
SUBST_VARS+=	FLAVOR_COMMA

# must be first option on configure line ?
.if ${FLAVOR:Mnaxsi}
DISTFILES+=		${NAXSIDISTFILES}
CONFIGURE_ARGS=		--add-module=${WRKSRC}/naxsi/naxsi_src/
.else
SUPDISTFILES+=		${NAXSIDISTFILES}
.endif
d110 2
d126 2
d129 1
d135 2
a136 2
			--with-mail \
			--with-mail_ssl_module \
d138 5
a142 17
			--with-stream

.if !${FLAVOR:Mmailproxy}
CONFIGURE_ARGS+=	--without-mail_pop3_module \
			--without-mail_imap_module \
			--without-mail_smtp_module
.endif

DISTFILES+=		${DISTNAME}${EXTRACT_SUFX}
PATCHFILES+=		nginx-${VERSION}-chroot.patch:3
PATCH_DIST_STRIP=	-p1

LUAV=			0.9.20
LUADISTFILES+=		ngx_devel_kit-0.2.19.tar.gz:0
LUADISTFILES+=		lua-nginx-module-${LUAV}.tar.gz:2
SUBSTFILES=		conf/nginx.conf
NAXSIDISTFILES+=	naxsi-0.53-2.tar.gz{0.53-2.tar.gz}:1
d144 2
a145 23
.if ${FLAVOR:Mpassenger}
MODULES+=		lang/ruby
MODRUBY_BUILDDEP=	No
MODRUBY_RUNDEP=		No
CONFIGURE_ARGS+=	--add-module=${LOCALBASE}/lib/phusion-passenger${GEM_BIN_SUFFIX}/ext/nginx
BUILD_DEPENDS+=		${MODRUBY_PKG_PREFIX}-passenger-*:www/ruby-passenger
RUN_DEPENDS+=		ruby-passenger-*|ruby21-passenger-*|ruby22-passenger-*|ruby23-passenger-*:www/ruby-passenger
WANTLIB+=		m pthread stdc++
.endif

.if ${FLAVOR:Mlua}
CONFIGURE_ARGS+=	--add-module=${WRKSRC}/ngx_devel_kit
CONFIGURE_ARGS+=	--add-module=${WRKSRC}/lua-nginx-module
CONFIGURE_ENV+=		MODLUA_INCL_DIR=${MODLUA_INCL_DIR} \
			MODLUA_LIB=${MODLUA_LIB}
MODULES+=		lang/lua
WANTLIB+=		${MODLUA_WANTLIB} m
PATCH_LIST=		patch-* lua-*
SUBSTFILES+=		lua-nginx-module/config
DISTFILES+=		${LUADISTFILES}
.else
SUPDISTFILES+=		${LUADISTFILES}
.endif
a150 1
.if ${FLAVOR:Mnaxsi}
a152 2
.endif
.if ${FLAVOR:Mlua}
d155 1
a155 2
	    mv ../lua-nginx-module-${LUAV} lua-nginx-module
.endif
d168 2
d172 7
@


1.100
log
@Fix building of passenger FLAVOR after default ruby version switch

Issued pointed out by sthen@@
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.99 2016/08/14 10:52:07 jasper Exp $
d8 1
a8 1
VERSION=	1.10.1
a9 1
REVISION=	1
@


1.99
log
@committing on behalf of william@@ (co-MAINTAINER):

- fix pre-patch target to allow multiple FLAVORs (thanks ajacoutot@@ and phessler@@)

- add 'mailproxy' FLAVOR to enable mail_pop3_module, mail_imap_module,
  and mail_smtp_module (requested by Lyndon Nerenberg)

- sort the FLAVORs alphabetically in the README

ok ajacoutot@@ robert@@
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.98 2016/06/02 13:22:52 robert Exp $
d10 1
a10 1
REVISION=	0
d101 1
a101 1
RUN_DEPENDS+=		ruby-passenger-*|ruby19-passenger-*|ruby20-passenger-*|ruby21-passenger-*|ruby22-passenger-*:www/ruby-passenger
@


1.98
log
@update to 1.10.1; fixes CVE-2016-4450

from David CARLIER
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.97 2016/05/06 15:07:38 jasper Exp $
d10 1
d35 1
a35 1
FLAVORS=	lua naxsi passenger
d77 4
a80 2
			--with-stream \
			--without-mail_pop3_module \
d83 1
d122 1
a123 1
pre-patch:
a125 1

a126 1

a127 1
pre-patch:
a130 1

@


1.97
log
@enable realip and slice modules

latter from brad
ok robert@@ (MAINTAINER)
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.96 2016/04/27 21:20:05 robert Exp $
d8 1
a8 1
VERSION=	1.10.0
a9 1
REVISION=	0
@


1.96
log
@sync with upstream's version, no change from previous release
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.95 2016/04/20 18:42:12 robert Exp $
d10 1
d69 2
@


1.95
log
@update to 1.9.15; from David CARLIER
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.94 2016/04/18 22:45:10 tj Exp $
d8 1
a8 1
VERSION=	1.9.15
@


1.94
log
@nginx isn't part of base anymore; remove mention of it being there.

ok sthen
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.93 2016/04/06 16:06:28 robert Exp $
d8 1
a8 1
VERSION=	1.9.14
a10 1
REVISION=	0
@


1.93
log
@update to 1.9.14; from David CARLIER
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.92 2016/04/01 18:18:21 robert Exp $
d11 1
@


1.92
log
@update to 1.9.12
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.91 2016/02/27 12:47:32 robert Exp $
d8 1
a8 1
VERSION=	1.9.13
@


1.91
log
@update to 1.9.12; initial diff from David CARLIER
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.90 2016/02/25 02:19:14 jsg Exp $
d8 1
a8 1
VERSION=	1.9.12
@


1.90
log
@Don't attempt to build on arm.  sync atomic builtins required.
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.89 2016/01/26 20:42:56 robert Exp $
d8 1
a8 1
VERSION=	1.9.10
d16 1
d80 1
a80 1
PATCHFILES+=		nginx_chroot-20151002.patch:2
d83 1
a83 1
LUAV=			0.9.12
d87 1
a87 1
NAXSIDISTFILES+=	naxsi-0.53-1.tar.gz{0.53-1.tar.gz}:1
@


1.89
log
@security update to 1.9.10;

fixes CVE-2016-0742/076/0747; from David CARLIER
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.88 2015/12/09 16:46:01 robert Exp $
d3 1
@


1.89.2.1
log
@apply security patch from upstream for CVE-2016-4450
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.89 2016/01/26 20:42:56 robert Exp $
a9 1
REVISION=	0
@


1.88
log
@update to 1.9.9; from David CARLIER
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.87 2015/12/02 10:21:48 ajacoutot Exp $
d7 1
a7 1
VERSION=	1.9.9
@


1.87
log
@Check configuration file validity before attempting to reload.

from Martijn van Duren
ok sthen@@ landry@@ robert@@ (maintainer)
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.86 2015/11/20 19:49:45 jca Exp $
d7 1
a7 1
VERSION=	1.9.7
a9 1
REVISION=	0
@


1.86
log
@BROKEN-hppa: #error ngx_atomic_cmp_set() is not defined!
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.85 2015/11/18 20:39:50 sthen Exp $
d10 1
@


1.85
log
@update to nginx-1.9.7, a few fixes (mostly http2) and some small new features
ok robert@@
@
text
@d1 3
a3 1
# $OpenBSD: Makefile,v 1.84 2015/11/02 08:19:36 robert Exp $
@


1.84
log
@update to 1.9.6
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.83 2015/09/22 16:50:02 robert Exp $
d5 1
a5 1
VERSION=	1.9.6
@


1.83
log
@update to 1.9.5
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.82 2015/08/20 08:58:14 robert Exp $
d5 1
a5 1
VERSION=	1.9.5
d76 1
a76 1
PATCHFILES+=		nginx_chroot-20140823.patch:2
@


1.82
log
@update to 1.9.4; from Brad Smith
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.81 2015/07/29 17:21:11 ajacoutot Exp $
d5 1
a5 1
VERSION=	1.9.4
d66 1
a66 1
			--with-http_spdy_module \
@


1.81
log
@Typo in pexp.

reported by sebastia@@
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.80 2015/07/26 01:34:53 jeremy Exp $
d5 1
a5 1
VERSION=	1.9.3
a7 1
REVISION=	3
@


1.81.4.1
log
@apply fixes from nginx's repository for the following
vulnerabilities:
CVE-2016-0742, CVE-2016-0746, CVE-2016-0747

ok jasper@@
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.81 2015/07/29 17:21:11 ajacoutot Exp $
d8 1
a8 1
REVISION=	4
a77 4

# Fixes from nginx repository for CVE-2016-0742, CVE-2016-0746, CVE-2016-0747.
PATCHFILES+=		81d44cd4044e.patch:2 7316c57e4fe7.patch:2 978e79b95c9f.patch:2 \
			a5767988c022.patch:2 497d0cff8ace.patch:2 ff9b32c0e141.patch:2
@


1.80
log
@Update passenger FLAVOR depends due to removal of passenger subpackages
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.79 2015/07/17 00:06:32 sthen Exp $
d8 1
a8 1
REVISION=	2
@


1.79
log
@add ruby22-passenger to the list of alternatives for nginx,passenger RUN_DEPENDS
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.78 2015/07/15 22:35:43 ajacoutot Exp $
d8 1
a8 1
REVISION=	1
d91 2
a92 2
BUILD_DEPENDS+=		${MODRUBY_PKG_PREFIX}-passenger-*:www/ruby-passenger,-main
RUN_DEPENDS+=		ruby-passenger-*|ruby19-passenger-*|ruby20-passenger-*|ruby21-passenger-*|ruby22-passenger-*:www/ruby-passenger,-main
@


1.78
log
@Fix pexp.
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.77 2015/07/14 19:10:45 robert Exp $
d8 1
a8 1
REVISION=	0
d92 1
a92 1
RUN_DEPENDS+=		ruby-passenger-*|ruby19-passenger-*|ruby20-passenger-*|ruby21-passenger-*:www/ruby-passenger,-main
@


1.77
log
@update to 1.9.3
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.76 2015/06/19 05:41:35 robert Exp $
d8 1
@


1.76
log
@update to 1.9.2 and enable the stream module; from Brad
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.75 2015/06/01 14:00:24 robert Exp $
d5 1
a5 1
VERSION=	1.9.2
@


1.75
log
@update to 1.9.1 because we track the mainline version
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.74 2015/04/14 17:39:18 robert Exp $
d5 1
a5 1
VERSION=	1.9.1
d70 1
@


1.74
log
@update to 1.7.12, diff from Brad Smith
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.73 2015/03/31 18:20:20 robert Exp $
d5 1
a5 1
VERSION=	1.7.12
@


1.73
log
@update to 1.7.11 and add a patch to nginx.8 to mention the chroot patch

the manual page patch is from Jason Tubnor
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.72 2015/02/12 17:55:55 sthen Exp $
d5 1
a5 1
VERSION=	1.7.11
@


1.72
log
@update to nginx 1.7.10, ok robert@@
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.71 2015/01/02 19:32:39 robert Exp $
d5 1
a5 1
VERSION=	1.7.10
@


1.72.2.1
log
@add upstream patches for the following vulnerabilities:
CVE-2016-0742, CVE-2016-0746, CVE-2016-0747

ok jasper@@
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.72 2015/02/12 17:55:55 sthen Exp $
a7 1
REVISION=	0
a75 4

# Fixes from nginx repository for CVE-2016-0742, CVE-2016-0746, CVE-2016-0747.
PATCHFILES+=		81d44cd4044e.patch:2 7316c57e4fe7.patch:2 978e79b95c9f.patch:2 \
			a5767988c022.patch:2 497d0cff8ace.patch:2 ff9b32c0e141.patch:2
@


1.71
log
@update to 1.7.9
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.70 2014/12/10 16:44:32 sthen Exp $
d5 1
a5 1
VERSION=	1.7.9
@


1.70
log
@libressl added ALPN support, no need for the hack
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.69 2014/12/08 17:07:07 robert Exp $
d5 1
a5 2
VERSION=	1.7.8
REVISION=	0
d28 1
a28 1
CFLAGS+=	-Wall -Wpointer-arith -Werror
d32 4
@


1.69
log
@update to 1.7.8
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.68 2014/11/09 20:46:19 sthen Exp $
d6 1
@


1.68
log
@fix SUBST_VARS, pointed out by Mikolaj Kucharski
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.67 2014/11/08 00:02:45 sthen Exp $
d5 1
a5 2
VERSION=	1.7.7
REVISION=	0
@


1.67
log
@unbreak www/nginx, it uses TLSEXT_TYPE_application_layer_protocol_negotiation
to detect ALPN support which fails for us as libressl has added the macro but
not the functions yet.

add upstream's -W flags back in, to make the problem a compile rather than
a linker error (we're overriding cflags with our usual ones in the port).
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.66 2014/10/31 14:40:59 robert Exp $
d6 1
d35 1
a35 1
SUBST_VARS=	FLAVOR_COMMA
@


1.66
log
@bugfix update to 1.7.7
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.65 2014/10/23 12:13:12 sthen Exp $
d28 1
@


1.65
log
@Use specific flavour extensions for @@pkgpath lines in each package, so that
pkg_add -u is handled without prompting each time, as noticed by myself and
jasper. Modelled on similar in mail/mutt.  ok jasper@@ espie@@
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.64 2014/10/09 18:46:44 jeremy Exp $
d5 1
a5 1
VERSION=	1.7.6
a7 1
REVISION=	1
@


1.64
log
@Bump. The default FLAVOR of the passenger dependency is included in
@@depend, even though it doesn't appear to be used.

Spotted by naddy@@
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.63 2014/10/08 02:32:43 jeremy Exp $
d8 1
a8 1
REVISION=	0
d30 1
a30 1
FLAVORS=		lua naxsi passenger
d32 3
@


1.63
log
@Use default ruby version for building ruby-passenger and nginx passenger
FLAVOR. No runtime effect for either, so no bump.

nginx part from zhuk@@, with minor tweak by me to fix CONFIGURE_ARGS
and BUILD_DEPENDS
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.62 2014/10/05 11:43:53 robert Exp $
d8 1
@


1.62
log
@update to 1.7.6
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.61 2014/09/21 14:00:16 robert Exp $
d77 5
a81 2
CONFIGURE_ARGS+=	--add-module=${LOCALBASE}/lib/phusion-passenger20/ext/nginx
BUILD_DEPENDS+=		ruby20-passenger-*:www/ruby-passenger,-main
d91 1
a91 1
MODULES=		lang/lua
@


1.61
log
@fix and update the lua flavor
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.60 2014/09/16 18:37:57 robert Exp $
d5 1
a5 1
VERSION=	1.7.5
@


1.60
log
@security update to 1.7.5:
CVE-2014-3616 - fix an SSL session reuse vulnerability
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.59 2014/09/09 14:05:48 sthen Exp $
d70 3
a72 3
LUAV=			0.8.1
LUADISTFILES+=		simpl-ngx_devel_kit-v0.2.17-0-gbc97eea.tar.gz:0
LUADISTFILES+=		lua-nginx-module-${LUAV}.tar.gz:0
d84 1
a84 1
CONFIGURE_ARGS+=	--add-module=${WRKSRC}/simpl-ngx_devel_kit
d110 1
a110 1
	    mv ../simpl-ngx_devel_kit-* simpl-ngx_devel_kit && \
@


1.59
log
@@@sample nginx config files, suggested by/ok aja@@
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.58 2014/09/09 13:48:28 sthen Exp $
d5 1
a5 1
VERSION=	1.7.4
a7 1
REVISION=	3
@


1.58
log
@add a README to www/nginx with clues about log-rotation, ok aja@@
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.57 2014/08/27 06:46:49 ajacoutot Exp $
d8 1
a8 1
REVISION=	2
@


1.57
log
@Drop out-dated README.

ok robert@@
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.56 2014/08/26 19:48:06 robert Exp $
d8 1
a8 1
REVISION=	1
@


1.56
log
@add @@pkgpaths
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.55 2014/08/26 19:43:58 robert Exp $
d8 1
a8 1
REVISION=	0
@


1.55
log
@- remove the devel nginx packages
- apply chroot and other patches from the base system
- update to 1.7.4
@
text
@d1 1
a1 1
# $OpenBSD: Makefile.inc,v 1.13 2014/06/28 20:31:10 kili Exp $
d8 1
@


1.54
log
@Build {devel,stable},naxsi

ok landry@@ william@@ (maintainer)
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.53 2012/09/11 16:01:45 sthen Exp $
d3 1
a3 9
     SUBDIR =
     SUBDIR += devel
     SUBDIR += devel,lua
     SUBDIR += devel,naxsi
     SUBDIR += devel,passenger
     SUBDIR += stable
     SUBDIR += stable,lua
     SUBDIR += stable,naxsi
     SUBDIR += stable,passenger
d5 125
a129 1
.include <bsd.port.subdir.mk>
@


1.53
log
@Update nginx stable in ports to 1.2.x and add devel (1.3.x), this is
separate from the version in the base OS which deliberately does not include
the mail proxy and additional modules. rc.d/enginx script is added (not
rc.d/nginx to avoid conflicting with base). Lua module is also supported.
Most of the work done by william@@, with a few tweaks by me and ok william.

README could use more work and as pointed out by ajacoutot we need to
review permissions of the tmp directory, but the diff is already long enough.
@@pkgpath markers are set to update from the 1.0.x packages to 1.2.x (with or
without the passenger flavour as appropriate).
@
text
@d1 1
a1 1
# $OpenBSD$
d6 1
d10 1
@


1.52
log
@SECURITY UPDATE to nginx-1.0.15
resolves:
CVE-2012-2089 - Buffer overflow in the ngx_http_mp4_module

OK sthen@@ jasper@@ william@@
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.51 2012/03/16 00:44:06 william Exp $
d3 7
a9 1
COMMENT=	robust and small HTTP server and mail proxy server
d11 1
a11 73
DISTNAME=	nginx-1.0.15
CATEGORIES=	www

HOMEPAGE=	http://nginx.org/

MAINTAINER=	William Yodlowsky <william@@openbsd.org>

# BSD-like
PERMIT_PACKAGE_CDROM=	Yes
PERMIT_PACKAGE_FTP=	Yes
PERMIT_DISTFILES_CDROM=	Yes
PERMIT_DISTFILES_FTP=	Yes

WANTLIB=		c crypto pcre ssl z

MASTER_SITES=		http://nginx.org/download/

LIB_DEPENDS=		devel/pcre

NGINX_DIR=		/var/nginx
SUBST_VARS=		NGINX_DIR

CONFIGURE_STYLE=	simple
CONFIGURE_ARGS=		--prefix=${SYSCONFDIR}/nginx \
			--conf-path=${SYSCONFDIR}/nginx/nginx.conf \
			--sbin-path=${PREFIX}/sbin/nginx \
			--pid-path=/var/run/nginx.pid \
			--lock-path=/var/run/nginx.lock \
			--http-client-body-temp-path=${NGINX_DIR}/tmp/client_body_temp \
			--http-proxy-temp-path=${NGINX_DIR}/tmp/proxy_temp \
			--http-fastcgi-temp-path=${NGINX_DIR}/tmp/fastcgi_temp \
			--http-scgi-temp-path=${NGINX_DIR}/tmp/scgi_temp \
			--http-uwsgi-temp-path=${NGINX_DIR}/tmp/uwsgi_temp \
			--http-log-path=/var/www/logs/access.log \
			--error-log-path=/var/www/logs/error.log \
			--user=www \
			--group=www \
			--with-http_gzip_static_module \
			--with-http_ssl_module \
			--with-http_stub_status_module \
			--with-http_mp4_module \
			--with-mail \
			--with-mail_ssl_module \
			--with-ipv6

FLAVORS=		passenger
FLAVOR?=

.if ${FLAVOR:L:Mpassenger}
CONFIGURE_ARGS +=	--add-module=${LOCALBASE}/lib/phusion-passenger/ext/nginx
BUILD_DEPENDS +=	www/ruby-passenger,-main
RUN_DEPENDS +=		ruby-passenger-*|ruby19-passenger-*:www/ruby-passenger,-main
WANTLIB +=		m pthread stdc++
.endif

NO_REGRESS=		Yes
ALL_TARGET=

pre-configure:
	@@${SUBST_CMD} ${WRKBUILD}/conf/nginx.conf

do-install:
	${INSTALL_DATA_DIR} ${PREFIX}/share/nginx/
	${INSTALL_PROGRAM} ${WRKSRC}/objs/nginx ${PREFIX}/sbin
	${INSTALL_MAN} ${WRKSRC}/objs/nginx.8 ${PREFIX}/man/man8/
.for i in koi-win koi-utf win-utf mime.types nginx.conf \
	fastcgi_params scgi_params uwsgi_params
	${INSTALL_DATA} ${WRKSRC}/conf/${i} ${PREFIX}/share/nginx/
.endfor
	${INSTALL_DATA_DIR} ${PREFIX}/share/nginx/html/
	${INSTALL_DATA} ${WRKSRC}/html/* ${PREFIX}/share/nginx/html/

.include <bsd.port.mk>
@


1.51
log
@SECURITY FIX:  upgrade to 1.0.14

contents of previously freed memory might be sent to a client if
backend returned specially crafted response.

ok sthen
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.50 2012/02/19 15:02:08 robert Exp $
d5 1
a5 1
DISTNAME=	nginx-1.0.14
@


1.50
log
@do not handle the same files that are handled by the in-tree nginx
and make the port use the www user so that both nginx can be used
on the same system if needed
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.49 2012/02/18 16:40:18 sthen Exp $
d5 1
a5 1
DISTNAME=	nginx-1.0.12
a6 2

REVISION=	0
@


1.49
log
@update to nginx 1.0.12, ok william@@
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.48 2012/01/18 10:00:52 sthen Exp $
d8 2
d34 1
a34 1
			--lock-path=${NGINX_DIR}/tmp/nginx.lock \
d40 4
a43 4
			--http-log-path=/var/log/nginx/access.log \
			--error-log-path=/var/log/nginx/error.log \
			--user=_nginx \
			--group=_nginx \
@


1.48
log
@update ports nginx to 1.0.11 (src/usr.sbin/nginx was already updated)
ok jeremy@@ william@@
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.47 2011/12/13 18:39:38 jeremy Exp $
d5 1
a5 1
DISTNAME=	nginx-1.0.11
@


1.48.2.1
log
@MFC:
SECURITY UPDATE to nginx-1.0.15
resolves:
CVE-2012-2089 - Buffer overflow in the ngx_http_mp4_module
CVE-2012-1180 - Memory disclosure with specially crafted backend responses

OK sthen@@ jasper@@ william@@
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.48 2012/01/18 10:00:52 sthen Exp $
d5 1
a5 1
DISTNAME=	nginx-1.0.15
@


1.47
log
@Depend on either the ruby 1.8 or ruby 1.9 version of ruby-passenger
in the passenger FLAVOR.
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.46 2011/11/15 19:17:15 sthen Exp $
d5 1
a5 2
DISTNAME=	nginx-1.0.10
REVISION=	0
@


1.46
log
@Update to nginx 1.0.10. Bugs fixed include a segmentation fault in a worker
process if the resolver receives a large DNS response. OK robert@@
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.45 2011/11/14 19:24:48 robert Exp $
d6 1
d56 2
a57 2
BUILD_DEPENDS +=	www/ruby-passenger
RUN_DEPENDS +=		www/ruby-passenger
@


1.45
log
@trivial update to 1.0.9 to keep in sync with the in-tree one
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.44 2011/10/13 12:09:57 jasper Exp $
d5 1
a5 1
DISTNAME=	nginx-1.0.9
@


1.44
log
@- update to 1.0.8

ok william@@ (MAINTAINER)
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.43 2011/09/06 00:54:47 william Exp $
d5 1
a5 1
DISTNAME=	nginx-1.0.8
@


1.43
log
@Long overdue update to nginx-1.0.5

Includes the manpage diff to remove a nonexistent Xr that was suggested
by jirib on ports@@ ages ago

ok rpointel jasper jeremy (passenger FLAVOR)

thanks very much to the okayers for testing multiple diffs
I never got around to committing.
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.42 2011/06/14 03:08:05 william Exp $
d5 1
a5 1
DISTNAME=	nginx-1.0.5
d45 1
@


1.42
log
@bugfix update to 1.0.4; ok jasper
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.41 2011/05/17 03:31:00 william Exp $
d5 1
a5 1
DISTNAME=	nginx-1.0.4
@


1.41
log
@Update to nginx-1.0.2

Originally from Piotr for 1.0.0, thanks

ok jasper
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.40 2011/04/09 01:21:55 william Exp $
d5 1
a5 1
DISTNAME=	nginx-1.0.2
@


1.40
log
@Update to nginx-0.8.54 and update MAINTAINER

from Gleydson Soares, thanks

rc issue found by Piotr Sikora, fix by me, ok aja@@

ok jasper
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.39 2011/03/09 19:37:47 ajacoutot Exp $
d5 1
a5 1
DISTNAME=	nginx-0.8.54
d8 1
a8 1
HOMEPAGE=	http://nginx.net/
d20 1
a20 1
MASTER_SITES=		http://sysoev.ru/nginx/
d49 1
a49 1
FLAVORS=               passenger
d68 1
@


1.39
log
@These aren't needed either.
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.38 2011/03/09 18:51:49 ajacoutot Exp $
d5 1
a5 1
DISTNAME=	nginx-0.8.53
a7 2
REVISION=	7

d10 1
a10 1
MAINTAINER=	William Yodlowsky <bsd@@openbsd.rutgers.edu>
@


1.38
log
@Remove now uneeded redirection.
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.37 2010/12/27 14:50:24 ajacoutot Exp $
d8 1
a8 1
REVISION=	6
@


1.37
log
@Simplify after recent rc.subr change.
The framework is now stable and we will start documenting it (at last).
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.36 2010/12/24 10:40:06 ajacoutot Exp $
d8 1
a8 1
REVISION=	5
@


1.36
log
@Cope with recent rc.subr changes.
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.35 2010/12/11 08:05:38 ajacoutot Exp $
d8 1
a8 1
REVISION=	4
@


1.35
log
@Use quotes to be consistent with other rc scripts.
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.34 2010/11/22 08:36:49 espie Exp $
d8 1
a8 1
REVISION=	3
@


1.34
log
@new depends
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.33 2010/11/10 08:18:18 sthen Exp $
d8 1
a8 1
REVISION=	2
@


1.33
log
@- Install files for the SCGI and uwsgi modules, from Piotr Sikora.
makes sense to dlg@@, ok william@@ (maintainer).

- Fix bad REVISION bump in an .if ${FLAVOR... block from last commit.
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.32 2010/11/08 23:50:31 jeremy Exp $
d24 1
a24 1
LIB_DEPENDS=		::devel/pcre
d56 2
a57 2
BUILD_DEPENDS +=	::www/ruby-passenger
RUN_DEPENDS +=		::www/ruby-passenger
@


1.32
log
@For the passenger flavor, adjust for new location of ruby-passenger
and bump.

OK landry@@
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.31 2010/11/04 23:33:45 sthen Exp $
d8 1
a8 1
REVISION=	1
d38 2
a58 1
REVISION =		0
d70 2
a71 1
.for i in koi-win koi-utf win-utf fastcgi_params mime.types nginx.conf
@


1.31
log
@move back to new-style LIB_DEPENDS, req by Brad.
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.30 2010/11/04 07:54:51 ajacoutot Exp $
d53 5
a57 4
CONFIGURE_ARGS +=      --add-module=${LOCALBASE}/lib/phusion_passenger/ext/nginx
BUILD_DEPENDS +=       ::www/ruby-passenger
RUN_DEPENDS +=         ::www/ruby-passenger
WANTLIB +=             m pthread stdc++
@


1.30
log
@Add rcs id and shebang.
Protect variable names.
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.29 2010/11/04 07:39:44 robert Exp $
d24 1
a24 1
LIB_DEPENDS=		pcre::devel/pcre
@


1.29
log
@Add an rc script for nginx too
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.28 2010/11/04 01:41:11 dlg Exp $
d8 1
a8 1
REVISION=	0
@


1.28
log
@update nginx to 0.8.53. the main flavor builds and works fine. the
passenger build works, but i havent got a test case for it.

ok william@@
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.27 2010/09/25 03:34:40 william Exp $
d7 2
@


1.27
log
@Enable the static gzip module by default.

ok bernd@@

from Johan Huldtgren a while ago, thanks.
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.26 2010/08/31 20:05:21 edd Exp $
d5 1
a5 2
DISTNAME=	nginx-0.7.67
REVISION=	1
d22 1
a22 1
LIB_DEPENDS=		::devel/pcre
@


1.26
log
@Make php easier to configure under nginx, by patching correct paths in.
Diff also does new LIB_DEPENDS/WANTLIB style.

OK from the maintainer, william@@
Cheers
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.25 2010/06/17 03:35:37 william Exp $
d6 1
a6 1
REVISION=	0
d41 1
@


1.25
log
@Update to nginx-0.7.67; bugfixes.  Identical diff by Simon Kuhnle, thanks
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.24 2010/03/01 04:04:50 william Exp $
d6 1
d19 1
a19 1
WANTLIB=		c crypto ssl z
d23 1
a23 1
LIB_DEPENDS=		pcre::devel/pcre
@


1.24
log
@nginx-0.7.65; bugfixes

update from and reminded by Toni Mueller, thanks

ok jasper@@
(reminder, ports is not fully open, do not commit without specific permission)
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.23 2009/11/23 04:35:11 william Exp $
d5 1
a5 1
DISTNAME=	nginx-0.7.65
@


1.23
log
@SECURITY UPDATE to nginx-0.7.64

From Max Varencov

SSL/TLS renegotiation is now disabled, resolving CVE-2009-3555

ok jasper@@
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.22 2009/10/30 00:42:17 william Exp $
d5 1
a5 1
DISTNAME=	nginx-0.7.64
@


1.22
log
@SECURITY update to 0.7.63:

- fix VU#180065
- fix a null pointer dereference vulnerability

ok sthen@@
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.21 2009/10/26 13:32:02 okan Exp $
d5 1
a5 1
DISTNAME=	nginx-0.7.63
@


1.21
log
@fix typo and bump

ok william@@ (MAINTAINER)
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.20 2009/09/16 22:53:08 william Exp $
d5 1
a5 2
DISTNAME=	nginx-0.7.62
PKGNAME=	${DISTNAME}p0
@


1.20
log
@SECURITY FIX

Resolves CVE-2009-2629

from msf@@

Identical diff from Stephan A. Rickauer

ok jasper@@
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.19 2009/08/20 20:40:11 bernd Exp $
d6 1
@


1.19
log
@Add a passenger FLAVOR to make use of www/ruby-passenger.

ok william@@ (MAINTAINER)
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.18 2009/08/12 00:11:57 william Exp $
d5 1
a5 1
DISTNAME=	nginx-0.7.61
@


1.18
log
@update to nginx-0.7.61, and fix the link to the wiki

ok msf@@
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.17 2009/06/24 07:38:30 sthen Exp $
d45 10
@


1.17
log
@actually enable IPv6; from Simon Kuhnle
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.16 2009/06/23 20:24:12 sthen Exp $
d5 1
a5 2
DISTNAME=	nginx-0.7.60
PKGNAME=	${DISTNAME}p0
@


1.17.2.1
log
@SECURITY FIX

- fix VU#180065
- fix a null pointer dereference vulnerability

ok jasper@@
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.17 2009/06/24 07:38:30 sthen Exp $
d6 1
a6 1
PKGNAME=	${DISTNAME}p1
@


1.17.2.2
log
@SECURITY FIX

nginx-0.7.60p2

Resolves CVE-2009-3555

patch from upstream
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.17.2.1 2009/11/02 01:46:41 william Exp $
d6 1
a6 1
PKGNAME=	${DISTNAME}p2
@


1.17.2.3
log
@MFC:

SECURITY FIX, crash fixes

nginx-0.7.64

requested by Brad

ok jasper@@
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.23 2009/11/23 04:35:11 william Exp $
d5 2
a6 1
DISTNAME=	nginx-0.7.64
@


1.16
log
@- update to 0.7.60, from Brad

- add IPv6 support, from william@@ (maintainer), tested by Simon Kuhnle
and Darrin Chandler.

committing at the request of william@@.
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.15 2009/06/04 04:06:43 william Exp $
d6 1
d44 2
a45 1
			--with-mail_ssl_module
@


1.15
log
@Update to nginx-0.7.59; ok robert@@ merdely@@
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.14 2009/05/23 22:33:44 sthen Exp $
d5 1
a5 1
DISTNAME=	nginx-0.7.59
d49 1
a49 1
	${SUBST_CMD} ${WRKBUILD}/conf/nginx.conf
@


1.14
log
@update to 0.6.37, fixes build on a few arch broken in previous commit.
noticed by Simon Kuhnle, diff from maintainer William Yodlowsky matches
mine.
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.13 2009/05/21 11:44:08 steven Exp $
d5 1
a5 1
DISTNAME=	nginx-0.6.37
@


1.13
log
@update to 0.6.36
use _nginx user by default

from new maintainer William Yodlowsky

fine with old maintainer Darrin Chandler
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.12 2009/03/22 20:19:32 steven Exp $
d5 1
a5 1
DISTNAME=	nginx-0.6.36
@


1.12
log
@update to 0.6.35

from Max Varencov.
tested/ok maintainer
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.11 2008/12/26 17:30:23 steven Exp $
d5 1
a5 1
DISTNAME=	nginx-0.6.35
d10 1
a10 1
MAINTAINER=	Darrin Chandler <dwchandler@@stilyagin.com>
@


1.11
log
@reliability fix:
"Recently it was discovered that nginx workers exit abnormally if they
receive Expect header on all systems except FreeBSD, Linux, and
Solaris."

from upstream via maintainer Darrin Chandler
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.9 2008/09/01 15:47:43 sthen Exp $
d5 1
a5 2
DISTNAME=	nginx-0.6.34
PKGNAME=	${DISTNAME}p0
@


1.11.2.1
log
@SECURITY FIX

Resolves CVE-2009-2629

from ian@@ (thanks), tweak by me

ok jasper@@
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.11 2008/12/26 17:30:23 steven Exp $
d6 1
a6 1
PKGNAME=	${DISTNAME}p1
@


1.10
log
@From MAINTAINER (Darrin Chandler):
This updates nginx to the latest stable version 0.6.34 and removed a
configure workaround (fixed upstream).

Also implements SUBST_CMD (thanks, okan).

ok MAINTAINER, weerd@@, okan@@
@
text
@d6 1
@


1.9
log
@Maintenance update to latest stable version 0.6.32, from maintainer
Darrin Chandler on ports@@.

"Thanks to Toni Mueller for prodding, and to Simon Kuhnle for prodding,
testing, and the patch (I had the same diff just before lock but kept
forgetting after unlock)." -dwc
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.8 2008/05/13 18:46:07 merdely Exp $
d5 1
a5 1
DISTNAME=	nginx-0.6.32
a44 3
# Get rid of '#include <malloc.h>' which caused many warnings
CONFIGURE_ARGS+=	--with-cc-opt="-DNGX_HAVE_MALLOC_H=0"

d49 1
a49 2
	@@perl -pi -e 's,!!NGINX_DIR!!,${NGINX_DIR},' \
		${WRKBUILD}/conf/nginx.conf
@


1.8
log
@Bugfix update to 0.6.31. Fixes include:
*) Bugfix: nginx did not process FastCGI response if header was at
   the end of FastCGI record; bug appeared in 0.6.2.  Thanks to
   Sergey Serov.
*) bugfix: a segmentation fault might occur in worker process if a
   file was deleted and the "open_file_cache_errors" directive was
   off.

From Darrin Chandler (MAINTAINER)
ok bernd@@
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.7 2008/05/07 23:08:24 merdely Exp $
d5 1
a5 1
DISTNAME=	nginx-0.6.31
@


1.7
log
@Update nginx to 0.6.30

From Darrin Chandler (MAINTAINER)
ok simon@@
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.6 2008/03/29 13:50:39 bernd Exp $
d5 1
a5 1
DISTNAME=	nginx-0.6.30
@


1.6
log
@Give nginx a chance to write stuff into /var/nginx/tmp.

ok Darrin Chandler (MAINTAINER)
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.5 2008/02/17 18:54:48 bernd Exp $
d5 1
a5 2
DISTNAME=	nginx-0.5.35
PKGNAME=	${DISTNAME}p0
@


1.5
log
@Minor bugfix update to nginx-0.5.35.

ok Darrin Chandler (MAINTAINER), merdely@@, okan@@ and sthen@@
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.4 2007/12/31 02:20:01 okan Exp $
d6 1
@


1.4
log
@update from MAINTAINER; plus a bunch of tweaks from me

ok merdely@@
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.3 2007/10/08 19:23:43 merdely Exp $
d5 1
a5 1
DISTNAME=	nginx-0.5.34
@


1.3
log
@Update to nginx-0.5.32

From Darrin Chandler (MAINTAINER)
"looks ok" kili@@
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.2 2007/09/22 21:06:05 sthen Exp $
d3 1
a3 1
COMMENT=	robust and small HTTP server and IMAP/POP3 proxy server
d5 1
a5 2
DISTNAME=	nginx-0.5.32
PKGNAME=	${DISTNAME}
d22 1
a23 1
LIB_DEPENDS+=		pcre::devel/pcre
d25 1
a25 2

SUBST_VARS+=		NGINX_DIR
d28 2
a29 7

# Some conf files are relative to --prefix and
# have no --xxx-path of their own. Set this so
# all runtime configs live in the same place.
CONFIGURE_ARGS+=	--prefix=${SYSCONFDIR}/nginx

CONFIGURE_ARGS+=	--conf-path=${SYSCONFDIR}/nginx/nginx.conf \
a39 2
			--with-cc-opt="-I ${LOCALBASE}/include" \
			--with-ld-opt="-L ${LOCALBASE}/lib" \
d42 5
a46 2
			--with-imap \
			--with-imap_ssl_module
d53 1
a53 1
	${WRKBUILD}/conf/nginx.conf
d56 1
a56 1
	${INSTALL_DATA_DIR} ${PREFIX}/share/nginx
d61 1
a61 1
	${INSTALL_DATA_DIR} ${PREFIX}/share/nginx/html
a62 1

@


1.2
log
@DoS fix in nginx http autoindex module, from MAINTAINER Darrin Chandler

ok merdely@@
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.1.1.1 2007/09/04 21:58:26 merdely Exp $
d5 2
a6 2
DISTNAME=	nginx-0.5.31
PKGNAME=	${DISTNAME}p0
@


1.1
log
@Initial revision
@
text
@d1 1
a1 1
# $OpenBSD$
d6 1
@


1.1.1.1
log
@Import nginx 0.5.31

nginx [engine x] is a HTTP server and IMAP/POP3 proxy server.

The basic HTTP features:
  * Handling of the static files, index files, and autoindexing
  * Accelerated reverse proxying without caching, simple load 
    balancing and fault tolerance
  * Accelerated support without caching of the remote FastCGI
    servers, simple load balancing and fault tolerance
  * Modular architecture, filters including gzipping, byte
    ranges, chunked responses, and SSI-filter; Several subrequests
    in one page handling in SSI-filter via FastCGI or proxy
    running in parallel
  * the SSL support

The IMAP/POP3 proxy server features:
  * User redirection to IMAP/POP3 backend using an external HTTP
    authentication server
  * Plain text authentication (LOGIN, USER/PASS)
  * SSL and STARTTLS support

ok and help steven@@
@
text
@@
