head	1.1;
access;
symbols
	OPENBSD_4_6:1.1.0.4
	OPENBSD_4_5:1.1.0.2;
locks; strict;
comment	@# @;


1.1
date	2009.09.19.01.40.15;	author william;	state dead;
branches
	1.1.2.1
	1.1.4.1;
next	;

1.1.2.1
date	2009.09.19.01.40.15;	author william;	state Exp;
branches;
next	;

1.1.4.1
date	2009.11.02.01.46.41;	author william;	state Exp;
branches;
next	1.1.4.2;

1.1.4.2
date	2009.12.05.23.14.40;	author william;	state dead;
branches;
next	;


desc
@@


1.1
log
@file patch-src_http_ngx_http_parse_c was initially added on branch OPENBSD_4_5.
@
text
@@


1.1.4.1
log
@SECURITY FIX

- fix VU#180065
- fix a null pointer dereference vulnerability

ok jasper@@
@
text
@a0 45
Security fixes

Resolves a null pointer dereference and VU#180065


$OpenBSD$
--- src/http/ngx_http_parse.c.orig	Tue Oct 27 09:13:55 2009
+++ src/http/ngx_http_parse.c	Tue Oct 27 09:13:17 2009
@@@@ -739,6 +739,7 @@@@ ngx_http_parse_header_line(ngx_http_request_t *r, ngx_
 
         /* first char */
         case sw_start:
+            r->header_name_start = p;
             r->invalid_header = 0;
 
             switch (ch) {
@@@@ -751,7 +752,6 @@@@ ngx_http_parse_header_line(ngx_http_request_t *r, ngx_
                 goto header_done;
             default:
                 state = sw_name;
-                r->header_name_start = p;
 
                 c = lowcase[ch];
 
@@@@ -1137,11 +1137,15 @@@@ ngx_http_parse_complex_uri(ngx_http_request_t *r, ngx_
 #endif
             case '/':
                 state = sw_slash;
-                u -= 4;
-                if (u < r->uri.data) {
-                    return NGX_HTTP_PARSE_INVALID_REQUEST;
-                }
-                while (*(u - 1) != '/') {
+                u -= 5;
+                for ( ;; ) {
+                    if (u < r->uri.data) {
+                        return NGX_HTTP_PARSE_INVALID_REQUEST;
+                    }
+                    if (*u == '/') {
+                        u++;
+                        break;
+                    }
                     u--;
                 }
                 break;
@


1.1.4.2
log
@MFC:

SECURITY FIX, crash fixes

nginx-0.7.64

requested by Brad

ok jasper@@
@
text
@d6 1
a6 1
$OpenBSD: patch-src_http_ngx_http_parse_c,v 1.1.4.1 2009/11/02 01:46:41 william Exp $
@


1.1.2.1
log
@SECURITY FIX

Resolves CVE-2009-2629

from ian@@ (thanks), tweak by me

ok jasper@@
@
text
@a0 27
$OpenBSD$

Resolve CVE-2009-2629

--- src/http/ngx_http_parse.c.orig	Sun Mar 16 12:47:16 2008
+++ src/http/ngx_http_parse.c	Fri Sep 18 21:25:10 2009
@@@@ -1123,11 +1123,15 @@@@ ngx_http_parse_complex_uri(ngx_http_request_t *r, ngx_
 #endif
             case '/':
                 state = sw_slash;
-                u -= 4;
-                if (u < r->uri.data) {
-                    return NGX_HTTP_PARSE_INVALID_REQUEST;
-                }
-                while (*(u - 1) != '/') {
+                u -= 5;
+                for ( ;; ) {
+                    if (u < r->uri.data) {
+                        return NGX_HTTP_PARSE_INVALID_REQUEST;
+                    }
+                    if (*u == '/') {
+                        u++;
+                        break;
+                    }
                     u--;
                 }
                 break;
@

