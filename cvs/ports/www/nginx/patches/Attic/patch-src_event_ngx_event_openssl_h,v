head	1.3;
access;
symbols
	OPENBSD_4_6:1.1.0.2;
locks; strict;
comment	@# @;


1.3
date	2014.12.10.16.44.32;	author sthen;	state dead;
branches;
next	1.2;
commitid	bOKkrgQB0xtw8ydo;

1.2
date	2014.11.08.00.02.45;	author sthen;	state Exp;
branches;
next	1.1;
commitid	mj8hZpbHvm0gZA8e;

1.1
date	2009.11.26.01.42.36;	author william;	state dead;
branches
	1.1.2.1;
next	;

1.1.2.1
date	2009.11.26.01.42.36;	author william;	state Exp;
branches;
next	1.1.2.2;

1.1.2.2
date	2009.12.05.23.14.40;	author william;	state dead;
branches;
next	;


desc
@@


1.3
log
@libressl added ALPN support, no need for the hack
@
text
@$OpenBSD: patch-src_event_ngx_event_openssl_h,v 1.2 2014/11/08 00:02:45 sthen Exp $
--- src/event/ngx_event_openssl.h.orig	Fri Nov  7 16:50:18 2014
+++ src/event/ngx_event_openssl.h	Fri Nov  7 16:51:52 2014
@@@@ -30,6 +30,12 @@@@
 #include <openssl/x509.h>
 #include <openssl/x509v3.h>
 
+/*
+ * XXX nginx checks this define to detect ALPN support;
+ *     libressl has added the macro, but doesn't have support yet
+ */
+#undef TLSEXT_TYPE_application_layer_protocol_negotiation
+
 #define NGX_SSL_NAME     "OpenSSL"
 
 
@


1.2
log
@unbreak www/nginx, it uses TLSEXT_TYPE_application_layer_protocol_negotiation
to detect ALPN support which fails for us as libressl has added the macro but
not the functions yet.

add upstream's -W flags back in, to make the problem a compile rather than
a linker error (we're overriding cflags with our usual ones in the port).
@
text
@d1 1
a1 1
$OpenBSD$
@


1.1
log
@file patch-src_event_ngx_event_openssl_h was initially added on branch OPENBSD_4_6.
@
text
@d1 16
@


1.1.2.1
log
@SECURITY FIX

nginx-0.7.60p2

Resolves CVE-2009-3555

patch from upstream
@
text
@a0 17
$OpenBSD$

SECURITY FIX

Resolves CVE-2009-3555


--- src/event/ngx_event_openssl.h.orig	Tue Jul 29 10:29:02 2008
+++ src/event/ngx_event_openssl.h	Tue Nov 17 09:14:52 2009
@@@@ -45,6 +45,7 @@@@ typedef struct {
     ngx_event_handler_pt        saved_write_handler;
 
     unsigned                    handshaked:1;
+    unsigned                    renegotiation:1;
     unsigned                    buffer:1;
     unsigned                    no_wait_shutdown:1;
     unsigned                    no_send_shutdown:1;
@


1.1.2.2
log
@MFC:

SECURITY FIX, crash fixes

nginx-0.7.64

requested by Brad

ok jasper@@
@
text
@d1 1
a1 1
$OpenBSD: patch-src_event_ngx_event_openssl_h,v 1.1.2.1 2009/11/26 01:42:36 william Exp $
@


