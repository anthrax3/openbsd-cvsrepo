head	1.8;
access;
symbols
	OPENBSD_6_2:1.8.0.4
	OPENBSD_6_2_BASE:1.8
	OPENBSD_6_1:1.8.0.2
	OPENBSD_6_1_BASE:1.8
	OPENBSD_6_0:1.7.0.8
	OPENBSD_6_0_BASE:1.7
	OPENBSD_5_9:1.7.0.4
	OPENBSD_5_9_BASE:1.7
	OPENBSD_5_8:1.7.0.6
	OPENBSD_5_8_BASE:1.7
	OPENBSD_5_7:1.7.0.2
	OPENBSD_5_7_BASE:1.7
	OPENBSD_5_1_BASE:1.5
	OPENBSD_5_1:1.5.0.6
	OPENBSD_5_0:1.5.0.4
	OPENBSD_5_0_BASE:1.5
	OPENBSD_4_9:1.5.0.2
	OPENBSD_4_9_BASE:1.5
	OPENBSD_4_8:1.4.0.6
	OPENBSD_4_8_BASE:1.4
	OPENBSD_4_7:1.4.0.4
	OPENBSD_4_7_BASE:1.4
	OPENBSD_4_6:1.4.0.2
	OPENBSD_4_6_BASE:1.4
	OPENBSD_4_5:1.3.0.2
	OPENBSD_4_5_BASE:1.3
	OPENBSD_4_4:1.2.0.2
	OPENBSD_4_4_BASE:1.2
	OPENBSD_4_3:1.1.1.1.0.2
	OPENBSD_4_3_BASE:1.1.1.1
	merdely_20070904:1.1.1.1
	merdely:1.1.1;
locks; strict;
comment	@# @;


1.8
date	2016.11.04.22.13.43;	author jeremy;	state Exp;
branches;
next	1.7;
commitid	Oee7bZXxLwPn3r9t;

1.7
date	2014.08.26.19.43.59;	author robert;	state Exp;
branches;
next	1.6;
commitid	Y2vy3KpSALTztMGt;

1.6
date	2012.02.19.15.02.08;	author robert;	state dead;
branches;
next	1.5;

1.5
date	2010.08.31.20.05.21;	author edd;	state Exp;
branches;
next	1.4;

1.4
date	2009.05.21.11.44.08;	author steven;	state Exp;
branches;
next	1.3;

1.3
date	2008.12.07.20.08.55;	author merdely;	state Exp;
branches;
next	1.2;

1.2
date	2008.05.07.23.08.24;	author merdely;	state Exp;
branches;
next	1.1;

1.1
date	2007.09.04.21.58.26;	author merdely;	state Exp;
branches
	1.1.1.1;
next	;

1.1.1.1
date	2007.09.04.21.58.26;	author merdely;	state Exp;
branches;
next	;


desc
@@


1.8
log
@Update nginx to use new dynamic modules feature

Switch all extrnal modules to be dynamic modules, and update them to use the
latest versions.  Use separate subpackages for all dynamic modules, so you
can easily choose which nginx features you want without rebuilding nginx
with a specific combination of FLAVORs.

Switch all internal modules that can be built dynamically to use dynamic
modules.

Start building the image_filter, geoip, perl, and xlst modules as dynamic
modules.

This requires changes to your nginx configuration if you were previously
using a FLAVORed version of nginx, or using the mail or stream features.

OK robert@@ (MAINTAINER)
positive feedback from william@@ (MAINTAINER), landry@@, sthen@@
@
text
@$OpenBSD: patch-conf_nginx_conf,v 1.7 2014/08/26 19:43:59 robert Exp $
--- conf/nginx.conf.orig	Tue Oct 18 17:03:13 2016
+++ conf/nginx.conf	Thu Nov  3 14:30:06 2016
@@@@ -1,30 +1,35 @@@@
+# Take note of http://wiki.nginx.org/Pitfalls
 
-#user  nobody;
+#user  www;
 worker_processes  1;
 
+#load_module "modules/ngx_stream_module.so";
+
 #error_log  logs/error.log;
 #error_log  logs/error.log  notice;
 #error_log  logs/error.log  info;
+#error_log  syslog:server=unix:/dev/log,severity=notice;
 
 #pid        logs/nginx.pid;
 
-
+worker_rlimit_nofile 1024;
 events {
-    worker_connections  1024;
+    worker_connections  800;
 }
 
 
 http {
     include       mime.types;
     default_type  application/octet-stream;
+    index         index.html index.htm;
 
     #log_format  main  '$remote_addr - $remote_user [$time_local] "$request" '
     #                  '$status $body_bytes_sent "$http_referer" '
     #                  '"$http_user_agent" "$http_x_forwarded_for"';
 
     #access_log  logs/access.log  main;
+    #access_log  syslog:server=unix:/dev/log,severity=notice main;
 
-    sendfile        on;
     #tcp_nopush     on;
 
     #keepalive_timeout  0;
@@@@ -32,41 +37,49 @@@@ http {
 
     #gzip  on;
 
+    server_tokens off;
+
     server {
         listen       80;
+        listen       [::]:80;
         server_name  localhost;
+        root         /var/www/htdocs;
 
         #charset koi8-r;
 
         #access_log  logs/host.access.log  main;
 
-        location / {
-            root   html;
-            index  index.html index.htm;
-        }
-
         #error_page  404              /404.html;
 
         # redirect server error pages to the static page /50x.html
         #
         error_page   500 502 503 504  /50x.html;
         location = /50x.html {
-            root   html;
+            root  /var/www/htdocs;
         }
 
+        # FastCGI to CGI wrapper server
+        #
+        #location /cgi-bin/ {
+        #    fastcgi_pass   unix:run/slowcgi.sock;
+        #    fastcgi_split_path_info ^(/cgi-bin/[^/]+)(.*);
+        #    fastcgi_param  PATH_INFO $fastcgi_path_info;
+        #    include        fastcgi_params;
+        #}
+
         # proxy the PHP scripts to Apache listening on 127.0.0.1:80
         #
         #location ~ \.php$ {
         #    proxy_pass   http://127.0.0.1;
         #}
 
-        # pass the PHP scripts to FastCGI server listening on 127.0.0.1:9000
+        # pass the PHP scripts to FastCGI server listening on unix socket
         #
         #location ~ \.php$ {
-        #    root           html;
-        #    fastcgi_pass   127.0.0.1:9000;
+        #    try_files      $uri $uri/ =404;
+        #    fastcgi_pass   unix:run/php-fpm.sock;
         #    fastcgi_index  index.php;
-        #    fastcgi_param  SCRIPT_FILENAME  /scripts$fastcgi_script_name;
+        #    fastcgi_param  SCRIPT_FILENAME $document_root$fastcgi_script_name;
         #    include        fastcgi_params;
         #}
 
@@@@ -85,33 +98,26 @@@@ http {
     #    listen       8000;
     #    listen       somename:8080;
     #    server_name  somename  alias  another.alias;
-
-    #    location / {
-    #        root   html;
-    #        index  index.html index.htm;
-    #    }
+    #    root         /var/www/htdocs;
     #}
 
 
     # HTTPS server
     #
     #server {
-    #    listen       443 ssl;
+    #    listen       443;
     #    server_name  localhost;
+    #    root         /var/www/htdocs;
 
-    #    ssl_certificate      cert.pem;
-    #    ssl_certificate_key  cert.key;
+    #    ssl                  on;
+    #    ssl_certificate      /etc/ssl/server.crt;
+    #    ssl_certificate_key  /etc/ssl/private/server.key;
 
-    #    ssl_session_cache    shared:SSL:1m;
     #    ssl_session_timeout  5m;
+    #    ssl_session_cache    shared:SSL:1m;
 
-    #    ssl_ciphers  HIGH:!aNULL:!MD5;
-    #    ssl_prefer_server_ciphers  on;
-
-    #    location / {
-    #        root   html;
-    #        index  index.html index.htm;
-    #    }
+    #    ssl_ciphers  HIGH:!aNULL:!MD5:!RC4;
+    #    ssl_prefer_server_ciphers   on;
     #}
 
 }
@


1.7
log
@- remove the devel nginx packages
- apply chroot and other patches from the base system
- update to 1.7.4
@
text
@d1 4
a4 4
$OpenBSD$
--- conf/nginx.conf.orig	Tue Aug  5 13:13:06 2014
+++ conf/nginx.conf	Sat Aug 23 13:24:52 2014
@@@@ -1,30 +1,33 @@@@
d11 2
d44 1
a44 1
@@@@ -32,41 +35,49 @@@@ http {
d104 1
a104 1
@@@@ -85,33 +96,26 @@@@ http {
@


1.6
log
@do not handle the same files that are handled by the in-tree nginx
and make the port use the www user so that both nginx can be used
on the same system if needed
@
text
@d1 5
a5 4
$OpenBSD: patch-conf_nginx_conf,v 1.5 2010/08/31 20:05:21 edd Exp $
--- conf/nginx.conf.orig	Mon Apr  6 14:43:46 2009
+++ conf/nginx.conf	Sun Aug  1 18:22:58 2010
@@@@ -1,7 +1,9 @@@@
d8 1
a8 1
+user _nginx;
a10 2
+# Paths specified here (unless absolute), will be relative to 
+# ${SYSCONFDIR}/nginx. If not specified, defaults to /var/log/nginx/...
d14 42
a55 1
@@@@ -41,7 +43,7 @@@@ http {
d58 1
a58 1
         location / {
d60 4
a63 3
+            root   ${NGINX_DIR}/html;
             index  index.html index.htm;
         }
d65 1
a65 1
@@@@ -51,7 +53,7 @@@@ http {
d70 1
a70 1
+            root   ${NGINX_DIR}/html;
d73 9
d83 3
a85 1
@@@@ -61,12 +63,14 @@@@ http {
d88 2
a89 3
         # pass the PHP scripts to FastCGI server listening on 127.0.0.1:9000
+        # Make sure you let php-fastcgi know which port. Running it
+        # with '-b 127.0.0.1:9000' will do.
d93 3
a95 2
+        #    root           ${NGINX_DIR}/html;
         #    fastcgi_pass   127.0.0.1:9000;
d98 1
a98 1
+        #    fastcgi_param  SCRIPT_FILENAME $document_root/$fastcgi_script_name;
d102 3
a104 1
@@@@ -87,7 +91,7 @@@@ http {
d106 2
a107 2
 
     #    location / {
d109 3
a111 3
+    #        root   ${NGINX_DIR}/html;
     #        index  index.html index.htm;
     #    }
a112 2
@@@@ -110,7 +114,7 @@@@ http {
     #    ssl_prefer_server_ciphers   on;
d114 23
a136 1
     #    location / {
d138 4
a141 3
+    #        root   ${NGINX_DIR}/html;
     #        index  index.html index.htm;
     #    }
d143 2
@


1.5
log
@Make php easier to configure under nginx, by patching correct paths in.
Diff also does new LIB_DEPENDS/WANTLIB style.

OK from the maintainer, william@@
Cheers
@
text
@d1 1
a1 1
$OpenBSD: patch-conf_nginx_conf,v 1.4 2009/05/21 11:44:08 steven Exp $
@


1.4
log
@update to 0.6.36
use _nginx user by default

from new maintainer William Yodlowsky

fine with old maintainer Darrin Chandler
@
text
@d1 4
a4 4
$OpenBSD: patch-conf_nginx_conf,v 1.2 2008/05/07 23:08:24 merdely Exp $
--- conf/nginx.conf.orig	Thu Feb 28 15:44:16 2008
+++ conf/nginx.conf	Fri May 15 23:35:38 2009
@@@@ -1,5 +1,5 @@@@
d10 2
d13 3
a15 1
@@@@ -41,7 +41,7 @@@@ http {
d24 1
a24 1
@@@@ -51,7 +51,7 @@@@ http {
d33 18
a50 1
@@@@ -87,7 +87,7 @@@@ http {
d59 1
a59 1
@@@@ -110,7 +110,7 @@@@ http {
@


1.3
log
@From MAINTAINER (Darrin Chandler):
This updates nginx to the latest stable version 0.6.34 and removed a
configure workaround (fixed upstream).

Also implements SUBST_CMD (thanks, okan).

ok MAINTAINER, weerd@@, okan@@
@
text
@d3 8
a10 1
+++ conf/nginx.conf	Sun Dec  7 14:33:16 2008
@


1.2
log
@Update nginx to 0.6.30

From Darrin Chandler (MAINTAINER)
ok simon@@
@
text
@d1 3
a3 3
$OpenBSD: patch-conf_nginx_conf,v 1.1.1.1 2007/09/04 21:58:26 merdely Exp $
--- conf/nginx.conf.orig	Thu Feb 28 13:44:16 2008
+++ conf/nginx.conf	Wed May  7 11:22:35 2008
d9 1
a9 1
+            root   !!NGINX_DIR!!/html;
d18 1
a18 1
+            root   !!NGINX_DIR!!/html;
d27 1
a27 1
+    #        root   !!NGINX_DIR!!/html;
d36 1
a36 1
+    #        root   !!NGINX_DIR!!/html;
@


1.1
log
@Initial revision
@
text
@d1 3
a3 12
$OpenBSD$
--- conf/nginx.conf.orig	Thu Jan 18 00:08:18 2007
+++ conf/nginx.conf	Mon Sep  3 12:34:22 2007
@@@@ -15,7 +15,7 @@@@ events {
 
 
 http {
-    include       conf/mime.types;
+    include       mime.types;
     default_type  application/octet-stream;
 
     #log_format  main  '$remote_addr - $remote_user [$time_local] $request '
d22 1
a22 1
@@@@ -86,7 +86,7 @@@@ http {
d31 1
a31 1
@@@@ -109,7 +109,7 @@@@ http {
@


1.1.1.1
log
@Import nginx 0.5.31

nginx [engine x] is a HTTP server and IMAP/POP3 proxy server.

The basic HTTP features:
  * Handling of the static files, index files, and autoindexing
  * Accelerated reverse proxying without caching, simple load 
    balancing and fault tolerance
  * Accelerated support without caching of the remote FastCGI
    servers, simple load balancing and fault tolerance
  * Modular architecture, filters including gzipping, byte
    ranges, chunked responses, and SSI-filter; Several subrequests
    in one page handling in SSI-filter via FastCGI or proxy
    running in parallel
  * the SSL support

The IMAP/POP3 proxy server features:
  * User redirection to IMAP/POP3 backend using an external HTTP
    authentication server
  * Plain text authentication (LOGIN, USER/PASS)
  * SSL and STARTTLS support

ok and help steven@@
@
text
@@
