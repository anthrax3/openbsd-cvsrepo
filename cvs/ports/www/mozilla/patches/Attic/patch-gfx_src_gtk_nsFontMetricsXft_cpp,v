head	1.2;
access;
symbols
	OPENBSD_4_1:1.1.0.4
	OPENBSD_4_1_BASE:1.1
	OPENBSD_4_0:1.1.0.2
	OPENBSD_4_0_BASE:1.1;
locks; strict;
comment	@# @;


1.2
date	2007.05.25.16.31.39;	author martynas;	state dead;
branches;
next	1.1;

1.1
date	2006.03.27.04.23.28;	author pvalchev;	state Exp;
branches;
next	;


desc
@@


1.2
log
@remove unmaintained mozilla port; if you are still using it consider
switching to seamonkey
ok kurt@@ pval@@ espie@@ steven@@ jasper@@ alek@@
@
text
@$OpenBSD: patch-gfx_src_gtk_nsFontMetricsXft_cpp,v 1.1 2006/03/27 04:23:28 pvalchev Exp $
--- gfx/src/gtk/nsFontMetricsXft.cpp.orig	Wed Feb 16 10:08:37 2005
+++ gfx/src/gtk/nsFontMetricsXft.cpp	Sun Mar 26 18:20:10 2006
@@@@ -869,8 +869,14 @@@@ nsFontMetricsXft::CacheFontMetrics(void)
     mXHeight = nscoord(mXHeight * f);
 
     // mUnderlineOffset (offset for underlines)
-    val = CONVERT_DESIGN_UNITS_TO_PIXELS(face->underline_position,
+    if (face) {
+        val = CONVERT_DESIGN_UNITS_TO_PIXELS(face->underline_position,
                                          face->size->metrics.y_scale);
+    }
+    else {
+        val = 0.0f;
+    }
+    
     if (val) {
         mUnderlineOffset = NSToIntRound(val * f);
     }
@@@@ -880,8 +886,14 @@@@ nsFontMetricsXft::CacheFontMetrics(void)
     }
 
     // mUnderlineSize (thickness of an underline)
-    val = CONVERT_DESIGN_UNITS_TO_PIXELS(face->underline_thickness,
+    if (face) {
+        val = CONVERT_DESIGN_UNITS_TO_PIXELS(face->underline_thickness,
                                          face->size->metrics.y_scale);
+    }
+    else {
+        val = 0.0f;
+    }
+    
     if (val) {
         mUnderlineSize = nscoord(PR_MAX(f, NSToIntRound(val * f)));
     }
@@@@ -891,7 +903,7 @@@@ nsFontMetricsXft::CacheFontMetrics(void)
     }
 
     // mSuperscriptOffset
-    if (os2 && os2->ySuperscriptYOffset) {
+    if (face && os2 && os2->ySuperscriptYOffset) {
         val = CONVERT_DESIGN_UNITS_TO_PIXELS(os2->ySuperscriptYOffset,
                                              face->size->metrics.y_scale);
         mSuperscriptOffset = nscoord(PR_MAX(f, NSToIntRound(val * f)));
@@@@ -901,7 +913,7 @@@@ nsFontMetricsXft::CacheFontMetrics(void)
     }
 
     // mSubscriptOffset
-    if (os2 && os2->ySubscriptYOffset) {
+    if (face && os2 && os2->ySubscriptYOffset) {
         val = CONVERT_DESIGN_UNITS_TO_PIXELS(os2->ySubscriptYOffset,
                                              face->size->metrics.y_scale);
         // some fonts have the incorrect sign. 
@


1.1
log
@check XftLockFace() for NULL return to avoid a crash, see
https://bugzilla.mozilla.org/show_bug.cgi?id=331077
from Tobias Ulmer <tobiasu@@tmux.org>
@
text
@d1 1
a1 1
$OpenBSD$
@

