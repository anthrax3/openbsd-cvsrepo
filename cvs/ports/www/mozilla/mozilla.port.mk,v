head	1.108;
access;
symbols
	OPENBSD_6_1:1.102.0.2
	OPENBSD_6_1_BASE:1.102
	OPENBSD_6_0:1.92.0.2
	OPENBSD_6_0_BASE:1.92
	OPENBSD_5_9:1.84.0.2
	OPENBSD_5_9_BASE:1.84
	OPENBSD_5_8:1.76.0.4
	OPENBSD_5_8_BASE:1.76
	OPENBSD_5_7:1.73.0.2
	OPENBSD_5_7_BASE:1.73
	OPENBSD_5_6:1.71.0.2
	OPENBSD_5_6_BASE:1.71
	OPENBSD_5_5:1.65.0.2
	OPENBSD_5_5_BASE:1.65
	OPENBSD_5_4:1.57.0.2
	OPENBSD_5_4_BASE:1.57
	OPENBSD_5_3:1.51.0.2
	OPENBSD_5_3_BASE:1.51
	OPENBSD_5_2:1.43.0.2
	OPENBSD_5_2_BASE:1.43
	OPENBSD_5_1_BASE:1.38
	OPENBSD_5_1:1.38.0.2
	OPENBSD_5_0:1.32.0.2
	OPENBSD_5_0_BASE:1.32
	OPENBSD_4_9:1.20.0.2
	OPENBSD_4_9_BASE:1.20
	OPENBSD_4_8:1.4.0.2
	OPENBSD_4_8_BASE:1.4;
locks; strict;
comment	@# @;


1.108
date	2017.09.28.16.32.42;	author landry;	state Exp;
branches;
next	1.107;
commitid	qE5o2VpVYyetDEhG;

1.107
date	2017.08.08.10.15.12;	author landry;	state Exp;
branches;
next	1.106;
commitid	CQvpYuCAayFE4QYS;

1.106
date	2017.06.14.05.22.28;	author landry;	state Exp;
branches;
next	1.105;
commitid	gaLDthnpdJBaqwVN;

1.105
date	2017.04.12.18.13.33;	author landry;	state Exp;
branches;
next	1.104;
commitid	WwfhiC6pYGrl55F7;

1.104
date	2017.04.12.18.12.33;	author landry;	state Exp;
branches;
next	1.103;
commitid	obesxEciJRtUmDBz;

1.103
date	2017.04.10.11.46.35;	author sthen;	state Exp;
branches;
next	1.102;
commitid	HY6VNZxjJWzKQFDV;

1.102
date	2017.03.09.07.08.24;	author landry;	state Exp;
branches
	1.102.2.1;
next	1.101;
commitid	OIoDMZqg6k1DCwws;

1.101
date	2017.03.07.15.23.20;	author landry;	state Exp;
branches;
next	1.100;
commitid	XpFsgCveZyFkkjvF;

1.100
date	2017.02.18.22.32.25;	author landry;	state Exp;
branches;
next	1.99;
commitid	hgz2RQMPxFsGqRtL;

1.99
date	2017.02.18.16.22.54;	author landry;	state Exp;
branches;
next	1.98;
commitid	zwUjsBRx9XMscqD4;

1.98
date	2017.02.18.16.18.48;	author landry;	state Exp;
branches;
next	1.97;
commitid	kSu6cd6Ky5cJ67gJ;

1.97
date	2017.01.24.21.25.14;	author landry;	state Exp;
branches;
next	1.96;
commitid	U1EZ1s4mCtSnO6xN;

1.96
date	2017.01.06.17.39.02;	author landry;	state Exp;
branches;
next	1.95;
commitid	quqfvZ0xptFtL4Nx;

1.95
date	2016.12.19.16.11.38;	author landry;	state Exp;
branches;
next	1.94;
commitid	WZ2bqUfNEdoDUCZc;

1.94
date	2016.11.06.21.54.35;	author landry;	state Exp;
branches;
next	1.93;
commitid	yDltZ8TU9oZ0zBlj;

1.93
date	2016.09.23.09.16.58;	author sthen;	state Exp;
branches;
next	1.92;
commitid	XLnI6AbHAmyVU5mO;

1.92
date	2016.07.04.07.15.07;	author landry;	state Exp;
branches;
next	1.91;
commitid	WR6WcH4nScEriY6z;

1.91
date	2016.05.31.20.15.51;	author landry;	state Exp;
branches;
next	1.90;
commitid	NiBL6Q3C8xJYOqW7;

1.90
date	2016.04.27.22.08.57;	author landry;	state Exp;
branches;
next	1.89;
commitid	tPTmYJtq8Pv8eMq3;

1.89
date	2016.04.27.13.37.32;	author landry;	state Exp;
branches;
next	1.88;
commitid	GgPAD6UwgG5dG3fW;

1.88
date	2016.03.20.00.02.31;	author naddy;	state Exp;
branches;
next	1.87;
commitid	UbXGPYJkPoUsS0gU;

1.87
date	2016.03.14.20.34.34;	author landry;	state Exp;
branches;
next	1.86;
commitid	C8gmkGX1IhkkrVX6;

1.86
date	2016.03.14.20.33.16;	author landry;	state Exp;
branches;
next	1.85;
commitid	ruL9UA9soS4mSdQo;

1.85
date	2016.03.14.20.30.02;	author landry;	state Exp;
branches;
next	1.84;
commitid	n69UgAbdczWqM3Pd;

1.84
date	2016.01.27.18.04.09;	author landry;	state Exp;
branches;
next	1.83;
commitid	1rNcnqGSQV0jbkCS;

1.83
date	2016.01.22.10.28.58;	author landry;	state Exp;
branches;
next	1.82;
commitid	2W78YUr1mye8HWDY;

1.82
date	2015.11.09.13.55.22;	author landry;	state Exp;
branches;
next	1.81;
commitid	i1Q1nxiCvhLpwow7;

1.81
date	2015.11.04.07.32.03;	author landry;	state Exp;
branches;
next	1.80;
commitid	dnvzhL2umAYre3Xl;

1.80
date	2015.10.31.15.12.38;	author landry;	state Exp;
branches;
next	1.79;
commitid	JUrh8wwKChol9TUR;

1.79
date	2015.10.31.15.11.00;	author landry;	state Exp;
branches;
next	1.78;
commitid	UkScmvTrXlfu75Vm;

1.78
date	2015.09.24.20.18.12;	author landry;	state Exp;
branches;
next	1.77;
commitid	99gVh6Min75BBMNY;

1.77
date	2015.09.19.09.03.24;	author landry;	state Exp;
branches;
next	1.76;
commitid	gB86WLtTAyRSsl3q;

1.76
date	2015.07.05.19.58.57;	author landry;	state Exp;
branches;
next	1.75;
commitid	gDVpBuoWGLDuBTPZ;

1.75
date	2015.05.16.07.18.16;	author landry;	state Exp;
branches;
next	1.74;
commitid	sPNNmeDQSxMrKAEA;

1.74
date	2015.03.16.19.47.35;	author landry;	state Exp;
branches;
next	1.73;
commitid	5ECRRTfvkLLpRpXb;

1.73
date	2015.01.03.10.49.41;	author landry;	state Exp;
branches;
next	1.72;
commitid	SC6tr2q6vkdpPSF1;

1.72
date	2014.10.17.07.16.56;	author landry;	state Exp;
branches;
next	1.71;
commitid	GUySsGXPzG1AMy1W;

1.71
date	2014.07.24.17.57.42;	author landry;	state Exp;
branches;
next	1.70;
commitid	X9rnPyX5SgSII22p;

1.70
date	2014.06.14.12.50.40;	author landry;	state Exp;
branches;
next	1.69;
commitid	YjszKFP5txmQmZMy;

1.69
date	2014.04.29.21.16.26;	author landry;	state Exp;
branches;
next	1.68;

1.68
date	2014.04.23.05.44.06;	author ajacoutot;	state Exp;
branches;
next	1.67;

1.67
date	2014.03.24.21.03.39;	author landry;	state Exp;
branches;
next	1.66;

1.66
date	2014.03.10.20.33.13;	author landry;	state Exp;
branches;
next	1.65;

1.65
date	2013.12.12.19.49.51;	author landry;	state Exp;
branches;
next	1.64;

1.64
date	2013.11.30.12.03.44;	author landry;	state Exp;
branches;
next	1.63;

1.63
date	2013.11.25.14.16.23;	author sthen;	state Exp;
branches;
next	1.62;

1.62
date	2013.11.22.12.26.06;	author landry;	state Exp;
branches;
next	1.61;

1.61
date	2013.10.19.16.27.37;	author landry;	state Exp;
branches;
next	1.60;

1.60
date	2013.09.19.13.06.44;	author landry;	state Exp;
branches;
next	1.59;

1.59
date	2013.09.19.12.20.08;	author landry;	state Exp;
branches;
next	1.58;

1.58
date	2013.08.08.06.58.31;	author landry;	state Exp;
branches;
next	1.57;

1.57
date	2013.07.11.16.24.10;	author landry;	state Exp;
branches
	1.57.2.1;
next	1.56;

1.56
date	2013.06.26.19.18.48;	author landry;	state Exp;
branches;
next	1.55;

1.55
date	2013.06.20.06.54.38;	author ajacoutot;	state Exp;
branches;
next	1.54;

1.54
date	2013.06.17.19.29.05;	author ajacoutot;	state Exp;
branches;
next	1.53;

1.53
date	2013.05.30.14.08.05;	author landry;	state Exp;
branches;
next	1.52;

1.52
date	2013.04.06.14.39.58;	author landry;	state Exp;
branches;
next	1.51;

1.51
date	2013.02.09.14.49.53;	author sthen;	state Exp;
branches;
next	1.50;

1.50
date	2013.01.11.22.51.44;	author landry;	state Exp;
branches;
next	1.49;

1.49
date	2012.12.04.21.05.29;	author landry;	state Exp;
branches;
next	1.48;

1.48
date	2012.11.12.20.45.32;	author landry;	state Exp;
branches;
next	1.47;

1.47
date	2012.10.24.19.28.43;	author landry;	state Exp;
branches;
next	1.46;

1.46
date	2012.10.20.11.17.56;	author landry;	state Exp;
branches;
next	1.45;

1.45
date	2012.09.22.10.30.17;	author landry;	state Exp;
branches;
next	1.44;

1.44
date	2012.09.01.17.48.19;	author landry;	state Exp;
branches;
next	1.43;

1.43
date	2012.06.11.15.26.14;	author landry;	state Exp;
branches;
next	1.42;

1.42
date	2012.04.30.15.14.55;	author landry;	state Exp;
branches;
next	1.41;

1.41
date	2012.04.23.17.15.19;	author espie;	state Exp;
branches;
next	1.40;

1.40
date	2012.03.16.21.27.09;	author landry;	state Exp;
branches;
next	1.39;

1.39
date	2012.02.20.20.09.02;	author landry;	state Exp;
branches;
next	1.38;

1.38
date	2012.01.10.23.58.27;	author nigel;	state Exp;
branches;
next	1.37;

1.37
date	2011.10.03.21.04.57;	author landry;	state Exp;
branches;
next	1.36;

1.36
date	2011.09.06.19.40.24;	author landry;	state Exp;
branches;
next	1.35;

1.35
date	2011.08.24.06.16.48;	author landry;	state Exp;
branches;
next	1.34;

1.34
date	2011.08.23.20.09.54;	author landry;	state Exp;
branches;
next	1.33;

1.33
date	2011.08.23.08.38.13;	author landry;	state Exp;
branches;
next	1.32;

1.32
date	2011.07.24.07.48.20;	author landry;	state Exp;
branches
	1.32.2.1;
next	1.31;

1.31
date	2011.07.08.11.07.32;	author landry;	state Exp;
branches;
next	1.30;

1.30
date	2011.06.07.10.05.07;	author landry;	state Exp;
branches;
next	1.29;

1.29
date	2011.06.06.14.07.22;	author landry;	state Exp;
branches;
next	1.28;

1.28
date	2011.06.06.09.32.55;	author landry;	state Exp;
branches;
next	1.27;

1.27
date	2011.05.04.08.11.15;	author dcoppa;	state Exp;
branches;
next	1.26;

1.26
date	2011.04.28.20.44.47;	author landry;	state Exp;
branches;
next	1.25;

1.25
date	2011.04.01.08.32.32;	author landry;	state Exp;
branches;
next	1.24;

1.24
date	2011.03.27.20.23.25;	author landry;	state Exp;
branches;
next	1.23;

1.23
date	2011.03.22.13.18.26;	author landry;	state Exp;
branches;
next	1.22;

1.22
date	2011.03.10.16.45.42;	author landry;	state Exp;
branches;
next	1.21;

1.21
date	2011.03.10.14.34.17;	author dcoppa;	state Exp;
branches;
next	1.20;

1.20
date	2011.01.18.12.31.24;	author landry;	state Exp;
branches;
next	1.19;

1.19
date	2011.01.14.22.52.37;	author landry;	state Exp;
branches;
next	1.18;

1.18
date	2011.01.14.22.46.29;	author landry;	state Exp;
branches;
next	1.17;

1.17
date	2010.12.01.15.00.12;	author dcoppa;	state Exp;
branches;
next	1.16;

1.16
date	2010.11.22.08.36.49;	author espie;	state Exp;
branches;
next	1.15;

1.15
date	2010.11.11.09.30.36;	author jasper;	state Exp;
branches;
next	1.14;

1.14
date	2010.10.27.16.58.30;	author landry;	state Exp;
branches;
next	1.13;

1.13
date	2010.10.26.17.36.02;	author landry;	state Exp;
branches;
next	1.12;

1.12
date	2010.10.25.10.48.00;	author landry;	state Exp;
branches;
next	1.11;

1.11
date	2010.10.24.17.56.11;	author landry;	state Exp;
branches;
next	1.10;

1.10
date	2010.10.22.19.17.01;	author landry;	state Exp;
branches;
next	1.9;

1.9
date	2010.10.18.07.15.56;	author landry;	state Exp;
branches;
next	1.8;

1.8
date	2010.10.15.07.16.19;	author landry;	state Exp;
branches;
next	1.7;

1.7
date	2010.10.11.08.19.04;	author jasper;	state Exp;
branches;
next	1.6;

1.6
date	2010.09.19.19.18.35;	author landry;	state Exp;
branches;
next	1.5;

1.5
date	2010.09.04.09.31.19;	author landry;	state Exp;
branches;
next	1.4;

1.4
date	2010.07.31.09.14.48;	author landry;	state Exp;
branches;
next	1.3;

1.3
date	2010.07.27.14.20.15;	author landry;	state Exp;
branches;
next	1.2;

1.2
date	2010.07.09.15.08.39;	author landry;	state Exp;
branches;
next	1.1;

1.1
date	2010.07.08.21.06.13;	author landry;	state Exp;
branches;
next	;

1.32.2.1
date	2011.12.20.10.32.49;	author sthen;	state Exp;
branches;
next	;

1.57.2.1
date	2013.11.14.09.57.07;	author jasper;	state Exp;
branches;
next	;

1.102.2.1
date	2017.08.08.10.24.54;	author landry;	state Exp;
branches;
next	;
commitid	CdAhMwyvOoJTE4bH;


desc
@@


1.108
log
@Bump dependencies to nss 3.33/nspr 4.17/sqlite 3.20.1.

required for upcoming gecko 57 branch, will make my life easier.
@
text
@# $OpenBSD: mozilla.port.mk,v 1.107 2017/08/08 10:15:12 landry Exp $

# ppc: firefox-esr/thunderbird xpcshell segfaults during startup compilation
# ppc: seamonkey/firefox - failure to link for atomic ops on 64 bits
# gcc does ICE on alpha at some particular spots:
# thunderbird-24.0/comm-esr24/mozilla/js/src/vm/Debugger.cpp:3246
# firefox-24.0/mozilla-release/js/src/frontend/BytecodeEmitter.cpp:1488
# seamonkey-2.22/comm-release/mozilla/js/src/vm/Interpreter.cpp:743
# firefox-25.0/mozilla-release/js/src/builtin/MapObject.cpp:1119

DPB_PROPERTIES =	parallel

.for _lib in ${MOZILLA_LIBS}
SHARED_LIBS +=	${_lib}	${SO_VERSION}
.endfor

PKGNAME ?=	${MOZILLA_PROJECT}-${MOZILLA_VERSION:S/b/beta/}

MAINTAINER ?=	Landry Breuil <landry@@openbsd.org>

MOZILLA_DIST ?=	${MOZILLA_PROJECT}
MOZILLA_DIST_VERSION ?=	${MOZILLA_VERSION:C/rc.//}

HOMEPAGE ?=	https://www.mozilla.org/projects/${MOZILLA_DIST}

.if ${MOZILLA_VERSION:M*rc?}
MASTER_SITES ?=	https://ftp.mozilla.org/pub/mozilla.org/${MOZILLA_DIST}/candidates/${MOZILLA_DIST_VERSION}-candidates/build${MOZILLA_VERSION:C/.*(.)/\1/}/source/
# first is the CDN and only has last releases
# ftp.m.o has all the betas/candidate builds but should only be used as fallback
.else
MASTER_SITES ?=	https://releases.mozilla.org/pub/mozilla.org/${MOZILLA_DIST}/releases/${MOZILLA_DIST_VERSION}/source/ \
		https://ftp.mozilla.org/pub/mozilla.org/${MOZILLA_DIST}/releases/${MOZILLA_DIST_VERSION}/source/
.endif

DISTNAME ?=	${MOZILLA_DIST}-${MOZILLA_DIST_VERSION}.source
EXTRACT_SUFX ?=	.tar.xz
DIST_SUBDIR ?=	mozilla

MODMOZ_RUN_DEPENDS =	devel/desktop-file-utils
# autoconf-2.13 isnt a real dependency since a while, but configure still checks for it
MODMOZ_BUILD_DEPENDS =	devel/autoconf/2.13 \
			archivers/gtar \
			archivers/unzip \
			archivers/zip>=2.3

.if !defined(MOZILLA_USE_BUNDLED_NSS)
MODMOZ_LIB_DEPENDS +=	security/nss>=3.33
MODMOZ_WANTLIB +=	nss3 nssutil3 smime3 ssl3
CONFIGURE_ARGS +=	--with-system-nss
.endif

.if !defined(MOZILLA_USE_BUNDLED_NSPR)
MODMOZ_LIB_DEPENDS +=	devel/nspr>=4.17
MODMOZ_WANTLIB +=	nspr4 plc4 plds4
CONFIGURE_ARGS +=	--with-system-nspr
.endif

.if !defined(MOZILLA_USE_BUNDLED_LIBEVENT)
MODMOZ_WANTLIB +=	event
CONFIGURE_ARGS +=	--with-system-libevent=/usr/
.endif

.if !defined(MOZILLA_USE_BUNDLED_ICU)
MODMOZ_LIB_DEPENDS +=	textproc/icu4c
MODMOZ_WANTLIB +=	icudata icui18n icuuc
CONFIGURE_ARGS +=	--with-system-icu
.endif

.if !defined(MOZILLA_USE_BUNDLED_HUNSPELL)
MODMOZ_LIB_DEPENDS +=	textproc/hunspell>=1.6
MODMOZ_WANTLIB +=	hunspell-1.6
CONFIGURE_ARGS +=	--with-system-hunspell
.endif

.if !defined(MOZILLA_USE_BUNDLED_SQLITE)
MODMOZ_WANTLIB +=	sqlite3
MODMOZ_LIB_DEPENDS +=	databases/sqlite3>=3.20.1
CONFIGURE_ARGS +=	--enable-system-sqlite
# hack to build against systemwide sqlite3 (# 546162)
CONFIGURE_ENV +=	ac_cv_sqlite_secure_delete=yes
.endif

# bug #736961
SEPARATE_BUILD =	Yes

# needed for webm
.if ${MACHINE_ARCH:Mi386} || ${MACHINE_ARCH:Mamd64}
MODMOZ_BUILD_DEPENDS +=	devel/yasm
.endif

MODMOZ_WANTLIB +=	X11 Xext Xrender Xt atk-1.0 c cairo \
		fontconfig freetype gdk_pixbuf-2.0 gio-2.0 glib-2.0 \
		gobject-2.0 gthread-2.0 m \
		pango-1.0 pangocairo-1.0 pangoft2-1.0 \
		pthread sndio ${LIBCXX} z

# --no-keep-memory avoids OOM when linking libxul
CONFIGURE_ENV +=	LDFLAGS="-Wl,--no-keep-memory"

WANTLIB +=	${MODMOZ_WANTLIB}
BUILD_DEPENDS +=${MODMOZ_BUILD_DEPENDS}
LIB_DEPENDS +=	${MODMOZ_LIB_DEPENDS}
RUN_DEPENDS +=	${MODMOZ_RUN_DEPENDS}

USE_GMAKE ?=	Yes

# no --with-system-jpeg starting with fx 18, requires libjpeg-turbo because of bug 791305
# no --with-system-cairo, too much gfx problems because of version mismatch
# no --with-system-ffi, needs 3.0.10 when not using gcc
# no --with-system-png, apng support not bundled in

AUTOCONF_VERSION =	2.13
CONFIGURE_ARGS +=	--with-system-zlib=/usr	\
		--with-system-bz2=${LOCALBASE}	\
		--enable-official-branding	\
		--disable-gconf			\
		--disable-necko-wifi		\
		--disable-optimize		\
		--disable-tests			\
		--disable-updater		\
		--disable-dbus

FLAVORS +=	debug
FLAVOR ?=

.if ${FLAVOR:Mdebug}
CONFIGURE_ARGS +=	--enable-debug-symbols=-g \
			--disable-install-strip
INSTALL_STRIP =
.endif

.if defined(MOZILLA_USE_GTK3)
# https://bugzilla.mozilla.org/show_bug.cgi?id=983843
CONFIGURE_ARGS +=	--with-system-cairo
CONFIGURE_ARGS +=	--enable-default-toolkit=cairo-gtk3
MODMOZ_LIB_DEPENDS +=	x11/gtk+3
MODMOZ_WANTLIB +=	cairo-gobject gdk-3 gtk-3
.else
MODMOZ_WANTLIB +=	Xcursor Xi Xinerama Xrandr
.endif
MODMOZ_LIB_DEPENDS +=	x11/gtk+2
MODMOZ_WANTLIB +=	Xcomposite Xdamage Xfixes gdk-x11-2.0 gtk-x11-2.0

PORTHOME =	${WRKSRC}

# from browser/config/mozconfig
CONFIGURE_ARGS +=--enable-application=${MOZILLA_CODENAME}

WRKDIST ?=	${WRKDIR}/${MOZILLA_DIST}-${MOZILLA_DIST_VERSION}

# needed for PLIST
MOZILLA_VER =	${MOZILLA_VERSION:C/b[0-9]*//:C/esr//:C/rc.$//}
SUBST_VARS +=	MOZILLA_PROJECT MOZILLA_VER MOZILLA_VERSION

MAKE_ENV +=	MOZILLA_OFFICIAL=1 \
		SHELL=/bin/sh \
		SO_VERSION="${SO_VERSION}"

CONFIGURE_ENV +=	${MAKE_ENV}
# ensure libffi's configure doesnt pick gsed/gmkdir/gawk
CONFIGURE_ENV +=	ac_cv_path_ax_enable_builddir_sed=/usr/bin/sed
CONFIGURE_ENV +=	ac_cv_path_SED=/usr/bin/sed
CONFIGURE_ENV +=	ac_cv_path_mkdir=/bin/mkdir
CONFIGURE_ENV +=	ac_cv_prog_AWK=/usr/bin/awk
@


1.107
log
@Gecko 55 assorted changes.

- remove ONLY_FOR_ARCHS, it doesn't work in a module
- default EXTRACT_SUFX to .tar.xz
- bump nss requirement to 3.32 (technically, 55 requires 3.31, but 56
  will require 3.32..)
- bump nspr requirement to 4.16 (yadada yadada 4.15)
- bump sqlite requirement to 3.19.3
- remove junk from powerpc days, the boat has sailed
- ditch --enable-gio, its enabled by default, and now errors out as an
  unknown option with the new build system
- ditch junk for xulrunner, WRKDIST is always the same now
- ditch pre-configure target, it's useless now
@
text
@d1 1
a1 1
# $OpenBSD: mozilla.port.mk,v 1.106 2017/06/14 05:22:28 landry Exp $
d47 1
a47 1
MODMOZ_LIB_DEPENDS +=	security/nss>=3.32
d53 1
a53 1
MODMOZ_LIB_DEPENDS +=	devel/nspr>=4.16
d77 1
a77 1
MODMOZ_LIB_DEPENDS +=	databases/sqlite3>=3.19.3
@


1.106
log
@Bump dependencies for mozilla 54, and some cleanup.

- nss 3.30.1 is required
- nspr 4.14 is required
- remove plumbing for gtk3 FLAVOR, now the default anyway
- switch default MASTER_SITES and HOMEPAGE to https (from naddy@@)
@
text
@d1 1
a1 1
# $OpenBSD: mozilla.port.mk,v 1.105 2017/04/12 18:13:33 landry Exp $
a2 1
ONLY_FOR_ARCHS ?=	amd64 i386
d36 1
a36 1
EXTRACT_SUFX ?=	.tar.bz2
d47 1
a47 1
MODMOZ_LIB_DEPENDS +=	security/nss>=3.30.1
d53 1
a53 1
MODMOZ_LIB_DEPENDS +=	devel/nspr>=4.14
d76 2
a77 2
MODMOZ_WANTLIB +=	sqlite3>=35
MODMOZ_LIB_DEPENDS +=	databases/sqlite3>=3.17.0
a97 4
# --relax avoids relocation overflow on ppc, needed since sm 2.7b, tb 10.0b, fx 15.0b
.if ${MACHINE_ARCH} == "powerpc"
CONFIGURE_ENV +=	LDFLAGS="-Wl,--no-keep-memory -Wl,--relax"
.else
a98 1
.endif
a115 1
		--enable-gio			\
a148 3
.if ${MOZILLA_PROJECT} == "xulrunner"
WRKDIST ?=	${WRKDIR}/mozilla-${MOZILLA_BRANCH}
.else
a149 1
.endif
a164 9


pre-configure:
.for d in ${MOZILLA_AUTOCONF_DIRS}
	cd ${WRKSRC}/${d} && ${SETENV} ${AUTOCONF_ENV} ${AUTOCONF}
.endfor
.for f in ${MOZILLA_SUBST_FILES}
	${SUBST_CMD} ${WRKSRC}/${f}
.endfor
@


1.105
log
@Ride the previous REVISION bump and enforce dependency on nss 3.29.5,
hard requirement for firefox 53.
@
text
@d1 1
a1 1
# $OpenBSD: mozilla.port.mk,v 1.104 2017/04/12 18:12:33 landry Exp $
d25 1
a25 1
HOMEPAGE ?=	http://www.mozilla.org/projects/${MOZILLA_DIST}
d32 1
a32 1
MASTER_SITES ?=	http://releases.mozilla.org/pub/mozilla.org/${MOZILLA_DIST}/releases/${MOZILLA_DIST_VERSION}/source/ \
d48 1
a48 1
MODMOZ_LIB_DEPENDS +=	security/nss>=3.29.5
d54 1
a54 1
MODMOZ_LIB_DEPENDS +=	devel/nspr>=4.13.1
a130 3
.if ${PKGPATH} == "www/mozilla-firefox"
FLAVORS += gtk3
.endif
d139 1
a139 1
.if ${FLAVOR:Mgtk3} || defined(MOZILLA_USE_GTK3)
@


1.104
log
@Fix WANTLIB and bump REVISION for all ports depending on hunspell.

While here enforce dependency on hunspell 1.6 in mozilla.port.mk, as
it's a requirement for 53.
@
text
@d1 1
a1 1
# $OpenBSD: mozilla.port.mk,v 1.103 2017/04/10 11:46:35 sthen Exp $
d48 1
a48 1
MODMOZ_LIB_DEPENDS +=	security/nss>=3.28.1
@


1.103
log
@use LIBCXX
@
text
@d1 1
a1 1
# $OpenBSD: mozilla.port.mk,v 1.102 2017/03/09 07:08:24 landry Exp $
d71 2
a72 2
MODMOZ_LIB_DEPENDS +=	textproc/hunspell
MODMOZ_WANTLIB +=	hunspell-1.3
@


1.102
log
@As was done with nss/nspr/sqlite/icu4c, add boilerplate to allow
building against bundled hunspell - firefox 53 requires 1.5.4, 54/55
requires 1.6.0, and we're at 1.3.2. No change for consumer ports, they'd
have to define MOZILLA_USE_BUNDLED_HUNSPELL to do so.
@
text
@d1 1
a1 1
# $OpenBSD: mozilla.port.mk,v 1.101 2017/03/07 15:23:20 landry Exp $
d96 1
a96 1
		pthread sndio stdc++ z
@


1.102.2.1
log
@Hack: only pass --enable-gio when PKGPATH isnt www/mozilla-firefox.
Needed for 55.0 backport to build... sigh.
@
text
@d1 1
a1 1
# $OpenBSD: mozilla.port.mk,v 1.102 2017/03/09 07:08:24 landry Exp $
d122 1
a128 4

.if ${PKGPATH} != "www/mozilla-firefox"
CONFIGURE_ARGS +=	--enable-gio
.endif
@


1.101
log
@Bump dependency to sqlite >= 3.17.0 for upcoming mozilla 52 updates.
@
text
@d1 1
a1 1
# $OpenBSD: mozilla.port.mk,v 1.100 2017/02/18 22:32:25 landry Exp $
a46 2
MODMOZ_LIB_DEPENDS =	textproc/hunspell

d70 6
d96 1
a96 1
		pthread sndio stdc++ z hunspell-1.3
a120 1
		--enable-system-hunspell	\
@


1.100
log
@Somewhat fix DEBUG flavor (enable-debug-symbols expects debug flags,
not a yes/no flag)
From semarie@@
@
text
@d1 1
a1 1
# $OpenBSD: mozilla.port.mk,v 1.99 2017/02/18 16:22:54 landry Exp $
d73 2
a74 2
MODMOZ_WANTLIB +=	sqlite3>=32
MODMOZ_LIB_DEPENDS +=	databases/sqlite3
@


1.99
log
@Consolidate textproc/icu4c common dependency into mozilla.port.mk, and
allow to build against bundled icu4c by setting MOZILLA_USE_BUNDLED_ICU.
@
text
@d1 1
a1 1
# $OpenBSD: mozilla.port.mk,v 1.97 2017/01/24 21:25:14 landry Exp $
d134 1
a134 1
CONFIGURE_ARGS +=	--enable-debug-symbols=yes \
@


1.98
log
@As it's done for nss/sqlite/libevent, provide a way to build against
bundled nspr if MOZILLA_USE_BUNDLED_NSPR is set - no binary change for
ports using this module. Paves the way for some -stable work.
@
text
@d66 6
@


1.97
log
@Bump dependencies to devel/nspr>=4.13.1 and security/nss>=3.28, the
latter is a hard requirement for upcoming gecko 51. Bumps to follow.
@
text
@d1 1
a1 1
# $OpenBSD: mozilla.port.mk,v 1.96 2017/01/06 17:39:02 landry Exp $
d47 1
a47 2
MODMOZ_LIB_DEPENDS =	textproc/hunspell \
			devel/nspr>=4.13.1
d55 6
d85 2
a86 2
		nspr4 pango-1.0 pangocairo-1.0 pangoft2-1.0 \
		plc4 plds4 pthread sndio stdc++ z hunspell-1.3
a110 1
		--with-system-nspr		\
@


1.96
log
@Add ac_cv_path_mkdir=/bin/mkdir and ac_cv_prog_AWK=/usr/bin/awk to
CONFIGURE_ENV, should prevent internal libffi's configure to pickup
gmkdir or gawk as seen by sthen@@. Yay autohell.
@
text
@d1 1
a1 1
# $OpenBSD: mozilla.port.mk,v 1.95 2016/12/19 16:11:38 landry Exp $
d48 1
a48 1
			devel/nspr>=4.12
d51 1
a51 1
MODMOZ_LIB_DEPENDS +=	security/nss>=3.21.1
@


1.95
log
@Put ac_cv_path_SED=/usr/bin/sed in CONFIGURE_ENV, should fix another
build failure seen by ajacoutot@@. damn libffi's configure script tries
hard to detect and use gsed...
@
text
@d1 1
a1 1
# $OpenBSD: mozilla.port.mk,v 1.94 2016/11/06 21:54:35 landry Exp $
d161 1
a161 1
# ensure libffi's configure doesnt pick gsed
d164 3
@


1.94
log
@Set ac_cv_path_ax_enable_builddir_sed=/usr/bin/sed in CONFIGURE_ENV,
should prevent a build failure experienced by naddy@@. libffi's configure
checks for gsed, picks it up if found, and libffi's libtool (ugh) would
fail at runtime if dpb had junked gsed..

Looking why libffi's build system doesnt respect USE_LIBTOOL will
hopefully happen later. Or switch to system libffi, since it has been
updated...
@
text
@d1 1
a1 1
# $OpenBSD: mozilla.port.mk,v 1.93 2016/09/23 09:16:58 sthen Exp $
d163 1
@


1.93
log
@Cope with moving sqlite3 back to ports.
@
text
@d1 1
a1 1
# $OpenBSD: mozilla.port.mk,v 1.92 2016/07/04 07:15:07 landry Exp $
d161 2
@


1.92
log
@Use an explicit dependency on devel/autoconf/2.13 instead of relying on
MODGNU_AUTOCONF_DEPENDS being automagically set because CONFIGURE_STYLE
happens to be gnu, or not. Mozilla configure doesnt really use
autoconf-2.13 anyway in recent versions, but still checks for its presence...

Reported by naddy@@ several times.. thought i had fixed it
@
text
@d1 1
a1 1
# $OpenBSD: mozilla.port.mk,v 1.91 2016/05/31 20:15:51 landry Exp $
d63 1
@


1.91
log
@Add MODGNU_AUTOCONF_DEPENDS to MODMOZ_BUILD_DEPENDS, since the
CONFIGURE_STYLE switch from autoconf to gnu the BDEP on autoconf-2.13
was lost, and the autohell machinery still looks for it for $reasons.

Reported by naddy@@
@
text
@d1 1
a1 1
# $OpenBSD: mozilla.port.mk,v 1.90 2016/04/27 22:08:57 landry Exp $
d41 2
a42 1
MODMOZ_BUILD_DEPENDS =	${MODGNU_AUTOCONF_DEPENDS} \
@


1.90
log
@Adding mozgtk to MOZILLA_LIBS doesnt work, it's now done in the port
Makefile.
@
text
@d1 1
a1 1
# $OpenBSD: mozilla.port.mk,v 1.89 2016/04/27 13:37:32 landry Exp $
d41 2
a42 1
MODMOZ_BUILD_DEPENDS =	archivers/gtar \
@


1.89
log
@Preparation for upcoming gecko updates:
- shuffle MODMOZ_WANTLIB & MODMOZ_LIB_DEPENDS depending on gtk3 status.
  When using Gtk3, Gtk2 is still in the dependencies..
- introduce MOZILLA_USE_GTK3 flag to be set in a client port
- fix the WRKDIST setting depending on MOZILLA_PROJECT, xulrunner will
  be the last one 'different'...
@
text
@d1 1
a1 1
# $OpenBSD: mozilla.port.mk,v 1.88 2016/03/20 00:02:31 naddy Exp $
a130 1
MOZILLA_LIBS +=		mozgtk
@


1.88
log
@remove SHARED_ONLY from Mozilla ports, unused
@
text
@d1 1
a1 1
# $OpenBSD: mozilla.port.mk,v 1.87 2016/03/14 20:34:34 landry Exp $
d126 1
a126 1
.if ${FLAVOR:Mgtk3}
d131 2
a132 1
MODMOZ_WANTLIB +=	cairo-gobject gdk-3 gtk-3 gdk-x11-2.0 gtk-x11-2.0
d134 1
a134 2
MODMOZ_WANTLIB +=	Xcomposite Xcursor Xdamage Xfixes Xi Xinerama \
			Xrandr
d137 1
a137 1
MODMOZ_WANTLIB +=	gdk-x11-2.0 gtk-x11-2.0
d144 1
a144 4
# starting with esr45, only xulrunner will be special
.if ${MOZILLA_PROJECT} == "thunderbird"
WRKDIST ?=	${WRKDIR}/comm-${MOZILLA_BRANCH}
.elif ${MOZILLA_PROJECT} == "xulrunner" || ${PKGPATH} == "www/firefox-esr"
@


1.87
log
@Bump dependencies to nss 3.21.1 and nspr 4.12, required by upcoming
gecko 45 updates.
@
text
@d1 1
a1 1
# $OpenBSD: mozilla.port.mk,v 1.86 2016/03/14 20:33:16 landry Exp $
a2 1
SHARED_ONLY =	Yes
@


1.86
log
@Tweak/fix MODMOZ_WANTLIB/MODMOZ_LIB_DEPENDS wrt gtk dependencies.
@
text
@d1 1
a1 1
# $OpenBSD: mozilla.port.mk,v 1.84 2016/01/27 18:04:09 landry Exp $
d47 1
a47 1
			devel/nspr>=4.10.10
d50 1
a50 1
MODMOZ_LIB_DEPENDS +=	security/nss>=3.20.1
@


1.85
log
@tweak MOZILLA_VER regex so that i can use beta *and* rc in a version number
@
text
@d132 1
a132 1
MODMOZ_WANTLIB +=	cairo-gobject gdk-3 gtk-3 pixman-1 pthread-stubs
a133 1
MODMOZ_LIB_DEPENDS +=	x11/gtk+2
d135 1
a135 1
			Xrandr gdk-x11-2.0 gtk-x11-2.0
d137 2
@


1.84
log
@Winter cleanup in preparation for gecko 44.

* Move the nss/libevent/sqlite dependencies to separate blocks, allowing
  to disable them by defining MOZILLA_USE_BUNDLED_NSS|SQLITE|LIBEVENT.
Gecko 44 doesn't build against our base libevent1, and it's simpler to
use the bundled/patched libevent instead of ports libevent2. This should
also help tbb which insists on using its own (heavily patched) nss

* Bump sqlite dependency, gecko 44 requires sqlite 3.9.1

* Fix debug FLAVOR, use only --enable-debug-symbols=yes
  --disable-install-strip. The resulting pkg is only around 280Mb, and
unstripped libxul is 800Mb. Adventurous users can show it to gdb.

* Rework the way default value is set for WRKDIST, soon (with esr45)
xulrunner will be the only exception left

* Remove unused _MOZDIR definition
@
text
@d1 1
a1 1
# $OpenBSD: mozilla.port.mk,v 1.83 2016/01/22 10:28:58 landry Exp $
d154 1
a154 1
MOZILLA_VER =	${MOZILLA_VERSION:C/b[0-9]*$//:C/esr//:C/rc.$//}
@


1.83
log
@Face reality, various mozillas only build on amd64 or i386.

The last reliable gecko builds on macppc were done with:
OpenBSD 5.8-current (GENERIC.MP) #761: Mon Aug 31 08:01:30 MDT 2015
(mpi@@ says SecurePLT was commited beginning of Sep, so .. related?)

Thunderbird and firefox-esr strangely built on sparc64 (by accident?) in
may and june (when it was gecko 31) but other than that firefox itself
never built in 2015.

Anybody is welcome to look into this, just add you beloved arch to
ONLY_FOR_ARCHS in mozilla.port.mk.

While here, also amend ONLY_FOR_ARCHS in langpacks ports, no point in
packaging them if you don't have the corresponding package.

Avoids wasting hours during bulks, only keep xulrunner building on
powerpc and sparc64.
@
text
@d1 1
a1 1
# $OpenBSD: mozilla.port.mk,v 1.82 2015/11/09 13:55:22 landry Exp $
d47 19
a65 2
			devel/nspr>=4.10.10 \
			security/nss>=3.20.1
d78 2
a79 6
		nspr4 nss3 pango-1.0 pangocairo-1.0 pangoft2-1.0 \
		plc4 plds4 pthread event kvm sqlite3>=31 \
		smime3 sndio nssutil3 ssl3 stdc++ z hunspell-1.3

# hack to build against systemwide sqlite3 (# 546162)
CONFIGURE_ENV +=	ac_cv_sqlite_secure_delete=yes
a102 1
		--with-system-libevent=/usr/	\
a104 1
		--with-system-nss		\
a105 1
		--enable-system-sqlite		\
d122 1
a122 3
CONFIGURE_ARGS +=	--enable-debug \
			--enable-profiling \
			--enable-debug-symbols=yes \
d144 3
a146 4
.if ${PKGPATH} == "www/mozilla-firefox" || \
	${PKGPATH} == "www/seamonkey" || \
	(${MOZILLA_PROJECT} == "thunderbird" && ${MOZILLA_BRANCH} == "beta")
WRKDIST ?=	${WRKDIR}/${MOZILLA_DIST}-${MOZILLA_DIST_VERSION}
d150 1
a150 2
WRKDIST ?=	${WRKDIR}/comm-${MOZILLA_BRANCH}
_MOZDIR =	mozilla
@


1.82
log
@fix WRKDIST for seamonkey now that it uses new layout
@
text
@d1 1
a1 1
# $OpenBSD: mozilla.port.mk,v 1.81 2015/11/04 07:32:03 landry Exp $
d4 3
a6 1
ONLY_FOR_ARCHS=	amd64 arm i386 powerpc sparc64
@


1.81
log
@Enforce requirement on latest nss/nspr, requirement for gecko 42.

While here adapt the WRKDIST dance, starting with this gecko the tarball
is layed out ${MOZILLA_DIST}-${MOZILLA_DIST_VERSION} instead of
mozilla-${MOZILLA_BRANCH} - do this for www/mozilla-firefox and
thunderbird-beta only for now.
@
text
@d1 1
a1 1
# $OpenBSD: mozilla.port.mk,v 1.80 2015/10/31 15:12:38 landry Exp $
d134 3
a136 1
.if ${PKGPATH} == "www/mozilla-firefox" || (${MOZILLA_PROJECT} == "thunderbird" && ${MOZILLA_BRANCH} == "beta")
@


1.80
log
@Release candidates are in their own subdirs on the mirrors now.
@
text
@d1 1
a1 1
# $OpenBSD: mozilla.port.mk,v 1.79 2015/10/31 15:11:00 landry Exp $
d45 2
a46 2
			devel/nspr>=4.10.8 \
			security/nss>=3.19.2
d134 3
a136 2
.if ${MOZILLA_PROJECT} == "firefox" || \
	${MOZILLA_PROJECT} == "xulrunner"
@


1.79
log
@Dont assume esr ends MOZILLA_VERSION when constructing MOZILLA_VER from
it. Allows to use rc altogether esr, ie 38.4.0esrrc2 for example...
@
text
@d1 1
a1 1
# $OpenBSD: mozilla.port.mk,v 1.78 2015/09/24 20:18:12 landry Exp $
d27 1
a27 1
MASTER_SITES ?=	https://ftp.mozilla.org/pub/mozilla.org/${MOZILLA_DIST}/nightly/${MOZILLA_DIST_VERSION}-candidates/build${MOZILLA_VERSION:C/.*(.)/\1/}/source/
@


1.78
log
@Enforce dependency on latest sqlite, needed for gecko 41
@
text
@d1 1
a1 1
# $OpenBSD: mozilla.port.mk,v 1.77 2015/09/19 09:03:24 landry Exp $
d143 1
a143 1
MOZILLA_VER =	${MOZILLA_VERSION:C/b[0-9]*$//:C/esr$//:C/rc.$//}
@


1.77
log
@Use https MASTER_SITES for rcs, and remove ftp from MASTER_SITES - has
been shut down upstream.
@
text
@d1 1
a1 1
# $OpenBSD: mozilla.port.mk,v 1.76 2015/07/05 19:58:57 landry Exp $
d60 1
a60 1
		plc4 plds4 pthread event kvm sqlite3>=30 \
@


1.76
log
@Enforce dependency on nss 3.19.2, required by gecko 39.
@
text
@d1 1
a1 1
# $OpenBSD: mozilla.port.mk,v 1.75 2015/05/16 07:18:16 landry Exp $
d27 1
a27 1
MASTER_SITES ?=	ftp://ftp.mozilla.org/pub/mozilla.org/${MOZILLA_DIST}/nightly/${MOZILLA_DIST_VERSION}-candidates/build${MOZILLA_VERSION:C/.*(.)/\1/}/source/
d32 1
a32 2
		https://ftp.mozilla.org/pub/mozilla.org/${MOZILLA_DIST}/releases/${MOZILLA_DIST_VERSION}/source/ \
		ftp://ftp.mozilla.org/pub/mozilla.org/${MOZILLA_DIST}/releases/${MOZILLA_DIST_VERSION}/source/
@


1.75
log
@Bump dependency on nss 3.18.1 and sqlite 3.8.9, required by gecko 38.
@
text
@d1 1
a1 1
# $OpenBSD: mozilla.port.mk,v 1.74 2015/03/16 19:47:35 landry Exp $
d47 1
a47 1
			security/nss>=3.18.1
@


1.74
log
@Bump dependencies for gecko 36:

- nspr 4.10.8
- nss 3.17.4
- sqlite3>=29 (ie sqlite 3.8.7.4)
@
text
@d1 1
a1 1
# $OpenBSD: mozilla.port.mk,v 1.73 2015/01/03 10:49:41 landry Exp $
d47 1
a47 1
			security/nss>=3.17.4
d61 1
a61 1
		plc4 plds4 pthread event kvm sqlite3>=29 \
@


1.73
log
@Fix regex to match bX with X >=10 instead of only 0-9
@
text
@d1 1
a1 1
# $OpenBSD: mozilla.port.mk,v 1.72 2014/10/17 07:16:56 landry Exp $
d46 2
a47 2
			devel/nspr>=4.10.7 \
			security/nss>=3.17.2
d61 1
a61 1
		plc4 plds4 pthread event kvm sqlite3>=28 \
@


1.72
log
@Assorted updates for gecko 33.

- enforce dependency on sqlite3>=28 (sqlite 3.8.5), nss 3.17.2 and nspr
  4.10.7.
- add handling for 'rc' in MOZILLA_VERSION, MOZILLA_DIST_VERSION and
  MOZILLA_VER
- when 'rc' is set, fetch the corresponding candidate build from the
  appropriate dir on the mirror
@
text
@d1 1
a1 1
# $OpenBSD: mozilla.port.mk,v 1.71 2014/07/24 17:57:42 landry Exp $
d144 1
a144 1
MOZILLA_VER =	${MOZILLA_VERSION:C/b.$//:C/esr$//:C/rc.$//}
@


1.71
log
@Ensure we depend on nss 3.16.2 for gecko 31 updates.
Set PORTHOME to ${WRKSRC}, since the build system creates a ~/Desktop
dir for some reason (from ajacoutot@@)

This commit (and all the upcoming moz-related ones) are ok jasper@@ sthen@@ naddy@@
@
text
@d1 1
a1 1
# $OpenBSD: mozilla.port.mk,v 1.70 2014/06/14 12:50:40 landry Exp $
d22 1
a22 1
MOZILLA_DIST_VERSION ?=	${MOZILLA_VERSION}
d26 2
d30 1
d34 2
d46 2
a47 2
			devel/nspr>=4.10.6 \
			security/nss>=3.16.2
d61 1
a61 1
		plc4 plds4 pthread event kvm sqlite3>=27 \
d144 1
a144 1
MOZILLA_VER =	${MOZILLA_VERSION:C/b.$//:C/esr$//}
@


1.70
log
@Plumbing for upcoming ffx 30:

- bump nspr dependency to 4.10.6.
- remove libIDL BDEP, not needed anymore
- add a gtk3 FLAVOR for firefox only, provided as a tech preview. Not
  everything works, it's in pretty good shape, but not considered ready
yet upstream. You have been warned! Note this also needs to be built
with system-cairo.
- shuffle LDEP/WANTLIB around for gtk3 FLAVOR.
@
text
@d1 1
a1 1
# $OpenBSD: mozilla.port.mk,v 1.69 2014/04/29 21:16:26 landry Exp $
d42 1
a42 1
			security/nss>=3.16
d124 2
@


1.69
log
@Batch of changes for gecko 29:

- enforce dependency on nss 3.16
- fix spellchecking by building against systemwide hunspell. For some
  reason the bundled hunspell can't open its own dict (#991278)
- add SHELL=/bin/sh as mozbuild now relies on it
- remove now useless default MODGNU_CONFIG_GUESS_DIRS & MOZILLA_SUBST_FILES
@
text
@d1 1
a1 1
# $OpenBSD: mozilla.port.mk,v 1.68 2014/04/23 05:44:06 ajacoutot Exp $
d36 1
a36 2
MODMOZ_BUILD_DEPENDS =	devel/libIDL \
			archivers/gtar \
d40 2
a41 3
MODMOZ_LIB_DEPENDS =	x11/gtk+2 \
			textproc/hunspell \
			devel/nspr>=4.10.3 \
d52 3
a54 4
MODMOZ_WANTLIB +=	X11 Xcomposite Xcursor Xdamage Xext Xfixes Xi \
		Xinerama Xrandr Xrender Xt atk-1.0 c cairo \
		fontconfig freetype gdk-x11-2.0 gdk_pixbuf-2.0 gio-2.0 glib-2.0 \
		gobject-2.0 gthread-2.0 gtk-x11-2.0 m \
d100 3
d111 12
@


1.68
log
@Drop outdated comment.

ok landry@@
@
text
@d1 1
a1 1
# $OpenBSD: mozilla.port.mk,v 1.67 2014/03/24 21:03:39 landry Exp $
d42 1
d44 1
a44 1
			security/nss>=3.15.4
d60 1
a60 1
		smime3 sndio nssutil3 ssl3 stdc++ z
d91 1
d129 1
a132 6

MODGNU_CONFIG_GUESS_DIRS +=	${WRKSRC}/${_MOZDIR}/build/autoconf \
				${WRKSRC}/${_MOZDIR}/js/src/build/autoconf

# files to run SUBST_CMD on
MOZILLA_SUBST_FILES +=	${_MOZDIR}/extensions/spellcheck/hunspell/src/mozHunspell.cpp \
@


1.67
log
@Ensure mozillas depend on the newest sqlite 3.8.4 by setting
MODMOZ_WANTLIB to sqlite3>=27.
@
text
@d1 1
a1 1
# $OpenBSD: mozilla.port.mk,v 1.66 2014/03/10 20:33:13 landry Exp $
a80 1
# gecko doesnt link anymore with krb5 since 22 (bug 648730)
@


1.66
log
@Ensure ports using www/mozilla depend on the latest & greatest nss &
nspr, respectively 3.15.4 and 4.10.3.
@
text
@d1 1
a1 1
# $OpenBSD: mozilla.port.mk,v 1.65 2013/12/12 19:49:51 landry Exp $
d58 1
a58 1
		plc4 plds4 pthread event kvm sqlite3>=23 \
@


1.65
log
@Winter cleanup of mozilla.port.mk:

- remove all the cruft that was here for 'old' mozillas now that they're
  in the attic
- sanitize CONFIGURE_ARGS, remove all the unneeded stuff.
- cleanup CONFIGURE/MAKE_ENV
- reorganize *DEPENDS, and finally fix WANTLIB

mozilla.port.mk |  144 ++++++++++----------------------------------------------
1 file changed, 28 insertions(+), 116 deletions(-)
@
text
@d1 1
a1 1
# $OpenBSD: mozilla.port.mk,v 1.64 2013/11/30 12:03:44 landry Exp $
d42 2
a43 2
			devel/nspr>=4.10.2 \
			security/nss>=3.15.3.1
@


1.64
log
@Remove alpha from ONLY_FOR_ARCHS, it's pointless wasting cpu cycles
during bulks just to see gcc 4.6 blowing at some given spots. Firefox 3
was running fine there though... but xulrunner/1.9 and
productivity/sunbird are soon going to the attic anyway. Only a masochist
with alpha & gcc skills + enough patience might be brave enough to look
at it..
@
text
@d1 1
a1 1
# $OpenBSD: mozilla.port.mk,v 1.63 2013/11/25 14:16:23 sthen Exp $
d26 2
d38 1
d41 3
a43 11
MODMOZ_LIB_DEPENDS =	x11/gtk+2

# special case the long-term maintained mozillas
.if ${MOZILLA_PROJECT} == "firefox" || \
	${MOZILLA_PROJECT} == "thunderbird" || \
	${MOZILLA_PROJECT} == "xulrunner" || \
	${MOZILLA_PROJECT} == "seamonkey"
MODMOZ_LIB_DEPENDS +=	devel/nspr>=4.10 \
			security/nss>=3.15
# needed during install
MODMOZ_BUILD_DEPENDS +=	archivers/unzip
a52 28
CONFIGURE_ARGS +=	--enable-official-branding
CONFIGURE_ARGS +=	--disable-gconf
CONFIGURE_ARGS +=	--enable-gio
CONFIGURE_ARGS +=	--with-system-libevent=/usr/
CONFIGURE_ARGS +=	--with-system-bz2=${LOCALBASE}
MODMOZ_WANTLIB +=	event
.else
# for old mozillas : fennec, sunbird, firefox36, xulrunner
MODMOZ_LIB_DEPENDS +=	devel/nspr \
			security/nss

# no --with-system-jpeg starting with fx 18, requires libjpeg-turbo because of bug 791305
CONFIGURE_ARGS +=	--with-system-jpeg=${LOCALBASE}
MODMOZ_WANTLIB += jpeg

# for mozilla branches 1.9.2 and esr10 (fennec), build against systemwide cairo
CONFIGURE_ARGS +=	--enable-system-cairo

# gecko doesnt link anymore with krb5 since 22 (bug 648730)
MODMOZ_WANTLIB +=	crypto krb5 asn1 com_err heimbase roken wind

# sydneyaudio was removed in gecko 22
post-extract:
# syndeyaudio sndio file comes from ffx FILESDIR
	cp -f ${PORTSDIR}/www/mozilla-firefox/files/sydney_audio_sndio.c \
		${WRKSRC}/${_MOZDIR}/media/libsydneyaudio/src/
.endif

d58 1
a58 1
		pixman-1 plc4 plds4 pthread pthread-stubs \
d61 1
a61 3
# for all mozilla ports, build against systemwide sqlite3
MODMOZ_WANTLIB +=	sqlite3>=23
CONFIGURE_ARGS +=	--enable-system-sqlite
d79 6
d87 2
d91 5
a95 1
		--with-pthreads			\
a97 2
		--disable-pedantic		\
		--disable-installer		\
d99 1
a99 21
		--disable-gnomeui		\
		--disable-gnomevfs		\
		--disable-dbus			\
		--enable-default-toolkit=cairo-gtk2 \
		--enable-xinerama		\
		--enable-svg			\
		--enable-svg-renderer=cairo	\
		--enable-canvas


# those ones only apply to mozilla branch 1.9.2
# crashreporter uses google breakpad, osx/win/lin/sol only
CONFIGURE_ARGS +=--disable-freetypetest		\
		--disable-mochitest		\
		--disable-libIDLtest		\
		--disable-glibtest		\
		--disable-necko-wifi		\
		--disable-crashreporter		\
		--disable-libnotify		\
		--enable-xft			\
		--disable-ipc
d116 1
a116 3
	${MOZILLA_PROJECT} == "xulrunner" || \
	${MOZILLA_PROJECT} == "fennec" || \
	${MOZILLA_PROJECT} == "xulrunner1.9"
a122 5
# target directory for installation
MOZ =		${PREFIX}/${MOZILLA_PROJECT}
# source for installation
MOB =		${WRKSRC}/${_MOZDIR}/dist/bin

d124 2
a125 2
MOZILLA_VER =	${MOZILLA_VERSION:C/b.$//:C/esr//}
SUBST_VARS +=	MOZILLA_PROJECT MOZILLA_VER MOZILLA_VERSION 
d127 1
a127 4
MAKE_ENV +=	MOZ_CO_PROJECT=${MOZILLA_CODENAME} \
		LD_LIBRARY_PATH=${MOB} \
		BUILD_OFFICIAL=1 \
		MOZILLA_OFFICIAL=1 \
d130 1
a130 4
CONFIGURE_ENV +=${MAKE_ENV} \
		PKG_CONFIG_PATH="${LOCALBASE}/lib/pkgconfig:${X11BASE}/lib/pkgconfig" \
		MOZ_ENABLE_COREXFONTS=1 \
		topsrcdir=${WRKSRC}
d136 1
a136 8
MOZILLA_SUBST_FILES +=	${_MOZDIR}/xpcom/io/nsAppFileLocationProvider.cpp \
			${_MOZDIR}/build/unix/mozilla.in \
			${_MOZDIR}/extensions/spellcheck/hunspell/src/mozHunspell.cpp \
			${_MOZDIR}/toolkit/xre/nsXREDirProvider.cpp

.if ${MOZILLA_BRANCH} == 1.9.2
MOZILLA_SUBST_FILES +=	${_MOZDIR}/js/src/xpconnect/shell/Makefile.in
.endif
a144 23

# common install target - ports can use post-install for specific stuff
.if ${MOZILLA_PROJECT} == "xulrunner1.9" || \
	${MOZILLA_PROJECT} == "firefox36" || \
	${MOZILLA_PROJECT} == "sunbird"
do-install:
	cd ${MOB} && \
		find ${MOZILLA_DATADIRS} -type d \
			-exec ${INSTALL_DATA_DIR} ${MOZ}/{} \; && \
		find ${MOZILLA_DATADIRS} ! -type d \
			-exec ${INSTALL_DATA} -m 644 {} ${MOZ}/{} \;
	${INSTALL_DATA} ${MOB}/*.so.${SO_VERSION} ${MOB}/*.ini ${MOZ}
	# install shell wrapper to ${PREFIX}/bin
	${INSTALL_SCRIPT} ${MOB}/${MOZILLA_PROJECT} ${PREFIX}/bin
	${INSTALL_SCRIPT} ${MOB}/run-mozilla.sh ${MOZ}
	${INSTALL_PROGRAM} ${MOB}/${MOZILLA_PROJECT}-bin ${MOB}/mozilla-xremote-client ${MOZ}
	${INSTALL_PROGRAM} ${MOB}/regxpcom ${MOZ}
	if [ -f ${FILESDIR}/${MOZILLA_PROJECT}.desktop ] ; then \
		${INSTALL_DATA_DIR} ${PREFIX}/share/applications/ ; \
		${SUBST_CMD} -o ${SHAREOWN} -g ${SHAREGRP} -c ${FILESDIR}/${MOZILLA_PROJECT}.desktop \
			${PREFIX}/share/applications/${MOZILLA_PROJECT}.desktop ; \
	fi ;
.endif
@


1.63
log
@kill VMEM_WARNING
@
text
@d1 1
a1 1
# $OpenBSD: mozilla.port.mk,v 1.62 2013/11/22 12:26:06 landry Exp $
d4 6
a9 1
ONLY_FOR_ARCHS=	alpha amd64 arm i386 powerpc sparc64
@


1.62
log
@Also subst C/esr// in MOZILLA_VER, fixes firefox-esr packaging and
forgotten in previous. Originally from jasper@@, breakage reported by naddy@@
@
text
@d1 1
a1 1
# $OpenBSD: mozilla.port.mk,v 1.61 2013/10/19 16:27:37 landry Exp $
a106 1
VMEM_WARNING ?=	Yes
@


1.61
log
@Prepare for a MOZILLA_PROJECT=xulrunner for xulrunner/24
@
text
@d1 1
a1 1
# $OpenBSD: mozilla.port.mk,v 1.60 2013/09/19 13:06:44 landry Exp $
d171 2
a172 2
# needed for PLIST and config/autoconf.mk.in
MOZILLA_VER =	${MOZILLA_VERSION:C/b.$//}
@


1.60
log
@Shuffle things around in preparation for gecko 24:

- stop building ff/tb/sm with systemwide cairo, it differs too much from
  the bundled cairo and brings us too many issues (font weirdness,
crashes on i386 when links are dnd'ed, maybe system slowness when
displaying huge images, and others i dont remember..). Anyway, this is
not really "supported" upstream. To be revisited once mozilla updates to
cairo 1.12.x, if ever (#739096).
- move comment about system-jpeg, krb5 WANTLIB, and post-extract target
 about sydneyaudio sndio backend when they belong (ie in the 'old' users
case).
@
text
@d1 1
a1 1
# $OpenBSD: mozilla.port.mk,v 1.59 2013/09/19 12:20:08 landry Exp $
d38 1
d157 1
a157 1
	${MOZILLA_PROJECT} == "firefox36" || \
@


1.59
log
@Remove references to non-existent MOZILLA_PROJECT=xulrunner
(devel/xulrunner is using xulrunner19) , firefox35 and MOZILLA_BRANCH=1.9.1.
@
text
@d1 1
a1 1
# $OpenBSD: mozilla.port.mk,v 1.58 2013/08/08 06:58:31 landry Exp $
d62 2
d66 12
a87 5
# gecko doesnt link anymore with krb5 since 22 (bug 648730)
.if ${MOZILLA_PROJECT} != "firefox"
MOZMOZ_WANTLIB +=	crypto krb5 asn1 com_err heimbase roken wind
.endif

a127 6
# no --with-system-jpeg starting with fx 18, requires libjpeg-turbo because of bug 791305

# for mozilla branches 1.9.2 and 2.x.x, build against systemwide cairo
.if ${MOZILLA_BRANCH} != 1.9.1
CONFIGURE_ARGS +=--enable-system-cairo
.endif
d129 1
a129 1
# those ones only apply to mozilla branch 1.9.2 but 1.9.1 apps don't complain
a186 8

# sydneyaudio was removed in gecko 22
.if ${MOZILLA_PROJECT} != "firefox" && ${MOZILLA_PROJECT} != "seamonkey"
post-extract:
# syndeyaudio sndio file comes from ffx FILESDIR
	cp -f ${PORTSDIR}/www/mozilla-firefox/files/sydney_audio_sndio.c \
		${WRKSRC}/${_MOZDIR}/media/libsydneyaudio/src/
.endif
@


1.58
log
@Bump nspr requirement to 4.10 and nss requirement to 3.15 (only for tb/sm/fx).
@
text
@d1 1
a1 1
# $OpenBSD: mozilla.port.mk,v 1.57 2013/07/11 16:24:10 landry Exp $
a152 1
	${MOZILLA_PROJECT} == "firefox35" || \
a153 1
	${MOZILLA_PROJECT} == "xulrunner" || \
d199 1
a199 1
.if ${MOZILLA_BRANCH} == 1.9.1 || ${MOZILLA_BRANCH} == 1.9.2
d212 1
a212 2
.if (${MOZILLA_PROJECT} == "xulrunner1.9" && ${MOZILLA_BRANCH} == "1.9.2") || \
	${MOZILLA_PROJECT} == "firefox35" || \
@


1.57
log
@Seamonkey doesn't need the sydneyaudio backend anymore.
@
text
@d1 1
a1 1
# $OpenBSD: mozilla.port.mk,v 1.56 2013/06/26 19:18:48 landry Exp $
d39 2
a40 2
MODMOZ_LIB_DEPENDS +=	devel/nspr>=4.9.6 \
			security/nss>=3.14.3
@


1.57.2.1
log
@browsers have become a major security issue, so bring firefox up to date in -stable by
bumping it to 24.1.0esr and sync language packs.

ok landry@@
@
text
@d1 1
a1 1
# $OpenBSD: mozilla.port.mk,v 1.57 2013/07/11 16:24:10 landry Exp $
d170 1
a170 1
MOZILLA_VER =	${MOZILLA_VERSION:C/b.$//:C/esr$//}
@


1.56
log
@Assorted fixes for firefox update :

- doesn't link anymore with krb5 & friends
- depend on sqlite3>=23
- sydneyaudio got removed, make post-extract conditional to gecko version
@
text
@d1 1
a1 1
# $OpenBSD: mozilla.port.mk,v 1.55 2013/06/20 06:54:38 ajacoutot Exp $
d188 1
a188 1
.if ${MOZILLA_PROJECT} != "firefox"
@


1.55
log
@Unbreak after hx509 and ntlm removal from Kerberos.
@
text
@d1 1
a1 1
# $OpenBSD: mozilla.port.mk,v 1.54 2013/06/17 19:29:05 ajacoutot Exp $
d67 1
a67 1
		Xinerama Xrandr Xrender Xt atk-1.0 c cairo crypto expat \
d69 1
a69 1
		gobject-2.0 gthread-2.0 gtk-x11-2.0 krb5 m \
d72 6
a77 2
		smime3 sndio nssutil3 ssl3 stdc++ z \
		asn1 com_err heimbase roken wind
d80 1
a80 1
MODMOZ_WANTLIB +=	sqlite3>=22
d187 2
d193 1
@


1.54
log
@Unbreak Mozilla ports after the Heimdal update.
@
text
@d1 1
a1 1
# $OpenBSD: mozilla.port.mk,v 1.53 2013/05/30 14:08:05 landry Exp $
d73 1
a73 1
		asn1 com_err heimbase hx509 roken wind
@


1.53
log
@Bump dependency on nspr 4.9.6, technically only needed for firefox.
@
text
@d1 1
a1 1
# $OpenBSD: mozilla.port.mk,v 1.52 2013/04/06 14:39:58 landry Exp $
d72 2
a73 1
		smime3 sndio nssutil3 ssl3 stdc++ z
@


1.52
log
@Ensure FX/SM/TB depend on nss 3.14.3/nspr 4.9.5/sqlite 3.7.15.2.
Adjust WANTLIB while here.
@
text
@d1 1
a1 1
# $OpenBSD: mozilla.port.mk,v 1.51 2013/02/09 14:49:53 sthen Exp $
d39 1
a39 1
MODMOZ_LIB_DEPENDS +=	devel/nspr>=4.9.5 \
@


1.51
log
@Don't use ${FLAVOR:L}, we only support lower-case flavours now.
OK ajacoutot@@ espie@@
@
text
@d1 1
a1 1
# $OpenBSD: mozilla.port.mk,v 1.50 2013/01/11 22:51:44 landry Exp $
d39 2
a40 2
MODMOZ_LIB_DEPENDS +=	devel/nspr>=4.9.4 \
			security/nss>=3.14.1p0
d71 2
a72 3
		pixman-1 plc4 plds4 png pthread pthread-stubs \
		smime3 sndio nssutil3 ssl3 stdc++ xcb \
		xcb-render GL xcb-shm z
d75 1
a75 1
MODMOZ_WANTLIB +=	sqlite3>=21
@


1.50
log
@Ensure fx/sm/tb depend on nspr 4.9.4 / nss 3.14.1p0
(not technically needed for tb, but oh well..)
@
text
@d1 1
a1 1
# $OpenBSD: mozilla.port.mk,v 1.49 2012/12/04 21:05:29 landry Exp $
d137 1
a137 1
.if ${FLAVOR:L:Mdebug}
@


1.49
log
@Winter cleanup of the mozillas :

- Add gtar to BUILD_DEPENDS everywhere in moz.port.mk, since fx 18 will
  start using gtar-only options. Ditto for unzip, used during install.
- special-case the deps for firefox/thunderbird/seamonkey, since those
  are maintained on the long-term. Only those need to depend on the
latest and greatest nss/nspr.
- move the '--relax LDFLAGS for ppc' to moz.port.mk
- move the 'yasm BUILD_DEPENDS for i385/amd64' to moz.port.mk
- move more common CONFIGURE_ARGS to moz.port.mk (libevent,gio,bz2,gconf..)
- fix MODMOZ_WANTLIB wrt nss/nspr majors
- ensure we depend on sqlite3>=21, needed for fx/tb 18
- use --with-system-jpeg only in firefox36/sunbird/fennec/xulrunner,
  fx/tb 18 will have to use its bundled libjpeg-turbo (#791305)
- bump REVISIONs for the WANTLIB/LIB_DEPENDS change.
@
text
@d1 1
a1 1
# $OpenBSD: mozilla.port.mk,v 1.48 2012/11/12 20:45:32 landry Exp $
d39 2
a40 2
MODMOZ_LIB_DEPENDS +=	devel/nspr>=4.9.3 \
			security/nss>=3.14
@


1.48
log
@Bump all ports depending on nspr to account for the devel/nspr,-main ->
devel/nspr pkgpath change. While here, make sure mozilla ports depend on
the latest and greatest via mozilla.port.mk.
Tested in a bulk build..
@
text
@d1 1
a1 1
# $OpenBSD: mozilla.port.mk,v 1.47 2012/10/24 19:28:43 landry Exp $
d30 1
d33 7
a39 2
MODMOZ_LIB_DEPENDS =	x11/gtk+2 \
			devel/nspr>=4.9.3 \
d41 5
d47 20
a66 1
MODMOZ_WANTLIB =	X11 Xcomposite Xcursor Xdamage Xext Xfixes Xi \
d69 4
a72 4
		gobject-2.0 gthread-2.0 gtk-x11-2.0 jpeg krb5 m \
		nspr4>=21 nss3>=25 pango-1.0 pangocairo-1.0 pangoft2-1.0 \
		pixman-1 plc4>=21 plds4>=21 png pthread pthread-stubs \
		smime3>=25 sndio softokn3>=25 ssl3>=25 stdc++ xcb \
d76 1
a76 1
MODMOZ_WANTLIB +=	sqlite3
d80 5
a84 1
# avoids OOM when linking libxul
d86 1
d97 1
a97 2
CONFIGURE_ARGS +=--with-system-jpeg=${LOCALBASE}	\
		--with-system-zlib=/usr		\
d114 2
@


1.47
log
@Add DPB_PROPERTIES=parallel so that all mozilla ports build zomgfaster
with dpb.
reminded by naddy@@, thanks!
@
text
@d1 1
a1 1
# $OpenBSD: mozilla.port.mk,v 1.46 2012/10/20 11:17:56 landry Exp $
d33 2
a34 2
			devel/nspr>=4.9.2 \
			security/nss>=3.13.6
@


1.46
log
@--with-system-zlib takes /usr, not /usr/lib. No binary change, and
allows to remove some dupe configure args at next update.
@
text
@d1 1
a1 1
# $OpenBSD: mozilla.port.mk,v 1.45 2012/09/22 10:30:17 landry Exp $
d5 2
@


1.45
log
@Remove useless dependency on deprecated pangox.

- remove useless patch to gfx/thebes/Makefile.in adding -lpangox-1.0 to
EXTRA_DSO_LDOPTS, this was maybe useful before ffx 3.0, but mozilla
stopped using pangox between 2.0 and 3.0. See for the last traces of
pangox.h use : https://bugzilla.mozilla.org/show_bug.cgi?id=528941. See
also bugs #323671/#338446
- backport the patch from #528941 to remove useless pangox.h inclusion
from www/firefox35.
- remove the RUN_DEPENDS on pangox-compat
- bump all corresponding REVISIONS
- while here, make sure all moz ports depend on latest nspr 4.9.2 since
  it'll be a requirement for upcoming gecko 16 releases
@
text
@d1 1
a1 1
# $OpenBSD: mozilla.port.mk,v 1.44 2012/09/01 17:48:19 landry Exp $
d61 1
a61 1
		--with-system-zlib=/usr/lib	\
@


1.44
log
@Forgot to commit in previous.. remove the bits overwriting the original
nsSound.cpp with our own, now removed.
noticed by naddy@@
@
text
@d1 1
a1 1
# $OpenBSD: mozilla.port.mk,v 1.43 2012/06/11 15:26:14 landry Exp $
d31 2
a32 2
			devel/nspr>=4.9 \
			security/nss>=3.12.13
@


1.43
log
@Fix WANTLIB (remove gmodule-2.0) and bump depending ports (others will
be updated in a sec)
@
text
@d1 1
a1 1
# $OpenBSD: mozilla.port.mk,v 1.42 2012/04/30 15:14:55 landry Exp $
a145 8
# XXX nsSound.cpp different between mozilla branch - need to use local one
.if ${MOZILLA_PROJECT} == "firefox" || \
	 ${MOZILLA_PROJECT} == "thunderbird" || \
	${MOZILLA_PROJECT} == "seamonkey"
	cp -f ${FILESDIR}/nsSound.cpp ${WRKSRC}/${_MOZDIR}/widget/gtk2/
.else
	cp -f ${FILESDIR}/nsSound.cpp ${WRKSRC}/${_MOZDIR}/widget/src/gtk2/
.endif
@


1.42
log
@widget/src/gtk2 moved to widget/gtk2 in gecko 12. Copy nsSound.cpp in
the correct place depending on MOZILLA_PROJECT.
@
text
@d1 1
a1 1
# $OpenBSD: mozilla.port.mk,v 1.41 2012/04/23 17:15:19 espie Exp $
d37 1
a37 1
		gmodule-2.0 gobject-2.0 gthread-2.0 gtk-x11-2.0 jpeg krb5 m \
@


1.41
log
@first pass at handling sqlite3 move
@
text
@d1 1
a1 1
# $OpenBSD: mozilla.port.mk,v 1.40 2012/03/16 21:27:09 landry Exp $
d147 5
d153 1
@


1.40
log
@Bump dependencies to nspr 4.9 & nss 3.12.13, reqd' for mozilla 11.
@
text
@d1 1
a1 1
# $OpenBSD: mozilla.port.mk,v 1.39 2012/02/20 20:09:02 landry Exp $
a44 1
MODMOZ_LIB_DEPENDS +=	databases/sqlite3>=3.7.7.1
@


1.39
log
@Assorted changes for mozilla 10 updates :
- S/b/beta/ in MOZILLA_VERSION for simpler PKGNAME by default
- only add js/src/xpconnect/shell/Makefile.in to MOZILLA_SUBST_FILES if
  branch is 1.9.1/1.9.2, file disappeared in 10
- add LDFLAGS="-Wl,--no-keep-memory" to CONFIGURE_ENV to prevent libxul
  linking from failing on low memory archs.
@
text
@d1 1
a1 1
# $OpenBSD: mozilla.port.mk,v 1.38 2012/01/10 23:58:27 nigel Exp $
d31 2
a32 2
			devel/nspr>=4.8.9p0 \
			security/nss>=3.12.11p0
@


1.38
log
@Update firefox to 3.6.25 and xulrunner to 1.9.2.25

Ok landry@@ stsp@@
@
text
@d1 1
a1 1
# $OpenBSD: mozilla.port.mk,v 1.37 2011/10/03 21:04:57 landry Exp $
d10 1
a10 1
PKGNAME ?=	${MOZILLA_PROJECT}-${MOZILLA_VERSION}
d49 3
a156 1
			${_MOZDIR}/js/src/xpconnect/shell/Makefile.in \
d158 4
@


1.37
log
@Ensure mozilla ports depend on nspr 4.8.9p0 with the PR_LoadLibrary()
fix so that i can safely remove all the corresponding patches.
@
text
@d1 1
a1 1
# $OpenBSD: mozilla.port.mk,v 1.36 2011/09/06 19:40:24 landry Exp $
d20 1
d45 1
a45 1
MODMOZ_LIB_DEPENDS +=	databases/sqlite3>=3.7.5
d126 2
a127 1
SUBST_VARS +=	MOZILLA_PROJECT MOZILLA_VERSION
@


1.36
log
@Ensure mozilla ports depend on nss 3.12.11p0.
@
text
@d1 1
a1 1
# $OpenBSD: mozilla.port.mk,v 1.35 2011/08/24 06:16:48 landry Exp $
d30 1
a30 1
			devel/nspr>=4.8.9 \
@


1.35
log
@Various cleanups :
- garbage collect _MOZ_PROJECT_SHORT, it's useless since the
  mozilla-{firefox,thunderbird} rename to {firefox,thunderbird}
- introduce MOZILLA_DIST & MOZILLA_DIST_VERSION (defaulting to
  MOZILLA_PROJECT/MOZILLA_VERSION) to properly set
  DISTNAME/MASTER_SITES/HOMEPAGE for ports like firefox{35,36},
xulrunner and sunbird.
@
text
@d1 1
a1 1
# $OpenBSD: mozilla.port.mk,v 1.34 2011/08/23 20:09:54 landry Exp $
d31 1
a31 1
			security/nss>=3.12.11
@


1.34
log
@Tighten dependencies on nspr 4.8.9 & nss 3.12.11, and fix MODMOZ_WANTLIB
while here.
@
text
@d1 1
a1 1
# $OpenBSD: mozilla.port.mk,v 1.33 2011/08/23 08:38:13 landry Exp $
d14 2
a15 1
_MOZ_PROJECT_SHORT =	${MOZILLA_PROJECT:S/mozilla-//}
d17 1
a17 1
HOMEPAGE ?=	http://www.mozilla.org/projects/${_MOZ_PROJECT_SHORT}
d19 3
a21 3
MASTER_SITES ?=	http://releases.mozilla.org/pub/mozilla.org/${_MOZ_PROJECT_SHORT}/releases/${MOZILLA_VERSION}/source/ \
		ftp://ftp.mozilla.org/pub/mozilla.org/${_MOZ_PROJECT_SHORT}/releases/${MOZILLA_VERSION}/source/
DISTNAME ?=	${_MOZ_PROJECT_SHORT}-${MOZILLA_VERSION}.source
d176 1
a176 1
	${INSTALL_SCRIPT} ${MOB}/${_MOZ_PROJECT_SHORT} ${PREFIX}/bin
d178 1
a178 1
	${INSTALL_PROGRAM} ${MOB}/${_MOZ_PROJECT_SHORT}-bin ${MOB}/mozilla-xremote-client ${MOZ}
d180 1
a180 1
	if [ -f ${FILESDIR}/${_MOZ_PROJECT_SHORT}.desktop ] ; then \
d182 2
a183 2
		${SUBST_CMD} -o ${SHAREOWN} -g ${SHAREGRP} -c ${FILESDIR}/${_MOZ_PROJECT_SHORT}.desktop \
			${PREFIX}/share/applications/${_MOZ_PROJECT_SHORT}.desktop ; \
@


1.33
log
@Add ftp://ftp.mozilla.org as backup MASTER_SITES to still be able to
fetch 'old' releases phased out of mirrors. Prodded by espie@@.
@
text
@d1 1
a1 1
# $OpenBSD: mozilla.port.mk,v 1.32 2011/07/24 07:48:20 landry Exp $
d29 2
a30 2
			devel/nspr>=4.8.7 \
			security/nss>=3.12.9
d32 1
a32 1
MODMOZ_WANTLIB =	X11 Xau Xcomposite Xcursor Xdamage Xdmcp Xext Xfixes Xi \
d39 1
a39 1
		xcb-render GL Xxf86vm drm xcb-shm z
@


1.32
log
@Thunderbird and Seamonkey now use the provided install target, update
list of ports using our homemade install target.
@
text
@d1 1
a1 1
# $OpenBSD: mozilla.port.mk,v 1.31 2011/07/08 11:07:32 landry Exp $
d18 2
a19 1
MASTER_SITES ?=	http://releases.mozilla.org/pub/mozilla.org/${_MOZ_PROJECT_SHORT}/releases/${MOZILLA_VERSION}/source/
@


1.32.2.1
log
@add backup MASTER_SITES entry (releases.mozilla.org no longer has 5.0 as
discovered by James Hozier)
@
text
@d1 1
a1 1
# $OpenBSD: mozilla.port.mk,v 1.32 2011/07/24 07:48:20 landry Exp $
d18 1
a18 2
MASTER_SITES ?=	http://releases.mozilla.org/pub/mozilla.org/${_MOZ_PROJECT_SHORT}/releases/${MOZILLA_VERSION}/source/ \
		ftp://ftp.mozilla.org/pub/mozilla.org/${_MOZ_PROJECT_SHORT}/releases/${MOZILLA_VERSION}/source/
@


1.31
log
@Rename mozilla-{firefox,thunderbird} packages to {firefox,thunderbird}.
Apparently required by many at c2k11.
@
text
@d1 1
a1 1
# $OpenBSD: mozilla.port.mk,v 1.30 2011/06/07 10:05:07 landry Exp $
d162 1
a162 3
.if (${MOZILLA_PROJECT} == "thunderbird" && ${MOZILLA_BRANCH} == "1.9.2") || \
	(${MOZILLA_PROJECT} == "seamonkey" && ${MOZILLA_BRANCH} == "1.9.1") || \
	(${MOZILLA_PROJECT} == "xulrunner1.9" && ${MOZILLA_BRANCH} == "1.9.2") || \
@


1.30
log
@Doh!
@
text
@d1 1
a1 1
# $OpenBSD: mozilla.port.mk,v 1.29 2011/06/06 14:07:22 landry Exp $
d105 1
a105 1
.if ${MOZILLA_PROJECT} == "mozilla-firefox" || \
d162 1
a162 1
.if (${MOZILLA_PROJECT} == "mozilla-thunderbird" && ${MOZILLA_BRANCH} == "1.9.2") || \
@


1.29
log
@Doh.
@
text
@d1 1
a1 1
# $OpenBSD: mozilla.port.mk,v 1.28 2011/06/06 09:32:55 landry Exp $
d164 1
a164 1
	(${MOZILLA_PROJECT} == "xulrunner" && ${MOZILLA_BRANCH} == "1.9.2") || \
@


1.28
log
@Explicitely list all the ports/versions (ie all ports from branches
1.9.x) using the old handrolled do-install target, which is hopefully
going to die soon. By default, the betas/wip ports now use the regular
make install target provided by mozilla.
@
text
@d1 1
a1 1
# $OpenBSD: mozilla.port.mk,v 1.27 2011/05/04 08:11:15 dcoppa Exp $
d162 1
a162 1
.if (${MOZILLA_PROJECT} == "mozilla-thunderbird" && ${MOZILLA_BRANCH} != "1.9.2") || \
@


1.27
log
@Build firefox4 and fennec against systemwide cairo.

OK landry@@
@
text
@d1 1
a1 1
# $OpenBSD: mozilla.port.mk,v 1.26 2011/04/28 20:44:47 landry Exp $
d162 6
a167 1
.if ${MOZILLA_BRANCH:C/\..*//} != "2" && ${MOZILLA_BRANCH} != "central"
@


1.26
log
@Let's use a common DIST_SUBDIR for all mozilla ports so that it's easier
to clean the gigabytes of src tarballs previously piling up in distfiles/.
Update distinfo accordingly.
Looks sane to jasper@@.
@
text
@d1 1
a1 1
# $OpenBSD: mozilla.port.mk,v 1.25 2011/04/01 08:32:32 landry Exp $
d74 2
a75 2
# for mozilla branch 1.9.2, build against systemwide cairo
.if ${MOZILLA_BRANCH} == 1.9.2
@


1.25
log
@add fennec to the list of MOZILLA_PROJECTs
@
text
@d1 1
a1 1
# $OpenBSD: mozilla.port.mk,v 1.24 2011/03/27 20:23:25 landry Exp $
d21 1
@


1.24
log
@Add firefox36 to the WRKDIST switch, reminded by miod@@.
While here, don't unconditionally define WRKDIST so that client port can
override it. Needed by spidermonkey 2.0.
@
text
@d1 1
a1 1
# $OpenBSD: mozilla.port.mk,v 1.23 2011/03/22 13:18:26 landry Exp $
d108 1
@


1.23
log
@Remove the .if for system sqlite, now every port using mozilla MODULE
uses it. Bump dependency to 3.7.5 to ensure it has unlock_notify for
ffx4, and bump all corresponding REVISIONs.
@
text
@d1 1
a1 1
# $OpenBSD: mozilla.port.mk,v 1.22 2011/03/10 16:45:42 landry Exp $
d106 1
d109 1
a109 1
WRKDIST =	${WRKDIR}/mozilla-${MOZILLA_BRANCH}
d111 1
a111 1
WRKDIST =	${WRKDIR}/comm-${MOZILLA_BRANCH}
@


1.22
log
@Assorted tweaks in preparation for firefox 4:
* do some plumbing to allow one to build from {mozilla,comm}-central
 tarballs (aka alphas/betas)
* specialcase branch=~2.0 & branch=central for do-install: target and
 sqlite dependency (the latter will be removed when we enable
 UNLOCK_NOTIFY in systemwide sqlite)
* add --enable-profiling & --enable-debug-symbols to debug FLAVOR
* add a comment about why the builtin crashreporter is still disabled
 (basically, google breakpad need to be ported to *BSD)
* add MOZILLA_VERSION to SUBST_VARS
@
text
@d1 1
a1 1
# $OpenBSD: mozilla.port.mk,v 1.21 2011/03/10 14:34:17 dcoppa Exp $
d39 1
a39 2
# for all mozilla ports but ffx4, build against systemwide sqlite3
.if ${MOZILLA_BRANCH:C/\..*//} != "2" && ${MOZILLA_BRANCH} != "central"
d41 1
a41 1
MODMOZ_LIB_DEPENDS +=	databases/sqlite3>=3.7.4
a43 1
.endif
@


1.21
log
@Adopt a patch that fixes a bug causing animated gifs to flicker
when using cairo 1.10.x and make mozilla-firefox and mozilla-thunderbird
build against systemwide cairo as it was with cairo 1.8.x.
Patch backported from FF4 branch by Rafal Muzylo <galtgendo@@o2.pl>

https://bugzilla.mozilla.org/show_bug.cgi?id=597174
http://sources.gentoo.org/cgi-bin/viewvc.cgi/gentoo-x86/net-libs/xulrunner/files/fix-animated-gifs.patch

OK landry@@
@
text
@d1 1
a1 1
# $OpenBSD: mozilla.port.mk,v 1.20 2011/01/18 12:31:24 landry Exp $
d40 1
a40 1
.if ${MOZILLA_BRANCH:C/\..*//} != "2"
d81 1
d97 2
d106 1
a106 4
.if ${MOZILLA_VERSION:C/\..*//} == "4" || \
	${MOZILLA_PROJECT} == "xulrunner2.0"
WRKDIST =	${WRKDIR}/mozilla-central
.elif ${MOZILLA_PROJECT} == "mozilla-firefox" || \
d108 1
d122 1
a122 1
SUBST_VARS +=	MOZILLA_PROJECT
d161 1
a161 1
.if ${MOZILLA_BRANCH:C/\..*//} != "2"
@


1.20
log
@Tighten LIB_DEPENDS on very latest nss 3.12.9/nspr 4.8.7.
Remove @@ silencing files/ copies.
ok naddy@@
@
text
@d1 1
a1 1
# $OpenBSD: mozilla.port.mk,v 1.19 2011/01/14 22:52:37 landry Exp $
d74 5
@


1.19
log
@Actually depend on sqlite 3.7.4 which is the version where PRAGMA
secure_delete was added, and where FTS3 is enabled for mozilla-firefox.
@
text
@d1 1
a1 1
# $OpenBSD: mozilla.port.mk,v 1.18 2011/01/14 22:46:29 landry Exp $
d27 2
a28 2
			devel/nspr>=4.8.6 \
			security/nss>=3.12.8
d134 1
a134 1
	@@cp -f ${FILESDIR}/nsSound.cpp ${WRKSRC}/${_MOZDIR}/widget/src/gtk2/
d136 1
a136 1
	@@cp -f ${PORTSDIR}/www/mozilla-firefox/files/sydney_audio_sndio.c \
@


1.18
log
@For all mozilla ports (but ffx4), build against system sqlite.
Trick configure into believing our sqlite has secure_delete enabled by
default.
@
text
@d1 1
a1 1
# $OpenBSD: mozilla.port.mk,v 1.17 2010/12/01 15:00:12 dcoppa Exp $
d42 1
a42 1
MODMOZ_LIB_DEPENDS +=	databases/sqlite3
@


1.17
log
@Fix Kerberos/GSSAPI authentication within mozilla ports.
OpenBSD does not have gssapi_krb5. So, to avoid undefined symbol
errors, link libxul with "-lkrb5 -lcrypto".

OK phessler@@, landry@@ (MAINTAINER)
@
text
@d1 1
a1 1
# $OpenBSD: mozilla.port.mk,v 1.16 2010/11/22 08:36:49 espie Exp $
d38 8
@


1.16
log
@new depends
@
text
@d1 1
a1 1
# $OpenBSD: mozilla.port.mk,v 1.15 2010/11/11 09:30:36 jasper Exp $
d31 3
a33 3
		Xinerama Xrandr Xrender Xt atk-1.0 c cairo expat fontconfig \
		freetype gdk-x11-2.0 gdk_pixbuf-2.0 gio-2.0 glib-2.0 \
		gmodule-2.0 gobject-2.0 gthread-2.0 gtk-x11-2.0 jpeg m \
@


1.15
log
@- switch to pkg-readmes

ok landry@@ (MAINTAINER)
@
text
@d1 1
a1 1
# $OpenBSD: mozilla.port.mk,v 1.14 2010/10/27 16:58:30 landry Exp $
d22 7
a28 7
MODMOZ_RUN_DEPENDS =	:desktop-file-utils-*:devel/desktop-file-utils
MODMOZ_BUILD_DEPENDS =	:libIDL-*:devel/libIDL \
			:zip->=2.3:archivers/zip

MODMOZ_LIB_DEPENDS =	::x11/gtk+2 \
			:nspr->=4.8.6:devel/nspr \
			:nss->=3.12.8:security/nss
d34 3
a36 3
		nspr4.>=21 nss3.>=25 pango-1.0 pangocairo-1.0 pangoft2-1.0 \
		pixman-1 plc4.>=21 plds4.>=21 png pthread pthread-stubs \
		smime3.>=25 sndio softokn3.>=25 ssl3.>=25 stdc++ xcb \
@


1.14
log
@Unset INSTALL_STRIP when debug FLAVOR is set. Permits to build a
debuggable version of xulrunner package.
@
text
@d1 1
a1 1
# $OpenBSD: mozilla.port.mk,v 1.13 2010/10/26 17:36:02 landry Exp $
a159 4
	if [ -f ${FILESDIR}/README.OpenBSD ]; then \
		${SUBST_CMD} -o ${SHAREOWN} -g ${SHAREGRP} -c ${FILESDIR}/README.OpenBSD \
			${MOZ}/README.OpenBSD ; \
	fi ;
@


1.13
log
@Add a debug FLAVOR for all mozilla ports. Guess what, pretty useful for
debugging purposes...
@
text
@d1 1
a1 1
# $OpenBSD: mozilla.port.mk,v 1.12 2010/10/25 10:48:00 landry Exp $
d83 2
a84 1
 			--disable-install-strip
@


1.12
log
@Don't define do-install target when MOZILLA_BRANCH=2.x
Looks we'll be able to use the regular make install target provided by
upstream instead of rolling our ugly own and missing files...
@
text
@d1 1
a1 1
# $OpenBSD: mozilla.port.mk,v 1.11 2010/10/24 17:56:11 landry Exp $
a53 1
		--disable-debug			\
d77 8
@


1.11
log
@Add infrastructure to also support xulrunner1.9, and prepare for
xulrunner2.0 betas too.
While here, don't inconditionally set MAKE_ENV/CONFIGURE_ENV but append to
it, so that using ports can add stuff to it.
@
text
@d1 1
a1 1
# $OpenBSD: mozilla.port.mk,v 1.10 2010/10/22 19:17:01 landry Exp $
d139 1
a150 1
.if ${MOZILLA_VERSION:C/\..*//} != "4" && ${MOZILLA_PROJECT} != "xulrunner2.0"
a151 1
.endif
d161 1
@


1.10
log
@Depend on nss 3.12.8. While here, let's just face reality and take
maintainership for the gang..
@
text
@d1 1
a1 1
# $OpenBSD: mozilla.port.mk,v 1.9 2010/10/18 07:15:56 landry Exp $
d82 2
a83 1
.if ${MOZILLA_VERSION:C/\..*//} == "4"
d86 2
a87 1
	${MOZILLA_PROJECT} == "firefox35"
d102 1
a102 1
MAKE_ENV =	MOZ_CO_PROJECT=${MOZILLA_CODENAME} \
d108 1
a108 1
CONFIGURE_ENV =	${MAKE_ENV} \
d150 1
a150 1
.if ${MOZILLA_VERSION:C/\..*//} != "4"
@


1.9
log
@Fix WANTLIB again after cairo's last commit where X11-xcb went away.
Bump REVISIONs.
@
text
@d1 1
a1 1
# $OpenBSD: mozilla.port.mk,v 1.8 2010/10/15 07:16:19 landry Exp $
d12 2
d28 1
a28 1
			:nss->=3.12.6:security/nss
@


1.8
log
@Switch all mozilla-based ports to using the bundled cairo, mozilla doesn't
like the systemwide cairo since 1.10.x update (crashes,gifs not displaying
properly), and there's few hope it will be fixed in 1.9.2.x branch.
Fix WANTLIB while here and bump REVISIONs.
Reported by dcoppa@@, also found in upstream bz #597174 and various linux
vendors bugzillas (red hat #628331, mdv #60738, gentoo #337813).
devel/xulrunner will follow in a few..
@
text
@d1 1
a1 1
# $OpenBSD: mozilla.port.mk,v 1.7 2010/10/11 08:19:04 jasper Exp $
d35 1
a35 1
		xcb-render GL X11-xcb Xxf86vm drm xcb-shm z
@


1.7
log
@- fix WANTLIB after cairo update.

(please note chromium is still broken, but will be dealt with soon)
@
text
@d1 1
a1 1
# $OpenBSD: mozilla.port.mk,v 1.6 2010/09/19 19:18:35 landry Exp $
d35 1
a35 1
		xcb-render xcb-render-util z
a63 1
		--enable-system-cairo		\
@


1.6
log
@Change dependency to ensure nspr 4.8.6 is required. Fixes "error:
'PR_STATIC_ASSERT' was not declared in this scope" failures.
@
text
@d1 1
a1 1
# $OpenBSD: mozilla.port.mk,v 1.5 2010/09/04 09:31:19 landry Exp $
d30 1
a30 1
		freetype gdk-x11-2.0 gdk_pixbuf-2.0 gio-2.0 glib-2.0 glitz \
@


1.5
log
@Wip on firefox 4 betas.. only install regxpcom if MOZILLA_VERSION !~ 4,
and set WRKDIST = ${WRKDIR}/mozilla-central if MOZILLA_VERSION =~ 4.
Builds in my tree, doesn't run yet... not ready for the masses!
@
text
@d1 1
a1 1
# $OpenBSD: mozilla.port.mk,v 1.4 2010/07/31 09:14:48 landry Exp $
d25 1
a25 1
			:nspr->=4.8:devel/nspr \
@


1.4
log
@Fix setting WRKDIST, needed for an upcoming conversion of www/firefox35
to mozilla MODULE.
@
text
@d1 1
a1 1
# $OpenBSD: mozilla.port.mk,v 1.3 2010/07/27 14:20:15 landry Exp $
d81 3
a83 1
.if ${MOZILLA_PROJECT} == "mozilla-firefox" || \
d146 4
a149 2
	${INSTALL_PROGRAM} ${MOB}/${_MOZ_PROJECT_SHORT}-bin ${MOB}/mozilla-xremote-client \
		${MOB}/regxpcom ${MOZ}
@


1.3
log
@Only run ${SUBST_CMD} on ${FILESDIR}/README.OpenBSD / $app.desktop if
the corresponding file exists. Needed for later sunbird/xulrunner
conversions to mozilla.port.mk.
ok sthen@@
@
text
@d1 1
a1 1
# $OpenBSD: mozilla.port.mk,v 1.2 2010/07/09 15:08:39 landry Exp $
d81 2
a82 1
.if ${MOZILLA_PROJECT} == "mozilla-firefox"
@


1.2
log
@Switch to newer LIB_DEPENDS/WANTLIB semantics.
@
text
@d1 1
a1 1
# $OpenBSD: mozilla.port.mk,v 1.1 2010/07/08 21:06:13 landry Exp $
d145 9
a153 5
	${SUBST_CMD} -o ${SHAREOWN} -g ${SHAREGRP} -c ${FILESDIR}/README.OpenBSD \
		${MOZ}/README.OpenBSD
	${INSTALL_DATA_DIR} ${PREFIX}/share/applications/
	${SUBST_CMD} -o ${SHAREOWN} -g ${SHAREGRP} -c ${FILESDIR}/${_MOZ_PROJECT_SHORT}.desktop \
		${PREFIX}/share/applications/${_MOZ_PROJECT_SHORT}.desktop
@


1.1
log
@Resurrect www/mozilla dir to host a mozilla.port.mk MODULE, that will
help clean up the crazy maze in mozilla ports Makefiles.
ok ajacoutot@@ jasper@@ naddy@@
@
text
@d1 1
a1 1
# $OpenBSD$
d24 3
a26 3
MODMOZ_LIB_DEPENDS =	gdk-x11-2.0,gdk_pixbuf-2.0,gtk-x11-2.0::x11/gtk+2 \
			nspr4.>=21,plc4.>=21,plds4.>=21:nspr->=4.8:devel/nspr \
			nss3.>=25,smime3.>=25,softokn3.>=25,ssl3.>=25:nss->=3.12.6:security/nss
d30 5
a34 3
		freetype gio-2.0 glib-2.0 glitz gmodule-2.0 gobject-2.0 \
		gthread-2.0 jpeg m pango-1.0 pangocairo-1.0 pangoft2-1.0 \
		pixman-1 png pthread pthread-stubs sndio stdc++ xcb \
@

