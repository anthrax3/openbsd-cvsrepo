head	1.1;
access;
symbols
	OPENBSD_4_1:1.1.0.2;
locks; strict;
comment	@# @;


1.1
date	2007.09.15.09.05.19;	author ajacoutot;	state dead;
branches
	1.1.2.1;
next	;

1.1.2.1
date	2007.09.15.09.05.19;	author ajacoutot;	state Exp;
branches;
next	;


desc
@@


1.1
log
@file patch-includes_api_ApiFormatBase_php was initially added on branch OPENBSD_4_1.
@
text
@@


1.1.2.1
log
@- backport 2 patches from mediawiki 1.9.4
fixes SA26772

ok sturm@@
@
text
@a0 17
$OpenBSD$
--- includes/api/ApiFormatBase.php.orig	Wed Jan 24 09:32:49 2007
+++ includes/api/ApiFormatBase.php	Fri Sep 14 20:46:56 2007
@@@@ -143,8 +143,11 @@@@ for more information.
 	* This method also replaces any '<' with &lt;
 	*/
 	protected function formatHTML($text) {
-		// encode all tags as safe blue strings
-		$text = ereg_replace('\<([^>]+)\>', '<span style="color:blue;">&lt;\1&gt;</span>', $text);
+		// Escape everything first for full coverage
+		$text = htmlspecialchars($text);
+		
+		// encode all comments or tags as safe blue strings
+		$text = preg_replace('/\&lt;(!--.*?--|.*?)\&gt;/', '<span style="color:blue;">&lt;\1&gt;</span>', $text);
 		// identify URLs
 		$protos = "http|https|ftp|gopher";
 		$text = ereg_replace("($protos)://[^ '\"()<\n]+", '<a href="\\0">\\0</a>', $text);
@

