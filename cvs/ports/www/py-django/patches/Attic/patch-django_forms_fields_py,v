head	1.1;
access;
symbols
	OPENBSD_4_6:1.1.0.2;
locks; strict;
comment	@# @;


1.1
date	2010.01.06.01.30.23;	author william;	state dead;
branches
	1.1.2.1;
next	;

1.1.2.1
date	2010.01.06.01.30.23;	author william;	state Exp;
branches;
next	;


desc
@@


1.1
log
@file patch-django_forms_fields_py was initially added on branch OPENBSD_4_6.
@
text
@@


1.1.2.1
log
@SECURITY FIX

Resolves a denial of service:

http://www.djangoproject.com/weblog/2009/oct/09/security/

Changeset 11605, for 1.0.X, fixing bug #9948 in the process

ok jasper@@ and Ryan Boggs (MAINTAINER)
@
text
@a0 28
$OpenBSD$

SECURITY FIX

Certain email addresses/URLs could cause a catastrophic backtracking
situation (denial of service).


--- django/forms/fields.py.orig	Wed Nov 19 00:44:20 2008
+++ django/forms/fields.py	Thu Dec 31 20:59:05 2009
@@@@ -421,7 +421,7 @@@@ class RegexField(CharField):
 email_re = re.compile(
     r"(^[-!#$%&'*+/=?^_`{}|~0-9A-Z]+(\.[-!#$%&'*+/=?^_`{}|~0-9A-Z]+)*"  # dot-atom
     r'|^"([\001-\010\013\014\016-\037!#-\[\]-\177]|\\[\001-011\013\014\016-\177])*"' # quoted-string
-    r')@@(?:[A-Z0-9-]+\.)+[A-Z]{2,6}$', re.IGNORECASE)  # domain
+    r')@@(?:[A-Z0-9](?:[A-Z0-9-]{0,61}[A-Z0-9])?\.)+[A-Z]{2,6}\.?$', re.IGNORECASE)  # domain
 
 class EmailField(RegexField):
     default_error_messages = {
@@@@ -527,7 +527,7 @@@@ class ImageField(FileField):
 
 url_re = re.compile(
     r'^https?://' # http:// or https://
-    r'(?:(?:[A-Z0-9-]+\.)+[A-Z]{2,6}|' #domain...
+    r'(?:(?:[A-Z0-9](?:[A-Z0-9-]{0,61}[A-Z0-9])?\.)+[A-Z]{2,6}\.?|' #domain...
     r'localhost|' #localhost...
     r'\d{1,3}\.\d{1,3}\.\d{1,3}\.\d{1,3})' # ...or ip
     r'(?::\d+)?' # optional port
@

