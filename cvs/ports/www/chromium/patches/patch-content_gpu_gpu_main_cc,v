head	1.20;
access;
symbols
	OPENBSD_6_1:1.19.0.2
	OPENBSD_6_1_BASE:1.19
	OPENBSD_6_0:1.14.0.2
	OPENBSD_6_0_BASE:1.14
	OPENBSD_5_9:1.11.0.2
	OPENBSD_5_9_BASE:1.11
	OPENBSD_5_8:1.6.0.4
	OPENBSD_5_8_BASE:1.6
	OPENBSD_5_7:1.2.0.2
	OPENBSD_5_7_BASE:1.2;
locks; strict;
comment	@# @;


1.20
date	2017.04.28.14.21.00;	author robert;	state Exp;
branches;
next	1.19;
commitid	XFDnyB7tGNawHUbl;

1.19
date	2017.03.14.12.18.54;	author robert;	state Exp;
branches;
next	1.18;
commitid	FgEdsLreTqAdn1i5;

1.18
date	2016.12.10.15.35.25;	author robert;	state Exp;
branches;
next	1.17;
commitid	D24Pj03ujnweitOe;

1.17
date	2016.10.26.06.22.08;	author robert;	state Exp;
branches;
next	1.16;
commitid	Dt81be1Osjz00Uwx;

1.16
date	2016.09.01.16.28.11;	author robert;	state Exp;
branches;
next	1.15;
commitid	0duujWXlyOCBrehm;

1.15
date	2016.07.31.13.11.44;	author robert;	state Exp;
branches;
next	1.14;
commitid	dRegVegviFQGKQZc;

1.14
date	2016.05.27.06.28.21;	author robert;	state Exp;
branches;
next	1.13;
commitid	cpiCcJ3vjht5tEkH;

1.13
date	2016.04.16.19.08.46;	author robert;	state Exp;
branches;
next	1.12;
commitid	SE10dvx9aTcZrjRO;

1.12
date	2016.03.06.10.51.14;	author robert;	state Exp;
branches;
next	1.11;
commitid	Upms3IeOsaLsGxbP;

1.11
date	2016.01.23.18.49.31;	author robert;	state Exp;
branches;
next	1.10;
commitid	KVrkvcBYFue8N3VB;

1.10
date	2016.01.06.21.46.44;	author robert;	state Exp;
branches;
next	1.9;
commitid	QCpbcWCjgKtMUGZ9;

1.9
date	2015.12.05.16.13.32;	author robert;	state Exp;
branches;
next	1.8;
commitid	D0GFSwUDbKAnIs1m;

1.8
date	2015.10.14.16.42.07;	author robert;	state Exp;
branches;
next	1.7;
commitid	iw6THZfJQngZlw1r;

1.7
date	2015.09.05.16.06.50;	author robert;	state Exp;
branches;
next	1.6;
commitid	rTmBXJaDIIWe1XKA;

1.6
date	2015.07.23.13.44.04;	author robert;	state Exp;
branches;
next	1.5;
commitid	vxhJdppNzKtP7lYz;

1.5
date	2015.05.24.15.51.53;	author robert;	state Exp;
branches;
next	1.4;
commitid	rFaYcWD2ntiXn5nr;

1.4
date	2015.04.27.16.38.25;	author robert;	state Exp;
branches;
next	1.3;
commitid	jwX00slFR1NY9xHC;

1.3
date	2015.03.18.19.26.29;	author robert;	state Exp;
branches;
next	1.2;
commitid	aPwx9j7rbIsa650M;

1.2
date	2015.02.15.19.51.28;	author robert;	state Exp;
branches;
next	1.1;
commitid	aXaFfxvdOjpKJO7H;

1.1
date	2015.01.22.11.16.41;	author robert;	state Exp;
branches;
next	;
commitid	yDb21GVFY5iIUXUw;


desc
@@


1.20
log
@update to 58.0.3029.81
@
text
@$OpenBSD: patch-content_gpu_gpu_main_cc,v 1.19 2017/03/14 12:18:54 robert Exp $
--- content/gpu/gpu_main.cc.orig.port	Wed Apr 19 21:06:34 2017
+++ content/gpu/gpu_main.cc	Thu Apr 27 19:56:02 2017
@@@@ -85,6 +85,10 @@@@
 #include "ui/ozone/public/ozone_platform.h"
 #endif
 
+#if defined(OS_BSD)
+#include "content/common/sandbox_init_openbsd.h"
+#endif
+
 #if defined(OS_CHROMEOS) && defined(ARCH_CPU_X86_FAMILY)
 #include "media/gpu/vaapi_wrapper.h"
 #endif
@@@@ -98,7 +102,7 @@@@ namespace content {
 
 namespace {
 
-#if defined(OS_LINUX)
+#if defined(OS_LINUX) || defined(OS_OPENBSD)
 bool StartSandboxLinux(gpu::GpuWatchdogThread*);
 #elif defined(OS_WIN)
 bool StartSandboxWindows(const sandbox::SandboxInterfaceInfo*);
@@@@ -152,7 +156,7 @@@@ class ContentSandboxHelper : public gpu::GpuSandboxHel
 
   bool EnsureSandboxInitialized(
       gpu::GpuWatchdogThread* watchdog_thread) override {
-#if defined(OS_LINUX)
+#if defined(OS_LINUX) || defined(OS_OPENBSD)
     return StartSandboxLinux(watchdog_thread);
 #elif defined(OS_WIN)
     return StartSandboxWindows(sandbox_info_);
@@@@ -313,12 +317,13 @@@@ int GpuMain(const MainFunctionParams& parameters) {
 
 namespace {
 
-#if defined(OS_LINUX)
+#if defined(OS_LINUX) || defined(OS_OPENBSD)
 bool StartSandboxLinux(gpu::GpuWatchdogThread* watchdog_thread) {
   TRACE_EVENT0("gpu,startup", "Initialize sandbox");
 
   bool res = false;
 
+#if !defined(OS_BSD)
   if (watchdog_thread) {
     // LinuxSandbox needs to be able to ensure that the thread
     // has really been stopped.
@@@@ -343,6 +348,9 @@@@ bool StartSandboxLinux(gpu::GpuWatchdogThread* watchdo
     options.timer_slack = base::TIMER_SLACK_MAXIMUM;
     watchdog_thread->StartWithOptions(options);
   }
+#else
+  res = InitializeSandbox();
+#endif
 
   return res;
 }
@


1.19
log
@update to 57.0.2987.98
@
text
@d1 5
a5 5
$OpenBSD: patch-content_gpu_gpu_main_cc,v 1.18 2016/12/10 15:35:25 robert Exp $
--- content/gpu/gpu_main.cc.orig.port	Thu Mar  9 21:04:32 2017
+++ content/gpu/gpu_main.cc	Fri Mar 10 07:46:23 2017
@@@@ -81,6 +81,10 @@@@
 #include "content/common/sandbox_mac.h"
d15 1
a15 1
@@@@ -94,7 +98,7 @@@@ namespace content {
d24 1
a24 1
@@@@ -148,7 +152,7 @@@@ class ContentSandboxHelper : public gpu::GpuSandboxHel
d33 1
a33 1
@@@@ -310,12 +314,13 @@@@ int GpuMain(const MainFunctionParams& parameters) {
d48 1
a48 1
@@@@ -340,6 +345,9 @@@@ bool StartSandboxLinux(gpu::GpuWatchdogThread* watchdo
@


1.18
log
@update to 55.0.2883.75; add lpr support to the system dialog while here
@
text
@d1 4
a4 4
$OpenBSD$
--- content/gpu/gpu_main.cc.orig.port	Sat Dec 10 16:16:35 2016
+++ content/gpu/gpu_main.cc	Sat Dec 10 16:20:00 2016
@@@@ -79,6 +79,10 @@@@
d15 1
a15 1
@@@@ -92,7 +96,7 @@@@ namespace content {
d24 1
a24 1
@@@@ -145,7 +149,7 @@@@ class ContentSandboxHelper : public gpu::GpuSandboxHel
d33 1
a33 1
@@@@ -292,12 +296,13 @@@@ int GpuMain(const MainFunctionParams& parameters) {
d48 1
a48 1
@@@@ -322,6 +327,9 @@@@ bool StartSandboxLinux(gpu::GpuWatchdogThread* watchdo
@


1.17
log
@update to 54.0.2840.71
@
text
@d1 4
a4 4
$OpenBSD: patch-content_gpu_gpu_main_cc,v 1.16 2016/09/01 16:28:11 robert Exp $
--- content/gpu/gpu_main.cc.orig.port	Wed Oct 12 21:02:59 2016
+++ content/gpu/gpu_main.cc	Wed Oct 19 12:56:04 2016
@@@@ -77,6 +77,10 @@@@
d15 1
a15 3
@@@@ -108,8 +112,8 @@@@ bool WarmUpSandbox(const base::CommandLine& command_li
 bool CollectGraphicsInfo(gpu::GPUInfo& gpu_info);
 #endif
d17 1
a17 24
-#if defined(OS_LINUX)
-#if !defined(OS_CHROMEOS)
+#if defined(OS_LINUX) || defined(OS_BSD)
+#if !defined(OS_CHROMEOS) && !defined(OS_BSD)
 bool CanAccessNvidiaDeviceFile();
 #endif
 bool StartSandboxLinux(const gpu::GPUInfo&, GpuWatchdogThread*, bool);
@@@@ -195,13 +199,13 @@@@ int GpuMain(const MainFunctionParams& parameters) {
   // create child windows to render to.
   base::MessagePumpForGpu::InitFactory();
   base::MessageLoop main_message_loop(base::MessageLoop::TYPE_UI);
-#elif defined(OS_LINUX) && defined(USE_X11)
+#elif (defined(OS_BSD) || defined(OS_LINUX)) && defined(USE_X11)
   // We need a UI loop so that we can grab the Expose events. See GLSurfaceGLX
   // and https://crbug.com/326995.
   base::MessageLoop main_message_loop(base::MessageLoop::TYPE_UI);
   std::unique_ptr<ui::PlatformEventSource> event_source =
       ui::PlatformEventSource::CreateDefault();
-#elif defined(OS_LINUX)
+#elif defined(OS_LINUX) || defined(OS_BSD)
   base::MessageLoop main_message_loop(base::MessageLoop::TYPE_DEFAULT);
 #elif defined(OS_MACOSX)
   // This is necessary for CoreAnimation layers hosted in the GPU process to be
@@@@ -266,7 +270,7 @@@@ int GpuMain(const MainFunctionParams& parameters) {
a18 2
   // Warm up resources that don't need access to GPUInfo.
   if (WarmUpSandbox(command_line)) {
d20 5
a24 7
+#if defined(OS_LINUX) || defined(OS_BSD)
     bool initialized_sandbox = false;
     bool initialized_gl_context = false;
     bool should_initialize_gl_context = false;
@@@@ -329,9 +333,9 @@@@ int GpuMain(const MainFunctionParams& parameters) {
             gpu_info, const_cast<base::CommandLine*>(&command_line));
       }
d26 2
d29 5
a33 10
+#if defined(OS_LINUX) || defined(OS_BSD)
       initialized_gl_context = true;
-#if !defined(OS_CHROMEOS)
+#if !defined(OS_CHROMEOS) && !defined(OS_BSD)
       if (gpu_info.gpu.vendor_id == 0x10de &&  // NVIDIA
           gpu_info.driver_vendor == "NVIDIA" &&
           !CanAccessNvidiaDeviceFile())
@@@@ -368,7 +372,7 @@@@ int GpuMain(const MainFunctionParams& parameters) {
       watchdog_thread = NULL;
     }
d35 1
a35 16
-#if defined(OS_LINUX)
+#if defined(OS_LINUX) || defined(OS_BSD)
     should_initialize_gl_context = !initialized_gl_context &&
                                    !dead_on_arrival;
 
@@@@ -376,6 +380,7 @@@@ int GpuMain(const MainFunctionParams& parameters) {
       gpu_info.sandboxed = StartSandboxLinux(gpu_info, watchdog_thread.get(),
                                              should_initialize_gl_context);
     }
+
 #elif defined(OS_WIN)
     gpu_info.sandboxed = StartSandboxWindows(parameters.sandbox_info);
 #elif defined(OS_MACOSX)
@@@@ -520,8 +525,8 @@@@ bool CollectGraphicsInfo(gpu::GPUInfo& gpu_info) {
 }
 #endif
d38 3
a40 7
-#if !defined(OS_CHROMEOS)
+#if defined(OS_LINUX) || defined(OS_BSD)
+#if !defined(OS_CHROMEOS) && !defined(OS_BSD)
 bool CanAccessNvidiaDeviceFile() {
   bool res = true;
   base::ThreadRestrictions::AssertIOAllowed();
@@@@ -579,6 +584,7 @@@@ bool StartSandboxLinux(const gpu::GPUInfo& gpu_info,
d42 1
a42 1
   WarmUpSandboxNvidia(gpu_info, should_initialize_gl_context);
d48 1
a48 7
@@@@ -598,11 +604,15 @@@@ bool StartSandboxLinux(const gpu::GPUInfo& gpu_info,
   // LinuxSandbox::InitializeSandbox() must always be called
   // with only one thread.
   res = LinuxSandbox::InitializeSandbox();
+
   if (watchdog_thread) {
     base::Thread::Options options;
@


1.16
log
@update to 53.0.2785.89
@
text
@d1 4
a4 4
$OpenBSD: patch-content_gpu_gpu_main_cc,v 1.15 2016/07/31 13:11:44 robert Exp $
--- content/gpu/gpu_main.cc.orig.port	Thu Sep  1 00:03:31 2016
+++ content/gpu/gpu_main.cc	Thu Sep  1 11:12:22 2016
@@@@ -75,6 +75,10 @@@@
d15 1
a15 1
@@@@ -106,8 +110,8 @@@@ bool WarmUpSandbox(const base::CommandLine& command_li
d26 1
a26 1
@@@@ -193,13 +197,13 @@@@ int GpuMain(const MainFunctionParams& parameters) {
d42 1
a42 1
@@@@ -264,7 +268,7 @@@@ int GpuMain(const MainFunctionParams& parameters) {
d51 1
a51 1
@@@@ -327,9 +331,9 @@@@ int GpuMain(const MainFunctionParams& parameters) {
d63 1
a63 1
@@@@ -366,7 +370,7 @@@@ int GpuMain(const MainFunctionParams& parameters) {
d72 1
a72 1
@@@@ -374,6 +378,7 @@@@ int GpuMain(const MainFunctionParams& parameters) {
d80 1
a80 1
@@@@ -517,8 +522,8 @@@@ bool CollectGraphicsInfo(gpu::GPUInfo& gpu_info) {
d91 1
a91 1
@@@@ -576,6 +581,7 @@@@ bool StartSandboxLinux(const gpu::GPUInfo& gpu_info,
d99 1
a99 1
@@@@ -595,11 +601,15 @@@@ bool StartSandboxLinux(const gpu::GPUInfo& gpu_info,
@


1.15
log
@update to 52.0.2743.82
@
text
@d1 3
a3 3
$OpenBSD$
--- content/gpu/gpu_main.cc.orig.port	Thu Jul 21 10:38:02 2016
+++ content/gpu/gpu_main.cc	Thu Jul 21 10:38:46 2016
d26 1
a26 2
@@@@ -192,13 +196,13 @@@@ int GpuMain(const MainFunctionParams& parameters) {
   // Use a UI message loop because ANGLE and the desktop GL platform can
d28 1
d42 1
a42 1
@@@@ -263,7 +267,7 @@@@ int GpuMain(const MainFunctionParams& parameters) {
d51 1
a51 1
@@@@ -326,9 +330,9 @@@@ int GpuMain(const MainFunctionParams& parameters) {
d63 1
a63 1
@@@@ -365,7 +369,7 @@@@ int GpuMain(const MainFunctionParams& parameters) {
d72 1
a72 1
@@@@ -373,6 +377,7 @@@@ int GpuMain(const MainFunctionParams& parameters) {
d80 1
a80 1
@@@@ -516,8 +521,8 @@@@ bool CollectGraphicsInfo(gpu::GPUInfo& gpu_info) {
d91 1
a91 1
@@@@ -575,6 +580,7 @@@@ bool StartSandboxLinux(const gpu::GPUInfo& gpu_info,
d99 1
a99 1
@@@@ -594,11 +600,15 @@@@ bool StartSandboxLinux(const gpu::GPUInfo& gpu_info,
@


1.14
log
@update to 51.0.2704.63
@
text
@d1 4
a4 4
$OpenBSD: patch-content_gpu_gpu_main_cc,v 1.13 2016/04/16 19:08:46 robert Exp $
--- content/gpu/gpu_main.cc.orig.port	Wed May 25 21:01:01 2016
+++ content/gpu/gpu_main.cc	Thu May 26 08:09:46 2016
@@@@ -74,6 +74,10 @@@@
d13 1
a13 1
 #include "content/common/gpu/media/vaapi_wrapper.h"
d15 1
a15 1
@@@@ -101,8 +105,8 @@@@ bool WarmUpSandbox(const base::CommandLine& command_li
d26 1
a26 1
@@@@ -185,13 +189,13 @@@@ int GpuMain(const MainFunctionParams& parameters) {
d35 1
a35 1
   scoped_ptr<ui::PlatformEventSource> event_source =
d42 1
a42 1
@@@@ -256,7 +260,7 @@@@ int GpuMain(const MainFunctionParams& parameters) {
d51 2
a52 1
@@@@ -321,9 +325,9 @@@@ int GpuMain(const MainFunctionParams& parameters) {
a53 1
 #endif
d63 1
a63 1
@@@@ -360,7 +364,7 @@@@ int GpuMain(const MainFunctionParams& parameters) {
d72 1
a72 1
@@@@ -368,6 +372,7 @@@@ int GpuMain(const MainFunctionParams& parameters) {
d80 1
a80 1
@@@@ -483,8 +488,8 @@@@ bool CollectGraphicsInfo(gpu::GPUInfo& gpu_info) {
d91 1
a91 1
@@@@ -542,6 +547,7 @@@@ bool StartSandboxLinux(const gpu::GPUInfo& gpu_info,
d99 1
a99 1
@@@@ -561,11 +567,15 @@@@ bool StartSandboxLinux(const gpu::GPUInfo& gpu_info,
@


1.13
log
@update to 50.0.2661.75
@
text
@d1 4
a4 4
$OpenBSD: patch-content_gpu_gpu_main_cc,v 1.12 2016/03/06 10:51:14 robert Exp $
--- content/gpu/gpu_main.cc.orig.port	Wed Apr 13 22:59:46 2016
+++ content/gpu/gpu_main.cc	Thu Apr 14 08:25:12 2016
@@@@ -76,6 +76,10 @@@@
d15 1
a15 1
@@@@ -103,8 +107,8 @@@@ bool WarmUpSandbox(const base::CommandLine& command_li
d26 1
a26 1
@@@@ -187,13 +191,13 @@@@ int GpuMain(const MainFunctionParams& parameters) {
d42 1
a42 1
@@@@ -258,7 +262,7 @@@@ int GpuMain(const MainFunctionParams& parameters) {
d51 1
a51 1
@@@@ -323,9 +327,9 @@@@ int GpuMain(const MainFunctionParams& parameters) {
d63 1
a63 1
@@@@ -362,7 +366,7 @@@@ int GpuMain(const MainFunctionParams& parameters) {
d72 1
a72 1
@@@@ -370,6 +374,7 @@@@ int GpuMain(const MainFunctionParams& parameters) {
d80 1
a80 1
@@@@ -492,8 +497,8 @@@@ bool CollectGraphicsInfo(gpu::GPUInfo& gpu_info) {
d91 1
a91 1
@@@@ -551,6 +556,7 @@@@ bool StartSandboxLinux(const gpu::GPUInfo& gpu_info,
d99 1
a99 1
@@@@ -570,11 +576,15 @@@@ bool StartSandboxLinux(const gpu::GPUInfo& gpu_info,
@


1.12
log
@update to 49.0.2623.75
@
text
@d1 3
a3 3
$OpenBSD: patch-content_gpu_gpu_main_cc,v 1.11 2016/01/23 18:49:31 robert Exp $
--- content/gpu/gpu_main.cc.orig.port	Wed Feb 24 21:01:32 2016
+++ content/gpu/gpu_main.cc	Thu Mar  3 09:43:26 2016
d42 1
a42 1
@@@@ -253,7 +257,7 @@@@ int GpuMain(const MainFunctionParams& parameters) {
d51 1
a51 1
@@@@ -314,9 +318,9 @@@@ int GpuMain(const MainFunctionParams& parameters) {
d63 1
a63 1
@@@@ -353,7 +357,7 @@@@ int GpuMain(const MainFunctionParams& parameters) {
d72 1
a72 1
@@@@ -361,6 +365,7 @@@@ int GpuMain(const MainFunctionParams& parameters) {
d80 1
a80 1
@@@@ -478,8 +483,8 @@@@ bool CollectGraphicsInfo(gpu::GPUInfo& gpu_info) {
d91 1
a91 1
@@@@ -537,6 +542,7 @@@@ bool StartSandboxLinux(const gpu::GPUInfo& gpu_info,
d99 1
a99 1
@@@@ -556,11 +562,15 @@@@ bool StartSandboxLinux(const gpu::GPUInfo& gpu_info,
@


1.11
log
@update to 48.0.2564.82
@
text
@d1 4
a4 4
$OpenBSD: patch-content_gpu_gpu_main_cc,v 1.10 2016/01/06 21:46:44 robert Exp $
--- content/gpu/gpu_main.cc.orig.port	Wed Jan 20 21:01:21 2016
+++ content/gpu/gpu_main.cc	Fri Jan 22 19:58:58 2016
@@@@ -72,6 +72,10 @@@@
d15 1
a15 1
@@@@ -99,8 +103,8 @@@@ bool WarmUpSandbox(const base::CommandLine& command_li
d26 1
a26 1
@@@@ -177,13 +181,13 @@@@ int GpuMain(const MainFunctionParams& parameters) {
d42 1
a42 1
@@@@ -243,7 +247,7 @@@@ int GpuMain(const MainFunctionParams& parameters) {
d51 1
a51 1
@@@@ -304,9 +308,9 @@@@ int GpuMain(const MainFunctionParams& parameters) {
d63 1
a63 1
@@@@ -343,7 +347,7 @@@@ int GpuMain(const MainFunctionParams& parameters) {
d72 1
a72 1
@@@@ -351,6 +355,7 @@@@ int GpuMain(const MainFunctionParams& parameters) {
d80 1
a80 1
@@@@ -468,8 +473,8 @@@@ bool CollectGraphicsInfo(gpu::GPUInfo& gpu_info) {
d91 1
a91 1
@@@@ -527,6 +532,7 @@@@ bool StartSandboxLinux(const gpu::GPUInfo& gpu_info,
d99 1
a99 1
@@@@ -546,11 +552,15 @@@@ bool StartSandboxLinux(const gpu::GPUInfo& gpu_info,
@


1.10
log
@pledge(2) the chromium processes;

The renderer, gpu, plugin and utility processes are now using pledge(2)
Unfortunately the GPU process only requires an rpath pledge because of
Mesa trying to parse two configuration files, /etc/drirc and ${HOME}/.drirc
So currently the GPU process will use an rpath pledge in the next
week or so so that people can test, but this situation has to be
resolved because it is not acceptable that a mostly unused configuration
file is being parsed from a library and that stops us from using less
pledges and thus disallowing the GPU process to have read access
to the filsystem ... like your ssh keys.
@
text
@d1 4
a4 4
$OpenBSD: patch-content_gpu_gpu_main_cc,v 1.9 2015/12/05 16:13:32 robert Exp $
--- content/gpu/gpu_main.cc.orig.port	Tue Dec 15 21:05:11 2015
+++ content/gpu/gpu_main.cc	Sun Jan  3 20:50:31 2016
@@@@ -66,6 +66,10 @@@@
d15 1
a15 1
@@@@ -93,8 +97,8 @@@@ bool WarmUpSandbox(const base::CommandLine& command_li
d26 1
a26 1
@@@@ -171,13 +175,13 @@@@ int GpuMain(const MainFunctionParams& parameters) {
d42 1
a42 1
@@@@ -237,7 +241,7 @@@@ int GpuMain(const MainFunctionParams& parameters) {
d51 1
a51 1
@@@@ -296,9 +300,9 @@@@ int GpuMain(const MainFunctionParams& parameters) {
d63 1
a63 1
@@@@ -335,7 +339,7 @@@@ int GpuMain(const MainFunctionParams& parameters) {
d72 1
a72 1
@@@@ -343,6 +347,7 @@@@ int GpuMain(const MainFunctionParams& parameters) {
d80 1
a80 1
@@@@ -447,8 +452,8 @@@@ bool CollectGraphicsInfo(gpu::GPUInfo& gpu_info) {
d91 1
a91 1
@@@@ -506,6 +511,7 @@@@ bool StartSandboxLinux(const gpu::GPUInfo& gpu_info,
d99 1
a99 1
@@@@ -525,11 +531,15 @@@@ bool StartSandboxLinux(const gpu::GPUInfo& gpu_info,
@


1.9
log
@update to 47.0.2526.73
@
text
@d1 15
a15 4
$OpenBSD: patch-content_gpu_gpu_main_cc,v 1.8 2015/10/14 16:42:07 robert Exp $
--- content/gpu/gpu_main.cc.orig.port	Tue Nov 24 21:00:55 2015
+++ content/gpu/gpu_main.cc	Wed Dec  2 08:18:32 2015
@@@@ -93,7 +93,7 @@@@ bool WarmUpSandbox(const base::CommandLine& command_li
d20 1
d22 1
a22 1
 #if !defined(OS_CHROMEOS)
d25 2
a26 1
@@@@ -171,13 +171,13 @@@@ int GpuMain(const MainFunctionParams& parameters) {
d42 1
a42 8
@@@@ -249,6 +249,10 @@@@ int GpuMain(const MainFunctionParams& parameters) {
       initialized_sandbox = true;
     }
 #endif  // defined(OS_LINUX)
+#if defined(OS_BSD)
+    bool initialized_gl_context = false;
+    bool should_initialize_gl_context = false;
+#endif
d44 8
a51 3
     base::TimeTicks before_initialize_one_off = base::TimeTicks::Now();
 
@@@@ -296,7 +300,7 @@@@ int GpuMain(const MainFunctionParams& parameters) {
d58 2
a59 1
 #if !defined(OS_CHROMEOS)
d61 3
a63 1
@@@@ -335,14 +339,16 @@@@ int GpuMain(const MainFunctionParams& parameters) {
d72 1
a72 2
+#if !defined(OS_BSD)
     if (!initialized_sandbox) {
d76 1
a76 1
+#endif
d80 1
a80 1
@@@@ -447,7 +453,7 @@@@ bool CollectGraphicsInfo(gpu::GPUInfo& gpu_info) {
d85 1
d87 1
a87 1
 #if !defined(OS_CHROMEOS)
d90 25
@


1.8
log
@update to 46.0.2490.71
@
text
@d1 4
a4 4
$OpenBSD: patch-content_gpu_gpu_main_cc,v 1.7 2015/09/05 16:06:50 robert Exp $
--- content/gpu/gpu_main.cc.orig.port	Tue Oct 13 21:04:32 2015
+++ content/gpu/gpu_main.cc	Wed Oct 14 07:41:13 2015
@@@@ -89,7 +89,7 @@@@ bool WarmUpSandbox(const base::CommandLine& command_li
d13 1
a13 1
@@@@ -167,13 +167,13 @@@@ int GpuMain(const MainFunctionParams& parameters) {
d29 1
a29 1
@@@@ -245,6 +245,10 @@@@ int GpuMain(const MainFunctionParams& parameters) {
d40 1
a40 1
@@@@ -292,7 +296,7 @@@@ int GpuMain(const MainFunctionParams& parameters) {
d49 1
a49 1
@@@@ -331,14 +335,16 @@@@ int GpuMain(const MainFunctionParams& parameters) {
d67 1
a67 1
@@@@ -443,7 +449,7 @@@@ bool CollectGraphicsInfo(gpu::GPUInfo& gpu_info) {
@


1.7
log
@update to 45.0.2454.85
@
text
@d1 4
a4 4
$OpenBSD: patch-content_gpu_gpu_main_cc,v 1.6 2015/07/23 13:44:04 robert Exp $
--- content/gpu/gpu_main.cc.orig.port	Tue Sep  1 22:10:42 2015
+++ content/gpu/gpu_main.cc	Wed Sep  2 07:31:55 2015
@@@@ -87,7 +87,7 @@@@ bool WarmUpSandbox(const base::CommandLine& command_li
d13 1
a13 1
@@@@ -165,13 +165,13 @@@@ int GpuMain(const MainFunctionParams& parameters) {
d29 1
a29 1
@@@@ -242,6 +242,10 @@@@ int GpuMain(const MainFunctionParams& parameters) {
d40 1
a40 1
@@@@ -289,7 +293,7 @@@@ int GpuMain(const MainFunctionParams& parameters) {
d49 1
a49 1
@@@@ -328,14 +332,16 @@@@ int GpuMain(const MainFunctionParams& parameters) {
d67 1
a67 1
@@@@ -436,7 +442,7 @@@@ bool CollectGraphicsInfo(gpu::GPUInfo& gpu_info) {
@


1.6
log
@update to 44.0.2403.89
@
text
@d1 4
a4 4
$OpenBSD$
--- content/gpu/gpu_main.cc.orig.port	Wed Jul 22 08:46:00 2015
+++ content/gpu/gpu_main.cc	Wed Jul 22 08:47:47 2015
@@@@ -85,7 +85,7 @@@@ bool WarmUpSandbox(const base::CommandLine& command_li
d13 1
a13 1
@@@@ -163,13 +163,13 @@@@ int GpuMain(const MainFunctionParams& parameters) {
d29 1
a29 1
@@@@ -240,6 +240,10 @@@@ int GpuMain(const MainFunctionParams& parameters) {
d40 1
a40 1
@@@@ -287,7 +291,7 @@@@ int GpuMain(const MainFunctionParams& parameters) {
d49 1
a49 1
@@@@ -326,14 +330,16 @@@@ int GpuMain(const MainFunctionParams& parameters) {
d67 1
a67 1
@@@@ -431,7 +437,7 @@@@ bool CollectGraphicsInfo(gpu::GPUInfo& gpu_info) {
@


1.5
log
@update to 43.0.2357.65
@
text
@d1 4
a4 4
$OpenBSD: patch-content_gpu_gpu_main_cc,v 1.4 2015/04/27 16:38:25 robert Exp $
--- content/gpu/gpu_main.cc.orig.port	Thu May 14 00:35:46 2015
+++ content/gpu/gpu_main.cc	Wed May 20 08:34:56 2015
@@@@ -79,7 +79,7 @@@@ bool WarmUpSandbox(const base::CommandLine& command_li
d13 4
a16 4
@@@@ -164,13 +164,13 @@@@ int GpuMain(const MainFunctionParams& parameters) {
     message_loop_type = base::MessageLoop::TYPE_UI;
   }
   base::MessageLoop main_message_loop(message_loop_type);
d18 1
a18 1
+#elif defined(OS_BSD) && defined(USE_X11)
d25 1
a25 1
+#elif defined(OS_BSD)
d29 1
a29 1
@@@@ -237,6 +237,10 @@@@ int GpuMain(const MainFunctionParams& parameters) {
d40 1
a40 1
@@@@ -284,7 +288,7 @@@@ int GpuMain(const MainFunctionParams& parameters) {
d49 1
a49 1
@@@@ -322,14 +326,16 @@@@ int GpuMain(const MainFunctionParams& parameters) {
d67 1
a67 1
@@@@ -425,7 +431,7 @@@@ bool CollectGraphicsInfo(gpu::GPUInfo& gpu_info) {
@


1.4
log
@update to 42.0.2311.90
@
text
@d1 4
a4 4
$OpenBSD: patch-content_gpu_gpu_main_cc,v 1.3 2015/03/18 19:26:29 robert Exp $
--- content/gpu/gpu_main.cc.orig.port	Wed Apr 15 00:31:22 2015
+++ content/gpu/gpu_main.cc	Wed Apr 15 08:32:50 2015
@@@@ -77,7 +77,7 @@@@ bool WarmUpSandbox(const base::CommandLine& command_li
d13 1
a13 1
@@@@ -162,13 +162,13 @@@@ int GpuMain(const MainFunctionParams& parameters) {
d29 1
a29 1
@@@@ -235,6 +235,10 @@@@ int GpuMain(const MainFunctionParams& parameters) {
d40 1
a40 1
@@@@ -282,7 +286,7 @@@@ int GpuMain(const MainFunctionParams& parameters) {
d49 1
a49 1
@@@@ -317,14 +321,16 @@@@ int GpuMain(const MainFunctionParams& parameters) {
@


1.3
log
@update to 41.0.2272.89
@
text
@d1 4
a4 4
$OpenBSD$
--- content/gpu/gpu_main.cc.orig.port	Wed Mar 11 07:42:53 2015
+++ content/gpu/gpu_main.cc	Wed Mar 11 19:24:41 2015
@@@@ -76,7 +76,7 @@@@ bool WarmUpSandbox(const base::CommandLine& command_li
d13 1
a13 1
@@@@ -161,13 +161,13 @@@@ int GpuMain(const MainFunctionParams& parameters) {
d29 1
a29 1
@@@@ -234,6 +234,10 @@@@ int GpuMain(const MainFunctionParams& parameters) {
d40 1
a40 1
@@@@ -281,7 +285,7 @@@@ int GpuMain(const MainFunctionParams& parameters) {
d49 1
a49 1
@@@@ -316,14 +320,16 @@@@ int GpuMain(const MainFunctionParams& parameters) {
d67 1
a67 1
@@@@ -424,7 +430,7 @@@@ bool CollectGraphicsInfo(gpu::GPUInfo& gpu_info) {
@


1.2
log
@use mesa to get the gpu vendor and device id and pass it to chromium because
we can't use libpci due to permission restrictions and use some more UI code
on BSD as well
@
text
@d1 4
a4 4
$OpenBSD: patch-content_gpu_gpu_main_cc,v 1.1 2015/01/22 11:16:41 robert Exp $
--- content/gpu/gpu_main.cc.orig.port	Wed Feb 11 08:15:35 2015
+++ content/gpu/gpu_main.cc	Sun Feb 15 10:55:08 2015
@@@@ -77,7 +77,7 @@@@ bool WarmUpSandbox(const CommandLine& command_line);
d13 1
a13 1
@@@@ -162,13 +162,13 @@@@ int GpuMain(const MainFunctionParams& parameters) {
d18 1
a18 1
+#elif (defined(OS_BSD) || defined(OS_LINUX)) && defined(USE_X11)
d25 1
a25 1
+#elif defined(OS_LINUX) || defined(OS_BSD)
d29 1
a29 10
@@@@ -216,7 +216,7 @@@@ int GpuMain(const MainFunctionParams& parameters) {
   // Temporarily disable DRI3 on desktop Linux.
   // The GPU process is crashing on DRI3-enabled desktop Linux systems.
   // TODO(jorgelo): remove this when crbug.com/415681 is fixed.
-#if defined(OS_LINUX) && !defined(OS_CHROMEOS)
+#if (defined(OS_BSD) || defined(OS_LINUX)) && !defined(OS_CHROMEOS)
   {
     scoped_ptr<base::Environment> env(base::Environment::Create());
     env->SetVar("LIBGL_DRI3_DISABLE", "1");
@@@@ -245,6 +245,10 @@@@ int GpuMain(const MainFunctionParams& parameters) {
d40 1
a40 1
@@@@ -292,7 +296,7 @@@@ int GpuMain(const MainFunctionParams& parameters) {
d49 1
a49 1
@@@@ -327,14 +331,16 @@@@ int GpuMain(const MainFunctionParams& parameters) {
d67 1
a67 1
@@@@ -435,7 +441,7 @@@@ bool CollectGraphicsInfo(gpu::GPUInfo& gpu_info) {
@


1.1
log
@update to 40.0.2214.91
@
text
@d1 12
a12 3
$OpenBSD$
--- content/gpu/gpu_main.cc.orig.port	Fri Dec 26 19:55:38 2014
+++ content/gpu/gpu_main.cc	Fri Dec 26 19:59:25 2014
d38 47
@

