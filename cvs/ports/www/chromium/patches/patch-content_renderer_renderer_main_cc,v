head	1.14;
access;
symbols
	OPENBSD_6_2:1.14.0.2
	OPENBSD_6_2_BASE:1.14
	OPENBSD_6_1:1.11.0.2
	OPENBSD_6_1_BASE:1.11
	OPENBSD_6_0:1.8.0.2
	OPENBSD_6_0_BASE:1.8
	OPENBSD_5_9:1.5.0.2
	OPENBSD_5_9_BASE:1.5
	OPENBSD_5_0:1.1.0.2
	OPENBSD_5_0_BASE:1.1;
locks; strict;
comment	@# @;


1.14
date	2017.07.27.14.23.46;	author robert;	state Exp;
branches;
next	1.13;
commitid	UqlSU0wmYWtcPgqI;

1.13
date	2017.06.25.21.53.56;	author robert;	state Exp;
branches;
next	1.12;
commitid	l6xAjqoVop0UE8Em;

1.12
date	2017.04.28.14.21.00;	author robert;	state Exp;
branches;
next	1.11;
commitid	XFDnyB7tGNawHUbl;

1.11
date	2017.03.14.12.18.54;	author robert;	state Exp;
branches;
next	1.10;
commitid	FgEdsLreTqAdn1i5;

1.10
date	2016.10.26.06.22.08;	author robert;	state Exp;
branches;
next	1.9;
commitid	Dt81be1Osjz00Uwx;

1.9
date	2016.09.01.16.28.11;	author robert;	state Exp;
branches;
next	1.8;
commitid	0duujWXlyOCBrehm;

1.8
date	2016.05.27.06.28.21;	author robert;	state Exp;
branches;
next	1.7;
commitid	cpiCcJ3vjht5tEkH;

1.7
date	2016.04.16.19.08.46;	author robert;	state Exp;
branches;
next	1.6;
commitid	SE10dvx9aTcZrjRO;

1.6
date	2016.03.06.10.51.14;	author robert;	state Exp;
branches;
next	1.5;
commitid	Upms3IeOsaLsGxbP;

1.5
date	2016.01.31.20.45.29;	author robert;	state Exp;
branches;
next	1.4;
commitid	1W0lvpVPlqRBm1pa;

1.4
date	2016.01.23.18.49.31;	author robert;	state Exp;
branches;
next	1.3;
commitid	KVrkvcBYFue8N3VB;

1.3
date	2016.01.06.21.46.44;	author robert;	state Exp;
branches;
next	1.2;
commitid	QCpbcWCjgKtMUGZ9;

1.2
date	2011.08.16.08.17.44;	author robert;	state dead;
branches;
next	1.1;

1.1
date	2011.06.08.20.36.56;	author robert;	state Exp;
branches;
next	;


desc
@@


1.14
log
@update to 60.0.3112.78
@
text
@$OpenBSD: patch-content_renderer_renderer_main_cc,v 1.13 2017/06/25 21:53:56 robert Exp $
Index: content/renderer/renderer_main.cc
--- content/renderer/renderer_main.cc.orig
+++ content/renderer/renderer_main.cc
@@@@ -34,6 +34,7 @@@@
 #include "ppapi/features/features.h"
 #include "third_party/WebKit/public/platform/scheduler/renderer/renderer_scheduler.h"
 #include "third_party/skia/include/core/SkGraphics.h"
+#include "third_party/skia/include/ports/SkFontConfigInterface.h"
 #include "ui/base/ui_base_switches.h"
 
 #if defined(OS_ANDROID)
@@@@ -68,6 +69,12 @@@@
 #include "ui/ozone/public/client_native_pixmap_factory_ozone.h"
 #endif
 
+#if defined(OS_BSD)
+#include "content/browser/renderer_host/render_sandbox_host_linux.h"
+#include "content/common/font_config_ipc_linux.h"
+#include "content/common/sandbox_linux/sandbox_linux.h"
+#endif
+
 namespace content {
 namespace {
 // This function provides some ways to test crash and assertion handling
@@@@ -190,9 +197,13 @@@@ int RendererMain(const MainFunctionParams& parameters)
   // is OK.
   InitializeWebRtcModule();
 #endif
+#if defined(OS_BSD)
+  SkFontConfigInterface::SetGlobal(
+      new FontConfigIPC(GetSandboxFD()))->unref();
+#endif
 
   {
-#if defined(OS_WIN) || defined(OS_MACOSX)
+#if defined(OS_WIN) || defined(OS_MACOSX) || defined(OS_BSD)
     // TODO(markus): Check if it is OK to unconditionally move this
     // instruction down.
     auto render_process = RenderProcessImpl::Create();
@@@@ -202,7 +213,7 @@@@ int RendererMain(const MainFunctionParams& parameters)
     bool run_loop = true;
     if (!no_sandbox)
       run_loop = platform.EnableSandbox();
-#if defined(OS_POSIX) && !defined(OS_MACOSX)
+#if defined(OS_POSIX) && !defined(OS_MACOSX) && !defined(OS_BSD)
     auto render_process = RenderProcessImpl::Create();
     RenderThreadImpl::Create(std::move(main_message_loop),
                              std::move(renderer_scheduler));
@


1.13
log
@update to 59.0.3071.109
@
text
@d1 1
a1 1
$OpenBSD: patch-content_renderer_renderer_main_cc,v 1.12 2017/04/28 14:21:00 robert Exp $
d13 1
a13 1
@@@@ -62,6 +63,12 @@@@
d26 1
a26 1
@@@@ -171,9 +178,13 @@@@ int RendererMain(const MainFunctionParams& parameters)
d41 1
a41 1
@@@@ -183,7 +194,7 @@@@ int RendererMain(const MainFunctionParams& parameters)
@


1.12
log
@update to 58.0.3029.81
@
text
@d1 4
a4 3
$OpenBSD$
--- content/renderer/renderer_main.cc.orig.port	Fri Apr 28 07:33:33 2017
+++ content/renderer/renderer_main.cc	Fri Apr 28 09:32:21 2017
d14 1
a14 1
 #include "ui/ozone/public/client_native_pixmap_factory.h"
@


1.11
log
@update to 57.0.2987.98
@
text
@d1 3
a3 3
$OpenBSD: patch-content_renderer_renderer_main_cc,v 1.10 2016/10/26 06:22:08 robert Exp $
--- content/renderer/renderer_main.cc.orig.port	Thu Mar  9 21:04:32 2017
+++ content/renderer/renderer_main.cc	Fri Mar 10 07:46:23 2017
d12 1
a12 1
@@@@ -62,6 +63,11 @@@@
d17 1
a17 1
+#include "content/common/child_process_sandbox_support_impl_linux.h"
d19 1
d25 1
a25 1
@@@@ -171,9 +177,13 @@@@ int RendererMain(const MainFunctionParams& parameters)
d39 2
a40 2
     RenderProcessImpl render_process;
@@@@ -183,7 +193,7 @@@@ int RendererMain(const MainFunctionParams& parameters)
d46 1
a46 1
     RenderProcessImpl render_process;
@


1.10
log
@update to 54.0.2840.71
@
text
@d1 5
a5 5
$OpenBSD: patch-content_renderer_renderer_main_cc,v 1.9 2016/09/01 16:28:11 robert Exp $
--- content/renderer/renderer_main.cc.orig.port	Wed Oct 12 21:02:59 2016
+++ content/renderer/renderer_main.cc	Wed Oct 19 12:56:05 2016
@@@@ -32,6 +32,7 @@@@
 #include "content/renderer/renderer_main_platform_delegate.h"
d12 1
a12 1
@@@@ -60,6 +61,11 @@@@
d24 1
a24 1
@@@@ -169,9 +175,13 @@@@ int RendererMain(const MainFunctionParams& parameters)
d39 1
a39 1
@@@@ -181,7 +191,7 @@@@ int RendererMain(const MainFunctionParams& parameters)
@


1.9
log
@update to 53.0.2785.89
@
text
@d1 4
a4 5
$OpenBSD: patch-content_renderer_renderer_main_cc,v 1.8 2016/05/27 06:28:21 robert Exp $
--- content/renderer/renderer_main.cc.orig.port	Thu Sep  1 00:03:31 2016
+++ content/renderer/renderer_main.cc	Thu Sep  1 11:12:22 2016
@@@@ -31,6 +31,7 @@@@
 #include "content/renderer/render_thread_impl.h"
d6 1
d12 1
a12 1
@@@@ -59,6 +60,11 @@@@
d24 1
a24 1
@@@@ -168,9 +174,13 @@@@ int RendererMain(const MainFunctionParams& parameters)
d39 1
a39 1
@@@@ -180,7 +190,7 @@@@ int RendererMain(const MainFunctionParams& parameters)
@


1.8
log
@update to 51.0.2704.63
@
text
@d1 3
a3 3
$OpenBSD: patch-content_renderer_renderer_main_cc,v 1.7 2016/04/16 19:08:46 robert Exp $
--- content/renderer/renderer_main.cc.orig.port	Wed May 25 21:01:02 2016
+++ content/renderer/renderer_main.cc	Thu May 26 08:09:46 2016
d24 1
a24 1
@@@@ -170,9 +176,13 @@@@ int RendererMain(const MainFunctionParams& parameters)
d39 1
a39 1
@@@@ -182,7 +192,7 @@@@ int RendererMain(const MainFunctionParams& parameters)
@


1.7
log
@update to 50.0.2661.75
@
text
@d1 4
a4 4
$OpenBSD: patch-content_renderer_renderer_main_cc,v 1.6 2016/03/06 10:51:14 robert Exp $
--- content/renderer/renderer_main.cc.orig.port	Wed Apr 13 22:59:47 2016
+++ content/renderer/renderer_main.cc	Thu Apr 14 08:25:12 2016
@@@@ -33,6 +33,7 @@@@
d12 1
a12 1
@@@@ -61,6 +62,11 @@@@
d24 1
a24 1
@@@@ -190,9 +196,13 @@@@ int RendererMain(const MainFunctionParams& parameters)
d39 1
a39 1
@@@@ -202,7 +212,7 @@@@ int RendererMain(const MainFunctionParams& parameters)
@


1.6
log
@update to 49.0.2623.75
@
text
@d1 4
a4 4
$OpenBSD: patch-content_renderer_renderer_main_cc,v 1.5 2016/01/31 20:45:29 robert Exp $
--- content/renderer/renderer_main.cc.orig.port	Wed Feb 24 21:01:32 2016
+++ content/renderer/renderer_main.cc	Thu Mar  3 09:43:26 2016
@@@@ -34,6 +34,7 @@@@
d12 2
a13 2
@@@@ -66,6 +67,11 @@@@
 #include "content/common/mojo/mojo_shell_connection_impl.h"
d24 1
a24 1
@@@@ -201,9 +207,13 @@@@ int RendererMain(const MainFunctionParams& parameters)
d39 1
a39 1
@@@@ -213,7 +223,7 @@@@ int RendererMain(const MainFunctionParams& parameters)
@


1.5
log
@since we are not using the Zygote model, make sure to initialize the
sandbox ipc channel for the renderer in order to get proper font
handling outside of the sandbox if necessary
@
text
@d1 4
a4 4
$OpenBSD: patch-content_renderer_renderer_main_cc,v 1.4 2016/01/23 18:49:31 robert Exp $
--- content/renderer/renderer_main.cc.orig.port	Wed Jan 27 18:00:49 2016
+++ content/renderer/renderer_main.cc	Sun Jan 31 21:40:09 2016
@@@@ -28,6 +28,7 @@@@
d12 2
a13 2
@@@@ -56,6 +57,11 @@@@
 #include "ui/ozone/public/client_native_pixmap_factory.h"
d24 1
a24 1
@@@@ -183,9 +189,13 @@@@ int RendererMain(const MainFunctionParams& parameters)
d39 1
a39 1
@@@@ -195,7 +205,7 @@@@ int RendererMain(const MainFunctionParams& parameters)
d46 2
a47 2
     RenderThreadImpl::Create(main_message_loop.Pass(),
                              renderer_scheduler.Pass());
@


1.4
log
@update to 48.0.2564.82
@
text
@d1 26
a26 4
$OpenBSD: patch-content_renderer_renderer_main_cc,v 1.3 2016/01/06 21:46:44 robert Exp $
--- content/renderer/renderer_main.cc.orig.port	Wed Jan 20 21:01:21 2016
+++ content/renderer/renderer_main.cc	Fri Jan 22 19:58:58 2016
@@@@ -185,7 +185,7 @@@@ int RendererMain(const MainFunctionParams& parameters)
d28 4
d39 1
a39 1
@@@@ -195,7 +195,7 @@@@ int RendererMain(const MainFunctionParams& parameters)
@


1.3
log
@pledge(2) the chromium processes;

The renderer, gpu, plugin and utility processes are now using pledge(2)
Unfortunately the GPU process only requires an rpath pledge because of
Mesa trying to parse two configuration files, /etc/drirc and ${HOME}/.drirc
So currently the GPU process will use an rpath pledge in the next
week or so so that people can test, but this situation has to be
resolved because it is not acceptable that a mostly unused configuration
file is being parsed from a library and that stops us from using less
pledges and thus disallowing the GPU process to have read access
to the filsystem ... like your ssh keys.
@
text
@d1 4
a4 4
$OpenBSD$
--- content/renderer/renderer_main.cc.orig.port	Sun Jan  3 21:44:36 2016
+++ content/renderer/renderer_main.cc	Sun Jan  3 21:44:58 2016
@@@@ -182,7 +182,7 @@@@ int RendererMain(const MainFunctionParams& parameters)
d13 1
a13 1
@@@@ -192,7 +192,7 @@@@ int RendererMain(const MainFunctionParams& parameters)
@


1.2
log
@update to the next stable release (13.0.782.112)
@
text
@d1 5
a5 5
$OpenBSD: patch-content_renderer_renderer_main_cc,v 1.1 2011/06/08 20:36:56 robert Exp $
--- content/renderer/renderer_main.cc.orig	Wed Jun  8 12:10:51 2011
+++ content/renderer/renderer_main.cc	Wed Jun  8 12:11:06 2011
@@@@ -205,7 +205,7 @@@@ int RendererMain(const MainFunctionParams& parameters)
   PepperPluginRegistry::GetInstance();
d8 2
a9 2
-#if !defined(OS_LINUX)
+#if !defined(OS_LINUX) && !defined(OS_OPENBSD)
d13 6
a18 6
@@@@ -217,7 +217,7 @@@@ int RendererMain(const MainFunctionParams& parameters)
     } else {
       LOG(ERROR) << "Running without renderer sandbox";
     }
-#if defined(OS_LINUX)
+#if defined(OS_LINUX) || defined(OS_OPENBSD)
d20 2
a21 2
     render_process.set_main_thread(new RenderThread());
 #endif
@


1.1
log
@Update to the new stable branch: 12.0.742.91
http://googlechromereleases.blogspot.com/2011/06/chrome-stable-release.html
@
text
@d1 1
a1 1
$OpenBSD$
@

