head	1.5;
access;
symbols
	OPENBSD_6_0:1.5.0.4
	OPENBSD_6_0_BASE:1.5
	OPENBSD_5_9:1.5.0.2
	OPENBSD_5_9_BASE:1.5
	OPENBSD_5_8:1.4.0.4
	OPENBSD_5_8_BASE:1.4
	OPENBSD_5_7:1.3.0.2
	OPENBSD_5_7_BASE:1.3
	OPENBSD_5_6:1.1.0.2
	OPENBSD_5_6_BASE:1.1;
locks; strict;
comment	@# @;


1.5
date	2015.09.05.16.06.50;	author robert;	state Exp;
branches;
next	1.4;
commitid	rTmBXJaDIIWe1XKA;

1.4
date	2015.05.24.15.51.52;	author robert;	state Exp;
branches;
next	1.3;
commitid	rFaYcWD2ntiXn5nr;

1.3
date	2015.01.22.11.16.40;	author robert;	state Exp;
branches;
next	1.2;
commitid	yDb21GVFY5iIUXUw;

1.2
date	2014.09.11.19.04.52;	author robert;	state Exp;
branches;
next	1.1;
commitid	WrglT9ERNBhPArdd;

1.1
date	2014.07.20.17.22.33;	author robert;	state Exp;
branches;
next	;
commitid	yFSQqywU9tg3Fhqe;


desc
@@


1.5
log
@update to 45.0.2454.85
@
text
@$OpenBSD: patch-base_posix_unix_domain_socket_linux_cc,v 1.4 2015/05/24 15:51:52 robert Exp $
--- base/posix/unix_domain_socket_linux.cc.orig.port	Sat Aug 22 21:01:50 2015
+++ base/posix/unix_domain_socket_linux.cc	Wed Sep  2 07:31:54 2015
@@@@ -5,7 +5,10 @@@@
 #include "base/posix/unix_domain_socket_linux.h"
 
 #include <errno.h>
+#include <sys/types.h>
+#include <sys/param.h>
 #include <sys/socket.h>
+#include <sys/ucred.h>
 #include <unistd.h>
 
 #include <vector>
@@@@ -25,6 +28,14 @@@@ namespace base {
 
 const size_t UnixDomainSocket::kMaxFileDescriptors = 16;
 
+#ifndef SCM_CREDENTIALS
+#  define SCM_CREDENTIALS      0x9001
+#endif
+
+#ifndef SO_PASSCRED
+#  define SO_PASSCRED  0x9002
+#endif
+
 #if !defined(OS_NACL_NONSFI)
 // Creates a connected pair of UNIX-domain SOCK_SEQPACKET sockets, and passes
 // ownership of the newly allocated file descriptors to |one| and |two|.
@@@@ -150,7 +161,7 @@@@ ssize_t UnixDomainSocket::RecvMsgWithFlags(int fd,
           cmsg->cmsg_type == SCM_CREDENTIALS) {
         DCHECK_EQ(payload_len, sizeof(struct ucred));
         DCHECK_EQ(pid, -1);
-        pid = reinterpret_cast<struct ucred*>(CMSG_DATA(cmsg))->pid;
+        pid = getpid();
       }
 #endif
     }
@


1.4
log
@update to 43.0.2357.65
@
text
@d1 3
a3 3
$OpenBSD$
--- base/posix/unix_domain_socket_linux.cc.orig.port	Wed May 20 09:59:28 2015
+++ base/posix/unix_domain_socket_linux.cc	Wed May 20 11:34:37 2015
d15 1
a15 1
@@@@ -23,6 +26,14 @@@@
d30 1
a30 1
@@@@ -148,7 +159,7 @@@@ ssize_t UnixDomainSocket::RecvMsgWithFlags(int fd,
@


1.3
log
@update to 40.0.2214.91
@
text
@d2 2
a3 2
--- base/posix/unix_domain_socket_linux.cc.orig.port	Sat Dec  6 12:35:07 2014
+++ base/posix/unix_domain_socket_linux.cc	Sun Dec  7 15:27:39 2014
d30 1
a30 1
@@@@ -148,7 +159,8 @@@@ ssize_t UnixDomainSocket::RecvMsgWithFlags(int fd,
d32 2
a33 2
         DCHECK(payload_len == sizeof(struct ucred));
         DCHECK(pid == -1);
a34 1
+//        pid = reinterpret_cast<struct ucred*>(CMSG_DATA(cmsg))->pid;
@


1.2
log
@update to 37.0.2062.120
@
text
@d1 6
a6 4
$OpenBSD: patch-base_posix_unix_domain_socket_linux_cc,v 1.1 2014/07/20 17:22:33 robert Exp $
--- base/posix/unix_domain_socket_linux.cc.orig.port	Wed Sep 10 01:29:17 2014
+++ base/posix/unix_domain_socket_linux.cc	Wed Sep 10 22:05:40 2014
@@@@ -7,6 +7,8 @@@@
d8 2
a10 2
 #include <sys/uio.h>
+#include <sys/param.h>
d15 3
a17 3
@@@@ -32,11 +34,13 @@@@ static bool CreateSocketPair(base::ScopedFD* one, base
   return true;
 }
d19 2
a20 6
+#if !defined(OS_BSD)
 // static
 bool UnixDomainSocket::EnableReceiveProcessId(int fd) {
   const int enable = 1;
   return setsockopt(fd, SOL_SOCKET, SO_PASSCRED, &enable, sizeof(enable)) == 0;
 }
d22 3
a24 17
 
 // static
 bool UnixDomainSocket::SendMsg(int fd,
@@@@ -99,6 +103,7 @@@@ ssize_t UnixDomainSocket::RecvMsgWithFlags(int fd,
                                            int flags,
                                            ScopedVector<base::ScopedFD>* fds,
                                            base::ProcessId* out_pid) {
+#if !defined(OS_BSD)
   fds->clear();
 
   struct msghdr msg = {};
@@@@ -163,6 +168,9 @@@@ ssize_t UnixDomainSocket::RecvMsgWithFlags(int fd,
   }
 
   return r;
+#else
+  return -1;
d26 14
a39 3
 }
 
 // static
@


1.1
log
@update to 36.0.1985.125;

from this release Chromium uses Aura instead of Gtk+ so the UI will look
a bit different, and that is completely normal.
@
text
@d1 3
a3 3
$OpenBSD$
--- base/posix/unix_domain_socket_linux.cc.orig.port	Thu Jul 17 13:43:05 2014
+++ base/posix/unix_domain_socket_linux.cc	Sat Jul 19 00:33:21 2014
d35 1
a35 1
@@@@ -157,6 +162,9 @@@@ ssize_t UnixDomainSocket::RecvMsgWithFlags(int fd,
@

