head	1.17;
access;
symbols
	OPENBSD_6_0:1.16.0.2
	OPENBSD_6_0_BASE:1.16
	OPENBSD_5_9:1.15.0.2
	OPENBSD_5_9_BASE:1.15
	OPENBSD_5_8:1.12.0.4
	OPENBSD_5_8_BASE:1.12
	OPENBSD_5_0:1.4.0.2
	OPENBSD_5_0_BASE:1.4
	OPENBSD_4_9:1.2.0.2
	OPENBSD_4_9_BASE:1.2;
locks; strict;
comment	@# @;


1.17
date	2016.08.17.11.06.50;	author robert;	state dead;
branches;
next	1.16;
commitid	ho0WBaBoHvorC0o0;

1.16
date	2016.03.06.10.51.14;	author robert;	state Exp;
branches;
next	1.15;
commitid	Upms3IeOsaLsGxbP;

1.15
date	2016.01.23.18.49.31;	author robert;	state Exp;
branches;
next	1.14;
commitid	KVrkvcBYFue8N3VB;

1.14
date	2015.10.14.16.42.07;	author robert;	state Exp;
branches;
next	1.13;
commitid	iw6THZfJQngZlw1r;

1.13
date	2015.09.05.16.06.50;	author robert;	state Exp;
branches;
next	1.12;
commitid	rTmBXJaDIIWe1XKA;

1.12
date	2015.07.25.12.59.15;	author robert;	state Exp;
branches;
next	1.11;
commitid	auRZVkyT9T4bzTbf;

1.11
date	2015.07.23.13.44.04;	author robert;	state Exp;
branches;
next	1.10;
commitid	vxhJdppNzKtP7lYz;

1.10
date	2015.05.24.15.51.53;	author robert;	state Exp;
branches;
next	1.9;
commitid	rFaYcWD2ntiXn5nr;

1.9
date	2015.03.18.19.26.29;	author robert;	state Exp;
branches;
next	1.8;
commitid	aPwx9j7rbIsa650M;

1.8
date	2011.11.11.22.54.53;	author robert;	state dead;
branches;
next	1.7;

1.7
date	2011.10.27.07.59.09;	author robert;	state Exp;
branches;
next	1.6;

1.6
date	2011.09.19.08.55.26;	author robert;	state Exp;
branches;
next	1.5;

1.5
date	2011.08.16.08.17.44;	author robert;	state Exp;
branches;
next	1.4;

1.4
date	2011.06.08.20.36.56;	author robert;	state Exp;
branches;
next	1.3;

1.3
date	2011.04.29.13.18.02;	author robert;	state Exp;
branches;
next	1.2;

1.2
date	2011.02.08.09.43.02;	author espie;	state Exp;
branches;
next	1.1;

1.1
date	2010.12.13.09.51.46;	author espie;	state Exp;
branches;
next	;


desc
@@


1.17
log
@Move chromium to the new build system (gn - generate ninja)

This commit moves the chromium port to use gn to generate ninja files
which will hopefully resolve the random build errors. Gyp is dead so
this move has to be done anyway.

Also change the way how we handle openbsd. Let's assume we are running
on linux and only handle !linux cases where needed. This also ensures
that a change on linux will for sure end up in our builds as well.
@
text
@$OpenBSD: patch-third_party_ffmpeg_ffmpeg_gyp,v 1.16 2016/03/06 10:51:14 robert Exp $
--- third_party/ffmpeg/ffmpeg.gyp.orig.port	Wed Mar  2 21:02:56 2016
+++ third_party/ffmpeg/ffmpeg.gyp	Thu Mar  3 09:43:26 2016
@@@@ -317,7 +317,7 @@@@
                 ],
               },
               'conditions': [
-                ['OS != "android"', {
+                ['OS != "android" and os_bsd != 1', {
                   'link_settings': {
                     # OS=android requires that both -lz and -lm occur
                     # after -lc++_shared on the link command
@


1.16
log
@update to 49.0.2623.75
@
text
@d1 1
a1 1
$OpenBSD: patch-third_party_ffmpeg_ffmpeg_gyp,v 1.15 2016/01/23 18:49:31 robert Exp $
@


1.15
log
@update to 48.0.2564.82
@
text
@d1 4
a4 4
$OpenBSD: patch-third_party_ffmpeg_ffmpeg_gyp,v 1.14 2015/10/14 16:42:07 robert Exp $
--- third_party/ffmpeg/ffmpeg.gyp.orig.port	Wed Jan 20 21:02:05 2016
+++ third_party/ffmpeg/ffmpeg.gyp	Fri Jan 22 19:58:59 2016
@@@@ -315,7 +315,7 @@@@
d11 2
a12 2
                     'libraries': [
                       '-lrt',
@


1.14
log
@update to 46.0.2490.71
@
text
@d1 4
a4 4
$OpenBSD: patch-third_party_ffmpeg_ffmpeg_gyp,v 1.13 2015/09/05 16:06:50 robert Exp $
--- third_party/ffmpeg/ffmpeg.gyp.orig.port	Wed Oct  7 04:42:57 2015
+++ third_party/ffmpeg/ffmpeg.gyp	Wed Oct 14 07:41:14 2015
@@@@ -310,7 +310,7 @@@@
@


1.13
log
@update to 45.0.2454.85
@
text
@d1 4
a4 4
$OpenBSD$
--- third_party/ffmpeg/ffmpeg.gyp.orig.port	Wed Sep  2 20:13:33 2015
+++ third_party/ffmpeg/ffmpeg.gyp	Wed Sep  2 20:13:45 2015
@@@@ -306,7 +306,7 @@@@
@


1.12
log
@update to 44.0.2403.107
@
text
@d1 4
a4 9
$OpenBSD: patch-third_party_ffmpeg_ffmpeg_gyp,v 1.11 2015/07/23 13:44:04 robert Exp $
--- third_party/ffmpeg/ffmpeg.gyp.orig.port	Fri Jul 24 22:27:10 2015
+++ third_party/ffmpeg/ffmpeg.gyp	Sat Jul 25 12:27:25 2015
@@@@ -325,7 +325,6 @@@@
               'link_settings': {
                 'libraries': [
                   '-lm',
-                  '-lrt',
                   '-lz',
d7 6
@


1.11
log
@update to 44.0.2403.89
@
text
@d1 4
a4 4
$OpenBSD: patch-third_party_ffmpeg_ffmpeg_gyp,v 1.10 2015/05/24 15:51:53 robert Exp $
--- third_party/ffmpeg/ffmpeg.gyp.orig.port	Wed Jul 15 22:31:25 2015
+++ third_party/ffmpeg/ffmpeg.gyp	Wed Jul 22 08:37:30 2015
@@@@ -318,7 +318,6 @@@@
@


1.10
log
@update to 43.0.2357.65
@
text
@d1 5
a5 5
$OpenBSD: patch-third_party_ffmpeg_ffmpeg_gyp,v 1.9 2015/03/18 19:26:29 robert Exp $
--- third_party/ffmpeg/ffmpeg.gyp.orig.port	Thu May 14 00:36:34 2015
+++ third_party/ffmpeg/ffmpeg.gyp	Wed May 20 08:34:56 2015
@@@@ -330,7 +330,6 @@@@
                 ],
@


1.9
log
@update to 41.0.2272.89
@
text
@d1 4
a4 4
$OpenBSD$
--- third_party/ffmpeg/ffmpeg.gyp.orig.port	Wed Mar 11 19:16:25 2015
+++ third_party/ffmpeg/ffmpeg.gyp	Wed Mar 11 19:16:29 2015
@@@@ -328,7 +328,6 @@@@
@


1.8
log
@update to 15.0.874.120
@
text
@d1 9
a9 4
$OpenBSD: patch-third_party_ffmpeg_ffmpeg_gyp,v 1.7 2011/10/27 07:59:09 robert Exp $
--- third_party/ffmpeg/ffmpeg.gyp.orig	Wed Oct 26 13:54:51 2011
+++ third_party/ffmpeg/ffmpeg.gyp	Wed Oct 26 13:55:42 2011
@@@@ -227,6 +227,12 @@@@
a11 10
             }],  # OS=="linux" or OS=="freebsd" or OS=="openbsd" or OS=="solaris"
+            ['OS=="openbsd"', {
+              # OpenBSD's gcc (4.2.1) does not support this flag
+              'cflags!': [
+                '-fno-signed-zeros',
+              ],
+            }],
             ['OS=="mac"', {
               'conditions': [
                 ['mac_breakpad==1', {
@


1.7
log
@update to 15.0.874.102.

switch from using the hacked macosx transport dib to the linux one
which uses sysv shms.
make sure you also have a current kernel before using this version
@
text
@d1 1
a1 1
$OpenBSD$
@


1.6
log
@update to 14.0.835.163
@
text
@d2 15
a16 10
--- third_party/ffmpeg/ffmpeg.gyp.orig	Wed Sep 14 10:03:27 2011
+++ third_party/ffmpeg/ffmpeg.gyp	Sat Sep 17 15:59:48 2011
@@@@ -493,7 +493,6 @@@@
                 '-std=c99',
                 '-pthread',
                 '-fno-math-errno',
-                '-fno-signed-zeros',
                 '-fno-tree-vectorize',
                 '-fomit-frame-pointer',
                 # Don't warn about libavformat using its own deprecated APIs.
@


1.5
log
@update to the next stable release (13.0.782.112)
@
text
@d1 11
a11 22
$OpenBSD: patch-third_party_ffmpeg_ffmpeg_gyp,v 1.4 2011/06/08 20:36:56 robert Exp $
--- third_party/ffmpeg/ffmpeg.gyp.orig	Wed Jul 27 10:03:39 2011
+++ third_party/ffmpeg/ffmpeg.gyp	Tue Aug  2 20:12:19 2011
@@@@ -470,7 +470,7 @@@@
               }, {
                 # Using libvpx provided by the system.
                 'include_dirs': [
-                  '/usr/include/vpx',
+                  '/usr/local/include',
                 ],
               }
             ],
@@@@ -753,6 +753,9 @@@@
                   ],
                 },
               },
+              'include_dirs': [
+                '/usr/local/include',
+              ],
             }],
 
             # Add pkg-config result to include path when use_system_ffmpeg!=0
@


1.4
log
@Update to the new stable branch: 12.0.742.91
http://googlechromereleases.blogspot.com/2011/06/chrome-stable-release.html
@
text
@d1 4
a4 4
$OpenBSD$
--- third_party/ffmpeg/ffmpeg.gyp.orig	Wed Jun  8 15:29:27 2011
+++ third_party/ffmpeg/ffmpeg.gyp	Wed Jun  8 16:46:20 2011
@@@@ -468,7 +468,7 @@@@
d13 1
a13 1
@@@@ -751,6 +751,9 @@@@
@


1.3
log
@update to the latest stable version which is now 11.0.696.60
+ switch from using system sqlite to the bundled one because they have
  many modifications that are needed
+ add a new mirror for the distfile because the google one is utterly slow
@
text
@d1 4
a4 49
$OpenBSD: patch-third_party_ffmpeg_ffmpeg_gyp,v 1.2 2011/02/08 09:43:02 espie Exp $
--- third_party/ffmpeg/ffmpeg.gyp.orig	Tue Apr 26 10:02:53 2011
+++ third_party/ffmpeg/ffmpeg.gyp	Thu Apr 28 17:32:14 2011
@@@@ -204,10 +204,12 @@@@
                 'patched-ffmpeg-mt/libavformat/mp3.c',
               ],
             }],  # ffmpeg_branding
-            ['target_arch=="ia32" or target_arch=="x64"', {
+            ['use_system_yasm==0', {
               'dependencies': [
                 '../yasm/yasm.gyp:yasm#host',
               ],
+            }],
+            ['target_arch=="ia32" or target_arch=="x64"', {
               'sources': [
                 'patched-ffmpeg-mt/libavcodec/libvpxdec.c',
                 'patched-ffmpeg-mt/libavcodec/libvpxenc.c',  # sep 09
@@@@ -365,9 +367,13 @@@@
                 ],
               },
               'variables': {
-                'yasm_path': '<(PRODUCT_DIR)/yasm',
                 'obj_format': 'elf',
                 'conditions': [
+                  [ 'use_system_yasm==1', {
+                    'yasm_path': '<!(which yasm)',
+                  }, {
+                    'yasm_path': '<(PRODUCT_DIR)/yasm',
+                  }],
                   [ 'target_arch=="ia32"', {
                     'yasm_flags': [
                       '-DARCH_X86_32',
@@@@ -429,10 +435,14 @@@@
                 ],
               },
               'variables': {
-                'yasm_path': '<(PRODUCT_DIR)/yasm',
                 'obj_format': 'macho',
                 'yasm_flags': [ '-DPREFIX' ],
                 'conditions': [
+                  [ 'use_system_yasm==1', {
+                    'yasm_path': '<!(which yasm)',
+                  }, {
+                    'yasm_path': '<(PRODUCT_DIR)/yasm',
+                  }],
                   [ 'target_arch=="ia32"', {
                     'yasm_flags': [
                       '-DARCH_X86_32',
@@@@ -458,7 +468,7 @@@@
d13 1
a13 1
@@@@ -738,6 +748,9 @@@@
@


1.2
log
@late update to chromium 9, robert@@ did the work, but he doesn't have the
time right now.
Tree is still locked!
Reasons for the update:
- good work that can be used now
- only builds on i386/amd64, and they're fast
- multiple security problems in old chrome
- old chrome half working, can't break it more than it was.

This one requires resources (see MESSAGE), but it's ways more stable.

Again, discussed with sthen@@, jasper@@, naddy@@, miod@@
@
text
@d1 49
a49 13
$OpenBSD$
--- third_party/ffmpeg/ffmpeg.gyp.orig	Fri Jan 21 10:22:21 2011
+++ third_party/ffmpeg/ffmpeg.gyp	Mon Jan 24 10:13:53 2011
@@@@ -82,7 +82,7 @@@@
     'ffmpeg_variant%': '<(target_arch)',
 
     'use_system_ffmpeg%': 0,
-    'use_system_yasm%': 0,
+    'use_system_yasm%': 1,
     'build_ffmpegsumo%': 1,
     'use_system_vpx%': 0,
 
@@@@ -433,7 +433,7 @@@@
d58 10
@


1.1
log
@cut the "monster patches" into small pieces. pval can fix it to his liking
if he comes back.
In the mean time, fix build of chromium by adding the required
-I/usr/local/includes to gyp glue where needed.
@
text
@d2 3
a4 3
--- third_party/ffmpeg/ffmpeg.gyp.orig	Tue Mar 30 07:33:58 2010
+++ third_party/ffmpeg/ffmpeg.gyp	Sun Nov 28 00:11:29 2010
@@@@ -43,7 +43,7 @@@@
d10 2
d13 8
a20 26
     # Locations for generated artifacts.
     'shared_generated_dir': '<(SHARED_INTERMEDIATE_DIR)/third_party/ffmpeg',
@@@@ -56,7 +56,7 @@@@
     #
     # TODO(ajwong): Per the comment above, reduce this conditional's size and
     # determine if in-tree build in Windows is tractable.
-    ['(OS!="linux" and OS!="freebsd" and OS!="openbsd" and OS!="solaris" and OS!="mac") or use_system_ffmpeg!=0', {
+    ['(OS!="linux" and OS!="freebsd" and OS!="solaris" and OS!="mac") or use_system_ffmpeg!=0', {
       'variables': {
         'target_for_binaries': 'ffmpeg_binaries',
         'ffmpeg_include_root': 'include',
@@@@ -129,11 +129,11 @@@@
             'source/patched-ffmpeg-mt/libavutil/pixdesc.c', # TODO(fbarchard): Review this file.
             'source/patched-ffmpeg-mt/libavutil/rational.c',
             # Config file for the OS and architecture.
-            'source/config/<(ffmpeg_branding)/<(OS)/<(ffmpeg_config)/config.h',
+            'source/config/<(ffmpeg_branding)/linux/<(ffmpeg_config)/config.h',
             'source/config/libavutil/avconfig.h',
           ],
           'include_dirs': [
-            'source/config/<(ffmpeg_branding)/<(OS)/<(ffmpeg_config)',
+            'source/config/<(ffmpeg_branding)/linux/<(ffmpeg_config)',
             'source/patched-ffmpeg-mt',
 	    'source/config',
           ],
@@@@ -751,7 +751,7 @@@@
a21 7
           },
         ],
-        ['OS=="linux" or OS=="freebsd" or OS=="solaris"', {
+        ['OS=="linux" or OS=="solaris"', {
           'link_settings': {
             'libraries': [
               # We need dl for dlopen() and friends.
@

