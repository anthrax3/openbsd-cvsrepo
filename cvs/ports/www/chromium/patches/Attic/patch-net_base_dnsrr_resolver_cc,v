head	1.7;
access;
symbols
	OPENBSD_5_1_BASE:1.6
	OPENBSD_5_1:1.6.0.2
	OPENBSD_5_0:1.2.0.2
	OPENBSD_5_0_BASE:1.2
	OPENBSD_4_9:1.1.0.2
	OPENBSD_4_9_BASE:1.1;
locks; strict;
comment	@# @;


1.7
date	2012.02.17.10.19.51;	author robert;	state dead;
branches;
next	1.6;

1.6
date	2011.12.14.16.58.19;	author robert;	state Exp;
branches;
next	1.5;

1.5
date	2011.10.27.07.59.09;	author robert;	state Exp;
branches;
next	1.4;

1.4
date	2011.09.19.08.55.26;	author robert;	state Exp;
branches;
next	1.3;

1.3
date	2011.08.16.08.17.44;	author robert;	state Exp;
branches;
next	1.2;

1.2
date	2011.03.15.11.38.05;	author robert;	state Exp;
branches;
next	1.1;

1.1
date	2011.02.08.09.43.02;	author espie;	state Exp;
branches;
next	;


desc
@@


1.7
log
@update to 17.0.963.56
@
text
@$OpenBSD: patch-net_base_dnsrr_resolver_cc,v 1.6 2011/12/14 16:58:19 robert Exp $
--- net/base/dnsrr_resolver.cc.orig	Wed Dec  7 09:01:30 2011
+++ net/base/dnsrr_resolver.cc	Tue Dec 13 21:23:12 2011
@@@@ -5,6 +5,7 @@@@
 #include "net/base/dnsrr_resolver.h"
 
 #if defined(OS_POSIX)
+#include <netinet/in.h>
 #include <resolv.h>
 #endif
 
@@@@ -187,7 +188,11 @@@@ class RRResolverWorker {
     bool r = true;
 #if defined(OS_MACOSX) || defined(OS_OPENBSD)
     if ((_res.options & RES_INIT) == 0) {
+#if defined(OS_OPENBSD)
+      if (res_init() != 0)
+#else
       if (res_ninit(&_res) != 0)
+#endif
         r = false;
     }
 #else
@


1.6
log
@update to 16.0.912.63
@
text
@d1 1
a1 1
$OpenBSD: patch-net_base_dnsrr_resolver_cc,v 1.5 2011/10/27 07:59:09 robert Exp $
@


1.5
log
@update to 15.0.874.102.

switch from using the hacked macosx transport dib to the linux one
which uses sysv shms.
make sure you also have a current kernel before using this version
@
text
@d1 3
a3 3
$OpenBSD$
--- net/base/dnsrr_resolver.cc.orig	Wed Oct 26 13:46:29 2011
+++ net/base/dnsrr_resolver.cc	Wed Oct 26 13:46:58 2011
d12 1
a12 1
@@@@ -186,7 +187,11 @@@@ class RRResolverWorker {
@


1.4
log
@update to 14.0.835.163
@
text
@d1 4
a4 5
$OpenBSD: patch-net_base_dnsrr_resolver_cc,v 1.3 2011/08/16 08:17:44 robert Exp $
--- net/base/dnsrr_resolver.cc.orig	Tue Aug 23 10:28:31 2011
+++ net/base/dnsrr_resolver.cc	Wed Aug 24 10:54:23 2011
@@@@ -4,6 +4,12 @@@@
 
d7 1
a7 3
+#if defined(OS_OPENBSD)
+#include <sys/types.h>
+#include <sys/socket.h>
a8 3
+#endif
+
 #if defined(OS_POSIX)
a10 1
@@@@ -185,7 +191,11 @@@@ class RRResolverWorker {
d12 1
d14 1
d23 1
a23 21
 
@@@@ -193,14 +203,18 @@@@ class RRResolverWorker {
       unsigned long saved_options = _res.options;
       r = Do();
 
-#if defined(OS_POSIX) && !defined(OS_MACOSX) && !defined(OS_OPENBSD)
+#if defined(OS_POSIX) && !defined(OS_MACOSX)
       if (!r && DnsReloadTimerHasExpired()) {
         // When there's no network connection, _res may not be initialized by
         // getaddrinfo. Therefore, we call res_nclose only when there are ns
         // entries.
+#if !defined(OS_OPENBSD)
         if (_res.nscount > 0)
           res_nclose(&_res);
         if (res_ninit(&_res) == 0)
+#else
+        if (res_init() == 0)
+#endif
           r = Do();
       }
 #endif
@


1.3
log
@update to the next stable release (13.0.782.112)
@
text
@d1 3
a3 3
$OpenBSD: patch-net_base_dnsrr_resolver_cc,v 1.2 2011/03/15 11:38:05 robert Exp $
--- net/base/dnsrr_resolver.cc.orig	Wed Jul 27 10:01:11 2011
+++ net/base/dnsrr_resolver.cc	Thu Aug  4 13:50:43 2011
d17 1
a17 1
@@@@ -186,7 +192,11 @@@@ class RRResolverWorker {
d29 1
a29 1
@@@@ -194,14 +204,18 @@@@ class RRResolverWorker {
@


1.2
log
@update to 10.0.648.133
@
text
@d1 3
a3 3
$OpenBSD: patch-net_base_dnsrr_resolver_cc,v 1.1 2011/02/08 09:43:02 espie Exp $
--- net/base/dnsrr_resolver.cc.orig	Fri Mar 11 10:01:15 2011
+++ net/base/dnsrr_resolver.cc	Mon Mar 14 10:55:37 2011
d17 1
a17 2
@@@@ -185,10 +191,12 @@@@ class RRResolverWorker {
     }
a19 1
+#if !defined(OS_OPENBSD)
d21 3
d25 1
a27 1
+#endif
d29 1
a29 1
     if (r) {
d31 18
@


1.1
log
@late update to chromium 9, robert@@ did the work, but he doesn't have the
time right now.
Tree is still locked!
Reasons for the update:
- good work that can be used now
- only builds on i386/amd64, and they're fast
- multiple security problems in old chrome
- old chrome half working, can't break it more than it was.

This one requires resources (see MESSAGE), but it's ways more stable.

Again, discussed with sthen@@, jasper@@, naddy@@, miod@@
@
text
@d1 3
a3 3
$OpenBSD$
--- net/base/dnsrr_resolver.cc.orig	Fri Jan 21 10:19:57 2011
+++ net/base/dnsrr_resolver.cc	Mon Jan 24 13:04:07 2011
d17 1
a17 1
@@@@ -170,10 +176,12 @@@@ class RRResolverWorker {
@

