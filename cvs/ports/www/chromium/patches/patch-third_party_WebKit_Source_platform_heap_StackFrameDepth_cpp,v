head	1.9;
access;
symbols
	OPENBSD_6_0:1.7.0.2
	OPENBSD_6_0_BASE:1.7
	OPENBSD_5_9:1.4.0.2
	OPENBSD_5_9_BASE:1.4
	OPENBSD_5_8:1.3.0.4
	OPENBSD_5_8_BASE:1.3;
locks; strict;
comment	@# @;


1.9
date	2017.03.14.12.18.54;	author robert;	state Exp;
branches;
next	1.8;
commitid	FgEdsLreTqAdn1i5;

1.8
date	2016.12.10.15.35.25;	author robert;	state Exp;
branches;
next	1.7;
commitid	D24Pj03ujnweitOe;

1.7
date	2016.05.27.06.28.21;	author robert;	state Exp;
branches;
next	1.6;
commitid	cpiCcJ3vjht5tEkH;

1.6
date	2016.04.16.19.08.46;	author robert;	state Exp;
branches;
next	1.5;
commitid	SE10dvx9aTcZrjRO;

1.5
date	2016.03.06.10.51.14;	author robert;	state Exp;
branches;
next	1.4;
commitid	Upms3IeOsaLsGxbP;

1.4
date	2016.01.23.18.49.31;	author robert;	state Exp;
branches;
next	1.3;
commitid	KVrkvcBYFue8N3VB;

1.3
date	2015.07.23.13.44.04;	author robert;	state Exp;
branches;
next	1.2;
commitid	vxhJdppNzKtP7lYz;

1.2
date	2015.05.24.15.51.53;	author robert;	state Exp;
branches;
next	1.1;
commitid	rFaYcWD2ntiXn5nr;

1.1
date	2015.04.27.16.38.25;	author robert;	state Exp;
branches;
next	;
commitid	jwX00slFR1NY9xHC;


desc
@@


1.9
log
@update to 57.0.2987.98
@
text
@$OpenBSD$
--- third_party/WebKit/Source/platform/heap/StackFrameDepth.cpp.orig.port	Fri Mar 10 10:07:30 2017
+++ third_party/WebKit/Source/platform/heap/StackFrameDepth.cpp	Fri Mar 10 10:07:57 2017
@@@@ -15,6 +15,11 @@@@
 extern "C" void* __libc_stack_end;  // NOLINT
 #endif
 
+#if OS(OPENBSD)
+#include <sys/signal.h>
+#include <pthread_np.h>
+#endif
+
 namespace blink {
 
 static const char* s_avoidOptimization = nullptr;
@


1.8
log
@update to 55.0.2883.75; add lpr support to the system dialog while here
@
text
@d2 3
a4 3
--- third_party/WebKit/Source/platform/heap/StackFrameDepth.cpp.orig.port	Sat Dec  3 14:14:26 2016
+++ third_party/WebKit/Source/platform/heap/StackFrameDepth.cpp	Sat Dec  3 14:15:27 2016
@@@@ -14,6 +14,11 @@@@
a15 29
@@@@ -100,6 +105,8 @@@@ size_t StackFrameDepth::getUnderestimatedStackSize() {
   //    low as 512k.
   //
   return 512 * 1024;
+#elif OS(OPENBSD)
+  return 512 * 1024;
 #elif OS(MACOSX)
   // pthread_get_stacksize_np() returns too low a value for the main thread on
   // OSX 10.9,
@@@@ -135,12 +142,18 @@@@ size_t StackFrameDepth::getUnderestimatedStackSize() {
 }
 
 void* StackFrameDepth::getStackStart() {
-#if defined(__GLIBC__) || OS(ANDROID) || OS(FREEBSD)
+#if defined(__GLIBC__) || OS(ANDROID) || OS(FREEBSD) || OS(OPENBSD)
   pthread_attr_t attr;
   int error;
 #if OS(FREEBSD)
   pthread_attr_init(&attr);
   error = pthread_attr_get_np(pthread_self(), &attr);
+#elif OS(OPENBSD)
+  stack_t ss;
+  void *base;
+  error = pthread_stackseg_np(pthread_self(), &ss);
+  base = (void*)((size_t) ss.ss_sp - ss.ss_size);
+  return reinterpret_cast<Address>(base) + ss.ss_size;
 #else
   error = pthread_getattr_np(pthread_self(), &attr);
 #endif
@


1.7
log
@update to 51.0.2704.63
@
text
@d1 4
a4 5
$OpenBSD: patch-third_party_WebKit_Source_platform_heap_StackFrameDepth_cpp,v 1.6 2016/04/16 19:08:46 robert Exp $
--- third_party/WebKit/Source/platform/heap/StackFrameDepth.cpp.orig.port	Wed May 25 04:54:37 2016
+++ third_party/WebKit/Source/platform/heap/StackFrameDepth.cpp	Thu May 26 08:09:48 2016
@@@@ -13,6 +13,10 @@@@
 #elif defined(__GLIBC__)
d7 1
d12 1
a12 1
 
d15 5
a19 4
@@@@ -104,6 +108,8 @@@@ size_t StackFrameDepth::getUnderestimatedStackSize()
     //    low as 512k.
     //
     return 512 * 1024;
d21 1
a21 1
+    return 512 * 1024;
d23 4
a26 3
     // pthread_get_stacksize_np() returns too low a value for the main thread on
     // OSX 10.9, http://mail.openjdk.java.net/pipermail/hotspot-dev/2013-October/011369.html
@@@@ -135,12 +141,18 @@@@ size_t StackFrameDepth::getUnderestimatedStackSize()
d28 1
a28 2
 void* StackFrameDepth::getStackStart()
 {
d31 2
a32 2
     pthread_attr_t attr;
     int error;
d34 2
a35 2
     pthread_attr_init(&attr);
     error = pthread_attr_get_np(pthread_self(), &attr);
d37 5
a41 5
+    stack_t ss;
+    void *base;
+    error = pthread_stackseg_np(pthread_self(), &ss);
+    base = (void*)((size_t) ss.ss_sp - ss.ss_size);
+    return reinterpret_cast<Address>(base) + ss.ss_size;
d43 1
a43 1
     error = pthread_getattr_np(pthread_self(), &attr);
@


1.6
log
@update to 50.0.2661.75
@
text
@d1 3
a3 3
$OpenBSD$
--- third_party/WebKit/Source/platform/heap/StackFrameDepth.cpp.orig.port	Thu Apr 14 14:07:45 2016
+++ third_party/WebKit/Source/platform/heap/StackFrameDepth.cpp	Thu Apr 14 20:00:25 2016
d15 1
a15 1
@@@@ -115,6 +119,8 @@@@ size_t StackFrameDepth::getUnderestimatedStackSize()
d24 1
a24 1
@@@@ -146,12 +152,18 @@@@ size_t StackFrameDepth::getUnderestimatedStackSize()
@


1.5
log
@update to 49.0.2623.75
@
text
@d2 2
a3 2
--- third_party/WebKit/Source/platform/heap/StackFrameDepth.cpp.orig.port	Wed Feb 24 21:01:34 2016
+++ third_party/WebKit/Source/platform/heap/StackFrameDepth.cpp	Sat Mar  5 19:54:47 2016
d15 4
a18 4
@@@@ -95,6 +99,8 @@@@ size_t StackFrameDepth::getUnderestimatedStackSize()
 #endif
 
     return 0;
d20 1
a20 1
+    return 0;
d24 1
a24 1
@@@@ -126,12 +132,18 @@@@ size_t StackFrameDepth::getUnderestimatedStackSize()
@


1.4
log
@update to 48.0.2564.82
@
text
@d1 4
a4 4
$OpenBSD: patch-third_party_WebKit_Source_platform_heap_StackFrameDepth_cpp,v 1.3 2015/07/23 13:44:04 robert Exp $
--- third_party/WebKit/Source/platform/heap/StackFrameDepth.cpp.orig.port	Wed Jan 20 21:01:25 2016
+++ third_party/WebKit/Source/platform/heap/StackFrameDepth.cpp	Fri Jan 22 19:58:59 2016
@@@@ -14,6 +14,10 @@@@
d15 1
a15 1
@@@@ -96,7 +100,7 @@@@ size_t StackFrameDepth::getUnderestimatedStackSize()
d19 6
a24 6
-#elif OS(MACOSX)
+#elif OS(MACOSX) || OS(OPENBSD)
     // FIXME: pthread_get_stacksize_np() returns shorter size than actual stack
     // size for the main thread on Mavericks(10.9).
     return 0;
@@@@ -110,12 +114,18 @@@@ size_t StackFrameDepth::getUnderestimatedStackSize()
@


1.3
log
@update to 44.0.2403.89
@
text
@d1 3
a3 3
$OpenBSD: patch-third_party_WebKit_Source_platform_heap_StackFrameDepth_cpp,v 1.2 2015/05/24 15:51:53 robert Exp $
--- third_party/WebKit/Source/platform/heap/StackFrameDepth.cpp.orig.port	Wed Jul 15 22:31:13 2015
+++ third_party/WebKit/Source/platform/heap/StackFrameDepth.cpp	Wed Jul 22 08:37:30 2015
d15 1
a15 1
@@@@ -93,7 +97,7 @@@@ size_t StackFrameDepth::getUnderestimatedStackSize()
d24 1
a24 1
@@@@ -114,12 +118,18 @@@@ size_t StackFrameDepth::getUnderestimatedStackSize()
@


1.2
log
@update to 43.0.2357.65
@
text
@d1 3
a3 3
$OpenBSD$
--- third_party/WebKit/Source/platform/heap/StackFrameDepth.cpp.orig.port	Thu May 14 00:49:00 2015
+++ third_party/WebKit/Source/platform/heap/StackFrameDepth.cpp	Fri May 22 23:50:07 2015
d15 1
a15 1
@@@@ -84,7 +88,7 @@@@ size_t StackFrameDepth::getUnderestimatedStackSize()
d24 1
a24 1
@@@@ -105,12 +109,18 @@@@ size_t StackFrameDepth::getUnderestimatedStackSize()
@


1.1
log
@update to 42.0.2311.90
@
text
@d2 2
a3 2
--- third_party/WebKit/Source/platform/heap/StackFrameDepth.cpp.orig.port	Wed Apr 15 09:41:19 2015
+++ third_party/WebKit/Source/platform/heap/StackFrameDepth.cpp	Wed Apr 22 22:49:42 2015
d15 2
a16 1
@@@@ -39,7 +43,7 @@@@ void StackFrameDepth::configureLimit()
d18 7
a24 8
 size_t StackFrameDepth::getUnderestimatedStackSize()
 {
-#if defined(__GLIBC__) || OS(ANDROID) || OS(FREEBSD)
+#if defined(__GLIBC__) || OS(ANDROID) || OS(FREEBSD) || OS(OPENBSD)
     // We cannot get the stack size in these platforms because
     // pthread_getattr_np() can fail for the main thread.
     // This is OK because ThreadState::current() doesn't use the stack size
@@@@ -63,12 +67,18 @@@@ size_t StackFrameDepth::getUnderestimatedStackSize()
@

