head	1.22;
access;
symbols
	OPENBSD_6_0:1.22.0.4
	OPENBSD_6_0_BASE:1.22
	OPENBSD_5_9:1.22.0.2
	OPENBSD_5_9_BASE:1.22
	OPENBSD_5_8:1.21.0.4
	OPENBSD_5_8_BASE:1.21
	OPENBSD_5_7:1.20.0.2
	OPENBSD_5_7_BASE:1.20
	OPENBSD_5_6:1.19.0.2
	OPENBSD_5_6_BASE:1.19
	OPENBSD_5_5:1.17.0.2
	OPENBSD_5_5_BASE:1.17
	OPENBSD_5_4:1.15.0.2
	OPENBSD_5_4_BASE:1.15
	OPENBSD_5_3:1.14.0.2
	OPENBSD_5_3_BASE:1.14
	OPENBSD_5_2:1.10.0.2
	OPENBSD_5_2_BASE:1.10
	OPENBSD_5_1_BASE:1.7
	OPENBSD_5_1:1.7.0.2
	OPENBSD_5_0:1.4.0.2
	OPENBSD_5_0_BASE:1.4
	OPENBSD_4_9:1.2.0.2
	OPENBSD_4_9_BASE:1.2;
locks; strict;
comment	@# @;


1.22
date	2016.01.23.18.49.31;	author robert;	state Exp;
branches;
next	1.21;
commitid	KVrkvcBYFue8N3VB;

1.21
date	2015.04.27.16.38.25;	author robert;	state Exp;
branches;
next	1.20;
commitid	jwX00slFR1NY9xHC;

1.20
date	2014.10.13.06.49.19;	author robert;	state Exp;
branches;
next	1.19;
commitid	GAMY6AdJxC6cdD6g;

1.19
date	2014.04.17.16.27.53;	author robert;	state Exp;
branches;
next	1.18;

1.18
date	2014.03.11.14.52.01;	author robert;	state Exp;
branches;
next	1.17;

1.17
date	2014.01.18.11.42.04;	author robert;	state Exp;
branches;
next	1.16;

1.16
date	2013.12.12.10.43.18;	author robert;	state Exp;
branches;
next	1.15;

1.15
date	2013.04.03.08.19.10;	author robert;	state Exp;
branches;
next	1.14;

1.14
date	2013.01.18.21.38.02;	author robert;	state Exp;
branches;
next	1.13;

1.13
date	2012.11.07.06.59.45;	author robert;	state Exp;
branches;
next	1.12;

1.12
date	2012.10.12.16.46.10;	author robert;	state Exp;
branches;
next	1.11;

1.11
date	2012.08.26.18.47.01;	author robert;	state Exp;
branches;
next	1.10;

1.10
date	2012.07.10.09.22.34;	author robert;	state Exp;
branches;
next	1.9;

1.9
date	2012.04.03.13.59.35;	author robert;	state Exp;
branches;
next	1.8;

1.8
date	2012.02.17.10.19.51;	author robert;	state Exp;
branches;
next	1.7;

1.7
date	2011.12.14.16.58.19;	author robert;	state Exp;
branches;
next	1.6;

1.6
date	2011.10.27.07.59.09;	author robert;	state Exp;
branches;
next	1.5;

1.5
date	2011.09.19.08.55.26;	author robert;	state Exp;
branches;
next	1.4;

1.4
date	2011.05.26.11.39.14;	author robert;	state Exp;
branches;
next	1.3;

1.3
date	2011.04.29.13.18.02;	author robert;	state Exp;
branches;
next	1.2;

1.2
date	2011.02.08.09.43.02;	author espie;	state Exp;
branches;
next	1.1;

1.1
date	2010.12.13.09.51.46;	author espie;	state Exp;
branches;
next	;


desc
@@


1.22
log
@update to 48.0.2564.82
@
text
@$OpenBSD$
--- tools/gyp/pylib/gyp/generator/make.py.orig.port	Fri Jan 22 22:14:59 2016
+++ tools/gyp/pylib/gyp/generator/make.py	Fri Jan 22 22:15:51 2016
@@@@ -136,7 +136,7 @@@@ quiet_cmd_alink = AR($(TOOLSET)) $@@
 cmd_alink = rm -f $@@ && $(AR.$(TOOLSET)) crs $@@ $(filter %.o,$^)
 
 quiet_cmd_alink_thin = AR($(TOOLSET)) $@@
-cmd_alink_thin = rm -f $@@ && $(AR.$(TOOLSET)) crsT $@@ $(filter %.o,$^)
+cmd_alink_thin = rm -f $@@ && $(AR.$(TOOLSET)) crs $@@ $(filter %.o,$^)
 
 # Due to circular dependencies between libraries :(, we wrap the
 # special "figure out circular dependencies" flags around the entire
@@@@ -186,7 +186,7 @@@@ quiet_cmd_alink = AR($(TOOLSET)) $@@
 cmd_alink = rm -f $@@ && $(AR.$(TOOLSET)) crs $@@ $(filter %.o,$^)
 
 quiet_cmd_alink_thin = AR($(TOOLSET)) $@@
-cmd_alink_thin = rm -f $@@ && $(AR.$(TOOLSET)) crsT $@@ $(filter %.o,$^)
+cmd_alink_thin = rm -f $@@ && $(AR.$(TOOLSET)) crs $@@ $(filter %.o,$^)
 
 # Due to circular dependencies between libraries :(, we wrap the
 # special "figure out circular dependencies" flags around the entire
@@@@ -286,11 +286,11 @@@@ LINK ?= $(CXX.target)
 # TODO(evan): move all cross-compilation logic to gyp-time so we don't need
 # to replicate this environment fallback in make as well.
 CC.host ?= %(CC.host)s
-CFLAGS.host ?= $(CPPFLAGS_host) $(CFLAGS_host)
+CFLAGS.host ?= $(CPPFLAGS) $(CFLAGS)
 CXX.host ?= %(CXX.host)s
-CXXFLAGS.host ?= $(CPPFLAGS_host) $(CXXFLAGS_host)
+CXXFLAGS.host ?= $(CPPFLAGS) $(CXXFLAGS)
 LINK.host ?= %(LINK.host)s
-LDFLAGS.host ?=
+LDFLAGS.host ?= $(LDFLAGS)
 AR.host ?= %(AR.host)s
 
 # Define a dir function that can handle spaces.
@


1.21
log
@update to 42.0.2311.90
@
text
@d1 3
a3 3
$OpenBSD: patch-tools_gyp_pylib_gyp_generator_make_py,v 1.20 2014/10/13 06:49:19 robert Exp $
--- tools/gyp/pylib/gyp/generator/make.py.orig.port	Wed Apr 15 00:32:04 2015
+++ tools/gyp/pylib/gyp/generator/make.py	Wed Apr 15 08:32:50 2015
d26 2
a27 2
-CFLAGS.host ?=
+CFLAGS.host ?= $(CFLAGS)
d29 2
a30 2
-CXXFLAGS.host ?=
+CXXFLAGS.host ?= $(CXXFLAGS)
@


1.20
log
@update to 38.0.2125.101
@
text
@d1 3
a3 3
$OpenBSD: patch-tools_gyp_pylib_gyp_generator_make_py,v 1.19 2014/04/17 16:27:53 robert Exp $
--- tools/gyp/pylib/gyp/generator/make.py.orig.port	Thu Oct  2 19:40:30 2014
+++ tools/gyp/pylib/gyp/generator/make.py	Fri Oct 10 16:10:31 2014
d22 1
a22 1
@@@@ -294,11 +294,11 @@@@ LINK ?= %(flock)s $(builddir)/linker.lock $(CXX.target
@


1.19
log
@update to 34.0.1847.116 and disable Werror for the future clang update
@
text
@d1 4
a4 4
$OpenBSD: patch-tools_gyp_pylib_gyp_generator_make_py,v 1.18 2014/03/11 14:52:01 robert Exp $
--- tools/gyp/pylib/gyp/generator/make.py.orig.port	Wed Apr  2 21:05:58 2014
+++ tools/gyp/pylib/gyp/generator/make.py	Sat Apr 12 09:40:41 2014
@@@@ -135,7 +135,7 @@@@ quiet_cmd_alink = AR($(TOOLSET)) $@@
d13 1
a13 1
@@@@ -185,7 +185,7 @@@@ quiet_cmd_alink = AR($(TOOLSET)) $@@
d22 1
a22 1
@@@@ -293,11 +293,11 @@@@ LINK ?= %(flock)s $(builddir)/linker.lock $(CXX.target
@


1.18
log
@update to 33.0.1750.146
@
text
@d1 4
a4 4
$OpenBSD: patch-tools_gyp_pylib_gyp_generator_make_py,v 1.17 2014/01/18 11:42:04 robert Exp $
--- tools/gyp/pylib/gyp/generator/make.py.orig.port	Thu Feb 20 21:29:33 2014
+++ tools/gyp/pylib/gyp/generator/make.py	Fri Feb 21 19:39:56 2014
@@@@ -141,7 +141,7 @@@@ quiet_cmd_alink = AR($(TOOLSET)) $@@
d13 1
a13 1
@@@@ -191,7 +191,7 @@@@ quiet_cmd_alink = AR($(TOOLSET)) $@@
d22 1
a22 1
@@@@ -299,11 +299,11 @@@@ LINK ?= %(flock)s $(builddir)/linker.lock $(CXX.target
@


1.17
log
@update to 32.0.1700.76
@
text
@d1 4
a4 4
$OpenBSD: patch-tools_gyp_pylib_gyp_generator_make_py,v 1.16 2013/12/12 10:43:18 robert Exp $
--- tools/gyp/pylib/gyp/generator/make.py.orig.port	Mon Jan 13 22:01:45 2014
+++ tools/gyp/pylib/gyp/generator/make.py	Thu Jan 16 12:26:42 2014
@@@@ -128,7 +128,7 @@@@ quiet_cmd_alink = AR($(TOOLSET)) $@@
d13 1
a13 1
@@@@ -178,7 +178,7 @@@@ quiet_cmd_alink = AR($(TOOLSET)) $@@
d22 1
a22 1
@@@@ -286,11 +286,11 @@@@ LINK ?= %(flock)s $(builddir)/linker.lock $(CXX.target
@


1.16
log
@update to 31.0.1650.63
@
text
@d1 3
a3 3
$OpenBSD: patch-tools_gyp_pylib_gyp_generator_make_py,v 1.15 2013/04/03 08:19:10 robert Exp $
--- tools/gyp/pylib/gyp/generator/make.py.orig.port	Wed Dec  4 21:56:57 2013
+++ tools/gyp/pylib/gyp/generator/make.py	Thu Dec  5 15:32:45 2013
d22 1
a22 1
@@@@ -268,11 +268,11 @@@@ LINK ?= %(flock)s $(builddir)/linker.lock $(CXX.target
@


1.15
log
@- update to 26.0.1410.43
- switch chromium to use clang/llvm instead of gcc
- switch back to the internal libvpx because it's an unreleased version
  at this point
- re-enable SSE2 support
@
text
@d1 3
a3 3
$OpenBSD$
--- tools/gyp/pylib/gyp/generator/make.py.orig.port	Fri Mar 22 02:16:06 2013
+++ tools/gyp/pylib/gyp/generator/make.py	Tue Apr  2 21:05:18 2013
d13 1
a13 1
@@@@ -182,7 +182,7 @@@@ quiet_cmd_alink = AR($(TOOLSET)) $@@
d22 1
a22 1
@@@@ -272,11 +272,11 @@@@ AR.target ?= $(AR)
@


1.14
log
@update to 24.0.1312.52
@
text
@d1 3
a3 3
$OpenBSD: patch-tools_gyp_pylib_gyp_generator_make_py,v 1.13 2012/11/07 06:59:45 robert Exp $
--- tools/gyp/pylib/gyp/generator/make.py.orig	Tue Jan  8 03:47:29 2013
+++ tools/gyp/pylib/gyp/generator/make.py	Mon Jan 14 20:04:53 2013
@


1.13
log
@update to 23.0.1271.64
@
text
@d1 22
a22 4
$OpenBSD$
--- tools/gyp/pylib/gyp/generator/make.py.orig	Tue Nov  6 22:55:58 2012
+++ tools/gyp/pylib/gyp/generator/make.py	Tue Nov  6 22:56:54 2012
@@@@ -270,11 +270,11 @@@@ ARFLAGS.target ?= %(ARFLAGS.target)s
a34 1
 ARFLAGS.host := %(ARFLAGS.host)s
d36 1
@


1.12
log
@update to 22.0.1229.94
@
text
@d1 4
a4 5
$OpenBSD: patch-tools_gyp_pylib_gyp_generator_make_py,v 1.11 2012/08/26 18:47:01 robert Exp $
--- tools/gyp/pylib/gyp/generator/make.py.orig	Tue Sep 25 15:04:38 2012
+++ tools/gyp/pylib/gyp/generator/make.py	Wed Oct 10 17:19:32 2012
@@@@ -268,13 +268,13 @@@@ ARFLAGS.target ?= %(ARFLAGS.target)s
 # in gyp's make.py where ARFLAGS.host etc. is computed.
d7 1
a7 1
-CC.host ?= gcc
d9 2
a10 1
-CXX.host ?= g++
d12 2
a13 1
-LINK.host ?= g++
a14 6
-AR.host ?= ar
+CC.host ?= $(CC)
+CFLAGS.host ?= $(CFLAGS)
+CXX.host ?= $(CXX)
+CXXFLAGS.host ?= $(CXXFLAGS)
+LINK.host ?= $(LINK)
d16 1
a16 1
+AR.host ?= $(AR)
a18 1
 # Define a dir function that can handle spaces.
@


1.11
log
@update to 21.0.1180.81
@
text
@d1 4
a4 4
$OpenBSD: patch-tools_gyp_pylib_gyp_generator_make_py,v 1.10 2012/07/10 09:22:34 robert Exp $
--- tools/gyp/pylib/gyp/generator/make.py.orig	Tue Aug 14 09:04:19 2012
+++ tools/gyp/pylib/gyp/generator/make.py	Wed Aug 15 23:14:39 2012
@@@@ -270,13 +270,13 @@@@ ARFLAGS.target ?= %(ARFLAGS.target)s
@


1.10
log
@update to 20.0.1132.47
@
text
@d1 4
a4 4
$OpenBSD: patch-tools_gyp_pylib_gyp_generator_make_py,v 1.9 2012/04/03 13:59:35 robert Exp $
--- tools/gyp/pylib/gyp/generator/make.py.orig	Wed May 23 03:52:36 2012
+++ tools/gyp/pylib/gyp/generator/make.py	Fri Jun  1 06:13:04 2012
@@@@ -266,13 +266,13 @@@@ ARFLAGS.target ?= %(ARFLAGS.target)s
@


1.9
log
@update to 18.0.1025.142; requires gcc 4.6 from now on
@
text
@d1 4
a4 4
$OpenBSD: patch-tools_gyp_pylib_gyp_generator_make_py,v 1.8 2012/02/17 10:19:51 robert Exp $
--- tools/gyp/pylib/gyp/generator/make.py.orig	Tue Mar 27 03:04:33 2012
+++ tools/gyp/pylib/gyp/generator/make.py	Sun Apr  1 20:04:45 2012
@@@@ -269,13 +269,13 @@@@ ARFLAGS.target ?= %(ARFLAGS.target)s
@


1.8
log
@update to 17.0.963.56
@
text
@d1 4
a4 4
$OpenBSD: patch-tools_gyp_pylib_gyp_generator_make_py,v 1.7 2011/12/14 16:58:19 robert Exp $
--- tools/gyp/pylib/gyp/generator/make.py.orig	Fri Jan 27 09:04:44 2012
+++ tools/gyp/pylib/gyp/generator/make.py	Thu Feb  9 09:31:06 2012
@@@@ -282,13 +282,13 @@@@ ARFLAGS.target ?= %(ARFLAGS.target)s
@


1.7
log
@update to 16.0.912.63
@
text
@d1 4
a4 4
$OpenBSD: patch-tools_gyp_pylib_gyp_generator_make_py,v 1.6 2011/10/27 07:59:09 robert Exp $
--- tools/gyp/pylib/gyp/generator/make.py.orig	Wed Dec  7 09:04:28 2011
+++ tools/gyp/pylib/gyp/generator/make.py	Tue Dec 13 21:23:12 2011
@@@@ -273,13 +273,13 @@@@ ARFLAGS.target ?= %(ARFLAGS.target)s
@


1.6
log
@update to 15.0.874.102.

switch from using the hacked macosx transport dib to the linux one
which uses sysv shms.
make sure you also have a current kernel before using this version
@
text
@d1 4
a4 4
$OpenBSD: patch-tools_gyp_pylib_gyp_generator_make_py,v 1.5 2011/09/19 08:55:26 robert Exp $
--- tools/gyp/pylib/gyp/generator/make.py.orig	Fri Oct 21 10:49:41 2011
+++ tools/gyp/pylib/gyp/generator/make.py	Wed Oct 26 13:37:47 2011
@@@@ -249,13 +249,13 @@@@ ARFLAGS.target ?= %(ARFLAGS.target)s
@


1.5
log
@update to 14.0.835.163
@
text
@d1 4
a4 4
$OpenBSD$
--- tools/gyp/pylib/gyp/generator/make.py.orig	Wed Sep 14 10:20:05 2011
+++ tools/gyp/pylib/gyp/generator/make.py	Fri Sep 16 18:17:24 2011
@@@@ -239,13 +239,13 @@@@ ARFLAGS.target ?= %(ARFLAGS.target)s
@


1.4
log
@- re-enable flock in the build
- add support for detecting if an sqlite3 db is on an NFS mount
- fix printing: Chrome can only print to PDF and that is why you
  cannot print to LPD directly. It requres CUPS.
@
text
@d1 4
a4 4
$OpenBSD: patch-tools_gyp_pylib_gyp_generator_make_py,v 1.3 2011/04/29 13:18:02 robert Exp $
--- tools/gyp/pylib/gyp/generator/make.py.orig	Fri May 20 10:55:35 2011
+++ tools/gyp/pylib/gyp/generator/make.py	Thu May 26 11:19:24 2011
@@@@ -129,13 +129,13 @@@@ ARFLAGS.target ?= %(ARFLAGS.target)s
d24 1
a24 10
 # Flags to make gcc output dependency info.  Note that you need to be
@@@@ -249,7 +249,7 @@@@ command_changed = $(or $(subst $(cmd_$(1)),,$(cmd_$@@))
 # so we can check their command lines.
 #   $? -- new prerequisites
 #   $| -- order-only dependencies
-prereq_changed = $(filter-out $|,$?)
+prereq_changed = $(filter-out FORCE_DO_CMD $|,$?)
 
 # do_cmd: run a command via the above cmd_foo names, if necessary.
 # Should always run for a given target to handle command-line changes.
@


1.3
log
@update to the latest stable version which is now 11.0.696.60
+ switch from using system sqlite to the bundled one because they have
  many modifications that are needed
+ add a new mirror for the distfile because the google one is utterly slow
@
text
@d1 3
a3 12
$OpenBSD$
--- tools/gyp/pylib/gyp/generator/make.py.orig	Thu Apr 28 15:08:18 2011
+++ tools/gyp/pylib/gyp/generator/make.py	Thu Apr 28 15:40:24 2011
@@@@ -114,7 +114,7 @@@@ all_deps :=
 #   export LINK="$(CXX)"
 #
 # This will allow make to invoke N linker processes as specified in -jN.
-LINK ?= flock $(builddir)/linker.lock $(CXX) %(LINK_flags)s
+LINK ?= $(CXX) %(LINK_flags)s
 
 CC.target ?= $(CC)
 CFLAGS.target ?= $(CFLAGS)
d25 9
@


1.2
log
@late update to chromium 9, robert@@ did the work, but he doesn't have the
time right now.
Tree is still locked!
Reasons for the update:
- good work that can be used now
- only builds on i386/amd64, and they're fast
- multiple security problems in old chrome
- old chrome half working, can't break it more than it was.

This one requires resources (see MESSAGE), but it's ways more stable.

Again, discussed with sthen@@, jasper@@, naddy@@, miod@@
@
text
@d2 3
a4 12
--- tools/gyp/pylib/gyp/generator/make.py.orig	Fri Jan 21 10:29:51 2011
+++ tools/gyp/pylib/gyp/generator/make.py	Sun Jan 23 23:27:37 2011
@@@@ -34,7 +34,7 @@@@ import pprint
 generator_default_variables = {
   'EXECUTABLE_PREFIX': '',
   'EXECUTABLE_SUFFIX': '',
-  'OS': 'linux',
+  'OS': 'openbsd',
   'STATIC_LIB_PREFIX': 'lib',
   'SHARED_LIB_PREFIX': 'lib',
   'STATIC_LIB_SUFFIX': '.a',
@@@@ -106,7 +106,7 @@@@ all_deps :=
d8 2
a9 8
-LINK ?= flock $(builddir)/linker.lock $(CXX)
+LINK ?= $(CXX)
 
 # We want to use GNU ar's T option if available because it's much faster.
 # We try to archive and link a file to see ar and ld support this feature.
@@@@ -147,13 +147,13 @@@@ ifeq ($(ARFLAGS.target),)
   ARFLAGS.target := $(call detect_arflags,target)
 endif
d11 6
d31 3
a33 3
 # See the description for ARFLAGS.target.
 -include $(obj).host/arflags/arflags.mk
 # Temporarily disabled -- see ARFLAGS.target.
@


1.1
log
@cut the "monster patches" into small pieces. pval can fix it to his liking
if he comes back.
In the mean time, fix build of chromium by adding the required
-I/usr/local/includes to gyp glue where needed.
@
text
@d2 2
a3 2
--- tools/gyp/pylib/gyp/generator/make.py.orig	Tue Mar 30 07:25:49 2010
+++ tools/gyp/pylib/gyp/generator/make.py	Sun Nov 28 00:11:32 2010
d9 1
a9 1
+# 'OS': 'linux',
d13 6
a18 25
@@@@ -147,7 +147,7 @@@@ DEPFLAGS = -MMD -MF $(depfile).tmp
 # and dollar signs past make, the shell, and sed at the same time."""
 r"""
 define fixup_dep
-sed -i -e "s|^$(notdir $@@)|$@@|" $(depfile).tmp
+sed -e "s|^$(notdir $@@)|$@@|" $(depfile).tmp > $(depfile).tmp2 && mv $(depfile).tmp2 $(depfile).tmp
 sed -e "s|^[^:]*: *||" -e "s| *\\\\$$||" -e 's|^ *||' \
     -e "/./s|$$|:|" $(depfile).tmp >> $(depfile).tmp
 cat $(depfile).tmp >> $(depfile)
@@@@ -784,12 +784,14 @@@@ class MakefileWriter:
 # CFLAGS et al overrides must be target-local.
 # See "Target-specific Variable Values" in the GNU Make manual.""")
       self.WriteLn("$(OBJS): TOOLSET := $(TOOLSET)")
-      self.WriteLn("$(OBJS): GYP_CFLAGS := $(CFLAGS_$(BUILDTYPE)) "
+      self.WriteLn("$(OBJS): GYP_CFLAGS := $(INCS_$(BUILDTYPE)) "
+                   "$(CFLAGS_$(BUILDTYPE)) "
                    "$(CFLAGS_C_$(BUILDTYPE)) "
-                   "$(DEFS_$(BUILDTYPE)) $(INCS_$(BUILDTYPE))")
-      self.WriteLn("$(OBJS): GYP_CXXFLAGS := $(CFLAGS_$(BUILDTYPE)) "
+                   "$(DEFS_$(BUILDTYPE))")
+      self.WriteLn("$(OBJS): GYP_CXXFLAGS := $(INCS_$(BUILDTYPE)) "
+                   "$(CFLAGS_$(BUILDTYPE)) "
                    "$(CFLAGS_CC_$(BUILDTYPE)) "
-                   "$(DEFS_$(BUILDTYPE)) $(INCS_$(BUILDTYPE))")
+                   "$(DEFS_$(BUILDTYPE))")
d20 5
a24 1
     self.WriteLn()
d26 17
@

