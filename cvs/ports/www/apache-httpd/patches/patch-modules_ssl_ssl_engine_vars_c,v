head	1.3;
access;
symbols
	OPENBSD_6_1:1.3.0.2
	OPENBSD_5_7:1.1.0.4
	OPENBSD_5_7_BASE:1.1
	OPENBSD_5_6:1.1.0.2
	OPENBSD_5_6_BASE:1.1;
locks; strict;
comment	@# @;


1.3
date	2017.07.14.17.04.12;	author sthen;	state Exp;
branches
	1.3.2.1;
next	1.2;
commitid	wQJfYUy8pBAlIj4V;

1.2
date	2015.05.15.08.08.04;	author stsp;	state dead;
branches;
next	1.1;
commitid	Cjn8n79ocvk9kzM0;

1.1
date	2014.07.12.14.11.32;	author pascal;	state Exp;
branches;
next	;
commitid	28tNd3lWvSmxSNXX;

1.3.2.1
date	2017.07.14.18.32.13;	author sthen;	state Exp;
branches;
next	;
commitid	MEbuZd9kS5MbNvBV;


desc
@@


1.3
log
@security update to apache-httpd-2.4.26, from David CARLIER with minor tweaks from me
(2.4.27 to follow)
@
text
@$OpenBSD$

Index: modules/ssl/ssl_engine_vars.c
--- modules/ssl/ssl_engine_vars.c.orig
+++ modules/ssl/ssl_engine_vars.c
@@@@ -529,7 +529,7 @@@@ static char *ssl_var_lookup_ssl_cert(apr_pool_t *p, re
         resdup = FALSE;
     }
     else if (strcEQ(var, "A_SIG")) {
-#if OPENSSL_VERSION_NUMBER < 0x10100000L
+#if OPENSSL_VERSION_NUMBER < 0x10100000L || defined(LIBRESSL_VERSION_NUMBER)
         nid = OBJ_obj2nid((ASN1_OBJECT *)(xs->cert_info->signature->algorithm));
 #else
         const ASN1_OBJECT *paobj;
@@@@ -541,7 +541,7 @@@@ static char *ssl_var_lookup_ssl_cert(apr_pool_t *p, re
         resdup = FALSE;
     }
     else if (strcEQ(var, "A_KEY")) {
-#if OPENSSL_VERSION_NUMBER < 0x10100000L
+#if OPENSSL_VERSION_NUMBER < 0x10100000L || defined(LIBRESSL_VERSION_NUMBER)
         nid = OBJ_obj2nid((ASN1_OBJECT *)(xs->cert_info->key->algor->algorithm));
 #else
         ASN1_OBJECT *paobj;
@


1.3.2.1
log
@MFC security update to Apache httpd-2.4.27

fixed in 2.4.26:

ap_get_basic_auth_pw() Authentication Bypass CVE-2017-3167
mod_ssl Null Pointer Dereference CVE-2017-3169
mod_http2 Null Pointer Dereference CVE-2017-7659
ap_find_token() Buffer Overread CVE-2017-7668
mod_mime Buffer Overread CVE-2017-7679

fixed in 2.4.27:

Read after free in mod_http2 CVE-2017-9789
Uninitialized memory reflection in mod_auth_digest CVE-2017-9788
@
text
@d1 1
a1 1
$OpenBSD: patch-modules_ssl_ssl_engine_vars_c,v 1.3 2017/07/14 17:04:12 sthen Exp $
@


1.2
log
@Update www/apache-httpd to 2.4.12.
Manual configuration updates might be required, see
http://httpd.apache.org/docs/2.4/upgrading.html
MPMs can now be loaded at runtime. The default config keeps using 'prefork'.
Based on an initial diff by claudio@@
ok sthen@@ ajacoutot@@
@
text
@d1 23
a23 12
$OpenBSD: patch-modules_ssl_ssl_engine_vars_c,v 1.1 2014/07/12 14:11:32 pascal Exp $
--- modules/ssl/ssl_engine_vars.c.orig	Sat Jul 12 15:29:38 2014
+++ modules/ssl/ssl_engine_vars.c	Sat Jul 12 15:27:49 2014
@@@@ -832,7 +832,7 @@@@ static char *ssl_var_lookup_ssl_compress_meth(SSL *ssl
 {
     char *result = "NULL";
 #ifdef OPENSSL_VERSION_NUMBER
-#if (OPENSSL_VERSION_NUMBER >= 0x00908000)
+#if (OPENSSL_VERSION_NUMBER >= 0x00908000) && !defined(OPENSSL_NO_COMP)
     SSL_SESSION *pSession = SSL_get_session(ssl);
 
     if (pSession) {
@


1.1
log
@Fix apache after COMP removal.

ok naddy@@
@
text
@d1 1
a1 1
$OpenBSD$
@

