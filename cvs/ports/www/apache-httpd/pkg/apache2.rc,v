head	1.4;
access;
symbols
	OPENBSD_6_0:1.4.0.2
	OPENBSD_6_0_BASE:1.4
	OPENBSD_5_9:1.3.0.2
	OPENBSD_5_9_BASE:1.3
	OPENBSD_5_8:1.3.0.4
	OPENBSD_5_8_BASE:1.3
	OPENBSD_5_7:1.2.0.2
	OPENBSD_5_7_BASE:1.2
	OPENBSD_5_6:1.1.0.2
	OPENBSD_5_6_BASE:1.1;
locks; strict;
comment	@ * @;


1.4
date	2016.06.22.08.27.07;	author ajacoutot;	state Exp;
branches;
next	1.3;
commitid	OkuqA1ME4oqxKjOv;

1.3
date	2015.07.17.23.57.58;	author ajacoutot;	state Exp;
branches;
next	1.2;
commitid	GPN98iERQFsJfE19;

1.2
date	2014.09.17.10.11.08;	author sthen;	state Exp;
branches;
next	1.1;
commitid	jMjJ1XKNkbibLJpK;

1.1
date	2014.07.27.10.51.37;	author kili;	state Exp;
branches;
next	;
commitid	gYt5lPsCZtEp8W4S;


desc
@@


1.4
log
@So, mod_perl will reset $0 to argv[0] which will break the rc.d script
functionality. So let's use apachectl2 for start and stop, disable rc_reload
(which should have been done anyway) and relax the default pexp (workaround).

breakage reported by Michael Lechtermann
ok sthen@@
@
text
@#!/bin/sh
#
# $OpenBSD: apache2.rc,v 1.3 2015/07/17 23:57:58 ajacoutot Exp $

daemon="${TRUEPREFIX}/sbin/httpd2"

. /etc/rc.d/rc.subr

# mod_perl resets $0 to argv[0]
pexp=".*${daemon}.*"
rc_reload=NO

rc_start() {
	${TRUEPREFIX}/sbin/apachectl2 graceful ${daemon_flags}
}

rc_stop() {
	${TRUEPREFIX}/sbin/apachectl2 graceful-stop
}

rc_cmd $1
@


1.3
log
@Move default document root to /var/www to be able to switch between web
servers easily; idea from stsp@@
Split the package into -main and -common (which holds common files for
apache 1 and 2).

discussed with stsp@@ sthen@@
ok stsp@@
@
text
@d3 1
a3 1
# $OpenBSD: apache2.rc,v 1.2 2014/09/17 10:11:08 sthen Exp $
d8 12
@


1.2
log
@apache2 FAKE_AS_ROOT tweak. We currently install suexec2 without setuid
privileges, but the file in the fake directory is mode 4555 owned by the
user building the port, so triggering checks at package creation time
because the plist doesn't have a @@mode 4555 annotation. Change the PLIST
to explicitly install this file as mode 555 (no setuid bit) to allow
packaging to succeed. This commit does not change the mode of the file
installed by the package, users wanting suexec will still need to chmod
it themselves, just allows a FAKE_AS_ROOT=No build to work.

While there, swap some /var for LOCALSTATEDIR.
@
text
@d3 1
a3 1
# $OpenBSD: apache2.rc,v 1.1 2014/07/27 10:51:37 kili Exp $
a7 4

rc_pre() {
	rm -f ${LOCALSTATEDIR}/apache2/logs/{ssl_mutex,httpd.lock,accept.lock}.*
}
@


1.1
log
@Rename rc scripts of apache-httpd to apache resp. apache2 to get rid
of a conflict with base httpd.

ok sthen@@
@
text
@d3 1
a3 1
# $OpenBSD$
d10 1
a10 1
	rm -f /var/apache2/logs/{ssl_mutex,httpd.lock,accept.lock}.*
@

