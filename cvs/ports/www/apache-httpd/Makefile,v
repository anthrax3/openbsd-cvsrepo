head	1.85;
access;
symbols
	OPENBSD_6_2:1.85.0.2
	OPENBSD_6_2_BASE:1.85
	OPENBSD_6_1:1.81.0.2
	OPENBSD_6_1_BASE:1.81
	OPENBSD_6_0:1.80.0.2
	OPENBSD_6_0_BASE:1.80
	OPENBSD_5_9:1.73.0.2
	OPENBSD_5_9_BASE:1.73
	OPENBSD_5_8:1.63.0.4
	OPENBSD_5_8_BASE:1.63
	OPENBSD_5_7:1.56.0.2
	OPENBSD_5_7_BASE:1.56
	OPENBSD_5_6:1.49.0.2
	OPENBSD_5_6_BASE:1.49
	OPENBSD_5_5:1.42.0.2
	OPENBSD_5_5_BASE:1.42
	OPENBSD_5_4:1.38.0.2
	OPENBSD_5_4_BASE:1.38
	OPENBSD_5_3:1.33.0.2
	OPENBSD_5_3_BASE:1.33
	OPENBSD_5_2:1.31.0.2
	OPENBSD_5_2_BASE:1.31
	OPENBSD_5_1_BASE:1.28
	OPENBSD_5_1:1.28.0.2
	OPENBSD_5_0:1.27.0.4
	OPENBSD_5_0_BASE:1.27
	OPENBSD_4_9:1.27.0.2
	OPENBSD_4_9_BASE:1.27
	OPENBSD_4_8:1.23.0.2
	OPENBSD_4_8_BASE:1.23
	OPENBSD_4_7:1.22.0.2
	OPENBSD_4_7_BASE:1.22
	OPENBSD_4_6:1.20.0.2
	OPENBSD_4_6_BASE:1.20
	OPENBSD_4_5:1.18.0.2
	OPENBSD_4_5_BASE:1.18
	OPENBSD_4_4:1.17.0.4
	OPENBSD_4_4_BASE:1.17
	OPENBSD_4_3:1.17.0.2
	OPENBSD_4_3_BASE:1.17
	OPENBSD_4_2:1.14.0.2
	OPENBSD_4_2_BASE:1.14
	OPENBSD_4_1:1.13.0.2
	OPENBSD_4_1_BASE:1.13
	deanna_20061214:1.1.1.1
	deanna:1.1.1;
locks; strict;
comment	@# @;


1.85
date	2017.09.18.19.25.38;	author sthen;	state Exp;
branches;
next	1.84;
commitid	D38PYL5XdqrsZ4uO;

1.84
date	2017.07.14.17.14.33;	author sthen;	state Exp;
branches;
next	1.83;
commitid	c0kyihch7ULMQHfn;

1.83
date	2017.07.14.17.06.51;	author sthen;	state Exp;
branches;
next	1.82;
commitid	jgutiHdwCEXTF0BY;

1.82
date	2017.07.14.17.04.12;	author sthen;	state Exp;
branches;
next	1.81;
commitid	wQJfYUy8pBAlIj4V;

1.81
date	2017.03.17.07.36.35;	author sthen;	state Exp;
branches
	1.81.2.1;
next	1.80;
commitid	EpVFwhilOQoj8lKc;

1.80
date	2016.07.05.14.32.16;	author sthen;	state Exp;
branches
	1.80.2.1;
next	1.79;
commitid	NFC1Zt2sUj0stdOV;

1.79
date	2016.06.22.18.52.16;	author ajacoutot;	state Exp;
branches;
next	1.78;
commitid	ehmnM0DAdFx4p8zn;

1.78
date	2016.06.22.08.27.07;	author ajacoutot;	state Exp;
branches;
next	1.77;
commitid	OkuqA1ME4oqxKjOv;

1.77
date	2016.04.28.18.22.17;	author sthen;	state Exp;
branches;
next	1.76;
commitid	GxsBypdYAnhW1QO5;

1.76
date	2016.04.28.08.51.35;	author sthen;	state Exp;
branches;
next	1.75;
commitid	gYI7ocwkWnDau3UG;

1.75
date	2016.04.28.08.40.42;	author ajacoutot;	state Exp;
branches;
next	1.74;
commitid	jUDwPLA0g5IZVyKV;

1.74
date	2016.03.18.21.38.26;	author naddy;	state Exp;
branches;
next	1.73;
commitid	BVkebQSTXSZokeRG;

1.73
date	2016.01.15.23.40.02;	author sthen;	state Exp;
branches;
next	1.72;
commitid	HjoOmyGiLBNyN5r6;

1.72
date	2015.12.30.09.59.31;	author ajacoutot;	state Exp;
branches;
next	1.71;
commitid	wB4m51AfVi6CCjBs;

1.71
date	2015.12.23.14.51.55;	author ajacoutot;	state Exp;
branches;
next	1.70;
commitid	1ctPmckWxZ38o0Jc;

1.70
date	2015.12.01.16.45.30;	author sthen;	state Exp;
branches;
next	1.69;
commitid	OlvY0EFtOJ2zF5a7;

1.69
date	2015.10.27.18.18.17;	author sthen;	state Exp;
branches;
next	1.68;
commitid	MeULVXlNLekuQ4rD;

1.68
date	2015.10.24.12.17.50;	author claudio;	state Exp;
branches;
next	1.67;
commitid	H8AuLqypbb8LVKa1;

1.67
date	2015.09.13.12.37.49;	author sthen;	state Exp;
branches;
next	1.66;
commitid	ym2dZ9lxiQqGnZXv;

1.66
date	2015.09.13.12.31.45;	author sthen;	state Exp;
branches;
next	1.65;
commitid	t0D4ENDlq7aA4rxf;

1.65
date	2015.09.10.10.30.04;	author ajacoutot;	state Exp;
branches;
next	1.64;
commitid	GWAQFh2zndidRws7;

1.64
date	2015.09.07.06.32.04;	author jca;	state Exp;
branches;
next	1.63;
commitid	5ogtUgOwW6unctDY;

1.63
date	2015.07.18.20.01.13;	author ajacoutot;	state Exp;
branches
	1.63.4.1;
next	1.62;
commitid	0Igiuiscr0bLoZ2X;

1.62
date	2015.07.18.01.11.40;	author sthen;	state Exp;
branches;
next	1.61;
commitid	AK1iMNe7xa8qt4Yh;

1.61
date	2015.07.18.00.55.09;	author ajacoutot;	state Exp;
branches;
next	1.60;
commitid	n0As3qyb8zPdwoae;

1.60
date	2015.07.18.00.33.53;	author ajacoutot;	state Exp;
branches;
next	1.59;
commitid	d57HLtwucZxWtNBw;

1.59
date	2015.07.17.23.57.58;	author ajacoutot;	state Exp;
branches;
next	1.58;
commitid	GPN98iERQFsJfE19;

1.58
date	2015.07.17.19.52.06;	author ajacoutot;	state Exp;
branches;
next	1.57;
commitid	We6LF8U3Bg9wKnNA;

1.57
date	2015.05.15.08.08.03;	author stsp;	state Exp;
branches;
next	1.56;
commitid	Cjn8n79ocvk9kzM0;

1.56
date	2015.02.16.22.57.13;	author naddy;	state Exp;
branches;
next	1.55;
commitid	0dx3c9ckf7dE4tx1;

1.55
date	2015.02.06.15.19.01;	author sthen;	state Exp;
branches;
next	1.54;
commitid	YTJImkIah47WtyUb;

1.54
date	2014.11.04.21.46.55;	author sthen;	state Exp;
branches;
next	1.53;
commitid	lksSOgvRAuZUygH8;

1.53
date	2014.10.02.17.13.28;	author sthen;	state Exp;
branches;
next	1.52;
commitid	RBR2QXTZTPaJWNb0;

1.52
date	2014.09.17.10.11.08;	author sthen;	state Exp;
branches;
next	1.51;
commitid	jMjJ1XKNkbibLJpK;

1.51
date	2014.09.16.09.07.03;	author espie;	state Exp;
branches;
next	1.50;
commitid	RMOje3pTBXZOKU4I;

1.50
date	2014.09.09.10.08.23;	author stsp;	state Exp;
branches;
next	1.49;
commitid	rSLQnTNhCpHnXv6B;

1.49
date	2014.07.27.10.51.37;	author kili;	state Exp;
branches;
next	1.48;
commitid	gYt5lPsCZtEp8W4S;

1.48
date	2014.07.16.14.41.19;	author sthen;	state Exp;
branches;
next	1.47;
commitid	Vrb7am88dZrdaKjX;

1.47
date	2014.07.12.14.11.32;	author pascal;	state Exp;
branches;
next	1.46;
commitid	28tNd3lWvSmxSNXX;

1.46
date	2014.04.27.19.15.43;	author stsp;	state Exp;
branches;
next	1.45;

1.45
date	2014.04.21.22.47.07;	author ajacoutot;	state Exp;
branches;
next	1.44;

1.44
date	2014.04.09.22.11.32;	author stsp;	state Exp;
branches;
next	1.43;

1.43
date	2014.03.09.20.57.40;	author sthen;	state Exp;
branches;
next	1.42;

1.42
date	2013.12.01.02.58.30;	author brad;	state Exp;
branches
	1.42.2.1;
next	1.41;

1.41
date	2013.11.25.17.00.47;	author stsp;	state Exp;
branches;
next	1.40;

1.40
date	2013.10.17.14.05.41;	author stsp;	state Exp;
branches;
next	1.39;

1.39
date	2013.10.09.12.54.16;	author stsp;	state Exp;
branches;
next	1.38;

1.38
date	2013.07.12.13.21.25;	author stsp;	state Exp;
branches
	1.38.2.1;
next	1.37;

1.37
date	2013.06.20.06.54.37;	author ajacoutot;	state Exp;
branches;
next	1.36;

1.36
date	2013.06.17.19.28.37;	author ajacoutot;	state Exp;
branches;
next	1.35;

1.35
date	2013.03.21.08.48.55;	author ajacoutot;	state Exp;
branches;
next	1.34;

1.34
date	2013.03.11.11.44.41;	author espie;	state Exp;
branches;
next	1.33;

1.33
date	2013.02.09.14.49.53;	author sthen;	state Exp;
branches
	1.33.2.1;
next	1.32;

1.32
date	2012.10.18.08.12.16;	author giovanni;	state Exp;
branches;
next	1.31;

1.31
date	2012.07.18.08.45.42;	author sthen;	state Exp;
branches
	1.31.2.1;
next	1.30;

1.30
date	2012.04.28.09.54.44;	author stsp;	state Exp;
branches;
next	1.29;

1.29
date	2012.02.17.08.33.03;	author ajacoutot;	state Exp;
branches;
next	1.28;

1.28
date	2011.09.01.13.40.09;	author giovanni;	state Exp;
branches;
next	1.27;

1.27
date	2011.02.12.21.05.38;	author pea;	state Exp;
branches;
next	1.26;

1.26
date	2010.11.22.08.36.47;	author espie;	state Exp;
branches;
next	1.25;

1.25
date	2010.11.11.12.35.09;	author sthen;	state Exp;
branches;
next	1.24;

1.24
date	2010.10.19.08.02.53;	author espie;	state Exp;
branches;
next	1.23;

1.23
date	2010.06.27.17.27.03;	author robert;	state Exp;
branches;
next	1.22;

1.22
date	2009.12.01.13.38.23;	author bernd;	state Exp;
branches;
next	1.21;

1.21
date	2009.08.30.18.06.07;	author fkr;	state Exp;
branches;
next	1.20;

1.20
date	2009.05.15.15.46.58;	author claudio;	state Exp;
branches
	1.20.2.1;
next	1.19;

1.19
date	2009.04.09.18.36.00;	author bernd;	state Exp;
branches;
next	1.18;

1.18
date	2008.09.02.22.05.23;	author bernd;	state Exp;
branches
	1.18.2.1;
next	1.17;

1.17
date	2008.01.28.19.48.47;	author bernd;	state Exp;
branches;
next	1.16;

1.16
date	2007.09.19.05.47.36;	author steven;	state Exp;
branches;
next	1.15;

1.15
date	2007.09.06.07.33.53;	author merdely;	state Exp;
branches;
next	1.14;

1.14
date	2007.03.25.17.40.55;	author deanna;	state Exp;
branches;
next	1.13;

1.13
date	2007.01.16.01.12.26;	author deanna;	state Exp;
branches;
next	1.12;

1.12
date	2007.01.09.11.18.13;	author dlg;	state Exp;
branches;
next	1.11;

1.11
date	2007.01.09.10.47.37;	author dlg;	state Exp;
branches;
next	1.10;

1.10
date	2007.01.09.09.56.57;	author dlg;	state Exp;
branches;
next	1.9;

1.9
date	2007.01.05.22.57.11;	author dlg;	state Exp;
branches;
next	1.8;

1.8
date	2007.01.05.22.22.04;	author dlg;	state Exp;
branches;
next	1.7;

1.7
date	2006.12.25.20.40.02;	author deanna;	state Exp;
branches;
next	1.6;

1.6
date	2006.12.16.00.41.56;	author deanna;	state Exp;
branches;
next	1.5;

1.5
date	2006.12.14.11.20.22;	author steven;	state Exp;
branches;
next	1.4;

1.4
date	2006.12.14.10.22.03;	author steven;	state Exp;
branches;
next	1.3;

1.3
date	2006.12.14.09.50.25;	author steven;	state Exp;
branches;
next	1.2;

1.2
date	2006.12.14.09.31.56;	author espie;	state Exp;
branches;
next	1.1;

1.1
date	2006.12.14.07.14.20;	author deanna;	state Exp;
branches
	1.1.1.1;
next	;

1.1.1.1
date	2006.12.14.07.14.20;	author deanna;	state Exp;
branches;
next	;

1.18.2.1
date	2009.06.28.03.03.09;	author william;	state Exp;
branches;
next	1.18.2.2;

1.18.2.2
date	2009.09.15.02.27.53;	author william;	state Exp;
branches;
next	;

1.20.2.1
date	2009.10.25.03.34.26;	author william;	state Exp;
branches;
next	1.20.2.2;

1.20.2.2
date	2009.12.09.01.01.55;	author william;	state Exp;
branches;
next	;

1.31.2.1
date	2012.11.06.16.24.11;	author giovanni;	state Exp;
branches;
next	;

1.33.2.1
date	2013.07.15.07.48.48;	author sthen;	state Exp;
branches;
next	;

1.38.2.1
date	2014.04.12.16.39.34;	author stsp;	state Exp;
branches;
next	;

1.42.2.1
date	2014.04.12.16.40.26;	author stsp;	state Exp;
branches;
next	;

1.63.4.1
date	2015.10.24.16.41.37;	author sthen;	state Exp;
branches;
next	;
commitid	CaCLRJD4W0lC1G1J;

1.80.2.1
date	2017.03.27.15.04.24;	author pirofti;	state Exp;
branches;
next	;
commitid	dUe3XnsmP7jvE5rG;

1.81.2.1
date	2017.07.14.18.31.32;	author sthen;	state Exp;
branches;
next	1.81.2.2;
commitid	P9GRWa0c67xX1b6I;

1.81.2.2
date	2017.09.18.19.27.17;	author sthen;	state Exp;
branches;
next	;
commitid	ptpamFTHHMKlOm61;


desc
@@


1.85
log
@patch apache httpd CVE-2017-9798, backported from upstream's branches/2.4.x

This is a use after free error that causes a corrupted Allow header to
be constructed in response to HTTP OPTIONS requests. It can leak pieces
of arbitrary memory from the server process that may contain secrets.
The memory pieces change after multiple requests, so for a vulnerable
host an arbitrary number of memory chunks can be leaked.

The bug appears if a webmaster tries to use the "Limit" directive with
an invalid HTTP method.
@
text
@# $OpenBSD: Makefile,v 1.84 2017/07/14 17:14:33 sthen Exp $

COMMENT-main=		apache HTTP server
COMMENT-common=		/var/www files for Apache HTTPd

V=			2.4.27
REVISION-main=		0
DISTNAME=		httpd-${V}
PKGNAME=		apache-httpd-${V}

PKGNAME-main=		${PKGNAME}
FULLPKGNAME-common=	apache-httpd-common-${V}
FULLPKGPATH-common=	www/apache-httpd,-common

CATEGORIES=		www net

HOMEPAGE=		http://httpd.apache.org/

# Apache 2.0
PERMIT_PACKAGE_CDROM=	Yes

WANTLIB-main += apr-1 aprutil-1 c crypto db expat iconv
WANTLIB-main += lzma m nghttp2 pcre pthread ssl xml2 z

MASTER_SITES=		${MASTER_SITE_APACHE:=httpd/}

NO_TEST=		Yes

MULTI_PACKAGES=		-main -common

RUN_DEPENDS-main=	www/apache-httpd,-common

LIB_DEPENDS-main=	archivers/xz \
			devel/pcre \
			textproc/libxml \
			www/nghttp2

WANTLIB-common=		# empty
LIB_DEPENDS-common=	# empty

HTTPD_DIR=		/var/www
CONFDIR=		${SYSCONFDIR}/apache2
FLAVOR_COMMA=		${FLAVOR_EXT:S/-/,/g}
SUBST_VARS=		CONFDIR FLAVOR_COMMA
PREFIX-common=		/var/www

CONFIGURE_STYLE=	simple
CONFIGURE_ARGS=		--enable-layout=OpenBSD \
			--prefix=${HTTPD_DIR} \
			--exec-prefix=${LOCALBASE} \
			--sysconfdir=${CONFDIR} \
			--with-apr=${LOCALBASE}/bin/apr-1-config  \
			--with-apr-util=${LOCALBASE}/bin/apu-1-config \
			--enable-ssl --with-ssl=/usr \
			--enable-mpms-shared=all \
			--with-mpm=prefork \
			--with-program-name=httpd2 \
			--enable-modules=all \
			--enable-cache \
			--enable-disk-cache \
			--enable-http2 \
			--enable-proxy=shared \
			--enable-proxy-fdpass \
			--enable-mods-shared=all \
			--enable-cgi \
			--enable-suexec \
			--with-suexec-caller=www \
			--with-suexec-bin=${TRUEPREFIX}/sbin/suexec2 \
			--with-suexec-logfile=${LOCALSTATEDIR}/log/suexec2_log \
			--with-pcre=${LOCALBASE}

CONFIGURE_ENV=		CPPFLAGS="-I${LOCALBASE}/include" \
			LDFLAGS="-L${LOCALBASE}/lib" \
			AWK=awk

FAKE_FLAGS=		rel_user=www rel_group=www \
			rel_datadir=${HTTPD_DIR} \
			datadir=${PREFIX}/share/examples/apache2 \
			sysconfdir=${PREFIX}/share/examples/apache2/conf

FLAVORS=		ldap
FLAVOR?=

.if ${FLAVOR:Mldap}
CONFIGURE_ARGS+=	--with-ldap --enable-ldap --enable-authnz-ldap
WANTLIB-main +=		lber-2.4 ldap-2.4 sasl2
LIB_DEPENDS-main+=	databases/openldap
LIB_DEPENDS-main+=	apr-util-*-ldap:devel/apr-util,ldap
.else
LIB_DEPENDS-main+=	apr-util-*-!ldap:devel/apr-util
.endif

A2BIN=			apxs logresolve dbmmanage htdigest htpasswd
A2SBIN=			apachectl rotatelogs suexec
A2MAN1=			dbmmanage apxs htdigest htpasswd logresolve
A2MAN8=			apachectl httpd rotatelogs suexec

pre-configure:
	sed -i 's,%%PREFIX%%,${PREFIX},' ${WRKSRC}/config.layout
	sed -i 's,%%CONFDIR%%,${CONFDIR},' ${WRKSRC}/config.layout \
		${WRKSRC}/configure
	sed -i 's,%%PREFIX%%,${PREFIX},g' ${WRKSRC}/support/apxs.in

post-install:
	chown -R ${SHAREOWN}:${SHAREGRP} ${PREFIX}/share
	chown -R ${MANOWN}:${MANGRP} ${PREFIX}/man
	chown -R ${BINOWN}:${BINGRP} ${PREFIX}/bin
	chown -R ${BINOWN}:${BINGRP} ${PREFIX}/sbin
	chown -R ${LIBOWN}:${LIBGRP} ${PREFIX}/lib
	rmdir ${PREFIX}/share/examples/apache2/logs

	# -common
	${INSTALL_DATA_DIR} ${WRKINST}${PREFIX-common}/cgi-bin
	mv ${PREFIX}/share/examples/apache2/cgi-bin/{printenv,test-cgi} \
		${WRKINST}${PREFIX-common}/cgi-bin/
	mv ${PREFIX}/share/examples/apache2/icons \
		${WRKINST}${PREFIX-common}/

.for i in ${A2MAN1}
	mv ${PREFIX}/man/man1/${i}.1 ${PREFIX}/man/man1/${i}2.1
.endfor

.for i in ${A2MAN8}
	mv ${PREFIX}/man/man8/${i}.8 ${PREFIX}/man/man8/${i}2.8
.endfor

.for i in ${A2BIN}
	mv ${PREFIX}/bin/${i} ${PREFIX}/bin/${i}2
.endfor
	mv ${PREFIX}/bin/apxs2 ${PREFIX}/sbin # other ports expect it in sbin/

.for i in ${A2SBIN}
	mv ${PREFIX}/sbin/${i} ${PREFIX}/sbin/${i}2
.endfor

.if ${FLAVOR:Mldap}
	${INSTALL_DATA_DIR} ${PREFIX}/share/doc/ap2-mod_auth_ldap
.for i in mod_ldap.html mod_authnz_ldap.html.en \
	mod_authnz_ldap.html mod_ldap.html.en
	${INSTALL_DATA} ${WRKSRC}/docs/manual/mod/${i} \
		${PREFIX}/share/doc/ap2-mod_auth_ldap/
.endfor
.endif

.include <bsd.port.mk>
@


1.84
log
@update to httpd-2.4.27
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.83 2017/07/14 17:06:51 sthen Exp $
d7 1
@


1.83
log
@oops, reinstate a line i dropped by mistake
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.82 2017/07/14 17:04:12 sthen Exp $
d6 1
a6 1
V=			2.4.26
@


1.82
log
@security update to apache-httpd-2.4.26, from David CARLIER with minor tweaks from me
(2.4.27 to follow)
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.81 2017/03/17 07:36:35 sthen Exp $
d4 1
@


1.81
log
@update to apache-httpd-2.4.25
CVE-2016-8740 CVE-2016-5387 CVE-2016-2161 CVE-2016-0736 CVE-2016-8743
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.80 2016/07/05 14:32:16 sthen Exp $
a3 1
COMMENT-common=		/var/www files for Apache HTTPd
d5 1
a5 1
V=			2.4.25
@


1.81.2.1
log
@MFC security update to Apache httpd-2.4.27

fixed in 2.4.26:

ap_get_basic_auth_pw() Authentication Bypass CVE-2017-3167
mod_ssl Null Pointer Dereference CVE-2017-3169
mod_http2 Null Pointer Dereference CVE-2017-7659
ap_find_token() Buffer Overread CVE-2017-7668
mod_mime Buffer Overread CVE-2017-7679

fixed in 2.4.27:

Read after free in mod_http2 CVE-2017-9789
Uninitialized memory reflection in mod_auth_digest CVE-2017-9788
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.84 2017/07/14 17:14:33 sthen Exp $
d6 1
a6 1
V=			2.4.27
@


1.81.2.2
log
@patch apache httpd CVE-2017-9798, backported from upstream's branches/2.4.x

This is a use after free error that causes a corrupted Allow header to
be constructed in response to HTTP OPTIONS requests. It can leak pieces
of arbitrary memory from the server process that may contain secrets.
The memory pieces change after multiple requests, so for a vulnerable
host an arbitrary number of memory chunks can be leaked.

The bug appears if a webmaster tries to use the "Limit" directive with
an invalid HTTP method.
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.85 2017/09/18 19:25:38 sthen Exp $
a6 1
REVISION-main=		0
@


1.80
log
@update to apache-httpd 2.4.23, ok ajacoutot
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.79 2016/06/22 18:52:16 ajacoutot Exp $
d6 1
a6 1
V=			2.4.23
@


1.80.2.1
log
@Backport Apache CVE fixes from sthen@@.

%--------------------------------------------------------------------
 [PATCH] update to apache-httpd-2.4.25 CVE-2016-8740 CVE-2016-5387
 CVE-2016-2161 CVE-2016-0736 CVE-2016-8743
%--------------------------------------------------------------------

OK robert@@
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.81 2017/03/17 07:36:35 sthen Exp $
d6 1
a6 1
V=			2.4.25
@


1.79
log
@Properly bump REVISION.

spotted by Markus Lude
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.78 2016/06/22 08:27:07 ajacoutot Exp $
d6 1
a6 1
V=			2.4.20
a13 3
REVISION-main=		2
REVISION-common=	1

d62 1
@


1.78
log
@So, mod_perl will reset $0 to argv[0] which will break the rc.d script
functionality. So let's use apachectl2 for start and stop, disable rc_reload
(which should have been done anyway) and relax the default pexp (workaround).

breakage reported by Michael Lechtermann
ok sthen@@
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.77 2016/04/28 18:22:17 sthen Exp $
a6 1
REVISION=		1
d14 2
a15 1
REVISION-main=		0
@


1.77
log
@replace apache-httpd-openbsd, keeping -common separate for now to avoid pain
with PLISTs
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.76 2016/04/28 08:51:35 sthen Exp $
d14 2
@


1.76
log
@http2 works here now, so enable it
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.75 2016/04/28 08:40:42 ajacoutot Exp $
d4 1
a4 1
COMMENT-common=		shared files for Apache 1 and 2
d7 1
a7 1
REVISION-main=		0
@


1.75
log
@Update to apache-httpd-2.4.20.
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.74 2016/03/18 21:38:26 naddy Exp $
d7 1
d23 1
a23 1
WANTLIB-main += lzma m pcre pthread ssl xml2 z
d36 1
d61 1
a69 2
# doesn't work correctly on OpenBSD yet
CONFIGURE_ARGS+=	--disable-http2
@


1.74
log
@remove SHARED_ONLY from simple ports that use the gettext or libiconv module
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.73 2016/01/15 23:40:02 sthen Exp $
d6 1
a6 1
V=			2.4.18
a12 1
REVISION-main=		1
d21 2
a22 3
WANTLIB-main += ${WANTLIB}
WANTLIB-main += apr-1 aprutil-1 c crypto db expat lzma m
WANTLIB-main += pcre pthread ssl xml2 z
a25 2
MODULES=		converters/libiconv

d32 1
a32 2
LIB_DEPENDS-main=	${LIB_DEPENDS} \
			archivers/xz \
d36 1
a36 1
WANTLIB-common=		#empty
d84 1
a84 1
WANTLIB+=		lber-2.4 ldap-2.4 sasl2
@


1.73
log
@Disable Apache httpd's mod_http2.so for now, as reported by
Pedro de Oliveira it isn't working on OpenBSD yet.
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.72 2015/12/30 09:59:31 ajacoutot Exp $
a29 1
SHARED_ONLY=		Yes
@


1.72
log
@Don't sample /var/www/conf/modules.samples/, let webapps do that.
Optionaly include /var/www/conf/modules/*.conf instead of /etc/apache2/modules/*.conf,
this allows the usual MESSAGE linking from modules.samples/ to modules/ to work
out-of-the-box.

ok sthen@@
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.71 2015/12/23 14:51:55 ajacoutot Exp $
d13 1
a13 1
REVISION-main=		0
d23 1
a23 1
WANTLIB-main += apr-1 aprutil-1 c crypto db expat lzma m nghttp2
a40 1
			www/nghttp2
d73 2
@


1.71
log
@Update to apache-httpd-2.4.18.
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.70 2015/12/01 16:45:30 sthen Exp $
d13 1
@


1.70
log
@As found by ajacoutot, nghttp2 was getting picked up by httpd's autoconf;
make it an explicit dependency and package mod_http2.
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.69 2015/10/27 18:18:17 sthen Exp $
d6 1
a6 2
V=			2.4.17
REVISION-main=		0
d101 2
a102 2
	perl -pi -e 's,%%PREFIX%%,${PREFIX},' ${WRKSRC}/config.layout
	perl -pi -e 's,%%CONFDIR%%,${CONFDIR},' ${WRKSRC}/config.layout \
d104 1
a104 1
	perl -pi -e 's,%%PREFIX%%,${PREFIX},g' ${WRKSRC}/support/apxs.in
@


1.69
log
@update to apache-httpd-2.4.17, and add scaffolding to use the same type of
modules.sample mechanism as apache-httpd-openbsd
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.68 2015/10/24 12:17:50 claudio Exp $
d7 1
d23 2
a24 2
WANTLIB-main += apr-1 aprutil-1 c crypto db expat lzma m pcre pthread
WANTLIB-main += ssl xml2 z
d40 2
a41 1
			textproc/libxml
@


1.68
log
@Make sure mod_cgi and mod_cgid are built and installed. Depending if apache
is prefork or threaded one or the other needs to be used to allow CGI handling.
For fast cgi mod_proxy_fcgi should be used.
OK sthen@@ tested by Alessandro DE LAURENZIS
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.67 2015/09/13 12:37:49 sthen Exp $
d6 1
a6 1
V=			2.4.16
a12 2

REVISION-main=		5
@


1.67
log
@fix miscommit that removed @@rcscript (thanks, update-plist!)
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.66 2015/09/13 12:31:45 sthen Exp $
d14 1
a14 1
REVISION-main=		4
d68 1
@


1.66
log
@Move to improved version of no_ssl3 patch for apache-httpd, thanks to
Kaspar Brand (https://bz.apache.org/bugzilla/show_bug.cgi?id=58349)
- small tweak from Kaspar's patch for 2.4 backport.
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.65 2015/09/10 10:30:04 ajacoutot Exp $
d14 1
a14 1
REVISION-main=		3
@


1.65
log
@Do not pick up gawk.
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.64 2015/09/07 06:32:04 jca Exp $
d14 1
a14 1
REVISION-main=		2
@


1.64
log
@Guard use of SSLv3*method.  Die if SSLv3 forced in conf but unavail.

Fixes "undefined symbol" errors at dlopen time.

Reported by Pedro de Oliveira, ok sthen@@
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.63 2015/07/18 20:01:13 ajacoutot Exp $
d75 2
a76 1
			LDFLAGS="-L${LOCALBASE}/lib"
@


1.63
log
@Don't own /var/www/htdocs/, it's part of mtree.
Don't ship the empty example logs directory.
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.62 2015/07/18 01:11:40 sthen Exp $
d14 1
a14 1
REVISION-main=		1
@


1.63.4.1
log
@sync Apache httpd in 5.8-stable with -current:

- build mod_cgi.so, for CGI use with the default prefork mpm

- install mod_cgid.so (it was already built but not installed),
for CGI use with optional multi-threaded mpm

- add patches to guard SSLv3 (not required for 5.8 but doesn't hurt,
and simplifies any future syncs)
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.68 2015/10/24 12:17:50 claudio Exp $
d14 1
a14 1
REVISION-main=		5
a67 1
			--enable-cgi \
d75 1
a75 2
			LDFLAGS="-L${LOCALBASE}/lib" \
			AWK=awk
@


1.62
log
@adjust @@pkgpath depending on flavour, so updates for apache-httpd--ldap work
correctly. (in reality this wasn't a big problem as we don't build the ldap
flavoured version in bulk builds anyway, due to dependence on conflicting
versions of apr-util).
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.61 2015/07/18 00:55:09 ajacoutot Exp $
a6 1
REVISION-main=		0
d14 2
d111 1
@


1.61
log
@Update to apache-httpd-2.4.16.

ok sthen@@
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.60 2015/07/18 00:33:53 ajacoutot Exp $
d7 1
a30 1
USE_GROFF =		Yes
d47 2
a48 1
SUBST_VARS=		CONFDIR
@


1.60
log
@Cleanup.
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.59 2015/07/17 23:57:58 ajacoutot Exp $
d6 1
a6 1
V=			2.4.12
d8 1
d10 1
a10 1
PKGNAME-main=		apache-httpd-${V}
a12 3

REVISION-main=		2
REVISION-common=	0
@


1.59
log
@Move default document root to /var/www to be able to switch between web
servers easily; idea from stsp@@
Split the package into -main and -common (which holds common files for
apache 1 and 2).

discussed with stsp@@ sthen@@
ok stsp@@
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.58 2015/07/17 19:52:06 ajacoutot Exp $
d3 2
a4 2
COMMENT-main=	apache HTTP server
COMMENT-common=	shared files for Apache 1 and 2
d6 2
a7 2
V=		2.4.12
DISTNAME=	httpd-${V}
d9 1
a9 1
PKGNAME-main=	apache-httpd-${V}
d13 2
a14 1
REVISION-main=	1
d16 1
a16 1
CATEGORIES=	www net
d18 1
a18 1
HOMEPAGE=	http://httpd.apache.org/
d27 4
a46 16
FLAVORS=		ldap
FLAVOR?=

.if ${FLAVOR:Mldap}
CONFIGURE_ARGS+=	--with-ldap --enable-ldap --enable-authnz-ldap
WANTLIB+=		lber-2.4 ldap-2.4 sasl2
LIB_DEPENDS-main+=	databases/openldap
LIB_DEPENDS-main+=	apr-util-*-ldap:devel/apr-util,ldap
.else
LIB_DEPENDS-main+=	apr-util-*-!ldap:devel/apr-util
.endif

MODULES=		converters/libiconv

MASTER_SITES=		${MASTER_SITE_APACHE:=httpd/}

a49 1

d53 1
a53 1
CONFIGURE_ARGS+=	--enable-layout=OpenBSD \
d74 1
a74 1
CONFIGURE_ENV+=		CPPFLAGS="-I${LOCALBASE}/include" \
d77 1
a77 1
FAKE_FLAGS+=		rel_user=www rel_group=www \
d82 12
d100 4
a103 4
	@@perl -pi -e 's,%%PREFIX%%,${PREFIX},' ${WRKSRC}/config.layout
	@@perl -pi -e 's,%%CONFDIR%%,${CONFDIR},' ${WRKSRC}/config.layout \
	${WRKSRC}/configure
	@@perl -pi -e 's,%%PREFIX%%,${PREFIX},g' ${WRKSRC}/support/apxs.in
d112 4
@


1.58
log
@Change the default user to "www".
This makes it easier to switch from one web server to the other.

discussed with stsp@@ sthen@@
ok sthen@@
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.57 2015/05/15 08:08:03 stsp Exp $
d3 2
a4 1
COMMENT=	apache HTTP server
a6 1
PKGNAME=	apache-httpd-${V}
d8 6
a13 1
REVISION=	0
d22 4
d30 3
a32 2
WANTLIB += c crypto m ssl expat apr-1 db>=4 z lzma pcre pthread aprutil-1>=2 \
	xml2
d34 2
a35 1
LIB_DEPENDS=		archivers/xz \
d39 3
d48 2
a49 2
LIB_DEPENDS+=		databases/openldap
LIB_DEPENDS+=		apr-util-*-ldap:devel/apr-util,ldap
d51 1
a51 1
LIB_DEPENDS+=		apr-util-*-!ldap:devel/apr-util
a55 1

d58 1
a58 1
HTTPD_DIR=		${LOCALSTATEDIR}/apache2
d62 2
d111 3
@


1.57
log
@Update www/apache-httpd to 2.4.12.
Manual configuration updates might be required, see
http://httpd.apache.org/docs/2.4/upgrading.html
MPMs can now be loaded at runtime. The default config keeps using 'prefork'.
Based on an initial diff by claudio@@
ok sthen@@ ajacoutot@@
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.54 2014/11/04 21:46:55 sthen Exp $
d8 1
d66 1
a66 1
			--with-suexec-caller=_apache2 \
d74 1
a74 1
FAKE_FLAGS+=		rel_user=_apache2 rel_group=_apache2 \
@


1.56
log
@Drop USE_GROFF from ports where the formatting differences are acceptable
or mandoc provides the more useful output.
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.55 2015/02/06 15:19:01 sthen Exp $
d5 1
a5 2
V=		2.2.29
REVISION=	3
d17 1
d20 2
a21 1
WANTLIB += c crypto m ssl expat apr-1 db>=4 z pcre pthread aprutil-1>=2
d23 3
a25 1
LIB_DEPENDS=		devel/pcre
d56 1
d62 1
a62 1
			--enable-proxy \
d78 4
a81 4
A2SBIN=			apachectl apxs dbmmanage htdigest htpasswd \
			logresolve rotatelogs suexec
A2MAN1=			dbmmanage htdigest htpasswd
A2MAN8=			apachectl apxs httpd logresolve rotatelogs suexec
d92 1
d103 5
@


1.55
log
@Drop some patches; libressl renamed SSL_CTX_use_certificate_chain to
SSL_CTX_use_certificate_chain_mem (libssl/src/ssl/ssl.h r1.79 et al) so
this no longer conflicts.
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.54 2014/11/04 21:46:55 sthen Exp $
a17 1
USE_GROFF =		Yes
@


1.54
log
@sync WANTLIB to fix the -ldap flavour, as found by Joe Price
(missed during the heimdal removal because this isn't linked to the build
to avoid conflicting dependencies on apr-util and apr-util--ldap by
different ports in the tree).
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.53 2014/10/02 17:13:28 sthen Exp $
d6 1
a6 1
REVISION=	2
@


1.53
log
@rename mod_ssl's (very old) internal function, SSL_CTX_use_certificate_chain,
because a function with the same name was added to libressl recently.

unbreaks 130-odd ports.
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.52 2014/09/17 10:11:08 sthen Exp $
d6 1
a6 1
REVISION=	1
d30 1
a30 1
WANTLIB+=		heimbase lber-2.4 ldap-2.4 sasl2
@


1.52
log
@apache2 FAKE_AS_ROOT tweak. We currently install suexec2 without setuid
privileges, but the file in the fake directory is mode 4555 owned by the
user building the port, so triggering checks at package creation time
because the plist doesn't have a @@mode 4555 annotation. Change the PLIST
to explicitly install this file as mode 555 (no setuid bit) to allow
packaging to succeed. This commit does not change the mode of the file
installed by the package, users wanting suexec will still need to chmod
it themselves, just allows a FAKE_AS_ROOT=No build to work.

While there, swap some /var for LOCALSTATEDIR.
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.51 2014/09/16 09:07:03 espie Exp $
d6 1
a6 1
REVISION=	0
@


1.51
log
@explicitly mark the few ports that don't build with FAKE_AS_ROOT=No
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.50 2014/09/09 10:08:23 stsp Exp $
d6 1
a8 1
FAKE_AS_ROOT =	Yes
d42 1
a42 1
HTTPD_DIR=		/var/apache2
d64 2
a65 2
			--with-suexec-logfile=/var/log/suexec2_log \
			--with-pcre=${LOCALBASE} 
@


1.50
log
@update to apache-httpd 2.2.29; ok sthen
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.49 2014/07/27 10:51:37 kili Exp $
d8 1
@


1.49
log
@Rename rc scripts of apache-httpd to apache resp. apache2 to get rid
of a conflict with base httpd.

ok sthen@@
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.48 2014/07/16 14:41:19 sthen Exp $
d5 1
a5 1
V=		2.2.27
a7 1
REVISION=	4
@


1.48
log
@instead of lynx -dump, use ftp -o- | sed to strip out html tags (for
apachectl status / fullstatus)

ok ajacoutot@@
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.47 2014/07/12 14:11:32 pascal Exp $
d8 1
a8 1
REVISION=	3
@


1.47
log
@Fix apache after COMP removal.

ok naddy@@
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.46 2014/04/27 19:15:43 stsp Exp $
d8 1
a8 1
REVISION=	2
@


1.46
log
@Fix runtime breakage in www/apache-httpd after RAND_egd() removal; ok sthen
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.45 2014/04/21 22:47:07 ajacoutot Exp $
d8 1
a8 1
REVISION=	1
@


1.45
log
@Regen WANTLIB for kerberos removal.
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.44 2014/04/09 22:11:32 stsp Exp $
d8 1
a8 1
REVISION=	0
@


1.44
log
@Update www/apache-httpd to 2.2.17.
Fixes CVE-2014-0098 and CVE-2013-6438 among other changes.
ok sthen
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.43 2014/03/09 20:57:40 sthen Exp $
d8 1
d30 1
a30 2
WANTLIB+=		asn1 com_err gssapi krb5 sasl2
WANTLIB+=		heimbase lber-2.4 ldap-2.4 roken wind
@


1.43
log
@tweak DESCR/remove MESSAGE which are talking about base httpd
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.42 2013/12/01 02:58:30 brad Exp $
d5 1
a5 2
V=		2.2.26
REVISION=	0
@


1.42
log
@This is the Apache 2.0 license.
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.41 2013/11/25 17:00:47 stsp Exp $
d6 1
@


1.42.2.1
log
@For 5.5-stable, patch www/apache-httpd for CVE-2014-0098 and CVE-2013-6438.
ok jasper@@
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.42 2013/12/01 02:58:30 brad Exp $
a5 1
REVISION=	0
@


1.41
log
@Update to Apache HTTPD 2.2.26. Mostly rolls in patches we had already.
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.40 2013/10/17 14:05:41 stsp Exp $
d13 1
a13 1
# Apache
@


1.40
log
@Add upstream patches to fix Apache HTTPD PR 55397, a regression in 2.2.25
that breaks handling of special characters in filenames for Subversion.
ok landry sthen
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.39 2013/10/09 12:54:16 stsp Exp $
d5 1
a5 1
V=		2.2.25
a7 1
REVISION=	2
@


1.39
log
@Add patches from upstream to fix regressions in mod_dav since httpd-2.2.25.
Unbreaks 'svn copy URL1 URL2' and restores compliance with RFC 4918 (WebDAV).
See https://issues.apache.org/bugzilla/show_bug.cgi?id=55304
and https://issues.apache.org/bugzilla/show_bug.cgi?id=55306
ok sthen
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.38 2013/07/12 13:21:25 stsp Exp $
d8 1
a8 1
REVISION=	1
@


1.38
log
@Update Apache HTTPD 2 to version 2.2.25. Fixes CVE-2013-1896 and CVE-2013-1862.
ok giovanni@@
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.37 2013/06/20 06:54:37 ajacoutot Exp $
d8 1
@


1.38.2.1
log
@For 5.4-stable, patch www/apache-httpd for CVE-2014-0098 and CVE-2013-6438.
ok jasper@@
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.38 2013/07/12 13:21:25 stsp Exp $
a5 1
REVISION=	0
@


1.37
log
@Unbreak after hx509 and ntlm removal from Kerberos.
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.36 2013/06/17 19:28:37 ajacoutot Exp $
d5 1
a5 1
V=		2.2.23
a7 1
REVISION=	1
@


1.36
log
@Some trivial WANTLIB and tweaks to unbreak after the Heimdal update.
Stop hardcoding the Kerberos libs and use krb5-config(1).
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.35 2013/03/21 08:48:55 ajacoutot Exp $
d8 1
a8 1
REVISION=	0
d31 1
a31 1
WANTLIB+=		heimbase heimntlm hx509 lber-2.4 ldap-2.4 roken wind
@


1.35
log
@USE_LIBTOOL=Yes is the default now.
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.34 2013/03/11 11:44:41 espie Exp $
d8 1
d30 2
a31 1
WANTLIB+=		asn1 com_err gssapi krb5 sasl2 ldap lber
@


1.34
log
@PERMIT_* / REGRESS->TEST sweep
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.33 2013/02/09 14:49:53 sthen Exp $
a37 1
USE_LIBTOOL=		Yes
@


1.33
log
@Don't use ${FLAVOR:L}, we only support lower-case flavours now.
OK ajacoutot@@ espie@@
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.32 2012/10/18 08:12:16 giovanni Exp $
a14 3
PERMIT_PACKAGE_FTP=	Yes
PERMIT_DISTFILES_CDROM=	Yes
PERMIT_DISTFILES_FTP=	Yes
d18 1
a18 1
NO_REGRESS=		Yes
@


1.33.2.1
log
@MFC Apache update (CVE-2013-1896, CVE-2013-1862).
Req'd by jasper@@.
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.33 2013/02/09 14:49:53 sthen Exp $
d5 1
a5 1
V=		2.2.25
@


1.32
log
@
Update to 2.2.23, fixes CVE-2012-2687 and CVE-2012-0883.
ok sthen@@
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.31 2012/07/18 08:45:42 sthen Exp $
d30 1
a30 1
.if ${FLAVOR:L:Mldap}
d107 1
a107 1
.if ${FLAVOR:L:Mldap}
@


1.31
log
@Update to the Apache HTTP server 2.2.22, the current release on the 2.2 branch.
Merged from diffs from myself, Rodolfo Gouveia and with an rc script from
giovanni@@.

This is a security update, fixing CVE-2011-3348, CVE-2011-3368, CVE-2011-3607,
CVE-2011-4317, CVE-2012-0021, CVE-2012-0031 and CVE-2012-0053.
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.29 2012/02/17 08:33:03 ajacoutot Exp $
d5 1
a5 1
V=		2.2.22
d80 2
a81 2
A2MAN1=			apxs dbmmanage htdigest htpasswd logresolve
A2MAN8=			apachectl httpd rotatelogs suexec
@


1.31.2.1
log
@
Update to 2.2.23, fixes CVE-2012-2687 and CVE-2012-0883.
ok sthen@@
Reminded by Rodolfo Gouveia
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.31 2012/07/18 08:45:42 sthen Exp $
d5 1
a5 1
V=		2.2.23
d80 2
a81 2
A2MAN1=			dbmmanage htdigest htpasswd
A2MAN8=			apachectl apxs httpd logresolve rotatelogs suexec
@


1.30
log
@Needs bump because of devel/apr update; don't depend on removed 'mt' flavour
@
text
@d5 1
a5 1
V=		2.2.20
a7 1
REVISION=	1
d80 2
a81 2
A2MAN1=			dbmmanage htdigest htpasswd
A2MAN8= 		apachectl apxs httpd logresolve rotatelogs suexec
d98 1
a98 1
	
@


1.29
log
@Fix build with pcre >= 8.30 (from upstream)
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.28 2011/09/01 13:40:09 giovanni Exp $
d8 1
a8 1
REVISION=	0
d24 1
a24 1
WANTLIB += c crypto m ssl expat apr-1-mt db>=4 z pcre pthread aprutil-1-mt>=2
d35 1
a35 1
LIB_DEPENDS+=		apr-util-mt-*-ldap:devel/apr-util,ldap,mt
d37 1
a37 1
LIB_DEPENDS+=		apr-util-mt-*-!ldap:devel/apr-util,mt
d55 2
a56 2
			--with-apr=${LOCALBASE}/bin/apr-1-mt-config  \
			--with-apr-util=${LOCALBASE}/bin/apu-1-mt-config \
@


1.28
log
@
Update to latest version, fixes CVE-2011-3192
ok fkr@@
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.27 2011/02/12 21:05:38 pea Exp $
d8 1
@


1.27
log
@Fix CVE-2010-1452

ok sthen@@, landry@@
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.26 2010/11/22 08:36:47 espie Exp $
d5 1
a5 1
V=		2.2.15
a7 1
REVISION=	0
@


1.26
log
@new depends
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.25 2010/11/11 12:35:09 sthen Exp $
d8 1
@


1.25
log
@new-style LIB_DEPENDS/REVISION/WANTLIB
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.24 2010/10/19 08:02:53 espie Exp $
d20 1
a20 1
USE_GROFF =	Yes
d23 1
a23 1
WANTLIB += c crypto m ssl expat apr-1-mt db.>=4 z pcre pthread aprutil-1-mt.>=2
d25 1
a25 1
LIB_DEPENDS=		::devel/pcre
d33 2
a34 2
LIB_DEPENDS+=		::databases/openldap
LIB_DEPENDS+=		:apr-util-mt-*-ldap:devel/apr-util,ldap,mt
d36 1
a36 1
LIB_DEPENDS+=		:apr-util-mt-*-!ldap:devel/apr-util,mt
@


1.24
log
@USE_GROFF=Yes
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.23 2010/06/27 17:27:03 robert Exp $
d23 1
a23 1
WANTLIB=		c crypto m ssl expat apr-1-mt db.>=4 z pthread
d25 1
a25 1
LIB_DEPENDS=		pcre::devel/pcre
d32 3
a34 3
WANTLIB+=		asn1 com_err gssapi krb5 sasl2
LIB_DEPENDS+=		ldap,lber::databases/openldap
LIB_DEPENDS+=		aprutil-1-mt.>=2:apr-util-mt-*-ldap:devel/apr-util,ldap,mt
d36 1
a36 1
LIB_DEPENDS+=		aprutil-1-mt.>=2:apr-util-mt-*-!ldap:devel/apr-util,mt
@


1.23
log
@update to 2.2.15
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.22 2009/12/01 13:38:23 bernd Exp $
d20 1
@


1.22
log
@Security update to apache-httpd-2.2.14. (CVE-2009-3095, CVE-2009-3094)
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.21 2009/08/30 18:06:07 fkr Exp $
d5 1
a5 1
V=		2.2.14
@


1.21
log
@Update to 2.2.13
SECURITY: CVE-2009-2412, CVE-2009-1891, CVE-2009-1195, CVE-2009-1890,
CVE-2009-1191, CVE-2009-0023, CVE-2009-1955, CVE-2009-1956

Update the Makefile to properly depend on the mt version of apr-util
in ldap flavour. (from bernd@@)

ok jasper@@, ajacoutot@@
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.20 2009/05/15 15:46:58 claudio Exp $
d5 1
a5 1
V=		2.2.13
@


1.20
log
@Enable suexec for apache2 with these config changes:
- install the binary under ${TRUEPREFIX}/sbin/suexec2
- change suexec-caller to _apache2
- log to /var/log/suexec2_log similar to the suexec in base
Inputs and OK sthen@@, simon@@
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.19 2009/04/09 18:36:00 bernd Exp $
d5 2
a6 2
V=		2.2.11
PKGNAME=	apache-httpd-${V}p0
d33 1
a33 1
LIB_DEPENDS+=		aprutil-1.>=2:apr-util-mt-*-ldap:devel/apr-util,ldap,mt
@


1.20.2.1
log
@MFC:

SECURITY FIX

Update to 2.2.13
SECURITY: CVE-2009-2412, CVE-2009-1891, CVE-2009-1195, CVE-2009-1890,
CVE-2009-1191, CVE-2009-0023, CVE-2009-1955, CVE-2009-1956

Update the Makefile to properly depend on the mt version of apr-util
in ldap flavour. (from bernd@@)
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.21 2009/08/30 18:06:07 fkr Exp $
d5 2
a6 2
V=		2.2.13
PKGNAME=	apache-httpd-${V}
d33 1
a33 1
LIB_DEPENDS+=		aprutil-1-mt.>=2:apr-util-mt-*-ldap:devel/apr-util,ldap,mt
@


1.20.2.2
log
@MFC:

Security update to apache-httpd-2.2.14. (CVE-2009-3095, CVE-2009-3094)

ok jasper@@ bernd@@
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.20.2.1 2009/10/25 03:34:26 william Exp $
d5 1
a5 1
V=		2.2.14
@


1.19
log
@Update to apache-httpd-2.2.11.

Lots of bugfixes and a security fix for CVE-2008-2939.

Enable usage of the threaded apr which is needed for
an upcoming port.

ok simon@@
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.18 2008/09/02 22:05:23 bernd Exp $
d6 1
a6 1
PKGNAME=	apache-httpd-${V}
d63 5
a67 1
			--with-pcre=${LOCALBASE}
d78 1
a78 1
			logresolve rotatelogs
@


1.18
log
@Security update to apache-httpd-2.2.9. (CVE-2008-2364 and CVE-2007-6420)

http://www.apache.org/dist/httpd/CHANGES_2.2.9

Also fix LIB_DEPENDS and use the external pcre library instead of the shipped
one.

ok dlg@@, simon@@, merdely@@ (pre-lock)
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.17 2008/01/28 19:48:47 bernd Exp $
d5 1
a5 1
V=		2.2.9
d22 1
a22 1
WANTLIB=		c crypto m ssl expat apr-1 db.>=4 z
d33 1
a33 1
LIB_DEPENDS+=		aprutil-1.>=2:apr-util-*-ldap:devel/apr-util,ldap
d35 1
a35 1
LIB_DEPENDS+=		aprutil-1.>=2:apr-util-*-!ldap:devel/apr-util
d53 2
a54 2
			--with-apr=${LOCALBASE}  \
			--with-apr-util=${LOCALBASE} \
@


1.18.2.1
log
@SECURITY FIX

MFC:

Update to apache-httpd-2.2.11.

Lots of bugfixes and a security fix for CVE-2008-2939.

ok robert@@
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.19 2009/04/09 18:36:00 bernd Exp $
d5 1
a5 1
V=		2.2.11
@


1.18.2.2
log
@MFC:

SECURITY FIX

Update to 2.2.13
SECURITY: CVE-2009-2412, CVE-2009-1891, CVE-2009-1195, CVE-2009-1890,
CVE-2009-1191, CVE-2009-0023, CVE-2009-1955, CVE-2009-1956

Update the Makefile to properly depend on the mt version of apr-util
in ldap flavour. (from bernd@@)

ok jasper@@
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.21 2009/08/30 18:06:07 fkr Exp $
d5 1
a5 1
V=		2.2.13
d22 1
a22 1
WANTLIB=		c crypto m ssl expat apr-1-mt db.>=4 z pthread
d33 1
a33 1
LIB_DEPENDS+=		aprutil-1-mt.>=2:apr-util-mt-*-ldap:devel/apr-util,ldap,mt
d35 1
a35 1
LIB_DEPENDS+=		aprutil-1-mt.>=2:apr-util-mt-*-!ldap:devel/apr-util,mt
d53 2
a54 2
			--with-apr=${LOCALBASE}/bin/apr-1-mt-config  \
			--with-apr-util=${LOCALBASE}/bin/apu-1-mt-config \
d63 1
a63 5
			--enable-suexec \
			--with-suexec-caller=_apache2 \
			--with-suexec-bin=${TRUEPREFIX}/sbin/suexec2 \
			--with-suexec-logfile=/var/log/suexec2_log \
			--with-pcre=${LOCALBASE} 
d74 1
a74 1
			logresolve rotatelogs suexec
@


1.17
log
@Security update to apache2 2.2.8.

(CVE-2007-6420, CVE-2007-6421, CVE-2007-6422, CVE-2007-6423,
CVE-2008-0005, CVE-2007-6388)

http://lists.grok.org.uk/pipermail/full-disclosure/2008-January/059626.html
http://lists.grok.org.uk/pipermail/full-disclosure/2008-January/059560.html
http://lists.grok.org.uk/pipermail/full-disclosure/2008-January/059561.html

ok dlg@@
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.16 2007/09/19 05:47:36 steven Exp $
d5 1
a5 1
V=		2.2.8
d24 2
d35 1
a35 1
LIB_DEPENDS=		aprutil-1.>=2::devel/apr-util
d62 2
a63 1
			--enable-mods-shared=all
@


1.16
log
@SECURITY update to 2.2.6

fixes various vulnerabilities:
CVE-2007-3847, CVE-2007-1863, CVE-2007-3304, CVE-2006-5752, CVE-2007-1862

more details can be found at:
http://www.apache.org/dist/httpd/CHANGES_2.2.6

ok merdely@@
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.15 2007/09/06 07:33:53 merdely Exp $
d5 1
a5 1
V=		2.2.6
@


1.15
log
@Added ldap flavor which includes mod_authnz_ldap + mod_ldap
Removed quotes around COMMENT while here.

From Peter Hessler with tweaks by me.
Advice from Brad.  Help from deanna@@, simon@@.
ok dlg@@, simon@@
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.14 2007/03/25 17:40:55 deanna Exp $
d5 2
a6 2
V=		2.2.4
PKGNAME=	apache-httpd-${V}p0
@


1.14
log
@Update to 2.2.4.  This is principally a bugfix release.  See
Changelog: http://www.apache.org/dist/httpd/CHANGES_2.2

While here, regen patches with the new diff.

ok dlg
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.13 2007/01/16 01:12:26 deanna Exp $
d3 1
a3 1
COMMENT=	"apache HTTP server"
d6 1
a6 1
PKGNAME=	apache-httpd-${V}
d24 9
d34 1
d98 9
@


1.13
log
@Append a 2 to every mention of anything that exists in both the base
httpd and this port.  Hopefully we got them all.

Requested by robert@@, ok dlg@@.
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.12 2007/01/09 11:18:13 dlg Exp $
d5 2
a6 2
V=		2.2.3
PKGNAME=	apache-httpd-${V}p9
@


1.12
log
@enable the cache, disk_cache, and all the proxy modules. mem_cache wont
build since we arent using a threaded worker.

requested by ssehic
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.11 2007/01/09 10:47:37 dlg Exp $
d6 1
a6 1
PKGNAME=	apache-httpd-${V}p8
d22 1
a22 1
WANTLIB=		c crypto m ssl expat apr-1 db.>=4
d69 1
@


1.11
log
@enable all the modules, and build them as shared objects. mark the port
SHARED_ONLY.

ok robert@@
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.10 2007/01/09 09:56:57 dlg Exp $
d6 1
a6 1
PKGNAME=	apache-httpd-${V}p7
d47 3
@


1.10
log
@switch apache2 from a gnu style configure to a simple one so we can
define prefix the way apache likes it.

this is because apache2 has a different understanding of what the prefix
means, and our understanding and application of it on this port leads to
extremely confused paths in a lot of its generated files.

our understanding of prefix is to mean the path at which the binaries,
libs, manpages, and so on are stored, ie, /usr/local. apache2 understands
prefix to mean "install architecture-independent files", or in real terms
the ServerRoot. obviously using /usr/local as the server root when we want
to use /var/apache2 for that purpose is uncomfortable for it, and it leads
to things like broken paths in the default config files and builds of
modules.

ok robert@@
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.9 2007/01/05 22:57:11 dlg Exp $
d6 1
a6 1
PKGNAME=	apache-httpd-${V}p6
d19 1
d45 3
a47 1
			--with-program-name=httpd2
@


1.9
log
@move the dir with the build files out of /var/apache2 and into
/usr/local/share/apache2.

based on a suggestion from robert@@
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.8 2007/01/05 22:22:04 dlg Exp $
d6 1
a6 1
PKGNAME=	apache-httpd-${V}p5
d35 1
a35 1
CONFIGURE_STYLE=	gnu
d37 3
a39 1
			--datadir=${HTTPD_DIR} \
a43 1
			--libexecdir=${LOCALBASE}/lib \
@


1.8
log
@revert the part of the previous commit that removed the install of the
build dir. you can build apache 2 modules again now.
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.6 2006/12/16 00:41:56 deanna Exp $
d6 1
a6 1
PKGNAME=	apache-httpd-${V}p4
@


1.7
log
@- stop setting SYSCONFDIR

- put config files in /etc/apache2 instead of /var since this is not
chrooted

- make a couple of comments that refer to 'httpd' refer to 'httpd2'
instead

- don't install the build makefiles

ideas from bernd@@ and steven@@, ok steven@@
@
text
@d6 1
a6 1
PKGNAME=	apache-httpd-${V}p3
@


1.6
log
@To avoid name clashes with the system httpd, configure with program
name httpd2. Rename the support programs and their manual pages
accordingly.

bump pkgname.

ok steven@@, bernd@@.
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.5 2006/12/14 11:20:22 steven Exp $
d6 1
a6 1
PKGNAME=	apache-httpd-${V}p2
d32 2
a33 1
SYSCONFDIR=		${HTTPD_DIR}/conf
d38 2
a39 1
			--with-apr=${LOCALBASE} --with-apr-util=${LOCALBASE} \
d53 4
a56 6

_a2sbin=apachectl apxs dbmmanage htdigest htpasswd logresolve rotatelogs

_a2man1= dbmmanage htdigest htpasswd

_a2man8= apachectl apxs httpd logresolve rotatelogs suexec
d60 2
d69 1
a69 1
.for i in ${_a2man1}
d73 1
a73 1
.for i in ${_a2man8}
d77 1
a77 1
.for i in ${_a2sbin}
@


1.5
log
@use MASTER_SITE_APACHE, pointed out by dlg
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.4 2006/12/14 10:22:03 steven Exp $
d6 1
a6 1
PKGNAME=	apache-httpd-${V}p1
d40 2
a41 1
			--libexecdir=${LOCALBASE}/lib
d51 7
d62 16
a77 12
	chown -R ${SHAREOWN}:${SHAREGRP} \
	${PREFIX}/{share/doc/apache2,include/apache2,share/examples/apache2}

	chown ${LIBOWN}:${LIBGRP} ${PREFIX}/lib/httpd.exp

	chown ${MANOWN}:${MANGRP} \
	${PREFIX}/man/man1/{dbmmanage,htdbm,htdigest,htpasswd}.1 \
	${PREFIX}/man/man8/{ab,apachectl,apxs,htcacheclean,httpd}.8 \
	${PREFIX}/man/man8/{logresolve,rotatelogs,suexec}.8

	chown ${BINOWN}:${BINGRP} \
	${PREFIX}/sbin/{apachectl,apxs,dbmmanage,envvars,envvars-std}
@


1.4
log
@remove indirect dependency, add libiconv module, adjust WANTLIB, sync plist
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.3 2006/12/14 09:50:25 steven Exp $
d29 1
a29 4
MASTER_SITES=		http://www.mirrorservice.org/sites/ftp.apache.org/httpd/ \
			http://gulus.usherbrooke.ca/pub/appl/apache/httpd/ \
			http://apache.mirror.pacific.net.au/httpd/ \
			http://www.apache.org/dist/httpd/
@


1.3
log
@add a few master sites
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.2 2006/12/14 09:31:56 espie Exp $
d6 1
a6 1
PKGNAME=	apache-httpd-${V}p0
d21 1
a21 1
WANTLIB=		c crypto m ssl expat db.>=4 iconv expat
d23 3
a25 2
LIB_DEPENDS=		aprutil-1.>=2::devel/apr-util \
			apr-1.>=2::devel/apr
@


1.2
log
@this is wrong. You do not *ever* use @@exec for trivial purposes that
can be achieved otherwise.

This probably broke the install, I don't care!

Learn how to use @@owner and friends.
@
text
@d1 1
a1 1
# $OpenBSD: Makefile,v 1.1.1.1 2006/12/14 07:14:20 deanna Exp $
d28 4
a31 1
MASTER_SITES=		http://apache.mirror.pacific.net.au/httpd/
@


1.1
log
@Initial revision
@
text
@d1 1
a1 1
# $OpenBSD$
d6 1
a6 1
PKGNAME=	apache-httpd-${V}
@


1.1.1.1
log
@Bringing this in now so that we can work on it here.  Batting tarballs
back and forth in email messages doesn't make any sense when we have a
cvs tree to work in.

So, not hooked into the package builds yet.

Original work and port name from dlg.

ok robert@@, dlg@@

@
text
@@
