head	1.2;
access;
symbols
	OPENBSD_4_8:1.1.0.2
	OPENBSD_4_8_BASE:1.1;
locks; strict;
comment	@# @;


1.2
date	2010.08.24.09.14.43;	author robert;	state dead;
branches;
next	1.1;

1.1
date	2010.08.08.10.46.34;	author sthen;	state Exp;
branches;
next	;


desc
@@


1.2
log
@Update to 5.2.14
@
text
@$OpenBSD: patch-ext_xmlrpc_xmlrpc-epi-php_c,v 1.1 2010/08/08 10:46:34 sthen Exp $

CVE-2010-0397: null pointer dereference when processing invalid XML-RPC
requests, upstream r296152

--- ext/xmlrpc/xmlrpc-epi-php.c.orig	Sun Jan 17 17:19:38 2010
+++ ext/xmlrpc/xmlrpc-epi-php.c	Sat Aug  7 21:18:29 2010
@@@@ -723,6 +723,7 @@@@ zval* decode_request_worker (zval* xml_in, zval* encod
 	zval* retval = NULL;
 	XMLRPC_REQUEST response;
 	STRUCT_XMLRPC_REQUEST_INPUT_OPTIONS opts = {{0}};
+	const char *method_name;
 	opts.xml_elem_opts.encoding = encoding_in ? utf8_get_encoding_id_from_string(Z_STRVAL_P(encoding_in)) : ENCODING_DEFAULT;
 
 	/* generate XMLRPC_REQUEST from raw xml */
@@@@ -733,10 +734,15 @@@@ zval* decode_request_worker (zval* xml_in, zval* encod
 
 		if(XMLRPC_RequestGetRequestType(response) == xmlrpc_request_call) {
 			if(method_name_out) {
-				zval_dtor(method_name_out);
-				Z_TYPE_P(method_name_out) = IS_STRING;
-				Z_STRVAL_P(method_name_out) = estrdup(XMLRPC_RequestGetMethodName(response));
-				Z_STRLEN_P(method_name_out) = strlen(Z_STRVAL_P(method_name_out));
+				method_name = XMLRPC_RequestGetMethodName(response);
+				if (method_name) {
+					zval_dtor(method_name_out);
+					Z_TYPE_P(method_name_out) = IS_STRING;
+					Z_STRVAL_P(method_name_out) = estrdup(method_name);
+					Z_STRLEN_P(method_name_out) = strlen(Z_STRVAL_P(method_name_out));
+				} else {
+					retval = NULL;
+				}
 			}
 		}
 
@


1.1
log
@SECURITY: limited fixes cherry picked from 5.2.14.  If upstream had
mentioned the release on their announcements list maybe we would have
had time to get the full update in but, as it is, we just found out
about it and there are too many changes to test properly at short
notice, so we are just fixing these for now.

CVE-2010-2225: fix SplObjectStorage unserialization, upstream r300843

CVE-2010-0397: null pointer dereference when processing invalid XML-RPC
requests, upstream r296152

ok espie@@
@
text
@d1 1
a1 1
$OpenBSD$
@

