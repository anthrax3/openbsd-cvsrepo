head	1.6;
access;
symbols
	OPENBSD_4_9:1.4.0.14
	OPENBSD_4_9_BASE:1.4
	OPENBSD_4_8:1.4.0.12
	OPENBSD_4_8_BASE:1.4
	OPENBSD_4_7:1.4.0.10
	OPENBSD_4_7_BASE:1.4
	OPENBSD_4_6:1.4.0.8
	OPENBSD_4_6_BASE:1.4
	OPENBSD_4_5:1.4.0.6
	OPENBSD_4_5_BASE:1.4
	OPENBSD_4_4:1.4.0.4
	OPENBSD_4_4_BASE:1.4
	OPENBSD_4_3:1.4.0.2
	OPENBSD_4_3_BASE:1.4
	OPENBSD_4_2:1.3.0.2
	OPENBSD_4_2_BASE:1.3;
locks; strict;
comment	@# @;


1.6
date	2011.07.09.00.28.53;	author robert;	state dead;
branches;
next	1.5;

1.5
date	2011.06.18.19.49.22;	author sthen;	state Exp;
branches;
next	1.4;

1.4
date	2007.09.05.09.11.34;	author robert;	state Exp;
branches;
next	1.3;

1.3
date	2007.07.02.08.53.17;	author robert;	state Exp;
branches;
next	1.2;

1.2
date	2007.05.11.15.05.15;	author robert;	state Exp;
branches;
next	1.1;

1.1
date	2007.04.01.21.37.27;	author robert;	state Exp;
branches;
next	;


desc
@@


1.6
log
@bye bye
@
text
@$OpenBSD: patch-sapi_cgi_config9_m4,v 1.5 2011/06/18 19:49:22 sthen Exp $
--- sapi/cgi/config9.m4.orig.port	Thu Jul 12 00:20:37 2007
+++ sapi/cgi/config9.m4	Sat Jun 18 12:14:57 2011
@@@@ -25,7 +25,6 @@@@ PHP_ARG_ENABLE(path-info-check,,
 dnl
 dnl CGI setup
 dnl
-if test "$PHP_SAPI" = "default"; then
   AC_MSG_CHECKING(whether to build CGI binary)
   if test "$PHP_CGI" != "no"; then
     AC_MSG_RESULT(yes)
@@@@ -86,7 +85,8 @@@@ if test "$PHP_SAPI" = "default"; then
 
     dnl Set install target and select SAPI
     INSTALL_IT="@@echo \"Installing PHP CGI binary: \$(INSTALL_ROOT)\$(bindir)/\"; \$(INSTALL) -m 0755 \$(SAPI_CGI_PATH) \$(INSTALL_ROOT)\$(bindir)/\$(program_prefix)php-cgi\$(program_suffix)\$(EXEEXT)"
-    PHP_SELECT_SAPI(cgi, program, $PHP_FCGI_FILES cgi_main.c getopt.c,, '$(SAPI_CGI_PATH)')
+    PHP_ADD_SOURCES(sapi/cgi, $PHP_FCGI_FILES cgi_main.c getopt.c,, cgi)
+    PHP_ADD_SOURCES(/main, internal_functions.c,,cgi)
 
     case $host_alias in
       *aix*)
@@@@ -96,17 +96,26 @@@@ if test "$PHP_SAPI" = "default"; then
         BUILD_CGI="\$(CC) \$(CFLAGS_CLEAN) \$(EXTRA_CFLAGS) \$(EXTRA_LDFLAGS_PROGRAM) \$(LDFLAGS) \$(NATIVE_RPATHS) \$(PHP_GLOBAL_OBJS:.lo=.o) \$(PHP_SAPI_OBJS:.lo=.o) \$(PHP_FRAMEWORKS) \$(EXTRA_LIBS) \$(ZEND_EXTRA_LIBS) -o \$(SAPI_CGI_PATH)"
       ;;
       *)
-        BUILD_CGI="\$(LIBTOOL) --mode=link \$(CC) -export-dynamic \$(CFLAGS_CLEAN) \$(EXTRA_CFLAGS) \$(EXTRA_LDFLAGS_PROGRAM) \$(LDFLAGS) \$(PHP_RPATHS) \$(PHP_GLOBAL_OBJS) \$(PHP_SAPI_OBJS) \$(EXTRA_LIBS) \$(ZEND_EXTRA_LIBS) -o \$(SAPI_CGI_PATH)"
+	BUILD_CGI="\$(LIBTOOL) --mode=link \$(CC) -export-dynamic \$(CFLAGS_CLEAN) \$(EXTRA_CFLAGS) \$(EXTRA_LDFLAGS_PROGRAM) \$(LDFLAGS) \$(PHP_RPATHS) \$(PHP_GLOBAL_OBJS) \$(PHP_CGI_OBJS) \$(EXTRA_LIBS) \$(ZEND_EXTRA_LIBS) -o \$(SAPI_CGI_PATH)"
       ;;
     esac
 
+    PHP_CGI_TARGET="\$(SAPI_CGI_PATH)"
     PHP_SUBST(BUILD_CGI)
+    PHP_SUBST(PHP_CGI_OBJS)
+    PHP_SUBST(PHP_CGI_TARGET)
 
-  elif test "$PHP_CLI" != "no"; then
+    if test "$PHP_SAPI" = "default" ; then
+      PHP_BUILD_PROGRAM($SAPI_CGI_PATH)
+    fi
+ else
     AC_MSG_RESULT(no)
-    OVERALL_TARGET=
-    PHP_SAPI=cli   
+    if test "$PHP_SAPI" = "default" ; then
+      if test "$PHP_SAPI_CLI" != "no" ; then
+      OVERALL_TARGET=
+      PHP_SAPI=cli
   else
     AC_MSG_ERROR([No SAPIs selected.])  
   fi
+ fi
 fi
@


1.5
log
@Use PATCHORIG, regen patches and rename the files which didn't match the
normal update-patches filenames. This avoids update-patches picking up the
.orig files in PHP distfiles and make it easier to keep in-sync. ok robert@@
@
text
@d1 1
a1 1
$OpenBSD$
@


1.4
log
@update to version 5.2.4 and remove some obsolete CONFIGURE_ARGS;
@
text
@d2 2
a3 2
--- sapi/cgi/config9.m4.orig	Thu Jul 12 01:20:36 2007
+++ sapi/cgi/config9.m4	Fri Aug 31 09:33:21 2007
@


1.3
log
@update to version 5.2.3;
fixes many vulnerabilities just as usual. for more information
read http://www.php.net/releases/5_2_3.php

add a no_suhosin pseudo-flavor because horde has some problems
with the suhosin security patchset
@
text
@d2 6
a7 6
--- sapi/cgi/config9.m4.orig	Fri May 25 01:29:59 2007
+++ sapi/cgi/config9.m4	Mon Jul  2 10:34:20 2007
@@@@ -50,7 +50,6 @@@@ AC_ARG_ENABLE(path-info-check,
   PHP_ENABLE_PATHINFO_CHECK=yes
 ])
 
d9 2
a10 2
   AC_MSG_CHECKING(for CGI build)
   if test "$PHP_SAPI_CGI" != "no"; then
d12 1
a12 2
@@@@ -106,7 +105,8 @@@@ if test "$PHP_SAPI" = "default"; then
     AC_MSG_RESULT($PHP_ENABLE_FASTCGI)
d14 1
d16 1
a16 1
-    PHP_SELECT_SAPI(cgi, program, $PHP_FCGI_FILES cgi_main.c getopt.c, , '$(SAPI_CGI_PATH)')
d22 1
a22 1
@@@@ -116,17 +116,26 @@@@ if test "$PHP_SAPI" = "default"; then
d36 1
a36 1
-  elif test "$PHP_SAPI_CLI" != "no"; then
d45 1
a45 1
+      if test "$PHP_SAPI_CLI" != "no" ; then      
d47 1
a47 1
+      PHP_SAPI=cli   
@


1.2
log
@update to version 5.2.2;
fixes many vulnerabilities http://www.php.net/ChangeLog-5.php#5.2.2

from Lawrence Teo <lteo.openbsd1@@calyptix.com>;
@
text
@d1 3
a3 2
--- sapi/cgi/config9.m4.orig	Thu Sep 28 11:37:52 2006
+++ sapi/cgi/config9.m4	Sun Apr  1 15:23:31 2007
d12 1
a12 1
@@@@ -109,7 +108,8 @@@@ if test "$PHP_SAPI" = "default"; then
d15 1
a15 1
     INSTALL_IT="@@echo \"Installing PHP CGI into: \$(INSTALL_ROOT)\$(bindir)/\"; \$(INSTALL) -m 0755 \$(SAPI_CGI_PATH) \$(INSTALL_ROOT)\$(bindir)/\$(program_prefix)php\$(program_suffix)\$(EXEEXT)"
d22 1
a22 1
@@@@ -119,17 +119,26 @@@@ if test "$PHP_SAPI" = "default"; then
d27 1
a27 1
+        BUILD_CGI="\$(LIBTOOL) --mode=link \$(CC) -export-dynamic \$(CFLAGS_CLEAN) \$(EXTRA_CFLAGS) \$(EXTRA_LDFLAGS_PROGRAM) \$(LDFLAGS) \$(PHP_RPATHS) \$(PHP_GLOBAL_OBJS) \$(PHP_CGI_OBJS) \$(EXTRA_LIBS) \$(ZEND_EXTRA_LIBS) -o \$(SAPI_CGI_PATH)"
a36 1
-    AC_MSG_RESULT(no)
d41 7
a47 5
+  AC_MSG_RESULT(no)
+  if test "$PHP_SAPI" = "default" ; then
+    if test "$PHP_SAPI_CLI" != "no" ; then
     OVERALL_TARGET=
     PHP_SAPI=cli   
@


1.1
log
@- add a fastcgi subpackage to core because now we are able to build
more than one php binaries within one workdir (idea from FreeBSD)
- move pdo_sqlite support from core to extensions and also add a pdo_mysql
and a pdo_sqlite subpackage
- regen patches while here
- bump PKGNAMEs
@
text
@d3 2
a4 1
@@@@ -80,7 +80,6 @@@@ main()
a6 1
 
d11 1
a11 1
@@@@ -141,7 +140,8 @@@@ if test "$PHP_SAPI" = "default"; then
d21 1
a21 1
@@@@ -151,17 +151,26 @@@@ if test "$PHP_SAPI" = "default"; then
d26 1
a26 1
+	BUILD_CGI="\$(LIBTOOL) --mode=link \$(CC) -export-dynamic \$(CFLAGS_CLEAN) \$(EXTRA_CFLAGS) \$(EXTRA_LDFLAGS_PROGRAM) \$(LDFLAGS) \$(PHP_RPATHS) \$(PHP_GLOBAL_OBJS) \$(PHP_CGI_OBJS) \$(EXTRA_LIBS) \$(ZEND_EXTRA_LIBS) -o \$(SAPI_CGI_PATH)"
@

