head	1.2;
access;
symbols
	OPENBSD_3_1:1.1.0.6
	OPENBSD_3_1_BASE:1.1
	OPENBSD_2_9:1.1.0.4
	OPENBSD_3_0:1.1.0.2;
locks; strict;
comment	@# @;


1.2
date	2002.09.09.22.16.20;	author brad;	state dead;
branches;
next	1.1;

1.1
date	2002.02.27.16.31.59;	author brad;	state Exp;
branches
	1.1.2.1
	1.1.4.1;
next	;

1.1.2.1
date	2002.02.27.16.39.13;	author brad;	state Exp;
branches;
next	;

1.1.4.1
date	2002.02.27.16.45.19;	author brad;	state Exp;
branches;
next	;


desc
@@


1.2
log
@this should have been stubbed out in the first place.
@
text
@$OpenBSD: patch-functions_mime_c,v 1.1 2002/02/27 16:31:59 brad Exp $
--- functions/mime.c.orig	Mon Oct 16 21:30:59 2000
+++ functions/mime.c	Wed Feb 27 10:12:11 2002
@@@@ -85,7 +85,9 @@@@ void php3_mime_split(char *buf, int cnt,
 					SAFE_RETURN;
 				}
 				loc = memchr(ptr, '\n', rem);
+				rem -= loc - ptr;
 				name = strstr(ptr, " name=");
+				ptr = loc;
 				if (name && name < loc) {
 					name += 6;
 					s = memchr(name, '\"', loc - name);
@@@@ -138,6 +140,10 @@@@ void php3_mime_split(char *buf, int cnt,
 						sprintf(lbuf, "%s_name[]", abuf);
 						sbuf=estrdup(abuf);
 					} else {
+						if (abuf) {
+							efree(abuf);
+							abuf = NULL;
+						}
 						sprintf(lbuf, "%s_name", namebuf);
 						sbuf=estrdup(namebuf);
 					}
@


1.1
log
@security fixes

PHP supports multipart/form-data POST requests (as described in RFC1867)
known as POST fileuploads. Unfourtunately there are several flaws in the
php_mime_split function that could be used by an attacker to execute
arbitrary code.
- broken boundary check
- arbitrary heap overflow
--
Ok'd by: maintainer
@
text
@d1 1
a1 1
$OpenBSD$
@


1.1.4.1
log
@MFC:
security fixes

PHP supports multipart/form-data POST requests (as described in RFC1867)
known as POST fileuploads. Unfourtunately there are several flaws in the
php_mime_split function that could be used by an attacker to execute
arbitrary code.
- broken boundary check
- arbitrary heap overflow
--
Ok'd by: maintainer
@
text
@d1 1
a1 1
$OpenBSD: patch-functions_mime_c,v 1.1 2002/02/27 16:31:59 brad Exp $
@


1.1.2.1
log
@MFC:
security fixes

PHP supports multipart/form-data POST requests (as described in RFC1867)
known as POST fileuploads. Unfourtunately there are several flaws in the
php_mime_split function that could be used by an attacker to execute
arbitrary code.
- broken boundary check
- arbitrary heap overflow
--
Ok'd by: maintainer
@
text
@d1 1
a1 1
$OpenBSD: patch-functions_mime_c,v 1.1 2002/02/27 16:31:59 brad Exp $
@

