head	1.1;
access;
symbols
	OPENBSD_5_3:1.1.0.2;
locks; strict;
comment	@# @;


1.1
date	2013.07.02.17.10.59;	author jasper;	state dead;
branches
	1.1.2.1;
next	;

1.1.2.1
date	2013.07.02.17.10.59;	author jasper;	state Exp;
branches;
next	;


desc
@@


1.1
log
@file patch-inc_ticket_class_php was initially added on branch OPENBSD_5_3.
@
text
@@


1.1.2.1
log
@Security fixes from upstream svn for:
CVE-2012-2225, usage of unsafe unserialize() function
CVE-2013-2227, local file inclusion vulnerability
@
text
@a0 43
$OpenBSD$

Security fix for CVE-2012-2225, usage of unsafe unserialize() function.
https://forge.indepnet.net/projects/glpi/repository/revisions/21171

--- inc/ticket.class.php.orig	Tue Dec  4 16:21:43 2012
+++ inc/ticket.class.php	Tue Jul  2 19:02:42 2013
@@@@ -3136,7 +3136,7 @@@@ class Ticket extends CommonITILObject {
       // Predefined fields from template : reset them
       if (isset($options['_predefined_fields'])) {
          $options['_predefined_fields']
-                     = unserialize(rawurldecode(stripslashes($options['_predefined_fields'])));
+                     = Toolbox::decodeArrayFromInput($options['_predefined_fields']);
       } else {
          $options['_predefined_fields'] = array();
       }
@@@@ -3307,7 +3307,7 @@@@ class Ticket extends CommonITILObject {
          if ($tt->isField('id') && $tt->fields['id'] > 0) {
             echo "<input type='hidden' name='_tickettemplates_id' value='".$tt->fields['id']."'>";
             echo "<input type='hidden' name='_predefined_fields'
-                         value=\"".rawurlencode(serialize($predefined_fields))."\">";
+                         value=\"".Toolbox::prepareArrayForInput($predefined_fields)."\">";
          }
 
          echo "<input type='submit' name='add' value=\"".$LANG['help'][14]."\" class='submit'>";
@@@@ -3494,7 +3494,7 @@@@ class Ticket extends CommonITILObject {
       // Predefined fields from template : reset them
       if (isset($values['_predefined_fields'])) {
          $values['_predefined_fields']
-                        = unserialize(rawurldecode(stripslashes($values['_predefined_fields'])));
+                        = Toolbox::decodeArrayFromInput($values['_predefined_fields']);
       } else {
          $values['_predefined_fields'] = array();
       }
@@@@ -4224,7 +4224,7 @@@@ class Ticket extends CommonITILObject {
             if ($tt->isField('id') && $tt->fields['id'] > 0) {
                echo "<input type='hidden' name='_tickettemplates_id' value='".$tt->fields['id']."'>";
                echo "<input type='hidden' name='_predefined_fields'
-                            value=\"".rawurlencode(serialize($predefined_fields))."\">";
+                            value=\"".Toolbox::prepareArrayForInput($predefined_fields)."\">";
             }
          }
       }
@

