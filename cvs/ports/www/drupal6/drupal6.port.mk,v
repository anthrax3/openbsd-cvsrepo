head	1.10;
access;
symbols
	OPENBSD_6_0:1.10.0.2
	OPENBSD_6_0_BASE:1.10
	OPENBSD_5_9:1.9.0.2
	OPENBSD_5_9_BASE:1.9
	OPENBSD_5_8:1.9.0.4
	OPENBSD_5_8_BASE:1.9
	OPENBSD_5_7:1.8.0.12
	OPENBSD_5_7_BASE:1.8
	OPENBSD_5_6:1.8.0.10
	OPENBSD_5_6_BASE:1.8
	OPENBSD_5_5:1.8.0.8
	OPENBSD_5_5_BASE:1.8
	OPENBSD_5_4:1.8.0.6
	OPENBSD_5_4_BASE:1.8
	OPENBSD_5_3:1.8.0.4
	OPENBSD_5_3_BASE:1.8
	OPENBSD_5_2:1.8.0.2
	OPENBSD_5_2_BASE:1.8
	OPENBSD_5_1_BASE:1.7
	OPENBSD_5_1:1.7.0.6
	OPENBSD_5_0:1.7.0.4
	OPENBSD_5_0_BASE:1.7
	OPENBSD_4_9:1.7.0.2
	OPENBSD_4_9_BASE:1.7
	OPENBSD_4_8:1.4.0.4
	OPENBSD_4_8_BASE:1.4
	OPENBSD_4_7:1.4.0.2
	OPENBSD_4_7_BASE:1.4
	OPENBSD_4_6:1.1.1.1.0.2
	OPENBSD_4_6_BASE:1.1.1.1
	espie:1.1.1.1
	drupal6:1.1.1;
locks; strict;
comment	@# @;


1.10
date	2016.06.30.11.48.24;	author espie;	state Exp;
branches;
next	1.9;
commitid	UBOsw9sxU3iGlgDU;

1.9
date	2015.07.09.13.28.54;	author espie;	state Exp;
branches;
next	1.8;
commitid	I49kzIVGF37YWZTF;

1.8
date	2012.04.12.08.16.06;	author naddy;	state Exp;
branches;
next	1.7;

1.7
date	2010.11.22.08.36.47;	author espie;	state Exp;
branches;
next	1.6;

1.6
date	2010.11.15.09.05.40;	author stephan;	state Exp;
branches;
next	1.5;

1.5
date	2010.10.27.11.02.37;	author stephan;	state Exp;
branches;
next	1.4;

1.4
date	2009.07.27.12.39.36;	author espie;	state Exp;
branches;
next	1.3;

1.3
date	2009.07.26.12.20.07;	author espie;	state Exp;
branches;
next	1.2;

1.2
date	2009.07.15.09.42.31;	author espie;	state Exp;
branches;
next	1.1;

1.1
date	2009.04.03.14.07.58;	author espie;	state Exp;
branches
	1.1.1.1;
next	;

1.1.1.1
date	2009.04.03.14.07.58;	author espie;	state Exp;
branches;
next	;


desc
@@


1.10
log
@depend on the new core
@
text
@# $OpenBSD: drupal6.port.mk,v 1.9 2015/07/09 13:28:54 espie Exp $


# three types of things we can install, by default plugin
MODDRUPAL_THEME ?=	No

.if defined(DRUPAL_LANG)
MODDRUPAL_LANG ?=	Yes
.else
MODDRUPAL_LANG ?=	No
.endif


DIST_SUBDIR ?= drupal6
CATEGORIES +=	www www/drupal6

HOMEPAGE ?=	http://drupal.org/
MASTER_SITES ?=	http://www.drupal.org/files/projects/ \
		ftp://ftp.drupal.org/pub/drupal/files/projects/
PKG_ARCH ?=	*

.if !defined(WRKDIST)
WRKDIST =	${WRKDIR}/${DISTNAME:C/-6.x.*$//}
.endif

PREFIX ?=	/var/www
DRUPAL ?=	drupal6
DRUPAL_ROOT ?=	htdocs/${DRUPAL}
DRUPAL_MODS ?=	${DRUPAL_ROOT}/sites/all/modules/
DRUPAL_THEMES ?=${DRUPAL_ROOT}/sites/all/themes/
DRUPAL_OWNER =	root
DRUPAL_GROUP =	daemon
SUBST_VARS += 	DRUPAL_MODS DRUPAL_THEMES DRUPAL_ROOT \
		DRUPAL_OWNER DRUPAL_GROUP DRUPAL

.if ${MODDRUPAL_THEME:L} == "yes"
MODDRUPAL_INSTALL = \
		mkdir -p ${PREFIX}/${DRUPAL_THEMES}; \
		cp -R ${WRKDIST} ${PREFIX}/${DRUPAL_THEMES}; \
		chown -R ${DRUPAL_OWNER}.${DRUPAL_GROUP} ${PREFIX}/${DRUPAL_THEMES} 
.elif ${MODDRUPAL_LANG:L} == "yes"
MODDRUPAL_INSTALL = \
	mkdir -p ${PREFIX}/${DRUPAL_ROOT}; \
	cp -R ${WRKDIST}/* ${PREFIX}/${DRUPAL_ROOT}; \
	chown -R ${DRUPAL_OWNER}.${DRUPAL_GROUP} ${PREFIX}/${DRUPAL_ROOT}
SUBST_VARS += DRUPAL_LANG
.else
MODDRUPAL_INSTALL = \
		mkdir -p ${PREFIX}/${DRUPAL_MODS}; \
		cp -R ${WRKDIST} ${PREFIX}/${DRUPAL_MODS}; \
		chown -R ${DRUPAL_OWNER}.${DRUPAL_GROUP} ${PREFIX}/${DRUPAL_MODS} 
.endif

RUN_DEPENDS ?=	drupal->=6,<7:www/drupal6/core6
@


1.9
log
@belated update to 6.36.
need some fixes for php-5.6, as their unicode detect test is broken.
@
text
@d1 1
a1 1
# $OpenBSD: drupal6.port.mk,v 1.8 2012/04/12 08:16:06 naddy Exp $
d54 1
a54 1
RUN_DEPENDS ?=	drupal->=6,<7:www/drupal6/core
@


1.8
log
@rename LANG to DRUPAL_LANG to avoid clash with locale setting
@
text
@d1 1
a1 1
# $OpenBSD: drupal6.port.mk,v 1.7 2010/11/22 08:36:47 espie Exp $
d34 1
a34 1
		DRUPAL_OWNER DRUPAL_GROUP
@


1.7
log
@new depends
@
text
@d1 1
a1 1
# $OpenBSD: drupal6.port.mk,v 1.6 2010/11/15 09:05:40 stephan Exp $
d7 1
a7 1
.if defined(LANG)
d46 1
a46 1
SUBST_VARS += LANG
@


1.6
log
@least invasive round of cleanup:
- install drupal modules/themes as root:daemon rather than www:www
  (only the files/ directory needs to be writeable by 'www').
- don't install 'settings.php' world-readable since it contains the
  DB password. Use 640, owner 'www' instead.
- bump all modules.

tested in production, including upgrade szenarios.
ok sthen@@ and landry@@, maintainer timeout.
@
text
@d1 1
a1 1
# $OpenBSD: drupal6.port.mk,v 1.4 2009/07/27 12:39:36 espie Exp $
d54 1
a54 1
RUN_DEPENDS ?=	:drupal->=6,<7:www/drupal6/core
@


1.5
log
@add a http master site and make it the primary. 'sure' espie@@
@
text
@d31 2
a32 2
DRUPAL_OWNER =	www
DRUPAL_GROUP =	www
d40 1
a40 1
		chown -R www.www ${PREFIX}/${DRUPAL_THEMES} 
d45 1
a45 1
	chown -R www.www ${PREFIX}/${DRUPAL_ROOT}
a46 1
#RUN_DEPENDS ?=	::www/drupal5/autolocale
d51 1
a51 1
		chown -R www.www ${PREFIX}/${DRUPAL_MODS} 
@


1.4
log
@drop bogus drupal5 substitution, no actual generated plists change
@
text
@d1 1
a1 1
# $OpenBSD: drupal6.port.mk,v 1.3 2009/07/26 12:20:07 espie Exp $
d18 2
a19 1
MASTER_SITES ?=	ftp://ftp.drupal.org/pub/drupal/files/projects/
@


1.3
log
@tweak SUBST_VARS so that nodeaccess won't match DRUPAL_LOCALE (oops)
a few PKGNAME bumps needed after regenerating plists, because of DESCR
changes or .orig files from patches.
@
text
@d1 1
a1 1
# $OpenBSD: drupal6.port.mk,v 1.2 2009/07/15 09:42:31 espie Exp $
a29 1
DRUPAL_LOCALE ?=${DRUPAL_ROOT}/modules/node/
d32 1
a32 1
SUBST_VARS += 	DRUPAL_LOCALE DRUPAL_MODS DRUPAL_THEMES DRUPAL_ROOT \
@


1.2
log
@fix base run-depends (drupal6 only) and bump corresponding packagenames.
@
text
@d1 1
a1 1
# $OpenBSD: drupal6.port.mk,v 1.1.1.1 2009/04/03 14:07:58 espie Exp $
d28 3
a30 4
DRUPAL_MODS ?=	${DRUPAL_ROOT}/sites/all/modules
DRUPAL_THEMES ?=${DRUPAL_ROOT}/sites/all/themes
DRUPAL_LOCALE ?=${DRUPAL_MODS}/node
DRUPAL_LOCALE ?=${DRUPAL_ROOT}/modules/node
@


1.1
log
@Initial revision
@
text
@d1 1
a1 1
# $OpenBSD: drupal5.port.mk,v 1.3 2008/02/24 15:48:25 espie Exp $
d56 1
a56 1
RUN_DEPENDS ?=	::www/drupal6/core
@


1.1.1.1
log
@basic installation of drupal6 with a few extra stable modules.
WARNING: there's no simple migration from all datat from drupal5 to drupal6
yet.
@
text
@@
