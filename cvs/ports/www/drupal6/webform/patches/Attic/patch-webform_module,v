head	1.5;
access;
symbols
	OPENBSD_5_0:1.4.0.8
	OPENBSD_5_0_BASE:1.4
	OPENBSD_4_9:1.4.0.6
	OPENBSD_4_9_BASE:1.4
	OPENBSD_4_8:1.4.0.4
	OPENBSD_4_8_BASE:1.4
	OPENBSD_4_7:1.4.0.2
	OPENBSD_4_7_BASE:1.4;
locks; strict;
comment	@# @;


1.5
date	2012.01.28.10.02.35;	author espie;	state dead;
branches;
next	1.4;

1.4
date	2009.11.07.08.35.38;	author espie;	state Exp;
branches;
next	1.3;

1.3
date	2009.10.23.10.18.35;	author espie;	state Exp;
branches;
next	1.2;

1.2
date	2009.10.10.10.48.17;	author espie;	state Exp;
branches;
next	1.1;

1.1
date	2009.09.20.13.29.33;	author espie;	state Exp;
branches;
next	;


desc
@@


1.5
log
@update modules I use.
(at least date, webform, devel, views are security updates)
@
text
@$OpenBSD: patch-webform_module,v 1.4 2009/11/07 08:35:38 espie Exp $
--- webform.module.orig	Thu Oct 15 03:26:46 2009
+++ webform.module	Fri Oct 23 12:17:56 2009
@@@@ -249,6 +249,17 @@@@ function webform_menu() {
     'weight' => 2,
     'type' => MENU_LOCAL_TASK,
   );
+  $items['node/%webform_menu/submission/%webform_menu_submission/download'] = array(
+    'title' => 'Download',
+    'load arguments' => array(1),
+    'page callback' => 'drupal_get_form',
+    'page arguments' => array('webform_results_download_form', 1, 3),
+    'access callback' => 'webform_results_access',
+    'access arguments' => array(1, 'access webform results'),
+    'file' => 'webform_report.inc',
+    'weight' => 7,
+    'type' => MENU_LOCAL_TASK,
+  );
 
   return $items;
 }
@


1.4
log
@webform 2.9, fixes profile replacement issues.
@
text
@d1 1
a1 1
$OpenBSD: patch-webform_module,v 1.3 2009/10/23 10:18:35 espie Exp $
@


1.3
log
@minor security update, adjust my patches
@
text
@d1 1
a1 1
$OpenBSD: patch-webform_module,v 1.2 2009/10/10 10:48:17 espie Exp $
a21 19
@@@@ -2117,6 +2128,7 @@@@ function theme_webform_mail_headers($form_values, $nod
  */
 function _webform_filter_values($string, $node = NULL, $submission = NULL, $strict = TRUE, $allow_anonymous = FALSE) {
   global $user;
+  global $webform_uid_cached;
   static $replacements;
 
   // Setup default token replacements.
@@@@ -2157,8 +2169,9 @@@@ function _webform_filter_values($string, $node = NULL,
     $replacements['unsafe']['%username'] = isset($user->name) ? $user->name : '';
     $replacements['unsafe']['%useremail'] = isset($user->mail) ? $user->mail : '';
     $replacements['unsafe']['%ip_address'] = ip_address();
-    if ($user->uid && module_exists('profile')) {
+    if ($user->uid && module_exists('profile') && $webform_uid_cached != $user->uid) {
       profile_load_profile($user);
+      $webform_uid_cached = $user->uid;
     }
     $special_tokens['unsafe']['%profile'] = $user;
 
@


1.2
log
@fix 'choose as ref' extension (managed to commit a wrong patch) and
fix performance issue with intensive reloading of profile fields...
@
text
@d1 3
a3 3
$OpenBSD: patch-webform_module,v 1.1 2009/09/20 13:29:33 espie Exp $
--- webform.module.orig	Fri Feb 27 23:35:15 2009
+++ webform.module	Sat Oct 10 12:32:16 2009
d22 1
a22 1
@@@@ -2099,6 +2110,7 @@@@ function theme_webform_mail_headers($form_values, $nod
d24 1
a24 1
 function _webform_filter_values($string, $node = NULL, $submission = NULL, $strict = TRUE) {
d27 1
d30 10
a39 10
   $find = array('%site', '%date');
@@@@ -2123,8 +2135,9 @@@@ function _webform_filter_values($string, $node = NULL,
   $find[] = '%useremail';
   $replace[] = isset($user->name) ? $user->name : '';
   $replace[] = isset($user->mail) ? $user->mail : '';
-  if ($user->uid && module_exists('profile')) {
+  if ($user->uid && module_exists('profile') && $webform_uid_cached != $user->uid) {
     profile_load_profile($user);
+    $webform_uid_cached = $user->uid;
   }
a40 1
   // Provide a list of candidates for token replacement.
@


1.1
log
@minor improvements:
- reallow components to not have a label, use the key field for reference instead.
- "quizz-like" behavior: compare submissions against a default submission (only works for select fields so far)
@
text
@d1 1
a1 1
$OpenBSD$
d3 1
a3 1
+++ webform.module	Sun Sep 20 15:27:43 2009
d10 1
a10 1
+    'load arguments' => array(2),
d22 19
@

